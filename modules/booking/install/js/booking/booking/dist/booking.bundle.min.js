this.BX=this.BX||{};(function(t,e,o,s,i,n,r,a,l,d,c,u,p,h,m,g,b,f,v,I,k,B,y,T,P,S,E,C,M,O,_,w,L,D,F,H,N,$,A,R,z,x,G,K,U,V,X,j,W,q,Y,Z,Q,J,tt){"use strict";const et=50;const ot="--booking-off-hours-cell-height";const st="--booking-booking-collapse";const it="--booking-booking-expand";var nt=babelHelpers.classPrivateFieldLooseKey("animation");var rt=babelHelpers.classPrivateFieldLooseKey("container");var at=babelHelpers.classPrivateFieldLooseKey("content");var lt=babelHelpers.classPrivateFieldLooseKey("gridWrap");var dt=babelHelpers.classPrivateFieldLooseKey("fromHour");var ct=babelHelpers.classPrivateFieldLooseKey("toHour");class ut{constructor(){Object.defineProperty(this,ct,{get:bt,set:void 0});Object.defineProperty(this,dt,{get:gt,set:void 0});Object.defineProperty(this,lt,{get:mt,set:void 0});Object.defineProperty(this,at,{get:ht,set:void 0});Object.defineProperty(this,rt,{get:pt,set:void 0});Object.defineProperty(this,nt,{writable:true,value:void 0})}expand({keepScroll:t}){q.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,rt)[rt],st);q.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,rt)[rt],it);this.animate(0,et,t)}collapse(){q.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,rt)[rt],it);q.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,rt)[rt],st);this.animate(et,0,true)}animate(t,e,o=false){var s;const i=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].scrollTop;const n=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].scrollHeight;const r=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]/(24-(babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]-babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]));(s=babelHelpers.classPrivateFieldLooseBase(this,nt)[nt])==null?void 0:s.stop();babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]=new BX.easing({duration:200,start:{height:t},finish:{height:e},step:({height:t})=>{q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,at)[at],ot,`calc(var(--zoom) * ${t}px)`);if(o){const t=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].scrollHeight-n;babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].scrollTop=i+t*r}}});babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].animate()}setExpanded(t){const e=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].scrollTop;const o=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].scrollHeight;const s=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]/(24-(babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]-babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]));const i=t?et:0;const n=t?it:st;q.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,rt)[rt],[st,it]);q.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,rt)[rt],n);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,at)[at],ot,`calc(var(--zoom) * ${i}px)`);const r=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].scrollHeight-o;babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].scrollTop=e+r*s;void y.Core.getStore().dispatch(`${J.Model.Interface}/setOffHoursExpanded`,t)}}function pt(){return y.Core.getParams().container}function ht(){return BX("booking-content")}function mt(){return BX("booking-booking-grid-wrap")}function gt(){return y.Core.getStore().getters["interface/fromHour"]}function bt(){return y.Core.getStore().getters["interface/toHour"]}const ft=new ut;const vt=Object.freeze({NotConfirmed:"booking-filter-preset-unconfirmed",Delayed:"booking-filter-preset-delayed",CreatedByMe:"booking-filter-preset-created-by-me"});const It=Object.freeze({CreatedBy:"CREATED_BY",Contact:"CONTACT",Company:"COMPANY",Resource:"RESOURCE",Confirmed:"CONFIRMED",Delayed:"DELAYED"});const kt={emits:["apply","clear"],props:{filterId:{type:String,required:true}},data(){return{filter:null}},created(){this.filter=BX.Main.filterManager.getById(this.filterId);a.EventEmitter.subscribe("BX.Main.Filter:beforeApply",this.onBeforeApply)},methods:{onBeforeApply(t){const[e]=t.getData();if(e!==this.filterId){return}if(this.isFilterEmpty()){this.$emit("clear")}else{this.$emit("apply")}},setPresetId(t){if(this.getPresetId()===t){return}this.filter.getApi().setFilter({preset_id:t})},getPresetId(){const t=this.filter.getPreset().getCurrentPresetId();return t==="tmp_filter"?null:t},isFilterEmpty(){return Object.keys(this.getFields()).length===0},getFields(){const t=[It.Confirmed,It.Delayed];const e=[It.Company,It.Contact,It.CreatedBy,It.Resource];const o=this.filter.getFilterFieldsValues();const s=t.filter((t=>["Y","N"].includes(o[t]))).reduce(((t,e)=>({...t,[e]:o[e]})),{});e.forEach((t=>{var e;if(((e=o[t])==null?void 0:e.length)>0){s[t]=o[t]}}));return s}},template:`\n\t\t<div></div>\n\t`};const Bt=Object.freeze({NotConfirmed:"not-confirmed",Delayed:"delayed"});const yt={emits:["activeItem"],props:{target:HTMLElement},mounted(){this.addCounterPanel();a.EventEmitter.subscribe("BX.UI.CounterPanel.Item:activate",this.onActiveItem);a.EventEmitter.subscribe("BX.UI.CounterPanel.Item:deactivate",this.onActiveItem)},computed:W.mapGetters({counters:"counters/get"}),methods:{setItem(t){if(this.getActiveItem()===t){return}Object.values(Bt).forEach((t=>this.counterPanel.getItemById(t).deactivate()));const e=this.counterPanel.getItemById(t);e==null?void 0:e.activate()},addCounterPanel(){this.counterPanel=new l.CounterPanel({target:this.target,items:[{id:Bt.NotConfirmed,title:this.loc("BOOKING_BOOKING_COUNTER_PANEL_NOT_CONFIRMED"),value:this.counters.unConfirmed,color:Tt(d.CounterColor,d.CounterColor.THEME)},{id:Bt.Delayed,title:this.loc("BOOKING_BOOKING_COUNTER_PANEL_DELAYED"),value:this.counters.delayed}]});this.counterPanel.init()},onActiveItem(){this.$emit("activeItem",this.getActiveItem())},getActiveItem(){var t,e;return(t=(e=this.counterPanel.getItems().find((({isActive:t})=>t)))==null?void 0:e.id)!=null?t:null}},watch:{counters(t){this.counterPanel.getItems().forEach((e=>{if(e.id===Bt.NotConfirmed){e.updateColor(Tt(d.CounterColor,d.CounterColor.DANGER));e.updateValue(t.unConfirmed)}if(e.id===Bt.Delayed){e.updateColor(Tt(d.CounterColor,d.CounterColor.DANGER));e.updateValue(t.delayed)}}))}},template:`\n\t\t<div></div>\n\t`};const Tt=(t,e)=>Object.entries(t).find((([,t])=>t===e))[0];const Pt={props:{value:{type:Number,required:true},valueFormatted:{type:String,required:true},increasedValue:{type:Number,required:true},increasedValueFormatted:{type:String,required:true},popupId:{type:String,required:true},title:{type:String,required:true},rows:{type:Array,required:true},button:{type:Object,required:false}},data(){return{isPopupShown:false}},methods:{onMouseEnter(){this.clearTimeouts();this.showTimeout=setTimeout((()=>this.showPopup()),100)},onMouseLeave(){q.Event.unbind(document,"mouseover",this.updateHoverElement);q.Event.bind(document,"mouseover",this.updateHoverElement);this.clearTimeouts();if(!this.button){this.closePopup();return}this.closeTimeout=setTimeout((()=>{var t;this.popupContainer=document.getElementById(this.popupId);if(!((t=this.popupContainer)!=null&&t.contains(this.hoverElement))&&!this.$refs.container.contains(this.hoverElement)){this.closePopup()}if(this.popupContainer){q.Event.unbind(this.popupContainer,"mouseleave",this.onMouseLeave);q.Event.bind(this.popupContainer,"mouseleave",this.onMouseLeave)}}),100)},updateHoverElement(t){this.hoverElement=t.target},showPopup(){this.clearTimeouts();this.isPopupShown=true},closePopup(){this.clearTimeouts();this.isPopupShown=false;q.Event.unbind(this.popupContainer,"mouseleave",this.onMouseLeave);q.Event.unbind(document,"mouseover",this.updateHoverElement)},clearTimeouts(){clearTimeout(this.closeTimeout);clearTimeout(this.showTimeout)},close(){this.closePopup();this.$emit("close")}},watch:{value(){var t;(t=this.$refs.animation)==null?void 0:t.replaceWith(this.$refs.animation)}},components:{StatisticsPopup:S.StatisticsPopup},template:`\n\t\t<div class="booking-toolbar-after-title-info-profit-container" ref="container">\n\t\t\t<div\n\t\t\t\tv-html="valueFormatted"\n\t\t\t\tclass="booking-toolbar-after-title-info-profit"\n\t\t\t\t@click="showPopup"\n\t\t\t\t@mouseenter="onMouseEnter"\n\t\t\t\t@mouseleave="onMouseLeave"\n\t\t\t></div>\n\t\t\t<div\n\t\t\t\tv-if="increasedValue > 0"\n\t\t\t\tv-html="increasedValueFormatted"\n\t\t\t\tclass="booking-toolbar-after-title-profit-increased"\n\t\t\t\tref="animation"\n\t\t\t></div>\n\t\t</div>\n\t\t<StatisticsPopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:popupId="popupId"\n\t\t\t:bindElement="$refs.container"\n\t\t\t:title="title"\n\t\t\t:rows="rows"\n\t\t\t:button="button"\n\t\t\t@close="close"\n\t\t/>\n\t`};const St={data(){return{increasedValue:0}},computed:{...W.mapGetters({totalNewClientsToday:`${J.Model.Interface}/totalNewClientsToday`,totalClients:`${J.Model.Interface}/totalClients`}),popupId(){return"booking-booking-after-title-clients-popup"},title(){return this.loc("BOOKING_BOOKING_AFTER_TITLE_CLIENTS_POPUP_TITLE")},rows(){return[{title:this.loc("BOOKING_BOOKING_AFTER_TITLE_CLIENTS_POPUP_TOTAL_CLIENTS_TODAY"),value:`+${this.totalNewClientsToday}`},{title:this.loc("BOOKING_BOOKING_AFTER_TITLE_CLIENTS_POPUP_TOTAL_CLIENTS"),value:`<div>${this.totalClients}</div>`}]},button(){return{title:this.loc("BOOKING_BOOKING_CLIENTS_LIST"),click:()=>BX.SidePanel.Instance.open("/crm/contact/list/")}},clientsProfitFormatted(){return q.Loc.getMessagePlural("BOOKING_BOOKING_PLUS_NUM_CLIENTS",this.totalNewClientsToday,{"#NUM#":this.totalNewClientsToday})},increasedValueFormatted(){return q.Loc.getMessagePlural("BOOKING_BOOKING_PLUS_NUM_CLIENTS",this.increasedValue,{"#NUM#":this.increasedValue})}},watch:{totalNewClientsToday(t,e){this.increasedValue=t-e}},components:{Statistics:Pt},template:`\n\t\t<Statistics\n\t\t\t:value="totalNewClientsToday"\n\t\t\t:valueFormatted="clientsProfitFormatted"\n\t\t\t:increasedValue="increasedValue"\n\t\t\t:increasedValueFormatted="increasedValueFormatted"\n\t\t\t:popupId="popupId"\n\t\t\t:title="title"\n\t\t\t:rows="rows"\n\t\t\t:button="button"\n\t\t/>\n\t`};const Et={data(){return{increasedValue:0}},computed:{...W.mapGetters({moneyStatistics:`${J.Model.Interface}/moneyStatistics`}),popupId(){return"booking-booking-after-title-profit-popup"},title(){return this.loc("BOOKING_BOOKING_AFTER_TITLE_PROFIT_POPUP_TITLE")},rows(){var t,e,o,s;const i=(t=(e=this.moneyStatistics)==null?void 0:(o=e.month)==null?void 0:(s=o.filter((({currencyId:t})=>t!==this.baseCurrencyId)))==null?void 0:s.map((({currencyId:t})=>t)))!=null?t:[];return[this.getTodayRow(this.baseCurrencyId),...i.map((t=>this.getTodayRow(t))),this.getMonthRow(this.baseCurrencyId),...i.map((t=>this.getMonthRow(t)))]},todayProfit(){return this.getTodayProfit(this.moneyStatistics)},todayProfitFormatted(){return this.formatTodayProfit(this.todayProfit)},increasedValueFormatted(){return this.formatTodayProfit(this.increasedValue)},baseCurrencyId(){return P.currencyFormat.getBaseCurrencyId()}},methods:{getTodayRow(t){const e=this.loc("BOOKING_BOOKING_AFTER_TITLE_PROFIT_POPUP_TOTAL_TODAY");return{title:t===this.baseCurrencyId?e:"",value:`+${this.getTodayProfitFormatted(t)}`}},getMonthRow(t){const e=this.loc("BOOKING_BOOKING_AFTER_TITLE_PROFIT_POPUP_MONTH",{"#MONTH#":K.DateTimeFormat.format("f")});return{title:t===this.baseCurrencyId?e:"",value:`<div>${this.getMonthProfitFormatted(t)}</div>`}},getTodayProfitFormatted(t){var e,o,s;const i=(e=this.moneyStatistics)==null?void 0:(o=e.today)==null?void 0:o.find((({currencyId:e})=>e===t));const n=(s=i==null?void 0:i.opportunity)!=null?s:0;return P.currencyFormat.format(t,n)},getMonthProfitFormatted(t){var e,o,s;const i=(e=this.moneyStatistics)==null?void 0:(o=e.month)==null?void 0:o.find((({currencyId:e})=>e===t));const n=(s=i==null?void 0:i.opportunity)!=null?s:0;return P.currencyFormat.format(t,n)},getTodayProfit(t){var e,o;const s=t==null?void 0:(e=t.today)==null?void 0:e.find((({currencyId:t})=>t===this.baseCurrencyId));return(o=s==null?void 0:s.opportunity)!=null?o:0},formatTodayProfit(t){return`+ <span>${P.currencyFormat.format(this.baseCurrencyId,t)}</span>`}},watch:{moneyStatistics(t,e){this.increasedValue=this.getTodayProfit(t)-this.getTodayProfit(e)}},components:{Statistics:Pt},template:`\n\t\t<Statistics\n\t\t\t:value="todayProfit"\n\t\t\t:valueFormatted="todayProfitFormatted"\n\t\t\t:increasedValue="increasedValue"\n\t\t\t:increasedValueFormatted="increasedValueFormatted"\n\t\t\t:popupId="popupId"\n\t\t\t:title="title"\n\t\t\t:rows="rows"\n\t\t/>\n\t`};const Ct={computed:{dateFormatted(){const t=K.DateTimeFormat.getFormat("DAY_SHORT_MONTH_FORMAT");return K.DateTimeFormat.format(t,Date.now()/1e3)}},components:{Clients:St,Profit:Et},template:`\n\t\t<div class="booking-toolbar-after-title">\n\t\t\t<div class="booking-toolbar-after-title-date" ref="date">\n\t\t\t\t{{ dateFormatted }}\n\t\t\t</div>\n\t\t\t<div class="booking-toolbar-after-title-info">\n\t\t\t\t<Clients/>\n\t\t\t\t<Profit/>\n\t\t\t</div>\n\t\t</div>\n\t`};var Mt=babelHelpers.classPrivateFieldLooseKey("selectedDateTs");var Ot=babelHelpers.classPrivateFieldLooseKey("offset");var _t=babelHelpers.classPrivateFieldLooseKey("zoom");var wt=babelHelpers.classPrivateFieldLooseKey("resourcesIds");var Lt=babelHelpers.classPrivateFieldLooseKey("fromHour");var Dt=babelHelpers.classPrivateFieldLooseKey("toHour");var Ft=babelHelpers.classPrivateFieldLooseKey("offHoursExpanded");class Ht{constructor(){Object.defineProperty(this,Ft,{get:Gt,set:void 0});Object.defineProperty(this,Dt,{get:xt,set:void 0});Object.defineProperty(this,Lt,{get:zt,set:void 0});Object.defineProperty(this,wt,{get:Rt,set:void 0});Object.defineProperty(this,_t,{get:At,set:void 0});Object.defineProperty(this,Ot,{get:$t,set:void 0});Object.defineProperty(this,Mt,{get:Nt,set:void 0})}calculateLeft(t){const e=280*babelHelpers.classPrivateFieldLooseBase(this,_t)[_t];const o=babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].indexOf(t);return o*e}calculateTop(t){const e=50*babelHelpers.classPrivateFieldLooseBase(this,_t)[_t];const o=new Date(Math.max(babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt],t+babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]));const s=o.getHours()*60+o.getMinutes();const i=babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]*60;return(s-i)*(e/60)}calculateHeight(t,e){const o=50*babelHelpers.classPrivateFieldLooseBase(this,_t)[_t];const s=o/4;const i=Math.max(babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt],t+babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]);const n=Math.min(new Date(babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]).setHours(24),e+babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]);return Math.max((n-i)/U.Duration.getUnitDurations().H*o,s)}calculateRealHeight(t,e){const o=50*babelHelpers.classPrivateFieldLooseBase(this,_t)[_t];const s=o/4;const i=new Date(babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]).setHours(babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]?0:babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]);const n=new Date(babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]).setHours(babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]?24:babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]);const r=Math.max(i,t+babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]);const a=Math.min(n,e+babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]);return Math.max((a-r)/U.Duration.getUnitDurations().H*o,s)}}function Nt(){return y.Core.getStore().getters[`${J.Model.Interface}/selectedDateTs`]+babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]}function $t(){return y.Core.getStore().getters[`${J.Model.Interface}/offset`]}function At(){return y.Core.getStore().getters[`${J.Model.Interface}/zoom`]}function Rt(){return y.Core.getStore().getters[`${J.Model.Interface}/resourcesIds`]}function zt(){return y.Core.getStore().getters[`${J.Model.Interface}/fromHour`]}function xt(){return y.Core.getStore().getters[`${J.Model.Interface}/toHour`]}function Gt(){return y.Core.getStore().getters[`${J.Model.Interface}/offHoursExpanded`]}const Kt=new Ht;const Ut={props:{bottom:{type:Boolean,default:false}},computed:{...W.mapGetters({offHoursHover:"interface/offHoursHover",offHoursExpanded:"interface/offHoursExpanded",fromHour:"interface/fromHour",toHour:"interface/toHour"}),fromFormatted(){if(this.bottom){return this.formatHour(this.toHour)}return this.formatHour(0)},toFormatted(){if(this.bottom){return this.formatHour(24)}return this.formatHour(this.fromHour)}},methods:{formatHour(t){const e=K.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const o=(new Date).setHours(t,0)/1e3;return K.DateTimeFormat.format(e,o)},animateOffHours({keepScroll:t}){if(this.offHoursExpanded){ft.collapse()}else{ft.expand({keepScroll:t})}void this.$store.dispatch("interface/setOffHoursExpanded",!this.offHoursExpanded)}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-off-hours"\n\t\t\t:class="{'--hover': offHoursHover, '--bottom': bottom}"\n\t\t\t@click="animateOffHours({ keepScroll: bottom })"\n\t\t\t@mouseenter="$store.dispatch('interface/setOffHoursHover', true)"\n\t\t\t@mouseleave="$store.dispatch('interface/setOffHoursHover', false)"\n\t\t>\n\t\t\t<div class="booking-booking-off-hours-border"></div>\n\t\t\t<span>{{ fromFormatted }}</span>\n\t\t\t<span>{{ toFormatted }}</span>\n\t\t</div>\n\t`};const Vt={computed:{...W.mapGetters({offHoursHover:"interface/offHoursHover",offHoursExpanded:"interface/offHoursExpanded",fromHour:"interface/fromHour",toHour:"interface/toHour"}),panelHours(){const t=K.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const e=this.offHoursExpanded?24:this.toHour;return B.range(0,24).map((o=>{const s=(new Date).setHours(o,0)/1e3;return{value:o,formatted:K.DateTimeFormat.format(t,s),offHours:o<this.fromHour||o>=this.toHour,last:o===e}}))}},components:{OffHours:Ut},template:`\n\t\t<div class="booking-booking-grid-left-panel-container">\n\t\t\t<div class="booking-booking-grid-left-panel">\n\t\t\t\t<OffHours/>\n\t\t\t\t<OffHours :bottom="true"/>\n\t\t\t\t<template v-for="hour of panelHours" :key="hour.value">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="hour.last"\n\t\t\t\t\t\tclass="booking-booking-grid-left-panel-time-text"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ hour.formatted }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="hour.value !== 24"\n\t\t\t\t\t\tclass="booking-booking-grid-left-panel-time"\n\t\t\t\t\t\t:class="{'--off-hours': hour.offHours}"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="booking-booking-grid-left-panel-time-text">\n\t\t\t\t\t\t\t{{ hour.formatted }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`};const Xt={data(){return{visible:true}},mounted(){this.updateNowLine();setInterval((()=>this.updateNowLine()),1e3)},computed:W.mapGetters({zoom:`${J.Model.Interface}/zoom`,selectedDateTs:`${J.Model.Interface}/selectedDateTs`,offHoursExpanded:`${J.Model.Interface}/offHoursExpanded`,fromHour:`${J.Model.Interface}/fromHour`,toHour:`${J.Model.Interface}/toHour`,offset:`${J.Model.Interface}/offset`}),methods:{setVisible(t){this.visible=t;this.updateNowLine()},updateNowLine(){const t=new Date(Date.now()+this.offset);const e=50*this.zoom;const o=this.fromHour*60;const s=t.getHours()*60+t.getMinutes();const i=this.offHoursExpanded?24:this.toHour;const n=Math.min(i*60+21,s);const r=(n-o)*(e/60);q.Dom.style(this.$refs.nowLine,"top",`${r}px`);const a=K.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const l=K.DateTimeFormat.format(a,t.getTime()/1e3);if(l!==this.$refs.nowText.innerText){this.$refs.nowText.innerText=l}const d=new Date(this.selectedDateTs+this.offset);const c=this.visible&&Date.UTC(d.getFullYear(),d.getMonth(),d.getDate())===Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());q.Dom.style(this.$refs.nowLine,"display",c?"":"none")}},watch:{selectedDateTs(){this.updateNowLine()},zoom(){this.updateNowLine()},offHoursExpanded(t){const e=new Date;const o=e.getHours()*60+e.getMinutes();if(o<this.toHour*60){return}this.setVisible(!t);setTimeout((()=>this.setVisible(true)),200)}},template:`\n\t\t<div class="booking-booking-grid-now-line" ref="nowLine">\n\t\t\t<div class="booking-booking-grid-now-line-text" ref="nowText"></div>\n\t\t</div>\n\t`};var jt=babelHelpers.classPrivateFieldLooseKey("busySlots");var Wt=babelHelpers.classPrivateFieldLooseKey("getBookings");var qt=babelHelpers.classPrivateFieldLooseKey("getIntersectingBookings");var Yt=babelHelpers.classPrivateFieldLooseKey("selectedWeekDay");var Zt=babelHelpers.classPrivateFieldLooseKey("selectedDateTs");var Qt=babelHelpers.classPrivateFieldLooseKey("offset");var Jt=babelHelpers.classPrivateFieldLooseKey("timezoneOffset");var te=babelHelpers.classPrivateFieldLooseKey("resourcesIds");var ee=babelHelpers.classPrivateFieldLooseKey("intersections");var oe=babelHelpers.classPrivateFieldLooseKey("loadIntersections");var se=babelHelpers.classPrivateFieldLooseKey("calculateOffHoursBusySlots");var ie=babelHelpers.classPrivateFieldLooseKey("calculateIntersectionBusySlots");var ne=babelHelpers.classPrivateFieldLooseKey("calculateMinutesRange");var re=babelHelpers.classPrivateFieldLooseKey("subtractRanges");var ae=babelHelpers.classPrivateFieldLooseKey("rangesOverlap");var le=babelHelpers.classPrivateFieldLooseKey("getResource");var de=babelHelpers.classPrivateFieldLooseKey("getNextDay");var ce=babelHelpers.classPrivateFieldLooseKey("getPreviousDay");class ue{constructor(){Object.defineProperty(this,ce,{value:Me});Object.defineProperty(this,de,{value:Ce});Object.defineProperty(this,le,{value:Ee});Object.defineProperty(this,ae,{value:Se});Object.defineProperty(this,re,{value:Pe});Object.defineProperty(this,ne,{value:Te});Object.defineProperty(this,ie,{value:ye});Object.defineProperty(this,se,{value:Be});Object.defineProperty(this,oe,{value:ke});Object.defineProperty(this,ee,{get:Ie,set:void 0});Object.defineProperty(this,te,{get:ve,set:void 0});Object.defineProperty(this,Jt,{get:fe,set:void 0});Object.defineProperty(this,Qt,{get:be,set:void 0});Object.defineProperty(this,Zt,{get:ge,set:void 0});Object.defineProperty(this,Yt,{get:me,set:void 0});Object.defineProperty(this,qt,{value:he});Object.defineProperty(this,Wt,{value:pe});Object.defineProperty(this,jt,{writable:true,value:[]})}async loadBusySlots(){await babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]();void y.Core.getStore().dispatch(`${J.Model.Interface}/clearDisabledBusySlots`);void y.Core.getStore().dispatch(`${J.Model.Interface}/clearBusySlots`);const t=Object.keys(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]).flatMap((t=>{const e=Number(t);if(e>0){return e}return babelHelpers.classPrivateFieldLooseBase(this,te)[te]}));babelHelpers.classPrivateFieldLooseBase(this,jt)[jt]=[...babelHelpers.classPrivateFieldLooseBase(this,te)[te].flatMap((t=>babelHelpers.classPrivateFieldLooseBase(this,se)[se](t))),...t.flatMap((t=>babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](t)))];return y.Core.getStore().dispatch(`${J.Model.Interface}/upsertBusySlotMany`,babelHelpers.classPrivateFieldLooseBase(this,jt)[jt])}filterSlotRanges(t){return t.map((({from:t,to:e})=>({from:t,to:e}))).sort(((t,e)=>t.from-e.from)).reduce(((t,{from:e,to:o})=>{const s=t.length-1;if(t[s]&&t[s].to>=e){if(t[s].to<=o){t[s].to=o}}else{t.push({from:e,to:o})}return t}),[]).filter((({from:t,to:e})=>e-t>0))}}function pe(){return y.Core.getStore().getters[`${J.Model.Bookings}/getByDateAndResources`](babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt],babelHelpers.classPrivateFieldLooseBase(this,te)[te])}function he(t){return y.Core.getStore().getters[`${J.Model.Bookings}/getByDateAndResources`](babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt],t)}function me(){return J.DateFormat.WeekDays[new Date(babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]+babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]).getDay()]}function ge(){return y.Core.getStore().getters[`${J.Model.Interface}/selectedDateTs`]}function be(){return y.Core.getStore().getters[`${J.Model.Interface}/offset`]}function fe(){return y.Core.getStore().getters[`${J.Model.Interface}/timezoneOffset`]}function ve(){return y.Core.getStore().getters[`${J.Model.Interface}/resourcesIds`]}function Ie(){return y.Core.getStore().getters[`${J.Model.Interface}/intersections`]}async function ke(){const t=[...new Set(Object.values(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]).flat())];const e=babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]/1e3;const o=new Set(D.resourcesDateCache.getIdsByDateTs(e));const s=t.filter((t=>!o.has(t)));await w.resourceDialogService.loadByIds(s,e)}function Be(t){const e=babelHelpers.classPrivateFieldLooseBase(this,le)[le](t);if(e.slotRanges.length===0){return[]}const o=babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt]().filter((e=>e.resourcesIds.includes(t))).map((t=>babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](t)));const s=U.Duration.getUnitDurations().d/U.Duration.getUnitDurations().i;const i=e.slotRanges.map((t=>{const e=t.timezone;const o=new Date(babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]);const s=new Date(o.toLocaleString("en-US",{timeZone:e}));const i=new Date(o.toLocaleString("en-US",{timeZone:"UTC"}));const n=(s.getTime()-i.getTime())/1e3;const r=(babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt]-n)/60;return{...t,from:t.from+r,to:t.to+r}})).map((t=>{if(t.from>s){return{...t,from:t.from-s,to:t.to-s,weekDays:t.weekDays.map((t=>babelHelpers.classPrivateFieldLooseBase(this,de)[de](t)))}}if(t.to<0){return{...t,from:t.from+s,to:t.to+s,weekDays:t.weekDays.map((t=>babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](t)))}}return t})).flatMap((t=>{if(t.from<0){return[{...t,from:0},...t.weekDays.map((e=>({...t,from:s+t.from,to:s,weekDays:[babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](e)]})))]}if(t.to>s){return[{...t,to:s},...t.weekDays.map((e=>({...t,from:0,to:t.to-s,weekDays:[babelHelpers.classPrivateFieldLooseBase(this,de)[de](e)]})))]}return t})).filter((t=>t.weekDays.includes(babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt])));const n=this.filterSlotRanges([...i,...o]);const r=[0,...n.flatMap((({from:t,to:e})=>[t,e])),24*60].reduce(((t,e,o)=>{var s;const i=Math.floor(o/2);(s=t[i])!=null?s:t[i]=[];t[i].push(e);return t}),[]);return r.filter((([t,e])=>e-t>0)).map((([e,o])=>{const s=new Date(babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]).setMinutes(e);const i=new Date(babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]).setMinutes(o);const n=`${t}-${s}-${i}`;const r=J.BusySlot.OffHours;return{id:n,fromTs:s,toTs:i,resourceId:t,type:r}}))}function ye(t){var e,o;const s=babelHelpers.classPrivateFieldLooseBase(this,le)[le](t);if(s.slotRanges.length===0){return[]}const i=[...(e=babelHelpers.classPrivateFieldLooseBase(this,ee)[ee][0])!=null?e:[],...(o=babelHelpers.classPrivateFieldLooseBase(this,ee)[ee][t])!=null?o:[]];const n=babelHelpers.classPrivateFieldLooseBase(this,qt)[qt](i).filter((e=>!e.resourcesIds.includes(t)));const r=n.map((t=>babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](t)));if(r.length===0){return[]}const a=babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt]().filter((e=>t===e.resourcesIds[0])).map((t=>babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](t)));const l=r.flatMap((t=>babelHelpers.classPrivateFieldLooseBase(this,re)[re](t,a)));return l.map((({from:e,to:o,id:s})=>{const r=new Date(babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]).setMinutes(e);const a=new Date(babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]).setMinutes(o);const l=J.BusySlot.Intersection;const d=n.find((t=>t.id===s));const c=d?d.resourcesIds.find((t=>i.includes(t))):0;return{id:`${t}-${r}-${a}`,fromTs:r,toTs:a,resourceId:t,intersectingResourceId:c,type:l}}))}function Te(t){const e=new Date(babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]);const o=Math.max(e.getTime(),t.dateFromTs)+babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt];const s=Math.min(e.setDate(e.getDate()+1),t.dateToTs)+babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt];const i=new Date(o);const n=new Date(s);const r=n.getHours()*60+n.getMinutes();return{from:i.getHours()*60+i.getMinutes(),to:r===0?60*24:r,id:t.id}}function Pe(t,e){let o=[{...t}];e.forEach((t=>{o=o.flatMap((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](e,t)){const o=[];if(e.from<t.from){o.push({from:e.from,to:t.from,id:e.id})}if(e.to>t.to){o.push({from:t.to,to:e.to,id:e.id})}return o}return[e]}))}));return o}function Se(t,e){return t.from<e.to&&e.from<t.to}function Ee(t){return y.Core.getStore().getters[`${J.Model.Resources}/getById`](t)}function Ce(t){return J.DateFormat.WeekDays[(J.DateFormat.WeekDays.indexOf(t)+1)%7]}function Me(t){return J.DateFormat.WeekDays[(J.DateFormat.WeekDays.indexOf(t)+7-1)%7]}const Oe=new ue;const _e={props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},expired:{type:Boolean,default:false}},data(){return{showPopup:false}},mounted(){if(this.isRealId(this.bookingId)){tt.ahaMoments.setBookingForAhaMoment(this.bookingId)}if(tt.ahaMoments.shouldShow(J.AhaMoment.AddClient,{bookingId:this.bookingId})){void this.showAhaMoment()}},computed:W.mapGetters({providerModuleId:`${J.Model.Clients}/providerModuleId`,isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`}),methods:{clickHandler(){if(!this.isFeatureEnabled){z.limit.show();return}this.showPopup=true},async addClientsToBook(t){const e=this.$store.getters[`${J.Model.Bookings}/getById`](this.bookingId);await x.bookingService.update({id:e.id,clients:t})},isRealId(t){return/^[1-9]\d*$/.test(t)},async showAhaMoment(){await tt.ahaMoments.show({id:"booking-add-client",title:this.loc("BOOKING_AHA_ADD_CLIENT_TITLE"),text:this.loc("BOOKING_AHA_ADD_CLIENT_TEXT"),article:J.HelpDesk.AhaAddClient,target:this.$refs.button});tt.ahaMoments.setShown(J.AhaMoment.AddClient)}},components:{ClientPopup:V.ClientPopup},template:`\n\t\t<div\n\t\t\tv-if="providerModuleId"\n\t\t\tclass="booking-booking-booking-add-client"\n\t\t\t:class="{ '--expired': expired }"\n\t\t\tdata-element="booking-add-client-button"\n\t\t\t:data-id="bookingId"\n\t\t\t:data-resource-id="resourceId"\n\t\t\tref="button"\n\t\t\t@click="clickHandler"\n\t\t>\n\t\t\t{{ loc('BOOKING_BOOKING_PLUS_CLIENT') }}\n\t\t</div>\n\t\t<ClientPopup\n\t\t\tv-if="showPopup"\n\t\t\t:bindElement="this.$refs.button"\n\t\t\t:offset-top="-100"\n\t\t\t:offset-left="this.$refs.button.offsetWidth + 10"\n\t\t\t@create="addClientsToBook"\n\t\t\t@close="showPopup = false"\n\t\t/>\n\t`};const we={emits:["close"],props:{bookingId:{type:[Number,String],required:true},targetNode:HTMLElement},data(){return{ButtonSize:X.ButtonSize,ButtonColor:X.ButtonColor,ButtonIcon:X.ButtonIcon,fromTs:0,toTs:0,duration:0}},created(){this.fromTs=this.booking.dateFromTs;this.toTs=this.booking.dateToTs;this.duration=this.toTs-this.fromTs},mounted(){q.Event.bind(document,"scroll",this.adjustPosition,true)},beforeUnmount(){q.Event.unbind(document,"scroll",this.adjustPosition,true)},computed:{...W.mapGetters({selectedDateTs:`${J.Model.Interface}/selectedDateTs`}),popupId(){return`booking-change-time-popup-${this.bookingId}`},config(){return{className:"booking-booking-change-time-popup",bindElement:this.targetNode,offsetTop:-10,bindOptions:{forceBindPosition:true,position:"top"},angle:{offset:this.targetNode.offsetWidth/2}}},isBusy(){return this.bookings.filter((({id:t})=>t!==this.bookingId)).some((({dateToTs:t,dateFromTs:e})=>t>this.fromTs&&this.toTs>e))},bookings(){return this.$store.getters[`${J.Model.Bookings}/getByDateAndResources`](this.selectedDateTs,this.booking.resourcesIds)},booking(){return this.$store.getters["bookings/getById"](this.bookingId)}},methods:{adjustPosition(){this.$refs.popup.adjustPosition();this.$refs.timeFrom.adjustMenuPosition();this.$refs.timeTo.adjustMenuPosition()},closePopup(){const t=this.booking.dateFromTs!==this.fromTs||this.booking.dateToTs!==this.toTs;if(!this.isBusy&&t){void x.bookingService.update({id:this.booking.id,dateFromTs:this.fromTs,dateToTs:this.toTs,timezoneFrom:this.booking.timezoneFrom,timezoneTo:this.booking.timezoneTo})}this.$emit("close")},freeze(){this.$refs.popup.getPopupInstance().setAutoHide(false)},unfreeze(){this.$refs.popup.getPopupInstance().setAutoHide(true)}},watch:{fromTs(){this.toTs=this.fromTs+this.duration},toTs(){if(this.toTs<=this.fromTs){this.fromTs=this.toTs-this.duration}this.duration=this.toTs-this.fromTs},isBusy(){setTimeout((()=>this.adjustPosition()),0)}},components:{Popup:k.Popup,TimeSelector:u.TimeSelector,Button:X.Button},template:`\n\t\t<Popup\n\t\t\t:id="popupId"\n\t\t\t:config="config"\n\t\t\t@close="closePopup"\n\t\t\tref="popup"\n\t\t>\n\t\t\t<div class="booking-booking-change-time-popup-content">\n\t\t\t\t<div class="booking-booking-change-time-popup-main">\n\t\t\t\t\t<TimeSelector\n\t\t\t\t\t\tv-model="fromTs"\n\t\t\t\t\t\t:hasError="isBusy"\n\t\t\t\t\t\tdata-element="booking-change-time-from"\n\t\t\t\t\t\t:data-ts="fromTs"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\tref="timeFrom"\n\t\t\t\t\t\t@freeze="freeze"\n\t\t\t\t\t\t@unfreeze="unfreeze"\n\t\t\t\t\t\t@enterSave="closePopup"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class="booking-booking-change-time-popup-separator"></div>\n\t\t\t\t\t<TimeSelector\n\t\t\t\t\t\tv-model="toTs"\n\t\t\t\t\t\t:hasError="isBusy"\n\t\t\t\t\t\t:minTs="fromTs"\n\t\t\t\t\t\tdata-element="booking-change-time-to"\n\t\t\t\t\t\t:data-ts="toTs"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\tref="timeTo"\n\t\t\t\t\t\t@freeze="freeze"\n\t\t\t\t\t\t@unfreeze="unfreeze"\n\t\t\t\t\t\t@enterSave="closePopup"\n\t\t\t\t\t/>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclass="booking-booking-change-time-popup-button"\n\t\t\t\t\t\t:size="ButtonIcon.MEDIUM"\n\t\t\t\t\t\t:color="ButtonColor.PRIMARY"\n\t\t\t\t\t\t:icon="ButtonIcon.DONE"\n\t\t\t\t\t\t:disabled="isBusy"\n\t\t\t\t\t\t@click="closePopup"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="isBusy" class="booking-booking-change-time-popup-error">\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_TIME_IS_NOT_AVAILABLE') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Popup>\n\t`};const Le={props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true}},data(){return{showPopup:false}},computed:{...W.mapGetters({offset:`${J.Model.Interface}/offset`,isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`}),booking(){return this.$store.getters["bookings/getById"](this.bookingId)},timeFormatted(){const t=K.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");return this.loc("BOOKING_BOOKING_TIME_RANGE",{"#FROM#":K.DateTimeFormat.format(t,(this.booking.dateFromTs+this.offset)/1e3),"#TO#":K.DateTimeFormat.format(t,(this.booking.dateToTs+this.offset)/1e3)})}},methods:{clickHandler(){if(!this.isFeatureEnabled){return}if(!this.isRealId(this.bookingId)){return}this.showPopup=true},closePopup(){this.showPopup=false},isRealId(t){return/^[1-9]\d*$/.test(t)}},components:{ChangeTimePopup:we},template:`\n\t\t<div\n\t\t\tclass="booking-booking-booking-time"\n\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\tdata-element="booking-booking-time"\n\t\t\t:data-booking-id="bookingId"\n\t\t\t:data-resource-id="resourceId"\n\t\t\t:data-from="booking.dateFromTs"\n\t\t\t:data-to="booking.dateToTs"\n\t\t\tref="time"\n\t\t\t@click="clickHandler"\n\t\t>\n\t\t\t{{ timeFormatted }}\n\t\t</div>\n\t\t<ChangeTimePopup\n\t\t\tv-if="showPopup"\n\t\t\t:bookingId="bookingId"\n\t\t\t:targetNode="$refs.time"\n\t\t\t@close="closePopup"\n\t\t/>\n\t`};const De={emits:["close"],props:{bookingId:{type:[Number,String],required:true},bindElement:{type:Function,required:true},isEditMode:{type:Boolean,required:true}},data(){return{ButtonSize:X.ButtonSize,ButtonColor:X.ButtonColor,note:"",mountedPromise:new Q.Resolvable}},created(){this.note=this.bookingNote},mounted(){this.mountedPromise.resolve();this.adjustPosition();this.focusOnTextarea();q.Event.bind(document,"scroll",this.adjustPosition,true)},beforeUnmount(){q.Event.unbind(document,"scroll",this.adjustPosition,true)},computed:{bookingNote(){var t;return(t=this.booking.note)!=null?t:""},booking(){return this.$store.getters["bookings/getById"](this.bookingId)},popupId(){return`booking-booking-note-popup-${this.bookingId}`},config(){return{className:"booking-booking-note-popup",bindElement:this.bindElement(),minWidth:this.bindElement().offsetWidth,height:120,offsetTop:-10,background:"var(--ui-color-background-note)",bindOptions:{forceBindPosition:true,position:"top"},autoHide:this.isEditMode}}},methods:{saveNote(){const t=this.note.trim();if(this.bookingNote!==t){void x.bookingService.update({id:this.booking.id,note:t})}this.closePopup()},onMouseDown(){q.Event.unbind(window,"mouseup",this.onMouseUp);q.Event.bind(window,"mouseup",this.onMouseUp);this.setAutoHide(false)},onMouseUp(){q.Event.unbind(window,"mouseup",this.onMouseUp);setTimeout((()=>this.setAutoHide(this.isEditMode)),0)},setAutoHide(t){var e,o;(e=this.$refs.popup)==null?void 0:(o=e.getPopupInstance())==null?void 0:o.setAutoHide(t)},adjustPosition(){this.$refs.popup.adjustPosition()},closePopup(){this.$emit("close")},focusOnTextarea(){setTimeout((()=>{if(this.isEditMode){this.$refs.textarea.focus()}}),0)}},watch:{isEditMode(t){this.setAutoHide(t);this.focusOnTextarea()},async note(){await this.mountedPromise;this.$refs.popup.getPopupInstance().setHeight(0);const t=120;const e=280;const o=this.$refs.textarea.scrollHeight+45;const s=Math.min(e,Math.max(t,o));this.$refs.popup.getPopupInstance().setHeight(s);this.adjustPosition()}},components:{Popup:k.Popup,Button:X.Button},template:`\n\t\t<Popup\n\t\t\t:id="popupId"\n\t\t\t:config="config"\n\t\t\tref="popup"\n\t\t\t@close="closePopup"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="booking-booking-note-popup-content"\n\t\t\t\tdata-element="booking-note-popup"\n\t\t\t\t:data-id="bookingId"\n\t\t\t\t@mousedown="onMouseDown"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclass="booking-booking-note-popup-title"\n\t\t\t\t\tdata-element="booking-note-popup-title"\n\t\t\t\t\t:data-id="bookingId"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_NOTE_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<textarea\n\t\t\t\t\tv-model="note"\n\t\t\t\t\tclass="booking-booking-note-popup-textarea"\n\t\t\t\t\t:placeholder="loc('BOOKING_BOOKING_NOTE_HINT')"\n\t\t\t\t\t:disabled="!isEditMode"\n\t\t\t\t\tdata-element="booking-note-popup-textarea"\n\t\t\t\t\t:data-id="bookingId"\n\t\t\t\t\t:data-disabled="!isEditMode"\n\t\t\t\t\tref="textarea"\n\t\t\t\t></textarea>\n\t\t\t\t<div v-if="isEditMode" class="booking-booking-note-popup-buttons">\n\t\t\t\t\t<Button\n\t\t\t\t\t\t:dataset="{id: bookingId, element: 'booking-note-popup-save'}"\n\t\t\t\t\t\t:text="loc('BOOKING_BOOKING_NOTE_SAVE')"\n\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t:color="ButtonColor.PRIMARY"\n\t\t\t\t\t\t@click="saveNote"\n\t\t\t\t\t/>\n\t\t\t\t\t<Button\n\t\t\t\t\t\t:dataset="{id: bookingId, element: 'booking-note-popup-cancel'}"\n\t\t\t\t\t\t:text="loc('BOOKING_BOOKING_NOTE_CANCEL')"\n\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t:color="ButtonColor.LINK"\n\t\t\t\t\t\t@click="closePopup"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Popup>\n\t`};const Fe={emits:["popupShown","popupClosed"],props:{bookingId:{type:[Number,String],required:true}},data(){return{IconSet:N.Set,isPopupShown:false,isEditMode:false}},computed:{...W.mapGetters({isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`}),booking(){return this.$store.getters["bookings/getById"](this.bookingId)},hasNote(){return Boolean(this.booking.note)}},methods:{onMouseEnter(){this.showNoteTimeout=setTimeout((()=>this.showViewPopup()),100)},onMouseLeave(){clearTimeout(this.showNoteTimeout);this.closeViewPopup()},showViewPopup(){if(this.isPopupShown||!this.hasNote){return}this.isEditMode=false;this.showPopup()},closeViewPopup(){if(this.isEditMode){return}this.closePopup()},showEditPopup(){this.isEditMode=true;this.showPopup()},closeEditPopup(){if(!this.isEditMode){return}this.closePopup()},showPopup(){this.isPopupShown=true;this.$emit("popupShown")},closePopup(){this.isPopupShown=false;this.$emit("popupClosed")}},components:{NotePopup:De,Icon:N.BIcon},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item-client-note"\n\t\t\tdata-element="booking-menu-note"\n\t\t\t:data-booking-id="bookingId"\n\t\t\t:data-has-note="hasNote"\n\t\t\t:class="{'--empty': !hasNote}"\n\t\t\tref="note"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="booking-actions-popup__item-client-note-inner"\n\t\t\t\tdata-element="booking-menu-note-add"\n\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t@mouseenter="onMouseEnter"\n\t\t\t\t@mouseleave="onMouseLeave"\n\t\t\t\t@click="() => hasNote ? showViewPopup() : showEditPopup()"\n\t\t\t>\n\t\t\t\t<template v-if="hasNote">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="booking-actions-popup__item-client-note-text"\n\t\t\t\t\t\tdata-element="booking-menu-note-text"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ booking.note }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="isFeatureEnabled"\n\t\t\t\t\t\tclass="booking-actions-popup__item-client-note-edit"\n\t\t\t\t\t\tdata-element="booking-menu-note-edit"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t@click="showEditPopup"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon :name="IconSet.PENCIL_40"/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<Icon :name="IconSet.PLUS_20"/>\n\t\t\t\t\t<div class="booking-actions-popup__item-client-note-text">\n\t\t\t\t\t\t{{ loc('BB_ACTIONS_POPUP_ADD_NOTE') }}\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t\t<NotePopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:isEditMode="isEditMode && isFeatureEnabled"\n\t\t\t:bookingId="bookingId"\n\t\t\t:bindElement="() => $refs.note"\n\t\t\t@close="closeEditPopup"\n\t\t/>\n\t`};const He={emits:["popupShown","popupClosed"],props:{bookingId:{type:[Number,String],required:true}},directives:{hint:v.hint},components:{Button:X.Button,Icon:N.BIcon,ClientPopup:V.ClientPopup},data(){return{ButtonSize:X.ButtonSize,ButtonColor:X.ButtonColor,ButtonIcon:X.ButtonIcon,isLoading:true,shownClientPopup:false}},methods:{showClientPopup(){if(!this.isFeatureEnabled){z.limit.show();return}this.shownClientPopup=true;this.$emit("popupShown")},hideClientPopup(){this.shownClientPopup=false;this.$emit("popupClosed")},async addClientsToBook(t){const e=this.$store.getters[`${J.Model.Bookings}/getById`](this.bookingId);await x.bookingService.update({id:e.id,clients:t})}},computed:{...W.mapGetters({isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`}),btnIcon(){return this.isFeatureEnabled?X.ButtonIcon.ADD:X.ButtonIcon.LOCK},userIcon(){return N.Set.PERSON},personSize(){return 26},callIcon(){return N.Set.TELEPHONY_HANDSET_1},messageIcon(){return N.Set.CHATS_1},iconSize(){return 20},iconColor(){return"var(--ui-color-palette-gray-20)"},soonHint(){return{text:this.loc("BOOKING_BOOKING_SOON_HINT"),popupOptions:{offsetLeft:-60}}}},template:`\n\t\t<div class="booking-actions-popup__item-client-icon-container">\n\t\t\t<div class="booking-actions-popup__item-client-icon">\n\t\t\t\t<Icon :name="userIcon" :size="personSize" :color="iconColor"/>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="booking-actions-popup__item-client-info --empty">\n\t\t\t<div class="booking-actions-popup__item-client-info-label --empty">\n\t\t\t\t{{loc('BB_ACTIONS_POPUP_CLIENT_EMPTY_NAME_LABEL')}}\n\t\t\t</div>\n\t\t\t<div class="booking-actions-popup__item-client-info-empty">\n\t\t\t\t<div></div>\n\t\t\t\t<div></div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="booking-actions-popup-item-buttons booking-actions-popup__item-client-info-btn"\n\t\t\t\tref="clientButton"\n\t\t\t>\n\t\t\t\t<Button\n\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_CLIENT_BTN_EMPTY_LABEL')"\n\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t:color="ButtonColor.PRIMARY"\n\t\t\t\t\t:icon="btnIcon"\n\t\t\t\t\t:round="true"\n\t\t\t\t\t@click="showClientPopup"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<ClientPopup\n\t\t\t\tv-if="shownClientPopup"\n\t\t\t\t:bindElement="this.$refs.clientButton"\n\t\t\t\t@create="addClientsToBook"\n\t\t\t\t@close="hideClientPopup"\n\t\t\t/>\n\t\t</div>\n\t\t<div v-hint="soonHint" class="booking-actions-popup__item-client-action">\n\t\t\t<Icon :name="callIcon" :size="iconSize" :color="iconColor"/>\n\t\t\t<Icon :name="messageIcon" :size="iconSize" :color="iconColor"/>\n\t\t</div>\n\t`};const Ne={name:"EditClientButton",emits:["visible","invisible"],props:{bookingId:{type:Number,required:true}},data(){return{IconSet:N.Set,ButtonSize:X.ButtonSize,ButtonColor:X.ButtonColor,ButtonIcon:X.ButtonIcon,isClientPopupShowed:false}},computed:{booking(){return this.$store.getters[`${J.Model.Bookings}/getById`](this.bookingId)},currentClient(){const t=this.$store.getters[`${J.Model.Clients}/getByClientData`];const e={contact:null,company:null};(this.booking.clients||[]).map((e=>t(e))).forEach((t=>{if(t.type.code===J.CrmEntity.Contact){e.contact=t}else if(t.type.code===J.CrmEntity.Company){e.company=t}}));return e}},methods:{async updateClient(t){await x.bookingService.update({id:this.booking.id,clients:t})},showPopup(){this.isClientPopupShowed=true;this.$emit("visible")},closePopup(){this.isClientPopupShowed=false;this.$emit("invisible")}},components:{ClientPopup:V.ClientPopup,Button:X.Button,Icon:N.BIcon},template:`\n\t\t<Button\n\t\t\tdata-element="booking-menu-client-edit"\n\t\t\t:data-booking-id="bookingId"\n\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t:round="true"\n\t\t\tref="editClientButton"\n\t\t\t@click="showPopup"\n\t\t>\n\t\t\t<Icon :name="IconSet.MORE"/>\n\t\t</Button>\n\t\t<ClientPopup\n\t\t\tv-if="isClientPopupShowed"\n\t\t\t:bind-element="$refs.editClientButton.$el"\n\t\t\t:current-client="currentClient"\n\t\t\t@create="updateClient"\n\t\t\t@close="closePopup"\n\t\t/>\n\t`};const $e={emits:["freeze","unfreeze"],name:"BookingActionsPopupClient",directives:{lazyload:h.lazyload,hint:v.hint},props:{bookingId:{type:[Number,String],required:true}},components:{Button:X.Button,Icon:N.BIcon,Loader:f.Loader,Empty:He,Note:Fe,EditClientButton:Ne},data(){return{ButtonSize:X.ButtonSize,ButtonColor:X.ButtonColor,ButtonIcon:X.ButtonIcon,isLoading:true}},async mounted(){this.isLoading=false},methods:{openClient(){const t=this.client.type.code.toLowerCase();m.SidePanel.Instance.open(`/crm/${t}/details/${this.client.id}/`)}},computed:{booking(){return this.$store.getters["bookings/getById"](this.bookingId)},client(){const t=this.booking.primaryClient;return t?this.$store.getters["clients/getByClientData"](t):null},clientPhone(){const t=this.client;return t.phones.length>0?t.phones[0]:this.loc("BB_ACTIONS_POPUP_CLIENT_PHONE_LABEL")},clientAvatar(){const t=this.client;return t.image},clientStatus(){if(!this.client.isReturning){return this.loc("BB_ACTIONS_POPUP_CLIENT_STATUS_FIRST")}return this.loc("BB_ACTIONS_POPUP_CLIENT_STATUS_RETURNING")},userIcon(){return N.Set.PERSON},personSize(){return 26},callIcon(){return N.Set.TELEPHONY_HANDSET_1},messageIcon(){return N.Set.CHATS_1},iconSize(){return 20},iconColor(){return"var(--ui-color-palette-gray-20)"},imageTypeClass(){return"--user"},soonHint(){return{text:this.loc("BOOKING_BOOKING_SOON_HINT"),popupOptions:{offsetLeft:-60}}}},template:`\n\t\t<div class="booking-actions-popup__item booking-actions-popup__item-client">\n\t\t\t<div class="booking-actions-popup__item-client-client">\n\t\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-client-loader" />\n\t\t\t\t<template v-else-if="client">\n\t\t\t\t\t<div class="booking-actions-popup__item-client-icon-container">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="clientAvatar"\n\t\t\t\t\t\t\tclass="booking-actions-popup-user__avatar"\n\t\t\t\t\t\t\t:class="imageTypeClass"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tv-lazyload :data-lazyload-src="clientAvatar"\n\t\t\t\t\t\t\t\tclass="booking-actions-popup-user__source"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-else class="booking-actions-popup__item-client-icon">\n\t\t\t\t\t\t\t<Icon :name="userIcon" :size="personSize" :color="iconColor"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-actions-popup__item-client-info">\n\t\t\t\t\t\t<div class="booking-actions-popup__item-client-info-label" :title="client.name">\n\t\t\t\t\t\t\t{{ client.name }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t\t\t<div class="booking-actions-popup-item-subtitle">\n\t\t\t\t\t\t\t\t{{ clientStatus }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="booking-actions-popup-item-subtitle">\n\t\t\t\t\t\t\t\t{{ clientPhone }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="booking-actions-popup-item-buttons booking-actions-popup__item-client-info-btn">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tdata-element="booking-menu-client-open"\n\t\t\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t\t\tclass="booking-actions-popup-item-client-open-button"\n\t\t\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_CLIENT_BTN_LABEL')"\n\t\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t\t:color="ButtonColor.LIGHT_BORDER"\n\t\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\t\t@click="openClient"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<EditClientButton\n\t\t\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t\t\t@visible="$emit('freeze')"\n\t\t\t\t\t\t\t\t@invisible="$emit('unfreeze')"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-hint="soonHint" class="booking-actions-popup__item-client-action">\n\t\t\t\t\t\t<Icon :name="callIcon" :size="iconSize" :color="iconColor"/>\n\t\t\t\t\t\t<Icon :name="messageIcon" :size="iconSize" :color="iconColor"/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<Empty\n\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t@popupShown="$emit('freeze')"\n\t\t\t\t\t\t@popupClosed="$emit('unfreeze')"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<Note\n\t\t\t\t:bookingId="bookingId"\n\t\t\t\t@popupShown="$emit('freeze')"\n\t\t\t\t@popupClosed="$emit('unfreeze')"\n\t\t\t/>\n\t\t</div>\n\t`};const Ae={name:"BookingActionsPopupDeal",emits:["freeze","unfreeze"],props:{bookingId:{type:[Number,String],required:true}},components:{Button:X.Button,Icon:N.BIcon,Loader:f.Loader},data(){return{IconSet:N.Set,ButtonSize:X.ButtonSize,ButtonColor:X.ButtonColor,ButtonIcon:X.ButtonIcon,isLoading:false,saveDealDebounce:q.Runtime.debounce(this.saveDeal,10,this)}},mounted(){this.dialog=new R.Dialog({context:"BOOKING",multiple:false,targetNode:this.getDialogButton(),width:340,height:340,enableSearch:true,dropdownMode:true,preselectedItems:this.deal?[[J.EntitySelectorEntity.Deal,this.deal.value]]:[],entities:[{id:J.EntitySelectorEntity.Deal,dynamicLoad:true,dynamicSearch:true}],events:{onShow:this.freeze,onHide:this.unfreeze,"Item:onSelect":this.itemChange,"Item:onDeselect":this.itemChange}});q.Event.bind(document,"scroll",this.adjustPosition,true)},beforeUnmount(){q.Event.unbind(document,"scroll",this.adjustPosition,true)},computed:{...W.mapGetters({isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`}),menuId(){return"booking-actions-popup-deal-menu"},booking(){return this.$store.getters[`${J.Model.Bookings}/getById`](this.bookingId)},deal(){var t,e;return(t=(e=this.booking.externalData)==null?void 0:e.find((t=>t.entityTypeId===J.CrmEntity.Deal)))!=null?t:null},dateFormatted(){if(!this.deal.data.createdTimestamp){return""}const t=K.DateTimeFormat.getFormat("DAY_MONTH_FORMAT");return K.DateTimeFormat.format(t,this.deal.data.createdTimestamp)}},methods:{freeze(){this.$emit("freeze")},unfreeze(){var t,e;if((t=this.dialog)!=null&&t.isOpen()||(e=this.getMenu())!=null&&e.getPopupWindow().isShown()){return}this.$emit("unfreeze")},createDeal(){var t;if(!this.isFeatureEnabled){z.limit.show();return}const e="bookingId";const o=new q.Uri("/crm/deal/details/0/");o.setQueryParam(e,this.bookingId);((t=this.booking.clients)!=null?t:[]).forEach((t=>{const e={[J.CrmEntity.Contact]:"contact_id",[J.CrmEntity.Company]:"company_id"}[t.type.code];o.setQueryParam(e,t.id)}));m.SidePanel.Instance.open(o.toString(),{events:{onLoad:({slider:t})=>{t.getWindow().BX.Event.EventEmitter.subscribe("onCrmEntityCreate",(t=>{const[o]=t.getData();const s=o.entityTypeName===J.CrmEntity.Deal;const i=Number(new q.Uri(o.sliderUrl).getQueryParam(e));if(!s||i!==this.bookingId){return}const n=this.mapEntityInfoToDeal(o.entityInfo);this.saveDealDebounce(n)}))},onClose:()=>{var t;if((t=this.deal)!=null&&t.value){this.saveDealDebounce(this.deal)}}}})},showMenu(){if(!this.isFeatureEnabled){z.limit.show();return}const t=this.$refs.moreButton.$el;F.MenuManager.destroy(this.menuId);F.MenuManager.show({id:this.menuId,bindElement:t,items:this.getMenuItems(),offsetLeft:t.offsetWidth/2,angle:true,events:{onShow:this.freeze,onAfterClose:this.unfreeze,onDestroy:this.unfreeze}})},getMenuItems(){return[{text:this.loc("BB_ACTIONS_POPUP_DEAL_CHANGE"),onclick:()=>{this.showDealDialog();this.getMenu().close()}},{text:this.loc("BB_ACTIONS_POPUP_DEAL_CLEAR"),onclick:()=>{var t;(t=this.dialog)==null?void 0:t.deselectAll();this.saveDealDebounce(null);this.getMenu().close()}}]},showDealDialog(){if(!this.isFeatureEnabled){z.limit.show();return}this.dialog.setTargetNode(this.getDialogButton());this.dialog.show()},adjustPosition(){var t;this.dialog.setTargetNode(this.getDialogButton());this.dialog.adjustPosition();(t=this.getMenu())==null?void 0:t.getPopupWindow().adjustPosition()},getMenu(){return F.MenuManager.getMenuById(this.menuId)},openDeal(){m.SidePanel.Instance.open(`/crm/deal/details/${this.deal.value}/`,{events:{onClose:()=>{var t;if((t=this.deal)!=null&&t.value){void x.bookingService.getById(this.bookingId)}}}})},itemChange(){const t=this.getDealData();this.saveDealDebounce(t);this.dialog.hide()},getDealData(){const t=this.dialog.getSelectedItems()[0];if(!t){return null}return this.mapEntityInfoToDeal(t.getCustomData().get("entityInfo"))},mapEntityInfoToDeal(t){return{moduleId:J.Module.Crm,entityTypeId:t.typeName,value:t.id,data:[]}},saveDeal(t){const e=t?[t]:[];void x.bookingService.update({id:this.booking.id,externalData:e})},getDialogButton(){return this.deal?this.$refs.moreButton.$el:this.$refs.addButton.$el},showHelpDesk(){A.helpDesk.show(J.HelpDesk.BookingActionsDeal.code,J.HelpDesk.BookingActionsDeal.anchorCode)}},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item booking-actions-popup__item-deal-content"\n\t\t\t:class="{ '--active': deal }"\n\t\t>\n\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-deal-loader" />\n\t\t\t<template v-else>\n\t\t\t\t<div class="booking-actions-popup__item-deal">\n\t\t\t\t\t<div class="booking-actions-popup-item-icon">\n\t\t\t\t\t\t<Icon :name="IconSet.DEAL"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t\t<span>{{ loc('BB_ACTIONS_POPUP_DEAL_LABEL') }}</span>\n\t\t\t\t\t\t\t<Icon :name="IconSet.HELP" @click="showHelpDesk" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<template v-if="deal">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="booking-actions-popup__item-deal-profit"\n\t\t\t\t\t\t\t\tdata-element="booking-menu-deal-profit"\n\t\t\t\t\t\t\t\t:data-profit="deal.data.opportunity"\n\t\t\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t\t\tv-html="deal.data.formattedOpportunity"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="booking-actions-popup-item-subtitle"\n\t\t\t\t\t\t\t\tdata-element="booking-menu-deal-ts"\n\t\t\t\t\t\t\t\t:data-ts="deal.data.createdTimestamp * 1000"\n\t\t\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ dateFormatted }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class="booking-actions-popup-item-subtitle">\n\t\t\t\t\t\t\t\t{{ loc('BB_ACTIONS_POPUP_DEAL_ADD_LABEL') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<template v-if="deal">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdata-element="booking-menu-deal-open-button"\n\t\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_DEAL_OPEN')"\n\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\t@click="openDeal"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdata-element="booking-menu-deal-more-button"\n\t\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\tref="moreButton"\n\t\t\t\t\t\t\t@click="showMenu"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Icon :name="IconSet.MORE"/>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdata-element="booking-menu-deal-create-button"\n\t\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t\tclass="booking-actions-popup-plus-button"\n\t\t\t\t\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\t@click="createDeal"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Icon v-if="isFeatureEnabled" :name="IconSet.PLUS_30"/>\n\t\t\t\t\t\t\t<Icon v-else :name="IconSet.LOCK"/>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclass="booking-menu-deal-add-button"\n\t\t\t\t\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\t\t\t\t\tdata-element="booking-menu-deal-add-button"\n\t\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_DEAL_BTN_LABEL')"\n\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\tref="addButton"\n\t\t\t\t\t\t\t@click="showDealDialog"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Icon v-if="!isFeatureEnabled" :name="IconSet.LOCK"/>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const Re={name:"BookingActionsPopupDocument",props:{bookingId:{type:[Number,String],required:true}},components:{Button:X.Button,Icon:N.BIcon,Loader:f.Loader},data(){return{IconSet:N.Set,ButtonSize:X.ButtonSize,ButtonColor:X.ButtonColor,ButtonIcon:X.ButtonIcon,isLoading:true}},async mounted(){await b.bookingActionsService.getDocData();this.isLoading=false},methods:{linkDoc(){}},template:`\n\t\t<div class="booking-actions-popup__item booking-actions-popup__item-doc-content --disabled">\n\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-doc-loader" />\n\t\t\t<template v-else>\n\t\t\t\t<div class="booking-actions-popup__item-doc">\n\t\t\t\t\t<div class="booking-actions-popup-item-icon">\n\t\t\t\t\t\t<Icon :name="IconSet.DOCUMENT"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t\t<span>{{ loc('BB_ACTIONS_POPUP_DOC_LABEL') }}</span>\n\t\t\t\t\t\t\t<Icon :name="IconSet.HELP"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="booking-actions-popup-item-subtitle">\n\t\t\t\t\t\t\t{{ loc('BB_ACTIONS_POPUP_DOC_ADD_LABEL') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclass="booking-actions-popup-plus-button"\n\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t:disabled="true"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon :name="IconSet.PLUS_30"/>\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_DOC_BTN_LABEL')"\n\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t@click="linkDoc"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<div class="booking-booking-actions-popup-label">\n\t\t\t\t{{ loc('BB_ACTIONS_POPUP_LABEL_SOON') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const ze={emits:["freeze","unfreeze"],name:"BookingActionsPopupMessage",props:{bookingId:{type:Number,required:true}},components:{Button:X.Button,Icon:N.BIcon,Loader:f.Loader},data(){return{IconSet:N.Set,ButtonSize:X.ButtonSize,ButtonColor:X.ButtonColor,ButtonIcon:X.ButtonIcon,isLoading:true,isPrimaryClientIdUpdated:false}},mounted(){void this.fetchMessageData()},watch:{clientId(){this.isPrimaryClientIdUpdated=true},updatedAt(){if(this.isPrimaryClientIdUpdated&&this.isCurrentSenderAvailable){void this.fetchMessageData();this.isPrimaryClientIdUpdated=false}}},methods:{openMenu(){var t,e;if(!this.isFeatureEnabled){z.limit.show();return}if(this.status.isDisabled&&this.isCurrentSenderAvailable){return}if((t=this.getMenu())!=null&&(e=t.getPopupWindow())!=null&&e.isShown()){this.destroyMenu();return}const o=this.$refs.button.$el;F.MenuManager.create(this.menuId,o,this.getMenuItems(),{autoHide:true,offsetTop:0,offsetLeft:o.offsetWidth-o.offsetWidth/2,angle:true,events:{onClose:this.destroyMenu,onDestroy:this.destroyMenu}}).show();this.$emit("freeze");q.Event.bind(document,"scroll",this.adjustPosition,{capture:true})},getMenuItems(){return Object.values(this.dictionary).map((({name:t,value:e})=>({text:t,onclick:()=>this.sendMessage(e),disabled:e===this.dictionary.Feedback.value})))},async sendMessage(t){this.destroyMenu();const e=await b.bookingActionsService.sendMessage(this.bookingId,t);if(!e.isSuccess){g.Notifier.notify({id:"booking-message-send-error",text:e.errorText})}void this.fetchMessageData()},destroyMenu(){F.MenuManager.destroy(this.menuId);this.$emit("unfreeze");q.Event.unbind(document,"scroll",this.adjustPosition,{capture:true})},adjustPosition(){var t,e;(t=this.getMenu())==null?void 0:(e=t.getPopupWindow())==null?void 0:e.adjustPosition()},getMenu(){return F.MenuManager.getMenuById(this.menuId)},async fetchMessageData(){this.isLoading=true;await b.bookingActionsService.getMessageData(this.bookingId);this.isLoading=false},showHelpDesk(){A.helpDesk.show(J.HelpDesk.BookingActionsMessage.code,J.HelpDesk.BookingActionsMessage.anchorCode)}},computed:{...W.mapGetters({dictionary:`${J.Model.Dictionary}/getNotifications`,isCurrentSenderAvailable:`${J.Model.Interface}/isCurrentSenderAvailable`,isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`}),menuId(){return`booking-message-menu-${this.bookingId}`},booking(){return this.$store.getters["bookings/getById"](this.bookingId)},client(){const t=this.booking.primaryClient;return t?this.$store.getters["clients/getByClientData"](t):null},clientId(){var t;return(t=this.booking.primaryClient)==null?void 0:t.id},updatedAt(){return this.booking.updatedAt},status(){return this.$store.getters[`${J.Model.MessageStatus}/getById`](this.bookingId)},iconColor(){const t={success:"#ffffff",primary:"#ffffff",failure:"#ffffff"};return t[this.status.semantic]||""},failure(){return this.status.semantic==="failure"}},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item booking-actions-popup__item-message-content"\n\t\t\t:class="{'--disabled': !isCurrentSenderAvailable}"\n\t\t>\n\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-message-loader" />\n\t\t\t<template v-else>\n\t\t\t\t<div\n\t\t\t\t\tclass="booking-actions-popup-item-icon"\n\t\t\t\t\t:class="'--' + status.semantic"\n\t\t\t\t>\n\t\t\t\t\t<Icon\n\t\t\t\t\t\t:name="IconSet.SMS"\n\t\t\t\t\t\t:color="iconColor"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t<span :title="status.title">{{ status.title }}</span>\n\t\t\t\t\t\t<Icon :name="IconSet.HELP" @click="showHelpDesk"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="booking-actions-popup-item-subtitle"\n\t\t\t\t\t\t:class="'--' + status.semantic"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ status.description }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tdata-element="booking-menu-message-button"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\tclass="booking-actions-popup-button-with-chevron"\n\t\t\t\t\t\t:class="{\n\t\t\t\t\t\t\t'--lock': !isFeatureEnabled,\n\t\t\t\t\t\t\t'--disabled': status.isDisabled && isCurrentSenderAvailable\n\t\t\t\t\t\t}"\n\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_MESSAGE_BUTTON_SEND')"\n\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\tref="button"\n\t\t\t\t\t\t@click="openMenu"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon v-if="isFeatureEnabled" :name="IconSet.CHEVRON_DOWN"/>\n\t\t\t\t\t\t<Icon v-else :name="IconSet.LOCK"/>\n\t\t\t\t\t</Button>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="failure"\n\t\t\t\t\t\tclass="booking-actions-popup-item-buttons-counter"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<div\n\t\t\t\tv-if="!isCurrentSenderAvailable"\n\t\t\t\tclass="booking-booking-actions-popup-label"\n\t\t\t>\n\t\t\t\t{{ loc('BB_ACTIONS_POPUP_LABEL_SOON') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const xe={emits:["popupShown","popupClosed"],name:"ConfirmationMenu",props:{bookingId:{type:Number,required:true}},data(){return{IconSet:N.Set,ButtonSize:X.ButtonSize,ButtonColor:X.ButtonColor,ButtonIcon:X.ButtonIcon,menuPopup:null}},computed:{...W.mapGetters({isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`}),popupId(){return`booking-confirmation-menu-${this.bookingId}`},booking(){return this.$store.getters["bookings/getById"](this.bookingId)}},unmounted(){if(this.menuPopup){this.destroy()}},methods:{updateConfirmStatus(t){void x.bookingService.update({id:this.booking.id,isConfirmed:t})},openMenu(){var t,e;if(!this.isFeatureEnabled){z.limit.show();return}if((t=this.menuPopup)!=null&&(e=t.popupWindow)!=null&&e.isShown()){this.destroy();return}const o=this.$refs.button.$el;this.menuPopup=F.MenuManager.create(this.popupId,o,this.getMenuItems(),{className:"booking-confirmation-menu-popup",closeByEsc:true,autoHide:true,offsetTop:0,offsetLeft:o.offsetWidth-o.offsetWidth/2,angle:true,cacheable:true,events:{onClose:()=>this.destroy(),onDestroy:()=>this.unbindScrollEvent()}});this.menuPopup.show();this.bindScrollEvent();this.$emit("popupShown")},getMenuItems(){const t=this.booking.isConfirmed?this.loc("BB_ACTIONS_POPUP_CONFIRMATION_MENU_NOT_CONFIRMED"):this.loc("BB_ACTIONS_POPUP_CONFIRMATION_MENU_CONFIRMED");return[{text:t,onclick:()=>{this.updateConfirmStatus(!this.booking.isConfirmed);this.destroy()}}]},destroy(){F.MenuManager.destroy(this.popupId);this.unbindScrollEvent();this.$emit("popupClosed")},bindScrollEvent(){q.Event.bind(document,"scroll",this.adjustPosition,{capture:true})},unbindScrollEvent(){q.Event.unbind(document,"scroll",this.adjustPosition,{capture:true})},adjustPosition(){var t,e;(t=this.menuPopup)==null?void 0:(e=t.popupWindow)==null?void 0:e.adjustPosition()}},components:{Icon:N.BIcon,Button:X.Button},template:`\n\t\t<Button\n\t\t\tdata-element="booking-menu-confirmation-button"\n\t\t\t:data-booking-id="bookingId"\n\t\t\tclass="booking-actions-popup-button-with-chevron"\n\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t:text="loc('BB_ACTIONS_POPUP_CONFIRMATION_BTN_LABEL')"\n\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t:round="true"\n\t\t\tref="button"\n\t\t\t@click="openMenu"\n\t\t>\n\t\t\t<Icon v-if="isFeatureEnabled" :name="IconSet.CHEVRON_DOWN"/>\n\t\t\t<Icon v-else :name="IconSet.LOCK"/>\n\t\t</Button>\n\t`};const Ge={emits:["freeze","unfreeze"],name:"BookingActionsPopupConfirmation",props:{bookingId:{type:[Number,String],required:true}},components:{Icon:N.BIcon,Loader:f.Loader,ConfirmationMenu:xe},data(){return{IconSet:N.Set,isLoading:true}},async mounted(){this.isLoading=false},methods:{showHelpDesk(){A.helpDesk.show(J.HelpDesk.BookingActionsConfirmation.code,J.HelpDesk.BookingActionsConfirmation.anchorCode)}},computed:{booking(){return this.$store.getters["bookings/getById"](this.bookingId)},iconColor(){var t,e;const o=(t=this.booking.counters.find((t=>t.type==="booking_unconfirmed")))==null?void 0:t.value;const s=(e=this.booking.counters.find((t=>t.type==="booking_delayed")))==null?void 0:e.value;if(this.booking.isConfirmed===false&&!o&&!s){return"#BDC1C6"}return"#ffffff"},stateClass(){var t,e;if(this.booking.isConfirmed){return"--confirmed"}const o=(t=this.booking.counters.find((t=>t.type==="booking_unconfirmed")))==null?void 0:t.value;const s=(e=this.booking.counters.find((t=>t.type==="booking_delayed")))==null?void 0:e.value;if(o){return"--not-confirmed"}if(s){return"--delayed"}return"--awaiting"},stateText(){var t,e;if(this.booking.isConfirmed){return this.loc("BB_ACTIONS_POPUP_CONFIRMATION_CONFIRMED")}const o=(t=this.booking.counters.find((t=>t.type==="booking_unconfirmed")))==null?void 0:t.value;const s=(e=this.booking.counters.find((t=>t.type==="booking_delayed")))==null?void 0:e.value;if(o){return this.loc("BB_ACTIONS_POPUP_CONFIRMATION_NOT_CONFIRMED")}if(s){return this.loc("BB_ACTIONS_POPUP_CONFIRMATION_DELAYED")}return this.loc("BB_ACTIONS_POPUP_CONFIRMATION_AWAITING")},hasBtnCounter(){var t,e;if(this.booking.isConfirmed){return false}const o=(t=this.booking.counters.find((t=>t.type==="booking_unconfirmed")))==null?void 0:t.value;const s=(e=this.booking.counters.find((t=>t.type==="booking_delayed")))==null?void 0:e.value;return Boolean(o||s)}},template:`\n\t\t<div class="booking-actions-popup__item booking-actions-popup__item-confirmation-content">\n\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-confirmation-loader" />\n\t\t\t<template v-else>\n\t\t\t\t<div :class="['booking-actions-popup-item-icon', stateClass]">\n\t\t\t\t\t<Icon :name="IconSet.CHECK" :color="iconColor"/>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t<span>{{ loc('BB_ACTIONS_POPUP_CONFIRMATION_LABEL') }}</span>\n\t\t\t\t\t\t<Icon :name="IconSet.HELP" @click="showHelpDesk" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class="['booking-actions-popup-item-subtitle', stateClass]"\n\t\t\t\t\t\tdata-element="booking-menu-confirmation-status"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t:data-confirmed="booking.isConfirmed"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ stateText }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<ConfirmationMenu\n\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t@popupShown="$emit('freeze')"\n\t\t\t\t\t\t@popupClosed="$emit('unfreeze')"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="hasBtnCounter"\n\t\t\t\t\t\tclass="booking-actions-popup-item-buttons-counter"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const Ke={emits:["popupShown","popupClosed"],name:"VisitMenu",props:{bookingId:{type:Number,required:true}},data(){return{IconSet:N.Set,ButtonSize:X.ButtonSize,ButtonColor:X.ButtonColor,ButtonIcon:X.ButtonIcon,menuPopup:null}},computed:{...W.mapGetters({dictionary:`${J.Model.Dictionary}/getBookingVisitStatuses`,isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`}),popupId(){return`booking-visit-menu-${this.bookingId}`},booking(){return this.$store.getters["bookings/getById"](this.bookingId)}},unmounted(){if(this.menuPopup){this.destroy()}},methods:{updateVisitStatus(t){void x.bookingService.update({id:this.booking.id,visitStatus:t})},openMenu(){var t,e;if(!this.isFeatureEnabled){z.limit.show();return}if((t=this.menuPopup)!=null&&(e=t.popupWindow)!=null&&e.isShown()){this.destroy();return}const o=this.$refs.button.$el;this.menuPopup=F.MenuManager.create(this.popupId,o,this.getMenuItems(),{autoHide:true,offsetTop:0,offsetLeft:o.offsetWidth-o.offsetWidth/2,angle:true,events:{onClose:()=>this.destroy(),onDestroy:()=>this.unbindScrollEvent()}});this.menuPopup.show();this.bindScrollEvent();this.$emit("popupShown")},getMenuItems(){return[{text:this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_UNKNOWN"),onclick:()=>this.setVisitStatus(this.dictionary.Unknown)},{text:this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_VISITED"),onclick:()=>this.setVisitStatus(this.dictionary.Visited)},{text:this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_NOT_VISITED"),onclick:()=>this.setVisitStatus(this.dictionary.NotVisited)}]},setVisitStatus(t){this.updateVisitStatus(t);this.destroy()},destroy(){F.MenuManager.destroy(this.popupId);this.unbindScrollEvent();this.$emit("popupClosed")},bindScrollEvent(){q.Event.bind(document,"scroll",this.adjustPosition,{capture:true})},unbindScrollEvent(){q.Event.unbind(document,"scroll",this.adjustPosition,{capture:true})},adjustPosition(){var t,e;(t=this.menuPopup)==null?void 0:(e=t.popupWindow)==null?void 0:e.adjustPosition()}},components:{Icon:N.BIcon,Button:X.Button},template:`\n\t\t<Button\n\t\t\tdata-element="booking-menu-visit-button"\n\t\t\t:data-booking-id="bookingId"\n\t\t\tclass="booking-actions-popup-button-with-chevron"\n\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t:text="loc('BB_ACTIONS_POPUP_VISIT_BTN_LABEL')"\n\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t:round="true"\n\t\t\tref="button"\n\t\t\t@click="openMenu"\n\t\t>\n\t\t\t<Icon v-if="isFeatureEnabled" :name="IconSet.CHEVRON_DOWN"/>\n\t\t\t<Icon v-else :name="IconSet.LOCK"/>\n\t\t</Button>\n\t`};const Ue={emits:["freeze","unfreeze"],name:"BookingActionsPopupVisit",props:{bookingId:{type:[Number,String],required:true}},components:{Icon:N.BIcon,Loader:f.Loader,VisitMenu:Ke},data(){return{IconSet:N.Set,isLoading:true}},async mounted(){this.isLoading=false},methods:{showHelpDesk(){A.helpDesk.show(J.HelpDesk.BookingActionsVisit.code,J.HelpDesk.BookingActionsVisit.anchorCode)}},computed:{...W.mapGetters({dictionary:`${J.Model.Dictionary}/getBookingVisitStatuses`}),booking(){return this.$store.getters["bookings/getById"](this.bookingId)},getLocVisitStatus(){switch(this.booking.visitStatus){case this.dictionary.Visited:return this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_VISITED");case this.dictionary.NotVisited:return this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_NOT_VISITED");default:return this.booking.clients.length===0?this.loc("BB_ACTIONS_POPUP_VISIT_ADD_LABEL"):this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_UNKNOWN")}},getVisitInfoStyles(){switch(this.booking.visitStatus){case this.dictionary.Visited:return"--visited";case this.dictionary.NotVisited:return"--not-visited";default:return"--unknown"}},cardIconColor(){switch(this.booking.visitStatus){case this.dictionary.NotVisited:case this.dictionary.Visited:return"var(--ui-color-palette-white-base)";default:return"var(--ui-color-palette-gray-20)"}},iconClass(){switch(this.booking.visitStatus){case this.dictionary.Visited:return"--visited";case this.dictionary.NotVisited:return"--not-visited";default:return""}}},template:`\n\t\t<div class="booking-actions-popup__item booking-actions-popup__item-visit-content">\n\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-visit-loader" />\n\t\t\t<template v-else>\n\t\t\t\t<div :class="['booking-actions-popup-item-icon', iconClass]">\n\t\t\t\t\t<Icon :name="IconSet.CUSTOMER_CARD" :color="cardIconColor"/>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t<span>{{ loc('BB_ACTIONS_POPUP_VISIT_LABEL') }}</span>\n\t\t\t\t\t\t<Icon :name="IconSet.HELP" @click="showHelpDesk" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class="['booking-actions-popup-item-subtitle', getVisitInfoStyles]"\n\t\t\t\t\t\tdata-element="booking-menu-visit-status"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t:data-visit-status="booking.visitStatus"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ getLocVisitStatus }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<VisitMenu\n\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t@popupShown="$emit('freeze')"\n\t\t\t\t\t\t@popupClosed="$emit('unfreeze')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const Ve={name:"BookingActionsPopupFullForm",directives:{hint:v.hint},components:{Icon:N.BIcon},computed:{arrowIcon(){return N.Set.CHEVRON_RIGHT},arrowIconSize(){return 12},arrowIconColor(){return"var(--ui-color-palette-gray-40)"},soonHint(){return{text:this.loc("BOOKING_BOOKING_SOON_HINT"),popupOptions:{offsetLeft:60}}}},methods:{click(){}},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item booking-actions-popup__item-full-form-content --disabled"\n\t\t\t@click="click"\n\t\t\tv-hint="soonHint"\n\t\t>\n\t\t\t<div class="booking-actions-popup__item-full-form-label">\n\t\t\t\t{{loc('BB_ACTIONS_POPUP_FULL_FORM_LABEL')}}\n\t\t\t</div>\n\t\t\t<div class="booking-actions-popup__item-full-form-icon">\n\t\t\t\t<Icon :name="arrowIcon" :size="arrowIconSize" :color="arrowIconColor"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Xe={name:"BookingActionsPopupOverbooking",props:{bookingId:{type:[Number,String],required:true}},components:{Icon:N.BIcon},methods:{openOverbooking(){},sendToOverbookingList(){}},computed:{plusIcon(){return N.Set.PLUS_20},plusIconSize(){return 20},plusIconColor(){return"var(--ui-color-palette-gray-20)"}},template:`\n\t\t<div class="booking-actions-popup__item-overbooking-icon">\n\t\t\t<Icon :name="plusIcon" :size="plusIconSize" :color="plusIconColor"/>\n\t\t\t<div class="booking-actions-popup__item-overbooking-label">\n\t\t\t\t{{loc('BB_ACTIONS_POPUP_OVERBOOKING_LABEL')}}\n\t\t\t</div>\n\t\t</div>\n\t`};const je={name:"BookingActionsPopupWaitlist",props:{bookingId:{type:[Number,String],required:true}},components:{Icon:N.BIcon},computed:{clockIcon(){return N.Set.BLACK_CLOCK},clockIconSize(){return 20},clockIconColor(){return"var(--ui-color-palette-gray-20)"}},template:`\n\t\t<div class="booking-actions-popup__item-waitlist-icon --end">\n\t\t\t<Icon :name="clockIcon" :size="clockIconSize" :color="clockIconColor"/>\n\t\t\t<div class="booking-actions-popup__item-waitlist-label">\n\t\t\t\t{{loc('BB_ACTIONS_POPUP_OVERBOOKING_LIST')}}\n\t\t\t</div>\n\t\t</div>\n\t`};const We=5;const qe={name:"BookingActionsPopupRemoveBtn",emits:["close"],props:{bookingId:{type:[Number,String],required:true}},data(){return{secondsLeft:We}},components:{Icon:N.BIcon},methods:{reset(t,e){clearInterval(t);e.close();this.secondsLeft=We},removeBooking(){this.$emit("close");const t=BX.UI.Notification.Center.notify({id:this.balloonId,content:this.balloonTitle,actions:[{title:this.balloonCancelText,events:{click:()=>{this.reset(e,t);void this.$store.dispatch(`${J.Model.Interface}/removeDeletingBooking`,this.bookingId)}}}]});void this.$store.dispatch(`${J.Model.Interface}/addDeletingBooking`,this.bookingId);const e=setInterval((()=>{this.secondsLeft--;if(this.secondsLeft>=1){t.update({content:this.balloonTitle})}else{this.reset(e,t);void x.bookingService.delete(this.bookingId)}}),1e3)}},computed:{balloonId(){return`booking-notify-${this.bookingId}`},balloonCancelText(){return this.loc("BB_BOOKING_REMOVE_BALLOON_CANCEL")},balloonTitle(){return this.loc("BB_BOOKING_REMOVE_BALLOON_TEXT",{"#countdown#":this.secondsLeft})},removeIcon(){return N.Set.TRASH_BIN},removeIconSize(){return 20},removeIconColor(){return"var(--ui-color-palette-gray-20)"}},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item-remove-btn-icon --end"\n\t\t\tdata-element="booking-menu-remove-button"\n\t\t\t:data-booking-id="bookingId"\n\t\t\t@click="removeBooking"\n\t\t>\n\t\t\t<div class="booking-actions-popup__item-overbooking-label">\n\t\t\t\t{{ loc('BB_ACTIONS_POPUP_OVERBOOKING_REMOVE') }}\n\t\t\t</div>\n\t\t\t<Icon :name="removeIcon" :size="removeIconSize" :color="removeIconColor"/>\n\t\t</div>\n\t`};const Ye={name:"BookingActionsPopup",emits:["close"],props:{bindElement:{type:HTMLElement,required:true},bookingId:{type:[Number,String],required:true}},data(){return{soonTmp:false}},beforeCreate(){F.PopupManager.getPopups().filter((t=>/booking-booking-actions-popup/.test(t.getId()))).forEach((t=>t.destroy()))},computed:{popupId(){return`booking-booking-actions-popup-${this.bookingId}`},config(){return{className:"booking-booking-actions-popup",bindElement:this.bindElement,width:325,offsetLeft:this.bindElement.offsetWidth,offsetTop:-200,animation:"fading-slide"}},contentStructure(){return[{id:"client",props:{bookingId:this.bookingId},component:$e},[{id:"deal",props:{bookingId:this.bookingId},component:Ae},{id:"document",props:{bookingId:this.bookingId},component:Re}],{id:"message",props:{bookingId:this.bookingId},component:ze},{id:"confirmation",props:{bookingId:this.bookingId},component:Ge},{id:"visit",props:{bookingId:this.bookingId},component:Ue},{id:"fullForm",props:{bookingId:this.bookingId},component:Ve}]},booking(){return this.$store.getters["bookings/getById"](this.bookingId)}},components:{StickyPopup:k.StickyPopup,PopupMaker:p.PopupMaker,Client:$e,Deal:Ae,Document:Re,Message:ze,Confirmation:Ge,Visit:Ue,FullForm:Ve,Overbooking:Xe,Waitlist:je,RemoveBtn:qe},template:`\n\t\t<StickyPopup\n\t\t\tv-slot="{freeze, unfreeze}"\n\t\t\t:id="popupId"\n\t\t\t:config="config"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<PopupMaker\n\t\t\t\t:contentStructure="contentStructure"\n\t\t\t\t@freeze="freeze"\n\t\t\t\t@unfreeze="unfreeze"\n\t\t\t/>\n\t\t\t<div class="booking-booking-actions-popup-footer">\n\t\t\t\t<template v-if="soonTmp">\n\t\t\t\t\t<Overbooking :bookingId />\n\t\t\t\t\t<Waitlist :bookingId />\n\t\t\t\t</template>\n\t\t\t\t<RemoveBtn :bookingId @close="$emit('close')" />\n\t\t\t</div>\n\t\t</StickyPopup>\n\t`};const Ze={name:"BookingActions",props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true}},data(){return{showPopup:false}},mounted(){if(this.isEditingBookingMode&&this.editingBookingId===this.bookingId){this.showPopup=true}},computed:W.mapGetters({editingBookingId:`${J.Model.Interface}/editingBookingId`,isEditingBookingMode:`${J.Model.Interface}/isEditingBookingMode`}),methods:{clickHandler(){this.showPopup=true}},components:{ActionsPopup:Ye},template:`\n\t\t<div \n\t\t\tref="node"\n\t\t\tclass="booking-booking-booking-actions"\n\t\t\tdata-element="booking-booking-actions-button"\n\t\t\t:data-id="bookingId"\n\t\t\t:data-resource-id="resourceId"\n\t\t\t@click="clickHandler"\n\t\t>\n\t\t\t<div class="booking-booking-booking-actions-inner">\n\t\t\t\t<div class="ui-icon-set --chevron-down"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<ActionsPopup\n\t\t\tv-if="showPopup"\n\t\t\t:bookingId="bookingId"\n\t\t\t:bindElement="this.$refs.node"\n\t\t\t@close="showPopup = false"\n\t\t/>\n\t`};const Qe={props:{bookingId:{type:[Number,String],required:true},bindElement:{type:Function,required:true}},data(){return{isPopupShown:false,isEditMode:false}},computed:{...W.mapGetters({isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`}),booking(){return this.$store.getters["bookings/getById"](this.bookingId)},hasNote(){return Boolean(this.booking.note)}},methods:{showViewPopup(){if(this.isPopupShown||!this.hasNote){return}this.isEditMode=false;this.isPopupShown=true},closeViewPopup(){if(this.isEditMode){return}this.isPopupShown=false},showEditPopup(){this.isEditMode=true;this.isPopupShown=true},closeEditPopup(){if(!this.isEditMode){return}this.isPopupShown=false}},components:{NotePopup:De},template:`\n\t\t<div class="booking-booking-booking-note">\n\t\t\t<div\n\t\t\t\tclass="booking-booking-booking-note-button"\n\t\t\t\t:class="{'--has-note': hasNote}"\n\t\t\t\tdata-element="booking-booking-note-button"\n\t\t\t\t:data-id="bookingId"\n\t\t\t\t@click="showEditPopup"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --note"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<NotePopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:isEditMode="isEditMode && isFeatureEnabled"\n\t\t\t:bookingId="bookingId"\n\t\t\t:bindElement="bindElement"\n\t\t\t@close="closeEditPopup"\n\t\t/>\n\t`};const Je={data(){return{IconSet:N.Set}},computed:{soonHint(){return{text:this.loc("BOOKING_BOOKING_SOON_HINT"),popupOptions:{offsetLeft:-60}}}},directives:{hint:v.hint},components:{Icon:N.BIcon},template:`\n\t\t<div v-hint="soonHint" class="booking-booking-booking-communication">\n\t\t\t<Icon :name="IconSet.TELEPHONY_HANDSET_1"/>\n\t\t\t<Icon :name="IconSet.CHATS_2"/>\n\t\t</div>\n\t`};const to={emits:["close"],props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},bindElement:{type:Function,required:true}},mounted(){this.adjustPosition();setTimeout((()=>this.closePopup()),3e3);q.Event.bind(document,"scroll",this.adjustPosition,true)},beforeUnmount(){q.Event.unbind(document,"scroll",this.adjustPosition,true)},computed:{popupId(){return`booking-booking-disabled-popup-${this.bookingId}-${this.resourceId}`},config(){return{className:"booking-booking-disabled-popup",bindElement:this.bindElement(),width:this.bindElement().offsetWidth,offsetTop:-10,bindOptions:{forceBindPosition:true,position:"top"},autoHide:true,darkMode:true}}},methods:{adjustPosition(){this.$refs.popup.adjustPosition()},closePopup(){this.$emit("close")}},components:{Popup:k.Popup},template:`\n\t\t<Popup\n\t\t\t:id="popupId"\n\t\t\t:config="config"\n\t\t\tref="popup"\n\t\t\t@close="closePopup"\n\t\t>\n\t\t\t<div class="booking-booking-disabled-popup-content">\n\t\t\t\t{{ loc('BOOKING_BOOKING_YOU_CANNOT_EDIT_THIS_BOOKING') }}\n\t\t\t</div>\n\t\t</Popup>\n\t`};const eo=280;const oo={name:"Booking",props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},nowTs:{type:Number,required:true},uiBookings:{type:Array,default:()=>[]}},data(){return{visible:true,isDisabledPopupShown:false}},mounted(){this.updateVisibility();this.updateVisibilityDuringTransition()},computed:{...W.mapGetters({resourcesIds:`${J.Model.Interface}/resourcesIds`,zoom:`${J.Model.Interface}/zoom`,scroll:`${J.Model.Interface}/scroll`,editingBookingId:`${J.Model.Interface}/editingBookingId`,isEditingBookingMode:`${J.Model.Interface}/isEditingBookingMode`}),booking(){return this.$store.getters[`${J.Model.Bookings}/getById`](this.bookingId)},client(){const t=this.booking.primaryClient;return t?this.$store.getters[`${J.Model.Clients}/getByClientData`](t):null},deal(){var t,e;return(t=(e=this.booking.externalData)==null?void 0:e.find((t=>t.entityTypeId===J.CrmEntity.Deal)))!=null?t:null},bookingName(){return this.client?this.client.name:this.booking.name},left(){return Kt.calculateLeft(this.resourceId)},top(){return Kt.calculateTop(this.booking.dateFromTs)},height(){return Kt.calculateHeight(this.booking.dateFromTs,this.booking.dateToTs)},realHeight(){return Kt.calculateRealHeight(this.booking.dateFromTs,this.booking.dateToTs)},disabled(){return this.isEditingBookingMode&&this.editingBookingId!==this.bookingId},counterOptions(){return Object.freeze({color:c.CounterColor.DANGER,size:c.CounterSize.LARGE})},overlappingBookings(){const{dateFromTs:t}=this.booking;const e=this.uiBookings.find((e=>t===e.fromTs));if(!e){return[]}const{fromTs:o,toTs:s}=e;return[...this.uiBookings.filter((t=>o>t.fromTs&&o<t.toTs)),e,...this.uiBookings.filter((t=>s>t.fromTs&&s<t.toTs))]},bookingWidth(){const t=this.overlappingBookings.length;return eo/(t>0?t:1)},bookingOffset(){const t=this.overlappingBookings.findIndex((({id:t})=>t===this.booking.id));return this.bookingWidth*this.zoom*t},shortView(){return this.overlappingBookings.length>1},isExpiredBooking(){return this.booking.dateToTs<this.nowTs}},methods:{updateVisibilityDuringTransition(){var t;(t=this.animation)==null?void 0:t.stop();this.animation=new BX.easing({duration:200,start:{},finish:{},step:this.updateVisibility});this.animation.animate()},updateVisibility(){if(!this.$refs.container){return}const t=this.$refs.container.getBoundingClientRect();this.visible=t.right>0&&t.left<window.innerWidth},getBindElement(){return this.$refs.container},onNoteMouseEnter(){this.showNoteTimeout=setTimeout((()=>this.$refs.note.showViewPopup()),100)},onNoteMouseLeave(){clearTimeout(this.showNoteTimeout);this.$refs.note.closeViewPopup()},onClick(t){if(this.disabled){this.isDisabledPopupShown=true;t.stopPropagation()}}},watch:{scroll(){this.updateVisibility()},zoom(){this.updateVisibility()},resourcesIds(){this.updateVisibilityDuringTransition()}},components:{AddClient:_e,BookingTime:Le,Actions:Ze,Note:Qe,Communication:Je,UiCounter:c.Counter,DisabledPopup:to},template:`\n\t\t<div\n\t\t\tclass="booking-booking-booking"\n\t\t\tdata-element="booking-booking"\n\t\t\t:data-id="bookingId"\n\t\t\t:data-resource-id="resourceId"\n\t\t\t:style="{\n\t\t\t\t'--left': left + bookingOffset + 'px',\n\t\t\t\t'--top': top + 'px',\n\t\t\t\t'--height': height + 'px',\n\t\t\t\t'--width': bookingWidth + 'px',\n\t\t\t}"\n\t\t\t:class="{\n\t\t\t\t'--zoom-is-less-than-08': zoom < 0.8,\n\t\t\t\t'--compact-mode': realHeight < 40 || zoom < 0.8,\n\t\t\t\t'--small': realHeight <= 12.5,\n\t\t\t\t'--short': shortView,\n\t\t\t\t'--disabled': disabled,\n\t\t\t\t'--confirmed': booking.isConfirmed,\n\t\t\t\t'--expired': isExpiredBooking,\n\t\t\t}"\n\t\t\tref="container"\n\t\t\t@click.capture="onClick"\n\t\t>\n\t\t\t<div v-if="visible" class="booking-booking-booking-padding">\n\t\t\t\t<div class="booking-booking-booking-inner">\n\t\t\t\t\t<div class="booking-booking-booking-content">\n\t\t\t\t\t\t<div class="booking-booking-booking-content-row">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-show="!shortView"\n\t\t\t\t\t\t\t\tclass="booking-booking-booking-name-container"\n\t\t\t\t\t\t\t\t@mouseenter="onNoteMouseEnter"\n\t\t\t\t\t\t\t\t@mouseleave="onNoteMouseLeave"\n\t\t\t\t\t\t\t\t@click="$refs.note.showViewPopup()"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="booking-booking-booking-name"\n\t\t\t\t\t\t\t\t\t:title="bookingName"\n\t\t\t\t\t\t\t\t\tdata-element="booking-booking-name"\n\t\t\t\t\t\t\t\t\t:data-id="bookingId"\n\t\t\t\t\t\t\t\t\t:data-resource-id="resourceId"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{ bookingName }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<Note\n\t\t\t\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t\t\t\t:bindElement="getBindElement"\n\t\t\t\t\t\t\t\t\tref="note"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<BookingTime\n\t\t\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t\t\t:resourceId="resourceId"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-if="deal"\n\t\t\t\t\t\t\t\tclass="booking-booking-booking-profit"\n\t\t\t\t\t\t\t\tdata-element="booking-booking-profit"\n\t\t\t\t\t\t\t\t:data-id="bookingId"\n\t\t\t\t\t\t\t\t:data-resource-id="resourceId"\n\t\t\t\t\t\t\t\t:data-profit="deal.data.opportunity"\n\t\t\t\t\t\t\t\tv-html="deal.data.formattedOpportunity"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="booking-booking-booking-content-row --lower">\n\t\t\t\t\t\t\t<BookingTime\n\t\t\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t\t\t:resourceId="resourceId"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Communication v-if="client"/>\n\t\t\t\t\t\t\t<AddClient\n\t\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t\t\t:resourceId="resourceId"\n\t\t\t\t\t\t\t\t:expired="isExpiredBooking"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Actions :bookingId="bookingId" :resourceId="resourceId"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<UiCounter\n\t\t\t\tv-if="booking.counter > 0"\n\t\t\t\t:value="booking.counter"\n\t\t\t\t:color="counterOptions.color"\n\t\t\t\t:size="counterOptions.size"\n\t\t\t\tborder\n\t\t\t\tcounter-class="booking--counter"\n\t\t\t/>\n\t\t\t<DisabledPopup\n\t\t\t\tv-if="isDisabledPopupShown"\n\t\t\t\t:bookingId="bookingId"\n\t\t\t\t:resourceId="resourceId"\n\t\t\t\t:bindElement="() => $refs.container"\n\t\t\t\t@close="isDisabledPopupShown = false"\n\t\t\t/>\n\t\t</div>\n\t`};const so={emits:["close"],props:{busySlot:{type:Object,required:true}},computed:{...W.mapGetters({offset:`${J.Model.Interface}/offset`,mousePosition:`${J.Model.Interface}/mousePosition`}),resource(){const t=this.busySlot.type===J.BusySlot.Intersection?this.busySlot.intersectingResourceId:this.busySlot.resourceId;return this.$store.getters[`${J.Model.Resources}/getById`](t)},popupId(){return`booking-booking-busy-popup-${this.busySlot.resourceId}`},config(){const t=200;const e=F.Popup.getOption("angleMinBottom");const o=t/2-e;return{bindElement:this.mousePosition,width:t,background:"#2878ca",offsetTop:-5,offsetLeft:-o+e,bindOptions:{forceBindPosition:true,position:"top"},angle:{offset:o,position:"bottom"},angleBorderRadius:"4px 0",autoHide:false}},textFormatted(){const t=K.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const e=this.busySlot.type===J.BusySlot.Intersection?"BOOKING_BOOKING_INTERSECTING_RESOURCE_IS_BUSY":"BOOKING_BOOKING_RESOURCE_IS_BUSY";return this.loc(e,{"#RESOURCE#":this.resource.name,"#TIME_FROM#":K.DateTimeFormat.format(t,(this.busySlot.fromTs+this.offset)/1e3),"#TIME_TO#":K.DateTimeFormat.format(t,(this.busySlot.toTs+this.offset)/1e3)})}},methods:{adjustPosition(){var t;const e=(t=this.$refs.popup)==null?void 0:t.getPopupInstance();if(!e){return}e.setBindElement(this.mousePosition);e.adjustPosition()},closePopup(){this.$emit("close")}},watch:{mousePosition:{handler(){this.adjustPosition()},deep:true}},components:{Popup:k.Popup},template:`\n\t\t<Popup\n\t\t\t:id="popupId"\n\t\t\t:config="config"\n\t\t\tref="popup"\n\t\t\t@close="closePopup"\n\t\t>\n\t\t\t<div class="booking-booking-busy-popup">\n\t\t\t\t{{ textFormatted }}\n\t\t\t</div>\n\t\t</Popup>\n\t`};const{mapGetters:io}=W.createNamespacedHelpers(J.Model.Interface);const no="booking-booking-busy-slot";const ro={name:"BusySlot",props:{busySlot:{type:Object,required:true}},setup(){return{BookingBusySlotClassName:no}},data(){return{isPopupShown:false}},computed:{...io({disabledBusySlots:"disabledBusySlots",isFilterMode:"isFilterMode",isEditingBookingMode:"isEditingBookingMode"}),isDisabled(){if(this.isFilterMode){return true}return this.busySlot.id in this.disabledBusySlots},left(){return Kt.calculateLeft(this.busySlot.resourceId)},top(){return Kt.calculateTop(this.busySlot.fromTs)},height(){return Kt.calculateHeight(this.busySlot.fromTs,this.busySlot.toTs)}},methods:{onClick(){if(this.isFilterMode||this.isEditingBookingMode||this.busySlot.type===J.BusySlot.Intersection){return}void this.$store.dispatch(`${J.Model.Interface}/addDisabledBusySlot`,this.busySlot)},onMouseEnter(){clearTimeout(this.showTimeout);this.showTimeout=setTimeout((()=>this.showPopup()),300);q.Event.unbind(document,"mousemove",this.onMouseMove);q.Event.bind(document,"mousemove",this.onMouseMove)},onMouseMove(t){if(this.cursorInsideContainer(t.target)){this.updatePopup(t)}else{q.Event.unbind(document,"mousemove",this.onMouseMove);this.closePopup()}},onMouseLeave(t){var e,o;if((e=t.relatedTarget)!=null&&(o=e.closest(".popup-window"))!=null&&o.querySelector(".booking-booking-busy-popup")){return}q.Event.unbind(document,"mousemove",this.onMouseMove);this.closePopup()},cursorInsideContainer(t){return!q.Type.isNull(t)&&q.Dom.hasClass(t,this.BookingBusySlotClassName)},updatePopup(t){var e,o;const s=(e=this.$refs.container)==null?void 0:e.getBoundingClientRect();if(!s||t.clientY>s.top+s.height||t.clientY<s.top||t.clientX<s.left||t.clientX>s.left+s.width){this.closePopup();return}(o=this.showTimeout)!=null?o:this.showTimeout=setTimeout((()=>this.showPopup()),300)},showPopup(){this.isPopupShown=true},closePopup(){clearTimeout(this.showTimeout);this.showTimeout=null;this.isPopupShown=false}},components:{BusyPopup:so},template:`\n\t\t<div\n\t\t\t:class="[BookingBusySlotClassName, {\n\t\t\t\t'--disabled': isDisabled\n\t\t\t}]"\n\t\t\t:style="{\n\t\t\t\t'--left': left + 'px',\n\t\t\t\t'--top': top + 'px',\n\t\t\t\t'--height': height + 'px',\n\t\t\t}"\n\t\t\tdata-element="booking-busy-slot"\n\t\t\t:data-id="busySlot.resourceId"\n\t\t\t:data-from="busySlot.fromTs"\n\t\t\t:data-to="busySlot.toTs"\n\t\t\tref="container"\n\t\t\t@click.stop="onClick"\n\t\t\t@mouseenter.stop="onMouseEnter"\n\t\t\t@mouseleave.stop="onMouseLeave"\n\t\t></div>\n\t\t<BusyPopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:busySlot="busySlot"\n\t\t\t@close="closePopup"\n\t\t/>\n\t`};const ao={props:{cell:{type:Object,required:true}},components:{Icon:N.BIcon},data(){return{IconSet:N.Set}},computed:{...W.mapGetters({selectedCells:`${J.Model.Interface}/selectedCells`,zoom:`${J.Model.Interface}/zoom`,intersections:`${J.Model.Interface}/intersections`,timezone:`${J.Model.Interface}/timezone`,offset:`${J.Model.Interface}/offset`,isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`}),selected(){return this.cell.id in this.selectedCells},hasSelectedCells(){return Object.keys(this.selectedCells).length>0},timeFormatted(){const t=K.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");return this.loc("BOOKING_BOOKING_TIME_RANGE",{"#FROM#":K.DateTimeFormat.format(t,(this.cell.fromTs+this.offset)/1e3),"#TO#":K.DateTimeFormat.format(t,(this.cell.toTs+this.offset)/1e3)})},height(){return Kt.calculateRealHeight(this.cell.fromTs,this.cell.toTs)}},methods:{onCellSelected({target:{checked:t}}){if(!this.isFeatureEnabled){z.limit.show();return}if(t){this.$store.dispatch(`${J.Model.Interface}/addSelectedCell`,this.cell)}else{this.$store.dispatch(`${J.Model.Interface}/removeSelectedCell`,this.cell)}},addBooking(){var t,e;if(!this.isFeatureEnabled){z.limit.show();return}void this.$store.dispatch(`${J.Model.Interface}/setHoveredCell`,null);void x.bookingService.add({id:`tmp-id-${Date.now()}-${Math.random()}`,dateFromTs:this.cell.fromTs,dateToTs:this.cell.toTs,name:this.loc("BOOKING_BOOKING_DEFAULT_BOOKING_NAME"),resourcesIds:[...new Set([this.cell.resourceId,...(t=this.intersections[0])!=null?t:[],...(e=this.intersections[this.cell.resourceId])!=null?e:[]])],timezoneFrom:this.timezone,timezoneTo:this.timezone})}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-base-cell"\n\t\t\t:class="{\n\t\t\t\t'--selected': selected,\n\t\t\t\t'--bounded-to-bottom': cell.boundedToBottom,\n\t\t\t\t'--height-is-less-than-40': height < 40,\n\t\t\t\t'--compact-mode': height < 40 || zoom < 0.8,\n\t\t\t\t'--small': height <= 12.5,\n\t\t\t}"\n\t\t\t:style="{\n\t\t\t\t'--height': height + 'px',\n\t\t\t}"\n\t\t\tdata-element="booking-base-cell"\n\t\t\t:data-resource-id="cell.resourceId"\n\t\t\t:data-from="cell.fromTs"\n\t\t\t:data-to="cell.toTs"\n\t\t\t:data-selected="selected"\n\t\t>\n\t\t\t<div class="booking-booking-grid-cell-padding">\n\t\t\t\t<div class="booking-booking-grid-cell-inner">\n\t\t\t\t\t<label\n\t\t\t\t\t\tclass="booking-booking-grid-cell-time"\n\t\t\t\t\t\tdata-element="booking-grid-cell-select-label"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="booking-booking-grid-cell-time-inner">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclass="booking-booking-grid-cell-checkbox"\n\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\t:checked="selected"\n\t\t\t\t\t\t\t\t@change="onCellSelected"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span data-element="booking-grid-cell-time">\n\t\t\t\t\t\t\t\t{{ timeFormatted }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="!hasSelectedCells"\n\t\t\t\t\t\tclass="booking-booking-grid-cell-select-button-container"\n\t\t\t\t\t\tref="button"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="booking-booking-grid-cell-select-button"\n\t\t\t\t\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\t\t\t\t\tdata-element="booking-grid-cell-add-button"\n\t\t\t\t\t\t\t@click="addBooking"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class="booking-booking-grid-cell-select-button-text">\n\t\t\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_SELECT') }}\n\t\t\t\t\t\t\t\t<Icon v-if="!isFeatureEnabled" :name="IconSet.LOCK" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-icon-set --chevron-right"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const lo={props:{cell:{type:Object,required:true}},computed:{left(){return Kt.calculateLeft(this.cell.resourceId)},top(){return Kt.calculateTop(this.cell.fromTs)},height(){return Kt.calculateHeight(this.cell.fromTs,this.cell.toTs)}},components:{BaseCell:ao},template:`\n\t\t<div\n\t\t\tclass="booking-booking-selected-cell"\n\t\t\t:style="{\n\t\t\t\t'--left': left + 'px',\n\t\t\t\t'--top': top + 'px',\n\t\t\t\t'--height': height + 'px',\n\t\t\t}"\n\t\t\t@mouseleave="$store.dispatch('interface/setHoveredCell', null)"\n\t\t>\n\t\t\t<BaseCell\n\t\t\t\t:cell="cell"\n\t\t\t/>\n\t\t</div>\n\t`};const{mapGetters:co}=W.createNamespacedHelpers(J.Model.Interface);const uo=15*60*1e3;const po={name:"Bookings",data(){return{nowTs:Date.now()}},computed:{...co({resourcesIds:"resourcesIds",selectedDateTs:"selectedDateTs",isFilterMode:"isFilterMode",filteredBookingsIds:"filteredBookingsIds",selectedCells:"selectedCells",hoveredCell:"hoveredCell",busySlots:"busySlots"}),bookingsHash(){return JSON.stringify(this.bookings)},bookings(){const t=this.selectedDateTs;let e=[];if(this.isFilterMode){e=this.$store.getters[`${J.Model.Bookings}/getByDateAndIds`](t,this.filteredBookingsIds)}else{e=this.$store.getters[`${J.Model.Bookings}/getByDateAndResources`](t,this.resourcesIds)}return e.flatMap((t=>t.resourcesIds.filter((t=>this.resourcesIds.includes(t))).map((e=>({...t,resourcesIds:[e]})))))},cells(){const t=[...Object.values(this.selectedCells),this.hoveredCell];const e=this.selectedDateTs;const o=new Date(e).setDate(new Date(e).getDate()+1);return t.filter((t=>t&&t.toTs>e&&o>t.fromTs))}},mounted(){this.startInterval()},methods:{generateBookingKey(t){return`${t.id}-${t.resourcesIds[0]}`},getUiBookings(t){return this.bookings.filter((e=>{var o;return((o=e.resourcesIds)==null?void 0:o[0])===t})).map((t=>{const e=t.dateToTs-t.dateFromTs;return{id:t.id,fromTs:t.dateFromTs,toTs:e<uo?t.dateFromTs+uo:t.dateToTs}}))},startInterval(){setInterval((()=>{this.nowTs=Date.now()}),5*1e3)}},watch:{selectedDateTs(){void Oe.loadBusySlots()},bookingsHash(){void Oe.loadBusySlots()},resourcesIds(){void Oe.loadBusySlots()}},components:{Booking:oo,BusySlot:ro,Cell:lo},template:`\n\t\t<div class="booking-booking-bookings">\n\t\t\t<TransitionGroup name="booking-transition-booking">\n\t\t\t\t<template v-for="booking of bookings" :key="generateBookingKey(booking)">\n\t\t\t\t\t<Booking\n\t\t\t\t\t\t:bookingId="booking.id"\n\t\t\t\t\t\t:resourceId="booking.resourcesIds[0]"\n\t\t\t\t\t\t:nowTs\n\t\t\t\t\t\t:uiBookings="getUiBookings(booking.resourcesIds[0])"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</TransitionGroup>\n\t\t\t<template v-for="busySlot of busySlots" :key="busySlot.id">\n\t\t\t\t<BusySlot\n\t\t\t\t\t:busySlot="busySlot"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template v-for="cell of cells" :key="cell.id">\n\t\t\t\t<Cell\n\t\t\t\t\t:cell="cell"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</div>\n\t`};const ho=30*60*1e3;const mo={name:"Cell",props:{cell:{type:Object,required:true}},data(){return{hovered:false,halfOffset:0}},computed:{...W.mapGetters({zoom:`${J.Model.Interface}/zoom`,disabledBusySlots:`${J.Model.Interface}/disabledBusySlots`,selectedCells:`${J.Model.Interface}/selectedCells`,bookings:`${J.Model.Bookings}/get`,isFilterMode:`${J.Model.Interface}/isFilterMode`,isEditingBookingMode:`${J.Model.Interface}/isEditingBookingMode`,busySlots:`${J.Model.Interface}/busySlots`}),activeBusySlots(){return this.busySlots.filter((({id:t})=>!(t in this.disabledBusySlots)))},isAvailable(){if(this.isFilterMode||this.isEditingBookingMode){return false}const{fromTs:t,toTs:e}=this.freeSpace;const o=this.cell.fromTs;const s=this.cell.fromTs+ho;return(e>o||e>s)&&e-t>=this.duration},timeFormatted(){const t=K.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");return this.loc("BOOKING_BOOKING_TIME_RANGE",{"#FROM#":K.DateTimeFormat.format(t,this.fromTs/1e3),"#TO#":K.DateTimeFormat.format(t,this.toTs/1e3)})},fromTs(){return Math.min(this.freeSpace.toTs-this.duration,this.cell.fromTs)+this.halfOffset},toTs(){return this.fromTs+this.duration},duration(){return this.cell.toTs-this.cell.fromTs},freeSpace(){let t=0;let e=Infinity;for(const{fromTs:o,toTs:s}of this.colliding){if(this.cell.fromTs+ho>o&&this.cell.fromTs+ho<s){t=s;e=o;break}if(s<=this.cell.fromTs+ho){t=Math.max(t,s)}if(o>=this.cell.fromTs+ho){e=Math.min(e,o)}}return{fromTs:t,toTs:e}},colliding(){return[...this.bookings.filter((t=>t.resourcesIds.includes(this.cell.resourceId))).map((({dateFromTs:t,dateToTs:e})=>({fromTs:t,toTs:e}))),...this.activeBusySlots.filter((t=>t.resourceId===this.cell.resourceId)).map((({fromTs:t,toTs:e})=>({fromTs:t,toTs:e}))),...Object.values(this.selectedCells).filter((t=>t.resourceId===this.cell.resourceId)).map((({fromTs:t,toTs:e})=>({fromTs:t,toTs:e})))]}},methods:{mouseEnterHandler(t){this.updateHalfHour(t)},mouseLeaveHandler(t){var e,o;const s=(e=t.relatedTarget)==null?void 0:e.closest(".booking-booking-base-cell");if(!s||(s==null?void 0:(o=s.dataset)==null?void 0:o.selected)==="true"){void this.$store.dispatch(`${J.Model.Interface}/setHoveredCell`,null)}},mouseMoveHandler(t){this.updateHalfHour(t)},updateHalfHour(t){var e;if((e=this.$refs.button)!=null&&e.contains(t.target)){return}const o=t.clientY-window.scrollY;const s=this.$el.getBoundingClientRect();const i=o>(s.top+s.top+s.height)/2;const n=this.fromTs-this.halfOffset>=this.freeSpace.fromTs;const r=this.toTs-this.halfOffset+ho<=this.freeSpace.toTs;if(i&&r||!i&&!n){this.halfOffset=ho}if(!i&&n||i&&!r){this.halfOffset=0}const a=i&&this.halfOffset===0||!i&&this.halfOffset!==0;if(this.duration<=ho&&a){this.clearCell(t);return}this.hoverCell({id:`${this.cell.resourceId}-${this.fromTs}-${this.toTs}`,fromTs:this.fromTs,toTs:this.toTs,resourceId:this.cell.resourceId,boundedToBottom:this.toTs===this.freeSpace.toTs})},clearCell(t){var e,o;const s=(e=t.relatedTarget)==null?void 0:e.closest(".booking-booking-base-cell");if(!s||(s==null?void 0:(o=s.dataset)==null?void 0:o.selected)==="true"){void this.$store.dispatch(`${J.Model.Interface}/setHoveredCell`,null)}},hoverCell(t){void this.$store.dispatch(`${J.Model.Interface}/setHoveredCell`,null);if(this.isAvailable){void this.$store.dispatch(`${J.Model.Interface}/setHoveredCell`,t)}}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-grid-cell"\n\t\t\tdata-element="booking-grid-cell"\n\t\t\t:data-resource-id="cell.resourceId"\n\t\t\t:data-from="cell.fromTs"\n\t\t\t:data-to="cell.toTs"\n\t\t\t@mouseenter="mouseEnterHandler"\n\t\t\t@mouseleave="mouseLeaveHandler"\n\t\t\t@mousemove="mouseMoveHandler"\n\t\t>\n\t\t</div>\n\t`};const go={props:{bottom:{type:Boolean,default:false}},computed:W.mapGetters({offHoursHover:`${J.Model.Interface}/offHoursHover`,offHoursExpanded:`${J.Model.Interface}/offHoursExpanded`}),methods:{animateOffHours({keepScroll:t}){if(this.offHoursExpanded){ft.collapse()}else{ft.expand({keepScroll:t})}void this.$store.dispatch(`${J.Model.Interface}/setOffHoursExpanded`,!this.offHoursExpanded)}},template:`\n\t\t<div class="booking-booking-grid-padding">\n\t\t\t<div\n\t\t\t\tclass="booking-booking-column-off-hours"\n\t\t\t\t:class="{'--bottom': bottom, '--hover': offHoursHover}"\n\t\t\t\t@click="animateOffHours({ keepScroll: bottom })"\n\t\t\t\t@mouseenter="$store.dispatch('interface/setOffHoursHover', true)"\n\t\t\t\t@mouseleave="$store.dispatch('interface/setOffHoursHover', false)"\n\t\t\t></div>\n\t\t</div>\n\t`};const{mapGetters:bo}=W.createNamespacedHelpers(J.Model.Interface);const fo={props:{resourceId:Number},data(){return{visible:true}},mounted(){this.updateVisibility();this.updateVisibilityDuringTransition()},computed:{...bo({resourcesIds:"resourcesIds",zoom:"zoom",scroll:"scroll",selectedDateTs:"selectedDateTs",offHoursHover:"offHoursHover",offHoursExpanded:"offHoursExpanded",fromHour:"fromHour",toHour:"toHour",offset:"offset"}),resource(){return this.$store.getters["resources/getById"](this.resourceId)},fromMinutes(){return this.fromHour*60},toMinutes(){return this.toHour*60},slotSize(){var t,e;return(t=(e=this.resource.slotRanges[0])==null?void 0:e.slotSize)!=null?t:60},offHoursTopCells(){return this.cells.filter((t=>t.minutes<this.fromMinutes))},workTimeCells(){return this.cells.filter((t=>t.minutes>=this.fromMinutes&&t.minutes<this.toMinutes))},offHoursBottomCells(){return this.cells.filter((t=>t.minutes>=this.toMinutes))},cells(){const t=3600*1e3;const e=this.selectedDateTs;const o=new Date(e).setDate(new Date(e).getDate()+1);return B.range(e,o-t,t).map((t=>{const e=t+this.slotSize*60*1e3;return{id:`${this.resource.id}-${t}-${e}`,fromTs:t,toTs:e,minutes:new Date(t+this.offset).getHours()*60,resourceId:this.resource.id}}))}},methods:{updateVisibilityDuringTransition(){var t;(t=this.animation)==null?void 0:t.stop();this.animation=new BX.easing({duration:200,start:{},finish:{},step:this.updateVisibility});this.animation.animate()},updateVisibility(){const t=this.$el.getBoundingClientRect();this.visible=t.right>0&&t.left<window.innerWidth}},watch:{scroll(){this.updateVisibility()},zoom(){this.updateVisibility()},resourcesIds(){this.updateVisibilityDuringTransition()}},components:{Cell:mo,OffHours:go},template:`\n\t\t<div\n\t\t\tclass="booking-booking-grid-column"\n\t\t\tdata-element="booking-grid-column"\n\t\t\t:data-id="resourceId"\n\t\t>\n\t\t\t<template v-if="visible">\n\t\t\t\t<OffHours/>\n\t\t\t\t<div class="booking-booking-grid-off-hours-cells">\n\t\t\t\t\t<Cell v-for="cell of offHoursTopCells" :key="cell.id" :cell="cell"/>\n\t\t\t\t</div>\n\t\t\t\t<Cell v-for="cell of workTimeCells" :key="cell.id" :cell="cell"/>\n\t\t\t\t<div class="booking-booking-grid-off-hours-cells --bottom">\n\t\t\t\t\t<Cell v-for="cell of offHoursBottomCells" :key="cell.id" :cell="cell"/>\n\t\t\t\t</div>\n\t\t\t\t<OffHours :bottom="true"/>\n\t\t\t</template>\n\t\t</div>\n\t`};let vo=t=>t,Io;const ko=200;const Bo="ui-counter-panel__scope";const yo="bitrix24-dark-theme";var To=babelHelpers.classPrivateFieldLooseKey("slider");var Po=babelHelpers.classPrivateFieldLooseKey("label");var So=babelHelpers.classPrivateFieldLooseKey("overlay");var Eo=babelHelpers.classPrivateFieldLooseKey("handleSliderClose");var Co=babelHelpers.classPrivateFieldLooseKey("renderLabel");var Mo=babelHelpers.classPrivateFieldLooseKey("renderOverlay");var Oo=babelHelpers.classPrivateFieldLooseKey("appContainer");var _o=babelHelpers.classPrivateFieldLooseKey("appHeader");var wo=babelHelpers.classPrivateFieldLooseKey("counterPanel");var Lo=babelHelpers.classPrivateFieldLooseKey("appContent");var Do=babelHelpers.classPrivateFieldLooseKey("appContentPaddingBottomElement");var Fo=babelHelpers.classPrivateFieldLooseKey("imBar");var Ho=babelHelpers.classPrivateFieldLooseKey("imBarWidth");var No=babelHelpers.classPrivateFieldLooseKey("isExpanded");var $o=babelHelpers.classPrivateFieldLooseKey("getInset");var Ao=babelHelpers.classPrivateFieldLooseKey("animate");var Ro=babelHelpers.classPrivateFieldLooseKey("applyMaximizedStyles");var zo=babelHelpers.classPrivateFieldLooseKey("applyMinimizedStyles");class xo{constructor({onOverlayClick:t}){Object.defineProperty(this,zo,{value:os});Object.defineProperty(this,Ro,{value:es});Object.defineProperty(this,Ao,{value:ts});Object.defineProperty(this,$o,{value:Jo});Object.defineProperty(this,No,{get:Qo,set:void 0});Object.defineProperty(this,Ho,{get:Zo,set:void 0});Object.defineProperty(this,Fo,{get:Yo,set:void 0});Object.defineProperty(this,Do,{get:qo,set:void 0});Object.defineProperty(this,Lo,{get:Wo,set:void 0});Object.defineProperty(this,wo,{get:jo,set:void 0});Object.defineProperty(this,_o,{get:Xo,set:void 0});Object.defineProperty(this,Oo,{get:Vo,set:void 0});Object.defineProperty(this,Mo,{value:Uo});Object.defineProperty(this,Co,{value:Ko});Object.defineProperty(this,Eo,{value:Go});Object.defineProperty(this,To,{writable:true,value:void 0});Object.defineProperty(this,Po,{writable:true,value:void 0});Object.defineProperty(this,So,{writable:true,value:void 0});this.onOverlayClick=t;babelHelpers.classPrivateFieldLooseBase(this,To)[To]=new(BX.SidePanel.Manager.getSliderClass())("");babelHelpers.classPrivateFieldLooseBase(this,Po)[Po]=babelHelpers.classPrivateFieldLooseBase(this,Co)[Co](babelHelpers.classPrivateFieldLooseBase(this,To)[To]);babelHelpers.classPrivateFieldLooseBase(this,So)[So]=babelHelpers.classPrivateFieldLooseBase(this,Mo)[Mo](babelHelpers.classPrivateFieldLooseBase(this,Po)[Po]);if(top.BX){this.handleSliderClose=babelHelpers.classPrivateFieldLooseBase(this,Eo)[Eo].bind(this);top.BX.Event.EventEmitter.subscribe("SidePanel.Slider:onCloseComplete",this.handleSliderClose);top.BX.Event.EventEmitter.subscribe("SidePanel.Slider:onDestroy",this.handleSliderClose)}}async maximize(){await y.Core.getStore().dispatch(`${J.Model.Interface}/setExpanded`,true);babelHelpers.classPrivateFieldLooseBase(this,To)[To].applyHacks();BX.SidePanel.Instance.disablePageScrollbar();const t=babelHelpers.classPrivateFieldLooseBase(this,$o)[$o](babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo]);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],"position","fixed");q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],"inset",`0 0 0 ${babelHelpers.classPrivateFieldLooseBase(this,Ho)[Ho]}px`);const e=babelHelpers.classPrivateFieldLooseBase(this,$o)[$o](babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo]);babelHelpers.classPrivateFieldLooseBase(this,Ro)[Ro]();q.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,So)[So],"--closing");q.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,So)[So],"--opening");q.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,So)[So],document.body);await babelHelpers.classPrivateFieldLooseBase(this,Ao)[Ao](t,e)}async minimize(){await y.Core.getStore().dispatch(`${J.Model.Interface}/setExpanded`,false);babelHelpers.classPrivateFieldLooseBase(this,To)[To].resetHacks();BX.SidePanel.Instance.enablePageScrollbar();const t=babelHelpers.classPrivateFieldLooseBase(this,$o)[$o](babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo]);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],"position",null);const e=babelHelpers.classPrivateFieldLooseBase(this,$o)[$o](babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo]);babelHelpers.classPrivateFieldLooseBase(this,zo)[zo]();q.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,So)[So],"--opening");q.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,So)[So],"--closing");q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],"position","fixed");await babelHelpers.classPrivateFieldLooseBase(this,Ao)[Ao](t,e);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],"position",null);q.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,So)[So])}}function Go(){if(babelHelpers.classPrivateFieldLooseBase(this,No)[No]){babelHelpers.classPrivateFieldLooseBase(this,To)[To].applyHacks();BX.SidePanel.Instance.disablePageScrollbar()}}function Ko(t){t.getLabel().setOnclick(this.onOverlayClick);q.Dom.addClass(t.getLabel().getContainer(),"booking-booking-slider-label");return t.getLabel().getContainer()}function Uo(t){return q.Tag.render(Io||(Io=vo`
			<div class="booking-booking-overlay" onclick="${0}">
				${0}
			</div>
		`),this.onOverlayClick,t)}function Vo(){return BX("content-table")}function Xo(){return document.querySelector(".page-header")}function jo(){return y.Core.getParams().counterPanelContainer.firstElementChild}function Wo(){return BX("workarea-content")}function qo(){var t;return(t=BX("workarea"))==null?void 0:t.parentElement}function Yo(){return BX("bx-im-bar")}function Zo(){return window.innerWidth-babelHelpers.classPrivateFieldLooseBase(this,Fo)[Fo].getBoundingClientRect().left}function Qo(){return y.Core.getStore().getters[`${J.Model.Interface}/expanded`]}function Jo(t){const e=t.getBoundingClientRect();return{left:e.left,top:e.top,right:window.innerWidth-(e.left+e.width),bottom:window.innerHeight-(e.top+e.height)}}function ts(t,e){return new Promise((o=>new BX.easing({duration:ko,start:t,finish:e,step:({top:t,right:e,bottom:o,left:s})=>{q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],"inset",`${t}px ${e}px ${o}px ${s}px`);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Po)[Po],"top",`${t}px`);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Po)[Po],"left",`${s}px`)},complete:o}).animate()))}function es(){q.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,wo)[wo],Bo);q.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],yo);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],"height","initial");q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],"position","fixed");q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],"clip-path",`inset(0 ${babelHelpers.classPrivateFieldLooseBase(this,Ho)[Ho]}px 0 0)`);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],"background","var(--ui-color-palette-white-base)");q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,_o)[_o],"border-bottom","1px solid var(--ui-color-base-10)");q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,_o)[_o],"max-width","100%");q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,_o)[_o].parentElement,"padding-right",`${babelHelpers.classPrivateFieldLooseBase(this,Ho)[Ho]}px`);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Lo)[Lo],"margin",0);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Lo)[Lo],"border-radius",0);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Do)[Do],"padding-bottom",0);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Do)[Do],"padding-right",`${babelHelpers.classPrivateFieldLooseBase(this,Ho)[Ho]}px`);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,So)[So],"--right",`${babelHelpers.classPrivateFieldLooseBase(this,Ho)[Ho]}px`);BX.ZIndexManager.register(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],{overlay:babelHelpers.classPrivateFieldLooseBase(this,So)[So]})}function os(){q.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,wo)[wo],Bo);q.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],yo);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],"position",null);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],"clip-path",null);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo],"background",null);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,_o)[_o],"border-bottom",null);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,_o)[_o],"max-width",null);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,_o)[_o].parentElement,"padding-right",null);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Lo)[Lo],"margin",null);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Lo)[Lo],"border-radius",null);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Do)[Do],"padding-bottom",null);q.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Do)[Do],"padding-right",null);BX.ZIndexManager.unregister(babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo])}const ss={props:{getColumnsContainer:Function},data(){return{isSlider:y.Core.getParams().isSlider,maximize:new xo({onOverlayClick:()=>this.collapse()}),desiredZoom:this.$store.getters["interface/zoom"],minZoom:.5,maxZoom:1}},computed:{...W.mapGetters({zoom:"interface/zoom",expanded:"interface/expanded"}),zoomFormatted(){return this.loc("BOOKING_BOOKING_ZOOM_PERCENT",{"#PERCENT#":Math.round(this.zoom*100)})}},methods:{expand(){void this.maximize.maximize()},collapse(){void this.maximize.minimize()},fitToScreen(){const t=260;const e=this.getColumnsContainer();const o=(e.offsetWidth-t)/(e.scrollWidth-t);const s=Math.floor(this.zoom*o*10)/10;this.zoomInto(s)},zoomInto(t){var e;const o="--booking-booking-no-transition";const s=y.Core.getParams().container;const i=400;this.desiredZoom=Math.max(this.minZoom,Math.min(this.maxZoom,t));if(this.zoom===this.desiredZoom){return}(e=this.animation)==null?void 0:e.stop();q.Dom.addClass(s,o);this.animation=new BX.easing({duration:Math.abs(this.zoom-this.desiredZoom)/this.minZoom*i,start:{zoom:this.zoom*100},finish:{zoom:this.desiredZoom*100},step:({zoom:t})=>this.$store.dispatch("interface/setZoom",t/100),complete:()=>q.Dom.removeClass(s,o)});this.animation.animate()},async onMouseDown(t){q.Event.unbind(window,"mouseup",this.onMouseUp);q.Event.bind(window,"mouseup",this.onMouseUp);this.mouseDown=true;await new Promise((t=>setTimeout(t,50)));if(this.mouseDown){clearInterval(this.zoomInterval);this.zoomInterval=setInterval((()=>this.zoomInto(this.desiredZoom+t*.1)),40)}},onMouseUp(){this.mouseDown=false;if(this.desiredZoom>this.zoom){this.desiredZoom=Math.ceil(this.zoom*10)/10}if(this.desiredZoom<this.zoom){this.desiredZoom=Math.floor(this.zoom*10)/10}this.zoomInto(this.desiredZoom);clearInterval(this.zoomInterval);q.Event.unbind(window,"mouseup",this.onMouseUp)},async showAhaMoment(){tt.ahaMoments.setPopupShown(J.AhaMoment.ExpandGrid);await tt.ahaMoments.show({id:"booking-expand-grid",title:this.loc("BOOKING_AHA_EXPAND_GRID_TITLE"),text:this.loc("BOOKING_AHA_EXPAND_GRID_TEXT"),article:J.HelpDesk.AhaExpandGrid,target:this.$refs.expand,top:true});tt.ahaMoments.setShown(J.AhaMoment.ExpandGrid)}},template:`\n\t\t<div class="booking-booking-grid-scale-panel">\n\t\t\t<div v-if="!isSlider" class="booking-booking-grid-scale-panel-full-screen" ref="expand">\n\t\t\t\t<div v-if="expanded" class="ui-icon-set --collapse-diagonal" @click="collapse"></div>\n\t\t\t\t<div v-else class="ui-icon-set --expand-diagonal" @click="expand"></div>\n\t\t\t</div>\n\t\t\t<div class="booking-booking-grid-scale-panel-fit-to-screen">\n\t\t\t\t<div class="booking-booking-grid-scale-panel-fit-to-screen-text" @click="fitToScreen">\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_SHOW_ALL') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="booking-booking-grid-scale-panel-change">\n\t\t\t\t<div\n\t\t\t\t\tclass="ui-icon-set --minus-30"\n\t\t\t\t\t:class="{'--disabled': zoom <= minZoom}"\n\t\t\t\t\t@click="zoomInto(desiredZoom - 0.1)"\n\t\t\t\t\t@mousedown="onMouseDown(-1)"\n\t\t\t\t></div>\n\t\t\t\t<div v-html="zoomFormatted" class="booking-booking-grid-scale-panel-zoom"></div>\n\t\t\t\t<div\n\t\t\t\t\tclass="ui-icon-set --plus-30"\n\t\t\t\t\t:class="{'--disabled': zoom >= maxZoom}"\n\t\t\t\t\t@click="zoomInto(desiredZoom + 0.1)"\n\t\t\t\t\t@mousedown="onMouseDown(1)"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t</div>\n\t`};const{mapGetters:is}=W.createNamespacedHelpers(J.Model.Interface);const ns={data(){return{expanded:true}},created(){this.datePicker=new T.DatePicker({selectedDates:[this.selectedDateTs],inline:true,hideHeader:true});this.setViewDate();this.datePicker.subscribe(T.DatePickerEvent.SELECT,(t=>{const e=t.getData().date;const o=this.createDateFromUtc(e);void this.$store.dispatch(`${J.Model.Interface}/setSelectedDateTs`,o.getTime());this.setViewDate()}))},mounted(){this.datePicker.setTargetNode(this.$refs.datePicker);this.datePicker.show()},beforeUnmount(){this.datePicker.destroy()},computed:{...is({filteredMarks:"filteredMarks",freeMarks:"freeMarks",isFilterMode:"isFilterMode",getCounterMarks:"getCounterMarks",offset:"offset"}),selectedDateTs(){return this.$store.getters[`${J.Model.Interface}/selectedDateTs`]+this.offset},viewDateTs(){return this.$store.getters[`${J.Model.Interface}/viewDateTs`]+this.offset},counterMarks(){if(this.isFilterMode){return this.getCounterMarks(this.filteredMarks)}return this.getCounterMarks()},formattedDate(){const t=this.expanded?this.loc("BOOKING_MONTH_YEAR_FORMAT"):K.DateTimeFormat.getFormat("LONG_DATE_FORMAT");const e=this.expanded?this.viewDateTs/1e3:this.selectedDateTs/1e3;return K.DateTimeFormat.format(t,e)}},methods:{onCollapseClick(){this.expanded=!this.expanded},onPreviousClick(){if(this.expanded){this.previousMonth()}else{this.previousDate()}},onNextClick(){if(this.expanded){this.nextMonth()}else{this.nextDate()}},previousDate(){const t=this.datePicker.getSelectedDate()||this.datePicker.getToday();this.datePicker.selectDate(T.getNextDate(t,"day",-1));this.setViewDate()},nextDate(){const t=this.datePicker.getSelectedDate()||this.datePicker.getToday();this.datePicker.selectDate(T.getNextDate(t,"day"));this.setViewDate()},previousMonth(){const t=this.datePicker.getViewDate();this.datePicker.setViewDate(T.getNextDate(t,"month",-1));this.setViewDate()},nextMonth(){const t=this.datePicker.getViewDate();this.datePicker.setViewDate(T.getNextDate(t,"month"));this.setViewDate()},setViewDate(){const t=this.createDateFromUtc(this.datePicker.getViewDate());const e=t.setDate(1);void this.$store.dispatch(`${J.Model.Interface}/setViewDateTs`,e)},createDateFromUtc(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())},updateMarks(){if(this.isFilterMode){this.setFilterMarks()}else{this.setFreeMarks()}this.setCounterMarks()},setFreeMarks(){const t="rgba(var(--ui-color-background-success-rgb), 0.7)";const e=this.prepareDates(this.freeMarks);this.datePicker.setDayColors([{matcher:e,bgColor:t}])},setFilterMarks(){const t="rgba(var(--ui-color-primary-rgb), 0.20)";const e=this.prepareDates(this.filteredMarks);this.datePicker.setDayColors([{matcher:e,bgColor:t}])},setCounterMarks(){const t=this.prepareDates(this.counterMarks);this.datePicker.setDayMarks([{matcher:t,bgColor:"red"}])},prepareDates(t){return t.map((t=>{const e=K.DateTimeFormat.parse(t,false,J.DateFormat.ServerParse);return this.prepareTimestamp(e.getTime())}))},prepareTimestamp(t){const e=K.DateTimeFormat.getFormat("FORMAT_DATE");return K.DateTimeFormat.format(e,t/1e3)}},watch:{selectedDateTs(t){this.datePicker.selectDate(T.createDate(t));this.updateMarks()},filteredMarks(){this.updateMarks()},freeMarks(){this.updateMarks()},counterMarks(){this.setCounterMarks()},isFilterMode(){this.updateMarks()}},template:`\n\t\t<div class="booking-booking-sidebar-calendar">\n\t\t\t<div class="booking-booking-sidebar-calendar-header">\n\t\t\t\t<div class="booking-booking-sidebar-calendar-button" @click="onPreviousClick">\n\t\t\t\t\t<div class="ui-icon-set --chevron-left"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-booking-sidebar-calendar-title">\n\t\t\t\t\t{{ formattedDate }}\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-booking-sidebar-calendar-button" @click="onNextClick">\n\t\t\t\t\t<div class="ui-icon-set --chevron-right"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-booking-sidebar-calendar-button --collapse" @click="onCollapseClick">\n\t\t\t\t\t<div v-if="expanded" class="ui-icon-set --collapse"></div>\n\t\t\t\t\t<div v-else class="ui-icon-set --expand-1"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="booking-booking-sidebar-calendar-date-picker"\n\t\t\t\t:class="{'--expanded': expanded}"\n\t\t\t\tref="datePicker"\n\t\t\t></div>\n\t\t</div>\n\t`};const rs={components:{Calendar:ns},template:`\n\t\t<div class="booking-booking-sidebar">\n\t\t\t<Calendar/>\n\t\t</div>\n\t`};const as={data(){return{scrolledToBooking:false}},mounted(){this.ears=new G.Ears({container:this.$refs.columnsContainer,smallSize:true,className:"booking-booking-grid-columns-ears"}).init();q.Event.EventEmitter.subscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);q.Event.EventEmitter.subscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment)},computed:{...W.mapGetters({resourcesIds:`${J.Model.Interface}/resourcesIds`,scroll:`${J.Model.Interface}/scroll`,editingBookingId:`${J.Model.Interface}/editingBookingId`}),editingBooking(){var t;return(t=this.$store.getters["bookings/getById"](this.editingBookingId))!=null?t:null}},methods:{updateEars(){this.ears.toggleEars();this.tryShowAhaMoment()},areEarsShown(){const t="ui-ear-show";return q.Dom.hasClass(this.ears.getRightEar(),t)||q.Dom.hasClass(this.ears.getLeftEar(),t)},scrollToEditingBooking(){if(!this.editingBooking||this.scrolledToBooking){return}const t=Kt.calculateTop(this.editingBooking.dateFromTs);const e=Kt.calculateHeight(this.editingBooking.dateFromTs,this.editingBooking.dateToTs);this.$refs.inner.scrollTop=t+e/2+this.$refs.inner.offsetHeight/2;this.scrolledToBooking=true},tryShowAhaMoment(){if(this.areEarsShown()&&tt.ahaMoments.shouldShow(J.AhaMoment.ExpandGrid)){q.Event.EventEmitter.unsubscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);q.Event.EventEmitter.unsubscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment);void this.$refs.scalePanel.showAhaMoment()}}},watch:{scroll(t){this.$refs.columnsContainer.scrollLeft=t},editingBooking(){this.scrollToEditingBooking()}},components:{LeftPanel:Vt,NowLine:Xt,Column:fo,Bookings:po,ScalePanel:ss,Sidebar:rs},template:`\n\t\t<div class="booking-booking-grid">\n\t\t\t<div\n\t\t\t\tid="booking-booking-grid-wrap"\n\t\t\t\tclass="booking-booking-grid-inner --vertical-scroll-bar"\n\t\t\t\tref="inner"\n\t\t\t>\n\t\t\t\t<LeftPanel/>\n\t\t\t\t<NowLine/>\n\t\t\t\t<div\n\t\t\t\t\tclass="booking-booking-grid-columns --horizontal-scroll-bar"\n\t\t\t\t\tref="columnsContainer"\n\t\t\t\t\t@scroll="$store.dispatch('interface/setScroll', $refs.columnsContainer.scrollLeft)"\n\t\t\t\t>\n\t\t\t\t\t<Bookings/>\n\t\t\t\t\t<TransitionGroup name="booking-transition-resource" @after-leave="updateEars" @after-enter="updateEars">\n\t\t\t\t\t\t<template v-for="resourceId of resourcesIds" :key="resourceId">\n\t\t\t\t\t\t\t<Column :resourceId="resourceId"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TransitionGroup>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<ScalePanel\n\t\t\t\t:getColumnsContainer="() => $refs.columnsContainer"\n\t\t\t\tref="scalePanel"\n\t\t\t/>\n\t\t</div>\n\t\t<Sidebar/>\n\t`};const ls=0;const ds=12;const cs="var(--ui-color-primary-alt)";const us="var(--ui-color-background-secondary)";const ps=14;const hs=27;const ms={name:"BatteryIcon",props:{percent:{type:Number,default:0},dataId:{type:[String,Number],default:""},height:{type:Number,default:ps},width:{type:Number,default:hs}},mounted(){this.repaint()},methods:{getCharge(t){if(t<=0){return ls}if(t>=100){return ds}return Math.round(t*ds*.01)},repaint(){var t;const e=((t=this.$refs["icon-battery-charge"])==null?void 0:t.children)||[];const o=this.getCharge(this.percent);let s=1;for(const t of e){t.setAttribute("fill",s>o?us:cs);s++}}},watch:{percent:{handler(){this.repaint()}}},template:`\n\t\t<div :data-id="dataId" :data-percent="percent" data-element="booking-resource-workload-percent">\n\t\t\t<svg id="booking--battery-icon" :width="width" :height="height" viewBox="0 0 27 14" fill="none"\n\t\t\t\t xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<rect width="23.2875" height="13.8" rx="4" fill="white"/>\n\t\t\t\t<rect x="22.6871" y="0.6" width="12.6" height="22.0875" rx="3.4" transform="rotate(90 22.6871 0.6)" stroke="#C9CCD0" stroke-width="1.2"/>\n\t\t\t\t<g ref="icon-battery-charge" id="booking--battery-icon-charge" clip-path="url(#clip0_5003_187951)">\n\t\t\t\t\t<rect x="2.58789" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="4.09766" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="5.60547" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="7.11523" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="8.625" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="10.1328" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="11.6426" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="13.1523" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="14.6621" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="16.1699" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="17.6797" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="19.1895" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t</g>\n\t\t\t\t<g clip-path="url(#clip1_5003_187951)">\n\t\t\t\t\t<ellipse cx="23.102" cy="6.89999" rx="2.9" ry="3.48" transform="rotate(90 23.102 6.89999)" fill="#C9CCD0"/>\n\t\t\t\t</g>\n\t\t\t\t<defs>\n\t\t\t\t\t<clipPath id="clip0_5003_187951">\n\t\t\t\t\t\t<rect x="2.58789" y="2.5875" width="18.1125" height="8.625" rx="1.5" fill="white"/>\n\t\t\t\t\t</clipPath>\n\t\t\t\t\t<clipPath id="clip1_5003_187951">\n\t\t\t\t\t\t<rect width="6.9" height="2.15625" fill="white" transform="translate(26.7383 3.45) rotate(90)"/>\n\t\t\t\t\t</clipPath>\n\t\t\t\t</defs>\n\t\t\t</svg>\n\t\t</div>\n\t`};const gs={emits:["close"],props:{resourceId:{type:Number,required:true},slotsCount:{type:Number,required:true},bookingCount:{type:Number,required:true},workLoadPercent:{type:Number,required:true},bindElement:{type:HTMLElement,required:true}},computed:{popupId(){return"booking-booking-resource-workload-popup"},title(){return this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD_POPUP_TITLE")},rows(){return[{title:this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD_SLOTS_BOOKED"),value:this.slotsBookedFormatted,dataset:{element:"booking-resource-workload-popup-count",resourceId:this.resourceId,bookedCount:this.bookingCount,totalCount:this.slotsCount}},{title:this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD"),value:this.workLoadPercentFormatted,dataset:{element:"booking-resource-workload-popup-percent",resourceId:this.resourceId,percent:this.workLoadPercent}}]},slotsBookedFormatted(){return this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD_BOOKED_FROM_SLOTS_COUNT",{"#BOOKED#":this.bookingCount,"#SLOTS_COUNT#":this.slotsCount})},workLoadPercentFormatted(){return this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD_PERCENT",{"#PERCENT#":this.workLoadPercent})}},components:{StatisticsPopup:S.StatisticsPopup},template:`\n\t\t<StatisticsPopup\n\t\t\t:popupId="popupId"\n\t\t\t:bindElement="bindElement"\n\t\t\t:title="title"\n\t\t\t:rows="rows"\n\t\t\t:dataset="{\n\t\t\t\tid: resourceId,\n\t\t\t\telement: 'booking-resource-workload-popup',\n\t\t\t}"\n\t\t\t@close="$emit('close')"\n\t\t/>\n\t`};const bs={name:"ResourceWorkload",props:{resourceId:{type:Number,required:true},scale:{type:Number,default:1},isGrid:{type:Boolean,default:false}},data(){return{isPopupShown:false}},computed:{...W.mapGetters({selectedDateTs:"interface/selectedDateTs",fromHour:"interface/fromHour",toHour:"interface/toHour"}),workLoadPercent(){if(this.slotsCount===0){return 0}return Math.round(this.bookingCount/this.slotsCount*100)},bookingCount(){return this.bookings.length},slotsCount(){var t;const e=new Date(this.selectedDateTs);const o=J.DateFormat.WeekDays[e.getDay()];const s=Oe.filterSlotRanges(this.resource.slotRanges.filter((t=>t.weekDays.includes(o))));const i=(t=this.resource.slotRanges[0].slotSize)!=null?t:60;return Math.floor(s.reduce(((t,e)=>t+(e.to-e.from)/i),0))},bookings(){const t=this.selectedDateTs;return this.$store.getters[`${J.Model.Bookings}/getByDateAndResources`](t,[this.resourceId])},resource(){return this.$store.getters["resources/getById"](this.resourceId)},batteryIconOptions(){return{height:Math.round(ps*this.scale),width:Math.round(hs*this.scale)}},bookingsCount(){return this.bookings.length}},methods:{onMouseEnter(){this.showTimeout=setTimeout((()=>this.showPopup()),100)},onMouseLeave(){clearTimeout(this.showTimeout);this.closePopup()},showPopup(){this.isPopupShown=true},closePopup(){this.isPopupShown=false},async showAhaMoment(){tt.ahaMoments.setPopupShown(J.AhaMoment.ResourceWorkload);await tt.ahaMoments.show({id:"booking-resource-workload",title:this.loc("BOOKING_AHA_RESOURCE_WORKLOAD_TITLE"),text:this.loc("BOOKING_AHA_RESOURCE_WORKLOAD_TEXT"),article:J.HelpDesk.AhaResourceWorkload,target:this.$refs.container});tt.ahaMoments.setShown(J.AhaMoment.ResourceWorkload)}},watch:{bookingsCount(t,e){if(this.isGrid&&t>e&&tt.ahaMoments.shouldShow(J.AhaMoment.ResourceWorkload)){void this.showAhaMoment()}}},components:{BatteryIcon:ms,WorkloadPopup:gs},template:`\n\t\t<div\n\t\t\tclass="booking-booking-header-resource-workload"\n\t\t\tdata-element="booking-resource-workload"\n\t\t\t:data-id="resourceId"\n\t\t\tref="container"\n\t\t\t@click="showPopup"\n\t\t\t@mouseenter="onMouseEnter"\n\t\t\t@mouseleave="onMouseLeave"\n\t\t>\n\t\t\t<BatteryIcon \n\t\t\t\t:percent="workLoadPercent"\n\t\t\t\t:data-id="resourceId"\n\t\t\t\t:height="batteryIconOptions.height"\n\t\t\t\t:width="batteryIconOptions.width"\n\t\t\t/>\n\t\t</div>\n\t\t<WorkloadPopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:resourceId="resourceId"\n\t\t\t:slotsCount="slotsCount"\n\t\t\t:bookingCount="bookingCount"\n\t\t\t:workLoadPercent="workLoadPercent"\n\t\t\t:bindElement="$refs.container"\n\t\t\t@close="closePopup"\n\t\t/>\n\t`};const fs={name:"ResourceMenu",props:{resourceId:{type:Number,required:true}},data(){return{menuPopup:null}},computed:{...W.mapGetters({favoritesIds:`${J.Model.Favorites}/get`,isEditingBookingMode:`${J.Model.Interface}/isEditingBookingMode`,isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`}),popupId(){return`resource-menu-${this.resourceId||"new"}`}},created(){this.hint=BX.UI.Hint.createInstance({popupParameters:{}})},unmounted(){if(this.menuPopup){this.destroy()}},methods:{openMenu(){var t,e;if((t=this.menuPopup)!=null&&(e=t.popupWindow)!=null&&e.isShown()){this.destroy();return}const o=this.$refs["menu-button"];this.menuPopup=F.MenuManager.create(this.popupId,o,this.getMenuItems(),{className:"booking-resource-menu-popup",closeByEsc:true,autoHide:true,offsetTop:-3,offsetLeft:o.offsetWidth-6,angle:true,cacheable:true,events:{onDestroy:()=>this.unbindScrollEvent()}});this.menuPopup.show();this.bindScrollEvent()},getMenuItems(){return[{html:`<span>${this.loc("BOOKING_RESOURCE_MENU_EDIT_RESOURCE")}</span>`,className:this.isFeatureEnabled?"menu-popup-item menu-popup-no-icon":"menu-popup-item --lock",onclick:async()=>{if(!this.isFeatureEnabled){z.limit.show();return}const t=new _.ResourceCreationWizard;this.editResource(this.resourceId,t);this.destroy()}},{html:`<span>${this.loc("BOOKING_RESOURCE_MENU_HIDE")}</span>`,onclick:async()=>{this.destroy();await this.hideResource(this.resourceId)}},{html:`<span class="alert-text">${this.loc("BOOKING_RESOURCE_MENU_DELETE")}</span>`,onclick:async()=>{this.destroy();await this.deleteResource(this.resourceId)}}]},destroy(){F.MenuManager.destroy(this.popupId);this.unbindScrollEvent()},bindScrollEvent(){q.Event.bind(document,"scroll",this.adjustPosition,{capture:true})},unbindScrollEvent(){q.Event.unbind(document,"scroll",this.adjustPosition,{capture:true})},adjustPosition(){var t,e;(t=this.menuPopup)==null?void 0:(e=t.popupWindow)==null?void 0:e.adjustPosition()},async editResource(t,e){e.open(t)},async hideResource(t){const e=[...this.favoritesIds];const o=this.favoritesIds.indexOf(t);if(o===-1){return}e.splice(o,1);await L.hideResources(e)},async deleteResource(t){const e=await this.confirmDelete(t);if(e){await M.resourceService.delete(t)}},async confirmDelete(t){const e=await M.resourceService.hasBookings(t);return new Promise((t=>{const o=E.MessageBox.create({message:q.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_DELETE"),yesCaption:q.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_DELETE_YES"),modal:true,buttons:E.MessageBoxButtons.YES_CANCEL,onYes:()=>{o.close();t(true)},onCancel:()=>{o.close();t(false)}});if(e){const t=o.getPopupWindow();t.subscribe("onAfterShow",(()=>{const t=o.getYesButton();t.setDisabled(true);q.Event.bind(t.getContainer(),"mouseenter",(()=>{this.hint.show(t.getContainer(),q.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_DELETE_HINT"),true)}));q.Event.bind(t.getContainer(),"mouseleave",(()=>{this.hint.hide(t.getContainer())}))}))}o.show()}))}},template:`\n\t\t<button ref="menu-button" class="ui-icon-set --more" @click="openMenu"></button>\n\t`};const vs={props:{resourceId:{type:Number,required:true}},data(){return{visible:true}},mounted(){this.updateVisibility();this.updateVisibilityDuringTransition()},computed:{...W.mapGetters({resourcesIds:`${J.Model.Interface}/resourcesIds`,zoom:`${J.Model.Interface}/zoom`,scroll:`${J.Model.Interface}/scroll`,selectedDateTs:`${J.Model.Interface}/selectedDateTs`}),resource(){return this.$store.getters[`${J.Model.Resources}/getById`](this.resourceId)},resourceType(){return this.$store.getters[`${J.Model.ResourceTypes}/getById`](this.resource.typeId)},profit(){const t=P.currencyFormat.getBaseCurrencyId();const e=this.bookings.map((({externalData:t})=>{var e;return(e=t==null?void 0:t.find((t=>t.entityTypeId===J.CrmEntity.Deal)))!=null?e:null})).filter((e=>{var o;return(e==null?void 0:(o=e.data)==null?void 0:o.currencyId)===t}));if(e.length===0){return""}const o=[...new Map(e.map((t=>[t.value,t]))).values()];const s=o.reduce(((t,e)=>t+e.data.opportunity),0);return P.currencyFormat.format(t,s)},bookings(){return this.$store.getters[`${J.Model.Bookings}/getByDateAndResources`](this.selectedDateTs,[this.resourceId])}},methods:{updateVisibilityDuringTransition(){var t;(t=this.animation)==null?void 0:t.stop();this.animation=new BX.easing({duration:200,start:{},finish:{},step:this.updateVisibility});this.animation.animate()},updateVisibility(){if(!this.$refs.container){return}const t=this.$refs.container.getBoundingClientRect();this.visible=t.right>0&&t.left<window.innerWidth}},watch:{scroll(){this.updateVisibility()},zoom(){this.updateVisibility()},resourcesIds(){this.updateVisibilityDuringTransition()}},components:{ResourceMenu:fs,ResourceWorkload:bs},template:`\n\t\t<div\n\t\t\tclass="booking-booking-header-resource"\n\t\t\tdata-element="booking-resource"\n\t\t\t:data-id="resourceId"\n\t\t\tref="container"\n\t\t>\n\t\t\t<template v-if="visible">\n\t\t\t\t<ResourceWorkload\n\t\t\t\t\t:resourceId="resourceId"\n\t\t\t\t\t:scale="zoom"\n\t\t\t\t\t:isGrid="true"\n\t\t\t\t/>\n\t\t\t\t<div class="booking-booking-header-resource-title">\n\t\t\t\t\t<div class="booking-booking-header-resource-name" :title="resource.name">\n\t\t\t\t\t\t{{ resource.name }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-booking-header-resource-type" :title="resourceType.name">\n\t\t\t\t\t\t{{ resourceType.name }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-booking-header-resource-profit" v-html="profit"></div>\n\t\t\t\t<div class="booking-booking-header-resource-actions">\n\t\t\t\t\t<ResourceMenu :resource-id/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const Is={data(){return{IconSet:N.Set}},computed:W.mapGetters({isLoaded:`${J.Model.Interface}/isLoaded`,resourcesIds:`${J.Model.Interface}/resourcesIds`,isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`}),methods:{addResource(){if(!this.isFeatureEnabled){z.limit.show();return}(new _.ResourceCreationWizard).open()},async showAhaMoment(){await tt.ahaMoments.show({id:"booking-add-resource",title:this.loc("BOOKING_AHA_ADD_RESOURCES_TITLE"),text:this.loc("BOOKING_AHA_ADD_RESOURCES_TEXT"),article:J.HelpDesk.AhaAddResource,target:this.$refs.button});tt.ahaMoments.setShown(J.AhaMoment.AddResource)}},watch:{isLoaded(){if(tt.ahaMoments.shouldShow(J.AhaMoment.AddResource)){void this.showAhaMoment()}}},components:{Icon:N.BIcon},template:`\n\t\t<div\n\t\t\tclass="booking-booking-header-add-resource"\n\t\t\tref="button"\n\t\t\t@click="addResource"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="booking-booking-header-add-resource-icon"\n\t\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\t>\n\t\t\t\t<Icon v-if="isFeatureEnabled" :name="IconSet.PLUS_20"/>\n\t\t\t\t<Icon v-else :name="IconSet.LOCK" :size="16"/>\n\t\t\t</div>\n\t\t\t<div class="booking-booking-header-add-resource-text">\n\t\t\t\t{{ loc('BOOKING_BOOKING_ADD_RESOURCE') }}\n\t\t\t</div>\n\t\t</div>\n\t`};class ks extends R.BaseHeader{constructor(...t){super(...t);this.getContainer()}render(){return this.options.content}}const Bs={emits:["update:modelValue"],data(){return{selectedTypes:{}}},computed:W.mapGetters({resourceTypes:"resourceTypes/get"}),methods:{selectAll(){Object.keys(this.selectedTypes).forEach((t=>{this.selectedTypes[t]=true}))},deselectAll(){Object.keys(this.selectedTypes).forEach((t=>{this.selectedTypes[t]=false}))}},watch:{resourceTypes(t){t.forEach((t=>{var e,o,s;(s=(e=this.selectedTypes)[o=t.id])!=null?s:e[o]=true}))},selectedTypes:{handler(){this.$emit("update:modelValue",this.selectedTypes)},deep:true}},template:`\n\t\t<div class="booking-booking-resources-dialog-header-types">\n\t\t\t<div class="booking-booking-resources-dialog-header-header">\n\t\t\t\t<div class="booking-booking-resources-dialog-header-title">\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_RESOURCE_TYPES') }}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="booking-booking-resources-dialog-header-button"\n\t\t\t\t\tdata-element="booking-resources-dialog-select-all-types-button"\n\t\t\t\t\t@click="selectAll"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_SELECT_ALL') }}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="booking-booking-resources-dialog-header-button"\n\t\t\t\t\tdata-element="booking-resources-dialog-deselect-all-types-button"\n\t\t\t\t\t@click="deselectAll"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_DESELECT_ALL') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="booking-booking-resources-dialog-header-items">\n\t\t\t\t<template v-for="resourceType of resourceTypes" :key="resourceType.id">\n\t\t\t\t\t<label\n\t\t\t\t\t\tclass="booking-booking-resources-dialog-header-item"\n\t\t\t\t\t\tdata-element="booking-resources-dialog-type"\n\t\t\t\t\t\t:data-id="resourceType.id"\n\t\t\t\t\t\t:data-selected="selectedTypes[resourceType.id]"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclass="booking-booking-resources-dialog-header-item-text"\n\t\t\t\t\t\t\tdata-element="booking-resources-dialog-type-name"\n\t\t\t\t\t\t\t:data-id="resourceType.id"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ resourceType.name }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<input type="checkbox" v-model="selectedTypes[resourceType.id]">\n\t\t\t\t\t</label>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`};const ys={emits:["startResize","endResize"],props:{getNode:{type:Function,required:true}},data(){return{isResized:false,startMouseY:0,startHeight:0}},methods:{startResize(t){this.$emit("startResize");q.Dom.style(document.body,"user-select","none");q.Event.bind(window,"mouseup",this.endResize);q.Event.bind(window,"pointermove",this.resize);this.isResized=true;this.startMouseY=t.clientY;this.startHeight=this.getNode().offsetHeight},resize(t){if(!this.isResized){return}t.preventDefault();const e=110;const o=180;const s=this.startHeight+t.clientY-this.startMouseY;const i=Math.min(o,Math.max(s,e));q.Dom.style(this.getNode(),"max-height",`${i}px`)},endResize(){this.$emit("endResize");q.Dom.style(document.body,"user-select","");q.Event.unbind(window,"mouseup",this.endResize);q.Event.unbind(window,"pointermove",this.resize);this.isResized=false}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-resources-dialog-header-resize"\n\t\t\t@mousedown="startResize"\n\t\t></div>\n\t`};const Ts={emits:["search"],data(){return{searchDebounced:q.Runtime.debounce(this.search,200,this),query:""}},computed:{searchIcon(){return N.Set.SEARCH_2}},methods:{onInput(t){const e=t.target.value;this.query=e;if(q.Type.isStringFilled(e)){this.searchDebounced(e)}else{this.search(e)}},search(t){if(this.query===t){this.$emit("search",t)}}},components:{Icon:N.BIcon},template:`\n\t\t<div class="booking-booking-resources-dialog-header-input-container">\n\t\t\t<input\n\t\t\t\tclass="booking-booking-resources-dialog-header-input"\n\t\t\t\t:placeholder="loc('BOOKING_BOOKING_RESOURCES_DIALOG_SEARCH')"\n\t\t\t\tdata-element="booking-resources-dialog-search-input"\n\t\t\t\t@input="onInput"\n\t\t\t>\n\t\t\t<div class="booking-booking-resources-dialog-header-input-icon">\n\t\t\t\t<Icon :name="searchIcon"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Ps={emits:["update:modelValue","search","startResize","endResize","selectAll","deselectAll"],data(){return{selectedTypes:{}}},computed:W.mapGetters({resources:"resources/get"}),watch:{selectedTypes:{handler(){this.$emit("update:modelValue",this.selectedTypes)},deep:true}},components:{ResourceTypes:Bs,Resize:ys,Search:Ts},template:`\n\t\t<div class="booking-booking-resources-dialog-header" ref="header">\n\t\t\t<ResourceTypes\n\t\t\t\tref="resourceTypes"\n\t\t\t\tv-model="selectedTypes"\n\t\t\t/>\n\t\t\t<Resize\n\t\t\t\t:getNode="() => this.$refs.resourceTypes.$el"\n\t\t\t\t@startResize="$emit('startResize')"\n\t\t\t\t@endResize="$emit('endResize')"\n\t\t\t/>\n\t\t\t<div class="booking-booking-resources-dialog-header-resources">\n\t\t\t\t<div class="booking-booking-resources-dialog-header-header">\n\t\t\t\t\t<div class="booking-booking-resources-dialog-header-title">\n\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_RESOURCES') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="booking-booking-resources-dialog-header-button"\n\t\t\t\t\t\tdata-element="booking-resources-dialog-select-all-button"\n\t\t\t\t\t\t@click="$emit('selectAll')"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_SELECT_ALL') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="booking-booking-resources-dialog-header-button"\n\t\t\t\t\t\tdata-element="booking-resources-dialog-deselect-all-button"\n\t\t\t\t\t\t@click="$emit('deselectAll')"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_DESELECT_ALL') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<Search @search="(query) => this.$emit('search', query)"/>\n\t\t\t</div>\n\t\t</div>\n\t`};class Ss extends R.BaseFooter{constructor(...t){super(...t);this.getContainer()}render(){return this.options.content}}const Es={name:"DialogFooter",emits:["reset"],computed:{buttonSettings(){return Object.freeze({size:X.ButtonSize.SMALL,color:X.ButtonColor.LINK})},buttonLabel(){return this.loc("BOOKING_BOOKING_RESOURCES_DIALOG_RESET")}},components:{UiButton:X.Button},template:`\n\t\t<div class="booking--booking--select-resources-dialog-footer">\n\t\t\t<UiButton\n\t\t\t\t:size="buttonSettings.size"\n\t\t\t\t:color="buttonSettings.color"\n\t\t\t\t:text="buttonLabel"\n\t\t\t\tbutton-class="booking--booking--select-resources-dialog-footer__button"\n\t\t\t\t@click="$emit('reset')"\n\t\t\t/>\n\t\t</div>\n\t`};const Cs={data(){return{dialogFilled:false,query:"",saveItemsDebounce:q.Runtime.debounce(this.saveItems,10,this),workloadRefs:{},selectedTypes:{}}},mounted(){this.dialog=new R.Dialog({context:"BOOKING",targetNode:this.$refs.button,width:340,height:Math.min(window.innerHeight-280,600),offsetLeft:4,dropdownMode:true,preselectedItems:this.favoritesIds.map((t=>[J.EntitySelectorEntity.Resource,t])),items:this.resources.map((t=>this.getItemOptions(t))),entities:[{id:J.EntitySelectorEntity.Resource}],events:{onShow:this.onShow,"Item:onSelect":this.saveItemsDebounce,"Item:onDeselect":this.saveItemsDebounce},header:ks,headerOptions:{content:this.$refs.dialogHeader.$el},footer:Ss,footerOptions:{content:this.$refs.dialogFooter.$el}});q.Event.bind(this.dialog.getRecentTab().getContainer(),"scroll",this.loadOnScroll);q.Event.EventEmitter.subscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);q.Event.EventEmitter.subscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment)},computed:{...W.mapGetters({selectedDateTs:`${J.Model.Interface}/selectedDateTs`,favoritesIds:`${J.Model.Favorites}/get`,resources:`${J.Model.Resources}/get`,isFilterMode:`${J.Model.Interface}/isFilterMode`,isEditingBookingMode:`${J.Model.Interface}/isEditingBookingMode`,isLoaded:`${J.Model.Interface}/isLoaded`,mainResources:`${J.Model.MainResources}/resources`}),mainResourceIds(){return new Set(this.mainResources)},isDefaultState(){return this.mainResourceIds.size===this.favoritesIds.length&&this.favoritesIds.every((t=>this.mainResourceIds.has(t)))}},methods:{showDialog(){this.updateItems();void this.loadMainResources();this.dialog.show()},async onShow(){if(this.dialogFilled){void this.loadOnScroll();return}this.dialogFilled=true;await w.resourceDialogService.fillDialog(this.selectedDateTs/1e3)},async loadOnScroll(){const t=this.dialog.getRecentTab().getContainer();const e=t.scrollTop;const o=t.scrollHeight-t.offsetHeight;if(e+10>=o){const t=D.resourcesDateCache.getIdsByDateTs(this.selectedDateTs/1e3);const e=this.resources.map((t=>t.id));const o=e.filter((e=>!t.includes(e))).slice(0,J.Limit.ResourcesDialog);await w.resourceDialogService.loadByIds(o,this.selectedDateTs/1e3);this.updateItems()}},async loadMainResources(){await w.resourceDialogService.getMainResources()},updateItems(){this.dialog.getItems().forEach((t=>{const e=t.getId();const o=this.workloadRefs[e];const s=this.isItemHidden(e);const i=this.isItemSelected(e);t.getNodes().forEach((t=>{const e=t.getAvatarContainer();q.Dom.style(e,"width","max-content");q.Dom.style(e,"height","max-content");q.Dom.append(o,e)}));t.setHidden(s);if(!t.isSelected()&&i){t.select()}if(t.isSelected()&&!i){t.deselect()}}))},saveItems(){void L.hideResources(this.dialog.getSelectedItems().map((t=>t.id)))},addItems(t){const e=t.reduce(((t,e)=>({...t,[e.id]:this.getItemOptions(e)})),{});Object.values(e).forEach((t=>this.dialog.addItem(t)));const o=this.dialog.getItems().map((t=>t.getId())).filter((t=>e[t]));this.dialog.removeItems();o.forEach((t=>this.dialog.addItem(e[t])));const s=this.dialog.getActiveTab();if(s){s.getContainer().append(s.getRootNode().getChildrenContainer());s.render()}this.updateItems();if(q.Type.isStringFilled(this.query)){void this.search(this.query)}},getItemOptions(t){return{id:t.id,entityId:J.EntitySelectorEntity.Resource,title:t.name,subtitle:this.getResourceType(t.typeId).name,avatarOptions:{bgImage:"none",borderRadius:"0"},tabs:J.EntitySelectorTab.Recent,selected:this.isItemSelected(t.id),hidden:this.isItemHidden(t.id),nodeAttributes:{"data-id":t.id,"data-element":"booking-select-resources-dialog-item"}}},isItemSelected(t){return this.favoritesIds.includes(t)},isItemHidden(t){const e=D.resourcesDateCache.getIdsByDateTs(this.selectedDateTs/1e3);const o=this.getResource(t);const s=e.includes(t)&&o&&this.selectedTypes[o.typeId];return!s},getResource(t){return this.$store.getters["resources/getById"](t)},getResourceType(t){return this.$store.getters["resourceTypes/getById"](t)},async search(t){this.query=t;this.dialog.search(this.query);this.updateItems();this.dialog.getSearchTab().getStub().hide();this.dialog.getSearchTab().getSearchLoader().show();await w.resourceDialogService.doSearch(this.query,this.selectedDateTs/1e3);this.dialog.search(this.query);this.updateItems();this.dialog.getSearchTab().getSearchLoader().hide();if(this.dialog.getSearchTab().isEmptyResult()){this.dialog.getSearchTab().getStub().show()}},startResize(){this.dialog.freeze()},endResize(){setTimeout((()=>this.dialog.unfreeze()))},selectAll(){this.dialog.getItems().forEach((t=>{if(!t.isHidden()){t.select()}}))},deselectAll(){this.dialog.getItems().forEach((t=>{if(!t.isHidden()){t.deselect()}}))},setWorkloadRef(t,e){this.workloadRefs[e]=t},tryShowAhaMoment(){if(tt.ahaMoments.shouldShow(J.AhaMoment.SelectResources)){q.Event.EventEmitter.unsubscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);q.Event.EventEmitter.unsubscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment);void this.showAhaMoment()}},async showAhaMoment(){await tt.ahaMoments.show({id:"booking-select-resources",title:this.loc("BOOKING_AHA_SELECT_RESOURCES_TITLE"),text:this.loc("BOOKING_AHA_SELECT_RESOURCES_TEXT"),article:J.HelpDesk.AhaSelectResources,target:this.$refs.button});tt.ahaMoments.setShown(J.AhaMoment.SelectResources)},reset(){const t=this.mainResourceIds;this.dialog.getItems().forEach((e=>{if(t.has(e.id)){e.select()}else{e.deselect()}}))}},watch:{favoritesIds(){this.updateItems()},resources:{handler(t){setTimeout((()=>this.addItems(t)));w.resourceDialogService.clearMainResourcesCache()},deep:true},selectedTypes:{handler(){this.updateItems()},deep:true},isLoaded(){this.tryShowAhaMoment()}},components:{DialogHeader:Ps,DialogFooter:Es,ResourceWorkload:bs},template:`\n\t\t<div\n\t\t\tclass="booking-booking-select-resources"\n\t\t\t:class="{'--disabled': isFilterMode}"\n\t\t\tdata-element="booking-select-resources"\n\t\t\tref="button"\n\t\t\t@click="showDialog"\n\t\t>\n\t\t\t<div class="ui-icon-set --funnel"></div>\n\t\t</div>\n\t\t<DialogHeader\n\t\t\tref="dialogHeader"\n\t\t\tv-model="selectedTypes"\n\t\t\t@search="search"\n\t\t\t@startResize="startResize"\n\t\t\t@endResize="endResize"\n\t\t\t@selectAll="selectAll"\n\t\t\t@deselectAll="deselectAll"\n\t\t/>\n\t\t<DialogFooter\n\t\t\tv-show="dialogFilled && !isDefaultState"\n\t\t\tref="dialogFooter"\n\t\t\t@reset="reset"\n\t\t/>\n\t\t<div class="booking-booking-select-resources-workload-container">\n\t\t\t<template v-for="resource of resources">\n\t\t\t\t<span class="booking-booking-select-resources-workload" :ref="(el) => setWorkloadRef(el, resource.id)">\n\t\t\t\t\t<ResourceWorkload :resourceId="resource.id"/>\n\t\t\t\t</span>\n\t\t\t</template>\n\t\t</div>\n\t`};const Ms={computed:W.mapGetters({resourcesIds:`${J.Model.Interface}/resourcesIds`,scroll:`${J.Model.Interface}/scroll`,isEditingBookingMode:`${J.Model.Interface}/isEditingBookingMode`}),watch:{scroll(t){this.$refs.inner.scrollLeft=t}},components:{Resource:vs,AddResourceButton:Is,SelectResources:Cs},template:`\n\t\t<div class="booking-booking-header">\n\t\t\t<SelectResources/>\n\t\t\t<div\n\t\t\t\tclass="booking-booking-header-inner"\n\t\t\t\tref="inner"\n\t\t\t\t@scroll="$store.dispatch('interface/setScroll', $refs.inner.scrollLeft)"\n\t\t\t>\n\t\t\t\t<TransitionGroup name="booking-transition-resource">\n\t\t\t\t\t<template v-for="resourceId of resourcesIds" :key="resourceId">\n\t\t\t\t\t\t<Resource :resourceId="resourceId"/>\n\t\t\t\t\t</template>\n\t\t\t\t</TransitionGroup>\n\t\t\t\t<AddResourceButton v-if="!isEditingBookingMode"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Os={emits:["change"],props:{resourceId:{type:Number,required:true}},data(){return{isSelected:false,selectedItems:[]}},mounted(){this.selector=this.createSelector()},unmounted(){this.selector.destroy();this.selector=null},methods:{createSelector(){return new R.Dialog({id:`booking-intersection-selector-resource-${this.resourceId}`,targetNode:this.$refs.intersectionField,width:400,enableSearch:true,dropdownMode:true,context:"bookingResourceIntersection",multiple:true,cacheable:true,showAvatars:false,entities:[{id:J.EntitySelectorEntity.Resource,dynamicLoad:true,dynamicSearch:true}],searchOptions:{allowCreateItem:false,footerOptions:{label:this.loc("BOOKING_BOOKING_ADD_INTERSECTION_DIALOG_SEARCH_FOOTER")}},events:{onHide:this.changeSelected.bind(this)}})},showSelector(){if(this.isFeatureEnabled){this.selector.show()}else{z.limit.show()}},changeSelected(){this.selectedItems=this.selector.getSelectedItems();this.isSelected=this.selectedItems.length>0;const t=this.selectedItems.map((t=>t.id));this.$emit("change",t,this.resourceId)},handleRemove(t){this.selector.getItem([J.EntitySelectorEntity.Resource,t]).deselect();this.changeSelected()}},computed:{...W.mapGetters({isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`,resourcesIds:`${J.Model.Interface}/resourcesIds`,resources:`${J.Model.Resources}/get`}),firstItemTitle(){return this.selectedItems.length>0?this.selectedItems[0].title:""},remainingItemsCount(){return this.selectedItems.length>1?this.selectedItems.length-1:0}},watch:{resourcesIds(t,e){const o=e.filter((e=>!t.includes(e)));const s=t.filter((t=>!e.includes(t)));o.forEach((t=>{const e=this.selector.getItem([J.EntitySelectorEntity.Resource,t]);this.selector.removeItem(e)}));s.forEach((t=>{const e=this.$store.getters[`${J.Model.Resources}/getById`](t);const o=this.$store.getters[`${J.Model.ResourceTypes}/getById`](e.typeId);this.selector.addItem({id:t,entityId:J.EntitySelectorEntity.Resource,title:e.name,subtitle:o.name,tabs:J.EntitySelectorTab.Recent})}));this.changeSelected()},resources:{handler(){this.selector.getItems().forEach((t=>{const e=this.$store.getters[`${J.Model.Resources}/getById`](t.getId());if(!e){return}const o=this.$store.getters[`${J.Model.ResourceTypes}/getById`](e.typeId);t.setTitle(e.name);t.setSubtitle(o.name)}));this.selector.getTagSelector().getTags().forEach((t=>{const e=this.$store.getters[`${J.Model.Resources}/getById`](t.getId());if(!e){return}t.setTitle(e.name);t.render()}));this.selectedItems=this.selector.getSelectedItems()},deep:true}},template:`\n\t\t<div\n\t\t\tref="intersectionField"\n\t\t\tclass="booking-booking-intersections-resource"\n\t\t\t:data-id="'booking-booking-intersections-resource-' + resourceId"\n\t\t>\n\t\t\t<template v-if="isSelected">\n\t\t\t\t<div\n\t\t\t\t\tref="selectorItemContainer"\n\t\t\t\t\tclass="booking-booking-intersections-resource-container"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="selectedItems.length > 0"\n\t\t\t\t\t\tclass="bbi-resource-selector-item bbi-resource-selector-tag"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="bbi-resource-selector-tag-content" :title="firstItemTitle">\n\t\t\t\t\t\t\t<div class="bbi-resource-selector-tag-title">{{ firstItemTitle }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass="bbi-resource-selector-tag-remove"\n\t\t\t\t\t\t\t@click="handleRemove(selectedItems[0].id)"\n\t\t\t\t\t\t\t:data-id="'bbi-resource-selector-tag-remove-' + resourceId"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="remainingItemsCount > 0"\n\t\t\t\t\t\tclass="bbi-resource-selector-item bbi-resource-selector-tag --count"\n\t\t\t\t\t\t@click="showSelector"\n\t\t\t\t\t\t:data-id="'bbi-resource-selector-tag-count-' + resourceId"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="bbi-resource-selector-tag-content">\n\t\t\t\t\t\t\t<div class="bbi-resource-selector-tag-title --count">+{{ remainingItemsCount }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclass="bbi-resource-selector-item bbi-resource-selector-add-button"\n\t\t\t\t\t\t\t@click="showSelector"\n\t\t\t\t\t\t\t:data-id="'bbi-resource-selector-add-button' + resourceId"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="bbi-resource-selector-add-button-caption">\n\t\t\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_INTERSECTION_BUTTON_MORE') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<span\n\t\t\t\t\tref="selectorButton"\n\t\t\t\t\tclass="bbi-resource-selector-item bbi-resource-selector-add-button"\n\t\t\t\t\t@click="showSelector"\n\t\t\t\t\t:data-id="'bbi-resource-selector-add-button' + resourceId"\n\t\t\t\t>\n\t\t\t\t\t<span class="bbi-resource-selector-add-button-caption">\n\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_INTERSECTION_BUTTON') }}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</template>\n\t\t</div>\n\t`};const _s={emits:["change"],created(){this.selector=this.createSelector();if(!this.isFeatureEnabled){this.selector.lock()}},mounted(){this.mountSelector();q.Event.EventEmitter.subscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);q.Event.EventEmitter.subscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment)},beforeUnmount(){this.destroySelector()},computed:W.mapGetters({isEditingBookingMode:`${J.Model.Interface}/isEditingBookingMode`,intersections:`${J.Model.Interface}/intersections`,isLoaded:`${J.Model.Interface}/isLoaded`,resourcesIds:`${J.Model.Interface}/resourcesIds`,isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`,resources:`${J.Model.Resources}/get`}),methods:{createSelector(){return new R.TagSelector({multiple:true,addButtonCaption:this.loc("BOOKING_BOOKING_ADD_INTERSECTION"),showCreateButton:false,dialogOptions:{header:this.loc("BOOKING_BOOKING_ADD_INTERSECTION_DIALOG_HEADER"),context:"bookingResourceIntersection",width:290,height:340,dropdownMode:true,enableSearch:true,cacheable:true,showAvatars:false,entities:[{id:J.EntitySelectorEntity.Resource,dynamicLoad:true,dynamicSearch:true}],searchOptions:{allowCreateItem:false,footerOptions:{label:this.loc("BOOKING_BOOKING_ADD_INTERSECTION_DIALOG_SEARCH_FOOTER")}}},events:{onAfterTagAdd:this.onSelectorChange,onAfterTagRemove:this.onSelectorChange}})},onSelectorChange(){const t=this.selector.getDialog().getSelectedItems().map((({id:t})=>t));this.$emit("change",t)},mountSelector(){this.selector.renderTo(this.$refs.intersectionField)},destroySelector(){this.selector.getDialog().destroy();this.selector=null;this.$refs.intersectionField.innerHTML=""},getResource(t){return this.$store.getters["resources/getById"](t)},getResourceType(t){return this.$store.getters["resourceTypes/getById"](t)},tryShowAhaMoment(){if(tt.ahaMoments.shouldShow(J.AhaMoment.ResourceIntersection)&&this.selector){q.Event.EventEmitter.unsubscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);q.Event.EventEmitter.unsubscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment);void this.showAhaMoment()}},async showAhaMoment(){await tt.ahaMoments.show({id:"booking-resource-intersection",title:this.loc("BOOKING_AHA_RESOURCE_INTERSECTION_TITLE"),text:this.loc("BOOKING_AHA_RESOURCE_INTERSECTION_TEXT"),article:J.HelpDesk.AhaResourceIntersection,target:this.selector.getAddButton()});tt.ahaMoments.setShown(J.AhaMoment.ResourceIntersection)},click(){if(!this.isFeatureEnabled){z.limit.show()}}},watch:{intersections(t){var e;if(!this.isEditingBookingMode){return}const o=(e=t[0])!=null?e:[];o.forEach((t=>{const e=this.getResource(t);this.selector.getDialog().addItem({id:e.id,entityId:J.EntitySelectorEntity.Resource,title:e.name,subtitle:this.getResourceType(e.typeId).name,selected:true})}))},isLoaded(){this.tryShowAhaMoment()},resourcesIds(t,e){const o=e.filter((e=>!t.includes(e)));const s=t.filter((t=>!e.includes(t)));o.forEach((t=>{const e=this.selector.getDialog().getItem([J.EntitySelectorEntity.Resource,t]);this.selector.getDialog().removeItem(e);const o=this.selector.getTags().find((e=>e.getId()===t));o==null?void 0:o.remove()}));s.forEach((t=>{const e=this.$store.getters[`${J.Model.Resources}/getById`](t);const o=this.$store.getters[`${J.Model.ResourceTypes}/getById`](e.typeId);this.selector.getDialog().addItem({id:t,entityId:J.EntitySelectorEntity.Resource,title:e.name,subtitle:o.name,tabs:J.EntitySelectorTab.Recent})}));this.onSelectorChange();this.tryShowAhaMoment()},resources:{handler(){this.selector.getDialog().getItems().forEach((t=>{const e=this.$store.getters[`${J.Model.Resources}/getById`](t.getId());if(!e){return}const o=this.$store.getters[`${J.Model.ResourceTypes}/getById`](e.typeId);t.setTitle(e.name);t.setSubtitle(o.name)}));this.selector.getTags().forEach((t=>{const e=this.$store.getters[`${J.Model.Resources}/getById`](t.getId());if(!e){return}t.setTitle(e.name);t.render()}))},deep:true}},template:`\n\t\t<div\n\t\t\tref="intersectionField"\n\t\t\tclass="booking-booking-intersections-line"\n\t\t\tdata-id="booking-booking-intersections-line"\n\t\t\t@click="click"\n\t\t></div>\n\t`};const ws={components:{Icon:N.BIcon,Multiple:Os,Single:_s},data(){return{IconSet:H.Set,intersectionModeMenuItemId:"booking-intersection-menu-mode"}},mounted(){this.menu=F.MenuManager.create("booking-intersection-menu",this.$refs.intersectionMenu,this.getMenuItems(),{closeByEsc:true,autoHide:true,cacheable:true})},unmounted(){this.menu.destroy();this.menu=null},methods:{showMenu(){if(this.isFeatureEnabled){this.menu.show()}else{z.limit.show()}},getMenuItems(){return[{id:this.intersectionModeMenuItemId,dataset:{id:this.intersectionModeMenuItemId},text:this.loc("BOOKING_BOOKING_INTERSECTION_MENU_ALL"),className:this.isIntersectionForAll?"menu-popup-item menu-popup-item-accept":"menu-popup-item menu-popup-no-icon",onclick:async(t,e)=>{this.menu.close();const o=!this.isIntersectionForAll;await this.$store.dispatch(`${J.Model.Interface}/setIntersectionMode`,o);await $.optionService.setBool(J.Option.IntersectionForAll,o)}},{delimiter:true},{id:"booking-intersection-menu-info",dataset:{id:"booking-intersection-menu-info"},text:this.loc("BOOKING_BOOKING_INTERSECTION_MENU_HOW"),onclick:()=>{A.helpDesk.show(J.HelpDesk.Intersection.code,J.HelpDesk.Intersection.anchorCode)}}]},async showIntersections(t,e=0){const o={...e===0?{}:this.intersections,[e]:t};await this.$store.dispatch(`${J.Model.Interface}/setIntersections`,o);await Oe.loadBusySlots()},toggleMenuItemActivityState(t){q.Dom.toggleClass(t.getContainer(),"menu-popup-item-accept");q.Dom.toggleClass(t.getContainer(),"menu-popup-no-icon")}},watch:{async isIntersectionForAll(){await this.$store.dispatch(`${J.Model.Interface}/setIntersections`,{});await Oe.loadBusySlots();this.toggleMenuItemActivityState(this.menu.getMenuItem(this.intersectionModeMenuItemId))},scroll(t){if(this.$refs.inner){this.$refs.inner.scrollLeft=t}}},computed:{...W.mapGetters({resourcesIds:`${J.Model.Interface}/resourcesIds`,bookings:`${J.Model.Bookings}/get`,isFilterMode:`${J.Model.Interface}/isFilterMode`,isEditingBookingMode:`${J.Model.Interface}/isEditingBookingMode`,intersections:`${J.Model.Interface}/intersections`,isIntersectionForAll:`${J.Model.Interface}/isIntersectionForAll`,scroll:`${J.Model.Interface}/scroll`,isLoaded:`${J.Model.Interface}/isLoaded`,isFeatureEnabled:`${J.Model.Interface}/isFeatureEnabled`}),hasIntersections(){return Object.values(this.intersections).some((t=>t.length>0))},disabled(){return!this.isLoaded||this.isFilterMode||this.isEditingBookingMode}},template:`\n\t\t<div class="booking-booking-intersections" :class="{'--disabled': disabled}">\n\t\t\t<div\n\t\t\t\tref="intersectionMenu"\n\t\t\t\tclass="booking-booking-intersections-left-panel"\n\t\t\t\t:class="{'--active': hasIntersections}"\n\t\t\t\t@click="showMenu"\n\t\t\t\tdata-id="booking-intersections-left-panel-menu"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --double-rhombus"></div>\n\t\t\t\t<div v-if="!isFeatureEnabled" class="booking-lock-icon-container">\n\t\t\t\t\t<Icon :name="IconSet.LOCK" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<template v-if="isIntersectionForAll">\n\t\t\t\t<Single @change="showIntersections"/>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div\n\t\t\t\t\tref="inner"\n\t\t\t\t\tclass="booking-booking-intersections-inner"\n\t\t\t\t\t@scroll="$store.dispatch('interface/setScroll', $refs.inner.scrollLeft)"\n\t\t\t\t>\n\t\t\t\t\t<div class="booking-booking-intersections-row">\n\t\t\t\t\t\t<div class="booking-booking-intersections-row-inner">\n\t\t\t\t\t\t\t<template\n\t\t\t\t\t\t\t\tv-for="resourceId of resourcesIds"\n\t\t\t\t\t\t\t\t:key="resourceId"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Multiple :resourceId="resourceId" @change="showIntersections"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-booking-intersections-inner-blank"></div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const Ls={data(){return{DateTimeFormat:K.DateTimeFormat}},computed:W.mapGetters({fromHour:"interface/fromHour",toHour:"interface/toHour",zoom:"interface/zoom"}),components:{Header:Ms,Intersections:ws,Grid:as},template:`\n\t\t<div\n\t\t\tid="booking-content"\n\t\t\tclass="booking"\n\t\t\t:style="{\n\t\t\t\t'--from-hour': fromHour,\n\t\t\t\t'--to-hour': toHour,\n\t\t\t\t'--zoom': zoom,\n\t\t\t}"\n\t\t\t:class="{\n\t\t\t\t'--zoom-is-less-than-07': zoom < 0.7,\n\t\t\t\t'--zoom-is-less-than-08': zoom < 0.8,\n\t\t\t\t'--am-pm-mode': DateTimeFormat.isAmPmMode(),\n\t\t\t}"\n\t\t>\n\t\t\t<Header/>\n\t\t\t<Intersections/>\n\t\t\t<Grid/>\n\t\t</div>\n\t`};const Ds={name:"BookingMultipleButton",emits:["book"],props:{fetching:Boolean},computed:{text(){return this.loc("BOOKING_MULTI_BUTTON_LABEL")},size(){return X.ButtonSize.SMALL},color(){return X.ButtonColor.SUCCESS}},components:{UiButton:X.Button},template:`\n\t\t<UiButton\n\t\t\t:text\n\t\t\t:size\n\t\t\t:color\n\t\t\t:waiting="fetching"\n\t\t\t@click="$emit('book')"\n\t\t/>\n\t`};const Fs={name:"MultiBookingItem",emits:["remove-selected"],props:{id:{type:String,required:true},fromTs:{type:Number,required:true},toTs:{type:Number,required:true},resourceId:{type:Number,required:true}},computed:{...W.mapGetters({offset:`${J.Model.Interface}/offset`}),label(){return this.loc("BOOKING_MULTI_ITEM_TITLE",{"#DATE#":K.DateTimeFormat.format("d M H:i",(this.fromTs+this.offset)/1e3),"#DURATION#":new U.Duration(this.toTs-this.fromTs).format()})},buttonColor(){return X.ButtonColor.LINK},buttonSize(){return X.ButtonSize.EXTRA_SMALL}},components:{UiButton:X.Button},template:`\n\t\t<div class="booking--multi-booking--book">\n\t\t\t<label>\n\t\t\t\t{{ label }}\n\t\t\t</label>\n\t\t\t<button\n\t\t\t\t:class="[buttonSize, buttonColor, 'ui-btn ui-icon-set --cross-20']"\n\t\t\t\ttype="button"\n\t\t\t\t@click="$emit('remove-selected', this.id)">\n\t\t\t</button>\n\t\t</div>\n\t`};const Hs={name:"MultiBookingItemsList",emits:["remove-selected"],computed:{selectedCells(){return this.$store.getters[`${J.Model.Interface}/selectedCells`]},selectedCellsCount(){return Object.keys(this.selectedCells).length}},mounted(){this.ears=new G.Ears({container:this.$refs.wrapper,smallSize:true,className:"booking--multi-booking--items-ears",noScrollbar:true}).init()},watch:{selectedCellsCount:{handler(){setTimeout((()=>this.ears.toggleEars()),0)}}},components:{MultiBookingItem:Fs},template:`\n\t\t<div class="booking--multi-booking--book-list">\n\t\t\t<div ref="wrapper" class="booking--multi-booking--books-wrapper">\n\t\t\t\t<MultiBookingItem\n\t\t\t\t\tv-for="cell in selectedCells"\n\t\t\t\t\t:key="cell.id"\n\t\t\t\t\t:id="cell.id"\n\t\t\t\t\t:from-ts="cell.fromTs"\n\t\t\t\t\t:to-ts="cell.toTs"\n\t\t\t\t\t:resource-id="cell.resourceId"\n\t\t\t\t\t@remove-selected="$emit('remove-selected', $event)"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Ns={name:"AddClientButton",emits:["update:model-value"],props:{modelValue:{type:Array,required:true}},data(){return{isPopupShown:false}},computed:{...W.mapGetters({getByClientData:`${J.Model.Clients}/getByClientData`}),color(){return X.ButtonColor.LINK},size(){return X.ButtonSize.EXTRA_SMALL},label(){var t;if(this.modelValue.length===0){return this.loc("BOOKING_MULTI_CLIENT")}return this.loc("BOOKING_MULTI_CLIENT_WHIT_NAME",{"#NAME#":((t=this.modelValue.find((t=>t.name)))==null?void 0:t.name)||""})},currentClient(){if(this.modelValue.length===0){return null}return{contact:this.findClientByType(J.CrmEntity.Contact),company:this.findClientByType(J.CrmEntity.Company)}}},methods:{createClients(t){const e=t.map((t=>this.getByClientData(t)));this.$emit("update:model-value",e)},findClientByType(t){return this.modelValue.find((({type:e})=>e.code===t))}},components:{ClientPopup:V.ClientPopup},template:`\n\t\t<button\n\t\t\t:class="['ui-btn', 'booking--multi-booking--client-button', color, size]"\n\t\t\ttype="button"\n\t\t\tref="button"\n\t\t\t@click="isPopupShown = !isPopupShown"\n\t\t>\n\t\t\t<i class="ui-icon-set --customer-card"></i>\n\t\t\t<span>{{ label }}</span>\n\t\t</button>\n\t\t<ClientPopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:bind-element="$refs.button"\n\t\t\t:currentClient\n\t\t\t@create="createClients"\n\t\t\t@close="isPopupShown = false"/>\n\t`};const $s={name:"CancelButton",emits:["click"],computed:{color(){return X.ButtonColor.LINK},size(){return X.ButtonSize.EXTRA_SMALL}},template:`\n\t\t<button\n\t\t\t:class="['ui-btn', 'booking--multi-booking--cancel-button', color, size]"\n\t\t\ttype="button"\n\t\t\tref="button"\n\t\t\t@click="$emit('click')"\n\t\t>\n\t\t\t<i \n\t\t\t\tclass="ui-icon-set --cross-25" \n\t\t\t\tstyle="--ui-icon-set__icon-base-color: rgba(var(--ui-color-palette-white-base-rgb), 0.3);--ui-icon-set__icon-size: var(--ui-size-2xl)"></i>\n\t\t</button>\n\t`};const As={name:"MultiBooking",data(){return{fetching:false,clients:[]}},computed:W.mapGetters({selectedCells:`${J.Model.Interface}/selectedCells`,timezone:`${J.Model.Interface}/timezone`}),methods:{removeSelected(t){if(Object.hasOwnProperty.call(this.selectedCells,t)){this.$store.dispatch(`${J.Model.Interface}/removeSelectedCell`,this.selectedCells[t])}},async book(){const t=this.getBookings();if(t.length===0){return}this.fetching=true;const e=await x.bookingService.addList(t);this.fetching=false;this.showNotification(e);await this.closeMultiBooking()},getBookings(){return Object.values(this.selectedCells).map((t=>({id:`tmp-id-${Date.now()}-${Math.random()}`,dateFromTs:t.fromTs,dateToTs:t.toTs,name:this.loc("BOOKING_BOOKING_DEFAULT_BOOKING_NAME"),resourcesIds:[t.resourceId],timezoneFrom:this.timezone,timezoneTo:this.timezone,clients:this.clients})))},showNotification(t){const e=t.length;const o=BX.UI.Notification.Center.notify({id:q.Text.getRandom(),content:q.Loc.getMessagePlural("BOOKING_MULTI_CREATED",e,{"#QUANTITY#":e}),actions:[{title:this.loc("BOOKING_MULTI_CREATED_CANCEL"),events:{click:()=>this.reset(t,o)}}]})},async reset(t,e){await x.bookingService.deleteList(t.map((({id:t})=>t)));e==null?void 0:e.close()},async closeMultiBooking(){await this.$store.dispatch(`${J.Model.Interface}/clearSelectedCells`)}},components:{BookingMultipleButton:Ds,MultiBookingItemsList:Hs,AddClientButton:Ns,CancelButton:$s},template:`\n\t\t<Teleport to="#uiToolbarContainer" defer>\n\t\t\t<div class="booking--multi-booking--bar">\n\t\t\t\t<BookingMultipleButton :fetching @book="book"/>\n\t\t\t\t<MultiBookingItemsList @remove-selected="removeSelected"/>\n\t\t\t\t<div class="booking--multi-booking--divider-vertical"></div>\n\t\t\t\t<AddClientButton v-model="clients"/>\n\t\t\t\t<div class="booking--multi-booking--space"></div>\n\t\t\t\t<div class="booking--multi-booking--close">\n\t\t\t\t\t<div class="booking--multi-booking--divider-vertical"></div>\n\t\t\t\t\t<CancelButton @click="closeMultiBooking" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Teleport>\n\t`};const Rs={data(){return{isBannerShown:false,bannerComponent:null}},mounted(){if(tt.ahaMoments.shouldShow(J.AhaMoment.Banner)){void this.showBanner()}},methods:{async showBanner(){Z.BannerDispatcher.critical.toQueue((async t=>{const{PromoBanner:e}=await q.Runtime.loadExtension("booking.component.promo-banner");this.bannerComponent=Y.shallowRef(e);this.isBannerShown=true;this.bannerClosed=new Q.Resolvable;await this.bannerClosed;t()}))},closeBanner(){this.isBannerShown=false;this.setShown();this.bannerClosed.resolve()},setShown(){tt.ahaMoments.setShown(J.AhaMoment.Banner)}},template:`\n\t\t<component v-if="isBannerShown" :is="bannerComponent" @setShown="setShown" @close="closeBanner"/>\n\t`};const zs={data(){return{isBannerShown:false,bannerComponent:null}},watch:{isShownTrialPopup(){if(tt.ahaMoments.shouldShow(J.AhaMoment.TrialBanner)){if(!j.AutoLauncher.isEnabled()){j.AutoLauncher.enable()}void this.showBanner()}}},computed:{...W.mapGetters({isShownTrialPopup:`${J.Model.Interface}/isShownTrialPopup`})},methods:{async showBanner(){Z.BannerDispatcher.critical.toQueue((async t=>{const{TrialBanner:e}=await q.Runtime.loadExtension("booking.component.trial-banner");this.bannerComponent=Y.shallowRef(e);this.isBannerShown=true;this.bannerClosed=new Q.Resolvable;await this.bannerClosed;t()}))},closeBanner(){this.isBannerShown=false;tt.ahaMoments.setShown(J.AhaMoment.TrialBanner);this.bannerClosed.resolve()}},template:`\n\t\t<component v-if="isBannerShown" :is="bannerComponent" @close="closeBanner"/>\n\t`};const xs={name:"BookingApp",props:{afterTitleContainer:HTMLElement,counterPanelContainer:HTMLElement,filterId:String},data(){return{loader:new o.Loader}},async mounted(){r.mousePosition.bindMouseMove();this.showLoader();ft.setExpanded(true);this.addAfterTitle();await Promise.all([i.dictionaryService.fetchData(),this.fetchPage(this.isEditingBookingMode?0:this.selectedDateTs/1e3)]);void this.$store.dispatch(`${J.Model.Interface}/setIsLoaded`,true)},computed:{...W.mapGetters({selectedDateTs:`${J.Model.Interface}/selectedDateTs`,viewDateTs:`${J.Model.Interface}/viewDateTs`,isFilterMode:`${J.Model.Interface}/isFilterMode`,filteredBookingsIds:`${J.Model.Interface}/filteredBookingsIds`,selectedCells:`${J.Model.Interface}/selectedCells`,resourcesIds:`${J.Model.Favorites}/get`,extraResourcesIds:`${J.Model.Interface}/extraResourcesIds`,bookings:`${J.Model.Bookings}/get`,intersections:`${J.Model.Interface}/intersections`,editingBookingId:`${J.Model.Interface}/editingBookingId`,isEditingBookingMode:`${J.Model.Interface}/isEditingBookingMode`,offset:`${J.Model.Interface}/offset`}),hasSelectedCells(){return Object.keys(this.selectedCells).length>0},editingBooking(){var t;return(t=this.$store.getters["bookings/getById"](this.editingBookingId))!=null?t:null}},methods:{async fetchPage(t=0){this.showLoader();await s.mainPageService.fetchData(t);if(this.extraResourcesIds.length>0){await w.resourceDialogService.loadByIds(this.extraResourcesIds,this.selectedDateTs/1e3)}this.hideLoader()},onActiveItem(t){if(this.ignoreConterPanel){return}this.$refs.filter.setPresetId(this.getPresetIdByCounterItem(t))},async applyFilter(){const t=this.$refs.filter.getPresetId();const e=this.$refs.filter.getFields();this.setCounterItem(this.getCounterItemByPresetId(t));this.showLoader();await Promise.all([this.$store.dispatch(`${J.Model.Interface}/setFilterMode`,true),this.updateMarks(),x.bookingService.filter(e)]);this.hideLoader()},async clearFilter(){this.setCounterItem(null);n.calendarService.clearFilterCache();x.bookingService.clearFilterCache();void Promise.all([this.$store.dispatch(`${J.Model.Interface}/setResourcesIds`,this.resourcesIds),this.$store.dispatch(`${J.Model.Interface}/setFilterMode`,false),this.$store.dispatch(`${J.Model.Interface}/setFilteredBookingsIds`,[]),this.$store.dispatch(`${J.Model.Interface}/setFilteredMarks`,[])]);this.hideLoader()},setCounterItem(t){this.ignoreConterPanel=true;setTimeout((()=>{this.ignoreConterPanel=false}),0);this.$refs.countersPanel.setItem(t)},getCounterItemByPresetId(t){return{[vt.NotConfirmed]:Bt.NotConfirmed,[vt.Delayed]:Bt.Delayed}[t]},getPresetIdByCounterItem(t){return{[Bt.NotConfirmed]:vt.NotConfirmed,[Bt.Delayed]:vt.Delayed}[t]},addAfterTitle(){this.afterTitleContainer.append(this.$refs.afterTitle.$el)},showResourcesWithBookings(){const t=this.$store.getters[`${J.Model.Bookings}/getByDateAndIds`](this.selectedDateTs,this.filteredBookingsIds).map((t=>t.resourcesIds[0])).filter(((t,e,o)=>o.indexOf(t)===e));void this.$store.dispatch(`${J.Model.Interface}/setResourcesIds`,t)},async updateMarks(){if(this.isFilterMode){await this.updateFilterMarks()}else{await Promise.all([this.updateFreeMarks(),this.updateCounterMarks()])}},async updateFreeMarks(){const t=this.resourcesIds.map((t=>{var e,o;return[t,...(e=this.intersections[0])!=null?e:[],...(o=this.intersections[t])!=null?o:[]]}));await this.$store.dispatch(`${J.Model.Interface}/setFreeMarks`,[]);await n.calendarService.loadMarks(this.viewDateTs,t)},async updateFilterMarks(){const t=this.$refs.filter.getFields();await this.$store.dispatch(`${J.Model.Interface}/setFilteredMarks`,[]);await n.calendarService.loadFilterMarks(t)},async updateCounterMarks(){await n.calendarService.loadCounterMarks(this.viewDateTs)},showLoader(){void this.loader.show(this.$refs.baseComponent.$el)},hideLoader(){void this.loader.hide()}},watch:{selectedDateTs(){if(this.isFilterMode){void this.applyFilter()}else{void this.fetchPage(this.selectedDateTs/1e3)}},filteredBookingsIds(){if(this.isFilterMode){this.showResourcesWithBookings()}},isFilterMode(t){if(!t){void this.fetchPage(this.selectedDateTs/1e3)}},viewDateTs(){void this.updateMarks()},resourcesIds(){void this.updateMarks()},intersections(){void this.updateMarks()},editingBooking(t){var e,o;const s=(e=t==null?void 0:(o=t.resourcesIds)==null?void 0:o.slice(1))!=null?e:[];if(s.length>0){void this.$store.dispatch(`${J.Model.Interface}/setIntersections`,{0:s})}}},components:{BaseComponent:Ls,AfterTitle:Ct,Filter:kt,CountersPanel:yt,MultiBooking:As,Banner:Rs,Trial:zs},template:`\n\t\t<div>\n\t\t\t<MultiBooking v-if="hasSelectedCells"/>\n\t\t\t<AfterTitle ref="afterTitle"/>\n\t\t\t<Filter\n\t\t\t\t:filterId="filterId"\n\t\t\t\tref="filter"\n\t\t\t\t@apply="applyFilter"\n\t\t\t\t@clear="clearFilter"\n\t\t\t/>\n\t\t\t<CountersPanel\n\t\t\t\t:target="counterPanelContainer"\n\t\t\t\tref="countersPanel"\n\t\t\t\t@activeItem="onActiveItem"\n\t\t\t/>\n\t\t\t<BaseComponent ref="baseComponent"/>\n\t\t\t<Banner/>\n\t\t\t<Trial/>\n\t\t</div>\n\t`};var Gs=babelHelpers.classPrivateFieldLooseKey("mountApplication");class Ks{constructor(t){Object.defineProperty(this,Gs,{value:Us});y.Core.setParams(t);void babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs]()}}async function Us(){await y.Core.init();const t=Y.BitrixVue.createApp(xs,y.Core.getParams());t.mixin(e.locMixin);t.use(y.Core.getStore());t.mount(y.Core.getParams().container)}t.Booking=Ks})(this.BX.Booking=this.BX.Booking||{},BX.Booking.Component.Mixin,BX,BX.Booking.Provider.Service,BX.Booking.Provider.Service,BX.Booking.Provider.Service,BX.Booking.Lib,BX.Event,BX.UI,BX.UI,BX.Booking.Component,BX.Booking.Component,BX.Booking.Component,BX.Vue3.Directives,BX,BX.UI.NotificationManager,BX.Booking.Provider.Service,BX.Booking.Component,BX.Vue3.Directives,BX,BX.Booking.Component,BX.Booking.Lib,BX.Booking,BX.UI.DatePicker,BX.Booking.Lib,BX.Booking.Component,BX.UI.Dialogs,BX,BX.Booking.Provider.Service,BX,BX.Booking,BX.Booking.Provider.Service,BX.Booking.Lib,BX.Booking.Lib,BX.Main,BX.UI.IconSet,BX.UI.IconSet,BX.Booking.Provider.Service,BX.Booking.Lib,BX.UI.EntitySelector,BX.Booking.Lib,BX.Booking.Provider.Service,BX.UI,BX.Main,BX.Booking.Lib,BX.Booking.Component,BX.Booking.Component,BX.UI.AutoLaunch,BX.Vue3.Vuex,BX,BX.Vue3,BX.UI,BX.Booking.Lib,BX.Booking.Const,BX.Booking.Lib);
//# sourceMappingURL=booking.bundle.map.js