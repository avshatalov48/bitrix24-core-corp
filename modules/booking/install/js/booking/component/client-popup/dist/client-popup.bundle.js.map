{"version":3,"file":"client-popup.bundle.js","sources":["../src/client-popup-content/components/input-field.js","../src/client-popup-content/lib/index.js","../src/client-popup-content/components/client-input.js","../src/client-popup-content/components/phone-input.js","../src/client-popup-content/components/email-input.js","../src/client-popup-content/client-popup-content.js","../src/client-popup.js"],"sourcesContent":["export const InputField = {\n\tprops: {\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdataElement: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"booking-booking-client-popup-field\"\n\t\t\t:data-element=\"dataElement\"\n\t\t>\n\t\t\t<div class=\"booking-booking-client-popup-field-name\">\n\t\t\t\t{{ name }}\n\t\t\t</div>\n\t\t\t<div class=\"booking-booking-client-popup-field-input-container\">\n\t\t\t\t<slot></slot>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { isRef, isReactive, isProxy, toRaw } from 'ui.vue3';\n\nimport { Module } from 'booking.const';\nimport type { ClientModel } from 'booking.model.clients';\n\nimport type { Item } from '../types';\n\nexport function getEmptyClient(item: Item, code: string): ClientModel\n{\n\tlet name = '';\n\tconst phones: string[] = [];\n\n\tif (BX.validation.checkIfPhone(item.title))\n\t{\n\t\tphones.push(item.title);\n\t}\n\telse\n\t{\n\t\tname = item.title;\n\t}\n\n\treturn {\n\t\tname,\n\t\ttype: {\n\t\t\tmodule: Module.Crm,\n\t\t\tcode,\n\t\t},\n\t\tphones,\n\t\temails: [],\n\t};\n}\n\nexport function clientToItem(client: ClientModel): Item\n{\n\treturn {\n\t\tid: client.id,\n\t\tmodule: client.type.module,\n\t\ttype: client.type.code,\n\t\ttitle: client.name,\n\t\tattributes: {\n\t\t\tphone: client.phones.map((value: string) => ({ value })),\n\t\t\temail: client.emails.map((value: string) => ({ value })),\n\t\t},\n\t};\n}\n\nexport function itemToClient(item: Item): ClientModel\n{\n\treturn {\n\t\tid: item.id,\n\t\tname: item.title,\n\t\ttype: {\n\t\t\tmodule: item.module,\n\t\t\tcode: item.type,\n\t\t},\n\t\tphones: item.attributes?.phone?.map(({ value }) => value) ?? [],\n\t\temails: item.attributes?.email?.map(({ value }) => value) ?? [],\n\t};\n}\n\nexport function deepToRawClientModel<T>(clientModel: T): T\n{\n\tconst modelIterator = (data: any) => {\n\t\tif (Array.isArray(data))\n\t\t{\n\t\t\treturn data.map((item) => modelIterator(item));\n\t\t}\n\t\tif (isRef(data) || isReactive(data) || isProxy(data))\n\t\t{\n\t\t\treturn modelIterator(toRaw(data));\n\t\t}\n\t\tif (Type.isObject(data))\n\t\t{\n\t\t\treturn Object.keys(data).reduce((acc, key) => {\n\t\t\t\tacc[key] = modelIterator(data[key]);\n\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t}\n\n\t\treturn data;\n\t};\n\n\treturn modelIterator(clientModel);\n}\n","import { EventEmitter, BaseEvent } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { BIcon as Icon, Set as IconSet } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.actions';\nimport 'ui.icon-set.crm';\nimport 'ui.dropdown';\n\nimport type { ClientModel } from 'booking.model.clients';\nimport { CrmEntity, Model } from 'booking.const';\n\nimport { InputField } from './input-field';\nimport { clientToItem, itemToClient, getEmptyClient } from '../lib';\nimport type { Item } from '../types';\n\nexport const ClientInput = {\n\temits: ['setClient'],\n\tprops: {\n\t\tclient: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t\tcode: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tisWarning: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.dropdown = new BX.UI.Dropdown({\n\t\t\ttargetElement: this.$refs.clientInput,\n\t\t\tsearchAction: 'crm.api.entity.search',\n\t\t\tsearchOptions: {\n\t\t\t\ttypes: [this.code],\n\t\t\t\tscope: 'index',\n\t\t\t},\n\t\t\tenableCreation: true,\n\t\t\tautocompleteDelay: 200,\n\t\t\titems: this.clientsItems,\n\t\t\tmessages: {\n\t\t\t\tcreationLegend: this.creationLegend,\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonSelect: (dropdown, item) => this.setClient(this.itemToClient(item)),\n\t\t\t\tonAdd: (dropdown, item) => this.setClient(this.itemToClient(item)),\n\t\t\t},\n\t\t});\n\n\t\tthis.updateValue();\n\t\tthis.onInput();\n\n\t\tEventEmitter.subscribe(this.dropdown, 'BX.UI.Dropdown:onSearchComplete', this.onDropdownContactsLoaded);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.dropdown.destroyPopupWindow();\n\t\tEventEmitter.unsubscribe(this.dropdown, 'BX.UI.Dropdown:onSearchComplete', this.onDropdownContactsLoaded);\n\t},\n\tcomputed: {\n\t\tclientId(): number | null\n\t\t{\n\t\t\treturn this.client?.id;\n\t\t},\n\t\tclientsItems(): Item[]\n\t\t{\n\t\t\tswitch (this.code)\n\t\t\t{\n\t\t\t\tcase CrmEntity.Contact:\n\t\t\t\t\treturn this.$store.getters[`${Model.Clients}/getContacts`].map((it) => clientToItem(it));\n\t\t\t\tcase CrmEntity.Company:\n\t\t\t\t\treturn this.$store.getters[`${Model.Clients}/getCompanies`].map((it) => clientToItem(it));\n\t\t\t\tdefault:\n\t\t\t\t\treturn [];\n\t\t\t}\n\t\t},\n\t\tfieldName(): string\n\t\t{\n\t\t\tswitch (this.code)\n\t\t\t{\n\t\t\t\tcase CrmEntity.Contact:\n\t\t\t\t\treturn this.loc('BOOKING_BOOKING_ADD_CLIENT_FIELD_CONTACT');\n\t\t\t\tcase CrmEntity.Company:\n\t\t\t\t\treturn this.loc('BOOKING_BOOKING_ADD_CLIENT_FIELD_COMPANY');\n\t\t\t\tdefault:\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t\tinputPlaceholder(): string\n\t\t{\n\t\t\tswitch (this.code)\n\t\t\t{\n\t\t\t\tcase CrmEntity.Contact:\n\t\t\t\t\treturn this.loc('BOOKING_BOOKING_ADD_CLIENT_CONTACT_PLACEHOLDER');\n\t\t\t\tcase CrmEntity.Company:\n\t\t\t\t\treturn this.loc('BOOKING_BOOKING_ADD_CLIENT_COMPANY_PLACEHOLDER');\n\t\t\t\tdefault:\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t\tcreationLegend(): string\n\t\t{\n\t\t\tswitch (this.code)\n\t\t\t{\n\t\t\t\tcase CrmEntity.Contact:\n\t\t\t\t\treturn this.loc('BOOKING_BOOKING_ADD_CLIENT_DROPDOWN_CREATE_NEW_CONTACT');\n\t\t\t\tcase CrmEntity.Company:\n\t\t\t\t\treturn this.loc('BOOKING_BOOKING_ADD_CLIENT_DROPDOWN_CREATE_NEW_COMPANY');\n\t\t\t\tdefault:\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t\tinputLabel(): string\n\t\t{\n\t\t\tif (this.isWarning)\n\t\t\t{\n\t\t\t\treturn this.loc('BOOKING_BOOKING_ADD_CLIENT_CLIENT_REQUIRED');\n\t\t\t}\n\n\t\t\tif (this.isNew)\n\t\t\t{\n\t\t\t\tswitch (this.code)\n\t\t\t\t{\n\t\t\t\t\tcase CrmEntity.Contact:\n\t\t\t\t\t\treturn this.loc('BOOKING_BOOKING_ADD_CLIENT_CONTACT_NEW');\n\t\t\t\t\tcase CrmEntity.Company:\n\t\t\t\t\t\treturn this.loc('BOOKING_BOOKING_ADD_CLIENT_COMPANY_NEW');\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tswitch (this.code)\n\t\t\t{\n\t\t\t\tcase CrmEntity.Contact:\n\t\t\t\t\treturn this.loc('BOOKING_BOOKING_ADD_CLIENT_CLIENT_EDIT');\n\t\t\t\tcase CrmEntity.Company:\n\t\t\t\t\treturn this.loc('BOOKING_BOOKING_ADD_CLIENT_CLIENT_EDIT');\n\t\t\t\tdefault:\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t\tisNew(): boolean\n\t\t{\n\t\t\treturn this.hasClient && !this.isEditing;\n\t\t},\n\t\tisEditing(): boolean\n\t\t{\n\t\t\treturn this.hasClient && Boolean(this.client?.id);\n\t\t},\n\t\thasClient(): boolean\n\t\t{\n\t\t\treturn Boolean(this.client);\n\t\t},\n\t\tclearHint(): string\n\t\t{\n\t\t\tswitch (this.code)\n\t\t\t{\n\t\t\t\tcase CrmEntity.Contact:\n\t\t\t\t\treturn this.loc('BOOKING_BOOKING_ADD_CLIENT_CHOOSE_ANOTHER_CONTACT');\n\t\t\t\tcase CrmEntity.Company:\n\t\t\t\t\treturn this.loc('BOOKING_BOOKING_ADD_CLIENT_CHOOSE_ANOTHER_COMPANY');\n\t\t\t\tdefault:\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t\tleftIcon(): string\n\t\t{\n\t\t\tswitch (this.code)\n\t\t\t{\n\t\t\t\tcase CrmEntity.Contact:\n\t\t\t\t\treturn IconSet.PERSON;\n\t\t\t\tcase CrmEntity.Company:\n\t\t\t\t\treturn IconSet.COMPANY;\n\t\t\t\tdefault:\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t\tsearchIcon(): string\n\t\t{\n\t\t\treturn IconSet.SEARCH_2;\n\t\t},\n\t\tarrowsIcon(): string\n\t\t{\n\t\t\treturn IconSet.SWAP;\n\t\t},\n\t},\n\tmethods: {\n\t\tonInput(): void\n\t\t{\n\t\t\tif (this.client)\n\t\t\t{\n\t\t\t\tthis.setClient({\n\t\t\t\t\t...this.client,\n\t\t\t\t\tname: this.getValue(),\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tgetValue(): string\n\t\t{\n\t\t\treturn this.$refs.clientInput.value;\n\t\t},\n\t\tgetPopup(): ?Popup\n\t\t{\n\t\t\treturn this.dropdown.popupWindow;\n\t\t},\n\t\tonDropdownContactsLoaded(event: BaseEvent): void\n\t\t{\n\t\t\tconst [, results] = event.getData();\n\n\t\t\tthis.$store.dispatch(`${Model.Clients}/upsertMany`, results.map((it) => this.itemToClient(it)));\n\t\t},\n\t\tgetClient(item: Item): ClientModel\n\t\t{\n\t\t\tconst client = this.$store.getters[`${Model.Clients}/getByClientData`]({\n\t\t\t\tid: item.id,\n\t\t\t\ttype: {\n\t\t\t\t\tmodule: item.module,\n\t\t\t\t\tcode: item.type,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn client ?? this.itemToClient(item);\n\t\t},\n\t\titemToClient(item: Item): ClientModel\n\t\t{\n\t\t\tif (item.id)\n\t\t\t{\n\t\t\t\treturn itemToClient(item);\n\t\t\t}\n\n\t\t\treturn this.getEmptyClient(item);\n\t\t},\n\t\tgetEmptyClient(item: Item): ClientModel\n\t\t{\n\t\t\treturn getEmptyClient(item, this.code);\n\t\t},\n\t\tclear(): void\n\t\t{\n\t\t\tthis.setClient(null);\n\t\t},\n\t\tsetClient(client: ClientModel): void\n\t\t{\n\t\t\tthis.$emit('setClient', client);\n\t\t},\n\t\tupdateValue(): void\n\t\t{\n\t\t\tif (this.client)\n\t\t\t{\n\t\t\t\tthis.$refs.clientInput.value = this.client.name;\n\t\t\t\tthis.dropdown.isDisabled = true;\n\t\t\t\tthis.dropdown.destroyPopupWindow();\n\t\t\t\tthis.dropdown.popupAlertContainer = null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$refs.clientInput.value = '';\n\t\t\t\tthis.dropdown.isDisabled = false;\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tclient(): void\n\t\t{\n\t\t\tthis.updateValue();\n\t\t},\n\t\tclientId(): void\n\t\t{\n\t\t\tthis.onInput();\n\t\t},\n\t\tclientsItems(clientsItems): void\n\t\t{\n\t\t\tthis.dropdown.setDefaultItems(clientsItems);\n\t\t},\n\t},\n\tcomponents: {\n\t\tInputField,\n\t\tIcon,\n\t},\n\ttemplate: `\n\t\t<InputField\n\t\t\t:name=\"fieldName\"\n\t\t\t:data-element=\"'booking-client-field-' + code\"\n\t\t>\n\t\t\t<input\n\t\t\t\tclass=\"booking-booking-client-popup-field-input --left-icon --right-icon\"\n\t\t\t\t:class=\"{'--warning': isWarning}\"\n\t\t\t\t:placeholder=\"inputPlaceholder\"\n\t\t\t\tdata-element=\"booking-client-input\"\n\t\t\t\t:data-id=\"client?.id || 0\"\n\t\t\t\t:data-code=\"code\"\n\t\t\t\t:data-new=\"isNew\"\n\t\t\t\t:data-editing=\"isEditing\"\n\t\t\t\tref=\"clientInput\"\n\t\t\t\t@input=\"onInput\"\n\t\t\t/>\n\t\t\t<div class=\"booking-booking-client-popup-field-input-icon\">\n\t\t\t\t<div class=\"booking-booking-client-popup-field-input-avatar-icon\">\n\t\t\t\t\t<Icon :name=\"leftIcon\"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"hasClient\"\n\t\t\t\tclass=\"booking-booking-client-popup-field-input-label\"\n\t\t\t\t:class=\"{'--warning': isWarning}\"\n\t\t\t\tdata-element=\"booking-client-input-label\"\n\t\t\t>\n\t\t\t\t{{ inputLabel }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-else\n\t\t\t\tclass=\"booking-booking-client-popup-field-input-icon-right\"\n\t\t\t\tdata-element=\"booking-client-search-icon\"\n\t\t\t>\n\t\t\t\t<Icon :name=\"searchIcon\"/>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"hasClient\"\n\t\t\t\tclass=\"booking-booking-client-popup-field-input-icon-right --clickable\"\n\t\t\t\t:title=\"clearHint\"\n\t\t\t\tdata-element=\"booking-client-clear-icon\"\n\t\t\t\t@click=\"clear\"\n\t\t\t>\n\t\t\t\t<Icon :name=\"arrowsIcon\"/>\n\t\t\t</div>\n\t\t</InputField>\n\t`,\n};\n","import 'phone_number';\nimport { PhoneNumberInput } from 'crm.entity-editor.field.phone-number-input';\nimport { InputField } from './input-field';\n\nexport const PhoneInput = {\n\temits: ['update:modelValue'],\n\tprops: {\n\t\tmodelValue: String,\n\t\tclientId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tcode: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tasync mounted(): void\n\t{\n\t\tnew PhoneNumberInput({\n\t\t\tnode: this.$refs.input,\n\t\t\tflagNode: this.$refs.flag,\n\t\t});\n\t},\n\tcomponents: {\n\t\tInputField,\n\t},\n\ttemplate: `\n\t\t<InputField\n\t\t\t:name=\"loc('BOOKING_BOOKING_ADD_CLIENT_FIELD_PHONE')\"\n\t\t\t:data-element=\"'booking-client-field-phone'\"\n\t\t>\n\t\t\t<input\n\t\t\t\tclass=\"booking-booking-client-popup-field-input --left-icon\"\n\t\t\t\t:placeholder=\"loc('BOOKING_BOOKING_ADD_CLIENT_FIELD_PLACEHOLDER')\"\n\t\t\t\t:value=\"modelValue\"\n\t\t\t\tdata-element=\"booking-client-phone-input\"\n\t\t\t\t:data-id=\"clientId\"\n\t\t\t\t:data-code=\"code\"\n\t\t\t\tref=\"input\"\n\t\t\t\t@input=\"$emit('update:modelValue', $refs.input.value)\"\n\t\t\t/>\n\t\t\t<div class=\"booking-booking-client-popup-field-input-icon --no-border\" ref=\"flag\"></div>\n\t\t</InputField>\n\t`,\n};\n","import { InputField } from './input-field';\n\nexport const EmailInput = {\n\temits: ['update:modelValue'],\n\tprops: {\n\t\tmodelValue: String,\n\t\tclientId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tcode: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomponents: {\n\t\tInputField,\n\t},\n\ttemplate: `\n\t\t<InputField\n\t\t\t:name=\"loc('BOOKING_BOOKING_ADD_CLIENT_FIELD_EMAIL')\"\n\t\t\t:data-element=\"'booking-client-field-email'\"\n\t\t>\n\t\t\t<input\n\t\t\t\tclass=\"booking-booking-client-popup-field-input\"\n\t\t\t\t:placeholder=\"loc('BOOKING_BOOKING_ADD_CLIENT_FIELD_PLACEHOLDER')\"\n\t\t\t\t:value=\"modelValue\"\n\t\t\t\tdata-element=\"booking-client-email-input\"\n\t\t\t\t:data-id=\"clientId\"\n\t\t\t\t:data-code=\"code\"\n\t\t\t\tref=\"input\"\n\t\t\t\t@input=\"$emit('update:modelValue', $refs.input.value)\"\n\t\t\t/>\n\t\t</InputField>\n\t`,\n};\n","import { Popup } from 'main.popup';\nimport { Notifier } from 'ui.notification-manager';\n\nimport { clientService } from 'booking.provider.service.client-service';\nimport { CrmEntity } from 'booking.const';\nimport { Button, ButtonSize, ButtonColor } from 'booking.component.button';\nimport type { ClientModel } from 'booking.model.clients';\n\nimport { ClientInput } from './components/client-input';\nimport { PhoneInput } from './components/phone-input';\nimport { EmailInput } from './components/email-input';\nimport { deepToRawClientModel } from './lib';\nimport type { CurrentClient } from './types';\nimport './client-popup-content.css';\n\nexport const ClientPopupContent = {\n\tname: 'ClientPopupContent',\n\temits: ['create', 'close'],\n\tprops: {\n\t\tadjustPosition: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t},\n\t\tcurrentClient: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tButtonSize,\n\t\t\tButtonColor,\n\t\t\tCrmEntity,\n\t\t\tcontact: null,\n\t\t\tcompany: null,\n\t\t\tisSaving: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\thasClient(): boolean\n\t\t{\n\t\t\treturn this.hasContact || this.hasCompany;\n\t\t},\n\t\thasContact(): boolean\n\t\t{\n\t\t\treturn Boolean(this.contact);\n\t\t},\n\t\thasCompany(): boolean\n\t\t{\n\t\t\treturn Boolean(this.company);\n\t\t},\n\t\tcannotSave(): boolean\n\t\t{\n\t\t\treturn this.clients.length > 0 && this.filledClients.length === 0;\n\t\t},\n\t\tfilledClients(): ClientModel[]\n\t\t{\n\t\t\treturn this.clients.filter((client) => client.name?.trim());\n\t\t},\n\t\tclients(): ClientModel[]\n\t\t{\n\t\t\tconst clients = [];\n\n\t\t\tif (this.contact)\n\t\t\t{\n\t\t\t\tclients.push({\n\t\t\t\t\t...this.contact,\n\t\t\t\t\tname: this.$refs.contactInput?.getValue() ?? '',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.company)\n\t\t\t{\n\t\t\t\tclients.push({\n\t\t\t\t\t...this.company,\n\t\t\t\t\tname: this.$refs.companyInput?.getValue() ?? '',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn clients;\n\t\t},\n\t},\n\tbeforeMount(): void\n\t{\n\t\tconst currentClient: CurrentClient | null = this.currentClient;\n\n\t\tif (!currentClient)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (currentClient.contact)\n\t\t{\n\t\t\tthis.setContact(deepToRawClientModel(currentClient.contact));\n\t\t}\n\n\t\tif (currentClient.company)\n\t\t{\n\t\t\tthis.company = deepToRawClientModel(currentClient.company);\n\t\t}\n\t},\n\tmethods: {\n\t\tsetContact(contact: ClientModel | null): void\n\t\t{\n\t\t\tthis.contact = contact;\n\t\t},\n\t\tasync setCompany(company: ClientModel | null): Promise<void>\n\t\t{\n\t\t\tconst previousCompanyId = this.company?.id;\n\t\t\tconst newCompanyId = company?.id;\n\n\t\t\tthis.company = company;\n\t\t\tif (!newCompanyId || previousCompanyId === newCompanyId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst linkedContact = await clientService.getLinkedContactByCompany(this.company);\n\t\t\tif (linkedContact)\n\t\t\t{\n\t\t\t\tthis.contact = linkedContact;\n\t\t\t}\n\t\t},\n\t\tasync saveClients(): Promise<void>\n\t\t{\n\t\t\tthis.isSaving = true;\n\n\t\t\tconst { clients, error } = await clientService.saveMany(this.filledClients);\n\n\t\t\tthis.isSaving = false;\n\n\t\t\tif (error)\n\t\t\t{\n\t\t\t\tNotifier.notify({\n\t\t\t\t\tid: 'booking-client-popup-save-error',\n\t\t\t\t\ttext: error.message,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('create', clients);\n\n\t\t\tthis.closePopup();\n\t\t},\n\t\tgetClientsPopup(): ?Popup\n\t\t{\n\t\t\tconst contactsPopup = this.$refs.contactInput.getPopup();\n\t\t\tconst companiesPopup = this.$refs.companyInput.getPopup();\n\n\t\t\tif (contactsPopup?.isShown())\n\t\t\t{\n\t\t\t\treturn contactsPopup;\n\t\t\t}\n\n\t\t\tif (companiesPopup?.isShown())\n\t\t\t{\n\t\t\t\treturn companiesPopup;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t\tclosePopup(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\twatch: {\n\t\tisNew(): void\n\t\t{\n\t\t\tvoid this.$nextTick(() => this.adjustPosition());\n\t\t},\n\t},\n\tcomponents: {\n\t\tButton,\n\t\tClientInput,\n\t\tPhoneInput,\n\t\tEmailInput,\n\t},\n\ttemplate: `\n\t\t<div class=\"booking-booking-client-popup-header\">\n\t\t\t<div class=\"booking-booking-client-popup-header-text\">\n\t\t\t\t{{ loc('BOOKING_BOOKING_ADD_CLIENT_POPUP_HEADER') }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass=\"ui-icon-set --cross-45\"\n\t\t\t\tdata-element=\"booking-client-popup-close\"\n\t\t\t\t@click=\"closePopup\"\n\t\t\t></div>\n\t\t</div>\n\t\t<div class=\"booking-booking-client-popup-contact\">\n\t\t\t<ClientInput\n\t\t\t\t:code=\"CrmEntity.Contact\"\n\t\t\t\t:client=\"contact\"\n\t\t\t\t:isWarning=\"contact && cannotSave\"\n\t\t\t\tref=\"contactInput\"\n\t\t\t\t@setClient=\"setContact\"\n\t\t\t/>\n\t\t\t<template v-if=\"hasContact\">\n\t\t\t\t<PhoneInput v-model=\"contact.phones[0]\" :clientId=\"contact.id || 0\" :code=\"CrmEntity.Contact\"/>\n\t\t\t\t<EmailInput v-model=\"contact.emails[0]\" :clientId=\"contact.id || 0\" :code=\"CrmEntity.Contact\"/>\n\t\t\t</template>\n\t\t\t<ClientInput\n\t\t\t\t:code=\"CrmEntity.Company\"\n\t\t\t\t:client=\"company\"\n\t\t\t\t:isWarning=\"company && cannotSave\"\n\t\t\t\tref=\"companyInput\"\n\t\t\t\t@setClient=\"setCompany\"\n\t\t\t/>\n\t\t\t<template v-if=\"hasCompany\">\n\t\t\t\t<PhoneInput v-model=\"company.phones[0]\" :clientId=\"company.id || 0\" :code=\"CrmEntity.Company\"/>\n\t\t\t\t<EmailInput v-model=\"company.emails[0]\" :clientId=\"company.id || 0\" :code=\"CrmEntity.Company\"/>\n\t\t\t</template>\n\t\t</div>\n\t\t<div v-if=\"hasClient\" class=\"booking-booking-client-popup-buttons\">\n\t\t\t<Button\n\t\t\t\t:dataset=\"{element: 'booking-client-popup-save'}\"\n\t\t\t\t:text=\"loc('BOOKING_BOOKING_ADD_CLIENT_SAVE')\"\n\t\t\t\t:size=\"ButtonSize.EXTRA_SMALL\"\n\t\t\t\t:color=\"ButtonColor.PRIMARY\"\n\t\t\t\t:round=\"true\"\n\t\t\t\t:disabled=\"cannotSave\"\n\t\t\t\t:waiting=\"isSaving\"\n\t\t\t\t@click=\"saveClients\"\n\t\t\t/>\n\t\t\t<Button\n\t\t\t\t:dataset=\"{element: 'booking-client-popup-cancel'}\"\n\t\t\t\t:text=\"loc('BOOKING_BOOKING_ADD_CLIENT_CANCEL')\"\n\t\t\t\t:size=\"ButtonSize.EXTRA_SMALL\"\n\t\t\t\t:color=\"ButtonColor.LINK\"\n\t\t\t\t:round=\"true\"\n\t\t\t\t@click=\"closePopup\"\n\t\t\t/>\n\t\t</div>\n\t\t<div v-else class=\"booking-booking-client-popup-hint\">\n\t\t\t{{ loc('BOOKING_BOOKING_ADD_CLIENT_POPUP_HINT') }}\n\t\t</div>\n\t`,\n};\n","import { PopupOptions } from 'main.popup';\nimport { StickyPopup } from 'booking.component.popup';\nimport { ClientPopupContent } from './client-popup-content/client-popup-content';\n\nexport type { CurrentClient } from './client-popup-content/types';\n\nexport const ClientPopup = {\n\tname: 'ClientPopup',\n\temits: ['create', 'close'],\n\tprops: {\n\t\tbindElement: {\n\t\t\ttype: HTMLElement,\n\t\t\trequired: true,\n\t\t},\n\t\tcurrentClient: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t\toffsetTop: {\n\t\t\ttype: Number,\n\t\t\tdefault: null,\n\t\t},\n\t\toffsetLeft: {\n\t\t\ttype: Number,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\tcomputed: {\n\t\tpopupId(): string\n\t\t{\n\t\t\treturn 'booking-booking-client-popup';\n\t\t},\n\t\tconfig(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\twidth: 305,\n\t\t\t\toffsetLeft: this.offsetLeft ?? 0 - this.bindElement.offsetWidth,\n\t\t\t\toffsetTop: this.offsetTop ?? this.bindElement.offsetHeight,\n\t\t\t\tautoHideHandler: ({ target }) => {\n\t\t\t\t\tconst content = this.$refs.content;\n\t\t\t\t\tconst isClickInside = this.$refs.popup.contains(target);\n\t\t\t\t\tconst isDropdownClick = content.getClientsPopup()?.getPopupContainer()?.contains(target);\n\t\t\t\t\tconst isFillingTheContact = content.hasClient;\n\n\t\t\t\t\treturn !isDropdownClick && !isClickInside && !isFillingTheContact;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tthis.onAdjustPosition();\n\t},\n\tmethods: {\n\t\tonAdjustPosition(): void\n\t\t{\n\t\t\tthis.$refs.content.getClientsPopup()?.adjustPosition();\n\t\t},\n\t\tclosePopup(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\tcomponents: {\n\t\tStickyPopup,\n\t\tClientPopupContent,\n\t},\n\ttemplate: `\n\t\t<StickyPopup\n\t\t\tv-slot=\"{adjustPosition}\"\n\t\t\t:id=\"popupId\"\n\t\t\t:config=\"config\"\n\t\t\tref=\"popup\"\n\t\t\t@close=\"closePopup\"\n\t\t\t@adjustPosition=\"onAdjustPosition\"\n\t\t>\n\t\t\t<ClientPopupContent\n\t\t\t\t:adjust-position\n\t\t\t\t:current-client\n\t\t\t\tref=\"content\"\n\t\t\t\t@create=\"$emit('create', $event)\"\n\t\t\t\t@close=\"closePopup\"\n\t\t\t/>\n\t\t</StickyPopup>\n\t`,\n};\n"],"names":["InputField","props","name","type","String","required","dataElement","template","getEmptyClient","item","code","phones","BX","validation","checkIfPhone","title","push","module","Module","Crm","emails","clientToItem","client","id","attributes","phone","map","value","email","itemToClient","deepToRawClientModel","clientModel","modelIterator","data","Array","isArray","isRef","isReactive","isProxy","toRaw","Type","isObject","Object","keys","reduce","acc","key","ClientInput","emits","default","isWarning","Boolean","mounted","dropdown","UI","Dropdown","targetElement","$refs","clientInput","searchAction","searchOptions","types","scope","enableCreation","autocompleteDelay","items","clientsItems","messages","creationLegend","events","onSelect","setClient","onAdd","updateValue","onInput","EventEmitter","subscribe","onDropdownContactsLoaded","beforeUnmount","destroyPopupWindow","unsubscribe","computed","clientId","CrmEntity","Contact","$store","getters","Model","Clients","it","Company","fieldName","loc","inputPlaceholder","inputLabel","isNew","hasClient","isEditing","clearHint","leftIcon","IconSet","PERSON","COMPANY","searchIcon","SEARCH_2","arrowsIcon","SWAP","methods","getValue","getPopup","popupWindow","event","results","getData","dispatch","getClient","clear","$emit","isDisabled","popupAlertContainer","watch","setDefaultItems","components","Icon","PhoneInput","modelValue","Number","PhoneNumberInput","node","input","flagNode","flag","EmailInput","ClientPopupContent","adjustPosition","Function","currentClient","ButtonSize","ButtonColor","contact","company","isSaving","hasContact","hasCompany","cannotSave","clients","length","filledClients","filter","trim","contactInput","companyInput","beforeMount","setContact","setCompany","previousCompanyId","newCompanyId","linkedContact","clientService","getLinkedContactByCompany","saveClients","error","saveMany","Notifier","notify","text","message","closePopup","getClientsPopup","contactsPopup","companiesPopup","isShown","$nextTick","Button","ClientPopup","bindElement","HTMLElement","offsetTop","offsetLeft","popupId","config","width","offsetWidth","offsetHeight","autoHideHandler","target","content","isClickInside","popup","contains","isDropdownClick","getPopupContainer","isFillingTheContact","onAdjustPosition","StickyPopup"],"mappings":"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"}