this.BX=this.BX||{};this.BX.Booking=this.BX.Booking||{};(function(e,t,s,i,n,o,a){"use strict";var r=babelHelpers.classPrivateFieldLooseKey("isIncorrectTimeValue");var l=babelHelpers.classPrivateFieldLooseKey("beautifyTime");var u=babelHelpers.classPrivateFieldLooseKey("getMinutesAndHours");var h=babelHelpers.classPrivateFieldLooseKey("clearTimeString");var m=babelHelpers.classPrivateFieldLooseKey("areTimeDigitsCorrect");var c=babelHelpers.classPrivateFieldLooseKey("formatHours");var f=babelHelpers.classPrivateFieldLooseKey("formatMinutes");var d=babelHelpers.classPrivateFieldLooseKey("getMaxHours");class p{constructor(){Object.defineProperty(this,d,{value:P});Object.defineProperty(this,f,{value:$});Object.defineProperty(this,c,{value:T});Object.defineProperty(this,m,{value:w});Object.defineProperty(this,h,{value:M});Object.defineProperty(this,u,{value:v});Object.defineProperty(this,l,{value:b});Object.defineProperty(this,r,{value:g})}parseTime(e,t){if(babelHelpers.classPrivateFieldLooseBase(this,r)[r](e)){return t}let s=this.getMaskedTime(e);s=babelHelpers.classPrivateFieldLooseBase(this,l)[l](s);if(a.DateTimeFormat.isAmPmMode()){var i;let t=((i=e.toLowerCase().match(/[ap]/g))!=null?i:[]).pop();if(!t){const e=Number(babelHelpers.classPrivateFieldLooseBase(this,u)[u](s).hours);if(e>=8&&e<=11){t="a"}else{t="p"}}if(t==="a"){s+=" am"}if(t==="p"){s+=" pm"}}return new Date(`${a.DateTimeFormat.format("Y-m-d",t/1e3)} ${s}`).getTime()}getMaskedTime(e,t){let s="";const{hours:i,minutes:n}=babelHelpers.classPrivateFieldLooseBase(this,u)[u](e,t);if(i&&!n){s=String(i);if(e.length-s.length===1||e.includes(":")){s+=":"}}if(i&&n){s=`${i}:${n}`}if(a.DateTimeFormat.isAmPmMode()&&babelHelpers.classPrivateFieldLooseBase(this,h)[h](s)!==""){var o;const t=((o=e.toLowerCase().match(/[ap]/g))!=null?o:[]).pop();if(t==="a"){s=`${babelHelpers.classPrivateFieldLooseBase(this,l)[l](s)} am`}if(t==="p"){s=`${babelHelpers.classPrivateFieldLooseBase(this,l)[l](s)} pm`}}return s}formatTime(e){const t=a.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");return a.DateTimeFormat.format(t,e/1e3)}}function g(e){if(a.DateTimeFormat.isAmPmMode()){return e===""}const t=new Date(`${a.DateTimeFormat.format("Y-m-d")} ${e}`);return e===""||e[0]!=="0"&&t.getHours()===0}function b(e){if(babelHelpers.classPrivateFieldLooseBase(this,h)[h](e)===""){return""}if(!e.includes(":")){e+=":00"}if(e.indexOf(":")===e.length-1){e+="00"}let{hours:t,minutes:s}=babelHelpers.classPrivateFieldLooseBase(this,u)[u](e);t=`0${t}`.slice(-2);s=`0${s}`.slice(-2);return`${t}:${s}`}function v(e,t){const s=babelHelpers.classPrivateFieldLooseBase(this,h)[h](e,t);let i=0;let n=0;if(s.includes(":")){i=s.match(/\d*:/g)[0].slice(0,-1);n=s.match(/:\d*/g)[0].slice(1)}else{var o;const e=((o=s.match(/\d/g))!=null?o:[]).splice(0,4).map((e=>Number(e)));if(e.length===4&&e[0]>babelHelpers.classPrivateFieldLooseBase(this,d)[d]()/10){e.pop()}if(e.length===1){i=String(e[0])}if(e.length===2){i=`${e[0]}${e[1]}`;if(Number(i)>babelHelpers.classPrivateFieldLooseBase(this,d)[d]()){i=String(e[0]);n=String(e[1])}}if(e.length===3){if(a.DateTimeFormat.isAmPmMode()){if(e[0]>=1){i=String(e[0]);n=`${e[1]}${e[2]}`}else{i=`${e[0]}${e[1]}`;n=String(e[2])}}else if(Number(`${e[0]}${e[1]}`)<24){i=`${e[0]}${e[1]}`;n=String(e[2])}else{i=String(e[0]);n=`${e[1]}${e[2]}`}}if(e.length===4){i=`${e[0]}${e[1]}`;n=`${e[2]}${e[3]}`}}if(i){i=babelHelpers.classPrivateFieldLooseBase(this,c)[c](i)}if(n){n=babelHelpers.classPrivateFieldLooseBase(this,f)[f](n)}return{hours:i,minutes:n}}function M(e,t){let s=e.replaceAll(/[ap]/g,"").replaceAll(/\D/g,":");s=s.replace(/:*/,"");const i=s.indexOf(":");s=s.slice(0,i+1)+s.slice(i+1).replaceAll(":","");if(i!==-1){const e=babelHelpers.classPrivateFieldLooseBase(this,c)[c](s.match(/\d*:/g)[0].slice(0,-1));const i=s.match(/:\d*/g)[0].slice(1).slice(0,3);if(e.length===1&&i.length===3&&!Number.isNaN(Number(t))&&babelHelpers.classPrivateFieldLooseBase(this,m)[m](`${e}${i}`)){return`${e}${i}`}return`${e}:${i}`}return s.slice(0,4)}function w(e){const t=e.slice(0,2);const s=e.slice(2);return babelHelpers.classPrivateFieldLooseBase(this,c)[c](t)===t&&babelHelpers.classPrivateFieldLooseBase(this,f)[f](s)===s}function T(e){if(a.DateTimeFormat.isAmPmMode()){return e}const t=e[0];if(Number(t)>babelHelpers.classPrivateFieldLooseBase(this,d)[d]()/10){return`0${t}`}if(Number(e)<=babelHelpers.classPrivateFieldLooseBase(this,d)[d]()){var s;return`${t}${(s=e[1])!=null?s:""}`}return String(t)}function $(e){var t;const s=e[0];return s>=6?`0${s}`:`${s}${(t=e[1])!=null?t:""}`}function P(){return a.DateTimeFormat.isAmPmMode()?12:24}const F=new p;const B=n.Duration.getUnitDurations().H;const H=B/2;const S={emits:["update:modelValue","freeze","unfreeze","enterSave"],props:{modelValue:{type:Number,required:true},minTs:{type:Number,default:0},hasError:{type:Boolean,default:false}},data(){return{isMenuShown:false,focusByMouseDown:false,menuShownOnFocus:false}},mounted(){this.$refs.input.value=this.formatTime(this.timestamp)},computed:{...i.mapGetters({offset:`${o.Model.Interface}/offset`}),id(){return"booking-time-selector-menu"},timestamp(){return this.modelValue}},methods:{onFocus(){if(this.isMenuShown){return}setTimeout((()=>{if(!this.isMenuShown){this.menuShownOnFocus=true;this.showMenu();if(!this.focusByMouseDown){this.onAfterMenuShown()}}}),200)},onMouseDown(){if(!this.isMenuShown){this.focusByMouseDown=true;t.Event.bind(window,"dragend",this.onAfterMenuShown);t.Event.bind(window,"click",this.onAfterMenuShown)}},onClick(){if(this.isMenuShown){if(!this.menuShownOnFocus){this.hideMenu()}}else{this.showMenu()}},onAfterMenuShown(){setTimeout((()=>{this.menuShownOnFocus=false;this.focusByMouseDown=false;t.Event.unbind(window,"dragend",this.onAfterMenuShown);t.Event.unbind(window,"click",this.onAfterMenuShown)}),0)},onKeyDown(e){if(e.key==="Enter"&&this.timestamp===this.parseTime(this.$refs.input.value)){this.$emit("enterSave")}this.hideMenu()},showMenu(){s.MenuManager.show({id:this.id,className:"booking-time-selector-menu",bindElement:this.$refs.input,items:this.getMenuItems(),autoHide:true,maxHeight:300,minWidth:this.$refs.input.offsetWidth,events:{onShow:this.onShow,onClose:this.hideMenu,onDestroy:this.hideMenu}});this.getMenu().getPopupWindow().autoHideHandler=({target:e})=>{const t=this.getMenu().getPopupWindow();const s=e!==t.getPopupContainer()&&!t.getPopupContainer().contains(e);return s&&!this.menuShownOnFocus};this.scrollToClosestItem()},getMenuItems(){const e=new Date(this.timestamp);const t=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-this.offset;const s=Array.from({length:49}).fill(0).map(((e,s)=>t+s*H)).filter((e=>e>=this.minTs+B));if(this.minTs>0&&s[0]-(this.minTs+B)>=B/4){s.unshift(this.minTs+B)}if(this.minTs>0){s.unshift(this.minTs+B/4,this.minTs+B/2,this.minTs+3*B/4)}return s.map((e=>({id:e,html:`\n\t\t\t\t\t<span\n\t\t\t\t\t\tdata-element="booking-time-selector-item"\n\t\t\t\t\t\tdata-timestamp="${e}"\n\t\t\t\t\t>\n\t\t\t\t\t\t${this.formatTime(e)}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="menu-popup-item-hint">${this.getDurationHint(e)}</span>\n\t\t\t\t`,className:e===this.timestamp?"menu-popup-no-icon --selected":"menu-popup-no-icon",onclick:()=>{this.$emit("update:modelValue",e);this.getMenu().close()}})))},getDurationHint(e){if(this.minTs>0){const t=e-this.minTs;if(t<B){return new n.Duration(t).format()}const s=Math.round(t/H)*H;const i=new n.Duration(s).format();return t===s?i:this.loc("BOOKING_TIME_SELECTOR_APPROXIMATE_VALUE",{"#VALUE#":i})}return""},scrollToClosestItem(){var e;const t=this.getMenu().getMenuItems().reduce(((e,t)=>Math.abs(t.getId()-this.timestamp)<Math.abs(e.getId()-this.timestamp)?t:e));const s=t==null?void 0:(e=t.getLayout())==null?void 0:e.item;if(!s){return}const i=this.getMenu().getPopupWindow().getContentContainer();i.scrollTop=s.offsetTop-s.offsetHeight-36*3},isShown(){var e,t;return(e=(t=this.getMenu())==null?void 0:t.getPopupWindow().isShown())!=null?e:false},adjustMenuPosition(){var e;(e=this.getMenu())==null?void 0:e.getPopupWindow().adjustPosition()},getMenu(){return s.MenuManager.getMenuById(this.id)},onShow(){this.isMenuShown=true;this.freeze();this.$refs.input.select()},hideMenu(){this.isMenuShown=false;this.unfreeze();s.MenuManager.destroy(this.id)},freeze(){this.$emit("freeze")},unfreeze(){this.$emit("unfreeze")},onInput(e){const t=this.$refs.input;if(e.inputType==="deleteContentBackward"){return}t.value=F.getMaskedTime(t.value,e.data);if(t.value===this.formatTime(this.parseTime(t.value))){this.onChange()}},onChange(){let e=this.parseTime(this.$refs.input.value);if(e<this.minTs){var t;const s=this.formatTime(e);const i=this.getMenuItems().find((e=>e.text===s));e=(t=i==null?void 0:i.id)!=null?t:e}this.$refs.input.value=this.formatTime(e);this.$emit("update:modelValue",e)},formatTime(e){return F.formatTime(e+this.offset)},parseTime(e){return F.parseTime(e,this.timestamp+this.offset)-this.offset}},watch:{modelValue(){this.$refs.input.value=this.formatTime(this.timestamp)}},template:`\n\t\t<div\n\t\t\tclass="booking-time-selector"\n\t\t\t:class="{'--menu-shown': isMenuShown}"\n\t\t>\n\t\t\t<input\n\t\t\t\tclass="booking-time-selector-input"\n\t\t\t\t:class="{'--error': hasError}"\n\t\t\t\tref="input"\n\t\t\t\t@focus="onFocus"\n\t\t\t\t@mousedown="onMouseDown"\n\t\t\t\t@click="onClick"\n\t\t\t\t@keydown="onKeyDown"\n\t\t\t\t@input="onInput"\n\t\t\t\t@change="onChange"\n\t\t\t/>\n\t\t\t<div\n\t\t\t\tclass="ui-icon-set --chevron-down"\n\t\t\t></div>\n\t\t</div>\n\t`};e.TimeSelector=S})(this.BX.Booking.Component=this.BX.Booking.Component||{},BX,BX.Main,BX.Vue3.Vuex,BX.Booking.Lib,BX.Booking.Const,BX.Main);
//# sourceMappingURL=time-selector.bundle.map.js