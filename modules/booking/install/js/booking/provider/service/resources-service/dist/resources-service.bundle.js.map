{"version":3,"file":"resources-service.bundle.js","sources":["../src/mappers.js","../src/resources-service.js","../src/index.js"],"sourcesContent":["import type { ResourceModel } from 'booking.model.resources';\nimport type { ResourceDto } from './types';\n\nexport function mapDtoToModel(resourceDto: ResourceDto): ResourceModel\n{\n\treturn {\n\t\tid: resourceDto.id,\n\t\ttypeId: resourceDto.type.id,\n\t\tname: resourceDto.name,\n\t\tdescription: resourceDto.description,\n\t\tslotRanges: resourceDto.slotRanges.map((slotRange) => ({\n\t\t\t...slotRange,\n\t\t\tweekDays: Object.values(slotRange.weekDays),\n\t\t})),\n\t\tcounter: resourceDto.counter,\n\t\tisMain: resourceDto.isMain,\n\t\tisConfirmationNotificationOn: resourceDto.isConfirmationNotificationOn,\n\t\tisFeedbackNotificationOn: resourceDto.isFeedbackNotificationOn,\n\t\tisInfoNotificationOn: resourceDto.isInfoNotificationOn,\n\t\tisDelayedNotificationOn: resourceDto.isDelayedNotificationOn,\n\t\tisReminderNotificationOn: resourceDto.isReminderNotificationOn,\n\t\ttemplateTypeConfirmation: resourceDto.templateTypeConfirmation,\n\t\ttemplateTypeFeedback: resourceDto.templateTypeFeedback,\n\t\ttemplateTypeInfo: resourceDto.templateTypeInfo,\n\t\ttemplateTypeDelayed: resourceDto.templateTypeDelayed,\n\t\ttemplateTypeReminder: resourceDto.templateTypeReminder,\n\t\tcreatedBy: resourceDto.createdBy,\n\t\tcreatedAt: resourceDto.createdAt,\n\t\tupdatedAt: resourceDto.updatedAt,\n\t};\n}\n\nexport function mapModelToDto(resource: ResourceModel): ResourceDto\n{\n\treturn {\n\t\tid: resource.id,\n\t\ttype: {\n\t\t\tid: resource.typeId,\n\t\t},\n\t\tname: resource.name,\n\t\tdescription: resource.description,\n\t\tslotRanges: resource.slotRanges,\n\t\tcounter: null,\n\t\tisMain: resource.isMain,\n\t\tisConfirmationNotificationOn: resource.isConfirmationNotificationOn,\n\t\tisFeedbackNotificationOn: resource.isFeedbackNotificationOn,\n\t\tisInfoNotificationOn: resource.isInfoNotificationOn,\n\t\tisDelayedNotificationOn: resource.isDelayedNotificationOn,\n\t\tisReminderNotificationOn: resource.isReminderNotificationOn,\n\t\ttemplateTypeConfirmation: resource.templateTypeConfirmation,\n\t\ttemplateTypeFeedback: resource.templateTypeFeedback,\n\t\ttemplateTypeInfo: resource.templateTypeInfo,\n\t\ttemplateTypeDelayed: resource.templateTypeDelayed,\n\t\ttemplateTypeReminder: resource.templateTypeReminder,\n\t\tcreatedBy: null,\n\t\tcreatedAt: null,\n\t\tupdatedAt: null,\n\t};\n}\n","import type { AjaxResponse } from 'main.core';\nimport { Core } from 'booking.core';\nimport { ApiClient } from 'booking.lib.api-client';\nimport { Model } from 'booking.const';\nimport type { ResourceModel } from 'booking.model.resources';\nimport { mapModelToDto, mapDtoToModel } from './mappers';\n\nclass ResourceService\n{\n\tasync add(resource: ResourceModel): Promise<AjaxResponse>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst resourceDto = mapModelToDto(resource);\n\t\t\tconst data = await (new ApiClient()).post('Resource.add', { resource: resourceDto });\n\t\t\tconst createdResource = mapDtoToModel(data);\n\n\t\t\tCore.getStore().commit('resources/upsert', createdResource);\n\n\t\t\tif (createdResource.isMain)\n\t\t\t{\n\t\t\t\tawait Core.getStore().dispatch(`${Model.Favorites}/add`, createdResource.id);\n\t\t\t}\n\n\t\t\tif (Core.getStore().getters[`${Model.Interface}/canTurnOnTrial`])\n\t\t\t{\n\t\t\t\tvoid this.#turnOnTrial();\n\t\t\t}\n\n\t\t\tthis.#updateResourcesFromFavorites();\n\n\t\t\treturn data;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('ResourceService: add error', error);\n\n\t\t\treturn error;\n\t\t}\n\t}\n\n\tasync update(resource: ResourceModel): Promise<AjaxResponse>\n\t{\n\t\tconst id = resource.id;\n\t\tconst resourceBeforeUpdate = { ...Core.getStore().getters['resources/getById'](id) };\n\n\t\ttry\n\t\t{\n\t\t\tconst resourceDto = mapModelToDto(resource);\n\t\t\tconst data = await (new ApiClient()).post('Resource.update', { resource: resourceDto });\n\t\t\tconst updatedResource = mapDtoToModel(data);\n\n\t\t\tCore.getStore().commit('resources/upsert', updatedResource);\n\n\t\t\tif (resourceBeforeUpdate.isMain && !updatedResource.isMain)\n\t\t\t{\n\t\t\t\tawait Core.getStore().dispatch(`${Model.Favorites}/delete`, id);\n\t\t\t}\n\n\t\t\tthis.#updateResourcesFromFavorites();\n\n\t\t\treturn data;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('ResourceService: update error', error);\n\n\t\t\treturn error;\n\t\t}\n\t}\n\n\t#updateResourcesFromFavorites(): void\n\t{\n\t\tconst isFilterMode = Core.getStore().getters[`${Model.Interface}/isFilterMode`];\n\t\tif (isFilterMode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst favorites = Core.getStore().getters[`${Model.Favorites}/get`];\n\n\t\tvoid Core.getStore().dispatch(`${Model.Interface}/setResourcesIds`, favorites);\n\t}\n\n\tasync delete(resourceId: number): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tawait (new ApiClient()).post('Resource.delete', { id: resourceId });\n\n\t\t\tawait Promise.all([\n\t\t\t\tCore.getStore().dispatch(`${Model.Resources}/delete`, resourceId),\n\t\t\t\tCore.getStore().dispatch(`${Model.Favorites}/delete`, resourceId),\n\t\t\t\tCore.getStore().dispatch(`${Model.Interface}/deleteResourceId`, resourceId),\n\t\t\t]);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('ResourceService: delete error', error);\n\t\t}\n\t}\n\n\tasync hasBookings(resourceId: number): Promise<?boolean>\n\t{\n\t\ttry\n\t\t{\n\t\t\treturn (new ApiClient()).post('Resource.hasBookings', { resourceId });\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('ResourceService: hasBookings error', error);\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tasync #turnOnTrial(): Promise<void>\n\t{\n\t\tawait Promise.all([\n\t\t\tCore.getStore().dispatch(`${Model.Interface}/setCanTurnOnTrial`, false),\n\t\t\tCore.getStore().dispatch(`${Model.Interface}/setIsFeatureEnabled`, true),\n\t\t]);\n\n\t\tawait new Promise((resolve) => setTimeout(resolve, 2000));\n\n\t\tawait Core.getStore().dispatch(`${Model.Interface}/setIsShownTrialPopup`, true);\n\t}\n}\n\nexport const resourceService = new ResourceService();\n","import { mapModelToDto, mapDtoToModel } from './mappers';\n\nexport { resourceService } from './resources-service';\nexport const ResourceMappers = { mapModelToDto, mapDtoToModel };\nexport type { ResourceDto } from './types';\n"],"names":["mapDtoToModel","resourceDto","id","typeId","type","name","description","slotRanges","map","slotRange","weekDays","Object","values","counter","isMain","isConfirmationNotificationOn","isFeedbackNotificationOn","isInfoNotificationOn","isDelayedNotificationOn","isReminderNotificationOn","templateTypeConfirmation","templateTypeFeedback","templateTypeInfo","templateTypeDelayed","templateTypeReminder","createdBy","createdAt","updatedAt","mapModelToDto","resource","ResourceService","add","data","ApiClient","post","createdResource","Core","getStore","commit","dispatch","Model","Favorites","getters","Interface","error","console","update","resourceBeforeUpdate","updatedResource","delete","resourceId","Promise","all","Resources","hasBookings","resolve","isFilterMode","favorites","setTimeout","resourceService","ResourceMappers"],"mappings":"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"}