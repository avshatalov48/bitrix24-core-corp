this.BX=this.BX||{};this.BX.Booking=this.BX.Booking||{};(function(e,s,t,a,i,l){"use strict";var o=babelHelpers.classPrivateFieldLooseKey("bookingId");var r=babelHelpers.classPrivateFieldLooseKey("deal");var n=babelHelpers.classPrivateFieldLooseKey("booking");class d{constructor(e){Object.defineProperty(this,n,{get:b,set:void 0});Object.defineProperty(this,r,{get:c,set:void 0});Object.defineProperty(this,o,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e}hasDeal(){return Boolean(babelHelpers.classPrivateFieldLooseBase(this,r)[r])}openDeal(){t.SidePanel.Instance.open(`/crm/deal/details/${babelHelpers.classPrivateFieldLooseBase(this,r)[r].value}/`,{events:{onClose:()=>{var e;if((e=babelHelpers.classPrivateFieldLooseBase(this,r)[r])!=null&&e.value){void l.bookingService.getById(babelHelpers.classPrivateFieldLooseBase(this,o)[o])}}}})}createDeal(){var e;const a="bookingId";const l=new s.Uri("/crm/deal/details/0/");l.setQueryParam(a,babelHelpers.classPrivateFieldLooseBase(this,o)[o]);((e=babelHelpers.classPrivateFieldLooseBase(this,n)[n].clients)!=null?e:[]).forEach((e=>{const s={[i.CrmEntity.Contact]:"contact_id",[i.CrmEntity.Company]:"company_id"}[e.type.code];l.setQueryParam(s,e.id)}));t.SidePanel.Instance.open(l.toString(),{events:{onLoad:({slider:e})=>{e.getWindow().BX.Event.EventEmitter.subscribe("onCrmEntityCreate",(e=>{const[t]=e.getData();const l=t.entityTypeName===i.CrmEntity.Deal;const r=Number(new s.Uri(t.sliderUrl).getQueryParam(a));if(!l||r!==babelHelpers.classPrivateFieldLooseBase(this,o)[o]){return}const n=this.mapEntityInfoToDeal(t.entityInfo);this.saveDeal(n)}))},onClose:()=>{var e;if((e=babelHelpers.classPrivateFieldLooseBase(this,r)[r])!=null&&e.value){this.saveDeal(babelHelpers.classPrivateFieldLooseBase(this,r)[r])}}}})}mapEntityInfoToDeal(e){return{moduleId:i.Module.Crm,entityTypeId:e.typeName,value:e.id,data:[]}}saveDeal(e){const s=e?[e]:[];void l.bookingService.update({id:babelHelpers.classPrivateFieldLooseBase(this,o)[o],externalData:s})}}function c(){var e,s;return(e=(s=babelHelpers.classPrivateFieldLooseBase(this,n)[n].externalData)==null?void 0:s.find((e=>e.entityTypeId===i.CrmEntity.Deal)))!=null?e:null}function b(){return a.Core.getStore().getters[`${i.Model.Bookings}/getById`](babelHelpers.classPrivateFieldLooseBase(this,o)[o])}e.DealHelper=d})(this.BX.Booking.Lib=this.BX.Booking.Lib||{},BX,BX,BX.Booking,BX.Booking.Const,BX.Booking.Provider.Service);
//# sourceMappingURL=deal-helper.bundle.map.js