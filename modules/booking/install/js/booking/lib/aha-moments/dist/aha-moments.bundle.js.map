{"version":3,"file":"aha-moments.bundle.js","sources":["../src/aha-moments.js"],"sourcesContent":["import { Event } from 'main.core';\nimport { PopupManager } from 'main.popup';\nimport 'spotlight';\n\nimport { Guide } from 'ui.tour';\nimport { AutoLauncher } from 'ui.auto-launch';\nimport { BannerDispatcher } from 'ui.banner-dispatcher';\n\nimport { Core } from 'booking.core';\nimport { AhaMoment, Model, Option } from 'booking.const';\nimport { optionService } from 'booking.provider.service.option-service';\n\ntype Params = {\n\tid: string,\n\ttitle: string,\n\ttext: string,\n\tarticle: {\n\t\tcode: string,\n\t\tanchorCode?: string,\n\t},\n\ttarget: HTMLElement,\n\ttargetContainer?: HTMLElement,\n\ttop?: boolean,\n};\n\nclass AhaMoments\n{\n\t#bookingForAhaMoment: number;\n\t#shownPopups: { [name: string]: boolean } = {};\n\n\tshow(params: Params): Promise<void>\n\t{\n\t\tif (!AutoLauncher.isEnabled())\n\t\t{\n\t\t\tAutoLauncher.enable();\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tBannerDispatcher.critical.toQueue(async (onDone) => {\n\t\t\t\tawait this.showGuide(params);\n\n\t\t\t\tonDone();\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tshowGuide(params: Params): Promise<void>\n\t{\n\t\tconst guide = new Guide({\n\t\t\tid: params.id,\n\t\t\toverlay: false,\n\t\t\tsimpleMode: true,\n\t\t\tonEvents: true,\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: params.target,\n\t\t\t\t\ttitle: params.title,\n\t\t\t\t\ttext: params.text,\n\t\t\t\t\tposition: params.top ? 'top' : 'bottom',\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: !params.top,\n\t\t\t\t\t\tbottom: Boolean(params.top),\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t\tarticle: params.article.code,\n\t\t\t\t\tarticleAnchor: params.article.anchorCode,\n\t\t\t\t},\n\t\t\t],\n\t\t\ttargetContainer: params.targetContainer,\n\t\t});\n\n\t\tconst pulsar = new BX.SpotLight(\n\t\t\t{\n\t\t\t\ttargetElement: params.target,\n\t\t\t\ttargetVertex: 'middle-center',\n\t\t\t\tcolor: 'var(--ui-color-primary)',\n\t\t\t},\n\t\t);\n\n\t\treturn new Promise((resolve) => {\n\t\t\tconst guidePopup = guide.getPopup();\n\n\t\t\tguidePopup.setAutoHide(true);\n\t\t\tguidePopup.setAngle({ offset: params.target.offsetWidth / 2 });\n\n\t\t\tconst adjustPosition = () => {\n\t\t\t\tguidePopup.adjustPosition();\n\t\t\t};\n\n\t\t\tconst onClose = () => {\n\t\t\t\tpulsar.close();\n\t\t\t\tEvent.unbind(document, 'scroll', adjustPosition, true);\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\tguidePopup.subscribe('onClose', onClose);\n\t\t\tguidePopup.subscribe('onDestroy', onClose);\n\n\t\t\tpulsar.show();\n\t\t\tguide.start();\n\n\t\t\tguidePopup.adjustPosition({\n\t\t\t\tforceTop: !params.top,\n\t\t\t\tforceBindPosition: true,\n\t\t\t});\n\n\t\t\tEvent.bind(document, 'scroll', adjustPosition, true);\n\t\t});\n\t}\n\n\tshouldShow(ahaMoment: $Values<typeof AhaMoment>, params: Object = {}): boolean\n\t{\n\t\treturn {\n\t\t\t[AhaMoment.Banner]: this.#shouldShowBanner(ahaMoment),\n\t\t\t[AhaMoment.TrialBanner]: this.#wasNotShown(ahaMoment),\n\t\t\t[AhaMoment.AddResource]: this.#shouldShowAddResource(),\n\t\t\t[AhaMoment.MessageTemplate]: this.#wasNotShown(ahaMoment),\n\t\t\t[AhaMoment.AddClient]: this.#shouldShowAddClient(params),\n\t\t\t[AhaMoment.ResourceWorkload]: this.#wasNotShown(ahaMoment),\n\t\t\t[AhaMoment.ResourceIntersection]: this.#shouldShowResourceIntersection(),\n\t\t\t[AhaMoment.ExpandGrid]: this.#shouldShowExpandGrid(),\n\t\t\t[AhaMoment.SelectResources]: this.#shouldShowSelectResources(),\n\t\t}[ahaMoment];\n\t}\n\n\tsetShown(ahaMoment: $Values<typeof AhaMoment>): void\n\t{\n\t\tconst optionName = this.#getOptionName(ahaMoment);\n\n\t\tthis.setPopupShown(ahaMoment);\n\n\t\tvoid optionService.setBool(optionName, true);\n\t}\n\n\tsetPopupShown(ahaMoment: $Values<typeof AhaMoment>): void\n\t{\n\t\tthis.#shownPopups[ahaMoment] = true;\n\t}\n\n\tsetBookingForAhaMoment(bookingId: number): void\n\t{\n\t\tthis.#bookingForAhaMoment ??= bookingId;\n\t}\n\n\t#shouldShowBanner(ahaMoment: $Values<typeof AhaMoment>): boolean\n\t{\n\t\tconst canTurnOnDemo = Core.getStore().getters[`${Model.Interface}/canTurnOnDemo`];\n\n\t\tif (canTurnOnDemo)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#wasNotShown(ahaMoment);\n\t\t}\n\t}\n\n\t#shouldShowAddResource(): boolean\n\t{\n\t\tconst wasNotShown = this.#wasNotShown(AhaMoment.AddResource);\n\t\tconst isLoaded = Core.getStore().getters[`${Model.Interface}/isLoaded`];\n\t\tconst resourcesIds = Core.getStore().getters[`${Model.Interface}/resourcesIds`];\n\n\t\treturn wasNotShown && isLoaded && resourcesIds.length === 0;\n\t}\n\n\t#shouldShowAddClient(params: { bookingId: number }): boolean\n\t{\n\t\tconst wasNotShown = this.#wasNotShown(AhaMoment.AddClient);\n\t\tconst isBookingForAhaMoment = this.#bookingForAhaMoment === params.bookingId;\n\n\t\treturn wasNotShown && isBookingForAhaMoment;\n\t}\n\n\t#shouldShowResourceIntersection(): boolean\n\t{\n\t\tconst wasNotShown = this.#wasNotShown(AhaMoment.ResourceIntersection);\n\t\tconst isLoaded = Core.getStore().getters[`${Model.Interface}/isLoaded`];\n\t\tconst resourcesIds = Core.getStore().getters[`${Model.Interface}/resourcesIds`];\n\n\t\treturn wasNotShown && isLoaded && resourcesIds.length >= 2 && !PopupManager.isAnyPopupShown();\n\t}\n\n\t#shouldShowExpandGrid(): boolean\n\t{\n\t\tconst wasNotShown = this.#wasNotShown(AhaMoment.ExpandGrid);\n\t\tconst previousAhaMomentsShown = [AhaMoment.ResourceWorkload, AhaMoment.ResourceWorkload]\n\t\t\t.every((ahaMoment) => !this.#wasNotShown(ahaMoment))\n\t\t;\n\n\t\treturn wasNotShown && previousAhaMomentsShown && !PopupManager.isAnyPopupShown();\n\t}\n\n\t#shouldShowSelectResources(): boolean\n\t{\n\t\tconst wasNotShown = this.#wasNotShown(AhaMoment.SelectResources);\n\t\tconst previousAhaMomentShown = !this.#wasNotShown(AhaMoment.ExpandGrid);\n\n\t\treturn wasNotShown && previousAhaMomentShown && !PopupManager.isAnyPopupShown();\n\t}\n\n\t#wasNotShown(ahaMoment: $Values<typeof AhaMoment>): boolean\n\t{\n\t\tconst { ahaMoments } = Core.getParams();\n\n\t\treturn ahaMoments[ahaMoment] && !this.#shownPopups[ahaMoment];\n\t}\n\n\t#getOptionName(ahaMoment: $Values<typeof AhaMoment>): $Values<typeof Option>\n\t{\n\t\treturn {\n\t\t\t[AhaMoment.Banner]: Option.AhaBanner,\n\t\t\t[AhaMoment.TrialBanner]: Option.AhaTrialBanner,\n\t\t\t[AhaMoment.AddResource]: Option.AhaAddResource,\n\t\t\t[AhaMoment.MessageTemplate]: Option.AhaMessageTemplate,\n\t\t\t[AhaMoment.AddClient]: Option.AhaAddClient,\n\t\t\t[AhaMoment.ResourceWorkload]: Option.AhaResourceWorkload,\n\t\t\t[AhaMoment.ResourceIntersection]: Option.AhaResourceIntersection,\n\t\t\t[AhaMoment.ExpandGrid]: Option.AhaExpandGrid,\n\t\t\t[AhaMoment.SelectResources]: Option.AhaSelectResources,\n\t\t}[ahaMoment];\n\t}\n}\n\nexport const ahaMoments = new AhaMoments();\n"],"names":["AhaMoments","show","params","AutoLauncher","isEnabled","enable","Promise","resolve","BannerDispatcher","critical","toQueue","onDone","showGuide","guide","Guide","id","overlay","simpleMode","onEvents","steps","target","title","text","position","top","condition","bottom","Boolean","color","article","code","articleAnchor","anchorCode","targetContainer","pulsar","BX","SpotLight","targetElement","targetVertex","guidePopup","getPopup","setAutoHide","setAngle","offset","offsetWidth","adjustPosition","onClose","close","Event","unbind","document","subscribe","start","forceTop","forceBindPosition","bind","shouldShow","ahaMoment","AhaMoment","Banner","TrialBanner","AddResource","MessageTemplate","AddClient","ResourceWorkload","ResourceIntersection","ExpandGrid","SelectResources","setShown","optionName","setPopupShown","optionService","setBool","setBookingForAhaMoment","bookingId","canTurnOnDemo","Core","getStore","getters","Model","Interface","wasNotShown","isLoaded","resourcesIds","length","isBookingForAhaMoment","PopupManager","isAnyPopupShown","previousAhaMomentsShown","every","previousAhaMomentShown","ahaMoments","getParams","Option","AhaBanner","AhaTrialBanner","AhaAddResource","AhaMessageTemplate","AhaAddClient","AhaResourceWorkload","AhaResourceIntersection","AhaExpandGrid","AhaSelectResources"],"mappings":"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"}