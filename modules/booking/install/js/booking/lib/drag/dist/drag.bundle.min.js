this.BX=this.BX||{};this.BX.Booking=this.BX.Booking||{};(function(e,s,t,o,a,i,l,r,n){"use strict";var d=babelHelpers.classPrivateFieldLooseKey("params");var c=babelHelpers.classPrivateFieldLooseKey("dragManager");var b=babelHelpers.classPrivateFieldLooseKey("onDragStart");var g=babelHelpers.classPrivateFieldLooseKey("onDragMove");var v=babelHelpers.classPrivateFieldLooseKey("onDragEnd");var p=babelHelpers.classPrivateFieldLooseKey("getBookingElements");var u=babelHelpers.classPrivateFieldLooseKey("getAdditionalBookingElements");var h=babelHelpers.classPrivateFieldLooseKey("updateScroll");var B=babelHelpers.classPrivateFieldLooseKey("getSpeed");var P=babelHelpers.classPrivateFieldLooseKey("isDragDeleteHovered");var f=babelHelpers.classPrivateFieldLooseKey("moveBooking");var F=babelHelpers.classPrivateFieldLooseKey("timeFormatted");var m=babelHelpers.classPrivateFieldLooseKey("draggedBooking");var L=babelHelpers.classPrivateFieldLooseKey("draggedBookingId");var H=babelHelpers.classPrivateFieldLooseKey("draggedBookingResourceId");var y=babelHelpers.classPrivateFieldLooseKey("hoveredCell");var k=babelHelpers.classPrivateFieldLooseKey("offset");var T=babelHelpers.classPrivateFieldLooseKey("gridWrap");var D=babelHelpers.classPrivateFieldLooseKey("gridColumns");class I{constructor(e){Object.defineProperty(this,D,{get:q,set:void 0});Object.defineProperty(this,T,{get:_,set:void 0});Object.defineProperty(this,k,{get:N,set:void 0});Object.defineProperty(this,y,{get:z,set:void 0});Object.defineProperty(this,H,{get:x,set:void 0});Object.defineProperty(this,L,{get:A,set:void 0});Object.defineProperty(this,m,{get:w,set:void 0});Object.defineProperty(this,F,{get:E,set:void 0});Object.defineProperty(this,f,{value:R});Object.defineProperty(this,P,{value:X});Object.defineProperty(this,B,{value:$});Object.defineProperty(this,h,{value:j});Object.defineProperty(this,u,{value:M});Object.defineProperty(this,p,{value:K});Object.defineProperty(this,v,{value:S});Object.defineProperty(this,g,{value:C});Object.defineProperty(this,b,{value:O});Object.defineProperty(this,d,{writable:true,value:void 0});Object.defineProperty(this,c,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e;babelHelpers.classPrivateFieldLooseBase(this,c)[c]=new a.Draggable({container:babelHelpers.classPrivateFieldLooseBase(this,d)[d].container,draggable:babelHelpers.classPrivateFieldLooseBase(this,d)[d].draggable,elementsPreventingDrag:[".booking-booking-resize"],delay:200});babelHelpers.classPrivateFieldLooseBase(this,c)[c].subscribe("start",babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this));babelHelpers.classPrivateFieldLooseBase(this,c)[c].subscribe("move",babelHelpers.classPrivateFieldLooseBase(this,g)[g].bind(this));babelHelpers.classPrivateFieldLooseBase(this,c)[c].subscribe("end",babelHelpers.classPrivateFieldLooseBase(this,v)[v].bind(this))}destroy(){babelHelpers.classPrivateFieldLooseBase(this,c)[c].destroy()}}async function O(e){const{draggable:o,source:{dataset:a},clientX:n,clientY:c}=e.getData();await Promise.all([l.Core.getStore().dispatch(`${i.Model.Interface}/setDraggedBookingId`,Number(a.id)),l.Core.getStore().dispatch(`${i.Model.Interface}/setDraggedBookingResourceId`,Number(a.resourceId))]);s.Dom.style(o,"pointer-events","none");babelHelpers.classPrivateFieldLooseBase(this,u)[u](babelHelpers.classPrivateFieldLooseBase(this,d)[d].container).forEach((e=>{const t=s.Runtime.clone(e);o.append(t);const a=e.getBoundingClientRect().left-o.getBoundingClientRect().left;const i=e.getBoundingClientRect().top-o.getBoundingClientRect().top;s.Dom.style(t,"transition","none");s.Dom.style(t,"transform",`translate(${a}px, ${i}px)`);s.Dom.style(t,"animation","none")}));babelHelpers.classPrivateFieldLooseBase(this,p)[p](babelHelpers.classPrivateFieldLooseBase(this,d)[d].container).forEach((e=>{if(o.contains(e)){return}s.Dom.addClass(e,"--drag-source");s.Dom.style(e,"visibility","visible")}));const b=n-o.getBoundingClientRect().left;const g=c-o.getBoundingClientRect().top;babelHelpers.classPrivateFieldLooseBase(this,p)[p](o).forEach((e=>{s.Dom.style(e,"transform-origin",`${b}px ${g}px`)}));t.PopupManager.getPopups().forEach((e=>e.close()));void r.busySlots.loadBusySlots()}function C(e){const{draggable:t,clientX:o,clientY:a}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,u)[u](t).forEach(((e,t)=>{s.Dom.style(e,"transition","");s.Dom.style(e,"transform",`rotate(${t===1?4:0}deg)`);s.Dom.style(e,"zIndex",`-${t+1}`)}));if(babelHelpers.classPrivateFieldLooseBase(this,P)[P](o,a)){s.Dom.addClass(t,"--deleting")}else{s.Dom.removeClass(t,"--deleting")}t.querySelectorAll('[data-element="booking-booking-time"]').forEach((e=>{e.innerText=babelHelpers.classPrivateFieldLooseBase(this,F)[F]}));babelHelpers.classPrivateFieldLooseBase(this,h)[h](t,o,a)}async function S(){clearInterval(this.scrollTimeout);babelHelpers.classPrivateFieldLooseBase(this,p)[p](babelHelpers.classPrivateFieldLooseBase(this,d)[d].container).forEach((e=>{s.Dom.removeClass(e,"--drag-source");s.Dom.style(e,"visibility","")}));if(babelHelpers.classPrivateFieldLooseBase(this,y)[y]){babelHelpers.classPrivateFieldLooseBase(this,f)[f]({booking:babelHelpers.classPrivateFieldLooseBase(this,m)[m],resourceId:babelHelpers.classPrivateFieldLooseBase(this,H)[H],cell:babelHelpers.classPrivateFieldLooseBase(this,y)[y]})}await l.Core.getStore().dispatch(`${i.Model.Interface}/setDraggedBookingId`,null);void r.busySlots.loadBusySlots()}function K(e){const s="booking-booking";const t=babelHelpers.classPrivateFieldLooseBase(this,L)[L];return[...e.querySelectorAll(`[data-element="${s}"][data-id="${t}"]`)]}function M(e){const s="booking-booking";const t=babelHelpers.classPrivateFieldLooseBase(this,L)[L];const o=babelHelpers.classPrivateFieldLooseBase(this,H)[H];return[...e.querySelectorAll(`[data-element="${s}"][data-id="${t}"]:not([data-resource-id="${o}"])`)]}function j(e,s,t){clearTimeout(this.scrollTimeout);if(babelHelpers.classPrivateFieldLooseBase(this,P)[P](s,t)){return}const o=babelHelpers.classPrivateFieldLooseBase(this,T)[T].getBoundingClientRect();const a=e.getBoundingClientRect();this.scrollTimeout=setTimeout((()=>babelHelpers.classPrivateFieldLooseBase(this,h)[h](e)),16);if(a.left<o.left){babelHelpers.classPrivateFieldLooseBase(this,D)[D].scrollLeft-=babelHelpers.classPrivateFieldLooseBase(this,B)[B](a.left,o.left)}else if(a.right>o.right){babelHelpers.classPrivateFieldLooseBase(this,D)[D].scrollLeft+=babelHelpers.classPrivateFieldLooseBase(this,B)[B](a.right,o.right)}else if(a.top<o.top){babelHelpers.classPrivateFieldLooseBase(this,T)[T].scrollTop-=babelHelpers.classPrivateFieldLooseBase(this,B)[B](a.top,o.top)}else if(a.bottom>o.bottom){babelHelpers.classPrivateFieldLooseBase(this,T)[T].scrollTop+=2*babelHelpers.classPrivateFieldLooseBase(this,B)[B](a.bottom,o.bottom)}else{clearTimeout(this.scrollTimeout)}}function $(e,s){return(Math.floor(Math.sqrt(Math.abs(e-s)))+1)/2}function X(e,s){var t;if(!e||!s){return false}return(t=document.elementFromPoint(e,s))==null?void 0:t.closest('[data-element="booking-drag-delete"]')}function R({booking:e,resourceId:s,cell:t}){if(t.fromTs===e.dateFromTs&&t.toTs===e.dateToTs&&t.resourceId===s){return}const o=e.resourcesIds.includes(t.resourceId)?e.resourcesIds:e.resourcesIds.filter((e=>e!==s));void n.bookingService.update({id:e.id,dateFromTs:t.fromTs,dateToTs:t.toTs,resourcesIds:[...new Set([t.resourceId,...o])],timezoneFrom:e.timezoneFrom,timezoneTo:e.timezoneTo})}function E(){var e,t,a,i;const l=o.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const r=(e=(t=babelHelpers.classPrivateFieldLooseBase(this,y)[y])==null?void 0:t.fromTs)!=null?e:babelHelpers.classPrivateFieldLooseBase(this,m)[m].dateFromTs;const n=(a=(i=babelHelpers.classPrivateFieldLooseBase(this,y)[y])==null?void 0:i.toTs)!=null?a:babelHelpers.classPrivateFieldLooseBase(this,m)[m].dateToTs;return s.Loc.getMessage("BOOKING_BOOKING_TIME_RANGE",{"#FROM#":o.DateTimeFormat.format(l,(r+babelHelpers.classPrivateFieldLooseBase(this,k)[k])/1e3),"#TO#":o.DateTimeFormat.format(l,(n+babelHelpers.classPrivateFieldLooseBase(this,k)[k])/1e3)})}function w(){var e;return(e=l.Core.getStore().getters[`${i.Model.Bookings}/getById`](babelHelpers.classPrivateFieldLooseBase(this,L)[L]))!=null?e:null}function A(){return l.Core.getStore().getters[`${i.Model.Interface}/draggedBookingId`]}function x(){return l.Core.getStore().getters[`${i.Model.Interface}/draggedBookingResourceId`]}function z(){return l.Core.getStore().getters[`${i.Model.Interface}/hoveredCell`]}function N(){return l.Core.getStore().getters[`${i.Model.Interface}/offset`]}function _(){return BX("booking-booking-grid-wrap")}function q(){return BX("booking-booking-grid-columns")}e.Drag=I})(this.BX.Booking.Lib=this.BX.Booking.Lib||{},BX,BX.Main,BX.Main,BX.UI.DragAndDrop,BX.Booking.Const,BX.Booking,BX.Booking.Lib,BX.Booking.Provider.Service);
//# sourceMappingURL=drag.bundle.map.js