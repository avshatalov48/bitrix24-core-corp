this.BX=this.BX||{};(function(e,a){"use strict";function t(e,a){i(e,a);a.add(e)}function n(e,a,t){i(e,a);a.set(e,t)}function i(e,a){if(a.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function r(e,a,t){if(!a.has(e)){throw new TypeError("attempted to get private field on non-instance")}return t}var s="mail";var o={};var l=new WeakMap;var d=new WeakSet;var c=function(){function e(a){babelHelpers.classCallCheck(this,e);t(this,d);n(this,l,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,l,a);this.sliderId="MailSecretary:".concat(s+babelHelpers.classPrivateFieldGet(this,l)).concat(Math.floor(Math.random()*1e3));this.contextBx=window.top.BX||window.BX;this.subscribe()}babelHelpers.createClass(e,[{key:"openChat",value:function e(){var a=this;return BX.ajax.runAction("mail.secretary.createChatFromMessage",{data:{messageId:babelHelpers.classPrivateFieldGet(this,l)}}).then((function(e){if(top.window.BXIM&&e.data){top.BXIM.openMessenger("chat"+parseInt(e.data))}}),(function(e){r(a,d,u).call(a,e.errors)}))}},{key:"openCalendarEvent",value:function e(){var a=this;return BX.ajax.runAction("mail.secretary.getCalendarEventDataFromMessage",{data:{messageId:babelHelpers.classPrivateFieldGet(this,l)}}).then((function(e){if(e.data&&e.data.isNewEvent){new(window.top.BX||window.BX).Calendar.SliderLoader(0,{sliderId:a.sliderId,entryName:e.data.name,entryDescription:e.data.desc}).show()}else if(e.data&&e.data.isIcal){return BX.ajax.runComponentAction("bitrix:mail.client","ical",{mode:"ajax",data:{messageId:babelHelpers.classPrivateFieldGet(a,l),action:"question"}})}}),(function(e){r(a,d,u).call(a,e.errors)})).then((function(e){if(e.data&&e.data.eventId){new(window.top.BX||window.BX).Calendar.SliderLoader(e.data.eventId).show();var a=new BX.Mail.MessageGrid;a.reloadTable()}}))}},{key:"onCalendarSave",value:function e(a){if(a instanceof this.contextBx.Event.BaseEvent){var t=a.getData();if(t.sliderId===this.sliderId){BX.ajax.runAction("mail.secretary.onCalendarSave",{data:{messageId:babelHelpers.classPrivateFieldGet(this,l),calendarEventId:t.responseData.entryId}})}}}},{key:"subscribe",value:function e(){this.contextBx.Event.EventEmitter.subscribe("BX.Calendar:onEntrySave",this.onCalendarSave.bind(this))}},{key:"destroy",value:function e(){this.contextBx.Event.EventEmitter.unsubscribe("BX.Calendar:onEntrySave",this.onCalendarSave)}}],[{key:"getInstance",value:function t(n){if(a.Type.isUndefined(o[n])){o[n]=new e(n)}return o[n]}}]);return e}();function u(e){if(a.Type.isArray(e)){var t=[];e.forEach((function(e){t.push(e.message)}));alert(t.join("\n"))}else{alert("action can't be performed")}}e.Secretary=c})(this.BX.Mail=this.BX.Mail||{},BX);
//# sourceMappingURL=secretary.bundle.map.js