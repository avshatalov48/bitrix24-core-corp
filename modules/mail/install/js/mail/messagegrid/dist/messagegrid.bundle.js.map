{"version":3,"file":"messagegrid.bundle.js","sources":["../src/messagegrid.js"],"sourcesContent":["import 'ui.design-tokens';\nimport 'ui.buttons';\nimport 'ui.fonts.opensans';\nimport './css/style.css';\nimport { EventEmitter } from 'main.core.events';\nimport { Dom, Tag, Loc, Type } from 'main.core';\n\nexport class MessageGrid\n{\n\tEXPAND_LICENSE_URL = '/settings/license_all.php';\n\t#loadingMessagesStubInGridWrapper;\n\t#gridWrapper;\n\t#id;\n\t#allRowsSelectedStatus = false;\n\t#panel;\n\t#checkboxNodeForCheckAll;\n\n\tconstructor(mailboxIsAvailable = false)\n\t{\n\t\tthis.mailboxIsAvailable = mailboxIsAvailable;\n\t\tif (typeof MessageGrid.instance === 'object') {\n\t\t\treturn MessageGrid.instance\n\t\t}\n\t\tMessageGrid.instance = this;\n\n\t\tEventEmitter.subscribe('Grid::allRowsSelected', (event) =>\n\t\t{\n\t\t\tif(this.#compareGrid(event)) this.#allRowsSelectedStatus = true;\n\t\t})\n\n\t\tEventEmitter.subscribe('Grid::allRowsUnselected', (event) =>\n\t\t{\n\t\t\tif(this.#compareGrid(event)) this.#allRowsSelectedStatus = false;\n\t\t})\n\n\t\tEventEmitter.subscribe('Grid::updated', (event) =>\n\t\t{\n\t\t\tif(this.#compareGrid(event) && this.#allRowsSelectedStatus)\n\t\t\t{\n\t\t\t\tif(this.#checkboxNodeForCheckAll !== undefined)\n\t\t\t\t{\n\t\t\t\t\tthis.#checkboxNodeForCheckAll.checked = true;\n\t\t\t\t}\n\t\t\t\tthis.selectAll();\n\t\t\t}\n\t\t})\n\n\t\tEventEmitter.subscribe('Mail::resetGridSelection', (event) =>\n\t\t{\n\t\t\tthis.#allRowsSelectedStatus = false;\n\t\t})\n\n\t\tEventEmitter.subscribe('Mail::directoryChanged', () =>\n\t\t{\n\t\t\tthis.#allRowsSelectedStatus = false;\n\t\t})\n\n\t\tEventEmitter.subscribe('Grid::thereSelectedRows', (event) =>\n\t\t{\n\t\t\tif(this.#compareGrid(event)) this.#allRowsSelectedStatus = false;\n\t\t})\n\n\t\tEventEmitter.subscribe('Grid::updated', (event) => {\n\t\t\tconst [grid] = event.getCompatData();\n\t\t\tif(grid !== undefined && Type.isFunction(grid.getId) && grid.getId() === this.getId()){\n\t\t\t\tthis.replaceTheBlankEmailStub();\n\t\t\t}\n\t\t});\n\t\tthis.replaceTheBlankEmailStub();\n\n\t\treturn MessageGrid.instance\n\t}\n\n\tsetGridWrapper(gridWrapper)\n\t{\n\t\tthis.#gridWrapper = gridWrapper;\n\t}\n\n\tgetGridWrapper()\n\t{\n\t\treturn this.#gridWrapper;\n\t}\n\n\tenableLoadingMessagesStub()\n\t{\n\t\tif(this.getGridWrapper()!==undefined)\n\t\t{\n\t\t\tthis.#loadingMessagesStubInGridWrapper = this.getGridWrapper().appendChild(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"mail-msg-list-grid-loader mail-msg-list-grid-loader-animate\">\n\t\t\t\t\t\t<div class=\"mail-msg-list-grid-loader-inner\">\n\t\t\t\t\t\t\t<img src=\"/bitrix/images/mail/mail-loader.svg\" alt=\"Load...\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`\n\t\t\t);\n\n\t\t\tsetTimeout(()=>{\n\t\t\t\tif(this.#loadingMessagesStubInGridWrapper !== undefined)\n\t\t\t\t{\n\t\t\t\t\tthis.#loadingMessagesStubInGridWrapper.remove();\n\t\t\t\t}\n\t\t\t}, 15000);\n\t\t}\n\t}\n\n\treplaceTheBlankEmailStub()\n\t{\n\t\tlet blankEmailStubs = document.getElementsByClassName(\"main-grid-row main-grid-row-empty main-grid-row-body\");\n\t\tif(blankEmailStubs.length > 0)\n\t\t{\n\t\t\tlet blankEmailStub = blankEmailStubs[0];\n\t\t\tif(blankEmailStub.firstElementChild.firstElementChild)\n\t\t\t{\n\t\t\t\tif (this.mailboxIsAvailable)\n\t\t\t\t{\n\t\t\t\t\tblankEmailStub.firstElementChild.firstElementChild.replaceWith(\n\t\t\t\t\t\tTag.render`\n\t\t\t\t\t\t<div class=\"mail-msg-list-grid-empty\">\n\t\t\t\t\t\t<div class=\"mail-msg-list-grid-empty-inner\">\n\t\t\t\t\t\t<div class=\"mail-msg-list-grid-empty-title\">${Loc.getMessage(\"MAIL_MSG_LIST_GRID_EMPTY_TITLE\")}</div>\n\t\t\t\t\t\t<p class=\"mail-msg-list-grid-empty-text\">${Loc.getMessage(\"MAIL_MSG_LIST_GRID_EMPTY_TEXT_1\")}</p>\n\t\t\t\t\t\t<p class=\"mail-msg-list-grid-empty-text\">${Loc.getMessage(\"MAIL_MSG_LIST_GRID_EMPTY_TEXT_2\")}</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tlet tariffButton = Tag.render`\n\t\t\t\t\t<button class=\"ui-btn ui-btn-round ui-btn-lg ui-btn-success\">\n\t\t\t\t\t\t${Loc.getMessage(\"MAIL_MSG_LIST_MAILBOX_TARIFF_RESTRICTIONS_BUTTON\")}\n\t\t\t\t\t</button>`;\n\n\t\t\t\t\ttariffButton.onclick = (event) => {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\twindow.open(this.EXPAND_LICENSE_URL, '_blank')\n\t\t\t\t\t};\n\n\t\t\t\t\tconst tariffPlug = Tag.render`\n\t\t\t\t\t<div class=\"mail-msg-list-grid-empty\">\n\t\t\t\t\t\t<div class=\"mail-msg-list-grid-empty-inner\">\n\t\t\t\t\t\t\t<div class=\"mail-msg-list-grid-empty-title\">${Loc.getMessage(\"MAIL_MSG_LIST_MAILBOX_TARIFF_RESTRICTIONS_TITLE\")}</div>\n\t\t\t\t\t\t\t<p class=\"mail-msg-list-grid-empty-text\">${Loc.getMessage(\"MAIL_MSG_LIST_MAILBOX_TARIFF_RESTRICTIONS_TEXT_1\")}</p>\n\t\t\t\t\t\t\t<p class=\"mail-msg-list-grid-empty-text\">${Loc.getMessage(\"MAIL_MSG_LIST_MAILBOX_TARIFF_RESTRICTIONS_TEXT_2\")}</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<br/>\n\t\t\t\t\t</div>`;\n\n\t\t\t\t\ttariffPlug.append(tariffButton);\n\t\t\t\t\tblankEmailStub.firstElementChild.firstElementChild.replaceWith(tariffPlug);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsetCheckboxNodeForCheckAll(node)\n\t{\n\t\tthis.#checkboxNodeForCheckAll = node;\n\t}\n\n\tsetPanel(panel)\n\t{\n\t\tthis.#panel = panel;\n\t}\n\n\tgetPanel()\n\t{\n\t\treturn this.#panel;\n\t}\n\n\thidePanel()\n\t{\n\t\tconst panel = this.getPanel();\n\t\tif(panel && Type.isFunction(panel.hidePanel())){\n\t\t\tthis.getPanel().hidePanel();\n\t\t}\n\t}\n\n\t#compareGrid(eventWithGrid,grid)\n\t{\n\t\tif(this.getId() !== undefined)\n\t\t{\n\t\t\tif(grid===undefined && eventWithGrid.getCompatData())\n\t\t\t{\n\t\t\t\t[grid] = eventWithGrid.getCompatData();\n\t\t\t}\n\t\t\tif(grid !== undefined && Type.isFunction(grid.getId) && grid.getId()===this.getId()) return true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tsetAllRowsSelectedStatus()\n\t{\n\t\tthis.#allRowsSelectedStatus = true;\n\t}\n\n\tunsetAllRowsSelectedStatus()\n\t{\n\t\tthis.#allRowsSelectedStatus = false;\n\t}\n\n\treloadTable()\n\t{\n\t\tthis.getGrid().reloadTable();\n\t\tthis.getGrid().tableUnfade();\n\t}\n\n\tsetGridId(gridId)\n\t{\n\t\tif (this.#id === gridId) {\n\t\t\treturn;\n\t\t}\n\t\tthis.#id = gridId;\n\t\tthis.grid = BX.Main.gridManager.getInstanceById(gridId);\n\n\t}\n\n\tselectAll()\n\t{\n\t\tthis.getGrid().getRows().selectAll();\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.#id;\n\t}\n\n\tgetCountDisplayed()\n\t{\n\t\tif(this.getGrid())\n\t\t{\n\t\t\treturn this.getGrid().getRows().getCountDisplayed();\n\t\t}\n\t}\n\n\tgetGrid()\n\t{\n\t\treturn this.grid;\n\t}\n\n\tgetRows()\n\t{\n\t\treturn this.getGrid().getRows().getBodyChild();\n\t}\n\n\tgetRowById(id)\n\t{\n\t\treturn this.getGrid().getRows().getById(id);\n\t}\n\n\tgetRowNodeById(id)\n\t{\n\t\treturn this.getRowById(id).getNode();\n\t}\n\n\tgetSelectedIds()\n\t{\n\t\treturn this.getGrid().getRows().getSelectedIds();\n\t}\n\n\thideRowByIds(ids)\n\t{\n\t\tfor (let i = 0; i < ids.length; i++)\n\t\t{\n\t\t\tconst rowNode = this.getRowNodeById(ids[i]);\n\t\t\tDom.style(rowNode, 'display', 'none');\n\t\t}\n\t}\n\n\tresetGridSelection()\n\t{\n\t\tEventEmitter.emit(window,'Mail::resetGridSelection');\n\t\tthis.getGrid().getRows().unselectAll();\n\t\tthis.getGrid().adjustCheckAllCheckboxes();\n\t\tthis.hidePanel();\n\t}\n\n\topenGridSettingsWindow()\n\t{\n\t\tthis.getGrid().getSettingsWindow()._onSettingsButtonClick();\n\t}\n}"],"names":["MessageGrid","mailboxIsAvailable","instance","EventEmitter","subscribe","event","undefined","checked","selectAll","getCompatData","grid","Type","isFunction","getId","replaceTheBlankEmailStub","gridWrapper","getGridWrapper","appendChild","Tag","render","setTimeout","remove","blankEmailStubs","document","getElementsByClassName","length","blankEmailStub","firstElementChild","replaceWith","Loc","getMessage","tariffButton","onclick","preventDefault","window","open","EXPAND_LICENSE_URL","tariffPlug","append","node","panel","getPanel","hidePanel","getGrid","reloadTable","tableUnfade","gridId","BX","Main","gridManager","getInstanceById","getRows","getCountDisplayed","getBodyChild","id","getById","getRowById","getNode","getSelectedIds","ids","i","rowNode","getRowNodeById","Dom","style","emit","unselectAll","adjustCheckAllCheckboxes","getSettingsWindow","_onSettingsButtonClick","eventWithGrid"],"mappings":"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"}