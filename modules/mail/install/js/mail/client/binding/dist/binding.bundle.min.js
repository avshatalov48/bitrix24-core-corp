this.BX=this.BX||{};this.BX.Mail=this.BX.Mail||{};(function(e,t,i,a){"use strict";var s;function r(e,t,i){l(e,t);t.set(e,i)}function l(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function n(e,t,i){b(e,t);c(i,"get");return o(e,i)}function c(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function b(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function o(e,t){if(t.get){return t.get.call(e)}return t.value}var u=new WeakMap;var v=new WeakMap;var d=new WeakMap;var h=new WeakMap;var p=new WeakMap;var g=new WeakMap;var I=new WeakMap;var f=new WeakMap;var m=new WeakMap;var M=new WeakMap;var _=new WeakMap;var H=new WeakMap;var N=new WeakMap;var T=new WeakMap;var P=new WeakMap;var k=function(){babelHelpers.createClass(e,[{key:"isError",value:function t(i){if(n(e,e,A)[i]!==undefined){return true}return false}},{key:"isActive",value:function e(){return babelHelpers.classPrivateFieldGet(this,v)}},{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,d)}},{key:"getMessageId",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!t){return babelHelpers.classPrivateFieldGet(this,f)}else{return babelHelpers.classPrivateFieldGet(this,m)}}}]);function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{type:"",id:""};babelHelpers.classCallCheck(this,e);r(this,u,{writable:true,value:void 0});r(this,v,{writable:true,value:false});r(this,d,{writable:true,value:void 0});r(this,h,{writable:true,value:void 0});r(this,p,{writable:true,value:void 0});r(this,g,{writable:true,value:false});r(this,I,{writable:true,value:void 0});r(this,f,{writable:true,value:void 0});r(this,m,{writable:true,value:void 0});r(this,M,{writable:true,value:void 0});r(this,_,{writable:true,value:"ui-btn-wait"});r(this,H,{writable:true,value:void 0});r(this,N,{writable:true,value:{crm:"MAIL_BINDING_CRM_",chat:"MAIL_BINDING_CHAT_",task:"MAIL_BINDING_TASK_",post:"MAIL_BINDING_POST_",meeting:"MAIL_BINDING_MEETING_"}});r(this,T,{writable:true,value:{crm:"MAIL_BINDING_CRM_TITLE",chat:"MAIL_BINDING_CHAT_TITLE",task:"MAIL_BINDING_TASK_TITLE",post:"MAIL_BINDING_POST_TITLE",meeting:"MAIL_BINDING_MEETING_TITLE"}});r(this,P,{writable:true,value:{crm:"mail-binding-crm",chat:"mail-binding-chat",task:"mail-binding-task",post:"mail-binding-post",meeting:"mail-binding-meeting"}});babelHelpers.classPrivateFieldSet(this,H,i["errorType"]);babelHelpers.classPrivateFieldSet(this,f,i["messageId"]);babelHelpers.classPrivateFieldSet(this,d,i["id"]);babelHelpers.classPrivateFieldSet(this,h,i["href"]);babelHelpers.classPrivateFieldSet(this,p,i["type"]);babelHelpers.classPrivateFieldSet(this,m,i["messageSimpleId"]);babelHelpers.classPrivateFieldSet(this,M,i["createHref"]);if(babelHelpers.classPrivateFieldGet(this,d)){babelHelpers.classPrivateFieldSet(this,v,true)}if(this.isActive()){babelHelpers.classPrivateFieldSet(this,u,t.Loc.getMessage(babelHelpers.classPrivateFieldGet(this,N)[babelHelpers.classPrivateFieldGet(this,p)]+"ACTIVE"))}else{babelHelpers.classPrivateFieldSet(this,u,t.Loc.getMessage(babelHelpers.classPrivateFieldGet(this,N)[babelHelpers.classPrivateFieldGet(this,p)]+"NOT_ACTIVE"))}}babelHelpers.createClass(e,[{key:"getType",value:function e(){return babelHelpers.classPrivateFieldGet(this,p)}},{key:"onClick",value:function t(i){if(this.isError(babelHelpers.classPrivateFieldGet(this,H))){e.showError(babelHelpers.classPrivateFieldGet(this,H));return}if(this.isActive()){if(this.getType()==="chat"){BX.Mail.Secretary.getInstance(this.getMessageId(true)).openChat()}}else if(!babelHelpers.classPrivateFieldGet(this,g)){switch(this.getType()){case"crm":this.startWait();BX.Mail.Client.Message.List["mail-client-list-manager"].onCrmClick(this.getMessageId());break;case"chat":BX.Mail.Secretary.getInstance(this.getMessageId(true)).openChat();break;case"task":top.BX.SidePanel.Instance.open(babelHelpers.classPrivateFieldGet(this,M));break;case"post":top.BX.SidePanel.Instance.open(babelHelpers.classPrivateFieldGet(this,M));break;case"meeting":BX.Mail.Secretary.getInstance(this.getMessageId(true)).openCalendarEvent();break}}}},{key:"getHref",value:function e(){return babelHelpers.classPrivateFieldGet(this,h)}},{key:"setText",value:function e(t){babelHelpers.classPrivateFieldGet(this,I).textContent=t}},{key:"getNode",value:function e(){return babelHelpers.classPrivateFieldGet(this,I)}},{key:"startWait",value:function e(){babelHelpers.classPrivateFieldSet(this,g,true);this.getNode().classList.add(babelHelpers.classPrivateFieldGet(this,_))}},{key:"stopWait",value:function e(){babelHelpers.classPrivateFieldSet(this,g,false);this.getNode().classList.remove(babelHelpers.classPrivateFieldGet(this,_))}},{key:"setActive",value:function e(i){this.stopWait();this.getNode().classList.remove("mail-ui-not-active");this.getNode().classList.add("mail-ui-active");this.setText(t.Loc.getMessage(babelHelpers.classPrivateFieldGet(this,N)[this.getType()]+"ACTIVE"));this.getNode().setAttribute("href",i);babelHelpers.classPrivateFieldSet(this,v,true);this.updateTitle()}},{key:"deactivation",value:function e(){this.stopWait();this.getNode().classList.add("mail-ui-not-active");this.getNode().classList.remove("mail-ui-active");this.setText(t.Loc.getMessage(babelHelpers.classPrivateFieldGet(this,N)[this.getType()]+"NOT_ACTIVE"));this.getNode().removeAttribute("href");babelHelpers.classPrivateFieldSet(this,v,false);this.updateTitle()}},{key:"getTitle",value:function e(){return t.Loc.getMessage(babelHelpers.classPrivateFieldGet(this,T)[this.getType()]+(this.isActive()?"_ACTIVE":""))}},{key:"updateTitle",value:function e(){this.getNode().removeAttribute("title");this.getNode().setAttribute("title",this.getTitle())}},{key:"render",value:function e(){var i=this.isActive()?"mail-ui-active":"mail-ui-not-active";var a=t.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="mail-ui-binding ui-btn-light-border ui-btn ui-btn-xs ui-btn-round ui-btn-no-caps '," "," js-bind-",'">\n\t\t\t\t',"\n\t\t\t</a>"])),babelHelpers.classPrivateFieldGet(this,P)[this.getType()],i,this.getMessageId(true),babelHelpers.classPrivateFieldGet(this,u));babelHelpers.classPrivateFieldSet(this,I,a);babelHelpers.classPrivateFieldGet(this,I).object=this;this.updateTitle();a.onclick=function(){this.object.onClick()};a.ondblclick=function(e){e.stopPropagation()};a.setActive=function(e){this.object.setActive(e)};a.deactivation=function(){this.object.deactivation()};a.startWait=function(){this.object.startWait()};a.stopWait=function(){this.object.stopWait()};if(babelHelpers.classPrivateFieldGet(this,H)==="crm-install-permission-error"&&this.getHref()){babelHelpers.classPrivateFieldSet(this,H,"crm-install-permission-open-error")}if(this.isActive()&&!this.isError(babelHelpers.classPrivateFieldGet(this,H))){a.setAttribute("href",this.getHref())}return a}}],[{key:"showError",value:function a(s){i.UI.Notification.Center.notify({content:t.Loc.getMessage(n(e,e,A)[s])})}}]);return e}();var A={writable:true,value:{"crm-install-error":"MAIL_BINDING_CRM_ERROR","calendar-install-error":"MAIL_BINDING_MEETING_ERROR","tasks-install-error":"MAIL_BINDING_TASK_ERROR","chat-install-error":"MAIL_BINDING_CHAT_ERROR","socialnetwork-install-error":"MAIL_BINDING_POST_ERROR","crm-install-permission-error":"MAIL_BINDING_CRM_PERMISSION_SAVE_ERROR","crm-install-permission-open-error":"MAIL_BINDING_CRM_PERMISSION_OPEN_ERROR","crm-install-permission-working-error":"MAIL_BINDING_CRM_PERMISSION_WORKING_ERROR"}};function G(e,t,i){w(e,t);t.set(e,i)}function w(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var y=new WeakMap;var E=new WeakMap;var F=function(){babelHelpers.createClass(e,[{key:"getMailbox",value:function e(){return babelHelpers.classPrivateFieldGet(this,y)}}]);function e(t){var i=this;babelHelpers.classCallCheck(this,e);G(this,y,{writable:true,value:void 0});G(this,E,{writable:true,value:{CRM_ACTIVITY:".mail-binding-crm",TASKS_TASK:".mail-binding-task",IM_CHAT:".mail-binding-chat",BLOG_POST:".mail-binding-post",CALENDAR_EVENT:".mail-binding-meeting"}});babelHelpers.classPrivateFieldSet(this,y,t);a.EventEmitter.subscribe("onPullEvent-mail",(function(e){var t=e.getData();if(t[0]==="messageBindingCreated"&&(t[1]["mailboxId"]===i.getMailbox()||t[1]["mailboxId"]===String(i.getMailbox()))){var a=t[1];var s=a["messageId"];var r=document.querySelector(""+(".js-bind-"+s)+babelHelpers.classPrivateFieldGet(i,E)[a["entityType"]]+"");if(r){r.setActive(a["bindingEntityLink"])}}if(t[0]==="messageBindingDeleted"&&(t[1]["mailboxId"]===i.getMailbox()||t[1]["mailboxId"]===String(i.getMailbox()))){var l=t[1];var n=l["messageId"];var c=document.querySelector(""+(".js-bind-"+n)+babelHelpers.classPrivateFieldGet(i,E)[l["entityType"]]+"");if(c){c.deactivation()}}}))}babelHelpers.createClass(e,null,[{key:"build",value:function e(t){var i=new k(t);return i.render()}},{key:"replaceElement",value:function e(t){var i=t.parentNode;var a=this.build({type:t.getAttribute("bind-type"),id:t.getAttribute("bind-id"),messageId:t.getAttribute("message-id"),messageSimpleId:t.getAttribute("message-simple-id"),href:t.getAttribute("bind-href"),createHref:t.getAttribute("create-href"),errorType:t.getAttribute("error-type")});i.replaceChild(a,t)}},{key:"initButtons",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:document.body;var i=Array.from(t.getElementsByClassName("mail-ui-binding-data"));for(var a=0,s=i;a<s.length;a++){var r=s[a];this.replaceElement(r)}}}]);return e}();e.Binding=F;e.Item=k})(this.BX.Mail.Client=this.BX.Mail.Client||{},BX,BX,BX.Event);
//# sourceMappingURL=binding.bundle.map.js