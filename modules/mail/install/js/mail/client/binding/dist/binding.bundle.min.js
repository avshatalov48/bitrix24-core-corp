this.BX=this.BX||{};this.BX.Mail=this.BX.Mail||{};(function(e,t,i,a){"use strict";var s;function l(e,t,i){n(e,t);r(i,"get");return c(e,i)}function r(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function n(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function c(e,t){if(t.get){return t.get.call(e)}return t.value}var b=new WeakMap;var o=new WeakMap;var u=new WeakMap;var v=new WeakMap;var d=new WeakMap;var h=new WeakMap;var p=new WeakMap;var g=new WeakMap;var I=new WeakMap;var f=new WeakMap;var m=new WeakMap;var M=new WeakMap;var _=new WeakMap;var H=new WeakMap;var N=new WeakMap;var P=function(){babelHelpers.createClass(e,[{key:"isError",value:function t(i){if(l(e,e,k)[i]!==undefined){return true}return false}},{key:"isActive",value:function e(){return babelHelpers.classPrivateFieldGet(this,o)}},{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,u)}},{key:"getMessageId",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!t){return babelHelpers.classPrivateFieldGet(this,g)}else{return babelHelpers.classPrivateFieldGet(this,I)}}}]);function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{type:"",id:""};babelHelpers.classCallCheck(this,e);b.set(this,{writable:true,value:void 0});o.set(this,{writable:true,value:false});u.set(this,{writable:true,value:void 0});v.set(this,{writable:true,value:void 0});d.set(this,{writable:true,value:void 0});h.set(this,{writable:true,value:false});p.set(this,{writable:true,value:void 0});g.set(this,{writable:true,value:void 0});I.set(this,{writable:true,value:void 0});f.set(this,{writable:true,value:void 0});m.set(this,{writable:true,value:"ui-btn-wait"});M.set(this,{writable:true,value:void 0});_.set(this,{writable:true,value:{crm:"MAIL_BINDING_CRM_",chat:"MAIL_BINDING_CHAT_",task:"MAIL_BINDING_TASK_",post:"MAIL_BINDING_POST_",meeting:"MAIL_BINDING_MEETING_"}});H.set(this,{writable:true,value:{crm:"MAIL_BINDING_CRM_TITLE",chat:"MAIL_BINDING_CHAT_TITLE",task:"MAIL_BINDING_TASK_TITLE",post:"MAIL_BINDING_POST_TITLE",meeting:"MAIL_BINDING_MEETING_TITLE"}});N.set(this,{writable:true,value:{crm:"mail-binding-crm",chat:"mail-binding-chat",task:"mail-binding-task",post:"mail-binding-post",meeting:"mail-binding-meeting"}});babelHelpers.classPrivateFieldSet(this,M,i["errorType"]);babelHelpers.classPrivateFieldSet(this,g,i["messageId"]);babelHelpers.classPrivateFieldSet(this,u,i["id"]);babelHelpers.classPrivateFieldSet(this,v,i["href"]);babelHelpers.classPrivateFieldSet(this,d,i["type"]);babelHelpers.classPrivateFieldSet(this,I,i["messageSimpleId"]);babelHelpers.classPrivateFieldSet(this,f,i["createHref"]);if(babelHelpers.classPrivateFieldGet(this,u)){babelHelpers.classPrivateFieldSet(this,o,true)}if(this.isActive()){babelHelpers.classPrivateFieldSet(this,b,t.Loc.getMessage(babelHelpers.classPrivateFieldGet(this,_)[babelHelpers.classPrivateFieldGet(this,d)]+"ACTIVE"))}else{babelHelpers.classPrivateFieldSet(this,b,t.Loc.getMessage(babelHelpers.classPrivateFieldGet(this,_)[babelHelpers.classPrivateFieldGet(this,d)]+"NOT_ACTIVE"))}}babelHelpers.createClass(e,[{key:"getType",value:function e(){return babelHelpers.classPrivateFieldGet(this,d)}},{key:"onClick",value:function t(i){if(this.isError(babelHelpers.classPrivateFieldGet(this,M))){e.showError(babelHelpers.classPrivateFieldGet(this,M));return}if(this.isActive()){if(this.getType()==="chat"){BX.Mail.Secretary.getInstance(this.getMessageId(true)).openChat()}}else if(!babelHelpers.classPrivateFieldGet(this,h)){switch(this.getType()){case"crm":this.startWait();BX.Mail.Client.Message.List["mail-client-list-manager"].onCrmClick(this.getMessageId());break;case"chat":BX.Mail.Secretary.getInstance(this.getMessageId(true)).openChat();break;case"task":top.BX.SidePanel.Instance.open(babelHelpers.classPrivateFieldGet(this,f));break;case"post":top.BX.SidePanel.Instance.open(babelHelpers.classPrivateFieldGet(this,f));break;case"meeting":BX.Mail.Secretary.getInstance(this.getMessageId(true)).openCalendarEvent();break}}}},{key:"getHref",value:function e(){return babelHelpers.classPrivateFieldGet(this,v)}},{key:"setText",value:function e(t){babelHelpers.classPrivateFieldGet(this,p).textContent=t}},{key:"getNode",value:function e(){return babelHelpers.classPrivateFieldGet(this,p)}},{key:"startWait",value:function e(){babelHelpers.classPrivateFieldSet(this,h,true);this.getNode().classList.add(babelHelpers.classPrivateFieldGet(this,m))}},{key:"stopWait",value:function e(){babelHelpers.classPrivateFieldSet(this,h,false);this.getNode().classList.remove(babelHelpers.classPrivateFieldGet(this,m))}},{key:"setActive",value:function e(i){this.stopWait();this.getNode().classList.remove("mail-ui-not-active");this.getNode().classList.add("mail-ui-active");this.setText(t.Loc.getMessage(babelHelpers.classPrivateFieldGet(this,_)[this.getType()]+"ACTIVE"));this.getNode().setAttribute("href",i);babelHelpers.classPrivateFieldSet(this,o,true);this.updateTitle()}},{key:"deactivation",value:function e(){this.stopWait();this.getNode().classList.add("mail-ui-not-active");this.getNode().classList.remove("mail-ui-active");this.setText(t.Loc.getMessage(babelHelpers.classPrivateFieldGet(this,_)[this.getType()]+"NOT_ACTIVE"));this.getNode().removeAttribute("href");babelHelpers.classPrivateFieldSet(this,o,false);this.updateTitle()}},{key:"getTitle",value:function e(){return t.Loc.getMessage(babelHelpers.classPrivateFieldGet(this,H)[this.getType()]+(this.isActive()?"_ACTIVE":""))}},{key:"updateTitle",value:function e(){this.getNode().removeAttribute("title");this.getNode().setAttribute("title",this.getTitle())}},{key:"render",value:function e(){var i=this.isActive()?"mail-ui-active":"mail-ui-not-active";var a=t.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="mail-ui-binding ui-btn-light-border ui-btn ui-btn-xs ui-btn-round ui-btn-no-caps '," "," js-bind-",'">\n\t\t\t\t',"\n\t\t\t</a>"])),babelHelpers.classPrivateFieldGet(this,N)[this.getType()],i,this.getMessageId(true),babelHelpers.classPrivateFieldGet(this,b));babelHelpers.classPrivateFieldSet(this,p,a);babelHelpers.classPrivateFieldGet(this,p).object=this;this.updateTitle();a.onclick=function(){this.object.onClick()};a.ondblclick=function(e){e.stopPropagation()};a.setActive=function(e){this.object.setActive(e)};a.deactivation=function(){this.object.deactivation()};a.startWait=function(){this.object.startWait()};a.stopWait=function(){this.object.stopWait()};if(babelHelpers.classPrivateFieldGet(this,M)==="crm-install-permission-error"&&this.getHref()){babelHelpers.classPrivateFieldSet(this,M,"crm-install-permission-open-error")}if(this.isActive()&&!this.isError(babelHelpers.classPrivateFieldGet(this,M))){a.setAttribute("href",this.getHref())}return a}}],[{key:"showError",value:function a(s){i.UI.Notification.Center.notify({content:t.Loc.getMessage(l(e,e,k)[s])})}}]);return e}();var k={writable:true,value:{"crm-install-error":"MAIL_BINDING_CRM_ERROR","calendar-install-error":"MAIL_BINDING_MEETING_ERROR","tasks-install-error":"MAIL_BINDING_TASK_ERROR","chat-install-error":"MAIL_BINDING_CHAT_ERROR","socialnetwork-install-error":"MAIL_BINDING_POST_ERROR","crm-install-permission-error":"MAIL_BINDING_CRM_PERMISSION_SAVE_ERROR","crm-install-permission-open-error":"MAIL_BINDING_CRM_PERMISSION_OPEN_ERROR","crm-install-permission-working-error":"MAIL_BINDING_CRM_PERMISSION_WORKING_ERROR"}};var T=new WeakMap;var A=new WeakMap;var G=function(){babelHelpers.createClass(e,[{key:"getMailbox",value:function e(){return babelHelpers.classPrivateFieldGet(this,T)}}]);function e(t){var i=this;babelHelpers.classCallCheck(this,e);T.set(this,{writable:true,value:void 0});A.set(this,{writable:true,value:{CRM_ACTIVITY:".mail-binding-crm",TASKS_TASK:".mail-binding-task",IM_CHAT:".mail-binding-chat",BLOG_POST:".mail-binding-post",CALENDAR_EVENT:".mail-binding-meeting"}});babelHelpers.classPrivateFieldSet(this,T,t);a.EventEmitter.subscribe("onPullEvent-mail",function(e){var t=e.getData();if(t[0]==="messageBindingCreated"&&(t[1]["mailboxId"]===i.getMailbox()||t[1]["mailboxId"]===String(i.getMailbox()))){var a=t[1];var s=a["messageId"];var l=document.querySelector(""+(".js-bind-"+s)+babelHelpers.classPrivateFieldGet(i,A)[a["entityType"]]+"");if(l){l.setActive(a["bindingEntityLink"])}}if(t[0]==="messageBindingDeleted"&&(t[1]["mailboxId"]===i.getMailbox()||t[1]["mailboxId"]===String(i.getMailbox()))){var r=t[1];var n=r["messageId"];var c=document.querySelector(""+(".js-bind-"+n)+babelHelpers.classPrivateFieldGet(i,A)[r["entityType"]]+"");if(c){c.deactivation()}}})}babelHelpers.createClass(e,null,[{key:"build",value:function e(t){var i=new P(t);return i.render()}},{key:"replaceElement",value:function e(t){var i=t.parentNode;var a=this.build({type:t.getAttribute("bind-type"),id:t.getAttribute("bind-id"),messageId:t.getAttribute("message-id"),messageSimpleId:t.getAttribute("message-simple-id"),href:t.getAttribute("bind-href"),createHref:t.getAttribute("create-href"),errorType:t.getAttribute("error-type")});i.replaceChild(a,t)}},{key:"initButtons",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:document.body;var i=Array.from(t.getElementsByClassName("mail-ui-binding-data"));for(var a=0,s=i;a<s.length;a++){var l=s[a];this.replaceElement(l)}}}]);return e}();e.Binding=G;e.Item=P})(this.BX.Mail.Client=this.BX.Mail.Client||{},BX,BX,BX.Event);
//# sourceMappingURL=binding.bundle.map.js