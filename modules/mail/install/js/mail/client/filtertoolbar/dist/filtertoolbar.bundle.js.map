{"version":3,"file":"filtertoolbar.bundle.js","sources":["../src/filtertoolbar.js"],"sourcesContent":["import { Tag } from 'main.core';\nimport './css/style.css';\nimport { Loc } from 'main.core';\nimport { BaseEvent, EventEmitter } from \"main.core.events\";\nimport 'ui.fonts.opensans';\n\nexport class FilterToolbar\n{\n\t#wrapper;\n\t#filter;\n\t#statusBtn = false;\n\t#counterBtn;\n\t#filterApi;\n\t#readAllBtn;\n\t#counter;\n\t#filterTitle;\n\n\tconstructor(config = {\n\t\twrapper: [],\n\t\tfilter: [],\n\t})\n\t{\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', (event) => {\n\n\t\t\tlet isSeen = this.#filter.getFilterFieldsValues()['IS_SEEN'];\n\n\t\t\tif(isSeen === 'N')\n\t\t\t{\n\t\t\t\tthis.activateBtn();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.deactivateBtn();\n\t\t\t}\n\t\t});\n\n\t\tthis.#wrapper = config['wrapper'];\n\t\tthis.#filter = config['filter'];\n\t\tthis.#filterApi = this.#filter.getApi();\n\t}\n\n\tsetCount(num)\n\t{\n\t\tnum = Number(num);\n\t\tnum = isNaN(num) ? 0 : num;\n\n\t\tif(num !== undefined)\n\t\t{\n\t\t\tthis.#counter.textContent = num;\n\n\t\t\tif(num !== 0)\n\t\t\t{\n\t\t\t\tthis.#counter.classList.remove('mail-counter-zero');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#counter.classList.add('mail-counter-zero');\n\t\t\t}\n\n\t\t}\n\t}\n\n\tactivateBtn()\n\t{\n\t\tthis.#statusBtn = true;\n\t\tthis.#counterBtn.classList.add('mail-msg-counter-number-selected');\n\t}\n\n\tdeactivateBtn()\n\t{\n\t\tthis.#statusBtn = false;\n\t\tthis.#counterBtn.classList.remove('mail-msg-counter-number-selected');\n\t}\n\n\tonClickFilterButton()\n\t{\n\t\tif(!this.#statusBtn)\n\t\t{\n\t\t\tthis.activateBtn();\n\t\t\tthis.setUnreadFilter();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.deactivateBtn();\n\t\t\tthis.removeUnreadFilter();\n\t\t}\n\t}\n\n\tremoveUnreadFilter()\n\t{\n\t\tif (!!this.#filter && (this.#filter instanceof BX.Main.Filter))\n\t\t{\n\t\t\tthis.#filterApi.setFields({\n\t\t\t\t'DIR': this.#filter.getFilterFieldsValues()['DIR'],\n\t\t\t});\n\t\t\tthis.#filterApi.apply();\n\t\t}\n\t}\n\n\thideReadAllBtn()\n\t{\n\t\tthis.#readAllBtn.classList.add('mail-toolbar-hide-element');\n\t}\n\n\tshowReadAllBtn()\n\t{\n\t\tthis.#readAllBtn.classList.remove('mail-toolbar-hide-element');\n\t}\n\n\thideCounter()\n\t{\n\t\tthis.#counterBtn.classList.add('mail-toolbar-hide-element');\n\t\tthis.#filterTitle.classList.add('mail-toolbar-hide-element');\n\t}\n\n\tshowCounter()\n\t{\n\t\tthis.#counterBtn.classList.remove('mail-toolbar-hide-element');\n\t\tthis.#filterTitle.classList.remove('mail-toolbar-hide-element');\n\t}\n\n\tsetUnreadFilter()\n\t{\n\t\tif (!!this.#filter && (this.#filter instanceof BX.Main.Filter))\n\t\t{\n\t\t\tthis.#filterApi.setFields({\n\t\t\t\t'DIR': this.#filter.getFilterFieldsValues()['DIR'],\n\t\t\t\t'IS_SEEN': 'N'\n\t\t\t});\n\t\t\tthis.#filterApi.apply();\n\t\t}\n\t}\n\n\tbuild(config ={\n\t\tfilterId: '',\n\t})\n\t{\n\t\tconst mailFilterToolbar = Tag.render`<div class=\"mail-filter-toolbar\">\n\t\t\t<div class=\"mail-filter-counter\" data-role=\"mail-filter-counter\">\n\t\t\t\t<div data-role=\"mail-filter-title\">\n\t\t\t\t\t${Loc.getMessage(\"MAIL_FILTER_TOOLBAR_TITLE\")}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`;\n\n\t\tconst counterBtn = Tag.render`<span class=\"mail-toolbar-counter\">\n\t\t\t<span class=\"mail-msg-counter-number\" data-role=\"unread-counter-number\"></span>\n\t\t\t<span class=\"mail-msg-counter-text\">${Loc.getMessage(\"MAIL_FILTER_NOT_READ\")}</span>\n\t\t\t<span class=\"mail-msg-counter-remove\"></span>\n\t\t</span>`;\n\n\t\tconst readAllBtn = Tag.render`<span class=\"mail-toolbar-counter\">\n\t\t\t<span class=\"mail-msg-counter-text\">${Loc.getMessage(\"MAIL_FILTER_READ_ALL\")}</span>\n\t\t</span>`;\n\n\t\tthis.#counter = counterBtn.querySelector('[data-role=\"unread-counter-number\"]');\n\t\tthis.#filterTitle = mailFilterToolbar.querySelector('[data-role=\"mail-filter-title\"]');\n\n\t\tthis.#readAllBtn = readAllBtn;\n\t\tthis.#counterBtn = counterBtn;\n\n\t\tcounterBtn.onclick = ()=>\n\t\t{\n\t\t\tthis.onClickFilterButton()\n\t\t}\n\n\t\treadAllBtn.onclick = ()=>\n\t\t{\n\t\t\tBX.Mail.Client.Message.List['mail-client-list-manager'].onReadClick('all');\n\t\t\tthis.removeUnreadFilter();\n\t\t}\n\n\t\tconst mailFilterCounter = mailFilterToolbar.querySelector('[data-role=\"mail-filter-counter\"]');\n\n\t\tmailFilterCounter.append(counterBtn);\n\t\tmailFilterCounter.append(readAllBtn);\n\t\tthis.#wrapper.append(mailFilterToolbar);\n\n\t\tEventEmitter.subscribe('BX.Mail.Home:updatingCounters', function(event) {\n\n\t\t\tif(event['data']['name'] === 'dirs')\n\t\t\t{\n\t\t\t\tconst counters = event['data']['counters'];\n\t\t\t\tconst hidden = event['data']['hidden'];\n\t\t\t\tconst currentDir = event['data']['selectedDirectory'];\n\t\t\t\tlet currentFolderCount = counters[currentDir];\n\n\t\t\t\tif(currentDir !== '')\n\t\t\t\t{\n\t\t\t\t\tthis.showReadAllBtn()\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcurrentFolderCount = event['data']['total'];\n\t\t\t\t\tthis.hideReadAllBtn()\n\t\t\t\t}\n\n\t\t\t\tif(hidden[currentDir] && currentDir !== '')\n\t\t\t\t{\n\t\t\t\t\tthis.hideCounter();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setCount(currentFolderCount);\n\t\t\t\t\tthis.showCounter();\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\n\t}\n}"],"names":["FilterToolbar","config","wrapper","filter","EventEmitter","subscribe","event","isSeen","getFilterFieldsValues","activateBtn","deactivateBtn","getApi","num","Number","isNaN","undefined","textContent","classList","remove","add","setUnreadFilter","removeUnreadFilter","BX","Main","Filter","setFields","apply","mailFilterToolbar","Tag","render","Loc","getMessage","counterBtn","readAllBtn","querySelector","onclick","onClickFilterButton","Mail","Client","Message","List","onReadClick","mailFilterCounter","append","counters","hidden","currentDir","currentFolderCount","showReadAllBtn","hideReadAllBtn","hideCounter","setCount","showCounter","bind"],"mappings":"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"}