{"version":3,"file":"filtertoolbar.bundle.js","sources":["../src/filtertoolbar.js"],"sourcesContent":["import { Tag } from 'main.core';\nimport './css/style.css';\nimport { Loc } from 'main.core';\nimport { BaseEvent, EventEmitter } from \"main.core.events\";\n\nexport class FilterToolbar\n{\n\t#wrapper;\n\t#filter;\n\t#statusBtn = false;\n\t#counterBtn;\n\t#filterApi;\n\t#readAllBtn;\n\t#counter;\n\t#filterTitle;\n\n\tconstructor(config = {\n\t\twrapper: [],\n\t\tfilter: [],\n\t\tstartDir: 'INBOX',\n\t})\n\t{\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', (event) => {\n\n\t\t\tlet isSeen = this.#filter.getFilterFieldsValues()['IS_SEEN'];\n\n\t\t\tif(isSeen === 'N')\n\t\t\t{\n\t\t\t\tthis.activateBtn();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.deactivateBtn();\n\t\t\t}\n\t\t});\n\n\t\tthis.#wrapper = config['wrapper'];\n\t\tthis.#filter = config['filter'];\n\t\tthis.#filterApi = this.#filter.getApi();\n\t}\n\n\tsetCount(num)\n\t{\n\t\tnum = Number(num);\n\t\tnum = isNaN(num) ? 0 : num;\n\n\t\tif(num !== undefined)\n\t\t{\n\t\t\tthis.#counter.textContent = num;\n\n\t\t\tif(num !== 0)\n\t\t\t{\n\t\t\t\tthis.#counter.classList.remove('mail-counter-zero');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#counter.classList.add('mail-counter-zero');\n\t\t\t}\n\n\t\t}\n\t}\n\n\tactivateBtn()\n\t{\n\t\tthis.#statusBtn = true;\n\t\tthis.#counterBtn.classList.add('mail-msg-counter-number-selected');\n\t}\n\n\tdeactivateBtn()\n\t{\n\t\tthis.#statusBtn = false;\n\t\tthis.#counterBtn.classList.remove('mail-msg-counter-number-selected');\n\t}\n\n\tonClickFilterButton()\n\t{\n\t\tif(!this.#statusBtn)\n\t\t{\n\t\t\tthis.activateBtn();\n\t\t\tthis.setUnreadFilter();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.deactivateBtn();\n\t\t\tthis.removeUnreadFilter();\n\t\t}\n\t}\n\n\tremoveUnreadFilter()\n\t{\n\t\tif (!!this.#filter && (this.#filter instanceof BX.Main.Filter))\n\t\t{\n\t\t\tthis.#filterApi.setFields({\n\t\t\t\t'DIR': this.#filter.getFilterFieldsValues()['DIR'],\n\t\t\t});\n\t\t\tthis.#filterApi.apply();\n\t\t}\n\t}\n\n\thideCounter()\n\t{\n\t\tthis.#counterBtn.classList.add('mail-toolbar-hide-element');\n\t\tthis.#filterTitle.classList.add('mail-toolbar-hide-element');\n\t}\n\n\tshowCounter()\n\t{\n\t\tthis.#counterBtn.classList.remove('mail-toolbar-hide-element');\n\t\tthis.#filterTitle.classList.remove('mail-toolbar-hide-element');\n\t}\n\n\tsetUnreadFilter()\n\t{\n\t\tif (!!this.#filter && (this.#filter instanceof BX.Main.Filter))\n\t\t{\n\t\t\tthis.#filterApi.setFields({\n\t\t\t\t'DIR': this.#filter.getFilterFieldsValues()['DIR'],\n\t\t\t\t'IS_SEEN': 'N'\n\t\t\t});\n\t\t\tthis.#filterApi.apply();\n\t\t}\n\t}\n\n\tbuild(config ={\n\t\tfilterId: '',\n\t})\n\t{\n\t\tconst mailFilterToolbar = Tag.render`<div class=\"mail-filter-toolbar\">\n\t\t\t<div class=\"mail-filter-counter\" data-role=\"mail-filter-counter\">\n\t\t\t\t<div class=\"mail-filter-counter-title\"  data-role=\"mail-filter-title\">\n\t\t\t\t\t${Loc.getMessage(\"MAIL_FILTER_TOOLBAR_TITLE\")}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`;\n\n\t\tconst counterBtn = Tag.render`<span class=\"mail-toolbar-counter\">\n\t\t\t<span class=\"mail-msg-counter-number\" data-role=\"unread-counter-number\"></span>\n\t\t\t<span class=\"mail-msg-counter-text\">${Loc.getMessage(\"MAIL_FILTER_NOT_READ\")}</span>\n\t\t\t<span class=\"mail-msg-counter-remove\"></span>\n\t\t</span>`;\n\n\t\tconst readAllBtn = Tag.render`<span class=\"mail-toolbar-counter\">\n\t\t\t<span class=\"mail-msg-counter-text\">${Loc.getMessage(\"MAIL_FILTER_READ_ALL\")}</span>\n\t\t</span>`;\n\n\t\tthis.#counter = counterBtn.querySelector('[data-role=\"unread-counter-number\"]');\n\t\tthis.#filterTitle = mailFilterToolbar.querySelector('[data-role=\"mail-filter-title\"]');\n\n\t\tthis.#readAllBtn = readAllBtn;\n\t\tthis.#counterBtn = counterBtn;\n\n\t\tcounterBtn.onclick = ()=>\n\t\t{\n\t\t\tthis.onClickFilterButton()\n\t\t}\n\n\t\treadAllBtn.onclick = ()=>\n\t\t{\n\t\t\tBX.Mail.Client.Message.List['mail-client-list-manager'].onReadClick('all');\n\t\t\tthis.removeUnreadFilter();\n\t\t}\n\n\t\tconst mailFilterCounter = mailFilterToolbar.querySelector('[data-role=\"mail-filter-counter\"]');\n\n\t\tmailFilterCounter.append(counterBtn);\n\t\tmailFilterCounter.append(readAllBtn);\n\t\tthis.#wrapper.append(mailFilterToolbar);\n\n\t\tEventEmitter.subscribe('BX.Mail.Home:updatingCounters', function(event) {\n\n\t\t\tif(event['data']['name'] === 'dirs')\n\t\t\t{\n\t\t\t\tconst counters = event['data']['counters'];\n\t\t\t\tconst hidden = event['data']['hidden'];\n\t\t\t\tconst currentDir = event['data']['selectedDirectory'];\n\t\t\t\tconst currentFolderCount = counters[currentDir];\n\n\t\t\t\tif(hidden[currentDir])\n\t\t\t\t{\n\t\t\t\t\tthis.hideCounter();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setCount(currentFolderCount);\n\t\t\t\t\tthis.showCounter();\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\n\t}\n}"],"names":["FilterToolbar","config","wrapper","filter","startDir","EventEmitter","subscribe","event","isSeen","getFilterFieldsValues","activateBtn","deactivateBtn","getApi","num","Number","isNaN","undefined","textContent","classList","remove","add","setUnreadFilter","removeUnreadFilter","BX","Main","Filter","setFields","apply","mailFilterToolbar","Tag","render","Loc","getMessage","counterBtn","readAllBtn","querySelector","onclick","onClickFilterButton","Mail","Client","Message","List","onReadClick","mailFilterCounter","append","counters","hidden","currentDir","currentFolderCount","hideCounter","setCount","showCounter","bind"],"mappings":"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"}