{"version":3,"file":"mailer.bundle.js","sources":["../src/mailer.js"],"sourcesContent":["import { FilterToolbar } from 'mail.client.filtertoolbar';\nimport { Binding } from 'mail.client.binding';\nimport { BaseEvent, EventEmitter } from \"main.core.events\";\n\nexport class Mailer\n{\n\t#filter;\n\t#filterToolbar;\n\t#binding;\n\t#mailboxId;\n\t#startDir;\n\t#selectedDirectory;\n\n\tconstructor(config ={\n\t\tstartDir: 'INBOX',\n\t\tfilterId: '',\n\t\tmailboxId: 0,\n\t\tsyncAvailable: true,\n\t})\n\t{\n\t\t//delete the loader (the envelope is bouncing)\n\t\tlet elements = top.document.getElementsByClassName('mail-loader-modifier');\n\t\tfor (let element of elements)\n\t\t{\n\t\t\telement.classList.remove('mail-loader-modifier');\n\t\t}\n\n\t\tthis.#mailboxId = config['mailboxId'];\n\t\tthis.#filter = BX.Main.filterManager.getById(config['filterId']);\n\n\t\tBX.Mail.Home.Counters.setShortcut('',config['startDir']);\n\t\tthis.setFilterDir('');\n\n\t\tconst mailCounterWrapper = document.querySelector('[data-role=\"mail-counter-toolbar\"]');\n\n\t\tconst filterToolbar = new FilterToolbar({\n\t\t\tstartDir: config['startDir'],\n\t\t\twrapper: mailCounterWrapper,\n\t\t\tfilter: this.#filter,\n\t\t});\n\n\t\tfilterToolbar.build();\n\t\tthis.#filterToolbar = filterToolbar;\n\n\t\tthis.#binding = new Binding(this.#mailboxId);\n\t\tBinding.initButtons();\n\n\t\tEventEmitter.subscribe('Grid::updated', (event) => {\n\t\t\tconst [grid] = event.getCompatData();\n\t\t\tif(grid !== {} && grid !== undefined && BX.Mail.Home.Grid.getId() === grid.getId())\n\t\t\t{\n\t\t\t\tBinding.initButtons();\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', (event) => {\n\t\t\tlet dir = this.#filter.getFilterFieldsValues()['DIR'];\n\t\t\tBX.Mail.Home.Counters.setDirectory(dir);\n\t\t});\n\n\t\tif(!config['syncAvailable'])\n\t\t{\n\t\t\ttop.BX.UI.InfoHelper.show('limit_contact_center_mail_box_number');\n\t\t\tlet lock = false;\n\t\t\tconst handler  = () => {\n\t\t\t\tif(!lock)\n\t\t\t\t{\n\t\t\t\t\tlock = true;\n\t\t\t\t\ttop.BX.removeCustomEvent(\"SidePanel.Slider:onCloseComplete\", handler);\n\t\t\t\t\ttop.BX.SidePanel.Instance.close();\n\t\t\t\t}\n\t\t\t}\n\t\t\ttop.BX.addCustomEvent(\"SidePanel.Slider:onCloseComplete\", handler);\n\t\t}\n\n\t}\n\n\tsetFilterDir(name)\n\t{\n\t\tif (!!this.#filter && (this.#filter instanceof BX.Main.Filter))\n\t\t{\n\t\t\tconst FilterApi = this.#filter.getApi();\n\t\t\tFilterApi.setFields({\n\t\t\t\t'DIR': name,\n\t\t\t});\n\t\t\tFilterApi.apply();\n\t\t}\n\t}\n\n\tgetFilterToolbar()\n\t{\n\t\treturn this.#filterToolbar;\n\t}\n}"],"names":["Mailer","config","startDir","filterId","mailboxId","syncAvailable","elements","top","document","getElementsByClassName","element","classList","remove","BX","Main","filterManager","getById","Mail","Home","Counters","setShortcut","setFilterDir","mailCounterWrapper","querySelector","filterToolbar","FilterToolbar","wrapper","filter","build","Binding","initButtons","EventEmitter","subscribe","event","getCompatData","grid","undefined","Grid","getId","dir","getFilterFieldsValues","setDirectory","UI","InfoHelper","show","lock","handler","removeCustomEvent","SidePanel","Instance","close","addCustomEvent","name","Filter","FilterApi","getApi","setFields","apply"],"mappings":"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"}