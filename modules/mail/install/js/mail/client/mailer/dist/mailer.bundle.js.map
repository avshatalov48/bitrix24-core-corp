{"version":3,"file":"mailer.bundle.js","sources":["../src/mailer.js"],"sourcesContent":["import { FilterToolbar } from 'mail.client.filtertoolbar';\nimport { Binding } from 'mail.client.binding';\nimport { BaseEvent, EventEmitter } from \"main.core.events\";\n\nexport class Mailer\n{\n\t#filter;\n\t#filterToolbar;\n\t#binding;\n\t#mailboxId;\n\t#startDir;\n\t#selectedDirectory;\n\tfocusReset = false;\n\n\tconstructor(config ={\n\t\tstartDir: 'INBOX',\n\t\tfilterId: '',\n\t\tmailboxId: 0,\n\t\tsyncAvailable: true,\n\t})\n\t{\n\n\n\t\t//delete the loader (the envelope is bouncing)\n\t\tlet elements = top.document.getElementsByClassName('mail-loader-modifier');\n\t\tfor (let element of elements)\n\t\t{\n\t\t\telement.classList.remove('mail-loader-modifier');\n\t\t}\n\n\t\tthis.#mailboxId = config['mailboxId'];\n\t\tthis.#filter = BX.Main.filterManager.getById(config['filterId']);\n\n\t\tBX.Mail.Home.Counters.setShortcut('',config['startDir']);\n\n\t\t//Set the default directory (may change if the 'inbox' directory is disabled)\n\t\tthis.setStartDir('');\n\n\t\t//Removing the focus from the filter field\n\t\tif (document.activeElement)\n\t\t{\n\t\t\tdocument.activeElement.blur();\n\t\t}\n\n\t\tconst mailCounterWrapper = document.querySelector('[data-role=\"mail-counter-toolbar\"]');\n\n\t\tconst filterToolbar = new FilterToolbar({\n\t\t\tstartDir: config['startDir'],\n\t\t\twrapper: mailCounterWrapper,\n\t\t\tfilter: this.#filter,\n\t\t});\n\n\t\tfilterToolbar.build();\n\t\tthis.#filterToolbar = filterToolbar;\n\n\t\tthis.#binding = new Binding(this.#mailboxId);\n\t\tBinding.initButtons();\n\n\t\tEventEmitter.subscribe('Grid::updated', (event) => {\n\t\t\tconst [grid] = event.getCompatData();\n\t\t\tif(grid !== {} && grid !== undefined && BX.Mail.Home.Grid.getId() === grid.getId())\n\t\t\t{\n\t\t\t\tBinding.initButtons();\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', (event) => {\n\t\t\tlet dir = this.#filter.getFilterFieldsValues()['DIR'];\n\t\t\tBX.Mail.Home.Counters.setDirectory(dir);\n\t\t});\n\n\t\tif(!config['syncAvailable'])\n\t\t{\n\t\t\ttop.BX.UI.InfoHelper.show('limit_contact_center_mail_box_number');\n\t\t\tlet lock = false;\n\t\t\tconst handler  = () => {\n\t\t\t\tif(!lock)\n\t\t\t\t{\n\t\t\t\t\tlock = true;\n\t\t\t\t\ttop.BX.removeCustomEvent(\"SidePanel.Slider:onCloseComplete\", handler);\n\t\t\t\t\ttop.BX.SidePanel.Instance.close();\n\t\t\t\t}\n\t\t\t}\n\t\t\ttop.BX.addCustomEvent(\"SidePanel.Slider:onCloseComplete\", handler);\n\t\t}\n\t}\n\n\tsetStartDir(name)\n\t{\n\t\tif (!!this.#filter && (this.#filter instanceof BX.Main.Filter))\n\t\t{\n\t\t\tconst FilterApi = this.#filter.getApi();\n\t\t\tFilterApi.setFields({\n\t\t\t\t'DIR': name,\n\t\t\t});\n\t\t\tsetTimeout(function ()\n\t\t\t{\n\t\t\t\tEventEmitter.emit('BX.Main.Filter:apply', new BaseEvent());\n\t\t\t},1);\n\t\t}\n\t}\n\n\tsetFilterDir(name)\n\t{\n\t\tif (!!this.#filter && (this.#filter instanceof BX.Main.Filter))\n\t\t{\n\t\t\tconst FilterApi = this.#filter.getApi();\n\t\t\tFilterApi.setFields({\n\t\t\t\t'DIR': name,\n\t\t\t});\n\t\t\tFilterApi.apply();\n\t\t}\n\t}\n\n\tgetFilterToolbar()\n\t{\n\t\treturn this.#filterToolbar;\n\t}\n}"],"names":["Mailer","config","startDir","filterId","mailboxId","syncAvailable","elements","top","document","getElementsByClassName","element","classList","remove","BX","Main","filterManager","getById","Mail","Home","Counters","setShortcut","setStartDir","activeElement","blur","mailCounterWrapper","querySelector","filterToolbar","FilterToolbar","wrapper","filter","build","Binding","initButtons","EventEmitter","subscribe","event","getCompatData","grid","undefined","Grid","getId","dir","getFilterFieldsValues","setDirectory","UI","InfoHelper","show","lock","handler","removeCustomEvent","SidePanel","Instance","close","addCustomEvent","name","Filter","FilterApi","getApi","setFields","setTimeout","emit","BaseEvent","apply"],"mappings":"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"}