{"version":3,"file":"mailer.bundle.js","sources":["../src/mailer.js"],"sourcesContent":["import { FilterToolbar } from 'mail.client.filtertoolbar';\nimport { Binding } from 'mail.client.binding';\nimport { BaseEvent, EventEmitter } from \"main.core.events\";\n\nexport class Mailer\n{\n\t#filter;\n\t#filterToolbar;\n\t#binding;\n\t#mailboxId;\n\tfocusReset = false;\n\n\tconstructor(config ={\n\t\tfilterId: '',\n\t\tmailboxId: 0,\n\t\tsyncAvailable: true,\n\t})\n\t{\n\t\t//delete the loader (the envelope is bouncing)\n\t\tlet elements = top.document.getElementsByClassName('mail-loader-modifier');\n\t\tfor (let element of elements)\n\t\t{\n\t\t\telement.classList.remove('mail-loader-modifier');\n\t\t}\n\n\t\tthis.#mailboxId = config['mailboxId'];\n\t\tthis.#filter = BX.Main.filterManager.getById(config['filterId']);\n\n\t\tthis.sendApplyFilterEventForMenuRefresh();\n\n\t\t//Removing the focus from the filter field\n\t\tif (document.activeElement)\n\t\t{\n\t\t\tdocument.activeElement.blur();\n\t\t}\n\n\t\tconst mailCounterWrapper = document.querySelector('[data-role=\"mail-counter-toolbar\"]');\n\n\t\tconst filterToolbar = new FilterToolbar({\n\t\t\twrapper: mailCounterWrapper,\n\t\t\tfilter: this.#filter,\n\t\t});\n\n\t\tfilterToolbar.build();\n\t\tthis.#filterToolbar = filterToolbar;\n\n\t\tthis.#binding = new Binding(this.#mailboxId);\n\t\tBinding.initButtons();\n\n\t\tEventEmitter.subscribe('Grid::updated', (event) => {\n\t\t\tconst [grid] = event.getCompatData();\n\t\t\tif(grid !== {} && grid !== undefined && BX.Mail.Home.Grid.getId() === grid.getId())\n\t\t\t{\n\t\t\t\tBinding.initButtons();\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', (event) => {\n\t\t\tlet dir = this.#filter.getFilterFieldsValues()['DIR'];\n\t\t\tBX.Mail.Home.Counters.setDirectory(dir);\n\t\t});\n\n\t\tif(!config['syncAvailable'])\n\t\t{\n\t\t\ttop.BX.UI.InfoHelper.show('limit_contact_center_mail_box_number');\n\t\t\tlet lock = false;\n\t\t\tconst handler  = () => {\n\t\t\t\tif(!lock)\n\t\t\t\t{\n\t\t\t\t\tlock = true;\n\t\t\t\t\ttop.BX.removeCustomEvent(\"SidePanel.Slider:onCloseComplete\", handler);\n\t\t\t\t\ttop.BX.SidePanel.Instance.close();\n\t\t\t\t}\n\t\t\t}\n\t\t\ttop.BX.addCustomEvent(\"SidePanel.Slider:onCloseComplete\", handler);\n\t\t}\n\t}\n\n\tsendApplyFilterEventForMenuRefresh()\n\t{\n\t\tif (!!this.#filter && (this.#filter instanceof BX.Main.Filter))\n\t\t{\n\t\t\tsetTimeout(function ()\n\t\t\t{\n\t\t\t\tEventEmitter.emit('BX.Main.Filter:apply', new BaseEvent());\n\t\t\t},1);\n\t\t}\n\t}\n\n\tsetFilterDir(name)\n\t{\n\t\tif (!!this.#filter && (this.#filter instanceof BX.Main.Filter))\n\t\t{\n\t\t\tconst FilterApi = this.#filter.getApi();\n\t\t\tFilterApi.setFields({\n\t\t\t\t'DIR': name,\n\t\t\t});\n\t\t\tFilterApi.apply();\n\t\t}\n\t}\n\n\tgetFilterToolbar()\n\t{\n\t\treturn this.#filterToolbar;\n\t}\n}"],"names":["Mailer","config","filterId","mailboxId","syncAvailable","elements","top","document","getElementsByClassName","element","classList","remove","BX","Main","filterManager","getById","sendApplyFilterEventForMenuRefresh","activeElement","blur","mailCounterWrapper","querySelector","filterToolbar","FilterToolbar","wrapper","filter","build","Binding","initButtons","EventEmitter","subscribe","event","getCompatData","grid","undefined","Mail","Home","Grid","getId","dir","getFilterFieldsValues","Counters","setDirectory","UI","InfoHelper","show","lock","handler","removeCustomEvent","SidePanel","Instance","close","addCustomEvent","Filter","setTimeout","emit","BaseEvent","name","FilterApi","getApi","setFields","apply"],"mappings":"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"}