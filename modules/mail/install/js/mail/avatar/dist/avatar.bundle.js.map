{"version":3,"file":"avatar.bundle.js","sources":["../src/avatar.js"],"sourcesContent":["import { Tag } from 'main.core';\nimport './css/style.css';\n\nexport class Avatar\n{\n\tstatic stringToHashCode(string)\n\t{\n\t\tlet hashCode = 0;\n\n\t\tfor (let i = 0; i < string.length; i++)\n\t\t{\n\t\t\thashCode = string.charCodeAt(i) + ((hashCode << 5) - hashCode);\n\t\t}\n\n\t\treturn hashCode;\n\t}\n\n\tstatic alignChannelRangeColor(chanelCode)\n\t{\n\t\tif(chanelCode > 255)\n\t\t{\n\t\t\treturn 255;\n\t\t}\n\t\telse if(chanelCode < 0)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Math.ceil(chanelCode);\n\t\t}\n\t}\n\n\tstatic hashToColor(hash)\n\t{\n\t\tconst maxIntensityAllChannels = 255*3;\n\t\tconst minIntensityAllChannels = 0;\n\t\tconst differenceCoefficientForGrayDetection = 0.20;\n\n\t\tlet r = (hash & 0xFF0000) >> 16;\n\t\tlet g = (hash & 0x00FF00) >> 8;\n\t\tlet b = (hash & 0x0000FF);\n\n\t\tconst contrastRatioForPastelColors = 1.5;\n\t\tconst contrastRatioForDarkColors = 2.5;\n\t\tconst channelReductionCoefficientIfGray = 2;\n\n\t\tif(maxIntensityAllChannels - (r+g+b) < 100)\n\t\t{\t//Pastel colors or white\n\t\t\tr/=contrastRatioForPastelColors;\n\t\t\tg/=contrastRatioForPastelColors;\n\t\t\tb/=contrastRatioForPastelColors;\n\t\t}\n\t\telse if((r+g+b) < (200 - minIntensityAllChannels))\n\t\t{\n\t\t\t//Very dark colors\n\t\t\tr*=contrastRatioForDarkColors;\n\t\t\tg*=contrastRatioForDarkColors;\n\t\t\tb*=contrastRatioForDarkColors;\n\t\t}\n\n\t\tlet channels = [r,g,b];\n\t\tchannels.sort(function(a,b){\n\t\t\treturn a - b;\n\t\t})\n\n\t\tif(((channels[channels.length - 1]-channels[0])/channels[0]) < differenceCoefficientForGrayDetection)\n\t\t{\n\t\t\t//Shade of gray\n\t\t\tg/=channelReductionCoefficientIfGray;\n\t\t}\n\n\t\tr=this.alignChannelRangeColor(r);\n\t\tg=this.alignChannelRangeColor(g);\n\t\tb=this.alignChannelRangeColor(b);\n\n\t\tconst color = \"#\" + (\"0\" + r.toString(16)).substr(-2) + (\"0\" + g.toString(16)).substr(-2) + (\"0\" + b.toString(16)).substr(-2);\n\t\treturn color.toUpperCase();\n\t}\n\n\tstatic stringToColor(name)\n\t{\n\t\treturn this.hashToColor(this.stringToHashCode(name));\n\t}\n\n\tstatic getInitials(string, email)\n\t{\n\t\tstring=string.replace(/[0-9]|[-\\u0026\\u002f\\u005c\\u0023\\u002c\\u002b\\u0028\\u0029\\u0024\\u007e\\u0025\\u002e\\u0027\\u0022\\u003a\\u002a\\u003f\\u003c\\u003e\\u007b\\u007d\\u00ab\\u00bb]/g,\"\");\n\t\tstring=string.replace(/^\\s+|\\s+$/g, '');\n\n\t\tconst names = string.split(' ');\n\n\t\tlet initials = names[0].substring(0, 1).toUpperCase();\n\n\t\tif (names.length > 1)\n\t\t{\n\t\t\tinitials += names[names.length - 1].substring(0, 1).toUpperCase();\n\t\t}\n\n\t\tif(initials === '')\n\t\t{\n\t\t\tinitials = email[0].toUpperCase();\n\t\t}\n\n\t\treturn initials;\n\t}\n\n\tstatic getAvatarData(config = {\n\t\tfullName: 'User Quest',\n\t\temail: 'info@example.com',\n\t})\n\t{\n\t\treturn {\n\t\t\t'abbreviation': this.getInitials(config['fullName'], config['email']),\n\t\t\t'color': this.stringToColor(config['email']),\n\t\t};\n\t}\n\n\tstatic build(config = {\n\t\tsize: 'small',\n\t\tfullName: 'User Quest',\n\t\temail: 'info@example.com',\n\t})\n\t{\n\t\tconst whiteList = new Set(['small', 'big']);\n\n\t\tif (config['size'] === undefined || !whiteList.has(config['size']))\n\t\t{\n\t\t\tconfig['size'] = 'small';\n\t\t}\n\n\t\tconst data = this.getAvatarData(config);\n\n\t\tlet avatar = Tag.render`<span class=\"mail-ui-avatar mail-ui-avatar-${config['size']}\">${data['abbreviation']}</span>`;\n\t\tavatar.style.backgroundColor = data['color'];\n\n\t\treturn avatar;\n\t}\n\n\tstatic replaceElementWithAvatar(object, avatar)\n\t{\n\t\tconst parent = object.parentNode;\n\t\tparent.insertBefore(avatar, object);\n\t\tparent.removeChild(object);\n\t}\n\n\tstatic replaceTagsWithAvatars(config = { className: 'mail-ui-avatar' })\n\t{\n\t\tconst elements = document.getElementsByClassName(config['className']);\n\t\tfor (let element of elements)\n\t\t{\n\t\t\tthis.replaceElementWithAvatar(element, this.build({\n\t\t\t\tfullName: element.getAttribute('user-name'),\n\t\t\t\temail: element.getAttribute('email'),\n\t\t\t}));\n\t\t}\n\t}\n}"],"names":["Avatar","string","hashCode","i","length","charCodeAt","chanelCode","Math","ceil","hash","maxIntensityAllChannels","minIntensityAllChannels","differenceCoefficientForGrayDetection","r","g","b","contrastRatioForPastelColors","contrastRatioForDarkColors","channelReductionCoefficientIfGray","channels","sort","a","alignChannelRangeColor","color","toString","substr","toUpperCase","name","hashToColor","stringToHashCode","email","replace","names","split","initials","substring","config","fullName","getInitials","stringToColor","size","whiteList","Set","undefined","has","data","getAvatarData","avatar","Tag","render","style","backgroundColor","object","parent","parentNode","insertBefore","removeChild","className","elements","document","getElementsByClassName","element","replaceElementWithAvatar","build","getAttribute"],"mappings":"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"}