(function(){BX.namespace("BX.Mail.UserSignature.Edit");BX.Mail.UserSignature.Edit={signatureId:null,parameters:{bindingType:"SENDER",bindingNum:0}};BX.Mail.UserSignature.Edit.checkBinding=function(){BX("sender_bind_checkbox").checked=true};BX.Mail.UserSignature.Edit.setParam=function(i,e){this.parameters[i]=e};BX.Mail.UserSignature.Edit.getParam=function(i){return this.parameters[i]};BX.Mail.UserSignature.Edit.setBindingType=function(i){this.setParam("bindingType",i)};BX.Mail.UserSignature.Edit.setBindingNum=function(i){this.setParam("bindingNum",i)};BX.Mail.UserSignature.Edit.getBindingNum=function(){return this.getParam("bindingNum")};BX.Mail.UserSignature.Edit.getBindingType=function(){return this.getParam("bindingType")};BX.Mail.UserSignature.Edit.setBinding=function(i){this.setParam("bindingText",i);this.bindingSignatureList.innerText=i;this.bindingSignatureList.title=i};BX.Mail.UserSignature.Edit.getBinding=function(){return this.getParam("bindingText")};BX.Mail.UserSignature.Edit.changeBindingType=function(i){BX.Mail.UserSignature.Edit.setBindingType(i);this.bindingTypeField.innerText=BX.message("MAIL_USERSIGNATURE_SENDER_TYPE_"+i);this.bindingTypeField.title=BX.message("MAIL_USERSIGNATURE_SENDER_TYPE_"+i);if(i==="SENDER"){this.setBinding(this.bindingsForPopup["SENDERS"][this.getBindingNum()]["text"])}else{this.setBinding(this.bindingsForPopup["ADDRESSES"][this.getBindingNum()]["text"])}};BX.Mail.UserSignature.Edit.init=function(i){var e=i["senderType"].toUpperCase();var n=BX("binding-type-field-wrapper");var t=i["selectedSender"];var s=i["selectedAddress"];var r={ADDRESSES:i["addresses"],SENDERS:i["senders"]};this.bindingsForPopup={ADDRESSES:[],SENDERS:[]};var a={ADDRESSES:"ADDRESSES",SENDERS:"SENDERS"};for(bindingType in a){var d=0;for(key in r[bindingType]){var g={text:r[bindingType][key],num:d++,onclick:BX.proxy((function(i,e){this.checkBinding();e.getMenuWindow().close();this.setBindingNum(e.num);this.setBinding(e.text)}),this)};if(t===g.text&&e==="SENDER"||s===g.text&&e==="ADDRESS"){this.setBindingNum(g.num)}this.bindingsForPopup[bindingType].push(g)}}this.bindingTypeField=BX.create("a",{text:BX.message("MAIL_USERSIGNATURE_SENDER_TYPE_SENDER"),attrs:{title:BX.message("MAIL_USERSIGNATURE_SENDER_TYPE_SENDER")},props:{className:"mail-signature-binding-type-field"},events:{click:BX.proxy((function(){this.contextMenuBindingType.show()}),this)}});this.contextMenuBindingType=new BX.PopupMenuWindow({bindElement:this.bindingTypeField,items:[{text:BX.message("MAIL_USERSIGNATURE_SENDER_TYPE_SENDER"),onclick:BX.proxy((function(i,e){this.changeBindingType("SENDER");e.getMenuWindow().close();this.checkBinding()}),this)},{text:BX.message("MAIL_USERSIGNATURE_SENDER_TYPE_ADDRESS"),onclick:BX.proxy((function(i,e){this.changeBindingType("ADDRESS");e.getMenuWindow().close();this.checkBinding()}),this)}]});this.bindingSignatureList=BX.create("a",{text:"",attrs:{title:""},props:{className:"mail-signature-binding-type-field"},events:{click:BX.proxy((function(){if(this.getBindingType()==="SENDER"){this.contextMenuSignatureSenders.show()}else{this.contextMenuSignatureAddress.show()}}),this)}});this.contextMenuSignatureAddress=new BX.PopupMenuWindow({maxHeight:150,bindElement:this.bindingSignatureList,items:this.bindingsForPopup["ADDRESSES"]});this.contextMenuSignatureSenders=new BX.PopupMenuWindow({maxHeight:150,bindElement:this.bindingSignatureList,items:this.bindingsForPopup["SENDERS"]});this.changeBindingType(e);n.appendChild(this.bindingTypeField);n.appendChild(this.bindingSignatureList);this.signatureId=i.signatureId||null;var u=function(i){var e=BX.findChildren(i,{tag:"input",attr:{type:"radio"}},true);for(var n in e){BX.bind(e[n],"change",(function(){if(this.checked){if(this.value==0){var e=BX(i.getAttribute("data-checked"));if(e){var n=BX.findNextSibling(this,{tag:"label",attr:{for:this.id}});var t=BX.findNextSibling(e,{tag:"label",attr:{for:e.id}});if(n&&t)BX.adjust(n,{text:t.innerHTML})}}else{i.setAttribute("data-checked",this.id)}}}))}BX.bind(i,"click",(function(e){e=e||window.event;e.skip_singleselect=i}));BX.bind(document,"click",(function(e){e=e||window.event;if(e.skip_singleselect!==i){if(BX(i.getAttribute("data-checked"))){BX(i.getAttribute("data-checked")).checked=true}}}))};var o=BX.findChildrenByClassName(document,"mail-set-singleselect",true);for(var d in o)u(o[d])};BX.Mail.UserSignature.Edit.save=function(i){i=i===true;var e=BX("mail-signature-signature-id").value;var n=BXHtmlEditor.Get("signatureeditorid").GetContent();var t="";if(BX("sender_bind_checkbox").checked){t=this.getBinding()}if(e>0){BX.ajax.runAction("mail.api.usersignature.update",{data:{userSignatureId:e,fields:{signature:n,sender:t}}}).then((function(n){if(i){BX.Mail.UserSignature.Edit.closeSlider(e)}else{BX.UI.Notification.Center.notify({content:BX.message("MAIL_SIGNATURE_UPDATE_SUCCESS")})}}),(function(i){BX.Mail.UserSignature.Edit.showError(i.errors.pop().message)}))}else{BX.ajax.runAction("mail.api.usersignature.add",{data:{fields:{signature:n,sender:t}}}).then((function(i){BX.Mail.UserSignature.Edit.closeSlider(i.data.userSignature.id)}),(function(i){BX.Mail.UserSignature.Edit.showError(i.errors.pop().message)}))}};BX.Mail.UserSignature.Edit.showError=function(i){var e=new BX.UI.Alert({color:BX.UI.Alert.Color.DANGER,icon:BX.UI.Alert.Icon.DANGER,text:i});BX.adjust(BX("signature-alert-container"),{html:""});BX.append(e.getContainer(),BX("signature-alert-container"))};BX.Mail.UserSignature.Edit.closeSlider=function(i){if(BX.SidePanel){var e=BX.SidePanel.Instance.getTopSlider();if(e){BX.SidePanel.Instance.postMessage(e,"mail-add-signature",{userSignatureId:i})}}BX.fireEvent(BX("ui-button-panel-close"),"click")}})();
//# sourceMappingURL=script.map.js