(function(){BX.namespace("BX.Mail.Blacklist.List");BX.Mail.Blacklist.List=function(t){this.gridId=t.gridId;this.mailAddBtn=document.querySelector('[data-role="blacklist-create-btn"]');this.addEventHandlers();this.popupButtonSave=new BX.PopupWindowButton({text:BX.message("MAIL_BLACKLIST_LIST_POPUP_BTN_ADD"),className:"popup-window-button-accept",events:{click:BX.delegate(this.onAddMailClick,this)}});this.popupButtonClose=new BX.PopupWindowButton({text:BX.message("MAIL_BLACKLIST_LIST_POPUP_BTN_CLOSE"),className:"popup-window-button-close",events:{click:BX.delegate(this.closePopup,this)}});this.popupEmailsList=this.getPopupInstance();BX.Mail.Blacklist.Repository.add(this)};BX.Mail.Blacklist.List.prototype={addEventHandlers:function(){BX.bind(this.mailAddBtn,"click",BX.delegate(this.onMailAddBtnClick,this))},onAddMailClick:function(){BX.ajax.runComponentAction("bitrix:mail.blacklist.list","addMails",{mode:"class",data:new FormData(this.formBlacklist)}).then(function(){var t=this.getMailsTextArea();if(t&&t.value){t.value=""}this.reloadGrid.bind(this,{apply_filter:"Y"})()}.bind(this),this.reloadGrid.bind(this,{hasAjaxDeleteError:1,apply_filter:"Y"}))},getMailsTextArea:function(){if(!this.textarea){this.textarea=document.querySelector('[data-role="blacklist-mails-textarea"]')}return this.textarea},onDeleteClick:function(t){if(!window.confirm(BX.message("MAIL_BLACKLIST_LIST_AJAX_DELETE_CONFIRM"))){return false}BX.ajax.runComponentAction("bitrix:mail.blacklist.list","delete",{mode:"class",data:{id:t}}).then(this.reloadGrid.bind(this,{apply_filter:"Y"}),this.reloadGrid.bind(this,{hasAjaxDeleteError:1,apply_filter:"Y"}))},onMailAddBtnClick:function(){this.popupEmailsList.show()},closePopup:function(t){this.popupEmailsList.close(t)},getPopupInstance:function(){if(this.popupEmailsList){return this.popupEmailsList}this.popupEmailsList=new BX.PopupWindow("bx-messenger-popup-settings",null,{autoHide:true,zIndex:200,overlay:{opacity:50,backgroundColor:"#000000"},buttons:[this.popupButtonSave,this.popupButtonClose],draggable:{restrict:true},closeByEsc:true,events:{onAfterPopupShow:function(){this.formBlacklist=document.querySelector('[name="form-add-mails-to-blacklist"]')}.bind(this)},titleBar:BX.message("MAIL_BLACKLIST_LIST_POPUP_TITLE"),closeIcon:true,contentColor:"white",content:document.querySelector(".mail-blacklist-popup-wrapper")});return this.popupEmailsList},reloadGrid:function(t){this.popupEmailsList.close();var i=BX.Main.gridManager.getById(this.gridId);if(i.hasOwnProperty("instance")){i.instance.reloadTable("POST",t)}}};BX.Mail.Blacklist.Repository={repo:[],add:function(t){this.repo[t.gridId]=t},getById:function(t){return this.repo[t]}};BX.Mail.Blacklist.List.onDeleteClick=function(t,i){var e=BX.Mail.Blacklist.Repository.getById(t);e.onDeleteClick(i)}})();