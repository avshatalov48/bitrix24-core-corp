(function(){if(window.BXMailMessageController)return;var e={};e.init=function(e){if(this.__inited)return;this.options=e;this.__dummyNode=document.createElement("DIV");if("edit"!=this.options.type){if(this.options.pageSize<1||this.options.pageSize>100)this.options.pageSize=5;this.__log={a:0,b:0};var t=BX("mail-msg-view-details-"+this.options.messageId);var i=BX.findChildByClassName(t.parentNode,"mail-msg-view-log-more-a",true);BX.bind(i,"click",this.handleLogClick.bind(this,"a"));var s=BX.findChildByClassName(t.parentNode,"mail-msg-view-log-more-b",true);BX.bind(s,"click",this.handleLogClick.bind(this,"b"));var a=BX.findChildrenByClassName(t.parentNode,"mail-msg-view-log-item",true);for(var o in a){var n=a[o].getAttribute("data-log").toLowerCase();if(typeof this.__log[n]!="undefined")this.__log[n]++;BX.bind(a[o],"click",this.handleLogItemClick.bind(this,a[o].getAttribute("data-id")))}this.initCreateMenu()}this.__inited=true};e.initScrollable=function(){if(!this.__scrollable){if(document.scrollingElement)this.__scrollable=document.scrollingElement}if(!this.__scrollable){if(document.documentElement.scrollTop>0||document.documentElement.scrollLeft>0)this.__scrollable=document.documentElement;else if(document.body.scrollTop>0||document.body.scrollLeft>0)this.__scrollable=document.body}if(!this.__scrollable){window.scrollBy(1,1);if(document.documentElement.scrollTop>0||document.documentElement.scrollLeft>0)this.__scrollable=document.documentElement;else if(document.body.scrollTop>0||document.body.scrollLeft>0)this.__scrollable=document.body;window.scrollBy(-1,-1)}return this.__scrollable};e.scrollWrapper=function(e){var t=this;if(!this.initScrollable())return;if(this.__scrollable.__animation){clearInterval(this.__scrollable.__animation);this.__scrollable.__animation=null}var i=this.__scrollable.scrollTop;var s=e-i;var a=0;this.__scrollable.__animation=setInterval(function(){a++;t.__scrollable.scrollTop=i+s*a/8;if(a>=8){clearInterval(t.__scrollable.__animation);t.__scrollable.__animation=null}},20)};e.scrollTo=function(e,t){if(!this.initScrollable())return;var i=BX.pos(this.__scrollable);i.top+=this.__scrollable.scrollTop;i.bottom+=this.__scrollable.scrollTop;var s=BX.pos(e);var a=typeof t=="undefined"||t===e?s:BX.pos(t);if(s.top<i.top){this.scrollWrapper(this.__scrollable.scrollTop-(i.top-s.top))}else if(a.bottom>i.bottom){this.scrollWrapper(Math.min(this.__scrollable.scrollTop-(i.top-s.top),this.__scrollable.scrollTop+(a.bottom-i.bottom)))}};e.handleLogClick=function(e,t){BX.PreventDefault(t);var i=BX.findChildByClassName(BX("mail-msg-view-details-"+this.options.messageId).parentNode,"mail-msg-view-log-more-"+e,true);this.loadLog(e,i)};e.loadLog=function(e,t){var i=this;var s=t.parentNode;if(this["__loadingLog"+e])return;this["__loadingLog"+e]=true;var a={sessid:BX.bitrix_sessid(),action:"log",id:this.options.messageId,log:e+this.__log[e],size:this.options.pageSize};if(this.options.mail_uf_message_token){a.mail_uf_message_token=this.options.mail_uf_message_token}BX.ajax({method:"POST",url:BX.util.add_url_param(this.options.ajaxUrl,{action:"log"}),data:a,dataType:"json",onsuccess:function(t){i["__loadingLog"+e]=false;if(t.status=="success"){i.__dummyNode.innerHTML=t.data.html;var a=e=="a"?BX.findNextSibling(s,{tag:"div"}):s;while(i.__dummyNode.childNodes.length>0){var o=s.parentNode.insertBefore(i.__dummyNode.childNodes[0],a);if(o.nodeType==1&&BX.hasClass(o,"mail-msg-view-log-item")){i.__log[e]++;BX.addClass(o,"mail-msg-show-animation-rev");BX.bind(o,"click",i.handleLogItemClick.bind(i,o.getAttribute("data-id")))}}if(t.data.count<i.options.pageSize)s.style.display="none";if(e=="b"&&i.initScrollable()){i.scrollWrapper(i.__scrollable.scrollHeight)}i.__dummyNode.innerHTML=""}},onfailure:function(){i["__loadingLog"+e]=false}})};e.handleLogItemClick=function(e,t){t=t||window.event;if(t.target&&t.target.tagName&&t.target.tagName.toUpperCase()=="A")return;if(window.getSelection){if(window.getSelection().toString().trim()!="")return}else if(document.selection){if(document.selection.createRange().htmlText.trim()!="")return}BX.PreventDefault(t);this.toggleLogItem(e)};e.toggleLogItem=function(e){var t=this;var i=BX("mail-msg-view-details-"+this.options.messageId).parentNode;var s=BX.findChildByClassName(i,"mail-msg-view-logitem-"+e,false);var a=BX.findChildByClassName(i,"mail-msg-view-details-"+e,false);var o=BX.hasClass(s,"mail-msg-view-item-open");BX.removeClass(s,"mail-msg-show-animation-rev");BX.toggleClass(s,"mail-msg-view-item-open");if(o){a.style.display="none";BX.addClass(s,"mail-msg-show-animation-rev");s.style.display=""}else{BX.removeClass(a,"mail-msg-show-animation-rev");BX.addClass(a,"mail-msg-show-animation");a.style.display="";if(a.getAttribute("data-empty")){var n={sessid:BX.bitrix_sessid(),action:"logitem",id:e};if(this.options.mail_uf_message_token){n.mail_uf_message_token=this.options.mail_uf_message_token}BX.ajax({method:"POST",url:BX.util.add_url_param(this.options.ajaxUrl,{action:"logitem"}),data:n,dataType:"json",onsuccess:function(i){if(i.status!="success"){i.errors=i.errors.map(function(e){return e.message});a.innerHTML='<div class="mail-msg-view-log-item-error mail-msg-view-border-bottom">'+i.errors.join("<br>")+"</div>";return}var o=BX.processHTML(i.data);BX.removeClass(a,"mail-msg-show-animation");BX.removeClass(a,"mail-msg-show-animation-rev");setTimeout(function(){a.style.textAlign="";a.innerHTML=o.HTML;if(a.offsetHeight>0)s.style.display="none";BX.ajax.processScripts(o.SCRIPT);BX.addClass(a,"mail-msg-show-animation-rev");var i=BX.findChildByClassName(a,"mail-msg-view-header",true);BX.bind(i,"click",t.handleLogItemClick.bind(t,e));t.scrollTo(a)},10);a.removeAttribute("data-empty")}});this.scrollTo(s,a)}else{s.style.display="none";this.scrollTo(a)}}};e.removeLogItem=function(e){var t=BX("mail-msg-view-details-"+this.options.messageId).parentNode;var i=BX.findChildByClassName(t,"mail-msg-view-logitem-"+e,false);var s=BX.findChildByClassName(t,"mail-msg-view-details-"+e,false);var a=i.getAttribute("data-log").toLowerCase();if(typeof this.__log[a]!="undefined")this.__log[a]--;setTimeout(function(){t.removeChild(s);t.removeChild(i)},200);s.style.maxHeight=s.offsetHeight*1.5+"px";s.style.transition="max-height .2s ease-in";s.offsetHeight;s.style.maxHeight="0px";BX.removeClass(s,"mail-msg-show-animation");BX.removeClass(s,"mail-msg-show-animation-rev");BX.addClass(s,"mail-msg-close-animation")};e.initCreateMenu=function(){var e=this;var t=e.createAction.bind(e);var i=BX("mail-msg-view-create-btn");BX.bind(i,"click",function(s){t(s,{value:e.options.createMenu.__default.id,disable:BX.addClass.bind(BX,i.parentNode,"ui-btn-main-disabled"),enable:BX.removeClass.bind(BX,i.parentNode,"ui-btn-main-disabled")})});var s=BX("mail-msg-view-create-menu-btn");BX.bind(s,"click",function(){var i=["TASKS_TASK"];if(e.options.isCrmEnabled){i.push(e.options.createMenu["CRM_ACTIVITY"].binded?"CRM_EXCLUDE":"CRM_ACTIVITY")}i=i.concat(["BLOG_POST","IM_CHAT","CALENDAR_EVENT"]);for(var a=0,o;a<i.length;a++){o=i[a];if(o==e.options.createMenu.__default.id){i.splice(a,1);a--;continue}i[a]={text:e.options.createMenu[o].title,value:e.options.createMenu[o].id,onclick:t,disabled:e.options.createMenu[o].disabled}}BX.PopupMenu.show("mail-msg-view-create-menu",s,i,{offsetLeft:16,angle:true,closeByEsc:true})})};e.createAction=function(e,t){var i=this;var s=function(e){t.enable();if(e.errors&&e.errors.length>0){var i=e.errors.map(function(e){return e.message}).join("<br>");top.BX.UI.Notification.Center.notify({autoHideDelay:5e3,content:i})}};switch(t.value){case"TASKS_TASK":top.BX.SidePanel.Instance.open(this.options.createMenu["TASKS_TASK"].href);break;case"CRM_ACTIVITY":t.disable();var a=BX.ajax.runComponentAction("bitrix:mail.client","createCrmActivity",{mode:"ajax",data:{messageId:this.options.messageId}});a.then(function(e){t.enable();top.BX.UI.Notification.Center.notify({autoHideDelay:2e3,content:BX.message("MAIL_MESSAGE_LIST_NOTIFY_ADDED_TO_CRM")});i.options.createMenu["CRM_ACTIVITY"].binded=true;BX.PopupMenu.destroy("mail-msg-view-create-menu");BX.show(BX.findChildByClassName(BX("mail-msg-view-details-"+i.options.messageId),"js-msg-view-control-skip",true))},s);break;case"CRM_EXCLUDE":t.disable();var o=t.messageId||this.options.messageId;var a=BX.ajax.runComponentAction("bitrix:mail.client","removeCrmActivity",{mode:"ajax",data:{messageId:o}});a.then(function(e){top.BX.UI.Notification.Center.notify({autoHideDelay:2e3,content:BX.message("MAIL_MESSAGE_LIST_NOTIFY_EXCLUDED_FROM_CRM")});BX.hide(BX.findChildByClassName(BX("mail-msg-view-details-"+o),"js-msg-view-control-skip",true));t.enable();if(o==i.options.messageId){i.options.createMenu["CRM_ACTIVITY"].binded=false}BX.PopupMenu.destroy("mail-msg-view-create-menu")},s);break}if(t.menuWindow){t.menuWindow.close()}};e.close=function(e){var t=top.BX.SidePanel.Instance.getSliderByWindow(window);if(t){t.setCacheable(!e);t.close()}else{window.location.href=BX.util.add_url_param(this.options.pathList,{strict:"N"})}};var t=function(i){var s=this;this.ctrl=e;this.options=i;this.__dummyNode=document.createElement("DIV");this.htmlForm=BX(this.options.formId);this.htmlForm.__wrapper=this.htmlForm.parentNode;if(this.htmlForm.__inited)return;if("edit"!=this.ctrl.options.type){this.__wrapper=BX("mail-msg-view-details-"+this.ctrl.options.messageId);if(this.options.messageId!=this.ctrl.options.messageId)this.__wrapper=BX.findChildByClassName(this.__wrapper.parentNode,"mail-msg-view-details-"+this.options.messageId,false);BX.addCustomEvent("MailMessage:replyButtonClick",function(e){if(e!==s)s.hideReplyForm()});top.BX.SidePanel.Instance.postMessage(window,"mail-message-view",{id:this.options.messageId});var a="mail_msg_"+this.options.messageId+"_body";var o=typeof document.querySelectorAll!="undefined"?document.querySelectorAll("#"+a+" a"):BX.findChildren(BX(a),{tag:"a"},true);for(var n in o){if(!o.hasOwnProperty(n))continue;if(o[n]&&o[n].setAttribute)o[n].setAttribute("target","_blank")}var l=typeof document.querySelectorAll!="undefined"?document.querySelectorAll("#"+a+" blockquote"):BX.findChildren(BX(a),{tag:"blockquote"},true);for(var n in l){if(!l.hasOwnProperty(n))continue;BX.bind(l[n],"click",function(){BX.addClass(this,"mail-msg-view-quote-unfolded")})}var r=BX.findChildrenByClassName(this.__wrapper,"mail-msg-view-rcpt-more");for(var n in r){BX.bind(r[n],"click",function(e){BX.findChildByClassName(this.parentNode,"mail-msg-view-rcpt-list-hidden",false).style.display="inline";this.style.display="none";BX.PreventDefault(e)})}var c=BX.findChildByClassName(this.__wrapper,"js-msg-view-reply-panel",true);var d=BX.findChildByClassName(this.__wrapper,"js-msg-view-control-reply",true);var m=BX.findChildByClassName(this.__wrapper,"js-msg-view-control-replyall",true);var p=BX.findChildByClassName(this.__wrapper,"js-msg-view-control-forward",true);var u=BX.findChildByClassName(this.__wrapper,"js-msg-view-control-skip",true);var _=BX.findChildByClassName(this.__wrapper,"js-msg-view-control-spam",true);var h=BX.findChildByClassName(this.__wrapper,"js-msg-view-control-delete",true);BX.bind(c,"click",this.showReplyForm.bind(this));BX.bind(m,"click",this.showReplyForm.bind(this));BX.bind(d,"click",this.showReplyForm.bind(this,true));BX.bind(p,"click",function(){var e={forward:s.options.messageId};if(s.ctrl.options.mail_uf_message_token){e.mail_uf_message_token=s.ctrl.options.mail_uf_message_token}window.location.href=BX.util.add_url_param(s.ctrl.options.pathNew,e)});BX.bind(u,"click",function(e){s.ctrl.createAction(e,{messageId:s.options.messageId,value:"CRM_EXCLUDE",disable:BX.addClass.bind(BX,u,"mail-msg-view-control-disabled"),enable:BX.removeClass.bind(BX,u,"mail-msg-view-control-disabled")})});var f=document.querySelector("[data-uid-key]");var g=0;if(f){g=f.dataset.uidKey}BX.bind(_,"click",this.markAsSpam.bind(this,_,g));BX.bind(h,"click",this.delete.bind(this,h,g))}var v=BXMainMailForm.getForm(this.options.formId);BX.addCustomEvent(v,"MailForm:field:rcptSelectorClose",t.handleRcptSelectorClose.bind(this));BX.addCustomEvent(v,"MailForm:footer:buttonClick",t.handleFooterButtonClick.bind(this));BX.addCustomEvent(v,"MailForm:submit",t.handleFormSubmit.bind(this));BX.addCustomEvent(v,"MailForm:submit:ajaxSuccess",t.handleFormSubmitSuccess.bind(this));BX.PULL.extendWatch("mail_mailbox_"+this.options.messageId);BX.addCustomEvent("onPullEvent-mail",BX.proxy(function(e,t){if(e!=="onMessageRead"){return}var i=BX("mail-msg-view-details-"+t.messageId);if(!i){i=BX.findChildByClassName(document,"mail-msg-view-logitem-"+t.messageId,true)}if(!i){return}var s=BX.findChildrenByClassName(i,"read-confirmed-datetime",true);if(s&&s.length>0){for(var a in s)BX.adjust(s[a],{text:BX.message("MAIL_MESSAGE_READ_CONFIRMED_SHORT")})}},this));this.htmlForm.__inited=true};t.handleRcptSelectorClose=function(e,t){if(!t.params.name.match(/^data\[(to|cc|bcc)\]$/))return;for(var i=0,s;i<e.fields.length;i++){s=e.fields[i];if(s.selector==t.selector||!s.params.name.match(/^data\[(to|cc|bcc)\]$/))continue;BX.SocNetLogDestination.obItems[s.selector]=BX.SocNetLogDestination.obItems[t.selector];BX.SocNetLogDestination.obItemsLast[s.selector]=BX.SocNetLogDestination.obItemsLast[t.selector]}};t.handleFooterButtonClick=function(e,t){if(BX.hasClass(t,"main-mail-form-cancel-button")){if("edit"==this.ctrl.options.type){this.ctrl.close()}else{this.hideReplyForm()}}};t.handleFormSubmit=function(e,t){var i=this.htmlForm.elements;var s=true;for(var a=0;a<i.length;a++){if("data[to][]"==i[a].name&&i[a].value.length>0)s=false}if(s){e.showError(BX.message("MAIL_MESSAGE_NEW_EMPTY_RCPT"));return BX.PreventDefault(t)}var o;for(var a in e.postForm.controllers){if(!e.postForm.controllers.hasOwnProperty(a))continue;if(e.postForm.controllers[a].storage!="disk")continue;try{o=0;o=e.postForm.controllers[a].handler.agent.upload.filesCount}catch(e){}if(o>0){e.showError(BX.message("MAIL_MESSAGE_NEW_UPLOADING"));return BX.PreventDefault(t)}}};t.handleFormSubmitSuccess=function(e,t){if(t.status!="success"){var i=document.createElement("DIV");if(!t.errors||!BX.type.isArray(t.errors)){t.errors=[{message:BX.message("MAIL_CLIENT_AJAX_ERROR"),code:0}]}for(var s=0;s<t.errors.length;s++){i.appendChild(document.createTextNode(t.errors[s].message));i.appendChild(document.createElement("BR"))}e.showError(i.innerHTML)}else{if("edit"!=this.ctrl.options.type){this.hideReplyForm()}top.BX.SidePanel.Instance.postMessage(window,"Mail.Client.MessageCreatedSuccess",t);top.BX.UI.Notification.Center.notify({autoHideDelay:2e3,content:BX.message("MAIL_MESSAGE_SEND_SUCCESS")});this.ctrl.close(true)}};t.prototype.showReplyForm=function(e){var t=BXMainMailForm.getForm(this.options.formId);var i=BX.findChildByClassName(this.__wrapper,"js-msg-view-reply-panel",true);if(this.htmlForm.parentNode===this.__dummyNode)this.htmlForm.__wrapper.appendChild(this.htmlForm);t.init();if(e===true){t.getField("data[to]").setValue(this.options.rcptSelected);t.getField("data[cc]").setValue()}else{t.getField("data[to]").setValue(this.options.rcptAllSelected);t.getField("data[cc]").setValue(this.options.rcptCcSelected)}t.getField("data[bcc]").setValue();BX.onCustomEvent("MailMessage:replyButtonClick",[this]);BX.addClass(this.htmlForm,"mail-msg-show-animation");this.htmlForm.style.display="";i.style.display="none";BX.onCustomEvent(t,"MailForm:show",[]);this.ctrl.scrollTo(this.htmlForm)};t.prototype.hideReplyForm=function(){var e=BXMainMailForm.getForm(this.options.formId);var t=BX.findChildByClassName(this.__wrapper,"js-msg-view-reply-panel",true);BX.addClass(t,"mail-msg-show-animation-rev");t.style.display="";this.htmlForm.style.display="none";BX.onCustomEvent(e,"MailForm:hide",[]);this.__dummyNode.appendChild(this.htmlForm)};t.prototype.markAsSpam=function(e,t){e.classList.add("mail-msg-view-control-disabled");BX.ajax.runComponentAction("bitrix:mail.client","markAsSpam",{mode:"ajax",data:{ids:[t]}}).then(this.onMessageActionSuccess.bind(this,e),function(e){this.onMessageActionError.bind(this,e)()}.bind(this))};t.prototype.delete=function(e,t){if(e.dataset&&e.dataset.isTrash){if(!this.popupDeleteConfirm){var i=[new BX.PopupWindowButton({text:BX.message("MAIL_MESSAGE_LIST_CONFIRM_CANCEL_BTN"),className:"popup-window-button-cancel",events:{click:BX.delegate(function(){this.popupDeleteConfirm.close()},this)}}),new BX.PopupWindowButton({text:BX.message("MAIL_MESSAGE_LIST_CONFIRM_DELETE_BTN"),className:"popup-window-button-decline",events:{click:BX.delegate(function(){this.processDelete(e,t);this.popupDeleteConfirm.close()},this)}})];this.popupDeleteConfirm=new BX.PopupWindow("bx-mail-message-list-popup-delete-confirm",null,{zIndex:1e3,autoHide:true,buttons:i,closeByEsc:true,titleBar:{content:BX.create("div",{html:'<span class="popup-window-titlebar-text">'+BX.message("MAIL_MESSAGE_LIST_CONFIRM_TITLE")+"</span>"})},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:BX.delegate(function(){this.popupDeleteConfirm=null},this)},content:BX.create("div",{html:BX.message("MAIL_MESSAGE_LIST_CONFIRM_DELETE")})})}this.popupDeleteConfirm.show()}else{this.processDelete(e,t)}};t.prototype.processDelete=function(e,t){e.classList.add("mail-msg-view-control-disabled");BX.ajax.runComponentAction("bitrix:mail.client","delete",{mode:"ajax",data:{ids:[t]}}).then(this.onMessageActionSuccess.bind(this,e),function(e){this.onMessageActionError.bind(this,e)()}.bind(this))};t.prototype.onMessageActionError=function(e){alert(e.errors[0].message)};t.prototype.onMessageActionSuccess=function(e){top.BX.SidePanel.Instance.postMessage(window,"mail-message-reload-grid",{});this.ctrl.close(true)};var i={};i.init=function(e){this.mailbox=e||{};return this};i.sync=function(e,t,s){var a=this;if(a.syncLock){return}a.syncLock=true;if(!BX.type.isDomNode(e)){e=document.createElement("DIV")}BX.addClass(e,"ui-btn-wait");var o=BX.ajax.runComponentAction("bitrix:mail.client","syncMailbox",{mode:"ajax",data:{id:a.mailbox.ID}});o.then(function(o){a.syncLock=false;BX.removeClass(e,"ui-btn-wait");BX.addClass(e,"ui-btn-icon-buisness");BX.removeClass(e,"ui-btn-icon-business-warning");e.setAttribute("title",BX.message("MAIL_MESSAGE_SYNC_BTN_HINT"));i.updateStepper(t,o.data.complete,o.data.status);if(o.data.new>0){BX.Main.gridManager.getInstanceById(s).reload()}},function(t){a.syncLock=false;BX.removeClass(e,"ui-btn-wait");BX.addClass(e,"ui-btn-icon-business-warning");BX.removeClass(e,"ui-btn-icon-buisness");var i=BX.message("MAIL_CLIENT_AJAX_ERROR");if(t.errors&&t.errors.length>0){i+="\n";i+=t.errors.map(function(e){return e.message}).join("\n")}e.setAttribute("title",i)})};i.updateStepper=function(e,t,i){if(t){e.style.display="none"}else{var s=BX.findChildByClassName(e,"main-stepper-bar-line");var a=BX.findChildByClassName(e,"main-stepper-steps");if(i>=0){var i=Math.min(Math.max(Math.round(parseFloat(i)*100),1),99);if(s){s.style.width=i+"%"}if(a){a.innerHTML=i+"%"}}else{if(s){s.style.width="0%"}if(a){a.innerHTML=""}}e.style.display=""}var o=document.createEvent("Event");o.initEvent("resize",true,true);window.dispatchEvent(o)};i.setupDirs=function(e){var t={};try{t=this.mailbox.OPTIONS.imap}catch(e){}var i=t.dirs;var s=t.dirsList;var a=t.ignore||[];var o=t.disabled||[];var n=BX.type.isArray(t.outcome)&&t.outcome[0]?t.outcome[0]:"";var l=BX.type.isArray(t.trash)&&t.trash[0]?t.trash[0]:"";var r=BX.type.isArray(t.spam)&&t.spam[0]?t.spam[0]:l;if(i){var c=[];var d,m,p;for(var u=0;u<s.length;u++){m=s[u];if(i.hasOwnProperty(m)){d=i[m];p=d.length-1;c.push({item:d,path:m,name:d[p],level:p,ignore:BX.util.in_array(m,a),disabled:BX.util.in_array(m,o)})}}top.BX.SidePanel.Instance.open("mail:mailbox-setup-dirs",{width:640,cacheable:false,contentCallback:function(e){var t=new top.BX.Promise;var i="",s,a,o;var d=c.length,m,p;i+='<div class="mail-connect-section-block">';i+='<div class="mail-connect-title-block">';i+='<div class="mail-connect-title">'+BX.message("MAIL_CLIENT_CONFIG_IMAP_DIRS_SYNC")+"</div>";i+="</div>";for(m=0;m<d;m++){p=c[m].disabled?"disabled":!c[m].ignore?"checked":"";i+='<div class="mail-connect-option-email mail-connect-form-check-hidden" style="padding-left: '+25*c[m].level+'px">';i+='<input onclick="return document.querySelectorAll(\'.mail-connect-form-input-check:checked\').length > 0; " class="mail-connect-form-input mail-connect-form-input-check" id="imap-dir-sync-n'+m+'" type="checkbox" name="imap_dirs[sync]['+m+']" value="'+c[m].path+'" '+p+">";i+='<label class="mail-connect-form-label mail-connect-form-label-check" for="imap-dir-sync-n'+m+'" '+(c[m].disabled?'style="color: #a0a0a0;"':"")+">"+c[m].name+"</label>";i+="</div>"}i+="</div>";i+='<div class="mail-connect-section-block">';i+='<div class="mail-connect-title-block">';i+='<div class="mail-connect-title">';i+=BX.message("MAIL_CLIENT_CONFIG_IMAP_DIRS_FOR");i+="</div></div>";s="";o="";a='<input id="mail_connect_setup_dirs_outcome_placeholder" type="radio" name="imap_dirs[outcome]" value="" checked>';a+='<label for="mail_connect_setup_dirs_outcome_placeholder">'+BX.message("MAIL_CLIENT_CONFIG_IMAP_DIRS_EMPTY_DEFAULT")+"</label>";for(m=0;m<d;m++){if(c[m].disabled){continue}p="";if(c[m].path==n){p="checked";a="";o="mail_connect_setup_dirs_outcome_"+(m+1)}s+='<input type="radio" name="imap_dirs[outcome]" value="'+BX.util.htmlspecialchars(c[m].path)+'" id="mail_connect_setup_dirs_outcome_'+(m+1)+'" '+p+">";s+='<label for="mail_connect_setup_dirs_outcome_'+(m+1)+'">'+BX.util.htmlspecialchars(c[m].item.join(" / "))+"</label>"}i+='<div class="mail-connect-option-email mail-connect-form-check-hidden">'+BX.message("MAIL_CLIENT_CONFIG_IMAP_DIRS_OUTCOME")+'<label class="mail-set-singleselect mail-set-singleselect-line" data-checked="'+o+'">\t\t\t\t\t\t\t\t<input id="mail_connect_setup_dirs_outcome_0" type="radio" name="imap_dirs[outcome]" value="0">\t\t\t\t\t\t\t\t<div class="mail-set-singleselect-wrapper">'+s+"</div>"+a+"</label>\t\t\t\t\t\t</div>";s="";o="";a='<input id="mail_connect_setup_dirs_trash_placeholder" type="radio" name="imap_dirs[trash]" value="" checked>';a+='<label for="mail_connect_setup_dirs_trash_placeholder">'+BX.message("MAIL_CLIENT_CONFIG_IMAP_DIRS_EMPTY_DEFAULT")+"</label>";for(m=0;m<d;m++){if(c[m].disabled){continue}p="";if(c[m].path==l){p="checked";a="";o="mail_connect_setup_dirs_trash_"+(m+1)}s+='<input type="radio" name="imap_dirs[trash]" value="'+BX.util.htmlspecialchars(c[m].path)+'" id="mail_connect_setup_dirs_trash_'+(m+1)+'" '+p+">";s+='<label for="mail_connect_setup_dirs_trash_'+(m+1)+'">'+BX.util.htmlspecialchars(c[m].item.join(" / "))+"</label>"}i+='<div class="mail-connect-option-email mail-connect-form-check-hidden">'+BX.message("MAIL_CLIENT_CONFIG_IMAP_DIRS_TRASH")+'<label class="mail-set-singleselect mail-set-singleselect-line" data-checked="'+o+'">\t\t\t\t\t\t\t\t<input id="mail_connect_setup_dirs_trash_0" type="radio" name="imap_dirs[trash]" value="0">\t\t\t\t\t\t\t\t<div class="mail-set-singleselect-wrapper">'+s+"</div>"+a+"</label>\t\t\t\t\t\t</div>";s="";o="";a='<input id="mail_connect_setup_dirs_spam_placeholder" type="radio" name="imap_dirs[spam]" value="" checked>';a+='<label for="mail_connect_setup_dirs_spam_placeholder">'+BX.message("MAIL_CLIENT_CONFIG_IMAP_DIRS_EMPTY_DEFAULT")+"</label>";for(m=0;m<d;m++){if(c[m].disabled){continue}p="";if(c[m].path==r){p="checked";a="";o="mail_connect_setup_dirs_spam_"+(m+1)}s+='<input type="radio" name="imap_dirs[spam]" value="'+BX.util.htmlspecialchars(c[m].path)+'" id="mail_connect_setup_dirs_spam_'+(m+1)+'" '+p+">";s+='<label for="mail_connect_setup_dirs_spam_'+(m+1)+'">'+BX.util.htmlspecialchars(c[m].item.join(" / "))+"</label>"}i+='<div class="mail-connect-option-email mail-connect-form-check-hidden">'+BX.message("MAIL_CLIENT_CONFIG_IMAP_DIRS_SPAM")+'<label class="mail-set-singleselect mail-set-singleselect-line" data-checked="'+o+'">\t\t\t\t\t\t\t\t<input id="mail_connect_setup_dirs_spam_0" type="radio" name="imap_dirs[spam]" value="0">\t\t\t\t\t\t\t\t<div class="mail-set-singleselect-wrapper">'+s+"</div>"+a+"</label>\t\t\t\t\t\t</div>";i+="</div>";t.fulfill('<form class="mail-connect-setup-dirs-form" style="display: flex; flex-direction: column; height: 100%; ">\t\t\t\t\t\t\t\t<div style="padding: 0 20px 20px 20px; flex: 1; overflow: auto; ">\t\t\t\t\t\t\t\t\t<div class="mail-msg-sidepanel-header">\t\t\t\t\t\t\t\t\t\t<div class="mail-msg-sidepanel-title-container">\t\t\t\t\t\t\t\t\t\t\t<div class="mail-msg-sidepanel-title">\t\t\t\t\t\t\t\t\t\t\t\t<span class="mail-msg-sidepanel-title-text">'+BX.message("MAIL_CLIENT_CONFIG_IMAP_DIRS_TITLE")+'</span>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t<div class="mail-connect mail-connect-slider">'+i+'</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div class="mail-connect-footer mail-connect-footer-fixed" style="position: static; ">\t\t\t\t\t\t\t\t\t<div class="mail-connect-footer-container">\t\t\t\t\t\t\t\t\t\t<button class="ui-btn ui-btn-md ui-btn-success ui-btn-success mail-connect-btn-connect" type="submit">'+BX.message("MAIL_CLIENT_CONFIG_IMAP_DIRS_BTN_SAVE")+'</button>\t\t\t\t\t\t\t\t\t\t<button class="ui-btn ui-btn-md ui-btn-link mail-connect-btn-cancel" type="reset">'+BX.message("MAIL_CLIENT_CONFIG_IMAP_DIRS_BTN_CANCEL")+"</button>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</form>");return t},events:{onLoad:function(s){var a=BX.findChildByClassName(s.slider.layout.content,"mail-connect-setup-dirs-form",true);top.BX.bind(a,"submit",function(o){o.preventDefault();var n=BX.ajax.prepareForm(a).data;if(n.imap_dirs){t.outcome=n.imap_dirs.outcome?[n.imap_dirs.outcome]:t.outcome;t.trash=n.imap_dirs.trash?[n.imap_dirs.trash]:t.trash;t.spam=n.imap_dirs.spam?[n.imap_dirs.spam]:t.spam;if(n.imap_dirs.sync){t.ignore=[];for(m in i){if(i.hasOwnProperty(m)){t.ignore.push(m)}}var l,r;for(l in n.imap_dirs.sync){if(n.imap_dirs.sync.hasOwnProperty(l)){r=BX.util.array_search(n.imap_dirs.sync[l],t.ignore);if(!(r<0)){t.ignore.splice(r,1)}}}}}e(n);s.slider.close()});top.BX.bind(a,"reset",function(e){s.slider.close()});var o=function(e){var t=BX.findChildren(e,{tag:"input",attr:{type:"radio"}},true);for(var i in t){BX.bind(t[i],"change",function(){if(this.checked){if(this.value==0){var t=BX(e.getAttribute("data-checked"));if(t){var i=BX.findNextSibling(this,{tag:"label",attr:{for:this.id}});var s=BX.findNextSibling(t,{tag:"label",attr:{for:t.id}});if(i&&s)BX.adjust(i,{text:s.innerHTML})}}else{e.setAttribute("data-checked",this.id)}}})}BX.bind(e,"click",function(t){t=t||window.event;t.skip_singleselect=e});BX.bind(s.getSlider().getContentContainer(),"click",function(t){t=t||window.event;if(t.skip_singleselect!==e){if(top.BX(e.getAttribute("data-checked"))){top.BX(e.getAttribute("data-checked")).checked=true}}})};var n=BX.findChildrenByClassName(s.getSlider().getContentContainer(),"mail-set-singleselect",true);for(var l in n)o(n[l])}}})}};window.BXMailMessageController=e;window.BXMailMessage=t;window.BXMailMailbox=i})();(function(){if(window!==window.top){return;BX.bind(window,"beforeunload",function(){document.body.style.opacity="0.4"})}var e=("/"+(BX.message.SITE_DIR||"/").replace(/[\\*+?.()|[\]{}]/g,"\\$&")+"/").replace(/\/+/g,"/");top.BX.SidePanel.Instance.bindAnchors({rules:[{condition:["^"+e+"mail/config/(new|edit)"],options:{width:760,cacheable:false}},{condition:["^"+e+"mail/(blacklist|signature|config|message)"],options:{width:1080}}]})})();
//# sourceMappingURL=script.map.js