(function(){if(window.BXMailMessageActions)return;var e={};e.init=function(e){var a=this;a.options=e;var n=a.createAction.bind(a);var t=BX("mail-msg-"+a.options.messageId+"-actions-create-btn");BX.bind(t,"click",function(e){n(e,{value:a.options.createMenu.__default.id,disable:BX.addClass.bind(BX,t.parentNode,"ui-btn-main-disabled"),enable:BX.removeClass.bind(BX,t.parentNode,"ui-btn-main-disabled")})});var i=BX("mail-msg-"+a.options.messageId+"-actions-create-menu-btn");BX.bind(i,"click",function(){var e=["TASKS_TASK"];if(a.options.isCrmEnabled){e.push(a.options.createMenu["CRM_ACTIVITY"].binded?"CRM_EXCLUDE":"CRM_ACTIVITY")}e=e.concat(["BLOG_POST","IM_CHAT","CALENDAR_EVENT"]);for(var t=0,s;t<e.length;t++){s=e[t];if(s==a.options.createMenu.__default.id){e.splice(t,1);t--;continue}e[t]={text:a.options.createMenu[s].title,value:a.options.createMenu[s].id,onclick:n,disabled:a.options.createMenu[s].disabled}}BX.Main.MenuManager.show("mail-msg-"+a.options.messageId+"-create-menu",i,e,{offsetLeft:16,angle:true,closeByEsc:true})})};e.createAction=function(e,a){var n=this;var t=function(e){a.enable();if(e.errors&&e.errors.length>0){var n=e.errors.map(function(e){return e.message}).join("<br>");top.BX.UI.Notification.Center.notify({autoHideDelay:5e3,content:n})}};switch(a.value){case"TASKS_TASK":top.BX.SidePanel.Instance.open(n.options.createMenu["TASKS_TASK"].href,{cacheable:false,loader:"task-new-loader"});break;case"BLOG_POST":top.BX.SidePanel.Instance.open(n.options.createMenu["BLOG_POST"].href,{cacheable:false,loader:"socialnetwork:userblogposteditex"});break;case"IM_CHAT":BX.Mail.Secretary.getInstance(n.options.messageId).openChat();break;case"CALENDAR_EVENT":BX.Mail.Secretary.getInstance(n.options.messageId).openCalendarEvent();break;case"CRM_ACTIVITY":a.disable();var i=BX.ajax.runComponentAction("bitrix:mail.client","createCrmActivity",{mode:"ajax",data:{messageId:n.options.messageId}});i.then(function(e){a.enable();top.BX.UI.Notification.Center.notify({autoHideDelay:2e3,content:BX.message("MAIL_MESSAGE_ACTIONS_NOTIFY_ADDED_TO_CRM")});n.options.createMenu["CRM_ACTIVITY"].binded=true;BX.Main.MenuManager.destroy("mail-msg-"+n.options.messageId+"-create-menu");BX.Event.EventEmitter.emit("BXMailMessageActions:CRM_ACTIVITY",{messageId:n.options.messageId})},t);break;case"CRM_EXCLUDE":a.disable();var s=a.messageId||n.options.messageId;var i=BX.ajax.runComponentAction("bitrix:mail.client","removeCrmActivity",{mode:"ajax",data:{messageId:s}});i.then(function(e){top.BX.UI.Notification.Center.notify({autoHideDelay:2e3,content:BX.message("MAIL_MESSAGE_ACTIONS_NOTIFY_EXCLUDED_FROM_CRM")});BX.Event.EventEmitter.emit("BXMailMessageActions:CRM_EXCLUDE",{messageId:n.options.messageId});a.enable();if(s==n.options.messageId){n.options.createMenu["CRM_ACTIVITY"].binded=false}BX.Main.MenuManager.destroy("mail-msg-"+n.options.messageId+"-create-menu")},t);break}if(a.menuWindow){a.menuWindow.close()}};window.BXMailMessageActions=e})();
//# sourceMappingURL=script.map.js