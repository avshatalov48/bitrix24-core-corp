(function(){if(window.BXMailMessageActions)return;var e={};e.init=function(e){var n=this;n.options=e;var a=n.createAction.bind(n);var t=BX("mail-msg-"+n.options.messageId+"-actions-create-btn");BX.bind(t,"click",function(e){a(e,{value:n.options.createMenu.__default.id,disable:BX.addClass.bind(BX,t.parentNode,"ui-btn-main-disabled"),enable:BX.removeClass.bind(BX,t.parentNode,"ui-btn-main-disabled")})});var i=BX("mail-msg-"+n.options.messageId+"-actions-create-menu-btn");BX.bind(i,"click",function(){var e=["TASKS_TASK"];if(n.options.isCrmEnabled){e.push(n.options.createMenu["CRM_ACTIVITY"].binded?"CRM_EXCLUDE":"CRM_ACTIVITY")}e=e.concat(["BLOG_POST","IM_CHAT","CALENDAR_EVENT"]);for(var t=0,o;t<e.length;t++){o=e[t];if(o==n.options.createMenu.__default.id){e.splice(t,1);t--;continue}e[t]={text:n.options.createMenu[o].title,value:n.options.createMenu[o].id,onclick:a,disabled:n.options.createMenu[o].disabled}}BX.Main.MenuManager.show("mail-msg-"+n.options.messageId+"-create-menu",i,e,{offsetLeft:16,angle:true,closeByEsc:true})})};e.createAction=function(e,n){var a=this;var t=function(e){n.enable();if(e.errors&&e.errors.length>0){var a=e.errors.map(function(e){return e.message}).join("<br>");top.BX.UI.Notification.Center.notify({autoHideDelay:5e3,content:a})}};switch(n.value){case"TASKS_TASK":top.BX.SidePanel.Instance.open(a.options.createMenu["TASKS_TASK"].href,{cacheable:false,loader:"task-new-loader"});break;case"BLOG_POST":top.BX.SidePanel.Instance.open(a.options.createMenu["BLOG_POST"].href,{cacheable:false,loader:"socialnetwork:userblogposteditex"});break;case"CRM_ACTIVITY":n.disable();var i=BX.ajax.runComponentAction("bitrix:mail.client","createCrmActivity",{mode:"ajax",data:{messageId:a.options.messageId}});i.then(function(e){n.enable();top.BX.UI.Notification.Center.notify({autoHideDelay:2e3,content:BX.message("MAIL_MESSAGE_ACTIONS_NOTIFY_ADDED_TO_CRM")});a.options.createMenu["CRM_ACTIVITY"].binded=true;BX.Main.MenuManager.destroy("mail-msg-"+a.options.messageId+"-create-menu");BX.Event.EventEmitter.emit("BXMailMessageActions:CRM_ACTIVITY",{messageId:a.options.messageId})},t);break;case"CRM_EXCLUDE":n.disable();var o=n.messageId||a.options.messageId;var i=BX.ajax.runComponentAction("bitrix:mail.client","removeCrmActivity",{mode:"ajax",data:{messageId:o}});i.then(function(e){top.BX.UI.Notification.Center.notify({autoHideDelay:2e3,content:BX.message("MAIL_MESSAGE_ACTIONS_NOTIFY_EXCLUDED_FROM_CRM")});BX.Event.EventEmitter.emit("BXMailMessageActions:CRM_EXCLUDE",{messageId:a.options.messageId});n.enable();if(o==a.options.messageId){a.options.createMenu["CRM_ACTIVITY"].binded=false}BX.Main.MenuManager.destroy("mail-msg-"+a.options.messageId+"-create-menu")},t);break}if(n.menuWindow){n.menuWindow.close()}};window.BXMailMessageActions=e})();
//# sourceMappingURL=script.map.js