{"version":3,"file":"preview.bundle.js","sources":["../src/document-empty/index.js","../src/document-loading/index.js","../src/document-ready/block-area/index.js","../src/document-ready/navigation/index.js","../src/document-ready/zoom/touch-controller.js","../src/document-ready/zoom/index.js","../src/document-ready/index.js","../src/preview.js"],"sourcesContent":["import { Tag } from 'main.core';\n\nimport './style.css';\n\nexport const DocumentEmpty =\n{\n\trender()\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-preview__document-background\">\n\t\t\t\t<div class=\"sign-preview__document-empty\">\n\t\t\t\t\t<video poster=\"/bitrix/js/sign/preview/images/sign-preview-document-demo.jpg\" autoplay=\"true\" loop=\"true\" muted=\"true\" playsinline=\"true\">\n\t\t\t\t\t\t<source type=\"video/mp4\" src=\"/bitrix/js/sign/preview/images/sign-preview-document-demo.mp4\">\n\t\t\t\t\t\t<source type=\"video/webm\" src=\"/bitrix/js/sign/preview/images/sign-preview-document-demo.webm\">\n\t\t\t\t\t</video>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n}","import { Tag } from 'main.core';\nimport { Loader } from 'main/loader';\n\nimport './style.css';\n\nexport const DocumentLoading =\n{\n\trender()\n\t{\n\t\tconst nodeLoader =  Tag.render`\n\t\t\t<div class=\"sign-preview__loader\"></div>\n\t\t`;\n\n\t\tnew Loader({\n\t\t\tsize: 80\n\t\t}).show(nodeLoader);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-preview__document-background\">\n\t\t\t\t<div class=\"sign-preview__document-loading\">\n\t\t\t\t\t<div class=\"sign-preview__document-loading_container\">\n\t\t\t\t\t\t<div class=\"sign-preview__document-loading_logo ${BX.message('LANGUAGE_ID') === 'ru' ? '--ru' : ''}\"></div>\n\t\t\t\t\t\t${nodeLoader}\t\t\n\t\t\t\t\t\t<div class=\"sign-preview__document-loading_message\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;;\n\t}\n}","import { Tag, Dom, Type, Text } from 'main.core';\n\nimport './style.css';\n\nexport class BlockArea\n{\n\t#style: Array;\n\t#data: String;\n\t#layout: Array\n\n\tconstructor({ id, style, data })\n\t{\n\t\tthis.id = id ? id : null;\n\t\tthis.#style = style ? style : {};\n\t\tthis.#data = data ? data : null;\n\t\tthis.#layout = {\n\t\t\tcontainer: null\n\t\t};\n\t}\n\n\t#getNodeContainer()\n\t{\n\t\tif (!this.#layout.container)\n\t\t{\n\t\t\t\n\t\t\tthis.#layout.container = Tag.render`\n\t\t\t\t<div class=\"sign-preview__block-area --empty\"></div>\n\t\t\t`;\n\t\t\t\n\t\t\tif (Type.isString(this.#data.text))\n\t\t\t{\n\t\t\t\tlet preContent = Text.encode(this.#data.text);\n\t\t\t\tlet content = preContent.replaceAll('[br]', '<br>');\n\t\t\t\tthis.#layout.container = Tag.render`\n\t\t\t\t\t<div class=\"sign-preview__block-area${this.#data.text === '' ? ' --empty' : ''}\">${content}</div>\n\t\t\t\t`;\n\t\t\t}\n\n\t\t\tif (this.#data.base64)\n\t\t\t{\n\t\t\t\tconst src = 'data:image;base64,' + this.#data.base64;\n\t\t\t\tthis.#layout.container = Tag.render`\n\t\t\t\t\t<div class=\"sign-preview__block-area --image\">\n\t\t\t\t\t\t<img src=\"${src}\" alt=\"\">\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}\n\n\t\t\tfor (let key in this.#style)\n\t\t\t{\n\t\t\t\tthis.#layout.container.style.setProperty(key, this.#style[key]);\n\t\t\t}\n\n\t\t}\n\n\t\treturn this.#layout.container;\n\t}\n\n\trender()\n\t{\n\t\treturn this.#getNodeContainer();\n\t}\n}","import { Tag, Type, Dom, Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport './style.css';\n\nexport class Navigation\n{\n\tconstructor({ totalPages })\n\t{\n\t\tthis.totalPages = totalPages ? totalPages : null;\n\t\tthis.currentPage = 1;\n\t\tthis.layout = {\n\t\t\tcontainer: null,\n\t\t\tnext: null,\n\t\t\tprev: null,\n\t\t\tcurrentPage: null,\n\t\t\ttotalPages: null\n\t\t}\n\t}\n\n\t#getNodeNext()\n\t{\n\t\tif (!this.layout.next)\n\t\t{\n\t\t\tconst icon = Tag.render`<i></i>`;\n\t\t\tthis.layout.next = Tag.render`\n\t\t\t\t<div class=\"sign-preview__navigation-control --next\">\n\t\t\t\t\t${icon}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\ticon.addEventListener('click', () => {\n\t\t\t\tif (this.currentPage < this.totalPages)\n\t\t\t\t{\n\t\t\t\t\tthis.currentPage++;\n\t\t\t\t\tthis.#getNodePrev().classList.remove('--lock');\n\t\t\t\t}\n\n\t\t\t\tif (this.currentPage === this.totalPages)\n\t\t\t\t{\n\t\t\t\t\tthis.#getNodeNext().classList.add('--lock');\n\t\t\t\t}\n\n\t\t\t\tthis.#setCurrentPage(this.currentPage);\n\t\t\t\tEventEmitter.emit(this, 'showNextPage', this.currentPage);\n\t\t\t});\n\n\t\t}\n\n\t\treturn this.layout.next;\n\t}\n\n\t#getNodePrev()\n\t{\n\t\tif (!this.layout.prev)\n\t\t{\n\t\t\tconst icon = Tag.render`<i></i>`;\n\t\t\tthis.layout.prev = Tag.render`\n\t\t\t\t<div class=\"sign-preview__navigation-control --prev --lock\">\n\t\t\t\t\t${icon}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\ticon.addEventListener('click', () => {\n\t\t\t\tif (this.currentPage > 1)\n\t\t\t\t{\n\t\t\t\t\tthis.currentPage--;\n\t\t\t\t\tthis.#getNodeNext().classList.remove('--lock');\n\t\t\t\t}\n\n\t\t\t\tif (this.currentPage === 1)\n\t\t\t\t{\n\t\t\t\t\tthis.#getNodePrev().classList.add('--lock');\n\t\t\t\t}\n\n\t\t\t\tthis.#setCurrentPage(this.currentPage);\n\t\t\t\tEventEmitter.emit(this, 'showPrevPage', this.currentPage);\n\t\t\t});\n\t\t}\n\n\t\treturn this.layout.prev;\n\t}\n\n\t#getNodeTotalPages()\n\t{\n\t\tif (!this.layout.totalPages)\n\t\t{\n\t\t\tthis.layout.totalPages = Tag.render`\n\t\t\t\t<span>/${this.totalPages}</span>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.totalPages;\n\t}\n\n\t#getNodeCurrentPage()\n\t{\n\t\tif (!this.layout.currentPage)\n\t\t{\n\t\t\tthis.layout.currentPage = Tag.render`\n\t\t\t\t<span>${this.currentPage}</span>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.currentPage;\n\t}\n\n\t#getNodeContainer()\n\t{\n\t\tif (!this.layout.container)\n\t\t{\n\t\t\tthis.layout.container = Tag.render`\n\t\t\t\t<div class=\"sign-preview__navigation\">\n\t\t\t\t\t${this.#getNodePrev()}\n\t\t\t\t\t<div class=\"sign-preview__navigation-info\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_CMP_MASTER_TPL_PREVIEW_PAGE')} ${this.#getNodeCurrentPage()}${this.#getNodeTotalPages()}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#getNodeNext()}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tif (this.totalPages === 1 || !this.totalPages)\n\t\t\t{\n\t\t\t\tthis.lock();\n\t\t\t}\n\t\t}\n\n\t\treturn this.layout.container;\n\t}\n\n\t#setCurrentPage(param: Number)\n\t{\n\t\tif (Type.isNumber(param))\n\t\t{\n\t\t\tthis.#getNodeCurrentPage().innerText = param;\n\t\t}\n\t}\n\n\tlock()\n\t{\n\t\tDom.addClass(this.#getNodeContainer(), '--lock');\n\t}\n\n\tunLock()\n\t{\n\t\tDom.removeClass(this.#getNodeContainer(), '--lock');\n\t}\n\n\trender()\n\t{\n\t\treturn this.#getNodeContainer();\n\t}\n}","export class TouchController\n{\n\tconstructor({ target })\n\t{\n\t\tthis.target = target ? target : null;\n\t\tthis.pos = { top: 0, left: 0, x: 0, y: 0 };\n\t\tthis.touchInit = false;\n\t\tthis.init();\n\t}\n\n\tinit()\n\t{\n\t\tif (!this.target)\n\t\t{\n\t\t\tconsole.warn('BX.Sign.Preview: TouchController not initialized')\n\t\t\treturn;\n\t\t}\n\n\t\tthis.target.addEventListener('mousedown', this.mouseDownHandler.bind(this));\n\t\tthis.target.addEventListener('mousemove', this.mouseMoveHandler.bind(this));\n\t\tthis.target.addEventListener('mouseup', this.mouseUpHandler.bind(this));\n\t\tthis.target.addEventListener('mouseleave', this.mouseUpHandler.bind(this));\n\t}\n\n\tmouseDownHandler(ev)\n\t{\n\t\tthis.touchInit = true;\n\t\tthis.target.style.cursor = 'grabbing';\n\t\tthis.target.style.userSelect = 'none';\n\n\t\tthis.pos = {\n\t\t\tleft: this.target.scrollLeft,\n\t\t\ttop: this.target.scrollTop,\n\t\t\tx: ev.clientX,\n\t\t\ty: ev.clientY,\n\t\t};\n\t}\n\n\tmouseMoveHandler(ev)\n\t{\n\t\tif (!this.touchInit)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst dx = ev.clientX - this.pos.x;\n\t\tconst dy = ev.clientY - this.pos.y;\n\n\t\tthis.target.scrollTop = this.pos.top - dy;\n\t\tthis.target.scrollLeft = this.pos.left - dx;\n\t}\n\n\tmouseUpHandler()\n\t{\n\t\tthis.touchInit = false;\n\t\tthis.target.style.cursor = 'grab';\n\t\tthis.target.style.removeProperty('user-select');\n\t}\n}","import { Tag, Dom } from 'main.core';\n\nimport { TouchController } from\t'./touch-controller';\n\nimport './style.css';\n\nexport class Zoom\n{\n\tconstructor({ imageWrapper, previewArea })\n\t{\n\t\tthis.imageWrapper = imageWrapper ? imageWrapper : null;\n\t\tthis.previewArea = previewArea ? previewArea : null;\n\t\tthis.layout = {\n\t\t\tplus: null,\n\t\t\tminus: null,\n\t\t\tvalue: null\n\t\t};\n\t\tthis.currentZoom = 100;\n\t\tthis.initTouchScroll();\n\t}\n\n\tlockPlus()\n\t{\n\t\tDom.addClass(this.getNodePlus(), '--lock');\n\t}\n\n\tunLockPlus()\n\t{\n\t\tDom.removeClass(this.getNodePlus(), '--lock');\n\t}\n\n\tlockMinus()\n\t{\n\t\tDom.addClass(this.getNodeMinus(), '--lock');\n\t}\n\n\tunLockMinus()\n\t{\n\t\tDom.removeClass(this.getNodeMinus(), '--lock');\n\t}\n\n\tgetNodePlus()\n\t{\n\t\tif (!this.layout.plus)\n\t\t{\n\t\t\tconst icon = Tag.render`<i></i>`;\n\t\t\tthis.layout.plus = Tag.render`\n\t\t\t\t<div class=\"sign-preview__zoom-control --plus\">\n\t\t\t\t\t${icon}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\ticon.addEventListener('click', () => {\n\t\t\t\tthis.zoomPlus();\n\t\t\t\tthis.unLockMinus();\n\t\t\t\tif (this.currentZoom === 200)\n\t\t\t\t{\n\t\t\t\t\tthis.lockPlus();\n\t\t\t\t}\n\t\t\t\tthis.adjustOverflow();\n\t\t\t});\n\t\t}\n\n\t\treturn this.layout.plus;\n\t}\n\n\tgetNodeMinus()\n\t{\n\t\tif (!this.layout.minus)\n\t\t{\n\t\t\tconst icon = Tag.render`<i></i>`;\n\t\t\tthis.layout.minus = Tag.render`\n\t\t\t\t<div class=\"sign-preview__zoom-control --minus --lock\">\n\t\t\t\t\t${icon}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\ticon.addEventListener('click', () => {\n\t\t\t\tthis.zoomMinus();\n\t\t\t\tthis.unLockPlus();\n\t\t\t\tif (this.currentZoom === 100) \n\t\t\t\t{\n\t\t\t\t\tthis.lockMinus();\n\t\t\t\t}\n\t\t\t\tthis.adjustOverflow();\n\t\t\t});\n\t\t}\n\n\t\treturn this.layout.minus;\n\t}\n\n\tzoomPlus()\n\t{\n\t\tthis.currentZoom += 25;\n\t\tthis.getNodeValue().innerText = this.currentZoom;\n\t\tthis.imageWrapper.style.setProperty('transform', `scale(${this.currentZoom / 100})`);\n\t}\n\n\tzoomMinus()\n\t{\n\t\tthis.currentZoom -= 25;\n\t\tthis.getNodeValue().innerText = this.currentZoom;\n\t\tthis.imageWrapper.style.setProperty('transform', `scale(${this.currentZoom / 100})`);\n\t}\n\n\tadjustOverflow()\n\t{\n\t\tif (this.currentZoom > 100)\n\t\t{\n\t\t\tthis.previewArea.style.setProperty('height', this.previewArea.offsetHight);\n\t\t\tDom.addClass(this.previewArea, '--overflow-auto');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.previewArea, '--overflow-auto');\n\t\t\tthis.previewArea.style.removeProperty('height');\n\t\t}\n\t}\n\n\tgetNodeValue()\n\t{\n\t\tif (!this.layout.value)\n\t\t{\n\t\t\tthis.layout.value = Tag.render`\n\t\t\t\t<div class=\"sign-preview__zoom-value\">100</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.value;\n\t}\n\n\tresetAll()\n\t{\n\t\tthis.currentZoom = 100;\n\t\tthis.lockMinus();\n\t\tthis.unLockPlus();\n\t\tthis.adjustOverflow();\n\t\tthis.imageWrapper.style.removeProperty('transform');\n\t\tthis.getNodeValue().innerText = this.currentZoom;\n\t}\n\n\trender()\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-preview__zoom\">\n\t\t\t\t${this.getNodeMinus()}\n\t\t\t\t${this.getNodeValue()}\n\t\t\t\t${this.getNodePlus()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tinitTouchScroll()\n\t{\n\t\tnew TouchController({\n\t\t\ttarget: this.previewArea\n\t\t});\n\t}\n}","import { Dom, Loc, Tag } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Loader } from 'main.loader';\nimport { BlockArea } from './block-area/index';\n\nimport { Navigation } from './navigation/index';\n\nimport './style.css';\nimport { Zoom } from './zoom/index';\n\nexport class DocumentReady extends EventEmitter\n{\n\t#layout: {};\n\t#pages: Array;\n\t#blocks: Array;\n\t#navigation: Navigation;\n\t#zoom: Zoom;\n\t#loader: Loader;\n\t#currentPage: Number;\n\n\tconstructor({ pages, blocks })\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.Preview.DocumentReady');\n\n\t\tthis.#pages = pages || [];\n\t\tthis.#blocks = blocks || [];\n\t\tthis.#navigation = null;\n\t\tthis.#loader = null;\n\t\tthis.#zoom = null;\n\t\tthis.#currentPage = 1;\n\t\tthis.#layout = {\n\t\t\terror: null,\n\t\t\tcontainer: null,\n\t\t\timageWrapper: null,\n\t\t\tpreviewArea: null,\n\t\t};\n\t}\n\n\t#getAreaSize()\n\t{\n\t\tlet ratio = (this.#pages[0].height / this.#pages[0].width).toString();\n\t\tratio = ratio.split('.').join('');\n\t\tlet result = `${[...ratio].splice(0, 3).join('')}%`;\n\t\tif (ratio === '1')\n\t\t{\n\t\t\tresult = '100%';\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#getNodeImageWrapper()\n\t{\n\t\tif (!this.#layout.imageWrapper)\n\t\t{\n\t\t\tthis.#layout.imageWrapper = Tag.render`\n\t\t\t\t<div class=\"sign-preview__image-container\">\n\t\t\t\t\t<img src=\"${this.#pages[0].path}\" alt=\"${this.#pages[0].name}\" id=\"sign-preview_page-image\" class=\"sign-preview__image-container_img\">\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tthis.#drawBlocks(this.#currentPage);\n\t\t}\n\n\t\treturn this.#layout.imageWrapper;\n\t}\n\n\t#getNavigation()\n\t{\n\t\tif (!this.#navigation)\n\t\t{\n\t\t\tthis.#navigation = new Navigation({\n\t\t\t\ttotalPages: this.#pages.length,\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(this.#navigation, 'showNextPage', (param) => {\n\t\t\t\tthis.#loadPage(param.data - 1, '--show-next-page');\n\t\t\t\tthis.#getZoom().resetAll();\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(this.#navigation, 'showPrevPage', (param) => {\n\t\t\t\tthis.#loadPage(param.data - 1, '--show-prev-page');\n\t\t\t\tthis.#getZoom().resetAll();\n\t\t\t});\n\t\t}\n\n\t\treturn this.#navigation;\n\t}\n\n\t#loadPage(index: Number, direction: String)\n\t{\n\t\tDom.clean(this.#getNodeImageWrapper());\n\t\tif (!this.#pages[index].isLoaded)\n\t\t{\n\t\t\tthis.#getNavigation().lock();\n\t\t\tthis.lock();\n\t\t}\n\n\t\tconst imageNode = Tag.render`\n\t\t\t\t<img alt=\"${this.#pages[index].name}\" \n\t\t\t\tclass=\"sign-preview__image-container_img ${direction}\"\n\t\t\t \tstyle=\"display: none;\">\n\t\t\t`;\n\n\t\tDom.append(imageNode, this.#getNodeImageWrapper());\n\t\timageNode.addEventListener('animationend', () => {\n\t\t\tDom.removeClass(imageNode, direction);\n\t\t\tthis.emit('onImageShow');\n\t\t}, {\n\t\t\tonce: true,\n\t\t});\n\n\t\tif (this.#pages[index].prepared)\n\t\t{\n\t\t\timageNode.src = this.#pages[index].path;\n\t\t\tthis.#updatePage(index, imageNode);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst imgUrl = this.#pages[index].path;\n\t\tconst preparedImage = new Image();\n\t\tpreparedImage.crossOrigin = 'Anonymous';\n\t\tpreparedImage.src = imgUrl;\n\t\tpreparedImage.onload = () => {\n\t\t\tthis.#receiveImg(preparedImage, index, direction, imageNode);\n\t\t};\n\n\t\timageNode.onerror = () => {\n\t\t\tthis.#getNavigation().unLock();\n\t\t\tthis.unLock();\n\t\t\tthis.showError();\n\t\t};\n\t}\n\n\t#receiveImg(preparedImage, index, direction, imageNode: Element)\n\t{\n\t\tconst canvas = document.createElement('canvas');\n\t\tconst context = canvas.getContext('2d');\n\n\t\tcanvas.width = preparedImage.width;\n\t\tcanvas.height = preparedImage.height;\n\n\t\tcontext.drawImage(preparedImage, 0, 0);\n\n\t\ttry\n\t\t{\n\t\t\tthis.#pages[index].path = canvas.toDataURL('image/png');\n\t\t\tthis.#pages[index].prepared = true;\n\t\t\timageNode.src = this.#pages[index].path;\n\n\t\t\tthis.#updatePage(index, imageNode);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tconsole.error(`Error: ${err}`);\n\t\t}\n\t}\n\n\t#updatePage(param: Number, imageNode: Element)\n\t{\n\t\tDom.append(imageNode, this.#getNodeImageWrapper());\n\t\timageNode.style.removeProperty('display');\n\t\tthis.#pages[param].isLoaded = true;\n\t\tthis.#getNavigation().unLock();\n\t\tthis.unLock();\n\t\tthis.#drawBlocks(param + 1);\n\t\tthis.#currentPage = param + 1;\n\t}\n\n\t#drawBlocks(pageNumber: Number)\n\t{\n\t\tif (!pageNumber)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentBlocks = [];\n\n\t\tthis.#blocks.forEach((block) => {\n\t\t\tif (pageNumber === parseInt(block.position.page))\n\t\t\t{\n\t\t\t\t// copy object to correct change of styles when flipping previews\n\t\t\t\tlet style = block.style || {};\n\t\t\t\tstyle = { ...style };\n\n\t\t\t\tstyle.top = block.position.top + '%';\n\n\t\t\t\tstyle.left = block.position.left + '%';\n\t\t\t\tstyle.width = block.position.width + '%';\n\t\t\t\tstyle.height = block.position.height + '%';\n\n\t\t\t\tlet realDocWidth = parseFloat(block.position.realDocumentWidthPx);\n\t\t\t\tlet currentDocWidth = parseFloat(block.position.currentDocumentWithPx);\n\t\t\t\tlet fontSize = parseFloat(block.style['font-size']) || 14;\n\t\t\t\tif (realDocWidth && currentDocWidth && fontSize)\n\t\t\t\t{\n\t\t\t\t\tstyle['font-size'] = (fontSize * (currentDocWidth / realDocWidth)) + 'px';\n\t\t\t\t\t// hack from css styles (need refactoring)\n\t\t\t\t\tlet verticalPadding = (5 * (currentDocWidth / realDocWidth)) + 'px';\n\t\t\t\t\tlet horizontalPadding = (8 * (currentDocWidth / realDocWidth)) + 'px';\n\t\t\t\t\tstyle['padding'] = verticalPadding + ' ' + horizontalPadding;\n\t\t\t\t}\n\t\t\t\tconst newBlock = new BlockArea({\n\t\t\t\t\tid: block.id,\n\t\t\t\t\tstyle: style,\n\t\t\t\t\tdata: block.data,\n\t\t\t\t});\n\n\t\t\t\tcurrentBlocks.push(newBlock);\n\n\t\t\t}\n\t\t});\n\n\t\tcurrentBlocks.forEach((block) => {\n\t\t\tDom.append(block.render(), this.#getNodeImageWrapper());\n\t\t});\n\t}\n\n\t#getNodeImagePreviewAreq()\n\t{\n\t\tif (!this.#layout.previewArea)\n\t\t{\n\t\t\tthis.#layout.previewArea = Tag.render`\n\t\t\t\t<div class=\"sign-preview__image\" style=\"padding-top: ${this.#getAreaSize()}\">\n\t\t\t\t\t${this.#getNodeImageWrapper()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.previewArea;\n\t}\n\n\t#getNodeDocument()\n\t{\n\t\tif (!this.#layout.container)\n\t\t{\n\t\t\tthis.#layout.container = Tag.render`\n\t\t\t\t<div class=\"sign-preview__document-ready\">\n\t\t\t\t\t<div class=\"sign-preview__document-background\">\n\t\t\t\t\t\t${this.#getNodeImagePreviewAreq()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"sign-preview__document-controls\">\n\t\t\t\t\t\t${this.#getNavigation().render()}\n\t\t\t\t\t\t${this.#getZoom().render()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.container;\n\t}\n\n\t#getZoom()\n\t{\n\t\tif (!this.#zoom)\n\t\t{\n\t\t\tthis.#zoom = new Zoom({\n\t\t\t\timageWrapper: this.#getNodeImageWrapper(),\n\t\t\t\tpreviewArea: this.#getNodeImagePreviewAreq(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.#zoom;\n\t}\n\n\t#getNodeError()\n\t{\n\t\tif (!this.#layout.error)\n\t\t{\n\t\t\tthis.#layout.error = Tag.render`\n\t\t\t\t<div class=\"sign-preview__image-error\">\n\t\t\t\t\t${Loc.getMessage('SIGN_CMP_MASTER_TPL_PREVIEW_LOADIN_ERROR')}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tconst linkNode = this.#layout.error.getElementsByTagName('span')[0];\n\n\t\t\tlinkNode.addEventListener('click', () => {\n\t\t\t\tthis.#loadPage(this.#currentPage - 1);\n\t\t\t});\n\t\t}\n\n\t\treturn this.#layout.error;\n\t}\n\n\tshowError()\n\t{\n\t\tDom.clean(this.#getNodeImageWrapper());\n\t\tDom.append(this.#getNodeError(), this.#getNodeImageWrapper());\n\t}\n\n\tlock()\n\t{\n\t\tif (!this.#loader)\n\t\t{\n\t\t\tthis.#loader = new Loader({\n\t\t\t\tsize: 80,\n\t\t\t});\n\t\t}\n\n\t\tthis.#loader.show(this.#getNodeImageWrapper());\n\t\tDom.addClass(this.#getNodeImageWrapper(), '--lock');\n\t}\n\n\tunLock()\n\t{\n\t\tif (this.#loader)\n\t\t{\n\t\t\tthis.#loader.hide(this.#getNodeImageWrapper());\n\t\t}\n\n\t\tDom.removeClass(this.#getNodeImageWrapper(), '--lock');\n\t}\n\n\trender()\n\t{\n\t\treturn this.#getNodeDocument();\n\t}\n\n\t#getCurrentShownImageElement(): ?HTMLElement\n\t{\n\t\treturn this.#getNodeImageWrapper().querySelector('img.sign-preview__image-container_img');\n\t}\n\n\tupdateImageContainerSize()\n\t{\n\t\tconst currentPageImageHeight = this.#getCurrentShownImageElement()?.offsetHeight;\n\t\tif (currentPageImageHeight)\n\t\t{\n\t\t\tDom.style(\n\t\t\t\tthis.#getNodeImageWrapper(),\n\t\t\t\t'height',\n\t\t\t\t`${currentPageImageHeight}px`,\n\t\t\t);\n\t\t}\n\t}\n\n\tsetPages(pages: Array)\n\t{\n\t\tthis.#pages = pages;\n\t}\n}\n","import { Dom, Tag, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { DocumentEmpty } from './document-empty/index';\nimport { DocumentLoading } from './document-loading/index';\nimport { DocumentReady } from './document-ready/index';\n\nimport 'ui.design-tokens';\nimport 'ui.font.opensans';\nimport './style.css';\n\nexport class Preview extends EventEmitter\n{\n\t#renderTo: HTMLElement;\n\t#layout: Array;\n\t#pages: Array;\n\t#blocks: Array;\n\t#documentHash: String;\n\t#secCode: String;\n\t#documentReady: DocumentReady;\n\n\tconstructor({ renderTo, pages, blocks, documentHash, secCode }): void\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.Preview');\n\t\tthis.#renderTo = renderTo || null;\n\t\tthis.#pages = pages || [];\n\t\tthis.#blocks = blocks || [];\n\t\tthis.#documentHash = documentHash || null;\n\t\tthis.#secCode = secCode || null;\n\t\tthis.#documentReady = null;\n\t\tthis.#layout = {\n\t\t\tdocument: null,\n\t\t\tfooter: null,\n\t\t};\n\t\tthis.currentWidth = null;\n\t\tthis.init();\n\t}\n\n\tshowDocumentLoading()\n\t{\n\t\tDom.clean(this.#getNodeDocument());\n\t\tDom.append(DocumentLoading.render(), this.#getNodeDocument());\n\t}\n\n\tshowDocumentEmpty()\n\t{\n\t\tDom.clean(this.#getNodeDocument());\n\t\tDom.append(DocumentEmpty.render(), this.#getNodeDocument());\n\t}\n\n\tshowDocumentReady()\n\t{\n\t\tDom.clean(this.#getNodeDocument());\n\n\t\tthis.#getDocumentReady().setPages(this.#pages);\n\t\tDom.append(this.#getDocumentReady().render(), this.#getNodeDocument());\n\n\t\tthis.#getDocumentReady().updateImageContainerSize();\n\t}\n\n\t#getDocumentReady()\n\t{\n\t\tif (!this.#documentReady)\n\t\t{\n\t\t\tthis.#blocks.forEach((item) => {\n\t\t\t\titem.position.currentDocumentWithPx = this.currentWidth;\n\t\t\t});\n\n\t\t\tthis.#documentReady = new DocumentReady({\n\t\t\t\tpages: this.#pages,\n\t\t\t\tblocks: this.#blocks,\n\t\t\t});\n\t\t}\n\n\t\treturn this.#documentReady;\n\t}\n\n\t#getNodeDocument()\n\t{\n\t\tif (!this.#layout.document)\n\t\t{\n\t\t\tthis.#layout.document = Tag.render`\n\t\t\t\t<div class=\"sign-preview__document\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.document;\n\t}\n\n\t#getNodeFooter()\n\t{\n\t\tif (!this.#layout.footer)\n\t\t{\n\t\t\tthis.#layout.footer = Tag.render`\n\t\t\t\t<div class=\"sign-preview__footer\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.footer;\n\t}\n\n\t#loadFirstImage()\n\t{\n\t\tconst imgUrl = this.#pages[0].path;\n\t\tconst preparedImage = new Image();\n\t\tpreparedImage.crossOrigin = 'Anonymous';\n\t\tpreparedImage.src = imgUrl;\n\t\tpreparedImage.addEventListener('load', this.#receiveImg.bind(this, preparedImage), false);\n\n\t\tpreparedImage.onerror = () => {\n\t\t\tthis.emit('firstImageIsLoadedFail');\n\t\t};\n\t}\n\n\t#receiveImg(preparedImage)\n\t{\n\t\tconst canvas = document.createElement('canvas');\n\t\tconst context = canvas.getContext('2d');\n\n\t\tcanvas.width = preparedImage.width;\n\t\tcanvas.height = preparedImage.height;\n\n\t\tcontext.drawImage(preparedImage, 0, 0);\n\n\t\ttry\n\t\t{\n\t\t\tthis.#pages[0].path = canvas.toDataURL('image/png');\n\t\t\tthis.#pages[0].prepared = true;\n\t\t\tthis.emit('firstImageIsLoaded');\n\t\t\t// fix block positioning\n\t\t\tsetTimeout(() => this.#getDocumentReady().updateImageContainerSize(), 0);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tconsole.error(`Error: ${err}`);\n\t\t}\n\t}\n\n\tafterRender()\n\t{\n\t\tthis.#getDocumentReady().subscribe('onImageShow', () => {\n\t\t\tconst documentReady = this.#getDocumentReady();\n\t\t\tdocumentReady.updateImageContainerSize();\n\t\t});\n\t\tif (this.#documentHash && this.#pages.length === 0 && BX.Sign.Backend)\n\t\t{\n\t\t\tthis.showDocumentLoading();\n\t\t\tconst checkReady = setInterval(() => {\n\t\t\t\tBX.ajax.runAction('sign.api.document.layoutIsReady', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tdocumentHash: this.#documentHash,\n\t\t\t\t\t\tsecCode: this.#secCode,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}, 1000 * 30);\n\n\t\t\tif (BX.PULL)\n\t\t\t{\n\t\t\t\tBX.PULL.subscribe({\n\t\t\t\t\tmoduleId: 'sign',\n\t\t\t\t\tcommand: 'layoutIsReady',\n\t\t\t\t\tcallback: (result) => {\n\t\t\t\t\t\tif (result?.layout)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst layout = result?.layout;\n\t\t\t\t\t\t\tconst blocks = result?.blocks;\n\n\t\t\t\t\t\t\tif (Type.isArray(layout) && layout.length > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#pages = layout;\n\t\t\t\t\t\t\t\tthis.#blocks = blocks;\n\n\t\t\t\t\t\t\t\tthis.subscribe('firstImageIsLoaded', () => {\n\t\t\t\t\t\t\t\t\tthis.showDocumentReady();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.subscribe('firstImageIsLoadedFail', () => {\n\t\t\t\t\t\t\t\t\tthis.showDocumentReady();\n\t\t\t\t\t\t\t\t\tthis.#getDocumentReady().showError();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.#loadFirstImage();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tclearInterval(checkReady);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tif (!this.#renderTo)\n\t\t{\n\t\t\tconsole.warn('BX.Sign.Preview: \\'renderTo\\' is not defined');\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.currentWidth)\n\t\t{\n\t\t\tthis.currentWidth = this.#renderTo.offsetWidth - 20;\n\t\t}\n\n\t\tconst target = this.#renderTo.parentNode;\n\t\tconst nodeWrapper = Tag.render`\n\t\t\t<div class=\"sign-preview sign-preview__scope\">\n\t\t\t\t<div class=\"sign-preview__body\">\n\t\t\t\t\t${this.#getNodeDocument()}\n\t\t\t\t</div>\n\t\t\t\t${this.#getNodeFooter()}\n\t\t\t</div>\n\t\t`;\n\n\t\tif (this.#pages.length > 0)\n\t\t{\n\t\t\tthis.showDocumentLoading();\n\t\t\tthis.#loadFirstImage();\n\t\t\tthis.subscribe('firstImageIsLoaded', () => {\n\t\t\t\tthis.showDocumentReady();\n\t\t\t});\n\t\t\tthis.subscribe('firstImageIsLoadedFail', () => {\n\t\t\t\tthis.showDocumentReady();\n\t\t\t\tthis.#getDocumentReady().showError();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showDocumentEmpty();\n\t\t}\n\n\t\tDom.clean(target);\n\t\tDom.append(nodeWrapper, target);\n\t\tthis.afterRender();\n\t}\n}\n"],"names":["DocumentEmpty","render","Tag","DocumentLoading","nodeLoader","Loader","size","show","BX","message","BlockArea","id","style","data","container","Type","isString","text","preContent","Text","encode","content","replaceAll","base64","src","key","setProperty","Navigation","totalPages","_classPrivateMethodInitSpec","currentPage","layout","next","prev","Dom","addClass","removeClass","icon","addEventListener","_classPrivateMethodGet","classList","remove","add","EventEmitter","emit","Loc","getMessage","lock","param","isNumber","innerText","TouchController","target","pos","top","left","x","y","touchInit","init","console","warn","mouseDownHandler","bind","mouseMoveHandler","mouseUpHandler","ev","cursor","userSelect","scrollLeft","scrollTop","clientX","clientY","dx","dy","removeProperty","Zoom","imageWrapper","previewArea","plus","minus","value","currentZoom","initTouchScroll","getNodePlus","getNodeMinus","zoomPlus","unLockMinus","lockPlus","adjustOverflow","zoomMinus","unLockPlus","lockMinus","getNodeValue","offsetHight","DocumentReady","pages","blocks","_classPrivateFieldInitSpec","setEventNamespace","error","clean","append","hide","currentPageImageHeight","offsetHeight","ratio","height","width","toString","split","join","result","splice","path","name","length","subscribe","resetAll","index","direction","isLoaded","imageNode","once","prepared","imgUrl","preparedImage","Image","crossOrigin","onload","onerror","unLock","showError","canvas","document","createElement","context","getContext","drawImage","toDataURL","err","pageNumber","currentBlocks","forEach","block","parseInt","position","page","realDocWidth","parseFloat","realDocumentWidthPx","currentDocWidth","currentDocumentWithPx","fontSize","verticalPadding","horizontalPadding","newBlock","push","linkNode","getElementsByTagName","querySelector","Preview","renderTo","documentHash","secCode","footer","currentWidth","setPages","updateImageContainerSize","documentReady","Sign","Backend","showDocumentLoading","checkReady","setInterval","ajax","runAction","PULL","moduleId","command","callback","isArray","showDocumentReady","clearInterval","offsetWidth","parentNode","nodeWrapper","showDocumentEmpty","afterRender","item","setTimeout"],"mappings":"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"}