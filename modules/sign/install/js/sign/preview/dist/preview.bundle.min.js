this.BX=this.BX||{};(function(e,t,i,a,s){"use strict";var l;var r={render:function e(){return s.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="sign-preview__document-background">\n\t\t\t\t<div class="sign-preview__document-empty">\n\t\t\t\t\t<video poster="/bitrix/js/sign/preview/images/sign-preview-document-demo.jpg" autoplay="true" loop="true" muted="true" playsinline="true">\n\t\t\t\t\t\t<source type="video/mp4" src="/bitrix/js/sign/preview/images/sign-preview-document-demo.mp4">\n\t\t\t\t\t\t<source type="video/webm" src="/bitrix/js/sign/preview/images/sign-preview-document-demo.webm">\n\t\t\t\t\t</video>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])))}};var n,o;var c={render:function e(){var i=s.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="sign-preview__loader"></div>\n\t\t'])));new t.Loader({size:80}).show(i);return s.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="sign-preview__document-background">\n\t\t\t\t<div class="sign-preview__document-loading">\n\t\t\t\t\t<div class="sign-preview__document-loading_container">\n\t\t\t\t\t\t<div class="sign-preview__document-loading_logo ','"></div>\n\t\t\t\t\t\t','\t\t\n\t\t\t\t\t\t<div class="sign-preview__document-loading_message"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),BX.message("LANGUAGE_ID")==="ru"?"--ru":"",i)}};var d,h,u;function v(e,t){b(e,t);t.add(e)}function p(e,t,i){b(e,t);t.set(e,i)}function b(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function g(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var m=new WeakMap;var f=new WeakMap;var H=new WeakMap;var w=new WeakSet;var P=function(){function e(t){var i=t.id,a=t.style,s=t.data;babelHelpers.classCallCheck(this,e);v(this,w);p(this,m,{writable:true,value:void 0});p(this,f,{writable:true,value:void 0});p(this,H,{writable:true,value:void 0});this.id=i?i:null;babelHelpers.classPrivateFieldSet(this,m,a?a:{});babelHelpers.classPrivateFieldSet(this,f,s?s:null);babelHelpers.classPrivateFieldSet(this,H,{container:null})}babelHelpers.createClass(e,[{key:"render",value:function e(){return g(this,w,y).call(this)}}]);return e}();function y(){if(!babelHelpers.classPrivateFieldGet(this,H).container){babelHelpers.classPrivateFieldGet(this,H).container=s.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sign-preview__block-area --empty"></div>\n\t\t\t'])));if(s.Type.isString(babelHelpers.classPrivateFieldGet(this,f).text)){var e=s.Text.encode(babelHelpers.classPrivateFieldGet(this,f).text);var t=e.replaceAll("[br]","<br>");babelHelpers.classPrivateFieldGet(this,H).container=s.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="sign-preview__block-area','">',"</div>\n\t\t\t\t"])),babelHelpers.classPrivateFieldGet(this,f).text===""?" --empty":"",t)}if(babelHelpers.classPrivateFieldGet(this,f).base64){var i="data:image;base64,"+babelHelpers.classPrivateFieldGet(this,f).base64;babelHelpers.classPrivateFieldGet(this,H).container=s.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="sign-preview__block-area --image">\n\t\t\t\t\t\t<img src="','" alt="">\n\t\t\t\t\t</div>\n\t\t\t\t'])),i)}for(var a in babelHelpers.classPrivateFieldGet(this,m)){babelHelpers.classPrivateFieldGet(this,H).container.style.setProperty(a,babelHelpers.classPrivateFieldGet(this,m)[a])}}return babelHelpers.classPrivateFieldGet(this,H).container}var k,T,F,I,_,G,L;function S(e,t){z(e,t);t.add(e)}function z(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function W(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var E=new WeakSet;var D=new WeakSet;var C=new WeakSet;var M=new WeakSet;var x=new WeakSet;var A=new WeakSet;var O=function(){function e(t){var i=t.totalPages;babelHelpers.classCallCheck(this,e);S(this,A);S(this,x);S(this,M);S(this,C);S(this,D);S(this,E);this.totalPages=i?i:null;this.currentPage=1;this.layout={container:null,next:null,prev:null,currentPage:null,totalPages:null}}babelHelpers.createClass(e,[{key:"lock",value:function e(){s.Dom.addClass(W(this,x,X).call(this),"--lock")}},{key:"unLock",value:function e(){s.Dom.removeClass(W(this,x,X).call(this),"--lock")}},{key:"render",value:function e(){return W(this,x,X).call(this)}}]);return e}();function j(){var e=this;if(!this.layout.next){var t=s.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(["<i></i>"])));this.layout.next=s.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sign-preview__navigation-control --next">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),t);t.addEventListener("click",(function(){if(e.currentPage<e.totalPages){e.currentPage++;W(e,D,N).call(e).classList.remove("--lock")}if(e.currentPage===e.totalPages){W(e,E,j).call(e).classList.add("--lock")}W(e,A,Z).call(e,e.currentPage);a.EventEmitter.emit(e,"showNextPage",e.currentPage)}))}return this.layout.next}function N(){var e=this;if(!this.layout.prev){var t=s.Tag.render(F||(F=babelHelpers.taggedTemplateLiteral(["<i></i>"])));this.layout.prev=s.Tag.render(I||(I=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sign-preview__navigation-control --prev --lock">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),t);t.addEventListener("click",(function(){if(e.currentPage>1){e.currentPage--;W(e,E,j).call(e).classList.remove("--lock")}if(e.currentPage===1){W(e,D,N).call(e).classList.add("--lock")}W(e,A,Z).call(e,e.currentPage);a.EventEmitter.emit(e,"showPrevPage",e.currentPage)}))}return this.layout.prev}function R(){if(!this.layout.totalPages){this.layout.totalPages=s.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t<span>/","</span>\n\t\t\t"])),this.totalPages)}return this.layout.totalPages}function B(){if(!this.layout.currentPage){this.layout.currentPage=s.Tag.render(G||(G=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t<span>","</span>\n\t\t\t"])),this.currentPage)}return this.layout.currentPage}function X(){if(!this.layout.container){this.layout.container=s.Tag.render(L||(L=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sign-preview__navigation">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="sign-preview__navigation-info">\n\t\t\t\t\t\t'," ","","\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"])),W(this,D,N).call(this),s.Loc.getMessage("SIGN_CMP_MASTER_TPL_PREVIEW_PAGE"),W(this,M,B).call(this),W(this,C,R).call(this),W(this,E,j).call(this));if(this.totalPages===1||!this.totalPages){this.lock()}}return this.layout.container}function Z(e){if(s.Type.isNumber(e)){W(this,M,B).call(this).innerText=e}}var U=function(){function e(t){var i=t.target;babelHelpers.classCallCheck(this,e);this.target=i?i:null;this.pos={top:0,left:0,x:0,y:0};this.touchInit=false;this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){if(!this.target){console.warn("BX.Sign.Preview: TouchController not initialized");return}this.target.addEventListener("mousedown",this.mouseDownHandler.bind(this));this.target.addEventListener("mousemove",this.mouseMoveHandler.bind(this));this.target.addEventListener("mouseup",this.mouseUpHandler.bind(this));this.target.addEventListener("mouseleave",this.mouseUpHandler.bind(this))}},{key:"mouseDownHandler",value:function e(t){this.touchInit=true;this.target.style.cursor="grabbing";this.target.style.userSelect="none";this.pos={left:this.target.scrollLeft,top:this.target.scrollTop,x:t.clientX,y:t.clientY}}},{key:"mouseMoveHandler",value:function e(t){if(!this.touchInit){return}var i=t.clientX-this.pos.x;var a=t.clientY-this.pos.y;this.target.scrollTop=this.pos.top-a;this.target.scrollLeft=this.pos.left-i}},{key:"mouseUpHandler",value:function e(){this.touchInit=false;this.target.style.cursor="grab";this.target.style.removeProperty("user-select")}}]);return e}();var V,Y,q,J,K,Q;var $=function(){function e(t){var i=t.imageWrapper,a=t.previewArea;babelHelpers.classCallCheck(this,e);this.imageWrapper=i?i:null;this.previewArea=a?a:null;this.layout={plus:null,minus:null,value:null};this.currentZoom=100;this.initTouchScroll()}babelHelpers.createClass(e,[{key:"lockPlus",value:function e(){s.Dom.addClass(this.getNodePlus(),"--lock")}},{key:"unLockPlus",value:function e(){s.Dom.removeClass(this.getNodePlus(),"--lock")}},{key:"lockMinus",value:function e(){s.Dom.addClass(this.getNodeMinus(),"--lock")}},{key:"unLockMinus",value:function e(){s.Dom.removeClass(this.getNodeMinus(),"--lock")}},{key:"getNodePlus",value:function e(){var t=this;if(!this.layout.plus){var i=s.Tag.render(V||(V=babelHelpers.taggedTemplateLiteral(["<i></i>"])));this.layout.plus=s.Tag.render(Y||(Y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sign-preview__zoom-control --plus">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),i);i.addEventListener("click",(function(){t.zoomPlus();t.unLockMinus();if(t.currentZoom===200){t.lockPlus()}t.adjustOverflow()}))}return this.layout.plus}},{key:"getNodeMinus",value:function e(){var t=this;if(!this.layout.minus){var i=s.Tag.render(q||(q=babelHelpers.taggedTemplateLiteral(["<i></i>"])));this.layout.minus=s.Tag.render(J||(J=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sign-preview__zoom-control --minus --lock">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),i);i.addEventListener("click",(function(){t.zoomMinus();t.unLockPlus();if(t.currentZoom===100){t.lockMinus()}t.adjustOverflow()}))}return this.layout.minus}},{key:"zoomPlus",value:function e(){this.currentZoom+=25;this.getNodeValue().innerText=this.currentZoom;this.imageWrapper.style.setProperty("transform","scale(".concat(this.currentZoom/100,")"))}},{key:"zoomMinus",value:function e(){this.currentZoom-=25;this.getNodeValue().innerText=this.currentZoom;this.imageWrapper.style.setProperty("transform","scale(".concat(this.currentZoom/100,")"))}},{key:"adjustOverflow",value:function e(){if(this.currentZoom>100){this.previewArea.style.setProperty("height",this.previewArea.offsetHight);s.Dom.addClass(this.previewArea,"--overflow-auto")}else{s.Dom.removeClass(this.previewArea,"--overflow-auto");this.previewArea.style.removeProperty("height")}}},{key:"getNodeValue",value:function e(){if(!this.layout.value){this.layout.value=s.Tag.render(K||(K=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sign-preview__zoom-value">100</div>\n\t\t\t'])))}return this.layout.value}},{key:"resetAll",value:function e(){this.currentZoom=100;this.lockMinus();this.unLockPlus();this.adjustOverflow();this.imageWrapper.style.removeProperty("transform");this.getNodeValue().innerText=this.currentZoom}},{key:"render",value:function e(){return s.Tag.render(Q||(Q=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="sign-preview__zoom">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this.getNodeMinus(),this.getNodeValue(),this.getNodePlus())}},{key:"initTouchScroll",value:function e(){new U({target:this.previewArea})}}]);return e}();var ee,te,ie,ae,se;function le(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function re(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?le(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):le(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function ne(e,t){ce(e,t);t.add(e)}function oe(e,t,i){ce(e,t);t.set(e,i)}function ce(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function de(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var he=new WeakMap;var ue=new WeakMap;var ve=new WeakMap;var pe=new WeakMap;var be=new WeakMap;var ge=new WeakMap;var me=new WeakMap;var fe=new WeakSet;var He=new WeakSet;var we=new WeakSet;var Pe=new WeakSet;var ye=new WeakSet;var ke=new WeakSet;var Te=new WeakSet;var Fe=new WeakSet;var Ie=new WeakSet;var _e=new WeakSet;var Ge=new WeakSet;var Le=new WeakSet;var Se=function(e){babelHelpers.inherits(t,e);function t(e){var i;var a=e.pages,s=e.blocks;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));ne(babelHelpers.assertThisInitialized(i),Le);ne(babelHelpers.assertThisInitialized(i),Ge);ne(babelHelpers.assertThisInitialized(i),_e);ne(babelHelpers.assertThisInitialized(i),Ie);ne(babelHelpers.assertThisInitialized(i),Fe);ne(babelHelpers.assertThisInitialized(i),Te);ne(babelHelpers.assertThisInitialized(i),ke);ne(babelHelpers.assertThisInitialized(i),ye);ne(babelHelpers.assertThisInitialized(i),Pe);ne(babelHelpers.assertThisInitialized(i),we);ne(babelHelpers.assertThisInitialized(i),He);ne(babelHelpers.assertThisInitialized(i),fe);oe(babelHelpers.assertThisInitialized(i),he,{writable:true,value:void 0});oe(babelHelpers.assertThisInitialized(i),ue,{writable:true,value:void 0});oe(babelHelpers.assertThisInitialized(i),ve,{writable:true,value:void 0});oe(babelHelpers.assertThisInitialized(i),pe,{writable:true,value:void 0});oe(babelHelpers.assertThisInitialized(i),be,{writable:true,value:void 0});oe(babelHelpers.assertThisInitialized(i),ge,{writable:true,value:void 0});oe(babelHelpers.assertThisInitialized(i),me,{writable:true,value:void 0});i.setEventNamespace("BX.Sign.Preview.DocumentReady");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),ue,a||[]);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),ve,s||[]);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),pe,null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),ge,null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),be,null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),me,1);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),he,{error:null,container:null,imageWrapper:null,previewArea:null});return i}babelHelpers.createClass(t,[{key:"showError",value:function e(){s.Dom.clean(de(this,He,We).call(this));s.Dom.append(de(this,Ge,Ne).call(this),de(this,He,We).call(this))}},{key:"lock",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,ge)){babelHelpers.classPrivateFieldSet(this,ge,new i.Loader({size:80}))}babelHelpers.classPrivateFieldGet(this,ge).show(de(this,He,We).call(this));s.Dom.addClass(de(this,He,We).call(this),"--lock")}},{key:"unLock",value:function e(){if(babelHelpers.classPrivateFieldGet(this,ge)){babelHelpers.classPrivateFieldGet(this,ge).hide(de(this,He,We).call(this))}s.Dom.removeClass(de(this,He,We).call(this),"--lock")}},{key:"render",value:function e(){return de(this,Ie,Oe).call(this)}},{key:"updateImageContainerSize",value:function e(){var t;var i=(t=de(this,Le,Re).call(this))===null||t===void 0?void 0:t.offsetHeight;if(i){s.Dom.style(de(this,He,We).call(this),"height","".concat(i,"px"))}}},{key:"setPages",value:function e(t){babelHelpers.classPrivateFieldSet(this,ue,t)}}]);return t}(a.EventEmitter);function ze(){var e=(babelHelpers.classPrivateFieldGet(this,ue)[0].height/babelHelpers.classPrivateFieldGet(this,ue)[0].width).toString();e=e.split(".").join("");var t="".concat(babelHelpers.toConsumableArray(e).splice(0,3).join(""),"%");if(e==="1"){t="100%"}return t}function We(){if(!babelHelpers.classPrivateFieldGet(this,he).imageWrapper){babelHelpers.classPrivateFieldGet(this,he).imageWrapper=s.Tag.render(ee||(ee=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sign-preview__image-container">\n\t\t\t\t\t<img src="','" alt="','" id="sign-preview_page-image" class="sign-preview__image-container_img">\n\t\t\t\t</div>\n\t\t\t'])),babelHelpers.classPrivateFieldGet(this,ue)[0].path,babelHelpers.classPrivateFieldGet(this,ue)[0].name);de(this,Te,xe).call(this,babelHelpers.classPrivateFieldGet(this,me))}return babelHelpers.classPrivateFieldGet(this,he).imageWrapper}function Ee(){var e=this;if(!babelHelpers.classPrivateFieldGet(this,pe)){babelHelpers.classPrivateFieldSet(this,pe,new O({totalPages:babelHelpers.classPrivateFieldGet(this,ue).length}));a.EventEmitter.subscribe(babelHelpers.classPrivateFieldGet(this,pe),"showNextPage",(function(t){de(e,Pe,De).call(e,t.data-1,"--show-next-page");de(e,_e,je).call(e).resetAll()}));a.EventEmitter.subscribe(babelHelpers.classPrivateFieldGet(this,pe),"showPrevPage",(function(t){de(e,Pe,De).call(e,t.data-1,"--show-prev-page");de(e,_e,je).call(e).resetAll()}))}return babelHelpers.classPrivateFieldGet(this,pe)}function De(e,t){var i=this;s.Dom.clean(de(this,He,We).call(this));if(!babelHelpers.classPrivateFieldGet(this,ue)[e].isLoaded){de(this,we,Ee).call(this).lock();this.lock()}var a=s.Tag.render(te||(te=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<img alt="','" \n\t\t\t\tclass="sign-preview__image-container_img ','"\n\t\t\t \tstyle="display: none;">\n\t\t\t'])),babelHelpers.classPrivateFieldGet(this,ue)[e].name,t);s.Dom.append(a,de(this,He,We).call(this));a.addEventListener("animationend",(function(){s.Dom.removeClass(a,t);i.emit("onImageShow")}),{once:true});if(babelHelpers.classPrivateFieldGet(this,ue)[e].prepared){a.src=babelHelpers.classPrivateFieldGet(this,ue)[e].path;de(this,ke,Me).call(this,e,a);return}var l=babelHelpers.classPrivateFieldGet(this,ue)[e].path;var r=new Image;r.crossOrigin="Anonymous";r.src=l;r.onload=function(){de(i,ye,Ce).call(i,r,e,t,a)};a.onerror=function(){de(i,we,Ee).call(i).unLock();i.unLock();i.showError()}}function Ce(e,t,i,a){var s=document.createElement("canvas");var l=s.getContext("2d");s.width=e.width;s.height=e.height;l.drawImage(e,0,0);try{babelHelpers.classPrivateFieldGet(this,ue)[t].path=s.toDataURL("image/png");babelHelpers.classPrivateFieldGet(this,ue)[t].prepared=true;a.src=babelHelpers.classPrivateFieldGet(this,ue)[t].path;de(this,ke,Me).call(this,t,a)}catch(e){console.error("Error: ".concat(e))}}function Me(e,t){s.Dom.append(t,de(this,He,We).call(this));t.style.removeProperty("display");babelHelpers.classPrivateFieldGet(this,ue)[e].isLoaded=true;de(this,we,Ee).call(this).unLock();this.unLock();de(this,Te,xe).call(this,e+1);babelHelpers.classPrivateFieldSet(this,me,e+1)}function xe(e){var t=this;if(!e){return}var i=[];babelHelpers.classPrivateFieldGet(this,ve).forEach((function(t){if(e===parseInt(t.position.page)){var a=t.style||{};a=re({},a);a.top=t.position.top+"%";a.left=t.position.left+"%";a.width=t.position.width+"%";a.height=t.position.height+"%";var s=parseFloat(t.position.realDocumentWidthPx);var l=parseFloat(t.position.currentDocumentWithPx);var r=parseFloat(t.style["font-size"])||14;if(s&&l&&r){a["font-size"]=r*(l/s)+"px";var n=5*(l/s)+"px";var o=8*(l/s)+"px";a["padding"]=n+" "+o}var c=new P({id:t.id,style:a,data:t.data});i.push(c)}}));i.forEach((function(e){s.Dom.append(e.render(),de(t,He,We).call(t))}))}function Ae(){if(!babelHelpers.classPrivateFieldGet(this,he).previewArea){babelHelpers.classPrivateFieldGet(this,he).previewArea=s.Tag.render(ie||(ie=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sign-preview__image" style="padding-top: ','">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),de(this,fe,ze).call(this),de(this,He,We).call(this))}return babelHelpers.classPrivateFieldGet(this,he).previewArea}function Oe(){if(!babelHelpers.classPrivateFieldGet(this,he).container){babelHelpers.classPrivateFieldGet(this,he).container=s.Tag.render(ae||(ae=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sign-preview__document-ready">\n\t\t\t\t\t<div class="sign-preview__document-background">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="sign-preview__document-controls">\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),de(this,Fe,Ae).call(this),de(this,we,Ee).call(this).render(),de(this,_e,je).call(this).render())}return babelHelpers.classPrivateFieldGet(this,he).container}function je(){if(!babelHelpers.classPrivateFieldGet(this,be)){babelHelpers.classPrivateFieldSet(this,be,new $({imageWrapper:de(this,He,We).call(this),previewArea:de(this,Fe,Ae).call(this)}))}return babelHelpers.classPrivateFieldGet(this,be)}function Ne(){var e=this;if(!babelHelpers.classPrivateFieldGet(this,he).error){babelHelpers.classPrivateFieldGet(this,he).error=s.Tag.render(se||(se=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sign-preview__image-error">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),s.Loc.getMessage("SIGN_CMP_MASTER_TPL_PREVIEW_LOADIN_ERROR"));var t=babelHelpers.classPrivateFieldGet(this,he).error.getElementsByTagName("span")[0];t.addEventListener("click",(function(){de(e,Pe,De).call(e,babelHelpers.classPrivateFieldGet(e,me)-1)}))}return babelHelpers.classPrivateFieldGet(this,he).error}function Re(){return de(this,He,We).call(this).querySelector("img.sign-preview__image-container_img")}var Be,Xe,Ze;function Ue(e,t){Ye(e,t);t.add(e)}function Ve(e,t,i){Ye(e,t);t.set(e,i)}function Ye(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function qe(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Je=new WeakMap;var Ke=new WeakMap;var Qe=new WeakMap;var $e=new WeakMap;var et=new WeakMap;var tt=new WeakMap;var it=new WeakMap;var at=new WeakSet;var st=new WeakSet;var lt=new WeakSet;var rt=new WeakSet;var nt=new WeakSet;var ot=function(e){babelHelpers.inherits(t,e);function t(e){var i;var a=e.renderTo,s=e.pages,l=e.blocks,r=e.documentHash,n=e.secCode;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Ue(babelHelpers.assertThisInitialized(i),nt);Ue(babelHelpers.assertThisInitialized(i),rt);Ue(babelHelpers.assertThisInitialized(i),lt);Ue(babelHelpers.assertThisInitialized(i),st);Ue(babelHelpers.assertThisInitialized(i),at);Ve(babelHelpers.assertThisInitialized(i),Je,{writable:true,value:void 0});Ve(babelHelpers.assertThisInitialized(i),Ke,{writable:true,value:void 0});Ve(babelHelpers.assertThisInitialized(i),Qe,{writable:true,value:void 0});Ve(babelHelpers.assertThisInitialized(i),$e,{writable:true,value:void 0});Ve(babelHelpers.assertThisInitialized(i),et,{writable:true,value:void 0});Ve(babelHelpers.assertThisInitialized(i),tt,{writable:true,value:void 0});Ve(babelHelpers.assertThisInitialized(i),it,{writable:true,value:void 0});i.setEventNamespace("BX.Sign.Preview");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Je,a||null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Qe,s||[]);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),$e,l||[]);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),et,r||null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),tt,n||null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),it,null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Ke,{document:null,footer:null});i.currentWidth=null;i.init();return i}babelHelpers.createClass(t,[{key:"showDocumentLoading",value:function e(){s.Dom.clean(qe(this,st,dt).call(this));s.Dom.append(c.render(),qe(this,st,dt).call(this))}},{key:"showDocumentEmpty",value:function e(){s.Dom.clean(qe(this,st,dt).call(this));s.Dom.append(r.render(),qe(this,st,dt).call(this))}},{key:"showDocumentReady",value:function e(){s.Dom.clean(qe(this,st,dt).call(this));qe(this,at,ct).call(this).setPages(babelHelpers.classPrivateFieldGet(this,Qe));s.Dom.append(qe(this,at,ct).call(this).render(),qe(this,st,dt).call(this));qe(this,at,ct).call(this).updateImageContainerSize()}},{key:"afterRender",value:function e(){var t=this;qe(this,at,ct).call(this).subscribe("onImageShow",(function(){var e=qe(t,at,ct).call(t);e.updateImageContainerSize()}));if(babelHelpers.classPrivateFieldGet(this,et)&&babelHelpers.classPrivateFieldGet(this,Qe).length===0&&BX.Sign.Backend){this.showDocumentLoading();var i=setInterval((function(){BX.ajax.runAction("sign.api.document.layoutIsReady",{data:{documentHash:babelHelpers.classPrivateFieldGet(t,et),secCode:babelHelpers.classPrivateFieldGet(t,tt)}})}),1e3*30);if(BX.PULL){BX.PULL.subscribe({moduleId:"sign",command:"layoutIsReady",callback:function e(a){if(a!==null&&a!==void 0&&a.layout){var l=a===null||a===void 0?void 0:a.layout;var r=a===null||a===void 0?void 0:a.blocks;if(s.Type.isArray(l)&&l.length>0){babelHelpers.classPrivateFieldSet(t,Qe,l);babelHelpers.classPrivateFieldSet(t,$e,r);t.subscribe("firstImageIsLoaded",(function(){t.showDocumentReady()}));t.subscribe("firstImageIsLoadedFail",(function(){t.showDocumentReady();qe(t,at,ct).call(t).showError()}));qe(t,rt,ut).call(t)}clearInterval(i)}}})}}}},{key:"init",value:function e(){var t=this;if(!babelHelpers.classPrivateFieldGet(this,Je)){console.warn("BX.Sign.Preview: 'renderTo' is not defined");return}if(!this.currentWidth){this.currentWidth=babelHelpers.classPrivateFieldGet(this,Je).offsetWidth-20}var i=babelHelpers.classPrivateFieldGet(this,Je).parentNode;var a=s.Tag.render(Be||(Be=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="sign-preview sign-preview__scope">\n\t\t\t\t<div class="sign-preview__body">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),qe(this,st,dt).call(this),qe(this,lt,ht).call(this));if(babelHelpers.classPrivateFieldGet(this,Qe).length>0){this.showDocumentLoading();qe(this,rt,ut).call(this);this.subscribe("firstImageIsLoaded",(function(){t.showDocumentReady()}));this.subscribe("firstImageIsLoadedFail",(function(){t.showDocumentReady();qe(t,at,ct).call(t).showError()}))}else{this.showDocumentEmpty()}s.Dom.clean(i);s.Dom.append(a,i);this.afterRender()}}]);return t}(a.EventEmitter);function ct(){var e=this;if(!babelHelpers.classPrivateFieldGet(this,it)){babelHelpers.classPrivateFieldGet(this,$e).forEach((function(t){t.position.currentDocumentWithPx=e.currentWidth}));babelHelpers.classPrivateFieldSet(this,it,new Se({pages:babelHelpers.classPrivateFieldGet(this,Qe),blocks:babelHelpers.classPrivateFieldGet(this,$e)}))}return babelHelpers.classPrivateFieldGet(this,it)}function dt(){if(!babelHelpers.classPrivateFieldGet(this,Ke).document){babelHelpers.classPrivateFieldGet(this,Ke).document=s.Tag.render(Xe||(Xe=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sign-preview__document"></div>\n\t\t\t'])))}return babelHelpers.classPrivateFieldGet(this,Ke).document}function ht(){if(!babelHelpers.classPrivateFieldGet(this,Ke).footer){babelHelpers.classPrivateFieldGet(this,Ke).footer=s.Tag.render(Ze||(Ze=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sign-preview__footer"></div>\n\t\t\t'])))}return babelHelpers.classPrivateFieldGet(this,Ke).footer}function ut(){var e=this;var t=babelHelpers.classPrivateFieldGet(this,Qe)[0].path;var i=new Image;i.crossOrigin="Anonymous";i.src=t;i.addEventListener("load",qe(this,nt,vt).bind(this,i),false);i.onerror=function(){e.emit("firstImageIsLoadedFail")}}function vt(e){var t=this;var i=document.createElement("canvas");var a=i.getContext("2d");i.width=e.width;i.height=e.height;a.drawImage(e,0,0);try{babelHelpers.classPrivateFieldGet(this,Qe)[0].path=i.toDataURL("image/png");babelHelpers.classPrivateFieldGet(this,Qe)[0].prepared=true;this.emit("firstImageIsLoaded");setTimeout((function(){return qe(t,at,ct).call(t).updateImageContainerSize()}),0)}catch(e){console.error("Error: ".concat(e))}}e.Preview=ot})(this.BX.Sign=this.BX.Sign||{},BX,BX,BX.Event,BX);
//# sourceMappingURL=preview.bundle.map.js