{"version":3,"file":"index.bundle.js","sources":["../src/blocks/dummy.js","../src/blocks/syncable-style-color.js","../src/blocks/date.js","../src/blocks/myrequisites.js","../src/ui.js","../src/blocks/mysign.js","../src/blocks/mystamp.js","../src/blocks/number.js","../src/blocks/reference.js","../src/blocks/myreference.js","../src/blocks/requisites.js","../src/blocks/sign.js","../src/blocks/stamp.js","../src/blocks/text.js","../src/style.js","../src/block.js","../src/resize.js","../src/index.js"],"sourcesContent":["import { Tag, Text as TextFormat } from 'main.core';\nimport Block from '../block';\nimport { EventEmitter } from 'main.core.events';\n\nexport default class Dummy extends EventEmitter\n{\n\tblock: Block;\n\tdata: any = {};\n\tevents: {[key: string]: string} = {\n\t\tonChange: 'onChange',\n\t\tonColorStyleChange: 'onColorStyleChange',\n\t};\n\n\tstatic defaultTextBlockPaddingStyles = {\n\t\tpadding: '5px 8px'\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {Block} block\n\t */\n\tconstructor(block: Block)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.Blocks.Dummy');\n\n\t\tthis.block = block;\n\t}\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t}\n\n\t/**\n\t * Changes only text key in data.\n\t * @param {string} text\n\t */\n\tsetText(text: string)\n\t{\n\t\tthis.setData({ text });\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Returns current data.\n\t * @return {any}\n\t */\n\tgetData(): any\n\t{\n\t\tif (this.data.base64)\n\t\t{\n\t\t\tthis.data.base64 = null;\n\t\t}\n\n\t\treturn this.data;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\treturn null;\n\t}\n\n\t/**\n\t * @return {HTMLElement | null}\n\t */\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\treturn null;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t${TextFormat.encode(this.data.text || '').toString().replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tthis.block.forceSave();\n\t}\n\n\tonChange(): void\n\t{\n\t\tthis.emit(this.events.onChange);\n\t}\n\n\tgetStyles(): {[styleName: string]: string}\n\t{\n\t\treturn {};\n\t}\n\n\tonStyleChange()\n\t{\n\t\tthis.emit(this.events.onColorStyleChange);\n\t}\n\n\tonStyleRender(styles: Object)\n\t{\n\t}\n}\n","import Dummy from './dummy';\n\nexport class BlockWithSynchronizableStyleColor extends Dummy\n{\n\tupdateColor(color: string): void\n\t{}\n}\n","import 'date';\nimport { Loc, Tag } from 'main.core';\n\nimport Dummy from './dummy';\n\nexport default class Date extends Dummy\n{\n\t#calendar: BX.JCCalendar;\n\t#calendarOpened: boolean = false;\n\t#date: string;\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 105,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#date = this.data.text;\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\tonActionClick()\n\t{\n\t\tthis.#calendar = BX.calendar({\n\t\t\tnode: this.block.getLayout(),\n\t\t\tfield: this.getViewContent(),\n\t\t\tvalue: this.#date,\n\t\t\tbTime: false,\n\t\t\tcallback_after: (date) => {\n\t\t\t\tthis.setText(\n\t\t\t\t\tBX.date.format(BX.date.convertBitrixFormat(BX.message('FORMAT_DATE')), date, null)\n\t\t\t\t);\n\t\t\t\tthis.block.renderView();\n\t\t\t}\n\t\t});\n\n\t\tthis.#calendarOpened = true;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_DATE_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Closes calendar if open.\n\t */\n\t#closeCalendar()\n\t{\n\t\tif (this.#calendar)\n\t\t{\n\t\t\tthis.#calendar.Close();\n\t\t\tthis.#calendarOpened = false;\n\t\t}\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tif (!this.#calendarOpened)\n\t\t{\n\t\t\tthis.block.forceSave();\n\t\t}\n\n\t\tthis.#calendarOpened = false;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Date.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { FieldsetViewer } from 'crm.requisite.fieldset-viewer';\nimport { Loc, Tag } from 'main.core';\n\nimport Dummy from './dummy';\n\nexport default class MyRequisites extends Dummy\n{\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns current data.\n\t * @return {any}\n\t */\n\tgetData(): any\n\t{\n\t\tconst data = this.data;\n\n\t\tif (data.text)\n\t\t{\n\t\t\tdata.text = null;\n\t\t}\n\n\t\treturn data;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 220,\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tconst document = this.block.getDocument();\n\t\tconst config = document.getConfig();\n\n\t\tevent.stopPropagation();\n\n\t\t(new FieldsetViewer({\n\t\t\tentityTypeId: config.crmOwnerTypeCompany,\n\t\t\tentityId: document.getCompanyId(),\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t},\n\t\t\t},\n\t\t\tfieldListEditorOptions: {\n\t\t\t\tfieldsPanelOptions: {\n\t\t\t\t\tfilter: {\n\t\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t\t'COMPANY',\n\t\t\t\t\t\t],\n\t\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t\t'list',\n\t\t\t\t\t\t\t'string',\n\t\t\t\t\t\t\t'date',\n\t\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t\t'text',\n\t\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t\t'address',\n\t\t\t\t\t\t\t'url',\n\t\t\t\t\t\t\t'money',\n\t\t\t\t\t\t\t'boolean',\n\t\t\t\t\t\t\t'double',\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\tpresetId: config.crmRequisiteCompanyPresetId,\n\t\t\t\t\tcontrollerOptions: {\n\t\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t}))\n\t\t\t.show()\n\t\t;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...MyRequisites.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { Dom, Event, Loc, Tag, Text as TextFormat, Reflection, Type } from 'main.core';\nimport { UI as SignUI } from 'sign.ui';\nimport { MemberItem } from './types/document';\n\nimport './style.css';\nimport 'color_picker';\n\ntype BlockLayoutOptions = {\n\tonRemove: () => {},\n\tonSave: () => {}\n};\n\nexport type ColorPickerOptions = {\n\tcolors?: Array<Array<string>>,\n\tallowCustomColor?: boolean,\n\tselectedColor?: string,\n\tcolorPreview?: boolean,\n}\n\nconst ColorPicker = Reflection.getClass('BX.ColorPicker');\n\nexport default class UI\n{\n\t/**\n\t * Sets width/height/top/left to element.\n\t * @param {HTMLElement} element\n\t * @param {{[key: string]: number}} rect\n\t */\n\tstatic setRect(element: HTMLElement, rect: {[key: string]: number})\n\t{\n\t\tObject.keys(rect).map(key => {\n\t\t\trect[key] = parseInt(rect[key]) + 'px';\n\t\t});\n\t\tDom.style(element, rect);\n\t}\n\n\t/**\n\t * Returns block's layout.\n\t * @param {BlockLayoutOptions} options Layout options.\n\t * @return {HTMLElement}\n\t */\n\tstatic getBlockLayout(options: BlockLayoutOptions): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-wrapper\">\n\t\t\t\t<div class=\"sign-document__block-panel--wrapper\" data-role=\"sign-block__actions\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-content\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-actions\">\n\t\t\t\t\t<div class=\"sign-document__block-actions--wrapper\">\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --remove sign-block-action-remove\" data-role=\"removeAction\" onclick=\"${options.onRemove}\"></button>\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --save sign-block-action-save\" data-role=\"saveAction\" onclick=\"${options.onSave}\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns member selector for block.\n\t * @param {Array<MemberItem>} members All document's members.\n\t * @param {number} selectedValue Selected member.\n\t * @param {() => {}} onChange Handler on change value.\n\t * @return {HTMLElement}\n\t */\n\tstatic getMemberSelector(members: Array<MemberItem>, selectedValue: number,  onChange: () => {}): HTMLElement\n\t{\n\t\tconst menuItems = {};\n\t\tlet selectedName = Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\n\t\tmembers.map(member => {\n\t\t\tmember.name = member.name || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\t\t\tmenuItems[member.part] = member.name;\n\n\t\t\tif (member.part === selectedValue)\n\t\t\t{\n\t\t\t\tselectedName = member.name;\n\t\t\t}\n\t\t});\n\n\t\tconst memberSelector = (members.length > 1)\n\t\t\t? Tag.render`<span>${TextFormat.encode(selectedName)}</span>`\n\t\t\t: Tag.render`<i>${TextFormat.encode(selectedName)}</i>`;\n\n\t\tif (members.length > 1)\n\t\t{\n\t\t\tSignUI.bindSimpleMenu({\n\t\t\t\tbindElement: memberSelector,\n\t\t\t\titems: menuItems,\n\t\t\t\tactionHandler: value => {\n\t\t\t\t\tmemberSelector.innerHTML = menuItems[value];\n\t\t\t\t\tonChange(parseInt(value));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-block-member-wrapper\">\n\t\t\t\t${memberSelector}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns resizing area's layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getResizeArea(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__resize-area\">\n\t\t\t\t<div class=\"sign-area-resizable-controls\">\n\t\t\t\t\t<span class=\"sign-document__move-control\"></span>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-right\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --left-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-left\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns style panel layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getStylePanel(\n\t\tactionHandler: (actionName: string, actionValue: string) => {},\n\t\tcollectStyles: {[key: string]: string},\n\t): HTMLElement\n\t{\n\t\t// font family selector\n\t\tconst fonts = {\n\t\t\t'\"Times New Roman\", Times':   '<span style=\"font-family: \\'Times New Roman\\', Times\">Times New Roman</span>',\n\t\t\t'\"Courier New\"':              '<span style=\"font-family: \\'Courier New\\'\">Courier New</span>',\n\t\t\t'Arial, Helvetica':           '<span style=\"font-family: Arial, Helvetica\">Arial / Helvetica</span>',\n\t\t\t'\"Arial Black\", Gadget':      '<span style=\"font-family: \\'Arial Black\\', Gadget\">Arial Black</span>',\n\t\t\t'Tahoma, Geneva':             '<span style=\"font-family: Tahoma, Geneva\">Tahoma / Geneva</span>',\n\t\t\t'Verdana':                    '<span style=\"font-family: Verdana\">Verdana</span>',\n\t\t\t'Georgia, serif':             '<span style=\"font-family: Georgia, serif\">Georgia</span>',\n\t\t\t'monospace':                  '<span style=\"font-family: monospace\">monospace</span>',\n\t\t};\n\t\tconst fontFamily = Tag.render`<div class=\"sign-document__block-style-btn --btn-font-family\">${fonts[collectStyles['font-family']] || 'Font'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontFamily,\n\t\t\titems: fonts,\n\t\t\tactionHandler: value => {\n\t\t\t\tfontFamily.innerHTML = fonts[value];\n\t\t\t\tactionHandler('family', value);\n\t\t\t}\n\t\t});\n\n\t\t// font size selector\n\t\t\n\t\tlet fontSizereal = parseInt(collectStyles['font-size']);\n\t\tlet fontSizeValue = 14;\n\t\t\n\t\tif (fontSizereal) \n\t\t{\n\t\t\tfontSizeValue = fontSizereal;\n\t\t}\n\n\t\tconst fontSize = Tag.render`<div class=\"sign-document__block-style-btn --btn-fontsize\">${fontSizeValue+ 'px' || '<i></i>'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontSize,\n\t\t\titems: [\n\t\t\t\t'6px', '7px', '8px', '9px', '10px', '11px', '12px', '13px', '14px', '15px', '16px',\n\t\t\t\t'18px', '20px', '22px', '24px', '26px', '28px', '36px', '48px', '72px'\n\t\t\t],\n\t\t\tactionHandler: value => {\n\t\t\t\tfontSize.innerHTML = parseInt(value) + 'px';\n\t\t\t\tactionHandler('size', value);\n\t\t\t},\n\t\t\tcurrentValue: fontSizeValue,\n\t\t});\n\n\t\t// color\n\t\tconst { layout: fontColor } = UI.getColorSelectorBtn(\n\t\t\tcollectStyles.color ?? '#000',\n\t\t\t(color) => actionHandler('color', color),\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style--panel\">\n<!--\t\t\t\t<div class=\"sign-document__block-style&#45;&#45;move-control\"></div>-->\n\t\t\t\t${fontFamily}\n\t\t\t\t${fontSize}\n\t\t\t\t${fontColor}\n\t\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-bold\" data-action=\"bold\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-italic\" data-action=\"italic\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-underline\" data-action=\"underline\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-strike\" data-action=\"through\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-left\" data-action=\"left\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-center\" data-action=\"center\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-right\" data-action=\"right\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-justify\" data-action=\"justify\"><i></i></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tstatic getColorSelectorBtn(\n\t\tdefaultColorPickerColor: string,\n\t\tonColorSelect: (string) => any,\n\t\tcolorPickerOptions: ColorPickerOptions = {},\n\t): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\tconst layout = Tag.render`<div class=\"sign-document__block-style-btn --btn-color\">\n\t\t\t\t<span class=\"sign-document__block-style-btn--color-block\"></span> \n\t\t\t\t<span>${Loc.getMessage('SIGN_JS_DOCUMENT_STYLE_COLOR')}</span>\n\t\t\t</div>`\n\t\t;\n\t\tUI.updateColorSelectorBtnColor(layout, defaultColorPickerColor);\n\t\tconst updatedColorPickerOptions = {\n\t\t\t...colorPickerOptions,\n\t\t\tbindElement: layout,\n\t\t\tonColorSelected:\n\t\t\t\t(color) => {\n\t\t\t\t\tonColorSelect(color);\n\t\t\t\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\t\t\t},\n\t\t};\n\n\t\tconst picker = new ColorPicker(updatedColorPickerOptions);\n\n\t\tEvent.bind(layout, 'click', () => {\n\t\t\tpicker.open();\n\t\t});\n\n\t\treturn { layout, colorPicker: picker };\n\t}\n\n\tstatic updateColorSelectorBtnColor(layout: HTMLElement, color: string): void\n\t{\n\t\tconst circleColor = layout.querySelector('.sign-document__block-style-btn--color-block');\n\t\tif (Type.isNil(circleColor))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(\n\t\t\tcircleColor,\n\t\t\t'background-color',\n\t\t\tcolor,\n\t\t);\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat, Type } from 'main.core';\nimport UI from './../ui';\nimport { BlockWithSynchronizableStyleColor } from './syncable-style-color';\n\nexport default class MySign extends BlockWithSynchronizableStyleColor\n{\n\tdataSrc: string;\n\n\t#cache = new Cache.MemoryCache();\n\t#defaultSignatureColor: string = '#0047ab';\n\t#availableSignatureColors: string = ['#000', this.#defaultSignatureColor, '#8b00ff'];\n\t#selectedSignatureColor: string | null = null;\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 200,\n\t\t\theight: 70,\n\t\t};\n\t}\n\n\tupdateColor(color: string)\n\t{\n\t\tsuper.updateColor(color);\n\t\tconst { layout, colorPicker } = this.#getColorSelectorBtn();\n\t\tthis.#selectedSignatureColor = color;\n\n\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\tcolorPicker.setSelectedColor(color);\n\t}\n\n\t/**\n\t * @return {HTMLElement | null}\n\t */\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\tconst { layout: colorSelectorBtnLayout } = this.#getColorSelectorBtn();\n\n\t\treturn Tag.render`\n\t\t\t<div style=\"display: flex; flex-direction: row;\">\n\t\t\t${colorSelectorBtnLayout}\n\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t<div class=\"sign-document-block-member-wrapper\">\n\t\t\t\t<i>${Loc.getMessage('SIGN_JS_DOCUMENT_SIGN_ACTION_BUTTON')}</i>\n\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getColorSelectorBtn(): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\treturn this.#cache.remember('colorSelectorBtn', () => UI.getColorSelectorBtn(\n\t\t\tthis.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t(color) => {\n\t\t\t\tthis.#selectedSignatureColor = color;\n\t\t\t\tthis.onStyleChange();\n\t\t\t},\n\t\t\t{\n\t\t\t\tcolors: [this.#availableSignatureColors],\n\t\t\t\tallowCustomColor: false,\n\t\t\t\tselectedColor: this.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t\tcolorPreview: false,\n\t\t\t},\n\t\t));\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tlet src = null;\n\t\tif (this.dataSrc)\n\t\t{\n\t\t\tsrc = this.dataSrc;\n\t\t}\n\t\telse if (this.data.base64)\n\t\t{\n\t\t\tsrc = 'data:image;base64,' + this.data.base64;\n\t\t}\n\n\t\tif (src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<img src=\"${src}\" alt=\"\">\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || this.getPlaceholderLabel())}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_MY_SIGN');\n\t}\n\n\tgetStyles(): { [styleName: string]: string }\n\t{\n\t\treturn { 'background-position': 'center !important', color: this.#getSignatureColor() };\n\t}\n\n\t#getSignatureColor(): string\n\t{\n\t\treturn this.#selectedSignatureColor ?? this.#defaultSignatureColor;\n\t}\n\n\tonSave()\n\t{\n\t\tsuper.onSave();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tonClickOut()\n\t{\n\t\tsuper.onClickOut();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\t#closeColorPickerPopup()\n\t{\n\t\tconst { colorPicker } = this.#getColorSelectorBtn();\n\t\tcolorPicker.close();\n\t}\n\n\tonStyleRender(styles: Object)\n\t{\n\t\tsuper.onStyleRender(styles);\n\t\tif (!Type.isNil(styles.color))\n\t\t{\n\t\t\tthis.updateColor(styles.color);\n\t\t}\n\t}\n}\n","import { Loc, Tag, Text } from 'main.core';\nimport { Backend } from 'sign.backend';\nimport { Uploader } from 'ui.stamp.uploader';\n\nimport Dummy from './dummy';\nimport Block from '../block';\n\nexport default class MyStamp extends Dummy\n{\n\tstatic currentBlock: Block;\n\n\tdataSrc: string;\n\t#uploader: Uploader;\n\n\tconstructor(block: Block)\n\t{\n\t\tsuper(block);\n\n\t\tthis.#uploader = new Uploader({\n\t\t\tcontroller: {\n\t\t\t\tupload: 'sign.upload.stampUploadController',\n\t\t\t},\n\t\t\tcontact: {\n\t\t\t\tid: 0,\n\t\t\t\tlabel: Text.encode(this.block.getDocument().getInitiatorName()),\n\t\t\t},\n\t\t});\n\n\t\tthis.#uploader.subscribe('onSaveAsync', (event) => {\n\n\t\t\tMyStamp.currentBlock.await(true);\n\n\t\t\treturn new Promise((resolve, reject) => {\n\n\t\t\t\tconst eventData = event.getData();\n\n\t\t\t\tif (!eventData?.file?.serverId)\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.dataSrc = eventData.file.serverPreviewUrl;\n\n\t\t\t\tthis.#saveStamp(MyStamp.currentBlock, eventData.file.serverId).then(() => {\n\t\t\t\t\tresolve();\n\t\t\t\t}).catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 151,\n\t\t\theight: 151\n\t\t};\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_STAMP_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tMyStamp.currentBlock = this.block;\n\t\tthis.#uploader.show();\n\t}\n\n\t/**\n\t * Saves stamp to backend.\n\t * @param {Block} block\n\t * @param {string} fileId\n\t */\n\t#saveStamp(block: Block, fileId: string): Promise\n\t{\n\t\treturn Backend.controller({\n\t\t\t\tcommand: 'integration.crm.saveCompanyStamp',\n\t\t\t\tpostData: {\n\t\t\t\t\tdocumentId: block.getDocument().getId(),\n\t\t\t\t\tcompanyId: block.getDocument().getCompanyId(),\n\t\t\t\t\tfileId: fileId\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(result => {\n\t\t\t\tblock.assign();\n\t\t\t})\n\t\t\t.catch(() => {});\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tlet src = null;\n\n\t\tif (this.dataSrc)\n\t\t{\n\t\t\tsrc = this.dataSrc;\n\t\t}\n\t\telse if (this.data.base64)\n\t\t{\n\t\t\tsrc = 'data:image;base64,' + this.data.base64;\n\t\t}\n\n\t\tif (src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_stamp\" style=\"background-image: url(${src})\"></div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata --stamp\"></div>\n\t\t\t`;\n\t\t}\n\t}\n}\n","import { Loc, Tag, Text as TextFormat } from 'main.core';\nimport { Backend } from 'sign.backend';\n\nimport Dummy from './dummy';\n\nexport default class Number extends Dummy\n{\n\tstatic sliderOnMessageBind: boolean = false;\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 100,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tconst numeratorUrl = this.block.getDocument().getConfig()['crmNumeratorUrl'];\n\n\t\tif (!Number.sliderOnMessageBind)\n\t\t{\n\t\t\tNumber.sliderOnMessageBind = true;\n\n\t\t\tBX.addCustomEvent('SidePanel.Slider:onMessage', (event) =>\n\t\t\t{\n\t\t\t\tif (event.getEventId() === 'numerator-saved-event')\n\t\t\t\t{\n\t\t\t\t\tconst numeratorData = event.getData();\n\t\t\t\t\tconst currentBlock = event?.sender?.options?.data?.block ?? this.block;\n\n\t\t\t\t\tif (numeratorData.type === 'CRM_SMART_DOCUMENT')\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentBlock.await(true);\n\n\t\t\t\t\t\tBackend.controller({\n\t\t\t\t\t\t\t\tcommand: 'integration.crm.refreshNumberInDocument',\n\t\t\t\t\t\t\t\tpostData: {\n\t\t\t\t\t\t\t\t\tdocumentId: currentBlock.getDocument().getId(),\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(result => {\n\t\t\t\t\t\t\t\tcurrentBlock.assign();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(() => {});\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t});\n\t\t}\n\n\t\tBX.SidePanel.Instance.open(numeratorUrl, {\n\t\t\twidth: 480,\n\t\t\tcacheable: false,\n\t\t\tdata: {\n\t\t\t\tblock: this.block\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_NUMBER_ACTION_EDIT')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-number\">\n\t\t\t\t${TextFormat.encode(this.data.text || '').toString()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Number.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat, Type } from 'main.core';\nimport Dummy from './dummy';\nimport { Selector } from \"crm.form.fields.selector\";\n\nexport default class Reference extends Dummy\n{\n\t#cache = new Cache.MemoryCache();\n\t#field: string;\n\t#actionButton: HTMLElement;\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field;\n\t}\n\n\t/**\n\t * Returns current data.\n\t * @return {any}\n\t */\n\tgetData(): any\n\t{\n\t\tconst data = this.data;\n\n\t\tif (data.text && data.field)\n\t\t{\n\t\t\tdelete data.text;\n\t\t}\n\n\t\treturn data;\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\t#onActionClick()\n\t{\n\t\tthis.#getCrmFieldSelectorPanel()\n\t\t\t.show()\n\t\t\t.then((selectedName: Array<string>) => {\n\t\t\t\tif (selectedName.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#field = selectedName[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tif (Type.isUndefined(Selector))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel()\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst config = this.block.getDocument().getConfig();\n\t\tlet fieldLabel = config.crmEntityFields[this.#field] || null;\n\n\t\tif (!fieldLabel)\n\t\t{\n\t\t\tfieldLabel = Loc.getMessage('SIGN_JS_DOCUMENT_REFERENCE_ACTION_BUTTON');\n\t\t}\n\n\t\tthis.#actionButton.querySelector('button').innerText = fieldLabel;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tif (this.data.src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div style=\"width: ${width - 14}px; height: ${height - 14}px; background: url(${this.data.src}) no-repeat top; background-size: cover;\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst className = !this.data.text ? 'sign-document__block-content_member-nodata' : '';\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"${className}\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA'))}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n\n\t#getCrmFieldSelectorPanel(): Selector\n\t{\n\t\treturn this.#cache.remember('getFieldSelector', () => new Selector({\n\t\t\tmultiple: false,\n\t\t\tcontrollerOptions: {\n\t\t\t\thideVirtual: 1,\n\t\t\t\thideRequisites: 1,\n\t\t\t\thideSmartDocument: 1,\n\t\t\t},\n\t\t\tfilter: {\n\t\t\t\t'+categories': [\n\t\t\t\t\t'CONTACT',\n\t\t\t\t\t'SMART_DOCUMENT',\n\t\t\t\t],\n\t\t\t\t'+fields': [\n\t\t\t\t\t'list',\n\t\t\t\t\t'string',\n\t\t\t\t\t'date',\n\t\t\t\t\t'typed_string',\n\t\t\t\t\t'text',\n\t\t\t\t\t'datetime',\n\t\t\t\t\t'enumeration',\n\t\t\t\t\t'address',\n\t\t\t\t\t'url',\n\t\t\t\t\t'money',\n\t\t\t\t\t'boolean',\n\t\t\t\t\t'double',\n\t\t\t\t],\n\t\t\t},\n\t\t}));\n\t}\n\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Reference.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat, Type } from 'main.core';\nimport Dummy from './dummy';\nimport { Selector } from \"crm.form.fields.selector\";\n\nexport default class MyReference extends Dummy\n{\n\t#field: string;\n\t#actionButton: HTMLElement;\n\t#cache = new Cache.MemoryCache();\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field;\n\t}\n\n\t/**\n\t * Returns current data.\n\t * @return {any}\n\t */\n\tgetData(): any\n\t{\n\t\tconst data = this.data;\n\n\t\tif (data.text && data.field)\n\t\t{\n\t\t\tdelete data.text;\n\t\t}\n\n\t\treturn data;\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\t#onActionClick()\n\t{\n\t\tthis.#getCrmFieldSelectorPanel()\n\t\t\t.show()\n\t\t\t.then((selectedName: Array<string>) => {\n\t\t\t\tif (selectedName.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#field = selectedName[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tif (Type.isUndefined(Selector))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel()\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst config = this.block.getDocument().getConfig();\n\t\tlet fieldLabel = config.crmEntityFields[this.#field] || null;\n\n\t\tif (!fieldLabel)\n\t\t{\n\t\t\tfieldLabel = Loc.getMessage('SIGN_JS_DOCUMENT_REFERENCE_ACTION_BUTTON');\n\t\t}\n\n\t\tthis.#actionButton.querySelector('button').innerText = fieldLabel;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tif (this.data.src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div style=\"width: ${width - 14}px; height: ${height - 14}px; background: url(${this.data.src}) no-repeat top; background-size: cover;\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst className = !this.data.text ? 'sign-document__block-content_member-nodata' : '';\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"${className}\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_MY_BLOCKS'))}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n\n\t#getCrmFieldSelectorPanel(): Selector\n\t{\n\t\treturn this.#cache.remember('getFieldSelector', () => new Selector({\n\t\t\tmultiple: false,\n\t\t\tcontrollerOptions: {\n\t\t\t\thideVirtual: 1,\n\t\t\t\thideRequisites: 1,\n\t\t\t\thideSmartDocument: 1,\n\t\t\t},\n\t\t\tfilter: {\n\t\t\t\t'+categories': [\n\t\t\t\t\t'COMPANY',\n\t\t\t\t\t'SMART_DOCUMENT',\n\t\t\t\t],\n\t\t\t\t'+fields': [\n\t\t\t\t\t'list',\n\t\t\t\t\t'string',\n\t\t\t\t\t'date',\n\t\t\t\t\t'typed_string',\n\t\t\t\t\t'text',\n\t\t\t\t\t'datetime',\n\t\t\t\t\t'enumeration',\n\t\t\t\t\t'address',\n\t\t\t\t\t'url',\n\t\t\t\t\t'money',\n\t\t\t\t\t'boolean',\n\t\t\t\t\t'double',\n\t\t\t\t],\n\t\t\t\t'-fields': [\n\t\t\t\t\tthis.#getFieldNegativeFilter()\n\t\t\t\t]\n\t\t\t},\n\t\t}));\n\t}\n\n\t#getFieldNegativeFilter(): (Object) => boolean\n\t{\n\t\tconst blackList = this.#getFieldsNameBlackList();\n\t\treturn (field) => {\n\t\t\treturn blackList.some((blankListFieldName) => field.name === blankListFieldName)\n\t\t}\n\t}\n\n\t#getFieldsNameBlackList(): Array<string>\n\t{\n\t\treturn [\n\t\t\t'COMPANY_LINK',\n\t\t\t'COMPANY_REG_ADDRESS',\n\t\t\t'COMPANY_ORIGIN_VERSION'\n\t\t];\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...MyReference.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { FieldsetViewer } from 'crm.requisite.fieldset-viewer';\nimport { Loc, Tag, Text as TextFormat } from 'main.core';\n\nimport Dummy from './dummy';\n\nexport default class Requisites extends Dummy\n{\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns current data.\n\t * @return {any}\n\t */\n\tgetData(): any\n\t{\n\t\tconst data = this.data;\n\n\t\tif (data.text)\n\t\t{\n\t\t\tdata.text = null;\n\t\t}\n\n\t\treturn data;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 220,\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tconst document = this.block.getDocument();\n\t\tconst config = document.getConfig();\n\t\tconst member = document.getMemberByPart(this.block.getMemberPart());\n\n\t\tevent.stopPropagation();\n\n\t\tif (!member)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t(new FieldsetViewer({\n\t\t\tentityTypeId: config.crmOwnerTypeContact,\n\t\t\tentityId: member.cid,\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t},\n\t\t\t},\n\t\t\tfieldListEditorOptions: {\n\t\t\t\tfieldsPanelOptions: {\n\t\t\t\t\tfilter: {\n\t\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t\t'CONTACT',\n\t\t\t\t\t\t],\n\t\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t\t'list',\n\t\t\t\t\t\t\t'string',\n\t\t\t\t\t\t\t'date',\n\t\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t\t'text',\n\t\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t\t'address',\n\t\t\t\t\t\t\t'url',\n\t\t\t\t\t\t\t'money',\n\t\t\t\t\t\t\t'boolean',\n\t\t\t\t\t\t\t'double',\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\tpresetId: config.crmRequisiteContactPresetId,\n\t\t\t\t\tcontrollerOptions: {\n\t\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t}))\n\t\t\t.show()\n\t\t;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst text = this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_REQUISITES');\n\t\tconst tagBody = this.data.text ? '' : ' class=\"sign-document__block-content_member-nodata\"';\n\n\t\treturn Tag.render`\n\t\t\t<div${tagBody}>\n\t\t\t\t${TextFormat.encode(text).toString().replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Requisites.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat, Type } from 'main.core';\nimport UI from './../ui';\nimport { BlockWithSynchronizableStyleColor } from './syncable-style-color';\n\nexport default class Sign extends BlockWithSynchronizableStyleColor\n{\n\t#cache = new Cache.MemoryCache();\n\t#defaultSignatureColor: string = '#0047ab';\n\t#availableSignatureColors: string = ['#000', this.#defaultSignatureColor, '#8b00ff'];\n\t#selectedSignatureColor: string | null = null;\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_SIGN');\n\t}\n\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 200,\n\t\t\theight: 70,\n\t\t};\n\t}\n\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\tconst { layout: colorSelectorBtnLayout } = this.#getColorSelectorBtn();\n\n\t\treturn Tag.render`\n\t\t\t<div style=\"display: flex; flex-direction: row;\">\n\t\t\t${colorSelectorBtnLayout}\n\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t${TextFormat.encode(this.getPlaceholderLabel())}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tupdateColor(color: string)\n\t{\n\t\tsuper.updateColor(color);\n\t\tconst { layout, colorPicker } = this.#getColorSelectorBtn();\n\t\tthis.#selectedSignatureColor = color;\n\n\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\tcolorPicker.setSelectedColor(color);\n\t}\n\n\tgetStyles(): { [styleName: string]: string }\n\t{\n\t\treturn { 'background-position': 'center !important', color: this.#getSignatureColor() };\n\t}\n\n\t#getColorSelectorBtn(): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\treturn this.#cache.remember('colorSelectorBtn', () => UI.getColorSelectorBtn(\n\t\t\tthis.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t(color) => {\n\t\t\t\tthis.#selectedSignatureColor = color;\n\t\t\t\tthis.onStyleChange();\n\t\t\t},\n\t\t\t{\n\t\t\t\tcolors: [this.#availableSignatureColors],\n\t\t\t\tallowCustomColor: false,\n\t\t\t\tselectedColor: this.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t\tcolorPreview: false,\n\t\t\t},\n\t\t));\n\t}\n\n\t#getSignatureColor(): string\n\t{\n\t\treturn this.#selectedSignatureColor ?? this.#defaultSignatureColor;\n\t}\n\n\tonSave()\n\t{\n\t\tsuper.onSave();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tonClickOut()\n\t{\n\t\tsuper.onClickOut();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\t#closeColorPickerPopup()\n\t{\n\t\tconst { colorPicker } = this.#getColorSelectorBtn();\n\t\tcolorPicker.close();\n\t}\n\n\tonStyleRender(styles: Object)\n\t{\n\t\tsuper.onStyleRender(styles);\n\t\tif (!Type.isNil(styles.color))\n\t\t{\n\t\t\tthis.updateColor(styles.color);\n\t\t}\n\t}\n}\n","import { Loc, Tag, Text as TextFormat } from 'main.core';\nimport Dummy from './dummy';\n\nexport default class Stamp extends Dummy\n{\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 151,\n\t\t\theight: 151\n\t\t};\n\t}\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_STAMP');\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst {width, height} = this.block.getPosition();\n\n\t\tif (this.data.base64)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_stamp\" style=\"background-image: url(${src})\"></div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n}\n","import { Event, Loc, Tag, Text as TextFormat } from 'main.core';\nimport Dummy from './dummy';\nimport Block from \"../block\";\n\nexport default class Text extends Dummy\n{\n\t#textContainer: HTMLElement;\n\n\tconstructor(block: Block)\n\t{\n\t\tsuper(block);\n\t\tthis.setEventNamespace('BX.Sign.Blocks.Text');\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\tonActionClick()\n\t{\n\t\tthis.#textContainer.contentEditable = true;\n\t\tthis.#textContainer.focus();\n\t}\n\n\t/**\n\t * Calls when typing in text container.\n\t */\n\t#onKeyUp(event): void\n\t{\n\t\tthis.setText(this.#textContainer.innerText.replaceAll(\"\\n\", '[br]'));\n\t\tthis.onChange();\n\t}\n\n\tgetText(): string\n\t{\n\t\treturn this.data.text;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.#textContainer;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement}\n\t */\n\tgetViewContent(): HTMLElement\n\t{\n\t\tconst content = this.data.text === Loc.getMessage('SIGN_JS_DOCUMENT_TEXT_PLACEHOLDER')\n\t\t\t? ''\n\t\t\t: this.data.text\n\t\t;\n\n\t\tthis.#textContainer = Tag.render`\n\t\t\t<div class=\"sign-document-block-text\" placeholder=\"${Loc.getMessage('SIGN_JS_DOCUMENT_TEXT_PLACEHOLDER')}\">\n\t\t\t\t${TextFormat.encode(content).replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.#textContainer, 'keyup', this.#onKeyUp.bind(this));\n\t\tEvent.bind(this.#textContainer, 'paste', event => setTimeout(this.#onPaste.bind(this, event)));\n\n\t\treturn this.#textContainer;\n\t}\n\n\t#onPaste(event: ClipboardEvent): void\n\t{\n\t\tthis.#textContainer.innerHTML = this.#textContainer.innerText.replaceAll('\\n', '<br>');\n\n\t\tconst range = document.createRange();\n\t\trange.selectNodeContents(this.#textContainer);\n\t\trange.collapse(false)\n\n\t\tconst selection = document.getSelection();\n\t\tselection.removeAllRanges();\n\t\tselection.addRange(range);\n\n\t\tthis.setText(\n\t\t\tthis.#textContainer\n\t\t\t\t.innerHTML\n\t\t\t\t.replaceAll('<br>', '[br]'),\n\t\t);\n\t\tthis.onChange();\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Text.defaultTextBlockPaddingStyles };\n\t}\n}","import { Dom, Event } from 'main.core';\n\nimport Block from './block';\nimport UI from './ui';\n\ntype StyleOptions = {\n\tblock: Block,\n\tdata: {[key: string]: string}\n};\n\nexport default class Style\n{\n\t#block: Block;\n\n\t#buttons = {\n\t\tfamily: {\n\t\t\tproperty: 'font-family',\n\t\t\tvalue: null\n\t\t},\n\t\tsize: {\n\t\t\tproperty: 'font-size',\n\t\t\tvalue: 14\n\t\t},\n\t\tcolor: {\n\t\t\tproperty: 'color',\n\t\t\tvalue: null\n\t\t},\n\t\tbold: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'font-weight',\n\t\t\tvalue: 'bold',\n\t\t\tstate: false\n\t\t},\n\t\titalic: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'font-style',\n\t\t\tvalue: 'italic',\n\t\t\tstate: false\n\t\t},\n\t\tunderline: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'text-decoration',\n\t\t\tvalue: 'underline',\n\t\t\tstate: false\n\t\t},\n\t\tthrough: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'text-decoration',\n\t\t\tvalue: 'line-through',\n\t\t\tstate: false\n\t\t},\n\t\tleft: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'text-align',\n\t\t\tvalue: 'left',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tcenter: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'text-align',\n\t\t\tvalue: 'center',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tright: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'text-align',\n\t\t\tvalue: 'right',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tjustify: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'text-align',\n\t\t\tvalue: 'justify',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t}\n\t};\n\n\t#style = {\n\t\tbuttonPressed: 'sign-document__block-style--button-pressed'\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {StyleOptions} options\n\t */\n\tconstructor(options: StyleOptions)\n\t{\n\t\tthis.#block = options.block;\n\n\t\tif (options.data)\n\t\t{\n\t\t\tthis.#applyData(options.data);\n\t\t}\n\t}\n\n\t/**\n\t * Handle on panel button click.\n\t * @param {string} code\n\t */\n\t#onPressButton(code: string)\n\t{\n\t\tthis.#buttons[code]['state'] = !this.#buttons[code]['state'];\n\n\t\tif (this.#buttons[code]['state'])\n\t\t{\n\t\t\tDom.addClass(this.#buttons[code]['button'], this.#style.buttonPressed);\n\n\t\t\tif (this.#buttons[code]['group'])\n\t\t\t{\n\t\t\t\tconst group = this.#buttons[code]['group'];\n\n\t\t\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\t\t\tif (key !== code && this.#buttons[key]['group'] === group)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#buttons[key]['state'] = false;\n\t\t\t\t\t\tDom.removeClass(this.#buttons[key]['button'], this.#style.buttonPressed);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.#buttons[code]['button'], this.#style.buttonPressed);\n\t\t}\n\n\t\tthis.#block.renderStyle();\n\t}\n\n\t/**\n\t * Applies initiated data to current state.\n\t * @param {{[key: string]: string}} data\n\t */\n\t#applyData(data: {[key: string]: string})\n\t{\n\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\tconst property = this.#buttons[key]['property'];\n\n\t\t\tif (typeof data[property] !== 'undefined')\n\t\t\t{\n\t\t\t\tif (typeof this.#buttons[key]['state'] !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tif (data[property].indexOf(this.#buttons[key]['value']) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#buttons[key]['state'] = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#buttons[key]['value'] = data[property];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Applies collected styles to the element.\n\t * @param {HTMLElement} element\n\t */\n\tapplyStyles(element: HTMLElement)\n\t{\n\t\telement.removeAttribute('style');\n\t\tDom.style(element, this.collectStyles());\n\t}\n\n\tupdateFontSize(fontSize)\n\t{\n\t\tif (fontSize)\n\t\t{\n\t\t\tthis.#buttons.size['property'] = 'font-size';\n\t\t\tthis.#buttons.size['value'] = fontSize;\n\t\t}\n\t}\n\n\t/**\n\t * Collects checked styles in one dataset.\n\t * @return {{[key: string]: string}}\n\t */\n\tcollectStyles(): {[key: string]: string}\n\t{\n\t\tconst styles = {};\n\n\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\tif (this.#buttons[key]['state'] || (typeof this.#buttons[key]['state'] === 'undefined'))\n\t\t\t{\n\t\t\t\tconst property = this.#buttons[key]['property'];\n\t\t\t\tconst value = this.#buttons[key]['value'];\n\n\t\t\t\tif (value === null)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.#buttons[key]['group'])\n\t\t\t\t{\n\t\t\t\t\tstyles[property] = value;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tstyles[property] = (styles[property] ? styles[property] + ' ' : '') + value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn styles;\n\t}\n\n\t/**\n\t * Returns style panel layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\tconst layout = UI.getStylePanel(\n\t\t\t(code: string, value: string) => {\n\t\t\t\tthis.#buttons[code]['value'] = value;\n\t\t\t\tthis.#block.renderStyle();\n\t\t\t},\n\t\t\tthis.collectStyles(),\n\t\t);\n\n\t\t[...layout.querySelectorAll('[data-action]')].map(button => {\n\t\t\t\tconst action = button.getAttribute('data-action');\n\n\t\t\tif (this.#buttons[action])\n\t\t\t{\n\t\t\t\tEvent.bind(button, 'click', () => this.#onPressButton(action));\n\t\t\t\tthis.#buttons[action]['button'] = button;\n\n\t\t\t\tif (this.#buttons[action]['state'])\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.#buttons[action]['button'], this.#style.buttonPressed);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn layout;\n\t}\n\n\tupdateColor(color: string)\n\t{\n\t\tthis.#buttons.color.value = color;\n\t}\n}\n","import { Dom, Event, Type } from 'main.core';\nimport { Backend } from 'sign.backend';\nimport { EventEmitter } from 'main.core.events';\n\nimport { BlockWithSynchronizableStyleColor } from './blocks/syncable-style-color';\nimport { Date, Dummy, MyRequisites, MySign, MyStamp, Number, Reference, Requisites, Sign, Stamp, Text, MyReference } from './blocks/index';\nimport { Document } from './index';\nimport Style from './style';\nimport { PositionType, BlockOptions } from './types/block';\nimport UI from './ui';\n\nexport default class Block extends EventEmitter\n{\n\tstatic #signContentColor: {[code: string]: string} = {};\n\n\tevents: {[eventName: string]: string} = {\n\t\tonColorStyleChange: 'onColorStyleChange',\n\t};\n\n\t#id: number;\n\t#code: string;\n\t#layout: HTMLElement;\n\t#stylePanel: Style;\n\t#content: Dummy = null;\n\t#document: Document;\n\t#memberPart: number = 2;\n\t#panelCreated: boolean = false;\n\t#allowMembers: boolean = false;\n\t#onClickCallback: ?() => {};\n\t#onRemoveCallback: ?() => {};\n\t#contentProviders = {\n\t\tdate: Date,\n\t\tmyrequisites: MyRequisites,\n\t\tmysign: MySign,\n\t\tmystamp: MyStamp,\n\t\tnumber: Number,\n\t\treference: Reference,\n\t\tmyreference: MyReference,\n\t\trequisites: Requisites,\n\t\tsign: Sign,\n\t\tstamp: Stamp,\n\t\ttext: Text,\n\t};\n\t#currentFontSize: String;\n\n\t#style = {\n\t\tblockContent: '.sign-document__block-content',\n\t\tblockPanel: '.sign-document__block-panel--wrapper',\n\t\tblockLoading: 'sign-document-block-loading',\n\t\tblockEditing: 'sign-document__block-wrapper-editing',\n\t\tpageWithNotAllowed: 'sign-editor__content-document--active-move',\n\t};\n\n\t#firstRenderReady: boolean;\n\n\t/**\n\t * Constructor.\n\t * @param {BlockOptions} options\n\t */\n\tconstructor(options: BlockOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.Document.Block');\n\n\t\tthis.#id = options.id || null;\n\t\tthis.#code = options.code;\n\t\tthis.#memberPart = options.part;\n\t\tthis.#document = options.document;\n\t\tthis.#onClickCallback = options.onClick;\n\t\tthis.#onRemoveCallback = options.onRemove;\n\t\tthis.#firstRenderReady = null;\n\n\t\tthis.#stylePanel = new Style({\n\t\t\tblock: this,\n\t\t\tdata: options.style\n\t\t});\n\n\t\tif (!this.#contentProviders[this.#code])\n\t\t{\n\t\t\tthrow new Error(`Content provider for '${this.#code}' not found.`);\n\t\t}\n\n\t\tthis.#content = new this.#contentProviders[this.#code](this);\n\n\t\tthis.#createLayout();\n\n\t\tEvent.bind(this.#layout, 'click', this.#onClick.bind(this));\n\n\t\tif (options.part > 1)\n\t\t{\n\t\t\tthis.#allowMembers = true;\n\t\t}\n\n\t\tthis.renderStyle();\n\n\t\tthis.setPosition(options.position ? options.position : this.#content.getInitDimension());\n\n\t\tif (options.data)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.setData(options.data);\n\t\t\t}, 0);\n\t\t}\n\n\t\tif (\n\t\t\t!Type.isUndefined(Block.#signContentColor[this.getCode()])\n\t\t\t&& this.#content instanceof BlockWithSynchronizableStyleColor\n\t\t)\n\t\t{\n\t\t\tthis.#content.updateColor(Block.#signContentColor[this.getCode()]);\n\t\t}\n\t}\n\n\t/**\n\t * Returns block's layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#layout;\n\t}\n\n\t/**\n\t * Returns Document instance.\n\t * @return {Document}\n\t */\n\tgetDocument(): Document\n\t{\n\t\treturn this.#document;\n\t}\n\n\t/**\n\t * Sets new data to the block.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.#content.setData(data);\n\t\tthis.renderView();\n\t}\n\n\t/**\n\t * Sets initial position to the block.\n\t * @param {PositionType} position\n\t */\n\tsetPosition(position: PositionType)\n\t{\n\t\tUI.setRect(this.#layout, position);\n\t}\n\n\t/**\n\t * Returns block's data.\n\t * @return {any}\n\t */\n\tgetData(): any\n\t{\n\t\treturn this.#content.getData();\n\t}\n\n\t/**\n\t * Returns position.\n\t * @return {PositionType}\n\t */\n\tgetPosition(): PositionType\n\t{\n\t\tlet {top, left, width, height} = this.#layout.getBoundingClientRect();\n\t\ttop = Math.round(top);\n\t\tleft = Math.round(left);\n\t\twidth = Math.round(width);\n\t\theight = Math.round(height);\n\n\t\tconst documentRect = this.#document.getLayout().getBoundingClientRect();\n\n\t\ttop -= Math.round(documentRect.top);\n\t\tleft -= Math.round(documentRect.left);\n\n\t\treturn {top, left, width, height};\n\t}\n\n\t/**\n\t * Returns block styles.\n\t * @return {{{[key: string]: string}}}\n\t */\n\tgetStyle(): {[key: string]: string}\n\t{\n\t\treturn { ...this.#content.getStyles(), ...this.#stylePanel.collectStyles() };\n\t}\n\n\t/**\n\t * Returns id.\n\t * @return {number|null}\n\t */\n\tgetId(): ?number\n\t{\n\t\treturn this.#id | null;\n\t}\n\n\t/**\n\t * Returns code.\n\t * @return {string}\n\t */\n\tgetCode(): string\n\t{\n\t\treturn this.#code;\n\t}\n\n\t/**\n\t * Shows page's areas not allowed for block's placement.\n\t */\n\tshowNotAllowedArea()\n\t{\n\t\tconst {page} = this.getDocument().transferPositionToPage(this.getPosition());\n\t\tconst pageElement = document.querySelector(`.sign-editor__content-document--page[data-page=\"${page}\"]`);\n\n\t\tDom.addClass(pageElement, this.#style.pageWithNotAllowed);\n\t}\n\n\thideNotAllowedArea()\n\t{\n\t\tconst {page} = this.getDocument().transferPositionToPage(this.getPosition());\n\t\tconst pageElement = document.querySelector(`.sign-editor__content-document--page[data-page=\"${page}\"]`);\n\n\t\tDom.removeClass(pageElement, this.#style.pageWithNotAllowed);\n\t}\n\n\t/**\n\t * Returns member part.\n\t * @return {number}\n\t */\n\tgetMemberPart(): number\n\t{\n\t\treturn this.#memberPart;\n\t}\n\n\t/**\n\t * Handler on click to block.\n\t */\n\t#onClick()\n\t{\n\t\tif (this.#onClickCallback)\n\t\t{\n\t\t\tthis.#onClickCallback(this);\n\t\t}\n\t}\n\n\t/**\n\t * Calls block's action.\n\t */\n\tfireAction()\n\t{\n\t\tif (this.#content['onActionClick'])\n\t\t{\n\t\t\tif (this.#code === 'text')\n\t\t\t{\n\t\t\t\tDom.addClass(this.#layout, this.#style.blockEditing);\n\t\t\t}\n\t\t\tthis.#content['onActionClick']();\n\t\t}\n\t}\n\n\t/**\n\t * Handler on member change.\n\t * @param {number} part\n\t */\n\tonMemberSelect(part: number)\n\t{\n\t\tthis.#memberPart = part;\n\t\tthis.assign();\n\t}\n\n\t/**\n\t * Sets/removes awaiting class to the block.\n\t * @param {boolean} flag\n\t */\n\tawait(flag: boolean)\n\t{\n\t\tconst blockLayouts = [];\n\n\t\tif (!this.#content.isSingleton())\n\t\t{\n\t\t\tblockLayouts.push(this.getLayout());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst currentCode = this.getCode();\n\n\t\t\tthis.#document.getBlocks().map(block => {\n\t\t\t\tif (block.getCode() === currentCode)\n\t\t\t\t{\n\t\t\t\t\tblockLayouts.push(block.getLayout());\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tblockLayouts.map((blockLayout, key) => {\n\t\t\tif (flag)\n\t\t\t{\n\t\t\t\tif (blockLayouts.length === key + 1)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(blockLayout, this.#style.blockLoading);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(blockLayout, this.#style.blockLoading);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Assigns block to the document (without saving).\n\t */\n\tassign()\n\t{\n\t\tconst blockLayout = this.getLayout();\n\t\tconst blocksData = [];\n\t\tconst blocksInstance = [];\n\n\t\tthis.await(true);\n\n\t\tif (!this.#content.isSingleton())\n\t\t{\n\t\t\tblocksData.push({\n\t\t\t\tcode: this.#code,\n\t\t\t\tpart: this.#memberPart,\n\t\t\t\tdata: this.getData()\n\t\t\t});\n\t\t\tblocksInstance.push(this);\n\t\t}\n\t\t// if block is a singleton push all blocks with same code\n\t\telse\n\t\t{\n\t\t\tthis.#document.getBlocks().map(block => {\n\t\t\t\tif (\n\t\t\t\t\tblock.getCode() === this.getCode() &&\n\t\t\t\t\tblock.getMemberPart() === this.getMemberPart()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tblocksData.push({\n\t\t\t\t\t\tcode: block.getCode(),\n\t\t\t\t\t\tpart: block.getMemberPart(),\n\t\t\t\t\t\tdata: block.getData()\n\t\t\t\t\t});\n\t\t\t\t\tblocksInstance.push(block);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tBackend.controller({\n\t\t\t\tcommand: 'blank.assignBlocks',\n\t\t\t\tpostData: {\n\t\t\t\t\tdocumentId: this.#document.getId(),\n\t\t\t\t\tblocksData\n\t\t\t\t},\n\t\t\t\tgetData: {\n\t\t\t\t\tcode: this.#code\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(result => {\n\n\t\t\t\tif (Type.isArray(result))\n\t\t\t\t{\n\t\t\t\t\tresult.map((block, i) => {\n\t\t\t\t\t\tblocksInstance[i].setData(block.data);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.await(false);\n\t\t\t\tthis.#document.showResizeArea(this);\n\t\t\t})\n\t\t\t.catch(result => {\n\t\t\t\tDom.remove(blockLayout);\n\t\t\t});\n\t}\n\n\t/**\n\t * Renders block within document's layout.\n\t */\n\trenderView()\n\t{\n\t\tconst contentTag = this.#layout.querySelector(this.#style.blockContent);\n\n\t\t// content\n\t\tDom.clean(contentTag);\n\n\t\tswitch (this.#code.toLowerCase())\n\t\t{\n\t\t\tcase 'stamp':\n\t\t\tcase 'mystamp':\n\t\t\tcase 'sign':\n\t\t\tcase 'mysign':\n\t\t\t\tDom.addClass(contentTag, '--image')\n\t\t}\n\n\t\tconst resizeNode = this.#content.getViewContent();\n\n\t\tDom.append(resizeNode, contentTag);\n\n\t\tDom.addClass(resizeNode, '--' + this.#code.toLowerCase());\n\n\t\tif (\n\t\t\tthis.#code.toLowerCase() === 'requisites'\n\t\t\t|| this.#code.toLowerCase() === 'myrequisites'\n\t\t\t|| this.#code.toLowerCase() === 'date'\n\t\t\t|| this.#code.toLowerCase() === 'number'\n\t\t\t|| this.#code.toLowerCase() === 'stamp'\n\t\t\t|| this.#code.toLowerCase() === 'mystamp'\n\t\t\t|| this.#code.toLowerCase() === 'sign'\n\t\t\t|| this.#code.toLowerCase() === 'mysign'\n\t\t\t|| this.#code.toLowerCase() === 'reference'\n\t\t\t|| this.#code.toLowerCase() === 'myreference'\n\t\t\t|| this.#code.toLowerCase() === 'text'\n\t\t)\n\t\t{\n\t\t\tresizeNode.style.setProperty('display', 'block');\n\t\t\tresizeNode.style.setProperty('overflow', 'hidden');\n\n\t\t\tif (!this.observerReady)\n\t\t\t{\n\t\t\t\tif (this.getStyle()['font-size'])\n\t\t\t\t{\n\t\t\t\t\tthis.maxTextSize = parseFloat(this.getStyle()['font-size']);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.maxTextSize = 14;\n\t\t\t\t}\n\n\t\t\t\tthis.isOverflownX = ({ clientHeight, scrollHeight }) => {\n\t\t\t\t\treturn scrollHeight > clientHeight;\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.subscribe(resizeNode.parentNode.parentNode, 'BX.Sign:setFontSize', (param)=> {\n\t\t\t\t\tif (param.data.fontSize)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.maxTextSize = param.data.fontSize;\n\t\t\t\t\t\tthis.resizeText({\n\t\t\t\t\t\t\telement: param.target.querySelector('.sign-document__block-content > div'),\n\t\t\t\t\t\t\tstep: 0.5\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.resizeText = ({ element, minSize = 1, step = 1, unit = 'px' }) => {\n\n\t\t\t\t\tif (this.intervalTextResize)\n\t\t\t\t\t{\n\t\t\t\t\t\tclearTimeout(this.intervalTextResize);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet i = minSize;\n\t\t\t\t\tlet overflow = false;\n\n\t\t\t\t\tconst parent = element.parentNode\n\n\t\t\t\t\twhile (!overflow && i < this.maxTextSize)\n\t\t\t\t\t{\n\t\t\t\t\t\telement.style.fontSize = `${i}${unit}`;\n\t\t\t\t\t\toverflow = this.isOverflownX(parent);\n\t\t\t\t\t\tif (!overflow)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ti += step;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.#currentFontSize = `${i - step}${unit}`;\n\t\t\t\t\telement.style.fontSize = this.#currentFontSize;\n\n\t\t\t\t\tthis.intervalTextResize = setTimeout(() => {\n\t\t\t\t\t\telement.parentNode.style.setProperty('font-size', element.style.fontSize);\n\t\t\t\t\t\telement.style.removeProperty('font-size', element.style.fontSize);\n\t\t\t\t\t\tthis.#stylePanel.updateFontSize(this.#currentFontSize);\n\t\t\t\t\t}, 1000);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tthis.#code.toLowerCase() === 'requisites'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'myrequisites'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'reference'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'myreference'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'text'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.resizeText({\n\t\t\t\t\t\telement: resizeNode,\n\t\t\t\t\t\tstep: 0.5\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.#content.subscribe(this.#content.events.onChange, this.#onContentChange.bind(this));\n\t\t\t\tthis.#content.subscribe(this.#content.events.onColorStyleChange, this.#onColorStyleChange.bind(this));\n\n\t\t\t\tthis.observerReady = true;\n\t\t\t}\n\n\t\t\tif (this.#firstRenderReady)\n\t\t\t{\n\t\t\t\tthis.resizeText({\n\t\t\t\t\telement: resizeNode,\n\t\t\t\t\tstep: 0.5\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.#firstRenderReady = true;\n\n\t\tif (this.#panelCreated)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// action / style panel\n\t\tconst panelTag = this.#layout.querySelector(this.#style.blockPanel);\n\t\tDom.clean(panelTag);\n\n\t\t// style\n\t\tif (this.#content.isStyleAllowed())\n\t\t{\n\t\t\tDom.append(this.#stylePanel.getLayout(), panelTag);\n\t\t}\n\n\t\t// action\n\t\tDom.append(this.#content.getActionButton(), panelTag);\n\n\t\t// block caption\n\t\tDom.append(this.#content.getBlockCaption(), panelTag);\n\n\t\t// member selector\n\t\tif (this.#allowMembers)\n\t\t{\n\t\t\tDom.append(UI.getMemberSelector(\n\t\t\t\tthis.#document.getMembers(),\n\t\t\t\tthis.#memberPart,\n\t\t\t\tthis.onMemberSelect.bind(this)\n\t\t\t), panelTag);\n\t\t}\n\n\t\tthis.#panelCreated = true;\n\t}\n\n\tgetCurrentFontSize()\n\t{\n\t\treturn this.#currentFontSize;\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t\tthis.#content.onStartChangePosition();\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#content.onPlaced();\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t\tthis.#content.onSave();\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t\tthis.#content.onRemove();\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tthis.#content.onClickOut();\n\t}\n\n\t/**\n\t * Set block styles to layout.\n\t */\n\trenderStyle()\n\t{\n\t\tthis.#stylePanel.applyStyles(\n\t\t\tthis.#layout.querySelector(this.#style.blockContent),\n\t\t);\n\t\tthis.#content.onStyleRender(this.#stylePanel.collectStyles());\n\t}\n\n\t/**\n\t * Adjust actions panel.\n\t */\n\tadjustActionsPanel()\n\t{\n\t\tconst blockLayout = this.getLayout();\n\t\tconst actionsPanel = blockLayout.querySelector('[data-role=\"sign-block__actions\"]');\n\n\t\tif (actionsPanel)\n\t\t{\n\t\t\tconst actionsPanelRect = actionsPanel.getBoundingClientRect();\n\t\t\tconst blockRect = blockLayout.getBoundingClientRect();\n\t\t\tconst a = actionsPanelRect.width;\n\t\t\tconst b = blockRect.width;\n\t\t\tconst detectBorder = (a-b) / 2;\n\n\t\t\tif (detectBorder > blockRect.left)\n\t\t\t{\n\t\t\t\tactionsPanel.style.marginLeft = detectBorder - 50 + 'px';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tactionsPanel.style.marginLeft = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Force saves the block.\n\t */\n\tforceSave()\n\t{\n\t\tthis.#layout.querySelector('[data-role=\"saveAction\"]').click();\n\t}\n\n\t/**\n\t * Creates layout for new block within document.\n\t */\n\t#createLayout()\n\t{\n\t\tthis.#layout = UI.getBlockLayout({\n\t\t\tonSave: (event) => {\n\t\t\t\tthis.renderView();\n\t\t\t\tthis.#document.unMuteResizeArea();\n\t\t\t\tthis.#document.hideResizeArea();\n\t\t\t\tthis.#document.setSavingMark(false);\n\t\t\t\tthis.onSave();\n\n\t\t\t\tDom.removeClass(this.#layout, this.#style.blockEditing);\n\n\t\t\t\tevent.stopPropagation();\n\t\t\t},\n\t\t\tonRemove: (event) => {\n\t\t\t\tif (this.#onRemoveCallback)\n\t\t\t\t{\n\t\t\t\t\tthis.#onRemoveCallback(this);\n\t\t\t\t}\n\t\t\t\tthis.#layout.hidden = true;\n\t\t\t\tthis.onRemove();\n\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t});\n\n\t\tconst nodeForPosition = document.body.querySelector('[data-role=\"sign-editor__content\"]');\n\t\tconst documentLayoutRect = this.#document.getLayout().getBoundingClientRect();\n\t\tconst blockInitDim = this.#content.getInitDimension();\n\t\tconst position = {\n\t\t\ttop: Math.min(nodeForPosition.scrollTop + nodeForPosition.offsetHeight / 2, documentLayoutRect.height - blockInitDim.height),\n\t\t\tleft: documentLayoutRect.width / 2 - 100\n\t\t};\n\n\t\tif (this.getDocument().inDeadZone(position.top, position.top + blockInitDim.height))\n\t\t{\n\t\t\tposition.top += blockInitDim.height + this.getDocument().getPagesGap();\n\t\t}\n\n\t\tthis.setPosition(position);\n\t}\n\n\t/**\n\t * Returns true, if block was removed.\n\t * @return {boolean}\n\t */\n\tisRemoved()\n\t{\n\t\treturn this.#layout.hidden === true;\n\t}\n\n\t#onContentChange(): void\n\t{\n\t\tconst content = this.#content;\n\t\tif (!(content instanceof Text))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.resizeText({ element: content.getContainer(), step: 0.5 });\n\t}\n\n\t#onColorStyleChange()\n\t{\n\t\tif (!(this.#content instanceof Sign || this.#content instanceof MySign))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst newSignColor = this.#content.getStyles()?.color;\n\t\tif (Type.isNil(newSignColor))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#document.getBlocks()\n\t\t\t.filter((block) => (block.#content instanceof Sign || block.#content instanceof MySign)\n\t\t\t\t&& block.getCode() === this.getCode())\n\t\t\t.forEach((block) => {\n\t\t\t\tif (block.#content instanceof BlockWithSynchronizableStyleColor)\n\t\t\t\t{\n\t\t\t\t\tblock.#content.updateColor(newSignColor);\n\t\t\t\t\tblock.#stylePanel.updateColor(newSignColor);\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t\tBlock.#signContentColor[this.getCode()] = newSignColor;\n\t}\n}\n","import { Dom, Event, Type } from 'main.core';\nimport { Draggable, DragMoveEvent, DragStartEvent, DragEndEvent } from 'ui.draganddrop.draggable';\nimport { EventEmitter } from 'main.core.events';\n\nimport Block from './block';\nimport UI from './ui';\n\ntype ResizeOptions = {\n\twrapperLayout: HTMLElement\n};\n\nexport default class Resize\n{\n\tstatic borderDelta = 2;\n\n\t#wrapperLayout: HTMLElement;\n\t#wrapperLayoutRect: DOMRect;\n\t#layout: HTMLElement;\n\t#fullEditorContent: HTMLElement;\n\t#linkedElement: HTMLElement;\n\t#linkedBlock: Block;\n\n\tposition: DOMRect;\n\tpositionLast: { ...DOMRect, notAddDeathMargin?: boolean };\n\tresizing: boolean;\n\tmoving: boolean;\n\n\t#style = {\n\t\tresizeContainer: '.sign-area-resizable-controls > div',\n\t\tmoveContainer: '.sign-document__resize-area',\n\t\tblockEditing: 'sign-document__block-wrapper-editing'\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {ResizeOptions} options\n\t */\n\tconstructor(options: ResizeOptions)\n\t{\n\t\tif (!Type.isDomNode(options.wrapperLayout))\n\t\t{\n\t\t\tthrow new Error('Option wrapperLayout is undefined or not valid DOM Element.');\n\t\t}\n\n\t\tthis.#layout = UI.getResizeArea();\n\t\tthis.#wrapperLayout = options.wrapperLayout;\n\t\tthis.#wrapperLayoutRect = this.#wrapperLayout.getBoundingClientRect();\n\t\tthis.#fullEditorContent = document.body.querySelector('[data-role=\"sign-editor__content\"]');\n\n\t\tEvent.bind(this.#layout, 'click', this.#onClick.bind(this));\n\t\t// Event.bind(window, 'resize', this.#onResize.bind(this)); // fix ticket 161618\n\n\t\tthis.#initResize();\n\t\tthis.#initMove();\n\t}\n\n\t/**\n\t * Returns layout of resizing area.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#layout;\n\t}\n\n\t/**\n\t * Shows resizing area over the element.\n\t * @param {Block} block\n\t */\n\tshow(block: Block)\n\t{\n\t\tif (this.#linkedBlock === block)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tconst pointRect = block.getLayout().getBoundingClientRect();\n\t\tthis.#layout.style.display = 'block';\n\n\t\tif (this.#linkedElement)\n\t\t{\n\t\t\tthis.#linkedElement.removeAttribute('data-active');\n\t\t}\n\t\tthis.#linkedBlock = block;\n\t\tthis.#linkedElement = block.getLayout();\n\t\tthis.#linkedElement.setAttribute('data-active', 1);\n\n\t\tUI.setRect(this.#layout, {\n\t\t\ttop: pointRect.top - this.#wrapperLayoutRect.top + this.#fullEditorContent.scrollTop,\n\t\t\tleft: pointRect.left - this.#wrapperLayoutRect.left,\n\t\t\twidth: pointRect.width + Resize.borderDelta,\n\t\t\theight: pointRect.height + Resize.borderDelta,\n\t\t});\n\t}\n\n\t/**\n\t * Hides resizing area.\n\t */\n\thide()\n\t{\n\t\tthis.#linkedBlock = null;\n\t\tthis.#layout.style.display = 'none';\n\n\t\tif (this.#linkedElement)\n\t\t{\n\t\t\tthis.#linkedElement.removeAttribute('data-active');\n\t\t}\n\t}\n\n\t/**\n\t * Returns linked block.\n\t * @return {Block|null}\n\t */\n\tgetLinkedBlock(): ?Block\n\t{\n\t\treturn this.#linkedBlock;\n\t}\n\n\t/**\n\t * On window resize.\n\t */\n\t#onResize()\n\t{\n\t\tthis.#wrapperLayoutRect = this.#wrapperLayout.getBoundingClientRect();\n\t}\n\n\t/**\n\t * On click handler (provide click to linked element).\n\t */\n\t#onClick(e)\n\t{\n\t\tif (this.moving || this.resizing)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#linkedBlock)\n\t\t{\n\t\t\tthis.#linkedBlock.fireAction();\n\t\t}\n\t}\n\n\t/**\n\t * Initializes resizing.\n\t */\n\t#initResize()\n\t{\n\t\tlet initialRect = null;\n\n\t\tconst draggable = new Draggable({\n\t\t\tcontainer: this.#wrapperLayout,\n\t\t\tdraggable: this.#style.resizeContainer,\n\t\t\ttype: BX.UI.DragAndDrop.Draggable.HEADLESS\n\t\t});\n\n\t\tthis.textResize = {\n\t\t\twrapper: null,\n\t\t\tcontent: null\n\t\t};\n\n\t\tdraggable\n\t\t\t.subscribe('start', (event: DragStartEvent) => {\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!this.textResize.wrapper || !this.textResize.content)\n\t\t\t\t{\n\t\t\t\t\tthis.textResize = {\n\t\t\t\t\t\twrapper: this.#linkedBlock.getLayout(),\n\t\t\t\t\t\tcontent: this.#linkedBlock.getLayout().querySelector('.sign-document__block-content')\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.emit('BX.Sign:resizeStart', draggable);\n\t\t\t\tinitialRect = this.#layout.getBoundingClientRect();\n\t\t\t\tthis.#linkedBlock.onStartChangePosition();\n\t\t\t\tthis.positionLast = null;\n\n\t\t\t\tDom.removeClass(this.#linkedBlock.getLayout(), this.#style.blockEditing);\n\t\t\t})\n\t\t\t.subscribe('end', (event: DragEndEvent) => {\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.resizing = false;\n\t\t\t\t}, 0);\n\n\t\t\t})\n\t\t\t.subscribe('move', (event) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.resizing = true;\n\n\t\t\t\tlet left = null;\n\t\t\t\tlet top = null;\n\t\t\t\tlet bottomResize = false;\n\t\t\t\tlet {width, height} = initialRect;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tconst areaRect = this.#layout.getBoundingClientRect();\n\t\t\t\tconst wrapperRect = this.#wrapperLayout.getBoundingClientRect();\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --left-top'))\n\t\t\t\t{\n\t\t\t\t\tleft = Math.max(0, initialRect.left + data.offsetX - this.#wrapperLayoutRect.left);\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - this.#wrapperLayoutRect.top + this.#fullEditorContent.scrollTop);\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-top'))\n\t\t\t\t{\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - this.#wrapperLayoutRect.top + this.#fullEditorContent.scrollTop);\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --right-top'))\n\t\t\t\t{\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - this.#wrapperLayoutRect.top + this.#fullEditorContent.scrollTop);\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-right'))\n\t\t\t\t{\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --right-bottom'))\n\t\t\t\t{\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-bottom'))\n\t\t\t\t{\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --left-bottom'))\n\t\t\t\t{\n\t\t\t\t\tleft = initialRect.left + data.offsetX - this.#wrapperLayoutRect.left;\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-left'))\n\t\t\t\t{\n\t\t\t\t\tleft = initialRect.left + data.offsetX - this.#wrapperLayoutRect.left;\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t}\n\n\t\t\t\tif (width < 60 || height < 20)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst newPosition = { width, height };\n\n\t\t\t\tif (newPosition['width'] + areaRect.left - wrapperRect.left > wrapperRect.width)\n\t\t\t\t{\n\t\t\t\t\twidth = newPosition['width'] = wrapperRect.width + wrapperRect.left - areaRect.left;\n\t\t\t\t}\n\n\t\t\t\tif (newPosition['height'] + areaRect.top - wrapperRect.top > wrapperRect.height)\n\t\t\t\t{\n\t\t\t\t\theight = newPosition['height'] = wrapperRect.height + wrapperRect.top - areaRect.top;\n\t\t\t\t}\n\n\t\t\t\tif (left)\n\t\t\t\t{\n\t\t\t\t\tif (left < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tleft = 0;\n\t\t\t\t\t}\n\t\t\t\t\tnewPosition['left'] = left;\n\t\t\t\t}\n\t\t\t\tif (top)\n\t\t\t\t{\n\t\t\t\t\tnewPosition['top'] = top;\n\t\t\t\t}\n\n\t\t\t\tlet calcDeathTop = initialRect.top + this.#fullEditorContent.scrollTop;\n\t\t\t\tlet notAddDeathMargin = true;\n\t\t\t\tif (newPosition.top)\n\t\t\t\t{\n\t\t\t\t\tcalcDeathTop = newPosition.top;\n\t\t\t\t\tnotAddDeathMargin = false;\n\t\t\t\t}\n\n\t\t\t\tif (this.#linkedBlock.getDocument().inDeadZone(calcDeathTop, calcDeathTop + newPosition.height, notAddDeathMargin))\n\t\t\t\t{\n\t\t\t\t\tif (!bottomResize)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.showNotAllowedArea();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst newPositionLinked = Object.assign({}, {\n\t\t\t\t\t...newPosition,\n\t\t\t\t\twidth: width - Resize.borderDelta,\n\t\t\t\t\theight: height - Resize.borderDelta,\n\t\t\t\t});\n\n\t\t\t\tUI.setRect(this.#layout, newPosition);\n\t\t\t\tUI.setRect(this.#linkedElement, newPositionLinked);\n\n\t\t\t\tthis.#linkedBlock.renderView();\n\t\t\t\tthis.#linkedBlock.getDocument().setSavingMark(false);\n\t\t\t\tthis.#linkedBlock.adjustActionsPanel();\n\t\t\t});\n\t}\n\n\t/**\n\t * Initializes moving.\n\t */\n\t#initMove()\n\t{\n\t\tconst dragArea = this.#wrapperLayout;\n\t\tlet widthInProcess;\n\n\t\tconst draggable = new Draggable({\n\t\t\tcontainer: dragArea,\n\t\t\tdraggable: this.#style.moveContainer,\n\t\t\ttype: Draggable.HEADLESS\n\t\t});\n\n\t\tdraggable\n\t\t\t.subscribe('start', (event: DragStartEvent) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.emit('BX.Sign:moveStart', draggable);\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst {source} = event.getData();\n\t\t\t\tthis.position = Dom.getPosition(source);\n\t\t\t\tthis.#linkedBlock.onStartChangePosition();\n\t\t\t\tthis.positionLast = null;\n\n\t\t\t\tDom.removeClass(this.#linkedBlock.getLayout(), this.#style.blockEditing);\n\t\t\t})\n\t\t\t.subscribe('end', (event: DragEndEvent) => {\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.moving = false;\n\t\t\t\t}, 0);\n\n\t\t\t\tif (!this.#linkedBlock)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twidthInProcess = null;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tlet moveTopDelta = null;\n\t\t\t\tif (this.positionLast)\n\t\t\t\t{\n\t\t\t\t\tmoveTopDelta = this.#linkedBlock.getDocument().inDeadZone(this.positionLast.top, this.positionLast.top + this.positionLast.height);\n\t\t\t\t}\n\n\t\t\t\tthis.#linkedBlock.hideNotAllowedArea();\n\n\t\t\t\tif (moveTopDelta)\n\t\t\t\t{\n\t\t\t\t\tUI.setRect(data.source, {top: this.positionLast.top + moveTopDelta});\n\t\t\t\t\tUI.setRect(this.#linkedElement, {top: this.positionLast.top + moveTopDelta});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('move', (event: DragMoveEvent) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.moving = true;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tconst {source, offsetY, offsetX} = data;\n\t\t\t\tconst areaRect = data.source.getBoundingClientRect();\n\t\t\t\tconst wrapperRect = this.#wrapperLayout.getBoundingClientRect();\n\n\t\t\t\tif (this.position)\n\t\t\t\t{\n\t\t\t\t\tconst newPosition = {\n\t\t\t\t\t\ttop: offsetY - this.#wrapperLayoutRect.top + this.position.y + this.#fullEditorContent.scrollTop,\n\t\t\t\t\t\tleft: offsetX - this.#wrapperLayoutRect.left + this.position.x,\n\t\t\t\t\t\twidth: widthInProcess ? widthInProcess : this.position.width,\n\t\t\t\t\t\theight: this.position.height\n\t\t\t\t\t};\n\n\t\t\t\t\tif (newPosition.left < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.left = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.top < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.top = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.top + areaRect.height > wrapperRect.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.top = wrapperRect.height - areaRect.height;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.left + areaRect.width > wrapperRect.width)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.renderView();\n\t\t\t\t\t\tif (wrapperRect.width - newPosition.left > 50)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twidthInProcess = newPosition.width = wrapperRect.width - newPosition.left;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnewPosition.left = wrapperRect.width - areaRect.width;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.positionLast = Object.assign({}, newPosition);\n\n\t\t\t\t\tlet moveTopDelta = null;\n\n\t\t\t\t\tif (this.positionLast)\n\t\t\t\t\t{\n\t\t\t\t\t\tmoveTopDelta = this.#linkedBlock.getDocument().inDeadZone(this.positionLast.top, this.positionLast.top + this.positionLast.height);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (moveTopDelta > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.showNotAllowedArea();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.hideNotAllowedArea();\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newPositionLinked = Object.assign({}, {\n\t\t\t\t\t\t...newPosition,\n\t\t\t\t\t\twidth: newPosition.width - Resize.borderDelta,\n\t\t\t\t\t\theight: newPosition.height - Resize.borderDelta,\n\t\t\t\t\t});\n\n\t\t\t\t\tUI.setRect(source, newPosition);\n\t\t\t\t\tUI.setRect(this.#linkedElement, newPositionLinked);\n\n\t\t\t\t\tthis.#linkedBlock.getDocument().setSavingMark(false);\n\t\t\t\t\tthis.#linkedBlock.adjustActionsPanel();\n\t\t\t\t}\n\t\t\t});\n\t}\n}\n","import {Dom, Event, Loc, Type, Tag, ajax} from 'main.core';\nimport { Backend } from 'sign.backend';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { Popup } from 'main.popup';\nimport { ProgressRound, ProgressRoundStatus } from 'ui.progressround';\nimport { Loader } from 'main.loader';\n\nimport Block from './block';\nimport Resize from './resize';\nimport { BlockItem, Config, DocumentOptions, MemberItem, PositionType } from './types/document';\nimport {Button, ButtonColor} from \"ui.buttons\";\nimport { Guide } from \"sign.tour\";\nimport \"ui.info-helper\";\nimport \"spotlight\";\n\nexport class Document\n{\n\tstatic alreadyInit = false;\n\tstatic marginTop = 0;\n\tstatic gapBetweenPages = 20;\n\n\t#documentId: number;\n\t#companyId: number;\n\t#initiatorName: string;\n\t#entityId: number;\n\t#blankId: number;\n\t#pagesMinHeight: number = 0;\n\t#disableEdit: boolean;\n\t#closeDemoContent: boolean = false;\n\t#members: Array<MemberItem>;\n\t#documentLayout: HTMLElement;\n\t#documentLayoutRect: DOMRect;\n\t#resizeArea: Resize;\n\t#blocks: Array<Block> = [];\n\t#pagesRects: Array<DOMRect> = [];\n\t#seams: Array<Array<number, number>> = [];\n\t#config: Config;\n\n\t#helpBtnElementId = 'sign-editor-help-btn';\n\t#helpBtnHelperArticleCode = '16571388';\n\n\t/**\n\t * Constructor.\n\t * @param {DocumentOptions} options\n\t */\n\tconstructor(options: DocumentOptions)\n\t{\n\t\tif (Document.alreadyInit)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isDomNode(options.documentLayout))\n\t\t{\n\t\t\tthrow new Error('Option documentLayout is undefined or not valid DOM Element.');\n\t\t}\n\n\t\tDocument.alreadyInit = true;\n\t\tthis.#documentId = options.documentId;\n\t\tthis.#companyId = options.companyId;\n\t\tthis.#initiatorName = options.initiatorName;\n\t\tthis.#entityId = options.entityId;\n\t\tthis.#blankId = options.blankId;\n\t\tthis.#documentLayout = options.documentLayout;\n\t\tthis.#documentLayoutRect = this.#documentLayout.getBoundingClientRect();\n\t\tthis.#disableEdit = options.disableEdit;\n\t\tthis.#config = options.config;\n\t\tthis.#members = options.members.filter(member => member.cid !== 0);\n\t\tthis.#initPagesRect();\n\n\t\tif (!this.#disableEdit)\n\t\t{\n\t\t\tthis.#resizeArea = new Resize({ wrapperLayout: this.#documentLayout });\n\t\t\tDom.append(this.#resizeArea.getLayout(), this.#documentLayout);\n\t\t}\n\n\t\tif (options.repositoryItems && !this.#disableEdit)\n\t\t{\n\t\t\tthis.#initRepository(options.repositoryItems);\n\t\t}\n\n\t\tif (options.blocks)\n\t\t{\n\t\t\tthis.#initBlocks(options.blocks);\n\t\t}\n\n\t\tif (options.saveButton)\n\t\t{\n\t\t\tthis.onSave(options);\n\t\t}\n\n\t\tthis.onCloseSlider();\n\n\t\tEvent.bind(document.body, 'click', (event) => {\n\t\t\tif (event.target.getAttribute('data-role'))\n\t\t\t{\n\t\t\t\tif (this.#resizeArea)\n\t\t\t\t{\n\t\t\t\t\tconst activeBlock = this.#resizeArea.getLinkedBlock();\n\t\t\t\t\tif (activeBlock)\n\t\t\t\t\t{\n\t\t\t\t\t\tactiveBlock.onClickOut();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (options.closeDemoContent)\n\t\t{\n\t\t\tEvent.bind(options.closeDemoContent, 'click', (event) => {\n\t\t\t\tthis.#closeDemoContent = true;\n\t\t\t});\n\t\t}\n\n\t\tEvent.bind(document.getElementById(this.#helpBtnElementId), 'click', (event: PointerEvent) => {\n\t\t\ttop.BX.Helper.show(\"redirect=detail&code=\" + this.#helpBtnHelperArticleCode);\n\t\t\tevent.preventDefault();\n\t\t});\n\n\t\tif (this.#disableEdit)\n\t\t{\n\t\t\tthis.#startDisabledEditDocumentTour();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#startEditDocumentTour();\n\t\t}\n\t}\n\n\t/**\n\t * Detects pages rect.\n\t */\n\t#initPagesRect()\n\t{\n\t\tlet top = 0;\n\n\t\t[...this.#documentLayout.querySelectorAll('[data-page] img')].map(page => {\n\t\t\tconst pageRect = page.getBoundingClientRect();\n\t\t\tconst pageRectToMath = {};\n\n\t\t\t// round getBoundingClientRect\n\t\t\tfor (let pageRectKey in pageRect)\n\t\t\t{\n\t\t\t\tif (Type.isNumber(pageRect[pageRectKey]))\n\t\t\t\t{\n\t\t\t\t\tpageRectToMath[pageRectKey] = Math.round(pageRect[pageRectKey]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpageRectToMath[pageRectKey] = pageRect[pageRectKey];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// collect seam's gaps\n\t\t\tthis.#seams.push([(top === 0) ? 0 : pageRectToMath.top - Document.gapBetweenPages, pageRectToMath.top + Document.marginTop]);\n\n\t\t\t// correct top after rounding\n\t\t\tif (top === 0)\n\t\t\t{\n\t\t\t\ttop = pageRectToMath.top;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttop += Document.gapBetweenPages;\n\t\t\t\tpageRectToMath.top = top;\n\t\t\t}\n\n\t\t\t// collect pages rects\n\t\t\tthis.#pagesRects.push(pageRectToMath);\n\n\t\t\t// remember min page height\n\t\t\tif (!this.#pagesMinHeight || pageRect.height < this.#pagesMinHeight)\n\t\t\t{\n\t\t\t\tthis.#pagesMinHeight = pageRect.height;\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Returns absolute top by relative top and page number.\n\t * @param {number} top\n\t * @param {number} page\n\t * @return {number}\n\t */\n\t#relativeToAbsolute(top: number, page: number): number\n\t{\n\t\tfor (let i = 0; i < page - 1; i++)\n\t\t{\n\t\t\ttop += this.#pagesRects[i].height;\n\t\t}\n\n\t\treturn top;\n\t}\n\n\t/**\n\t * Transfers absolute position to page position and sets page number.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\ttransferPositionToPage(position: PositionType): PositionType\n\t{\n\t\tposition.page = 1;\n\n\t\tfor (let i = 0, c = this.#pagesRects.length; i < c; i++)\n\t\t{\n\t\t\tconst height = this.#pagesRects[i].height;\n\n\t\t\tif (i !== 0) // skip gap for first page\n\t\t\t{\n\t\t\t\tposition.top -= Document.gapBetweenPages;\n\t\t\t}\n\n\t\t\tposition.top -= height;\n\t\t\tif (position.top < 0)\n\t\t\t{\n\t\t\t\tposition.top += height;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tposition.page++;\n\t\t\t}\n\t\t}\n\n\t\treturn position;\n\t}\n\n\t/**\n\t * Transfers pixel of position to percent.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\t#pixelToPercent(position: PositionType): PositionType\n\t{\n\t\tif (!position.page || typeof this.#pagesRects[position.page - 1] === 'undefined')\n\t\t{\n\t\t\treturn position;\n\t\t}\n\n\t\tconst pageImageRect = this.#pagesRects[position.page - 1];\n\n\t\tposition.widthPx = position.width;\n\t\tposition.heightPx = position.height;\n\t\tposition.left = position.left / pageImageRect.width * 100;\n\t\tposition.top = position.top / pageImageRect.height * 100;\n\t\tposition.width = position.width / pageImageRect.width * 100;\n\t\tposition.height = position.height / pageImageRect.height * 100;\n\n\t\treturn position;\n\t}\n\n\t/**\n\t * Transfers percent of position to pixel.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\t#percentToPixel(position: PositionType): PositionType\n\t{\n\t\tif (!position.page || typeof this.#pagesRects[position.page - 1] === 'undefined')\n\t\t{\n\t\t\treturn position;\n\t\t}\n\n\t\tconst pageImageRect = this.#pagesRects[position.page - 1];\n\n\t\tif (position.left)\n\t\t{\n\t\t\tposition.left = position.left * pageImageRect.width / 100;\n\t\t}\n\t\tif (position.top)\n\t\t{\n\t\t\tposition.top = position.top * pageImageRect.height / 100;\n\t\t}\n\t\tif (position.width)\n\t\t{\n\t\t\tposition.width = position.width * pageImageRect.width / 100;\n\t\t}\n\t\tif (position.height)\n\t\t{\n\t\t\tposition.height = position.height * pageImageRect.height / 100;\n\t\t}\n\n\t\treturn position;\n\t}\n\n\t/**\n\t * Returns minimal pages height.\n\t * @return {number}\n\t */\n\tgetMinPageHeight(): number\n\t{\n\t\treturn this.#pagesMinHeight - Document.marginTop;\n\t}\n\n\t/**\n\t * Returns document id.\n\t * @return {number}\n\t */\n\tgetId(): number\n\t{\n\t\treturn this.#documentId;\n\t}\n\n\t/**\n\t * Returns document entity id.\n\t * @return {number}\n\t */\n\tgetEntityId(): number\n\t{\n\t\treturn this.#entityId;\n\t}\n\n\t/**\n\t * Returns document's layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#documentLayout;\n\t}\n\n\t/**\n\t * Returns number pairs (seams between pages).\n\t * @return {Array<Array<number, number>>}\n\t */\n\tgetSeams(): Array<Array<number, number>>\n\t{\n\t\treturn this.#seams;\n\t}\n\n\t/**\n\t * Returns gap between pages.\n\t * @return {number}\n\t */\n\tgetPagesGap(): number\n\t{\n\t\treturn Document.gapBetweenPages + Document.marginTop;\n\t}\n\n\t/**\n\t * Returns document's members\n\t * @return {Array<MemberItem>}\n\t */\n\tgetMembers(): Array<MemberItem>\n\t{\n\t\treturn this.#members;\n\t}\n\n\t/**\n\t * Returns member item by member part.\n\t * @param {number} part\n\t * @return {null}\n\t */\n\tgetMemberByPart(part: number): ?MemberItem\n\t{\n\t\tlet returnMember = null;\n\n\t\tthis.#members.map((member: MemberItem) => {\n\t\t\tif (member.part === part)\n\t\t\t{\n\t\t\t\treturnMember = member;\n\t\t\t}\n\t\t});\n\n\t\treturn returnMember;\n\t}\n\n\t/**\n\t * Returns company id.\n\t * @return {number}\n\t */\n\tgetCompanyId(): number\n\t{\n\t\treturn this.#companyId;\n\t}\n\n\t/**\n\t * @return {string}\n\t */\n\tgetInitiatorName(): string\n\t{\n\t\treturn this.#initiatorName;\n\t}\n\n\t/**\n\t * Returns Config object.\n\t * @return {Config}\n\t */\n\tgetConfig(): Config\n\t{\n\t\treturn this.#config;\n\t}\n\n\t/**\n\t * Hides resizing area.\n\t */\n\thideResizeArea()\n\t{\n\t\tthis.#resizeArea.hide();\n\t}\n\n\t/**\n\t * Shows resizing area over the block.\n\t * @param {Block} block\n\t */\n\tshowResizeArea(block: Block)\n\t{\n\t\tthis.#resizeArea.show(block);\n\t}\n\n\t/**\n\t * Mutes resizing area.\n\t */\n\tmuteResizeArea()\n\t{\n\t\tthis.#resizeArea.getLayout().setAttribute('data-disable', 1);\n\t}\n\n\t/**\n\t * Unmutes resizing area.\n\t */\n\tunMuteResizeArea()\n\t{\n\t\tthis.#resizeArea.getLayout().removeAttribute('data-disable');\n\t}\n\n\t/**\n\t * Adds block to the document.\n\t * @param {BlockItem} data Block data.\n\t * @param {boolean} seamShift If true, will be added seam shift to top's position.\n\t * @return {Block}\n\t */\n\t#addBlock(data: BlockItem, seamShift: boolean): Block\n\t{\n\t\tif (data.position)\n\t\t{\n\t\t\tdata.position = this.#percentToPixel(data.position);\n\n\t\t\tif (!data.style['font-size'])\n\t\t\t{\n\t\t\t\tdata.style['font-size'] = '14px';\n\t\t\t}\n\n\t\t\tif (data?.position['page'] && data?.position['top'])\n\t\t\t{\n\t\t\t\tdata.position['top'] = this.#relativeToAbsolute(\n\t\t\t\t\tparseFloat(data.position['top']),\n\t\t\t\t\tparseFloat(data.position['page'])\n\t\t\t\t);\n\n\t\t\t\tif (seamShift)\n\t\t\t\t{\n\t\t\t\t\tdata.position.top += (data.position.page - 1) * Document.gapBetweenPages;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst block = new Block({\n\t\t\tid: data.id,\n\t\t\tcode: data.code,\n\t\t\tpart: data.part,\n\t\t\tdocument: this,\n\t\t\tdata: data.data,\n\t\t\tposition: data.position,\n\t\t\tstyle: data.style,\n\t\t\tonClick: (block: Block) => {\n\t\t\t\tif (this.#disableEdit)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.#resizeArea.show(block);\n\t\t\t\tthis.unMuteResizeArea();\n\t\t\t\tblock.adjustActionsPanel();\n\t\t\t},\n\t\t\tonRemove: (block: Block) => {\n\t\t\t\tthis.#resizeArea.hide();\n\t\t\t}\n\t\t});\n\t\tconst blockLayout = block.getLayout();\n\n\t\tthis.#blocks.push(block);\n\t\tDom.append(blockLayout, this.#documentLayout);\n\n\t\treturn block;\n\t}\n\n\t/**\n\t * Fires on click repository item.\n\t * @param {string} code Block code.\n\t * @param {string} part Member part (base - my company, other - third part).\n\t */\n\t#onRepositoryItemClick(code: string, part: number)\n\t{\n\t\tpart = parseInt(part);\n\t\tthis.setSavingMark(false);\n\n\t\tconst block = this.#addBlock({ code, part });\n\t\tblock.assign();\n\t\tblock.onPlaced();\n\t}\n\n\t/**\n\t * Sets exists blocks to the document.\n\t * @param blocks\n\t */\n\t#initBlocks(blocks: Array<BlockItem>)\n\t{\n\t\tblocks.map(block => this.#addBlock(block, true));\n\t}\n\n\t/**\n\t * Initializes the repository from specified html area with data-attributes.\n\t * data-code=\"*\" - block's code\n\t * data-action=\"add\" - button to add block to the layout\n\t * @param {NodeList} repositoryItems\n\t */\n\t#initRepository(repositoryItems: NodeList)\n\t{\n\t\t[...repositoryItems].map((item: HTMLElement) => {\n\n\t\t\tconst code = item.getAttribute('data-code');\n\t\t\tconst part = item.getAttribute('data-part');\n\n\t\t\tEvent.bind(item, 'click', e => {\n\t\t\t\tthis.#onRepositoryItemClick(code, part);\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Returns blocks collection.\n\t * @return {Array<Block>}\n\t */\n\tgetBlocks(): Array<Block>\n\t{\n\t\treturn this.#blocks;\n\t}\n\n\t/**\n\t * Saves document and closes slider.\n\t * @return {Promise}\n\t */\n\tsave(): Promise<any, any>\n\t{\n\t\tconst postData = [];\n\n\t\tconst realDocumentWidth = document.querySelector('[data-type=\"document-layout\"]').offsetWidth;\n\n\t\tthis.#blocks.map(block => {\n\n\t\t\tif (block.isRemoved())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet position = block.getPosition();\n\n\t\t\tposition = this.transferPositionToPage(position);\n\t\t\tposition = this.#pixelToPercent(position);\n\t\t\tposition.realDocumentWidthPx = realDocumentWidth ? realDocumentWidth : null;\n\n\t\t\tpostData.push({\n\t\t\t\tid: block.getId(),\n\t\t\t\tcode: block.getCode(),\n\t\t\t\tdata: block.getData(),\n\t\t\t\tpart: block.getMemberPart(),\n\t\t\t\tstyle: block.getStyle(),\n\t\t\t\tposition\n\t\t\t});\n\t\t});\n\n\t\tconst params = {};\n\t\tif (this.#closeDemoContent)\n\t\t{\n\t\t\tparams['closeDemoContent'] = true;\n\t\t}\n\n\n\t\treturn Backend.controller({\n\t\t\t\tcommand: 'blank.save',\n\t\t\t\tpostData: {\n\t\t\t\t\tdocumentId: this.#documentId,\n\t\t\t\t\tblocks: postData.length > 0 ? postData : [],\n\t\t\t\t\tparams\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) =>\n\t\t\t{\n\t\t\t\tif (response.errors[0]?.customData?.field === 'requisites')\n\t\t\t\t{\n\t\t\t\t\tconst popup = new Popup({\n\t\t\t\t\t\tid: 'sign_document_error_popup',\n\t\t\t\t\t\ttitleBar: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE_TITLE'),\n\t\t\t\t\t\tcontent: BX.util.htmlspecialchars(response.errors[0]?.message),\n\t\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE'),\n\t\t\t\t\t\t\t\tcolor: ButtonColor.SUCCESS,\n\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\tBackend.controller({\n\t\t\t\t\t\t\t\t\t\tcommand: 'document.restoreRequisiteFields',\n\t\t\t\t\t\t\t\t\t\tpostData: {\n\t\t\t\t\t\t\t\t\t\t\tdocumentId: this.#documentId,\n\t\t\t\t\t\t\t\t\t\t\tpresetId: response.errors[0]?.customData.presetId,\n\t\t\t\t\t\t\t\t\t\t\tcode: response.errors[0]?.customData.code\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\t\t\t\t\tthis.#blocks.map(block => {\n\t\t\t\t\t\t\t\t\t\t\tif (block.isRemoved())\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tif (block.getCode() === response.errors[0]?.customData.code)\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tblock.assign();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t\t\t}).catch(() => {\n\t\t\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE_BY_HANDS'),\n\t\t\t\t\t\t\t\tcolor: ButtonColor.INFO,\n\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\tthis.#blocks.map(block => {\n\t\t\t\t\t\t\t\t\t\tif (block.isRemoved())\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (block.getCode() === response.errors[0]?.customData.code)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tconst blockActionButton = document.querySelector('button[data-id=\"action-'+block.getCode()+'\"]');\n\n\t\t\t\t\t\t\t\t\t\t\tif (blockActionButton)\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tblockActionButton.click();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tpopup.show();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t/**\n\t * Registers save button.\n\t * @param {DocumentOptions} options\n\t */\n\tonSave(options: DocumentOptions)\n\t{\n\t\tEvent.bind(options.saveButton, 'click', (e) => {\n\t\t\tif (this.#disableEdit)\n\t\t\t{\n\t\t\t\tif (options.afterSaveCallback)\n\t\t\t\t{\n\t\t\t\t\toptions.afterSaveCallback();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.save()\n\t\t\t\t.then(result => {\n\t\t\t\t\t//todo: we need to parse response and sets id for each new block\n\t\t\t\t\tif (result === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setSavingMark(true);\n\n\t\t\t\t\t\tif (options.afterSaveCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toptions.afterSaveCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (result !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (options.saveErrorCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toptions.saveErrorCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t});\n\t}\n\n\t/**\n\t * Registers callback on slider close.\n\t */\n\tonCloseSlider()\n\t{\n\t\tBX.addCustomEvent('SidePanel.Slider:onClose', (event) => {\n\t\t\tif (event.slider.url.indexOf('/sign/edit/') === 0)\n\t\t\t{\n\t\t\t\tif (!this.everythingIsSaved())\n\t\t\t\t{\n\t\t\t\t\tevent.denyAction();\n\n\t\t\t\t\tMessageBox.confirm(\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_MESSAGE'),\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_TITLE'),\n\t\t\t\t\t\t(messageBox: MessageBox) => {\n\t\t\t\t\t\t\tthis.setSavingMark(true);\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t\tevent.slider.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_APPLY'),\n\t\t\t\t\t\t(messageBox: MessageBox) => {\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Sets mark to document that everything was saved or not.\n\t * @param {boolean} mark\n\t */\n\tsetSavingMark(mark: boolean)\n\t{\n\t\tthis.setParam('bxSignEditorAllSaved', mark);\n\t}\n\n\t/**\n\t * Returns true, if everything was saved within editor.\n\t * @return {boolean}\n\t */\n\teverythingIsSaved(): boolean\n\t{\n\t\treturn this.getParam('bxSignEditorAllSaved') === true;\n\t}\n\n\tsetParam(name: string, value: any): void\n\t{\n\t\tconst slider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (slider)\n\t\t{\n\t\t\tslider.getData().set(name, value);\n\t\t}\n\t}\n\n\tgetParam(name: string): any\n\t{\n\t\tconst slider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (slider)\n\t\t{\n\t\t\treturn slider.getData().get(name);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\t/**\n\t * Returns true if element with specified top & bottom over dead zone.\n\t * @param {number} top\n\t * @param {number} bottom\n\t * @param {boolean} notAddMargin\n\t * @return {boolean}\n\t */\n\tinDeadZone(top: number, bottom: number, notAddMargin: boolean): boolean\n\t{\n\t\tconst seams = this.getSeams();\n\n\t\tif (seams.length > 0 && notAddMargin !== true)\n\t\t{\n\t\t\ttop += this.#documentLayoutRect.top;\n\t\t\tbottom += this.#documentLayoutRect.top;\n\t\t}\n\n\t\tfor (let ii = 0, cc = seams.length; ii < cc; ii++)\n\t\t{\n\t\t\tconst seam = seams[ii];\n\n\t\t\t// top on page, bottom on seam\n\t\t\tif (top <= seam[0] && bottom >= seam[0] && bottom <= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// top on one page, bottom on another (seam in a middle)\n\t\t\tif (top <= seam[0] && bottom >= seam[1])\n\t\t\t{\n\t\t\t\t//seam[0] - bottom >> shift top\n\t\t\t\t//seam[1] - top >> shift bottom\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// block into a seam\n\t\t\tif (top >= seam[0] && bottom <= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// top on seam, bottom on page\n\t\t\tif (top >= seam[0] && top <= seam[1] && bottom >= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[1] - top;\n\t\t\t}\n\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\t#startDisabledEditDocumentTour()\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById('sign-editor-btn-edit'),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_EDIT_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_EDIT_TEXT'),\n\t\t\t\t},\n\t\t\t],\n\t\t\tid: 'sign-tour-guide-onboarding-master-document-edit-disabled',\n\t\t\tautoSave: true,\n\t\t\tsimpleMode: true,\n\t\t});\n\t\tguide.startOnce();\n\t}\n\n\t#startEditDocumentTour()\n\t{\n\t\tconst helpBtnSpotlight = new BX.SpotLight({\n\t\t\ttargetElement: document.getElementById(this.#helpBtnElementId),\n\t\t\ttargetVertex: 'middle-center',\n\t\t\tautoSave: true,\n\t\t\tid: 'sign-spotlight-onboarding-master-document-edit',\n\t\t});\n\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById('sign-editor-bar-content'),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_BLOCKS_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_BLOCKS_TEXT'),\n\t\t\t\t\tposition: 'left',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById(this.#helpBtnElementId),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_HELP_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_HELP_TEXT'),\n\t\t\t\t\trounded: true,\n\t\t\t\t\tarticle: this.#helpBtnHelperArticleCode,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonShow: () => helpBtnSpotlight.show(),\n\t\t\t\t\t\tonClose: () => helpBtnSpotlight.close(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tid: 'sign-tour-guide-onboarding-master-document-edit',\n\t\t\tautoSave: true,\n\t\t\tsimpleMode: true,\n\t\t});\n\t\tguide.startOnce();\n\t}\n}\n\nexport class DocumentMasterLoader\n{\n\t#totalImages: number;\n\t#progressRound: ProgressRound;\n\t#layout: {\n\t\toverlay: HTMLElement;\n\t\ttitle: HTMLElement;\n\t\terror: HTMLElement;\n\t\tloader: HTMLElement;\n\t};\n\t#loader: Loader\n\n\tconstructor({ totalImages })\n\t{\n\t\tthis.#totalImages = totalImages || null;\n\t\tthis.#progressRound = null;\n\t\tthis.#layout = {\n\t\t\toverlay: null,\n\t\t\ttitle: null,\n\t\t\terror: null,\n\t\t\tloader: null\n\t\t}\n\t\tthis.#loader = null;\n\t}\n\n\t#getProgress()\n\t{\n\t\tif (!this.#progressRound)\n\t\t{\n\t\t\tthis.#progressRound = new ProgressRound({\n\t\t\t\tcolorBar: '#1ec6fa',\n\t\t\t\tcolorTrack: '#fff',\n\t\t\t\tstatusType: ProgressRoundStatus\n\t\t\t\t\t? ProgressRoundStatus.INCIRCLECOUNTER\n\t\t\t\t\t: BX.UI.ProgressRound.Status.INCIRCLECOUNTER,\n\t\t\t\tmaxValue: this.#totalImages\n\t\t\t});\n\t\t}\n\n\t\treturn this.#progressRound;\n\t}\n\n\t#getLoader()\n\t{\n\t\tif (!this.#loader)\n\t\t{\n\t\t\tthis.#loader = new Loader({\n\t\t\t\tsize: 100,\n\t\t\t\tcolor: '#1ec6fa'\n\t\t\t});\n\t\t}\n\n\t\treturn this.#loader;\n\t}\n\n\t#getOverlay()\n\t{\n\t\tif (!this.#layout.overlay)\n\t\t{\n\t\t\tthis.#layout.overlay = Tag.render`\n\t\t\t\t<div class=\"sign-document__master-loader-overlay\">\n\t\t\t\t\t${this.#getTitle()}\n\t\t\t\t\t${this.#getLoaderWrapper()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.overlay;\n\t}\n\n\t#getLoaderWrapper()\n\t{\n\t\tif (!this.#layout.loader)\n\t\t{\n\t\t\tthis.#layout.loader = Tag.render`\n\t\t\t\t<div class=\"sign-document__master-loader-container\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.loader;\n\t}\n\n\t#getTitle()\n\t{\n\t\tif (!this.#layout.title)\n\t\t{\n\t\t\tthis.#layout.title = Tag.render`\n\t\t\t\t<div class=\"sign-document__master-loader-title\">${Loc.getMessage('SIGN_JS_DOCUMENT_LOADING_DOCUMENT_PAGES')}</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.title;\n\t}\n\n\tupdateLoadPage(param: Number)\n\t{\n\t\tif (Type.isNumber(param))\n\t\t{\n\t\t\tthis.#getProgress().update(param);\n\t\t}\n\t}\n\n\tshowError(message: string)\n\t{\n\t\tDom.remove(this.#getLoaderWrapper());\n\t\tthis.#getLoader().destroy();\n\t\tthis.#getTitle().innerHTML = message || Loc.getMessage('SIGN_JS_DOCUMENT_LOAD_ERROR');\n\t\tconst linkReload = this.#getTitle().getElementsByTagName('span')[0];\n\t\tif (linkReload)\n\t\t{\n\t\t\tlinkReload.addEventListener('click', () => {\n\t\t\t\tdocument.location.reload();\n\t\t\t});\n\t\t}\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.#totalImages)\n\t\t{\n\t\t\tconsole.warn('BX.Sign.DocumentMasterLoader: totalImages is not defined');\n\t\t\treturn;\n\t\t}\n\n\t\tDom.append(this.#getOverlay(), document.body);\n\n\t\tif (this.#totalImages > 1)\n\t\t{\n\t\t\tthis.#getProgress().renderTo(this.#getLoaderWrapper());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#getLoader().show(this.#getLoaderWrapper());\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tthis.#getOverlay().addEventListener('animationend', () => {\n\t\t\tDom.remove(this.#getOverlay());\n\t\t\tthis.#getLoader().destroy();\n\t\t\tthis.#totalImages = null;\n\t\t\tthis.#progressRound = null;\n\t\t\tthis.#layout = {\n\t\t\t\toverlay: null,\n\t\t\t\ttitle: null,\n\t\t\t\terror: null,\n\t\t\t\tloader: null\n\t\t\t}\n\t\t\tthis.#loader = null;\n\t\t});\n\n\t\tDom.addClass(this.#getOverlay(), '--hide');\n\t}\n}\n"],"names":["Dummy","block","onChange","onColorStyleChange","setEventNamespace","data","text","setData","width","height","base64","Tag","render","TextFormat","encode","toString","replaceAll","forceSave","emit","events","styles","EventEmitter","padding","BlockWithSynchronizableStyleColor","color","Date","BX","calendar","node","getLayout","field","getViewContent","value","bTime","callback_after","date","setText","format","convertBitrixFormat","message","renderView","onActionClick","bind","Loc","getMessage","defaultTextBlockPaddingStyles","Close","MyRequisites","_classPrivateMethodInitSpec","_classPrivateMethodGet","getCode","event","document","getDocument","config","getConfig","stopPropagation","FieldsetViewer","entityTypeId","crmOwnerTypeCompany","entityId","getCompanyId","onClose","assign","fieldListEditorOptions","fieldsPanelOptions","filter","presetId","crmRequisiteCompanyPresetId","controllerOptions","hideVirtual","hideRequisites","hideSmartDocument","show","ColorPicker","Reflection","getClass","UI","element","rect","Object","keys","map","key","parseInt","Dom","style","options","onRemove","onSave","members","selectedValue","menuItems","selectedName","member","name","part","memberSelector","length","SignUI","bindSimpleMenu","bindElement","items","actionHandler","innerHTML","collectStyles","fonts","fontFamily","fontSizereal","fontSizeValue","fontSize","currentValue","getColorSelectorBtn","fontColor","layout","defaultColorPickerColor","onColorSelect","colorPickerOptions","updateColorSelectorBtnColor","updatedColorPickerOptions","onColorSelected","picker","Event","open","colorPicker","circleColor","querySelector","Type","isNil","MySign","_classPrivateFieldInitSpec","Cache","MemoryCache","setSelectedColor","colorSelectorBtnLayout","getPosition","src","dataSrc","getPlaceholderLabel","updateColor","remember","onStyleChange","colors","allowCustomColor","selectedColor","colorPreview","close","MyStamp","Uploader","controller","upload","contact","id","label","Text","getInitiatorName","subscribe","currentBlock","Promise","resolve","reject","eventData","getData","file","serverId","serverPreviewUrl","then","error","fileId","Backend","command","postData","documentId","getId","companyId","result","Number","numeratorUrl","sliderOnMessageBind","addCustomEvent","getEventId","numeratorData","sender","type","SidePanel","Instance","cacheable","Reference","isUndefined","Selector","className","setTimeout","fieldLabel","crmEntityFields","innerText","multiple","MyReference","blackList","some","blankListFieldName","Requisites","tagBody","getMemberByPart","getMemberPart","crmOwnerTypeContact","cid","crmRequisiteContactPresetId","Sign","Stamp","contentEditable","focus","content","range","createRange","selectNodeContents","collapse","selection","getSelection","removeAllRanges","addRange","Style","family","property","size","bold","button","state","italic","underline","through","left","group","center","right","justify","buttonPressed","removeAttribute","getStylePanel","code","renderStyle","querySelectorAll","action","getAttribute","addClass","removeClass","indexOf","Block","myrequisites","mysign","mystamp","number","reference","myreference","requisites","sign","stamp","blockContent","blockPanel","blockLoading","blockEditing","pageWithNotAllowed","onClick","Error","setPosition","position","getInitDimension","setRect","getBoundingClientRect","top","Math","round","documentRect","getStyles","transferPositionToPage","page","pageElement","flag","blockLayouts","isSingleton","push","currentCode","getBlocks","blockLayout","blocksData","blocksInstance","isArray","i","showResizeArea","remove","contentTag","clean","toLowerCase","resizeNode","append","setProperty","observerReady","getStyle","maxTextSize","parseFloat","isOverflownX","clientHeight","scrollHeight","parentNode","param","resizeText","target","step","minSize","unit","intervalTextResize","clearTimeout","overflow","parent","removeProperty","updateFontSize","panelTag","isStyleAllowed","getActionButton","getBlockCaption","getMemberSelector","getMembers","onMemberSelect","onStartChangePosition","onPlaced","onClickOut","applyStyles","onStyleRender","actionsPanel","actionsPanelRect","blockRect","a","b","detectBorder","marginLeft","click","hidden","getBlockLayout","unMuteResizeArea","hideResizeArea","setSavingMark","nodeForPosition","body","documentLayoutRect","blockInitDim","min","scrollTop","offsetHeight","inDeadZone","getPagesGap","getContainer","newSignColor","forEach","Resize","resizeContainer","moveContainer","isDomNode","wrapperLayout","getResizeArea","pointRect","display","setAttribute","borderDelta","e","moving","resizing","fireAction","initialRect","draggable","Draggable","container","DragAndDrop","HEADLESS","textResize","wrapper","positionLast","bottomResize","areaRect","wrapperRect","hasClass","max","offsetX","offsetY","newPosition","calcDeathTop","notAddDeathMargin","showNotAllowedArea","newPositionLinked","adjustActionsPanel","dragArea","widthInProcess","source","moveTopDelta","hideNotAllowedArea","y","x","Document","alreadyInit","documentLayout","initiatorName","blankId","disableEdit","repositoryItems","blocks","saveButton","onCloseSlider","activeBlock","getLinkedBlock","closeDemoContent","getElementById","Helper","preventDefault","c","gapBetweenPages","marginTop","returnMember","hide","realDocumentWidth","offsetWidth","isRemoved","realDocumentWidthPx","params","response","errors","customData","popup","Popup","titleBar","util","htmlspecialchars","buttons","Button","ButtonColor","SUCCESS","onclick","destroy","INFO","blockActionButton","afterSaveCallback","save","saveErrorCallback","slider","url","everythingIsSaved","denyAction","MessageBox","confirm","messageBox","mark","setParam","getParam","getSliderByWindow","window","set","get","undefined","bottom","notAddMargin","seams","getSeams","ii","cc","seam","pageRect","pageRectToMath","pageRectKey","isNumber","pageImageRect","widthPx","heightPx","seamShift","item","guide","Guide","steps","title","autoSave","simpleMode","startOnce","helpBtnSpotlight","SpotLight","targetElement","targetVertex","rounded","article","onShow","DocumentMasterLoader","totalImages","overlay","loader","update","linkReload","getElementsByTagName","addEventListener","location","reload","console","warn","renderTo","ProgressRound","colorBar","colorTrack","statusType","ProgressRoundStatus","INCIRCLECOUNTER","Status","maxValue","Loader"],"mappings":"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"}