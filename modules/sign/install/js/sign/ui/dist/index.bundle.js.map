{"version":3,"file":"index.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Event, Type } from 'main.core';\nimport { MenuManager } from 'main.popup';\nimport { EventEmitter } from 'main.core.events';\n\nimport './style.css';\n\ntype SimpleMenuOptions = {\n\tbindElement: HTMLElement,\n\titems: Array<string>,\n\tactionHandler: (selectedValue: string) => {},\n\tmenuId?: string,\n\tcurrentValue: string\n};\n\nexport class UI\n{\n\tstatic simpleMenu = {};\n\n\t/**\n\t * Binds Menu (simple structure) to the element.\n\t * @param {SimpleMenuOptions} options\n\t */\n\tstatic bindSimpleMenu(options: SimpleMenuOptions)\n\t{\n\t\tconst { bindElement, items, actionHandler, currentValue } = options;\n\t\tconst menuItems = [];\n\t\tconst menuId = options.menuId || 'menu-' + Math.random();\n\t\tlet currentActiveNode = null;\n\n\t\tif (UI.simpleMenu[menuId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// build from plain array\n\t\tif (Type.isArray(items))\n\t\t{\n\t\t\titems.map(item => {\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: item,\n\t\t\t\t\tclassName: currentValue === parseInt(item) ? 'sign-popupmenu-item --sign-popupmenu-active' : 'sign-popupmenu-item',\n\t\t\t\t\tonclick: (ev) => {\n\t\t\t\t\t\tactionHandler(item);\n\t\t\t\t\t\tMenuManager.getMenuById(menuId).close();\n\t\t\t\t\t\tEventEmitter.emit(BX.findParent(bindElement, {className: 'sign-document__block-wrapper'}), 'BX.Sign:setFontSize', {\n\t\t\t\t\t\t\tmenuId: menuId,\n\t\t\t\t\t\t\tfontSize: parseInt(item)\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tlet popupNode = UI.simpleMenu[menuId].getPopupWindow().getPopupContainer();\n\n\t\t\t\t\t\tif (popupNode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet activeItemNode = popupNode.querySelector('.--sign-popupmenu-active');\n\n\t\t\t\t\t\t\tif (activeItemNode)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tactiveItemNode.classList.remove('--sign-popupmenu-active');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//\n\t\t\t\t\t\tlet currentNode = ev.target.closest('.sign-popupmenu-item');\n\t\t\t\t\t\t//\n\t\t\t\t\t\tif (currentNode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcurrentActiveNode = currentNode;\n\t\t\t\t\t\t\tcurrentActiveNode.classList.add('--sign-popupmenu-active');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\t// or Object\n\t\telse\n\t\t{\n\t\t\t[...Object.keys(items)].map(key => {\n\t\t\t\tmenuItems.push({\n\t\t\t\t\thtml: items[key],\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tactionHandler(key);\n\t\t\t\t\t\tMenuManager.getMenuById(menuId).close();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tconst documentContainer = document.body.querySelector('[data-role=\"sign-editor__content\"]');\n\t\tconst adjustMenu = () => {\n\t\t\tUI.simpleMenu[menuId].close()\n\t\t};\n\n\t\tUI.simpleMenu[menuId] = MenuManager.create({\n\t\t\tid: menuId,\n\t\t\tbindElement: bindElement,\n\t\t\titems: menuItems,\n\t\t\tautoHide: true,\n\t\t\toffsetLeft: -35,\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tif (documentContainer)\n\t\t\t\t\t{\n\t\t\t\t\t\tEvent.unbind(documentContainer, 'scroll', adjustMenu);\n\t\t\t\t\t}\n\n\t\t\t\t\tEventEmitter.unsubscribe('BX.Sign:resizeStart', adjustMenu);\n\t\t\t\t\tEventEmitter.unsubscribe('BX.Sign:moveStart', adjustMenu);\n\t\t\t\t},\n\t\t\t\tonShow: () => {\n\t\t\t\t\tif (documentContainer)\n\t\t\t\t\t{\n\t\t\t\t\t\tEvent.bind(documentContainer, 'scroll', adjustMenu);\n\t\t\t\t\t}\n\n\t\t\t\t\tEventEmitter.subscribe('BX.Sign:moveStart', adjustMenu);\n\t\t\t\t\tEventEmitter.subscribe('BX.Sign:resizeStart', adjustMenu);\n\t\t\t\t},\n\t\t\t\tonPopupShow: () => {\n\t\t\t\t\tif (!currentActiveNode)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet popupNode = UI.simpleMenu[menuId].getPopupWindow().getPopupContainer();\n\t\t\t\t\t\tcurrentActiveNode = popupNode.querySelector('.--sign-popupmenu-active');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (currentActiveNode)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet menuNode =  UI.simpleMenu[menuId].getPopupWindow().getContentContainer();\n\t\t\t\t\t\tlet menuHeight = menuNode.offsetHeight;\n\t\t\t\t\t\tlet scrollOffset = currentActiveNode.offsetTop;\n\t\t\t\t\t\tscrollOffset = scrollOffset + (currentActiveNode.offsetHeight / 2) - (menuHeight / 2);\n\t\t\t\t\t\tmenuNode.scrollTop = scrollOffset;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tEvent.bind(bindElement, 'click', () => {\n\t\t\tconst pos = bindElement.getBoundingClientRect();\n\t\t\tconst fixHeight = 233;\n\t\t\tconst maxHeight = window.innerHeight - pos.top - (pos.height * 2);\n\t\t\tUI.simpleMenu[menuId].popupWindow.setMaxHeight(maxHeight < fixHeight ? maxHeight : fixHeight);\n\t\t\tUI.simpleMenu[menuId].show();\n\t\t});\n\t}\n}\n"],"names":["UI","options","bindElement","items","actionHandler","currentValue","menuItems","menuId","Math","random","currentActiveNode","simpleMenu","Type","isArray","map","item","push","text","className","parseInt","onclick","ev","MenuManager","getMenuById","close","EventEmitter","emit","BX","findParent","fontSize","popupNode","getPopupWindow","getPopupContainer","activeItemNode","querySelector","classList","remove","currentNode","target","closest","add","Object","keys","key","html","documentContainer","document","body","adjustMenu","create","id","autoHide","offsetLeft","events","onClose","Event","unbind","unsubscribe","onShow","bind","subscribe","onPopupShow","menuNode","getContentContainer","menuHeight","offsetHeight","scrollOffset","offsetTop","scrollTop","pos","getBoundingClientRect","fixHeight","maxHeight","window","innerHeight","top","height","popupWindow","setMaxHeight","show"],"mappings":"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"}