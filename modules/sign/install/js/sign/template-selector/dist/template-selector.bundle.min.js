this.BX=this.BX||{};(function(e,t,s,i,a,l,o){"use strict";var r=babelHelpers.classPrivateFieldLooseKey("cache");var n=babelHelpers.classPrivateFieldLooseKey("request");class c extends a.EventEmitter{constructor(e){super();Object.defineProperty(this,n,{value:d});Object.defineProperty(this,r,{writable:true,value:new l.Cache.MemoryCache});this.setEventNamespace("BX.Sign.TemplateSelector.Backend");this.subscribeFromOptions(e==null?void 0:e.events);this.setOptions(e)}setOptions(e){babelHelpers.classPrivateFieldLooseBase(this,r)[r].set("options",{...e})}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,r)[r].get("options",{})}getTemplatesList(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n]("list")}}function d(e){return new Promise(((t,s)=>{l.ajax.runAction(`sign.blank.${e}`).then((e=>{t(e)})).catch((e=>{s(e)}))}))}let p=e=>e,b,L;var u=babelHelpers.classPrivateFieldLooseKey("cache");var v=babelHelpers.classPrivateFieldLooseKey("getLoader");var h=babelHelpers.classPrivateFieldLooseKey("getProgressLayout");class g{constructor({targetContainer:e}){Object.defineProperty(this,h,{value:P});Object.defineProperty(this,v,{value:m});Object.defineProperty(this,u,{writable:true,value:new l.Cache.MemoryCache});if(l.Type.isDomNode(e)){l.Dom.append(this.getLayout(),e)}}getLayout(){return babelHelpers.classPrivateFieldLooseBase(this,u)[u].remember("loaderContainer",(()=>{const e=l.Tag.render(b||(b=p`
				<div class="sign-template-selector-list-item-loader">
					${0}
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,h)[h]());void babelHelpers.classPrivateFieldLooseBase(this,v)[v]().show(e);return e}))}show(){l.Dom.addClass(this.getLayout(),"sign-template-selector-list-item-loader-show")}hide(){l.Dom.removeClass(this.getLayout(),"sign-template-selector-list-item-loader-show")}updateStatus(e){babelHelpers.classPrivateFieldLooseBase(this,h)[h]().textContent=`${e}%`}}function m(){return babelHelpers.classPrivateFieldLooseBase(this,u)[u].remember("loader",(()=>new o.Loader({size:60})))}function P(){return babelHelpers.classPrivateFieldLooseBase(this,u)[u].remember("progressLayout",(()=>l.Tag.render(L||(L=p`
				<div class="sign-template-selector-list-item-loader-progress"></div>
			`))))}let T=e=>e,y,B,F,E,H,S,f;var O=babelHelpers.classPrivateFieldLooseKey("cache");class C extends a.EventEmitter{constructor(e){super();Object.defineProperty(this,O,{writable:true,value:new l.Cache.MemoryCache});this.setEventNamespace("BX.Sign.TemplateSelector.ListItem");this.subscribeFromOptions(e==null?void 0:e.events);this.setOptions(e);this.setSelected(e==null?void 0:e.selected);this.setLoading(e==null?void 0:e.loading);if(l.Type.isDomNode(e==null?void 0:e.targetContainer)){this.appendTo(e==null?void 0:e.targetContainer)}}setOptions(e){babelHelpers.classPrivateFieldLooseBase(this,O)[O].set("options",{...e})}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,O)[O].get("options",{})}setLoading(e){babelHelpers.classPrivateFieldLooseBase(this,O)[O].set("loading",e);if(e){this.getLoadingStatus().show()}else{this.getLoadingStatus().hide()}}updateStatus(e){this.getLoadingStatus().updateStatus(e)}getLoading(){return babelHelpers.classPrivateFieldLooseBase(this,O)[O].get("loading",false)}hasTitle(){var e;return l.Type.isStringFilled((e=this.getOptions())==null?void 0:e.title)}hasDescription(){var e;return l.Type.isStringFilled((e=this.getOptions())==null?void 0:e.description)}getIconLayout(){return babelHelpers.classPrivateFieldLooseBase(this,O)[O].remember("iconLayout",(()=>{const{iconClass:e="",iconBackground:t}=this.getOptions();const s=(()=>{if(l.Type.isStringFilled(t)){return` sign-template-selector-list-item-icon-${l.Text.encode(t)}`}return""})();return l.Tag.render(y||(y=T`
				<div class="sign-template-selector-list-item-icon${0}">
					<div class="sign-template-selector-list-item-icon-wrapper">
						<div class="${0}">
							<i></i>
						</div>
					</div>
				</div>
			`),s,e)}))}getTitleLayout(){return babelHelpers.classPrivateFieldLooseBase(this,O)[O].remember("titleLayout",(()=>{const{title:e=""}=this.getOptions();return l.Tag.render(B||(B=T`
				<div class="sign-template-selector-list-item-text-title">
					${0}
				</div>
			`),l.Text.encode(e))}))}getDescriptionLayout(){return babelHelpers.classPrivateFieldLooseBase(this,O)[O].remember("descriptionLayout",(()=>{const{description:e=""}=this.getOptions();return l.Tag.render(F||(F=T`
				<div class="sign-template-selector-list-item-text-description">
					${0}
				</div>
			`),l.Text.encode(e))}))}getTextLayout(){return babelHelpers.classPrivateFieldLooseBase(this,O)[O].remember("textLayout",(()=>l.Tag.render(E||(E=T`
				<div class="sign-template-selector-list-item-text">
					${0}
					${0}
				</div>
			`),this.hasTitle()?this.getTitleLayout():"",this.hasDescription()?this.getDescriptionLayout():"")))}getAdditionalTextLayout(){return babelHelpers.classPrivateFieldLooseBase(this,O)[O].remember("additionalTextLayout",(()=>l.Tag.render(H||(H=T`
				<div class="sign-template-selector-list-item-additional-text"></div>
			`))))}onEditClick(e){e.preventDefault();this.emit("onEditClick")}getEditButton(){return babelHelpers.classPrivateFieldLooseBase(this,O)[O].remember("editButton",(()=>l.Tag.render(S||(S=T`
				<div 
					class="sign-template-selector-list-item-edit-button"
					onclick="${0}"
					title="${0}"
				></div>
			`),this.onEditClick.bind(this),l.Loc.getMessage("SIGN_TEMPLATE_SELECTOR_EDIT_BUTTON_TITLE"))))}onClick(e){e.preventDefault();this.emit("onClick")}getLoadingStatus(){return babelHelpers.classPrivateFieldLooseBase(this,O)[O].remember("loadingStatus",(()=>new g({targetContainer:this.getLayout()})))}getLayout(){return babelHelpers.classPrivateFieldLooseBase(this,O)[O].remember("layout",(()=>{const{title:e="",editable:t}=this.getOptions();return l.Tag.render(f||(f=T`
				<div 
					class="sign-template-selector-list-item" 
					title="${0}"
					onclick="${0}"
				>
					${0}
					${0}
					${0}
				</div>
			`),l.Text.encode(e),this.onClick.bind(this),this.getIconLayout(),this.getTextLayout(),t?this.getEditButton():"")}))}setSelected(e){if(e){l.Dom.addClass(this.getLayout(),"sign-template-selector-list-item-selected");this.emit("onSelect")}else{l.Dom.removeClass(this.getLayout(),"sign-template-selector-list-item-selected")}}appendTo(e){l.Dom.append(this.getLayout(),e)}prependTo(e){l.Dom.prepend(this.getLayout(),e)}getId(){return this.getOptions().id}}let _=e=>e,I,D,w;var M=babelHelpers.classPrivateFieldLooseKey("cache");var A=babelHelpers.classPrivateFieldLooseKey("setOptions");var U=babelHelpers.classPrivateFieldLooseKey("getOptions");var j=babelHelpers.classPrivateFieldLooseKey("getLoader");var k=babelHelpers.classPrivateFieldLooseKey("resetSelected");var N=babelHelpers.classPrivateFieldLooseKey("onLastTemplatesListItemClick");var $=babelHelpers.classPrivateFieldLooseKey("onLastTemplatesListItemEditClick");var x=babelHelpers.classPrivateFieldLooseKey("onLastTemplatesListItemSelect");var K=babelHelpers.classPrivateFieldLooseKey("setLastTemplatesItems");var R=babelHelpers.classPrivateFieldLooseKey("getLastTemplatesItems");var X=babelHelpers.classPrivateFieldLooseKey("cleanLastTemplatesListLayout");var G=babelHelpers.classPrivateFieldLooseKey("disableSaveButton");var q=babelHelpers.classPrivateFieldLooseKey("enableSaveButton");var z=babelHelpers.classPrivateFieldLooseKey("setSaveButton");var J=babelHelpers.classPrivateFieldLooseKey("getSaveButton");class Q extends a.EventEmitter{constructor(e){super();Object.defineProperty(this,J,{value:ce});Object.defineProperty(this,z,{value:ne});Object.defineProperty(this,q,{value:re});Object.defineProperty(this,G,{value:oe});Object.defineProperty(this,X,{value:le});Object.defineProperty(this,R,{value:ae});Object.defineProperty(this,K,{value:ie});Object.defineProperty(this,x,{value:se});Object.defineProperty(this,$,{value:te});Object.defineProperty(this,N,{value:ee});Object.defineProperty(this,k,{value:Z});Object.defineProperty(this,j,{value:Y});Object.defineProperty(this,U,{value:W});Object.defineProperty(this,A,{value:V});Object.defineProperty(this,M,{writable:true,value:new l.Cache.MemoryCache});this.setEventNamespace("BX.Sign.TemplateSelector");this.subscribeFromOptions(e==null?void 0:e.events);babelHelpers.classPrivateFieldLooseBase(this,A)[A](e);babelHelpers.classPrivateFieldLooseBase(this,M)[M].remember("fileUploader",(()=>new s.Uploader({controller:"ui.dev.fileUploader.testUploaderController",controllerOptions:{action:"createByFiles"},browseElement:this.getUploadItems().map((e=>e.getLayout())),acceptedFileTypes:[".jpg",".jpeg",".png",".pdf",".doc",".docx",".rtf"],multiple:true,events:{"File:onAdd":e=>{const{file:t}=e.getData();const s=new C({id:t.id,title:t.clientPreview.name,iconClass:"ui-icon sign-template-selector-last-templates-list-item-icon-image",iconBackground:"blue",events:{onClick:babelHelpers.classPrivateFieldLooseBase(this,N)[N].bind(this),onEditClick:babelHelpers.classPrivateFieldLooseBase(this,$)[$].bind(this)},editable:true,loading:true});babelHelpers.classPrivateFieldLooseBase(this,R)[R]().unshift(s);babelHelpers.classPrivateFieldLooseBase(this,k)[k]();s.prependTo(this.getLastTemplatesListLayout())},"File:onUploadProgress":e=>{const{progress:t}=e.getData();const s=babelHelpers.classPrivateFieldLooseBase(this,R)[R]()[0];s.updateStatus(t)},"File:onUploadComplete":()=>{const e=setTimeout((()=>{const t=babelHelpers.classPrivateFieldLooseBase(this,R)[R]()[0];t.getLoadingStatus().hide();t.setSelected(true);clearTimeout(e)}),1e3)}}})))}getBackend(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M].remember("backend",(()=>new c({events:{onError:e=>{this.emit("onError",{error:e})}}})))}getFileUploader(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M].get("fileUploader")}getUploadItems(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M].remember("uploadItems",(()=>[new C({id:"image",iconClass:"ui-icon ui-icon-file-img",title:l.Loc.getMessage("SIGN_TEMPLATE_SELECTOR_UPLOAD_IMAGE_TITLE"),description:l.Loc.getMessage("SIGN_TEMPLATE_SELECTOR_UPLOAD_IMAGE_DESCRIPTION")}),new C({id:"pdf",iconClass:"ui-icon ui-icon-file-pdf",title:l.Loc.getMessage("SIGN_TEMPLATE_SELECTOR_UPLOAD_PDF_TITLE"),description:l.Loc.getMessage("SIGN_TEMPLATE_SELECTOR_UPLOAD_PDF_DESCRIPTION")}),new C({id:"doc",iconClass:"ui-icon ui-icon-file-doc",title:l.Loc.getMessage("SIGN_TEMPLATE_SELECTOR_UPLOAD_DOC_TITLE"),description:l.Loc.getMessage("SIGN_TEMPLATE_SELECTOR_UPLOAD_DOC_DESCRIPTION")})]))}getLastTemplatesListLayout(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M].remember("lastTemplatesListLayout",(()=>l.Tag.render(I||(I=_`
				<div class="sign-template-selector-last-templates-list"></div>
			`))))}getUploadLayout(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M].remember("uploadLayout",(()=>l.Tag.render(D||(D=_`
				<div class="sign-template-selector-upload">
					<div class="sign-template-selector-upload-title">
						${0}
					</div>
					<div class="sign-template-selector-upload-list">
						${0}
					</div>
				</div>
			`),l.Loc.getMessage("SIGN_TEMPLATE_SELECTOR_UPLOAD_TITLE"),this.getUploadItems().map((e=>e.getLayout())))))}getLayout(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M].remember("layout",(()=>{var e;const t=babelHelpers.classPrivateFieldLooseBase(this,U)[U]();return l.Tag.render(w||(w=_`
				<div class="sign-template-selector">
					${0}
					<div class="sign-template-selector-last-templates">
						<div class="sign-template-selector-last-templates-title">
							${0}
						</div>
						${0}
					</div>
				</div>
			`),(t==null?void 0:(e=t.upload)==null?void 0:e.enabled)!==false?this.getUploadLayout():"",l.Loc.getMessage("SIGN_TEMPLATE_SELECTOR_LAST_TEMPLATES_TITLE"),this.getLastTemplatesListLayout())}))}showLoader(){void babelHelpers.classPrivateFieldLooseBase(this,j)[j]().show(this.getLastTemplatesListLayout())}hideLoader(){void babelHelpers.classPrivateFieldLooseBase(this,j)[j]().hide()}drawList(){babelHelpers.classPrivateFieldLooseBase(this,X)[X]();this.showLoader();babelHelpers.classPrivateFieldLooseBase(this,G)[G]();this.getBackend().getTemplatesList().then((({data:e})=>{this.hideLoader();const t=babelHelpers.classPrivateFieldLooseBase(this,U)[U]();babelHelpers.classPrivateFieldLooseBase(this,K)[K](e.map((e=>{var s;return new C({id:e.ID,title:e.TITLE,iconClass:"ui-icon sign-template-selector-last-templates-list-item-icon-image",iconBackground:"blue",events:{onClick:babelHelpers.classPrivateFieldLooseBase(this,N)[N].bind(this),onEditClick:babelHelpers.classPrivateFieldLooseBase(this,$)[$].bind(this),onSelect:babelHelpers.classPrivateFieldLooseBase(this,x)[x].bind(this)},targetContainer:this.getLastTemplatesListLayout(),editable:t==null?void 0:(s=t.templatesList)==null?void 0:s.editable})})))}))}renderTo(e){l.Dom.append(this.getLayout(),e);void this.drawList()}openSlider(){void this.drawList();const e=l.Reflection.getClass("BX.SidePanel");if(!l.Type.isNil(e)){e.Instance.open("template-selector",{width:628,contentCallback:()=>t.Layout.createContent({extensions:["sign.template-selector"],title:l.Loc.getMessage("SIGN_TEMPLATE_SELECTOR_SLIDER_TITLE"),content:()=>this.getLayout(),buttons:({cancelButton:t,SaveButton:s})=>{babelHelpers.classPrivateFieldLooseBase(this,z)[z](new s({text:l.Loc.getMessage("SIGN_TEMPLATE_SELECTOR_SLIDER_SELECT_TEMPLATE_BUTTON_LABEL"),onclick:()=>{this.emit("onSelect");e.Instance.close()}}));babelHelpers.classPrivateFieldLooseBase(this,G)[G]();return[babelHelpers.classPrivateFieldLooseBase(this,J)[J](),t]}})})}}}function V(e){babelHelpers.classPrivateFieldLooseBase(this,M)[M].set("options",e)}function W(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M].get("options",{})}function Y(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M].remember("loader",(()=>new o.Loader({target:this.getLastTemplatesListLayout()})))}function Z(){babelHelpers.classPrivateFieldLooseBase(this,R)[R]().forEach((e=>{e.setSelected(false)}))}function ee(e){babelHelpers.classPrivateFieldLooseBase(this,k)[k]();const t=e.getTarget();t.setSelected(true)}function te(e){const t=e.getTarget();const s=t.getId();const i=l.Reflection.getClass("BX.SidePanel");if(!l.Type.isNil(i)){i.Instance.open(`/sign/edit/${s}/`,{allowChangeHistory:false})}}function se(){babelHelpers.classPrivateFieldLooseBase(this,q)[q]()}function ie(e){babelHelpers.classPrivateFieldLooseBase(this,M)[M].set("lastTemplatesItems",[...e])}function ae(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M].get("lastTemplatesItems")}function le(){l.Dom.clean(this.getLastTemplatesListLayout())}function oe(){const e=babelHelpers.classPrivateFieldLooseBase(this,J)[J]();if(e){e.setDisabled(true)}}function re(){const e=babelHelpers.classPrivateFieldLooseBase(this,J)[J]();if(e){e.setDisabled(false)}}function ne(e){babelHelpers.classPrivateFieldLooseBase(this,M)[M].set("saveButton",e)}function ce(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M].get("saveButton")}e.TemplateSelector=Q})(this.BX.Sign=this.BX.Sign||{},BX.UI.SidePanel,BX.UI.Uploader,BX,BX.Event,BX,BX);
//# sourceMappingURL=template-selector.bundle.map.js