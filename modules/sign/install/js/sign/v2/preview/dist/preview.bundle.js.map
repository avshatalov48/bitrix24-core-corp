{"version":3,"file":"preview.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Tag, Type, Loc, Dom, Text, Event } from 'main.core';\nimport { Loader } from 'main.loader';\nimport './style.css';\n\nconst ratio = 0.25;\n\nexport type Options = {\n\tlayout?: {\n\t\tgetAfterPreviewLayoutCallback?: () => ?HTMLElement\n\t},\n};\n\nexport class Preview\n{\n\t#placeholder: HTMLElement;\n\t#page: HTMLElement;\n\t#pageNumber: number;\n\t#scale: number;\n\t#controls: HTMLElement;\n\t#blocksContainer: HTMLElement;\n\t#blocks: Map;\n\t#urls: string[];\n\t#loader: Loader;\n\t#content: HTMLElement;\n\t#options: Options;\n\n\tconstructor(options: Options = {})\n\t{\n\t\tthis.#options = options;\n\t\tthis.#placeholder = Tag.render`\n\t\t\t<div class=\"sign-preview__placeholder\">\n\t\t\t\t<p class=\"sign-preview__placeholder_text\">\n\t\t\t\t\t${Loc.getMessage('SIGN_PREVIEW_PLACEHOLDER_TEXT')}\n\t\t\t\t</p>\n\t\t\t\t<img\n\t\t\t\t\tsrc=\"/bitrix/js/sign/v2/preview/src/images/placeholder.png\"\n\t\t\t\t\tclass=\"sign-preview__placeholder__img\"\n\t\t\t\t/>\n\t\t\t</div>`;\n\t\tthis.#page = Tag.render`<img class=\"sign-preview__page\" />`;\n\t\tthis.#blocksContainer = Tag.render`<div class=\"sign-preview__blocks\"></div>`;\n\t\tthis.#content = Tag.render`\n\t\t\t<div class=\"sign-preview__content\">\n\t\t\t\t<div class=\"sign-preview__content_scalable\">\n\t\t\t\t\t${this.#placeholder}\n\t\t\t\t\t${this.#page}\n\t\t\t\t\t${this.#blocksContainer}\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\tthis.#blocks = new Map();\n\t\tthis.#controls = this.#createControls();\n\t\tthis.#urls = [];\n\t\tthis.#pageNumber = 0;\n\t\tthis.#scale = 1;\n\t\tthis.#loader = new Loader({ target: this.#content, size: 80 });\n\t}\n\n\t#createBlockStyles(block)\n\t{\n\t\tconst { style, position, type } = block;\n\t\tconst { width, height, widthPx, heightPx } = position;\n\t\tconst inlineStyles = {\n\t\t\t...style,\n\t\t\ttop: `${position.top}%`,\n\t\t\tleft: `${position.left}%`,\n\t\t\twidth: `${width}%`,\n\t\t\theight: `${height}%`\n\t\t};\n\t\tif (type === 'image')\n\t\t{\n\t\t\treturn inlineStyles;\n\t\t}\n\n\t\tconst { width: pageWidth, height: pageHeight } = this.#page.getBoundingClientRect();\n\t\tconst widthRatio = widthPx / (width / 100 * pageWidth);\n\t\tconst heightRatio = heightPx / (height / 100 * pageHeight);\n\t\tconst fontSize = (parseFloat(style['fontSize']) || 14 ) / widthRatio;\n\t\tconst padding = `${5 / heightRatio}px ${8 / widthRatio}px`;\n\t\tObject.assign(inlineStyles, {\n\t\t\tpadding,\n\t\t\tfontSize: `${fontSize}px`\n\t\t});\n\n\t\treturn inlineStyles;\n\t}\n\n\tasync #createBlocks(blocksData)\n\t{\n\t\tconst isLoaded = this.#page.complete && this.#page.naturalHeight !== 0;\n\t\tif (!isLoaded)\n\t\t{\n\t\t\tawait new Promise((resolve) => Event.bindOnce(this.#page, 'load', resolve));\n\t\t}\n\n\t\tconst { blocksTemplate, blocks } = blocksData.reduce((acc, block) => {\n\t\t\tconst node = Tag.render`\n\t\t\t\t<div class=\"sign-preview__block\"></div>\n\t\t\t`;\n\t\t\tconst blockContent = this.#getBlockContent(block);\n\t\t\tif (blockContent)\n\t\t\t{\n\t\t\t\tDom.append(blockContent, node);\n\t\t\t\tDom.addClass(node, '--filled');\n\t\t\t}\n\n\t\t\tconst inlineStyles = this.#createBlockStyles(block);\n\t\t\tObject.keys(inlineStyles).forEach(styleName => {\n\t\t\t\tnode.style[styleName] = inlineStyles[styleName];\n\t\t\t});\n\t\t\tconst { blocks, blocksTemplate } = acc;\n\t\t\tconst { page } = block.position;\n\t\t\tblocks.set(page, [\n\t\t\t\t...(blocks.get(page) ?? []),\n\t\t\t\tnode\n\t\t\t]);\n\t\t\tDom.append(node, blocksTemplate);\n\n\t\t\treturn acc;\n\t\t}, {\n\t\t\tblocks: new Map(),\n\t\t\tblocksTemplate: new DocumentFragment()\n\t\t});\n\t\tDom.append(blocksTemplate, this.#blocksContainer);\n\n\t\treturn blocks;\n\t}\n\n\t#getBlockContent(block): ?HTMLElement\n\t{\n\t\tif (block.type === 'image')\n\t\t{\n\t\t\treturn this.#getImageLayout(block);\n\t\t}\n\n\t\treturn this.#getTextLayout(block);\n\t}\n\n\t#getImageLayout(block): ?HTMLElement\n\t{\n\t\tconst url = block.data.__view?.base64;\n\t\tif (!url)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Tag.render`<img src=\"data:image;base64,${url}\" />`;\n\t}\n\n\t#getTextLayout(block): ?HTMLElement\n\t{\n\t\tlet text = block.data.text;\n\t\tif (!text)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\ttext = Text.encode(text);\n\n\t\tconst span = Tag.render`<span>${text}</span>`;\n\t\tspan.innerHTML = text.replaceAll('[br]', '<br />');\n\n\t\treturn span;\n\t}\n\n\t#createControls(): HTMLElement\n\t{\n\t\tconst pagination = Tag.render`\n\t\t\t<div class=\"sign-preview__pagination\">\n\t\t\t\t<span\n\t\t\t\t\tclass=\"sign-preview__btn sign-preview__pagination_btn --prev\"\n\t\t\t\t\tonclick=\"${() => {\n\t\t\t\t\t\tthis.#pageNumber -= 1;\n\t\t\t\t\t\tthis.#render();\n\t\t\t\t\t}}\"\n\t\t\t\t>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"sign-preview__pagination_page-num\"></span>\n\t\t\t\t<span\n\t\t\t\t\tclass=\"sign-preview__btn sign-preview__pagination_btn --next\"\n\t\t\t\t\tonclick=\"${() => {\n\t\t\t\t\t\tthis.#pageNumber += 1;\n\t\t\t\t\t\tthis.#render();\n\t\t\t\t\t}}\"\n\t\t\t\t>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t`;\n\t\tconst zoom = Tag.render`\n\t\t\t<div class=\"sign-preview__zoom\">\n\t\t\t\t<span\n\t\t\t\t\tclass=\"sign-preview__btn sign-preview__zoom_btn --plus\"\n\t\t\t\t\tonclick=\"${() => {\n\t\t\t\t\t\tthis.#scale -= ratio;\n\t\t\t\t\t\tthis.#renderContent();\n\t\t\t\t\t\tthis.#renderZoom();\n\t\t\t\t\t}}\"\n\t\t\t\t>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"sign-preview__zoom_value\">100%</span>\n\t\t\t\t<span\n\t\t\t\t\tclass=\"sign-preview__btn sign-preview__zoom_btn --minus\"\n\t\t\t\t\tonclick=\"${() => {\n\t\t\t\t\t\tthis.#scale += ratio;\n\t\t\t\t\t\tthis.#renderContent();\n\t\t\t\t\t\tthis.#renderZoom();\n\t\t\t\t\t}}\"\n\t\t\t\t></span>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-preview__controls\">\n\t\t\t\t${pagination}\n\t\t\t\t${zoom}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\tconst layout = Tag.render`\n\t\t\t<div class=\"sign-preview\">\n\t\t\t\t${this.#content}\n\t\t\t\t${this.#controls}\n\t\t\t\t${this.#options?.layout?.getAfterPreviewLayoutCallback?.() ?? ''}\n\t\t\t</div>\n\t\t`;\n\t\tthis.#render();\n\n\t\treturn layout;\n\t}\n\n\t#render()\n\t{\n\t\tthis.#renderContent();\n\t\tthis.#renderBlocks();\n\t\tthis.#renderControls();\n\t}\n\n\t#renderContent()\n\t{\n\t\tDom.removeClass(this.#placeholder, '--hidden');\n\t\tDom.removeClass(this.#page, '--hidden');\n\t\tconst { parentElement: scalable } = this.#page;\n\t\tif (this.#urls.length === 0)\n\t\t{\n\t\t\tDom.addClass(this.#page, '--hidden');\n\t\t\tthis.#page.src = '';\n\t\t\tscalable.style.transform = '';\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(this.#placeholder, '--hidden');\n\t\tconst url = this.#urls[this.#pageNumber];\n\t\tthis.#page.src = url;\n\t\tscalable.style.transform = `scale(${this.#scale})`;\n\t}\n\n\t#renderBlocks()\n\t{\n\t\tconst visibleBlocks = this.#blocks.get(this.#pageNumber + 1) ?? [];\n\t\tconst allBlocks = [...this.#blocks.values()].flat();\n\t\tallBlocks.forEach((block) => {\n\t\t\tif (visibleBlocks.includes(block))\n\t\t\t{\n\t\t\t\tDom.removeClass(block, '--hidden');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.addClass(block, '--hidden');\n\t\t});\n\t}\n\n\t#renderControls()\n\t{\n\t\tif (this.#urls.length === 0)\n\t\t{\n\t\t\tDom.addClass(this.#controls, '--locked');\n\t\t\tthis.#pageNumber = 0;\n\t\t\tthis.#scale = 1;\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.removeClass(this.#controls, '--locked');\n\t\tthis.#renderPagination();\n\t\tthis.#renderZoom();\n\t}\n\n\t#renderPagination()\n\t{\n\t\tconst [pagination] = this.#controls.children;\n\t\tconst [prevBtn, content, nextBtn] = pagination.children;\n\t\tconst message = Loc.getMessage('SIGN_PREVIEW_PAGE');\n\t\tconst totalPages = this.#urls.length;\n\t\tDom.removeClass(prevBtn, '--disabled');\n\t\tDom.removeClass(nextBtn, '--disabled');\n\t\tcontent.textContent = `${message} ${this.#pageNumber + 1}/${totalPages}`;\n\t\tif (this.#pageNumber === 0)\n\t\t{\n\t\t\tDom.addClass(prevBtn, '--disabled');\n\t\t}\n\n\t\tif (this.#pageNumber === totalPages - 1)\n\t\t{\n\t\t\tDom.addClass(nextBtn, '--disabled');\n\t\t}\n\t}\n\n\t#renderZoom()\n\t{\n\t\tconst [, zoom] = this.#controls.children;\n\t\tconst [zoomOutBtn, content, zoomInBtn] = zoom.children;\n\t\tcontent.textContent = `${this.#scale * 100}%`;\n\t\tconst overflowed = this.#page.parentElement.parentElement;\n\t\tif (this.#scale !== 1)\n\t\t{\n\t\t\tDom.addClass(overflowed, '--overflowed');\n\t\t\tDom.removeClass(zoomOutBtn, '--disabled');\n\t\t\tif (this.#scale === 2)\n\t\t\t{\n\t\t\t\tDom.addClass(zoomInBtn, '--disabled');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(zoomOutBtn, '--disabled');\n\t\t\tDom.removeClass(zoomInBtn, '--disabled');\n\t\t\tDom.removeClass(overflowed, '--overflowed');\n\t\t}\n\t}\n\n\tset urls(urls: string[])\n\t{\n\t\tthis.#urls = urls.length ? [\n\t\t\t...this.#urls,\n\t\t\t...urls\n\t\t] : [];\n\t\tthis.#renderContent();\n\t\tthis.#renderControls();\n\t}\n\n\thasUrls(): boolean\n\t{\n\t\treturn Type.isArrayFilled(this.#urls);\n\t}\n\n\tset ready(isReady: boolean)\n\t{\n\t\tif (isReady)\n\t\t{\n\t\t\tthis.#loader.hide();\n\t\t\tDom.removeClass(this.#content, '--with-overlay');\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(this.#content, '--with-overlay');\n\t\tthis.#loader.show();\n\t}\n\n\tasync setBlocks(blocks = [])\n\t{\n\t\tDom.clean(this.#blocksContainer);\n\t\tif (!blocks?.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#blocks = await this.#createBlocks(blocks);\n\t\tthis.#renderBlocks();\n\t}\n}\n"],"names":["ratio","Preview","constructor","options","Tag","render","Loc","getMessage","Map","Loader","target","size","getLayout","layout","getAfterPreviewLayoutCallback","urls","length","hasUrls","Type","isArrayFilled","ready","isReady","hide","Dom","removeClass","addClass","show","setBlocks","blocks","clean","block","style","position","type","width","height","widthPx","heightPx","inlineStyles","top","left","pageWidth","pageHeight","getBoundingClientRect","widthRatio","heightRatio","fontSize","parseFloat","padding","Object","assign","blocksData","isLoaded","complete","naturalHeight","Promise","resolve","Event","bindOnce","blocksTemplate","reduce","acc","node","blockContent","append","keys","forEach","styleName","page","set","get","DocumentFragment","url","data","__view","base64","text","Text","encode","span","innerHTML","replaceAll","pagination","zoom","parentElement","scalable","src","transform","visibleBlocks","allBlocks","values","flat","includes","children","prevBtn","content","nextBtn","message","totalPages","textContent","zoomOutBtn","zoomInBtn","overflowed"],"mappings":"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"}