{"version":3,"file":"sign-settings.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport type { Metadata } from 'ui.wizard';\nimport { type SignOptions, SignSettings } from 'sign.v2.sign-settings';\nimport { DocumentSetup } from 'sign.v2.document-setup';\nimport { DocumentSend } from 'sign.v2.b2b.document-send';\nimport { Requisites } from 'sign.v2.b2b.requisites';\n\nexport class B2BSignSettings extends SignSettings\n{\n\t#requisites: Requisites;\n\n\tconstructor(containerId: string, signOptions: SignOptions)\n\t{\n\t\tsuper(containerId, signOptions);\n\t\tconst { config, chatId = 0 } = signOptions;\n\t\tconst { blankSelectorConfig, documentSendConfig } = config;\n\t\tblankSelectorConfig.chatId = chatId;\n\t\tthis.documentSetup = new DocumentSetup(blankSelectorConfig);\n\t\tthis.documentSend = new DocumentSend(documentSendConfig);\n\t\tthis.#requisites = new Requisites();\n\t\tthis.isB2bSignMaster = true;\n\t\tthis.subscribeOnEvents();\n\t}\n\n\tasync applyDocumentData(uid: string): Promise<boolean>\n\t{\n\t\tconst applied = Boolean(await this.setupDocument(uid));\n\t\tif (!applied)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { setupData } = this.documentSetup;\n\t\tthis.#requisites.documentData = setupData;\n\t\tthis.editor.documentData = setupData;\n\n\t\tthis.documentsGroup.set(setupData.uid, setupData);\n\n\t\treturn true;\n\t}\n\n\tgetStepsMetadata(signSettings: B2BSignSettings): Metadata\n\t{\n\t\treturn {\n\t\t\tsetup: {\n\t\t\t\tget content(): HTMLElement {\n\t\t\t\t\treturn signSettings.documentSetup.layout;\n\t\t\t\t},\n\t\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2B_LOAD_DOCUMENT'),\n\t\t\t\tbeforeCompletion: async () => {\n\t\t\t\t\tconst setupData = await this.setupDocument();\n\t\t\t\t\tif (!setupData)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tthis.setSingleDocument(setupData);\n\n\t\t\t\t\tconst { uid, entityId, initiator } = setupData;\n\t\t\t\t\tthis.#requisites.documentData = { uid, entityId, initiator };\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t},\n\t\t\trequisites: {\n\t\t\t\tget content(): HTMLElement {\n\t\t\t\t\treturn signSettings.#requisites.getLayout();\n\t\t\t\t},\n\t\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2B_PREPARING_DOCUMENT'),\n\t\t\t\tbeforeCompletion: async () => {\n\t\t\t\t\tconst { uid, isTemplate, title, initiator } = this.documentSetup.setupData;\n\t\t\t\t\tconst valid = this.#requisites.checkInitiator(initiator);\n\t\t\t\t\tif (!valid)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst entityData = await this.#requisites.processMembers();\n\t\t\t\t\tif (!entityData)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst blocks = await this.documentSetup.loadBlocks(uid);\n\t\t\t\t\tthis.editor.documentData = { isTemplate, uid, blocks };\n\t\t\t\t\tthis.editor.entityData = entityData;\n\t\t\t\t\tthis.documentSend.documentData = { uid, title, blocks, initiator };\n\t\t\t\t\tthis.documentSend.entityData = entityData;\n\t\t\t\t\tawait this.editor.waitForPagesUrls();\n\t\t\t\t\tawait this.editor.renderDocument();\n\t\t\t\t\tthis.wizard.toggleBtnLoadingState('next', false);\n\t\t\t\t\tawait this.editor.show();\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t},\n\t\t\tsend: {\n\t\t\t\tget content(): HTMLElement {\n\t\t\t\t\treturn signSettings.documentSend.getLayout();\n\t\t\t\t},\n\t\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_SEND_DOCUMENT'),\n\t\t\t\tbeforeCompletion: () => {\n\t\t\t\t\treturn this.documentSend.sendForSign();\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tsubscribeOnEvents()\n\t{\n\t\tsuper.subscribeOnEvents();\n\t\tthis.#requisites.subscribe('changeInitiator', ({ data }) => {\n\t\t\tthis.documentSetup.setupData = {\n\t\t\t\t...this.documentSetup.setupData,\n\t\t\t\tinitiator: data.initiator,\n\t\t\t};\n\t\t});\n\t}\n}\n"],"names":["B2BSignSettings","SignSettings","constructor","containerId","signOptions","config","chatId","blankSelectorConfig","documentSendConfig","documentSetup","DocumentSetup","documentSend","DocumentSend","Requisites","isB2bSignMaster","subscribeOnEvents","applyDocumentData","uid","applied","Boolean","setupDocument","setupData","documentData","editor","documentsGroup","set","getStepsMetadata","signSettings","setup","content","layout","title","Loc","getMessage","beforeCompletion","setSingleDocument","entityId","initiator","requisites","getLayout","isTemplate","valid","checkInitiator","entityData","processMembers","blocks","loadBlocks","waitForPagesUrls","renderDocument","wizard","toggleBtnLoadingState","show","send","sendForSign","subscribe","data"],"mappings":"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"}