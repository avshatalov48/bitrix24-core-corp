this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};this.BX.Sign.V2=this.BX.Sign.V2||{};(function(e,t,s,i,n,a){"use strict";var o=babelHelpers.classPrivateFieldLooseKey("requisites");var r=babelHelpers.classPrivateFieldLooseKey("decorateStepsBeforeCompletionWithAnalytics");var c=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnStart");var l=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnDocumentApply");class u extends a.SignSettings{constructor(e,t){super(e,t);Object.defineProperty(this,l,{value:p});Object.defineProperty(this,c,{value:h});Object.defineProperty(this,r,{value:d});Object.defineProperty(this,o,{writable:true,value:void 0});const{config:a,chatId:u=0}=t;const{blankSelectorConfig:b,documentSendConfig:S}=a;b.chatId=u;this.documentSetup=new n.DocumentSetup(b);this.documentSend=new s.DocumentSend(S);babelHelpers.classPrivateFieldLooseBase(this,o)[o]=new i.Requisites;this.isB2bSignMaster=true;this.subscribeOnEvents()}async applyDocumentData(e){const t=Boolean(await this.setupDocument(e));if(!t){return false}const{setupData:s}=this.documentSetup;babelHelpers.classPrivateFieldLooseBase(this,o)[o].documentData=s;this.editor.documentData=s;babelHelpers.classPrivateFieldLooseBase(this,l)[l](s.id);this.documentsGroup.set(s.uid,s);return true}getStepsMetadata(e,s){babelHelpers.classPrivateFieldLooseBase(this,c)[c](s);const i={setup:{get content(){return e.documentSetup.layout},title:t.Loc.getMessage("SIGN_SETTINGS_B2B_LOAD_DOCUMENT"),beforeCompletion:async()=>{const e=await this.setupDocument();if(!e){return false}this.setSingleDocument(e);const{uid:t,entityId:s,initiator:i}=e;babelHelpers.classPrivateFieldLooseBase(this,o)[o].documentData={uid:t,entityId:s,initiator:i};return true}},requisites:{get content(){return babelHelpers.classPrivateFieldLooseBase(e,o)[o].getLayout()},title:t.Loc.getMessage("SIGN_SETTINGS_B2B_PREPARING_DOCUMENT"),beforeCompletion:async()=>{const{uid:e,isTemplate:t,title:s,initiator:i,initiatedByType:n}=this.documentSetup.setupData;const a=babelHelpers.classPrivateFieldLooseBase(this,o)[o].checkInitiator(i);if(!a){return false}const r=await babelHelpers.classPrivateFieldLooseBase(this,o)[o].processMembers();if(!r){return false}const c=await this.documentSetup.loadBlocks(e);this.editor.documentData={isTemplate:t,uid:e,blocks:c};this.editor.entityData=r;this.editor.setSenderType(n);this.documentSend.documentData={uid:e,title:s,blocks:c,initiator:i};this.documentSend.entityData=r;await this.editor.waitForPagesUrls();await this.editor.renderDocument();this.wizard.toggleBtnLoadingState("next",false);await this.editor.show();return true}},send:{get content(){return e.documentSend.getLayout()},title:t.Loc.getMessage("SIGN_SETTINGS_SEND_DOCUMENT"),beforeCompletion:()=>this.documentSend.sendForSign()}};babelHelpers.classPrivateFieldLooseBase(this,r)[r](i);return i}subscribeOnEvents(){super.subscribeOnEvents();babelHelpers.classPrivateFieldLooseBase(this,o)[o].subscribe("changeInitiator",(({data:e})=>{this.documentSetup.setupData={...this.documentSetup.setupData,initiator:e.initiator}}))}}function d(e){const t=this.getAnalytics();e.send.beforeCompletion=a.decorateResultBeforeCompletion(e.send.beforeCompletion,(()=>{t.sendWithDocId({event:"sent_document_to_sign",status:"success"},this.documentSend.documentData.uid)}),(()=>{t.send({event:"sent_document_to_sign",status:"error"})}))}function h(){const e=this.getAnalytics();if(!this.isEditMode()){e.send({event:"click_create_document"})}}function p(e){this.getAnalytics().sendWithDocId({event:"click_create_document"},e)}e.B2BSignSettings=u})(this.BX.Sign.V2.B2b=this.BX.Sign.V2.B2b||{},BX,BX.Sign.V2,BX.Sign.V2,BX.Sign.V2,BX.Sign.V2);
//# sourceMappingURL=sign-settings.bundle.map.js