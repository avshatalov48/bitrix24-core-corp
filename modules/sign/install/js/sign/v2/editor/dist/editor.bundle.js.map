{"version":3,"file":"editor.bundle.js","sources":["../src/blocks/dummy.js","../src/blocks/date.js","../src/blocks/myrequisites.js","../../../document/src/ui.js","../src/blocks/mysign.js","../src/blocks/mystamp.js","../src/blocks/number.js","../src/blocks/reference.js","../src/blocks/myreference.js","../src/blocks/requisites.js","../src/blocks/stamp.js","../src/blocks/sign.js","../src/blocks/text.js","../src/blocks/b2e/b2ereference.js","../src/blocks/b2e/myb2ereference.js","../src/blocks/b2e/employeedynamic.js","../src/blocks/b2e/hcmlinkreference.js","../src/blocks/ui.js","../src/blocks/style.js","../src/blocks/block.js","../src/blocks/resize.js","../src/blocks/blocksManager.js","../src/index.js"],"sourcesContent":["import { Tag, Text as TextFormat } from 'main.core';\nimport Block from './block';\nimport { EventEmitter } from \"main.core.events\";\n\nexport default class Dummy extends EventEmitter\n{\n\tblock: Block;\n\tdata: any = {};\n\tevents= {\n\t\tonChange: 'onChange',\n\t\tonColorStyleChange: 'onColorStyleChange',\n\t};\n\n\tstatic defaultTextBlockPaddingStyles = {\n\t\tpadding: \"5px 8px\"\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {Block} block\n\t */\n\tconstructor(block: Block)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.Editor.Blocks.Dummy')\n\t\tthis.block = block;\n\t}\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t}\n\n\t/**\n\t * Changes only text key in data.\n\t * @param {string} text\n\t */\n\tsetText(text: string)\n\t{\n\t\tthis.setData({ text });\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Returns current data.\n\t * @return {any}\n\t */\n\tgetData(): any\n\t{\n\t\treturn this.data;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\treturn null;\n\t}\n\n\t/**\n\t * @return {HTMLElement | null}\n\t */\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\treturn null;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t${TextFormat.encode(this.data.text || '').toString().replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tthis.block.forceSave();\n\t}\n\n\tonChange(): void\n\t{\n\t\tthis.emit(this.events.onChange)\n\t}\n\n\tgetStyles(): {[styleName: string]: string}\n\t{\n\t\treturn {};\n\t}\n\n\tchangeStyleColor(color: string): void\n\t{}\n}\n","import 'date';\nimport { Loc, Tag, Dom } from 'main.core';\n\nimport Dummy from './dummy';\n\nexport default class Date extends Dummy\n{\n\t#calendar: BX.JCCalendar;\n\t#calendarOpened: boolean = false;\n\t#date: string;\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 105,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#date = this.data.text;\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\tonActionClick()\n\t{\n\t\tthis.#calendar = BX.calendar({\n\t\t\tnode: this.block.getLayout(),\n\t\t\tfield: this.getViewContent(),\n\t\t\tvalue: this.#date,\n\t\t\tbTime: false,\n\t\t\tcallback_after: (date) => {\n\t\t\t\tthis.setText(\n\t\t\t\t\tBX.date.format(BX.date.convertBitrixFormat(BX.message('FORMAT_DATE')), date, null)\n\t\t\t\t);\n\t\t\t\tthis.block.renderView();\n\t\t\t}\n\t\t});\n\n\t\tthis.#calendarOpened = true;\n\t\tconst targetContainer = document.querySelector('.sign-editor__content');\n\t\tconst { popup } = this.#calendar;\n\t\tpopup.targetContainer = targetContainer;\n\t\tif (popup.popupContainer.parentElement !== targetContainer)\n\t\t{\n\t\t\tDom.append(popup.popupContainer, targetContainer);\n\t\t\tpopup.adjustPosition();\n\t\t}\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_DATE_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Closes calendar if open.\n\t */\n\t#closeCalendar()\n\t{\n\t\tif (this.#calendar)\n\t\t{\n\t\t\tthis.#calendar.Close();\n\t\t\tthis.#calendarOpened = false;\n\t\t}\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tif (!this.#calendarOpened)\n\t\t{\n\t\t\tthis.block.forceSave();\n\t\t}\n\n\t\tthis.#calendarOpened = false;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Date.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { FieldsetViewer } from 'crm.requisite.fieldset-viewer';\nimport { Cache, Loc, Tag, Text } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { UI } from 'ui.notification';\n\nimport Dummy from './dummy';\n\nexport default class MyRequisites extends Dummy\n{\n\t#cache = new Cache.MemoryCache();\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 220,\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.#getFieldsetViewer().show();\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...MyRequisites.defaultTextBlockPaddingStyles };\n\t}\n\n\t#getFieldsNameBlackList(): Array<string>\n\t{\n\t\treturn [\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t];\n\t}\n\n\t#getCreateFieldTypeNamesBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'file',\n\t\t\t'employee',\n\t\t\t'boolean',\n\t\t\t'money',\n\t\t]);\n\t}\n\n\t#filterRequisiteCreateFields(fields: Array<{ name: string }>): Array<Object>\n\t{\n\t\treturn fields.filter(\n\t\t\t(createFieldType) => !this.#getCreateFieldTypeNamesBlackList().has(createFieldType.name),\n\t\t);\n\t}\n\n\t#getFieldsetViewer(): FieldsetViewer\n\t{\n\t\treturn this.#cache.remember('fieldSetViewer', () => {\n\t\t\tconst blocksManager = this.block.blocksManager;\n\t\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\t\tconst { entityTypeId, presetId, entityId } = member;\n\t\t\tconst cid = member.cid ?? entityId;\n\n\t\t\tconst fieldsetViewer = new FieldsetViewer({\n\t\t\t\tentityTypeId,\n\t\t\t\tentityId: cid,\n\t\t\t\tdocumentUid: blocksManager.getDocumentUid(),\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.block.assign();\n\t\t\t\t\t\tthis.#cache.delete('fieldSetViewer');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tfieldListEditorOptions: {\n\t\t\t\t\tfieldsPanelOptions: {\n\t\t\t\t\t\tfilter: {\n\t\t\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t\t\t'COMPANY',\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t\t\t'list',\n\t\t\t\t\t\t\t\t'string',\n\t\t\t\t\t\t\t\t'date',\n\t\t\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t\t\t'text',\n\t\t\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t\t\t'address',\n\t\t\t\t\t\t\t\t'url',\n\t\t\t\t\t\t\t\t'double',\n\t\t\t\t\t\t\t\t'integer',\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t'-fields': [\n\t\t\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getFieldsNameBlackList().includes(fieldName),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfieldsFactory: {\n\t\t\t\t\t\t\tfilter: this.#filterRequisiteCreateFields.bind(this),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpresetId,\n\t\t\t\t\t\tcontrollerOptions: {\n\t\t\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\t\t\tpresetId,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tpopupOptions: { overlay: true, cacheable: false },\n\t\t\t})\n\t\t\t\t.setEndpoint('sign.api_v1.Integration.Crm.FieldSet.load')\n\t\t\t;\n\n\t\t\tfieldsetViewer.subscribe('onFieldSetLoadError', this.#onFieldsetViewerFieldsetLoadError.bind(this));\n\n\t\t\treturn fieldsetViewer;\n\t\t});\n\t}\n\n\t#onFieldsetViewerFieldsetLoadError(event: BaseEvent<{ requestErrors: Array<{ message: string, code: string }> }>)\n\t{\n\t\tthis.#getFieldsetViewer().hide();\n\t\tconst hasAccessDeniedError = event.getData().requestErrors.some((error) => error.code === 'ACCESS_DENIED');\n\t\tif (hasAccessDeniedError)\n\t\t{\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(Loc.getMessage('SIGN_EDITOR_ERROR_REQUISITE_BLOCK_REQUISITE_ACCESS_DENIED')),\n\t\t\t\tautoHideDelay: 3000,\n\t\t\t\twidth: 480,\n\t\t\t});\n\t\t}\n\t}\n}\n","import { Dom, Event, Loc, Tag, Text as TextFormat, Reflection, Type } from 'main.core';\nimport { UI as SignUI } from 'sign.ui';\nimport { MemberItem } from './types/document';\n\nimport './style.css';\nimport 'color_picker';\n\ntype BlockLayoutOptions = {\n\tonRemove: () => {},\n\tonSave: () => {}\n};\n\nexport type ColorPickerOptions = {\n\tcolors?: Array<Array<string>>,\n\tallowCustomColor?: boolean,\n\tselectedColor?: string,\n\tcolorPreview?: boolean,\n}\n\nconst ColorPicker = Reflection.getClass('BX.ColorPicker');\n\nexport default class UI\n{\n\t/**\n\t * Sets width/height/top/left to element.\n\t * @param {HTMLElement} element\n\t * @param {{[key: string]: number}} rect\n\t */\n\tstatic setRect(element: HTMLElement, rect: {[key: string]: number})\n\t{\n\t\tObject.keys(rect).map(key => {\n\t\t\trect[key] = parseInt(rect[key]) + 'px';\n\t\t});\n\t\tDom.style(element, rect);\n\t}\n\n\t/**\n\t * Returns block's layout.\n\t * @param {BlockLayoutOptions} options Layout options.\n\t * @return {HTMLElement}\n\t */\n\tstatic getBlockLayout(options: BlockLayoutOptions): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-wrapper\">\n\t\t\t\t<div class=\"sign-document__block-panel--wrapper\" data-role=\"sign-block__actions\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-content\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-actions\">\n\t\t\t\t\t<div class=\"sign-document__block-actions--wrapper\">\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --remove sign-block-action-remove\" data-role=\"removeAction\" onclick=\"${options.onRemove}\"></button>\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --save sign-block-action-save\" data-role=\"saveAction\" onclick=\"${options.onSave}\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns member selector for block.\n\t * @param {Array<MemberItem>} members All document's members.\n\t * @param {number} selectedValue Selected member.\n\t * @param {() => {}} onChange Handler on change value.\n\t * @return {HTMLElement}\n\t */\n\tstatic getMemberSelector(members: Array<MemberItem>, selectedValue: number,  onChange: () => {}): HTMLElement\n\t{\n\t\tconst menuItems = {};\n\t\tlet selectedName = Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\n\t\tmembers.map(member => {\n\t\t\tmember.name = member.name || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\t\t\tmenuItems[member.part] = member.name;\n\n\t\t\tif (member.part === selectedValue)\n\t\t\t{\n\t\t\t\tselectedName = member.name;\n\t\t\t}\n\t\t});\n\n\t\tconst memberSelector = (members.length > 1)\n\t\t\t? Tag.render`<span>${TextFormat.encode(selectedName)}</span>`\n\t\t\t: Tag.render`<i>${TextFormat.encode(selectedName)}</i>`;\n\n\t\tif (members.length > 1)\n\t\t{\n\t\t\tSignUI.bindSimpleMenu({\n\t\t\t\tbindElement: memberSelector,\n\t\t\t\titems: menuItems,\n\t\t\t\tactionHandler: value => {\n\t\t\t\t\tmemberSelector.innerHTML = menuItems[value];\n\t\t\t\t\tonChange(parseInt(value));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-block-member-wrapper\">\n\t\t\t\t${memberSelector}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns resizing area's layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getResizeArea(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__resize-area\">\n\t\t\t\t<div class=\"sign-area-resizable-controls\">\n\t\t\t\t\t<span class=\"sign-document__move-control\"></span>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-right\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --left-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-left\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns style panel layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getStylePanel(\n\t\tactionHandler: (actionName: string, actionValue: string) => {},\n\t\tcollectStyles: {[key: string]: string},\n\t): HTMLElement\n\t{\n\t\t// font family selector\n\t\tconst fonts = {\n\t\t\t'\"Times New Roman\", Times':   '<span style=\"font-family: \\'Times New Roman\\', Times\">Times New Roman</span>',\n\t\t\t'\"Courier New\"':              '<span style=\"font-family: \\'Courier New\\'\">Courier New</span>',\n\t\t\t'Arial, Helvetica':           '<span style=\"font-family: Arial, Helvetica\">Arial / Helvetica</span>',\n\t\t\t'\"Arial Black\", Gadget':      '<span style=\"font-family: \\'Arial Black\\', Gadget\">Arial Black</span>',\n\t\t\t'Tahoma, Geneva':             '<span style=\"font-family: Tahoma, Geneva\">Tahoma / Geneva</span>',\n\t\t\t'Verdana':                    '<span style=\"font-family: Verdana\">Verdana</span>',\n\t\t\t'Georgia, serif':             '<span style=\"font-family: Georgia, serif\">Georgia</span>',\n\t\t\t'monospace':                  '<span style=\"font-family: monospace\">monospace</span>',\n\t\t};\n\t\tconst fontFamily = Tag.render`<div class=\"sign-document__block-style-btn --btn-font-family\">${fonts[collectStyles['font-family']] || 'Font'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontFamily,\n\t\t\titems: fonts,\n\t\t\tactionHandler: value => {\n\t\t\t\tfontFamily.innerHTML = fonts[value];\n\t\t\t\tactionHandler('family', value);\n\t\t\t}\n\t\t});\n\n\t\t// font size selector\n\t\t\n\t\tlet fontSizereal = parseInt(collectStyles['font-size']);\n\t\tlet fontSizeValue = 14;\n\t\t\n\t\tif (fontSizereal) \n\t\t{\n\t\t\tfontSizeValue = fontSizereal;\n\t\t}\n\n\t\tconst fontSize = Tag.render`<div class=\"sign-document__block-style-btn --btn-fontsize\">${fontSizeValue+ 'px' || '<i></i>'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontSize,\n\t\t\titems: [\n\t\t\t\t'6px', '7px', '8px', '9px', '10px', '11px', '12px', '13px', '14px', '15px', '16px',\n\t\t\t\t'18px', '20px', '22px', '24px', '26px', '28px', '36px', '48px', '72px'\n\t\t\t],\n\t\t\tactionHandler: value => {\n\t\t\t\tfontSize.innerHTML = parseInt(value) + 'px';\n\t\t\t\tactionHandler('size', value);\n\t\t\t},\n\t\t\tcurrentValue: fontSizeValue,\n\t\t});\n\n\t\t// color\n\t\tconst { layout: fontColor } = UI.getColorSelectorBtn(\n\t\t\tcollectStyles.color ?? '#000',\n\t\t\t(color) => actionHandler('color', color),\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style--panel\">\n<!--\t\t\t\t<div class=\"sign-document__block-style&#45;&#45;move-control\"></div>-->\n\t\t\t\t${fontFamily}\n\t\t\t\t${fontSize}\n\t\t\t\t${fontColor}\n\t\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-bold\" data-action=\"bold\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-italic\" data-action=\"italic\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-underline\" data-action=\"underline\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-strike\" data-action=\"through\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-left\" data-action=\"left\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-center\" data-action=\"center\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-right\" data-action=\"right\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-justify\" data-action=\"justify\"><i></i></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tstatic getColorSelectorBtn(\n\t\tdefaultColorPickerColor: string,\n\t\tonColorSelect: (string) => any,\n\t\tcolorPickerOptions: ColorPickerOptions = {},\n\t): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\tconst layout = Tag.render`<div class=\"sign-document__block-style-btn --btn-color\">\n\t\t\t\t<span class=\"sign-document__block-style-btn--color-block\"></span> \n\t\t\t\t<span>${Loc.getMessage('SIGN_JS_DOCUMENT_STYLE_COLOR')}</span>\n\t\t\t</div>`\n\t\t;\n\t\tUI.updateColorSelectorBtnColor(layout, defaultColorPickerColor);\n\t\tconst updatedColorPickerOptions = {\n\t\t\t...colorPickerOptions,\n\t\t\tbindElement: layout,\n\t\t\tonColorSelected:\n\t\t\t\t(color) => {\n\t\t\t\t\tonColorSelect(color);\n\t\t\t\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\t\t\t},\n\t\t};\n\n\t\tconst picker = new ColorPicker(updatedColorPickerOptions);\n\n\t\tEvent.bind(layout, 'click', () => {\n\t\t\tpicker.open();\n\t\t});\n\n\t\treturn { layout, colorPicker: picker };\n\t}\n\n\tstatic updateColorSelectorBtnColor(layout: HTMLElement, color: string): void\n\t{\n\t\tconst circleColor = layout.querySelector('.sign-document__block-style-btn--color-block');\n\t\tif (Type.isNil(circleColor))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(\n\t\t\tcircleColor,\n\t\t\t'background-color',\n\t\t\tcolor,\n\t\t);\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat } from 'main.core';\nimport UI from '../../../../document/src/ui';\nimport Block from './block';\nimport Dummy from './dummy';\n\nexport default class MySign extends Dummy\n{\n\tdataSrc: string;\n\n\t#cache = new Cache.MemoryCache();\n\t#defaultSignatureColor: string = '#0047ab';\n\t#availableSignatureColors: string = ['#000', this.#defaultSignatureColor, '#8b00ff'];\n\t#selectedSignatureColor: string | null = null;\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 200,\n\t\t\theight: 70,\n\t\t};\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tlet src = null;\n\t\tif (this.dataSrc)\n\t\t{\n\t\t\tsrc = this.dataSrc;\n\t\t}\n\t\telse if (this.data.base64)\n\t\t{\n\t\t\tsrc = 'data:image;base64,' + this.data.base64;\n\t\t}\n\n\t\tif (src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<img src=\"${src}\" alt=\"\">\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || this.getPlaceholderLabel())}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_MY_SIGN');\n\t}\n\n\t#getSignatureColor(): string\n\t{\n\t\treturn this.#selectedSignatureColor ?? this.#defaultSignatureColor;\n\t}\n\n\tonClickOut()\n\t{\n\t\tsuper.onClickOut();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tonRemove()\n\t{\n\t\tsuper.onRemove();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\t#closeColorPickerPopup()\n\t{\n\t\tconst { colorPicker } = this.#getColorSelectorBtn();\n\t\tcolorPicker.close();\n\t}\n\n\tonSave()\n\t{\n\t\tsuper.onSave();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tgetStyles(): { [styleName: string]: string }\n\t{\n\t\treturn { backgroundPosition: 'center !important', color: this.#getSignatureColor() };\n\t}\n\n\tchangeStyleColor(color: string, emitEvent: boolean = true): void\n\t{\n\t\tsuper.changeStyleColor(color);\n\t\tthis.#selectedSignatureColor = color;\n\n\t\tconst { layout, colorPicker } = this.#getColorSelectorBtn();\n\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\tcolorPicker.setSelectedColor(color);\n\n\t\tif (emitEvent)\n\t\t{\n\t\t\tthis.emit(this.events.onColorStyleChange);\n\t\t}\n\t}\n\n\t/**\n\t * @return {HTMLElement | null}\n\t */\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\tconst { layout: colorSelectorBtnLayout } = this.#getColorSelectorBtn();\n\n\t\treturn Tag.render`\n\t\t\t<div style=\"display: flex; flex-direction: row;\">\n\t\t\t${colorSelectorBtnLayout}\n\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t<div class=\"sign-document-block-member-wrapper\">\n\t\t\t\t<i>${Loc.getMessage('SIGN_JS_DOCUMENT_SIGN_ACTION_BUTTON')}</i>\n\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getColorSelectorBtn(): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\treturn this.#cache.remember('colorSelectorBtn', () => UI.getColorSelectorBtn(\n\t\t\tthis.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t(color) => this.changeStyleColor(color),\n\t\t\t{\n\t\t\t\tcolors: [this.#availableSignatureColors],\n\t\t\t\tallowCustomColor: false,\n\t\t\t\tselectedColor: this.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t\tcolorPreview: false,\n\t\t\t},\n\t\t));\n\t}\n}\n","import { Loc, Tag, Text } from 'main.core';\nimport { Api } from 'sign.v2.api';\nimport { Uploader } from 'ui.stamp.uploader';\nimport Dummy from './dummy';\nimport Block from './block';\n\nexport default class MyStamp extends Dummy\n{\n\tstatic currentBlock: Block;\n\n\tdataSrc: string;\n\t#uploader: Uploader;\n\t#api: Api;\n\n\tconstructor(block: Block)\n\t{\n\t\tsuper(block);\n\n\t\tthis.#uploader = new Uploader({\n\t\t\tcontroller: {\n\t\t\t\tupload: 'sign.upload.stampUploadController',\n\t\t\t},\n\t\t\tcontact: {\n\t\t\t\tid: 0,\n\t\t\t\tlabel: 'Admin'\n\t\t\t},\n\t\t});\n\t\tthis.#uploader.subscribe('onSaveAsync', async (event) => {\n\t\t\tMyStamp.currentBlock.await(true);\n\t\t\tconst eventData = event.getData();\n\t\t\tif (!eventData?.file?.serverId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dataSrc = eventData.file.serverPreviewUrl;\n\t\t\tthis.#saveStamp(MyStamp.currentBlock, eventData.file.serverId);\n\t\t});\n\t\tthis.#api = new Api();\n\t}\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 151,\n\t\t\theight: 151\n\t\t};\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\tconst title = this.data.__view?.base64 ?\n\t\t\tLoc.getMessage('SIGN_EDITOR_BLOCK_CHANGE_STAMP') :\n\t\t\tLoc.getMessage('SIGN_EDITOR_BLOCK_LOAD_STAMP');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${title}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tMyStamp.currentBlock = this.block;\n\t\tthis.#uploader.show();\n\t}\n\n\t/**\n\t * Saves stamp to backend.\n\t * @param {Block} block\n\t * @param {string} fileId\n\t */\n\tasync #saveStamp(block: Block, fileId: string)\n\t{\n\t\tconst memberPart = block.getMemberPart();\n\t\tconst member = block.blocksManager.getMemberByPart(memberPart);\n\t\tawait this.#api.saveStamp(member.uid, fileId);\n\t\tblock.assign();\n\t\tconst layout = MyStamp.currentBlock.getLayout();\n\t\tconst button = layout.querySelector('button[data-role=\"action\"]');\n\t\tbutton.textContent = Loc.getMessage('SIGN_EDITOR_BLOCK_CHANGE_STAMP');\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tlet src = null;\n\n\t\tif (this.data.__view?.base64)\n\t\t{\n\t\t\tsrc = 'data:image;base64,' + this.data.__view.base64;\n\t\t}\n\n\t\tif (src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_stamp\" style=\"background-image: url(${src})\"></div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata --stamp\"></div>\n\t\t\t`;\n\t\t}\n\t}\n}\n","import { Loc, Tag, Text as TextFormat } from 'main.core';\nimport { Api } from 'sign.v2.api';\n\nimport Dummy from './dummy';\n\nexport default class Number extends Dummy\n{\n\tstatic sliderOnMessageBind: boolean = false;\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 100,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tevent.stopPropagation();\n\t\tif (!Number.sliderOnMessageBind)\n\t\t{\n\t\t\tNumber.sliderOnMessageBind = true;\n\n\t\t\tBX.addCustomEvent(window, 'SidePanel.Slider:onMessage', async (event) =>\n\t\t\t{\n\t\t\t\tconst isEditor = event.slider?.url === 'editor';\n\t\t\t\tif (isEditor && event.getEventId() === 'numerator-saved-event')\n\t\t\t\t{\n\t\t\t\t\tconst numeratorData = event.getData();\n\t\t\t\t\tconst currentBlock = event?.sender?.options?.data?.block ?? this.block;\n\n\t\t\t\t\tif (numeratorData.type === 'CRM_SMART_DOCUMENT')\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentBlock.await(true);\n\t\t\t\t\t\tconst api = new Api();\n\t\t\t\t\t\tconst uid = currentBlock.blocksManager.getDocumentUid();\n\t\t\t\t\t\tawait api.refreshEntityNumber(uid);\n\t\t\t\t\t\tcurrentBlock.assign();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst { crmNumeratorUrl } = this.data.__view;\n\t\tBX.SidePanel.Instance.open(crmNumeratorUrl, {\n\t\t\twidth: 480,\n\t\t\tcacheable: false,\n\t\t\tdata: {\n\t\t\t\tblock: this.block\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_NUMBER_ACTION_EDIT')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-number\">\n\t\t\t\t${TextFormat.encode(this.data.text || '').toString()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Number.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat, Type, Dom } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport type { FieldSelectEvent, FieldSelectEventData } from '../types/events/fieldSelectEvent';\nimport Dummy from './dummy';\nimport { Selector } from \"crm.form.fields.selector\";\n\nexport default class Reference extends Dummy\n{\n\t#cache = new Cache.MemoryCache();\n\t#field: string;\n\t#actionButton: HTMLElement;\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field ?? '';\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\t#onActionClick()\n\t{\n\t\tthis.#getCrmFieldSelectorPanel()\n\t\t\t.show()\n\t\t\t.then((selectedNames: Array<string>) => {\n\t\t\t\tconst eventSelectedNames = [...selectedNames];\n\t\t\t\tif (selectedNames.length === 0 && Type.isStringFilled(this.#field))\n\t\t\t\t{\n\t\t\t\t\teventSelectedNames.push(this.#field);\n\t\t\t\t}\n\t\t\t\tthis.#emitOnFieldSelectEvent(eventSelectedNames);\n\n\t\t\t\tif (selectedNames.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.block.getLayout(), '--invalid');\n\t\t\t\tthis.#field = selectedNames[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tif (Type.isUndefined(Selector))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel()\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionButton = this.#actionButton.querySelector('button');\n\t\tconst defaultCaption = Loc.getMessage('SIGN_JS_DOCUMENT_REFERENCE_ACTION_BUTTON');\n\t\tif (!this.#field)\n\t\t{\n\t\t\tactionButton.textContent = defaultCaption;\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldSelector = this.#cache.get('fieldSelector') ?? this.#getCrmFieldSelectorPanel();\n\t\tconst fieldsList = fieldSelector.getFieldsList();\n\t\tconst fields = [\n\t\t\t...fieldsList?.CONTACT?.FIELDS ?? [],\n\t\t\t...fieldsList?.SMART_DOCUMENT?.FIELDS ?? [],\n\t\t];\n\t\tconst field = fields.find((field) => field.name === this.#field);\n\t\tconst caption = field ? field.caption : defaultCaption;\n\t\tactionButton.textContent = caption;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tif (this.data.src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div style=\"width: ${width - 14}px; height: ${height - 14}px; background: url(${this.data.src}) no-repeat top; background-size: cover;\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst className = !this.data.text ? 'sign-document__block-content_member-nodata' : '';\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"${className}\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA'))}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n\n\t#getCrmFieldSelectorPanel(): Selector\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\tconst { presetId } = member;\n\n\t\treturn this.#cache.remember('fieldSelector', () => {\n\t\t\tconst selector = new Selector({\n\t\t\t\tmultiple: false,\n\t\t\t\tcontrollerOptions: {\n\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\tpresetId,\n\t\t\t\t},\n\t\t\t\tpresetId,\n\t\t\t\tfilter: {\n\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t'CONTACT',\n\t\t\t\t\t\t'SMART_DOCUMENT',\n\t\t\t\t\t],\n\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t'list',\n\t\t\t\t\t\t'string',\n\t\t\t\t\t\t'date',\n\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t'text',\n\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t'address',\n\t\t\t\t\t\t'url',\n\t\t\t\t\t\t'double',\n\t\t\t\t\t\t'integer',\n\t\t\t\t\t],\n\t\t\t\t\t'-fields': [\n\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getCrmFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tfieldsFactory: {\n\t\t\t\t\tfilter: this.#filterRequisiteCreateFields.bind(this),\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tselector.subscribe('onSliderCloseComplete', this.#onCrmFieldSelectorSliderCloseComplete.bind(this));\n\n\t\t\treturn selector;\n\t\t});\n\t}\n\n\t#onCrmFieldSelectorSliderCloseComplete(): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\t// event already sended\n\t\t\tif (Type.isStringFilled(this.#field))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#emitOnFieldSelectEvent([]);\n\t\t});\n\t}\n\n\t#emitOnFieldSelectEvent(selectedNames: Array<string>): void\n\t{\n\t\tconst onFieldSelectEventData: FieldSelectEventData = { selectedFieldNames: selectedNames };\n\t\tconst onFieldSelectEvent: FieldSelectEvent = new BaseEvent({ data: onFieldSelectEventData });\n\t\tthis.emit('onFieldSelect', onFieldSelectEvent);\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Reference.defaultTextBlockPaddingStyles };\n\t}\n\n\t#getCrmFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t]);\n\t}\n\n\t#getCreateFieldTypeNamesBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'file',\n\t\t\t'employee',\n\t\t\t'boolean',\n\t\t\t'money',\n\t\t]);\n\t}\n\n\t#filterRequisiteCreateFields(fields: Array<{ name: string }>): Array<Object>\n\t{\n\t\treturn fields.filter(\n\t\t\t(createFieldType) => !this.#getCreateFieldTypeNamesBlackList().has(createFieldType.name),\n\t\t);\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat, Type, Dom } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport type { FieldSelectEvent, FieldSelectEventData } from '../types/events/fieldSelectEvent';\nimport Dummy from './dummy';\nimport { Selector } from 'crm.form.fields.selector';\n\nexport default class MyReference extends Dummy\n{\n\t#field: string;\n\t#actionButton: HTMLElement;\n\t#cache = new Cache.MemoryCache();\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field ?? '';\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\t#onActionClick()\n\t{\n\t\tthis.#getCrmFieldSelectorPanel()\n\t\t\t.show()\n\t\t\t.then((selectedNames: Array<string>): void => {\n\t\t\t\tconst eventSelectedNames = [...selectedNames];\n\t\t\t\tif (selectedNames.length === 0 && Type.isStringFilled(this.#field))\n\t\t\t\t{\n\t\t\t\t\teventSelectedNames.push(this.#field);\n\t\t\t\t}\n\t\t\t\tthis.#emitOnFieldSelectEvent(eventSelectedNames);\n\n\t\t\t\tif (selectedNames.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.block.getLayout(), '--invalid');\n\t\t\t\tthis.#field = selectedNames[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tif (Type.isUndefined(Selector))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel()\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionButton = this.#actionButton.querySelector('button');\n\t\tconst defaultCaption = Loc.getMessage('SIGN_JS_DOCUMENT_REFERENCE_ACTION_BUTTON');\n\t\tif (!this.#field)\n\t\t{\n\t\t\tactionButton.textContent = defaultCaption;\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldSelector = this.#getCrmFieldSelectorPanel();\n\t\tconst fieldsList = fieldSelector.getFieldsList();\n\t\tconst fields = [\n\t\t\t...fieldsList?.COMPANY?.FIELDS ?? [],\n\t\t\t...fieldsList?.SMART_DOCUMENT?.FIELDS ?? [],\n\t\t];\n\t\tconst field = fields.find((field) => field.name === this.#field);\n\t\tconst caption = field ? field.caption : defaultCaption;\n\t\tactionButton.textContent = caption;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tif (this.data.src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div style=\"width: ${width - 14}px; height: ${height - 14}px; background: url(${this.data.src}) no-repeat top; background-size: cover;\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\tconst className = !this.data.text ? 'sign-document__block-content_member-nodata' : '';\n\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"${className}\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_MY_BLOCKS'))}\n\t\t\t\t</div>\n\t\t\t`;\n\t}\n\n\t#getCrmFieldSelectorPanel(): Selector\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\t\tconst { presetId } = member;\n\n\t\treturn this.#cache.remember('fieldSelector', () => {\n\t\t\tconst selector = new Selector({\n\t\t\t\tmultiple: false,\n\t\t\t\tcontrollerOptions: {\n\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\tpresetId,\n\t\t\t\t},\n\t\t\t\tpresetId,\n\t\t\t\tfilter: {\n\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t'COMPANY',\n\t\t\t\t\t\t'SMART_DOCUMENT',\n\t\t\t\t\t],\n\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t'list',\n\t\t\t\t\t\t'string',\n\t\t\t\t\t\t'date',\n\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t'text',\n\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t'address',\n\t\t\t\t\t\t'url',\n\t\t\t\t\t\t'double',\n\t\t\t\t\t\t'integer',\n\t\t\t\t\t],\n\t\t\t\t\t'-fields': [\n\t\t\t\t\t\tthis.#getFieldNegativeFilter(),\n\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getCrmFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tfieldsFactory: {\n\t\t\t\t\tfilter: this.#filterRequisiteCreateFields.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t\tselector.subscribe('onSliderCloseComplete', this.#onCrmFieldSelectorSliderCloseComplete.bind(this));\n\n\t\t\treturn selector;\n\t\t});\n\t}\n\n\t#onCrmFieldSelectorSliderCloseComplete(): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\t// event already sended\n\t\t\tif (Type.isStringFilled(this.#field))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#emitOnFieldSelectEvent([]);\n\t\t});\n\t}\n\n\t#getFieldNegativeFilter(): (Object) => boolean\n\t{\n\t\tconst blackList = this.#getFieldsNameBlackList();\n\n\t\treturn (field) => {\n\t\t\treturn blackList.includes(field.name);\n\t\t};\n\t}\n\n\t#getFieldsNameBlackList(): Array<string>\n\t{\n\t\treturn [\n\t\t\t'COMPANY_LINK',\n\t\t\t'COMPANY_REG_ADDRESS',\n\t\t\t'COMPANY_ORIGIN_VERSION',\n\t\t];\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...MyReference.defaultTextBlockPaddingStyles };\n\t}\n\n\t#emitOnFieldSelectEvent(selectedNames: Array<string>): void\n\t{\n\t\tconst onFieldSelectEventData: FieldSelectEventData = { selectedFieldNames: selectedNames };\n\t\tconst onFieldSelectEvent: FieldSelectEvent = new BaseEvent({ data: onFieldSelectEventData });\n\t\tthis.emit('onFieldSelect', onFieldSelectEvent);\n\t}\n\n\t#getCrmFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t]);\n\t}\n\n\t#getCreateFieldTypeNamesBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'file',\n\t\t\t'employee',\n\t\t\t'boolean',\n\t\t\t'money',\n\t\t]);\n\t}\n\n\t#filterRequisiteCreateFields(fields: Array<{ name: string }>): Array<Object>\n\t{\n\t\treturn fields.filter(\n\t\t\t(createFieldType) => !this.#getCreateFieldTypeNamesBlackList().has(createFieldType.name),\n\t\t);\n\t}\n}\n","import { FieldsetViewer } from 'crm.requisite.fieldset-viewer';\nimport { Loc, Tag, Text as TextFormat } from 'main.core';\n\nimport Dummy from './dummy';\n\nexport default class Requisites extends Dummy\n{\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 220,\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\tevent.stopPropagation();\n\n\t\tif (!member)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { cid, entityTypeId, presetId } = member;\n\t\t(new FieldsetViewer({\n\t\t\tentityTypeId,\n\t\t\tentityId: cid,\n\t\t\tdocumentUid: blocksManager.getDocumentUid(),\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t},\n\t\t\t},\n\t\t\tfieldListEditorOptions: {\n\t\t\t\tfieldsPanelOptions: {\n\t\t\t\t\tfilter: {\n\t\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t\t'CONTACT',\n\t\t\t\t\t\t],\n\t\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t\t'list',\n\t\t\t\t\t\t\t'string',\n\t\t\t\t\t\t\t'date',\n\t\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t\t'text',\n\t\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t\t'address',\n\t\t\t\t\t\t\t'url',\n\t\t\t\t\t\t\t'double',\n\t\t\t\t\t\t\t'integer',\n\t\t\t\t\t\t],\n\t\t\t\t\t\t'-fields': [\n\t\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getCrmFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\tfieldsFactory: {\n\t\t\t\t\t\tfilter: this.#filterRequisiteCreateFields.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\tpresetId,\n\t\t\t\t\tcontrollerOptions: {\n\t\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\t\tpresetId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tpopupOptions: { overlay: true, cacheable: false },\n\t\t}))\n\t\t\t.setEndpoint('sign.api_v1.Integration.Crm.FieldSet.load')\n\t\t\t.show()\n\t\t;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst text = this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_REQUISITES');\n\t\tconst tagBody = this.data.text ? '' : ' class=\"sign-document__block-content_member-nodata\"';\n\n\t\treturn Tag.render`\n\t\t\t<div${tagBody}>\n\t\t\t\t${TextFormat.encode(text).toString().replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Requisites.defaultTextBlockPaddingStyles };\n\t}\n\n\t#getCrmFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t]);\n\t}\n\n\t#getCreateFieldTypeNamesBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'file',\n\t\t\t'employee',\n\t\t\t'boolean',\n\t\t\t'money',\n\t\t]);\n\t}\n\n\t#filterRequisiteCreateFields(fields: Array<{ name: string }>): Array<Object>\n\t{\n\t\treturn fields.filter(\n\t\t\t(createFieldType) => !this.#getCreateFieldTypeNamesBlackList().has(createFieldType.name),\n\t\t);\n\t}\n}\n","import { Loc, Tag, Text as TextFormat } from 'main.core';\nimport Dummy from './dummy';\n\nexport default class Stamp extends Dummy\n{\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 151,\n\t\t\theight: 151\n\t\t};\n\t}\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_STAMP');\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst {width, height} = this.block.getPosition();\n\n\t\tif (this.data.base64)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_stamp\" style=\"background-image: url(${src})\"></div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat } from 'main.core';\nimport UI from '../../../../document/src/ui';\nimport Stamp from './stamp';\n\nexport default class Sign extends Stamp\n{\n\t#cache = new Cache.MemoryCache();\n\t#defaultSignatureColor: string = '#0047ab';\n\t#availableSignatureColors: string = ['#000', this.#defaultSignatureColor, '#8b00ff'];\n\t#selectedSignatureColor: string | null = null;\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_SIGN');\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 200,\n\t\t\theight: 70,\n\t\t};\n\t}\n\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\tconst { layout: colorSelectorBtnLayout } = this.#getColorSelectorBtn();\n\n\t\treturn Tag.render`\n\t\t\t<div style=\"display: flex; flex-direction: row;\">\n\t\t\t${colorSelectorBtnLayout}\n\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t${TextFormat.encode(this.getPlaceholderLabel())}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [styleName: string]: string }\n\t{\n\t\treturn { backgroundPosition: 'center !important', color: this.#getSignatureColor() };\n\t}\n\n\tupdateColor(color: string)\n\t{\n\t\tsuper.updateColor(color);\n\t\tconst { layout, colorPicker } = this.#getColorSelectorBtn();\n\t\tthis.#selectedSignatureColor = color;\n\n\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\tcolorPicker.setSelectedColor(color);\n\t}\n\n\tchangeStyleColor(color: string, emitEvent: boolean = true): void\n\t{\n\t\tsuper.changeStyleColor(color);\n\t\tthis.#selectedSignatureColor = color;\n\n\t\tconst { layout, colorPicker } = this.#getColorSelectorBtn();\n\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\tcolorPicker.setSelectedColor(color);\n\n\t\tif (emitEvent)\n\t\t{\n\t\t\tthis.emit(this.events.onColorStyleChange);\n\t\t}\n\t}\n\n\t#getColorSelectorBtn(): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\treturn this.#cache.remember('colorSelectorBtn', () => UI.getColorSelectorBtn(\n\t\t\tthis.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t(color) => this.changeStyleColor(color),\n\t\t\t{\n\t\t\t\tcolors: [this.#availableSignatureColors],\n\t\t\t\tallowCustomColor: false,\n\t\t\t\tselectedColor: this.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t\tcolorPreview: false,\n\t\t\t},\n\t\t));\n\t}\n\n\t#getSignatureColor(): string\n\t{\n\t\treturn this.#selectedSignatureColor ?? this.#defaultSignatureColor;\n\t}\n\n\tonSave()\n\t{\n\t\tsuper.onSave();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tonRemove()\n\t{\n\t\tsuper.onRemove();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tonClickOut()\n\t{\n\t\tsuper.onClickOut();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\t#closeColorPickerPopup()\n\t{\n\t\tconst { colorPicker } = this.#getColorSelectorBtn();\n\t\tcolorPicker.close();\n\t}\n}\n","import { Event, Loc, Tag, Text as TextFormat } from 'main.core';\nimport Dummy from './dummy';\nimport Block from './block';\n\nexport default class Text extends Dummy\n{\n\t#textContainer: HTMLElement;\n\n\tconstructor(block: Block)\n\t{\n\t\tsuper(block);\n\t\tthis.setEventNamespace('BX.Sign.V2.Blocks.Text');\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\tonActionClick()\n\t{\n\t\tthis.#textContainer.contentEditable = true;\n\t\tthis.#textContainer.focus();\n\t}\n\n\t/**\n\t * Calls when typing in text container.\n\t */\n\t#onKeyUp(event): void\n\t{\n\t\tthis.setText(this.#textContainer.innerText.replaceAll(\"\\n\", '[br]'));\n\t\tthis.onChange();\n\t}\n\n\tgetText(): string\n\t{\n\t\treturn this.data.text;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.#textContainer;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement}\n\t */\n\tgetViewContent(): HTMLElement\n\t{\n\t\tconst content = this.data.text === Loc.getMessage('SIGN_JS_DOCUMENT_TEXT_PLACEHOLDER')\n\t\t\t? ''\n\t\t\t: this.data.text\n\t\t;\n\n\t\tthis.#textContainer = Tag.render`\n\t\t\t<div class=\"sign-document-block-text\" placeholder=\"${Loc.getMessage('SIGN_JS_DOCUMENT_TEXT_PLACEHOLDER')}\">\n\t\t\t\t${TextFormat.encode(content).replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.#textContainer, 'keyup', this.#onKeyUp.bind(this));\n\t\tEvent.bind(this.#textContainer, 'paste', event => setTimeout(this.#onPaste.bind(this, event)));\n\n\t\treturn this.#textContainer;\n\t}\n\n\t#onPaste(event: ClipboardEvent): void\n\t{\n\t\tthis.#textContainer.innerHTML = this.#textContainer.innerText.replaceAll('\\n', '<br>');\n\n\t\tconst range = document.createRange();\n\t\trange.selectNodeContents(this.#textContainer);\n\t\trange.collapse(false)\n\n\t\tconst selection = document.getSelection();\n\t\tselection.removeAllRanges();\n\t\tselection.addRange(range);\n\n\t\tthis.setText(\n\t\t\tthis.#textContainer\n\t\t\t\t.innerHTML\n\t\t\t\t.replaceAll('<br>', '[br]'),\n\t\t);\n\t\tthis.onChange();\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Text.defaultTextBlockPaddingStyles };\n\t}\n}","import { Cache, Dom, Loc, Tag, Text as TextFormat, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { FieldSelector } from 'sign.v2.b2e.field-selector';\nimport type { FieldSelectEvent, FieldSelectEventData } from '../../types/events/fieldSelectEvent';\nimport Dummy from '../dummy';\n\nexport default class B2eReference extends Dummy\n{\n\t#cache = new Cache.MemoryCache();\n\t#field: string;\n\t#actionButton: HTMLElement;\n\t#content: HTMLElement;\n\n\tstatic #loadFieldsPromise: ?Promise<any> = null;\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any): void\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field ?? '';\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\t\tif (Type.isStringFilled(this.data?.text))\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"sign-document__block-b2e-reference\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || '').toString()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t${Loc.getMessage('SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#field))\n\t\t{\n\t\t\tthis.#loadFieldAndCategoryCaption()\n\t\t\t\t.then(({ categoryCaption, fieldCaption }) => {\n\t\t\t\t\tthis.#setActionButtonLabel(fieldCaption);\n\t\t\t\t\tif (!Type.isStringFilled(this.data?.text))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setContentText(\n\t\t\t\t\t\t\tType.isStringFilled(categoryCaption) && Type.isStringFilled(fieldCaption)\n\t\t\t\t\t\t\t\t? Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE_NO_DATA_CONTENT_TEMPLATE', {\n\t\t\t\t\t\t\t\t\t'#CATEGORY#': categoryCaption,\n\t\t\t\t\t\t\t\t\t'#FIELD#': fieldCaption,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E'),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst blockLayout = this.block.getLayout();\n\t\t\t\t\t\tconst resizeNode = blockLayout.querySelector('.--b2ereference');\n\t\t\t\t\t\tthis.block.resizeText({ element: resizeNode, step: 0.5 });\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\n\t\treturn this.#content;\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t#setContentText(value: ?string): void\n\t{\n\t\tconst text =\n\t\t\tType.isStringFilled(value)\n\t\t\t\t? value\n\t\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE_MSG_VER_1')\n\t\t;\n\t\tthis.#content.textContent = text;\n\t\tthis.#content.title = text;\n\t}\n\n\t#loadFieldAndCategoryCaption(): Promise<{categoryCaption: string, fieldCaption: string}>\n\t{\n\t\tif (!Type.isStringFilled(this.#field))\n\t\t{\n\t\t\treturn Promise.resolve({\n\t\t\t\tcategoryCaption: '',\n\t\t\t\tfieldCaption: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE_MSG_VER_1'),\n\t\t\t});\n\t\t}\n\n\t\tconst defaultCaption = Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE_MSG_VER_1');\n\t\tif (B2eReference.#loadFieldsPromise === null)\n\t\t{\n\t\t\tB2eReference.#loadFieldsPromise = FieldSelector.loadFieldList({});\n\t\t}\n\n\t\treturn B2eReference.#loadFieldsPromise\n\t\t\t.then((fieldList) => {\n\t\t\t\tconst fields = [\n\t\t\t\t\t...fieldList?.PROFILE?.FIELDS ?? [],\n\t\t\t\t];\n\t\t\t\tconst field = fields.find((field) => field.name === this.#field);\n\n\t\t\t\treturn {\n\t\t\t\t\tcategoryCaption: Loc.getMessage('SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E'),\n\t\t\t\t\tfieldCaption: field ? field.caption : defaultCaption,\n\t\t\t\t};\n\t\t\t})\n\t\t;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel(label: ?string)\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionButton = this.#actionButton.querySelector('button');\n\t\tactionButton.textContent = Type.isStringFilled(label)\n\t\t\t? label\n\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE_MSG_VER_1')\n\t\t;\n\t}\n\n\t#getFieldSelectorPanel(): FieldSelector\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\n\t\treturn this.#cache.remember('fieldSelector', () => {\n\t\t\tconst selector = new FieldSelector({\n\t\t\t\tmultiple: false,\n\t\t\t\tcontrollerOptions: {\n\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\thideRequisites: 1,\n\t\t\t\t\thideSmartB2eDocument: 1,\n\t\t\t\t},\n\t\t\t\tlanguages: blocksManager.getLanguages(),\n\t\t\t\tfilter: {\n\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t'PROFILE',\n\t\t\t\t\t],\n\t\t\t\t\t'+fields': this.#getSelectorFieldTypes(),\n\t\t\t\t\t'-fields': [\n\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\ttitle: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE_MSG_VER_1'),\n\t\t\t\tcategoryCaptions: {\n\t\t\t\t\t'PROFILE': Loc.getMessage('SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E')\n\t\t\t\t},\n\t\t\t\tfieldsFactory: this.#getSelectorFieldsFactory(),\n\t\t\t});\n\t\t\tselector.subscribe('onSliderCloseComplete', (event) => this.#onFieldSelectorCloseComplete(event));\n\n\t\t\treturn selector;\n\t\t});\n\t}\n\n\t#getFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t]);\n\t}\n\n\t#onActionClick(): void\n\t{\n\t\tconst fieldSelector = this.#getFieldSelectorPanel();\n\t\tfieldSelector\n\t\t\t.show()\n\t\t\t.then((selectedNames: Array<string>) => {\n\t\t\t\tB2eReference.#updateFieldsList(fieldSelector.getFieldsList(false));\n\t\t\t\tconst eventSelectedNames = [...selectedNames];\n\t\t\t\tif (selectedNames.length === 0 && Type.isStringFilled(this.#field))\n\t\t\t\t{\n\t\t\t\t\teventSelectedNames.push(this.#field);\n\t\t\t\t}\n\t\t\t\tthis.#emitOnFieldSelectEvent(eventSelectedNames);\n\n\t\t\t\tif (selectedNames.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.block.getLayout(), '--invalid');\n\t\t\t\tthis.#field = selectedNames[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t})\n\t\t;\n\t}\n\n\t#emitOnFieldSelectEvent(selectedNames: Array<string>): void\n\t{\n\t\tconst onFieldSelectEventData: FieldSelectEventData = { selectedFieldNames: selectedNames };\n\t\tconst onFieldSelectEvent: FieldSelectEvent = new BaseEvent({ data: onFieldSelectEventData });\n\t\tthis.emit('onFieldSelect', onFieldSelectEvent);\n\t}\n\n\t#onFieldSelectorCloseComplete(event): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\t// event already sended\n\t\t\tif (Type.isStringFilled(this.#field))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#emitOnFieldSelectEvent([]);\n\t\t});\n\t}\n\n\tstatic #updateFieldsList(fields): void\n\t{\n\t\tB2eReference.#loadFieldsPromise = Promise.resolve(fields);\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...B2eReference.defaultTextBlockPaddingStyles };\n\t}\n\n\t#getSelectorFieldTypes(): string[]\n\t{\n\t\tconst types = [\n\t\t\t'list',\n\t\t\t'string',\n\t\t\t'date',\n\t\t\t'typed_string',\n\t\t\t'text',\n\t\t\t'datetime',\n\t\t\t'enumeration',\n\t\t\t'url',\n\t\t\t'double',\n\t\t\t'integer',\n\t\t\t'snils',\n\t\t];\n\n\t\tif (!this.block.blocksManager.isTemplateMode)\n\t\t{\n\t\t\ttypes.push('address');\n\t\t}\n\n\t\treturn types;\n\t}\n\n\t#getSelectorFieldsFactory(): Object | null\n\t{\n\t\tif (this.block.blocksManager.isTemplateMode)\n\t\t{\n\t\t\treturn {\n\t\t\t\tfilter: (fields) => fields.filter((field) => Type.isObject(field)\n\t\t\t\t\t&& Type.isStringFilled(field.name)\n\t\t\t\t\t&& ['list', 'string', 'date', 'enumeration'].includes(field.name)),\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import { Cache, Dom, Loc, Tag, Text as TextFormat, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { FieldSelector } from 'sign.v2.b2e.field-selector';\nimport { DocumentInitiated } from 'sign.type';\nimport type { FieldSelectEvent, FieldSelectEventData } from '../../types/events/fieldSelectEvent';\nimport Dummy from '../dummy';\n\nexport default class MyB2eReference extends Dummy\n{\n\t#cache = new Cache.MemoryCache();\n\t#field: string;\n\t#actionButton: HTMLElement;\n\t#content: HTMLElement;\n\n\tstatic #loadFieldsPromise: ?Promise<any> = null;\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any): void\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field ?? '';\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\t\tif (Type.isStringFilled(this.data?.text))\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"sign-document__block-b2e-reference\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || '').toString()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t${Loc.getMessage('SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_MSG_VER_1')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#field))\n\t\t{\n\t\t\tthis.#loadFieldAndCategoryCaption()\n\t\t\t\t.then(({ categoryCaption, fieldCaption }) => {\n\t\t\t\t\tthis.#setActionButtonLabel(fieldCaption);\n\n\t\t\t\t\tif (!Type.isStringFilled(this.data?.text))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setContentText(\n\t\t\t\t\t\t\tType.isStringFilled(categoryCaption) && Type.isStringFilled(fieldCaption)\n\t\t\t\t\t\t\t\t? Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE_NO_DATA_CONTENT_TEMPLATE', {\n\t\t\t\t\t\t\t\t\t'#CATEGORY#': categoryCaption,\n\t\t\t\t\t\t\t\t\t'#FIELD#': fieldCaption,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_MSG_VER_1'),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst blockLayout = this.block.getLayout();\n\t\t\t\t\t\tconst resizeNode = blockLayout.querySelector('.--myb2ereference');\n\t\t\t\t\t\tthis.block.resizeText({ element: resizeNode, step: 0.5 });\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\n\t\treturn this.#content;\n\t}\n\n\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel(label: ?string)\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionButton = this.#actionButton.querySelector('button');\n\t\tactionButton.textContent = Type.isStringFilled(label)\n\t\t\t? label\n\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_MSG_VER_1')\n\t\t;\n\t}\n\n\t#getFieldSelectorPanel(): FieldSelector\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\tconst { presetId } = member;\n\n\t\treturn this.#cache.remember('fieldSelector', () => {\n\t\t\tconst categories = [\n\t\t\t\t'COMPANY',\n\t\t\t\t'PROFILE',\n\t\t\t];\n\t\t\tif (this.block.blocksManager.documentInitiatedByType !== DocumentInitiated.employee)\n\t\t\t{\n\t\t\t\tcategories.push('SMART_B2E_DOC');\n\t\t\t}\n\n\t\t\tconst selector = new FieldSelector({\n\t\t\t\tmultiple: false,\n\t\t\t\tcontrollerOptions: {\n\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\thideSmartB2eDocument: 1,\n\t\t\t\t\tpresetId,\n\t\t\t\t},\n\t\t\t\tlanguages: blocksManager.getLanguages(),\n\t\t\t\tpresetId,\n\t\t\t\tfilter: {\n\t\t\t\t\t'+categories': categories,\n\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t'list',\n\t\t\t\t\t\t'string',\n\t\t\t\t\t\t'date',\n\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t'text',\n\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t'address',\n\t\t\t\t\t\t'url',\n\t\t\t\t\t\t'double',\n\t\t\t\t\t\t'integer',\n\t\t\t\t\t\t'snils',\n\t\t\t\t\t],\n\t\t\t\t\t'-fields': [\n\t\t\t\t\t\tthis.#getFieldNegativeFilter(),\n\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getCrmFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tcategoryCaptions: {\n\t\t\t\t\t'PROFILE': Loc.getMessage('SIGN_EDITOR_BLOCKS_REPRESENTATIVE_B2E'),\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tselector.subscribe('onSliderCloseComplete', (event) => this.#onFieldSelectorCloseComplete(event));\n\n\t\t\treturn selector;\n\t\t});\n\t}\n\n\t#getFieldsNameBlackList(): Array<string>\n\t{\n\t\treturn [\n\t\t\t'SMART_B2E_DOC_XML_ID',\n\t\t\t'SMART_B2E_DOC_STAGE_ID',\n\n\t\t\t'COMPANY_LINK',\n\t\t\t'COMPANY_REG_ADDRESS',\n\t\t\t'COMPANY_ORIGIN_VERSION',\n\t\t];\n\t}\n\n\t#getCrmFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t]);\n\t}\n\n\t#getFieldNegativeFilter(): (Object) => boolean\n\t{\n\t\tconst blackList = this.#getFieldsNameBlackList();\n\n\t\treturn (field) => {\n\t\t\treturn blackList.includes(field.name);\n\t\t};\n\t}\n\n\t#onActionClick(): void\n\t{\n\t\tconst fieldSelector = this.#getFieldSelectorPanel();\n\t\tfieldSelector\n\t\t\t.show()\n\t\t\t.then((selectedNames: Array<string>) => {\n\t\t\t\tMyB2eReference.#updateFieldsList(fieldSelector.getFieldsList(false));\n\t\t\t\tconst eventSelectedNames = [...selectedNames];\n\t\t\t\tif (selectedNames.length === 0 && Type.isStringFilled(this.#field))\n\t\t\t\t{\n\t\t\t\t\teventSelectedNames.push(this.#field);\n\t\t\t\t}\n\t\t\t\tthis.#emitOnFieldSelectEvent(eventSelectedNames);\n\n\t\t\t\tif (selectedNames.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.block.getLayout(), '--invalid');\n\t\t\t\tthis.#field = selectedNames[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t})\n\t\t;\n\t}\n\n\t#emitOnFieldSelectEvent(selectedNames: Array<string>): void\n\t{\n\t\tconst onFieldSelectEventData: FieldSelectEventData = { selectedFieldNames: selectedNames };\n\t\tconst onFieldSelectEvent: FieldSelectEvent = new BaseEvent({ data: onFieldSelectEventData });\n\t\tthis.emit('onFieldSelect', onFieldSelectEvent);\n\t}\n\n\t#onFieldSelectorCloseComplete(event): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\t// event already sended\n\t\t\tif (Type.isStringFilled(this.#field))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#emitOnFieldSelectEvent([]);\n\t\t});\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...MyB2eReference.defaultTextBlockPaddingStyles };\n\t}\n\n\t#loadFieldAndCategoryCaption(): Promise<{categoryCaption: string, fieldCaption: string}>\n\t{\n\t\tif (!Type.isStringFilled(this.#field))\n\t\t{\n\t\t\treturn Promise.resolve({\n\t\t\t\tcategoryCaption: '',\n\t\t\t\tfieldCaption: Loc.getMessage('SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_MSG_VER_1'),\n\t\t\t});\n\t\t}\n\n\t\tconst defaultCaption = Loc.getMessage('SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_MSG_VER_1');\n\t\tif (MyB2eReference.#loadFieldsPromise === null)\n\t\t{\n\t\t\tconst blocksManager = this.block.blocksManager;\n\t\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\t\tconst { presetId } = member;\n\n\t\t\tMyB2eReference.#loadFieldsPromise = FieldSelector.loadFieldList({\n\t\t\t\thideVirtual: 1,\n\t\t\t\thideRequisites: 1,\n\t\t\t\thideSmartB2eDocument: 1,\n\t\t\t\tpresetId,\n\t\t\t});\n\t\t}\n\n\t\treturn MyB2eReference.#loadFieldsPromise\n\t\t\t.then((fieldList) => {\n\t\t\t\tconst categories = {\n\t\t\t\t\tprofile: fieldList?.PROFILE,\n\t\t\t\t\tdocument: fieldList?.SMART_B2E_DOC,\n\t\t\t\t\tcompany: fieldList?.COMPANY\n\t\t\t\t};\n\t\t\t\tObject.entries(categories)\n\t\t\t\t\t.forEach(([key, category]) => {\n\t\t\t\t\t\tif (category === undefined)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcategory.FIELDS = (category?.FIELDS ?? []).map((field) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...field,\n\t\t\t\t\t\t\t\tcategory: key\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t\tconst fields = [\n\t\t\t\t\t...fieldList?.PROFILE?.FIELDS ?? [],\n\t\t\t\t\t...fieldList?.SMART_B2E_DOC?.FIELDS ?? [],\n\t\t\t\t\t...fieldList?.COMPANY?.FIELDS ?? [],\n\t\t\t\t];\n\n\t\t\t\tconst field = fields.find((field) => field.name === this.#field);\n\t\t\t\tlet categoryCaption = '';\n\t\t\t\tif (Type.isObject(field))\n\t\t\t\t{\n\t\t\t\t\tif (field?.category === 'profile')\n\t\t\t\t\t{\n\t\t\t\t\t\tcategoryCaption = Loc.getMessage('SIGN_EDITOR_BLOCKS_REPRESENTATIVE_B2E');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcategoryCaption = categories[field?.category]?.CAPTION ?? '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tcategoryCaption,\n\t\t\t\t\tfieldCaption: field ? field.caption : defaultCaption,\n\t\t\t\t};\n\t\t\t})\n\t\t;\n\t}\n\n\t#setContentText(value: ?string): void\n\t{\n\t\tconst text =\n\t\t\tType.isStringFilled(value)\n\t\t\t\t? value\n\t\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_MSG_VER_1')\n\t\t;\n\n\t\tthis.#content.textContent = text;\n\t\tthis.#content.title = text;\n\t}\n\n\tstatic #updateFieldsList(fields): void\n\t{\n\t\tMyB2eReference.#loadFieldsPromise = Promise.resolve(fields);\n\t}\n}\n","import { Cache, Dom, Loc, Tag, Text as TextFormat, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { FieldSelector } from 'sign.v2.b2e.field-selector';\nimport type { FieldSelectEvent, FieldSelectEventData } from '../../types/events/fieldSelectEvent';\nimport Dummy from '../dummy';\n\nexport default class EmployeeDynamic extends Dummy\n{\n\t#cache = new Cache.MemoryCache();\n\t#field: string;\n\t#actionButton: HTMLElement;\n\t#content: HTMLElement;\n\n\tstatic #loadFieldsPromise: ?Promise<any> = null;\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any): void\n\t{\n\t\tthis.data = data || {};\n\t\tthis.#field = this.data.field ?? '';\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\t\tif (Type.isStringFilled(this.data?.text))\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"sign-document__block-b2e-reference\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || '').toString()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t${Loc.getMessage('SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#field))\n\t\t{\n\t\t\tthis.#loadFieldAndCategoryCaption()\n\t\t\t\t.then(({ categoryCaption, fieldCaption }) => {\n\t\t\t\t\tthis.#setActionButtonLabel(fieldCaption);\n\t\t\t\t\tif (!Type.isStringFilled(this.data?.text))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setContentText(\n\t\t\t\t\t\t\tType.isStringFilled(categoryCaption) && Type.isStringFilled(fieldCaption)\n\t\t\t\t\t\t\t\t? Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC_NO_DATA_CONTENT_TEMPLATE', {\n\t\t\t\t\t\t\t\t\t'#CATEGORY#': categoryCaption,\n\t\t\t\t\t\t\t\t\t'#FIELD#': fieldCaption,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E'),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst blockLayout = this.block.getLayout();\n\t\t\t\t\t\tconst resizeNode = blockLayout.querySelector('.--employeedynamic');\n\t\t\t\t\t\tthis.block.resizeText({ element: resizeNode, step: 0.5 });\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\n\t\treturn this.#content;\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t#setContentText(value: ?string): void\n\t{\n\t\tconst text = Type.isStringFilled(value)\n\t\t\t? value\n\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC')\n\t\t;\n\t\tthis.#content.textContent = text;\n\t\tthis.#content.title = text;\n\t}\n\n\t#loadFieldAndCategoryCaption(): Promise<{categoryCaption: string, fieldCaption: string}>\n\t{\n\t\tif (!Type.isStringFilled(this.#field))\n\t\t{\n\t\t\treturn Promise.resolve({\n\t\t\t\tcategoryCaption: '',\n\t\t\t\tfieldCaption: Loc.getMessage('SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E'),\n\t\t\t});\n\t\t}\n\n\t\tconst defaultCaption = Loc.getMessage('SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E');\n\t\tif (EmployeeDynamic.#loadFieldsPromise === null)\n\t\t{\n\t\t\tEmployeeDynamic.#loadFieldsPromise = FieldSelector.loadFieldList({});\n\t\t}\n\n\t\treturn EmployeeDynamic.#loadFieldsPromise\n\t\t\t.then((fieldList) => {\n\t\t\t\tconst fields = [\n\t\t\t\t\t...fieldList?.DYNAMIC_MEMBER?.FIELDS ?? [],\n\t\t\t\t];\n\t\t\t\tconst field = fields.find((item) => item.name === this.#field);\n\n\t\t\t\treturn {\n\t\t\t\t\tcategoryCaption: Loc.getMessage('SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E'),\n\t\t\t\t\tfieldCaption: field ? field.caption : defaultCaption,\n\t\t\t\t};\n\t\t\t})\n\t\t;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel(label: ?string)\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionButton = this.#actionButton.querySelector('button');\n\t\tactionButton.textContent = Type.isStringFilled(label)\n\t\t\t? label\n\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC')\n\t\t;\n\t}\n\n\t#getFieldSelectorPanel(): FieldSelector\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\n\t\treturn this.#cache.remember('fieldSelector', () => {\n\t\t\tconst selector = new FieldSelector({\n\t\t\t\tmultiple: false,\n\t\t\t\tcontrollerOptions: {\n\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\thideRequisites: 1,\n\t\t\t\t\thideSmartB2eDocument: 1,\n\t\t\t\t},\n\t\t\t\tlanguages: blocksManager.getLanguages(),\n\t\t\t\tfilter: {\n\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t'DYNAMIC_MEMBER',\n\t\t\t\t\t],\n\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t'list',\n\t\t\t\t\t\t'string',\n\t\t\t\t\t\t'date',\n\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t'text',\n\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t'url',\n\t\t\t\t\t\t'double',\n\t\t\t\t\t\t'integer',\n\t\t\t\t\t\t'snils',\n\t\t\t\t\t],\n\t\t\t\t\t'-fields': [\n\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t],\n\t\t\t\t\tallowEmptyFieldList: true,\n\t\t\t\t},\n\t\t\t\ttitle: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC'),\n\t\t\t\tcategoryCaptions: {\n\t\t\t\t\tDYNAMIC_MEMBER: Loc.getMessage('SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E'),\n\t\t\t\t},\n\t\t\t\tfieldsFactory: {\n\t\t\t\t\tfilter: (fields) => fields.filter((field) => Type.isObject(field)\n\t\t\t\t\t\t&& Type.isStringFilled(field.name)\n\t\t\t\t\t\t&& ['list', 'string', 'date', 'enumeration'].includes(field.name)),\n\t\t\t\t},\n\t\t\t});\n\t\t\tselector.subscribe('onSliderCloseComplete', (event) => this.#onFieldSelectorCloseComplete(event));\n\n\t\t\treturn selector;\n\t\t});\n\t}\n\n\t#getFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t]);\n\t}\n\n\t#onActionClick(): void\n\t{\n\t\tconst fieldSelector = this.#getFieldSelectorPanel();\n\t\tfieldSelector\n\t\t\t.show()\n\t\t\t.then((selectedNames: Array<string>) => {\n\t\t\t\tEmployeeDynamic.#updateFieldsList(fieldSelector.getFieldsList(false));\n\t\t\t\tconst eventSelectedNames = [...selectedNames];\n\t\t\t\tif (selectedNames.length === 0 && Type.isStringFilled(this.#field))\n\t\t\t\t{\n\t\t\t\t\teventSelectedNames.push(this.#field);\n\t\t\t\t}\n\t\t\t\tthis.#emitOnFieldSelectEvent(eventSelectedNames);\n\n\t\t\t\tif (selectedNames.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.block.getLayout(), '--invalid');\n\t\t\t\tthis.#field = selectedNames[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t})\n\t\t;\n\t}\n\n\t#emitOnFieldSelectEvent(selectedNames: Array<string>): void\n\t{\n\t\tconst onFieldSelectEventData: FieldSelectEventData = { selectedFieldNames: selectedNames };\n\t\tconst onFieldSelectEvent: FieldSelectEvent = new BaseEvent({ data: onFieldSelectEventData });\n\t\tthis.emit('onFieldSelect', onFieldSelectEvent);\n\t}\n\n\t#onFieldSelectorCloseComplete(event): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\t// event already sended\n\t\t\tif (Type.isStringFilled(this.#field))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#emitOnFieldSelectEvent([]);\n\t\t});\n\t}\n\n\tstatic #updateFieldsList(fields): void\n\t{\n\t\tEmployeeDynamic.#loadFieldsPromise = Promise.resolve(fields);\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...EmployeeDynamic.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { Cache, Dom, Loc, Tag, Text as TextFormat, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { FieldSelector } from 'sign.v2.b2e.field-selector';\nimport type { FieldSelectEvent, FieldSelectEventData } from '../../types/events/fieldSelectEvent';\nimport Dummy from '../dummy';\n\nexport default class HcmLinkReference extends Dummy\n{\n\t#cache = new Cache.MemoryCache();\n\t#field: string;\n\t#actionButton: HTMLElement;\n\t#content: HTMLElement;\n\n\tstatic #loadFieldsPromise: ?Promise<any> = null;\n\tstatic #lastLoadFieldsDocumentUid: string | null = null;\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any): void\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field ?? '';\n\n\t\tconst party = this.#extractPartyFromSelectedField(this.#field);\n\t\tif (party > 0)\n\t\t{\n\t\t\tthis.block.setMemberParty(party);\n\t\t}\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\t\tif (Type.isStringFilled(this.data?.text))\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"sign-document__block-b2e-hcmlinkreference\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || '').toString()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t${Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#field))\n\t\t{\n\t\t\tthis.#loadFieldAndCategoryCaption()\n\t\t\t\t.then(({ categoryCaption, fieldCaption }) => {\n\t\t\t\t\tthis.#setActionButtonLabel(fieldCaption);\n\t\t\t\t\tif (!Type.isStringFilled(this.data?.text))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setContentText(\n\t\t\t\t\t\t\tType.isStringFilled(categoryCaption) && Type.isStringFilled(fieldCaption)\n\t\t\t\t\t\t\t\t? Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE_NO_DATA_CONTENT_TEMPLATE', {\n\t\t\t\t\t\t\t\t\t'#CATEGORY#': categoryCaption,\n\t\t\t\t\t\t\t\t\t'#FIELD#': fieldCaption,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE'),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst blockLayout = this.block.getLayout();\n\t\t\t\t\t\tconst resizeNode = blockLayout.querySelector('.--hcmlinkreference');\n\t\t\t\t\t\tthis.block.resizeText({ element: resizeNode, step: 0.5 });\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\n\t\treturn this.#content;\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t#setContentText(value: ?string): void\n\t{\n\t\tconst text =\n\t\t\tType.isStringFilled(value)\n\t\t\t\t? value\n\t\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE')\n\t\t;\n\t\tthis.#content.textContent = text;\n\t\tthis.#content.title = text;\n\t}\n\n\t#loadFieldAndCategoryCaption(): Promise<{categoryCaption: string, fieldCaption: string}>\n\t{\n\t\tif (!Type.isStringFilled(this.#field))\n\t\t{\n\t\t\treturn Promise.resolve({\n\t\t\t\tcategoryCaption: '',\n\t\t\t\tfieldCaption: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE'),\n\t\t\t});\n\t\t}\n\n\t\tconst defaultCaption = Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE');\n\n\t\tconst documentUid = this.block.blocksManager.getDocumentUid();\n\t\tif (HcmLinkReference.#loadFieldsPromise === null || documentUid !== HcmLinkReference.#lastLoadFieldsDocumentUid)\n\t\t{\n\t\t\tHcmLinkReference.#lastLoadFieldsDocumentUid = documentUid;\n\t\t\tHcmLinkReference.#loadFieldsPromise = FieldSelector.loadFieldList({}, this.#getCustomBackendSettings());\n\t\t}\n\n\t\treturn HcmLinkReference.#loadFieldsPromise\n\t\t\t.then((fieldList) => {\n\t\t\t\tconst categories = {\n\t\t\t\t\trepresentative: fieldList?.REPRESENTATIVE,\n\t\t\t\t\temployee: fieldList?.EMPLOYEE,\n\t\t\t\t\tcompany: fieldList?.COMPANY,\n\t\t\t\t};\n\t\t\t\tObject.entries(categories)\n\t\t\t\t\t.forEach(([key, category]) => {\n\t\t\t\t\t\tif (category === undefined)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcategory.FIELDS = (category?.FIELDS ?? []).map((field) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...field,\n\t\t\t\t\t\t\t\tcategory: key\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t\tconst fields = [\n\t\t\t\t\t...fieldList?.REPRESENTATIVE?.FIELDS ?? [],\n\t\t\t\t\t...fieldList?.EMPLOYEE?.FIELDS ?? [],\n\t\t\t\t\t...fieldList?.COMPANY?.FIELDS ?? [],\n\t\t\t\t];\n\n\t\t\t\tconst field = fields.find((field) => field.name === this.#field);\n\t\t\t\tlet categoryCaption = '';\n\t\t\t\tif (Type.isObject(field))\n\t\t\t\t{\n\t\t\t\t\tif (field?.category === 'representative')\n\t\t\t\t\t{\n\t\t\t\t\t\tcategoryCaption = Loc.getMessage('SIGN_EDITOR_BLOCKS_REPRESENTATIVE_B2E');\n\t\t\t\t\t}\n\t\t\t\t\telse if (field?.category === 'employee')\n\t\t\t\t\t{\n\t\t\t\t\t\tcategoryCaption = Loc.getMessage('SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E');\n\t\t\t\t\t}\n\t\t\t\t\telse if (field?.category === 'company')\n\t\t\t\t\t{\n\t\t\t\t\t\tcategoryCaption = Loc.getMessage('SIGN_EDITOR_BLOCKS_COMPANY');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcategoryCaption = categories[field?.category]?.CAPTION ?? '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tcategoryCaption,\n\t\t\t\t\tfieldCaption: field ? field.caption : defaultCaption,\n\t\t\t\t};\n\t\t\t})\n\t\t;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel(label: ?string)\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionButton = this.#actionButton.querySelector('button');\n\t\tactionButton.textContent = Type.isStringFilled(label)\n\t\t\t? label\n\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE')\n\t\t;\n\t}\n\n\t#getFieldSelectorPanel(): FieldSelector\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\n\t\tconst fieldSelector = this.#cache.remember('fieldSelector', () => {\n\t\t\tconst selector = new FieldSelector({\n\t\t\t\tmultiple: false,\n\t\t\t\tlanguages: blocksManager.getLanguages(),\n\t\t\t\tfilter: {\n\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t'REPRESENTATIVE',\n\t\t\t\t\t\t'EMPLOYEE',\n\t\t\t\t\t],\n\t\t\t\t\t'+fields': [\n\n\t\t\t\t\t],\n\t\t\t\t\t'-fields': [\n\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\ttitle: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE'),\n\t\t\t\tcategoryCaptions: {\n\t\t\t\t\t'REPRESENTATIVE': Loc.getMessage('SIGN_EDITOR_BLOCKS_REPRESENTATIVE_B2E'),\n\t\t\t\t\t'EMPLOYEE': Loc.getMessage('SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E'),\n\t\t\t\t\t'COMPANY': Loc.getMessage('SIGN_EDITOR_BLOCKS_COMPANY'),\n\t\t\t\t},\n\t\t\t\talwaysHideCreateFieldButton: true,\n\t\t\t});\n\t\t\tselector.subscribe('onSliderCloseComplete', (event) => this.#onFieldSelectorCloseComplete(event));\n\n\t\t\treturn selector;\n\t\t});\n\n\t\tfieldSelector.setCustomBackendSettings(this.#getCustomBackendSettings());\n\n\t\treturn fieldSelector;\n\t}\n\n\t#getFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\n\t\t]);\n\t}\n\n\t#onActionClick(): void\n\t{\n\t\tconst fieldSelector = this.#getFieldSelectorPanel();\n\t\tfieldSelector\n\t\t\t.show()\n\t\t\t.then((selectedNames: Array<string>) => {\n\t\t\t\tlet list = fieldSelector.getFieldsList(false)\n\t\t\t\tHcmLinkReference.#updateFieldsList(list);\n\t\t\t\tconst eventSelectedNames = [...selectedNames];\n\t\t\t\tif (selectedNames.length === 0 && Type.isStringFilled(this.#field))\n\t\t\t\t{\n\t\t\t\t\teventSelectedNames.push(this.#field);\n\t\t\t\t}\n\t\t\t\tthis.#emitOnFieldSelectEvent(eventSelectedNames);\n\n\t\t\t\tif (selectedNames.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.block.getLayout(), '--invalid');\n\t\t\t\tthis.#field = selectedNames[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t})\n\t\t;\n\t}\n\n\t#emitOnFieldSelectEvent(selectedNames: Array<string>): void\n\t{\n\t\tconst onFieldSelectEventData: FieldSelectEventData = { selectedFieldNames: selectedNames };\n\t\tconst onFieldSelectEvent: FieldSelectEvent = new BaseEvent({ data: onFieldSelectEventData });\n\t\tthis.emit('onFieldSelect', onFieldSelectEvent);\n\t}\n\n\t#onFieldSelectorCloseComplete(event): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\t// event already sended\n\t\t\tif (Type.isStringFilled(this.#field))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#emitOnFieldSelectEvent([]);\n\t\t});\n\t}\n\n\t#extractPartyFromSelectedField(fieldName: string): number | null\n\t{\n\t\tif (!Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst splitedName = fieldName.split('_');\n\n\t\treturn splitedName[3]\n\t\t\t? Number(splitedName[3])\n\t\t\t: null\n\t\t;\n\t}\n\n\tstatic #updateFieldsList(fields): void\n\t{\n\t\tHcmLinkReference.#loadFieldsPromise = Promise.resolve(fields);\n\t}\n\n\t#getCustomBackendSettings(): Object\n\t{\n\t\treturn {\n\t\t\turi: 'sign.api_v1.integration.humanresources.hcmLink.loadFields',\n\t\t\trequestOptions: {\n\t\t\t\tdocumentUid: this.block.blocksManager.getDocumentUid(),\n\t\t\t},\n\t\t};\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...this.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { Dom, Event, Loc, Tag, Text as TextFormat, Reflection, Type } from 'main.core';\nimport { UI as SignUI } from 'sign.ui';\nimport { ColorPickerOptions } from '../../../../document/src/ui';\nimport { MemberItem } from '../types/document';\nimport '../style.css';\nimport 'color_picker';\n\ntype BlockLayoutOptions = {\n\tonRemove: () => {},\n\tonSave: () => {}\n};\n\nconst ColorPicker = Reflection.getClass('BX.ColorPicker');\n\nexport default class UI\n{\n\t/**\n\t * Sets width/height/top/left to element.\n\t * @param {HTMLElement} element\n\t * @param {{[key: string]: number}} rect\n\t */\n\tstatic setRect(element: HTMLElement, rect: {[key: string]: number})\n\t{\n\t\tObject.keys(rect).map(key => {\n\t\t\trect[key] = `${Math.round(rect[key])}px`;\n\t\t});\n\t\tDom.style(element, rect);\n\t}\n\n\t/**\n\t * Returns block's layout.\n\t * @param {BlockLayoutOptions} options Layout options.\n\t * @return {HTMLElement}\n\t */\n\tstatic getBlockLayout(options: BlockLayoutOptions): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-wrapper\">\n\t\t\t\t<div class=\"sign-document__block-panel--wrapper\" data-role=\"sign-block__actions\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-content\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-actions\">\n\t\t\t\t\t<div class=\"sign-document__block-actions--wrapper\">\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --remove sign-block-action-remove\" data-role=\"removeAction\" onclick=\"${options.onRemove}\"></button>\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --save sign-block-action-save\" data-role=\"saveAction\" onclick=\"${options.onSave}\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns member selector for block.\n\t * @param {Array<MemberItem>} members All document's members.\n\t * @param {number} selectedValue Selected member.\n\t * @param {() => {}} onChange Handler on change value.\n\t * @return {HTMLElement}\n\t */\n\tstatic getMemberSelector(members: Array<MemberItem>, selectedValue: number,  onChange: () => {}): HTMLElement\n\t{\n\t\tconst menuItems = {};\n\t\tlet selectedName = Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\n\t\tmembers.map(member => {\n\t\t\tmember.name = member.name || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\t\t\tmenuItems[member.part] = member.name;\n\n\t\t\tif (member.part === selectedValue)\n\t\t\t{\n\t\t\t\tselectedName = member.name;\n\t\t\t}\n\t\t});\n\n\t\tconst memberSelector = (members.length > 1)\n\t\t\t? Tag.render`<span>${TextFormat.encode(selectedName)}</span>`\n\t\t\t: Tag.render`<i>${TextFormat.encode(selectedName)}</i>`;\n\n\t\tif (members.length > 1)\n\t\t{\n\t\t\tSignUI.bindSimpleMenu({\n\t\t\t\tbindElement: memberSelector,\n\t\t\t\titems: menuItems,\n\t\t\t\tactionHandler: value => {\n\t\t\t\t\tmemberSelector.innerHTML = menuItems[value];\n\t\t\t\t\tonChange(parseInt(value));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-block-member-wrapper\">\n\t\t\t\t${memberSelector}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns resizing area's layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getResizeArea(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__resize-area\">\n\t\t\t\t<div class=\"sign-area-resizable-controls\">\n\t\t\t\t\t<span class=\"sign-document__move-control\"></span>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-right\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --left-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-left\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns style panel layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getStylePanel(\n\t\tactionHandler: (actionName: string, actionValue: string) => {},\n\t\tcollectStyles: {[key: string]: string}\n\t): HTMLElement\n\t{\n\t\t// font family selector\n\t\tconst fonts = {\n\t\t\t'\"Times New Roman\", Times':   '<span style=\"font-family: \\'Times New Roman\\', Times\">Times New Roman</span>',\n\t\t\t'\"Courier New\"':              '<span style=\"font-family: \\'Courier New\\'\">Courier New</span>',\n\t\t\t'Arial, Helvetica':           '<span style=\"font-family: Arial, Helvetica\">Arial / Helvetica</span>',\n\t\t\t'\"Arial Black\", Gadget':      '<span style=\"font-family: \\'Arial Black\\', Gadget\">Arial Black</span>',\n\t\t\t'Tahoma, Geneva':             '<span style=\"font-family: Tahoma, Geneva\">Tahoma / Geneva</span>',\n\t\t\t'Verdana':                    '<span style=\"font-family: Verdana\">Verdana</span>',\n\t\t\t'Georgia, serif':             '<span style=\"font-family: Georgia, serif\">Georgia</span>',\n\t\t\t'monospace':                  '<span style=\"font-family: monospace\">monospace</span>',\n\t\t};\n\t\tconst fontFamily = Tag.render`<div class=\"sign-document__block-style-btn --btn-font-family\">${fonts[collectStyles['fontFamily']] || 'Font'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontFamily,\n\t\t\titems: fonts,\n\t\t\tactionHandler: value => {\n\t\t\t\tfontFamily.innerHTML = fonts[value];\n\t\t\t\tactionHandler('family', value);\n\t\t\t}\n\t\t});\n\n\t\t// font size selector\n\n\t\tlet fontSizereal = parseInt(collectStyles['fontSize']);\n\t\tlet fontSizeValue = 14;\n\n\t\tif (fontSizereal)\n\t\t{\n\t\t\tfontSizeValue = fontSizereal;\n\t\t}\n\n\t\tconst fontSize = Tag.render`<div class=\"sign-document__block-style-btn --btn-fontsize\">${fontSizeValue+ 'px' || '<i></i>'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontSize,\n\t\t\titems: [\n\t\t\t\t'6px', '7px', '8px', '9px', '10px', '11px', '12px', '13px', '14px', '15px', '16px',\n\t\t\t\t'18px', '20px', '22px', '24px', '26px', '28px', '36px', '48px', '72px'\n\t\t\t],\n\t\t\tactionHandler: value => {\n\t\t\t\tfontSize.innerHTML = parseInt(value) + 'px';\n\t\t\t\tactionHandler('size', value);\n\t\t\t},\n\t\t\tcurrentValue: fontSizeValue\n\t\t});\n\n\t\tconst { layout: fontColor } = UI.getColorSelectorBtn(\n\t\t\tcollectStyles.color ?? '#000',\n\t\t\t(color) => actionHandler('color', color),\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style--panel\">\n<!--\t\t\t\t<div class=\"sign-document__block-style&#45;&#45;move-control\"></div>-->\n\t\t\t\t${fontFamily}\n\t\t\t\t${fontSize}\n\t\t\t\t${fontColor}\n\t\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-bold\" data-action=\"bold\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-italic\" data-action=\"italic\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-underline\" data-action=\"underline\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-strike\" data-action=\"through\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-left\" data-action=\"left\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-center\" data-action=\"center\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-right\" data-action=\"right\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-justify\" data-action=\"justify\"><i></i></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tstatic getColorSelectorBtn(\n\t\tdefaultColorPickerColor: string,\n\t\tonColorSelect: (string) => any,\n\t\tcolorPickerOptions: ColorPickerOptions = {},\n\t): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\tconst layout = Tag.render`<div class=\"sign-document__block-style-btn --btn-color\">\n\t\t\t\t<span class=\"sign-document__block-style-btn--color-block\"></span> \n\t\t\t\t<span>${Loc.getMessage('SIGN_JS_DOCUMENT_STYLE_COLOR')}</span>\n\t\t\t</div>`\n\t\t;\n\t\tUI.updateColorSelectorBtnColor(layout, defaultColorPickerColor);\n\t\tconst updatedColorPickerOptions = {\n\t\t\t...colorPickerOptions,\n\t\t\tbindElement: layout,\n\t\t\tonColorSelected:\n\t\t\t\t(color) => {\n\t\t\t\t\tonColorSelect(color);\n\t\t\t\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\t\t\t},\n\t\t};\n\n\t\tconst picker = new ColorPicker(updatedColorPickerOptions);\n\n\t\tEvent.bind(layout, 'click', () => {\n\t\t\tpicker.open();\n\t\t});\n\n\t\treturn { layout, colorPicker: picker };\n\t}\n\n\tstatic updateColorSelectorBtnColor(layout: HTMLElement, color: string): void\n\t{\n\t\tconst circleColor = layout.querySelector('.sign-document__block-style-btn--color-block');\n\t\tif (Type.isNil(circleColor))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(\n\t\t\tcircleColor,\n\t\t\t'background-color',\n\t\t\tcolor,\n\t\t);\n\t}\n}\n","import { Dom, Event } from 'main.core';\nimport Block from './block';\nimport UI from './ui';\n\ntype StyleOptions = {\n\tblock: Block,\n\tdata: {[key: string]: string}\n};\n\nexport default class Style\n{\n\t#block: Block;\n\n\t#buttons = {\n\t\tfamily: {\n\t\t\tproperty: 'fontFamily',\n\t\t\tvalue: null\n\t\t},\n\t\tsize: {\n\t\t\tproperty: 'fontSize',\n\t\t\tvalue: 14\n\t\t},\n\t\tcolor: {\n\t\t\tproperty: 'color',\n\t\t\tvalue: null\n\t\t},\n\t\tbold: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'fontWeight',\n\t\t\tvalue: 'bold',\n\t\t\tstate: false\n\t\t},\n\t\titalic: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'fontStyle',\n\t\t\tvalue: 'italic',\n\t\t\tstate: false\n\t\t},\n\t\tunderline: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textDecoration',\n\t\t\tvalue: 'underline',\n\t\t\tstate: false\n\t\t},\n\t\tthrough: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textDecoration',\n\t\t\tvalue: 'line-through',\n\t\t\tstate: false\n\t\t},\n\t\tleft: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'left',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tcenter: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'center',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tright: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'right',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tjustify: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'justify',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t}\n\t};\n\n\t#style = {\n\t\tbuttonPressed: 'sign-document__block-style--button-pressed'\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {StyleOptions} options\n\t */\n\tconstructor(options: StyleOptions)\n\t{\n\t\tthis.#block = options.block;\n\n\t\tif (options.data)\n\t\t{\n\t\t\tthis.#applyData(options.data);\n\t\t}\n\t}\n\n\t/**\n\t * Handle on panel button click.\n\t * @param {string} code\n\t */\n\t#onPressButton(code: string)\n\t{\n\t\tthis.#buttons[code]['state'] = !this.#buttons[code]['state'];\n\n\t\tif (this.#buttons[code]['state'])\n\t\t{\n\t\t\tDom.addClass(this.#buttons[code]['button'], this.#style.buttonPressed);\n\n\t\t\tif (this.#buttons[code]['group'])\n\t\t\t{\n\t\t\t\tconst group = this.#buttons[code]['group'];\n\n\t\t\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\t\t\tif (key !== code && this.#buttons[key]['group'] === group)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#buttons[key]['state'] = false;\n\t\t\t\t\t\tDom.removeClass(this.#buttons[key]['button'], this.#style.buttonPressed);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.#buttons[code]['button'], this.#style.buttonPressed);\n\t\t}\n\n\t\tthis.#block.renderStyle();\n\t}\n\n\t/**\n\t * Applies initiated data to current state.\n\t * @param {{[key: string]: string}} data\n\t */\n\t#applyData(data: {[key: string]: string})\n\t{\n\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\tconst property = this.#buttons[key]['property'];\n\n\t\t\tif (data[property])\n\t\t\t{\n\t\t\t\tif (typeof this.#buttons[key]['state'] !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tif (data[property].indexOf(this.#buttons[key]['value']) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#buttons[key]['state'] = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#buttons[key]['value'] = data[property];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Applies collected styles to the element.\n\t * @param {HTMLElement} element\n\t */\n\tapplyStyles(element: HTMLElement)\n\t{\n\t\telement.removeAttribute('style');\n\t\tDom.style(element, this.collectStyles());\n\t}\n\n\tupdateFontSize(fontSize)\n\t{\n\t\tif (fontSize)\n\t\t{\n\t\t\tthis.#buttons.size['property'] = 'fontSize';\n\t\t\tthis.#buttons.size['value'] = fontSize;\n\t\t}\n\t}\n\n\t/**\n\t * Collects checked styles in one dataset.\n\t * @return {{[key: string]: string}}\n\t */\n\tcollectStyles(): {[key: string]: string}\n\t{\n\t\tconst styles = {};\n\n\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\tif (this.#buttons[key]['state'] || (typeof this.#buttons[key]['state'] === 'undefined'))\n\t\t\t{\n\t\t\t\tconst property = this.#buttons[key]['property'];\n\t\t\t\tconst value = this.#buttons[key]['value'];\n\n\t\t\t\tif (value === null)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.#buttons[key]['group'])\n\t\t\t\t{\n\t\t\t\t\tstyles[property] = value;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tstyles[property] = (styles[property] ? styles[property] + ' ' : '') + value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn styles;\n\t}\n\n\t/**\n\t * Returns style panel layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\tconst layout = UI.getStylePanel(\n\t\t\t(code: string, value: string) => {\n\t\t\t\tthis.#buttons[code]['value'] = value;\n\t\t\t\tthis.#block.renderStyle();\n\t\t\t},\n\t\t\tthis.collectStyles()\n\t\t);\n\n\t\t[...layout.querySelectorAll('[data-action]')].map(button => {\n\t\t\t\tconst action = button.getAttribute('data-action');\n\n\t\t\tif (this.#buttons[action])\n\t\t\t{\n\t\t\t\tEvent.bind(button, 'click', () => this.#onPressButton(action));\n\t\t\t\tthis.#buttons[action]['button'] = button;\n\n\t\t\t\tif (this.#buttons[action]['state'])\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.#buttons[action]['button'], this.#style.buttonPressed);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn layout;\n\t}\n\n\tupdateColor(color: string): void\n\t{\n\t\tthis.#buttons.color.value = color;\n\t}\n}\n","import { Dom, Event, Type } from 'main.core';\nimport { Backend } from 'sign.backend';\nimport { EventEmitter } from 'main.core.events';\nimport { Api } from 'sign.v2.api';\nimport type { FieldSelectEvent } from '../types/events/fieldSelectEvent';\nimport { Date, Dummy, MyRequisites, MySign, MyStamp, Number, Reference, Requisites, Sign, Stamp, Text, MyReference, B2eReference, MyB2eReference, EmployeeDynamic, HcmLinkReference } from './index';\nimport { BlocksManager } from './blocksManager';\nimport Style from './style';\nimport { PositionType, BlockOptions } from '../types/block';\nimport UI from './ui';\n\nexport default class Block extends EventEmitter\n{\n\tevents = {\n\t\tonColorStyleChange: 'onColorStyleChange',\n\t};\n\n\t#id: number;\n\t#code: string;\n\t#layout: HTMLElement;\n\t#stylePanel: Style;\n\t#content: Dummy = null;\n\tblocksManager: BlocksManager;\n\t#memberPart: number = 2;\n\t#panelCreated: boolean = false;\n\t#allowMembers: boolean = false;\n\t#onClickCallback: ?() => {};\n\t#onRemoveCallback: ?() => {};\n\t#contentProviders = {\n\t\tdate: Date,\n\t\tmyrequisites: MyRequisites,\n\t\tmysign: MySign,\n\t\tmystamp: MyStamp,\n\t\tnumber: Number,\n\t\treference: Reference,\n\t\tmyreference: MyReference,\n\t\trequisites: Requisites,\n\t\tsign: Sign,\n\t\tstamp: Stamp,\n\t\ttext: Text,\n\n\t\tb2ereference: B2eReference,\n\t\tmyb2ereference: MyB2eReference,\n\t\temployeedynamic: EmployeeDynamic,\n\n\t\thcmlinkreference: HcmLinkReference,\n\t};\n\t#currentFontSize: String;\n\n\t#style = {\n\t\tblockContent: '.sign-document__block-content',\n\t\tblockPanel: '.sign-document__block-panel--wrapper',\n\t\tblockLoading: 'sign-document-block-loading',\n\t\tblockEditing: 'sign-document__block-wrapper-editing',\n\t\tpageWithNotAllowed: 'sign-editor__content-document--active-move',\n\t};\n\n\t#firstRenderReady: boolean;\n\n\t#api: Api;\n\n\t/**\n\t * Constructor.\n\t * @param {BlockOptions} options\n\t */\n\tconstructor(options: BlockOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.Editor.Block');\n\t\tthis.blocksManager = options.blocksManager;\n\t\tthis.#id = options.id || null;\n\t\tthis.#code = options.code;\n\t\tthis.#memberPart = options.party;\n\t\tthis.#onClickCallback = options.onClick;\n\t\tthis.#onRemoveCallback = options.onRemove;\n\t\tthis.#firstRenderReady = null;\n\t\tthis.#stylePanel = new Style({\n\t\t\tblock: this,\n\t\t\tdata: options.style\n\t\t});\n\t\tif (!this.#contentProviders[this.#code])\n\t\t{\n\t\t\tthrow new Error(`Content provider for '${this.#code}' not found.`);\n\t\t}\n\n\t\tthis.#content = new this.#contentProviders[this.#code](this);\n\n\t\tif (['sign', 'mysign'].includes(this.#code) && Type.isString(options.style?.color))\n\t\t{\n\t\t\tthis.#content.changeStyleColor(options.style.color, false);\n\t\t}\n\n\t\tthis.#createLayout();\n\n\t\tEvent.bind(this.#layout, 'click', this.#onClick.bind(this));\n\n\t\tif (\n\t\t\toptions.party > 1\n\t\t\t&& !['b2ereference', 'employeedynamic', 'hcmlinkreference'].includes(this.#code.toLowerCase()))\n\t\t{\n\t\t\tthis.#allowMembers = true;\n\t\t}\n\n\t\tthis.renderStyle();\n\n\t\tthis.setPosition(options.position ?? this.#content.getInitDimension());\n\n\t\tif (options.data)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.setData(options.data);\n\t\t\t}, 0);\n\t\t}\n\t\tthis.#api = new Api();\n\t}\n\n\t/**\n\t * Returns block's layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#layout;\n\t}\n\n\t/**\n\t * Sets new data to the block.\n\t * @param {any} data\n\t */\n\tsetData(data: any): void\n\t{\n\t\tthis.#content.setData(data);\n\t\tthis.renderView();\n\t}\n\n\t/**\n\t * Sets initial position to the block.\n\t * @param {PositionType} position\n\t */\n\tsetPosition(position: PositionType)\n\t{\n\t\tUI.setRect(this.#layout, position);\n\t}\n\n\t/**\n\t * Returns block's data.\n\t * @return {any}\n\t */\n\tgetData(): any\n\t{\n\t\treturn this.#content.getData();\n\t}\n\n\t/**\n\t * Returns position.\n\t * @return {PositionType}\n\t */\n\tgetPosition(): PositionType\n\t{\n\t\tlet {top, left, width, height} = this.#layout.getBoundingClientRect();\n\t\tconst layout = this.#layout;\n\t\ttop = Math.round(top);\n\t\tleft = Math.round(left);\n\t\twidth = Math.round(width);\n\t\theight = Math.round(height);\n\n\t\tconst documentRect = this.blocksManager.getLayout().getBoundingClientRect();\n\n\t\ttop -= Math.round(documentRect.top);\n\t\tleft -= Math.round(documentRect.left);\n\n\t\treturn {top, left, width, height};\n\t}\n\n\t/**\n\t * Returns block styles.\n\t * @return {{{[key: string]: string}}}\n\t */\n\tgetStyle(): {[key: string]: string}\n\t{\n\t\treturn { ...this.#content.getStyles(), ...this.#stylePanel.collectStyles() };\n\t}\n\n\t/**\n\t * Returns id.\n\t * @return {number|null}\n\t */\n\tgetId(): ?number\n\t{\n\t\treturn this.#id ?? null;\n\t}\n\n\t/**\n\t * Returns code.\n\t * @return {string}\n\t */\n\tgetCode(): string\n\t{\n\t\treturn this.#code;\n\t}\n\n\t/**\n\t * Shows page's areas not allowed for block's placement.\n\t */\n\tshowNotAllowedArea()\n\t{\n\t\tconst {page} = this.blocksManager.transferPositionToPage(this.getPosition());\n\t\tconst pageElement = document.querySelector(`.sign-editor__content-document--page[data-page=\"${page}\"]`);\n\n\t\tDom.addClass(pageElement, this.#style.pageWithNotAllowed);\n\t}\n\n\thideNotAllowedArea()\n\t{\n\t\tconst {page} = this.blocksManager.transferPositionToPage(this.getPosition());\n\t\tconst pageElement = document.querySelector(`.sign-editor__content-document--page[data-page=\"${page}\"]`);\n\n\t\tDom.removeClass(pageElement, this.#style.pageWithNotAllowed);\n\t}\n\n\t/**\n\t * Returns member part.\n\t * @return {number}\n\t */\n\tgetMemberPart(): number\n\t{\n\t\treturn this.#memberPart;\n\t}\n\n\t/**\n\t * Handler on click to block.\n\t */\n\t#onClick()\n\t{\n\t\tif (this.#onClickCallback)\n\t\t{\n\t\t\tthis.#onClickCallback(this);\n\t\t}\n\t}\n\n\t/**\n\t * Calls block's action.\n\t */\n\tfireAction()\n\t{\n\t\tif (this.#content['onActionClick'])\n\t\t{\n\t\t\tif (this.#code === 'text')\n\t\t\t{\n\t\t\t\tDom.addClass(this.#layout, this.#style.blockEditing);\n\t\t\t}\n\t\t\tthis.#content['onActionClick']();\n\t\t}\n\t}\n\n\t/**\n\t * Handler on member change.\n\t * @param {number} part\n\t */\n\tonMemberSelect(part: number)\n\t{\n\t\tthis.#memberPart = part;\n\t\tthis.assign();\n\t}\n\n\t/**\n\t * Sets/removes awaiting class to the block.\n\t * @param {boolean} flag\n\t */\n\tawait(flag: boolean)\n\t{\n\t\tconst blockLayouts = [];\n\n\t\tif (!this.#content.isSingleton())\n\t\t{\n\t\t\tblockLayouts.push(this.getLayout());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst currentCode = this.getCode();\n\n\t\t\tthis.blocksManager.getBlocks().map(block => {\n\t\t\t\tif (block.getCode() === currentCode)\n\t\t\t\t{\n\t\t\t\t\tblockLayouts.push(block.getLayout());\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tblockLayouts.map((blockLayout, key) => {\n\t\t\tif (flag)\n\t\t\t{\n\t\t\t\tif (blockLayouts.length === key + 1)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(blockLayout, this.#style.blockLoading);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(blockLayout, this.#style.blockLoading);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Assigns block to the document (without saving).\n\t */\n\tassign()\n\t{\n\t\tconst blockLayout = this.getLayout();\n\t\tconst blocksData = [];\n\t\tconst blocksInstance = [];\n\n\t\tthis.await(true);\n\n\t\tif (!this.#content.isSingleton())\n\t\t{\n\t\t\tblocksData.push({\n\t\t\t\tcode: this.#code,\n\t\t\t\tpart: this.#memberPart,\n\t\t\t\tdata: this.getData()\n\t\t\t});\n\t\t\tblocksInstance.push(this);\n\t\t}\n\t\t// if block is a singleton push all blocks with same code\n\t\telse\n\t\t{\n\t\t\tthis.blocksManager.getBlocks().map(block => {\n\t\t\t\tif (\n\t\t\t\t\tblock.getCode() === this.getCode() &&\n\t\t\t\t\tblock.getMemberPart() === this.getMemberPart()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tblocksData.push({\n\t\t\t\t\t\tcode: block.getCode(),\n\t\t\t\t\t\tpart: block.getMemberPart(),\n\t\t\t\t\t\tdata: block.getData()\n\t\t\t\t\t});\n\t\t\t\t\tblocksInstance.push(block);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.#api.loadBlocksData(\n\t\t\tthis.blocksManager.getDocumentUid(),\n\t\t\tblocksData\n\t\t).then(result => {\n\t\t\tif (Type.isArray(result))\n\t\t\t{\n\t\t\t\tresult.forEach((block, i) => {\n\t\t\t\t\tblocksInstance[i].setData(block.data);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.await(false);\n\t\t\tthis.blocksManager.showResizeArea(this);\n\t\t})\n\t\t.catch((response) => {\n\t\t\tDom.remove(blockLayout);\n\t\t});\n\t}\n\n\t/**\n\t * Renders block within document's layout.\n\t */\n\trenderView()\n\t{\n\t\tconst contentTag = this.#layout.querySelector(this.#style.blockContent);\n\n\t\t// content\n\t\tDom.clean(contentTag);\n\n\t\tswitch (this.#code.toLowerCase())\n\t\t{\n\t\t\tcase 'stamp':\n\t\t\tcase 'mystamp':\n\t\t\tcase 'sign':\n\t\t\tcase 'mysign':\n\t\t\t\tDom.addClass(contentTag, '--image')\n\t\t}\n\n\t\tconst resizeNode = this.#content.getViewContent();\n\n\t\tDom.append(resizeNode, contentTag);\n\n\t\tDom.addClass(resizeNode, '--' + this.#code.toLowerCase());\n\n\t\tif (\n\t\t\tthis.#code.toLowerCase() === 'requisites'\n\t\t\t|| this.#code.toLowerCase() === 'myrequisites'\n\t\t\t|| this.#code.toLowerCase() === 'date'\n\t\t\t|| this.#code.toLowerCase() === 'number'\n\t\t\t|| this.#code.toLowerCase() === 'stamp'\n\t\t\t|| this.#code.toLowerCase() === 'mystamp'\n\t\t\t|| this.#code.toLowerCase() === 'sign'\n\t\t\t|| this.#code.toLowerCase() === 'mysign'\n\t\t\t|| this.#code.toLowerCase() === 'reference'\n\t\t\t|| this.#code.toLowerCase() === 'myreference'\n\t\t\t|| this.#code.toLowerCase() === 'text'\n\t\t\t|| this.#code.toLowerCase() === 'b2ereference'\n\t\t\t|| this.#code.toLowerCase() === 'myb2ereference'\n\t\t\t|| this.#code.toLowerCase() === 'employeedynamic'\n\t\t\t|| this.#code.toLowerCase() === 'hcmlinkreference'\n\t\t)\n\t\t{\n\t\t\tresizeNode.style.setProperty('display', 'block');\n\t\t\tresizeNode.style.setProperty('overflow', 'hidden');\n\n\t\t\tif (!this.observerReady)\n\t\t\t{\n\t\t\t\tif (this.getStyle()['fontSize'])\n\t\t\t\t{\n\t\t\t\t\tthis.maxTextSize = parseFloat(this.getStyle()['fontSize']);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.maxTextSize = 14;\n\t\t\t\t}\n\n\t\t\t\tthis.isOverflownX = ({ clientHeight, scrollHeight }) => {\n\t\t\t\t\treturn scrollHeight > clientHeight;\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.subscribe(resizeNode.parentNode.parentNode, 'BX.Sign:setFontSize', (param)=> {\n\t\t\t\t\tif (param.data.fontSize)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.maxTextSize = param.data.fontSize;\n\t\t\t\t\t\tthis.resizeText({\n\t\t\t\t\t\t\telement: param.target.querySelector('.sign-document__block-content > div'),\n\t\t\t\t\t\t\tstep: 0.5\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.resizeText = ({ element, minSize = 1, step = 1, unit = 'px' }) => {\n\n\t\t\t\t\tif (this.intervalTextResize)\n\t\t\t\t\t{\n\t\t\t\t\t\tclearTimeout(this.intervalTextResize);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet i = minSize;\n\t\t\t\t\tlet overflow = false;\n\n\t\t\t\t\tconst parent = element.parentNode\n\n\t\t\t\t\twhile (!overflow && i <= this.maxTextSize)\n\t\t\t\t\t{\n\t\t\t\t\t\telement.style.fontSize = `${i}${unit}`;\n\t\t\t\t\t\toverflow = this.isOverflownX(parent);\n\t\t\t\t\t\ti += step;\n\t\t\t\t\t}\n\t\t\t\t\tthis.#currentFontSize = `${i - step}${unit}`;\n\t\t\t\t\telement.style.fontSize = this.#currentFontSize;\n\n\t\t\t\t\tthis.intervalTextResize = setTimeout(() => {\n\t\t\t\t\t\telement.parentNode.style.setProperty('font-size', element.style.fontSize);\n\t\t\t\t\t\telement.style.removeProperty('font-size', element.style.fontSize);\n\t\t\t\t\t\tthis.#stylePanel.updateFontSize(this.#currentFontSize);\n\t\t\t\t\t}, 1000);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tthis.#code.toLowerCase() === 'requisites'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'myrequisites'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'reference'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'myreference'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'text'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.resizeText({\n\t\t\t\t\t\telement: resizeNode,\n\t\t\t\t\t\tstep: 0.5\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.#content.subscribe(this.#content.events.onChange, this.#onContentChange.bind(this));\n\t\t\t\tthis.#content.subscribe(this.#content.events.onColorStyleChange, this.#onContentColorStyleChange.bind(this));\n\t\t\t\tthis.#content.subscribe('onFieldSelect', this.#onFieldSelect.bind(this));\n\n\t\t\t\tthis.observerReady = true;\n\t\t\t}\n\n\t\t\tif (this.#firstRenderReady)\n\t\t\t{\n\t\t\t\tthis.resizeText({\n\t\t\t\t\telement: resizeNode,\n\t\t\t\t\tstep: 0.5\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.#firstRenderReady = true;\n\n\t\tif (this.#panelCreated)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// action / style panel\n\t\tconst panelTag = this.#layout.querySelector(this.#style.blockPanel);\n\t\tDom.clean(panelTag);\n\n\t\t// style\n\t\tif (this.#content.isStyleAllowed())\n\t\t{\n\t\t\tDom.append(this.#stylePanel.getLayout(), panelTag);\n\t\t}\n\n\t\t// action\n\t\tDom.append(this.#content.getActionButton(), panelTag);\n\n\t\t// block caption\n\t\tDom.append(this.#content.getBlockCaption(), panelTag);\n\n\t\t// member selector\n\t\tif (this.#allowMembers)\n\t\t{\n\t\t\tif (\n\t\t\t\t['hcmlinkreference', 'b2ereference'].includes(this.#code.toLowerCase())\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst allMembers = this.blocksManager.getMembers();\n\t\t\tconst selectedMembers = allMembers.filter((member) => {\n\t\t\t\treturn member.part > 1\n\t\t\t});\n\n\t\t\tDom.append(UI.getMemberSelector(\n\t\t\t\tselectedMembers,\n\t\t\t\tthis.#memberPart,\n\t\t\t\tthis.onMemberSelect.bind(this)\n\t\t\t), panelTag);\n\t\t}\n\n\t\tthis.#panelCreated = true;\n\t}\n\n\tgetCurrentFontSize()\n\t{\n\t\treturn this.#currentFontSize;\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t\tthis.#content.onStartChangePosition();\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#content.onPlaced();\n\t}\n\n\tupdateColor(color: string, emitEvent: boolean = true): void\n\t{\n\t\tthis.#content.changeStyleColor(color, emitEvent);\n\t\tthis.#stylePanel.updateColor(color);\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t\tthis.#content.onSave();\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t\tthis.#content.onRemove();\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tthis.#content.onClickOut();\n\t}\n\n\t/**\n\t * Set block styles to layout.\n\t */\n\trenderStyle()\n\t{\n\t\tthis.#stylePanel.applyStyles(\n\t\t\tthis.#layout.querySelector(this.#style.blockContent)\n\t\t);\n\t}\n\n\t/**\n\t * Adjust actions panel.\n\t */\n\tadjustActionsPanel()\n\t{\n\t\tconst blockLayout = this.getLayout();\n\t\tconst documentLayout = this.blocksManager.getLayout().parentElement;\n\t\tconst documentLayoutRect = documentLayout.getBoundingClientRect();\n\t\tconst actionsPanel = blockLayout.querySelector('[data-role=\"sign-block__actions\"]');\n\n\t\tif (actionsPanel)\n\t\t{\n\t\t\tconst actionsPanelRect = actionsPanel.getBoundingClientRect();\n\t\t\tconst marginLeft = parseFloat(getComputedStyle(actionsPanel).marginLeft);\n\n\t\t\tif (documentLayoutRect.x >= actionsPanelRect.x)\n\t\t\t{\n\t\t\t\tactionsPanel.style.marginLeft = documentLayoutRect.x - actionsPanelRect.x + marginLeft + 'px';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tactionsPanel.style.marginLeft = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Force saves the block.\n\t */\n\tforceSave()\n\t{\n\t\tthis.#layout.querySelector('[data-role=\"saveAction\"]').click();\n\t}\n\n\t/**\n\t * Creates layout for new block within document.\n\t */\n\t#createLayout()\n\t{\n\t\tthis.#layout = UI.getBlockLayout({\n\t\t\tonSave: (event) => {\n\t\t\t\tthis.renderView();\n\t\t\t\tthis.blocksManager.unMuteResizeArea();\n\t\t\t\tthis.blocksManager.hideResizeArea();\n\t\t\t\tthis.blocksManager.setSavingMark(false);\n\t\t\t\tthis.onSave();\n\n\t\t\t\tDom.removeClass(this.#layout, this.#style.blockEditing);\n\n\t\t\t\tevent.stopPropagation();\n\t\t\t},\n\t\t\tonRemove: this.#onRemoveBtnClick.bind(this),\n\t\t});\n\t\tconst nodeForPosition = document.body.querySelector('.sign-editor__content');\n\t\tconst documentLayout = this.blocksManager.getLayout();\n\t\tconst documentLayoutRect = documentLayout.getBoundingClientRect();\n\t\tconst blockInitDim = this.#content.getInitDimension();\n\t\tconst position = {\n\t\t\ttop: Math.min(nodeForPosition.scrollTop + nodeForPosition.offsetHeight / 2, documentLayoutRect.height - blockInitDim.height),\n\t\t\tleft: documentLayoutRect.width / 2 - 100\n\t\t};\n\n\t\tif (this.blocksManager.inDeadZone(position.top, position.top + blockInitDim.height))\n\t\t{\n\t\t\tposition.top += blockInitDim.height + this.blocksManager.getPagesGap();\n\t\t}\n\n\t\tthis.setPosition(position);\n\t}\n\n\tremove(): void\n\t{\n\t\tif (this.#onRemoveCallback)\n\t\t{\n\t\t\tthis.#onRemoveCallback(this);\n\t\t}\n\t\tthis.#layout.hidden = true;\n\t\tthis.onRemove();\n\t}\n\n\t#onRemoveBtnClick(event): void\n\t{\n\t\tthis.remove();\n\t\tevent.stopPropagation();\n\t}\n\n\t/**\n\t * Returns true, if block was removed.\n\t * @return {boolean}\n\t */\n\tisRemoved()\n\t{\n\t\treturn this.#layout.hidden === true;\n\t}\n\n\t#onContentChange(): void\n\t{\n\t\tconst content = this.#content;\n\t\tif (!(content instanceof Text))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.resizeText({ element: content.getContainer(), step: 0.5 });\n\t}\n\n\t#onContentColorStyleChange(event): void\n\t{\n\t\tthis.emit(this.events.onColorStyleChange, { color: this.#content.getStyles()?.color ?? null });\n\t\tconst color = this.#content.getStyles()?.color ?? null;\n\t\tif (Type.isString(color))\n\t\t{\n\t\t\tthis.#stylePanel.updateColor(color);\n\t\t}\n\t}\n\n\t#onFieldSelect(event: FieldSelectEvent): void\n\t{\n\t\tthis.emit('onFieldSelect', event);\n\t}\n\n\tsetMemberParty(party: Number): void\n\t{\n\t\tthis.#memberPart = party;\n\t}\n}\n","import { Dom, Event, Type } from 'main.core';\nimport { Draggable, DragMoveEvent, DragStartEvent, DragEndEvent } from 'ui.draganddrop.draggable';\nimport { EventEmitter } from 'main.core.events';\nimport Block from './block';\nimport UI from './ui';\n\ntype ResizeOptions = {\n\twrapperLayout: HTMLElement\n};\n\nexport default class Resize\n{\n\tstatic borderDelta = 2;\n\n\t#wrapperLayout: HTMLElement;\n\t#layout: HTMLElement;\n\t#fullEditorContent: HTMLElement;\n\t#linkedElement: HTMLElement;\n\t#linkedBlock: Block;\n\n\tposition: DOMRect;\n\tpositionLast: { ...DOMRect, notAddDeathMargin?: boolean };\n\tresizing: boolean;\n\tmoving: boolean;\n\n\t#style = {\n\t\tresizeContainer: '.sign-area-resizable-controls > div',\n\t\tmoveContainer: '.sign-document__resize-area',\n\t\tblockEditing: 'sign-document__block-wrapper-editing'\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {ResizeOptions} options\n\t */\n\tconstructor(options: ResizeOptions)\n\t{\n\t\tif (!Type.isDomNode(options.wrapperLayout))\n\t\t{\n\t\t\tthrow new Error('Option wrapperLayout is undefined or not valid DOM Element.');\n\t\t}\n\n\t\tthis.#layout = UI.getResizeArea();\n\t\tthis.#wrapperLayout = options.wrapperLayout;\n\t\tEvent.bind(this.#layout, 'click', this.#onClick.bind(this));\n\n\t\tthis.#initResize();\n\t\tthis.#initMove();\n\t}\n\n\t/**\n\t * Returns layout of resizing area.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#layout;\n\t}\n\n\t/**\n\t * Shows resizing area over the element.\n\t * @param {Block} block\n\t */\n\tshow(block: Block)\n\t{\n\t\tif (this.#linkedBlock === block)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst pointRect = block.getLayout().getBoundingClientRect();\n\t\tthis.#layout.style.display = 'block';\n\n\t\tif (this.#linkedElement)\n\t\t{\n\t\t\tthis.#linkedElement.removeAttribute('data-active');\n\t\t}\n\t\tthis.#linkedBlock = block;\n\t\tthis.#linkedElement = block.getLayout();\n\t\tthis.#linkedElement.setAttribute('data-active', 1);\n\t\tconst wrapperLayoutRect = this.#wrapperLayout.getBoundingClientRect();\n\t\tUI.setRect(this.#layout, {\n\t\t\ttop: pointRect.top - wrapperLayoutRect.top,\n\t\t\tleft: pointRect.left - wrapperLayoutRect.left,\n\t\t\twidth: pointRect.width + Resize.borderDelta,\n\t\t\theight: pointRect.height + Resize.borderDelta,\n\t\t});\n\t}\n\n\tsetFullEditorContent(editorContent: HTMLElement)\n\t{\n\t\tthis.#fullEditorContent = editorContent;\n\t}\n\n\t/**\n\t * Hides resizing area.\n\t */\n\thide()\n\t{\n\t\tthis.#linkedBlock = null;\n\t\tthis.#layout.style.display = 'none';\n\n\t\tif (this.#linkedElement)\n\t\t{\n\t\t\tthis.#linkedElement.removeAttribute('data-active');\n\t\t}\n\t}\n\n\t/**\n\t * Returns linked block.\n\t * @return {Block|null}\n\t */\n\tgetLinkedBlock(): ?Block\n\t{\n\t\treturn this.#linkedBlock;\n\t}\n\n\t/**\n\t * On click handler (provide click to linked element).\n\t */\n\t#onClick(e)\n\t{\n\t\tif (this.moving || this.resizing)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#linkedBlock)\n\t\t{\n\t\t\tthis.#linkedBlock.fireAction();\n\t\t}\n\t}\n\n\t/**\n\t * Initializes resizing.\n\t */\n\t#initResize()\n\t{\n\t\tlet initialRect = null;\n\n\t\tconst draggable = new Draggable({\n\t\t\tcontainer: this.#wrapperLayout,\n\t\t\tdraggable: this.#style.resizeContainer,\n\t\t\ttype: BX.UI.DragAndDrop.Draggable.HEADLESS\n\t\t});\n\n\t\tthis.textResize = {\n\t\t\twrapper: null,\n\t\t\tcontent: null\n\t\t};\n\n\t\tdraggable\n\t\t\t.subscribe('start', (event: DragStartEvent) => {\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!this.textResize.wrapper || !this.textResize.content)\n\t\t\t\t{\n\t\t\t\t\tthis.textResize = {\n\t\t\t\t\t\twrapper: this.#linkedBlock.getLayout(),\n\t\t\t\t\t\tcontent: this.#linkedBlock.getLayout().querySelector('.sign-document__block-content')\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.emit('BX.Sign:resizeStart', draggable);\n\t\t\t\tinitialRect = this.#layout.getBoundingClientRect();\n\t\t\t\tthis.#linkedBlock.onStartChangePosition();\n\t\t\t\tthis.positionLast = null;\n\n\t\t\t\tDom.removeClass(this.#linkedBlock.getLayout(), this.#style.blockEditing);\n\t\t\t})\n\t\t\t.subscribe('end', (event: DragEndEvent) => {\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.resizing = false;\n\t\t\t\t}, 0);\n\n\t\t\t})\n\t\t\t.subscribe('move', (event) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.resizing = true;\n\n\t\t\t\tlet left = null;\n\t\t\t\tlet top = null;\n\t\t\t\tlet bottomResize = false;\n\t\t\t\tlet {width, height} = initialRect;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tconst areaRect = this.#layout.getBoundingClientRect();\n\t\t\t\tconst wrapperRect = this.#wrapperLayout.getBoundingClientRect();\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --left-top'))\n\t\t\t\t{\n\t\t\t\t\tleft = Math.max(0, initialRect.left + data.offsetX - wrapperRect.left);\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - wrapperRect.top);\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-top'))\n\t\t\t\t{\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - wrapperRect.top);\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --right-top'))\n\t\t\t\t{\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - wrapperRect.top);\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-right'))\n\t\t\t\t{\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --right-bottom'))\n\t\t\t\t{\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-bottom'))\n\t\t\t\t{\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --left-bottom'))\n\t\t\t\t{\n\t\t\t\t\tleft = initialRect.left + data.offsetX - wrapperRect.left;\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-left'))\n\t\t\t\t{\n\t\t\t\t\tleft = initialRect.left + data.offsetX - wrapperRect.left;\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t}\n\n\t\t\t\tif (width < 60 || height < 20)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst newPosition = { width, height };\n\n\t\t\t\tif (newPosition['width'] + areaRect.left - wrapperRect.left > wrapperRect.width)\n\t\t\t\t{\n\t\t\t\t\twidth = newPosition['width'] = wrapperRect.width + wrapperRect.left - areaRect.left;\n\t\t\t\t}\n\n\t\t\t\tif (newPosition['height'] + areaRect.top - wrapperRect.top > wrapperRect.height)\n\t\t\t\t{\n\t\t\t\t\theight = newPosition['height'] = wrapperRect.height + wrapperRect.top - areaRect.top;\n\t\t\t\t}\n\n\t\t\t\tif (left)\n\t\t\t\t{\n\t\t\t\t\tif (left < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tleft = 0;\n\t\t\t\t\t}\n\t\t\t\t\tnewPosition['left'] = left;\n\t\t\t\t}\n\t\t\t\tif (top)\n\t\t\t\t{\n\t\t\t\t\tnewPosition['top'] = top;\n\t\t\t\t}\n\n\t\t\t\tlet calcDeathTop = initialRect.top;\n\t\t\t\tlet notAddDeathMargin = true;\n\t\t\t\tif (newPosition.top)\n\t\t\t\t{\n\t\t\t\t\tcalcDeathTop = newPosition.top;\n\t\t\t\t\tnotAddDeathMargin = false;\n\t\t\t\t}\n\n\t\t\t\tif (this.#linkedBlock.blocksManager.inDeadZone(calcDeathTop, calcDeathTop + newPosition.height, notAddDeathMargin))\n\t\t\t\t{\n\t\t\t\t\tif (!bottomResize)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.showNotAllowedArea();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst newPositionLinked = Object.assign({}, {\n\t\t\t\t\t...newPosition,\n\t\t\t\t\twidth: width - Resize.borderDelta,\n\t\t\t\t\theight: height - Resize.borderDelta,\n\t\t\t\t});\n\n\t\t\t\tUI.setRect(this.#layout, newPosition);\n\t\t\t\tUI.setRect(this.#linkedElement, newPositionLinked);\n\n\t\t\t\tthis.#linkedBlock.renderView();\n\t\t\t\tthis.#linkedBlock.blocksManager.setSavingMark(false);\n\t\t\t\tthis.#linkedBlock.adjustActionsPanel();\n\t\t\t});\n\t}\n\n\t/**\n\t * Initializes moving.\n\t */\n\t#initMove()\n\t{\n\t\tconst dragArea = this.#wrapperLayout;\n\t\tlet widthInProcess;\n\n\t\tconst draggable = new Draggable({\n\t\t\tcontainer: dragArea,\n\t\t\tdraggable: this.#style.moveContainer,\n\t\t\ttype: Draggable.HEADLESS\n\t\t});\n\n\t\tdraggable\n\t\t\t.subscribe('start', (event: DragStartEvent) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.emit('BX.Sign:moveStart', draggable);\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst {source} = event.getData();\n\t\t\t\tthis.position = Dom.getPosition(source);\n\t\t\t\tthis.#linkedBlock.onStartChangePosition();\n\t\t\t\tthis.positionLast = null;\n\n\t\t\t\tDom.removeClass(this.#linkedBlock.getLayout(), this.#style.blockEditing);\n\t\t\t})\n\t\t\t.subscribe('end', (event: DragEndEvent) => {\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.moving = false;\n\t\t\t\t}, 0);\n\n\t\t\t\tif (!this.#linkedBlock)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twidthInProcess = null;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tlet moveTopDelta = null;\n\t\t\t\tif (this.positionLast)\n\t\t\t\t{\n\t\t\t\t\tmoveTopDelta = this.#linkedBlock.blocksManager.inDeadZone(this.positionLast.top, this.positionLast.top + this.positionLast.height);\n\t\t\t\t}\n\n\t\t\t\tthis.#linkedBlock.hideNotAllowedArea();\n\n\t\t\t\tif (moveTopDelta)\n\t\t\t\t{\n\t\t\t\t\tUI.setRect(data.source, {top: this.positionLast.top + moveTopDelta});\n\t\t\t\t\tUI.setRect(this.#linkedElement, {top: this.positionLast.top + moveTopDelta});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('move', (event: DragMoveEvent) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.moving = true;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tconst {source, offsetY, offsetX} = data;\n\t\t\t\tconst areaRect = data.source.getBoundingClientRect();\n\t\t\t\tconst wrapperRect = this.#wrapperLayout.getBoundingClientRect();\n\n\t\t\t\tif (this.position)\n\t\t\t\t{\n\t\t\t\t\tconst newPosition = {\n\t\t\t\t\t\ttop: offsetY - wrapperRect.top + this.position.y,\n\t\t\t\t\t\tleft: offsetX - wrapperRect.left + this.position.x,\n\t\t\t\t\t\twidth: widthInProcess ? widthInProcess : this.position.width,\n\t\t\t\t\t\theight: this.position.height\n\t\t\t\t\t};\n\n\t\t\t\t\tif (newPosition.left < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.left = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.top < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.top = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.top + areaRect.height > wrapperRect.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.top = wrapperRect.height - areaRect.height;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.left + areaRect.width > wrapperRect.width)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.renderView();\n\t\t\t\t\t\tif (wrapperRect.width - newPosition.left > 50)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twidthInProcess = newPosition.width = wrapperRect.width - newPosition.left;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnewPosition.left = wrapperRect.width - areaRect.width;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.positionLast = Object.assign({}, newPosition);\n\n\t\t\t\t\tlet moveTopDelta = null;\n\n\t\t\t\t\tif (this.positionLast)\n\t\t\t\t\t{\n\t\t\t\t\t\tmoveTopDelta = this.#linkedBlock.blocksManager.inDeadZone(this.positionLast.top, this.positionLast.top + this.positionLast.height);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (moveTopDelta > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.showNotAllowedArea();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.hideNotAllowedArea();\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newPositionLinked = Object.assign({}, {\n\t\t\t\t\t\t...newPosition,\n\t\t\t\t\t\twidth: newPosition.width - Resize.borderDelta,\n\t\t\t\t\t\theight: newPosition.height - Resize.borderDelta,\n\t\t\t\t\t});\n\n\t\t\t\t\tUI.setRect(source, newPosition);\n\t\t\t\t\tUI.setRect(this.#linkedElement, newPositionLinked);\n\n\t\t\t\t\tthis.#linkedBlock.blocksManager.setSavingMark(false);\n\t\t\t\t\tthis.#linkedBlock.adjustActionsPanel();\n\t\t\t\t}\n\t\t\t});\n\t}\n}\n","import { Dom, Event, Loc, Text, Type, Cache } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Backend } from 'sign.backend';\nimport { Guide } from 'sign.tour';\nimport { Api } from 'sign.v2.api';\nimport 'spotlight';\nimport type { DocumentInitiatedType } from 'sign.type';\nimport { Button, ButtonColor } from 'ui.buttons';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport 'ui.info-helper';\nimport { UI } from 'ui.notification';\nimport { BlockItem, Config, DocumentOptions, MemberItem, PositionType } from '../types/document';\nimport type { FieldSelectEvent } from '../types/events/FieldSelectEvent';\nimport Block from './block';\nimport Resize from './resize';\n\nconst marginTop = 0;\nconst gapBetweenPages = 20;\n\ntype EventListenerCache = Map<Block, {\n\tsubscription: (Block) => void,\n\teventName: string,\n}>;\n\nexport class BlocksManager\n{\n\t#documentId: number;\n\t#documentUid: string;\n\t#companyId: number;\n\t#initiatorName: string;\n\t#entityId: number;\n\t#blankId: number;\n\t#pagesMinHeight: number = 0;\n\t#disableEdit: boolean;\n\t#closeDemoContent: boolean = false;\n\t#members: Array<MemberItem>;\n\t#documentLayout: HTMLElement;\n\tresizeArea: Resize;\n\t#languages: { [key: string]: { NAME: string; IS_BETA: boolean; } } = {};\n\t#blocks: Array<Block> = [];\n\t#eventListeners: { [eventListenerCacheName: string]: EventListenerCache } = {\n\t\tblockColorChange: new Map(),\n\t\tblockReferenceFieldSelect: new Map(),\n\t\tblockB2eReferenceFieldSelect: new Map(),\n\t};\n\t#pagesRects: Array<DOMRect> = [];\n\t#seams: Array<Array<number, number>> = [];\n\t#config: Config;\n\t#helpBtnElementId = 'sign-editor-help-btn';\n\t#helpBtnHelperArticleCode = '16571388';\n\t#api: Api;\n\t#lastContainerSize;\n\t#cache: Cache.MemoryCache = new Cache.MemoryCache();\n\tisTemplateMode: boolean = false;\n\tdocumentInitiatedByType: DocumentInitiatedType | null = null;\n\n\t/**\n\t * Constructor.\n\t * @param {DocumentOptions} options\n\t */\n\tconstructor(options: DocumentOptions)\n\t{\n\t\tconst { documentLayout, disableEdit, isTemplateMode, documentInitiatedByType } = options;\n\t\tthis.isTemplateMode = Boolean(isTemplateMode);\n\t\tthis.documentInitiatedByType = documentInitiatedByType;\n\t\tthis.#documentLayout = documentLayout;\n\t\tthis.#disableEdit = disableEdit;\n\t\tif (!this.#disableEdit)\n\t\t{\n\t\t\tthis.resizeArea = new Resize({ wrapperLayout: this.#documentLayout });\n\t\t\tDom.append(this.resizeArea.getLayout(), this.#documentLayout);\n\t\t}\n\n\t\tEvent.bind(documentLayout, 'click', ({ target }) => {\n\t\t\tconst preventClickOut = target.closest('.sign-document__block-wrapper') ||\n\t\t\t\ttarget.closest('.sign-document__resize-area');\n\t\t\tif (preventClickOut)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst activeBlock = this.resizeArea.getLinkedBlock();\n\t\t\tactiveBlock?.onClickOut();\n\t\t});\n\t\tthis.#languages = options.languages;\n\t\tthis.#api = new Api();\n\t\tthis.#lastContainerSize = {\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t};\n\t}\n\n\tinitPagesRect()\n\t{\n\t\tlet top = 0;\n\t\tconst pages = [...this.#documentLayout.querySelectorAll('.sign-editor__document_page img')];\n\t\tthis.#pagesRects = [];\n\t\tthis.#seams = [];\n\t\tconst content = document.querySelector('.sign-editor__content');\n\t\tpages.forEach(page => {\n\t\t\tconst pageRect = page.getBoundingClientRect();\n\t\t\tconst pageRectToMath = {};\n\n\t\t\t// round getBoundingClientRect\n\t\t\tfor (let pageRectKey in pageRect)\n\t\t\t{\n\t\t\t\tif (Type.isNumber(pageRect[pageRectKey]))\n\t\t\t\t{\n\t\t\t\t\tpageRectToMath[pageRectKey] = Math.round(pageRect[pageRectKey]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpageRectToMath[pageRectKey] = pageRect[pageRectKey];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst topBound = top === 0 ? 0 : pageRectToMath.top - gapBetweenPages + content.scrollTop;\n\t\t\tconst bottomBound = pageRectToMath.top + marginTop + content.scrollTop;\n\t\t\t// collect seam's gaps\n\t\t\tthis.#seams.push([topBound, bottomBound]);\n\n\t\t\t// correct top after rounding\n\t\t\tif (top === 0)\n\t\t\t{\n\t\t\t\ttop = pageRectToMath.top;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttop += gapBetweenPages;\n\t\t\t\tpageRectToMath.top = top;\n\t\t\t}\n\n\t\t\t// collect pages rects\n\t\t\tthis.#pagesRects.push(pageRectToMath);\n\n\t\t\t// remember min page height\n\t\t\tif (!this.#pagesMinHeight || pageRect.height < this.#pagesMinHeight)\n\t\t\t{\n\t\t\t\tthis.#pagesMinHeight = pageRect.height;\n\t\t\t}\n\t\t});\n\t\tthis.#documentLayout.style.width = `${this.#documentLayout.offsetWidth}px`;\n\t}\n\n\t/**\n\t * Transfers absolute position to page position and sets page number.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\ttransferPositionToPage(position: PositionType): PositionType\n\t{\n\t\tposition.page = 1;\n\n\t\tfor (\n\t\t\tlet i = 0,\n\t\t\t\tc = this.#pagesRects.length; i < c; i++\n\t\t)\n\t\t{\n\t\t\tconst height = this.#pagesRects[i].height;\n\n\t\t\tif (i !== 0) // skip gap for first page\n\t\t\t{\n\t\t\t\tposition.top -= gapBetweenPages;\n\t\t\t}\n\n\t\t\tposition.top -= height;\n\t\t\tif (position.top < 0)\n\t\t\t{\n\t\t\t\tposition.top += height;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tposition.page++;\n\t\t\t}\n\t\t}\n\n\t\treturn position;\n\t}\n\n\t/**\n\t * Transfers pixel of position to percent.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\t#pixelToPercent(position: PositionType, pageRect): PositionType\n\t{\n\t\tposition.widthPx = position.width;\n\t\tposition.heightPx = position.height;\n\t\tposition.left = position.left * 100 / pageRect.width;\n\t\tposition.top = position.top * 100 / pageRect.height;\n\t\tposition.width = position.width / pageRect.width * 100;\n\t\tposition.height = position.height / pageRect.height * 100;\n\n\t\treturn position;\n\t}\n\n\t/**\n\t * Transfers percent of position to pixel.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\t#percentToPixel(position: PositionType): PositionType\n\t{\n\t\tif (!position.page || typeof this.#pagesRects[position.page - 1] === 'undefined')\n\t\t{\n\t\t\treturn position;\n\t\t}\n\n\t\tconst pageImageRect = this.#pagesRects[position.page - 1];\n\t\tconst pixelPosition = {};\n\n\t\tif (typeof position.left === 'number')\n\t\t{\n\t\t\tpixelPosition.left = position.left * pageImageRect.width / 100;\n\t\t}\n\t\tif (typeof position.top === 'number')\n\t\t{\n\t\t\tlet top = position.top * pageImageRect.height / 100;\n\t\t\tlet pageNum = 0;\n\t\t\twhile (pageNum < position.page - 1)\n\t\t\t{\n\t\t\t\ttop += this.#pagesRects[pageNum].height + gapBetweenPages;\n\t\t\t\tpageNum++;\n\t\t\t}\n\n\t\t\tpixelPosition.top = top;\n\t\t}\n\t\tif (typeof position.width === 'number')\n\t\t{\n\t\t\tpixelPosition.width = position.width * pageImageRect.width / 100;\n\t\t}\n\t\tif (typeof position.height === 'number')\n\t\t{\n\t\t\tpixelPosition.height = position.height * pageImageRect.height / 100;\n\t\t}\n\n\t\treturn pixelPosition;\n\t}\n\n\t/**\n\t * Returns minimal pages height.\n\t * @return {number}\n\t */\n\tgetMinPageHeight(): number\n\t{\n\t\treturn this.#pagesMinHeight - marginTop;\n\t}\n\n\t/**\n\t * Returns document id.\n\t * @return {number}\n\t */\n\tgetDocumentId(): number\n\t{\n\t\treturn this.#documentId;\n\t}\n\n\tsetDocumentId(documentId: number): self\n\t{\n\t\tthis.#documentId = documentId;\n\n\t\treturn this;\n\t}\n\n\tgetDocumentUid(): string\n\t{\n\t\treturn this.#documentUid;\n\t}\n\n\tsetEditorContent(editorContent: HTMLElement)\n\t{\n\t\tthis.resizeArea.setFullEditorContent(editorContent);\n\t}\n\n\tsetDocumentUid(documentUid: string): BlocksManager\n\t{\n\t\tthis.#documentUid = documentUid;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns document entity id.\n\t * @return {number}\n\t */\n\tgetEntityId(): number\n\t{\n\t\treturn this.#entityId;\n\t}\n\n\t/**\n\t * Returns document's layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#documentLayout;\n\t}\n\n\t/**\n\t * Returns number pairs (seams between pages).\n\t * @return {Array<Array<number, number>>}\n\t */\n\tgetSeams(): Array<Array<number, number>>\n\t{\n\t\treturn this.#seams;\n\t}\n\n\t/**\n\t * Returns gap between pages.\n\t * @return {number}\n\t */\n\tgetPagesGap(): number\n\t{\n\t\treturn gapBetweenPages + marginTop;\n\t}\n\n\taddMembers(members: Array<MemberItem>)\n\t{\n\t\tthis.#members = members;\n\t}\n\n\t/**\n\t * Returns document's members\n\t * @return {Array<MemberItem>}\n\t */\n\tgetMembers(): Array<MemberItem>\n\t{\n\t\treturn this.#members;\n\t}\n\n\t/**\n\t * Returns member item by member part.\n\t * @param {number} part\n\t * @return {null}\n\t */\n\tgetMemberByPart(part: number): ?MemberItem\n\t{\n\t\tlet returnMember = null;\n\n\t\tthis.#members.map((member: MemberItem) => {\n\t\t\tif (member.part === part)\n\t\t\t{\n\t\t\t\treturnMember = member;\n\t\t\t}\n\t\t});\n\n\t\treturn returnMember;\n\t}\n\n\t/**\n\t * Returns company id.\n\t * @return {number}\n\t */\n\tgetCompanyId(): number\n\t{\n\t\treturn this.#companyId;\n\t}\n\n\t/**\n\t * @return {string}\n\t */\n\tgetInitiatorName(): string\n\t{\n\t\treturn this.#initiatorName;\n\t}\n\n\t/**\n\t * Returns Config object.\n\t * @return {Config}\n\t */\n\tgetConfig(): Config\n\t{\n\t\treturn this.#config;\n\t}\n\n\t/**\n\t * Hides resizing area.\n\t */\n\thideResizeArea()\n\t{\n\t\tthis.resizeArea.hide();\n\t}\n\n\t/**\n\t * Shows resizing area over the block.\n\t * @param {Block} block\n\t */\n\tshowResizeArea(block: Block)\n\t{\n\t\tthis.resizeArea.show(block);\n\t}\n\n\t/**\n\t * Mutes resizing area.\n\t */\n\tmuteResizeArea()\n\t{\n\t\tthis.resizeArea.getLayout().setAttribute('data-disable', 1);\n\t}\n\n\t/**\n\t * Unmutes resizing area.\n\t */\n\tunMuteResizeArea()\n\t{\n\t\tthis.resizeArea.getLayout().removeAttribute('data-disable');\n\t}\n\n\t/**\n\t * Adds block to the document.\n\t * @param {BlockItem} data Block data.\n\t * @param {boolean} seamShift If true, will be added seam shift to top's position.\n\t * @return {Block}\n\t */\n\t#addBlock(data: BlockItem, seamShift: boolean): Block\n\t{\n\t\tconst position = data.position ? this.#percentToPixel(data.position) : null;\n\t\tconst newBlock = new Block({\n\t\t\tid: data.id,\n\t\t\tcode: data.code,\n\t\t\tparty: data.party,\n\t\t\tblocksManager: this,\n\t\t\tdata: data.data,\n\t\t\tposition,\n\t\t\tstyle: data.style,\n\t\t\tonClick: (block: Block) => {\n\t\t\t\tif (this.#disableEdit)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.resizeArea.show(block);\n\t\t\t\tthis.unMuteResizeArea();\n\t\t\t\tblock.adjustActionsPanel();\n\t\t\t},\n\t\t\tonRemove: (block: Block) => {\n\t\t\t\tthis.resizeArea.hide();\n\t\t\t},\n\t\t});\n\t\tconst blockLayout = newBlock.getLayout();\n\t\tthis.#subscribeOnBlockEvents(newBlock);\n\n\t\tif (['sign', 'mysign'].includes(newBlock.getCode()))\n\t\t{\n\t\t\tconst existedSignBlock: Block | undefined = this.#blocks.find(block => block.getCode() === newBlock.getCode());\n\t\t\tconst signColor: string | undefined = existedSignBlock?.getStyle?.()?.color;\n\t\t\tif (!Type.isNil(signColor))\n\t\t\t{\n\t\t\t\tnewBlock.updateColor(signColor, false);\n\t\t\t}\n\t\t}\n\n\t\tthis.#blocks.push(newBlock);\n\n\t\tDom.append(blockLayout, this.#documentLayout);\n\n\t\treturn newBlock;\n\t}\n\n\t#subscribeOnBlockEvents(newBlock: Block): void\n\t{\n\t\tconst newBlockCode = newBlock.getCode();\n\t\tif (['sign', 'mysign'].includes(newBlockCode))\n\t\t{\n\t\t\tconst colorChangeListener = (event) => this.#onBlockColorStyleChange(newBlock, event);\n\t\t\tthis.#eventListeners.blockColorChange.set(\n\t\t\t\tnewBlock,\n\t\t\t\t{ subscription: colorChangeListener, eventName: newBlock.events.onColorStyleChange },\n\t\t\t);\n\t\t\tnewBlock.subscribe(\n\t\t\t\tnewBlock.events.onColorStyleChange,\n\t\t\t\tcolorChangeListener,\n\t\t\t);\n\t\t}\n\t\telse if (['myreference', 'reference'].includes(newBlockCode))\n\t\t{\n\t\t\tconst onFieldSelectListener = (event: FieldSelectEvent) => this.#onReferenceBlockFieldSelect(\n\t\t\t\tnewBlock,\n\t\t\t\tevent,\n\t\t\t);\n\t\t\tthis.#eventListeners.blockReferenceFieldSelect.set(\n\t\t\t\tnewBlock,\n\t\t\t\t{ subscription: onFieldSelectListener, eventName: 'onFieldSelect' },\n\t\t\t);\n\t\t\tnewBlock.subscribe(\n\t\t\t\t'onFieldSelect',\n\t\t\t\tonFieldSelectListener,\n\t\t\t);\n\t\t}\n\t\telse if (['b2ereference', 'myb2ereference', 'employeedynamic', 'hcmlinkreference'].includes(newBlockCode))\n\t\t{\n\t\t\tconst onFieldSelectListener = (event: FieldSelectEvent) => this.#onB2eReferenceBlockFieldSelect(\n\t\t\t\tnewBlock,\n\t\t\t\tevent,\n\t\t\t);\n\n\t\t\tthis.#eventListeners.blockB2eReferenceFieldSelect.set(\n\t\t\t\tnewBlock,\n\t\t\t\t{ subscription: onFieldSelectListener, eventName: 'onFieldSelect' },\n\t\t\t);\n\t\t\tnewBlock.subscribe(\n\t\t\t\t'onFieldSelect',\n\t\t\t\tonFieldSelectListener,\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Fires on click repository item.\n\t * @param {string} code Block code.\n\t * @param {string} part Member part (base - my company, other - third part).\n\t */\n\t#onRepositoryItemClick(code: string, party: number)\n\t{\n\t\tparty = parseInt(party);\n\t\tthis.setSavingMark(false);\n\n\t\tconst block = this.#addBlock({ code, party });\n\t\tblock.assign();\n\t\tblock.onPlaced();\n\t}\n\n\t/**\n\t * Sets exists blocks to the document.\n\t * @param blocks\n\t */\n\tinitBlocks(blocks: Array<BlockItem>)\n\t{\n\t\tthis.#unsubscribeFromBlocksEvents();\n\t\tthis.#blocks = [];\n\t\tthis.hideResizeArea();\n\t\tblocks.map((block) => this.#addBlock(block, true));\n\t}\n\n\tinitRepository(repositoryItems: NodeList)\n\t{\n\t\t[...repositoryItems].forEach((item: HTMLElement) => {\n\t\t\tconst code = item.getAttribute('data-code');\n\t\t\tconst part = item.getAttribute('data-part');\n\n\t\t\tEvent.bind(item, 'click', e => {\n\t\t\t\tthis.#onRepositoryItemClick(code, part);\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Returns blocks collection.\n\t * @return {Array<Block>}\n\t */\n\tgetBlocks(): Array<Block>\n\t{\n\t\treturn this.#blocks;\n\t}\n\n\tgetLanguages(): {[key: string]: { NAME: string; IS_BETA: boolean; }}\n\t{\n\t\treturn this.#languages;\n\t}\n\n\t/**\n\t * Saves document and closes slider.\n\t * @return {Promise}\n\t */\n\tsave(): Promise<any, any>\n\t{\n\t\tconst postData = [];\n\n\t\tconst realDocumentWidth = document.querySelector('.sign-editor__document').offsetWidth;\n\n\t\tthis.#blocks.map(block => {\n\n\t\t\tif (block.isRemoved())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst blockLayout = block.getLayout();\n\t\t\tconst blockRect = blockLayout.getBoundingClientRect();\n\t\t\tconst pages = [...this.#documentLayout.querySelectorAll('.sign-editor__document_page img')];\n\t\t\tconst pagesRect = pages.map((page) => {\n\t\t\t\tconst { top, left, width, height } = page.getBoundingClientRect();\n\n\t\t\t\treturn {\n\t\t\t\t\ttop,\n\t\t\t\t\tleft,\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t};\n\t\t\t});\n\t\t\tconst nextPageRect = pagesRect.find((pageRect) => {\n\t\t\t\tif (Math.round(blockRect.top) < Math.round(pageRect.top))\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\tconst pageNum = nextPageRect ? pagesRect.indexOf(nextPageRect) : pagesRect.length;\n\t\t\tconst currentPageRect = pagesRect[pageNum - 1];\n\t\t\tlet position = {\n\t\t\t\ttop: blockRect.top - currentPageRect.top,\n\t\t\t\tleft: blockRect.left - currentPageRect.left,\n\t\t\t\twidth: blockRect.width,\n\t\t\t\theight: blockRect.height,\n\t\t\t\tpage: pageNum,\n\t\t\t};\n\t\t\tposition = this.#pixelToPercent(position, currentPageRect);\n\t\t\tposition.realDocumentWidthPx = realDocumentWidth ? realDocumentWidth : null;\n\t\t\tconst code = block.getCode();\n\t\t\tlet type = 'text';\n\t\t\tswitch (code)\n\t\t\t{\n\t\t\t\tcase 'stamp':\n\t\t\t\tcase 'mystamp':\n\t\t\t\tcase 'sign':\n\t\t\t\tcase 'mysign':\n\t\t\t\t\ttype = 'image';\n\t\t\t}\n\t\t\tpostData.push({\n\t\t\t\tid: block.getId(),\n\t\t\t\tcode: block.getCode(),\n\t\t\t\tdata: block.getData(),\n\t\t\t\tparty: block.getMemberPart(),\n\t\t\t\tstyle: block.getStyle(),\n\t\t\t\tposition,\n\t\t\t\ttype,\n\t\t\t});\n\t\t});\n\n\t\tconst params = {};\n\t\tif (this.#closeDemoContent)\n\t\t{\n\t\t\tparams['closeDemoContent'] = true;\n\t\t}\n\t\tthis.hideResizeArea();\n\n\t\treturn this.#api.saveBlank(\n\t\t\tthis.getDocumentUid(),\n\t\t\tpostData.length > 0 ? postData : [],\n\t\t).then((response) => {\n\n\t\t\tif (!('errors' in response))\n\t\t\t{\n\t\t\t\treturn postData;\n\t\t\t}\n\n\t\t\tif (response.errors[0].customData?.field === 'requisites')\n\t\t\t{\n\t\t\t\tconst popup = new Popup({\n\t\t\t\t\tid: 'sign_document_error_popup',\n\t\t\t\t\ttitleBar: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE_TITLE'),\n\t\t\t\t\tcontent: BX.util.htmlspecialchars(response.errors[0]?.message),\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE'),\n\t\t\t\t\t\t\tcolor: ButtonColor.SUCCESS,\n\t\t\t\t\t\t\tonclick: ({ button }) => {\n\t\t\t\t\t\t\t\tconst target = button;\n\t\t\t\t\t\t\t\tDom.addClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\t\tBackend.controller({\n\t\t\t\t\t\t\t\t\tcommand: 'document.restoreRequisiteFields',\n\t\t\t\t\t\t\t\t\tpostData: {\n\t\t\t\t\t\t\t\t\t\tdocumentId: this.#documentId,\n\t\t\t\t\t\t\t\t\t\tpresetId: response.errors[0]?.customData.presetId,\n\t\t\t\t\t\t\t\t\t\tcode: response.errors[0]?.customData.code,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\t\t\t\tDom.removeClass(target, 'ui-btn-wait');\n\n\t\t\t\t\t\t\t\t\tthis.#blocks.map((block) => {\n\t\t\t\t\t\t\t\t\t\tif (block.isRemoved())\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (block.getCode() === response.errors[0]?.customData.code)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tblock.assign();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t\t}).catch(() => {\n\t\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE_BY_HANDS'),\n\t\t\t\t\t\t\tcolor: ButtonColor.INFO,\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.#blocks.map((block) => {\n\t\t\t\t\t\t\t\t\tif (block.isRemoved())\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (block.getCode() === response.errors[0]?.customData.code)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tconst blockActionButton = document.querySelector(\n\t\t\t\t\t\t\t\t\t\t\t`button[data-id=\"action-${block.getCode()}]`,\n\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\tif (blockActionButton)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tblockActionButton.click();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tpopup.show();\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst firstError = response.errors[0];\n\t\t\tif (firstError.code === 'REFERENCE_ERROR_FIELD_NOT_SELECTED')\n\t\t\t{\n\t\t\t\tthis.#highlightInvalidBlocks();\n\t\t\t\tconst popup = new Popup({\n\t\t\t\t\tid: 'sign_document_error_popup',\n\t\t\t\t\ttitleBar: Loc.getMessage('SIGN_EDITOR_ERROR_SAVE_REFERENCE_BACK_TITLE'),\n\t\t\t\t\tcontent: BX.util.htmlspecialchars(firstError.message),\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_EDITOR_ERROR_SAVE_REFERENCE_BACK'),\n\t\t\t\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tEventEmitter.subscribeOnce('SidePanel.Slider:onCloseComplete', () => {\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t});\n\t\t\t\tpopup.show();\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconsole.error(firstError.message);\n\n\t\t\treturn postData;\n\t\t});\n\t}\n\n\t/**\n\t * Registers save button.\n\t * @param {DocumentOptions} options\n\t */\n\tonSave(options: DocumentOptions)\n\t{\n\t\tEvent.bind(options.saveButton, 'click', (e) => {\n\t\t\tif (this.#disableEdit)\n\t\t\t{\n\t\t\t\tif (options.afterSaveCallback)\n\t\t\t\t{\n\t\t\t\t\toptions.afterSaveCallback();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.save()\n\t\t\t\t.then(result => {\n\t\t\t\t\t//todo: we need to parse response and sets id for each new block\n\t\t\t\t\tif (result === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setSavingMark(true);\n\n\t\t\t\t\t\tif (options.afterSaveCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toptions.afterSaveCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (result !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (options.saveErrorCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toptions.saveErrorCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Registers callback on slider close.\n\t */\n\tonCloseSlider()\n\t{\n\t\tBX.addCustomEvent('SidePanel.Slider:onClose', (event) => {\n\t\t\tif (event.slider.url.indexOf('/sign/edit/') === 0)\n\t\t\t{\n\t\t\t\tif (!this.everythingIsSaved())\n\t\t\t\t{\n\t\t\t\t\tevent.denyAction();\n\n\t\t\t\t\tMessageBox.confirm(\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_MESSAGE'),\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_TITLE'),\n\t\t\t\t\t\t(messageBox: MessageBox) => {\n\t\t\t\t\t\t\tthis.setSavingMark(true);\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t\tevent.slider.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_APPLY'),\n\t\t\t\t\t\t(messageBox: MessageBox) => {\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Sets mark to document that everything was saved or not.\n\t * @param {boolean} mark\n\t */\n\tsetSavingMark(mark: boolean)\n\t{\n\t\tthis.setParam('bxSignEditorAllSaved', mark);\n\t}\n\n\t/**\n\t * Returns true, if everything was saved within editor.\n\t * @return {boolean}\n\t */\n\teverythingIsSaved(): boolean\n\t{\n\t\treturn this.getParam('bxSignEditorAllSaved') === true;\n\t}\n\n\tsetParam(name: string, value: any): void\n\t{\n\t\tconst slider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (slider)\n\t\t{\n\t\t\tslider.getData().set(name, value);\n\t\t}\n\t}\n\n\tgetParam(name: string): any\n\t{\n\t\tconst slider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (slider)\n\t\t{\n\t\t\treturn slider.getData().get(name);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\t/**\n\t * Returns true if element with specified top & bottom over dead zone.\n\t * @param {number} top\n\t * @param {number} bottom\n\t * @param {boolean} notAddMargin\n\t * @return {boolean}\n\t */\n\tinDeadZone(top: number, bottom: number, notAddMargin: boolean): boolean\n\t{\n\t\tconst seams = this.getSeams();\n\t\tconst content = document.querySelector('.sign-editor__content');\n\t\ttop += content.scrollTop;\n\t\tbottom += content.scrollTop;\n\t\tif (seams.length > 0 && notAddMargin !== true)\n\t\t{\n\t\t\tconst documentLayoutRect = this.#documentLayout.getBoundingClientRect();\n\t\t\ttop += documentLayoutRect.top;\n\t\t\tbottom += documentLayoutRect.top;\n\t\t}\n\n\t\tfor (\n\t\t\tlet ii = 0,\n\t\t\t\tcc = seams.length; ii < cc; ii++\n\t\t)\n\t\t{\n\t\t\tconst seam = seams[ii];\n\n\t\t\t// top on page, bottom on seam\n\t\t\tif (top <= seam[0] && bottom >= seam[0] && bottom <= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// top on one page, bottom on another (seam in a middle)\n\t\t\tif (top <= seam[0] && bottom >= seam[1])\n\t\t\t{\n\t\t\t\t//seam[0] - bottom >> shift top\n\t\t\t\t//seam[1] - top >> shift bottom\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// block into a seam\n\t\t\tif (top >= seam[0] && bottom <= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// top on seam, bottom on page\n\t\t\tif (top >= seam[0] && top <= seam[1] && bottom >= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[1] - top;\n\t\t\t}\n\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\t#startDisabledEditDocumentTour()\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById('sign-editor-btn-edit'),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_EDIT_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_EDIT_TEXT'),\n\t\t\t\t},\n\t\t\t],\n\t\t\tid: 'sign-tour-guide-onboarding-master-document-edit-disabled',\n\t\t\tautoSave: true,\n\t\t\tsimpleMode: true,\n\t\t});\n\t\tguide.startOnce();\n\t}\n\n\t#startEditDocumentTour()\n\t{\n\t\tconst helpBtnSpotlight = new BX.SpotLight({\n\t\t\ttargetElement: document.getElementById(this.#helpBtnElementId),\n\t\t\ttargetVertex: 'middle-center',\n\t\t\tautoSave: true,\n\t\t\tid: 'sign-spotlight-onboarding-master-document-edit',\n\t\t});\n\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById('sign-editor-bar-content'),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_BLOCKS_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_BLOCKS_TEXT'),\n\t\t\t\t\tposition: 'left',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById(this.#helpBtnElementId),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_HELP_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_HELP_TEXT'),\n\t\t\t\t\trounded: true,\n\t\t\t\t\tarticle: this.#helpBtnHelperArticleCode,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonShow: () => helpBtnSpotlight.show(),\n\t\t\t\t\t\tonClose: () => helpBtnSpotlight.close(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tid: 'sign-tour-guide-onboarding-master-document-edit',\n\t\t\tautoSave: true,\n\t\t\tsimpleMode: true,\n\t\t});\n\t\tguide.startOnce();\n\t}\n\n\t#highlightInvalidBlocks()\n\t{\n\t\tthis.#blocks.forEach((block) => {\n\t\t\tif (block.isRemoved())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst code = block.getCode();\n\t\t\tconst isCRM = code === 'reference' || code === 'myreference';\n\t\t\tif (isCRM && Type.isArray(block.getData()))\n\t\t\t{\n\t\t\t\tDom.addClass(block.getLayout(), '--invalid');\n\t\t\t}\n\t\t});\n\t}\n\n\t#onBlockColorStyleChange(updatedBlock: Block, event: BaseEvent)\n\t{\n\t\tif (!['sign', 'mysign'].includes(updatedBlock.getCode()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst newColor: string | null = event.getData().color ?? null;\n\t\tif (Type.isNull(newColor))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#blocks\n\t\t\t.filter((block) => updatedBlock.getCode() === block.getCode())\n\t\t\t.forEach((block) => {\n\t\t\t\tif (updatedBlock === block)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tblock.updateColor(newColor, false);\n\t\t\t})\n\t\t;\n\t}\n\n\t#onReferenceBlockFieldSelect(block: Block, event: FieldSelectEvent): void\n\t{\n\t\tif (event.getData().selectedFieldNames.length === 0)\n\t\t{\n\t\t\tconst deleteLatency = 150;\n\t\t\tsetTimeout((): void => this.#onBlockDeleteBecauseFieldNotSelected(block), deleteLatency);\n\t\t}\n\t}\n\n\t#onB2eReferenceBlockFieldSelect(block: Block, event: FieldSelectEvent): void\n\t{\n\t\tif (event.getData().selectedFieldNames.length === 0)\n\t\t{\n\t\t\tconst deleteLatency = 150;\n\t\t\tsetTimeout((): void => this.#onB2eReferenceBlockDeleteBecauseFieldNotSelected(block), deleteLatency);\n\t\t}\n\t}\n\n\t#onBlockDeleteBecauseFieldNotSelected(block: Block): void\n\t{\n\t\tblock.remove();\n\t\t// show notification once\n\t\tthis.#cache.remember('notify', () => UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(Loc.getMessage('SIGN_EDITOR_ERROR_REFERENCE_BLOCK_FIELD_NOT_SELECTED_HINT_TEXT')),\n\t\t\tautoHideDelay: 3000,\n\t\t\twidth: 480,\n\t\t}));\n\t}\n\n\t#onB2eReferenceBlockDeleteBecauseFieldNotSelected(block: Block): void\n\t{\n\t\tblock.remove();\n\t\t// show notification once\n\t\tthis.#cache.remember('notifyB2e', () => UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(Loc.getMessage('SIGN_EDITOR_ERROR_B2E_REFERENCE_BLOCK_FIELD_NOT_SELECTED_HINT_TEXT')),\n\t\t\tautoHideDelay: 3000,\n\t\t\twidth: 480,\n\t\t}));\n\t}\n\n\t#unsubscribeFromBlocksEvents(): void\n\t{\n\t\tconst subscriptions: Array<[Block, EventListenerCache]> = Object\n\t\t\t.values(this.#eventListeners)\n\t\t\t.flatMap((subscription) => [...subscription.entries()])\n\t\t;\n\t\tfor (const [block, { subscription, eventName }] of subscriptions)\n\t\t{\n\t\t\tblock.unsubscribe(eventName, subscription);\n\t\t}\n\n\t\tObject.values(this.#eventListeners).forEach((eventListenerCache) => eventListenerCache.clear());\n\t}\n}\n","import { Dom, Loc, Reflection, Tag, Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Analytics } from 'sign.v2.analytics';\nimport type { DocumentInitiatedType, MemberRoleType } from 'sign.type';\nimport { DocumentInitiated, MemberRole } from 'sign.type';\nimport { Hint } from 'sign.v2.helper';\nimport { BlocksManager } from './blocks/blocksManager';\nimport './style.css';\n\nconst buttonClassList = [\n\t'ui-btn',\n\t'ui-btn-sm',\n\t'ui-btn-round',\n\t'ui-btn-light-border',\n];\n\nexport const SectionType = Object.freeze({\n\tGeneral: 0,\n\tFirstParty: 1,\n\tSecondParty: 2,\n\tHcmLinkIntegration: 3,\n});\n\ntype EditorOptions = {\n\tlanguages: {[key: string]: { NAME: string; IS_BETA: boolean; }},\n\tisTemplateMode: boolean,\n\tdocumentInitiatedByType?: DocumentInitiatedType,\n}\n\ntype DocumentData = {\n\tentityId: number,\n\tisTemplate: boolean,\n\tuid: string,\n\tblocks: Array<{\n\t\tcode: string,\n\t\tdata: Object,\n\t\tid: number,\n\t\tparty: number,\n\t\tposition: Object,\n\t\tstyle: Object,\n\t\ttype: string\n\t}>\n};\n\nexport class Editor extends EventEmitter\n{\n\t#sidePanel: BX.SidePanel.Slider;\n\t#closeSidePanel: Function;\n\t#resolvePages: Function;\n\t#dom: HTMLElement;\n\t#documentLayout: HTMLElement;\n\t#blocksManager: BlocksManager;\n\t#wizardType: string;\n\t#documentData: DocumentData;\n\t#urls: string[];\n\t#totalPages: number;\n\n\t#sectionElementByType: Map<number, HTMLElement> = new Map();\n\t#disabledSections: Set<number> = new Set();\n\n\t#needSaveBlocksOnSidePanelClose: boolean = true;\n\t#needToLockSidePanelClose: boolean = true;\n\t#analytics: Analytics | null = null;\n\t#isTemplateMode: boolean;\n\n\tconstructor(wizardType: string, options: EditorOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.Editor');\n\t\tconst { Instance } = Reflection.getClass('BX.SidePanel');\n\t\tthis.#sidePanel = Instance;\n\t\tthis.#dom = Tag.render`<div class=\"sign-wizard__scope sign-editor\"></div>`;\n\t\tthis.#documentLayout = Tag.render`\n\t\t\t<div class=\"sign-editor__document\"></div>\n\t\t`;\n\t\tthis.#blocksManager = new BlocksManager({\n\t\t\tdocumentLayout: this.#documentLayout,\n\t\t\tdisableEdit: false,\n\t\t\tlanguages: options.languages,\n\t\t\tisTemplateMode: Boolean(options.isTemplateMode),\n\t\t\tdocumentInitiatedByType: options.documentInitiatedByType ?? DocumentInitiated.company,\n\t\t});\n\t\tthis.#isTemplateMode = Boolean(options.isTemplateMode);\n\t\tthis.#wizardType = wizardType;\n\t\tthis.#urls = [];\n\t\tthis.#totalPages = 0;\n\t}\n\n\t#isB2e(): boolean\n\t{\n\t\treturn this.#wizardType === 'b2e';\n\t}\n\n\t#getArticleCode(): string\n\t{\n\t\treturn this.#isB2e() ? '' : '16571388';\n\t}\n\n\tsetUrls(urls: string[], totalPages: number)\n\t{\n\t\tif (urls.length === 0)\n\t\t{\n\t\t\tthis.#urls = [];\n\t\t\tthis.#totalPages = 0;\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#urls = [\n\t\t\t...this.#urls,\n\t\t\t...urls,\n\t\t];\n\t\tthis.#totalPages = totalPages;\n\t\tif (this.#urls.length === totalPages)\n\t\t{\n\t\t\tthis.#resolvePages?.();\n\t\t}\n\t}\n\n\tset documentData(documentData: DocumentData)\n\t{\n\t\tthis.#documentData = documentData;\n\t\tconst { uid = '', isTemplate } = documentData;\n\t\tif (isTemplate)\n\t\t{\n\t\t\tthis.#toggleEditMode(false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#toggleEditMode(true);\n\t\t}\n\n\t\tthis.#blocksManager.setDocumentUid(uid);\n\t}\n\n\tsetSenderType(senderType: string)\n\t{\n\t\tthis.#blocksManager.documentInitiatedByType = senderType;\n\t}\n\n\tset entityData(entityData)\n\t{\n\t\tconst forbiddenRoles = new Set([\n\t\t\tMemberRole.editor,\n\t\t\tMemberRole.reviewer,\n\t\t]);\n\n\t\tconst members = Object.values(entityData)\n\t\t\t.filter((member) => !forbiddenRoles.has(member.role))\n\t\t\t.map((member) => {\n\t\t\t\tconst {\n\t\t\t\t\tid: cid,\n\t\t\t\t\ttitle: name,\n\t\t\t\t\tpart,\n\t\t\t\t\tpresetId,\n\t\t\t\t\tentityTypeId,\n\t\t\t\t\tuid,\n\t\t\t\t\tentityId,\n\t\t\t\t\trole,\n\t\t\t\t} = member;\n\n\t\t\t\treturn {\n\t\t\t\t\tcid,\n\t\t\t\t\tname,\n\t\t\t\t\tpart: this.#covertRoleToBlockParty(part, role),\n\t\t\t\t\tpresetId,\n\t\t\t\t\tentityTypeId,\n\t\t\t\t\tuid,\n\t\t\t\t\tentityId,\n\t\t\t\t};\n\t\t\t});\n\t\tthis.#blocksManager.addMembers(members);\n\t}\n\n\t#covertRoleToBlockParty(part: number, role: ?MemberRoleType): number\n\t{\n\t\tswitch (role)\n\t\t{\n\t\t\tcase MemberRole.assignee:\n\t\t\t\treturn 1;\n\t\t\tcase MemberRole.signer:\n\t\t\t\treturn 2;\n\t\t\tdefault:\n\t\t\t\treturn part;\n\t\t}\n\t}\n\n\tasync renderDocument()\n\t{\n\t\tDom.clean(this.#documentLayout);\n\t\tconst { promises, fragment } = this.#urls.reduce((acc, url) => {\n\t\t\t// eslint-disable-next-line no-shadow\n\t\t\tconst { fragment, promises } = acc;\n\t\t\tconst promise = new Promise((resolve) => {\n\t\t\t\tconst page = Tag.render`\n\t\t\t\t\t<div class=\"sign-editor__document_page\">\n\t\t\t\t\t\t<img src=\"${url}\" onload=\"${resolve}\"  alt=\"\"/>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t\tDom.append(page, fragment);\n\t\t\t});\n\t\t\tpromises.push(promise);\n\n\t\t\treturn acc;\n\t\t}, {\n\t\t\tfragment: new DocumentFragment(),\n\t\t\tpromises: [],\n\t\t});\n\t\tDom.append(fragment, this.#documentLayout);\n\t\tconst { resizeArea } = this.#blocksManager;\n\t\tDom.append(resizeArea.getLayout(), this.#documentLayout);\n\t\tawait Promise.all(promises);\n\t\tEventEmitter.unsubscribeAll('SidePanel.Slider:onOpenComplete');\n\t\tEventEmitter.subscribeOnce('SidePanel.Slider:onOpenComplete', () => {\n\t\t\tthis.#blocksManager.initPagesRect();\n\t\t\tthis.#blocksManager.initBlocks(\n\t\t\t\tthis.#documentData.blocks\n\t\t\t\t\t.filter((block) => this.#isBlockCanBeInitialized(block))\n\t\t\t\t,\n\t\t\t);\n\t\t});\n\t}\n\n\tshow(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.#closeSidePanel = resolve;\n\t\t\tthis.#sidePanel.open('editor', {\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\tthis.#render();\n\n\t\t\t\t\treturn this.#dom;\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: (e) => this.#onSidePanelCloseStart(e),\n\t\t\t\t\tonCloseComplete: () => this.#closeSidePanel(),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\twaitForPagesUrls(): Promise<void>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif (this.#urls.length === this.#totalPages)\n\t\t\t{\n\t\t\t\tresolve();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#resolvePages = resolve;\n\t\t});\n\t}\n\n\t#render()\n\t{\n\t\tDom.clean(this.#dom);\n\t\tDom.append(this.#createHeader(), this.#dom);\n\t\tDom.append(this.#createContent(), this.#dom);\n\t}\n\n\t#createHeader(): HTMLElement\n\t{\n\t\tconst editButtonClassName = [\n\t\t\t'sign-editor__header_edit-btn',\n\t\t\t...buttonClassList,\n\t\t].join(' ');\n\t\tconst saveButtonClassName = [\n\t\t\t'ui-btn-success',\n\t\t\t...buttonClassList.slice(0, -1),\n\t\t].join(' ');\n\t\tconst editButtonTitle = Loc.getMessage('SIGN_EDITOR_EDIT');\n\t\tconst saveButtonTitle = Loc.getMessage('SIGN_EDITOR_SAVE');\n\n\t\tlet helpArticleElement = '';\n\t\tif (this.#getArticleCode())\n\t\t{\n\t\t\thelpArticleElement = Tag.render`\n\t\t\t\t<span\n\t\t\t\t\t\t\t\tonclick=\"${() => {\n\t\t\t\t\tconst Helper = Reflection.getClass('BX.Helper');\n\t\t\t\t\tHelper.show(`redirect=detail&code=${this.#getArticleCode()}`);\n\t\t\t\t}}\"\n\t\t\t\t\t\t\t\tclass=\"sign-editor__header_help\"\n\t\t\t\t\t\t\t\t></span>\n\t\t\t`;\n\t\t}\n\t\tconst headTitleNode = Tag.render`\n\t\t\t<p class=\"sign-editor__header_title\">\n\t\t\t\t<span>${Loc.getMessage('SIGN_EDITOR_EDITING')}</span>\n\t\t\t\t<span\n\t\t\t\t\tdata-hint=\"${Loc.getMessage('SIGN_EDITOR_EDITING_HINT_MSGVER_1')}\"\n\t\t\t\t></span>\n\t\t\t</p>\n\t\t`;\n\t\tHint.create(headTitleNode);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-editor__header\">\n\t\t\t\t${headTitleNode}\n\t\t\t\t<div class=\"sign-editor__header_right\">\n\t\t\t\t\t${helpArticleElement}\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"${editButtonClassName}\"\n\t\t\t\t\t\ttitle=\"${editButtonTitle}\"\n\t\t\t\t\t\tonclick=\"${() => this.#onEditBtnClick()}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${editButtonTitle}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"${saveButtonClassName}\"\n\t\t\t\t\t\ttitle=\"${saveButtonTitle}\"\n\t\t\t\t\t\tonclick=\"${(e) => this.#onSaveBtnClick(e)}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${saveButtonTitle}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tasync #onSaveBtnClick({ target }: MouseEvent): Promise<void>\n\t{\n\t\tDom.addClass(target, 'ui-btn-wait');\n\t\tconst blocks = await this.#blocksManager.save();\n\t\tconst uid = this.#blocksManager.getDocumentUid();\n\t\tDom.removeClass(target, 'ui-btn-wait');\n\t\tif (!blocks)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tEventEmitter.subscribeOnce('SidePanel.Slider:onCloseComplete', () => {\n\t\t\tthis.emit('save', { uid, blocks });\n\t\t\tif (this.#analytics instanceof Analytics && this.#isTemplateMode)\n\t\t\t{\n\t\t\t\tthis.#analytics.send({\n\t\t\t\t\tevent: 'proceed_step_document_editor',\n\t\t\t\t\tstatus: 'success',\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.#needSaveBlocksOnSidePanelClose = false;\n\t\tthis.#sidePanel.close();\n\t\tthis.#needSaveBlocksOnSidePanelClose = true;\n\t\tthis.#toggleEditMode(false);\n\t}\n\n\t#onEditBtnClick(): void\n\t{\n\t\tthis.#toggleEditMode(true);\n\t\tif (this.#analytics instanceof Analytics && this.#isTemplateMode)\n\t\t{\n\t\t\tthis.#analytics.send({\n\t\t\t\tevent: 'open_document_editor',\n\t\t\t\tstatus: 'success',\n\t\t\t});\n\t\t}\n\t}\n\n\t#createContent(): HTMLElement\n\t{\n\t\tconst sections = this.#createSections();\n\t\tconst editorContent = Tag.render`\n\t\t\t<div class=\"sign-editor__content\">\n\t\t\t\t<div class=\"sign-editor__document-container\">\n\t\t\t\t\t${this.#documentLayout}\n\t\t\t\t</div>\n\t\t\t\t${sections}\n\t\t\t</div>\n\t\t`;\n\t\tHint.create(sections, {\n\t\t\tbindOptions: { position: 'top' },\n\t\t\tangle: { position: 'bottom' },\n\t\t\ttargetContainer: editorContent,\n\t\t});\n\t\tthis.#blocksManager.setEditorContent(editorContent);\n\n\t\treturn editorContent;\n\t}\n\n\t#createSections(): HTMLElement\n\t{\n\t\tconst sections = this.#getSectionsData()\n\t\t\t.filter(({ singleBlockSection }) => singleBlockSection !== true)\n\t\t;\n\t\tconst sectionsNodes = sections.map((section) => {\n\t\t\tconst entries = Object.entries(section.blocks);\n\t\t\tconst blocks = entries.map(([code, block]) => {\n\t\t\t\tconst { title, hint } = block;\n\n\t\t\t\treturn Tag.render`\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"sign-editor__section_block\"\n\t\t\t\t\t\tdata-code=\"${code}\"\n\t\t\t\t\t\tdata-part=\"${section.part}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"sign-editor__section_block-subject\">\n\t\t\t\t\t\t\t<span>${Loc.getMessage(title)}</span>\n\t\t\t\t\t\t\t<span data-hint=\"${Text.encode(Loc.getMessage(hint))}\"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class=\"sign-editor__section_add-block-btn\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_EDITOR_BLOCK_ADD_TO_DOCUMENT')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t});\n\t\t\tthis.#blocksManager.initRepository(blocks);\n\n\t\t\tconst sectionElement = Tag.render`\n\t\t\t\t<div class=\"sign-editor__section\">\n\t\t\t\t\t<p class=\"sign-editor__section_title\"\n\t\t\t\t\t\tstyle=\"display: ${section.title ? 'block' : 'none'}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${section.title ? Loc.getMessage(section.title) : ''}\n\t\t\t\t\t</p>\n\t\t\t\t\t${blocks}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tthis.#sectionElementByType.set(section.part, sectionElement);\n\n\t\t\tif (this.#disabledSections.has(section.part))\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-style\n\t\t\t\tsectionElement.style.display = 'none';\n\t\t\t}\n\n\t\t\treturn sectionElement;\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-editor__sections\">\n\t\t\t\t${sectionsNodes}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tsetSectionVisibilityByType(type: number, visibility: boolean): void\n\t{\n\t\tconst sectionElement = this.#sectionElementByType.get(type);\n\t\tif (sectionElement)\n\t\t{\n\t\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-style\n\t\t\tsectionElement.style.display = visibility === true ? 'block' : 'none';\n\t\t}\n\n\t\tif (visibility)\n\t\t{\n\t\t\tthis.#disabledSections.delete(type);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#disabledSections.add(type);\n\t\t}\n\t}\n\n\t#toggleEditMode(isEdit: boolean)\n\t{\n\t\tif (isEdit)\n\t\t{\n\t\t\tDom.addClass(this.#dom, '--editable');\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.removeClass(this.#dom, '--editable');\n\t}\n\n\t// eslint-disable-next-line max-lines-per-function,flowtype/require-return-type\n\t#getSectionsData()\n\t{\n\t\tconst firstPartyBlocks = {};\n\t\tconst partnerBlocks = {};\n\t\tconst generalBlocks = {\n\t\t\ttext: {\n\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_TEXT',\n\t\t\t\thint: 'SIGN_EDITOR_BLOCK_TEXT_HINT',\n\t\t\t},\n\t\t};\n\t\tif (!this.#isB2e())\n\t\t{\n\t\t\tgeneralBlocks.date = {\n\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_DATE',\n\t\t\t\thint: 'SIGN_EDITOR_BLOCK_DATE_HINT',\n\t\t\t};\n\t\t}\n\t\tgeneralBlocks.number = {\n\t\t\ttitle: 'SIGN_EDITOR_BLOCK_NUMBER',\n\t\t\thint: 'SIGN_EDITOR_BLOCK_NUMBER_HINT',\n\t\t};\n\n\t\tlet titles = {\n\t\t\tfirstParty: 'SIGN_EDITOR_BLOCKS_FIRST_PARTY',\n\t\t\tpartner: 'SIGN_EDITOR_BLOCKS_PARTNER',\n\t\t};\n\n\t\tif (this.#wizardType === 'b2e')\n\t\t{\n\t\t\tlet personalDataMessageCode = 'SIGN_EDITOR_BLOCK_B2E_REFERENCE_HINT';\n\t\t\tlet otherDataMessageCode = 'SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC_HINT';\n\t\t\tlet mainDataMessageCode = 'SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_HINT';\n\t\t\tif (this.#blocksManager.isTemplateMode)\n\t\t\t{\n\t\t\t\tpersonalDataMessageCode = this.#isDocumentInitiatedByEmployee()\n\t\t\t\t\t? 'SIGN_EDITOR_BLOCK_B2E_REFERENCE_HINT_TEMPLATE_EMPLOYEE'\n\t\t\t\t\t: 'SIGN_EDITOR_BLOCK_B2E_REFERENCE_HINT_TEMPLATE_COMPANY';\n\t\t\t\totherDataMessageCode = this.#isDocumentInitiatedByEmployee()\n\t\t\t\t\t? 'SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC_HINT_TEMPLATE_EMPLOYEE'\n\t\t\t\t\t: 'SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC_HINT_TEMPLATE_COMPANY';\n\t\t\t\tmainDataMessageCode = this.#isDocumentInitiatedByEmployee()\n\t\t\t\t\t? 'SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_HINT_TEMPLATE_EMPLOYEE'\n\t\t\t\t\t: 'SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_HINT_TEMPLATE_COMPANY';\n\t\t\t}\n\n\t\t\tObject.assign(firstPartyBlocks, {\n\t\t\t\tmyb2ereference: {\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_MSG_VER_1',\n\t\t\t\t\thint: mainDataMessageCode,\n\t\t\t\t},\n\t\t\t\tmyrequisites: {\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_REQUISITES_MSG_VER_1',\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_FIRST_PARTY_REQUISITES_HINT',\n\t\t\t\t},\n\t\t\t});\n\t\t\tObject.assign(partnerBlocks, {\n\t\t\t\tb2ereference: {\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_B2E_REFERENCE_MSG_VER_1',\n\t\t\t\t\thint: personalDataMessageCode,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (this.#isDynamicEmployeeFieldAvailable())\n\t\t\t{\n\t\t\t\tObject.assign(partnerBlocks, {\n\t\t\t\t\temployeedynamic: {\n\t\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC',\n\t\t\t\t\t\thint: otherDataMessageCode,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttitles = {\n\t\t\t\tfirstParty: 'SIGN_EDITOR_BLOCKS_FIRST_PARTY_B2E',\n\t\t\t\tpartner: 'SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E',\n\t\t\t};\n\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\ttitle: titles.firstParty,\n\t\t\t\t\tblocks: firstPartyBlocks,\n\t\t\t\t\tpart: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: titles.partner,\n\t\t\t\t\tblocks: partnerBlocks,\n\t\t\t\t\tpart: 2,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCKS_GENERAL',\n\t\t\t\t\tblocks: generalBlocks,\n\t\t\t\t\tpart: 0,\n\t\t\t\t},\n\t\t\t\t{\n\n\t\t\t\t\ttitle: null,\n\t\t\t\t\tblocks: {\n\t\t\t\t\t\thcmlinkreference: {\n\t\t\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE',\n\t\t\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_B2E_HCMLINK_HINT',\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tpart: 3,\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tObject.assign(firstPartyBlocks, {\n\t\t\t\tmyreference: {\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_CRM',\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_CRM_HINT',\n\t\t\t\t},\n\t\t\t\tmyrequisites: {\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_REQUISITES_MSG_VER_1',\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_FIRST_PARTY_REQUISITES_HINT',\n\t\t\t\t},\n\t\t\t\tmysign: {\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_SIGNATURE',\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_FIRST_PARTY_SIGNATURE_HINT',\n\t\t\t\t},\n\t\t\t\tmystamp: {\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_STAMP_MSGVER_1',\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_FIRST_PARTY_STAMP_HINT',\n\t\t\t\t},\n\t\t\t});\n\t\t\tObject.assign(partnerBlocks, {\n\t\t\t\treference: { ...firstPartyBlocks.myreference },\n\t\t\t\trequisites: {\n\t\t\t\t\t...firstPartyBlocks.myrequisites,\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_PARTNER_REQUISITES_HINT',\n\t\t\t\t},\n\t\t\t\tsign: {\n\t\t\t\t\t...firstPartyBlocks.mysign,\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_PARTNER_SIGNATURE_HINT',\n\t\t\t\t},\n\t\t\t\tstamp: {\n\t\t\t\t\t...firstPartyBlocks.mystamp,\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_PARTNER_STAMP_HINT',\n\t\t\t\t},\n\t\t\t});\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\ttitle: titles.firstParty,\n\t\t\t\t\tblocks: firstPartyBlocks,\n\t\t\t\t\tpart: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: titles.partner,\n\t\t\t\t\tblocks: partnerBlocks,\n\t\t\t\t\tpart: 2,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCKS_GENERAL',\n\t\t\t\t\tblocks: generalBlocks,\n\t\t\t\t\tpart: 0,\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\t}\n\n\t#isDocumentInitiatedByEmployee(): DocumentInitiatedType\n\t{\n\t\treturn this.#blocksManager.documentInitiatedByType === DocumentInitiated.employee;\n\t}\n\n\tasync #onSidePanelCloseStart(event: BX.SidePanel.Event): Promise<void>\n\t{\n\t\tif (!this.#needSaveBlocksOnSidePanelClose)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#needToLockSidePanelClose)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tevent.denyAction();\n\t\ttry\n\t\t{\n\t\t\tconst blocks = await this.#blocksManager.save();\n\t\t\tif (!blocks)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst uid = this.#blocksManager.getDocumentUid();\n\t\t\tthis.#needToLockSidePanelClose = false;\n\t\t\tthis.#sidePanel.close();\n\t\t\tthis.#needToLockSidePanelClose = true;\n\t\t\tthis.emit('save', { uid, blocks });\n\t\t\tthis.#analytics.send({\n\t\t\t\tevent: 'proceed_step_document_editor',\n\t\t\t\tstatus: 'success',\n\t\t\t});\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tif (this.#analytics instanceof Analytics && this.#isTemplateMode)\n\t\t\t{\n\t\t\t\tthis.#analytics.send({\n\t\t\t\t\tevent: 'proceed_step_document_editor',\n\t\t\t\t\tstatus: 'error',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t#isDynamicEmployeeFieldAvailable(): boolean\n\t{\n\t\treturn this.#isB2e() && this.#blocksManager.isTemplateMode;\n\t}\n\n\t#isBlockCanBeInitialized(block: DocumentData['blocks'][number]): boolean\n\t{\n\t\tif (this.#disabledSections.has(block.party))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !this.#blocksManager.isTemplateMode\n\t\t\t|| !String(block.data.field).startsWith('SMART_B2E_DOC')\n\t\t;\n\t}\n\n\tsetAnalytics(analytic: Analytics): void\n\t{\n\t\tthis.#analytics = analytic;\n\t}\n}\n"],"names":["Dummy","EventEmitter","constructor","block","data","events","onChange","onColorStyleChange","setEventNamespace","isSingleton","isStyleAllowed","setData","setText","text","getInitDimension","width","height","getData","getActionButton","getBlockCaption","getViewContent","Tag","render","TextFormat","encode","toString","replaceAll","onStartChangePosition","onPlaced","onSave","onRemove","onClickOut","forceSave","emit","getStyles","changeStyleColor","color","defaultTextBlockPaddingStyles","padding","Date","onActionClick","BX","calendar","node","getLayout","field","value","bTime","callback_after","date","format","convertBitrixFormat","message","renderView","targetContainer","document","querySelector","popup","popupContainer","parentElement","Dom","append","adjustPosition","bind","Loc","getMessage","Close","MyRequisites","Cache","MemoryCache","getCode","event","stopPropagation","show","Set","fields","filter","createFieldType","has","name","remember","blocksManager","member","getMemberByPart","getMemberPart","entityTypeId","presetId","entityId","cid","fieldsetViewer","FieldsetViewer","documentUid","getDocumentUid","onClose","assign","delete","fieldListEditorOptions","fieldsPanelOptions","entity_field_name","fieldName","includes","fieldsFactory","controllerOptions","hideVirtual","hideRequisites","hideSmartDocument","popupOptions","overlay","cacheable","setEndpoint","subscribe","hide","hasAccessDeniedError","requestErrors","some","error","code","UI","Notification","Center","notify","content","Text","autoHideDelay","ColorPicker","Reflection","getClass","setRect","element","rect","Object","keys","map","key","parseInt","style","getBlockLayout","options","getMemberSelector","members","selectedValue","menuItems","selectedName","part","memberSelector","length","SignUI","bindSimpleMenu","bindElement","items","actionHandler","innerHTML","getResizeArea","getStylePanel","collectStyles","fonts","fontFamily","fontSizereal","fontSizeValue","fontSize","currentValue","layout","fontColor","getColorSelectorBtn","defaultColorPickerColor","onColorSelect","colorPickerOptions","updateColorSelectorBtnColor","updatedColorPickerOptions","onColorSelected","picker","Event","open","colorPicker","circleColor","Type","isNil","MySign","getPosition","src","dataSrc","base64","getPlaceholderLabel","backgroundPosition","emitEvent","setSelectedColor","colorSelectorBtnLayout","close","colors","allowCustomColor","selectedColor","colorPreview","MyStamp","Uploader","controller","upload","contact","id","label","currentBlock","await","eventData","file","serverId","serverPreviewUrl","Api","title","__view","fileId","memberPart","saveStamp","uid","button","textContent","Number","sliderOnMessageBind","addCustomEvent","window","isEditor","slider","url","getEventId","numeratorData","sender","type","api","refreshEntityNumber","crmNumeratorUrl","SidePanel","Instance","Reference","isUndefined","Selector","className","then","selectedNames","eventSelectedNames","isStringFilled","push","removeClass","setTimeout","actionButton","defaultCaption","fieldSelector","get","fieldsList","getFieldsList","CONTACT","FIELDS","SMART_DOCUMENT","find","caption","selector","multiple","onFieldSelectEventData","selectedFieldNames","onFieldSelectEvent","BaseEvent","MyReference","COMPANY","blackList","Requisites","tagBody","Stamp","Sign","updateColor","contentEditable","focus","getText","getContainer","innerText","range","createRange","selectNodeContents","collapse","selection","getSelection","removeAllRanges","addRange","B2eReference","categoryCaption","fieldCaption","blockLayout","resizeNode","resizeText","step","catch","err","console","Promise","resolve","FieldSelector","loadFieldList","fieldList","PROFILE","hideSmartB2eDocument","languages","getLanguages","categoryCaptions","types","isTemplateMode","isObject","MyB2eReference","categories","documentInitiatedByType","DocumentInitiated","employee","profile","SMART_B2E_DOC","company","entries","forEach","category","undefined","CAPTION","EmployeeDynamic","DYNAMIC_MEMBER","item","allowEmptyFieldList","HcmLinkReference","party","setMemberParty","representative","REPRESENTATIVE","EMPLOYEE","alwaysHideCreateFieldButton","setCustomBackendSettings","list","splitedName","split","uri","requestOptions","Math","round","Style","family","property","size","bold","state","italic","underline","through","left","group","center","right","justify","buttonPressed","applyStyles","removeAttribute","updateFontSize","styles","renderStyle","querySelectorAll","action","getAttribute","addClass","indexOf","Block","myrequisites","mysign","mystamp","number","reference","myreference","requisites","sign","stamp","b2ereference","myb2ereference","employeedynamic","hcmlinkreference","blockContent","blockPanel","blockLoading","blockEditing","pageWithNotAllowed","onClick","Error","isString","toLowerCase","setPosition","position","top","getBoundingClientRect","documentRect","getStyle","getId","showNotAllowedArea","page","transferPositionToPage","pageElement","hideNotAllowedArea","fireAction","onMemberSelect","flag","blockLayouts","currentCode","getBlocks","blocksData","blocksInstance","loadBlocksData","result","isArray","i","showResizeArea","response","remove","contentTag","clean","setProperty","observerReady","maxTextSize","parseFloat","isOverflownX","clientHeight","scrollHeight","parentNode","param","target","minSize","unit","intervalTextResize","clearTimeout","overflow","parent","removeProperty","panelTag","allMembers","getMembers","selectedMembers","getCurrentFontSize","adjustActionsPanel","documentLayout","documentLayoutRect","actionsPanel","actionsPanelRect","marginLeft","getComputedStyle","x","click","hidden","isRemoved","unMuteResizeArea","hideResizeArea","setSavingMark","nodeForPosition","body","blockInitDim","min","scrollTop","offsetHeight","inDeadZone","getPagesGap","Resize","resizeContainer","moveContainer","isDomNode","wrapperLayout","pointRect","display","setAttribute","wrapperLayoutRect","borderDelta","setFullEditorContent","editorContent","getLinkedBlock","e","moving","resizing","initialRect","draggable","Draggable","container","DragAndDrop","HEADLESS","textResize","wrapper","positionLast","bottomResize","areaRect","wrapperRect","hasClass","max","offsetX","offsetY","newPosition","calcDeathTop","notAddDeathMargin","newPositionLinked","dragArea","widthInProcess","source","moveTopDelta","y","marginTop","gapBetweenPages","BlocksManager","blockColorChange","Map","blockReferenceFieldSelect","blockB2eReferenceFieldSelect","disableEdit","Boolean","resizeArea","preventClickOut","closest","activeBlock","initPagesRect","pages","pageRect","pageRectToMath","pageRectKey","isNumber","topBound","bottomBound","offsetWidth","c","getMinPageHeight","getDocumentId","setDocumentId","documentId","setEditorContent","setDocumentUid","getEntityId","getSeams","addMembers","returnMember","getCompanyId","getInitiatorName","getConfig","muteResizeArea","initBlocks","blocks","initRepository","repositoryItems","preventDefault","save","postData","realDocumentWidth","blockRect","pagesRect","nextPageRect","pageNum","currentPageRect","realDocumentWidthPx","saveBlank","errors","customData","Popup","titleBar","util","htmlspecialchars","buttons","Button","ButtonColor","SUCCESS","onclick","Backend","command","destroy","INFO","blockActionButton","firstError","PRIMARY","subscribeOnce","saveButton","afterSaveCallback","saveErrorCallback","onCloseSlider","everythingIsSaved","denyAction","MessageBox","confirm","messageBox","mark","setParam","getParam","getSliderByWindow","set","bottom","notAddMargin","seams","ii","cc","seam","widthPx","heightPx","pageImageRect","pixelPosition","seamShift","newBlock","existedSignBlock","signColor","newBlockCode","colorChangeListener","subscription","eventName","onFieldSelectListener","guide","Guide","steps","getElementById","autoSave","simpleMode","startOnce","helpBtnSpotlight","SpotLight","targetElement","targetVertex","rounded","article","onShow","isCRM","updatedBlock","newColor","isNull","deleteLatency","subscriptions","values","flatMap","unsubscribe","eventListenerCache","clear","buttonClassList","SectionType","freeze","General","FirstParty","SecondParty","HcmLinkIntegration","Editor","wizardType","setUrls","urls","totalPages","documentData","isTemplate","setSenderType","senderType","entityData","forbiddenRoles","MemberRole","editor","reviewer","role","renderDocument","promises","fragment","reduce","acc","promise","DocumentFragment","all","unsubscribeAll","contentCallback","onCloseComplete","waitForPagesUrls","setSectionVisibilityByType","visibility","sectionElement","add","setAnalytics","analytic","assignee","signer","editButtonClassName","join","saveButtonClassName","slice","editButtonTitle","saveButtonTitle","helpArticleElement","Helper","headTitleNode","Hint","create","Analytics","send","status","sections","bindOptions","angle","singleBlockSection","sectionsNodes","section","hint","isEdit","firstPartyBlocks","partnerBlocks","generalBlocks","titles","firstParty","partner","personalDataMessageCode","otherDataMessageCode","mainDataMessageCode","String","startsWith"],"mappings":";;;;;;;;AAAA,CAIe,MAAMA,KAAK,SAASC,6BAAY,CAC/C;;CAaA;CACA;CACA;GACCC,WAAW,CAACC,KAAY,EACxB;KACC,KAAK,EAAE;KAAC,KAhBTC,IAAI,GAAQ,EAAE;KAAA,KACdC,MAAM,GAAE;OACPC,QAAQ,EAAE,UAAU;OACpBC,kBAAkB,EAAE;MACpB;KAaA,IAAI,CAACC,iBAAiB,CAAC,gCAAgC,CAAC;KACxD,IAAI,CAACL,KAAK,GAAGA,KAAK;;;;CAIpB;CACA;CACA;GACCM,WAAW,GACX;KACC,OAAO,KAAK;;;;CAId;CACA;CACA;GACCC,cAAc,GACd;KACC,OAAO,IAAI;;;;CAIb;CACA;CACA;GACCC,OAAO,CAACP,IAAS,EACjB;KACC,IAAI,CAACA,IAAI,GAAGA,IAAI,GAAGA,IAAI,GAAG,EAAE;;;;CAI9B;CACA;CACA;GACCQ,OAAO,CAACC,IAAY,EACpB;KACC,IAAI,CAACF,OAAO,CAAC;OAAEE;MAAM,CAAC;;;;CAIxB;CACA;CACA;GACCC,gBAAgB,GAChB;KACC,OAAO;OACNC,KAAK,EAAE,GAAG;OACVC,MAAM,EAAE;MACR;;;;CAIH;CACA;CACA;GACCC,OAAO,GACP;KACC,OAAO,IAAI,CAACb,IAAI;;;;CAIlB;CACA;CACA;GACCc,eAAe,GACf;KACC,OAAO,IAAI;;;;CAIb;CACA;GACCC,eAAe,GACf;KACC,OAAO,IAAI;;;;CAIb;CACA;CACA;GACCC,cAAc,GACd;KACC,OAAOC,aAAG,CAACC,MAAM,cAAC;;MAEhB,CAAgF;;GAElF,GAFIC,cAAU,CAACC,MAAM,CAAC,IAAI,CAACpB,IAAI,CAACS,IAAI,IAAI,EAAE,CAAC,CAACY,QAAQ,EAAE,CAACC,UAAU,CAAC,MAAM,EAAE,MAAM,CAAC;;;;CAMnF;CACA;GACCC,qBAAqB,GACrB;;;CAID;CACA;GACCC,QAAQ,GACR;;;CAID;CACA;GACCC,MAAM,GACN;;;CAID;CACA;GACCC,QAAQ,GACR;;;CAID;CACA;GACCC,UAAU,GACV;KACC,IAAI,CAAC5B,KAAK,CAAC6B,SAAS,EAAE;;GAGvB1B,QAAQ,GACR;KACC,IAAI,CAAC2B,IAAI,CAAC,IAAI,CAAC5B,MAAM,CAACC,QAAQ,CAAC;;GAGhC4B,SAAS,GACT;KACC,OAAO,EAAE;;GAGVC,gBAAgB,CAACC,KAAa,EAC9B;CACD;CA/JqBpC,KAAK,CASlBqC,6BAA6B,GAAG;GACtCC,OAAO,EAAE;CACV,CAAC;;;;ACfF,CAG4B;CAAA;CAAA;CAAA;AAE5B,CAAe,MAAMC,IAAI,SAASvC,KAAK,CACvC;GAAA;KAAA;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAE4B;;KAAK;OAAA;OAAA;;;;CAIjC;CACA;CACA;GACCc,gBAAgB,GAChB;KACC,OAAO;OACNC,KAAK,EAAE,GAAG;OACVC,MAAM,EAAE;MACR;;;;CAIH;CACA;CACA;GACCL,OAAO,CAACP,IAAS,EACjB;KACC,IAAI,CAACA,IAAI,GAAGA,IAAI,GAAGA,IAAI,GAAG,EAAE;KAC5B,4CAAI,kBAAS,IAAI,CAACA,IAAI,CAACS,IAAI;;;;CAI7B;CACA;GACC2B,aAAa,GACb;KACC,4CAAI,0BAAaC,EAAE,CAACC,QAAQ,CAAC;OAC5BC,IAAI,EAAE,IAAI,CAACxC,KAAK,CAACyC,SAAS,EAAE;OAC5BC,KAAK,EAAE,IAAI,CAACzB,cAAc,EAAE;OAC5B0B,KAAK,0CAAE,IAAI,eAAM;OACjBC,KAAK,EAAE,KAAK;OACZC,cAAc,EAAGC,OAAI,IAAK;SACzB,IAAI,CAACrC,OAAO,CACX6B,EAAE,CAACQ,IAAI,CAACC,MAAM,CAACT,EAAE,CAACQ,IAAI,CAACE,mBAAmB,CAACV,EAAE,CAACW,OAAO,CAAC,aAAa,CAAC,CAAC,EAAEH,OAAI,EAAE,IAAI,CAAC,CAClF;SACD,IAAI,CAAC9C,KAAK,CAACkD,UAAU,EAAE;;MAExB,CAAC;KAEF,4CAAI,sCAAmB,IAAI;KAC3B,MAAMC,eAAe,GAAGC,QAAQ,CAACC,aAAa,CAAC,uBAAuB,CAAC;KACvE,MAAM;OAAEC;MAAO,2CAAG,IAAI,uBAAU;KAChCA,KAAK,CAACH,eAAe,GAAGA,eAAe;KACvC,IAAIG,KAAK,CAACC,cAAc,CAACC,aAAa,KAAKL,eAAe,EAC1D;OACCM,aAAG,CAACC,MAAM,CAACJ,KAAK,CAACC,cAAc,EAAEJ,eAAe,CAAC;OACjDG,KAAK,CAACK,cAAc,EAAE;;;;;CAKzB;CACA;CACA;GACC5C,eAAe,GACf;KACC,OAAOG,aAAG,CAACC,MAAM,oBAAC;;uBAEC,CAAgC;OAChD,CAAwD;;;GAG3D,GAJqB,IAAI,CAACkB,aAAa,CAACuB,IAAI,CAAC,IAAI,CAAC,EAC7CC,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;;;;CAO5D;CACA;;;CAWA;CACA;GACCtC,qBAAqB,GACrB;KACC,4CAAI;;;;CAIN;CACA;GACCE,MAAM,GACN;KACC,4CAAI;;;;CAIN;CACA;GACCC,QAAQ,GACR;KACC,4CAAI;;;;CAIN;CACA;GACCC,UAAU,GACV;KACC,IAAI,yCAAC,IAAI,mCAAgB,EACzB;OACC,IAAI,CAAC5B,KAAK,CAAC6B,SAAS,EAAE;;KAGvB,4CAAI,sCAAmB,KAAK;;GAG7BE,SAAS,GACT;KACC,OAAO;OAAE,GAAG,KAAK,CAACA,SAAS,EAAE;OAAE,GAAGK,IAAI,CAACF;MAA+B;;CAExE;CAAC,2BAjDA;GACC,4CAAI,IAAI,yBACR;KACC,4CAAI,wBAAW6B,KAAK,EAAE;KACtB,4CAAI,sCAAmB,KAAK;;CAE9B;;;;ACvFD,CAK4B;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE5B,CAAe,MAAMC,YAAY,SAASnE,KAAK,CAC/C;GAAA;KAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OACU,IAAIoE,eAAK,CAACC,WAAW;;;;CAG/B;CACA;CACA;GACC5D,WAAW,GACX;KACC,OAAO,IAAI;;;;CAIb;CACA;CACA;GACCK,gBAAgB,GAChB;KACC,OAAO;OACNC,KAAK,EAAE,GAAG;OACVC,MAAM,EAAE;MACR;;;;CAIH;CACA;CACA;;;CAQA;CACA;CACA;GACCE,eAAe,GACf;KACC,OAAOG,aAAG,CAACC,MAAM,oBAAC;;uBAEC,CAAiC,wCAAqC,CAAuB;OAC7G,CAA8D;;;GAGjE,GAJqB,4CAAI,kCAAgByC,IAAI,CAAC,IAAI,CAAC,EAAwC,IAAI,CAAC5D,KAAK,CAACmE,OAAO,EAAE,EAC1GN,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;;GAMjE/B,SAAS,GACT;KACC,OAAO;OAAE,GAAG,KAAK,CAACA,SAAS,EAAE;OAAE,GAAGiC,YAAY,CAAC9B;MAA+B;;CA0GhF;CAAC,yBAjIekC,KAAmB,EAClC;GACCA,KAAK,CAACC,eAAe,EAAE;GACvB,4CAAI,4CAAsBC,IAAI,EAAE;CACjC;CAAC,oCAuBD;GACC,OAAO,CACN,SAAS,EACT,aAAa,CACb;CACF;CAAC,8CAGD;GACC,OAAO,IAAIC,GAAG,CAAC,CACd,MAAM,EACN,UAAU,EACV,SAAS,EACT,OAAO,CACP,CAAC;CACH;CAAC,uCAE4BC,MAA+B,EAC5D;GACC,OAAOA,MAAM,CAACC,MAAM,CAClBC,eAAe,IAAK,CAAC,4CAAI,0EAAqCC,GAAG,CAACD,eAAe,CAACE,IAAI,CAAC,CACxF;CACF;CAAC,+BAGD;GACC,OAAO,4CAAI,kBAAQC,QAAQ,CAAC,gBAAgB,EAAE,MAAM;KAAA;KACnD,MAAMC,aAAa,GAAG,IAAI,CAAC9E,KAAK,CAAC8E,aAAa;KAC9C,MAAMC,MAAM,GAAGD,aAAa,CAACE,eAAe,CAAC,IAAI,CAAChF,KAAK,CAACiF,aAAa,EAAE,CAAC;KAExE,MAAM;OAAEC,YAAY;OAAEC,QAAQ;OAAEC;MAAU,GAAGL,MAAM;KACnD,MAAMM,GAAG,kBAAGN,MAAM,CAACM,GAAG,0BAAID,QAAQ;KAElC,MAAME,cAAc,GAAG,IAAIC,2CAAc,CAAC;OACzCL,YAAY;OACZE,QAAQ,EAAEC,GAAG;OACbG,WAAW,EAAEV,aAAa,CAACW,cAAc,EAAE;OAC3CvF,MAAM,EAAE;SACPwF,OAAO,EAAE,MAAM;WACd,IAAI,CAAC1F,KAAK,CAAC2F,MAAM,EAAE;WACnB,4CAAI,kBAAQC,MAAM,CAAC,gBAAgB,CAAC;;QAErC;OACDC,sBAAsB,EAAE;SACvBC,kBAAkB,EAAE;WACnBrB,MAAM,EAAE;aACP,aAAa,EAAE,CACd,SAAS,CACT;aACD,SAAS,EAAE,CACV,MAAM,EACN,QAAQ,EACR,MAAM,EACN,cAAc,EACd,MAAM,EACN,UAAU,EACV,aAAa,EACb,SAAS,EACT,KAAK,EACL,QAAQ,EACR,SAAS,CACT;aACD,SAAS,EAAE,CACV,CAAC;eAAEsB,iBAAiB,EAAEC;cAAW,KAAK,4CAAI,sDAA2BC,QAAQ,CAACD,SAAS,CAAC;YAEzF;WACDE,aAAa,EAAE;aACdzB,MAAM,EAAE,4CAAI,8DAA8Bb,IAAI,CAAC,IAAI;YACnD;WACDuB,QAAQ;WACRgB,iBAAiB,EAAE;aAClBC,WAAW,EAAE,CAAC;aACdC,cAAc,EAAE,CAAC;aACjBC,iBAAiB,EAAE,CAAC;aACpBnB;;;QAGF;OACDoB,YAAY,EAAE;SAAEC,OAAO,EAAE,IAAI;SAAEC,SAAS,EAAE;;MAC1C,CAAC,CACAC,WAAW,CAAC,2CAA2C,CAAC;KAG1DpB,cAAc,CAACqB,SAAS,CAAC,qBAAqB,EAAE,4CAAI,0EAAoC/C,IAAI,CAAC,IAAI,CAAC,CAAC;KAEnG,OAAO0B,cAAc;IACrB,CAAC;CACH;CAAC,6CAEkClB,KAA6E,EAChH;GACC,4CAAI,4CAAsBwC,IAAI,EAAE;GAChC,MAAMC,oBAAoB,GAAGzC,KAAK,CAACtD,OAAO,EAAE,CAACgG,aAAa,CAACC,IAAI,CAAEC,KAAK,IAAKA,KAAK,CAACC,IAAI,KAAK,eAAe,CAAC;GAC1G,IAAIJ,oBAAoB,EACxB;KACCK,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;OAC7BC,OAAO,EAAEC,cAAI,CAAClG,MAAM,CAACwC,aAAG,CAACC,UAAU,CAAC,2DAA2D,CAAC,CAAC;OACjG0D,aAAa,EAAE,IAAI;OACnB5G,KAAK,EAAE;MACP,CAAC;;CAEJ;;;;;;;;;;;;ACpKD,CAmBA,MAAM6G,WAAW,GAAGC,oBAAU,CAACC,QAAQ,CAAC,gBAAgB,CAAC;AAEzD,CAAe,MAAMT,EAAE,CACvB;;CAEA;CACA;CACA;CACA;GACC,OAAOU,OAAO,CAACC,OAAoB,EAAEC,IAA6B,EAClE;KACCC,MAAM,CAACC,IAAI,CAACF,IAAI,CAAC,CAACG,GAAG,CAACC,GAAG,IAAI;OAC5BJ,IAAI,CAACI,GAAG,CAAC,GAAGC,QAAQ,CAACL,IAAI,CAACI,GAAG,CAAC,CAAC,GAAG,IAAI;MACtC,CAAC;KACFzE,aAAG,CAAC2E,KAAK,CAACP,OAAO,EAAEC,IAAI,CAAC;;;;CAI1B;CACA;CACA;CACA;GACC,OAAOO,cAAc,CAACC,OAA2B,EACjD;KACC,OAAOpH,aAAG,CAACC,MAAM,oBAAC;;;;;;;;6HAQuG,CAAmB;uHACzB,CAAiB;;;;GAIpI,GAL2HmH,OAAO,CAAC3G,QAAQ,EACtB2G,OAAO,CAAC5G,MAAM;;;;CAQrI;CACA;CACA;CACA;CACA;CACA;GACC,OAAO6G,iBAAiB,CAACC,OAA0B,EAAEC,aAAqB,EAAGtI,QAAkB,EAC/F;KACC,MAAMuI,SAAS,GAAG,EAAE;KACpB,IAAIC,YAAY,GAAG9E,aAAG,CAACC,UAAU,CAAC,sCAAsC,CAAC;KAEzE0E,OAAO,CAACP,GAAG,CAAClD,MAAM,IAAI;OACrBA,MAAM,CAACH,IAAI,GAAGG,MAAM,CAACH,IAAI,IAAIf,aAAG,CAACC,UAAU,CAAC,sCAAsC,CAAC;OACnF4E,SAAS,CAAC3D,MAAM,CAAC6D,IAAI,CAAC,GAAG7D,MAAM,CAACH,IAAI;OAEpC,IAAIG,MAAM,CAAC6D,IAAI,KAAKH,aAAa,EACjC;SACCE,YAAY,GAAG5D,MAAM,CAACH,IAAI;;MAE3B,CAAC;KAEF,MAAMiE,cAAc,GAAIL,OAAO,CAACM,MAAM,GAAG,CAAC,GACvC5H,aAAG,CAACC,MAAM,kBAAC,SAAM,CAAkC,SAAO,GAAvCC,cAAU,CAACC,MAAM,CAACsH,YAAY,CAAC,IAClDzH,aAAG,CAACC,MAAM,kBAAC,MAAG,CAAkC,MAAI,GAApCC,cAAU,CAACC,MAAM,CAACsH,YAAY,CAAC,CAAM;KAExD,IAAIH,OAAO,CAACM,MAAM,GAAG,CAAC,EACtB;OACCC,UAAM,CAACC,cAAc,CAAC;SACrBC,WAAW,EAAEJ,cAAc;SAC3BK,KAAK,EAAER,SAAS;SAChBS,aAAa,EAAExG,KAAK,IAAI;WACvBkG,cAAc,CAACO,SAAS,GAAGV,SAAS,CAAC/F,KAAK,CAAC;WAC3CxC,QAAQ,CAACgI,QAAQ,CAACxF,KAAK,CAAC,CAAC;;QAE1B,CAAC;;KAGH,OAAOzB,aAAG,CAACC,MAAM,kBAAC;;MAEhB,CAAiB;;GAEnB,GAFI0H,cAAc;;;;CAMpB;CACA;CACA;GACC,OAAOQ,aAAa,GACpB;KACC,OAAOnI,aAAG,CAACC,MAAM,kBAAC;;;;;;;;;;;;;GAalB;;;;CAIF;CACA;CACA;GACC,OAAOmI,aAAa,CACnBH,aAA8D,EAC9DI,aAAsC,EAEvC;KAAA;;KAEC,MAAMC,KAAK,GAAG;OACb,0BAA0B,EAAI,8EAA8E;OAC5G,eAAe,EAAe,+DAA+D;OAC7F,kBAAkB,EAAY,sEAAsE;OACpG,uBAAuB,EAAO,uEAAuE;OACrG,gBAAgB,EAAc,kEAAkE;OAChG,SAAS,EAAqB,mDAAmD;OACjF,gBAAgB,EAAc,0DAA0D;OACxF,WAAW,EAAmB;MAC9B;KACD,MAAMC,UAAU,GAAGvI,aAAG,CAACC,MAAM,kBAAC,iEAA8D,CAAgD,QAAM,GAApDqI,KAAK,CAACD,aAAa,CAAC,aAAa,CAAC,CAAC,IAAI,MAAM,CAAQ;KACnJR,UAAM,CAACC,cAAc,CAAC;OACrBC,WAAW,EAAEQ,UAAU;OACvBP,KAAK,EAAEM,KAAK;OACZL,aAAa,EAAExG,KAAK,IAAI;SACvB8G,UAAU,CAACL,SAAS,GAAGI,KAAK,CAAC7G,KAAK,CAAC;SACnCwG,aAAa,CAAC,QAAQ,EAAExG,KAAK,CAAC;;MAE/B,CAAC;;;;KAIF,IAAI+G,YAAY,GAAGvB,QAAQ,CAACoB,aAAa,CAAC,WAAW,CAAC,CAAC;KACvD,IAAII,aAAa,GAAG,EAAE;KAEtB,IAAID,YAAY,EAChB;OACCC,aAAa,GAAGD,YAAY;;KAG7B,MAAME,QAAQ,GAAG1I,aAAG,CAACC,MAAM,kBAAC,8DAA2D,CAAmC,QAAM,GAAvCwI,aAAa,GAAE,IAAI,IAAI,SAAS,CAAQ;KACjIZ,UAAM,CAACC,cAAc,CAAC;OACrBC,WAAW,EAAEW,QAAQ;OACrBV,KAAK,EAAE,CACN,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAClF,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,CACtE;OACDC,aAAa,EAAExG,KAAK,IAAI;SACvBiH,QAAQ,CAACR,SAAS,GAAGjB,QAAQ,CAACxF,KAAK,CAAC,GAAG,IAAI;SAC3CwG,aAAa,CAAC,MAAM,EAAExG,KAAK,CAAC;QAC5B;OACDkH,YAAY,EAAEF;MACd,CAAC;;;KAGF,MAAM;OAAEG,MAAM,EAAEC;MAAW,GAAG7C,EAAE,CAAC8C,mBAAmB,yBACnDT,aAAa,CAACtH,KAAK,mCAAI,MAAM,EAC5BA,KAAK,IAAKkH,aAAa,CAAC,OAAO,EAAElH,KAAK,CAAC,CACxC;KAED,OAAOf,aAAG,CAACC,MAAM,kBAAC;;;MAGhB,CAAa;MACb,CAAW;MACX,CAAY;;;;;;;;;;;GAWd,GAbIsI,UAAU,EACVG,QAAQ,EACRG,SAAS;;GAcd,OAAOC,mBAAmB,CACzBC,uBAA+B,EAC/BC,aAA8B,EAC9BC,kBAAsC,GAAG,EAAE,EAE5C;KACC,MAAML,MAAM,GAAG5I,aAAG,CAACC,MAAM,kBAAC;;YAElB,CAAiD;UAClD,GADG0C,aAAG,CAACC,UAAU,CAAC,8BAA8B,CAAC,CAChD;KAERoD,EAAE,CAACkD,2BAA2B,CAACN,MAAM,EAAEG,uBAAuB,CAAC;KAC/D,MAAMI,yBAAyB,GAAG;OACjC,GAAGF,kBAAkB;OACrBlB,WAAW,EAAEa,MAAM;OACnBQ,eAAe,EACbrI,KAAK,IAAK;SACViI,aAAa,CAACjI,KAAK,CAAC;SACpBiF,EAAE,CAACkD,2BAA2B,CAACN,MAAM,EAAE7H,KAAK,CAAC;;MAE/C;KAED,MAAMsI,MAAM,GAAG,IAAI9C,WAAW,CAAC4C,yBAAyB,CAAC;KAEzDG,eAAK,CAAC5G,IAAI,CAACkG,MAAM,EAAE,OAAO,EAAE,MAAM;OACjCS,MAAM,CAACE,IAAI,EAAE;MACb,CAAC;KAEF,OAAO;OAAEX,MAAM;OAAEY,WAAW,EAAEH;MAAQ;;GAGvC,OAAOH,2BAA2B,CAACN,MAAmB,EAAE7H,KAAa,EACrE;KACC,MAAM0I,WAAW,GAAGb,MAAM,CAACzG,aAAa,CAAC,8CAA8C,CAAC;KACxF,IAAIuH,cAAI,CAACC,KAAK,CAACF,WAAW,CAAC,EAC3B;OACC;;KAGDlH,aAAG,CAAC2E,KAAK,CACRuC,WAAW,EACX,kBAAkB,EAClB1I,KAAK,CACL;;CAEH;;;;;;AC1PA,CAG4B;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE5B,CAAe,MAAM6I,MAAM,SAASjL,KAAK,CACzC;GAAA;KAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OAGU,IAAIoE,eAAK,CAACC,WAAW;;KAAE;OAAA;OAAA,OACC;;KAAS;OAAA;OAAA,OACN,CAAC,MAAM,0CAAE,IAAI,mDAAyB,SAAS;;KAAC;OAAA;OAAA,OAC3C;;;;CAG1C;CACA;CACA;GACC5D,WAAW,GACX;KACC,OAAO,IAAI;;;;CAIb;CACA;CACA;GACCC,cAAc,GACd;KACC,OAAO,KAAK;;;;CAId;CACA;CACA;GACCI,gBAAgB,GAChB;KACC,OAAO;OACNC,KAAK,EAAE,GAAG;OACVC,MAAM,EAAE;MACR;;;;CAIH;CACA;CACA;GACCI,cAAc,GACd;KACC,MAAM;OAAEL,KAAK;OAAEC;MAAQ,GAAG,IAAI,CAACb,KAAK,CAAC+K,WAAW,EAAE;KAElD,IAAIC,GAAG,GAAG,IAAI;KACd,IAAI,IAAI,CAACC,OAAO,EAChB;OACCD,GAAG,GAAG,IAAI,CAACC,OAAO;MAClB,MACI,IAAI,IAAI,CAAChL,IAAI,CAACiL,MAAM,EACzB;OACCF,GAAG,GAAG,oBAAoB,GAAG,IAAI,CAAC/K,IAAI,CAACiL,MAAM;;KAG9C,IAAIF,GAAG,EACP;OACC,OAAO9J,aAAG,CAACC,MAAM,oBAAC;gBACP,CAAM;IACjB,GADa6J,GAAG;MAEhB,MAED;OACC,OAAO9J,aAAG,CAACC,MAAM,sBAAC;;OAEhB,CAAkE;;IAEpE,GAFIC,cAAU,CAACC,MAAM,CAAC,IAAI,CAACpB,IAAI,CAACS,IAAI,IAAI,IAAI,CAACyK,mBAAmB,EAAE,CAAC;;;;;CAOtE;CACA;CACA;GACCA,mBAAmB,GACnB;KACC,OAAOtH,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;;GAQjElC,UAAU,GACV;KACC,KAAK,CAACA,UAAU,EAAE;KAClB,4CAAI;;GAGLD,QAAQ,GACR;KACC,KAAK,CAACA,QAAQ,EAAE;KAChB,4CAAI;;GASLD,MAAM,GACN;KACC,KAAK,CAACA,MAAM,EAAE;KACd,4CAAI;;GAGLK,SAAS,GACT;KACC,OAAO;OAAEqJ,kBAAkB,EAAE,mBAAmB;OAAEnJ,KAAK,0CAAE,IAAI;MAAuB;;GAGrFD,gBAAgB,CAACC,KAAa,EAAEoJ,SAAkB,GAAG,IAAI,EACzD;KACC,KAAK,CAACrJ,gBAAgB,CAACC,KAAK,CAAC;KAC7B,4CAAI,sDAA2BA,KAAK;KAEpC,MAAM;OAAE6H,MAAM;OAAEY;MAAa,2CAAG,IAAI,+CAAuB;KAC3DxD,EAAE,CAACkD,2BAA2B,CAACN,MAAM,EAAE7H,KAAK,CAAC;KAC7CyI,WAAW,CAACY,gBAAgB,CAACrJ,KAAK,CAAC;KAEnC,IAAIoJ,SAAS,EACb;OACC,IAAI,CAACvJ,IAAI,CAAC,IAAI,CAAC5B,MAAM,CAACE,kBAAkB,CAAC;;;;;CAK5C;CACA;GACCY,eAAe,GACf;KACC,MAAM;OAAE8I,MAAM,EAAEyB;MAAwB,2CAAG,IAAI,+CAAuB;KAEtE,OAAOrK,aAAG,CAACC,MAAM,sBAAC;;KAEjB,CAAyB;;;SAGrB,CAAwD;;;GAG7D,GANGoK,sBAAsB,EAGlB1H,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;;CAmB9D;CAAC,+BA/EA;GAAA;GACC,wEAAO,IAAI,+HAA4B,IAAI;CAC5C;CAAC,mCAeD;GACC,MAAM;KAAE4G;IAAa,2CAAG,IAAI,+CAAuB;GACnDA,WAAW,CAACc,KAAK,EAAE;CACpB;CAAC,iCA+CD;GACC,OAAO,4CAAI,sBAAQ3G,QAAQ,CAAC,kBAAkB,EAAE;KAAA;KAAA,OAAMqC,EAAE,CAAC8C,mBAAmB,mEAC3E,IAAI,gIAA4B,IAAI,mDACnC/H,KAAK,IAAK,IAAI,CAACD,gBAAgB,CAACC,KAAK,CAAC,EACvC;OACCwJ,MAAM,EAAE,yCAAC,IAAI,wDAA2B;OACxCC,gBAAgB,EAAE,KAAK;OACvBC,aAAa,oEAAE,IAAI,gIAA4B,IAAI,iDAAuB;OAC1EC,YAAY,EAAE;MACd,CACD;KAAC;CACH;;;;;;ACtKD,CAI4B;CAAA;CAAA;CAAA;AAE5B,CAAe,MAAMC,OAAO,SAAShM,KAAK,CAC1C;GAOCE,WAAW,CAACC,MAAY,EACxB;KACC,KAAK,CAACA,MAAK,CAAC;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAEb,4CAAI,0BAAa,IAAI8L,0BAAQ,CAAC;OAC7BC,UAAU,EAAE;SACXC,MAAM,EAAE;QACR;OACDC,OAAO,EAAE;SACRC,EAAE,EAAE,CAAC;SACLC,KAAK,EAAE;;MAER,CAAC;KACF,4CAAI,wBAAWxF,SAAS,CAAC,aAAa,EAAE,MAAOvC,KAAK,IAAK;OAAA;OACxDyH,OAAO,CAACO,YAAY,CAACC,KAAK,CAAC,IAAI,CAAC;OAChC,MAAMC,SAAS,GAAGlI,KAAK,CAACtD,OAAO,EAAE;OACjC,IAAI,EAACwL,SAAS,+BAATA,SAAS,CAAEC,IAAI,aAAf,gBAAiBC,QAAQ,GAC9B;SACC;;OAGD,IAAI,CAACvB,OAAO,GAAGqB,SAAS,CAACC,IAAI,CAACE,gBAAgB;OAC9C,4CAAI,0BAAYZ,OAAO,CAACO,YAAY,EAAEE,SAAS,CAACC,IAAI,CAACC,QAAQ;MAC7D,CAAC;KACF,4CAAI,gBAAQ,IAAIE,eAAG,EAAE;;;;CAIvB;CACA;CACA;GACCpM,WAAW,GACX;KACC,OAAO,IAAI;;;;CAIb;CACA;CACA;GACCC,cAAc,GACd;KACC,OAAO,KAAK;;;;CAId;CACA;CACA;GACCI,gBAAgB,GAChB;KACC,OAAO;OACNC,KAAK,EAAE,GAAG;OACVC,MAAM,EAAE;MACR;;;;CAIH;CACA;CACA;GACCE,eAAe,GACf;KAAA;KACC,MAAM4L,KAAK,GAAG,yBAAI,CAAC1M,IAAI,CAAC2M,MAAM,aAAhB,kBAAkB1B,MAAM,GACrCrH,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC,GAChDD,aAAG,CAACC,UAAU,CAAC,8BAA8B,CAAC;KAE/C,OAAO5C,aAAG,CAACC,MAAM,oBAAC;;uBAEC,CAAiC;OACjD,CAAQ;;;GAGX,GAJqB,4CAAI,sCAAgByC,IAAI,CAAC,IAAI,CAAC,EAC9C+I,KAAK;;;;CAOZ;CACA;CACA;;;CAwBA;CACA;CACA;GACC1L,cAAc,GACd;KAAA;KACC,IAAI+J,GAAG,GAAG,IAAI;KAEd,0BAAI,IAAI,CAAC/K,IAAI,CAAC2M,MAAM,aAAhB,mBAAkB1B,MAAM,EAC5B;OACCF,GAAG,GAAG,oBAAoB,GAAG,IAAI,CAAC/K,IAAI,CAAC2M,MAAM,CAAC1B,MAAM;;KAGrD,IAAIF,GAAG,EACP;OACC,OAAO9J,aAAG,CAACC,MAAM,sBAAC;mFAC4D,CAAM;IACpF,GADgF6J,GAAG;MAEnF,MAED;OACC,OAAO9J,aAAG,CAACC,MAAM,sBAAC;;IAElB;;;CAGH;CAAC,2BAhDeiD,KAAmB,EAClC;GACCyH,OAAO,CAACO,YAAY,GAAG,IAAI,CAACpM,KAAK;GACjC,4CAAI,wBAAWsE,IAAI,EAAE;CACtB;CAAC,2BAOgBtE,KAAY,EAAE6M,MAAc,EAC7C;GACC,MAAMC,UAAU,GAAG9M,KAAK,CAACiF,aAAa,EAAE;GACxC,MAAMF,MAAM,GAAG/E,KAAK,CAAC8E,aAAa,CAACE,eAAe,CAAC8H,UAAU,CAAC;GAC9D,MAAM,4CAAI,cAAMC,SAAS,CAAChI,MAAM,CAACiI,GAAG,EAAEH,MAAM,CAAC;GAC7C7M,KAAK,CAAC2F,MAAM,EAAE;GACd,MAAMmE,MAAM,GAAG+B,OAAO,CAACO,YAAY,CAAC3J,SAAS,EAAE;GAC/C,MAAMwK,MAAM,GAAGnD,MAAM,CAACzG,aAAa,CAAC,4BAA4B,CAAC;GACjE4J,MAAM,CAACC,WAAW,GAAGrJ,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC;CACtE;;;;;AClHD,CAG4B;AAE5B,CAAe,MAAMqJ,QAAM,SAAStN,KAAK,CACzC;GAAA;KAAA;KAAA;OAAA;;;;CAIA;CACA;CACA;GACCS,WAAW,GACX;KACC,OAAO,IAAI;;;;CAIb;CACA;CACA;GACCK,gBAAgB,GAChB;KACC,OAAO;OACNC,KAAK,EAAE,GAAG;OACVC,MAAM,EAAE;MACR;;;;CAIH;CACA;CACA;;;CAuCA;CACA;CACA;GACCE,eAAe,GACf;KACC,OAAOG,aAAG,CAACC,MAAM,oBAAC;;uBAEC,CAAiC;OACjD,CAAwD;;;GAG3D,GAJqB,4CAAI,sCAAgByC,IAAI,CAAC,IAAI,CAAC,EAC9CC,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;;;;CAO5D;CACA;CACA;GACC7C,cAAc,GACd;KACC,OAAOC,aAAG,CAACC,MAAM,sBAAC;;MAEhB,CAAqD;;GAEvD,GAFIC,cAAU,CAACC,MAAM,CAAC,IAAI,CAACpB,IAAI,CAACS,IAAI,IAAI,EAAE,CAAC,CAACY,QAAQ,EAAE;;GAKvDS,SAAS,GACT;KACC,OAAO;OAAE,GAAG,KAAK,CAACA,SAAS,EAAE;OAAE,GAAGoL,QAAM,CAACjL;MAA+B;;CAE1E;CAAC,2BArEekC,KAAmB,EAClC;GACCA,KAAK,CAACC,eAAe,EAAE;GACvB,IAAI,CAAC8I,QAAM,CAACC,mBAAmB,EAC/B;KACCD,QAAM,CAACC,mBAAmB,GAAG,IAAI;KAEjC9K,EAAE,CAAC+K,cAAc,CAACC,MAAM,EAAE,4BAA4B,EAAE,MAAOlJ,KAAK,IACpE;OAAA;OACC,MAAMmJ,QAAQ,GAAG,kBAAAnJ,KAAK,CAACoJ,MAAM,qBAAZ,cAAcC,GAAG,MAAK,QAAQ;OAC/C,IAAIF,QAAQ,IAAInJ,KAAK,CAACsJ,UAAU,EAAE,KAAK,uBAAuB,EAC9D;SAAA;SACC,MAAMC,aAAa,GAAGvJ,KAAK,CAACtD,OAAO,EAAE;SACrC,MAAMsL,YAAY,4BAAGhI,KAAK,qCAALA,KAAK,CAAEwJ,MAAM,+CAAb,cAAetF,OAAO,+CAAtB,uBAAwBrI,IAAI,qBAA5B,uBAA8BD,KAAK,oCAAI,IAAI,CAACA,KAAK;SAEtE,IAAI2N,aAAa,CAACE,IAAI,KAAK,oBAAoB,EAC/C;WACCzB,YAAY,CAACC,KAAK,CAAC,IAAI,CAAC;WACxB,MAAMyB,GAAG,GAAG,IAAIpB,eAAG,EAAE;WACrB,MAAMM,GAAG,GAAGZ,YAAY,CAACtH,aAAa,CAACW,cAAc,EAAE;WACvD,MAAMqI,GAAG,CAACC,mBAAmB,CAACf,GAAG,CAAC;WAClCZ,YAAY,CAACzG,MAAM,EAAE;;;MAGvB,CAAC;;GAGH,MAAM;KAAEqI;IAAiB,GAAG,IAAI,CAAC/N,IAAI,CAAC2M,MAAM;GAC5CtK,EAAE,CAAC2L,SAAS,CAACC,QAAQ,CAACzD,IAAI,CAACuD,eAAe,EAAE;KAC3CpN,KAAK,EAAE,GAAG;KACV6F,SAAS,EAAE,KAAK;KAChBxG,IAAI,EAAE;OACLD,KAAK,EAAE,IAAI,CAACA;;IAEb,CAAC;CACH;AAhEoBmN,SAAM,CAEnBC,mBAAmB,GAAY,KAAK;;;;;;ACP5C,CAIoD;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEpD,CAAe,MAAMe,SAAS,SAAStO,KAAK,CAC5C;GAAA;KAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OACU,IAAIoE,eAAK,CAACC,WAAW;;KAAE;OAAA;OAAA;;KAAA;OAAA;OAAA;;;;CAKjC;CACA;CACA;GACC1D,OAAO,CAACP,IAAS,EACjB;KAAA;KACC,IAAI,CAACA,IAAI,GAAGA,IAAI,GAAGA,IAAI,GAAG,EAAE;KAC5B,4CAAI,wCAAU,IAAI,CAACA,IAAI,CAACyC,KAAK,+BAAI,EAAE;;;;CAIrC;CACA;GACCjB,QAAQ,GACR;KACC,4CAAI;;;;CAIN;CACA;;;CA8BA;CACA;CACA;GACCV,eAAe,GACf;KACC,IAAI6J,cAAI,CAACwD,WAAW,CAACC,iCAAQ,CAAC,EAC9B;OACC,OAAO,IAAI;;KAGZ,4CAAI,kCAAiBnN,aAAG,CAACC,MAAM,oBAAC;;uBAEb,CAAiC;;;GAGpD,GAHqB,4CAAI,sCAAgByC,IAAI,CAAC,IAAI,CAAC,CAGlD;KAED,4CAAI;KAEJ,+CAAO,IAAI;;;;CAIb;CACA;;;CA4BA;CACA;CACA;GACC3C,cAAc,GACd;KACC,4CAAI;KAEJ,MAAM;OAAEL,KAAK;OAAEC;MAAQ,GAAG,IAAI,CAACb,KAAK,CAAC+K,WAAW,EAAE;KAElD,IAAI,IAAI,CAAC9K,IAAI,CAAC+K,GAAG,EACjB;OACC,OAAO9J,aAAG,CAACC,MAAM,sBAAC;yBACE,CAAa,eAAY,CAAc,uBAAoB,CAAgB;;IAE/F,GAFsBP,KAAK,GAAG,EAAE,EAAeC,MAAM,GAAG,EAAE,EAAuB,IAAI,CAACZ,IAAI,CAAC+K,GAAG;MAG9F,MAED;OACC,MAAMsD,SAAS,GAAG,CAAC,IAAI,CAACrO,IAAI,CAACS,IAAI,GAAG,4CAA4C,GAAG,EAAE;OAErF,OAAOQ,aAAG,CAACC,MAAM,sBAAC;kBACL,CAAY;OACvB,CAAyF;;IAE3F,GAHemN,SAAS,EACpBlN,cAAU,CAACC,MAAM,CAAC,IAAI,CAACpB,IAAI,CAACS,IAAI,IAAImD,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC,CAAC;;;GA4E5F/B,SAAS,GACT;KACC,OAAO;OAAE,GAAG,KAAK,CAACA,SAAS,EAAE;OAAE,GAAGoM,SAAS,CAACjM;MAA+B;;CA2B7E;CAAC,6BA/MA;GACC,4CAAI,0DACFoC,IAAI,EAAE,CACNiK,IAAI,CAAEC,aAA4B,IAAK;KACvC,MAAMC,kBAAkB,GAAG,CAAC,GAAGD,aAAa,CAAC;KAC7C,IAAIA,aAAa,CAAC1F,MAAM,KAAK,CAAC,IAAI8B,cAAI,CAAC8D,cAAc,yCAAC,IAAI,kBAAQ,EAClE;OACCD,kBAAkB,CAACE,IAAI,yCAAC,IAAI,kBAAQ;;KAErC,4CAAI,oDAAyBF,kBAAkB;KAE/C,IAAID,aAAa,CAAC1F,MAAM,KAAK,CAAC,EAC9B;OACC;;KAGDrF,aAAG,CAACmL,WAAW,CAAC,IAAI,CAAC5O,KAAK,CAACyC,SAAS,EAAE,EAAE,WAAW,CAAC;KACpD,4CAAI,oBAAU+L,aAAa,CAAC,CAAC,CAAC;KAC9B,IAAI,CAAChO,OAAO,CAAC;OACZkC,KAAK,0CAAE,IAAI;MACX,CAAC;KACFmM,UAAU,CAAC,MAAM;OAChB,IAAI,CAAC7O,KAAK,CAAC2F,MAAM,EAAE;MACnB,EAAE,CAAC,CAAC;IACL,CAAC;CACJ;CAAC,kCA6BD;GAAA;GACC,IAAI,yCAAC,IAAI,+BAAc,EACvB;KACC;;GAGD,MAAMmJ,YAAY,GAAG,4CAAI,gCAAezL,aAAa,CAAC,QAAQ,CAAC;GAC/D,MAAM0L,cAAc,GAAGlL,aAAG,CAACC,UAAU,CAAC,0CAA0C,CAAC;GACjF,IAAI,yCAAC,IAAI,iBAAO,EAChB;KACCgL,YAAY,CAAC5B,WAAW,GAAG6B,cAAc;KACzC;;GAGD,MAAMC,aAAa,4BAAG,4CAAI,sBAAQC,GAAG,CAAC,eAAe,CAAC,4EAAI,IAAI,yDAA4B;GAC1F,MAAMC,UAAU,GAAGF,aAAa,CAACG,aAAa,EAAE;GAChD,MAAM3K,MAAM,GAAG,CACd,6BAAG0K,UAAU,2CAAVA,UAAU,CAAEE,OAAO,qBAAnB,oBAAqBC,MAAM,oCAAI,EAAE,GACpC,6BAAGH,UAAU,8CAAVA,UAAU,CAAEI,cAAc,qBAA1B,uBAA4BD,MAAM,oCAAI,EAAE,EAC3C;GACD,MAAM3M,KAAK,GAAG8B,MAAM,CAAC+K,IAAI,CAAE7M,KAAK,IAAKA,KAAK,CAACkC,IAAI,6CAAK,IAAI,iBAAO,CAAC;GAChE,MAAM4K,OAAO,GAAG9M,KAAK,GAAGA,KAAK,CAAC8M,OAAO,GAAGT,cAAc;GACtDD,YAAY,CAAC5B,WAAW,GAAGsC,OAAO;CACnC;CAAC,sCAgCD;GACC,MAAM1K,aAAa,GAAG,IAAI,CAAC9E,KAAK,CAAC8E,aAAa;GAC9C,MAAMC,MAAM,GAAGD,aAAa,CAACE,eAAe,CAAC,IAAI,CAAChF,KAAK,CAACiF,aAAa,EAAE,CAAC;GAExE,MAAM;KAAEE;IAAU,GAAGJ,MAAM;GAE3B,OAAO,4CAAI,sBAAQF,QAAQ,CAAC,eAAe,EAAE,MAAM;KAClD,MAAM4K,QAAQ,GAAG,IAAIpB,iCAAQ,CAAC;OAC7BqB,QAAQ,EAAE,KAAK;OACfvJ,iBAAiB,EAAE;SAClBC,WAAW,EAAE,CAAC;SACdC,cAAc,EAAE,CAAC;SACjBC,iBAAiB,EAAE,CAAC;SACpBnB;QACA;OACDA,QAAQ;OACRV,MAAM,EAAE;SACP,aAAa,EAAE,CACd,SAAS,EACT,gBAAgB,CAChB;SACD,SAAS,EAAE,CACV,MAAM,EACN,QAAQ,EACR,MAAM,EACN,cAAc,EACd,MAAM,EACN,UAAU,EACV,aAAa,EACb,SAAS,EACT,KAAK,EACL,QAAQ,EACR,SAAS,CACT;SACD,SAAS,EAAE,CACV,CAAC;WAAEsB,iBAAiB,EAAEC;UAAW,KAAK,4CAAI,4DAA8BrB,GAAG,CAACqB,SAAS,CAAC;QAEvF;OACDE,aAAa,EAAE;SACdzB,MAAM,EAAE,4CAAI,kEAA8Bb,IAAI,CAAC,IAAI;;MAEpD,CAAC;KAEF6L,QAAQ,CAAC9I,SAAS,CAAC,uBAAuB,EAAE,4CAAI,kFAAwC/C,IAAI,CAAC,IAAI,CAAC,CAAC;KAEnG,OAAO6L,QAAQ;IACf,CAAC;CACH;CAAC,mDAGD;GACCZ,UAAU,CAAC,MAAM;;KAEhB,IAAIjE,cAAI,CAAC8D,cAAc,yCAAC,IAAI,kBAAQ,EACpC;OACC;;KAGD,4CAAI,oDAAyB,EAAE;IAC/B,CAAC;CACH;CAAC,kCAEuBF,aAA4B,EACpD;GACC,MAAMmB,sBAA4C,GAAG;KAAEC,kBAAkB,EAAEpB;IAAe;GAC1F,MAAMqB,kBAAoC,GAAG,IAAIC,0BAAS,CAAC;KAAE7P,IAAI,EAAE0P;IAAwB,CAAC;GAC5F,IAAI,CAAC7N,IAAI,CAAC,eAAe,EAAE+N,kBAAkB,CAAC;CAC/C;CAAC,uCAQD;GACC,OAAO,IAAItL,GAAG,CAAC,CACd,SAAS,EACT,aAAa,CACb,CAAC;CACH;CAAC,gDAGD;GACC,OAAO,IAAIA,GAAG,CAAC,CACd,MAAM,EACN,UAAU,EACV,SAAS,EACT,OAAO,CACP,CAAC;CACH;CAAC,yCAE4BC,MAA+B,EAC5D;GACC,OAAOA,MAAM,CAACC,MAAM,CAClBC,eAAe,IAAK,CAAC,4CAAI,8EAAqCC,GAAG,CAACD,eAAe,CAACE,IAAI,CAAC,CACxF;CACF;;;;;;AChPD,CAIoD;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEpD,CAAe,MAAMmL,WAAW,SAASlQ,KAAK,CAC9C;GAAA;KAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAGU,IAAIoE,eAAK,CAACC,WAAW;;;;CAG/B;CACA;CACA;GACC1D,OAAO,CAACP,IAAS,EACjB;KAAA;KACC,IAAI,CAACA,IAAI,GAAGA,IAAI,GAAGA,IAAI,GAAG,EAAE;KAC5B,4CAAI,4CAAU,IAAI,CAACA,IAAI,CAACyC,KAAK,+BAAI,EAAE;;;;CAIrC;CACA;GACCjB,QAAQ,GACR;KACC,4CAAI;;;;CAIN;CACA;;;CA+BA;CACA;CACA;GACCV,eAAe,GACf;KACC,IAAI6J,cAAI,CAACwD,WAAW,CAACC,iCAAQ,CAAC,EAC9B;OACC,OAAO,IAAI;;KAGZ,4CAAI,sCAAiBnN,aAAG,CAACC,MAAM,oBAAC;;uBAEb,CAAiC;;;GAGpD,GAHqB,4CAAI,sCAAgByC,IAAI,CAAC,IAAI,CAAC,CAGlD;KAED,4CAAI;KAEJ,+CAAO,IAAI;;;;CAIb;CACA;;;CA6BA;CACA;CACA;GACC3C,cAAc,GACd;KACC,4CAAI;KAEJ,MAAM;OAAEL,KAAK;OAAEC;MAAQ,GAAG,IAAI,CAACb,KAAK,CAAC+K,WAAW,EAAE;KAElD,IAAI,IAAI,CAAC9K,IAAI,CAAC+K,GAAG,EACjB;OACC,OAAO9J,aAAG,CAACC,MAAM,sBAAC;yBACE,CAAa,eAAY,CAAc,uBAAoB,CAAgB;;IAE/F,GAFsBP,KAAK,GAAG,EAAE,EAAeC,MAAM,GAAG,EAAE,EAAuB,IAAI,CAACZ,IAAI,CAAC+K,GAAG;;KAI/F,MAAMsD,SAAS,GAAG,CAAC,IAAI,CAACrO,IAAI,CAACS,IAAI,GAAG,4CAA4C,GAAG,EAAE;KAErF,OAAOQ,aAAG,CAACC,MAAM,sBAAC;kBACJ,CAAY;OACvB,CAAmG;;IAErG,GAHemN,SAAS,EACpBlN,cAAU,CAACC,MAAM,CAAC,IAAI,CAACpB,IAAI,CAACS,IAAI,IAAImD,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC,CAAC;;GAqFtG/B,SAAS,GACT;KACC,OAAO;OAAE,GAAG,KAAK,CAACA,SAAS,EAAE;OAAE,GAAGgO,WAAW,CAAC7N;MAA+B;;CAkC/E;CAAC,6BA/NA;GACC,4CAAI,8DACFoC,IAAI,EAAE,CACNiK,IAAI,CAAEC,aAA4B,IAAW;KAC7C,MAAMC,kBAAkB,GAAG,CAAC,GAAGD,aAAa,CAAC;KAC7C,IAAIA,aAAa,CAAC1F,MAAM,KAAK,CAAC,IAAI8B,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EAClE;OACCD,kBAAkB,CAACE,IAAI,yCAAC,IAAI,sBAAQ;;KAErC,4CAAI,wDAAyBF,kBAAkB;KAE/C,IAAID,aAAa,CAAC1F,MAAM,KAAK,CAAC,EAC9B;OACC;;KAGDrF,aAAG,CAACmL,WAAW,CAAC,IAAI,CAAC5O,KAAK,CAACyC,SAAS,EAAE,EAAE,WAAW,CAAC;KACpD,4CAAI,wBAAU+L,aAAa,CAAC,CAAC,CAAC;KAC9B,IAAI,CAAChO,OAAO,CAAC;OACZkC,KAAK,0CAAE,IAAI;MACX,CAAC;KAEFmM,UAAU,CAAC,MAAM;OAChB,IAAI,CAAC7O,KAAK,CAAC2F,MAAM,EAAE;MACnB,EAAE,CAAC,CAAC;IACL,CAAC;CACJ;CAAC,oCA6BD;GAAA;GACC,IAAI,yCAAC,IAAI,mCAAc,EACvB;KACC;;GAGD,MAAMmJ,YAAY,GAAG,4CAAI,oCAAezL,aAAa,CAAC,QAAQ,CAAC;GAC/D,MAAM0L,cAAc,GAAGlL,aAAG,CAACC,UAAU,CAAC,0CAA0C,CAAC;GACjF,IAAI,yCAAC,IAAI,qBAAO,EAChB;KACCgL,YAAY,CAAC5B,WAAW,GAAG6B,cAAc;KAEzC;;GAGD,MAAMC,aAAa,2CAAG,IAAI,6DAA4B;GACtD,MAAME,UAAU,GAAGF,aAAa,CAACG,aAAa,EAAE;GAChD,MAAM3K,MAAM,GAAG,CACd,6BAAG0K,UAAU,2CAAVA,UAAU,CAAEc,OAAO,qBAAnB,oBAAqBX,MAAM,oCAAI,EAAE,GACpC,6BAAGH,UAAU,8CAAVA,UAAU,CAAEI,cAAc,qBAA1B,uBAA4BD,MAAM,oCAAI,EAAE,EAC3C;GACD,MAAM3M,KAAK,GAAG8B,MAAM,CAAC+K,IAAI,CAAE7M,KAAK,IAAKA,KAAK,CAACkC,IAAI,6CAAK,IAAI,qBAAO,CAAC;GAChE,MAAM4K,OAAO,GAAG9M,KAAK,GAAGA,KAAK,CAAC8M,OAAO,GAAGT,cAAc;GACtDD,YAAY,CAAC5B,WAAW,GAAGsC,OAAO;CACnC;CAAC,wCA6BD;GACC,MAAM1K,aAAa,GAAG,IAAI,CAAC9E,KAAK,CAAC8E,aAAa;GAC9C,MAAMC,MAAM,GAAGD,aAAa,CAACE,eAAe,CAAC,IAAI,CAAChF,KAAK,CAACiF,aAAa,EAAE,CAAC;GACxE,MAAM;KAAEE;IAAU,GAAGJ,MAAM;GAE3B,OAAO,4CAAI,sBAAQF,QAAQ,CAAC,eAAe,EAAE,MAAM;KAClD,MAAM4K,QAAQ,GAAG,IAAIpB,iCAAQ,CAAC;OAC7BqB,QAAQ,EAAE,KAAK;OACfvJ,iBAAiB,EAAE;SAClBC,WAAW,EAAE,CAAC;SACdC,cAAc,EAAE,CAAC;SACjBC,iBAAiB,EAAE,CAAC;SACpBnB;QACA;OACDA,QAAQ;OACRV,MAAM,EAAE;SACP,aAAa,EAAE,CACd,SAAS,EACT,gBAAgB,CAChB;SACD,SAAS,EAAE,CACV,MAAM,EACN,QAAQ,EACR,MAAM,EACN,cAAc,EACd,MAAM,EACN,UAAU,EACV,aAAa,EACb,SAAS,EACT,KAAK,EACL,QAAQ,EACR,SAAS,CACT;SACD,SAAS,EAAE,yCACV,IAAI,uDACJ,CAAC;WAAEsB,iBAAiB,EAAEC;UAAW,KAAK,4CAAI,gEAA8BrB,GAAG,CAACqB,SAAS,CAAC;QAEvF;OACDE,aAAa,EAAE;SACdzB,MAAM,EAAE,4CAAI,kEAA8Bb,IAAI,CAAC,IAAI;;MAEpD,CAAC;KACF6L,QAAQ,CAAC9I,SAAS,CAAC,uBAAuB,EAAE,4CAAI,sFAAwC/C,IAAI,CAAC,IAAI,CAAC,CAAC;KAEnG,OAAO6L,QAAQ;IACf,CAAC;CACH;CAAC,qDAGD;GACCZ,UAAU,CAAC,MAAM;;KAEhB,IAAIjE,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EACpC;OACC;;KAGD,4CAAI,wDAAyB,EAAE;IAC/B,CAAC;CACH;CAAC,oCAGD;GACC,MAAMuB,SAAS,2CAAG,IAAI,yDAA0B;GAEhD,OAAQvN,KAAK,IAAK;KACjB,OAAOuN,SAAS,CAAChK,QAAQ,CAACvD,KAAK,CAACkC,IAAI,CAAC;IACrC;CACF;CAAC,sCAGD;GACC,OAAO,CACN,cAAc,EACd,qBAAqB,EACrB,wBAAwB,CACxB;CACF;CAAC,oCAOuB4J,aAA4B,EACpD;GACC,MAAMmB,sBAA4C,GAAG;KAAEC,kBAAkB,EAAEpB;IAAe;GAC1F,MAAMqB,kBAAoC,GAAG,IAAIC,0BAAS,CAAC;KAAE7P,IAAI,EAAE0P;IAAwB,CAAC;GAC5F,IAAI,CAAC7N,IAAI,CAAC,eAAe,EAAE+N,kBAAkB,CAAC;CAC/C;CAAC,yCAGD;GACC,OAAO,IAAItL,GAAG,CAAC,CACd,SAAS,EACT,aAAa,CACb,CAAC;CACH;CAAC,gDAGD;GACC,OAAO,IAAIA,GAAG,CAAC,CACd,MAAM,EACN,UAAU,EACV,SAAS,EACT,OAAO,CACP,CAAC;CACH;CAAC,yCAE4BC,MAA+B,EAC5D;GACC,OAAOA,MAAM,CAACC,MAAM,CAClBC,eAAe,IAAK,CAAC,4CAAI,8EAAqCC,GAAG,CAACD,eAAe,CAACE,IAAI,CAAC,CACxF;CACF;;;;;AChQD,CAG4B;CAAA;CAAA;CAAA;AAE5B,CAAe,MAAMsL,UAAU,SAASrQ,KAAK,CAC7C;GAAA;KAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;;;CAEA;CACA;CACA;GACCS,WAAW,GACX;KACC,OAAO,IAAI;;;;CAIb;CACA;CACA;GACCK,gBAAgB,GAChB;KACC,OAAO;OACNC,KAAK,EAAE,GAAG;OACVC,MAAM,EAAE;MACR;;;;CAIH;CACA;CACA;;;CAkEA;CACA;CACA;GACCE,eAAe,GACf;KACC,OAAOG,aAAG,CAACC,MAAM,oBAAC;;uBAEC,CAAiC,wCAAqC,CAAuB;OAC7G,CAA8D;;;GAGjE,GAJqB,4CAAI,sCAAgByC,IAAI,CAAC,IAAI,CAAC,EAAwC,IAAI,CAAC5D,KAAK,CAACmE,OAAO,EAAE,EAC1GN,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;;;;CAOlE;CACA;CACA;GACC7C,cAAc,GACd;KACC,MAAMP,IAAI,GAAG,IAAI,CAACT,IAAI,CAACS,IAAI,IAAImD,aAAG,CAACC,UAAU,CAAC,4CAA4C,CAAC;KAC3F,MAAMqM,OAAO,GAAG,IAAI,CAAClQ,IAAI,CAACS,IAAI,GAAG,EAAE,GAAG,qDAAqD;KAE3F,OAAOQ,aAAG,CAACC,MAAM,sBAAC;SACb,CAAU;MACb,CAAgE;;GAElE,GAHOgP,OAAO,EACV/O,cAAU,CAACC,MAAM,CAACX,IAAI,CAAC,CAACY,QAAQ,EAAE,CAACC,UAAU,CAAC,MAAM,EAAE,MAAM,CAAC;;GAKlEQ,SAAS,GACT;KACC,OAAO;OAAE,GAAG,KAAK,CAACA,SAAS,EAAE;OAAE,GAAGmO,UAAU,CAAChO;MAA+B;;CA2B9E;CAAC,2BA5HekC,KAAmB,EAClC;GACC,MAAMU,aAAa,GAAG,IAAI,CAAC9E,KAAK,CAAC8E,aAAa;GAC9C,MAAMC,MAAM,GAAGD,aAAa,CAACE,eAAe,CAAC,IAAI,CAAChF,KAAK,CAACiF,aAAa,EAAE,CAAC;GAExEb,KAAK,CAACC,eAAe,EAAE;GAEvB,IAAI,CAACU,MAAM,EACX;KACC;;GAGD,MAAM;KAAEM,GAAG;KAAEH,YAAY;KAAEC;IAAU,GAAGJ,MAAM;GAC7C,IAAIQ,2CAAc,CAAC;KACnBL,YAAY;KACZE,QAAQ,EAAEC,GAAG;KACbG,WAAW,EAAEV,aAAa,CAACW,cAAc,EAAE;KAC3CvF,MAAM,EAAE;OACPwF,OAAO,EAAE,MAAM;SACd,IAAI,CAAC1F,KAAK,CAAC2F,MAAM,EAAE;;MAEpB;KACDE,sBAAsB,EAAE;OACvBC,kBAAkB,EAAE;SACnBrB,MAAM,EAAE;WACP,aAAa,EAAE,CACd,SAAS,CACT;WACD,SAAS,EAAE,CACV,MAAM,EACN,QAAQ,EACR,MAAM,EACN,cAAc,EACd,MAAM,EACN,UAAU,EACV,aAAa,EACb,SAAS,EACT,KAAK,EACL,QAAQ,EACR,SAAS,CACT;WACD,SAAS,EAAE,CACV,CAAC;aAAEsB,iBAAiB,EAAEC;YAAW,KAAK,4CAAI,gEAA8BrB,GAAG,CAACqB,SAAS,CAAC;UAEvF;SACDE,aAAa,EAAE;WACdzB,MAAM,EAAE,4CAAI,kEAA8Bb,IAAI,CAAC,IAAI;UACnD;SACDuB,QAAQ;SACRgB,iBAAiB,EAAE;WAClBC,WAAW,EAAE,CAAC;WACdC,cAAc,EAAE,CAAC;WACjBC,iBAAiB,EAAE,CAAC;WACpBnB;;;MAGF;KACDoB,YAAY,EAAE;OAAEC,OAAO,EAAE,IAAI;OAAEC,SAAS,EAAE;;IAC1C,CAAC,CACAC,WAAW,CAAC,2CAA2C,CAAC,CACxDpC,IAAI,EAAE;CAET;CAAC,yCAuCD;GACC,OAAO,IAAIC,GAAG,CAAC,CACd,SAAS,EACT,aAAa,CACb,CAAC;CACH;CAAC,gDAGD;GACC,OAAO,IAAIA,GAAG,CAAC,CACd,MAAM,EACN,UAAU,EACV,SAAS,EACT,OAAO,CACP,CAAC;CACH;CAAC,yCAE4BC,MAA+B,EAC5D;GACC,OAAOA,MAAM,CAACC,MAAM,CAClBC,eAAe,IAAK,CAAC,4CAAI,8EAAqCC,GAAG,CAACD,eAAe,CAACE,IAAI,CAAC,CACxF;CACF;;;;;AC3JD,CAGe,MAAMwL,KAAK,SAASvQ,KAAK,CACxC;;CAEA;CACA;CACA;GACCU,cAAc,GACd;KACC,OAAO,KAAK;;;;CAId;CACA;CACA;GACCI,gBAAgB,GAChB;KACC,OAAO;OACNC,KAAK,EAAE,GAAG;OACVC,MAAM,EAAE;MACR;;;;CAIH;CACA;CACA;GACCsK,mBAAmB,GACnB;KACC,OAAOtH,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;;;;CAIhE;CACA;CACA;GACC7C,cAAc,GACd;KACC,MAAM;OAACL,KAAK;OAAEC;MAAO,GAAG,IAAI,CAACb,KAAK,CAAC+K,WAAW,EAAE;KAEhD,IAAI,IAAI,CAAC9K,IAAI,CAACiL,MAAM,EACpB;OACC,OAAOhK,aAAG,CAACC,MAAM,oBAAC;mFAC4D,CAAM;IACpF,GADgF6J,GAAG;MAEnF,MAED;OACC,OAAO9J,aAAG,CAACC,MAAM,sBAAC;;;;IAIlB;;;CAGH;;;;;AC1DA,CAE4B;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE5B,CAAe,MAAMkP,IAAI,SAASD,KAAK,CACvC;GAAA;KAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OACU,IAAInM,eAAK,CAACC,WAAW;;KAAE;OAAA;OAAA,OACC;;KAAS;OAAA;OAAA,OACN,CAAC,MAAM,0CAAE,IAAI,uDAAyB,SAAS;;KAAC;OAAA;OAAA,OAC3C;;;;CAG1C;CACA;CACA;GACCiH,mBAAmB,GACnB;KACC,OAAOtH,aAAG,CAACC,UAAU,CAAC,sCAAsC,CAAC;;;;CAI/D;CACA;CACA;GACCnD,gBAAgB,GAChB;KACC,OAAO;OACNC,KAAK,EAAE,GAAG;OACVC,MAAM,EAAE;MACR;;GAGFG,eAAe,GACf;KACC,MAAM;OAAE8I,MAAM,EAAEyB;MAAwB,2CAAG,IAAI,mDAAuB;KAEtE,OAAOrK,aAAG,CAACC,MAAM,oBAAC;;KAEjB,CAAyB;;;GAG1B,GAHGoK,sBAAsB;;;;CAO3B;CACA;CACA;GACCtK,cAAc,GACd;KACC,OAAOC,aAAG,CAACC,MAAM,sBAAC;;MAEhB,CAAgD;;GAElD,GAFIC,cAAU,CAACC,MAAM,CAAC,IAAI,CAAC8J,mBAAmB,EAAE,CAAC;;GAKlDpJ,SAAS,GACT;KACC,OAAO;OAAEqJ,kBAAkB,EAAE,mBAAmB;OAAEnJ,KAAK,0CAAE,IAAI;MAAuB;;GAGrFqO,WAAW,CAACrO,KAAa,EACzB;KACC,KAAK,CAACqO,WAAW,CAACrO,KAAK,CAAC;KACxB,MAAM;OAAE6H,MAAM;OAAEY;MAAa,2CAAG,IAAI,mDAAuB;KAC3D,4CAAI,0DAA2BzI,KAAK;KAEpCiF,EAAE,CAACkD,2BAA2B,CAACN,MAAM,EAAE7H,KAAK,CAAC;KAC7CyI,WAAW,CAACY,gBAAgB,CAACrJ,KAAK,CAAC;;GAGpCD,gBAAgB,CAACC,KAAa,EAAEoJ,SAAkB,GAAG,IAAI,EACzD;KACC,KAAK,CAACrJ,gBAAgB,CAACC,KAAK,CAAC;KAC7B,4CAAI,0DAA2BA,KAAK;KAEpC,MAAM;OAAE6H,MAAM;OAAEY;MAAa,2CAAG,IAAI,mDAAuB;KAC3DxD,EAAE,CAACkD,2BAA2B,CAACN,MAAM,EAAE7H,KAAK,CAAC;KAC7CyI,WAAW,CAACY,gBAAgB,CAACrJ,KAAK,CAAC;KAEnC,IAAIoJ,SAAS,EACb;OACC,IAAI,CAACvJ,IAAI,CAAC,IAAI,CAAC5B,MAAM,CAACE,kBAAkB,CAAC;;;GAuB3CsB,MAAM,GACN;KACC,KAAK,CAACA,MAAM,EAAE;KACd,4CAAI;;GAGLC,QAAQ,GACR;KACC,KAAK,CAACA,QAAQ,EAAE;KAChB,4CAAI;;GAGLC,UAAU,GACV;KACC,KAAK,CAACA,UAAU,EAAE;KAClB,4CAAI;;CAQN;CAAC,mCAzCA;GACC,OAAO,4CAAI,sBAAQiD,QAAQ,CAAC,kBAAkB,EAAE;KAAA;KAAA,OAAMqC,EAAE,CAAC8C,mBAAmB,kEAC3E,IAAI,mIAA4B,IAAI,uDACnC/H,KAAK,IAAK,IAAI,CAACD,gBAAgB,CAACC,KAAK,CAAC,EACvC;OACCwJ,MAAM,EAAE,yCAAC,IAAI,4DAA2B;OACxCC,gBAAgB,EAAE,KAAK;OACvBC,aAAa,oEAAE,IAAI,oIAA4B,IAAI,qDAAuB;OAC1EC,YAAY,EAAE;MACd,CACD;KAAC;CACH;CAAC,iCAGD;GAAA;GACC,yEAAO,IAAI,oIAA4B,IAAI;CAC5C;CAAC,qCAqBD;GACC,MAAM;KAAElB;IAAa,2CAAG,IAAI,mDAAuB;GACnDA,WAAW,CAACc,KAAK,EAAE;CACpB;;;;AChID,CAE4B;CAAA;CAAA;AAE5B,CAAe,MAAMjE,IAAI,SAAS1H,KAAK,CACvC;GAGCE,WAAW,CAACC,KAAY,EACxB;KACC,KAAK,CAACA,KAAK,CAAC;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KACb,IAAI,CAACK,iBAAiB,CAAC,wBAAwB,CAAC;;;;CAIlD;CACA;GACCgC,aAAa,GACb;KACC,4CAAI,kCAAgBkO,eAAe,GAAG,IAAI;KAC1C,4CAAI,kCAAgBC,KAAK,EAAE;;;;CAI7B;CACA;;GAOCC,OAAO,GACP;KACC,OAAO,IAAI,CAACxQ,IAAI,CAACS,IAAI;;GAGtBgQ,YAAY,GACZ;KACC,+CAAO,IAAI;;;;CAIb;CACA;CACA;GACCzP,cAAc,GACd;KACC,MAAMqG,OAAO,GAAG,IAAI,CAACrH,IAAI,CAACS,IAAI,KAAKmD,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC,GACnF,EAAE,GACF,IAAI,CAAC7D,IAAI,CAACS,IAAI;KAGjB,4CAAI,oCAAkBQ,aAAG,CAACC,MAAM,oBAAC;wDACmB,CAAsD;MACxG,CAAwD;;GAE1D,GAHsD0C,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC,EACrG1C,cAAU,CAACC,MAAM,CAACiG,OAAO,CAAC,CAAC/F,UAAU,CAAC,MAAM,EAAE,MAAM,CAAC,CAExD;KAEDiJ,eAAK,CAAC5G,IAAI,yCAAC,IAAI,mCAAiB,OAAO,EAAE,4CAAI,sBAAUA,IAAI,CAAC,IAAI,CAAC,CAAC;KAClE4G,eAAK,CAAC5G,IAAI,yCAAC,IAAI,mCAAiB,OAAO,EAAEQ,KAAK,IAAIyK,UAAU,CAAC,4CAAI,sBAAUjL,IAAI,CAAC,IAAI,EAAEQ,KAAK,CAAC,CAAC,CAAC;KAE9F,+CAAO,IAAI;;GAuBZrC,SAAS,GACT;KACC,OAAO;OAAE,GAAG,KAAK,CAACA,SAAS,EAAE;OAAE,GAAGwF,IAAI,CAACrF;MAA+B;;CAExE;CAAC,mBA/DSkC,KAAK,EACd;GACC,IAAI,CAAC3D,OAAO,CAAC,4CAAI,kCAAgBkQ,SAAS,CAACpP,UAAU,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;GACpE,IAAI,CAACpB,QAAQ,EAAE;CAChB;CAAC,mBAmCQiE,KAAqB,EAC9B;GACC,4CAAI,kCAAgBgF,SAAS,GAAG,4CAAI,kCAAgBuH,SAAS,CAACpP,UAAU,CAAC,IAAI,EAAE,MAAM,CAAC;GAEtF,MAAMqP,KAAK,GAAGxN,QAAQ,CAACyN,WAAW,EAAE;GACpCD,KAAK,CAACE,kBAAkB,yCAAC,IAAI,kCAAgB;GAC7CF,KAAK,CAACG,QAAQ,CAAC,KAAK,CAAC;GAErB,MAAMC,SAAS,GAAG5N,QAAQ,CAAC6N,YAAY,EAAE;GACzCD,SAAS,CAACE,eAAe,EAAE;GAC3BF,SAAS,CAACG,QAAQ,CAACP,KAAK,CAAC;GAEzB,IAAI,CAACnQ,OAAO,CACX,4CAAI,kCACF2I,SAAS,CACT7H,UAAU,CAAC,MAAM,EAAE,MAAM,CAAC,CAC5B;GACD,IAAI,CAACpB,QAAQ,EAAE;CAChB;;;;;;ACnFD,CAI6B;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE7B,CAAe,MAAMiR,YAAY,SAASvR,KAAK,CAC/C;GAAA;KAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OACU,IAAIoE,eAAK,CAACC,WAAW;;KAAE;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;;;CAQjC;CACA;CACA;GACC1D,OAAO,CAACP,IAAS,EACjB;KAAA;KACC,IAAI,CAACA,IAAI,GAAGA,IAAI,GAAGA,IAAI,GAAG,EAAE;KAC5B,4CAAI,4CAAU,IAAI,CAACA,IAAI,CAACyC,KAAK,+BAAI,EAAE;;;;CAIrC;CACA;CACA;GACCzB,cAAc,GACd;KAAA;KACC,4CAAI;KACJ,IAAI2J,cAAI,CAAC8D,cAAc,eAAC,IAAI,CAACzO,IAAI,qBAAT,WAAWS,IAAI,CAAC,EACxC;OACC,4CAAI,wBAAYQ,aAAG,CAACC,MAAM,oBAAC;;OAEzB,CAAqD;;IAEvD,GAFIC,cAAU,CAACC,MAAM,CAAC,IAAI,CAACpB,IAAI,CAACS,IAAI,IAAI,EAAE,CAAC,CAACY,QAAQ,EAAE,CAErD;MACD,MAED;OACC,4CAAI,wBAAYJ,aAAG,CAACC,MAAM,sBAAC;;OAEzB,CAAoD;;IAEtD,GAFI0C,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC,CAEpD;;KAGF,IAAI8G,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EACpC;OACC,4CAAI,gEACFH,IAAI,CAAC,CAAC;SAAE8C,eAAe;SAAEC;QAAc,KAAK;SAAA;SAC5C,4CAAI,oDAAuBA,YAAY;SACvC,IAAI,CAAC1G,cAAI,CAAC8D,cAAc,gBAAC,IAAI,CAACzO,IAAI,qBAAT,YAAWS,IAAI,CAAC,EACzC;WACC,4CAAI,oCACHkK,cAAI,CAAC8D,cAAc,CAAC2C,eAAe,CAAC,IAAIzG,cAAI,CAAC8D,cAAc,CAAC4C,YAAY,CAAC,GACtEzN,aAAG,CAACC,UAAU,CAAC,0DAA0D,EAAE;aAC5E,YAAY,EAAEuN,eAAe;aAC7B,SAAS,EAAEC;YACX,CAAC,GACAzN,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;WAErD,MAAMyN,WAAW,GAAG,IAAI,CAACvR,KAAK,CAACyC,SAAS,EAAE;WAC1C,MAAM+O,UAAU,GAAGD,WAAW,CAAClO,aAAa,CAAC,iBAAiB,CAAC;WAC/D,IAAI,CAACrD,KAAK,CAACyR,UAAU,CAAC;aAAE5J,OAAO,EAAE2J,UAAU;aAAEE,IAAI,EAAE;YAAK,CAAC;;QAE1D,CAAC,CACDC,KAAK,CAAEC,GAAG,IAAK;SACfC,OAAO,CAAC7K,KAAK,CAAC4K,GAAG,CAAC;QAClB,CAAC;;KAIJ,+CAAO,IAAI;;;;CAIb;CACA;GACCnQ,QAAQ,GACR;KACC,4CAAI;;;CA8CN;CACA;CACA;GACCV,eAAe,GACf;KACC,4CAAI,sCAAiBG,aAAG,CAACC,MAAM,sBAAC;;uBAEb,CAAiC,wCAAqC,CAAuB;;;GAGhH,GAHqB,4CAAI,sCAAgByC,IAAI,CAAC,IAAI,CAAC,EAAwC,IAAI,CAAC5D,KAAK,CAACmE,OAAO,EAAE,CAG9G;KAED,4CAAI;KAEJ,+CAAO,IAAI;;;;CAIb;CACA;;GAiHCpC,SAAS,GACT;KACC,OAAO;OAAE,GAAG,KAAK,CAACA,SAAS,EAAE;OAAE,GAAGqP,YAAY,CAAClP;MAA+B;;CAwChF;CAAC,0BAzNgBS,KAAc,EAC9B;GACC,MAAMjC,IAAI,GACTkK,cAAI,CAAC8D,cAAc,CAAC/L,KAAK,CAAC,GACvBA,KAAK,GACLkB,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;GAE/D,4CAAI,sBAAUoJ,WAAW,GAAGxM,IAAI;GAChC,4CAAI,sBAAUiM,KAAK,GAAGjM,IAAI;CAC3B;CAAC,yCAGD;GACC,IAAI,CAACkK,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EACrC;KACC,OAAOoD,OAAO,CAACC,OAAO,CAAC;OACtBV,eAAe,EAAE,EAAE;OACnBC,YAAY,EAAEzN,aAAG,CAACC,UAAU,CAAC,2CAA2C;MACxE,CAAC;;GAGH,MAAMiL,cAAc,GAAGlL,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;GAClF,IAAI,wCAAAsN,YAAY,8CAAwB,IAAI,EAC5C;KACC,wCAAAA,YAAY,4CAAsBY,uCAAa,CAACC,aAAa,CAAC,EAAE,CAAC;;GAGlE,OAAO,wCAAAb,YAAY,0CACjB7C,IAAI,CAAE2D,SAAS,IAAK;KAAA;KACpB,MAAM1N,MAAM,GAAG,CACd,6BAAG0N,SAAS,0CAATA,SAAS,CAAEC,OAAO,qBAAlB,mBAAoB9C,MAAM,oCAAI,EAAE,EACnC;KACD,MAAM3M,KAAK,GAAG8B,MAAM,CAAC+K,IAAI,CAAE7M,KAAK,IAAKA,KAAK,CAACkC,IAAI,6CAAK,IAAI,qBAAO,CAAC;KAEhE,OAAO;OACNyM,eAAe,EAAExN,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;OAClEwN,YAAY,EAAE5O,KAAK,GAAGA,KAAK,CAAC8M,OAAO,GAAGT;MACtC;IACD,CAAC;CAEJ;CAAC,kCAuBqB5C,KAAc,EACpC;GACC,IAAI,yCAAC,IAAI,mCAAc,EACvB;KACC;;GAGD,MAAM2C,YAAY,GAAG,4CAAI,oCAAezL,aAAa,CAAC,QAAQ,CAAC;GAC/DyL,YAAY,CAAC5B,WAAW,GAAGtC,cAAI,CAAC8D,cAAc,CAACvC,KAAK,CAAC,GAClDA,KAAK,GACLtI,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;CAE/D;CAAC,mCAGD;GACC,MAAMgB,aAAa,GAAG,IAAI,CAAC9E,KAAK,CAAC8E,aAAa;GAE9C,OAAO,4CAAI,sBAAQD,QAAQ,CAAC,eAAe,EAAE,MAAM;KAClD,MAAM4K,QAAQ,GAAG,IAAIuC,uCAAa,CAAC;OAClCtC,QAAQ,EAAE,KAAK;OACfvJ,iBAAiB,EAAE;SAClBC,WAAW,EAAE,CAAC;SACdC,cAAc,EAAE,CAAC;SACjB+L,oBAAoB,EAAE;QACtB;OACDC,SAAS,EAAEvN,aAAa,CAACwN,YAAY,EAAE;OACvC7N,MAAM,EAAE;SACP,aAAa,EAAE,CACd,SAAS,CACT;SACD,SAAS,0CAAE,IAAI,mDAAyB;SACxC,SAAS,EAAE,CACV,CAAC;WAAEsB,iBAAiB,EAAEC;UAAW,KAAK,4CAAI,0DAA2BrB,GAAG,CAACqB,SAAS,CAAC;QAEpF;OACD2G,KAAK,EAAE9I,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;OAClEyO,gBAAgB,EAAE;SACjB,SAAS,EAAE1O,aAAG,CAACC,UAAU,CAAC,iCAAiC;QAC3D;OACDoC,aAAa,0CAAE,IAAI;MACnB,CAAC;KACFuJ,QAAQ,CAAC9I,SAAS,CAAC,uBAAuB,EAAGvC,KAAK,4CAAK,IAAI,gEAA+BA,KAAK,CAAC,CAAC;KAEjG,OAAOqL,QAAQ;IACf,CAAC;CACH;CAAC,sCAGD;GACC,OAAO,IAAIlL,GAAG,CAAC,CACd,SAAS,EACT,aAAa,CACb,CAAC;CACH;CAAC,6BAGD;GACC,MAAMyK,aAAa,2CAAG,IAAI,mDAAyB;GACnDA,aAAa,CACX1K,IAAI,EAAE,CACNiK,IAAI,CAAEC,aAA4B,IAAK;KACvC,wCAAA4C,YAAY,wCAAmBpC,aAAa,CAACG,aAAa,CAAC,KAAK,CAAC;KACjE,MAAMV,kBAAkB,GAAG,CAAC,GAAGD,aAAa,CAAC;KAC7C,IAAIA,aAAa,CAAC1F,MAAM,KAAK,CAAC,IAAI8B,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EAClE;OACCD,kBAAkB,CAACE,IAAI,yCAAC,IAAI,sBAAQ;;KAErC,4CAAI,wDAAyBF,kBAAkB;KAE/C,IAAID,aAAa,CAAC1F,MAAM,KAAK,CAAC,EAC9B;OACC;;KAGDrF,aAAG,CAACmL,WAAW,CAAC,IAAI,CAAC5O,KAAK,CAACyC,SAAS,EAAE,EAAE,WAAW,CAAC;KACpD,4CAAI,wBAAU+L,aAAa,CAAC,CAAC,CAAC;KAC9B,IAAI,CAAChO,OAAO,CAAC;OACZkC,KAAK,0CAAE,IAAI;MACX,CAAC;KACFmM,UAAU,CAAC,MAAM;OAChB,IAAI,CAAC7O,KAAK,CAAC2F,MAAM,EAAE;MACnB,EAAE,CAAC,CAAC;IACL,CAAC;CAEJ;CAAC,oCAEuB6I,aAA4B,EACpD;GACC,MAAMmB,sBAA4C,GAAG;KAAEC,kBAAkB,EAAEpB;IAAe;GAC1F,MAAMqB,kBAAoC,GAAG,IAAIC,0BAAS,CAAC;KAAE7P,IAAI,EAAE0P;IAAwB,CAAC;GAC5F,IAAI,CAAC7N,IAAI,CAAC,eAAe,EAAE+N,kBAAkB,CAAC;CAC/C;CAAC,wCAE6BzL,KAAK,EACnC;GACCyK,UAAU,CAAC,MAAM;;KAEhB,IAAIjE,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EACpC;OACC;;KAGD,4CAAI,wDAAyB,EAAE;IAC/B,CAAC;CACH;CAAC,4BAEwBlK,MAAM,EAC/B;GACC,wCAAA4M,YAAY,4CAAsBU,OAAO,CAACC,OAAO,CAACvN,MAAM,CAAC;CAC1D;CAAC,mCAQD;GACC,MAAMgO,KAAK,GAAG,CACb,MAAM,EACN,QAAQ,EACR,MAAM,EACN,cAAc,EACd,MAAM,EACN,UAAU,EACV,aAAa,EACb,KAAK,EACL,QAAQ,EACR,SAAS,EACT,OAAO,CACP;GAED,IAAI,CAAC,IAAI,CAACxS,KAAK,CAAC8E,aAAa,CAAC2N,cAAc,EAC5C;KACCD,KAAK,CAAC7D,IAAI,CAAC,SAAS,CAAC;;GAGtB,OAAO6D,KAAK;CACb;CAAC,sCAGD;GACC,IAAI,IAAI,CAACxS,KAAK,CAAC8E,aAAa,CAAC2N,cAAc,EAC3C;KACC,OAAO;OACNhO,MAAM,EAAGD,MAAM,IAAKA,MAAM,CAACC,MAAM,CAAE/B,KAAK,IAAKkI,cAAI,CAAC8H,QAAQ,CAAChQ,KAAK,CAAC,IAC7DkI,cAAI,CAAC8D,cAAc,CAAChM,KAAK,CAACkC,IAAI,CAAC,IAC/B,CAAC,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,aAAa,CAAC,CAACqB,QAAQ,CAACvD,KAAK,CAACkC,IAAI,CAAC;MAClE;;GAGF,OAAO,IAAI;CACZ;CAAC,sBAxSmBwM,YAAY;GAAA;CAAA;CAAA,sBAAZA,YAAY;GAAA;GAAA,OAOW;CAAI;;;;;;ACbhD,CAK6B;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE7B,CAAe,MAAMuB,cAAc,SAAS9S,KAAK,CACjD;GAAA;KAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OACU,IAAIoE,eAAK,CAACC,WAAW;;KAAE;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;;;CAQjC;CACA;CACA;GACC1D,OAAO,CAACP,IAAS,EACjB;KAAA;KACC,IAAI,CAACA,IAAI,GAAGA,IAAI,GAAGA,IAAI,GAAG,EAAE;KAC5B,4CAAI,4CAAU,IAAI,CAACA,IAAI,CAACyC,KAAK,+BAAI,EAAE;;;;CAIrC;CACA;CACA;GACCzB,cAAc,GACd;KAAA;KACC,4CAAI;KACJ,IAAI2J,cAAI,CAAC8D,cAAc,eAAC,IAAI,CAACzO,IAAI,qBAAT,WAAWS,IAAI,CAAC,EACxC;OACC,4CAAI,4BAAYQ,aAAG,CAACC,MAAM,oBAAC;;OAEzB,CAAqD;;IAEvD,GAFIC,cAAU,CAACC,MAAM,CAAC,IAAI,CAACpB,IAAI,CAACS,IAAI,IAAI,EAAE,CAAC,CAACY,QAAQ,EAAE,CAErD;MACD,MAED;OACC,4CAAI,4BAAYJ,aAAG,CAACC,MAAM,sBAAC;;OAEzB,CAAiE;;IAEnE,GAFI0C,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC,CAEjE;;KAGF,IAAI8G,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EACpC;OACC,4CAAI,oEACFH,IAAI,CAAC,CAAC;SAAE8C,eAAe;SAAEC;QAAc,KAAK;SAAA;SAC5C,4CAAI,oDAAuBA,YAAY;SAEvC,IAAI,CAAC1G,cAAI,CAAC8D,cAAc,gBAAC,IAAI,CAACzO,IAAI,qBAAT,YAAWS,IAAI,CAAC,EACzC;WACC,4CAAI,wCACHkK,cAAI,CAAC8D,cAAc,CAAC2C,eAAe,CAAC,IAAIzG,cAAI,CAAC8D,cAAc,CAAC4C,YAAY,CAAC,GACtEzN,aAAG,CAACC,UAAU,CAAC,0DAA0D,EAAE;aAC5E,YAAY,EAAEuN,eAAe;aAC7B,SAAS,EAAEC;YACX,CAAC,GACAzN,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC;WAElE,MAAMyN,WAAW,GAAG,IAAI,CAACvR,KAAK,CAACyC,SAAS,EAAE;WAC1C,MAAM+O,UAAU,GAAGD,WAAW,CAAClO,aAAa,CAAC,mBAAmB,CAAC;WACjE,IAAI,CAACrD,KAAK,CAACyR,UAAU,CAAC;aAAE5J,OAAO,EAAE2J,UAAU;aAAEE,IAAI,EAAE;YAAK,CAAC;;QAE1D,CAAC,CACDC,KAAK,CAAEC,GAAG,IAAK;SACfC,OAAO,CAAC7K,KAAK,CAAC4K,GAAG,CAAC;QAClB,CAAC;;KAIJ,+CAAO,IAAI;;;;CAMb;CACA;GACCnQ,QAAQ,GACR;KACC,4CAAI;;;;CAIN;CACA;CACA;GACCV,eAAe,GACf;KACC,4CAAI,sCAAiBG,aAAG,CAACC,MAAM,sBAAC;;uBAEb,CAAiC,wCAAqC,CAAuB;;;GAGhH,GAHqB,4CAAI,sCAAgByC,IAAI,CAAC,IAAI,CAAC,EAAwC,IAAI,CAAC5D,KAAK,CAACmE,OAAO,EAAE,CAG9G;KAED,4CAAI;KAEJ,+CAAO,IAAI;;;;CAIb;CACA;;GAyJCpC,SAAS,GACT;KACC,OAAO;OAAE,GAAG,KAAK,CAACA,SAAS,EAAE;OAAE,GAAG4Q,cAAc,CAACzQ;MAA+B;;CA8FlF;CAAC,kCAxPsBiK,KAAc,EACpC;GACC,IAAI,yCAAC,IAAI,mCAAc,EACvB;KACC;;GAGD,MAAM2C,YAAY,GAAG,4CAAI,oCAAezL,aAAa,CAAC,QAAQ,CAAC;GAC/DyL,YAAY,CAAC5B,WAAW,GAAGtC,cAAI,CAAC8D,cAAc,CAACvC,KAAK,CAAC,GAClDA,KAAK,GACLtI,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC;CAElE;CAAC,qCAGD;GACC,MAAMgB,aAAa,GAAG,IAAI,CAAC9E,KAAK,CAAC8E,aAAa;GAC9C,MAAMC,MAAM,GAAGD,aAAa,CAACE,eAAe,CAAC,IAAI,CAAChF,KAAK,CAACiF,aAAa,EAAE,CAAC;GAExE,MAAM;KAAEE;IAAU,GAAGJ,MAAM;GAE3B,OAAO,4CAAI,sBAAQF,QAAQ,CAAC,eAAe,EAAE,MAAM;KAClD,MAAM+N,UAAU,GAAG,CAClB,SAAS,EACT,SAAS,CACT;KACD,IAAI,IAAI,CAAC5S,KAAK,CAAC8E,aAAa,CAAC+N,uBAAuB,KAAKC,2BAAiB,CAACC,QAAQ,EACnF;OACCH,UAAU,CAACjE,IAAI,CAAC,eAAe,CAAC;;KAGjC,MAAMc,QAAQ,GAAG,IAAIuC,uCAAa,CAAC;OAClCtC,QAAQ,EAAE,KAAK;OACfvJ,iBAAiB,EAAE;SAClBC,WAAW,EAAE,CAAC;SACdC,cAAc,EAAE,CAAC;SACjB+L,oBAAoB,EAAE,CAAC;SACvBjN;QACA;OACDkN,SAAS,EAAEvN,aAAa,CAACwN,YAAY,EAAE;OACvCnN,QAAQ;OACRV,MAAM,EAAE;SACP,aAAa,EAAEmO,UAAU;SACzB,SAAS,EAAE,CACV,MAAM,EACN,QAAQ,EACR,MAAM,EACN,cAAc,EACd,MAAM,EACN,aAAa,EACb,SAAS,EACT,KAAK,EACL,QAAQ,EACR,SAAS,EACT,OAAO,CACP;SACD,SAAS,EAAE,yCACV,IAAI,2DACJ,CAAC;WAAE7M,iBAAiB,EAAEC;UAAW,KAAK,4CAAI,gEAA8BrB,GAAG,CAACqB,SAAS,CAAC;QAEvF;OACDuM,gBAAgB,EAAE;SACjB,SAAS,EAAE1O,aAAG,CAACC,UAAU,CAAC,uCAAuC;;MAElE,CAAC;KAEF2L,QAAQ,CAAC9I,SAAS,CAAC,uBAAuB,EAAGvC,KAAK,4CAAK,IAAI,oEAA+BA,KAAK,CAAC,CAAC;KAEjG,OAAOqL,QAAQ;IACf,CAAC;CACH;CAAC,sCAGD;GACC,OAAO,CACN,sBAAsB,EACtB,wBAAwB,EAExB,cAAc,EACd,qBAAqB,EACrB,wBAAwB,CACxB;CACF;CAAC,yCAGD;GACC,OAAO,IAAIlL,GAAG,CAAC,CACd,SAAS,EACT,aAAa,CACb,CAAC;CACH;CAAC,sCAGD;GACC,MAAM0L,SAAS,2CAAG,IAAI,yDAA0B;GAEhD,OAAQvN,KAAK,IAAK;KACjB,OAAOuN,SAAS,CAAChK,QAAQ,CAACvD,KAAK,CAACkC,IAAI,CAAC;IACrC;CACF;CAAC,6BAGD;GACC,MAAMoK,aAAa,2CAAG,IAAI,uDAAyB;GACnDA,aAAa,CACX1K,IAAI,EAAE,CACNiK,IAAI,CAAEC,aAA4B,IAAK;KACvC,wCAAAmE,cAAc,4CAAmB3D,aAAa,CAACG,aAAa,CAAC,KAAK,CAAC;KACnE,MAAMV,kBAAkB,GAAG,CAAC,GAAGD,aAAa,CAAC;KAC7C,IAAIA,aAAa,CAAC1F,MAAM,KAAK,CAAC,IAAI8B,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EAClE;OACCD,kBAAkB,CAACE,IAAI,yCAAC,IAAI,sBAAQ;;KAErC,4CAAI,wDAAyBF,kBAAkB;KAE/C,IAAID,aAAa,CAAC1F,MAAM,KAAK,CAAC,EAC9B;OACC;;KAGDrF,aAAG,CAACmL,WAAW,CAAC,IAAI,CAAC5O,KAAK,CAACyC,SAAS,EAAE,EAAE,WAAW,CAAC;KACpD,4CAAI,wBAAU+L,aAAa,CAAC,CAAC,CAAC;KAC9B,IAAI,CAAChO,OAAO,CAAC;OACZkC,KAAK,0CAAE,IAAI;MACX,CAAC;KACFmM,UAAU,CAAC,MAAM;OAChB,IAAI,CAAC7O,KAAK,CAAC2F,MAAM,EAAE;MACnB,EAAE,CAAC,CAAC;IACL,CAAC;CAEJ;CAAC,oCAEuB6I,aAA4B,EACpD;GACC,MAAMmB,sBAA4C,GAAG;KAAEC,kBAAkB,EAAEpB;IAAe;GAC1F,MAAMqB,kBAAoC,GAAG,IAAIC,0BAAS,CAAC;KAAE7P,IAAI,EAAE0P;IAAwB,CAAC;GAC5F,IAAI,CAAC7N,IAAI,CAAC,eAAe,EAAE+N,kBAAkB,CAAC;CAC/C;CAAC,0CAE6BzL,KAAK,EACnC;GACCyK,UAAU,CAAC,MAAM;;KAEhB,IAAIjE,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EACpC;OACC;;KAGD,4CAAI,wDAAyB,EAAE;IAC/B,CAAC;CACH;CAAC,2CAQD;GACC,IAAI,CAAC9D,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EACrC;KACC,OAAOoD,OAAO,CAACC,OAAO,CAAC;OACtBV,eAAe,EAAE,EAAE;OACnBC,YAAY,EAAEzN,aAAG,CAACC,UAAU,CAAC,8CAA8C;MAC3E,CAAC;;GAGH,MAAMiL,cAAc,GAAGlL,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC;GACrF,IAAI,wCAAA6O,cAAc,kDAAwB,IAAI,EAC9C;KACC,MAAM7N,aAAa,GAAG,IAAI,CAAC9E,KAAK,CAAC8E,aAAa;KAC9C,MAAMC,MAAM,GAAGD,aAAa,CAACE,eAAe,CAAC,IAAI,CAAChF,KAAK,CAACiF,aAAa,EAAE,CAAC;KAExE,MAAM;OAAEE;MAAU,GAAGJ,MAAM;KAE3B,wCAAA4N,cAAc,gDAAsBX,uCAAa,CAACC,aAAa,CAAC;OAC/D7L,WAAW,EAAE,CAAC;OACdC,cAAc,EAAE,CAAC;OACjB+L,oBAAoB,EAAE,CAAC;OACvBjN;MACA,CAAC;;GAGH,OAAO,wCAAAwN,cAAc,8CACnBpE,IAAI,CAAE2D,SAAS,IAAK;KAAA;KACpB,MAAMU,UAAU,GAAG;OAClBI,OAAO,EAAEd,SAAS,oBAATA,SAAS,CAAEC,OAAO;OAC3B/O,QAAQ,EAAE8O,SAAS,oBAATA,SAAS,CAAEe,aAAa;OAClCC,OAAO,EAAEhB,SAAS,oBAATA,SAAS,CAAElC;MACpB;KACDjI,MAAM,CAACoL,OAAO,CAACP,UAAU,CAAC,CACxBQ,OAAO,CAAC,CAAC,CAAClL,GAAG,EAAEmL,QAAQ,CAAC,KAAK;OAAA;OAC7B,IAAIA,QAAQ,KAAKC,SAAS,EAC1B;SACC;;OAGDD,QAAQ,CAAChE,MAAM,GAAG,qBAACgE,QAAQ,oBAARA,QAAQ,CAAEhE,MAAM,+BAAI,EAAE,EAAEpH,GAAG,CAAEvF,KAAK,IAAK;SACzD,OAAO;WACN,GAAGA,KAAK;WACR2Q,QAAQ,EAAEnL;UACV;QACD,CAAC;MACF,CAAC;KAEH,MAAM1D,MAAM,GAAG,CACd,6BAAG0N,SAAS,0CAATA,SAAS,CAAEC,OAAO,qBAAlB,mBAAoB9C,MAAM,oCAAI,EAAE,GACnC,6BAAG6C,SAAS,8CAATA,SAAS,CAAEe,aAAa,qBAAxB,uBAA0B5D,MAAM,oCAAI,EAAE,GACzC,6BAAG6C,SAAS,0CAATA,SAAS,CAAElC,OAAO,qBAAlB,mBAAoBX,MAAM,oCAAI,EAAE,EACnC;KAED,MAAM3M,KAAK,GAAG8B,MAAM,CAAC+K,IAAI,CAAE7M,KAAK,IAAKA,KAAK,CAACkC,IAAI,6CAAK,IAAI,qBAAO,CAAC;KAChE,IAAIyM,eAAe,GAAG,EAAE;KACxB,IAAIzG,cAAI,CAAC8H,QAAQ,CAAChQ,KAAK,CAAC,EACxB;OACC,IAAI,CAAAA,KAAK,oBAALA,KAAK,CAAE2Q,QAAQ,MAAK,SAAS,EACjC;SACChC,eAAe,GAAGxN,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;QACzE,MAED;SAAA;SACCuN,eAAe,sDAAGuB,UAAU,CAAClQ,KAAK,oBAALA,KAAK,CAAE2Q,QAAQ,CAAC,qBAA3B,uBAA6BE,OAAO,oCAAI,EAAE;;;KAG9D,OAAO;OACNlC,eAAe;OACfC,YAAY,EAAE5O,KAAK,GAAGA,KAAK,CAAC8M,OAAO,GAAGT;MACtC;IACD,CAAC;CAEJ;CAAC,4BAEepM,KAAc,EAC9B;GACC,MAAMjC,IAAI,GACTkK,cAAI,CAAC8D,cAAc,CAAC/L,KAAK,CAAC,GACvBA,KAAK,GACLkB,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC;GAGlE,4CAAI,0BAAUoJ,WAAW,GAAGxM,IAAI;GAChC,4CAAI,0BAAUiM,KAAK,GAAGjM,IAAI;CAC3B;CAAC,8BAEwB8D,MAAM,EAC/B;GACC,wCAAAmO,cAAc,gDAAsBb,OAAO,CAACC,OAAO,CAACvN,MAAM,CAAC;CAC5D;CAAC,sBA/VmBmO,cAAc;GAAA;CAAA;CAAA,sBAAdA,cAAc;GAAA;GAAA,OAOS;CAAI;;;;;;ACdhD,CAI6B;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE7B,CAAe,MAAMa,eAAe,SAAS3T,KAAK,CAClD;GAAA;KAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OACU,IAAIoE,eAAK,CAACC,WAAW;;KAAE;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;;;CAQjC;CACA;CACA;GACC1D,OAAO,CAACP,IAAS,EACjB;KAAA;KACC,IAAI,CAACA,IAAI,GAAGA,IAAI,IAAI,EAAE;KACtB,4CAAI,4CAAU,IAAI,CAACA,IAAI,CAACyC,KAAK,+BAAI,EAAE;;;;CAIrC;CACA;CACA;GACCzB,cAAc,GACd;KAAA;KACC,4CAAI;KACJ,IAAI2J,cAAI,CAAC8D,cAAc,eAAC,IAAI,CAACzO,IAAI,qBAAT,WAAWS,IAAI,CAAC,EACxC;OACC,4CAAI,4BAAYQ,aAAG,CAACC,MAAM,oBAAC;;OAEzB,CAAqD;;IAEvD,GAFIC,cAAU,CAACC,MAAM,CAAC,IAAI,CAACpB,IAAI,CAACS,IAAI,IAAI,EAAE,CAAC,CAACY,QAAQ,EAAE,CAErD;MACD,MAED;OACC,4CAAI,4BAAYJ,aAAG,CAACC,MAAM,sBAAC;;OAEzB,CAAoD;;IAEtD,GAFI0C,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC,CAEpD;;KAGF,IAAI8G,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EACpC;OACC,4CAAI,oEACFH,IAAI,CAAC,CAAC;SAAE8C,eAAe;SAAEC;QAAc,KAAK;SAAA;SAC5C,4CAAI,oDAAuBA,YAAY;SACvC,IAAI,CAAC1G,cAAI,CAAC8D,cAAc,gBAAC,IAAI,CAACzO,IAAI,qBAAT,YAAWS,IAAI,CAAC,EACzC;WACC,4CAAI,wCACHkK,cAAI,CAAC8D,cAAc,CAAC2C,eAAe,CAAC,IAAIzG,cAAI,CAAC8D,cAAc,CAAC4C,YAAY,CAAC,GACtEzN,aAAG,CAACC,UAAU,CAAC,iEAAiE,EAAE;aACnF,YAAY,EAAEuN,eAAe;aAC7B,SAAS,EAAEC;YACX,CAAC,GACAzN,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;WAErD,MAAMyN,WAAW,GAAG,IAAI,CAACvR,KAAK,CAACyC,SAAS,EAAE;WAC1C,MAAM+O,UAAU,GAAGD,WAAW,CAAClO,aAAa,CAAC,oBAAoB,CAAC;WAClE,IAAI,CAACrD,KAAK,CAACyR,UAAU,CAAC;aAAE5J,OAAO,EAAE2J,UAAU;aAAEE,IAAI,EAAE;YAAK,CAAC;;QAE1D,CAAC,CACDC,KAAK,CAAEC,GAAG,IAAK;SACfC,OAAO,CAAC7K,KAAK,CAAC4K,GAAG,CAAC;QAClB,CAAC;;KAIJ,+CAAO,IAAI;;;;CAIb;CACA;GACCnQ,QAAQ,GACR;KACC,4CAAI;;;CA6CN;CACA;CACA;GACCV,eAAe,GACf;KACC,4CAAI,sCAAiBG,aAAG,CAACC,MAAM,sBAAC;;uBAEb,CAAiC,wCAAqC,CAAuB;;;GAGhH,GAHqB,4CAAI,sCAAgByC,IAAI,CAAC,IAAI,CAAC,EAAwC,IAAI,CAAC5D,KAAK,CAACmE,OAAO,EAAE,CAG9G;KAED,4CAAI;KAEJ,+CAAO,IAAI;;;;CAIb;CACA;;GAkICpC,SAAS,GACT;KACC,OAAO;OAAE,GAAG,KAAK,CAACA,SAAS,EAAE;OAAE,GAAGyR,eAAe,CAACtR;MAA+B;;CAEnF;CAAC,4BAnMgBS,KAAc,EAC9B;GACC,MAAMjC,IAAI,GAAGkK,cAAI,CAAC8D,cAAc,CAAC/L,KAAK,CAAC,GACpCA,KAAK,GACLkB,aAAG,CAACC,UAAU,CAAC,wCAAwC,CAAC;GAE3D,4CAAI,0BAAUoJ,WAAW,GAAGxM,IAAI;GAChC,4CAAI,0BAAUiM,KAAK,GAAGjM,IAAI;CAC3B;CAAC,2CAGD;GACC,IAAI,CAACkK,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EACrC;KACC,OAAOoD,OAAO,CAACC,OAAO,CAAC;OACtBV,eAAe,EAAE,EAAE;OACnBC,YAAY,EAAEzN,aAAG,CAACC,UAAU,CAAC,iCAAiC;MAC9D,CAAC;;GAGH,MAAMiL,cAAc,GAAGlL,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;GACxE,IAAI,wCAAA0P,eAAe,kDAAwB,IAAI,EAC/C;KACC,wCAAAA,eAAe,gDAAsBxB,uCAAa,CAACC,aAAa,CAAC,EAAE,CAAC;;GAGrE,OAAO,wCAAAuB,eAAe,8CACpBjF,IAAI,CAAE2D,SAAS,IAAK;KAAA;KACpB,MAAM1N,MAAM,GAAG,CACd,6BAAG0N,SAAS,8CAATA,SAAS,CAAEuB,cAAc,qBAAzB,uBAA2BpE,MAAM,oCAAI,EAAE,EAC1C;KACD,MAAM3M,KAAK,GAAG8B,MAAM,CAAC+K,IAAI,CAAEmE,IAAI,IAAKA,IAAI,CAAC9O,IAAI,6CAAK,IAAI,qBAAO,CAAC;KAE9D,OAAO;OACNyM,eAAe,EAAExN,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;OAClEwN,YAAY,EAAE5O,KAAK,GAAGA,KAAK,CAAC8M,OAAO,GAAGT;MACtC;IACD,CAAC;CAEJ;CAAC,kCAuBqB5C,KAAc,EACpC;GACC,IAAI,yCAAC,IAAI,mCAAc,EACvB;KACC;;GAGD,MAAM2C,YAAY,GAAG,4CAAI,oCAAezL,aAAa,CAAC,QAAQ,CAAC;GAC/DyL,YAAY,CAAC5B,WAAW,GAAGtC,cAAI,CAAC8D,cAAc,CAACvC,KAAK,CAAC,GAClDA,KAAK,GACLtI,aAAG,CAACC,UAAU,CAAC,wCAAwC,CAAC;CAE5D;CAAC,qCAGD;GACC,MAAMgB,aAAa,GAAG,IAAI,CAAC9E,KAAK,CAAC8E,aAAa;GAE9C,OAAO,4CAAI,sBAAQD,QAAQ,CAAC,eAAe,EAAE,MAAM;KAClD,MAAM4K,QAAQ,GAAG,IAAIuC,uCAAa,CAAC;OAClCtC,QAAQ,EAAE,KAAK;OACfvJ,iBAAiB,EAAE;SAClBC,WAAW,EAAE,CAAC;SACdC,cAAc,EAAE,CAAC;SACjB+L,oBAAoB,EAAE;QACtB;OACDC,SAAS,EAAEvN,aAAa,CAACwN,YAAY,EAAE;OACvC7N,MAAM,EAAE;SACP,aAAa,EAAE,CACd,gBAAgB,CAChB;SACD,SAAS,EAAE,CACV,MAAM,EACN,QAAQ,EACR,MAAM,EACN,cAAc,EACd,MAAM,EACN,UAAU,EACV,aAAa,EACb,KAAK,EACL,QAAQ,EACR,SAAS,EACT,OAAO,CACP;SACD,SAAS,EAAE,CACV,CAAC;WAAEsB,iBAAiB,EAAEC;UAAW,KAAK,4CAAI,0DAA2BrB,GAAG,CAACqB,SAAS,CAAC,CACnF;SACD2N,mBAAmB,EAAE;QACrB;OACDhH,KAAK,EAAE9I,aAAG,CAACC,UAAU,CAAC,wCAAwC,CAAC;OAC/DyO,gBAAgB,EAAE;SACjBkB,cAAc,EAAE5P,aAAG,CAACC,UAAU,CAAC,iCAAiC;QAChE;OACDoC,aAAa,EAAE;SACdzB,MAAM,EAAGD,MAAM,IAAKA,MAAM,CAACC,MAAM,CAAE/B,KAAK,IAAKkI,cAAI,CAAC8H,QAAQ,CAAChQ,KAAK,CAAC,IAC7DkI,cAAI,CAAC8D,cAAc,CAAChM,KAAK,CAACkC,IAAI,CAAC,IAC/B,CAAC,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,aAAa,CAAC,CAACqB,QAAQ,CAACvD,KAAK,CAACkC,IAAI,CAAC;;MAEnE,CAAC;KACF6K,QAAQ,CAAC9I,SAAS,CAAC,uBAAuB,EAAGvC,KAAK,4CAAK,IAAI,oEAA+BA,KAAK,CAAC,CAAC;KAEjG,OAAOqL,QAAQ;IACf,CAAC;CACH;CAAC,sCAGD;GACC,OAAO,IAAIlL,GAAG,CAAC,CACd,SAAS,EACT,aAAa,CACb,CAAC;CACH;CAAC,6BAGD;GACC,MAAMyK,aAAa,2CAAG,IAAI,uDAAyB;GACnDA,aAAa,CACX1K,IAAI,EAAE,CACNiK,IAAI,CAAEC,aAA4B,IAAK;KACvC,wCAAAgF,eAAe,4CAAmBxE,aAAa,CAACG,aAAa,CAAC,KAAK,CAAC;KACpE,MAAMV,kBAAkB,GAAG,CAAC,GAAGD,aAAa,CAAC;KAC7C,IAAIA,aAAa,CAAC1F,MAAM,KAAK,CAAC,IAAI8B,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EAClE;OACCD,kBAAkB,CAACE,IAAI,yCAAC,IAAI,sBAAQ;;KAErC,4CAAI,wDAAyBF,kBAAkB;KAE/C,IAAID,aAAa,CAAC1F,MAAM,KAAK,CAAC,EAC9B;OACC;;KAGDrF,aAAG,CAACmL,WAAW,CAAC,IAAI,CAAC5O,KAAK,CAACyC,SAAS,EAAE,EAAE,WAAW,CAAC;KACpD,4CAAI,wBAAU+L,aAAa,CAAC,CAAC,CAAC;KAC9B,IAAI,CAAChO,OAAO,CAAC;OACZkC,KAAK,0CAAE,IAAI;MACX,CAAC;KACFmM,UAAU,CAAC,MAAM;OAChB,IAAI,CAAC7O,KAAK,CAAC2F,MAAM,EAAE;MACnB,EAAE,CAAC,CAAC;IACL,CAAC;CAEJ;CAAC,oCAEuB6I,aAA4B,EACpD;GACC,MAAMmB,sBAA4C,GAAG;KAAEC,kBAAkB,EAAEpB;IAAe;GAC1F,MAAMqB,kBAAoC,GAAG,IAAIC,0BAAS,CAAC;KAAE7P,IAAI,EAAE0P;IAAwB,CAAC;GAC5F,IAAI,CAAC7N,IAAI,CAAC,eAAe,EAAE+N,kBAAkB,CAAC;CAC/C;CAAC,0CAE6BzL,KAAK,EACnC;GACCyK,UAAU,CAAC,MAAM;;KAEhB,IAAIjE,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EACpC;OACC;;KAGD,4CAAI,wDAAyB,EAAE;IAC/B,CAAC;CACH;CAAC,8BAEwBlK,MAAM,EAC/B;GACC,wCAAAgP,eAAe,gDAAsB1B,OAAO,CAACC,OAAO,CAACvN,MAAM,CAAC;CAC7D;CAAC,sBA7QmBgP,eAAe;GAAA;CAAA;CAAA,sBAAfA,eAAe;GAAA;GAAA,OAOQ;CAAI;;;;;;ACbhD,CAI6B;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE7B,CAAe,MAAMI,gBAAgB,SAAS/T,KAAK,CACnD;GAAA;KAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OACU,IAAIoE,eAAK,CAACC,WAAW;;KAAE;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;;;CASjC;CACA;CACA;GACC1D,OAAO,CAACP,IAAS,EACjB;KAAA;KACC,IAAI,CAACA,IAAI,GAAGA,IAAI,GAAGA,IAAI,GAAG,EAAE;KAC5B,4CAAI,4CAAU,IAAI,CAACA,IAAI,CAACyC,KAAK,+BAAI,EAAE;KAEnC,MAAMmR,KAAK,2CAAG,IAAI,0GAAgC,IAAI,sBAAQ;KAC9D,IAAIA,KAAK,GAAG,CAAC,EACb;OACC,IAAI,CAAC7T,KAAK,CAAC8T,cAAc,CAACD,KAAK,CAAC;;;;;CAKnC;CACA;CACA;GACC5S,cAAc,GACd;KAAA;KACC,4CAAI;KACJ,IAAI2J,cAAI,CAAC8D,cAAc,eAAC,IAAI,CAACzO,IAAI,qBAAT,WAAWS,IAAI,CAAC,EACxC;OACC,4CAAI,4BAAYQ,aAAG,CAACC,MAAM,oBAAC;;OAEzB,CAAqD;;IAEvD,GAFIC,cAAU,CAACC,MAAM,CAAC,IAAI,CAACpB,IAAI,CAACS,IAAI,IAAI,EAAE,CAAC,CAACY,QAAQ,EAAE,CAErD;MACD,MAED;OACC,4CAAI,4BAAYJ,aAAG,CAACC,MAAM,sBAAC;;OAEzB,CAAwD;;IAE1D,GAFI0C,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC,CAExD;;KAGF,IAAI8G,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EACpC;OACC,4CAAI,oEACFH,IAAI,CAAC,CAAC;SAAE8C,eAAe;SAAEC;QAAc,KAAK;SAAA;SAC5C,4CAAI,oDAAuBA,YAAY;SACvC,IAAI,CAAC1G,cAAI,CAAC8D,cAAc,gBAAC,IAAI,CAACzO,IAAI,qBAAT,YAAWS,IAAI,CAAC,EACzC;WACC,4CAAI,wCACHkK,cAAI,CAAC8D,cAAc,CAAC2C,eAAe,CAAC,IAAIzG,cAAI,CAAC8D,cAAc,CAAC4C,YAAY,CAAC,GACtEzN,aAAG,CAACC,UAAU,CAAC,0DAA0D,EAAE;aAC5E,YAAY,EAAEuN,eAAe;aAC7B,SAAS,EAAEC;YACX,CAAC,GACAzN,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;WAEzD,MAAMyN,WAAW,GAAG,IAAI,CAACvR,KAAK,CAACyC,SAAS,EAAE;WAC1C,MAAM+O,UAAU,GAAGD,WAAW,CAAClO,aAAa,CAAC,qBAAqB,CAAC;WACnE,IAAI,CAACrD,KAAK,CAACyR,UAAU,CAAC;aAAE5J,OAAO,EAAE2J,UAAU;aAAEE,IAAI,EAAE;YAAK,CAAC;;QAE1D,CAAC,CACDC,KAAK,CAAEC,GAAG,IAAK;SACfC,OAAO,CAAC7K,KAAK,CAAC4K,GAAG,CAAC;QAClB,CAAC;;KAIJ,+CAAO,IAAI;;;;CAIb;CACA;GACCnQ,QAAQ,GACR;KACC,4CAAI;;;CA2FN;CACA;CACA;GACCV,eAAe,GACf;KACC,4CAAI,sCAAiBG,aAAG,CAACC,MAAM,sBAAC;;uBAEb,CAAiC,wCAAqC,CAAuB;;;GAGhH,GAHqB,4CAAI,sCAAgByC,IAAI,CAAC,IAAI,CAAC,EAAwC,IAAI,CAAC5D,KAAK,CAACmE,OAAO,EAAE,CAG9G;KAED,4CAAI;KAEJ,+CAAO,IAAI;;;;CAIb;CACA;;GA8ICpC,SAAS,GACT;KACC,OAAO;OAAE,GAAG,KAAK,CAACA,SAAS,EAAE;OAAE,GAAG,IAAI,CAACG;MAA+B;;CAExE;CAAC,4BA7PgBS,KAAc,EAC9B;GACC,MAAMjC,IAAI,GACTkK,cAAI,CAAC8D,cAAc,CAAC/L,KAAK,CAAC,GACvBA,KAAK,GACLkB,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;GAEzD,4CAAI,0BAAUoJ,WAAW,GAAGxM,IAAI;GAChC,4CAAI,0BAAUiM,KAAK,GAAGjM,IAAI;CAC3B;CAAC,2CAGD;GACC,IAAI,CAACkK,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EACrC;KACC,OAAOoD,OAAO,CAACC,OAAO,CAAC;OACtBV,eAAe,EAAE,EAAE;OACnBC,YAAY,EAAEzN,aAAG,CAACC,UAAU,CAAC,qCAAqC;MAClE,CAAC;;GAGH,MAAMiL,cAAc,GAAGlL,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;GAE5E,MAAM0B,WAAW,GAAG,IAAI,CAACxF,KAAK,CAAC8E,aAAa,CAACW,cAAc,EAAE;GAC7D,IAAI,wCAAAmO,gBAAgB,kDAAwB,IAAI,IAAIpO,WAAW,6CAAKoO,gBAAgB,yDAA2B,EAC/G;KACC,wCAAAA,gBAAgB,4DAA8BpO,WAAW;KACzD,wCAAAoO,gBAAgB,gDAAsB5B,uCAAa,CAACC,aAAa,CAAC,EAAE,0CAAE,IAAI,0DAA6B;;GAGxG,OAAO,wCAAA2B,gBAAgB,8CACrBrF,IAAI,CAAE2D,SAAS,IAAK;KAAA;KACpB,MAAMU,UAAU,GAAG;OAClBmB,cAAc,EAAE7B,SAAS,oBAATA,SAAS,CAAE8B,cAAc;OACzCjB,QAAQ,EAAEb,SAAS,oBAATA,SAAS,CAAE+B,QAAQ;OAC7Bf,OAAO,EAAEhB,SAAS,oBAATA,SAAS,CAAElC;MACpB;KACDjI,MAAM,CAACoL,OAAO,CAACP,UAAU,CAAC,CACxBQ,OAAO,CAAC,CAAC,CAAClL,GAAG,EAAEmL,QAAQ,CAAC,KAAK;OAAA;OAC7B,IAAIA,QAAQ,KAAKC,SAAS,EAC1B;SACC;;OAGDD,QAAQ,CAAChE,MAAM,GAAG,qBAACgE,QAAQ,oBAARA,QAAQ,CAAEhE,MAAM,+BAAI,EAAE,EAAEpH,GAAG,CAAEvF,KAAK,IAAK;SACzD,OAAO;WACN,GAAGA,KAAK;WACR2Q,QAAQ,EAAEnL;UACV;QACD,CAAC;MACF,CAAC;KAEH,MAAM1D,MAAM,GAAG,CACd,6BAAG0N,SAAS,8CAATA,SAAS,CAAE8B,cAAc,qBAAzB,uBAA2B3E,MAAM,oCAAI,EAAE,GAC1C,6BAAG6C,SAAS,2CAATA,SAAS,CAAE+B,QAAQ,qBAAnB,oBAAqB5E,MAAM,oCAAI,EAAE,GACpC,6BAAG6C,SAAS,0CAATA,SAAS,CAAElC,OAAO,qBAAlB,mBAAoBX,MAAM,oCAAI,EAAE,EACnC;KAED,MAAM3M,KAAK,GAAG8B,MAAM,CAAC+K,IAAI,CAAE7M,KAAK,IAAKA,KAAK,CAACkC,IAAI,6CAAK,IAAI,qBAAO,CAAC;KAChE,IAAIyM,eAAe,GAAG,EAAE;KACxB,IAAIzG,cAAI,CAAC8H,QAAQ,CAAChQ,KAAK,CAAC,EACxB;OACC,IAAI,CAAAA,KAAK,oBAALA,KAAK,CAAE2Q,QAAQ,MAAK,gBAAgB,EACxC;SACChC,eAAe,GAAGxN,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;QACzE,MACI,IAAI,CAAApB,KAAK,oBAALA,KAAK,CAAE2Q,QAAQ,MAAK,UAAU,EACvC;SACChC,eAAe,GAAGxN,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;QACnE,MACI,IAAI,CAAApB,KAAK,oBAALA,KAAK,CAAE2Q,QAAQ,MAAK,SAAS,EACtC;SACChC,eAAe,GAAGxN,aAAG,CAACC,UAAU,CAAC,4BAA4B,CAAC;QAC9D,MAED;SAAA;SACCuN,eAAe,sDAAGuB,UAAU,CAAClQ,KAAK,oBAALA,KAAK,CAAE2Q,QAAQ,CAAC,qBAA3B,uBAA6BE,OAAO,oCAAI,EAAE;;;KAG9D,OAAO;OACNlC,eAAe;OACfC,YAAY,EAAE5O,KAAK,GAAGA,KAAK,CAAC8M,OAAO,GAAGT;MACtC;IACD,CAAC;CAEJ;CAAC,kCAuBqB5C,KAAc,EACpC;GACC,IAAI,yCAAC,IAAI,mCAAc,EACvB;KACC;;GAGD,MAAM2C,YAAY,GAAG,4CAAI,oCAAezL,aAAa,CAAC,QAAQ,CAAC;GAC/DyL,YAAY,CAAC5B,WAAW,GAAGtC,cAAI,CAAC8D,cAAc,CAACvC,KAAK,CAAC,GAClDA,KAAK,GACLtI,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;CAEzD;CAAC,qCAGD;GACC,MAAMgB,aAAa,GAAG,IAAI,CAAC9E,KAAK,CAAC8E,aAAa;GAE9C,MAAMkK,aAAa,GAAG,4CAAI,sBAAQnK,QAAQ,CAAC,eAAe,EAAE,MAAM;KACjE,MAAM4K,QAAQ,GAAG,IAAIuC,uCAAa,CAAC;OAClCtC,QAAQ,EAAE,KAAK;OACf2C,SAAS,EAAEvN,aAAa,CAACwN,YAAY,EAAE;OACvC7N,MAAM,EAAE;SACP,aAAa,EAAE,CACd,gBAAgB,EAChB,UAAU,CACV;SACD,SAAS,EAAE,EAEV;SACD,SAAS,EAAE,CACV,CAAC;WAAEsB,iBAAiB,EAAEC;UAAW,KAAK,4CAAI,0DAA2BrB,GAAG,CAACqB,SAAS,CAAC;QAEpF;OACD2G,KAAK,EAAE9I,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;OAC5DyO,gBAAgB,EAAE;SACjB,gBAAgB,EAAE1O,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;SACzE,UAAU,EAAED,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;SAC7D,SAAS,EAAED,aAAG,CAACC,UAAU,CAAC,4BAA4B;QACtD;OACDoQ,2BAA2B,EAAE;MAC7B,CAAC;KACFzE,QAAQ,CAAC9I,SAAS,CAAC,uBAAuB,EAAGvC,KAAK,4CAAK,IAAI,oEAA+BA,KAAK,CAAC,CAAC;KAEjG,OAAOqL,QAAQ;IACf,CAAC;GAEFT,aAAa,CAACmF,wBAAwB,yCAAC,IAAI,0DAA6B;GAExE,OAAOnF,aAAa;CACrB;CAAC,sCAGD;GACC,OAAO,IAAIzK,GAAG,CAAC,EAEd,CAAC;CACH;CAAC,6BAGD;GACC,MAAMyK,aAAa,2CAAG,IAAI,uDAAyB;GACnDA,aAAa,CACX1K,IAAI,EAAE,CACNiK,IAAI,CAAEC,aAA4B,IAAK;KACvC,IAAI4F,IAAI,GAAGpF,aAAa,CAACG,aAAa,CAAC,KAAK,CAAC;KAC7C,wCAAAyE,gBAAgB,4CAAmBQ,IAAI;KACvC,MAAM3F,kBAAkB,GAAG,CAAC,GAAGD,aAAa,CAAC;KAC7C,IAAIA,aAAa,CAAC1F,MAAM,KAAK,CAAC,IAAI8B,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EAClE;OACCD,kBAAkB,CAACE,IAAI,yCAAC,IAAI,sBAAQ;;KAErC,4CAAI,wDAAyBF,kBAAkB;KAE/C,IAAID,aAAa,CAAC1F,MAAM,KAAK,CAAC,EAC9B;OACC;;KAGDrF,aAAG,CAACmL,WAAW,CAAC,IAAI,CAAC5O,KAAK,CAACyC,SAAS,EAAE,EAAE,WAAW,CAAC;KACpD,4CAAI,wBAAU+L,aAAa,CAAC,CAAC,CAAC;KAC9B,IAAI,CAAChO,OAAO,CAAC;OACZkC,KAAK,0CAAE,IAAI;MACX,CAAC;KACFmM,UAAU,CAAC,MAAM;OAChB,IAAI,CAAC7O,KAAK,CAAC2F,MAAM,EAAE;MACnB,EAAE,CAAC,CAAC;IACL,CAAC;CAEJ;CAAC,oCAEuB6I,aAA4B,EACpD;GACC,MAAMmB,sBAA4C,GAAG;KAAEC,kBAAkB,EAAEpB;IAAe;GAC1F,MAAMqB,kBAAoC,GAAG,IAAIC,0BAAS,CAAC;KAAE7P,IAAI,EAAE0P;IAAwB,CAAC;GAC5F,IAAI,CAAC7N,IAAI,CAAC,eAAe,EAAE+N,kBAAkB,CAAC;CAC/C;CAAC,0CAE6BzL,KAAK,EACnC;GACCyK,UAAU,CAAC,MAAM;;KAEhB,IAAIjE,cAAI,CAAC8D,cAAc,yCAAC,IAAI,sBAAQ,EACpC;OACC;;KAGD,4CAAI,wDAAyB,EAAE;IAC/B,CAAC;CACH;CAAC,yCAE8B1I,SAAiB,EAChD;GACC,IAAI,CAAC4E,cAAI,CAAC8D,cAAc,CAAC1I,SAAS,CAAC,EACnC;KACC,OAAO,IAAI;;GAGZ,MAAMqO,WAAW,GAAGrO,SAAS,CAACsO,KAAK,CAAC,GAAG,CAAC;GAExC,OAAOD,WAAW,CAAC,CAAC,CAAC,GAClBlH,MAAM,CAACkH,WAAW,CAAC,CAAC,CAAC,CAAC,GACtB,IAAI;CAER;CAAC,8BAEwB7P,MAAM,EAC/B;GACC,wCAAAoP,gBAAgB,gDAAsB9B,OAAO,CAACC,OAAO,CAACvN,MAAM,CAAC;CAC9D;CAAC,sCAGD;GACC,OAAO;KACN+P,GAAG,EAAE,2DAA2D;KAChEC,cAAc,EAAE;OACfhP,WAAW,EAAE,IAAI,CAACxF,KAAK,CAAC8E,aAAa,CAACW,cAAc;;IAErD;CACF;CAAC,sBA9UmBmO,gBAAgB;GAAA;CAAA;CAAA,sBAAhBA,gBAAgB;GAAA;GAAA,OAOO;CAAI;CAAA,sBAP3BA,gBAAgB;GAAA;GAAA,OAQe;CAAI;;;;;;;;;;;;ACdxD,CAYA,MAAMnM,aAAW,GAAGC,oBAAU,CAACC,QAAQ,CAAC,gBAAgB,CAAC;AAEzD,CAAe,MAAMT,IAAE,CACvB;;CAEA;CACA;CACA;CACA;GACC,OAAOU,OAAO,CAACC,OAAoB,EAAEC,IAA6B,EAClE;KACCC,MAAM,CAACC,IAAI,CAACF,IAAI,CAAC,CAACG,GAAG,CAACC,GAAG,IAAI;OAC5BJ,IAAI,CAACI,GAAG,CAAC,GAAI,GAAEuM,IAAI,CAACC,KAAK,CAAC5M,IAAI,CAACI,GAAG,CAAC,CAAE,IAAG;MACxC,CAAC;KACFzE,aAAG,CAAC2E,KAAK,CAACP,OAAO,EAAEC,IAAI,CAAC;;;;CAI1B;CACA;CACA;CACA;GACC,OAAOO,cAAc,CAACC,OAA2B,EACjD;KACC,OAAOpH,aAAG,CAACC,MAAM,oBAAC;;;;;;;;6HAQuG,CAAmB;uHACzB,CAAiB;;;;GAIpI,GAL2HmH,OAAO,CAAC3G,QAAQ,EACtB2G,OAAO,CAAC5G,MAAM;;;;CAQrI;CACA;CACA;CACA;CACA;CACA;GACC,OAAO6G,iBAAiB,CAACC,OAA0B,EAAEC,aAAqB,EAAGtI,QAAkB,EAC/F;KACC,MAAMuI,SAAS,GAAG,EAAE;KACpB,IAAIC,YAAY,GAAG9E,aAAG,CAACC,UAAU,CAAC,sCAAsC,CAAC;KAEzE0E,OAAO,CAACP,GAAG,CAAClD,MAAM,IAAI;OACrBA,MAAM,CAACH,IAAI,GAAGG,MAAM,CAACH,IAAI,IAAIf,aAAG,CAACC,UAAU,CAAC,sCAAsC,CAAC;OACnF4E,SAAS,CAAC3D,MAAM,CAAC6D,IAAI,CAAC,GAAG7D,MAAM,CAACH,IAAI;OAEpC,IAAIG,MAAM,CAAC6D,IAAI,KAAKH,aAAa,EACjC;SACCE,YAAY,GAAG5D,MAAM,CAACH,IAAI;;MAE3B,CAAC;KAEF,MAAMiE,cAAc,GAAIL,OAAO,CAACM,MAAM,GAAG,CAAC,GACvC5H,aAAG,CAACC,MAAM,sBAAC,SAAM,CAAkC,SAAO,GAAvCC,cAAU,CAACC,MAAM,CAACsH,YAAY,CAAC,IAClDzH,aAAG,CAACC,MAAM,sBAAC,MAAG,CAAkC,MAAI,GAApCC,cAAU,CAACC,MAAM,CAACsH,YAAY,CAAC,CAAM;KAExD,IAAIH,OAAO,CAACM,MAAM,GAAG,CAAC,EACtB;OACCC,UAAM,CAACC,cAAc,CAAC;SACrBC,WAAW,EAAEJ,cAAc;SAC3BK,KAAK,EAAER,SAAS;SAChBS,aAAa,EAAExG,KAAK,IAAI;WACvBkG,cAAc,CAACO,SAAS,GAAGV,SAAS,CAAC/F,KAAK,CAAC;WAC3CxC,QAAQ,CAACgI,QAAQ,CAACxF,KAAK,CAAC,CAAC;;QAE1B,CAAC;;KAGH,OAAOzB,aAAG,CAACC,MAAM,sBAAC;;MAEhB,CAAiB;;GAEnB,GAFI0H,cAAc;;;;CAMpB;CACA;CACA;GACC,OAAOQ,aAAa,GACpB;KACC,OAAOnI,aAAG,CAACC,MAAM,sBAAC;;;;;;;;;;;;;GAalB;;;;CAIF;CACA;CACA;GACC,OAAOmI,aAAa,CACnBH,aAA8D,EAC9DI,aAAsC,EAEvC;KAAA;;KAEC,MAAMC,KAAK,GAAG;OACb,0BAA0B,EAAI,8EAA8E;OAC5G,eAAe,EAAe,+DAA+D;OAC7F,kBAAkB,EAAY,sEAAsE;OACpG,uBAAuB,EAAO,uEAAuE;OACrG,gBAAgB,EAAc,kEAAkE;OAChG,SAAS,EAAqB,mDAAmD;OACjF,gBAAgB,EAAc,0DAA0D;OACxF,WAAW,EAAmB;MAC9B;KACD,MAAMC,UAAU,GAAGvI,aAAG,CAACC,MAAM,sBAAC,iEAA8D,CAA+C,QAAM,GAAnDqI,KAAK,CAACD,aAAa,CAAC,YAAY,CAAC,CAAC,IAAI,MAAM,CAAQ;KAClJR,UAAM,CAACC,cAAc,CAAC;OACrBC,WAAW,EAAEQ,UAAU;OACvBP,KAAK,EAAEM,KAAK;OACZL,aAAa,EAAExG,KAAK,IAAI;SACvB8G,UAAU,CAACL,SAAS,GAAGI,KAAK,CAAC7G,KAAK,CAAC;SACnCwG,aAAa,CAAC,QAAQ,EAAExG,KAAK,CAAC;;MAE/B,CAAC;;;;KAIF,IAAI+G,YAAY,GAAGvB,QAAQ,CAACoB,aAAa,CAAC,UAAU,CAAC,CAAC;KACtD,IAAII,aAAa,GAAG,EAAE;KAEtB,IAAID,YAAY,EAChB;OACCC,aAAa,GAAGD,YAAY;;KAG7B,MAAME,QAAQ,GAAG1I,aAAG,CAACC,MAAM,sBAAC,8DAA2D,CAAmC,QAAM,GAAvCwI,aAAa,GAAE,IAAI,IAAI,SAAS,CAAQ;KACjIZ,UAAM,CAACC,cAAc,CAAC;OACrBC,WAAW,EAAEW,QAAQ;OACrBV,KAAK,EAAE,CACN,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAClF,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,CACtE;OACDC,aAAa,EAAExG,KAAK,IAAI;SACvBiH,QAAQ,CAACR,SAAS,GAAGjB,QAAQ,CAACxF,KAAK,CAAC,GAAG,IAAI;SAC3CwG,aAAa,CAAC,MAAM,EAAExG,KAAK,CAAC;QAC5B;OACDkH,YAAY,EAAEF;MACd,CAAC;KAEF,MAAM;OAAEG,MAAM,EAAEC;MAAW,GAAG7C,IAAE,CAAC8C,mBAAmB,yBACnDT,aAAa,CAACtH,KAAK,mCAAI,MAAM,EAC5BA,KAAK,IAAKkH,aAAa,CAAC,OAAO,EAAElH,KAAK,CAAC,CACxC;KAED,OAAOf,aAAG,CAACC,MAAM,sBAAC;;;MAGhB,CAAa;MACb,CAAW;MACX,CAAY;;;;;;;;;;;GAWd,GAbIsI,UAAU,EACVG,QAAQ,EACRG,SAAS;;GAcd,OAAOC,mBAAmB,CACzBC,uBAA+B,EAC/BC,aAA8B,EAC9BC,kBAAsC,GAAG,EAAE,EAE5C;KACC,MAAML,MAAM,GAAG5I,aAAG,CAACC,MAAM,sBAAC;;YAElB,CAAiD;UAClD,GADG0C,aAAG,CAACC,UAAU,CAAC,8BAA8B,CAAC,CAChD;KAERoD,IAAE,CAACkD,2BAA2B,CAACN,MAAM,EAAEG,uBAAuB,CAAC;KAC/D,MAAMI,yBAAyB,GAAG;OACjC,GAAGF,kBAAkB;OACrBlB,WAAW,EAAEa,MAAM;OACnBQ,eAAe,EACbrI,KAAK,IAAK;SACViI,aAAa,CAACjI,KAAK,CAAC;SACpBiF,IAAE,CAACkD,2BAA2B,CAACN,MAAM,EAAE7H,KAAK,CAAC;;MAE/C;KAED,MAAMsI,MAAM,GAAG,IAAI9C,aAAW,CAAC4C,yBAAyB,CAAC;KAEzDG,eAAK,CAAC5G,IAAI,CAACkG,MAAM,EAAE,OAAO,EAAE,MAAM;OACjCS,MAAM,CAACE,IAAI,EAAE;MACb,CAAC;KAEF,OAAO;OAAEX,MAAM;OAAEY,WAAW,EAAEH;MAAQ;;GAGvC,OAAOH,2BAA2B,CAACN,MAAmB,EAAE7H,KAAa,EACrE;KACC,MAAM0I,WAAW,GAAGb,MAAM,CAACzG,aAAa,CAAC,8CAA8C,CAAC;KACxF,IAAIuH,cAAI,CAACC,KAAK,CAACF,WAAW,CAAC,EAC3B;OACC;;KAGDlH,aAAG,CAAC2E,KAAK,CACRuC,WAAW,EACX,kBAAkB,EAClB1I,KAAK,CACL;;CAEH;;CChPsB;CAAA;CAAA;CAAA;CAAA;AAOtB,CAAe,MAAM0S,KAAK,CAC1B;;CA2EA;CACA;CACA;GACC5U,WAAW,CAACuI,OAAqB,EACjC;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OA5EW;SACVsM,MAAM,EAAE;WACPC,QAAQ,EAAE,YAAY;WACtBlS,KAAK,EAAE;UACP;SACDmS,IAAI,EAAE;WACLD,QAAQ,EAAE,UAAU;WACpBlS,KAAK,EAAE;UACP;SACDV,KAAK,EAAE;WACN4S,QAAQ,EAAE,OAAO;WACjBlS,KAAK,EAAE;UACP;SACDoS,IAAI,EAAE;WACL9H,MAAM,EAAE,IAAI;WACZ4H,QAAQ,EAAE,YAAY;WACtBlS,KAAK,EAAE,MAAM;WACbqS,KAAK,EAAE;UACP;SACDC,MAAM,EAAE;WACPhI,MAAM,EAAE,IAAI;WACZ4H,QAAQ,EAAE,WAAW;WACrBlS,KAAK,EAAE,QAAQ;WACfqS,KAAK,EAAE;UACP;SACDE,SAAS,EAAE;WACVjI,MAAM,EAAE,IAAI;WACZ4H,QAAQ,EAAE,gBAAgB;WAC1BlS,KAAK,EAAE,WAAW;WAClBqS,KAAK,EAAE;UACP;SACDG,OAAO,EAAE;WACRlI,MAAM,EAAE,IAAI;WACZ4H,QAAQ,EAAE,gBAAgB;WAC1BlS,KAAK,EAAE,cAAc;WACrBqS,KAAK,EAAE;UACP;SACDI,IAAI,EAAE;WACLnI,MAAM,EAAE,IAAI;WACZ4H,QAAQ,EAAE,WAAW;WACrBlS,KAAK,EAAE,MAAM;WACbqS,KAAK,EAAE,KAAK;WACZK,KAAK,EAAE;UACP;SACDC,MAAM,EAAE;WACPrI,MAAM,EAAE,IAAI;WACZ4H,QAAQ,EAAE,WAAW;WACrBlS,KAAK,EAAE,QAAQ;WACfqS,KAAK,EAAE,KAAK;WACZK,KAAK,EAAE;UACP;SACDE,KAAK,EAAE;WACNtI,MAAM,EAAE,IAAI;WACZ4H,QAAQ,EAAE,WAAW;WACrBlS,KAAK,EAAE,OAAO;WACdqS,KAAK,EAAE,KAAK;WACZK,KAAK,EAAE;UACP;SACDG,OAAO,EAAE;WACRvI,MAAM,EAAE,IAAI;WACZ4H,QAAQ,EAAE,WAAW;WACrBlS,KAAK,EAAE,SAAS;WAChBqS,KAAK,EAAE,KAAK;WACZK,KAAK,EAAE;;;;KAER;OAAA;OAAA,OAEQ;SACRI,aAAa,EAAE;;;KASf,4CAAI,oBAAUnN,OAAO,CAACtI,KAAK;KAE3B,IAAIsI,OAAO,CAACrI,IAAI,EAChB;OACC,4CAAI,0BAAYqI,OAAO,CAACrI,IAAI;;;;;CAK/B;CACA;CACA;;;CAyDA;CACA;CACA;GACCyV,WAAW,CAAC7N,OAAoB,EAChC;KACCA,OAAO,CAAC8N,eAAe,CAAC,OAAO,CAAC;KAChClS,aAAG,CAAC2E,KAAK,CAACP,OAAO,EAAE,IAAI,CAAC0B,aAAa,EAAE,CAAC;;GAGzCqM,cAAc,CAAChM,QAAQ,EACvB;KACC,IAAIA,QAAQ,EACZ;OACC,4CAAI,sBAAUkL,IAAI,CAAC,UAAU,CAAC,GAAG,UAAU;OAC3C,4CAAI,sBAAUA,IAAI,CAAC,OAAO,CAAC,GAAGlL,QAAQ;;;;;CAKzC;CACA;CACA;GACCL,aAAa,GACb;KACC,MAAMsM,MAAM,GAAG,EAAE;KAEjB,CAAC,GAAG9N,MAAM,CAACC,IAAI,yCAAC,IAAI,sBAAU,CAAC,CAACC,GAAG,CAACC,GAAG,IAAI;OAC1C,IAAI,4CAAI,sBAAUA,GAAG,CAAC,CAAC,OAAO,CAAC,IAAK,OAAO,4CAAI,sBAAUA,GAAG,CAAC,CAAC,OAAO,CAAC,KAAK,WAAY,EACvF;SACC,MAAM2M,QAAQ,GAAG,4CAAI,sBAAU3M,GAAG,CAAC,CAAC,UAAU,CAAC;SAC/C,MAAMvF,KAAK,GAAG,4CAAI,sBAAUuF,GAAG,CAAC,CAAC,OAAO,CAAC;SAEzC,IAAIvF,KAAK,KAAK,IAAI,EAClB;WACC;;SAGD,IAAI,4CAAI,sBAAUuF,GAAG,CAAC,CAAC,OAAO,CAAC,EAC/B;WACC2N,MAAM,CAAChB,QAAQ,CAAC,GAAGlS,KAAK;UACxB,MAED;WACCkT,MAAM,CAAChB,QAAQ,CAAC,GAAG,CAACgB,MAAM,CAAChB,QAAQ,CAAC,GAAGgB,MAAM,CAAChB,QAAQ,CAAC,GAAG,GAAG,GAAG,EAAE,IAAIlS,KAAK;;;MAG7E,CAAC;KAEF,OAAOkT,MAAM;;;;CAIf;CACA;CACA;GACCpT,SAAS,GACT;KACC,MAAMqH,MAAM,GAAG5C,IAAE,CAACoC,aAAa,CAC9B,CAACrC,IAAY,EAAEtE,KAAa,KAAK;OAChC,4CAAI,sBAAUsE,IAAI,CAAC,CAAC,OAAO,CAAC,GAAGtE,KAAK;OACpC,4CAAI,kBAAQmT,WAAW,EAAE;MACzB,EACD,IAAI,CAACvM,aAAa,EAAE,CACpB;KAED,CAAC,GAAGO,MAAM,CAACiM,gBAAgB,CAAC,eAAe,CAAC,CAAC,CAAC9N,GAAG,CAACgF,MAAM,IAAI;OAC1D,MAAM+I,MAAM,GAAG/I,MAAM,CAACgJ,YAAY,CAAC,aAAa,CAAC;OAElD,IAAI,4CAAI,sBAAUD,MAAM,CAAC,EACzB;SACCxL,eAAK,CAAC5G,IAAI,CAACqJ,MAAM,EAAE,OAAO,EAAE,8CAAM,IAAI,kCAAgB+I,MAAM,CAAC,CAAC;SAC9D,4CAAI,sBAAUA,MAAM,CAAC,CAAC,QAAQ,CAAC,GAAG/I,MAAM;SAExC,IAAI,4CAAI,sBAAU+I,MAAM,CAAC,CAAC,OAAO,CAAC,EAClC;WACCvS,aAAG,CAACyS,QAAQ,CAAC,4CAAI,sBAAUF,MAAM,CAAC,CAAC,QAAQ,CAAC,EAAE,4CAAI,kBAAQP,aAAa,CAAC;;;MAG1E,CAAC;KAEF,OAAO3L,MAAM;;GAGdwG,WAAW,CAACrO,KAAa,EACzB;KACC,4CAAI,sBAAUA,KAAK,CAACU,KAAK,GAAGV,KAAK;;CAEnC;CAAC,yBA/IegF,IAAY,EAC3B;GACC,4CAAI,sBAAUA,IAAI,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,4CAAI,sBAAUA,IAAI,CAAC,CAAC,OAAO,CAAC;GAE5D,IAAI,4CAAI,sBAAUA,IAAI,CAAC,CAAC,OAAO,CAAC,EAChC;KACCxD,aAAG,CAACyS,QAAQ,CAAC,4CAAI,sBAAUjP,IAAI,CAAC,CAAC,QAAQ,CAAC,EAAE,4CAAI,kBAAQwO,aAAa,CAAC;KAEtE,IAAI,4CAAI,sBAAUxO,IAAI,CAAC,CAAC,OAAO,CAAC,EAChC;OACC,MAAMoO,KAAK,GAAG,4CAAI,sBAAUpO,IAAI,CAAC,CAAC,OAAO,CAAC;OAE1C,CAAC,GAAGc,MAAM,CAACC,IAAI,yCAAC,IAAI,sBAAU,CAAC,CAACC,GAAG,CAACC,GAAG,IAAI;SAC1C,IAAIA,GAAG,KAAKjB,IAAI,IAAI,4CAAI,sBAAUiB,GAAG,CAAC,CAAC,OAAO,CAAC,KAAKmN,KAAK,EACzD;WACC,4CAAI,sBAAUnN,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,KAAK;WACnCzE,aAAG,CAACmL,WAAW,CAAC,4CAAI,sBAAU1G,GAAG,CAAC,CAAC,QAAQ,CAAC,EAAE,4CAAI,kBAAQuN,aAAa,CAAC;;QAEzE,CAAC;;IAEH,MAED;KACChS,aAAG,CAACmL,WAAW,CAAC,4CAAI,sBAAU3H,IAAI,CAAC,CAAC,QAAQ,CAAC,EAAE,4CAAI,kBAAQwO,aAAa,CAAC;;GAG1E,4CAAI,kBAAQK,WAAW,EAAE;CAC1B;CAAC,qBAMU7V,IAA6B,EACxC;GACC,CAAC,GAAG8H,MAAM,CAACC,IAAI,yCAAC,IAAI,sBAAU,CAAC,CAACC,GAAG,CAACC,GAAG,IAAI;KAC1C,MAAM2M,QAAQ,GAAG,4CAAI,sBAAU3M,GAAG,CAAC,CAAC,UAAU,CAAC;KAE/C,IAAIjI,IAAI,CAAC4U,QAAQ,CAAC,EAClB;OACC,IAAI,OAAO,4CAAI,sBAAU3M,GAAG,CAAC,CAAC,OAAO,CAAC,KAAK,WAAW,EACtD;SACC,IAAIjI,IAAI,CAAC4U,QAAQ,CAAC,CAACsB,OAAO,CAAC,4CAAI,sBAAUjO,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,CAAC,EAC9D;WACC,4CAAI,sBAAUA,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,IAAI;;QAEnC,MAED;SACC,4CAAI,sBAAUA,GAAG,CAAC,CAAC,OAAO,CAAC,GAAGjI,IAAI,CAAC4U,QAAQ,CAAC;;;IAG9C,CAAC;CACH;;CClJqB;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEtB,CAAe,MAAMuB,KAAK,SAAStW,6BAAY,CAC/C;;CAkDA;CACA;CACA;GACCC,WAAW,CAACuI,OAAqB,EACjC;KAAA;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA,KAtDTpI,MAAM,GAAG;OACRE,kBAAkB,EAAE;MACpB;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAMiB;;KAAI;OAAA;OAAA,OAEA;;KAAC;OAAA;OAAA,OACE;;KAAK;OAAA;OAAA,OACL;;KAAK;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAGV;SACnB0C,IAAI,EAAEV,IAAI;SACViU,YAAY,EAAErS,YAAY;SAC1BsS,MAAM,EAAExL,MAAM;SACdyL,OAAO,EAAE1K,OAAO;SAChB2K,MAAM,EAAErJ,QAAM;SACdsJ,SAAS,EAAEtI,SAAS;SACpBuI,WAAW,EAAE3G,WAAW;SACxB4G,UAAU,EAAEzG,UAAU;SACtB0G,IAAI,EAAEvG,IAAI;SACVwG,KAAK,EAAEzG,KAAK;SACZ1P,IAAI,EAAE6G,IAAI;SAEVuP,YAAY,EAAE1F,YAAY;SAC1B2F,cAAc,EAAEpE,cAAc;SAC9BqE,eAAe,EAAExD,eAAe;SAEhCyD,gBAAgB,EAAErD;;;KAClB;OAAA;OAAA;;KAAA;OAAA;OAAA,OAGQ;SACRsD,YAAY,EAAE,+BAA+B;SAC7CC,UAAU,EAAE,sCAAsC;SAClDC,YAAY,EAAE,6BAA6B;SAC3CC,YAAY,EAAE,sCAAsC;SACpDC,kBAAkB,EAAE;;;KACpB;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAaA,IAAI,CAACjX,iBAAiB,CAAC,yBAAyB,CAAC;KACjD,IAAI,CAACyE,aAAa,GAAGwD,OAAO,CAACxD,aAAa;KAC1C,4CAAI,cAAOwD,OAAO,CAAC4D,EAAE,IAAI,IAAI;KAC7B,4CAAI,kBAAS5D,OAAO,CAACrB,IAAI;KACzB,4CAAI,8BAAeqB,OAAO,CAACuL,KAAK;KAChC,4CAAI,wCAAoBvL,OAAO,CAACiP,OAAO;KACvC,4CAAI,0CAAqBjP,OAAO,CAAC3G,QAAQ;KACzC,4CAAI,0CAAqB,IAAI;KAC7B,4CAAI,8BAAe,IAAIgT,KAAK,CAAC;OAC5B3U,KAAK,EAAE,IAAI;OACXC,IAAI,EAAEqI,OAAO,CAACF;MACd,CAAC;KACF,IAAI,CAAC,4CAAI,gFAAmB,IAAI,gBAAO,EACvC;OACC,MAAM,IAAIoP,KAAK,CAAE,yBAAsB,wCAAE,IAAI,eAAO,cAAa,CAAC;;KAGnE,4CAAI,4BAAY,KAAI,4CAAI,gFAAmB,IAAI,gBAAO,EAAC,IAAI,CAAC;KAE5D,IAAI,CAAC,MAAM,EAAE,QAAQ,CAAC,CAACvR,QAAQ,yCAAC,IAAI,gBAAO,IAAI2E,cAAI,CAAC6M,QAAQ,mBAACnP,OAAO,CAACF,KAAK,qBAAb,eAAenG,KAAK,CAAC,EAClF;OACC,4CAAI,0BAAUD,gBAAgB,CAACsG,OAAO,CAACF,KAAK,CAACnG,KAAK,EAAE,KAAK,CAAC;;KAG3D,4CAAI;KAEJuI,eAAK,CAAC5G,IAAI,yCAAC,IAAI,qBAAU,OAAO,EAAE,4CAAI,sBAAUA,IAAI,CAAC,IAAI,CAAC,CAAC;KAE3D,IACC0E,OAAO,CAACuL,KAAK,GAAG,CAAC,IACd,CAAC,CAAC,cAAc,EAAE,iBAAiB,EAAE,kBAAkB,CAAC,CAAC5N,QAAQ,CAAC,4CAAI,gBAAOyR,WAAW,EAAE,CAAC,EAC/F;OACC,4CAAI,kCAAiB,IAAI;;KAG1B,IAAI,CAAC5B,WAAW,EAAE;KAElB,IAAI,CAAC6B,WAAW,sBAACrP,OAAO,CAACsP,QAAQ,gCAAI,4CAAI,0BAAUjX,gBAAgB,EAAE,CAAC;KAEtE,IAAI2H,OAAO,CAACrI,IAAI,EAChB;OACC4O,UAAU,CAAC,MAAM;SAChB,IAAI,CAACrO,OAAO,CAAC8H,OAAO,CAACrI,IAAI,CAAC;QAC1B,EAAE,CAAC,CAAC;;KAEN,4CAAI,oBAAQ,IAAIyM,eAAG,EAAE;;;;CAIvB;CACA;CACA;GACCjK,SAAS,GACT;KACC,+CAAO,IAAI;;;;CAIb;CACA;CACA;GACCjC,OAAO,CAACP,IAAS,EACjB;KACC,4CAAI,0BAAUO,OAAO,CAACP,IAAI,CAAC;KAC3B,IAAI,CAACiD,UAAU,EAAE;;;;CAInB;CACA;CACA;GACCyU,WAAW,CAACC,QAAsB,EAClC;KACC1Q,IAAE,CAACU,OAAO,yCAAC,IAAI,qBAAUgQ,QAAQ,CAAC;;;;CAIpC;CACA;CACA;GACC9W,OAAO,GACP;KACC,OAAO,4CAAI,0BAAUA,OAAO,EAAE;;;;CAIhC;CACA;CACA;GACCiK,WAAW,GACX;KACC,IAAI;OAAC8M,GAAG;OAAEzC,IAAI;OAAExU,KAAK;OAAEC;MAAO,GAAG,4CAAI,oBAASiX,qBAAqB,EAAE;KACrE,MAAMhO,MAAM,2CAAG,IAAI,mBAAQ;KAC3B+N,GAAG,GAAGpD,IAAI,CAACC,KAAK,CAACmD,GAAG,CAAC;KACrBzC,IAAI,GAAGX,IAAI,CAACC,KAAK,CAACU,IAAI,CAAC;KACvBxU,KAAK,GAAG6T,IAAI,CAACC,KAAK,CAAC9T,KAAK,CAAC;KACzBC,MAAM,GAAG4T,IAAI,CAACC,KAAK,CAAC7T,MAAM,CAAC;KAE3B,MAAMkX,YAAY,GAAG,IAAI,CAACjT,aAAa,CAACrC,SAAS,EAAE,CAACqV,qBAAqB,EAAE;KAE3ED,GAAG,IAAIpD,IAAI,CAACC,KAAK,CAACqD,YAAY,CAACF,GAAG,CAAC;KACnCzC,IAAI,IAAIX,IAAI,CAACC,KAAK,CAACqD,YAAY,CAAC3C,IAAI,CAAC;KAErC,OAAO;OAACyC,GAAG;OAAEzC,IAAI;OAAExU,KAAK;OAAEC;MAAO;;;;CAInC;CACA;CACA;GACCmX,QAAQ,GACR;KACC,OAAO;OAAE,GAAG,4CAAI,0BAAUjW,SAAS,EAAE;OAAE,GAAG,4CAAI,4BAAawH,aAAa;MAAI;;;;CAI9E;CACA;CACA;GACC0O,KAAK,GACL;KAAA;KACC,wEAAO,IAAI,+CAAQ,IAAI;;;;CAIzB;CACA;CACA;GACC9T,OAAO,GACP;KACC,+CAAO,IAAI;;;;CAIb;CACA;GACC+T,kBAAkB,GAClB;KACC,MAAM;OAACC;MAAK,GAAG,IAAI,CAACrT,aAAa,CAACsT,sBAAsB,CAAC,IAAI,CAACrN,WAAW,EAAE,CAAC;KAC5E,MAAMsN,WAAW,GAAGjV,QAAQ,CAACC,aAAa,CAAE,mDAAkD8U,IAAK,IAAG,CAAC;KAEvG1U,aAAG,CAACyS,QAAQ,CAACmC,WAAW,EAAE,4CAAI,sBAAQf,kBAAkB,CAAC;;GAG1DgB,kBAAkB,GAClB;KACC,MAAM;OAACH;MAAK,GAAG,IAAI,CAACrT,aAAa,CAACsT,sBAAsB,CAAC,IAAI,CAACrN,WAAW,EAAE,CAAC;KAC5E,MAAMsN,WAAW,GAAGjV,QAAQ,CAACC,aAAa,CAAE,mDAAkD8U,IAAK,IAAG,CAAC;KAEvG1U,aAAG,CAACmL,WAAW,CAACyJ,WAAW,EAAE,4CAAI,sBAAQf,kBAAkB,CAAC;;;;CAI9D;CACA;CACA;GACCrS,aAAa,GACb;KACC,+CAAO,IAAI;;;;CAIb;CACA;;;CAUA;CACA;GACCsT,UAAU,GACV;KACC,IAAI,4CAAI,0BAAU,eAAe,CAAC,EAClC;OACC,IAAI,4CAAI,oBAAW,MAAM,EACzB;SACC9U,aAAG,CAACyS,QAAQ,yCAAC,IAAI,qBAAU,4CAAI,sBAAQmB,YAAY,CAAC;;OAErD,4CAAI,0BAAU,eAAe,CAAC,EAAE;;;;;CAKnC;CACA;CACA;GACCmB,cAAc,CAAC5P,IAAY,EAC3B;KACC,4CAAI,8BAAeA,IAAI;KACvB,IAAI,CAACjD,MAAM,EAAE;;;;CAIf;CACA;CACA;GACC0G,KAAK,CAACoM,IAAa,EACnB;KACC,MAAMC,YAAY,GAAG,EAAE;KAEvB,IAAI,CAAC,4CAAI,0BAAUpY,WAAW,EAAE,EAChC;OACCoY,YAAY,CAAC/J,IAAI,CAAC,IAAI,CAAClM,SAAS,EAAE,CAAC;MACnC,MAED;OACC,MAAMkW,WAAW,GAAG,IAAI,CAACxU,OAAO,EAAE;OAElC,IAAI,CAACW,aAAa,CAAC8T,SAAS,EAAE,CAAC3Q,GAAG,CAACjI,KAAK,IAAI;SAC3C,IAAIA,KAAK,CAACmE,OAAO,EAAE,KAAKwU,WAAW,EACnC;WACCD,YAAY,CAAC/J,IAAI,CAAC3O,KAAK,CAACyC,SAAS,EAAE,CAAC;;QAErC,CAAC;;KAGHiW,YAAY,CAACzQ,GAAG,CAAC,CAACsJ,WAAW,EAAErJ,GAAG,KAAK;OACtC,IAAIuQ,IAAI,EACR;SACC,IAAIC,YAAY,CAAC5P,MAAM,KAAKZ,GAAG,GAAG,CAAC,EACnC;WACCzE,aAAG,CAACyS,QAAQ,CAAC3E,WAAW,EAAE,4CAAI,sBAAQ6F,YAAY,CAAC;;QAEpD,MAED;SACC3T,aAAG,CAACmL,WAAW,CAAC2C,WAAW,EAAE,4CAAI,sBAAQ6F,YAAY,CAAC;;MAEvD,CAAC;;;;CAIJ;CACA;GACCzR,MAAM,GACN;KACC,MAAM4L,WAAW,GAAG,IAAI,CAAC9O,SAAS,EAAE;KACpC,MAAMoW,UAAU,GAAG,EAAE;KACrB,MAAMC,cAAc,GAAG,EAAE;KAEzB,IAAI,CAACzM,KAAK,CAAC,IAAI,CAAC;KAEhB,IAAI,CAAC,4CAAI,0BAAU/L,WAAW,EAAE,EAChC;OACCuY,UAAU,CAAClK,IAAI,CAAC;SACf1H,IAAI,0CAAE,IAAI,eAAM;SAChB2B,IAAI,0CAAE,IAAI,2BAAY;SACtB3I,IAAI,EAAE,IAAI,CAACa,OAAO;QAClB,CAAC;OACFgY,cAAc,CAACnK,IAAI,CAAC,IAAI,CAAC;;;UAI1B;OACC,IAAI,CAAC7J,aAAa,CAAC8T,SAAS,EAAE,CAAC3Q,GAAG,CAACjI,KAAK,IAAI;SAC3C,IACCA,KAAK,CAACmE,OAAO,EAAE,KAAK,IAAI,CAACA,OAAO,EAAE,IAClCnE,KAAK,CAACiF,aAAa,EAAE,KAAK,IAAI,CAACA,aAAa,EAAE,EAE/C;WACC4T,UAAU,CAAClK,IAAI,CAAC;aACf1H,IAAI,EAAEjH,KAAK,CAACmE,OAAO,EAAE;aACrByE,IAAI,EAAE5I,KAAK,CAACiF,aAAa,EAAE;aAC3BhF,IAAI,EAAED,KAAK,CAACc,OAAO;YACnB,CAAC;WACFgY,cAAc,CAACnK,IAAI,CAAC3O,KAAK,CAAC;;QAE3B,CAAC;;KAGH,4CAAI,kBAAM+Y,cAAc,CACvB,IAAI,CAACjU,aAAa,CAACW,cAAc,EAAE,EACnCoT,UAAU,CACV,CAACtK,IAAI,CAACyK,MAAM,IAAI;OAChB,IAAIpO,cAAI,CAACqO,OAAO,CAACD,MAAM,CAAC,EACxB;SACCA,MAAM,CAAC5F,OAAO,CAAC,CAACpT,KAAK,EAAEkZ,CAAC,KAAK;WAC5BJ,cAAc,CAACI,CAAC,CAAC,CAAC1Y,OAAO,CAACR,KAAK,CAACC,IAAI,CAAC;UACrC,CAAC;;OAGH,IAAI,CAACoM,KAAK,CAAC,KAAK,CAAC;OACjB,IAAI,CAACvH,aAAa,CAACqU,cAAc,CAAC,IAAI,CAAC;MACvC,CAAC,CACDxH,KAAK,CAAEyH,QAAQ,IAAK;OACpB3V,aAAG,CAAC4V,MAAM,CAAC9H,WAAW,CAAC;MACvB,CAAC;;;;CAIJ;CACA;GACCrO,UAAU,GACV;KACC,MAAMoW,UAAU,GAAG,4CAAI,oBAASjW,aAAa,CAAC,4CAAI,sBAAQ6T,YAAY,CAAC;;;KAGvEzT,aAAG,CAAC8V,KAAK,CAACD,UAAU,CAAC;KAErB,QAAQ,4CAAI,gBAAO5B,WAAW,EAAE;OAE/B,KAAK,OAAO;OACZ,KAAK,SAAS;OACd,KAAK,MAAM;OACX,KAAK,QAAQ;SACZjU,aAAG,CAACyS,QAAQ,CAACoD,UAAU,EAAE,SAAS,CAAC;;KAGrC,MAAM9H,UAAU,GAAG,4CAAI,0BAAUvQ,cAAc,EAAE;KAEjDwC,aAAG,CAACC,MAAM,CAAC8N,UAAU,EAAE8H,UAAU,CAAC;KAElC7V,aAAG,CAACyS,QAAQ,CAAC1E,UAAU,EAAE,IAAI,GAAG,4CAAI,gBAAOkG,WAAW,EAAE,CAAC;KAEzD,IACC,4CAAI,gBAAOA,WAAW,EAAE,KAAK,YAAY,IACtC,4CAAI,gBAAOA,WAAW,EAAE,KAAK,cAAc,IAC3C,4CAAI,gBAAOA,WAAW,EAAE,KAAK,MAAM,IACnC,4CAAI,gBAAOA,WAAW,EAAE,KAAK,QAAQ,IACrC,4CAAI,gBAAOA,WAAW,EAAE,KAAK,OAAO,IACpC,4CAAI,gBAAOA,WAAW,EAAE,KAAK,SAAS,IACtC,4CAAI,gBAAOA,WAAW,EAAE,KAAK,MAAM,IACnC,4CAAI,gBAAOA,WAAW,EAAE,KAAK,QAAQ,IACrC,4CAAI,gBAAOA,WAAW,EAAE,KAAK,WAAW,IACxC,4CAAI,gBAAOA,WAAW,EAAE,KAAK,aAAa,IAC1C,4CAAI,gBAAOA,WAAW,EAAE,KAAK,MAAM,IACnC,4CAAI,gBAAOA,WAAW,EAAE,KAAK,cAAc,IAC3C,4CAAI,gBAAOA,WAAW,EAAE,KAAK,gBAAgB,IAC7C,4CAAI,gBAAOA,WAAW,EAAE,KAAK,iBAAiB,IAC9C,4CAAI,gBAAOA,WAAW,EAAE,KAAK,kBAAkB,EAEnD;OACClG,UAAU,CAACpJ,KAAK,CAACoR,WAAW,CAAC,SAAS,EAAE,OAAO,CAAC;OAChDhI,UAAU,CAACpJ,KAAK,CAACoR,WAAW,CAAC,UAAU,EAAE,QAAQ,CAAC;OAElD,IAAI,CAAC,IAAI,CAACC,aAAa,EACvB;SACC,IAAI,IAAI,CAACzB,QAAQ,EAAE,CAAC,UAAU,CAAC,EAC/B;WACC,IAAI,CAAC0B,WAAW,GAAGC,UAAU,CAAC,IAAI,CAAC3B,QAAQ,EAAE,CAAC,UAAU,CAAC,CAAC;UAC1D,MAED;WACC,IAAI,CAAC0B,WAAW,GAAG,EAAE;;SAGtB,IAAI,CAACE,YAAY,GAAG,CAAC;WAAEC,YAAY;WAAEC;UAAc,KAAK;WACvD,OAAOA,YAAY,GAAGD,YAAY;UAClC;SAED/Z,6BAAY,CAAC6G,SAAS,CAAC6K,UAAU,CAACuI,UAAU,CAACA,UAAU,EAAE,qBAAqB,EAAGC,KAAK,IAAI;WACzF,IAAIA,KAAK,CAAC/Z,IAAI,CAAC2J,QAAQ,EACvB;aACC,IAAI,CAAC8P,WAAW,GAAGM,KAAK,CAAC/Z,IAAI,CAAC2J,QAAQ;aACtC,IAAI,CAAC6H,UAAU,CAAC;eACf5J,OAAO,EAAEmS,KAAK,CAACC,MAAM,CAAC5W,aAAa,CAAC,qCAAqC,CAAC;eAC1EqO,IAAI,EAAE;cACN,CAAC;;UAEH,CAAC;SAEF,IAAI,CAACD,UAAU,GAAG,CAAC;WAAE5J,OAAO;WAAEqS,OAAO,GAAG,CAAC;WAAExI,IAAI,GAAG,CAAC;WAAEyI,IAAI,GAAG;UAAM,KAAK;WAEtE,IAAI,IAAI,CAACC,kBAAkB,EAC3B;aACCC,YAAY,CAAC,IAAI,CAACD,kBAAkB,CAAC;;WAGtC,IAAIlB,CAAC,GAAGgB,OAAO;WACf,IAAII,QAAQ,GAAG,KAAK;WAEpB,MAAMC,MAAM,GAAG1S,OAAO,CAACkS,UAAU;WAEjC,OAAO,CAACO,QAAQ,IAAIpB,CAAC,IAAI,IAAI,CAACQ,WAAW,EACzC;aACC7R,OAAO,CAACO,KAAK,CAACwB,QAAQ,GAAI,GAAEsP,CAAE,GAAEiB,IAAK,EAAC;aACtCG,QAAQ,GAAG,IAAI,CAACV,YAAY,CAACW,MAAM,CAAC;aACpCrB,CAAC,IAAIxH,IAAI;;WAEV,4CAAI,wCAAqB,GAAEwH,CAAC,GAAGxH,IAAK,GAAEyI,IAAK,EAAC;WAC5CtS,OAAO,CAACO,KAAK,CAACwB,QAAQ,2CAAG,IAAI,qCAAiB;WAE9C,IAAI,CAACwQ,kBAAkB,GAAGvL,UAAU,CAAC,MAAM;aAC1ChH,OAAO,CAACkS,UAAU,CAAC3R,KAAK,CAACoR,WAAW,CAAC,WAAW,EAAE3R,OAAO,CAACO,KAAK,CAACwB,QAAQ,CAAC;aACzE/B,OAAO,CAACO,KAAK,CAACoS,cAAc,CAAC,WAAW,EAAE3S,OAAO,CAACO,KAAK,CAACwB,QAAQ,CAAC;aACjE,4CAAI,4BAAagM,cAAc,yCAAC,IAAI,sCAAkB;YACtD,EAAE,IAAI,CAAC;UACR;SAED,IACC,4CAAI,gBAAO8B,WAAW,EAAE,KAAK,YAAY,IACtC,4CAAI,gBAAOA,WAAW,EAAE,KAAK,cAAc,IAC3C,4CAAI,gBAAOA,WAAW,EAAE,KAAK,WAAW,IACxC,4CAAI,gBAAOA,WAAW,EAAE,KAAK,aAAa,IAC1C,4CAAI,gBAAOA,WAAW,EAAE,KAAK,MAAM,EAEvC;WACC,IAAI,CAACjG,UAAU,CAAC;aACf5J,OAAO,EAAE2J,UAAU;aACnBE,IAAI,EAAE;YACN,CAAC;;SAEH,4CAAI,0BAAU/K,SAAS,CAAC,4CAAI,0BAAUzG,MAAM,CAACC,QAAQ,EAAE,4CAAI,sCAAkByD,IAAI,CAAC,IAAI,CAAC,CAAC;SACxF,4CAAI,0BAAU+C,SAAS,CAAC,4CAAI,0BAAUzG,MAAM,CAACE,kBAAkB,EAAE,4CAAI,0DAA4BwD,IAAI,CAAC,IAAI,CAAC,CAAC;SAC5G,4CAAI,0BAAU+C,SAAS,CAAC,eAAe,EAAE,4CAAI,kCAAgB/C,IAAI,CAAC,IAAI,CAAC,CAAC;SAExE,IAAI,CAAC6V,aAAa,GAAG,IAAI;;OAG1B,4CAAI,IAAI,yCACR;SACC,IAAI,CAAChI,UAAU,CAAC;WACf5J,OAAO,EAAE2J,UAAU;WACnBE,IAAI,EAAE;UACN,CAAC;;;KAIJ,4CAAI,0CAAqB,IAAI;KAE7B,4CAAI,IAAI,iCACR;OACC;;;;KAID,MAAM+I,QAAQ,GAAG,4CAAI,oBAASpX,aAAa,CAAC,4CAAI,sBAAQ8T,UAAU,CAAC;KACnE1T,aAAG,CAAC8V,KAAK,CAACkB,QAAQ,CAAC;;;KAGnB,IAAI,4CAAI,0BAAUla,cAAc,EAAE,EAClC;OACCkD,aAAG,CAACC,MAAM,CAAC,4CAAI,4BAAajB,SAAS,EAAE,EAAEgY,QAAQ,CAAC;;;;KAInDhX,aAAG,CAACC,MAAM,CAAC,4CAAI,0BAAU3C,eAAe,EAAE,EAAE0Z,QAAQ,CAAC;;;KAGrDhX,aAAG,CAACC,MAAM,CAAC,4CAAI,0BAAU1C,eAAe,EAAE,EAAEyZ,QAAQ,CAAC;;;KAGrD,4CAAI,IAAI,iCACR;OACC,IACC,CAAC,kBAAkB,EAAE,cAAc,CAAC,CAACxU,QAAQ,CAAC,4CAAI,gBAAOyR,WAAW,EAAE,CAAC,EAExE;SACC;;OAGD,MAAMgD,UAAU,GAAG,IAAI,CAAC5V,aAAa,CAAC6V,UAAU,EAAE;OAClD,MAAMC,eAAe,GAAGF,UAAU,CAACjW,MAAM,CAAEM,MAAM,IAAK;SACrD,OAAOA,MAAM,CAAC6D,IAAI,GAAG,CAAC;QACtB,CAAC;OAEFnF,aAAG,CAACC,MAAM,CAACwD,IAAE,CAACqB,iBAAiB,CAC9BqS,eAAe,0CACf,IAAI,6BACJ,IAAI,CAACpC,cAAc,CAAC5U,IAAI,CAAC,IAAI,CAAC,CAC9B,EAAE6W,QAAQ,CAAC;;KAGb,4CAAI,kCAAiB,IAAI;;GAG1BI,kBAAkB,GAClB;KACC,+CAAO,IAAI;;;;CAIb;CACA;GACCrZ,qBAAqB,GACrB;KACC,4CAAI,0BAAUA,qBAAqB,EAAE;;;;CAIvC;CACA;GACCC,QAAQ,GACR;KACC,4CAAI,0BAAUA,QAAQ,EAAE;;GAGzB6O,WAAW,CAACrO,KAAa,EAAEoJ,SAAkB,GAAG,IAAI,EACpD;KACC,4CAAI,0BAAUrJ,gBAAgB,CAACC,KAAK,EAAEoJ,SAAS,CAAC;KAChD,4CAAI,4BAAaiF,WAAW,CAACrO,KAAK,CAAC;;;;CAIrC;CACA;GACCP,MAAM,GACN;KACC,4CAAI,0BAAUA,MAAM,EAAE;;;;CAIxB;CACA;GACCC,QAAQ,GACR;KACC,4CAAI,0BAAUA,QAAQ,EAAE;;;;CAI1B;CACA;GACCC,UAAU,GACV;KACC,4CAAI,0BAAUA,UAAU,EAAE;;;;CAI5B;CACA;GACCkU,WAAW,GACX;KACC,4CAAI,4BAAaJ,WAAW,CAC3B,4CAAI,oBAASrS,aAAa,CAAC,4CAAI,sBAAQ6T,YAAY,CAAC,CACpD;;;;CAIH;CACA;GACC4D,kBAAkB,GAClB;KACC,MAAMvJ,WAAW,GAAG,IAAI,CAAC9O,SAAS,EAAE;KACpC,MAAMsY,cAAc,GAAG,IAAI,CAACjW,aAAa,CAACrC,SAAS,EAAE,CAACe,aAAa;KACnE,MAAMwX,kBAAkB,GAAGD,cAAc,CAACjD,qBAAqB,EAAE;KACjE,MAAMmD,YAAY,GAAG1J,WAAW,CAAClO,aAAa,CAAC,mCAAmC,CAAC;KAEnF,IAAI4X,YAAY,EAChB;OACC,MAAMC,gBAAgB,GAAGD,YAAY,CAACnD,qBAAqB,EAAE;OAC7D,MAAMqD,UAAU,GAAGxB,UAAU,CAACyB,gBAAgB,CAACH,YAAY,CAAC,CAACE,UAAU,CAAC;OAExE,IAAIH,kBAAkB,CAACK,CAAC,IAAIH,gBAAgB,CAACG,CAAC,EAC9C;SACCJ,YAAY,CAAC7S,KAAK,CAAC+S,UAAU,GAAGH,kBAAkB,CAACK,CAAC,GAAGH,gBAAgB,CAACG,CAAC,GAAGF,UAAU,GAAG,IAAI;QAC7F,MAED;SACCF,YAAY,CAAC7S,KAAK,CAAC+S,UAAU,GAAG,CAAC;;;;;;CAMrC;CACA;GACCtZ,SAAS,GACT;KACC,4CAAI,oBAASwB,aAAa,CAAC,0BAA0B,CAAC,CAACiY,KAAK,EAAE;;;;CAIhE;CACA;;GAkCCjC,MAAM,GACN;KACC,4CAAI,IAAI,yCACR;OACC,4CAAI,wCAAmB,IAAI;;KAE5B,4CAAI,oBAASkC,MAAM,GAAG,IAAI;KAC1B,IAAI,CAAC5Z,QAAQ,EAAE;;;CAUjB;CACA;CACA;GACC6Z,SAAS,GACT;KACC,OAAO,4CAAI,oBAASD,MAAM,KAAK,IAAI;;GA6BpCzH,cAAc,CAACD,KAAa,EAC5B;KACC,4CAAI,8BAAeA,KAAK;;CAE1B;CAAC,qBA5eA;GACC,4CAAI,IAAI,uCACR;KACC,4CAAI,sCAAkB,IAAI;;CAE5B;CAAC,0BAgZD;GACC,4CAAI,sBAAW3M,IAAE,CAACmB,cAAc,CAAC;KAChC3G,MAAM,EAAG0C,KAAK,IAAK;OAClB,IAAI,CAAClB,UAAU,EAAE;OACjB,IAAI,CAAC4B,aAAa,CAAC2W,gBAAgB,EAAE;OACrC,IAAI,CAAC3W,aAAa,CAAC4W,cAAc,EAAE;OACnC,IAAI,CAAC5W,aAAa,CAAC6W,aAAa,CAAC,KAAK,CAAC;OACvC,IAAI,CAACja,MAAM,EAAE;OAEb+B,aAAG,CAACmL,WAAW,yCAAC,IAAI,qBAAU,4CAAI,sBAAQyI,YAAY,CAAC;OAEvDjT,KAAK,CAACC,eAAe,EAAE;MACvB;KACD1C,QAAQ,EAAE,4CAAI,wCAAmBiC,IAAI,CAAC,IAAI;IAC1C,CAAC;GACF,MAAMgY,eAAe,GAAGxY,QAAQ,CAACyY,IAAI,CAACxY,aAAa,CAAC,uBAAuB,CAAC;GAC5E,MAAM0X,cAAc,GAAG,IAAI,CAACjW,aAAa,CAACrC,SAAS,EAAE;GACrD,MAAMuY,kBAAkB,GAAGD,cAAc,CAACjD,qBAAqB,EAAE;GACjE,MAAMgE,YAAY,GAAG,4CAAI,0BAAUnb,gBAAgB,EAAE;GACrD,MAAMiX,QAAQ,GAAG;KAChBC,GAAG,EAAEpD,IAAI,CAACsH,GAAG,CAACH,eAAe,CAACI,SAAS,GAAGJ,eAAe,CAACK,YAAY,GAAG,CAAC,EAAEjB,kBAAkB,CAACna,MAAM,GAAGib,YAAY,CAACjb,MAAM,CAAC;KAC5HuU,IAAI,EAAE4F,kBAAkB,CAACpa,KAAK,GAAG,CAAC,GAAG;IACrC;GAED,IAAI,IAAI,CAACkE,aAAa,CAACoX,UAAU,CAACtE,QAAQ,CAACC,GAAG,EAAED,QAAQ,CAACC,GAAG,GAAGiE,YAAY,CAACjb,MAAM,CAAC,EACnF;KACC+W,QAAQ,CAACC,GAAG,IAAIiE,YAAY,CAACjb,MAAM,GAAG,IAAI,CAACiE,aAAa,CAACqX,WAAW,EAAE;;GAGvE,IAAI,CAACxE,WAAW,CAACC,QAAQ,CAAC;CAC3B;CAAC,4BAYiBxT,KAAK,EACvB;GACC,IAAI,CAACiV,MAAM,EAAE;GACbjV,KAAK,CAACC,eAAe,EAAE;CACxB;CAAC,6BAYD;GACC,MAAMiD,OAAO,2CAAG,IAAI,yBAAS;GAC7B,IAAI,EAAEA,OAAO,YAAYC,IAAI,CAAC,EAC9B;KACC;;GAGD,IAAI,CAACkK,UAAU,CAAC;KAAE5J,OAAO,EAAEP,OAAO,CAACoJ,YAAY,EAAE;KAAEgB,IAAI,EAAE;IAAK,CAAC;CAChE;CAAC,qCAE0BtN,KAAK,EAChC;GAAA;GACC,IAAI,CAACtC,IAAI,CAAC,IAAI,CAAC5B,MAAM,CAACE,kBAAkB,EAAE;KAAE6B,KAAK,sDAAE,4CAAI,0BAAUF,SAAS,EAAE,qBAAzB,uBAA2BE,KAAK,qCAAI;IAAM,CAAC;GAC9F,MAAMA,KAAK,uDAAG,4CAAI,0BAAUF,SAAS,EAAE,qBAAzB,uBAA2BE,KAAK,qCAAI,IAAI;GACtD,IAAI2I,cAAI,CAAC6M,QAAQ,CAACxV,KAAK,CAAC,EACxB;KACC,4CAAI,4BAAaqO,WAAW,CAACrO,KAAK,CAAC;;CAErC;CAAC,yBAEcmC,KAAuB,EACtC;GACC,IAAI,CAACtC,IAAI,CAAC,eAAe,EAAEsC,KAAK,CAAC;CAClC;;CC3sBqB;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAMtB,CAAe,MAAMgY,MAAM,CAC3B;;CAqBA;CACA;CACA;GACCrc,WAAW,CAACuI,OAAsB,EAClC;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAXS;SACR+T,eAAe,EAAE,qCAAqC;SACtDC,aAAa,EAAE,6BAA6B;SAC5CjF,YAAY,EAAE;;;KASd,IAAI,CAACzM,cAAI,CAAC2R,SAAS,CAACjU,OAAO,CAACkU,aAAa,CAAC,EAC1C;OACC,MAAM,IAAIhF,KAAK,CAAC,6DAA6D,CAAC;;KAG/E,4CAAI,0BAAWtQ,IAAE,CAACmC,aAAa,EAAE;KACjC,4CAAI,oCAAkBf,OAAO,CAACkU,aAAa;KAC3ChS,eAAK,CAAC5G,IAAI,yCAAC,IAAI,yBAAU,OAAO,EAAE,4CAAI,0BAAUA,IAAI,CAAC,IAAI,CAAC,CAAC;KAE3D,4CAAI;KACJ,4CAAI;;;;CAIN;CACA;CACA;GACCnB,SAAS,GACT;KACC,+CAAO,IAAI;;;;CAIb;CACA;CACA;GACC6B,IAAI,CAACtE,KAAY,EACjB;KACC,IAAI,4CAAI,kCAAkBA,KAAK,EAC/B;OACC;;KAGD,MAAMyc,SAAS,GAAGzc,KAAK,CAACyC,SAAS,EAAE,CAACqV,qBAAqB,EAAE;KAC3D,4CAAI,wBAAS1P,KAAK,CAACsU,OAAO,GAAG,OAAO;KAEpC,4CAAI,IAAI,mCACR;OACC,4CAAI,kCAAgB/G,eAAe,CAAC,aAAa,CAAC;;KAEnD,4CAAI,gCAAgB3V,KAAK;KACzB,4CAAI,oCAAkBA,KAAK,CAACyC,SAAS,EAAE;KACvC,4CAAI,kCAAgBka,YAAY,CAAC,aAAa,EAAE,CAAC,CAAC;KAClD,MAAMC,iBAAiB,GAAG,4CAAI,kCAAgB9E,qBAAqB,EAAE;KACrE5Q,IAAE,CAACU,OAAO,yCAAC,IAAI,yBAAU;OACxBiQ,GAAG,EAAE4E,SAAS,CAAC5E,GAAG,GAAG+E,iBAAiB,CAAC/E,GAAG;OAC1CzC,IAAI,EAAEqH,SAAS,CAACrH,IAAI,GAAGwH,iBAAiB,CAACxH,IAAI;OAC7CxU,KAAK,EAAE6b,SAAS,CAAC7b,KAAK,GAAGwb,MAAM,CAACS,WAAW;OAC3Chc,MAAM,EAAE4b,SAAS,CAAC5b,MAAM,GAAGub,MAAM,CAACS;MAClC,CAAC;;GAGHC,oBAAoB,CAACC,aAA0B,EAC/C;KACC,4CAAI,4CAAsBA,aAAa;;;;CAIzC;CACA;GACCnW,IAAI,GACJ;KACC,4CAAI,gCAAgB,IAAI;KACxB,4CAAI,wBAASwB,KAAK,CAACsU,OAAO,GAAG,MAAM;KAEnC,4CAAI,IAAI,mCACR;OACC,4CAAI,kCAAgB/G,eAAe,CAAC,aAAa,CAAC;;;;;CAKrD;CACA;CACA;GACCqH,cAAc,GACd;KACC,+CAAO,IAAI;;;;CAIb;CACA;CA4VA;CAAC,qBA3VSC,CAAC,EACV;GACC,IAAI,IAAI,CAACC,MAAM,IAAI,IAAI,CAACC,QAAQ,EAChC;KACC;;GAGD,4CAAI,IAAI,+BACR;KACC,4CAAI,8BAAc5E,UAAU,EAAE;;CAEhC;CAAC,wBAMD;GACC,IAAI6E,WAAW,GAAG,IAAI;GAEtB,MAAMC,SAAS,GAAG,IAAIC,kCAAS,CAAC;KAC/BC,SAAS,0CAAE,IAAI,iCAAe;KAC9BF,SAAS,EAAE,4CAAI,sBAAQhB,eAAe;KACtCxO,IAAI,EAAEvL,EAAE,CAAC4E,EAAE,CAACsW,WAAW,CAACF,SAAS,CAACG;IAClC,CAAC;GAEF,IAAI,CAACC,UAAU,GAAG;KACjBC,OAAO,EAAE,IAAI;KACbrW,OAAO,EAAE;IACT;GAED+V,SAAS,CACP1W,SAAS,CAAC,OAAO,EAAGvC,KAAqB,IAAK;KAC9C,IAAI,4CAAI,wBAAS6R,YAAY,CAAC,cAAc,CAAC,EAC7C;OACC;;KAGD,IAAI,CAAC,IAAI,CAACyH,UAAU,CAACC,OAAO,IAAI,CAAC,IAAI,CAACD,UAAU,CAACpW,OAAO,EACxD;OACC,IAAI,CAACoW,UAAU,GAAG;SACjBC,OAAO,EAAE,4CAAI,8BAAclb,SAAS,EAAE;SACtC6E,OAAO,EAAE,4CAAI,8BAAc7E,SAAS,EAAE,CAACY,aAAa,CAAC,+BAA+B;QACpF;;KAGFvD,6BAAY,CAACgC,IAAI,CAAC,qBAAqB,EAAEub,SAAS,CAAC;KACnDD,WAAW,GAAG,4CAAI,wBAAStF,qBAAqB,EAAE;KAClD,4CAAI,8BAActW,qBAAqB,EAAE;KACzC,IAAI,CAACoc,YAAY,GAAG,IAAI;KAExBna,aAAG,CAACmL,WAAW,CAAC,4CAAI,8BAAcnM,SAAS,EAAE,EAAE,4CAAI,sBAAQ4U,YAAY,CAAC;IACxE,CAAC,CACD1Q,SAAS,CAAC,KAAK,EAAGvC,KAAmB,IAAK;KAE1CyK,UAAU,CAAC,MAAM;OAChB,IAAI,CAACsO,QAAQ,GAAG,KAAK;MACrB,EAAE,CAAC,CAAC;IAEL,CAAC,CACDxW,SAAS,CAAC,MAAM,EAAGvC,KAAK,IAAK;KAE7B,IAAI,4CAAI,wBAAS6R,YAAY,CAAC,cAAc,CAAC,EAC7C;OACC;;KAGD,IAAI,CAACkH,QAAQ,GAAG,IAAI;KAEpB,IAAI/H,IAAI,GAAG,IAAI;KACf,IAAIyC,GAAG,GAAG,IAAI;KACd,IAAIgG,YAAY,GAAG,KAAK;KACxB,IAAI;OAACjd,KAAK;OAAEC;MAAO,GAAGuc,WAAW;KAEjC,MAAMnd,IAAI,GAAGmE,KAAK,CAACtD,OAAO,EAAE;KAC5B,MAAMgd,QAAQ,GAAG,4CAAI,wBAAShG,qBAAqB,EAAE;KACrD,MAAMiG,WAAW,GAAG,4CAAI,kCAAgBjG,qBAAqB,EAAE;KAE/D,IAAIrU,aAAG,CAACua,QAAQ,CAAC/d,IAAI,CAACod,SAAS,EAAE,0CAA0C,CAAC,EAC5E;OACCjI,IAAI,GAAGX,IAAI,CAACwJ,GAAG,CAAC,CAAC,EAAEb,WAAW,CAAChI,IAAI,GAAGnV,IAAI,CAACie,OAAO,GAAGH,WAAW,CAAC3I,IAAI,CAAC;OACtEyC,GAAG,GAAGpD,IAAI,CAACwJ,GAAG,CAAC,CAAC,EAAEb,WAAW,CAACvF,GAAG,GAAG5X,IAAI,CAACke,OAAO,GAAGJ,WAAW,CAAClG,GAAG,CAAC;OACnEjX,KAAK,GAAGwc,WAAW,CAACxc,KAAK,GAAGX,IAAI,CAACie,OAAO;OACxCrd,MAAM,GAAGuc,WAAW,CAACvc,MAAM,GAAGZ,IAAI,CAACke,OAAO;;KAG3C,IAAI1a,aAAG,CAACua,QAAQ,CAAC/d,IAAI,CAACod,SAAS,EAAE,4CAA4C,CAAC,EAC9E;OACCxF,GAAG,GAAGpD,IAAI,CAACwJ,GAAG,CAAC,CAAC,EAAEb,WAAW,CAACvF,GAAG,GAAG5X,IAAI,CAACke,OAAO,GAAGJ,WAAW,CAAClG,GAAG,CAAC;OACnEhX,MAAM,GAAGuc,WAAW,CAACvc,MAAM,GAAGZ,IAAI,CAACke,OAAO;;KAG3C,IAAI1a,aAAG,CAACua,QAAQ,CAAC/d,IAAI,CAACod,SAAS,EAAE,2CAA2C,CAAC,EAC7E;OACCxF,GAAG,GAAGpD,IAAI,CAACwJ,GAAG,CAAC,CAAC,EAAEb,WAAW,CAACvF,GAAG,GAAG5X,IAAI,CAACke,OAAO,GAAGJ,WAAW,CAAClG,GAAG,CAAC;OACnEjX,KAAK,GAAGwc,WAAW,CAACxc,KAAK,GAAGX,IAAI,CAACie,OAAO;OACxCrd,MAAM,GAAGuc,WAAW,CAACvc,MAAM,GAAGZ,IAAI,CAACke,OAAO;;KAG3C,IAAI1a,aAAG,CAACua,QAAQ,CAAC/d,IAAI,CAACod,SAAS,EAAE,8CAA8C,CAAC,EAChF;OACCzc,KAAK,GAAGwc,WAAW,CAACxc,KAAK,GAAGX,IAAI,CAACie,OAAO;;KAGzC,IAAIza,aAAG,CAACua,QAAQ,CAAC/d,IAAI,CAACod,SAAS,EAAE,8CAA8C,CAAC,EAChF;OACCzc,KAAK,GAAGwc,WAAW,CAACxc,KAAK,GAAGX,IAAI,CAACie,OAAO;OACxCrd,MAAM,GAAGuc,WAAW,CAACvc,MAAM,GAAGZ,IAAI,CAACke,OAAO;OAC1CN,YAAY,GAAG,IAAI;;KAGpB,IAAIpa,aAAG,CAACua,QAAQ,CAAC/d,IAAI,CAACod,SAAS,EAAE,+CAA+C,CAAC,EACjF;OACCxc,MAAM,GAAGuc,WAAW,CAACvc,MAAM,GAAGZ,IAAI,CAACke,OAAO;OAC1CN,YAAY,GAAG,IAAI;;KAGpB,IAAIpa,aAAG,CAACua,QAAQ,CAAC/d,IAAI,CAACod,SAAS,EAAE,6CAA6C,CAAC,EAC/E;OACCjI,IAAI,GAAGgI,WAAW,CAAChI,IAAI,GAAGnV,IAAI,CAACie,OAAO,GAAGH,WAAW,CAAC3I,IAAI;OACzDxU,KAAK,GAAGwc,WAAW,CAACxc,KAAK,GAAGX,IAAI,CAACie,OAAO;OACxCrd,MAAM,GAAGuc,WAAW,CAACvc,MAAM,GAAGZ,IAAI,CAACke,OAAO;OAC1CN,YAAY,GAAG,IAAI;;KAGpB,IAAIpa,aAAG,CAACua,QAAQ,CAAC/d,IAAI,CAACod,SAAS,EAAE,6CAA6C,CAAC,EAC/E;OACCjI,IAAI,GAAGgI,WAAW,CAAChI,IAAI,GAAGnV,IAAI,CAACie,OAAO,GAAGH,WAAW,CAAC3I,IAAI;OACzDxU,KAAK,GAAGwc,WAAW,CAACxc,KAAK,GAAGX,IAAI,CAACie,OAAO;;KAGzC,IAAItd,KAAK,GAAG,EAAE,IAAIC,MAAM,GAAG,EAAE,EAC7B;OACC;;KAGD,MAAMud,WAAW,GAAG;OAAExd,KAAK;OAAEC;MAAQ;KAErC,IAAIud,WAAW,CAAC,OAAO,CAAC,GAAGN,QAAQ,CAAC1I,IAAI,GAAG2I,WAAW,CAAC3I,IAAI,GAAG2I,WAAW,CAACnd,KAAK,EAC/E;OACCA,KAAK,GAAGwd,WAAW,CAAC,OAAO,CAAC,GAAGL,WAAW,CAACnd,KAAK,GAAGmd,WAAW,CAAC3I,IAAI,GAAG0I,QAAQ,CAAC1I,IAAI;;KAGpF,IAAIgJ,WAAW,CAAC,QAAQ,CAAC,GAAGN,QAAQ,CAACjG,GAAG,GAAGkG,WAAW,CAAClG,GAAG,GAAGkG,WAAW,CAACld,MAAM,EAC/E;OACCA,MAAM,GAAGud,WAAW,CAAC,QAAQ,CAAC,GAAGL,WAAW,CAACld,MAAM,GAAGkd,WAAW,CAAClG,GAAG,GAAGiG,QAAQ,CAACjG,GAAG;;KAGrF,IAAIzC,IAAI,EACR;OACC,IAAIA,IAAI,GAAG,CAAC,EACZ;SACCA,IAAI,GAAG,CAAC;;OAETgJ,WAAW,CAAC,MAAM,CAAC,GAAGhJ,IAAI;;KAE3B,IAAIyC,GAAG,EACP;OACCuG,WAAW,CAAC,KAAK,CAAC,GAAGvG,GAAG;;KAGzB,IAAIwG,YAAY,GAAGjB,WAAW,CAACvF,GAAG;KAClC,IAAIyG,iBAAiB,GAAG,IAAI;KAC5B,IAAIF,WAAW,CAACvG,GAAG,EACnB;OACCwG,YAAY,GAAGD,WAAW,CAACvG,GAAG;OAC9ByG,iBAAiB,GAAG,KAAK;;KAG1B,IAAI,4CAAI,8BAAcxZ,aAAa,CAACoX,UAAU,CAACmC,YAAY,EAAEA,YAAY,GAAGD,WAAW,CAACvd,MAAM,EAAEyd,iBAAiB,CAAC,EAClH;OACC,IAAI,CAACT,YAAY,EACjB;SACC,4CAAI,8BAAc3F,kBAAkB,EAAE;;OAEvC;;KAGD,MAAMqG,iBAAiB,GAAGxW,MAAM,CAACpC,MAAM,CAAC,EAAE,EAAE;OAC3C,GAAGyY,WAAW;OACdxd,KAAK,EAAEA,KAAK,GAAGwb,MAAM,CAACS,WAAW;OACjChc,MAAM,EAAEA,MAAM,GAAGub,MAAM,CAACS;MACxB,CAAC;KAEF3V,IAAE,CAACU,OAAO,yCAAC,IAAI,yBAAUwW,WAAW,CAAC;KACrClX,IAAE,CAACU,OAAO,yCAAC,IAAI,mCAAiB2W,iBAAiB,CAAC;KAElD,4CAAI,8BAAcrb,UAAU,EAAE;KAC9B,4CAAI,8BAAc4B,aAAa,CAAC6W,aAAa,CAAC,KAAK,CAAC;KACpD,4CAAI,8BAAcb,kBAAkB,EAAE;IACtC,CAAC;CACJ;CAAC,sBAMD;GACC,MAAM0D,QAAQ,2CAAG,IAAI,iCAAe;GACpC,IAAIC,cAAc;GAElB,MAAMpB,SAAS,GAAG,IAAIC,kCAAS,CAAC;KAC/BC,SAAS,EAAEiB,QAAQ;KACnBnB,SAAS,EAAE,4CAAI,sBAAQf,aAAa;KACpCzO,IAAI,EAAEyP,kCAAS,CAACG;IAChB,CAAC;GAEFJ,SAAS,CACP1W,SAAS,CAAC,OAAO,EAAGvC,KAAqB,IAAK;KAE9C,IAAI,4CAAI,wBAAS6R,YAAY,CAAC,cAAc,CAAC,EAC7C;OACC;;KAGDnW,6BAAY,CAACgC,IAAI,CAAC,mBAAmB,EAAEub,SAAS,CAAC;KAEjD,IAAI,IAAI,CAACF,QAAQ,EACjB;OACC;;KAGD,MAAM;OAACuB;MAAO,GAAGta,KAAK,CAACtD,OAAO,EAAE;KAChC,IAAI,CAAC8W,QAAQ,GAAGnU,aAAG,CAACsH,WAAW,CAAC2T,MAAM,CAAC;KACvC,4CAAI,8BAAcld,qBAAqB,EAAE;KACzC,IAAI,CAACoc,YAAY,GAAG,IAAI;KAExBna,aAAG,CAACmL,WAAW,CAAC,4CAAI,8BAAcnM,SAAS,EAAE,EAAE,4CAAI,sBAAQ4U,YAAY,CAAC;IACxE,CAAC,CACD1Q,SAAS,CAAC,KAAK,EAAGvC,KAAmB,IAAK;KAE1CyK,UAAU,CAAC,MAAM;OAChB,IAAI,CAACqO,MAAM,GAAG,KAAK;MACnB,EAAE,CAAC,CAAC;KAEL,IAAI,yCAAC,IAAI,6BAAa,EACtB;OACC;;KAGD,IAAI,IAAI,CAACC,QAAQ,EACjB;OACC;;KAGDsB,cAAc,GAAG,IAAI;KAErB,MAAMxe,IAAI,GAAGmE,KAAK,CAACtD,OAAO,EAAE;KAC5B,IAAI6d,YAAY,GAAG,IAAI;KACvB,IAAI,IAAI,CAACf,YAAY,EACrB;OACCe,YAAY,GAAG,4CAAI,8BAAc7Z,aAAa,CAACoX,UAAU,CAAC,IAAI,CAAC0B,YAAY,CAAC/F,GAAG,EAAE,IAAI,CAAC+F,YAAY,CAAC/F,GAAG,GAAG,IAAI,CAAC+F,YAAY,CAAC/c,MAAM,CAAC;;KAGnI,4CAAI,8BAAcyX,kBAAkB,EAAE;KAEtC,IAAIqG,YAAY,EAChB;OACCzX,IAAE,CAACU,OAAO,CAAC3H,IAAI,CAACye,MAAM,EAAE;SAAC7G,GAAG,EAAE,IAAI,CAAC+F,YAAY,CAAC/F,GAAG,GAAG8G;QAAa,CAAC;OACpEzX,IAAE,CAACU,OAAO,yCAAC,IAAI,mCAAiB;SAACiQ,GAAG,EAAE,IAAI,CAAC+F,YAAY,CAAC/F,GAAG,GAAG8G;QAAa,CAAC;;IAE7E,CAAC,CACDhY,SAAS,CAAC,MAAM,EAAGvC,KAAoB,IAAK;KAE5C,IAAI,4CAAI,wBAAS6R,YAAY,CAAC,cAAc,CAAC,EAC7C;OACC;;KAGD,IAAI,IAAI,CAACkH,QAAQ,EACjB;OACC;;KAGD,IAAI,CAACD,MAAM,GAAG,IAAI;KAElB,MAAMjd,IAAI,GAAGmE,KAAK,CAACtD,OAAO,EAAE;KAC5B,MAAM;OAAC4d,MAAM;OAAEP,OAAO;OAAED;MAAQ,GAAGje,IAAI;KACvC,MAAM6d,QAAQ,GAAG7d,IAAI,CAACye,MAAM,CAAC5G,qBAAqB,EAAE;KACpD,MAAMiG,WAAW,GAAG,4CAAI,kCAAgBjG,qBAAqB,EAAE;KAE/D,IAAI,IAAI,CAACF,QAAQ,EACjB;OACC,MAAMwG,WAAW,GAAG;SACnBvG,GAAG,EAAEsG,OAAO,GAAGJ,WAAW,CAAClG,GAAG,GAAG,IAAI,CAACD,QAAQ,CAACgH,CAAC;SAChDxJ,IAAI,EAAE8I,OAAO,GAAGH,WAAW,CAAC3I,IAAI,GAAG,IAAI,CAACwC,QAAQ,CAACyD,CAAC;SAClDza,KAAK,EAAE6d,cAAc,GAAGA,cAAc,GAAG,IAAI,CAAC7G,QAAQ,CAAChX,KAAK;SAC5DC,MAAM,EAAE,IAAI,CAAC+W,QAAQ,CAAC/W;QACtB;OAED,IAAIud,WAAW,CAAChJ,IAAI,GAAG,CAAC,EACxB;SACCgJ,WAAW,CAAChJ,IAAI,GAAG,CAAC;;OAErB,IAAIgJ,WAAW,CAACvG,GAAG,GAAG,CAAC,EACvB;SACCuG,WAAW,CAACvG,GAAG,GAAG,CAAC;;OAEpB,IAAIuG,WAAW,CAACvG,GAAG,GAAGiG,QAAQ,CAACjd,MAAM,GAAGkd,WAAW,CAACld,MAAM,EAC1D;SACCud,WAAW,CAACvG,GAAG,GAAGkG,WAAW,CAACld,MAAM,GAAGid,QAAQ,CAACjd,MAAM;;OAEvD,IAAIud,WAAW,CAAChJ,IAAI,GAAG0I,QAAQ,CAACld,KAAK,GAAGmd,WAAW,CAACnd,KAAK,EACzD;SACC,4CAAI,8BAAcsC,UAAU,EAAE;SAC9B,IAAI6a,WAAW,CAACnd,KAAK,GAAGwd,WAAW,CAAChJ,IAAI,GAAG,EAAE,EAC7C;WACCqJ,cAAc,GAAGL,WAAW,CAACxd,KAAK,GAAGmd,WAAW,CAACnd,KAAK,GAAGwd,WAAW,CAAChJ,IAAI;UACzE,MAED;WACCgJ,WAAW,CAAChJ,IAAI,GAAG2I,WAAW,CAACnd,KAAK,GAAGkd,QAAQ,CAACld,KAAK;;;OAIvD,IAAI,CAACgd,YAAY,GAAG7V,MAAM,CAACpC,MAAM,CAAC,EAAE,EAAEyY,WAAW,CAAC;OAElD,IAAIO,YAAY,GAAG,IAAI;OAEvB,IAAI,IAAI,CAACf,YAAY,EACrB;SACCe,YAAY,GAAG,4CAAI,8BAAc7Z,aAAa,CAACoX,UAAU,CAAC,IAAI,CAAC0B,YAAY,CAAC/F,GAAG,EAAE,IAAI,CAAC+F,YAAY,CAAC/F,GAAG,GAAG,IAAI,CAAC+F,YAAY,CAAC/c,MAAM,CAAC;;OAGnI,IAAI8d,YAAY,GAAG,CAAC,EACpB;SACC,4CAAI,8BAAczG,kBAAkB,EAAE;QACtC,MAED;SACC,4CAAI,8BAAcI,kBAAkB,EAAE;;OAGvC,MAAMiG,iBAAiB,GAAGxW,MAAM,CAACpC,MAAM,CAAC,EAAE,EAAE;SAC3C,GAAGyY,WAAW;SACdxd,KAAK,EAAEwd,WAAW,CAACxd,KAAK,GAAGwb,MAAM,CAACS,WAAW;SAC7Chc,MAAM,EAAEud,WAAW,CAACvd,MAAM,GAAGub,MAAM,CAACS;QACpC,CAAC;OAEF3V,IAAE,CAACU,OAAO,CAAC8W,MAAM,EAAEN,WAAW,CAAC;OAC/BlX,IAAE,CAACU,OAAO,yCAAC,IAAI,mCAAiB2W,iBAAiB,CAAC;OAElD,4CAAI,8BAAczZ,aAAa,CAAC6W,aAAa,CAAC,KAAK,CAAC;OACpD,4CAAI,8BAAcb,kBAAkB,EAAE;;IAEvC,CAAC;CACJ;CAxcoBsB,MAAM,CAEnBS,WAAW,GAAG,CAAC;;CCKvB,MAAMgC,SAAS,GAAG,CAAC;CACnB,MAAMC,eAAe,GAAG,EAAE;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAO3B,CAAO,MAAMC,aAAa,CAC1B;;CAgCA;CACA;CACA;GACChf,WAAW,CAACuI,OAAwB,EACpC;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OA7B0B;;KAAC;OAAA;OAAA;;KAAA;OAAA;OAAA,OAEE;;KAAK;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAImC;;KAAE;OAAA;OAAA,OAC/C;;KAAE;OAAA;OAAA,OACkD;SAC3E0W,gBAAgB,EAAE,IAAIC,GAAG,EAAE;SAC3BC,yBAAyB,EAAE,IAAID,GAAG,EAAE;SACpCE,4BAA4B,EAAE,IAAIF,GAAG;;;KACrC;OAAA;OAAA,OAC6B;;KAAE;OAAA;OAAA,OACO;;KAAE;OAAA;OAAA;;KAAA;OAAA;OAAA,OAErB;;KAAsB;OAAA;OAAA,OACd;;KAAU;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAGV,IAAIhb,eAAK,CAACC,WAAW;;KAAE,KACnDuO,cAAc,GAAY,KAAK;KAAA,KAC/BI,uBAAuB,GAAiC,IAAI;KAQ3D,MAAM;OAAEkI,cAAc;OAAEqE,WAAW;OAAE3M,cAAc;OAAEI;MAAyB,GAAGvK,OAAO;KACxF,IAAI,CAACmK,cAAc,GAAG4M,OAAO,CAAC5M,cAAc,CAAC;KAC7C,IAAI,CAACI,uBAAuB,GAAGA,uBAAuB;KACtD,4CAAI,sCAAmBkI,cAAc;KACrC,4CAAI,gCAAgBqE,WAAW;KAC/B,IAAI,yCAAC,IAAI,6BAAa,EACtB;OACC,IAAI,CAACE,UAAU,GAAG,IAAIlD,MAAM,CAAC;SAAEI,aAAa,0CAAE,IAAI;QAAkB,CAAC;OACrE/Y,aAAG,CAACC,MAAM,CAAC,IAAI,CAAC4b,UAAU,CAAC7c,SAAS,EAAE,0CAAE,IAAI,oCAAiB;;KAG9D+H,eAAK,CAAC5G,IAAI,CAACmX,cAAc,EAAE,OAAO,EAAE,CAAC;OAAEd;MAAQ,KAAK;OACnD,MAAMsF,eAAe,GAAGtF,MAAM,CAACuF,OAAO,CAAC,+BAA+B,CAAC,IACtEvF,MAAM,CAACuF,OAAO,CAAC,6BAA6B,CAAC;OAC9C,IAAID,eAAe,EACnB;SACC;;OAGD,MAAME,WAAW,GAAG,IAAI,CAACH,UAAU,CAACtC,cAAc,EAAE;OACpDyC,WAAW,oBAAXA,WAAW,CAAE7d,UAAU,EAAE;MACzB,CAAC;KACF,4CAAI,4BAAc0G,OAAO,CAAC+J,SAAS;KACnC,4CAAI,oBAAQ,IAAI3F,eAAG,EAAE;KACrB,4CAAI,4CAAsB;OACzB9L,KAAK,EAAE,CAAC;OACRC,MAAM,EAAE;MACR;;GAGF6e,aAAa,GACb;KACC,IAAI7H,GAAG,GAAG,CAAC;KACX,MAAM8H,KAAK,GAAG,CAAC,GAAG,4CAAI,oCAAiB5J,gBAAgB,CAAC,iCAAiC,CAAC,CAAC;KAC3F,4CAAI,8BAAe,EAAE;KACrB,4CAAI,oBAAU,EAAE;KAChB,MAAMzO,OAAO,GAAGlE,QAAQ,CAACC,aAAa,CAAC,uBAAuB,CAAC;KAC/Dsc,KAAK,CAACvM,OAAO,CAAC+E,IAAI,IAAI;OACrB,MAAMyH,QAAQ,GAAGzH,IAAI,CAACL,qBAAqB,EAAE;OAC7C,MAAM+H,cAAc,GAAG,EAAE;;;OAGzB,KAAK,IAAIC,WAAW,IAAIF,QAAQ,EAChC;SACC,IAAIhV,cAAI,CAACmV,QAAQ,CAACH,QAAQ,CAACE,WAAW,CAAC,CAAC,EACxC;WACCD,cAAc,CAACC,WAAW,CAAC,GAAGrL,IAAI,CAACC,KAAK,CAACkL,QAAQ,CAACE,WAAW,CAAC,CAAC;UAC/D,MAED;WACCD,cAAc,CAACC,WAAW,CAAC,GAAGF,QAAQ,CAACE,WAAW,CAAC;;;OAIrD,MAAME,QAAQ,GAAGnI,GAAG,KAAK,CAAC,GAAG,CAAC,GAAGgI,cAAc,CAAChI,GAAG,GAAGiH,eAAe,GAAGxX,OAAO,CAAC0U,SAAS;OACzF,MAAMiE,WAAW,GAAGJ,cAAc,CAAChI,GAAG,GAAGgH,SAAS,GAAGvX,OAAO,CAAC0U,SAAS;;OAEtE,4CAAI,kBAAQrN,IAAI,CAAC,CAACqR,QAAQ,EAAEC,WAAW,CAAC,CAAC;;;OAGzC,IAAIpI,GAAG,KAAK,CAAC,EACb;SACCA,GAAG,GAAGgI,cAAc,CAAChI,GAAG;QACxB,MAED;SACCA,GAAG,IAAIiH,eAAe;SACtBe,cAAc,CAAChI,GAAG,GAAGA,GAAG;;;;OAIzB,4CAAI,4BAAalJ,IAAI,CAACkR,cAAc,CAAC;;;OAGrC,IAAI,yCAAC,IAAI,mCAAgB,IAAID,QAAQ,CAAC/e,MAAM,2CAAG,IAAI,mCAAgB,EACnE;SACC,4CAAI,sCAAmB+e,QAAQ,CAAC/e,MAAM;;MAEvC,CAAC;KACF,4CAAI,oCAAiBuH,KAAK,CAACxH,KAAK,GAAI,GAAE,4CAAI,oCAAiBsf,WAAY,IAAG;;;;CAI5E;CACA;CACA;CACA;GACC9H,sBAAsB,CAACR,QAAsB,EAC7C;KACCA,QAAQ,CAACO,IAAI,GAAG,CAAC;KAEjB,KACC,IAAIe,CAAC,GAAG,CAAC,EACRiH,CAAC,GAAG,4CAAI,4BAAarX,MAAM,EAAEoQ,CAAC,GAAGiH,CAAC,EAAEjH,CAAC,EAAE,EAEzC;OACC,MAAMrY,MAAM,GAAG,4CAAI,4BAAaqY,CAAC,CAAC,CAACrY,MAAM;OAEzC,IAAIqY,CAAC,KAAK,CAAC;;SACX;WACCtB,QAAQ,CAACC,GAAG,IAAIiH,eAAe;;OAGhClH,QAAQ,CAACC,GAAG,IAAIhX,MAAM;OACtB,IAAI+W,QAAQ,CAACC,GAAG,GAAG,CAAC,EACpB;SACCD,QAAQ,CAACC,GAAG,IAAIhX,MAAM;SACtB;QACA,MAED;SACC+W,QAAQ,CAACO,IAAI,EAAE;;;KAIjB,OAAOP,QAAQ;;;;CAIjB;CACA;CACA;CACA;;;CAyDA;CACA;CACA;GACCwI,gBAAgB,GAChB;KACC,OAAO,4CAAI,sCAAmBvB,SAAS;;;;CAIzC;CACA;CACA;GACCwB,aAAa,GACb;KACC,+CAAO,IAAI;;GAGZC,aAAa,CAACC,UAAkB,EAChC;KACC,4CAAI,8BAAeA,UAAU;KAE7B,OAAO,IAAI;;GAGZ9a,cAAc,GACd;KACC,+CAAO,IAAI;;GAGZ+a,gBAAgB,CAACzD,aAA0B,EAC3C;KACC,IAAI,CAACuC,UAAU,CAACxC,oBAAoB,CAACC,aAAa,CAAC;;GAGpD0D,cAAc,CAACjb,WAAmB,EAClC;KACC,4CAAI,gCAAgBA,WAAW;KAC/B,OAAO,IAAI;;;;CAIb;CACA;CACA;GACCkb,WAAW,GACX;KACC,+CAAO,IAAI;;;;CAIb;CACA;CACA;GACCje,SAAS,GACT;KACC,+CAAO,IAAI;;;;CAIb;CACA;CACA;GACCke,QAAQ,GACR;KACC,+CAAO,IAAI;;;;CAIb;CACA;CACA;GACCxE,WAAW,GACX;KACC,OAAO2C,eAAe,GAAGD,SAAS;;GAGnC+B,UAAU,CAACpY,OAA0B,EACrC;KACC,4CAAI,wBAAYA,OAAO;;;;CAIzB;CACA;CACA;GACCmS,UAAU,GACV;KACC,+CAAO,IAAI;;;;CAIb;CACA;CACA;CACA;GACC3V,eAAe,CAAC4D,IAAY,EAC5B;KACC,IAAIiY,YAAY,GAAG,IAAI;KAEvB,4CAAI,sBAAU5Y,GAAG,CAAElD,MAAkB,IAAK;OACzC,IAAIA,MAAM,CAAC6D,IAAI,KAAKA,IAAI,EACxB;SACCiY,YAAY,GAAG9b,MAAM;;MAEtB,CAAC;KAEF,OAAO8b,YAAY;;;;CAIrB;CACA;CACA;GACCC,YAAY,GACZ;KACC,+CAAO,IAAI;;;;CAIb;CACA;GACCC,gBAAgB,GAChB;KACC,+CAAO,IAAI;;;;CAIb;CACA;CACA;GACCC,SAAS,GACT;KACC,+CAAO,IAAI;;;;CAIb;CACA;GACCtF,cAAc,GACd;KACC,IAAI,CAAC4D,UAAU,CAAC1Y,IAAI,EAAE;;;;CAIxB;CACA;CACA;GACCuS,cAAc,CAACnZ,KAAY,EAC3B;KACC,IAAI,CAACsf,UAAU,CAAChb,IAAI,CAACtE,KAAK,CAAC;;;;CAI7B;CACA;GACCihB,cAAc,GACd;KACC,IAAI,CAAC3B,UAAU,CAAC7c,SAAS,EAAE,CAACka,YAAY,CAAC,cAAc,EAAE,CAAC,CAAC;;;;CAI7D;CACA;GACClB,gBAAgB,GAChB;KACC,IAAI,CAAC6D,UAAU,CAAC7c,SAAS,EAAE,CAACkT,eAAe,CAAC,cAAc,CAAC;;;;CAI7D;CACA;CACA;CACA;CACA;;;CA6GA;CACA;CACA;GACCuL,UAAU,CAACC,MAAwB,EACnC;KACC,4CAAI;KACJ,4CAAI,sBAAW,EAAE;KACjB,IAAI,CAACzF,cAAc,EAAE;KACrByF,MAAM,CAAClZ,GAAG,CAAEjI,KAAK,4CAAK,IAAI,wBAAWA,KAAK,EAAE,IAAI,CAAC,CAAC;;GAGnDohB,cAAc,CAACC,eAAyB,EACxC;KACC,CAAC,GAAGA,eAAe,CAAC,CAACjO,OAAO,CAAEM,IAAiB,IAAK;OACnD,MAAMzM,IAAI,GAAGyM,IAAI,CAACuC,YAAY,CAAC,WAAW,CAAC;OAC3C,MAAMrN,IAAI,GAAG8K,IAAI,CAACuC,YAAY,CAAC,WAAW,CAAC;OAE3CzL,eAAK,CAAC5G,IAAI,CAAC8P,IAAI,EAAE,OAAO,EAAEuJ,CAAC,IAAI;SAC9B,4CAAI,kDAAwBhW,IAAI,EAAE2B,IAAI;SACtCqU,CAAC,CAACqE,cAAc,EAAE;QAClB,CAAC;MACF,CAAC;;;;CAIJ;CACA;CACA;GACC1I,SAAS,GACT;KACC,+CAAO,IAAI;;GAGZtG,YAAY,GACZ;KACC,+CAAO,IAAI;;;;CAIb;CACA;CACA;GACCiP,IAAI,GACJ;KACC,MAAMC,QAAQ,GAAG,EAAE;KAEnB,MAAMC,iBAAiB,GAAGre,QAAQ,CAACC,aAAa,CAAC,wBAAwB,CAAC,CAAC6c,WAAW;KAEtF,4CAAI,oBAASjY,GAAG,CAACjI,KAAK,IAAI;OAEzB,IAAIA,KAAK,CAACwb,SAAS,EAAE,EACrB;SACC;;OAGD,MAAMjK,WAAW,GAAGvR,KAAK,CAACyC,SAAS,EAAE;OACrC,MAAMif,SAAS,GAAGnQ,WAAW,CAACuG,qBAAqB,EAAE;OACrD,MAAM6H,KAAK,GAAG,CAAC,GAAG,4CAAI,oCAAiB5J,gBAAgB,CAAC,iCAAiC,CAAC,CAAC;OAC3F,MAAM4L,SAAS,GAAGhC,KAAK,CAAC1X,GAAG,CAAEkQ,IAAI,IAAK;SACrC,MAAM;WAAEN,GAAG;WAAEzC,IAAI;WAAExU,KAAK;WAAEC;UAAQ,GAAGsX,IAAI,CAACL,qBAAqB,EAAE;SAEjE,OAAO;WACND,GAAG;WACHzC,IAAI;WACJxU,KAAK;WACLC;UACA;QACD,CAAC;OACF,MAAM+gB,YAAY,GAAGD,SAAS,CAACpS,IAAI,CAAEqQ,QAAQ,IAAK;SACjD,IAAInL,IAAI,CAACC,KAAK,CAACgN,SAAS,CAAC7J,GAAG,CAAC,GAAGpD,IAAI,CAACC,KAAK,CAACkL,QAAQ,CAAC/H,GAAG,CAAC,EACxD;WACC,OAAO,IAAI;;SAGZ,OAAO,KAAK;QACZ,CAAC;OACF,MAAMgK,OAAO,GAAGD,YAAY,GAAGD,SAAS,CAACxL,OAAO,CAACyL,YAAY,CAAC,GAAGD,SAAS,CAAC7Y,MAAM;OACjF,MAAMgZ,eAAe,GAAGH,SAAS,CAACE,OAAO,GAAG,CAAC,CAAC;OAC9C,IAAIjK,QAAQ,GAAG;SACdC,GAAG,EAAE6J,SAAS,CAAC7J,GAAG,GAAGiK,eAAe,CAACjK,GAAG;SACxCzC,IAAI,EAAEsM,SAAS,CAACtM,IAAI,GAAG0M,eAAe,CAAC1M,IAAI;SAC3CxU,KAAK,EAAE8gB,SAAS,CAAC9gB,KAAK;SACtBC,MAAM,EAAE6gB,SAAS,CAAC7gB,MAAM;SACxBsX,IAAI,EAAE0J;QACN;OACDjK,QAAQ,2CAAG,IAAI,oCAAiBA,QAAQ,EAAEkK,eAAe,CAAC;OAC1DlK,QAAQ,CAACmK,mBAAmB,GAAGN,iBAAiB,GAAGA,iBAAiB,GAAG,IAAI;OAC3E,MAAMxa,IAAI,GAAGjH,KAAK,CAACmE,OAAO,EAAE;OAC5B,IAAI0J,IAAI,GAAG,MAAM;OACjB,QAAQ5G,IAAI;SAEX,KAAK,OAAO;SACZ,KAAK,SAAS;SACd,KAAK,MAAM;SACX,KAAK,QAAQ;WACZ4G,IAAI,GAAG,OAAO;;OAEhB2T,QAAQ,CAAC7S,IAAI,CAAC;SACbzC,EAAE,EAAElM,KAAK,CAACiY,KAAK,EAAE;SACjBhR,IAAI,EAAEjH,KAAK,CAACmE,OAAO,EAAE;SACrBlE,IAAI,EAAED,KAAK,CAACc,OAAO,EAAE;SACrB+S,KAAK,EAAE7T,KAAK,CAACiF,aAAa,EAAE;SAC5BmD,KAAK,EAAEpI,KAAK,CAACgY,QAAQ,EAAE;SACvBJ,QAAQ;SACR/J;QACA,CAAC;MACF,CAAC;KAGF,4CAAI,IAAI,yCACR;KAGA,IAAI,CAAC6N,cAAc,EAAE;KAErB,OAAO,4CAAI,kBAAMsG,SAAS,CACzB,IAAI,CAACvc,cAAc,EAAE,EACrB+b,QAAQ,CAAC1Y,MAAM,GAAG,CAAC,GAAG0Y,QAAQ,GAAG,EAAE,CACnC,CAACjT,IAAI,CAAE6K,QAAQ,IAAK;OAAA;OAEpB,IAAI,EAAE,QAAQ,IAAIA,QAAQ,CAAC,EAC3B;SACC,OAAOoI,QAAQ;;OAGhB,IAAI,0BAAApI,QAAQ,CAAC6I,MAAM,CAAC,CAAC,CAAC,CAACC,UAAU,qBAA7B,sBAA+Bxf,KAAK,MAAK,YAAY,EACzD;SAAA;SACC,MAAMY,KAAK,GAAG,IAAI6e,gBAAK,CAAC;WACvBjW,EAAE,EAAE,2BAA2B;WAC/BkW,QAAQ,EAAEve,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;WACrEwD,OAAO,EAAEhF,EAAE,CAAC+f,IAAI,CAACC,gBAAgB,sBAAClJ,QAAQ,CAAC6I,MAAM,CAAC,CAAC,CAAC,qBAAlB,kBAAoBhf,OAAO,CAAC;WAC9Dsf,OAAO,EAAE,CACR,IAAIC,iBAAM,CAAC;aACV9hB,IAAI,EAAEmD,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;aAC3D7B,KAAK,EAAEwgB,sBAAW,CAACC,OAAO;aAC1BC,OAAO,EAAE,CAAC;eAAE1V;cAAQ,KAAK;eAAA;eACxB,MAAMgN,MAAM,GAAGhN,MAAM;eACrBxJ,aAAG,CAACyS,QAAQ,CAAC+D,MAAM,EAAE,aAAa,CAAC;eACnC2I,oBAAO,CAAC7W,UAAU,CAAC;iBAClB8W,OAAO,EAAE,iCAAiC;iBAC1CrB,QAAQ,EAAE;mBACTjB,UAAU,0CAAE,IAAI,2BAAY;mBAC5Bpb,QAAQ,wBAAEiU,QAAQ,CAAC6I,MAAM,CAAC,CAAC,CAAC,qBAAlB,mBAAoBC,UAAU,CAAC/c,QAAQ;mBACjD8B,IAAI,wBAAEmS,QAAQ,CAAC6I,MAAM,CAAC,CAAC,CAAC,qBAAlB,mBAAoBC,UAAU,CAACjb;;gBAEtC,CAAC,CAACsH,IAAI,CAAC,MAAM;iBACb9K,aAAG,CAACmL,WAAW,CAACqL,MAAM,EAAE,aAAa,CAAC;iBAEtC,4CAAI,oBAAShS,GAAG,CAAEjI,KAAK,IAAK;mBAAA;mBAC3B,IAAIA,KAAK,CAACwb,SAAS,EAAE,EACrB;qBACC;;mBAGD,IAAIxb,KAAK,CAACmE,OAAO,EAAE,4BAAKiV,QAAQ,CAAC6I,MAAM,CAAC,CAAC,CAAC,qBAAlB,mBAAoBC,UAAU,CAACjb,IAAI,GAC3D;qBACCjH,KAAK,CAAC2F,MAAM,EAAE;;kBAEf,CAAC;iBACFrC,KAAK,CAACwf,OAAO,EAAE;gBACf,CAAC,CAACnR,KAAK,CAAC,MAAM;iBACdrO,KAAK,CAACwf,OAAO,EAAE;gBACf,CAAC;;YAEH,CAAC,EACF,IAAIN,iBAAM,CAAC;aACV9hB,IAAI,EAAEmD,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC;aACpE7B,KAAK,EAAEwgB,sBAAW,CAACM,IAAI;aACvBJ,OAAO,EAAE,MAAM;eACd,4CAAI,oBAAS1a,GAAG,CAAEjI,KAAK,IAAK;iBAAA;iBAC3B,IAAIA,KAAK,CAACwb,SAAS,EAAE,EACrB;mBACC;;iBAGD,IAAIxb,KAAK,CAACmE,OAAO,EAAE,4BAAKiV,QAAQ,CAAC6I,MAAM,CAAC,CAAC,CAAC,qBAAlB,mBAAoBC,UAAU,CAACjb,IAAI,GAC3D;mBACC,MAAM+b,iBAAiB,GAAG5f,QAAQ,CAACC,aAAa,CAC9C,0BAAyBrD,KAAK,CAACmE,OAAO,EAAG,GAAE,CAC5C;mBAED,IAAI6e,iBAAiB,EACrB;qBACCA,iBAAiB,CAAC1H,KAAK,EAAE;;;gBAG3B,CAAC;eACFhY,KAAK,CAACwf,OAAO,EAAE;;YAEhB,CAAC;UAEH,CAAC;SACFxf,KAAK,CAACgB,IAAI,EAAE;SAEZ,OAAO,IAAI;;OAGZ,MAAM2e,UAAU,GAAG7J,QAAQ,CAAC6I,MAAM,CAAC,CAAC,CAAC;OACrC,IAAIgB,UAAU,CAAChc,IAAI,KAAK,oCAAoC,EAC5D;SACC,4CAAI;SACJ,MAAM3D,KAAK,GAAG,IAAI6e,gBAAK,CAAC;WACvBjW,EAAE,EAAE,2BAA2B;WAC/BkW,QAAQ,EAAEve,aAAG,CAACC,UAAU,CAAC,6CAA6C,CAAC;WACvEwD,OAAO,EAAEhF,EAAE,CAAC+f,IAAI,CAACC,gBAAgB,CAACW,UAAU,CAAChgB,OAAO,CAAC;WACrDsf,OAAO,EAAE,CACR,IAAIC,iBAAM,CAAC;aACV9hB,IAAI,EAAEmD,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;aAC7D7B,KAAK,EAAEwgB,sBAAW,CAACS,OAAO;aAC1BP,OAAO,EAAE,MAAM;eACdrf,KAAK,CAACwf,OAAO,EAAE;;YAEhB,CAAC;UAEH,CAAC;SACFhjB,6BAAY,CAACqjB,aAAa,CAAC,kCAAkC,EAAE,MAAM;WACpE7f,KAAK,CAACwf,OAAO,EAAE;UACf,CAAC;SACFxf,KAAK,CAACgB,IAAI,EAAE;SAEZ,OAAO,IAAI;;OAGZuN,OAAO,CAAC7K,KAAK,CAACic,UAAU,CAAChgB,OAAO,CAAC;OAEjC,OAAOue,QAAQ;MACf,CAAC;;;;CAIJ;CACA;CACA;GACC9f,MAAM,CAAC4G,OAAwB,EAC/B;KACCkC,eAAK,CAAC5G,IAAI,CAAC0E,OAAO,CAAC8a,UAAU,EAAE,OAAO,EAAGnG,CAAC,IAAK;OAC9C,4CAAI,IAAI,+BACR;SACC,IAAI3U,OAAO,CAAC+a,iBAAiB,EAC7B;WACC/a,OAAO,CAAC+a,iBAAiB,EAAE;;SAE5B;;OAGD,IAAI,CAAC9B,IAAI,EAAE,CACThT,IAAI,CAACyK,MAAM,IAAI;;SAEf,IAAIA,MAAM,KAAK,IAAI,EACnB;WACC,IAAI,CAAC2C,aAAa,CAAC,IAAI,CAAC;WAExB,IAAIrT,OAAO,CAAC+a,iBAAiB,EAC7B;aACC/a,OAAO,CAAC+a,iBAAiB,EAAE;;;SAI7B,IAAIrK,MAAM,KAAK,IAAI,EACnB;WACC,IAAI1Q,OAAO,CAACgb,iBAAiB,EAC7B;aACChb,OAAO,CAACgb,iBAAiB,EAAE;;;QAG7B,CAAC;MACH,CAAC;;;;CAIJ;CACA;GACCC,aAAa,GACb;KACCjhB,EAAE,CAAC+K,cAAc,CAAC,0BAA0B,EAAGjJ,KAAK,IAAK;OACxD,IAAIA,KAAK,CAACoJ,MAAM,CAACC,GAAG,CAAC0I,OAAO,CAAC,aAAa,CAAC,KAAK,CAAC,EACjD;SACC,IAAI,CAAC,IAAI,CAACqN,iBAAiB,EAAE,EAC7B;WACCpf,KAAK,CAACqf,UAAU,EAAE;WAElBC,gCAAU,CAACC,OAAO,CACjB9f,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC,EACrDD,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC,EAClD8f,UAAsB,IAAK;aAC3B,IAAI,CAACjI,aAAa,CAAC,IAAI,CAAC;aACxBiI,UAAU,CAACpY,KAAK,EAAE;aAClBpH,KAAK,CAACoJ,MAAM,CAAChC,KAAK,EAAE;YACpB,EACD3H,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC,EAClD8f,UAAsB,IAAK;aAC3BA,UAAU,CAACpY,KAAK,EAAE;YAClB,CACD;;;MAGH,CAAC;;;;CAIJ;CACA;CACA;GACCmQ,aAAa,CAACkI,IAAa,EAC3B;KACC,IAAI,CAACC,QAAQ,CAAC,sBAAsB,EAAED,IAAI,CAAC;;;;CAI7C;CACA;CACA;GACCL,iBAAiB,GACjB;KACC,OAAO,IAAI,CAACO,QAAQ,CAAC,sBAAsB,CAAC,KAAK,IAAI;;GAGtDD,QAAQ,CAAClf,IAAY,EAAEjC,KAAU,EACjC;KACC,MAAM6K,MAAM,GAAGlL,EAAE,CAAC2L,SAAS,CAACC,QAAQ,CAAC8V,iBAAiB,CAAC1W,MAAM,CAAC;KAC9D,IAAIE,MAAM,EACV;OACCA,MAAM,CAAC1M,OAAO,EAAE,CAACmjB,GAAG,CAACrf,IAAI,EAAEjC,KAAK,CAAC;;;GAInCohB,QAAQ,CAACnf,IAAY,EACrB;KACC,MAAM4I,MAAM,GAAGlL,EAAE,CAAC2L,SAAS,CAACC,QAAQ,CAAC8V,iBAAiB,CAAC1W,MAAM,CAAC;KAC9D,IAAIE,MAAM,EACV;OACC,OAAOA,MAAM,CAAC1M,OAAO,EAAE,CAACmO,GAAG,CAACrK,IAAI,CAAC;;KAGlC,OAAO0O,SAAS;;;;CAIlB;CACA;CACA;CACA;CACA;CACA;GACC4I,UAAU,CAACrE,GAAW,EAAEqM,MAAc,EAAEC,YAAqB,EAC7D;KACC,MAAMC,KAAK,GAAG,IAAI,CAACzD,QAAQ,EAAE;KAC7B,MAAMrZ,OAAO,GAAGlE,QAAQ,CAACC,aAAa,CAAC,uBAAuB,CAAC;KAC/DwU,GAAG,IAAIvQ,OAAO,CAAC0U,SAAS;KACxBkI,MAAM,IAAI5c,OAAO,CAAC0U,SAAS;KAC3B,IAAIoI,KAAK,CAACtb,MAAM,GAAG,CAAC,IAAIqb,YAAY,KAAK,IAAI,EAC7C;OACC,MAAMnJ,kBAAkB,GAAG,4CAAI,oCAAiBlD,qBAAqB,EAAE;OACvED,GAAG,IAAImD,kBAAkB,CAACnD,GAAG;OAC7BqM,MAAM,IAAIlJ,kBAAkB,CAACnD,GAAG;;KAGjC,KACC,IAAIwM,EAAE,GAAG,CAAC,EACTC,EAAE,GAAGF,KAAK,CAACtb,MAAM,EAAEub,EAAE,GAAGC,EAAE,EAAED,EAAE,EAAE,EAElC;OACC,MAAME,IAAI,GAAGH,KAAK,CAACC,EAAE,CAAC;;;OAGtB,IAAIxM,GAAG,IAAI0M,IAAI,CAAC,CAAC,CAAC,IAAIL,MAAM,IAAIK,IAAI,CAAC,CAAC,CAAC,IAAIL,MAAM,IAAIK,IAAI,CAAC,CAAC,CAAC,EAC5D;SACC,OAAOA,IAAI,CAAC,CAAC,CAAC,GAAGL,MAAM;;;;OAIxB,IAAIrM,GAAG,IAAI0M,IAAI,CAAC,CAAC,CAAC,IAAIL,MAAM,IAAIK,IAAI,CAAC,CAAC,CAAC,EACvC;;;SAGC,OAAOA,IAAI,CAAC,CAAC,CAAC,GAAGL,MAAM;;;;OAIxB,IAAIrM,GAAG,IAAI0M,IAAI,CAAC,CAAC,CAAC,IAAIL,MAAM,IAAIK,IAAI,CAAC,CAAC,CAAC,EACvC;SACC,OAAOA,IAAI,CAAC,CAAC,CAAC,GAAGL,MAAM;;;;OAIxB,IAAIrM,GAAG,IAAI0M,IAAI,CAAC,CAAC,CAAC,IAAI1M,GAAG,IAAI0M,IAAI,CAAC,CAAC,CAAC,IAAIL,MAAM,IAAIK,IAAI,CAAC,CAAC,CAAC,EACzD;SACC,OAAOA,IAAI,CAAC,CAAC,CAAC,GAAG1M,GAAG;;;KAKtB,OAAO,CAAC;;CAwJV;CAAC,0BAl3BgBD,QAAsB,EAAEgI,QAAQ,EAChD;GACChI,QAAQ,CAAC4M,OAAO,GAAG5M,QAAQ,CAAChX,KAAK;GACjCgX,QAAQ,CAAC6M,QAAQ,GAAG7M,QAAQ,CAAC/W,MAAM;GACnC+W,QAAQ,CAACxC,IAAI,GAAGwC,QAAQ,CAACxC,IAAI,GAAG,GAAG,GAAGwK,QAAQ,CAAChf,KAAK;GACpDgX,QAAQ,CAACC,GAAG,GAAGD,QAAQ,CAACC,GAAG,GAAG,GAAG,GAAG+H,QAAQ,CAAC/e,MAAM;GACnD+W,QAAQ,CAAChX,KAAK,GAAGgX,QAAQ,CAAChX,KAAK,GAAGgf,QAAQ,CAAChf,KAAK,GAAG,GAAG;GACtDgX,QAAQ,CAAC/W,MAAM,GAAG+W,QAAQ,CAAC/W,MAAM,GAAG+e,QAAQ,CAAC/e,MAAM,GAAG,GAAG;GAEzD,OAAO+W,QAAQ;CAChB;CAAC,0BAOeA,QAAsB,EACtC;GACC,IAAI,CAACA,QAAQ,CAACO,IAAI,IAAI,OAAO,4CAAI,4BAAaP,QAAQ,CAACO,IAAI,GAAG,CAAC,CAAC,KAAK,WAAW,EAChF;KACC,OAAOP,QAAQ;;GAGhB,MAAM8M,aAAa,GAAG,4CAAI,4BAAa9M,QAAQ,CAACO,IAAI,GAAG,CAAC,CAAC;GACzD,MAAMwM,aAAa,GAAG,EAAE;GAExB,IAAI,OAAO/M,QAAQ,CAACxC,IAAI,KAAK,QAAQ,EACrC;KACCuP,aAAa,CAACvP,IAAI,GAAGwC,QAAQ,CAACxC,IAAI,GAAGsP,aAAa,CAAC9jB,KAAK,GAAG,GAAG;;GAE/D,IAAI,OAAOgX,QAAQ,CAACC,GAAG,KAAK,QAAQ,EACpC;KACC,IAAIA,GAAG,GAAGD,QAAQ,CAACC,GAAG,GAAG6M,aAAa,CAAC7jB,MAAM,GAAG,GAAG;KACnD,IAAIghB,OAAO,GAAG,CAAC;KACf,OAAOA,OAAO,GAAGjK,QAAQ,CAACO,IAAI,GAAG,CAAC,EAClC;OACCN,GAAG,IAAI,4CAAI,4BAAagK,OAAO,CAAC,CAAChhB,MAAM,GAAGie,eAAe;OACzD+C,OAAO,EAAE;;KAGV8C,aAAa,CAAC9M,GAAG,GAAGA,GAAG;;GAExB,IAAI,OAAOD,QAAQ,CAAChX,KAAK,KAAK,QAAQ,EACtC;KACC+jB,aAAa,CAAC/jB,KAAK,GAAGgX,QAAQ,CAAChX,KAAK,GAAG8jB,aAAa,CAAC9jB,KAAK,GAAG,GAAG;;GAEjE,IAAI,OAAOgX,QAAQ,CAAC/W,MAAM,KAAK,QAAQ,EACvC;KACC8jB,aAAa,CAAC9jB,MAAM,GAAG+W,QAAQ,CAAC/W,MAAM,GAAG6jB,aAAa,CAAC7jB,MAAM,GAAG,GAAG;;GAGpE,OAAO8jB,aAAa;CACrB;CAAC,oBAiLS1kB,IAAe,EAAE2kB,SAAkB,EAC7C;GACC,MAAMhN,QAAQ,GAAG3X,IAAI,CAAC2X,QAAQ,2CAAG,IAAI,oCAAiB3X,IAAI,CAAC2X,QAAQ,IAAI,IAAI;GAC3E,MAAMiN,QAAQ,GAAG,IAAIzO,KAAK,CAAC;KAC1BlK,EAAE,EAAEjM,IAAI,CAACiM,EAAE;KACXjF,IAAI,EAAEhH,IAAI,CAACgH,IAAI;KACf4M,KAAK,EAAE5T,IAAI,CAAC4T,KAAK;KACjB/O,aAAa,EAAE,IAAI;KACnB7E,IAAI,EAAEA,IAAI,CAACA,IAAI;KACf2X,QAAQ;KACRxP,KAAK,EAAEnI,IAAI,CAACmI,KAAK;KACjBmP,OAAO,EAAGvX,KAAY,IAAK;OAC1B,4CAAI,IAAI,+BACR;SACC;;OAED,IAAI,CAACsf,UAAU,CAAChb,IAAI,CAACtE,KAAK,CAAC;OAC3B,IAAI,CAACyb,gBAAgB,EAAE;OACvBzb,KAAK,CAAC8a,kBAAkB,EAAE;MAC1B;KACDnZ,QAAQ,EAAG3B,KAAY,IAAK;OAC3B,IAAI,CAACsf,UAAU,CAAC1Y,IAAI,EAAE;;IAEvB,CAAC;GACF,MAAM2K,WAAW,GAAGsT,QAAQ,CAACpiB,SAAS,EAAE;GACxC,4CAAI,oDAAyBoiB,QAAQ;GAErC,IAAI,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC5e,QAAQ,CAAC4e,QAAQ,CAAC1gB,OAAO,EAAE,CAAC,EACnD;KAAA;KACC,MAAM2gB,gBAAmC,GAAG,4CAAI,oBAASvV,IAAI,CAACvP,KAAK,IAAIA,KAAK,CAACmE,OAAO,EAAE,KAAK0gB,QAAQ,CAAC1gB,OAAO,EAAE,CAAC;KAC9G,MAAM4gB,SAA6B,GAAGD,gBAAgB,oBAAhBA,gBAAgB,CAAE9M,QAAQ,6CAA1B8M,gBAAgB,CAAE9M,QAAQ,EAAI,qBAA9B,sBAAgC/V,KAAK;KAC3E,IAAI,CAAC2I,cAAI,CAACC,KAAK,CAACka,SAAS,CAAC,EAC1B;OACCF,QAAQ,CAACvU,WAAW,CAACyU,SAAS,EAAE,KAAK,CAAC;;;GAIxC,4CAAI,oBAASpW,IAAI,CAACkW,QAAQ,CAAC;GAE3BphB,aAAG,CAACC,MAAM,CAAC6N,WAAW,0CAAE,IAAI,oCAAiB;GAE7C,OAAOsT,QAAQ;CAChB;CAAC,kCAEuBA,QAAe,EACvC;GACC,MAAMG,YAAY,GAAGH,QAAQ,CAAC1gB,OAAO,EAAE;GACvC,IAAI,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC8B,QAAQ,CAAC+e,YAAY,CAAC,EAC7C;KACC,MAAMC,mBAAmB,GAAI7gB,KAAK,4CAAK,IAAI,sDAA0BygB,QAAQ,EAAEzgB,KAAK,CAAC;KACrF,4CAAI,oCAAiB4a,gBAAgB,CAACiF,GAAG,CACxCY,QAAQ,EACR;OAAEK,YAAY,EAAED,mBAAmB;OAAEE,SAAS,EAAEN,QAAQ,CAAC3kB,MAAM,CAACE;MAAoB,CACpF;KACDykB,QAAQ,CAACle,SAAS,CACjBke,QAAQ,CAAC3kB,MAAM,CAACE,kBAAkB,EAClC6kB,mBAAmB,CACnB;IACD,MACI,IAAI,CAAC,aAAa,EAAE,WAAW,CAAC,CAAChf,QAAQ,CAAC+e,YAAY,CAAC,EAC5D;KACC,MAAMI,qBAAqB,GAAIhhB,KAAuB,4CAAK,IAAI,8DAC9DygB,QAAQ,EACRzgB,KAAK,CACL;KACD,4CAAI,oCAAiB8a,yBAAyB,CAAC+E,GAAG,CACjDY,QAAQ,EACR;OAAEK,YAAY,EAAEE,qBAAqB;OAAED,SAAS,EAAE;MAAiB,CACnE;KACDN,QAAQ,CAACle,SAAS,CACjB,eAAe,EACfye,qBAAqB,CACrB;IACD,MACI,IAAI,CAAC,cAAc,EAAE,gBAAgB,EAAE,iBAAiB,EAAE,kBAAkB,CAAC,CAACnf,QAAQ,CAAC+e,YAAY,CAAC,EACzG;KACC,MAAMI,qBAAqB,GAAIhhB,KAAuB,4CAAK,IAAI,oEAC9DygB,QAAQ,EACRzgB,KAAK,CACL;KAED,4CAAI,oCAAiB+a,4BAA4B,CAAC8E,GAAG,CACpDY,QAAQ,EACR;OAAEK,YAAY,EAAEE,qBAAqB;OAAED,SAAS,EAAE;MAAiB,CACnE;KACDN,QAAQ,CAACle,SAAS,CACjB,eAAe,EACfye,qBAAqB,CACrB;;CAEH;CAAC,iCAOsBne,IAAY,EAAE4M,KAAa,EAClD;GACCA,KAAK,GAAG1L,QAAQ,CAAC0L,KAAK,CAAC;GACvB,IAAI,CAAC8H,aAAa,CAAC,KAAK,CAAC;GAEzB,MAAM3b,KAAK,2CAAG,IAAI,wBAAW;KAAEiH,IAAI;KAAE4M;IAAO,CAAC;GAC7C7T,KAAK,CAAC2F,MAAM,EAAE;GACd3F,KAAK,CAACyB,QAAQ,EAAE;CACjB;CAAC,2CA+YD;GACC,MAAM4jB,KAAK,GAAG,IAAIC,eAAK,CAAC;KACvBC,KAAK,EAAE,CACN;OACCtL,MAAM,EAAE7W,QAAQ,CAACoiB,cAAc,CAAC,sBAAsB,CAAC;OACvD7Y,KAAK,EAAE9I,aAAG,CAACC,UAAU,CAAC,sCAAsC,CAAC;OAC7DpD,IAAI,EAAEmD,aAAG,CAACC,UAAU,CAAC,qCAAqC;MAC1D,CACD;KACDoI,EAAE,EAAE,0DAA0D;KAC9DuZ,QAAQ,EAAE,IAAI;KACdC,UAAU,EAAE;IACZ,CAAC;GACFL,KAAK,CAACM,SAAS,EAAE;CAClB;CAAC,mCAGD;GACC,MAAMC,gBAAgB,GAAG,IAAItjB,EAAE,CAACujB,SAAS,CAAC;KACzCC,aAAa,EAAE1iB,QAAQ,CAACoiB,cAAc,yCAAC,IAAI,wCAAmB;KAC9DO,YAAY,EAAE,eAAe;KAC7BN,QAAQ,EAAE,IAAI;KACdvZ,EAAE,EAAE;IACJ,CAAC;GAEF,MAAMmZ,KAAK,GAAG,IAAIC,eAAK,CAAC;KACvBC,KAAK,EAAE,CACN;OACCtL,MAAM,EAAE7W,QAAQ,CAACoiB,cAAc,CAAC,yBAAyB,CAAC;OAC1D7Y,KAAK,EAAE9I,aAAG,CAACC,UAAU,CAAC,wCAAwC,CAAC;OAC/DpD,IAAI,EAAEmD,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;OAC7D8T,QAAQ,EAAE;MACV,EACD;OACCqC,MAAM,EAAE7W,QAAQ,CAACoiB,cAAc,yCAAC,IAAI,wCAAmB;OACvD7Y,KAAK,EAAE9I,aAAG,CAACC,UAAU,CAAC,sCAAsC,CAAC;OAC7DpD,IAAI,EAAEmD,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;OAC3DkiB,OAAO,EAAE,IAAI;OACbC,OAAO,0CAAE,IAAI,uDAA0B;OACvC/lB,MAAM,EAAE;SACPgmB,MAAM,EAAE,MAAMN,gBAAgB,CAACthB,IAAI,EAAE;SACrCoB,OAAO,EAAE,MAAMkgB,gBAAgB,CAACpa,KAAK;;MAEtC,CACD;KACDU,EAAE,EAAE,iDAAiD;KACrDuZ,QAAQ,EAAE,IAAI;KACdC,UAAU,EAAE;IACZ,CAAC;GACFL,KAAK,CAACM,SAAS,EAAE;CAClB;CAAC,oCAGD;GACC,4CAAI,oBAASvS,OAAO,CAAEpT,KAAK,IAAK;KAC/B,IAAIA,KAAK,CAACwb,SAAS,EAAE,EACrB;OACC;;KAGD,MAAMvU,IAAI,GAAGjH,KAAK,CAACmE,OAAO,EAAE;KAC5B,MAAMgiB,KAAK,GAAGlf,IAAI,KAAK,WAAW,IAAIA,IAAI,KAAK,aAAa;KAC5D,IAAIkf,KAAK,IAAIvb,cAAI,CAACqO,OAAO,CAACjZ,KAAK,CAACc,OAAO,EAAE,CAAC,EAC1C;OACC2C,aAAG,CAACyS,QAAQ,CAAClW,KAAK,CAACyC,SAAS,EAAE,EAAE,WAAW,CAAC;;IAE7C,CAAC;CACH;CAAC,mCAEwB2jB,YAAmB,EAAEhiB,KAAgB,EAC9D;GAAA;GACC,IAAI,CAAC,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC6B,QAAQ,CAACmgB,YAAY,CAACjiB,OAAO,EAAE,CAAC,EACxD;KACC;;GAGD,MAAMkiB,QAAuB,2BAAGjiB,KAAK,CAACtD,OAAO,EAAE,CAACmB,KAAK,mCAAI,IAAI;GAC7D,IAAI2I,cAAI,CAAC0b,MAAM,CAACD,QAAQ,CAAC,EACzB;KACC;;GAGD,4CAAI,oBACF5hB,MAAM,CAAEzE,KAAK,IAAKomB,YAAY,CAACjiB,OAAO,EAAE,KAAKnE,KAAK,CAACmE,OAAO,EAAE,CAAC,CAC7DiP,OAAO,CAAEpT,KAAK,IAAK;KACnB,IAAIomB,YAAY,KAAKpmB,KAAK,EAC1B;OACC;;KAGDA,KAAK,CAACsQ,WAAW,CAAC+V,QAAQ,EAAE,KAAK,CAAC;IAClC,CAAC;CAEJ;CAAC,uCAE4BrmB,KAAY,EAAEoE,KAAuB,EAClE;GACC,IAAIA,KAAK,CAACtD,OAAO,EAAE,CAAC8O,kBAAkB,CAAC9G,MAAM,KAAK,CAAC,EACnD;KACC,MAAMyd,aAAa,GAAG,GAAG;KACzB1X,UAAU,CAAC,8CAAY,IAAI,gFAAuC7O,KAAK,CAAC,EAAEumB,aAAa,CAAC;;CAE1F;CAAC,0CAE+BvmB,KAAY,EAAEoE,KAAuB,EACrE;GACC,IAAIA,KAAK,CAACtD,OAAO,EAAE,CAAC8O,kBAAkB,CAAC9G,MAAM,KAAK,CAAC,EACnD;KACC,MAAMyd,aAAa,GAAG,GAAG;KACzB1X,UAAU,CAAC,8CAAY,IAAI,wGAAmD7O,KAAK,CAAC,EAAEumB,aAAa,CAAC;;CAEtG;CAAC,gDAEqCvmB,KAAY,EAClD;GACCA,KAAK,CAACqZ,MAAM,EAAE;;GAEd,4CAAI,sBAAQxU,QAAQ,CAAC,QAAQ,EAAE,MAAMqC,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;KAClEC,OAAO,EAAEC,cAAI,CAAClG,MAAM,CAACwC,aAAG,CAACC,UAAU,CAAC,gEAAgE,CAAC,CAAC;KACtG0D,aAAa,EAAE,IAAI;KACnB5G,KAAK,EAAE;IACP,CAAC,CAAC;CACJ;CAAC,4DAEiDZ,KAAY,EAC9D;GACCA,KAAK,CAACqZ,MAAM,EAAE;;GAEd,4CAAI,sBAAQxU,QAAQ,CAAC,WAAW,EAAE,MAAMqC,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;KACrEC,OAAO,EAAEC,cAAI,CAAClG,MAAM,CAACwC,aAAG,CAACC,UAAU,CAAC,oEAAoE,CAAC,CAAC;KAC1G0D,aAAa,EAAE,IAAI;KACnB5G,KAAK,EAAE;IACP,CAAC,CAAC;CACJ;CAAC,yCAGD;GACC,MAAM4lB,aAAiD,GAAGze,MAAM,CAC9D0e,MAAM,yCAAC,IAAI,oCAAiB,CAC5BC,OAAO,CAAExB,YAAY,IAAK,CAAC,GAAGA,YAAY,CAAC/R,OAAO,EAAE,CAAC,CAAC;GAExD,KAAK,MAAM,CAACnT,KAAK,EAAE;KAAEklB,YAAY;KAAEC;IAAW,CAAC,IAAIqB,aAAa,EAChE;KACCxmB,KAAK,CAAC2mB,WAAW,CAACxB,SAAS,EAAED,YAAY,CAAC;;GAG3Cnd,MAAM,CAAC0e,MAAM,yCAAC,IAAI,oCAAiB,CAACrT,OAAO,CAAEwT,kBAAkB,IAAKA,kBAAkB,CAACC,KAAK,EAAE,CAAC;CAChG;;;;;;;;;;;;;AC3iCD,CASA,MAAMC,eAAe,GAAG,CACvB,QAAQ,EACR,WAAW,EACX,cAAc,EACd,qBAAqB,CACrB;AAED,OAAaC,WAAW,GAAGhf,MAAM,CAACif,MAAM,CAAC;GACxCC,OAAO,EAAE,CAAC;GACVC,UAAU,EAAE,CAAC;GACbC,WAAW,EAAE,CAAC;GACdC,kBAAkB,EAAE;CACrB,CAAC,CAAC;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAuBH,CAAO,MAAMC,MAAM,SAASvnB,6BAAY,CACxC;GAoBCC,WAAW,CAACunB,UAAkB,EAAEhf,OAAsB,EACtD;KAAA;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAVyC,IAAI2W,GAAG;;KAAE;OAAA;OAAA,OAC1B,IAAI1a,GAAG;;KAAE;OAAA;OAAA,OAEC;;KAAI;OAAA;OAAA,OACV;;KAAI;OAAA;OAAA,OACV;;KAAI;OAAA;OAAA;;KAMlC,IAAI,CAAClE,iBAAiB,CAAC,mBAAmB,CAAC;KAC3C,MAAM;OAAE6N;MAAU,GAAGxG,oBAAU,CAACC,QAAQ,CAAC,cAAc,CAAC;KACxD,4CAAI,4BAAcuG,QAAQ;KAC1B,4CAAI,gBAAQhN,aAAG,CAACC,MAAM,oBAAC,oDAAkD,EAAC;KAC1E,4CAAI,0CAAmBD,aAAG,CAACC,MAAM,sBAAC;;GAElC,EAAC;KACD,4CAAI,oCAAkB,IAAI4d,aAAa,CAAC;OACvChE,cAAc,0CAAE,IAAI,uCAAgB;OACpCqE,WAAW,EAAE,KAAK;OAClB/M,SAAS,EAAE/J,OAAO,CAAC+J,SAAS;OAC5BI,cAAc,EAAE4M,OAAO,CAAC/W,OAAO,CAACmK,cAAc,CAAC;OAC/CI,uBAAuB,2BAAEvK,OAAO,CAACuK,uBAAuB,oCAAIC,2BAAiB,CAACI;MAC9E,CAAC;KACF,4CAAI,sCAAmBmM,OAAO,CAAC/W,OAAO,CAACmK,cAAc,CAAC;KACtD,4CAAI,8BAAe6U,UAAU;KAC7B,4CAAI,kBAAS,EAAE;KACf,4CAAI,8BAAe,CAAC;;GAarBC,OAAO,CAACC,IAAc,EAAEC,UAAkB,EAC1C;KACC,IAAID,IAAI,CAAC1e,MAAM,KAAK,CAAC,EACrB;OACC,4CAAI,kBAAS,EAAE;OACf,4CAAI,8BAAe,CAAC;OAEpB;;KAGD,4CAAI,kBAAS,CACZ,2CAAG,IAAI,eAAM,EACb,GAAG0e,IAAI,CACP;KACD,4CAAI,8BAAeC,UAAU;KAC7B,IAAI,4CAAI,gBAAO3e,MAAM,KAAK2e,UAAU,EACpC;OAAA;OACC,+FAAI;;;GAIN,IAAIC,YAAY,CAACA,YAA0B,EAC3C;KACC,4CAAI,kCAAiBA,YAAY;KACjC,MAAM;OAAE1a,GAAG,GAAG,EAAE;OAAE2a;MAAY,GAAGD,YAAY;KAC7C,IAAIC,UAAU,EACd;OACC,4CAAI,oCAAiB,KAAK;MAC1B,MAED;OACC,4CAAI,oCAAiB,IAAI;;KAG1B,4CAAI,kCAAgBlH,cAAc,CAACzT,GAAG,CAAC;;GAGxC4a,aAAa,CAACC,UAAkB,EAChC;KACC,4CAAI,kCAAgBhV,uBAAuB,GAAGgV,UAAU;;GAGzD,IAAIC,UAAU,CAACA,UAAU,EACzB;KACC,MAAMC,cAAc,GAAG,IAAIxjB,GAAG,CAAC,CAC9ByjB,oBAAU,CAACC,MAAM,EACjBD,oBAAU,CAACE,QAAQ,CACnB,CAAC;KAEF,MAAM1f,OAAO,GAAGT,MAAM,CAAC0e,MAAM,CAACqB,UAAU,CAAC,CACvCrjB,MAAM,CAAEM,MAAM,IAAK,CAACgjB,cAAc,CAACpjB,GAAG,CAACI,MAAM,CAACojB,IAAI,CAAC,CAAC,CACpDlgB,GAAG,CAAElD,MAAM,IAAK;OAChB,MAAM;SACLmH,EAAE,EAAE7G,GAAG;SACPsH,KAAK,EAAE/H,IAAI;SACXgE,IAAI;SACJzD,QAAQ;SACRD,YAAY;SACZ8H,GAAG;SACH5H,QAAQ;SACR+iB;QACA,GAAGpjB,MAAM;OAEV,OAAO;SACNM,GAAG;SACHT,IAAI;SACJgE,IAAI,0CAAE,IAAI,oDAAyBA,IAAI,EAAEuf,IAAI,CAAC;SAC9ChjB,QAAQ;SACRD,YAAY;SACZ8H,GAAG;SACH5H;QACA;MACD,CAAC;KACH,4CAAI,kCAAgBwb,UAAU,CAACpY,OAAO,CAAC;;GAgBxC,MAAM4f,cAAc,GACpB;KACC3kB,aAAG,CAAC8V,KAAK,yCAAC,IAAI,wCAAiB;KAC/B,MAAM;OAAE8O,QAAQ;OAAEC;MAAU,GAAG,4CAAI,gBAAOC,MAAM,CAAC,CAACC,GAAG,EAAE/a,GAAG,KAAK;;OAE9D,MAAM;SAAE6a,QAAQ;SAAED;QAAU,GAAGG,GAAG;OAClC,MAAMC,OAAO,GAAG,IAAI3W,OAAO,CAAEC,OAAO,IAAK;SACxC,MAAMoG,IAAI,GAAGjX,aAAG,CAACC,MAAM,sBAAC;;kBAEZ,CAAM,aAAU,CAAU;;KAEtC,GAFcsM,GAAG,EAAasE,OAAO,CAEpC;SACDtO,aAAG,CAACC,MAAM,CAACyU,IAAI,EAAEmQ,QAAQ,CAAC;QAC1B,CAAC;OACFD,QAAQ,CAAC1Z,IAAI,CAAC8Z,OAAO,CAAC;OAEtB,OAAOD,GAAG;MACV,EAAE;OACFF,QAAQ,EAAE,IAAII,gBAAgB,EAAE;OAChCL,QAAQ,EAAE;MACV,CAAC;KACF5kB,aAAG,CAACC,MAAM,CAAC4kB,QAAQ,0CAAE,IAAI,wCAAiB;KAC1C,MAAM;OAAEhJ;MAAY,2CAAG,IAAI,iCAAe;KAC1C7b,aAAG,CAACC,MAAM,CAAC4b,UAAU,CAAC7c,SAAS,EAAE,0CAAE,IAAI,wCAAiB;KACxD,MAAMqP,OAAO,CAAC6W,GAAG,CAACN,QAAQ,CAAC;KAC3BvoB,6BAAY,CAAC8oB,cAAc,CAAC,iCAAiC,CAAC;KAC9D9oB,6BAAY,CAACqjB,aAAa,CAAC,iCAAiC,EAAE,MAAM;OACnE,4CAAI,kCAAgBzD,aAAa,EAAE;OACnC,4CAAI,kCAAgBwB,UAAU,CAC7B,4CAAI,gCAAeC,MAAM,CACvB1c,MAAM,CAAEzE,KAAK,4CAAK,IAAI,sDAA0BA,KAAK,CAAC,CAAC,CAEzD;MACD,CAAC;;GAGHsE,IAAI,GACJ;KACC,OAAO,IAAIwN,OAAO,CAAEC,OAAO,IAAK;OAC/B,4CAAI,sCAAmBA,OAAO;OAC9B,4CAAI,0BAAYtH,IAAI,CAAC,QAAQ,EAAE;SAC9Boe,eAAe,EAAE,MAAM;WACtB,4CAAI;WAEJ,+CAAO,IAAI;UACX;SACD3oB,MAAM,EAAE;WACPwF,OAAO,EAAGuX,CAAC,4CAAK,IAAI,kDAAwBA,CAAC,CAAC;WAC9C6L,eAAe,EAAE,8CAAM,IAAI;;QAE5B,CAAC;MACF,CAAC;;GAGHC,gBAAgB,GAChB;KACC,OAAO,IAAIjX,OAAO,CAAEC,OAAO,IAAK;OAC/B,IAAI,4CAAI,gBAAOjJ,MAAM,6CAAK,IAAI,2BAAY,EAC1C;SACCiJ,OAAO,EAAE;SAET;;OAGD,4CAAI,kCAAiBA,OAAO;MAC5B,CAAC;;GA0LHiX,0BAA0B,CAACnb,IAAY,EAAEob,UAAmB,EAC5D;KACC,MAAMC,cAAc,GAAG,4CAAI,gDAAuBja,GAAG,CAACpB,IAAI,CAAC;KAC3D,IAAIqb,cAAc,EAClB;;OAECA,cAAc,CAAC9gB,KAAK,CAACsU,OAAO,GAAGuM,UAAU,KAAK,IAAI,GAAG,OAAO,GAAG,MAAM;;KAGtE,IAAIA,UAAU,EACd;OACC,4CAAI,wCAAmBrjB,MAAM,CAACiI,IAAI,CAAC;MACnC,MAED;OACC,4CAAI,wCAAmBsb,GAAG,CAACtb,IAAI,CAAC;;;GAkPlCub,YAAY,CAACC,QAAmB,EAChC;KACC,4CAAI,4BAAcA,QAAQ;;CAE5B;CAAC,mBAlmBA;GACC,OAAO,4CAAI,gCAAiB,KAAK;CAClC;CAAC,4BAGD;GACC,OAAO,4CAAI,sBAAY,EAAE,GAAG,UAAU;CACvC;CAAC,kCA8EuBzgB,IAAY,EAAEuf,IAAqB,EAC3D;GACC,QAAQA,IAAI;KAEX,KAAKH,oBAAU,CAACsB,QAAQ;OACvB,OAAO,CAAC;KACT,KAAKtB,oBAAU,CAACuB,MAAM;OACrB,OAAO,CAAC;KACT;OACC,OAAO3gB,IAAI;;CAEd;CAAC,oBAuED;GACCnF,aAAG,CAAC8V,KAAK,yCAAC,IAAI,cAAM;GACpB9V,aAAG,CAACC,MAAM,yCAAC,IAAI,2EAAkB,IAAI,cAAM;GAC3CD,aAAG,CAACC,MAAM,yCAAC,IAAI,6EAAmB,IAAI,cAAM;CAC7C;CAAC,0BAGD;GACC,MAAM8lB,mBAAmB,GAAG,CAC3B,8BAA8B,EAC9B,GAAG1C,eAAe,CAClB,CAAC2C,IAAI,CAAC,GAAG,CAAC;GACX,MAAMC,mBAAmB,GAAG,CAC3B,gBAAgB,EAChB,GAAG5C,eAAe,CAAC6C,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAC/B,CAACF,IAAI,CAAC,GAAG,CAAC;GACX,MAAMG,eAAe,GAAG/lB,aAAG,CAACC,UAAU,CAAC,kBAAkB,CAAC;GAC1D,MAAM+lB,eAAe,GAAGhmB,aAAG,CAACC,UAAU,CAAC,kBAAkB,CAAC;GAE1D,IAAIgmB,kBAAkB,GAAG,EAAE;GAC3B,4CAAI,IAAI,uCACR;KACCA,kBAAkB,GAAG5oB,aAAG,CAACC,MAAM,sBAAC;;mBAElB,CAGX;;;IAGH,GANgB,MAAM;OACpB,MAAM4oB,MAAM,GAAGriB,oBAAU,CAACC,QAAQ,CAAC,WAAW,CAAC;OAC/CoiB,MAAM,CAACzlB,IAAI,CAAE,wBAAqB,wCAAE,IAAI,qCAAmB,EAAC,CAAC;MAC7D,CAGD;;GAEF,MAAM0lB,aAAa,GAAG9oB,aAAG,CAACC,MAAM,sBAAC;;YAEzB,CAAwC;;kBAElC,CAAsD;;;GAGpE,GALU0C,aAAG,CAACC,UAAU,CAAC,qBAAqB,CAAC,EAE/BD,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC,CAGlE;GACDmmB,mBAAI,CAACC,MAAM,CAACF,aAAa,CAAC;GAE1B,OAAO9oB,aAAG,CAACC,MAAM,sBAAC;;MAEhB,CAAgB;;OAEf,CAAqB;;eAEb,CAAsB;eACtB,CAAkB;iBAChB,CAA+B;;QAExC,CAAkB;;;eAGX,CAAsB;eACtB,CAAkB;iBAChB,CAAiC;;QAE1C,CAAkB;;;;GAItB,GAnBI6oB,aAAa,EAEZF,kBAAkB,EAEVN,mBAAmB,EACnBI,eAAe,EACb,8CAAM,IAAI,qCAAkB,EAErCA,eAAe,EAGRF,mBAAmB,EACnBG,eAAe,EACZ5M,CAAC,4CAAK,IAAI,oCAAiBA,CAAC,CAAC,EAEvC4M,eAAe;CAKtB;CAAC,gCAEqB;GAAE5P;CAAmB,CAAC,EAC5C;GACCxW,aAAG,CAACyS,QAAQ,CAAC+D,MAAM,EAAE,aAAa,CAAC;GACnC,MAAMkH,MAAM,GAAG,MAAM,4CAAI,kCAAgBI,IAAI,EAAE;GAC/C,MAAMvU,GAAG,GAAG,4CAAI,kCAAgBvH,cAAc,EAAE;GAChDhC,aAAG,CAACmL,WAAW,CAACqL,MAAM,EAAE,aAAa,CAAC;GACtC,IAAI,CAACkH,MAAM,EACX;KACC;;GAEDrhB,6BAAY,CAACqjB,aAAa,CAAC,kCAAkC,EAAE,MAAM;KACpE,IAAI,CAACrhB,IAAI,CAAC,MAAM,EAAE;OAAEkL,GAAG;OAAEmU;MAAQ,CAAC;KAClC,IAAI,4CAAI,qCAAuBgJ,2BAAS,4CAAI,IAAI,mCAAgB,EAChE;OACC,4CAAI,0BAAYC,IAAI,CAAC;SACpBhmB,KAAK,EAAE,8BAA8B;SACrCimB,MAAM,EAAE;QACR,CAAC;;IAEH,CAAC;GAEF,4CAAI,sEAAmC,KAAK;GAC5C,4CAAI,0BAAY7e,KAAK,EAAE;GACvB,4CAAI,sEAAmC,IAAI;GAC3C,4CAAI,oCAAiB,KAAK;CAC3B;CAAC,4BAGD;GACC,4CAAI,oCAAiB,IAAI;GACzB,IAAI,4CAAI,qCAAuB2e,2BAAS,4CAAI,IAAI,mCAAgB,EAChE;KACC,4CAAI,0BAAYC,IAAI,CAAC;OACpBhmB,KAAK,EAAE,sBAAsB;OAC7BimB,MAAM,EAAE;MACR,CAAC;;CAEJ;CAAC,2BAGD;GACC,MAAMC,QAAQ,2CAAG,IAAI,qCAAkB;GACvC,MAAMvN,aAAa,GAAG7b,aAAG,CAACC,MAAM,sBAAC;;;OAG9B,CAAuB;;MAExB,CAAW;;GAEb,2CAJK,IAAI,yCAELmpB,QAAQ,CAEX;GACDL,mBAAI,CAACC,MAAM,CAACI,QAAQ,EAAE;KACrBC,WAAW,EAAE;OAAE3S,QAAQ,EAAE;MAAO;KAChC4S,KAAK,EAAE;OAAE5S,QAAQ,EAAE;MAAU;KAC7BzU,eAAe,EAAE4Z;IACjB,CAAC;GACF,4CAAI,kCAAgByD,gBAAgB,CAACzD,aAAa,CAAC;GAEnD,OAAOA,aAAa;CACrB;CAAC,4BAGD;GACC,MAAMuN,QAAQ,GAAG,4CAAI,wCACnB7lB,MAAM,CAAC,CAAC;KAAEgmB;IAAoB,KAAKA,kBAAkB,KAAK,IAAI,CAAC;GAEjE,MAAMC,aAAa,GAAGJ,QAAQ,CAACriB,GAAG,CAAE0iB,OAAO,IAAK;KAC/C,MAAMxX,OAAO,GAAGpL,MAAM,CAACoL,OAAO,CAACwX,OAAO,CAACxJ,MAAM,CAAC;KAC9C,MAAMA,MAAM,GAAGhO,OAAO,CAAClL,GAAG,CAAC,CAAC,CAAChB,IAAI,EAAEjH,KAAK,CAAC,KAAK;OAC7C,MAAM;SAAE2M,KAAK;SAAEie;QAAM,GAAG5qB,KAAK;OAE7B,OAAOkB,aAAG,CAACC,MAAM,sBAAC;;;mBAGL,CAAO;mBACP,CAAe;;;eAGnB,CAAwB;0BACb,CAAoC;;;SAGrD,CAAsD;;;KAGzD,GAXe8F,IAAI,EACJ0jB,OAAO,CAAC/hB,IAAI,EAGhB/E,aAAG,CAACC,UAAU,CAAC6I,KAAK,CAAC,EACVpF,cAAI,CAAClG,MAAM,CAACwC,aAAG,CAACC,UAAU,CAAC8mB,IAAI,CAAC,CAAC,EAGlD/mB,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC;MAIxD,CAAC;KACF,4CAAI,kCAAgBsd,cAAc,CAACD,MAAM,CAAC;KAE1C,MAAM+H,cAAc,GAAGhoB,aAAG,CAACC,MAAM,sBAAC;;;wBAGf,CAAmC;;QAEnD,CAAqD;;OAEtD,CAAS;;IAEX,GANqBwpB,OAAO,CAAChe,KAAK,GAAG,OAAO,GAAG,MAAM,EAEhDge,OAAO,CAAChe,KAAK,GAAG9I,aAAG,CAACC,UAAU,CAAC6mB,OAAO,CAAChe,KAAK,CAAC,GAAG,EAAE,EAEnDwU,MAAM,CAET;KACD,4CAAI,gDAAuB8C,GAAG,CAAC0G,OAAO,CAAC/hB,IAAI,EAAEsgB,cAAc,CAAC;KAE5D,IAAI,4CAAI,wCAAmBvkB,GAAG,CAACgmB,OAAO,CAAC/hB,IAAI,CAAC,EAC5C;;OAECsgB,cAAc,CAAC9gB,KAAK,CAACsU,OAAO,GAAG,MAAM;;KAGtC,OAAOwM,cAAc;IACrB,CAAC;GAEF,OAAOhoB,aAAG,CAACC,MAAM,oBAAC;;MAEhB,CAAgB;;GAElB,GAFIupB,aAAa;CAGlB;CAAC,0BAqBeG,MAAe,EAC/B;GACC,IAAIA,MAAM,EACV;KACCpnB,aAAG,CAACyS,QAAQ,yCAAC,IAAI,eAAO,YAAY,CAAC;KAErC;;GAGDzS,aAAG,CAACmL,WAAW,yCAAC,IAAI,eAAO,YAAY,CAAC;CACzC;CAAC,6BAID;GACC,MAAMkc,gBAAgB,GAAG,EAAE;GAC3B,MAAMC,aAAa,GAAG,EAAE;GACxB,MAAMC,aAAa,GAAG;KACrBtqB,IAAI,EAAE;OACLiM,KAAK,EAAE,wBAAwB;OAC/Bie,IAAI,EAAE;;IAEP;GACD,IAAI,yCAAC,IAAI,mBAAS,EAClB;KACCI,aAAa,CAACloB,IAAI,GAAG;OACpB6J,KAAK,EAAE,wBAAwB;OAC/Bie,IAAI,EAAE;MACN;;GAEFI,aAAa,CAACxU,MAAM,GAAG;KACtB7J,KAAK,EAAE,0BAA0B;KACjCie,IAAI,EAAE;IACN;GAED,IAAIK,MAAM,GAAG;KACZC,UAAU,EAAE,gCAAgC;KAC5CC,OAAO,EAAE;IACT;GAED,IAAI,4CAAI,gCAAiB,KAAK,EAC9B;KACC,IAAIC,uBAAuB,GAAG,sCAAsC;KACpE,IAAIC,oBAAoB,GAAG,6CAA6C;KACxE,IAAIC,mBAAmB,GAAG,yCAAyC;KACnE,IAAI,4CAAI,kCAAgB7Y,cAAc,EACtC;OACC2Y,uBAAuB,GAAG,4CAAI,sEAC3B,wDAAwD,GACxD,uDAAuD;OAC1DC,oBAAoB,GAAG,4CAAI,sEACxB,+DAA+D,GAC/D,8DAA8D;OACjEC,mBAAmB,GAAG,4CAAI,sEACvB,2DAA2D,GAC3D,0DAA0D;;KAG9DvjB,MAAM,CAACpC,MAAM,CAACmlB,gBAAgB,EAAE;OAC/B/T,cAAc,EAAE;SACfpK,KAAK,EAAE,8CAA8C;SACrDie,IAAI,EAAEU;QACN;OACDjV,YAAY,EAAE;SACb1J,KAAK,EAAE,wCAAwC;SAC/Cie,IAAI,EAAE;;MAEP,CAAC;KACF7iB,MAAM,CAACpC,MAAM,CAAColB,aAAa,EAAE;OAC5BjU,YAAY,EAAE;SACbnK,KAAK,EAAE,2CAA2C;SAClDie,IAAI,EAAEQ;;MAEP,CAAC;KAEF,4CAAI,IAAI,yEACR;OACCrjB,MAAM,CAACpC,MAAM,CAAColB,aAAa,EAAE;SAC5B/T,eAAe,EAAE;WAChBrK,KAAK,EAAE,wCAAwC;WAC/Cie,IAAI,EAAES;;QAEP,CAAC;;KAGHJ,MAAM,GAAG;OACRC,UAAU,EAAE,oCAAoC;OAChDC,OAAO,EAAE;MACT;KAED,OAAO,CACN;OACCxe,KAAK,EAAEse,MAAM,CAACC,UAAU;OACxB/J,MAAM,EAAE2J,gBAAgB;OACxBliB,IAAI,EAAE;MACN,EACD;OACC+D,KAAK,EAAEse,MAAM,CAACE,OAAO;OACrBhK,MAAM,EAAE4J,aAAa;OACrBniB,IAAI,EAAE;MACN,EACD;OACC+D,KAAK,EAAE,4BAA4B;OACnCwU,MAAM,EAAE6J,aAAa;OACrBpiB,IAAI,EAAE;MACN,EACD;OAEC+D,KAAK,EAAE,IAAI;OACXwU,MAAM,EAAE;SACPlK,gBAAgB,EAAE;WACjBtK,KAAK,EAAE,qCAAqC;WAC5Cie,IAAI,EAAE;;QAEP;OACDhiB,IAAI,EAAE;MACN,CACD;IACD,MAED;KACCb,MAAM,CAACpC,MAAM,CAACmlB,gBAAgB,EAAE;OAC/BpU,WAAW,EAAE;SACZ/J,KAAK,EAAE,uBAAuB;SAC9Bie,IAAI,EAAE;QACN;OACDvU,YAAY,EAAE;SACb1J,KAAK,EAAE,wCAAwC;SAC/Cie,IAAI,EAAE;QACN;OACDtU,MAAM,EAAE;SACP3J,KAAK,EAAE,6BAA6B;SACpCie,IAAI,EAAE;QACN;OACDrU,OAAO,EAAE;SACR5J,KAAK,EAAE,kCAAkC;SACzCie,IAAI,EAAE;;MAEP,CAAC;KACF7iB,MAAM,CAACpC,MAAM,CAAColB,aAAa,EAAE;OAC5BtU,SAAS,EAAE;SAAE,GAAGqU,gBAAgB,CAACpU;QAAa;OAC9CC,UAAU,EAAE;SACX,GAAGmU,gBAAgB,CAACzU,YAAY;SAChCuU,IAAI,EAAE;QACN;OACDhU,IAAI,EAAE;SACL,GAAGkU,gBAAgB,CAACxU,MAAM;SAC1BsU,IAAI,EAAE;QACN;OACD/T,KAAK,EAAE;SACN,GAAGiU,gBAAgB,CAACvU,OAAO;SAC3BqU,IAAI,EAAE;;MAEP,CAAC;KACF,OAAO,CACN;OACCje,KAAK,EAAEse,MAAM,CAACC,UAAU;OACxB/J,MAAM,EAAE2J,gBAAgB;OACxBliB,IAAI,EAAE;MACN,EACD;OACC+D,KAAK,EAAEse,MAAM,CAACE,OAAO;OACrBhK,MAAM,EAAE4J,aAAa;OACrBniB,IAAI,EAAE;MACN,EACD;OACC+D,KAAK,EAAE,4BAA4B;OACnCwU,MAAM,EAAE6J,aAAa;OACrBpiB,IAAI,EAAE;MACN,CACD;;CAEH;CAAC,2CAGD;GACC,OAAO,4CAAI,kCAAgBiK,uBAAuB,KAAKC,2BAAiB,CAACC,QAAQ;CAClF;CAAC,uCAE4B3O,KAAyB,EACtD;GACC,IAAI,yCAAC,IAAI,mEAAgC,EACzC;KACC;;GAGD,IAAI,yCAAC,IAAI,uDAA0B,EACnC;KACC;;GAGDA,KAAK,CAACqf,UAAU,EAAE;GAClB,IACA;KACC,MAAMtC,MAAM,GAAG,MAAM,4CAAI,kCAAgBI,IAAI,EAAE;KAC/C,IAAI,CAACJ,MAAM,EACX;OACC;;KAED,MAAMnU,GAAG,GAAG,4CAAI,kCAAgBvH,cAAc,EAAE;KAChD,4CAAI,0DAA6B,KAAK;KACtC,4CAAI,0BAAY+F,KAAK,EAAE;KACvB,4CAAI,0DAA6B,IAAI;KACrC,IAAI,CAAC1J,IAAI,CAAC,MAAM,EAAE;OAAEkL,GAAG;OAAEmU;MAAQ,CAAC;KAClC,4CAAI,0BAAYiJ,IAAI,CAAC;OACpBhmB,KAAK,EAAE,8BAA8B;OACrCimB,MAAM,EAAE;MACR,CAAC;IACF,CACD,MACA;KACC,IAAI,4CAAI,qCAAuBF,2BAAS,4CAAI,IAAI,mCAAgB,EAChE;OACC,4CAAI,0BAAYC,IAAI,CAAC;SACpBhmB,KAAK,EAAE,8BAA8B;SACrCimB,MAAM,EAAE;QACR,CAAC;;;CAGL;CAAC,6CAGD;GACC,OAAO,4CAAI,uBAAa,4CAAI,kCAAgB5X,cAAc;CAC3D;CAAC,mCAEwBzS,KAAqC,EAC9D;GACC,IAAI,4CAAI,wCAAmB2E,GAAG,CAAC3E,KAAK,CAAC6T,KAAK,CAAC,EAC3C;KACC,OAAO,KAAK;;GAGb,OAAO,CAAC,4CAAI,kCAAgBpB,cAAc,IACtC,CAAC8Y,MAAM,CAACvrB,KAAK,CAACC,IAAI,CAACyC,KAAK,CAAC,CAAC8oB,UAAU,CAAC,eAAe,CAAC;CAE1D;;;;;;;;;"}