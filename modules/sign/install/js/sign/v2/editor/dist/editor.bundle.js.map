{"version":3,"file":"editor.bundle.js","sources":["../src/blocks/dummy.js","../src/blocks/date.js","../src/blocks/myrequisites.js","../../../document/src/ui.js","../src/blocks/mysign.js","../src/blocks/mystamp.js","../src/blocks/number.js","../src/blocks/reference.js","../src/blocks/myreference.js","../src/blocks/requisites.js","../src/blocks/stamp.js","../src/blocks/sign.js","../src/blocks/text.js","../src/blocks/b2e/b2ereference.js","../src/blocks/b2e/myb2ereference.js","../src/blocks/ui.js","../src/blocks/style.js","../src/blocks/block.js","../src/blocks/resize.js","../src/blocks/blocksManager.js","../src/index.js"],"sourcesContent":["import { Tag, Text as TextFormat } from 'main.core';\nimport Block from './block';\nimport { EventEmitter } from \"main.core.events\";\n\nexport default class Dummy extends EventEmitter\n{\n\tblock: Block;\n\tdata: any = {};\n\tevents= {\n\t\tonChange: 'onChange',\n\t\tonColorStyleChange: 'onColorStyleChange',\n\t};\n\n\tstatic defaultTextBlockPaddingStyles = {\n\t\tpadding: \"5px 8px\"\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {Block} block\n\t */\n\tconstructor(block: Block)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.Editor.Blocks.Dummy')\n\t\tthis.block = block;\n\t}\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t}\n\n\t/**\n\t * Changes only text key in data.\n\t * @param {string} text\n\t */\n\tsetText(text: string)\n\t{\n\t\tthis.setData({ text });\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Returns current data.\n\t * @return {any}\n\t */\n\tgetData(): any\n\t{\n\t\treturn this.data;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\treturn null;\n\t}\n\n\t/**\n\t * @return {HTMLElement | null}\n\t */\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\treturn null;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t${TextFormat.encode(this.data.text || '').toString().replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tthis.block.forceSave();\n\t}\n\n\tonChange(): void\n\t{\n\t\tthis.emit(this.events.onChange)\n\t}\n\n\tgetStyles(): {[styleName: string]: string}\n\t{\n\t\treturn {};\n\t}\n\n\tchangeStyleColor(color: string): void\n\t{}\n}\n","import 'date';\nimport { Loc, Tag, Dom } from 'main.core';\n\nimport Dummy from './dummy';\n\nexport default class Date extends Dummy\n{\n\t#calendar: BX.JCCalendar;\n\t#calendarOpened: boolean = false;\n\t#date: string;\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 105,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#date = this.data.text;\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\tonActionClick()\n\t{\n\t\tthis.#calendar = BX.calendar({\n\t\t\tnode: this.block.getLayout(),\n\t\t\tfield: this.getViewContent(),\n\t\t\tvalue: this.#date,\n\t\t\tbTime: false,\n\t\t\tcallback_after: (date) => {\n\t\t\t\tthis.setText(\n\t\t\t\t\tBX.date.format(BX.date.convertBitrixFormat(BX.message('FORMAT_DATE')), date, null)\n\t\t\t\t);\n\t\t\t\tthis.block.renderView();\n\t\t\t}\n\t\t});\n\n\t\tthis.#calendarOpened = true;\n\t\tconst targetContainer = document.querySelector('.sign-editor__content');\n\t\tconst { popup } = this.#calendar;\n\t\tpopup.targetContainer = targetContainer;\n\t\tif (popup.popupContainer.parentElement !== targetContainer)\n\t\t{\n\t\t\tDom.append(popup.popupContainer, targetContainer);\n\t\t\tpopup.adjustPosition();\n\t\t}\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_DATE_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Closes calendar if open.\n\t */\n\t#closeCalendar()\n\t{\n\t\tif (this.#calendar)\n\t\t{\n\t\t\tthis.#calendar.Close();\n\t\t\tthis.#calendarOpened = false;\n\t\t}\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tif (!this.#calendarOpened)\n\t\t{\n\t\t\tthis.block.forceSave();\n\t\t}\n\n\t\tthis.#calendarOpened = false;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Date.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { FieldsetViewer } from 'crm.requisite.fieldset-viewer';\nimport { Cache, Loc, Tag, Text } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { UI } from 'ui.notification';\n\nimport Dummy from './dummy';\n\nexport default class MyRequisites extends Dummy\n{\n\t#cache = new Cache.MemoryCache();\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 220,\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.#getFieldsetViewer().show();\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...MyRequisites.defaultTextBlockPaddingStyles };\n\t}\n\n\t#getFieldsNameBlackList(): Array<string>\n\t{\n\t\treturn [\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t];\n\t}\n\n\t#getCreateFieldTypeNamesBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'file',\n\t\t\t'employee',\n\t\t\t'boolean',\n\t\t\t'money',\n\t\t]);\n\t}\n\n\t#filterRequisiteCreateFields(fields: Array<{ name: string }>): Array<Object>\n\t{\n\t\treturn fields.filter(\n\t\t\t(createFieldType) => !this.#getCreateFieldTypeNamesBlackList().has(createFieldType.name),\n\t\t);\n\t}\n\n\t#getFieldsetViewer(): FieldsetViewer\n\t{\n\t\treturn this.#cache.remember('fieldSetViewer', () => {\n\t\t\tconst blocksManager = this.block.blocksManager;\n\t\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\t\tconst { entityTypeId, presetId, entityId } = member;\n\t\t\tconst cid = member.cid ?? entityId;\n\n\t\t\tconst fieldsetViewer = new FieldsetViewer({\n\t\t\t\tentityTypeId,\n\t\t\t\tentityId: cid,\n\t\t\t\tdocumentUid: blocksManager.getDocumentUid(),\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.block.assign();\n\t\t\t\t\t\tthis.#cache.delete('fieldSetViewer');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tfieldListEditorOptions: {\n\t\t\t\t\tfieldsPanelOptions: {\n\t\t\t\t\t\tfilter: {\n\t\t\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t\t\t'COMPANY',\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t\t\t'list',\n\t\t\t\t\t\t\t\t'string',\n\t\t\t\t\t\t\t\t'date',\n\t\t\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t\t\t'text',\n\t\t\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t\t\t'address',\n\t\t\t\t\t\t\t\t'url',\n\t\t\t\t\t\t\t\t'double',\n\t\t\t\t\t\t\t\t'integer',\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t'-fields': [\n\t\t\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getFieldsNameBlackList().includes(fieldName),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfieldsFactory: {\n\t\t\t\t\t\t\tfilter: this.#filterRequisiteCreateFields.bind(this),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpresetId,\n\t\t\t\t\t\tcontrollerOptions: {\n\t\t\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\t\t\tpresetId,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tpopupOptions: { overlay: true, cacheable: false },\n\t\t\t})\n\t\t\t\t.setEndpoint('sign.api_v1.Integration.Crm.FieldSet.load')\n\t\t\t;\n\n\t\t\tfieldsetViewer.subscribe('onFieldSetLoadError', this.#onFieldsetViewerFieldsetLoadError.bind(this));\n\n\t\t\treturn fieldsetViewer;\n\t\t});\n\t}\n\n\t#onFieldsetViewerFieldsetLoadError(event: BaseEvent<{ requestErrors: Array<{ message: string, code: string }> }>)\n\t{\n\t\tthis.#getFieldsetViewer().hide();\n\t\tconst hasAccessDeniedError = event.getData().requestErrors.some((error) => error.code === 'ACCESS_DENIED');\n\t\tif (hasAccessDeniedError)\n\t\t{\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(Loc.getMessage('SIGN_EDITOR_ERROR_REQUISITE_BLOCK_REQUISITE_ACCESS_DENIED')),\n\t\t\t\tautoHideDelay: 3000,\n\t\t\t\twidth: 480,\n\t\t\t});\n\t\t}\n\t}\n}\n","import { Dom, Event, Loc, Tag, Text as TextFormat, Reflection, Type } from 'main.core';\nimport { UI as SignUI } from 'sign.ui';\nimport { MemberItem } from './types/document';\n\nimport './style.css';\nimport 'color_picker';\n\ntype BlockLayoutOptions = {\n\tonRemove: () => {},\n\tonSave: () => {}\n};\n\nexport type ColorPickerOptions = {\n\tcolors?: Array<Array<string>>,\n\tallowCustomColor?: boolean,\n\tselectedColor?: string,\n\tcolorPreview?: boolean,\n}\n\nconst ColorPicker = Reflection.getClass('BX.ColorPicker');\n\nexport default class UI\n{\n\t/**\n\t * Sets width/height/top/left to element.\n\t * @param {HTMLElement} element\n\t * @param {{[key: string]: number}} rect\n\t */\n\tstatic setRect(element: HTMLElement, rect: {[key: string]: number})\n\t{\n\t\tObject.keys(rect).map(key => {\n\t\t\trect[key] = parseInt(rect[key]) + 'px';\n\t\t});\n\t\tDom.style(element, rect);\n\t}\n\n\t/**\n\t * Returns block's layout.\n\t * @param {BlockLayoutOptions} options Layout options.\n\t * @return {HTMLElement}\n\t */\n\tstatic getBlockLayout(options: BlockLayoutOptions): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-wrapper\">\n\t\t\t\t<div class=\"sign-document__block-panel--wrapper\" data-role=\"sign-block__actions\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-content\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-actions\">\n\t\t\t\t\t<div class=\"sign-document__block-actions--wrapper\">\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --remove sign-block-action-remove\" data-role=\"removeAction\" onclick=\"${options.onRemove}\"></button>\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --save sign-block-action-save\" data-role=\"saveAction\" onclick=\"${options.onSave}\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns member selector for block.\n\t * @param {Array<MemberItem>} members All document's members.\n\t * @param {number} selectedValue Selected member.\n\t * @param {() => {}} onChange Handler on change value.\n\t * @return {HTMLElement}\n\t */\n\tstatic getMemberSelector(members: Array<MemberItem>, selectedValue: number,  onChange: () => {}): HTMLElement\n\t{\n\t\tconst menuItems = {};\n\t\tlet selectedName = Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\n\t\tmembers.map(member => {\n\t\t\tmember.name = member.name || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\t\t\tmenuItems[member.part] = member.name;\n\n\t\t\tif (member.part === selectedValue)\n\t\t\t{\n\t\t\t\tselectedName = member.name;\n\t\t\t}\n\t\t});\n\n\t\tconst memberSelector = (members.length > 1)\n\t\t\t? Tag.render`<span>${TextFormat.encode(selectedName)}</span>`\n\t\t\t: Tag.render`<i>${TextFormat.encode(selectedName)}</i>`;\n\n\t\tif (members.length > 1)\n\t\t{\n\t\t\tSignUI.bindSimpleMenu({\n\t\t\t\tbindElement: memberSelector,\n\t\t\t\titems: menuItems,\n\t\t\t\tactionHandler: value => {\n\t\t\t\t\tmemberSelector.innerHTML = menuItems[value];\n\t\t\t\t\tonChange(parseInt(value));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-block-member-wrapper\">\n\t\t\t\t${memberSelector}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns resizing area's layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getResizeArea(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__resize-area\">\n\t\t\t\t<div class=\"sign-area-resizable-controls\">\n\t\t\t\t\t<span class=\"sign-document__move-control\"></span>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-right\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --left-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-left\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns style panel layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getStylePanel(\n\t\tactionHandler: (actionName: string, actionValue: string) => {},\n\t\tcollectStyles: {[key: string]: string},\n\t): HTMLElement\n\t{\n\t\t// font family selector\n\t\tconst fonts = {\n\t\t\t'\"Times New Roman\", Times':   '<span style=\"font-family: \\'Times New Roman\\', Times\">Times New Roman</span>',\n\t\t\t'\"Courier New\"':              '<span style=\"font-family: \\'Courier New\\'\">Courier New</span>',\n\t\t\t'Arial, Helvetica':           '<span style=\"font-family: Arial, Helvetica\">Arial / Helvetica</span>',\n\t\t\t'\"Arial Black\", Gadget':      '<span style=\"font-family: \\'Arial Black\\', Gadget\">Arial Black</span>',\n\t\t\t'Tahoma, Geneva':             '<span style=\"font-family: Tahoma, Geneva\">Tahoma / Geneva</span>',\n\t\t\t'Verdana':                    '<span style=\"font-family: Verdana\">Verdana</span>',\n\t\t\t'Georgia, serif':             '<span style=\"font-family: Georgia, serif\">Georgia</span>',\n\t\t\t'monospace':                  '<span style=\"font-family: monospace\">monospace</span>',\n\t\t};\n\t\tconst fontFamily = Tag.render`<div class=\"sign-document__block-style-btn --btn-font-family\">${fonts[collectStyles['font-family']] || 'Font'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontFamily,\n\t\t\titems: fonts,\n\t\t\tactionHandler: value => {\n\t\t\t\tfontFamily.innerHTML = fonts[value];\n\t\t\t\tactionHandler('family', value);\n\t\t\t}\n\t\t});\n\n\t\t// font size selector\n\t\t\n\t\tlet fontSizereal = parseInt(collectStyles['font-size']);\n\t\tlet fontSizeValue = 14;\n\t\t\n\t\tif (fontSizereal) \n\t\t{\n\t\t\tfontSizeValue = fontSizereal;\n\t\t}\n\n\t\tconst fontSize = Tag.render`<div class=\"sign-document__block-style-btn --btn-fontsize\">${fontSizeValue+ 'px' || '<i></i>'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontSize,\n\t\t\titems: [\n\t\t\t\t'6px', '7px', '8px', '9px', '10px', '11px', '12px', '13px', '14px', '15px', '16px',\n\t\t\t\t'18px', '20px', '22px', '24px', '26px', '28px', '36px', '48px', '72px'\n\t\t\t],\n\t\t\tactionHandler: value => {\n\t\t\t\tfontSize.innerHTML = parseInt(value) + 'px';\n\t\t\t\tactionHandler('size', value);\n\t\t\t},\n\t\t\tcurrentValue: fontSizeValue,\n\t\t});\n\n\t\t// color\n\t\tconst { layout: fontColor } = UI.getColorSelectorBtn(\n\t\t\tcollectStyles.color ?? '#000',\n\t\t\t(color) => actionHandler('color', color),\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style--panel\">\n<!--\t\t\t\t<div class=\"sign-document__block-style&#45;&#45;move-control\"></div>-->\n\t\t\t\t${fontFamily}\n\t\t\t\t${fontSize}\n\t\t\t\t${fontColor}\n\t\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-bold\" data-action=\"bold\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-italic\" data-action=\"italic\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-underline\" data-action=\"underline\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-strike\" data-action=\"through\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-left\" data-action=\"left\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-center\" data-action=\"center\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-right\" data-action=\"right\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-justify\" data-action=\"justify\"><i></i></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tstatic getColorSelectorBtn(\n\t\tdefaultColorPickerColor: string,\n\t\tonColorSelect: (string) => any,\n\t\tcolorPickerOptions: ColorPickerOptions = {},\n\t): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\tconst layout = Tag.render`<div class=\"sign-document__block-style-btn --btn-color\">\n\t\t\t\t<span class=\"sign-document__block-style-btn--color-block\"></span> \n\t\t\t\t<span>${Loc.getMessage('SIGN_JS_DOCUMENT_STYLE_COLOR')}</span>\n\t\t\t</div>`\n\t\t;\n\t\tUI.updateColorSelectorBtnColor(layout, defaultColorPickerColor);\n\t\tconst updatedColorPickerOptions = {\n\t\t\t...colorPickerOptions,\n\t\t\tbindElement: layout,\n\t\t\tonColorSelected:\n\t\t\t\t(color) => {\n\t\t\t\t\tonColorSelect(color);\n\t\t\t\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\t\t\t},\n\t\t};\n\n\t\tconst picker = new ColorPicker(updatedColorPickerOptions);\n\n\t\tEvent.bind(layout, 'click', () => {\n\t\t\tpicker.open();\n\t\t});\n\n\t\treturn { layout, colorPicker: picker };\n\t}\n\n\tstatic updateColorSelectorBtnColor(layout: HTMLElement, color: string): void\n\t{\n\t\tconst circleColor = layout.querySelector('.sign-document__block-style-btn--color-block');\n\t\tif (Type.isNil(circleColor))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(\n\t\t\tcircleColor,\n\t\t\t'background-color',\n\t\t\tcolor,\n\t\t);\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat } from 'main.core';\nimport UI from '../../../../document/src/ui';\nimport Block from './block';\nimport Dummy from './dummy';\n\nexport default class MySign extends Dummy\n{\n\tdataSrc: string;\n\n\t#cache = new Cache.MemoryCache();\n\t#defaultSignatureColor: string = '#0047ab';\n\t#availableSignatureColors: string = ['#000', this.#defaultSignatureColor, '#8b00ff'];\n\t#selectedSignatureColor: string | null = null;\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 200,\n\t\t\theight: 70,\n\t\t};\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tlet src = null;\n\t\tif (this.dataSrc)\n\t\t{\n\t\t\tsrc = this.dataSrc;\n\t\t}\n\t\telse if (this.data.base64)\n\t\t{\n\t\t\tsrc = 'data:image;base64,' + this.data.base64;\n\t\t}\n\n\t\tif (src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<img src=\"${src}\" alt=\"\">\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || this.getPlaceholderLabel())}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_MY_SIGN');\n\t}\n\n\t#getSignatureColor(): string\n\t{\n\t\treturn this.#selectedSignatureColor ?? this.#defaultSignatureColor;\n\t}\n\n\tonClickOut()\n\t{\n\t\tsuper.onClickOut();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tonRemove()\n\t{\n\t\tsuper.onRemove();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\t#closeColorPickerPopup()\n\t{\n\t\tconst { colorPicker } = this.#getColorSelectorBtn();\n\t\tcolorPicker.close();\n\t}\n\n\tonSave()\n\t{\n\t\tsuper.onSave();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tgetStyles(): { [styleName: string]: string }\n\t{\n\t\treturn { backgroundPosition: 'center !important', color: this.#getSignatureColor() };\n\t}\n\n\tchangeStyleColor(color: string, emitEvent: boolean = true): void\n\t{\n\t\tsuper.changeStyleColor(color);\n\t\tthis.#selectedSignatureColor = color;\n\n\t\tconst { layout, colorPicker } = this.#getColorSelectorBtn();\n\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\tcolorPicker.setSelectedColor(color);\n\n\t\tif (emitEvent)\n\t\t{\n\t\t\tthis.emit(this.events.onColorStyleChange);\n\t\t}\n\t}\n\n\t/**\n\t * @return {HTMLElement | null}\n\t */\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\tconst { layout: colorSelectorBtnLayout } = this.#getColorSelectorBtn();\n\n\t\treturn Tag.render`\n\t\t\t<div style=\"display: flex; flex-direction: row;\">\n\t\t\t${colorSelectorBtnLayout}\n\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t<div class=\"sign-document-block-member-wrapper\">\n\t\t\t\t<i>${Loc.getMessage('SIGN_JS_DOCUMENT_SIGN_ACTION_BUTTON')}</i>\n\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getColorSelectorBtn(): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\treturn this.#cache.remember('colorSelectorBtn', () => UI.getColorSelectorBtn(\n\t\t\tthis.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t(color) => this.changeStyleColor(color),\n\t\t\t{\n\t\t\t\tcolors: [this.#availableSignatureColors],\n\t\t\t\tallowCustomColor: false,\n\t\t\t\tselectedColor: this.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t\tcolorPreview: false,\n\t\t\t},\n\t\t));\n\t}\n}\n","import { Loc, Tag, Text } from 'main.core';\nimport { Api } from 'sign.v2.api';\nimport { Uploader } from 'ui.stamp.uploader';\nimport Dummy from './dummy';\nimport Block from './block';\n\nexport default class MyStamp extends Dummy\n{\n\tstatic currentBlock: Block;\n\n\tdataSrc: string;\n\t#uploader: Uploader;\n\t#api: Api;\n\n\tconstructor(block: Block)\n\t{\n\t\tsuper(block);\n\n\t\tthis.#uploader = new Uploader({\n\t\t\tcontroller: {\n\t\t\t\tupload: 'sign.upload.stampUploadController',\n\t\t\t},\n\t\t\tcontact: {\n\t\t\t\tid: 0,\n\t\t\t\tlabel: 'Admin'\n\t\t\t},\n\t\t});\n\t\tthis.#uploader.subscribe('onSaveAsync', async (event) => {\n\t\t\tMyStamp.currentBlock.await(true);\n\t\t\tconst eventData = event.getData();\n\t\t\tif (!eventData?.file?.serverId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dataSrc = eventData.file.serverPreviewUrl;\n\t\t\tthis.#saveStamp(MyStamp.currentBlock, eventData.file.serverId);\n\t\t});\n\t\tthis.#api = new Api();\n\t}\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 151,\n\t\t\theight: 151\n\t\t};\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\tconst title = this.data.__view?.base64 ?\n\t\t\tLoc.getMessage('SIGN_EDITOR_BLOCK_CHANGE_STAMP') :\n\t\t\tLoc.getMessage('SIGN_EDITOR_BLOCK_LOAD_STAMP');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${title}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tMyStamp.currentBlock = this.block;\n\t\tthis.#uploader.show();\n\t}\n\n\t/**\n\t * Saves stamp to backend.\n\t * @param {Block} block\n\t * @param {string} fileId\n\t */\n\tasync #saveStamp(block: Block, fileId: string)\n\t{\n\t\tconst memberPart = block.getMemberPart();\n\t\tconst member = block.blocksManager.getMemberByPart(memberPart);\n\t\tawait this.#api.saveStamp(member.uid, fileId);\n\t\tblock.assign();\n\t\tconst layout = MyStamp.currentBlock.getLayout();\n\t\tconst button = layout.querySelector('button[data-role=\"action\"]');\n\t\tbutton.textContent = Loc.getMessage('SIGN_EDITOR_BLOCK_CHANGE_STAMP');\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tlet src = null;\n\n\t\tif (this.data.__view?.base64)\n\t\t{\n\t\t\tsrc = 'data:image;base64,' + this.data.__view.base64;\n\t\t}\n\n\t\tif (src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_stamp\" style=\"background-image: url(${src})\"></div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata --stamp\"></div>\n\t\t\t`;\n\t\t}\n\t}\n}\n","import { Loc, Tag, Text as TextFormat } from 'main.core';\nimport { Api } from 'sign.v2.api';\n\nimport Dummy from './dummy';\n\nexport default class Number extends Dummy\n{\n\tstatic sliderOnMessageBind: boolean = false;\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 100,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tevent.stopPropagation();\n\t\tif (!Number.sliderOnMessageBind)\n\t\t{\n\t\t\tNumber.sliderOnMessageBind = true;\n\n\t\t\tBX.addCustomEvent(window, 'SidePanel.Slider:onMessage', async (event) =>\n\t\t\t{\n\t\t\t\tconst isEditor = event.slider?.url === 'editor';\n\t\t\t\tif (isEditor && event.getEventId() === 'numerator-saved-event')\n\t\t\t\t{\n\t\t\t\t\tconst numeratorData = event.getData();\n\t\t\t\t\tconst currentBlock = event?.sender?.options?.data?.block ?? this.block;\n\n\t\t\t\t\tif (numeratorData.type === 'CRM_SMART_DOCUMENT')\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentBlock.await(true);\n\t\t\t\t\t\tconst api = new Api();\n\t\t\t\t\t\tconst uid = currentBlock.blocksManager.getDocumentUid();\n\t\t\t\t\t\tawait api.refreshEntityNumber(uid);\n\t\t\t\t\t\tcurrentBlock.assign();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst { crmNumeratorUrl } = this.data.__view;\n\t\tBX.SidePanel.Instance.open(crmNumeratorUrl, {\n\t\t\twidth: 480,\n\t\t\tcacheable: false,\n\t\t\tdata: {\n\t\t\t\tblock: this.block\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_NUMBER_ACTION_EDIT')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-number\">\n\t\t\t\t${TextFormat.encode(this.data.text || '').toString()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Number.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat, Type, Dom } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport type { FieldSelectEvent, FieldSelectEventData } from '../types/events/fieldSelectEvent';\nimport Dummy from './dummy';\nimport { Selector } from \"crm.form.fields.selector\";\n\nexport default class Reference extends Dummy\n{\n\t#cache = new Cache.MemoryCache();\n\t#field: string;\n\t#actionButton: HTMLElement;\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field ?? '';\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\t#onActionClick()\n\t{\n\t\tthis.#getCrmFieldSelectorPanel()\n\t\t\t.show()\n\t\t\t.then((selectedNames: Array<string>) => {\n\t\t\t\tconst eventSelectedNames = [...selectedNames];\n\t\t\t\tif (selectedNames.length === 0 && Type.isStringFilled(this.#field))\n\t\t\t\t{\n\t\t\t\t\teventSelectedNames.push(this.#field);\n\t\t\t\t}\n\t\t\t\tthis.#emitOnFieldSelectEvent(eventSelectedNames);\n\n\t\t\t\tif (selectedNames.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.block.getLayout(), '--invalid');\n\t\t\t\tthis.#field = selectedNames[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tif (Type.isUndefined(Selector))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel()\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionButton = this.#actionButton.querySelector('button');\n\t\tconst defaultCaption = Loc.getMessage('SIGN_JS_DOCUMENT_REFERENCE_ACTION_BUTTON');\n\t\tif (!this.#field)\n\t\t{\n\t\t\tactionButton.textContent = defaultCaption;\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldSelector = this.#cache.get('fieldSelector') ?? this.#getCrmFieldSelectorPanel();\n\t\tconst fieldsList = fieldSelector.getFieldsList();\n\t\tconst fields = [\n\t\t\t...fieldsList?.CONTACT?.FIELDS ?? [],\n\t\t\t...fieldsList?.SMART_DOCUMENT?.FIELDS ?? [],\n\t\t];\n\t\tconst field = fields.find((field) => field.name === this.#field);\n\t\tconst caption = field ? field.caption : defaultCaption;\n\t\tactionButton.textContent = caption;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tif (this.data.src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div style=\"width: ${width - 14}px; height: ${height - 14}px; background: url(${this.data.src}) no-repeat top; background-size: cover;\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst className = !this.data.text ? 'sign-document__block-content_member-nodata' : '';\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"${className}\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA'))}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n\n\t#getCrmFieldSelectorPanel(): Selector\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\tconst { presetId } = member;\n\n\t\treturn this.#cache.remember('fieldSelector', () => {\n\t\t\tconst selector = new Selector({\n\t\t\t\tmultiple: false,\n\t\t\t\tcontrollerOptions: {\n\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\tpresetId,\n\t\t\t\t},\n\t\t\t\tpresetId,\n\t\t\t\tfilter: {\n\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t'CONTACT',\n\t\t\t\t\t\t'SMART_DOCUMENT',\n\t\t\t\t\t],\n\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t'list',\n\t\t\t\t\t\t'string',\n\t\t\t\t\t\t'date',\n\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t'text',\n\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t'address',\n\t\t\t\t\t\t'url',\n\t\t\t\t\t\t'double',\n\t\t\t\t\t\t'integer',\n\t\t\t\t\t],\n\t\t\t\t\t'-fields': [\n\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getCrmFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tfieldsFactory: {\n\t\t\t\t\tfilter: this.#filterRequisiteCreateFields.bind(this),\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tselector.subscribe('onSliderCloseComplete', this.#onCrmFieldSelectorSliderCloseComplete.bind(this));\n\n\t\t\treturn selector;\n\t\t});\n\t}\n\n\t#onCrmFieldSelectorSliderCloseComplete(): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\t// event already sended\n\t\t\tif (Type.isStringFilled(this.#field))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#emitOnFieldSelectEvent([]);\n\t\t});\n\t}\n\n\t#emitOnFieldSelectEvent(selectedNames: Array<string>): void\n\t{\n\t\tconst onFieldSelectEventData: FieldSelectEventData = { selectedFieldNames: selectedNames };\n\t\tconst onFieldSelectEvent: FieldSelectEvent = new BaseEvent({ data: onFieldSelectEventData });\n\t\tthis.emit('onFieldSelect', onFieldSelectEvent);\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Reference.defaultTextBlockPaddingStyles };\n\t}\n\n\t#getCrmFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t]);\n\t}\n\n\t#getCreateFieldTypeNamesBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'file',\n\t\t\t'employee',\n\t\t\t'boolean',\n\t\t\t'money',\n\t\t]);\n\t}\n\n\t#filterRequisiteCreateFields(fields: Array<{ name: string }>): Array<Object>\n\t{\n\t\treturn fields.filter(\n\t\t\t(createFieldType) => !this.#getCreateFieldTypeNamesBlackList().has(createFieldType.name),\n\t\t);\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat, Type, Dom } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport type { FieldSelectEvent, FieldSelectEventData } from '../types/events/fieldSelectEvent';\nimport Dummy from './dummy';\nimport { Selector } from 'crm.form.fields.selector';\n\nexport default class MyReference extends Dummy\n{\n\t#field: string;\n\t#actionButton: HTMLElement;\n\t#cache = new Cache.MemoryCache();\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field ?? '';\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\t#onActionClick()\n\t{\n\t\tthis.#getCrmFieldSelectorPanel()\n\t\t\t.show()\n\t\t\t.then((selectedNames: Array<string>): void => {\n\t\t\t\tconst eventSelectedNames = [...selectedNames];\n\t\t\t\tif (selectedNames.length === 0 && Type.isStringFilled(this.#field))\n\t\t\t\t{\n\t\t\t\t\teventSelectedNames.push(this.#field);\n\t\t\t\t}\n\t\t\t\tthis.#emitOnFieldSelectEvent(eventSelectedNames);\n\n\t\t\t\tif (selectedNames.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.block.getLayout(), '--invalid');\n\t\t\t\tthis.#field = selectedNames[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tif (Type.isUndefined(Selector))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel()\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionButton = this.#actionButton.querySelector('button');\n\t\tconst defaultCaption = Loc.getMessage('SIGN_JS_DOCUMENT_REFERENCE_ACTION_BUTTON');\n\t\tif (!this.#field)\n\t\t{\n\t\t\tactionButton.textContent = defaultCaption;\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldSelector = this.#getCrmFieldSelectorPanel();\n\t\tconst fieldsList = fieldSelector.getFieldsList();\n\t\tconst fields = [\n\t\t\t...fieldsList?.COMPANY?.FIELDS ?? [],\n\t\t\t...fieldsList?.SMART_DOCUMENT?.FIELDS ?? [],\n\t\t];\n\t\tconst field = fields.find((field) => field.name === this.#field);\n\t\tconst caption = field ? field.caption : defaultCaption;\n\t\tactionButton.textContent = caption;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tif (this.data.src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div style=\"width: ${width - 14}px; height: ${height - 14}px; background: url(${this.data.src}) no-repeat top; background-size: cover;\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\tconst className = !this.data.text ? 'sign-document__block-content_member-nodata' : '';\n\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"${className}\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_MY_BLOCKS'))}\n\t\t\t\t</div>\n\t\t\t`;\n\t}\n\n\t#getCrmFieldSelectorPanel(): Selector\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\t\tconst { presetId } = member;\n\n\t\treturn this.#cache.remember('fieldSelector', () => {\n\t\t\tconst selector = new Selector({\n\t\t\t\tmultiple: false,\n\t\t\t\tcontrollerOptions: {\n\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\tpresetId,\n\t\t\t\t},\n\t\t\t\tpresetId,\n\t\t\t\tfilter: {\n\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t'COMPANY',\n\t\t\t\t\t\t'SMART_DOCUMENT',\n\t\t\t\t\t],\n\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t'list',\n\t\t\t\t\t\t'string',\n\t\t\t\t\t\t'date',\n\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t'text',\n\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t'address',\n\t\t\t\t\t\t'url',\n\t\t\t\t\t\t'double',\n\t\t\t\t\t\t'integer',\n\t\t\t\t\t],\n\t\t\t\t\t'-fields': [\n\t\t\t\t\t\tthis.#getFieldNegativeFilter(),\n\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getCrmFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tfieldsFactory: {\n\t\t\t\t\tfilter: this.#filterRequisiteCreateFields.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t\tselector.subscribe('onSliderCloseComplete', this.#onCrmFieldSelectorSliderCloseComplete.bind(this));\n\n\t\t\treturn selector;\n\t\t});\n\t}\n\n\t#onCrmFieldSelectorSliderCloseComplete(): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\t// event already sended\n\t\t\tif (Type.isStringFilled(this.#field))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#emitOnFieldSelectEvent([]);\n\t\t});\n\t}\n\n\t#getFieldNegativeFilter(): (Object) => boolean\n\t{\n\t\tconst blackList = this.#getFieldsNameBlackList();\n\n\t\treturn (field) => {\n\t\t\treturn blackList.includes(field.name);\n\t\t};\n\t}\n\n\t#getFieldsNameBlackList(): Array<string>\n\t{\n\t\treturn [\n\t\t\t'COMPANY_LINK',\n\t\t\t'COMPANY_REG_ADDRESS',\n\t\t\t'COMPANY_ORIGIN_VERSION',\n\t\t];\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...MyReference.defaultTextBlockPaddingStyles };\n\t}\n\n\t#emitOnFieldSelectEvent(selectedNames: Array<string>): void\n\t{\n\t\tconst onFieldSelectEventData: FieldSelectEventData = { selectedFieldNames: selectedNames };\n\t\tconst onFieldSelectEvent: FieldSelectEvent = new BaseEvent({ data: onFieldSelectEventData });\n\t\tthis.emit('onFieldSelect', onFieldSelectEvent);\n\t}\n\n\t#getCrmFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t]);\n\t}\n\n\t#getCreateFieldTypeNamesBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'file',\n\t\t\t'employee',\n\t\t\t'boolean',\n\t\t\t'money',\n\t\t]);\n\t}\n\n\t#filterRequisiteCreateFields(fields: Array<{ name: string }>): Array<Object>\n\t{\n\t\treturn fields.filter(\n\t\t\t(createFieldType) => !this.#getCreateFieldTypeNamesBlackList().has(createFieldType.name),\n\t\t);\n\t}\n}\n","import { FieldsetViewer } from 'crm.requisite.fieldset-viewer';\nimport { Loc, Tag, Text as TextFormat } from 'main.core';\n\nimport Dummy from './dummy';\n\nexport default class Requisites extends Dummy\n{\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 220,\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\tevent.stopPropagation();\n\n\t\tif (!member)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { cid, entityTypeId, presetId } = member;\n\t\t(new FieldsetViewer({\n\t\t\tentityTypeId,\n\t\t\tentityId: cid,\n\t\t\tdocumentUid: blocksManager.getDocumentUid(),\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t},\n\t\t\t},\n\t\t\tfieldListEditorOptions: {\n\t\t\t\tfieldsPanelOptions: {\n\t\t\t\t\tfilter: {\n\t\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t\t'CONTACT',\n\t\t\t\t\t\t],\n\t\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t\t'list',\n\t\t\t\t\t\t\t'string',\n\t\t\t\t\t\t\t'date',\n\t\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t\t'text',\n\t\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t\t'address',\n\t\t\t\t\t\t\t'url',\n\t\t\t\t\t\t\t'double',\n\t\t\t\t\t\t\t'integer',\n\t\t\t\t\t\t],\n\t\t\t\t\t\t'-fields': [\n\t\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getCrmFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\tfieldsFactory: {\n\t\t\t\t\t\tfilter: this.#filterRequisiteCreateFields.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\tpresetId,\n\t\t\t\t\tcontrollerOptions: {\n\t\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\t\tpresetId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tpopupOptions: { overlay: true, cacheable: false },\n\t\t}))\n\t\t\t.setEndpoint('sign.api_v1.Integration.Crm.FieldSet.load')\n\t\t\t.show()\n\t\t;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst text = this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_REQUISITES');\n\t\tconst tagBody = this.data.text ? '' : ' class=\"sign-document__block-content_member-nodata\"';\n\n\t\treturn Tag.render`\n\t\t\t<div${tagBody}>\n\t\t\t\t${TextFormat.encode(text).toString().replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Requisites.defaultTextBlockPaddingStyles };\n\t}\n\n\t#getCrmFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t]);\n\t}\n\n\t#getCreateFieldTypeNamesBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'file',\n\t\t\t'employee',\n\t\t\t'boolean',\n\t\t\t'money',\n\t\t]);\n\t}\n\n\t#filterRequisiteCreateFields(fields: Array<{ name: string }>): Array<Object>\n\t{\n\t\treturn fields.filter(\n\t\t\t(createFieldType) => !this.#getCreateFieldTypeNamesBlackList().has(createFieldType.name),\n\t\t);\n\t}\n}\n","import { Loc, Tag, Text as TextFormat } from 'main.core';\nimport Dummy from './dummy';\n\nexport default class Stamp extends Dummy\n{\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 151,\n\t\t\theight: 151\n\t\t};\n\t}\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_STAMP');\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst {width, height} = this.block.getPosition();\n\n\t\tif (this.data.base64)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_stamp\" style=\"background-image: url(${src})\"></div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat } from 'main.core';\nimport UI from '../../../../document/src/ui';\nimport Stamp from './stamp';\n\nexport default class Sign extends Stamp\n{\n\t#cache = new Cache.MemoryCache();\n\t#defaultSignatureColor: string = '#0047ab';\n\t#availableSignatureColors: string = ['#000', this.#defaultSignatureColor, '#8b00ff'];\n\t#selectedSignatureColor: string | null = null;\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_SIGN');\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 200,\n\t\t\theight: 70,\n\t\t};\n\t}\n\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\tconst { layout: colorSelectorBtnLayout } = this.#getColorSelectorBtn();\n\n\t\treturn Tag.render`\n\t\t\t<div style=\"display: flex; flex-direction: row;\">\n\t\t\t${colorSelectorBtnLayout}\n\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t${TextFormat.encode(this.getPlaceholderLabel())}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [styleName: string]: string }\n\t{\n\t\treturn { backgroundPosition: 'center !important', color: this.#getSignatureColor() };\n\t}\n\n\tupdateColor(color: string)\n\t{\n\t\tsuper.updateColor(color);\n\t\tconst { layout, colorPicker } = this.#getColorSelectorBtn();\n\t\tthis.#selectedSignatureColor = color;\n\n\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\tcolorPicker.setSelectedColor(color);\n\t}\n\n\tchangeStyleColor(color: string, emitEvent: boolean = true): void\n\t{\n\t\tsuper.changeStyleColor(color);\n\t\tthis.#selectedSignatureColor = color;\n\n\t\tconst { layout, colorPicker } = this.#getColorSelectorBtn();\n\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\tcolorPicker.setSelectedColor(color);\n\n\t\tif (emitEvent)\n\t\t{\n\t\t\tthis.emit(this.events.onColorStyleChange);\n\t\t}\n\t}\n\n\t#getColorSelectorBtn(): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\treturn this.#cache.remember('colorSelectorBtn', () => UI.getColorSelectorBtn(\n\t\t\tthis.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t(color) => this.changeStyleColor(color),\n\t\t\t{\n\t\t\t\tcolors: [this.#availableSignatureColors],\n\t\t\t\tallowCustomColor: false,\n\t\t\t\tselectedColor: this.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t\tcolorPreview: false,\n\t\t\t},\n\t\t));\n\t}\n\n\t#getSignatureColor(): string\n\t{\n\t\treturn this.#selectedSignatureColor ?? this.#defaultSignatureColor;\n\t}\n\n\tonSave()\n\t{\n\t\tsuper.onSave();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tonRemove()\n\t{\n\t\tsuper.onRemove();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tonClickOut()\n\t{\n\t\tsuper.onClickOut();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\t#closeColorPickerPopup()\n\t{\n\t\tconst { colorPicker } = this.#getColorSelectorBtn();\n\t\tcolorPicker.close();\n\t}\n}\n","import { Event, Loc, Tag, Text as TextFormat } from 'main.core';\nimport Dummy from './dummy';\nimport Block from './block';\n\nexport default class Text extends Dummy\n{\n\t#textContainer: HTMLElement;\n\n\tconstructor(block: Block)\n\t{\n\t\tsuper(block);\n\t\tthis.setEventNamespace('BX.Sign.V2.Blocks.Text');\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\tonActionClick()\n\t{\n\t\tthis.#textContainer.contentEditable = true;\n\t\tthis.#textContainer.focus();\n\t}\n\n\t/**\n\t * Calls when typing in text container.\n\t */\n\t#onKeyUp(event): void\n\t{\n\t\tthis.setText(this.#textContainer.innerText.replaceAll(\"\\n\", '[br]'));\n\t\tthis.onChange();\n\t}\n\n\tgetText(): string\n\t{\n\t\treturn this.data.text;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.#textContainer;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement}\n\t */\n\tgetViewContent(): HTMLElement\n\t{\n\t\tconst content = this.data.text === Loc.getMessage('SIGN_JS_DOCUMENT_TEXT_PLACEHOLDER')\n\t\t\t? ''\n\t\t\t: this.data.text\n\t\t;\n\n\t\tthis.#textContainer = Tag.render`\n\t\t\t<div class=\"sign-document-block-text\" placeholder=\"${Loc.getMessage('SIGN_JS_DOCUMENT_TEXT_PLACEHOLDER')}\">\n\t\t\t\t${TextFormat.encode(content).replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.#textContainer, 'keyup', this.#onKeyUp.bind(this));\n\t\tEvent.bind(this.#textContainer, 'paste', event => setTimeout(this.#onPaste.bind(this, event)));\n\n\t\treturn this.#textContainer;\n\t}\n\n\t#onPaste(event: ClipboardEvent): void\n\t{\n\t\tthis.#textContainer.innerHTML = this.#textContainer.innerText.replaceAll('\\n', '<br>');\n\n\t\tconst range = document.createRange();\n\t\trange.selectNodeContents(this.#textContainer);\n\t\trange.collapse(false)\n\n\t\tconst selection = document.getSelection();\n\t\tselection.removeAllRanges();\n\t\tselection.addRange(range);\n\n\t\tthis.setText(\n\t\t\tthis.#textContainer\n\t\t\t\t.innerHTML\n\t\t\t\t.replaceAll('<br>', '[br]'),\n\t\t);\n\t\tthis.onChange();\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Text.defaultTextBlockPaddingStyles };\n\t}\n}","import { Cache, Dom, Loc, Tag, Text as TextFormat, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { FieldSelector } from 'sign.v2.b2e.field-selector';\nimport type { FieldSelectEvent, FieldSelectEventData } from '../../types/events/fieldSelectEvent';\nimport Dummy from '../dummy';\n\nexport default class B2eReference extends Dummy\n{\n\t#cache = new Cache.MemoryCache();\n\t#field: string;\n\t#actionButton: HTMLElement;\n\t#content: HTMLElement;\n\n\tstatic #loadFieldsPromise: ?Promise<any> = null;\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any): void\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field ?? '';\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\t\tif (Type.isStringFilled(this.data?.text))\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"sign-document__block-b2e-reference\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || '').toString()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t${Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#field))\n\t\t{\n\t\t\tthis.#loadFieldAndCategoryCaption()\n\t\t\t\t.then(({ categoryCaption, fieldCaption }) => {\n\t\t\t\t\tthis.#setActionButtonLabel(fieldCaption);\n\t\t\t\t\tif (!Type.isStringFilled(this.data?.text))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setContentText(\n\t\t\t\t\t\t\tType.isStringFilled(categoryCaption) && Type.isStringFilled(fieldCaption)\n\t\t\t\t\t\t\t\t? Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE_NO_DATA_CONTENT_TEMPLATE', {\n\t\t\t\t\t\t\t\t\t'#CATEGORY#': categoryCaption,\n\t\t\t\t\t\t\t\t\t'#FIELD#': fieldCaption,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE'),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst blockLayout = this.block.getLayout();\n\t\t\t\t\t\tconst resizeNode = blockLayout.querySelector('.--b2ereference');\n\t\t\t\t\t\tthis.block.resizeText({ element: resizeNode, step: 0.5 });\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\n\t\treturn this.#content;\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t#setContentText(value: ?string): void\n\t{\n\t\tconst text =\n\t\t\tType.isStringFilled(value)\n\t\t\t\t? value\n\t\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE')\n\t\t;\n\t\tthis.#content.textContent = text;\n\t\tthis.#content.title = text;\n\t}\n\n\t#loadFieldAndCategoryCaption(): Promise<{categoryCaption: string, fieldCaption: string}>\n\t{\n\t\tif (!Type.isStringFilled(this.#field))\n\t\t{\n\t\t\treturn Promise.resolve({\n\t\t\t\tcategoryCaption: '',\n\t\t\t\tfieldCaption: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE'),\n\t\t\t});\n\t\t}\n\n\t\tconst defaultCaption = Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE');\n\t\tif (B2eReference.#loadFieldsPromise === null)\n\t\t{\n\t\t\tB2eReference.#loadFieldsPromise = FieldSelector.loadFieldList({});\n\t\t}\n\n\t\treturn B2eReference.#loadFieldsPromise\n\t\t\t.then((fieldList) => {\n\t\t\t\tconst fields = [\n\t\t\t\t\t...fieldList?.PROFILE?.FIELDS ?? [],\n\t\t\t\t];\n\t\t\t\tconst field = fields.find((field) => field.name === this.#field);\n\n\t\t\t\treturn {\n\t\t\t\t\tcategoryCaption: Loc.getMessage('SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E'),\n\t\t\t\t\tfieldCaption: field ? field.caption : defaultCaption,\n\t\t\t\t};\n\t\t\t})\n\t\t;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel(label: ?string)\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionButton = this.#actionButton.querySelector('button');\n\t\tactionButton.textContent = Type.isStringFilled(label)\n\t\t\t? label\n\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE')\n\t\t;\n\t}\n\n\t#getFieldSelectorPanel(): FieldSelector\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\n\t\treturn this.#cache.remember('fieldSelector', () => {\n\t\t\tconst selector = new FieldSelector({\n\t\t\t\tmultiple: false,\n\t\t\t\tcontrollerOptions: {\n\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\thideRequisites: 1,\n\t\t\t\t\thideSmartB2eDocument: 1,\n\t\t\t\t},\n\t\t\t\tlanguages: blocksManager.getLanguages(),\n\t\t\t\tfilter: {\n\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t'PROFILE',\n\t\t\t\t\t],\n\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t'list',\n\t\t\t\t\t\t'string',\n\t\t\t\t\t\t// 'date',\n\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t'text',\n\t\t\t\t\t\t//'datetime',\n\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t'address',\n\t\t\t\t\t\t'url',\n\t\t\t\t\t\t'double',\n\t\t\t\t\t\t'integer',\n\t\t\t\t\t\t'snils',\n\t\t\t\t\t],\n\t\t\t\t\t'-fields': [\n\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\ttitle: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE'),\n\t\t\t\tcategoryCaptions: {\n\t\t\t\t\t'PROFILE': Loc.getMessage('SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E')\n\t\t\t\t},\n\t\t\t});\n\t\t\tselector.subscribe('onSliderCloseComplete', (event) => this.#onFieldSelectorCloseComplete(event));\n\n\t\t\treturn selector;\n\t\t});\n\t}\n\n\t#getFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t]);\n\t}\n\n\t#onActionClick(): void\n\t{\n\t\tconst fieldSelector = this.#getFieldSelectorPanel();\n\t\tfieldSelector\n\t\t\t.show()\n\t\t\t.then((selectedNames: Array<string>) => {\n\t\t\t\tB2eReference.#updateFieldsList(fieldSelector.getFieldsList(false));\n\t\t\t\tconst eventSelectedNames = [...selectedNames];\n\t\t\t\tif (selectedNames.length === 0 && Type.isStringFilled(this.#field))\n\t\t\t\t{\n\t\t\t\t\teventSelectedNames.push(this.#field);\n\t\t\t\t}\n\t\t\t\tthis.#emitOnFieldSelectEvent(eventSelectedNames);\n\n\t\t\t\tif (selectedNames.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.block.getLayout(), '--invalid');\n\t\t\t\tthis.#field = selectedNames[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t})\n\t\t;\n\t}\n\n\t#emitOnFieldSelectEvent(selectedNames: Array<string>): void\n\t{\n\t\tconst onFieldSelectEventData: FieldSelectEventData = { selectedFieldNames: selectedNames };\n\t\tconst onFieldSelectEvent: FieldSelectEvent = new BaseEvent({ data: onFieldSelectEventData });\n\t\tthis.emit('onFieldSelect', onFieldSelectEvent);\n\t}\n\n\t#onFieldSelectorCloseComplete(event): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\t// event already sended\n\t\t\tif (Type.isStringFilled(this.#field))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#emitOnFieldSelectEvent([]);\n\t\t});\n\t}\n\n\tstatic #updateFieldsList(fields): void\n\t{\n\t\tB2eReference.#loadFieldsPromise = Promise.resolve(fields);\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...B2eReference.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { Cache, Dom, Loc, Tag, Text as TextFormat, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { FieldSelector } from 'sign.v2.b2e.field-selector';\nimport type { FieldSelectEvent, FieldSelectEventData } from '../../types/events/fieldSelectEvent';\nimport Dummy from '../dummy';\n\nexport default class MyB2eReference extends Dummy\n{\n\t#cache = new Cache.MemoryCache();\n\t#field: string;\n\t#actionButton: HTMLElement;\n\t#content: HTMLElement;\n\n\tstatic #loadFieldsPromise: ?Promise<any> = null;\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any): void\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field ?? '';\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\t\tif (Type.isStringFilled(this.data?.text))\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"sign-document__block-b2e-reference\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || '').toString()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t${Loc.getMessage('SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#field))\n\t\t{\n\t\t\tthis.#loadFieldAndCategoryCaption()\n\t\t\t\t.then(({ categoryCaption, fieldCaption }) => {\n\t\t\t\t\tthis.#setActionButtonLabel(fieldCaption);\n\n\t\t\t\t\tif (!Type.isStringFilled(this.data?.text))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setContentText(\n\t\t\t\t\t\t\tType.isStringFilled(categoryCaption) && Type.isStringFilled(fieldCaption)\n\t\t\t\t\t\t\t\t? Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE_NO_DATA_CONTENT_TEMPLATE', {\n\t\t\t\t\t\t\t\t\t'#CATEGORY#': categoryCaption,\n\t\t\t\t\t\t\t\t\t'#FIELD#': fieldCaption,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE'),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst blockLayout = this.block.getLayout();\n\t\t\t\t\t\tconst resizeNode = blockLayout.querySelector('.--myb2ereference');\n\t\t\t\t\t\tthis.block.resizeText({ element: resizeNode, step: 0.5 });\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\n\t\treturn this.#content;\n\t}\n\n\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel(label: ?string)\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionButton = this.#actionButton.querySelector('button');\n\t\tactionButton.textContent = Type.isStringFilled(label)\n\t\t\t? label\n\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE')\n\t\t;\n\t}\n\n\t#getFieldSelectorPanel(): FieldSelector\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\tconst { presetId } = member;\n\n\t\treturn this.#cache.remember('fieldSelector', () => {\n\t\t\tconst selector = new FieldSelector({\n\t\t\t\tmultiple: false,\n\t\t\t\tcontrollerOptions: {\n\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\thideSmartB2eDocument: 1,\n\t\t\t\t\tpresetId,\n\t\t\t\t},\n\t\t\t\tlanguages: blocksManager.getLanguages(),\n\t\t\t\tpresetId,\n\t\t\t\tfilter: {\n\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t'COMPANY',\n\t\t\t\t\t\t'SMART_B2E_DOC',\n\t\t\t\t\t\t'PROFILE',\n\t\t\t\t\t],\n\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t'list',\n\t\t\t\t\t\t'string',\n\t\t\t\t\t\t// 'date',\n\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t'text',\n\t\t\t\t\t\t//'datetime',\n\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t'address',\n\t\t\t\t\t\t'url',\n\t\t\t\t\t\t'double',\n\t\t\t\t\t\t'integer',\n\t\t\t\t\t\t'snils',\n\t\t\t\t\t],\n\t\t\t\t\t'-fields': [\n\t\t\t\t\t\tthis.#getFieldNegativeFilter(),\n\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getCrmFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tcategoryCaptions: {\n\t\t\t\t\t'PROFILE': Loc.getMessage('SIGN_EDITOR_BLOCKS_REPRESENTATIVE_B2E')\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tselector.subscribe('onSliderCloseComplete', (event) => this.#onFieldSelectorCloseComplete(event));\n\n\t\t\treturn selector;\n\t\t});\n\t}\n\n\t#getFieldsNameBlackList(): Array<string>\n\t{\n\t\treturn [\n\t\t\t'SMART_B2E_DOC_XML_ID',\n\t\t\t'SMART_B2E_DOC_STAGE_ID',\n\n\t\t\t'COMPANY_LINK',\n\t\t\t'COMPANY_REG_ADDRESS',\n\t\t\t'COMPANY_ORIGIN_VERSION',\n\t\t];\n\t}\n\n\t#getCrmFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t]);\n\t}\n\n\t#getFieldNegativeFilter(): (Object) => boolean\n\t{\n\t\tconst blackList = this.#getFieldsNameBlackList();\n\n\t\treturn (field) => {\n\t\t\treturn blackList.includes(field.name);\n\t\t};\n\t}\n\n\t#onActionClick(): void\n\t{\n\t\tconst fieldSelector = this.#getFieldSelectorPanel();\n\t\tfieldSelector\n\t\t\t.show()\n\t\t\t.then((selectedNames: Array<string>) => {\n\t\t\t\tMyB2eReference.#updateFieldsList(fieldSelector.getFieldsList(false));\n\t\t\t\tconst eventSelectedNames = [...selectedNames];\n\t\t\t\tif (selectedNames.length === 0 && Type.isStringFilled(this.#field))\n\t\t\t\t{\n\t\t\t\t\teventSelectedNames.push(this.#field);\n\t\t\t\t}\n\t\t\t\tthis.#emitOnFieldSelectEvent(eventSelectedNames);\n\n\t\t\t\tif (selectedNames.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.block.getLayout(), '--invalid');\n\t\t\t\tthis.#field = selectedNames[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t})\n\t\t;\n\t}\n\n\t#emitOnFieldSelectEvent(selectedNames: Array<string>): void\n\t{\n\t\tconst onFieldSelectEventData: FieldSelectEventData = { selectedFieldNames: selectedNames };\n\t\tconst onFieldSelectEvent: FieldSelectEvent = new BaseEvent({ data: onFieldSelectEventData });\n\t\tthis.emit('onFieldSelect', onFieldSelectEvent);\n\t}\n\n\t#onFieldSelectorCloseComplete(event): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\t// event already sended\n\t\t\tif (Type.isStringFilled(this.#field))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#emitOnFieldSelectEvent([]);\n\t\t});\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...MyB2eReference.defaultTextBlockPaddingStyles };\n\t}\n\n\t#loadFieldAndCategoryCaption(): Promise<{categoryCaption: string, fieldCaption: string}>\n\t{\n\t\tif (!Type.isStringFilled(this.#field))\n\t\t{\n\t\t\treturn Promise.resolve({\n\t\t\t\tcategoryCaption: '',\n\t\t\t\tfieldCaption: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE'),\n\t\t\t});\n\t\t}\n\n\t\tconst defaultCaption = Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE');\n\t\tif (MyB2eReference.#loadFieldsPromise === null)\n\t\t{\n\t\t\tconst blocksManager = this.block.blocksManager;\n\t\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\t\tconst { presetId } = member;\n\n\t\t\tMyB2eReference.#loadFieldsPromise = FieldSelector.loadFieldList({\n\t\t\t\thideVirtual: 1,\n\t\t\t\thideRequisites: 1,\n\t\t\t\thideSmartB2eDocument: 1,\n\t\t\t\tpresetId,\n\t\t\t});\n\t\t}\n\n\t\treturn MyB2eReference.#loadFieldsPromise\n\t\t\t.then((fieldList) => {\n\t\t\t\tconst categories = {\n\t\t\t\t\tprofile: fieldList?.PROFILE,\n\t\t\t\t\tdocument: fieldList?.SMART_B2E_DOC,\n\t\t\t\t\tcompany: fieldList?.COMPANY\n\t\t\t\t};\n\t\t\t\tObject.entries(categories)\n\t\t\t\t\t.forEach(([key, category]) => {\n\t\t\t\t\t\tif (category === undefined)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcategory.FIELDS = (category?.FIELDS ?? []).map((field) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...field,\n\t\t\t\t\t\t\t\tcategory: key\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t\tconst fields = [\n\t\t\t\t\t...fieldList?.PROFILE?.FIELDS ?? [],\n\t\t\t\t\t...fieldList?.SMART_B2E_DOC?.FIELDS ?? [],\n\t\t\t\t\t...fieldList?.COMPANY?.FIELDS ?? [],\n\t\t\t\t];\n\n\t\t\t\tconst field = fields.find((field) => field.name === this.#field);\n\t\t\t\tlet categoryCaption = '';\n\t\t\t\tif (Type.isObject(field))\n\t\t\t\t{\n\t\t\t\t\tif (field?.category === 'profile')\n\t\t\t\t\t{\n\t\t\t\t\t\tcategoryCaption = Loc.getMessage('SIGN_EDITOR_BLOCKS_REPRESENTATIVE_B2E');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcategoryCaption = categories[field?.category]?.CAPTION ?? '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tcategoryCaption,\n\t\t\t\t\tfieldCaption: field ? field.caption : defaultCaption,\n\t\t\t\t};\n\t\t\t})\n\t\t;\n\t}\n\n\t#setContentText(value: ?string): void\n\t{\n\t\tconst text =\n\t\t\tType.isStringFilled(value)\n\t\t\t\t? value\n\t\t\t\t: Loc.getMessage('SIGN_EDITOR_BLOCK_B2E_REFERENCE')\n\t\t;\n\n\t\tthis.#content.textContent = text;\n\t\tthis.#content.title = text;\n\t}\n\n\tstatic #updateFieldsList(fields): void\n\t{\n\t\tMyB2eReference.#loadFieldsPromise = Promise.resolve(fields);\n\t}\n}\n","import { Dom, Event, Loc, Tag, Text as TextFormat, Reflection, Type } from 'main.core';\nimport { UI as SignUI } from 'sign.ui';\nimport { ColorPickerOptions } from '../../../../document/src/ui';\nimport { MemberItem } from '../types/document';\nimport '../style.css';\nimport 'color_picker';\n\ntype BlockLayoutOptions = {\n\tonRemove: () => {},\n\tonSave: () => {}\n};\n\nconst ColorPicker = Reflection.getClass('BX.ColorPicker');\n\nexport default class UI\n{\n\t/**\n\t * Sets width/height/top/left to element.\n\t * @param {HTMLElement} element\n\t * @param {{[key: string]: number}} rect\n\t */\n\tstatic setRect(element: HTMLElement, rect: {[key: string]: number})\n\t{\n\t\tObject.keys(rect).map(key => {\n\t\t\trect[key] = parseInt(rect[key]) + 'px';\n\t\t});\n\t\tDom.style(element, rect);\n\t}\n\n\t/**\n\t * Returns block's layout.\n\t * @param {BlockLayoutOptions} options Layout options.\n\t * @return {HTMLElement}\n\t */\n\tstatic getBlockLayout(options: BlockLayoutOptions): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-wrapper\">\n\t\t\t\t<div class=\"sign-document__block-panel--wrapper\" data-role=\"sign-block__actions\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-content\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-actions\">\n\t\t\t\t\t<div class=\"sign-document__block-actions--wrapper\">\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --remove sign-block-action-remove\" data-role=\"removeAction\" onclick=\"${options.onRemove}\"></button>\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --save sign-block-action-save\" data-role=\"saveAction\" onclick=\"${options.onSave}\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns member selector for block.\n\t * @param {Array<MemberItem>} members All document's members.\n\t * @param {number} selectedValue Selected member.\n\t * @param {() => {}} onChange Handler on change value.\n\t * @return {HTMLElement}\n\t */\n\tstatic getMemberSelector(members: Array<MemberItem>, selectedValue: number,  onChange: () => {}): HTMLElement\n\t{\n\t\tconst menuItems = {};\n\t\tlet selectedName = Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\n\t\tmembers.map(member => {\n\t\t\tmember.name = member.name || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\t\t\tmenuItems[member.part] = member.name;\n\n\t\t\tif (member.part === selectedValue)\n\t\t\t{\n\t\t\t\tselectedName = member.name;\n\t\t\t}\n\t\t});\n\n\t\tconst memberSelector = (members.length > 1)\n\t\t\t? Tag.render`<span>${TextFormat.encode(selectedName)}</span>`\n\t\t\t: Tag.render`<i>${TextFormat.encode(selectedName)}</i>`;\n\n\t\tif (members.length > 1)\n\t\t{\n\t\t\tSignUI.bindSimpleMenu({\n\t\t\t\tbindElement: memberSelector,\n\t\t\t\titems: menuItems,\n\t\t\t\tactionHandler: value => {\n\t\t\t\t\tmemberSelector.innerHTML = menuItems[value];\n\t\t\t\t\tonChange(parseInt(value));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-block-member-wrapper\">\n\t\t\t\t${memberSelector}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns resizing area's layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getResizeArea(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__resize-area\">\n\t\t\t\t<div class=\"sign-area-resizable-controls\">\n\t\t\t\t\t<span class=\"sign-document__move-control\"></span>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-right\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --left-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-left\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns style panel layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getStylePanel(\n\t\tactionHandler: (actionName: string, actionValue: string) => {},\n\t\tcollectStyles: {[key: string]: string}\n\t): HTMLElement\n\t{\n\t\t// font family selector\n\t\tconst fonts = {\n\t\t\t'\"Times New Roman\", Times':   '<span style=\"font-family: \\'Times New Roman\\', Times\">Times New Roman</span>',\n\t\t\t'\"Courier New\"':              '<span style=\"font-family: \\'Courier New\\'\">Courier New</span>',\n\t\t\t'Arial, Helvetica':           '<span style=\"font-family: Arial, Helvetica\">Arial / Helvetica</span>',\n\t\t\t'\"Arial Black\", Gadget':      '<span style=\"font-family: \\'Arial Black\\', Gadget\">Arial Black</span>',\n\t\t\t'Tahoma, Geneva':             '<span style=\"font-family: Tahoma, Geneva\">Tahoma / Geneva</span>',\n\t\t\t'Verdana':                    '<span style=\"font-family: Verdana\">Verdana</span>',\n\t\t\t'Georgia, serif':             '<span style=\"font-family: Georgia, serif\">Georgia</span>',\n\t\t\t'monospace':                  '<span style=\"font-family: monospace\">monospace</span>',\n\t\t};\n\t\tconst fontFamily = Tag.render`<div class=\"sign-document__block-style-btn --btn-font-family\">${fonts[collectStyles['fontFamily']] || 'Font'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontFamily,\n\t\t\titems: fonts,\n\t\t\tactionHandler: value => {\n\t\t\t\tfontFamily.innerHTML = fonts[value];\n\t\t\t\tactionHandler('family', value);\n\t\t\t}\n\t\t});\n\n\t\t// font size selector\n\n\t\tlet fontSizereal = parseInt(collectStyles['fontSize']);\n\t\tlet fontSizeValue = 14;\n\n\t\tif (fontSizereal)\n\t\t{\n\t\t\tfontSizeValue = fontSizereal;\n\t\t}\n\n\t\tconst fontSize = Tag.render`<div class=\"sign-document__block-style-btn --btn-fontsize\">${fontSizeValue+ 'px' || '<i></i>'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontSize,\n\t\t\titems: [\n\t\t\t\t'6px', '7px', '8px', '9px', '10px', '11px', '12px', '13px', '14px', '15px', '16px',\n\t\t\t\t'18px', '20px', '22px', '24px', '26px', '28px', '36px', '48px', '72px'\n\t\t\t],\n\t\t\tactionHandler: value => {\n\t\t\t\tfontSize.innerHTML = parseInt(value) + 'px';\n\t\t\t\tactionHandler('size', value);\n\t\t\t},\n\t\t\tcurrentValue: fontSizeValue\n\t\t});\n\n\t\tconst { layout: fontColor } = UI.getColorSelectorBtn(\n\t\t\tcollectStyles.color ?? '#000',\n\t\t\t(color) => actionHandler('color', color),\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style--panel\">\n<!--\t\t\t\t<div class=\"sign-document__block-style&#45;&#45;move-control\"></div>-->\n\t\t\t\t${fontFamily}\n\t\t\t\t${fontSize}\n\t\t\t\t${fontColor}\n\t\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-bold\" data-action=\"bold\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-italic\" data-action=\"italic\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-underline\" data-action=\"underline\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-strike\" data-action=\"through\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-left\" data-action=\"left\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-center\" data-action=\"center\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-right\" data-action=\"right\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-justify\" data-action=\"justify\"><i></i></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tstatic getColorSelectorBtn(\n\t\tdefaultColorPickerColor: string,\n\t\tonColorSelect: (string) => any,\n\t\tcolorPickerOptions: ColorPickerOptions = {},\n\t): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\tconst layout = Tag.render`<div class=\"sign-document__block-style-btn --btn-color\">\n\t\t\t\t<span class=\"sign-document__block-style-btn--color-block\"></span> \n\t\t\t\t<span>${Loc.getMessage('SIGN_JS_DOCUMENT_STYLE_COLOR')}</span>\n\t\t\t</div>`\n\t\t;\n\t\tUI.updateColorSelectorBtnColor(layout, defaultColorPickerColor);\n\t\tconst updatedColorPickerOptions = {\n\t\t\t...colorPickerOptions,\n\t\t\tbindElement: layout,\n\t\t\tonColorSelected:\n\t\t\t\t(color) => {\n\t\t\t\t\tonColorSelect(color);\n\t\t\t\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\t\t\t},\n\t\t};\n\n\t\tconst picker = new ColorPicker(updatedColorPickerOptions);\n\n\t\tEvent.bind(layout, 'click', () => {\n\t\t\tpicker.open();\n\t\t});\n\n\t\treturn { layout, colorPicker: picker };\n\t}\n\n\tstatic updateColorSelectorBtnColor(layout: HTMLElement, color: string): void\n\t{\n\t\tconst circleColor = layout.querySelector('.sign-document__block-style-btn--color-block');\n\t\tif (Type.isNil(circleColor))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(\n\t\t\tcircleColor,\n\t\t\t'background-color',\n\t\t\tcolor,\n\t\t);\n\t}\n}\n","import { Dom, Event } from 'main.core';\nimport Block from './block';\nimport UI from './ui';\n\ntype StyleOptions = {\n\tblock: Block,\n\tdata: {[key: string]: string}\n};\n\nexport default class Style\n{\n\t#block: Block;\n\n\t#buttons = {\n\t\tfamily: {\n\t\t\tproperty: 'fontFamily',\n\t\t\tvalue: null\n\t\t},\n\t\tsize: {\n\t\t\tproperty: 'fontSize',\n\t\t\tvalue: 14\n\t\t},\n\t\tcolor: {\n\t\t\tproperty: 'color',\n\t\t\tvalue: null\n\t\t},\n\t\tbold: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'fontWeight',\n\t\t\tvalue: 'bold',\n\t\t\tstate: false\n\t\t},\n\t\titalic: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'fontStyle',\n\t\t\tvalue: 'italic',\n\t\t\tstate: false\n\t\t},\n\t\tunderline: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textDecoration',\n\t\t\tvalue: 'underline',\n\t\t\tstate: false\n\t\t},\n\t\tthrough: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textDecoration',\n\t\t\tvalue: 'line-through',\n\t\t\tstate: false\n\t\t},\n\t\tleft: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'left',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tcenter: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'center',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tright: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'right',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tjustify: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'justify',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t}\n\t};\n\n\t#style = {\n\t\tbuttonPressed: 'sign-document__block-style--button-pressed'\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {StyleOptions} options\n\t */\n\tconstructor(options: StyleOptions)\n\t{\n\t\tthis.#block = options.block;\n\n\t\tif (options.data)\n\t\t{\n\t\t\tthis.#applyData(options.data);\n\t\t}\n\t}\n\n\t/**\n\t * Handle on panel button click.\n\t * @param {string} code\n\t */\n\t#onPressButton(code: string)\n\t{\n\t\tthis.#buttons[code]['state'] = !this.#buttons[code]['state'];\n\n\t\tif (this.#buttons[code]['state'])\n\t\t{\n\t\t\tDom.addClass(this.#buttons[code]['button'], this.#style.buttonPressed);\n\n\t\t\tif (this.#buttons[code]['group'])\n\t\t\t{\n\t\t\t\tconst group = this.#buttons[code]['group'];\n\n\t\t\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\t\t\tif (key !== code && this.#buttons[key]['group'] === group)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#buttons[key]['state'] = false;\n\t\t\t\t\t\tDom.removeClass(this.#buttons[key]['button'], this.#style.buttonPressed);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.#buttons[code]['button'], this.#style.buttonPressed);\n\t\t}\n\n\t\tthis.#block.renderStyle();\n\t}\n\n\t/**\n\t * Applies initiated data to current state.\n\t * @param {{[key: string]: string}} data\n\t */\n\t#applyData(data: {[key: string]: string})\n\t{\n\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\tconst property = this.#buttons[key]['property'];\n\n\t\t\tif (data[property])\n\t\t\t{\n\t\t\t\tif (typeof this.#buttons[key]['state'] !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tif (data[property].indexOf(this.#buttons[key]['value']) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#buttons[key]['state'] = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#buttons[key]['value'] = data[property];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Applies collected styles to the element.\n\t * @param {HTMLElement} element\n\t */\n\tapplyStyles(element: HTMLElement)\n\t{\n\t\telement.removeAttribute('style');\n\t\tDom.style(element, this.collectStyles());\n\t}\n\n\tupdateFontSize(fontSize)\n\t{\n\t\tif (fontSize)\n\t\t{\n\t\t\tthis.#buttons.size['property'] = 'fontSize';\n\t\t\tthis.#buttons.size['value'] = fontSize;\n\t\t}\n\t}\n\n\t/**\n\t * Collects checked styles in one dataset.\n\t * @return {{[key: string]: string}}\n\t */\n\tcollectStyles(): {[key: string]: string}\n\t{\n\t\tconst styles = {};\n\n\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\tif (this.#buttons[key]['state'] || (typeof this.#buttons[key]['state'] === 'undefined'))\n\t\t\t{\n\t\t\t\tconst property = this.#buttons[key]['property'];\n\t\t\t\tconst value = this.#buttons[key]['value'];\n\n\t\t\t\tif (value === null)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.#buttons[key]['group'])\n\t\t\t\t{\n\t\t\t\t\tstyles[property] = value;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tstyles[property] = (styles[property] ? styles[property] + ' ' : '') + value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn styles;\n\t}\n\n\t/**\n\t * Returns style panel layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\tconst layout = UI.getStylePanel(\n\t\t\t(code: string, value: string) => {\n\t\t\t\tthis.#buttons[code]['value'] = value;\n\t\t\t\tthis.#block.renderStyle();\n\t\t\t},\n\t\t\tthis.collectStyles()\n\t\t);\n\n\t\t[...layout.querySelectorAll('[data-action]')].map(button => {\n\t\t\t\tconst action = button.getAttribute('data-action');\n\n\t\t\tif (this.#buttons[action])\n\t\t\t{\n\t\t\t\tEvent.bind(button, 'click', () => this.#onPressButton(action));\n\t\t\t\tthis.#buttons[action]['button'] = button;\n\n\t\t\t\tif (this.#buttons[action]['state'])\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.#buttons[action]['button'], this.#style.buttonPressed);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn layout;\n\t}\n\n\tupdateColor(color: string): void\n\t{\n\t\tthis.#buttons.color.value = color;\n\t}\n}\n","import { Dom, Event, Type } from 'main.core';\nimport { Backend } from 'sign.backend';\nimport { EventEmitter } from 'main.core.events';\nimport { Api } from 'sign.v2.api';\nimport type { FieldSelectEvent } from '../types/events/fieldSelectEvent';\nimport { Date, Dummy, MyRequisites, MySign, MyStamp, Number, Reference, Requisites, Sign, Stamp, Text, MyReference, B2eReference, MyB2eReference } from './index';\nimport { BlocksManager } from './blocksManager';\nimport Style from './style';\nimport { PositionType, BlockOptions } from '../types/block';\nimport UI from './ui';\n\nexport default class Block extends EventEmitter\n{\n\tevents = {\n\t\tonColorStyleChange: 'onColorStyleChange',\n\t};\n\n\t#id: number;\n\t#code: string;\n\t#layout: HTMLElement;\n\t#stylePanel: Style;\n\t#content: Dummy = null;\n\tblocksManager: BlocksManager;\n\t#memberPart: number = 2;\n\t#panelCreated: boolean = false;\n\t#allowMembers: boolean = false;\n\t#onClickCallback: ?() => {};\n\t#onRemoveCallback: ?() => {};\n\t#contentProviders = {\n\t\tdate: Date,\n\t\tmyrequisites: MyRequisites,\n\t\tmysign: MySign,\n\t\tmystamp: MyStamp,\n\t\tnumber: Number,\n\t\treference: Reference,\n\t\tmyreference: MyReference,\n\t\trequisites: Requisites,\n\t\tsign: Sign,\n\t\tstamp: Stamp,\n\t\ttext: Text,\n\n\t\tb2ereference: B2eReference,\n\t\tmyb2ereference: MyB2eReference,\n\t};\n\t#currentFontSize: String;\n\n\t#style = {\n\t\tblockContent: '.sign-document__block-content',\n\t\tblockPanel: '.sign-document__block-panel--wrapper',\n\t\tblockLoading: 'sign-document-block-loading',\n\t\tblockEditing: 'sign-document__block-wrapper-editing',\n\t\tpageWithNotAllowed: 'sign-editor__content-document--active-move',\n\t};\n\n\t#firstRenderReady: boolean;\n\n\t#api: Api;\n\n\t/**\n\t * Constructor.\n\t * @param {BlockOptions} options\n\t */\n\tconstructor(options: BlockOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.Editor.Block');\n\t\tthis.blocksManager = options.blocksManager;\n\t\tthis.#id = options.id || null;\n\t\tthis.#code = options.code;\n\t\tthis.#memberPart = options.party;\n\t\tthis.#onClickCallback = options.onClick;\n\t\tthis.#onRemoveCallback = options.onRemove;\n\t\tthis.#firstRenderReady = null;\n\t\tthis.#stylePanel = new Style({\n\t\t\tblock: this,\n\t\t\tdata: options.style\n\t\t});\n\t\tif (!this.#contentProviders[this.#code])\n\t\t{\n\t\t\tthrow new Error(`Content provider for '${this.#code}' not found.`);\n\t\t}\n\n\t\tthis.#content = new this.#contentProviders[this.#code](this);\n\n\t\tif (['sign', 'mysign'].includes(this.#code) && Type.isString(options.style?.color))\n\t\t{\n\t\t\tthis.#content.changeStyleColor(options.style.color, false);\n\t\t}\n\n\t\tthis.#createLayout();\n\n\t\tEvent.bind(this.#layout, 'click', this.#onClick.bind(this));\n\n\t\tif (options.party > 1)\n\t\t{\n\t\t\tthis.#allowMembers = true;\n\t\t}\n\n\t\tthis.renderStyle();\n\n\t\tthis.setPosition(options.position ?? this.#content.getInitDimension());\n\n\t\tif (options.data)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.setData(options.data);\n\t\t\t}, 0);\n\t\t}\n\t\tthis.#api = new Api();\n\t}\n\n\t/**\n\t * Returns block's layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#layout;\n\t}\n\n\t/**\n\t * Sets new data to the block.\n\t * @param {any} data\n\t */\n\tsetData(data: any): void\n\t{\n\t\tthis.#content.setData(data);\n\t\tthis.renderView();\n\t}\n\n\t/**\n\t * Sets initial position to the block.\n\t * @param {PositionType} position\n\t */\n\tsetPosition(position: PositionType)\n\t{\n\t\tUI.setRect(this.#layout, position);\n\t}\n\n\t/**\n\t * Returns block's data.\n\t * @return {any}\n\t */\n\tgetData(): any\n\t{\n\t\treturn this.#content.getData();\n\t}\n\n\t/**\n\t * Returns position.\n\t * @return {PositionType}\n\t */\n\tgetPosition(): PositionType\n\t{\n\t\tlet {top, left, width, height} = this.#layout.getBoundingClientRect();\n\t\tconst layout = this.#layout;\n\t\ttop = Math.round(top);\n\t\tleft = Math.round(left);\n\t\twidth = Math.round(width);\n\t\theight = Math.round(height);\n\n\t\tconst documentRect = this.blocksManager.getLayout().getBoundingClientRect();\n\n\t\ttop -= Math.round(documentRect.top);\n\t\tleft -= Math.round(documentRect.left);\n\n\t\treturn {top, left, width, height};\n\t}\n\n\t/**\n\t * Returns block styles.\n\t * @return {{{[key: string]: string}}}\n\t */\n\tgetStyle(): {[key: string]: string}\n\t{\n\t\treturn { ...this.#content.getStyles(), ...this.#stylePanel.collectStyles() };\n\t}\n\n\t/**\n\t * Returns id.\n\t * @return {number|null}\n\t */\n\tgetId(): ?number\n\t{\n\t\treturn this.#id ?? null;\n\t}\n\n\t/**\n\t * Returns code.\n\t * @return {string}\n\t */\n\tgetCode(): string\n\t{\n\t\treturn this.#code;\n\t}\n\n\t/**\n\t * Shows page's areas not allowed for block's placement.\n\t */\n\tshowNotAllowedArea()\n\t{\n\t\tconst {page} = this.blocksManager.transferPositionToPage(this.getPosition());\n\t\tconst pageElement = document.querySelector(`.sign-editor__content-document--page[data-page=\"${page}\"]`);\n\n\t\tDom.addClass(pageElement, this.#style.pageWithNotAllowed);\n\t}\n\n\thideNotAllowedArea()\n\t{\n\t\tconst {page} = this.blocksManager.transferPositionToPage(this.getPosition());\n\t\tconst pageElement = document.querySelector(`.sign-editor__content-document--page[data-page=\"${page}\"]`);\n\n\t\tDom.removeClass(pageElement, this.#style.pageWithNotAllowed);\n\t}\n\n\t/**\n\t * Returns member part.\n\t * @return {number}\n\t */\n\tgetMemberPart(): number\n\t{\n\t\treturn this.#memberPart;\n\t}\n\n\t/**\n\t * Handler on click to block.\n\t */\n\t#onClick()\n\t{\n\t\tif (this.#onClickCallback)\n\t\t{\n\t\t\tthis.#onClickCallback(this);\n\t\t}\n\t}\n\n\t/**\n\t * Calls block's action.\n\t */\n\tfireAction()\n\t{\n\t\tif (this.#content['onActionClick'])\n\t\t{\n\t\t\tif (this.#code === 'text')\n\t\t\t{\n\t\t\t\tDom.addClass(this.#layout, this.#style.blockEditing);\n\t\t\t}\n\t\t\tthis.#content['onActionClick']();\n\t\t}\n\t}\n\n\t/**\n\t * Handler on member change.\n\t * @param {number} part\n\t */\n\tonMemberSelect(part: number)\n\t{\n\t\tthis.#memberPart = part;\n\t\tthis.assign();\n\t}\n\n\t/**\n\t * Sets/removes awaiting class to the block.\n\t * @param {boolean} flag\n\t */\n\tawait(flag: boolean)\n\t{\n\t\tconst blockLayouts = [];\n\n\t\tif (!this.#content.isSingleton())\n\t\t{\n\t\t\tblockLayouts.push(this.getLayout());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst currentCode = this.getCode();\n\n\t\t\tthis.blocksManager.getBlocks().map(block => {\n\t\t\t\tif (block.getCode() === currentCode)\n\t\t\t\t{\n\t\t\t\t\tblockLayouts.push(block.getLayout());\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tblockLayouts.map((blockLayout, key) => {\n\t\t\tif (flag)\n\t\t\t{\n\t\t\t\tif (blockLayouts.length === key + 1)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(blockLayout, this.#style.blockLoading);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(blockLayout, this.#style.blockLoading);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Assigns block to the document (without saving).\n\t */\n\tassign()\n\t{\n\t\tconst blockLayout = this.getLayout();\n\t\tconst blocksData = [];\n\t\tconst blocksInstance = [];\n\n\t\tthis.await(true);\n\n\t\tif (!this.#content.isSingleton())\n\t\t{\n\t\t\tblocksData.push({\n\t\t\t\tcode: this.#code,\n\t\t\t\tpart: this.#memberPart,\n\t\t\t\tdata: this.getData()\n\t\t\t});\n\t\t\tblocksInstance.push(this);\n\t\t}\n\t\t// if block is a singleton push all blocks with same code\n\t\telse\n\t\t{\n\t\t\tthis.blocksManager.getBlocks().map(block => {\n\t\t\t\tif (\n\t\t\t\t\tblock.getCode() === this.getCode() &&\n\t\t\t\t\tblock.getMemberPart() === this.getMemberPart()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tblocksData.push({\n\t\t\t\t\t\tcode: block.getCode(),\n\t\t\t\t\t\tpart: block.getMemberPart(),\n\t\t\t\t\t\tdata: block.getData()\n\t\t\t\t\t});\n\t\t\t\t\tblocksInstance.push(block);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.#api.loadBlocksData(\n\t\t\tthis.blocksManager.getDocumentUid(),\n\t\t\tblocksData\n\t\t).then(result => {\n\t\t\tif (Type.isArray(result))\n\t\t\t{\n\t\t\t\tresult.forEach((block, i) => {\n\t\t\t\t\tblocksInstance[i].setData(block.data);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.await(false);\n\t\t\tthis.blocksManager.showResizeArea(this);\n\t\t})\n\t\t.catch((response) => {\n\t\t\tDom.remove(blockLayout);\n\t\t});\n\t}\n\n\t/**\n\t * Renders block within document's layout.\n\t */\n\trenderView()\n\t{\n\t\tconst contentTag = this.#layout.querySelector(this.#style.blockContent);\n\n\t\t// content\n\t\tDom.clean(contentTag);\n\n\t\tswitch (this.#code.toLowerCase())\n\t\t{\n\t\t\tcase 'stamp':\n\t\t\tcase 'mystamp':\n\t\t\tcase 'sign':\n\t\t\tcase 'mysign':\n\t\t\t\tDom.addClass(contentTag, '--image')\n\t\t}\n\n\t\tconst resizeNode = this.#content.getViewContent();\n\n\t\tDom.append(resizeNode, contentTag);\n\n\t\tDom.addClass(resizeNode, '--' + this.#code.toLowerCase());\n\n\t\tif (\n\t\t\tthis.#code.toLowerCase() === 'requisites'\n\t\t\t|| this.#code.toLowerCase() === 'myrequisites'\n\t\t\t|| this.#code.toLowerCase() === 'date'\n\t\t\t|| this.#code.toLowerCase() === 'number'\n\t\t\t|| this.#code.toLowerCase() === 'stamp'\n\t\t\t|| this.#code.toLowerCase() === 'mystamp'\n\t\t\t|| this.#code.toLowerCase() === 'sign'\n\t\t\t|| this.#code.toLowerCase() === 'mysign'\n\t\t\t|| this.#code.toLowerCase() === 'reference'\n\t\t\t|| this.#code.toLowerCase() === 'myreference'\n\t\t\t|| this.#code.toLowerCase() === 'text'\n\t\t\t|| this.#code.toLowerCase() === 'b2ereference'\n\t\t\t|| this.#code.toLowerCase() === 'myb2ereference'\n\t\t)\n\t\t{\n\t\t\tresizeNode.style.setProperty('display', 'block');\n\t\t\tresizeNode.style.setProperty('overflow', 'hidden');\n\n\t\t\tif (!this.observerReady)\n\t\t\t{\n\t\t\t\tif (this.getStyle()['fontSize'])\n\t\t\t\t{\n\t\t\t\t\tthis.maxTextSize = parseFloat(this.getStyle()['fontSize']);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.maxTextSize = 14;\n\t\t\t\t}\n\n\t\t\t\tthis.isOverflownX = ({ clientHeight, scrollHeight }) => {\n\t\t\t\t\treturn scrollHeight > clientHeight;\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.subscribe(resizeNode.parentNode.parentNode, 'BX.Sign:setFontSize', (param)=> {\n\t\t\t\t\tif (param.data.fontSize)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.maxTextSize = param.data.fontSize;\n\t\t\t\t\t\tthis.resizeText({\n\t\t\t\t\t\t\telement: param.target.querySelector('.sign-document__block-content > div'),\n\t\t\t\t\t\t\tstep: 0.5\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.resizeText = ({ element, minSize = 1, step = 1, unit = 'px' }) => {\n\n\t\t\t\t\tif (this.intervalTextResize)\n\t\t\t\t\t{\n\t\t\t\t\t\tclearTimeout(this.intervalTextResize);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet i = minSize;\n\t\t\t\t\tlet overflow = false;\n\n\t\t\t\t\tconst parent = element.parentNode\n\n\t\t\t\t\twhile (!overflow && i < this.maxTextSize)\n\t\t\t\t\t{\n\t\t\t\t\t\telement.style.fontSize = `${i}${unit}`;\n\t\t\t\t\t\toverflow = this.isOverflownX(parent);\n\t\t\t\t\t\tif (!overflow)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ti += step;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.#currentFontSize = `${i - step}${unit}`;\n\t\t\t\t\telement.style.fontSize = this.#currentFontSize;\n\n\t\t\t\t\tthis.intervalTextResize = setTimeout(() => {\n\t\t\t\t\t\telement.parentNode.style.setProperty('font-size', element.style.fontSize);\n\t\t\t\t\t\telement.style.removeProperty('font-size', element.style.fontSize);\n\t\t\t\t\t\tthis.#stylePanel.updateFontSize(this.#currentFontSize);\n\t\t\t\t\t}, 1000);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tthis.#code.toLowerCase() === 'requisites'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'myrequisites'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'reference'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'myreference'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'text'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.resizeText({\n\t\t\t\t\t\telement: resizeNode,\n\t\t\t\t\t\tstep: 0.5\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.#content.subscribe(this.#content.events.onChange, this.#onContentChange.bind(this));\n\t\t\t\tthis.#content.subscribe(this.#content.events.onColorStyleChange, this.#onContentColorStyleChange.bind(this));\n\t\t\t\tthis.#content.subscribe('onFieldSelect', this.#onFieldSelect.bind(this));\n\n\t\t\t\tthis.observerReady = true;\n\t\t\t}\n\n\t\t\tif (this.#firstRenderReady)\n\t\t\t{\n\t\t\t\tthis.resizeText({\n\t\t\t\t\telement: resizeNode,\n\t\t\t\t\tstep: 0.5\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.#firstRenderReady = true;\n\n\t\tif (this.#panelCreated)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// action / style panel\n\t\tconst panelTag = this.#layout.querySelector(this.#style.blockPanel);\n\t\tDom.clean(panelTag);\n\n\t\t// style\n\t\tif (this.#content.isStyleAllowed())\n\t\t{\n\t\t\tDom.append(this.#stylePanel.getLayout(), panelTag);\n\t\t}\n\n\t\t// action\n\t\tDom.append(this.#content.getActionButton(), panelTag);\n\n\t\t// block caption\n\t\tDom.append(this.#content.getBlockCaption(), panelTag);\n\n\t\t// member selector\n\t\tif (this.#allowMembers)\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.#code.toLowerCase() === 'b2ereference'\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst allMembers = this.blocksManager.getMembers();\n\t\t\tconst selectedMembers = allMembers.filter((member) => {\n\t\t\t\treturn member.part > 1\n\t\t\t});\n\n\t\t\tDom.append(UI.getMemberSelector(\n\t\t\t\tselectedMembers,\n\t\t\t\tthis.#memberPart,\n\t\t\t\tthis.onMemberSelect.bind(this)\n\t\t\t), panelTag);\n\t\t}\n\n\t\tthis.#panelCreated = true;\n\t}\n\n\tgetCurrentFontSize()\n\t{\n\t\treturn this.#currentFontSize;\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t\tthis.#content.onStartChangePosition();\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#content.onPlaced();\n\t}\n\n\tupdateColor(color: string, emitEvent: boolean = true): void\n\t{\n\t\tthis.#content.changeStyleColor(color, emitEvent);\n\t\tthis.#stylePanel.updateColor(color);\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t\tthis.#content.onSave();\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t\tthis.#content.onRemove();\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tthis.#content.onClickOut();\n\t}\n\n\t/**\n\t * Set block styles to layout.\n\t */\n\trenderStyle()\n\t{\n\t\tthis.#stylePanel.applyStyles(\n\t\t\tthis.#layout.querySelector(this.#style.blockContent)\n\t\t);\n\t}\n\n\t/**\n\t * Adjust actions panel.\n\t */\n\tadjustActionsPanel()\n\t{\n\t\tconst blockLayout = this.getLayout();\n\t\tconst documentLayout = this.blocksManager.getLayout().parentElement;\n\t\tconst documentLayoutRect = documentLayout.getBoundingClientRect();\n\t\tconst actionsPanel = blockLayout.querySelector('[data-role=\"sign-block__actions\"]');\n\n\t\tif (actionsPanel)\n\t\t{\n\t\t\tconst actionsPanelRect = actionsPanel.getBoundingClientRect();\n\t\t\tconst marginLeft = parseFloat(getComputedStyle(actionsPanel).marginLeft);\n\n\t\t\tif (documentLayoutRect.x >= actionsPanelRect.x)\n\t\t\t{\n\t\t\t\tactionsPanel.style.marginLeft = documentLayoutRect.x - actionsPanelRect.x + marginLeft + 'px';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tactionsPanel.style.marginLeft = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Force saves the block.\n\t */\n\tforceSave()\n\t{\n\t\tthis.#layout.querySelector('[data-role=\"saveAction\"]').click();\n\t}\n\n\t/**\n\t * Creates layout for new block within document.\n\t */\n\t#createLayout()\n\t{\n\t\tthis.#layout = UI.getBlockLayout({\n\t\t\tonSave: (event) => {\n\t\t\t\tthis.renderView();\n\t\t\t\tthis.blocksManager.unMuteResizeArea();\n\t\t\t\tthis.blocksManager.hideResizeArea();\n\t\t\t\tthis.blocksManager.setSavingMark(false);\n\t\t\t\tthis.onSave();\n\n\t\t\t\tDom.removeClass(this.#layout, this.#style.blockEditing);\n\n\t\t\t\tevent.stopPropagation();\n\t\t\t},\n\t\t\tonRemove: this.#onRemoveBtnClick.bind(this),\n\t\t});\n\t\tconst nodeForPosition = document.body.querySelector('.sign-editor__content');\n\t\tconst documentLayout = this.blocksManager.getLayout();\n\t\tconst documentLayoutRect = documentLayout.getBoundingClientRect();\n\t\tconst blockInitDim = this.#content.getInitDimension();\n\t\tconst position = {\n\t\t\ttop: Math.min(nodeForPosition.scrollTop + nodeForPosition.offsetHeight / 2, documentLayoutRect.height - blockInitDim.height),\n\t\t\tleft: documentLayoutRect.width / 2 - 100\n\t\t};\n\n\t\tif (this.blocksManager.inDeadZone(position.top, position.top + blockInitDim.height))\n\t\t{\n\t\t\tposition.top += blockInitDim.height + this.blocksManager.getPagesGap();\n\t\t}\n\n\t\tthis.setPosition(position);\n\t}\n\n\tremove(): void\n\t{\n\t\tif (this.#onRemoveCallback)\n\t\t{\n\t\t\tthis.#onRemoveCallback(this);\n\t\t}\n\t\tthis.#layout.hidden = true;\n\t\tthis.onRemove();\n\t}\n\n\t#onRemoveBtnClick(event): void\n\t{\n\t\tthis.remove();\n\t\tevent.stopPropagation();\n\t}\n\n\t/**\n\t * Returns true, if block was removed.\n\t * @return {boolean}\n\t */\n\tisRemoved()\n\t{\n\t\treturn this.#layout.hidden === true;\n\t}\n\n\t#onContentChange(): void\n\t{\n\t\tconst content = this.#content;\n\t\tif (!(content instanceof Text))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.resizeText({ element: content.getContainer(), step: 0.5 });\n\t}\n\n\t#onContentColorStyleChange(event): void\n\t{\n\t\tthis.emit(this.events.onColorStyleChange, { color: this.#content.getStyles()?.color ?? null });\n\t\tconst color = this.#content.getStyles()?.color ?? null;\n\t\tif (Type.isString(color))\n\t\t{\n\t\t\tthis.#stylePanel.updateColor(color);\n\t\t}\n\t}\n\n\t#onFieldSelect(event: FieldSelectEvent): void\n\t{\n\t\tthis.emit('onFieldSelect', event);\n\t}\n}\n","import { Dom, Event, Type } from 'main.core';\nimport { Draggable, DragMoveEvent, DragStartEvent, DragEndEvent } from 'ui.draganddrop.draggable';\nimport { EventEmitter } from 'main.core.events';\nimport Block from './block';\nimport UI from './ui';\n\ntype ResizeOptions = {\n\twrapperLayout: HTMLElement\n};\n\nexport default class Resize\n{\n\tstatic borderDelta = 2;\n\n\t#wrapperLayout: HTMLElement;\n\t#layout: HTMLElement;\n\t#fullEditorContent: HTMLElement;\n\t#linkedElement: HTMLElement;\n\t#linkedBlock: Block;\n\n\tposition: DOMRect;\n\tpositionLast: { ...DOMRect, notAddDeathMargin?: boolean };\n\tresizing: boolean;\n\tmoving: boolean;\n\n\t#style = {\n\t\tresizeContainer: '.sign-area-resizable-controls > div',\n\t\tmoveContainer: '.sign-document__resize-area',\n\t\tblockEditing: 'sign-document__block-wrapper-editing'\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {ResizeOptions} options\n\t */\n\tconstructor(options: ResizeOptions)\n\t{\n\t\tif (!Type.isDomNode(options.wrapperLayout))\n\t\t{\n\t\t\tthrow new Error('Option wrapperLayout is undefined or not valid DOM Element.');\n\t\t}\n\n\t\tthis.#layout = UI.getResizeArea();\n\t\tthis.#wrapperLayout = options.wrapperLayout;\n\t\tEvent.bind(this.#layout, 'click', this.#onClick.bind(this));\n\n\t\tthis.#initResize();\n\t\tthis.#initMove();\n\t}\n\n\t/**\n\t * Returns layout of resizing area.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#layout;\n\t}\n\n\t/**\n\t * Shows resizing area over the element.\n\t * @param {Block} block\n\t */\n\tshow(block: Block)\n\t{\n\t\tif (this.#linkedBlock === block)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst pointRect = block.getLayout().getBoundingClientRect();\n\t\tthis.#layout.style.display = 'block';\n\n\t\tif (this.#linkedElement)\n\t\t{\n\t\t\tthis.#linkedElement.removeAttribute('data-active');\n\t\t}\n\t\tthis.#linkedBlock = block;\n\t\tthis.#linkedElement = block.getLayout();\n\t\tthis.#linkedElement.setAttribute('data-active', 1);\n\t\tconst wrapperLayoutRect = this.#wrapperLayout.getBoundingClientRect();\n\t\tUI.setRect(this.#layout, {\n\t\t\ttop: pointRect.top - wrapperLayoutRect.top,\n\t\t\tleft: pointRect.left - wrapperLayoutRect.left,\n\t\t\twidth: pointRect.width + Resize.borderDelta,\n\t\t\theight: pointRect.height + Resize.borderDelta,\n\t\t});\n\t}\n\n\tsetFullEditorContent(editorContent: HTMLElement)\n\t{\n\t\tthis.#fullEditorContent = editorContent;\n\t}\n\n\t/**\n\t * Hides resizing area.\n\t */\n\thide()\n\t{\n\t\tthis.#linkedBlock = null;\n\t\tthis.#layout.style.display = 'none';\n\n\t\tif (this.#linkedElement)\n\t\t{\n\t\t\tthis.#linkedElement.removeAttribute('data-active');\n\t\t}\n\t}\n\n\t/**\n\t * Returns linked block.\n\t * @return {Block|null}\n\t */\n\tgetLinkedBlock(): ?Block\n\t{\n\t\treturn this.#linkedBlock;\n\t}\n\n\t/**\n\t * On click handler (provide click to linked element).\n\t */\n\t#onClick(e)\n\t{\n\t\tif (this.moving || this.resizing)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#linkedBlock)\n\t\t{\n\t\t\tthis.#linkedBlock.fireAction();\n\t\t}\n\t}\n\n\t/**\n\t * Initializes resizing.\n\t */\n\t#initResize()\n\t{\n\t\tlet initialRect = null;\n\n\t\tconst draggable = new Draggable({\n\t\t\tcontainer: this.#wrapperLayout,\n\t\t\tdraggable: this.#style.resizeContainer,\n\t\t\ttype: BX.UI.DragAndDrop.Draggable.HEADLESS\n\t\t});\n\n\t\tthis.textResize = {\n\t\t\twrapper: null,\n\t\t\tcontent: null\n\t\t};\n\n\t\tdraggable\n\t\t\t.subscribe('start', (event: DragStartEvent) => {\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!this.textResize.wrapper || !this.textResize.content)\n\t\t\t\t{\n\t\t\t\t\tthis.textResize = {\n\t\t\t\t\t\twrapper: this.#linkedBlock.getLayout(),\n\t\t\t\t\t\tcontent: this.#linkedBlock.getLayout().querySelector('.sign-document__block-content')\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.emit('BX.Sign:resizeStart', draggable);\n\t\t\t\tinitialRect = this.#layout.getBoundingClientRect();\n\t\t\t\tthis.#linkedBlock.onStartChangePosition();\n\t\t\t\tthis.positionLast = null;\n\n\t\t\t\tDom.removeClass(this.#linkedBlock.getLayout(), this.#style.blockEditing);\n\t\t\t})\n\t\t\t.subscribe('end', (event: DragEndEvent) => {\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.resizing = false;\n\t\t\t\t}, 0);\n\n\t\t\t})\n\t\t\t.subscribe('move', (event) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.resizing = true;\n\n\t\t\t\tlet left = null;\n\t\t\t\tlet top = null;\n\t\t\t\tlet bottomResize = false;\n\t\t\t\tlet {width, height} = initialRect;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tconst areaRect = this.#layout.getBoundingClientRect();\n\t\t\t\tconst wrapperRect = this.#wrapperLayout.getBoundingClientRect();\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --left-top'))\n\t\t\t\t{\n\t\t\t\t\tleft = Math.max(0, initialRect.left + data.offsetX - wrapperRect.left);\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - wrapperRect.top);\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-top'))\n\t\t\t\t{\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - wrapperRect.top);\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --right-top'))\n\t\t\t\t{\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - wrapperRect.top);\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-right'))\n\t\t\t\t{\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --right-bottom'))\n\t\t\t\t{\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-bottom'))\n\t\t\t\t{\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --left-bottom'))\n\t\t\t\t{\n\t\t\t\t\tleft = initialRect.left + data.offsetX - wrapperRect.left;\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-left'))\n\t\t\t\t{\n\t\t\t\t\tleft = initialRect.left + data.offsetX - wrapperRect.left;\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t}\n\n\t\t\t\tif (width < 60 || height < 20)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst newPosition = { width, height };\n\n\t\t\t\tif (newPosition['width'] + areaRect.left - wrapperRect.left > wrapperRect.width)\n\t\t\t\t{\n\t\t\t\t\twidth = newPosition['width'] = wrapperRect.width + wrapperRect.left - areaRect.left;\n\t\t\t\t}\n\n\t\t\t\tif (newPosition['height'] + areaRect.top - wrapperRect.top > wrapperRect.height)\n\t\t\t\t{\n\t\t\t\t\theight = newPosition['height'] = wrapperRect.height + wrapperRect.top - areaRect.top;\n\t\t\t\t}\n\n\t\t\t\tif (left)\n\t\t\t\t{\n\t\t\t\t\tif (left < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tleft = 0;\n\t\t\t\t\t}\n\t\t\t\t\tnewPosition['left'] = left;\n\t\t\t\t}\n\t\t\t\tif (top)\n\t\t\t\t{\n\t\t\t\t\tnewPosition['top'] = top;\n\t\t\t\t}\n\n\t\t\t\tlet calcDeathTop = initialRect.top;\n\t\t\t\tlet notAddDeathMargin = true;\n\t\t\t\tif (newPosition.top)\n\t\t\t\t{\n\t\t\t\t\tcalcDeathTop = newPosition.top;\n\t\t\t\t\tnotAddDeathMargin = false;\n\t\t\t\t}\n\n\t\t\t\tif (this.#linkedBlock.blocksManager.inDeadZone(calcDeathTop, calcDeathTop + newPosition.height, notAddDeathMargin))\n\t\t\t\t{\n\t\t\t\t\tif (!bottomResize)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.showNotAllowedArea();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst newPositionLinked = Object.assign({}, {\n\t\t\t\t\t...newPosition,\n\t\t\t\t\twidth: width - Resize.borderDelta,\n\t\t\t\t\theight: height - Resize.borderDelta,\n\t\t\t\t});\n\n\t\t\t\tUI.setRect(this.#layout, newPosition);\n\t\t\t\tUI.setRect(this.#linkedElement, newPositionLinked);\n\n\t\t\t\tthis.#linkedBlock.renderView();\n\t\t\t\tthis.#linkedBlock.blocksManager.setSavingMark(false);\n\t\t\t\tthis.#linkedBlock.adjustActionsPanel();\n\t\t\t});\n\t}\n\n\t/**\n\t * Initializes moving.\n\t */\n\t#initMove()\n\t{\n\t\tconst dragArea = this.#wrapperLayout;\n\t\tlet widthInProcess;\n\n\t\tconst draggable = new Draggable({\n\t\t\tcontainer: dragArea,\n\t\t\tdraggable: this.#style.moveContainer,\n\t\t\ttype: Draggable.HEADLESS\n\t\t});\n\n\t\tdraggable\n\t\t\t.subscribe('start', (event: DragStartEvent) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.emit('BX.Sign:moveStart', draggable);\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst {source} = event.getData();\n\t\t\t\tthis.position = Dom.getPosition(source);\n\t\t\t\tthis.#linkedBlock.onStartChangePosition();\n\t\t\t\tthis.positionLast = null;\n\n\t\t\t\tDom.removeClass(this.#linkedBlock.getLayout(), this.#style.blockEditing);\n\t\t\t})\n\t\t\t.subscribe('end', (event: DragEndEvent) => {\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.moving = false;\n\t\t\t\t}, 0);\n\n\t\t\t\tif (!this.#linkedBlock)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twidthInProcess = null;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tlet moveTopDelta = null;\n\t\t\t\tif (this.positionLast)\n\t\t\t\t{\n\t\t\t\t\tmoveTopDelta = this.#linkedBlock.blocksManager.inDeadZone(this.positionLast.top, this.positionLast.top + this.positionLast.height);\n\t\t\t\t}\n\n\t\t\t\tthis.#linkedBlock.hideNotAllowedArea();\n\n\t\t\t\tif (moveTopDelta)\n\t\t\t\t{\n\t\t\t\t\tUI.setRect(data.source, {top: this.positionLast.top + moveTopDelta});\n\t\t\t\t\tUI.setRect(this.#linkedElement, {top: this.positionLast.top + moveTopDelta});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('move', (event: DragMoveEvent) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.moving = true;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tconst {source, offsetY, offsetX} = data;\n\t\t\t\tconst areaRect = data.source.getBoundingClientRect();\n\t\t\t\tconst wrapperRect = this.#wrapperLayout.getBoundingClientRect();\n\n\t\t\t\tif (this.position)\n\t\t\t\t{\n\t\t\t\t\tconst newPosition = {\n\t\t\t\t\t\ttop: offsetY - wrapperRect.top + this.position.y,\n\t\t\t\t\t\tleft: offsetX - wrapperRect.left + this.position.x,\n\t\t\t\t\t\twidth: widthInProcess ? widthInProcess : this.position.width,\n\t\t\t\t\t\theight: this.position.height\n\t\t\t\t\t};\n\n\t\t\t\t\tif (newPosition.left < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.left = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.top < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.top = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.top + areaRect.height > wrapperRect.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.top = wrapperRect.height - areaRect.height;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.left + areaRect.width > wrapperRect.width)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.renderView();\n\t\t\t\t\t\tif (wrapperRect.width - newPosition.left > 50)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twidthInProcess = newPosition.width = wrapperRect.width - newPosition.left;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnewPosition.left = wrapperRect.width - areaRect.width;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.positionLast = Object.assign({}, newPosition);\n\n\t\t\t\t\tlet moveTopDelta = null;\n\n\t\t\t\t\tif (this.positionLast)\n\t\t\t\t\t{\n\t\t\t\t\t\tmoveTopDelta = this.#linkedBlock.blocksManager.inDeadZone(this.positionLast.top, this.positionLast.top + this.positionLast.height);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (moveTopDelta > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.showNotAllowedArea();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.hideNotAllowedArea();\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newPositionLinked = Object.assign({}, {\n\t\t\t\t\t\t...newPosition,\n\t\t\t\t\t\twidth: newPosition.width - Resize.borderDelta,\n\t\t\t\t\t\theight: newPosition.height - Resize.borderDelta,\n\t\t\t\t\t});\n\n\t\t\t\t\tUI.setRect(source, newPosition);\n\t\t\t\t\tUI.setRect(this.#linkedElement, newPositionLinked);\n\n\t\t\t\t\tthis.#linkedBlock.blocksManager.setSavingMark(false);\n\t\t\t\t\tthis.#linkedBlock.adjustActionsPanel();\n\t\t\t\t}\n\t\t\t});\n\t}\n}\n","import { Dom, Event, Loc, Text, Type, Cache } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Backend } from 'sign.backend';\nimport { Guide } from 'sign.tour';\nimport { Api } from 'sign.v2.api';\nimport 'spotlight';\nimport { Button, ButtonColor } from 'ui.buttons';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport 'ui.info-helper';\nimport { UI } from 'ui.notification';\nimport { BlockItem, Config, DocumentOptions, MemberItem, PositionType } from '../types/document';\nimport type { FieldSelectEvent } from '../types/events/FieldSelectEvent';\nimport Block from './block';\nimport Resize from './resize';\n\nconst marginTop = 0;\nconst gapBetweenPages = 20;\n\ntype EventListenerCache = Map<Block, {\n\tsubscription: (Block) => void,\n\teventName: string,\n}>;\n\nexport class BlocksManager\n{\n\t#documentId: number;\n\t#documentUid: string;\n\t#companyId: number;\n\t#initiatorName: string;\n\t#entityId: number;\n\t#blankId: number;\n\t#pagesMinHeight: number = 0;\n\t#disableEdit: boolean;\n\t#closeDemoContent: boolean = false;\n\t#members: Array<MemberItem>;\n\t#documentLayout: HTMLElement;\n\tresizeArea: Resize;\n\t#languages: { [key: string]: { NAME: string; IS_BETA: boolean; } } = {};\n\t#blocks: Array<Block> = [];\n\t#eventListeners: { [eventListenerCacheName: string]: EventListenerCache } = {\n\t\tblockColorChange: new Map(),\n\t\tblockReferenceFieldSelect: new Map(),\n\t\tblockB2eReferenceFieldSelect: new Map(),\n\t};\n\t#pagesRects: Array<DOMRect> = [];\n\t#seams: Array<Array<number, number>> = [];\n\t#config: Config;\n\t#helpBtnElementId = 'sign-editor-help-btn';\n\t#helpBtnHelperArticleCode = '16571388';\n\t#api: Api;\n\t#lastContainerSize;\n\t#cache: Cache.MemoryCache = new Cache.MemoryCache();\n\n\t/**\n\t * Constructor.\n\t * @param {DocumentOptions} options\n\t */\n\tconstructor(options: DocumentOptions)\n\t{\n\t\tconst { documentLayout, disableEdit } = options;\n\t\tthis.#documentLayout = documentLayout;\n\t\tthis.#disableEdit = disableEdit;\n\t\tif (!this.#disableEdit)\n\t\t{\n\t\t\tthis.resizeArea = new Resize({ wrapperLayout: this.#documentLayout });\n\t\t\tDom.append(this.resizeArea.getLayout(), this.#documentLayout);\n\t\t}\n\n\t\tEvent.bind(documentLayout, 'click', ({ target }) => {\n\t\t\tconst preventClickOut = target.closest('.sign-document__block-wrapper') ||\n\t\t\t\ttarget.closest('.sign-document__resize-area');\n\t\t\tif (preventClickOut)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst activeBlock = this.resizeArea.getLinkedBlock();\n\t\t\tactiveBlock?.onClickOut();\n\t\t});\n\t\tthis.#languages = options.languages;\n\t\tthis.#api = new Api();\n\t\tthis.#lastContainerSize = {\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t};\n\t}\n\n\tinitPagesRect()\n\t{\n\t\tlet top = 0;\n\t\tconst pages = [...this.#documentLayout.querySelectorAll('.sign-editor__document_page img')];\n\t\tthis.#pagesRects = [];\n\t\tthis.#seams = [];\n\t\tconst content = document.querySelector('.sign-editor__content');\n\t\tpages.forEach(page => {\n\t\t\tconst pageRect = page.getBoundingClientRect();\n\t\t\tconst pageRectToMath = {};\n\n\t\t\t// round getBoundingClientRect\n\t\t\tfor (let pageRectKey in pageRect)\n\t\t\t{\n\t\t\t\tif (Type.isNumber(pageRect[pageRectKey]))\n\t\t\t\t{\n\t\t\t\t\tpageRectToMath[pageRectKey] = Math.round(pageRect[pageRectKey]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpageRectToMath[pageRectKey] = pageRect[pageRectKey];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst topBound = top === 0 ? 0 : pageRectToMath.top - gapBetweenPages + content.scrollTop;\n\t\t\tconst bottomBound = pageRectToMath.top + marginTop + content.scrollTop;\n\t\t\t// collect seam's gaps\n\t\t\tthis.#seams.push([topBound, bottomBound]);\n\n\t\t\t// correct top after rounding\n\t\t\tif (top === 0)\n\t\t\t{\n\t\t\t\ttop = pageRectToMath.top;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttop += gapBetweenPages;\n\t\t\t\tpageRectToMath.top = top;\n\t\t\t}\n\n\t\t\t// collect pages rects\n\t\t\tthis.#pagesRects.push(pageRectToMath);\n\n\t\t\t// remember min page height\n\t\t\tif (!this.#pagesMinHeight || pageRect.height < this.#pagesMinHeight)\n\t\t\t{\n\t\t\t\tthis.#pagesMinHeight = pageRect.height;\n\t\t\t}\n\t\t});\n\t\tthis.#documentLayout.style.width = `${this.#documentLayout.offsetWidth}px`;\n\t}\n\n\t/**\n\t * Transfers absolute position to page position and sets page number.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\ttransferPositionToPage(position: PositionType): PositionType\n\t{\n\t\tposition.page = 1;\n\n\t\tfor (\n\t\t\tlet i = 0,\n\t\t\t\tc = this.#pagesRects.length; i < c; i++\n\t\t)\n\t\t{\n\t\t\tconst height = this.#pagesRects[i].height;\n\n\t\t\tif (i !== 0) // skip gap for first page\n\t\t\t{\n\t\t\t\tposition.top -= gapBetweenPages;\n\t\t\t}\n\n\t\t\tposition.top -= height;\n\t\t\tif (position.top < 0)\n\t\t\t{\n\t\t\t\tposition.top += height;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tposition.page++;\n\t\t\t}\n\t\t}\n\n\t\treturn position;\n\t}\n\n\t/**\n\t * Transfers pixel of position to percent.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\t#pixelToPercent(position: PositionType, pageRect): PositionType\n\t{\n\t\tposition.widthPx = position.width;\n\t\tposition.heightPx = position.height;\n\t\tposition.left = position.left * 100 / pageRect.width;\n\t\tposition.top = position.top * 100 / pageRect.height;\n\t\tposition.width = position.width / pageRect.width * 100;\n\t\tposition.height = position.height / pageRect.height * 100;\n\n\t\treturn position;\n\t}\n\n\t/**\n\t * Transfers percent of position to pixel.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\t#percentToPixel(position: PositionType): PositionType\n\t{\n\t\tif (!position.page || typeof this.#pagesRects[position.page - 1] === 'undefined')\n\t\t{\n\t\t\treturn position;\n\t\t}\n\n\t\tconst pageImageRect = this.#pagesRects[position.page - 1];\n\t\tconst pixelPosition = {};\n\n\t\tif (typeof position.left === 'number')\n\t\t{\n\t\t\tpixelPosition.left = position.left * pageImageRect.width / 100;\n\t\t}\n\t\tif (typeof position.top === 'number')\n\t\t{\n\t\t\tlet top = position.top * pageImageRect.height / 100;\n\t\t\tlet pageNum = 0;\n\t\t\twhile (pageNum < position.page - 1)\n\t\t\t{\n\t\t\t\ttop += this.#pagesRects[pageNum].height + gapBetweenPages;\n\t\t\t\tpageNum++;\n\t\t\t}\n\n\t\t\tpixelPosition.top = top;\n\t\t}\n\t\tif (typeof position.width === 'number')\n\t\t{\n\t\t\tpixelPosition.width = position.width * pageImageRect.width / 100;\n\t\t}\n\t\tif (typeof position.height === 'number')\n\t\t{\n\t\t\tpixelPosition.height = position.height * pageImageRect.height / 100;\n\t\t}\n\n\t\treturn pixelPosition;\n\t}\n\n\t/**\n\t * Returns minimal pages height.\n\t * @return {number}\n\t */\n\tgetMinPageHeight(): number\n\t{\n\t\treturn this.#pagesMinHeight - marginTop;\n\t}\n\n\t/**\n\t * Returns document id.\n\t * @return {number}\n\t */\n\tgetDocumentId(): number\n\t{\n\t\treturn this.#documentId;\n\t}\n\n\tsetDocumentId(documentId: number): self\n\t{\n\t\tthis.#documentId = documentId;\n\n\t\treturn this;\n\t}\n\n\tgetDocumentUid(): string\n\t{\n\t\treturn this.#documentUid;\n\t}\n\n\tsetEditorContent(editorContent: HTMLElement)\n\t{\n\t\tthis.resizeArea.setFullEditorContent(editorContent);\n\t}\n\n\tsetDocumentUid(documentUid: string): BlocksManager\n\t{\n\t\tthis.#documentUid = documentUid;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns document entity id.\n\t * @return {number}\n\t */\n\tgetEntityId(): number\n\t{\n\t\treturn this.#entityId;\n\t}\n\n\t/**\n\t * Returns document's layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#documentLayout;\n\t}\n\n\t/**\n\t * Returns number pairs (seams between pages).\n\t * @return {Array<Array<number, number>>}\n\t */\n\tgetSeams(): Array<Array<number, number>>\n\t{\n\t\treturn this.#seams;\n\t}\n\n\t/**\n\t * Returns gap between pages.\n\t * @return {number}\n\t */\n\tgetPagesGap(): number\n\t{\n\t\treturn gapBetweenPages + marginTop;\n\t}\n\n\taddMembers(members: Array<MemberItem>)\n\t{\n\t\tthis.#members = members;\n\t}\n\n\t/**\n\t * Returns document's members\n\t * @return {Array<MemberItem>}\n\t */\n\tgetMembers(): Array<MemberItem>\n\t{\n\t\treturn this.#members;\n\t}\n\n\t/**\n\t * Returns member item by member part.\n\t * @param {number} part\n\t * @return {null}\n\t */\n\tgetMemberByPart(part: number): ?MemberItem\n\t{\n\t\tlet returnMember = null;\n\n\t\tthis.#members.map((member: MemberItem) => {\n\t\t\tif (member.part === part)\n\t\t\t{\n\t\t\t\treturnMember = member;\n\t\t\t}\n\t\t});\n\n\t\treturn returnMember;\n\t}\n\n\t/**\n\t * Returns company id.\n\t * @return {number}\n\t */\n\tgetCompanyId(): number\n\t{\n\t\treturn this.#companyId;\n\t}\n\n\t/**\n\t * @return {string}\n\t */\n\tgetInitiatorName(): string\n\t{\n\t\treturn this.#initiatorName;\n\t}\n\n\t/**\n\t * Returns Config object.\n\t * @return {Config}\n\t */\n\tgetConfig(): Config\n\t{\n\t\treturn this.#config;\n\t}\n\n\t/**\n\t * Hides resizing area.\n\t */\n\thideResizeArea()\n\t{\n\t\tthis.resizeArea.hide();\n\t}\n\n\t/**\n\t * Shows resizing area over the block.\n\t * @param {Block} block\n\t */\n\tshowResizeArea(block: Block)\n\t{\n\t\tthis.resizeArea.show(block);\n\t}\n\n\t/**\n\t * Mutes resizing area.\n\t */\n\tmuteResizeArea()\n\t{\n\t\tthis.resizeArea.getLayout().setAttribute('data-disable', 1);\n\t}\n\n\t/**\n\t * Unmutes resizing area.\n\t */\n\tunMuteResizeArea()\n\t{\n\t\tthis.resizeArea.getLayout().removeAttribute('data-disable');\n\t}\n\n\t/**\n\t * Adds block to the document.\n\t * @param {BlockItem} data Block data.\n\t * @param {boolean} seamShift If true, will be added seam shift to top's position.\n\t * @return {Block}\n\t */\n\t#addBlock(data: BlockItem, seamShift: boolean): Block\n\t{\n\t\tconst position = data.position ? this.#percentToPixel(data.position) : null;\n\t\tconst newBlock = new Block({\n\t\t\tid: data.id,\n\t\t\tcode: data.code,\n\t\t\tparty: data.party,\n\t\t\tblocksManager: this,\n\t\t\tdata: data.data,\n\t\t\tposition,\n\t\t\tstyle: data.style,\n\t\t\tonClick: (block: Block) => {\n\t\t\t\tif (this.#disableEdit)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.resizeArea.show(block);\n\t\t\t\tthis.unMuteResizeArea();\n\t\t\t\tblock.adjustActionsPanel();\n\t\t\t},\n\t\t\tonRemove: (block: Block) => {\n\t\t\t\tthis.resizeArea.hide();\n\t\t\t},\n\t\t});\n\t\tconst blockLayout = newBlock.getLayout();\n\t\tthis.#subscribeOnBlockEvents(newBlock);\n\n\t\tif (['sign', 'mysign'].includes(newBlock.getCode()))\n\t\t{\n\t\t\tconst existedSignBlock: Block | undefined = this.#blocks.find(block => block.getCode() === newBlock.getCode());\n\t\t\tconst signColor: string | undefined = existedSignBlock?.getStyle?.()?.color;\n\t\t\tif (!Type.isNil(signColor))\n\t\t\t{\n\t\t\t\tnewBlock.updateColor(signColor, false);\n\t\t\t}\n\t\t}\n\n\t\tthis.#blocks.push(newBlock);\n\n\t\tDom.append(blockLayout, this.#documentLayout);\n\n\t\treturn newBlock;\n\t}\n\n\t#subscribeOnBlockEvents(newBlock: Block): void\n\t{\n\t\tconst newBlockCode = newBlock.getCode();\n\t\tif (['sign', 'mysign'].includes(newBlockCode))\n\t\t{\n\t\t\tconst colorChangeListener = (event) => this.#onBlockColorStyleChange(newBlock, event);\n\t\t\tthis.#eventListeners.blockColorChange.set(\n\t\t\t\tnewBlock,\n\t\t\t\t{ subscription: colorChangeListener, eventName: newBlock.events.onColorStyleChange },\n\t\t\t);\n\t\t\tnewBlock.subscribe(\n\t\t\t\tnewBlock.events.onColorStyleChange,\n\t\t\t\tcolorChangeListener,\n\t\t\t);\n\t\t}\n\t\telse if (['myreference', 'reference'].includes(newBlockCode))\n\t\t{\n\t\t\tconst onFieldSelectListener = (event: FieldSelectEvent) => this.#onReferenceBlockFieldSelect(\n\t\t\t\tnewBlock,\n\t\t\t\tevent,\n\t\t\t);\n\t\t\tthis.#eventListeners.blockReferenceFieldSelect.set(\n\t\t\t\tnewBlock,\n\t\t\t\t{ subscription: onFieldSelectListener, eventName: 'onFieldSelect' },\n\t\t\t);\n\t\t\tnewBlock.subscribe(\n\t\t\t\t'onFieldSelect',\n\t\t\t\tonFieldSelectListener,\n\t\t\t);\n\t\t}\n\t\telse if (['b2ereference', 'myb2ereference'].includes(newBlockCode))\n\t\t{\n\t\t\tconst onFieldSelectListener = (event: FieldSelectEvent) => this.#onB2eReferenceBlockFieldSelect(\n\t\t\t\tnewBlock,\n\t\t\t\tevent,\n\t\t\t);\n\n\t\t\tthis.#eventListeners.blockB2eReferenceFieldSelect.set(\n\t\t\t\tnewBlock,\n\t\t\t\t{ subscription: onFieldSelectListener, eventName: 'onFieldSelect' },\n\t\t\t);\n\t\t\tnewBlock.subscribe(\n\t\t\t\t'onFieldSelect',\n\t\t\t\tonFieldSelectListener,\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Fires on click repository item.\n\t * @param {string} code Block code.\n\t * @param {string} part Member part (base - my company, other - third part).\n\t */\n\t#onRepositoryItemClick(code: string, party: number)\n\t{\n\t\tparty = parseInt(party);\n\t\tthis.setSavingMark(false);\n\n\t\tconst block = this.#addBlock({ code, party });\n\t\tblock.assign();\n\t\tblock.onPlaced();\n\t}\n\n\t/**\n\t * Sets exists blocks to the document.\n\t * @param blocks\n\t */\n\tinitBlocks(blocks: Array<BlockItem>)\n\t{\n\t\tthis.#unsubscribeFromBlocksEvents();\n\t\tthis.#blocks = [];\n\t\tthis.hideResizeArea();\n\t\tblocks.map(block => this.#addBlock(block, true));\n\t}\n\n\tinitRepository(repositoryItems: NodeList)\n\t{\n\t\t[...repositoryItems].forEach((item: HTMLElement) => {\n\n\t\t\tconst code = item.getAttribute('data-code');\n\t\t\tconst part = item.getAttribute('data-part');\n\n\t\t\tEvent.bind(item, 'click', e => {\n\t\t\t\tthis.#onRepositoryItemClick(code, part);\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Returns blocks collection.\n\t * @return {Array<Block>}\n\t */\n\tgetBlocks(): Array<Block>\n\t{\n\t\treturn this.#blocks;\n\t}\n\n\tgetLanguages(): {[key: string]: { NAME: string; IS_BETA: boolean; }}\n\t{\n\t\treturn this.#languages;\n\t}\n\n\t/**\n\t * Saves document and closes slider.\n\t * @return {Promise}\n\t */\n\tsave(): Promise<any, any>\n\t{\n\t\tconst postData = [];\n\n\t\tconst realDocumentWidth = document.querySelector('.sign-editor__document').offsetWidth;\n\n\t\tthis.#blocks.map(block => {\n\n\t\t\tif (block.isRemoved())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst blockLayout = block.getLayout();\n\t\t\tconst blockRect = blockLayout.getBoundingClientRect();\n\t\t\tconst pages = [...this.#documentLayout.querySelectorAll('.sign-editor__document_page img')];\n\t\t\tconst pagesRect = pages.map((page) => {\n\t\t\t\tconst { top, left, width, height } = page.getBoundingClientRect();\n\n\t\t\t\treturn {\n\t\t\t\t\ttop,\n\t\t\t\t\tleft,\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t};\n\t\t\t});\n\t\t\tconst nextPageRect = pagesRect.find((pageRect) => {\n\t\t\t\tif (Math.round(blockRect.top) < Math.round(pageRect.top))\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\tconst pageNum = nextPageRect ? pagesRect.indexOf(nextPageRect) : pagesRect.length;\n\t\t\tconst currentPageRect = pagesRect[pageNum - 1];\n\t\t\tlet position = {\n\t\t\t\ttop: blockRect.top - currentPageRect.top,\n\t\t\t\tleft: blockRect.left - currentPageRect.left,\n\t\t\t\twidth: blockRect.width,\n\t\t\t\theight: blockRect.height,\n\t\t\t\tpage: pageNum,\n\t\t\t};\n\t\t\tposition = this.#pixelToPercent(position, currentPageRect);\n\t\t\tposition.realDocumentWidthPx = realDocumentWidth ? realDocumentWidth : null;\n\t\t\tconst code = block.getCode();\n\t\t\tlet type = 'text';\n\t\t\tswitch (code)\n\t\t\t{\n\t\t\t\tcase 'stamp':\n\t\t\t\tcase 'mystamp':\n\t\t\t\tcase 'sign':\n\t\t\t\tcase 'mysign':\n\t\t\t\t\ttype = 'image';\n\t\t\t}\n\t\t\tpostData.push({\n\t\t\t\tid: block.getId(),\n\t\t\t\tcode: block.getCode(),\n\t\t\t\tdata: block.getData(),\n\t\t\t\tparty: block.getMemberPart(),\n\t\t\t\tstyle: block.getStyle(),\n\t\t\t\tposition,\n\t\t\t\ttype,\n\t\t\t});\n\t\t});\n\n\t\tconst params = {};\n\t\tif (this.#closeDemoContent)\n\t\t{\n\t\t\tparams['closeDemoContent'] = true;\n\t\t}\n\t\tthis.hideResizeArea();\n\n\t\treturn this.#api.saveBlank(\n\t\t\tthis.getDocumentUid(),\n\t\t\tpostData.length > 0 ? postData : [],\n\t\t).then((response) => {\n\n\t\t\tif (!('errors' in response))\n\t\t\t{\n\t\t\t\treturn postData;\n\t\t\t}\n\n\t\t\tif (response.errors[0].customData?.field === 'requisites')\n\t\t\t{\n\t\t\t\tconst popup = new Popup({\n\t\t\t\t\tid: 'sign_document_error_popup',\n\t\t\t\t\ttitleBar: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE_TITLE'),\n\t\t\t\t\tcontent: BX.util.htmlspecialchars(response.errors[0]?.message),\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE'),\n\t\t\t\t\t\t\tcolor: ButtonColor.SUCCESS,\n\t\t\t\t\t\t\tonclick: ({ button }) => {\n\t\t\t\t\t\t\t\tconst target = button;\n\t\t\t\t\t\t\t\tDom.addClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\t\tBackend.controller({\n\t\t\t\t\t\t\t\t\tcommand: 'document.restoreRequisiteFields',\n\t\t\t\t\t\t\t\t\tpostData: {\n\t\t\t\t\t\t\t\t\t\tdocumentId: this.#documentId,\n\t\t\t\t\t\t\t\t\t\tpresetId: response.errors[0]?.customData.presetId,\n\t\t\t\t\t\t\t\t\t\tcode: response.errors[0]?.customData.code,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\t\t\t\tDom.removeClass(target, 'ui-btn-wait');\n\n\t\t\t\t\t\t\t\t\tthis.#blocks.map((block) => {\n\t\t\t\t\t\t\t\t\t\tif (block.isRemoved())\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (block.getCode() === response.errors[0]?.customData.code)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tblock.assign();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t\t}).catch(() => {\n\t\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE_BY_HANDS'),\n\t\t\t\t\t\t\tcolor: ButtonColor.INFO,\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.#blocks.map((block) => {\n\t\t\t\t\t\t\t\t\tif (block.isRemoved())\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (block.getCode() === response.errors[0]?.customData.code)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tconst blockActionButton = document.querySelector(\n\t\t\t\t\t\t\t\t\t\t\t`button[data-id=\"action-${block.getCode()}]`,\n\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\tif (blockActionButton)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tblockActionButton.click();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tpopup.show();\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst firstError = response.errors[0];\n\t\t\tif (firstError.code === 'REFERENCE_ERROR_FIELD_NOT_SELECTED')\n\t\t\t{\n\t\t\t\tthis.#highlightInvalidBlocks();\n\t\t\t\tconst popup = new Popup({\n\t\t\t\t\tid: 'sign_document_error_popup',\n\t\t\t\t\ttitleBar: Loc.getMessage('SIGN_EDITOR_ERROR_SAVE_REFERENCE_BACK_TITLE'),\n\t\t\t\t\tcontent: BX.util.htmlspecialchars(firstError.message),\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_EDITOR_ERROR_SAVE_REFERENCE_BACK'),\n\t\t\t\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tEventEmitter.subscribeOnce('SidePanel.Slider:onCloseComplete', () => {\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t});\n\t\t\t\tpopup.show();\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn postData;\n\t\t});\n\t}\n\n\t/**\n\t * Registers save button.\n\t * @param {DocumentOptions} options\n\t */\n\tonSave(options: DocumentOptions)\n\t{\n\t\tEvent.bind(options.saveButton, 'click', (e) => {\n\t\t\tif (this.#disableEdit)\n\t\t\t{\n\t\t\t\tif (options.afterSaveCallback)\n\t\t\t\t{\n\t\t\t\t\toptions.afterSaveCallback();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.save()\n\t\t\t\t.then(result => {\n\t\t\t\t\t//todo: we need to parse response and sets id for each new block\n\t\t\t\t\tif (result === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setSavingMark(true);\n\n\t\t\t\t\t\tif (options.afterSaveCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toptions.afterSaveCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (result !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (options.saveErrorCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toptions.saveErrorCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Registers callback on slider close.\n\t */\n\tonCloseSlider()\n\t{\n\t\tBX.addCustomEvent('SidePanel.Slider:onClose', (event) => {\n\t\t\tif (event.slider.url.indexOf('/sign/edit/') === 0)\n\t\t\t{\n\t\t\t\tif (!this.everythingIsSaved())\n\t\t\t\t{\n\t\t\t\t\tevent.denyAction();\n\n\t\t\t\t\tMessageBox.confirm(\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_MESSAGE'),\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_TITLE'),\n\t\t\t\t\t\t(messageBox: MessageBox) => {\n\t\t\t\t\t\t\tthis.setSavingMark(true);\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t\tevent.slider.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_APPLY'),\n\t\t\t\t\t\t(messageBox: MessageBox) => {\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Sets mark to document that everything was saved or not.\n\t * @param {boolean} mark\n\t */\n\tsetSavingMark(mark: boolean)\n\t{\n\t\tthis.setParam('bxSignEditorAllSaved', mark);\n\t}\n\n\t/**\n\t * Returns true, if everything was saved within editor.\n\t * @return {boolean}\n\t */\n\teverythingIsSaved(): boolean\n\t{\n\t\treturn this.getParam('bxSignEditorAllSaved') === true;\n\t}\n\n\tsetParam(name: string, value: any): void\n\t{\n\t\tconst slider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (slider)\n\t\t{\n\t\t\tslider.getData().set(name, value);\n\t\t}\n\t}\n\n\tgetParam(name: string): any\n\t{\n\t\tconst slider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (slider)\n\t\t{\n\t\t\treturn slider.getData().get(name);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\t/**\n\t * Returns true if element with specified top & bottom over dead zone.\n\t * @param {number} top\n\t * @param {number} bottom\n\t * @param {boolean} notAddMargin\n\t * @return {boolean}\n\t */\n\tinDeadZone(top: number, bottom: number, notAddMargin: boolean): boolean\n\t{\n\t\tconst seams = this.getSeams();\n\t\tconst content = document.querySelector('.sign-editor__content');\n\t\ttop += content.scrollTop;\n\t\tbottom += content.scrollTop;\n\t\tif (seams.length > 0 && notAddMargin !== true)\n\t\t{\n\t\t\tconst documentLayoutRect = this.#documentLayout.getBoundingClientRect();\n\t\t\ttop += documentLayoutRect.top;\n\t\t\tbottom += documentLayoutRect.top;\n\t\t}\n\n\t\tfor (\n\t\t\tlet ii = 0,\n\t\t\t\tcc = seams.length; ii < cc; ii++\n\t\t)\n\t\t{\n\t\t\tconst seam = seams[ii];\n\n\t\t\t// top on page, bottom on seam\n\t\t\tif (top <= seam[0] && bottom >= seam[0] && bottom <= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// top on one page, bottom on another (seam in a middle)\n\t\t\tif (top <= seam[0] && bottom >= seam[1])\n\t\t\t{\n\t\t\t\t//seam[0] - bottom >> shift top\n\t\t\t\t//seam[1] - top >> shift bottom\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// block into a seam\n\t\t\tif (top >= seam[0] && bottom <= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// top on seam, bottom on page\n\t\t\tif (top >= seam[0] && top <= seam[1] && bottom >= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[1] - top;\n\t\t\t}\n\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\t#startDisabledEditDocumentTour()\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById('sign-editor-btn-edit'),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_EDIT_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_EDIT_TEXT'),\n\t\t\t\t},\n\t\t\t],\n\t\t\tid: 'sign-tour-guide-onboarding-master-document-edit-disabled',\n\t\t\tautoSave: true,\n\t\t\tsimpleMode: true,\n\t\t});\n\t\tguide.startOnce();\n\t}\n\n\t#startEditDocumentTour()\n\t{\n\t\tconst helpBtnSpotlight = new BX.SpotLight({\n\t\t\ttargetElement: document.getElementById(this.#helpBtnElementId),\n\t\t\ttargetVertex: 'middle-center',\n\t\t\tautoSave: true,\n\t\t\tid: 'sign-spotlight-onboarding-master-document-edit',\n\t\t});\n\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById('sign-editor-bar-content'),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_BLOCKS_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_BLOCKS_TEXT'),\n\t\t\t\t\tposition: 'left',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById(this.#helpBtnElementId),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_HELP_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_HELP_TEXT'),\n\t\t\t\t\trounded: true,\n\t\t\t\t\tarticle: this.#helpBtnHelperArticleCode,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonShow: () => helpBtnSpotlight.show(),\n\t\t\t\t\t\tonClose: () => helpBtnSpotlight.close(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tid: 'sign-tour-guide-onboarding-master-document-edit',\n\t\t\tautoSave: true,\n\t\t\tsimpleMode: true,\n\t\t});\n\t\tguide.startOnce();\n\t}\n\n\t#highlightInvalidBlocks()\n\t{\n\t\tthis.#blocks.forEach((block) => {\n\t\t\tif (block.isRemoved())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst code = block.getCode();\n\t\t\tconst isCRM = code === 'reference' || code === 'myreference';\n\t\t\tif (isCRM && Type.isArray(block.getData()))\n\t\t\t{\n\t\t\t\tDom.addClass(block.getLayout(), '--invalid');\n\t\t\t}\n\t\t});\n\t}\n\n\t#onBlockColorStyleChange(updatedBlock: Block, event: BaseEvent)\n\t{\n\t\tif (!['sign', 'mysign'].includes(updatedBlock.getCode()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst newColor: string | null = event.getData().color ?? null;\n\t\tif (Type.isNull(newColor))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#blocks\n\t\t\t.filter((block) => updatedBlock.getCode() === block.getCode())\n\t\t\t.forEach((block) => {\n\t\t\t\tif (updatedBlock === block)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tblock.updateColor(newColor, false);\n\t\t\t})\n\t\t;\n\t}\n\n\t#onReferenceBlockFieldSelect(block: Block, event: FieldSelectEvent): void\n\t{\n\t\tif (event.getData().selectedFieldNames.length === 0)\n\t\t{\n\t\t\tconst deleteLatency = 150;\n\t\t\tsetTimeout((): void => this.#onBlockDeleteBecauseFieldNotSelected(block), deleteLatency);\n\t\t}\n\t}\n\n\t#onB2eReferenceBlockFieldSelect(block: Block, event: FieldSelectEvent): void\n\t{\n\t\tif (event.getData().selectedFieldNames.length === 0)\n\t\t{\n\t\t\tconst deleteLatency = 150;\n\t\t\tsetTimeout((): void => this.#onB2eReferenceBlockDeleteBecauseFieldNotSelected(block), deleteLatency);\n\t\t}\n\t}\n\n\t#onBlockDeleteBecauseFieldNotSelected(block: Block): void\n\t{\n\t\tblock.remove();\n\t\t// show notification once\n\t\tthis.#cache.remember('notify', () => UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(Loc.getMessage('SIGN_EDITOR_ERROR_REFERENCE_BLOCK_FIELD_NOT_SELECTED_HINT_TEXT')),\n\t\t\tautoHideDelay: 3000,\n\t\t\twidth: 480,\n\t\t}));\n\t}\n\n\t#onB2eReferenceBlockDeleteBecauseFieldNotSelected(block: Block): void\n\t{\n\t\tblock.remove();\n\t\t// show notification once\n\t\tthis.#cache.remember('notifyB2e', () => UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(Loc.getMessage('SIGN_EDITOR_ERROR_B2E_REFERENCE_BLOCK_FIELD_NOT_SELECTED_HINT_TEXT')),\n\t\t\tautoHideDelay: 3000,\n\t\t\twidth: 480,\n\t\t}));\n\t}\n\n\t#unsubscribeFromBlocksEvents(): void\n\t{\n\t\tconst subscriptions: Array<[Block, EventListenerCache]> = Object\n\t\t\t.values(this.#eventListeners)\n\t\t\t.flatMap((subscription) => [...subscription.entries()])\n\t\t;\n\t\tfor (const [block, { subscription, eventName }] of subscriptions)\n\t\t{\n\t\t\tblock.unsubscribe(eventName, subscription);\n\t\t}\n\n\t\tObject.values(this.#eventListeners).forEach((eventListenerCache) => eventListenerCache.clear());\n\t}\n}\n","import { Tag, Reflection, Loc, Dom } from 'main.core';\nimport { Hint } from 'sign.v2.helper';\nimport { BlocksManager } from './blocks/blocksManager';\nimport { EventEmitter } from 'main.core.events';\nimport { MemberRole, type Role } from 'sign.v2.api';\nimport './style.css';\n\nconst buttonClassList = [\n\t'ui-btn',\n\t'ui-btn-sm',\n\t'ui-btn-round',\n\t'ui-btn-light-border',\n];\n\nexport const SectionType = Object.freeze({\n\tGeneral: 0,\n\tFirstParty: 1,\n\tSecondParty: 2,\n});\n\ntype EditorOptions = {\n\tlanguages: {[key: string]: { NAME: string; IS_BETA: boolean; }},\n}\n\nexport class Editor extends EventEmitter\n{\n\t#sidePanel: BX.SidePanel.Slider;\n\t#closeSidePanel: Function;\n\t#resolvePages: Function;\n\t#dom: HTMLElement;\n\t#documentLayout: HTMLElement;\n\t#blocksManager: BlocksManager;\n\t#wizardType: string;\n\t#documentData;\n\t#urls: string[];\n\t#totalPages: number;\n\n\t#sectionElementByType: Map<number, HTMLElement> = new Map();\n\t#disabledSections: Set<number> = new Set();\n\n\t#needSaveBlocksOnSidePanelClose: boolean = true;\n\t#needToLockSidePanelClose: boolean = true;\n\n\tconstructor(wizardType: string, options: EditorOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.Editor');\n\t\tconst { Instance } = Reflection.getClass('BX.SidePanel');\n\t\tthis.#sidePanel = Instance;\n\t\tthis.#dom = Tag.render`<div class=\"sign-wizard__scope sign-editor\"></div>`;\n\t\tthis.#documentLayout = Tag.render`\n\t\t\t<div class=\"sign-editor__document\"></div>\n\t\t`;\n\t\tthis.#blocksManager = new BlocksManager({\n\t\t\tdocumentLayout: this.#documentLayout,\n\t\t\tdisableEdit: false,\n\t\t\tlanguages: options.languages,\n\t\t});\n\t\tthis.#wizardType = wizardType;\n\t\tthis.#urls = [];\n\t\tthis.#totalPages = 0;\n\t}\n\n\t#isB2e(): boolean\n\t{\n\t\treturn this.#wizardType === 'b2e';\n\t}\n\n\t#getArticleCode(): string\n\t{\n\t\treturn this.#isB2e() ? '' : '16571388';\n\t}\n\n\tsetUrls(urls: string[], totalPages: number)\n\t{\n\t\tif (urls.length === 0)\n\t\t{\n\t\t\tthis.#urls = [];\n\t\t\tthis.#totalPages = 0;\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#urls = [\n\t\t\t...this.#urls,\n\t\t\t...urls,\n\t\t];\n\t\tthis.#totalPages = totalPages;\n\t\tif (this.#urls.length === totalPages)\n\t\t{\n\t\t\tthis.#resolvePages?.();\n\t\t}\n\t}\n\n\tset documentData(documentData)\n\t{\n\t\tthis.#documentData = documentData;\n\t\tconst { uid = '', isTemplate } = documentData;\n\t\tif (isTemplate)\n\t\t{\n\t\t\tthis.#toggleEditMode(false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#toggleEditMode(true);\n\t\t}\n\n\t\tthis.#blocksManager.setDocumentUid(uid);\n\t}\n\n\tset entityData(entityData)\n\t{\n\t\tconst forbiddenRoles = new Set([\n\t\t\tMemberRole.editor,\n\t\t\tMemberRole.reviewer,\n\t\t]);\n\n\t\tconst members = Object.values(entityData)\n\t\t\t.filter((member) => !forbiddenRoles.has(member.role))\n\t\t\t.map((member) => {\n\t\t\t\tconst {\n\t\t\t\t\tid: cid,\n\t\t\t\t\ttitle: name,\n\t\t\t\t\tpart,\n\t\t\t\t\tpresetId,\n\t\t\t\t\tentityTypeId,\n\t\t\t\t\tuid,\n\t\t\t\t\tentityId,\n\t\t\t\t\trole,\n\t\t\t\t} = member;\n\n\t\t\t\treturn {\n\t\t\t\t\tcid,\n\t\t\t\t\tname,\n\t\t\t\t\tpart: this.#covertRoleToBlockParty(part, role),\n\t\t\t\t\tpresetId,\n\t\t\t\t\tentityTypeId,\n\t\t\t\t\tuid,\n\t\t\t\t\tentityId,\n\t\t\t\t};\n\t\t\t});\n\n\t\tthis.#blocksManager.addMembers(members);\n\t}\n\n\t#covertRoleToBlockParty(part: number, role: ?Role): number\n\t{\n\t\tswitch (role)\n\t\t{\n\t\t\tcase MemberRole.assignee:\n\t\t\t\treturn 1;\n\t\t\tcase MemberRole.signer:\n\t\t\t\treturn 2;\n\t\t\tdefault:\n\t\t\t\treturn part;\n\t\t}\n\t}\n\n\tasync renderDocument()\n\t{\n\t\tDom.clean(this.#documentLayout);\n\t\tconst { promises, fragment } = this.#urls.reduce((acc, url) => {\n\t\t\t// eslint-disable-next-line no-shadow\n\t\t\tconst { fragment, promises } = acc;\n\t\t\tconst promise = new Promise((resolve) => {\n\t\t\t\tconst page = Tag.render`\n\t\t\t\t\t<div class=\"sign-editor__document_page\">\n\t\t\t\t\t\t<img src=\"${url}\" onload=\"${resolve}\"  alt=\"\"/>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t\tDom.append(page, fragment);\n\t\t\t});\n\t\t\tpromises.push(promise);\n\n\t\t\treturn acc;\n\t\t}, {\n\t\t\tfragment: new DocumentFragment(),\n\t\t\tpromises: [],\n\t\t});\n\t\tDom.append(fragment, this.#documentLayout);\n\t\tconst { resizeArea } = this.#blocksManager;\n\t\tDom.append(resizeArea.getLayout(), this.#documentLayout);\n\t\tawait Promise.all(promises);\n\t\tEventEmitter.unsubscribeAll('SidePanel.Slider:onOpenComplete');\n\t\tEventEmitter.subscribeOnce('SidePanel.Slider:onOpenComplete', () => {\n\t\t\tthis.#blocksManager.initPagesRect();\n\t\t\tthis.#blocksManager.initBlocks(\n\t\t\t\tthis.#documentData.blocks.filter((block) => !this.#disabledSections.has(block.party)),\n\t\t\t);\n\t\t});\n\t}\n\n\tshow(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.#closeSidePanel = resolve;\n\t\t\tthis.#sidePanel.open('editor', {\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\tthis.#render();\n\n\t\t\t\t\treturn this.#dom;\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: (e) => this.#onSidePanelCloseStart(e),\n\t\t\t\t\tonCloseComplete: () => this.#closeSidePanel(),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\twaitForPagesUrls(): Promise<void>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif (this.#urls.length === this.#totalPages)\n\t\t\t{\n\t\t\t\tresolve();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#resolvePages = resolve;\n\t\t});\n\t}\n\n\t#render()\n\t{\n\t\tDom.clean(this.#dom);\n\t\tDom.append(this.#createHeader(), this.#dom);\n\t\tDom.append(this.#createContent(), this.#dom);\n\t}\n\n\t#createHeader(): HTMLElement\n\t{\n\t\tconst editButtonClassName = [\n\t\t\t'sign-editor__header_edit-btn',\n\t\t\t...buttonClassList,\n\t\t].join(' ');\n\t\tconst saveButtonClassName = [\n\t\t\t'ui-btn-success',\n\t\t\t...buttonClassList.slice(0, -1),\n\t\t].join(' ');\n\t\tconst editButtonTitle = Loc.getMessage('SIGN_EDITOR_EDIT');\n\t\tconst saveButtonTitle = Loc.getMessage('SIGN_EDITOR_SAVE');\n\n\t\tlet helpArticleElement = '';\n\t\tif (this.#getArticleCode())\n\t\t{\n\t\t\thelpArticleElement = Tag.render`\n\t\t\t\t<span\n\t\t\t\t\t\t\t\tonclick=\"${() => {\n\t\t\t\t\tconst Helper = Reflection.getClass('BX.Helper');\n\t\t\t\t\tHelper.show(`redirect=detail&code=${this.#getArticleCode()}`);\n\t\t\t\t}}\"\n\t\t\t\t\t\t\t\tclass=\"sign-editor__header_help\"\n\t\t\t\t\t\t\t\t></span>\n\t\t\t`;\n\t\t}\n\t\tconst headTitleNode = Tag.render`\n\t\t\t<p class=\"sign-editor__header_title\">\n\t\t\t\t<span>${Loc.getMessage('SIGN_EDITOR_EDITING')}</span>\n\t\t\t\t<span\n\t\t\t\t\tdata-hint=\"${Loc.getMessage('SIGN_EDITOR_EDITING_HINT')}\"\n\t\t\t\t></span>\n\t\t\t</p>\n\t\t`;\n\t\tHint.create(headTitleNode);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-editor__header\">\n\t\t\t\t${headTitleNode}\n\t\t\t\t<div class=\"sign-editor__header_right\">\n\t\t\t\t\t${helpArticleElement}\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"${editButtonClassName}\"\n\t\t\t\t\t\ttitle=\"${editButtonTitle}\"\n\t\t\t\t\t\tonclick=\"${() => {\n\t\t\t\t\t\t\tthis.#toggleEditMode(true);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${editButtonTitle}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"${saveButtonClassName}\"\n\t\t\t\t\t\ttitle=\"${saveButtonTitle}\"\n\t\t\t\t\t\tonclick=\"${async ({ target }) => {\n\t\t\t\t\t\t\tDom.addClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\tconst blocks = await this.#blocksManager.save();\n\t\t\t\t\t\t\tDom.removeClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\tif (!blocks)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tEventEmitter.subscribeOnce('SidePanel.Slider:onCloseComplete', () => {\n\t\t\t\t\t\t\t\tthis.emit('save', { blocks });\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.#needSaveBlocksOnSidePanelClose = false;\n\t\t\t\t\t\t\tthis.#sidePanel.close();\n\t\t\t\t\t\t\tthis.#needSaveBlocksOnSidePanelClose = true;\n\t\t\t\t\t\t\tthis.#toggleEditMode(false);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${saveButtonTitle}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createContent(): HTMLElement\n\t{\n\t\tconst sections = this.#createSections();\n\t\tconst editorContent = Tag.render`\n\t\t\t<div class=\"sign-editor__content\">\n\t\t\t\t<div class=\"sign-editor__document-container\">\n\t\t\t\t\t${this.#documentLayout}\n\t\t\t\t</div>\n\t\t\t\t${sections}\n\t\t\t</div>\n\t\t`;\n\t\tHint.create(sections, {\n\t\t\tbindOptions: { position: 'top' },\n\t\t\tangle: { position: 'bottom' },\n\t\t\ttargetContainer: editorContent,\n\t\t});\n\t\tthis.#blocksManager.setEditorContent(editorContent);\n\n\t\treturn editorContent;\n\t}\n\n\t#createSections(): HTMLElement\n\t{\n\t\tconst sections = this.#getSectionsData();\n\t\tconst sectionsNodes = sections.map((section) => {\n\t\t\tconst entries = Object.entries(section.blocks);\n\t\t\tconst blocks = entries.map(([code, block]) => {\n\t\t\t\tconst { title, hint } = block;\n\n\t\t\t\treturn Tag.render`\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"sign-editor__section_block\"\n\t\t\t\t\t\tdata-code=\"${code}\"\n\t\t\t\t\t\tdata-part=\"${section.part}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<span>${Loc.getMessage(title)}</span>\n\t\t\t\t\t\t\t<span data-hint=\"${Loc.getMessage(hint)}\"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class=\"sign-editor__section_add-block-btn\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_EDITOR_BLOCK_ADD_TO_DOCUMENT')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t});\n\t\t\tthis.#blocksManager.initRepository(blocks);\n\n\t\t\tconst sectionElement = Tag.render`\n\t\t\t\t<div class=\"sign-editor__section\">\n\t\t\t\t\t<p class=\"sign-editor__section_title\">\n\t\t\t\t\t\t${Loc.getMessage(section.title)}\n\t\t\t\t\t</p>\n\t\t\t\t\t${blocks}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tthis.#sectionElementByType.set(section.part, sectionElement);\n\n\t\t\tif (this.#disabledSections.has(section.part))\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-style\n\t\t\t\tsectionElement.style.display = 'none';\n\t\t\t}\n\n\t\t\treturn sectionElement;\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-editor__sections\">\n\t\t\t\t${sectionsNodes}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tsetSectionVisibilityByType(type: number, visibility: boolean): void\n\t{\n\t\tconst sectionElement = this.#sectionElementByType.get(type);\n\t\tif (sectionElement)\n\t\t{\n\t\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-style\n\t\t\tsectionElement.style.display = visibility === true ? 'block' : 'none';\n\t\t}\n\n\t\tif (visibility)\n\t\t{\n\t\t\tthis.#disabledSections.delete(type);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#disabledSections.add(type);\n\t\t}\n\t}\n\n\t#toggleEditMode(isEdit: boolean)\n\t{\n\t\tif (isEdit)\n\t\t{\n\t\t\tDom.addClass(this.#dom, '--editable');\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.removeClass(this.#dom, '--editable');\n\t}\n\n\t// eslint-disable-next-line max-lines-per-function,flowtype/require-return-type\n\t#getSectionsData()\n\t{\n\t\tconst firstPartyBlocks = {};\n\t\tconst partnerBlocks = {};\n\t\tconst generalBlocks = {\n\t\t\ttext: {\n\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_TEXT',\n\t\t\t\thint: 'SIGN_EDITOR_BLOCK_TEXT_HINT',\n\t\t\t},\n\t\t};\n\t\tif (!this.#isB2e())\n\t\t{\n\t\t\tgeneralBlocks.date = {\n\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_DATE',\n\t\t\t\thint: 'SIGN_EDITOR_BLOCK_DATE_HINT',\n\t\t\t};\n\t\t}\n\t\tgeneralBlocks.number = {\n\t\t\ttitle: 'SIGN_EDITOR_BLOCK_NUMBER',\n\t\t\thint: 'SIGN_EDITOR_BLOCK_NUMBER_HINT',\n\t\t};\n\n\t\tlet titles = {\n\t\t\tfirstParty: 'SIGN_EDITOR_BLOCKS_FIRST_PARTY',\n\t\t\tpartner: 'SIGN_EDITOR_BLOCKS_PARTNER',\n\t\t};\n\n\t\tif (this.#wizardType === 'b2e')\n\t\t{\n\t\t\tObject.assign(firstPartyBlocks, {\n\t\t\t\tmyb2ereference: {\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE',\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_HINT',\n\t\t\t\t},\n\t\t\t\tmyrequisites: {\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_REQUISITES',\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_FIRST_PARTY_REQUISITES_HINT',\n\t\t\t\t},\n\t\t\t});\n\t\t\tObject.assign(partnerBlocks, {\n\t\t\t\tb2ereference: {\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_B2E_REFERENCE',\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_B2E_REFERENCE_HINT',\n\t\t\t\t},\n\t\t\t});\n\n\t\t\ttitles = {\n\t\t\t\tfirstParty: 'SIGN_EDITOR_BLOCKS_FIRST_PARTY_B2E',\n\t\t\t\tpartner: 'SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E',\n\t\t\t};\n\t\t}\n\t\telse\n\t\t{\n\t\t\tObject.assign(firstPartyBlocks, {\n\t\t\t\tmyreference: {\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_CRM',\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_CRM_HINT',\n\t\t\t\t},\n\t\t\t\tmyrequisites: {\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_REQUISITES',\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_FIRST_PARTY_REQUISITES_HINT',\n\t\t\t\t},\n\t\t\t\tmysign: {\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_SIGNATURE',\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_FIRST_PARTY_SIGNATURE_HINT',\n\t\t\t\t},\n\t\t\t\tmystamp: {\n\t\t\t\t\ttitle: 'SIGN_EDITOR_BLOCK_STAMP_MSGVER_1',\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_FIRST_PARTY_STAMP_HINT',\n\t\t\t\t},\n\t\t\t});\n\t\t\tObject.assign(partnerBlocks, {\n\t\t\t\treference: { ...firstPartyBlocks.myreference },\n\t\t\t\trequisites: {\n\t\t\t\t\t...firstPartyBlocks.myrequisites,\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_PARTNER_REQUISITES_HINT',\n\t\t\t\t},\n\t\t\t\tsign: {\n\t\t\t\t\t...firstPartyBlocks.mysign,\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_PARTNER_SIGNATURE_HINT',\n\t\t\t\t},\n\t\t\t\tstamp: {\n\t\t\t\t\t...firstPartyBlocks.mystamp,\n\t\t\t\t\thint: 'SIGN_EDITOR_BLOCK_PARTNER_STAMP_HINT',\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn [\n\t\t\t{\n\t\t\t\ttitle: titles.firstParty,\n\t\t\t\tblocks: firstPartyBlocks,\n\t\t\t\tpart: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: titles.partner,\n\t\t\t\tblocks: partnerBlocks,\n\t\t\t\tpart: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'SIGN_EDITOR_BLOCKS_GENERAL',\n\t\t\t\tblocks: generalBlocks,\n\t\t\t\tpart: 0,\n\t\t\t},\n\t\t];\n\t}\n\n\t#onSidePanelCloseStart(event: BX.SidePanel.Event): Promise<void>\n\t{\n\t\tif (!this.#needSaveBlocksOnSidePanelClose)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#needToLockSidePanelClose)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tevent.denyAction();\n\t\tvoid this.#blocksManager.save().then((blocks) => {\n\t\t\tif (!blocks)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.#needToLockSidePanelClose = false;\n\t\t\tthis.#sidePanel.close();\n\t\t\tthis.#needToLockSidePanelClose = true;\n\t\t\tthis.emit('save', { blocks });\n\t\t});\n\t}\n}\n"],"names":["Dummy","EventEmitter","constructor","block","data","events","onChange","onColorStyleChange","setEventNamespace","isSingleton","isStyleAllowed","setData","setText","text","getInitDimension","width","height","getData","getActionButton","getBlockCaption","getViewContent","Tag","render","TextFormat","encode","toString","replaceAll","onStartChangePosition","onPlaced","onSave","onRemove","onClickOut","forceSave","emit","getStyles","changeStyleColor","color","defaultTextBlockPaddingStyles","padding","Date","onActionClick","BX","calendar","node","getLayout","field","value","bTime","callback_after","date","format","convertBitrixFormat","message","renderView","targetContainer","document","querySelector","popup","popupContainer","parentElement","Dom","append","adjustPosition","bind","Loc","getMessage","Close","MyRequisites","Cache","MemoryCache","getCode","event","stopPropagation","show","Set","fields","filter","createFieldType","has","name","remember","blocksManager","member","getMemberByPart","getMemberPart","entityTypeId","presetId","entityId","cid","fieldsetViewer","FieldsetViewer","documentUid","getDocumentUid","onClose","assign","delete","fieldListEditorOptions","fieldsPanelOptions","entity_field_name","fieldName","includes","fieldsFactory","controllerOptions","hideVirtual","hideRequisites","hideSmartDocument","popupOptions","overlay","cacheable","setEndpoint","subscribe","hide","hasAccessDeniedError","requestErrors","some","error","code","UI","Notification","Center","notify","content","Text","autoHideDelay","ColorPicker","Reflection","getClass","setRect","element","rect","Object","keys","map","key","parseInt","style","getBlockLayout","options","getMemberSelector","members","selectedValue","menuItems","selectedName","part","memberSelector","length","SignUI","bindSimpleMenu","bindElement","items","actionHandler","innerHTML","getResizeArea","getStylePanel","collectStyles","fonts","fontFamily","fontSizereal","fontSizeValue","fontSize","currentValue","layout","fontColor","getColorSelectorBtn","defaultColorPickerColor","onColorSelect","colorPickerOptions","updateColorSelectorBtnColor","updatedColorPickerOptions","onColorSelected","picker","Event","open","colorPicker","circleColor","Type","isNil","MySign","getPosition","src","dataSrc","base64","getPlaceholderLabel","backgroundPosition","emitEvent","setSelectedColor","colorSelectorBtnLayout","close","colors","allowCustomColor","selectedColor","colorPreview","MyStamp","Uploader","controller","upload","contact","id","label","currentBlock","await","eventData","file","serverId","serverPreviewUrl","Api","title","__view","fileId","memberPart","saveStamp","uid","button","textContent","Number","sliderOnMessageBind","addCustomEvent","window","isEditor","slider","url","getEventId","numeratorData","sender","type","api","refreshEntityNumber","crmNumeratorUrl","SidePanel","Instance","Reference","isUndefined","Selector","className","then","selectedNames","eventSelectedNames","isStringFilled","push","removeClass","setTimeout","actionButton","defaultCaption","fieldSelector","get","fieldsList","getFieldsList","CONTACT","FIELDS","SMART_DOCUMENT","find","caption","selector","multiple","onFieldSelectEventData","selectedFieldNames","onFieldSelectEvent","BaseEvent","MyReference","COMPANY","blackList","Requisites","tagBody","Stamp","Sign","updateColor","contentEditable","focus","getText","getContainer","innerText","range","createRange","selectNodeContents","collapse","selection","getSelection","removeAllRanges","addRange","B2eReference","categoryCaption","fieldCaption","blockLayout","resizeNode","resizeText","step","catch","err","console","Promise","resolve","FieldSelector","loadFieldList","fieldList","PROFILE","hideSmartB2eDocument","languages","getLanguages","categoryCaptions","MyB2eReference","categories","profile","SMART_B2E_DOC","company","entries","forEach","category","undefined","isObject","CAPTION","Style","family","property","size","bold","state","italic","underline","through","left","group","center","right","justify","buttonPressed","applyStyles","removeAttribute","updateFontSize","styles","renderStyle","querySelectorAll","action","getAttribute","addClass","indexOf","Block","myrequisites","mysign","mystamp","number","reference","myreference","requisites","sign","stamp","b2ereference","myb2ereference","blockContent","blockPanel","blockLoading","blockEditing","pageWithNotAllowed","party","onClick","Error","isString","setPosition","position","top","getBoundingClientRect","Math","round","documentRect","getStyle","getId","showNotAllowedArea","page","transferPositionToPage","pageElement","hideNotAllowedArea","fireAction","onMemberSelect","flag","blockLayouts","currentCode","getBlocks","blocksData","blocksInstance","loadBlocksData","result","isArray","i","showResizeArea","response","remove","contentTag","clean","toLowerCase","setProperty","observerReady","maxTextSize","parseFloat","isOverflownX","clientHeight","scrollHeight","parentNode","param","target","minSize","unit","intervalTextResize","clearTimeout","overflow","parent","removeProperty","panelTag","allMembers","getMembers","selectedMembers","getCurrentFontSize","adjustActionsPanel","documentLayout","documentLayoutRect","actionsPanel","actionsPanelRect","marginLeft","getComputedStyle","x","click","hidden","isRemoved","unMuteResizeArea","hideResizeArea","setSavingMark","nodeForPosition","body","blockInitDim","min","scrollTop","offsetHeight","inDeadZone","getPagesGap","Resize","resizeContainer","moveContainer","isDomNode","wrapperLayout","pointRect","display","setAttribute","wrapperLayoutRect","borderDelta","setFullEditorContent","editorContent","getLinkedBlock","e","moving","resizing","initialRect","draggable","Draggable","container","DragAndDrop","HEADLESS","textResize","wrapper","positionLast","bottomResize","areaRect","wrapperRect","hasClass","max","offsetX","offsetY","newPosition","calcDeathTop","notAddDeathMargin","newPositionLinked","dragArea","widthInProcess","source","moveTopDelta","y","marginTop","gapBetweenPages","BlocksManager","blockColorChange","Map","blockReferenceFieldSelect","blockB2eReferenceFieldSelect","disableEdit","resizeArea","preventClickOut","closest","activeBlock","initPagesRect","pages","pageRect","pageRectToMath","pageRectKey","isNumber","topBound","bottomBound","offsetWidth","c","getMinPageHeight","getDocumentId","setDocumentId","documentId","setEditorContent","setDocumentUid","getEntityId","getSeams","addMembers","returnMember","getCompanyId","getInitiatorName","getConfig","muteResizeArea","initBlocks","blocks","initRepository","repositoryItems","item","preventDefault","save","postData","realDocumentWidth","blockRect","pagesRect","nextPageRect","pageNum","currentPageRect","realDocumentWidthPx","saveBlank","errors","customData","Popup","titleBar","util","htmlspecialchars","buttons","Button","ButtonColor","SUCCESS","onclick","Backend","command","destroy","INFO","blockActionButton","firstError","PRIMARY","subscribeOnce","saveButton","afterSaveCallback","saveErrorCallback","onCloseSlider","everythingIsSaved","denyAction","MessageBox","confirm","messageBox","mark","setParam","getParam","getSliderByWindow","set","bottom","notAddMargin","seams","ii","cc","seam","widthPx","heightPx","pageImageRect","pixelPosition","seamShift","newBlock","existedSignBlock","signColor","newBlockCode","colorChangeListener","subscription","eventName","onFieldSelectListener","guide","Guide","steps","getElementById","autoSave","simpleMode","startOnce","helpBtnSpotlight","SpotLight","targetElement","targetVertex","rounded","article","onShow","isCRM","updatedBlock","newColor","isNull","deleteLatency","subscriptions","values","flatMap","unsubscribe","eventListenerCache","clear","buttonClassList","SectionType","freeze","General","FirstParty","SecondParty","Editor","wizardType","setUrls","urls","totalPages","documentData","isTemplate","entityData","forbiddenRoles","MemberRole","editor","reviewer","role","renderDocument","promises","fragment","reduce","acc","promise","DocumentFragment","all","unsubscribeAll","contentCallback","onCloseComplete","waitForPagesUrls","setSectionVisibilityByType","visibility","sectionElement","add","assignee","signer","editButtonClassName","join","saveButtonClassName","slice","editButtonTitle","saveButtonTitle","helpArticleElement","Helper","headTitleNode","Hint","create","sections","bindOptions","angle","sectionsNodes","section","hint","isEdit","firstPartyBlocks","partnerBlocks","generalBlocks","titles","firstParty","partner"],"mappings":"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"}