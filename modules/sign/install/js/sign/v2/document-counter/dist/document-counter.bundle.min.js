this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};(function(e,t,s,i){"use strict";var l=babelHelpers.classPrivateFieldLooseKey("filter");class a{constructor(e){Object.defineProperty(this,l,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,l)[l]=BX.Main.filterManager.getById(e.filterId)}toggleField(e,t,s){const a=babelHelpers.classPrivateFieldLooseBase(this,l)[l].getFieldByName(e);if(!i.Type.isPlainObject(a)||a===null){return false}const r=t.split("_");const o=a.ITEMS.filter((e=>r.includes(e.VALUE))).map((e=>e.VALUE));if(o.length===0){return false}if(this.isFieldValueAlreadyApplied(e,o,s)){return false}if(s){babelHelpers.classPrivateFieldLooseBase(this,l)[l].getApi().setFields({})}babelHelpers.classPrivateFieldLooseBase(this,l)[l].getApi().extendFilter({[e]:{...o}});return true}getFilterRows(){return babelHelpers.classPrivateFieldLooseBase(this,l)[l].getFilterFieldsValues()}deactivate(){babelHelpers.classPrivateFieldLooseBase(this,l)[l].getApi().setFields({});babelHelpers.classPrivateFieldLooseBase(this,l)[l].getApi().apply()}isFieldValueAlreadyApplied(e,t,s){const l=this.getFilterRows();const a=l[e];if(!i.Type.isObject(a)){return false}if(s&&this.isSomeOtherFilterPresent(e)){return false}const r=Object.values(a);for(const e of t){if(!r.includes(e)){return false}}if(s){for(const e of r){if(!t.includes(e)){return false}}}return true}isSomeOtherFilterPresent(e){for(const[t,s]of Object.entries(this.getFilterRows())){const l=i.Type.isStringFilled(s)||i.Type.isArrayFilled(s);if(t!==e&&l){return true}}return false}}var r=babelHelpers.classPrivateFieldLooseKey("filter");var o=babelHelpers.classPrivateFieldLooseKey("resetAllFields");var n=babelHelpers.classPrivateFieldLooseKey("onActivateItem");var c=babelHelpers.classPrivateFieldLooseKey("onDeactivateItem");var d=babelHelpers.classPrivateFieldLooseKey("processItemSelection");var b=babelHelpers.classPrivateFieldLooseKey("getFieldData");var u=babelHelpers.classPrivateFieldLooseKey("isAllDeactivated");var v=babelHelpers.classPrivateFieldLooseKey("onFilterApply");var p=babelHelpers.classPrivateFieldLooseKey("onCounterUpdate");class f extends s.CounterPanel{constructor(e){super({target:e.target,items:f.getCounterItems(e.items),multiselect:false,title:e.title});Object.defineProperty(this,p,{value:g});Object.defineProperty(this,v,{value:y});Object.defineProperty(this,u,{value:L});Object.defineProperty(this,b,{value:B});Object.defineProperty(this,d,{value:P});Object.defineProperty(this,c,{value:F});Object.defineProperty(this,n,{value:h});Object.defineProperty(this,r,{writable:true,value:void 0});Object.defineProperty(this,o,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,r)[r]=new a({filterId:e.filterId});t.EventEmitter.subscribe("BX.UI.CounterPanel.Item:activate",babelHelpers.classPrivateFieldLooseBase(this,n)[n].bind(this));t.EventEmitter.subscribe("BX.UI.CounterPanel.Item:deactivate",babelHelpers.classPrivateFieldLooseBase(this,c)[c].bind(this));t.EventEmitter.subscribe("BX.Main.Filter:apply",babelHelpers.classPrivateFieldLooseBase(this,v)[v].bind(this));t.EventEmitter.subscribe("BX.Sign.DocumentCounter.Item:updateCounter",babelHelpers.classPrivateFieldLooseBase(this,p)[p].bind(this));babelHelpers.classPrivateFieldLooseBase(this,o)[o]=Boolean(e==null?void 0:e.resetAllFields)}static getCounterItems(e){return e.map((e=>({id:e.id,title:e.title,value:Number.parseInt(e.value,10),isRestricted:e.isRestricted,color:e.color==="THEME"?"GRAY":e.color,hideValue:e.hideValue||false,isActive:(e==null?void 0:e.isActive)===true})))}}function h(e){const{name:t,value:s}=babelHelpers.classPrivateFieldLooseBase(this,b)[b](e.getData());if(!babelHelpers.classPrivateFieldLooseBase(this,d)[d](t,s)){e.preventDefault()}}function F(e){if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]()){babelHelpers.classPrivateFieldLooseBase(this,r)[r].deactivate()}}function P(e,t){babelHelpers.classPrivateFieldLooseBase(this,r)[r].toggleField(e,t,babelHelpers.classPrivateFieldLooseBase(this,o)[o]);return true}function B(e){const t=e.id.split("__");return{name:t[0].toUpperCase(),value:t[1].toUpperCase()}}function L(){return this.getItems().every((e=>!e.isActive))}function y(){let e="";const t=babelHelpers.classPrivateFieldLooseBase(this,r)[r].getFilterRows();const s=new Set(this.items.map((e=>e.id.toLowerCase())));const l=Object.entries(t).find((t=>{if(!i.Type.isPlainObject(t[1])){return false}const l=Object.values(t[1]);const a=[t[0],l.join("_")];e=a.join("__").toLowerCase();return s.has(e)}));this.getItems().forEach((t=>{t.deactivate(false);if(l&&t.id.toLowerCase()===e){t.activate(false)}}))}function g(e){const{id:t,count:s}=e.getData();for(const e of this.getItems()){if(e.id===t){e.updateValue(s);const t=s>0?"DANGER":"GRAY";e.updateColor(t);break}}}e.DocumentCounter=f})(this.BX.Sign.V2=this.BX.Sign.V2||{},BX.Event,BX.UI,BX);
//# sourceMappingURL=document-counter.bundle.map.js