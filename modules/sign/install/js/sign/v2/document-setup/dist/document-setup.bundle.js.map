{"version":3,"file":"document-setup.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Tag, Dom, Event, Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { BlankSelector, type BlankSelectorConfig } from 'sign.v2.blank-selector';\nimport { Api } from 'sign.v2.api';\nimport { Button } from 'ui.buttons';\nimport { Alert } from 'ui.alerts';\nimport type { DocumentData } from './type';\nimport './style.css';\n\nexport type { DocumentData };\nexport type DocumentInitiatedType = 'employee' | 'company';\nexport const DocumentInitiated: Readonly<Record<string, DocumentInitiatedType>> = Object.freeze({\n\temployee: 'employee',\n\tcompany: 'company',\n});\n\nexport class DocumentSetup extends EventEmitter\n{\n\tblankSelector: BlankSelector;\n\tsetupData: null | { uid: string, initiatedByType: DocumentInitiatedType, templateUid: ?string, ...};\n\tlayout: HTMLElement;\n\t#notificationContainer: HTMLElement;\n\t#changeDomainWarningContainer: ?HTMLElement;\n\t#scenarioType: BlankSelectorConfig['type'];\n\t#api: Api;\n\t#uids: Map<number, string>;\n\n\tconstructor(blankSelectorConfig: BlankSelectorConfig)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.DocumentSetup');\n\t\tthis.blankSelector = new BlankSelector({\n\t\t\t...blankSelectorConfig,\n\t\t\tevents: {\n\t\t\t\ttoggleSelection: ({ data }) => {\n\t\t\t\t\tthis.emit('toggleActivity', { ...data, blankSelector: this.blankSelector });\n\t\t\t\t},\n\t\t\t\taddFile: ({ data }) => {\n\t\t\t\t\tthis.emit('addFile', { ready: this.blankSelector.isFilesReadyForUpload() });\n\t\t\t\t},\n\t\t\t\tremoveFile: () => this.emit('removeFile', { ready: this.blankSelector.isFilesReadyForUpload() }),\n\t\t\t\tclearFiles: () => this.emit('clearFiles'),\n\t\t\t},\n\t\t});\n\t\tconst { type, portalConfig } = blankSelectorConfig;\n\t\tthis.setupData = null;\n\t\tthis.#scenarioType = type;\n\t\tthis.#api = new Api();\n\t\tthis.#uids = new Map();\n\t\tthis.initLayout();\n\t\tthis.#initNotifications(portalConfig);\n\t}\n\n\t#initNotifications(portalConfig: BlankSelectorConfig['portalConfig'])\n\t{\n\t\tthis.#notificationContainer = Tag.render`<div></div>`;\n\t\tconst buttonsContainer = this.layout.querySelector('.sign-blank-selector__tile-widget');\n\t\tDom.insertBefore(this.#notificationContainer, buttonsContainer);\n\t\tconst { isDomainChanged, isEdoRegion, isUnsecuredScheme } = portalConfig;\n\t\tif (isDomainChanged)\n\t\t{\n\t\t\tthis.#appendChangeDomainWarningContainer();\n\t\t}\n\n\t\tif (isUnsecuredScheme)\n\t\t{\n\t\t\tthis.#appendUnsecuredSchemeWarningContainer();\n\t\t}\n\n\t\tif (isEdoRegion && this.#scenarioType !== 'b2e')\n\t\t{\n\t\t\tthis.#appendEdoWarningContainer();\n\t\t}\n\t}\n\n\tasync #register(blankId: string, isTemplateMode: boolean = false): Promise<{\n\t\tuid: string,\n\t\ttemplateUid: string | null\n\t}>\n\t{\n\t\tconst data = await this.#api.register(blankId, this.#scenarioType, isTemplateMode);\n\n\t\treturn data ?? {};\n\t}\n\n\tasync #change(uid: string, blankId: number): Promise<string>\n\t{\n\t\tconst data = await this.#api.changeDocument(uid, blankId);\n\n\t\treturn data?.uid ?? '';\n\t}\n\n\tasync #getPages(uid: string): Promise<{url: string;}[]>\n\t{\n\t\tconst data = await this.#api.getPages(uid);\n\n\t\treturn data.pages ?? [];\n\t}\n\n\tasync #convertToBase64(pages): Promise<string[]>\n\t{\n\t\tconst promises = pages.map(async (page) => {\n\t\t\tconst data = await fetch(page.url);\n\t\t\tconst blob = await data.blob();\n\t\t\tconst fileReader = new FileReader();\n\t\t\tawait new Promise((resolve) => {\n\t\t\t\tEvent.bindOnce(fileReader, 'loadend', resolve);\n\t\t\t\tfileReader.readAsDataURL(blob);\n\t\t\t});\n\n\t\t\treturn fileReader.result;\n\t\t});\n\n\t\treturn Promise.all(promises);\n\t}\n\n\t#setDocumentData(setupData)\n\t{\n\t\tthis.setupData = setupData;\n\t\tthis.blankSelector.clearFiles({ removeFromServer: false });\n\t}\n\n\tasync #processPages(urls: string[], cb: () => void)\n\t{\n\t\tlet startIndex = 0;\n\t\tconst pagesCount = 3;\n\t\twhile (startIndex < urls.length)\n\t\t{\n\t\t\tconst sliced = urls.slice(startIndex, startIndex + pagesCount);\n\t\t\tconst convertedPages = await this.#convertToBase64(sliced);\n\t\t\tthis.emit('toggleActivity', { selected: true });\n\t\t\tstartIndex += pagesCount;\n\t\t\tcb(convertedPages, urls.length);\n\t\t}\n\t}\n\n\t#appendUnsecuredSchemeWarningContainer()\n\t{\n\t\tconst text = `<div>${Loc.getMessage('SIGN_DOCUMENT_SETUP_USE_UNSECURED_SCHEME_WARNING')}</div>`;\n\t\tconst warning = this.#getWarning();\n\t\twarning.setText(text);\n\t\tDom.append(warning.getContainer(), this.#notificationContainer);\n\t}\n\n\t#appendChangeDomainWarningContainer()\n\t{\n\t\tconst domainChangeButton = new Button({\n\t\t\ttext: Loc.getMessage('SIGN_DOCUMENT_SETUP_REFRESH_DOMAIN_BUTTON_TEXT'),\n\t\t\tcolor: Button.Color.LINK,\n\t\t\tonclick: () => this.#api.changeDomain().then(() => this.#removeChangeDomainWarningContainer()),\n\t\t\tclassName: 'sign-document-setup__change-domain-button',\n\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t});\n\t\tconst text = `<p>${Loc.getMessage('SIGN_DOCUMENT_SETUP_CHANGE_DOMAIN_WARNING')}</p>`;\n\t\tconst warning = this.#getWarning();\n\t\twarning.setText(text);\n\t\tthis.#changeDomainWarningContainer = warning.getContainer();\n\t\tDom.append(domainChangeButton.getContainer(), this.#changeDomainWarningContainer);\n\t\tDom.append(this.#changeDomainWarningContainer, this.#notificationContainer);\n\t}\n\n\t#getWarning(): Alert\n\t{\n\t\treturn new Alert({\n\t\t\tsize: Alert.Size.MD,\n\t\t\tcolor: Alert.Color.WARNING,\n\t\t\ticon: Alert.Icon.DANGER,\n\t\t\tcustomClass: 'sign-document-setup__change-domain-wrapper',\n\t\t});\n\t}\n\n\t#removeChangeDomainWarningContainer()\n\t{\n\t\tDom.remove(this.#changeDomainWarningContainer);\n\t}\n\n\t#appendEdoWarningContainer()\n\t{\n\t\tconst text = Loc.getMessage('SIGN_DOCUMENT_SETUP_EDO_TEXT', {\n\t\t\t'[helpdesklink]': '<a class=\"sign-document-setup__helpdesk-article\" href=\"javascript:top.BX.Helper.show(\\'redirect=detail&code=18453372\\');\">',\n\t\t\t'[/helpdesklink]': '</a>',\n\t\t});\n\t\tconst alert = this.#getWarning();\n\t\talert.setColor(Alert.Color.PRIMARY);\n\t\talert.setIcon(Alert.Icon.INFO);\n\t\talert.setText(text);\n\t\tDom.append(alert.getContainer(), this.#notificationContainer);\n\t}\n\n\tinitLayout()\n\t{\n\t\tthis.layout = Tag.render`\n\t\t\t<div class=\"sign-document-setup\">\n\t\t\t\t<p class=\"sign-document-setup__add-title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SETUP_ADD_TITLE')}\n\t\t\t\t</p>\n\t\t\t\t${this.blankSelector.getLayout()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tisSameBlankSelected(): boolean\n\t{\n\t\tconst { selectedBlankId } = this.blankSelector;\n\t\tconst { blankId: lastBlankId } = this.setupData ?? {};\n\n\t\treturn selectedBlankId > 0 && lastBlankId === selectedBlankId;\n\t}\n\n\thandleError(blankId: number)\n\t{\n\t\tthis.#setDocumentData(null);\n\t\tthis.blankSelector.resetSelectedBlank();\n\t\tthis.blankSelector.deleteBlank(blankId);\n\t}\n\n\tloadBlocks(uid: string): Promise<DocumentData['blocks']>\n\t{\n\t\treturn this.#api.loadBlocksByDocument(uid);\n\t}\n\n\tasync setup(uid: ?string, isTemplateMode: boolean = false): Promise<void>\n\t{\n\t\tif (this.isSameBlankSelected())\n\t\t{\n\t\t\tthis.setupData = {\n\t\t\t\t...this.setupData,\n\t\t\t\tisTemplate: true,\n\t\t\t};\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst { selectedBlankId } = this.blankSelector;\n\t\tlet blankId = 0;\n\t\ttry\n\t\t{\n\t\t\tif (uid)\n\t\t\t{\n\t\t\t\tconst [loadedData, blocks] = await Promise.all([\n\t\t\t\t\tthis.#api.loadDocument(uid),\n\t\t\t\t\tthis.loadBlocks(uid),\n\t\t\t\t]);\n\t\t\t\tthis.#setDocumentData({ ...loadedData, blocks, isTemplate: true });\n\t\t\t\tconst { blankId } = loadedData;\n\t\t\t\tif (!this.blankSelector.hasBlank(blankId))\n\t\t\t\t{\n\t\t\t\t\tawait this.blankSelector.loadBlankById(blankId);\n\t\t\t\t}\n\n\t\t\t\tthis.blankSelector.selectBlank(blankId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.ready = false;\n\t\t\t\tblankId = selectedBlankId || await this.blankSelector.createBlank();\n\t\t\t\tconst isRegistered = this.#uids.has(blankId);\n\n\t\t\t\tconst { uid, templateUid } = isRegistered\n\t\t\t\t\t? await this.#change(this.#uids.get(blankId), blankId)\n\t\t\t\t\t: await this.#register(blankId, isTemplateMode);\n\n\t\t\t\tthis.#uids.set(blankId, uid);\n\t\t\t\tawait this.#api.upload(uid);\n\t\t\t\tconst [loadedData, blocks] = await Promise.all([\n\t\t\t\t\tthis.#api.loadDocument(uid),\n\t\t\t\t\tthis.#api.loadBlocksByDocument(uid),\n\t\t\t\t]);\n\t\t\t\tconst isTemplate = Boolean(selectedBlankId);\n\t\t\t\tthis.#setDocumentData({ ...loadedData, blocks, isTemplate, templateUid });\n\t\t\t}\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tthis.handleError(blankId);\n\t\t}\n\n\t\tthis.ready = true;\n\t}\n\n\tasync waitForPagesList(cb: (urls: string[]) => void, preparedPages: boolean = false)\n\t{\n\t\tlet interval = 0;\n\t\tlet isPagesReady = false;\n\t\tconst requestTime = 10 * 1000;\n\t\tconst uid = this.setupData.uid;\n\t\tconst { blankId, isTemplate } = this.setupData;\n\t\tif (!isTemplate)\n\t\t{\n\t\t\tthis.blankSelector.selectBlank(blankId);\n\t\t}\n\n\t\tthis.emit('toggleActivity', { selected: false });\n\n\t\tconst promises = [\n\t\t\tnew Promise((resolve) => {\n\t\t\t\tBX.PULL?.subscribe({\n\t\t\t\t\tmoduleId: 'sign',\n\t\t\t\t\tcommand: 'blankIsReady',\n\t\t\t\t\tcallback: (result) => {\n\t\t\t\t\t\tif (!isPagesReady && result?.pages && result?.uid === uid)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve(result?.pages);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}),\n\t\t\tnew Promise((resolve) => {\n\t\t\t\tinterval = setInterval(async () => {\n\t\t\t\t\tif (isPagesReady)\n\t\t\t\t\t{\n\t\t\t\t\t\tclearInterval(interval);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst urls = await this.#getPages(uid);\n\t\t\t\t\tif (urls.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(urls);\n\t\t\t\t\t}\n\t\t\t\t}, requestTime);\n\t\t\t}),\n\t\t];\n\n\t\tif (preparedPages)\n\t\t{\n\t\t\tpromises.push(new Promise((resolve) => {\n\t\t\t\tthis.#getPages(uid)\n\t\t\t\t\t.then((urls) => {\n\t\t\t\t\t\tif (urls.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve(urls);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}));\n\t\t}\n\n\t\tconst urls = await Promise.race(promises);\n\t\tif (!isTemplate)\n\t\t{\n\t\t\tconst blank = this.blankSelector.getBlank(blankId);\n\t\t\tblank.setPreview(urls[0].url);\n\t\t}\n\n\t\tclearInterval(interval);\n\t\tisPagesReady = true;\n\t\tthis.#processPages(urls, cb);\n\t}\n\n\tset ready(isReady: boolean)\n\t{\n\t\tif (isReady)\n\t\t{\n\t\t\tDom.removeClass(this.layout, '--pending');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.layout, '--pending');\n\t\t}\n\t}\n}\n"],"names":["DocumentInitiated","Object","freeze","employee","company","DocumentSetup","EventEmitter","constructor","blankSelectorConfig","setEventNamespace","blankSelector","BlankSelector","events","toggleSelection","data","emit","addFile","ready","isFilesReadyForUpload","removeFile","clearFiles","type","portalConfig","setupData","Api","Map","initLayout","layout","Tag","render","Loc","getMessage","getLayout","isSameBlankSelected","selectedBlankId","blankId","lastBlankId","handleError","resetSelectedBlank","deleteBlank","loadBlocks","uid","loadBlocksByDocument","setup","isTemplateMode","isTemplate","loadedData","blocks","Promise","all","loadDocument","hasBlank","loadBlankById","selectBlank","createBlank","isRegistered","has","templateUid","get","set","upload","Boolean","waitForPagesList","cb","preparedPages","interval","isPagesReady","requestTime","selected","promises","resolve","BX","PULL","subscribe","moduleId","command","callback","result","pages","setInterval","clearInterval","urls","length","push","then","race","blank","getBlank","setPreview","url","isReady","Dom","removeClass","addClass","buttonsContainer","querySelector","insertBefore","isDomainChanged","isEdoRegion","isUnsecuredScheme","register","changeDocument","getPages","map","page","fetch","blob","fileReader","FileReader","Event","bindOnce","readAsDataURL","removeFromServer","startIndex","pagesCount","sliced","slice","convertedPages","text","warning","setText","append","getContainer","domainChangeButton","Button","color","Color","LINK","onclick","changeDomain","className","size","Size","EXTRA_SMALL","Alert","MD","WARNING","icon","Icon","DANGER","customClass","remove","alert","setColor","PRIMARY","setIcon","INFO"],"mappings":"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"}