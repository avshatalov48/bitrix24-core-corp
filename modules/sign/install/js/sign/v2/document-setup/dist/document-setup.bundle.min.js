this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};(function(e,s,a,t,l,i,o){"use strict";let r=e=>e,n,c;const d=Object.freeze({employee:"employee",company:"company"});var b=babelHelpers.classPrivateFieldLooseKey("notificationContainer");var p=babelHelpers.classPrivateFieldLooseKey("changeDomainWarningContainer");var h=babelHelpers.classPrivateFieldLooseKey("scenarioType");var v=babelHelpers.classPrivateFieldLooseKey("api");var u=babelHelpers.classPrivateFieldLooseKey("uids");var P=babelHelpers.classPrivateFieldLooseKey("initNotifications");var B=babelHelpers.classPrivateFieldLooseKey("register");var g=babelHelpers.classPrivateFieldLooseKey("change");var F=babelHelpers.classPrivateFieldLooseKey("getPages");var L=babelHelpers.classPrivateFieldLooseKey("convertToBase64");var m=babelHelpers.classPrivateFieldLooseKey("setDocumentData");var y=babelHelpers.classPrivateFieldLooseKey("processPages");var H=babelHelpers.classPrivateFieldLooseKey("appendUnsecuredSchemeWarningContainer");var f=babelHelpers.classPrivateFieldLooseKey("appendChangeDomainWarningContainer");var S=babelHelpers.classPrivateFieldLooseKey("getWarning");var k=babelHelpers.classPrivateFieldLooseKey("removeChangeDomainWarningContainer");var D=babelHelpers.classPrivateFieldLooseKey("appendEdoWarningContainer");class w extends a.EventEmitter{constructor(e){super();Object.defineProperty(this,D,{value:X});Object.defineProperty(this,k,{value:K});Object.defineProperty(this,S,{value:j});Object.defineProperty(this,f,{value:A});Object.defineProperty(this,H,{value:U});Object.defineProperty(this,y,{value:N});Object.defineProperty(this,m,{value:O});Object.defineProperty(this,L,{value:C});Object.defineProperty(this,F,{value:T});Object.defineProperty(this,g,{value:I});Object.defineProperty(this,B,{value:E});Object.defineProperty(this,P,{value:_});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,v,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});this.setEventNamespace("BX.Sign.V2.DocumentSetup");this.blankSelector=new t.BlankSelector({...e,events:{toggleSelection:({data:e})=>{this.emit("toggleActivity",{...e,blankSelector:this.blankSelector})},addFile:({data:e})=>{this.emit("addFile",{ready:this.blankSelector.isFilesReadyForUpload()})},removeFile:()=>this.emit("removeFile",{ready:this.blankSelector.isFilesReadyForUpload()}),clearFiles:()=>this.emit("clearFiles")}});const{type:s,portalConfig:a}=e;this.setupData=null;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=s;babelHelpers.classPrivateFieldLooseBase(this,v)[v]=new l.Api;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=new Map;this.initLayout();babelHelpers.classPrivateFieldLooseBase(this,P)[P](a)}initLayout(){this.layout=s.Tag.render(n||(n=r`
			<div class="sign-document-setup">
				<p class="sign-document-setup__add-title">
					${0}
				</p>
				${0}
			</div>
		`),s.Loc.getMessage("SIGN_DOCUMENT_SETUP_ADD_TITLE"),this.blankSelector.getLayout())}isSameBlankSelected(){var e;const{selectedBlankId:s}=this.blankSelector;const{blankId:a}=(e=this.setupData)!=null?e:{};return s>0&&a===s}handleError(e){babelHelpers.classPrivateFieldLooseBase(this,m)[m](null);this.blankSelector.resetSelectedBlank();this.blankSelector.deleteBlank(e)}loadBlocks(e){return babelHelpers.classPrivateFieldLooseBase(this,v)[v].loadBlocksByDocument(e)}async setup(e,s=false){if(this.isSameBlankSelected()){this.setupData={...this.setupData,isTemplate:true};return}const{selectedBlankId:a}=this.blankSelector;let t=0;try{if(e){const[s,a]=await Promise.all([babelHelpers.classPrivateFieldLooseBase(this,v)[v].loadDocument(e),this.loadBlocks(e)]);babelHelpers.classPrivateFieldLooseBase(this,m)[m]({...s,blocks:a,isTemplate:true});const{blankId:t}=s;if(!this.blankSelector.hasBlank(t)){await this.blankSelector.loadBlankById(t)}this.blankSelector.selectBlank(t)}else{this.ready=false;t=a||await this.blankSelector.createBlank();const e=babelHelpers.classPrivateFieldLooseBase(this,u)[u].has(t);const{uid:l,templateUid:i}=e?await babelHelpers.classPrivateFieldLooseBase(this,g)[g](babelHelpers.classPrivateFieldLooseBase(this,u)[u].get(t),t):await babelHelpers.classPrivateFieldLooseBase(this,B)[B](t,s);babelHelpers.classPrivateFieldLooseBase(this,u)[u].set(t,l);await babelHelpers.classPrivateFieldLooseBase(this,v)[v].upload(l);const[o,r]=await Promise.all([babelHelpers.classPrivateFieldLooseBase(this,v)[v].loadDocument(l),babelHelpers.classPrivateFieldLooseBase(this,v)[v].loadBlocksByDocument(l)]);const n=Boolean(a);babelHelpers.classPrivateFieldLooseBase(this,m)[m]({...o,blocks:r,isTemplate:n,templateUid:i})}}catch{this.handleError(t)}this.ready=true}async waitForPagesList(e,s=false){let a=0;let t=false;const l=10*1e3;const i=this.setupData.uid;const{blankId:o,isTemplate:r}=this.setupData;if(!r){this.blankSelector.selectBlank(o)}this.emit("toggleActivity",{selected:false});const n=[new Promise((e=>{var s;(s=BX.PULL)==null?void 0:s.subscribe({moduleId:"sign",command:"blankIsReady",callback:s=>{if(!t&&s!=null&&s.pages&&(s==null?void 0:s.uid)===i){e(s==null?void 0:s.pages)}}})})),new Promise((e=>{a=setInterval((async()=>{if(t){clearInterval(a);return}const s=await babelHelpers.classPrivateFieldLooseBase(this,F)[F](i);if(s.length>0){e(s)}}),l)}))];if(s){n.push(new Promise((e=>{babelHelpers.classPrivateFieldLooseBase(this,F)[F](i).then((s=>{if(s.length>0){e(s)}}))})))}const c=await Promise.race(n);if(!r){const e=this.blankSelector.getBlank(o);e.setPreview(c[0].url)}clearInterval(a);t=true;babelHelpers.classPrivateFieldLooseBase(this,y)[y](c,e)}set ready(e){if(e){s.Dom.removeClass(this.layout,"--pending")}else{s.Dom.addClass(this.layout,"--pending")}}}function _(e){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=s.Tag.render(c||(c=r`<div></div>`));const a=this.layout.querySelector(".sign-blank-selector__tile-widget");s.Dom.insertBefore(babelHelpers.classPrivateFieldLooseBase(this,b)[b],a);const{isDomainChanged:t,isEdoRegion:l,isUnsecuredScheme:i}=e;if(t){babelHelpers.classPrivateFieldLooseBase(this,f)[f]()}if(i){babelHelpers.classPrivateFieldLooseBase(this,H)[H]()}if(l&&babelHelpers.classPrivateFieldLooseBase(this,h)[h]!=="b2e"){babelHelpers.classPrivateFieldLooseBase(this,D)[D]()}}async function E(e,s=false){const a=await babelHelpers.classPrivateFieldLooseBase(this,v)[v].register(e,babelHelpers.classPrivateFieldLooseBase(this,h)[h],s);return a!=null?a:{}}async function I(e,s){var a;const t=await babelHelpers.classPrivateFieldLooseBase(this,v)[v].changeDocument(e,s);return(a=t==null?void 0:t.uid)!=null?a:""}async function T(e){var s;const a=await babelHelpers.classPrivateFieldLooseBase(this,v)[v].getPages(e);return(s=a.pages)!=null?s:[]}async function C(e){const a=e.map((async e=>{const a=await fetch(e.url);const t=await a.blob();const l=new FileReader;await new Promise((e=>{s.Event.bindOnce(l,"loadend",e);l.readAsDataURL(t)}));return l.result}));return Promise.all(a)}function O(e){this.setupData=e;this.blankSelector.clearFiles({removeFromServer:false})}async function N(e,s){let a=0;const t=3;while(a<e.length){const l=e.slice(a,a+t);const i=await babelHelpers.classPrivateFieldLooseBase(this,L)[L](l);this.emit("toggleActivity",{selected:true});a+=t;s(i,e.length)}}function U(){const e=`<div>${s.Loc.getMessage("SIGN_DOCUMENT_SETUP_USE_UNSECURED_SCHEME_WARNING")}</div>`;const a=babelHelpers.classPrivateFieldLooseBase(this,S)[S]();a.setText(e);s.Dom.append(a.getContainer(),babelHelpers.classPrivateFieldLooseBase(this,b)[b])}function A(){const e=new i.Button({text:s.Loc.getMessage("SIGN_DOCUMENT_SETUP_REFRESH_DOMAIN_BUTTON_TEXT"),color:i.Button.Color.LINK,onclick:()=>babelHelpers.classPrivateFieldLooseBase(this,v)[v].changeDomain().then((()=>babelHelpers.classPrivateFieldLooseBase(this,k)[k]())),className:"sign-document-setup__change-domain-button",size:i.Button.Size.EXTRA_SMALL});const a=`<p>${s.Loc.getMessage("SIGN_DOCUMENT_SETUP_CHANGE_DOMAIN_WARNING")}</p>`;const t=babelHelpers.classPrivateFieldLooseBase(this,S)[S]();t.setText(a);babelHelpers.classPrivateFieldLooseBase(this,p)[p]=t.getContainer();s.Dom.append(e.getContainer(),babelHelpers.classPrivateFieldLooseBase(this,p)[p]);s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,p)[p],babelHelpers.classPrivateFieldLooseBase(this,b)[b])}function j(){return new o.Alert({size:o.Alert.Size.MD,color:o.Alert.Color.WARNING,icon:o.Alert.Icon.DANGER,customClass:"sign-document-setup__change-domain-wrapper"})}function K(){s.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,p)[p])}function X(){const e=s.Loc.getMessage("SIGN_DOCUMENT_SETUP_EDO_TEXT",{"[helpdesklink]":'<a class="sign-document-setup__helpdesk-article" href="javascript:top.BX.Helper.show(\'redirect=detail&code=18453372\');">',"[/helpdesklink]":"</a>"});const a=babelHelpers.classPrivateFieldLooseBase(this,S)[S]();a.setColor(o.Alert.Color.PRIMARY);a.setIcon(o.Alert.Icon.INFO);a.setText(e);s.Dom.append(a.getContainer(),babelHelpers.classPrivateFieldLooseBase(this,b)[b])}e.DocumentInitiated=d;e.DocumentSetup=w})(this.BX.Sign.V2=this.BX.Sign.V2||{},BX,BX.Event,BX.Sign.V2,BX.Sign.V2,BX.UI,BX.UI);
//# sourceMappingURL=document-setup.bundle.map.js