this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};(function(e,s,t,i,a,l,o,r,n){"use strict";function d(e,s,t){return async()=>{let i=false;try{i=await e()}catch(e){await t();throw e}if(i){await s()}else{await t()}return i}}function c(e){return e===n.DocumentMode.template}function u(e){return r.Type.isStringFilled(e)?e:undefined}let b=e=>e,p,h,v;var y=babelHelpers.classPrivateFieldLooseKey("cache");var P=babelHelpers.classPrivateFieldLooseKey("containerId");var g=babelHelpers.classPrivateFieldLooseKey("preview");var m=babelHelpers.classPrivateFieldLooseKey("type");var L=babelHelpers.classPrivateFieldLooseKey("wizardOptions");var B=babelHelpers.classPrivateFieldLooseKey("previewLayout");var F=babelHelpers.classPrivateFieldLooseKey("container");var S=babelHelpers.classPrivateFieldLooseKey("overlayContainer");var f=babelHelpers.classPrivateFieldLooseKey("currentOverlay");var H=babelHelpers.classPrivateFieldLooseKey("isEditMode");var w=babelHelpers.classPrivateFieldLooseKey("isSameBlankSelected");var T=babelHelpers.classPrivateFieldLooseKey("createHead");var D=babelHelpers.classPrivateFieldLooseKey("getHeaderTitleSubText");var _=babelHelpers.classPrivateFieldLooseKey("getHeaderTitleText");var O=babelHelpers.classPrivateFieldLooseKey("getLayout");var G=babelHelpers.classPrivateFieldLooseKey("getOverlayContainer");var E=babelHelpers.classPrivateFieldLooseKey("showCompleteNotification");var I=babelHelpers.classPrivateFieldLooseKey("isGroupDocuments");var M=babelHelpers.classPrivateFieldLooseKey("renderPages");var N=babelHelpers.classPrivateFieldLooseKey("subscribeOnEditorEvents");var j=babelHelpers.classPrivateFieldLooseKey("getPagesUrls");var K=babelHelpers.classPrivateFieldLooseKey("executeEditorActionsForGroup");var k=babelHelpers.classPrivateFieldLooseKey("appendOverlay");var A=babelHelpers.classPrivateFieldLooseKey("render");var C=babelHelpers.classPrivateFieldLooseKey("showOverlay");var U=babelHelpers.classPrivateFieldLooseKey("hideOverlay");class X{constructor(e,t={},i={}){var a;Object.defineProperty(this,U,{value:ie});Object.defineProperty(this,C,{value:te});Object.defineProperty(this,A,{value:se});Object.defineProperty(this,k,{value:ee});Object.defineProperty(this,K,{value:Z});Object.defineProperty(this,j,{value:Y});Object.defineProperty(this,N,{value:Q});Object.defineProperty(this,M,{value:J});Object.defineProperty(this,I,{value:W});Object.defineProperty(this,E,{value:q});Object.defineProperty(this,G,{value:V});Object.defineProperty(this,O,{value:$});Object.defineProperty(this,_,{value:R});Object.defineProperty(this,D,{value:z});Object.defineProperty(this,T,{value:x});Object.defineProperty(this,y,{writable:true,value:new s.MemoryCache});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,m,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:null});Object.defineProperty(this,F,{writable:true,value:null});Object.defineProperty(this,S,{writable:true,value:null});Object.defineProperty(this,f,{writable:true,value:null});Object.defineProperty(this,H,{writable:true,value:false});Object.defineProperty(this,w,{writable:true,value:false});this.isB2bSignMaster=false;this.hasPreviewUrls=false;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=e;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=i;const{type:o="",config:n={},documentMode:d,initiatedByType:c}=t;this.documentMode=d;babelHelpers.classPrivateFieldLooseBase(this,m)[m]=o;this.documentsGroup=new Map;this.documentsGroupUids=[];const{languages:u}=(a=n.documentSendConfig)!=null?a:{};const b=r.Reflection.getClass("top.BX.Sign.V2.Editor");this.editor=new b(o,{languages:u,isTemplateMode:this.isTemplateMode(),documentInitiatedByType:c});babelHelpers.classPrivateFieldLooseBase(this,g)[g]=new l.Preview({layout:{getAfterPreviewLayoutCallback:()=>this.getAfterPreviewLayout()}})}isTemplateMode(){return this.documentMode===n.DocumentMode.template}isDocumentMode(){return this.documentMode===n.DocumentMode.document}onComplete(e=true){BX.SidePanel.Instance.close();if(e){babelHelpers.classPrivateFieldLooseBase(this,E)[E]()}if(this.isSingleDocument()){const e=window.location.search;const s=new URLSearchParams(e);if(!s.has("noRedirect")){const{entityTypeId:e,entityId:s}=this.documentSetup.setupData;const t=`/crm/type/${e}/details/${s}/`;BX.SidePanel.Instance.open(t)}}}isSingleDocument(){return this.documentsGroup.size===1}getFirstDocumentUidFromGroup(){return this.documentsGroup.keys().next().value}getFirstDocumentDataFromGroup(){return this.documentsGroup.values().next().value}subscribeOnEvents(){const e=[{type:"toggleActivity",stage:"setup",method:({data:e})=>{const{selected:s}=e;this.wizard.toggleBtnActiveState("next",!s)}},{type:"addFile",stage:"setup",method:({data:e})=>{this.wizard.toggleBtnActiveState("next",!e.ready)}},{type:"removeFile",stage:"setup",method:({data:e})=>{this.wizard.toggleBtnActiveState("next",!e.ready)}},{type:"clearFiles",stage:"setup",method:()=>this.wizard.toggleBtnActiveState("next",true)},{type:"showEditor",stage:"send",method:async e=>{const{uid:s}=e.getData();if(s&&babelHelpers.classPrivateFieldLooseBase(this,I)[I]()){await babelHelpers.classPrivateFieldLooseBase(this,K)[K](s)}this.editor.show()}},{type:"changeTitle",stage:"send",method:({data:e})=>{this.documentSetup.setupData={...this.documentSetup.setupData,title:e.title};const{blankTitle:s}=e;if(s){const{blankSelector:e,setupData:t}=this.documentSetup;e.modifyBlankTitle(t.blankId,s)}}},{type:"close",stage:"send",method:()=>this.onComplete(false)},{type:"hidePreview",stage:"send",method:()=>r.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,B)[B],"display","none")},{type:"showPreview",stage:"send",method:()=>r.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,B)[B],"display","flex")},{type:"appendOverlay",stage:"send",method:e=>{var s;return babelHelpers.classPrivateFieldLooseBase(this,k)[k](e==null?void 0:(s=e.data)==null?void 0:s.overlay)}},{type:"showOverlay",stage:"send",method:()=>babelHelpers.classPrivateFieldLooseBase(this,C)[C]()},{type:"hideOverlay",stage:"send",method:()=>babelHelpers.classPrivateFieldLooseBase(this,U)[U]()}];e.forEach((({type:e,method:s,stage:t})=>{const i=t==="setup"?this.documentSetup:this.documentSend;i.subscribe(e,s)}));babelHelpers.classPrivateFieldLooseBase(this,N)[N]()}async setupDocument(e,s=false){if(this.documentSetup.isSameBlankSelected()){void await this.documentSetup.setup(e);babelHelpers.classPrivateFieldLooseBase(this,w)[w]=true;return this.documentSetup.setupData}if(this.documentsGroup.size===0){babelHelpers.classPrivateFieldLooseBase(this,g)[g].urls=[];this.editor.setUrls([],0);babelHelpers.classPrivateFieldLooseBase(this,g)[g].setBlocks()}await this.documentSetup.setup(e);const{setupData:i}=this.documentSetup;if(!i){return null}if(this.documentsGroup.size===0||this.editedDocument&&this.isFirstDocumentSelected(this.editedDocument.uid)||this.isTemplateMode()||this.isB2bSignMaster||!t.FeatureStorage.isGroupSendingEnabled()){babelHelpers.classPrivateFieldLooseBase(this,M)[M](i,s)}if(babelHelpers.classPrivateFieldLooseBase(this,g)[g].hasUrls()){this.hasPreviewUrls=true;this.wizard.toggleBtnActiveState("next",false)}babelHelpers.classPrivateFieldLooseBase(this,w)[w]=false;return i}async init(e,s){babelHelpers.classPrivateFieldLooseBase(this,H)[H]=r.Type.isStringFilled(e)||r.Type.isStringFilled(s);const t=this.getStepsMetadata(this,u(e),u(s));const{complete:i,...a}=babelHelpers.classPrivateFieldLooseBase(this,L)[L];const l=this.isTemplateMode()?r.Loc.getMessage("SIGN_SETTINGS_CREATE_TEMPLATE"):r.Loc.getMessage("SIGN_SETTINGS_SEND_FOR_SIGN");this.wizard=new o.Wizard(t,{back:{className:"ui-btn-light-border"},next:{className:"ui-btn-primary"},complete:{className:"ui-btn-primary",title:l,onComplete:()=>this.onComplete(),...i},...a});if(e){await this.applyDocumentData(e)}if(s){await this.applyTemplateData(s)}babelHelpers.classPrivateFieldLooseBase(this,A)[A](e)}async applyTemplateData(e){}getStepsMetadata(e,s,t){return{}}setAnalyticsContext(e){this.getAnalytics().setContext(new i.Context(e))}getAnalytics(){return babelHelpers.classPrivateFieldLooseBase(this,y)[y].remember("analytics",(()=>{var e,s;return new((e=(s=top.BX)==null?void 0:s.Sign.V2.Analytics)!=null?e:i.Analytics)}))}isEditMode(){return babelHelpers.classPrivateFieldLooseBase(this,H)[H]}resetPreview(){babelHelpers.classPrivateFieldLooseBase(this,g)[g].urls=[];babelHelpers.classPrivateFieldLooseBase(this,g)[g].setBlocks()}disablePreviewReady(){babelHelpers.classPrivateFieldLooseBase(this,g)[g].ready=false}enablePreviewReady(){babelHelpers.classPrivateFieldLooseBase(this,g)[g].ready=true}setSingleDocument(e){this.documentsGroup.clear();this.documentsGroup.set(e.uid,e);this.documentsGroupUids.length=0;this.documentsGroupUids.push(e.uid);this.documentSend.setDocumentsBlock(this.documentsGroup);if(!babelHelpers.classPrivateFieldLooseBase(this,w)[w]){this.resetPreview();this.editor.setUrls([]);this.disablePreviewReady()}}isFirstDocumentSelected(e){return this.documentsGroupUids[0]===e}getAfterPreviewLayout(){return null}async applyDocumentData(e){}}function x(){const e=babelHelpers.classPrivateFieldLooseBase(this,_)[_]();const s=babelHelpers.classPrivateFieldLooseBase(this,D)[D]();return r.Tag.render(p||(p=b`
			<div class="sign-settings__head">
				<div>
					<p class="sign-settings__head_title">${0}</p>
					<p class="sign-settings__head_title --sub">
						${0}
					</p>
				</div>
			</div>
		`),e,s)}function z(){if(babelHelpers.classPrivateFieldLooseBase(this,m)[m]==="b2b"){return r.Loc.getMessage("SIGN_SETTINGS_B2B_TITLE_SUB")}if(this.isTemplateMode()&&babelHelpers.classPrivateFieldLooseBase(this,H)[H]){return null}return r.Loc.getMessage("SIGN_SETTINGS_B2E_TITLE_SUB")}function R(){if(this.isTemplateMode()){return babelHelpers.classPrivateFieldLooseBase(this,H)[H]?r.Loc.getMessage("SIGN_SETTINGS_TITLE_TEMPLATE_EDIT"):r.Loc.getMessage("SIGN_SETTINGS_TITLE_TEMPLATE")}return r.Loc.getMessage("SIGN_SETTINGS_TITLE")}function $(){const e=babelHelpers.classPrivateFieldLooseBase(this,m)[m]==="b2e"?"sign-settings --b2e":"sign-settings";babelHelpers.classPrivateFieldLooseBase(this,B)[B]=babelHelpers.classPrivateFieldLooseBase(this,g)[g].getLayout();babelHelpers.classPrivateFieldLooseBase(this,F)[F]=r.Tag.render(h||(h=b`
			<div class="sign-settings__scope ${0}">
				<div class="sign-settings__sidebar">
					${0}
					${0}
				</div>
				<div style="display: flex; flex-direction: column;">
					${0}
				</div>
			</div>
		`),e,babelHelpers.classPrivateFieldLooseBase(this,T)[T](),this.wizard.getLayout(),babelHelpers.classPrivateFieldLooseBase(this,B)[B]);return babelHelpers.classPrivateFieldLooseBase(this,F)[F]}function V(){if(!babelHelpers.classPrivateFieldLooseBase(this,S)[S]){babelHelpers.classPrivateFieldLooseBase(this,S)[S]=r.Tag.render(v||(v=b`<div class="sign-settings__overlay"></div>`))}r.Dom.hide(babelHelpers.classPrivateFieldLooseBase(this,S)[S]);return babelHelpers.classPrivateFieldLooseBase(this,S)[S]}function q(){const e=r.Reflection.getClass("top.BX.UI.Notification");const s=babelHelpers.classPrivateFieldLooseBase(this,I)[I]()?r.Loc.getMessage("SIGN_SETTINGS_COMPLETE_NOTIFICATION_TEXT_GROUP"):r.Loc.getMessage("SIGN_SETTINGS_COMPLETE_NOTIFICATION_TEXT");e.Center.notify({content:s,autoHideDelay:4e3})}function W(){return this.documentsGroup.size>1}async function J(e,s=false){babelHelpers.classPrivateFieldLooseBase(this,g)[g].urls=[];this.disablePreviewReady();babelHelpers.classPrivateFieldLooseBase(this,g)[g].setBlocks(e.blocks);this.wizard.toggleBtnActiveState("back",true);const t=(e,s)=>{this.enablePreviewReady();babelHelpers.classPrivateFieldLooseBase(this,g)[g].urls=e;this.editor.setUrls(e,s);this.wizard.toggleBtnActiveState("back",false)};this.documentSetup.waitForPagesList(e,t,s)}function Q(){this.editor.subscribe("save",(({data:e})=>{const s=e.blocks;const t=e.uid;const i=this.documentsGroup.get(t);i.blocks=s;if(t===this.getFirstDocumentUidFromGroup()){babelHelpers.classPrivateFieldLooseBase(this,g)[g].setBlocks(s);this.documentSetup.setupData={...this.documentSetup.setupData,blocks:s}}}))}async function Y(e){const s=[];const t=t=>{const i=this.documentsGroup.get(e.uid);s.push(...t);i.urls=s};await this.documentSetup.waitForPagesList(e,t)}async function Z(e){this.editor.setUrls([],0);const s=this.documentsGroup.get(e);if(!s.urls){const e=babelHelpers.classPrivateFieldLooseBase(this,F)[F].querySelector(`span[data-id="${s.id}"]`);r.Dom.addClass(e,"ui-btn-clock");await babelHelpers.classPrivateFieldLooseBase(this,j)[j](s);r.Dom.removeClass(e,"ui-btn-clock");this.documentSetup.blankSelector.disableSelectedBlank(s.blankId);this.documentSetup.resetDocument();this.wizard.toggleBtnActiveState("next",false)}const t=this.documentsGroup.get(e);this.editor.documentData=t;this.editor.setUrls(t.urls,t.urls.length);await this.editor.waitForPagesUrls();await this.editor.renderDocument()}function ee(e){if(!e){return}if(babelHelpers.classPrivateFieldLooseBase(this,f)[f]){r.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,f)[f])}babelHelpers.classPrivateFieldLooseBase(this,f)[f]=e;r.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,f)[f],babelHelpers.classPrivateFieldLooseBase(this,S)[S])}function se(e){const s=document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,P)[P]);r.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,G)[G](),s);r.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,O)[O](),s);const t=this.documentSetup.setupData?1:0;if(!this.isB2bSignMaster){const s=r.Type.isStringFilled(e);this.wizard.toggleBtnActiveState("next",!s)}this.wizard.moveOnStep(t)}function te(){r.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,F)[F],"display","none");r.Dom.show(babelHelpers.classPrivateFieldLooseBase(this,S)[S])}function ie(){r.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,F)[F],"display","flex");r.Dom.hide(babelHelpers.classPrivateFieldLooseBase(this,S)[S])}e.decorateResultBeforeCompletion=d;e.isTemplateMode=c;e.SignSettings=X})(this.BX.Sign.V2=this.BX.Sign.V2||{},BX.Cache,BX.Sign,BX.Sign.V2,BX.Sign.V2,BX.Sign.V2,BX.Ui,BX,BX.Sign);
//# sourceMappingURL=sign-settings.bundle.map.js