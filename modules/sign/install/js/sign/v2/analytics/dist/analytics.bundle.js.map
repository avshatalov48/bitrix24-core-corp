{"version":3,"file":"analytics.bundle.js","sources":["../src/context.js","../src/analytics.js"],"sourcesContent":["import type { AnalyticsOptions } from 'ui.analytics';\n\nexport class Context\n{\n\t#options: Partial<AnalyticsOptions> = {};\n\n\tconstructor(options: Partial<AnalyticsOptions> = {})\n\t{\n\t\tthis.#options = options;\n\t}\n\n\tupdate(options: Partial<AnalyticsOptions>): void\n\t{\n\t\tthis.#options = { ...this.#options, ...options };\n\t}\n\n\tgetOptions(): Partial<AnalyticsOptions>\n\t{\n\t\treturn this.#options;\n\t}\n}\n","import { Type } from 'main.core';\nimport type { ProviderCodeType } from 'sign.v2.api';\nimport { Api } from 'sign.v2.api';\nimport { ProviderCode } from 'sign.v2.b2e.company-selector';\nimport { type AnalyticsOptions, sendData } from 'ui.analytics';\nimport { Context } from './context';\n\nexport { Context };\nexport type { AnalyticsOptions };\n\ntype AnalyticOptionsWithoutToolKey = Omit<AnalyticsOptions, 'tool'>;\n\nexport class Analytics\n{\n\t#context: Context;\n\t#api: Api = new Api();\n\n\tconstructor(options: { contextOptions?: Partial<AnalyticsOptions> } = {})\n\t{\n\t\tthis.#context = new Context(options.contextOptions ?? {});\n\t}\n\n\tsend(options: AnalyticOptionsWithoutToolKey): void\n\t{\n\t\tsendData({ ...this.#context.getOptions(), ...options, tool: 'sign' });\n\t}\n\n\tsetContext(context: Context): void\n\t{\n\t\tthis.#context = context;\n\t}\n\n\tgetContext(): Context\n\t{\n\t\treturn this.#context;\n\t}\n\n\tsendWithProviderTypeAndDocId(\n\t\toptions: AnalyticOptionsWithoutToolKey,\n\t\tdocumentUidOrId: number | string,\n\t): void\n\t{\n\t\tvoid this.#sendWithProviderType(options, documentUidOrId);\n\t}\n\n\tsendWithDocId(options: AnalyticOptionsWithoutToolKey, documentUidOrId: string | number): void\n\t{\n\t\tif (Type.isNumber(documentUidOrId))\n\t\t{\n\t\t\tthis.send({\n\t\t\t\t...options,\n\t\t\t\tp5: `docId_${documentUidOrId}`,\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\t(async () => {\n\t\t\tconst document = await this.#api.loadDocument(documentUidOrId);\n\t\t\tthis.send({\n\t\t\t\t...options,\n\t\t\t\tp5: `docId_${document.id}`,\n\t\t\t});\n\t\t})()\n\t}\n\n\tasync #sendWithProviderType(options: AnalyticOptionsWithoutToolKey, documentUidOrId: number | string): Promise<void>\n\t{\n\t\tconst document = Type.isString(documentUidOrId)\n\t\t\t? await this.#api.loadDocument(documentUidOrId)\n\t\t\t: await this.#api.loadDocumentById(documentUidOrId)\n\t\t;\n\t\tif (!document)\n\t\t{\n\t\t\tconsole.warn('Document not found by identifier', documentUidOrId);\n\n\t\t\treturn;\n\t\t}\n\t\tthis.send({\n\t\t\t...options,\n\t\t\tp1: this.#convertProviderCodeToP1IntegrationType(document.providerCode),\n\t\t\tp5: `docId_${document.id}`,\n\t\t});\n\t}\n\n\t#convertProviderCodeToP1IntegrationType(providerType?: ProviderCodeType): string\n\t{\n\t\tswitch (providerType)\n\t\t{\n\t\t\tcase ProviderCode.sesRu:\n\t\t\tcase ProviderCode.sesCom:\n\t\t\t\treturn 'integration_bitrix24KEDO';\n\t\t\tcase ProviderCode.goskey:\n\t\t\t\treturn 'integration_Goskluch';\n\t\t\tcase ProviderCode.external:\n\t\t\t\treturn 'integration_external';\n\t\t\tdefault:\n\t\t\t\treturn 'integration_N';\n\t\t}\n\t}\n}\n"],"names":["Context","constructor","options","update","getOptions","Analytics","Api","contextOptions","send","sendData","tool","setContext","context","getContext","sendWithProviderTypeAndDocId","documentUidOrId","sendWithDocId","Type","isNumber","p5","document","loadDocument","id","isString","loadDocumentById","console","warn","p1","providerCode","providerType","ProviderCode","sesRu","sesCom","goskey","external"],"mappings":";;;;;;;AAEA,CAAO,MAAMA,OAAO,CACpB;GAGCC,WAAW,CAACC,OAAkC,GAAG,EAAE,EACnD;KAAA;OAAA;OAAA,OAHsC;;KAIrC,4CAAI,wBAAYA,OAAO;;GAGxBC,MAAM,CAACD,OAAkC,EACzC;KACC,4CAAI,wBAAY;OAAE,2CAAG,IAAI,qBAAS;OAAE,GAAGA;MAAS;;GAGjDE,UAAU,GACV;KACC,+CAAO,IAAI;;CAEb;;CCbmB;CAAA;CAAA;CAAA;AAKnB,CAAO,MAAMC,SAAS,CACtB;GAICJ,WAAW,CAACC,QAAuD,GAAG,EAAE,EACxE;KAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAHY,IAAII,eAAG;;KAIlB,4CAAI,wBAAY,IAAIN,OAAO,0BAACE,QAAO,CAACK,cAAc,oCAAI,EAAE,CAAC;;GAG1DC,IAAI,CAACN,OAAsC,EAC3C;KACCO,qBAAQ,CAAC;OAAE,GAAG,4CAAI,sBAAUL,UAAU,EAAE;OAAE,GAAGF,OAAO;OAAEQ,IAAI,EAAE;MAAQ,CAAC;;GAGtEC,UAAU,CAACC,OAAgB,EAC3B;KACC,4CAAI,wBAAYA,OAAO;;GAGxBC,UAAU,GACV;KACC,+CAAO,IAAI;;GAGZC,4BAA4B,CAC3BZ,OAAsC,EACtCa,eAAgC,EAEjC;KACC,6CAAK,IAAI,gDAAuBb,OAAO,EAAEa,eAAe,CAAC;;GAG1DC,aAAa,CAACd,OAAsC,EAAEa,eAAgC,EACtF;KACC,IAAIE,cAAI,CAACC,QAAQ,CAACH,eAAe,CAAC,EAClC;OACC,IAAI,CAACP,IAAI,CAAC;SACT,GAAGN,OAAO;SACViB,EAAE,EAAG,SAAQJ,eAAgB;QAC7B,CAAC;OAEF;;KAGD,CAAC,YAAY;OACZ,MAAMK,QAAQ,GAAG,MAAM,4CAAI,cAAMC,YAAY,CAACN,eAAe,CAAC;OAC9D,IAAI,CAACP,IAAI,CAAC;SACT,GAAGN,OAAO;SACViB,EAAE,EAAG,SAAQC,QAAQ,CAACE,EAAG;QACzB,CAAC;MACF,GAAG;;CAqCN;CAAC,sCAlC4BpB,OAAsC,EAAEa,eAAgC,EACpG;GACC,MAAMK,QAAQ,GAAGH,cAAI,CAACM,QAAQ,CAACR,eAAe,CAAC,GAC5C,MAAM,4CAAI,cAAMM,YAAY,CAACN,eAAe,CAAC,GAC7C,MAAM,4CAAI,cAAMS,gBAAgB,CAACT,eAAe,CAAC;GAEpD,IAAI,CAACK,QAAQ,EACb;KACCK,OAAO,CAACC,IAAI,CAAC,kCAAkC,EAAEX,eAAe,CAAC;KAEjE;;GAED,IAAI,CAACP,IAAI,CAAC;KACT,GAAGN,OAAO;KACVyB,EAAE,0CAAE,IAAI,oFAAyCP,QAAQ,CAACQ,YAAY,CAAC;KACvET,EAAE,EAAG,SAAQC,QAAQ,CAACE,EAAG;IACzB,CAAC;CACH;CAAC,kDAEuCO,YAA+B,EACvE;GACC,QAAQA,YAAY;KAEnB,KAAKC,wCAAY,CAACC,KAAK;KACvB,KAAKD,wCAAY,CAACE,MAAM;OACvB,OAAO,0BAA0B;KAClC,KAAKF,wCAAY,CAACG,MAAM;OACvB,OAAO,sBAAsB;KAC9B,KAAKH,wCAAY,CAACI,QAAQ;OACzB,OAAO,sBAAsB;KAC9B;OACC,OAAO,eAAe;;CAEzB;;;;;;;;;"}