this.BX=this.BX||{},this.BX.Sign=this.BX.Sign||{},function(e,t,i,s,a){"use strict";const o=Object.freeze({Edit:"edit",Create:"create"}),l=Object.freeze({B2b:36,B2e:39}),n=Object.freeze({B2b:"sign_b2b_entity_editor",B2e:"sign_b2e_entity_editor"});let r,d=e=>e;const c=Object.freeze({params:{ENABLE_CONFIGURATION_UPDATE:"N",ENABLE_PAGE_TITLE_CONTROLS:!1,ENABLE_MODE_TOGGLE:!1,IS_EMBEDDED:"N",forceDefaultConfig:"Y",enableSingleSectionCombining:"N"}}),b=["onCrmEntityUpdate","BX.Crm.EntityEditor:onFailedValidation","onCrmEntityUpdateError","BX.Crm.EntityEditor:onEntitySaveFailure"];var y=babelHelpers.classPrivateFieldLooseKey("mode"),v=babelHelpers.classPrivateFieldLooseKey("documentEntityId"),p=babelHelpers.classPrivateFieldLooseKey("guid"),u=babelHelpers.classPrivateFieldLooseKey("entityTypeId"),E=babelHelpers.classPrivateFieldLooseKey("companyId"),h=babelHelpers.classPrivateFieldLooseKey("showOnlyCompany"),B=babelHelpers.classPrivateFieldLooseKey("options"),m=babelHelpers.classPrivateFieldLooseKey("loadEntityEditor"),P=babelHelpers.classPrivateFieldLooseKey("showEntityEditor"),L=babelHelpers.classPrivateFieldLooseKey("save"),F=babelHelpers.classPrivateFieldLooseKey("loadedHandler");async function C(){var e;const i=await t.ajax.runAction("crm.api.item.getEditor",{data:{...c,id:babelHelpers.classPrivateFieldLooseBase(this,v)[v],entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,u)[u],guid:babelHelpers.classPrivateFieldLooseBase(this,p)[p]}});return(null==i||null==(e=i.data)?void 0:e.html)||""}async function H(e){const s=new i.Loader({target:e,size:80});try{s.show();const i=await babelHelpers.classPrivateFieldLooseBase(this,m)[m]();await t.Runtime.html(e,i)}finally{s.destroy()}if(babelHelpers.classPrivateFieldLooseBase(this,h)[h]){const i=e.querySelector(".ui-entity-editor-column-content");if(!t.Type.isDomNode(i))return void babelHelpers.classPrivateFieldLooseBase(this,F)[F]();const s=i.querySelector('[data-cid="myCompany"]');if(!t.Type.isDomNode(s))return void babelHelpers.classPrivateFieldLooseBase(this,F)[F]();t.Dom.clean(i),t.Dom.append(s,i);const a=i.querySelector(".ui-entity-editor-section-header");t.Type.isDomNode(a)&&t.Dom.remove(a)}babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}async function f(){const e=new Promise(e=>{const[t,...i]=b;s.EventEmitter.subscribeOnce(t,t=>{const[{entityData:i}]=t.data;e(i)}),i.forEach(t=>{s.EventEmitter.subscribeOnce(t,()=>e(null))})});BX.Crm.EntityEditor.defaultInstance.save();const i=await e;if(b.forEach(e=>s.EventEmitter.unsubscribeAll(e)),i){var a,o;const{MYCOMPANY_ID_INFO:{COMPANY_DATA:[e]}}=i;t.Type.isFunction(null==(a=babelHelpers.classPrivateFieldLooseBase(this,B)[B])||null==(o=a.events)?void 0:o.onCompanySavedHandler)&&babelHelpers.classPrivateFieldLooseBase(this,B)[B].events.onCompanySavedHandler(e.id),BX.SidePanel.Instance.close()}}function O(){const e=BX.Crm.EntityEditor.defaultInstance,i=e.getControlById("MYCOMPANY_ID"),[a]=i._companySearchBoxes;if(babelHelpers.classPrivateFieldLooseBase(this,y)[y]===o.Create)return e.switchControlMode(i,BX.UI.EntityEditorMode.edit),a.setEntity(BX.CrmEntityInfo.create({typeName:"COMPANY",title:""}),!0),a._searchInput.value="",void t.Dom.remove(a._changeButton);if(babelHelpers.classPrivateFieldLooseBase(this,y)[y]===o.Edit){const e="BX.Crm.EntityEditor:onUserFieldsDeployed";a._searchInput.value="",a.setEntityTypeName("COMPANY"),a.setMode(BX.Crm.EntityEditorClientMode.loading),a.adjust(),s.EventEmitter.unsubscribeAll(e),s.EventEmitter.subscribe(e,()=>{t.Dom.remove(a._changeButton)}),a.loadEntityInfo(String(babelHelpers.classPrivateFieldLooseBase(this,E)[E]))}}e.CompanyEditor=class{constructor(e){var t;Object.defineProperty(this,F,{value:O}),Object.defineProperty(this,L,{value:f}),Object.defineProperty(this,P,{value:H}),Object.defineProperty(this,m,{value:C}),Object.defineProperty(this,y,{writable:!0,value:o.Create}),Object.defineProperty(this,v,{writable:!0,value:void 0}),Object.defineProperty(this,p,{writable:!0,value:void 0}),Object.defineProperty(this,u,{writable:!0,value:void 0}),Object.defineProperty(this,E,{writable:!0,value:null}),Object.defineProperty(this,h,{writable:!0,value:void 0}),Object.defineProperty(this,B,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,B)[B]=e,(null==e?void 0:e.mode)===o.Edit&&(null==e?void 0:e.companyId)>0&&(babelHelpers.classPrivateFieldLooseBase(this,y)[y]=o.Edit,babelHelpers.classPrivateFieldLooseBase(this,E)[E]=e.companyId),babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e.documentEntityId,babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e.entityTypeId,babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e.guid,babelHelpers.classPrivateFieldLooseBase(this,h)[h]=null!=(t=e.showOnlyCompany)&&t}static openSlider(e,t){var i;BX.SidePanel.Instance.open("company-editor",{width:800,cacheable:!1,contentCallback:()=>top.BX.Runtime.loadExtension("sign.v2.company-editor").then(t=>new t.CompanyEditor(e).getLayout()),events:{onClose:null!=(i=null==t?void 0:t.onCloseHandler)?i:()=>{}}})}render(){const e=t.Tag.render(r||(r=d`<div style="position: relative; z-index: 1; height: 100%"></div>`));return babelHelpers.classPrivateFieldLooseBase(this,P)[P](e),e}getLayout(){var e,t;const i=this;return a.Layout.createContent({title:null!=(e=null==(t=babelHelpers.classPrivateFieldLooseBase(i,B)[B])?void 0:t.layoutTitle)?e:"",content:()=>i.render(),buttons({cancelButton:e,SaveButton:t}){const s=new t({onclick:async()=>{s.setClocking(!0),await babelHelpers.classPrivateFieldLooseBase(i,L)[L](),s.setClocking(!1)}});return[s,e]}})}},e.CompanyEditorMode=o,e.DocumentEntityTypeId=l,e.EditorTypeGuid=n}(this.BX.Sign.V2=this.BX.Sign.V2||{},BX,BX,BX.Event,BX.UI.SidePanel);
//# sourceMappingURL=company-editor.bundle.js.map
