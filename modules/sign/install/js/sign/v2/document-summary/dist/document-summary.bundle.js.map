{"version":3,"file":"document-summary.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Tag, Text, Dom, Loc } from 'main.core';\nimport { Api } from 'sign.v2.api';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\nimport './style.css';\n\nconst buttonClassList = [\n\t'ui-btn',\n\t'ui-btn-sm',\n\t'ui-btn-light-border',\n\t'ui-btn-round',\n];\n\ntype DocumentSummaryOptions = {\n\tevents?: {\n\t\t[key: string]: (event: BaseEvent) => void\n\t}\n};\n\ntype ItemDetails = {\n\tblocks: Array<{ party: number; }>;\n\tentityId: number;\n\tid: number;\n\tisTemplate: boolean;\n\ttitle: string;\n\tuid: string;\n\turls: Array<string>;\n};\n\nexport class DocumentSummary extends EventEmitter\n{\n\titems: {\n\t\t[uid: string]: ItemDetails\n\t};\n\n\tconstructor(options: DocumentSummaryOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.DocumentSummary');\n\t\tthis.subscribeFromOptions(options.events);\n\t}\n\n\t#createDocumentDetails(item: Object): HTMLElement\n\t{\n\t\tconst title = Text.encode(item.title ?? '');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-summary__details\">\n\t\t\t\t<div class=\"sign-document-summary__details_title\">\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"sign-document-summary__details_title-text\"\n\t\t\t\t\t\ttitle=\"${title}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${title}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"sign-document-summary__details_edit-title-btn\"\n\t\t\t\t\t\tonclick=\"${({ target: button }) => {\n\t\t\t\t\t\t\tthis.#toggleTitleEditor(item, button, true);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t${this.#createNumber(item.externalId)}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\taddItem(uid: string, itemDetails: ItemDetails): void\n\t{\n\t\tif (!this.items)\n\t\t{\n\t\t\tthis.items = {};\n\t\t}\n\t\tthis.items[uid] = itemDetails;\n\t}\n\n\tdeleteItem(uid: string): void\n\t{\n\t\tif (!this.items || !this.items[uid])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdelete this.items[uid];\n\t}\n\n\tsetItems(documentObject): void\n\t{\n\t\tthis.items = {};\n\n\t\tObject.keys(documentObject).forEach((uid) => {\n\t\t\tthis.items[uid] = documentObject[uid];\n\t\t});\n\t}\n\n\t#createNumber(number: number): ?HTMLElement\n\t{\n\t\tif (!number)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst title = Loc.getMessage('SIGN_DOCUMENT_SUMMARY_REG_NUMBER', {\n\t\t\t'#NUMBER#': Text.encode(number),\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-summary__reg_number\" title=\"${title}\">\n\t\t\t\t${title}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createTitleEditor(item: ItemDetails): HTMLElement\n\t{\n\t\tconst okButtonClassName = [\n\t\t\t...buttonClassList.slice(0, 2),\n\t\t\t'ui-btn-primary',\n\t\t\t'sign-document-summary__title-editor_ok-btn',\n\t\t].join(' ');\n\t\tconst discardButtonClassName = [\n\t\t\t...buttonClassList.slice(0, 3),\n\t\t\t'sign-document-summary__title-editor_discard-btn',\n\t\t].join(' ');\n\t\tconst input = Tag.render`<input type=\"text\" class=\"ui-ctl-element\" maxlength=\"255\" />`;\n\t\tinput.value = item.title ?? '';\n\t\tthis.#focusInput(input);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-summary__title-editor\">\n\t\t\t\t<div class=\"sign-document-summary__title-editor_controls\">\n\t\t\t\t\t<span class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t${input}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"${okButtonClassName}\"\n\t\t\t\t\t\tonclick=\"${async ({ target }) => {\n\t\t\t\t\t\t\tDom.addClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\tawait this.#modifyDocumentTitle(item, input.value);\n\t\t\t\t\t\t\tDom.removeClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\tthis.#toggleTitleEditor(item, target, false);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"${discardButtonClassName}\"\n\t\t\t\t\t\tonclick=\"${({ target }) => {\n\t\t\t\t\t\t\tthis.#toggleTitleEditor(item, target, false);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<p class=\"sign-document-summary__title-editor_help\">\n\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SUMMARY_TITLE_EDITOR_HELP')}\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#toggleTitleEditor(item: ItemDetails, button: HTMLElement, shouldShow: boolean)\n\t{\n\t\tconst summaryNode = button.closest('.sign-document-summary');\n\t\tif (shouldShow)\n\t\t{\n\t\t\tDom.clean(summaryNode);\n\t\t\tDom.append(this.#createTitleEditor(item), summaryNode);\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.replace(summaryNode.firstElementChild, this.#createDocumentDetails(item));\n\t\tDom.append(this.#createEditDocumentBtn(item.id, item.uid), summaryNode);\n\t}\n\n\t#focusInput(input: HTMLElement)\n\t{\n\t\tconst observer = new MutationObserver(() => {\n\t\t\tif (input.isConnected)\n\t\t\t{\n\t\t\t\tinput.focus();\n\t\t\t\tobserver.disconnect();\n\t\t\t}\n\t\t});\n\t\tobserver.observe(document.body, { childList: true, subtree: true });\n\t}\n\n\tasync #modifyDocumentTitle(item: ItemDetails, newValue: string)\n\t{\n\t\tif (item.title === newValue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst api = new Api();\n\t\t\tconst titleData = await api.modifyTitle(item.uid, newValue);\n\t\t\tthis.items[item.uid].title = newValue;\n\t\t\tthis.emit('changeTitle', { uid: item.uid, title: newValue, blankTitle: titleData.blankTitle });\n\t\t}\n\t\tcatch (ex)\n\t\t{\n\t\t\tconsole.error(ex);\n\t\t}\n\t}\n\n\tsetNumber(uid: string, number: ?string): void\n\t{\n\t\tthis.items[uid].number = number;\n\t}\n\n\t#createEditDocumentBtn(id: number, uid: string): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<span\n\t\t\t\tclass=\"${buttonClassList.join(' ')}\" data-id=\"${id}\"\n\t\t\t\tonclick=\"${() => this.emit('showEditor', { uid })}\"\n\t\t\t>\n\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SUMMARY_EDIT')}\n\t\t\t</span>\n\t\t`;\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\tconst container = Tag.render`\n\t\t\t<div class=\"sign-document-summary-wrapper\"></div>\n\t\t`;\n\n\t\tfor (const item of Object.values(this.items))\n\t\t{\n\t\t\tconst itemBlock = Tag.render`\n\t\t\t\t<div class=\"sign-document-summary\">\n\t\t\t\t\t${this.#createDocumentDetails(item)}\n\t\t\t\t\t${this.#createEditDocumentBtn(item.id, item.uid)}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tDom.append(itemBlock, container);\n\t\t}\n\n\t\treturn container;\n\t}\n}\n"],"names":["buttonClassList","DocumentSummary","options","setEventNamespace","subscribeFromOptions","events","uid","itemDetails","items","documentObject","Object","keys","forEach","number","container","Tag","render","values","item","itemBlock","id","Dom","append","EventEmitter","title","Text","encode","button","target","externalId","Loc","getMessage","okButtonClassName","slice","join","discardButtonClassName","input","value","addClass","removeClass","shouldShow","summaryNode","closest","clean","replace","firstElementChild","observer","MutationObserver","isConnected","focus","disconnect","observe","document","body","childList","subtree","newValue","api","Api","modifyTitle","titleData","emit","blankTitle","console","error"],"mappings":"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"}