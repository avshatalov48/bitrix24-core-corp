{"version":3,"file":"document-summary.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Tag, Text, Dom, Loc } from 'main.core';\nimport { Api } from 'sign.v2.api';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\nimport './style.css';\n\nconst buttonClassList = [\n\t'ui-btn',\n\t'ui-btn-sm',\n\t'ui-btn-light-border',\n\t'ui-btn-round',\n];\n\ntype DocumentSummaryOptions = {\n\tevents?: {\n\t\t[key: string]: (event: BaseEvent) => void\n\t}\n};\n\nexport class DocumentSummary extends EventEmitter\n{\n\tuid: string;\n\ttitle: string;\n\t#blocks: Array<{ party: number; }>;\n\t#editDocumentBtn: HTMLElement;\n\t#number: string | null = null;\n\n\tconstructor(options: DocumentSummaryOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.DocumentSummary');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.#editDocumentBtn = Tag.render`\n\t\t\t<span\n\t\t\t\tclass=\"${buttonClassList.join(' ')}\"\n\t\t\t\tonclick=\"${() => this.emit('showEditor')}\"\n\t\t\t>\n\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SUMMARY_EDIT')}\n\t\t\t</span>\n\t\t`;\n\t}\n\n\t#createDocumentDetails(): HTMLElement\n\t{\n\t\tconst title = Text.encode(this.title ?? '');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-summary__details\">\n\t\t\t\t<div class=\"sign-document-summary__details_title\">\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"sign-document-summary__details_title-text\"\n\t\t\t\t\t\ttitle=\"${title}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${title}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"sign-document-summary__details_edit-title-btn\"\n\t\t\t\t\t\tonclick=\"${({ target: button }) => {\n\t\t\t\t\t\t\tthis.#toggleTitleEditor(button, true);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t${this.#createNumber()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createNumber(): ?HTMLElement\n\t{\n\t\tif (!this.#number)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst title = Loc.getMessage('SIGN_DOCUMENT_SUMMARY_REG_NUMBER', {\n\t\t\t'#NUMBER#': Text.encode(this.#number),\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-summary__reg_number\" title=\"${title}\">\n\t\t\t\t${title}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createTitleEditor(): HTMLElement\n\t{\n\t\tconst okButtonClassName = [\n\t\t\t...buttonClassList.slice(0, 2),\n\t\t\t'ui-btn-primary',\n\t\t\t'sign-document-summary__title-editor_ok-btn',\n\t\t].join(' ');\n\t\tconst discardButtonClassName = [\n\t\t\t...buttonClassList.slice(0, 3),\n\t\t\t'sign-document-summary__title-editor_discard-btn',\n\t\t].join(' ');\n\t\tconst input = Tag.render`<input type=\"text\" class=\"ui-ctl-element\" maxlength=\"255\" />`;\n\t\tinput.value = this.title ?? '';\n\t\tthis.#focusInput(input);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-summary__title-editor\">\n\t\t\t\t<div class=\"sign-document-summary__title-editor_controls\">\n\t\t\t\t\t<span class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t${input}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"${okButtonClassName}\"\n\t\t\t\t\t\tonclick=\"${async ({ target }) => {\n\t\t\t\t\t\t\tDom.addClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\tawait this.#modifyDocumentTitle(input.value);\n\t\t\t\t\t\t\tDom.removeClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\tthis.#toggleTitleEditor(target, false);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"${discardButtonClassName}\"\n\t\t\t\t\t\tonclick=\"${({ target }) => {\n\t\t\t\t\t\t\tthis.#toggleTitleEditor(target, false);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<p class=\"sign-document-summary__title-editor_help\">\n\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SUMMARY_TITLE_EDITOR_HELP')}\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#toggleTitleEditor(button: HTMLElement, shouldShow: boolean)\n\t{\n\t\tconst summaryNode = button.closest('.sign-document-summary');\n\t\tif (shouldShow)\n\t\t{\n\t\t\tDom.clean(summaryNode);\n\t\t\tDom.append(this.#createTitleEditor(), summaryNode);\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.replace(summaryNode.firstElementChild, this.#createDocumentDetails());\n\t\tDom.append(this.#editDocumentBtn, summaryNode);\n\t}\n\n\t#focusInput(input: HTMLElement)\n\t{\n\t\tconst observer = new MutationObserver(() => {\n\t\t\tif (input.isConnected)\n\t\t\t{\n\t\t\t\tinput.focus();\n\t\t\t\tobserver.disconnect();\n\t\t\t}\n\t\t});\n\t\tobserver.observe(document.body, { childList: true, subtree: true });\n\t}\n\n\tasync #modifyDocumentTitle(newValue: string)\n\t{\n\t\tif (this.title === newValue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst api = new Api();\n\t\t\tconst titleData = await api.modifyTitle(this.uid, newValue);\n\t\t\tthis.title = newValue;\n\t\t\tthis.emit('changeTitle', { title: newValue, blankTitle: titleData.blankTitle });\n\t\t}\n\t\tcatch (ex)\n\t\t{\n\t\t\tconsole.error(ex);\n\t\t}\n\t}\n\n\tset blocks(blocks: Array<{ party: number; }>)\n\t{\n\t\tthis.#blocks = blocks;\n\t\tthis.emit('reloadEntities');\n\t}\n\n\tsetNumber(number: ?string): void\n\t{\n\t\tthis.#number = number;\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-summary\">\n\t\t\t\t${this.#createDocumentDetails()}\n\t\t\t\t${this.#editDocumentBtn}\n\t\t\t</div>\n\t\t`;\n\t}\n}\n"],"names":["buttonClassList","DocumentSummary","options","setEventNamespace","subscribeFromOptions","events","Tag","render","join","emit","Loc","getMessage","number","blocks","EventEmitter","title","Text","encode","button","target","okButtonClassName","slice","discardButtonClassName","input","value","Dom","addClass","removeClass","shouldShow","summaryNode","closest","clean","append","replace","firstElementChild","observer","MutationObserver","isConnected","focus","disconnect","observe","document","body","childList","subtree","newValue","api","Api","modifyTitle","uid","titleData","blankTitle","console","error"],"mappings":";;;;;;;;CACA;CAAA;CAAA;CAAA;AADA,CAKA,IAAMA,eAAe,GAAG,CACvB,QAAQ,EACR,WAAW,EACX,qBAAqB,EACrB,cAAc,CACd;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAQF,KAAaC,eAAe;GAAA;GAQ3B,2BACA;KAAA;KAAA,IADYC,OAA+B,uEAAG,EAAE;KAAA;KAE/C;KAAQ;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAJgB;;KAKxB,MAAKC,iBAAiB,CAAC,4BAA4B,CAAC;KACpD,MAAKC,oBAAoB,CAACF,OAAO,CAACG,MAAM,CAAC;KACzC,+FAAwBC,aAAG,CAACC,MAAM,6LAEvBP,eAAe,CAACQ,IAAI,CAAC,GAAG,CAAC,EACvB;OAAA,OAAM,MAAKC,IAAI,CAAC,YAAY,CAAC;QAEtCC,aAAG,CAACC,UAAU,CAAC,4BAA4B,CAAC;KAE9C;;GACF;KAAA;KAAA,0BAiJSC,MAAe,EACzB;OACC,sCAAI,WAAWA,MAAM;;;KACrB;KAAA,4BAGD;OACC,OAAON,aAAG,CAACC,MAAM,wMAEb,IAAI,wDAAJ,IAAI,qCACJ,IAAI;;;KAGR;KAAA,kBAnBUM,MAAiC,EAC5C;OACC,sCAAI,WAAWA,MAAM;OACrB,IAAI,CAACJ,IAAI,CAAC,gBAAgB,CAAC;;;GAC3B;CAAA,EApKmCK,6BAAY;CAoLhD,mCA5JA;GAAA;KAAA;GACC,IAAMC,KAAK,GAAGC,cAAI,CAACC,MAAM,gBAAC,IAAI,CAACF,KAAK,qDAAI,EAAE,CAAC;GAE3C,OAAOT,aAAG,CAACC,MAAM,8iBAKJQ,KAAK,EAEZA,KAAK,EAII,gBAAwB;KAAA,IAAbG,MAAM,QAAdC,MAAM;KACnB,6BAAI,gDAAJ,MAAI,EAAoBD,MAAM,EAAE,IAAI;IACpC,yBAID,IAAI,sCAAJ,IAAI;CAGT;CAAC,0BAGD;GACC,IAAI,mCAAC,IAAI,UAAQ,EACjB;KACC,OAAO,IAAI;;GAGZ,IAAMH,KAAK,GAAGL,aAAG,CAACC,UAAU,CAAC,kCAAkC,EAAE;KAChE,UAAU,EAAEK,cAAI,CAACC,MAAM,mCAAC,IAAI;IAC5B,CAAC;GAEF,OAAOX,aAAG,CAACC,MAAM,8LACwCQ,KAAK,EAC1DA,KAAK;CAGV;CAAC,+BAGD;GAAA;KAAA;GACC,IAAMK,iBAAiB,GAAG,yCACtBpB,eAAe,CAACqB,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,IAC9B,gBAAgB,EAChB,4CAA4C,GAC3Cb,IAAI,CAAC,GAAG,CAAC;GACX,IAAMc,sBAAsB,GAAG,yCAC3BtB,eAAe,CAACqB,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,IAC9B,iDAAiD,GAChDb,IAAI,CAAC,GAAG,CAAC;GACX,IAAMe,KAAK,GAAGjB,aAAG,CAACC,MAAM,qJAA8D;GACtFgB,KAAK,CAACC,KAAK,mBAAG,IAAI,CAACT,KAAK,uDAAI,EAAE;GAC9B,2BAAI,kCAAJ,IAAI,EAAaQ,KAAK;GAEtB,OAAOjB,aAAG,CAACC,MAAM,gpBAIXgB,KAAK,EAGEH,iBAAiB;KAAA,mFACf;OAAA;OAAA;SAAA;WAAA;aAASD,MAAM,SAANA,MAAM;aACzBM,aAAG,CAACC,QAAQ,CAACP,MAAM,EAAE,aAAa,CAAC;aAAC;aAAA,8BAC9B,MAAI,oDAAJ,MAAI,EAAsBI,KAAK,CAACC,KAAK;WAAA;aAC3CC,aAAG,CAACE,WAAW,CAACR,MAAM,EAAE,aAAa,CAAC;aACtC,6BAAI,gDAAJ,MAAI,EAAoBA,MAAM,EAAE,KAAK;WAAE;WAAA;aAAA;;;MACvC;KAAA;OAAA;;QAIQG,sBAAsB,EACpB,iBAAgB;KAAA,IAAbH,MAAM,SAANA,MAAM;KACnB,6BAAI,gDAAJ,MAAI,EAAoBA,MAAM,EAAE,KAAK;IACrC,EAKAT,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;CAI/D;CAAC,6BAEkBO,MAAmB,EAAEU,UAAmB,EAC3D;GACC,IAAMC,WAAW,GAAGX,MAAM,CAACY,OAAO,CAAC,wBAAwB,CAAC;GAC5D,IAAIF,UAAU,EACd;KACCH,aAAG,CAACM,KAAK,CAACF,WAAW,CAAC;KACtBJ,aAAG,CAACO,MAAM,wBAAC,IAAI,gDAAJ,IAAI,GAAuBH,WAAW,CAAC;KAElD;;GAGDJ,aAAG,CAACQ,OAAO,CAACJ,WAAW,CAACK,iBAAiB,yBAAE,IAAI,wDAAJ,IAAI,EAA0B;GACzET,aAAG,CAACO,MAAM,mCAAC,IAAI,qBAAmBH,WAAW,CAAC;CAC/C;CAAC,sBAEWN,KAAkB,EAC9B;GACC,IAAMY,QAAQ,GAAG,IAAIC,gBAAgB,CAAC,YAAM;KAC3C,IAAIb,KAAK,CAACc,WAAW,EACrB;OACCd,KAAK,CAACe,KAAK,EAAE;OACbH,QAAQ,CAACI,UAAU,EAAE;;IAEtB,CAAC;GACFJ,QAAQ,CAACK,OAAO,CAACC,QAAQ,CAACC,IAAI,EAAE;KAAEC,SAAS,EAAE,IAAI;KAAEC,OAAO,EAAE;IAAM,CAAC;CACpE;CAAC;GAAA;CAAA;CAAA;GAAA,iHAE0BC,QAAgB;KAAA;KAAA;OAAA;SAAA;WAAA,MAEtC,IAAI,CAAC9B,KAAK,KAAK8B,QAAQ;aAAA;aAAA;;WAAA;SAAA;WAAA;WAOpBC,GAAG,GAAG,IAAIC,eAAG,EAAE;WAAA;WAAA,OACGD,GAAG,CAACE,WAAW,CAAC,IAAI,CAACC,GAAG,EAAEJ,QAAQ,CAAC;SAAA;WAArDK,SAAS;WACf,IAAI,CAACnC,KAAK,GAAG8B,QAAQ;WACrB,IAAI,CAACpC,IAAI,CAAC,aAAa,EAAE;aAAEM,KAAK,EAAE8B,QAAQ;aAAEM,UAAU,EAAED,SAAS,CAACC;YAAY,CAAC;WAAC;WAAA;SAAA;WAAA;WAAA;WAIhFC,OAAO,CAACC,KAAK,cAAI;SAAC;SAAA;WAAA;;;;GAAA;CAAA;;;;;;;;"}