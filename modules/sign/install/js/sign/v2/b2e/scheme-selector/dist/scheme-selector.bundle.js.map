{"version":3,"file":"scheme-selector.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Loc, Tag, Text, Dom, Type } from 'main.core';\nimport './style.css';\nimport { Api } from 'sign.v2.api';\n\nexport type Scheme = 'order' | 'default';\nexport const SchemeType: Readonly<Record<string, Scheme | 'unset'>> = Object.freeze({\n\tOrder: 'order',\n\tDefault: 'default',\n\tUnset: 'unset',\n});\n\nexport class SchemeSelector\n{\n\t#ui = {\n\t\tcontainer: HTMLElement = null,\n\t\tselect: HTMLSelectElement = null,\n\t};\n\n\t#selectedType: string = SchemeType.Unset;\n\t#availableSchemes: Array<string> = [];\n\n\t#api = new Api();\n\n\tgetLayout(): HTMLElement\n\t{\n\t\tif (this.#ui.container)\n\t\t{\n\t\t\treturn this.#ui.container\n\t\t}\n\n\t\tthis.#ui.select = Tag.render`\n\t\t\t<select\n\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\tonchange=\"${({ target: select }) => {\n\t\t\t\t\tthis.#selectItem(select.options[select.selectedIndex].value);\n\t\t\t\t}}\"\n\t\t\t>\n\t\t`;\n\n\t\tthis.#ui.container = Tag.render`\n\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown sign-b2e-scheme-selector__dropdown\">\n\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t${this.#ui.select}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#ui.container;\n\t}\n\n\tvalidate(): boolean\n\t{\n\t\tDom.removeClass(this.#ui.container, '--invalid');\n\t\tconst result = this.#selectedType !== SchemeType.Unset;\n\t\tif (!result)\n\t\t{\n\t\t\tDom.addClass(this.#ui.container, '--invalid');\n\t\t}\n\n\t\treturn this.#selectedType !== SchemeType.Unset;\n\t}\n\n\tasync save(documentId: string): Promise<void>\n\t{\n\t\tawait this.#api.modifyB2eDocumentScheme(documentId, this.#selectedType);\n\t}\n\n\tasync load(documentId: string): Promise<void>\n\t{\n\t\tconst { schemes } = await this.#api.loadB2eAvaialbleSchemes(documentId);\n\t\tconst filteredSchemes = schemes.filter((scheme: string) => this.#isValidScheme(scheme));\n\t\tif (!Type.isArrayFilled(filteredSchemes))\n\t\t{\n\t\t\tthis.#selectItem(SchemeType.Unset);\n\t\t}\n\n\t\tthis.#availableSchemes = filteredSchemes;\n\t\tthis.#renderSelectOptions();\n\n\t\tthis.#selectItem(this.#availableSchemes[0]);\n\t}\n\n\n\tgetSelectedType(): string\n\t{\n\t\treturn this.#selectedType;\n\t}\n\n\t#renderSelectOptions(): void\n\t{\n\t\tthis.#ui.select.innerHTML = '';\n\n\t\tconst optionElements = this.#getAvailableSchemes().map(\n\t\t\t(option: { value: string, text: string }) =>\n\t\t\t\tTag.render`\n\t\t\t\t\t<option value=\"${option.value}\">\n\t\t\t\t\t\t${Text.encode(option.text)}\n\t\t\t\t\t</option>\n\t\t\t\t`\n\t\t);\n\n\t\toptionElements.forEach((element: HTMLElement) => Dom.append(element, this.#ui.select));\n\t\tthis.#ui.select.selectedIndex = optionElements.length > 0 ? 1 : 0;\n\t}\n\n\t#getSchemeOptions(): [{ value: string, text: string }]\n\t{\n\t\treturn [\n\t\t\t{ value: SchemeType.Unset, text: Loc.getMessage('SIGN_V2_B2E_SCHEME_SELECTOR_VALUE_TYPE_UNSET') },\n\t\t\t{ value: SchemeType.Default, text: Loc.getMessage('SIGN_V2_B2E_SCHEME_SELECTOR_VALUE_TYPE_DEFAULT') },\n\t\t\t{ value: SchemeType.Order, text: Loc.getMessage('SIGN_V2_B2E_SCHEME_SELECTOR_VALUE_TYPE_ORDER') },\n\t\t];\n\t}\n\n\t#getAvailableSchemes(): [{ value : string, text: string }]\n\t{\n\t\treturn this.#getSchemeOptions().filter((schemeOption: { value: string, text: string }) => {\n\t\t\treturn this.#availableSchemes.includes(schemeOption.value) || schemeOption.value === SchemeType.Unset;\n\t\t});\n\t}\n\n\t#isValidScheme(scheme: string): boolean\n\t{\n\t\treturn Object.values(SchemeType).includes(scheme);\n\t}\n\n\t#selectItem(value: string): void\n\t{\n\t\tif (!this.#isValidScheme(value))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#selectedType = value;\n\t}\n}"],"names":["SchemeType","Object","freeze","Order","Default","Unset","SchemeSelector","container","HTMLElement","select","HTMLSelectElement","Api","getLayout","Tag","render","target","options","selectedIndex","value","validate","Dom","removeClass","result","addClass","save","documentId","modifyB2eDocumentScheme","load","schemes","loadB2eAvaialbleSchemes","filteredSchemes","filter","scheme","Type","isArrayFilled","getSelectedType","innerHTML","optionElements","map","option","Text","encode","text","forEach","element","append","length","Loc","getMessage","schemeOption","includes","values"],"mappings":"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"}