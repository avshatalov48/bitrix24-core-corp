{"version":3,"file":"hcm-link-mapping.bundle.js","sources":["../src/hcm-link-mapping.js"],"sourcesContent":["import { Tag, Type, Loc, Dom, Event } from 'main.core';\nimport { Loader } from 'main.loader';\nimport { EventEmitter } from 'main.core.events';\nimport { Mapper } from 'humanresources.hcmlink.data-mapper';\nimport type { Api } from 'signproxy.signing.api';\nimport type { HrmLinkOptions } from './type';\n\nimport './style.css';\n\nexport class HcmLinkMapping extends EventEmitter\n{\n\t#api: Api;\n\n\t#documentUid: string | null = null;\n\t#integrationId: number | null = null;\n\t#employeeIds: Array<number> = [];\n\n\t#container: HTMLElement | null = null;\n\t#linkText: HTMLElement | null = null;\n\t#loaderContainer: HTMLElement | null = null;\n\t#loader: Loader | null = null;\n\n\t#isValid: boolean = false;\n\n\t#enabled: boolean = false;\n\n\tconstructor(options: HrmLinkOptions)\n\t{\n\t\tsuper();\n\t\tthis.#api = options.api;\n\n\t\tthis.setEventNamespace('BX.Sign.V2.B2e.HcmLinkMapping');\n\n\t\tthis.#container = this.render();\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.#container)\n\t\t{\n\t\t\treturn this.#container;\n\t\t}\n\n\t\tconst { root, loaderContainer } = Tag.render`\n\t\t\t<div class=\"sign-b2e-hcm-link-mapping-container\">\n\t\t\t\t<div \n\t\t\t\t\tclass=\"sign-b2e-hcm-link-mapping-loader\"\n\t\t\t\t\tref=\"loaderContainer\"\n\t\t\t\t></div>\n\t\t\t\t${this.#getText()}\n\t\t\t</div>\n\t\t`;\n\t\tthis.#container = root;\n\t\tthis.#loaderContainer = loaderContainer;\n\t\tthis.#hide();\n\n\t\treturn this.#container;\n\t}\n\n\tsetEnabled(value: boolean): void\n\t{\n\t\tthis.#enabled = value;\n\t}\n\n\tsetDocumentUid(uid: string): void\n\t{\n\t\tthis.#documentUid = uid;\n\t\tthis.#hide();\n\n\t\tif (this.#enabled)\n\t\t{\n\t\t\tthis.#refresh();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#setValid(true);\n\t\t}\n\t}\n\n\tasync #checkNotMapped(): Promise<boolean>\n\t{\n\t\tif (!Type.isStringFilled(this.#documentUid))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#showLoader();\n\t\tconst { integrationId, userIds } = await this.#api.checkNotMappedMembersHrIntegration(this.#documentUid);\n\n\t\tthis.#employeeIds = userIds;\n\t\tthis.#integrationId = integrationId;\n\n\t\tconst isAllMapped = !Type.isArrayFilled(this.#employeeIds);\n\t\tthis.#setValid(isAllMapped);\n\n\t\tif (isAllMapped)\n\t\t{\n\t\t\tthis.#hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#show();\n\t\t}\n\t}\n\n\t#refresh(): void\n\t{\n\t\tthis.#hide();\n\t\tthis.#setValid(false);\n\n\t\tvoid this.#checkNotMapped();\n\t}\n\n\t#getText(): HTMLElement\n\t{\n\t\tconst syncButton = Tag.render`\n\t\t\t<a class=\"sign-b2e-hcm-link-mapping-sync-button\">\n\t\t\t\t${Loc.getMessage('SIGN_V2_B2E_HCM_LINK_MAPPING_SYNC_BUTTON')}\n\t\t\t</a>\n\t\t`;\n\t\tEvent.bind(syncButton, 'click', () => { this.#openMapper(); });\n\n\t\tthis.#linkText = Tag.render`\n\t\t\t<div class=\"sign-b2e-hcm-link-mapping-text\">\n\t\t\t\t${Loc.getMessage('SIGN_V2_B2E_HCM_LINK_MAPPING_TEXT')}\n\t\t\t\t${syncButton}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#linkText;\n\t}\n\n\t#setValid(value: boolean): void\n\t{\n\t\tthis.#isValid = value;\n\t\tthis.emit('validUpdate', { value: this.#isValid });\n\t}\n\n\t#openMapper(): void\n\t{\n\t\tMapper.openSlider({\n\t\t\tcompanyId: this.#integrationId,\n\t\t\tuserIds: new Set(this.#employeeIds),\n\t\t\tmode: Mapper.MODE_DIRECT,\n\t\t}, {\n\t\t\tonCloseHandler: () => void this.#checkNotMapped(),\n\t\t});\n\t}\n\n\t#showLoader(): Loader\n\t{\n\t\tDom.hide(this.#linkText);\n\t\tvoid this.#getLoader().show(this.#loaderContainer);\n\t}\n\n\t#getLoader(): Loader\n\t{\n\t\tif (!this.#loader)\n\t\t{\n\t\t\tthis.#loader = new Loader({\n\t\t\t\tsize: 30,\n\t\t\t\tmode: 'inline',\n\t\t\t});\n\t\t}\n\n\t\treturn this.#loader;\n\t}\n\n\t#hide(): void\n\t{\n\t\tvoid this.#getLoader().destroy();\n\t\tDom.hide(this.#container);\n\t}\n\n\t#show(): void\n\t{\n\t\tvoid this.#getLoader().destroy();\n\t\tDom.show(this.#linkText);\n\t\tDom.show(this.#container);\n\t}\n}\n"],"names":["HcmLinkMapping","EventEmitter","constructor","options","api","setEventNamespace","render","root","loaderContainer","Tag","setEnabled","value","setDocumentUid","uid","Type","isStringFilled","integrationId","userIds","checkNotMappedMembersHrIntegration","isAllMapped","isArrayFilled","syncButton","Loc","getMessage","Event","bind","emit","Mapper","openSlider","companyId","Set","mode","MODE_DIRECT","onCloseHandler","Dom","hide","show","Loader","size","destroy"],"mappings":"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"}