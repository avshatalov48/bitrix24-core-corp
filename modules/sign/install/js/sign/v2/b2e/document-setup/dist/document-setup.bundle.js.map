{"version":3,"file":"document-setup.bundle.js","sources":["../src/date-selector.js","../src/index.js"],"sourcesContent":["import { Tag, Loc } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\n\nexport class DateSelector\n{\n\t#documentDateField: HTMLElement;\n\t#selectedDate: string;\n\n\tconstructor()\n\t{\n\t\tthis.#documentDateField = this.#getDateField();\n\t\tconst date = new Date();\n\t\tthis.#selectDate(date);\n\t\tthis.setDateInCalendar(date);\n\t}\n\n\t#formatDate(date: Date, formatType: string): string\n\t{\n\t\tconst template = DateTimeFormat.getFormat(formatType);\n\n\t\treturn DateTimeFormat.format(template, date);\n\t}\n\n\t#getDateField(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sign-b2e-document-setup__date-selector_field\"\n\t\t\t\tonclick=\"${() => {\n\t\t\t\t\tBX.calendar({\n\t\t\t\t\t\tnode: this.#documentDateField,\n\t\t\t\t\t\tfield: this.#documentDateField,\n\t\t\t\t\t\tbTime: false,\n\t\t\t\t\t\tcallback_after: (date) => {\n\t\t\t\t\t\t\tthis.#selectDate(date);\n\t\t\t\t\t\t\tthis.setDateInCalendar(date);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}}\"\n\t\t\t>\n\t\t\t\t<span class=\"sign-b2e-document-setup__date-selector_field-text\"></span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#selectDate(date: Date): void\n\t{\n\t\tconst formattedDate = this.#formatDate(date, 'SHORT_DATE_FORMAT');\n\t\tthis.#selectedDate = formattedDate;\n\t}\n\n\tsetDateInCalendar(date: Date): void\n\t{\n\t\tconst formattedDate = this.#formatDate(date, 'DAY_MONTH_FORMAT');\n\t\tconst dateTextNode = this.#documentDateField.firstElementChild;\n\t\tdateTextNode.textContent = formattedDate;\n\t\tdateTextNode.title = formattedDate;\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-b2e-document-setup__date-selector\">\n\t\t\t\t<span class=\"sign-b2e-document-setup__date-selector_label\">\n\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SETUP_DATE_LABEL')}\n\t\t\t\t</span>\n\t\t\t\t${this.#documentDateField}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetSelectedDate(): string\n\t{\n\t\treturn this.#selectedDate;\n\t}\n}\n","import { Dom, Loc, Tag, Type, Extension } from 'main.core';\nimport { Api } from 'sign.v2.api';\nimport { SignDropdown } from 'sign.v2.b2e.sign-dropdown';\nimport { type BlankSelectorConfig } from 'sign.v2.blank-selector';\nimport { DocumentInitiated, type DocumentInitiatedType, DocumentSetup as BaseDocumentSetup } from 'sign.v2.document-setup';\nimport { Helpdesk, Hint } from 'sign.v2.helper';\nimport type { DocumentModeType } from 'sign.v2.sign-settings';\nimport { isTemplateMode } from 'sign.v2.sign-settings';\nimport { DateSelector } from './date-selector';\nimport './style.css';\n\ntype RegionDocumentType = {\n\tcode: string,\n\tdescription: string,\n};\n\nconst HelpdeskCodes = Object.freeze({\n\tHowToWorkWithTemplates: '23174934',\n});\n\nexport class DocumentSetup extends BaseDocumentSetup\n{\n\t#api: Api;\n\t#region: string;\n\t#regionDocumentTypes: Array<RegionDocumentType>;\n\t#senderDocumentTypes: DocumentInitiatedType[];\n\t#documentTypeDropdown: HTMLElement;\n\t#documentSenderTypeDropdown: HTMLElement;\n\t#documentNumberInput: HTMLInputElement | null = null;\n\t#documentTitleInput: HTMLInputElement;\n\t#dateSelector: DateSelector | null = null;\n\t#documentMode: DocumentModeType;\n\n\tconstructor(blankSelectorConfig: BlankSelectorConfig)\n\t{\n\t\tsuper(blankSelectorConfig);\n\t\tconst { region, regionDocumentTypes, documentMode } = blankSelectorConfig;\n\t\tthis.#api = new Api();\n\t\tthis.#region = region;\n\t\tthis.#documentMode = documentMode;\n\t\tthis.#regionDocumentTypes = regionDocumentTypes;\n\t\tthis.#senderDocumentTypes = Object.values(DocumentInitiated);\n\t\tthis.#documentTitleInput = Tag.render`\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\tmaxlength=\"255\"\n\t\t\t\toninput=\"${({ target }) => this.setDocumentTitle(target.value)}\"\n\t\t\t/>\n\t\t`;\n\t\tif (this.#isRuRegion() && !isTemplateMode(documentMode))\n\t\t{\n\t\t\tthis.#documentNumberInput = Tag.render`<input type=\"text\" class=\"ui-ctl-element\" maxlength=\"255\" />`;\n\t\t\tthis.#dateSelector = new DateSelector();\n\t\t}\n\n\t\tthis.blankSelector.subscribe('toggleSelection', ({ data }) => {\n\t\t\tthis.setDocumentTitle(data.title);\n\t\t});\n\t\tthis.blankSelector.subscribe('addFile', ({ data }) => {\n\t\t\tthis.setDocumentTitle(data.title);\n\t\t});\n\t\tthis.#init();\n\t}\n\n\t#init(): void\n\t{\n\t\tthis.#initDocumentType();\n\t\tthis.#initDocumentSenderType();\n\t\tconst documentTypeLayout = this.#getDocumentTypeLayout();\n\t\tconst title = this.isTemplateMode()\n\t\t\t? Loc.getMessage('SIGN_DOCUMENT_SETUP_TITLE_TEMPLATE_HEAD_LABEL')\n\t\t\t: Loc.getMessage('SIGN_DOCUMENT_SETUP_TITLE_HEAD_LABEL');\n\n\t\tconst titleLayout = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${title}\n\t\t\t\t</p>\n\t\t\t\t${this.#getDocumentTitleLayout()}\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.append(documentTypeLayout, this.layout);\n\t\tDom.append(this.#getDocumentSenderTypeLayout(), this.layout);\n\t\tDom.append(titleLayout, this.layout);\n\t\tHint.create(this.layout);\n\t}\n\n\t#isDocumentTypeVisible(): boolean\n\t{\n\t\treturn this.#regionDocumentTypes?.length;\n\t}\n\n\t#isRuRegion(): boolean\n\t{\n\t\treturn this.#region === 'ru';\n\t}\n\n\t#initDocumentType(): void\n\t{\n\t\tif (!this.#isDocumentTypeVisible())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#documentTypeDropdown = new SignDropdown({\n\t\t\ttabs: [{ id: 'b2e-document-codes', title: ' ' }],\n\t\t\tentities: [\n\t\t\t\t{ id: 'b2e-document-code', searchFields: [{ name: 'caption', system: true }] },\n\t\t\t],\n\t\t\tclassName: 'sign-b2e-document-setup__type-selector',\n\t\t\twithCaption: true,\n\t\t\tisEnableSearch: true,\n\t\t});\n\t\tthis.#regionDocumentTypes.forEach((item) => {\n\t\t\tif (Type.isPlainObject(item)\n\t\t\t\t&& Type.isStringFilled(item.code)\n\t\t\t\t&& Type.isStringFilled(item.description))\n\t\t\t{\n\t\t\t\tconst { code, description } = item;\n\t\t\t\tthis.#documentTypeDropdown.addItem({\n\t\t\t\t\tid: code,\n\t\t\t\t\ttitle: code,\n\t\t\t\t\tcaption: `(${description})`,\n\t\t\t\t\tentityId: 'b2e-document-code',\n\t\t\t\t\ttabs: 'b2e-document-codes',\n\t\t\t\t\tdeselectable: false,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis.#documentTypeDropdown.selectItem(this.#regionDocumentTypes[0].code);\n\t}\n\n\t#getDocumentTypeLayout(): HTMLElement | null\n\t{\n\t\tif (!this.#isDocumentTypeVisible())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t<span>${Loc.getMessage('SIGN_DOCUMENT_SETUP_TYPE')}</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tdata-hint=\"${Loc.getMessage('SIGN_DOCUMENT_SETUP_TYPE_HINT')}\"\n\t\t\t\t\t></span>\n\t\t\t\t</p>\n\t\t\t\t${this.#documentTypeDropdown.getLayout()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#initDocumentSenderType(): void\n\t{\n\t\tif (!this.isTemplateMode() || !this.isSenderTypeAvailable())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#documentSenderTypeDropdown = new SignDropdown({\n\t\t\ttabs: [{ id: 'b2e-document-sender-types', title: ' ' }],\n\t\t\tentities: [\n\t\t\t\t{ id: 'b2e-document-sender-type', searchFields: [{ name: 'caption', system: true }] },\n\t\t\t],\n\t\t\tclassName: 'sign-b2e-document-setup__sender-type-selector',\n\t\t\twithCaption: true,\n\t\t\tisEnableSearch: false,\n\t\t});\n\t\tthis.#senderDocumentTypes.forEach((item) => {\n\t\t\tif (Type.isStringFilled(item))\n\t\t\t{\n\t\t\t\tconst langPhraseCode = `SIGN_DOCUMENT_SETUP_SENDER_TYPE_${item.toUpperCase()}`;\n\t\t\t\tthis.#documentSenderTypeDropdown.addItem({\n\t\t\t\t\tid: item,\n\t\t\t\t\ttitle: Loc.getMessage(langPhraseCode),\n\t\t\t\t\tentityId: 'b2e-document-sender-type',\n\t\t\t\t\ttabs: 'b2e-document-sender-types',\n\t\t\t\t\tdeselectable: false,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis.#documentSenderTypeDropdown.selectItem(this.#senderDocumentTypes[0]);\n\t}\n\n\t#getDocumentSenderTypeLayout(): HTMLElement | null\n\t{\n\t\tif (!this.isTemplateMode() || !this.isSenderTypeAvailable())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t<span>${Loc.getMessage('SIGN_DOCUMENT_SETUP_SENDER_TYPE_TITLE')}</span>\n\t\t\t\t</p>\n\t\t\t\t${this.#documentSenderTypeDropdown.getLayout()}\n\t\t\t\t${this.#getHelpLink()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getHelpLink(): HTMLElement\n\t{\n\t\treturn Helpdesk.replaceLink(\n\t\t\tLoc.getMessage('SIGN_DOCUMENT_SETUP_SENDER_TYPE_HELP_LINK'),\n\t\t\tHelpdeskCodes.HowToWorkWithTemplates,\n\t\t\t'detail',\n\t\t\t['ui-link'],\n\t\t);\n\t}\n\n\t#getDocumentNumberLayout(): HTMLElement | null\n\t{\n\t\tif (!this.#isRuRegion() || this.isTemplateMode())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-b2e-document-setup__title-item --num\">\n\t\t\t\t<p class=\"sign-b2e-document-setup__title-text\">\n\t\t\t\t\t<span>${Loc.getMessage('SIGN_DOCUMENT_SETUP_NUM_LABEL')}</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tdata-hint=\"${Loc.getMessage('SIGN_DOCUMENT_SETUP_NUM_LABEL_HINT')}\"\n\t\t\t\t\t></span>\n\t\t\t\t</p>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox\">\n\t\t\t\t\t${this.#documentNumberInput}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getDocumentTitleLayout(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"sign-b2e-document-setup__title-item ${this.#getDocumentTitleFullClass()}\">\n\t\t\t\t\t<p class=\"sign-b2e-document-setup__title-text\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SETUP_TITLE_LABEL')}\n\t\t\t\t\t</p>\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox\">\n\t\t\t\t\t\t${this.#documentTitleInput}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t${this.#getDocumentNumberLayout()}\n\t\t\t\t${this.#getDocumentHintLayout()}\n\t\t\t\t${this.#dateSelector?.getLayout()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getDocumentHintLayout(): HTMLElement | null\n\t{\n\t\tif (this.isTemplateMode())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<p class=\"sign-b2e-document-setup__title-text\">\n\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SETUP_TITLE_HINT')}\n\t\t\t</p>\n\t\t`;\n\t}\n\n\t#getDocumentTitleFullClass(): string\n\t{\n\t\tif (this.isTemplateMode())\n\t\t{\n\t\t\treturn '--full';\n\t\t}\n\n\t\treturn this.#isRuRegion() ? '' : '--full';\n\t}\n\n\t#sendDocumentType(uid: string): Promise<void>\n\t{\n\t\tif (!this.#isDocumentTypeVisible())\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst type = this.#documentTypeDropdown.getSelectedId();\n\n\t\treturn this.#api.changeRegionDocumentType(uid, type);\n\t}\n\n\t#sendDocumentSenderType(uid: string): Promise<void>\n\t{\n\t\tif (!this.isTemplateMode() || !this.isSenderTypeAvailable())\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst senderType = this.#documentSenderTypeDropdown.getSelectedId();\n\t\tthis.setupData.initiatedByType = senderType;\n\n\t\treturn this.#api.changeSenderDocumentType(uid, senderType);\n\t}\n\n\t#sendDocumentNumber(uid: string): Promise<void>\n\t{\n\t\tif (!this.#isRuRegion() || this.isTemplateMode())\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn this.#api.changeExternalId(uid, this.#documentNumberInput.value);\n\t}\n\n\t#sendDocumentDate(uid: string): Promise<void>\n\t{\n\t\tif (!this.#isRuRegion() || this.isTemplateMode())\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn this.#api.changeExternalDate(uid, this.#dateSelector.getSelectedDate());\n\t}\n\n\t#setDocumentNumber(number: string): void\n\t{\n\t\tthis.#documentNumberInput.value = number;\n\t}\n\n\tsetDocumentTitle(title: string = ''): void\n\t{\n\t\tthis.#documentTitleInput.value = title;\n\t\tthis.#documentTitleInput.title = title;\n\t}\n\n\tsetDocumentType(regionDocumentType: string = ''): void\n\t{\n\t\tif (!this.#isDocumentTypeVisible())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isDocumentTypeExist = this.#regionDocumentTypes.some((item) => item.code === regionDocumentType);\n\t\tconst documentType = isDocumentTypeExist ? regionDocumentType : this.#regionDocumentTypes[0].code;\n\n\t\tthis.#documentTypeDropdown.selectItem(documentType);\n\t}\n\n\tsetDocumentSenderType(initiatedByType: string): void\n\t{\n\t\tif (!this.isTemplateMode() || !this.isSenderTypeAvailable())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst senderType = this.#senderDocumentTypes.includes(initiatedByType) ? initiatedByType : 'employee';\n\t\tthis.#documentSenderTypeDropdown.selectItem(senderType);\n\t}\n\n\tinitLayout(): void\n\t{\n\t\tconst headerText = this.isTemplateMode()\n\t\t\t? Loc.getMessage('SIGN_DOCUMENT_SETUP_TEMPLATE_HEADER')\n\t\t\t: Loc.getMessage('SIGN_DOCUMENT_SETUP_HEADER')\n\t\t;\n\t\tconst itemTitleText = this.isTemplateMode()\n\t\t\t? Loc.getMessage('SIGN_DOCUMENT_SETUP_ADD_TEMPLATE_TITLE')\n\t\t\t: Loc.getMessage('SIGN_DOCUMENT_SETUP_ADD_TITLE')\n\t\t;\n\t\tthis.layout = Tag.render`\n\t\t\t<div class=\"sign-document-setup\">\n\t\t\t\t<h1 class=\"sign-b2e-settings__header\">${headerText}</h1>\n\t\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t\t${itemTitleText}\n\t\t\t\t\t</p>\n\t\t\t\t\t${this.blankSelector.getLayout()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tasync setup(uid: ?string): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tawait super.setup(uid, this.isTemplateMode());\n\t\t\tif (!this.setupData)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (uid)\n\t\t\t{\n\t\t\t\tconst { title, externalId, externalDateCreate, initiatedByType, regionDocumentType } = this.setupData;\n\t\t\t\tthis.setDocumentTitle(title);\n\t\t\t\tthis.setDocumentSenderType(initiatedByType);\n\t\t\t\tthis.setDocumentType(regionDocumentType);\n\n\t\t\t\tif (this.#isRuRegion() && !this.isTemplateMode())\n\t\t\t\t{\n\t\t\t\t\tthis.#setDocumentNumber(externalId);\n\t\t\t\t\tthis.#dateSelector.setDateInCalendar(new Date(externalDateCreate));\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { uid: documentUid, templateUid } = this.setupData;\n\t\t\tconst { value: title } = this.#documentTitleInput;\n\t\t\tconst externalId = this.#documentNumberInput?.value;\n\t\t\tthis.ready = false;\n\t\t\tawait Promise.all([\n\t\t\t\tthis.#sendDocumentType(documentUid),\n\t\t\t\tthis.#sendDocumentSenderType(documentUid),\n\t\t\t\tthis.#sendDocumentNumber(documentUid),\n\t\t\t\tthis.#sendDocumentDate(documentUid),\n\t\t\t]);\n\n\t\t\tconst modifyDocumentTitleResponse = await this.#api.modifyTitle(documentUid, title);\n\t\t\tconst { blankTitle } = modifyDocumentTitleResponse;\n\t\t\tif (blankTitle)\n\t\t\t{\n\t\t\t\tconst { blankId } = this.setupData;\n\t\t\t\tthis.blankSelector.modifyBlankTitle(blankId, blankTitle);\n\t\t\t}\n\n\t\t\tthis.setupData = { ...this.setupData, title, externalId, templateUid };\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tconst { blankId } = this.setupData;\n\t\t\tthis.handleError(blankId);\n\t\t}\n\n\t\tthis.ready = true;\n\t}\n\n\t#validateInput(input: HTMLElement): boolean\n\t{\n\t\tif (!input)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst { parentNode, value } = input;\n\t\tif (value.trim() !== '')\n\t\t{\n\t\t\tDom.removeClass(parentNode, 'ui-ctl-warning');\n\n\t\t\treturn true;\n\t\t}\n\n\t\tDom.addClass(parentNode, 'ui-ctl-warning');\n\t\tinput.focus();\n\n\t\treturn false;\n\t}\n\n\tvalidate(): boolean\n\t{\n\t\tconst isValidTitle = this.#validateInput(this.#documentTitleInput);\n\t\tconst isValidNumber = this.#validateInput(this.#documentNumberInput);\n\n\t\treturn isValidTitle && isValidNumber;\n\t}\n\n\tisSenderTypeAvailable(): boolean\n\t{\n\t\tconst settings = Extension.getSettings('sign.v2.b2e.document-setup');\n\n\t\treturn settings.get('isSenderTypeAvailable');\n\t}\n}\n"],"names":["DateSelector","constructor","date","Date","setDateInCalendar","formattedDate","dateTextNode","firstElementChild","textContent","title","getLayout","Tag","render","Loc","getMessage","getSelectedDate","formatType","template","DateTimeFormat","getFormat","format","BX","calendar","node","field","bTime","callback_after","HelpdeskCodes","Object","freeze","HowToWorkWithTemplates","DocumentSetup","BaseDocumentSetup","blankSelectorConfig","region","regionDocumentTypes","documentMode","Api","values","DocumentInitiated","target","setDocumentTitle","value","isTemplateMode","blankSelector","subscribe","data","setDocumentType","regionDocumentType","isDocumentTypeExist","some","item","code","documentType","selectItem","setDocumentSenderType","initiatedByType","isSenderTypeAvailable","senderType","includes","initLayout","headerText","itemTitleText","layout","setup","uid","setupData","externalId","externalDateCreate","documentUid","templateUid","ready","Promise","all","modifyDocumentTitleResponse","modifyTitle","blankTitle","blankId","modifyBlankTitle","handleError","validate","isValidTitle","isValidNumber","settings","Extension","getSettings","get","documentTypeLayout","titleLayout","Dom","append","Hint","create","length","SignDropdown","tabs","id","entities","searchFields","name","system","className","withCaption","isEnableSearch","forEach","Type","isPlainObject","isStringFilled","description","addItem","caption","entityId","deselectable","langPhraseCode","toUpperCase","Helpdesk","replaceLink","resolve","type","getSelectedId","changeRegionDocumentType","changeSenderDocumentType","changeExternalId","changeExternalDate","number","input","parentNode","trim","removeClass","addClass","focus"],"mappings":"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"}