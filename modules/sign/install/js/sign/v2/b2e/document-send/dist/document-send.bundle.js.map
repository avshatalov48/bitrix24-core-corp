{"version":3,"file":"document-send.bundle.js","sources":["../src/item.js","../src/index.js"],"sourcesContent":["import { Tag, Type, Dom, Loc, Text as TextFormat } from 'main.core';\nimport { Loader } from 'main.loader';\nimport type { MemberRoleType } from 'sign.type';\nimport { Dialog } from 'ui.entity-selector';\nimport { Api } from 'sign.v2.api';\n\nexport type ItemData = {\n\tentityType: string,\n\tentityId: number,\n\trole?: MemberRoleType,\n};\n\ntype ItemViewData = {\n\theader: string,\n\tfooter: string,\n\tavatar: ?string,\n};\n\nexport const EntityTypes = Object.freeze({\n\tUser: 'user',\n\tCompany: 'company'\n});\n\nexport class Item\n{\n\t#api: Api;\n\t#ui = {\n\t\tcontainer: HTMLDivElement = null,\n\t\tavatar: HTMLDivElement = null,\n\t\ttitle: {\n\t\t\tcontainer: HTMLDivElement = null,\n\t\t\theader: HTMLDivElement = null,\n\t\t\tfooter: HTMLDivElement = null,\n\t\t}\n\t};\n\n\t#userDialog: ?Dialog = null;\n\t#loader: ?Loader = null;\n\n\t#data: ?ItemData = null;\n\t#viewData: ?ItemViewData = null;\n\n\tconstructor(data: ItemData)\n\t{\n\t\tthis.#api = new Api();\n\t\tthis.#data = data;\n\t\tthis.#ui.container = this.getLayout();\n\t\tif (Type.isStringFilled(data?.entityType) && Type.isInteger(data?.entityId))\n\t\t{\n\t\t\tthis.#load();\n\t\t}\n\t}\n\n\tsetItemData(data: ItemData): void\n\t{\n\t\tif (this.#data.entityId === data.entityId && this.#data.entityType === data.entityType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#data = data;\n\t\tif (Type.isStringFilled(data?.entityType) && Type.isInteger(data?.entityId))\n\t\t{\n\t\t\tthis.#load();\n\t\t}\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\tif (this.#ui.container)\n\t\t{\n\t\t\treturn this.#ui.container;\n\t\t}\n\n\t\tconst modifier = this.#data.entityType === EntityTypes.User ? ' --user' : '';\n\t\tthis.#ui.avatar = Tag.render`<div class=\"sign-b2e-send__party_item-info-avatar${modifier}\"></div>`;\n\t\tthis.#ui.title.header = Tag.render`<div class=\"sign-b2e-send__party_item-info-header\"></div>`;\n\t\tthis.#ui.title.footer = Tag.render`<div class=\"sign-b2e-send__party_item-info-footer\"></div>`;\n\t\tthis.#ui.title.container = Tag.render`\n\t\t\t<div class=\"sign-b2e-send__party_item-info-title\">\n\t\t\t\t${this.#ui.title.header}\n\t\t\t\t${this.#ui.title.footer}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#ui.container = Tag.render`\n\t\t\t<div class=\"sign-b2e-send__party_item-info\">\n\t\t\t\t${this.#ui.avatar}\n\t\t\t\t${this.#ui.title.container}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#ui.container;\n\t}\n\n\t#loadCompany(): Promise\n\t{\n\t\treturn this.#api.loadB2eCompanyList()\n\t\t\t.then(data => {\n\t\t\t\tif (Type.isObject(data.companies) && Type.isArray(data.companies))\n\t\t\t\t{\n\t\t\t\t\tconst company = data.companies.filter(company => company.id === this.#data.entityId)[0] ?? null;\n\t\t\t\t\tif (company === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst footer = Type.isBoolean(data?.showTaxId) && data?.showTaxId && company?.rqInn\n\t\t\t\t\t\t? Loc.getMessage('SIGN_DOCUMENT_SUMMARY_COMPANY_INN',\n\t\t\t\t\t\t\t{ '%innValue%' : TextFormat.encode(company?.rqInn) }\n\t\t\t\t\t\t)\n\t\t\t\t\t\t: null\n\t\t\t\t\t;\n\n\t\t\t\t\tthis.#viewData = {\n\t\t\t\t\t\theader: company?.title,\n\t\t\t\t\t\tfooter: footer,\n\t\t\t\t\t\tavatar: null\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.#refreshView();\n\t\t\t\t}\n\n\t\t\t\tthis.#hideLoader();\n\t\t\t}).catch((response) => {\n\t\t\t\tconsole.log(response);\n\t\t\t})\n\t\t;\n\t}\n\n\t#loadUser(): Promise\n\t{\n\t\t return new Promise((resolve) => {\n\t\t\tthis.#userDialog = new Dialog({\n\t\t\t\tentities: [\n\t\t\t\t\t{ id: EntityTypes.User }\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\t'onLoad': (event) => {\n\t\t\t\t\t\tconst user = this.#userDialog.getSelectedItems()[0] ?? null;\n\t\t\t\t\t\tif (Type.isObject(user))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst lastName = user?.customData?.get('lastName') ?? '';\n\t\t\t\t\t\t\tthis.#viewData = {\n\t\t\t\t\t\t\t\theader: user?.customData?.get('name') + ' ' + lastName,\n\t\t\t\t\t\t\t\tfooter: user?.customData?.get('position') ?? '',\n\t\t\t\t\t\t\t\tavatar: user?.avatar ?? null,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tthis.#refreshView();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.#hideLoader();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tpreselectedItems: [[EntityTypes.User, this.#data.entityId]]\n\t\t\t});\n\n\t\t\tthis.#userDialog.load();\n\t\t});\n\t}\n\n\tasync #load(): Promise<void>\n\t{\n\t\tthis.#showLoader();\n\t\tif (this.#data.entityType === EntityTypes.Company)\n\t\t{\n\t\t\tawait this.#loadCompany();\n\t\t}\n\t\telse if (this.#data.entityType === EntityTypes.User)\n\t\t{\n\t\t\tawait this.#loadUser();\n\t\t}\n\t\tthis.#refreshView();\n\t\tthis.#hideLoader();\n\t}\n\n\t#refreshView(): void\n\t{\n\t\tif (this.#viewData?.avatar !== null)\n\t\t{\n\t\t\tthis.#ui.avatar.style.backgroundImage = `url(\"${this.#viewData.avatar}\")`;\n\t\t}\n\n\t\tthis.#ui.title.header.innerText = this.#viewData.header;\n\t\tthis.#ui.title.header.title = this.#viewData.header;\n\t\tthis.#ui.title.footer.innerText = this.#viewData.footer;\n\t\tthis.#ui.title.footer.title = this.#viewData.footer;\n\t}\n\n\t#getLoader(): Loader\n\t{\n\t\tif (this.#loader)\n\t\t{\n\t\t\treturn this.#loader;\n\t\t}\n\n\t\tthis.#loader = new BX.Loader({\n\t\t\ttarget: this.#ui.container,\n\t\t\tmode: 'inline',\n\t\t\tsize: 40\n\t\t});\n\n\t\treturn this.#loader;\n\t}\n\n\t#hideLoader(): void\n\t{\n\t\tthis.#ui.title.container.style.display = 'flex';\n\t\tthis.#ui.avatar.style.display = 'block';\n\t\tthis.#getLoader().hide();\n\t}\n\n\t#showLoader(): void\n\t{\n\t\tthis.#ui.avatar.style.display = 'none';\n\t\tthis.#ui.title.container.style.display = 'none';\n\t\tthis.#getLoader().show(this.#ui.container);\n\t}\n}\n","import { Tag, Loc, Type, Dom } from 'main.core';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { type DocumentDetails } from 'sign.v2.document-setup';\nimport { isTemplateMode } from 'sign.v2.sign-settings';\nimport { UserParty } from 'sign.v2.b2e.user-party';\nimport { ReminderSelector, type Options as ReminderOptions } from 'sign.v2.b2e.reminder-selector';\nimport type { MemberRoleType, DocumentModeType } from 'sign.type';\nimport { MemberRole, Reminder } from 'sign.type';\nimport { Item, EntityTypes } from './item';\nimport { Api } from 'sign.v2.api';\nimport { DocumentSummary } from 'sign.v2.document-summary';\nimport { LangSelector } from 'sign.v2.lang-selector';\nimport type { PartiesData, DocumentData } from './type';\nimport type { DocumentSendConfig } from 'sign.v2.b2b.document-send';\nimport { Hint } from 'sign.v2.helper';\nimport { ProgressBar } from 'ui.progressbar';\nimport { HcmLinkPartyChecker } from 'sign.v2.b2e.hcm-link-party-checker';\nimport type { Analytics } from 'sign.v2.analytics';\n\nimport './style.css';\n\nexport type CommunicationType = 'idle' | 'phone' | 'email';\n\ntype CommunicationSelectedData = {\n\t[key: string]: {\n\t\tid: string,\n\t\toption: CommunicationType,\n\t}\n};\ntype Member = {\n\tpresetId: number,\n\tpart: number,\n\tuid: string,\n\trole: MemberRoleType,\n};\n\nconst ReminderSelectorOptionsByRole: Record<MemberRoleType, ReminderOptions> = {\n\t[MemberRole.assignee]: { preSelectedType: Reminder.oncePerDay },\n\t[MemberRole.signer]: { preSelectedType: Reminder.twicePerDay },\n};\n\nconst idleCommunication: CommunicationType = 'idle';\n\nexport class DocumentSend extends EventEmitter\n{\n\tevents = Object.freeze({\n\t\tonTemplateComplete: 'onTemplateComplete',\n\t});\n\t// members: Array<Member> | null;\n\n\t#ui = {\n\t\tcontainer: HTMLDivElement = null,\n\t\temployeesTitle: HTMLParagraphElement,\n\t};\n\n\t#communicationSelectedOption: CommunicationSelectedData = {\n\t\tcompany: {\n\t\t\tid: 'company',\n\t\t\toption: idleCommunication,\n\t\t},\n\t\temployee: {\n\t\t\tid: 'employee',\n\t\t\toption: idleCommunication,\n\t\t},\n\t\tvalidation: {\n\t\t\tid: 'validation',\n\t\t\toption: idleCommunication,\n\t\t},\n\t};\n\n\t#items = {\n\t\tcompany: Item,\n\t\trepresentative: Item,\n\t\temployees: UserParty,\n\t\treviewer: Item,\n\t\teditor: Item,\n\t};\n\n\t#partiesData: ?PartiesData = null;\n\t#documentSummary: DocumentSummary;\n\t#documentData: Map<string, DocumentDetails>;\n\t#langSelector: LangSelector;\n\t#progress: ProgressBar;\n\t#progressOverlay: ?HTMLElement;\n\t#progressContainer: ?HTMLElement;\n\t#itemsToHide: Array<HTMLElement> = [];\n\t#reminderSelectorByRole: Record<MemberRoleType, ReminderSelector> = {};\n\t#documentMode: DocumentModeType;\n\t#isExistingTemplate: boolean = false;\n\n\t#analytics: ?Analytics;\n\n\t#hcmLinkPartyChecker: HcmLinkPartyChecker | null = null;\n\n\tconstructor(documentSendConfig: DocumentSendConfig)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.B2e.DocumentSend');\n\t\tthis.#items.company = new Item({ entityType: EntityTypes.Company });\n\t\tthis.#items.representative = new Item({ entityType: EntityTypes.User });\n\t\tthis.#items.reviewer = new Item({ entityType: EntityTypes.User });\n\t\tthis.#items.editor = new Item({ entityType: EntityTypes.User });\n\t\tthis.#items.employees = new UserParty({ mode: 'view' });\n\t\tthis.#documentSummary = new DocumentSummary({\n\t\t\tevents: {\n\t\t\t\tchangeTitle: (event: BaseEvent) => {\n\t\t\t\t\tconst data = event.getData();\n\t\t\t\t\tthis.emit('changeTitle', data);\n\t\t\t\t},\n\t\t\t\tshowEditor: (event: BaseEvent) => {\n\t\t\t\t\tconst data = event.getData();\n\t\t\t\t\tthis.emit('showEditor', data);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t\tconst { region, languages, documentMode, analytics } = documentSendConfig;\n\t\tthis.#langSelector = new LangSelector(region, languages);\n\t\tthis.#documentData = {};\n\t\tthis.#analytics = analytics;\n\t\tthis.#documentMode = documentMode;\n\t\tthis.#ui.employeesTitle = Tag.render`\n\t\t\t<p class=\"sign-b2e-send__party_signing-employees\">\n\t\t\t\t${Loc.getMessage('SIGN_SEND_SIGNING_EMPLOYEES', { '#CNT#': 0 })}\n\t\t\t</p>\n\t\t`;\n\t\tthis.#progress = new ProgressBar({\n\t\t\tmaxValue: 100,\n\t\t\tvalue: 0,\n\t\t\tcolorTrack: '#dfe3e6',\n\t\t});\n\n\t\t[MemberRole.assignee, MemberRole.signer].forEach((role: MemberRoleType) => {\n\t\t\tthis.#getOrCreateReminderSelectorForRole(role);\n\t\t});\n\n\t\tif (!this.#isTemplateMode())\n\t\t{\n\t\t\tthis.#hcmLinkPartyChecker = new HcmLinkPartyChecker({\n\t\t\t    api: new Api(),\n\t\t    });\n\t\t\t\n\t\t\tthis.#hcmLinkPartyChecker.subscribe('updateValidation', (event) => this.#onHcmLinkCheckerUpdateValidation(event));\n\t\t}\n\t}\n\n\tget documentData(): DocumentData\n\t{\n\t\treturn this.#documentData;\n\t}\n\n\tset hcmLinkEnabled(value: boolean): void\n\t{\n\t\tthis.#hcmLinkPartyChecker?.setEnabled(value);\n\t}\n\n\tset documentData(documentData: Map<string, DocumentDetails>)\n\t{\n\t\tdocumentData.forEach((data) => {\n\t\t\tconst { uid, id, title, blocks, externalId, isTemplate, entityId, urls } = data;\n\t\t\tthis.#documentSummary.addItem(uid, { uid, id, title, blocks, externalId, isTemplate, entityId, urls });\n\t\t});\n\n\t\tthis.#documentData = documentData;\n\n\t\tconst lastUid = [...documentData.values()].pop().uid;\n\t\tconst documentGroupUids = Array.from(documentData.keys());\n\n\t\tthis.#langSelector.setDocumentUid(lastUid);\n\t\tthis.#items.employees.setDocumentUid(lastUid);\n\n\t\tthis.#hcmLinkPartyChecker?.setDocumentGroupUids(documentGroupUids);\n\t\tvoid this.#hcmLinkPartyChecker?.check();\n\t}\n\n\t#getCompanyCommunication(): CommunicationType | null\n\t{\n\t\treturn this.#communicationSelectedOption.company?.option ?? null;\n\t}\n\n\t#getValidationCommunication(): CommunicationType | null\n\t{\n\t\treturn this.#communicationSelectedOption.validation?.option ?? null;\n\t}\n\n\t#getEmployeeCommunication(): CommunicationType | null\n\t{\n\t\treturn this.#communicationSelectedOption.employee?.option ?? null;\n\t}\n\n\t#getProgressAnimateLayout(): HTMLElement\n\t{\n\t\tconst createDocumentOverlapLayout = (docsCount: number) => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-b2e-overlay__overlap-docs\">\n\t\t\t\t\t${Array.from({ length: docsCount }).map(() => {\n\t\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t\t<div class=\"sign-b2e-overlay__overlap-doc\"></div>\n\t\t\t\t\t\t`;\n\t\t\t\t\t})}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-b2e-overlay__animate-layout\">\n\t\t\t\t${createDocumentOverlapLayout(4)}\n\t\t\t\t${createDocumentOverlapLayout(3)}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\tconst layout = Tag.render`\n\t\t\t<div class=\"sign-b2e-send\">\n\t\t\t\t<h1 class=\"sign-b2e-settings__header\">${Loc.getMessage('SIGN_DOCUMENT_SEND_HEADER_1')}</h1>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst summaryTitle = this.#isTemplateMode()\n\t\t\t? Loc.getMessage('SIGN_DOCUMENT_SUMMARY_TEMPLATE_TITLE')\n\t\t\t: Loc.getMessage('SIGN_DOCUMENT_SUMMARY_TITLE');\n\n\t\tthis.#itemsToHide = [];\n\t\tconst summaryLayout = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${summaryTitle}\n\t\t\t\t</p>\n\t\t\t\t${this.#documentSummary.getLayout()}\n\t\t\t\t<div class=\"sign-b2e-send__lang-selector\">\n\t\t\t\t\t${this.#langSelector.getLayout()}\n\t\t\t\t\t<span\n\t\t\t\t\t\tdata-hint=\"${Loc.getMessage('SIGN_DOCUMENT_SEND_LANG_SELECTOR_HINT')}\"\n\t\t\t\t\t></span>\n\t\t\t\t</div>\n\t\t\t\t<span class=\"sign-b2e-send__deadline\">\n\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SEND_DEADLINE')}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t`;\n\t\tthis.#itemsToHide.push(summaryLayout);\n\n\t\tlet usersLayout = null;\n\t\tif (!this.#isTemplateMode())\n\t\t{\n\t\t\tusersLayout = Tag.render`\n\t\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SEND_SECOND_PARTY')}\n\t\t\t\t\t</p>\n\t\t\t\t\t${this.#ui.employeesTitle}\n\t\t\t\t\t${this.#items.employees.getLayout()}\n\t\t\t\t\t<div class=\"sign-b2e-send__config-container\">\n\t\t\t\t\t\t${this.#getCommunicationsLayout('employee')}\n\t\t\t\t\t\t${this.#getReminderSelectorLayout(MemberRole.signer)}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#hcmLinkPartyChecker.render()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tthis.#itemsToHide.push(usersLayout);\n\t\t}\n\t\tconst itemTitleText = this.#isTemplateMode()\n\t\t\t? Loc.getMessage('SIGN_DOCUMENT_SEND_FIRST_PARTY_TEMPLATE')\n\t\t\t: Loc.getMessage('SIGN_DOCUMENT_SEND_FIRST_PARTY')\n\t\t;\n\t\tconst companyLayout = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${itemTitleText}\n\t\t\t\t</p>\n\t\t\t\t<div class=\"sign-b2e-send__company-items\">\n\t\t\t\t\t<div class=\"sign-b2e-send__company-items_flex\">\n\t\t\t\t\t\t<p class=\"sign-b2e-send__company-items_item-title\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_SEND_SIGNING_COMPANY')}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<span class=\"sign-b2e-send__company-items_shrunk\"></span>\n\t\t\t\t\t\t<p class=\"sign-b2e-send__company-items_item-title\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_SEND_SIGNING_REPRESENTATIVE')}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"sign-b2e-send__company-items_flex\">\n\t\t\t\t\t\t${this.#items.company.getLayout()}\n\t\t\t\t\t\t<span class=\"sign-b2e-send__company-items_shrunk sign-b2e-send__party-item-separator\">\n\t\t\t\t\t\t\t&#43;\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t${this.#items.representative.getLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-b2e-send__config-container\">\n\t\t\t\t\t${this.#getCommunicationsLayout('company')}\n\t\t\t\t\t${this.#getReminderSelectorLayout(MemberRole.assignee)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tthis.#itemsToHide.push(companyLayout);\n\t\tDom.append(summaryLayout, layout);\n\t\tconst reviewerHeaderText = this.#isTemplateMode()\n\t\t\t? Loc.getMessage('SIGN_SEND_SIGNING_VALIDATION_HEAD_REVIEWER_TEMPLATE')\n\t\t\t: Loc.getMessage('SIGN_SEND_SIGNING_VALIDATION_HEAD_REVIEWER')\n\t\t;\n\t\tconst validationTitles = {\n\t\t\t[MemberRole.reviewer]: {\n\t\t\t\theader: reviewerHeaderText,\n\t\t\t\thint: Loc.getMessage('SIGN_SEND_SIGNING_VALIDATION_TITLE_REVIEWER'),\n\t\t\t},\n\t\t\t[MemberRole.editor]: {\n\t\t\t\theader: Loc.getMessage('SIGN_SEND_SIGNING_VALIDATION_HEAD_EDITOR'),\n\t\t\t\thint: Loc.getMessage('SIGN_SEND_SIGNING_VALIDATION_TITLE_EDITOR'),\n\t\t\t},\n\t\t};\n\t\tthis.#partiesData.validation.forEach(({ role }) => {\n\t\t\tconst { hint, header } = validationTitles[role];\n\t\t\tconst validationLayout = Tag.render`\n\t\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t\t${header}\n\t\t\t\t\t</p>\n\t\t\t\t\t<div class=\"sign-b2e-send__party_item\">\n\t\t\t\t\t\t<p class=\"sign-b2e-send__company-items_item-title\">\n\t\t\t\t\t\t\t${hint}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t${this.#items[role].getLayout()}\n\t\t\t\t\t\t${this.#getCommunicationsLayout('validation')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tthis.#itemsToHide.push(validationLayout);\n\t\t\tDom.append(validationLayout, layout);\n\t\t});\n\t\tDom.append(companyLayout, layout);\n\t\tif (!Type.isNull(usersLayout))\n\t\t{\n\t\t\tDom.append(usersLayout, layout);\n\t\t}\n\n\t\tthis.#progressContainer = Tag.render`<div class=\"send-b2e-progress-container\"></div>`;\n\t\tthis.#progress.renderTo(this.#progressContainer);\n\n\t\tthis.#progressOverlay = this.#isTemplateMode() ? this.#getTemplateProgressOverlay()\n\t\t\t: this.#getProgressOverlay();\n\n\t\tDom.style(this.#progressOverlay, 'display', 'none');\n\t\tthis.emit('appendOverlay', { overlay: this.#progressOverlay });\n\t\tHint.create(layout);\n\n\t\treturn layout;\n\t}\n\n\t#getProgressOverlay(): HTMLElement\n\t{\n\t\tconst closeDescriptionText = Loc.getMessage('SIGN_SEND_CLOSE_DESCRIPTION');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"send-b2e-overlay\">\n\t\t\t\t<div class=\"sign-b2e-overlay-content\">\n\t\t\t\t\t${this.#getProgressAnimateLayout()}\n\t\t\t\t\t<div class=\"sign-b2e-overlay-progress-title\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_SEND_PROGRESS_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"sign-b2e-overlay-close-description\">\n\t\t\t\t\t\t${closeDescriptionText}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t${this.#getCloseBtn()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t${this.#progressContainer}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getTemplateProgressOverlay(): HTMLElement\n\t{\n\t\tconst templateTitle = this.#isExistingTemplate ? Loc.getMessage('SIGN_SETTINGS_TEMPLATE_CHANGED')\n\t\t\t: Loc.getMessage('SIGN_SETTINGS_TEMPLATE_CREATED');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-b2e-template-status\">\n\t\t\t\t<div class=\"sign-b2e-template-status-inner\">\n\t\t\t\t\t<div class=\"sign-b2e-template-status-img\"></div>\n\t\t\t\t\t<div class=\"sign-b2e-template-status-title\">${templateTitle}</div>\n\t\t\t\t\t<div class=\"sign-b2e-template-status-info\">${Loc.getMessage('SIGN_SETTINGS_TEMPLATE_CREATED_INFO')}</div>\n\t\t\t\t\t<button class=\"ui-btn ui-btn-light-border ui-btn-round\" onclick=\"BX.SidePanel.Instance.close();\">${Loc.getMessage('SIGN_SETTINGS_TEMPLATES_LIST')}</button>\n\t\t\t\t</div>\n\t\t\t </div>\n\t\t`;\n\t}\n\n\tsetExistingTemplate(): void\n\t{\n\t\tthis.#isExistingTemplate = true;\n\t}\n\n\t#getCloseBtn(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<button\n\t\t\t\tclass=\"ui-btn ui-btn-light-border ui-btn-round\"\n\t\t\t\tonclick=\"${() => this.emit('close')}\">\n\t\t\t\t${Loc.getMessage('SIGN_SEND_CLOSE_BTN')}\n\t\t\t</button>\n\t\t`;\n\t}\n\n\tresetUserPartyPopup(): DocumentSend\n\t{\n\t\tthis.#items.employees.resetUserPartyPopup();\n\n\t\treturn this;\n\t}\n\n\tsetPartiesData(parties: PartiesData): DocumentSend\n\t{\n\t\tthis.#partiesData = parties;\n\n\t\tif (Type.isNumber(parties?.company?.entityId))\n\t\t{\n\t\t\tthis.#items.company.setItemData({\n\t\t\t\tentityId: parties?.company?.entityId,\n\t\t\t\tentityType: parties?.company?.entityType,\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isNumber(parties?.representative?.entityId))\n\t\t{\n\t\t\tthis.#items.representative.setItemData({\n\t\t\t\tentityId: parties?.representative?.entityId,\n\t\t\t\tentityType: parties?.representative?.entityType,\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isArrayFilled(parties?.employees))\n\t\t{\n\t\t\tthis.#items.employees.setSignersIds(parties?.employees.map((employee) => {\n\t\t\t\treturn { entityId: employee.entityId, entityType: employee.entityType };\n\t\t\t}));\n\t\t}\n\n\t\tif (Type.isArrayFilled(parties?.validation))\n\t\t{\n\t\t\tparties.validation.forEach((party) => {\n\t\t\t\tconst { entityId, entityType, role } = party;\n\t\t\t\tthis.#items[role].setItemData({ entityId, entityType });\n\t\t\t});\n\t\t}\n\n\t\tthis.#refreshView();\n\n\t\treturn this;\n\t}\n\n\tasync sendForSign(): Promise<boolean>\n\t{\n\t\tconst api = new Api();\n\n\t\ttry\n\t\t{\n\t\t\tthis.emit('disableBack');\n\t\t\tawait this.#saveReminderTypesForRoles();\n\n\t\t\tthis.#showProgressOverlay();\n\t\t\tif (this.#isTemplateMode())\n\t\t\t{\n\t\t\t\tconst { template: { id: templateId } } = await api.template.completeTemplate(this.documentData.values().next().value.templateUid);\n\t\t\t\tthis.emit('onTemplateComplete', { templateId });\n\t\t\t}\n\t\t\telse if (this.#isGroupDocuments())\n\t\t\t{\n\t\t\t\tconst groupId = this.#getGroupIdFromGroup();\n\t\t\t\tconst configureDocumentGroupPromise = api.configureDocumentGroup(groupId);\n\t\t\t\tconst groupCheckFillAndStartProgressPromise = this.#groupCheckFillAndStartProgress(groupId);\n\n\t\t\t\tawait Promise.all([configureDocumentGroupPromise, groupCheckFillAndStartProgressPromise]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (const [uid] of this.documentData)\n\t\t\t\t{\n\t\t\t\t\tconst configureDocumentPromise = api.configureDocument(uid);\n\t\t\t\t\tconst checkFillAndStartProgressPromise = this.#checkFillAndStartProgress(uid);\n\n\t\t\t\t\tawait Promise.all([configureDocumentPromise, checkFillAndStartProgressPromise]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t\tcatch (ex)\n\t\t{\n\t\t\tconsole.error(ex);\n\t\t\tthis.#hideProgressOverlay();\n\t\t\tthis.emit('enableBack');\n\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tdeleteDocument(uid: string): void\n\t{\n\t\tthis.#documentSummary.deleteItem(uid);\n\t}\n\n\tsetDocumentsBlock(documents): void\n\t{\n\t\tconst documentsObject = Object.fromEntries(documents);\n\t\tthis.#documentSummary.setItems(documentsObject);\n\t}\n\n\tasync #checkFillAndStartProgress(uid: string): Promise<void>\n\t{\n\t\tconst api = new Api();\n\t\tlet completed = false;\n\t\twhile (!completed)\n\t\t{\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tconst result = await api.getDocumentFillAndStartProgress(uid);\n\t\t\tcompleted = result.completed;\n\t\t\tthis.#progress.update(Math.round(result.progress));\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.#sleep(1000);\n\t\t}\n\t}\n\n\tasync #groupCheckFillAndStartProgress(groupId: number): Promise<void>\n\t{\n\t\tconst api = new Api();\n\t\tlet completed = false;\n\t\twhile (!completed)\n\t\t{\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tconst result = await api.getDocumentGroupFillAndStartProgress(groupId);\n\t\t\tcompleted = result.completed;\n\t\t\tthis.#progress.update(Math.round(result.progress));\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.#sleep(2000);\n\t\t}\n\t}\n\n\t#sleep(ms: Number): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, ms);\n\t\t});\n\t}\n\n\t#refreshView(): void\n\t{\n\t\tthis.#ui.employeesTitle.innerText = Loc.getMessage(\n\t\t\t'SIGN_SEND_SIGNING_EMPLOYEES',\n\t\t\t{ '#CNT#': this.#partiesData?.employees?.length ?? 0 },\n\t\t);\n\t}\n\n\t#getCommunicationsLayout(communicationChannelId: string): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-b2e-send__communications\">\n\t\t\t\t<span class=\"sign-b2e-send__communications_title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SEND_COMMUNICATION_TITLE')}\n\t\t\t\t</span>\n\t\t\t\t<div class=\"sign-b2e-send__communications_communication-type\">\n\t\t\t\t\t<span class=\"sign-b2e-send__communications_communication-type-text\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SEND_COMMUNICATION_CHANEL_IDLE')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tdata-hint=\"${Loc.getMessage('SIGN_DOCUMENT_SEND_COMMUNICATION_CHANEL_HINT')}\"\n\t\t\t\t\t></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#showProgressOverlay(): void\n\t{\n\t\tthis.#progress.update(0);\n\t\tthis.emit('hidePreview');\n\t\tthis.#itemsToHide.forEach((item) => Dom.hide(item));\n\t\tDom.style(this.#progressOverlay, 'display', 'flex');\n\t\tthis.emit('showOverlay');\n\t}\n\n\t#hideProgressOverlay(): void\n\t{\n\t\tthis.#itemsToHide.forEach((item) => Dom.show(item));\n\t\tthis.emit('hideOverlay');\n\t\tDom.style(this.#progressOverlay, 'display', 'none');\n\t\tthis.emit('showPreview');\n\t}\n\n\t#getReminderSelectorLayout(role: MemberRoleType): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-b2e-send__reminder-selector\">\n\t\t\t\t${this.#getOrCreateReminderSelectorForRole(role).getLayout()}\n\t\t\t\t<span\n\t\t\t\t\tdata-hint=\"${Loc.getMessage('SIGN_DOCUMENT_SEND_REMINDER_TYPE_SELECTOR_HINT')}\"\n\t\t\t\t></span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getOrCreateReminderSelectorForRole(role: MemberRoleType): ReminderSelector\n\t{\n\t\tthis.#reminderSelectorByRole[role] ??= new ReminderSelector(ReminderSelectorOptionsByRole[role] ?? {});\n\n\t\treturn this.#reminderSelectorByRole[role];\n\t}\n\n\t#saveReminderTypesForRoles(): Promise<void>\n\t{\n\t\tconst uid = this.#getFirstDocumentUidFromGroup();\n\t\tconst promises: Array<Promise> = Object.entries(this.#reminderSelectorByRole)\n\t\t\t.map(([role, selector]) => selector.save(uid, role))\n\t\t;\n\n\t\treturn Promise.all(promises);\n\t}\n\n\t#getFirstDocumentUidFromGroup(): string\n\t{\n\t\treturn this.documentData.keys().next().value;\n\t}\n\n\t#isTemplateMode(): boolean\n\t{\n\t\treturn isTemplateMode(this.#documentMode);\n\t}\n\n\t#isGroupDocuments(): boolean\n\t{\n\t\treturn this.documentData.size > 1;\n\t}\n\n\t#getGroupIdFromGroup(): string\n\t{\n\t\treturn this.documentData.values().next().value.groupId;\n\t}\n\n\t#onHcmLinkCheckerUpdateValidation(event: BaseEvent): void\n\t{\n\t\tconst enableComplete = event?.data ?? false;\n\n\t\tthis.emit(\n\t\t\tenableComplete\n\t\t\t\t? 'enableComplete'\n\t\t\t\t: 'disableComplete',\n\t\t);\n\t}\n}\n"],"names":["EntityTypes","Object","freeze","User","Company","Item","data","babelHelpers","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","writable","value","container","HTMLDivElement","avatar","title","header","footer","Api","this","getLayout","Type","isStringFilled","entityType","isInteger","entityId","_classPrivateMethodGet","key","modifier","Tag","render","loadB2eCompanyList","then","isObject","companies","isArray","company","filter","id","isBoolean","showTaxId","rqInn","Loc","getMessage","%innValue%","TextFormat","encode","_this","response","console","log","Promise","resolve","Dialog","entities","events","onLoad","event","user","getSelectedItems","lastName","customData","_user$customData","get","_user$customData2","_user$customData3","_this2","preselectedItems","load","_load3","_context","_babelHelpers$classPr2","style","backgroundImage","innerText","BX","Loader","target","mode","size","display","hide","show","ReminderSelectorOptionsByRole","MemberRole","assignee","preSelectedType","Reminder","oncePerDay","signer","twicePerDay","DocumentSend","documentSendConfig","onTemplateComplete","employeesTitle","HTMLParagraphElement","option","employee","validation","representative","employees","UserParty","reviewer","editor","setEventNamespace","DocumentSummary","changeTitle","getData","emit","showEditor","region","languages","documentMode","analytics","LangSelector","#CNT#","ProgressBar","maxValue","colorTrack","forEach","role","HcmLinkPartyChecker","api","subscribe","layout","summaryTitle","summaryLayout","push","usersLayout","itemTitleText","companyLayout","Dom","append","reviewerHeaderText","validationTitles","hint","validationLayout","isNull","renderTo","overlay","Hint","create","resetUserPartyPopup","parties","_parties$representati","_this3","isNumber","_parties$company","setItemData","_parties$company2","_parties$company3","_parties$representati2","_parties$representati3","isArrayFilled","setSignersIds","map","party","template","completeTemplate","documentData","values","next","templateUid","_yield$api$template$c","templateId","groupId","configureDocumentGroupPromise","configureDocumentGroup","groupCheckFillAndStartProgressPromise","all","_iterator","_step$value","uid","configureDocumentPromise","configureDocument","checkFillAndStartProgressPromise","error","deleteItem","documents","documentsObject","fromEntries","setItems","set","_babelHelpers$classPr","blocks","externalId","isTemplate","urls","addItem","lastUid","pop","documentGroupUids","Array","from","keys","setDocumentUid","setDocumentGroupUids","check","_babelHelpers$classPr3","setEnabled","EventEmitter","createDocumentOverlapLayout","docsCount","length","closeDescriptionText","templateTitle","_this5","_checkFillAndStartProgress3","completed","_context2","getDocumentFillAndStartProgress","result","update","Math","round","progress","_groupCheckFillAndStartProgress3","_context3","getDocumentGroupFillAndStartProgress","ms","setTimeout","_babelHelpers$classPr11","_babelHelpers$classPr12","communicationChannelId","item","_babelHelpers$classPr13","ReminderSelector","promises","entries","save","isTemplateMode","enableComplete"],"mappings":"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"}