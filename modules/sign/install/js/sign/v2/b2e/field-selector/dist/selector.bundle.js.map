{"version":3,"file":"selector.bundle.js","sources":["../src/backend/backend.js","../src/search/search.js","../src/list-item/list-item.js","../src/selector.js"],"sourcesContent":["import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {ajax} from 'main.core';\n\ntype BackendOptions = {\n\tevents: {\n\t\tonError: (event: BaseEvent) => void,\n\t},\n};\n\nexport default class Backend extends EventEmitter\n{\n\tconstructor(options: BackendOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.B2E.FieldsSelector.Backend');\n\t\tthis.subscribeFromOptions(options.events);\n\t}\n\n\t#request(requestOptions: {action: string, data: {[key: string]: any}}): Promise<any>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax\n\t\t\t\t.runAction(\n\t\t\t\t\t`sign.api_v1.b2e.fields.${requestOptions.action}`,\n\t\t\t\t\t{\n\t\t\t\t\t\tjson: requestOptions.data,\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.then(resolve)\n\t\t\t\t.catch(reject);\n\t\t});\n\t}\n\n\tgetData(requestOptions = {}): Promise<any>\n\t{\n\t\treturn this.#request({\n\t\t\taction: 'load',\n\t\t\tdata: requestOptions,\n\t\t});\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Tag, Runtime, Text, Type, Loc} from 'main.core';\n\nimport './css/style.css';\n\ntype SearchOptions = {\n\tinitialValue?: string,\n\tevents?: {\n\t\tonChange?: (event: BaseEvent) => void,\n\t\tonDebouncedChange?: (event: BaseEvent) => void,\n\t},\n};\n\nexport default class Search extends EventEmitter\n{\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(options: SearchOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.B2E.Fields.Selector.Search');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.#setOptions(options);\n\t}\n\n\t#setOptions(options: SearchOptions)\n\t{\n\t\tthis.#cache.set('options', {...options});\n\t}\n\n\t#getOptions(): SearchOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\t#onInput()\n\t{\n\t\tthis.emit('onChange', {value: this.#getInput().value});\n\t\tthis.#getDebounceWrapper()();\n\t}\n\n\t#getDebounceWrapper(): () => void\n\t{\n\t\treturn this.#cache.remember('debounceWrapper', () => {\n\t\t\treturn Runtime.debounce(\n\t\t\t\t() => {\n\t\t\t\t\tthis.emit('onDebouncedChange', {value: this.#getInput().value});\n\t\t\t\t},\n\t\t\t\t50,\n\t\t\t)\n\t\t});\n\t}\n\n\t#getInput(): HTMLInputElement\n\t{\n\t\treturn this.#cache.remember('input', () => {\n\t\t\tconst initialValue = (() => {\n\t\t\t\tif (Type.isStringFilled(this.#getOptions().initialValue))\n\t\t\t\t{\n\t\t\t\t\treturn this.#getOptions().initialValue;\n\t\t\t\t}\n\n\t\t\t\treturn '';\n\t\t\t})();\n\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"text\" \n\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t\toninput=\"${this.#onInput.bind(this)}\"\n\t\t\t\t\tvalue=\"${Text.encode(initialValue)}\"\n\t\t\t\t\tplaceholder=\"${Loc.getMessage('SIGN_B2E_FIELDS_SELECTOR_SEARCH_PLACEHOLDER')}\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.#getInput().value;\n\t}\n\n\t#onClearClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.#getInput().value = '';\n\t\tthis.#onInput();\n\t}\n\n\tsetValue(value: string)\n\t{\n\t\tthis.#getInput().value = value;\n\t\tthis.#onInput();\n\t}\n\n\t#getClearButton(): HTMLButtonElement\n\t{\n\t\treturn this.#cache.remember('clearButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button \n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-clear\" \n\t\t\t\t\tonclick=\"${this.#onClearClick.bind(this)}\"\n\t\t\t\t></button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-b2e-fields-selector-search\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-before-icon ui-ctl-after-icon\">\n\t\t\t\t\t\t<div class=\"ui-ctl-before ui-ctl-icon-search\"></div>\n\t\t\t\t\t\t${this.#getClearButton()}\n\t\t\t\t\t\t${this.#getInput()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n}\n","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Tag, Dom, Text, Type} from 'main.core';\n\nimport {type Field} from '../types/field';\n\nimport './css/style.css';\n\ntype ListItemOptions = {\n\tfield: Field,\n\tselected?: boolean,\n\ttargetContainer?: HTMLElement,\n\tevents?: {\n\t\tonChange?: (event: BaseEvent) => void,\n\t},\n\ttype: $Values<ListItem.Type>,\n\tdisabled?: boolean,\n};\n\nexport default class ListItem extends EventEmitter\n{\n\tstatic Type = {\n\t\tCHECKBOX: 'checkbox',\n\t\tRADIO: 'radio',\n\t};\n\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(options: ListItemOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.B2E.FieldSelector.ListItem');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.#setOptions(options);\n\n\t\tconst {targetContainer} = options;\n\t\tif (Type.isDomNode(targetContainer))\n\t\t{\n\t\t\tthis.renderTo(targetContainer);\n\t\t}\n\t}\n\n\t#setOptions(options: ListItemOptions)\n\t{\n\t\tthis.#cache.set('options', {type: ListItem.Type.CHECKBOX, ...options});\n\t}\n\n\t#getOptions(): ListItemOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\tgetField(): Field\n\t{\n\t\treturn this.#getOptions().field;\n\t}\n\n\t#onChange()\n\t{\n\t\tthis.emit('onChange');\n\t}\n\n\t#getCheckbox(): HTMLInputElement\n\t{\n\t\treturn this.#cache.remember('checkbox', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"${Text.encode(this.#getOptions().type)}\" \n\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\tonchange=\"${this.#onChange.bind(this)}\"\n\t\t\t\t\tname=\"SIGN_B2E_SELECTOR_ITEM\"\n\t\t\t\t\t${this.#getOptions().selected ? 'checked' : ''}\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tisSelected(): boolean\n\t{\n\t\treturn this.#getCheckbox().checked;\n\t}\n\n\t#isDisabled(): boolean\n\t{\n\t\treturn this.#getOptions().disabled ?? false;\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember(`layout`, () => {\n\t\t\tconst fieldDisabledClassName = 'sign-b2e-fields-selector-field--disabled';\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-b2e-fields-selector-field${this.#isDisabled() ? \" \" + fieldDisabledClassName : ''}\">\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox sign-b2e-fields-selector-field-checkbox\">\n\t\t\t\t\t\t${this.#getCheckbox()}\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Text.encode(this.#getOptions().field.caption)}</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\trenderTo(targetContainer: HTMLElement)\n\t{\n\t\tif (Type.isDomNode(targetContainer))\n\t\t{\n\t\t\tDom.append(this.getLayout(), targetContainer);\n\t\t}\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Cache, Type, Dom, Reflection, Runtime, Tag, Loc, Text} from 'main.core';\nimport {Layout} from 'ui.sidepanel.layout';\nimport {Factory} from 'ui.userfieldfactory';\nimport {Button} from 'ui.buttons';\n\nimport Backend from './backend/backend';\nimport Search from './search/search';\nimport ListItem from './list-item/list-item';\n\nimport type {SelectorOptions, ControllerOptions, SelectorFilter, FieldsFactoryFilter} from './types/selector-options';\nimport type {FieldsList} from './types/fields-list';\nimport type {Field} from './types/field';\n\nimport './css/style.css';\n\nconst DEFAULT_FIELD_MODULE_ID = 'crm';\n\nexport class FieldSelector extends EventEmitter\n{\n\t#cache = new Cache.MemoryCache();\n\n\tstatic #defaultFilter = {\n\t\t'-categories': [\n\t\t\t'CATALOG',\n\t\t\t'ACTIVITY',\n\t\t\t'INVOICE',\n\t\t],\n\t\t'-fields': [\n\t\t\t{name: 'CONTACT_ORIGIN_VERSION'},\n\t\t\t{name: 'CONTACT_LINK'},\n\t\t],\n\t};\n\n\tstatic #defaultFieldsFactoryFilter = {\n\t\t'-types': ['employee', 'money', 'double', 'boolean', 'file', 'datetime', 'date'],\n\t};\n\n\tconstructor(options: SelectorOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.B2e.FieldsSelector');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.#setOptions(options);\n\t}\n\n\t#setOptions(options: SelectorOptions)\n\t{\n\t\tthis.#cache.set(\n\t\t\t'options',\n\t\t\t{\n\t\t\t\tfilter: {},\n\t\t\t\tmultiple: true,\n\t\t\t\t...options,\n\t\t\t},\n\t\t);\n\t}\n\n\t#getOptions(): SelectorOptions\n\t{\n\t\treturn Runtime.clone(this.#cache.get('options', {filter: {}}));\n\t}\n\n\t#getBackend(): Backend\n\t{\n\t\treturn this.#cache.remember('backend', () => {\n\t\t\treturn new Backend({\n\t\t\t\tevents: {\n\t\t\t\t\tonError: this.#onBackendError.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#setFieldsList(fieldsList: FieldsList)\n\t{\n\t\tif (Type.isObject(fieldsList.SMART_B2E_DOC))\n\t\t{\n\t\t\tfieldsList.SMART_B2E_DOC.CAPTION = Loc.getMessage('SIGN_B2E_FIELDS_SELECTOR_SMART_B2E_DOC_CATEGORY_CAPTION');\n\t\t}\n\n\t\tthis.#cache.set('fieldsList', {...fieldsList});\n\t}\n\n\t#applyCategoriesFilter(fieldsList: FieldsList, filter: SelectorFilter): FieldsList\n\t{\n\t\tconst fieldsEntries = Object.entries(fieldsList);\n\n\t\treturn fieldsEntries.reduce((acc, [categoryId, category]) => {\n\t\t\tif (\n\t\t\t\t(\n\t\t\t\t\t!Type.isArrayFilled(filter['+categories'])\n\t\t\t\t\t|| filter['+categories'].includes(categoryId)\n\t\t\t\t)\n\t\t\t\t&& (\n\t\t\t\t\t!Type.isArrayFilled(filter['-categories'])\n\t\t\t\t\t|| !filter['-categories'].includes(categoryId)\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tacc[categoryId] = category;\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, {});\n\t}\n\n\t#applyFieldsFilter(fieldsList: FieldsList, filter: SelectorFilter): FieldsList\n\t{\n\t\tconst fieldsEntries = Object.entries(fieldsList);\n\n\t\treturn fieldsEntries.reduce((acc, [categoryId, category]) => {\n\t\t\tconst filteredFields = category.FIELDS.filter((field) => {\n\t\t\t\tconst allowed = (\n\t\t\t\t\t!Type.isArrayFilled(filter['+fields'])\n\t\t\t\t\t|| filter['+fields'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn field.type === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(field);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isPlainObject(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn Object.entries(condition).every(([key, value]) => {\n\t\t\t\t\t\t\t\treturn field[key] === value;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\tconst disallowed = (\n\t\t\t\t\tType.isArrayFilled(filter['-fields'])\n\t\t\t\t\t&& filter['-fields'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn field.type === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(field);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isPlainObject(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn Object.entries(condition).every(([key, value]) => {\n\t\t\t\t\t\t\t\treturn field[key] === value;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\treturn allowed && !disallowed;\n\t\t\t});\n\n\t\t\tif (Type.isArrayFilled(filteredFields))\n\t\t\t{\n\t\t\t\tacc[categoryId] = {\n\t\t\t\t\t...category,\n\t\t\t\t\tFIELDS: filteredFields,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, {});\n\t}\n\n\t#applySearchFilter(fieldsList: FieldsList, query): FieldsList\n\t{\n\t\tconst fieldsEntries = Object.entries(fieldsList);\n\t\tif (Type.isStringFilled(query))\n\t\t{\n\t\t\tconst preparedQuery = String(query).toLowerCase();\n\t\t\treturn fieldsEntries.reduce((acc, [categoryId, category]) => {\n\t\t\t\tconst filteredFields = category.FIELDS.filter((field) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tType.isStringFilled(field.caption)\n\t\t\t\t\t\t&& String(field.caption).toLowerCase().includes(preparedQuery)\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\t\tif (Type.isArrayFilled(filteredFields))\n\t\t\t\t{\n\t\t\t\t\tacc[categoryId] = {\n\t\t\t\t\t\t...category,\n\t\t\t\t\t\tFIELDS: filteredFields,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t}\n\n\t\treturn fieldsList;\n\t}\n\n\tgetFieldsList(filtering: boolean = true): FieldsList\n\t{\n\t\tconst fieldsList = this.#cache.get('fieldsList', {});\n\n\t\tconst filter = this.#getFilter();\n\t\tif (Type.isPlainObject(filter))\n\t\t{\n\t\t\tconst query = filtering ? this.#getSearch().getValue() : '';\n\t\t\treturn this.#applySearchFilter(\n\t\t\t\tthis.#applyFieldsFilter(\n\t\t\t\t\tthis.#applyCategoriesFilter(fieldsList, filter),\n\t\t\t\t\tfilter,\n\t\t\t\t),\n\t\t\t\tquery,\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isFunction(filter))\n\t\t{\n\t\t\tconst defaultFilter = Runtime.clone(FieldSelector.#defaultFilter);\n\t\t\tif (!this.#isLeadEnabled())\n\t\t\t{\n\t\t\t\tdefaultFilter['-categories'].push('LEAD');\n\t\t\t}\n\n\t\t\tconst prefilteredFieldsList = this.#applyFieldsFilter(\n\t\t\t\tthis.#applyCategoriesFilter(fieldsList, defaultFilter),\n\t\t\t\tfilter,\n\t\t\t);\n\n\t\t\treturn filter(Runtime.clone(prefilteredFieldsList));\n\t\t}\n\n\t\treturn fieldsList;\n\t}\n\n\t#load(): Promise<any>\n\t{\n\t\tconst {controllerOptions = {}} = this.#getOptions();\n\t\treturn this.#getBackend()\n\t\t\t.getData({options: controllerOptions})\n\t\t\t.then(({data}) => {\n\t\t\t\tthis.#setFieldsList(data.fields);\n\t\t\t\tthis.#setIsLeadEnabled(data.options.isLeadEnabled);\n\t\t\t\tthis.#setIsAllowedCreateField(data.options.permissions.userField.add);\n\t\t\t});\n\t}\n\n\tstatic loadFieldList(options: ControllerOptions): Promise<any>\n\t{\n\t\treturn new Backend({\n\t\t\tevents: {\n\t\t\t\tonError: () => {},\n\t\t\t},\n\t\t}).getData({ options })\n\t\t\t.then(({ data }) => {\n\t\t\t\treturn data?.fields;\n\t\t\t})\n\t\t;\n\t}\n\n\t#setIsLeadEnabled(value: boolean)\n\t{\n\t\tthis.#cache.set('isLeadEnabled', value);\n\t}\n\n\t#isLeadEnabled(): boolean\n\t{\n\t\treturn this.#cache.get('isLeadEnabled');\n\t}\n\n\t#setIsAllowedCreateField(value: boolean)\n\t{\n\t\tthis.#cache.set('isAllowedCreateField', value);\n\t}\n\n\t#isAllowedCreateField(): boolean\n\t{\n\t\treturn this.#cache.get('isAllowedCreateField', false);\n\t}\n\n\t#getSidebarItems(): {[key: string]: any}\n\t{\n\t\treturn Object\n\t\t\t.entries(this.getFieldsList())\n\t\t\t.map(([categoryId, category]) => {\n\t\t\t\tlet label = category.CAPTION;\n\n\t\t\t\tObject.entries(this.#getOptions()?.categoryCaptions).forEach(([category, caption]) => {\n\t\t\t\t\tif (category === categoryId)\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel = caption;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn {\n\t\t\t\t\tlabel,\n\t\t\t\t\tid: categoryId,\n\t\t\t\t\tmoduleId: category?.MODULE_ID,\n\t\t\t\t\tonclick: this.#onSidebarItemClick.bind(this, categoryId),\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\t#getFilter(): SelectorFilter\n\t{\n\t\tconst customFilter = this.#getOptions().filter;\n\t\tif (Type.isPlainObject(customFilter))\n\t\t{\n\t\t\tconst defaultFilter = FieldSelector.#defaultFilter;\n\n\t\t\tif (Type.isArray(customFilter['-categories']))\n\t\t\t{\n\t\t\t\tcustomFilter['-categories'] = [\n\t\t\t\t\t...customFilter['-categories'],\n\t\t\t\t\t...defaultFilter['-categories'],\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcustomFilter['-categories'] = [\n\t\t\t\t\t...defaultFilter['-categories'],\n\t\t\t\t];\n\t\t\t}\n\n\t\t\tif (!this.#isLeadEnabled())\n\t\t\t{\n\t\t\t\tcustomFilter['-categories'].push('LEAD');\n\t\t\t}\n\n\t\t\tif (Type.isArray(customFilter['-fields']))\n\t\t\t{\n\t\t\t\tcustomFilter['-fields'] = [\n\t\t\t\t\t...customFilter['-fields'],\n\t\t\t\t\t...defaultFilter['-fields'],\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcustomFilter['-fields'] = [\n\t\t\t\t\t...defaultFilter['-fields'],\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\n\t\treturn customFilter;\n\t}\n\n\t#cleanFieldsList()\n\t{\n\t\tDom.clean(this.#getFieldsListLayout());\n\t}\n\n\t#getSelectedFields(): Array<Field>\n\t{\n\t\treturn this.#cache.get('selectedFields', []);\n\t}\n\n\t#addSelectedField(field: Field)\n\t{\n\t\tconst selectedFields = this.#getSelectedFields();\n\t\tconst hasField = selectedFields.some((currentField) => {\n\t\t\treturn currentField.name === field.name;\n\t\t});\n\n\t\tif (!hasField)\n\t\t{\n\t\t\tselectedFields.push(field);\n\t\t\tthis.#setSelectedFields(selectedFields);\n\t\t}\n\t}\n\n\t#removeSelectedField(field: Field)\n\t{\n\t\tconst selectedFields = this.#getSelectedFields().filter((currentField) => {\n\t\t\treturn currentField.name !== field.name;\n\t\t});\n\n\t\tthis.#setSelectedFields(selectedFields);\n\t}\n\n\t#setSelectedFields(fields: Array<Field>)\n\t{\n\t\tthis.#cache.set('selectedFields', fields);\n\t}\n\n\t#isMultiple(): boolean\n\t{\n\t\treturn this.#getOptions().multiple;\n\t}\n\n\t#renderCategoryFields(categoryId: string)\n\t{\n\t\tthis.#cleanFieldsList();\n\n\t\tconst fields = this.getFieldsList()[categoryId].FIELDS;\n\t\tif (Type.isArrayFilled(fields))\n\t\t{\n\t\t\tfields.forEach((field) => {\n\t\t\t\tvoid new ListItem({\n\t\t\t\t\tfield,\n\t\t\t\t\ttargetContainer: this.#getFieldsListLayout(),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonChange: this.#onListItemChange.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\tselected: this.#getSelectedFields().some((selectedField) => {\n\t\t\t\t\t\treturn selectedField.name === field.name;\n\t\t\t\t\t}),\n\t\t\t\t\ttype: this.#isMultiple() ? ListItem.Type.CHECKBOX : ListItem.Type.RADIO,\n\t\t\t\t\tdisabled: this.#isFieldDisabled(field),\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t#getDisabledFields(): SelectorOptions['disabledFields'] | null\n\t{\n\t\treturn this.#getOptions().disabledFields ?? null;\n\t}\n\n\t#isFieldDisabled(field: Field): boolean\n\t{\n\t\tconst disabledFields = this.#getDisabledFields();\n\t\tif (Type.isNull(disabledFields))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn disabledFields.some(fieldRule =>\n\t\t\t(Type.isString(fieldRule) && field.name === fieldRule)\n\t\t\t|| (Type.isFunction(fieldRule) && fieldRule(field)),\n\t\t);\n\t};\n\n\t#onListItemChange(event: BaseEvent)\n\t{\n\t\tconst listItem: ListItem = event.getTarget();\n\t\tif (this.#isMultiple())\n\t\t{\n\t\t\tif (listItem.isSelected())\n\t\t\t{\n\t\t\t\tthis.#addSelectedField(listItem.getField());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#removeSelectedField(listItem.getField());\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#setSelectedFields([listItem.getField()]);\n\t\t}\n\t}\n\n\t#onSidebarItemClick(categoryId: string)\n\t{\n\t\tthis.#renderCategoryFields(categoryId);\n\t}\n\n\t#onBackendError(error)\n\t{\n\t\tconsole.error(error);\n\t\tthis.emit('onError', {error});\n\t}\n\n\t#getLayout(): HTMLDivElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-b2e-fields-selector\">\n\t\t\t\t${this.#getFieldsListLayout()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tasync #onSearchChange()\n\t{\n\t\tconst sliderLayout: Layout = await this.#getSliderLayout();\n\t\tconst sidebarItems = this.#getSidebarItems();\n\t\tsliderLayout.getMenu().setItems(sidebarItems);\n\n\t\tthis.#cleanFieldsList();\n\n\t\tconst [firstSidebarItem] = sidebarItems;\n\t\tif (firstSidebarItem)\n\t\t{\n\t\t\tthis.#onSidebarItemClick(firstSidebarItem.id);\n\t\t\tsliderLayout.getMenu().setActiveFirstItem();\n\t\t\tif (this.#isAllowedCreateField())\n\t\t\t{\n\t\t\t\tthis.#getCreateFieldButton().setDisabled(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.#isAllowedCreateField())\n\t\t\t{\n\t\t\t\tthis.#getCreateFieldButton().setDisabled(true);\n\t\t\t}\n\t\t}\n\t}\n\n\t#getSearch(): Search\n\t{\n\t\treturn this.#cache.remember('search', () => {\n\t\t\treturn new Search({\n\t\t\t\tevents: {\n\t\t\t\t\tonChange: this.#onSearchChange.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#getFieldsListLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('fieldsListLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-b2e-fields-selector-fields-list\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getCreateFieldButton(): Button\n\t{\n\t\treturn this.#cache.remember('createFieldButton', () => {\n\t\t\treturn new Button({\n\t\t\t\ttext: Loc.getMessage('SIGN_B2E_FIELDS_SELECTOR_CREATE_BUTTON_LABEL'),\n\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\tonclick: this.#onCreateFieldClick.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tasync #onCreateFieldClick()\n\t{\n\t\tconst sliderLayout = await this.#getSliderLayout();\n\t\tconst sliderMenu = sliderLayout.getMenu();\n\t\tif (sliderMenu.hasActive())\n\t\t{\n\t\t\tconst currentCategoryId = sliderMenu.getActiveItem().getId();\n\t\t\tconst moduleId = sliderMenu.getActiveItem().getModuleId() || DEFAULT_FIELD_MODULE_ID;\n\t\t\tconst factory = this.#getUserFieldFactory(currentCategoryId, moduleId);\n\t\t\tconst menu = factory.getMenu();\n\n\t\t\tmenu.open((selectedType) => {\n\t\t\t\tconst configurator = factory.getConfigurator({\n\t\t\t\t\tuserField: factory.createUserField(selectedType),\n\t\t\t\t\tcanMultipleFields: false,\n\t\t\t\t\tcanRequiredFields: false,\n\t\t\t\t\tonSave: (userField) => {\n\t\t\t\t\t\tDom.addClass(configurator.saveButton, 'ui-btn-wait');\n\n\t\t\t\t\t\tconst languages = new Set(Object.keys(this.#getOptions().languages));\n\t\t\t\t\t\tconst currentLanguage = Loc.getMessage('LANGUAGE_ID');\n\t\t\t\t\t\tconst currentValue = userField.data.editFormLabel[currentLanguage];\n\t\t\t\t\t\tlanguages.forEach(lang => {\n\t\t\t\t\t\t\tuserField.data.editFormLabel[lang] = currentValue;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn userField\n\t\t\t\t\t\t\t.save()\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\treturn this.#load();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tDom.removeClass(configurator.saveButton, 'ui-btn-wait');\n\t\t\t\t\t\t\t\tthis.#onSidebarItemClick(currentCategoryId);\n\t\t\t\t\t\t\t\tthis.#getSearch().setValue(\n\t\t\t\t\t\t\t\t\tuserField.getData().editFormLabel[currentLanguage],\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\tthis.#onSidebarItemClick(currentCategoryId);\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tthis.#cleanFieldsList();\n\t\t\t\tDom.append(configurator.render(), this.#getFieldsListLayout());\n\t\t\t});\n\t\t}\n\t}\n\n\t#getPreparedCategoryId(categoryId: string): string | number\n\t{\n\t\tif (categoryId.startsWith('PROFILE'))\n\t\t{\n\t\t\treturn 'USER_LEGAL';\n\t\t}\n\n\t\tif (categoryId.startsWith('DYNAMIC_'))\n\t\t{\n\t\t\tconst fieldsList = this.getFieldsList();\n\t\t\tif (Type.isPlainObject(fieldsList[categoryId]))\n\t\t\t{\n\t\t\t\treturn fieldsList[categoryId].DYNAMIC_ID;\n\t\t\t}\n\t\t}\n\n\t\treturn `CRM_${categoryId}`;\n\t}\n\n\t#getFieldsFactoryTypesFilter(): FieldsFactoryFilter\n\t{\n\t\tconst defaultFilter = Runtime.clone(FieldSelector.#defaultFieldsFactoryFilter);\n\t\tconst customFilter = this.#getOptions()?.fieldsFactory?.filter;\n\n\t\tif (Type.isPlainObject(customFilter))\n\t\t{\n\t\t\tif (Type.isArrayFilled(customFilter['-types']))\n\t\t\t{\n\t\t\t\tcustomFilter['-types'] = [\n\t\t\t\t\t...defaultFilter['-types'],\n\t\t\t\t\t...customFilter['-types'],\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcustomFilter['-types'] = [\n\t\t\t\t\t...defaultFilter['-types'],\n\t\t\t\t];\n\t\t\t}\n\n\t\t\treturn customFilter;\n\t\t}\n\n\t\tif (Type.isFunction(customFilter))\n\t\t{\n\t\t\treturn customFilter;\n\t\t}\n\n\t\treturn defaultFilter;\n\t}\n\n\t#applyFieldsFactoryTypesFilter(types, filter): Array<any>\n\t{\n\t\tif (Type.isPlainObject(filter))\n\t\t{\n\t\t\treturn types.filter((type) => {\n\t\t\t\tconst allowed = (\n\t\t\t\t\t!Type.isArrayFilled(filter['+types'])\n\t\t\t\t\t|| filter['+types'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn type.name === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(type);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\tconst disallowed = (\n\t\t\t\t\tType.isArrayFilled(filter['-types'])\n\t\t\t\t\t&& filter['-types'].some((condition) => {\n\t\t\t\t\t\tif (Type.isStringFilled(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn type.name === condition;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isFunction(condition))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn condition(type);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\treturn allowed && !disallowed;\n\t\t\t});\n\t\t}\n\n\t\treturn types;\n\t}\n\n\t#getUserFieldFactory(categoryId: string | number, moduleId: string): Factory\n\t{\n\t\treturn this.#cache.remember(`factory_${categoryId}`, () => {\n\t\t\tconst rootWindow = window.top;\n\t\t\tconst Factory = (() => {\n\t\t\t\tif (rootWindow.BX.UI.UserFieldFactory)\n\t\t\t\t{\n\t\t\t\t\treturn rootWindow.BX.UI.UserFieldFactory.Factory;\n\t\t\t\t}\n\n\t\t\t\treturn BX.UI.UserFieldFactory.Factory;\n\t\t\t})();\n\n\t\t\tconst factory = new Factory(\n\t\t\t\tthis.#getPreparedCategoryId(categoryId),\n\t\t\t\t{\n\t\t\t\t\tmoduleId: moduleId || DEFAULT_FIELD_MODULE_ID,\n\t\t\t\t\tbindElement: this.#getCreateFieldButton().render(),\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tconst filter = this.#getFieldsFactoryTypesFilter();\n\t\t\tif (Type.isFunction(filter))\n\t\t\t{\n\t\t\t\tfactory.types = this.#applyFieldsFactoryTypesFilter(\n\t\t\t\t\tfactory.types,\n\t\t\t\t\tFieldSelector.defaultFieldsFactoryFilter,\n\t\t\t\t);\n\t\t\t\tfactory.types = filter(factory.types);\n\t\t\t}\n\n\t\t\tif (Type.isPlainObject(filter))\n\t\t\t{\n\t\t\t\tfactory.types = this.#applyFieldsFactoryTypesFilter(\n\t\t\t\t\tfactory.types,\n\t\t\t\t\tfilter,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn factory;\n\t\t});\n\t}\n\n\t#getTitle(): string\n\t{\n\t\tconst options = this.#getOptions();\n\n\t\tif (!Type.isStringFilled(options.title))\n\t\t{\n\t\t\treturn Loc.getMessage('SIGN_B2E_FIELDS_SELECTOR_SLIDER_FIRST_PARTY_TITLE');\n\t\t}\n\n\t\treturn options.title;\n\t}\n\n\t#getSliderLayout(): Promise<Layout>\n\t{\n\t\treturn this.#cache.remember('sliderLayout', () => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tLayout\n\t\t\t\t\t.createLayout({\n\t\t\t\t\t\textensions: ['sign.b2e.field-selector'],\n\t\t\t\t\t\ttitle: this.#getTitle(),\n\t\t\t\t\t\tcontent: () => {\n\t\t\t\t\t\t\treturn this.#getLayout();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmenu: {\n\t\t\t\t\t\t\titems: this.#getSidebarItems(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttoolbar: () => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tthis.#getSearch().getLayout(),\n\t\t\t\t\t\t\t\tthis.#getCreateFieldButton(),\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons: ({SaveButton, closeButton}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tnew SaveButton({\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_B2E_FIELDS_SELECTOR_APPLY_BUTTON_LABEL'),\n\t\t\t\t\t\t\t\t\tonclick: this.#onSaveClick.bind(this),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tcloseButton,\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t#getRenderedSliderLayout(): Promise<any>\n\t{\n\t\treturn this.#cache.remember('renderedSliderLayout', () => {\n\t\t\treturn this.#getSliderLayout().then((layout) => {\n\t\t\t\treturn layout.render();\n\t\t\t});\n\t\t});\n\t}\n\n\t#onSaveClick()\n\t{\n\t\tconst selectedFields = this.#getSelectedFields();\n\t\tconst result = (() => {\n\t\t\tconst {resultModifier} = this.#getOptions();\n\t\t\tif (Type.isFunction(resultModifier))\n\t\t\t{\n\t\t\t\treturn resultModifier(selectedFields);\n\t\t\t}\n\n\t\t\treturn selectedFields.map((field) => {\n\t\t\t\treturn field.name;\n\t\t\t});\n\t\t})();\n\n\t\tthis.#getPromiseResolver()(result);\n\t\tthis.hide();\n\t}\n\n\t#setPromiseResolver(resolver: () => void)\n\t{\n\t\tthis.#cache.set('promiseResolver', resolver);\n\t}\n\n\t#getPromiseResolver(): () => void\n\t{\n\t\treturn this.#cache.get('promiseResolver', () => {});\n\t}\n\n\t#selectFirstCategory()\n\t{\n\t\tconst [firstSidebarItem] = this.#getSidebarItems();\n\t\tif (Type.isPlainObject(firstSidebarItem))\n\t\t{\n\t\t\tthis.#onSidebarItemClick(firstSidebarItem.id);\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tconst SidePanel: BX.SidePanel = Reflection.getClass('BX.SidePanel');\n\t\tif (SidePanel.Instance)\n\t\t{\n\t\t\tSidePanel.Instance.close();\n\t\t}\n\t}\n\n\t#getSliderId(): string\n\t{\n\t\treturn this.#cache.remember('sliderId', () => {\n\t\t\treturn `sign.b2e.fields.selector-${Text.getRandom()}`\n\t\t});\n\t}\n\n\tshow(): Promise<Array<any>>\n\t{\n\t\tconst SidePanel: BX.SidePanel = Reflection.getClass('BX.SidePanel');\n\t\tif (SidePanel.Instance)\n\t\t{\n\t\t\tconst createFieldButton = this.#getCreateFieldButton();\n\t\t\tcreateFieldButton.setDisabled(true);\n\n\t\t\tSidePanel.Instance.open(\n\t\t\t\tthis.#getSliderId(),\n\t\t\t\t{\n\t\t\t\t\twidth: 740,\n\t\t\t\t\tcontentCallback: () => {\n\t\t\t\t\t\treturn this.#load()\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tcreateFieldButton.setDisabled(!this.#isAllowedCreateField());\n\t\t\t\t\t\t\t\tthis.#selectFirstCategory();\n\n\t\t\t\t\t\t\t\treturn this.#getRenderedSliderLayout();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(({errors}) => {\n\t\t\t\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t\t\t\t<div class=\"ui-alert ui-alert-danger\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"ui-alert-message\">${errors.map((item) => Text.encode(item.message)).join('\\n')}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonCloseComplete: () => this.#onSliderCloseComplete(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.#setPromiseResolver(resolve);\n\t\t});\n\t}\n\n\t#onSliderCloseComplete(): void\n\t{\n\t\tthis.emit('onSliderCloseComplete');\n\t\tthis.#setSelectedFields([]);\n\t}\n}\n"],"names":["Backend","EventEmitter","constructor","options","setEventNamespace","subscribeFromOptions","events","getData","requestOptions","action","data","Promise","resolve","reject","ajax","runAction","json","then","catch","Search","Cache","MemoryCache","getValue","value","setValue","getLayout","remember","Tag","render","set","get","emit","Runtime","debounce","initialValue","Type","isStringFilled","bind","Text","encode","Loc","getMessage","event","preventDefault","ListItem","targetContainer","isDomNode","renderTo","getField","field","isSelected","checked","fieldDisabledClassName","caption","Dom","append","type","CHECKBOX","selected","disabled","RADIO","DEFAULT_FIELD_MODULE_ID","FieldSelector","getFieldsList","filtering","fieldsList","filter","isPlainObject","query","isFunction","defaultFilter","clone","push","prefilteredFieldsList","loadFieldList","onError","fields","hide","SidePanel","Reflection","getClass","Instance","close","show","createFieldButton","setDisabled","open","width","contentCallback","errors","map","item","message","join","onCloseComplete","multiple","isObject","SMART_B2E_DOC","CAPTION","fieldsEntries","Object","entries","reduce","acc","categoryId","category","isArrayFilled","includes","filteredFields","FIELDS","allowed","some","condition","every","key","disallowed","preparedQuery","String","toLowerCase","controllerOptions","isLeadEnabled","permissions","userField","add","label","categoryCaptions","forEach","id","moduleId","MODULE_ID","onclick","customFilter","isArray","clean","selectedFields","hasField","currentField","name","onChange","selectedField","disabledFields","isNull","fieldRule","isString","listItem","getTarget","error","console","sliderLayout","sidebarItems","getMenu","setItems","firstSidebarItem","setActiveFirstItem","Button","text","color","Color","SUCCESS","sliderMenu","hasActive","currentCategoryId","getActiveItem","getId","getModuleId","factory","menu","selectedType","configurator","getConfigurator","createUserField","canMultipleFields","canRequiredFields","onSave","addClass","saveButton","languages","Set","keys","currentLanguage","currentValue","editFormLabel","lang","save","removeClass","onCancel","startsWith","DYNAMIC_ID","fieldsFactory","types","rootWindow","window","top","Factory","BX","UI","UserFieldFactory","bindElement","defaultFieldsFactoryFilter","title","Layout","createLayout","extensions","content","items","toolbar","buttons","SaveButton","closeButton","result","layout","resultModifier","resolver","getRandom"],"mappings":";;;;;CAC+B;AAQ/B,CAAe,MAAMA,OAAO,SAASC,6BAAY,CACjD;GACCC,WAAW,CAACC,OAAuB,EACnC;KACC,KAAK,EAAE;KAAC;OAAA;;KACR,IAAI,CAACC,iBAAiB,CAAC,oCAAoC,CAAC;KAC5D,IAAI,CAACC,oBAAoB,CAACF,OAAO,CAACG,MAAM,CAAC;;GAkB1CC,OAAO,CAACC,cAAc,GAAG,EAAE,EAC3B;KACC,+CAAO,IAAI,sBAAU;OACpBC,MAAM,EAAE,MAAM;OACdC,IAAI,EAAEF;MACN;;CAEH;CAAC,mBAtBSA,cAA4D,EACrE;GACC,OAAO,IAAIG,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;KACvCC,cAAI,CACFC,SAAS,CACR,0BAAyBP,cAAc,CAACC,MAAO,EAAC,EACjD;OACCO,IAAI,EAAER,cAAc,CAACE;MACrB,CACD,CACAO,IAAI,CAACL,OAAO,CAAC,CACbM,KAAK,CAACL,MAAM,CAAC;IACf,CAAC;CACH;;;;;;AC/BD,CAGyB;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAUzB,CAAe,MAAMM,MAAM,SAASlB,6BAAY,CAChD;GAGCC,WAAW,CAACC,QAAsB,GAAG,EAAE,EACvC;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OAJA,IAAIiB,eAAK,CAACC,WAAW;;KAK7B,IAAI,CAACjB,iBAAiB,CAAC,oCAAoC,CAAC;KAC5D,IAAI,CAACC,oBAAoB,CAACF,QAAO,CAACG,MAAM,CAAC;KACzC,4CAAI,4BAAaH,QAAO;;GAuDzBmB,QAAQ,GACR;KACC,OAAO,4CAAI,0BAAaC,KAAK;;GAU9BC,QAAQ,CAACD,KAAa,EACtB;KACC,4CAAI,0BAAaA,KAAK,GAAGA,KAAK;KAC9B,4CAAI;;GAeLE,SAAS,GACT;KACC,OAAO,4CAAI,kBAAQC,QAAQ,CAAC,QAAQ,EAAE,MAAM;OAC3C,OAAOC,aAAG,CAACC,MAAM,cAAC;;;;QAIf,CAAyB;QACzB,CAAmB;;;IAGtB,2CAJK,IAAI,+EACJ,IAAI;MAIT,CAAC;;CAEJ;CAAC,sBAhGYzB,OAAsB,EAClC;GACC,4CAAI,kBAAQ0B,GAAG,CAAC,SAAS,EAAE;KAAC,GAAG1B;IAAQ,CAAC;CACzC;CAAC,wBAGD;GACC,OAAO,4CAAI,kBAAQ2B,GAAG,CAAC,SAAS,EAAE,EAAE,CAAC;CACtC;CAAC,qBAGD;GACC,IAAI,CAACC,IAAI,CAAC,UAAU,EAAE;KAACR,KAAK,EAAE,4CAAI,0BAAaA;IAAM,CAAC;GACtD,4CAAI,+CAAwB;CAC7B;CAAC,gCAGD;GACC,OAAO,4CAAI,kBAAQG,QAAQ,CAAC,iBAAiB,EAAE,MAAM;KACpD,OAAOM,iBAAO,CAACC,QAAQ,CACtB,MAAM;OACL,IAAI,CAACF,IAAI,CAAC,mBAAmB,EAAE;SAACR,KAAK,EAAE,4CAAI,0BAAaA;QAAM,CAAC;MAC/D,EACD,EAAE,CACF;IACD,CAAC;CACH;CAAC,sBAGD;GACC,OAAO,4CAAI,kBAAQG,QAAQ,CAAC,OAAO,EAAE,MAAM;KAC1C,MAAMQ,YAAY,GAAG,CAAC,MAAM;OAC3B,IAAIC,cAAI,CAACC,cAAc,CAAC,4CAAI,8BAAeF,YAAY,CAAC,EACxD;SACC,OAAO,4CAAI,8BAAeA,YAAY;;OAGvC,OAAO,EAAE;MACT,GAAG;KAEJ,OAAOP,aAAG,CAACC,MAAM,gBAAC;;;;gBAIP,CAA2B;cAC7B,CAA4B;oBACtB,CAAgE;;IAE/E,GAJa,4CAAI,sBAAUS,IAAI,CAAC,IAAI,CAAC,EAC1BC,cAAI,CAACC,MAAM,CAACL,YAAY,CAAC,EACnBM,aAAG,CAACC,UAAU,CAAC,6CAA6C,CAAC;IAG9E,CAAC;CACH;CAAC,wBAOaC,KAAiB,EAC/B;GACCA,KAAK,CAACC,cAAc,EAAE;GACtB,4CAAI,0BAAapB,KAAK,GAAG,EAAE;GAC3B,4CAAI;CACL;CAAC,4BASD;GACC,OAAO,4CAAI,kBAAQG,QAAQ,CAAC,aAAa,EAAE,MAAM;KAChD,OAAOC,aAAG,CAACC,MAAM,gBAAC;;;gBAGP,CAAgC;;IAE3C,GAFa,4CAAI,gCAAeS,IAAI,CAAC,IAAI,CAAC;IAG1C,CAAC;CACH;;;;;ACzGD,CAKyB;CAAA;CAAA;CAAA;CAAA;CAAA;AAazB,CAAe,MAAMO,QAAQ,SAAS3C,6BAAY,CAClD;GAQCC,WAAW,CAACC,QAAwB,EACpC;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OAJA,IAAIiB,eAAK,CAACC,WAAW;;KAK7B,IAAI,CAACjB,iBAAiB,CAAC,oCAAoC,CAAC;KAC5D,IAAI,CAACC,oBAAoB,CAACF,QAAO,CAACG,MAAM,CAAC;KACzC,4CAAI,gCAAaH,QAAO;KAExB,MAAM;OAAC0C;MAAgB,GAAG1C,QAAO;KACjC,IAAIgC,cAAI,CAACW,SAAS,CAACD,eAAe,CAAC,EACnC;OACC,IAAI,CAACE,QAAQ,CAACF,eAAe,CAAC;;;GAchCG,QAAQ,GACR;KACC,OAAO,4CAAI,kCAAeC,KAAK;;GAuBhCC,UAAU,GACV;KACC,OAAO,4CAAI,gCAAgBC,OAAO;;GAQnC1B,SAAS,GACT;KACC,OAAO,4CAAI,sBAAQC,QAAQ,CAAE,QAAO,EAAE,MAAM;OAC3C,MAAM0B,sBAAsB,GAAG,0CAA0C;OACzE,OAAOzB,aAAG,CAACC,MAAM,oBAAC;gDACyB,CAAyD;;QAEjG,CAAsB;uCACS,CAAgD;;;IAGlF,GAN6C,4CAAI,gCAAiB,GAAG,GAAGwB,sBAAsB,GAAG,EAAE,0CAE9F,IAAI,iCAC2Bd,cAAI,CAACC,MAAM,CAAC,4CAAI,kCAAeU,KAAK,CAACI,OAAO,CAAC;MAIjF,CAAC;;GAGHN,QAAQ,CAACF,eAA4B,EACrC;KACC,IAAIV,cAAI,CAACW,SAAS,CAACD,eAAe,CAAC,EACnC;OACCS,aAAG,CAACC,MAAM,CAAC,IAAI,CAAC9B,SAAS,EAAE,EAAEoB,eAAe,CAAC;;;CAGhD;CAAC,wBAnEY1C,OAAwB,EACpC;GACC,4CAAI,sBAAQ0B,GAAG,CAAC,SAAS,EAAE;KAAC2B,IAAI,EAAEZ,QAAQ,CAACT,IAAI,CAACsB,QAAQ;KAAE,GAAGtD;IAAQ,CAAC;CACvE;CAAC,0BAGD;GACC,OAAO,4CAAI,sBAAQ2B,GAAG,CAAC,SAAS,EAAE,EAAE,CAAC;CACtC;CAAC,sBAQD;GACC,IAAI,CAACC,IAAI,CAAC,UAAU,CAAC;CACtB;CAAC,yBAGD;GACC,OAAO,4CAAI,sBAAQL,QAAQ,CAAC,UAAU,EAAE,MAAM;KAC7C,OAAOC,aAAG,CAACC,MAAM,sBAAC;;aAEV,CAAuC;;iBAEnC,CAA4B;;OAEtC,CAA+C;;IAEjD,GANUU,cAAI,CAACC,MAAM,CAAC,4CAAI,kCAAeiB,IAAI,CAAC,EAEhC,4CAAI,wBAAWnB,IAAI,CAAC,IAAI,CAAC,EAEnC,4CAAI,kCAAeqB,QAAQ,GAAG,SAAS,GAAG,EAAE;IAGhD,CAAC;CACH;CAAC,wBAQD;GAAA;GACC,gCAAO,4CAAI,kCAAeC,QAAQ,oCAAI,KAAK;CAC5C;CAlEoBf,QAAQ,CAErBT,IAAI,GAAG;GACbsB,QAAQ,EAAE,UAAU;GACpBG,KAAK,EAAE;CACR,CAAC;;;;;;ACvBF,CAgBA,MAAMC,uBAAuB,GAAG,KAAK;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEtC,CAAO,MAAMC,aAAa,SAAS7D,6BAAY,CAC/C;GAmBCC,WAAW,CAACC,QAAwB,GAAG,EAAE,EACzC;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OApBA,IAAIiB,eAAK,CAACC,WAAW;;KAqB7B,IAAI,CAACjB,iBAAiB,CAAC,4BAA4B,CAAC;KACpD,IAAI,CAACC,oBAAoB,CAACF,QAAO,CAACG,MAAM,CAAC;KACzC,4CAAI,gCAAaH,QAAO;;GAkKzB4D,aAAa,CAACC,SAAkB,GAAG,IAAI,EACvC;KACC,MAAMC,UAAU,GAAG,4CAAI,sBAAQnC,GAAG,CAAC,YAAY,EAAE,EAAE,CAAC;KAEpD,MAAMoC,MAAM,2CAAG,IAAI,2BAAa;KAChC,IAAI/B,cAAI,CAACgC,aAAa,CAACD,MAAM,CAAC,EAC9B;OACC,MAAME,KAAK,GAAGJ,SAAS,GAAG,4CAAI,4BAAc1C,QAAQ,EAAE,GAAG,EAAE;OAC3D,+CAAO,IAAI,kFACV,IAAI,kFACH,IAAI,kDAAwB2C,UAAU,EAAEC,MAAM,GAC9CA,MAAM,GAEPE,KAAK;;KAIP,IAAIjC,cAAI,CAACkC,UAAU,CAACH,MAAM,CAAC,EAC3B;OACC,MAAMI,aAAa,GAAGtC,iBAAO,CAACuC,KAAK,yCAACT,aAAa,kCAAgB;OACjE,IAAI,yCAAC,IAAI,mCAAiB,EAC1B;SACCQ,aAAa,CAAC,aAAa,CAAC,CAACE,IAAI,CAAC,MAAM,CAAC;;OAG1C,MAAMC,qBAAqB,2CAAG,IAAI,kFACjC,IAAI,kDAAwBR,UAAU,EAAEK,aAAa,GACrDJ,MAAM,CACN;OAED,OAAOA,MAAM,CAAClC,iBAAO,CAACuC,KAAK,CAACE,qBAAqB,CAAC,CAAC;;KAGpD,OAAOR,UAAU;;GAelB,OAAOS,aAAa,CAACvE,OAA0B,EAC/C;KACC,OAAO,IAAIH,OAAO,CAAC;OAClBM,MAAM,EAAE;SACPqE,OAAO,EAAE,MAAM;;MAEhB,CAAC,CAACpE,OAAO,CAAC;OAAEJ;MAAS,CAAC,CACrBc,IAAI,CAAC,CAAC;OAAEP;MAAM,KAAK;OACnB,OAAOA,IAAI,oBAAJA,IAAI,CAAEkE,MAAM;MACnB,CAAC;;GAijBJC,IAAI,GACJ;KACC,MAAMC,SAAuB,GAAGC,oBAAU,CAACC,QAAQ,CAAC,cAAc,CAAC;KACnE,IAAIF,SAAS,CAACG,QAAQ,EACtB;OACCH,SAAS,CAACG,QAAQ,CAACC,KAAK,EAAE;;;GAW5BC,IAAI,GACJ;KACC,MAAML,SAAuB,GAAGC,oBAAU,CAACC,QAAQ,CAAC,cAAc,CAAC;KACnE,IAAIF,SAAS,CAACG,QAAQ,EACtB;OACC,MAAMG,iBAAiB,2CAAG,IAAI,iDAAwB;OACtDA,iBAAiB,CAACC,WAAW,CAAC,IAAI,CAAC;OAEnCP,SAAS,CAACG,QAAQ,CAACK,IAAI,yCACtB,IAAI,iCACJ;SACCC,KAAK,EAAE,GAAG;SACVC,eAAe,EAAE,MAAM;WACtB,OAAO,4CAAI,kBACTvE,IAAI,CAAC,MAAM;aACXmE,iBAAiB,CAACC,WAAW,CAAC,yCAAC,IAAI,iDAAwB,CAAC;aAC5D,4CAAI;aAEJ,+CAAO,IAAI;YACX,CAAC,CACDnE,KAAK,CAAC,CAAC;aAACuE;YAAO,KAAK;aACpB,OAAO9D,aAAG,CAACC,MAAM,oBAAC;;2CAEe,CAA6D;;SAE9F,GAFmC6D,MAAM,CAACC,GAAG,CAAEC,IAAI,IAAKrD,cAAI,CAACC,MAAM,CAACoD,IAAI,CAACC,OAAO,CAAC,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;YAG7F,CAAC;UACH;SACDvF,MAAM,EAAE;WACPwF,eAAe,EAAE,8CAAM,IAAI;;QAE5B,CACD;;KAGF,OAAO,IAAInF,OAAO,CAAEC,OAAO,IAAK;OAC/B,4CAAI,4CAAqBA,OAAO;MAChC,CAAC;;CAQJ;CAAC,wBAt0BYT,OAAwB,EACpC;GACC,4CAAI,sBAAQ0B,GAAG,CACd,SAAS,EACT;KACCqC,MAAM,EAAE,EAAE;KACV6B,QAAQ,EAAE,IAAI;KACd,GAAG5F;IACH,CACD;CACF;CAAC,0BAGD;GACC,OAAO6B,iBAAO,CAACuC,KAAK,CAAC,4CAAI,sBAAQzC,GAAG,CAAC,SAAS,EAAE;KAACoC,MAAM,EAAE;IAAG,CAAC,CAAC;CAC/D;CAAC,wBAGD;GACC,OAAO,4CAAI,sBAAQxC,QAAQ,CAAC,SAAS,EAAE,MAAM;KAC5C,OAAO,IAAI1B,OAAO,CAAC;OAClBM,MAAM,EAAE;SACPqE,OAAO,EAAE,4CAAI,oCAAiBtC,IAAI,CAAC,IAAI;;MAExC,CAAC;IACF,CAAC;CACH;CAAC,yBAEc4B,UAAsB,EACrC;GACC,IAAI9B,cAAI,CAAC6D,QAAQ,CAAC/B,UAAU,CAACgC,aAAa,CAAC,EAC3C;KACChC,UAAU,CAACgC,aAAa,CAACC,OAAO,GAAG1D,aAAG,CAACC,UAAU,CAAC,yDAAyD,CAAC;;GAG7G,4CAAI,sBAAQZ,GAAG,CAAC,YAAY,EAAE;KAAC,GAAGoC;IAAW,CAAC;CAC/C;CAAC,iCAEsBA,UAAsB,EAAEC,MAAsB,EACrE;GACC,MAAMiC,aAAa,GAAGC,MAAM,CAACC,OAAO,CAACpC,UAAU,CAAC;GAEhD,OAAOkC,aAAa,CAACG,MAAM,CAAC,CAACC,GAAG,EAAE,CAACC,UAAU,EAAEC,QAAQ,CAAC,KAAK;KAC5D,IACC,CACC,CAACtE,cAAI,CAACuE,aAAa,CAACxC,MAAM,CAAC,aAAa,CAAC,CAAC,IACvCA,MAAM,CAAC,aAAa,CAAC,CAACyC,QAAQ,CAACH,UAAU,CAAC,MAG7C,CAACrE,cAAI,CAACuE,aAAa,CAACxC,MAAM,CAAC,aAAa,CAAC,CAAC,IACvC,CAACA,MAAM,CAAC,aAAa,CAAC,CAACyC,QAAQ,CAACH,UAAU,CAAC,CAC9C,EAEF;OACCD,GAAG,CAACC,UAAU,CAAC,GAAGC,QAAQ;;KAG3B,OAAOF,GAAG;IACV,EAAE,EAAE,CAAC;CACP;CAAC,6BAEkBtC,UAAsB,EAAEC,MAAsB,EACjE;GACC,MAAMiC,aAAa,GAAGC,MAAM,CAACC,OAAO,CAACpC,UAAU,CAAC;GAEhD,OAAOkC,aAAa,CAACG,MAAM,CAAC,CAACC,GAAG,EAAE,CAACC,UAAU,EAAEC,QAAQ,CAAC,KAAK;KAC5D,MAAMG,cAAc,GAAGH,QAAQ,CAACI,MAAM,CAAC3C,MAAM,CAAEjB,KAAK,IAAK;OACxD,MAAM6D,OAAO,GACZ,CAAC3E,cAAI,CAACuE,aAAa,CAACxC,MAAM,CAAC,SAAS,CAAC,CAAC,IACnCA,MAAM,CAAC,SAAS,CAAC,CAAC6C,IAAI,CAAEC,SAAS,IAAK;SACxC,IAAI7E,cAAI,CAACC,cAAc,CAAC4E,SAAS,CAAC,EAClC;WACC,OAAO/D,KAAK,CAACO,IAAI,KAAKwD,SAAS;;SAGhC,IAAI7E,cAAI,CAACkC,UAAU,CAAC2C,SAAS,CAAC,EAC9B;WACC,OAAOA,SAAS,CAAC/D,KAAK,CAAC;;SAGxB,IAAId,cAAI,CAACgC,aAAa,CAAC6C,SAAS,CAAC,EACjC;WACC,OAAOZ,MAAM,CAACC,OAAO,CAACW,SAAS,CAAC,CAACC,KAAK,CAAC,CAAC,CAACC,GAAG,EAAE3F,KAAK,CAAC,KAAK;aACxD,OAAO0B,KAAK,CAACiE,GAAG,CAAC,KAAK3F,KAAK;YAC3B,CAAC;;SAGH,OAAO,KAAK;QACZ,CACD;OAED,MAAM4F,UAAU,GACfhF,cAAI,CAACuE,aAAa,CAACxC,MAAM,CAAC,SAAS,CAAC,CAAC,IAClCA,MAAM,CAAC,SAAS,CAAC,CAAC6C,IAAI,CAAEC,SAAS,IAAK;SACxC,IAAI7E,cAAI,CAACC,cAAc,CAAC4E,SAAS,CAAC,EAClC;WACC,OAAO/D,KAAK,CAACO,IAAI,KAAKwD,SAAS;;SAGhC,IAAI7E,cAAI,CAACkC,UAAU,CAAC2C,SAAS,CAAC,EAC9B;WACC,OAAOA,SAAS,CAAC/D,KAAK,CAAC;;SAGxB,IAAId,cAAI,CAACgC,aAAa,CAAC6C,SAAS,CAAC,EACjC;WACC,OAAOZ,MAAM,CAACC,OAAO,CAACW,SAAS,CAAC,CAACC,KAAK,CAAC,CAAC,CAACC,GAAG,EAAE3F,KAAK,CAAC,KAAK;aACxD,OAAO0B,KAAK,CAACiE,GAAG,CAAC,KAAK3F,KAAK;YAC3B,CAAC;;SAGH,OAAO,KAAK;QACZ,CACD;OAED,OAAOuF,OAAO,IAAI,CAACK,UAAU;MAC7B,CAAC;KAEF,IAAIhF,cAAI,CAACuE,aAAa,CAACE,cAAc,CAAC,EACtC;OACCL,GAAG,CAACC,UAAU,CAAC,GAAG;SACjB,GAAGC,QAAQ;SACXI,MAAM,EAAED;QACR;;KAGF,OAAOL,GAAG;IACV,EAAE,EAAE,CAAC;CACP;CAAC,6BAEkBtC,UAAsB,EAAEG,KAAK,EAChD;GACC,MAAM+B,aAAa,GAAGC,MAAM,CAACC,OAAO,CAACpC,UAAU,CAAC;GAChD,IAAI9B,cAAI,CAACC,cAAc,CAACgC,KAAK,CAAC,EAC9B;KACC,MAAMgD,aAAa,GAAGC,MAAM,CAACjD,KAAK,CAAC,CAACkD,WAAW,EAAE;KACjD,OAAOnB,aAAa,CAACG,MAAM,CAAC,CAACC,GAAG,EAAE,CAACC,UAAU,EAAEC,QAAQ,CAAC,KAAK;OAC5D,MAAMG,cAAc,GAAGH,QAAQ,CAACI,MAAM,CAAC3C,MAAM,CAAEjB,KAAK,IAAK;SACxD,OACCd,cAAI,CAACC,cAAc,CAACa,KAAK,CAACI,OAAO,CAAC,IAC/BgE,MAAM,CAACpE,KAAK,CAACI,OAAO,CAAC,CAACiE,WAAW,EAAE,CAACX,QAAQ,CAACS,aAAa,CAAC;QAE/D,CAAC;OAEF,IAAIjF,cAAI,CAACuE,aAAa,CAACE,cAAc,CAAC,EACtC;SACCL,GAAG,CAACC,UAAU,CAAC,GAAG;WACjB,GAAGC,QAAQ;WACXI,MAAM,EAAED;UACR;;OAGF,OAAOL,GAAG;MACV,EAAE,EAAE,CAAC;;GAGP,OAAOtC,UAAU;CAClB;CAAC,kBAuCD;GACC,MAAM;KAACsD,iBAAiB,GAAG;IAAG,2CAAG,IAAI,iCAAc;GACnD,OAAO,4CAAI,8BACThH,OAAO,CAAC;KAACJ,OAAO,EAAEoH;IAAkB,CAAC,CACrCtG,IAAI,CAAC,CAAC;KAACP;IAAK,KAAK;KACjB,4CAAI,kCAAgBA,IAAI,CAACkE,MAAM;KAC/B,4CAAI,wCAAmBlE,IAAI,CAACP,OAAO,CAACqH,aAAa;KACjD,4CAAI,sDAA0B9G,IAAI,CAACP,OAAO,CAACsH,WAAW,CAACC,SAAS,CAACC,GAAG;IACpE,CAAC;CACJ;CAAC,4BAeiBpG,KAAc,EAChC;GACC,4CAAI,sBAAQM,GAAG,CAAC,eAAe,EAAEN,KAAK,CAAC;CACxC;CAAC,2BAGD;GACC,OAAO,4CAAI,sBAAQO,GAAG,CAAC,eAAe,CAAC;CACxC;CAAC,mCAEwBP,KAAc,EACvC;GACC,4CAAI,sBAAQM,GAAG,CAAC,sBAAsB,EAAEN,KAAK,CAAC;CAC/C;CAAC,kCAGD;GACC,OAAO,4CAAI,sBAAQO,GAAG,CAAC,sBAAsB,EAAE,KAAK,CAAC;CACtD;CAAC,6BAGD;GACC,OAAOsE,MAAM,CACXC,OAAO,CAAC,IAAI,CAACtC,aAAa,EAAE,CAAC,CAC7B2B,GAAG,CAAC,CAAC,CAACc,UAAU,EAAEC,QAAQ,CAAC,KAAK;KAAA;KAChC,IAAImB,KAAK,GAAGnB,QAAQ,CAACP,OAAO;KAE5BE,MAAM,CAACC,OAAO,kEAAC,IAAI,sDAAJ,sBAAoBwB,gBAAgB,CAAC,CAACC,OAAO,CAAC,CAAC,CAACrB,QAAQ,EAAEpD,OAAO,CAAC,KAAK;OACrF,IAAIoD,QAAQ,KAAKD,UAAU,EAC3B;SACCoB,KAAK,GAAGvE,OAAO;;MAEhB,CAAC;KAEF,OAAO;OACNuE,KAAK;OACLG,EAAE,EAAEvB,UAAU;OACdwB,QAAQ,EAAEvB,QAAQ,oBAARA,QAAQ,CAAEwB,SAAS;OAC7BC,OAAO,EAAE,4CAAI,4CAAqB7F,IAAI,CAAC,IAAI,EAAEmE,UAAU;MACvD;IACD,CAAC;CACJ;CAAC,uBAGD;GACC,MAAM2B,YAAY,GAAG,4CAAI,kCAAejE,MAAM;GAC9C,IAAI/B,cAAI,CAACgC,aAAa,CAACgE,YAAY,CAAC,EACpC;KACC,MAAM7D,aAAa,2CAAGR,aAAa,iCAAe;KAElD,IAAI3B,cAAI,CAACiG,OAAO,CAACD,YAAY,CAAC,aAAa,CAAC,CAAC,EAC7C;OACCA,YAAY,CAAC,aAAa,CAAC,GAAG,CAC7B,GAAGA,YAAY,CAAC,aAAa,CAAC,EAC9B,GAAG7D,aAAa,CAAC,aAAa,CAAC,CAC/B;MACD,MAED;OACC6D,YAAY,CAAC,aAAa,CAAC,GAAG,CAC7B,GAAG7D,aAAa,CAAC,aAAa,CAAC,CAC/B;;KAGF,IAAI,yCAAC,IAAI,mCAAiB,EAC1B;OACC6D,YAAY,CAAC,aAAa,CAAC,CAAC3D,IAAI,CAAC,MAAM,CAAC;;KAGzC,IAAIrC,cAAI,CAACiG,OAAO,CAACD,YAAY,CAAC,SAAS,CAAC,CAAC,EACzC;OACCA,YAAY,CAAC,SAAS,CAAC,GAAG,CACzB,GAAGA,YAAY,CAAC,SAAS,CAAC,EAC1B,GAAG7D,aAAa,CAAC,SAAS,CAAC,CAC3B;MACD,MAED;OACC6D,YAAY,CAAC,SAAS,CAAC,GAAG,CACzB,GAAG7D,aAAa,CAAC,SAAS,CAAC,CAC3B;;;GAIH,OAAO6D,YAAY;CACpB;CAAC,6BAGD;GACC7E,aAAG,CAAC+E,KAAK,yCAAC,IAAI,gDAAwB;CACvC;CAAC,+BAGD;GACC,OAAO,4CAAI,sBAAQvG,GAAG,CAAC,gBAAgB,EAAE,EAAE,CAAC;CAC7C;CAAC,4BAEiBmB,KAAY,EAC9B;GACC,MAAMqF,cAAc,2CAAG,IAAI,2CAAqB;GAChD,MAAMC,QAAQ,GAAGD,cAAc,CAACvB,IAAI,CAAEyB,YAAY,IAAK;KACtD,OAAOA,YAAY,CAACC,IAAI,KAAKxF,KAAK,CAACwF,IAAI;IACvC,CAAC;GAEF,IAAI,CAACF,QAAQ,EACb;KACCD,cAAc,CAAC9D,IAAI,CAACvB,KAAK,CAAC;KAC1B,4CAAI,0CAAoBqF,cAAc;;CAExC;CAAC,+BAEoBrF,KAAY,EACjC;GACC,MAAMqF,cAAc,GAAG,4CAAI,4CAAsBpE,MAAM,CAAEsE,YAAY,IAAK;KACzE,OAAOA,YAAY,CAACC,IAAI,KAAKxF,KAAK,CAACwF,IAAI;IACvC,CAAC;GAEF,4CAAI,0CAAoBH,cAAc;CACvC;CAAC,6BAEkB1D,MAAoB,EACvC;GACC,4CAAI,sBAAQ/C,GAAG,CAAC,gBAAgB,EAAE+C,MAAM,CAAC;CAC1C;CAAC,wBAGD;GACC,OAAO,4CAAI,kCAAemB,QAAQ;CACnC;CAAC,gCAEqBS,UAAkB,EACxC;GACC,4CAAI;GAEJ,MAAM5B,MAAM,GAAG,IAAI,CAACb,aAAa,EAAE,CAACyC,UAAU,CAAC,CAACK,MAAM;GACtD,IAAI1E,cAAI,CAACuE,aAAa,CAAC9B,MAAM,CAAC,EAC9B;KACCA,MAAM,CAACkD,OAAO,CAAE7E,KAAK,IAAK;OACzB,KAAK,IAAIL,QAAQ,CAAC;SACjBK,KAAK;SACLJ,eAAe,0CAAE,IAAI,+CAAuB;SAC5CvC,MAAM,EAAE;WACPoI,QAAQ,EAAE,4CAAI,wCAAmBrG,IAAI,CAAC,IAAI;UAC1C;SACDqB,QAAQ,EAAE,4CAAI,4CAAsBqD,IAAI,CAAE4B,aAAa,IAAK;WAC3D,OAAOA,aAAa,CAACF,IAAI,KAAKxF,KAAK,CAACwF,IAAI;UACxC,CAAC;SACFjF,IAAI,EAAE,4CAAI,gCAAiBZ,QAAQ,CAACT,IAAI,CAACsB,QAAQ,GAAGb,QAAQ,CAACT,IAAI,CAACyB,KAAK;SACvED,QAAQ,0CAAE,IAAI,sCAAkBV,KAAK;QACrC,CAAC;MACF,CAAC;;CAEJ;CAAC,+BAGD;GAAA;GACC,iCAAO,4CAAI,kCAAe2F,cAAc,qCAAI,IAAI;CACjD;CAAC,2BAEgB3F,KAAY,EAC7B;GACC,MAAM2F,cAAc,2CAAG,IAAI,2CAAqB;GAChD,IAAIzG,cAAI,CAAC0G,MAAM,CAACD,cAAc,CAAC,EAC/B;KACC,OAAO,KAAK;;GAGb,OAAOA,cAAc,CAAC7B,IAAI,CAAC+B,SAAS,IAClC3G,cAAI,CAAC4G,QAAQ,CAACD,SAAS,CAAC,IAAI7F,KAAK,CAACwF,IAAI,KAAKK,SAAS,IACjD3G,cAAI,CAACkC,UAAU,CAACyE,SAAS,CAAC,IAAIA,SAAS,CAAC7F,KAAK,CAAE,CACnD;CACF;CAAC,4BAEiBP,KAAgB,EAClC;GACC,MAAMsG,QAAkB,GAAGtG,KAAK,CAACuG,SAAS,EAAE;GAC5C,4CAAI,IAAI,+BACR;KACC,IAAID,QAAQ,CAAC9F,UAAU,EAAE,EACzB;OACC,4CAAI,wCAAmB8F,QAAQ,CAAChG,QAAQ,EAAE;MAC1C,MAED;OACC,4CAAI,8CAAsBgG,QAAQ,CAAChG,QAAQ,EAAE;;IAE9C,MAED;KACC,4CAAI,0CAAoB,CAACgG,QAAQ,CAAChG,QAAQ,EAAE,CAAC;;CAE/C;CAAC,8BAEmBwD,UAAkB,EACtC;GACC,4CAAI,gDAAuBA,UAAU;CACtC;CAAC,0BAEe0C,KAAK,EACrB;GACCC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;GACpB,IAAI,CAACnH,IAAI,CAAC,SAAS,EAAE;KAACmH;IAAM,CAAC;CAC9B;CAAC,uBAGD;GACC,OAAOvH,aAAG,CAACC,MAAM,sBAAC;;MAEhB,CAA8B;;GAEhC,2CAFI,IAAI;CAGT;CAAC,kCAGD;GACC,MAAMwH,YAAoB,GAAG,8CAAM,IAAI,uCAAmB;GAC1D,MAAMC,YAAY,2CAAG,IAAI,uCAAmB;GAC5CD,YAAY,CAACE,OAAO,EAAE,CAACC,QAAQ,CAACF,YAAY,CAAC;GAE7C,4CAAI;GAEJ,MAAM,CAACG,gBAAgB,CAAC,GAAGH,YAAY;GACvC,IAAIG,gBAAgB,EACpB;KACC,4CAAI,4CAAqBA,gBAAgB,CAACzB,EAAE;KAC5CqB,YAAY,CAACE,OAAO,EAAE,CAACG,kBAAkB,EAAE;KAC3C,4CAAI,IAAI,mDACR;OACC,4CAAI,kDAAyBpE,WAAW,CAAC,KAAK,CAAC;;IAEhD,MAED;KACC,4CAAI,IAAI,mDACR;OACC,4CAAI,kDAAyBA,WAAW,CAAC,IAAI,CAAC;;;CAGjD;CAAC,uBAGD;GACC,OAAO,4CAAI,sBAAQ3D,QAAQ,CAAC,QAAQ,EAAE,MAAM;KAC3C,OAAO,IAAIP,MAAM,CAAC;OACjBb,MAAM,EAAE;SACPoI,QAAQ,EAAE,4CAAI,oCAAiBrG,IAAI,CAAC,IAAI;;MAEzC,CAAC;IACF,CAAC;CACH;CAAC,iCAGD;GACC,OAAO,4CAAI,sBAAQX,QAAQ,CAAC,kBAAkB,EAAE,MAAM;KACrD,OAAOC,aAAG,CAACC,MAAM,sBAAC;;IAElB;IACA,CAAC;CACH;CAAC,kCAGD;GACC,OAAO,4CAAI,sBAAQF,QAAQ,CAAC,mBAAmB,EAAE,MAAM;KACtD,OAAO,IAAIgI,iBAAM,CAAC;OACjBC,IAAI,EAAEnH,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC;OACpEmH,KAAK,EAAEF,iBAAM,CAACG,KAAK,CAACC,OAAO;OAC3B5B,OAAO,EAAE,4CAAI,4CAAqB7F,IAAI,CAAC,IAAI;MAC3C,CAAC;IACF,CAAC;CACH;CAAC,sCAGD;GACC,MAAM+G,YAAY,GAAG,8CAAM,IAAI,uCAAmB;GAClD,MAAMW,UAAU,GAAGX,YAAY,CAACE,OAAO,EAAE;GACzC,IAAIS,UAAU,CAACC,SAAS,EAAE,EAC1B;KACC,MAAMC,iBAAiB,GAAGF,UAAU,CAACG,aAAa,EAAE,CAACC,KAAK,EAAE;KAC5D,MAAMnC,QAAQ,GAAG+B,UAAU,CAACG,aAAa,EAAE,CAACE,WAAW,EAAE,IAAIvG,uBAAuB;KACpF,MAAMwG,OAAO,2CAAG,IAAI,8CAAsBJ,iBAAiB,EAAEjC,QAAQ,CAAC;KACtE,MAAMsC,IAAI,GAAGD,OAAO,CAACf,OAAO,EAAE;KAE9BgB,IAAI,CAAChF,IAAI,CAAEiF,YAAY,IAAK;OAC3B,MAAMC,YAAY,GAAGH,OAAO,CAACI,eAAe,CAAC;SAC5C/C,SAAS,EAAE2C,OAAO,CAACK,eAAe,CAACH,YAAY,CAAC;SAChDI,iBAAiB,EAAE,KAAK;SACxBC,iBAAiB,EAAE,KAAK;SACxBC,MAAM,EAAGnD,SAAS,IAAK;WACtBpE,aAAG,CAACwH,QAAQ,CAACN,YAAY,CAACO,UAAU,EAAE,aAAa,CAAC;WAEpD,MAAMC,SAAS,GAAG,IAAIC,GAAG,CAAC7E,MAAM,CAAC8E,IAAI,CAAC,4CAAI,kCAAeF,SAAS,CAAC,CAAC;WACpE,MAAMG,eAAe,GAAG3I,aAAG,CAACC,UAAU,CAAC,aAAa,CAAC;WACrD,MAAM2I,YAAY,GAAG1D,SAAS,CAAChH,IAAI,CAAC2K,aAAa,CAACF,eAAe,CAAC;WAClEH,SAAS,CAAClD,OAAO,CAACwD,IAAI,IAAI;aACzB5D,SAAS,CAAChH,IAAI,CAAC2K,aAAa,CAACC,IAAI,CAAC,GAAGF,YAAY;YACjD,CAAC;WAEF,OAAO1D,SAAS,CACd6D,IAAI,EAAE,CACNtK,IAAI,CAAC,MAAM;aACX,+CAAO,IAAI;YACX,CAAC,CACDA,IAAI,CAAC,MAAM;aACXqC,aAAG,CAACkI,WAAW,CAAChB,YAAY,CAACO,UAAU,EAAE,aAAa,CAAC;aACvD,4CAAI,4CAAqBd,iBAAiB;aAC1C,4CAAI,4BAAczI,QAAQ,CACzBkG,SAAS,CAACnH,OAAO,EAAE,CAAC8K,aAAa,CAACF,eAAe,CAAC,CAClD;YACD,CAAC;UACH;SACDM,QAAQ,EAAE,MAAM;WACf,4CAAI,4CAAqBxB,iBAAiB;;QAE3C,CAAC;OAEF,4CAAI;OACJ3G,aAAG,CAACC,MAAM,CAACiH,YAAY,CAAC5I,MAAM,EAAE,0CAAE,IAAI,gDAAwB;MAC9D,CAAC;;CAEJ;CAAC,iCAEsB4E,UAAkB,EACzC;GACC,IAAIA,UAAU,CAACkF,UAAU,CAAC,SAAS,CAAC,EACpC;KACC,OAAO,YAAY;;GAGpB,IAAIlF,UAAU,CAACkF,UAAU,CAAC,UAAU,CAAC,EACrC;KACC,MAAMzH,UAAU,GAAG,IAAI,CAACF,aAAa,EAAE;KACvC,IAAI5B,cAAI,CAACgC,aAAa,CAACF,UAAU,CAACuC,UAAU,CAAC,CAAC,EAC9C;OACC,OAAOvC,UAAU,CAACuC,UAAU,CAAC,CAACmF,UAAU;;;GAI1C,OAAQ,OAAMnF,UAAW,EAAC;CAC3B;CAAC,yCAGD;GAAA;GACC,MAAMlC,aAAa,GAAGtC,iBAAO,CAACuC,KAAK,yCAACT,aAAa,4DAA6B;GAC9E,MAAMqE,YAAY,qEAAG,IAAI,gFAAJ,uBAAoByD,aAAa,qBAAjC,uBAAmC1H,MAAM;GAE9D,IAAI/B,cAAI,CAACgC,aAAa,CAACgE,YAAY,CAAC,EACpC;KACC,IAAIhG,cAAI,CAACuE,aAAa,CAACyB,YAAY,CAAC,QAAQ,CAAC,CAAC,EAC9C;OACCA,YAAY,CAAC,QAAQ,CAAC,GAAG,CACxB,GAAG7D,aAAa,CAAC,QAAQ,CAAC,EAC1B,GAAG6D,YAAY,CAAC,QAAQ,CAAC,CACzB;MACD,MAED;OACCA,YAAY,CAAC,QAAQ,CAAC,GAAG,CACxB,GAAG7D,aAAa,CAAC,QAAQ,CAAC,CAC1B;;KAGF,OAAO6D,YAAY;;GAGpB,IAAIhG,cAAI,CAACkC,UAAU,CAAC8D,YAAY,CAAC,EACjC;KACC,OAAOA,YAAY;;GAGpB,OAAO7D,aAAa;CACrB;CAAC,yCAE8BuH,KAAK,EAAE3H,MAAM,EAC5C;GACC,IAAI/B,cAAI,CAACgC,aAAa,CAACD,MAAM,CAAC,EAC9B;KACC,OAAO2H,KAAK,CAAC3H,MAAM,CAAEV,IAAI,IAAK;OAC7B,MAAMsD,OAAO,GACZ,CAAC3E,cAAI,CAACuE,aAAa,CAACxC,MAAM,CAAC,QAAQ,CAAC,CAAC,IAClCA,MAAM,CAAC,QAAQ,CAAC,CAAC6C,IAAI,CAAEC,SAAS,IAAK;SACvC,IAAI7E,cAAI,CAACC,cAAc,CAAC4E,SAAS,CAAC,EAClC;WACC,OAAOxD,IAAI,CAACiF,IAAI,KAAKzB,SAAS;;SAG/B,IAAI7E,cAAI,CAACkC,UAAU,CAAC2C,SAAS,CAAC,EAC9B;WACC,OAAOA,SAAS,CAACxD,IAAI,CAAC;;SAGvB,OAAO,KAAK;QACZ,CACD;OAED,MAAM2D,UAAU,GACfhF,cAAI,CAACuE,aAAa,CAACxC,MAAM,CAAC,QAAQ,CAAC,CAAC,IACjCA,MAAM,CAAC,QAAQ,CAAC,CAAC6C,IAAI,CAAEC,SAAS,IAAK;SACvC,IAAI7E,cAAI,CAACC,cAAc,CAAC4E,SAAS,CAAC,EAClC;WACC,OAAOxD,IAAI,CAACiF,IAAI,KAAKzB,SAAS;;SAG/B,IAAI7E,cAAI,CAACkC,UAAU,CAAC2C,SAAS,CAAC,EAC9B;WACC,OAAOA,SAAS,CAACxD,IAAI,CAAC;;SAGvB,OAAO,KAAK;QACZ,CACD;OAED,OAAOsD,OAAO,IAAI,CAACK,UAAU;MAC7B,CAAC;;GAGH,OAAO0E,KAAK;CACb;CAAC,+BAEoBrF,UAA2B,EAAEwB,QAAgB,EAClE;GACC,OAAO,4CAAI,sBAAQtG,QAAQ,CAAE,WAAU8E,UAAW,EAAC,EAAE,MAAM;KAC1D,MAAMsF,UAAU,GAAGC,MAAM,CAACC,GAAG;KAC7B,MAAMC,OAAO,GAAG,CAAC,MAAM;OACtB,IAAIH,UAAU,CAACI,EAAE,CAACC,EAAE,CAACC,gBAAgB,EACrC;SACC,OAAON,UAAU,CAACI,EAAE,CAACC,EAAE,CAACC,gBAAgB,CAACH,OAAO;;OAGjD,OAAOC,EAAE,CAACC,EAAE,CAACC,gBAAgB,CAACH,OAAO;MACrC,GAAG;KAEJ,MAAM5B,OAAO,GAAG,IAAI4B,OAAO,yCAC1B,IAAI,kDAAwBzF,UAAU,GACtC;OACCwB,QAAQ,EAAEA,QAAQ,IAAInE,uBAAuB;OAC7CwI,WAAW,EAAE,4CAAI,kDAAyBzK,MAAM;MAChD,CACD;KAED,MAAMsC,MAAM,2CAAG,IAAI,+DAA+B;KAClD,IAAI/B,cAAI,CAACkC,UAAU,CAACH,MAAM,CAAC,EAC3B;OACCmG,OAAO,CAACwB,KAAK,2CAAG,IAAI,kEACnBxB,OAAO,CAACwB,KAAK,EACb/H,aAAa,CAACwI,0BAA0B,CACxC;OACDjC,OAAO,CAACwB,KAAK,GAAG3H,MAAM,CAACmG,OAAO,CAACwB,KAAK,CAAC;;KAGtC,IAAI1J,cAAI,CAACgC,aAAa,CAACD,MAAM,CAAC,EAC9B;OACCmG,OAAO,CAACwB,KAAK,2CAAG,IAAI,kEACnBxB,OAAO,CAACwB,KAAK,EACb3H,MAAM,CACN;;KAGF,OAAOmG,OAAO;IACd,CAAC;CACH;CAAC,sBAGD;GACC,MAAMlK,OAAO,2CAAG,IAAI,iCAAc;GAElC,IAAI,CAACgC,cAAI,CAACC,cAAc,CAACjC,OAAO,CAACoM,KAAK,CAAC,EACvC;KACC,OAAO/J,aAAG,CAACC,UAAU,CAAC,mDAAmD,CAAC;;GAG3E,OAAOtC,OAAO,CAACoM,KAAK;CACrB;CAAC,6BAGD;GACC,OAAO,4CAAI,sBAAQ7K,QAAQ,CAAC,cAAc,EAAE,MAAM;KACjD,OAAO,IAAIf,OAAO,CAAEC,OAAO,IAAK;OAC/B4L,0BAAM,CACJC,YAAY,CAAC;SACbC,UAAU,EAAE,CAAC,yBAAyB,CAAC;SACvCH,KAAK,0CAAE,IAAI,yBAAY;SACvBI,OAAO,EAAE,MAAM;WACd,+CAAO,IAAI;UACX;SACDrC,IAAI,EAAE;WACLsC,KAAK,0CAAE,IAAI;UACX;SACDC,OAAO,EAAE,MAAM;WACd,OAAO,CACN,4CAAI,4BAAcpL,SAAS,EAAE,0CAC7B,IAAI,kDACJ;UACD;SACDqL,OAAO,EAAE,CAAC;WAACC,UAAU;WAAEC;UAAY,KAAK;WACvC,OAAO,CACN,IAAID,UAAU,CAAC;aACdpD,IAAI,EAAEnH,aAAG,CAACC,UAAU,CAAC,6CAA6C,CAAC;aACnEyF,OAAO,EAAE,4CAAI,8BAAc7F,IAAI,CAAC,IAAI;YACpC,CAAC,EACF2K,WAAW,CACX;;QAEF,CAAC,CACD/L,IAAI,CAAEgM,MAAM,IAAK;SACjBrM,OAAO,CAACqM,MAAM,CAAC;QACf,CAAC;MACH,CAAC;IACF,CAAC;CACH;CAAC,qCAGD;GACC,OAAO,4CAAI,sBAAQvL,QAAQ,CAAC,sBAAsB,EAAE,MAAM;KACzD,OAAO,4CAAI,wCAAoBT,IAAI,CAAEiM,MAAM,IAAK;OAC/C,OAAOA,MAAM,CAACtL,MAAM,EAAE;MACtB,CAAC;IACF,CAAC;CACH;CAAC,yBAGD;GACC,MAAM0G,cAAc,2CAAG,IAAI,2CAAqB;GAChD,MAAM2E,MAAM,GAAG,CAAC,MAAM;KACrB,MAAM;OAACE;MAAe,2CAAG,IAAI,iCAAc;KAC3C,IAAIhL,cAAI,CAACkC,UAAU,CAAC8I,cAAc,CAAC,EACnC;OACC,OAAOA,cAAc,CAAC7E,cAAc,CAAC;;KAGtC,OAAOA,cAAc,CAAC5C,GAAG,CAAEzC,KAAK,IAAK;OACpC,OAAOA,KAAK,CAACwF,IAAI;MACjB,CAAC;IACF,GAAG;GAEJ,4CAAI,8CAAuBwE,MAAM,CAAC;GAClC,IAAI,CAACpI,IAAI,EAAE;CACZ;CAAC,8BAEmBuI,QAAoB,EACxC;GACC,4CAAI,sBAAQvL,GAAG,CAAC,iBAAiB,EAAEuL,QAAQ,CAAC;CAC7C;CAAC,gCAGD;GACC,OAAO,4CAAI,sBAAQtL,GAAG,CAAC,iBAAiB,EAAE,MAAM,EAAE,CAAC;CACpD;CAAC,iCAGD;GACC,MAAM,CAAC0H,gBAAgB,CAAC,2CAAG,IAAI,uCAAmB;GAClD,IAAIrH,cAAI,CAACgC,aAAa,CAACqF,gBAAgB,CAAC,EACxC;KACC,4CAAI,4CAAqBA,gBAAgB,CAACzB,EAAE;;CAE9C;CAAC,yBAYD;GACC,OAAO,4CAAI,sBAAQrG,QAAQ,CAAC,UAAU,EAAE,MAAM;KAC7C,OAAQ,4BAA2BY,cAAI,CAAC+K,SAAS,EAAG,EAAC;IACrD,CAAC;CACH;CAAC,mCA2CD;GACC,IAAI,CAACtL,IAAI,CAAC,uBAAuB,CAAC;GAClC,4CAAI,0CAAoB,EAAE;CAC3B;CAAC,sBAj2BW+B,aAAa;GAAA;GAAA,OAID;KACvB,aAAa,EAAE,CACd,SAAS,EACT,UAAU,EACV,SAAS,CACT;KACD,SAAS,EAAE,CACV;OAAC2E,IAAI,EAAE;MAAyB,EAChC;OAACA,IAAI,EAAE;MAAe;;CAEvB;CAAA,sBAdW3E,aAAa;GAAA;GAAA,OAgBY;KACpC,QAAQ,EAAE,CAAC,UAAU,EAAE,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,MAAM,EAAE,UAAU,EAAE,MAAM;;CAC/E;;;;;;;;"}