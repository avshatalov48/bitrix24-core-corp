{"version":3,"file":"parties.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Dom, Loc, Tag, Type, Extension } from 'main.core';\nimport { type Role } from 'sign.v2.api';\nimport { CompanySelector, type Provider } from 'sign.v2.b2e.company-selector';\nimport { DocumentValidation } from 'sign.v2.b2e.document-validation';\nimport { RepresentativeSelector } from 'sign.v2.b2e.representative-selector';\nimport type { BlankSelectorConfig } from 'sign.v2.blank-selector';\nimport type { DocumentInitiatedType } from 'sign.v2.document-setup';\nimport { Hint } from 'sign.v2.helper';\nimport { DocumentMode } from 'sign.v2.sign-settings';\nimport { type DocumentModeType, isTemplateMode } from 'sign.v2.sign-settings';\n\nconst blockWarningClass = 'sign-document-b2e-parties__item_content--warning';\n\ntype PartiesData = { entityType: string, entityId: ?number, role?: Role };\ntype Options = BlankSelectorConfig & { hideValidationParty?: boolean, documentInitiatedType?: DocumentInitiatedType, documentMode?: DocumentModeType };\n\nconst currentUserId = Extension.getSettings('sign.v2.b2e.parties').get('currentUserId');\n\nexport class Parties\n{\n\t#companySelector: CompanySelector = null;\n\t#representativeSelector: RepresentativeSelector = null;\n\t#documentValidation: DocumentValidation = null;\n\t#ui = {\n\t\tcontainer: HTMLDivElement = null,\n\t\tblocks: {\n\t\t\tcompanyContent: HTMLDivElement = null,\n\t\t\trepresentativeContent: HTMLDivElement = null,\n\t\t\tvalidationEditorLayout: HTMLDivElement = null,\n\t\t},\n\t};\n\n\t#hideEditor: boolean;\n\n\tconstructor(blankSelectorConfig: Options, hcmLinkAvailable: boolean)\n\t{\n\t\tconst { region, hideValidationParty = true, documentInitiatedType, documentMode } = blankSelectorConfig;\n\t\tthis.#hideEditor = hideValidationParty ?? false;\n\t\tthis.#representativeSelector = new RepresentativeSelector({ context: `sign_b2e_representative_selector_assignee_${currentUserId}` });\n\t\tconst isTemplate = isTemplateMode(documentMode || DocumentMode.document);\n\t\tthis.#companySelector = new CompanySelector({\n\t\t\tregion,\n\t\t\tdocumentInitiatedType,\n\t\t\thcmLinkAvailable,\n\t\t\tneedOpenCrmSaveAndEditCompanySliders: isTemplate,\n\t\t});\n\t\tthis.#documentValidation = new DocumentValidation();\n\t}\n\n\tsetEntityId(entityId: number): void\n\t{\n\t\tthis.#companySelector.setOptions({ entityId });\n\t}\n\n\tsetInitiatedByType(initiatedByType: string): void\n\t{\n\t\tthis.#companySelector.setInitiatedByType(initiatedByType);\n\t}\n\n\tsetLastSavedIntegrationId(integrationId: number | null): void\n\t{\n\t\tthis.#companySelector.setLastSavedIntegrationId(integrationId);\n\t}\n\n\tloadCompany(companyUid: string): void\n\t{\n\t\tthis.#companySelector.load(companyUid);\n\t}\n\n\tloadRepresentative(representativeId: number): void\n\t{\n\t\tthis.#representativeSelector.load(representativeId);\n\t}\n\n\tloadValidator(memberId: number, role: Role): void\n\t{\n\t\tthis.#documentValidation.load(memberId, role);\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\tthis.#ui.blocks.companyContent = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t<span>${Loc.getMessage('SIGN_PARTIES_ITEM_COMPANY')}</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tdata-hint=\"${Loc.getMessage('SIGN_PARTIES_ITEM_COMPANY_HINT')}\"\n\t\t\t\t\t></span>\n\t\t\t\t</p>\n\t\t\t\t${this.#companySelector.getLayout()}\n\t\t\t</div>\n\t\t`;\n\t\tHint.create(this.#ui.blocks.companyContent);\n\t\tthis.#ui.blocks.representativeContent = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item --representative\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_PARTIES_ITEM_REPRESENTATIVE')}\n\t\t\t\t</p>\n\t\t\t\t${this.#representativeSelector.getLayout()}\n\t\t\t</div>\n\t\t`;\n\t\tconst providerLayout = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_PARTIES_ITEM_PROVIDER')}\n\t\t\t\t</p>\n\t\t\t\t${this.#companySelector.getProviderLayout()}\n\t\t\t</div>\n\t\t`;\n\t\tconst validationReviewerLayout = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item --reviewer\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_PARTIES_ITEM_VALIDATION_REVIEWER')}\n\t\t\t\t</p>\n\t\t\t\t${this.#documentValidation.getReviewerLayout()}\n\t\t\t</div>\n\t\t`;\n\n\t\tif (!this.#hideEditor)\n\t\t{\n\t\t\tthis.#ui.blocks.validationEditorLayout = Tag.render`\n\t\t\t\t<div class=\"sign-b2e-settings__item --editor\">\n\t\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_PARTIES_ITEM_VALIDATION_EDITOR')}\n\t\t\t\t\t</p>\n\t\t\t\t\t${this.#documentValidation.getEditorLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<h1 class=\"sign-b2e-settings__header\">${Loc.getMessage('SIGN_PARTIES_HEADER')}</h1>\n\t\t\t\t${this.#ui.blocks.companyContent}\n\t\t\t\t${providerLayout}\n\t\t\t\t${this.#ui.blocks.representativeContent}\n\t\t\t\t${validationReviewerLayout}\n\t\t\t\t${this.#ui.blocks.validationEditorLayout}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#validate(): boolean\n\t{\n\t\tconst validationResults = [\n\t\t\tthis.#companySelector.validate(),\n\t\t\tthis.#representativeSelector.validate(),\n\t\t];\n\n\t\treturn validationResults.every((result: boolean) => result === true);\n\t}\n\n\tasync save(documentId: string)\n\t{\n\t\tthis.#removeWarningFromBlocks();\n\t\tif (!this.#validate())\n\t\t{\n\t\t\tthrow new Error();\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tawait this.#companySelector.save(documentId);\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis.#setWarning(this.#ui.blocks.companyContent);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tgetSelectedIntegrationId(): number | null\n\t{\n\t\treturn this.#companySelector.getIntegrationId();\n\t}\n\n\tgetSelectedProvider(): Provider | null\n\t{\n\t\treturn this.#companySelector.getSelectedCompanyProvider();\n\t}\n\n\tgetParties(): Record<string, PartiesData> & { validation: Array<PartiesData> }\n\t{\n\t\tconst validationData = this.#documentValidation.getValidationData();\n\n\t\treturn {\n\t\t\trepresentative: {\n\t\t\t\tentityType: 'user',\n\t\t\t\tentityId: this.#representativeSelector.getRepresentativeId(),\n\t\t\t},\n\t\t\tcompany: {\n\t\t\t\tentityType: 'company',\n\t\t\t\tentityId: this.#companySelector.getCompanyId(),\n\t\t\t},\n\t\t\tvalidation: Object.entries(validationData).map(([role, entityId]) => {\n\t\t\t\treturn { entityType: 'user', entityId, role };\n\t\t\t}),\n\t\t};\n\t}\n\n\t#setWarning(block: HTMLDivElement): void\n\t{\n\t\tif (Type.isNull(block) || Type.isUndefined(block))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(block, blockWarningClass);\n\t}\n\n\t#removeWarningFromBlocks(): void\n\t{\n\t\tfor (const [key, block] of Object.entries(this.#ui.blocks))\n\t\t{\n\t\t\tif (Type.isNull(block))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.removeClass(block, blockWarningClass);\n\t\t}\n\t}\n}\n"],"names":["currentUserId","Extension","getSettings","get","Parties","blankSelectorConfig","hcmLinkAvailable","babelHelpers","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","writable","value","container","HTMLDivElement","blocks","companyContent","representativeContent","validationEditorLayout","region","_blankSelectorConfig$","hideValidationParty","documentInitiatedType","documentMode","RepresentativeSelector","context","isTemplate","isTemplateMode","DocumentMode","document","CompanySelector","needOpenCrmSaveAndEditCompanySliders","DocumentValidation","key","entityId","setOptions","initiatedByType","setInitiatedByType","integrationId","setLastSavedIntegrationId","companyUid","load","representativeId","memberId","role","Tag","render","Loc","getMessage","getLayout","Hint","create","providerLayout","getProviderLayout","validationReviewerLayout","getReviewerLayout","this","getEditorLayout","documentId","_classPrivateMethodGet","_context","Error","save","getIntegrationId","getSelectedCompanyProvider","validationData","getValidationData","representative","entityType","getRepresentativeId","company","getCompanyId","validation","Object","entries","map","validate","every","result","block","Type","isNull","isUndefined","Dom","addClass","removeClass"],"mappings":"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"}