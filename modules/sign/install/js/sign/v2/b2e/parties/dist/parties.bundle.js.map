{"version":3,"file":"parties.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Dom, Loc, Tag, Type } from 'main.core';\nimport { type Role } from 'sign.v2.api';\nimport { CompanySelector, type Provider } from 'sign.v2.b2e.company-selector';\nimport { DocumentValidation } from 'sign.v2.b2e.document-validation';\nimport { RepresentativeSelector } from 'sign.v2.b2e.representative-selector';\nimport type { BlankSelectorConfig } from 'sign.v2.blank-selector';\nimport { Hint } from 'sign.v2.helper';\n\nconst blockWarningClass = 'sign-document-b2e-parties__item_content--warning';\n\ntype PartiesData = { entityType: string, entityId: ?number, role?: Role };\n\nexport class Parties\n{\n\t#companySelector: CompanySelector = null;\n\t#representativeSelector: RepresentativeSelector = null;\n\t#documentValidation: DocumentValidation = null;\n\t#ui = {\n\t\tcontainer: HTMLDivElement = null,\n\t\tblocks: {\n\t\t\tcompanyContent: HTMLDivElement = null,\n\t\t\trepresentativeContent: HTMLDivElement = null,\n\t\t\tvalidationEditorLayout: HTMLDivElement = null,\n\t\t},\n\t};\n\n\t#hideEditor: boolean;\n\n\tconstructor(blankSelectorConfig: BlankSelectorConfig & { hideValidationParty?: boolean })\n\t{\n\t\tconst { region, hideValidationParty = true } = blankSelectorConfig;\n\t\tthis.#hideEditor = hideValidationParty ?? false;\n\t\tthis.#representativeSelector = new RepresentativeSelector({});\n\t\tthis.#companySelector = new CompanySelector({ region });\n\t\tthis.#documentValidation = new DocumentValidation();\n\t}\n\n\tsetEntityId(entityId: number): void\n\t{\n\t\tthis.#companySelector.setOptions({ entityId });\n\t}\n\n\tsetInitiatedByType(initiatedByType: string): void\n\t{\n\t\tthis.#companySelector.setInitiatedByType(initiatedByType);\n\t}\n\n\tloadCompany(companyUid: string): void\n\t{\n\t\tthis.#companySelector.load(companyUid);\n\t}\n\n\tloadRepresentative(representativeId: number): void\n\t{\n\t\tthis.#representativeSelector.load(representativeId);\n\t}\n\n\tloadValidator(memberId: number, role: Role): void\n\t{\n\t\tthis.#documentValidation.load(memberId, role);\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\tthis.#ui.blocks.companyContent = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t<span>${Loc.getMessage('SIGN_PARTIES_ITEM_COMPANY')}</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tdata-hint=\"${Loc.getMessage('SIGN_PARTIES_ITEM_COMPANY_HINT')}\"\n\t\t\t\t\t></span>\n\t\t\t\t</p>\n\t\t\t\t${this.#companySelector.getLayout()}\n\t\t\t</div>\n\t\t`;\n\t\tHint.create(this.#ui.blocks.companyContent);\n\t\tthis.#ui.blocks.representativeContent = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item --representative\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_PARTIES_ITEM_REPRESENTATIVE')}\n\t\t\t\t</p>\n\t\t\t\t${this.#representativeSelector.getLayout()}\n\t\t\t</div>\n\t\t`;\n\t\tconst providerLayout = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_PARTIES_ITEM_PROVIDER')}\n\t\t\t\t</p>\n\t\t\t\t${this.#companySelector.getProviderLayout()}\n\t\t\t</div>\n\t\t`;\n\t\tconst validationReviewerLayout = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item --reviewer\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_PARTIES_ITEM_VALIDATION_REVIEWER')}\n\t\t\t\t</p>\n\t\t\t\t${this.#documentValidation.getReviewerLayout()}\n\t\t\t</div>\n\t\t`;\n\n\t\tif (!this.#hideEditor)\n\t\t{\n\t\t\tthis.#ui.blocks.validationEditorLayout = Tag.render`\n\t\t\t\t<div class=\"sign-b2e-settings__item --editor\">\n\t\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_PARTIES_ITEM_VALIDATION_EDITOR')}\n\t\t\t\t\t</p>\n\t\t\t\t\t${this.#documentValidation.getEditorLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<h1 class=\"sign-b2e-settings__header\">${Loc.getMessage('SIGN_PARTIES_HEADER')}</h1>\n\t\t\t\t${this.#ui.blocks.companyContent}\n\t\t\t\t${providerLayout}\n\t\t\t\t${this.#ui.blocks.representativeContent}\n\t\t\t\t${validationReviewerLayout}\n\t\t\t\t${this.#ui.blocks.validationEditorLayout}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#validate(): boolean\n\t{\n\t\tconst validationResults = [\n\t\t\tthis.#companySelector.validate(),\n\t\t\tthis.#representativeSelector.validate(),\n\t\t];\n\n\t\treturn validationResults.every((result: boolean) => result === true);\n\t}\n\n\tasync save(documentId: string)\n\t{\n\t\tthis.#removeWarningFromBlocks();\n\t\tif (!this.#validate())\n\t\t{\n\t\t\tthrow new Error();\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tawait this.#companySelector.save(documentId);\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis.#setWarning(this.#ui.blocks.companyContent);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tgetSelectedProvider(): Provider | null\n\t{\n\t\treturn this.#companySelector.getSelectedCompanyProvider();\n\t}\n\n\tgetParties(): Record<string, PartiesData> & { validation: Array<PartiesData> }\n\t{\n\t\tconst validationData = this.#documentValidation.getValidationData();\n\n\t\treturn {\n\t\t\trepresentative: {\n\t\t\t\tentityType: 'user',\n\t\t\t\tentityId: this.#representativeSelector.getRepresentativeId(),\n\t\t\t},\n\t\t\tcompany: {\n\t\t\t\tentityType: 'company',\n\t\t\t\tentityId: this.#companySelector.getCompanyId(),\n\t\t\t},\n\t\t\tvalidation: Object.entries(validationData).map(([role, entityId]) => {\n\t\t\t\treturn { entityType: 'user', entityId, role };\n\t\t\t}),\n\t\t};\n\t}\n\n\t#setWarning(block: HTMLDivElement): void\n\t{\n\t\tif (Type.isNull(block) || Type.isUndefined(block))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(block, blockWarningClass);\n\t}\n\n\t#removeWarningFromBlocks(): void\n\t{\n\t\tfor (const [key, block] of Object.entries(this.#ui.blocks))\n\t\t{\n\t\t\tif (Type.isNull(block))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.removeClass(block, blockWarningClass);\n\t\t}\n\t}\n}\n"],"names":["Parties","blankSelectorConfig","babelHelpers","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","writable","value","container","HTMLDivElement","blocks","companyContent","representativeContent","validationEditorLayout","region","_blankSelectorConfig$","hideValidationParty","RepresentativeSelector","CompanySelector","DocumentValidation","key","entityId","setOptions","initiatedByType","setInitiatedByType","companyUid","load","representativeId","memberId","role","Tag","render","Loc","getMessage","getLayout","Hint","create","providerLayout","getProviderLayout","validationReviewerLayout","getReviewerLayout","this","getEditorLayout","documentId","_classPrivateMethodGet","_context","Error","save","getSelectedCompanyProvider","validationData","getValidationData","representative","entityType","getRepresentativeId","company","getCompanyId","validation","Object","entries","map","validate","every","result","block","Type","isNull","isUndefined","Dom","addClass","removeClass"],"mappings":"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"}