{"version":3,"file":"sign-settings.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Dom, Loc, Tag, Text, Type } from 'main.core';\nimport { MemoryCache } from 'main.core.cache';\nimport { type BaseEvent } from 'main.core.events';\nimport { FeatureStorage } from 'sign.feature-storage';\nimport { DocumentInitiated, type DocumentInitiatedType, MemberRole, ProviderCode } from 'sign.type';\nimport { Api, type SetupMember } from 'sign.v2.api';\nimport { DocumentSend } from 'sign.v2.b2e.document-send';\nimport { DocumentSetup } from 'sign.v2.b2e.document-setup';\nimport { Parties as CompanyParty } from 'sign.v2.b2e.parties';\nimport { type CardItem, UserParty } from 'sign.v2.b2e.user-party';\nimport { type DocumentDetails } from 'sign.v2.document-setup';\nimport { SectionType } from 'sign.v2.editor';\nimport { SignSettingsItemCounter } from 'sign.v2.helper';\nimport {\n\tdecorateResultBeforeCompletion,\n\tisTemplateMode,\n\ttype SignOptions,\n\ttype SignOptionsConfig,\n\tSignSettings,\n} from 'sign.v2.sign-settings';\nimport { type SaveButton } from 'ui.buttons';\nimport { Layout } from 'ui.sidepanel.layout';\nimport { Uploader, UploaderEvent, UploaderFile } from 'ui.uploader.core';\nimport type { Metadata } from 'ui.wizard';\nimport { B2EFeatureConfig } from './type';\n\nimport './style.css';\n\nexport type { B2EFeatureConfig };\n\ntype SetupMembersResponse = {\n\tmembers: Array<SetupMember>,\n\tcurrentParty: number,\n};\n\ntype PartiesDetails = {\n\tentityId: number,\n\tentityTypeId: number,\n\tpart: number,\n\tpresetId: number,\n\trole: string,\n\tuid: string\n}\n\nconst acceptedUploaderFileTypes: Set<string> = new Set([\n\t'jpg',\n\t'jpeg',\n\t'png',\n\t'pdf',\n\t'doc',\n\t'docx',\n\t'rtf',\n\t'odt',\n]);\n\nexport class B2ESignSettings extends SignSettings\n{\n\t#companyParty: CompanyParty;\n\t#userParty: UserParty;\n\t#api: Api;\n\tdocumentSetup: DocumentSetup;\n\teditedDocument: DocumentDetails | null;\n\t#maxDocumentCount: boolean;\n\t#cache: MemoryCache<any> = new MemoryCache();\n\t#regionDocumentTypes: Array<{ code: string, description: string }> = [];\n\t#saveButton: SaveButton;\n\t#isMultiDocumentSaveProcessGone: boolean = false;\n\n\tconstructor(containerId: string, signOptions: SignOptions)\n\t{\n\t\tsuper(containerId, signOptions, {\n\t\t\tnext: { className: 'ui-btn-success' },\n\t\t\tcomplete: { className: 'ui-btn-success' },\n\t\t\tswapButtons: true,\n\t\t});\n\t\tconst {\n\t\t\tb2eFeatureConfig,\n\t\t\tblankSelectorConfig,\n\t\t\tdocumentSendConfig,\n\t\t\tuserPartyConfig,\n\t\t} = this.#prepareConfig(signOptions);\n\n\t\tthis.documentSetup = new DocumentSetup(blankSelectorConfig);\n\t\tthis.documentSend = new DocumentSend(documentSendConfig);\n\t\tthis.#companyParty = new CompanyParty({\n\t\t\t...blankSelectorConfig,\n\t\t\tdocumentInitiatedType: signOptions.initiatedByType,\n\t\t\tdocumentMode: signOptions.documentMode,\n\t\t}, b2eFeatureConfig.hcmLinkAvailable);\n\t\tthis.#api = new Api();\n\t\tthis.#maxDocumentCount = signOptions.b2eDocumentLimitCount;\n\t\tthis.#userParty = new UserParty({ mode: 'edit', ...userPartyConfig });\n\t\tthis.subscribeOnEvents();\n\t\tthis.#regionDocumentTypes = blankSelectorConfig.regionDocumentTypes;\n\t}\n\n\t#prepareConfig(signOptions: SignOptions): SignOptionsConfig\n\t{\n\t\tconst { config, documentMode, b2eDocumentLimitCount } = signOptions;\n\n\t\tconst { blankSelectorConfig, documentSendConfig } = config;\n\t\tblankSelectorConfig.documentMode = documentMode;\n\t\tblankSelectorConfig.b2eDocumentLimitCount = b2eDocumentLimitCount;\n\t\tdocumentSendConfig.documentMode = documentMode;\n\n\t\treturn config;\n\t}\n\n\tsubscribeOnEvents(): void\n\t{\n\t\tsuper.subscribeOnEvents();\n\t\tthis.documentSend.subscribe('changeTitle', ({ data }) => {\n\t\t\tthis.documentSetup.setDocumentTitle(data.title);\n\t\t});\n\t\tthis.documentSend.subscribe('disableBack', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('back', true);\n\t\t});\n\t\tthis.documentSend.subscribe('enableBack', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('back', false);\n\t\t});\n\t\tthis.documentSetup.subscribe('addDocument', () => {\n\t\t\tthis.setDocumentsGroup();\n\t\t});\n\t\tthis.documentSetup.subscribe('deleteDocument', ({ data }) => {\n\t\t\tthis.#deleteDocument(data);\n\t\t});\n\t\tthis.documentSetup.subscribe('editDocument', ({ data }) => {\n\t\t\tthis.#editDocumentData(data.uid);\n\t\t});\n\t\tthis.documentSend.subscribe('enableComplete', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('complete', false);\n\t\t});\n\t\tthis.documentSend.subscribe('disableComplete', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('complete', true);\n\t\t});\n\t\tthis.documentSetup.subscribe('documentsLimitExceeded', () => {\n\t\t\tthis.documentSetup.setAvailabilityDocumentSection(false);\n\t\t});\n\t\tthis.documentSetup.subscribe('documentsLimitNotExceeded', () => {\n\t\t\tthis.documentSetup.setAvailabilityDocumentSection(true);\n\t\t});\n\t\tthis.documentSend.subscribe(\n\t\t\tthis.documentSend.events.onTemplateComplete,\n\t\t\t(event: BaseEvent<{ templateId: number }>) => {\n\t\t\t\tif (this.isTemplateMode() && !this.isEditMode())\n\t\t\t\t{\n\t\t\t\t\tconst templateId = event.getData().templateId;\n\t\t\t\t\tthis.getAnalytics().send({\n\t\t\t\t\t\tevent: 'turn_on_off_template',\n\t\t\t\t\t\ttype: 'auto',\n\t\t\t\t\t\tc_element: 'on',\n\t\t\t\t\t\tp5: `templateId_${templateId}`,\n\t\t\t\t\t});\n\t\t\t\t\tthis.getAnalytics().send({\n\t\t\t\t\t\tevent: 'click_save_template',\n\t\t\t\t\t\tc_element: 'create_button',\n\t\t\t\t\t\tp5: `templateId_${templateId}`,\n\t\t\t\t\t\tstatus: 'success',\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tasync #editDocumentData(uid: string): Promise<void>\n\t{\n\t\tif (this.editedDocument)\n\t\t{\n\t\t\tawait this.#saveUpdatedDocumentData(this.editedDocument.uid);\n\t\t}\n\n\t\tif (!this.documentSetup.editMode)\n\t\t{\n\t\t\tthis.#disableDocumentSectionIfLimitReached();\n\t\t\tthis.#resetDocument();\n\n\t\t\treturn;\n\t\t}\n\t\tthis.editedDocument = this.documentsGroup.get(uid);\n\t\tthis.documentSetup.setAvailabilityDocumentSection(true);\n\n\t\tif (this.documentSetup.isRuRegion())\n\t\t{\n\t\t\tthis.documentSetup.setDocumentNumber(this.editedDocument.externalId);\n\t\t}\n\t\tthis.documentSetup.setDocumentTitle(this.editedDocument.title);\n\t\tthis.#scrollToDown();\n\t}\n\n\tasync setDocumentsGroup(): Promise<void>\n\t{\n\t\tif (this.documentSetup.blankIsNotSelected || !this.documentSetup.validate())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentSetup.switchAddDocumentButtonLoadingState(true);\n\t\ttry\n\t\t{\n\t\t\tconst documentData = await this.setupDocument();\n\t\t\tthis.documentsGroup.set(documentData.uid, documentData);\n\t\t\tthis.addInDocumentsGroupUids(documentData.uid);\n\n\t\t\tthis.documentSetup.blankSelector.disableSelectedBlank(documentData.blankId);\n\n\t\t\tawait this.#attachGroupToDocument(documentData);\n\t\t\tthis.documentSetup.switchAddDocumentButtonLoadingState(false);\n\n\t\t\tif (this.editedDocument)\n\t\t\t{\n\t\t\t\tawait this.#handleEditedDocument(documentData);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.documentSetup.renderDocumentBlock(documentData);\n\t\t\t}\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tthis.documentSetup.switchAddDocumentButtonLoadingState(false);\n\t\t}\n\n\t\tthis.#scrollToTop();\n\t\tthis.documentSetup.documentCounters.update(this.documentsGroup.size);\n\t\tthis.#resetDocument();\n\t\tthis.wizard.toggleBtnActiveState('next', false);\n\t}\n\n\taddInDocumentsGroupUids(uid: string): void\n\t{\n\t\tif (!this.documentsGroupUids.includes(uid))\n\t\t{\n\t\t\tthis.documentsGroupUids.push(uid);\n\t\t}\n\t}\n\n\tasync #handleEditedDocument(documentData): Promise<void>\n\t{\n\t\tif (this.documentSetup.blankIsNotSelected)\n\t\t{\n\t\t\tthis.documentSetup.resetEditMode();\n\t\t\tawait this.#saveUpdatedDocumentData(this.editedDocument.uid);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.deleteFromDocumentsGroupUids(documentData.uid);\n\t\tthis.replaceInDocumentsGroupUids(this.editedDocument.uid, documentData.uid);\n\t\tthis.documentSetup.replaceDocumentBlock(this.editedDocument, documentData);\n\t\tawait this.#deleteDocument(this.editedDocument);\n\t\tawait this.#attachGroupToDocument(documentData);\n\n\t\tthis.editor.setUrls([]);\n\t}\n\n\treplaceInDocumentsGroupUids(oldUid: string, newUid: string): void\n\t{\n\t\tconst index = this.documentsGroupUids.indexOf(oldUid);\n\t\tif (index !== -1)\n\t\t{\n\t\t\tthis.documentsGroupUids.splice(index, 1, newUid);\n\t\t}\n\t}\n\n\tdeleteFromDocumentsGroupUids(uid: string)\n\t{\n\t\tconst index = this.documentsGroupUids.indexOf(uid);\n\n\t\tif (index === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.documentsGroupUids.splice(index, 1);\n\t}\n\n\t#removeDocumentElement(documentId): void\n\t{\n\t\tconst deletedElement = this.documentSetup.layout.querySelector(`[data-id=\"document-id-${documentId}\"]`);\n\t\tdeletedElement?.remove();\n\t}\n\n\tasync #attachGroupToDocument(documentData): Promise<void>\n\t{\n\t\tif (!this.groupId)\n\t\t{\n\t\t\tconst { groupId } = await this.#api.createDocumentsGroup();\n\t\t\tthis.groupId = groupId;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst targetDocument = this.documentsGroup.get(documentData.uid);\n\n\t\t\tif (targetDocument && !targetDocument.groupId)\n\t\t\t{\n\t\t\t\tawait this.#api.attachGroupToDocument(documentData.uid, this.groupId);\n\t\t\t\ttargetDocument.groupId = this.groupId;\n\t\t\t}\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t}\n\t}\n\n\tasync #saveUpdatedDocumentData(uid: string): Promise<void>\n\t{\n\t\tconst updatedDocumentData = await this.documentSetup.updateDocumentData(this.editedDocument);\n\t\tthis.documentSetup.updateDocumentBlock(this.editedDocument.id);\n\n\t\tif (uid)\n\t\t{\n\t\t\tthis.documentsGroup.set(this.editedDocument.uid, updatedDocumentData);\n\t\t\tthis.addInDocumentsGroupUids(this.editedDocument.uid);\n\t\t\tthis.documentSend.setDocumentsBlock(this.documentsGroup);\n\t\t}\n\t}\n\n\tasync #deleteDocument(data: { blankId: number, deletedButton: HTMLElement, id: number, uid: string }): string\n\t{\n\t\tconst { id, uid, blankId, deleteButton } = data;\n\t\tthis.documentSetup.ready = false;\n\n\t\ttry\n\t\t{\n\t\t\tawait this.#api.removeDocument(uid);\n\t\t\tthis.documentSetup.ready = true;\n\n\t\t\tif (this.isFirstDocumentSelected(uid))\n\t\t\t{\n\t\t\t\tthis.resetPreview();\n\t\t\t\tthis.hasPreviewUrls = false;\n\t\t\t}\n\t\t\tthis.#removeDocumentElement(id);\n\t\t\tthis.documentSend.deleteDocument(uid);\n\t\t\tthis.documentsGroup.delete(uid);\n\t\t\tthis.deleteFromDocumentsGroupUids(uid);\n\t\t\tthis.documentSetup.blankSelector.enableSelectedBlank(blankId);\n\t\t\tthis.documentSetup.deleteDocumentFromList(blankId);\n\t\t\tthis.documentSetup.documentCounters.update(this.documentsGroup.size);\n\t\t\tthis.documentSetup.resetEditMode();\n\n\t\t\tif (this.documentsGroup.size === 0)\n\t\t\t{\n\t\t\t\tthis.wizard.toggleBtnActiveState('next', true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.documentSetup.setupData = this.getFirstDocumentDataFromGroup();\n\t\t\t}\n\t\t\tthis.#resetDocument();\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tthis.documentSetup.toggleDeleteBtnLoadingState(deleteButton);\n\t\t\tthis.documentSetup.ready = true;\n\t\t}\n\t}\n\n\tasync #setupParties(): Promise<Array<PartiesDetails>>\n\t{\n\t\tconst { representative } = this.#companyParty.getParties();\n\t\tconst { members, signerParty } = this.#makeSetupMembers();\n\n\t\tconst documentUids = [...this.documentsGroup.keys()];\n\t\tfor (const documentUid of documentUids)\n\t\t{\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.#api.setupB2eParties(documentUid, representative.entityId, members);\n\t\t}\n\t\tconst uid = this.#documentUid;\n\t\tconst membersData = await this.#api.loadMembers(uid);\n\t\tif (!Type.isArrayFilled(membersData))\n\t\t{\n\t\t\tthrow new Error('Members are empty');\n\t\t}\n\n\t\tconst syncMemberPromises = documentUids.map((uid) => this.#syncMembersWithDepartments(uid, signerParty));\n\t\tawait Promise.all(syncMemberPromises);\n\n\t\treturn membersData.map((memberData) => {\n\t\t\treturn {\n\t\t\t\tpresetId: memberData?.presetId,\n\t\t\t\tpart: memberData?.party,\n\t\t\t\tuid: memberData?.uid,\n\t\t\t\tentityTypeId: memberData?.entityTypeId ?? null,\n\t\t\t\tentityId: memberData?.entityId ?? null,\n\t\t\t\trole: memberData?.role ?? null,\n\t\t\t};\n\t\t});\n\t}\n\n\t#isTemplateModeForCompany(): boolean\n\t{\n\t\tconst isInitiatedByCompany = this.documentSetup.setupData.initiatedByType === DocumentInitiated.company;\n\n\t\treturn isTemplateMode(this.documentMode) && isInitiatedByCompany;\n\t}\n\n\tasync #syncMembersWithDepartments(uid: string, signerParty: number): Promise<void>\n\t{\n\t\tlet syncFinished = false;\n\t\twhile (!syncFinished)\n\t\t{\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tconst response = await this.#api.syncB2eMembersWithDepartments(uid, signerParty);\n\t\t\tsyncFinished = response.syncFinished;\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.#sleep(1000);\n\t\t}\n\t}\n\n\t#sleep(ms: Number): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, ms);\n\t\t});\n\t}\n\n\tget #documentUid(): string\n\t{\n\t\treturn this.documentSetup.setupData.uid;\n\t}\n\n\tget #isDocumentInitiatedByEmployee(): DocumentInitiatedType\n\t{\n\t\treturn this.documentSetup.setupData.initiatedByType === DocumentInitiated.employee;\n\t}\n\n\t#getAssignee(currentParty: number, companyId: number): SetupMember\n\t{\n\t\treturn {\n\t\t\tentityType: 'company',\n\t\t\tentityId: companyId,\n\t\t\tparty: currentParty,\n\t\t\trole: MemberRole.assignee,\n\t\t};\n\t}\n\n\t#getSigner(currentParty: number, entity: CardItem): SetupMember\n\t{\n\t\treturn {\n\t\t\tentityType: entity.entityType,\n\t\t\tentityId: entity.entityId,\n\t\t\tparty: currentParty,\n\t\t\trole: MemberRole.signer,\n\t\t};\n\t}\n\n\t#makeSetupMembers(): SetupMembersResponse\n\t{\n\t\tconst { company, validation } = this.#companyParty.getParties();\n\n\t\tconst userPartyEntities = this.#userParty.getEntities();\n\n\t\tlet currentParty = this.#isDocumentInitiatedByEmployee ? 2 : 1;\n\n\t\tconst members = validation.map((item): SetupMember => {\n\t\t\tconst result = { ...item, party: currentParty };\n\t\t\tcurrentParty++;\n\n\t\t\treturn result;\n\t\t});\n\t\tmembers.push(this.#getAssignee(currentParty, company.entityId));\n\n\t\tlet signerParty = currentParty;\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tsignerParty = this.#isDocumentInitiatedByEmployee ? 1 : currentParty + 1;\n\t\t\tconst signers = userPartyEntities.map((entity) => this.#getSigner(signerParty, entity));\n\t\t\tmembers.push(...signers);\n\t\t}\n\n\t\treturn { members, signerParty };\n\t}\n\n\t#parseMembers(loadedMembers: SetupMember[]): { [$Keys<typeof MemberRole>]: number[]; }\n\t{\n\t\treturn loadedMembers.reduce((acc, member) => {\n\t\t\tconst { entityType, entityId } = member;\n\t\t\tif (entityType !== 'user')\n\t\t\t{\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst role = `${member.role}s`;\n\n\t\t\treturn {\n\t\t\t\t...acc,\n\t\t\t\t[role]: [\n\t\t\t\t\t...acc[role] ?? [],\n\t\t\t\t\tentityId,\n\t\t\t\t],\n\t\t\t};\n\t\t}, {});\n\t}\n\n\tasync applyDocumentData(uid: string): Promise<boolean>\n\t{\n\t\tconst setupData = await this.setupDocument(uid, true);\n\t\tif (!setupData)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (setupData.groupId)\n\t\t{\n\t\t\tconst documentsGroupData = await this.#api.getDocumentListInGroup(setupData.groupId);\n\t\t\tfor (const item of documentsGroupData)\n\t\t\t{\n\t\t\t\tthis.addInDocumentsGroupUids(item.uid);\n\n\t\t\t\tconst blocks = await this.#api.loadBlocksByDocument(item.uid);\n\t\t\t\tconst updatedItem = { ...item, blocks };\n\t\t\t\tthis.documentsGroup.set(item.uid, updatedItem);\n\t\t\t\tthis.documentSetup.renderDocumentBlock(updatedItem);\n\t\t\t\tthis.documentSetup.blankSelector.disableSelectedBlank(updatedItem.blankId);\n\t\t\t}\n\t\t\tthis.groupId = setupData.groupId;\n\t\t\tthis.documentSetup.documentCounters.update(this.documentsGroup.size);\n\t\t\tthis.#resetDocument();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.documentsGroup.set(setupData.uid, setupData);\n\t\t\tthis.addInDocumentsGroupUids(setupData.uid);\n\t\t}\n\n\t\tconst firstDocument = this.getFirstDocumentDataFromGroup();\n\t\tconst { entityId, representativeId, companyUid, hcmLinkCompanyId } = firstDocument;\n\t\tthis.documentSend.documentData = this.documentsGroup;\n\n\t\tthis.#disableDocumentSectionIfLimitReached();\n\n\t\tif (this.isSingleDocument())\n\t\t{\n\t\t\tthis.editor.documentData = firstDocument;\n\t\t}\n\t\tthis.#companyParty.setEntityId(entityId);\n\t\tif (companyUid)\n\t\t{\n\t\t\tthis.#companyParty.setLastSavedIntegrationId(hcmLinkCompanyId);\n\t\t\tthis.#companyParty.loadCompany(companyUid);\n\t\t}\n\n\t\tif (representativeId)\n\t\t{\n\t\t\tthis.#companyParty.loadRepresentative(representativeId);\n\t\t}\n\n\t\tconst members = await this.#api.loadMembers(uid);\n\t\tconst parsedMembers = this.#parseMembers(members);\n\t\tconst { signers = [], reviewers = [], editors = [] } = parsedMembers;\n\t\tif (signers.length > 0)\n\t\t{\n\t\t\tthis.#userParty.load(signers);\n\t\t}\n\n\t\tif (reviewers.length > 0)\n\t\t{\n\t\t\tthis.#companyParty.loadValidator(reviewers[0], MemberRole.reviewer);\n\t\t}\n\n\t\tif (editors.length > 0)\n\t\t{\n\t\t\tthis.#companyParty.loadValidator(editors[0], MemberRole.editor);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tasync applyTemplateData(templateUid: string): Promise<boolean>\n\t{\n\t\tsuper.applyTemplateData(templateUid);\n\n\t\tthis.documentSetup.setupData.templateUid = templateUid;\n\t\tthis.documentSend.setExistingTemplate();\n\t\tthis.#companyParty.setIntegrationSelectorAvailability(this.#isTemplateModeForCompany());\n\n\t\treturn true;\n\t}\n\n\t#getSetupStep(signSettings: B2ESignSettings, documentUid?: string): $Values<Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.documentSetup.layout;\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\tif (!Type.isNull(signSettings.getAfterPreviewLayout()))\n\t\t\t\t{\n\t\t\t\t\tBX.show(signSettings.getAfterPreviewLayout());\n\t\t\t\t}\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2B_LOAD_DOCUMENT'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\tconst blankIsSelected = this.documentSetup.blankSelector.selectedBlankId !== 0;\n\t\t\t\tif (blankIsSelected || this.documentSetup.isFileAdded)\n\t\t\t\t{\n\t\t\t\t\tconst isValid = this.documentSetup.validate();\n\t\t\t\t\tif (!isValid)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst setupData = await this.setupDocument();\n\t\t\t\tif (!setupData)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tawait this.#addDocumentInGroup(setupData);\n\t\t\t\tif (this.editedDocument)\n\t\t\t\t{\n\t\t\t\t\tawait this.#handleEditedDocument(setupData);\n\t\t\t\t}\n\n\t\t\t\tthis.#resetDocument();\n\t\t\t\tthis.#processSetupData();\n\t\t\t\tthis.#disableDocumentSectionIfLimitReached();\n\n\t\t\t\tif (!Type.isNull(this.getAfterPreviewLayout()))\n\t\t\t\t{\n\t\t\t\t\tBX.hide(this.getAfterPreviewLayout());\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\t#getCompanyStep(signSettings: B2ESignSettings): $Values<Metadata>\n\t{\n\t\tconst titleLocCode = this.isTemplateMode()\n\t\t\t? 'SIGN_SETTINGS_B2E_ROUTES'\n\t\t\t: 'SIGN_SETTINGS_B2E_COMPANY'\n\t\t;\n\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.#companyParty.getLayout();\n\t\t\t\tconst isTemplateModeForCompany = signSettings.#isTemplateModeForCompany();\n\n\t\t\t\tif (signSettings.isTemplateMode())\n\t\t\t\t{\n\t\t\t\t\tsignSettings.#companyParty.setEditorAvailability(isTemplateModeForCompany);\n\t\t\t\t}\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage(titleLocCode),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\tconst { uid, initiatedByType } = this.documentSetup.setupData;\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tfor (const [uid] of this.documentsGroup)\n\t\t\t\t\t{\n\t\t\t\t\t\tawait this.#companyParty.save(uid);\n\t\t\t\t\t}\n\t\t\t\t\tthis.editor.setSenderType(initiatedByType);\n\t\t\t\t\tthis.documentSetup.setupData.integrationId = this.#companyParty.getSelectedIntegrationId();\n\t\t\t\t\tthis.documentSend.hcmLinkEnabled = this.documentSetup.setupData.integrationId > 0;\n\n\t\t\t\t\tthis.#setSecondPartySectionVisibility();\n\t\t\t\t\tthis.#setHcmLinkIntegrationSectionVisibility();\n\n\t\t\t\t\tif (this.isTemplateMode())\n\t\t\t\t\t{\n\t\t\t\t\t\tconst entityData = await this.#setupParties();\n\t\t\t\t\t\tthis.editor.entityData = entityData;\n\t\t\t\t\t\tconst { isTemplate, entityId } = this.documentSetup.setupData;\n\t\t\t\t\t\tconst blocks = await this.documentSetup.loadBlocks(uid);\n\n\t\t\t\t\t\tthis.#executeDocumentSendActions();\n\n\t\t\t\t\t\tconst editorData = { isTemplate, uid, blocks, entityId };\n\t\t\t\t\t\tthis.#executeEditorActions(editorData);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\t#getEmployeeStep(signSettings: B2ESignSettings): $Values<Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.#userParty.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2E_EMPLOYEES'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tconst isValid = this.#userParty.validate();\n\t\t\t\t\tif (!isValid)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn isValid;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.editor.entityData = await this.#setupParties();\n\n\t\t\t\t\tconst { uid, isTemplate, entityId } = this.documentSetup.setupData;\n\t\t\t\t\tconst blocks = await this.documentSetup.loadBlocks(uid);\n\n\t\t\t\t\tthis.#executeDocumentSendActions();\n\n\t\t\t\t\tconst editorData = { isTemplate, uid, blocks, entityId };\n\t\t\t\t\tawait this.#executeEditorActions(editorData);\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(e);\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tasync #executeDocumentSendActions(): Promise<void>\n\t{\n\t\tconst partiesData = this.#companyParty.getParties();\n\t\tObject.assign(partiesData, {\n\t\t\temployees: this.#userParty.getEntities().map((entity) => {\n\t\t\t\treturn {\n\t\t\t\t\tentityType: entity.entityType,\n\t\t\t\t\tentityId: entity.entityId,\n\t\t\t\t};\n\t\t\t}),\n\t\t});\n\t\tthis.documentSend.documentData = this.documentsGroup;\n\t\tthis.documentSend.resetUserPartyPopup();\n\t\tthis.documentSend.setPartiesData(partiesData);\n\t}\n\n\tasync #executeEditorActions(editorData: {\n\t\tisTemplate: boolean,\n\t\tuid: string,\n\t\tblocks: Array,\n\t\tentityId: number\n\t}): Promise<void>\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tthis.editor.setAnalytics(this.getAnalytics());\n\t\t}\n\t\tthis.wizard.toggleBtnLoadingState('next', false);\n\n\t\tif (this.isSingleDocument())\n\t\t{\n\t\t\tthis.editor.documentData = editorData;\n\t\t\tawait this.editor.waitForPagesUrls();\n\t\t\tawait this.editor.renderDocument();\n\t\t\tawait this.editor.show();\n\t\t}\n\t}\n\n\t#getSendStep(signSettings: B2ESignSettings): $Values<Metadata>\n\t{\n\t\tconst titleLocCode = this.isTemplateMode()\n\t\t\t? 'SIGN_SETTINGS_SEND_DOCUMENT_CREATE'\n\t\t\t: 'SIGN_SETTINGS_SEND_DOCUMENT'\n\t\t;\n\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.documentSend.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage(titleLocCode),\n\t\t\tbeforeCompletion: () => this.documentSend.sendForSign(),\n\t\t};\n\t}\n\n\tgetStepsMetadata(signSettings: this, documentUid: ?string, templateUid?: string): Metadata\n\t{\n\t\tthis.#sendAnalyticsOnStart(documentUid);\n\t\tconst steps = {\n\t\t\tsetup: this.#getSetupStep(signSettings, documentUid),\n\t\t\tcompany: this.#getCompanyStep(signSettings),\n\t\t};\n\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tsteps.employees = this.#getEmployeeStep(signSettings);\n\t\t}\n\n\t\tsteps.send = this.#getSendStep(signSettings);\n\n\t\tthis.#decorateStepsBeforeCompletionWithAnalytics(steps, documentUid);\n\n\t\treturn steps;\n\t}\n\n\tasync init(uid: ?string, templateUid: string)\n\t{\n\t\tawait super.init(uid, templateUid);\n\t\tif (this.isEditMode() && !Type.isNull(this.getAfterPreviewLayout()))\n\t\t{\n\t\t\tBX.hide(this.getAfterPreviewLayout());\n\t\t}\n\t}\n\n\tonComplete(): void\n\t{\n\t\tif (this.isTemplateMode())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tsuper.onComplete();\n\t}\n\n\tisTemplateCreateMode(): boolean\n\t{\n\t\treturn isTemplateMode(this.documentMode) && !this.isEditMode();\n\t}\n\n\t#setSecondPartySectionVisibility(): void\n\t{\n\t\tconst selectedProvider = this.#companyParty.getSelectedProvider();\n\t\tconst isNotSesRuProvider = selectedProvider.code !== ProviderCode.sesRu;\n\n\t\tconst isSecondPartySectionVisible = isNotSesRuProvider\n\t\t\t|| (isTemplateMode(this.documentMode) && this.#isInitiatedByEmployee())\n\t\t;\n\n\t\tthis.editor.setSectionVisibilityByType(\n\t\t\tSectionType.SecondParty,\n\t\t\tisSecondPartySectionVisible,\n\t\t);\n\t}\n\n\tasync #setHcmLinkIntegrationSectionVisibility(): Promise<void>\n\t{\n\t\tconst isInitiatedByCompany = this.documentSetup.setupData.initiatedByType === DocumentInitiated.company;\n\n\t\tif (this.#isInitiatedByEmployee() && this.documentSetup.isRuRegion())\n\t\t{\n\t\t\tawait this.#api.changeIntegrationId(this.documentSetup.setupData.uid, null);\n\t\t}\n\n\t\tconst isHcmLinkIntegrationSectionVisible = this.documentSetup.setupData.integrationId > 0\n\t\t\t&& isInitiatedByCompany\n\t\t;\n\n\t\tthis.editor.setSectionVisibilityByType(\n\t\t\tSectionType.HcmLinkIntegration,\n\t\t\tisHcmLinkIntegrationSectionVisible,\n\t\t);\n\t}\n\n\t#isInitiatedByEmployee(): boolean\n\t{\n\t\treturn this.documentSetup.setupData.initiatedByType === DocumentInitiated.employee;\n\t}\n\n\t#decorateStepsBeforeCompletionWithAnalytics(steps: Metadata, documentUid?: string): void\n\t{\n\t\tconst analytics = this.getAnalytics();\n\n\t\tif (Type.isPlainObject(steps.setup))\n\t\t{\n\t\t\tsteps.setup.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.setup.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnSetupStep(analytics, documentUid),\n\t\t\t\t() => this.#sendAnalyticsOnSetupError(analytics),\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isPlainObject(steps.company))\n\t\t{\n\t\t\tsteps.company.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.company.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnCompanyStepSuccess(analytics),\n\t\t\t\t() => this.#sendAnalyticsOnCompanyStepError(analytics),\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isPlainObject(steps.send))\n\t\t{\n\t\t\tsteps.send.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.send.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnSendStepSuccess(analytics, this.documentSetup.setupData.uid),\n\t\t\t\t() => this.#sendAnalyticsOnSendStepError(analytics, this.documentSetup.setupData.uid),\n\t\t\t);\n\t\t}\n\t}\n\n\t#sendAnalyticsOnSetupStep(analytics: Analytics, documentUid?: string): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_document', c_element: 'create_button', status: 'success' });\n\t\t\tanalytics.send({\n\t\t\t\tevent: 'turn_on_off_template',\n\t\t\t\ttype: 'auto',\n\t\t\t\tc_element: 'off',\n\t\t\t\tp5: `templateId_${this.documentSetup.setupData.templateId}`,\n\t\t\t});\n\t\t}\n\t}\n\n\t#sendAnalyticsOnSetupError(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_document', status: 'error', c_element: 'create_button' });\n\t\t}\n\t}\n\n\t#sendAnalyticsOnCompanyStepSuccess(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_route', status: 'success', c_element: 'create_button' });\n\t\t}\n\t}\n\n\t#sendAnalyticsOnCompanyStepError(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_route', status: 'error', c_element: 'create_button' });\n\t\t}\n\t}\n\n\tasync #sendAnalyticsOnSendStepSuccess(analytics: Analytics, documentUid: string): void\n\t{\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tanalytics.sendWithProviderTypeAndDocId({\n\t\t\t\tevent: 'sent_document_to_sign',\n\t\t\t\tc_element: 'create_button',\n\t\t\t\tstatus: 'success',\n\t\t\t}, documentUid);\n\t\t}\n\t}\n\n\tasync #sendAnalyticsOnSendStepError(analytics: Analytics, documentUid: string): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tthis.getAnalytics().send({\n\t\t\t\tevent: 'click_save_template',\n\t\t\t\tstatus: 'error',\n\t\t\t\tc_element: 'create_button',\n\t\t\t});\n\t\t}\n\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tanalytics.sendWithProviderTypeAndDocId({\n\t\t\t\tevent: 'sent_document_to_sign',\n\t\t\t\tc_element: 'create_button',\n\t\t\t\tstatus: 'error',\n\t\t\t}, documentUid);\n\t\t}\n\t}\n\n\t#sendAnalyticsOnStart(documentUid?: string): void\n\t{\n\t\tconst analytics = this.getAnalytics();\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'open_wizard', c_element: 'create_button' });\n\t\t}\n\t\telse if (this.isDocumentMode())\n\t\t{\n\t\t\tconst context = { event: 'click_create_document', c_element: 'create_button' };\n\t\t\tif (this.isEditMode() && Type.isStringFilled(documentUid))\n\t\t\t{\n\t\t\t\tanalytics.sendWithDocId(context, documentUid);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tanalytics.send(context);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync #processSetupData(): Promise<void>\n\t{\n\t\tconst firstDocumentData = this.getFirstDocumentDataFromGroup();\n\t\tthis.#companyParty.setInitiatedByType(firstDocumentData.initiatedByType);\n\t\tthis.#companyParty.setEntityId(firstDocumentData.entityId);\n\t\tif (this.isTemplateMode())\n\t\t{\n\t\t\tawait this.#companyParty.reloadCompanyProviders();\n\t\t\tthis.#companyParty.setIntegrationSelectorAvailability(this.#isTemplateModeForCompany());\n\t\t}\n\t\tthis.editedDocument = null;\n\n\t\tif (this.hasPreviewUrls)\n\t\t{\n\t\t\tthis.wizard.toggleBtnActiveState('next', false);\n\t\t}\n\t}\n\n\tasync #addDocumentInGroup(setupData: DocumentDetails): Promise<void>\n\t{\n\t\tif (this.documentSetup.blankIsNotSelected)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isTemplateMode() || !FeatureStorage.isGroupSendingEnabled())\n\t\t{\n\t\t\tthis.setSingleDocument(setupData);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentsGroup.set(setupData.uid, setupData);\n\t\tthis.addInDocumentsGroupUids(setupData.uid);\n\t\tthis.documentSetup.blankSelector.disableSelectedBlank(setupData.blankId);\n\n\t\tif (!setupData.groupId && !this.editedDocument)\n\t\t{\n\t\t\tawait this.#attachGroupToDocument(setupData);\n\t\t}\n\n\t\tif (!this.isTemplateMode())\n\t\t{\n\t\t\tthis.documentSetup.documentCounters.update(this.documentsGroup.size);\n\t\t}\n\n\t\tif (!this.editedDocument)\n\t\t{\n\t\t\tthis.documentSetup.renderDocumentBlock(setupData);\n\t\t}\n\t}\n\n\t#scrollToTop(): void\n\t{\n\t\twindow.scrollTo({\n\t\t\ttop: 0,\n\t\t\tbehavior: 'smooth',\n\t\t});\n\t}\n\n\t#scrollToDown(): void\n\t{\n\t\twindow.scrollTo({\n\t\t\ttop: document.body.scrollHeight,\n\t\t\tbehavior: 'smooth',\n\t\t});\n\t}\n\n\t#resetDocument(): void\n\t{\n\t\tif (this.isTemplateMode() || !FeatureStorage.isGroupSendingEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentSetup.resetDocument();\n\n\t\tthis.editedDocument = null;\n\t}\n\n\t#disableDocumentSectionIfLimitReached(): void\n\t{\n\t\tif (this.documentsGroup.size >= this.#maxDocumentCount)\n\t\t{\n\t\t\tthis.documentSetup.setAvailabilityDocumentSection(false);\n\t\t}\n\t}\n\n\tgetAfterPreviewLayout(): HTMLElement | null\n\t{\n\t\tif (!this.isDocumentMode() || !FeatureStorage.isMultiDocumentLoadingEnabled())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.#cache.remember('beforePreviewLayout', () => Tag.render`\n\t\t\t<button class=\"ui-btn ui-btn-light-border ui-btn-md\" style=\"margin-top: 20px;\" onclick=\"${() => this.#onBeforePreviewBtnClick()}\">\n\t\t\t\t${Loc.getMessage('SIGN_SETTINGS_B2E_BEFORE_PREVIEW')}\n\t\t\t</button>\n\t\t`);\n\t}\n\n\t#onBeforePreviewBtnClick(): void\n\t{\n\t\t// eslint-disable-next-line unicorn/no-this-assignment\n\t\tconst self = this;\n\t\tBX.SidePanel.Instance.open('sign-settings:afterPreviewSidePanel', {\n\t\t\tcacheable: false,\n\t\t\twidth: 750,\n\t\t\tcontentCallback: () => {\n\t\t\t\tself.#resetAfterPreviewSidePanel();\n\n\t\t\t\treturn Layout.createContent({\n\t\t\t\t\textensions: ['ui.forms'],\n\t\t\t\t\ttitle: 'Добавить папку с файлами',\n\t\t\t\t\tcontent(): void\n\t\t\t\t\t{\n\t\t\t\t\t\tself.#getUploader();\n\n\t\t\t\t\t\treturn self.#getMultiDocumentAddSidePanelContent();\n\t\t\t\t\t},\n\t\t\t\t\tbuttons({ cancelButton, SaveButton })\n\t\t\t\t\t{\n\t\t\t\t\t\tself.#saveButton = new SaveButton({\n\t\t\t\t\t\t\tonclick: () => self.#onBeforePreviewSaveBtnClick(),\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tself.#saveButton,\n\t\t\t\t\t\t];\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonClose: (event) => {\n\t\t\t\t\tif (this.#isMultiDocumentSaveProcessGone)\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.denyAction();\n\t\t\t\t\t}\n\t\t\t\t\tthis.#resetAfterPreviewSidePanel();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#getMultiDocumentAddSidePanelContent(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('multiDocumentAddSidePanelContent', () => Tag.render`\n\t\t\t<div id=\"multiple-document-add-container\" style=\"display: flex; flex-direction: column;\">\n\t\t\t\t<div style=\"flex-direction: row;\">\n\t\t\t\t\t${this.#getUploadFileFromDirButton().root}\n\t\t\t\t\t${this.#getUploadFileButton()}\n\t\t\t\t</div>\n\t\t\t\t${this.#getDocumentNumber().root}\n\t\t\t\t${this.#getDocumentTypeSelectorLayout().root}\n\t\t\t</div>\n\t\t`);\n\t}\n\n\t#getDocumentNumber(): { root: HTMLElement, numberInput: HTMLInputElement }\n\t{\n\t\treturn this.#cache.remember('documentNumber', () => Tag.render`\n\t\t\t<div>\n\t\t\t\t<h3>${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_DOCUMENT_NUMBER_TITLE')}</h3>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-w100\" style=\"margin-top: 25px;\">\n\t\t\t\t\t<input type=\"text\" class=\"ui-ctl-element\" ref=\"numberInput\" maxlength=\"255\"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\t#getUploader(): Uploader\n\t{\n\t\treturn this.#cache.remember('uploader', () => {\n\t\t\treturn new Uploader({\n\t\t\t\tid: 'sign-settings-uploader',\n\t\t\t\tcontroller: 'sign.upload.blankUploadController',\n\t\t\t\tacceptedFileTypes: [...acceptedUploaderFileTypes.values()].map((a) => `.${a}`),\n\t\t\t\tmultiple: true,\n\t\t\t\tautoUpload: false,\n\t\t\t\tmaxFileSize: 52_428_800,\n\t\t\t\timageMaxFileSize: 10_485_760,\n\t\t\t\tmaxTotalFileSize: 52_428_800,\n\t\t\t\tevents: {\n\t\t\t\t\t[UploaderEvent.BEFORE_FILES_ADD]: (event) => this.#onBeforeFilesAdd(event),\n\t\t\t\t\t[UploaderEvent.FILE_ADD]: (event) => this.#onFileAdd(event.getData().file),\n\t\t\t\t\t[UploaderEvent.UPLOAD_COMPLETE]: (event) => this.#onUploadComplete(event),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#resetAfterPreviewSidePanel(): void\n\t{\n\t\tthis.#cache.delete('uploader');\n\t\tthis.#cache.delete('uploadButton');\n\t\tthis.#cache.delete('uploadFromDirButton');\n\t\tthis.#cache.delete('documentNumber');\n\t\tthis.#cache.delete('numberSelectorLayout');\n\t\tthis.#cache.delete('multiDocumentAddSidePanelContent');\n\t}\n\n\t#getUploadFileButton(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('uploadButton', () => {\n\t\t\tconst layout = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<button class=\"ui-btn ui-btn-light-border\" style=\"margin-top: 15px;\" onclick=\"${() => layout.fileInput.click()}\">${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_ADD_FILE')}</button>\n\t\t\t\t\t<input ref=\"fileInput\" hidden type=\"file\" multiple ref=\"fileInput\" onchange=\"${(event) => {\n\t\t\t\t\t\t\tthis.#onInputFileChange(event);\n\t\t\t\t\t\t\tevent.target.value = '';\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t\taccept=\"${[...acceptedUploaderFileTypes.values()].map((n) => `.${n}`).join(', ')}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\treturn layout.root;\n\t\t});\n\t}\n\n\t#getUploadFileFromDirButton(): { root: HTMLElement, fileInput: HTMLInputElement }\n\t{\n\t\treturn this.#cache.remember('uploadFromDirButton', () => {\n\t\t\tconst layout = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<button class=\"ui-btn ui-btn-primary\" style=\"margin-top: 15px;\" onclick=\"${() => layout.fileInput.click()}\">${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_LOAD_FROM_DIRS')}</button>\n\t\t\t\t\t<input hidden type=\"file\" webkitdirectory multiple ref=\"fileInput\" onchange=\"${(event) => {\n\t\t\t\t\t\tthis.#onInputFileChange(event);\n\t\t\t\t\t\tevent.target.value = '';\n\t\t\t\t\t}}\">\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\treturn layout;\n\t\t});\n\t}\n\n\t#onInputFileChange(event: Event): void\n\t{\n\t\tconst target: HTMLInputElement = event.target;\n\t\tconst files = target.files;\n\t\tconst validatedFiles = [...files].filter((f: File) => acceptedUploaderFileTypes.has(\n\t\t\tf.name.split('.').at(-1),\n\t\t));\n\t\tthis.#getUploader().addFiles(validatedFiles);\n\t}\n\n\t#onFileAdd(file: UploaderFile): void\n\t{\n\t\tDom.insertAfter(\n\t\t\tTag.render`<p style=\"color: #666\">${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_LOADED_FILE_NAME', { '#FILENAME#': Text.encode(file.getName()) })}</p>`,\n\t\t\tthis.#getUploadFileButton(),\n\t\t);\n\t}\n\n\t#onBeforePreviewSaveBtnClick(): void\n\t{\n\t\tif (this.#getUploader().getFiles().length === 0)\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_NO_FILES_SELECTED'));\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#getDocumentTypeSelectorLayout().selector.value?.trim())\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_NO_DOCUMENT_TYPE_SELECTED'));\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#getDocumentNumber().numberInput.value?.trim())\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_NO_DOCUMENT_NUMBER'));\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(this.#getMultiDocumentAddSidePanelContent(), { opacity: 0.6, 'pointer-events': 'none' });\n\t\tthis.#isMultiDocumentSaveProcessGone = true;\n\t\tthis.#getUploader().start();\n\t\tthis.#saveButton.setClocking(true);\n\t}\n\n\tasync #onUploadComplete(event: BaseEvent): void\n\t{\n\t\tconst uploader = this.#getUploader();\n\t\tfor (const file of uploader.getFiles())\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst blankId = await this.documentSetup.blankSelector.createBlankFromOuterUploaderFiles([file]);\n\t\t\t\tthis.documentSetup.blankSelector.selectBlank(blankId);\n\t\t\t\tthis.documentSetup.setDocumentType(this.#getDocumentTypeSelectorLayout().selector.value);\n\t\t\t\tthis.documentSetup.setDocumentNumber(this.#getDocumentNumber().numberInput.value);\n\t\t\t\tawait this.setDocumentsGroup();\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tconsole.error(`Error while add file with name ${file.getName()}`, e);\n\t\t\t}\n\t\t}\n\n\t\tDom.style(this.#getMultiDocumentAddSidePanelContent(), { opacity: 1, 'pointer-events': 'auto' });\n\t\tthis.#isMultiDocumentSaveProcessGone = false;\n\t\tthis.#saveButton.setClocking(false);\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\t#getDocumentTypeSelectorLayout(): { root: HTMLElement, selector: HTMLSelectElement }\n\t{\n\t\treturn this.#cache.remember('numberSelectorLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div style=\"margin-top: 15px;\">\n\t\t\t\t\t<h3>${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_DOCUMENT_TYPE_SELECTOR_TITLE')}</h3>\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t<select class=\"ui-ctl-element\" ref=\"selector\">\n\t\t\t\t\t\t\t${this.#regionDocumentTypes.map(({ code, description }) => Tag.render`\n\t\t\t\t\t\t\t\t<option value=\"${Text.encode(code)}\">${code}: ${Text.encode(description)}</option>\n\t\t\t\t\t\t\t`)}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#onBeforeFilesAdd(event: BaseEvent<{ files: Array<UploaderFile> }>): void\n\t{\n\t\tconst uploaderConfig = {\n\t\t\tmaxFileSize: 52_428_800,\n\t\t\timageMaxFileSize: 10_485_760,\n\t\t\tmaxTotalFileSize: 52_428_800,\n\t\t};\n\t\tconst data = event.getData();\n\t\tconst files: UploaderFile[] = data.files;\n\t\tconst uploader = this.#getUploader();\n\t\tconst allFilesWithNew: UploaderFile[] = [...files, ...uploader.getFiles()];\n\n\t\tif ((allFilesWithNew.length + this.documentsGroup.size) > this.#maxDocumentCount)\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_MAX_DOCUMENTS_COUNT_EXCEEDED'));\n\t\t\tevent.preventDefault();\n\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const file of files)\n\t\t{\n\t\t\tif (file.getSize() > uploaderConfig.maxFileSize)\n\t\t\t{\n\t\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_INVALID_FILE_SIZE'));\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (file.isImage() && file.getSize() > uploaderConfig.imageMaxFileSize)\n\t\t\t{\n\t\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_INVALID_IMAGE_FILE_SIZE'));\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst totalFileSize = allFilesWithNew.reduce((acc, file) => acc + file.getSize(), 0);\n\t\tif (totalFileSize > uploaderConfig.maxTotalFileSize)\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_MAX_TOTAL_FILE_SIZE_EXCEEDED'));\n\t\t\tevent.preventDefault();\n\n\t\t}\n\t}\n}\n"],"names":["acceptedUploaderFileTypes","Set","B2ESignSettings","SignSettings","constructor","containerId","signOptions","next","className","complete","swapButtons","MemoryCache","b2eFeatureConfig","blankSelectorConfig","documentSendConfig","userPartyConfig","documentSetup","DocumentSetup","documentSend","DocumentSend","CompanyParty","documentInitiatedType","initiatedByType","documentMode","hcmLinkAvailable","Api","b2eDocumentLimitCount","UserParty","mode","subscribeOnEvents","regionDocumentTypes","subscribe","data","setDocumentTitle","title","wizard","toggleBtnActiveState","setDocumentsGroup","uid","setAvailabilityDocumentSection","events","onTemplateComplete","event","isTemplateMode","isEditMode","templateId","getData","getAnalytics","send","type","c_element","p5","status","blankIsNotSelected","validate","switchAddDocumentButtonLoadingState","documentData","setupDocument","documentsGroup","set","addInDocumentsGroupUids","blankSelector","disableSelectedBlank","blankId","editedDocument","renderDocumentBlock","documentCounters","update","size","documentsGroupUids","includes","push","replaceInDocumentsGroupUids","oldUid","newUid","index","indexOf","splice","deleteFromDocumentsGroupUids","applyDocumentData","setupData","groupId","documentsGroupData","getDocumentListInGroup","item","blocks","loadBlocksByDocument","updatedItem","firstDocument","getFirstDocumentDataFromGroup","entityId","representativeId","companyUid","hcmLinkCompanyId","isSingleDocument","editor","setEntityId","setLastSavedIntegrationId","loadCompany","loadRepresentative","members","loadMembers","parsedMembers","signers","reviewers","editors","length","load","loadValidator","MemberRole","reviewer","applyTemplateData","templateUid","setExistingTemplate","setIntegrationSelectorAvailability","getStepsMetadata","signSettings","documentUid","steps","setup","company","isDocumentMode","employees","init","Type","isNull","getAfterPreviewLayout","BX","hide","onComplete","isTemplateCreateMode","FeatureStorage","isMultiDocumentLoadingEnabled","remember","Tag","render","Loc","getMessage","config","editMode","get","isRuRegion","setDocumentNumber","externalId","resetEditMode","replaceDocumentBlock","setUrls","documentId","deletedElement","layout","querySelector","remove","createDocumentsGroup","targetDocument","attachGroupToDocument","error","console","updatedDocumentData","updateDocumentData","updateDocumentBlock","id","setDocumentsBlock","deleteButton","ready","removeDocument","isFirstDocumentSelected","resetPreview","hasPreviewUrls","deleteDocument","delete","enableSelectedBlank","deleteDocumentFromList","toggleDeleteBtnLoadingState","representative","getParties","signerParty","documentUids","keys","setupB2eParties","membersData","isArrayFilled","Error","syncMemberPromises","map","Promise","all","memberData","presetId","part","party","entityTypeId","role","isInitiatedByCompany","DocumentInitiated","syncFinished","response","syncB2eMembersWithDepartments","ms","resolve","setTimeout","employee","currentParty","companyId","entityType","assignee","entity","signer","validation","userPartyEntities","getEntities","result","loadedMembers","reduce","acc","member","content","SignSettingsItemCounter","numerate","show","beforeCompletion","blankIsSelected","selectedBlankId","isFileAdded","isValid","titleLocCode","getLayout","isTemplateModeForCompany","setEditorAvailability","save","setSenderType","integrationId","getSelectedIntegrationId","hcmLinkEnabled","entityData","isTemplate","loadBlocks","editorData","e","partiesData","Object","assign","resetUserPartyPopup","setPartiesData","setAnalytics","toggleBtnLoadingState","waitForPagesUrls","renderDocument","sendForSign","selectedProvider","getSelectedProvider","isNotSesRuProvider","code","ProviderCode","sesRu","isSecondPartySectionVisible","setSectionVisibilityByType","SectionType","SecondParty","changeIntegrationId","isHcmLinkIntegrationSectionVisible","HcmLinkIntegration","analytics","isPlainObject","decorateResultBeforeCompletion","sendWithProviderTypeAndDocId","context","isStringFilled","sendWithDocId","firstDocumentData","setInitiatedByType","reloadCompanyProviders","isGroupSendingEnabled","setSingleDocument","window","scrollTo","top","behavior","document","body","scrollHeight","resetDocument","self","SidePanel","Instance","open","cacheable","width","contentCallback","Layout","createContent","extensions","buttons","cancelButton","SaveButton","onclick","onClose","denyAction","root","Uploader","controller","acceptedFileTypes","values","a","multiple","autoUpload","maxFileSize","imageMaxFileSize","maxTotalFileSize","UploaderEvent","BEFORE_FILES_ADD","FILE_ADD","file","UPLOAD_COMPLETE","fileInput","click","target","value","n","join","files","validatedFiles","filter","f","has","name","split","at","addFiles","Dom","insertAfter","Text","encode","getName","getFiles","alert","selector","trim","numberInput","style","opacity","start","setClocking","uploader","createBlankFromOuterUploaderFiles","selectBlank","setDocumentType","close","description","uploaderConfig","allFilesWithNew","preventDefault","getSize","isImage","totalFileSize"],"mappings":"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"}