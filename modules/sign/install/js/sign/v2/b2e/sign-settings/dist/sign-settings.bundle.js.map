{"version":3,"file":"sign-settings.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Loc, Type } from 'main.core';\nimport './style.css';\nimport { type BaseEvent } from 'main.core.events';\nimport { Api, MemberRole, type SetupMember } from 'sign.v2.api';\nimport { ProviderCode } from 'sign.v2.b2e.company-selector';\nimport { DocumentSend } from 'sign.v2.b2e.document-send';\nimport { DocumentSetup } from 'sign.v2.b2e.document-setup';\nimport { Parties as CompanyParty } from 'sign.v2.b2e.parties';\nimport { type CardItem, UserParty } from 'sign.v2.b2e.user-party';\nimport { DocumentInitiated, DocumentInitiatedType } from 'sign.v2.document-setup';\nimport { SectionType } from 'sign.v2.editor';\nimport { SignSettingsItemCounter } from 'sign.v2.helper';\nimport {\n\tdecorateResultBeforeCompletion,\n\tisTemplateMode,\n\ttype SignOptions,\n\ttype SignOptionsConfig,\n\tSignSettings,\n} from 'sign.v2.sign-settings';\nimport type { Metadata } from 'ui.wizard';\nimport { B2EFeatureConfig } from './type';\n\nexport type { B2EFeatureConfig };\n\ntype SetupMembersResponse = {\n\tmembers: Array<SetupMember>,\n\tcurrentParty: number,\n};\n\nexport class B2ESignSettings extends SignSettings\n{\n\t#companyParty: CompanyParty;\n\t#userParty: UserParty;\n\t#api: Api;\n\tdocumentSetup: DocumentSend;\n\n\tconstructor(containerId: string, signOptions: SignOptions)\n\t{\n\t\tsuper(containerId, signOptions, {\n\t\t\tnext: { className: 'ui-btn-success' },\n\t\t\tcomplete: { className: 'ui-btn-success' },\n\t\t\tswapButtons: true,\n\t\t});\n\t\tconst {\n\t\t\tb2eFeatureConfig,\n\t\t\tblankSelectorConfig,\n\t\t\tdocumentSendConfig,\n\t\t\tuserPartyConfig,\n\t\t} = this.#prepareConfig(signOptions);\n\n\t\tblankSelectorConfig.hideValidationParty = isTemplateMode(this.documentMode);\n\n\t\tthis.documentSetup = new DocumentSetup(blankSelectorConfig);\n\t\tthis.documentSend = new DocumentSend(documentSendConfig);\n\t\tthis.#companyParty = new CompanyParty({\n\t\t\t...blankSelectorConfig,\n\t\t\tdocumentInitiatedType: signOptions.initiatedByType,\n\t\t\tdocumentMode: signOptions.documentMode,\n\t\t}, b2eFeatureConfig.hcmLinkAvailable);\n\t\tthis.#api = new Api();\n\t\tthis.#userParty = new UserParty({ mode: 'edit', ...userPartyConfig });\n\t\tthis.subscribeOnEvents();\n\t}\n\n\t#prepareConfig(signOptions: SignOptions): SignOptionsConfig\n\t{\n\t\tconst { config, documentMode } = signOptions;\n\n\t\tconst { blankSelectorConfig, documentSendConfig } = config;\n\t\tblankSelectorConfig.documentMode = documentMode;\n\t\tdocumentSendConfig.documentMode = documentMode;\n\n\t\treturn config;\n\t}\n\n\tsubscribeOnEvents(): void\n\t{\n\t\tsuper.subscribeOnEvents();\n\t\tthis.documentSend.subscribe('changeTitle', ({ data }) => {\n\t\t\tthis.documentSetup.setDocumentTitle(data.title);\n\t\t});\n\t\tthis.documentSend.subscribe('disableBack', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('back', true);\n\t\t});\n\t\tthis.documentSend.subscribe('enableBack', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('back', false);\n\t\t});\n\t\tthis.documentSend.subscribe('enableComplete', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('complete', false);\n\t\t});\n\t\tthis.documentSend.subscribe('disableComplete', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('complete', true);\n\t\t});\n\t\tthis.documentSend.subscribe(\n\t\t\tthis.documentSend.events.onTemplateComplete,\n\t\t\t(event: BaseEvent<{ templateId: number }>) => {\n\t\t\t\tif (this.isTemplateMode() && !this.isEditMode())\n\t\t\t\t{\n\t\t\t\t\tconst templateId = event.getData().templateId;\n\t\t\t\t\tthis.getAnalytics().send({\n\t\t\t\t\t\tevent: 'turn_on_off_template',\n\t\t\t\t\t\ttype: 'auto',\n\t\t\t\t\t\tc_element: 'on',\n\t\t\t\t\t\tp5: `templateId_${templateId}`,\n\t\t\t\t\t});\n\t\t\t\t\tthis.getAnalytics().send({\n\t\t\t\t\t\tevent: 'click_save_template',\n\t\t\t\t\t\tc_element: 'create_button',\n\t\t\t\t\t\tp5: `templateId_${templateId}`,\n\t\t\t\t\t\tstatus: 'success',\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tasync #setupParties(): Promise<Array<Object>>\n\t{\n\t\tconst uid = this.#documentUid;\n\t\tconst { representative } = this.#companyParty.getParties();\n\t\tconst { members, signerParty } = this.#makeSetupMembers();\n\n\t\tawait this.#api.setupB2eParties(uid, representative.entityId, members);\n\t\tconst membersData = await this.#api.loadMembers(uid);\n\t\tif (!Type.isArrayFilled(membersData))\n\t\t{\n\t\t\tthrow new Error('Members are empty');\n\t\t}\n\n\t\tawait this.#syncMembers(uid, signerParty);\n\n\t\treturn membersData.map((memberData) => {\n\t\t\treturn {\n\t\t\t\tpresetId: memberData?.presetId,\n\t\t\t\tpart: memberData?.party,\n\t\t\t\tuid: memberData?.uid,\n\t\t\t\tentityTypeId: memberData?.entityTypeId ?? null,\n\t\t\t\tentityId: memberData?.entityId ?? null,\n\t\t\t\trole: memberData?.role ?? null,\n\t\t\t};\n\t\t});\n\t}\n\n\tasync #syncMembers(uid: string, signerParty: number): Promise<void>\n\t{\n\t\tlet syncFinished = false;\n\t\twhile (!syncFinished)\n\t\t{\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tconst response = await this.#api.syncB2eMembersWithDepartments(uid, signerParty);\n\t\t\tsyncFinished = response.syncFinished;\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.#sleep(1000);\n\t\t}\n\t}\n\n\t#sleep(ms: Number): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, ms);\n\t\t});\n\t}\n\n\tget #documentUid(): string\n\t{\n\t\treturn this.documentSetup.setupData.uid;\n\t}\n\n\tget #isDocumentInitiatedByEmployee(): DocumentInitiatedType\n\t{\n\t\treturn this.documentSetup.setupData.initiatedByType === DocumentInitiated.employee;\n\t}\n\n\t#getAssignee(currentParty: number, companyId: number): SetupMember\n\t{\n\t\treturn {\n\t\t\tentityType: 'company',\n\t\t\tentityId: companyId,\n\t\t\tparty: currentParty,\n\t\t\trole: MemberRole.assignee,\n\t\t};\n\t}\n\n\t#getSigner(currentParty: number, entity: CardItem): SetupMember\n\t{\n\t\treturn {\n\t\t\tentityType: entity.entityType,\n\t\t\tentityId: entity.entityId,\n\t\t\tparty: currentParty,\n\t\t\trole: MemberRole.signer,\n\t\t};\n\t}\n\n\t#makeSetupMembers(): SetupMembersResponse\n\t{\n\t\tconst { company, validation } = this.#companyParty.getParties();\n\n\t\tconst userPartyEntities = this.#userParty.getEntities();\n\n\t\tlet currentParty = this.#isDocumentInitiatedByEmployee ? 2 : 1;\n\n\t\tconst members = validation.map((item): SetupMember => {\n\t\t\tconst result = { ...item, party: currentParty };\n\t\t\tcurrentParty++;\n\n\t\t\treturn result;\n\t\t});\n\t\tmembers.push(this.#getAssignee(currentParty, company.entityId));\n\n\t\tlet signerParty = currentParty;\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tsignerParty = this.#isDocumentInitiatedByEmployee ? 1 : currentParty + 1;\n\t\t\tconst signers = userPartyEntities.map((entity) => this.#getSigner(signerParty, entity));\n\t\t\tmembers.push(...signers);\n\t\t}\n\n\t\treturn { members, signerParty };\n\t}\n\n\t#parseMembers(loadedMembers: SetupMember[]): { [$Keys<typeof MemberRole>]: number[]; }\n\t{\n\t\treturn loadedMembers.reduce((acc, member) => {\n\t\t\tconst { entityType, entityId } = member;\n\t\t\tif (entityType !== 'user')\n\t\t\t{\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst role = `${member.role}s`;\n\n\t\t\treturn {\n\t\t\t\t...acc,\n\t\t\t\t[role]: [\n\t\t\t\t\t...acc[role] ?? [],\n\t\t\t\t\tentityId,\n\t\t\t\t],\n\t\t\t};\n\t\t}, {});\n\t}\n\n\tasync applyDocumentData(uid: string): Promise<boolean>\n\t{\n\t\tconst setupData = await this.setupDocument(uid, true);\n\t\tif (!setupData)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { entityId, representativeId, companyUid, hcmLinkCompanyId } = setupData;\n\t\tthis.documentSend.documentData = setupData;\n\t\tthis.editor.documentData = setupData;\n\t\tthis.#companyParty.setEntityId(entityId);\n\t\tif (companyUid)\n\t\t{\n\t\t\tthis.#companyParty.setLastSavedIntegrationId(hcmLinkCompanyId);\n\t\t\tthis.#companyParty.loadCompany(companyUid);\n\t\t}\n\n\t\tif (representativeId)\n\t\t{\n\t\t\tthis.#companyParty.loadRepresentative(representativeId);\n\t\t}\n\n\t\tconst members = await this.#api.loadMembers(uid);\n\t\tconst parsedMembers = this.#parseMembers(members);\n\t\tconst { signers = [], reviewers = [], editors = [] } = parsedMembers;\n\t\tif (signers.length > 0)\n\t\t{\n\t\t\tthis.#userParty.load(signers);\n\t\t}\n\n\t\tif (reviewers.length > 0)\n\t\t{\n\t\t\tthis.#companyParty.loadValidator(reviewers[0], MemberRole.reviewer);\n\t\t}\n\n\t\tif (editors.length > 0)\n\t\t{\n\t\t\tthis.#companyParty.loadValidator(editors[0], MemberRole.editor);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tasync applyTemplateData(templateUid: string): Promise<boolean>\n\t{\n\t\tsuper.applyTemplateData(templateUid);\n\n\t\tthis.documentSetup.setupData.templateUid = templateUid;\n\t\tthis.documentSend.setExistingTemplate();\n\n\t\treturn true;\n\t}\n\n\t#getSetupStep(signSettings: B2ESignSettings, documentUid?: string): $Values<Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.documentSetup.layout;\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2B_LOAD_DOCUMENT'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\tconst isValid = this.documentSetup.validate();\n\t\t\t\tif (!isValid)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst setupDataPromise = this.setupDocument();\n\t\t\t\tif (!setupDataPromise)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst setupData = await setupDataPromise;\n\t\t\t\tif (!setupData)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.#companyParty.setInitiatedByType(setupData.initiatedByType);\n\t\t\t\tthis.#companyParty.setEntityId(setupData.entityId);\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\t#getCompanyStep(signSettings: B2ESignSettings): $Values<Metadata>\n\t{\n\t\tconst titleLocCode = this.isTemplateMode()\n\t\t\t? 'SIGN_SETTINGS_B2E_ROUTES'\n\t\t\t: 'SIGN_SETTINGS_B2E_COMPANY'\n\t\t;\n\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.#companyParty.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage(titleLocCode),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\tconst { uid } = this.documentSetup.setupData;\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tawait this.#companyParty.save(uid);\n\t\t\t\t\tthis.documentSetup.setupData.integrationId = this.#companyParty.getSelectedIntegrationId();\n\n\t\t\t\t\tthis.#setSecondPartySectionVisibility();\n\n\t\t\t\t\tif (this.isTemplateMode())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.editor.entityData = await this.#setupParties();\n\t\t\t\t\t\tconst { title, isTemplate, entityId, externalId, templateUid } = this.documentSetup.setupData;\n\t\t\t\t\t\tconst blocks = await this.documentSetup.loadBlocks(uid);\n\t\t\t\t\t\tthis.#executeDocumentSendActions({ uid, title, blocks, externalId, templateUid });\n\n\t\t\t\t\t\tthis.#executeEditorActions({ isTemplate, uid, blocks, entityId });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\t#getEmployeeStep(signSettings: B2ESignSettings): $Values<Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.#userParty.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2E_EMPLOYEES'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tconst isValid = this.#userParty.validate();\n\t\t\t\t\tif (!isValid)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn isValid;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.editor.entityData = await this.#setupParties();\n\n\t\t\t\t\tconst { uid, title, isTemplate, externalId, entityId, integrationId } = this.documentSetup.setupData;\n\t\t\t\t\tconst blocks = await this.documentSetup.loadBlocks(uid);\n\n\t\t\t\t\tthis.#executeDocumentSendActions({ uid, title, blocks, externalId, integrationId });\n\n\t\t\t\t\tthis.#executeEditorActions({ isTemplate, uid, blocks, entityId });\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(e);\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tasync #executeDocumentSendActions(documentSendData: Object): Promise<void>\n\t{\n\t\tconst partiesData = this.#companyParty.getParties();\n\t\tObject.assign(partiesData, {\n\t\t\temployees: this.#userParty.getEntities().map((entity) => {\n\t\t\t\treturn {\n\t\t\t\t\tentityType: entity.entityType,\n\t\t\t\t\tentityId: entity.entityId,\n\t\t\t\t};\n\t\t\t}),\n\t\t});\n\t\tthis.documentSend.documentData = documentSendData;\n\t\tthis.documentSend.resetUserPartyPopup();\n\t\tthis.documentSend.setPartiesData(partiesData);\n\t}\n\n\tasync #executeEditorActions(editorData: Object): Promise<void>\n\t{\n\t\tthis.editor.documentData = editorData;\n\t\tawait this.editor.waitForPagesUrls();\n\t\tawait this.editor.renderDocument();\n\t\tthis.wizard.toggleBtnLoadingState('next', false);\n\t\tawait this.editor.show();\n\t}\n\n\t#getSendStep(signSettings: B2ESignSettings): $Values<Metadata>\n\t{\n\t\tconst titleLocCode = this.isTemplateMode()\n\t\t\t? 'SIGN_SETTINGS_SEND_DOCUMENT_CREATE'\n\t\t\t: 'SIGN_SETTINGS_SEND_DOCUMENT'\n\t\t;\n\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.documentSend.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage(titleLocCode),\n\t\t\tbeforeCompletion: () => this.documentSend.sendForSign(),\n\t\t};\n\t}\n\n\tgetStepsMetadata(signSettings: this, documentUid: ?string, templateUid?: string): Metadata\n\t{\n\t\tthis.#sendAnalyticsOnStart(documentUid);\n\t\tconst steps = {\n\t\t\tsetup: this.#getSetupStep(signSettings, documentUid),\n\t\t\tcompany: this.#getCompanyStep(signSettings),\n\t\t};\n\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tsteps.employees = this.#getEmployeeStep(signSettings);\n\t\t}\n\n\t\tsteps.send = this.#getSendStep(signSettings);\n\n\t\tthis.#decorateStepsBeforeCompletionWithAnalytics(steps, documentUid);\n\n\t\treturn steps;\n\t}\n\n\tonComplete(): void\n\t{\n\t\tif (this.isTemplateMode())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tsuper.onComplete();\n\t}\n\n\tisTemplateCreateMode(): boolean\n\t{\n\t\treturn isTemplateMode(this.documentMode) && !this.isEditMode();\n\t}\n\n\t#setSecondPartySectionVisibility(): void\n\t{\n\t\tconst selectedProvider = this.#companyParty.getSelectedProvider();\n\n\t\tconst isNotSesRuProvider = selectedProvider.code !== ProviderCode.sesRu;\n\t\tconst isInitiatedByEmployee = this.documentSetup.setupData.initiatedByType === DocumentInitiated.employee;\n\t\tconst isInitiatedByCompany = this.documentSetup.setupData.initiatedByType === DocumentInitiated.company;\n\n\t\tconst isSecondPartySectionVisible =\tisNotSesRuProvider\n\t\t\t|| (isTemplateMode(this.documentMode) && isInitiatedByEmployee)\n\t\t;\n\n\t\tconst isHcmLinkIntegrationSectionVisible = this.documentSetup.setupData.integrationId > 0\n\t\t\t|| isInitiatedByCompany\n\t\t;\n\n\t\tthis.editor.setSectionVisibilityByType(\n\t\t\tSectionType.HcmLinkIntegration,\n\t\t\tisHcmLinkIntegrationSectionVisible,\n\t\t);\n\n\t\tthis.editor.setSectionVisibilityByType(\n\t\t\tSectionType.SecondParty,\n\t\t\tisSecondPartySectionVisible,\n\t\t);\n\t}\n\n\t#decorateStepsBeforeCompletionWithAnalytics(steps: Metadata, documentUid?: string): void\n\t{\n\t\tconst analytics = this.getAnalytics();\n\n\t\tif (Type.isPlainObject(steps.setup))\n\t\t{\n\t\t\tsteps.setup.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.setup.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnSetupStep(analytics, documentUid),\n\t\t\t\t() => this.#sendAnalyticsOnSetupError(analytics),\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isPlainObject(steps.company))\n\t\t{\n\t\t\tsteps.company.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.company.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnCompanyStepSuccess(analytics),\n\t\t\t\t() => this.#sendAnalyticsOnCompanyStepError(analytics),\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isPlainObject(steps.send))\n\t\t{\n\t\t\tsteps.send.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.send.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnSendStepSuccess(analytics, this.documentSetup.setupData.uid),\n\t\t\t\t() => this.#sendAnalyticsOnSendStepError(analytics, this.documentSetup.setupData.uid),\n\t\t\t);\n\t\t}\n\t}\n\n\t#sendAnalyticsOnSetupStep(analytics: Analytics, documentUid?: string): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_document', c_element: 'create_button', status: 'success' });\n\t\t\tanalytics.send({\n\t\t\t\tevent: 'turn_on_off_template',\n\t\t\t\ttype: 'auto',\n\t\t\t\tc_element: 'off',\n\t\t\t\tp5: `templateId_${this.documentSetup.setupData.templateId}`,\n\t\t\t});\n\t\t}\n\t}\n\n\t#sendAnalyticsOnSetupError(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_document', status: 'error', c_element: 'create_button' });\n\t\t}\n\t}\n\n\t#sendAnalyticsOnCompanyStepSuccess(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_route', status: 'success', c_element: 'create_button' });\n\t\t}\n\t}\n\n\t#sendAnalyticsOnCompanyStepError(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_route', status: 'error', c_element: 'create_button' });\n\t\t}\n\t}\n\n\tasync #sendAnalyticsOnSendStepSuccess(analytics: Analytics, documentUid: string): void\n\t{\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tanalytics.sendWithProviderTypeAndDocId({\n\t\t\t\tevent: 'sent_document_to_sign',\n\t\t\t\tc_element: 'create_button',\n\t\t\t\tstatus: 'success',\n\t\t\t}, documentUid);\n\t\t}\n\t}\n\n\tasync #sendAnalyticsOnSendStepError(analytics: Analytics, documentUid: string): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tthis.getAnalytics().send({\n\t\t\t\tevent: 'click_save_template',\n\t\t\t\tstatus: 'error',\n\t\t\t\tc_element: 'create_button',\n\t\t\t});\n\t\t}\n\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tanalytics.sendWithProviderTypeAndDocId({\n\t\t\t\tevent: 'sent_document_to_sign',\n\t\t\t\tc_element: 'create_button',\n\t\t\t\tstatus: 'error',\n\t\t\t}, documentUid);\n\t\t}\n\t}\n\n\t#sendAnalyticsOnStart(documentUid?: string): void\n\t{\n\t\tconst analytics = this.getAnalytics();\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'open_wizard', c_element: 'create_button' });\n\t\t}\n\t\telse if (this.isDocumentMode())\n\t\t{\n\t\t\tconst context = { event: 'click_create_document', c_element: 'create_button' };\n\t\t\tif (this.isEditMode() && Type.isStringFilled(documentUid))\n\t\t\t{\n\t\t\t\tanalytics.sendWithDocId(context, documentUid);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tanalytics.send(context);\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["B2ESignSettings","SignSettings","constructor","containerId","signOptions","next","className","complete","swapButtons","b2eFeatureConfig","blankSelectorConfig","documentSendConfig","userPartyConfig","hideValidationParty","isTemplateMode","documentMode","documentSetup","DocumentSetup","documentSend","DocumentSend","CompanyParty","documentInitiatedType","initiatedByType","hcmLinkAvailable","Api","UserParty","mode","subscribeOnEvents","subscribe","data","setDocumentTitle","title","wizard","toggleBtnActiveState","events","onTemplateComplete","event","isEditMode","templateId","getData","getAnalytics","send","type","c_element","p5","status","applyDocumentData","uid","setupData","setupDocument","entityId","representativeId","companyUid","hcmLinkCompanyId","documentData","editor","setEntityId","setLastSavedIntegrationId","loadCompany","loadRepresentative","members","loadMembers","parsedMembers","signers","reviewers","editors","length","load","loadValidator","MemberRole","reviewer","applyTemplateData","templateUid","setExistingTemplate","getStepsMetadata","signSettings","documentUid","steps","setup","company","isDocumentMode","employees","onComplete","isTemplateCreateMode","config","representative","getParties","signerParty","setupB2eParties","membersData","Type","isArrayFilled","Error","map","memberData","presetId","part","party","entityTypeId","role","syncFinished","response","syncB2eMembersWithDepartments","ms","Promise","resolve","setTimeout","DocumentInitiated","employee","currentParty","companyId","entityType","assignee","entity","signer","validation","userPartyEntities","getEntities","item","result","push","loadedMembers","reduce","acc","member","content","layout","SignSettingsItemCounter","numerate","Loc","getMessage","beforeCompletion","isValid","validate","setupDataPromise","setInitiatedByType","titleLocCode","getLayout","save","integrationId","getSelectedIntegrationId","entityData","isTemplate","externalId","blocks","loadBlocks","e","console","error","documentSendData","partiesData","Object","assign","resetUserPartyPopup","setPartiesData","editorData","waitForPagesUrls","renderDocument","toggleBtnLoadingState","show","sendForSign","selectedProvider","getSelectedProvider","isNotSesRuProvider","code","ProviderCode","sesRu","isInitiatedByEmployee","isInitiatedByCompany","isSecondPartySectionVisible","isHcmLinkIntegrationSectionVisible","setSectionVisibilityByType","SectionType","HcmLinkIntegration","SecondParty","analytics","isPlainObject","decorateResultBeforeCompletion","sendWithProviderTypeAndDocId","context","isStringFilled","sendWithDocId"],"mappings":"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"}