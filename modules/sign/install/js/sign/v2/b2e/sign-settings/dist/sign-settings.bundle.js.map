{"version":3,"file":"sign-settings.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Dom, Loc, Tag, Type, Text } from 'main.core';\nimport { MemoryCache } from 'main.core.cache';\nimport { type BaseEvent } from 'main.core.events';\nimport { FeatureStorage } from 'sign.feature-storage';\nimport { Api, type SetupMember } from 'sign.v2.api';\nimport { DocumentSend } from 'sign.v2.b2e.document-send';\nimport { DocumentSetup } from 'sign.v2.b2e.document-setup';\nimport { Parties as CompanyParty } from 'sign.v2.b2e.parties';\nimport { type CardItem, UserParty } from 'sign.v2.b2e.user-party';\nimport { type DocumentDetails } from 'sign.v2.document-setup';\nimport { type DocumentInitiatedType, DocumentInitiated, ProviderCode, MemberRole } from 'sign.type';\nimport { SectionType } from 'sign.v2.editor';\nimport { SignSettingsItemCounter } from 'sign.v2.helper';\nimport {\n\tdecorateResultBeforeCompletion,\n\tisTemplateMode,\n\ttype SignOptions,\n\ttype SignOptionsConfig,\n\tSignSettings,\n} from 'sign.v2.sign-settings';\nimport { type SaveButton } from 'ui.buttons';\nimport { Layout } from 'ui.sidepanel.layout';\nimport { Uploader, UploaderEvent, UploaderFile } from 'ui.uploader.core';\nimport type { Metadata } from 'ui.wizard';\nimport { B2EFeatureConfig } from './type';\n\nimport './style.css';\n\nexport type { B2EFeatureConfig };\n\ntype SetupMembersResponse = {\n\tmembers: Array<SetupMember>,\n\tcurrentParty: number,\n};\n\ntype PartiesDetails = {\n\tentityId: number,\n\tentityTypeId: number,\n\tpart: number,\n\tpresetId: number,\n\trole: string,\n\tuid: string\n}\n\nconst acceptedUploaderFileTypes: Set<string> = new Set([\n\t'jpg',\n\t'jpeg',\n\t'png',\n\t'pdf',\n\t'doc',\n\t'docx',\n\t'rtf',\n\t'odt',\n]);\n\nexport class B2ESignSettings extends SignSettings\n{\n\t#companyParty: CompanyParty;\n\t#userParty: UserParty;\n\t#api: Api;\n\tdocumentSetup: DocumentSetup;\n\teditedDocument: DocumentDetails | null;\n\t#maxDocumentCount: boolean;\n\t#cache: MemoryCache<any> = new MemoryCache();\n\t#regionDocumentTypes: Array<{ code: string, description: string }> = [];\n\t#saveButton: SaveButton;\n\t#isMultiDocumentSaveProcessGone: boolean = false;\n\n\tconstructor(containerId: string, signOptions: SignOptions)\n\t{\n\t\tsuper(containerId, signOptions, {\n\t\t\tnext: { className: 'ui-btn-success' },\n\t\t\tcomplete: { className: 'ui-btn-success' },\n\t\t\tswapButtons: true,\n\t\t});\n\t\tconst {\n\t\t\tb2eFeatureConfig,\n\t\t\tblankSelectorConfig,\n\t\t\tdocumentSendConfig,\n\t\t\tuserPartyConfig,\n\t\t} = this.#prepareConfig(signOptions);\n\n\t\tblankSelectorConfig.hideValidationParty = isTemplateMode(this.documentMode);\n\n\t\tthis.documentSetup = new DocumentSetup(blankSelectorConfig);\n\t\tthis.documentSend = new DocumentSend(documentSendConfig);\n\t\tthis.#companyParty = new CompanyParty({\n\t\t\t...blankSelectorConfig,\n\t\t\tdocumentInitiatedType: signOptions.initiatedByType,\n\t\t\tdocumentMode: signOptions.documentMode,\n\t\t}, b2eFeatureConfig.hcmLinkAvailable);\n\t\tthis.#api = new Api();\n\t\tthis.#maxDocumentCount = signOptions.b2eDocumentLimitCount;\n\t\tthis.#userParty = new UserParty({ mode: 'edit', ...userPartyConfig });\n\t\tthis.subscribeOnEvents();\n\t\tthis.#regionDocumentTypes = blankSelectorConfig.regionDocumentTypes;\n\t}\n\n\t#prepareConfig(signOptions: SignOptions): SignOptionsConfig\n\t{\n\t\tconst { config, documentMode, b2eDocumentLimitCount } = signOptions;\n\n\t\tconst { blankSelectorConfig, documentSendConfig } = config;\n\t\tblankSelectorConfig.documentMode = documentMode;\n\t\tblankSelectorConfig.b2eDocumentLimitCount = b2eDocumentLimitCount;\n\t\tdocumentSendConfig.documentMode = documentMode;\n\n\t\treturn config;\n\t}\n\n\tsubscribeOnEvents(): void\n\t{\n\t\tsuper.subscribeOnEvents();\n\t\tthis.documentSend.subscribe('changeTitle', ({ data }) => {\n\t\t\tthis.documentSetup.setDocumentTitle(data.title);\n\t\t});\n\t\tthis.documentSend.subscribe('disableBack', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('back', true);\n\t\t});\n\t\tthis.documentSend.subscribe('enableBack', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('back', false);\n\t\t});\n\t\tthis.documentSetup.subscribe('addDocument', () => {\n\t\t\tthis.setDocumentsGroup();\n\t\t});\n\t\tthis.documentSetup.subscribe('deleteDocument', ({ data }) => {\n\t\t\tthis.#deleteDocument(data);\n\t\t});\n\t\tthis.documentSetup.subscribe('editDocument', ({ data }) => {\n\t\t\tthis.#editDocumentData(data.uid);\n\t\t});\n\t\tthis.documentSend.subscribe('enableComplete', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('complete', false);\n\t\t});\n\t\tthis.documentSend.subscribe('disableComplete', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('complete', true);\n\t\t});\n\t\tthis.documentSetup.subscribe('documentsLimitExceeded', () => {\n\t\t\tthis.documentSetup.setAvailabilityDocumentSection(false);\n\t\t});\n\t\tthis.documentSetup.subscribe('documentsLimitNotExceeded', () => {\n\t\t\tthis.documentSetup.setAvailabilityDocumentSection(true);\n\t\t});\n\t\tthis.documentSend.subscribe(\n\t\t\tthis.documentSend.events.onTemplateComplete,\n\t\t\t(event: BaseEvent<{ templateId: number }>) => {\n\t\t\t\tif (this.isTemplateMode() && !this.isEditMode())\n\t\t\t\t{\n\t\t\t\t\tconst templateId = event.getData().templateId;\n\t\t\t\t\tthis.getAnalytics().send({\n\t\t\t\t\t\tevent: 'turn_on_off_template',\n\t\t\t\t\t\ttype: 'auto',\n\t\t\t\t\t\tc_element: 'on',\n\t\t\t\t\t\tp5: `templateId_${templateId}`,\n\t\t\t\t\t});\n\t\t\t\t\tthis.getAnalytics().send({\n\t\t\t\t\t\tevent: 'click_save_template',\n\t\t\t\t\t\tc_element: 'create_button',\n\t\t\t\t\t\tp5: `templateId_${templateId}`,\n\t\t\t\t\t\tstatus: 'success',\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tasync #editDocumentData(uid: string): Promise<void>\n\t{\n\t\tif (this.editedDocument)\n\t\t{\n\t\t\tawait this.#saveUpdatedDocumentData(this.editedDocument.uid);\n\t\t}\n\n\t\tif (!this.documentSetup.editMode)\n\t\t{\n\t\t\tthis.#checkDocumentLimit();\n\t\t\tthis.#resetDocument();\n\n\t\t\treturn;\n\t\t}\n\t\tthis.editedDocument = this.documentsGroup.get(uid);\n\t\tthis.documentSetup.setAvailabilityDocumentSection(true);\n\n\t\tif (this.documentSetup.isRuRegion())\n\t\t{\n\t\t\tthis.documentSetup.setDocumentNumber(this.editedDocument.externalId);\n\t\t}\n\t\tthis.documentSetup.setDocumentTitle(this.editedDocument.title);\n\t\tthis.#scrollToDown();\n\t}\n\n\tasync setDocumentsGroup(): Promise<void>\n\t{\n\t\tif (this.documentSetup.blankIsNotSelected || !this.documentSetup.validate())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentSetup.switchAddDocumentButtonLoadingState(true);\n\t\ttry\n\t\t{\n\t\t\tconst documentData = await this.setupDocument();\n\t\t\tthis.documentsGroup.set(documentData.uid, documentData);\n\t\t\tthis.addInDocumentsGroupUids(documentData.uid);\n\n\t\t\tthis.documentSetup.blankSelector.disableSelectedBlank(documentData.blankId);\n\n\t\t\tawait this.#attachGroupToDocument(documentData);\n\t\t\tthis.documentSetup.switchAddDocumentButtonLoadingState(false);\n\n\t\t\tif (this.editedDocument)\n\t\t\t{\n\t\t\t\tawait this.#handleEditedDocument(documentData);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.documentSetup.renderDocumentBlock(documentData);\n\t\t\t}\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tthis.documentSetup.switchAddDocumentButtonLoadingState(false);\n\t\t}\n\n\t\tthis.#scrollToTop();\n\t\tthis.documentSetup.documentCounters.update(this.documentsGroup.size);\n\t\tthis.#resetDocument();\n\t\tthis.wizard.toggleBtnActiveState('next', false);\n\t}\n\n\taddInDocumentsGroupUids(uid: string): void\n\t{\n\t\tif (!this.documentsGroupUids.includes(uid))\n\t\t{\n\t\t\tthis.documentsGroupUids.push(uid);\n\t\t}\n\t}\n\n\tasync #handleEditedDocument(documentData): Promise<void>\n\t{\n\t\tif (this.documentSetup.blankIsNotSelected)\n\t\t{\n\t\t\tthis.documentSetup.resetEditMode();\n\t\t\tawait this.#saveUpdatedDocumentData(this.editedDocument.uid);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.deleteFromDocumentsGroupUids(documentData.uid);\n\t\tthis.replaceInDocumentsGroupUids(this.editedDocument.uid, documentData.uid);\n\t\tthis.documentSetup.replaceDocumentBlock(this.editedDocument, documentData);\n\t\tawait this.#deleteDocument(this.editedDocument);\n\t\tawait this.#attachGroupToDocument(documentData);\n\n\t\tthis.editor.setUrls([]);\n\t}\n\n\treplaceInDocumentsGroupUids(oldUid: string, newUid: string): void\n\t{\n\t\tconst index = this.documentsGroupUids.indexOf(oldUid);\n\t\tif (index !== -1)\n\t\t{\n\t\t\tthis.documentsGroupUids.splice(index, 1, newUid);\n\t\t}\n\t}\n\n\tdeleteFromDocumentsGroupUids(uid: string)\n\t{\n\t\tconst index = this.documentsGroupUids.indexOf(uid);\n\n\t\tif (index === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.documentsGroupUids.splice(index, 1);\n\t}\n\n\t#removeDocumentElement(documentId): void\n\t{\n\t\tconst deletedElement = this.documentSetup.layout.querySelector(`[data-id=\"document-id-${documentId}\"]`);\n\t\tdeletedElement?.remove();\n\t}\n\n\tasync #attachGroupToDocument(documentData): Promise<void>\n\t{\n\t\tif (!this.groupId)\n\t\t{\n\t\t\tconst { groupId } = await this.#api.createDocumentsGroup();\n\t\t\tthis.groupId = groupId;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst targetDocument = this.documentsGroup.get(documentData.uid);\n\n\t\t\tif (targetDocument && !targetDocument.groupId)\n\t\t\t{\n\t\t\t\tawait this.#api.attachGroupToDocument(documentData.uid, this.groupId);\n\t\t\t\ttargetDocument.groupId = this.groupId;\n\t\t\t}\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t}\n\t}\n\n\tasync #saveUpdatedDocumentData(uid: string): Promise<void>\n\t{\n\t\tconst updatedDocumentData = await this.documentSetup.updateDocumentData(this.editedDocument);\n\t\tthis.documentSetup.updateDocumentBlock(this.editedDocument.id);\n\n\t\tif (uid)\n\t\t{\n\t\t\tthis.documentsGroup.set(this.editedDocument.uid, updatedDocumentData);\n\t\t\tthis.addInDocumentsGroupUids(this.editedDocument.uid);\n\t\t\tthis.documentSend.setDocumentsBlock(this.documentsGroup);\n\t\t}\n\t}\n\n\tasync #deleteDocument(data: { blankId: number, deletedButton: HTMLElement, id: number, uid: string }): string\n\t{\n\t\tconst { id, uid, blankId, deleteButton } = data;\n\t\tthis.documentSetup.ready = false;\n\n\t\ttry\n\t\t{\n\t\t\tawait this.#api.removeDocument(uid);\n\t\t\tthis.documentSetup.ready = true;\n\n\t\t\tif (this.isFirstDocumentSelected(uid))\n\t\t\t{\n\t\t\t\tthis.resetPreview();\n\t\t\t\tthis.hasPreviewUrls = false;\n\t\t\t}\n\t\t\tthis.#removeDocumentElement(id);\n\t\t\tthis.documentSend.deleteDocument(uid);\n\t\t\tthis.documentsGroup.delete(uid);\n\t\t\tthis.deleteFromDocumentsGroupUids(uid);\n\t\t\tthis.documentSetup.blankSelector.enableSelectedBlank(blankId);\n\t\t\tthis.documentSetup.deleteDocumentFromList(blankId);\n\t\t\tthis.documentSetup.documentCounters.update(this.documentsGroup.size);\n\t\t\tthis.documentSetup.resetEditMode();\n\n\t\t\tif (this.documentsGroup.size === 0)\n\t\t\t{\n\t\t\t\tthis.wizard.toggleBtnActiveState('next', true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.documentSetup.setupData = this.getFirstDocumentDataFromGroup();\n\t\t\t}\n\t\t\tthis.#resetDocument();\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tthis.documentSetup.toggleDeleteBtnLoadingState(deleteButton);\n\t\t\tthis.documentSetup.ready = true;\n\t\t}\n\t}\n\n\tasync #setupParties(): Promise<Array<PartiesDetails>>\n\t{\n\t\tconst { representative } = this.#companyParty.getParties();\n\t\tconst { members, signerParty } = this.#makeSetupMembers();\n\n\t\tconst documentUids = [...this.documentsGroup.keys()];\n\t\tfor (const documentUid of documentUids)\n\t\t{\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.#api.setupB2eParties(documentUid, representative.entityId, members);\n\t\t}\n\t\tconst uid = this.#documentUid;\n\t\tconst membersData = await this.#api.loadMembers(uid);\n\t\tif (!Type.isArrayFilled(membersData))\n\t\t{\n\t\t\tthrow new Error('Members are empty');\n\t\t}\n\n\t\tconst syncMemberPromises = documentUids.map((uid) => this.#syncMembersWithDepartments(uid, signerParty));\n\t\tawait Promise.all(syncMemberPromises);\n\n\t\treturn membersData.map((memberData) => {\n\t\t\treturn {\n\t\t\t\tpresetId: memberData?.presetId,\n\t\t\t\tpart: memberData?.party,\n\t\t\t\tuid: memberData?.uid,\n\t\t\t\tentityTypeId: memberData?.entityTypeId ?? null,\n\t\t\t\tentityId: memberData?.entityId ?? null,\n\t\t\t\trole: memberData?.role ?? null,\n\t\t\t};\n\t\t});\n\t}\n\n\tasync #syncMembersWithDepartments(uid: string, signerParty: number): Promise<void>\n\t{\n\t\tlet syncFinished = false;\n\t\twhile (!syncFinished)\n\t\t{\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tconst response = await this.#api.syncB2eMembersWithDepartments(uid, signerParty);\n\t\t\tsyncFinished = response.syncFinished;\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.#sleep(1000);\n\t\t}\n\t}\n\n\t#sleep(ms: Number): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, ms);\n\t\t});\n\t}\n\n\tget #documentUid(): string\n\t{\n\t\treturn this.documentSetup.setupData.uid;\n\t}\n\n\tget #isDocumentInitiatedByEmployee(): DocumentInitiatedType\n\t{\n\t\treturn this.documentSetup.setupData.initiatedByType === DocumentInitiated.employee;\n\t}\n\n\t#getAssignee(currentParty: number, companyId: number): SetupMember\n\t{\n\t\treturn {\n\t\t\tentityType: 'company',\n\t\t\tentityId: companyId,\n\t\t\tparty: currentParty,\n\t\t\trole: MemberRole.assignee,\n\t\t};\n\t}\n\n\t#getSigner(currentParty: number, entity: CardItem): SetupMember\n\t{\n\t\treturn {\n\t\t\tentityType: entity.entityType,\n\t\t\tentityId: entity.entityId,\n\t\t\tparty: currentParty,\n\t\t\trole: MemberRole.signer,\n\t\t};\n\t}\n\n\t#makeSetupMembers(): SetupMembersResponse\n\t{\n\t\tconst { company, validation } = this.#companyParty.getParties();\n\n\t\tconst userPartyEntities = this.#userParty.getEntities();\n\n\t\tlet currentParty = this.#isDocumentInitiatedByEmployee ? 2 : 1;\n\n\t\tconst members = validation.map((item): SetupMember => {\n\t\t\tconst result = { ...item, party: currentParty };\n\t\t\tcurrentParty++;\n\n\t\t\treturn result;\n\t\t});\n\t\tmembers.push(this.#getAssignee(currentParty, company.entityId));\n\n\t\tlet signerParty = currentParty;\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tsignerParty = this.#isDocumentInitiatedByEmployee ? 1 : currentParty + 1;\n\t\t\tconst signers = userPartyEntities.map((entity) => this.#getSigner(signerParty, entity));\n\t\t\tmembers.push(...signers);\n\t\t}\n\n\t\treturn { members, signerParty };\n\t}\n\n\t#parseMembers(loadedMembers: SetupMember[]): { [$Keys<typeof MemberRole>]: number[]; }\n\t{\n\t\treturn loadedMembers.reduce((acc, member) => {\n\t\t\tconst { entityType, entityId } = member;\n\t\t\tif (entityType !== 'user')\n\t\t\t{\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst role = `${member.role}s`;\n\n\t\t\treturn {\n\t\t\t\t...acc,\n\t\t\t\t[role]: [\n\t\t\t\t\t...acc[role] ?? [],\n\t\t\t\t\tentityId,\n\t\t\t\t],\n\t\t\t};\n\t\t}, {});\n\t}\n\n\tasync applyDocumentData(uid: string): Promise<boolean>\n\t{\n\t\tconst setupData = await this.setupDocument(uid, true);\n\t\tif (!setupData)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (setupData.groupId)\n\t\t{\n\t\t\tconst documentsGroupData = await this.#api.getDocumentListInGroup(setupData.groupId);\n\t\t\tfor (const item of documentsGroupData)\n\t\t\t{\n\t\t\t\tthis.addInDocumentsGroupUids(item.uid);\n\n\t\t\t\tconst blocks = await this.#api.loadBlocksByDocument(item.uid);\n\t\t\t\tconst updatedItem = { ...item, blocks };\n\t\t\t\tthis.documentsGroup.set(item.uid, updatedItem);\n\t\t\t\tthis.documentSetup.renderDocumentBlock(updatedItem);\n\t\t\t\tthis.documentSetup.blankSelector.disableSelectedBlank(updatedItem.blankId);\n\t\t\t}\n\t\t\tthis.#resetDocument();\n\t\t\tthis.groupId = setupData.groupId;\n\t\t\tthis.documentSetup.documentCounters.update(this.documentsGroup.size);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.documentsGroup.set(setupData.uid, setupData);\n\t\t\tthis.addInDocumentsGroupUids(setupData.uid);\n\t\t}\n\n\t\tconst firstDocument = this.getFirstDocumentDataFromGroup();\n\t\tconst { entityId, representativeId, companyUid, hcmLinkCompanyId } = firstDocument;\n\t\tthis.documentSend.documentData = this.documentsGroup;\n\n\t\tthis.#checkDocumentLimit();\n\n\t\tif (this.isSingleDocument())\n\t\t{\n\t\t\tthis.editor.documentData = firstDocument;\n\t\t}\n\t\tthis.#companyParty.setEntityId(entityId);\n\t\tif (companyUid)\n\t\t{\n\t\t\tthis.#companyParty.setLastSavedIntegrationId(hcmLinkCompanyId);\n\t\t\tthis.#companyParty.loadCompany(companyUid);\n\t\t}\n\n\t\tif (representativeId)\n\t\t{\n\t\t\tthis.#companyParty.loadRepresentative(representativeId);\n\t\t}\n\n\t\tconst members = await this.#api.loadMembers(uid);\n\t\tconst parsedMembers = this.#parseMembers(members);\n\t\tconst { signers = [], reviewers = [], editors = [] } = parsedMembers;\n\t\tif (signers.length > 0)\n\t\t{\n\t\t\tthis.#userParty.load(signers);\n\t\t}\n\n\t\tif (reviewers.length > 0)\n\t\t{\n\t\t\tthis.#companyParty.loadValidator(reviewers[0], MemberRole.reviewer);\n\t\t}\n\n\t\tif (editors.length > 0)\n\t\t{\n\t\t\tthis.#companyParty.loadValidator(editors[0], MemberRole.editor);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tasync applyTemplateData(templateUid: string): Promise<boolean>\n\t{\n\t\tsuper.applyTemplateData(templateUid);\n\n\t\tthis.documentSetup.setupData.templateUid = templateUid;\n\t\tthis.documentSend.setExistingTemplate();\n\n\t\treturn true;\n\t}\n\n\t#getSetupStep(signSettings: B2ESignSettings, documentUid?: string): $Values<Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.documentSetup.layout;\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\tif (!Type.isNull(signSettings.getAfterPreviewLayout()))\n\t\t\t\t{\n\t\t\t\t\tBX.show(signSettings.getAfterPreviewLayout());\n\t\t\t\t}\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2B_LOAD_DOCUMENT'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\tconst blankIsSelected = this.documentSetup.blankSelector.selectedBlankId !== 0;\n\t\t\t\tif (blankIsSelected || this.documentSetup.isFileAdded)\n\t\t\t\t{\n\t\t\t\t\tconst isValid = this.documentSetup.validate();\n\t\t\t\t\tif (!isValid)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst setupData = await this.setupDocument();\n\t\t\t\tif (!setupData)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tawait this.#addDocumentInGroup(setupData);\n\t\t\t\tif (this.editedDocument)\n\t\t\t\t{\n\t\t\t\t\tawait this.#handleEditedDocument(setupData);\n\t\t\t\t}\n\n\t\t\t\tthis.#resetDocument();\n\t\t\t\tthis.#processSetupData();\n\t\t\t\tthis.#checkDocumentLimit();\n\n\t\t\t\tif (!Type.isNull(this.getAfterPreviewLayout()))\n\t\t\t\t{\n\t\t\t\t\tBX.hide(this.getAfterPreviewLayout());\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\t#getCompanyStep(signSettings: B2ESignSettings): $Values<Metadata>\n\t{\n\t\tconst titleLocCode = this.isTemplateMode()\n\t\t\t? 'SIGN_SETTINGS_B2E_ROUTES'\n\t\t\t: 'SIGN_SETTINGS_B2E_COMPANY'\n\t\t;\n\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.#companyParty.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage(titleLocCode),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\tconst { uid } = this.documentSetup.setupData;\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tfor (const [uid] of this.documentsGroup)\n\t\t\t\t\t{\n\t\t\t\t\t\tawait this.#companyParty.save(uid);\n\t\t\t\t\t}\n\t\t\t\t\tthis.documentSetup.setupData.integrationId = this.#companyParty.getSelectedIntegrationId();\n\t\t\t\t\tthis.documentSend.hcmLinkEnabled = this.documentSetup.setupData.integrationId > 0;\n\n\t\t\t\t\tthis.#setSecondPartySectionVisibility();\n\n\t\t\t\t\tif (this.isTemplateMode())\n\t\t\t\t\t{\n\t\t\t\t\t\tconst entityData = await this.#setupParties();\n\t\t\t\t\t\tthis.editor.entityData = entityData;\n\t\t\t\t\t\tconst { isTemplate, entityId } = this.documentSetup.setupData;\n\t\t\t\t\t\tconst blocks = await this.documentSetup.loadBlocks(uid);\n\n\t\t\t\t\t\tthis.#executeDocumentSendActions();\n\n\t\t\t\t\t\tconst editorData = { isTemplate, uid, blocks, entityId };\n\t\t\t\t\t\tthis.#executeEditorActions(editorData);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\t#getEmployeeStep(signSettings: B2ESignSettings): $Values<Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.#userParty.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2E_EMPLOYEES'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tconst isValid = this.#userParty.validate();\n\t\t\t\t\tif (!isValid)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn isValid;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.editor.entityData = await this.#setupParties();\n\n\t\t\t\t\tconst { uid, isTemplate, entityId } = this.documentSetup.setupData;\n\t\t\t\t\tconst blocks = await this.documentSetup.loadBlocks(uid);\n\n\t\t\t\t\tthis.#executeDocumentSendActions();\n\n\t\t\t\t\tconst editorData = { isTemplate, uid, blocks, entityId };\n\t\t\t\t\tawait this.#executeEditorActions(editorData);\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(e);\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tasync #executeDocumentSendActions(): Promise<void>\n\t{\n\t\tconst partiesData = this.#companyParty.getParties();\n\t\tObject.assign(partiesData, {\n\t\t\temployees: this.#userParty.getEntities().map((entity) => {\n\t\t\t\treturn {\n\t\t\t\t\tentityType: entity.entityType,\n\t\t\t\t\tentityId: entity.entityId,\n\t\t\t\t};\n\t\t\t}),\n\t\t});\n\t\tthis.documentSend.documentData = this.documentsGroup;\n\t\tthis.documentSend.resetUserPartyPopup();\n\t\tthis.documentSend.setPartiesData(partiesData);\n\t}\n\n\tasync #executeEditorActions(editorData: {\n\t\tisTemplate: boolean,\n\t\tuid: string,\n\t\tblocks: Array,\n\t\tentityId: number\n\t}): Promise<void>\n\t{\n\t\tthis.wizard.toggleBtnLoadingState('next', false);\n\n\t\tif (this.isSingleDocument())\n\t\t{\n\t\t\tthis.editor.documentData = editorData;\n\t\t\tawait this.editor.waitForPagesUrls();\n\t\t\tawait this.editor.renderDocument();\n\t\t\tawait this.editor.show();\n\t\t}\n\t}\n\n\t#getSendStep(signSettings: B2ESignSettings): $Values<Metadata>\n\t{\n\t\tconst titleLocCode = this.isTemplateMode()\n\t\t\t? 'SIGN_SETTINGS_SEND_DOCUMENT_CREATE'\n\t\t\t: 'SIGN_SETTINGS_SEND_DOCUMENT'\n\t\t;\n\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.documentSend.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage(titleLocCode),\n\t\t\tbeforeCompletion: () => this.documentSend.sendForSign(),\n\t\t};\n\t}\n\n\tgetStepsMetadata(signSettings: this, documentUid: ?string, templateUid?: string): Metadata\n\t{\n\t\tthis.#sendAnalyticsOnStart(documentUid);\n\t\tconst steps = {\n\t\t\tsetup: this.#getSetupStep(signSettings, documentUid),\n\t\t\tcompany: this.#getCompanyStep(signSettings),\n\t\t};\n\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tsteps.employees = this.#getEmployeeStep(signSettings);\n\t\t}\n\n\t\tsteps.send = this.#getSendStep(signSettings);\n\n\t\tthis.#decorateStepsBeforeCompletionWithAnalytics(steps, documentUid);\n\n\t\treturn steps;\n\t}\n\n\tasync init(uid: ?string, templateUid: string)\n\t{\n\t\tawait super.init(uid, templateUid);\n\t\tif (this.isEditMode())\n\t\t{\n\t\t\tif (!Type.isNull(this.getAfterPreviewLayout()))\n\t\t\t{\n\t\t\t\tBX.hide(this.getAfterPreviewLayout());\n\t\t\t}\n\t\t}\n\t}\n\n\tonComplete(): void\n\t{\n\t\tif (this.isTemplateMode())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tsuper.onComplete();\n\t}\n\n\tisTemplateCreateMode(): boolean\n\t{\n\t\treturn isTemplateMode(this.documentMode) && !this.isEditMode();\n\t}\n\n\t#setSecondPartySectionVisibility(): void\n\t{\n\t\tconst selectedProvider = this.#companyParty.getSelectedProvider();\n\n\t\tconst isNotSesRuProvider = selectedProvider.code !== ProviderCode.sesRu;\n\t\tconst isInitiatedByEmployee = this.documentSetup.setupData.initiatedByType === DocumentInitiated.employee;\n\t\tconst isInitiatedByCompany = this.documentSetup.setupData.initiatedByType === DocumentInitiated.company;\n\n\t\tconst isSecondPartySectionVisible = isNotSesRuProvider\n\t\t\t|| (isTemplateMode(this.documentMode) && isInitiatedByEmployee)\n\t\t;\n\n\t\tconst isHcmLinkIntegrationSectionVisible = this.documentSetup.setupData.integrationId > 0;\n\n\t\tthis.editor.setSectionVisibilityByType(\n\t\t\tSectionType.HcmLinkIntegration,\n\t\t\tisHcmLinkIntegrationSectionVisible,\n\t\t);\n\n\t\tthis.editor.setSectionVisibilityByType(\n\t\t\tSectionType.SecondParty,\n\t\t\tisSecondPartySectionVisible,\n\t\t);\n\t}\n\n\t#decorateStepsBeforeCompletionWithAnalytics(steps: Metadata, documentUid?: string): void\n\t{\n\t\tconst analytics = this.getAnalytics();\n\n\t\tif (Type.isPlainObject(steps.setup))\n\t\t{\n\t\t\tsteps.setup.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.setup.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnSetupStep(analytics, documentUid),\n\t\t\t\t() => this.#sendAnalyticsOnSetupError(analytics),\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isPlainObject(steps.company))\n\t\t{\n\t\t\tsteps.company.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.company.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnCompanyStepSuccess(analytics),\n\t\t\t\t() => this.#sendAnalyticsOnCompanyStepError(analytics),\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isPlainObject(steps.send))\n\t\t{\n\t\t\tsteps.send.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.send.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnSendStepSuccess(analytics, this.documentSetup.setupData.uid),\n\t\t\t\t() => this.#sendAnalyticsOnSendStepError(analytics, this.documentSetup.setupData.uid),\n\t\t\t);\n\t\t}\n\t}\n\n\t#sendAnalyticsOnSetupStep(analytics: Analytics, documentUid?: string): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_document', c_element: 'create_button', status: 'success' });\n\t\t\tanalytics.send({\n\t\t\t\tevent: 'turn_on_off_template',\n\t\t\t\ttype: 'auto',\n\t\t\t\tc_element: 'off',\n\t\t\t\tp5: `templateId_${this.documentSetup.setupData.templateId}`,\n\t\t\t});\n\t\t}\n\t}\n\n\t#sendAnalyticsOnSetupError(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_document', status: 'error', c_element: 'create_button' });\n\t\t}\n\t}\n\n\t#sendAnalyticsOnCompanyStepSuccess(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_route', status: 'success', c_element: 'create_button' });\n\t\t}\n\t}\n\n\t#sendAnalyticsOnCompanyStepError(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_route', status: 'error', c_element: 'create_button' });\n\t\t}\n\t}\n\n\tasync #sendAnalyticsOnSendStepSuccess(analytics: Analytics, documentUid: string): void\n\t{\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tanalytics.sendWithProviderTypeAndDocId({\n\t\t\t\tevent: 'sent_document_to_sign',\n\t\t\t\tc_element: 'create_button',\n\t\t\t\tstatus: 'success',\n\t\t\t}, documentUid);\n\t\t}\n\t}\n\n\tasync #sendAnalyticsOnSendStepError(analytics: Analytics, documentUid: string): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tthis.getAnalytics().send({\n\t\t\t\tevent: 'click_save_template',\n\t\t\t\tstatus: 'error',\n\t\t\t\tc_element: 'create_button',\n\t\t\t});\n\t\t}\n\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tanalytics.sendWithProviderTypeAndDocId({\n\t\t\t\tevent: 'sent_document_to_sign',\n\t\t\t\tc_element: 'create_button',\n\t\t\t\tstatus: 'error',\n\t\t\t}, documentUid);\n\t\t}\n\t}\n\n\t#sendAnalyticsOnStart(documentUid?: string): void\n\t{\n\t\tconst analytics = this.getAnalytics();\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'open_wizard', c_element: 'create_button' });\n\t\t}\n\t\telse if (this.isDocumentMode())\n\t\t{\n\t\t\tconst context = { event: 'click_create_document', c_element: 'create_button' };\n\t\t\tif (this.isEditMode() && Type.isStringFilled(documentUid))\n\t\t\t{\n\t\t\t\tanalytics.sendWithDocId(context, documentUid);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tanalytics.send(context);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync #processSetupData(): Promise<void>\n\t{\n\t\tconst firstDocumentData = this.getFirstDocumentDataFromGroup();\n\t\tthis.#companyParty.setInitiatedByType(firstDocumentData.initiatedByType);\n\t\tthis.#companyParty.setEntityId(firstDocumentData.entityId);\n\t\tthis.editedDocument = null;\n\n\t\tif (this.hasPreviewUrls)\n\t\t{\n\t\t\tthis.wizard.toggleBtnActiveState('next', false);\n\t\t}\n\t}\n\n\tasync #addDocumentInGroup(setupData: DocumentDetails): Promise<void>\n\t{\n\t\tif (this.documentSetup.blankIsNotSelected)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isTemplateMode() || !FeatureStorage.isGroupSendingEnabled())\n\t\t{\n\t\t\tthis.setSingleDocument(setupData);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentsGroup.set(setupData.uid, setupData);\n\t\tthis.addInDocumentsGroupUids(setupData.uid);\n\t\tthis.documentSetup.blankSelector.disableSelectedBlank(setupData.blankId);\n\n\t\tif (!setupData.groupId && !this.editedDocument)\n\t\t{\n\t\t\tawait this.#attachGroupToDocument(setupData);\n\t\t}\n\n\t\tif (!this.isTemplateMode())\n\t\t{\n\t\t\tthis.documentSetup.documentCounters.update(this.documentsGroup.size);\n\t\t}\n\n\t\tif (!this.editedDocument)\n\t\t{\n\t\t\tthis.documentSetup.renderDocumentBlock(setupData);\n\t\t}\n\t}\n\n\t#scrollToTop(): void\n\t{\n\t\twindow.scrollTo({\n\t\t\ttop: 0,\n\t\t\tbehavior: 'smooth',\n\t\t});\n\t}\n\n\t#scrollToDown(): void\n\t{\n\t\twindow.scrollTo({\n\t\t\ttop: document.body.scrollHeight,\n\t\t\tbehavior: 'smooth',\n\t\t});\n\t}\n\n\t#resetDocument(): void\n\t{\n\t\tif (this.isTemplateMode() || !FeatureStorage.isGroupSendingEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentSetup.resetDocument();\n\n\t\tthis.editedDocument = null;\n\t}\n\n\t#checkDocumentLimit(): void\n\t{\n\t\tif (this.documentsGroup.size === this.#maxDocumentCount)\n\t\t{\n\t\t\tthis.documentSetup.setAvailabilityDocumentSection(false);\n\t\t}\n\t}\n\n\tgetAfterPreviewLayout(): HTMLElement | null\n\t{\n\t\tif (!this.isDocumentMode() || !FeatureStorage.isMultiDocumentLoadingEnabled())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.#cache.remember('beforePreviewLayout', () => Tag.render`\n\t\t\t<button class=\"ui-btn ui-btn-light-border ui-btn-md\" style=\"margin-top: 20px;\" onclick=\"${() => this.#onBeforePreviewBtnClick()}\">\n\t\t\t\t${Loc.getMessage('SIGN_SETTINGS_B2E_BEFORE_PREVIEW')}\n\t\t\t</button>\n\t\t`);\n\t}\n\n\t#onBeforePreviewBtnClick(): void\n\t{\n\t\t// eslint-disable-next-line unicorn/no-this-assignment\n\t\tconst self = this;\n\t\tBX.SidePanel.Instance.open('sign-settings:afterPreviewSidePanel', {\n\t\t\tcacheable: false,\n\t\t\twidth: 750,\n\t\t\tcontentCallback: () => {\n\t\t\t\tself.#resetAfterPreviewSidePanel();\n\n\t\t\t\treturn Layout.createContent({\n\t\t\t\t\textensions: ['ui.forms'],\n\t\t\t\t\ttitle: 'Добавить папку с файлами',\n\t\t\t\t\tcontent(): void\n\t\t\t\t\t{\n\t\t\t\t\t\tself.#getUploader();\n\n\t\t\t\t\t\treturn self.#getMultiDocumentAddSidePanelContent();\n\t\t\t\t\t},\n\t\t\t\t\tbuttons({ cancelButton, SaveButton })\n\t\t\t\t\t{\n\t\t\t\t\t\tself.#saveButton = new SaveButton({\n\t\t\t\t\t\t\tonclick: () => self.#onBeforePreviewSaveBtnClick(),\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tself.#saveButton,\n\t\t\t\t\t\t];\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonClose: (event) => {\n\t\t\t\t\tif (this.#isMultiDocumentSaveProcessGone)\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.denyAction();\n\t\t\t\t\t}\n\t\t\t\t\tthis.#resetAfterPreviewSidePanel();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#getMultiDocumentAddSidePanelContent(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('multiDocumentAddSidePanelContent', () => Tag.render`\n\t\t\t<div id=\"multiple-document-add-container\" style=\"display: flex; flex-direction: column;\">\n\t\t\t\t<div style=\"flex-direction: row;\">\n\t\t\t\t\t${this.#getUploadFileFromDirButton().root}\n\t\t\t\t\t${this.#getUploadFileButton()}\n\t\t\t\t</div>\n\t\t\t\t${this.#getDocumentNumber().root}\n\t\t\t\t${this.#getDocumentTypeSelectorLayout().root}\n\t\t\t</div>\n\t\t`);\n\t}\n\n\t#getDocumentNumber(): { root: HTMLElement, numberInput: HTMLInputElement }\n\t{\n\t\treturn this.#cache.remember('documentNumber', () => Tag.render`\n\t\t\t<div>\n\t\t\t\t<h3>${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_DOCUMENT_NUMBER_TITLE')}</h3>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-w100\" style=\"margin-top: 25px;\">\n\t\t\t\t\t<input type=\"text\" class=\"ui-ctl-element\" ref=\"numberInput\" maxlength=\"255\"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\t#getUploader(): Uploader\n\t{\n\t\treturn this.#cache.remember('uploader', () => {\n\t\t\treturn new Uploader({\n\t\t\t\tid: 'sign-settings-uploader',\n\t\t\t\tcontroller: 'sign.upload.blankUploadController',\n\t\t\t\tacceptedFileTypes: [...acceptedUploaderFileTypes.values()].map((a) => `.${a}`),\n\t\t\t\tmultiple: true,\n\t\t\t\tautoUpload: false,\n\t\t\t\tmaxFileSize: 52_428_800,\n\t\t\t\timageMaxFileSize: 10_485_760,\n\t\t\t\tmaxTotalFileSize: 52_428_800,\n\t\t\t\tevents: {\n\t\t\t\t\t[UploaderEvent.BEFORE_FILES_ADD]: (event) => this.#onBeforeFilesAdd(event),\n\t\t\t\t\t[UploaderEvent.FILE_ADD]: (event) => this.#onFileAdd(event.getData().file),\n\t\t\t\t\t[UploaderEvent.UPLOAD_COMPLETE]: (event) => this.#onUploadComplete(event),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#resetAfterPreviewSidePanel(): void\n\t{\n\t\tthis.#cache.delete('uploader');\n\t\tthis.#cache.delete('uploadButton');\n\t\tthis.#cache.delete('uploadFromDirButton');\n\t\tthis.#cache.delete('documentNumber');\n\t\tthis.#cache.delete('numberSelectorLayout');\n\t\tthis.#cache.delete('multiDocumentAddSidePanelContent');\n\t}\n\n\t#getUploadFileButton(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('uploadButton', () => {\n\t\t\tconst layout = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<button class=\"ui-btn ui-btn-light-border\" style=\"margin-top: 15px;\" onclick=\"${() => layout.fileInput.click()}\">${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_ADD_FILE')}</button>\n\t\t\t\t\t<input ref=\"fileInput\" hidden type=\"file\" multiple ref=\"fileInput\" onchange=\"${(event) => {\n\t\t\t\t\t\t\tthis.#onInputFileChange(event);\n\t\t\t\t\t\t\tevent.target.value = '';\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t\taccept=\"${[...acceptedUploaderFileTypes.values()].map((n) => `.${n}`).join(', ')}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\treturn layout.root;\n\t\t});\n\t}\n\n\t#getUploadFileFromDirButton(): { root: HTMLElement, fileInput: HTMLInputElement }\n\t{\n\t\treturn this.#cache.remember('uploadFromDirButton', () => {\n\t\t\tconst layout = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<button class=\"ui-btn ui-btn-primary\" style=\"margin-top: 15px;\" onclick=\"${() => layout.fileInput.click()}\">${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_LOAD_FROM_DIRS')}</button>\n\t\t\t\t\t<input hidden type=\"file\" webkitdirectory multiple ref=\"fileInput\" onchange=\"${(event) => {\n\t\t\t\t\t\tthis.#onInputFileChange(event);\n\t\t\t\t\t\tevent.target.value = '';\n\t\t\t\t\t}}\">\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\treturn layout;\n\t\t});\n\t}\n\n\t#onInputFileChange(event: Event): void\n\t{\n\t\tconst target: HTMLInputElement = event.target;\n\t\tconst files = target.files;\n\t\tconst validatedFiles = [...files].filter((f: File) => acceptedUploaderFileTypes.has(\n\t\t\tf.name.split('.').at(-1),\n\t\t));\n\t\tthis.#getUploader().addFiles(validatedFiles);\n\t}\n\n\t#onFileAdd(file: UploaderFile): void\n\t{\n\t\tDom.insertAfter(\n\t\t\tTag.render`<p style=\"color: #666\">${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_LOADED_FILE_NAME', { '#FILENAME#': Text.encode(file.getName()) })}</p>`,\n\t\t\tthis.#getUploadFileButton(),\n\t\t);\n\t}\n\n\t#onBeforePreviewSaveBtnClick(): void\n\t{\n\t\tif (this.#getUploader().getFiles().length === 0)\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_NO_FILES_SELECTED'));\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#getDocumentTypeSelectorLayout().selector.value?.trim())\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_NO_DOCUMENT_TYPE_SELECTED'));\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#getDocumentNumber().numberInput.value?.trim())\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_NO_DOCUMENT_NUMBER'));\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(this.#getMultiDocumentAddSidePanelContent(), { opacity: 0.6, 'pointer-events': 'none' });\n\t\tthis.#isMultiDocumentSaveProcessGone = true;\n\t\tthis.#getUploader().start();\n\t\tthis.#saveButton.setClocking(true);\n\t}\n\n\tasync #onUploadComplete(event: BaseEvent): void\n\t{\n\t\tconst uploader = this.#getUploader();\n\t\tfor (const file of uploader.getFiles())\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst blankId = await this.documentSetup.blankSelector.createBlankFromOuterUploaderFiles([file]);\n\t\t\t\tthis.documentSetup.blankSelector.selectBlank(blankId);\n\t\t\t\tthis.documentSetup.setDocumentType(this.#getDocumentTypeSelectorLayout().selector.value);\n\t\t\t\tthis.documentSetup.setDocumentNumber(this.#getDocumentNumber().numberInput.value);\n\t\t\t\tawait this.setDocumentsGroup();\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tconsole.error(`Error while add file with name ${file.getName()}`, e);\n\t\t\t}\n\t\t}\n\n\t\tDom.style(this.#getMultiDocumentAddSidePanelContent(), { opacity: 1, 'pointer-events': 'auto' });\n\t\tthis.#isMultiDocumentSaveProcessGone = false;\n\t\tthis.#saveButton.setClocking(false);\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\t#getDocumentTypeSelectorLayout(): { root: HTMLElement, selector: HTMLSelectElement }\n\t{\n\t\treturn this.#cache.remember('numberSelectorLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div style=\"margin-top: 15px;\">\n\t\t\t\t\t<h3>${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_DOCUMENT_TYPE_SELECTOR_TITLE')}</h3>\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t<select class=\"ui-ctl-element\" ref=\"selector\">\n\t\t\t\t\t\t\t${this.#regionDocumentTypes.map(({ code, description }) => Tag.render`\n\t\t\t\t\t\t\t\t<option value=\"${Text.encode(code)}\">${code}: ${Text.encode(description)}</option>\n\t\t\t\t\t\t\t`)}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#onBeforeFilesAdd(event: BaseEvent<{ files: Array<UploaderFile> }>): void\n\t{\n\t\tconst uploaderConfig = {\n\t\t\tmaxFileSize: 52_428_800,\n\t\t\timageMaxFileSize: 10_485_760,\n\t\t\tmaxTotalFileSize: 52_428_800,\n\t\t};\n\t\tconst data = event.getData();\n\t\tconst files: UploaderFile[] = data.files;\n\t\tconst uploader = this.#getUploader();\n\t\tconst allFilesWithNew: UploaderFile[] = [...files, ...uploader.getFiles()];\n\n\t\tif ((allFilesWithNew.length + this.documentsGroup.size) > this.#maxDocumentCount)\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_MAX_DOCUMENTS_COUNT_EXCEEDED'));\n\t\t\tevent.preventDefault();\n\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const file of files)\n\t\t{\n\t\t\tif (file.getSize() > uploaderConfig.maxFileSize)\n\t\t\t{\n\t\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_INVALID_FILE_SIZE'));\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (file.isImage() && file.getSize() > uploaderConfig.imageMaxFileSize)\n\t\t\t{\n\t\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_INVALID_IMAGE_FILE_SIZE'));\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst totalFileSize = allFilesWithNew.reduce((acc, file) => acc + file.getSize(), 0);\n\t\tif (totalFileSize > uploaderConfig.maxTotalFileSize)\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_MAX_TOTAL_FILE_SIZE_EXCEEDED'));\n\t\t\tevent.preventDefault();\n\n\t\t\treturn;\n\t\t}\n\t}\n}\n"],"names":["acceptedUploaderFileTypes","Set","B2ESignSettings","SignSettings","constructor","containerId","signOptions","next","className","complete","swapButtons","MemoryCache","b2eFeatureConfig","blankSelectorConfig","documentSendConfig","userPartyConfig","hideValidationParty","isTemplateMode","documentMode","documentSetup","DocumentSetup","documentSend","DocumentSend","CompanyParty","documentInitiatedType","initiatedByType","hcmLinkAvailable","Api","b2eDocumentLimitCount","UserParty","mode","subscribeOnEvents","regionDocumentTypes","subscribe","data","setDocumentTitle","title","wizard","toggleBtnActiveState","setDocumentsGroup","uid","setAvailabilityDocumentSection","events","onTemplateComplete","event","isEditMode","templateId","getData","getAnalytics","send","type","c_element","p5","status","blankIsNotSelected","validate","switchAddDocumentButtonLoadingState","documentData","setupDocument","documentsGroup","set","addInDocumentsGroupUids","blankSelector","disableSelectedBlank","blankId","editedDocument","renderDocumentBlock","documentCounters","update","size","documentsGroupUids","includes","push","replaceInDocumentsGroupUids","oldUid","newUid","index","indexOf","splice","deleteFromDocumentsGroupUids","applyDocumentData","setupData","groupId","documentsGroupData","getDocumentListInGroup","item","blocks","loadBlocksByDocument","updatedItem","firstDocument","getFirstDocumentDataFromGroup","entityId","representativeId","companyUid","hcmLinkCompanyId","isSingleDocument","editor","setEntityId","setLastSavedIntegrationId","loadCompany","loadRepresentative","members","loadMembers","parsedMembers","signers","reviewers","editors","length","load","loadValidator","MemberRole","reviewer","applyTemplateData","templateUid","setExistingTemplate","getStepsMetadata","signSettings","documentUid","steps","setup","company","isDocumentMode","employees","init","Type","isNull","getAfterPreviewLayout","BX","hide","onComplete","isTemplateCreateMode","FeatureStorage","isMultiDocumentLoadingEnabled","remember","Tag","render","Loc","getMessage","config","editMode","get","isRuRegion","setDocumentNumber","externalId","resetEditMode","replaceDocumentBlock","setUrls","documentId","deletedElement","layout","querySelector","remove","createDocumentsGroup","targetDocument","attachGroupToDocument","error","console","updatedDocumentData","updateDocumentData","updateDocumentBlock","id","setDocumentsBlock","deleteButton","ready","removeDocument","isFirstDocumentSelected","resetPreview","hasPreviewUrls","deleteDocument","delete","enableSelectedBlank","deleteDocumentFromList","toggleDeleteBtnLoadingState","representative","getParties","signerParty","documentUids","keys","setupB2eParties","membersData","isArrayFilled","Error","syncMemberPromises","map","Promise","all","memberData","presetId","part","party","entityTypeId","role","syncFinished","response","syncB2eMembersWithDepartments","ms","resolve","setTimeout","DocumentInitiated","employee","currentParty","companyId","entityType","assignee","entity","signer","validation","userPartyEntities","getEntities","result","loadedMembers","reduce","acc","member","content","SignSettingsItemCounter","numerate","show","beforeCompletion","blankIsSelected","selectedBlankId","isFileAdded","isValid","titleLocCode","getLayout","save","integrationId","getSelectedIntegrationId","hcmLinkEnabled","entityData","isTemplate","loadBlocks","editorData","e","partiesData","Object","assign","resetUserPartyPopup","setPartiesData","toggleBtnLoadingState","waitForPagesUrls","renderDocument","sendForSign","selectedProvider","getSelectedProvider","isNotSesRuProvider","code","ProviderCode","sesRu","isInitiatedByEmployee","isInitiatedByCompany","isSecondPartySectionVisible","isHcmLinkIntegrationSectionVisible","setSectionVisibilityByType","SectionType","HcmLinkIntegration","SecondParty","analytics","isPlainObject","decorateResultBeforeCompletion","sendWithProviderTypeAndDocId","context","isStringFilled","sendWithDocId","firstDocumentData","setInitiatedByType","isGroupSendingEnabled","setSingleDocument","window","scrollTo","top","behavior","document","body","scrollHeight","resetDocument","self","SidePanel","Instance","open","cacheable","width","contentCallback","Layout","createContent","extensions","buttons","cancelButton","SaveButton","onclick","onClose","denyAction","root","Uploader","controller","acceptedFileTypes","values","a","multiple","autoUpload","maxFileSize","imageMaxFileSize","maxTotalFileSize","UploaderEvent","BEFORE_FILES_ADD","FILE_ADD","file","UPLOAD_COMPLETE","fileInput","click","target","value","n","join","files","validatedFiles","filter","f","has","name","split","at","addFiles","Dom","insertAfter","Text","encode","getName","getFiles","alert","selector","trim","numberInput","style","opacity","start","setClocking","uploader","createBlankFromOuterUploaderFiles","selectBlank","setDocumentType","close","description","uploaderConfig","allFilesWithNew","preventDefault","getSize","isImage","totalFileSize"],"mappings":"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"}