{"version":3,"file":"sign-settings.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Loc, Tag, Type } from 'main.core';\nimport { FeatureStorage } from 'sign.feature-storage';\nimport './style.css';\nimport { Api, MemberRole, type SetupMember } from 'sign.v2.api';\nimport { ProviderCode } from 'sign.v2.b2e.company-selector';\nimport { DocumentSend } from 'sign.v2.b2e.document-send';\nimport { DocumentSetup } from 'sign.v2.b2e.document-setup';\nimport { Parties as CompanyParty } from 'sign.v2.b2e.parties';\nimport { UserParty } from 'sign.v2.b2e.user-party';\nimport { DocumentInitiated, DocumentInitiatedType } from 'sign.v2.document-setup';\nimport { SectionType } from 'sign.v2.editor';\nimport { SignSettingsItemCounter } from 'sign.v2.helper';\nimport { isTemplateMode, type SignOptions, type SignOptionsConfig, SignSettings } from 'sign.v2.sign-settings';\nimport type { Metadata } from 'ui.wizard';\n\nexport class B2ESignSettings extends SignSettings\n{\n\t#companyParty: CompanyParty;\n\t#userParty: UserParty;\n\t#api: Api;\n\tdocumentSetup: DocumentSend;\n\n\tconstructor(containerId: string, signOptions: SignOptions)\n\t{\n\t\tsuper(containerId, signOptions, {\n\t\t\tnext: { className: 'ui-btn-success' },\n\t\t\tcomplete: { className: 'ui-btn-success' },\n\t\t\tswapButtons: true,\n\t\t});\n\t\tconst { blankSelectorConfig, documentSendConfig, userPartyConfig } = this.#prepareConfig(signOptions);\n\t\tblankSelectorConfig.hideValidationParty = isTemplateMode(this.documentMode);\n\n\t\tthis.documentSetup = new DocumentSetup(blankSelectorConfig);\n\t\tthis.documentSend = new DocumentSend(documentSendConfig);\n\t\tthis.#companyParty = new CompanyParty(blankSelectorConfig);\n\t\tthis.#api = new Api();\n\t\tthis.#userParty = new UserParty({ mode: 'edit', ...userPartyConfig });\n\t\tthis.subscribeOnEvents();\n\t}\n\n\t#prepareConfig(signOptions: SignOptions): SignOptionsConfig\n\t{\n\t\tconst { config, documentMode } = signOptions;\n\n\t\tconst { blankSelectorConfig, documentSendConfig } = config;\n\t\tblankSelectorConfig.documentMode = documentMode;\n\t\tdocumentSendConfig.documentMode = documentMode;\n\n\t\treturn config;\n\t}\n\n\tsubscribeOnEvents(): void\n\t{\n\t\tsuper.subscribeOnEvents();\n\t\tthis.documentSend.subscribe('changeTitle', ({ data }) => {\n\t\t\tthis.documentSetup.setDocumentTitle(data.title);\n\t\t});\n\t\tthis.documentSend.subscribe('disableBack', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('back', true);\n\t\t});\n\t\tthis.documentSend.subscribe('enableBack', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('back', false);\n\t\t});\n\t}\n\n\tasync #setupParties(): Array\n\t{\n\t\tconst uid = this.#documentUid;\n\t\tconst { representative } = this.#companyParty.getParties();\n\t\tconst members = this.#makeSetupMembers();\n\n\t\tawait this.#api.setupB2eParties(uid, representative.entityId, members);\n\t\tconst membersData = await this.#api.loadMembers(uid);\n\t\tif (!Type.isArrayFilled(membersData))\n\t\t{\n\t\t\tthrow new Error('Members are empty');\n\t\t}\n\n\t\treturn membersData.map((memberData) => {\n\t\t\treturn {\n\t\t\t\tpresetId: memberData?.presetId,\n\t\t\t\tpart: memberData?.party,\n\t\t\t\tuid: memberData?.uid,\n\t\t\t\tentityTypeId: memberData?.entityTypeId ?? null,\n\t\t\t\tentityId: memberData?.entityId ?? null,\n\t\t\t\trole: memberData?.role ?? null,\n\t\t\t};\n\t\t});\n\t}\n\n\tget #documentUid(): string\n\t{\n\t\treturn this.documentSetup.setupData.uid;\n\t}\n\n\tget #isDocumentInitiatedByEmployee(): DocumentInitiatedType\n\t{\n\t\treturn this.documentSetup.setupData.initiatedByType === DocumentInitiated.employee;\n\t}\n\n\t#getAssignee(currentParty: number, companyId: number): SetupMember\n\t{\n\t\treturn {\n\t\t\tentityType: 'company',\n\t\t\tentityId: companyId,\n\t\t\tparty: currentParty,\n\t\t\trole: MemberRole.assignee,\n\t\t};\n\t}\n\n\t#getSigner(currentParty: number, userId: number): SetupMember\n\t{\n\t\treturn {\n\t\t\tentityType: 'user',\n\t\t\tentityId: userId,\n\t\t\tparty: currentParty,\n\t\t\trole: MemberRole.signer,\n\t\t};\n\t}\n\n\t#makeSetupMembers(): Array<SetupMember>\n\t{\n\t\tconst { company, validation } = this.#companyParty.getParties();\n\n\t\tconst userPartyIds = this.#userParty.getUserIds();\n\t\tlet members = [];\n\n\t\tlet currentParty = this.#isDocumentInitiatedByEmployee ? 2 : 1;\n\n\t\tmembers = validation.map((item): SetupMember => {\n\t\t\tconst result = { ...item, party: currentParty };\n\t\t\tcurrentParty++;\n\n\t\t\treturn result;\n\t\t});\n\t\tmembers.push(this.#getAssignee(currentParty, company.entityId));\n\n\t\tif (!this.isTemplateMode())\n\t\t{\n\t\t\tconst signerParty = this.#isDocumentInitiatedByEmployee ? 1 : currentParty + 1;\n\t\t\tconst signers = userPartyIds.map((userId) => this.#getSigner(signerParty, userId));\n\t\t\tmembers.push(...signers);\n\t\t}\n\n\t\treturn members;\n\t}\n\n\t#parseMembers(loadedMembers: SetupMember[]): { [$Keys<typeof MemberRole>]: number[]; }\n\t{\n\t\treturn loadedMembers.reduce((acc, member) => {\n\t\t\tconst { entityType, entityId } = member;\n\t\t\tif (entityType !== 'user')\n\t\t\t{\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst role = `${member.role}s`;\n\n\t\t\treturn {\n\t\t\t\t...acc,\n\t\t\t\t[role]: [\n\t\t\t\t\t...acc[role] ?? [],\n\t\t\t\t\tentityId,\n\t\t\t\t],\n\t\t\t};\n\t\t}, {});\n\t}\n\n\tasync applyDocumentData(uid: string): Promise<boolean>\n\t{\n\t\tconst setupData = await this.setupDocument(uid, true);\n\t\tif (!setupData)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { entityId, representativeId, companyUid } = setupData;\n\t\tthis.documentSend.documentData = setupData;\n\t\tthis.editor.documentData = setupData;\n\t\tthis.#companyParty.setEntityId(entityId);\n\t\tif (companyUid)\n\t\t{\n\t\t\tthis.#companyParty.loadCompany(companyUid);\n\t\t}\n\n\t\tif (representativeId)\n\t\t{\n\t\t\tthis.#companyParty.loadRepresentative(representativeId);\n\t\t}\n\n\t\tconst members = await this.#api.loadMembers(uid);\n\t\tconst parsedMembers = this.#parseMembers(members);\n\t\tconst { signers = [], reviewers = [], editors = [] } = parsedMembers;\n\t\tif (signers.length > 0)\n\t\t{\n\t\t\tthis.#userParty.load(signers);\n\t\t}\n\n\t\tif (reviewers.length > 0)\n\t\t{\n\t\t\tthis.#companyParty.loadValidator(reviewers[0], MemberRole.reviewer);\n\t\t}\n\n\t\tif (editors.length > 0)\n\t\t{\n\t\t\tthis.#companyParty.loadValidator(editors[0], MemberRole.editor);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#getSetupStep(signSettings: B2ESignSettings): $Values<typeof Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.documentSetup.layout;\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2B_LOAD_DOCUMENT'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\tconst isValid = this.documentSetup.validate();\n\t\t\t\tif (!isValid)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst setupDataPromise = this.setupDocument();\n\t\t\t\tif (!setupDataPromise)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst setupData = await setupDataPromise;\n\t\t\t\tif (!setupData)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.#companyParty.setInitiatedByType(setupData.initiatedByType);\n\t\t\t\tthis.#companyParty.setEntityId(setupData.entityId);\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\t#getCompanyStep(signSettings: B2ESignSettings): $Values<typeof Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.#companyParty.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2E_COMPANY'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\tconst { uid } = this.documentSetup.setupData;\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tawait this.#companyParty.save(uid);\n\t\t\t\t\tthis.#setSecondPartySectionVisibility();\n\n\t\t\t\t\tif (this.isTemplateMode())\n\t\t\t\t\t{\n\t\t\t\t\t\tconst entityData = await this.#setupParties();\n\t\t\t\t\t\tthis.editor.entityData = entityData;\n\n\t\t\t\t\t\tconst { title, isTemplate, entityId, externalId, templateUid } = this.documentSetup.setupData;\n\t\t\t\t\t\tconst blocks = await this.documentSetup.loadBlocks(uid);\n\n\t\t\t\t\t\tconst documentSendData = { uid, title, blocks, externalId, templateUid };\n\t\t\t\t\t\tthis.#executeDocumentSendActions(documentSendData, entityData);\n\n\t\t\t\t\t\tconst editorData = { isTemplate, uid, blocks, entityId };\n\t\t\t\t\t\tthis.#executeEditorActions(editorData);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\t#getEmployeeStep(signSettings: B2ESignSettings): $Values<typeof Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.#userParty.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2E_EMPLOYEES'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tconst isValid = this.#userParty.validate();\n\t\t\t\t\tif (!isValid)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn isValid;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst entityData = await this.#setupParties();\n\t\t\t\t\tthis.editor.entityData = entityData;\n\n\t\t\t\t\tconst { uid, title, isTemplate, externalId, entityId } = this.documentSetup.setupData;\n\t\t\t\t\tconst blocks = await this.documentSetup.loadBlocks(uid);\n\n\t\t\t\t\tconst documentSendData = { uid, title, blocks, externalId };\n\t\t\t\t\tthis.#executeDocumentSendActions(documentSendData, entityData);\n\n\t\t\t\t\tconst editorData = { isTemplate, uid, blocks, entityId };\n\t\t\t\t\tthis.#executeEditorActions(editorData);\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(e);\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tasync #executeDocumentSendActions(documentSendData, entityData): void\n\t{\n\t\tconst partiesData = this.#companyParty.getParties();\n\t\tObject.assign(partiesData, {\n\t\t\temployees: this.#userParty.getUserIds().map((userId) => {\n\t\t\t\treturn {\n\t\t\t\t\tentityType: 'user',\n\t\t\t\t\tentityId: userId,\n\t\t\t\t};\n\t\t\t}),\n\t\t});\n\t\tthis.documentSend.documentData = documentSendData;\n\t\tthis.documentSend.setPartiesData(partiesData);\n\t\tthis.documentSend.members = entityData;\n\t}\n\n\tasync #executeEditorActions(editorData): void\n\t{\n\t\tthis.editor.documentData = editorData;\n\t\tawait this.editor.waitForPagesUrls();\n\t\tawait this.editor.renderDocument();\n\t\tthis.wizard.toggleBtnLoadingState('next', false);\n\t\tawait this.editor.show();\n\t}\n\n\t#getSendStep(signSettings: B2ESignSettings): $Values<typeof Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.documentSend.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_SEND_DOCUMENT'),\n\t\t\tbeforeCompletion: () => this.documentSend.sendForSign(),\n\t\t};\n\t}\n\n\tgetStepsMetadata(signSettings: B2ESignSettings): Metadata\n\t{\n\t\tconst steps = {\n\t\t\tsetup: this.#getSetupStep(signSettings),\n\t\t\tcompany: this.#getCompanyStep(signSettings),\n\t\t};\n\n\t\tif (!this.isTemplateMode())\n\t\t{\n\t\t\tsteps.employees = this.#getEmployeeStep(signSettings);\n\t\t}\n\n\t\tsteps.send = this.#getSendStep(signSettings);\n\n\t\treturn steps;\n\t}\n\n\tonComplete(): void\n\t{\n\t\tif (this.isTemplateMode())\n\t\t{\n\t\t\tBX.SidePanel.Instance.close();\n\n\t\t\tBX.SidePanel.Instance.open('sign-settings-template-created', {\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\treturn Promise.resolve(this.getTemplateStatusLayout());\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\t\tsuper.onComplete();\n\t}\n\n\tgetTemplateStatusLayout(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-b2e-template-status\">\n\t\t\t\t<div class=\"sign-b2e-template-status-inner\">\n\t\t\t\t\t<div class=\"sign-b2e-template-status-img\"></div>\n\t\t\t\t\t<div class=\"sign-b2e-template-status-title\">${Loc.getMessage('SIGN_SETTINGS_TEMPLATE_CREATED')}</div>\n\t\t\t\t\t<button class=\"ui-btn ui-btn-light-border ui-btn-round\" onclick=\"BX.SidePanel.Instance.close();\">${Loc.getMessage('SIGN_SETTINGS_TEMPLATES_LIST')}</button>\n\t\t\t\t</div>\n\t\t\t </div>\n\t\t`;\n\t}\n\n\t#setSecondPartySectionVisibility(): void\n\t{\n\t\tconst selectedProvider = this.#companyParty.getSelectedProvider();\n\t\tconst isSecondPartySectionVisible = selectedProvider.code !== ProviderCode.sesRu\n\t\t\t|| isTemplateMode(this.documentMode)\n\t\t;\n\n\t\tthis.editor.setSectionVisibilityByType(\n\t\t\tSectionType.SecondParty,\n\t\t\tisSecondPartySectionVisible,\n\t\t);\n\t}\n}\n"],"names":["B2ESignSettings","SignSettings","constructor","containerId","signOptions","next","className","complete","swapButtons","blankSelectorConfig","documentSendConfig","userPartyConfig","hideValidationParty","isTemplateMode","documentMode","documentSetup","DocumentSetup","documentSend","DocumentSend","CompanyParty","Api","UserParty","mode","subscribeOnEvents","subscribe","data","setDocumentTitle","title","wizard","toggleBtnActiveState","applyDocumentData","uid","setupData","setupDocument","entityId","representativeId","companyUid","documentData","editor","setEntityId","loadCompany","loadRepresentative","members","loadMembers","parsedMembers","signers","reviewers","editors","length","load","loadValidator","MemberRole","reviewer","getStepsMetadata","signSettings","steps","setup","company","employees","send","onComplete","BX","SidePanel","Instance","close","open","contentCallback","Promise","resolve","getTemplateStatusLayout","Tag","render","Loc","getMessage","config","representative","getParties","setupB2eParties","membersData","Type","isArrayFilled","Error","map","memberData","presetId","part","party","entityTypeId","role","initiatedByType","DocumentInitiated","employee","currentParty","companyId","entityType","assignee","userId","signer","validation","userPartyIds","getUserIds","item","result","push","signerParty","loadedMembers","reduce","acc","member","content","layout","SignSettingsItemCounter","numerate","beforeCompletion","isValid","validate","setupDataPromise","setInitiatedByType","getLayout","save","entityData","isTemplate","externalId","templateUid","blocks","loadBlocks","documentSendData","editorData","e","console","error","partiesData","Object","assign","setPartiesData","waitForPagesUrls","renderDocument","toggleBtnLoadingState","show","sendForSign","selectedProvider","getSelectedProvider","isSecondPartySectionVisible","code","ProviderCode","sesRu","setSectionVisibilityByType","SectionType","SecondParty"],"mappings":"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"}