this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};this.BX.Sign.V2=this.BX.Sign.V2||{};(function(e,t,s,i,a,o,l,r,n,c,d,u,p,b,h){"use strict";let m=e=>e,v,y,P,S,f,L,B,F;const g=new Set(["jpg","jpeg","png","pdf","doc","docx","rtf","odt"]);var H=babelHelpers.classPrivateFieldLooseKey("companyParty");var D=babelHelpers.classPrivateFieldLooseKey("userParty");var I=babelHelpers.classPrivateFieldLooseKey("api");var _=babelHelpers.classPrivateFieldLooseKey("maxDocumentCount");var T=babelHelpers.classPrivateFieldLooseKey("cache");var E=babelHelpers.classPrivateFieldLooseKey("regionDocumentTypes");var w=babelHelpers.classPrivateFieldLooseKey("saveButton");var O=babelHelpers.classPrivateFieldLooseKey("isMultiDocumentSaveProcessGone");var G=babelHelpers.classPrivateFieldLooseKey("prepareConfig");var M=babelHelpers.classPrivateFieldLooseKey("editDocumentData");var N=babelHelpers.classPrivateFieldLooseKey("handleEditedDocument");var C=babelHelpers.classPrivateFieldLooseKey("removeDocumentElement");var A=babelHelpers.classPrivateFieldLooseKey("attachGroupToDocument");var j=babelHelpers.classPrivateFieldLooseKey("saveUpdatedDocumentData");var k=babelHelpers.classPrivateFieldLooseKey("deleteDocument");var K=babelHelpers.classPrivateFieldLooseKey("setupParties");var U=babelHelpers.classPrivateFieldLooseKey("isTemplateModeForCompany");var x=babelHelpers.classPrivateFieldLooseKey("syncMembersWithDepartments");var V=babelHelpers.classPrivateFieldLooseKey("sleep");var X=babelHelpers.classPrivateFieldLooseKey("documentUid");var z=babelHelpers.classPrivateFieldLooseKey("isDocumentInitiatedByEmployee");var $=babelHelpers.classPrivateFieldLooseKey("getAssignee");var R=babelHelpers.classPrivateFieldLooseKey("getSigner");var W=babelHelpers.classPrivateFieldLooseKey("makeSetupMembers");var Y=babelHelpers.classPrivateFieldLooseKey("parseMembers");var Z=babelHelpers.classPrivateFieldLooseKey("getSetupStep");var q=babelHelpers.classPrivateFieldLooseKey("getCompanyStep");var J=babelHelpers.classPrivateFieldLooseKey("getEmployeeStep");var Q=babelHelpers.classPrivateFieldLooseKey("executeDocumentSendActions");var ee=babelHelpers.classPrivateFieldLooseKey("executeEditorActions");var te=babelHelpers.classPrivateFieldLooseKey("getSendStep");var se=babelHelpers.classPrivateFieldLooseKey("setSecondPartySectionVisibility");var ie=babelHelpers.classPrivateFieldLooseKey("setHcmLinkIntegrationSectionVisibility");var ae=babelHelpers.classPrivateFieldLooseKey("isInitiatedByEmployee");var oe=babelHelpers.classPrivateFieldLooseKey("decorateStepsBeforeCompletionWithAnalytics");var le=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSetupStep");var re=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSetupError");var ne=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnCompanyStepSuccess");var ce=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnCompanyStepError");var de=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSendStepSuccess");var ue=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSendStepError");var pe=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnStart");var be=babelHelpers.classPrivateFieldLooseKey("processSetupData");var he=babelHelpers.classPrivateFieldLooseKey("addDocumentInGroup");var me=babelHelpers.classPrivateFieldLooseKey("scrollToTop");var ve=babelHelpers.classPrivateFieldLooseKey("scrollToDown");var ye=babelHelpers.classPrivateFieldLooseKey("resetDocument");var Pe=babelHelpers.classPrivateFieldLooseKey("disableDocumentSectionIfLimitReached");var Se=babelHelpers.classPrivateFieldLooseKey("onBeforePreviewBtnClick");var fe=babelHelpers.classPrivateFieldLooseKey("getMultiDocumentAddSidePanelContent");var Le=babelHelpers.classPrivateFieldLooseKey("getDocumentNumber");var Be=babelHelpers.classPrivateFieldLooseKey("getUploader");var Fe=babelHelpers.classPrivateFieldLooseKey("resetAfterPreviewSidePanel");var ge=babelHelpers.classPrivateFieldLooseKey("getUploadFileButton");var He=babelHelpers.classPrivateFieldLooseKey("getUploadFileFromDirButton");var De=babelHelpers.classPrivateFieldLooseKey("onInputFileChange");var Ie=babelHelpers.classPrivateFieldLooseKey("onFileAdd");var _e=babelHelpers.classPrivateFieldLooseKey("onBeforePreviewSaveBtnClick");var Te=babelHelpers.classPrivateFieldLooseKey("onUploadComplete");var Ee=babelHelpers.classPrivateFieldLooseKey("getDocumentTypeSelectorLayout");var we=babelHelpers.classPrivateFieldLooseKey("onBeforeFilesAdd");class Oe extends p.SignSettings{constructor(e,t){super(e,t,{next:{className:"ui-btn-success"},complete:{className:"ui-btn-success"},swapButtons:true});Object.defineProperty(this,we,{value:wt});Object.defineProperty(this,Ee,{value:Et});Object.defineProperty(this,Te,{value:Tt});Object.defineProperty(this,_e,{value:_t});Object.defineProperty(this,Ie,{value:It});Object.defineProperty(this,De,{value:Dt});Object.defineProperty(this,He,{value:Ht});Object.defineProperty(this,ge,{value:gt});Object.defineProperty(this,Fe,{value:Ft});Object.defineProperty(this,Be,{value:Bt});Object.defineProperty(this,Le,{value:Lt});Object.defineProperty(this,fe,{value:ft});Object.defineProperty(this,Se,{value:St});Object.defineProperty(this,Pe,{value:Pt});Object.defineProperty(this,ye,{value:yt});Object.defineProperty(this,ve,{value:vt});Object.defineProperty(this,me,{value:mt});Object.defineProperty(this,he,{value:ht});Object.defineProperty(this,be,{value:bt});Object.defineProperty(this,pe,{value:pt});Object.defineProperty(this,ue,{value:ut});Object.defineProperty(this,de,{value:dt});Object.defineProperty(this,ce,{value:ct});Object.defineProperty(this,ne,{value:nt});Object.defineProperty(this,re,{value:rt});Object.defineProperty(this,le,{value:lt});Object.defineProperty(this,oe,{value:ot});Object.defineProperty(this,ae,{value:at});Object.defineProperty(this,ie,{value:it});Object.defineProperty(this,se,{value:st});Object.defineProperty(this,te,{value:tt});Object.defineProperty(this,ee,{value:et});Object.defineProperty(this,Q,{value:Qe});Object.defineProperty(this,J,{value:Je});Object.defineProperty(this,q,{value:qe});Object.defineProperty(this,Z,{value:Ze});Object.defineProperty(this,Y,{value:Ye});Object.defineProperty(this,W,{value:We});Object.defineProperty(this,R,{value:Re});Object.defineProperty(this,$,{value:$e});Object.defineProperty(this,z,{get:ze,set:void 0});Object.defineProperty(this,X,{get:Xe,set:void 0});Object.defineProperty(this,V,{value:Ve});Object.defineProperty(this,x,{value:xe});Object.defineProperty(this,U,{value:Ue});Object.defineProperty(this,K,{value:Ke});Object.defineProperty(this,k,{value:ke});Object.defineProperty(this,j,{value:je});Object.defineProperty(this,A,{value:Ae});Object.defineProperty(this,C,{value:Ce});Object.defineProperty(this,N,{value:Ne});Object.defineProperty(this,M,{value:Me});Object.defineProperty(this,G,{value:Ge});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,D,{writable:true,value:void 0});Object.defineProperty(this,I,{writable:true,value:void 0});Object.defineProperty(this,_,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:new s.MemoryCache});Object.defineProperty(this,E,{writable:true,value:[]});Object.defineProperty(this,w,{writable:true,value:void 0});Object.defineProperty(this,O,{writable:true,value:false});const{b2eFeatureConfig:i,blankSelectorConfig:a,documentSendConfig:d,userPartyConfig:u}=babelHelpers.classPrivateFieldLooseBase(this,G)[G](t);this.documentSetup=new r.DocumentSetup(a);this.documentSend=new l.DocumentSend(d);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=new n.Parties({...a,documentInitiatedType:t.initiatedByType,documentMode:t.documentMode},i.hcmLinkAvailable);babelHelpers.classPrivateFieldLooseBase(this,I)[I]=new o.Api;babelHelpers.classPrivateFieldLooseBase(this,_)[_]=t.b2eDocumentLimitCount;babelHelpers.classPrivateFieldLooseBase(this,D)[D]=new c.UserParty({mode:"edit",...u});this.subscribeOnEvents();babelHelpers.classPrivateFieldLooseBase(this,E)[E]=a.regionDocumentTypes}subscribeOnEvents(){super.subscribeOnEvents();this.documentSend.subscribe("changeTitle",(({data:e})=>{this.documentSetup.setDocumentTitle(e.title)}));this.documentSend.subscribe("disableBack",(()=>{this.wizard.toggleBtnActiveState("back",true)}));this.documentSend.subscribe("enableBack",(()=>{this.wizard.toggleBtnActiveState("back",false)}));this.documentSetup.subscribe("addDocument",(()=>{this.setDocumentsGroup()}));this.documentSetup.subscribe("deleteDocument",(({data:e})=>{babelHelpers.classPrivateFieldLooseBase(this,k)[k](e)}));this.documentSetup.subscribe("editDocument",(({data:e})=>{babelHelpers.classPrivateFieldLooseBase(this,M)[M](e.uid)}));this.documentSend.subscribe("enableComplete",(()=>{this.wizard.toggleBtnActiveState("complete",false)}));this.documentSend.subscribe("disableComplete",(()=>{this.wizard.toggleBtnActiveState("complete",true)}));this.documentSetup.subscribe("documentsLimitExceeded",(()=>{this.documentSetup.setAvailabilityDocumentSection(false)}));this.documentSetup.subscribe("documentsLimitNotExceeded",(()=>{this.documentSetup.setAvailabilityDocumentSection(true)}));this.documentSend.subscribe(this.documentSend.events.onTemplateComplete,(e=>{if(this.isTemplateMode()&&!this.isEditMode()){const t=e.getData().templateId;this.getAnalytics().send({event:"turn_on_off_template",type:"auto",c_element:"on",p5:`templateId_${t}`});this.getAnalytics().send({event:"click_save_template",c_element:"create_button",p5:`templateId_${t}`,status:"success"})}}))}async setDocumentsGroup(){if(this.documentSetup.blankIsNotSelected||!this.documentSetup.validate()){return}this.documentSetup.switchAddDocumentButtonLoadingState(true);try{const e=await this.setupDocument();this.documentsGroup.set(e.uid,e);this.addInDocumentsGroupUids(e.uid);this.documentSetup.blankSelector.disableSelectedBlank(e.blankId);await babelHelpers.classPrivateFieldLooseBase(this,A)[A](e);this.documentSetup.switchAddDocumentButtonLoadingState(false);if(this.editedDocument){await babelHelpers.classPrivateFieldLooseBase(this,N)[N](e)}else{this.documentSetup.renderDocumentBlock(e)}}catch{this.documentSetup.switchAddDocumentButtonLoadingState(false)}babelHelpers.classPrivateFieldLooseBase(this,me)[me]();this.documentSetup.documentCounters.update(this.documentsGroup.size);babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]();this.wizard.toggleBtnActiveState("next",false)}addInDocumentsGroupUids(e){if(!this.documentsGroupUids.includes(e)){this.documentsGroupUids.push(e)}}replaceInDocumentsGroupUids(e,t){const s=this.documentsGroupUids.indexOf(e);if(s!==-1){this.documentsGroupUids.splice(s,1,t)}}deleteFromDocumentsGroupUids(e){const t=this.documentsGroupUids.indexOf(e);if(t===-1){return}this.documentsGroupUids.splice(t,1)}async applyDocumentData(e){const t=await this.setupDocument(e,true);if(!t){return false}if(t.groupId){const e=await babelHelpers.classPrivateFieldLooseBase(this,I)[I].getDocumentListInGroup(t.groupId);for(const t of e){this.addInDocumentsGroupUids(t.uid);const e=await babelHelpers.classPrivateFieldLooseBase(this,I)[I].loadBlocksByDocument(t.uid);const s={...t,blocks:e};this.documentsGroup.set(t.uid,s);this.documentSetup.renderDocumentBlock(s);this.documentSetup.blankSelector.disableSelectedBlank(s.blankId)}this.groupId=t.groupId;this.documentSetup.documentCounters.update(this.documentsGroup.size);babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]()}else{this.documentsGroup.set(t.uid,t);this.addInDocumentsGroupUids(t.uid)}const s=this.getFirstDocumentDataFromGroup();const{entityId:i,representativeId:o,companyUid:l,hcmLinkCompanyId:r}=s;this.documentSend.documentData=this.documentsGroup;babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();if(this.isSingleDocument()){this.editor.documentData=s}babelHelpers.classPrivateFieldLooseBase(this,H)[H].setEntityId(i);if(l){babelHelpers.classPrivateFieldLooseBase(this,H)[H].setLastSavedIntegrationId(r);babelHelpers.classPrivateFieldLooseBase(this,H)[H].loadCompany(l)}if(o){babelHelpers.classPrivateFieldLooseBase(this,H)[H].loadRepresentative(o)}const n=await babelHelpers.classPrivateFieldLooseBase(this,I)[I].loadMembers(e);const c=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](n);const{signers:d=[],reviewers:u=[],editors:p=[]}=c;if(d.length>0){babelHelpers.classPrivateFieldLooseBase(this,D)[D].load(d)}if(u.length>0){babelHelpers.classPrivateFieldLooseBase(this,H)[H].loadValidator(u[0],a.MemberRole.reviewer)}if(p.length>0){babelHelpers.classPrivateFieldLooseBase(this,H)[H].loadValidator(p[0],a.MemberRole.editor)}return true}async applyTemplateData(e){super.applyTemplateData(e);this.documentSetup.setupData.templateUid=e;this.documentSend.setExistingTemplate();babelHelpers.classPrivateFieldLooseBase(this,H)[H].setIntegrationSelectorAvailability(babelHelpers.classPrivateFieldLooseBase(this,U)[U]());return true}getStepsMetadata(e,t,s){babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](t);const i={setup:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](e,t),company:babelHelpers.classPrivateFieldLooseBase(this,q)[q](e)};if(this.isDocumentMode()){i.employees=babelHelpers.classPrivateFieldLooseBase(this,J)[J](e)}i.send=babelHelpers.classPrivateFieldLooseBase(this,te)[te](e);babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i,t);return i}async init(e,s){await super.init(e,s);if(this.isEditMode()&&!t.Type.isNull(this.getAfterPreviewLayout())){BX.hide(this.getAfterPreviewLayout())}}onComplete(){if(this.isTemplateMode()){return}super.onComplete()}isTemplateCreateMode(){return p.isTemplateMode(this.documentMode)&&!this.isEditMode()}getAfterPreviewLayout(){if(!this.isDocumentMode()||!i.FeatureStorage.isMultiDocumentLoadingEnabled()){return null}return babelHelpers.classPrivateFieldLooseBase(this,T)[T].remember("beforePreviewLayout",(()=>t.Tag.render(v||(v=m`
			<button class="ui-btn ui-btn-light-border ui-btn-md" style="margin-top: 20px;" onclick="${0}">
				${0}
			</button>
		`),(()=>babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]()),t.Loc.getMessage("SIGN_SETTINGS_B2E_BEFORE_PREVIEW"))))}}function Ge(e){const{config:t,documentMode:s,b2eDocumentLimitCount:i}=e;const{blankSelectorConfig:a,documentSendConfig:o}=t;a.documentMode=s;a.b2eDocumentLimitCount=i;o.documentMode=s;return t}async function Me(e){if(this.editedDocument){await babelHelpers.classPrivateFieldLooseBase(this,j)[j](this.editedDocument.uid)}if(!this.documentSetup.editMode){babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]();return}this.editedDocument=this.documentsGroup.get(e);this.documentSetup.setAvailabilityDocumentSection(true);if(this.documentSetup.isRuRegion()){this.documentSetup.setDocumentNumber(this.editedDocument.externalId)}this.documentSetup.setDocumentTitle(this.editedDocument.title);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]()}async function Ne(e){if(this.documentSetup.blankIsNotSelected){this.documentSetup.resetEditMode();await babelHelpers.classPrivateFieldLooseBase(this,j)[j](this.editedDocument.uid);return}this.deleteFromDocumentsGroupUids(e.uid);this.replaceInDocumentsGroupUids(this.editedDocument.uid,e.uid);this.documentSetup.replaceDocumentBlock(this.editedDocument,e);await babelHelpers.classPrivateFieldLooseBase(this,k)[k](this.editedDocument);await babelHelpers.classPrivateFieldLooseBase(this,A)[A](e);this.editor.setUrls([])}function Ce(e){const t=this.documentSetup.layout.querySelector(`[data-id="document-id-${e}"]`);t==null?void 0:t.remove()}async function Ae(e){if(!this.groupId){const{groupId:e}=await babelHelpers.classPrivateFieldLooseBase(this,I)[I].createDocumentsGroup();this.groupId=e}try{const t=this.documentsGroup.get(e.uid);if(t&&!t.groupId){await babelHelpers.classPrivateFieldLooseBase(this,I)[I].attachGroupToDocument(e.uid,this.groupId);t.groupId=this.groupId}}catch(e){console.error(e)}}async function je(e){const t=await this.documentSetup.updateDocumentData(this.editedDocument);this.documentSetup.updateDocumentBlock(this.editedDocument.id);if(e){this.documentsGroup.set(this.editedDocument.uid,t);this.addInDocumentsGroupUids(this.editedDocument.uid);this.documentSend.setDocumentsBlock(this.documentsGroup)}}async function ke(e){const{id:t,uid:s,blankId:i,deleteButton:a}=e;this.documentSetup.ready=false;try{await babelHelpers.classPrivateFieldLooseBase(this,I)[I].removeDocument(s);this.documentSetup.ready=true;if(this.isFirstDocumentSelected(s)){this.resetPreview();this.hasPreviewUrls=false}babelHelpers.classPrivateFieldLooseBase(this,C)[C](t);this.documentSend.deleteDocument(s);this.documentsGroup.delete(s);this.deleteFromDocumentsGroupUids(s);this.documentSetup.blankSelector.enableSelectedBlank(i);this.documentSetup.deleteDocumentFromList(i);this.documentSetup.documentCounters.update(this.documentsGroup.size);this.documentSetup.resetEditMode();if(this.documentsGroup.size===0){this.wizard.toggleBtnActiveState("next",true)}else{this.documentSetup.setupData=this.getFirstDocumentDataFromGroup()}babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]()}catch{this.documentSetup.toggleDeleteBtnLoadingState(a);this.documentSetup.ready=true}}async function Ke(){const{representative:e}=babelHelpers.classPrivateFieldLooseBase(this,H)[H].getParties();const{members:s,signerParty:i}=babelHelpers.classPrivateFieldLooseBase(this,W)[W]();const a=[...this.documentsGroup.keys()];for(const t of a){await babelHelpers.classPrivateFieldLooseBase(this,I)[I].setupB2eParties(t,e.entityId,s)}const o=babelHelpers.classPrivateFieldLooseBase(this,X)[X];const l=await babelHelpers.classPrivateFieldLooseBase(this,I)[I].loadMembers(o);if(!t.Type.isArrayFilled(l)){throw new Error("Members are empty")}const r=a.map((e=>babelHelpers.classPrivateFieldLooseBase(this,x)[x](e,i)));await Promise.all(r);return l.map((e=>{var t,s,i;return{presetId:e==null?void 0:e.presetId,part:e==null?void 0:e.party,uid:e==null?void 0:e.uid,entityTypeId:(t=e==null?void 0:e.entityTypeId)!=null?t:null,entityId:(s=e==null?void 0:e.entityId)!=null?s:null,role:(i=e==null?void 0:e.role)!=null?i:null}}))}function Ue(){const e=this.documentSetup.setupData.initiatedByType===a.DocumentInitiated.company;return p.isTemplateMode(this.documentMode)&&e}async function xe(e,t){let s=false;while(!s){const i=await babelHelpers.classPrivateFieldLooseBase(this,I)[I].syncB2eMembersWithDepartments(e,t);s=i.syncFinished;await babelHelpers.classPrivateFieldLooseBase(this,V)[V](1e3)}}function Ve(e){return new Promise((t=>{setTimeout(t,e)}))}function Xe(){return this.documentSetup.setupData.uid}function ze(){return this.documentSetup.setupData.initiatedByType===a.DocumentInitiated.employee}function $e(e,t){return{entityType:"company",entityId:t,party:e,role:a.MemberRole.assignee}}function Re(e,t){return{entityType:t.entityType,entityId:t.entityId,party:e,role:a.MemberRole.signer}}function We(){const{company:e,validation:t}=babelHelpers.classPrivateFieldLooseBase(this,H)[H].getParties();const s=babelHelpers.classPrivateFieldLooseBase(this,D)[D].getEntities();let i=babelHelpers.classPrivateFieldLooseBase(this,z)[z]?2:1;const a=t.map((e=>{const t={...e,party:i};i++;return t}));a.push(babelHelpers.classPrivateFieldLooseBase(this,$)[$](i,e.entityId));let o=i;if(this.isDocumentMode()){o=babelHelpers.classPrivateFieldLooseBase(this,z)[z]?1:i+1;const e=s.map((e=>babelHelpers.classPrivateFieldLooseBase(this,R)[R](o,e)));a.push(...e)}return{members:a,signerParty:o}}function Ye(e){return e.reduce(((e,t)=>{var s;const{entityType:i,entityId:a}=t;if(i!=="user"){return e}const o=`${t.role}s`;return{...e,[o]:[...(s=e[o])!=null?s:[],a]}}),{})}function Ze(e,s){return{get content(){const s=e.documentSetup.layout;u.SignSettingsItemCounter.numerate(s);if(!t.Type.isNull(e.getAfterPreviewLayout())){BX.show(e.getAfterPreviewLayout())}return s},title:t.Loc.getMessage("SIGN_SETTINGS_B2B_LOAD_DOCUMENT"),beforeCompletion:async()=>{const e=this.documentSetup.blankSelector.selectedBlankId!==0;if(e||this.documentSetup.isFileAdded){const e=this.documentSetup.validate();if(!e){return false}}const s=await this.setupDocument();if(!s){return false}await babelHelpers.classPrivateFieldLooseBase(this,he)[he](s);if(this.editedDocument){await babelHelpers.classPrivateFieldLooseBase(this,N)[N](s)}babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]();babelHelpers.classPrivateFieldLooseBase(this,be)[be]();babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();if(!t.Type.isNull(this.getAfterPreviewLayout())){BX.hide(this.getAfterPreviewLayout())}return true}}}function qe(e){const s=this.isTemplateMode()?"SIGN_SETTINGS_B2E_ROUTES":"SIGN_SETTINGS_B2E_COMPANY";return{get content(){const t=babelHelpers.classPrivateFieldLooseBase(e,H)[H].getLayout();const s=babelHelpers.classPrivateFieldLooseBase(e,U)[U]();if(e.isTemplateMode()){babelHelpers.classPrivateFieldLooseBase(e,H)[H].setEditorAvailability(s)}u.SignSettingsItemCounter.numerate(t);return t},title:t.Loc.getMessage(s),beforeCompletion:async()=>{const{uid:e,initiatedByType:t}=this.documentSetup.setupData;try{for(const[e]of this.documentsGroup){await babelHelpers.classPrivateFieldLooseBase(this,H)[H].save(e)}this.editor.setSenderType(t);this.documentSetup.setupData.integrationId=babelHelpers.classPrivateFieldLooseBase(this,H)[H].getSelectedIntegrationId();this.documentSend.hcmLinkEnabled=this.documentSetup.setupData.integrationId>0;babelHelpers.classPrivateFieldLooseBase(this,se)[se]();babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]();if(this.isTemplateMode()){const t=await babelHelpers.classPrivateFieldLooseBase(this,K)[K]();this.editor.entityData=t;const{isTemplate:s,entityId:i}=this.documentSetup.setupData;const a=await this.documentSetup.loadBlocks(e);babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]();const o={isTemplate:s,uid:e,blocks:a,entityId:i};babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](o)}}catch{return false}return true}}}function Je(e){return{get content(){const t=babelHelpers.classPrivateFieldLooseBase(e,D)[D].getLayout();u.SignSettingsItemCounter.numerate(t);return t},title:t.Loc.getMessage("SIGN_SETTINGS_B2E_EMPLOYEES"),beforeCompletion:async()=>{try{const e=babelHelpers.classPrivateFieldLooseBase(this,D)[D].validate();if(!e){return e}this.editor.entityData=await babelHelpers.classPrivateFieldLooseBase(this,K)[K]();const{uid:t,isTemplate:s,entityId:i}=this.documentSetup.setupData;const a=await this.documentSetup.loadBlocks(t);babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]();const o={isTemplate:s,uid:t,blocks:a,entityId:i};await babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](o);return true}catch(e){console.error(e);return false}}}}async function Qe(){const e=babelHelpers.classPrivateFieldLooseBase(this,H)[H].getParties();Object.assign(e,{employees:babelHelpers.classPrivateFieldLooseBase(this,D)[D].getEntities().map((e=>({entityType:e.entityType,entityId:e.entityId})))});this.documentSend.documentData=this.documentsGroup;this.documentSend.resetUserPartyPopup();this.documentSend.setPartiesData(e)}async function et(e){if(this.isTemplateCreateMode()){this.editor.setAnalytics(this.getAnalytics())}this.wizard.toggleBtnLoadingState("next",false);if(this.isSingleDocument()){this.editor.documentData=e;await this.editor.waitForPagesUrls();await this.editor.renderDocument();await this.editor.show()}}function tt(e){const s=this.isTemplateMode()?"SIGN_SETTINGS_SEND_DOCUMENT_CREATE":"SIGN_SETTINGS_SEND_DOCUMENT";return{get content(){const t=e.documentSend.getLayout();u.SignSettingsItemCounter.numerate(t);return t},title:t.Loc.getMessage(s),beforeCompletion:()=>this.documentSend.sendForSign()}}function st(){const e=babelHelpers.classPrivateFieldLooseBase(this,H)[H].getSelectedProvider();const t=e.code!==a.ProviderCode.sesRu;const s=t||p.isTemplateMode(this.documentMode)&&babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]();this.editor.setSectionVisibilityByType(d.SectionType.SecondParty,s)}async function it(){const e=this.documentSetup.setupData.initiatedByType===a.DocumentInitiated.company;if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]()&&this.documentSetup.isRuRegion()){await babelHelpers.classPrivateFieldLooseBase(this,I)[I].changeIntegrationId(this.documentSetup.setupData.uid,null)}const t=this.documentSetup.setupData.integrationId>0&&e;this.editor.setSectionVisibilityByType(d.SectionType.HcmLinkIntegration,t)}function at(){return this.documentSetup.setupData.initiatedByType===a.DocumentInitiated.employee}function ot(e,s){const i=this.getAnalytics();if(t.Type.isPlainObject(e.setup)){e.setup.beforeCompletion=p.decorateResultBeforeCompletion(e.setup.beforeCompletion,(()=>babelHelpers.classPrivateFieldLooseBase(this,le)[le](i,s)),(()=>babelHelpers.classPrivateFieldLooseBase(this,re)[re](i)))}if(t.Type.isPlainObject(e.company)){e.company.beforeCompletion=p.decorateResultBeforeCompletion(e.company.beforeCompletion,(()=>babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](i)),(()=>babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](i)))}if(t.Type.isPlainObject(e.send)){e.send.beforeCompletion=p.decorateResultBeforeCompletion(e.send.beforeCompletion,(()=>babelHelpers.classPrivateFieldLooseBase(this,de)[de](i,this.documentSetup.setupData.uid)),(()=>babelHelpers.classPrivateFieldLooseBase(this,ue)[ue](i,this.documentSetup.setupData.uid)))}}function lt(e,t){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_document",c_element:"create_button",status:"success"});e.send({event:"turn_on_off_template",type:"auto",c_element:"off",p5:`templateId_${this.documentSetup.setupData.templateId}`})}}function rt(e){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_document",status:"error",c_element:"create_button"})}}function nt(e){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_route",status:"success",c_element:"create_button"})}}function ct(e){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_route",status:"error",c_element:"create_button"})}}async function dt(e,t){if(this.isDocumentMode()){e.sendWithProviderTypeAndDocId({event:"sent_document_to_sign",c_element:"create_button",status:"success"},t)}}async function ut(e,t){if(this.isTemplateCreateMode()){this.getAnalytics().send({event:"click_save_template",status:"error",c_element:"create_button"})}if(this.isDocumentMode()){e.sendWithProviderTypeAndDocId({event:"sent_document_to_sign",c_element:"create_button",status:"error"},t)}}function pt(e){const s=this.getAnalytics();if(this.isTemplateCreateMode()){s.send({event:"open_wizard",c_element:"create_button"})}else if(this.isDocumentMode()){const i={event:"click_create_document",c_element:"create_button"};if(this.isEditMode()&&t.Type.isStringFilled(e)){s.sendWithDocId(i,e)}else{s.send(i)}}}async function bt(){const e=this.getFirstDocumentDataFromGroup();babelHelpers.classPrivateFieldLooseBase(this,H)[H].setInitiatedByType(e.initiatedByType);babelHelpers.classPrivateFieldLooseBase(this,H)[H].setEntityId(e.entityId);if(this.isTemplateMode()){await babelHelpers.classPrivateFieldLooseBase(this,H)[H].reloadCompanyProviders();babelHelpers.classPrivateFieldLooseBase(this,H)[H].setIntegrationSelectorAvailability(babelHelpers.classPrivateFieldLooseBase(this,U)[U]())}this.editedDocument=null;if(this.hasPreviewUrls){this.wizard.toggleBtnActiveState("next",false)}}async function ht(e){if(this.documentSetup.blankIsNotSelected){return}if(this.isTemplateMode()||!i.FeatureStorage.isGroupSendingEnabled()){this.setSingleDocument(e);return}this.documentsGroup.set(e.uid,e);this.addInDocumentsGroupUids(e.uid);this.documentSetup.blankSelector.disableSelectedBlank(e.blankId);if(!e.groupId&&!this.editedDocument){await babelHelpers.classPrivateFieldLooseBase(this,A)[A](e)}if(!this.isTemplateMode()){this.documentSetup.documentCounters.update(this.documentsGroup.size)}if(!this.editedDocument){this.documentSetup.renderDocumentBlock(e)}}function mt(){window.scrollTo({top:0,behavior:"smooth"})}function vt(){window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}function yt(){if(this.isTemplateMode()||!i.FeatureStorage.isGroupSendingEnabled()){return}this.documentSetup.resetDocument();this.editedDocument=null}function Pt(){if(this.documentsGroup.size>=babelHelpers.classPrivateFieldLooseBase(this,_)[_]){this.documentSetup.setAvailabilityDocumentSection(false)}}function St(){const e=this;BX.SidePanel.Instance.open("sign-settings:afterPreviewSidePanel",{cacheable:false,width:750,contentCallback:()=>{babelHelpers.classPrivateFieldLooseBase(e,Fe)[Fe]();return b.Layout.createContent({extensions:["ui.forms"],title:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0430\u043f\u043a\u0443 \u0441 \u0444\u0430\u0439\u043b\u0430\u043c\u0438",content(){babelHelpers.classPrivateFieldLooseBase(e,Be)[Be]();return babelHelpers.classPrivateFieldLooseBase(e,fe)[fe]()},buttons({cancelButton:t,SaveButton:s}){babelHelpers.classPrivateFieldLooseBase(e,w)[w]=new s({onclick:()=>babelHelpers.classPrivateFieldLooseBase(e,_e)[_e]()});return[babelHelpers.classPrivateFieldLooseBase(e,w)[w]]}})},events:{onClose:e=>{if(babelHelpers.classPrivateFieldLooseBase(this,O)[O]){e.denyAction()}babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]()}}})}function ft(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T].remember("multiDocumentAddSidePanelContent",(()=>t.Tag.render(y||(y=m`
			<div id="multiple-document-add-container" style="display: flex; flex-direction: column;">
				<div style="flex-direction: row;">
					${0}
					${0}
				</div>
				${0}
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,He)[He]().root,babelHelpers.classPrivateFieldLooseBase(this,ge)[ge](),babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]().root,babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]().root)))}function Lt(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T].remember("documentNumber",(()=>t.Tag.render(P||(P=m`
			<div>
				<h3>${0}</h3>
				<div class="ui-ctl ui-ctl-w100" style="margin-top: 25px;">
					<input type="text" class="ui-ctl-element" ref="numberInput" maxlength="255"/>
				</div>
			</div>
		`),t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_DOCUMENT_NUMBER_TITLE"))))}function Bt(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T].remember("uploader",(()=>new h.Uploader({id:"sign-settings-uploader",controller:"sign.upload.blankUploadController",acceptedFileTypes:[...g.values()].map((e=>`.${e}`)),multiple:true,autoUpload:false,maxFileSize:52428800,imageMaxFileSize:10485760,maxTotalFileSize:52428800,events:{[h.UploaderEvent.BEFORE_FILES_ADD]:e=>babelHelpers.classPrivateFieldLooseBase(this,we)[we](e),[h.UploaderEvent.FILE_ADD]:e=>babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie](e.getData().file),[h.UploaderEvent.UPLOAD_COMPLETE]:e=>babelHelpers.classPrivateFieldLooseBase(this,Te)[Te](e)}})))}function Ft(){babelHelpers.classPrivateFieldLooseBase(this,T)[T].delete("uploader");babelHelpers.classPrivateFieldLooseBase(this,T)[T].delete("uploadButton");babelHelpers.classPrivateFieldLooseBase(this,T)[T].delete("uploadFromDirButton");babelHelpers.classPrivateFieldLooseBase(this,T)[T].delete("documentNumber");babelHelpers.classPrivateFieldLooseBase(this,T)[T].delete("numberSelectorLayout");babelHelpers.classPrivateFieldLooseBase(this,T)[T].delete("multiDocumentAddSidePanelContent")}function gt(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T].remember("uploadButton",(()=>{const e=t.Tag.render(S||(S=m`
				<div>
					<button class="ui-btn ui-btn-light-border" style="margin-top: 15px;" onclick="${0}">${0}</button>
					<input ref="fileInput" hidden type="file" multiple ref="fileInput" onchange="${0}"
						accept="${0}"
					>
				</div>
			`),(()=>e.fileInput.click()),t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_ADD_FILE"),(e=>{babelHelpers.classPrivateFieldLooseBase(this,De)[De](e);e.target.value=""}),[...g.values()].map((e=>`.${e}`)).join(", "));return e.root}))}function Ht(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T].remember("uploadFromDirButton",(()=>{const e=t.Tag.render(f||(f=m`
				<div>
					<button class="ui-btn ui-btn-primary" style="margin-top: 15px;" onclick="${0}">${0}</button>
					<input hidden type="file" webkitdirectory multiple ref="fileInput" onchange="${0}">
				</div>
			`),(()=>e.fileInput.click()),t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_LOAD_FROM_DIRS"),(e=>{babelHelpers.classPrivateFieldLooseBase(this,De)[De](e);e.target.value=""}));return e}))}function Dt(e){const t=e.target;const s=t.files;const i=[...s].filter((e=>g.has(e.name.split(".").at(-1))));babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]().addFiles(i)}function It(e){t.Dom.insertAfter(t.Tag.render(L||(L=m`<p style="color: #666">${0}</p>`),t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_LOADED_FILE_NAME",{"#FILENAME#":t.Text.encode(e.getName())})),babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]())}function _t(){var e,s;if(babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]().getFiles().length===0){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_NO_FILES_SELECTED"));return}if(!((e=babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]().selector.value)!=null&&e.trim())){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_NO_DOCUMENT_TYPE_SELECTED"));return}if(!((s=babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]().numberInput.value)!=null&&s.trim())){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_NO_DOCUMENT_NUMBER"));return}t.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe](),{opacity:.6,"pointer-events":"none"});babelHelpers.classPrivateFieldLooseBase(this,O)[O]=true;babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]().start();babelHelpers.classPrivateFieldLooseBase(this,w)[w].setClocking(true)}async function Tt(e){const s=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]();for(const e of s.getFiles()){try{const t=await this.documentSetup.blankSelector.createBlankFromOuterUploaderFiles([e]);this.documentSetup.blankSelector.selectBlank(t);this.documentSetup.setDocumentType(babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]().selector.value);this.documentSetup.setDocumentNumber(babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]().numberInput.value);await this.setDocumentsGroup()}catch(t){console.error(`Error while add file with name ${e.getName()}`,t)}}t.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe](),{opacity:1,"pointer-events":"auto"});babelHelpers.classPrivateFieldLooseBase(this,O)[O]=false;babelHelpers.classPrivateFieldLooseBase(this,w)[w].setClocking(false);BX.SidePanel.Instance.close()}function Et(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T].remember("numberSelectorLayout",(()=>t.Tag.render(B||(B=m`
				<div style="margin-top: 15px;">
					<h3>${0}</h3>
					<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">
						<div class="ui-ctl-after ui-ctl-icon-angle"></div>
						<select class="ui-ctl-element" ref="selector">
							${0}
						</select>
					</div>
				</div>
			`),t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_DOCUMENT_TYPE_SELECTOR_TITLE"),babelHelpers.classPrivateFieldLooseBase(this,E)[E].map((({code:e,description:s})=>t.Tag.render(F||(F=m`
								<option value="${0}">${0}: ${0}</option>
							`),t.Text.encode(e),e,t.Text.encode(s)))))))}function wt(e){const s={maxFileSize:52428800,imageMaxFileSize:10485760,maxTotalFileSize:52428800};const i=e.getData();const a=i.files;const o=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]();const l=[...a,...o.getFiles()];if(l.length+this.documentsGroup.size>babelHelpers.classPrivateFieldLooseBase(this,_)[_]){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_MAX_DOCUMENTS_COUNT_EXCEEDED"));e.preventDefault();return}for(const i of a){if(i.getSize()>s.maxFileSize){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_INVALID_FILE_SIZE"));e.preventDefault();return}if(i.isImage()&&i.getSize()>s.imageMaxFileSize){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_INVALID_IMAGE_FILE_SIZE"));e.preventDefault();return}}const r=l.reduce(((e,t)=>e+t.getSize()),0);if(r>s.maxTotalFileSize){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_MAX_TOTAL_FILE_SIZE_EXCEEDED"));e.preventDefault()}}e.B2ESignSettings=Oe})(this.BX.Sign.V2.B2e=this.BX.Sign.V2.B2e||{},BX,BX.Cache,BX.Sign,BX.Sign,BX.Sign.V2,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2,BX.Sign.V2,BX.Sign.V2,BX.UI.SidePanel,BX.UI.Uploader);
//# sourceMappingURL=sign-settings.bundle.map.js