this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};this.BX.Sign.V2=this.BX.Sign.V2||{};(function(e,t,s,i,a,o,n,l,r,c,d,p){"use strict";var u=babelHelpers.classPrivateFieldLooseKey("companyParty");var b=babelHelpers.classPrivateFieldLooseKey("userParty");var m=babelHelpers.classPrivateFieldLooseKey("api");var y=babelHelpers.classPrivateFieldLooseKey("prepareConfig");var v=babelHelpers.classPrivateFieldLooseKey("setupParties");var h=babelHelpers.classPrivateFieldLooseKey("syncMembers");var P=babelHelpers.classPrivateFieldLooseKey("sleep");var S=babelHelpers.classPrivateFieldLooseKey("documentUid");var f=babelHelpers.classPrivateFieldLooseKey("isDocumentInitiatedByEmployee");var B=babelHelpers.classPrivateFieldLooseKey("getAssignee");var g=babelHelpers.classPrivateFieldLooseKey("getSigner");var L=babelHelpers.classPrivateFieldLooseKey("makeSetupMembers");var F=babelHelpers.classPrivateFieldLooseKey("parseMembers");var H=babelHelpers.classPrivateFieldLooseKey("getSetupStep");var _=babelHelpers.classPrivateFieldLooseKey("getCompanyStep");var T=babelHelpers.classPrivateFieldLooseKey("getEmployeeStep");var I=babelHelpers.classPrivateFieldLooseKey("executeDocumentSendActions");var M=babelHelpers.classPrivateFieldLooseKey("executeEditorActions");var D=babelHelpers.classPrivateFieldLooseKey("getSendStep");var O=babelHelpers.classPrivateFieldLooseKey("setSecondPartySectionVisibility");var C=babelHelpers.classPrivateFieldLooseKey("decorateStepsBeforeCompletionWithAnalytics");var w=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSetupStep");var E=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSetupError");var j=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnCompanyStepSuccess");var A=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnCompanyStepError");var K=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSendStepSuccess");var N=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSendStepError");var V=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnStart");class k extends p.SignSettings{constructor(e,t){super(e,t,{next:{className:"ui-btn-success"},complete:{className:"ui-btn-success"},swapButtons:true});Object.defineProperty(this,V,{value:pe});Object.defineProperty(this,N,{value:de});Object.defineProperty(this,K,{value:ce});Object.defineProperty(this,A,{value:re});Object.defineProperty(this,j,{value:le});Object.defineProperty(this,E,{value:ne});Object.defineProperty(this,w,{value:oe});Object.defineProperty(this,C,{value:ae});Object.defineProperty(this,O,{value:ie});Object.defineProperty(this,D,{value:se});Object.defineProperty(this,M,{value:te});Object.defineProperty(this,I,{value:ee});Object.defineProperty(this,T,{value:Z});Object.defineProperty(this,_,{value:Q});Object.defineProperty(this,H,{value:J});Object.defineProperty(this,F,{value:q});Object.defineProperty(this,L,{value:Y});Object.defineProperty(this,g,{value:$});Object.defineProperty(this,B,{value:W});Object.defineProperty(this,f,{get:z,set:void 0});Object.defineProperty(this,S,{get:x,set:void 0});Object.defineProperty(this,P,{value:R});Object.defineProperty(this,h,{value:U});Object.defineProperty(this,v,{value:G});Object.defineProperty(this,y,{value:X});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,m,{writable:true,value:void 0});const{b2eFeatureConfig:i,blankSelectorConfig:r,documentSendConfig:c,userPartyConfig:d}=babelHelpers.classPrivateFieldLooseBase(this,y)[y](t);r.hideValidationParty=p.isTemplateMode(this.documentMode);this.documentSetup=new o.DocumentSetup(r);this.documentSend=new a.DocumentSend(c);babelHelpers.classPrivateFieldLooseBase(this,u)[u]=new n.Parties({...r,documentInitiatedType:t.initiatedByType,documentMode:t.documentMode},i.hcmLinkAvailable);babelHelpers.classPrivateFieldLooseBase(this,m)[m]=new s.Api;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=new l.UserParty({mode:"edit",...d});this.subscribeOnEvents()}subscribeOnEvents(){super.subscribeOnEvents();this.documentSend.subscribe("changeTitle",(({data:e})=>{this.documentSetup.setDocumentTitle(e.title)}));this.documentSend.subscribe("disableBack",(()=>{this.wizard.toggleBtnActiveState("back",true)}));this.documentSend.subscribe("enableBack",(()=>{this.wizard.toggleBtnActiveState("back",false)}));this.documentSend.subscribe("enableComplete",(()=>{this.wizard.toggleBtnActiveState("complete",false)}));this.documentSend.subscribe("disableComplete",(()=>{this.wizard.toggleBtnActiveState("complete",true)}));this.documentSend.subscribe(this.documentSend.events.onTemplateComplete,(e=>{if(this.isTemplateMode()&&!this.isEditMode()){const t=e.getData().templateId;this.getAnalytics().send({event:"turn_on_off_template",type:"auto",c_element:"on",p5:`templateId_${t}`});this.getAnalytics().send({event:"click_save_template",c_element:"create_button",p5:`templateId_${t}`,status:"success"})}}))}async applyDocumentData(e){const t=await this.setupDocument(e,true);if(!t){return false}const{entityId:i,representativeId:a,companyUid:o,hcmLinkCompanyId:n}=t;this.documentSend.documentData=t;this.editor.documentData=t;babelHelpers.classPrivateFieldLooseBase(this,u)[u].setEntityId(i);if(o){babelHelpers.classPrivateFieldLooseBase(this,u)[u].setLastSavedIntegrationId(n);babelHelpers.classPrivateFieldLooseBase(this,u)[u].loadCompany(o)}if(a){babelHelpers.classPrivateFieldLooseBase(this,u)[u].loadRepresentative(a)}const l=await babelHelpers.classPrivateFieldLooseBase(this,m)[m].loadMembers(e);const r=babelHelpers.classPrivateFieldLooseBase(this,F)[F](l);const{signers:c=[],reviewers:d=[],editors:p=[]}=r;if(c.length>0){babelHelpers.classPrivateFieldLooseBase(this,b)[b].load(c)}if(d.length>0){babelHelpers.classPrivateFieldLooseBase(this,u)[u].loadValidator(d[0],s.MemberRole.reviewer)}if(p.length>0){babelHelpers.classPrivateFieldLooseBase(this,u)[u].loadValidator(p[0],s.MemberRole.editor)}return true}async applyTemplateData(e){super.applyTemplateData(e);this.documentSetup.setupData.templateUid=e;this.documentSend.setExistingTemplate();return true}getStepsMetadata(e,t,s){babelHelpers.classPrivateFieldLooseBase(this,V)[V](t);const i={setup:babelHelpers.classPrivateFieldLooseBase(this,H)[H](e,t),company:babelHelpers.classPrivateFieldLooseBase(this,_)[_](e)};if(this.isDocumentMode()){i.employees=babelHelpers.classPrivateFieldLooseBase(this,T)[T](e)}i.send=babelHelpers.classPrivateFieldLooseBase(this,D)[D](e);babelHelpers.classPrivateFieldLooseBase(this,C)[C](i,t);return i}onComplete(){if(this.isTemplateMode()){return}super.onComplete()}isTemplateCreateMode(){return p.isTemplateMode(this.documentMode)&&!this.isEditMode()}}function X(e){const{config:t,documentMode:s}=e;const{blankSelectorConfig:i,documentSendConfig:a}=t;i.documentMode=s;a.documentMode=s;return t}async function G(){const e=babelHelpers.classPrivateFieldLooseBase(this,S)[S];const{representative:s}=babelHelpers.classPrivateFieldLooseBase(this,u)[u].getParties();const{members:i,signerParty:a}=babelHelpers.classPrivateFieldLooseBase(this,L)[L]();await babelHelpers.classPrivateFieldLooseBase(this,m)[m].setupB2eParties(e,s.entityId,i);const o=await babelHelpers.classPrivateFieldLooseBase(this,m)[m].loadMembers(e);if(!t.Type.isArrayFilled(o)){throw new Error("Members are empty")}await babelHelpers.classPrivateFieldLooseBase(this,h)[h](e,a);return o.map((e=>{var t,s,i;return{presetId:e==null?void 0:e.presetId,part:e==null?void 0:e.party,uid:e==null?void 0:e.uid,entityTypeId:(t=e==null?void 0:e.entityTypeId)!=null?t:null,entityId:(s=e==null?void 0:e.entityId)!=null?s:null,role:(i=e==null?void 0:e.role)!=null?i:null}}))}async function U(e,t){let s=false;while(!s){const i=await babelHelpers.classPrivateFieldLooseBase(this,m)[m].syncB2eMembersWithDepartments(e,t);s=i.syncFinished;await babelHelpers.classPrivateFieldLooseBase(this,P)[P](1e3)}}function R(e){return new Promise((t=>{setTimeout(t,e)}))}function x(){return this.documentSetup.setupData.uid}function z(){return this.documentSetup.setupData.initiatedByType===r.DocumentInitiated.employee}function W(e,t){return{entityType:"company",entityId:t,party:e,role:s.MemberRole.assignee}}function $(e,t){return{entityType:t.entityType,entityId:t.entityId,party:e,role:s.MemberRole.signer}}function Y(){const{company:e,validation:t}=babelHelpers.classPrivateFieldLooseBase(this,u)[u].getParties();const s=babelHelpers.classPrivateFieldLooseBase(this,b)[b].getEntities();let i=babelHelpers.classPrivateFieldLooseBase(this,f)[f]?2:1;const a=t.map((e=>{const t={...e,party:i};i++;return t}));a.push(babelHelpers.classPrivateFieldLooseBase(this,B)[B](i,e.entityId));let o=i;if(this.isDocumentMode()){o=babelHelpers.classPrivateFieldLooseBase(this,f)[f]?1:i+1;const e=s.map((e=>babelHelpers.classPrivateFieldLooseBase(this,g)[g](o,e)));a.push(...e)}return{members:a,signerParty:o}}function q(e){return e.reduce(((e,t)=>{var s;const{entityType:i,entityId:a}=t;if(i!=="user"){return e}const o=`${t.role}s`;return{...e,[o]:[...(s=e[o])!=null?s:[],a]}}),{})}function J(e,s){return{get content(){const t=e.documentSetup.layout;d.SignSettingsItemCounter.numerate(t);return t},title:t.Loc.getMessage("SIGN_SETTINGS_B2B_LOAD_DOCUMENT"),beforeCompletion:async()=>{const e=this.documentSetup.validate();if(!e){return false}const t=this.setupDocument();if(!t){return false}const s=await t;if(!s){return false}babelHelpers.classPrivateFieldLooseBase(this,u)[u].setInitiatedByType(s.initiatedByType);babelHelpers.classPrivateFieldLooseBase(this,u)[u].setEntityId(s.entityId);return true}}}function Q(e){const s=this.isTemplateMode()?"SIGN_SETTINGS_B2E_ROUTES":"SIGN_SETTINGS_B2E_COMPANY";return{get content(){const t=babelHelpers.classPrivateFieldLooseBase(e,u)[u].getLayout();d.SignSettingsItemCounter.numerate(t);return t},title:t.Loc.getMessage(s),beforeCompletion:async()=>{const{uid:e}=this.documentSetup.setupData;try{await babelHelpers.classPrivateFieldLooseBase(this,u)[u].save(e);this.documentSetup.setupData.integrationId=babelHelpers.classPrivateFieldLooseBase(this,u)[u].getSelectedIntegrationId();babelHelpers.classPrivateFieldLooseBase(this,O)[O]();if(this.isTemplateMode()){this.editor.entityData=await babelHelpers.classPrivateFieldLooseBase(this,v)[v]();const{title:t,isTemplate:s,entityId:i,externalId:a,templateUid:o}=this.documentSetup.setupData;const n=await this.documentSetup.loadBlocks(e);babelHelpers.classPrivateFieldLooseBase(this,I)[I]({uid:e,title:t,blocks:n,externalId:a,templateUid:o});babelHelpers.classPrivateFieldLooseBase(this,M)[M]({isTemplate:s,uid:e,blocks:n,entityId:i})}}catch{return false}return true}}}function Z(e){return{get content(){const t=babelHelpers.classPrivateFieldLooseBase(e,b)[b].getLayout();d.SignSettingsItemCounter.numerate(t);return t},title:t.Loc.getMessage("SIGN_SETTINGS_B2E_EMPLOYEES"),beforeCompletion:async()=>{try{const e=babelHelpers.classPrivateFieldLooseBase(this,b)[b].validate();if(!e){return e}this.editor.entityData=await babelHelpers.classPrivateFieldLooseBase(this,v)[v]();const{uid:t,title:s,isTemplate:i,externalId:a,entityId:o,integrationId:n}=this.documentSetup.setupData;const l=await this.documentSetup.loadBlocks(t);babelHelpers.classPrivateFieldLooseBase(this,I)[I]({uid:t,title:s,blocks:l,externalId:a,integrationId:n});babelHelpers.classPrivateFieldLooseBase(this,M)[M]({isTemplate:i,uid:t,blocks:l,entityId:o});return true}catch(e){console.error(e);return false}}}}async function ee(e){const t=babelHelpers.classPrivateFieldLooseBase(this,u)[u].getParties();Object.assign(t,{employees:babelHelpers.classPrivateFieldLooseBase(this,b)[b].getEntities().map((e=>({entityType:e.entityType,entityId:e.entityId})))});this.documentSend.documentData=e;this.documentSend.resetUserPartyPopup();this.documentSend.setPartiesData(t)}async function te(e){this.editor.documentData=e;await this.editor.waitForPagesUrls();await this.editor.renderDocument();this.wizard.toggleBtnLoadingState("next",false);await this.editor.show()}function se(e){const s=this.isTemplateMode()?"SIGN_SETTINGS_SEND_DOCUMENT_CREATE":"SIGN_SETTINGS_SEND_DOCUMENT";return{get content(){const t=e.documentSend.getLayout();d.SignSettingsItemCounter.numerate(t);return t},title:t.Loc.getMessage(s),beforeCompletion:()=>this.documentSend.sendForSign()}}function ie(){const e=babelHelpers.classPrivateFieldLooseBase(this,u)[u].getSelectedProvider();const t=e.code!==i.ProviderCode.sesRu;const s=this.documentSetup.setupData.initiatedByType===r.DocumentInitiated.employee;const a=this.documentSetup.setupData.initiatedByType===r.DocumentInitiated.company;const o=t||p.isTemplateMode(this.documentMode)&&s;const n=this.documentSetup.setupData.integrationId>0||a;this.editor.setSectionVisibilityByType(c.SectionType.HcmLinkIntegration,n);this.editor.setSectionVisibilityByType(c.SectionType.SecondParty,o)}function ae(e,s){const i=this.getAnalytics();if(t.Type.isPlainObject(e.setup)){e.setup.beforeCompletion=p.decorateResultBeforeCompletion(e.setup.beforeCompletion,(()=>babelHelpers.classPrivateFieldLooseBase(this,w)[w](i,s)),(()=>babelHelpers.classPrivateFieldLooseBase(this,E)[E](i)))}if(t.Type.isPlainObject(e.company)){e.company.beforeCompletion=p.decorateResultBeforeCompletion(e.company.beforeCompletion,(()=>babelHelpers.classPrivateFieldLooseBase(this,j)[j](i)),(()=>babelHelpers.classPrivateFieldLooseBase(this,A)[A](i)))}if(t.Type.isPlainObject(e.send)){e.send.beforeCompletion=p.decorateResultBeforeCompletion(e.send.beforeCompletion,(()=>babelHelpers.classPrivateFieldLooseBase(this,K)[K](i,this.documentSetup.setupData.uid)),(()=>babelHelpers.classPrivateFieldLooseBase(this,N)[N](i,this.documentSetup.setupData.uid)))}}function oe(e,t){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_document",c_element:"create_button",status:"success"});e.send({event:"turn_on_off_template",type:"auto",c_element:"off",p5:`templateId_${this.documentSetup.setupData.templateId}`})}}function ne(e){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_document",status:"error",c_element:"create_button"})}}function le(e){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_route",status:"success",c_element:"create_button"})}}function re(e){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_route",status:"error",c_element:"create_button"})}}async function ce(e,t){if(this.isDocumentMode()){e.sendWithProviderTypeAndDocId({event:"sent_document_to_sign",c_element:"create_button",status:"success"},t)}}async function de(e,t){if(this.isTemplateCreateMode()){this.getAnalytics().send({event:"click_save_template",status:"error",c_element:"create_button"})}if(this.isDocumentMode()){e.sendWithProviderTypeAndDocId({event:"sent_document_to_sign",c_element:"create_button",status:"error"},t)}}function pe(e){const s=this.getAnalytics();if(this.isTemplateCreateMode()){s.send({event:"open_wizard",c_element:"create_button"})}else if(this.isDocumentMode()){const i={event:"click_create_document",c_element:"create_button"};if(this.isEditMode()&&t.Type.isStringFilled(e)){s.sendWithDocId(i,e)}else{s.send(i)}}}e.B2ESignSettings=k})(this.BX.Sign.V2.B2e=this.BX.Sign.V2.B2e||{},BX,BX.Sign.V2,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2,BX.Sign.V2,BX.Sign.V2,BX.Sign.V2);
//# sourceMappingURL=sign-settings.bundle.map.js