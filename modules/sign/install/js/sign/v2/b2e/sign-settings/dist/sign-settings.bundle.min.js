this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};this.BX.Sign.V2=this.BX.Sign.V2||{};(function(e,t,s,i,a,o,l,r,n,c,d,u,p,b,m,h){"use strict";let v=e=>e,y,P,S,f,L,B,F,g;const H=new Set(["jpg","jpeg","png","pdf","doc","docx","rtf","odt"]);var D=babelHelpers.classPrivateFieldLooseKey("companyParty");var _=babelHelpers.classPrivateFieldLooseKey("userParty");var I=babelHelpers.classPrivateFieldLooseKey("api");var T=babelHelpers.classPrivateFieldLooseKey("maxDocumentCount");var E=babelHelpers.classPrivateFieldLooseKey("cache");var w=babelHelpers.classPrivateFieldLooseKey("regionDocumentTypes");var G=babelHelpers.classPrivateFieldLooseKey("saveButton");var O=babelHelpers.classPrivateFieldLooseKey("isMultiDocumentSaveProcessGone");var M=babelHelpers.classPrivateFieldLooseKey("prepareConfig");var N=babelHelpers.classPrivateFieldLooseKey("editDocumentData");var C=babelHelpers.classPrivateFieldLooseKey("handleEditedDocument");var A=babelHelpers.classPrivateFieldLooseKey("removeDocumentElement");var j=babelHelpers.classPrivateFieldLooseKey("attachGroupToDocument");var k=babelHelpers.classPrivateFieldLooseKey("saveUpdatedDocumentData");var K=babelHelpers.classPrivateFieldLooseKey("deleteDocument");var U=babelHelpers.classPrivateFieldLooseKey("setupParties");var x=babelHelpers.classPrivateFieldLooseKey("syncMembersWithDepartments");var V=babelHelpers.classPrivateFieldLooseKey("sleep");var X=babelHelpers.classPrivateFieldLooseKey("documentUid");var z=babelHelpers.classPrivateFieldLooseKey("isDocumentInitiatedByEmployee");var $=babelHelpers.classPrivateFieldLooseKey("getAssignee");var R=babelHelpers.classPrivateFieldLooseKey("getSigner");var W=babelHelpers.classPrivateFieldLooseKey("makeSetupMembers");var Y=babelHelpers.classPrivateFieldLooseKey("parseMembers");var Z=babelHelpers.classPrivateFieldLooseKey("getSetupStep");var q=babelHelpers.classPrivateFieldLooseKey("getCompanyStep");var J=babelHelpers.classPrivateFieldLooseKey("getEmployeeStep");var Q=babelHelpers.classPrivateFieldLooseKey("executeDocumentSendActions");var ee=babelHelpers.classPrivateFieldLooseKey("executeEditorActions");var te=babelHelpers.classPrivateFieldLooseKey("getSendStep");var se=babelHelpers.classPrivateFieldLooseKey("setSecondPartySectionVisibility");var ie=babelHelpers.classPrivateFieldLooseKey("decorateStepsBeforeCompletionWithAnalytics");var ae=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSetupStep");var oe=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSetupError");var le=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnCompanyStepSuccess");var re=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnCompanyStepError");var ne=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSendStepSuccess");var ce=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSendStepError");var de=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnStart");var ue=babelHelpers.classPrivateFieldLooseKey("processSetupData");var pe=babelHelpers.classPrivateFieldLooseKey("addDocumentInGroup");var be=babelHelpers.classPrivateFieldLooseKey("scrollToTop");var me=babelHelpers.classPrivateFieldLooseKey("scrollToDown");var he=babelHelpers.classPrivateFieldLooseKey("resetDocument");var ve=babelHelpers.classPrivateFieldLooseKey("checkDocumentLimit");var ye=babelHelpers.classPrivateFieldLooseKey("onBeforePreviewBtnClick");var Pe=babelHelpers.classPrivateFieldLooseKey("getMultiDocumentAddSidePanelContent");var Se=babelHelpers.classPrivateFieldLooseKey("getDocumentNumber");var fe=babelHelpers.classPrivateFieldLooseKey("getUploader");var Le=babelHelpers.classPrivateFieldLooseKey("resetAfterPreviewSidePanel");var Be=babelHelpers.classPrivateFieldLooseKey("getUploadFileButton");var Fe=babelHelpers.classPrivateFieldLooseKey("getUploadFileFromDirButton");var ge=babelHelpers.classPrivateFieldLooseKey("onInputFileChange");var He=babelHelpers.classPrivateFieldLooseKey("onFileAdd");var De=babelHelpers.classPrivateFieldLooseKey("onBeforePreviewSaveBtnClick");var _e=babelHelpers.classPrivateFieldLooseKey("onUploadComplete");var Ie=babelHelpers.classPrivateFieldLooseKey("getDocumentTypeSelectorLayout");var Te=babelHelpers.classPrivateFieldLooseKey("onBeforeFilesAdd");class Ee extends b.SignSettings{constructor(e,t){super(e,t,{next:{className:"ui-btn-success"},complete:{className:"ui-btn-success"},swapButtons:true});Object.defineProperty(this,Te,{value:Dt});Object.defineProperty(this,Ie,{value:Ht});Object.defineProperty(this,_e,{value:gt});Object.defineProperty(this,De,{value:Ft});Object.defineProperty(this,He,{value:Bt});Object.defineProperty(this,ge,{value:Lt});Object.defineProperty(this,Fe,{value:ft});Object.defineProperty(this,Be,{value:St});Object.defineProperty(this,Le,{value:Pt});Object.defineProperty(this,fe,{value:yt});Object.defineProperty(this,Se,{value:vt});Object.defineProperty(this,Pe,{value:ht});Object.defineProperty(this,ye,{value:mt});Object.defineProperty(this,ve,{value:bt});Object.defineProperty(this,he,{value:pt});Object.defineProperty(this,me,{value:ut});Object.defineProperty(this,be,{value:dt});Object.defineProperty(this,pe,{value:ct});Object.defineProperty(this,ue,{value:nt});Object.defineProperty(this,de,{value:rt});Object.defineProperty(this,ce,{value:lt});Object.defineProperty(this,ne,{value:ot});Object.defineProperty(this,re,{value:at});Object.defineProperty(this,le,{value:it});Object.defineProperty(this,oe,{value:st});Object.defineProperty(this,ae,{value:tt});Object.defineProperty(this,ie,{value:et});Object.defineProperty(this,se,{value:Qe});Object.defineProperty(this,te,{value:Je});Object.defineProperty(this,ee,{value:qe});Object.defineProperty(this,Q,{value:Ze});Object.defineProperty(this,J,{value:Ye});Object.defineProperty(this,q,{value:We});Object.defineProperty(this,Z,{value:Re});Object.defineProperty(this,Y,{value:$e});Object.defineProperty(this,W,{value:ze});Object.defineProperty(this,R,{value:Xe});Object.defineProperty(this,$,{value:Ve});Object.defineProperty(this,z,{get:xe,set:void 0});Object.defineProperty(this,X,{get:Ue,set:void 0});Object.defineProperty(this,V,{value:Ke});Object.defineProperty(this,x,{value:ke});Object.defineProperty(this,U,{value:je});Object.defineProperty(this,K,{value:Ae});Object.defineProperty(this,k,{value:Ce});Object.defineProperty(this,j,{value:Ne});Object.defineProperty(this,A,{value:Me});Object.defineProperty(this,C,{value:Oe});Object.defineProperty(this,N,{value:Ge});Object.defineProperty(this,M,{value:we});Object.defineProperty(this,D,{writable:true,value:void 0});Object.defineProperty(this,_,{writable:true,value:void 0});Object.defineProperty(this,I,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:new s.MemoryCache});Object.defineProperty(this,w,{writable:true,value:[]});Object.defineProperty(this,G,{writable:true,value:void 0});Object.defineProperty(this,O,{writable:true,value:false});const{b2eFeatureConfig:i,blankSelectorConfig:o,documentSendConfig:d,userPartyConfig:u}=babelHelpers.classPrivateFieldLooseBase(this,M)[M](t);o.hideValidationParty=b.isTemplateMode(this.documentMode);this.documentSetup=new r.DocumentSetup(o);this.documentSend=new l.DocumentSend(d);babelHelpers.classPrivateFieldLooseBase(this,D)[D]=new n.Parties({...o,documentInitiatedType:t.initiatedByType,documentMode:t.documentMode},i.hcmLinkAvailable);babelHelpers.classPrivateFieldLooseBase(this,I)[I]=new a.Api;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=t.b2eDocumentLimitCount;babelHelpers.classPrivateFieldLooseBase(this,_)[_]=new c.UserParty({mode:"edit",...u});this.subscribeOnEvents();babelHelpers.classPrivateFieldLooseBase(this,w)[w]=o.regionDocumentTypes}subscribeOnEvents(){super.subscribeOnEvents();this.documentSend.subscribe("changeTitle",(({data:e})=>{this.documentSetup.setDocumentTitle(e.title)}));this.documentSend.subscribe("disableBack",(()=>{this.wizard.toggleBtnActiveState("back",true)}));this.documentSend.subscribe("enableBack",(()=>{this.wizard.toggleBtnActiveState("back",false)}));this.documentSetup.subscribe("addDocument",(()=>{this.setDocumentsGroup()}));this.documentSetup.subscribe("deleteDocument",(({data:e})=>{babelHelpers.classPrivateFieldLooseBase(this,K)[K](e)}));this.documentSetup.subscribe("editDocument",(({data:e})=>{babelHelpers.classPrivateFieldLooseBase(this,N)[N](e.uid)}));this.documentSend.subscribe("enableComplete",(()=>{this.wizard.toggleBtnActiveState("complete",false)}));this.documentSend.subscribe("disableComplete",(()=>{this.wizard.toggleBtnActiveState("complete",true)}));this.documentSetup.subscribe("documentsLimitExceeded",(()=>{this.documentSetup.setAvailabilityDocumentSection(false)}));this.documentSetup.subscribe("documentsLimitNotExceeded",(()=>{this.documentSetup.setAvailabilityDocumentSection(true)}));this.documentSend.subscribe(this.documentSend.events.onTemplateComplete,(e=>{if(this.isTemplateMode()&&!this.isEditMode()){const t=e.getData().templateId;this.getAnalytics().send({event:"turn_on_off_template",type:"auto",c_element:"on",p5:`templateId_${t}`});this.getAnalytics().send({event:"click_save_template",c_element:"create_button",p5:`templateId_${t}`,status:"success"})}}))}async setDocumentsGroup(){if(this.documentSetup.blankIsNotSelected||!this.documentSetup.validate()){return}this.documentSetup.switchAddDocumentButtonLoadingState(true);try{const e=await this.setupDocument();this.documentsGroup.set(e.uid,e);this.addInDocumentsGroupUids(e.uid);this.documentSetup.blankSelector.disableSelectedBlank(e.blankId);await babelHelpers.classPrivateFieldLooseBase(this,j)[j](e);this.documentSetup.switchAddDocumentButtonLoadingState(false);if(this.editedDocument){await babelHelpers.classPrivateFieldLooseBase(this,C)[C](e)}else{this.documentSetup.renderDocumentBlock(e)}}catch{this.documentSetup.switchAddDocumentButtonLoadingState(false)}babelHelpers.classPrivateFieldLooseBase(this,be)[be]();this.documentSetup.documentCounters.update(this.documentsGroup.size);babelHelpers.classPrivateFieldLooseBase(this,he)[he]();this.wizard.toggleBtnActiveState("next",false)}addInDocumentsGroupUids(e){if(!this.documentsGroupUids.includes(e)){this.documentsGroupUids.push(e)}}replaceInDocumentsGroupUids(e,t){const s=this.documentsGroupUids.indexOf(e);if(s!==-1){this.documentsGroupUids.splice(s,1,t)}}deleteFromDocumentsGroupUids(e){const t=this.documentsGroupUids.indexOf(e);if(t===-1){return}this.documentsGroupUids.splice(t,1)}async applyDocumentData(e){const t=await this.setupDocument(e,true);if(!t){return false}if(t.groupId){const e=await babelHelpers.classPrivateFieldLooseBase(this,I)[I].getDocumentListInGroup(t.groupId);for(const t of e){this.addInDocumentsGroupUids(t.uid);const e=await babelHelpers.classPrivateFieldLooseBase(this,I)[I].loadBlocksByDocument(t.uid);const s={...t,blocks:e};this.documentsGroup.set(t.uid,s);this.documentSetup.renderDocumentBlock(s);this.documentSetup.blankSelector.disableSelectedBlank(s.blankId)}babelHelpers.classPrivateFieldLooseBase(this,he)[he]();this.groupId=t.groupId;this.documentSetup.documentCounters.update(this.documentsGroup.size)}else{this.documentsGroup.set(t.uid,t);this.addInDocumentsGroupUids(t.uid)}const s=this.getFirstDocumentDataFromGroup();const{entityId:i,representativeId:o,companyUid:l,hcmLinkCompanyId:r}=s;this.documentSend.documentData=this.documentsGroup;babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]();if(this.isSingleDocument()){this.editor.documentData=s}babelHelpers.classPrivateFieldLooseBase(this,D)[D].setEntityId(i);if(l){babelHelpers.classPrivateFieldLooseBase(this,D)[D].setLastSavedIntegrationId(r);babelHelpers.classPrivateFieldLooseBase(this,D)[D].loadCompany(l)}if(o){babelHelpers.classPrivateFieldLooseBase(this,D)[D].loadRepresentative(o)}const n=await babelHelpers.classPrivateFieldLooseBase(this,I)[I].loadMembers(e);const c=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](n);const{signers:d=[],reviewers:u=[],editors:p=[]}=c;if(d.length>0){babelHelpers.classPrivateFieldLooseBase(this,_)[_].load(d)}if(u.length>0){babelHelpers.classPrivateFieldLooseBase(this,D)[D].loadValidator(u[0],a.MemberRole.reviewer)}if(p.length>0){babelHelpers.classPrivateFieldLooseBase(this,D)[D].loadValidator(p[0],a.MemberRole.editor)}return true}async applyTemplateData(e){super.applyTemplateData(e);this.documentSetup.setupData.templateUid=e;this.documentSend.setExistingTemplate();return true}getStepsMetadata(e,t,s){babelHelpers.classPrivateFieldLooseBase(this,de)[de](t);const i={setup:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](e,t),company:babelHelpers.classPrivateFieldLooseBase(this,q)[q](e)};if(this.isDocumentMode()){i.employees=babelHelpers.classPrivateFieldLooseBase(this,J)[J](e)}i.send=babelHelpers.classPrivateFieldLooseBase(this,te)[te](e);babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i,t);return i}async init(e,s){await super.init(e,s);if(this.isEditMode()){if(!t.Type.isNull(this.getAfterPreviewLayout())){BX.hide(this.getAfterPreviewLayout())}}}onComplete(){if(this.isTemplateMode()){return}super.onComplete()}isTemplateCreateMode(){return b.isTemplateMode(this.documentMode)&&!this.isEditMode()}getAfterPreviewLayout(){if(!this.isDocumentMode()||!i.FeatureStorage.isMultiDocumentLoadingEnabled()){return null}return babelHelpers.classPrivateFieldLooseBase(this,E)[E].remember("beforePreviewLayout",(()=>t.Tag.render(y||(y=v`
			<button class="ui-btn ui-btn-light-border ui-btn-md" style="margin-top: 20px;" onclick="${0}">
				${0}
			</button>
		`),(()=>babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]()),t.Loc.getMessage("SIGN_SETTINGS_B2E_BEFORE_PREVIEW"))))}}function we(e){const{config:t,documentMode:s,b2eDocumentLimitCount:i}=e;const{blankSelectorConfig:a,documentSendConfig:o}=t;a.documentMode=s;a.b2eDocumentLimitCount=i;o.documentMode=s;return t}async function Ge(e){if(this.editedDocument){await babelHelpers.classPrivateFieldLooseBase(this,k)[k](this.editedDocument.uid)}if(!this.documentSetup.editMode){babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]();babelHelpers.classPrivateFieldLooseBase(this,he)[he]();return}this.editedDocument=this.documentsGroup.get(e);this.documentSetup.setAvailabilityDocumentSection(true);if(this.documentSetup.isRuRegion()){this.documentSetup.setDocumentNumber(this.editedDocument.externalId)}this.documentSetup.setDocumentTitle(this.editedDocument.title);babelHelpers.classPrivateFieldLooseBase(this,me)[me]()}async function Oe(e){if(this.documentSetup.blankIsNotSelected){this.documentSetup.resetEditMode();await babelHelpers.classPrivateFieldLooseBase(this,k)[k](this.editedDocument.uid);return}this.deleteFromDocumentsGroupUids(e.uid);this.replaceInDocumentsGroupUids(this.editedDocument.uid,e.uid);this.documentSetup.replaceDocumentBlock(this.editedDocument,e);await babelHelpers.classPrivateFieldLooseBase(this,K)[K](this.editedDocument);await babelHelpers.classPrivateFieldLooseBase(this,j)[j](e);this.editor.setUrls([])}function Me(e){const t=this.documentSetup.layout.querySelector(`[data-id="document-id-${e}"]`);t==null?void 0:t.remove()}async function Ne(e){if(!this.groupId){const{groupId:e}=await babelHelpers.classPrivateFieldLooseBase(this,I)[I].createDocumentsGroup();this.groupId=e}try{const t=this.documentsGroup.get(e.uid);if(t&&!t.groupId){await babelHelpers.classPrivateFieldLooseBase(this,I)[I].attachGroupToDocument(e.uid,this.groupId);t.groupId=this.groupId}}catch(e){console.error(e)}}async function Ce(e){const t=await this.documentSetup.updateDocumentData(this.editedDocument);this.documentSetup.updateDocumentBlock(this.editedDocument.id);if(e){this.documentsGroup.set(this.editedDocument.uid,t);this.addInDocumentsGroupUids(this.editedDocument.uid);this.documentSend.setDocumentsBlock(this.documentsGroup)}}async function Ae(e){const{id:t,uid:s,blankId:i,deleteButton:a}=e;this.documentSetup.ready=false;try{await babelHelpers.classPrivateFieldLooseBase(this,I)[I].removeDocument(s);this.documentSetup.ready=true;if(this.isFirstDocumentSelected(s)){this.resetPreview();this.hasPreviewUrls=false}babelHelpers.classPrivateFieldLooseBase(this,A)[A](t);this.documentSend.deleteDocument(s);this.documentsGroup.delete(s);this.deleteFromDocumentsGroupUids(s);this.documentSetup.blankSelector.enableSelectedBlank(i);this.documentSetup.deleteDocumentFromList(i);this.documentSetup.documentCounters.update(this.documentsGroup.size);this.documentSetup.resetEditMode();if(this.documentsGroup.size===0){this.wizard.toggleBtnActiveState("next",true)}else{this.documentSetup.setupData=this.getFirstDocumentDataFromGroup()}babelHelpers.classPrivateFieldLooseBase(this,he)[he]()}catch{this.documentSetup.toggleDeleteBtnLoadingState(a);this.documentSetup.ready=true}}async function je(){const{representative:e}=babelHelpers.classPrivateFieldLooseBase(this,D)[D].getParties();const{members:s,signerParty:i}=babelHelpers.classPrivateFieldLooseBase(this,W)[W]();const a=[...this.documentsGroup.keys()];for(const t of a){await babelHelpers.classPrivateFieldLooseBase(this,I)[I].setupB2eParties(t,e.entityId,s)}const o=babelHelpers.classPrivateFieldLooseBase(this,X)[X];const l=await babelHelpers.classPrivateFieldLooseBase(this,I)[I].loadMembers(o);if(!t.Type.isArrayFilled(l)){throw new Error("Members are empty")}const r=a.map((e=>babelHelpers.classPrivateFieldLooseBase(this,x)[x](e,i)));await Promise.all(r);return l.map((e=>{var t,s,i;return{presetId:e==null?void 0:e.presetId,part:e==null?void 0:e.party,uid:e==null?void 0:e.uid,entityTypeId:(t=e==null?void 0:e.entityTypeId)!=null?t:null,entityId:(s=e==null?void 0:e.entityId)!=null?s:null,role:(i=e==null?void 0:e.role)!=null?i:null}}))}async function ke(e,t){let s=false;while(!s){const i=await babelHelpers.classPrivateFieldLooseBase(this,I)[I].syncB2eMembersWithDepartments(e,t);s=i.syncFinished;await babelHelpers.classPrivateFieldLooseBase(this,V)[V](1e3)}}function Ke(e){return new Promise((t=>{setTimeout(t,e)}))}function Ue(){return this.documentSetup.setupData.uid}function xe(){return this.documentSetup.setupData.initiatedByType===d.DocumentInitiated.employee}function Ve(e,t){return{entityType:"company",entityId:t,party:e,role:a.MemberRole.assignee}}function Xe(e,t){return{entityType:t.entityType,entityId:t.entityId,party:e,role:a.MemberRole.signer}}function ze(){const{company:e,validation:t}=babelHelpers.classPrivateFieldLooseBase(this,D)[D].getParties();const s=babelHelpers.classPrivateFieldLooseBase(this,_)[_].getEntities();let i=babelHelpers.classPrivateFieldLooseBase(this,z)[z]?2:1;const a=t.map((e=>{const t={...e,party:i};i++;return t}));a.push(babelHelpers.classPrivateFieldLooseBase(this,$)[$](i,e.entityId));let o=i;if(this.isDocumentMode()){o=babelHelpers.classPrivateFieldLooseBase(this,z)[z]?1:i+1;const e=s.map((e=>babelHelpers.classPrivateFieldLooseBase(this,R)[R](o,e)));a.push(...e)}return{members:a,signerParty:o}}function $e(e){return e.reduce(((e,t)=>{var s;const{entityType:i,entityId:a}=t;if(i!=="user"){return e}const o=`${t.role}s`;return{...e,[o]:[...(s=e[o])!=null?s:[],a]}}),{})}function Re(e,s){return{get content(){const s=e.documentSetup.layout;p.SignSettingsItemCounter.numerate(s);if(!t.Type.isNull(e.getAfterPreviewLayout())){BX.show(e.getAfterPreviewLayout())}return s},title:t.Loc.getMessage("SIGN_SETTINGS_B2B_LOAD_DOCUMENT"),beforeCompletion:async()=>{const e=this.documentSetup.blankSelector.selectedBlankId!==0;if(e||this.documentSetup.isFileAdded){const e=this.documentSetup.validate();if(!e){return false}}const s=await this.setupDocument();if(!s){return false}await babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](s);if(this.editedDocument){await babelHelpers.classPrivateFieldLooseBase(this,C)[C](s)}babelHelpers.classPrivateFieldLooseBase(this,he)[he]();babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]();babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]();if(!t.Type.isNull(this.getAfterPreviewLayout())){BX.hide(this.getAfterPreviewLayout())}return true}}}function We(e){const s=this.isTemplateMode()?"SIGN_SETTINGS_B2E_ROUTES":"SIGN_SETTINGS_B2E_COMPANY";return{get content(){const t=babelHelpers.classPrivateFieldLooseBase(e,D)[D].getLayout();p.SignSettingsItemCounter.numerate(t);return t},title:t.Loc.getMessage(s),beforeCompletion:async()=>{const{uid:e}=this.documentSetup.setupData;try{for(const[e]of this.documentsGroup){await babelHelpers.classPrivateFieldLooseBase(this,D)[D].save(e)}this.documentSetup.setupData.integrationId=babelHelpers.classPrivateFieldLooseBase(this,D)[D].getSelectedIntegrationId();this.documentSend.hcmLinkEnabled=this.documentSetup.setupData.integrationId>0;babelHelpers.classPrivateFieldLooseBase(this,se)[se]();if(this.isTemplateMode()){const t=await babelHelpers.classPrivateFieldLooseBase(this,U)[U]();this.editor.entityData=t;const{isTemplate:s,entityId:i}=this.documentSetup.setupData;const a=await this.documentSetup.loadBlocks(e);babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]();const o={isTemplate:s,uid:e,blocks:a,entityId:i};babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](o)}}catch{return false}return true}}}function Ye(e){return{get content(){const t=babelHelpers.classPrivateFieldLooseBase(e,_)[_].getLayout();p.SignSettingsItemCounter.numerate(t);return t},title:t.Loc.getMessage("SIGN_SETTINGS_B2E_EMPLOYEES"),beforeCompletion:async()=>{try{const e=babelHelpers.classPrivateFieldLooseBase(this,_)[_].validate();if(!e){return e}this.editor.entityData=await babelHelpers.classPrivateFieldLooseBase(this,U)[U]();const{uid:t,isTemplate:s,entityId:i}=this.documentSetup.setupData;const a=await this.documentSetup.loadBlocks(t);babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]();const o={isTemplate:s,uid:t,blocks:a,entityId:i};await babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](o);return true}catch(e){console.error(e);return false}}}}async function Ze(){const e=babelHelpers.classPrivateFieldLooseBase(this,D)[D].getParties();Object.assign(e,{employees:babelHelpers.classPrivateFieldLooseBase(this,_)[_].getEntities().map((e=>({entityType:e.entityType,entityId:e.entityId})))});this.documentSend.documentData=this.documentsGroup;this.documentSend.resetUserPartyPopup();this.documentSend.setPartiesData(e)}async function qe(e){this.wizard.toggleBtnLoadingState("next",false);if(this.isSingleDocument()){this.editor.documentData=e;await this.editor.waitForPagesUrls();await this.editor.renderDocument();await this.editor.show()}}function Je(e){const s=this.isTemplateMode()?"SIGN_SETTINGS_SEND_DOCUMENT_CREATE":"SIGN_SETTINGS_SEND_DOCUMENT";return{get content(){const t=e.documentSend.getLayout();p.SignSettingsItemCounter.numerate(t);return t},title:t.Loc.getMessage(s),beforeCompletion:()=>this.documentSend.sendForSign()}}function Qe(){const e=babelHelpers.classPrivateFieldLooseBase(this,D)[D].getSelectedProvider();const t=e.code!==o.ProviderCode.sesRu;const s=this.documentSetup.setupData.initiatedByType===d.DocumentInitiated.employee;const i=this.documentSetup.setupData.initiatedByType===d.DocumentInitiated.company;const a=t||b.isTemplateMode(this.documentMode)&&s;const l=this.documentSetup.setupData.integrationId>0;this.editor.setSectionVisibilityByType(u.SectionType.HcmLinkIntegration,l);this.editor.setSectionVisibilityByType(u.SectionType.SecondParty,a)}function et(e,s){const i=this.getAnalytics();if(t.Type.isPlainObject(e.setup)){e.setup.beforeCompletion=b.decorateResultBeforeCompletion(e.setup.beforeCompletion,(()=>babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](i,s)),(()=>babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i)))}if(t.Type.isPlainObject(e.company)){e.company.beforeCompletion=b.decorateResultBeforeCompletion(e.company.beforeCompletion,(()=>babelHelpers.classPrivateFieldLooseBase(this,le)[le](i)),(()=>babelHelpers.classPrivateFieldLooseBase(this,re)[re](i)))}if(t.Type.isPlainObject(e.send)){e.send.beforeCompletion=b.decorateResultBeforeCompletion(e.send.beforeCompletion,(()=>babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](i,this.documentSetup.setupData.uid)),(()=>babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](i,this.documentSetup.setupData.uid)))}}function tt(e,t){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_document",c_element:"create_button",status:"success"});e.send({event:"turn_on_off_template",type:"auto",c_element:"off",p5:`templateId_${this.documentSetup.setupData.templateId}`})}}function st(e){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_document",status:"error",c_element:"create_button"})}}function it(e){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_route",status:"success",c_element:"create_button"})}}function at(e){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_route",status:"error",c_element:"create_button"})}}async function ot(e,t){if(this.isDocumentMode()){e.sendWithProviderTypeAndDocId({event:"sent_document_to_sign",c_element:"create_button",status:"success"},t)}}async function lt(e,t){if(this.isTemplateCreateMode()){this.getAnalytics().send({event:"click_save_template",status:"error",c_element:"create_button"})}if(this.isDocumentMode()){e.sendWithProviderTypeAndDocId({event:"sent_document_to_sign",c_element:"create_button",status:"error"},t)}}function rt(e){const s=this.getAnalytics();if(this.isTemplateCreateMode()){s.send({event:"open_wizard",c_element:"create_button"})}else if(this.isDocumentMode()){const i={event:"click_create_document",c_element:"create_button"};if(this.isEditMode()&&t.Type.isStringFilled(e)){s.sendWithDocId(i,e)}else{s.send(i)}}}async function nt(){const e=this.getFirstDocumentDataFromGroup();babelHelpers.classPrivateFieldLooseBase(this,D)[D].setInitiatedByType(e.initiatedByType);babelHelpers.classPrivateFieldLooseBase(this,D)[D].setEntityId(e.entityId);this.editedDocument=null;if(this.hasPreviewUrls){this.wizard.toggleBtnActiveState("next",false)}}async function ct(e){if(this.documentSetup.blankIsNotSelected){return}if(this.isTemplateMode()||!i.FeatureStorage.isGroupSendingEnabled()){this.setSingleDocument(e);return}this.documentsGroup.set(e.uid,e);this.addInDocumentsGroupUids(e.uid);this.documentSetup.blankSelector.disableSelectedBlank(e.blankId);if(!e.groupId&&!this.editedDocument){await babelHelpers.classPrivateFieldLooseBase(this,j)[j](e)}if(!this.isTemplateMode()){this.documentSetup.documentCounters.update(this.documentsGroup.size)}if(!this.editedDocument){this.documentSetup.renderDocumentBlock(e)}}function dt(){window.scrollTo({top:0,behavior:"smooth"})}function ut(){window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}function pt(){if(this.isTemplateMode()||!i.FeatureStorage.isGroupSendingEnabled()){return}this.documentSetup.resetDocument();this.editedDocument=null}function bt(){if(this.documentsGroup.size===babelHelpers.classPrivateFieldLooseBase(this,T)[T]){this.documentSetup.setAvailabilityDocumentSection(false)}}function mt(){const e=this;BX.SidePanel.Instance.open("sign-settings:afterPreviewSidePanel",{cacheable:false,width:750,contentCallback:()=>{babelHelpers.classPrivateFieldLooseBase(e,Le)[Le]();return m.Layout.createContent({extensions:["ui.forms"],title:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0430\u043f\u043a\u0443 \u0441 \u0444\u0430\u0439\u043b\u0430\u043c\u0438",content(){babelHelpers.classPrivateFieldLooseBase(e,fe)[fe]();return babelHelpers.classPrivateFieldLooseBase(e,Pe)[Pe]()},buttons({cancelButton:t,SaveButton:s}){babelHelpers.classPrivateFieldLooseBase(e,G)[G]=new s({onclick:()=>babelHelpers.classPrivateFieldLooseBase(e,De)[De]()});return[babelHelpers.classPrivateFieldLooseBase(e,G)[G]]}})},events:{onClose:e=>{if(babelHelpers.classPrivateFieldLooseBase(this,O)[O]){e.denyAction()}babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]()}}})}function ht(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E].remember("multiDocumentAddSidePanelContent",(()=>t.Tag.render(P||(P=v`
			<div id="multiple-document-add-container" style="display: flex; flex-direction: column;">
				<div style="flex-direction: row;">
					${0}
					${0}
				</div>
				${0}
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]().root,babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](),babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]().root,babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]().root)))}function vt(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E].remember("documentNumber",(()=>t.Tag.render(S||(S=v`
			<div>
				<h3>${0}</h3>
				<div class="ui-ctl ui-ctl-w100" style="margin-top: 25px;">
					<input type="text" class="ui-ctl-element" ref="numberInput" maxlength="255"/>
				</div>
			</div>
		`),t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_DOCUMENT_NUMBER_TITLE"))))}function yt(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E].remember("uploader",(()=>new h.Uploader({id:"sign-settings-uploader",controller:"sign.upload.blankUploadController",acceptedFileTypes:[...H.values()].map((e=>`.${e}`)),multiple:true,autoUpload:false,maxFileSize:52428800,imageMaxFileSize:10485760,maxTotalFileSize:52428800,events:{[h.UploaderEvent.BEFORE_FILES_ADD]:e=>babelHelpers.classPrivateFieldLooseBase(this,Te)[Te](e),[h.UploaderEvent.FILE_ADD]:e=>babelHelpers.classPrivateFieldLooseBase(this,He)[He](e.getData().file),[h.UploaderEvent.UPLOAD_COMPLETE]:e=>babelHelpers.classPrivateFieldLooseBase(this,_e)[_e](e)}})))}function Pt(){babelHelpers.classPrivateFieldLooseBase(this,E)[E].delete("uploader");babelHelpers.classPrivateFieldLooseBase(this,E)[E].delete("uploadButton");babelHelpers.classPrivateFieldLooseBase(this,E)[E].delete("uploadFromDirButton");babelHelpers.classPrivateFieldLooseBase(this,E)[E].delete("documentNumber");babelHelpers.classPrivateFieldLooseBase(this,E)[E].delete("numberSelectorLayout");babelHelpers.classPrivateFieldLooseBase(this,E)[E].delete("multiDocumentAddSidePanelContent")}function St(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E].remember("uploadButton",(()=>{const e=t.Tag.render(f||(f=v`
				<div>
					<button class="ui-btn ui-btn-light-border" style="margin-top: 15px;" onclick="${0}">${0}</button>
					<input ref="fileInput" hidden type="file" multiple ref="fileInput" onchange="${0}"
						accept="${0}"
					>
				</div>
			`),(()=>e.fileInput.click()),t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_ADD_FILE"),(e=>{babelHelpers.classPrivateFieldLooseBase(this,ge)[ge](e);e.target.value=""}),[...H.values()].map((e=>`.${e}`)).join(", "));return e.root}))}function ft(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E].remember("uploadFromDirButton",(()=>{const e=t.Tag.render(L||(L=v`
				<div>
					<button class="ui-btn ui-btn-primary" style="margin-top: 15px;" onclick="${0}">${0}</button>
					<input hidden type="file" webkitdirectory multiple ref="fileInput" onchange="${0}">
				</div>
			`),(()=>e.fileInput.click()),t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_LOAD_FROM_DIRS"),(e=>{babelHelpers.classPrivateFieldLooseBase(this,ge)[ge](e);e.target.value=""}));return e}))}function Lt(e){const t=e.target;const s=t.files;const i=[...s].filter((e=>H.has(e.name.split(".").at(-1))));babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]().addFiles(i)}function Bt(e){t.Dom.insertAfter(t.Tag.render(B||(B=v`<p style="color: #666">${0}</p>`),t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_LOADED_FILE_NAME",{"#FILENAME#":t.Text.encode(e.getName())})),babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]())}function Ft(){var e,s;if(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]().getFiles().length===0){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_NO_FILES_SELECTED"));return}if(!((e=babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]().selector.value)!=null&&e.trim())){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_NO_DOCUMENT_TYPE_SELECTED"));return}if(!((s=babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]().numberInput.value)!=null&&s.trim())){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_NO_DOCUMENT_NUMBER"));return}t.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](),{opacity:.6,"pointer-events":"none"});babelHelpers.classPrivateFieldLooseBase(this,O)[O]=true;babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]().start();babelHelpers.classPrivateFieldLooseBase(this,G)[G].setClocking(true)}async function gt(e){const s=babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]();for(const e of s.getFiles()){try{const t=await this.documentSetup.blankSelector.createBlankFromOuterUploaderFiles([e]);this.documentSetup.blankSelector.selectBlank(t);this.documentSetup.setDocumentType(babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]().selector.value);this.documentSetup.setDocumentNumber(babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]().numberInput.value);await this.setDocumentsGroup()}catch(t){console.error(`Error while add file with name ${e.getName()}`,t)}}t.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](),{opacity:1,"pointer-events":"auto"});babelHelpers.classPrivateFieldLooseBase(this,O)[O]=false;babelHelpers.classPrivateFieldLooseBase(this,G)[G].setClocking(false);BX.SidePanel.Instance.close()}function Ht(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E].remember("numberSelectorLayout",(()=>t.Tag.render(F||(F=v`
				<div style="margin-top: 15px;">
					<h3>${0}</h3>
					<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">
						<div class="ui-ctl-after ui-ctl-icon-angle"></div>
						<select class="ui-ctl-element" ref="selector">
							${0}
						</select>
					</div>
				</div>
			`),t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_DOCUMENT_TYPE_SELECTOR_TITLE"),babelHelpers.classPrivateFieldLooseBase(this,w)[w].map((({code:e,description:s})=>t.Tag.render(g||(g=v`
								<option value="${0}">${0}: ${0}</option>
							`),t.Text.encode(e),e,t.Text.encode(s)))))))}function Dt(e){const s={maxFileSize:52428800,imageMaxFileSize:10485760,maxTotalFileSize:52428800};const i=e.getData();const a=i.files;const o=babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]();const l=[...a,...o.getFiles()];if(l.length+this.documentsGroup.size>babelHelpers.classPrivateFieldLooseBase(this,T)[T]){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_MAX_DOCUMENTS_COUNT_EXCEEDED"));e.preventDefault();return}for(const i of a){if(i.getSize()>s.maxFileSize){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_INVALID_FILE_SIZE"));e.preventDefault();return}if(i.isImage()&&i.getSize()>s.imageMaxFileSize){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_INVALID_IMAGE_FILE_SIZE"));e.preventDefault();return}}const r=l.reduce(((e,t)=>e+t.getSize()),0);if(r>s.maxTotalFileSize){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_MAX_TOTAL_FILE_SIZE_EXCEEDED"));e.preventDefault();return}}e.B2ESignSettings=Ee})(this.BX.Sign.V2.B2e=this.BX.Sign.V2.B2e||{},BX,BX.Cache,BX.Sign,BX.Sign.V2,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2,BX.Sign.V2,BX.Sign.V2,BX.Sign.V2,BX.UI.SidePanel,BX.UI.Uploader);
//# sourceMappingURL=sign-settings.bundle.map.js