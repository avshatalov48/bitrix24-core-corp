{"version":3,"file":"sign-cancellation.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { UI } from 'ui.notification';\nimport { ajax, Loc } from 'main.core';\nimport { MessageBox } from 'ui.dialogs.messagebox';\n\nexport class SignCancellation\n{\n\t#isCancellationInProgress: boolean = false;\n\tcancelWithConfirm(documentUid: string): void\n\t{\n\t\tif (this.#isCancellationInProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst signingCancellationDialog = new MessageBox({\n\t\t\ttitle: Loc.getMessage('SIGN_CANCELLATION_ITEM_SIGNING_CANCEL_DIALOG_TITLE'),\n\t\t\tmessage: Loc.getMessage('SIGN_CANCELLATION_ITEM_SIGNING_CANCEL_DIALOG_TEXT'),\n\t\t\tmodal: true,\n\t\t});\n\n\t\tconst yesButton = new BX.UI.Button({\n\t\t\ttext: Loc.getMessage('SIGN_CANCELLATION_ITEM_SIGNING_CANCEL_DIALOG_YES_BUTTON_TEXT'),\n\t\t\tcolor: BX.UI.Button.Color.DANGER,\n\t\t\tonclick: (button: BaseButton) => {\n\t\t\t\tif (this.#isCancellationInProgress === true)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.#isCancellationInProgress = true;\n\t\t\t\tbutton.setState(BX.UI.Button.State.WAITING);\n\t\t\t\tvoid this.cancelSigningProcess(documentUid).finally(() => {\n\t\t\t\t\tthis.#isCancellationInProgress = false;\n\t\t\t\t\tsigningCancellationDialog.close();\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\n\t\tconst noButton = new BX.UI.Button({\n\t\t\ttext: Loc.getMessage('SIGN_CANCELLATION_ITEM_SIGNING_CANCEL_DIALOG_NO_BUTTON_TEXT'),\n\t\t\tcolor: BX.UI.Button.Color.LIGHT_BORDER,\n\t\t\tonclick: () => {\n\t\t\t\tsigningCancellationDialog.close();\n\t\t\t},\n\t\t});\n\n\t\tsigningCancellationDialog.setButtons([\n\t\t\tyesButton,\n\t\t\tnoButton,\n\t\t]);\n\n\t\tsigningCancellationDialog.show();\n\t}\n\n\tcancelSigningProcess(documentUid: string): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runAction(\n\t\t\t\t'sign.api_v1.document.signing.stop',\n\t\t\t\t{\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tuid: documentUid,\n\t\t\t\t\t},\n\t\t\t\t\tpreparePost: false,\n\t\t\t\t},\n\t\t\t).then((response) => {\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('SIGN_CANCELLATION_ITEM_SIGNING_CANCEL_SUCCESS'),\n\t\t\t\t\tautoHideDelay: 5000,\n\t\t\t\t});\n\t\t\t\tresolve(response);\n\t\t\t}, (response) => {\n\t\t\t\tresponse.errors.forEach((error) => {\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: error.message,\n\t\t\t\t\t\tautoHideDelay: 5000,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\treject(response.errors);\n\t\t\t}).catch(() => {\n\t\t\t\treject();\n\t\t\t});\n\t\t});\n\t}\n}\n"],"names":["SignCancellation","cancelWithConfirm","documentUid","signingCancellationDialog","MessageBox","title","Loc","getMessage","message","modal","yesButton","BX","UI","Button","text","color","Color","DANGER","onclick","button","setState","State","WAITING","cancelSigningProcess","finally","close","noButton","LIGHT_BORDER","setButtons","show","Promise","resolve","reject","ajax","runAction","json","uid","preparePost","then","response","Notification","Center","notify","content","autoHideDelay","errors","forEach","error","catch"],"mappings":";;;;;;;CAEmD;AAEnD,CAAO,MAAMA,gBAAgB,CAC7B;GAAA;KAAA;OAAA;OAAA,OACsC;;;GACrCC,iBAAiB,CAACC,WAAmB,EACrC;KACC,4CAAI,IAAI,yDACR;OACC;;KAGD,MAAMC,yBAAyB,GAAG,IAAIC,gCAAU,CAAC;OAChDC,KAAK,EAAEC,aAAG,CAACC,UAAU,CAAC,oDAAoD,CAAC;OAC3EC,OAAO,EAAEF,aAAG,CAACC,UAAU,CAAC,mDAAmD,CAAC;OAC5EE,KAAK,EAAE;MACP,CAAC;KAEF,MAAMC,SAAS,GAAG,IAAIC,EAAE,CAACC,EAAE,CAACC,MAAM,CAAC;OAClCC,IAAI,EAAER,aAAG,CAACC,UAAU,CAAC,8DAA8D,CAAC;OACpFQ,KAAK,EAAEJ,EAAE,CAACC,EAAE,CAACC,MAAM,CAACG,KAAK,CAACC,MAAM;OAChCC,OAAO,EAAGC,MAAkB,IAAK;SAChC,IAAI,4CAAI,4DAA+B,IAAI,EAC3C;WACC;;SAED,4CAAI,0DAA6B,IAAI;SACrCA,MAAM,CAACC,QAAQ,CAACT,EAAE,CAACC,EAAE,CAACC,MAAM,CAACQ,KAAK,CAACC,OAAO,CAAC;SAC3C,KAAK,IAAI,CAACC,oBAAoB,CAACrB,WAAW,CAAC,CAACsB,OAAO,CAAC,MAAM;WACzD,4CAAI,0DAA6B,KAAK;WACtCrB,yBAAyB,CAACsB,KAAK,EAAE;UACjC,CAAC;;MAEH,CAAC;KAEF,MAAMC,QAAQ,GAAG,IAAIf,EAAE,CAACC,EAAE,CAACC,MAAM,CAAC;OACjCC,IAAI,EAAER,aAAG,CAACC,UAAU,CAAC,6DAA6D,CAAC;OACnFQ,KAAK,EAAEJ,EAAE,CAACC,EAAE,CAACC,MAAM,CAACG,KAAK,CAACW,YAAY;OACtCT,OAAO,EAAE,MAAM;SACdf,yBAAyB,CAACsB,KAAK,EAAE;;MAElC,CAAC;KAEFtB,yBAAyB,CAACyB,UAAU,CAAC,CACpClB,SAAS,EACTgB,QAAQ,CACR,CAAC;KAEFvB,yBAAyB,CAAC0B,IAAI,EAAE;;GAGjCN,oBAAoB,CAACrB,WAAmB,EACxC;KACC,OAAO,IAAI4B,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;OACvCC,cAAI,CAACC,SAAS,CACb,mCAAmC,EACnC;SACCC,IAAI,EAAE;WACLC,GAAG,EAAElC;UACL;SACDmC,WAAW,EAAE;QACb,CACD,CAACC,IAAI,CAAEC,QAAQ,IAAK;SACpB3B,kBAAE,CAAC4B,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;WAC7BC,OAAO,EAAErC,aAAG,CAACC,UAAU,CAAC,+CAA+C,CAAC;WACxEqC,aAAa,EAAE;UACf,CAAC;SACFb,OAAO,CAACQ,QAAQ,CAAC;QACjB,EAAGA,QAAQ,IAAK;SAChBA,QAAQ,CAACM,MAAM,CAACC,OAAO,CAAEC,KAAK,IAAK;WAClCnC,kBAAE,CAAC4B,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;aAC7BC,OAAO,EAAEI,KAAK,CAACvC,OAAO;aACtBoC,aAAa,EAAE;YACf,CAAC;UACF,CAAC;SACFZ,MAAM,CAACO,QAAQ,CAACM,MAAM,CAAC;QACvB,CAAC,CAACG,KAAK,CAAC,MAAM;SACdhB,MAAM,EAAE;QACR,CAAC;MACF,CAAC;;CAEJ;;;;;;;;"}