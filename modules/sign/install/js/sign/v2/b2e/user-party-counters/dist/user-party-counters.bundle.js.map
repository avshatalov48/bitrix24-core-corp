{"version":3,"file":"user-party-counters.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Dom, Tag, Type, Loc } from 'main.core';\nimport { Icon, Main, Actions } from 'ui.icon-set.api.core';\n\nimport './style.css';\nimport { Popup } from 'main.popup';\nimport { Guide } from 'sign.tour';\n\ntype UserPartyCountersOption = {\n\tuserCountersLimit: ?Number,\n}\n\nexport class UserPartyCounters\n{\n\t#userCountersLimit: ?Number = null;\n\t#container: ?HTMLDivElement = null;\n\t#counterNode: ?HTMLSpanElement = null;\n\t#isShowLimitPopup: Boolean = false;\n\t#incrementTariffLinkContainer: ?HTMLAnchorElement = null;\n\n\tconstructor(options: UserPartyCountersOption)\n\t{\n\t\tthis.#userCountersLimit = options.userCountersLimit;\n\t\tthis.#counterNode = Tag.render`<span class=\"sign-b2e-settings__user-party-counter-select\">0</span>`;\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__user-party-counter\">\n\t\t\t\t${this.#getIcon().render()}\n\t\t\t\t<div class=\"sign-b2e-settings__user-party-counter_limit-block\">\n\t\t\t\t\t${this.#counterNode}\n\t\t\t\t\t${this.#getLimitContainer()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#container;\n\t}\n\n\t#getIcon(): Icon\n\t{\n\t\treturn new Icon({\n\t\t\ticon: Main.PERSONS_2,\n\t\t\tsize: 18,\n\t\t\tcolor: getComputedStyle(document.body).getPropertyValue('--ui-color-palette-gray-60'),\n\t\t});\n\t}\n\n\t#getLimitContainer(): HTMLElement | null\n\t{\n\t\tif (!this.#userCountersLimit)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Tag.render`<span class=\"sign-b2e-settings__user-party-counter-limit\">/ ${Number(this.#userCountersLimit)}</span>`;\n\t}\n\n\tgetCount(): number\n\t{\n\t\treturn Number(this.#counterNode.textContent);\n\t}\n\n\tupdate(size: number): void\n\t{\n\t\tthis.#counterNode.textContent = size;\n\t\tif (!Type.isNumber(this.#userCountersLimit))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (size > this.#userCountersLimit)\n\t\t{\n\t\t\tif (!Dom.hasClass(this.#container, '--alert'))\n\t\t\t{\n\t\t\t\tif (!this.#incrementTariffLinkContainer)\n\t\t\t\t{\n\t\t\t\t\tDom.append(this.#getContainerForIncrementTariff(), this.#container);\n\t\t\t\t}\n\t\t\t\tDom.addClass(this.#container, '--alert');\n\t\t\t}\n\n\t\t\tif (!this.#isShowLimitPopup)\n\t\t\t{\n\t\t\t\tconst guide = new Guide({\n\t\t\t\t\tid: 'sign-b2e-tariff-limit-user-party-counter-tour',\n\t\t\t\t\tonEvents: true,\n\t\t\t\t\tautoSave: false,\n\t\t\t\t\tadjustPopupPosition: this.#adjustPopupWithCenterAngle.bind(this),\n\t\t\t\t\tsteps: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttarget: this.#container,\n\t\t\t\t\t\t\ttitle: Loc.getMessage('SIGN_V2_B2E_USER_PARTY_COUNTER_LIMIT_TITLE'),\n\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_V2_B2E_USER_PARTY_COUNTER_LIMIT_MESSAGE'),\n\t\t\t\t\t\t\tcondition: {\n\t\t\t\t\t\t\t\ttop: true,\n\t\t\t\t\t\t\t\tbottom: false,\n\t\t\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tlink: 'javascript:void(0);',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpopupOptions: {\n\t\t\t\t\t\twidth: 450,\n\t\t\t\t\t\tautoHide: false,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tguide.getLink().setAttribute('onclick', \"BX.PreventDefault();top.BX.UI.InfoHelper.show('limit_office_e_signature');\");\n\t\t\t\tguide.start();\n\n\t\t\t\tthis.#isShowLimitPopup = true;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.#container, '--alert');\n\t\t}\n\t}\n\n\t#adjustPopupWithCenterAngle(popup: Popup): void\n\t{\n\t\tconst popupWidth = popup.getWidth();\n\t\tconst { left: startX } = this.#container.getBoundingClientRect();\n\t\tconst bindElementCenter = startX + this.#container.offsetWidth / 2;\n\t\tconst popupCenter = startX + popup.getPopupContainer().offsetWidth / 2;\n\t\tconst offsetLeft = Popup.getOption('angleLeftOffset') + bindElementCenter - popupCenter;\n\t\tpopup.setOffset({ offsetLeft });\n\t\tpopup.adjustPosition();\n\t\tconst { angleArrowElement } = popup;\n\t\tpopup.setAngle({ offset: (popupWidth - angleArrowElement.parentElement.offsetWidth) / 2 });\n\t}\n\n\t#getContainerForIncrementTariff(): HTMLElement\n\t{\n\t\tconst rightChevron = new Icon({\n\t\t\ticon: Actions.CHEVRON_RIGHT,\n\t\t\tsize: 18,\n\t\t\tcolor: getComputedStyle(document.body).getPropertyValue('--ui-color-link-primary-base'),\n\t\t});\n\t\tthis.#incrementTariffLinkContainer = Tag.render`\n\t\t\t<a class=\"sign-b2e-settings__user-party-counter-increment-tariff\" href=\"javascript:void(0);\" onclick=\"BX.PreventDefault();top.BX.UI.InfoHelper.show('limit_office_e_signature');\">\n\t\t\t\t -\n\t\t\t\t <div class=\"sign-b2e-settings__user-party-counter-increment-tariff_text\">\n\t\t\t\t\t${Loc.getMessage('SIGN_V2_B2E_USER_PARTY_COUNTER_LIMIT_INCREMENT_TARIFF')}\n\t\t\t\t </div>\n\t\t\t\t ${rightChevron.render()}\n\t\t\t</a>\n\t\t`;\n\n\t\treturn this.#incrementTariffLinkContainer;\n\t}\n}\n"],"names":["UserPartyCounters","constructor","options","userCountersLimit","Tag","render","getLayout","getCount","Number","textContent","update","size","Type","isNumber","Dom","hasClass","append","addClass","guide","Guide","id","onEvents","autoSave","adjustPopupPosition","bind","steps","target","title","Loc","getMessage","text","condition","top","bottom","color","link","popupOptions","width","autoHide","getLink","setAttribute","start","removeClass","Icon","icon","Main","PERSONS_2","getComputedStyle","document","body","getPropertyValue","popup","popupWidth","getWidth","left","startX","getBoundingClientRect","bindElementCenter","offsetWidth","popupCenter","getPopupContainer","offsetLeft","Popup","getOption","setOffset","adjustPosition","angleArrowElement","setAngle","offset","parentElement","rightChevron","Actions","CHEVRON_RIGHT"],"mappings":"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"}