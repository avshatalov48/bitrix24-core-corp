{"version":3,"file":"hcm-link-company-selector.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Loc, Tag, Type, Dom } from 'main.core';\nimport { Dialog } from 'ui.entity-selector';\nimport { Api } from 'sign.v2.api';\nimport { Loader } from 'main.loader';\nimport { CompanyConnectPage } from 'humanresources.hcmlink.company-connect-page';\n\nimport './style.css';\n\nexport class HcmLinkCompanySelector\n{\n\t#isAvailable: boolean = false;\n\t#companyId: number | null = null;\n\t#selectedId: number | null = null;\n\t#lastSavedId: ?number = undefined;\n\n\t#dialog: Dialog | null = null;\n\t#loader: Loader | null = null;\n\tisLayoutExisted: boolean = false;\n\n\t#api: Api;\n\n\t#ui = {\n\t\tcontainer: HTMLDivElement = null,\n\t\tactive: HTMLButtonElement = null,\n\t\tinactive: HTMLButtonElement = null,\n\t\tunselect: HTMLButtonElement = null,\n\t\tdropdownButton: HTMLSpanElement = null,\n\t\tloaderContainer: HTMLElement = null,\n\t\tinfo: {\n\t\t\ttitle: HTMLSpanElement = null,\n\t\t\tsubtitle: HTMLDivElement = null,\n\t\t},\n\t};\n\n\t#integrationList: Array<{ id: number, title: string, subtitle: string }> = [];\n\n\tconstructor()\n\t{\n\t\tthis.#api = new Api();\n\t}\n\n\tsetAvailability(value: boolean): void\n\t{\n\t\tthis.#isAvailable = value;\n\t}\n\n\tsetCompanyId(id: number | null): void\n\t{\n\t\tif (!this.#isAvailable)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#companyId === id && this.isLayoutExisted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#companyId = id;\n\t\tthis.#selectedId = null;\n\n\t\tthis.#dialog = null;\n\n\t\tif (!this.#companyId)\n\t\t{\n\t\t\tthis.hide();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#showLoader();\n\t\tthis.#api.checkCompanyHrIntegration(this.#companyId)\n\t\t\t.then((data) => {\n\t\t\t\tthis.#getLoader().destroy();\n\n\t\t\t\tif (data.length <= 0)\n\t\t\t\t{\n\t\t\t\t\tthis.#ui.inactive.style.display = 'flex';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#integrationList = data;\n\n\t\t\t\tif (this.#lastSavedId === null)\n\t\t\t\t{\n\t\t\t\t\tthis.#lastSavedId = undefined;\n\t\t\t\t\tthis.#ui.unselect.style.display = 'flex';\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet itemToSelect = data[0];\n\t\t\t\tif (this.#lastSavedId)\n\t\t\t\t{\n\t\t\t\t\titemToSelect = this.#integrationList.find(\n\t\t\t\t\t\t(item) => item.id === this.#lastSavedId,\n\t\t\t\t\t) ?? data[0];\n\t\t\t\t}\n\n\t\t\t\tthis.#select(itemToSelect);\n\t\t\t\tthis.#ui.active.style.display = 'flex';\n\t\t\t})\n\t\t;\n\t}\n\n\tsetLastSavedId(integrationId: number | null): void\n\t{\n\t\tthis.#lastSavedId = integrationId;\n\t}\n\n\tgetSelectedId(): number | null\n\t{\n\t\tif (!this.#selectedId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.#selectedId;\n\t}\n\n\thide(): void\n\t{\n\t\tif (!this.#isAvailable && !this.isLayoutExisted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.hide(this.#ui.container);\n\t\tthis.#dialog?.hide();\n\t}\n\n\tshow(): void\n\t{\n\t\tif (!this.#isAvailable && !this.isLayoutExisted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(this.#ui.container, { display: 'flex' });\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.#ui.container)\n\t\t{\n\t\t\treturn this.#ui.container;\n\t\t}\n\n\t\tthis.#ui.info.title = Tag.render`\n\t\t\t<span class=\"sign-document-b2e-company__hcmlink-select-text\"></span>\n\t\t`;\n\n\t\tthis.#ui.info.subtitle = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__hcmlink-select-subtitle\"></div>\n\t\t`;\n\n\t\tthis.#ui.active = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__hcmlink-select --active\" data-companies=\"[]\">\n\t\t\t\t<div class=\"sign-document-b2e-company__hcmlink-name-container\">\n\t\t\t\t\t<div class=\"sign-document-b2e-company__hcmlink-select-header\">\n\t\t\t\t\t\t${this.#ui.info.title}\n\t\t\t\t\t\t<span class=\"sign-document-b2e-company-info-dropdown-btn\"\n\t\t\t\t\t\t\tonclick=\"${() => {\n\t\t\tthis.#showDialog();\n\t\t}}\"></span>\n\t\t\t\t\t\t${this.#ui.dropdownButton}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#ui.info.subtitle}\t\n\t\t\t\t</div>\t\t\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#ui.unselect = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__hcmlink-select --inactive\">\n\t\t\t\t<div class=\"sign-document-b2e-company__hcmlink-name-container\">\n\t\t\t\t\t<span class=\"sign-document-b2e-company__hcmlink-select-text\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_B2E_INTEGRATION_INTEGRATION_UNSELECTED')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<button class=\"ui-btn ui-btn-xs ui-btn-round ui-btn-light-border\"\n\t\t\t\t\tonclick=\"${() => this.#showDialog()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANIES_SELECT_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#ui.inactive = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__hcmlink-select --inactive\">\n\t\t\t\t<div class=\"sign-document-b2e-company__hcmlink-name-container\">\n\t\t\t\t\t<span class=\"sign-document-b2e-company__hcmlink-select-text\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANY_INTEGRATION_TITLE')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<button class=\"ui-btn ui-btn-xs ui-btn-round ui-btn-light-border\"\n\t\t\t\t\tonclick=\"${() => this.#showIntegrationMarketSlider()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANY_INTEGRATION_BUTTON_CONNECT')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t\tthis.#ui.loaderContainer = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__hcmlink-loader\"><div>\n\t\t`;\n\n\t\tthis.#ui.icon = Tag.render`<div class=\"sign-document-b2e-company__hcmlink-info-img\"></div>`;\n\t\tthis.#ui.container = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__hcmlink\">\n\t\t\t\t${this.#ui.icon}\n\t\t\t\t${this.#ui.loaderContainer}\n\t\t\t\t${this.#ui.active}\n\t\t\t\t${this.#ui.inactive}\n\t\t\t\t${this.#ui.unselect}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.hide();\n\n\t\treturn this.#ui.container;\n\t}\n\n\t#select(item: { id: number } | null): void\n\t{\n\t\tthis.#selectedId = item?.id ?? null;\n\t\tBX.hide(this.#ui.unselect);\n\t\tBX.hide(this.#ui.inactive);\n\t\tthis.#ui.active.style.display = 'flex';\n\t\tthis.#setIntegrationTitle(this.#selectedId);\n\t\tDom.addClass(this.#ui.icon, '--active');\n\t}\n\n\t#deselect(item: { id: number } | null): void\n\t{\n\t\tDom.removeClass(this.#ui.icon, '--active');\n\t\tthis.#selectedId = null;\n\t\tBX.hide(this.#ui.active);\n\t\tBX.hide(this.#ui.inactive);\n\t\tthis.#ui.unselect.style.display = 'flex';\n\t}\n\n\t#showDialog(): void\n\t{\n\t\tthis.#getDialog()?.show();\n\t}\n\n\t#getDialog(): Dialog\n\t{\n\t\tif (this.#dialog)\n\t\t{\n\t\t\treturn this.#dialog;\n\t\t}\n\n\t\tconst items = this.#integrationList.map((integration) => {\n\t\t\treturn {\n\t\t\t\tid: integration.id,\n\t\t\t\tentityId: 'hrm-integration',\n\t\t\t\ttitle: integration.title,\n\t\t\t\tsubtitle: integration.subtitle,\n\t\t\t\ttabs: 'hrm-integrations',\n\t\t\t};\n\t\t});\n\n\t\tthis.#dialog = new Dialog({\n\t\t\ttargetNode: this.#ui.container,\n\t\t\twidth: 425,\n\t\t\theight: 363,\n\t\t\titems,\n\t\t\ttabs: [\n\t\t\t\t{ id: 'hrm-integrations', title: Loc.getMessage('SIGN_B2E_INTEGRATION_TAB') },\n\t\t\t],\n\t\t\tshowAvatars: false,\n\t\t\tdropdownMode: true,\n\t\t\tmultiple: false,\n\t\t\tenableSearch: true,\n\t\t\tevents: {\n\t\t\t\t'Item:OnSelect': (event) => {\n\t\t\t\t\tthis.#select(event.data.item);\n\t\t\t\t},\n\t\t\t\t'Item:OnDeselect': (event) => {\n\t\t\t\t\tthis.#deselect(event.data.item);\n\t\t\t\t},\n\t\t\t},\n\t\t\thideOnSelect: true,\n\t\t\thideOnDeselect: true,\n\t\t});\n\n\t\tif (this.#selectedId)\n\t\t{\n\t\t\tconst item = this.#dialog.getItems().find((item) => item.id === this.#selectedId);\n\t\t\titem?.select();\n\t\t}\n\n\t\treturn this.#dialog;\n\t}\n\n\t#getLoader(): Loader\n\t{\n\t\tif (this.#loader)\n\t\t{\n\t\t\treturn this.#loader;\n\t\t}\n\n\t\tthis.#loader = new BX.Loader({\n\t\t\ttarget: this.#ui.container,\n\t\t\tmode: 'inline',\n\t\t\tsize: 40,\n\t\t});\n\n\t\treturn this.#loader;\n\t}\n\n\t#showLoader(): void\n\t{\n\t\tBX.hide(this.#ui.active);\n\t\tBX.hide(this.#ui.inactive);\n\t\tBX.hide(this.#ui.unselect);\n\t\tthis.#getLoader().show(this.#ui.loaderContainer);\n\t\tthis.#ui.container.style.display = 'flex';\n\t\tDom.removeClass(this.#ui.icon, '--active');\n\t}\n\n\t// refactor later\n\t#showIntegrationMarketSlider(): void\n\t{\n\t\tCompanyConnectPage.openSlider({}, {\n\t\t\tonCloseHandler: () => this.setCompanyId(this.#companyId),\n\t\t});\n\t}\n\n\t#setIntegrationTitle(itemId: number | null): void\n\t{\n\t\tif (Type.isNumber(itemId))\n\t\t{\n\t\t\tconst item = this.#integrationList.find((integration) => integration.id === itemId);\n\t\t\tif (\n\t\t\t\titem\n\t\t\t\t&& Type.isDomNode(this.#ui.info.title)\n\t\t\t\t&& Type.isDomNode(this.#ui.info.subtitle)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.#ui.info.title.innerHTML = item?.title ?? '';\n\t\t\t\tthis.#ui.info.subtitle.innerHTML = item?.subtitle?.toUpperCase() ?? '';\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["item","babelHelpers","id","BX","hide","unselect","inactive","active","style","display","this","Dom","addClass","icon","removeClass","_babelHelpers$classPr3","show","items","map","integration","entityId","title","subtitle","tabs","Dialog","targetNode","container","width","height","Loc","getMessage","showAvatars","dropdownMode","multiple","enableSearch","events","Item:OnSelect","event","data","Item:OnDeselect","hideOnSelect","hideOnDeselect","getItems","find","select","Loader","target","mode","size","loaderContainer","CompanyConnectPage","openSlider","onCloseHandler","setCompanyId","itemId","Type","isNumber","isDomNode","info","innerHTML","_item$subtitle","toUpperCase","constructor","Object","value","writable","undefined","isLayoutExisted","HTMLDivElement","HTMLButtonElement","dropdownButton","HTMLSpanElement","HTMLElement","Api","setAvailability","checkCompanyHrIntegration","then","destroy","length","itemToSelect","setLastSavedId","integrationId","getSelectedId","_babelHelpers$classPr2","render","Tag"],"mappings":"oJAMqB,46BAiVpB,WA5HQA,GACR,MACCC,kEAAmBD,SAAAA,EAAME,MAAM,KAC/BC,GAAGC,KAAKH,mDAASI,UACjBF,GAAGC,KAAKH,mDAASK,UACjBL,mDAASM,OAAOC,MAAMC,QAAU,OAChCR,2FAA0BS,YAC1BC,MAAIC,SAASX,mDAASY,KAAM,YAC5B,WAESb,GAETW,MAAIG,YAAYb,mDAASY,KAAM,YAC/BZ,mDAAmB,KACnBE,GAAGC,KAAKH,mDAASM,QACjBJ,GAAGC,KAAKH,mDAASK,UACjBL,mDAASI,SAASG,MAAMC,QAAU,OAClC,aAGD,sEACCM,EAAmBC,OACnB,aAIA,2CAAIN,WAEH,+CAAOA,WAGR,MAAMO,EAAQhB,mDAAsBiB,IAAKC,IACjC,CACNjB,GAAIiB,EAAYjB,GAChBkB,SAAU,kBACVC,MAAOF,EAAYE,MACnBC,SAAUH,EAAYG,SACtBC,KAAM,sBA4BR,GAxBAtB,mDAAe,IAAIuB,SAAO,CACzBC,WAAYxB,mDAASyB,UACrBC,MAAO,IACPC,OAAQ,IACRX,MAAAA,EACAM,KAAM,CACL,CAAErB,GAAI,mBAAoBmB,MAAOQ,MAAIC,WAAW,8BAEjDC,aAAa,EACbC,cAAc,EACdC,UAAU,EACVC,cAAc,EACdC,OAAQ,CACPC,gBAAkBC,IACjBpC,mDAAaoC,EAAMC,KAAKtC,OAEzBuC,kBAAoBF,IACnBpC,mDAAeoC,EAAMC,KAAKtC,QAG5BwC,cAAc,EACdC,gBAAgB,4CAGb/B,WACJ,CACC,MAAMV,EAAOC,mDAAayC,WAAWC,KAAM3C,GAASA,EAAKE,6CAAOQ,kBAChEV,GAAAA,EAAM4C,SAGP,+CAAOlC,WACP,aAIA,+CAAIA,aAKJT,mDAAe,IAAIE,GAAG0C,OAAO,CAC5BC,OAAQ7C,mDAASyB,UACjBqB,KAAM,SACNC,KAAM,8CANCtC,WAUR,aAIAP,GAAGC,KAAKH,mDAASM,QACjBJ,GAAGC,KAAKH,mDAASK,UACjBH,GAAGC,KAAKH,mDAASI,UACjBJ,qDAAkBe,KAAKf,mDAASgD,iBAChChD,mDAASyB,UAAUlB,MAAMC,QAAU,OACnCE,MAAIG,YAAYb,mDAASY,KAAM,YAC/B,aAKAqC,qBAAmBC,WAAW,GAAI,CACjCC,eAAgB,IAAM1C,KAAK2C,qDAAa3C,cAEzC,WAEoB4C,GAEpB,GAAIC,OAAKC,SAASF,GAClB,CACC,MAAMtD,EAAOC,mDAAsB0C,KAAMxB,GAAgBA,EAAYjB,KAAOoD,GAM5E,UALA,GACCtD,GACGuD,OAAKE,UAAUxD,mDAASyD,KAAKrC,QAC7BkC,OAAKE,UAAUxD,mDAASyD,KAAKpC,UAGhCrB,mDAASyD,KAAKrC,MAAMsC,yBAAY3D,SAAAA,EAAMqB,SAAS,GAC/CpB,mDAASyD,KAAKpC,SAASqC,yBAAY3D,YAAAA,EAAMsB,iBAANsC,EAAgBC,iBAAiB,6BA3UjE,MA4BNC,cACAC,8BAAAC,UAAAD,8BAAAC,UAAAD,8BAAAC,UAAAD,8BAAAC,UAAAD,8BAAAC,UAAAD,8BAAAC,UAAAD,8BAAAC,UAAAD,8BAAAC,UAAAD,8BAAAE,YAAAD,OA3BwB,IAAKD,8BAAAE,YAAAD,MACD,OAAID,8BAAAE,YAAAD,MACH,OAAID,8BAAAE,YAAAD,WACTE,IAASH,8BAAAE,YAAAD,MAER,OAAID,8BAAAE,YAAAD,MACJ,OAAItD,KAC7ByD,iBAA2B,EAAKJ,8BAAAE,YAAAD,eAAAD,8BAAAE,YAAAD,MAI1B,CACLtC,UAAW0C,eAAiB,KAC5B7D,OAAQ8D,kBAAoB,KAC5B/D,SAAU+D,kBAAoB,KAC9BhE,SAAUgE,kBAAoB,KAC9BC,eAAgBC,gBAAkB,KAClCtB,gBAAiBuB,YAAc,KAC/Bd,KAAM,CACLrC,MAAOkD,gBAAkB,KACzBjD,SAAU8C,eAAiB,SAE5BL,8BAAAE,YAAAD,MAE0E,KAI1E/D,mDAAY,IAAIwE,MAGjBC,gBAAgBV,GAEf/D,mDAAoB+D,EAGrBX,aAAanD,2CAEPQ,aAKDT,qDAAoBC,GAAMQ,KAAKyD,kBAKnClE,mDAAkBC,EAClBD,mDAAmB,KAEnBA,mDAAe,6CAEVS,YAOLT,qDACAA,mDAAU0E,kEAA0BjE,YAClCkE,KAAMtC,IAGN,GAFArC,qDAAkB4E,UAEdvC,EAAKwC,QAAU,EAGlB,YADA7E,mDAASK,SAASE,MAAMC,QAAU,QAMnC,GAFAR,mDAAwBqC,EAEE,OAAtBrC,mDAKH,OAHAA,wDAAoBiE,OACpBjE,mDAASI,SAASG,MAAMC,QAAU,QAKnC,IAAIsE,EAAezC,EAAK,GAExB,8CADI5B,aAEHqE,WAAe9E,mDAAsB0C,KACnC3C,GAASA,EAAKE,6CAAOQ,eAClB4B,EAAK,IAGXrC,mDAAa8E,GACb9E,mDAASM,OAAOC,MAAMC,QAAU,UAnCjCC,KAAKN,SAwCP4E,eAAeC,GAEdhF,mDAAoBgF,EAGrBC,gBAEC,+CAAKxE,mDAKEA,WAHC,KAMTN,OACA,+CACMM,YAAsBA,KAAKyD,mBAKhChE,GAAGC,KAAKH,mDAASyB,yEACjByD,EAAc/E,QAGfY,gDAEMN,YAAsBA,KAAKyD,kBAKhCxD,MAAIH,MAAMP,mDAASyB,UAAW,CAAEjB,QAAS,SAG1C2E,SAEC,OAAInF,mDAASyB,YAKbzB,mDAASyD,KAAKrC,MAAQgE,MAAID,cAAO;;MAIjCnF,mDAASyD,KAAKpC,SAAW+D,MAAID,cAAO;;MAIpCnF,mDAASM,OAAS8E,MAAID,cAAO;;;;QAIzB;;kBAEU;QAGV;;OAED;;;KAPGnF,mDAASyD,KAAKrC,MAEJ,KACfpB,sDAEKA,mDAASqE,eAEVrE,mDAASyD,KAAKpC,UAKnBrB,mDAASI,SAAWgF,MAAID,cAAO;;;;QAI3B;;;;gBAIQ;OACT;;;KALGvD,MAAIC,WAAW,+CAIP,4CAAMpB,aACfmB,MAAIC,WAAW,qCAKpB7B,mDAASK,SAAW+E,MAAID,cAAO;;;;QAI3B;;;;gBAIQ;OACT;;;KALGvD,MAAIC,WAAW,sCAIP,4CAAMpB,aACfmB,MAAIC,WAAW,gDAIpB7B,mDAASgD,gBAAkBoC,MAAID,cAAO;;MAItCnF,mDAASY,KAAOwE,MAAID,cAAO,oEAC3BnF,mDAASyB,UAAY2D,MAAID,cAAO;;MAE9B;MACA;MACA;MACA;MACA;;KAJEnF,mDAASY,KACTZ,mDAASgD,gBACThD,mDAASM,OACTN,mDAASK,SACTL,mDAASI,UAIbK,KAAKN,QArEGH,mDAASyB"}