{"version":3,"file":"company-selector.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Dom, Event, Loc, Tag, Text as TextFormat, Type, Uri } from 'main.core';\nimport { MemoryCache } from 'main.core.cache';\nimport { EventEmitter } from 'main.core.events';\nimport { DateTimeFormat } from 'main.date';\nimport { Loader } from 'main.loader';\nimport { Menu } from 'main.popup';\nimport { Guide } from 'sign.tour';\nimport type { B2eCompanyList, Company, Provider, ProviderCodeType } from 'sign.v2.api';\nimport { Api } from 'sign.v2.api';\nimport { HcmLinkCompanySelector } from 'sign.v2.b2e.hcm-link-company-selector';\nimport { type Scheme, SchemeType } from 'sign.v2.b2e.scheme-selector';\nimport { CompanyEditor, CompanyEditorMode, DocumentEntityTypeId, EditorTypeGuid } from 'sign.v2.company-editor';\nimport type { DocumentInitiatedType } from 'sign.v2.document-setup';\nimport { DocumentInitiated } from 'sign.v2.document-setup';\nimport { Helpdesk, Link } from 'sign.v2.helper';\nimport { Alert, AlertColor, AlertSize } from 'ui.alerts';\nimport { Dialog } from 'ui.entity-selector';\nimport { Label, LabelColor } from 'ui.label';\n\nimport './style.css';\n\nexport type { ProviderCodeType };\nexport const ProviderCode: Readonly<Record<string, ProviderCodeType>> = Object.freeze({\n\tgoskey: 'goskey',\n\tsesCom: 'ses-com',\n\tsesRu: 'ses-ru',\n\texternal: 'external',\n});\n\ntype CompanyData = {\n\tid: ?number,\n\tprovider: ?Provider\n};\n\nexport type CompanySelectorOptions = {\n\tcompanyId: ?number,\n\tentityId: number;\n\tregion: string;\n\tdocumentInitiatedType?: DocumentInitiatedType;\n\tloadCompanyPromise?: Promise<B2eCompanyList>;\n\tcanCreateCompany?: boolean;\n\tcanEditCompany?: boolean;\n\tisCompaniesDeselectable?: boolean,\n\thcmLinkAvailable: boolean,\n\tneedOpenCrmSaveAndEditCompanySliders?: boolean,\n};\n\nconst allowedSignatureProviders: Array<ProviderCodeType> = ['goskey', 'external', 'ses-ru', 'ses-com'];\nconst sesComLearnMoreLink = new Uri('https://www.bitrix24.com/terms/esignature-for-hr-rules.php');\n\nexport const HelpdeskCodes: $ReadOnly<{ [key: string]: string }> = Object.freeze({\n\tHowToChooseProvider: '19740650',\n\tGoskeyDetails: '19740688',\n\tSesRuDetails: '19740668',\n\tSesComDetails: '19740668',\n\tTaxcomDetails: '19740696',\n\tGoskeyApiKey: '19740816',\n});\n\nexport class CompanySelector extends EventEmitter\n{\n\tevents = {\n\t\tonCompaniesLoad: 'onCompaniesLoad',\n\t\tonSelect: 'onSelect',\n\t};\n\n\t#api: Api;\n\t#layoutCache: MemoryCache<HTMLElement> = new MemoryCache();\n\t#companyList: Array<Company> = [];\n\n\t#reloadDelayForHide: Number = 1000;\n\n\t#company: CompanyData = {\n\t\tid: null,\n\t\tprovider: {\n\t\t\tcode: null,\n\t\t\tuid: null,\n\t\t\ttimestamp: null,\n\t\t},\n\t};\n\n\t#loader: Loader = null;\n\t#providerMenu: Dialog = null;\n\t#dialog: Dialog = null;\n\t#showTaxId: boolean = true;\n\t#integrationSelector: HcmLinkCompanySelector;\n\n\t#ui = {\n\t\tcontainer: HTMLDivElement = null,\n\t\tinfo: {\n\t\t\tcontainer: HTMLDivElement = null,\n\t\t\ttitle: {\n\t\t\t\tcontainer: HTMLDivElement = null,\n\t\t\t\theader: {\n\t\t\t\t\tcontainer: HTMLDivElement = null,\n\t\t\t\t\tname: HTMLDivElement = null,\n\t\t\t\t\tdropdownButton: HTMLDivElement = null,\n\t\t\t\t},\n\t\t\t\trqInn: HTMLDivElement = null,\n\t\t\t},\n\t\t\teditButton: HTMLDivElement = null,\n\t\t\tsetRqInnButton: HTMLButtonElement = null,\n\t\t},\n\t\tselect: {\n\t\t\tcontainer: HTMLDivElement = null,\n\t\t\ttext: HTMLSpanElement = null,\n\t\t\tbutton: HTMLButtonElement = null,\n\t\t},\n\t\tprovider: {\n\t\t\tcontainer: HTMLDivElement = null,\n\t\t\tinfo: HTMLParagraphElement = null,\n\t\t\tconnected: {\n\t\t\t\tcontainer: HTMLDivElement = null,\n\t\t\t\tnameContainer: HTMLElement,\n\t\t\t\tnameLabelContainer: HTMLElement,\n\t\t\t\tname: HTMLSpanElement,\n\t\t\t\tdescription: HTMLSpanElement,\n\t\t\t\tselectDropdownButton: HTMLSpanElement,\n\t\t\t\tconnectDropdownButton: HTMLSpanElement,\n\t\t\t},\n\t\t\tdisconnected: {\n\t\t\t\tcontainer: HTMLDivElement = null,\n\t\t\t\temptyProvider: HTMLSpanElement = null,\n\t\t\t\tbutton: HTMLButtonElement = null,\n\t\t\t},\n\t\t\tunset: {\n\t\t\t\tcontainer: HTMLDivElement = null,\n\t\t\t\ttext: HTMLSpanElement = null,\n\t\t\t\tbutton: HTMLButtonElement = null,\n\t\t\t},\n\t\t},\n\t};\n\n\t#isSubscribedIframeCloseEvent = false;\n\t#isSubscribedIframeConnectedEvent = false;\n\t#registerIframe: HTMLElement | null;\n\t#iframeConnectInterval = null;\n\t#options: CompanySelectorOptions;\n\t#loadPromise: Promise<void>;\n\t#providerExpiresDaysToShowInfo: Number = 45;\n\n\tconstructor(options: CompanySelectorOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.B2e.CompanySelector');\n\t\tthis.#api = new Api();\n\t\tthis.#integrationSelector = new HcmLinkCompanySelector();\n\t\tthis.#integrationSelector.setAvailability(options.hcmLinkAvailable);\n\t\tthis.#options = options;\n\t\tthis.#ui.provider.container = this.getProviderLayout();\n\t\tthis.#ui.container = this.getLayout();\n\t\tthis.#setEmptyState();\n\t\tthis.#bindEvents();\n\t\tthis.#loadPromise = this.#load();\n\t}\n\n\t#showLoader(): void\n\t{\n\t\tBX.hide(this.#ui.info.container);\n\t\tBX.hide(this.#ui.select.container);\n\t\tthis.#getLoader().show(this.#ui.container);\n\t}\n\n\t#hideLoader(): void\n\t{\n\t\tthis.#setEmptyState();\n\t\tthis.#getLoader().hide();\n\t}\n\n\tasync load(companyUid: string): Promise<void>\n\t{\n\t\tawait this.#loadPromise;\n\t\tconst company = this.#companyList.find((company) => {\n\t\t\treturn company.providers.some((provider) => {\n\t\t\t\treturn provider.uid === companyUid;\n\t\t\t});\n\t\t});\n\t\tif (Type.isUndefined(company))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.#company.id = company.id;\n\t\tthis.#integrationSelector.setCompanyId(this.#company.id);\n\t\tthis.#updateDialogItems();\n\t\tthis.#selectProvider(companyUid);\n\t}\n\n\tsetOptions(options: Partial<CompanySelectorOptions>): void\n\t{\n\t\tthis.#options = { ...this.#options, ...options };\n\t}\n\n\tgetProviderLayout(): HTMLElement\n\t{\n\t\tif (this.#ui.provider.container)\n\t\t{\n\t\t\treturn this.#ui.provider.container;\n\t\t}\n\n\t\tthis.#ui.provider.disconnected.emptyProvider = Tag.render`\n\t\t\t<span class=\"sign-document-b2e-company-select-text\">\n\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANY_NOT_CONNECTED_PROVIDER_STATUS')}\n\t\t\t</span>\n\t\t`;\n\t\tthis.#ui.provider.disconnected.button = Tag.render`\n\t\t\t<button\n\t\t\t\tclass=\"ui-btn ui-btn-success ui-btn-xs ui-btn-round\"\n\t\t\t\tonclick=\"${() => this.#openProvidersConnectionSlider()}\"\n\t\t\t>\n\t\t\t\t${Loc.getMessage('SIGN_B2E_PROVIDER_CONNECT')}\n\t\t\t</button>\n\t\t`;\n\t\tthis.#ui.provider.disconnected.container = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company-select --provider\">\n\t\t\t\t${this.#ui.provider.disconnected.emptyProvider}\n\t\t\t\t${this.#ui.provider.disconnected.button}\n\t\t\t</div>\n\t\t`;\n\t\tthis.#ui.provider.connected.name = Tag.render`\n\t\t\t<span class=\"sign-document-b2e-company__provider_name\"></span>\n\t\t`;\n\t\tthis.#ui.provider.connected.nameLabelContainer = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__provider_name_label\"></div>\n\t\t`;\n\t\tthis.#ui.provider.connected.nameContainer = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__provider_name_container\">\n\t\t\t\t${this.#ui.provider.connected.name}\n\t\t\t\t${this.#ui.provider.connected.nameLabelContainer}\n\t\t\t</div>\n\t\t`;\n\t\tthis.#ui.provider.connected.description = Tag.render`\n\t\t\t<span class=\"sign-document-b2e-company__provider_descr\"></span>\n\t\t`;\n\t\tthis.#ui.provider.connected.selectDropdownButton = Tag.render`\n\t\t\t<span\n\t\t\t\tclass=\"sign-document-b2e-company-info-dropdown-btn sign-document-b2e-company__provider_dropdown-btn\"\n\t\t\t\tonclick=\"${() => this.#providerMenu.show()}\"\n\t\t\t></span>\n\t\t`;\n\t\tthis.#ui.provider.connected.connectDropdownButton = Tag.render`\n\t\t\t<span\n\t\t\t\tclass=\"sign-document-b2e-company-info-edit\"\n\t\t\t\tonclick=\"${() => this.#showConnectMenu()}\"\n\t\t\t></span>\n\t\t`;\n\t\tthis.#ui.provider.connected.container = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__provider_selected\">\n\t\t\t\t<div class=\"sign-document-b2e-company__provider_selected__external-image-container\">\n\t\t\t\t\t<img class=\"sign-document-b2e-company__provider_selected__external-img\"\n\t\t\t\t\t\treferrerpolicy=\"no-referrer\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t${this.#ui.provider.connected.nameContainer}\n\t\t\t\t\t${this.#ui.provider.connected.description}\n\t\t\t\t</div>\n\t\t\t\t${this.#ui.provider.connected.selectDropdownButton}\n\t\t\t\t${this.#ui.provider.connected.connectDropdownButton}\n\t\t\t</div>\n\t\t`;\n\t\tthis.#ui.provider.info = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__provider_info\"></div>\n\t\t`;\n\t\tthis.#ui.provider.unset.text = Tag.render`\n\t\t\t<span class=\"sign-document-b2e-company-select-text\">\n\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANY_NOT_SET_PROVIDER_STATUS')}\n\t\t\t</span>\n\t\t`;\n\t\tthis.#ui.provider.unset.button = Tag.render`\n\t\t\t<button\n\t\t\t\tclass=\"ui-btn ui-btn-success ui-btn-xs ui-btn-round\"\n\t\t\t\tonclick=\"${() => this.#providerMenu.show()}\"\n\t\t\t>\n\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANIES_SELECT_BUTTON')}\n\t\t\t</button>\n\t\t`;\n\t\tthis.#ui.provider.unset.container = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company-select --provider\">\n\t\t\t\t${this.#ui.provider.unset.text}\n\t\t\t\t${this.#ui.provider.unset.button}\n\t\t\t</div>\n\t\t`;\n\t\tthis.#ui.provider.container = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__provider\">\n\t\t\t\t<div class=\"sign-document-b2e-company__provider_content\">\n\t\t\t\t\t${this.#ui.provider.connected.container}\n\t\t\t\t\t${this.#ui.provider.disconnected.container}\n\t\t\t\t\t${this.#ui.provider.unset.container}\n\t\t\t\t</div>\n\t\t\t\t${this.#ui.provider.info}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#ui.provider.container;\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\tif (this.#ui.container)\n\t\t{\n\t\t\treturn this.#ui.container;\n\t\t}\n\n\t\tthis.#ui.info.title.header.dropdownButton = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company-info-dropdown-btn\"></div>\n\t\t`;\n\t\tthis.#ui.info.title.header.name = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company-info-name\"></div>\n\t\t`;\n\n\t\tif (this.#options.canEditCompany ?? true)\n\t\t{\n\t\t\tthis.#ui.info.editButton = Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-company-info-edit\"></div>\n\t\t\t`;\n\t\t\tthis.#ui.info.setRqInnButton = Tag.render`\n\t\t\t\t<button class=\"ui-btn ui-btn-xs ui-btn-round ui-btn-success\">\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANIES_CHANGE_INN_1')}\n\t\t\t\t</button>\n\t\t\t`;\n\t\t}\n\n\t\tthis.#ui.info.title.header.container = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company-info-header\">\n\t\t\t\t${this.#ui.info.title.header.name}\n\t\t\t\t${this.#getCompanyInfoLabelLayout()}\n\t\t\t\t${this.#ui.info.title.header.dropdownButton}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#ui.info.title.rqInn = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company-info-rq-inn\"></div>\n\t\t`;\n\t\tif (!this.#showTaxId)\n\t\t{\n\t\t\tthis.#ui.info.title.rqInn.style.display = 'none';\n\t\t}\n\t\tthis.#ui.info.title.container = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company-info-title\">\n\t\t\t\t${this.#ui.info.title.header.container}\n\t\t\t\t${this.#ui.info.title.rqInn}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#ui.info.container = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company-info\">\n\t\t\t\t<div class=\"sign-document-b2e-company-info-img\"></div>\n\t\t\t\t${this.#ui.info.title.container}\n\t\t\t\t${this.#ui.info.editButton}\n\t\t\t\t${this.#ui.info.setRqInnButton}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#ui.select.text = Tag.render`\n\t\t\t<span class=\"sign-document-b2e-company-select-text\">\n\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANIES_NOT_CHANGED')}\n\t\t\t</span>\n\t\t`;\n\t\tthis.#ui.select.button = Tag.render`\n\t\t\t<button class=\"ui-btn ui-btn-success ui-btn-xs ui-btn-round\">\n\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANIES_SELECT_BUTTON')}\n\t\t\t</button>\n\t\t`;\n\t\tthis.#ui.select.container = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company-select\">\n\t\t\t\t${this.#ui.select.text}\n\t\t\t\t${this.#ui.select.button}\n\t\t\t</div>\n\t\t`;\n\t\tconst requireCrmPermissionLayout = this.#options.needOpenCrmSaveAndEditCompanySliders\n\t\t\t? this.#getCompanySaveAndEditRequireCrmPermissionLayout()\n\t\t\t: ''\n\t\t;\n\t\tthis.#ui.container = Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"sign-document-b2e-company\">\n\t\t\t\t\t${this.#ui.select.container}\n\t\t\t\t\t${this.#ui.info.container}\n\t\t\t\t</div>\n\t\t\t\t${requireCrmPermissionLayout}\n\t\t\t</div>\n\t\t`;\n\n\t\tif (this.#options.hcmLinkAvailable)\n\t\t{\n\t\t\tDom.append(this.#integrationSelector.render(), this.#ui.container);\n\t\t}\n\n\t\treturn this.#ui.container;\n\t}\n\n\t#tryStartProviderTour(): void\n\t{\n\t\tconst guide = new Guide({\n\t\t\tid: 'sign-b2e-provider-tour',\n\t\t\tonEvents: true,\n\t\t\tautoSave: true,\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.#ui.provider.connected.selectDropdownButton,\n\t\t\t\t\ttitle: `\n\t\t\t\t\t\t<p class=\"sign-document-b2e-company__provider_tour-step-head\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_B2E_TOUR_HEAD')}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t`,\n\t\t\t\t\ttext: `\n\t\t\t\t\t\t<p class=\"sign-document-b2e-company__provider_tour-step-text\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_B2E_TOUR_TEXT')}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<span class=\"sign-document-b2e-company__provider_tour-step-icon\"></span>\n\t\t\t\t\t`,\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: true,\n\t\t\t\t\t\tbottom: false,\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tpopupOptions: {\n\t\t\t\twidth: 380,\n\t\t\t\tautoHide: true,\n\t\t\t\tclassName: 'sign-document-b2e-company__provider_popup-tour',\n\t\t\t\tcenterAngle: true,\n\t\t\t},\n\t\t});\n\t\tguide.startOnce();\n\t}\n\n\t#showConnectMenu()\n\t{\n\t\tconst menu = new Menu({\n\t\t\tbindElement: this.#ui.provider.connected.connectDropdownButton,\n\t\t\tcacheable: false,\n\t\t});\n\t\tmenu.addMenuItem({\n\t\t\ttext: Loc.getMessage('SIGN_B2E_PROVIDER_DISCONNECT'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.#disconnectCurrentProvider();\n\t\t\t\tmenu.close();\n\t\t\t},\n\t\t});\n\t\tmenu.show();\n\t}\n\n\t#setEmptyState(): void\n\t{\n\t\tBX.hide(this.#ui.info.container);\n\t\tBX.hide(this.#ui.provider.container);\n\t\tthis.#integrationSelector.hide();\n\t\tthis.#ui.select.container.style.display = 'flex';\n\t}\n\n\t#setInfoState(): void\n\t{\n\t\tthis.#ui.info.container.style.display = 'flex';\n\t\tBX.hide(this.#ui.select.container);\n\t}\n\n\tasync #load(): Promise<void>\n\t{\n\t\tthis.#showLoader();\n\t\tconst loadCompanyPromise = this.#options.loadCompanyPromise\n\t\t\t?? this.#api.loadB2eCompanyList(this.#options.documentInitiatedType ?? DocumentInitiated.company)\n\t\t;\n\n\t\tlet data = null;\n\t\ttry\n\t\t{\n\t\t\tdata = await loadCompanyPromise;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.#hideLoader();\n\t\t\tconsole.log(error);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#hideLoader();\n\t\tif (Type.isObject(data.companies) && Type.isArray(data.companies))\n\t\t{\n\t\t\tthis.#companyList = data.companies;\n\t\t\tthis.#showTaxId = Boolean(data?.showTaxId);\n\t\t\tthis.#updateDialogItems();\n\t\t\tthis.emit(this.events.onCompaniesLoad, { companies: this.#companyList });\n\t\t}\n\t}\n\n\t#getLoader(): Loader\n\t{\n\t\tif (this.#loader)\n\t\t{\n\t\t\treturn this.#loader;\n\t\t}\n\n\t\tthis.#loader = new BX.Loader({\n\t\t\ttarget: this.#ui.container,\n\t\t\tmode: 'inline',\n\t\t\tsize: 40,\n\t\t});\n\n\t\treturn this.#loader;\n\t}\n\n\t#getDialog(): Dialog\n\t{\n\t\tif (this.#dialog)\n\t\t{\n\t\t\treturn this.#dialog;\n\t\t}\n\n\t\tlet footer = null;\n\t\tif (this.#options.canCreateCompany ?? true)\n\t\t{\n\t\t\tfooter = Tag.render`\n\t\t\t\t<span\n\t\t\t\t\tclass=\"ui-selector-footer-link ui-selector-footer-link-add\"\n\t\t\t\t\tonclick=\"${() => this.#createCompany()}\"\n\t\t\t\t>\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_ADD_COMPANY')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t}\n\t\tthis.#dialog = new Dialog({\n\t\t\ttargetNode: this.#ui.container,\n\t\t\twidth: 425,\n\t\t\theight: 363,\n\t\t\titems: this.#companyList.map((company) => {\n\t\t\t\treturn {\n\t\t\t\t\tid: company.id,\n\t\t\t\t\tentityId: 'b2e-company',\n\t\t\t\t\ttitle: company.title,\n\t\t\t\t\ttabs: 'b2e-companies',\n\t\t\t\t\tdeselectable: this.#options.isCompaniesDeselectable ?? true,\n\t\t\t\t};\n\t\t\t}),\n\t\t\ttabs: [\n\t\t\t\t{ id: 'b2e-companies', title: Loc.getMessage('SIGN_B2E_COMPANIES_TAB') },\n\t\t\t],\n\t\t\tshowAvatars: false,\n\t\t\tdropdownMode: true,\n\t\t\tmultiple: false,\n\t\t\tenableSearch: true,\n\t\t\tevents: {\n\t\t\t\t'Item:OnSelect': (event) => {\n\t\t\t\t\tthis.#onCompanySelectedHandler(event);\n\t\t\t\t\tthis.#dialog.hide();\n\t\t\t\t},\n\t\t\t\t'Item:OnDeselect': (event) => {\n\t\t\t\t\tthis.#onCompanyDeselectedHandler(event);\n\t\t\t\t\tthis.#dialog.hide();\n\t\t\t\t},\n\t\t\t},\n\t\t\tfooter,\n\t\t});\n\n\t\treturn this.#dialog;\n\t}\n\n\t#getProviderMenu(): Dialog\n\t{\n\t\tif (this.#providerMenu)\n\t\t{\n\t\t\treturn this.#providerMenu;\n\t\t}\n\n\t\tthis.#providerMenu = new Dialog({\n\t\t\twidth: 425,\n\t\t\theight: 363,\n\t\t\ttargetNode: this.#ui.provider.container.firstElementChild,\n\t\t\titems: [],\n\t\t\tshowAvatars: true,\n\t\t\tdropdownMode: true,\n\t\t\tmultiple: false,\n\t\t\tautoHide: true,\n\t\t\ttabs: [\n\t\t\t\t{ id: 'b2e-providers', title: Loc.getMessage('SIGN_B2E_PROVIDERS_TAB') },\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:OnSelect': ({ data }) => {\n\t\t\t\t\tthis.#onProviderSelect(data.item.id);\n\t\t\t\t},\n\t\t\t\t'Item:OnDeselect': () => this.#onProviderDeselect(),\n\t\t\t},\n\t\t\tfooter: this.#getProviderAddButton(),\n\t\t});\n\n\t\treturn this.#providerMenu;\n\t}\n\n\t#getProviderAddButton(): ?HTMLElement\n\t{\n\t\tconst company = this.#getCompanyById(this.#company?.id);\n\t\tif (company?.registerUrl)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<span\n\t\t\t\t\tclass=\"ui-selector-footer-link ui-selector-footer-link-add\"\n\t\t\t\t\tonclick=\"${() => {\n\t\t\t\t\t\tthis.#providerMenu.hide();\n\t\t\t\t\t\tthis.#openProvidersConnectionSlider();\n\t\t\t\t\t}}\"\n\t\t\t\t>\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_PROVIDER_CONNECT_SELECTOR')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#selectProvider(id: string): void\n\t{\n\t\tconst providerMenu = this.#getProviderMenu();\n\t\tconst providers = providerMenu.getItems();\n\t\tconst currentProvider = providers.find((provider) => provider.id === id);\n\t\tcurrentProvider?.select();\n\t}\n\n\t#onProviderDeselect(): void\n\t{\n\t\tthis.#ui.provider.unset.container.style.display = 'flex';\n\t\tBX.hide(this.#ui.provider.connected.container);\n\t\tthis.#renderProviderInfo();\n\t\tthis.#providerMenu.hide();\n\t\tthis.#company.provider = null;\n\t}\n\n\t#onProviderSelect(id: string): void\n\t{\n\t\tconst company = this.#getCompanyById(this.#company.id ?? 0);\n\t\tconst provider = company.providers.find((provider) => provider.uid === id);\n\t\tBX.hide(this.#ui.provider.unset.container);\n\t\tBX.show(this.#ui.provider.connected.container);\n\t\tBX.show(this.#ui.provider.info);\n\t\tthis.#chooseProvider(provider, company.rqInn);\n\t\tthis.#providerMenu.hide();\n\t}\n\n\t#resetProviderClasses()\n\t{\n\t\tconst providerClasses = allowedSignatureProviders.map((provider) => `--${provider}`);\n\t\tproviderClasses.push('--expired');\n\t\tDom.removeClass(this.#ui.provider.connected.container, providerClasses);\n\t}\n\n\t#resetProvider()\n\t{\n\t\tthis.#providerMenu = null;\n\t\tthis.#resetProviderClasses();\n\t}\n\n\t#updateProviderMenu(): void\n\t{\n\t\tthis.#resetProvider();\n\t\tconst menu = this.#getProviderMenu();\n\t\tconst company = this.#getCompanyById(this.#company.id);\n\n\t\tcompany.providers.forEach((provider: Provider) => {\n\t\t\tconst { providerName, description } = this.#getConnectedName(provider, company.rqInn);\n\n\t\t\tmenu.addItem({\n\t\t\t\tid: provider.uid,\n\t\t\t\ttitle: providerName,\n\t\t\t\tsubtitle: description,\n\t\t\t\tavatar: this.#getEntityAvatar(provider),\n\t\t\t\tentityId: 'b2e-provider',\n\t\t\t\ttabs: 'b2e-providers',\n\t\t\t\tbadges: this.#getEntityBadges(provider),\n\t\t\t});\n\t\t});\n\t\tconst [firstItem] = menu.getItems();\n\t\tfirstItem.select();\n\n\t\tconst nothingToSelect = !company?.registerUrl && company?.providers?.length < 2;\n\t\tthis.#ui.provider.connected.selectDropdownButton.style.display = nothingToSelect\n\t\t\t? 'none'\n\t\t\t: 'block'\n\t\t;\n\t}\n\n\t#renderProviderInfo(provider: Provider | null = null): void\n\t{\n\t\tconst code = provider?.code ?? '';\n\t\tDom.clean(this.#ui.provider.info);\n\t\tif (!provider)\n\t\t{\n\t\t\tconst firstParagraph = Tag.render`\n\t\t\t\t<p>\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANIES_UNSET_PROVIDER_PARAGRAPH_1')}\n\t\t\t\t</p>\n\t\t\t`;\n\t\t\tconst secondParagraph = Tag.render`\n\t\t\t\t<p>\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANIES_UNSET_PROVIDER_PARAGRAPH_2')}\n\t\t\t\t</p>\n\t\t\t`;\n\t\t\tconst thirdParagraph = Tag.render`\n\t\t\t\t<p>\n\t\t\t\t\t${Helpdesk.replaceLink(\n\t\t\t\tLoc.getMessage('SIGN_B2E_COMPANIES_UNSET_PROVIDER_MORE'),\n\t\t\t\tHelpdeskCodes.HowToChooseProvider,\n\t\t\t)}\n\t\t\t\t</p>\n\t\t\t`;\n\t\t\tDom.append(firstParagraph, this.#ui.provider.info);\n\t\t\tDom.append(secondParagraph, this.#ui.provider.info);\n\t\t\tDom.append(thirdParagraph, this.#ui.provider.info);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (code === ProviderCode.external)\n\t\t{\n\t\t\tconst element = Tag.render`\n\t\t\t\t<p> ${TextFormat.encode(provider.description)} </p>\n\t\t\t`;\n\n\t\t\tDom.append(element, this.#ui.provider.info);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (code === ProviderCode.sesCom)\n\t\t{\n\t\t\tlet providerInfo = Loc.getMessage('SIGN_B2E_COMPANY_SES_COM_INFO') ?? '';\n\t\t\tproviderInfo = Helpdesk.replaceLink(\n\t\t\t\tproviderInfo,\n\t\t\t\tHelpdeskCodes.SesComDetails,\n\t\t\t);\n\t\t\tproviderInfo = Link.replaceInLoc(\n\t\t\t\tproviderInfo,\n\t\t\t\tsesComLearnMoreLink,\n\t\t\t);\n\n\t\t\tconst text = Tag.render`<span>${providerInfo}</span>`;\n\t\t\t// Waiting for ready an article\n\t\t\ttext.firstElementChild.style.display = 'none';\n\t\t\tDom.append(text, this.#ui.provider.info);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst providerCodeToProviderInfoTextMap: { [key: ProviderCodeType]: ?string } = {\n\t\t\tgoskey: Loc.getMessage('SIGN_B2E_COMPANY_GOSKEY_INFO'),\n\t\t\t'ses-ru': Loc.getMessage('SIGN_B2E_COMPANY_SES_RU_INFO'),\n\t\t};\n\t\tconst providerCodeToHelpdeskCodeMap: { [key: ProviderCodeType]: string } = {\n\t\t\tgoskey: HelpdeskCodes.GoskeyDetails,\n\t\t\t'ses-ru': HelpdeskCodes.SesRuDetails,\n\t\t};\n\n\t\tconst text = Tag.render`<span>${Helpdesk.replaceLink(\n\t\t\tproviderCodeToProviderInfoTextMap[code] ?? '',\n\t\t\tproviderCodeToHelpdeskCodeMap[code] ?? '',\n\t\t)}</span>`;\n\t\tDom.append(text, this.#ui.provider.info);\n\n\t\tif (this.#isProviderExpiresSoon(provider) || this.#isProviderExpired(provider))\n\t\t{\n\t\t\tDom.append(this.#getProviderAlert(provider).render(), this.#ui.provider.info);\n\t\t}\n\t}\n\n\t#chooseProvider(provider: Provider, rqInn: number): void\n\t{\n\t\tif (!allowedSignatureProviders.includes(provider.code))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { providerName, description } = this.#getConnectedName(provider, rqInn);\n\t\tthis.#ui.provider.connected.name.textContent = providerName;\n\t\tthis.#ui.provider.connected.description.textContent = description;\n\n\t\tthis.#renderProviderInfo(provider);\n\t\tthis.#resetProviderClasses();\n\t\tDom.addClass(this.#ui.provider.connected.container, `--with-icon --${provider.code}`);\n\t\tif (provider.code === ProviderCode.external)\n\t\t{\n\t\t\tthis.#setProviderImage(provider);\n\t\t}\n\n\t\tDom.clean(this.#ui.provider.connected.nameLabelContainer);\n\t\tif (this.#isProviderExpired(provider))\n\t\t{\n\t\t\tDom.addClass(this.#ui.provider.connected.container, '--expired');\n\t\t\tDom.append(this.#makeLabel().render(), this.#ui.provider.connected.nameLabelContainer);\n\t\t}\n\t\tthis.#ui.provider.connected.connectDropdownButton.style.display = provider.autoRegister ? 'none' : ' flex';\n\t\tthis.#company.provider = provider;\n\t}\n\n\tgetSelectedCompanyProvider(): Provider | null\n\t{\n\t\treturn this.#company.provider ?? null;\n\t}\n\n\t#onCompanySelectedHandler(event): void\n\t{\n\t\tif (!event.data || event.data.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst selectedItem = event.data.item;\n\t\tif (selectedItem?.id <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.selectCompany(selectedItem?.id);\n\t}\n\n\tselectCompany(id: number): void\n\t{\n\t\tconst company = this.#getCompanyById(id);\n\t\tif (Type.isUndefined(company))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#company.id = company.id;\n\t\tthis.#company.provider = null;\n\t\tif (company?.providers?.length > 0)\n\t\t{\n\t\t\tconst filteredProviders = company.providers\n\t\t\t\t?.filter((provider) => allowedSignatureProviders.includes(provider.code))\n\t\t\t\t?? []\n\t\t\t;\n\t\t\tif (filteredProviders.length > 0)\n\t\t\t{\n\t\t\t\tthis.#company.provider = filteredProviders[0];\n\t\t\t}\n\t\t}\n\n\t\tthis.#refreshView();\n\t\tthis.#getDialog().getItems()\n\t\t\t.find((item) => item.id === this.#company.id)\n\t\t\t?.select()\n\t\t;\n\t\tthis.#integrationSelector.setCompanyId(this.#company.id);\n\t\tthis.emit(this.events.onSelect, { companyId: this.#company.id });\n\t}\n\n\t#refreshView(): void\n\t{\n\t\tconst selectedItem = this.#getCompanyById(this.#company?.id);\n\t\tif (!selectedItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#ui.info.title.header.name.innerText = selectedItem.title;\n\t\tif (this.#ui.info.editButton)\n\t\t{\n\t\t\tBX.show(this.#ui.info.editButton);\n\t\t}\n\n\t\tif (this.#ui.info.setRqInnButton)\n\t\t{\n\t\t\tBX.show(this.#ui.info.setRqInnButton);\n\t\t}\n\t\tif (Type.isStringFilled(selectedItem.rqInn))\n\t\t{\n\t\t\tthis.#ui.info.title.rqInn.innerText = Loc.getMessage(\n\t\t\t\t'SIGN_B2E_COMPANIES_INN',\n\t\t\t\t{ '%innValue%': TextFormat.encode(selectedItem.rqInn) },\n\t\t\t);\n\t\t\tthis.#ui.info.title.rqInn.style.display = this.#showTaxId ? '' : 'none';\n\t\t\tDom.hide(this.#getCompanyInfoLabelLayout());\n\n\t\t\tif (this.#ui.info.setRqInnButton)\n\t\t\t{\n\t\t\t\tBX.hide(this.#ui.info.setRqInnButton);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#ui.info.title.rqInn.textContent = '';\n\t\t\tDom.show(this.#getCompanyInfoLabelLayout());\n\t\t\tif (this.#ui.info.editButton)\n\t\t\t{\n\t\t\t\tBX.hide(this.#ui.info.editButton);\n\t\t\t}\n\t\t}\n\n\t\tthis.#resetProviderState();\n\t\tthis.#toggleProviderState(selectedItem.rqInn);\n\t\tthis.#setInfoState();\n\t}\n\n\t#resetProviderState()\n\t{\n\t\tBX.show(this.#ui.provider.container);\n\t\tBX.show(this.#ui.provider.info);\n\t\tBX.show(this.#ui.provider.disconnected.button);\n\t\tthis.#ui.provider.connected.container.style.display = 'flex';\n\t\tthis.#ui.provider.disconnected.container.style.display = 'flex';\n\t}\n\n\t#toggleProviderState(rqInn: ?string)\n\t{\n\t\tconst company = this.#getCompanyById(this.#company.id ?? 0);\n\t\tif (company?.providers?.length > 0)\n\t\t{\n\t\t\tBX.hide(this.#ui.provider.disconnected.container);\n\t\t\tthis.#updateProviderMenu();\n\t\t\tif (this.#options.region === 'ru' && this.#options.documentInitiatedType !== DocumentInitiated.employee)\n\t\t\t{\n\t\t\t\tthis.#tryStartProviderTour();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tBX.hide(this.#ui.provider.connected.container);\n\t\tBX.hide(this.#ui.provider.unset.container);\n\t\tBX.hide(this.#ui.provider.info);\n\t\tif (!rqInn)\n\t\t{\n\t\t\tBX.hide(this.#ui.provider.disconnected.button);\n\t\t}\n\t}\n\n\t#updateDialogItems(): void\n\t{\n\t\tthis.#dialog = null;\n\t\tthis.#dialog = this.#getDialog();\n\t\tconst item = this.#dialog.getItems().find((item) => item.id === this.#company.id);\n\t\titem?.select();\n\t}\n\n\t#getCompanyById(id: number): Company | undefined\n\t{\n\t\treturn this.#companyList.find((company) => id === company.id);\n\t}\n\n\t#getConnectedName(provider: Provider, rqInn: number): string\n\t{\n\t\tconst providerName = provider.code !== 'external'\n\t\t\t? this.#getProviderNameByCode(provider.code)\n\t\t\t: provider.name\n\t\t;\n\t\tconst description = this.#getProviderConnectedDescription(provider, rqInn);\n\n\t\treturn { providerName, description };\n\t}\n\n\t#getProviderConnectedDescription(provider: Provider, rqInn: number): string\n\t{\n\t\tif (provider.autoRegister)\n\t\t{\n\t\t\treturn this.#showTaxId\n\t\t\t\t? Loc.getMessage('SIGN_B2E_SELECT_PROVIDER_WITHOUT_DATE', {\n\t\t\t\t\t'#RQINN#': rqInn,\n\t\t\t\t})\n\t\t\t\t: Loc.getMessage('SIGN_B2E_SELECT_PROVIDER_WITHOUT_INN_DATE')\n\t\t\t;\n\t\t}\n\n\t\tconst formattedDate = DateTimeFormat.format(\n\t\t\tDateTimeFormat.getFormat('FORMAT_DATE'),\n\t\t\tprovider.timestamp,\n\t\t);\n\n\t\treturn this.#showTaxId\n\t\t\t? Loc.getMessage('SIGN_B2E_SELECT_PROVIDER', {\n\t\t\t\t'#RQINN#': rqInn,\n\t\t\t\t'#DATE#': formattedDate,\n\t\t\t})\n\t\t\t: Loc.getMessage('SIGN_B2E_SELECT_PROVIDER_WITHOUT_INN', { '#DATE#': formattedDate })\n\t\t;\n\t}\n\n\t#getProviderNameByCode(code): string\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'goskey':\n\t\t\t\treturn Loc.getMessage('SIGN_B2E_PROVIDER_GOSKEY_NAME');\n\t\t\tcase 'taxcom':\n\t\t\t\treturn Loc.getMessage('SIGN_B2E_PROVIDER_TAXCOM_NAME');\n\t\t\tcase 'ses-ru':\n\t\t\t\treturn Loc.getMessage('SIGN_B2E_PROVIDER_SES_NAME');\n\t\t\tcase 'ses-com':\n\t\t\t\treturn Loc.getMessage('SIGN_B2E_PROVIDER_SES_COM_NAME');\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n\n\t#openProvidersConnectionSlider(): void\n\t{\n\t\tconst company = this.#getCompanyById(this.#company?.id);\n\t\tif (company && company.registerUrl)\n\t\t{\n\t\t\tconst url = new URL(company.registerUrl);\n\t\t\tconst allowedOrigin = url.origin;\n\t\t\tBX.SidePanel.Instance.open('sign:stub', {\n\t\t\t\twidth: 1100,\n\t\t\t\tcacheable: false,\n\t\t\t\tallowCrossDomain: true,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\tconst frameStyles = 'position: absolute; left: 0; top: 0; padding: 0;'\n\t\t\t\t\t\t+ ' border: none; margin: 0; width: 100%; height: 100%;';\n\t\t\t\t\tthis.#registerIframe = Tag.render`<iframe src=\"${company.registerUrl}\" style=\"${frameStyles}\"></iframe>`;\n\n\t\t\t\t\treturn this.#registerIframe;\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => this.#load(),\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.#initIframeConnect(allowedOrigin);\n\t\t\tthis.#subscribeIframeConnectedEvent(allowedOrigin);\n\t\t\tthis.#subscribeIframeCloseEvent(allowedOrigin);\n\t\t}\n\t}\n\n\tasync #disconnectCurrentProvider(): Promise\n\t{\n\t\tif (!this.#company.provider)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst company = this.#getCompanyById(this.#company.id ?? 0);\n\t\tif (!company)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst id = this.#company.provider.uid;\n\t\tif (!id || this.#company.provider.autoRegister)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#showLoader();\n\n\t\ttry\n\t\t{\n\t\t\tawait this.#api.deleteB2eCompany(id);\n\t\t\tcompany.providers = company.providers.filter((provider: Provider) => provider.uid !== id);\n\t\t\tthis.#company.provider = null;\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error(e);\n\t\t}\n\t\tthis.#hideLoader();\n\t\tthis.selectCompany(company.id);\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tEvent.bind(this.#ui.select.button, 'click', () => {\n\t\t\tthis.#getDialog().setTargetNode(this.#ui.container);\n\t\t\tthis.#getDialog().show();\n\t\t});\n\t\tEvent.bind(this.#ui.info.title.header.dropdownButton, 'click', () => {\n\t\t\tthis.#getDialog().setTargetNode(this.#ui.container);\n\t\t\tthis.#getDialog().show();\n\t\t});\n\t\tif (this.#ui.info.editButton)\n\t\t{\n\t\t\tEvent.bind(this.#ui.info.editButton, 'click', () => this.#showEditMenu());\n\t\t}\n\n\t\tEvent.bind(this.#ui.info.setRqInnButton, 'click', () => this.#editCompany());\n\t}\n\n\t#onCompanyDeselectedHandler(event): void\n\t{\n\t\tthis.#company.id = null;\n\t\tthis.#integrationSelector.setCompanyId(this.#company.id);\n\t\tthis.#company.provider = {\n\t\t\tkey: null,\n\t\t\tuid: null,\n\t\t};\n\n\t\tthis.#setEmptyState();\n\t}\n\n\t#initIframeConnect(allowedOrigin)\n\t{\n\t\tthis.#iframeConnectInterval = setInterval(() => {\n\t\t\tif (this.#registerIframe && this.#registerIframe.contentWindow)\n\t\t\t{\n\t\t\t\tthis.#registerIframe.contentWindow.postMessage('Event:b2e-crossorigin:initConnection', allowedOrigin);\n\t\t\t}\n\t\t}, 500);\n\t}\n\n\t#showEditMenu()\n\t{\n\t\tconst menu = new Menu({\n\t\t\tbindElement: this.#ui.info.editButton,\n\t\t\tcacheable: false,\n\t\t});\n\t\tmenu.addMenuItem({\n\t\t\ttext: Loc.getMessage('SIGN_B2E_COMPANIES_EDIT'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.#editCompany();\n\t\t\t\tmenu.close();\n\t\t\t},\n\t\t});\n\t\tmenu.show();\n\t}\n\n\t#createCompany(): void\n\t{\n\t\tif (this.#options.needOpenCrmSaveAndEditCompanySliders)\n\t\t{\n\t\t\tconst companiesIdsBeforeSliderClose: Set<number> = new Set(this.#companyList.map((company) => company.id));\n\n\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\t'/crm/company/details/0/?mycompany=y',\n\t\t\t\t{\n\t\t\t\t\tcacheable: false,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: async () => {\n\t\t\t\t\t\t\tthis.#dialog.hide();\n\t\t\t\t\t\t\tawait this.#load();\n\t\t\t\t\t\t\tconst newCompany = this.#companyList\n\t\t\t\t\t\t\t\t.find(({ id }) => !companiesIdsBeforeSliderClose.has(id))\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tif (!Type.isUndefined(newCompany))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.selectCompany(newCompany.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\t\tCompanyEditor.openSlider({\n\t\t\tmode: CompanyEditorMode.Create,\n\t\t\tdocumentEntityId: this.#options.entityId,\n\t\t\tlayoutTitle: Loc.getMessage('SIGN_B2E_COMPANY_CREATE'),\n\t\t\tentityTypeId: DocumentEntityTypeId.B2e,\n\t\t\tguid: EditorTypeGuid.B2e,\n\t\t\tevents: {\n\t\t\t\tonCompanySavedHandler: (companyId: number): void => {\n\t\t\t\t\tthis.#company.id = companyId;\n\t\t\t\t\tthis.#integrationSelector.setCompanyId(this.#company.id);\n\t\t\t\t},\n\t\t\t},\n\t\t}, {\n\t\t\tonCloseHandler: () => {\n\t\t\t\tthis.#load();\n\t\t\t\tthis.#dialog.hide();\n\t\t\t},\n\t\t});\n\t}\n\n\t#editCompany(): void\n\t{\n\t\tif (!Type.isInteger(this.#company.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#options.needOpenCrmSaveAndEditCompanySliders)\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\t`/crm/company/details/${this.#company.id}/`,\n\t\t\t\t{\n\t\t\t\t\tcacheable: false,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: () => this.#load(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\tCompanyEditor.openSlider({\n\t\t\tmode: CompanyEditorMode.Edit,\n\t\t\tdocumentEntityId: this.#options.entityId,\n\t\t\tcompanyId: this.#company.id,\n\t\t\tlayoutTitle: Loc.getMessage('SIGN_B2E_COMPANY_EDIT'),\n\t\t\tentityTypeId: DocumentEntityTypeId.B2e,\n\t\t\tguid: EditorTypeGuid.B2e,\n\t\t}, {\n\t\t\tonCloseHandler: () => this.#load(),\n\t\t});\n\t}\n\n\t#subscribeIframeConnectedEvent(allowedOrigin)\n\t{\n\t\tif (this.#isSubscribedIframeConnectedEvent)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\twindow.addEventListener('message', (event) => {\n\t\t\tif (event.origin === allowedOrigin && event.data === 'Event:b2e-crossorigin:connected')\n\t\t\t{\n\t\t\t\tclearInterval(this.#iframeConnectInterval);\n\t\t\t\tconst company = this.#getCompanyById(this.#company.id ?? 0);\n\t\t\t\tif (company)\n\t\t\t\t{\n\t\t\t\t\tthis.#registerIframe.contentWindow.postMessage({ companyName: company.title }, allowedOrigin);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.#isSubscribedIframeConnectedEvent = true;\n\t}\n\n\t#subscribeIframeCloseEvent(allowedOrigin)\n\t{\n\t\tif (this.#isSubscribedIframeCloseEvent)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\twindow.addEventListener('message', (event) => {\n\t\t\tif (event.origin === allowedOrigin && event.data === 'Event:b2e-crossorigin:close-iframe')\n\t\t\t{\n\t\t\t\tBX.SidePanel.Instance.close();\n\t\t\t}\n\t\t});\n\n\t\tthis.#isSubscribedIframeCloseEvent = true;\n\t}\n\n\tasync #registerVirtualProviderIfNeed(): Promise<void>\n\t{\n\t\tif (!this.#company.provider.virtual)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst selectedItem = this.#getCompanyById(this.#company.id);\n\t\tconst { id } = await this.#api.registerB2eCompany(\n\t\t\tthis.#company.provider.code,\n\t\t\tselectedItem.rqInn,\n\t\t\tthis.#company.id,\n\t\t\tthis.#company.provider.externalProviderId,\n\t\t);\n\t\tthis.#company.provider.uid = id;\n\t\tthis.#company.provider.virtual = false;\n\t\tsetTimeout(() => this.#load(), this.#reloadDelayForHide);\n\t}\n\n\tgetCompanyId(): ?number\n\t{\n\t\treturn this.#company?.id;\n\t}\n\n\tgetIntegrationId(): number | null\n\t{\n\t\treturn this.#integrationSelector.getSelectedId();\n\t}\n\n\tsetLastSavedIntegrationId(integrationId: number | null): void\n\t{\n\t\tthis.#integrationSelector.setLastSavedId(integrationId);\n\t}\n\n\tvalidate(): boolean\n\t{\n\t\tDom.removeClass(this.#ui.container, '--invalid');\n\t\tDom.removeClass(this.#ui.provider.container.firstElementChild, '--invalid');\n\t\tconst isProviderValid = Type.isObject(this.#company.provider)\n\t\t\t&& Type.isStringFilled(this.#company.provider.uid)\n\t\t\t&& !this.#isProviderExpired(this.#company.provider)\n\t\t;\n\t\tconst company = this.#getCompanyById(this.#company.id ?? 0);\n\t\tconst isCompanyValid = Type.isObject(company) && company.id > 0 && company.rqInn > 0;\n\t\tconst isValid = isCompanyValid && isProviderValid;\n\n\t\tif (!isCompanyValid)\n\t\t{\n\t\t\tDom.addClass(this.#ui.container, '--invalid');\n\t\t}\n\t\telse if (!isProviderValid)\n\t\t{\n\t\t\tDom.addClass(this.#ui.provider.container.firstElementChild, '--invalid');\n\t\t}\n\n\t\treturn isValid;\n\t}\n\n\tasync save(documentId: string): Promise<any>\n\t{\n\t\tawait this.#registerVirtualProviderIfNeed();\n\t\tconst provider = this.#company.provider;\n\n\t\tif (this.#options.hcmLinkAvailable)\n\t\t{\n\t\t\tawait this.#api.changeIntegrationId(documentId, this.#integrationSelector?.getSelectedId());\n\t\t}\n\n\t\treturn Promise.all([\n\t\t\tthis.#api.modifyB2eCompany(documentId, provider.uid),\n\t\t\tthis.#api.modifyB2eDocumentScheme(documentId, this.#getDefaultSchemeByProviderCode(provider.code)),\n\t\t]);\n\t}\n\n\t#isProviderExpiresSoon(provider: Provider): boolean\n\t{\n\t\tif (!provider.expires)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst daysLeft = this.#getProviderDaysLeft(provider.expires);\n\n\t\treturn daysLeft <= this.#providerExpiresDaysToShowInfo && daysLeft >= 1;\n\t}\n\n\t#isProviderExpired(provider: Provider): boolean\n\t{\n\t\treturn provider.expires && this.#getProviderDaysLeft(provider.expires) < 1;\n\t}\n\n\t#getProviderDaysLeft(expires: Number): Number\n\t{\n\t\tconst now = Date.now() / 1000;\n\n\t\treturn Math.floor((expires - now) / 86400);\n\t}\n\n\t#makeLabel(): Label\n\t{\n\t\treturn new Label({\n\t\t\ttext: Loc.getMessage('SIGN_B2E_GOSKEY_APIKEY_EXPIRED'),\n\t\t\tcolor: LabelColor.WARNING,\n\t\t\tfill: true,\n\t\t\tcustomClass: 'sign-document-b2e-company__provider_label',\n\t\t});\n\t}\n\n\t#getEntityAvatar(provider: Provider): string\n\t{\n\t\tif (provider.code === ProviderCode.goskey)\n\t\t{\n\t\t\treturn this.#isProviderExpired(provider)\n\t\t\t\t? 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCAzNiAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjM2IiBoZWlnaHQ9IjM2IiByeD0iMTgiIGZpbGw9IiNCREMxQzYiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNi4zMzA1IDE0Ljg5OTlMMTkuNzU3MiAxMS40NzMxQzIwLjM4ODEgMTAuODQyMyAyMS40MTA5IDEwLjg0MjMgMjIuMDQxNyAxMS40NzMxTDI0LjcwNyAxNC4xMzg0QzI1LjMzNzggMTQuNzY5MiAyNS4zMzc4IDE1Ljc5MiAyNC43MDcgMTYuNDIyOUwyMS4yODAyIDE5Ljg0OTZDMjAuODU5NyAyMC4yNzAyIDIwLjE3OTEgMjAuMjcxNSAxOS43NTg1IDE5Ljg1MDlMMTYuMzI5OCAxNi40MjIyQzE1LjkwOTMgMTYuMDAxNiAxNS45MDk5IDE1LjMyMDQgMTYuMzMwNSAxNC44OTk5Wk0yMS42NjEgMTUuNjYxNEMyMS4zNDU2IDE1Ljk3NjggMjAuODM0MiAxNS45NzY4IDIwLjUxODcgMTUuNjYxNEMyMC4yMDMzIDE1LjM0NiAyMC4yMDMzIDE0LjgzNDYgMjAuNTE4NyAxNC41MTkxQzIwLjgzNDIgMTQuMjAzNyAyMS4zNDU2IDE0LjIwMzcgMjEuNjYxIDE0LjUxOTFDMjEuOTc2NCAxNC44MzQ2IDIxLjk3NjQgMTUuMzQ2IDIxLjY2MSAxNS42NjE0WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTE3LjA5MiAxNy45NDU5TDE4LjQyNDYgMTkuMjc4NUMxOC42MzQ5IDE5LjQ4ODggMTguNjM0OSAxOS44Mjk3IDE4LjQyNDYgMjAuMDRMMTcuMDU5MyAyMS40MDUzQzE2Ljk1ODQgMjEuNTA2MyAxNi44MjE0IDIxLjU2MyAxNi42Nzg2IDIxLjU2M0gxNS4zNzg2VjIyLjg2M0MxNS4zNzg2IDIzLjAwNTggMTUuMzIxOSAyMy4xNDI3IDE1LjIyMDkgMjMuMjQzN0wxNS4xNTU2IDIzLjMwOUMxNS4wNTQ2IDIzLjQxIDE0LjkxNzYgMjMuNDY2OCAxNC43NzQ4IDIzLjQ2NjhIMTMuNDc0OVYyNC43NjY3QzEzLjQ3NDkgMjQuOTA5NSAxMy40MTgxIDI1LjA0NjUgMTMuMzE3MiAyNS4xNDc1TDEyLjg3MTEgMjUuNTkzNUMxMi43NzAxIDI1LjY5NDUgMTIuNjMzMSAyNS43NTEzIDEyLjQ5MDMgMjUuNzUxM0gxMS4zMjVDMTEuMjM4OCAyNS43NTEzIDExLjE1NjEgMjUuNzE3IDExLjA5NTIgMjUuNjU2MUMxMS4wMzQyIDI1LjU5NTEgMTEgMjUuNTEyNSAxMSAyNS40MjYzVjIzLjY1NzFMMTUuMTg4MiAxOS40Njg5QzE0Ljk3OCAxOS4yNTg2IDE0Ljk3OCAxOC45MTc3IDE1LjE4ODIgMTguNzA3NEwxNS45NDk3IDE3Ljk0NTlDMTYuMjY1MiAxNy42MzA1IDE2Ljc3NjYgMTcuNjMwNSAxNy4wOTIgMTcuOTQ1OVoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNS42MTUyNiAxNy4wNTY0VjE5LjMwMDJDNS42MTUyNiAyMC43MzA5IDUuNjE2ODIgMjEuNjk0NiA1LjY4NTA2IDIyLjQ1MjJDNS43NTAzMSAyMy4xNzY1IDUuODY4ODYgMjMuNTk0MiA2LjA0MzgxIDIzLjkzNDVDNi4yMTg3NyAyNC4yNzQ5IDYuNDg4MzggMjQuNjEyMyA3LjAzNjA3IDI1LjA4MDRDNy42MDg4NiAyNS41NyA4LjM4NjI5IDI2LjEyMTcgOS41NDE2OCAyNi45Mzg3TDExLjA0NTkgMjguMDAyNEwxMy41Nzc5IDI5LjQyMjRDMTQuODc2MiAzMC4xNTA1IDE1Ljc1MjYgMzAuNjQwMSAxNi40NzUgMzAuOTU4NUMxNy4xNjYgMzEuMjYzIDE3LjYwNCAzMS4zNTc5IDE3Ljk5OTkgMzEuMzU3OUMxOC4zOTU3IDMxLjM1NzkgMTguODMzNyAzMS4yNjMgMTkuNTI0NyAzMC45NTg1QzIwLjI0NzIgMzAuNjQwMSAyMS4xMjM1IDMwLjE1MDUgMjIuNDIxOSAyOS40MjI0TDI0Ljk1MzkgMjguMDAyNEwyNi40NTgxIDI2LjkzODdDMjcuNjEzNSAyNi4xMjE3IDI4LjM5MDkgMjUuNTcgMjguOTYzNyAyNS4wODA0QzI5LjUxMTQgMjQuNjEyMyAyOS43ODEgMjQuMjc0OSAyOS45NTU5IDIzLjkzNDVDMzAuMTMwOSAyMy41OTQyIDMwLjI0OTQgMjMuMTc2NSAzMC4zMTQ3IDIyLjQ1MjJDMzAuMzgyOSAyMS42OTQ2IDMwLjM4NDUgMjAuNzMwOSAzMC4zODQ1IDE5LjMwMDJWMTcuMDU2NEMzMC4zODQ1IDE1LjYyNTcgMzAuMzgyOSAxNC42NjE5IDMwLjMxNDcgMTMuOTA0NEMzMC4yNDk0IDEzLjE4IDMwLjEzMDkgMTIuNzYyMyAyOS45NTU5IDEyLjQyMkMyOS43ODEgMTIuMDgxNiAyOS41MTE0IDExLjc0NDIgMjguOTYzNyAxMS4yNzYxQzI4LjM5MDkgMTAuNzg2NSAyNy42MTM1IDEwLjIzNDkgMjYuNDU4MSA5LjQxNzgzTDI0LjkxOTggOC4zMzAwNEwyMi44MjczIDcuMDA5OEMyMS40MTc3IDYuMTIwNDIgMjAuNDYzNCA1LjUyMDc0IDE5LjY3MzQgNS4xMzA3QzE4LjkxNzMgNC43NTczMyAxOC40MzY4IDQuNjQyMDYgMTcuOTk5OSA0LjY0MjA2QzE3LjU2MyA0LjY0MjA2IDE3LjA4MjUgNC43NTczMyAxNi4zMjYzIDUuMTMwN0MxNS41MzYzIDUuNTIwNzQgMTQuNTgyMSA2LjEyMDQyIDEzLjE3MjUgNy4wMDk4TDExLjA4IDguMzMwMDNMOS41NDE2NyA5LjQxNzgzQzguMzg2MjkgMTAuMjM0OSA3LjYwODg2IDEwLjc4NjUgNy4wMzYwNyAxMS4yNzYxQzYuNDg4MzggMTEuNzQ0MiA2LjIxODc3IDEyLjA4MTYgNi4wNDM4MSAxMi40MjJDNS44Njg4NiAxMi43NjIzIDUuNzUwMzEgMTMuMTggNS42ODUwNiAxMy45MDQ0QzUuNjE2ODIgMTQuNjYxOSA1LjYxNTI2IDE1LjYyNTcgNS42MTUyNiAxNy4wNTY0Wk0xMC4xOTIyIDYuOTU3NTNMMTIuMzIwNiA1LjYxNDY0QzE1LjA4MzMgMy44NzE1NSAxNi40NjQ2IDMgMTcuOTk5OSAzQzE5LjUzNTEgMyAyMC45MTY1IDMuODcxNTUgMjMuNjc5MiA1LjYxNDY0TDI1LjgwNzYgNi45NTc1M0wyNy4zODA2IDguMDY5ODZDMjkuNjQzOCA5LjY3MDI5IDMwLjc3NTQgMTAuNDcwNSAzMS4zODc3IDExLjY2MTVDMzEuOTk5OSAxMi44NTI1IDMxLjk5OTkgMTQuMjUzOCAzMS45OTk5IDE3LjA1NjRWMTkuMzAwMkMzMS45OTk5IDIyLjEwMjcgMzEuOTk5OSAyMy41MDQgMzEuMzg3NyAyNC42OTVDMzAuNzc1NCAyNS44ODYgMjkuNjQzOCAyNi42ODYyIDI3LjM4MDYgMjguMjg2N0wyNS44MDc2IDI5LjM5OUwyMy4yMDIzIDMwLjg2MDFDMjAuNjU4NiAzMi4yODY3IDE5LjM4NjggMzMgMTcuOTk5OSAzM0MxNi42MTMgMzMgMTUuMzQxMiAzMi4yODY3IDEyLjc5NzUgMzAuODYwMUwxMC4xOTIyIDI5LjM5OUw4LjYxOTE3IDI4LjI4NjZDNi4zNTU5MyAyNi42ODYyIDUuMjI0MzEgMjUuODg2IDQuNjEyMDkgMjQuNjk1QzMuOTk5ODggMjMuNTA0IDMuOTk5ODggMjIuMTAyNyAzLjk5OTg4IDE5LjMwMDJWMTcuMDU2NEMzLjk5OTg4IDE0LjI1MzggMy45OTk4OCAxMi44NTI1IDQuNjEyMDkgMTEuNjYxNUM1LjIyNDMxIDEwLjQ3MDUgNi4zNTU5NCA5LjY3MDI5IDguNjE5MTggOC4wNjk4NkwxMC4xOTIyIDYuOTU3NTNaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K'\n\t\t\t\t: 'data:image/png;base64,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'\n\t\t\t;\n\t\t}\n\n\t\tif (\n\t\t\tprovider.code === ProviderCode.external\n\t\t\t&& Type.isStringFilled(provider.iconUrl)\n\t\t)\n\t\t{\n\t\t\treturn provider.iconUrl;\n\t\t}\n\n\t\treturn 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANQSURBVHgBxZi/b9NAFMffnZOaFgopEkggEK5AohKgJKgLIETzD6B2YmAo3boBAyv9sXaAbh2QCgMzVQbWpELQBYErFpCQcAUqPyogoqipm9jHe5fYikMs2/n5lZxcchffJ+/dvXfPDCJqZK2o9VnWOFOUJAgxhlcCGEvITiEK2DaAgyHK9iovlVb0zJAR4fbAwg688PLvLc6VSQkRTbot7MV3Vw48DjM4EOj8i+0xRVGWsalBazIQbC4IzBcolfudsFV1BgfcgTZKADzkpjmHrixAWCCE0YSqPqMmdEYGM81Mo/XFfGBy0LqLmoJidTAJhHnbBRhHehXKdR+v7aU100UYUqo6pyvXQnJbM74MPRCzrIx+dTBPbddCCDMDPZKohJUKB72QdaANrpo+GYfnF/fBcTV0vHWkVRkqQJyx29CiCGb6REzCPDqnRoaSWYDeaZujF1uKNw6MI4IZPcij3QRTUvqNOMXteHwcWlA9DGnpcwmyWxZElbVbnOAsxq9Bk/KDWfpShmbEGEtysIUGTajdMFLoNo7ZToOI6ghMRQnuHq56D1MFiqCbx2KdhJHi8tgZQrSVc78s+LAjOgaDKsTQZQQU6DayzughBe6+N+HBiAq5n+V2w5AMLkCshhlJMGcHGMyfjsON9V14/ceG+TN9nohMwdCJ1o6uH1HkFUbIshHDba9j7pgMGpz9XpLuIhCa0IHJDHFY2CjDIM55T4tXII7GYMEoyc8OXHarCMFieZbCskYI8QlCiqzgwNCayhz2/vvtsoDBGPN8Jtc+/RrsXgyMw/KXybViLkx5Q+6if79pCrj/cU9ai1xEoYAmJqvUujL7A0G+WbIvhPT1ywNpCZTC1C9CHs5oHW3ugWcSmnzbgrATNxQT9pSOJZJr2+SrHXKbBr2RgdYZpoYbGPEYOQU9Elpnzmm7QHSmFVjyQpeFMIt6TTXrSR18rzSL0UCH7smAgf2ztV94gKg+YoxPyIFdgMFtntHTrOALJKEu9cuBHYbSJQzOVd/RMNtLKNNMd2JN0Zph/f0NYWR/0A2qMaodFa1BO9kpCP0UulapgFG5FLlCyaNVnujtemD1HxjmPsBHeoJTcYDncToCex/p0ZVHa6yDoqz4ucZP/wB0m3kbYruWeAAAAABJRU5ErkJggg==';\n\t}\n\n\t#getEntityBadges(provider: Provider): Array<Object>\n\t{\n\t\tif (provider.code === ProviderCode.goskey && this.#isProviderExpired(provider))\n\t\t{\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_B2E_GOSKEY_APIKEY_EXPIRED'),\n\t\t\t\t\ttextColor: 'var(--ui-color-palette-white-base)',\n\t\t\t\t\tbgColor: 'var(--ui-color-palette-orange-60)',\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\n\t\treturn [];\n\t}\n\n\t#getProviderAlert(provider: Provider): Alert\n\t{\n\t\treturn new Alert({\n\t\t\ttext: this.#getProviderAlertMessage(provider),\n\t\t\tcustomClass: 'sign-document-b2e-company__provider_alert',\n\t\t});\n\t}\n\n\t#getProviderAlertMessage(provider: Provider): string\n\t{\n\t\tif (this.#isProviderExpired(provider))\n\t\t{\n\t\t\treturn Helpdesk.replaceLink(\n\t\t\t\tLoc.getMessage('SIGN_B2E_GOSKEY_APIKEY_EXPIRED_MORE_MSGVER_1'),\n\t\t\t\tHelpdeskCodes.GoskeyApiKey,\n\t\t\t);\n\t\t}\n\n\t\tconst daysLeft = this.#getProviderDaysLeft(provider.expires);\n\t\tconst alertText = Loc.getMessagePlural('SIGN_B2E_GOSKEY_APIKEY_EXPIRES_MSGVER_1', daysLeft, {\n\t\t\t'#DAYS#': daysLeft,\n\t\t});\n\n\t\treturn Helpdesk.replaceLink(alertText, HelpdeskCodes.GoskeyApiKey);\n\t}\n\n\t/**\n\t * This method is required for backward compatibility.\n\t * It should be removed once the SES RU provider supports the default scheme.\n\t *\n\t * @param {ProviderCodeType} provider - The provider code.\n\t * @returns {Scheme} - The signing scheme for the given provider.\n\t */\n\t#getDefaultSchemeByProviderCode(provider: ProviderCodeType): Scheme\n\t{\n\t\treturn provider === ProviderCode.sesRu && this.#options.documentInitiatedType === DocumentInitiated.company\n\t\t\t? SchemeType.Order\n\t\t\t: SchemeType.Default\n\t\t;\n\t}\n\n\tsetInitiatedByType(initiatedByType: DocumentInitiatedType): void\n\t{\n\t\tthis.setOptions({ documentInitiatedType: initiatedByType });\n\t}\n\n\t#setProviderImage(provider: Provider): void\n\t{\n\t\tif (!Type.isStringFilled(provider.iconUrl))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst imgClassName = 'sign-document-b2e-company__provider_selected__external-img';\n\t\tconst img = this.#ui.provider.container?.getElementsByClassName(imgClassName)[0] ?? null;\n\t\tif (!img)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\timg.src = provider.iconUrl;\n\t}\n\n\t#getCompanyInfoLabelLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('companyInfoLabel', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"ui-label ui-label-orange ui-label-fill sign-document-b2e-company-info-label\">\n\t\t\t\t\t<div class=\"ui-label-inner\">${Loc.getMessage('SIGN_V2_B2E_COMPANY_SELECTOR_COMPANY_RQ_WARNING_LABEL')}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getCompanySaveAndEditRequireCrmPermissionLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('companySaveAndEditRequireCrmPermissionLayout', () => {\n\t\t\tconst alert = new Alert({\n\t\t\t\ttext: Loc.getMessage('SIGN_V2_B2E_COMPANY_SELECTOR_SAVE_AND_EDIT_REQUIRE_CRM_PERMISSION'),\n\t\t\t\tcolor: AlertColor.WARNING,\n\t\t\t\tsize: AlertSize.XS,\n\t\t\t\tcustomClass: 'sign-document-b2e-company__alert',\n\t\t\t});\n\n\t\t\treturn alert.render();\n\t\t});\n\t}\n}\n"],"names":["ProviderCode","Object","freeze","goskey","sesCom","sesRu","external","allowedSignatureProviders","sesComLearnMoreLink","Uri","HelpdeskCodes","HowToChooseProvider","GoskeyDetails","SesRuDetails","SesComDetails","TaxcomDetails","GoskeyApiKey","CompanySelector","EventEmitter","constructor","options","events","onCompaniesLoad","onSelect","MemoryCache","id","provider","code","uid","timestamp","container","HTMLDivElement","info","title","header","name","dropdownButton","rqInn","editButton","setRqInnButton","HTMLButtonElement","select","text","HTMLSpanElement","button","HTMLParagraphElement","connected","nameContainer","HTMLElement","nameLabelContainer","description","selectDropdownButton","connectDropdownButton","disconnected","emptyProvider","unset","setEventNamespace","Api","HcmLinkCompanySelector","setAvailability","hcmLinkAvailable","getProviderLayout","getLayout","load","companyUid","company","find","providers","some","Type","isUndefined","setCompanyId","setOptions","Tag","render","Loc","getMessage","show","canEditCompany","style","display","requireCrmPermissionLayout","needOpenCrmSaveAndEditCompanySliders","Dom","append","getSelectedCompanyProvider","selectCompany","length","filteredProviders","filter","includes","getItems","item","emit","companyId","getCompanyId","getIntegrationId","getSelectedId","setLastSavedIntegrationId","integrationId","setLastSavedId","validate","removeClass","firstElementChild","isProviderValid","isObject","isStringFilled","isCompanyValid","isValid","addClass","save","documentId","changeIntegrationId","Promise","all","modifyB2eCompany","modifyB2eDocumentScheme","setInitiatedByType","initiatedByType","documentInitiatedType","BX","hide","guide","Guide","onEvents","autoSave","steps","target","condition","top","bottom","color","popupOptions","width","autoHide","className","centerAngle","startOnce","menu","Menu","bindElement","cacheable","addMenuItem","onclick","close","loadCompanyPromise","loadB2eCompanyList","DocumentInitiated","data","error","console","log","companies","isArray","Boolean","showTaxId","Loader","mode","size","footer","canCreateCompany","Dialog","targetNode","height","items","map","entityId","tabs","deselectable","isCompaniesDeselectable","showAvatars","dropdownMode","multiple","enableSearch","event","registerUrl","providerMenu","currentProvider","providerClasses","push","forEach","providerName","addItem","subtitle","avatar","badges","firstItem","nothingToSelect","clean","firstParagraph","secondParagraph","thirdParagraph","Helpdesk","replaceLink","element","TextFormat","encode","providerInfo","Link","replaceInLoc","providerCodeToProviderInfoTextMap","providerCodeToHelpdeskCodeMap","textContent","autoRegister","selectedItem","innerText","region","employee","formattedDate","DateTimeFormat","format","getFormat","url","URL","allowedOrigin","origin","SidePanel","Instance","open","allowCrossDomain","allowChangeHistory","contentCallback","frameStyles","onClose","deleteB2eCompany","e","Event","bind","setTargetNode","key","setInterval","contentWindow","postMessage","companiesIdsBeforeSliderClose","Set","newCompany","has","CompanyEditor","openSlider","CompanyEditorMode","Create","documentEntityId","layoutTitle","entityTypeId","DocumentEntityTypeId","B2e","guid","EditorTypeGuid","onCompanySavedHandler","onCloseHandler","isInteger","Edit","window","addEventListener","clearInterval","companyName","virtual","registerB2eCompany","externalProviderId","setTimeout","expires","daysLeft","now","Date","Math","floor","Label","LabelColor","WARNING","fill","customClass","iconUrl","textColor","bgColor","Alert","alertText","getMessagePlural","SchemeType","Order","Default","imgClassName","img","getElementsByClassName","src","remember","alert","AlertColor","AlertSize","XS"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAsBaA,YAAwD,GAAGC,MAAM,CAACC,MAAM,CAAC;GACrFC,MAAM,EAAE,QAAQ;GAChBC,MAAM,EAAE,SAAS;GACjBC,KAAK,EAAE,QAAQ;GACfC,QAAQ,EAAE;CACX,CAAC,CAAC;CAoBF,MAAMC,yBAAkD,GAAG,CAAC,QAAQ,EAAE,UAAU,EAAE,QAAQ,EAAE,SAAS,CAAC;CACtG,MAAMC,mBAAmB,GAAG,IAAIC,aAAG,CAAC,4DAA4D,CAAC;AAEjG,OAAaC,aAAmD,GAAGT,MAAM,CAACC,MAAM,CAAC;GAChFS,mBAAmB,EAAE,UAAU;GAC/BC,aAAa,EAAE,UAAU;GACzBC,YAAY,EAAE,UAAU;GACxBC,aAAa,EAAE,UAAU;GACzBC,aAAa,EAAE,UAAU;GACzBC,YAAY,EAAE;CACf,CAAC,CAAC;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEH,CAAO,MAAMC,eAAe,SAASC,6BAAY,CACjD;GAiFCC,WAAW,CAACC,OAA+B,GAAG,EAAE,EAChD;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA,KAlFTC,MAAM,GAAG;OACRC,eAAe,EAAE,iBAAiB;OAClCC,QAAQ,EAAE;MACV;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAGwC,IAAIC,2BAAW;;KAAE;OAAA;OAAA,OAC3B;;KAAE;OAAA;OAAA,OAEH;;KAAI;OAAA;OAAA,OAEV;SACvBC,EAAE,EAAE,IAAI;SACRC,QAAQ,EAAE;WACTC,IAAI,EAAE,IAAI;WACVC,GAAG,EAAE,IAAI;WACTC,SAAS,EAAE;;;;KAEZ;OAAA;OAAA,OAEiB;;KAAI;OAAA;OAAA,OACE;;KAAI;OAAA;OAAA,OACV;;KAAI;OAAA;OAAA,OACA;;KAAI;OAAA;OAAA;;KAAA;OAAA;OAAA,OAGpB;SACLC,SAAS,EAAEC,cAAc,GAAG,IAAI;SAChCC,IAAI,EAAE;WACLF,SAAS,EAAEC,cAAc,GAAG,IAAI;WAChCE,KAAK,EAAE;aACNH,SAAS,EAAEC,cAAc,GAAG,IAAI;aAChCG,MAAM,EAAE;eACPJ,SAAS,EAAEC,cAAc,GAAG,IAAI;eAChCI,IAAI,EAAEJ,cAAc,GAAG,IAAI;eAC3BK,cAAc,EAAEL,cAAc,GAAG;cACjC;aACDM,KAAK,EAAEN,cAAc,GAAG;YACxB;WACDO,UAAU,EAAEP,cAAc,GAAG,IAAI;WACjCQ,cAAc,EAAEC,iBAAiB,GAAG;UACpC;SACDC,MAAM,EAAE;WACPX,SAAS,EAAEC,cAAc,GAAG,IAAI;WAChCW,IAAI,EAAEC,eAAe,GAAG,IAAI;WAC5BC,MAAM,EAAEJ,iBAAiB,GAAG;UAC5B;SACDd,QAAQ,EAAE;WACTI,SAAS,EAAEC,cAAc,GAAG,IAAI;WAChCC,IAAI,EAAEa,oBAAoB,GAAG,IAAI;WACjCC,SAAS,EAAE;aACVhB,SAAS,EAAEC,cAAc,GAAG,IAAI;aAChCgB,aAAa,EAAEC,WAAW;aAC1BC,kBAAkB,EAAED,WAAW;aAC/Bb,IAAI,EAAEQ,eAAe;aACrBO,WAAW,EAAEP,eAAe;aAC5BQ,oBAAoB,EAAER,eAAe;aACrCS,qBAAqB,EAAET;YACvB;WACDU,YAAY,EAAE;aACbvB,SAAS,EAAEC,cAAc,GAAG,IAAI;aAChCuB,aAAa,EAAEX,eAAe,GAAG,IAAI;aACrCC,MAAM,EAAEJ,iBAAiB,GAAG;YAC5B;WACDe,KAAK,EAAE;aACNzB,SAAS,EAAEC,cAAc,GAAG,IAAI;aAChCW,IAAI,EAAEC,eAAe,GAAG,IAAI;aAC5BC,MAAM,EAAEJ,iBAAiB,GAAG;;;;;KAG9B;OAAA;OAAA,OAE+B;;KAAK;OAAA;OAAA,OACD;;KAAK;OAAA;OAAA;;KAAA;OAAA;OAAA,OAEhB;;KAAI;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAGY;;KAKxC,IAAI,CAACgB,iBAAiB,CAAC,gCAAgC,CAAC;KACxD,4CAAI,gBAAQ,IAAIC,eAAG,EAAE;KACrB,4CAAI,gDAAwB,IAAIC,yDAAsB,EAAE;KACxD,4CAAI,8CAAsBC,eAAe,CAACvC,OAAO,CAACwC,gBAAgB,CAAC;KACnE,4CAAI,wBAAYxC,OAAO;KACvB,4CAAI,YAAKM,QAAQ,CAACI,SAAS,GAAG,IAAI,CAAC+B,iBAAiB,EAAE;KACtD,4CAAI,YAAK/B,SAAS,GAAG,IAAI,CAACgC,SAAS,EAAE;KACrC,4CAAI;KACJ,4CAAI;KACJ,4CAAI,wEAAgB,IAAI,iBAAQ;;GAgBjC,MAAMC,IAAI,CAACC,UAAkB,EAC7B;KACC,8CAAM,IAAI,6BAAa;KACvB,MAAMC,OAAO,GAAG,4CAAI,8BAAcC,IAAI,CAAED,OAAO,IAAK;OACnD,OAAOA,OAAO,CAACE,SAAS,CAACC,IAAI,CAAE1C,QAAQ,IAAK;SAC3C,OAAOA,QAAQ,CAACE,GAAG,KAAKoC,UAAU;QAClC,CAAC;MACF,CAAC;KACF,IAAIK,cAAI,CAACC,WAAW,CAACL,OAAO,CAAC,EAC7B;OACC;;KAED,4CAAI,sBAAUxC,EAAE,GAAGwC,OAAO,CAACxC,EAAE;KAC7B,4CAAI,8CAAsB8C,YAAY,CAAC,4CAAI,sBAAU9C,EAAE,CAAC;KACxD,4CAAI;KACJ,4CAAI,oCAAiBuC,UAAU;;GAGhCQ,UAAU,CAACpD,OAAwC,EACnD;KACC,4CAAI,wBAAY;OAAE,2CAAG,IAAI,qBAAS;OAAE,GAAGA;MAAS;;GAGjDyC,iBAAiB,GACjB;KACC,IAAI,4CAAI,YAAKnC,QAAQ,CAACI,SAAS,EAC/B;OACC,OAAO,4CAAI,YAAKJ,QAAQ,CAACI,SAAS;;KAGnC,4CAAI,YAAKJ,QAAQ,CAAC2B,YAAY,CAACC,aAAa,GAAGmB,aAAG,CAACC,MAAM,cAAC;;MAExD,CAAmE;;GAErE,GAFIC,aAAG,CAACC,UAAU,CAAC,gDAAgD,CAAC,CAEnE;KACD,4CAAI,YAAKlD,QAAQ,CAAC2B,YAAY,CAACT,MAAM,GAAG6B,aAAG,CAACC,MAAM,gBAAC;;;eAGxC,CAA8C;;MAEvD,CAA8C;;GAEhD,GAJa,8CAAM,IAAI,mEAAiC,EAEpDC,aAAG,CAACC,UAAU,CAAC,2BAA2B,CAAC,CAE9C;KACD,4CAAI,YAAKlD,QAAQ,CAAC2B,YAAY,CAACvB,SAAS,GAAG2C,aAAG,CAACC,MAAM,gBAAC;;MAEpD,CAA+C;MAC/C,CAAwC;;GAE1C,GAHI,4CAAI,YAAKhD,QAAQ,CAAC2B,YAAY,CAACC,aAAa,EAC5C,4CAAI,YAAK5B,QAAQ,CAAC2B,YAAY,CAACT,MAAM,CAExC;KACD,4CAAI,YAAKlB,QAAQ,CAACoB,SAAS,CAACX,IAAI,GAAGsC,aAAG,CAACC,MAAM,gBAAC;;GAE9C,EAAC;KACD,4CAAI,YAAKhD,QAAQ,CAACoB,SAAS,CAACG,kBAAkB,GAAGwB,aAAG,CAACC,MAAM,gBAAC;;GAE5D,EAAC;KACD,4CAAI,YAAKhD,QAAQ,CAACoB,SAAS,CAACC,aAAa,GAAG0B,aAAG,CAACC,MAAM,gBAAC;;MAErD,CAAmC;MACnC,CAAiD;;GAEnD,GAHI,4CAAI,YAAKhD,QAAQ,CAACoB,SAAS,CAACX,IAAI,EAChC,4CAAI,YAAKT,QAAQ,CAACoB,SAAS,CAACG,kBAAkB,CAEjD;KACD,4CAAI,YAAKvB,QAAQ,CAACoB,SAAS,CAACI,WAAW,GAAGuB,aAAG,CAACC,MAAM,gBAAC;;GAErD,EAAC;KACD,4CAAI,YAAKhD,QAAQ,CAACoB,SAAS,CAACK,oBAAoB,GAAGsB,aAAG,CAACC,MAAM,gBAAC;;;eAGnD,CAAkC;;GAE7C,GAFa,MAAM,4CAAI,gCAAeG,IAAI,EAAE,CAE3C;KACD,4CAAI,YAAKnD,QAAQ,CAACoB,SAAS,CAACM,qBAAqB,GAAGqB,aAAG,CAACC,MAAM,gBAAC;;;eAGpD,CAAgC;;GAE3C,GAFa,8CAAM,IAAI,uCAAmB,CAEzC;KACD,4CAAI,YAAKhD,QAAQ,CAACoB,SAAS,CAAChB,SAAS,GAAG2C,aAAG,CAACC,MAAM,kBAAC;;;;;;;;OAQhD,CAA4C;OAC5C,CAA0C;;MAE3C,CAAmD;MACnD,CAAoD;;GAEtD,GANK,4CAAI,YAAKhD,QAAQ,CAACoB,SAAS,CAACC,aAAa,EACzC,4CAAI,YAAKrB,QAAQ,CAACoB,SAAS,CAACI,WAAW,EAExC,4CAAI,YAAKxB,QAAQ,CAACoB,SAAS,CAACK,oBAAoB,EAChD,4CAAI,YAAKzB,QAAQ,CAACoB,SAAS,CAACM,qBAAqB,CAEpD;KACD,4CAAI,YAAK1B,QAAQ,CAACM,IAAI,GAAGyC,aAAG,CAACC,MAAM,kBAAC;;GAEpC,EAAC;KACD,4CAAI,YAAKhD,QAAQ,CAAC6B,KAAK,CAACb,IAAI,GAAG+B,aAAG,CAACC,MAAM,kBAAC;;MAExC,CAA6D;;GAE/D,GAFIC,aAAG,CAACC,UAAU,CAAC,0CAA0C,CAAC,CAE7D;KACD,4CAAI,YAAKlD,QAAQ,CAAC6B,KAAK,CAACX,MAAM,GAAG6B,aAAG,CAACC,MAAM,kBAAC;;;eAGjC,CAAkC;;MAE3C,CAAqD;;GAEvD,GAJa,MAAM,4CAAI,gCAAeG,IAAI,EAAE,EAExCF,aAAG,CAACC,UAAU,CAAC,kCAAkC,CAAC,CAErD;KACD,4CAAI,YAAKlD,QAAQ,CAAC6B,KAAK,CAACzB,SAAS,GAAG2C,aAAG,CAACC,MAAM,kBAAC;;MAE7C,CAA+B;MAC/B,CAAiC;;GAEnC,GAHI,4CAAI,YAAKhD,QAAQ,CAAC6B,KAAK,CAACb,IAAI,EAC5B,4CAAI,YAAKhB,QAAQ,CAAC6B,KAAK,CAACX,MAAM,CAEjC;KACD,4CAAI,YAAKlB,QAAQ,CAACI,SAAS,GAAG2C,aAAG,CAACC,MAAM,kBAAC;;;OAGtC,CAAwC;OACxC,CAA2C;OAC3C,CAAoC;;MAErC,CAAyB;;GAE3B,GANK,4CAAI,YAAKhD,QAAQ,CAACoB,SAAS,CAAChB,SAAS,EACrC,4CAAI,YAAKJ,QAAQ,CAAC2B,YAAY,CAACvB,SAAS,EACxC,4CAAI,YAAKJ,QAAQ,CAAC6B,KAAK,CAACzB,SAAS,EAElC,4CAAI,YAAKJ,QAAQ,CAACM,IAAI,CAEzB;KAED,OAAO,4CAAI,YAAKN,QAAQ,CAACI,SAAS;;GAGnCgC,SAAS,GACT;KAAA;KACC,IAAI,4CAAI,YAAKhC,SAAS,EACtB;OACC,OAAO,4CAAI,YAAKA,SAAS;;KAG1B,4CAAI,YAAKE,IAAI,CAACC,KAAK,CAACC,MAAM,CAACE,cAAc,GAAGqC,aAAG,CAACC,MAAM,kBAAC;;GAEvD,EAAC;KACD,4CAAI,YAAK1C,IAAI,CAACC,KAAK,CAACC,MAAM,CAACC,IAAI,GAAGsC,aAAG,CAACC,MAAM,kBAAC;;GAE7C,EAAC;KAED,6BAAI,4CAAI,sBAAUI,cAAc,oCAAI,IAAI,EACxC;OACC,4CAAI,YAAK9C,IAAI,CAACM,UAAU,GAAGmC,aAAG,CAACC,MAAM,kBAAC;;IAEtC,EAAC;OACD,4CAAI,YAAK1C,IAAI,CAACO,cAAc,GAAGkC,aAAG,CAACC,MAAM,kBAAC;;OAExC,CAAoD;;IAEtD,GAFIC,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC,CAEpD;;KAGF,4CAAI,YAAK5C,IAAI,CAACC,KAAK,CAACC,MAAM,CAACJ,SAAS,GAAG2C,aAAG,CAACC,MAAM,kBAAC;;MAEhD,CAAkC;MAClC,CAAoC;MACpC,CAA4C;;GAE9C,GAJI,4CAAI,YAAK1C,IAAI,CAACC,KAAK,CAACC,MAAM,CAACC,IAAI,0CAC/B,IAAI,6DACJ,4CAAI,YAAKH,IAAI,CAACC,KAAK,CAACC,MAAM,CAACE,cAAc,CAE5C;KAED,4CAAI,YAAKJ,IAAI,CAACC,KAAK,CAACI,KAAK,GAAGoC,aAAG,CAACC,MAAM,kBAAC;;GAEvC,EAAC;KACD,IAAI,yCAAC,IAAI,yBAAW,EACpB;OACC,4CAAI,YAAK1C,IAAI,CAACC,KAAK,CAACI,KAAK,CAAC0C,KAAK,CAACC,OAAO,GAAG,MAAM;;KAEjD,4CAAI,YAAKhD,IAAI,CAACC,KAAK,CAACH,SAAS,GAAG2C,aAAG,CAACC,MAAM,kBAAC;;MAEzC,CAAuC;MACvC,CAA4B;;GAE9B,GAHI,4CAAI,YAAK1C,IAAI,CAACC,KAAK,CAACC,MAAM,CAACJ,SAAS,EACpC,4CAAI,YAAKE,IAAI,CAACC,KAAK,CAACI,KAAK,CAE5B;KAED,4CAAI,YAAKL,IAAI,CAACF,SAAS,GAAG2C,aAAG,CAACC,MAAM,kBAAC;;;MAGnC,CAAgC;MAChC,CAA2B;MAC3B,CAA+B;;GAEjC,GAJI,4CAAI,YAAK1C,IAAI,CAACC,KAAK,CAACH,SAAS,EAC7B,4CAAI,YAAKE,IAAI,CAACM,UAAU,EACxB,4CAAI,YAAKN,IAAI,CAACO,cAAc,CAE/B;KAED,4CAAI,YAAKE,MAAM,CAACC,IAAI,GAAG+B,aAAG,CAACC,MAAM,kBAAC;;MAEhC,CAAmD;;GAErD,GAFIC,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC,CAEnD;KACD,4CAAI,YAAKnC,MAAM,CAACG,MAAM,GAAG6B,aAAG,CAACC,MAAM,kBAAC;;MAElC,CAAqD;;GAEvD,GAFIC,aAAG,CAACC,UAAU,CAAC,kCAAkC,CAAC,CAErD;KACD,4CAAI,YAAKnC,MAAM,CAACX,SAAS,GAAG2C,aAAG,CAACC,MAAM,kBAAC;;MAErC,CAAuB;MACvB,CAAyB;;GAE3B,GAHI,4CAAI,YAAKjC,MAAM,CAACC,IAAI,EACpB,4CAAI,YAAKD,MAAM,CAACG,MAAM,CAEzB;KACD,MAAMqC,0BAA0B,GAAG,4CAAI,sBAAUC,oCAAoC,2CAClF,IAAI,0GACJ,EAAE;KAEL,4CAAI,YAAKpD,SAAS,GAAG2C,aAAG,CAACC,MAAM,kBAAC;;;OAG7B,CAA4B;OAC5B,CAA0B;;MAE3B,CAA6B;;GAE/B,GALK,4CAAI,YAAKjC,MAAM,CAACX,SAAS,EACzB,4CAAI,YAAKE,IAAI,CAACF,SAAS,EAExBmD,0BAA0B,CAE7B;KAED,IAAI,4CAAI,sBAAUrB,gBAAgB,EAClC;OACCuB,aAAG,CAACC,MAAM,CAAC,4CAAI,8CAAsBV,MAAM,EAAE,EAAE,4CAAI,YAAK5C,SAAS,CAAC;;KAGnE,OAAO,4CAAI,YAAKA,SAAS;;GAqZ1BuD,0BAA0B,GAC1B;KAAA;KACC,iCAAO,4CAAI,sBAAU3D,QAAQ,qCAAI,IAAI;;GAkBtC4D,aAAa,CAAC7D,EAAU,EACxB;KAAA;KACC,MAAMwC,OAAO,2CAAG,IAAI,oCAAiBxC,EAAE,CAAC;KACxC,IAAI4C,cAAI,CAACC,WAAW,CAACL,OAAO,CAAC,EAC7B;OACC;;KAGD,4CAAI,sBAAUxC,EAAE,GAAGwC,OAAO,CAACxC,EAAE;KAC7B,4CAAI,sBAAUC,QAAQ,GAAG,IAAI;KAC7B,IAAI,CAAAuC,OAAO,0CAAPA,OAAO,CAAEE,SAAS,qBAAlB,mBAAoBoB,MAAM,IAAG,CAAC,EAClC;OAAA;OACC,MAAMC,iBAAiB,mDAAGvB,OAAO,CAACE,SAAS,qBAAjB,oBACvBsB,MAAM,CAAE/D,QAAQ,IAAKnB,yBAAyB,CAACmF,QAAQ,CAAChE,QAAQ,CAACC,IAAI,CAAC,CAAC,oCACtE,EAAE;OAEN,IAAI6D,iBAAiB,CAACD,MAAM,GAAG,CAAC,EAChC;SACC,4CAAI,sBAAU7D,QAAQ,GAAG8D,iBAAiB,CAAC,CAAC,CAAC;;;KAI/C,4CAAI;KACJ,sEAAI,4BAAcG,QAAQ,EAAE,CAC1BzB,IAAI,CAAE0B,IAAI,IAAKA,IAAI,CAACnE,EAAE,KAAK,4CAAI,sBAAUA,EAAE,CAAC,qBAD9C,uBAEGgB,MAAM,EAAE;KAEX,4CAAI,8CAAsB8B,YAAY,CAAC,4CAAI,sBAAU9C,EAAE,CAAC;KACxD,IAAI,CAACoE,IAAI,CAAC,IAAI,CAACxE,MAAM,CAACE,QAAQ,EAAE;OAAEuE,SAAS,EAAE,4CAAI,sBAAUrE;MAAI,CAAC;;GAwZjEsE,YAAY,GACZ;KAAA;KACC,yEAAO,IAAI,0CAAJ,uBAAetE,EAAE;;GAGzBuE,gBAAgB,GAChB;KACC,OAAO,4CAAI,8CAAsBC,aAAa,EAAE;;GAGjDC,yBAAyB,CAACC,aAA4B,EACtD;KACC,4CAAI,8CAAsBC,cAAc,CAACD,aAAa,CAAC;;GAGxDE,QAAQ,GACR;KAAA;KACClB,aAAG,CAACmB,WAAW,CAAC,4CAAI,YAAKxE,SAAS,EAAE,WAAW,CAAC;KAChDqD,aAAG,CAACmB,WAAW,CAAC,4CAAI,YAAK5E,QAAQ,CAACI,SAAS,CAACyE,iBAAiB,EAAE,WAAW,CAAC;KAC3E,MAAMC,eAAe,GAAGnC,cAAI,CAACoC,QAAQ,CAAC,4CAAI,sBAAU/E,QAAQ,CAAC,IACzD2C,cAAI,CAACqC,cAAc,CAAC,4CAAI,sBAAUhF,QAAQ,CAACE,GAAG,CAAC,IAC/C,yCAAC,IAAI,0CAAoB,4CAAI,sBAAUF,QAAQ,CAAC;KAEpD,MAAMuC,OAAO,2CAAG,IAAI,8DAAiB,4CAAI,sBAAUxC,EAAE,qCAAI,CAAC,CAAC;KAC3D,MAAMkF,cAAc,GAAGtC,cAAI,CAACoC,QAAQ,CAACxC,OAAO,CAAC,IAAIA,OAAO,CAACxC,EAAE,GAAG,CAAC,IAAIwC,OAAO,CAAC5B,KAAK,GAAG,CAAC;KACpF,MAAMuE,OAAO,GAAGD,cAAc,IAAIH,eAAe;KAEjD,IAAI,CAACG,cAAc,EACnB;OACCxB,aAAG,CAAC0B,QAAQ,CAAC,4CAAI,YAAK/E,SAAS,EAAE,WAAW,CAAC;MAC7C,MACI,IAAI,CAAC0E,eAAe,EACzB;OACCrB,aAAG,CAAC0B,QAAQ,CAAC,4CAAI,YAAKnF,QAAQ,CAACI,SAAS,CAACyE,iBAAiB,EAAE,WAAW,CAAC;;KAGzE,OAAOK,OAAO;;GAGf,MAAME,IAAI,CAACC,UAAkB,EAC7B;KACC,8CAAM,IAAI,mEAAiC;KAC3C,MAAMrF,QAAQ,GAAG,4CAAI,sBAAUA,QAAQ;KAEvC,IAAI,4CAAI,sBAAUkC,gBAAgB,EAClC;OAAA;OACC,MAAM,4CAAI,cAAMoD,mBAAmB,CAACD,UAAU,oEAAE,IAAI,kEAAJ,uBAA2Bd,aAAa,EAAE,CAAC;;KAG5F,OAAOgB,OAAO,CAACC,GAAG,CAAC,CAClB,4CAAI,cAAMC,gBAAgB,CAACJ,UAAU,EAAErF,QAAQ,CAACE,GAAG,CAAC,EACpD,4CAAI,cAAMwF,uBAAuB,CAACL,UAAU,0CAAE,IAAI,oEAAiCrF,QAAQ,CAACC,IAAI,EAAE,CAClG,CAAC;;GAkHH0F,kBAAkB,CAACC,eAAsC,EACzD;KACC,IAAI,CAAC9C,UAAU,CAAC;OAAE+C,qBAAqB,EAAED;MAAiB,CAAC;;CA4C7D;CAAC,wBAxxCA;GACCE,EAAE,CAACC,IAAI,CAAC,4CAAI,YAAKzF,IAAI,CAACF,SAAS,CAAC;GAChC0F,EAAE,CAACC,IAAI,CAAC,4CAAI,YAAKhF,MAAM,CAACX,SAAS,CAAC;GAClC,4CAAI,4BAAc+C,IAAI,CAAC,4CAAI,YAAK/C,SAAS,CAAC;CAC3C;CAAC,wBAGD;GACC,4CAAI;GACJ,4CAAI,4BAAc2F,IAAI,EAAE;CACzB;CAAC,kCAiOD;GACC,MAAMC,KAAK,GAAG,IAAIC,eAAK,CAAC;KACvBlG,EAAE,EAAE,wBAAwB;KAC5BmG,QAAQ,EAAE,IAAI;KACdC,QAAQ,EAAE,IAAI;KACdC,KAAK,EAAE,CACN;OACCC,MAAM,EAAE,4CAAI,YAAKrG,QAAQ,CAACoB,SAAS,CAACK,oBAAoB;OACxDlB,KAAK,EAAG;;SAEJ0C,aAAG,CAACC,UAAU,CAAC,oBAAoB,CAAE;;MAExC;OACDlC,IAAI,EAAG;;SAEHiC,aAAG,CAACC,UAAU,CAAC,oBAAoB,CAAE;;;MAGxC;OACDoD,SAAS,EAAE;SACVC,GAAG,EAAE,IAAI;SACTC,MAAM,EAAE,KAAK;SACbC,KAAK,EAAE;;MAER,CACD;KACDC,YAAY,EAAE;OACbC,KAAK,EAAE,GAAG;OACVC,QAAQ,EAAE,IAAI;OACdC,SAAS,EAAE,gDAAgD;OAC3DC,WAAW,EAAE;;IAEd,CAAC;GACFd,KAAK,CAACe,SAAS,EAAE;CAClB;CAAC,6BAGD;GACC,MAAMC,IAAI,GAAG,IAAIC,eAAI,CAAC;KACrBC,WAAW,EAAE,4CAAI,YAAKlH,QAAQ,CAACoB,SAAS,CAACM,qBAAqB;KAC9DyF,SAAS,EAAE;IACX,CAAC;GACFH,IAAI,CAACI,WAAW,CAAC;KAChBpG,IAAI,EAAEiC,aAAG,CAACC,UAAU,CAAC,8BAA8B,CAAC;KACpDmE,OAAO,EAAE,MAAM;OACd,4CAAI;OACJL,IAAI,CAACM,KAAK,EAAE;;IAEb,CAAC;GACFN,IAAI,CAAC7D,IAAI,EAAE;CACZ;CAAC,2BAGD;GACC2C,EAAE,CAACC,IAAI,CAAC,4CAAI,YAAKzF,IAAI,CAACF,SAAS,CAAC;GAChC0F,EAAE,CAACC,IAAI,CAAC,4CAAI,YAAK/F,QAAQ,CAACI,SAAS,CAAC;GACpC,4CAAI,8CAAsB2F,IAAI,EAAE;GAChC,4CAAI,YAAKhF,MAAM,CAACX,SAAS,CAACiD,KAAK,CAACC,OAAO,GAAG,MAAM;CACjD;CAAC,0BAGD;GACC,4CAAI,YAAKhD,IAAI,CAACF,SAAS,CAACiD,KAAK,CAACC,OAAO,GAAG,MAAM;GAC9CwC,EAAE,CAACC,IAAI,CAAC,4CAAI,YAAKhF,MAAM,CAACX,SAAS,CAAC;CACnC;CAAC,wBAGD;GAAA;GACC,4CAAI;GACJ,MAAMmH,kBAAkB,6BAAG,4CAAI,sBAAUA,kBAAkB,qCACvD,4CAAI,cAAMC,kBAAkB,2BAAC,4CAAI,sBAAU3B,qBAAqB,qCAAI4B,uCAAiB,CAAClF,OAAO,CAAC;GAGlG,IAAImF,IAAI,GAAG,IAAI;GACf,IACA;KACCA,IAAI,GAAG,MAAMH,kBAAkB;IAC/B,CACD,OAAOI,KAAK,EACZ;KACC,4CAAI;KACJC,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC;KAElB;;GAGD,4CAAI;GACJ,IAAIhF,cAAI,CAACoC,QAAQ,CAAC2C,IAAI,CAACI,SAAS,CAAC,IAAInF,cAAI,CAACoF,OAAO,CAACL,IAAI,CAACI,SAAS,CAAC,EACjE;KAAA;KACC,4CAAI,gCAAgBJ,IAAI,CAACI,SAAS;KAClC,4CAAI,4BAAcE,OAAO,UAACN,IAAI,qBAAJ,MAAMO,SAAS,CAAC;KAC1C,4CAAI;KACJ,IAAI,CAAC9D,IAAI,CAAC,IAAI,CAACxE,MAAM,CAACC,eAAe,EAAE;OAAEkI,SAAS,0CAAE,IAAI;MAAe,CAAC;;CAE1E;CAAC,uBAGD;GACC,4CAAI,IAAI,qBACR;KACC,+CAAO,IAAI;;GAGZ,4CAAI,sBAAW,IAAIhC,EAAE,CAACoC,MAAM,CAAC;KAC5B7B,MAAM,EAAE,4CAAI,YAAKjG,SAAS;KAC1B+H,IAAI,EAAE,QAAQ;KACdC,IAAI,EAAE;IACN,CAAC;GAEF,+CAAO,IAAI;CACZ;CAAC,uBAGD;GAAA;GACC,4CAAI,IAAI,qBACR;KACC,+CAAO,IAAI;;GAGZ,IAAIC,MAAM,GAAG,IAAI;GACjB,8BAAI,4CAAI,sBAAUC,gBAAgB,qCAAI,IAAI,EAC1C;KACCD,MAAM,GAAGtF,aAAG,CAACC,MAAM,kBAAC;;;gBAGT,CAA8B;;OAEvC,CAAyC;;IAE3C,GAJa,8CAAM,IAAI,mCAAiB,EAEpCC,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC,CAEzC;;GAEF,4CAAI,sBAAW,IAAIqF,wBAAM,CAAC;KACzBC,UAAU,EAAE,4CAAI,YAAKpI,SAAS;KAC9BuG,KAAK,EAAE,GAAG;KACV8B,MAAM,EAAE,GAAG;KACXC,KAAK,EAAE,4CAAI,8BAAcC,GAAG,CAAEpG,OAAO,IAAK;OAAA;OACzC,OAAO;SACNxC,EAAE,EAAEwC,OAAO,CAACxC,EAAE;SACd6I,QAAQ,EAAE,aAAa;SACvBrI,KAAK,EAAEgC,OAAO,CAAChC,KAAK;SACpBsI,IAAI,EAAE,eAAe;SACrBC,YAAY,6BAAE,4CAAI,sBAAUC,uBAAuB,sCAAI;QACvD;MACD,CAAC;KACFF,IAAI,EAAE,CACL;OAAE9I,EAAE,EAAE,eAAe;OAAEQ,KAAK,EAAE0C,aAAG,CAACC,UAAU,CAAC,wBAAwB;MAAG,CACxE;KACD8F,WAAW,EAAE,KAAK;KAClBC,YAAY,EAAE,IAAI;KAClBC,QAAQ,EAAE,KAAK;KACfC,YAAY,EAAE,IAAI;KAClBxJ,MAAM,EAAE;OACP,eAAe,EAAGyJ,KAAK,IAAK;SAC3B,4CAAI,wDAA2BA,KAAK;SACpC,4CAAI,oBAASrD,IAAI,EAAE;QACnB;OACD,iBAAiB,EAAGqD,KAAK,IAAK;SAC7B,4CAAI,4DAA6BA,KAAK;SACtC,4CAAI,oBAASrD,IAAI,EAAE;;MAEpB;KACDsC;IACA,CAAC;GAEF,+CAAO,IAAI;CACZ;CAAC,6BAGD;GACC,4CAAI,IAAI,iCACR;KACC,+CAAO,IAAI;;GAGZ,4CAAI,kCAAiB,IAAIE,wBAAM,CAAC;KAC/B5B,KAAK,EAAE,GAAG;KACV8B,MAAM,EAAE,GAAG;KACXD,UAAU,EAAE,4CAAI,YAAKxI,QAAQ,CAACI,SAAS,CAACyE,iBAAiB;KACzD6D,KAAK,EAAE,EAAE;KACTM,WAAW,EAAE,IAAI;KACjBC,YAAY,EAAE,IAAI;KAClBC,QAAQ,EAAE,KAAK;KACftC,QAAQ,EAAE,IAAI;KACdiC,IAAI,EAAE,CACL;OAAE9I,EAAE,EAAE,eAAe;OAAEQ,KAAK,EAAE0C,aAAG,CAACC,UAAU,CAAC,wBAAwB;MAAG,CACxE;KACDvD,MAAM,EAAE;OACP,eAAe,EAAE,CAAC;SAAE+H;QAAM,KAAK;SAC9B,4CAAI,wCAAmBA,IAAI,CAACxD,IAAI,CAACnE,EAAE;QACnC;OACD,iBAAiB,EAAE,8CAAM,IAAI;MAC7B;KACDsI,MAAM,0CAAE,IAAI;IACZ,CAAC;GAEF,+CAAO,IAAI;CACZ;CAAC,kCAGD;GAAA;GACC,MAAM9F,OAAO,2CAAG,IAAI,uGAAiB,IAAI,0CAAJ,wBAAexC,EAAE,CAAC;GACvD,IAAIwC,OAAO,YAAPA,OAAO,CAAE8G,WAAW,EACxB;KACC,OAAOtG,aAAG,CAACC,MAAM,kBAAC;;;gBAGP,CAGP;;OAEF,CAAuD;;IAEzD,GAPa,MAAM;OAChB,4CAAI,gCAAe+C,IAAI,EAAE;OACzB,4CAAI;MACJ,EAEC9C,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;;GAKzD,OAAO,IAAI;CACZ;CAAC,0BAEenD,EAAU,EAC1B;GACC,MAAMuJ,YAAY,2CAAG,IAAI,uCAAmB;GAC5C,MAAM7G,SAAS,GAAG6G,YAAY,CAACrF,QAAQ,EAAE;GACzC,MAAMsF,eAAe,GAAG9G,SAAS,CAACD,IAAI,CAAExC,QAAQ,IAAKA,QAAQ,CAACD,EAAE,KAAKA,EAAE,CAAC;GACxEwJ,eAAe,oBAAfA,eAAe,CAAExI,MAAM,EAAE;CAC1B;CAAC,gCAGD;GACC,4CAAI,YAAKf,QAAQ,CAAC6B,KAAK,CAACzB,SAAS,CAACiD,KAAK,CAACC,OAAO,GAAG,MAAM;GACxDwC,EAAE,CAACC,IAAI,CAAC,4CAAI,YAAK/F,QAAQ,CAACoB,SAAS,CAAChB,SAAS,CAAC;GAC9C,4CAAI;GACJ,4CAAI,gCAAe2F,IAAI,EAAE;GACzB,4CAAI,sBAAU/F,QAAQ,GAAG,IAAI;CAC9B;CAAC,4BAEiBD,EAAU,EAC5B;GAAA;GACC,MAAMwC,OAAO,2CAAG,IAAI,+DAAiB,4CAAI,sBAAUxC,EAAE,sCAAI,CAAC,CAAC;GAC3D,MAAMC,QAAQ,GAAGuC,OAAO,CAACE,SAAS,CAACD,IAAI,CAAExC,QAAQ,IAAKA,QAAQ,CAACE,GAAG,KAAKH,EAAE,CAAC;GAC1E+F,EAAE,CAACC,IAAI,CAAC,4CAAI,YAAK/F,QAAQ,CAAC6B,KAAK,CAACzB,SAAS,CAAC;GAC1C0F,EAAE,CAAC3C,IAAI,CAAC,4CAAI,YAAKnD,QAAQ,CAACoB,SAAS,CAAChB,SAAS,CAAC;GAC9C0F,EAAE,CAAC3C,IAAI,CAAC,4CAAI,YAAKnD,QAAQ,CAACM,IAAI,CAAC;GAC/B,4CAAI,oCAAiBN,QAAQ,EAAEuC,OAAO,CAAC5B,KAAK;GAC5C,4CAAI,gCAAeoF,IAAI,EAAE;CAC1B;CAAC,kCAGD;GACC,MAAMyD,eAAe,GAAG3K,yBAAyB,CAAC8J,GAAG,CAAE3I,QAAQ,IAAM,KAAIA,QAAS,EAAC,CAAC;GACpFwJ,eAAe,CAACC,IAAI,CAAC,WAAW,CAAC;GACjChG,aAAG,CAACmB,WAAW,CAAC,4CAAI,YAAK5E,QAAQ,CAACoB,SAAS,CAAChB,SAAS,EAAEoJ,eAAe,CAAC;CACxE;CAAC,2BAGD;GACC,4CAAI,kCAAiB,IAAI;GACzB,4CAAI;CACL;CAAC,gCAGD;GAAA;GACC,4CAAI;GACJ,MAAMxC,IAAI,2CAAG,IAAI,uCAAmB;GACpC,MAAMzE,OAAO,2CAAG,IAAI,oCAAiB,4CAAI,sBAAUxC,EAAE,CAAC;GAEtDwC,OAAO,CAACE,SAAS,CAACiH,OAAO,CAAE1J,QAAkB,IAAK;KACjD,MAAM;OAAE2J,YAAY;OAAEnI;MAAa,2CAAG,IAAI,wCAAmBxB,QAAQ,EAAEuC,OAAO,CAAC5B,KAAK,CAAC;KAErFqG,IAAI,CAAC4C,OAAO,CAAC;OACZ7J,EAAE,EAAEC,QAAQ,CAACE,GAAG;OAChBK,KAAK,EAAEoJ,YAAY;OACnBE,QAAQ,EAAErI,WAAW;OACrBsI,MAAM,0CAAE,IAAI,sCAAkB9J,QAAQ,CAAC;OACvC4I,QAAQ,EAAE,cAAc;OACxBC,IAAI,EAAE,eAAe;OACrBkB,MAAM,0CAAE,IAAI,sCAAkB/J,QAAQ;MACtC,CAAC;IACF,CAAC;GACF,MAAM,CAACgK,SAAS,CAAC,GAAGhD,IAAI,CAAC/C,QAAQ,EAAE;GACnC+F,SAAS,CAACjJ,MAAM,EAAE;GAElB,MAAMkJ,eAAe,GAAG,EAAC1H,OAAO,YAAPA,OAAO,CAAE8G,WAAW,KAAI,CAAA9G,OAAO,2CAAPA,OAAO,CAAEE,SAAS,qBAAlB,oBAAoBoB,MAAM,IAAG,CAAC;GAC/E,4CAAI,YAAK7D,QAAQ,CAACoB,SAAS,CAACK,oBAAoB,CAAC4B,KAAK,CAACC,OAAO,GAAG2G,eAAe,GAC7E,MAAM,GACN,OAAO;CAEX;CAAC,8BAEmBjK,QAAyB,GAAG,IAAI,EACpD;GAAA;GACC,MAAMC,IAAI,qBAAGD,QAAQ,oBAARA,QAAQ,CAAEC,IAAI,6BAAI,EAAE;GACjCwD,aAAG,CAACyG,KAAK,CAAC,4CAAI,YAAKlK,QAAQ,CAACM,IAAI,CAAC;GACjC,IAAI,CAACN,QAAQ,EACb;KACC,MAAMmK,cAAc,GAAGpH,aAAG,CAACC,MAAM,kBAAC;;OAEhC,CAAkE;;IAEpE,GAFIC,aAAG,CAACC,UAAU,CAAC,+CAA+C,CAAC,CAElE;KACD,MAAMkH,eAAe,GAAGrH,aAAG,CAACC,MAAM,kBAAC;;OAEjC,CAAkE;;IAEpE,GAFIC,aAAG,CAACC,UAAU,CAAC,+CAA+C,CAAC,CAElE;KACD,MAAMmH,cAAc,GAAGtH,aAAG,CAACC,MAAM,kBAAC;;OAEhC,CAGA;;IAEF,GALIsH,uBAAQ,CAACC,WAAW,CACvBtH,aAAG,CAACC,UAAU,CAAC,wCAAwC,CAAC,EACxDlE,aAAa,CAACC,mBAAmB,CACjC,CAEA;KACDwE,aAAG,CAACC,MAAM,CAACyG,cAAc,EAAE,4CAAI,YAAKnK,QAAQ,CAACM,IAAI,CAAC;KAClDmD,aAAG,CAACC,MAAM,CAAC0G,eAAe,EAAE,4CAAI,YAAKpK,QAAQ,CAACM,IAAI,CAAC;KACnDmD,aAAG,CAACC,MAAM,CAAC2G,cAAc,EAAE,4CAAI,YAAKrK,QAAQ,CAACM,IAAI,CAAC;KAElD;;GAGD,IAAIL,IAAI,KAAK3B,YAAY,CAACM,QAAQ,EAClC;KACC,MAAM4L,OAAO,GAAGzH,aAAG,CAACC,MAAM,kBAAC;UACtB,CAA0C;IAC/C,GADOyH,cAAU,CAACC,MAAM,CAAC1K,QAAQ,CAACwB,WAAW,CAAC,CAC7C;KAEDiC,aAAG,CAACC,MAAM,CAAC8G,OAAO,EAAE,4CAAI,YAAKxK,QAAQ,CAACM,IAAI,CAAC;KAE3C;;GAGD,IAAIL,IAAI,KAAK3B,YAAY,CAACI,MAAM,EAChC;KAAA;KACC,IAAIiM,YAAY,sBAAG1H,aAAG,CAACC,UAAU,CAAC,+BAA+B,CAAC,8BAAI,EAAE;KACxEyH,YAAY,GAAGL,uBAAQ,CAACC,WAAW,CAClCI,YAAY,EACZ3L,aAAa,CAACI,aAAa,CAC3B;KACDuL,YAAY,GAAGC,mBAAI,CAACC,YAAY,CAC/BF,YAAY,EACZ7L,mBAAmB,CACnB;KAED,MAAMkC,IAAI,GAAG+B,aAAG,CAACC,MAAM,kBAAC,SAAM,CAAe,SAAO,GAApB2H,YAAY,CAAS;;KAErD3J,IAAI,CAAC6D,iBAAiB,CAACxB,KAAK,CAACC,OAAO,GAAG,MAAM;KAC7CG,aAAG,CAACC,MAAM,CAAC1C,IAAI,EAAE,4CAAI,YAAKhB,QAAQ,CAACM,IAAI,CAAC;KAExC;;GAGD,MAAMwK,iCAAuE,GAAG;KAC/ErM,MAAM,EAAEwE,aAAG,CAACC,UAAU,CAAC,8BAA8B,CAAC;KACtD,QAAQ,EAAED,aAAG,CAACC,UAAU,CAAC,8BAA8B;IACvD;GACD,MAAM6H,6BAAkE,GAAG;KAC1EtM,MAAM,EAAEO,aAAa,CAACE,aAAa;KACnC,QAAQ,EAAEF,aAAa,CAACG;IACxB;GAED,MAAM6B,IAAI,GAAG+B,aAAG,CAACC,MAAM,kBAAC,SAAM,CAG5B,SAAO,GAHuBsH,uBAAQ,CAACC,WAAW,0BACnDO,iCAAiC,CAAC7K,IAAI,CAAC,oCAAI,EAAE,2BAC7C8K,6BAA6B,CAAC9K,IAAI,CAAC,oCAAI,EAAE,CACzC,CAAS;GACVwD,aAAG,CAACC,MAAM,CAAC1C,IAAI,EAAE,4CAAI,YAAKhB,QAAQ,CAACM,IAAI,CAAC;GAExC,IAAI,4CAAI,kDAAwBN,QAAQ,6CAAK,IAAI,0CAAoBA,QAAQ,CAAC,EAC9E;KACCyD,aAAG,CAACC,MAAM,CAAC,4CAAI,wCAAmB1D,QAAQ,EAAEgD,MAAM,EAAE,EAAE,4CAAI,YAAKhD,QAAQ,CAACM,IAAI,CAAC;;CAE/E;CAAC,0BAEeN,QAAkB,EAAEW,KAAa,EACjD;GACC,IAAI,CAAC9B,yBAAyB,CAACmF,QAAQ,CAAChE,QAAQ,CAACC,IAAI,CAAC,EACtD;KACC;;GAGD,MAAM;KAAE0J,YAAY;KAAEnI;IAAa,2CAAG,IAAI,wCAAmBxB,QAAQ,EAAEW,KAAK,CAAC;GAC7E,4CAAI,YAAKX,QAAQ,CAACoB,SAAS,CAACX,IAAI,CAACuK,WAAW,GAAGrB,YAAY;GAC3D,4CAAI,YAAK3J,QAAQ,CAACoB,SAAS,CAACI,WAAW,CAACwJ,WAAW,GAAGxJ,WAAW;GAEjE,4CAAI,4CAAqBxB,QAAQ;GACjC,4CAAI;GACJyD,aAAG,CAAC0B,QAAQ,CAAC,4CAAI,YAAKnF,QAAQ,CAACoB,SAAS,CAAChB,SAAS,EAAG,iBAAgBJ,QAAQ,CAACC,IAAK,EAAC,CAAC;GACrF,IAAID,QAAQ,CAACC,IAAI,KAAK3B,YAAY,CAACM,QAAQ,EAC3C;KACC,4CAAI,wCAAmBoB,QAAQ;;GAGhCyD,aAAG,CAACyG,KAAK,CAAC,4CAAI,YAAKlK,QAAQ,CAACoB,SAAS,CAACG,kBAAkB,CAAC;GACzD,4CAAI,IAAI,0CAAoBvB,QAAQ,GACpC;KACCyD,aAAG,CAAC0B,QAAQ,CAAC,4CAAI,YAAKnF,QAAQ,CAACoB,SAAS,CAAChB,SAAS,EAAE,WAAW,CAAC;KAChEqD,aAAG,CAACC,MAAM,CAAC,4CAAI,4BAAcV,MAAM,EAAE,EAAE,4CAAI,YAAKhD,QAAQ,CAACoB,SAAS,CAACG,kBAAkB,CAAC;;GAEvF,4CAAI,YAAKvB,QAAQ,CAACoB,SAAS,CAACM,qBAAqB,CAAC2B,KAAK,CAACC,OAAO,GAAGtD,QAAQ,CAACiL,YAAY,GAAG,MAAM,GAAG,OAAO;GAC1G,4CAAI,sBAAUjL,QAAQ,GAAGA,QAAQ;CAClC;CAAC,oCAOyBoJ,KAAK,EAC/B;GACC,IAAI,CAACA,KAAK,CAAC1B,IAAI,IAAI0B,KAAK,CAAC1B,IAAI,CAAC7D,MAAM,KAAK,CAAC,EAC1C;KACC;;GAED,MAAMqH,YAAY,GAAG9B,KAAK,CAAC1B,IAAI,CAACxD,IAAI;GACpC,IAAI,CAAAgH,YAAY,oBAAZA,YAAY,CAAEnL,EAAE,KAAI,CAAC,EACzB;KACC;;GAGD,IAAI,CAAC6D,aAAa,CAACsH,YAAY,oBAAZA,YAAY,CAAEnL,EAAE,CAAC;CACrC;CAAC,yBAkCD;GAAA;GACC,MAAMmL,YAAY,2CAAG,IAAI,uGAAiB,IAAI,0CAAJ,wBAAenL,EAAE,CAAC;GAC5D,IAAI,CAACmL,YAAY,EACjB;KACC;;GAGD,4CAAI,YAAK5K,IAAI,CAACC,KAAK,CAACC,MAAM,CAACC,IAAI,CAAC0K,SAAS,GAAGD,YAAY,CAAC3K,KAAK;GAC9D,IAAI,4CAAI,YAAKD,IAAI,CAACM,UAAU,EAC5B;KACCkF,EAAE,CAAC3C,IAAI,CAAC,4CAAI,YAAK7C,IAAI,CAACM,UAAU,CAAC;;GAGlC,IAAI,4CAAI,YAAKN,IAAI,CAACO,cAAc,EAChC;KACCiF,EAAE,CAAC3C,IAAI,CAAC,4CAAI,YAAK7C,IAAI,CAACO,cAAc,CAAC;;GAEtC,IAAI8B,cAAI,CAACqC,cAAc,CAACkG,YAAY,CAACvK,KAAK,CAAC,EAC3C;KACC,4CAAI,YAAKL,IAAI,CAACC,KAAK,CAACI,KAAK,CAACwK,SAAS,GAAGlI,aAAG,CAACC,UAAU,CACnD,wBAAwB,EACxB;OAAE,YAAY,EAAEuH,cAAU,CAACC,MAAM,CAACQ,YAAY,CAACvK,KAAK;MAAG,CACvD;KACD,4CAAI,YAAKL,IAAI,CAACC,KAAK,CAACI,KAAK,CAAC0C,KAAK,CAACC,OAAO,GAAG,4CAAI,4BAAc,EAAE,GAAG,MAAM;KACvEG,aAAG,CAACsC,IAAI,yCAAC,IAAI,4DAA8B;KAE3C,IAAI,4CAAI,YAAKzF,IAAI,CAACO,cAAc,EAChC;OACCiF,EAAE,CAACC,IAAI,CAAC,4CAAI,YAAKzF,IAAI,CAACO,cAAc,CAAC;;IAEtC,MAED;KACC,4CAAI,YAAKP,IAAI,CAACC,KAAK,CAACI,KAAK,CAACqK,WAAW,GAAG,EAAE;KAC1CvH,aAAG,CAACN,IAAI,yCAAC,IAAI,4DAA8B;KAC3C,IAAI,4CAAI,YAAK7C,IAAI,CAACM,UAAU,EAC5B;OACCkF,EAAE,CAACC,IAAI,CAAC,4CAAI,YAAKzF,IAAI,CAACM,UAAU,CAAC;;;GAInC,4CAAI;GACJ,4CAAI,8CAAsBsK,YAAY,CAACvK,KAAK;GAC5C,4CAAI;CACL;CAAC,gCAGD;GACCmF,EAAE,CAAC3C,IAAI,CAAC,4CAAI,YAAKnD,QAAQ,CAACI,SAAS,CAAC;GACpC0F,EAAE,CAAC3C,IAAI,CAAC,4CAAI,YAAKnD,QAAQ,CAACM,IAAI,CAAC;GAC/BwF,EAAE,CAAC3C,IAAI,CAAC,4CAAI,YAAKnD,QAAQ,CAAC2B,YAAY,CAACT,MAAM,CAAC;GAC9C,4CAAI,YAAKlB,QAAQ,CAACoB,SAAS,CAAChB,SAAS,CAACiD,KAAK,CAACC,OAAO,GAAG,MAAM;GAC5D,4CAAI,YAAKtD,QAAQ,CAAC2B,YAAY,CAACvB,SAAS,CAACiD,KAAK,CAACC,OAAO,GAAG,MAAM;CAChE;CAAC,+BAEoB3C,KAAc,EACnC;GAAA;GACC,MAAM4B,OAAO,2CAAG,IAAI,+DAAiB,4CAAI,sBAAUxC,EAAE,sCAAI,CAAC,CAAC;GAC3D,IAAI,CAAAwC,OAAO,2CAAPA,OAAO,CAAEE,SAAS,qBAAlB,oBAAoBoB,MAAM,IAAG,CAAC,EAClC;KACCiC,EAAE,CAACC,IAAI,CAAC,4CAAI,YAAK/F,QAAQ,CAAC2B,YAAY,CAACvB,SAAS,CAAC;KACjD,4CAAI;KACJ,IAAI,4CAAI,sBAAUgL,MAAM,KAAK,IAAI,IAAI,4CAAI,sBAAUvF,qBAAqB,KAAK4B,uCAAiB,CAAC4D,QAAQ,EACvG;OACC,4CAAI;;KAGL;;GAGDvF,EAAE,CAACC,IAAI,CAAC,4CAAI,YAAK/F,QAAQ,CAACoB,SAAS,CAAChB,SAAS,CAAC;GAC9C0F,EAAE,CAACC,IAAI,CAAC,4CAAI,YAAK/F,QAAQ,CAAC6B,KAAK,CAACzB,SAAS,CAAC;GAC1C0F,EAAE,CAACC,IAAI,CAAC,4CAAI,YAAK/F,QAAQ,CAACM,IAAI,CAAC;GAC/B,IAAI,CAACK,KAAK,EACV;KACCmF,EAAE,CAACC,IAAI,CAAC,4CAAI,YAAK/F,QAAQ,CAAC2B,YAAY,CAACT,MAAM,CAAC;;CAEhD;CAAC,+BAGD;GACC,4CAAI,sBAAW,IAAI;GACnB,4CAAI,8DAAW,IAAI,2BAAa;GAChC,MAAMgD,IAAI,GAAG,4CAAI,oBAASD,QAAQ,EAAE,CAACzB,IAAI,CAAE0B,IAAI,IAAKA,IAAI,CAACnE,EAAE,KAAK,4CAAI,sBAAUA,EAAE,CAAC;GACjFmE,IAAI,oBAAJA,IAAI,CAAEnD,MAAM,EAAE;CACf;CAAC,0BAEehB,EAAU,EAC1B;GACC,OAAO,4CAAI,8BAAcyC,IAAI,CAAED,OAAO,IAAKxC,EAAE,KAAKwC,OAAO,CAACxC,EAAE,CAAC;CAC9D;CAAC,4BAEiBC,QAAkB,EAAEW,KAAa,EACnD;GACC,MAAMgJ,YAAY,GAAG3J,QAAQ,CAACC,IAAI,KAAK,UAAU,2CAC9C,IAAI,kDAAwBD,QAAQ,CAACC,IAAI,IACzCD,QAAQ,CAACS,IAAI;GAEhB,MAAMe,WAAW,2CAAG,IAAI,sEAAkCxB,QAAQ,EAAEW,KAAK,CAAC;GAE1E,OAAO;KAAEgJ,YAAY;KAAEnI;IAAa;CACrC;CAAC,2CAEgCxB,QAAkB,EAAEW,KAAa,EAClE;GACC,IAAIX,QAAQ,CAACiL,YAAY,EACzB;KACC,OAAO,4CAAI,4BACRhI,aAAG,CAACC,UAAU,CAAC,uCAAuC,EAAE;OACzD,SAAS,EAAEvC;MACX,CAAC,GACAsC,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;;GAI/D,MAAMoI,aAAa,GAAGC,wBAAc,CAACC,MAAM,CAC1CD,wBAAc,CAACE,SAAS,CAAC,aAAa,CAAC,EACvCzL,QAAQ,CAACG,SAAS,CAClB;GAED,OAAO,4CAAI,4BACR8C,aAAG,CAACC,UAAU,CAAC,0BAA0B,EAAE;KAC5C,SAAS,EAAEvC,KAAK;KAChB,QAAQ,EAAE2K;IACV,CAAC,GACArI,aAAG,CAACC,UAAU,CAAC,sCAAsC,EAAE;KAAE,QAAQ,EAAEoI;IAAe,CAAC;CAEvF;CAAC,iCAEsBrL,IAAI,EAC3B;GACC,QAAQA,IAAI;KAEX,KAAK,QAAQ;OACZ,OAAOgD,aAAG,CAACC,UAAU,CAAC,+BAA+B,CAAC;KACvD,KAAK,QAAQ;OACZ,OAAOD,aAAG,CAACC,UAAU,CAAC,+BAA+B,CAAC;KACvD,KAAK,QAAQ;OACZ,OAAOD,aAAG,CAACC,UAAU,CAAC,4BAA4B,CAAC;KACpD,KAAK,SAAS;OACb,OAAOD,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC;KACxD;OACC,OAAO,EAAE;;CAEZ;CAAC,2CAGD;GAAA;GACC,MAAMX,OAAO,2CAAG,IAAI,uGAAiB,IAAI,0CAAJ,wBAAexC,EAAE,CAAC;GACvD,IAAIwC,OAAO,IAAIA,OAAO,CAAC8G,WAAW,EAClC;KACC,MAAMqC,GAAG,GAAG,IAAIC,GAAG,CAACpJ,OAAO,CAAC8G,WAAW,CAAC;KACxC,MAAMuC,aAAa,GAAGF,GAAG,CAACG,MAAM;KAChC/F,EAAE,CAACgG,SAAS,CAACC,QAAQ,CAACC,IAAI,CAAC,WAAW,EAAE;OACvCrF,KAAK,EAAE,IAAI;OACXQ,SAAS,EAAE,KAAK;OAChB8E,gBAAgB,EAAE,IAAI;OACtBC,kBAAkB,EAAE,KAAK;OACzBC,eAAe,EAAE,MAAM;SACtB,MAAMC,WAAW,GAAG,kDAAkD,GACnE,sDAAsD;SACzD,4CAAI,sCAAmBrJ,aAAG,CAACC,MAAM,kBAAC,gBAAa,CAAsB,YAAS,CAAc,aAAW,GAAtDT,OAAO,CAAC8G,WAAW,EAAY+C,WAAW,CAAa;SAExG,+CAAO,IAAI;QACX;OACDzM,MAAM,EAAE;SACP0M,OAAO,EAAE,8CAAM,IAAI;;MAEpB,CAAC;KAEF,4CAAI,0CAAoBT,aAAa;KACrC,4CAAI,kEAAgCA,aAAa;KACjD,4CAAI,0DAA4BA,aAAa;;CAE/C;CAAC,6CAGD;GAAA;GACC,IAAI,CAAC,4CAAI,sBAAU5L,QAAQ,EAC3B;KACC;;GAED,MAAMuC,OAAO,2CAAG,IAAI,+DAAiB,4CAAI,sBAAUxC,EAAE,sCAAI,CAAC,CAAC;GAC3D,IAAI,CAACwC,OAAO,EACZ;KACC;;GAED,MAAMxC,EAAE,GAAG,4CAAI,sBAAUC,QAAQ,CAACE,GAAG;GACrC,IAAI,CAACH,EAAE,IAAI,4CAAI,sBAAUC,QAAQ,CAACiL,YAAY,EAC9C;KACC;;GAGD,4CAAI;GAEJ,IACA;KACC,MAAM,4CAAI,cAAMqB,gBAAgB,CAACvM,EAAE,CAAC;KACpCwC,OAAO,CAACE,SAAS,GAAGF,OAAO,CAACE,SAAS,CAACsB,MAAM,CAAE/D,QAAkB,IAAKA,QAAQ,CAACE,GAAG,KAAKH,EAAE,CAAC;KACzF,4CAAI,sBAAUC,QAAQ,GAAG,IAAI;IAC7B,CACD,OAAOuM,CAAC,EACR;KACC3E,OAAO,CAACD,KAAK,CAAC4E,CAAC,CAAC;;GAEjB,4CAAI;GACJ,IAAI,CAAC3I,aAAa,CAACrB,OAAO,CAACxC,EAAE,CAAC;CAC/B;CAAC,wBAGD;GACCyM,eAAK,CAACC,IAAI,CAAC,4CAAI,YAAK1L,MAAM,CAACG,MAAM,EAAE,OAAO,EAAE,MAAM;KACjD,4CAAI,4BAAcwL,aAAa,CAAC,4CAAI,YAAKtM,SAAS,CAAC;KACnD,4CAAI,4BAAc+C,IAAI,EAAE;IACxB,CAAC;GACFqJ,eAAK,CAACC,IAAI,CAAC,4CAAI,YAAKnM,IAAI,CAACC,KAAK,CAACC,MAAM,CAACE,cAAc,EAAE,OAAO,EAAE,MAAM;KACpE,4CAAI,4BAAcgM,aAAa,CAAC,4CAAI,YAAKtM,SAAS,CAAC;KACnD,4CAAI,4BAAc+C,IAAI,EAAE;IACxB,CAAC;GACF,IAAI,4CAAI,YAAK7C,IAAI,CAACM,UAAU,EAC5B;KACC4L,eAAK,CAACC,IAAI,CAAC,4CAAI,YAAKnM,IAAI,CAACM,UAAU,EAAE,OAAO,EAAE,8CAAM,IAAI,iCAAgB,CAAC;;GAG1E4L,eAAK,CAACC,IAAI,CAAC,4CAAI,YAAKnM,IAAI,CAACO,cAAc,EAAE,OAAO,EAAE,8CAAM,IAAI,+BAAe,CAAC;CAC7E;CAAC,sCAE2BuI,KAAK,EACjC;GACC,4CAAI,sBAAUrJ,EAAE,GAAG,IAAI;GACvB,4CAAI,8CAAsB8C,YAAY,CAAC,4CAAI,sBAAU9C,EAAE,CAAC;GACxD,4CAAI,sBAAUC,QAAQ,GAAG;KACxB2M,GAAG,EAAE,IAAI;KACTzM,GAAG,EAAE;IACL;GAED,4CAAI;CACL;CAAC,6BAEkB0L,aAAa,EAChC;GACC,4CAAI,oDAA0BgB,WAAW,CAAC,MAAM;KAC/C,IAAI,4CAAI,uCAAoB,4CAAI,oCAAiBC,aAAa,EAC9D;OACC,4CAAI,oCAAiBA,aAAa,CAACC,WAAW,CAAC,sCAAsC,EAAElB,aAAa,CAAC;;IAEtG,EAAE,GAAG,CAAC;CACR;CAAC,0BAGD;GACC,MAAM5E,IAAI,GAAG,IAAIC,eAAI,CAAC;KACrBC,WAAW,EAAE,4CAAI,YAAK5G,IAAI,CAACM,UAAU;KACrCuG,SAAS,EAAE;IACX,CAAC;GACFH,IAAI,CAACI,WAAW,CAAC;KAChBpG,IAAI,EAAEiC,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC;KAC/CmE,OAAO,EAAE,MAAM;OACd,4CAAI;OACJL,IAAI,CAACM,KAAK,EAAE;;IAEb,CAAC;GACFN,IAAI,CAAC7D,IAAI,EAAE;CACZ;CAAC,2BAGD;GACC,IAAI,4CAAI,sBAAUK,oCAAoC,EACtD;KACC,MAAMuJ,6BAA0C,GAAG,IAAIC,GAAG,CAAC,4CAAI,8BAAcrE,GAAG,CAAEpG,OAAO,IAAKA,OAAO,CAACxC,EAAE,CAAC,CAAC;KAE1G+F,EAAE,CAACgG,SAAS,CAACC,QAAQ,CAACC,IAAI,CACzB,qCAAqC,EACrC;OACC7E,SAAS,EAAE,KAAK;OAChBxH,MAAM,EAAE;SACP0M,OAAO,EAAE,YAAY;WACpB,4CAAI,oBAAStG,IAAI,EAAE;WACnB,8CAAM,IAAI,iBAAQ;WAClB,MAAMkH,UAAU,GAAG,4CAAI,8BACrBzK,IAAI,CAAC,CAAC;aAAEzC;YAAI,KAAK,CAACgN,6BAA6B,CAACG,GAAG,CAACnN,EAAE,CAAC,CAAC;WAE1D,IAAI,CAAC4C,cAAI,CAACC,WAAW,CAACqK,UAAU,CAAC,EACjC;aACC,IAAI,CAACrJ,aAAa,CAACqJ,UAAU,CAAClN,EAAE,CAAC;;;;MAIpC,CACD;KAED;;GAEDoN,mCAAa,CAACC,UAAU,CAAC;KACxBjF,IAAI,EAAEkF,uCAAiB,CAACC,MAAM;KAC9BC,gBAAgB,EAAE,4CAAI,sBAAU3E,QAAQ;KACxC4E,WAAW,EAAEvK,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC;KACtDuK,YAAY,EAAEC,0CAAoB,CAACC,GAAG;KACtCC,IAAI,EAAEC,oCAAc,CAACF,GAAG;KACxBhO,MAAM,EAAE;OACPmO,qBAAqB,EAAG1J,SAAiB,IAAW;SACnD,4CAAI,sBAAUrE,EAAE,GAAGqE,SAAS;SAC5B,4CAAI,8CAAsBvB,YAAY,CAAC,4CAAI,sBAAU9C,EAAE,CAAC;;;IAG1D,EAAE;KACFgO,cAAc,EAAE,MAAM;OACrB,4CAAI;OACJ,4CAAI,oBAAShI,IAAI,EAAE;;IAEpB,CAAC;CACH;CAAC,yBAGD;GACC,IAAI,CAACpD,cAAI,CAACqL,SAAS,CAAC,4CAAI,sBAAUjO,EAAE,CAAC,EACrC;KACC;;GAGD,IAAI,4CAAI,sBAAUyD,oCAAoC,EACtD;KACCsC,EAAE,CAACgG,SAAS,CAACC,QAAQ,CAACC,IAAI,CACxB,wBAAuB,4CAAI,sBAAUjM,EAAG,GAAE,EAC3C;OACCoH,SAAS,EAAE,KAAK;OAChBxH,MAAM,EAAE;SACP0M,OAAO,EAAE,8CAAM,IAAI;;MAEpB,CACD;KAED;;GAGDc,mCAAa,CAACC,UAAU,CAAC;KACxBjF,IAAI,EAAEkF,uCAAiB,CAACY,IAAI;KAC5BV,gBAAgB,EAAE,4CAAI,sBAAU3E,QAAQ;KACxCxE,SAAS,EAAE,4CAAI,sBAAUrE,EAAE;KAC3ByN,WAAW,EAAEvK,aAAG,CAACC,UAAU,CAAC,uBAAuB,CAAC;KACpDuK,YAAY,EAAEC,0CAAoB,CAACC,GAAG;KACtCC,IAAI,EAAEC,oCAAc,CAACF;IACrB,EAAE;KACFI,cAAc,EAAE,8CAAM,IAAI;IAC1B,CAAC;CACH;CAAC,yCAE8BnC,aAAa,EAC5C;GACC,4CAAI,IAAI,yEACR;KACC;;GAGDsC,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAG/E,KAAK,IAAK;KAC7C,IAAIA,KAAK,CAACyC,MAAM,KAAKD,aAAa,IAAIxC,KAAK,CAAC1B,IAAI,KAAK,iCAAiC,EACtF;OAAA;OACC0G,aAAa,yCAAC,IAAI,kDAAwB;OAC1C,MAAM7L,OAAO,2CAAG,IAAI,+DAAiB,4CAAI,sBAAUxC,EAAE,sCAAI,CAAC,CAAC;OAC3D,IAAIwC,OAAO,EACX;SACC,4CAAI,oCAAiBsK,aAAa,CAACC,WAAW,CAAC;WAAEuB,WAAW,EAAE9L,OAAO,CAAChC;UAAO,EAAEqL,aAAa,CAAC;;;IAG/F,CAAC;GAEF,4CAAI,0EAAqC,IAAI;CAC9C;CAAC,qCAE0BA,aAAa,EACxC;GACC,4CAAI,IAAI,iEACR;KACC;;GAEDsC,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAG/E,KAAK,IAAK;KAC7C,IAAIA,KAAK,CAACyC,MAAM,KAAKD,aAAa,IAAIxC,KAAK,CAAC1B,IAAI,KAAK,oCAAoC,EACzF;OACC5B,EAAE,CAACgG,SAAS,CAACC,QAAQ,CAACzE,KAAK,EAAE;;IAE9B,CAAC;GAEF,4CAAI,kEAAiC,IAAI;CAC1C;CAAC,iDAGD;GACC,IAAI,CAAC,4CAAI,sBAAUtH,QAAQ,CAACsO,OAAO,EACnC;KACC;;GAGD,MAAMpD,YAAY,2CAAG,IAAI,oCAAiB,4CAAI,sBAAUnL,EAAE,CAAC;GAC3D,MAAM;KAAEA;IAAI,GAAG,MAAM,4CAAI,cAAMwO,kBAAkB,CAChD,4CAAI,sBAAUvO,QAAQ,CAACC,IAAI,EAC3BiL,YAAY,CAACvK,KAAK,EAClB,4CAAI,sBAAUZ,EAAE,EAChB,4CAAI,sBAAUC,QAAQ,CAACwO,kBAAkB,CACzC;GACD,4CAAI,sBAAUxO,QAAQ,CAACE,GAAG,GAAGH,EAAE;GAC/B,4CAAI,sBAAUC,QAAQ,CAACsO,OAAO,GAAG,KAAK;GACtCG,UAAU,CAAC,8CAAM,IAAI,iBAAQ,0CAAE,IAAI,4CAAqB;CACzD;CAAC,iCAyDsBzO,QAAkB,EACzC;GACC,IAAI,CAACA,QAAQ,CAAC0O,OAAO,EACrB;KACC,OAAO,KAAK;;GAEb,MAAMC,QAAQ,2CAAG,IAAI,8CAAsB3O,QAAQ,CAAC0O,OAAO,CAAC;GAE5D,OAAOC,QAAQ,4CAAI,IAAI,iEAA+B,IAAIA,QAAQ,IAAI,CAAC;CACxE;CAAC,6BAEkB3O,QAAkB,EACrC;GACC,OAAOA,QAAQ,CAAC0O,OAAO,IAAI,4CAAI,8CAAsB1O,QAAQ,CAAC0O,OAAO,IAAI,CAAC;CAC3E;CAAC,+BAEoBA,OAAe,EACpC;GACC,MAAME,GAAG,GAAGC,IAAI,CAACD,GAAG,EAAE,GAAG,IAAI;GAE7B,OAAOE,IAAI,CAACC,KAAK,CAAC,CAACL,OAAO,GAAGE,GAAG,IAAI,KAAK,CAAC;CAC3C;CAAC,uBAGD;GACC,OAAO,IAAII,cAAK,CAAC;KAChBhO,IAAI,EAAEiC,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC;KACtDuD,KAAK,EAAEwI,mBAAU,CAACC,OAAO;KACzBC,IAAI,EAAE,IAAI;KACVC,WAAW,EAAE;IACb,CAAC;CACH;CAAC,2BAEgBpP,QAAkB,EACnC;GACC,IAAIA,QAAQ,CAACC,IAAI,KAAK3B,YAAY,CAACG,MAAM,EACzC;KACC,OAAO,4CAAI,0CAAoBuB,QAAQ,IACpC,o8IAAo8I,GACp8I,4gFAA4gF;;GAIhhF,IACCA,QAAQ,CAACC,IAAI,KAAK3B,YAAY,CAACM,QAAQ,IACpC+D,cAAI,CAACqC,cAAc,CAAChF,QAAQ,CAACqP,OAAO,CAAC,EAEzC;KACC,OAAOrP,QAAQ,CAACqP,OAAO;;GAGxB,OAAO,oxCAAoxC;CAC5xC;CAAC,2BAEgBrP,QAAkB,EACnC;GACC,IAAIA,QAAQ,CAACC,IAAI,KAAK3B,YAAY,CAACG,MAAM,4CAAI,IAAI,0CAAoBuB,QAAQ,CAAC,EAC9E;KACC,OAAO,CACN;OACCO,KAAK,EAAE0C,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC;OACvDoM,SAAS,EAAE,oCAAoC;OAC/CC,OAAO,EAAE;MACT,CACD;;GAGF,OAAO,EAAE;CACV;CAAC,4BAEiBvP,QAAkB,EACpC;GACC,OAAO,IAAIwP,eAAK,CAAC;KAChBxO,IAAI,0CAAE,IAAI,sDAA0BhB,QAAQ,CAAC;KAC7CoP,WAAW,EAAE;IACb,CAAC;CACH;CAAC,mCAEwBpP,QAAkB,EAC3C;GACC,4CAAI,IAAI,0CAAoBA,QAAQ,GACpC;KACC,OAAOsK,uBAAQ,CAACC,WAAW,CAC1BtH,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC,EAC9DlE,aAAa,CAACM,YAAY,CAC1B;;GAGF,MAAMqP,QAAQ,2CAAG,IAAI,8CAAsB3O,QAAQ,CAAC0O,OAAO,CAAC;GAC5D,MAAMe,SAAS,GAAGxM,aAAG,CAACyM,gBAAgB,CAAC,yCAAyC,EAAEf,QAAQ,EAAE;KAC3F,QAAQ,EAAEA;IACV,CAAC;GAEF,OAAOrE,uBAAQ,CAACC,WAAW,CAACkF,SAAS,EAAEzQ,aAAa,CAACM,YAAY,CAAC;CACnE;CAAC,0CAS+BU,QAA0B,EAC1D;GACC,OAAOA,QAAQ,KAAK1B,YAAY,CAACK,KAAK,IAAI,4CAAI,sBAAUkH,qBAAqB,KAAK4B,uCAAiB,CAAClF,OAAO,GACxGoN,qCAAU,CAACC,KAAK,GAChBD,qCAAU,CAACE,OAAO;CAEtB;CAAC,4BAOiB7P,QAAkB,EACpC;GAAA;GACC,IAAI,CAAC2C,cAAI,CAACqC,cAAc,CAAChF,QAAQ,CAACqP,OAAO,CAAC,EAC1C;KACC;;GAGD,MAAMS,YAAY,GAAG,4DAA4D;GACjF,MAAMC,GAAG,yDAAG,4CAAI,YAAK/P,QAAQ,CAACI,SAAS,qBAA3B,wBAA6B4P,sBAAsB,CAACF,YAAY,CAAC,CAAC,CAAC,CAAC,sCAAI,IAAI;GACxF,IAAI,CAACC,GAAG,EACR;KACC;;GAGDA,GAAG,CAACE,GAAG,GAAGjQ,QAAQ,CAACqP,OAAO;CAC3B;CAAC,uCAGD;GACC,OAAO,4CAAI,8BAAca,QAAQ,CAAC,kBAAkB,EAAE,MAAM;KAC3D,OAAOnN,aAAG,CAACC,MAAM,kBAAC;;mCAEY,CAA0E;;IAExG,GAFgCC,aAAG,CAACC,UAAU,CAAC,uDAAuD,CAAC;IAGvG,CAAC;CACH;CAAC,6DAGD;GACC,OAAO,4CAAI,8BAAcgN,QAAQ,CAAC,8CAA8C,EAAE,MAAM;KACvF,MAAMC,KAAK,GAAG,IAAIX,eAAK,CAAC;OACvBxO,IAAI,EAAEiC,aAAG,CAACC,UAAU,CAAC,mEAAmE,CAAC;OACzFuD,KAAK,EAAE2J,oBAAU,CAAClB,OAAO;OACzB9G,IAAI,EAAEiI,mBAAS,CAACC,EAAE;OAClBlB,WAAW,EAAE;MACb,CAAC;KAEF,OAAOe,KAAK,CAACnN,MAAM,EAAE;IACrB,CAAC;CACH;;;;;;;;;;"}