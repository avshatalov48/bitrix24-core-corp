{"version":3,"file":"user-party.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Dom, Loc, Tag, Text as TextFormat, Event } from 'main.core';\nimport type { Loader } from 'main.loader';\nimport { Helpdesk } from 'sign.v2.helper';\nimport { Dialog, TagSelector, TagItem } from 'ui.entity-selector';\nimport type { UserPartyOptions } from './type';\nimport type { CardItem } from './types/card-item';\nimport { UserPartyCounters } from 'sign.v2.b2e.user-party-counters';\nimport { UserPartyPopup } from 'sign.v2.b2e.user-party-popup';\nimport { Api, CountMember } from 'sign.v2.api';\nimport 'ui.icon-set.main';\n\nimport './style.css';\n\nexport type UserPartyConfig = {\n\tregion: string,\n\tb2eSignersLimitCount: number,\n}\n\nexport type { CardItem };\n\nconst Mode = Object.freeze({\n\tview: 'view',\n\tedit: 'edit',\n});\n\nconst defaultAvatarLink = '/bitrix/js/sign/v2/b2e/user-party/images/user.svg';\nconst departmentAvatarLink = '/bitrix/js/sign/v2/b2e/user-party/images/department.svg';\n\nconst HelpdeskCodes = Object.freeze({\n\tSignEdmWithEmployees: '19740792',\n});\n\nexport class UserParty\n{\n\t#api: Api;\n\n\t#ui = {\n\t\tcontainer: HTMLDivElement = null,\n\t\titemContainer: HTMLDivElement = null,\n\t\theader: HTMLSpanElement = null,\n\t\tdescription: HTMLParagraphElement = null,\n\t\tuserPartyCounterContainer: HTMLDivElement = null,\n\t\tshowMoreSignersContainer: HTMLDivElement = null,\n\t};\n\n\t#items: Map<number, CardItem> = new Map();\n\t#preselectedUserData: Array<Object> = [];\n\n\t#viewMode = Mode.edit;\n\n\t#tagSelector: ?TagSelector = null;\n\t#loader: ?Loader = null;\n\t#userPartyCounters: UserPartyCounters = null;\n\n\t#documentUid: string = null;\n\n\t#userPartyPopup: UserPartyPopup = null;\n\n\t#counterDelayTimeout: ?number = null;\n\n\tconstructor(options: UserPartyOptions)\n\t{\n\t\tthis.#api = new Api();\n\t\tthis.#viewMode = options.mode;\n\t\tthis.#init(options);\n\t}\n\n\t#init(options: UserPartyOptions): void\n\t{\n\t\tif (this.#viewMode === Mode.view)\n\t\t{\n\t\t\tthis.#ui.container = this.getLayout(options.region);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst { b2eSignersLimitCount, region } = options;\n\t\tthis.#userPartyCounters = new UserPartyCounters({\n\t\t\tuserCountersLimit: b2eSignersLimitCount,\n\t\t});\n\t\tthis.#ui.container = this.getLayout(region);\n\t\tthis.#tagSelector = new TagSelector({\n\t\t\tevents: {\n\t\t\t\tonTagRemove: (event) => {\n\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\tthis.#removeItem(tag);\n\t\t\t\t},\n\t\t\t\tonTagAdd: (event) => {\n\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\tthis.#addItem(tag);\n\t\t\t\t},\n\t\t\t},\n\t\t\tdialogOptions: {\n\t\t\t\twidth: 425,\n\t\t\t\theight: 363,\n\t\t\t\tmultiple: true,\n\t\t\t\ttargetNode: this.#ui.itemContainer,\n\t\t\t\tcontext: 'sign_b2e_user_party',\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\toptions: { intranetUsersOnly: true },\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'department',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tselectMode: 'usersAndDepartments',\n\t\t\t\t\t\t\tfillRecentTab: true,\n\t\t\t\t\t\t\tallowFlatDepartments: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdropdownMode: false,\n\t\t\t\thideOnDeselect: false,\n\t\t\t},\n\t\t});\n\t\tthis.#tagSelector.renderTo(this.#ui.itemContainer);\n\t}\n\n\tgetLayout(region: string): HTMLElement\n\t{\n\t\tif (this.#ui.container)\n\t\t{\n\t\t\treturn this.#ui.container;\n\t\t}\n\n\t\tthis.#ui.itemContainer = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-user-party__item-list\"></div>\n\t\t`;\n\t\tif (this.#viewMode !== Mode.edit)\n\t\t{\n\t\t\tDom.addClass(this.#ui.itemContainer, '--view');\n\n\t\t\tconst link = Tag.render`\n\t\t\t\t<a href=\"#\">${Loc.getMessage('SIGN_USER_PARTY_VIEW_SHOW_MORE', {\n\t\t\t\t\t'#EMPLOYEE_COUNT#': '<span class=\"--count-placeholder\">â€¦</span>',\n\t\t\t\t})}</a>\n\t\t\t`;\n\n\t\t\tthis.#userPartyPopup = this.#createUserPartyPopup(link);\n\n\t\t\tEvent.bind(link, 'click', (event) => {\n\t\t\t\tthis.#userPartyPopup.setDocumentUid(this.#documentUid).show();\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.#ui.showMoreSignersContainer = Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-user-party__item-show_more\">\n\t\t\t\t\t${link}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tDom.hide(this.#ui.showMoreSignersContainer);\n\t\t\tDom.append(this.#ui.showMoreSignersContainer, this.#ui.itemContainer);\n\n\t\t\treturn this.#ui.itemContainer;\n\t\t}\n\n\t\tconst descriptionMessage = region === 'ru'\n\t\t\t? Helpdesk.replaceLink(Loc.getMessage('SIGN_USER_PARTY_DESCRIPTION'), HelpdeskCodes.SignEdmWithEmployees)\n\t\t\t: Loc.getMessage('SIGN_CMP_MASTER_TPL_TOUR_STEP_CHOOSE_MEMBER_USER_PARTY_DESCRIPTION')\n\t\t;\n\t\tthis.#ui.description = Tag.render`\n\t\t\t<p class=\"sign-document-b2e-user-party__description\">\n\t\t\t\t${descriptionMessage}\n\t\t\t</p>\n\t\t`;\n\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"sign-b2e-settings__header-wrapper\">\n\t\t\t\t\t<h1 class=\"sign-b2e-settings__header\">${Loc.getMessage('SIGN_USER_PARTY_HEADER')}</h1>\n\t\t\t\t\t${this.#userPartyCounters.getLayout()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_USER_PARTY_ITEM_TITLE')}\n\t\t\t\t\t</p>\n\t\t\t\t\t${this.#ui.itemContainer}\n\t\t\t\t\t${this.#ui.description}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createUserPartyPopup(bindElement: HTMLElement): UserPartyPopup\n\t{\n\t\treturn new UserPartyPopup({\n\t\t\tbindElement,\n\t\t});\n\t}\n\n\tasync load(ids: number[]): Promise<void>\n\t{\n\t\tconst { dialog } = this.#tagSelector;\n\t\tdialog.preselectedItems = ids.map((userId) => ['user', userId]);\n\t\tconst promise = new Promise((resolve) => {\n\t\t\tdialog.subscribeOnce('onLoad', resolve);\n\t\t});\n\t\tdialog.load();\n\t\tawait promise;\n\t}\n\n\tasync setSignersIds(usersData: [Object]): void\n\t{\n\t\tthis.#clean();\n\n\t\tconst maxShownItems = this.#getViewModeItemsCount();\n\n\t\tthis.#preselectedUserData = usersData\n\t\t\t.sort((a, b) => (a.entityType === 'department' ? -1 : 1))\n\t\t\t.slice(0, maxShownItems)\n\t\t;\n\n\t\tif (this.#preselectedUserData.length < maxShownItems)\n\t\t{\n\t\t\tconst membersResponse = await this.#api.getMembersForDocument(\n\t\t\t\tthis.#documentUid,\n\t\t\t\t1,\n\t\t\t\tmaxShownItems,\n\t\t\t);\n\t\t\tconst preselectedIds = new Set(\n\t\t\t\tusersData\n\t\t\t\t\t.filter((item) => item.entityType === 'user')\n\t\t\t\t\t.map((item) => item.entityId)\n\t\t\t);\n\t\t\tconst addMembers = membersResponse.members\n\t\t\t\t.filter((member) => !preselectedIds.has(member.userId))\n\t\t\t\t.slice(0, maxShownItems - this.#preselectedUserData.length)\n\t\t\t;\n\t\t\tthis.#preselectedUserData = [...this.#preselectedUserData, ...addMembers.map((member) => {\n\t\t\t\treturn { entityType: 'user', entityId: member.userId };\n\t\t\t})];\n\t\t}\n\n\t\t// workaround because prepend is used in the interface instead of append\n\t\tthis.#preselectedUserData.reverse();\n\n\t\tawait this.#loadPreselectedUsersData();\n\t\tthis.#displayShowMoreBtn();\n\t}\n\n\tasync #displayShowMoreBtn(): void\n\t{\n\t\tconst shownUsers = this.#preselectedUserData\n\t\t\t.reduce((count, item) => (item.entityType === 'user' ? count + 1 : count), 0)\n\t\t;\n\t\tconst signersCountResponse = await this.#api.getUniqUserCountForDocument(this.#documentUid);\n\t\tconst showMoreCount = signersCountResponse.count - shownUsers;\n\t\tif (showMoreCount > 0)\n\t\t{\n\t\t\tthis.#ui.showMoreSignersContainer.querySelector('.--count-placeholder').textContent = showMoreCount;\n\t\t\tDom.show(this.#ui.showMoreSignersContainer);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#ui.showMoreSignersContainer.querySelector('.--count-placeholder').textContent = 0;\n\t\t\tDom.hide(this.#ui.showMoreSignersContainer);\n\t\t}\n\t}\n\n\tasync #loadPreselectedUsersData(): Promise<void>\n\t{\n\t\tthis.#showLoader();\n\n\t\tawait new Promise((resolve) => {\n\t\t\tconst dialog = new Dialog({\n\t\t\t\tentities: [\n\t\t\t\t\t{ id: 'user' },\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonLoad: () => {\n\t\t\t\t\t\tdialog.getSelectedItems().forEach((item) => {\n\t\t\t\t\t\t\tthis.#addItem(item);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tpreselectedItems: this.#preselectedUserData.map((entity) => {\n\t\t\t\t\treturn [entity.entityType, entity.entityId];\n\t\t\t\t}),\n\t\t\t});\n\t\t\tdialog.load();\n\t\t});\n\n\t\tthis.#hideLoader();\n\t}\n\n\t#showLoader(): void\n\t{\n\t\tthis.#ui.itemContainer.style.display = 'none';\n\t\tthis.#getLoader().show();\n\t}\n\n\t#hideLoader(): void\n\t{\n\t\tthis.#ui.itemContainer.style.display = 'flex';\n\t\tthis.#getLoader().hide();\n\t}\n\n\t#getLoader(): Loader\n\t{\n\t\tif (this.#loader)\n\t\t{\n\t\t\treturn this.#loader;\n\t\t}\n\n\t\tthis.#loader = new BX.Loader({\n\t\t\ttarget: this.#ui.container,\n\t\t\tmode: 'inline',\n\t\t\tsize: 40,\n\t\t});\n\n\t\treturn this.#loader;\n\t}\n\n\t#removeItem(tag: TagItem): void\n\t{\n\t\tconst userId = tag.id;\n\t\tconst item = this.#items.get(userId);\n\t\tif (item?.container)\n\t\t{\n\t\t\tDom.remove(item.container);\n\t\t}\n\n\t\tthis.#items.delete(userId);\n\n\t\tthis.#updateEditModeCounter();\n\t}\n\n\t#addItem(tag: TagItem): void\n\t{\n\t\tconst item = {\n\t\t\tid: tag.id,\n\t\t\ttitle: tag?.title.text,\n\t\t\tname: tag.customData?.get('name'),\n\t\t\tlastName: tag.customData?.get('lastName'),\n\t\t\tavatar: tag?.avatar,\n\t\t\tentityId: tag.id,\n\t\t\tentityType: tag?.entityId,\n\t\t};\n\n\t\tconst container = this.#viewMode === Mode.view\n\t\t\t? this.#createItemLayout(item)\n\t\t\t: null\n\t\t;\n\n\t\tif (container)\n\t\t{\n\t\t\tDom.prepend(container, this.#ui.itemContainer);\n\t\t}\n\n\t\titem.container = container;\n\t\tthis.#items.set(item.id, item);\n\n\t\tthis.#updateEditModeCounter();\n\t}\n\n\t#updateEditModeCounter(): void\n\t{\n\t\tif (this.#viewMode === Mode.edit)\n\t\t{\n\t\t\tthis.#updateCounterWithDelay(this.#tagSelector.getTags().map((member) => {\n\t\t\t\treturn {\n\t\t\t\t\tentityId: member.id,\n\t\t\t\t\tentityType: member.entityId,\n\t\t\t\t};\n\t\t\t}));\n\t\t}\n\t}\n\n\t#updateCounterWithDelay(selectedMembers: CountMember[]): void\n\t{\n\t\tclearTimeout(this.#counterDelayTimeout);\n\n\t\tthis.#counterDelayTimeout = setTimeout(async () => {\n\t\t\tconst response = await this.#api.getUniqUserCountForMembers(selectedMembers);\n\t\t\tthis.#userPartyCounters?.update(response.count);\n\t\t}, 100);\n\t}\n\n\tvalidate(): boolean\n\t{\n\t\tconst isValid = this.#items.size > 0 && this.#userPartyCounters.getCount() > 0;\n\t\tconst tagSelectorContainer = this.#tagSelector.getOuterContainer();\n\t\tif (isValid)\n\t\t{\n\t\t\tDom.removeClass(tagSelectorContainer, '--invalid');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(tagSelectorContainer, '--invalid');\n\t\t}\n\n\t\treturn isValid;\n\t}\n\n\tgetUserIds(): Array<number>\n\t{\n\t\treturn [...this.#items.keys()];\n\t}\n\n\tgetEntities(): Array<CardItem>\n\t{\n\t\treturn [...this.#items.values()];\n\t}\n\n\tresetUserPartyPopup(): void\n\t{\n\t\tthis.#userPartyPopup.resetData();\n\t}\n\n\tsetDocumentUid(uid: string): void\n\t{\n\t\tthis.#documentUid = uid;\n\t}\n\n\t#createItemLayout(item: CardItem): HTMLElement\n\t{\n\t\treturn item.entityType === 'department'\n\t\t\t? this.#createDepartmentItemLayout(item)\n\t\t\t: this.#createUserItemLayout(item)\n\t\t;\n\t}\n\n\t#createDepartmentItemLayout(item: CardItem): HTMLElement\n\t{\n\t\tconst title = TextFormat.encode(item.title);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-b2e-user-party__item-list_item --department\">\n\t\t\t\t<div>\n\t\t\t\t\t<img\n\t\t\t\t\t\tclass=\"sign-document-b2e-user-party__item-list_item-avatar\"\n\t\t\t\t\t\ttitle=\"${title}\" src='${departmentAvatarLink}' alt=\"avatar\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div title=\"${title}\" class=\"sign-document-b2e-user-party__item-list_item-text\">\n\t\t\t\t\t${title}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createUserItemLayout(item: CardItem): HTMLElement\n\t{\n\t\tconst title = TextFormat.encode(item.title);\n\t\tconst itemAvatar = item.avatar || defaultAvatarLink;\n\t\tconst profileLink = `/company/personal/user/${TextFormat.encode(item.entityId)}/`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-b2e-user-party__item-list_item --user\">\n\t\t\t\t<a href=\"${profileLink}\">\n\t\t\t\t\t<img\n\t\t\t\t\t\tclass=\"sign-document-b2e-user-party__item-list_item-avatar\"\n\t\t\t\t\t\ttitle=\"${title}\" src='${TextFormat.encode(itemAvatar)}' alt=\"avatar\"\n\t\t\t\t\t/>\n\t\t\t\t</a>\n\t\t\t\t<div title=\"${title}\" class=\"sign-document-b2e-user-party__item-list_item-text\">\n\t\t\t\t\t${title}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#clean(): void\n\t{\n\t\t[...this.#items.values()].forEach((item) => Dom.remove(item.container));\n\t\tthis.#items.clear();\n\t\tthis.#userPartyCounters?.update(this.#items.size);\n\t}\n\n\t#getViewModeItemsCount(): number\n\t{\n\t\treturn 7; // for fixed slider width\n\t}\n}\n"],"names":["Mode","Object","freeze","view","edit","defaultAvatarLink","departmentAvatarLink","HelpdeskCodes","SignEdmWithEmployees","UserParty","constructor","options","container","HTMLDivElement","itemContainer","header","HTMLSpanElement","description","HTMLParagraphElement","userPartyCounterContainer","showMoreSignersContainer","Map","Api","mode","getLayout","region","Tag","render","Dom","addClass","link","Loc","getMessage","Event","bind","event","setDocumentUid","show","preventDefault","hide","append","descriptionMessage","Helpdesk","replaceLink","load","ids","dialog","preselectedItems","map","userId","promise","Promise","resolve","subscribeOnce","setSignersIds","usersData","maxShownItems","sort","a","b","entityType","slice","length","membersResponse","getMembersForDocument","preselectedIds","Set","filter","item","entityId","addMembers","members","member","has","reverse","validate","isValid","size","getCount","tagSelectorContainer","getOuterContainer","removeClass","getUserIds","keys","getEntities","values","resetUserPartyPopup","resetData","uid","b2eSignersLimitCount","UserPartyCounters","userCountersLimit","TagSelector","events","onTagRemove","tag","getData","onTagAdd","dialogOptions","width","height","multiple","targetNode","context","entities","id","intranetUsersOnly","selectMode","fillRecentTab","allowFlatDepartments","dropdownMode","hideOnDeselect","renderTo","bindElement","UserPartyPopup","shownUsers","reduce","count","signersCountResponse","getUniqUserCountForDocument","showMoreCount","querySelector","textContent","Dialog","onLoad","getSelectedItems","forEach","entity","style","display","BX","Loader","target","get","remove","delete","title","text","name","customData","lastName","avatar","prepend","set","getTags","selectedMembers","clearTimeout","setTimeout","response","getUniqUserCountForMembers","update","TextFormat","encode","itemAvatar","profileLink","clear"],"mappings":"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"}