this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};this.BX.Sign.V2=this.BX.Sign.V2||{};(function(e,s,t,a,i,l,r){"use strict";let o=e=>e,n,b,d,c,v,p,u;const P=Object.freeze({view:"view",edit:"edit"});const h="/bitrix/js/sign/v2/b2e/user-party/images/user.svg";const L="/bitrix/js/sign/v2/b2e/user-party/images/department.svg";const H=Object.freeze({SignEdmWithEmployees:"19740792"});var y=babelHelpers.classPrivateFieldLooseKey("api");var F=babelHelpers.classPrivateFieldLooseKey("ui");var m=babelHelpers.classPrivateFieldLooseKey("items");var B=babelHelpers.classPrivateFieldLooseKey("preselectedUserData");var g=babelHelpers.classPrivateFieldLooseKey("viewMode");var f=babelHelpers.classPrivateFieldLooseKey("tagSelector");var _=babelHelpers.classPrivateFieldLooseKey("loader");var w=babelHelpers.classPrivateFieldLooseKey("userPartyCounters");var T=babelHelpers.classPrivateFieldLooseKey("documentUid");var S=babelHelpers.classPrivateFieldLooseKey("userPartyPopup");var O=babelHelpers.classPrivateFieldLooseKey("counterDelayTimeout");var C=babelHelpers.classPrivateFieldLooseKey("init");var E=babelHelpers.classPrivateFieldLooseKey("createUserPartyPopup");var D=babelHelpers.classPrivateFieldLooseKey("displayShowMoreBtn");var M=babelHelpers.classPrivateFieldLooseKey("loadPreselectedUsersData");var I=babelHelpers.classPrivateFieldLooseKey("showLoader");var j=babelHelpers.classPrivateFieldLooseKey("hideLoader");var K=babelHelpers.classPrivateFieldLooseKey("getLoader");var U=babelHelpers.classPrivateFieldLooseKey("removeItem");var R=babelHelpers.classPrivateFieldLooseKey("addItem");var $=babelHelpers.classPrivateFieldLooseKey("updateEditModeCounter");var X=babelHelpers.classPrivateFieldLooseKey("updateCounterWithDelay");var x=babelHelpers.classPrivateFieldLooseKey("createItemLayout");var N=babelHelpers.classPrivateFieldLooseKey("createDepartmentItemLayout");var A=babelHelpers.classPrivateFieldLooseKey("createUserItemLayout");var V=babelHelpers.classPrivateFieldLooseKey("clean");var Y=babelHelpers.classPrivateFieldLooseKey("getViewModeItemsCount");class z{constructor(e){Object.defineProperty(this,Y,{value:ne});Object.defineProperty(this,V,{value:oe});Object.defineProperty(this,A,{value:re});Object.defineProperty(this,N,{value:le});Object.defineProperty(this,x,{value:ie});Object.defineProperty(this,X,{value:ae});Object.defineProperty(this,$,{value:te});Object.defineProperty(this,R,{value:se});Object.defineProperty(this,U,{value:ee});Object.defineProperty(this,K,{value:Z});Object.defineProperty(this,j,{value:Q});Object.defineProperty(this,I,{value:J});Object.defineProperty(this,M,{value:q});Object.defineProperty(this,D,{value:k});Object.defineProperty(this,E,{value:W});Object.defineProperty(this,C,{value:G});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:{container:HTMLDivElement=null,itemContainer:HTMLDivElement=null,header:HTMLSpanElement=null,description:HTMLParagraphElement=null,userPartyCounterContainer:HTMLDivElement=null,showMoreSignersContainer:HTMLDivElement=null}});Object.defineProperty(this,m,{writable:true,value:new Map});Object.defineProperty(this,B,{writable:true,value:[]});Object.defineProperty(this,g,{writable:true,value:P.edit});Object.defineProperty(this,f,{writable:true,value:null});Object.defineProperty(this,_,{writable:true,value:null});Object.defineProperty(this,w,{writable:true,value:null});Object.defineProperty(this,T,{writable:true,value:null});Object.defineProperty(this,S,{writable:true,value:null});Object.defineProperty(this,O,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,y)[y]=new r.Api;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e.mode;babelHelpers.classPrivateFieldLooseBase(this,C)[C](e)}getLayout(e){if(babelHelpers.classPrivateFieldLooseBase(this,F)[F].container){return babelHelpers.classPrivateFieldLooseBase(this,F)[F].container}babelHelpers.classPrivateFieldLooseBase(this,F)[F].itemContainer=s.Tag.render(n||(n=o`
			<div class="sign-document-b2e-user-party__item-list"></div>
		`));if(babelHelpers.classPrivateFieldLooseBase(this,g)[g]!==P.edit){s.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,F)[F].itemContainer,"--view");const e=s.Tag.render(b||(b=o`
				<a href="#">${0}</a>
			`),s.Loc.getMessage("SIGN_USER_PARTY_VIEW_SHOW_MORE",{"#EMPLOYEE_COUNT#":'<span class="--count-placeholder">\u2026</span>'}));babelHelpers.classPrivateFieldLooseBase(this,S)[S]=babelHelpers.classPrivateFieldLooseBase(this,E)[E](e);s.Event.bind(e,"click",(e=>{babelHelpers.classPrivateFieldLooseBase(this,S)[S].setDocumentUid(babelHelpers.classPrivateFieldLooseBase(this,T)[T]).show();e.preventDefault()}));babelHelpers.classPrivateFieldLooseBase(this,F)[F].showMoreSignersContainer=s.Tag.render(d||(d=o`
				<div class="sign-document-b2e-user-party__item-show_more">
					${0}
				</div>
			`),e);s.Dom.hide(babelHelpers.classPrivateFieldLooseBase(this,F)[F].showMoreSignersContainer);s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,F)[F].showMoreSignersContainer,babelHelpers.classPrivateFieldLooseBase(this,F)[F].itemContainer);return babelHelpers.classPrivateFieldLooseBase(this,F)[F].itemContainer}const a=e==="ru"?t.Helpdesk.replaceLink(s.Loc.getMessage("SIGN_USER_PARTY_DESCRIPTION"),H.SignEdmWithEmployees):s.Loc.getMessage("SIGN_CMP_MASTER_TPL_TOUR_STEP_CHOOSE_MEMBER_USER_PARTY_DESCRIPTION");babelHelpers.classPrivateFieldLooseBase(this,F)[F].description=s.Tag.render(c||(c=o`
			<p class="sign-document-b2e-user-party__description">
				${0}
			</p>
		`),a);return s.Tag.render(v||(v=o`
			<div>
				<div class="sign-b2e-settings__header-wrapper">
					<h1 class="sign-b2e-settings__header">${0}</h1>
					${0}
				</div>
				<div class="sign-b2e-settings__item">
					<p class="sign-b2e-settings__item_title">
						${0}
					</p>
					${0}
					${0}
				</div>
			</div>
		`),s.Loc.getMessage("SIGN_USER_PARTY_HEADER"),babelHelpers.classPrivateFieldLooseBase(this,w)[w].getLayout(),s.Loc.getMessage("SIGN_USER_PARTY_ITEM_TITLE"),babelHelpers.classPrivateFieldLooseBase(this,F)[F].itemContainer,babelHelpers.classPrivateFieldLooseBase(this,F)[F].description)}async load(e){const{dialog:s}=babelHelpers.classPrivateFieldLooseBase(this,f)[f];s.preselectedItems=e.map((e=>["user",e]));const t=new Promise((e=>{s.subscribeOnce("onLoad",e)}));s.load();await t}async setSignersIds(e){babelHelpers.classPrivateFieldLooseBase(this,V)[V]();const s=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]();babelHelpers.classPrivateFieldLooseBase(this,B)[B]=e.sort(((e,s)=>e.entityType==="department"?-1:1)).slice(0,s);if(babelHelpers.classPrivateFieldLooseBase(this,B)[B].length<s){const t=await babelHelpers.classPrivateFieldLooseBase(this,y)[y].getMembersForDocument(babelHelpers.classPrivateFieldLooseBase(this,T)[T],1,s);const a=new Set(e.filter((e=>e.entityType==="user")).map((e=>e.entityId)));const i=t.members.filter((e=>!a.has(e.userId))).slice(0,s-babelHelpers.classPrivateFieldLooseBase(this,B)[B].length);babelHelpers.classPrivateFieldLooseBase(this,B)[B]=[...babelHelpers.classPrivateFieldLooseBase(this,B)[B],...i.map((e=>({entityType:"user",entityId:e.userId})))]}babelHelpers.classPrivateFieldLooseBase(this,B)[B].reverse();await babelHelpers.classPrivateFieldLooseBase(this,M)[M]();babelHelpers.classPrivateFieldLooseBase(this,D)[D]()}validate(){const e=babelHelpers.classPrivateFieldLooseBase(this,m)[m].size>0&&babelHelpers.classPrivateFieldLooseBase(this,w)[w].getCount()>0;const t=babelHelpers.classPrivateFieldLooseBase(this,f)[f].getOuterContainer();if(e){s.Dom.removeClass(t,"--invalid")}else{s.Dom.addClass(t,"--invalid")}return e}getUserIds(){return[...babelHelpers.classPrivateFieldLooseBase(this,m)[m].keys()]}getEntities(){return[...babelHelpers.classPrivateFieldLooseBase(this,m)[m].values()]}resetUserPartyPopup(){babelHelpers.classPrivateFieldLooseBase(this,S)[S].resetData()}setDocumentUid(e){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=e}}function G(e){if(babelHelpers.classPrivateFieldLooseBase(this,g)[g]===P.view){babelHelpers.classPrivateFieldLooseBase(this,F)[F].container=this.getLayout(e.region);return}const{b2eSignersLimitCount:s,region:t}=e;babelHelpers.classPrivateFieldLooseBase(this,w)[w]=new i.UserPartyCounters({userCountersLimit:s});babelHelpers.classPrivateFieldLooseBase(this,F)[F].container=this.getLayout(t);babelHelpers.classPrivateFieldLooseBase(this,f)[f]=new a.TagSelector({events:{onTagRemove:e=>{const{tag:s}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,U)[U](s)},onTagAdd:e=>{const{tag:s}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,R)[R](s)}},dialogOptions:{width:425,height:363,multiple:true,targetNode:babelHelpers.classPrivateFieldLooseBase(this,F)[F].itemContainer,context:"sign_b2e_user_party",entities:[{id:"user",options:{intranetUsersOnly:true}},{id:"department",options:{selectMode:"usersAndDepartments",fillRecentTab:true,allowFlatDepartments:true}}],dropdownMode:false,hideOnDeselect:false}});babelHelpers.classPrivateFieldLooseBase(this,f)[f].renderTo(babelHelpers.classPrivateFieldLooseBase(this,F)[F].itemContainer)}function W(e){return new l.UserPartyPopup({bindElement:e})}async function k(){const e=babelHelpers.classPrivateFieldLooseBase(this,B)[B].reduce(((e,s)=>s.entityType==="user"?e+1:e),0);const t=await babelHelpers.classPrivateFieldLooseBase(this,y)[y].getUniqUserCountForDocument(babelHelpers.classPrivateFieldLooseBase(this,T)[T]);const a=t.count-e;if(a>0){babelHelpers.classPrivateFieldLooseBase(this,F)[F].showMoreSignersContainer.querySelector(".--count-placeholder").textContent=a;s.Dom.show(babelHelpers.classPrivateFieldLooseBase(this,F)[F].showMoreSignersContainer)}else{babelHelpers.classPrivateFieldLooseBase(this,F)[F].showMoreSignersContainer.querySelector(".--count-placeholder").textContent=0;s.Dom.hide(babelHelpers.classPrivateFieldLooseBase(this,F)[F].showMoreSignersContainer)}}async function q(){babelHelpers.classPrivateFieldLooseBase(this,I)[I]();await new Promise((e=>{const s=new a.Dialog({entities:[{id:"user"}],events:{onLoad:()=>{s.getSelectedItems().forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,R)[R](e)}));e()}},preselectedItems:babelHelpers.classPrivateFieldLooseBase(this,B)[B].map((e=>[e.entityType,e.entityId]))});s.load()}));babelHelpers.classPrivateFieldLooseBase(this,j)[j]()}function J(){babelHelpers.classPrivateFieldLooseBase(this,F)[F].itemContainer.style.display="none";babelHelpers.classPrivateFieldLooseBase(this,K)[K]().show()}function Q(){babelHelpers.classPrivateFieldLooseBase(this,F)[F].itemContainer.style.display="flex";babelHelpers.classPrivateFieldLooseBase(this,K)[K]().hide()}function Z(){if(babelHelpers.classPrivateFieldLooseBase(this,_)[_]){return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}babelHelpers.classPrivateFieldLooseBase(this,_)[_]=new BX.Loader({target:babelHelpers.classPrivateFieldLooseBase(this,F)[F].container,mode:"inline",size:40});return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}function ee(e){const t=e.id;const a=babelHelpers.classPrivateFieldLooseBase(this,m)[m].get(t);if(a!=null&&a.container){s.Dom.remove(a.container)}babelHelpers.classPrivateFieldLooseBase(this,m)[m].delete(t);babelHelpers.classPrivateFieldLooseBase(this,$)[$]()}function se(e){var t,a;const i={id:e.id,title:e==null?void 0:e.title.text,name:(t=e.customData)==null?void 0:t.get("name"),lastName:(a=e.customData)==null?void 0:a.get("lastName"),avatar:e==null?void 0:e.avatar,entityId:e.id,entityType:e==null?void 0:e.entityId};const l=babelHelpers.classPrivateFieldLooseBase(this,g)[g]===P.view?babelHelpers.classPrivateFieldLooseBase(this,x)[x](i):null;if(l){s.Dom.prepend(l,babelHelpers.classPrivateFieldLooseBase(this,F)[F].itemContainer)}i.container=l;babelHelpers.classPrivateFieldLooseBase(this,m)[m].set(i.id,i);babelHelpers.classPrivateFieldLooseBase(this,$)[$]()}function te(){if(babelHelpers.classPrivateFieldLooseBase(this,g)[g]===P.edit){babelHelpers.classPrivateFieldLooseBase(this,X)[X](babelHelpers.classPrivateFieldLooseBase(this,f)[f].getTags().map((e=>({entityId:e.id,entityType:e.entityId}))))}}function ae(e){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,O)[O]);babelHelpers.classPrivateFieldLooseBase(this,O)[O]=setTimeout((async()=>{var s;const t=await babelHelpers.classPrivateFieldLooseBase(this,y)[y].getUniqUserCountForMembers(e);(s=babelHelpers.classPrivateFieldLooseBase(this,w)[w])==null?void 0:s.update(t.count)}),100)}function ie(e){return e.entityType==="department"?babelHelpers.classPrivateFieldLooseBase(this,N)[N](e):babelHelpers.classPrivateFieldLooseBase(this,A)[A](e)}function le(e){const t=s.Text.encode(e.title);return s.Tag.render(p||(p=o`
			<div class="sign-document-b2e-user-party__item-list_item --department">
				<div>
					<img
						class="sign-document-b2e-user-party__item-list_item-avatar"
						title="${0}" src='${0}' alt="avatar"
					/>
				</div>
				<div title="${0}" class="sign-document-b2e-user-party__item-list_item-text">
					${0}
				</div>
			</div>
		`),t,L,t,t)}function re(e){const t=s.Text.encode(e.title);const a=e.avatar||h;const i=`/company/personal/user/${s.Text.encode(e.entityId)}/`;return s.Tag.render(u||(u=o`
			<div class="sign-document-b2e-user-party__item-list_item --user">
				<a href="${0}">
					<img
						class="sign-document-b2e-user-party__item-list_item-avatar"
						title="${0}" src='${0}' alt="avatar"
					/>
				</a>
				<div title="${0}" class="sign-document-b2e-user-party__item-list_item-text">
					${0}
				</div>
			</div>
		`),i,t,s.Text.encode(a),t,t)}function oe(){var e;[...babelHelpers.classPrivateFieldLooseBase(this,m)[m].values()].forEach((e=>s.Dom.remove(e.container)));babelHelpers.classPrivateFieldLooseBase(this,m)[m].clear();(e=babelHelpers.classPrivateFieldLooseBase(this,w)[w])==null?void 0:e.update(babelHelpers.classPrivateFieldLooseBase(this,m)[m].size)}function ne(){return 7}e.UserParty=z})(this.BX.Sign.V2.B2e=this.BX.Sign.V2.B2e||{},BX,BX.Sign.V2,BX.UI.EntitySelector,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2);
//# sourceMappingURL=user-party.bundle.map.js