{"version":3,"file":"sign-link.bundle.js","sources":["../src/sign-link.js"],"sourcesContent":["import 'ui.buttons';\nimport 'ui.sidepanel-content';\nimport 'ui.design-tokens';\nimport { DateTimeFormat } from 'main.date';\nimport { Tag, Dom, Loc, Text, Browser, Type, Event, Cache } from 'main.core';\nimport { Api } from 'sign.v2.api';\nimport './sign-link.css';\n\ntype EmployeeData = {\n\tsigned: boolean,\n\tdateSignedTs: number,\n\turi: {\n\t\tsignedDocument: string,\n\t\tallDocuments: string,\n\t},\n\tdocument: {\n\t\ttitle: string,\n\t\tdateTs: number,\n\t},\n\tmember: {\n\t\tname: string,\n\t\tposition: string,\n\t\tphoto: string,\n\t},\n};\n\ntype SignLinkOptions = {\n\tmemberId: number,\n\trequireBrowser?: boolean,\n\tmobileAllowed?: boolean,\n\tslider?: Object,\n};\n\ntype SignLinkSliderOptions = {\n\tevents: Object,\n};\n\nexport class SignLink\n{\n\t#container: HTMLElement = null;\n\t#memberId: string = null;\n\t#loaded: boolean = false;\n\t#errorCode: string = null;\n\t#errorMessage: string = null;\n\t#uri: string = null;\n\t#showHelpdeskGoskey: boolean = false;\n\t#api: Api;\n\t#requireBrowser: boolean = true;\n\t#mobileAllowed: boolean = true;\n\t#employeeData: EmployeeData = {};\n\t#renderMemberInfo: boolean = false;\n\n\t#slider: Object | null = null;\n\t#frameEventHandler: (event: Object) => void = null;\n\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(options: SignLinkOptions = {})\n\t{\n\t\tthis.#api = new Api();\n\t\tthis.#memberId = options.memberId;\n\t\tthis.#requireBrowser = options?.requireBrowser || true;\n\t\tthis.#mobileAllowed = options?.mobileAllowed || true;\n\t\tthis.#slider = options?.slider || null;\n\t}\n\n\tpreloadData(): Promise<void>\n\t{\n\t\treturn this.#loadData();\n\t}\n\n\tasync openSlider(options: SignLinkSliderOptions): Promise<void>\n\t{\n\t\tif (!this.#loaded)\n\t\t{\n\t\t\tawait this.#loadData();\n\t\t}\n\n\t\tconst signLink = this;\n\n\t\tBX.SidePanel.Instance.open('sign:stub:sign-link', {\n\t\t\twidth: 900,\n\t\t\tcacheable: false,\n\t\t\tallowCrossOrigin: true,\n\t\t\tallowCrossDomain: true,\n\t\t\tallowChangeHistory: false,\n\t\t\t// newWindowUrl: link,\n\t\t\tcopyLinkLabel: true,\n\t\t\tnewWindowLabel: true,\n\t\t\tloader: '/bitrix/js/intranet/sidepanel/bindings/images/sign_mask.svg',\n\t\t\tlabel: {\n\t\t\t\ttext: Loc.getMessage('SIGN_V2_B2E_LINK_SLIDER_TITLE'),\n\t\t\t\tbgColor: '#C48300',\n\t\t\t},\n\t\t\tcontentCallback() {\n\t\t\t\treturn Promise.resolve(true)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\treturn signLink.render();\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t},\n\t\t\tevents: options?.events,\n\t\t});\n\n\t\tthis.#slider = BX.SidePanel.Instance.getSlider('sign:stub:sign-link');\n\t}\n\n\trenderTo(node: HTMLElement): void\n\t{\n\t\tif (!this.#container)\n\t\t{\n\t\t\tthis.#container = document.createElement('div');\n\t\t\tDom.addClass(this.#container, 'sign-ui-signing-link-container');\n\t\t}\n\n\t\tDom.append(this.#container, node);\n\t\tthis.render();\n\t}\n\n\tasync render(): Promise<HTMLElement>\n\t{\n\t\tif (!this.#container)\n\t\t{\n\t\t\tthis.#container = document.createElement('div');\n\t\t\tDom.addClass(this.#container, 'sign-ui-signing-link-container');\n\t\t}\n\n\t\tif (!this.#loaded)\n\t\t{\n\t\t\tDom.append(this.#getLoader(), this.#container);\n\t\t\tawait this.#loadData();\n\t\t\tDom.remove(this.#getLoader(), this.#container);\n\t\t}\n\n\t\tif (this.#uri)\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.#isNeedToContinueInBrowser()\n\t\t\t\t|| this.#isNeedToContinueOnDesktop()\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.#renderContinueInBrowserPage();\n\t\t\t}\n\t\t\telse if (this.#needToShowPageForEmployee())\n\t\t\t{\n\t\t\t\tthis.#renderDownloadSignedDocForEmployee();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#renderUrl();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#renderError(this.#getErrorTitle(this.#errorCode), this.#errorMessage);\n\t\t}\n\n\t\treturn this.#container;\n\t}\n\n\tasync #loadData(): Promise<void>\n\t{\n\t\treturn this.#api.getLinkForSigning(\n\t\t\tthis.#memberId,\n\t\t\tfalse,\n\t\t).then((data) => {\n\t\t\tif (data?.status === 'error')\n\t\t\t{\n\t\t\t\tthrow data;\n\t\t\t}\n\n\t\t\tthis.#uri = data.uri;\n\t\t\tthis.#showHelpdeskGoskey = data.showHelpdeskGoskey;\n\t\t\tthis.#requireBrowser = data?.requireBrowser ?? true;\n\t\t\tthis.#mobileAllowed = data?.mobileAllowed ?? true;\n\t\t\tthis.#employeeData = data?.employeeData ?? {};\n\t\t\tthis.#loaded = true;\n\t\t}).catch((errors) => {\n\t\t\tthis.#loaded = true;\n\t\t\tthis.#errorCode = errors?.errors?.[0]?.code;\n\t\t\tthis.#errorMessage = errors?.errors?.[0]?.message;\n\t\t});\n\t}\n\n\t#getLoader(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('mask', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-ui-signing-link-loading-mask\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#renderError(title: ?string, message: ?string): void\n\t{\n\t\ttitle = title || Loc.getMessage('SIGN_V2_B2E_LINK_ERROR_TITLE_PLACEHOLDER');\n\t\ttitle = Tag.safe`${title}`;\n\n\t\tmessage = message || Loc.getMessage('SIGN_V2_B2E_LINK_ERROR_MESSAGE_PLACEHOLDER');\n\t\tmessage = Tag.safe`${message}`;\n\n\t\tconst el = Tag.render`\n\t\t\t<div class=\"ui-slider-no-access\">\n\t\t\t\t<div class=\"ui-slider-no-access-inner\">\n\t\t\t\t\t<div class=\"ui-slider-no-access-title\">\n\t\t\t\t\t\t${title}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-slider-no-access-subtitle\">\n\t\t\t\t\t\t${message}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-slider-no-access-img\">\n\t\t\t\t\t\t<div class=\"ui-slider-no-access-img-inner\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.append(el, this.#container);\n\t}\n\n\t#getErrorTitle(errorCode: ?string): string\n\t{\n\t\tif (errorCode === 'ACCESS_DENIED')\n\t\t{\n\t\t\treturn Loc.getMessage('SIGN_V2_B2E_LINK_ERROR_CODE_ACCESS_DENIED');\n\t\t}\n\n\t\treturn Loc.getMessage('SIGN_V2_B2E_LINK_ERROR_TITLE_PLACEHOLDER');\n\t}\n\n\t#renderUrl(): void\n\t{\n\t\tDom.append(this.#getLoader(), this.#container);\n\n\t\t// redirect if opened directly (new tab)\n\t\tif (!BX.SidePanel.Instance.isOpen() || Browser.isMobile())\n\t\t{\n\t\t\twindow.location.href = this.#uri;\n\t\t\treturn;\n\t\t}\n\t\tBX.SidePanel.Instance.newWindowUrl = window.location.href;\n\n\t\tthis.#frameEventHandler = (event) => this.#handleIframeEvent(event);\n\t\tEvent.bind(top, 'message', this.#frameEventHandler);\n\n\t\tconst frameStyles = 'position: absolute; left: 0; top: 0; padding: 0;'\n\t\t\t+ ' border: none; margin: 0; width: 100%; height: 100%;'\n\t\t;\n\n\t\tconst onloadHandler = () => { Dom.remove(this.#getLoader()) };\n\t\tconst iframe = Tag.render`\n\t\t\t<iframe \n\t\t\t\tsrc=\"${this.#uri}\" \n\t\t\t\treferrerpolicy=\"strict-origin\" \n\t\t\t\tstyle=\"${frameStyles}\"\n\t\t\t\tonload=\"${onloadHandler}\"\n\t\t\t></iframe>\n\t\t`;\n\t\tDom.append(iframe, this.#container);\n\t}\n\n\t#renderContinueInBrowserPage(): void\n\t{\n\t\tDom.append(Tag.render`\n\t\t\t<div class=\"sign-ui-signing-link__empty-state\">\n\t\t\t\t<div class=\"sign-ui-signing-link__empty-state_icon\"></div>\n\t\t\t\t<div class=\"sign-ui-signing-link__empty-state_title\">\n\t\t\t\t\t${Text.encode(Loc.getMessage('SIGN_V2_B2E_LINK_DESKTOP_TITLE'))}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-ui-signing-link__empty-state_desc\">\n\t\t\t\t\t${Text.encode(Loc.getMessage('SIGN_V2_B2E_LINK_DESKTOP_TEXT'))}\n\t\t\t\t</div>\n\t\t\t\t<a\n\t\t\t\t\thref=\"${Text.encode(this.#uri)}\"\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round\"\n\t\t\t\t>\n\t\t\t\t\t${Text.encode(Loc.getMessage('SIGN_V2_B2E_LINK_DESKTOP_BUTTON'))}\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t`, this.#container);\n\t}\n\n\t#renderDownloadSignedDocForEmployee(): void\n\t{\n\t\tDom.append(Tag.render`\n\t\t\t<div class=\"sign-ui-signing-link__employee\">\n\t\t\t\t<div class=\"sign-ui-signing-link__employee-header\">\n\t\t\t\t\t<div class=\"sign-ui-signing-link__employee-header-header\">\n\t\t\t\t\t\t<h2>${Text.encode(this.#employeeData.document.title)}</h2>\n\t\t\t\t\t\t<p>${Loc.getMessage('SIGN_V2_B2E_LINK_EMPLOYEE_DISCLAIMER_MSGVER1')}</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#renderMemberInfo ? this.#renderMemberInfoBlock(this.#employeeData.member) : ''}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"sign-ui-signing-link__employee-doc\">\n\t\t\t\t\t<p>${Loc.getMessage('SIGN_V2_B2E_LINK_EMPLOYEE_SIGNED_DOC_MSG')}</p>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<span class=\"sign-ui-signing-link__employee-doc--icon\"></span>\n\t\t\t\t\t\t\t<div class=\"sign-ui-signing-link__employee-doc--info\">\n\t\t\t\t\t\t\t\t<div class=\"sign-ui-signing-link__employee-doc--info-title\">\n\t\t\t\t\t\t\t\t\t${Text.encode(this.#employeeData.document.title)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"sign-ui-signing-link__employee-doc--info-date\">\n\t\t\t\t\t\t\t\t\t${Loc.getMessage('SIGN_V2_B2E_LINK_EMPLOYEE_DOCUMENT_DATE', {\n\t\t\t\t\t\t\t\t\t\t'#DATE#': DateTimeFormat.format(DateTimeFormat.getFormat('LONG_DATE_FORMAT'), this.#employeeData.dateSignedTs),\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<a href=\"${Text.encode(this.#employeeData.uri.signedDocument)}\" class=\"ui-btn ui-btn-success ui-btn-round ui-btn-sm\" download>\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_V2_B2E_LINK_EMPLOYEE_SIGNED_DOC_BTN')}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div onclick=\"BX.SidePanel.Instance.open('${Text.encode(this.#employeeData.uri.allDocuments)}')\" class=\"sign-ui-signing-link__employee-alldocs\" target=\"_blank\">\n\t\t\t\t\t${Loc.getMessage('SIGN_V2_B2E_LINK_EMPLOYEE_BUTTON_ALLDOCS')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`, this.#container);\n\t}\n\n\t#renderMemberInfoBlock(memberInfo: Object): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-ui-signing-link__employee-header-person\">\n\t\t\t\t<div class=\"sign-ui-signing-link__employee-header-person-photo\">\n\t\t\t\t\t<img src=\"${Text.encode(memberInfo?.photo)}\" alt=\"\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-ui-signing-link__employee-header-person-text\">\n\t\t\t\t\t${Text.encode(memberInfo?.name)}\n\t\t\t\t\t<br>\n\t\t\t\t\t${Text.encode(memberInfo?.position)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#needToShowPageForEmployee(): boolean\n\t{\n\t\treturn this.#employeeData?.signed === true;\n\t}\n\n\t#isNeedToContinueInBrowser(): boolean\n\t{\n\t\treturn this.#requireBrowser && this.#isDesktopApp();\n\t}\n\n\t#isNeedToContinueOnDesktop(): boolean\n\t{\n\t\treturn Browser.isMobile() && !this.#mobileAllowed;\n\t}\n\n\t#isDesktopApp(): boolean\n\t{\n\t\t// return window.navigator.userAgent.includes('BitrixDesktop');\n\t\treturn typeof (BXDesktopSystem) != \"undefined\" || typeof (BXDesktopWindow) != \"undefined\";\n\t}\n\n\t#handleIframeEvent(event): void\n\t{\n\t\tif (this.#uri.indexOf(event.origin) !== 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet message = { type: '', data: undefined };\n\t\tif (Type.isString(event?.data))\n\t\t{\n\t\t\tmessage.type = event.data;\n\t\t}\n\n\t\tif (message.type === 'BX:SidePanel:close')\n\t\t{\n\t\t\tthis.#slider?.close();\n\t\t\tEvent.unbind(window, 'message', this.#frameEventHandler);\n\t\t}\n\t}\n}\n"],"names":["SignLink","options","Cache","MemoryCache","Api","memberId","requireBrowser","mobileAllowed","slider","signLink","BX","SidePanel","Instance","open","width","cacheable","allowCrossOrigin","allowCrossDomain","allowChangeHistory","copyLinkLabel","newWindowLabel","loader","label","text","Loc","getMessage","bgColor","contentCallback","Promise","resolve","then","render","events","getSlider","node","document","createElement","Dom","addClass","append","remove","getLinkForSigning","data","status","uri","showHelpdeskGoskey","employeeData","errors","code","message","remember","Tag","title","safe","el","errorCode","isOpen","Browser","isMobile","window","location","href","newWindowUrl","event","Event","bind","top","frameStyles","onloadHandler","iframe","Text","encode","member","DateTimeFormat","format","getFormat","dateSignedTs","signedDocument","allDocuments","memberInfo","photo","name","position","signed","BXDesktopSystem","BXDesktopWindow","indexOf","origin","type","undefined","Type","isString","close","unbind"],"mappings":"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"}