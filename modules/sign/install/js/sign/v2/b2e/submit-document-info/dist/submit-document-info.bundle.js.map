{"version":3,"file":"submit-document-info.bundle.js","sources":["../src/date-picker-field.js","../src/images/ready-to-send-state-image.svg","../src/index.js"],"sourcesContent":["import { Tag, Text, Type } from 'main.core';\nimport { DatePicker } from 'ui.date-picker';\nimport { BaseField } from 'ui.form-elements.view';\n\nexport class DatePickerField extends BaseField\n{\n\t#datepicker: DatePicker;\n\t#inputNode: HTMLElement;\n\tdefaultValue: string;\n\tconstructor(params: {value?: string})\n\t{\n\t\tsuper(params);\n\t\tthis.defaultValue = Type.isStringFilled(params.value) ? params.value : '';\n\t\tthis.#datepicker = new DatePicker({\n\t\t\ttype: 'date',\n\t\t\tinputField: this.getInputNode(),\n\t\t\ttargetNode: this.getInputNode(),\n\t\t});\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.getInputNode().value;\n\t}\n\n\tgetInputNode(): HTMLElement\n\t{\n\t\tthis.#inputNode ??= this.#renderInputNode();\n\n\t\treturn this.#inputNode;\n\t}\n\n\t#renderInputNode(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<input\n\t\t\t\tvalue=\"${Text.encode(this.defaultValue)}\" \n\t\t\t\tname=\"${Text.encode(this.getName())}\" \n\t\t\t\ttype=\"text\" \n\t\t\t\tclass=\"ui-ctl-element --readonly\" \n\t\t\t\treadonly\n\t\t\t>\n\t\t`;\n\t}\n\n\trenderContentField(): HTMLElement\n\t{\n\t\tconst lockElement = !this.isEnable ? this.renderLockElement() : null;\n\n\t\treturn Tag.render`\n\t\t\t<div id=\"${this.getId()}\" class=\"ui-section__field-selector\">\n\t\t\t\t<div class=\"ui-section__field-container\">\n\t\t\t\t\t<div class=\"ui-section__field-label_box\">\n\t\t\t\t\t\t<label for=\"${this.getName()}\" class=\"ui-section__field-label\">\n\t\t\t\t\t\t\t${this.getLabel()}\n\t\t\t\t\t\t</label> \n\t\t\t\t\t\t${lockElement}\n\t\t\t\t\t</div>  \n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-block ui-ctl-after-icon ${this.inputDefaultWidth ? '' : 'ui-ctl-w100'}\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-calendar\"></div>\n\t\t\t\t\t\t${this.getInputNode()}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.renderErrors()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-section__hint\">\n\t\t\t\t\t${this.hintTitle}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n}\n","export default \"/bitrix/js/sign/v2/b2e/submit-document-info/dist/images/ready-to-send-state-image.svg\"","import { Dom, Loc, Tag, Text, Type } from 'main.core';\nimport { MemoryCache } from 'main.core.cache';\nimport { type BaseEvent, EventEmitter } from 'main.core.events';\nimport type { FieldValue, MemberStatusType, ProviderCodeType, TemplateField } from 'sign.v2.api';\nimport { Api, MemberStatus } from 'sign.v2.api';\nimport './style.css';\nimport 'ui.forms';\nimport { SignLink } from 'sign.v2.b2e.sign-link';\nimport { BaseField, Selector, TextInput } from 'ui.form-elements.view';\nimport { DatePickerField } from './date-picker-field';\nimport readyToSendImage from './images/ready-to-send-state-image.svg';\n\nfunction sleep(ms: number): Promise<void>\n{\n\treturn new Promise((resolve) => {\n\t\tsetTimeout(resolve, ms);\n\t});\n}\n\ntype Options = {\n\ttemplate: {\n\t\tuid: string,\n\t\ttitle: string,\n\t},\n\tfields: Array<TemplateField>,\n};\n\ntype MemberInvitedToSignEventData = {\n\tdocumentUid: string,\n\tmember: { id: number, uid: string },\n\tsigningLink: string\n};\n\nexport type DocumentSendedSuccessFullyEvent = BaseEvent<{ document: { id: number, providerCode: ProviderCodeType } }>;\n\nexport class SubmitDocumentInfo extends EventEmitter\n{\n\tevents = Object.freeze({\n\t\tonProgressClosePageBtnClick: 'onProgressClosePageBtnClick',\n\t\tdocumentSendedSuccessFully: 'documentSendedSuccessFully',\n\t});\n\n\t#cache: MemoryCache<any> = new MemoryCache();\n\t#layoutCache: MemoryCache<HTMLElement> = new MemoryCache();\n\t#options: Options;\n\t#api: Api = new Api();\n\t#fieldFormId: string = 'sign-b2e-employee-fields-form';\n\t#uiFields: BaseField[] = [];\n\n\tconstructor(options: Options)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.B2e.SubmitDocumentInfo');\n\t\tthis.#options = options;\n\t}\n\n\t#getProgressLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember(\n\t\t\t'progressLayout',\n\t\t\t() => Tag.render`\n\t\t\t\t<div class=\"sign-b2e-submit-document-info__progress\">\n\t\t\t\t\t<div class=\"sign-b2e-submit-document-info__progress_icon\"></div>\n\t\t\t\t\t<h2 class=\"sign-b2e-submit-document-info__progress_head\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_SUBMIT_DOCUMENT_INFO_PROGRESS_HEAD')}\n\t\t\t\t\t</h2>\n\t\t\t\t\t<p class=\"sign-b2e-submit-document-info__progress_description\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_SUBMIT_DOCUMENT_INFO_PROGRESS_DESCRIPTION')}\n\t\t\t\t\t</p>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-round ui-btn-light-border\"\n\t\t\t\t\t\tonclick=\"${() => this.#onProgressClosePageBtnClick()}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${Loc.getMessage('SIGN_SUBMIT_DOCUMENT_INFO_PROGRESS_CLOSE')}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t`,\n\t\t);\n\t}\n\n\t#showProgress(): void\n\t{\n\t\tDom.append(this.#getProgressLayout(), this.getLayout());\n\t}\n\n\t#hideProgress(): void\n\t{\n\t\tDom.remove(this.#getProgressLayout());\n\t}\n\n\t#onProgressClosePageBtnClick(): void\n\t{\n\t\tthis.emit(this.event.onProgressClosePageBtnClick);\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember(\n\t\t\t'layout',\n\t\t\t() => {\n\t\t\t\tif (this.#options.fields.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t<div class=\"sign-submit-document-info-center-container\">\n\t\t\t\t\t\t\t<div class=\"sign-submit-document-info-center-icon\">\n\t\t\t\t\t\t\t\t<img src=\"${readyToSendImage}\" alt=\"\">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<p class=\"sign-submit-document-info-center-title\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('SIGN_SUBMIT_DOCUMENT_INFO_READY_TO_SEND_TITLE')}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<p class=\"sign-submit-document-info-center-description\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('SIGN_SUBMIT_DOCUMENT_INFO_READY_TO_SEND_DESCRIPTION', {\n\t\t\t\t\t\t\t\t\t'#TITLE#': Text.encode(this.#options.template.title),\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<form id=\"${this.#fieldFormId}\"></form>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;\n\t\t\t\t}\n\n\t\t\t\treturn Tag.render`\n\t\t\t\t\t<div class=\"sign-b2e-submit-document-info\">\n\t\t\t\t\t\t<h1 class=\"sign-b2e-settings__header\">${Loc.getMessage('SIGN_SUBMIT_DOCUMENT_INFO_HEAD')}</h1>\n\t\t\t\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('SIGN_SUBMIT_DOCUMENT_INFO_DESCRIPTION')}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<form id=\"${this.#fieldFormId}\">\n\t\t\t\t\t\t\t\t${this.#getFieldsLayout()}\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t},\n\t\t);\n\t}\n\n\tasync sendForSign(): Promise<boolean>\n\t{\n\t\tconst currentSidePanel = BX.SidePanel.Instance.getTopSlider();\n\t\tif (!this.#isFieldsValid())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet employeeMember = null;\n\t\tlet document: null | { id: number, providerCode: ProviderCodeType } = null;\n\t\tEventEmitter.emit('BX.Sign.SignSettingsEmployee:onBeforeTemplateSend');\n\t\ttry\n\t\t{\n\t\t\tconst sendResult = await this.#api.template.send(\n\t\t\t\tthis.#options.template.uid,\n\t\t\t\tthis.#getFieldValues(),\n\t\t\t);\n\t\t\temployeeMember = sendResult.employeeMember;\n\t\t\tdocument = sendResult.document;\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error(e);\n\n\t\t\treturn false;\n\t\t}\n\t\tfinally\n\t\t{\n\t\t\tEventEmitter.emit('BX.Sign.SignSettingsEmployee:onAfterTemplateSend');\n\t\t}\n\t\tconst { uid: memberUid, id: memberId } = employeeMember;\n\t\tthis.emit(this.events.documentSendedSuccessFully, { document });\n\n\t\tthis.#showProgress();\n\t\tlet pending = true;\n\t\tlet openSigningSliderAfterPending = true;\n\t\tconst signLink = new SignLink({ memberId });\n\n\t\tEventEmitter.subscribeOnce(currentSidePanel, 'SidePanel.Slider:onCloseStart', () => {\n\t\t\tpending = false;\n\t\t\topenSigningSliderAfterPending = false;\n\t\t});\n\n\t\tBX.PULL?.subscribe({\n\t\t\tmoduleId: 'sign',\n\t\t\tcommand: 'memberInvitedToSign',\n\t\t\tcallback: async (params: MemberInvitedToSignEventData): Promise<void> => {\n\t\t\t\tif (params.member.id !== memberId || !pending || !openSigningSliderAfterPending)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tpending = false;\n\t\t\t\tawait this.#openSigningSliderAndCloseCurrent(signLink);\n\t\t\t},\n\t\t});\n\n\t\tdo\n\t\t{\n\t\t\tawait sleep(5000);\n\t\t\tif (!openSigningSliderAfterPending)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (!pending)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlet status: MemberStatusType | null = null;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tstatus = (await this.#api.getMember(memberUid)).status;\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tconsole.error(e);\n\t\t\t\tthis.#hideProgress();\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (status === MemberStatus.ready || status === MemberStatus.stoppableReady)\n\t\t\t{\n\t\t\t\tpending = false;\n\t\t\t}\n\t\t}\n\t\twhile (pending);\n\n\t\tif (openSigningSliderAfterPending)\n\t\t{\n\t\t\tawait this.#openSigningSliderAndCloseCurrent(signLink);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tasync #openSigningSliderAndCloseCurrent(signLink: SignLink): Promise<void>\n\t{\n\t\treturn this.#cache.remember('openSigningSliderAndCloseCurrent', async () => {\n\t\t\tconst currentSidePanel = BX.SidePanel.Instance.getTopSlider();\n\t\t\t// load signing data before close current slider\n\t\t\tawait signLink.preloadData();\n\t\t\tif (Type.isNull(currentSidePanel))\n\t\t\t{\n\t\t\t\tsignLink.openSlider({ events: {} });\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcurrentSidePanel.close(false, () => signLink.openSlider({ events: {} }));\n\t\t\t}\n\t\t});\n\t}\n\n\t#getFieldsLayout(): HTMLElement[]\n\t{\n\t\treturn this.#options.fields\n\t\t\t.map((field) => this.#getOrCreateFieldLayout(field))\n\t\t;\n\t}\n\n\t#getOrCreateFieldLayout(field: TemplateField): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember(`fieldLayout.${field.uid}`, () => {\n\t\t\tconst fieldsLayoutCallbackByType = this.#getFieldLayoutCallback(field);\n\n\t\t\tif (Type.isNull(fieldsLayoutCallbackByType))\n\t\t\t{\n\t\t\t\tthrow new TypeError(`Unknown field type: ${field.type}`);\n\t\t\t}\n\n\t\t\treturn fieldsLayoutCallbackByType(field);\n\t\t});\n\t}\n\n\t#getFieldLayoutCallback(field: TemplateField): () => HTMLElement\n\t{\n\t\tconst label = `\n\t\t\t<span>\n\t\t\t\t${Text.encode(field.name)} \n\t\t\t\t${field.required ? '<span class=\"sign-b2e-submit-document-info__field_required\">*</span>' : ''}\n\t\t\t</span>\n\t\t`;\n\n\t\tconst fieldsLayoutCallbackByType = {\n\t\t\tdate: () => {\n\t\t\t\tconst datePickerField = new DatePickerField({\n\t\t\t\t\tlabel,\n\t\t\t\t\tinputName: field.uid,\n\t\t\t\t\tvalue: field.value,\n\t\t\t\t});\n\t\t\t\tthis.#uiFields.push(datePickerField);\n\n\t\t\t\treturn Tag.render`\n\t\t\t\t\t<div class=\"sign-b2e-submit-document-info__field\">\n\t\t\t\t\t\t${datePickerField.render()}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t},\n\t\t\tstring: () => {\n\t\t\t\tconst fieldInput = new TextInput({\n\t\t\t\t\tlabel,\n\t\t\t\t\tinputName: field.uid,\n\t\t\t\t\tvalue: field.value,\n\t\t\t\t});\n\t\t\t\tthis.#uiFields.push(fieldInput);\n\n\t\t\t\treturn Tag.render`\n\t\t\t\t\t<div class=\"sign-b2e-submit-document-info__field\">\n\t\t\t\t\t\t${fieldInput.render()}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t},\n\t\t\tlist: () => {\n\t\t\t\tconst selector = new Selector({\n\t\t\t\t\tlabel,\n\t\t\t\t\tname: field.uid,\n\t\t\t\t\tinputName: field.uid,\n\t\t\t\t\titems: this.#getSelectorItemsWithEmpty(field),\n\t\t\t\t});\n\n\t\t\t\tthis.#uiFields.push(selector);\n\n\t\t\t\treturn Tag.render`\n\t\t\t\t\t<div class=\"sign-b2e-submit-document-info__field\">\n\t\t\t\t\t\t${selector.render()}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t},\n\t\t\t// @TODO address picker\n\t\t\taddress: () => Tag.render`\n\t\t\t\t<div class=\"sign-b2e-submit-document-info__field\">\n\t\t\t\t\t<span class=\"sign-b2e-submit-document-info__label\">\n\t\t\t\t\t\t${Text.encode(field.name)}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"sign-b2e-submit-document-info__subfields\">\n\t\t\t\t\t\t${field.subfields.map((subfield) => Tag.render`\n\t\t\t\t\t\t\t<div>${this.#getOrCreateFieldLayout(subfield)}</div>\n\t\t\t\t\t\t`)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`,\n\t\t};\n\n\t\tconst defaultLayout = () => Tag.render`<div></div>`;\n\n\t\treturn fieldsLayoutCallbackByType[field.type] ?? defaultLayout;\n\t}\n\n\t#getFieldValues(): FieldValue[]\n\t{\n\t\tconst form = document.getElementById(this.#fieldFormId);\n\t\tconst formData = new FormData(form);\n\n\t\tconst fieldValues = [];\n\n\t\tformData.forEach((value, name) => {\n\t\t\tfieldValues.push({ name, value });\n\t\t});\n\n\t\treturn fieldValues;\n\t}\n\n\t#isFieldsValid(): boolean\n\t{\n\t\tlet errorCount = 0;\n\t\tthis.#uiFields.forEach((domField: BaseField) => {\n\t\t\tdomField.cleanError();\n\t\t\tconst templateField = this.#getFieldByUid(domField.getName());\n\t\t\tif (!templateField)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (templateField.required && domField.getValue()?.trim() === '')\n\t\t\t{\n\t\t\t\tdomField.setErrors([]);\n\t\t\t\terrorCount += 1;\n\t\t\t}\n\t\t});\n\n\t\treturn errorCount === 0;\n\t}\n\n\t#getFieldByUid(uid: string): ?TemplateField\n\t{\n\t\treturn this.#findFieldByUidRecursive(uid, this.#options.fields);\n\t}\n\n\t#findFieldByUidRecursive(uid: string, fields: TemplateField[]): ?TemplateField\n\t{\n\t\tfor (const field of fields)\n\t\t{\n\t\t\tif (field.uid === uid)\n\t\t\t{\n\t\t\t\treturn field;\n\t\t\t}\n\n\t\t\tif (field.subfields)\n\t\t\t{\n\t\t\t\tconst subfield = this.#findFieldByUidRecursive(uid, field.subfields);\n\t\t\t\tif (subfield)\n\t\t\t\t{\n\t\t\t\t\treturn subfield;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#getSelectorItemsWithEmpty(field: TemplateField): Array<{ value: string, name: string, selected: boolean }>\n\t{\n\t\tconst items = [];\n\n\t\tif (!field.items.some((item) => item.code === field.value))\n\t\t{\n\t\t\titems.push({\n\t\t\t\tvalue: '',\n\t\t\t\tname: '',\n\t\t\t\tselected: true,\n\t\t\t\thidden: true,\n\t\t\t\tdisabled: true,\n\t\t\t});\n\t\t}\n\n\t\tfield.items.forEach((item) => {\n\t\t\titems.push({\n\t\t\t\tvalue: Text.encode(item.code),\n\t\t\t\tname: Text.encode(item.label),\n\t\t\t\tselected: item.code === field.value,\n\t\t\t});\n\t\t});\n\n\t\treturn items;\n\t}\n}\n"],"names":["DatePickerField","BaseField","constructor","params","defaultValue","Type","isStringFilled","value","DatePicker","type","inputField","getInputNode","targetNode","getValue","renderContentField","lockElement","isEnable","renderLockElement","Tag","render","getId","getName","getLabel","inputDefaultWidth","renderErrors","hintTitle","Text","encode","sleep","ms","Promise","resolve","setTimeout","SubmitDocumentInfo","EventEmitter","options","events","Object","freeze","onProgressClosePageBtnClick","documentSendedSuccessFully","MemoryCache","Api","setEventNamespace","getLayout","remember","fields","length","readyToSendImage","Loc","getMessage","template","title","sendForSign","currentSidePanel","BX","SidePanel","Instance","getTopSlider","employeeMember","document","emit","sendResult","send","uid","e","console","error","memberUid","id","memberId","pending","openSigningSliderAfterPending","signLink","SignLink","subscribeOnce","PULL","subscribe","moduleId","command","callback","member","status","getMember","MemberStatus","ready","stoppableReady","Dom","append","remove","event","close","preloadData","isNull","openSlider","map","field","fieldsLayoutCallbackByType","TypeError","label","name","required","date","datePickerField","inputName","push","string","fieldInput","TextInput","list","selector","Selector","items","address","subfields","subfield","defaultLayout","form","getElementById","formData","FormData","fieldValues","forEach","errorCount","domField","cleanError","templateField","trim","setErrors","some","item","code","selected","hidden","disabled"],"mappings":";;;;;;;;;;AAAA,CAEkD;CAAA;CAAA;AAElD,CAAO,MAAMA,eAAe,SAASC,8BAAS,CAC9C;GAICC,WAAW,CAACC,MAAwB,EACpC;KACC,KAAK,CAACA,MAAM,CAAC;KAAC;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACd,IAAI,CAACC,YAAY,GAAGC,cAAI,CAACC,cAAc,CAACH,MAAM,CAACI,KAAK,CAAC,GAAGJ,MAAM,CAACI,KAAK,GAAG,EAAE;KACzE,4CAAI,8BAAe,IAAIC,wBAAU,CAAC;OACjCC,IAAI,EAAE,MAAM;OACZC,UAAU,EAAE,IAAI,CAACC,YAAY,EAAE;OAC/BC,UAAU,EAAE,IAAI,CAACD,YAAY;MAC7B,CAAC;;GAGHE,QAAQ,GACR;KACC,OAAO,IAAI,CAACF,YAAY,EAAE,CAACJ,KAAK;;GAGjCI,YAAY,GACZ;KAAA;KACC,+FAAI,2IAAgB,IAAI;KAExB,+CAAO,IAAI;;GAgBZG,kBAAkB,GAClB;KACC,MAAMC,WAAW,GAAG,CAAC,IAAI,CAACC,QAAQ,GAAG,IAAI,CAACC,iBAAiB,EAAE,GAAG,IAAI;KAEpE,OAAOC,aAAG,CAACC,MAAM,cAAC;cACR,CAAe;;;oBAGT,CAAiB;SAC5B,CAAkB;;QAEnB,CAAc;;wEAEkD,CAA8C;;QAE9G,CAAsB;;OAEvB,CAAsB;;;OAGtB,CAAiB;;;GAGpB,GAlBY,IAAI,CAACC,KAAK,EAAE,EAGN,IAAI,CAACC,OAAO,EAAE,EACzB,IAAI,CAACC,QAAQ,EAAE,EAEhBP,WAAW,EAEqD,IAAI,CAACQ,iBAAiB,GAAG,EAAE,GAAG,aAAa,EAE3G,IAAI,CAACZ,YAAY,EAAE,EAEpB,IAAI,CAACa,YAAY,EAAE,EAGnB,IAAI,CAACC,SAAS;;CAKrB;CAAC,6BArCA;GACC,OAAOP,aAAG,CAACC,MAAM,gBAAC;;aAET,CAAiC;YAClC,CAA8B;;;;;GAKtC,GANWO,cAAI,CAACC,MAAM,CAAC,IAAI,CAACvB,YAAY,CAAC,EAC/BsB,cAAI,CAACC,MAAM,CAAC,IAAI,CAACN,OAAO,EAAE,CAAC;CAMtC;;AC3CD,wBAAe,uFAAuF;;;;;;;;;;;;ACAtG,CAYA,SAASO,KAAK,CAACC,EAAU,EACzB;GACC,OAAO,IAAIC,OAAO,CAAEC,OAAO,IAAK;KAC/BC,UAAU,CAACD,OAAO,EAAEF,EAAE,CAAC;IACvB,CAAC;CACH;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAkBD,CAAO,MAAMI,kBAAkB,SAASC,6BAAY,CACpD;GAaChC,WAAW,CAACiC,OAAgB,EAC5B;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA,KAdTC,MAAM,GAAGC,MAAM,CAACC,MAAM,CAAC;OACtBC,2BAA2B,EAAE,6BAA6B;OAC1DC,0BAA0B,EAAE;MAC5B,CAAC;KAAA;OAAA;OAAA,OAEyB,IAAIC,2BAAW;;KAAE;OAAA;OAAA,OACH,IAAIA,2BAAW;;KAAE;OAAA;OAAA;;KAAA;OAAA;OAAA,OAE9C,IAAIC,eAAG;;KAAE;OAAA;OAAA,OACE;;KAA+B;OAAA;OAAA,OAC7B;;KAKxB,IAAI,CAACC,iBAAiB,CAAC,mCAAmC,CAAC;KAC3D,4CAAI,wBAAYR,OAAO;;GA2CxBS,SAAS,GACT;KACC,OAAO,4CAAI,8BAAcC,QAAQ,CAChC,QAAQ,EACR,MAAM;OACL,IAAI,4CAAI,sBAAUC,MAAM,CAACC,MAAM,KAAK,CAAC,EACrC;SACC,OAAO7B,aAAG,CAACC,MAAM,oBAAC;;;oBAGL,CAAmB;;;UAG7B,CAAkE;;;UAGlE,CAEG;;mBAEM,CAAoB;;MAEhC,GAZe6B,gBAAgB,EAG1BC,aAAG,CAACC,UAAU,CAAC,+CAA+C,CAAC,EAG/DD,aAAG,CAACC,UAAU,CAAC,qDAAqD,EAAE;WACvE,SAAS,EAAExB,cAAI,CAACC,MAAM,CAAC,4CAAI,sBAAUwB,QAAQ,CAACC,KAAK;UACnD,CAAC,0CAES,IAAI;;OAKnB,OAAOlC,aAAG,CAACC,MAAM,sBAAC;;8CAEsB,CAAmD;;;UAGvF,CAA0D;;mBAEjD,CAAoB;UAC7B,CAA0B;;;;KAI9B,GAV0C8B,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC,EAGpFD,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC,0CAE9C,IAAI,uEACb,IAAI;MAKV,CACD;;GAGF,MAAMG,WAAW,GACjB;KAAA;KACC,MAAMC,gBAAgB,GAAGC,EAAE,CAACC,SAAS,CAACC,QAAQ,CAACC,YAAY,EAAE;KAC7D,IAAI,yCAAC,IAAI,mCAAiB,EAC1B;OACC,OAAO,KAAK;;KAGb,IAAIC,cAAc,GAAG,IAAI;KACzB,IAAIC,QAA+D,GAAG,IAAI;KAC1E1B,6BAAY,CAAC2B,IAAI,CAAC,mDAAmD,CAAC;KACtE,IACA;OACC,MAAMC,UAAU,GAAG,MAAM,4CAAI,cAAMX,QAAQ,CAACY,IAAI,CAC/C,4CAAI,sBAAUZ,QAAQ,CAACa,GAAG,0CAC1B,IAAI,sCACJ;OACDL,cAAc,GAAGG,UAAU,CAACH,cAAc;OAC1CC,QAAQ,GAAGE,UAAU,CAACF,QAAQ;MAC9B,CACD,OAAOK,CAAC,EACR;OACCC,OAAO,CAACC,KAAK,CAACF,CAAC,CAAC;OAEhB,OAAO,KAAK;MACZ,SAED;OACC/B,6BAAY,CAAC2B,IAAI,CAAC,kDAAkD,CAAC;;KAEtE,MAAM;OAAEG,GAAG,EAAEI,SAAS;OAAEC,EAAE,EAAEC;MAAU,GAAGX,cAAc;KACvD,IAAI,CAACE,IAAI,CAAC,IAAI,CAACzB,MAAM,CAACI,0BAA0B,EAAE;OAAEoB;MAAU,CAAC;KAE/D,4CAAI;KACJ,IAAIW,OAAO,GAAG,IAAI;KAClB,IAAIC,6BAA6B,GAAG,IAAI;KACxC,MAAMC,QAAQ,GAAG,IAAIC,6BAAQ,CAAC;OAAEJ;MAAU,CAAC;KAE3CpC,6BAAY,CAACyC,aAAa,CAACrB,gBAAgB,EAAE,+BAA+B,EAAE,MAAM;OACnFiB,OAAO,GAAG,KAAK;OACfC,6BAA6B,GAAG,KAAK;MACrC,CAAC;KAEF,YAAAjB,EAAE,CAACqB,IAAI,qBAAP,SAASC,SAAS,CAAC;OAClBC,QAAQ,EAAE,MAAM;OAChBC,OAAO,EAAE,qBAAqB;OAC9BC,QAAQ,EAAE,MAAO7E,MAAoC,IAAoB;SACxE,IAAIA,MAAM,CAAC8E,MAAM,CAACZ,EAAE,KAAKC,QAAQ,IAAI,CAACC,OAAO,IAAI,CAACC,6BAA6B,EAC/E;WACC;;SAGDD,OAAO,GAAG,KAAK;SACf,8CAAM,IAAI,wEAAmCE,QAAQ,CAAC;;MAEvD,CAAC;KAEF,GACA;OACC,MAAM7C,KAAK,CAAC,IAAI,CAAC;OACjB,IAAI,CAAC4C,6BAA6B,EAClC;SACC,OAAO,IAAI;;OAGZ,IAAI,CAACD,OAAO,EACZ;SACC;;OAED,IAAIW,MAA+B,GAAG,IAAI;OAC1C,IACA;SACCA,MAAM,GAAG,CAAC,MAAM,4CAAI,cAAMC,SAAS,CAACf,SAAS,CAAC,EAAEc,MAAM;QACtD,CACD,OAAOjB,CAAC,EACR;SACCC,OAAO,CAACC,KAAK,CAACF,CAAC,CAAC;SAChB,4CAAI;SAEJ,OAAO,KAAK;;OAGb,IAAIiB,MAAM,KAAKE,wBAAY,CAACC,KAAK,IAAIH,MAAM,KAAKE,wBAAY,CAACE,cAAc,EAC3E;SACCf,OAAO,GAAG,KAAK;;MAEhB,QACMA,OAAO;KAEd,IAAIC,6BAA6B,EACjC;OACC,8CAAM,IAAI,wEAAmCC,QAAQ,CAAC;;KAGvD,OAAO,IAAI;;CA0Mb;CAAC,+BAzXA;GACC,OAAO,4CAAI,8BAAc5B,QAAQ,CAChC,gBAAgB,EAChB,MAAM3B,aAAG,CAACC,MAAM,kBAAC;;;;QAId,CAA4D;;;QAG5D,CAAmE;;;;iBAI1D,CAA4C;;QAErD,CAA6D;;;IAGhE,GAZK8B,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC,EAGzDD,aAAG,CAACC,UAAU,CAAC,gDAAgD,CAAC,EAIvD,8CAAM,IAAI,+DAA+B,EAElDD,aAAG,CAACC,UAAU,CAAC,0CAA0C,CAAC,CAG9D,CACD;CACF;CAAC,0BAGD;GACCqC,aAAG,CAACC,MAAM,yCAAC,IAAI,6CAAuB,IAAI,CAAC5C,SAAS,EAAE,CAAC;CACxD;CAAC,0BAGD;GACC2C,aAAG,CAACE,MAAM,yCAAC,IAAI,4CAAsB;CACtC;CAAC,yCAGD;GACC,IAAI,CAAC5B,IAAI,CAAC,IAAI,CAAC6B,KAAK,CAACnD,2BAA2B,CAAC;GACjDgB,EAAE,CAACC,SAAS,CAACC,QAAQ,CAACkC,KAAK,EAAE;CAC9B;CAAC,kDA6IuClB,QAAkB,EAC1D;GACC,OAAO,4CAAI,kBAAQ5B,QAAQ,CAAC,kCAAkC,EAAE,YAAY;KAC3E,MAAMS,gBAAgB,GAAGC,EAAE,CAACC,SAAS,CAACC,QAAQ,CAACC,YAAY,EAAE;;KAE7D,MAAMe,QAAQ,CAACmB,WAAW,EAAE;KAC5B,IAAIvF,cAAI,CAACwF,MAAM,CAACvC,gBAAgB,CAAC,EACjC;OACCmB,QAAQ,CAACqB,UAAU,CAAC;SAAE1D,MAAM,EAAE;QAAI,CAAC;MACnC,MAED;OACCkB,gBAAgB,CAACqC,KAAK,CAAC,KAAK,EAAE,MAAMlB,QAAQ,CAACqB,UAAU,CAAC;SAAE1D,MAAM,EAAE;QAAI,CAAC,CAAC;;IAEzE,CAAC;CACH;CAAC,6BAGD;GACC,OAAO,4CAAI,sBAAUU,MAAM,CACzBiD,GAAG,CAAEC,KAAK,4CAAK,IAAI,oDAAyBA,KAAK,CAAC,CAAC;CAEtD;CAAC,kCAEuBA,KAAoB,EAC5C;GACC,OAAO,4CAAI,8BAAcnD,QAAQ,CAAE,eAAcmD,KAAK,CAAChC,GAAI,EAAC,EAAE,MAAM;KACnE,MAAMiC,0BAA0B,2CAAG,IAAI,oDAAyBD,KAAK,CAAC;KAEtE,IAAI3F,cAAI,CAACwF,MAAM,CAACI,0BAA0B,CAAC,EAC3C;OACC,MAAM,IAAIC,SAAS,CAAE,uBAAsBF,KAAK,CAACvF,IAAK,EAAC,CAAC;;KAGzD,OAAOwF,0BAA0B,CAACD,KAAK,CAAC;IACxC,CAAC;CACH;CAAC,kCAEuBA,KAAoB,EAC5C;GAAA;GACC,MAAMG,KAAK,GAAI;;MAEXzE,cAAI,CAACC,MAAM,CAACqE,KAAK,CAACI,IAAI,CAAE;MACxBJ,KAAK,CAACK,QAAQ,GAAG,sEAAsE,GAAG,EAAG;;GAEhG;GAED,MAAMJ,0BAA0B,GAAG;KAClCK,IAAI,EAAE,MAAM;OACX,MAAMC,eAAe,GAAG,IAAIvG,eAAe,CAAC;SAC3CmG,KAAK;SACLK,SAAS,EAAER,KAAK,CAAChC,GAAG;SACpBzD,KAAK,EAAEyF,KAAK,CAACzF;QACb,CAAC;OACF,4CAAI,wBAAWkG,IAAI,CAACF,eAAe,CAAC;OAEpC,OAAOrF,aAAG,CAACC,MAAM,kBAAC;;QAEhB,CAA2B;;KAE7B,GAFIoF,eAAe,CAACpF,MAAM,EAAE;MAG5B;KACDuF,MAAM,EAAE,MAAM;OACb,MAAMC,UAAU,GAAG,IAAIC,8BAAS,CAAC;SAChCT,KAAK;SACLK,SAAS,EAAER,KAAK,CAAChC,GAAG;SACpBzD,KAAK,EAAEyF,KAAK,CAACzF;QACb,CAAC;OACF,4CAAI,wBAAWkG,IAAI,CAACE,UAAU,CAAC;OAE/B,OAAOzF,aAAG,CAACC,MAAM,kBAAC;;QAEhB,CAAsB;;KAExB,GAFIwF,UAAU,CAACxF,MAAM,EAAE;MAGvB;KACD0F,IAAI,EAAE,MAAM;OACX,MAAMC,QAAQ,GAAG,IAAIC,6BAAQ,CAAC;SAC7BZ,KAAK;SACLC,IAAI,EAAEJ,KAAK,CAAChC,GAAG;SACfwC,SAAS,EAAER,KAAK,CAAChC,GAAG;SACpBgD,KAAK,0CAAE,IAAI,0DAA4BhB,KAAK;QAC5C,CAAC;OAEF,4CAAI,wBAAWS,IAAI,CAACK,QAAQ,CAAC;OAE7B,OAAO5F,aAAG,CAACC,MAAM,kBAAC;;QAEhB,CAAoB;;KAEtB,GAFI2F,QAAQ,CAAC3F,MAAM,EAAE;MAGrB;;KAED8F,OAAO,EAAE,MAAM/F,aAAG,CAACC,MAAM,kBAAC;;;QAGvB,CAA0B;;;QAG1B,CAEG;;;IAGN,GARKO,cAAI,CAACC,MAAM,CAACqE,KAAK,CAACI,IAAI,CAAC,EAGvBJ,KAAK,CAACkB,SAAS,CAACnB,GAAG,CAAEoB,QAAQ,IAAKjG,aAAG,CAACC,MAAM,kBAAC;cACzC,CAAyC;OAC/C,2CADQ,IAAI,oDAAyBgG,QAAQ,EAC5C,CAAC;IAIL;GAED,MAAMC,aAAa,GAAG,MAAMlG,aAAG,CAACC,MAAM,kBAAC,aAAW,EAAC;GAEnD,gCAAO8E,0BAA0B,CAACD,KAAK,CAACvF,IAAI,CAAC,oCAAI2G,aAAa;CAC/D;CAAC,4BAGD;GACC,MAAMC,IAAI,GAAGzD,QAAQ,CAAC0D,cAAc,yCAAC,IAAI,8BAAc;GACvD,MAAMC,QAAQ,GAAG,IAAIC,QAAQ,CAACH,IAAI,CAAC;GAEnC,MAAMI,WAAW,GAAG,EAAE;GAEtBF,QAAQ,CAACG,OAAO,CAAC,CAACnH,KAAK,EAAE6F,IAAI,KAAK;KACjCqB,WAAW,CAAChB,IAAI,CAAC;OAAEL,IAAI;OAAE7F;MAAO,CAAC;IACjC,CAAC;GAEF,OAAOkH,WAAW;CACnB;CAAC,2BAGD;GACC,IAAIE,UAAU,GAAG,CAAC;GAClB,4CAAI,wBAAWD,OAAO,CAAEE,QAAmB,IAAK;KAAA;KAC/CA,QAAQ,CAACC,UAAU,EAAE;KACrB,MAAMC,aAAa,2CAAG,IAAI,kCAAgBF,QAAQ,CAACvG,OAAO,EAAE,CAAC;KAC7D,IAAI,CAACyG,aAAa,EAClB;OACC;;KAGD,IAAIA,aAAa,CAACzB,QAAQ,IAAI,uBAAAuB,QAAQ,CAAC/G,QAAQ,EAAE,qBAAnB,mBAAqBkH,IAAI,EAAE,MAAK,EAAE,EAChE;OACCH,QAAQ,CAACI,SAAS,CAAC,EAAE,CAAC;OACtBL,UAAU,IAAI,CAAC;;IAEhB,CAAC;GAEF,OAAOA,UAAU,KAAK,CAAC;CACxB;CAAC,yBAEc3D,GAAW,EAC1B;GACC,+CAAO,IAAI,sDAA0BA,GAAG,EAAE,4CAAI,sBAAUlB,MAAM;CAC/D;CAAC,mCAEwBkB,GAAW,EAAElB,MAAuB,EAC7D;GACC,KAAK,MAAMkD,KAAK,IAAIlD,MAAM,EAC1B;KACC,IAAIkD,KAAK,CAAChC,GAAG,KAAKA,GAAG,EACrB;OACC,OAAOgC,KAAK;;KAGb,IAAIA,KAAK,CAACkB,SAAS,EACnB;OACC,MAAMC,QAAQ,2CAAG,IAAI,sDAA0BnD,GAAG,EAAEgC,KAAK,CAACkB,SAAS,CAAC;OACpE,IAAIC,QAAQ,EACZ;SACC,OAAOA,QAAQ;;;;GAKlB,OAAO,IAAI;CACZ;CAAC,qCAE0BnB,KAAoB,EAC/C;GACC,MAAMgB,KAAK,GAAG,EAAE;GAEhB,IAAI,CAAChB,KAAK,CAACgB,KAAK,CAACiB,IAAI,CAAEC,IAAI,IAAKA,IAAI,CAACC,IAAI,KAAKnC,KAAK,CAACzF,KAAK,CAAC,EAC1D;KACCyG,KAAK,CAACP,IAAI,CAAC;OACVlG,KAAK,EAAE,EAAE;OACT6F,IAAI,EAAE,EAAE;OACRgC,QAAQ,EAAE,IAAI;OACdC,MAAM,EAAE,IAAI;OACZC,QAAQ,EAAE;MACV,CAAC;;GAGHtC,KAAK,CAACgB,KAAK,CAACU,OAAO,CAAEQ,IAAI,IAAK;KAC7BlB,KAAK,CAACP,IAAI,CAAC;OACVlG,KAAK,EAAEmB,cAAI,CAACC,MAAM,CAACuG,IAAI,CAACC,IAAI,CAAC;OAC7B/B,IAAI,EAAE1E,cAAI,CAACC,MAAM,CAACuG,IAAI,CAAC/B,KAAK,CAAC;OAC7BiC,QAAQ,EAAEF,IAAI,CAACC,IAAI,KAAKnC,KAAK,CAACzF;MAC9B,CAAC;IACF,CAAC;GAEF,OAAOyG,KAAK;CACb;;;;;;;;"}