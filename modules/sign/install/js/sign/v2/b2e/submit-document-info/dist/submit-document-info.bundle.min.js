this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};this.BX.Sign.V2=this.BX.Sign.V2||{};(function(e,s,t,i,l,a,r,n,o){"use strict";let d=e=>e,c,u;var b=babelHelpers.classPrivateFieldLooseKey("datepicker");var v=babelHelpers.classPrivateFieldLooseKey("inputNode");var p=babelHelpers.classPrivateFieldLooseKey("renderInputNode");class m extends o.BaseField{constructor(e){super(e);Object.defineProperty(this,p,{value:h});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,v,{writable:true,value:void 0});this.defaultValue=r.Type.isStringFilled(e.value)?e.value:"";babelHelpers.classPrivateFieldLooseBase(this,b)[b]=new n.DatePicker({type:"date",inputField:this.getInputNode(),targetNode:this.getInputNode()})}getValue(){return this.getInputNode().value}getInputNode(){var e,s;(s=(e=babelHelpers.classPrivateFieldLooseBase(this,v))[v])!=null?s:e[v]=babelHelpers.classPrivateFieldLooseBase(this,p)[p]();return babelHelpers.classPrivateFieldLooseBase(this,v)[v]}renderContentField(){const e=!this.isEnable?this.renderLockElement():null;return r.Tag.render(c||(c=d`
			<div id="${0}" class="ui-section__field-selector">
				<div class="ui-section__field-container">
					<div class="ui-section__field-label_box">
						<label for="${0}" class="ui-section__field-label">
							${0}
						</label> 
						${0}
					</div>  
					<div class="ui-ctl ui-ctl-textbox ui-ctl-block ui-ctl-after-icon ${0}">
						<div class="ui-ctl-after ui-ctl-icon-calendar"></div>
						${0}
					</div>
					${0}
				</div>
				<div class="ui-section__hint">
					${0}
				</div>
			</div>
		`),this.getId(),this.getName(),this.getLabel(),e,this.inputDefaultWidth?"":"ui-ctl-w100",this.getInputNode(),this.renderErrors(),this.hintTitle)}}function h(){return r.Tag.render(u||(u=d`
			<input
				value="${0}" 
				name="${0}" 
				type="text" 
				class="ui-ctl-element --readonly" 
				readonly
			>
		`),r.Text.encode(this.defaultValue),r.Text.encode(this.getName()))}var g="/bitrix/js/sign/v2/b2e/submit-document-info/dist/images/ready-to-send-state-image.svg";let f=e=>e,P,y,F,L,B,_,S,H,T;function I(e){return new Promise((s=>{setTimeout(s,e)}))}var O=babelHelpers.classPrivateFieldLooseKey("cache");var E=babelHelpers.classPrivateFieldLooseKey("layoutCache");var N=babelHelpers.classPrivateFieldLooseKey("options");var $=babelHelpers.classPrivateFieldLooseKey("api");var C=babelHelpers.classPrivateFieldLooseKey("fieldFormId");var w=babelHelpers.classPrivateFieldLooseKey("uiFields");var M=babelHelpers.classPrivateFieldLooseKey("getProgressLayout");var D=babelHelpers.classPrivateFieldLooseKey("showProgress");var j=babelHelpers.classPrivateFieldLooseKey("hideProgress");var X=babelHelpers.classPrivateFieldLooseKey("onProgressClosePageBtnClick");var K=babelHelpers.classPrivateFieldLooseKey("openSigningSliderAndCloseCurrent");var U=babelHelpers.classPrivateFieldLooseKey("getFieldsLayout");var k=babelHelpers.classPrivateFieldLooseKey("getOrCreateFieldLayout");var x=babelHelpers.classPrivateFieldLooseKey("getFieldLayoutCallback");var R=babelHelpers.classPrivateFieldLooseKey("getFieldValues");var V=babelHelpers.classPrivateFieldLooseKey("isFieldsValid");var G=babelHelpers.classPrivateFieldLooseKey("getFieldByUid");var A=babelHelpers.classPrivateFieldLooseKey("findFieldByUidRecursive");var q=babelHelpers.classPrivateFieldLooseKey("getSelectorItemsWithEmpty");class W extends t.EventEmitter{constructor(e){super();Object.defineProperty(this,q,{value:ne});Object.defineProperty(this,A,{value:re});Object.defineProperty(this,G,{value:ae});Object.defineProperty(this,V,{value:le});Object.defineProperty(this,R,{value:ie});Object.defineProperty(this,x,{value:te});Object.defineProperty(this,k,{value:se});Object.defineProperty(this,U,{value:ee});Object.defineProperty(this,K,{value:Z});Object.defineProperty(this,X,{value:Q});Object.defineProperty(this,j,{value:J});Object.defineProperty(this,D,{value:z});Object.defineProperty(this,M,{value:Y});this.events=Object.freeze({onProgressClosePageBtnClick:"onProgressClosePageBtnClick",documentSendedSuccessFully:"documentSendedSuccessFully"});Object.defineProperty(this,O,{writable:true,value:new s.MemoryCache});Object.defineProperty(this,E,{writable:true,value:new s.MemoryCache});Object.defineProperty(this,N,{writable:true,value:void 0});Object.defineProperty(this,$,{writable:true,value:new i.Api});Object.defineProperty(this,C,{writable:true,value:"sign-b2e-employee-fields-form"});Object.defineProperty(this,w,{writable:true,value:[]});this.setEventNamespace("BX.Sign.V2.B2e.SubmitDocumentInfo");babelHelpers.classPrivateFieldLooseBase(this,N)[N]=e}getLayout(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E].remember("layout",(()=>{if(babelHelpers.classPrivateFieldLooseBase(this,N)[N].fields.length===0){return r.Tag.render(P||(P=f`
						<div class="sign-submit-document-info-center-container">
							<div class="sign-submit-document-info-center-icon">
								<img src="${0}" alt="">
							</div>
							<p class="sign-submit-document-info-center-title">
								${0}
							</p>
							<p class="sign-submit-document-info-center-description">
								${0}
							</p>
							<form id="${0}"></form>
						</div>
					`),g,r.Loc.getMessage("SIGN_SUBMIT_DOCUMENT_INFO_READY_TO_SEND_TITLE"),r.Loc.getMessage("SIGN_SUBMIT_DOCUMENT_INFO_READY_TO_SEND_DESCRIPTION",{"#TITLE#":r.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,N)[N].template.title)}),babelHelpers.classPrivateFieldLooseBase(this,C)[C])}return r.Tag.render(y||(y=f`
					<div class="sign-b2e-submit-document-info">
						<h1 class="sign-b2e-settings__header">${0}</h1>
						<div class="sign-b2e-settings__item">
							<p class="sign-b2e-settings__item_title">
								${0}
							</p>
							<form id="${0}">
								${0}
							</form>
						</div>
					</div>
				`),r.Loc.getMessage("SIGN_SUBMIT_DOCUMENT_INFO_HEAD"),r.Loc.getMessage("SIGN_SUBMIT_DOCUMENT_INFO_DESCRIPTION"),babelHelpers.classPrivateFieldLooseBase(this,C)[C],babelHelpers.classPrivateFieldLooseBase(this,U)[U]())}))}async sendForSign(){var e;const s=BX.SidePanel.Instance.getTopSlider();if(!babelHelpers.classPrivateFieldLooseBase(this,V)[V]()){return false}let l=null;let r=null;t.EventEmitter.emit("BX.Sign.SignSettingsEmployee:onBeforeTemplateSend");try{const e=await babelHelpers.classPrivateFieldLooseBase(this,$)[$].template.send(babelHelpers.classPrivateFieldLooseBase(this,N)[N].template.uid,babelHelpers.classPrivateFieldLooseBase(this,R)[R]());l=e.employeeMember;r=e.document}catch(e){console.error(e);return false}finally{t.EventEmitter.emit("BX.Sign.SignSettingsEmployee:onAfterTemplateSend")}const{uid:n,id:o}=l;this.emit(this.events.documentSendedSuccessFully,{document:r});babelHelpers.classPrivateFieldLooseBase(this,D)[D]();let d=true;let c=true;const u=new a.SignLink({memberId:o});t.EventEmitter.subscribeOnce(s,"SidePanel.Slider:onCloseStart",(()=>{d=false;c=false}));(e=BX.PULL)==null?void 0:e.subscribe({moduleId:"sign",command:"memberInvitedToSign",callback:async e=>{if(e.member.id!==o||!d||!c){return}d=false;await babelHelpers.classPrivateFieldLooseBase(this,K)[K](u)}});do{await I(5e3);if(!c){return true}if(!d){break}let e=null;try{e=(await babelHelpers.classPrivateFieldLooseBase(this,$)[$].getMember(n)).status}catch(e){console.error(e);babelHelpers.classPrivateFieldLooseBase(this,j)[j]();return false}if(e===i.MemberStatus.ready||e===i.MemberStatus.stoppableReady){d=false}}while(d);if(c){await babelHelpers.classPrivateFieldLooseBase(this,K)[K](u)}return true}}function Y(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E].remember("progressLayout",(()=>r.Tag.render(F||(F=f`
				<div class="sign-b2e-submit-document-info__progress">
					<div class="sign-b2e-submit-document-info__progress_icon"></div>
					<h2 class="sign-b2e-submit-document-info__progress_head">
						${0}
					</h2>
					<p class="sign-b2e-submit-document-info__progress_description">
						${0}
					</p>
					<button
						class="ui-btn ui-btn-round ui-btn-light-border"
						onclick="${0}"
					>
						${0}
					</button>
				</div>
			`),r.Loc.getMessage("SIGN_SUBMIT_DOCUMENT_INFO_PROGRESS_HEAD"),r.Loc.getMessage("SIGN_SUBMIT_DOCUMENT_INFO_PROGRESS_DESCRIPTION"),(()=>babelHelpers.classPrivateFieldLooseBase(this,X)[X]()),r.Loc.getMessage("SIGN_SUBMIT_DOCUMENT_INFO_PROGRESS_CLOSE"))))}function z(){r.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,M)[M](),this.getLayout())}function J(){r.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,M)[M]())}function Q(){this.emit(this.event.onProgressClosePageBtnClick);BX.SidePanel.Instance.close()}async function Z(e){return babelHelpers.classPrivateFieldLooseBase(this,O)[O].remember("openSigningSliderAndCloseCurrent",(async()=>{const s=BX.SidePanel.Instance.getTopSlider();await e.preloadData();if(r.Type.isNull(s)){e.openSlider({events:{}})}else{s.close(false,(()=>e.openSlider({events:{}})))}}))}function ee(){return babelHelpers.classPrivateFieldLooseBase(this,N)[N].fields.map((e=>babelHelpers.classPrivateFieldLooseBase(this,k)[k](e)))}function se(e){return babelHelpers.classPrivateFieldLooseBase(this,E)[E].remember(`fieldLayout.${e.uid}`,(()=>{const s=babelHelpers.classPrivateFieldLooseBase(this,x)[x](e);if(r.Type.isNull(s)){throw new TypeError(`Unknown field type: ${e.type}`)}return s(e)}))}function te(e){var s;const t=`\n\t\t\t<span>\n\t\t\t\t${r.Text.encode(e.name)} \n\t\t\t\t${e.required?'<span class="sign-b2e-submit-document-info__field_required">*</span>':""}\n\t\t\t</span>\n\t\t`;const i={date:()=>{const s=new m({label:t,inputName:e.uid,value:e.value});babelHelpers.classPrivateFieldLooseBase(this,w)[w].push(s);return r.Tag.render(L||(L=f`
					<div class="sign-b2e-submit-document-info__field">
						${0}
					</div>
				`),s.render())},string:()=>{const s=new o.TextInput({label:t,inputName:e.uid,value:e.value});babelHelpers.classPrivateFieldLooseBase(this,w)[w].push(s);return r.Tag.render(B||(B=f`
					<div class="sign-b2e-submit-document-info__field">
						${0}
					</div>
				`),s.render())},list:()=>{const s=new o.Selector({label:t,name:e.uid,inputName:e.uid,items:babelHelpers.classPrivateFieldLooseBase(this,q)[q](e)});babelHelpers.classPrivateFieldLooseBase(this,w)[w].push(s);return r.Tag.render(_||(_=f`
					<div class="sign-b2e-submit-document-info__field">
						${0}
					</div>
				`),s.render())},address:()=>r.Tag.render(S||(S=f`
				<div class="sign-b2e-submit-document-info__field">
					<span class="sign-b2e-submit-document-info__label">
						${0}
					</span>
					<div class="sign-b2e-submit-document-info__subfields">
						${0}
					</div>
				</div>
			`),r.Text.encode(e.name),e.subfields.map((e=>r.Tag.render(H||(H=f`
							<div>${0}</div>
						`),babelHelpers.classPrivateFieldLooseBase(this,k)[k](e)))))};const l=()=>r.Tag.render(T||(T=f`<div></div>`));return(s=i[e.type])!=null?s:l}function ie(){const e=document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,C)[C]);const s=new FormData(e);const t=[];s.forEach(((e,s)=>{t.push({name:s,value:e})}));return t}function le(){let e=0;babelHelpers.classPrivateFieldLooseBase(this,w)[w].forEach((s=>{var t;s.cleanError();const i=babelHelpers.classPrivateFieldLooseBase(this,G)[G](s.getName());if(!i){return}if(i.required&&((t=s.getValue())==null?void 0:t.trim())===""){s.setErrors([]);e+=1}}));return e===0}function ae(e){return babelHelpers.classPrivateFieldLooseBase(this,A)[A](e,babelHelpers.classPrivateFieldLooseBase(this,N)[N].fields)}function re(e,s){for(const t of s){if(t.uid===e){return t}if(t.subfields){const s=babelHelpers.classPrivateFieldLooseBase(this,A)[A](e,t.subfields);if(s){return s}}}return null}function ne(e){const s=[];if(!e.items.some((s=>s.code===e.value))){s.push({value:"",name:"",selected:true,hidden:true,disabled:true})}e.items.forEach((t=>{s.push({value:r.Text.encode(t.code),name:r.Text.encode(t.label),selected:t.code===e.value})}));return s}e.SubmitDocumentInfo=W})(this.BX.Sign.V2.B2e=this.BX.Sign.V2.B2e||{},BX.Cache,BX.Event,BX.Sign.V2,BX,BX.Sign.V2.B2e,BX,BX.UI.DatePicker,BX.UI.FormElements);
//# sourceMappingURL=submit-document-info.bundle.map.js