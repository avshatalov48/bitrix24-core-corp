this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};this.BX.Sign.V2=this.BX.Sign.V2||{};(function(e,s,t,i,l,a,r,n,o,d){"use strict";let c=e=>e,u,b;var v=babelHelpers.classPrivateFieldLooseKey("datepicker");var p=babelHelpers.classPrivateFieldLooseKey("inputNode");var m=babelHelpers.classPrivateFieldLooseKey("renderInputNode");class h extends d.BaseField{constructor(e){super(e);Object.defineProperty(this,m,{value:g});Object.defineProperty(this,v,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:void 0});this.defaultValue=n.Type.isStringFilled(e.value)?e.value:"";babelHelpers.classPrivateFieldLooseBase(this,v)[v]=new o.DatePicker({type:"date",inputField:this.getInputNode(),targetNode:this.getInputNode()})}getValue(){return this.getInputNode().value}getInputNode(){var e,s;(s=(e=babelHelpers.classPrivateFieldLooseBase(this,p))[p])!=null?s:e[p]=babelHelpers.classPrivateFieldLooseBase(this,m)[m]();return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}renderContentField(){const e=!this.isEnable?this.renderLockElement():null;return n.Tag.render(u||(u=c`
			<div id="${0}" class="ui-section__field-selector">
				<div class="ui-section__field-container">
					<div class="ui-section__field-label_box">
						<label for="${0}" class="ui-section__field-label">
							${0}
						</label> 
						${0}
					</div>  
					<div class="ui-ctl ui-ctl-textbox ui-ctl-block ui-ctl-after-icon ${0}">
						<div class="ui-ctl-after ui-ctl-icon-calendar"></div>
						${0}
					</div>
					${0}
				</div>
				<div class="ui-section__hint">
					${0}
				</div>
			</div>
		`),this.getId(),this.getName(),this.getLabel(),e,this.inputDefaultWidth?"":"ui-ctl-w100",this.getInputNode(),this.renderErrors(),this.hintTitle)}}function g(){return n.Tag.render(b||(b=c`
			<input
				value="${0}" 
				name="${0}" 
				type="text" 
				class="ui-ctl-element --readonly" 
				readonly
			>
		`),n.Text.encode(this.defaultValue),n.Text.encode(this.getName()))}var f="/bitrix/js/sign/v2/b2e/submit-document-info/dist/images/ready-to-send-state-image.svg";let P=e=>e,y,F,L,B,_,S,H,T,I;function O(e){return new Promise((s=>{setTimeout(s,e)}))}var E=babelHelpers.classPrivateFieldLooseKey("cache");var N=babelHelpers.classPrivateFieldLooseKey("layoutCache");var $=babelHelpers.classPrivateFieldLooseKey("options");var C=babelHelpers.classPrivateFieldLooseKey("api");var w=babelHelpers.classPrivateFieldLooseKey("fieldFormId");var M=babelHelpers.classPrivateFieldLooseKey("uiFields");var D=babelHelpers.classPrivateFieldLooseKey("getProgressLayout");var j=babelHelpers.classPrivateFieldLooseKey("showProgress");var X=babelHelpers.classPrivateFieldLooseKey("hideProgress");var K=babelHelpers.classPrivateFieldLooseKey("onProgressClosePageBtnClick");var U=babelHelpers.classPrivateFieldLooseKey("openSigningSliderAndCloseCurrent");var k=babelHelpers.classPrivateFieldLooseKey("getFieldsLayout");var x=babelHelpers.classPrivateFieldLooseKey("getOrCreateFieldLayout");var R=babelHelpers.classPrivateFieldLooseKey("getFieldLayoutCallback");var V=babelHelpers.classPrivateFieldLooseKey("getFieldValues");var G=babelHelpers.classPrivateFieldLooseKey("isFieldsValid");var A=babelHelpers.classPrivateFieldLooseKey("getFieldByUid");var q=babelHelpers.classPrivateFieldLooseKey("findFieldByUidRecursive");var W=babelHelpers.classPrivateFieldLooseKey("getSelectorItemsWithEmpty");class Y extends t.EventEmitter{constructor(e){super();Object.defineProperty(this,W,{value:oe});Object.defineProperty(this,q,{value:ne});Object.defineProperty(this,A,{value:re});Object.defineProperty(this,G,{value:ae});Object.defineProperty(this,V,{value:le});Object.defineProperty(this,R,{value:ie});Object.defineProperty(this,x,{value:te});Object.defineProperty(this,k,{value:se});Object.defineProperty(this,U,{value:ee});Object.defineProperty(this,K,{value:Z});Object.defineProperty(this,X,{value:Q});Object.defineProperty(this,j,{value:J});Object.defineProperty(this,D,{value:z});this.events=Object.freeze({onProgressClosePageBtnClick:"onProgressClosePageBtnClick",documentSendedSuccessFully:"documentSendedSuccessFully"});Object.defineProperty(this,E,{writable:true,value:new s.MemoryCache});Object.defineProperty(this,N,{writable:true,value:new s.MemoryCache});Object.defineProperty(this,$,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:new i.Api});Object.defineProperty(this,w,{writable:true,value:"sign-b2e-employee-fields-form"});Object.defineProperty(this,M,{writable:true,value:[]});this.setEventNamespace("BX.Sign.V2.B2e.SubmitDocumentInfo");babelHelpers.classPrivateFieldLooseBase(this,$)[$]=e}getLayout(){return babelHelpers.classPrivateFieldLooseBase(this,N)[N].remember("layout",(()=>{if(babelHelpers.classPrivateFieldLooseBase(this,$)[$].fields.length===0){return n.Tag.render(y||(y=P`
						<div class="sign-submit-document-info-center-container">
							<div class="sign-submit-document-info-center-icon">
								<img src="${0}" alt="">
							</div>
							<p class="sign-submit-document-info-center-title">
								${0}
							</p>
							<p class="sign-submit-document-info-center-description">
								${0}
							</p>
							<form id="${0}"></form>
						</div>
					`),f,n.Loc.getMessage("SIGN_SUBMIT_DOCUMENT_INFO_READY_TO_SEND_TITLE"),n.Loc.getMessage("SIGN_SUBMIT_DOCUMENT_INFO_READY_TO_SEND_DESCRIPTION",{"#TITLE#":n.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,$)[$].template.title)}),babelHelpers.classPrivateFieldLooseBase(this,w)[w])}return n.Tag.render(F||(F=P`
					<div class="sign-b2e-submit-document-info">
						<h1 class="sign-b2e-settings__header">${0}</h1>
						<div class="sign-b2e-settings__item">
							<p class="sign-b2e-settings__item_title">
								${0}
							</p>
							<form id="${0}">
								${0}
							</form>
						</div>
					</div>
				`),n.Loc.getMessage("SIGN_SUBMIT_DOCUMENT_INFO_HEAD"),n.Loc.getMessage("SIGN_SUBMIT_DOCUMENT_INFO_DESCRIPTION"),babelHelpers.classPrivateFieldLooseBase(this,w)[w],babelHelpers.classPrivateFieldLooseBase(this,k)[k]())}))}async sendForSign(){var e;const s=BX.SidePanel.Instance.getTopSlider();if(!babelHelpers.classPrivateFieldLooseBase(this,G)[G]()){return false}let i=null;let a=null;t.EventEmitter.emit("BX.Sign.SignSettingsEmployee:onBeforeTemplateSend");try{const e=await babelHelpers.classPrivateFieldLooseBase(this,C)[C].template.send(babelHelpers.classPrivateFieldLooseBase(this,$)[$].template.uid,babelHelpers.classPrivateFieldLooseBase(this,V)[V]());i=e.employeeMember;a=e.document}catch(e){console.error(e);return false}finally{t.EventEmitter.emit("BX.Sign.SignSettingsEmployee:onAfterTemplateSend")}const{uid:n,id:o}=i;this.emit(this.events.documentSendedSuccessFully,{document:a});babelHelpers.classPrivateFieldLooseBase(this,j)[j]();let d=true;let c=true;const u=new r.SignLink({memberId:o});t.EventEmitter.subscribeOnce(s,"SidePanel.Slider:onCloseStart",(()=>{d=false;c=false}));(e=BX.PULL)==null?void 0:e.subscribe({moduleId:"sign",command:"memberInvitedToSign",callback:async e=>{if(e.member.id!==o||!d||!c){return}d=false;await babelHelpers.classPrivateFieldLooseBase(this,U)[U](u)}});do{await O(5e3);if(!c){return true}if(!d){break}let e=null;try{e=(await babelHelpers.classPrivateFieldLooseBase(this,C)[C].getMember(n)).status}catch(e){console.error(e);babelHelpers.classPrivateFieldLooseBase(this,X)[X]();return false}if(e===l.MemberStatus.ready||e===l.MemberStatus.stoppableReady){d=false}}while(d);if(c){await babelHelpers.classPrivateFieldLooseBase(this,U)[U](u)}return true}}function z(){return babelHelpers.classPrivateFieldLooseBase(this,N)[N].remember("progressLayout",(()=>n.Tag.render(L||(L=P`
				<div class="sign-b2e-submit-document-info__progress">
					<div class="sign-b2e-submit-document-info__progress_icon"></div>
					<h2 class="sign-b2e-submit-document-info__progress_head">
						${0}
					</h2>
					<p class="sign-b2e-submit-document-info__progress_description">
						${0}
					</p>
					<button
						class="ui-btn ui-btn-round ui-btn-light-border"
						onclick="${0}"
					>
						${0}
					</button>
				</div>
			`),n.Loc.getMessage("SIGN_SUBMIT_DOCUMENT_INFO_PROGRESS_HEAD"),n.Loc.getMessage("SIGN_SUBMIT_DOCUMENT_INFO_PROGRESS_DESCRIPTION"),(()=>babelHelpers.classPrivateFieldLooseBase(this,K)[K]()),n.Loc.getMessage("SIGN_SUBMIT_DOCUMENT_INFO_PROGRESS_CLOSE"))))}function J(){n.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,D)[D](),this.getLayout())}function Q(){n.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,D)[D]())}function Z(){this.emit(this.event.onProgressClosePageBtnClick);BX.SidePanel.Instance.close()}async function ee(e){return babelHelpers.classPrivateFieldLooseBase(this,E)[E].remember("openSigningSliderAndCloseCurrent",(async()=>{const s=BX.SidePanel.Instance.getTopSlider();await e.preloadData();if(n.Type.isNull(s)){e.openSlider({events:{}})}else{s.close(false,(()=>e.openSlider({events:{}})))}}))}function se(){return babelHelpers.classPrivateFieldLooseBase(this,$)[$].fields.map((e=>babelHelpers.classPrivateFieldLooseBase(this,x)[x](e)))}function te(e){return babelHelpers.classPrivateFieldLooseBase(this,N)[N].remember(`fieldLayout.${e.uid}`,(()=>{const s=babelHelpers.classPrivateFieldLooseBase(this,R)[R](e);if(n.Type.isNull(s)){throw new TypeError(`Unknown field type: ${e.type}`)}return s(e)}))}function ie(e){var s;const t=`\n\t\t\t<span>\n\t\t\t\t${n.Text.encode(e.name)} \n\t\t\t\t${e.required?'<span class="sign-b2e-submit-document-info__field_required">*</span>':""}\n\t\t\t</span>\n\t\t`;const i={date:()=>{const s=new h({label:t,inputName:e.uid,value:e.value});babelHelpers.classPrivateFieldLooseBase(this,M)[M].push(s);return n.Tag.render(B||(B=P`
					<div class="sign-b2e-submit-document-info__field">
						${0}
					</div>
				`),s.render())},string:()=>{const s=new d.TextInput({label:t,inputName:e.uid,value:e.value});babelHelpers.classPrivateFieldLooseBase(this,M)[M].push(s);return n.Tag.render(_||(_=P`
					<div class="sign-b2e-submit-document-info__field">
						${0}
					</div>
				`),s.render())},list:()=>{const s=new d.Selector({label:t,name:e.uid,inputName:e.uid,items:babelHelpers.classPrivateFieldLooseBase(this,W)[W](e)});babelHelpers.classPrivateFieldLooseBase(this,M)[M].push(s);return n.Tag.render(S||(S=P`
					<div class="sign-b2e-submit-document-info__field">
						${0}
					</div>
				`),s.render())},address:()=>n.Tag.render(H||(H=P`
				<div class="sign-b2e-submit-document-info__field">
					<span class="sign-b2e-submit-document-info__label">
						${0}
					</span>
					<div class="sign-b2e-submit-document-info__subfields">
						${0}
					</div>
				</div>
			`),n.Text.encode(e.name),e.subfields.map((e=>n.Tag.render(T||(T=P`
							<div>${0}</div>
						`),babelHelpers.classPrivateFieldLooseBase(this,x)[x](e)))))};const l=()=>n.Tag.render(I||(I=P`<div></div>`));return(s=i[e.type])!=null?s:l}function le(){const e=document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,w)[w]);const s=new FormData(e);const t=[];s.forEach(((e,s)=>{t.push({name:s,value:e})}));return t}function ae(){let e=0;babelHelpers.classPrivateFieldLooseBase(this,M)[M].forEach((s=>{var t;s.cleanError();const i=babelHelpers.classPrivateFieldLooseBase(this,A)[A](s.getName());if(!i){return}if(i.required&&((t=s.getValue())==null?void 0:t.trim())===""){s.setErrors([]);e+=1}}));return e===0}function re(e){return babelHelpers.classPrivateFieldLooseBase(this,q)[q](e,babelHelpers.classPrivateFieldLooseBase(this,$)[$].fields)}function ne(e,s){for(const t of s){if(t.uid===e){return t}if(t.subfields){const s=babelHelpers.classPrivateFieldLooseBase(this,q)[q](e,t.subfields);if(s){return s}}}return null}function oe(e){const s=[];if(!e.items.some((s=>s.code===e.value))){s.push({value:"",name:"",selected:true,hidden:true,disabled:true})}e.items.forEach((t=>{s.push({value:n.Text.encode(t.code),name:n.Text.encode(t.label),selected:t.code===e.value})}));return s}e.SubmitDocumentInfo=Y})(this.BX.Sign.V2.B2e=this.BX.Sign.V2.B2e||{},BX.Cache,BX.Event,BX.Sign.V2,BX.Sign,BX,BX.Sign.V2.B2e,BX,BX.UI.DatePicker,BX.UI.FormElements);
//# sourceMappingURL=submit-document-info.bundle.map.js