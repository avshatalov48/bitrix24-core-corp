this.BX=this.BX||{},this.BX.Sign=this.BX.Sign||{},this.BX.Sign.V2=this.BX.Sign.V2||{},function(e,t,i,s){"use strict";const a=Object.freeze({Edit:"edit",Create:"create"});let n,o=e=>e;const l=Object.freeze({entityTypeId:39,guid:"sign_b2e_entity_editor",params:{ENABLE_PAGE_TITLE_CONTROLS:!1,ENABLE_MODE_TOGGLE:!1,IS_EMBEDDED:"N",forceDefaultConfig:"Y",enableSingleSectionCombining:"N"}}),r=["onCrmEntityUpdate","BX.Crm.EntityEditor:onFailedValidation","onCrmEntityUpdateError","BX.Crm.EntityEditor:onEntitySaveFailure"];var d=babelHelpers.classPrivateFieldLooseKey("mode"),c=babelHelpers.classPrivateFieldLooseKey("documentEntityId"),b=babelHelpers.classPrivateFieldLooseKey("companyId"),v=babelHelpers.classPrivateFieldLooseKey("options"),u=babelHelpers.classPrivateFieldLooseKey("save"),E=babelHelpers.classPrivateFieldLooseKey("loadedHandler");async function y(){const e=new Promise(e=>{const[t,...s]=r;i.EventEmitter.subscribeOnce(t,t=>{const[{entityData:i}]=t.data;e(i)}),s.forEach(t=>{i.EventEmitter.subscribeOnce(t,()=>e(null))})});BX.Crm.EntityEditor.defaultInstance.save();const s=await e;if(r.forEach(e=>i.EventEmitter.unsubscribeAll(e)),s){var a,n;const{MYCOMPANY_ID_INFO:{COMPANY_DATA:[e]}}=s;t.Type.isFunction(null==(a=babelHelpers.classPrivateFieldLooseBase(this,v)[v])||null==(n=a.events)?void 0:n.onCompanySavedHandler)&&babelHelpers.classPrivateFieldLooseBase(this,v)[v].events.onCompanySavedHandler(e.id),BX.SidePanel.Instance.close()}}function p(){const e=BX.Crm.EntityEditor.defaultInstance,s=e.getControlById("MYCOMPANY_ID"),[n]=s._companySearchBoxes;if(babelHelpers.classPrivateFieldLooseBase(this,d)[d]===a.Create)return e.switchControlMode(s,BX.UI.EntityEditorMode.edit),n.setEntity(BX.CrmEntityInfo.create({typeName:"COMPANY",title:""}),!0),n._searchInput.value="",void t.Dom.remove(n._changeButton);if(babelHelpers.classPrivateFieldLooseBase(this,d)[d]===a.Edit){const e="BX.Crm.EntityEditor:onUserFieldsDeployed";n._searchInput.value="",n.setEntityTypeName("COMPANY"),n.setMode(BX.Crm.EntityEditorClientMode.loading),n.adjust(),i.EventEmitter.unsubscribeAll(e),i.EventEmitter.subscribe(e,()=>{t.Dom.remove(n._changeButton)}),n.loadEntityInfo(""+babelHelpers.classPrivateFieldLooseBase(this,b)[b])}}e.CompanyEditor=class{constructor(e){Object.defineProperty(this,E,{value:p}),Object.defineProperty(this,u,{value:y}),Object.defineProperty(this,d,{writable:!0,value:a.Create}),Object.defineProperty(this,c,{writable:!0,value:void 0}),Object.defineProperty(this,b,{writable:!0,value:null}),Object.defineProperty(this,v,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e,(null==e?void 0:e.mode)===a.Edit&&(null==e?void 0:e.companyId)>0&&(babelHelpers.classPrivateFieldLooseBase(this,d)[d]=a.Edit,babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e.companyId),babelHelpers.classPrivateFieldLooseBase(this,c)[c]=e.documentEntityId}static openSlider(e,t){var i;BX.SidePanel.Instance.open("company-editor",{width:800,cacheable:!1,contentCallback:()=>top.BX.Runtime.loadExtension("sign.v2.b2e.company-editor").then(()=>new top.BX.Sign.V2.B2e.CompanyEditor(e).getLayout()),events:{onClose:null!=(i=null==t?void 0:t.onCloseHandler)?i:()=>{}}})}render(){const e=t.Tag.render(n||(n=o`<div style="position: relative; z-index: 1;"></div>`));return t.ajax.runAction("crm.api.item.getEditor",{data:{...l,id:babelHelpers.classPrivateFieldLooseBase(this,c)[c]}}).then(async i=>{var s;const a=(null==i||null==(s=i.data)?void 0:s.html)||"";await t.Runtime.html(e,a),babelHelpers.classPrivateFieldLooseBase(this,E)[E]()}),e}getLayout(){var e,t;const i=this;return s.Layout.createContent({title:null!=(e=null==(t=babelHelpers.classPrivateFieldLooseBase(i,v)[v])?void 0:t.layoutTitle)?e:"",content:()=>i.render(),buttons({cancelButton:e,SaveButton:t}){const s=new t({onclick:async()=>{s.setClocking(!0),await babelHelpers.classPrivateFieldLooseBase(i,u)[u](),s.setClocking(!1)}});return[s,e]}})}},e.CompanyEditorMode=a}(this.BX.Sign.V2.B2e=this.BX.Sign.V2.B2e||{},BX,BX.Event,BX.UI.SidePanel);
//# sourceMappingURL=company-editor.bundle.js.map
