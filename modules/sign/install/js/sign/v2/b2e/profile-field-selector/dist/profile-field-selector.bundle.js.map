{"version":3,"file":"profile-field-selector.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Dom, Loc, Tag, Type, Event } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Layout } from 'ui.sidepanel.layout';\n\nimport \"./style.css\";\n\ntype Field = {\n\tname: string,\n\tcaption: string\n};\n\ntype ProfileFieldSelectorOptions = {\n\tpreselectedFieldName?: string\n}\n\nexport class ProfileFieldSelector extends EventEmitter\n{\n\t#ui = {\n\t\tcontainer: HTMLDivElement = null,\n\t\tfieldList: HTMLDivElement = null,\n\t};\n\n\t#fields: Array<Field> = [];\n\t#inputByFieldCodeMap: Map<string, HTMLInputElement> = new Map();\n\n\t#chosenField: ?Field = null;\n\n\t#preselectedFieldName: ?string = null;\n\n\tconstructor(options: ProfileFieldSelectorOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.B2e.ProfileFieldSelector');\n\t\tif (Type.isStringFilled(options?.preselectedFieldName))\n\t\t{\n\t\t\tthis.#preselectedFieldName = options.preselectedFieldName;\n\t\t}\n\t}\n\n\t#loadAvailableFields(): Promise<any>\n\t{\n\t\tif (this.#fields.length > 0)\n\t\t{\n\t\t\treturn Promise.resolve(this.#render());\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tBX.ajax.runAction('sign.api_v1.b2e.fields.getAvailableProfileFields', {\n\t\t\t\tjson: {},\n\t\t\t}).then(response => {\n\t\t\t\tif (Type.isObject(response.data.fields))\n\t\t\t\t{\n\t\t\t\t\tthis.#fields = response.data.fields;\n\t\t\t\t\tthis.#fillList();\n\t\t\t\t}\n\t\t\t\tresolve(this.#render());\n\t\t\t}, response => {\n\t\t\t\tresolve(this.#render());\n\t\t\t});\n\t\t});\n\t}\n\n\t#render(): HTMLDivElement\n\t{\n\t\tif (this.#ui.container)\n\t\t{\n\t\t\treturn this.#ui.container;\n\t\t}\n\n\t\tthis.#ui.fieldList = Tag.render`\n\t\t\t<div class=\"sign-b2e-profile-fields-selector-fields-list\"></div>\n\t\t`;\n\t\tthis.#ui.container = Tag.render`\n\t\t\t<div class=\"sign-b2e-profile-fields-selector\">\n\t\t\t\t${this.#ui.fieldList}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#fillList();\n\n\t\tconst preselectedField = this.#fields.find((field) => field.name === this.#preselectedFieldName);\n\t\tif (Type.isObject(preselectedField))\n\t\t{\n\t\t\tthis.#chooseField(preselectedField);\n\t\t}\n\n\t\treturn this.#ui.container;\n\t}\n\n\tgetFieldCaptionByName(fieldName: string): string\n\t{\n\t\tconst field = this.#fields.find((field) => field.name === fieldName);\n\t\tif (!Type.isObject(field))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn Type.isStringFilled(field?.caption)\n\t\t\t? field.caption\n\t\t\t: ''\n\t\t;\n\t}\n\n\t#fillList(): void\n\t{\n\t\tthis.#fields.forEach((field) => {\n\t\t\tconst radioInput = Tag.render`\n\t\t\t\t<input type=\"radio\" class=\"ui-ctl-element\">\n\t\t\t`;\n\n\t\t\tEvent.bind(radioInput, 'click', () => {\n\t\t\t\tthis.#chooseField(field);\n\t\t\t})\n\n\t\t\tconst element = Tag.render`\n\t\t\t\t<div class=\"sign-b2e-profile-field-selector\">\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox sign-b2e-profile-field-selector-checkbox\">\n\t\t\t\t\t\t${radioInput}\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${field.caption}</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tthis.#inputByFieldCodeMap.set(field.name, radioInput);\n\n\t\t\tDom.append(element, this.#ui.fieldList);\n\t\t});\n\t}\n\n\t#chooseField(field: Field): void\n\t{\n\t\t// Uncheck previous field\n\t\tif (!Type.isNull(this.#chosenField))\n\t\t{\n\t\t\tif (this.#inputByFieldCodeMap.has(this.#chosenField.name))\n\t\t\t{\n\t\t\t\tconst input = this.#inputByFieldCodeMap.get(this.#chosenField.name);\n\t\t\t\tinput.checked = false;\n\t\t\t}\n\t\t}\n\n\t\tthis.#chosenField = field;\n\n\t\tif (this.#inputByFieldCodeMap.has(this.#chosenField.name))\n\t\t{\n\t\t\tconst input = this.#inputByFieldCodeMap.get(this.#chosenField.name);\n\t\t\tinput.checked = true;\n\t\t}\n\t}\n\n\topen(): void\n\t{\n\t\tconst instance = this;\n\t\tBX.SidePanel.Instance.open(\"sign.b2e:profile-field-selector\", {\n\t\t\twidth: 700,\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\tonCloseComplete: () => {\n\t\t\t\t\tinstance.emit('onSliderCloseComplete', { field: instance.#chosenField })\n\t\t\t\t},\n\t\t\t},\n\t\t\tcontentCallback: () => {\n\t\t\t\treturn Layout.createContent({\n\t\t\t\t\textensions: ['ui.forms'],\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_V2_B2E_PROFILE_FIELD_SELECTOR_TITLE'),\n\t\t\t\t\tdesign: {\n\t\t\t\t\t\tsection: true,\n\t\t\t\t\t},\n\t\t\t\t\tcontent()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn instance.#loadAvailableFields();\n\t\t\t\t\t},\n\t\t\t\t\tbuttons ({SaveButton, closeButton})\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tnew SaveButton({\n\t\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_V2_B2E_PROFILE_FIELD_SELECTOR_CHOOSE_BUTTON'),\n\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\tBX.SidePanel.Instance.close();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tcloseButton\n\t\t\t\t\t\t];\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\t}\n}"],"names":["ProfileFieldSelector","EventEmitter","constructor","options","container","HTMLDivElement","fieldList","Map","setEventNamespace","Type","isStringFilled","preselectedFieldName","getFieldCaptionByName","fieldName","field","find","name","isObject","caption","open","instance","BX","SidePanel","Instance","width","cacheable","events","onCloseComplete","emit","contentCallback","Layout","createContent","extensions","title","Loc","getMessage","design","section","content","buttons","SaveButton","closeButton","text","onclick","close","length","Promise","resolve","ajax","runAction","json","then","response","data","fields","Tag","render","preselectedField","forEach","radioInput","Event","bind","element","set","Dom","append","isNull","has","input","get","checked"],"mappings":"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"}