{"version":3,"file":"hcm-link-employee-selector.bundle.js","sources":["../src/vacancy-choose.js","../src/widget.js"],"sourcesContent":["import { Api } from 'sign.v2.api';\nimport { Dom, Loc, Tag, Text } from 'main.core';\nimport { Select } from 'ui.select';\nimport { Layout } from 'ui.sidepanel.layout';\nimport type { HcmLinkMultipleVacancyEmployee } from 'sign.v2.api';\n\nimport \"./vacancy-choose.css\";\n\ntype VacancyChooserOptions = {\n\tapi: Api,\n\tdocumentGroupUids: Array<string>,\n\tcompanyTitle: string,\n\temployees: Map<number, HcmLinkMultipleVacancyEmployee>\n};\n\nexport class HcmLinkVacancyChooser\n{\n\t#api: Api;\n\t#documentGroupUids: Array<string> = [];\n\t#employees: Map<number, HcmLinkMultipleVacancyEmployee>;\n\t#companyTitle: string;\n\n\t#content: HTMLElement | null = null;\n\t#overlay: HTMLElement | null = null;\n\n\t#selectByUserId: Map<number, Select> = new Map();\n\n\tconstructor(options: VacancyChooserOptions)\n\t{\n\t\tthis.#api = options.api;\n\t\tthis.#documentGroupUids = options.documentGroupUids;\n\t\tthis.#employees = options.employees;\n\t\tthis.#companyTitle = options.companyTitle;\n\t}\n\n\tstatic openSlider(\n\t\toptions: VacancyChooserOptions,\n\t\tsliderOptions: { onCloseHandler: () => void },\n\t): void\n\t{\n\t\tBX.SidePanel.Instance.open('sign:hcmlink-vacancy-chooser', {\n\t\t\twidth: 800,\n\t\t\tloader: 'default-loader',\n\t\t\tcacheable: false,\n\t\t\tcontentCallback: () => {\n\t\t\t\treturn top.BX.Runtime.loadExtension('sign.v2.b2e.hcm-link-employee-selector').then((exports) => {\n\t\t\t\t\treturn (new exports.HcmLinkVacancyChooser(options)).getLayout();\n\t\t\t\t});\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonClose: sliderOptions?.onCloseHandler ?? (() => {}),\n\t\t\t},\n\t\t});\n\t}\n\n\tgetLayout(): Layout\n\t{\n\t\tconst context = this;\n\t\treturn Layout.createContent({\n\t\t\textensions: ['ui.forms', 'sign.v2.b2e.hcm-link-employee-selector'],\n\t\t\ttitle: this.#companyTitle,\n\t\t\ttoolbar(): []\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t},\n\t\t\tcontent(): string\n\t\t\t{\n\t\t\t\treturn context.#getContent();\n\t\t\t},\n\t\t\tbuttons({cancelButton, SaveButton})\n\t\t\t{\n\t\t\t\tconst saveButton = new SaveButton({\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tsaveButton.setWaiting(true);\n\t\t\t\t\t\tDom.show(context.#overlay);\n\n\t\t\t\t\t\tcontext.saveEmployees()\n\t\t\t\t\t\t\t.then((): void => {\n\t\t\t\t\t\t\t\tBX.SidePanel.Instance.close();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(() => {})\n\t\t\t\t\t\t\t.finally((): void => {\n\t\t\t\t\t\t\t\tsaveButton.setWaiting(false);\n\t\t\t\t\t\t\t\tDom.hide(context.#overlay);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\treturn [\n\t\t\t\t\tsaveButton,\n\t\t\t\t\tcancelButton,\n\t\t\t\t];\n\t\t\t},\n\t\t});\n\t}\n\n\tasync saveEmployees(): Promise<void>\n\t{\n\t\tif (this.#employees.size === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst employeeCollection = Array\n\t\t\t.from(this.#selectByUserId)\n\t\t\t.map(([key, value]) => ({ userId: key, employeeId: value.getValue() }))\n\t\t;\n\n\t\tfor (const documentUid of this.#documentGroupUids)\n\t\t{\n\t\t\tawait this.#api.saveEmployeesForSignProcess({\n\t\t\t\tdocumentUid: documentUid,\n\t\t\t\tselectedEmployeeCollection: employeeCollection,\n\t\t\t});\n\t\t}\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\tif (!this.#content)\n\t\t{\n\t\t\tconst { root, selectContainer, overlay } = Tag.render`\n\t\t\t\t<div class=\"sign-b2e-hcm-link-vacancy-choose\">\n\t\t\t\t\t<div class=\"sign-b2e-hcm-link-vacancy-choose-overlay\" ref=\"overlay\"></div>\n\t\t\t\t\t<div class=\"sign-b2e-hcm-link-vacancy-choose-title\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_V2_B2E_HCM_LINK_EMPLOYEE_SELECTOR_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"sign-b2e-hcm-link-vacancy-choose-select-container\" ref=\"selectContainer\"></div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tthis.#overlay = overlay;\n\t\t\tDom.hide(overlay);\n\n\t\t\tconst employees = Array\n\t\t\t\t.from(this.#employees.values())\n\t\t\t\t.sort((a: HcmLinkMultipleVacancyEmployee, b: HcmLinkMultipleVacancyEmployee) => a.order - b.order)\n\t\t\t;\n\n\t\t\temployees.forEach((item: HcmLinkMultipleVacancyEmployee): void => {\n\t\t\t\tconst firstPositionValue = item.positions[0].employeeId;\n\t\t\t\tconst select = new Select({\n\t\t\t\t\toptions: item.positions.map((positionItem) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tlabel: positionItem.position,\n\t\t\t\t\t\t\tvalue: positionItem.employeeId\n\t\t\t\t\t\t};\n\t\t\t\t\t}),\n\t\t\t\t\tvalue: firstPositionValue,\n\t\t\t\t});\n\n\t\t\t\tthis.#selectByUserId.set(item.userId, select);\n\n\t\t\t\tconst { rowElement, vacancySelector }  = Tag.render`\n\t\t\t\t\t<div class=\"sign-b2e-hcm-link-vacancy-choose-select-row\" ref=\"rowElement\">\n\t\t\t\t\t\t<div class=\"sign-b2e-hcm-link-vacancy-choose-select-row__avavar\">\n\t\t\t\t\t\t\t<img src=\"${item.avatarLink}\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"sign-b2e-hcm-link-vacancy-choose-select-row__name\">\n\t\t\t\t\t\t\t${Text.encode(item.fullName)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"sign-b2e-hcm-link-vacancy-choose-select-row__select\" ref=\"vacancySelector\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\n\t\t\t\tselect.renderTo(vacancySelector);\n\t\t\t\tDom.append(rowElement, selectContainer);\n\t\t\t});\n\n\t\t\tthis.#content = root;\n\t\t}\n\n\t\treturn this.#content;\n\t}\n}","import { Api } from 'sign.v2.api';\nimport { Dom, Tag, Loc, Event, Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport './style.css';\n\nimport './vacancy-choose.css';\nimport type { HcmLinkMultipleVacancyEmployee } from 'sign.v2.api';\nimport { HcmLinkVacancyChooser } from './vacancy-choose';\n\nconst maxPreviewUserAvatarCount = 6;\n\nexport class HcmLinkEmployeeSelector extends EventEmitter\n{\n\t#api: Api;\n\n\t#documentGroupUids: Array<string> = [];\n\t#enabled: boolean = false;\n\n\t#employees: Map<number, HcmLinkMultipleVacancyEmployee> = new Map();\n\t#companyTitle: string | null = null;\n\n\t#container: HTMLDivElement;\n\t#usersPreviewContainer: HTMLElement | null = null;\n\n\tconstructor(options: { api: Api })\n\t{\n\t\tsuper();\n\t\tthis.#api = options.api;\n\n\t\tthis.setEventNamespace('BX.Sign.V2.B2e.HcmLinkEmployeeSelector');\n\t}\n\n\tasync check(): Promise<boolean>\n\t{\n\t\tif (!this.#enabled)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.#employees = await this.#loadEmployees();\n\t\tif (this.#employees.size > 0)\n\t\t{\n\t\t\tthis.#updateUsersPreview();\n\t\t}\n\n\t\treturn this.#employees.size === 0;\n\t}\n\n\tsetDocumentGroupUids(uids: Array<string>): void\n\t{\n\t\tthis.#documentGroupUids = uids;\n\t}\n\n\tsetEnabled(value: boolean): void\n\t{\n\t\tthis.#enabled = value;\n\t}\n\n\trender(): HTMLDivElement\n\t{\n\t\tif (this.#container)\n\t\t{\n\t\t\treturn this.#container;\n\t\t}\n\n\t\tconst { root, chooseButton } = Tag.render`\n\t\t\t<div class=\"sign-b2e-hcm-link-party-checker-container\">\n\t\t\t\t<div class=\"sign-b2e-hcm-link-party-checker-wrapper\">\n\t\t\t\t\t<div class=\"sign-b2e-hcm-link-party-checker-wrapper-part --left\">\n\t\t\t\t\t\t<div class=\"sign-b2e-hcm-link-party-checker-title\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_V2_B2E_HCM_LINK_EMPLOYEE_SELECTOR_WIDGET_TITLE')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"sign-b2e-hcm-link-party-checker-description\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_V2_B2E_HCM_LINK_EMPLOYEE_SELECTOR_WIDGET_DESCRIPTION')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"sign-b2e-hcm-link-party-checker-wrapper-part --right\">\n\t\t\t\t\t\t${this.#getUsersPreviewContainer()}\n\t\t\t\t\t\t<div class=\"sign-b2e-hcm-link-party-checker__action-button\" ref=\"chooseButton\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_V2_B2E_HCM_LINK_EMPLOYEE_SELECTOR_WIDGET_OPEN_BUTTON')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(chooseButton, 'click', (): void => this.#openVacancyChooser());\n\n\t\tthis.#container = root;\n\n\t\tthis.hide();\n\n\t\treturn this.#container;\n\t}\n\n\thide(): void\n\t{\n\t\tDom.hide(this.#container);\n\t}\n\n\tshow(): void\n\t{\n\t\tDom.show(this.#container);\n\t}\n\n\tasync #loadEmployees(): Promise<Map>\n\t{\n\t\tthis.#employees.clear();\n\n\t\tconst { employees, company } = await this.#api.getMultipleVacancyMemberHrIntegration(\n\t\t\tthis.#getLastDocumentUid()\n\t\t);\n\t\tthis.#companyTitle = company.title;\n\n\t\temployees.forEach((employee) => this.#employees.set(employee.userId, employee));\n\n\t\treturn new Map([...this.#employees.entries()]);\n\t}\n\n\t#getLastDocumentUid(): string | undefined\n\t{\n\t\treturn this.#documentGroupUids.at(-1);\n\t}\n\n\t#openVacancyChooser(): void\n\t{\n\t\tHcmLinkVacancyChooser.openSlider({\n\t\t\tapi: this.#api,\n\t\t\tdocumentGroupUids: this.#documentGroupUids,\n\t\t\temployees: this.#employees,\n\t\t\tcompanyTitle: this.#companyTitle,\n\t\t}, {\n\t\t\tonCloseHandler: () => this.emit('update')\n\t\t});\n\t}\n\n\t#updateUsersPreview(): void\n\t{\n\t\tDom.clean(this.#getUsersPreviewContainer());\n\n\t\tconst usersCount = this.#employees.size;\n\n\t\tconst userIds = Array.from(this.#employees.keys()).slice(0, maxPreviewUserAvatarCount);\n\t\tconst userAvatarContainer = Tag.render`\n\t\t\t<div class=\"sign-b2e-hcm-link-party-checker-users-avatar-container\"></div>\n\t\t`;\n\n\t\tuserIds.forEach((userId: number): void => {\n\t\t\tconst employee = this.#employees.get(userId);\n\n\t\t\tconst previewElement = Tag.render`\n\t\t\t\t<div class=\"sign-b2e-hcm-link-party-checker-user-preview\" \n\t\t\t\t\ttitle=\"${Text.encode(employee.fullName)}\"\n\t\t\t\t>\n\t\t\t\t\t<img src=\"${employee.avatarLink}\">\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tDom.append(previewElement, userAvatarContainer);\n\t\t});\n\n\t\tDom.append(userAvatarContainer, this.#getUsersPreviewContainer());\n\n\t\tconst additionalUserCount = usersCount - maxPreviewUserAvatarCount;\n\t\tif (additionalUserCount > 0)\n\t\t{\n\t\t\tconst counterElement = Tag.render`\n\t\t\t\t<div class=\"sign-b2e-hcm-link-party-checker-users-preview-counter\">\n\t\t\t\t\t${Loc.getMessage('SIGN_V2_B2E_HCM_LINK_EMPLOYEE_USERS_COUNT_PLUS', { '#COUNT#' : additionalUserCount })}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tDom.append(counterElement, this.#getUsersPreviewContainer());\n\t\t}\n\t}\n\n\t#getUsersPreviewContainer(): HTMLElement\n\t{\n\t\tif (!this.#usersPreviewContainer)\n\t\t{\n\t\t\tthis.#usersPreviewContainer = Tag.render`\n\t\t\t\t<div class=\"sign-b2e-hcm-link-party-checker-users-preview-container\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#usersPreviewContainer;\n\t}\n}\n"],"names":["HcmLinkVacancyChooser","constructor","options","Object","value","writable","Map","babelHelpers","api","documentGroupUids","employees","companyTitle","[object Object]","sliderOptions","BX","SidePanel","Instance","open","width","loader","cacheable","contentCallback","top","Runtime","loadExtension","then","exports","getLayout","events","onClose","onCloseHandler","context","this","Layout","createContent","extensions","title","toolbar","content","buttons","cancelButton","SaveButton","saveButton","onclick","setWaiting","Dom","show","saveEmployees","close","catch","finally","hide","size","employeeCollection","Array","from","map","key","userId","employeeId","getValue","documentUid","saveEmployeesForSignProcess","selectedEmployeeCollection","root","selectContainer","overlay","Tag","render","Loc","getMessage","values","sort","a","b","order","forEach","item","firstPositionValue","positions","select","Select","positionItem","label","position","set","rowElement","vacancySelector","avatarLink","Text","encode","fullName","renderTo","append","HcmLinkEmployeeSelector","EventEmitter","super","setEventNamespace","setDocumentGroupUids","uids","setEnabled","chooseButton","Event","bind","async","clear","company","getMultipleVacancyMemberHrIntegration","employee","entries","at","openSlider","emit","clean","usersCount","userIds","keys","slice","userAvatarContainer","get","previewElement","additionalUserCount","counterElement","#COUNT#"],"mappings":"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"}