{"version":3,"file":"index.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Dom, Event, Loc, Type, Uri } from 'main.core';\nimport { Analytics } from 'sign.v2.analytics';\nimport { Api } from 'sign.v2.api';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { Switcher, SwitcherSize } from 'ui.switcher';\n\nexport class Templates\n{\n\t#analytics = new Analytics();\n\t#api = new Api();\n\n\t#changeVisibility(templateId: number, visibility: string): Promise<Object>\n\t{\n\t\tconst api = this.#api;\n\n\t\treturn api.changeTemplateVisibility(templateId, visibility);\n\t}\n\n\tasync deleteTemplate(templateId: number): Promise<void>\n\t{\n\t\tconst messageContent = document.createElement('div');\n\t\tmessageContent.innerHTML = Loc.getMessage('SIGN_TEMPLATE_DELETE_CONFIRMATION_MESSAGE');\n\t\tDom.style(messageContent, 'margin-top', '5%');\n\t\tDom.style(messageContent, 'color', '#535c69');\n\n\t\tMessageBox.show({\n\t\t\ttitle: Loc.getMessage('SIGN_TEMPLATE_DELETE_CONFIRMATION_TITLE'),\n\t\t\tmessage: messageContent.outerHTML,\n\t\t\tmodal: true,\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\ttext: Loc.getMessage('SIGN_TEMPLATE_GRID_DELETE_POPUP_YES'),\n\t\t\t\t\tcolor: BX.UI.Button.Color.PRIMARY,\n\t\t\t\t\tonclick: async (button) => {\n\t\t\t\t\t\ttry\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst api = this.#api;\n\t\t\t\t\t\t\tawait api.deleteTemplate(templateId);\n\n\t\t\t\t\t\t\twindow.top.BX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('SIGN_TEMPLATE_GRID_DELETE_HINT_SUCCESS'),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twindow.top.BX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('SIGN_TEMPLATE_GRID_DELETE_HINT_FAIL'),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tawait this.reload();\n\t\t\t\t\t\tbutton.getContext().close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\ttext: Loc.getMessage('SIGN_TEMPLATE_GRID_DELETE_POPUP_NO'),\n\t\t\t\t\tcolor: BX.UI.Button.Color.LINK,\n\t\t\t\t\tonclick: (button) => {\n\t\t\t\t\t\tbutton.getContext().close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\t}\n\n\tasync renderSwitcher(\n\t\ttemplateId: number,\n\t\tisChecked: boolean,\n\t\tisDisabled: boolean,\n\t\thasEditTemplateAccess?: boolean,\n\t): Promise<void>\n\t{\n\t\tconst switcherNode = document.getElementById(`switcher_b2e_template_grid_${templateId}`);\n\t\tconst switcher = new Switcher({\n\t\t\tnode: switcherNode,\n\t\t\tchecked: isChecked,\n\t\t\tsize: SwitcherSize.medium,\n\t\t\tdisabled: isDisabled,\n\t\t\thandlers: {\n\t\t\t\ttoggled: async () => {\n\t\t\t\t\tswitcher.setLoading(true);\n\t\t\t\t\tconst checked = switcher.isChecked();\n\t\t\t\t\tconst visibility = checked ? 'visible' : 'invisible';\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tawait this.#changeVisibility(templateId, visibility);\n\t\t\t\t\t}\n\t\t\t\t\tcatch\n\t\t\t\t\t{\n\t\t\t\t\t\tswitcher.setLoading(false);\n\t\t\t\t\t\tswitcher.check(!checked, false);\n\t\t\t\t\t}\n\t\t\t\t\tfinally\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#sendActionStateAnalytics(checked, templateId);\n\t\t\t\t\t\tswitcher.setLoading(false);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tif (!isDisabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst title = hasEditTemplateAccess\n\t\t\t? Loc.getMessage('SIGN_TEMPLATE_BLOCKED_SWITCHER_HINT')\n\t\t\t: Loc.getMessage('SIGN_TEMPLATE_BLOCKED_SWITCHER_HINT_NO_ACCESS');\n\n\t\tswitcherNode.setAttribute('title', title);\n\t}\n\n\t#sendActionStateAnalytics(checked: boolean, templateId: number): void\n\t{\n\t\tthis.#analytics.send({\n\t\t\tcategory: 'templates',\n\t\t\tevent: 'turn_on_off_template',\n\t\t\ttype: 'manual',\n\t\t\tc_section: 'sign',\n\t\t\tc_sub_section: 'templates',\n\t\t\tc_element: checked ? 'on' : 'off',\n\t\t\tp5: `templateid_${templateId}`,\n\t\t});\n\t}\n\n\treload(): Promise<void>\n\t{\n\t\tEvent.ready(() => {\n\t\t\tconst grid = BX.Main.gridManager.getById('SIGN_B2E_EMPLOYEE_TEMPLATE_LIST_GRID')?.instance;\n\t\t\tif (Type.isObject(grid))\n\t\t\t{\n\t\t\t\tgrid.reload();\n\t\t\t}\n\t\t});\n\t}\n\n\treloadAfterSliderClose(addNewTemplateLink: string): void\n\t{\n\t\tBX.Event.EventEmitter.subscribe('SidePanel.Slider:onCloseComplete', async (event) => {\n\t\t\tconst baseUrl = '/sign/b2e/doc/0/';\n\t\t\tconst closedSliderUrl = event.getData()[0].getSlider().getUrl();\n\t\t\tconst uri = new Uri(closedSliderUrl);\n\t\t\tconst path = uri.getPath();\n\n\t\t\tif (\n\t\t\t\tclosedSliderUrl === addNewTemplateLink\n\t\t\t\t|| path.startsWith(baseUrl)\n\t\t\t\t|| closedSliderUrl === 'sign-settings-template-created'\n\t\t\t)\n\t\t\t{\n\t\t\t\tawait this.reload();\n\t\t\t}\n\t\t});\n\t}\n\n\tasync exportBlank(templateId: number): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst { json, filename } = await this.#api.template.exportBlank(templateId);\n\t\t\tconst mimeType = 'application/json';\n\t\t\tthis.#downloadStringLikeFile(json, filename, mimeType);\n\n\t\t\twindow.top.BX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('SIGN_TEMPLATE_GRID_EXPORT_BLANK_SUCCESS'),\n\t\t\t});\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error(e);\n\t\t\twindow.top.BX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('SIGN_TEMPLATE_GRID_EXPORT_BLANK_FAILURE'),\n\t\t\t});\n\t\t}\n\t}\n\n\t#downloadStringLikeFile(data: string, filename: string, mimeType: string): void\n\t{\n\t\tconst blob = new Blob([data], { type: mimeType });\n\t\tconst url = window.URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\tDom.style(a, 'display', 'none');\n\t\ta.href = url;\n\t\ta.download = filename;\n\t\tDom.append(a, document.body);\n\t\ta.click();\n\t\twindow.URL.revokeObjectURL(url);\n\t\tDom.remove(a);\n\t}\n\n\tasync copyTemplate(templateId: number): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tawait this.#api.copyTemplate(templateId);\n\t\t\tawait this.reload();\n\t\t\twindow.top.BX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('SIGN_TEMPLATE_GRID_COPY_HINT_SUCCESS'),\n\t\t\t});\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('Error copying template:', error);\n\t\t\twindow.top.BX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('SIGN_TEMPLATE_GRID_COPY_HINT_FAIL'),\n\t\t\t});\n\t\t}\n\t}\n}\n"],"names":["Templates","Analytics","Api","deleteTemplate","templateId","messageContent","document","createElement","innerHTML","Loc","getMessage","Dom","style","MessageBox","show","title","message","outerHTML","modal","buttons","BX","UI","Button","text","color","Color","PRIMARY","onclick","button","api","window","top","Notification","Center","notify","content","reload","getContext","close","LINK","renderSwitcher","isChecked","isDisabled","hasEditTemplateAccess","switcherNode","getElementById","switcher","Switcher","node","checked","size","SwitcherSize","medium","disabled","handlers","toggled","setLoading","visibility","check","setAttribute","Event","ready","grid","Main","gridManager","getById","instance","Type","isObject","reloadAfterSliderClose","addNewTemplateLink","EventEmitter","subscribe","event","baseUrl","closedSliderUrl","getData","getSlider","getUrl","uri","Uri","path","getPath","startsWith","exportBlank","json","filename","template","mimeType","e","console","error","copyTemplate","changeTemplateVisibility","send","category","type","c_section","c_sub_section","c_element","p5","data","blob","Blob","url","URL","createObjectURL","a","href","download","append","body","click","revokeObjectURL","remove"],"mappings":"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"}