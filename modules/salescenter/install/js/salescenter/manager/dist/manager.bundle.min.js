this.BX=this.BX||{};(function(e,n,t){"use strict";var i=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"init",value:function n(i){i.connectedSiteId=parseInt(i.connectedSiteId);if(i.connectedSiteId>0){e.connectedSiteId=i.connectedSiteId}i.sessionId=parseInt(i.sessionId);if(i.sessionId>0){e.sessionId=i.sessionId}if(t.Type.isString(i.siteTemplateCode)){e.siteTemplateCode=i.siteTemplateCode}if(t.Type.isString(i.connectPath)){e.connectPath=i.connectPath}if(t.Type.isBoolean(i.isSitePublished)){e.isSitePublished=i.isSitePublished}if(t.Type.isBoolean(i.isSiteExists)){e.isSiteExists=i.isSiteExists}if(t.Type.isBoolean(i.isOrderPublicUrlAvailable)){e.isOrderPublicUrlAvailable=i.isOrderPublicUrlAvailable}else{e.isOrderPublicUrlAvailable=false}if(!e.isPullInited){t.Event.ready(e.initPull)}if(!top.BX.Landing){top.BX.Landing={PageObject:{},Main:{}}}}},{key:"loadConfig",value:function t(){return new Promise(function(t,i){n.rest.callMethod("salescenter.manager.getConfig").then(function(n){e.init(n.answer.result);t(n.answer.result)}).catch(function(e){i(e)})})}},{key:"startConnection",value:function n(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new Promise(function(n,o){if(!e.connectPath){o("no connect path")}var a=new t.Uri(e.connectPath);if(!t.Type.isPlainObject(i)){i={}}i.analyticsLabel="salescenterStartConnection";a.setQueryParams(i);e.openSlider(a.toString(),{width:760}).then(function(){n()}).catch(function(e){o(e)})})}},{key:"connect",value:function n(i){return new Promise(function(n){if(e.connectedSiteId>0&&e.isSiteExists){n()}else{var o=new t.Uri("/shop/stores/site/edit/0/");if(!t.Type.isPlainObject(i)){i={}}i.analyticsLabel="salescenterConnect";if(e.siteTemplateCode){i.tpl=e.siteTemplateCode}o.setQueryParams(i);e.openSlider(o.toString()).then(function(){n()})}})}},{key:"publicConnectedSite",value:function t(){return new Promise(function(t,i){if(e.connectedSiteId>0&&!e.isSitePublished){n.rest.callMethod("landing.site.publication",{id:e.connectedSiteId}).then(function(n){e.isSitePublished=true;e.firePublicConnectedSiteEvent();t(n)}).catch(function(e){i(e)})}else{t()}})}},{key:"firePublicConnectedSiteEvent",value:function e(){top.BX.onCustomEvent("Salescenter.Manager:onPublicConnectedSite",{isSitePublished:true})}},{key:"getPopup",value:function e(n){var t=n.id,i=t===void 0?"":t,o=n.title,a=o===void 0?"":o,r=n.text,s=r===void 0?"":r,l=n.buttons,d=l===void 0?[]:l;var u=BX.PopupWindowManager.getPopupById(i);var c='<div class="salescenter-popup">\n\t\t\t<div class="salescenter-popup-title">'.concat(a,'</div>\n\t\t\t<div class="salescenter-popup-text">').concat(s,"</div>\n\t\t</div>");if(u){u.setContent(c);u.setButtons(d)}else{u=new BX.PopupWindow(i,null,{zIndex:200,className:"salescenter-connect-popup",autoHide:true,closeByEsc:true,padding:0,closeIcon:true,content:c,width:400,overlay:true,lightShadow:false,buttons:d})}return u}},{key:"showAfterConnectPopup",value:function n(){var t=e.getPopup({id:"salescenter-connect-popup",title:BX.message("SALESCENTER_MANAGER_CONNECT_POPUP_TITLE"),text:BX.message("SALESCENTER_MANAGER_CONNECT_POPUP_DESCRIPTION"),buttons:[new BX.PopupWindowButton({text:BX.message("SALESCENTER_MANAGER_CONNECT_POPUP_GO_BUTTON"),className:"ui-btn ui-btn-md ui-btn-primary",events:{click:function n(){e.openConnectedSite();t.close()}}})]});t.show()}},{key:"copyUrl",value:function n(t,i){BX.clipboard.copy(t);if(i&&i.target){e.showCopyLinkPopup(i.target)}}},{key:"addCustomPage",value:function n(t){return new Promise(function(n){e.getAddUrlPopup().then(function(n){e.templateEngine.$emit("onAddUrlPopupCreate",t);n.show()});e.addUrlResolve=n;e.addingCustomPage=t})}},{key:"resolveAddPopup",value:function n(i,o){if(e.addUrlResolve&&t.Type.isFunction(e.addUrlResolve)){e.addUrlResolve(i);e.addUrlResolve=null}if(o&&i>0){if(e.addingCustomPage&&e.addingCustomPage.id&&parseInt(e.addingCustomPage.id)===parseInt(i)){e.showNotification(BX.message("SALESCENTER_MANAGER_UPDATE_URL_SUCCESS"))}else{e.showNotification(BX.message("SALESCENTER_MANAGER_ADD_URL_SUCCESS"))}}}},{key:"initPopupTemplate",value:function n(){return new Promise(function(n){BX.loadExt("salescenter.url_popup").then(function(){e.templateEngine=BX.Vue.create({el:document.createElement("div"),template:"<bx-salescenter-url-popup/>",mounted:function t(){e.popupNode=this.$el;this.$app=e;n()}})})})}},{key:"handleAddUrlPopupAutoHide",value:function n(t){if(!e.addUrlPopup){return true}if(t.target!==e.addUrlPopup.getPopupContainer()&&!e.addUrlPopup.getPopupContainer().contains(t.target)){var i=null;var o=BX.PopupMenu.getMenuById("salescenter-url-fields-popup");if(o){i=o.popupWindow}if(!i){return true}else{if(t.target.dataset["rootMenu"]==="salescenter-url-fields-popup"||t.target.parentNode.dataset["rootMenu"]==="salescenter-url-fields-popup"){if(!t.target.classList.contains("menu-popup-item-submenu")&&!t.target.parentNode.classList.contains("menu-popup-item-submenu")){i.close()}return false}else{return true}}}return false}},{key:"getAddUrlPopup",value:function n(){return new Promise(function(n){if(!e.addUrlPopup){e.initPopupTemplate().then(function(){e.addUrlPopup=new BX.PopupWindow({id:"salescenter-app-add-url",zIndex:200,autoHide:true,closeByEsc:true,closeIcon:true,padding:0,contentPadding:0,content:e.popupNode,titleBar:BX.message("SALESCENTER_ACTION_ADD_CUSTOM_TITLE"),contentColor:"white",width:600,autoHideHandler:e.handleAddUrlPopupAutoHide,events:{onPopupClose:function n(){var t=document.getElementById("salescenter-app-add-custom-url-id");var i=document.getElementById("salescenter-app-add-custom-url-is-saved").value==="y";if(t){t=t.value}else{t=false}e.resolveAddPopup(t,i)},onPopupDestroy:function n(){e.addUrlPopup=null}}});n(e.addUrlPopup)})}else{n(e.addUrlPopup)}})}},{key:"addPage",value:function t(i){return new Promise(function(t,o){var a,r;if(i.analyticsLabel){r=i.analyticsLabel;delete i.analyticsLabel}if(i.id>0){a=n.rest.callMethod("salescenter.page.update",{id:i.id,fields:i});if(!r){r="salescenterUpdatePage"}}else{a=n.rest.callMethod("salescenter.page.add",{fields:i});if(!r){r="salescenterAddPage"}}a.then(function(n){if(n.answer.result.page){var i=n.answer.result.page;var o="other";if(i.landingId>0){if(parseInt(i.siteId)===parseInt(e.connectedSiteId)){o="landing_store_chat"}else{o="landing_other"}}e.addAnalyticAction({analyticsLabel:r,source:o,type:i.isWebform?"forms":"info",code:i.code}).then(function(){t(n)})}else{t(n)}}).catch(function(e){o(e)})})}},{key:"checkUrl",value:function e(t){return n.rest.callMethod("salescenter.page.geturldata",{url:t})}},{key:"addSitePage",value:function n(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return new Promise(function(n){if(e.connectedSiteId>0){BX.loadExt("landing.master").then(function(){BX.Landing.UI.Panel.URLList.getInstance().show("landing",{siteId:e.connectedSiteId}).then(function(i){e.addPage({hidden:false,landingId:i.id,isWebform:t}).then(function(t){n(t);e.showNotification(BX.message("SALESCENTER_MANAGER_ADD_URL_SUCCESS"))})})})}else{e.openSlider("/bitrix/components/bitrix/salescenter.connect/slider.php").then(function(){n()})}})}},{key:"showNotification",value:function e(n){if(!n){return}BX.loadExt("ui.notification").then(function(){BX.UI.Notification.Center.notify({content:n})})}},{key:"hidePage",value:function t(i){var o="salescenter.page.hide";var a="other";if(i.landingId>0){if(parseInt(i.siteId)===parseInt(e.connectedSiteId)){a="landing_store_chat"}else{a="landing_other"}}var r={id:i.id,fields:{hidden:true},analyticsLabel:"salescenterDeletePage",source:a,type:i.isWebform?"form":"info",code:i.code};return new Promise(function(t,i){n.rest.callMethod(o,r).then(function(n){t(n);e.showNotification(BX.message("SALESCENTER_MANAGER_HIDE_URL_SUCCESS"))}).catch(function(e){i(e)})})}},{key:"deleteUrl",value:function t(i){var o="salescenter.page.delete";var a={id:i.id,analyticsLabel:"salescenterDeletePage",source:"other",type:i.isWebform?"form":"info"};return new Promise(function(t,i){n.rest.callMethod(o,a).then(function(n){t(n);e.showNotification(BX.message("SALESCENTER_MANAGER_DELETE_URL_SUCCESS"))}).catch(function(e){i(e)})})}},{key:"editLandingPage",value:function n(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:e.connectedSiteId;window.open("/shop/stores/site/".concat(i,"/view/").concat(t,"/"),"_blank")}},{key:"openSlider",value:function e(n,i){if(!t.Type.isPlainObject(i)){i={}}i=babelHelpers.objectSpread({},{cacheable:false,allowChangeHistory:false,events:{}},i);return new Promise(function(e){if(t.Type.isString(n)&&n.length>1){i.events.onClose=function(n){e(n.getSlider())};BX.SidePanel.Instance.open(n,i)}else{e()}})}},{key:"getOrdersListUrl",value:function n(i){if(!t.Type.isPlainObject(i)){i={}}if(e.sessionId>0){i["sessionId"]=e.sessionId}return new t.Uri("/saleshub/orders/").setQueryParams(i).toString()}},{key:"showOrdersList",value:function n(t){return e.openSlider(e.getOrdersListUrl(t))}},{key:"getOrderAddUrl",value:function n(i){if(!t.Type.isPlainObject(i)){i={}}if(e.sessionId>0){i["sessionId"]=e.sessionId}return new t.Uri("/saleshub/orders/order/").setQueryParams(i).toString()}},{key:"showOrderAdd",value:function n(t){return e.openSlider(e.getOrderAddUrl(t))}},{key:"showOrdersListAfterCreate",value:function n(t){var i=e.getOrdersListUrl({orderId:t});var o=BX.SidePanel.Instance.getSlider(i);if(!o){i=e.getOrdersListUrl({orderId:t});o=BX.SidePanel.Instance.getSlider(i)}var a=e.getOrderAddUrl();var r=BX.SidePanel.Instance.getSlider(a);if(r){r.destroy()}if(!o){e.showOrdersList({orderId:t})}else{top.BX.onCustomEvent(o.getFrameWindow(),"salescenter-order-create",[{orderId:t}])}}},{key:"initPull",value:function n(){if(BX.PULL){e.isPullInited=true;BX.PULL.subscribe({moduleId:"salescenter",command:"SETCONNECTEDSITE",callback:function n(t){e.init(t)}})}}},{key:"openControlPanel",value:function e(){window.open("/saleshub/","_blank")}},{key:"getFormAddUrl",value:function e(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return new t.Uri("/crm/webform/edit/".concat(parseInt(n),"/")).setQueryParams({ACTIVE:"Y",RELOAD_LIST:"N"}).toString()}},{key:"addNewForm",value:function n(){return new Promise(function(n,t){e.openSlider(e.getFormAddUrl()).then(function(i){var o=i.getData().get("formId");if(o>0){e.addNewFormPage(o).then(function(e){n(e)}).catch(function(e){t(e)})}})})}},{key:"addNewFormPage",value:function t(i){return new Promise(function(t,o){var a="salescenter-add-new-page-popup";e.getPopup({id:a,title:BX.message("SALESCENTER_MANAGER_NEW_PAGE_POPUP_TITLE"),text:BX.message("SALESCENTER_MANAGER_NEW_PAGE_WAIT")}).show();n.rest.callMethod("salescenter.page.addformpage",{formId:i}).then(function(n){if(n.answer.result.page){t(n.answer.result.page);var i=n.answer.result.page.landingId;var r=e.getPopup({id:a,title:BX.message("SALESCENTER_MANAGER_NEW_PAGE_POPUP_TITLE"),text:BX.message("SALESCENTER_MANAGER_NEW_PAGE_COMPLETE"),buttons:[new BX.PopupWindowButton({text:BX.message("SALESCENTER_MANAGER_CONNECT_POPUP_GO_BUTTON"),className:"ui-btn ui-btn-md ui-btn-primary",events:{click:function n(){e.editLandingPage(i);r.close()}}})]});r.show()}else{e.getPopup({id:a,title:BX.message("SALESCENTER_MANAGER_ERROR_POPUP")}).show();o()}}).catch(function(n){e.getPopup({id:a,title:BX.message("SALESCENTER_MANAGER_ERROR_POPUP"),text:n}).show();o(n)})})}},{key:"openConnectedSite",value:function n(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(e.connectedSiteId>0){var o=new t.Uri("/shop/stores/site/".concat(e.connectedSiteId,"/"));var a={apply_filter:"y"};if(i){a.DELETED="Y"}else{a.clear_filter="y"}o.setQueryParams(a);window.open(o.toString(),"_blank")}}},{key:"openHowItWorks",value:function n(t){e.openHelper(t,"redirect=detail&code=9289135","chat_connect")}},{key:"openHowSmsWorks",value:function n(t){e.openHelper(t,"redirect=detail&code=9680407","sms_connect")}},{key:"openHowToConfigOpenLines",value:function n(t){e.openHelper(t,"redirect=detail&code=7872935","openlines_connect")}},{key:"openHowToConfigPaySystem",value:function n(t){e.openHelper(t,"redirect=detail&code=9600843","pay_system_connect")}},{key:"openHelper",value:function n(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";if(t){t.preventDefault()}if(o){e.addAnalyticAction({analyticsLabel:"salescenterOpenHelp",article:o}).then(function(){if(top.BX.Helper){top.BX.Helper.show(i)}})}else if(top.BX.Helper){top.BX.Helper.show(i)}}},{key:"openFeedbackForm",value:function n(i){if(i&&t.Type.isFunction(i.preventDefault)){i.preventDefault()}return e.openSlider("/bitrix/components/bitrix/salescenter.feedback/slider.php",{width:735})}},{key:"openApplication",value:function n(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var o=new t.Uri("/saleshub/app/");if(t.Type.isPlainObject(i)){o.setQueryParams(i)}return new Promise(function(n,t){e.openSlider(o.toString(),{width:873}).then(function(e){n(e.getData())}).catch(function(e){t(e)})})}},{key:"addAnalyticAction",value:function e(n){return new Promise(function(e,i){if(!t.Type.isPlainObject(n)||!n.analyticsLabel){i("wrong params")}var o=new XMLHttpRequest;var a=new t.Uri("/bitrix/services/main/ajax.php");a.setQueryParams(n);o.open("GET",a.toString());o.onload=function(){e()};o.onerror=function(){i()};o.send()})}},{key:"getFieldsMap",value:function n(){return new Promise(function(n,i){if(e.fieldsMap!==null){n(e.fieldsMap);return}t.ajax.runAction("salescenter.manager.getFieldsMap",{analyticsLabel:"salescenterFieldsMapLoading"}).then(function(t){e.fieldsMap=t.data.fields;n(t.data.fields)}).catch(function(e){i(e.errors)})})}},{key:"getPageUrl",value:function e(n,i){var o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return new Promise(function(e,a){if(!t.Type.isInteger(n)){e(null)}if(!t.Type.isPlainObject(i)||i.length<=0){e(null)}t.ajax.runAction("salescenter.manager.getPageUrl",{data:{pageId:n,entities:i},analyticsLabel:"salescenterGetPageUrlWithParameters",getParameters:{context:o}}).then(function(n){e(n.data.pageUrl)}).catch(function(e){a(e.errors)})})}}]);return e}();babelHelpers.defineProperty(i,"sessionId",null);babelHelpers.defineProperty(i,"connectedSiteId",null);babelHelpers.defineProperty(i,"addUrlPopup",null);babelHelpers.defineProperty(i,"addUrlResolve",null);babelHelpers.defineProperty(i,"popupNode",null);babelHelpers.defineProperty(i,"siteTemplateCode",null);babelHelpers.defineProperty(i,"isSitePublished",null);babelHelpers.defineProperty(i,"isSiteExists",null);babelHelpers.defineProperty(i,"isOrderPublicUrlAvailable",null);babelHelpers.defineProperty(i,"isPullInited",false);babelHelpers.defineProperty(i,"connectPath",null);babelHelpers.defineProperty(i,"fieldsMap",null);babelHelpers.defineProperty(i,"showCopyLinkPopup",function(e){if(i.popupOuterLink){i.popupOuterLink.destroy();i.popupOuterLink=null;if(i.hideCopyLinkTimeout>0){clearTimeout(i.hideCopyLinkTimeout);i.hideCopyLinkTimeout=0}if(i.destroyCopyLinkTimeout>0){clearTimeout(i.destroyCopyLinkTimeout);i.destroyCopyLinkTimeout=0}}i.popupOuterLink=new BX.PopupWindow("salescenter-popup-copy-link",e,{className:"salescenter-popup-copy-link",darkMode:true,content:BX.message("SALESCENTER_MANAGER_COPY_URL_SUCCESS"),zIndex:5e3});i.popupOuterLink.show();i.hideCopyLinkTimeout=setTimeout(function(){BX.hide(BX(i.popupOuterLink.uniquePopupId));i.hideCopyLinkTimeout=0},2e3);i.destroyCopyLinkTimeout=setTimeout(function(){i.popupOuterLink.destroy();i.popupOuterLink=null;i.destroyCopyLinkTimeout=0},2200)});e.Manager=i})(this.BX.Salescenter=this.BX.Salescenter||{},BX,BX);
//# sourceMappingURL=manager.bundle.map.js