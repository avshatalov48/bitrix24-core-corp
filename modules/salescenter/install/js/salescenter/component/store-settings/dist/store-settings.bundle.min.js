this.BX=this.BX||{};this.BX.Salescenter=this.BX.Salescenter||{};(function(t,e,n,i,c,o,a){"use strict";var s=function(){function t(s,l){babelHelpers.classCallCheck(this,t);l=l||{};var p={};p.companyId=BX.prop.get(l,"companyId",0);p.companyTitle=BX.prop.get(l,"companyTitle","");p.previewLang=BX.prop.get(l,"previewLang","");p.companyPhone="";p.phoneIdSelected=BX.prop.get(l,"phoneIdSelected",0);p.companyPhoneList=BX.prop.get(l,"companyPhoneList","");p.phoneValueSelected=BX.prop.get(l,"phoneValueSelected","");p.originPhoneIdSelected=BX.prop.get(l,"phoneIdSelected",0);this.componentName="bitrix:salescenter.company.contacts";this.slider=BX.SidePanel.Instance.getTopSlider();var r=this;e.Vue.create({el:"#"+s,data:p,components:{"my-company-requisite-block":a.RequisiteBlock,"store-preview-block":o.PreviewBlock},computed:{loc:function t(){return e.Vue.getFilteredPhrases("SC_STORE_SETTINGS_")},isNew:function t(){return this.companyId===undefined||parseInt(this.companyId)<=0},getPhonesList:function t(){return BX.type.isArray(this.companyPhoneList)?this.companyPhoneList:[]},getSelectedPhoneId:function t(){return parseInt(this.phoneIdSelected)>0?this.phoneIdSelected:0},getSelectedPhoneValue:function t(){return this.phoneValueSelected===""?this.loc.SC_STORE_SETTINGS_COMPANY_PHONE_DEFAULT:this.phoneValueSelected},getSelectedPhoneNumber:function t(){var e=this;var n=this.getPhonesList;var i="";if(n.length>0){n.forEach(function(t){if(t.id===e.getSelectedPhoneId){i=t.value}})}return i},getOriginSelectedPhoneId:function t(){var e=this;var n=this.getPhonesList;var i=0;if(n.length>0){n.forEach(function(t){if(t.id===e.originPhoneIdSelected){i=t.id}})}return i}},created:function t(){this.$app=r},mounted:function t(){BX.UI.Hint.init(BX("salescenter-company-contacts-wrapper"))},methods:{requisiteOpenSlider:function t(e){var n=this;var c="/crm/company/details/"+this.companyId+"/?init_mode=edit";i.Manager.openSlider(c).then(function(){return n.refresh()})},showPopupMenu:function t(e){var n=this;var i=[];var o=function t(e,i){n.phoneIdSelected=i.id;n.popupMenu.close()};var a=this.getPhonesList;if(a.length>0){i.push({text:this.loc.SC_STORE_SETTINGS_COMPANY_PHONE_DEFAULT,id:"0",onclick:o.bind(this)});i.push({text:this.loc.SC_STORE_SETTINGS_COMPANY_PHONE_DELIMETER,id:"-1",delimiter:true});a.forEach(function(t){i.push({text:t.value,id:t.id,onclick:o.bind(n)})})}this.popupMenu=new c.PopupMenuWindow({bindElement:e.target,minWidth:e.target.offsetWidth,items:i});this.popupMenu.show()},reset:function t(){this.companyPhoneList=[];this.phoneIdSelected=0;this.companyTitle=""},refresh:function t(){var e=this;n.rest.callMethod("crm.company.get",{id:this.companyId}).then(function(t){var n=t.data();e.reset();e.companyTitle=BX.prop.get(n,"TITLE","");var i=BX.prop.get(n,"PHONE",[]);if(BX.type.isObject(i)&&Object.values(i).length>0){Object.values(i).forEach(function(t){e.companyPhoneList.push({id:t.ID,value:t.VALUE})})}e.phoneIdSelected=e.getOriginSelectedPhoneId})},save:function t(){if(this.isNew){this.addCompany()}else{this.updateCompany()}},updateCompany:function t(){var e=this;this.$app.query("updateCompanyContacts",{id:this.companyId,fields:{title:this.companyTitle,phoneIdSelected:this.phoneIdSelected}},"salescenterContactsCompanyUpdate").then(function(t){e.$app.closeApplication()}).catch(function(t){var e=BX.prop.getArray(t,"errors",[]);if(BX.type.isArray(e)&&e.length>0){var n=BX.prop.get(e[0],"message","");i.Manager.showNotification(n)}})},addCompany:function t(){var e=this;this.$app.query("saveCompanyContacts",{fields:{title:this.companyTitle,phone:this.companyPhone}},"salescenterContactsCompanyAdd").then(function(t){e.$app.closeApplication()}).catch(function(t){var e=BX.prop.getArray(t,"errors",[]);if(BX.type.isArray(e)&&e.length>0){var n=BX.prop.get(e[0],"message","");i.Manager.showNotification(n)}})},close:function t(){this.$app.closeApplication()}},watch:{phoneIdSelected:function t(){this.phoneValueSelected=this.getSelectedPhoneNumber}},template:'   \n\t\t\t\t<div class="salescenter-company-contacts-wrapper" id="salescenter-company-contacts-wrapper">\n\t\t\t\t\t<div class="salescenter-company-contacts-item">\n\t\t\t\t\t\t<div class="salescenter-company-contacts-area">\n\t\t\t\t\t\t\t<div class="salescenter-company-contacts-area-item">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t{{loc.SC_STORE_SETTINGS_COMPANY_TITLE}}\n\t\t\t\t\t\t\t\t\t<span class="ui-hint" :data-hint="loc.SC_STORE_SETTINGS_PUBLIC_COMPANY_NAME_HINT"></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t\t\t\t<input type="text" class="ui-ctl-element" name="name" v-model="companyTitle">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class="salescenter-company-contacts-area-item">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">{{loc.SC_STORE_SETTINGS_COMPANY_PHONE}}</div>\n\t\t\t\t\t\t\t\t<template v-if="isNew">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t\t\t\t\t<input type="text" class="ui-ctl-element" name="phone" v-model="companyPhone">\n\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t<template v-if="getPhonesList.length === 0">\n\t\t\t\t\t\t\t\t\t\t<div class="salescenter-company-contacts-text">{{loc.SC_STORE_SETTINGS_COMPANY_PHONE_EMPTY}}<a href="javascript:void(0)" @click="requisiteOpenSlider()">{{loc.SC_STORE_SETTINGS_COMPANY_PHONE_ADD}}</a></div>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-dropdown salescenter-company-contacts-area-item-input" @click="showPopupMenu($event)">\n\t\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl-element">{{this.getSelectedPhoneValue}}</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="salescenter-company-contacts-controls">\n\t\t\t\t\t\t\t\t\t\t\t<div class="salescenter-company-contacts-link" @click="requisiteOpenSlider()">{{loc.SC_STORE_SETTINGS_COMPANY_PHONE_ADD_SMALL}}</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<my-company-requisite-block \n\t\t\t\t\t\t\t:isNewCompany="isNew"\n\t\t\t\t\t\t\t:companyId="companyId"\n\t\t\t\t\t\t\tv-on:on-mycompany-requisite-settings="refresh"/>\n\t\t\t\t\t\t<div class="salescenter-company-contacts-panel">\n\t\t\t\t\t\t\t<button class="ui-btn ui-btn-md ui-btn-success" @click="save">{{loc.SC_STORE_SETTINGS_SAVE}}</button>\n\t\t\t\t\t\t\t<button class="ui-btn ui-btn-md ui-btn-link" @click="close">{{loc.SC_STORE_SETTINGS_CANCEL}}</button> \n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<store-preview-block :options="{lang: this.previewLang}"/>\n\t\t\t</div>'})}babelHelpers.createClass(t,[{key:"query",value:function t(e,n,i){var c;c=BX.ajax.runComponentAction(this.componentName,e,{mode:"class",data:n,analyticsLabel:i});return c}},{key:"closeApplication",value:function t(){if(this.slider){this.slider.close()}}}],[{key:"showNotification",value:function t(e){if(!e){return}BX.loadExt("ui.notification").then(function(){BX.UI.Notification.Center.notify({content:e})})}}]);return t}();t.StoreSettings=s})(this.BX.Salescenter.Component=this.BX.Salescenter.Component||{},BX,BX,BX.Salescenter,BX.Main,BX.Salescenter.Component,BX.Salescenter.Component);
//# sourceMappingURL=store-settings.bundle.map.js