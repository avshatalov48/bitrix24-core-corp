this.BX=this.BX||{};this.BX.Salescenter=this.BX.Salescenter||{};this.BX.Salescenter.Component=this.BX.Salescenter.Component||{};(function(t,e,n,s,r,i){"use strict";var o={props:{error:{type:Object,required:true}},methods:{openSlider:function t(){var e=this;this.error.fixer().then((function(){return e.onConfigure(e.error)}))},onConfigure:function t(n){this.$emit("on-configure",new e.BaseEvent({data:n}))}},template:'\n\t\t<div class="ui-alert ui-alert-warning ui-alert-xs ui-alert-icon-danger salescenter-app-payment-by-sms-item-container-alert">\n\t\t\t<span class="ui-alert-message">\n\t\t\t\t{{error.text}}\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\tv-if="error.fixer && error.fixText"\n\t\t\t\tclass="salescenter-app-payment-by-sms-item-container-alert-config"\n\t\t\t\t@click="openSlider()"\n\t\t\t>\n\t\t\t\t{{error.fixText}}\n\t\t\t</span>\n\t\t</div>\n\t'};var a={props:{editable:{type:Boolean,required:true}},computed:{classObject:function t(){return{"salescenter-app-payment-by-sms-item-container-sms-content-edit":true,"salescenter-app-payment-by-sms-item-container-sms-content-save":this.editable}}},methods:{onSave:function t(e){this.$emit("control-on-save",e)}},template:'\n\t\t<div :class="classObject" @click="onSave($event)"></div>\n\t'};var l={props:{text:{type:String,required:true},selectedMode:{type:String,required:true}},computed:{classObject:function t(){return{"salescenter-app-payment-by-sms-item-container-sms-content-message-text ":true,"salescenter-app-payment-by-sms-item-container-sms-content-message-text-edit":true}}},methods:{updateMessage:function t(e){this.text=e.target.innerText;this.$emit("edit-on-update-template",this.text)},isHasLink:function t(){return this.text.match(/#LINK#/)},saveSmsTemplate:function t(e){BX.ajax.runComponentAction("bitrix:salescenter.app","saveSmsTemplate",{mode:"class",data:{smsTemplate:e,mode:this.selectedMode},analyticsLabel:"salescenterSmsTemplateChange"})["catch"]((function(t){var e=t.errors.map((function(t){return t.message})).join("; ");alert(e)}))},adjustUpdateMessage:function t(e){this.updateMessage(e);if(!this.isHasLink()){this.showErrorHasLink(e)}else{this.saveSmsTemplate(this.text)}},onPressKey:function t(e){if(e.code==="Enter"){this.adjustUpdateMessage(e);this.afterPressKey(e)}},onBlur:function t(e){this.beforeBlur();this.adjustUpdateMessage(e)},afterPressKey:function t(e){this.$emit("edit-on-after-press-key",e)},beforeBlur:function t(e){this.$emit("edit-on-before-blur",e)},showErrorHasLink:function t(e){this.$emit("edit-on-has-link-error",e)}},template:'\n\n\t\t<div \n\t\t\tcontenteditable="true"\t\n\t\t\t:class="classObject"\n\t\t\t@blur="onBlur($event)"\n\t\t\t@keydown="onPressKey($event)"\n\t\t>{{text}}\n</div>\n\n\t'};var c={props:{text:{type:String,required:true},orderPublicUrl:{type:String,required:true}},computed:{classObject:function t(){return{"salescenter-app-payment-by-sms-item-container-sms-content-message-text":true}}},methods:{onMouseenter:function t(e){this.$emit("view-on-mouseenter",e)},onMouseleave:function t(){this.$emit("view-on-mouseleave")},getSmsMessage:function t(){var e='<span class="salescenter-app-payment-by-sms-item-container-sms-content-message-link">'.concat(this.orderPublicUrl,'</span><span class="salescenter-app-payment-by-sms-item-container-sms-content-message-link-ref">xxxxx</span>')+" ";var s=this.text;return n.Text.encode(s).replace(/#LINK#/g,e)}},template:'\n\t\t<div \n\t\t\tv-html="getSmsMessage()"\n\t\t\tcontenteditable="false" \n\t\t\t:class="classObject" \n\t\t\tv-on:mouseenter="onMouseenter($event)" \n\t\t\tv-on:mouseleave="onMouseleave"\n\t\t/>\n\t'};var p="view";var u="edit";var d={props:{editor:{type:Object,required:true},isReadOnly:{type:Boolean,default:false},selectedMode:{type:String,required:true}},data:function t(){return{mode:p,text:this.editor.template,hasError:false,orderPublicUrl:this.editor.url,smsEditMessageMode:false}},components:{"sms-message-edit-block":l,"sms-message-view-block":c,"sms-message-control-block":a},computed:{getMode:function t(){return this.mode},setMode:function t(e){this.mode=e}},methods:{isEditable:function t(){return this.mode===u&&!this.isReadOnly},resetError:function t(){this.hasError=false},updateTemplate:function t(e){this.editor.template=e;this.$root.$app.sendingMethodDesc.text=e;this.$root.$app.sendingMethodDesc.text_modes[this.selectedMode]=e},showPopupHint:function t(e,n,r){var i=this;if(this.popup){this.popup.destroy();this.popup=null}if(!e&&!n){return}this.popup=new s.Popup(null,e,{events:{onPopupClose:function t(){i.popup.destroy();i.popup=null}},darkMode:true,content:n,offsetLeft:e.offsetWidth});if(r){setTimeout((function(){i.popup.destroy();i.popup=null}),r)}this.popup.show()},afterPressKey:function t(e){this.afterSavePressKey(e)},beforeBlur:function t(){this.hasError=false},showHasLinkErrorHint:function t(e){this.hasError=true},afterSavePressKey:function t(e){this.reverseMode();if(this.hasError){this.showPopupHint(e.target,n.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER_TEMPLATE_ERROR"),2e3)}this.resetError()},showSmsMessagePopupHint:function t(e){this.showPopupHint(e.target,n.Loc.getMessage("SALESCENTER_SMS_MESSAGE_HINT"))},hidePopupHint:function t(){if(this.popup){this.popup.destroy()}},reverseMode:function t(){this.mode===u?this.mode=p:this.mode=u},afterSaveControl:function t(e){if(!this.hasError){this.reverseMode()}else{this.showPopupHint(e.target,n.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER_TEMPLATE_ERROR"),2e3)}}},template:'\n\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-content">\n\t\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-content-message">\t\n\t\t\t\t<template v-if="isEditable()">\n\t\t\t\t\t<sms-message-edit-block\t\t\t\t\n\t\t\t\t\t\t:text="editor.template"\n\t\t\t\t\t\t:selectedMode="selectedMode"\n\t\t\t\t\t\tv-on:edit-on-before-blur="beforeBlur"\n\t\t\t\t\t\tv-on:edit-on-after-press-key="afterPressKey"\n\t\t\t\t\t\tv-on:edit-on-update-template="updateTemplate"\n\t\t\t\t\t\tv-on:edit-on-has-link-error="showHasLinkErrorHint"\n\t\t\t\t\t/>\n\t\t\t\t</template> \n\t\t\t\t<template v-else>\n\t\t\t\t\t<sms-message-view-block\n\t\t\t\t\t\t:text="editor.template"\n\t\t\t\t\t\t:orderPublicUrl="orderPublicUrl"\n\t\t\t\t\t\tv-on:view-on-mouseenter="showSmsMessagePopupHint"\n\t\t\t\t\t\tv-on:view-on-mouseleave="hidePopupHint"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<sms-message-control-block v-if="!isReadOnly"\n\t\t\t\t\t:editable="isEditable()"\n\t\t\t\t\tv-on:control-on-save="afterSaveControl"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t'};var m={props:["list","initSelected","settingUrl"],computed:{selectedSender:function t(){var e=this;return this.list.find((function(t){return t.id===e.selected}))},selectedSenderName:function t(){return this.selectedSender?this.selectedSender.name:""},localize:function t(){return i.Vue.getFilteredPhrases("SALESCENTER_SENDER_LIST_CONTENT_")}},data:function t(){return{selected:null}},created:function t(){if(this.initSelected){this.onSelectedSender(this.initSelected)}else if(this.list&&this.list.length>0){this.onSelectedSender(this.list[0].id)}},methods:{openSlider:function t(){var e=this;r.Manager.openSlider(this.settingUrl).then((function(){return e.onConfigure()}))},onConfigure:function t(){this.$emit("on-configure")},onSelectedSender:function t(e){this.selected=e;this.$emit("on-selected",e)},render:function t(e,n){var r=this;var i=[];var o=function t(n){e.innerHTML=n.target.innerHTML;r.onSelectedSender(n.currentTarget.getAttribute("data-item-sender-value"));r.popupMenu.close()};for(var a in n){if(!n.hasOwnProperty(a)){continue}i.push({text:n[a].name,dataset:{itemSenderValue:n[a].id},onclick:o})}i.push({text:this.localize.SALESCENTER_SENDER_LIST_CONTENT_SETTINGS,onclick:function t(){r.openSlider();r.popupMenu.close()}});this.popupMenu=new s.PopupMenuWindow({bindElement:e,items:i});this.popupMenu.show()}},template:'\n\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-content-info">\n\t\t\t<slot name="sms-sender-list-text-send-from"></slot>\n\t\t\t<span @click="render($event.target, list)">{{selectedSenderName}}</span>\n\t\t</div>\n\t'};var h={props:{manager:{type:Object,required:true}},computed:{avatarStyle:function t(){var e=this.manager.photo?{"background-image":"url("+this.manager.photo+")"}:null;return[e]}},template:'\n\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-user">\n\t\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-user-avatar" :style="avatarStyle"></div>\n\t\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-user-name">{{manager.name}}</div>\n\t\t</div>\n\t'};t.Error=o;t.MessageControl=a;t.MessageEdit=l;t.MessageEditor=d;t.MessageView=c;t.SenderList=m;t.UserAvatar=h})(this.BX.Salescenter.Component.StageBlock=this.BX.Salescenter.Component.StageBlock||{},BX.Event,BX,BX.Main,BX.Salescenter,BX);
//# sourceMappingURL=sms-message.bundle.map.js