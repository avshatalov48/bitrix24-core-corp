this.BX=this.BX||{};this.BX.Salescenter=this.BX.Salescenter||{};this.BX.Salescenter.Component=this.BX.Salescenter.Component||{};(function(t,e,n,s,i){"use strict";var r={template:'\n\t\t<div class="ui-alert ui-alert-danger ui-alert-icon-danger salescenter-app-payment-by-sms-item-container-alert">\n\t\t\t<span class="ui-alert-message">\n\t\t\t\t<slot name="sms-alert-text"></slot>\n\t\t\t</span>\n\t\t</div>\n\t'};var o={props:["url"],methods:{openSlider:function t(){var e=this;n.Manager.openSlider(this.url).then(function(){return e.onConfigure()})},onConfigure:function t(){this.$emit("on-configure")}},template:'\n\t\t<div class="ui-alert ui-alert-danger ui-alert-xs salescenter-app-payment-by-sms-item-container-alert">\n\t\t\t<span class="ui-alert-message">\n\t\t\t\t<slot name="sms-configure-text-alert"></slot>\n\t\t\t</span>\n\t\t\t<span class="salescenter-app-payment-by-sms-item-container-alert-config" @click="openSlider()">\n\t\t\t\t<slot name="sms-configure-text-setting"></slot>\n\t\t\t</span>\n\t\t</div>\n\t'};var a={props:{editable:{type:Boolean,required:true}},computed:{classObject:function t(){return{"salescenter-app-payment-by-sms-item-container-sms-content-edit":true,"salescenter-app-payment-by-sms-item-container-sms-content-save":this.editable}}},methods:{onSave:function t(e){this.$emit("control-on-save",e)}},template:'\n\t\t<div :class="classObject" @click="onSave($event)"></div>\n\t'};var l={props:{text:{type:String,required:true}},computed:{classObject:function t(){return{"salescenter-app-payment-by-sms-item-container-sms-content-message-text ":true,"salescenter-app-payment-by-sms-item-container-sms-content-message-text-edit":true}}},methods:{updateMessage:function t(e){this.text=e.target.innerText;this.$emit("edit-on-update-template",this.text)},isHasLink:function t(){return this.text.match(/#LINK#/)},saveSmsTemplate:function t(e){BX.ajax.runComponentAction("bitrix:salescenter.app","saveSmsTemplate",{mode:"class",data:{smsTemplate:e},analyticsLabel:"salescenterSmsTemplateChange"})},adjustUpdateMessage:function t(e){this.updateMessage(e);if(!this.isHasLink()){this.showErrorHasLink(e)}else{this.saveSmsTemplate(this.text)}},onPressKey:function t(e){if(e.code==="Enter"){this.adjustUpdateMessage(e);this.afterPressKey(e)}},onBlur:function t(e){this.beforeBlur();this.adjustUpdateMessage(e)},afterPressKey:function t(e){this.$emit("edit-on-after-press-key",e)},beforeBlur:function t(e){this.$emit("edit-on-before-blur",e)},showErrorHasLink:function t(e){this.$emit("edit-on-has-link-error",e)}},template:'\n\n\t\t<div \n\t\t\tcontenteditable="true"\t\n\t\t\t:class="classObject"\n\t\t\t@blur="onBlur($event)"\n\t\t\t@keydown="onPressKey($event)"\n\t\t>{{text}}\n</div>\n\n\t'};var p={props:{text:{type:String,required:true},orderPublicUrl:{type:String,required:true}},computed:{classObject:function t(){return{"salescenter-app-payment-by-sms-item-container-sms-content-message-text":true}}},methods:{onMouseenter:function t(e){this.$emit("view-on-mouseenter",e)},onMouseleave:function t(){this.$emit("view-on-mouseleave")},getSmsMessage:function t(){var e='<span class="salescenter-app-payment-by-sms-item-container-sms-content-message-link">'.concat(this.orderPublicUrl,'</span><sapn class="salescenter-app-payment-by-sms-item-container-sms-content-message-link-ref">xxxxx</sapn>')+" ";var n=this.text;return s.Text.encode(n).replace(/#LINK#/g,e)}},template:'\n\t\t<div \n\t\t\tv-html="getSmsMessage()"\n\t\t\tcontenteditable="false" \n\t\t\t:class="classObject" \n\t\t\tv-on:mouseenter="onMouseenter($event)" \n\t\t\tv-on:mouseleave="onMouseleave"\n\t\t/>\n\t'};var u="view";var c="edit";var m={props:{editor:{type:Object,required:true}},data:function t(){return{mode:u,text:this.editor.template,hasError:false,orderPublicUrl:this.editor.url,smsEditMessageMode:false}},components:{"sms-message-edit-block":l,"sms-message-view-block":p,"sms-message-control-block":a},computed:{getMode:function t(){return this.mode},setMode:function t(e){this.mode=e}},methods:{isEditable:function t(){return this.mode===c},resetError:function t(){this.hasError=false},updateTemplate:function t(e){this.text=e},showPopupHint:function t(n,s,i){var r=this;if(this.popup){this.popup.destroy();this.popup=null}if(!n&&!s){return}this.popup=new e.Popup(null,n,{events:{onPopupClose:function t(){r.popup.destroy();r.popup=null}},darkMode:true,content:s,offsetLeft:n.offsetWidth});if(i){setTimeout(function(){r.popup.destroy();r.popup=null},i)}this.popup.show()},afterPressKey:function t(e){this.afterSavePressKey(e)},beforeBlur:function t(){this.hasError=false},showHasLinkErrorHint:function t(e){this.hasError=true},afterSavePressKey:function t(e){this.reverseMode();if(this.hasError){this.showPopupHint(e.target,s.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER_TEMPLATE_ERROR"),2e3)}this.resetError()},showSmsMessagePopupHint:function t(e){this.showPopupHint(e.target,s.Loc.getMessage("SALESCENTER_SMS_MESSAGE_HINT"))},hidePopupHint:function t(){if(this.popup){this.popup.destroy()}},reverseMode:function t(){this.mode===c?this.mode=u:this.mode=c},afterSaveControl:function t(e){if(!this.hasError){this.reverseMode()}else{this.showPopupHint(e.target,s.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER_TEMPLATE_ERROR"),2e3)}}},mounted:function t(){},template:'\n\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-content">\n\t\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-content-message">\n\t\t\t\t\n\t\t\t\t<template v-if="isEditable()">\n\t\t\t\t\t<sms-message-edit-block\t\t\t\t\n\t\t\t\t\t\t:text="text"\n\t\t\t\t\t\tv-on:edit-on-before-blur="beforeBlur"\n\t\t\t\t\t\tv-on:edit-on-after-press-key="afterPressKey"\n\t\t\t\t\t\tv-on:edit-on-update-template="updateTemplate"\n\t\t\t\t\t\tv-on:edit-on-has-link-error="showHasLinkErrorHint"\n\t\t\t\t\t/>\n\t\t\t\t</template> \n\t\t\t\t<template v-else>\n\t\t\t\t\t<sms-message-view-block\n\t\t\t\t\t\t:text="text"\n\t\t\t\t\t\t:orderPublicUrl="orderPublicUrl"\n\t\t\t\t\t\tv-on:view-on-mouseenter="showSmsMessagePopupHint"\n\t\t\t\t\t\tv-on:view-on-mouseleave="hidePopupHint"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t\n\t\t\t\t<sms-message-control-block \n\t\t\t\t\t:editable="isEditable()"\n\t\t\t\t\tv-on:control-on-save="afterSaveControl"\n\t\t\t\t/>\n\t\t\t</div>\n\t'};var d={props:["list","selected","settingUrl"],computed:{getSenderCode:function t(){return this.selected},getConfigUrl:function t(){return this.settingUrl},localize:function t(){return i.Vue.getFilteredPhrases("SALESCENTER_SENDER_LIST_CONTENT_")}},methods:{openSlider:function t(){var e=this;n.Manager.openSlider(this.getConfigUrl).then(function(){return e.onConfigure()})},onConfigure:function t(){this.$emit("on-configure")},onSelectedSender:function t(e){this.$emit("on-selected",e)},render:function t(n,s){var i=this;var r=[];var o=function t(e){n.innerHTML=e.target.innerHTML;i.setCode(e.currentTarget.getAttribute("data-item-sender-value"));i.popupMenu.close()};for(var a in s){if(!s.hasOwnProperty(a)){continue}r.push({text:s[a].name,dataset:{itemSenderValue:s[a].id},onclick:o})}r.push({text:this.localize.SALESCENTER_SENDER_LIST_CONTENT_SETTINGS,onclick:function t(){i.openSlider();i.popupMenu.close()}});this.popupMenu=new e.PopupMenuWindow({bindElement:n,items:r});this.popupMenu.show()},getName:function t(){if(s.Type.isArray(this.list)){for(var e in this.list){if(!this.list.hasOwnProperty(e)){continue}if(this.list[e].id===this.getSenderCode){return this.list[e].name}}}return null},setCode:function t(e){if(typeof e==="string"){this.onSelectedSender(e);return}this.onSelectedSender(e.target.value)},isShow:function t(){return s.Type.isString(this.getName())}},template:'\n\t\t<div v-if="isShow()" class="salescenter-app-payment-by-sms-item-container-sms-content-info">\n\t\t\t<slot name="sms-sender-list-text-send-from"></slot>\n\t\t\t<span @click="render($event.target, list)">{{getName()}}</span>\n\t\t</div>\n\t'};var h={props:{manager:{type:Object,required:true}},computed:{avatarStyle:function t(){var e=this.manager.photo?{"background-image":"url("+this.manager.photo+")"}:null;return[e]}},template:'\n\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-user">\n\t\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-user-avatar" :style="avatarStyle"></div>\n\t\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-user-name">{{manager.name}}</div>\n\t\t</div>\n\t'};t.Alert=r;t.Configure=o;t.MessageControl=a;t.MessageEdit=l;t.MessageEditor=m;t.MessageView=p;t.SenderList=d;t.UserAvatar=h})(this.BX.Salescenter.Component.StageBlock=this.BX.Salescenter.Component.StageBlock||{},BX.Main,BX.Salescenter,BX,BX);
//# sourceMappingURL=sms-message.bundle.map.js