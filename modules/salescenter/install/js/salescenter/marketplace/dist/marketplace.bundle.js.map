{"version":3,"file":"marketplace.bundle.js","sources":["../src/event-types.js","../src/tile-slider/app-local.js","../src/tile-slider/app-installed.js","../src/tile-slider/app-uninstalled.js","../src/app-slider.js"],"sourcesContent":["const EventTypes = {\n\tAppLocalSliderClose\t\t\t: 'app-local:slider-on-close',\n\tAppSliderSliderClose\t\t: 'app-slider:slider-on-close',\n\tAppUninstalledSliderClose\t: 'app-uninstalled:slider-on-close'\n};\n\nexport\n{\n\tEventTypes\n}","import {Manager} from 'salescenter.manager';\nimport * as Tile from 'salescenter.tile';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {EventTypes} from \"../event-types\";\n\nclass AppLocal extends EventEmitter {\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Salescenter.TileSlider.AppSystem');\n\t}\n\n\topen(tile: Tile.Base, options = {})\n\t{\n\t\tManager.openSlider(tile.link, options).then(\n\t\t\t() => this.emit(EventTypes.AppLocalSliderClose, new BaseEvent({data:{type: tile.getType()}})));\n\t}\n}\n\nexport{\n\tAppLocal\n}","import {Loc} from 'main.core';\nimport * as Tile from 'salescenter.tile';\n\nclass AppInstalled{\n\n\topen(tile: Tile.Base)\n\t{\n\t\tBX.ajax.runComponentAction(\n\t\t\t\"bitrix:salescenter.app\",\n\t\t\t\"getRestApp\",\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tcode: tile.code\n\t\t\t\t}\n\t\t\t}\n\t\t).then(function(response)\n\t\t{\n\t\t\tlet app = response.data;\n\t\t\tif(app.TYPE === \"A\")\n\t\t\t{\n\t\t\t\t// this.showRestApplication(code);  ???\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.rest.AppLayout.openApplication(tile.id);\n\t\t\t}\n\t\t}.bind(this)).catch(function(response)\n\t\t{\n\t\t\tthis.errorPopup(\" \", response.errors.pop().message);\n\t\t}.bind(this));\n\t}\n\n\terrorPopup(title, text)\n\t{\n\t\tlet popup = new PopupWindow('rest-app-error-alert', null, {\n\t\t\tcloseIcon: true,\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: false,\n\t\t\ttitleBar: title,\n\t\t\tcontent: text,\n\t\t\tzIndex: 16000,\n\t\t\toverlay: {\n\t\t\t\tcolor: 'gray',\n\t\t\t\topacity: 30\n\t\t\t},\n\t\t\tbuttons: [\n\t\t\t\tnew PopupWindowButton({\n\t\t\t\t\t'id': 'close',\n\t\t\t\t\t'text': Loc.getMessage('SALESCENTER_JS_POPUP_CLOSE'),\n\t\t\t\t\t'events': {\n\t\t\t\t\t\t'click': function(){\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function() {\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: function() {\n\t\t\t\t\tpopup = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tpopup.show();\n\t}\n}\n\nexport\n{\n\tAppInstalled\n}","import {Manager} from 'salescenter.manager';\nimport {EventEmitter} from 'main.core.events';\nimport * as Tile from 'salescenter.tile';\nimport {EventTypes} from \"../event-types\";\n\nconst URL = '/marketplace/detail/#app#/';\n\nclass AppUninstalled extends EventEmitter {\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Salescenter.Marketplace.TileSlider.AppUninstalled');\n\t}\n\n\topen(tile: Tile.Base, options = {})\n\t{\n\t\tlet url = URL.replace(\"#app#\", encodeURIComponent(tile.code));\n\n\t\tManager.openSlider(url, options).then(\n\t\t\t() => this.emit(EventTypes.AppUninstalledSliderClose));\n\t}\n}\n\nexport{\n\tAppUninstalled\n}\n","import {EventTypes} from \"./event-types\";\nimport {AppLocal} from \"./tile-slider/app-local\";\nimport {AppInstalled} from \"./tile-slider/app-installed\";\nimport {AppUninstalled} from \"./tile-slider/app-uninstalled\";\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport * as Tile from 'salescenter.tile';\n\nclass AppSlider extends EventEmitter {\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Salescenter.AppSlider');\n\t}\n\n\topen(tile: Tile.Base, options = {})\n\t{\n\t\tif (tile.hasOwnProperty('width'))\n\t\t{\n\t\t\toptions.width = Number(tile.width);\n\t\t}\n\n\t\tif (tile.getType() === Tile.Marketplace.type())\n\t\t{\n\t\t\tthis.openApp(tile, options);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet system = new AppLocal();\n\t\t\tsystem.open(tile, options);\n\t\t\tsystem.subscribe(\n\t\t\t\tEventTypes.AppLocalSliderClose,\n\t\t\t\t(e) => this.emit(EventTypes.AppSliderSliderClose, new BaseEvent({data: e.data}))\n\t\t\t);\n\t\t}\n\t}\n\n\topenApp(tile: Tile.Marketplace, options = {})\n\t{\n\t\tif (tile.isInstalled())\n\t\t{\n\t\t\t(new AppInstalled()).open(tile);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet uninstalled = new AppUninstalled();\n\t\t\tuninstalled.open(tile, options);\n\t\t\tuninstalled.subscribe(\n\t\t\t\tEventTypes.AppUninstalledSliderClose,\n\t\t\t\t() => this.emit(EventTypes.AppSliderSliderClose, new BaseEvent({data:{type: Tile.Marketplace.type()}})));\n\t\t}\n\t}\n}\n\nexport{\n\tAppSlider\n}"],"names":["EventTypes","AppLocalSliderClose","AppSliderSliderClose","AppUninstalledSliderClose","AppLocal","setEventNamespace","tile","options","Manager","openSlider","link","then","emit","BaseEvent","data","type","getType","EventEmitter","AppInstalled","BX","ajax","runComponentAction","code","response","app","TYPE","rest","AppLayout","openApplication","id","bind","catch","errorPopup","errors","pop","message","title","text","popup","PopupWindow","closeIcon","closeByEsc","autoHide","titleBar","content","zIndex","overlay","color","opacity","buttons","PopupWindowButton","Loc","getMessage","close","events","onPopupClose","destroy","onPopupDestroy","show","URL","AppUninstalled","url","replace","encodeURIComponent","AppSlider","hasOwnProperty","width","Number","Tile","openApp","system","open","subscribe","e","isInstalled","uninstalled"],"mappings":"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"}