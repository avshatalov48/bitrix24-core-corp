this.BX=this.BX||{};(function(t,e,s,a,r){"use strict";a.Vue.component("bx-salescenter-url-popup",{data:function t(){return{urlCheckStatus:0,errorMessage:null,previousUrl:null,isEmptyNameOnSave:false,isDefaultName:false,previousName:null,fieldsPopupMenuId:"salescenter-url-fields-popup",params:[],fieldsMap:null}},created:function t(){var e=this;this.$root.$on("onAddUrlPopupCreate",this.setPageData);this.previousUrl=new Set;var s=BX.debounce(this.checkUrl,1500,this);this.debounceCheckUrl=function(){var t=e.$refs["urlInput"].value;if(e.previousUrl.has(t)){return}e.errorMessage=null;e.urlCheckStatus=0;s()}},mounted:function t(){var e=this;setTimeout(function(){e.$refs["urlInput"].focus()},100)},beforeDestroy:function t(){this.$root.$off("onAddUrlPopupCreate",this.setPageData)},methods:{onTitleKeyUp:function t(){if(this.isDefaultName&&this.$refs["nameInput"].value!==this.previousName){this.isDefaultName=false;this.previousName=this.$refs["nameInput"].value}},checkUrl:function t(){var e=this;var s=this.$refs["urlInput"].value;this.$refs["isFrameDeniedInput"].value="";this.errorMessage=null;this.urlCheckStatus=0;this.previousUrl=new Set;this.previousUrl.add(s);if(s.length<5){return}this.urlCheckStatus=1;this.$root.$app.checkUrl(s).then(function(t){e.urlCheckStatus=11;if(!t.answer.result){if(s.indexOf("http://")!==0&&s.indexOf("https://")!==0){e.$refs["urlInput"].value="http://"+s}e.errorMessage=e.localize.SALESCENTER_ACTION_ADD_CUSTOM_NO_META}else{if(e.$refs["nameInput"].value.length<=0||e.isDefaultName){e.$refs["nameInput"].value=t.answer.result.title;e.isDefaultName=true;e.previousName=e.$refs["nameInput"].value}if(t.answer.result.extra&&t.answer.result.extra.effectiveUrl){e.$refs["urlInput"].value=t.answer.result.extra.effectiveUrl;e.previousUrl.add(t.answer.result.extra.effectiveUrl)}else{e.$refs["urlInput"].value=t.answer.result.url}if(t.answer.result.isFrameDenied===true){e.$refs["isFrameDeniedInput"].value="Y"}e.$refs["nameInput"].focus()}}).catch(function(t){e.urlCheckStatus=22;e.errorMessage=t.answer.error_description})},save:function t(){var e=this;this.isEmptyNameOnSave=false;if(this.$refs["nameInput"].value.length<=0){this.isEmptyNameOnSave=true;return}if(this.urlCheckStatus>10&&this.urlCheckStatus<20){var s=[];this.params.forEach(function(t){s.push(t.chain)});if(s.length<=0){s="false"}this.$root.$app.addPage({url:this.$refs["urlInput"].value,name:this.$refs["nameInput"].value,id:this.$refs["idInput"].value,isFrameDenied:this.$refs["isFrameDeniedInput"].value,isWebform:this.$refs["isWebformInput"].value,params:s}).then(function(t){e.$refs["idInput"].value=t.answer.result.page.id;e.$refs["isSaved"].value="y";if(e.$root.$app.addUrlPopup){e.$root.$app.addUrlPopup.close()}}).catch(function(t){e.errorMessage=t.answer.error_description})}},cancel:function t(){if(this.$root.$app.addUrlPopup){this.$root.$app.addUrlPopup.close()}},setPageData:function t(){var s=this;var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{url:"",name:"",id:0,isWebform:"",params:[]};var i=["url","name","id","isWebform"];for(var n in i){var l=i[n];var u="";if(a.hasOwnProperty(l)){u=a[l]}var c=this.$refs[l+"Input"];if(c){c.value=u}}this.checkUrl();this.$refs["isSaved"].value="n";this.params=[];if(e.Type.isArray(a.params)&&a.params.length>0){r.Manager.getFieldsMap().then(function(t){a.params.forEach(function(e){var a=s.findFieldByParam(t,e.field);if(a){s.params.push(a)}})})}},findFieldByParam:function t(s,a){if(!e.Type.isArray(s)||!e.Type.isString(a)||a.length<=0){return null}return this.getEntityField({items:s},a)},getEntityField:function t(s,a){var r=this;var i=null;if(!e.Type.isPlainObject(s)||!e.Type.isString(a)||a.length<=0||!s.items||!e.Type.isArray(s.items)){return i}var n=a.split(".");s.items.forEach(function(t){if(!i){if(t.name===n[0]){if(n.length===1){i=t}else{n.shift();i=r.getEntityField(t,n.join("."))}}}});return i},openFieldsMenu:function t(){var a=this;r.Manager.getFieldsMap().then(function(t){t=a.prepareFieldsMenu(t);s.PopupMenu.show({id:a.fieldsPopupMenuId,bindElement:a.$refs["fieldsSelector"],items:t,offsetLeft:0,offsetTop:0,closeByEsc:true,zIndex:2e3,zIndexAbsolute:2e3,maxHeight:500})}).catch(function(t){if(e.Type.isArray(t)){a.errorMessage=t.pop().message}else{a.errorMessage=t}})},prepareFieldsMenu:function t(s){var a=this;var r=[];s.forEach(function(t){var s={text:t.title,dataset:{rootMenu:a.fieldsPopupMenuId}};if(e.Type.isArray(t.items)){s.items=a.prepareFieldsMenu(t.items)}else{s.onclick=function(){a.selectField(t)}}r.push(s)});return r},selectField:function t(e){this.removeParam(e);this.params.push(e)},removeParam:function t(e){this.params=this.params.filter(function(t){return t.chain!==e.chain})}},computed:{localize:function t(){return a.Vue.getFilteredPhrases("SALESCENTER_")},hasParams:function t(){return this.params&&this.params.length>0}},template:'\n\t\t<div class="salescenter-add-custom-url-popup">\n\t\t\t<div class="salescenter-add-custom-url-popup-form">\n\t\t\t\t<div class="ui-ctl-label-text">{{localize.SALESCENTER_ACTION_ADD_CUSTOM_INPUT}}</div>\n\t\t\t\t<div class="ui-ctl ui-ctl-ext-after-icon ui-ctl-textbox" :class="{\n\t\t\t\t\t\'ui-ctl-danger\': this.urlCheckStatus > 20 || errorMessage, \n\t\t\t\t\t\'ui-ctl-success\': this.urlCheckStatus > 10 && this.urlCheckStatus < 20\n\t\t\t\t}">\n\t\t\t\t\t<div class="ui-ctl-ext-after ui-ctl-icon-dots salescenter-url-params-selector" @click="openFieldsMenu" ref="fieldsSelector"></div>\n\t\t\t\t\t<input name="url" class="ui-ctl-element" @keyup="debounceCheckUrl" ref="urlInput" :placeholder="localize.SALESCENTER_ACTION_ADD_CUSTOM_INPUT_PLACEHOLDER" autocomplete="off"/>\n\t\t\t\t</div>\n\t\t\t\t<div style="min-height: 20px;">\n\t\t\t\t\t<template v-if="urlCheckStatus > 20 || errorMessage" class="salescenter-url-message">{{errorMessage}}</template>\n\t\t\t\t\t<template v-else-if="urlCheckStatus > 10"></template>\n\t\t\t\t\t<template v-else-if="urlCheckStatus > 0">{{localize.SALESCENTER_ACTION_ADD_CUSTOM_PENDING}}</template>\n\t\t\t\t</div>\n\t\t\t\t<label class="ui-ctl" :class="{\n\t\t\t\t\t\'hidden\': !this.hasParams\n\t\t\t\t}">\n\t\t\t\t\t<div class="ui-ctl-label-text">{{localize.SALESCENTER_ACTION_URL_PARAMS}}</div>\n\t\t\t\t\t<div class="salescenter-url-params-field">\n\t\t\t\t\t\t<div v-for="param in params" class="salescenter-url-param">\n\t\t\t\t\t\t\t<span class="salescenter-url-param-name">{{param.fullName}}</span>\n\t\t\t\t\t\t\t<span class="salescenter-url-param-delete" @click="removeParam(param)"></span>\n\t\t\t\t\t    </div>\n\t\t\t\t    </div>\n\t\t\t\t</label>\n\t\t\t\t<div class="ui-ctl-label-text">{{localize.SALESCENTER_ACTION_ADD_CUSTOM_NAME}}</div>\n\t\t\t\t<label class="ui-ctl ui-ctl-textbox" :class="{\n\t\t\t\t\t\'ui-ctl-danger\': this.isEmptyNameOnSave\n\t\t\t\t}">\n\t\t\t\t\t<input class="ui-ctl-element" name="name" @keyup="onTitleKeyUp" ref="nameInput" :placeholder="localize.SALESCENTER_ACTION_ADD_CUSTOM_NAME_PLACEHOLDER" autocomplete="off"/>\n\t\t\t\t</label>\n\t\t\t\t<input type="hidden" name="id" value="" ref="idInput" id="salescenter-app-add-custom-url-id" />\n\t\t\t\t<input type="hidden" name="isFrameDenied" value="" ref="isFrameDeniedInput"/>\n\t\t\t\t<input type="hidden" name="isWebform" value="" ref="isWebformInput"/>\n\t\t\t\t<input type="hidden" name="isSaved" value="n" id="salescenter-app-add-custom-url-is-saved" ref="isSaved" />\n\t\t\t</div>\n\t\t\t<div class="popup-window-buttons salescenter-add-custom-url-popup-buttons">\n\t\t\t\t<button :class="{\n\t\t\t\t\t\'ui-btn-disabled\': this.urlCheckStatus < 10 || this.urlCheckStatus > 20\n\t\t\t\t}" class="ui-btn ui-btn-md ui-btn-success" @click="save">{{localize.SALESCENTER_ACTION_ADD_CUSTOM_SAVE}}</button>\n\t\t\t\t<button class="ui-btn ui-btn-md ui-btn-link" @click="cancel">{{localize.SALESCENTER_CANCEL}}</button>\n\t\t\t</div>\n\t\t</div>\n\t'})})(this.BX.Salescenter=this.BX.Salescenter||{},BX,BX,BX,BX.Salescenter);
//# sourceMappingURL=url_popup.bundle.map.js