{"version":3,"file":"backend-provider.bundle.js","sources":["../src/backend-provider.js"],"sourcesContent":["import {ajax, Type} from 'main.core';\nimport {AbstractBackendProvider} from 'sale.payment-pay.lib';\n\nexport class BackendProvider extends AbstractBackendProvider\n{\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.returnUrl = this.option('returnUrl', this.getCurrentUrl());\n\t\tthis.orderId = this.option('orderId', null);\n\t\tthis.paymentId = this.option('paymentId', null);\n\t\tthis.accessCode = this.option('accessCode', null);\n\t\tthis.paySystemId = null;\n\t\tthis.response = null;\n\t}\n\n\t/**\n\t * @override\n\t * @returns {Promise}\n\t */\n\tinitiatePayment() {\n\t\tif (!this.paySystemId) {\n\t\t\tthrow new Error('Payment system undefined');\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runComponentAction(\n\t\t\t\t'bitrix:salescenter.payment.pay',\n\t\t\t\t'initiatePay',\n\t\t\t\t{\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tpaysystemId: this.paySystemId,\n\t\t\t\t\t\treturnUrl: this.returnUrl,\n\t\t\t\t\t\torderId: this.orderId,\n\t\t\t\t\t\tpaymentId: this.paymentId,\n\t\t\t\t\t\taccess: this.accessCode,\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t).then((response) => {\n\t\t\t\tthis.response = response;\n\t\t\t\tresolve(this);\n\t\t\t}).catch((error) => {\n\t\t\t\tthis.response = error;\n\t\t\t\tresolve(this);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * @override\n\t * @returns {object|string|*}\n\t */\n\tgetResponse() {\n\t\treturn this.response;\n\t}\n\n\t/**\n\t * @override\n\t * @returns {boolean}\n\t */\n\tisResponseSucceed() {\n\t\treturn Type.isObject(this.response) && this.response.status === 'success';\n\t}\n\n\t/**\n\t * @override\n\t * @returns {string|null}\n\t */\n\tgetPaymentGateUrl() {\n\t\tif (Type.isObject(this.response.data) && Type.isStringFilled(this.response.data.url)) {\n\t\t\treturn this.response.data.url;\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * @override\n\t * @returns {string|null}\n\t */\n\tgetPaymentFormHtml() {\n\t\tif (Type.isObject(this.response.data) && Type.isStringFilled(this.response.data.html)) {\n\t\t\treturn this.response.data.html;\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * @private\n\t * @returns {string}\n\t */\n\tgetCurrentUrl() {\n\t\treturn window.location.href;\n\t}\n}\n"],"names":["BackendProvider","options","returnUrl","option","getCurrentUrl","orderId","paymentId","accessCode","paySystemId","response","Error","Promise","resolve","reject","ajax","runComponentAction","mode","data","paysystemId","access","then","catch","error","Type","isObject","status","isStringFilled","url","html","window","location","href","AbstractBackendProvider"],"mappings":";;;;;KAGaA,eAAb;CAAA;;CAEC,2BAAYC,OAAZ,EAAqB;CAAA;;CAAA;CACpB,iHAAMA,OAAN;CAEA,UAAKC,SAAL,GAAiB,MAAKC,MAAL,CAAY,WAAZ,EAAyB,MAAKC,aAAL,EAAzB,CAAjB;CACA,UAAKC,OAAL,GAAe,MAAKF,MAAL,CAAY,SAAZ,EAAuB,IAAvB,CAAf;CACA,UAAKG,SAAL,GAAiB,MAAKH,MAAL,CAAY,WAAZ,EAAyB,IAAzB,CAAjB;CACA,UAAKI,UAAL,GAAkB,MAAKJ,MAAL,CAAY,YAAZ,EAA0B,IAA1B,CAAlB;CACA,UAAKK,WAAL,GAAmB,IAAnB;CACA,UAAKC,QAAL,GAAgB,IAAhB;CARoB;CASpB;CAED;CACD;CACA;CACA;;;CAhBA;CAAA;CAAA,sCAiBmB;CAAA;;CACjB,UAAI,CAAC,KAAKD,WAAV,EAAuB;CACtB,cAAM,IAAIE,KAAJ,CAAU,0BAAV,CAAN;CACA;;CAED,aAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;CACvCC,QAAAA,cAAI,CAACC,kBAAL,CACC,gCADD,EAEC,aAFD,EAGC;CACCC,UAAAA,IAAI,EAAE,MADP;CAECC,UAAAA,IAAI,EAAE;CACLC,YAAAA,WAAW,EAAE,MAAI,CAACV,WADb;CAELN,YAAAA,SAAS,EAAE,MAAI,CAACA,SAFX;CAGLG,YAAAA,OAAO,EAAE,MAAI,CAACA,OAHT;CAILC,YAAAA,SAAS,EAAE,MAAI,CAACA,SAJX;CAKLa,YAAAA,MAAM,EAAE,MAAI,CAACZ;CALR;CAFP,SAHD,EAaEa,IAbF,CAaO,UAACX,QAAD,EAAc;CACpB,UAAA,MAAI,CAACA,QAAL,GAAgBA,QAAhB;CACAG,UAAAA,OAAO,CAAC,MAAD,CAAP;CACA,SAhBD,EAgBGS,KAhBH,CAgBS,UAACC,KAAD,EAAW;CACnB,UAAA,MAAI,CAACb,QAAL,GAAgBa,KAAhB;CACAV,UAAAA,OAAO,CAAC,MAAD,CAAP;CACA,SAnBD;CAoBA,OArBM,CAAP;CAsBA;CAED;CACD;CACA;CACA;;CAjDA;CAAA;CAAA,kCAkDe;CACb,aAAO,KAAKH,QAAZ;CACA;CAED;CACD;CACA;CACA;;CAzDA;CAAA;CAAA,wCA0DqB;CACnB,aAAOc,cAAI,CAACC,QAAL,CAAc,KAAKf,QAAnB,KAAgC,KAAKA,QAAL,CAAcgB,MAAd,KAAyB,SAAhE;CACA;CAED;CACD;CACA;CACA;;CAjEA;CAAA;CAAA,wCAkEqB;CACnB,UAAIF,cAAI,CAACC,QAAL,CAAc,KAAKf,QAAL,CAAcQ,IAA5B,KAAqCM,cAAI,CAACG,cAAL,CAAoB,KAAKjB,QAAL,CAAcQ,IAAd,CAAmBU,GAAvC,CAAzC,EAAsF;CACrF,eAAO,KAAKlB,QAAL,CAAcQ,IAAd,CAAmBU,GAA1B;CACA;;CACD,aAAO,IAAP;CACA;CAED;CACD;CACA;CACA;;CA5EA;CAAA;CAAA,yCA6EsB;CACpB,UAAIJ,cAAI,CAACC,QAAL,CAAc,KAAKf,QAAL,CAAcQ,IAA5B,KAAqCM,cAAI,CAACG,cAAL,CAAoB,KAAKjB,QAAL,CAAcQ,IAAd,CAAmBW,IAAvC,CAAzC,EAAuF;CACtF,eAAO,KAAKnB,QAAL,CAAcQ,IAAd,CAAmBW,IAA1B;CACA;;CACD,aAAO,IAAP;CACA;CAED;CACD;CACA;CACA;;CAvFA;CAAA;CAAA,oCAwFiB;CACf,aAAOC,MAAM,CAACC,QAAP,CAAgBC,IAAvB;CACA;CA1FF;CAAA;CAAA,EAAqCC,2CAArC;;;;;;;;"}