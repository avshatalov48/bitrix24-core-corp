{"version":3,"file":"backend-provider.bundle.js","sources":["../src/backend-provider.js"],"sourcesContent":["import {ajax, Type} from 'main.core';\nimport {AbstractBackendProvider} from 'sale.payment-pay.lib';\n\nexport class BackendProvider extends AbstractBackendProvider\n{\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.returnUrl = this.option('returnUrl', this.getCurrentUrl());\n\t\tthis.orderId = this.option('orderId', null);\n\t\tthis.paymentId = this.option('paymentId', null);\n\t\tthis.accessCode = this.option('accessCode', null);\n\t\tthis.paySystemId = null;\n\t\tthis.response = null;\n\t}\n\n\t/**\n\t * @override\n\t * @returns {Promise}\n\t */\n\tinitiatePayment() {\n\t\tif (!this.paySystemId) {\n\t\t\tthrow new Error('Payment system undefined');\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runComponentAction(\n\t\t\t\t'bitrix:salescenter.payment.pay',\n\t\t\t\t'initiatePay',\n\t\t\t\t{\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tpaySystemId: this.paySystemId,\n\t\t\t\t\t\t\treturnUrl: this.returnUrl,\n\t\t\t\t\t\t\torderId: this.orderId,\n\t\t\t\t\t\t\tpaymentId: this.paymentId,\n\t\t\t\t\t\t\taccessCode: this.accessCode,\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t).then((response) => {\n\t\t\t\tthis.response = response;\n\t\t\t\tresolve(this);\n\t\t\t}).catch((error) => {\n\t\t\t\tthis.response = error;\n\t\t\t\tresolve(this);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * @override\n\t * @returns {object|string|*}\n\t */\n\tgetResponse() {\n\t\treturn this.response;\n\t}\n\n\t/**\n\t * @override\n\t * @returns {boolean}\n\t */\n\tisResponseSucceed() {\n\t\treturn Type.isObject(this.response) && this.response.status === 'success';\n\t}\n\n\t/**\n\t * @override\n\t * @returns {string|null}\n\t */\n\tgetPaymentGateUrl() {\n\t\tif (Type.isObject(this.response.data) && Type.isStringFilled(this.response.data.url)) {\n\t\t\treturn this.response.data.url;\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * @override\n\t * @returns {string|null}\n\t */\n\tgetPaymentFormHtml() {\n\t\tif (Type.isObject(this.response.data) && Type.isStringFilled(this.response.data.html)) {\n\t\t\treturn this.response.data.html;\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * @private\n\t * @returns {string}\n\t */\n\tgetCurrentUrl() {\n\t\treturn window.location.href;\n\t}\n}\n"],"names":["BackendProvider","options","returnUrl","option","getCurrentUrl","orderId","paymentId","accessCode","paySystemId","response","Error","Promise","resolve","reject","ajax","runComponentAction","mode","data","fields","then","error","Type","isObject","status","isStringFilled","url","html","window","location","href","AbstractBackendProvider"],"mappings":";;;;;KAGaA,eAAb;GAAA;;GAEC,yBAAYC,OAAZ,EAAqB;KAAA;;KAAA;KACpB,6GAAMA,OAAN;KAEA,MAAKC,SAAL,GAAiB,MAAKC,MAAL,CAAY,WAAZ,EAAyB,MAAKC,aAAL,EAAzB,CAAjB;KACA,MAAKC,OAAL,GAAe,MAAKF,MAAL,CAAY,SAAZ,EAAuB,IAAvB,CAAf;KACA,MAAKG,SAAL,GAAiB,MAAKH,MAAL,CAAY,WAAZ,EAAyB,IAAzB,CAAjB;KACA,MAAKI,UAAL,GAAkB,MAAKJ,MAAL,CAAY,YAAZ,EAA0B,IAA1B,CAAlB;KACA,MAAKK,WAAL,GAAmB,IAAnB;KACA,MAAKC,QAAL,GAAgB,IAAhB;KARoB;;;CAYtB;CACA;CACA;;;GAhBA;KAAA;KAAA,kCAiBmB;OAAA;;OACjB,IAAI,CAAC,KAAKD,WAAV,EAAuB;SACtB,MAAM,IAAIE,KAAJ,CAAU,0BAAV,CAAN;;;OAGD,OAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;SACvCC,cAAI,CAACC,kBAAL,CACC,gCADD,EAEC,aAFD,EAGC;WACCC,IAAI,EAAE,MADP;WAECC,IAAI,EAAE;aACLC,MAAM,EAAE;eACPV,WAAW,EAAE,MAAI,CAACA,WADX;eAEPN,SAAS,EAAE,MAAI,CAACA,SAFT;eAGPG,OAAO,EAAE,MAAI,CAACA,OAHP;eAIPC,SAAS,EAAE,MAAI,CAACA,SAJT;eAKPC,UAAU,EAAE,MAAI,CAACA;;;UAXrB,EAeEY,IAfF,CAeO,UAACV,QAAD,EAAc;WACpB,MAAI,CAACA,QAAL,GAAgBA,QAAhB;WACAG,OAAO,CAAC,MAAD,CAAP;UAjBD,WAkBS,UAACQ,KAAD,EAAW;WACnB,MAAI,CAACX,QAAL,GAAgBW,KAAhB;WACAR,OAAO,CAAC,MAAD,CAAP;UApBD;QADM,CAAP;;;CA2BF;CACA;CACA;;;KAnDA;KAAA,8BAoDe;OACb,OAAO,KAAKH,QAAZ;;;CAIF;CACA;CACA;;;KA3DA;KAAA,oCA4DqB;OACnB,OAAOY,cAAI,CAACC,QAAL,CAAc,KAAKb,QAAnB,KAAgC,KAAKA,QAAL,CAAcc,MAAd,KAAyB,SAAhE;;;CAIF;CACA;CACA;;;KAnEA;KAAA,oCAoEqB;OACnB,IAAIF,cAAI,CAACC,QAAL,CAAc,KAAKb,QAAL,CAAcQ,IAA5B,KAAqCI,cAAI,CAACG,cAAL,CAAoB,KAAKf,QAAL,CAAcQ,IAAd,CAAmBQ,GAAvC,CAAzC,EAAsF;SACrF,OAAO,KAAKhB,QAAL,CAAcQ,IAAd,CAAmBQ,GAA1B;;;OAED,OAAO,IAAP;;;CAIF;CACA;CACA;;;KA9EA;KAAA,qCA+EsB;OACpB,IAAIJ,cAAI,CAACC,QAAL,CAAc,KAAKb,QAAL,CAAcQ,IAA5B,KAAqCI,cAAI,CAACG,cAAL,CAAoB,KAAKf,QAAL,CAAcQ,IAAd,CAAmBS,IAAvC,CAAzC,EAAuF;SACtF,OAAO,KAAKjB,QAAL,CAAcQ,IAAd,CAAmBS,IAA1B;;;OAED,OAAO,IAAP;;;CAIF;CACA;CACA;;;KAzFA;KAAA,gCA0FiB;OACf,OAAOC,MAAM,CAACC,QAAP,CAAgBC,IAAvB;;;GA3FF;CAAA,EAAqCC,2CAArC;;;;;;;;"}