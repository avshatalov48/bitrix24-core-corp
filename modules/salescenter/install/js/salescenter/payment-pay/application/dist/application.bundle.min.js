this.BX=this.BX||{};this.BX.Salescenter=this.BX.Salescenter||{};(function(t,e,n,s,a,i,o,r,l){"use strict";var d={props:{errors:Array},computed:{flattenErrorsList:function t(){var e=[];this.errors.map((function(t){t.map((function(t){return e.push(t)}))}));return e},loc:function t(){return i.BitrixVue.getFilteredPhrases("SPP_")}},template:'\n\t\t<div>\n\t\t\t<div class="alert alert-danger">\n\t\t\t\t<slot name="errors-header">\n\t\t\t\t\t<div>{{ loc.SPP_INITIATE_PAY_ERROR_TEXT_HEADER }}</div>\n\t\t\t\t</slot>\n\t\t\t\t<div v-for="error in flattenErrorsList">{{ error }}</div>\n\t\t\t\t<slot name="errors-footer">\n\t\t\t\t\t<div>{{ loc.SPP_INITIATE_PAY_ERROR_TEXT_FOOTER }}</div>\n\t\t\t\t</slot>\n\t\t\t</div>\n\t\t\t<slot></slot>\n\t\t</div>\n\t'};var c={props:{loading:{type:Boolean,default:false,required:false}},computed:{classes:function t(){return{"order-payment-method-item-button":true,btn:true,"btn-primary":true,"rounded-pill":true,"pay-mode":true,"order-payment-loader":this.loading}}},methods:{onClick:function t(e){this.$emit("click",e)}},template:'\n\t\t<div :class="classes" @click="onClick($event)">\n\t\t\t<slot></slot>\n\t\t</div>\n\t'};var m={components:{Button:c},methods:{reset:function t(){this.$emit("reset")}},computed:{loc:function t(){return i.BitrixVue.getFilteredPhrases("SPP_")}},template:'\n\t\t<div class="order-payment-buttons-container">\n\t\t\t<div class="order-basket-section-description py-3">\n\t\t\t\t{{ loc.SPP_EMPTY_TEMPLATE_FOOTER }}\n\t\t\t</div>\n\t\t\t<Button @click="reset()">\n\t\t\t\t{{ loc.SPP_PAY_RELOAD_BUTTON_NEW }}\n\t\t\t</Button>\n\t\t</div>\t\n\t'};var p={props:{html:{type:String,default:null,required:false},fields:{type:Object,default:null,required:false}},computed:{loc:function t(){return i.BitrixVue.getFilteredPhrases("SPP_")}},mounted:function t(){if(this.html){BX.html(this.$refs.paySystemResultTemplate,this.html)}},template:'\n\t\t<div>\n\t\t\t<template v-if="html">\n\t\t\t\t<div ref="paySystemResultTemplate"></div>\n\t\t\t\t<slot></slot>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div class="checkout-basket-section">\n\t\t\t\t\t<div class="page-section-title">{{ loc.SPP_EMPTY_TEMPLATE_TITLE }}</div>\n\t\t\t\t\t<div class="checkout-basket-personal-order-info" v-if="fields">\n\t\t\t\t\t\t<div class="checkout-basket-personal-order-info-item" v-if="fields.SUM_WITH_CURRENCY">\n\t\t\t\t\t\t\t<span>{{ loc.SPP_EMPTY_TEMPLATE_SUM_WITH_CURRENCY_FIELD }}</span> <strong v-html="fields.SUM_WITH_CURRENCY"></strong>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="checkout-basket-personal-order-info-item" v-if="fields.PAY_SYSTEM_NAME">\n\t\t\t\t\t\t\t<span>{{ loc.SPP_EMPTY_TEMPLATE_PAY_SYSTEM_NAME_FIELD }}</span> <strong>{{ fields.PAY_SYSTEM_NAME }}</strong>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t'};var y={props:{loading:Boolean,name:String,logo:String,id:Number},components:{Button:c},methods:{onClick:function t(){this.$emit("click",this.id)}},computed:{logoStyle:function t(){var e="/bitrix/js/salescenter/payment-pay/payment-method/images/default_logo.png";var n=this.logo||e;return'background-image: url("'.concat(BX.util.htmlspecialchars(n),'")')},loc:function t(){return i.BitrixVue.getFilteredPhrases("SPP_")}},template:'\n\t\t<div class="order-pay-method-item-container pay-mode" @click="onClick()">\n\t\t\t<div class="order-pay-method-item-logo-block">\n\t\t\t\t<div class="order-pay-method-logo" :style="logoStyle"></div>\n\t\t\t</div>\n\t\t\t<div class="order-pay-method-text-block">\n\t\t\t\t<div class="order-pay-method-text">{{ name }}</div>\n\t\t\t</div>\n\t\t\t<Button :loading="loading">{{ loc.SPP_PAY_BUTTON }}</Button>\n\t\t</div>\n\t'};var u={props:{paySystems:{type:Array,default:[],required:false},selectedPaySystem:{type:Number,default:null,required:false},loading:{type:Boolean,default:false,required:false},title:{type:String,default:null,required:false}},components:{PaySystemRow:y},methods:{isItemLoading:function t(e){return this.selectedPaySystem===e&&this.loading},startPayment:function t(e){this.$emit("start-payment",e)}},template:'\n\t\t<div>\n\t\t\t<div class="page-section-title" v-if="title">{{ title }}</div>\n\t\t\t<div class="order-payment-method-list">\n\t\t\t\t<slot>\n\t\t\t\t\t<PaySystemRow \n\t\t\t\t\t\tv-for="paySystem in paySystems"\n\t\t\t\t\t\t:loading="isItemLoading(paySystem.ID)"\n\t\t\t\t\t\t:name="paySystem.NAME"\n\t\t\t\t\t\t:logo="paySystem.LOGOTIP"\n\t\t\t\t\t\t:id="paySystem.ID"\n\t\t\t\t\t\t@click="startPayment($event)"\n\t\t\t\t\t/>\n\t\t\t\t</slot>\n\t\t\t</div>\n            <slot name="user-consent"></slot>\n\t\t</div>\n\t'};var v={props:{paySystems:{type:Array,default:[],required:false}},data:function t(){return{selectedPaySystem:null}},computed:{loc:function t(){return i.BitrixVue.getFilteredPhrases("SPP_")},selectedName:function t(){return this.selectedPaySystem?this.selectedPaySystem.NAME:""},selectedDescription:function t(){return this.selectedPaySystem?BX.util.htmlspecialchars(this.selectedPaySystem.DESCRIPTION):""}},methods:{showInfo:function t(e){this.selectedPaySystem=e},logoStyle:function t(e){var n="/bitrix/js/salescenter/payment-pay/payment-method/images/default_logo.png";var s=e.LOGOTIP||n;return'background-image: url("'.concat(BX.util.htmlspecialchars(s),'")')}},template:'\n\t\t<div>\n\t\t\t<div class="order-payment-method-list">\n\t\t\t\t<slot>\n\t\t\t\t\t<div class="order-pay-method-item-container info-mode" v-for="paySystem in paySystems">\n\t\t\t\t\t\t<div class="order-pay-method-item-logo-block">\n\t\t\t\t\t\t\t<div class="order-pay-method-logo" :style="logoStyle(paySystem)"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="order-pay-method-text-block">\n\t\t\t\t\t\t\t<div class="order-pay-method-text">{{ paySystem.NAME }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="btn info-mode" @click="showInfo(paySystem)">{{ loc.SPP_INFO_BUTTON }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</slot>\n\t\t\t</div>\n\t\t\t<div class="order-payment-method-description" v-if="selectedPaySystem">\n\t\t\t\t<div class="order-payment-method-description-title">{{ selectedName }}</div>\n\t\t\t\t<div class="order-payment-method-description-text" v-html="selectedDescription"></div>\n\t\t\t</div>\n\t\t</div>\n\t'};var h={props:{status:{type:String,default:"",required:false},link:{type:String,default:"",required:false},title:{type:String,required:true}},computed:{processing:function t(){return this.status==="P"},downloadable:function t(){return this.status==="Y"&&this.link!==""}},template:'\n\t\t<div class="mb-2" :class="{\'check-print\': processing}">\n\t\t\t<a :href="link" target="_blank" class="check-link" v-if="downloadable">{{ title }}</a>\n\t\t\t<span v-else>{{ title }}</span>\n\t\t</div>\n\t'};var f={props:{logo:String,name:String},template:'\n\t\t<div class="order-payment-operator">\n\t\t\t<img :src="logo" :alt="name" v-if="logo">\n\t\t\t<div class="order-payment-pay-system-name" v-else>{{ name }}</div>\n\t\t</div>\n\t'};var S={props:{loading:{type:Boolean,default:false,required:false}},computed:{classes:function t(){var t=["landing-block-node-button","text-uppercase","btn","btn-xl","pr-7","pl-7","u-btn-primary","g-font-weight-700","g-font-size-12","g-rounded-50"];if(this.loading){t.push("loading")}return t}},methods:{onClick:function t(e){this.$emit("click",e)}},template:'\n\t\t<button :class="classes" @click="onClick($event)">\n\t\t\t<slot></slot>\n\t\t</button>\n\t'};var P={props:{paySystem:Object,title:String,sum:String,loading:Boolean,paid:Boolean,checks:Array},components:{Check:h,PaySystemCard:f,Button:S},methods:{onClick:function t(){this.$emit("start-payment",this.paySystem.ID)}},computed:{loc:function t(){return i.BitrixVue.getFilteredPhrases("SPP_")},totalSum:function t(){return this.loc.SPP_SUM.replace("#SUM#",this.sum)}},template:'\n\t\t<div>\n\t\t\t<div class="order-payment-title" v-if="title">{{ title }}</div>\n\t\t\t<div class="order-payment-inner d-flex align-items-center justify-content-between">\n\t\t\t\t<PaySystemCard :name="paySystem.NAME" :logo="paySystem.LOGOTIP"/>\n            \t<div class="order-payment-status d-flex align-items-center" v-if="paid">\n                \t<div class="order-payment-status-ok"></div>\n                \t<div>{{ loc.SPP_PAID }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="order-payment-price" v-html="totalSum"></div>\n\t\t\t</div>\n\t\t\t<hr v-if="checks.length > 0">\n\t\t\t<Check \n\t\t\t\tv-for="check in checks" \n\t\t\t\t:title="check.title" \n\t\t\t\t:link="check.link" \n\t\t\t\t:status="check.status"/>\n\t\t\t<hr v-if="!paid">\n            <slot name="user-consent" v-if="!paid"></slot>\n\t\t\t<div class="order-payment-buttons-container" v-if="!paid">\n\t\t\t\t<Button\n\t\t\t\t\t:loading="loading"\n\t\t\t\t\t@click="onClick()">\n\t\t\t\t\t{{ loc.SPP_PAY_BUTTON }}\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\t'};var g;var E={props:{id:{type:Number,required:true},title:{type:String,required:true},submitEventName:{type:String,required:true},checked:{type:Boolean,default:false,required:false}},methods:{loadBlockHtml:function t(){var e=this;var n={fields:{id:this.id,title:this.title,isChecked:this.checked?"Y":"N",submitEventName:this.submitEventName}};o.ajax.runComponentAction("bitrix:salescenter.payment.pay","userConsentRequest",{mode:"ajax",data:n}).then((function(t){if(!o.Type.isPlainObject(t.data)||!o.Type.isStringFilled(t.data.html)||!BX.UserConsent){return}var n,s,a;n=t.data.html;s=e.$refs.consentDiv;s.appendChild(o.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(["<div>","</div>"])),n));a=BX.UserConsent.load(s);r.EventEmitter.subscribe(a,BX.UserConsent.events.accepted,(function(t){r.EventEmitter.emit(l.EventType.consent.accepted)}));r.EventEmitter.subscribe(a,BX.UserConsent.events.refused,(function(t){r.EventEmitter.emit(l.EventType.consent.refused)}))}))}},mounted:function t(){this.loadBlockHtml()},template:'\n\t\t<div>\n        \t<div ref="consentDiv"/>\n\t\t</div>\n\t'};i.BitrixVue.component("salescenter-payment-pay-app",{props:{options:Object},mixins:[s.OptionMixin],components:{ErrorBox:d,ResetPanel:m,PaySystemResult:p,PaySystemList:u,PaySystemInfo:v,PaymentInfo:P,UserConsentComponent:E},data:function t(){return{stages:this.getStageDefaults(),stage:this.getDefaultStage(),loading:false,consent:{id:this.option("consent.id"),title:this.option("consent.title"),eventName:this.option("consent.eventName"),accepted:this.option("consent.accepted")}}},created:function t(){this.initPaymentProcess();this.initUserConsent();this.subscribeToGlobalEvents()},methods:{initPaymentProcess:function t(){this.backendProvider=new a.BackendProvider({returnUrl:this.option("paymentProcess.returnUrl"),orderId:this.option("paymentProcess.orderId"),paymentId:this.option("paymentProcess.paymentId"),accessCode:this.option("paymentProcess.accessCode")});this.paymentProcess=new e.PaymentProcess({backendProvider:this.backendProvider,allowPaymentRedirect:this.option("paymentProcess.allowPaymentRedirect")})},initUserConsent:function t(){this.userConsentManager=new n.UserConsent({containerId:this.option("consent.containerId"),accepted:this.option("consent.accepted",false),eventName:this.option("consent.eventName",false)})},subscribeToGlobalEvents:function t(){var e=this;r.EventEmitter.subscribe(l.EventType.payment.error,(function(t){e.handlePaymentError(t.getData())}));r.EventEmitter.subscribe(l.EventType.payment.success,(function(t){e.handlePaymentSuccess(t.getData())}));r.EventEmitter.subscribe(l.EventType.global.paySystemAjaxError,(function(t){e.handlePaySystemAjaxError(t.getData())}));r.EventEmitter.subscribe(l.EventType.global.paySystemUpdateTemplate,(function(t){e.handlePaySystemUpdateTemplate(t.getData())}))},startPayment:function t(e){var n=this;if(this.loading){return false}this.userConsentManager.askUserToPerform((function(){n.loading=true;n.stages.paySystemList.selectedPaySystem=e;n.backendProvider.paySystemId=e;n.paymentProcess.start()}))},handlePaymentError:function t(e){this.stages.paySystemErrors.errors=e.data.errors||[];this.stage="paySystemErrors"},handlePaymentSuccess:function t(e){this.stages.paySystemResult.html=e.data.html||null;this.stages.paySystemResult.fields=e.data.fields||null;this.stage="paySystemResult"},handlePaySystemAjaxError:function t(e){this.stages.paySystemErrors.errors=e||[];this.stage="paySystemErrors"},handlePaySystemUpdateTemplate:function t(n){e.VirtualForm.createFromNode(this.$el).submit()},resetView:function t(){this.stages=this.getStageDefaults();this.stage=this.getDefaultStage();this.loading=false},getStageDefaults:function t(){return{paySystemList:{paySystems:this.option("app.paySystems",[]),selectedPaySystem:null,title:this.option("app.title")},paySystemInfo:{paySystems:this.option("app.paySystems",[])},paymentInfo:{paySystem:this.option("app.paySystems",[])[0],title:this.option("app.title"),sum:this.option("payment.sumFormatted"),paid:this.option("payment.paid"),checks:this.option("payment.checks",[])},paySystemErrors:{errors:[]},paySystemResult:{html:null,fields:null}}},getDefaultStage:function t(){return this.option("app.template","paySystemList")}},template:'\n\t\t<div class="salescenter-payment-pay-app">\n\t\t\t<PaySystemList \n\t\t\t\tv-if="stage === \'paySystemList\'"\n\t\t\t\t:paySystems="stages.paySystemList.paySystems"\n\t\t\t\t:selectedPaySystem="stages.paySystemList.selectedPaySystem"\n\t\t\t\t:loading="loading"\n\t\t\t\t:title="stages.paySystemList.title"\n\t\t\t\t@start-payment="startPayment($event)">\n\t\t\t\t<template v-slot:user-consent>\n\t\t\t\t\t<UserConsentComponent \n\t\t\t\t\t\t:id="consent.id"\n\t\t\t\t\t\t:title="consent.title"\n\t\t\t\t\t\t:checked="consent.accepted"\n\t\t\t\t\t\t:submitEventName="consent.eventName"/>\n                </template>\n\t\t\t</PaySystemList>\n\t\t\t<PaySystemInfo\n\t\t\t\tv-if="stage === \'paySystemInfo\'"\n\t\t\t\t:paySystems="stages.paySystemInfo.paySystems">\n\t\t\t</PaySystemInfo>\n\t\t\t<PaymentInfo \n\t\t\t\tv-if="stage === \'paymentInfo\'"\n\t\t\t\t:paySystem="stages.paymentInfo.paySystem"\n                :title="stages.paymentInfo.title"\n\t\t\t\t:sum="stages.paymentInfo.sum"\n\t\t\t\t:paid="stages.paymentInfo.paid"\n\t\t\t\t:loading="loading"\n\t\t\t\t:checks="stages.paymentInfo.checks"\n                @start-payment="startPayment($event)">\n              \t<template v-slot:user-consent>\n                \t<UserConsentComponent\n                    \t:id="consent.id"\n                    \t:title="consent.title"\n                    \t:checked="consent.accepted"\n                    \t:submitEventName="consent.eventName"/>\n              \t</template>\n\t\t\t</PaymentInfo>\n\t\t\t<ErrorBox\n\t\t\t\tv-if="stage === \'paySystemErrors\'" \n\t\t\t\t:errors="stages.paySystemErrors.errors">\n\t\t\t\t<ResetPanel @reset="resetView()"/>\n\t\t\t</ErrorBox>\n\t\t\t<PaySystemResult\n\t\t\t\tv-if="stage === \'paySystemResult\'" \n\t\t\t\t:html="stages.paySystemResult.html" \n\t\t\t\t:fields="stages.paySystemResult.fields">\n\t\t\t\t<ResetPanel @reset="resetView()"/>\n\t\t\t</PaySystemResult>\n\t\t</div>\n\t'})})(this.BX.Salescenter.PaymentPay=this.BX.Salescenter.PaymentPay||{},BX.Sale.PaymentPay.Lib,BX.Salescenter.PaymentPay,BX.Salescenter.PaymentPay.Mixins,BX.Salescenter.PaymentPay,BX,BX,BX.Event,BX.Sale.PaymentPay.Const);
//# sourceMappingURL=application.bundle.map.js