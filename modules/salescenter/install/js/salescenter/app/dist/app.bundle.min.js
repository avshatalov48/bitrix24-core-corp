this.BX=this.BX||{};(function(t,e,n,s,i,a,r,o,l,c,d,u,p,m,h,f,v,g,y,b,S,P,E){"use strict";P=P&&P.hasOwnProperty("default")?P["default"]:P;function I(t){return function(){var e=babelHelpers.getPrototypeOf(t),n;if(T()){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(e,arguments,s)}else{n=e.apply(this,arguments)}return babelHelpers.possibleConstructorReturn(this,n)}}function T(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(t){return false}}var C=function(t){babelHelpers.inherits(n,t);var e=I(n);function n(){babelHelpers.classCallCheck(this,n);return e.apply(this,arguments)}babelHelpers.createClass(n,[{key:"getName",value:function t(){return"application"}},{key:"getState",value:function t(){return{pages:[]}}},{key:"getGetters",value:function t(){return{getPages:function t(e){return function(){return e.pages}}}}},{key:"getMutations",value:function t(){var e=this;return{setPages:function t(n,s){if(babelHelpers.typeof(s.pages)==="object"){n.pages=s.pages;e.saveState(n)}},removePage:function t(n,s){if(babelHelpers.typeof(s.page)==="object"){n.pages=n.pages.filter(function(t){return!(s.page.id&&s.page.id>0&&t.id===s.page.id||s.page.landingId&&s.page.landingId>0&&t.landingId===s.page.landingId)});e.saveState(n)}},addPage:function t(n,s){if(babelHelpers.typeof(s.page)==="object"){n.pages.push(s.page);e.saveState(n)}}}}}]);return n}(b.VuexBuilderModel);function k(t){return function(){var e=babelHelpers.getPrototypeOf(t),n;if(A()){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(e,arguments,s)}else{n=e.apply(this,arguments)}return babelHelpers.possibleConstructorReturn(this,n)}}function A(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(t){return false}}var x=function(t){babelHelpers.inherits(n,t);var e=k(n);function n(){babelHelpers.classCallCheck(this,n);return e.apply(this,arguments)}babelHelpers.createClass(n,[{key:"getName",value:function t(){return"orderCreation"}},{key:"getState",value:function t(){return{currency:"",processingId:null,showPaySystemSettingBanner:false,selectedProducts:[],basket:[],propertyValues:[],deliveryExtraServicesValues:[],expectedDelivery:null,deliveryResponsibleId:null,personTypeId:null,deliveryId:null,delivery:null,errors:[],total:{sum:null,discount:null,result:null,resultNumeric:null}}}},{key:"getActions",value:function t(){return{refreshBasket:function t(e,n){var s=e.commit,i=e.dispatch,a=e.state;if(this.updateTimer){clearTimeout(this.updateTimer)}this.updateTimer=setTimeout(function(){var t=Math.random()*1e5;s("setProcessingId",t);BX.ajax.runAction("salescenter.api.order.refreshBasket",{data:{basketItems:a.basket}}).then(function(e){if(t===a.processingId){var s=BX.prop.getObject(e,"data",{});i("processRefreshRequest",{total:BX.prop.getObject(s,"total",{sum:0,discount:0,result:0,resultNumeric:0}),basket:BX.prop.get(s,"items",[])});if(n.onsuccess){n.onsuccess()}}}).catch(function(e){if(t===a.processingId){var s=BX.prop.getObject(e,"data",{});i("processRefreshRequest",{errors:BX.prop.get(e,"errors",[]),basket:BX.prop.get(s,"items",[])});if(n.onfailure){n.onfailure()}}})},0)},processRefreshRequest:function t(e,n){var s=e.commit,i=e.dispatch;if(BX.type.isArray(n.basket)){n.basket.forEach(function(t){s("updateBasketItem",{index:t.sort,fields:t})});s("setSelectedProducts")}if(BX.type.isObject(n.total)){s("setTotal",n.total)}if(BX.type.isArray(n.errors)){s("setErrors",n.errors)}else{s("clearErrors")}s("setProcessingId",null)},resetBasket:function t(e){var n=e.commit;n("clearBasket");n("setTotal",{sum:null,discount:null,result:null,resultNumeric:null});n("addBasketItem")},deleteBasketItem:function t(e,n){var s=e.commit,i=e.state,a=e.dispatch;s("deleteBasketItem",n);if(i.basket.length>0){i.basket.forEach(function(t,e){s("updateBasketItem",{index:e,fields:{sort:e}})})}a("refreshBasket")},removeItem:function t(e,n){var s=e.commit,i=e.state,a=e.dispatch;s("deleteBasketItem",n);if(i.basket.length===0){s("addBasketItem")}else{i.basket.forEach(function(t,e){s("updateBasketItem",{index:e,fields:{sort:e}})})}a("refreshBasket")},changeBasketItem:function t(e,n){var s=e.commit,i=e.dispatch;s("updateBasketItem",n);s("setSelectedProducts")},setCurrency:function t(e,n){var s=e.commit;var i=n||"";s("setCurrency",i)},setDeliveryId:function t(e,n){var s=e.commit;s("setDeliveryId",n)},setDelivery:function t(e,n){var s=e.commit;s("setDelivery",n)},setPropertyValues:function t(e,n){var s=e.commit;s("setPropertyValues",n)},setDeliveryExtraServicesValues:function t(e,n){var s=e.commit;s("setDeliveryExtraServicesValues",n)},setExpectedDelivery:function t(e,n){var s=e.commit;s("setExpectedDelivery",n)},setDeliveryResponsibleId:function t(e,n){var s=e.commit;s("setDeliveryResponsibleId",n)},setPersonTypeId:function t(e,n){var s=e.commit;s("setPersonTypeId",n)}}}},{key:"getGetters",value:function t(){return{getBasket:function t(e){return function(t){return e.basket}},isAllowedSubmit:function t(e){return e.basket.filter(function(t){return t.module==="catalog"&&parseInt(t.productId)>0||t.module!=="catalog"&&BX.type.isNotEmptyString(t.name)&&parseFloat(t.quantity)>0}).length>0},getTotal:function t(e){return e.total},getDelivery:function t(e){return e.delivery},getDeliveryId:function t(e){return e.deliveryId},getPropertyValues:function t(e){return e.propertyValues},getDeliveryExtraServicesValues:function t(e){return e.deliveryExtraServicesValues},getExpectedDelivery:function t(e){return e.expectedDelivery},getDeliveryResponsibleId:function t(e){return e.deliveryResponsibleId},getPersonTypeId:function t(e){return e.personTypeId}}}},{key:"getMutations",value:function t(){return{addBasketItem:function t(e,s){var i=n.getBasketItemState();i.sort=e.basket.length;e.basket.push(i)},updateBasketItem:function t(e,s){if(typeof e.basket[s.index]==="undefined"){E.Vue.set(e.basket,s.index,n.getBasketItemState())}e.basket[s.index]=Object.assign(e.basket[s.index],s.fields)},clearBasket:function t(e){e.basket=[]},deleteBasketItem:function t(e,n){e.basket.splice(n.index,1)},setSelectedProducts:function t(e){e.selectedProducts=e.basket.filter(function(t){return t.module==="catalog"&&parseInt(t.productId)>0}).map(function(t){return t.productId})},setTotal:function t(e,n){e.total=Object.assign(e.total,n)},setErrors:function t(e,n){e.errors=n},setDeliveryId:function t(e,n){e.deliveryId=n},setDelivery:function t(e,n){e.delivery=n},setPropertyValues:function t(e,n){e.propertyValues=n},setDeliveryExtraServicesValues:function t(e,n){e.deliveryExtraServicesValues=n},setExpectedDelivery:function t(e,n){e.expectedDelivery=n},setDeliveryResponsibleId:function t(e,n){e.deliveryResponsibleId=n},clearErrors:function t(e){e.errors=[]},setProcessingId:function t(e,n){e.processingId=n},setCurrency:function t(e,n){e.currency=n},setPersonTypeId:function t(e,n){e.personTypeId=n},showBanner:function t(e){e.showPaySystemSettingBanner=true},hideBanner:function t(e){e.showPaySystemSettingBanner=false}}}}],[{key:"getBasketItemState",value:function t(){return{productId:null,code:null,name:"",sort:0,price:0,basePrice:0,quantity:0,showDiscount:"",discount:0,discountInfos:[],discountType:"percent",module:null,measureCode:0,measureName:"",taxRate:0,taxIncluded:"N",isCustomPrice:"N",isCreatedProduct:"N",encodedFields:null,image:[],errors:[]}}}]);return n}(b.VuexBuilderModel);var _=Object.freeze({databaseConfig:{name:"salescenter.app"},templateName:"bx-salescenter-app",templateAddPaymentName:"bx-salescenter-app-add-payment",templateAddPaymentProductName:"bx-salescenter-app-add-payment-product",templateAddPaymentBySms:"bx-salescenter-app-add-payment-by-sms",templateAddPaymentBySmsItem:"bx-salescenter-app-add-payment-by-sms-item",moduleId:"salescenter"});var w={data:function t(){return{editable:true}},created:function t(){var e=this;this.$root.$on("on-change-editable",function(t){e.editable=t})}};function L(t){if(typeof Symbol==="undefined"||t[Symbol.iterator]==null){if(Array.isArray(t)||(t=B(t))){var e=0;var n=function t(){};return{s:n,n:function n(){if(e>=t.length)return{done:true};return{done:false,value:t[e++]}},e:function t(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=true,a=false,r;return{s:function e(){s=t[Symbol.iterator]()},n:function t(){var e=s.next();i=e.done;return e},e:function t(e){a=true;r=e},f:function t(){try{if(!i&&s.return!=null)s.return()}finally{if(a)throw r}}}}function B(t,e){if(!t)return;if(typeof t==="string")return D(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(t,e)}function D(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,s=new Array(e);n<e;n++){s[n]=t[n]}return s}E.Vue.component(_.templateName,{mixins:[w],data:function t(){return{isShowPreview:false,isShowPayment:false,isShowPaymentBySms:false,isShowPaymentByEmail:false,isShowPaymentByCash:false,isShowPaymentByQr:false,pageTitle:"",currentPageId:null,actions:[],frameCheckShortTimeout:false,frameCheckLongTimeout:false,isPagesOpen:false,isFormsOpen:false,showedPageIds:[],loadedPageIds:[],errorPageIds:[],lastAddedPages:[],ordersCount:null,editedPageId:null,isOrderPublicUrlAvailable:null,currentPageTitle:null}},created:function t(){var e=this;this.$root.$on("on-show-company-contacts",function(t){e.showCompanyContacts(t)})},updated:function t(){this.renderErrors()},mounted:function t(){var e=this;this.createPinner();if(this.$root.$app.context==="deal"){this.showPaymentBySmsForm()}else{this.createLoader();this.$root.$app.fillPages().then(function(){e.refreshOrdersCount();e.openFirstPage()})}this.isOrderPublicUrlAvailable=this.$root.$app.isOrderPublicUrlAvailable;this.isOrderPublicUrlExists=this.$root.$app.isOrderPublicUrlExists;if(this.$root.$app.isPaymentsLimitReached){var n=this.$root.$nodes.paymentsLimit;var s=this.$refs["paymentsLimit"];var i=L(n.children),a;try{for(i.s();!(a=i.n()).done;){var r=a.value;s.appendChild(r)}}catch(t){i.e(t)}finally{i.f()}}this.movePanels()},methods:{movePanels:function t(){var e=this.$refs["sidebar"];var n=this.$root.$nodes.leftPanel;if(!n){n=this.$refs["leftSide"]}if(e&&n){var s=this.$refs["sidepanelNav"]}},createPinner:function t(){var e=this.$refs["buttonsPanel"];if(e){this.$root.$el.parentNode.appendChild(e);new BX.UI.Pinner(e,{fixBottom:this.$root.$app.isFrame,fullWidth:this.$root.$app.isFrame})}},getActions:function t(){var e=[];if(this.currentPage){e=[{text:this.localize.SALESCENTER_RIGHT_ACTION_COPY_URL,onclick:this.copyUrl}];if(this.currentPage.landingId>0){e=[].concat(babelHelpers.toConsumableArray(e),[{text:this.localize.SALESCENTER_RIGHT_ACTION_HIDE,onclick:this.hidePage}])}else{e=[].concat(babelHelpers.toConsumableArray(e),[{text:this.localize.SALESCENTER_RIGHT_ACTION_DELETE,onclick:this.hidePage}])}}return[].concat(babelHelpers.toConsumableArray(e),[{text:this.localize.SALESCENTER_RIGHT_ACTION_ADD,items:this.getAddPageActions()}])},getAddPageActions:function t(){var e=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return[{text:this.localize.SALESCENTER_RIGHT_ACTION_ADD_SITE_B24,onclick:function t(){e.addSite(n)}},{text:this.localize.SALESCENTER_RIGHT_ACTION_ADD_CUSTOM,onclick:function t(){e.showAddUrlPopup({isWebform:n===true?"Y":null})}}]},openFirstPage:function t(){this.isShowPayment=false;this.isShowPaymentBySms=false;this.isShowPreview=true;if(this.pages&&this.pages.length>0){var e=false;var n=false;this.pages.forEach(function(t){if(!n){if(!t.isWebform){n=t}else{e=t}}});if(!n&&e){n=e}if(this.currentPageId!==n.id){this.onPageClick(n);if(n.isWebform){this.isFormsOpen=true}else{this.isPagesOpen=true}}else{this.currentPageId=this.pages[0].id}}else{this.pageTitle=null;this.currentPageId=null;this.setPageTitle(this.pageTitle)}},onPageClick:function t(e){this.pageTitle=e.name;this.currentPageId=e.id;this.hideActionsPopup();this.isShowPayment=false;this.isShowPaymentBySms=false;this.isShowPreview=true;this.setPageTitle(this.pageTitle);if(e.isFrameDenied!==true){if(!this.showedPageIds.includes(e.id)){this.startFrameCheckTimeout();this.showedPageIds.push(e.id)}}else{this.onFrameError()}},showActionsPopup:function t(e){var n=e.target;BX.PopupMenu.show("salescenter-app-actions",n,this.getActions(),{offsetLeft:0,offsetTop:0,closeByEsc:true})},showCompanyContacts:function t(e){var n=e.target;BX.Salescenter.Manager.openSlider(this.$root.$app.options.urlSettingsCompanyContacts,{})},showAddPageActionPopup:function t(e){var n=e.target;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var i="salescenter-app-add-page-actions";if(s){i+="-forms"}BX.PopupMenu.show(i,n,this.getAddPageActions(s),{offsetLeft:n.offsetWidth+20,offsetTop:-n.offsetHeight-15,closeByEsc:true,angle:{position:"left"}})},hideActionsPopup:function t(){BX.PopupMenu.destroy("salescenter-app-actions");BX.PopupMenu.destroy("salescenter-app-add-page-actions")},addSite:function t(){var e=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;y.Manager.addSitePage(n).then(function(t){var n=t.answer.result.page||false;e.$root.$app.fillPages().then(function(){if(n){e.onPageClick(n);e.lastAddedPages.push(parseInt(n.id))}else{e.openFirstPage()}})});this.hideActionsPopup()},copyUrl:function t(e){if(this.currentPage&&this.currentPage.url){y.Manager.copyUrl(this.currentPage.url,e);this.hideActionsPopup()}},editPage:function t(){if(this.currentPage){if(this.currentPage.landingId&&this.currentPage.landingId>0){y.Manager.editLandingPage(this.currentPage.landingId,this.currentPage.siteId);this.hideActionsPopup()}else{this.showAddUrlPopup(this.currentPage)}}},hidePage:function t(){var e=this;if(this.currentPage){this.$root.$app.hidePage(this.currentPage).then(function(){e.openFirstPage()});this.hideActionsPopup()}},showAddUrlPopup:function t(e){var n=this;if(!S.Type.isPlainObject(e)){e={}}y.Manager.addCustomPage(e).then(function(t){if(!n.isShowPreview){n.isShowPreview=false}n.$root.$app.fillPages().then(function(){if(t&&(!S.Type.isPlainObject(e)||!e.id)){n.lastAddedPages.push(parseInt(t))}if(!t&&e){t=e.id}if(t){n.pages.forEach(function(e){if(parseInt(e.id)===parseInt(t)){n.onPageClick(e)}})}else{if(!n.isShowPayment||!n.isShowPaymentBySms){n.isShowPreview=true}}})});this.hideActionsPopup()},showPaymentForm:function t(){this.isShowPayment=true;this.isShowPaymentBySms=false;this.isShowPreview=false;if(this.isOrderPublicUrlAvailable){this.setPageTitle(this.localize.SALESCENTER_LEFT_PAYMENT_ADD)}else{this.setPageTitle(this.localize.SALESCENTER_DEFAULT_TITLE)}},showPaymentBySmsForm:function t(){this.isShowPayment=false;this.isShowPaymentBySms=true;this.isShowPreview=false;this.currentPageTitle=this.$root.$app.options.title;if(this.isOrderPublicUrlAvailable){var e=this.localize.SALESCENTER_LEFT_PAYMENT_BY_SMS;if(this.currentPageTitle){e=this.currentPageTitle}this.setPageTitle(e)}else{this.setPageTitle(this.localize.SALESCENTER_DEFAULT_TITLE)}},showOrdersList:function t(){var e=this;this.hideActionsPopup();y.Manager.showOrdersList({ownerId:this.$root.$app.ownerId,ownerTypeId:this.$root.$app.ownerTypeId}).then(function(){e.refreshOrdersCount()})},showOrderAdd:function t(){var e=this;this.hideActionsPopup();y.Manager.showOrderAdd({ownerId:this.$root.$app.ownerId,ownerTypeId:this.$root.$app.ownerTypeId}).then(function(){e.refreshOrdersCount()})},showCatalog:function t(){this.hideActionsPopup();y.Manager.openSlider("/saleshub/catalog/?sessionId=".concat(this.$root.$app.sessionId))},onFormsClick:function t(){this.isFormsOpen=!this.isFormsOpen;this.hideActionsPopup()},openControlPanel:function t(){y.Manager.openControlPanel();this.hideActionsPopup()},openHelpDesk:function t(){this.hideActionsPopup();y.Manager.openHowItWorks()},isPageSelected:function t(e){return this.currentPage&&this.isShowPreview&&this.currentPage.id===e.id},send:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"n";if(!this.isAllowedSubmitButton){return}if((this.isShowPayment||this.isShowPaymentBySms)&&!this.isShowStartInfo){if(this.editable){this.$root.$app.sendPayment(e.target,n)}else{this.$root.$app.resendPayment(e.target)}}else if(this.currentPage&&this.currentPage.isActive){this.$root.$app.sendPage(this.currentPage.id)}},close:function t(){this.$root.$app.closeApplication()},setPageTitle:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!e){return}if(this.$root.$nodes.title){this.$root.$nodes.title.innerText=e}},onFrameError:function t(){clearTimeout(this.frameCheckLongTimeout);if(this.showedPageIds.includes(this.currentPage.id)){this.loadedPageIds.push(this.currentPage.id)}this.errorPageIds.push(this.currentPage.id)},onFrameLoad:function t(e){var n=this;clearTimeout(this.frameCheckLongTimeout);if(this.showedPageIds.includes(e)){this.loadedPageIds.push(e);if(this.currentPage&&this.currentPage.id===e){if(this.frameCheckShortTimeout&&!this.currentPage.landingId){this.onFrameError()}else if(this.errorPageIds.includes(this.currentPage.id)){this.errorPageIds=this.errorPageIds.filter(function(t){return t!==n.currentPage.id})}}}if(this.frameCheckShortTimeout&&this.currentPage&&this.currentPage.id===e&&!this.currentPage.landingId){this.onFrameError()}},startFrameCheckTimeout:function t(){var e=this;if(this.frameCheckShortTimeout){clearTimeout(this.frameCheckShortTimeout);this.frameCheckShortTimeout=false}this.frameCheckShortTimeout=setTimeout(function(){e.frameCheckShortTimeout=false},500);clearTimeout(this.frameCheckLongTimeout);this.frameCheckLongTimeout=setTimeout(function(){if(e.currentPage&&e.showedPageIds.includes(e.currentPage.id)&&!e.loadedPageIds.includes(e.currentPage.id)){e.errorPageIds.push(e.currentPage.id)}},5e3)},connect:function t(){var e=this;var n=new BX.Loader({size:200});n.show(document.body);BX.Salescenter.Manager.connect({no_redirect:"Y",context:this.$root.$app.context}).then(function(){BX.Salescenter.Manager.loadConfig().then(function(t){n.hide();if(t.isSiteExists){e.$root.$app.isSiteExists=t.isSiteExists;e.isSiteExists=t.isSiteExists;e.$root.$app.fillPages().then(function(){e.isOrderPublicUrlExists=true;e.$root.$app.isOrderPublicUrlExists=true;e.$root.$app.orderPublicUrl=t.orderPublicUrl;e.isOrderPublicUrlAvailable=t.isOrderPublicUrlAvailable;e.$root.$app.isOrderPublicUrlAvailable=t.isOrderPublicUrlAvailable;if(!e.isShowPayment&&!e.isShowPaymentBySms){e.openFirstPage()}else{if(e.isShowPaymentBySms){e.showPaymentBySmsForm()}else{e.showPaymentForm()}}})}})}).catch(function(){n.hide()})},checkRecycle:function t(){y.Manager.openConnectedSite(true)},openConnectedSite:function t(){y.Manager.openConnectedSite()},getFrameSource:function t(e){if(this.showedPageIds.includes(e.id)){if(e.landingId>0){if(e.isActive){return new S.Uri(e.url).setQueryParam("theme","").toString()}}else{return e.url}}return null},refreshOrdersCount:function t(){var e=this;this.$root.$app.getOrdersCount().then(function(t){e.ordersCount=t.answer.result||null}).catch(function(){e.ordersCount=null})},renderErrors:function t(){if(this.isShowPayment&&this.order.errors.length>0){var e=this.order.errors.map(function(t){return t.message}).join("<br>");var n={color:BX.UI.Alert.Color.DANGER,textCenter:true,text:BX.util.htmlspecialchars(e)};if(this.$refs.errorBlock.innerHTML.length===0){n.animated=true}var s=new BX.UI.Alert(n);this.$refs.errorBlock.innerHTML="";this.$refs.errorBlock.appendChild(s.getContainer())}else if(this.$refs.errorBlock){this.$refs.errorBlock.innerHTML=""}},editMenuItem:function t(e,n){this.editedPageId=n.id;setTimeout(function(){e.target.parentNode.parentNode.querySelector("input").focus()},50)},saveMenuItem:function t(e){var n=this;var s=this.editedPageId;var i=e.target.value;var a;this.pages.forEach(function(t){if(t.id===n.editedPageId){a=t.name}});if(s>0&&a&&i!==a&&i.length>0){y.Manager.addPage({id:s,name:i,analyticsLabel:"salescenterUpdatePageTitle"}).then(function(){n.$root.$app.fillPages().then(function(){if(n.editedPageId===n.currentPageId){n.setPageTitle(i)}n.editedPageId=null})})}else{this.editedPageId=null}},createLoader:function t(){var e=new s.Loader({size:200});e.show(this.$refs["previewLoader"])}},computed:babelHelpers.objectSpread({config:function t(){return _},currentPage:function t(){var e=this;if(this.currentPageId>0){var n=this.application.pages.filter(function(t){return t.id===e.currentPageId});if(n.length>0){return n[0]}}return null},pagesSubmenuHeight:function t(){if(this.isPagesOpen){return this.application.pages.filter(function(t){return!t.isWebform}).length*39+30+"px"}else{return"0px"}},formsSubmenuHeight:function t(){if(this.isFormsOpen){return this.application.pages.filter(function(t){return t.isWebform}).length*39+30+"px"}else{return"0px"}},isFrameError:function t(){if(this.isShowPreview&&this.currentPage){if(!this.currentPage.isActive){return true}else if(!this.currentPage.landingId&&this.errorPageIds.includes(this.currentPage.id)){return true}}return false},isShowLoader:function t(){return this.isShowPreview&&this.currentPageId>0&&this.showedPageIds.includes(this.currentPageId)&&!this.loadedPageIds.includes(this.currentPageId)},isShowStartInfo:function t(){var e=false;if(this.isShowPreview){e=!this.pages||this.pages.length<=0}else if(this.isShowPayment||this.isShowPaymentBySms){e=!this.isOrderPublicUrlAvailable}return e},getWrapperHeight:function t(){if(this.isShowPreview||this.isShowPayment||this.isShowPaymentBySms){var e=BX.pos(this.$root.$el);var n=e.top+20;if(this.$root.$nodes.footer){n+=BX.pos(this.$root.$nodes.footer).height}var s=this.$refs["buttonsPanel"];if(s){n+=BX.pos(s).height}return"calc(100vh - "+n+"px)"}else{return"auto"}},lastModified:function t(){if(this.currentPage&&this.currentPage.modifiedAgo){return this.localize.SALESCENTER_MODIFIED.replace("#AGO#",this.currentPage.modifiedAgo)}return false},localize:function t(){return E.Vue.getFilteredPhrases("SALESCENTER_")},pages:function t(){this.isOrderPublicUrlAvailable=this.$root.$app.isOrderPublicUrlAvailable;return babelHelpers.toConsumableArray(this.application.pages)},isAllowedSubmitButton:function t(){if(this.$root.$app.disableSendButton){return false}if(this.isShowPreview&&this.currentPage&&!this.currentPage.isActive){return false}if(this.isShowPayment||this.isShowPaymentBySms){if(this.isShowPaymentBySms&&this.$root.$app.options.contactPhone===""){return false}return this.$store.getters["orderCreation/isAllowedSubmit"]}return this.currentPage},isOrderPageDeleted:function t(){return this.$root.$app.isSiteExists&&!this.isOrderPublicUrlExists}},b.Vuex.mapState({application:function t(e){return e.application},order:function t(e){return e.orderCreation}})),template:'\n\t\t<div class="salescenter-app-wrapper" :style="{minHeight: getWrapperHeight}">\n\t\t\t<div class="ui-sidepanel-sidebar salescenter-app-sidebar" ref="sidebar">\n\t\t\t\t<ul class="ui-sidepanel-menu" ref="sidepanelMenu" v-if="this.$root.$app.context !== \'deal\'">\n\t\t\t\t\t<li :class="{\'salescenter-app-sidebar-menu-active\': isPagesOpen}" class="ui-sidepanel-menu-item">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link" @click.stop.prevent="isPagesOpen = !isPagesOpen;">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_PAGES}}</div>\n\t\t\t\t\t\t\t<div class="ui-sidepanel-toggle-btn">{{this.isPagesOpen ? this.localize.SALESCENTER_SUBMENU_CLOSE : this.localize.SALESCENTER_SUBMENU_OPEN}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<ul class="ui-sidepanel-submenu" :style="{height: pagesSubmenuHeight}">\n\t\t\t\t\t\t\t<li v-for="page in pages" v-if="!page.isWebform" :key="page.id"\n\t\t\t\t\t\t\t:class="{\n\t\t\t\t\t\t\t\t\'ui-sidepanel-submenu-active\': (currentPage && currentPage.id == page.id && isShowPreview),\n\t\t\t\t\t\t\t\t\'ui-sidepanel-submenu-edit-mode\': (editedPageId === page.id)\n\t\t\t\t\t\t\t}" class="ui-sidepanel-submenu-item">\n\t\t\t\t\t\t\t\t<a :title="page.name" class="ui-sidepanel-submenu-link" @click.stop="onPageClick(page)">\n\t\t\t\t\t\t\t\t\t<input class="ui-sidepanel-input" :value="page.name" v-on:keyup.enter="saveMenuItem($event)" @blur="saveMenuItem($event)" />\n\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{page.name}}</div>\n\t\t\t\t\t\t\t\t\t<div v-if="lastAddedPages.includes(page.id)" class="ui-sidepanel-badge-new"></div>\n\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-edit-btn"><span class="ui-sidepanel-edit-btn-icon" @click="editMenuItem($event, page);"></span></div>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="salescenter-app-helper-nav-item salescenter-app-menu-add-page" @click.stop="showAddPageActionPopup($event)">\n\t\t\t\t\t\t\t\t<span class="salescenter-app-helper-nav-item-text salescenter-app-helper-nav-item-add">+</span><span class="salescenter-app-helper-nav-item-text">{{localize.SALESCENTER_RIGHT_ACTION_ADD}}</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li v-if="this.$root.$app.isPaymentCreationAvailable" :class="{ \'salescenter-app-sidebar-menu-active\': this.isShowPayment}" class="ui-sidepanel-menu-item" @click="showPaymentForm">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_PAYMENT_ADD}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li @click="showOrdersList">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_ORDERS}}</div>\n\t\t\t\t\t\t\t<span class="ui-sidepanel-counter" ref="ordersCounter" v-show="ordersCount > 0">{{ordersCount}}</span>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li @click="showOrderAdd">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_ORDER_ADD}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li v-if="this.$root.$app.isCatalogAvailable" @click="showCatalog">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_CATALOG}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li :class="{\'salescenter-app-sidebar-menu-active\': isFormsOpen}" class="ui-sidepanel-menu-item">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link" @click.stop.prevent="onFormsClick();">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_FORMS_ALL}}</div>\n\t\t\t\t\t\t\t<div class="ui-sidepanel-toggle-btn">{{this.isPagesOpen ? this.localize.SALESCENTER_SUBMENU_CLOSE : this.localize.SALESCENTER_SUBMENU_OPEN}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<ul class="ui-sidepanel-submenu" :style="{height: formsSubmenuHeight}">\n\t\t\t\t\t\t\t<li v-for="page in pages" v-if="page.isWebform" :key="page.id"\n\t\t\t\t\t\t\t :class="{\n\t\t\t\t\t\t\t\t\'ui-sidepanel-submenu-active\': (currentPage && currentPage.id == page.id && isShowPreview),\n\t\t\t\t\t\t\t\t\'ui-sidepanel-submenu-edit-mode\': (editedPageId === page.id)\n\t\t\t\t\t\t\t}" class="ui-sidepanel-submenu-item">\n\t\t\t\t\t\t\t\t<a :title="page.name" class="ui-sidepanel-submenu-link" @click.stop="onPageClick(page)">\n\t\t\t\t\t\t\t\t\t<input class="ui-sidepanel-input" :value="page.name" v-on:keyup.enter="saveMenuItem($event)" @blur="saveMenuItem($event)" />\n\t\t\t\t\t\t\t\t\t<div v-if="lastAddedPages.includes(page.id)" class="ui-sidepanel-badge-new"></div>\n\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{page.name}}</div>\n\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-edit-btn"><span class="ui-sidepanel-edit-btn-icon" @click="editMenuItem($event, page);"></span></div>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="salescenter-app-helper-nav-item salescenter-app-menu-add-page" @click.stop="showAddPageActionPopup($event, true)">\n\t\t\t\t\t\t\t\t<span class="salescenter-app-helper-nav-item-text salescenter-app-helper-nav-item-add">+</span><span class="salescenter-app-helper-nav-item-text">{{localize.SALESCENTER_RIGHT_ACTION_ADD}}</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t\t<ul class="ui-sidepanel-menu" ref="sidepanelMenu" v-if="this.$root.$app.context === \'deal\'">\n\t\t\t\t\t<li v-if="this.$root.$app.isPaymentCreationAvailable" :class="{ \'salescenter-app-sidebar-menu-active\': this.isShowPaymentBySms}" class="ui-sidepanel-menu-item" @click="showPaymentBySmsForm">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_SEND_BY_SMS}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li class="ui-sidepanel-menu-item ui-sidepanel-menu-item-sm">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link" v-on:click="showCompanyContacts(event)">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_PAYMENT_COMPANY_CONTACTS}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li class="ui-sidepanel-menu-item ui-sidepanel-menu-item-sm">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link" v-on:click="BX.Salescenter.Manager.openFeedbackPayOrderForm(event)">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_PAYMENT_OFFER_SCRIPT}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li class="ui-sidepanel-menu-item ui-sidepanel-menu-item-sm">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link" v-on:click="BX.Salescenter.Manager.openHowPayDealWorks(event)">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_PAYMENT_HOW_WORKS}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t<div class="salescenter-app-right-side">\n\t\t\t\t<div class="salescenter-app-page-header" v-show="isShowPreview && !isShowStartInfo">\n\t\t\t\t\t<div class="salescenter-btn-action ui-btn ui-btn-link ui-btn-dropdown ui-btn-xs" @click="showActionsPopup($event)">{{localize.SALESCENTER_RIGHT_ACTIONS_BUTTON}}</div>\n\t\t\t\t\t<div class="salescenter-btn-delimiter salescenter-btn-action"></div>\n\t\t\t\t\t<div class="salescenter-btn-action ui-btn ui-btn-link ui-btn-xs ui-btn-icon-edit" @click="editPage">{{localize.SALESCENTER_RIGHT_ACTION_EDIT}}</div>\n\t\t\t\t</div>\n\t\t\t\t<template v-if="isShowStartInfo">\n\t\t\t\t\t<div class="salescenter-app-page-content salescenter-app-start-wrapper">\n\t\t\t\t\t\t<div class="ui-title-1 ui-text-center ui-color-medium" style="margin-bottom: 20px;">{{localize.SALESCENTER_INFO_TEXT_TOP_2}}</div>\n\t\t\t\t\t\t<div class="ui-hr ui-mv-25"></div>\n\t\t\t\t\t\t<template v-if="this.isOrderPublicUrlExists">\n\t\t\t\t\t\t\t<div class="salescenter-title-5 ui-title-5 ui-text-center ui-color-medium">{{localize.SALESCENTER_INFO_TEXT_BOTTOM_PUBLIC}}</div>\n\t\t\t\t\t\t\t<div style="padding-top: 5px;" class="ui-text-center">\n\t\t\t\t\t\t\t\t<div class="ui-btn ui-btn-primary ui-btn-lg" @click="openConnectedSite">{{localize.SALESCENTER_INFO_PUBLIC}}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else-if="isOrderPageDeleted">\n\t\t\t\t\t\t\t<div class="salescenter-title-5 ui-title-5 ui-text-center ui-color-medium">{{localize.SALESCENTER_INFO_ORDER_PAGE_DELETED}}</div>\n\t\t\t\t\t\t\t<div style="padding-top: 5px;" class="ui-text-center">\n\t\t\t\t\t\t\t\t<div class="ui-btn ui-btn-primary ui-btn-lg" @click="checkRecycle">{{localize.SALESCENTER_CHECK_RECYCLE}}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class="salescenter-title-5 ui-title-5 ui-text-center ui-color-medium">{{localize.SALESCENTER_INFO_TEXT_BOTTOM_2}}</div>\n\t\t\t\t\t\t\t<div style="padding-top: 5px;" class="ui-text-center">\n\t\t\t\t\t\t\t\t<div class="ui-btn ui-btn-primary ui-btn-lg" @click="connect">{{localize.SALESCENTER_INFO_CREATE}}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style="padding-top: 5px;" class="ui-text-center">\n\t\t\t\t\t\t\t\t<div class="ui-btn ui-btn-link ui-btn-lg" @click="BX.Salescenter.Manager.openHowPayDealWorks(event)">{{localize.SALESCENTER_HOW}}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else-if="isFrameError && isShowPreview">\n\t\t\t\t\t<div class="salescenter-app-page-content salescenter-app-lost">\n\t\t\t\t\t\t<div class="salescenter-app-lost-block ui-title-1 ui-text-center ui-color-medium">{{localize.SALESCENTER_ERROR_TITLE}}</div>\n\t\t\t\t\t\t<div v-if="currentPage.isFrameDenied === true" class="salescenter-app-lost-helper ui-color-medium">{{localize.SALESCENTER_RIGHT_FRAME_DENIED}}</div>\n\t\t\t\t\t\t<div v-else-if="currentPage.isActive !== true" class="salescenter-app-lost-helper salescenter-app-not-active ui-color-medium">{{localize.SALESCENTER_RIGHT_NOT_ACTIVE}}</div>\n\t\t\t\t\t\t<div v-else class="salescenter-app-lost-helper ui-color-medium">{{localize.SALESCENTER_ERROR_TEXT}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<div v-show="isShowPreview && !isShowStartInfo && !isFrameError" class="salescenter-app-page-content">\n\t\t\t\t\t<template v-for="page in pages">\n\t\t\t\t\t\t<iframe class="salescenter-app-demo" v-show="currentPage && currentPage.id == page.id" :src="getFrameSource(page)" frameborder="0" @error="onFrameError(page.id)" @load="onFrameLoad(page.id)" :key="page.id"></iframe>\n\t\t\t\t\t</template>\n\t\t\t\t\t<div class="salescenter-app-demo-overlay" :class="{\n\t\t\t\t\t\t\'salescenter-app-demo-overlay-loading\': this.isShowLoader\n\t\t\t\t\t}">\n\t\t\t\t\t\t<div v-show="isShowLoader" ref="previewLoader"></div>\n\t\t\t\t\t\t<div v-if="lastModified" class="salescenter-app-demo-overlay-modification">{{lastModified}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t    <template v-if="this.$root.$app.isPaymentsLimitReached">\n\t\t\t        <div ref="paymentsLimit" v-show="isShowPayment && !isShowStartInfo"></div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t        <component v-if="isShowPayment && !isShowStartInfo" :is="config.templateAddPaymentName"></component>\n\t\t        </template>\n\t\t        <template v-if="isShowPaymentBySms && !isShowStartInfo">\n\t\t\t        <component :is="config.templateAddPaymentBySms" \n\t\t\t        @send="send" \n\t\t\t        :isAllowedSubmitButton="isAllowedSubmitButton"></component>\n\t\t        </template>\n\t\t\t</div>\n\t\t\t<div class="ui-button-panel-wrapper salescenter-button-panel" ref="buttonsPanel">\n\t\t\t\t<div class="ui-button-panel">\n\t\t\t\t\t<button :class="{\'ui-btn-disabled\': !this.isAllowedSubmitButton}" class="ui-btn ui-btn-md ui-btn-success" @click="send($event)" v-if="editable">{{localize.SALESCENTER_SEND}}</button>\n\t\t\t\t\t<button :class="{\'ui-btn-disabled\': !this.isAllowedSubmitButton}" class="ui-btn ui-btn-md ui-btn-success" @click="send($event)" v-else>{{localize.SALESCENTER_RESEND}}</button>\n\t\t\t\t\t<button class="ui-btn ui-btn-md ui-btn-link" @click="close">{{localize.SALESCENTER_CANCEL}}</button>\n\t\t\t\t\t<button v-if="isShowPayment && !isShowStartInfo && !this.$root.$app.isPaymentsLimitReached" class="ui-btn ui-btn-md ui-btn-link btn-send-crm" @click="send($event, \'y\')">{{localize.SALESCENTER_SAVE_ORDER}}</button>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="this.order.errors.length > 0" ref="errorBlock"></div>\n\t\t\t</div>\n\t\t</div>\n\t'});E.Vue.component(_.templateAddPaymentProductName,{props:["basketItem","basketItemIndex","countItems","selectedProductIds"],mixins:[w],data:function t(){return{timer:null,productSelector:null,isImageAdded:false,imageControlId:null}},created:function t(){var e=this;this.currencySymbol=this.$root.$app.options.currencySymbol;this.defaultMeasure={name:"",id:null};this.measures=this.$root.$app.options.measures||[];if(BX.type.isArray(this.measures)&&this.measures){this.measures.map(function(t){if(t["IS_DEFAULT"]==="Y"){e.defaultMeasure.name=t.SYMBOL;e.defaultMeasure.code=t.CODE;if(!e.basketItem.measureName&&!e.basketItem.measureName){e.changeData({measureCode:e.defaultMeasure.code,measureName:e.defaultMeasure.name})}}})}h.EventEmitter.subscribe("onUploaderIsInited",this.onUploaderIsInitedHandler.bind(this))},mounted:function t(){this.productSelector=new BX.UI.Dropdown({searchAction:"salescenter.api.order.searchProduct",searchOptions:{restrictedSearchIds:this.selectedProductIds},enableCreation:true,enableCreationOnBlur:false,searchResultRenderer:null,targetElement:this.$refs.searchProductLine,items:this.getProductSelectorItems(),messages:{creationLegend:this.localize.SALESCENTER_PRODUCT_CREATE,notFound:this.localize.SALESCENTER_PRODUCT_NOT_FOUND},events:{onSelect:this.selectCatalogItem.bind(this),onAdd:this.showCreationForm.bind(this),onReset:this.resetSearchForm.bind(this)}});if(!this.basketItem.hasOwnProperty("id")){this.initDefaultFileControl()}},updated:function t(){if(this.basketItem.hasOwnProperty("fileControlJs")&&!this.basketItem.productId){var e=this.basketItem.fileControlJs;if(e){e.forEach(function(t){BX.evalGlobal(t)})}}},directives:{"bx-search-product":{inserted:function t(e,n){if(n.value.selector instanceof BX.UI.Dropdown){var s=n.value.restrictedIds;n.value.selector.targetElement=e;if(BX.type.isArray(s)){n.value.selector.searchOptions={restrictedSearchIds:s};n.value.selector.items=n.value.selector.items.filter(function(t){return!s.includes(t.id)})}n.value.selector.init()}}}},methods:{onUploaderIsInitedHandler:function t(e){if(this.basketItem.productId){return}var n=e.getCompatData(),s=babelHelpers.slicedToArray(n,2),i=s[1];h.EventEmitter.subscribe(i,"onFileIsUploaded",this.onFileIsUploadedHandler.bind(this));h.EventEmitter.subscribe(i,"onFileIsDeleted",this.onFileIsDeleteHandler.bind(this))},onFileIsUploadedHandler:function t(e){var n=e.getCompatData(),s=babelHelpers.slicedToArray(n,4),i=s[0],a=s[2],r=s[3];if(!this.imageControlId){this.imageControlId=r.CID}else if(this.imageControlId!==r.CID){return}var o=this.basketItem.image,l=a&&a["file"]&&a["file"]["files"]&&a["file"]["files"]["default"]?a["file"]["files"]["default"]:false;if(l){o.push({fileId:i,data:{name:l.name,type:l.type,tmp_name:l.path,size:l.size,error:null}});var c={image:o};c.isCreatedProduct="Y";this.changeData(c)}this.isImageAdded=true},onFileIsDeleteHandler:function t(e){var n=e.getCompatData(),s=babelHelpers.slicedToArray(n,1),i=s[0];var a=this.basketItem.image;a.forEach(function(t,e,n){if(t.fileId===i){n.splice(e,1)}});var r={image:a};this.changeData(r)},toggleDiscount:function t(e){var n=this;this.changeData({showDiscount:e});e==="Y"?setTimeout(function(){return n.$refs.discountInput.focus()}):null},changeData:function t(e){this.$emit("changeBasketItem",{index:this.basketItemIndex,fields:e})},isNeedRefreshAfterChanges:function t(){if(this.isCreationMode){return this.basketItem.name.length>0&&this.basketItem.quantity>0&&this.basketItem.price>0}return true},refreshBasket:function t(){if(this.isNeedRefreshAfterChanges()){this.$emit("refreshBasket")}},debouncedRefresh:function t(e){var n=this;if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(function(){n.refreshBasket();n.timer=null},e)},changeQuantity:function t(e){e.target.value=e.target.value.replace(/[^.,\d]/g,"");var n=parseFloat(e.target.value);var s=e.target.value.substr(-1);if(s===","){e.target.value=e.target.value.replace(",",".")}if(!n||s==="."||s===","){return}var i=this.basketItem;i.quantity=n;this.changeData(i);this.debouncedRefresh(300)},changeName:function t(e){var n=e.target.value;var s=this.basketItem;s.name=n;this.changeData(s);this.refreshBasket()},changePrice:function t(e){e.target.value=e.target.value.replace(/[^.,\d]/g,"");if(e.target.value===""){e.target.value=0}var n=e.target.value.substr(-1);if(n===","){e.target.value=e.target.value.replace(",",".")}var s=parseFloat(e.target.value);if(s<0||n==="."||n===","){return}var i=this.basketItem;i.price=s;i.discount=0;if(i.module!=="catalog"){i.basePrice=s}else{i.isCustomPrice="Y"}this.changeData(i);this.refreshBasket()},changeDiscountType:function t(e){var n=e==="currency"?"currency":"percent";var s=this.basketItem;s.discountType=n;s.price=s.basePrice;s.isCustomPrice="Y";this.changeData(s);this.refreshBasket()},changeDiscount:function t(e){var n=parseFloat(e.target.value)||0;if(n===parseFloat(this.basketItem.discount)){return}var s=this.basketItem;s.discount=n;s.price=s.basePrice;s.isCustomPrice="Y";this.changeData(s);this.refreshBasket()},showCreationForm:function t(){if(!(this.productSelector instanceof BX.UI.Dropdown))return true;var e=this.productSelector.targetElement.value;var n={productId:"",quantity:1,module:null,sort:this.basketItemIndex,isCreatedProduct:"Y",name:e,isCustomPrice:"Y",discountInfos:[],errors:[]};if(!this.isImageAdded){this.initDefaultFileControl(n)}else{this.changeData(n)}this.productSelector.destroyPopupWindow()},resetSearchForm:function t(){var e=this;if(!(this.productSelector instanceof BX.UI.Dropdown))return true;this.productSelector.targetElement.value="";this.productSelector.updateItemsList(this.getProductSelectorItems());var n={productId:"",code:null,module:null,name:"",quantity:0,price:0,basePrice:0,discount:0,discountInfos:[],image:[],errors:["SALE_BASKET_ITEM_NAME"]};this.initDefaultFileControl(n).then(function(){e.refreshBasket()});this.isImageAdded=false;this.imageControlId=null;this.productSelector.destroyPopupWindow()},hideCreationForm:function t(){var e=this;if(!(this.productSelector instanceof BX.UI.Dropdown))return true;var n={isCreatedProduct:"N",productId:"",name:"",quantity:0,price:0,basePrice:0,discount:0,discountInfos:[],image:[],errors:[]};this.initDefaultFileControl(n).then(function(){e.refreshBasket()});this.isImageAdded=false;this.imageControlId=null},removeItem:function t(){this.$emit("removeItem",{index:this.basketItemIndex})},selectCatalogItem:function t(e,n){var s=this;if(!e instanceof BX.UI.Dropdown){return true}if(n.id===undefined||parseInt(n.id)<=0){return true}var i={name:n.title,productId:n.id,sort:this.basketItemIndex,module:"catalog",isCustomPrice:"N",discount:0,quantity:this.basketItem.quantity>0?this.basketItem.quantity:1,isCreatedProduct:"N",image:[]};if(this.basketItemIndex.productId!==n.id){i.encodedFields=null;i.discount=0;i.isCustomPrice="N"}BX.ajax.runAction("salescenter.api.order.getFileControl",{data:{productId:n.id}}).then(function(t){var e=BX.prop.getObject(t,"data",{});if(e.fileControl){var n=BX.processHTML(e.fileControl);i.fileControlHtml=n["HTML"]}s.changeData(i);s.$emit("refreshBasket")});e.destroyPopupWindow()},openDiscountEditor:function t(e,n){if(!(window.top.BX.SidePanel&&window.top.BX.SidePanel.Instance)){return}window.top.BX.SidePanel.Instance.open(BX.util.add_url_param(n,{IFRAME:"Y",IFRAME_TYPE:"SIDE_SLIDER",publicSidePanel:"Y"}),{allowChangeHistory:false});e.preventDefault?e.preventDefault():e.returnValue=false},isEmptyProductName:function t(){return this.basketItem.name.length===0},incrementQuantity:function t(){this.basketItem.quantity++;this.changeData(this.basketItem);this.refreshBasket()},decrementQuantity:function t(){if(this.basketItem.quantity>1){this.basketItem.quantity--;this.changeData(this.basketItem);this.refreshBasket()}},showPopupMenu:function t(e,n,s){var i=this;if(!this.editable){return}var a=[];var r=function t(n,a){e.innerHTML=n.target.innerHTML;if(s==="discount"){i.changeDiscountType(a.options.type)}i.popupMenu.close()};if(s==="discount"){n=[];n.percent="%";n.currency=this.currencySymbol}if(n){for(var o in n){var l=n[o];if(s==="measures"){l=n[o].SYMBOL}a.push({text:l,onclick:r.bind({value:"settswguy"}),type:s==="discount"?o:null})}}this.popupMenu=new g.PopupMenuWindow({bindElement:e,items:a});this.popupMenu.show()},initDefaultFileControl:function t(){var e=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return this.getDefaultFileControl().then(function(t){var s=BX.processHTML(t);n.fileControlHtml=s["HTML"];n.fileControlJs=[];for(var i in s["SCRIPT"]){if(s["SCRIPT"].hasOwnProperty(i)){n.fileControlJs.push(s["SCRIPT"][i]["JS"])}}e.changeData(n)})},getDefaultFileControl:function t(){return new Promise(function(t,e){BX.ajax.runAction("salescenter.api.order.getFileControl").then(function(e){var n=BX.prop.getObject(e,"data",{fileControl:""});if(n.fileControl){t(n.fileControl)}},function(t){e(new Error(t.errors.join("<br />")))})})},getProductSelectorItems:function t(){var e=this.$root.$app.options.mostPopularProducts.map(function(t){return{id:t.ID,title:t.NAME,module:"salescenter"}});var n=Array.isArray(this.selectedProductIds)?this.selectedProductIds:[];var s=e.filter(function(t){return!t.id||!n.includes(t.id)});if(s.length){return s}else{return[{title:"",subTitle:this.localize.SALESCENTER_PRODUCT_BEFORE_SEARCH_TITLE}]}}},watch:{selectedProductIds:function t(e,n){var s=Array.isArray(e)?e:[];var i=Array.isArray(n)?n:[];if(s.join()===i.join()){return}this.productSelector.updateItemsList(this.getProductSelectorItems())}},computed:{localize:function t(){return E.Vue.getFilteredPhrases("SALESCENTER_PRODUCT_")},showDiscount:function t(){return this.basketItem.showDiscount==="Y"},showPrice:function t(){return this.basketItem.discount>0||parseFloat(this.basketItem.price)!==parseFloat(this.basketItem.basePrice)},getMeasureName:function t(){return this.basketItem.measureName||this.defaultMeasure.name},getMeasureCode:function t(){return this.basketItem.measureCode||this.defaultMeasure.code},getBasketFileControl:function t(){var e=this.basketItem.fileControl,n="";if(e){var s=BX.processHTML(e);n=s["HTML"]}return n},restrictedSearchIds:function t(){var e=this;var t=this.selectedProductIds;if(this.basketItem.module==="catalog"){t=t.filter(function(t){return t!==e.basketItem.productId})}return t},isCreationMode:function t(){return this.basketItem.isCreatedProduct==="Y"},isNotEnoughQuantity:function t(){return this.basketItem.errors.includes("SALE_BASKET_AVAILABLE_QUANTITY")},hasPriceError:function t(){return this.basketItem.errors.includes("SALE_BASKET_ITEM_WRONG_PRICE")},hasNameError:function t(){return this.basketItem.errors.includes("SALE_BASKET_ITEM_NAME")},productInputWrapperClass:function t(){return{"ui-ctl":true,"ui-ctl-w100":true,"ui-ctl-md":true,"ui-ctl-after-icon":true,"ui-ctl-danger":this.hasNameError}}},template:'\n\t\t<div>\n\t\t\t\x3c!--counters anr remover--\x3e\n\t\t\t<div class="salescenter-app-counter">{{basketItemIndex + 1}}</div>\n\t\t\t<div class="salescenter-app-remove" @click="removeItem" v-if="countItems > 1 && editable"></div>\n\t\t\t\x3c!--counters anr remover end--\x3e\n\t\t\t\n\t\t\t\x3c!--if isCreationMode--\x3e\n\t\t\t<div class="salescenter-app-form-container" v-if="!isCreationMode">\n\t\t\t\t<div class="salescenter-app-form-row">\n\t\t\t\t\t\x3c!--col 1--\x3e\n\t\t\t\t\t<div class="salescenter-app-form-col salescenter-app-form-col-prod" style="flex:8">\n\t\t\t\t\t\t<div class="salescenter-app-form-col-input">\n\t\t\t\t\t\t\t<label class="salescenter-app-ctl-label-text ui-ctl-label-text">{{localize.SALESCENTER_PRODUCT_NAME}}</label>\n\t\t\t\t\t\t\t<div :class="productInputWrapperClass">\n\t\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" @click="resetSearchForm" v-if="basketItem.name.length > 0 && editable"/>\n\t\t\t\t\t\t\t\t\x3c!--<button class="ui-ctl-after ui-ctl-icon-clear" @click="removeItem" v-if="countItems > 1 && editable"/>--\x3e\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t\tref="searchProductLine" \n\t\t\t\t\t\t\t\t\tclass="ui-ctl-element ui-ctl-textbox salescenter-app-product-search" \n\t\t\t\t\t\t\t\t\t:value="basketItem.name"\n\t\t\t\t\t\t\t\t\tv-bx-search-product="{selector: productSelector, restrictedIds: restrictedSearchIds}"\n\t\t\t\t\t\t\t\t\t:disabled="!editable"\n\t\t\t\t\t\t\t\t\t:placeholder="localize.SALESCENTER_PRODUCT_NAME_PLACEHOLDER"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="getBasketFileControl" class="salescenter-app-form-col-img">\n\t\t\t\t\t\t\t\x3c!-- loaded product --\x3e\n\t\t\t\t\t\t\t<div v-html="getBasketFileControl"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-else class="salescenter-app-form-col-img">\n\t\t\t\t\t\t\t\x3c!-- selected product --\x3e\n\t\t\t\t\t\t\t<div v-html="basketItem.fileControlHtml"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!--col 1 end--\x3e\n\n\t\t\t\t\t\x3c!--col 2--\x3e\n\t\t\t\t\t<div class="salescenter-app-form-col salescenter-app-form-col-sm" style="flex:2">\n\t\t\t\t\t\t<label class="salescenter-app-ctl-label-text salescenter-app-ctl-label-text-link ui-ctl-label-text">\n\t\t\t\t\t\t\t{{localize.SALESCENTER_PRODUCT_QUANTITY.replace(\'#MEASURE_NAME#\', \' \')}}\n\t\t\t\t\t\t\t<span @click="showPopupMenu($event.target, measures, \'measures\')">{{ getMeasureName }}</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-md ui-ctl-w100" :class="isNotEnoughQuantity ? \'ui-ctl-danger\' : \'\'">\n\t\t\t\t\t\t\t<input \ttype="text" class="ui-ctl-element ui-ctl-textbox" \n\t\t\t\t\t\t\t\t\t:value="basketItem.quantity"\n\t\t\t\t\t\t\t\t\t@change="changeQuantity"\n\t\t\t\t\t\t\t\t\t:disabled="!editable">\n\t\t\t\t\t\t\t<div class="salescenter-app-input-counter" v-if="editable">\n\t\t\t\t\t\t\t\t<div class="salescenter-app-input-counter-up" @click="incrementQuantity"></div>\n\t\t\t\t\t\t\t\t<div class="salescenter-app-input-counter-down" @click="decrementQuantity"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="salescenter-form-error" v-if="isNotEnoughQuantity">{{localize.SALESCENTER_PRODUCT_IS_NOT_AVAILABLE}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!--col 2 end--\x3e\n\t\t\t\t\t\n\t\t\t\t\t\x3c!--col 3--\x3e\n\t\t\t\t\t<div class="salescenter-app-form-col salescenter-app-form-col-sm" style="flex:2">\n\t\t\t\t\t\t<label class="salescenter-app-ctl-label-text ui-ctl-label-text">{{localize.SALESCENTER_PRODUCT_PRICE_2}}</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-md ui-ctl-w100 salescenter-app-col-currency" :class="hasPriceError ? \'ui-ctl-danger\' : \'\'">\n\t\t\t\t\t\t\t<input \ttype="text" class="ui-ctl-element ui-ctl-textbox"\n\t\t\t\t\t\t\t\t\t:value="basketItem.price"\n\t\t\t\t\t\t\t\t\t@change="changePrice"\n\t\t\t\t\t\t\t\t\t:disabled="!editable">\n\t\t\t\t\t\t\t<div class="salescenter-app-col-currency-symbol" v-html="currencySymbol"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!--col 3 end--\x3e\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t\x3c!--show discount link--\x3e\n\t\t\t\t<div class="salescenter-app-form-row" v-if="editable || (!editable && showPrice)">\n\t\t\t\t\t<div style="flex: 8;"></div>\n\t\t\t\t\t<div class="salescenter-app-form-col salescenter-app-form-col-sm" style="flex: 2;">\n\t\t\t\t\t\t<div v-if="showDiscount" class="salescenter-app-collapse-link-pointer-event">{{localize.SALESCENTER_PRODUCT_DISCOUNT_PRICE_TITLE}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="salescenter-app-form-col salescenter-app-form-col-sm" style="flex:2" v-if="showDiscount">\n\t\t\t\t\t\t<div class="salescenter-app-collapse-link-hide"  @click="toggleDiscount(\'N\')">{{localize.SALESCENTER_PRODUCT_DISCOUNT_TITLE}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="salescenter-app-form-col salescenter-app-form-col-sm" style="flex:2" v-else>\n\t\t\t\t\t\t<div class="salescenter-app-collapse-link-show"  @click="toggleDiscount(\'Y\')">{{localize.SALESCENTER_PRODUCT_DISCOUNT_TITLE}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!--show discount link end--\x3e\n\t\t\t\t\n\t\t\t\t\x3c!--dicount controller--\x3e\n\t\t\t\t<div class="salescenter-app-form-row" style="margin-bottom: 7px" v-if="showDiscount">\n\t\t\t\t\t<div class="salescenter-app-form-collapse-container">\n\t\t\t\t\t\t<div class="salescenter-app-form-row">\t\t\t\t\t\n\t\t\t\t\t\t\t<div class="salescenter-app-form-col" style="flex: 8"></div>\n\t\t\t\t\t\t\t<div class="salescenter-app-form-col  salescenter-app-form-col-sm" style="flex:2; overflow: hidden;">\n\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-md ui-ctl-w100 salescenter-app-col-currency">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl-element ui-ctl-textbox salescenter-ui-ctl-element" v-html="basketItem.basePrice" disabled="true"></div>\n\t\t\t\t\t\t\t\t\t<div class="salescenter-app-col-currency-symbol" v-html="currencySymbol"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="salescenter-app-form-col salescenter-app-form-col-sm" style="flex:2; overflow: hidden;">\n\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-dropdown salescenter-app-col-currency">\n\t\t\t\t\t\t\t\t\t<input \ttype="text" class="ui-ctl-element ui-ctl-textbox"\n\t\t\t\t\t\t\t\t\t\t\tref="discountInput" \n\t\t\t\t\t\t\t\t\t\t\t:value="basketItem.discount"\n\t\t\t\t\t\t\t\t\t\t\t@change="changeDiscount"\n\t\t\t\t\t\t\t\t\t\t\t:disabled="!editable">\n\t\t\t\t\t\t\t\t\t<div class="salescenter-app-col-currency-symbol salescenter-app-col-currency-symbol-link" @click="showPopupMenu($event.target.firstChild, null, \'discount\')"><span v-html="basketItem.discountType === \'percent\' ? \'%\' : currencySymbol"></span></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="salescenter-app-form-row" style="margin-bottom: 0;" v-if="editable">\n\t\t\t\t\t\t\t<div class="salescenter-app-form-col" v-for="discount in basketItem.discountInfos"">\n\t\t\t\t\t\t\t\t<span class="ui-text-4 ui-color-light"> {{discount.name}}<a :href="discount.editPageUrl" @click="openDiscountEditor(event, discount.editPageUrl)">{{localize.SALESCENTER_PRODUCT_DISCOUNT_EDIT_PAGE_URL_TITLE}}</a></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!--dicount controller end--\x3e\n\t\t\t\t\n\t\t\t</div>\n\t\t\t\x3c!--endif isCreationMode--\x3e\n\t\t\t\n\t\t\t\x3c!--else isCreationMode--\x3e\n\t\t\t<div class="salescenter-app-form-container" v-else>\n\t\t\t\t<div class="salescenter-app-form-row">\n\t\t\t\t\t\x3c!--col 1--\x3e\n\t\t\t\t\t<div class="salescenter-app-form-col salescenter-app-form-col-prod" style="flex:8">\n\t\t\t\t\t\t<div class="salescenter-app-form-col-input">\n\t\t\t\t\t\t\t<label class="salescenter-app-ctl-label-text ui-ctl-label-text">{{localize.SALESCENTER_PRODUCT_TITLE}}</label>\n\t\t\t\t\t\t\t<div :class="productInputWrapperClass">\n\t\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" @click="hideCreationForm"> </button>\n\t\t\t\t\t\t\t\t<input type="text" class="ui-ctl-element ui-ctl-textbox" @change="changeName" :value="basketItem.name">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-tag">{{localize.SALESCENTER_PRODUCT_NEW_LABEL}}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="salescenter-app-form-col-img">\n\t\t\t\t\t\t\t\x3c!-- new product --\x3e\n\t\t\t\t\t\t\t<div v-html="basketItem.fileControlHtml"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!--col 1 end--\x3e\n\t\t\t\t\t\n\t\t\t\t\t\x3c!--col 2--\x3e\n\t\t\t\t\t<div class="salescenter-app-form-col salescenter-app-form-col-sm" style="flex:2">\n\t\t\t\t\t\t<label class="salescenter-app-ctl-label-text salescenter-app-ctl-label-text-link ui-ctl-label-text">\n\t\t\t\t\t\t\t{{localize.SALESCENTER_PRODUCT_QUANTITY.replace(\'#MEASURE_NAME#\', \' \')}}\n\t\t\t\t\t\t\t<span @click="showPopupMenu($event.target, measures, \'measures\')">{{ getMeasureName }}</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-md ui-ctl-w100">\n\t\t\t\t\t\t\t<input \ttype="text" \n\t\t\t\t\t\t\t\t\tclass="ui-ctl-element ui-ctl-textbox" \n\t\t\t\t\t\t\t\t\t:value="basketItem.quantity" \n\t\t\t\t\t\t\t\t\t@input="changeQuantity" \n\t\t\t\t\t\t\t\t\t@change="refreshBasket">\n\t\t\t\t\t\t\t<div class="salescenter-app-input-counter" v-if="editable">\n\t\t\t\t\t\t\t\t<div class="salescenter-app-input-counter-up" @click="incrementQuantity"></div>\n\t\t\t\t\t\t\t\t<div class="salescenter-app-input-counter-down" @click="decrementQuantity"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!--col 2 end--\x3e\n\t\t\t\t\t\n\t\t\t\t\t\x3c!--col 3--\x3e\n\t\t\t\t\t<div class="salescenter-app-form-col salescenter-app-form-col-sm" style="flex:2">\n\t\t\t\t\t\n\t\t\t\t\t\t<label class="salescenter-app-ctl-label-text ui-ctl-label-text">{{localize.SALESCENTER_PRODUCT_PRICE_2}}</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-md ui-ctl-w100 salescenter-app-col-currency" :class="hasPriceError ? \'ui-ctl-danger\' : \'\'">\n\t\t\t\t\t\t\t<input \ttype="text" class="ui-ctl-element ui-ctl-textbox"\n\t\t\t\t\t\t\t\t\t:value="basketItem.price"\n\t\t\t\t\t\t\t\t\t@change="changePrice"\n\t\t\t\t\t\t\t\t\t:disabled="!editable">\n\t\t\t\t\t\t\t<div class="salescenter-app-col-currency-symbol" v-html="currencySymbol"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!--col 3 end--\x3e\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t\x3c!--show discount link--\x3e\n\t\t\t\t<div class="salescenter-app-form-row" v-if="editable || (!editable && showPrice)">\n\t\t\t\t\t<div style="flex: 8;"></div>\n\t\t\t\t\t<div class="salescenter-app-form-col salescenter-app-form-col-sm" style="flex: 2;">\n\t\t\t\t\t\t<div v-if="showDiscount" class="salescenter-app-collapse-link-pointer-event">{{localize.SALESCENTER_PRODUCT_DISCOUNT_PRICE_TITLE}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="salescenter-app-form-col salescenter-app-form-col-sm" style="flex:2" v-if="showDiscount">\n\t\t\t\t\t\t<div class="salescenter-app-collapse-link-hide"  @click="toggleDiscount(\'N\')">{{localize.SALESCENTER_PRODUCT_DISCOUNT_TITLE}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="salescenter-app-form-col salescenter-app-form-col-sm" style="flex:2" v-else>\n\t\t\t\t\t\t<div class="salescenter-app-collapse-link-show"  @click="toggleDiscount(\'Y\')">{{localize.SALESCENTER_PRODUCT_DISCOUNT_TITLE}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!--show discount link end--\x3e\n\t\t\t\t\n\t\t\t\t\x3c!--dicount controller--\x3e\n\t\t\t\t<div class="salescenter-app-form-row" style="margin-bottom: 7px" v-if="showDiscount">\n\t\t\t\t\t<div class="salescenter-app-form-collapse-container">\n\t\t\t\t\t\t<div class="salescenter-app-form-row">\t\t\t\t\t\n\t\t\t\t\t\t\t<div class="salescenter-app-form-col" style="flex: 8"></div>\n\t\t\t\t\t\t\t<div class="salescenter-app-form-col  salescenter-app-form-col-sm" style="flex:2; overflow: hidden;">\n\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-md ui-ctl-w100 salescenter-app-col-currency">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl-element ui-ctl-textbox salescenter-ui-ctl-element" v-html="basketItem.basePrice" disabled="true"></div>\n\t\t\t\t\t\t\t\t\t<div class="salescenter-app-col-currency-symbol" v-html="currencySymbol"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="salescenter-app-form-col salescenter-app-form-col-sm" style="flex:2; overflow: hidden;">\n\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-dropdown salescenter-app-col-currency">\n\t\t\t\t\t\t\t\t\t<input \ttype="text" class="ui-ctl-element ui-ctl-textbox"\n\t\t\t\t\t\t\t\t\t\t\tref="discountInput"\n\t\t\t\t\t\t\t\t\t\t\t:value="basketItem.discount"\n\t\t\t\t\t\t\t\t\t\t\t@change="changeDiscount"\n\t\t\t\t\t\t\t\t\t\t\t:disabled="!editable">\n\t\t\t\t\t\t\t\t\t<div class="salescenter-app-col-currency-symbol salescenter-app-col-currency-symbol-link" @click="showPopupMenu($event.target.firstChild, null, \'discount\')"><span v-html="basketItem.discountType === \'percent\' ? \'%\' : currencySymbol"></span></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="salescenter-app-form-row" style="margin-bottom: 0;" v-if="editable">\n\t\t\t\t\t\t\t<div class="salescenter-app-form-col" v-for="discount in basketItem.discountInfos"">\n\t\t\t\t\t\t\t\t<span class="ui-text-4 ui-color-light"> {{discount.name}} \n\t\t\t\t\t\t\t\t<a :href="discount.editPageUrl" @click="openDiscountEditor(event, discount.editPageUrl)">{{localize.SALESCENTER_PRODUCT_DISCOUNT_EDIT_PAGE_URL_TITLE}}</a></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!--dicount controller end--\x3e\n\t\t\t</div>\n\t\t\t\x3c!--endelse isCreationMode--\x3e\n\t\t</div>\n\t'});var $={props:[],methods:{refreshBasket:function t(){this.$emit("on-refresh-basket")},changeBasketItem:function t(e){this.$emit("on-change-basket-item",e)},addBasketItemForm:function t(){this.$emit("on-add-basket-item")},getInternalIndexByProductId:function t(e){var n=this.$store.getters["orderCreation/getBasket"]();return Object.keys(n).findIndex(function(t){return parseInt(n[t].productId)===parseInt(e)})},onAddBasketItem:function t(e){var n=this;this.$store.commit("orderCreation/addBasketItem");var s=this.countItems-1;this.$store.commit("orderCreation/updateBasketItem",{index:s,fields:e});var i=this.order.basket[s];if(i.id===undefined||parseInt(i.id)<=0)return true;var a={name:i.name,productId:i.id,sort:s,module:"catalog",quantity:i.quantity>0?i.quantity:1};BX.ajax.runAction("salescenter.api.order.getFileControl",{data:{productId:i.id}}).then(function(t){var e=BX.prop.getObject(t,"data",{});if(e.fileControl){var i=BX.processHTML(e.fileControl);a.fileControlHtml=i["HTML"]}n.changeBasketItem({index:s,fields:a});n.refreshBasket()})},onUpdateBasketItem:function t(e,n){this.$store.dispatch("orderCreation/changeBasketItem",{index:e,fields:n})},removeEmptyItems:function t(){var e=this;var n=this.$store.getters["orderCreation/getBasket"]();n.forEach(function(t,s){if(n[s].name===""&&n[s].price<1e-10){e.$store.dispatch("orderCreation/deleteBasketItem",{index:s})}})},modifyBasketItem:function t(e){var n=parseInt(e.id);if(n>0){var s=this.getInternalIndexByProductId(n);if(s>=0){this.showDialogProductExists(e)}else{this.removeEmptyItems();this.onAddBasketItem(e)}}},showDialogProductExists:function t(e){var n=this;this.popup=new g.Popup(null,null,{events:{onPopupClose:function t(){n.popup.destroy()}},zIndex:4e3,autoHide:true,closeByEsc:true,closeIcon:true,titleBar:S.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_PROD_EXIST_DLG_TITLE"),draggable:true,resizable:false,lightShadow:true,cacheable:false,overlay:true,content:S.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_PROD_EXIST_DLG_TEXT").replace("#NAME#",e.name),buttons:this.getButtons(e)});this.popup.show()},getButtons:function t(e){var n=this;var s=[];var i=e;s.push(new BX.UI.SaveButton({text:S.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_PROD_EXIST_DLG_OK"),onclick:function t(){var e=parseInt(i.id);var s=n.getInternalIndexByProductId(e);if(s>=0){var a=n.$store.getters["orderCreation/getBasket"]()[s];var r={quantity:parseInt(a.quantity)+1};n.onUpdateBasketItem(s,r)}n.popup.destroy()}}));s.push(new BX.UI.CancelButton({text:S.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_PROD_EXIST_DLG_NO"),onclick:function t(){n.popup.destroy()}}));return s},showDialogProductSearch:function t(){var e=this;var n="addBasketItemFromDialogProductSearch";window[n]=function(t){return e.modifyBasketItem(t)};var s=new BX.CDialog({content_url:"/bitrix/tools/sale/product_search_dialog.php?"+"&caller=order_edit"+"&func_name="+n+"&STORE_FROM_ID=0"+"&public_mode=Y",height:Math.max(500,window.innerHeight-400),width:Math.max(800,window.innerWidth-400),draggable:true,resizable:true,min_height:500,min_width:800,zIndex:3100});s.Show()}},computed:babelHelpers.objectSpread({countItems:function t(){return this.order.basket.length}},b.Vuex.mapState({order:function t(e){return e.orderCreation}})),template:'\n\t\t<div class="salescenter-app-form-col" style="flex: 1; white-space: nowrap;">\n\t\t\t<a class="salescenter-app-add-item-link" @click="addBasketItemForm">\n\t\t\t\t<slot name="product-add-title"></slot>\n\t\t\t</a>\n\t\t\t<a class="salescenter-app-add-item-link salescenter-app-add-item-link-catalog" @click="showDialogProductSearch">\n\t\t\t\t<slot name="product-add-from-catalog-title"></slot>\n\t\t\t</a>\n\t\t</div>\n\t'};E.Vue.component(_.templateAddPaymentName,{mixins:[w],components:{"basket-item-add-block":$},data:function t(){return{}},mounted:function t(){if(parseInt(this.$root.$app.options.associatedEntityId)>0){this.$root.$emit("on-change-editable",false)}},created:function t(){var e=this;this.currencySymbol=this.$root.$app.options.currencySymbol;var n=this.$root.$app.options.currencyCode||"";this.$store.dispatch("orderCreation/setCurrency",n);if(BX.type.isArray(this.$root.$app.options.basket)&&this.$root.$app.options.basket.length>0){this.$root.$app.options.basket.forEach(function(t){e.$store.dispatch("orderCreation/changeBasketItem",{index:t.sort,fields:t})});if(typeof this.$root.$app.options.totals!=="undefined"){this.$store.commit("orderCreation/setTotal",{sum:this.$root.$app.options.totals.sum,discount:this.$root.$app.options.totals.discount,result:this.$root.$app.options.totals.result,resultNumeric:parseFloat(this.$root.$app.options.totals.result)})}}else{this.addBasketItemForm();this.$store.commit("orderCreation/setTotal",{sum:0,discount:0,result:0})}if(this.$root.$app.options.showPaySystemSettingBanner){this.$store.commit("orderCreation/showBanner")}},methods:{refreshBasket:function t(){this.$store.dispatch("orderCreation/refreshBasket")},changeBasketItem:function t(e){this.$store.dispatch("orderCreation/changeBasketItem",{index:e.index,fields:e.fields})},removeItem:function t(e){this.$store.dispatch("orderCreation/removeItem",{index:e.index});this.refreshBasket()},addBasketItemForm:function t(){this.$store.commit("orderCreation/addBasketItem")},hideBanner:function t(){this.$store.commit("orderCreation/hideBanner");var e=this.$root.$app.options.orderCreationOption||false;var n=this.$root.$app.options.paySystemBannerOptionName||false;if(e&&n){BX.userOptions.save("salescenter",e,n,"Y")}},openControlPanel:function t(){y.Manager.openControlPanel()},handleIMessagePayment:function t(e){var n=e.target.name;this.$root.$app.setIMessage(n,e.target.checked)}},computed:babelHelpers.objectSpread({localize:function t(){return E.Vue.getFilteredPhrases("SALESCENTER_")},total:function t(){return this.order.total},countItems:function t(){return this.order.basket.length},isShowedBanner:function t(){return this.order.showPaySystemSettingBanner},iMessageAvailable:function t(){return this.$root.$app.isApplePayAvailable&&this.$root.$app.connector==="imessage"}},b.Vuex.mapState({order:function t(e){return e.orderCreation}})),template:'\n\t<div class="salescenter-app-payment-side">\n\t\t<div class="salescenter-app-page-content">\n\t\t\t<div v-for="(item, index) in order.basket" class="salescenter-app-form-wrapper" :key="index">\n\t\t\t\t<'.concat(_.templateAddPaymentProductName,' \n\t\t\t\t\t:basketItem="item" \n\t\t\t\t\t:basketItemIndex="index"  \n\t\t\t\t\t:countItems="countItems"\n\t\t\t\t\t:selectedProductIds="order.selectedProducts"\n\t\t\t\t\t@changeBasketItem="changeBasketItem" \n\t\t\t\t\t@removeItem="removeItem" \n\t\t\t\t\t@refreshBasket="refreshBasket" \n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="salescenter-app-result-container"  style="padding-right: 15px">\n\t\t\t\t\n\t\t\t\t<div class="salescenter-app-result-grid-row salescenter-app-result-grid-total-sm">\n\t\t\t\t\t<component :is="\'basket-item-add-block\'" v-if="editable"\n\t\t\t\t\t\tv-on:on-refresh-basket="refreshBasket"\n\t\t\t\t\t\tv-on:on-add-basket-item="addBasketItemForm"\n\t\t\t\t\t\tv-on:on-change-basket-item="changeBasketItem"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot:product-add-title>{{localize.SALESCENTER_PRODUCT_ADD_PRODUCT}}</template>\n\t\t\t\t\t\t<template v-slot:product-add-from-catalog-title>{{localize.SALESCENTER_PRODUCT_ADD_PRODUCT_FROM_CATALOG}}</template>\n\t\t\t\t\t</component>\n\t\t\t\t\t<div class="salescenter-app-form-col" style="flex: 1; display: flex; justify-content: flex-end; padding: 0;">\n\t\t\t\t\t\t<div class="salescenter-app-result-grid-item">{{localize.SALESCENTER_PRODUCT_TOTAL_SUM}}:</div>\n\t\t\t\t\t\t<div class="salescenter-app-result-grid-item salescenter-app-result-grid-item-currency" :class="total.result !== total.sum ? \'salescenter-app-text-line-through\' : \'\'" v-html="total.sum"></div>\n\t\t\t\t\t\t<div class="salescenter-app-result-grid-item-currency-symbol" v-html="currencySymbol"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="salescenter-app-result-grid-row salescenter-app-result-grid-benefit salescenter-app-result-grid-total-sm">\n\t\t\t\t\t<div class="salescenter-app-result-grid-item">{{localize.SALESCENTER_PRODUCT_TOTAL_DISCOUNT}}:</div>\n\t\t\t\t\t<div class="salescenter-app-result-grid-item salescenter-app-result-grid-item-currency" v-html="total.discount"></div>\n\t\t\t\t\t<div class="salescenter-app-result-grid-item-currency-symbol salescenter-app-result-grid-item" v-html="currencySymbol"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="salescenter-app-result-grid-row salescenter-app-result-grid-total salescenter-app-result-grid-total-big">\n\t\t\t\t\t<div class="salescenter-app-result-grid-item">{{localize.SALESCENTER_PRODUCT_PRODUCTS_PRICE}}:</div>\n\t\t\t\t\t<div class="salescenter-app-result-grid-item salescenter-app-result-grid-item-currency" v-html="total.result"></div>\n\t\t\t\t\t<div class="salescenter-app-result-grid-item-currency-symbol" v-html="currencySymbol"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="iMessageAvailable" class="salescenter-app-payment-container">\n\t\t\t\t<label class="ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t<input type="checkbox" class="ui-ctl-element" @change="handleIMessagePayment($event)">\n\t\t\t\t\t<div class="ui-ctl-label-text">{{localize.SALESCENTER_IMESSAGE_PAYMENT}}</div>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<div class="salescenter-app-banner"  v-if="isShowedBanner">\n\t\t\t\t<div class="salescenter-app-banner-inner">\n\t\t\t\t\t<div class="salescenter-app-banner-title">{{localize.SALESCENTER_BANNER_TITLE}}</div>\n\t\t\t\t\t<div class="salescenter-app-banner-content">\n\t\t\t\t\t\t<div class="salescenter-app-banner-text">{{localize.SALESCENTER_BANNER_TEXT}}</div>\n\t\t\t\t\t\t<div class="salescenter-app-banner-btn-block">\n\t\t\t\t\t\t\t<button class="ui-btn ui-btn-sm ui-btn-primary salescenter-app-banner-btn-connect" @click="openControlPanel">{{localize.SALESCENTER_BANNER_BTN_CONFIGURE}}</button>\n\t\t\t\t\t\t\t<button class="ui-btn ui-btn-sm ui-btn-link salescenter-app-banner-btn-hide" @click="hideBanner">{{localize.SALESCENTER_BANNER_BTN_HIDE}}</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="salescenter-app-banner-close" @click="hideBanner"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n')});var R=function(){function t(e){babelHelpers.classCallCheck(this,t);this.icon=this.getIcon();this.type=this.getType();this.content=S.Type.isString(e.content)&&e.content.length>0?e.content:"";this.disabled=S.Type.isBoolean(e.disabled)?e.disabled:false}babelHelpers.createClass(t,[{key:"getType",value:function t(){return""}},{key:"getIcon",value:function t(){return""}}]);return t}();function O(t){return function(){var e=babelHelpers.getPrototypeOf(t),n;if(N()){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(e,arguments,s)}else{n=e.apply(this,arguments)}return babelHelpers.possibleConstructorReturn(this,n)}}function N(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(t){return false}}var M=function(t){babelHelpers.inherits(n,t);var e=O(n);function n(){babelHelpers.classCallCheck(this,n);return e.apply(this,arguments)}babelHelpers.createClass(n,[{key:"getType",value:function t(){return n.type()}},{key:"getIcon",value:function t(){return"cash"}}],[{key:"type",value:function t(){return"cash"}}]);return n}(R);function U(t){return function(){var e=babelHelpers.getPrototypeOf(t),n;if(H()){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(e,arguments,s)}else{n=e.apply(this,arguments)}return babelHelpers.possibleConstructorReturn(this,n)}}function H(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(t){return false}}var F=function(t){babelHelpers.inherits(n,t);var e=U(n);function n(t){var s;babelHelpers.classCallCheck(this,n);s=e.call(this,t);s.url=S.Type.isString(t.url)&&t.url.length>0?t.url:"";return s}babelHelpers.createClass(n,[{key:"getType",value:function t(){return n.type()}},{key:"getIcon",value:function t(){return"check"}}],[{key:"type",value:function t(){return"check"}}]);return n}(R);function X(t){return function(){var e=babelHelpers.getPrototypeOf(t),n;if(z()){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(e,arguments,s)}else{n=e.apply(this,arguments)}return babelHelpers.possibleConstructorReturn(this,n)}}function z(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(t){return false}}var V=function(t){babelHelpers.inherits(n,t);var e=X(n);function n(t){var s;babelHelpers.classCallCheck(this,n);s=e.call(this,t);s.url=S.Type.isString(t.url)&&t.url.length>0?t.url:"";return s}babelHelpers.createClass(n,[{key:"getType",value:function t(){return n.type()}},{key:"getIcon",value:function t(){return"check-sent"}}],[{key:"type",value:function t(){return"check-sent"}}]);return n}(R);function Y(t){return function(){var e=babelHelpers.getPrototypeOf(t),n;if(j()){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(e,arguments,s)}else{n=e.apply(this,arguments)}return babelHelpers.possibleConstructorReturn(this,n)}}function j(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(t){return false}}var G=function(t){babelHelpers.inherits(n,t);var e=Y(n);function n(t){var s;babelHelpers.classCallCheck(this,n);s=e.call(this,t);s.sum=typeof t.sum!="undefined"?t.sum:"0.00";s.title=S.Type.isString(t.title)&&t.title.length>0?t.title:"";s.currency=S.Type.isString(t.currency)&&t.currency.length>0?t.currency:"";return s}babelHelpers.createClass(n,[{key:"getType",value:function t(){return n.type()}},{key:"getIcon",value:function t(){return"cash"}}],[{key:"type",value:function t(){return"payment"}}]);return n}(R);function W(t){return function(){var e=babelHelpers.getPrototypeOf(t),n;if(K()){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(e,arguments,s)}else{n=e.apply(this,arguments)}return babelHelpers.possibleConstructorReturn(this,n)}}function K(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(t){return false}}var q=function(t){babelHelpers.inherits(n,t);var e=W(n);function n(t){var s;babelHelpers.classCallCheck(this,n);s=e.call(this,t);s.url=S.Type.isString(t.url)&&t.url.length>0?t.url:"";return s}babelHelpers.createClass(n,[{key:"getType",value:function t(){return n.type()}},{key:"getIcon",value:function t(){return"sent"}}],[{key:"type",value:function t(){return"sent"}}]);return n}(R);function Q(t){return function(){var e=babelHelpers.getPrototypeOf(t),n;if(J()){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(e,arguments,s)}else{n=e.apply(this,arguments)}return babelHelpers.possibleConstructorReturn(this,n)}}function J(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(t){return false}}var Z=function(t){babelHelpers.inherits(n,t);var e=Q(n);function n(){babelHelpers.classCallCheck(this,n);return e.apply(this,arguments)}babelHelpers.createClass(n,[{key:"getType",value:function t(){return n.type()}},{key:"getIcon",value:function t(){return"watch"}}],[{key:"type",value:function t(){return"watch"}}]);return n}(R);var tt=[M,F,V,G,q,Z];var et=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"create",value:function t(e){var n=tt.filter(function(t){return e.type===t.type()})[0];if(!n){throw new Error("Unknown field type '".concat(e.type,"'"))}return new n(e)}}]);return t}();var nt={props:["config"],data:function t(){return{url:this.config.url}},methods:{openSlider:function t(){var e=this;y.Manager.openSlider(this.url).then(function(){return e.onConfigure()})},onConfigure:function t(){this.$emit("on-configure")}},template:'\n\t\t<div class="ui-alert ui-alert-danger ui-alert-xs salescenter-app-payment-by-sms-item-container-alert">\n\t\t\t<span class="ui-alert-message">\n\t\t\t\t<slot name="sms-configure-text-alert"></slot>\n\t\t\t</span>\n\t\t\t<span class="salescenter-app-payment-by-sms-item-container-alert-config" @click="openSlider()">\n\t\t\t\t<slot name="sms-configure-text-setting"></slot>\n\t\t\t</span>\n\t\t</div>\n\t'};var st={template:'\n\t\t<div class="ui-alert ui-alert-danger ui-alert-icon-danger salescenter-app-payment-by-sms-item-container-alert">\n\t\t\t<span class="ui-alert-message">\n\t\t\t\t<slot name="sms-alert-text"></slot>\n\t\t\t</span>\t\t\t\n\t\t</div>\n\t'};var it={props:["list","config"],computed:{getSenderCode:function t(){return this.config.sender.code},getConfigUrl:function t(){return this.config.url},localize:function t(){return E.Vue.getFilteredPhrases("SALESCENTER_SENDER_LIST_CONTENT_")}},methods:{openSlider:function t(){var e=this;y.Manager.openSlider(this.getConfigUrl).then(function(){return e.onConfigure()})},onConfigure:function t(){this.$emit("on-configure")},onSelectedSender:function t(e){this.$emit("on-selected",e)},render:function t(e,n){var s=this;var i=[];var a=function t(n){e.innerHTML=n.target.innerHTML;s.setCode(n.currentTarget.getAttribute("data-item-sender-value"));s.popupMenu.close()};for(var r in n){if(!n.hasOwnProperty(r)){continue}i.push({text:n[r].name,dataset:{itemSenderValue:n[r].id},onclick:a})}i.push({text:this.localize.SALESCENTER_SENDER_LIST_CONTENT_SETTINGS,onclick:function t(){s.openSlider();s.popupMenu.close()}});this.popupMenu=new g.PopupMenuWindow({bindElement:e,items:i});this.popupMenu.show()},getName:function t(){if(S.Type.isArray(this.list)){for(var e in this.list){if(!this.list.hasOwnProperty(e)){continue}if(this.list[e].id===this.getSenderCode){return this.list[e].name}}}return null},setCode:function t(e){if(typeof e==="string"){this.onSelectedSender(e);return}this.onSelectedSender(e.target.value)},isShow:function t(){return S.Type.isString(this.getName())}},template:'\n\t\t<div v-if="isShow()" class="salescenter-app-payment-by-sms-item-container-sms-content-info">\n\t\t\t<slot name="sms-sender-list-text-send-from"></slot>\n\t\t\t<span @click="render($event.target, list)">{{getName()}}</span>\n\t\t</div>\n\t'};var at={props:{config:{type:Object,required:true}},components:{"delivery-selector":P},methods:{onChange:function t(e){this.$store.dispatch("orderCreation/setDelivery",e.deliveryPrice);this.$store.dispatch("orderCreation/setDeliveryId",e.deliveryServiceId);this.$store.dispatch("orderCreation/setPropertyValues",e.relatedPropsValues);this.$store.dispatch("orderCreation/setDeliveryExtraServicesValues",e.relatedServicesValues);this.$store.dispatch("orderCreation/setExpectedDelivery",e.estimatedDeliveryPrice);this.$store.dispatch("orderCreation/setDeliveryResponsibleId",e.responsibleUser?e.responsibleUser.id:null)},onSettingsChanged:function t(){this.$emit("delivery-settings-changed")}},created:function t(){this.$store.dispatch("orderCreation/setPersonTypeId",this.config.personTypeId)},computed:babelHelpers.objectSpread({localize:function t(){return E.Vue.getFilteredPhrases("SALESCENTER_")},sumTitle:function t(){return S.Loc.getMessage("SALESCENTER_PRODUCT_PRODUCTS_PRICE")},productsPriceFormatted:function t(){return this.order.total.result},productsPrice:function t(){return this.order.total.resultNumeric},delivery:function t(){return this.order.delivery},deliveryFormatted:function t(){if(this.isDeliveryCalculated){return BX.Currency.currencyFormat(this.delivery,this.config.currency,false)}},total:function t(){if(this.productsPrice===null||this.delivery===null){return null}return this.productsPrice+this.delivery},totalFormatted:function t(){return BX.Currency.currencyFormat(this.total,this.config.currency,false)},isDeliveryCalculated:function t(){return this.order.delivery!==null},actionData:function t(){return{basketItems:this.config.basket,options:{sessionId:this.config.sessionId,ownerTypeId:this.config.ownerTypeId,ownerId:this.config.ownerId}}}},b.Vuex.mapState({order:function t(e){return e.orderCreation}})),template:'\n\t\t<delivery-selector\n\t\t\t:editable="this.config.editable"\n\t\t\t:init-is-calculated="config.isExistingItem"\t\t\n\t\t\t:init-estimated-delivery-price="config.expectedDeliveryPrice"\t\t\n\t\t\t:init-entered-delivery-price="config.deliveryPrice"\n\t\t\t:init-delivery-service-id="config.deliveryServiceId"\n\t\t\t:init-related-services-values="config.relatedServicesValues"\n\t\t\t:init-related-props-values="config.relatedPropsValues"\n\t\t\t:init-responsible-id="config.responsibleId"\n\t\t\t:person-type-id="config.personTypeId"\n\t\t\t:action="\'salescenter.api.order.refreshDelivery\'"\n\t\t\t:action-data="actionData"\n\t\t\t:external-sum="productsPrice"\n\t\t\t:external-sum-label="sumTitle"\n\t\t\t:currency="config.currency"\n\t\t\t:currency-symbol="config.currencySymbol"\n\t\t\t@change="onChange"\n\t\t\t@settings-changed="onSettingsChanged"\n\t\t></delivery-selector>\n\t'};function rt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div data-item-value="','" class="salescenter-app-payment-by-sms-select-popup-option" style="background-color:',';" onclick="','">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t"]);rt=function e(){return t};return t}function ot(){var t=babelHelpers.taggedTemplateLiteral(['<div class="salescenter-app-payment-by-sms-select-popup"></div>']);ot=function e(){return t};return t}var lt="salescenter-app-payment-by-sms-item";E.Vue.component(_.templateAddPaymentBySmsItem,{data:function t(){return{type:null,title:null,stage:null,itemData:null,set:null,infoHover:false,smsEditMessageMode:false,smsSenders:null,layout:{paymentInfo:null}}},props:["data","index"],mixins:[w],components:{"sms-configure-block":nt,"sms-alert-block":st,"sms-sender-list-block":it,"delivery-selector":at},mounted:function t(){this.layout.paymentInfo=this.paymentInfo;this.loadData()},computed:babelHelpers.objectSpread({getSmsSenderConfig:function t(){return{url:this.$root.$app.urlSettingsSmsSenders,phone:this.$root.$app.options.contactPhone,sender:{code:this.$root.$app.sendingMethodDesc.provider}}},deliverySelectorConfig:function t(){var e=null;if(this.$root.$app.options.hasOwnProperty("shipmentData")&&this.$root.$app.options.shipmentData.hasOwnProperty("deliveryServiceId")){e=this.$root.$app.options.shipmentData.deliveryServiceId}var n=null;if(this.$root.$app.options.hasOwnProperty("shipmentData")&&this.$root.$app.options.shipmentData.hasOwnProperty("responsibleId")){n=this.$root.$app.options.shipmentData.responsibleId}else{n=this.$root.$app.options.assignedById}var s=null;if(this.$root.$app.options.hasOwnProperty("shipmentData")&&this.$root.$app.options.shipmentData.hasOwnProperty("deliveryPrice")){s=this.$root.$app.options.shipmentData.deliveryPrice}var i=null;if(this.$root.$app.options.hasOwnProperty("shipmentData")&&this.$root.$app.options.shipmentData.hasOwnProperty("deliveryPrice")){i=this.$root.$app.options.shipmentData.expectedDeliveryPrice}var a={};if(this.$root.$app.options.hasOwnProperty("orderPropertyValues")&&!Array.isArray(this.$root.$app.options.orderPropertyValues)){a=this.$root.$app.options.orderPropertyValues}var r={};if(this.$root.$app.options.hasOwnProperty("shipmentData")&&this.$root.$app.options.shipmentData.hasOwnProperty("extraServicesValues")&&!Array.isArray(this.$root.$app.options.shipmentData.extraServicesValues)){r=this.$root.$app.options.shipmentData.extraServicesValues}var o=parseInt(this.$root.$app.options.associatedEntityId)>0;return{isExistingItem:o,personTypeId:this.$root.$app.options.personTypeId,basket:this.order.basket,currencySymbol:this.$root.$app.options.currencySymbol,currency:this.order.currency,ownerTypeId:this.$root.$app.options.ownerTypeId,ownerId:this.$root.$app.options.ownerId,sessionId:this.$root.$app.options.sessionId,relatedPropsValues:a,relatedServicesValues:r,deliveryServiceId:e,responsibleId:n,deliveryPrice:s,expectedDeliveryPrice:i,editable:this.editable}},countItems:function t(){return this.order.basket.length},listeners:function t(){return{blur:this.adjustUpdateMessage,keydown:this.pressKey}}},b.Vuex.mapState({order:function t(e){return e.orderCreation}})),methods:{pressKey:function t(e){if(e.code==="Enter"){this.adjustUpdateMessage();this.smsEditMessageMode=false}},isHasLink:function t(){return this.$root.$app.sendingMethodDesc.text.match(/#LINK#/)},getSmsMessage:function t(){var e='<span class="'.concat(lt,'-container-sms-content-message-link">').concat(this.$root.$app.orderPublicUrl,'</span><sapn class="').concat(lt,'-container-sms-content-message-link-ref">xxxxx</sapn>')+" ";return this.$root.$app.sendingMethodDesc.text.replace(/#LINK#/g,e)},updateMessage:function t(){this.$root.$app.sendingMethodDesc.text=this.$refs.smsMessageNode.innerText},saveSmsTemplate:function t(e){BX.ajax.runComponentAction("bitrix:salescenter.app","saveSmsTemplate",{mode:"class",data:{smsTemplate:e},analyticsLabel:"salescenterSmsTemplateChange"})},adjustUpdateMessage:function t(e){this.updateMessage();if(!this.isHasLink()){this.showPopupHint(this.$refs.smsMessageNode,S.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER_TEMPLATE_ERROR"),2e3)}else{this.saveSmsTemplate(this.$root.$app.sendingMethodDesc.text)}if(e&&e.type==="blur"){this.smsEditMessageMode=false}},loadData:function t(){this.type=this.data.type;this.title=this.data.title;this.stage=this.data.stage;this.set=this.data.set;this.itemData=this.data.itemData||null;if(this.isTemplateBeSendSms()){this.smsSenders=this.data.itemData.smsSenders;if(this.smsSenders){this.setProviderDefault()}}},setProviderDefault:function t(){this.$root.$app.sendingMethodDesc.provider=this.smsSenders.length!==0?this.smsSenders[0].id:null},isTemplateBeSendSms:function t(){return this.type==="BEE_SEND_SMS"},isTemplateSelectProduct:function t(){return this.type==="SELECT_PRODUCTS"},isTemplatePaySystem:function t(){return this.type==="PAY_SYSTEM"},isTemplateCashBox:function t(){return this.type==="CASHBOX"},isTemplateAutomationBox:function t(){return this.type==="AUTOMATION"},isTemplateDeliveryBox:function t(){return this.type==="DELIVERY"},isItemsSet:function t(){return this.set},refreshBasket:function t(){this.$store.dispatch("orderCreation/refreshBasket")},changeBasketItem:function t(e){this.$store.dispatch("orderCreation/changeBasketItem",{index:e.index,fields:e.fields})},removeItem:function t(e){this.$store.dispatch("orderCreation/removeItem",{index:e.index});this.refreshBasket()},showItem:function t(e){var n=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(e.hasOwnProperty("width")){s.width=Number(e.width)}if(e.hasOwnProperty("type")&&e.type==="marketplace"){this.showRestApplication(e,s)}else{s["width"]=835;y.Manager.openSlider(e.link,s).then(function(){return n.getAjaxData()})}},showRestApplication:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(e.hasOwnProperty("installedApp")&&e.installedApp){this.openRestAppLayout(e.id,e.code)}else{this.openMarketPlacePage(e.code,n)}},openMarketPlacePage:function t(e){var n=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var i="/marketplace/detail/#app#/";var a=i.replace("#app#",encodeURIComponent(e));y.Manager.openSlider(a,s).then(function(){return n.getAjaxData()})},openRestAppLayout:function t(e,n){BX.ajax.runComponentAction("bitrix:salescenter.app","getRestApp",{data:{code:n}}).then(function(t){var s=t.data;if(s.TYPE==="A"){this.showRestApplication(n)}else{BX.rest.AppLayout.openApplication(e)}}.bind(this)).catch(function(t){this.restAppErrorPopup(" ",t.errors.pop().message)}.bind(this))},restAppErrorPopup:function t(e,n){var s=new g.PopupWindow("rest-app-error-alert",null,{closeIcon:true,closeByEsc:true,autoHide:false,titleBar:e,content:n,zIndex:16e3,overlay:{color:"gray",opacity:30},buttons:[new g.PopupWindowButton({id:"close",text:S.Loc.getMessage("SALESCENTER_JS_POPUP_CLOSE"),events:{click:function t(){s.close()}}})],events:{onPopupClose:function t(){this.destroy()},onPopupDestroy:function t(){s=null}}});s.show()},isAddItemClass:function t(e){if(!e.hasOwnProperty("type")){return true}return!["paysystem","marketplace","delivery"].includes(e.type)},getAjaxData:function t(){BX.ajax.runComponentAction("bitrix:salescenter.app","getAjaxData",{mode:"class",data:{type:this.type}}).then(function(t){if(t.data){this.updateTemplate(t.data)}}.bind(this))},updateTemplate:function t(e){this.data.itemData=e;this.data.type=this.type;if(typeof this.data.itemData.isSet!=="undefined"){this.data.set=this.data.itemData.isSet;this.data.stage=this.data.itemData.isSet?"complete":"disabled"}if(this.isTemplatePaySystem()){this.data.title=this.data.itemData.isSet?S.Loc.getMessage("SALESCENTER_PAYSYSTEM_SET_BLOCK_TITLE"):S.Loc.getMessage("SALESCENTER_PAYSYSTEM_BLOCK_TITLE")}else if(this.isTemplateCashBox()){this.data.title=this.data.itemData.isSet?S.Loc.getMessage("SALESCENTER_CASHBOX_SET_BLOCK_TITLE"):S.Loc.getMessage("SALESCENTER_CASHBOX_BLOCK_TITLE")}this.loadData()},showPaySystemSettingsHint:function t(){return!this.isItemsSet()&&this.isTemplatePaySystem()},showCashBoxSettingsHint:function t(){return!this.isItemsSet()&&this.isTemplateCashBox()},showPopupHint:function t(e,n,s){var i=this;if(this.popup){this.popup.destroy();this.popup=null}if(!e&&!n){return}this.popup=new g.Popup(null,e,{events:{onPopupClose:function t(){i.popup.destroy();i.popup=null}},darkMode:true,content:n,offsetLeft:e.offsetWidth});if(s){setTimeout(function(){i.popup.destroy();i.popup=null},s)}this.popup.show()},showSmsMessagePopupHint:function t(e){this.showPopupHint(e,S.Loc.getMessage("SALESCENTER_SMS_MESSAGE_HINT"))},showSelectPopup:function t(e,n,s){var i=this;if(!e){return}this.selectPopup=new g.Popup(null,e,{closeByEsc:true,autoHide:true,width:250,offsetTop:5,events:{onPopupClose:function t(){i.selectPopup.destroy()}},content:this.getSelectPopupContent(n,s)});this.selectPopup.show()},getSelectPopupContent:function t(e,n){var s=this;if(!this.selectPopupContent){this.selectPopupContent=S.Tag.render(ot());var i=function t(e){s.onChooseSelectOption(e,n)};for(var a=0;a<e.length;a++){var r=S.Tag.render(rt(),e[a].id,e[a].color?e[a].color:"",i.bind(this),e[a].name);if(e[a].colorText==="light"){r.style.color="#fff"}S.Dom.append(r,this.selectPopupContent)}}return this.selectPopupContent},onChooseSelectOption:function t(e,n){var s=document.getElementById(n);s.textContent=e.currentTarget.textContent;s.style.color=e.currentTarget.style.color;s.nextElementSibling.style.borderColor=e.currentTarget.style.color;s.parentNode.style.background=e.currentTarget.style.backgroundColor;if(n==="stageOnOrderPaid"){this.$root.$app.stageOnOrderPaid=e.currentTarget.getAttribute("data-item-value")}else if(n==="delivery"){this.$root.$app.delivery=e.currentTarget.getAttribute("data-item-value")}this.selectPopup.destroy()},hidePopupHint:function t(){if(this.popup){this.popup.destroy()}},adjustSmsEditMessageMode:function t(){this.smsEditMessageMode?this.smsEditMessageMode=false:this.smsEditMessageMode=true},isSmsEditMessageMode:function t(){return this.smsEditMessageMode},smsSenderConfigure:function t(){var e=this;S.ajax.runComponentAction("bitrix:salescenter.app","getSmsSenderList",{mode:"class"}).then(function(t){if(BX.type.isObject(t.data)&&Object.values(t.data).length>0){e.smsSenders=[];Object.values(t.data).forEach(function(t){return e.smsSenders.push({name:t.name,id:t.id})});e.setProviderDefault()}})},smsSenderSelected:function t(e){this.$root.$app.sendingMethodDesc.provider=e},hasContactPhone:function t(){return!(this.getSmsSenderConfig.phone==="")},showCompanyContacts:function t(e){this.$root.$emit("on-show-company-contacts",e)}},template:'\n\t<div class="'.concat(lt,"\" \n\t\t:class=\"{ \n\t\t'salescenter-app-payment-by-sms-item-current': stage === 'current', \n\t\t'salescenter-app-payment-by-sms-item-disabled': stage === 'disabled',\n\t\t'salescenter-app-payment-by-sms-item-disabled-bg': !isItemsSet() && (isTemplatePaySystem() || isTemplateCashBox())\n\t\t}\">\n\t\t<div class=\"").concat(lt,'-counter">\n\t\t\t<div class="').concat(lt,'-counter-rounder"></div>\n\t\t\t<div class="').concat(lt,'-counter-line"></div>\n\t\t\t<div class="').concat(lt,'-counter-number">\n\t\t\t\t<div v-if="stage === \'complete\'" class="').concat(lt,'-counter-number-checker"></div>\n\t\t\t\t<div class="').concat(lt,'-counter-number-text">{{ index }}</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="').concat(lt,'-title">\n\t\t\t<div class="').concat(lt,'-title-text">{{ title }}</div>\n\t\t\t<div v-if="showPaySystemSettingsHint()" v-on:click="BX.Salescenter.Manager.openHowToConfigPaySystem(event)" class="').concat(lt,'-title-info">').concat(S.Loc.getMessage("SALESCENTER_PAYSYSTEM_BLOCK_SETTINGS_TITLE"),'</div>\n\t\t\t<div v-if="showCashBoxSettingsHint()" v-on:click="BX.Salescenter.Manager.openHowToConfigCashBox(event)" class="').concat(lt,'-title-info">').concat(S.Loc.getMessage("SALESCENTER_CASHBOX_BLOCK_SETTINGS_TITLE"),'</div>\n\t\t\t<div v-if="isTemplateBeSendSms()" v-on:click="showCompanyContacts(event)" class="').concat(lt,'-title-info">').concat(S.Loc.getMessage("SALESCENTER_LEFT_PAYMENT_COMPANY_CONTACTS"),'</div>\n\t\t</div>\n\t\t<div class="').concat(lt,'-container" v-bind:class="{ \'salescenter-app-payment-by-sms-item-container-offtop salescenter-app-payment-by-sms-item-container--inline\': isTemplateBeSendSms() }">\n\t\t\t\x3c!--BEE_SEND_SMS--\x3e\n\t\t\t<template v-if="isTemplateBeSendSms() && smsSenders.length === 0">\n\t\t\t\t<component :is="\'sms-configure-block\'"\n\t\t\t\t\t:config="getSmsSenderConfig"\n\t\t\t\t\tv-on:on-configure="smsSenderConfigure"\n\t\t\t\t>\n\t\t\t\t\t<template v-slot:sms-configure-text-alert>').concat(S.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER_NOT_CONFIGURED"),"</template>\n\t\t\t\t\t<template v-slot:sms-configure-text-setting>").concat(S.Loc.getMessage("SALESCENTER_PRODUCT_DISCOUNT_EDIT_PAGE_URL_TITLE"),'</template>\n\t\t\t\t</component>\n\t\t\t</template>\n\t\t\t<template v-if="isTemplateBeSendSms() && !hasContactPhone() && smsSenders.length !== 0">\n\t\t\t\t<component :is="\'sms-alert-block\'">\n\t\t\t\t\t<template v-slot:sms-alert-text>').concat(S.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER_ALERT_PHONE_EMPTY"),'</template>\n\t\t\t\t</component>\n\t\t\t</template>\n\t\t\t<div v-if="isTemplateBeSendSms()" class="').concat(lt,'-container-sms">\n\t\t\t\t<div class="').concat(lt,'-container-sms-user">\n\t\t\t\t\t<div class="').concat(lt,"-container-sms-user-avatar\" v-bind:style=\"[ itemData.manager.photo ? { 'background-image': 'url(' + itemData.manager.photo + ')'} : null ]\"></div>\n\t\t\t\t\t<div class=\"").concat(lt,'-container-sms-user-name">{{itemData.manager.name}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="').concat(lt,'-container-sms-content">\n\t\t\t\t\t<div class="').concat(lt,'-container-sms-content-message">\n\t\t\t\t\t\t<div \tv-if="smsEditMessageMode"\n\t\t\t\t\t\t\t\tcontenteditable="true" \n\t\t\t\t\t\t\t\tclass="').concat(lt,"-container-sms-content-message-text ").concat(lt,'-container-sms-content-message-text-edit"\n\t\t\t\t\t\t\t\tv-on="listeners"\n\t\t\t\t\t\t\t\tv-html="this.$root.$app.sendingMethodDesc.text"\n\t\t\t\t\t\t\t\tref="smsMessageNode">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-else contenteditable="false" class="').concat(lt,'-container-sms-content-message-text" v-html="getSmsMessage()" v-on:mouseenter="showSmsMessagePopupHint($event.target)" v-on:mouseleave="hidePopupHint()">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="').concat(lt,'-container-sms-content-edit" v-bind:class="{ \'salescenter-app-payment-by-sms-item-container-sms-content-save\': isSmsEditMessageMode() }" @click="adjustSmsEditMessageMode"></div>\n\t\t\t\t\t</div>\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t<component :is="\'sms-sender-list-block\'"\n\t\t\t\t\t\t:list="smsSenders"\n\t\t\t\t\t\t:config="getSmsSenderConfig"\n\t\t\t\t\t\tv-on:on-configure="smsSenderConfigure"\n\t\t\t\t\t\tv-on:on-selected="smsSenderSelected" \n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot:sms-sender-list-text-send-from>').concat(S.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER"),'</template>\n\t\t\t\t\t</component>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t\x3c!--SELECT_PRODUCTS--\x3e\n\t\t\t<div v-if="isTemplateSelectProduct()" class="').concat(lt,'-container-payment">\n\t\t\t\t<').concat(_.templateAddPaymentName,'/>\n\t\t\t</div>\n\t\t\t\n\t\t\t\x3c!--PAY_SYSTEM--\x3e\n\t\t\t<div v-if="isTemplatePaySystem()" class="').concat(lt,'-container-payment">\n\t\t\t\t<template v-if="isItemsSet()">\n\t\t\t\t\t<div class="').concat(lt,'-container-payment-inline">\n\t\t\t\t\t\t<div v-for="item in itemData.items" v-on:click="showItem(item, {width: 1000})" class="').concat(lt,'-container-payment-item-text">{{item.name}}</div>\n\t\t\t\t\t\t<br><div v-on:click="showItem(itemData.paysystemPanel)" class="').concat(lt,'-container-payment-item-text-add">{{itemData.paysystemPanel.name}}</div>\n\t\t\t\t\t\t<div v-if="itemData.paysystemForm" v-on:click="showItem(itemData.paysystemForm)" class="').concat(lt,'-container-payment-item-text-add">{{itemData.paysystemForm.name}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div v-for="item in itemData.items" v-on:click="showItem(item)" v-bind:class="[isAddItemClass(item) ? \'').concat(lt,"-container-payment-item-added' : '', '").concat(lt,'-container-payment-item\']">\n\t\t\t\t\t\t<div class="').concat(lt,'-container-payment-item-contet">\n\t\t\t\t\t\t\t<template v-if="item.img">\n\t\t\t\t\t\t\t\t<div class="').concat(lt,'-container-payment-item-info" v-on:mouseenter="showPopupHint($event.target, item.info)" v-on:mouseleave="hidePopupHint()"></div>\n\t\t\t\t\t\t\t\t<img class="').concat(lt,'-container-payment-item-img" :src="item.img">\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<span v-else class="').concat(lt,'-container-payment-item-added-text">{{ item.name }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t\n\t\t\t\x3c!--CASHBOX--\x3e\n\t\t\t<div v-if="isTemplateCashBox()" class="').concat(lt,'-container-payment">\n\t\t\t\t<template v-if="isItemsSet()">\n\t\t\t\t\t<div class="').concat(lt,'-container-payment-inline">\n\t\t\t\t\t\t<div v-for="item in itemData.items" v-on:click="showItem(item, {width: 1000})" class="').concat(lt,'-container-payment-item-text">{{item.name}}</div>\n\t\t\t\t\t\t<br><div v-on:click="showItem(itemData.cashboxPanel)" class="').concat(lt,'-container-payment-item-text-add">{{itemData.cashboxPanel.name}}</div>\n\t\t\t\t\t\t<div v-if="itemData.cashboxForm" v-on:click="showItem(itemData.cashboxForm)" class="').concat(lt,'-container-payment-item-text-add">{{itemData.cashboxForm.name}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div v-for="item in itemData.items" v-on:click="showItem(item)" v-bind:class="[item.type !== \'cashbox\' ? \'').concat(lt,"-container-payment-item-added' : '', '").concat(lt,'-container-payment-item\']">\n\t\t\t\t\t\t<div class="').concat(lt,'-container-payment-item-contet">\n\t\t\t\t\t\t\t <template v-if="item.type === \'cashbox\'" >\n\t\t\t\t\t\t\t\t<div class="').concat(lt,'-container-payment-item-info" v-on:mouseenter="showPopupHint($event.target, item.info)" v-on:mouseleave="hidePopupHint()"></div>\n\t\t\t\t\t\t\t\t<img class="').concat(lt,'-container-payment-item-img" :src="item.img">\n\t\t\t\t\t\t\t\t<div v-if="item.showTitle" class="').concat(lt,'-container-payment-item-title-text">{{ item.name }}</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<span v-else class="').concat(lt,'-container-payment-item-added-text">{{ item.name }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t\n\t\t\t\x3c!--AUTOMATION--\x3e\n\t\t\t<div v-if="isTemplateAutomationBox()" class="').concat(lt,'-container-payment">\n\t\t\t\t<div class="').concat(lt,'-container-select">\n\t\t\t\t\t<div class="').concat(lt,'-container-select-text">').concat(S.Loc.getMessage("SALESCENTER_AUTOMATION_BLOCK_TEXT"),'</div>\n\t\t\t\t\t<template v-for="item in itemData">\n\t\t\t\t\t\t<div v-if="item.selected" class="').concat(lt,'-container-select-inner" v-bind:style="{background:item.color}" v-on:click="showSelectPopup($event.currentTarget, itemData, \'stageOnOrderPaid\')">\n\t\t\t\t\t\t\t<div  class="').concat(lt,'-container-select-item" id="stageOnOrderPaid">\n\t\t\t\t\t\t\t\t{{item.name}}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span class="').concat(lt,'-container-select-arrow"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t\x3c!--DELIVERY--\x3e\n\t\t\t<div v-if="isTemplateDeliveryBox()" class="').concat(lt,'-container-payment">\n\t\t\t\t<template v-if="itemData.isInstalled">\n\t\t\t\t\t<div class="').concat(lt,'-container-select">\n\t\t\t\t\t\t<delivery-selector @delivery-settings-changed="getAjaxData" :config="deliverySelectorConfig"></delivery-selector>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div v-for="item in itemData.items" v-on:click="showItem(item)" v-bind:class="[isAddItemClass(item) ? \'').concat(lt,"-container-payment-item-added' : '', '").concat(lt,'-container-payment-item\']">\n\t\t\t\t\t\t<div class="').concat(lt,'-container-payment-item-contet">\n\t\t\t\t\t\t\t<template v-if="item.img">\n\t\t\t\t\t\t\t\t<div class="').concat(lt,'-container-payment-item-info" v-on:mouseenter="showPopupHint($event.target, item.info)" v-on:mouseleave="hidePopupHint()"></div>\n\t\t\t\t\t\t\t\t<div :style="{backgroundImage:\'url(\'+encodeURI(item.img)+\')\'}" class="').concat(lt,'-container-payment-item-img-del" :class="{ \'').concat(lt,'-container-payment-item-img-del-title\' : item.showTitle}"></div>\n\t\t\t\t\t\t\t\t<div v-if="item.showTitle" class="').concat(lt,'-container-payment-item-title-text">{{ item.name }}</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<span v-else class="').concat(lt,'-container-payment-item-added-text">{{ item.name }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t')});var ct={props:["item"],computed:{localize:function t(){return E.Vue.getFilteredPhrases("SALESCENTER_TIMELINE_ITEM_CONTENT_")}},template:'\n\t\t<div class="salescenter-app-payment-by-sms-timeline-content">\n\t\t\t<span class="salescenter-app-payment-by-sms-timeline-content-text">\n\t\t\t\t<slot name="timeline-content-text"></slot>\t\t\t\t\n\t\t\t\t<a :href="item.url" v-if="item.url" target="_blank">\n\t\t\t\t\t{{localize.SALESCENTER_TIMELINE_ITEM_CONTENT_VIEW}}\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t</div>\n\t'};var dt={props:["item"],components:{"timeline-item-content-block":ct},template:'\n\t\t<div class="salescenter-app-payment-by-sms-timeline-item"\n\t\t\t:class="{\n\t\t\t\t\'salescenter-app-payment-by-sms-timeline-item-disabled\' : item.disabled\n\t\t\t}"\n\t\t>\n\t\t\t<div class="salescenter-app-payment-by-sms-item-counter">\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-line"></div>\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-icon " \n\t\t\t\t\t:class="\'salescenter-app-payment-by-sms-item-counter-icon-\'+item.icon"></div>\n\t\t\t</div>\n\t\t\t<component :is="\'timeline-item-content-block\'" \n\t\t\t\t:item="item">\n\t\t\t\t<template v-slot:timeline-content-text>{{item.content}}</template>\n\t\t\t</component>\t\n\t\t</div>\n\t'};var ut={props:["item"],template:'\n\t\t<div class="salescenter-app-payment-by-sms-timeline-item salescenter-app-payment-by-sms-timeline-item-payment"\n\t\t\t:class="{\n\t\t\t\t\'salescenter-app-payment-by-sms-timeline-item-disabled\' : item.disabled\n\t\t\t}"\n\t\t>\n\t\t\t<div class="salescenter-app-payment-by-sms-item-counter">\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-line"></div>\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-icon " \n\t\t\t\t\t:class="\'salescenter-app-payment-by-sms-item-counter-icon-\'+item.icon"></div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class="salescenter-app-payment-by-sms-timeline-content">\n\t\t\t\t<span class="salescenter-app-payment-by-sms-timeline-content-price">\n\t\t\t\t\t<span v-html="item.sum"></span>\n\t\t\t\t\t<span class="salescenter-app-payment-by-sms-timeline-content-price-cur" v-html="item.currency"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="salescenter-app-payment-by-sms-timeline-content-text-strong">\n\t\t\t\t\t{{item.title}}\n\t\t\t\t</span>\n\t\t\t\t<span class="salescenter-app-payment-by-sms-timeline-content-text">\n\t\t\t\t\t{{item.content}}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t'};var pt={props:["items"],components:{"timeline-item-block":dt,"timeline-item-payment-block":ut},computed:{localize:function t(){return E.Vue.getFilteredPhrases("SALESCENTER_TIMELINE_")}},data:function t(){return{}},template:'\n\t\t<div class="salescenter-app-payment-by-sms-timeline">\n\t\t\t<template v-for="(item) in items" >\n\t\t\t\t<component v-if="item.type == \'payment\'" :is="\'timeline-item-payment-block\'" :item="item"/>\n\t\t\t\t<component v-else :is="\'timeline-item-block\'" :item="item"/>\n\t\t\t</template>\n\t\t</div>\n\t'};E.Vue.component(_.templateAddPaymentBySms,{props:["isAllowedSubmitButton"],mixins:[w],components:{"timeline-list-block":pt},data:function t(){var e=[{sort:100,type:"BEE_SEND_SMS",title:this.$root.$app.options.contactBlock.title,stage:"complete",itemData:this.$root.$app.options.contactBlock},{sort:200,type:"SELECT_PRODUCTS",title:S.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_TITLE"),stage:this.$root.$app.options.basket&&this.$root.$app.options.basket.length>0?"complete":"current"},{sort:300,type:"PAY_SYSTEM",title:this.$root.$app.options.paySystemList.isSet?S.Loc.getMessage("SALESCENTER_PAYSYSTEM_SET_BLOCK_TITLE"):S.Loc.getMessage("SALESCENTER_PAYSYSTEM_BLOCK_TITLE"),stage:this.$root.$app.options.paySystemList.isSet?"complete":"disabled",set:this.$root.$app.options.paySystemList.isSet,itemData:this.$root.$app.options.paySystemList}];if(this.$root.$app.options.isAutomationAvailable){e.push({sort:500,type:"AUTOMATION",title:S.Loc.getMessage("SALESCENTER_AUTOMATION_BLOCK_TITLE"),stage:"complete",itemData:this.$root.$app.options.dealStageList})}if(this.$root.$app.options.cashboxList.hasOwnProperty("items")){e.push({sort:400,type:"CASHBOX",title:this.$root.$app.options.cashboxList.isSet?S.Loc.getMessage("SALESCENTER_CASHBOX_SET_BLOCK_TITLE"):S.Loc.getMessage("SALESCENTER_CASHBOX_BLOCK_TITLE"),stage:this.$root.$app.options.cashboxList.isSet?"complete":"disabled",set:this.$root.$app.options.cashboxList.isSet,itemData:this.$root.$app.options.cashboxList})}if(this.$root.$app.options.deliveryList.hasOwnProperty("items")){e.push({sort:600,type:"DELIVERY",title:S.Loc.getMessage("SALESCENTER_DELIVERY_BLOCK_TITLE"),stage:"disabled",itemData:this.$root.$app.options.deliveryList})}e.sort(function(t,e){return t.sort-e.sort});return{title:S.Loc.getMessage("SALESCENTER_LEFT_CREATE_LINK_AND_SEND"),data:this.$root.$app,steps:e,timeline:{items:[{sum:"",url:"",type:"",title:"",content:"",currency:"",disabled:""}]}}},computed:{config:function t(){return _},localize:function t(){return E.Vue.getFilteredPhrases("SALESCENTER_TIMELINE_")},iMessageAvailable:function t(){return this.$root.$app.isApplePayAvailable&&this.$root.$app.connector==="imessage"}},created:function t(){this.timelineItemsInit()},methods:{timelineItemsInit:function t(){var e=this;if(BX.type.isObject(this.$root.$app.options.timeline)&&Object.values(this.$root.$app.options.timeline).length>0){this.timeline.items=[];Object.values(this.$root.$app.options.timeline).forEach(function(t){return e.timeline.items.push(et.create(t))})}},send:function t(e){this.$emit("send",e)},initTileGrid:function t(){console.log("initTileGrid")}},template:'\n\t<div class="salescenter-app-payment-by-sms">\n\t\t<div class="salescenter-app-payment-by-sms-title">{{ title }}</div>\n\t\t<component \n\t\t\t:is="config.templateAddPaymentBySmsItem"\n\t\t\tv-for="(step, index) in steps"\n\t\t\t:index="index + 1"\n\t\t\t:data="step"\n\t\t\t:complete="step.complete"\n\t\t\t:current="step.current"></component>\n\t\t\t<div :class="{\n\t\t\t\t\'salescenter-app-payment-by-sms-item-disabled\': !this.isAllowedSubmitButton\n\t\t\t\t}" class="salescenter-app-payment-by-sms-item salescenter-app-payment-by-sms-item-send salescenter-app-payment-by-sms-item">\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter">\n\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-rounder"></div>\n\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-line"></div>\n\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-number"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container">\n\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-payment">\n\t\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-payment-inline">\n\t\t\t\t\t\t\t<div class="ui-btn ui-btn-lg ui-btn-success ui-btn-round" v-on:click="send($event)" v-if="editable">'.concat(S.Loc.getMessage("SALESCENTER_SEND"),'</div>\n\t\t\t\t\t\t\t<div class="ui-btn ui-btn-lg ui-btn-success ui-btn-round" v-on:click="send($event)" v-else >').concat(S.Loc.getMessage("SALESCENTER_RESEND"),'</div>\n\t\t\t\t\t\t\t<div v-on:click="BX.Salescenter.Manager.openWhatClientSee(event)" class="salescenter-app-add-item-link">').concat(S.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER_TEMPLATE_WHAT_DOES_CLIENT_SEE"),'</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="iMessageAvailable" class="salescenter-app-payment-container">\n\t\t\t\t<label class="ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t<input type="checkbox" class="ui-ctl-element" @change="handleIMessagePayment($event)">\n\t\t\t\t\t<div class="ui-ctl-label-text">{{localize.SALESCENTER_IMESSAGE_PAYMENT}}</div>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t<component :is="\'timeline-list-block\'" :items="timeline.items"/>\n\t</div>\n\t')});var mt=function(){function t(){var e=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{dialogId:null,sessionId:null,lineId:null,orderAddPullTag:null,landingPublicationPullTag:null,landingUnPublicationPullTag:null,isFrame:true,isOrderPublicUrlAvailable:false,isCatalogAvailable:false,isOrderPublicUrlExists:false,isApplePayAvailable:false};babelHelpers.classCallCheck(this,t);this.slider=BX.SidePanel.Instance.getTopSlider();this.dialogId=n.dialogId;this.sessionId=parseInt(n.sessionId);this.lineId=parseInt(n.lineId);this.orderAddPullTag=n.orderAddPullTag;this.landingPublicationPullTag=n.landingPublicationPullTag;this.landingUnPublicationPullTag=n.landingUnPublicationPullTag;this.paySystemList=n.paySystemList;this.cashboxList=n.cashboxList;this.options=n;this.isProgress=false;this.fillPagesTimeout=false;this.disableSendButton=false;this.context="";this.fillPagesQueue=[];this.ownerTypeId="";this.ownerId="";this.stageOnOrderPaid="";this.sendingMethod="";this.sendingMethodDesc={};this.urlSettingsSmsSenders=n.urlSettingsSmsSenders;this.iMessage=false;this.isApplePayAvailable=n.isApplePayAvailable;this.orderPublicUrl="";this.fileControl=n.fileControl;if(S.Type.isString(n.stageOnOrderPaid)){this.stageOnOrderPaid=n.stageOnOrderPaid}if(S.Type.isBoolean(n.isFrame)){this.isFrame=n.isFrame}else{this.isFrame=true}if(S.Type.isBoolean(n.isOrderPublicUrlAvailable)){this.isOrderPublicUrlAvailable=n.isOrderPublicUrlAvailable}else{this.isOrderPublicUrlAvailable=false}if(S.Type.isBoolean(n.isOrderPublicUrlExists)){this.isOrderPublicUrlExists=n.isOrderPublicUrlExists}else{this.isOrderPublicUrlExists=false}if(S.Type.isString(n.orderPublicUrl)){this.orderPublicUrl=n.orderPublicUrl}if(S.Type.isBoolean(n.isCatalogAvailable)){this.isCatalogAvailable=n.isCatalogAvailable}else{this.isCatalogAvailable=false}if(S.Type.isBoolean(n.disableSendButton)){this.disableSendButton=n.disableSendButton}if(n.ownerTypeId){this.ownerTypeId=n.ownerTypeId}if(n.ownerId){this.ownerId=n.ownerId}if(S.Type.isString(n.context)&&n.context.length>0){this.context=n.context}else if(this.sessionId&&this.dialogId){this.context="imopenlines_app"}if(S.Type.isBoolean(n.isPaymentsLimitReached)){this.isPaymentsLimitReached=n.isPaymentsLimitReached}else{this.isPaymentsLimitReached=false}if(!S.Type.isUndefined(n.sendingMethod)){this.sendingMethod=n.sendingMethod;this.sendingMethodDesc=this.options.sendingMethodDesc}this.isPaymentCreationAvailable=this.sessionId>0&&this.dialogId.length>0||this.ownerTypeId&&this.ownerId;this.connector=S.Type.isString(n.connector)?n.connector:"";S.Event.ready(function(){e.pull=BX.PULL;e.initPull();e.isSiteExists=y.Manager.isSiteExists});t.initStore().then(function(t){return e.initTemplate(t)}).catch(function(e){return t.showError(e)})}babelHelpers.createClass(t,[{key:"initPull",value:function t(){var e=this;if(this.pull){if(S.Type.isString(this.orderAddPullTag)){this.pull.subscribe({moduleId:_.moduleId,command:this.orderAddPullTag,callback:function t(n){if(parseInt(n.sessionId)===e.sessionId&&n.orderId>0){y.Manager.showOrdersListAfterCreate(n.orderId)}}})}if(S.Type.isString(this.landingPublicationPullTag)){this.pull.subscribe({moduleId:_.moduleId,command:this.landingPublicationPullTag,callback:function t(n){if(parseInt(n.landingId)>0){e.fillPages()}if(n.hasOwnProperty("isOrderPublicUrlAvailable")&&S.Type.isBoolean(n.isOrderPublicUrlAvailable)){e.isOrderPublicUrlAvailable=n.isOrderPublicUrlAvailable;e.isOrderPublicUrlExists=true}}})}if(S.Type.isString(this.landingUnPublicationPullTag)){this.pull.subscribe({moduleId:_.moduleId,command:this.landingUnPublicationPullTag,callback:function t(n){if(parseInt(n.landingId)>0){e.fillPages()}if(n.hasOwnProperty("isOrderPublicUrlAvailable")&&S.Type.isBoolean(n.isOrderPublicUrlAvailable)){e.isOrderPublicUrlAvailable=n.isOrderPublicUrlAvailable;e.isOrderPublicUrlExists=true}}})}}}},{key:"initTemplate",value:function t(e){var n=this;return new Promise(function(t){var s=n;n.store=e.store;n.templateEngine=E.Vue.create({el:document.getElementById("salescenter-app-root"),template:"<".concat(_.templateName,"/>"),store:n.store,created:function t(){this.$app=s;this.$nodes={footer:document.getElementById("footer"),leftPanel:document.getElementById("left-panel"),title:document.getElementById("pagetitle"),paymentsLimit:document.getElementById("salescenter-payment-limit-container")}},mounted:function e(){t()}})})}},{key:"closeApplication",value:function t(){if(this.slider){this.slider.close()}}},{key:"fillPages",value:function t(){var n=this;return new Promise(function(t){if(n.isProgress){n.fillPagesQueue.push(t)}else{if(n.fillPagesTimeout){clearTimeout(n.fillPagesTimeout)}n.fillPagesTimeout=setTimeout(function(){n.startProgress();e.rest.callMethod("salescenter.page.list",{}).then(function(e){n.store.commit("application/setPages",{pages:e.answer.result.pages});n.stopProgress();t();n.fillPagesQueue.forEach(function(t){t()});n.fillPagesQueue=[]})},100)}})}},{key:"getLoader",value:function t(){if(!this.loader){this.loader=new s.Loader({size:200})}return this.loader}},{key:"showLoader",value:function t(){if(this.templateEngine){this.getLoader().show(this.templateEngine.$el)}}},{key:"hideLoader",value:function t(){this.getLoader().hide()}},{key:"startProgress",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.isProgress=true;this.showLoader();if(S.Type.isDomNode(e)){e.classList.add("ui-btn-wait")}}},{key:"stopProgress",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.isProgress=false;this.hideLoader();if(S.Type.isDomNode(e)){e.classList.remove("ui-btn-wait")}}},{key:"hidePage",value:function e(n){var s=this;return new Promise(function(e,i){var a;if(n.landingId>0){a=y.Manager.hidePage(n)}else{a=y.Manager.deleteUrl(n)}a.then(function(){s.store.commit("application/removePage",{page:n});e()}).catch(function(e){t.showError(e.answer.error_description);i(e.answer.error_description)})})}},{key:"sendPage",value:function e(n){var s=this;if(this.isProgress){return}if(this.disableSendButton){return}var i=this.store.getters["application/getPages"]();var a;for(var r in i){if(i.hasOwnProperty(r)&&i[r].id===n){a=i[r];break}}var o="other";if(a.landingId>0){if(parseInt(a.siteId)===parseInt(y.Manager.connectedSiteId)){o="landing_store_chat"}else{o="landing_other"}}if(!this.dialogId){this.slider.data.set("action","sendPage");this.slider.data.set("page",a);this.slider.data.set("pageId",n);if(this.context==="sms"){this.startProgress();BX.Salescenter.Manager.addAnalyticAction({analyticsLabel:"salescenterSendSms",context:this.context,source:o,type:a.isWebform?"form":"info",code:a.code}).then(function(){s.stopProgress();s.closeApplication()})}else{this.closeApplication()}return}this.startProgress();S.ajax.runAction("salescenter.page.send",{analyticsLabel:"salescenterSendChat",getParameters:{dialogId:this.dialogId,context:this.context,source:o,type:a.isWebform?"form":"info",connector:this.connector,code:a.code},data:{id:n,options:{dialogId:this.dialogId,sessionId:this.sessionId}}}).then(function(){s.stopProgress();s.closeApplication()}).catch(function(e){t.showError(e.errors.pop().message);s.stopProgress()})}},{key:"sendPayment",value:function e(n){var s=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"n";if(!this.isPaymentCreationAvailable){this.closeApplication();return null}var a=this.store.getters["orderCreation/getBasket"]();var r=this.store.getters["orderCreation/getDeliveryId"];var o=this.store.getters["orderCreation/getDelivery"];var l=this.store.getters["orderCreation/getTotal"];var c=this.store.getters["orderCreation/getPropertyValues"];var d=this.store.getters["orderCreation/getDeliveryExtraServicesValues"];var u=this.store.getters["orderCreation/getExpectedDelivery"];var p=this.store.getters["orderCreation/getDeliveryResponsibleId"];var m=this.store.getters["orderCreation/getPersonTypeId"];if(!this.store.getters["orderCreation/isAllowedSubmit"]||this.isProgress){return null}this.startProgress(n);this.store.dispatch("orderCreation/refreshBasket",{onsuccess:function e(){BX.ajax.runAction("salescenter.order.createPayment",{data:{basketItems:a,options:{dialogId:s.dialogId,sendingMethod:s.sendingMethod,sendingMethodDesc:s.sendingMethodDesc,sessionId:s.sessionId,lineId:s.lineId,ownerTypeId:s.ownerTypeId,ownerId:s.ownerId,iMessage:s.iMessage,stageOnOrderPaid:s.stageOnOrderPaid,skipPublicMessage:i,deliveryId:r,deliveryPrice:o,expectedDeliveryPrice:u,deliveryResponsibleId:p,personTypeId:m,propertyValues:c,deliveryExtraServicesValues:d}},analyticsLabel:s.context==="deal"?"salescenterCreatePaymentSms":"salescenterCreatePayment",getParameters:{dialogId:s.dialogId,context:s.context,connector:s.connector,skipPublicMessage:i}}).then(function(t){s.store.dispatch("orderCreation/resetBasket");s.stopProgress(n);if(i==="y"){var e={content:S.Loc.getMessage("SALESCENTER_ORDER_CREATE_NOTIFICATION").replace("#ORDER_ID#",t.data.order.number)};e.actions=[{title:S.Loc.getMessage("SALESCENTER_VIEW"),events:{click:function e(){y.Manager.showOrderAdd(t.data.order.id)}}}];BX.UI.Notification.Center.notify(e);y.Manager.showOrdersList({orderId:t.data.order.id,ownerId:s.ownerId,ownerTypeId:s.ownerTypeId})}else{s.slider.data.set("action","sendPayment");s.slider.data.set("order",t.data.order);if(t.data.deal){s.slider.data.set("deal",t.data.deal)}s.closeApplication()}}).catch(function(e){e.errors.forEach(function(t){alert(t.message)});s.stopProgress(n);t.showError(e)})},onfailure:function t(){s.stopProgress(n)}})}},{key:"resendPayment",value:function e(n){var s=this;if(!this.isPaymentCreationAvailable){this.closeApplication();return null}if(!this.store.getters["orderCreation/isAllowedSubmit"]||this.isProgress){return null}this.startProgress(n);BX.ajax.runAction("salescenter.order.resendPayment",{data:{orderId:this.options.associatedEntityId,options:{sendingMethod:this.sendingMethod,sendingMethodDesc:this.sendingMethodDesc,stageOnOrderPaid:this.stageOnOrderPaid}},getParameters:{context:this.context}}).then(function(t){s.stopProgress(n);s.closeApplication()}).catch(function(e){e.errors.forEach(function(t){alert(t.message)});s.stopProgress(n);t.showError(e)})}},{key:"getOrdersCount",value:function t(){if(this.sessionId>0){return e.rest.callMethod("salescenter.order.getActiveOrdersCount",{sessionId:this.sessionId})}else{return new Promise(function(t,e){})}}},{key:"setIMessage",value:function t(e,n){this.iMessage=n}}],[{key:"initStore",value:function t(){var e=new b.VuexBuilder;return e.addModel(C.create()).addModel(x.create()).useNamespace(true).build()}},{key:"showError",value:function t(e){console.error(e)}}]);return t}();t.App=mt})(this.BX.Salescenter=this.BX.Salescenter||{},BX,BX,BX,BX,BX.UI,BX,BX,BX,BX,BX,BX,BX,BX,BX.Event,BX,BX,BX.Main,BX.Salescenter,BX,BX,BX.Salescenter,BX);
//# sourceMappingURL=app.bundle.map.js