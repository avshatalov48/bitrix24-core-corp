this.BX=this.BX||{};(function(t,e,i,s,n,a,r,l,o,c,d,u,p,h,f){"use strict";var m=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getName",value:function t(){return"application"}},{key:"getState",value:function t(){return{pages:[]}}},{key:"getGetters",value:function t(){return{getPages:function t(e){return function(){return e.pages}}}}},{key:"getMutations",value:function t(){var e=this;return{setPages:function t(i,s){if(babelHelpers.typeof(s.pages)==="object"){i.pages=s.pages;e.saveState(i)}},removePage:function t(i,s){if(babelHelpers.typeof(s.page)==="object"){i.pages=i.pages.filter(function(t){return!(s.page.id&&s.page.id>0&&t.id===s.page.id||s.page.landingId&&s.page.landingId>0&&t.landingId===s.page.landingId)});e.saveState(i)}},addPage:function t(i,s){if(babelHelpers.typeof(s.page)==="object"){i.pages.push(s.page);e.saveState(i)}}}}}]);return e}(u.VuexBuilderModel);var g=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getName",value:function t(){return"orderCreation"}},{key:"getState",value:function t(){return{currency:"",processingId:null,showPaySystemSettingBanner:false,selectedProducts:[],basket:[],errors:[],total:{sum:null,discount:null,result:null}}}},{key:"getActions",value:function t(){return{refreshBasket:function t(e,i){var s=e.commit,n=e.dispatch,a=e.state;i.timeout=i.timeout||300;if(this.updateTimer){clearTimeout(this.updateTimer)}this.updateTimer=setTimeout(function(){var t=Math.random()*1e5;s("setProcessingId",t);BX.ajax.runAction("salescenter.api.order.refreshBasket",{data:{basketItems:a.basket}}).then(function(e){if(t===a.processingId){var s=BX.prop.getObject(e,"data",{});n("processRefreshRequest",{total:BX.prop.getObject(s,"total",{}),basket:BX.prop.get(s,"items",[])});if(i.onsuccess){i.onsuccess()}}}).catch(function(e){if(t===a.processingId){var s=BX.prop.getObject(e,"data",{});n("processRefreshRequest",{errors:BX.prop.get(e,"errors",[]),basket:BX.prop.get(s,"items",[])});if(i.onfailure){i.onfailure()}}})},i.timeout)},processRefreshRequest:function t(e,i){var s=e.commit,n=e.dispatch;if(BX.type.isArray(i.basket)){i.basket.forEach(function(t){s("updateBasketItem",{index:t.sort,fields:t})});s("setSelectedProducts")}if(BX.type.isObject(i.total)){s("setTotal",i.total)}if(BX.type.isArray(i.errors)){s("setErrors",i.errors);n("recalculate")}else{s("clearErrors")}s("setProcessingId",null)},recalculate:function t(e){var i=e.commit,s=e.state;i("setProcessingId",null);var n=0;var a=0;var r=0;s.basket.forEach(function(t,e){if(t.name===""){return}var l=t.basePrice;if(t.discount>0){var o=t.discount;if(t.discountType==="percent"){o=t.basePrice*t.discount/100}l-=o;a+=o*t.quantity}l=l>0?l:0;r+=l*t.quantity;n+=t.catalogPrice*t.quantity;i("updateBasketItem",{index:e,fields:{formattedPrice:BX.Currency.currencyFormat(l,s.currency,true),formattedCatalogPrice:BX.Currency.currencyFormat(t.catalogPrice,s.currency,true)}})});a=Math.min(a,n);i("setTotal",{sum:BX.Currency.currencyFormat(n,s.currency,true),discount:BX.Currency.currencyFormat(a,s.currency,true),result:BX.Currency.currencyFormat(r,s.currency,true)})},resetBasket:function t(e){var i=e.commit;i("clearBasket");i("setTotal",{sum:null,discount:null,result:null});i("addBasketItem")},removeItem:function t(e,i){var s=e.commit,n=e.state,a=e.dispatch;s("deleteBasketItem",i);if(n.basket.length===0){s("addBasketItem")}else{n.basket.forEach(function(t,e){s("updateBasketItem",{index:e,fields:{sort:e}})})}a("recalculate")},changeBasketItem:function t(e,i){var s=e.commit,n=e.dispatch;s("updateBasketItem",i);s("setSelectedProducts");n("recalculate")},setCurrency:function t(e,i){var s=e.commit;var n=i||"";s("setCurrency",n)}}}},{key:"getGetters",value:function t(){return{getBasket:function t(e){return function(t){return e.basket}},isAllowedSubmit:function t(e){return e.basket.filter(function(t){return t.module==="catalog"&&parseInt(t.productId)>0||t.module!=="catalog"&&BX.type.isNotEmptyString(t.name)&&parseFloat(t.quantity)>0}).length>0}}}},{key:"getMutations",value:function t(){return{addBasketItem:function t(i,s){var n=e.getBasketItemState();n.sort=i.basket.length;i.basket.push(n)},updateBasketItem:function t(i,s){if(typeof i.basket[s.index]==="undefined"){f.Vue.set(i.basket,s.index,e.getBasketItemState())}i.basket[s.index]=Object.assign(i.basket[s.index],s.fields)},clearBasket:function t(e){e.basket=[]},deleteBasketItem:function t(e,i){e.basket.splice(i.index,1)},setSelectedProducts:function t(e){e.selectedProducts=e.basket.filter(function(t){return t.module==="catalog"&&parseInt(t.productId)>0}).map(function(t){return t.productId})},setTotal:function t(e,i){e.total=Object.assign(e.total,i)},setErrors:function t(e,i){e.errors=i},clearErrors:function t(e){e.errors=[]},setProcessingId:function t(e,i){e.processingId=i},setCurrency:function t(e,i){e.currency=i},showBanner:function t(e){e.showPaySystemSettingBanner=true},hideBanner:function t(e){e.showPaySystemSettingBanner=false}}}}],[{key:"getBasketItemState",value:function t(){return{productId:null,code:null,name:"",sort:0,basePrice:0,catalogPrice:0,quantity:0,showDiscount:"",discount:0,discountInfos:[],discountType:"percent",module:null,formattedPrice:0,formattedCatalogPrice:null,measureCode:0,measureName:"",isCustomPrice:"N",isCreatedProduct:"N",encodedFields:null,errors:[]}}}]);return e}(u.VuexBuilderModel);var v=Object.freeze({databaseConfig:{name:"salescenter.app"},templateName:"bx-salescenter-app",templateAddPaymentName:"bx-salescenter-app-add-payment",templateAddPaymentProductName:"bx-salescenter-app-add-payment-product",moduleId:"salescenter"});f.Vue.component(v.templateName,{data:function t(){return{isShowPreview:false,isShowPayment:false,pageTitle:"",currentPageId:null,actions:[],frameCheckShortTimeout:false,frameCheckLongTimeout:false,isPagesOpen:false,isFormsOpen:false,showedPageIds:[],loadedPageIds:[],errorPageIds:[],lastAddedPages:[],ordersCount:null,editedPageId:null,isOrderPublicUrlAvailable:null}},created:function t(){},updated:function t(){this.renderErrors()},mounted:function t(){var e=this;this.createPinner();this.createLoader();this.$root.$app.fillPages().then(function(){e.refreshOrdersCount();e.openFirstPage()});this.isOrderPublicUrlAvailable=this.$root.$app.isOrderPublicUrlAvailable;this.isOrderPublicUrlExists=this.$root.$app.isOrderPublicUrlExists;if(this.$root.$app.isPaymentsLimitReached){var i=this.$root.$nodes.paymentsLimit;var s=this.$refs["paymentsLimit"];var n=true;var a=false;var r=undefined;try{for(var l=i.children[Symbol.iterator](),o;!(n=(o=l.next()).done);n=true){var c=o.value;s.appendChild(c)}}catch(t){a=true;r=t}finally{try{if(!n&&l.return!=null){l.return()}}finally{if(a){throw r}}}}this.movePanels()},methods:{movePanels:function t(){var e=this.$refs["sidebar"];var i=this.$root.$nodes.leftPanel;if(!i){i=this.$refs["leftSide"]}else{this.$refs["leftSide"].remove()}if(e&&i){i.appendChild(e);BX.show(e);var s=this.$refs["sidepanelNav"];if(s){i.appendChild(s);BX.show(s)}}},createPinner:function t(){var e=this.$refs["buttonsPanel"];if(e){this.$root.$el.parentNode.appendChild(e);new BX.UI.Pinner(e,{fixBottom:this.$root.$app.isFrame,fullWidth:this.$root.$app.isFrame})}},getActions:function t(){var e=[];if(this.currentPage){e=[{text:this.localize.SALESCENTER_RIGHT_ACTION_COPY_URL,onclick:this.copyUrl}];if(this.currentPage.landingId>0){e=[].concat(babelHelpers.toConsumableArray(e),[{text:this.localize.SALESCENTER_RIGHT_ACTION_HIDE,onclick:this.hidePage}])}else{e=[].concat(babelHelpers.toConsumableArray(e),[{text:this.localize.SALESCENTER_RIGHT_ACTION_DELETE,onclick:this.hidePage}])}}return[].concat(babelHelpers.toConsumableArray(e),[{text:this.localize.SALESCENTER_RIGHT_ACTION_ADD,items:this.getAddPageActions()}])},getAddPageActions:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return[{text:this.localize.SALESCENTER_RIGHT_ACTION_ADD_SITE_B24,onclick:function t(){e.addSite(i)}},{text:this.localize.SALESCENTER_RIGHT_ACTION_ADD_CUSTOM,onclick:function t(){e.showAddUrlPopup({isWebform:i===true?"Y":null})}}]},openFirstPage:function t(){this.isShowPayment=false;this.isShowPreview=true;if(this.pages&&this.pages.length>0){var e=false;var i=false;this.pages.forEach(function(t){if(!i){if(!t.isWebform){i=t}else{e=t}}});if(!i&&e){i=e}if(this.currentPageId!==i.id){this.onPageClick(i);if(i.isWebform){this.isFormsOpen=true}else{this.isPagesOpen=true}}else{this.currentPageId=this.pages[0].id}}else{this.pageTitle=null;this.currentPageId=null;this.setPageTitle(this.pageTitle)}},onPageClick:function t(e){this.pageTitle=e.name;this.currentPageId=e.id;this.hideActionsPopup();this.isShowPayment=false;this.isShowPreview=true;this.setPageTitle(this.pageTitle);if(e.isFrameDenied!==true){if(!this.showedPageIds.includes(e.id)){this.startFrameCheckTimeout();this.showedPageIds.push(e.id)}}else{this.onFrameError()}},showActionsPopup:function t(e){var i=e.target;BX.PopupMenu.show("salescenter-app-actions",i,this.getActions(),{offsetLeft:0,offsetTop:0,closeByEsc:true})},showAddPageActionPopup:function t(e){var i=e.target;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n="salescenter-app-add-page-actions";if(s){n+="-forms"}BX.PopupMenu.show(n,i,this.getAddPageActions(s),{offsetLeft:i.offsetWidth+20,offsetTop:-i.offsetHeight-15,closeByEsc:true,angle:{position:"left"}})},hideActionsPopup:function t(){BX.PopupMenu.destroy("salescenter-app-actions");BX.PopupMenu.destroy("salescenter-app-add-page-actions")},addSite:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;p.Manager.addSitePage(i).then(function(t){var i=t.answer.result.page||false;e.$root.$app.fillPages().then(function(){if(i){e.onPageClick(i);e.lastAddedPages.push(parseInt(i.id))}else{e.openFirstPage()}})});this.hideActionsPopup()},copyUrl:function t(e){if(this.currentPage&&this.currentPage.url){p.Manager.copyUrl(this.currentPage.url,e);this.hideActionsPopup()}},editPage:function t(){if(this.currentPage){if(this.currentPage.landingId&&this.currentPage.landingId>0){p.Manager.editLandingPage(this.currentPage.landingId,this.currentPage.siteId);this.hideActionsPopup()}else{this.showAddUrlPopup(this.currentPage)}}},hidePage:function t(){var e=this;if(this.currentPage){this.$root.$app.hidePage(this.currentPage).then(function(){e.openFirstPage()});this.hideActionsPopup()}},showAddUrlPopup:function t(e){var i=this;if(!n.Type.isPlainObject(e)){e={}}p.Manager.addCustomPage(e).then(function(t){if(!i.isShowPreview){i.isShowPreview=false}i.$root.$app.fillPages().then(function(){if(t&&(!n.Type.isPlainObject(e)||!e.id)){i.lastAddedPages.push(parseInt(t))}if(!t&&e){t=e.id}if(t){i.pages.forEach(function(e){if(parseInt(e.id)===parseInt(t)){i.onPageClick(e)}})}else{if(!i.isShowPayment){i.isShowPreview=true}}})});this.hideActionsPopup()},showPaymentForm:function t(){this.isShowPayment=true;this.isShowPreview=false;if(this.isOrderPublicUrlAvailable){this.setPageTitle(this.localize.SALESCENTER_LEFT_PAYMENT_ADD)}else{this.setPageTitle(this.localize.SALESCENTER_DEFAULT_TITLE)}},showOrdersList:function t(){var e=this;this.hideActionsPopup();p.Manager.showOrdersList({ownerId:this.$root.$app.ownerId,ownerTypeId:this.$root.$app.ownerTypeId}).then(function(){e.refreshOrdersCount()})},showOrderAdd:function t(){var e=this;this.hideActionsPopup();p.Manager.showOrderAdd({ownerId:this.$root.$app.ownerId,ownerTypeId:this.$root.$app.ownerTypeId}).then(function(){e.refreshOrdersCount()})},showCatalog:function t(){this.hideActionsPopup();p.Manager.openSlider("/saleshub/catalog/?sessionId=".concat(this.$root.$app.sessionId))},onFormsClick:function t(){this.isFormsOpen=!this.isFormsOpen;this.hideActionsPopup()},openControlPanel:function t(){p.Manager.openControlPanel();this.hideActionsPopup()},openHelpDesk:function t(){this.hideActionsPopup();p.Manager.openHowItWorks()},isPageSelected:function t(e){return this.currentPage&&this.isShowPreview&&this.currentPage.id===e.id},send:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"n";if(!this.isAllowedSubmitButton){return}if(this.isShowPayment&&!this.isShowStartInfo){this.$root.$app.sendPayment(e.target,i)}else if(this.currentPage&&this.currentPage.isActive){this.$root.$app.sendPage(this.currentPage.id)}},close:function t(){this.$root.$app.closeApplication()},setPageTitle:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!e){return}if(this.$root.$nodes.title){this.$root.$nodes.title.innerText=e}},onFrameError:function t(){clearTimeout(this.frameCheckLongTimeout);if(this.showedPageIds.includes(this.currentPage.id)){this.loadedPageIds.push(this.currentPage.id)}this.errorPageIds.push(this.currentPage.id)},onFrameLoad:function t(e){var i=this;clearTimeout(this.frameCheckLongTimeout);if(this.showedPageIds.includes(e)){this.loadedPageIds.push(e);if(this.currentPage&&this.currentPage.id===e){if(this.frameCheckShortTimeout&&!this.currentPage.landingId){this.onFrameError()}else if(this.errorPageIds.includes(this.currentPage.id)){this.errorPageIds=this.errorPageIds.filter(function(t){return t!==i.currentPage.id})}}}if(this.frameCheckShortTimeout&&this.currentPage&&this.currentPage.id===e&&!this.currentPage.landingId){this.onFrameError()}},startFrameCheckTimeout:function t(){var e=this;if(this.frameCheckShortTimeout){clearTimeout(this.frameCheckShortTimeout);this.frameCheckShortTimeout=false}this.frameCheckShortTimeout=setTimeout(function(){e.frameCheckShortTimeout=false},500);clearTimeout(this.frameCheckLongTimeout);this.frameCheckLongTimeout=setTimeout(function(){if(e.currentPage&&e.showedPageIds.includes(e.currentPage.id)&&!e.loadedPageIds.includes(e.currentPage.id)){e.errorPageIds.push(e.currentPage.id)}},5e3)},connect:function t(){var e=this;p.Manager.startConnection({context:this.$root.$app.context}).then(function(){p.Manager.loadConfig().then(function(t){if(t.isSiteExists){e.$root.$app.isSiteExists=t.isSiteExists;e.isSiteExists=t.isSiteExists;e.$root.$app.fillPages().then(function(){e.isOrderPublicUrlExists=true;e.$root.$app.isOrderPublicUrlExists=true;e.isOrderPublicUrlAvailable=t.isOrderPublicUrlAvailable;e.$root.$app.isOrderPublicUrlAvailable=t.isOrderPublicUrlAvailable;if(!e.isShowPayment){e.openFirstPage()}else{e.showPaymentForm()}})}})})},checkRecycle:function t(){p.Manager.openConnectedSite(true)},openConnectedSite:function t(){p.Manager.openConnectedSite()},getFrameSource:function t(e){if(this.showedPageIds.includes(e.id)){if(e.landingId>0){if(e.isActive){return new n.Uri(e.url).setQueryParam("theme","").toString()}}else{return e.url}}return null},refreshOrdersCount:function t(){var e=this;this.$root.$app.getOrdersCount().then(function(t){e.ordersCount=t.answer.result||null}).catch(function(){e.ordersCount=null})},renderErrors:function t(){if(this.isShowPayment&&this.order.errors.length>0){var e=this.order.errors.map(function(t){return t.message}).join("<br>");var i={color:BX.UI.Alert.Color.DANGER,textCenter:true,text:BX.util.htmlspecialchars(e)};if(this.$refs.errorBlock.innerHTML.length===0){i.animated=true}var s=new BX.UI.Alert(i);this.$refs.errorBlock.innerHTML="";this.$refs.errorBlock.appendChild(s.getContainer())}else if(this.$refs.errorBlock){this.$refs.errorBlock.innerHTML=""}},editMenuItem:function t(e,i){this.editedPageId=i.id;setTimeout(function(){e.target.parentNode.parentNode.querySelector("input").focus()},50)},saveMenuItem:function t(e){var i=this;var s=this.editedPageId;var n=e.target.value;var a;this.pages.forEach(function(t){if(t.id===i.editedPageId){a=t.name}});if(s>0&&a&&n!==a&&n.length>0){p.Manager.addPage({id:s,name:n,analyticsLabel:"salescenterUpdatePageTitle"}).then(function(){i.$root.$app.fillPages().then(function(){if(i.editedPageId===i.currentPageId){i.setPageTitle(n)}i.editedPageId=null})})}else{this.editedPageId=null}},createLoader:function t(){var e=new s.Loader({size:200});e.show(this.$refs["previewLoader"])}},computed:babelHelpers.objectSpread({config:function t(){return v},currentPage:function t(){var e=this;if(this.currentPageId>0){var i=this.application.pages.filter(function(t){return t.id===e.currentPageId});if(i.length>0){return i[0]}}return null},pagesSubmenuHeight:function t(){if(this.isPagesOpen){return this.application.pages.filter(function(t){return!t.isWebform}).length*39+30+"px"}else{return"0px"}},formsSubmenuHeight:function t(){if(this.isFormsOpen){return this.application.pages.filter(function(t){return t.isWebform}).length*39+30+"px"}else{return"0px"}},isFrameError:function t(){if(this.isShowPreview&&this.currentPage){if(!this.currentPage.isActive){return true}else if(!this.currentPage.landingId&&this.errorPageIds.includes(this.currentPage.id)){return true}}return false},isShowLoader:function t(){return this.isShowPreview&&this.currentPageId>0&&this.showedPageIds.includes(this.currentPageId)&&!this.loadedPageIds.includes(this.currentPageId)},isShowStartInfo:function t(){var e=false;if(this.isShowPreview){e=!this.pages||this.pages.length<=0}else if(this.isShowPayment){e=!this.isOrderPublicUrlAvailable}return e},wrapperHeight:function t(){if(this.isShowPreview||this.isShowPayment){var e=BX.pos(this.$root.$el);var i=e.top+20;if(this.$root.$nodes.footer){i+=BX.pos(this.$root.$nodes.footer).height}var s=this.$refs["buttonsPanel"];if(s){i+=BX.pos(s).height}return"calc(100vh - "+i+"px)"}else{return"auto"}},lastModified:function t(){if(this.currentPage&&this.currentPage.modifiedAgo){return this.localize.SALESCENTER_MODIFIED.replace("#AGO#",this.currentPage.modifiedAgo)}return false},localize:function t(){return f.Vue.getFilteredPhrases("SALESCENTER_")},pages:function t(){this.isOrderPublicUrlAvailable=this.$root.$app.isOrderPublicUrlAvailable;return babelHelpers.toConsumableArray(this.application.pages)},isAllowedSubmitButton:function t(){if(this.$root.$app.disableSendButton){return false}if(this.isShowPreview&&this.currentPage&&!this.currentPage.isActive){return false}if(this.isShowPayment){return this.$store.getters["orderCreation/isAllowedSubmit"]}return this.currentPage},isOrderPageDeleted:function t(){return this.$root.$app.isSiteExists&&!this.isOrderPublicUrlExists}},u.Vuex.mapState({application:function t(e){return e.application},order:function t(e){return e.orderCreation}})),template:'\n\t\t<div class="salescenter-app-wrapper" :style="{height: wrapperHeight}">\n\t\t\t<div class="ui-sidepanel-sidebar salescenter-app-sidebar" ref="sidebar">\n\t\t\t\t<div class="ui-sidepanel-head">\n\t\t\t\t\t<div class="ui-sidepanel-title">{{localize.SALESCENTER_DEFAULT_TITLE}}</div>\n\t\t\t\t</div>\n\t\t\t\t<ul class="ui-sidepanel-menu" ref="sidepanelMenu">\n\t\t\t\t\t<li :class="{\'salescenter-app-sidebar-menu-active\': isPagesOpen}" class="ui-sidepanel-menu-item">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link" @click.stop.prevent="isPagesOpen = !isPagesOpen;">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_PAGES}}</div>\n\t\t\t\t\t\t\t<div class="ui-sidepanel-toggle-btn">{{this.isPagesOpen ? this.localize.SALESCENTER_SUBMENU_CLOSE : this.localize.SALESCENTER_SUBMENU_OPEN}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<ul class="ui-sidepanel-submenu" :style="{height: pagesSubmenuHeight}">\n\t\t\t\t\t\t\t<li v-for="page in pages" v-if="!page.isWebform" :key="page.id"\n\t\t\t\t\t\t\t:class="{\n\t\t\t\t\t\t\t\t\'ui-sidepanel-submenu-active\': (currentPage && currentPage.id == page.id && isShowPreview),\n\t\t\t\t\t\t\t\t\'ui-sidepanel-submenu-edit-mode\': (editedPageId === page.id)\n\t\t\t\t\t\t\t}" class="ui-sidepanel-submenu-item">\n\t\t\t\t\t\t\t\t<a :title="page.name" class="ui-sidepanel-submenu-link" @click.stop="onPageClick(page)">\n\t\t\t\t\t\t\t\t\t<input class="ui-sidepanel-input" :value="page.name" v-on:keyup.enter="saveMenuItem($event)" @blur="saveMenuItem($event)" />\n\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{page.name}}</div>\n\t\t\t\t\t\t\t\t\t<div v-if="lastAddedPages.includes(page.id)" class="ui-sidepanel-badge-new"></div>\n\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-edit-btn"><span class="ui-sidepanel-edit-btn-icon" @click="editMenuItem($event, page);"></span></div>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="salescenter-app-helper-nav-item salescenter-app-menu-add-page" @click.stop="showAddPageActionPopup($event)">\n\t\t\t\t\t\t\t\t<span class="salescenter-app-helper-nav-item-text salescenter-app-helper-nav-item-add">+</span><span class="salescenter-app-helper-nav-item-text">{{localize.SALESCENTER_RIGHT_ACTION_ADD}}</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li v-if="this.$root.$app.isPaymentCreationAvailable" :class="{ \'salescenter-app-sidebar-menu-active\': this.isShowPayment}" class="ui-sidepanel-menu-item" @click="showPaymentForm">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_PAYMENT_ADD}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li @click="showOrdersList">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_ORDERS}}</div>\n\t\t\t\t\t\t\t<span class="ui-sidepanel-counter" ref="ordersCounter" v-show="ordersCount > 0">{{ordersCount}}</span>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li @click="showOrderAdd">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_ORDER_ADD}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li v-if="this.$root.$app.isCatalogAvailable" @click="showCatalog">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_CATALOG}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li :class="{\'salescenter-app-sidebar-menu-active\': isFormsOpen}" class="ui-sidepanel-menu-item">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link" @click.stop.prevent="onFormsClick();">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_FORMS_ALL}}</div>\n\t\t\t\t\t\t\t<div class="ui-sidepanel-toggle-btn">{{this.isPagesOpen ? this.localize.SALESCENTER_SUBMENU_CLOSE : this.localize.SALESCENTER_SUBMENU_OPEN}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<ul class="ui-sidepanel-submenu" :style="{height: formsSubmenuHeight}">\n\t\t\t\t\t\t\t<li v-for="page in pages" v-if="page.isWebform" :key="page.id"\n\t\t\t\t\t\t\t :class="{\n\t\t\t\t\t\t\t\t\'ui-sidepanel-submenu-active\': (currentPage && currentPage.id == page.id && isShowPreview),\n\t\t\t\t\t\t\t\t\'ui-sidepanel-submenu-edit-mode\': (editedPageId === page.id)\n\t\t\t\t\t\t\t}" class="ui-sidepanel-submenu-item">\n\t\t\t\t\t\t\t\t<a :title="page.name" class="ui-sidepanel-submenu-link" @click.stop="onPageClick(page)">\n\t\t\t\t\t\t\t\t\t<input class="ui-sidepanel-input" :value="page.name" v-on:keyup.enter="saveMenuItem($event)" @blur="saveMenuItem($event)" />\n\t\t\t\t\t\t\t\t\t<div v-if="lastAddedPages.includes(page.id)" class="ui-sidepanel-badge-new"></div>\n\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{page.name}}</div>\n\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-edit-btn"><span class="ui-sidepanel-edit-btn-icon" @click="editMenuItem($event, page);"></span></div>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="salescenter-app-helper-nav-item salescenter-app-menu-add-page" @click.stop="showAddPageActionPopup($event, true)">\n\t\t\t\t\t\t\t\t<span class="salescenter-app-helper-nav-item-text salescenter-app-helper-nav-item-add">+</span><span class="salescenter-app-helper-nav-item-text">{{localize.SALESCENTER_RIGHT_ACTION_ADD}}</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t<div class="salescenter-app-helper-nav" ref="sidepanelNav">\n\t\t\t\t<a class="salescenter-app-helper-nav-item" @click="openControlPanel">\n\t\t\t\t\t<span class="salescenter-app-helper-nav-item-text">{{localize.SALESCENTER_PAYMENT_TYPE_ADD}}</span>\n\t\t\t\t</a>\n\t\t\t\t<a class="salescenter-app-helper-nav-item" @click="openHelpDesk">\n\t\t\t\t\t<span class="salescenter-app-helper-nav-item-text">{{localize.SALESCENTER_HOW}}</span>\n\t\t\t\t</a>\n\t\t\t</div> \n\t\t\t<div class="salescenter-app-left-side" ref="leftSide"></div>\n\t\t\t<div class="salescenter-app-right-side">\n\t\t\t\t<div class="salescenter-app-page-header" v-show="isShowPreview && !isShowStartInfo">\n\t\t\t\t\t<div class="salescenter-btn-action ui-btn ui-btn-link ui-btn-dropdown ui-btn-xs" @click="showActionsPopup($event)">{{localize.SALESCENTER_RIGHT_ACTIONS_BUTTON}}</div>\n\t\t\t\t\t<div class="salescenter-btn-delimiter salescenter-btn-action"></div>\n\t\t\t\t\t<div class="salescenter-btn-action ui-btn ui-btn-link ui-btn-xs ui-btn-icon-edit" @click="editPage">{{localize.SALESCENTER_RIGHT_ACTION_EDIT}}</div>\n\t\t\t\t</div>\n\t\t\t\t<template v-if="isShowStartInfo">\n\t\t\t\t\t<div class="salescenter-app-page-content salescenter-app-start-wrapper">\n\t\t\t\t\t\t<div class="ui-title-1 ui-text-center ui-color-medium" style="margin-bottom: 20px;">{{localize.SALESCENTER_INFO_TEXT_TOP}}</div>\n\t\t\t\t\t\t<div class="ui-hr ui-mv-25"></div>\n\t\t\t\t\t\t<template v-if="this.isOrderPublicUrlExists">\n\t\t\t\t\t\t\t<div class="salescenter-title-5 ui-title-5 ui-text-center ui-color-medium">{{localize.SALESCENTER_INFO_TEXT_BOTTOM_PUBLIC}}</div>\n\t\t\t\t\t\t\t<div style="padding-top: 5px;" class="ui-text-center">\n\t\t\t\t\t\t\t\t<div class="ui-btn ui-btn-primary ui-btn-lg" @click="openConnectedSite">{{localize.SALESCENTER_INFO_PUBLIC}}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else-if="isOrderPageDeleted">\n\t\t\t\t\t\t\t<div class="salescenter-title-5 ui-title-5 ui-text-center ui-color-medium">{{localize.SALESCENTER_INFO_ORDER_PAGE_DELETED}}</div>\n\t\t\t\t\t\t\t<div style="padding-top: 5px;" class="ui-text-center">\n\t\t\t\t\t\t\t\t<div class="ui-btn ui-btn-primary ui-btn-lg" @click="checkRecycle">{{localize.SALESCENTER_CHECK_RECYCLE}}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class="salescenter-title-5 ui-title-5 ui-text-center ui-color-medium">{{localize.SALESCENTER_INFO_TEXT_BOTTOM}}</div>\n\t\t\t\t\t\t\t<div style="padding-top: 5px;" class="ui-text-center">\n\t\t\t\t\t\t\t\t<div class="ui-btn ui-btn-primary ui-btn-lg" @click="connect">{{localize.SALESCENTER_INFO_CREATE}}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else-if="isFrameError && isShowPreview">\n\t\t\t\t\t<div class="salescenter-app-page-content salescenter-app-lost">\n\t\t\t\t\t\t<div class="salescenter-app-lost-block ui-title-1 ui-text-center ui-color-medium">{{localize.SALESCENTER_ERROR_TITLE}}</div>\n\t\t\t\t\t\t<div v-if="currentPage.isFrameDenied === true" class="salescenter-app-lost-helper ui-color-medium">{{localize.SALESCENTER_RIGHT_FRAME_DENIED}}</div>\n\t\t\t\t\t\t<div v-else-if="currentPage.isActive !== true" class="salescenter-app-lost-helper salescenter-app-not-active ui-color-medium">{{localize.SALESCENTER_RIGHT_NOT_ACTIVE}}</div>\n\t\t\t\t\t\t<div v-else class="salescenter-app-lost-helper ui-color-medium">{{localize.SALESCENTER_ERROR_TEXT}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<div v-show="isShowPreview && !isShowStartInfo && !isFrameError" class="salescenter-app-page-content">\n\t\t\t\t\t<template v-for="page in pages">\n\t\t\t\t\t\t<iframe class="salescenter-app-demo" v-show="currentPage && currentPage.id == page.id" :src="getFrameSource(page)" frameborder="0" @error="onFrameError(page.id)" @load="onFrameLoad(page.id)" :key="page.id"></iframe>\n\t\t\t\t\t</template>\n\t\t\t\t\t<div class="salescenter-app-demo-overlay" :class="{\n\t\t\t\t\t\t\'salescenter-app-demo-overlay-loading\': this.isShowLoader\n\t\t\t\t\t}">\n\t\t\t\t\t\t<div v-show="isShowLoader" ref="previewLoader"></div>\n\t\t\t\t\t\t<div v-if="lastModified" class="salescenter-app-demo-overlay-modification">{{lastModified}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t    <template v-if="this.$root.$app.isPaymentsLimitReached">\n\t\t\t        <div ref="paymentsLimit" v-show="isShowPayment && !isShowStartInfo"></div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t        <component v-show="isShowPayment && !isShowStartInfo" :is="config.templateAddPaymentName"></component>\n\t\t        </template>\n\t\t\t</div>\n\t\t\t<div class="ui-button-panel-wrapper salescenter-button-panel" ref="buttonsPanel">\n\t\t\t\t<div class="ui-button-panel">\n\t\t\t\t\t<button :class="{\n\t\t\t\t\t\t\'ui-btn-disabled\': !this.isAllowedSubmitButton\n\t\t\t\t\t}" class="ui-btn ui-btn-md ui-btn-success" @click="send($event)">{{localize.SALESCENTER_SEND}}</button>\n\t\t\t\t\t<button class="ui-btn ui-btn-md ui-btn-link" @click="close">{{localize.SALESCENTER_CANCEL}}</button>\n\t\t\t\t\t<button v-if="isShowPayment && !isShowStartInfo && !this.$root.$app.isPaymentsLimitReached" class="ui-btn ui-btn-md ui-btn-link btn-send-crm" @click="send($event, \'y\')">{{localize.SALESCENTER_SAVE_ORDER}}</button>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="this.order.errors.length > 0" ref="errorBlock"></div>\n\t\t\t</div>\n\t\t</div>\n\t'});f.Vue.component(v.templateAddPaymentProductName,{props:["basketItem","basketItemIndex","countItems","selectedProductIds"],data:function t(){return{timer:null,productSelector:null,isNeedRebindSearch:false}},created:function t(){var e=this;this.currencyName=this.$root.$app.options.currencyName||null;this.defaultMeasure={name:"",id:null};this.measures=this.$root.$app.options.measures||[];if(BX.type.isArray(this.measures)&&this.measures){this.measures.map(function(t){if(t["IS_DEFAULT"]==="Y"){e.defaultMeasure.name=t.SYMBOL;e.defaultMeasure.code=t.CODE;e.changeData({measureCode:e.defaultMeasure.code,measureName:e.defaultMeasure.name})}})}},mounted:function t(){this.productSelector=new BX.UI.Dropdown({searchAction:"salescenter.api.order.searchProduct",searchOptions:{restrictedSearchIds:this.selectedProductIds},enableCreation:true,searchResultRenderer:null,targetElement:this.$refs.searchProductLine,items:[{title:"",subTitle:this.localize.SALESCENTER_PRODUCT_BEFORE_SEARCH_TITLE}],messages:{creationLegend:this.localize.SALESCENTER_PRODUCT_CREATE,notFound:this.localize.SALESCENTER_PRODUCT_NOT_FOUND},events:{onSelect:this.selectCatalogItem.bind(this),onAdd:this.showCreationForm.bind(this),onReset:this.resetSearchForm(this)}})},directives:{"bx-search-product":{inserted:function t(e,i){if(i.value.selector instanceof BX.UI.Dropdown){var s=i.value.restrictedIds;i.value.selector.targetElement=e;if(BX.type.isArray(s)){i.value.selector.searchOptions={restrictedSearchIds:s};i.value.selector.items=i.value.selector.items.filter(function(t){return!s.includes(t.id)})}i.value.selector.init()}}}},methods:{toggleDiscount:function t(e){this.changeData({showDiscount:e})},changeData:function t(e){this.$emit("changeBasketItem",{index:this.basketItemIndex,fields:e})},isNeedRefreshAfterChanges:function t(){if(this.isCreationMode){return this.basketItem.name.length>0&&this.basketItem.quantity>0&&this.basketItem.basePrice>0}return true},refreshBasket:function t(){if(this.isNeedRefreshAfterChanges())this.$emit("refreshBasket")},debouncedRefresh:function t(e){var i=this;if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(function(){i.refreshBasket();i.timer=null},e)},changeQuantity:function t(e){var i=parseFloat(e.target.value);if(!i){return}var s=this.basketItem;s.quantity=i;this.changeData(s);this.debouncedRefresh(300)},changeName:function t(e){var i=e.target.value;var s=this.basketItem;s.name=i;this.changeData(s);this.refreshBasket()},changeBasePrice:function t(e){var i=Number(e.target.value);if(i<0){return}var s=this.basketItem;s.basePrice=i;if(s.module!=="catalog"){s.catalogPrice=i}s.isCustomPrice="Y";this.changeData(s);this.debouncedRefresh(300)},changeDiscountType:function t(e){var i=e.target.value==="currency"?"currency":"percent";var s=this.basketItem;s.discountType=i;s.isCustomPrice="Y";this.changeData(s);if(parseFloat(this.basketItem.discount)>0){this.refreshBasket()}},changeDiscount:function t(e){var i=parseFloat(e.target.value)||0;if(i===parseFloat(this.basketItem.discount)){return}var s=this.basketItem;s.discount=i;s.isCustomPrice="Y";this.changeData(s);this.debouncedRefresh(300)},changeMeasureValue:function t(e){var i=parseInt(e.target.value);var s="";this.measures.forEach(function(t){if(parseInt(t.CODE)===i){s=t.SYMBOL}});this.changeData({measureCode:i,measureName:s})},showCreationForm:function t(){if(!(this.productSelector instanceof BX.UI.Dropdown))return true;var e=this.productSelector.targetElement.value;this.changeData({productId:0,quantity:1,module:null,sort:this.basketItemIndex,isCreatedProduct:"Y",name:e,encodedFields:null,isCustomPrice:"Y",discountInfos:[]});this.productSelector.destroyPopupWindow()},resetSearchForm:function t(){if(!(this.productSelector instanceof BX.UI.Dropdown))return true;this.productSelector.targetElement.value="";this.productSelector.items=[{title:"",subTitle:this.localize.SALESCENTER_PRODUCT_BEFORE_SEARCH_TITLE}];this.changeData({productId:0,name:"",encodedFields:null,quantity:0,basePrice:0,formattedPrice:0,catalogPrice:0,formattedCatalogPrice:null,discount:0,discountInfos:[],errors:[]});this.productSelector.destroyPopupWindow()},hideCreationForm:function t(){if(!(this.productSelector instanceof BX.UI.Dropdown))return true;this.changeData({isCreatedProduct:"N",productId:0,name:"",encodedFields:null,quantity:0,basePrice:0,formattedPrice:0,catalogPrice:0,formattedCatalogPrice:null,discount:0,discountInfos:[],errors:[]});this.refreshBasket();this.isNeedRebindSearch=true},removeItem:function t(){this.$emit("removeItem",{index:this.basketItemIndex})},selectCatalogItem:function t(e,i){var s=this;if(!e instanceof BX.UI.Dropdown)return true;if(i.id===undefined||parseInt(i.id)<=0)return true;var n={name:i.title,productId:i.id,sort:this.basketItemIndex,module:"catalog",quantity:this.basketItem.quantity>0?this.basketItem.quantity:1};if(this.basketItemIndex.productId!==i.id){n.encodedFields=null;n.discount=0;n.isCustomPrice="N"}BX.ajax.runAction("salescenter.api.order.getBaseProductPrice",{data:{productId:i.id}}).then(function(t){n.basePrice=BX.prop.getNumber(t,"data",0);n.catalogPrice=BX.prop.getNumber(t,"data",0);s.changeData(n);s.$emit("refreshBasket",0)});e.destroyPopupWindow()},openDiscountEditor:function t(e,i){if(!(window.top.BX.SidePanel&&window.top.BX.SidePanel.Instance)){return}window.top.BX.SidePanel.Instance.open(BX.util.add_url_param(i,{IFRAME:"Y",IFRAME_TYPE:"SIDE_SLIDER",publicSidePanel:"Y"}),{allowChangeHistory:false});e.preventDefault?e.preventDefault():e.returnValue=false}},computed:{localize:function t(){return f.Vue.getFilteredPhrases("SALESCENTER_PRODUCT_")},showDiscount:function t(){return this.basketItem.showDiscount==="Y"},showCatalogPrice:function t(){return this.basketItem.discount>0||parseFloat(this.basketItem.basePrice)!==parseFloat(this.basketItem.catalogPrice)},getMeasureName:function t(){return this.basketItem.measureName||this.defaultMeasure.name},getMeasureCode:function t(){return this.basketItem.measureCode||this.defaultMeasure.code},restrictedSearchIds:function t(){var e=this;var t=this.selectedProductIds;if(this.basketItem.module==="catalog"){t=t.filter(function(t){return t!==e.basketItem.productId})}return t},isCreationMode:function t(){return this.basketItem.isCreatedProduct==="Y"},isNotEnoughQuantity:function t(){return this.basketItem.errors.includes("SALE_BASKET_AVAILABLE_QUANTITY")},hasPriceError:function t(){return this.basketItem.errors.includes("SALE_BASKET_ITEM_WRONG_PRICE")},isEmptyProductName:function t(){return this.basketItem.name.length===0}},template:'\n\t\t<div>\n\t\t\t<div class="salescenter-app-counter" v-if="countItems > 1">{{basketItemIndex + 1}}</div>\n\t\t\t<div class="salescenter-app-remove" @click="removeItem" v-if="countItems > 1"></div>\n\t\t\t<div class="salescenter-app-form-container" v-if="!isCreationMode">\n\n\t\t\t\t<div class="salescenter-app-form-row">\n\t\t\t\t\t<div class="salescenter-app-form-col" style="flex:8">\n\n\t\t\t\t\t\t<label class="salescenter-app-ctl-label-text ui-ctl-label-text">{{localize.SALESCENTER_PRODUCT_TITLE}}</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-md ui-ctl-w100 ui-ctl-after-icon">\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" @click="resetSearchForm" v-if="basketItem.name.length > 0"> </button>\n\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\tref="searchProductLine" \n\t\t\t\t\t\t\t\tclass="ui-ctl-element ui-ctl-textbox salescenter-app-product-search" \n\t\t\t\t\t\t\t\t:value="basketItem.name"\n\t\t\t\t\t\t\t\tv-bx-search-product="{selector: productSelector, restrictedIds: restrictedSearchIds}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="salescenter-app-form-col" style="flex:4">\n\n\t\t\t\t\t\t<label class="salescenter-app-ctl-label-text ui-ctl-label-text">\n\t\t\t\t\t\t\t{{localize.SALESCENTER_PRODUCT_QUANTITY.replace(\'#MEASURE_NAME#\', getMeasureName)}}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-md ui-ctl-w100" :class="isNotEnoughQuantity ? \'ui-ctl-danger\' : \'\'">\n\t\t\t\t\t\t\t<input type="text" class="ui-ctl-element ui-ctl-textbox" :value="basketItem.quantity" @input="changeQuantity" @change="refreshBasket">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="salescenter-form-error" v-if="isNotEnoughQuantity">{{localize.SALESCENTER_PRODUCT_IS_NOT_AVAILABLE}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="salescenter-app-form-row">\n\t\t\t\t\t<div class="salescenter-app-form-col" style="flex:12">\n\n\t\t\t\t\t\t<label class="salescenter-app-ctl-label-text ui-ctl-label-text">\n\t\t\t\t\t\t\t{{localize.SALESCENTER_PRODUCT_PRICE.replace(\'#CURRENCY_NAME#\', currencyName)}}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-md ui-ctl-w100" :class="hasPriceError ? \'ui-ctl-danger\' : \'\'">\n\t\t\t\t\t\t\t<input type="text" class="ui-ctl-element ui-ctl-textbox"  :value="basketItem.basePrice"  @input="changeBasePrice" @change="refreshBasket">\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t\t<div class="salescenter-app-form-container" v-else>\n\t\t\t\t<div class="salescenter-app-form-row">\n\t\t\t\t\t<div class="salescenter-app-form-col" style="flex:8">\n\n\t\t\t\t\t\t<label class="salescenter-app-ctl-label-text ui-ctl-label-text">{{localize.SALESCENTER_PRODUCT_TITLE}}</label>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-md ui-ctl-w100 ui-ctl-after-icon" :class="{\'ui-ctl-danger\' : this.isEmptyProductName}">\n\t\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" @click="hideCreationForm"> </button>\n\t\t\t\t\t\t\t\t<input type="text" class="ui-ctl-element ui-ctl-textbox" @change="changeName" :value="basketItem.name">\n\t\t\t\t\t\t\t\t<div class="salescenter-ctl-label">\n\t\t\t\t\t\t\t\t\t<div class="salescenter-ctl-label-text">{{localize.SALESCENTER_PRODUCT_NEW_LABEL}}</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="salescenter-app-form-col" style="flex:4">\n\n\t\t\t\t\t\t<label class="salescenter-app-ctl-label-text ui-ctl-label-text">\n\t\t\t\t\t\t\t{{localize.SALESCENTER_PRODUCT_QUANTITY.replace(\'#MEASURE_NAME#\', getMeasureName)}}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-md ui-ctl-w100">\n\t\t\t\t\t\t\t<input type="text" class="ui-ctl-element ui-ctl-textbox" :value="basketItem.quantity" @input="changeQuantity" @change="refreshBasket">\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="salescenter-app-form-row" style="align-items: flex-end">\n\t\t\t\t\t<div class="salescenter-app-form-col" style="flex:8">\n\n\t\t\t\t\t\t<label class="salescenter-app-ctl-label-text ui-ctl-label-text">\n\t\t\t\t\t\t\t{{localize.SALESCENTER_PRODUCT_PRICE.replace(\'#CURRENCY_NAME#\', currencyName)}}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-md ui-ctl-w100">\n\t\t\t\t\t\t\t<input type="text" class="ui-ctl-element ui-ctl-textbox" :value="basketItem.basePrice"  @input="changeBasePrice" @change="refreshBasket">\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="salescenter-app-form-col" style="flex:4;">\n\t\t\t\t\t\t<label class="salescenter-app-ctl-label-text ui-ctl-label-text">{{localize.SALESCENTER_PRODUCT_MEASURE}}</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-dropdown">\n\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t<select class="ui-ctl-element" @change="changeMeasureValue" :value="getMeasureCode">\n\t\t\t\t\t\t\t\t<option v-for="item in measures" :value="item.CODE">{{item.SYMBOL}}</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t\t<div class="salescenter-app-sale-container" v-if="showDiscount">\n\n\t\t\t\t<div class="salescenter-app-form-collapse-container">\n\n\t\t\t\t\t<div class="salescenter-app-form-col">\n\t\t\t\t\t\t<label class="salescenter-app-ctl-label-text ui-ctl-label-text">{{localize.SALESCENTER_PRODUCT_DISCOUNT_TITLE}}</label>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="salescenter-app-form-row">\n\n\t\t\t\t\t\t<div class="salescenter-app-form-col" style="flex:1;max-width: 112px;">\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-md ui-ctl-w100">\n\t\t\t\t\t\t\t\t<input type="text" class="ui-ctl-element ui-ctl-textbox" :value="basketItem.discount" @input="changeDiscount"  @change="refreshBasket">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="salescenter-app-form-col" style="flex:1.5;max-width: 84px;">\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-dropdown">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t\t<select class="ui-ctl-element" :value="basketItem.discountType" @change="changeDiscountType">\n\t\t\t\t\t\t\t\t\t<option value="percent">%</option>\n\t\t\t\t\t\t\t\t\t<option value="currency">{{currencyName}}</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="salescenter-app-form-col" style="flex:auto; text-align: right;">\n\t\t\t\t\t\t\t<div style="margin-bottom: 0;" class="ui-text-4 ui-color-light">{{localize.SALESCENTER_PRODUCT_DISCOUNT_PRICE_TITLE}}</div>\n\t\t\t\t\t\t\t<div class="salescenter-app-form-text">\n\t\t\t\t\t\t\t\t<span class="salescenter-app-text-line-through" v-if="showCatalogPrice" v-html="basketItem.formattedCatalogPrice"></span>\n\t\t\t\t\t\t\t\t<span v-html="basketItem.formattedPrice"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div class="salescenter-app-form-row" style="margin-bottom: 0;">\n\t\t\t\t\t\t<div class="salescenter-app-form-col" v-for="discount in basketItem.discountInfos"">\n\t\t\t\t\t\t\t<span class="ui-text-4 ui-color-light"> {{discount.name}} \n\t\t\t\t\t\t\t<a :href="discount.editPageUrl" @click="openDiscountEditor(event, discount.editPageUrl)">\n\t\t\t\t\t\t\t\t{{localize.SALESCENTER_PRODUCT_DISCOUNT_EDIT_PAGE_URL_TITLE}}\n\t\t\t\t\t\t\t</a></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t</div>\n\n\t\t\t\t<div class="salescenter-app-collapse-link-container">\n\t\t\t\t\t<a class="salescenter-app-collapse-link" @click="toggleDiscount(\'N\')">{{localize.SALESCENTER_PRODUCT_HIDE_DISCOUNT}}</a>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t\t<div class="salescenter-app-sale-container" v-else>\n\t\t\t\t<div class="salescenter-app-collapse-link-container">\n\t\t\t\t\t<a class="salescenter-app-collapse-link"  @click="toggleDiscount(\'Y\')">{{localize.SALESCENTER_PRODUCT_ADD_DISCOUNT}}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'});f.Vue.component(v.templateAddPaymentName,{data:function t(){return{}},created:function t(){var e=this.$root.$app.options.currencyCode||"";if(this.$root.$app.options.showPaySystemSettingBanner){this.$store.commit("orderCreation/showBanner")}var i=BX.Currency.currencyFormat(0,e,true);this.$store.dispatch("orderCreation/setCurrency",e);this.$store.commit("orderCreation/setTotal",{sum:i,discount:i,result:i});this.addBasketItemForm()},methods:{refreshBasket:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:300;this.$store.dispatch("orderCreation/refreshBasket",{timeout:e})},changeBasketItem:function t(e){this.$store.dispatch("orderCreation/changeBasketItem",{index:e.index,fields:e.fields})},removeItem:function t(e){this.$store.dispatch("orderCreation/removeItem",{index:e.index});this.refreshBasket()},addBasketItemForm:function t(){this.$store.commit("orderCreation/addBasketItem")},hideBanner:function t(){this.$store.commit("orderCreation/hideBanner");var e=this.$root.$app.options.orderCreationOption||false;var i=this.$root.$app.options.paySystemBannerOptionName||false;if(e&&i){BX.userOptions.save("salescenter",e,i,"Y")}},openControlPanel:function t(){p.Manager.openControlPanel()}},computed:babelHelpers.objectSpread({localize:function t(){return f.Vue.getFilteredPhrases("SALESCENTER_")},total:function t(){return this.order.total},countItems:function t(){return this.order.basket.length},isShowedBanner:function t(){return this.order.showPaySystemSettingBanner}},u.Vuex.mapState({order:function t(e){return e.orderCreation}})),template:'\n\t<div class="salescenter-app-payment-side">\n\t\t<div class="salescenter-app-page-content">\n\t\t\t<div v-for="(item, index) in order.basket" class="salescenter-app-form-wrapper">\n\t\t\t\t<'.concat(v.templateAddPaymentProductName,' \n\t\t\t\t\t:basketItem="item" \n\t\t\t\t\t:basketItemIndex="index"  \n\t\t\t\t\t:countItems="countItems"\n\t\t\t\t\t:selectedProductIds="order.selectedProducts"\n\t\t\t\t\t@changeBasketItem="changeBasketItem" \n\t\t\t\t\t@removeItem="removeItem" \n\t\t\t\t\t@refreshBasket="refreshBasket" \n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="salescenter-app-add-item-container">\n\t\t\t\t<a @click="addBasketItemForm" class="salescenter-app-add-item-link">{{localize.SALESCENTER_PRODUCT_ADD_PRODUCT}}</a>\n\t\t\t</div>\n\t\t\t<div class="salescenter-app-result-container">\n\t\t\t\t<div class="salescenter-app-result-grid-row">\n\t\t\t\t\t<div class="salescenter-app-result-grid-item">{{localize.SALESCENTER_PRODUCT_TOTAL_SUM}}:</div>\n\t\t\t\t\t<div class="salescenter-app-result-grid-item" :class="total.result !== total.sum ? \'salescenter-app-text-line-through\' : \'\'" v-html="total.sum"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="salescenter-app-result-grid-row salescenter-app-result-grid-benefit">\n\t\t\t\t\t<div class="salescenter-app-result-grid-item">{{localize.SALESCENTER_PRODUCT_TOTAL_DISCOUNT}}:</div>\n\t\t\t\t\t<div class="salescenter-app-result-grid-item" v-html="total.discount"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="salescenter-app-result-grid-row salescenter-app-result-grid-total">\n\t\t\t\t\t<div class="salescenter-app-result-grid-item">{{localize.SALESCENTER_PRODUCT_TOTAL_RESULT}}:</div>\n\t\t\t\t\t<div class="salescenter-app-result-grid-item" v-html="total.result"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="salescenter-app-banner"  v-if="isShowedBanner">\n\t\t\t\t<div class="salescenter-app-banner-inner">\n\t\t\t\t\t<div class="salescenter-app-banner-title">{{localize.SALESCENTER_BANNER_TITLE}}</div>\n\t\t\t\t\t<div class="salescenter-app-banner-content">\n\t\t\t\t\t\t<div class="salescenter-app-banner-text">{{localize.SALESCENTER_BANNER_TEXT}}</div>\n\t\t\t\t\t\t<div class="salescenter-app-banner-btn-block">\n\t\t\t\t\t\t\t<button class="ui-btn ui-btn-sm ui-btn-primary salescenter-app-banner-btn-connect" @click="openControlPanel">{{localize.SALESCENTER_BANNER_BTN_CONFIGURE}}</button>\n\t\t\t\t\t\t\t<button class="ui-btn ui-btn-sm ui-btn-link salescenter-app-banner-btn-hide" @click="hideBanner">{{localize.SALESCENTER_BANNER_BTN_HIDE}}</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="salescenter-app-banner-close" @click="hideBanner"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n')});var P=function(){function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{dialogId:null,sessionId:null,orderAddPullTag:null,landingPublicationPullTag:null,landingUnPublicationPullTag:null,isFrame:true,isOrderPublicUrlAvailable:false,isCatalogAvailable:false,isOrderPublicUrlExists:false};babelHelpers.classCallCheck(this,t);this.slider=BX.SidePanel.Instance.getTopSlider();this.dialogId=i.dialogId;this.sessionId=parseInt(i.sessionId);this.orderAddPullTag=i.orderAddPullTag;this.landingPublicationPullTag=i.landingPublicationPullTag;this.landingUnPublicationPullTag=i.landingUnPublicationPullTag;this.options=i;this.isProgress=false;this.fillPagesTimeout=false;this.disableSendButton=false;this.context="";this.fillPagesQueue=[];this.ownerTypeId="";this.ownerId="";if(n.Type.isBoolean(i.isFrame)){this.isFrame=i.isFrame}else{this.isFrame=true}if(n.Type.isBoolean(i.isOrderPublicUrlAvailable)){this.isOrderPublicUrlAvailable=i.isOrderPublicUrlAvailable}else{this.isOrderPublicUrlAvailable=false}if(n.Type.isBoolean(i.isOrderPublicUrlExists)){this.isOrderPublicUrlExists=i.isOrderPublicUrlExists}else{this.isOrderPublicUrlExists=false}if(n.Type.isBoolean(i.isCatalogAvailable)){this.isCatalogAvailable=i.isCatalogAvailable}else{this.isCatalogAvailable=false}if(n.Type.isBoolean(i.disableSendButton)){this.disableSendButton=i.disableSendButton}if(i.ownerTypeId){this.ownerTypeId=i.ownerTypeId}if(i.ownerId){this.ownerId=i.ownerId}if(n.Type.isString(i.context)&&i.context.length>0){this.context=i.context}else if(this.sessionId&&this.dialogId){this.context="imopenlines_app"}if(n.Type.isBoolean(i.isPaymentsLimitReached)){this.isPaymentsLimitReached=i.isPaymentsLimitReached}else{this.isPaymentsLimitReached=false}this.isPaymentCreationAvailable=this.sessionId>0&&this.dialogId.length>0||this.ownerTypeId&&this.ownerId;this.connector=n.Type.isString(i.connector)?i.connector:"";n.Event.ready(function(){e.pull=BX.PULL;e.initPull();e.isSiteExists=p.Manager.isSiteExists});t.initStore().then(function(t){return e.initTemplate(t)}).catch(function(e){return t.showError(e)})}babelHelpers.createClass(t,[{key:"initPull",value:function t(){var e=this;if(this.pull){if(n.Type.isString(this.orderAddPullTag)){this.pull.subscribe({moduleId:v.moduleId,command:this.orderAddPullTag,callback:function t(i){if(parseInt(i.sessionId)===e.sessionId&&i.orderId>0){p.Manager.showOrdersListAfterCreate(i.orderId)}}})}if(n.Type.isString(this.landingPublicationPullTag)){this.pull.subscribe({moduleId:v.moduleId,command:this.landingPublicationPullTag,callback:function t(i){if(parseInt(i.landingId)>0){e.fillPages()}if(i.hasOwnProperty("isOrderPublicUrlAvailable")&&n.Type.isBoolean(i.isOrderPublicUrlAvailable)){e.isOrderPublicUrlAvailable=i.isOrderPublicUrlAvailable;e.isOrderPublicUrlExists=true}}})}if(n.Type.isString(this.landingUnPublicationPullTag)){this.pull.subscribe({moduleId:v.moduleId,command:this.landingUnPublicationPullTag,callback:function t(i){if(parseInt(i.landingId)>0){e.fillPages()}if(i.hasOwnProperty("isOrderPublicUrlAvailable")&&n.Type.isBoolean(i.isOrderPublicUrlAvailable)){e.isOrderPublicUrlAvailable=i.isOrderPublicUrlAvailable;e.isOrderPublicUrlExists=true}}})}}}},{key:"initTemplate",value:function t(e){var i=this;return new Promise(function(t){var s=i;i.store=e.store;i.templateEngine=f.Vue.create({el:document.getElementById("salescenter-app-root"),template:"<".concat(v.templateName,"/>"),store:i.store,created:function t(){this.$app=s;this.$nodes={footer:document.getElementById("footer"),leftPanel:document.getElementById("left-panel"),title:document.getElementById("pagetitle"),paymentsLimit:document.getElementById("salescenter-payment-limit-container")}},mounted:function e(){t()}})})}},{key:"closeApplication",value:function t(){if(this.slider){this.slider.close()}}},{key:"fillPages",value:function t(){var i=this;return new Promise(function(t){if(i.isProgress){i.fillPagesQueue.push(t)}else{if(i.fillPagesTimeout){clearTimeout(i.fillPagesTimeout)}i.fillPagesTimeout=setTimeout(function(){i.startProgress();e.rest.callMethod("salescenter.page.list",{}).then(function(e){i.store.commit("application/setPages",{pages:e.answer.result.pages});i.stopProgress();t();i.fillPagesQueue.forEach(function(t){t()});i.fillPagesQueue=[]})},100)}})}},{key:"getLoader",value:function t(){if(!this.loader){this.loader=new s.Loader({size:200})}return this.loader}},{key:"showLoader",value:function t(){if(this.templateEngine){this.getLoader().show(this.templateEngine.$el)}}},{key:"hideLoader",value:function t(){this.getLoader().hide()}},{key:"startProgress",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.isProgress=true;this.showLoader();if(n.Type.isDomNode(e)){e.classList.add("ui-btn-wait")}}},{key:"stopProgress",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.isProgress=false;this.hideLoader();if(n.Type.isDomNode(e)){e.classList.remove("ui-btn-wait")}}},{key:"hidePage",value:function e(i){var s=this;return new Promise(function(e,n){var a;if(i.landingId>0){a=p.Manager.hidePage(i)}else{a=p.Manager.deleteUrl(i)}a.then(function(){s.store.commit("application/removePage",{page:i});e()}).catch(function(e){t.showError(e.answer.error_description);n(e.answer.error_description)})})}},{key:"sendPage",value:function e(i){var s=this;if(this.isProgress){return}if(this.disableSendButton){return}var a=this.store.getters["application/getPages"]();var r;for(var l in a){if(a.hasOwnProperty(l)&&a[l].id===i){r=a[l];break}}var o="other";if(r.landingId>0){if(parseInt(r.siteId)===parseInt(p.Manager.connectedSiteId)){o="landing_store_chat"}else{o="landing_other"}}if(!this.dialogId){this.slider.data.set("action","sendPage");this.slider.data.set("page",r);this.slider.data.set("pageId",i);if(this.context==="sms"){this.startProgress();BX.Salescenter.Manager.addAnalyticAction({analyticsLabel:"salescenterSendSms",context:this.context,source:o,type:r.isWebform?"form":"info",code:r.code}).then(function(){s.stopProgress();s.closeApplication()})}else{this.closeApplication()}return}this.startProgress();n.ajax.runAction("salescenter.page.send",{analyticsLabel:"salescenterSendChat",getParameters:{dialogId:this.dialogId,context:this.context,source:o,type:r.isWebform?"form":"info",connector:this.connector,code:r.code},data:{id:i,options:{dialogId:this.dialogId,sessionId:this.sessionId}}}).then(function(){s.stopProgress();s.closeApplication()}).catch(function(e){t.showError(e.errors.pop().message);s.stopProgress()})}},{key:"sendPayment",value:function e(i){var s=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"n";if(!this.isPaymentCreationAvailable){this.closeApplication();return null}var r=this.store.getters["orderCreation/getBasket"]();if(!this.store.getters["orderCreation/isAllowedSubmit"]||this.isProgress){return null}this.startProgress(i);this.store.dispatch("orderCreation/refreshBasket",{timeout:0,onsuccess:function e(){BX.ajax.runAction("salescenter.order.createPayment",{data:{basketItems:r,options:{dialogId:s.dialogId,sessionId:s.sessionId,ownerTypeId:s.ownerTypeId,ownerId:s.ownerId,skipPublicMessage:a}},analyticsLabel:"salescenterCreatePayment",getParameters:{dialogId:s.dialogId,context:s.context,connector:s.connector,skipPublicMessage:a}}).then(function(t){s.store.dispatch("orderCreation/resetBasket");s.stopProgress(i);if(a==="y"){var e={content:n.Loc.getMessage("SALESCENTER_ORDER_CREATE_NOTIFICATION").replace("#ORDER_ID#",t.data.order.number)};e.actions=[{title:n.Loc.getMessage("SALESCENTER_VIEW"),events:{click:function e(){p.Manager.showOrderAdd(t.data.order.id)}}}];BX.UI.Notification.Center.notify(e);p.Manager.showOrdersList({orderId:t.data.order.id,ownerId:s.ownerId,ownerTypeId:s.ownerTypeId})}else{s.slider.data.set("action","sendPayment");s.slider.data.set("order",t.data.order);s.closeApplication()}}).catch(function(e){s.stopProgress(i);t.showError(e)})},onfailure:function t(){s.stopProgress(i)}})}},{key:"getOrdersCount",value:function t(){if(this.sessionId>0){return e.rest.callMethod("salescenter.order.getActiveOrdersCount",{sessionId:this.sessionId})}else{return new Promise(function(t,e){})}}}],[{key:"initStore",value:function t(){var e=new u.VuexBuilder;return e.addModel(m.create()).addModel(g.create()).useNamespace(true).build()}},{key:"showError",value:function t(e){console.error(e)}}]);return t}();t.App=P})(this.BX.Salescenter=this.BX.Salescenter||{},BX,BX,BX,BX,BX,BX,BX,BX,BX,BX,BX,BX.Salescenter,BX,BX);
//# sourceMappingURL=app.bundle.map.js