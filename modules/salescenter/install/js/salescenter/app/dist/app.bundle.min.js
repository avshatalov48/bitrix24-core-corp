this.BX=this.BX||{};(function(t,e,n,s,i,o,a,r,l,c,p,d,u,m,h,g,f,v,y,b,S,E,T,C,P,$,I,_,L,O,A,k,M,w,x,R){"use strict";c=c&&c.hasOwnProperty("default")?c["default"]:c;var N={data:function t(){return{editable:true}},created:function t(){var e=this;this.$root.$on("on-change-editable",(function(t){e.editable=t}))}};var B={components:{"label-block":i.Label,"tile-label-block":i.TileLabel,"tile-hint-img-block":i.TileHintImg,"tile-hint-plus-block":i.TileLabelPlus,"tile-hint-img-caption-block":i.TileHintImgCaption,"tile-hint-background-block":i.TileHintBackground,"tile-hint-background-caption-block":i.TileHintBackgroundCaption},methods:{getCollectionTile:function t(){return this.tiles},getCollectionTileByFilter:function t(e){var n=new Map;var s=this.getCollectionTile();if(e.hasOwnProperty("type")&&e.type.length>0){s.forEach((function(t,s){if(e.type===t.getType()){n.set(s,t)}}))}else{s.forEach((function(t,e){return n.set(e,t)}))}return n},hasTileOfferFromCollection:function t(){var e=this.getCollectionTileByFilter({type:$.Offer.type()});return e.size>0},hasTileMoreFromCollection:function t(){var e=this.getCollectionTileByFilter({type:$.More.type()});return e.size>0},getTileOfferFromCollection:function t(){var e=this.getCollectionTileByFilter({type:$.Offer.type()});var n={};e.forEach((function(t,e){n={index:e,tile:t};return false}));return n},getTileMoreFromCollection:function t(){var e=this.getCollectionTileByFilter({type:$.More.type()});var n={};e.forEach((function(t,e){n={index:e,tile:t};return false}));return n},getTileByIndex:function t(e){var n=null;this.getCollectionTileByFilter({}).forEach((function(t,s){if(e===s){n=t}}));return n},openSlider:function t(e){var n=this;var i=new s.AppSlider;var o=this.getTileByIndex(e);i.openAppLocal(o,this.getOptionSlider);i.subscribe(s.EventTypes.AppSliderSliderClose,(function(t){return n.$emit("on-tile-slider-close",{data:t.data})}))},isControlTile:function t(e){return[$.More.type(),$.Offer.type()].includes(e.getType())},showHint:function t(e,n){var s=n.data.event;var i=this.getTileByIndex(e);this.popup=new o.Popup;this.popup.show(s.target,i.info)},hideHint:function t(){if(this.popup){this.popup.hide()}}},computed:{getOptionSlider:function t(){return{width:1e3}}}};var D={props:{tiles:{type:Array,required:true}},mixins:[B],template:'\t\t\n\t\t<div>\n\t\t\t<template v-for="(tile, index) in tiles">\n\t\t\t\t<tile-hint-background-caption-block\tv-if="tile.img.length > 0 && tile.showTitle"\n\t\t\t\t\t:src="tile.img"\n\t\t\t\t\t:name="tile.name"\n\t\t\t\t\t:caption="tile.name"\n\t\t\t\t\tv-on:tile-hint-bg-label-on-click="openSlider(index)"\n\t\t\t\t\tv-on:tile-hint-bg-label-on-mouseenter="showHint(index, $event)"\n\t\t\t\t\tv-on:tile-hint-bg-label-on-mouseleave="hideHint"\n\t\t\t\t/>\n\t\t\t\t<tile-hint-background-block\t\tv-else-if="tile.img.length > 0"\n\t\t\t\t\t:src="tile.img"\n\t\t\t\t\t:name="tile.name"\n\t\t\t\t\tv-on:tile-hint-bg-on-click="openSlider(index)"\n\t\t\t\t\tv-on:tile-label-bg-hint-on-mouseenter="showHint(index, $event)"\n\t\t\t\t\tv-on:tile-label-bg-hint-on-mouseleave="hideHint"\n\t\t\t\t/>\n\t\t\t\t<tile-hint-plus-block\t\t\tv-else \n\t\t\t\t\t:name="tile.name" \n\t\t\t\t\tv-on:tile-label-plus-on-click="openSlider(index)"\n\t\t\t\t/> \n\t\t\t</template>\n\t\t</div>\n\t'};var F={props:{tiles:{type:Array,required:true}},mixins:[B],template:'\t\n\t\t<div class="salescenter-app-payment-by-sms-item-container-payment">\n\t\t\t<div class="salescenter-app-payment-by-sms-item-container-payment-inline">\n\t\t\t\t<tile-label-block class="salescenter-app-payment-by-sms-item-container-payment-item-text"\n\t\t\t\t\tv-for="(tile, index) in tiles"\n\t\t\t\t\tv-bind:key="index"\n\t\t\t\t\tv-if="isControlTile(tile) === false"\n\t\t\t\t\t:name="tile.name" \n\t\t\t\t\tv-on:tile-label-on-click="openSlider(index)"\n\t\t\t\t/>\n\t\t\t\t<br>\n\t\t\t\t<tile-label-block class="salescenter-app-payment-by-sms-item-container-payment-item-text-add"\n\t\t\t\t\tv-if="hasTileOfferFromCollection() === true"\n\t\t\t\t\t:name="getTileOfferFromCollection().tile.name"\n\t\t\t\t\tv-on:tile-label-on-click="openSlider(getTileOfferFromCollection().index)"\n\t\t\t\t/>\n\t\t\t\t<tile-label-block class="salescenter-app-payment-by-sms-item-container-payment-item-text-add"\n\t\t\t\t\tv-if="hasTileMoreFromCollection() === true"\n\t\t\t\t\t:name="getTileMoreFromCollection().tile.name"\n\t\t\t\t\tv-on:tile-label-on-click="openSlider(getTileMoreFromCollection().index)"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t'};var U={computed:{statusClassMixin:function t(){return{"salescenter-app-payment-by-sms-item":true,"salescenter-app-payment-by-sms-item-current":this.status===_.StatusTypes.current,"salescenter-app-payment-by-sms-item-disabled":this.status===_.StatusTypes.disabled}},containerClassMixin:function t(){return{"salescenter-app-payment-by-sms-item-container":true}},counterCheckedMixin:function t(){return this.status===_.StatusTypes.complete}},methods:{onSliderClose:function t(e){this.$emit("on-stage-tile-collection-slider-close",e)}}};var H={props:{status:{type:String,required:true},counter:{type:Number,required:true},tiles:{type:Array,required:true},installed:{type:Boolean,required:true},titleItems:{type:Array},initialCollapseState:{type:Boolean,required:true}},mixins:[U],components:{"stage-block-item":_.Block,"tile-collection-installed-block":F,"tile-collection-uninstalled-block":D},computed:{statusClass:function t(){return{"salescenter-app-payment-by-sms-item-disabled-bg":this.installed===false}},title:function t(){return this.installed===true?w.Loc.getMessage("SALESCENTER_CASHBOX_SET_BLOCK_TITLE"):w.Loc.getMessage("SALESCENTER_CASHBOX_BLOCK_TITLE")},configForBlock:function t(){return{counter:this.counter,titleItems:this.installed?this.titleItems:[],installed:this.installed,collapsible:true,checked:this.counterCheckedMixin,showHint:!this.installed,initialCollapseState:this.initialCollapseState}}},methods:{onItemHint:function t(e){BX.Salescenter.Manager.openHowToConfigCashBox(e)},saveCollapsedOption:function t(e){this.$emit("on-save-collapsed-option","cashbox",e)}},template:'\n\t\t<stage-block-item\n\t\t\t:class="[statusClassMixin, statusClass]"\n\t\t\t:config="configForBlock"\n\t\t\t@on-item-hint.stop.prevent="onItemHint"\n\t\t\t@on-tile-slider-close="onSliderClose"\n\t\t\t@on-adjust-collapsed="saveCollapsedOption"\n\t\t>\n\t\t\t<template v-slot:block-title-title>{{title}}</template>\n\t\t\t<template v-slot:block-hint-title>\n\t\t\t\t'.concat(w.Loc.getMessage("SALESCENTER_CASHBOX_BLOCK_SETTINGS_TITLE"),'\n\t\t\t</template>\n\t\t\t<template v-slot:block-container>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!installed"\n\t\t\t\t\tclass="salescenter-app-explanation"\n\t\t\t\t>\n\t\t\t\t\t<div class="salescenter-app-explanation-img"></div>\n\t\t\t\t\t<div class="salescenter-app-explanation-area">\n\t\t\t\t\t\t<div class="salescenter-app-explanation-text">\n\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_TERMINAL_CASHBOX_SETUP_HINT"),'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div :class="containerClassMixin">\n\t\t\t\t\t<tile-collection-uninstalled-block \t:tiles="tiles" v-if="!installed" v-on:on-tile-slider-close="onSliderClose"/>\n\t\t\t\t\t<tile-collection-installed-block :tiles="tiles" v-on:on-tile-slider-close="onSliderClose" v-else />\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</stage-block-item>\n\t')};var j=Object.freeze({payment:"payment",delivery:"delivery",paymentDelivery:"payment_delivery",terminalPayment:"terminal_payment"});function X(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function V(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?X(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var q={mixins:[N],mounted:function t(){var e=this.$root.$app.options.templateMode!=="view";var n=this.$root.$app.compilation!==null;this.$root.$emit("on-change-editable",e);if(this.productForm){this.productForm.setEditable(e,n)}if(this.productForm){var s=this.$root.$el.querySelector(".salescenter-app-form-wrapper");s.appendChild(this.productForm.layout())}},created:function t(){var e;this.refreshId=null;var n=this.$root.$app.options.currencyCode||"";this.$store.dispatch("orderCreation/setCurrency",n);if(w.Type.isArray(this.$root.$app.options.basket)){var s=[];this.$root.$app.options.basket.forEach((function(t){s.push(t.fields)}));this.$store.commit("orderCreation/setBasket",s)}if(w.Type.isObject(this.$root.$app.options.totals)){this.$store.commit("orderCreation/setTotal",this.$root.$app.options.totals)}this.productForm=new a.ProductForm({currencySymbol:this.$root.$app.options.currencySymbol,currency:n,iblockId:this.$root.$app.options.catalogIblockId,basePriceId:this.$root.$app.options.basePriceId,basket:w.Type.isArray(this.$root.$app.options.basket)?this.$root.$app.options.basket:[],totals:this.$root.$app.options.totals,taxList:this.$root.$app.options.vatList,measures:this.$root.$app.options.measures,showDiscountBlock:this.$root.$app.options.showProductDiscounts,showTaxBlock:this.$root.$app.options.showProductTaxes,totalResultLabel:this.$root.$app.options.mode==="delivery"?w.Loc.getMessage("SALESCENTER_SHIPMENT_PRODUCT_BLOCK_TOTAL"):null,urlBuilderContext:this.$root.$app.options.urlProductBuilderContext,isCatalogPriceEditEnabled:this.$root.$app.options.isCatalogPriceEditEnabled,isCatalogDiscountSetEnabled:this.$root.$app.options.isCatalogDiscountSetEnabled,fieldHints:this.$root.$app.options.fieldHints,hideUnselectedProperties:this.$root.$app.options.templateMode==="view",showCompilationModeSwitcher:this.$root.$app.options.templateMode==="create"&&this.$root.$app.options.showCompilationModeSwitcher==="Y"&&this.$root.$app.options.mode===j.paymentDelivery,compilationFormType:this.$root.$app.connector==="facebook"&&this.$root.$app.isAllowedFacebookRegion?"FACEBOOK":"REGULAR",facebookFailProducts:(e=this.$root.$app.compilation)===null||e===void 0?void 0:e.FAIL_PRODUCTS,ownerId:this.$root.$app.options.ownerId,ownerTypeId:this.$root.$app.options.ownerTypeId,dialogId:this.$root.$app.options.dialogId,sessionId:this.$root.$app.options.sessionId,isShortProductViewFormat:true});this.checkProductErrors();r.EventEmitter.subscribe(this.productForm,"ProductForm:onBasketChange",w.Runtime.debounce(this.onBasketChange,500,this));r.EventEmitter.subscribe(this.productForm,"ProductForm:onErrorsChange",w.Runtime.debounce(this.checkProductErrors,500,this));r.EventEmitter.subscribe(this.productForm,"ProductForm:onModeChange",this.onProductFormModeChange);r.EventEmitter.subscribe(this.productForm,"ProductForm:onCompilationCreated",this.onProductFormCompilationCreated.bind(this))},methods:{onProductFormCompilationCreated:function t(e){var n=e.getData();this.$root.$app.newCompilationId=n.compilationId;this.$root.$app.ownerId=n.ownerId;this.$root.$app.options.ownerId=n.ownerId},onProductFormModeChange:function t(e){var n=e.getData().mode;if(n===a.FormMode.COMPILATION||n===a.FormMode.COMPILATION_READ_ONLY){this.$store.commit("orderCreation/enableCompilationMode")}else{this.$store.commit("orderCreation/disableCompilationMode")}this.$emit("on-product-form-mode-change")},onBasketChange:function t(e){var n=this;var s=function t(e){if(n.productForm){var s=[];e.basket.forEach((function(t){if(!w.Type.isStringFilled(t.innerId)){return}s.push({selectorId:t.innerId,fields:t})}));n.productForm.setData(V(V({},e),{},{basket:s}));if(w.Type.isArray(e.basket)){n.$store.commit("orderCreation/setBasket",e.basket)}if(w.Type.isObject(e.total)){n.$store.commit("orderCreation/setTotal",e.total)}}};var i=e.getData();if(!w.Type.isArray(i.basket)){return}var o=[];i.basket.forEach((function(t){o.push(t.fields)}));this.$store.commit("orderCreation/setBasket",o);if(this.$root.$app.newCompilationId){this.changeCompilationProducts()}if(this.isNeedDisableSubmit()){this.$store.commit("orderCreation/disableSubmit");return}this.$store.commit("orderCreation/enableSubmit");var a=w.Text.getRandom(20);this.refreshId=a;w.ajax.runAction("salescenter.api.order.refreshBasket",{data:{orderId:this.$root.$app.orderId,basketItems:o}}).then((function(t){if(n.refreshId!==a){return}var e=BX.prop.getObject(t,"data",{});s({total:BX.prop.getObject(e,"total",{discount:0,result:0,sum:0}),basket:BX.prop.get(e,"items",[])})}))["catch"]((function(t){var e=BX.prop.getObject(t,"data",{});s({errors:BX.prop.get(t,"errors",[]),basket:BX.prop.get(e,"items",[])})}))},changeCompilationProducts:function t(){var e=this.$store.getters["orderCreation/getBasket"]();var n=e.map((function(t){return t.skuId}));var s=this.$root.$app.compilation?this.$root.$app.compilation.ID:this.$root.$app.newCompilationId;if(s){w.ajax.runAction("salescenter.compilation.updateCompilation",{data:{compilationId:s,productIds:n}})}},checkProductErrors:function t(){if(this.isNeedDisableSubmit()){this.$store.commit("orderCreation/disableSubmit")}else{this.$store.commit("orderCreation/enableSubmit")}},isNeedDisableSubmit:function t(){var e=this.$store.getters["orderCreation/getBasket"]();if(e.length<=0||this.productForm&&w.Type.isFunction(this.productForm.hasErrors)&&this.productForm.hasErrors()){return true}var n=e.filter((function(t){return w.Type.isStringFilled(t.module)&&t.productId>0}));return n.length<=0}},template:'\n\t\t<div class="salescenter-app-payment-side">\n\t\t\t<div class="salescenter-app-page-content">\n\t\t\t\t<div class="salescenter-app-form-wrapper"></div>\n\t\t\t\t<slot name="footer"></slot>\n\t\t\t</div>\n\t\t</div>\n\t'};function Y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function W(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Y(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var K={props:{status:{type:String,required:true},counter:{type:Number,required:true},title:{type:String,required:true},hintTitle:{type:String,required:true},additionalContainerClasses:{type:Object,required:false,default:function t(){return{}}}},mixins:[U],components:{"stage-block-item":_.Block,product:q},methods:{onItemHint:function t(e){BX.Salescenter.Manager.openHowToSell(e)},onProductFormModeChange:function t(e){this.$emit("on-product-form-mode-change")}},computed:{configForBlock:function t(){return{counter:this.counter,checked:this.counterCheckedMixin,showHint:true}},containerClasses:function t(){return W(W({},this.statusClassMixin),this.additionalContainerClasses)}},template:'\n\t\t<stage-block-item\n\t\t\t@on-item-hint.stop.prevent="onItemHint"\n\t\t\t:config="configForBlock"\n\t\t\t:class="containerClasses"\n\t\t>\n\t\t\t<template v-slot:block-title-title>{{ title }}</template>\n\t\t\t<template v-slot:block-hint-title>{{ hintTitle }}</template>\n\t\t\t<template v-slot:block-container>\n\t\t\t\t<div :class="containerClassMixin">\n\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-payment">\n\t\t\t\t\t\t<product\n\t\t\t\t\t\t@on-product-form-mode-change="onProductFormModeChange"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</stage-block-item>\n\t'};function G(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function z(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?G(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Q={props:{config:{type:Object,required:true}},components:{"delivery-selector":c},data:function t(){return{availableServices:[]}},methods:{onChange:function t(e){this.$store.dispatch("orderCreation/setDelivery",e.deliveryPrice);this.$store.dispatch("orderCreation/setDeliveryId",e.deliveryServiceId);this.$store.dispatch("orderCreation/setPropertyValues",e.relatedPropsValues);this.$store.dispatch("orderCreation/setDeliveryExtraServicesValues",e.relatedServicesValues);this.$store.dispatch("orderCreation/setExpectedDelivery",e.estimatedDeliveryPrice);this.$store.dispatch("orderCreation/setDeliveryResponsibleId",e.responsibleUser?e.responsibleUser.id:null);this.$emit("change",e)},onAddressFromChanged:function t(){this.refreshAvailableServices()},onDeliveryServiceChanged:function t(){this.refreshAvailableServices()},onSettingsChanged:function t(){this.$emit("delivery-settings-changed")},refreshAvailableServices:function t(){var e=this;w.ajax.runAction("salescenter.order.getCompatibleDeliverySystems",{data:{basketItems:this.config.basket?this.config.basket:[],options:{sessionId:this.config.sessionId,ownerTypeId:this.config.ownerTypeId,ownerId:this.config.ownerId},deliveryServiceId:this.order.deliveryId,shipmentPropValues:this.order.propertyValues,deliveryRelatedServiceValues:this.order.deliveryExtraServicesValues,deliveryResponsibleId:this.order.deliveryResponsibleId}}).then((function(t){var n=BX.prop.getObject(t,"data",{});e.availableServices=n.availableServices?n.availableServices:{}}))["catch"]((function(t){e.availableServices={}}))}},created:function t(){this.$store.dispatch("orderCreation/setPersonTypeId",this.config.personTypeId);this.refreshAvailableServices()},computed:z({localize:function t(){return l.Vue.getFilteredPhrases("SALESCENTER_")},sumTitle:function t(){return w.Loc.getMessage("SALESCENTER_PRODUCT_PRODUCTS_PRICE")},productsPrice:function t(){return this.order.total.result},delivery:function t(){return this.order.delivery},deliveryFormatted:function t(){if(this.isDeliveryCalculated){return BX.Currency.currencyFormat(this.delivery,this.config.currency,false)}},total:function t(){if(this.productsPrice===null||this.delivery===null){return null}return this.productsPrice+this.delivery},totalFormatted:function t(){return BX.Currency.currencyFormat(this.total,this.config.currency,false)},isDeliveryCalculated:function t(){return this.order.delivery!==null},excludedServiceIds:function t(){return this.$root.$app.options.mode==="delivery"?[this.$root.$app.options.emptyDeliveryServiceId]:[]},actionData:function t(){return{basketItems:this.config.basket,options:{orderId:this.$root.$app.orderId,sessionId:this.config.sessionId,ownerTypeId:this.config.ownerTypeId,ownerId:this.config.ownerId}}}},k.Vuex.mapState({order:function t(e){return e.orderCreation}})),template:'\n\t\t<delivery-selector\n\t\t\t:available-services="availableServices"\n\t\t\t:excluded-service-ids="excludedServiceIds"\t\t\t\t\n\t\t\t:init-entered-delivery-price="config.deliveryPrice"\n\t\t\t:init-delivery-service-id="config.deliveryServiceId"\n\t\t\t:init-related-services-values="config.relatedServicesValues"\n\t\t\t:init-related-props-values="config.relatedPropsValues"\n\t\t\t:init-related-props-options="config.relatedPropsOptions"\n\t\t\t:init-responsible-id="config.responsibleId"\n\t\t\t:person-type-id="config.personTypeId"\n\t\t\t:action="\'salescenter.api.order.refreshDelivery\'"\n\t\t\t:action-data="actionData"\n\t\t\t:external-sum="productsPrice"\n\t\t\t:external-sum-label="sumTitle"\n\t\t\t:currency="config.currency"\n\t\t\t:currency-symbol="config.currencySymbol"\n\t\t\t@change="onChange"\n\t\t\t@address-from-changed="onAddressFromChanged"\n\t\t\t@delivery-service-changed="onDeliveryServiceChanged"\n\t\t\t@settings-changed="onSettingsChanged"\n\t\t></delivery-selector>\n\t'};var Z={props:{id:{type:Number,required:true},productsPrice:{type:Number,required:true}},data:function t(){return{shipment:{priceDelivery:null,basePriceDelivery:null,currency:null,deliveryService:{name:null,logo:null,parent:{name:null,logo:null}},extraServices:[],requestProperties:[]},canUserPerformCalls:false}},created:function t(){var e=this;w.ajax.runAction("salescenter.deliveryselector.getShipmentData",{data:{id:this.id}}).then((function(t){e.shipment=t.data.shipment;e.canUserPerformCalls=t.data.canUserPerformCalls}))},methods:{getFormattedPrice:function t(e){return BX.Currency.currencyFormat(e,this.currency,true)},isPhoneRequestProperty:function t(e){if(!w.Type.isArray(e.tags)){return false}return e.tags.includes("phone")},makeCall:function t(e){if(!w.Type.isUndefined(window.top["BXIM"])&&this.canUserPerformCalls===true){window.top["BXIM"].phoneTo(e)}else{window.open("tel:"+e,"_self")}}},computed:{hasParent:function t(){return this.shipment.hasOwnProperty("deliveryService")&&this.shipment.deliveryService.hasOwnProperty("parent")&&this.shipment.deliveryService.parent},deliveryServiceLogo:function t(){return this.shipment.deliveryService.logo?this.shipment.deliveryService.logo:null},deliveryServiceProfileLogo:function t(){return this.hasParent&&this.shipment.deliveryService.parent.logo?this.shipment.deliveryService.parent.logo:null},paymentPrice:function t(){return this.productsPrice+this.priceDelivery},deliveryServiceName:function t(){return this.hasParent?this.shipment.deliveryService.parent.name:this.shipment.deliveryService.name},deliveryServiceProfileName:function t(){return this.hasParent?this.shipment.deliveryService.name:null},priceDelivery:function t(){return this.shipment?this.shipment.priceDelivery:null},currency:function t(){return this.shipment?this.shipment.currency:null},extraServices:function t(){return w.Type.isArray(this.shipment.extraServices)?this.shipment.extraServices:[]},isExtraServicesVisible:function t(){return this.extraServices.length>0},requestProperties:function t(){return w.Type.isArray(this.shipment.requestProperties)?this.shipment.requestProperties:[]},isRequestPropertiesVisible:function t(){return this.requestProperties.length>0},priceDeliveryFormatted:function t(){return this.getFormattedPrice(this.priceDelivery)},productsPriceFormatted:function t(){return this.getFormattedPrice(this.productsPrice)},paymentPriceFormatted:function t(){return this.getFormattedPrice(this.paymentPrice)}},template:'\n\t\t<div style="width: 100%;" xmlns="http://www.w3.org/1999/html">\n\t\t\t<div class="salescenter-delivery-selector-head">\n\t\t\t\t<div\n\t\t\t\t\tv-if="hasParent && deliveryServiceLogo"\n\t\t\t\t\t:style="{ backgroundImage: \'url(\' + deliveryServiceLogo + \')\' }"\n\t\t\t\t\tclass="salescenter-delivery-selector-logo"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class="salescenter-delivery-selector-info">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="deliveryServiceProfileLogo"\n\t\t\t\t\t\t:style="{ backgroundImage: \'url(\' + deliveryServiceProfileLogo + \')\' }"\n\t\t\t\t\t\tclass="salescenter-delivery-selector-logo"\n\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="salescenter-delivery-selector-content">\n\t\t\t\t\t\t<div class="salescenter-delivery-selector-text-light">{{deliveryServiceName}}</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="deliveryServiceProfileName"\n\t\t\t\t\t\t\tclass="salescenter-delivery-selector-text-dark"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{deliveryServiceProfileName}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="isExtraServicesVisible" class="salescenter-delivery-selector-main">\n\t\t\t\t<div class="salescenter-delivery-selector-text-light">\n\t\t\t\t\t'.concat(w.Loc.getMessage("SALESCENTER_SHIPMENT_EXTRA_SERVICES"),':\n\t\t\t\t</div>\n\t\t\t\t<ul class="salescenter-delivery-selector-list">\n\t\t\t\t\t<li\n\t\t\t\t\t\tv-for="extraService in extraServices"\n\t\t\t\t\t\tclass="salescenter-delivery-selector-list-item salescenter-delivery-selector-text-dark"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{extraService.name}}: {{extraService.value}} \n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t<div v-if="isRequestPropertiesVisible" class="salescenter-delivery-selector-main">\n\t\t\t\t<div class="salescenter-delivery-selector-text-light">\n\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_DELIVERY_REQUEST_DETAILS"),':\n\t\t\t\t</div>\n\t\t\t\t<ul class="salescenter-delivery-selector-list">\n\t\t\t\t\t<li\n\t\t\t\t\t\tv-for="requestProperty in requestProperties"\n\t\t\t\t\t\tclass="salescenter-delivery-selector-list-item salescenter-delivery-selector-text-dark"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{requestProperty.name}}:\n\t\t\t\t\t\t<template v-if="isPhoneRequestProperty(requestProperty)">\n\t\t\t\t\t\t\t<a @click.prevent="makeCall(requestProperty.value)" href="#">{{requestProperty.value}}</a>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t{{requestProperty.value}}\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t<div class="salescenter-delivery-selector-line"></div>\n\t\t\t<div class="catalog-pf-result-wrapper">\n\t\t\t\t<table class="catalog-pf-result">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<span class="catalog-pf-text">\n\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_PRODUCT_PRODUCTS_PRICE"),':\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</td> \n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<span v-html="productsPriceFormatted" class="catalog-pf-text"></span> \n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class="catalog-pf-result-padding-bottom">\n\t\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--tax">\n\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_SHIPMENT_PRODUCT_BLOCK_DELIVERY_PRICE"),': \n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</td> \n\t\t\t\t\t\t<td class="catalog-pf-result-padding-bottom"> \n\t\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--tax" v-html="priceDeliveryFormatted"></span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr> \n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class="catalog-pf-result-padding">\n\t\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--total catalog-pf-text--border">\n\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_PRODUCT_TOTAL_RESULT"),': \n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</td> \n\t\t\t\t\t\t<td class="catalog-pf-result-padding">\n\t\t\t\t\t\t\t<span v-html="paymentPriceFormatted" class="catalog-pf-text catalog-pf-text--total"></span> \n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t')};function J(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function tt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?J(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var et={props:{status:{type:String,required:true},counter:{type:Number,required:true},tiles:{type:Array,required:true},installed:{type:Boolean,required:true},isCollapsible:{type:Boolean,required:true},initialCollapseState:{type:Boolean,required:true}},data:function t(){return{selectedDeliveryServiceName:null}},mixins:[U,N],components:{"stage-block-item":_.Block,"delivery-selector-block":Q,"shipment-view":Z,"uninstalled-delivery-block":D},computed:tt({statusClass:function t(){return{"salescenter-app-payment-by-sms-item-disabled-bg":this.installed===false||this.status===_.StatusTypes.disabled}},productsPrice:function t(){return this.order.total.result},shipmentId:function t(){return this.$root.$app.options.shipmentId},configForBlock:function t(){return{counter:this.counter,titleName:this.selectedDeliveryServiceName,installed:this.installed,collapsible:this.isCollapsible,checked:this.counterCheckedMixin,showHint:false,initialCollapseState:this.initialCollapseState}},config:function t(){var e=null;if(this.$root.$app.options.hasOwnProperty("shipmentData")&&this.$root.$app.options.shipmentData.hasOwnProperty("deliveryServiceId")){e=this.$root.$app.options.shipmentData.deliveryServiceId}var n=null;if(this.$root.$app.options.hasOwnProperty("shipmentData")&&this.$root.$app.options.shipmentData.hasOwnProperty("deliveryPrice")){n=this.$root.$app.options.shipmentData.deliveryPrice}var s={};if(this.$root.$app.options.hasOwnProperty("shipmentData")&&this.$root.$app.options.shipmentData.hasOwnProperty("propValues")){s=this.$root.$app.options.shipmentData.propValues}var i={};if(this.$root.$app.options.hasOwnProperty("shipmentData")&&this.$root.$app.options.shipmentData.hasOwnProperty("extraServicesValues")&&!Array.isArray(this.$root.$app.options.shipmentData.extraServicesValues)){i=this.$root.$app.options.shipmentData.extraServicesValues}var o={};if(this.$root.$app.options.hasOwnProperty("deliveryOrderPropOptions")&&!Array.isArray(this.$root.$app.options.deliveryOrderPropOptions)){o=this.$root.$app.options.deliveryOrderPropOptions}return{personTypeId:this.$root.$app.options.personTypeId,basket:this.order.basket,currencySymbol:this.$root.$app.options.currencySymbol,currency:this.order.currency,ownerTypeId:this.$root.$app.options.ownerTypeId,ownerId:this.$root.$app.options.ownerId,sessionId:this.$root.$app.options.sessionId,relatedPropsValues:s,relatedPropsOptions:o,relatedServicesValues:i,deliveryServiceId:e,responsibleId:this.$root.$app.options.assignedById,deliveryPrice:n}},isViewTemplateMode:function t(){return this.$root.$app.options.templateMode==="view"}},k.Vuex.mapState({order:function t(e){return e.orderCreation}})),methods:{setTitleName:function t(e){this.selectedDeliveryServiceName=e.deliveryServiceName},saveCollapsedOption:function t(e){this.$emit("on-save-collapsed-option","delivery",e)}},template:'\n\t\t<stage-block-item\n\t\t\t:config="configForBlock"\n\t\t\t:class="[statusClassMixin, statusClass]"\n\t\t\t@on-item-hint.stop.prevent="onItemHint"\n\t\t\t@on-adjust-collapsed="saveCollapsedOption"\n\t\t>\n\t\t\t<template v-slot:block-title-title>'.concat(w.Loc.getMessage("SALESCENTER_DELIVERY_BLOCK_TITLE"),'</template>\n\t\t\t<template v-slot:block-container>\n\t\t\t\t<div :class="containerClassMixin">\n\t\t\t\t\t<template v-if="!installed">\n\t\t\t\t\t\t<uninstalled-delivery-block :tiles="tiles" \n\t\t\t\t\t\t\t\tv-on:on-tile-slider-close="onSliderClose"/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-select">\n\t\t\t\t\t\t\t<shipment-view\n\t\t\t\t\t\t\t\tv-if="isViewTemplateMode"\n\t\t\t\t\t\t\t\t:id="shipmentId"\n\t\t\t\t\t\t\t\t:productsPrice="productsPrice"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</shipment-view>\n\t\t\t\t\t\t\t<delivery-selector-block v-else\n\t\t\t\t\t\t\t\t:config="config" \n\t\t\t\t\t\t\t\t@delivery-settings-changed="onSliderClose"\n\t\t\t\t\t\t\t\t@change="setTitleName" \n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</stage-block-item>\n\t')};var nt={props:{status:{type:String,required:true},counter:{type:Number,required:true},tiles:{type:Array,required:true},installed:{type:Boolean,required:true},titleItems:{type:Array},initialCollapseState:{type:Boolean,required:true}},mixins:[U],components:{"stage-block-item":_.Block,"tile-collection-installed-block":F,"tile-collection-uninstalled-block":D},methods:{onItemHint:function t(e){BX.Salescenter.Manager.openHowToConfigDefaultPaySystem(e)},saveCollapsedOption:function t(e){this.$emit("on-save-collapsed-option","pay_system",e)}},computed:{configForBlock:function t(){return{counter:this.counter,titleItems:this.installed?this.titleItems:[],installed:this.installed,collapsible:true,checked:this.counterCheckedMixin,showHint:!this.installed,initialCollapseState:this.initialCollapseState}},statusClass:function t(){return{"salescenter-app-payment-by-sms-item-disabled-bg":this.installed===false}},title:function t(){return this.installed===true?w.Loc.getMessage("SALESCENTER_PAYSYSTEM_SET_BLOCK_TITLE"):w.Loc.getMessage("SALESCENTER_PAYSYSTEM_BLOCK_TITLE")}},template:'\n\t\t<stage-block-item\n\t\t\t:class="[statusClassMixin, statusClass]"\n\t\t\t:config="configForBlock"\n\t\t\t@on-item-hint.stop.prevent="onItemHint"\n\t\t\t@on-tile-slider-close="onSliderClose"\n\t\t\t@on-adjust-collapsed="saveCollapsedOption"\n\t\t>\n\t\t\t<template v-slot:block-title-title>{{title}}</template>\n\t\t\t<template v-slot:block-hint-title>\n\t\t\t\t'.concat(w.Loc.getMessage("SALESCENTER_PAYSYSTEM_BLOCK_SETTINGS_TITLE"),'\n\t\t\t</template>\n\t\t\t<template v-slot:block-container>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!installed"\n\t\t\t\t\tclass="salescenter-app-explanation"\n\t\t\t\t>\n\t\t\t\t\t<div class="salescenter-app-explanation-img"></div>\n\t\t\t\t\t<div class="salescenter-app-explanation-area">\n\t\t\t\t\t\t<div class="salescenter-app-explanation-text">\n\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_TERMINAL_PAYMENT_SYSTEM_SETUP_HINT"),'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div :class="containerClassMixin">\n\t\t\t\t\t<tile-collection-uninstalled-block \t:tiles="tiles" v-if="!installed" v-on:on-tile-slider-close="onSliderClose"/>\n\t\t\t\t\t<tile-collection-installed-block :tiles="tiles" v-on:on-tile-slider-close="onSliderClose" v-else />\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</stage-block-item>\n\t')};var st=Object.freeze({deal:"deal",smartInvoice:"smart_invoice",chat:"chat",sms:"sms",imOpenlines:"imopenlines_app",terminalList:"terminal_list"});var it={props:{status:{type:String,required:true},counter:{type:Number,required:true},manager:{type:Object,required:true},titleTemplate:{type:String,required:true},showHint:{type:Boolean,required:true},editorTemplate:{type:String,required:true},editorUrl:{type:String,required:true},selectedMode:{type:String,required:true}},mixins:[U],components:{"stage-block-item":_.Block,"chat-user-avatar-block":E.UserAvatar,"chat-message-editor-block":E.MessageEditor},data:function t(){return{currentSenderCode:null,senders:[],pushedToUseBitrix24Notifications:null,smsSenderListComponentKey:0}},computed:{configForBlock:function t(){return{counter:this.counter,checked:this.counterCheckedMixin,showHint:true}},editor:function t(){return{template:this.editorTemplate,url:this.editorUrl}},title:function t(){return this.titleTemplate},isMessageReadOnly:function t(){return this.$root.$app.context!==st.sms}},created:function t(){},methods:{onItemHint:function t(e){BX.Salescenter.Manager.openSlider(this.$root.$app.options.urlSettingsCompanyContacts,{width:1200})},openBitrix24NotificationsHelp:function t(e){BX.Salescenter.Manager.openBitrix24NotificationsHelp(e)}},template:'\n\t\t<stage-block-item\t\t\t\n\t\t\t:config="configForBlock"\n\t\t\t:class="statusClassMixin"\n\t\t\tv-on:on-item-hint="onItemHint"\n\t\t>\n\t\t\t<template v-slot:block-title-title>{{title}}</template>\n\t\t\t<template\n\t\t\t\tv-if="showHint"\n\t\t\t\tv-slot:block-hint-title\n\t\t\t>\n\t\t\t\t'.concat(w.Loc.getMessage("SALESCENTER_LEFT_PAYMENT_COMPANY_CONTACTS_SHORTER_VERSION"),'\n\t\t\t</template>\n\t\t\t<template v-slot:block-container>\n\t\t\t\t<div :class="containerClassMixin" class="salescenter-app-payment-by-sms-item-container-offtop">\n\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-sms">\n\t\t\t\t\t\t<chat-user-avatar-block :manager="manager"/>\n\t\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-content">\n\t\t\t\t\t\t\t<chat-message-editor-block :editor="editor" :isReadOnly="isMessageReadOnly" :selectedMode="selectedMode"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</stage-block-item>\n\t')};var ot={props:{status:{type:String,required:true},counter:{type:Number,required:true},stageOnOrderPaid:{type:String,required:false},stageOnDeliveryFinished:{type:String,required:false},items:{type:Array,required:true},initialCollapseState:{type:Boolean,required:true}},mixins:[U,N],data:function t(){return{paymentStages:[],shipmentStages:[]}},components:{"stage-block-item":_.Block,"stage-item-list":u.StageList},methods:{saveCollapsedOption:function t(e){this.$emit("on-save-collapsed-option","automation",e)},updatePaymentStage:function t(e){var n=e.data;this.paymentStages.forEach((function(t){t.selected=t.id===n}));this.$root.$app.stageOnOrderPaid=e.data},updateShipmentStage:function t(e){var n=e.data;this.shipmentStages.forEach((function(t){t.selected=t.id===n}));this.$root.$app.stageOnDeliveryFinished=e.data},initStages:function t(e,n){Object.values(this.items).forEach((function(t){t.selected=!n&&!t.hasOwnProperty("id")||t.id===n;e.push(m.Factory.create(t))}))}},computed:{configForBlock:function t(){return{counter:this.counter,checked:this.counterCheckedMixin,collapsible:true,initialCollapseState:this.initialCollapseState,titleName:this.selectedStage.name}},selectedStage:function t(){var e=this.isPayment?this.paymentStages:this.shipmentStages;return e.find((function(t){return t.selected}))},isPayment:function t(){return this.$root.$app.options.mode==="payment_delivery"||this.$root.$app.options.mode==="payment"||this.$root.$app.options.mode==="terminal_payment"},isHideDeliveryStage:function t(){return this.$root.$app.options.mode==="payment"||this.$root.$app.options.mode==="terminal_payment"}},created:function t(){if(this.isPayment){this.initStages(this.paymentStages,this.stageOnOrderPaid)}this.initStages(this.shipmentStages,this.stageOnDeliveryFinished)},template:'\n\t\t<stage-block-item\n\t\t\t:config="configForBlock"\n\t\t\t:class="statusClassMixin"\n\t\t\t@on-adjust-collapsed="saveCollapsedOption"\n\t\t>\n\t\t\t<template v-slot:block-title-title>'.concat(w.Loc.getMessage("SALESCENTER_AUTOMATION_BLOCK_TITLE"),'</template>\n\t\t\t<template v-slot:block-container>\n\t\t\t\t<div :class="containerClassMixin">\n\t\t\t\t\t<div v-if="isPayment">\n\t\t\t\t\t\t<stage-item-list\n\t\t\t\t\t\t\tv-on:on-choose-select-option="updatePaymentStage($event)"\n\t\t\t\t\t\t\t:stages="paymentStages"\n\t\t\t\t\t\t\t:editable="editable"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template v-slot:stage-list-text>').concat(w.Loc.getMessage("SALESCENTER_AUTOMATION_BLOCK_TEXT"),'</template>\n\t\t\t\t\t\t</stage-item-list>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div v-if="!isHideDeliveryStage">\n\t\t\t\t\t\t<stage-item-list\n\t\t\t\t\t\t\tv-on:on-choose-select-option="updateShipmentStage($event)"\n\t\t\t\t\t\t\t:stages="shipmentStages"\n\t\t\t\t\t\t\t:editable="editable"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template v-slot:stage-list-text>').concat(w.Loc.getMessage("SALESCENTER_AUTOMATION_DELIVERY_FINISHED"),"</template>\n\t\t\t\t\t\t</stage-item-list>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</stage-block-item>\n\t")};var at={props:{buttonLabel:{type:String,required:true},buttonEnabled:{type:Boolean,required:true},showWhatClientSeesControl:{type:Boolean,required:true},isFacebookForm:{type:Boolean,required:false,default:false}},computed:{buttonClass:function t(){return{"salescenter-app-payment-by-sms-item-disabled":this.buttonEnabled===false}},showSubmitCompilationLinkToFacebookButton:function t(){var e=this.$store.getters["orderCreation/isCompilationMode"];return this.isFacebookForm&&e}},methods:{showWhatClientSees:function t(e){BX.Salescenter.Manager.openWhatClientSee(e)},submit:function t(e){this.$emit("on-submit",e)},submitCompilationLinkToFacebook:function t(e){this.$emit("on-submit-compilation-link-to-facebook",e)}},template:'\n\t\t<div\n\t\t\t:class="buttonClass"\n\t\t\tclass="salescenter-app-payment-by-sms-item-show salescenter-app-payment-by-sms-item salescenter-app-payment-by-sms-item-send"\n\t\t>\n\t\t\t<div class="salescenter-app-payment-by-sms-item-counter">\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-rounder"></div>\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-line"></div>\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-number"></div>\n\t\t\t</div>\n\t\t\t<div class="">\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container">\n\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-payment">\n\t\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-payment-inline">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t@click="submit($event)"\n\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-lg ui-btn-success ui-btn-round"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{buttonLabel}}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-if="showSubmitCompilationLinkToFacebookButton"\n\t\t\t\t\t\t\t\t@click="submitCompilationLinkToFacebook($event)"\n\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-lg ui-btn-light-border ui-btn-round"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t'.concat(w.Loc.getMessage("SALESCENTER_SEND_COMPILATION_LINK_TO_FACEBOOK"),'\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-if="showWhatClientSeesControl"\n\t\t\t\t\t\t\t\t@click="showWhatClientSees"\n\t\t\t\t\t\t\t\tclass="salescenter-app-add-item-link"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER_TEMPLATE_WHAT_DOES_CLIENT_SEE"),"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t")};var rt={props:{timelineItems:{type:Array,required:true}},components:{"timeline-item-block":h.TimeLineItemBlock,"timeline-item-payment-block":h.TimeLineItemPaymentBlock,"timeline-item-custom-block":h.TimeLineItemCustomBlock},methods:{isPayment:function t(e){return e.type===C.Payment.type()},isCustom:function t(e){return e.type===C.Custom.type()}},template:'\n\t\t<div class="salescenter-app-payment-by-sms-timeline">\n\t\t\t<template v-for="(item) in timelineItems">\n\t\t\t\t<timeline-item-payment-block :item="item" v-if="isPayment(item)"/>\n\t\t\t\t<timeline-item-custom-block :item="item" v-else-if="isCustom(item)"/>\n\t\t\t\t<timeline-item-block :item="item" v-else/>\n\t\t\t</template>\n\t\t</div>\n\t'};function lt(t,e){var n=typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=ct(t))||e&&t&&typeof t.length==="number"){if(n)t=n;var s=0;var i=function t(){};return{s:i,n:function e(){if(s>=t.length)return{done:true};return{done:false,value:t[s++]}},e:function t(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,a=false,r;return{s:function e(){n=n.call(t)},n:function t(){var e=n.next();o=e.done;return e},e:function t(e){a=true;r=e},f:function t(){try{if(!o&&n["return"]!=null)n["return"]()}finally{if(a)throw r}}}}function ct(t,e){if(!t)return;if(typeof t==="string")return pt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pt(t,e)}function pt(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}function dt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function ut(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?dt(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var mt={props:{counter:{type:Number,required:true},templateAddUrl:{type:String,required:false}},mixins:[U],components:{"stage-block-item":_.Block},computed:ut({status:function t(){if(this.model&&this.model.templates&&this.model.templates.length||this.model.documents&&this.model.documents.length){return _.StatusTypes.complete}if(this.templateAddUrl&&this.templateAddUrl.length){return _.StatusTypes.current}return _.StatusTypes.disabled},configForBlock:function t(){return{counter:this.counter,titleItems:[],installed:true,collapsible:false,checked:this.counterCheckedMixin,showHint:false,initialCollapseState:false}},getDocumentTitle:function t(){var e=this.getCurrentDocument();if(e){return e.title}return w.Loc.getMessage("SALESCENTER_DOCUMENT_SELECTOR_BLOCK_CREATE_NEW_TEMPLATE")},withStamps:function t(){var e="";var n=this.getCurrentDocument();if(n){if(n.isWithStamps){e=w.Loc.getMessage("SALESCENTER_DOCUMENT_SELECTOR_BLOCK_WITH_SIGNS")}else{e=w.Loc.getMessage("SALESCENTER_DOCUMENT_SELECTOR_BLOCK_WITHOUT_SIGNS")}}return e},hasData:function t(){var e=this.getCurrentDocument();return e&&e.detailUrl}},k.Vuex.mapState({model:function t(e){return e.documentSelector}})),methods:{handleDocumentClick:function t(e){var n=e.target;if(this.getCurrentDocument()!==null){this.openSelectorMenu(n)}else{this.openTemplatesList()}},openSelectorMenu:function t(e){x.MenuManager.show({id:"payment-document-selector",bindElement:e,items:this.prepareSelectorMenuItems(),closeByEsc:true,cacheable:false})},closeSelectorMenu:function t(){x.MenuManager.destroy("payment-document-selector")},prepareSelectorMenuItems:function t(){var e=this;var n=[];if(this.model.documents){var s=lt(this.model.documents),i;try{var o=function t(){var s=i.value;n.push({text:s.title,onclick:function t(){e.closeSelectorMenu();e.$store.dispatch("documentSelector/setBoundDocumentId",{boundDocumentId:s.id})}})};for(s.s();!(i=s.n()).done;){o()}}catch(t){s.e(t)}finally{s.f()}}var a={text:w.Loc.getMessage("SALESCENTER_DOCUMENT_SELECTOR_BLOCK_CREATE_NEW_DOCUMENT"),items:[]};if(this.model.templates){if(n.length>0){n.push({delimiter:true})}var r=lt(this.model.templates),l;try{var c=function t(){var n=l.value;a.items.push({text:n.title,onclick:function t(){e.closeSelectorMenu();e.$store.commit("documentSelector/setSelectedTemplateId",{selectedTemplateId:n.id})}})};for(r.s();!(l=r.n()).done;){c()}}catch(t){r.e(t)}finally{r.f()}}if(this.templateAddUrl){if(a.items.length>0){a.items.push({delimiter:true})}a.items.push({text:w.Loc.getMessage("SALESCENTER_DOCUMENT_SELECTOR_BLOCK_CREATE_NEW_TEMPLATE"),onclick:function t(){e.closeSelectorMenu();e.openTemplatesList()}})}if(a.items.length>0){n.push(a)}return n},openTemplatesList:function t(){var e=this;T.Manager.openSlider(this.templateAddUrl,{width:930}).then((function(){e.$store.dispatch("documentSelector/loadTemplates")}))},handleEditDocumentClick:function t(){var e=this;var n=this.getCurrentDocument();if(n.detailUrl){T.Manager.openSlider(n.detailUrl,{width:980}).then((function(t){var n=t.getData().get("document");if(n){e.$store.dispatch("documentSelector/addDocument",{document:n})}}))}},getCurrentDocument:function t(){var e=null;if(this.model.boundDocumentId>0){e=this.getDocumentById(this.model.boundDocumentId)}if(!e&&this.model.selectedTemplateId>0){e=this.getStubDocumentByTemplate(this.model.selectedTemplateId)}if(!e){var n=this.model.documents;if(n&&n[0]){e=n[0];this.$store.dispatch("documentSelector/setBoundDocumentId",{boundDocumentId:e.id})}}if(!e){var s=this.model.templates;if(s&&s[0]){e=this.getStubDocumentByTemplate(s[0].id);this.$store.commit("documentSelector/setSelectedTemplateId",{selectedTemplateId:s[0].id})}}return e},getDocumentById:function t(e){var n=lt(this.model.documents),s;try{for(n.s();!(s=n.n()).done;){var i=s.value;if(i.id===e){return i}}}catch(t){n.e(t)}finally{n.f()}return null},getTemplateById:function t(e){var n=lt(this.model.templates),s;try{for(n.s();!(s=n.n()).done;){var i=s.value;if(i.id===e){return i}}}catch(t){n.e(t)}finally{n.f()}return null},getStubDocumentByTemplate:function t(e){var n=this.getTemplateById(e);if(!n){return null}var s=this.$root.$app.options.paymentId||0;var i=null;var o=null;if(s>0){i=w.Loc.getMessage("SALESCENTER_DOCUMENT_SELECTOR_BLOCK_DOCUMENT_NEW_SUFFIX",{"#TITLE#":n.title});o=w.Uri.addParam(n.documentCreationUrl,{values:{_paymentId:s}})}else{i=w.Loc.getMessage("SALESCENTER_DOCUMENT_SELECTOR_BLOCK_DOCUMENT_CREATED_LATER_SUFFIX",{"#TITLE#":n.title});o=null}return{id:0,title:i,detailUrl:o,isWithStamps:n.isWithStamps}}},template:'\n\t\t<stage-block-item\n\t\t\t:class="statusClassMixin"\n\t\t\t:config="configForBlock"\n\t\t>\n\t\t\t<template v-slot:block-title-title>'.concat(w.Loc.getMessage("SALESCENTER_DOCUMENT_SELECTOR_BLOCK_TITLE"),'</template>\n\t\t\t<template v-slot:block-container>\n\t\t\t\t<div :class="containerClassMixin">\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t<div class="salescenter-app-payment-item-container-document-selector">\n\t\t\t\t\t\t<div class="salescenter-app-payment-item-container-document-selector-selector">\n\t\t\t\t\t\t\t<div class="salescenter-app-payment-item-container-document-selector-selector-file">\n\t\t\t\t\t\t\t\t<div class="ui-icon ui-icon-lg ui-icon-file-pdf"><i></i></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="salescenter-app-payment-item-container-document-selector-title">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tref="selectorNode"\n\t\t\t\t\t\t\t\t\tclass="salescenter-app-payment-item-container-document-selector-title-button"\n\t\t\t\t\t\t\t\t\t@click="handleDocumentClick"\n\t\t\t\t\t\t\t\t>{{getDocumentTitle}}</div>\n\t\t\t\t\t\t\t\t<div class="salescenter-app-payment-item-container-document-selector-title-sign">{{withStamps}}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="hasData"\n\t\t\t\t\t\t\tclass="salescenter-app-payment-item-container-document-selector-edit"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass="salescenter-app-payment-item-container-document-selector-edit-button"\n\t\t\t\t\t\t\t\t@click="handleEditDocumentClick"\n\t\t\t\t\t\t\t>\n                              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n                                <path fill-rule="evenodd" clip-rule="evenodd" d="M11.4359 0.03479L13.9865 2.61221L4.00879 12.563L1.45822 9.98561L11.4359 0.03479ZM0.0256074 13.6726C0.00148857 13.7639 0.0273302 13.8603 0.0927957 13.9275C0.159984 13.9947 0.25646 14.0205 0.347767 13.9947L3.19896 13.2265L0.793965 10.8223L0.0256074 13.6726Z" fill="#525C69"/>\n                              </svg>\n                              ').concat(w.Loc.getMessage("SALESCENTER_RIGHT_ACTION_EDIT"),"</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</stage-block-item>\n\t")};var ht={components:{"chat-message-block":it,"product-block":K,"paysystem-block":nt,"cashbox-block":H,"delivery-block":et,"automation-block":ot,"send-block":at,"timeline-block":rt,"document-selector-block":mt},data:function t(){var e={message:{status:_.StatusTypes.complete,manager:this.$root.$app.options.entityResponsible,titleTemplate:w.Loc.getMessage("SALESCENTER_APP_CHAT_MESSAGE_TITLE"),showHint:this.$root.$app.options.templateMode!=="view",editorTemplate:this.$root.$app.sendingMethodDesc.text,editorUrl:this.$root.$app.orderPublicUrl,selectedMode:"payment"},product:{status:this.$root.$app.options.basket&&this.$root.$app.options.basket.length>0?_.StatusTypes.complete:_.StatusTypes.current,title:this.$root.$app.options.templateMode==="view"?w.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_TITLE_PAYMENT_VIEW"):w.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_TITLE_SHORT"),hintTitle:this.$root.$app.options.templateMode==="view"?"":w.Loc.getMessage("SALESCENTER_PRODUCT_SET_BLOCK_TITLE_SHORT")},paysystem:{status:this.$root.$app.options.paySystemList.isSet?_.StatusTypes.complete:_.StatusTypes.disabled,tiles:this.getTileCollection(this.$root.$app.options.paySystemList.items),installed:this.$root.$app.options.paySystemList.isSet,titleItems:this.getTitleItems(this.$root.$app.options.paySystemList.items),initialCollapseState:this.$root.$app.options.isPaySystemCollapsed?this.$root.$app.options.isPaySystemCollapsed==="Y":this.$root.$app.options.paySystemList.isSet},cashbox:{},automation:{},documentSelector:{status:_.StatusTypes.complete}};if(this.$root.$app.options.hasOwnProperty("deliveryList")){e.delivery={isHidden:this.$root.$app.options.templateMode==="view"&&parseInt(this.$root.$app.options.shipmentId)<=0,status:this.$root.$app.options.deliveryList.isInstalled?_.StatusTypes.complete:_.StatusTypes.disabled,tiles:this.getTileCollection(this.$root.$app.options.deliveryList.items),installed:this.$root.$app.options.deliveryList.isInstalled,initialCollapseState:this.$root.$app.options.isDeliveryCollapsed?this.$root.$app.options.isDeliveryCollapsed==="Y":this.$root.$app.options.deliveryList.isInstalled}}if(this.$root.$app.options.cashboxList.hasOwnProperty("items")){e.cashbox={status:this.$root.$app.options.cashboxList.isSet?_.StatusTypes.complete:_.StatusTypes.disabled,tiles:this.getTileCollection(this.$root.$app.options.cashboxList.items),installed:this.$root.$app.options.cashboxList.isSet,titleItems:this.getTitleItems(this.$root.$app.options.cashboxList.items),initialCollapseState:this.$root.$app.options.isCashboxCollapsed?this.$root.$app.options.isCashboxCollapsed==="Y":this.$root.$app.options.cashboxList.isSet}}if(this.$root.$app.options.isAutomationAvailable){e.automation={status:_.StatusTypes.complete,stageOnOrderPaid:this.$root.$app.options.stageOnOrderPaid,stageOnDeliveryFinished:this.$root.$app.options.stageOnDeliveryFinished,items:this.$root.$app.options.entityStageList,initialCollapseState:this.$root.$app.options.isAutomationCollapsed?this.$root.$app.options.isAutomationCollapsed==="Y":false}}if(this.$root.$app.options.hasOwnProperty("timeline")){e.timeline={items:this.getTimelineCollection(this.$root.$app.options.timeline)}}if(this.$root.$app.hasOwnProperty("documentSelector")){if(this.$root.$app.documentSelector.templateAddUrl){e.documentSelector.templateAddUrl=this.$root.$app.documentSelector.templateAddUrl}}return{stages:e}},mixins:[U,N],computed:{isSendAllowed:function t(){return this.$store.getters["orderCreation/isAllowedSubmit"]},hasStageTimeLine:function t(){return this.stages.timeline.hasOwnProperty("items")&&this.stages.timeline.items.length>0},hasStageAutomation:function t(){return this.stages.automation.hasOwnProperty("items")},hasStageCashBox:function t(){return this.stages.cashbox.hasOwnProperty("tiles")},submitButtonLabel:function t(){var e;return this.editable&&!((e=this.$root.$app)!==null&&e!==void 0&&e.compilation)?w.Loc.getMessage("SALESCENTER_SEND"):w.Loc.getMessage("SALESCENTER_RESEND")},isFacebookForm:function t(){var e,n;return((e=this.$root.$app)===null||e===void 0?void 0:e.connector)==="facebook"&&((n=this.$root.$app)===null||n===void 0?void 0:n.isAllowedFacebookRegion)},isShowDocumentSelector:function t(){return this.$root.$app.hasOwnProperty("documentSelector")}},methods:{initCounter:function t(){this.counter=1},getTimelineCollection:function t(e){var n=[];Object.values(e).forEach((function(t){n.push(C.Factory.create(t))}));return n},getTileCollection:function t(e){var n=[];Object.values(e).forEach((function(t){n.push($.Factory.create(t))}));return n},getTitleItems:function t(e){var n=[];e.forEach((function(t){if(![$.More.type(),$.Offer.type()].includes(t.type)){n.push(t)}}));return n},stageRefresh:function t(e,n){w.ajax.runComponentAction("bitrix:salescenter.app","getAjaxData",{mode:"class",data:{type:n}}).then(function(t){if(t.data){this.refreshTilesByType(t.data,n)}}.bind(this),(function(){P.UI.Notification.Center.notify({content:w.Loc.getMessage("SALESCENTER_DATA_UPDATE_ERROR")})}))},refreshTilesByType:function t(e,n){if(n==="PAY_SYSTEM"){this.stages.paysystem.status=e.isSet?_.StatusTypes.complete:_.StatusTypes.disabled;this.stages.paysystem.tiles=this.getTileCollection(e.items);this.stages.paysystem.installed=e.isSet;this.stages.paysystem.titleItems=this.getTitleItems(e.items)}else if(n==="CASHBOX"){this.stages.cashbox.status=e.isSet?_.StatusTypes.complete:_.StatusTypes.disabled;this.stages.cashbox.tiles=this.getTileCollection(e.items);this.stages.cashbox.installed=e.isSet;this.stages.cashbox.titleItems=this.getTitleItems(e.items)}else if(n==="DELIVERY"){this.stages.delivery.status=e.isSet?_.StatusTypes.complete:_.StatusTypes.disabled;this.stages.delivery.tiles=this.getTileCollection(e.items);this.stages.delivery.installed=e.isInstalled}},onSend:function t(e){this.$emit("stage-block-send-on-send",e)},onSendCompilationLinkToFacebook:function t(e){this.$emit("stage-block-send-on-send-compilation-link-to-facebook",e)},changeProvider:function t(e){this.$root.$app.sendingMethodDesc.provider=e;BX.userOptions.save("salescenter","payment_sms_provider_options","latest_selected_provider",e)},saveCollapsedOption:function t(e,n){BX.userOptions.save("salescenter","add_payment_collapse_options",e,n)},onProductFormModeChange:function t(){var e=this.$store.getters["orderCreation/isCompilationMode"];if(e){this.stages.delivery.status=_.StatusTypes.disabled;this.stages.message.selectedMode="compilation";this.$root.$app.sendingMethodDesc.text=this.$root.$app.sendingMethodDesc.text_modes.compilation;this.stages.message.editorTemplate=this.$root.$app.sendingMethodDesc.text_modes.compilation}else{this.stages.delivery.status=this.$root.$app.options.deliveryList.isInstalled?_.StatusTypes.complete:_.StatusTypes.disabled;this.stages.message.selectedMode="payment";this.$root.$app.sendingMethodDesc.text=this.$root.$app.sendingMethodDesc.text_modes.payment;this.stages.message.editorTemplate=this.$root.$app.sendingMethodDesc.text_modes.payment}}},created:function t(){this.initCounter()},beforeUpdate:function t(){this.initCounter()},template:'\n\t\t<div>\n\t\t\t<chat-message-block\n\t\t\t\tv-if="editable"\n\t\t\t\t@stage-block-sms-send-on-change-provider="changeProvider"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.message.status"\n\t\t\t\t:manager="stages.message.manager"\n\t\t\t\t:titleTemplate="stages.message.titleTemplate"\n\t\t\t\t:showHint="stages.message.showHint"\n\t\t\t\t:editorTemplate="stages.message.editorTemplate"\n\t\t\t\t:editorUrl="stages.message.editorUrl"\n\t\t\t\t:selectedMode="stages.message.selectedMode"\n\t\t\t/>\n\t\t\t<product-block\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.product.status"\n\t\t\t\t:title="stages.product.title"\n\t\t\t\t:hintTitle="stages.product.hintTitle"\n\t\t\t\t@on-product-form-mode-change="onProductFormModeChange"\n\t\t\t/>\n\t\t\t<paysystem-block\n\t\t\t\t@on-stage-tile-collection-slider-close="stageRefresh($event, \'PAY_SYSTEM\')"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.paysystem.status"\n\t\t\t\t:tiles="stages.paysystem.tiles"\n\t\t\t\t:installed="stages.paysystem.installed"\n\t\t\t\t:titleItems="stages.paysystem.titleItems"\n\t\t\t\t:initialCollapseState="stages.paysystem.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t<cashbox-block\n\t\t\t\tv-if="hasStageCashBox"\n\t\t\t\t@on-stage-tile-collection-slider-close="stageRefresh($event, \'CASHBOX\')"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.cashbox.status"\n\t\t\t\t:tiles="stages.cashbox.tiles"\n\t\t\t\t:installed="stages.cashbox.installed"\n\t\t\t\t:titleItems="stages.cashbox.titleItems"\n\t\t\t\t:initialCollapseState="stages.cashbox.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t<delivery-block\n\t\t\t\tv-if="stages.delivery && !stages.delivery.isHidden"\n\t\t\t\t@on-stage-tile-collection-slider-close="stageRefresh($event, \'DELIVERY\')"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.delivery.status"\n\t\t\t\t:tiles="stages.delivery.tiles"\n\t\t\t\t:installed="stages.delivery.installed"\n\t\t\t\t:isCollapsible="true"\n\t\t\t\t:initialCollapseState="stages.delivery.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t<document-selector-block\n\t\t\t\tv-if="isShowDocumentSelector"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:templateAddUrl="stages.documentSelector.templateAddUrl"\n\t\t\t/>\n\t\t\t<automation-block\n\t\t\t\tv-if="hasStageAutomation"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.automation.status"\n\t\t\t\t:stageOnOrderPaid="stages.automation.stageOnOrderPaid"\n\t\t\t\t:stageOnDeliveryFinished="stages.automation.stageOnDeliveryFinished"\n\t\t\t\t:items="stages.automation.items"\n\t\t\t\t:initialCollapseState="stages.automation.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t<send-block\n\t\t\t\t@on-submit="onSend"\n\t\t\t\t@on-submit-compilation-link-to-facebook="onSendCompilationLinkToFacebook"\n\t\t\t\t:buttonEnabled="isSendAllowed"\n\t\t\t\t:buttonLabel="submitButtonLabel"\n\t\t\t\t:isFacebookForm="isFacebookForm"\n\t\t\t/>\n\t\t\t<timeline-block\n\t\t\t\tv-if="hasStageTimeLine"\n\t\t\t\t:timelineItems="stages.timeline.items"\n\t\t\t/>\n\t\t</div>\n\t'};var gt={data:function t(){return{isFaded:false}},mounted:function t(){this.createPinner()},created:function t(){var e=this;this.$root.$on("on-start-progress",(function(){e.startFade()}));this.$root.$on("on-stop-progress",(function(){e.endFade()}))},methods:{startFade:function t(){this.isFaded=true},endFade:function t(){this.isFaded=false},createPinner:function t(){var e=this.$refs["buttonsPanel"];if(e){this.$root.$el.parentNode.appendChild(e);new BX.UI.Pinner(e,{fixBottom:this.$root.$app.isFrame,fullWidth:this.$root.$app.isFrame,anchorBottom:".salescenter-app-pinner-anchor"})}},close:function t(){this.$root.$app.closeApplication()}},computed:{isOrderPublicUrlAvailable:function t(){return this.$root.$app.isOrderPublicUrlAvailable},compilation:function t(){return this.$root.$app.compilation},wrapperClass:function t(){return{"salescenter-app-wrapper-fade":this.isFaded}},wrapperStyle:function t(){var e=BX.pos(this.$root.$el);var n=e.top+20;if(this.$root.$nodes.footer){n+=BX.pos(this.$root.$nodes.footer).height}var s=this.$refs["buttonsPanel"];if(s){n+=BX.pos(s).height}return{minHeight:"calc(100vh - "+n+"px)"}}}};var ft={data:function t(){return{}},methods:{connect:function t(){var e=this;var n=new BX.Loader({size:200});n.show(document.body);BX.Salescenter.Manager.connect({no_redirect:"Y",context:this.$root.$app.context}).then((function(){BX.Salescenter.Manager.loadConfig().then((function(t){n.hide();if(t.isSiteExists){e.$root.$app.isSiteExists=t.isSiteExists;e.$root.$app.isOrderPublicUrlExists=true;e.$root.$app.orderPublicUrl=t.orderPublicUrl;e.$root.$app.isOrderPublicUrlAvailable=t.isOrderPublicUrlAvailable}e.$emit("on-successfully-connected")}))}))["catch"]((function(){n.hide()}))},checkRecycle:function t(){T.Manager.openConnectedSite(true)},openConnectedSite:function t(){T.Manager.openConnectedSite()}},computed:{isOrderPageDeleted:function t(){return this.$root.$app.isSiteExists&&!this.isOrderPublicUrlExists},isOrderPublicUrlExists:function t(){return this.$root.$app.isOrderPublicUrlExists}},template:'\n\t\t<div class="salescenter-app-page-content salescenter-app-start-wrapper">\n\t\t\t<div class="ui-title-1 ui-text-center ui-color-medium" style="margin-bottom: 20px;">\n\t\t\t\t'.concat(w.Loc.getMessage("SALESCENTER_INFO_TEXT_TOP_2"),'\n\t\t\t</div>\n\t\t\t<div class="ui-hr ui-mv-25"></div>\n\t\t\t<template v-if="isOrderPublicUrlExists">\n\t\t\t\t<div class="salescenter-title-5 ui-title-5 ui-text-center ui-color-medium">\n\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_INFO_TEXT_BOTTOM_PUBLIC"),'\n\t\t\t\t</div>\n\t\t\t\t<div style="padding-top: 5px;" class="ui-text-center">\n\t\t\t\t\t<div class="ui-btn ui-btn-primary ui-btn-lg" @click="openConnectedSite">\n\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_INFO_PUBLIC"),'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else-if="isOrderPageDeleted">\n\t\t\t\t<div class="salescenter-title-5 ui-title-5 ui-text-center ui-color-medium">\n\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_INFO_ORDER_PAGE_DELETED"),'\n\t\t\t\t</div>\n\t\t\t\t<div style="padding-top: 5px;" class="ui-text-center">\n\t\t\t\t\t<div\n\t\t\t\t\t\t@click="checkRecycle"\n\t\t\t\t\t\tclass="ui-btn ui-btn-primary ui-btn-lg"\n\t\t\t\t\t>\n\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_CHECK_RECYCLE"),'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div class="salescenter-title-5 ui-title-5 ui-text-center ui-color-medium">\n\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_INFO_TEXT_BOTTOM_2"),'\n\t\t\t\t</div>\n\t\t\t\t<div style="padding-top: 5px;" class="ui-text-center">\n\t\t\t\t\t<div\n\t\t\t\t\t\t@click="connect"\n\t\t\t\t\t\tclass="ui-btn ui-btn-primary ui-btn-lg"\n\t\t\t\t\t>\n\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_INFO_CREATE"),'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div style="padding-top: 5px;" class="ui-text-center">\n\t\t\t\t\t<div\n\t\t\t\t\t\t@click="BX.Salescenter.Manager.openHowPayDealWorks(event)"\n\t\t\t\t\t\tclass="ui-btn ui-btn-link ui-btn-lg"\n\t\t\t\t\t>\n\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_HOW"),"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t")};var vt={data:function t(){return{isVisible:true}},methods:{hide:function t(){this.isVisible=false;this.$emit("on-hide")},openControlPanel:function t(){T.Manager.openControlPanel()}},template:'\n\t\t<div v-if="isVisible" class="salescenter-app-banner" >\n\t\t\t<div class="salescenter-app-banner-inner">\n\t\t\t\t<div class="salescenter-app-banner-title">\n\t\t\t\t\t'.concat(w.Loc.getMessage("SALESCENTER_BANNER_TITLE"),'\n\t\t\t\t</div>\n\t\t\t\t<div class="salescenter-app-banner-content">\n\t\t\t\t\t<div class="salescenter-app-banner-text">\n\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_BANNER_TEXT"),'\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="salescenter-app-banner-btn-block">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t@click="openControlPanel"\n\t\t\t\t\t\t\tclass="ui-btn ui-btn-sm ui-btn-primary salescenter-app-banner-btn-connect"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_BANNER_BTN_CONFIGURE"),'\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t@click="hide"\n\t\t\t\t\t\t\tclass="ui-btn ui-btn-sm ui-btn-link salescenter-app-banner-btn-hide"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_BANNER_BTN_HIDE"),'\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\t@click="hide"\n\t\t\t\t\tclass="salescenter-app-banner-close"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t')};function yt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function bt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?yt(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function St(t,e){var n=typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Et(t))||e&&t&&typeof t.length==="number"){if(n)t=n;var s=0;var i=function t(){};return{s:i,n:function e(){if(s>=t.length)return{done:true};return{done:false,value:t[s++]}},e:function t(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,a=false,r;return{s:function e(){n=n.call(t)},n:function t(){var e=n.next();o=e.done;return e},e:function t(e){a=true;r=e},f:function t(){try{if(!o&&n["return"]!=null)n["return"]()}finally{if(a)throw r}}}}function Et(t,e){if(!t)return;if(typeof t==="string")return Tt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Tt(t,e)}function Tt(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}var Ct={mixins:[N,gt],data:function t(){return{isShowPreview:false,isShowPayment:false,pageTitle:"",currentPageId:null,actions:[],frameCheckShortTimeout:false,frameCheckLongTimeout:false,isPagesOpen:false,isFormsOpen:false,showedPageIds:[],loadedPageIds:[],errorPageIds:[],lastAddedPages:[],ordersCount:null,paymentsCount:null,editedPageId:null,currentPageTitle:null}},components:{product:q,start:ft,"no-payment-systems-banner":vt,"chat-receiving-payment":ht},updated:function t(){this.renderErrors()},mounted:function t(){var e=this;this.createLoader();this.$root.$app.fillPages().then((function(){if(e.$root.$app.isWithOrdersMode){e.refreshOrdersCount()}else{e.refreshPaymentsCount()}e.openFirstPage()}));if(this.$root.$app.isPaymentsLimitReached){var n=this.$root.$nodes.paymentsLimit;var s=this.$refs["paymentsLimit"];var i=St(n.children),o;try{for(i.s();!(o=i.n()).done;){var a=o.value;s.appendChild(a)}}catch(t){i.e(t)}finally{i.f()}}},methods:{getActions:function t(){var e=[];if(this.currentPage){e=[{text:this.localize.SALESCENTER_RIGHT_ACTION_COPY_URL,onclick:this.copyUrl}];if(this.currentPage.landingId>0){e=[].concat(babelHelpers.toConsumableArray(e),[{text:this.localize.SALESCENTER_RIGHT_ACTION_HIDE,onclick:this.hidePage}])}else{e=[].concat(babelHelpers.toConsumableArray(e),[{text:this.localize.SALESCENTER_RIGHT_ACTION_DELETE,onclick:this.hidePage}])}}return[].concat(babelHelpers.toConsumableArray(e),[{text:this.localize.SALESCENTER_RIGHT_ACTION_ADD,items:this.getAddPageActions()}])},getAddPageActions:function t(){var e=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return[{text:this.localize.SALESCENTER_RIGHT_ACTION_ADD_SITE_B24,onclick:function t(){e.addSite(n)}},{text:this.localize.SALESCENTER_RIGHT_ACTION_ADD_CUSTOM,onclick:function t(){e.showAddUrlPopup({isWebform:n===true?"Y":null})}}]},openFirstPage:function t(){this.isShowPayment=false;this.isShowPreview=true;if(this.$root.$app.isPaymentCreationAvailable){this.showPaymentForm()}else if(this.pages&&this.pages.length>0){var e=false;var n=false;this.pages.forEach((function(t){if(!n){if(!t.isWebform){n=t}else{e=t}}}));if(!n&&e){n=e}if(this.currentPageId!==n.id){this.onPageClick(n);if(n.isWebform){this.isFormsOpen=true}else{this.isPagesOpen=true}}else{this.currentPageId=this.pages[0].id}}else{this.pageTitle=null;this.currentPageId=null;this.setPageTitle(this.pageTitle)}},onPageClick:function t(e){this.pageTitle=e.name;this.currentPageId=e.id;this.hideActionsPopup();this.isShowPayment=false;this.isShowPreview=true;this.setPageTitle(this.pageTitle);if(e.isFrameDenied!==true){if(!this.showedPageIds.includes(e.id)){this.startFrameCheckTimeout();this.showedPageIds.push(e.id)}}else{this.onFrameError()}},showActionsPopup:function t(e){var n=e.target;BX.PopupMenu.show("salescenter-app-actions",n,this.getActions(),{offsetLeft:0,offsetTop:0,closeByEsc:true})},showCompanyContacts:function t(e){var n=e.target;BX.Salescenter.Manager.openSlider(this.$root.$app.options.urlSettingsCompanyContacts,{width:1200})},showAddPageActionPopup:function t(e){var n=e.target;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var i="salescenter-app-add-page-actions";if(s){i+="-forms"}BX.PopupMenu.show(i,n,this.getAddPageActions(s),{offsetLeft:n.offsetWidth+20,offsetTop:-n.offsetHeight-15,closeByEsc:true,angle:{position:"left"}})},hideActionsPopup:function t(){BX.PopupMenu.destroy("salescenter-app-actions");BX.PopupMenu.destroy("salescenter-app-add-page-actions")},addSite:function t(){var e=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;T.Manager.addSitePage(n).then((function(t){var n=t.answer.result.page||false;e.$root.$app.fillPages().then((function(){if(n){e.onPageClick(n);e.lastAddedPages.push(parseInt(n.id))}else{e.openFirstPage()}}))}));this.hideActionsPopup()},copyUrl:function t(e){if(this.currentPage&&this.currentPage.url){T.Manager.copyUrl(this.currentPage.url,e);this.hideActionsPopup()}},editPage:function t(){if(this.currentPage){if(this.currentPage.landingId&&this.currentPage.landingId>0){T.Manager.editLandingPage(this.currentPage.landingId,this.currentPage.siteId);this.hideActionsPopup()}else{this.showAddUrlPopup(this.currentPage)}}},hidePage:function t(){var e=this;if(this.currentPage){this.$root.$app.hidePage(this.currentPage).then((function(){e.openFirstPage()}));this.hideActionsPopup()}},hideNoPaymentSystemsBanner:function t(){this.$root.$app.hideNoPaymentSystemsBanner()},showAddUrlPopup:function t(e){var n=this;if(!w.Type.isPlainObject(e)){e={}}T.Manager.addCustomPage(e).then((function(t){if(!n.isShowPreview){n.isShowPreview=false}n.$root.$app.fillPages().then((function(){if(t&&(!w.Type.isPlainObject(e)||!e.id)){n.lastAddedPages.push(parseInt(t))}if(!t&&e){t=e.id}if(t){n.pages.forEach((function(e){if(parseInt(e.id)===parseInt(t)){n.onPageClick(e)}}))}else{if(!n.isShowPayment){n.isShowPreview=true}}}))}));this.hideActionsPopup()},getPaymentItemTitle:function t(){if(!this.isOrderPublicUrlAvailable){return null}if(this.$root.$app.options.mode==="payment"){return this.localize.SALESCENTER_LEFT_PAYMENT_ADD_2_MSGVER_1}return this.localize.SALESCENTER_LEFT_PAYMENT_AND_DELIVERY_MSGVER_1},showPaymentForm:function t(){this.isShowPayment=true;this.isShowPreview=false;if(this.compilation){return}var e=this.getPaymentItemTitle()||this.localize.SALESCENTER_DEFAULT_TITLE;this.setPageTitle(e)},showOrdersList:function t(){var e=this;this.hideActionsPopup();T.Manager.showOrdersList({context:this.$root.$app.context,ownerId:this.$root.$app.ownerId,ownerTypeId:this.$root.$app.ownerTypeId}).then((function(){e.refreshOrdersCount()}))},showPaymentsList:function t(){var e=this;this.hideActionsPopup();T.Manager.showPaymentsList({context:this.$root.$app.context,ownerId:this.$root.$app.ownerId,ownerTypeId:this.$root.$app.ownerTypeId}).then((function(){e.refreshPaymentsCount()}))},showOrderAdd:function t(){var e=this;this.hideActionsPopup();T.Manager.showOrderAdd({ownerId:this.$root.$app.ownerId,ownerTypeId:this.$root.$app.ownerTypeId}).then((function(){e.refreshOrdersCount()}))},showCatalog:function t(){this.hideActionsPopup();T.Manager.openSlider("/saleshub/catalog/?sessionId=".concat(this.$root.$app.sessionId))},onFormsClick:function t(){this.isFormsOpen=!this.isFormsOpen;this.hideActionsPopup()},openControlPanel:function t(){T.Manager.openControlPanel();this.hideActionsPopup()},openHelpDesk:function t(){this.hideActionsPopup();T.Manager.openHowItWorks()},isPageSelected:function t(e){return this.currentPage&&this.isShowPreview&&this.currentPage.id===e.id},sendCompilationLinkToFacebook:function t(e){this.send(e,"n",true)},send:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"n";var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!this.isAllowedSubmitButton){return}if(this.isShowPayment&&!this.isShowStartInfo){if(this.$store.getters["orderCreation/isCompilationMode"]){this.$root.$app.sendCompilation(e.target,s)}else{this.$root.$app.sendPayment(e.target,n)}}else if(this.currentPage&&this.currentPage.isActive){this.$root.$app.sendPage(this.currentPage.id)}},setPageTitle:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!e){return}if(this.$root.$nodes.title){this.$root.$nodes.title.innerText=e}},onFrameError:function t(){clearTimeout(this.frameCheckLongTimeout);if(this.showedPageIds.includes(this.currentPage.id)){this.loadedPageIds.push(this.currentPage.id)}this.errorPageIds.push(this.currentPage.id)},onFrameLoad:function t(e){var n=this;clearTimeout(this.frameCheckLongTimeout);if(this.showedPageIds.includes(e)){this.loadedPageIds.push(e);if(this.currentPage&&this.currentPage.id===e){if(this.frameCheckShortTimeout&&!this.currentPage.landingId){this.onFrameError()}else if(this.errorPageIds.includes(this.currentPage.id)){this.errorPageIds=this.errorPageIds.filter((function(t){return t!==n.currentPage.id}))}}}if(this.frameCheckShortTimeout&&this.currentPage&&this.currentPage.id===e&&!this.currentPage.landingId){this.onFrameError()}},onSuccessfullyConnected:function t(){var e=this;this.$root.$app.fillPages().then((function(){e.openFirstPage()}))},startFrameCheckTimeout:function t(){var e=this;if(this.frameCheckShortTimeout){clearTimeout(this.frameCheckShortTimeout);this.frameCheckShortTimeout=false}this.frameCheckShortTimeout=setTimeout((function(){e.frameCheckShortTimeout=false}),500);clearTimeout(this.frameCheckLongTimeout);this.frameCheckLongTimeout=setTimeout((function(){if(e.currentPage&&e.showedPageIds.includes(e.currentPage.id)&&!e.loadedPageIds.includes(e.currentPage.id)){e.errorPageIds.push(e.currentPage.id)}}),5e3)},getFrameSource:function t(e){if(this.showedPageIds.includes(e.id)){if(e.landingId>0){if(e.isActive){return new w.Uri(e.url).setQueryParam("theme","").toString()}}else{return e.url}}return null},refreshOrdersCount:function t(){var e=this;this.$root.$app.getOrdersCount().then((function(t){e.ordersCount=t.answer.result||null}))["catch"]((function(){e.ordersCount=null}))},refreshPaymentsCount:function t(){var e=this;this.$root.$app.getPaymentsCount().then((function(t){e.paymentsCount=t.answer.result||null}))["catch"]((function(){e.paymentsCount=null}))},renderErrors:function t(){if(this.isShowPayment&&this.order.errors.length>0){var e=this.order.errors.map((function(t){return t.message})).join("<br>");var n={color:BX.UI.Alert.Color.DANGER,textCenter:true,text:BX.util.htmlspecialchars(e)};if(this.$refs.errorBlock.innerHTML.length===0){n.animated=true}var s=new BX.UI.Alert(n);this.$refs.errorBlock.innerHTML="";this.$refs.errorBlock.appendChild(s.getContainer())}else if(this.$refs.errorBlock){this.$refs.errorBlock.innerHTML=""}},editMenuItem:function t(e,n){this.editedPageId=n.id;setTimeout((function(){e.target.parentNode.parentNode.querySelector("input").focus()}),50)},saveMenuItem:function t(e){var n=this;var s=this.editedPageId;var i=e.target.value;var o;this.pages.forEach((function(t){if(t.id===n.editedPageId){o=t.name}}));if(s>0&&o&&i!==o&&i.length>0){T.Manager.addPage({id:s,name:i,analyticsLabel:"salescenterUpdatePageTitle"}).then((function(){n.$root.$app.fillPages().then((function(){if(n.editedPageId===n.currentPageId){n.setPageTitle(i)}n.editedPageId=null}))}))}else{this.editedPageId=null}},createLoader:function t(){var e=new n.Loader({size:200});e.show(this.$refs["previewLoader"])}},computed:bt({config:function(t){function e(){return t.apply(this,arguments)}e.toString=function(){return t.toString()};return e}((function(){return config})),currentPage:function t(){var e=this;if(this.currentPageId>0){var n=this.application.pages.filter((function(t){return t.id===e.currentPageId}));if(n.length>0){return n[0]}}return null},sendButtonLabel:function t(){var e;return this.editable&&!((e=this.$root.$app)!==null&&e!==void 0&&e.compilation)?w.Loc.getMessage("SALESCENTER_SEND"):w.Loc.getMessage("SALESCENTER_RESEND")},pagesSubmenuHeight:function t(){if(this.isPagesOpen){return this.application.pages.filter((function(t){return!t.isWebform})).length*39+30+"px"}else{return"0px"}},formsSubmenuHeight:function t(){if(this.isFormsOpen){return this.application.pages.filter((function(t){return t.isWebform})).length*39+30+"px"}else{return"0px"}},isFrameError:function t(){if(this.isShowPreview&&this.currentPage){if(!this.currentPage.isActive){return true}else if(!this.currentPage.landingId&&this.errorPageIds.includes(this.currentPage.id)){return true}}return false},isShowLoader:function t(){return this.isShowPreview&&this.currentPageId>0&&this.showedPageIds.includes(this.currentPageId)&&!this.loadedPageIds.includes(this.currentPageId)},isShowStartInfo:function t(){var e=false;if(this.isShowPreview){e=!this.pages||this.pages.length<=0}else if(this.isShowPayment){e=!this.isOrderPublicUrlAvailable}return e},lastModified:function t(){if(this.currentPage&&this.currentPage.modifiedAgo){return this.localize.SALESCENTER_MODIFIED.replace("#AGO#",this.currentPage.modifiedAgo)}return false},localize:function t(){return l.Vue.getFilteredPhrases("SALESCENTER_")},pages:function t(){return babelHelpers.toConsumableArray(this.application.pages)},isAllowedSubmitButton:function t(){if(this.$root.$app.disableSendButton){return false}if(this.isShowPreview&&this.currentPage&&!this.currentPage.isActive){return false}if(this.isShowPayment){return this.$store.getters["orderCreation/isAllowedSubmit"]}return this.currentPage},showSubmitCompilationLinkToFacebookButton:function t(){var e=this.$store.getters["orderCreation/isCompilationMode"];return this.$root.$app.connector==="facebook"&&this.$root.$app.isAllowedFacebookRegion&&e},isNoPaymentSystemsBannerVisible:function t(){return this.$root.$app.options.showPaySystemSettingBanner},mode:function t(){return this.$root.$app.options.mode}},k.Vuex.mapState({application:function t(e){return e.application},order:function t(e){return e.orderCreation}})),template:'\n\t\t<div\n\t\t\t:class="wrapperClass"\n\t\t\t:style="wrapperStyle"\n\t\t\tclass="salescenter-app-wrapper salescenter-app-chat-wrapper"\n\t\t>\n\t\t\t<div class="ui-sidepanel-sidebar salescenter-app-sidebar" ref="sidebar">\n\t\t\t\t<ul class="ui-sidepanel-menu" ref="sidepanelMenu">\n\t\t\t\t\t<li v-if="this.$root.$app.isPaymentCreationAvailable && !this.compilation" :class="{ \'salescenter-app-sidebar-menu-active\': this.isShowPayment}" class="ui-sidepanel-menu-item" @click="showPaymentForm">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{getPaymentItemTitle()}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li v-if="this.compilation" :class="{ \'salescenter-app-sidebar-menu-active\': this.isShowPayment}" class="ui-sidepanel-menu-item" @click="showPaymentForm">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{this.compilation.TITLE_TAB}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li :class="{\'salescenter-app-sidebar-menu-active\': isPagesOpen}" class="ui-sidepanel-menu-item">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link" @click.stop.prevent="isPagesOpen = !isPagesOpen;">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_PAGES}}</div>\n\t\t\t\t\t\t\t<div class="ui-sidepanel-toggle-btn">{{this.isPagesOpen ? this.localize.SALESCENTER_SUBMENU_CLOSE : this.localize.SALESCENTER_SUBMENU_OPEN}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<ul class="ui-sidepanel-submenu" :style="{height: pagesSubmenuHeight}">\n\t\t\t\t\t\t\t<li v-for="page in pages" v-if="!page.isWebform" :key="page.id"\n\t\t\t\t\t\t\t:class="{\n\t\t\t\t\t\t\t\t\'ui-sidepanel-submenu-active\': (currentPage && currentPage.id == page.id && isShowPreview),\n\t\t\t\t\t\t\t\t\'ui-sidepanel-submenu-edit-mode\': (editedPageId === page.id)\n\t\t\t\t\t\t\t}" class="ui-sidepanel-submenu-item">\n\t\t\t\t\t\t\t\t<a :title="page.name" class="ui-sidepanel-submenu-link" @click.stop="onPageClick(page)">\n\t\t\t\t\t\t\t\t\t<input class="ui-sidepanel-input" :value="page.name" v-on:keyup.enter="saveMenuItem($event)" @blur="saveMenuItem($event)" />\n\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{page.name}}</div>\n\t\t\t\t\t\t\t\t\t<div v-if="lastAddedPages.includes(page.id)" class="ui-sidepanel-badge-new"></div>\n\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-edit-btn"><span class="ui-sidepanel-edit-btn-icon" @click="editMenuItem($event, page);"></span></div>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="salescenter-app-helper-nav-item salescenter-app-menu-add-page" @click.stop="showAddPageActionPopup($event)">\n\t\t\t\t\t\t\t\t<span class="salescenter-app-helper-nav-item-text salescenter-app-helper-nav-item-add">+</span><span class="salescenter-app-helper-nav-item-text">{{localize.SALESCENTER_RIGHT_ACTION_ADD}}</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li v-if="this.$root.$app.isWithOrdersMode" @click="showOrdersList">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_ORDERS}}</div>\n\t\t\t\t\t\t\t<span class="ui-sidepanel-counter" ref="ordersCounter" v-show="ordersCount > 0">{{ordersCount}}</span>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li v-if="this.$root.$app.isWithOrdersMode" @click="showOrderAdd">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_ORDER_ADD}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li v-if="!this.$root.$app.isWithOrdersMode" @click="showPaymentsList">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_PAYMENTS}}</div>\n\t\t\t\t\t\t\t<span class="ui-sidepanel-counter" ref="paymentsCounter" v-show="paymentsCount > 0">{{paymentsCount}}</span>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li v-if="this.$root.$app.isCatalogAvailable" @click="showCatalog">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_CATALOG}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li :class="{\'salescenter-app-sidebar-menu-active\': isFormsOpen}" class="ui-sidepanel-menu-item">\n\t\t\t\t\t\t<a class="ui-sidepanel-menu-link" @click.stop.prevent="onFormsClick();">\n\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{localize.SALESCENTER_LEFT_FORMS_ALL}}</div>\n\t\t\t\t\t\t\t<div class="ui-sidepanel-toggle-btn">{{this.isFormsOpen ? this.localize.SALESCENTER_SUBMENU_CLOSE : this.localize.SALESCENTER_SUBMENU_OPEN}}</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<ul class="ui-sidepanel-submenu" :style="{height: formsSubmenuHeight}">\n\t\t\t\t\t\t\t<li v-for="page in pages" v-if="page.isWebform" :key="page.id"\n\t\t\t\t\t\t\t :class="{\n\t\t\t\t\t\t\t\t\'ui-sidepanel-submenu-active\': (currentPage && currentPage.id == page.id && isShowPreview),\n\t\t\t\t\t\t\t\t\'ui-sidepanel-submenu-edit-mode\': (editedPageId === page.id)\n\t\t\t\t\t\t\t}" class="ui-sidepanel-submenu-item">\n\t\t\t\t\t\t\t\t<a :title="page.name" class="ui-sidepanel-submenu-link" @click.stop="onPageClick(page)">\n\t\t\t\t\t\t\t\t\t<input class="ui-sidepanel-input" :value="page.name" v-on:keyup.enter="saveMenuItem($event)" @blur="saveMenuItem($event)" />\n\t\t\t\t\t\t\t\t\t<div v-if="lastAddedPages.includes(page.id)" class="ui-sidepanel-badge-new"></div>\n\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{page.name}}</div>\n\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-edit-btn"><span class="ui-sidepanel-edit-btn-icon" @click="editMenuItem($event, page);"></span></div>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="salescenter-app-helper-nav-item salescenter-app-menu-add-page" @click.stop="showAddPageActionPopup($event, true)">\n\t\t\t\t\t\t\t\t<span class="salescenter-app-helper-nav-item-text salescenter-app-helper-nav-item-add">+</span><span class="salescenter-app-helper-nav-item-text">{{localize.SALESCENTER_RIGHT_ACTION_ADD}}</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t<div class="salescenter-app-right-side">\n\t\t\t\t<div class="salescenter-app-page-header" v-show="isShowPreview && !isShowStartInfo">\n\t\t\t\t\t<div class="salescenter-btn-action ui-btn ui-btn-link ui-btn-dropdown ui-btn-xs" @click="showActionsPopup($event)">{{localize.SALESCENTER_RIGHT_ACTIONS_BUTTON}}</div>\n\t\t\t\t\t<div class="salescenter-btn-delimiter salescenter-btn-action"></div>\n\t\t\t\t\t<div class="salescenter-btn-action ui-btn ui-btn-link ui-btn-xs ui-btn-icon-edit" @click="editPage">{{localize.SALESCENTER_RIGHT_ACTION_EDIT}}</div>\n\t\t\t\t</div>\n\t\t\t\t<start\n\t\t\t\t\tv-if="isShowStartInfo"\n\t\t\t\t\t@on-successfully-connected="onSuccessfullyConnected"\n\t\t\t\t>\n\t\t\t\t</start>\n\t\t\t\t<template v-else-if="isFrameError && isShowPreview">\n\t\t\t\t\t<div class="salescenter-app-page-content salescenter-app-lost">\n\t\t\t\t\t\t<div class="salescenter-app-lost-block ui-title-1 ui-text-center ui-color-medium">{{localize.SALESCENTER_ERROR_TITLE}}</div>\n\t\t\t\t\t\t<div v-if="currentPage.isFrameDenied === true" class="salescenter-app-lost-helper ui-color-medium">{{localize.SALESCENTER_RIGHT_FRAME_DENIED}}</div>\n\t\t\t\t\t\t<div v-else-if="currentPage.isActive !== true" class="salescenter-app-lost-helper salescenter-app-not-active ui-color-medium">{{localize.SALESCENTER_RIGHT_NOT_ACTIVE}}</div>\n\t\t\t\t\t\t<div v-else class="salescenter-app-lost-helper ui-color-medium">{{localize.SALESCENTER_ERROR_TEXT}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<div v-show="isShowPreview && !isShowStartInfo && !isFrameError" class="salescenter-app-page-content">\n\t\t\t\t\t<template v-for="page in pages">\n\t\t\t\t\t\t<iframe class="salescenter-app-demo" v-show="currentPage && currentPage.id == page.id" :src="getFrameSource(page)" frameborder="0" @error="onFrameError(page.id)" @load="onFrameLoad(page.id)" :key="page.id"></iframe>\n\t\t\t\t\t</template>\n\t\t\t\t\t<div class="salescenter-app-demo-overlay" :class="{\n\t\t\t\t\t\t\'salescenter-app-demo-overlay-loading\': this.isShowLoader\n\t\t\t\t\t}">\n\t\t\t\t\t\t<div v-show="isShowLoader" ref="previewLoader"></div>\n\t\t\t\t\t\t<div v-if="lastModified" class="salescenter-app-demo-overlay-modification">{{lastModified}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t    <template v-if="this.$root.$app.isPaymentsLimitReached">\n\t\t\t        <div ref="paymentsLimit" v-show="isShowPayment && !isShowStartInfo"></div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<chat-receiving-payment\n\t\t\t\t\t\tv-if="isShowPayment && !isShowStartInfo"\n\t\t\t\t\t\t:key="order.basketVersion"\n\t\t\t\t\t\t@stage-block-send-on-send="send($event)"\n\t\t\t\t\t\t@stage-block-send-on-send-compilation-link-to-facebook="sendCompilationLinkToFacebook($event)"\n\t\t\t\t\t/>\n\t\t        </template>\n\t\t\t</div>\n\t\t\t<div class="ui-button-panel-wrapper salescenter-button-panel" ref="buttonsPanel">\n\t\t\t\t<div class="ui-button-panel">\n\t\t\t\t\t<button :class="{\'ui-btn-disabled\': !this.isAllowedSubmitButton}" class="ui-btn ui-btn-md ui-btn-success" @click="send($event)">{{sendButtonLabel}}</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if="showSubmitCompilationLinkToFacebookButton"\n\t\t\t\t\t\t:class="{\'ui-btn-disabled\': !this.isAllowedSubmitButton}"\n\t\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-light-border"\n\t\t\t\t\t\t@click="sendCompilationLinkToFacebook($event)"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{localize.SALESCENTER_SEND_COMPILATION_LINK_TO_FACEBOOK}}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button class="ui-btn ui-btn-md ui-btn-link" @click="close">{{localize.SALESCENTER_CANCEL}}</button>\n\t\t\t\t\t<button v-if="isShowPayment && !isShowStartInfo && !this.$root.$app.isPaymentsLimitReached && this.$root.$app.isWithOrdersMode" class="ui-btn ui-btn-md ui-btn-link btn-send-crm" @click="send($event, \'y\')">{{localize.SALESCENTER_SAVE_ORDER}}</button>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="this.order.errors.length > 0" ref="errorBlock"></div>\n\t\t\t</div>\n\t\t</div>\n\t'};function Pt(t,e){var n=typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=$t(t))||e&&t&&typeof t.length==="number"){if(n)t=n;var s=0;var i=function t(){};return{s:i,n:function e(){if(s>=t.length)return{done:true};return{done:false,value:t[s++]}},e:function t(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,a=false,r;return{s:function e(){n=n.call(t)},n:function t(){var e=n.next();o=e.done;return e},e:function t(e){a=true;r=e},f:function t(){try{if(!o&&n["return"]!=null)n["return"]()}finally{if(a)throw r}}}}function $t(t,e){if(!t)return;if(typeof t==="string")return It(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return It(t,e)}function It(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}var _t="phone";var Lt="sender";var Ot={props:{initSenders:{type:Array,required:true},initCurrentSenderCode:{type:String,required:false},initPushedToUseBitrix24Notifications:{type:String,required:false},status:{type:String,required:true},counter:{type:Number,required:true},manager:{type:Object,required:true},selectedSmsSender:{type:String,required:false},phone:{type:String,required:true},contactEditorUrl:{type:String,required:true},ownerTypeId:{type:Number,required:true},ownerId:{type:Number,required:true},titleTemplate:{type:String,required:true},showHint:{type:Boolean,required:true},editorTemplate:{type:String,required:true},editorUrl:{type:String,required:true},selectedMode:{type:String,required:true}},mixins:[U],components:{"stage-block-item":_.Block,"sms-error-block":E.Error,"sms-sender-list-block":E.SenderList,"sms-user-avatar-block":E.UserAvatar,"sms-message-edit-block":E.MessageEdit,"sms-message-view-block":E.MessageView,"sms-message-editor-block":E.MessageEditor,"sms-message-control-block":E.MessageControl},data:function t(){return{contactPhone:this.phone,currentSenderCode:null,senders:[],pushedToUseBitrix24Notifications:null,smsSenderListComponentKey:0}},computed:{configForBlock:function t(){return{counter:this.counter,checked:this.counterCheckedMixin,showHint:true,hintClassModifier:"salescenter-app-payment-by-sms-item-title-info--link-gray"}},editor:function t(){return{template:this.editorTemplate,url:this.editorUrl}},currentSender:function t(){var e=this;return this.senders.find((function(t){return t.code===e.currentSenderCode}))},title:function t(){return this.titleTemplate.replace("#PHONE#",this.contactPhone)},errors:function t(){var e=this;var n=[];var s;if(!this.currentSender){var i=Pt(this.senders),o;try{for(i.s();!(o=i.n()).done;){var a=o.value;if(!O.SenderConfig.needConfigure(a)){continue}n.push({text:this.getConnectionErrorText(a),fixer:O.SenderConfig.openSliderFreeMessages(a.connectUrl),fixText:this.getConnectionErrorFixText(a),type:Lt});if(a.code===O.SenderConfig.BITRIX24){s=a.connectUrl}}}catch(t){i.e(t)}finally{i.f()}}else{if(!this.currentSender.isAvailable){n.push({text:w.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_"+this.currentSender.code.toUpperCase()+"_NOT_AVAILABLE"),type:Lt})}else{if(this.currentSender.isConnected){n=this.currentSender.usageErrors.map((function(t){return{text:t,type:Lt}}))}else{n.push({text:this.getConnectionErrorText(this.currentSender),fixer:this.getFixer(this.currentSender.connectUrl),fixText:this.getConnectionErrorFixText(this.currentSender),type:Lt});if(this.currentSender.code===O.SenderConfig.BITRIX24){s=this.currentSender.connectUrl}}}}if(!this.contactPhone){if(this.contactEditorUrl.length>0){n.push({text:w.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER_ALERT_PHONE_EMPTY"),fixer:this.getFixer(this.contactEditorUrl),fixText:w.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER_ALERT_PHONE_EMPTY_SETTINGS"),type:_t})}else{n.push({text:w.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER_ALERT_PHONE_EMPTY"),type:_t})}}if(this.pushedToUseBitrix24Notifications==="N"&&s){this.getFixer(s)().then((function(){return e.handleErrorFix()}));BX.userOptions.save("salescenter","payment_sender_options","pushed_to_use_bitrix24_notifications","Y");this.pushedToUseBitrix24Notifications="Y"}return n}},created:function t(){this.initialize(this.initCurrentSenderCode,this.initSenders,this.initPushedToUseBitrix24Notifications)},methods:{onConfigureContactPhone:function t(){this.$emit("stage-block-sms-message-on-change-contact-phone")},getConnectionErrorText:function t(e){var n="SALESCENTER_SEND_ORDER_BY_SMS_"+e.code.toUpperCase()+"_NOT_CONNECTED_WARNING";var s="SALESCENTER_SEND_ORDER_BY_SMS_"+e.code.toUpperCase()+"_NOT_CONNECTED";return w.Loc.getMessage(n)||w.Loc.getMessage(s)},getConnectionErrorFixText:function t(e){var n="SALESCENTER_SEND_ORDER_BY_SMS_"+e.code.toUpperCase()+"_NOT_CONNECTED_FIX";var s="SALESCENTER_PRODUCT_DISCOUNT_EDIT_PAGE_URL_TITLE";return w.Loc.getMessage(n)||w.Loc.getMessage(s)},getFixer:function t(e){return function(){if(typeof e==="string"){return T.Manager.openSlider(e,{events:{onLoad:function t(e){var n=e.getSlider();var s=n.getFrameWindow().BX;s.addCustomEvent("BX.Crm.EntityEditor:onNothingChanged",(function(){return n.close()}));s.addCustomEvent("BX.Crm.EntityEditor:onCancel",(function(){return n.close()}));s.addCustomEvent("onCrmEntityUpdate",(function(){return n.close()}))}}})}if(babelHelpers["typeof"](e)==="object"&&e!==null){if(e.type==="ui_helper"){return BX.loadExt("ui.info-helper").then((function(){BX.UI.InfoHelper.show(e.value)}))}}return Promise.resolve()}},onItemHint:function t(e){BX.Salescenter.Manager.openSlider(this.$root.$app.options.urlSettingsCompanyContacts,{width:1200})},initialize:function t(e,n,s){this.currentSenderCode=e;this.senders=n;this.pushedToUseBitrix24Notifications=s},handleOnSmsSenderSelected:function t(e){this.$emit("stage-block-sms-send-on-change-provider",e)},handleErrorFix:function t(){var e=this;w.ajax.runComponentAction("bitrix:salescenter.app","refreshSenderSettings",{mode:"class"}).then((function(t){if(BX.type.isObject(t.data)&&Object.values(t.data).length>0){e.initialize(t.data.currentSenderCode,t.data.senders,t.data.pushedToUseBitrix24Notifications);e.smsSenderListComponentKey+=1}}))},handlePhoneErrorFix:function t(){var e=this;w.ajax.runComponentAction("bitrix:salescenter.app","refreshContactPhone",{mode:"class",data:{fields:{ownerId:this.ownerId,ownerTypeId:this.ownerTypeId}}}).then((function(t){if(BX.type.isObject(t.data)&&Object.values(t.data).length>0){if(e.contactPhone!=t.data.contactPhone){P.UI.Notification.Center.notify({content:w.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER_PHONE_CHANGE",{"#TITLE#":t.data.title})})}e.contactPhone=t.data.contactPhone;e.onConfigureContactPhone()}}))},hendleSmsErrorBlock:function t(e){if(e.data.type===_t){this.handlePhoneErrorFix()}else{this.handleErrorFix()}},openBitrix24NotificationsHelp:function t(e){BX.Salescenter.Manager.openBitrix24NotificationsHelp(e)},openBitrix24NotificationsWorks:function t(e){BX.Salescenter.Manager.openBitrix24NotificationsWorks(e)}},template:'\n\t\t<stage-block-item\t\t\t\n\t\t\t:config="configForBlock"\n\t\t\t:class="statusClassMixin"\n\t\t\tv-on:on-item-hint="onItemHint"\n\t\t>\n\t\t\t<template v-slot:block-title-title>{{title}}</template>\n\t\t\t<template\n\t\t\t\tv-if="showHint"\n\t\t\t\tv-slot:block-hint-title\n\t\t\t>\n\t\t\t\t'.concat(w.Loc.getMessage("SALESCENTER_LEFT_PAYMENT_COMPANY_CONTACTS_V3"),'\n\t\t\t</template>\n\t\t\t<template v-slot:block-container>\n\t\t\t\t<div :class="containerClassMixin" class="salescenter-app-payment-by-sms-item-container-offtop">\n\t\t\t\t\t<sms-error-block\n\t\t\t\t\t\tv-for="(error, index) in errors"\n\t\t\t\t\t\tv-bind:key="index"\n\t\t\t\t\t\tv-on:on-configure="hendleSmsErrorBlock($event)"\n\t\t\t\t\t\t:error="error"\n\t\t\t\t\t>\n\t\t\t\t\t</sms-error-block>\n\t\t\t\t\t\n\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-sms">\n\t\t\t\t\t\t<sms-user-avatar-block :manager="manager"/>\n\t\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-content">\n\t\t\t\t\t\t\t<div v-if="currentSenderCode === \'bitrix24\'" class="salescenter-app-payment-by-sms-item-container-sms-content">\n\t\t\t\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-content-message">\n\t\t\t\t\t\t\t\t\t<div contenteditable="false" class="salescenter-app-payment-by-sms-item-container-sms-content-message-text">\n\t\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_TEMPLATE_BASED_MESSAGE_WILL_BE_SENT"),'\n\t\t\t\t\t\t\t\t\t\t<a @click.stop.prevent="openBitrix24NotificationsHelp(event)" href="#">\n\t\t\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_MORE_DETAILS"),'\n\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<sms-message-editor-block v-else :editor="editor" :selectedMode="selectedMode"/>\n\t\t\t\t\t\t\t<template v-if="currentSenderCode === \'bitrix24\'">\n\t\t\t\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-sms-content-info">\n\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_SEND_ORDER_VIA_BITRIX24"),'\n\t\t\t\t\t\t\t\t\t<span @click="openBitrix24NotificationsWorks(event)">\n\t\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_PRODUCT_SET_BLOCK_TITLE_SHORT"),'\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else-if="currentSenderCode === \'sms_provider\'">\n\t\t\t\t\t\t\t\t<sms-sender-list-block\n\t\t\t\t\t\t\t\t\t:key="smsSenderListComponentKey"\n\t\t\t\t\t\t\t\t\t:list="currentSender.smsSenders"\n\t\t\t\t\t\t\t\t\t:initSelected="selectedSmsSender"\n\t\t\t\t\t\t\t\t\t:settingUrl="currentSender.connectUrl"\n\t\t\t\t\t\t\t\t\tv-on:on-configure="handleErrorFix"\n\t\t\t\t\t\t\t\t\tv-on:on-selected="handleOnSmsSenderSelected"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template v-slot:sms-sender-list-text-send-from>\n\t\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_SEND_ORDER_BY_SMS_SENDER"),"\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</sms-sender-list-block>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</stage-block-item>\n\t")};var At={components:{"send-block":at,"cashbox-block":H,"product-block":K,"delivery-block":et,"paysystem-block":nt,"automation-block":ot,"sms-message-block":Ot,"timeline-block":rt},props:{sendAllowed:{type:Boolean,required:true}},data:function t(){var e={message:{initSenders:this.$root.$app.options.senders,initCurrentSenderCode:this.$root.$app.options.currentSenderCode,initPushedToUseBitrix24Notifications:this.$root.$app.options.pushedToUseBitrix24Notifications,status:_.StatusTypes.complete,selectedSmsSender:this.$root.$app.sendingMethodDesc.provider,manager:this.$root.$app.options.entityResponsible,phone:this.$root.$app.options.contactPhone,ownerId:this.$root.$app.options.ownerId,ownerTypeId:this.$root.$app.options.ownerTypeId,contactEditorUrl:this.$root.$app.options.contactEditorUrl,titleTemplate:this.$root.$app.sendingMethodDesc.sent?w.Loc.getMessage("SALESCENTER_APP_CONTACT_BLOCK_TITLE_MESSAGE_2_PAST_TIME"):w.Loc.getMessage("SALESCENTER_APP_CONTACT_BLOCK_TITLE_MESSAGE_2"),showHint:this.$root.$app.options.templateMode!=="view",editorTemplate:this.$root.$app.sendingMethodDesc.text,editorUrl:this.$root.$app.orderPublicUrl,selectedMode:"payment"},product:{status:this.$root.$app.options.basket&&this.$root.$app.options.basket.length>0?_.StatusTypes.complete:_.StatusTypes.current,title:this.$root.$app.options.templateMode==="view"?w.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_TITLE_PAYMENT_VIEW"):w.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_TITLE_SHORT"),hintTitle:this.$root.$app.options.templateMode==="view"?"":w.Loc.getMessage("SALESCENTER_PRODUCT_SET_BLOCK_TITLE_SHORT")},paysystem:{status:this.$root.$app.options.paySystemList.isSet?_.StatusTypes.complete:_.StatusTypes.disabled,tiles:this.getTileCollection(this.$root.$app.options.paySystemList.items),installed:this.$root.$app.options.paySystemList.isSet,titleItems:this.getTitleItems(this.$root.$app.options.paySystemList.items),initialCollapseState:this.$root.$app.options.isPaySystemCollapsed?this.$root.$app.options.isPaySystemCollapsed==="Y":this.$root.$app.options.paySystemList.isSet},cashbox:{},delivery:{status:this.$root.$app.options.deliveryList.isInstalled?_.StatusTypes.complete:_.StatusTypes.disabled,tiles:this.getTileCollection(this.$root.$app.options.deliveryList.items),installed:this.$root.$app.options.deliveryList.isInstalled,initialCollapseState:this.$root.$app.options.isDeliveryCollapsed?this.$root.$app.options.isDeliveryCollapsed==="Y":this.$root.$app.options.deliveryList.isInstalled},automation:{}};if(this.$root.$app.options.cashboxList.hasOwnProperty("items")){e.cashbox={status:this.$root.$app.options.cashboxList.isSet?_.StatusTypes.complete:_.StatusTypes.disabled,tiles:this.getTileCollection(this.$root.$app.options.cashboxList.items),installed:this.$root.$app.options.cashboxList.isSet,titleItems:this.getTitleItems(this.$root.$app.options.cashboxList.items),initialCollapseState:this.$root.$app.options.isCashboxCollapsed?this.$root.$app.options.isCashboxCollapsed==="Y":this.$root.$app.options.cashboxList.isSet}}if(this.$root.$app.options.isAutomationAvailable){e.automation={status:_.StatusTypes.complete,stageOnOrderPaid:this.$root.$app.options.stageOnOrderPaid,stageOnDeliveryFinished:this.$root.$app.options.stageOnDeliveryFinished,items:this.$root.$app.options.entityStageList,initialCollapseState:this.$root.$app.options.isAutomationCollapsed?this.$root.$app.options.isAutomationCollapsed==="Y":false}}if(this.$root.$app.options.hasOwnProperty("timeline")){e.timeline={items:this.getTimelineCollection(this.$root.$app.options.timeline)}}if(this.$root.$app.options.paySystemList.groups){e.paysystem.groups=this.getTileGroupsCollection(this.$root.$app.options.paySystemList.groups,e.paysystem.tiles)}return{stages:e}},mixins:[U,N],computed:{hasStageTimeLine:function t(){return this.stages.timeline.hasOwnProperty("items")&&this.stages.timeline.items.length>0},hasStageAutomation:function t(){return this.stages.automation.hasOwnProperty("items")},hasStageCashBox:function t(){return this.stages.cashbox.hasOwnProperty("tiles")},submitButtonLabel:function t(){return this.editable?w.Loc.getMessage("SALESCENTER_SEND"):w.Loc.getMessage("SALESCENTER_RESEND")},isHideDeliveryStage:function t(){return this.isViewWithoutDelivery()}},methods:{initCounter:function t(){this.counter=1},getTimelineCollection:function t(e){var n=[];Object.values(e).forEach((function(t){return n.push(C.Factory.create(t))}));return n},getTileCollection:function t(e){var n=[];Object.values(e).forEach((function(t){return n.push($.Factory.create(t))}));return n},getTileGroupsCollection:function t(e,n){var s=[];if(e instanceof Array){Object.values(e).forEach((function(t){var e=new $.Group(t);e.fillTiles(n);s.push(e)}))}return s},getTitleItems:function t(e){var n=[];e.forEach((function(t){if(![$.More.type(),$.Offer.type()].includes(t.type)){n.push(t)}}));return n},stageRefresh:function t(e,n){w.ajax.runComponentAction("bitrix:salescenter.app","getAjaxData",{mode:"class",data:{type:n}}).then(function(t){if(t.data){this.refreshTilesByType(t.data,n)}}.bind(this),(function(){P.UI.Notification.Center.notify({content:w.Loc.getMessage("SALESCENTER_DATA_UPDATE_ERROR")})}))},refreshTilesByType:function t(e,n){if(n==="PAY_SYSTEM"){this.stages.paysystem.status=e.isSet?_.StatusTypes.complete:_.StatusTypes.disabled;this.stages.paysystem.tiles=this.getTileCollection(e.items);this.stages.paysystem.groups=this.getTileGroupsCollection(e.groups,this.stages.paysystem.tiles);this.stages.paysystem.installed=e.isSet;this.stages.paysystem.titleItems=this.getTitleItems(e.items)}else if(n==="CASHBOX"){this.stages.cashbox.status=e.isSet?_.StatusTypes.complete:_.StatusTypes.disabled;this.stages.cashbox.tiles=this.getTileCollection(e.items);this.stages.cashbox.installed=e.isSet;this.stages.cashbox.titleItems=this.getTitleItems(e.items)}else if(n==="DELIVERY"){this.stages.delivery.status=e.isSet?_.StatusTypes.complete:_.StatusTypes.disabled;this.stages.delivery.tiles=this.getTileCollection(e.items);this.stages.delivery.installed=e.isInstalled}},onSend:function t(e){this.$emit("stage-block-send-on-send",e)},changeProvider:function t(e){this.$root.$app.sendingMethodDesc.provider=e;BX.userOptions.save("salescenter","payment_sms_provider_options","latest_selected_provider",e)},changeContactPhone:function t(e){this.$emit("stage-block-on-reload",e)},saveCollapsedOption:function t(e,n){BX.userOptions.save("salescenter","add_payment_collapse_options",e,n)},onProductFormModeChange:function t(){var e=this.$store.getters["orderCreation/isCompilationMode"];if(e){this.stages.delivery.status=_.StatusTypes.disabled;this.stages.message.selectedMode="compilation";this.$root.$app.sendingMethodDesc.text=this.$root.$app.sendingMethodDesc.text_modes.compilation;this.stages.message.editorTemplate=this.$root.$app.sendingMethodDesc.text_modes.compilation}else{this.stages.delivery.status=this.$root.$app.options.deliveryList.isInstalled?_.StatusTypes.complete:_.StatusTypes.disabled;this.stages.message.selectedMode="payment";this.$root.$app.sendingMethodDesc.text=this.$root.$app.sendingMethodDesc.text_modes.payment;this.stages.message.editorTemplate=this.$root.$app.sendingMethodDesc.text_modes.payment}},isViewWithoutDelivery:function t(){return this.$root.$app.options.templateMode==="view"&&parseInt(this.$root.$app.options.shipmentId)<=0}},created:function t(){this.initCounter()},beforeUpdate:function t(){this.initCounter()},template:'\n\t\t<div>\n\t\t\t<sms-message-block\n\t\t\t\t@stage-block-sms-send-on-change-provider="changeProvider"\n\t\t\t\t@stage-block-sms-message-on-change-contact-phone="changeContactPhone"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.message.status"\n\t\t\t\t:initSenders="stages.message.initSenders"\n\t\t\t\t:initCurrentSenderCode="stages.message.initCurrentSenderCode"\n\t\t\t\t:initPushedToUseBitrix24Notifications="stages.message.initPushedToUseBitrix24Notifications"\n\t\t\t\t:selectedSmsSender="stages.message.selectedSmsSender"\n\t\t\t\t:manager="stages.message.manager"\n\t\t\t\t:phone="stages.message.phone"\n\t\t\t\t:contactEditorUrl="stages.message.contactEditorUrl"\n\t\t\t\t:ownerId="stages.message.ownerId"\n\t\t\t\t:ownerTypeId="stages.message.ownerTypeId"\n\t\t\t\t:titleTemplate="stages.message.titleTemplate"\n\t\t\t\t:showHint="stages.message.showHint"\n\t\t\t\t:editorTemplate="stages.message.editorTemplate"\n\t\t\t\t:editorUrl="stages.message.editorUrl"\n\t\t\t\t:selectedMode="stages.message.selectedMode"\n\t\t\t/>\n\t\t\t<product-block\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.product.status"\n\t\t\t\t:title="stages.product.title"\n\t\t\t\t:hintTitle="stages.product.hintTitle"\n\t\t\t\t@on-product-form-mode-change="onProductFormModeChange"\n\t\t\t/>\n\t\t\t<paysystem-block\n\t\t\t\tv-if="editable"\n\t\t\t\t@on-stage-tile-collection-slider-close="stageRefresh($event, \'PAY_SYSTEM\')"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.paysystem.status"\n\t\t\t\t:tiles="stages.paysystem.tiles"\n\t\t\t\t:installed="stages.paysystem.installed"\n\t\t\t\t:titleItems="stages.paysystem.titleItems"\n\t\t\t\t:initialCollapseState="stages.paysystem.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t<cashbox-block\n\t\t\t\tv-if="editable && hasStageCashBox"\n\t\t\t\t@on-stage-tile-collection-slider-close="stageRefresh($event, \'CASHBOX\')"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.cashbox.status"\n\t\t\t\t:tiles="stages.cashbox.tiles"\n\t\t\t\t:installed="stages.cashbox.installed"\n\t\t\t\t:titleItems="stages.cashbox.titleItems"\n\t\t\t\t:initialCollapseState="stages.cashbox.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t<delivery-block\n\t\t\t\tv-if="!isHideDeliveryStage"\n\t\t\t\t@on-stage-tile-collection-slider-close="stageRefresh($event, \'DELIVERY\')"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.delivery.status"\n\t\t\t\t:tiles="stages.delivery.tiles"\n\t\t\t\t:installed="stages.delivery.installed"\n\t\t\t\t:isCollapsible="true"\n\t\t\t\t:initialCollapseState="stages.delivery.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t<automation-block\n\t\t\t\tv-if="editable && hasStageAutomation"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.automation.status"\n\t\t\t\t:stageOnOrderPaid="stages.automation.stageOnOrderPaid"\n\t\t\t\t:stageOnDeliveryFinished="stages.automation.stageOnDeliveryFinished"\n\t\t\t\t:items="stages.automation.items"\n\t\t\t\t:initialCollapseState="stages.automation.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t<send-block\n\t\t\t\t@on-submit="onSend"\n\t\t\t\t:buttonEnabled="sendAllowed"\n\t\t\t\t:showWhatClientSeesControl="!editable"\n\t\t\t\t:buttonLabel="submitButtonLabel"\n\t\t\t/>\n\t\t\t<timeline-block\n\t\t\t\tv-if="hasStageTimeLine"\n\t\t\t\t:timelineItems="stages.timeline.items"\n\t\t\t/>\n\t\t</div>\n\t'};var kt={components:{"send-block":at,"cashbox-block":H,"product-block":K,"paysystem-block":nt,"automation-block":ot,"sms-message-block":Ot,"timeline-block":rt,"document-selector-block":mt},props:{sendAllowed:{type:Boolean,required:true}},data:function t(){var e={message:{initSenders:this.$root.$app.options.senders,initCurrentSenderCode:this.$root.$app.options.currentSenderCode,initPushedToUseBitrix24Notifications:this.$root.$app.options.pushedToUseBitrix24Notifications,status:_.StatusTypes.complete,selectedSmsSender:this.$root.$app.sendingMethodDesc.provider,manager:this.$root.$app.options.entityResponsible,phone:this.$root.$app.options.contactPhone,ownerId:this.$root.$app.options.ownerId,ownerTypeId:this.$root.$app.options.ownerTypeId,contactEditorUrl:this.$root.$app.options.contactEditorUrl,titleTemplate:this.$root.$app.sendingMethodDesc.sent?w.Loc.getMessage("SALESCENTER_APP_CONTACT_BLOCK_TITLE_MESSAGE_2_PAST_TIME"):w.Loc.getMessage("SALESCENTER_APP_CONTACT_BLOCK_TITLE_MESSAGE_2"),showHint:this.$root.$app.options.templateMode!=="view",editorTemplate:this.$root.$app.sendingMethodDesc.text,editorUrl:this.$root.$app.orderPublicUrl,selectedMode:"payment"},product:{status:this.$root.$app.options.basket&&this.$root.$app.options.basket.length>0?_.StatusTypes.complete:_.StatusTypes.current,title:this.$root.$app.options.templateMode==="view"?w.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_TITLE_PAYMENT_VIEW"):w.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_TITLE_SHORT"),hintTitle:this.$root.$app.options.templateMode==="view"?"":w.Loc.getMessage("SALESCENTER_PRODUCT_SET_BLOCK_TITLE_SHORT")},paysystem:{status:this.$root.$app.options.paySystemList.isSet?_.StatusTypes.complete:_.StatusTypes.disabled,tiles:this.getTileCollection(this.$root.$app.options.paySystemList.items),installed:this.$root.$app.options.paySystemList.isSet,titleItems:this.getTitleItems(this.$root.$app.options.paySystemList.items),initialCollapseState:this.$root.$app.options.isPaySystemCollapsed?this.$root.$app.options.isPaySystemCollapsed==="Y":this.$root.$app.options.paySystemList.isSet},cashbox:{},automation:{},documentSelector:{status:_.StatusTypes.complete}};if(this.$root.$app.options.cashboxList.hasOwnProperty("items")){e.cashbox={status:this.$root.$app.options.cashboxList.isSet?_.StatusTypes.complete:_.StatusTypes.disabled,tiles:this.getTileCollection(this.$root.$app.options.cashboxList.items),installed:this.$root.$app.options.cashboxList.isSet,titleItems:this.getTitleItems(this.$root.$app.options.cashboxList.items),initialCollapseState:this.$root.$app.options.isCashboxCollapsed?this.$root.$app.options.isCashboxCollapsed==="Y":this.$root.$app.options.cashboxList.isSet}}if(this.$root.$app.options.isAutomationAvailable){e.automation={status:_.StatusTypes.complete,stageOnOrderPaid:this.$root.$app.options.stageOnOrderPaid,items:this.$root.$app.options.entityStageList,initialCollapseState:this.$root.$app.options.isAutomationCollapsed?this.$root.$app.options.isAutomationCollapsed==="Y":false}}if(this.$root.$app.options.hasOwnProperty("timeline")){e.timeline={items:this.getTimelineCollection(this.$root.$app.options.timeline)}}if(this.$root.$app.hasOwnProperty("documentSelector")){if(this.$root.$app.documentSelector.templateAddUrl){e.documentSelector.templateAddUrl=this.$root.$app.documentSelector.templateAddUrl}}return{stages:e}},mixins:[U,N],computed:{hasStageTimeLine:function t(){return this.stages.timeline.hasOwnProperty("items")&&this.stages.timeline.items.length>0},hasStageAutomation:function t(){return this.stages.automation.hasOwnProperty("items")},hasStageCashBox:function t(){return this.stages.cashbox.hasOwnProperty("tiles")},submitButtonLabel:function t(){return this.editable?w.Loc.getMessage("SALESCENTER_SEND"):w.Loc.getMessage("SALESCENTER_RESEND")},isShowDocumentSelector:function t(){return this.$root.$app.hasOwnProperty("documentSelector")}},methods:{initCounter:function t(){this.counter=1},getTimelineCollection:function t(e){var n=[];Object.values(e).forEach((function(t){return n.push(C.Factory.create(t))}));return n},getTileCollection:function t(e){var n=[];Object.values(e).forEach((function(t){return n.push($.Factory.create(t))}));return n},getTitleItems:function t(e){var n=[];e.forEach((function(t){if(![$.More.type(),$.Offer.type()].includes(t.type)){n.push(t)}}));return n},stageRefresh:function t(e,n){w.ajax.runComponentAction("bitrix:salescenter.app","getAjaxData",{mode:"class",data:{type:n}}).then(function(t){if(t.data){this.refreshTilesByType(t.data,n)}}.bind(this),(function(){P.UI.Notification.Center.notify({content:w.Loc.getMessage("SALESCENTER_DATA_UPDATE_ERROR")})}))},refreshTilesByType:function t(e,n){if(n==="PAY_SYSTEM"){this.stages.paysystem.status=e.isSet?_.StatusTypes.complete:_.StatusTypes.disabled;this.stages.paysystem.tiles=this.getTileCollection(e.items);this.stages.paysystem.installed=e.isSet;this.stages.paysystem.titleItems=this.getTitleItems(e.items)}else if(n==="CASHBOX"){this.stages.cashbox.status=e.isSet?_.StatusTypes.complete:_.StatusTypes.disabled;this.stages.cashbox.tiles=this.getTileCollection(e.items);this.stages.cashbox.installed=e.isSet;this.stages.cashbox.titleItems=this.getTitleItems(e.items)}},onSend:function t(e){this.$emit("stage-block-send-on-send",e)},changeProvider:function t(e){this.$root.$app.sendingMethodDesc.provider=e;BX.userOptions.save("salescenter","payment_sms_provider_options","latest_selected_provider",e)},saveCollapsedOption:function t(e,n){BX.userOptions.save("salescenter","add_payment_collapse_options",e,n)}},created:function t(){this.initCounter()},beforeUpdate:function t(){this.initCounter()},template:'\n\t\t<div>\n\t\t\t<sms-message-block\n\t\t\t\t@stage-block-sms-send-on-change-provider="changeProvider"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.message.status"\n\t\t\t\t:initSenders="stages.message.initSenders"\n\t\t\t\t:initCurrentSenderCode="stages.message.initCurrentSenderCode"\n\t\t\t\t:initPushedToUseBitrix24Notifications="stages.message.initPushedToUseBitrix24Notifications"\n\t\t\t\t:selectedSmsSender="stages.message.selectedSmsSender"\n\t\t\t\t:manager="stages.message.manager"\n\t\t\t\t:phone="stages.message.phone"\n\t\t\t\t:contactEditorUrl="stages.message.contactEditorUrl"\n\t\t\t\t:ownerId="stages.message.ownerId"\n\t\t\t\t:ownerTypeId="stages.message.ownerTypeId"\n\t\t\t\t:titleTemplate="stages.message.titleTemplate"\n\t\t\t\t:showHint="stages.message.showHint"\n\t\t\t\t:editorTemplate="stages.message.editorTemplate"\n\t\t\t\t:editorUrl="stages.message.editorUrl"\n\t\t\t\t:selectedMode="stages.message.selectedMode"\n\t\t\t/>\n\t\t\t<product-block\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.product.status"\n\t\t\t\t:title="stages.product.title"\n\t\t\t\t:hintTitle="stages.product.hintTitle"\n\t\t\t/>\n\t\t\t<paysystem-block\n\t\t\t\tv-if="editable"\n\t\t\t\t@on-stage-tile-collection-slider-close="stageRefresh($event, \'PAY_SYSTEM\')"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.paysystem.status"\n\t\t\t\t:tiles="stages.paysystem.tiles"\n\t\t\t\t:installed="stages.paysystem.installed"\n\t\t\t\t:titleItems="stages.paysystem.titleItems"\n\t\t\t\t:initialCollapseState="stages.paysystem.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t<cashbox-block\n\t\t\t\tv-if="editable && hasStageCashBox"\n\t\t\t\t@on-stage-tile-collection-slider-close="stageRefresh($event, \'CASHBOX\')"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.cashbox.status"\n\t\t\t\t:tiles="stages.cashbox.tiles"\n\t\t\t\t:installed="stages.cashbox.installed"\n\t\t\t\t:titleItems="stages.cashbox.titleItems"\n\t\t\t\t:initialCollapseState="stages.cashbox.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t<document-selector-block\n\t\t\t\tv-if="isShowDocumentSelector"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:templateAddUrl="stages.documentSelector.templateAddUrl"\n\t\t\t/>\n\t\t\t<automation-block\n\t\t\t\tv-if="editable && hasStageAutomation"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.automation.status"\n\t\t\t\t:stageOnOrderPaid="stages.automation.stageOnOrderPaid"\n\t\t\t\t:items="stages.automation.items"\n\t\t\t\t:initialCollapseState="stages.automation.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t<send-block\n\t\t\t\t@on-submit="onSend"\n\t\t\t\t:buttonEnabled="sendAllowed"\n\t\t\t\t:showWhatClientSeesControl="!editable"\n\t\t\t\t:buttonLabel="submitButtonLabel"\n\t\t\t/>\n\t\t\t<timeline-block\n\t\t\t\tv-if="hasStageTimeLine"\n\t\t\t\t:timelineItems="stages.timeline.items"\n\t\t\t/>\n\t\t</div>\n\t'};var Mt={props:{buttonEnabled:{type:Boolean,required:true}},computed:{buttonClass:function t(){return{"salescenter-app-payment-by-sms-item-disabled":this.buttonEnabled===false}}},methods:{submit:function t(e){this.$emit("on-submit",e)}},template:'\n\t\t<div\n\t\t\t:class="buttonClass"\n\t\t\tclass="salescenter-app-payment-by-sms-item-show salescenter-app-payment-by-sms-item salescenter-app-payment-by-sms-item-send"\n\t\t>\n\t\t\t<div class="salescenter-app-payment-by-sms-item-counter">\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-rounder"></div>\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-line"></div>\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-number"></div>\n\t\t\t</div>\n\t\t\t<div class="">\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container">\n\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-payment">\n\t\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-payment-inline">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t@click="submit($event)"\n\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-lg ui-btn-success ui-btn-round"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t'.concat(w.Loc.getMessage("SALESCENTER_CREATE_SHIPMENT"),"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t")};var wt={components:{"send-block":Mt,"product-block":K,"delivery-block":et,"automation-block":ot},props:{sendAllowed:{type:Boolean,required:true}},data:function t(){var e={product:{status:this.$root.$app.options.basket&&this.$root.$app.options.basket.length>0?_.StatusTypes.complete:_.StatusTypes.current,title:this.$root.$app.options.templateMode==="view"?w.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_TITLE_SHIPMENT_VIEW"):w.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_TITLE_SHORT_SHIPMENT")},delivery:{status:this.$root.$app.options.deliveryList.isInstalled?_.StatusTypes.complete:_.StatusTypes.disabled,tiles:this.getTileCollection(this.$root.$app.options.deliveryList.items),installed:this.$root.$app.options.deliveryList.isInstalled,initialCollapseState:this.$root.$app.options.isDeliveryCollapsed?this.$root.$app.options.isDeliveryCollapsed==="Y":this.$root.$app.options.deliveryList.isInstalled},automation:{}};if(this.$root.$app.options.isAutomationAvailable){e.automation={status:_.StatusTypes.complete,stageOnDeliveryFinished:this.$root.$app.options.stageOnDeliveryFinished,items:this.$root.$app.options.entityStageList,initialCollapseState:this.$root.$app.options.isAutomationCollapsed?this.$root.$app.options.isAutomationCollapsed==="Y":false}}return{stages:e}},mixins:[U,N],computed:{hasStageAutomation:function t(){return this.stages.automation.hasOwnProperty("items")},editableMixin:function t(){return this.editable===false},isViewTemplateMode:function t(){return this.$root.$app.options.templateMode==="view"}},methods:{initCounter:function t(){this.counter=1},getTileCollection:function t(e){var n=[];Object.values(e).forEach((function(t){return n.push($.Factory.create(t))}));return n},getTitleItems:function t(e){var n=[];e.forEach((function(t){if(![$.More.type(),$.Offer.type()].includes(t.type)){n.push(t)}}));return n},stageRefresh:function t(e,n){w.ajax.runComponentAction("bitrix:salescenter.app","getAjaxData",{mode:"class",data:{type:n}}).then(function(t){if(t.data){this.refreshTilesByType(t.data,n)}}.bind(this),(function(){P.UI.Notification.Center.notify({content:w.Loc.getMessage("SALESCENTER_DATA_UPDATE_ERROR")})}))},refreshTilesByType:function t(e,n){if(n==="DELIVERY"){this.stages.delivery.status=e.isSet?_.StatusTypes.complete:_.StatusTypes.disabled;this.stages.delivery.tiles=this.getTileCollection(e.items);this.stages.delivery.installed=e.isInstalled}},onSend:function t(e){this.$emit("stage-block-send-on-send",e)},saveCollapsedOption:function t(e,n){BX.userOptions.save("salescenter","add_shipment_collapse_options",e,n)}},created:function t(){this.initCounter()},beforeUpdate:function t(){this.initCounter()},template:'\n\t\t<div>\n\t\t\t<product-block \n\t\t\t\t:counter=\t"counter++"\n\t\t\t\t:status= \t"stages.product.status"\n\t\t\t\t:title=\t\t"stages.product.title"\t\t\n\t\t\t\t:hintTitle=\t\t"\'\'"\n\t\t\t/>\n\t\t\t\n\t\t\t<delivery-block\t\t\t\t\t\t\tv-on:on-stage-tile-collection-slider-close="stageRefresh($event, \'DELIVERY\')"\n\t\t\t\t:counter=\t"counter++"\n\t\t\t\t:status=  \t"stages.delivery.status"\n\t\t\t\t:tiles=  \t"stages.delivery.tiles"\n\t\t\t\t:installed=\t"stages.delivery.installed"\n\t\t\t\t:isCollapsible="false"\n\t\t\t\t:initialCollapseState = "stages.delivery.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t\t\t\t\t\t\t\n\t\t\t<automation-block v-if="editable && hasStageAutomation"\n\t\t\t\t:counter=\t"counter++"\n\t\t\t\t:status=\t"stages.automation.status"\n\t\t\t\t:stageOnDeliveryFinished=\t"stages.automation.stageOnDeliveryFinished"\n\t\t\t\t:items=\t\t"stages.automation.items"\n\t\t\t\t:initialCollapseState = "stages.automation.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t\n\t\t\t<send-block\n\t\t\t\tv-if="!isViewTemplateMode"\n\t\t\t\t@on-submit="onSend"\n\t\t\t\t:buttonEnabled="sendAllowed"\n\t\t\t/>\n\t\t</div>\n\t'};var xt={props:{status:{type:String,required:true},counter:{type:Number,required:true},title:{type:String,required:true},selectedUser:{type:Number,required:false},responsible:{type:Object,required:false},isMobileInstalledForResponsible:{type:Boolean,required:false},editable:{type:Boolean,required:true},contact:{type:Object,required:true},hintTitle:{type:String,required:false}},mixins:[U],components:{"stage-block-item":_.Block},computed:{isCreateMode:function t(){return this.$root.$app.options.templateMode==="create"},configForBlock:function t(){return{counter:this.counter,titleItems:[],installed:true,collapsible:false,checked:this.counterCheckedMixin,showHint:true}},contactInfo:function t(){if(this.contact.name||this.contact.phone){return w.Loc.getMessage("SALESCENTER_PAYMENT_RESPONSIBLE_SELECTOR_BLOCK_CONTACT_INFO_TEMPLATE",{"[span]":'<span class="salescenter-responsible-block-contact">',"[/span]":"</span>","#CONTACT_NAME#":w.Text.encode(this.contact.name),"#CONTACT_PHONE#":w.Text.encode(this.contact.phone)})}return""},addEmployee:function t(){return w.Loc.getMessage("SALESCENTER_PAYMENT_RESPONSIBLE_SELECTOR_BLOCK_ADD_EMPLOYEE",{"[link]":'<span id="add-employee-link" class="salescenter-responsible-block-add-employee-link">',"[/link]":"</span>"})},responsibleHeaderText:function t(){return this.isCreateMode?w.Loc.getMessage("SALESCENTER_PAYMENT_RESPONSIBLE_SELECTOR_BLOCK_RESPONSIBLE_CREATE"):w.Loc.getMessage("SALESCENTER_PAYMENT_RESPONSIBLE_SELECTOR_BLOCK_RESPONSIBLE_VIEW")},avatarStyle:function t(){var e=this.responsible.photo?{"background-image":"url(".concat(this.responsible.photo,")")}:null;return[e]}},mounted:function t(){var e,n=this;this.$store.commit("orderCreation/setMobileInstalledForResponsible",(e=this.isMobileInstalledForResponsible)!==null&&e!==void 0?e:true);var s=document.getElementById("add-employee-link");if(s){w.Event.bind(s,"click",(function(t){n.$root.$app.openMobileAppPopup()}))}if(!this.editable){return}var i=document.getElementById("salescenterResponsibleSelector");var o={context:"salescenter_responsible",entities:[{id:"user"}],events:{"Item:onSelect":function t(e){n.onResponsibleChanged(e)}}};if(this.selectedUser){o.preselectedItems=[["user",this.selectedUser]];o.undeselectedItems=[["user",this.selectedUser]]}var a=new I.TagSelector({multiple:false,dialogOptions:o,deselectable:false});a.renderTo(i)},methods:{onResponsibleChanged:function t(e){var n,s,i=this;var o=e.getData(),a=o.item;a.setDeselectable(false);(n=e.target)===null||n===void 0?void 0:(s=n.tagSelector)===null||s===void 0?void 0:s.updateTags();this.$store.commit("orderCreation/setPaymentResponsibleId",a.getId());var r=this.$store.getters["orderCreation/isAllowedSubmit"];this.$store.commit("orderCreation/disableSubmit");w.ajax.runAction("salescenter.terminalResponsible.getUserMobileInfo",{data:{userId:a.getId()}}).then((function(t){i.$store.commit("orderCreation/setMobileInstalledForResponsible",t.data.isMobileInstalled);if(!t.data.isMobileInstalled){i.$store.commit("orderCreation/setResponsiblePhoneNumbers",t.data.phones)}if(r){i.$store.commit("orderCreation/enableSubmit")}i.$emit("on-responsible-changed",e)}))},onItemHint:function t(e){BX.Salescenter.Manager.openHowTerminalWorks()}},created:function t(){if(this.selectedUser){this.$store.commit("orderCreation/setPaymentResponsibleId",this.selectedUser)}},template:'\n\t\t<stage-block-item\n\t\t\t:class="statusClassMixin"\n\t\t\t:config="configForBlock"\n\t\t\tv-on:on-item-hint="onItemHint"\n\t\t>\n\t\t\t<template v-slot:block-title-title>{{ title }}</template>\n\t\t\t<template v-slot:block-hint-title>{{ hintTitle }}</template>\n\t\t\t<template v-slot:block-container>\n\t\t\t\t<div :class="containerClassMixin">\n\t\t\t\t\t<p class="salescenter-responsible-block-responsible-header">{{ responsibleHeaderText }}</p>\n\t\t\t\t\t<div id="salescenterResponsibleSelector" v-if="editable"></div>\n\t\t\t\t\t<div class="salescenter-responsible-block-responsible-wrapper" v-else>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="salescenter-app-payment-by-sms-item-container-sms-user-avatar salescenter-responsible-block-responsible-photo"\n\t\t\t\t\t\t\t:style="avatarStyle"></div>\n\t\t\t\t\t\t<div class="salescenter-responsible-block-responsible-name-wrapper">\n\t\t\t\t\t\t\t<a class="salescenter-responsible-block-responsible-name">{{ responsible.fullName }}</a>\n\t\t\t\t\t\t\t<div class="salescenter-responsible-block-responsible-position-wrapper">\n\t\t\t\t\t\t\t\t<span class="salescenter-responsible-block-responsible-position">{{ responsible.position }}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-html="contactInfo" class="salescenter-responsible-block-contact-info" v-if="!isCreateMode"></div>\n\t\t\t\t\t<div v-html="addEmployee" class="salescenter-responsible-block-add-employee" v-else></div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</stage-block-item>\n\t'};var Rt={props:{buttonLabel:{type:String,required:true},buttonEnabled:{type:Boolean,required:true}},computed:{buttonClass:function t(){return{"salescenter-app-payment-by-sms-item-disabled":this.buttonEnabled===false}}},methods:{submit:function t(e){this.$emit("on-submit",e)}},template:'\n\t\t<div\n\t\t\t:class="buttonClass"\n\t\t\tclass="salescenter-app-payment-by-sms-item-show salescenter-app-payment-by-sms-item salescenter-app-payment-by-sms-item-send"\n\t\t>\n\t\t\t<div class="salescenter-app-payment-by-sms-item-counter">\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-rounder"></div>\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-line"></div>\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-counter-number"></div>\n\t\t\t</div>\n\t\t\t<div class="">\n\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container">\n\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-payment">\n\t\t\t\t\t\t<div class="salescenter-app-payment-by-sms-item-container-payment-inline">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t@click="submit($event)"\n\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-lg ui-btn-success ui-btn-round"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{buttonLabel}}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var Nt;var Bt={props:{status:{type:String,required:true},counter:{type:Number,required:true},title:{type:String,required:true},hintTitle:{type:String,required:true}},mixins:[U],mounted:function t(){var e=this.$root.$app.options.templateMode!=="view";this.$root.$emit("on-change-editable",e);this.$store.commit("orderCreation/enableSubmit")},components:{"stage-block-item":_.Block},methods:{onItemHint:function t(e){BX.Salescenter.Manager.openHowToSell(e)},onProductFormModeChange:function t(e){this.$emit("on-product-form-mode-change")}},computed:{configForBlock:function t(){return{counter:this.counter,checked:this.counterCheckedMixin,showHint:true}},formattedSum:function t(){var e=this.$root.$app.options.currencyCode||"";var n=L.CurrencyCore.currencyFormat(this.$root.$app.options.totals.result,e,false);var s=w.Tag.render(Nt||(Nt=babelHelpers.taggedTemplateLiteral(['<span class="catalog-pf-text salescenter-amount-block-amount-result-text--total">',"</span>"])),n);return L.CurrencyCore.getPriceControl(s,e)}},template:'\n\t\t<stage-block-item\n\t\t\t@on-item-hint.stop.prevent="onItemHint"\n\t\t\t:config="configForBlock"\n\t\t\t:class="statusClassMixin"\n\t\t>\n\t\t\t<template v-slot:block-title-title>{{ title }}</template>\n\t\t\t<template v-slot:block-hint-title>{{ hintTitle }}</template>\n\t\t\t<template v-slot:block-container>\n\t\t\t\t<div :class="containerClassMixin">\n\t\t\t\t\t<div class="salescenter-amount-block-stub-wrapper">\n\t\t\t\t\t\t<div class="salescenter-amount-block-stub-icon"></div>\n\t\t\t\t\t\t<div class="salescenter-amount-block-stub-text-wrapper">\n\t\t\t\t\t\t\t<h3 class="salescenter-amount-block-stub-title">'.concat(w.Loc.getMessage("SALESCENTER_AMOUNT_BLOCK_STUB_TITLE"),'</h3>\n\t\t\t\t\t\t\t<p class="salescenter-amount-block-stub-text">').concat(w.Loc.getMessage("SALESCENTER_AMOUNT_BLOCK_STUB_TEXT"),'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="salescenter-amount-block-amount-wrapper">\n\t\t\t\t\t\t<table class="salescenter-amount-block-amount-result">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td class="salescenter-amount-block-amount-result-cell">\n\t\t\t\t\t\t\t\t\t<span class="salescenter-amount-block-amount-result-text salescenter-amount-block-amount-result-text--total">').concat(w.Loc.getMessage("SALESCENTER_AMOUNT_BLOCK_TOTAL"),'</span>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td class="salescenter-amount-block-amount-result-cell">\n\t\t\t\t\t\t\t\t\t<span class="salescenter-amount-block-amount-result-symbol salescenter-amount-block-amount-result-symbol--total" v-html="formattedSum"></span>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</stage-block-item>\n\t')};var Dt={components:{"responsible-block":xt,"cashbox-block":H,"product-block":K,"paysystem-block":nt,"automation-block":ot,"timeline-block":rt,"send-block":Rt,"amount-block":Bt},props:{sendAllowed:{type:Boolean,required:true}},mounted:function t(){var e;var n=this.$root.$app.options.terminalTour;if(n["step-2-shown"]!=="Y"&&((e=this.$root.$app.options.payment)===null||e===void 0?void 0:e.PAID)!=="Y"){w.Runtime.loadExtension("ui.tour").then((function(t){var e=t.Guide;var n=new e({steps:[{target:document.querySelector("#salescenterResponsibleSelector"),text:w.Loc.getMessage("SALESCENTER_TERMINAL_TOUR_STEP_2_TEXT"),position:"bottom",article:"18537646"}],onEvents:true,events:{onFinish:function t(){w.userOptions.save("salescenter.tour","crm-terminal-tour","step-2-shown","Y")}}});n.getPopup().setAutoHide(true);n.showNextStep()}))}},data:function t(){var e,n,s;var i={responsible:{status:_.StatusTypes.complete,selectedUser:parseInt((e=this.$root.$app.options.paymentResponsible)!==null&&e!==void 0?e:0),responsible:this.$root.$app.options.entityResponsible,isMobileInstalledForResponsible:this.$root.$app.options.isMobileInstalledForResponsible,contact:{name:this.$root.$app.options.contactName,phone:this.$root.$app.options.contactPhone},editable:this.$root.$app.options.templateMode==="create"||((n=this.$root.$app.options.payment)===null||n===void 0?void 0:n.PAID)==="N",hintTitle:this.$root.$app.options.templateMode==="view"?"":w.Loc.getMessage("SALESCENTER_HOW_TERMINAL_WORKS")},product:{status:this.$root.$app.options.basket&&this.$root.$app.options.basket.length>0?_.StatusTypes.complete:_.StatusTypes.current,title:this.$root.$app.options.templateMode==="view"?w.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_TITLE_PAYMENT_VIEW"):w.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_TITLE_SHORT"),hintTitle:""},paysystem:{status:this.$root.$app.options.paySystemList.isSet?_.StatusTypes.complete:_.StatusTypes.disabled,tiles:this.getTileCollection(this.$root.$app.options.paySystemList.items),installed:this.$root.$app.options.paySystemList.isSet,titleItems:this.getTitleItems(this.$root.$app.options.paySystemList.items),initialCollapseState:this.$root.$app.options.isPaySystemCollapsed?this.$root.$app.options.isPaySystemCollapsed==="Y":this.$root.$app.options.paySystemList.isSet},cashbox:{},automation:{}};if(this.$root.$app.options.cashboxList.hasOwnProperty("items")){i.cashbox={status:this.$root.$app.options.cashboxList.isSet?_.StatusTypes.complete:_.StatusTypes.disabled,tiles:this.getTileCollection(this.$root.$app.options.cashboxList.items),installed:this.$root.$app.options.cashboxList.isSet,titleItems:this.getTitleItems(this.$root.$app.options.cashboxList.items),initialCollapseState:this.$root.$app.options.isCashboxCollapsed?this.$root.$app.options.isCashboxCollapsed==="Y":this.$root.$app.options.cashboxList.isSet}}if(this.$root.$app.options.isAutomationAvailable){i.automation={status:_.StatusTypes.complete,stageOnOrderPaid:this.$root.$app.options.stageOnOrderPaid,items:this.$root.$app.options.entityStageList,initialCollapseState:this.$root.$app.options.isAutomationCollapsed?this.$root.$app.options.isAutomationCollapsed==="Y":false}}if(this.$root.$app.options.hasOwnProperty("timeline")){i.timeline={items:this.getTimelineCollection(this.$root.$app.options.timeline)}}if(this.$root.$app.options.paySystemList.groups){i.paysystem.groups=this.getTileGroupsCollection(this.$root.$app.options.paySystemList.groups,i.paysystem.tiles)}if(this.$root.$app.options.templateMode==="view"&&((s=this.$root.$app.options.payment)===null||s===void 0?void 0:s.PAID)==="Y"){i.responsible.title=w.Loc.getMessage("SALESCENTER_PAYMENT_RESPONSIBLE_SELECTOR_BLOCK_TITLE_PAID_VIEW")}else{i.responsible.title=w.Loc.getMessage("SALESCENTER_PAYMENT_RESPONSIBLE_SELECTOR_BLOCK_TITLE")}return{stages:i}},mixins:[U,N],computed:{hasStageTimeLine:function t(){return this.stages.timeline.hasOwnProperty("items")&&this.stages.timeline.items.length>0},hasStageAutomation:function t(){return this.stages.automation.hasOwnProperty("items")},hasStageCashBox:function t(){return this.stages.cashbox.hasOwnProperty("tiles")},submitButtonLabel:function t(){return this.editable?w.Loc.getMessage("SALESCENTER_CREATE_TERMINAL_PAYMENT"):w.Loc.getMessage("SALESCENTER_SAVE")},hasProducts:function t(){return!this.$root.$app.options.isPaymentByAmount}},methods:{initCounter:function t(){this.counter=1},getTimelineCollection:function t(e){var n=[];Object.values(e).forEach((function(t){return n.push(C.Factory.create(t))}));return n},getTileCollection:function t(e){var n=[];Object.values(e).forEach((function(t){return n.push($.Factory.create(t))}));return n},getTileGroupsCollection:function t(e,n){var s=[];if(Array.isArray(e)){Object.values(e).forEach((function(t){var e=new $.Group(t);e.fillTiles(n);s.push(e)}))}return s},getTitleItems:function t(e){var n=[];e.forEach((function(t){if(![$.More.type(),$.Offer.type()].includes(t.type)){n.push(t)}}));return n},stageRefresh:function t(e,n){var s=this;w.ajax.runComponentAction("bitrix:salescenter.app","getAjaxData",{mode:"class",data:{type:n}}).then((function(t){if(t.data){s.refreshTilesByType(t.data,n)}}),(function(){P.UI.Notification.Center.notify({content:w.Loc.getMessage("SALESCENTER_DATA_UPDATE_ERROR")})}))},refreshTilesByType:function t(e,n){switch(n){case"PAY_SYSTEM":{this.stages.paysystem.status=e.isSet?_.StatusTypes.complete:_.StatusTypes.disabled;this.stages.paysystem.tiles=this.getTileCollection(e.items);this.stages.paysystem.groups=this.getTileGroupsCollection(e.groups,this.stages.paysystem.tiles);this.stages.paysystem.installed=e.isSet;this.stages.paysystem.titleItems=this.getTitleItems(e.items);break}case"CASHBOX":{this.stages.cashbox.status=e.isSet?_.StatusTypes.complete:_.StatusTypes.disabled;this.stages.cashbox.tiles=this.getTileCollection(e.items);this.stages.cashbox.installed=e.isSet;this.stages.cashbox.titleItems=this.getTitleItems(e.items);break}}},onSend:function t(e){this.$emit("stage-block-send-on-send",e)},onResponsibleChanged:function t(e){this.$emit("on-responsible-changed",e)},saveCollapsedOption:function t(e,n){BX.userOptions.save("salescenter","add_payment_collapse_options",e,n)}},created:function t(){this.initCounter()},beforeUpdate:function t(){this.initCounter()},template:'\n\t\t<div class="salescenter-app-terminal-wrapper">\n\t\t\t<responsible-block\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.responsible.status"\n\t\t\t\t:title="stages.responsible.title"\n\t\t\t\t:selectedUser="stages.responsible.selectedUser"\n\t\t\t\t:responsible="stages.responsible.responsible"\n\t\t\t\t:isMobileInstalledForResponsible="stages.responsible.isMobileInstalledForResponsible"\n\t\t\t\t:contact="stages.responsible.contact"\n\t\t\t\t:editable="stages.responsible.editable"\n\t\t\t\t:hintTitle="stages.responsible.hintTitle"\n\t\t\t\t@on-responsible-changed="onResponsibleChanged"\n\t\t\t/>\n\t\t\t<product-block\n\t\t\t\tv-if="hasProducts"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.product.status"\n\t\t\t\t:title="stages.product.title"\n\t\t\t\t:hintTitle="stages.product.hintTitle"\n\t\t\t\t:additionalContainerClasses="{ \'salescenter-app-teminal-products-item\': true }"\n\t\t\t/>\n\t\t\t<amount-block\n\t\t\t\tv-else\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.product.status"\n\t\t\t\t:title="stages.product.title"\n\t\t\t\t:hintTitle="stages.product.hintTitle"\n\t\t\t/>\n\t\t\t<paysystem-block\n\t\t\t\tv-if="editable"\n\t\t\t\t@on-stage-tile-collection-slider-close="stageRefresh($event, \'PAY_SYSTEM\')"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.paysystem.status"\n\t\t\t\t:tiles="stages.paysystem.tiles"\n\t\t\t\t:installed="stages.paysystem.installed"\n\t\t\t\t:titleItems="stages.paysystem.titleItems"\n\t\t\t\t:initialCollapseState="stages.paysystem.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t<cashbox-block\n\t\t\t\tv-if="editable && hasStageCashBox"\n\t\t\t\t@on-stage-tile-collection-slider-close="stageRefresh($event, \'CASHBOX\')"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.cashbox.status"\n\t\t\t\t:tiles="stages.cashbox.tiles"\n\t\t\t\t:installed="stages.cashbox.installed"\n\t\t\t\t:titleItems="stages.cashbox.titleItems"\n\t\t\t\t:initialCollapseState="stages.cashbox.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t<automation-block\n\t\t\t\tv-if="editable && hasStageAutomation"\n\t\t\t\t:counter="counter++"\n\t\t\t\t:status="stages.automation.status"\n\t\t\t\t:stageOnOrderPaid="stages.automation.stageOnOrderPaid"\n\t\t\t\t:items="stages.automation.items"\n\t\t\t\t:initialCollapseState="stages.automation.initialCollapseState"\n\t\t\t\t@on-save-collapsed-option="saveCollapsedOption"\n\t\t\t/>\n\t\t\t<send-block\n\t\t\t\tv-if="editable"\n\t\t\t\t@on-submit="onSend"\n\t\t\t\t:buttonEnabled="sendAllowed"\n\t\t\t\t:buttonLabel="submitButtonLabel"\n\t\t\t/>\n\t\t\t<timeline-block\n\t\t\t\tv-if="hasStageTimeLine"\n\t\t\t\t:timelineItems="stages.timeline.items"\n\t\t\t/>\n\t\t</div>\n\t'};function Ft(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function Ut(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ft(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ft(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ht={mixins:[N,gt],data:function t(){var e;var n=true;if(this.$root.$app.options.mode===j.terminalPayment&&this.$root.$app.options.templateMode==="view"&&((e=this.$root.$app.options.payment)===null||e===void 0?void 0:e.PAID)==="N"){n=false}return{activeMenuItem:this.$root.$app.options.mode,isLoading:false,isPanelVisible:n,ModeDictionary:j}},components:{"deal-receiving-payment":At,"crm-entity-create-payment":kt,"deal-creating-shipment":wt,"deal-terminal-payment":Dt,start:ft},mounted:function t(){var e=this.$root.$app.options.terminalTour;if(e["step-1-shown"]!=="Y"&&e["step-2-shown"]!=="Y"&&this.activeMenuItem!==j.terminalPayment&&this.initialMode!==j.terminalPayment){w.Runtime.loadExtension("spotlight").then((function(t){var e=new BX.SpotLight({id:"terminal-tour-spotlight",targetElement:document.querySelector(".salescenter-menu-terminal-payment"),autoSave:true,targetVertex:"middle-center",zIndex:200,left:-40});e.show();e.container.style.pointerEvents="none";w.userOptions.save("salescenter.tour","crm-terminal-tour","step-1-shown","Y")}))}},methods:{reload:function t(e){if(this.isLoading||!this.editable){return}this.isLoading=true;this.activeMenuItem=e;this.$emit("on-reload",{context:this.$root.$app.options.context,orderId:this.$root.$app.orderId,ownerTypeId:this.$root.$app.options.ownerTypeId,ownerId:this.$root.$app.options.ownerId,templateMode:"create",mode:this.activeMenuItem,showModeList:this.$root.$app.options.showModeList,initialMode:this.$root.$app.options.initialMode})},onSuccessfullyConnected:function t(){this.reload(this.activeMenuItem)},onReload:function t(){this.reload(this.activeMenuItem)},sendPaymentDeliveryForm:function t(e){if(!this.isAllowedPaymentDeliverySubmitButton){return}if(this.$store.getters["orderCreation/isCompilationMode"]){this.$root.$app.sendCompilation(e.target)}else if(this.editable){this.$root.$app.sendPayment(e.target)}else{this.$root.$app.resendPayment(e.target)}},sendDeliveryForm:function t(e){if(!this.isAllowedDeliverySubmitButton){return}this.$root.$app.sendShipment(e.target)},sendTerminalPaymentForm:function t(e){if(!this.isAllowedTerminalPaymentSubmitButton){return}if(this.templateMode==="view"){this.$root.$app.updateTerminalPayment(e.target);return}this.$root.$app.sendTerminalPayment(e.target)},specifyCompanyContacts:function t(){BX.Salescenter.Manager.openSlider(this.$root.$app.options.urlSettingsCompanyContacts,{width:1200})},suggestScenario:function t(e){BX.Salescenter.Manager.openFeedbackPayOrderForm(e)},howItWorks:function t(e){if(this.mode===j.payment){BX.Salescenter.Manager.openHowPaySmartInvoiceWorks(e);return}if(this.mode===j.terminalPayment){BX.Salescenter.Manager.openHowTerminalWorks(e);return}BX.Salescenter.Manager.openHowPayDealWorks(e)},openIntegrationWindow:function t(e){BX.Salescenter.Manager.openIntegrationRequestForm(e)},freeMessages:function t(){var e=this.$root.$app.options.senders;var n=e.filter((function(t){return t.code===O.SenderConfig.BITRIX24}));if(n.length>0){var s=O.SenderConfig.openSliderFreeMessages(n[0].connectUrl);s().then()}},onResponsibleChanged:function t(e){var n=this.$refs["buttonsPanel"];n.classList.remove("salescenter-button-panel-hidden");var s=document.querySelector(".salescenter-app-pinner-anchor");s.classList.remove("salescenter-app-pinner-anchor-hidden")},openTerminalToolDisabledSlider:function t(){w.Runtime.loadExtension("ui.info-helper").then((function(){top.BX.UI.InfoHelper.show("limit_crm_terminal_off")}))},openSalescanterToolDisabledSlider:function t(){BX.loadExt("salescenter.tool-availability-manager").then((function(){BX.Salescenter.ToolAvailabilityManager.openSalescenterToolDisabledSlider()}))}},computed:Ut({mode:function t(){return this.$root.$app.options.mode},templateMode:function t(){return this.$root.$app.options.templateMode},initialMode:function t(){return this.$root.$app.options.initialMode},isAllowedFreeMessagesButton:function t(){var e=this.$root.$app.options.senders;var n=e.filter((function(t){return t.code===O.SenderConfig.BITRIX24}));if(n.length>0){return O.SenderConfig.needConfigure(n[0])}return false},isOnlyDeliveryItemVisible:function t(){return this.initialMode===j.delivery&&this.$root.$app.options.hasOwnProperty("deliveryList")&&this.$root.$app.options.deliveryList.hasOwnProperty("hasInstallable")&&this.$root.$app.options.deliveryList.hasInstallable},isTerminalItemVisible:function t(){return this.isPaymentItemVisible&&this.$root.$app.options.isTerminalAvailable},isTerminalToolEnabled:function t(){return this.$root.$app.options.isTerminalToolEnabled},isSalescenterToolEnabled:function t(){return this.$root.$app.options.isSalescenterToolEnabled},isPaymentItemVisible:function t(){return this.initialMode===j.payment||this.initialMode===j.paymentDelivery||this.initialMode===j.terminalPayment},isAllowedPaymentDeliverySubmitButton:function t(){var e=this;if(!this.$root.$app.hasClientContactInfo()){return false}var n=this.$root.$app.options.senders;var s=n.filter((function(t){return t.code===e.$root.$app.options.currentSenderCode&&t.isConnected}));if(s.length===0){return false}return this.$store.getters["orderCreation/isAllowedSubmit"]},isAllowedTerminalPaymentSubmitButton:function t(){return this.$store.getters["orderCreation/isAllowedSubmit"]||this.isTerminalViewModeSaveAllowed},isTerminalViewModeSaveAllowed:function t(){var e;return this.templateMode==="view"&&((e=this.$root.$app.options.payment)===null||e===void 0?void 0:e.PAID)==="N"},isAllowedDeliverySubmitButton:function t(){var e=this.$store.getters["orderCreation/getDeliveryId"];if(!e){return false}if(!this.$store.getters["orderCreation/isAllowedSubmit"]){return false}return e!=this.$root.$app.options.emptyDeliveryServiceId},isSuggestScenarioMenuItemVisible:function t(){return this.$root.$app.options.isBitrix24},isRequestIntegrationMenuItemVisible:function t(){return this.$root.$app.options.isIntegrationButtonVisible},isModeListVisible:function t(){var e;return(e=this.$root.$app.options.showModeList)!==null&&e!==void 0?e:true},needShowStoreConnection:function t(){return!this.isOrderPublicUrlAvailable&&this.mode!==j.delivery},isSidebarEnabled:function t(){return true},sendPaymentDeliveryFormButtonText:function t(){return this.editable?w.Loc.getMessage("SALESCENTER_SEND"):w.Loc.getMessage("SALESCENTER_RESEND")},title:function t(){return this.$root.$app.options.title},paymentDeliveryFormSubmitButtonClass:function t(){return{"ui-btn-disabled":!this.isAllowedPaymentDeliverySubmitButton}},deliveryFormSubmitButtonClass:function t(){return{"ui-btn-disabled":!this.isAllowedDeliverySubmitButton}},terminalPaymentFormSubmitButtonClass:function t(){return{"ui-btn-disabled":!this.isAllowedTerminalPaymentSubmitButton}},paymentMenuItemClass:function t(){return{"salescenter-app-sidebar-menu-active":this.activeMenuItem===j.payment}},paymentTerminalMenuItemClass:function t(){return{"salescenter-app-sidebar-menu-active":this.activeMenuItem===j.terminalPayment}},paymentDeliveryMenuItemClass:function t(){return{"salescenter-app-sidebar-menu-active":this.activeMenuItem===j.paymentDelivery}},deliveryMenuItemClass:function t(){return{"salescenter-app-sidebar-menu-active":this.activeMenuItem===j.delivery}}},k.Vuex.mapState({application:function t(e){return e.application},order:function t(e){return e.orderCreation}})),template:'\n\t\t<div>\n\t\t\t<div\n\t\t\t\t:class="wrapperClass"\n\t\t\t\t:style="wrapperStyle"\n\t\t\t\tclass="salescenter-app-wrapper"\n\t\t\t>\n\t\t\t\t<div class="ui-sidepanel-sidebar salescenter-app-sidebar" v-if="isSidebarEnabled">\n\t\t\t\t\t<ul class="ui-sidepanel-menu">\n\t\t\t\t\t\t<template v-if="templateMode === \'view\'">\n\t\t\t\t\t\t\t<li class="ui-sidepanel-menu-item salescenter-app-sidebar-menu-active">\n\t\t\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">{{title}}</div>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else-if="isModeListVisible">\n\t\t\t\t\t\t\t<template v-if="isOnlyDeliveryItemVisible">\n\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\t:class="deliveryMenuItemClass"\n\t\t\t\t\t\t\t\t\tclass="ui-sidepanel-menu-item"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">\n\t\t\t\t\t\t\t\t\t\t\t'.concat(w.Loc.getMessage("SALESCENTER_LEFT_CREATE_SHIPMENT_MSGVER_1"),'\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\tv-if="isPaymentItemVisible"\n\t\t\t\t\t\t\t\t\t@click="isSalescenterToolEnabled ? reload(ModeDictionary.payment) : openSalescanterToolDisabledSlider()"\n\t\t\t\t\t\t\t\t\t:class="paymentMenuItemClass"\n\t\t\t\t\t\t\t\t\tclass="ui-sidepanel-menu-item"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">\n\t\t\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_LEFT_TAKE_PAYMENT"),'\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\n\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\tv-if="isTerminalItemVisible"\n\t\t\t\t\t\t\t\t\t@click="isTerminalToolEnabled ? reload(ModeDictionary.terminalPayment) : openTerminalToolDisabledSlider()"\n\t\t\t\t\t\t\t\t\t:class="paymentTerminalMenuItemClass"\n\t\t\t\t\t\t\t\t\tclass="ui-sidepanel-menu-item"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<a class="ui-sidepanel-menu-link salescenter-menu-terminal-payment">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">\n\t\t\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_LEFT_TERMINAL_PAYMENT"),'\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\n\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\tv-if="isPaymentItemVisible"\n\t\t\t\t\t\t\t\t\t@click="isSalescenterToolEnabled ? reload(ModeDictionary.paymentDelivery) : openSalescanterToolDisabledSlider()"\n\t\t\t\t\t\t\t\t\t:class="paymentDeliveryMenuItemClass"\n\t\t\t\t\t\t\t\t\tclass="ui-sidepanel-menu-item"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<a class="ui-sidepanel-menu-link">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">\n\t\t\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_LEFT_TAKE_PAYMENT_AND_CREATE_SHIPMENT"),'\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</template>\n\t\n\t\t\t\t\t\t<li class="ui-sidepanel-menu-item ui-sidepanel-menu-item-sm ui-sidepanel-menu-item-separate">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t@click="specifyCompanyContacts"\n\t\t\t\t\t\t\t\tclass="ui-sidepanel-menu-link"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">\n\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_LEFT_PAYMENT_COMPANY_CONTACTS"),'\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li\n\t\t\t\t\t\t\tv-if="isSuggestScenarioMenuItemVisible"\n\t\t\t\t\t\t\tclass="ui-sidepanel-menu-item ui-sidepanel-menu-item-sm"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t@click="suggestScenario($event)"\n\t\t\t\t\t\t\t\tclass="ui-sidepanel-menu-link"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">\n\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_LEFT_PAYMENT_OFFER_SCRIPT"),'\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="ui-sidepanel-menu-item ui-sidepanel-menu-item-sm">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t@click="howItWorks($event)"\n\t\t\t\t\t\t\t\tclass="ui-sidepanel-menu-link"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">\n\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_LEFT_PAYMENT_HOW_WORKS"),'\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li\n\t\t\t\t\t\t\tv-if="isAllowedFreeMessagesButton"\n\t\t\t\t\t\t\tclass="ui-sidepanel-menu-item ui-sidepanel-menu-item-sm"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t@click="freeMessages($event)"\n\t\t\t\t\t\t\t\tclass="ui-sidepanel-menu-link"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text">\n\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_LEFT_PAYMENT_FREE_MESSAGES"),'\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li\n\t\t\t\t\t\t\tv-if="isRequestIntegrationMenuItemVisible"\n\t\t\t\t\t\t\tclass="ui-sidepanel-menu-item ui-sidepanel-menu-item-sm">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t@click="openIntegrationWindow($event)"\n\t\t\t\t\t\t\t\tclass="ui-sidepanel-menu-link"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class="ui-sidepanel-menu-link-text"\n\t\t\t\t\t\t\t\t\t data-manager-openIntegrationRequestForm-params="sender_page:deal"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_LEFT_PAYMENT_INTEGRATION_MSGVER_2"),'\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t\t<div class="salescenter-app-right-side">\n\t\t\t\t\t<start\n\t\t\t\t\t\tv-if="needShowStoreConnection"\n\t\t\t\t\t\t@on-successfully-connected="onSuccessfullyConnected"\n\t\t\t\t\t>\n\t\t\t\t\t</start>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<deal-receiving-payment\n\t\t\t\t\t\t\tv-if="mode === ModeDictionary.paymentDelivery"\n\t\t\t\t\t\t\t@stage-block-on-reload="onReload"\n\t\t\t\t\t\t\t@stage-block-send-on-send="sendPaymentDeliveryForm($event)"\n\t\t\t\t\t\t\t:sendAllowed="isAllowedPaymentDeliverySubmitButton"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<deal-creating-shipment\n\t\t\t\t\t\t\tv-else-if="mode === ModeDictionary.delivery"\n\t\t\t\t\t\t\t@stage-block-send-on-send="sendDeliveryForm($event)"\n\t\t\t\t\t\t\t:sendAllowed="isAllowedDeliverySubmitButton"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<crm-entity-create-payment\n\t\t\t\t\t\t\tv-if="mode === ModeDictionary.payment"\n\t\t\t\t\t\t\t@stage-block-send-on-send="sendPaymentDeliveryForm($event)"\n\t\t\t\t\t\t\t:sendAllowed="isAllowedPaymentDeliverySubmitButton"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<deal-terminal-payment\n\t\t\t\t\t\t\tv-if="mode === ModeDictionary.terminalPayment"\n\t\t\t\t\t\t\t@stage-block-send-on-send="sendTerminalPaymentForm($event)"\n\t\t\t\t\t\t\t@on-responsible-changed="onResponsibleChanged($event)"\n\t\t\t\t\t\t\t:sendAllowed="isAllowedTerminalPaymentSubmitButton"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t\t<template v-if="!(mode === \'terminal_payment\' && templateMode === \'view\' && !isTerminalViewModeSaveAllowed)">\n\t\t\t\t\t<div class="ui-button-panel-wrapper salescenter-button-panel" ref="buttonsPanel" :class="{ \'salescenter-button-panel-hidden\': !isPanelVisible }">\n\t\t\t\t\t\t<div class="ui-button-panel">\n\t\t\t\t\t\t\t<template v-if="mode === ModeDictionary.paymentDelivery || mode === ModeDictionary.payment">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t@click="sendPaymentDeliveryForm($event)"\n\t\t\t\t\t\t\t\t\t:class="paymentDeliveryFormSubmitButtonClass"\n\t\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-success"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{sendPaymentDeliveryFormButtonText}}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t@click="close"\n\t\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-link"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_CANCEL"),'\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else-if="mode === \'terminal_payment\'">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tv-if="editable"\n\t\t\t\t\t\t\t\t\t@click="sendTerminalPaymentForm($event)"\n\t\t\t\t\t\t\t\t\t:class="terminalPaymentFormSubmitButtonClass"\n\t\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-success"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_CREATE_TERMINAL_PAYMENT"),'\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tv-if="isTerminalViewModeSaveAllowed"\n\t\t\t\t\t\t\t\t\t@click="sendTerminalPaymentForm($event)"\n\t\t\t\t\t\t\t\t\t:class="terminalPaymentFormSubmitButtonClass"\n\t\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-success"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_SAVE"),'\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t@click="close"\n\t\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-link"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_CANCEL"),'\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else-if="mode === ModeDictionary.delivery">\n\t\t\t\t\t\t\t\t<template v-if="editable">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t@click="sendDeliveryForm($event)"\n\t\t\t\t\t\t\t\t\t\t:class="deliveryFormSubmitButtonClass"\n\t\t\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-success"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_CREATE_SHIPMENT"),'\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t@click="close"\n\t\t\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-link"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t').concat(w.Loc.getMessage("SALESCENTER_CANCEL"),'\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="this.order.errors.length > 0" ref="errorBlock"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<div class="salescenter-app-pinner-anchor" :class="{ \'salescenter-app-pinner-anchor-hidden\': !isPanelVisible }"></div>\n\t\t</div>\n\t')};var jt=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getName",value:function t(){return"application"}},{key:"getState",value:function t(){return{pages:[]}}},{key:"getGetters",value:function t(){return{getPages:function t(e){return function(){return e.pages}}}}},{key:"getMutations",value:function t(){var e=this;return{setPages:function t(n,s){if(babelHelpers["typeof"](s.pages)==="object"){n.pages=s.pages;e.saveState(n)}},removePage:function t(n,s){if(babelHelpers["typeof"](s.page)==="object"){n.pages=n.pages.filter((function(t){return!(s.page.id&&s.page.id>0&&t.id===s.page.id||s.page.landingId&&s.page.landingId>0&&t.landingId===s.page.landingId)}));e.saveState(n)}},addPage:function t(n,s){if(babelHelpers["typeof"](s.page)==="object"){n.pages.push(s.page);e.saveState(n)}}}}}]);return e}(k.VuexBuilderModel);var Xt=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getName",value:function t(){return"documentSelector"}},{key:"getActions",value:function t(){return{addDocument:function t(e,n){var s=e.commit,i=e.dispatch;var o=n.document;s("addDocument",{document:o});i("setBoundDocumentId",{boundDocumentId:o.id})},setBoundDocumentId:function t(e,n){var s=e.state,i=e.commit;var o=n.boundDocumentId;if(s.paymentId>0){A.rest.callMethod("crm.documentgenerator.document.bindToPayment",{id:o,paymentId:s.paymentId}).then((function(){i("setBoundDocumentId",{boundDocumentId:o})}))["catch"]((function(t){console.error(t)}))}else{i("setBoundDocumentId",{boundDocumentId:o})}},loadTemplates:function t(e){var n=e.state,s=e.commit;if(Number(n.entityTypeId)<=0||Number(n.entityId)<=0){s("setTemplates",{templates:[]});return}A.rest.callMethod("crm.documentgenerator.template.listForItem",{entityTypeId:n.entityTypeId,entityId:n.entityId}).then((function(t){if(t.answer.result.templates){s("setTemplates",{templates:t.answer.result.templates})}}))["catch"]((function(t){console.error(t)}))}}}},{key:"getState",value:function t(){return{entityTypeId:null,entityId:null,paymentId:null,documents:[],templates:[],boundDocumentId:null,selectedTemplateId:null}}},{key:"getGetters",value:function t(){return{getTemplates:function t(e){return e.templates},getDocuments:function t(e){return e.documents},getBoundDocumentId:function t(e){return e.boundDocumentId},getSelectedTemplateId:function t(e){return e.selectedTemplateId}}}},{key:"getMutations",value:function t(){return{fillState:function t(e,n){e.entityTypeId=n.entityTypeId;e.entityId=n.entityId;e.paymentId=n.paymentId;e.documents=n.documents;e.templates=n.templates;e.boundDocumentId=n.boundDocumentId;e.selectedTemplateId=n.selectedTemplateId},setTemplates:function t(e,n){if(babelHelpers["typeof"](n.templates)==="object"){e.templates=n.templates}},setBoundDocumentId:function t(e,n){if(typeof n.boundDocumentId==="number"){e.boundDocumentId=n.boundDocumentId}},setSelectedTemplateId:function t(e,n){if(typeof n.selectedTemplateId==="number"){e.selectedTemplateId=n.selectedTemplateId;e.boundDocumentId=null}},addDocument:function t(e,n){if(babelHelpers["typeof"](n.document)==="object"){var s=n.document;if(!s.id){return}var i=e.documents||[];var o=false;for(var a in i){if(i[a].id===s.id){i[a]=s;o=true;break}}if(!o){i.unshift(s)}e.documents=i}}}}}]);return e}(k.VuexBuilderModel);var Vt=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getName",value:function t(){return"orderCreation"}},{key:"getState",value:function t(){return{currency:"",processingId:null,basket:[],basketVersion:0,propertyValues:[],deliveryExtraServicesValues:[],expectedDelivery:null,deliveryResponsibleId:null,personTypeId:null,deliveryId:null,delivery:null,isEnabledSubmit:false,isCompilationMode:false,errors:[],total:{sum:null,discount:null,result:null},availablePaySystemsIds:[],paymentResponsibleId:null,isMobileInstalledForResponsible:false,responsiblePhoneNumbers:[]}}},{key:"getActions",value:function t(){return{resetBasket:function t(e){var n=e.commit;n("clearBasket")},setCurrency:function t(e,n){var s=e.commit;var i=n||"";s("setCurrency",i)},setDeliveryId:function t(e,n){var s=e.commit;s("setDeliveryId",n)},setDelivery:function t(e,n){var s=e.commit;s("setDelivery",n)},setPropertyValues:function t(e,n){var s=e.commit;s("setPropertyValues",n)},setDeliveryExtraServicesValues:function t(e,n){var s=e.commit;s("setDeliveryExtraServicesValues",n)},setExpectedDelivery:function t(e,n){var s=e.commit;s("setExpectedDelivery",n)},setDeliveryResponsibleId:function t(e,n){var s=e.commit;s("setDeliveryResponsibleId",n)},setPaymentResponsibleId:function t(e,n){var s=e.commit;s("setPaymentResponsibleId",n)},setMobileInstalledForResponsible:function t(e,n){var s=e.commit;s("setMobileInstalledForResponsible",n)},setResponsiblePhoneNumbers:function t(e,n){var s=e.commit;s("setResponsiblePhoneNumbers",n)},setPersonTypeId:function t(e,n){var s=e.commit;s("setPersonTypeId",n)},setAvailablePaySystemsIds:function t(e,n){var s=e.commit;s("setAvailablePaySystemsIds",n)}}}},{key:"getGetters",value:function t(){return{getBasket:function t(e){return function(t){return e.basket}},isAllowedSubmit:function t(e){return e.isEnabledSubmit},isCompilationMode:function t(e){return e.isCompilationMode},getTotal:function t(e){return e.total},getDelivery:function t(e){return e.delivery},getDeliveryId:function t(e){return e.deliveryId},getPropertyValues:function t(e){return e.propertyValues},getDeliveryExtraServicesValues:function t(e){return e.deliveryExtraServicesValues},getExpectedDelivery:function t(e){return e.expectedDelivery},getDeliveryResponsibleId:function t(e){return e.deliveryResponsibleId},getPaymentResponsibleId:function t(e){return e.paymentResponsibleId},isMobileInstalledForResponsible:function t(e){return e.isMobileInstalledForResponsible},getResponsiblePhoneNumbers:function t(e){return e.responsiblePhoneNumbers},getPersonTypeId:function t(e){return e.personTypeId},getAvailablePaySystemsIds:function t(e){return e.availablePaySystemsIds}}}},{key:"getMutations",value:function t(){return{setBasket:function t(e,n){e.basket=n},setTotal:function t(e,n){e.total=Object.assign(e.total,n)},clearBasket:function t(e,n){e.basket=[];e.basketVersion++},setErrors:function t(e,n){e.errors=n},setDeliveryId:function t(e,n){e.deliveryId=n},setDelivery:function t(e,n){e.delivery=n},setPropertyValues:function t(e,n){e.propertyValues=n},setDeliveryExtraServicesValues:function t(e,n){e.deliveryExtraServicesValues=n},setExpectedDelivery:function t(e,n){e.expectedDelivery=n},setDeliveryResponsibleId:function t(e,n){e.deliveryResponsibleId=n},setPaymentResponsibleId:function t(e,n){e.paymentResponsibleId=n},setMobileInstalledForResponsible:function t(e,n){e.isMobileInstalledForResponsible=n},setResponsiblePhoneNumbers:function t(e,n){e.responsiblePhoneNumbers=n},clearErrors:function t(e){e.errors=[]},setProcessingId:function t(e,n){e.processingId=n},setCurrency:function t(e,n){e.currency=n},setPersonTypeId:function t(e,n){e.personTypeId=n},setAvailablePaySystemsIds:function t(e,n){e.availablePaySystemsIds=n},enableSubmit:function t(e){e.isEnabledSubmit=true},disableSubmit:function t(e){e.isEnabledSubmit=false},enableCompilationMode:function t(e){e.isCompilationMode=true},disableCompilationMode:function t(e){e.isCompilationMode=false}}}}]);return e}(k.VuexBuilderModel);var qt;var Yt=function(){function t(e){var n,s,i,o;babelHelpers.classCallCheck(this,t);this.initSenders(e.sendersConfig);this.phoneNumbers=e.phoneNumbers;this.userId=e.userId;this.root=e.root;this.selectedPhoneNumber=(n=(s=this.phoneNumbers)===null||s===void 0?void 0:s[0])!==null&&n!==void 0?n:null;this.selectedSender=(i=(o=this.senders)===null||o===void 0?void 0:o[0])!==null&&i!==void 0?i:null;this.mainPopup=null;this.sendButton=null;this.sendersMenu=null;this.phoneMenu=null}babelHelpers.createClass(t,[{key:"initSenders",value:function t(e){var n;this.sendersConfig=e.find((function(t){return t.code==="sms_provider"}));this.senders=(n=this.sendersConfig)===null||n===void 0?void 0:n.smsSenders}},{key:"render",value:function t(){var e=this;var n=this.getPopupContent();var s=new R.Button({id:"copy-install-link",color:R.Button.Color.LINK,round:true,icon:R.ButtonIcon.COPY,text:w.Loc.getMessage("SALESCENTER_TERMINAL_MOBILE_POPUP_BTN_LINK")});this.sendButton=new R.Button({state:this.selectedPhoneNumber&&this.selectedSender?null:R.ButtonState.DISABLED,color:R.Button.Color.PRIMARY,round:true,text:w.Loc.getMessage("SALESCENTER_TERMINAL_MOBILE_POPUP_BTN_SEND"),onclick:function t(){e.sendButton.setClocking();e.sendSms()}});this.mainPopup=new x.Popup({className:"salescenter-popup-mobile",overlay:true,content:n,closeIcon:true,maxWidth:666,buttons:[this.sendButton,s],events:{onClose:function t(){e.root.closeApplication()}}});this.mainPopup.show();this.bindCopyLink(s);this.bindSelectors()}},{key:"sendSms",value:function t(){var e=this;w.ajax.runAction("salescenter.terminalResponsible.sendLinkToMobileApp",{data:{userId:this.userId,phone:this.selectedPhoneNumber,senderId:this.selectedSender.id,entity:{entityTypeId:this.root.ownerTypeId,entityId:this.root.ownerId}}}).then((function(t){e.mainPopup.close();e.root.closeApplication()}))}},{key:"bindCopyLink",value:function t(e){BX.clipboard.bindCopyClick(e.getContainer(),{text:this.root.options.mobileAppLink})}},{key:"bindSelectors",value:function t(){this.bindSendersSelector();this.bindPhoneSelector()}},{key:"bindSendersSelector",value:function t(){var e=this;var n=document.getElementById("senders-selector");if(this.selectedSender){w.Event.bind(n,"click",(function(){var t=[];e.senders.forEach((function(s){t.push({text:w.Text.encode(s.name),onclick:function t(){var i;e.selectedSender=s;n.firstChild.innerText=w.Text.encode(e.selectedSender.name);(i=e.sendersMenu)===null||i===void 0?void 0:i.close()}})}));BX.PopupMenu.show("sender-menu",n,t,{offsetTop:0,offsetLeft:36,angle:{position:"top",offset:0}});e.sendersMenu=BX.PopupMenu.getCurrentMenu()}))}else{w.Event.bind(n,"click",(function(){BX.SidePanel.Instance.open(e.sendersConfig.connectUrl,{events:{onClose:function t(){e.refresh()}}})}))}}},{key:"bindPhoneSelector",value:function t(){var e=this;var n=document.getElementById("phone-selector");if(this.selectedPhoneNumber){w.Event.bind(n,"click",(function(){var t=[];e.phoneNumbers.forEach((function(s){t.push({text:w.Text.encode(s),onclick:function t(){var i;e.selectedPhoneNumber=s;n.firstChild.innerText=w.Text.encode(e.selectedPhoneNumber);(i=e.phoneMenu)===null||i===void 0?void 0:i.close()}})}));BX.PopupMenu.show("phone-menu",n,t,{offsetTop:0,offsetLeft:36,angle:{position:"top",offset:0}});e.phoneMenu=BX.PopupMenu.getCurrentMenu()}))}else{w.Event.bind(n,"click",(function(){BX.SidePanel.Instance.open("/company/personal/user/".concat(e.userId,"/"),{events:{onClose:function t(){e.refresh()}}})}))}}},{key:"refresh",value:function t(){var e=this;w.ajax.runAction("salescenter.terminalResponsible.refreshDataForSendingLink",{data:{userId:this.userId}}).then((function(t){var n,s,i,o;e.initSenders(t.data.senders);e.phoneNumbers=t.data.phones;e.selectedPhoneNumber=(n=(s=e.phoneNumbers)===null||s===void 0?void 0:s[0])!==null&&n!==void 0?n:null;e.selectedSender=(i=(o=e.senders)===null||o===void 0?void 0:o[0])!==null&&i!==void 0?i:null;e.updateSendButtonState();e.updateContent()}))}},{key:"updateSendButtonState",value:function t(){this.sendButton.setDisabled(!Boolean(this.selectedPhoneNumber&&this.selectedSender))}},{key:"updateContent",value:function t(){this.mainPopup.setContent(this.getPopupContent());this.bindSelectors()}},{key:"getPopupContent",value:function t(){var e="";if(this.selectedSender){e=w.Loc.getMessage("SALESCENTER_TERMINAL_MOBILE_POPUP_SENDER_AND_PHONE",{"[main]":'<div class="salescenter-popup-mobile__service">',"[/main]":"</div>","[number]":'<div class="salescenter-popup-mobile__service-box"><div class="salescenter-popup-mobile__service-name">',"#NUMBER#":'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="salescenter-popup-mobile__service-inline" id="phone-selector">\n\t\t\t\t\t\t\t<div class="salescenter-popup-mobile__service-value">\n\t\t\t\t\t\t\t\t'.concat(this.selectedPhoneNumber?w.Text.encode(this.selectedPhoneNumber):w.Loc.getMessage("SALESCENTER_TERMINAL_MOBILE_POPUP_ADD_PHONE"),"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t"),"[/number]":"\n\t\t\t\t\t\t\t".concat(this.selectedPhoneNumber?'<div class="ui-icon-set --chevron-down"></div>':"","\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t"),"[service]":'<div class="salescenter-popup-mobile__service-box"><div class="salescenter-popup-mobile__service-name">',"#SERVICE#":'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="salescenter-popup-mobile__service-inline" id="senders-selector">\n\t\t\t\t\t\t\t<div class="salescenter-popup-mobile__service-value">'.concat(w.Text.encode(this.selectedSender.name),"</div>\n\t\t\t\t\t"),"[/service]":'\n\t\t\t\t\t\t\t<div class="ui-icon-set --chevron-down"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'})}else{e=w.Loc.getMessage("SALESCENTER_TERMINAL_MOBILE_POPUP_SENDER_AND_PHONE_NO_SENDER",{"[main]":'<div class="salescenter-popup-mobile__service">',"[/main]":"</div>","[number]":'<div class="salescenter-popup-mobile__service-box"><div class="salescenter-popup-mobile__service-name">',"#NUMBER#":'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="salescenter-popup-mobile__service-inline" id="phone-selector">\n\t\t\t\t\t\t\t<div class="salescenter-popup-mobile__service-value">\n\t\t\t\t\t\t\t\t'.concat(this.selectedPhoneNumber?w.Text.encode(this.selectedPhoneNumber):w.Loc.getMessage("SALESCENTER_TERMINAL_MOBILE_POPUP_ADD_PHONE"),"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t"),"[/number]":"\n\t\t\t\t\t\t\t".concat(this.selectedPhoneNumber?'<div class="ui-icon-set --chevron-down"></div>':"","\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t"),"[service]":'<div class="salescenter-popup-mobile__service-box"><div class="salescenter-popup-mobile__service-inline" id="senders-selector"><div class="salescenter-popup-mobile__service-value">',"[/service]":'\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-icon-set --chevron-down"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'})}return w.Tag.render(qt||(qt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="salescenter-popup-mobile__wrap">\n\t\t\t\t<div class="salescenter-popup-mobile__icon-box">\n\t\t\t\t\t<div class="salescenter-popup-mobile__icon"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="salescenter-popup-mobile__content">\n\t\t\t\t\t<div class="salescenter-popup-mobile__title">',"</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),w.Loc.getMessage("SALESCENTER_TERMINAL_MOBILE_POPUP_TITLE"),e)}}]);return t}();var Wt,Kt,Gt,zt;var Qt=new Map;var Zt=function(){babelHelpers.createClass(t,null,[{key:"getByDialogId",value:function t(e){return Qt.get(e)||null}}]);function t(){var e=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{dialogId:null,sessionId:null,lineId:null,orderAddPullTag:null,landingPublicationPullTag:null,landingUnPublicationPullTag:null,isFrame:true,isOrderPublicUrlAvailable:false,isCatalogAvailable:false,isOrderPublicUrlExists:false,isWithOrdersMode:true,compilation:null,documentSelector:DocumentSelectorParams|null};babelHelpers.classCallCheck(this,t);this.slider=BX.SidePanel.Instance.getTopSlider();this.dialogId=n.dialogId;this.sessionId=parseInt(n.sessionId);this.lineId=parseInt(n.lineId);this.orderAddPullTag=n.orderAddPullTag;this.landingPublicationPullTag=n.landingPublicationPullTag;this.landingUnPublicationPullTag=n.landingUnPublicationPullTag;this.paySystemList=n.paySystemList;this.cashboxList=n.cashboxList;this.options=n;this.isProgress=false;this.fillPagesTimeout=false;this.disableSendButton=false;this.context="";this.fillPagesQueue=[];this.ownerTypeId="";this.ownerId="";this.orderId=parseInt(n.orderId);this.stageOnOrderPaid=null;this.stageOnDeliveryFinished=null;this.sendingMethod="";this.sendingMethodDesc={};this.orderPublicUrl="";this.fileControl=n.fileControl;this.currencyCode=n.currencyCode;this.compilation=null;this.newCompilationId=null;this.assignedById=n.assignedById;if(w.Type.isString(n.stageOnOrderPaid)){this.stageOnOrderPaid=n.stageOnOrderPaid}if(w.Type.isString(n.stageOnDeliveryFinished)){this.stageOnDeliveryFinished=n.stageOnDeliveryFinished}if(w.Type.isBoolean(n.isFrame)){this.isFrame=n.isFrame}else{this.isFrame=true}if(w.Type.isBoolean(n.isOrderPublicUrlAvailable)){this.isOrderPublicUrlAvailable=n.isOrderPublicUrlAvailable}else{this.isOrderPublicUrlAvailable=false}if(w.Type.isBoolean(n.isOrderPublicUrlExists)){this.isOrderPublicUrlExists=n.isOrderPublicUrlExists}else{this.isOrderPublicUrlExists=false}if(w.Type.isString(n.orderPublicUrl)){this.orderPublicUrl=n.orderPublicUrl}if(w.Type.isBoolean(n.isCatalogAvailable)){this.isCatalogAvailable=n.isCatalogAvailable}else{this.isCatalogAvailable=false}if(w.Type.isBoolean(n.isWithOrdersMode)){this.isWithOrdersMode=n.isWithOrdersMode}else{this.isWithOrdersMode=false}if(w.Type.isBoolean(n.disableSendButton)){this.disableSendButton=n.disableSendButton}if(n.ownerTypeId){this.ownerTypeId=n.ownerTypeId}if(n.ownerId){this.ownerId=n.ownerId}if(w.Type.isString(n.context)&&n.context.length>0){this.context=n.context}else if(this.sessionId&&this.dialogId){this.context=st.imOpenlines}if(w.Type.isBoolean(n.isPaymentsLimitReached)){this.isPaymentsLimitReached=n.isPaymentsLimitReached}else{this.isPaymentsLimitReached=false}if(!w.Type.isUndefined(n.sendingMethod)){this.sendingMethod=n.sendingMethod}if(!w.Type.isUndefined(n.sendingMethodDesc)){this.sendingMethodDesc=this.options.sendingMethodDesc}if(w.Type.isObject(n.compilation)){this.compilation=n.compilation}this.isPaymentCreationAvailable=this.sessionId>0&&this.dialogId.length>0||this.ownerTypeId&&this.ownerId;this.connector=w.Type.isString(n.connector)?n.connector:"";this.isAllowedFacebookRegion=w.Type.isBoolean(n.isAllowedFacebookRegion)?n.isAllowedFacebookRegion:false;if(w.Type.isPlainObject(n.documentSelector)){this.documentSelector=n.documentSelector;this.documentSelector.paymentId=this.options.paymentId}w.Event.ready((function(){e.pull=BX.PULL;e.initPull();e.isSiteExists=T.Manager.isSiteExists}));t.initStore().then((function(t){return e.initTemplate(t)}))["catch"]((function(e){return t.showError(e)}));r.EventEmitter.subscribe(window.parent,"onSendCompilationChatButtonClick",this.sendCompilation.bind(this));Qt.set(this.dialogId,this)}babelHelpers.createClass(t,[{key:"initPull",value:function t(){var e=this;if(this.pull){if(w.Type.isString(this.orderAddPullTag)){this.pull.subscribe({moduleId:"salescenter",command:this.orderAddPullTag,callback:function t(n){if(parseInt(n.sessionId)===e.sessionId&&n.orderId>0){T.Manager.showOrdersListAfterCreate(n.orderId)}}})}if(w.Type.isString(this.landingPublicationPullTag)){this.pull.subscribe({moduleId:"salescenter",command:this.landingPublicationPullTag,callback:function t(n){if(parseInt(n.landingId)>0){e.fillPages()}if(n.hasOwnProperty("isOrderPublicUrlAvailable")&&w.Type.isBoolean(n.isOrderPublicUrlAvailable)){e.isOrderPublicUrlAvailable=n.isOrderPublicUrlAvailable;e.isOrderPublicUrlExists=true}}})}if(w.Type.isString(this.landingUnPublicationPullTag)){this.pull.subscribe({moduleId:"salescenter",command:this.landingUnPublicationPullTag,callback:function t(n){if(parseInt(n.landingId)>0){e.fillPages()}if(n.hasOwnProperty("isOrderPublicUrlAvailable")&&w.Type.isBoolean(n.isOrderPublicUrlAvailable)){e.isOrderPublicUrlAvailable=n.isOrderPublicUrlAvailable;e.isOrderPublicUrlExists=true}}})}}}},{key:"initTemplate",value:function t(e){var n=this;return new Promise((function(t){var s=n;n.store=e.store;n.templateEngine=l.Vue.create({el:document.getElementById("salescenter-app-root"),components:{chat:Ct,deal:Ht},template:n.isPaymentMode()?'<deal :key="componentKey" @on-reload="reload"/>':'<chat :key="componentKey" @on-reload="reload"/>',store:n.store,created:function t(){this.$app=s;this.$nodes={footer:document.getElementById("footer"),leftPanel:document.getElementById("left-panel"),title:document.getElementById("pagetitle"),paymentsLimit:document.getElementById("salescenter-payment-limit-container"),orderSelector:document.getElementById("salescenter-app-order-selector")};this.initOrderSelector();if(s.documentSelector){this.$store.commit("documentSelector/fillState",s.documentSelector)}if(this.$app.options.showCompilationModeSwitcher==="N"){this.$store.commit("orderCreation/enableCompilationMode")}},mounted:function e(){t()},methods:{reload:function t(e){this.$root.$app.getLoader().show(document.body);w.ajax.runComponentAction("bitrix:salescenter.app","getComponentResult",{mode:"class",data:{arParams:e}}).then(function(t){if(t.data){this.$root.$app.options=t.data;this.$root.$app.orderId=this.$root.$app.options.orderId;this.componentKey+=1;this.$root.$app.getLoader().hide()}}.bind(this))},initOrderSelector:function t(){var e=this;try{if(this.$app.options.orderList.length<2||this.$app.options.templateMode!=="create"||!this.$app.options.orderId){return}var n=this.$nodes.orderSelector.querySelector(".salescenter-app-order-selector-text");if(!n){return}n.innerText=w.Loc.getMessage("SALESCENTER_ORDER_SELECTOR_ORDER_NUM").replace("#ORDER_ID#",this.$app.options.orderId);n.setAttribute("data-hint",w.Loc.getMessage("SALESCENTER_ORDER_SELECTOR_TOOLTIP"));var s;var i=[];this.$app.options.orderList.map((function(t){var o=w.Loc.getMessage("SALESCENTER_ORDER_SELECTOR_ORDER_NUM").replace("#ORDER_ID#",t);i.push({text:o,onclick:function i(a){s.close();n.innerText=o;e.reload({context:e.$app.options.context,orderId:t,ownerTypeId:e.$app.options.ownerTypeId,ownerId:e.$app.options.ownerId,templateMode:e.$app.options.templateMode,mode:e.$app.options.mode,initialMode:e.$app.options.initialMode})}})}));s=x.MenuManager.create({id:"deal-order-selector",bindElement:n,items:i});this.$nodes.orderSelector.classList.remove("is-hidden");this.$nodes.orderSelector.addEventListener("click",(function(t){t.preventDefault();s.show();BX.UI.Hint.hide()}));BX.UI.Hint.init(this.$nodes.orderSelector)}catch(t){}}},data:function t(){return{componentKey:0}}})}))}},{key:"closeApplication",value:function t(){if(this.slider){this.slider.close()}}},{key:"fillPages",value:function t(){var e=this;return new Promise((function(t){if(e.isProgress){e.fillPagesQueue.push(t)}else{if(e.fillPagesTimeout){clearTimeout(e.fillPagesTimeout)}e.fillPagesTimeout=setTimeout((function(){e.startProgress();A.rest.callMethod("salescenter.page.list",{}).then((function(n){e.store.commit("application/setPages",{pages:n.answer.result.pages});e.stopProgress();t();e.fillPagesQueue.forEach((function(t){t()}));e.fillPagesQueue=[]}))}),100)}}))}},{key:"getLoader",value:function t(){if(!this.loader){this.loader=new n.Loader({size:200,mode:"custom"})}return this.loader}},{key:"showLoader",value:function t(){if(this.templateEngine){this.getLoader().show(this.templateEngine.$el)}}},{key:"hideLoader",value:function t(){this.getLoader().hide()}},{key:"startProgress",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.isProgress=true;this.templateEngine.$emit("on-start-progress");this.showLoader();if(w.Type.isDomNode(e)){e.classList.add("ui-btn-wait")}}},{key:"stopProgress",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.isProgress=false;this.templateEngine.$emit("on-stop-progress");this.hideLoader();if(w.Type.isDomNode(e)){e.classList.remove("ui-btn-wait")}}},{key:"hidePage",value:function e(n){var s=this;return new Promise((function(e,i){var o;if(n.landingId>0){o=T.Manager.hidePage(n)}else{o=T.Manager.deleteUrl(n)}o.then((function(){s.store.commit("application/removePage",{page:n});e()}))["catch"]((function(e){t.showError(e.answer.error_description);i(e.answer.error_description)}))}))}},{key:"sendPage",value:function e(n){var s=this;if(this.isProgress){return}if(this.disableSendButton){return}var i=this.store.getters["application/getPages"]();var o;for(var a in i){if(i.hasOwnProperty(a)&&i[a].id===n){o=i[a];break}}var r="other";if(o.landingId>0){if(parseInt(o.siteId)===parseInt(T.Manager.connectedSiteId)){r="landing_store_chat"}else{r="landing_other"}}if(!this.dialogId){this.slider.data.set("action","sendPage");this.slider.data.set("page",o);this.slider.data.set("pageId",n);if(this.context===st.sms){this.startProgress();BX.Salescenter.Manager.addAnalyticAction({analyticsLabel:"salescenterSendSms",context:this.context,source:r,type:o.isWebform?"form":"info",code:o.code}).then((function(){s.stopProgress();s.closeApplication()}))}else{this.closeApplication()}return}this.startProgress();w.ajax.runAction("salescenter.page.send",{analyticsLabel:"salescenterSendChat",getParameters:{dialogId:this.dialogId,context:this.context,source:r,type:o.isWebform?"form":"info",connector:this.connector,code:o.code},data:{id:n,options:{dialogId:this.dialogId,sessionId:this.sessionId}}}).then((function(){s.stopProgress();s.closeApplication()}))["catch"]((function(e){t.showError(e.errors.pop().message);s.stopProgress()}))}},{key:"sendCompilation",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!this.isPaymentCreationAvailable){this.closeApplication();return null}if(!this.store.getters["orderCreation/isAllowedSubmit"]||this.isProgress){return null}if(!this.isAllowedFacebookRegion){n=true}this.startProgress(e);var s={dialogId:this.dialogId,sendingMethod:this.sendingMethod,sendingMethodDesc:this.sendingMethodDesc,ownerTypeId:this.ownerTypeId,ownerId:this.ownerId,connector:this.connector,sessionId:this.sessionId,sendCompilationLinkToFacebook:n,compilationId:this.compilation?this.compilation.ID:this.newCompilationId,editable:this.options.templateMode==="create"};if(this.stageOnOrderPaid!==null){s.stageOnOrderPaid=this.stageOnOrderPaid}if(this.stageOnDeliveryFinished!==null){s.stageOnDeliveryFinished=this.stageOnDeliveryFinished}if(this.connector==="facebook"&&this.isAllowedFacebookRegion&&!n){this.sendCompilationToFacebook(e,s)}else{this.sendCompilationAjaxAction(e,s)}}},{key:"sendCompilationToFacebook",value:function t(e,n){var s=this;w.ajax.runComponentAction("bitrix:salescenter.app","getFacebookSettingsPath",{mode:"class",data:{dialogId:this.dialogId}}).then((function(t){var i=t.data;if(i){s.stopProgress(e);s.showFacebookCatalogConnectionPopup(e,i)}else{w.ajax.runAction("salescenter.compilation.sendFacebookModerationWaitingNotification",{data:{options:n}}).then((function(t){s.sendCompilationAjaxAction(e,n);s.store.dispatch("orderCreation/resetBasket");s.closeApplication();s.stopProgress(e)}))}}))}},{key:"showFacebookCatalogConnectionPopup",value:function t(e,n){if(!this.facebookCatalogConnectionPopup){this.facebookCatalogConnectionPopup=new x.Popup({className:"salescenter-app-catalog-facebook-connection-popup",content:this.getFacebookCatalogConnectionPopupContent(e,n),width:500,overlay:true,offsetTop:0,offsetLeft:0,padding:17,animation:"fading-slide",angle:false,closeIcon:{top:"5px",right:"5px"}})}this.facebookCatalogConnectionPopup.show()}},{key:"getFacebookCatalogConnectionPopupContent",value:function t(e,n){var s=w.Tag.render(Wt||(Wt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button class="ui-btn ui-btn-md ui-btn-primary">\n\t\t\t\t',"\n\t\t\t</button>\n\t\t"])),w.Loc.getMessage("SALESCENTER_FACEBOOK_CATALOG_POPUP_SET_BUTTON"));w.Event.bind(s,"click",this.setFacebookCatalogConnectionPopupHandler.bind(this,n));var i=w.Tag.render(Kt||(Kt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button class="ui-btn ui-btn-md ui-btn-light-border">\n\t\t\t\t',"\n\t\t\t</button>\n\t\t"])),w.Loc.getMessage("SALESCENTER_FACEBOOK_CATALOG_POPUP_SEND_B24_COMPILATION_LINK_BUTTON"));w.Event.bind(i,"click",this.sendLinkToB24CompilationButtonPopupHandler.bind(this,e));return w.Tag.render(Gt||(Gt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="salescenter-app-catalog-facebook-connection-popup--container">\n\t\t\t\t<div class="salescenter-app-catalog-facebook-connection-popup--title">','</div>\n\t\t\t\t<div class="salescenter-app-catalog-facebook-connection-popup--button-container">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),w.Loc.getMessage("SALESCENTER_FACEBOOK_CATALOG_POPUP_TITLE_1"),s,i)}},{key:"setFacebookCatalogConnectionPopupHandler",value:function t(e){BX.SidePanel.Instance.open(e);this.facebookCatalogConnectionPopup.close()}},{key:"sendLinkToB24CompilationButtonPopupHandler",value:function t(e){this.facebookCatalogConnectionPopup.close();this.sendCompilation(e,true)}},{key:"sendCompilationAjaxAction",value:function e(n,s){var i=this;var o=this.store.getters["orderCreation/getBasket"]();var a=o.map((function(t){return t.skuId}));w.ajax.runAction("salescenter.compilation.sendCompilation",{data:{productIds:a,options:s},analyticsLabel:"salescenterCreateCompilation"}).then((function(t){i.store.dispatch("orderCreation/resetBasket");i.stopProgress(n);if(t.data&&t.data.compilation){i.slider.data.set("action","sendCompilation");i.slider.data.set("compilation",t.data.compilation)}i.closeApplication();i.emitGlobalEvent("salescenter.app:oncompilationcreated")}))["catch"]((function(e){e.errors.forEach((function(t){alert(t.message)}));i.stopProgress(n);t.showError(e)}))}},{key:"sendShipment",value:function e(n){var s=this;if(!this.isPaymentCreationAvailable){this.closeApplication();return null}if(!this.store.getters["orderCreation/isAllowedSubmit"]||this.isProgress){return null}this.startProgress(n);var i={ownerTypeId:this.ownerTypeId,ownerId:this.ownerId,orderId:this.orderId,deliveryId:this.store.getters["orderCreation/getDeliveryId"],deliveryPrice:this.store.getters["orderCreation/getDelivery"],expectedDeliveryPrice:this.store.getters["orderCreation/getExpectedDelivery"],deliveryResponsibleId:this.store.getters["orderCreation/getDeliveryResponsibleId"],personTypeId:this.store.getters["orderCreation/getPersonTypeId"],shipmentPropValues:this.store.getters["orderCreation/getPropertyValues"],deliveryExtraServicesValues:this.store.getters["orderCreation/getDeliveryExtraServicesValues"]};if(this.stageOnDeliveryFinished!==null){i.stageOnDeliveryFinished=this.stageOnDeliveryFinished}w.ajax.runAction("salescenter.order.createShipment",{data:{basketItems:this.store.getters["orderCreation/getBasket"](),options:i},analyticsLabel:"salescenterCreateShipment"}).then((function(t){s.store.dispatch("orderCreation/resetBasket");s.stopProgress(n);if(t.data){if(t.data.order){s.slider.data.set("order",t.data.order)}if(t.data.deal){s.slider.data.set("deal",t.data.deal)}}s.closeApplication();s.emitGlobalEvent("salescenter.app:onshipmentcreated")}))["catch"]((function(e){e.errors.forEach((function(t){alert(t.message)}));s.stopProgress(n);t.showError(e)}))}},{key:"sendPayment",value:function e(n){var s=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"n";if(!this.isPaymentCreationAvailable){this.closeApplication();return null}if(!this.store.getters["orderCreation/isAllowedSubmit"]||this.isProgress){return null}this.startProgress(n);var o={dialogId:this.dialogId,sendingMethod:this.sendingMethod,sendingMethodDesc:this.sendingMethodDesc,sessionId:this.sessionId,lineId:this.lineId,ownerTypeId:this.ownerTypeId,orderId:this.orderId,ownerId:this.ownerId,mode:this.options.mode,skipPublicMessage:i,deliveryId:this.store.getters["orderCreation/getDeliveryId"],deliveryPrice:this.store.getters["orderCreation/getDelivery"],expectedDeliveryPrice:this.store.getters["orderCreation/getExpectedDelivery"],deliveryResponsibleId:this.store.getters["orderCreation/getDeliveryResponsibleId"],personTypeId:this.store.getters["orderCreation/getPersonTypeId"],shipmentPropValues:this.store.getters["orderCreation/getPropertyValues"],deliveryExtraServicesValues:this.store.getters["orderCreation/getDeliveryExtraServicesValues"],availablePaySystemsIds:this.store.getters["orderCreation/getAvailablePaySystemsIds"],connector:this.connector,context:this.context,currency:this.currencyCode,assignedById:this.assignedById};if(this.documentSelector){o.boundDocumentId=this.store.getters["documentSelector/getBoundDocumentId"];o.selectedTemplateId=this.store.getters["documentSelector/getSelectedTemplateId"]}if(this.stageOnOrderPaid!==null){o.stageOnOrderPaid=this.stageOnOrderPaid}if(this.stageOnDeliveryFinished!==null){o.stageOnDeliveryFinished=this.stageOnDeliveryFinished}w.ajax.runAction("salescenter.order.createPayment",{data:{basketItems:this.store.getters["orderCreation/getBasket"](),options:o},analyticsLabel:this.context===st.deal?"salescenterCreatePaymentSms":"salescenterCreatePayment",getParameters:{dialogId:this.dialogId,context:this.context,connector:this.connector,skipPublicMessage:i}}).then((function(t){s.store.dispatch("orderCreation/resetBasket");s.stopProgress(n);if(i==="y"){var e={content:w.Loc.getMessage("SALESCENTER_ORDER_CREATE_NOTIFICATION").replace("#ORDER_ID#",t.data.order.number)};e.actions=[{title:w.Loc.getMessage("SALESCENTER_VIEW"),events:{click:function e(){T.Manager.showOrderAdd(t.data.order.id)}}}];BX.UI.Notification.Center.notify(e);T.Manager.showOrdersList({orderId:t.data.order.id,ownerId:s.ownerId,ownerTypeId:s.ownerTypeId,context:s.context})}else{s.slider.data.set("action","sendPayment");s.slider.data.set("order",t.data.order);if(t.data.deal){s.slider.data.set("deal",t.data.deal)}if(t.data.entity){s.slider.data.set("entity",t.data.entity)}s.closeApplication()}s.emitGlobalEvent("salescenter.app:onpaymentcreated")}))["catch"]((function(e){e.errors.forEach((function(t){top.BX.UI.Notification.Center.notify({content:w.Text.encode(t.message)})}));s.stopProgress(n);t.showError(e);if(s.needCloseApplication(e.errors)){s.closeApplication()}}))}},{key:"sendTerminalPayment",value:function e(n){var s=this;if(!this.isPaymentCreationAvailable){this.closeApplication();return null}if(!this.store.getters["orderCreation/isAllowedSubmit"]||this.isProgress){return null}this.startProgress(n);var i={ownerTypeId:this.ownerTypeId,ownerId:this.ownerId,orderId:this.orderId,paymentResponsibleId:this.store.getters["orderCreation/getPaymentResponsibleId"],context:this.context,currency:this.currencyCode,assignedById:this.assignedById};if(this.stageOnOrderPaid!==null){i.stageOnOrderPaid=this.stageOnOrderPaid}var o=this.store.getters["orderCreation/isMobileInstalledForResponsible"];w.ajax.runAction("salescenter.order.createTerminalPayment",{data:{basketItems:this.store.getters["orderCreation/getBasket"](),options:i},analyticsLabel:"salescenterCreateTerminalPayment",getParameters:{context:this.context}}).then((function(t){s.store.dispatch("orderCreation/resetBasket");s.stopProgress(n);s.slider.data.set("action","sendPayment");s.slider.data.set("order",t.data.order);if(t.data.deal){s.slider.data.set("deal",t.data.deal)}if(t.data.entity){s.slider.data.set("entity",t.data.entity)}if(o){s.closeApplication()}else{s.showMobileAppInstallLinkPopup()}s.emitGlobalEvent("salescenter.app:onterminalpaymentcreated")}))["catch"]((function(e){e.errors.forEach((function(t){top.BX.UI.Notification.Center.notify({content:w.Text.encode(t.message)})}));s.stopProgress(n);t.showError(e);if(s.needCloseApplication(e.errors)){s.closeApplication()}}))}},{key:"showMobileAppInstallLinkPopup",value:function t(){var e=this.store.getters["orderCreation/getResponsiblePhoneNumbers"];new Yt({sendersConfig:this.options.senders,phoneNumbers:e,userId:this.store.getters["orderCreation/getPaymentResponsibleId"],root:this}).render()}},{key:"updateTerminalPayment",value:function e(n){var s=this;if(!this.store.getters["orderCreation/isAllowedSubmit"]||this.isProgress){return null}this.startProgress(n);var i={paymentResponsibleId:this.store.getters["orderCreation/getPaymentResponsibleId"]};w.ajax.runAction("salescenter.order.updateTerminalPayment",{data:{paymentId:this.options.paymentId,options:i},analyticsLabel:"salescenterUpdateTerminalPayment",getParameters:{context:this.context}}).then((function(t){s.store.dispatch("orderCreation/resetBasket");s.stopProgress(n);s.slider.data.set("action","sendPayment");s.slider.data.set("order",t.data.order);if(t.data.deal){s.slider.data.set("deal",t.data.deal)}if(t.data.entity){s.slider.data.set("entity",t.data.entity)}s.closeApplication();s.emitGlobalEvent("salescenter.app:onterminalpaymentupdated")}))["catch"]((function(e){e.errors.forEach((function(t){top.BX.UI.Notification.Center.notify({content:w.Text.encode(t.message)})}));s.stopProgress(n);t.showError(e);if(s.needCloseApplication(e.errors)){s.closeApplication()}}))}},{key:"openMobileAppPopup",value:function t(){var e=this.options.currentLanguage==="ru"?"salescenter-popup-qr__icon --ru":"salescenter-popup-qr__icon";var n=w.Tag.render(zt||(zt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="salescenter-popup-qr__box">\n\t\t\t\t<div class="salescenter-popup-qr__title">','</div>\n\t\t\t\t<div class="salescenter-popup-qr__desc">','</div>\n\t\t\t\t<div class="salescenter-popup-qr__content">\n\t\t\t\t\t<div class="salescenter-popup-qr__code"></div>\n\t\t\t\t\t<ul class="salescenter-popup-qr__list">\n\t\t\t\t\t\t<li class="salescenter-popup-qr__list_item">','</li>\n\t\t\t\t\t\t<li class="salescenter-popup-qr__list_item">','</li>\n\t\t\t\t\t\t<li class="salescenter-popup-qr__list_item">','</li>\n\t\t\t\t\t\t<li class="salescenter-popup-qr__list_item">','</li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<div class="salescenter-popup-qr__icon_box">\n\t\t\t\t\t\t<div class="','"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\t\t\n\t\t'])),w.Loc.getMessage("SALESCENTER_TERMINAL_QR_POPUP_TITLE"),w.Loc.getMessage("SALESCENTER_TERMINAL_QR_POPUP_DESC"),w.Loc.getMessage("SALESCENTER_TERMINAL_QR_POPUP_LIST_ITEM_1"),w.Loc.getMessage("SALESCENTER_TERMINAL_QR_POPUP_LIST_ITEM_2"),w.Loc.getMessage("SALESCENTER_TERMINAL_QR_POPUP_LIST_ITEM_3"),w.Loc.getMessage("SALESCENTER_TERMINAL_QR_POPUP_LIST_ITEM_4"),e);var s=new x.Popup({className:"salescenter-popup-qr__wrap",content:n,overlay:true,closeIcon:true,maxWidth:725,autoHide:true,cacheable:false,buttons:[new R.Button({color:R.Button.Color.PRIMARY,text:w.Loc.getMessage("SALESCENTER_JS_POPUP_CLOSE"),onclick:function t(){s.close()}}),new R.Button({color:R.Button.Color.LINK,text:w.Loc.getMessage("SALESCENTER_TERMINAL_QR_POPUP_BUTTON_ABOUT"),onclick:function t(){T.Manager.openHowTerminalWorks()}})]});s.show();this.getQRCode()}},{key:"getQRCode",value:function t(){var e=document.querySelector(".salescenter-popup-qr__code");return new QRCode(e,{text:this.options.mobileAppLink,width:143,height:143})}},{key:"needCloseApplication",value:function t(e){var n=e.filter((function(t){return t.code<1||t.code>100})).length>=1;return n===false}},{key:"resendPayment",value:function e(n){var s=this;if(!this.isPaymentCreationAvailable){this.closeApplication();return null}if(!this.store.getters["orderCreation/isAllowedSubmit"]||this.isProgress){return null}this.startProgress(n);var i={sendingMethod:this.sendingMethod,sendingMethodDesc:this.sendingMethodDesc,stageOnOrderPaid:this.stageOnOrderPaid,ownerTypeId:this.ownerTypeId,ownerId:this.ownerId};if(this.documentSelector){i.boundDocumentId=this.store.getters["documentSelector/getBoundDocumentId"];i.selectedTemplateId=this.store.getters["documentSelector/getSelectedTemplateId"]}w.ajax.runAction("salescenter.order.resendPayment",{data:{orderId:this.orderId,paymentId:this.options.paymentId,shipmentId:this.options.shipmentId,options:i},getParameters:{context:this.context}}).then((function(t){s.stopProgress(n);s.closeApplication();s.emitGlobalEvent("salescenter.app:onpaymentresend")}))["catch"]((function(e){e.errors.forEach((function(t){alert(t.message)}));s.stopProgress(n);t.showError(e)}))}},{key:"hideNoPaymentSystemsBanner",value:function t(){var e=this.options.orderCreationOption||false;var n=this.options.paySystemBannerOptionName||false;if(e&&n){BX.userOptions.save("salescenter",e,n,"Y")}}},{key:"getOrdersCount",value:function t(){if(this.sessionId>0){return A.rest.callMethod("salescenter.order.getActiveOrdersCount",{sessionId:this.sessionId})}else{return new Promise((function(t,e){}))}}},{key:"getPaymentsCount",value:function t(){if(this.sessionId>0){return A.rest.callMethod("salescenter.order.getActivePaymentsCount",{sessionId:this.sessionId})}else{return new Promise((function(t,e){}))}}},{key:"hasClientContactInfo",value:function t(){if(this.options.sendingMethod==="chat"){return this.options.dialogId!==""}return this.options.contactPhone!==""}},{key:"emitGlobalEvent",value:function t(e,n){r.EventEmitter.emit(e,n);BX.SidePanel.Instance.postMessage(this.slider,e,n)}},{key:"isPaymentMode",value:function t(){return this.context===st.deal||this.context===st.smartInvoice||this.context===st.terminalList}}],[{key:"initStore",value:function t(){var e=new k.VuexBuilder;return e.addModel(jt.create()).addModel(Vt.create()).addModel(Xt.create()).useNamespace(true).build()}},{key:"showError",value:function t(e){}}]);return t}();t.App=Zt})(this.BX.Salescenter=this.BX.Salescenter||{},BX,BX,BX.Salescenter,BX.Salescenter.Component.StageBlock,BX.Salescenter.Component.StageBlock,BX.Catalog,BX.Event,BX,BX.Salescenter,BX,BX,BX.Salescenter.Component.StageBlock,BX.Salescenter.AutomationStage,BX.Salescenter.Component.StageBlock.TimeLine,BX,BX,BX,BX,BX,BX,BX.Salescenter.Component.StageBlock,BX.Salescenter,BX.Salescenter,BX,BX.Salescenter.Tile,BX.UI.EntitySelector,BX.Salescenter.Component,BX.Currency,BX.Salescenter,BX,BX,BX,BX,BX.Main,BX.UI);
//# sourceMappingURL=app.bundle.map.js