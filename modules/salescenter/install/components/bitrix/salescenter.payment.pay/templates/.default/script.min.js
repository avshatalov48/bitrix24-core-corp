BX.namespace("BX.SalesCenter.Component");if(typeof BX.SalesCenter.Component.PaymentPayBase==="undefined"){BX.SalesCenter.Component.PaymentPayBase=function(){this._id="";this._settings={};this._container=null;this._wrapper=null;this._url="";this._paysystems=[]};BX.SalesCenter.Component.PaymentPayBase.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(4);this._settings=t?t:{};this._isViewMode=this.getSetting("viewMode");this._container=BX(this.getSetting("containerId"));this._url=this.getSetting("url")||"";this._isAllowedSubmitting=BX.UserConsent===undefined||this.getSetting("isAllowedSubmitting",false);if(!this._container)return null;if(BX.UserConsent!==undefined){var n=BX.UserConsent.load(this._container);BX.addCustomEvent(n,BX.UserConsent.events.accepted,function(){this._isAllowedSubmitting=true}.bind(this));BX.addCustomEvent(n,BX.UserConsent.events.refused,function(){this._isAllowedSubmitting=false}.bind(this))}var s=BX.prop.getArray(t,"paySystemData",[]);var i=BX.prop.getInteger(t,"selectedPaySystemId",0);for(var a=0;a<s.length;a++){var r=s[a];var o=BX.SalesCenter.Component.PaySystemItem.create(r.ID,{parent:this,fields:r});if(parseInt(r.ID)===i){o.changeSelection(true)}this._paysystems.push(o)}this.layout();if(!this._isViewMode){var l=this._container.querySelector(this.getSetting("submitButtonSelector"));if(BX.type.isDomNode(l)){BX.bind(l,"click",this.submit.bind(this))}}BX.addCustomEvent("onPaySystemAjaxError",BX.proxy(this.addReloadPageButton,this))},addReloadPageButton:function(){var e=BX.create("div",{props:{className:"order-payment-buttons-container"},children:[BX.create("button",{text:BX.message("SPP_PAY_RELOAD_BUTTON"),props:{className:"landing-block-node-button text-uppercase btn btn-lg btn-primary g-font-weight-700 g-font-size-12 g-rounded-50 pl-4 pr-4 pt-3 pb-3"},events:{click:BX.delegate(function(e){window.location.reload()},this)}})]});this._container.appendChild(e)},getId:function(){return this._id},layout:function(){},selectItem:function(e){},getSelectedItem:function(){for(var e=0;e<this._paysystems.length;e++){var t=this._paysystems[e];if(t.isSelected()){return t}}return null},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},submit:function(e){var t=this.getSelectedItem();BX.onCustomEvent(this.getSetting("consentEventName"),[]);if(!t||!this._url||!this._isAllowedSubmitting)return false;e.target.classList.add("ui-btn-clock");this._isAllowedSubmitting=false;var n=this._url;BX.ajax({method:"POST",dataType:"json",url:n,data:{sessid:BX.bitrix_sessid(),paysystemId:t.getId(),signedParameters:this.getSetting("signedParameters")},onsuccess:BX.proxy(this.onAfterPay,this)},this)},onAfterPay:function(e){if(!BX.type.isObject(e)||e.status==="error"){var t=document.createElement("div");t.innerHTML=BX.message("SPP_INITIATE_PAY_ERROR_TEXT");t.classList.add("alert");t.classList.add("alert-danger");this._container.innerHTML="";this._container.appendChild(t);this.addReloadPageButton()}else{var n=BX.type.isString(e.html)?e.html:"";if(n.length===0){this._container.innerHTML="";var s=BX.prop.getObject(e,"fields");var i=BX.create("div",{props:{className:"alert alert-success"},children:[BX.create("div",{props:{className:"mb-4"},html:"<b>"+BX.message("SPP_EMPTY_TEMPLATE_TITLE")+"</b>"}),BX.create("div",{html:BX.message("SPP_EMPTY_TEMPLATE_SUM_WITH_CURRENCY_FIELD")+" <b>"+BX.prop.getString(s,"SUM_WITH_CURRENCY")+"</b>"}),BX.create("div",{props:{className:"mb-4"},html:BX.message("SPP_EMPTY_TEMPLATE_PAY_SYSTEM_NAME_FIELD")+" <b>"+BX.prop.getString(s,"PAY_SYSTEM_NAME")+"</b>"}),BX.create("div",{html:"<b>"+BX.message("SPP_EMPTY_TEMPLATE_FOOTER")+"</b>"})]});this._container.appendChild(i);this.addReloadPageButton()}else{BX.html(this._container,n)}}}};BX.SalesCenter.Component.PaymentPayBase.instances={};BX.SalesCenter.Component.PaymentPayBase.create=function(e,t){var n=new BX.SalesCenter.Component.PaymentPayBase;n.initialize(e,t);this.instances[n.getId()]=n;return n}}if(typeof BX.SalesCenter.Component.PaymentPayList==="undefined"){BX.SalesCenter.Component.PaymentPayList=function(){BX.SalesCenter.Component.PaymentPayList.superclass.constructor.apply(this)};BX.extend(BX.SalesCenter.Component.PaymentPayList,BX.SalesCenter.Component.PaymentPayBase);BX.SalesCenter.Component.PaymentPayList.prototype.layout=function(){this._wrapper=this._container.querySelector(this.getSetting("paySystemBlockSelector"));if(!BX.type.isDomNode(this._wrapper)){return null}for(var e=0;e<this._paysystems.length;e++){var t=this._paysystems[e];this._wrapper.appendChild(t.getWrapper())}this.layoutDescription()};BX.SalesCenter.Component.PaymentPayList.prototype.layoutDescription=function(){if(!this._container)return null;var e=this._container.querySelector(this.getSetting("descriptionBlockSelector"));if(BX.type.isDomNode()){return null}var t=this.getSelectedItem();e.innerHTML="";if(t){e.appendChild(BX.create("DIV",{props:{className:"order-payment-method-description-title"},text:t.getName()}));e.appendChild(BX.create("DIV",{props:{className:"order-payment-method-description-text"},html:BX.util.htmlspecialchars(t.getDescription())}))}};BX.SalesCenter.Component.PaymentPayList.prototype.selectItem=function(e){var t=e.getId();for(var n=0;n<this._paysystems.length;n++){var s=this._paysystems[n];if(s.getId()===t){s.changeSelection(true)}else if(s.isSelected()){s.changeSelection(false)}}this.layoutDescription();return null};BX.SalesCenter.Component.PaymentPayList.instances={};BX.SalesCenter.Component.PaymentPayList.create=function(e,t){var n=new BX.SalesCenter.Component.PaymentPayList;n.initialize(e,t);this.instances[n.getId()]=n;return n}}if(typeof BX.SalesCenter.Component.PaymentPayInner==="undefined"){BX.SalesCenter.Component.PaymentPayInner=function(){BX.SalesCenter.Component.PaymentPayInner.superclass.constructor.apply(this)};BX.extend(BX.SalesCenter.Component.PaymentPayInner,BX.SalesCenter.Component.PaymentPayBase);BX.SalesCenter.Component.PaymentPayInner.instances={};BX.SalesCenter.Component.PaymentPayInner.create=function(e,t){var n=new BX.SalesCenter.Component.PaymentPayInner;n.initialize(e,t);this.instances[n.getId()]=n;return n}}if(typeof BX.SalesCenter.Component.PaySystemItem==="undefined"){BX.SalesCenter.Component.PaySystemItem=function(){this._id="";this._settings={};this._parent={};this._fields=[];this._selected=false;this._wrapper=null};BX.SalesCenter.Component.PaySystemItem.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(4);this._settings=t?t:{};this._parent=this.getSetting("parent");this._fields=this.getSetting("fields");this._wrapper=this.layout()},getId:function(){return this._id},layout:function(){return BX.create("div",{props:{className:"order-payment-method-item"},children:[BX.create("div",{props:{className:"order-payment-method-item-block",style:"background-image: url('"+BX.util.htmlspecialchars(this._fields["LOGOTIP"])+"');"}}),BX.create("div",{props:{className:"order-payment-method-item-name"},text:this.getName()})],events:{click:this.onClick.bind(this)}})},onClick:function(){if(!this._parent)return null;this._parent.selectItem(this)},getWrapper:function(){return this._wrapper},getName:function(){return this._fields["NAME"]},getDescription:function(){return this._fields["DESCRIPTION"]},isSelected:function(){return this._selected},changeSelection:function(e){this._selected=e;if(e){this._wrapper.classList+=" selected"}else{BX.removeClass(this._wrapper," selected")}},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t}};BX.SalesCenter.Component.PaySystemItem.instances={};BX.SalesCenter.Component.PaySystemItem.create=function(e,t){var n=new BX.SalesCenter.Component.PaySystemItem;n.initialize(e,t);this.instances[n.getId()]=n;return n}}
//# sourceMappingURL=script.map.js