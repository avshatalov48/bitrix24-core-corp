(function(){"use strict";BX.namespace("BX.SaleCenterDelivery.TileGrid");BX.SaleCenterDelivery.TileGrid.Item=function(e){BX.TileGrid.Item.apply(this,arguments);this.title=e.title;this.image=e.image;this.itemSelected=e.itemSelected;this.itemSelectedColor=e.itemSelectedColor;this.itemSelectedImage=e.itemSelectedImage;this.layout={container:null,image:null,title:null,clipTitle:null,company:null,controls:null,buttonAction:null,price:null};this.data=e.data||{}};BX.SaleCenterDelivery.TileGrid.Item.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,getContent:function(){if(!this.layout.wrapper){this.layout.wrapper=BX.create("div",{props:{className:"salescenter-delivery-item"},children:[BX.create("div",{props:{className:"salescenter-delivery-item-content"},children:[this.getImage(),this.getTitle(),this.getStatus()]})],events:{click:function(){this.onClick()}.bind(this)}})}this.itemSelected?this.setSelected():null;return this.layout.wrapper},getImage:function(){if(!this.layout.image){this.layout.image=BX.create("div",{props:{className:"salescenter-delivery-item-image"},style:{backgroundImage:this.image?"url("+this.image+")":null}})}return this.layout.image},getStatus:function(){if(!this.itemSelected)return;this.layout.itemSelected=BX.create("div",{props:{className:"salescenter-delivery-item-status-selected"}});return this.layout.itemSelected},setSelected:function(){if(!this.itemSelected)return;BX.addClass(this.layout.wrapper,"salescenter-delivery-item-selected");if(this.itemSelectedImage){this.layout.image.style.backgroundImage="url("+this.itemSelectedImage+")"}if(this.itemSelectedColor){this.layout.wrapper.style.backgroundColor=this.itemSelectedColor}this.layout.itemSelected=BX.create("div",{props:{className:"salescenter-delivery-item-status-selected"}});this.layout.wrapper.appendChild(this.layout.itemSelected)},setUnselected:function(){if(this.itemSelected){return}BX.removeClass(this.layout.wrapper,"salescenter-delivery-item-selected");if(this.image){this.layout.image.style.backgroundImage="url("+this.image+")"}this.layout.wrapper.style.backgroundColor="";var e=content.querySelector(".salescenter-delivery-item-status-selected");if(e){e.parentNode.removeChild(e)}},getTitle:function(){if(!this.layout.title){this.layout.title=BX.create("div",{props:{className:"salescenter-delivery-item-title"},text:this.title})}return this.layout.title},onClick:function(){var e={allowChangeHistory:false,events:{onLoad:function(e){var t=e.getSlider();if(t.isOpen()&&t.url.indexOf("CREATE")>-1){this.prepareDeliveryForm(t)}else{var i=this.data.connectPath;this.setDeliveryListAddButton(t,i)}}.bind(this),onClose:function(e){var t=e.getSlider();this.setDeliveryItemHandler(t)}.bind(this),onDestroy:function(e){var t=e.getSlider();this.setDeliveryItemHandler(t)}.bind(this)}};if(!this.itemSelected&&!this.data.showMenu){BX.SidePanel.Instance.open(this.data.connectPath,e)}else{this.showItemMenu(this,{sliderOptions:e})}},showItemMenu:function(e,t){var i=[],n,s=e.layout.container,a="salescenter-item-menu-"+BX.util.getRandomString(),l;e.sliderOptions={};if(t.sliderOptions){e.sliderOptions=t.sliderOptions}for(n in e.data.menuItems){if(e.data.menuItems.hasOwnProperty(n)){if(e.data.menuItems[n].DELIMITER){i.push({delimiter:true})}else if(e.data.menuItems[n].FILTER){l=e.data.menuItems[n].FILTER;i.push({text:e.data.menuItems[n].NAME,link:e.data.menuItems[n].LINK,onclick:function(t,i){e.moreTabsMenu.close();BX.ajax.runComponentAction("bitrix:salescenter.control_panel","setDeliveryListFilter",{mode:"class",data:{filter:l}}).then(function(t){BX.SidePanel.Instance.open(i.options.link,e.sliderOptions)})}})}else{i.push({text:e.data.menuItems[n].NAME,link:e.data.menuItems[n].LINK,onclick:function(t,i){e.moreTabsMenu.close();BX.SidePanel.Instance.open(i.options.link,e.sliderOptions)}})}}}e.moreTabsMenu=BX.PopupMenu.create(a,s,i,{autoHide:true,offsetLeft:0,offsetTop:0,closeByEsc:true,events:{onPopupClose:function(){e.moreTabsMenu.popupWindow.destroy();BX.PopupMenu.destroy(a)},onPopupDestroy:function(){e.moreTabsMenu=null}}});e.moreTabsMenu.popupWindow.show()},prepareDeliveryForm:function(e){var t,i,n,s,a;t=e.iframe;i=t.contentDocument||t.contentWindow.document;n=i.getElementsByName("NAME")[0];if(n){n.value=this.title}if(this.id==="pickup"){a=i.getElementsByName("STORES_SHOW")[0];if(a){a.checked=true;var l=new Event("change");a.dispatchEvent(l)}}},setDeliveryListAddButton:function(e,t){var i,n,s,a,l,r;i=e.iframe;n=i.contentDocument||i.contentWindow.document;s=n.getElementsByClassName("ui-btn-double ui-btn-primary");if(s){a=s[0].getElementsByClassName("ui-btn-main")[0];if(a){r=a.innerText;l=BX.create("a",{props:{className:"ui-btn-main",href:t},text:r});s[0].replaceChild(l,a)}}},setDeliveryItemHandler:function(e){var t,i,n,s,a;t=e.iframe;i=t.contentDocument||t.contentWindow.document;a=new URL(window.location.href+e.url);n=a.searchParams.get("CLASS_NAME");s=a.searchParams.get("SERVICE_TYPE");this.reloadDeliveryItem(n,s)},reloadDeliveryItem:function(e,t){var i=this;BX.ajax.runComponentAction("bitrix:salescenter.control_panel","reloadDeliveryItem",{mode:"class",data:{className:e,serviceType:t}}).then(function(e){if(e.data.menuItems&&e.data.menuItems.length>0){i.itemSelected=e.data.itemSelected;if(i.itemSelected){i.setSelected()}else{i.setUnselected()}i.data.menuItems=e.data.menuItems;i.data.showMenu=e.data.showMenu}})}}})();
//# sourceMappingURL=script.map.js