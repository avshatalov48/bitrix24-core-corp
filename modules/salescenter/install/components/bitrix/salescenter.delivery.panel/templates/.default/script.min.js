(function(e){"use strict";(function(){BX.namespace("BX.SaleCenterDelivery");BX.SaleCenterDelivery={delivery:null,signedParameters:null,init:function e(t){this.deliveryParams=t.deliveryParams;this.signedParameters=t.signedParameters;this.delivery=new BX.TileGrid.Grid(this.deliveryParams);this.delivery.draw()},reloadSlider:function e(t){if(t.deliveryPanelParams){this.delivery.redraw(t.deliveryPanelParams)}}};BX.SaleCenterDelivery.TileGrid=function(e){BX.TileGrid.Item.apply(this,arguments);this.title=e.title;this.image=e.image;this.itemSelected=e.itemSelected;this.itemSelectedColor=e.itemSelectedColor;this.itemSelectedImage=e.itemSelectedImage;this.outerImage=e.outerImage||false;this.layout={container:null,image:null,title:null,clipTitle:null,company:null,controls:null,buttonAction:null,price:null};this.data=e.data||{}};BX.SaleCenterDelivery.TileGrid.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,getContent:function e(){if(!this.layout.wrapper){this.layout.wrapper=BX.create("div",{props:{className:"salescenter-delivery-item"},children:[BX.create("div",{props:{className:"salescenter-delivery-item-content"},children:[this.getImage(),this.getTitle(),this.getStatus()]})],events:{click:function(){this.onClick()}.bind(this)}})}if(this.itemSelected||this.data.type==="actionbox"){this.setSelected()}return this.layout.wrapper},getImage:function e(){if(!this.layout.image){var t=this.data.hasOwnProperty("hasOwnIcon")&&this.data.hasOwnIcon?"salescenter-delivery-marketplace-item-image":"salescenter-delivery-item-image";var i=BX.create("div",{props:{className:t},style:{backgroundSize:this.outerImage?"50px":"",backgroundImage:this.image?"url("+encodeURI(this.image)+")":null}});this.layout.image=i}return this.layout.image},getStatus:function e(){if(!this.itemSelected)return;this.layout.itemSelected=BX.create("div",{props:{className:"salescenter-delivery-item-status-selected"}});return this.layout.itemSelected},setSelected:function e(){BX.addClass(this.layout.wrapper,"salescenter-delivery-item-selected");if(this.itemSelectedImage){this.layout.image.style.backgroundImage="url("+this.itemSelectedImage+")"}if(this.itemSelectedColor){this.layout.wrapper.style.backgroundColor=this.itemSelectedColor}},setUnselected:function e(){if(this.itemSelected){return}BX.removeClass(this.layout.wrapper,"salescenter-delivery-item-selected");if(this.image){this.layout.image.style.backgroundImage="url("+this.image+")"}this.layout.wrapper.style.backgroundColor="";var t=content.querySelector(".salescenter-delivery-item-status-selected");if(t){t.parentNode.removeChild(t)}},getTitle:function e(){if(!this.layout.title){this.layout.title=BX.create("div",{props:{className:this.data.type==="marketplaceApp"?"salescenter-delivery-marketplace-app-item-title":"salescenter-delivery-item-title"},text:this.title})}return this.layout.title},openRestAppLayout:function e(t,i){BX.ajax.runComponentAction("bitrix:salescenter.delivery.panel","getRestApp",{data:{code:i}}).then(function(e){var a=e.data;if(a.TYPE==="A"){this.showRestApplication(i)}else{BX.rest.AppLayout.openApplication(t)}}.bind(this))["catch"](function(e){this.restAppErrorPopup(" ",e.errors.pop().message)}.bind(this))},restAppErrorPopup:function e(t,i){BX.UI.Dialogs.MessageBox.alert(i,t,(function(e){return e.close()}),BX.Loc.getMessage("SDP_SALESCENTER_JS_POPUP_CLOSE"))},onClick:function e(){var t=this;if(this.data.type==="delivery"){var i={allowChangeHistory:false,events:{onLoad:function(e){var t=e.getSlider();if(t.isOpen()&&t.url.indexOf("CREATE")>-1){this.prepareDeliveryForm(t)}else{var i=this.data.connectPath}}.bind(this),onClose:function(e){var t=e.getSlider();this.setDeliveryItemHandler(t)}.bind(this),onDestroy:function(e){var t=e.getSlider();this.setDeliveryItemHandler(t)}.bind(this)}};if(!this.itemSelected&&!this.data.showMenu){BX.Salescenter.Manager.openSlider(this.data.connectPath,{width:835}).then((function(){t.reload(BX.SaleCenterDelivery.signedParameters)}))}else{this.showItemMenu(this,{sliderOptions:i})}}else if(this.data.type==="marketplaceApp"){if(this.itemSelected){this.openRestAppLayout(this.id,this.data.code)}else{this.showRestApplication(this.data.code)}}else if(this.data.type==="recommend"){BX.SidePanel.Instance.open(this.data.connectPath,{width:735})}else if(this.data.type==="actionbox"){if(this.data.handler==="anchor"){window.open(this.data.move)}else if(this.data.handler==="marketplace"){BX.rest.Marketplace.open({PLACEMENT:this.data.move})}else if(this.data.handler==="landing"){var a=this.data.move;BX.SidePanel.Instance.open("salecenter",{contentCallback:function e(){return"<iframe src='"+a+"'"+" style='width: 100%; height:"+" -webkit-calc(100vh - 20px); height:"+" calc(100vh - 20px);'></iframe>"}})}}},showItemMenu:function e(t,i){var a=this;var n=[],s,r=t.layout.container,l="salescenter-item-menu-"+BX.util.getRandomString(),o;t.sliderOptions={};if(i.sliderOptions){t.sliderOptions=i.sliderOptions}for(s in t.data.menuItems){if(t.data.menuItems.hasOwnProperty(s)){if(t.data.menuItems[s].DELIMITER){n.push({delimiter:true})}else if(t.data.menuItems[s].FILTER){o=t.data.menuItems[s].FILTER;n.push({text:t.data.menuItems[s].NAME,link:t.data.menuItems[s].LINK,onclick:function e(i,a){t.moreTabsMenu.close();BX.ajax.runComponentAction("bitrix:salescenter.delivery.panel","setDeliveryListFilter",{mode:"class",data:{filter:o}}).then((function(e){BX.SidePanel.Instance.open(a.options.link,t.sliderOptions)}))}})}else{n.push({text:t.data.menuItems[s].NAME,link:t.data.menuItems[s].LINK,onclick:function e(i,n){t.moreTabsMenu.close();BX.Salescenter.Manager.openSlider(n.options.link,{width:835}).then((function(){a.reload(BX.SaleCenterDelivery.signedParameters)}))}})}}}t.moreTabsMenu=BX.PopupMenu.create(l,r,n,{autoHide:true,offsetLeft:0,offsetTop:0,closeByEsc:true,events:{onPopupClose:function e(){t.moreTabsMenu.popupWindow.destroy();BX.PopupMenu.destroy(l)},onPopupDestroy:function e(){t.moreTabsMenu=null}}});t.moreTabsMenu.popupWindow.show()},prepareDeliveryForm:function e(t){var i,a,n,s;i=t.iframe;a=i.contentDocument||i.contentWindow.document;n=a.getElementsByName("NAME")[0];if(n){n.value=this.title}if(this.id==="pickup"){s=a.getElementsByName("STORES_SHOW")[0];if(s){s.checked=true;var r=new Event("change");s.dispatchEvent(r)}}},setDeliveryListAddButton:function e(t,i){var a,n,s,r,l,o;a=t.iframe;n=a.contentDocument||a.contentWindow.document;s=n.getElementsByClassName("ui-btn-split ui-btn-primary");if(s){r=s[0].getElementsByClassName("ui-btn-main")[0];if(r){o=r.innerText;l=BX.create("a",{props:{className:"ui-btn-main",href:i},text:o});s[0].replaceChild(l,r)}}},setDeliveryItemHandler:function e(t){var i,a,n,s,r;i=t.iframe;a=i.contentDocument||i.contentWindow.document;r=new URL(window.location.href+t.url);n=r.searchParams.get("CLASS_NAME");s=r.searchParams.get("SERVICE_TYPE");this.reloadDeliveryItem(n,s)},reloadDeliveryItem:function e(t,i){var a=this;BX.ajax.runComponentAction("bitrix:salescenter.control_panel","reloadDeliveryItem",{mode:"class",data:{className:t,serviceType:i}}).then((function(e){if(e.data.menuItems&&e.data.menuItems.length>0){a.itemSelected=e.data.itemSelected;if(a.itemSelected){a.setSelected()}else{a.setUnselected()}a.data.menuItems=e.data.menuItems;a.data.showMenu=e.data.showMenu}}))},showRestApplication:function e(t){var i="/marketplace/detail/#app#/";var a=i.replace("#app#",encodeURIComponent(t));BX.SidePanel.Instance.open(a,{allowChangeHistory:false,events:{onClose:this.reload.bind(this,BX.SaleCenterDelivery.signedParameters)}})},reload:function e(t){BX.ajax.runComponentAction("bitrix:salescenter.delivery.panel","getComponentResult",{mode:"ajax",data:{signedParameters:t}}).then((function(e){BX.SaleCenterDelivery.reloadSlider(e.data)}))}}})()})(this.window=this.window||{});
//# sourceMappingURL=script.map.js