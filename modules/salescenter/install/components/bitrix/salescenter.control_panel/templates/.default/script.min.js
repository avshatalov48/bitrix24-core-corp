(function(e,t,i,n){"use strict";var a,s,l,r,o;var u=t.Reflection.namespace("BX.Salescenter");var c=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"init",value:function e(i){var n=this;if(t.Type.isPlainObject(i)){this.constructor.shopRoot=i.shopRoot}t.Event.ready((function(){if(BX.SidePanel.Instance){BX.SidePanel.Instance.bindAnchors(top.BX.clone({rules:[{condition:[n.constructor.shopRoot+"sale_delivery_service_edit/",n.constructor.shopRoot+"sale_pay_system_edit/"],handler:n.constructor.adjustSidePanelOpener},{condition:["/shop/orders/details/(\\d+)/","/shop/orders/payment/details/(\\d+)/","/shop/orders/shipment/details/(\\d+)/"]},{condition:["/crm/configs/sale/"]}]}))}var e=top.BX.adminSidePanel||BX.adminSidePanel;if(e){if(!top.window["adminSidePanel"]||!BX.is_subclass_of(top.window["adminSidePanel"],e)){top.window["adminSidePanel"]=new e({publicMode:true})}}}))}},{key:"addCommonConnectionDependentTile",value:function t(i){e.commonConnectionDependentTiles.push(i)}},{key:"addPageMenuTile",value:function t(i){e.pageMenuTiles.push(i)}},{key:"adjustSidePanelOpener",value:function e(t,i){if(BX.SidePanel.Instance){var n=i.url.indexOf("IFRAME=Y&IFRAME_TYPE=SIDE_SLIDER")>=0;if(!n||n&&!BX.SidePanel.Instance.getTopSlider()){t.preventDefault();i.url=BX.util.add_url_param(i.url,{publicSidePanel:"Y"});BX.SidePanel.Instance.open(i.url,{allowChangeHistory:false})}}}},{key:"connectShop",value:function t(i){n.Manager.startConnection({context:i}).then((function(){n.Manager.loadConfig().then((function(t){if(t.isSiteExists){n.Manager.showAfterConnectPopup();e.commonConnectionDependentTiles.forEach((function(e){e.data.active=true;e.dropMenu();e.rerender()}))}}))}))}},{key:"paymentSystemsTileClick",value:function t(){if(e.paymentSystemsTile){e.paymentSystemsTile.onClick()}}},{key:"closeMenu",value:function e(){var t=i.PopupMenu.getCurrentMenu();if(t){t.destroy()}}},{key:"dropPageMenus",value:function t(){e.pageMenuTiles.forEach((function(e){e.dropMenu()}))}},{key:"reloadUserConsentTile",value:function t(){if(e.userConsentTile){e.userConsentTile.reloadTile()}}}]);return e}();babelHelpers.defineProperty(c,"shopRoot","/shop/settings/");babelHelpers.defineProperty(c,"commonConnectionDependentTiles",[]);babelHelpers.defineProperty(c,"pageMenuTiles",[]);var d=function(e){babelHelpers.inherits(u,e);function u(e){var t;babelHelpers.classCallCheck(this,u);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(u).call(this,e));t.title=e.title;t.image=e.image;t.data=e.data||{};if(t.isDependsOnConnection()){c.addCommonConnectionDependentTile(babelHelpers.assertThisInitialized(t))}if(t.hasPagesMenu()){c.addPageMenuTile(babelHelpers.assertThisInitialized(t))}if(t.id==="payment-systems"){c.paymentSystemsTile=babelHelpers.assertThisInitialized(t)}else if(t.id==="userconsent"){c.userConsentTile=babelHelpers.assertThisInitialized(t)}return t}babelHelpers.createClass(u,[{key:"isDependsOnConnection",value:function e(){return this.data.isDependsOnConnection===true}},{key:"hasPagesMenu",value:function e(){return this.data.hasPagesMenu===true}},{key:"getContent",value:function e(){this.layout.innerContent=t.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<div class="salescenter-item ','" onclick="','" style="','">\n\t\t\t<div class="salescenter-item-content">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t</div>"])),this.getAdditionalContentClass(),this.onClick.bind(this),this.getContentStyles(),this.getImage(),this.getTitle(),this.isActive()?this.getStatus():"",this.getLabel());return this.layout.innerContent}},{key:"rerender",value:function e(){if(!this.layout.innerContent){return}var t=this.layout.innerContent.parentNode;t.removeChild(this.layout.innerContent);t.appendChild(this.getContent())}},{key:"getAdditionalContentClass",value:function e(){if(this.isActive()){return"salescenter-item-selected"}return""}},{key:"isActive",value:function e(){return this.data.active===true}},{key:"getLoadMenuItemsAction",value:function e(){return null}},{key:"onClick",value:function e(){var t=this;if(!this.isActive()){c.connectShop(this.id)}else{var i=this.getMenuItems();if(!i){this.reloadTile(true).then((function(e){i=t.getMenuItems();if(t.isActive()&&i){t.showMenu()}else{t.onClick()}}))}else{this.showMenu()}}}},{key:"getContentStyles",value:function e(){var t="";if(this.isActive()&&this.data.activeColor&&!this.isMarketplaceAll()){t="background-color: "+this.data.activeColor}return t}},{key:"getImage",value:function e(){var i="";var n="salescenter-item-image";if(this.image){i=this.image}if(this.isActive()&&this.data.activeImage){i=this.data.activeImage}i=encodeURI(i);if(this.isMarketplaceAll()&&this.data.hasOwnProperty("hasOwnIcon")&&this.data.hasOwnIcon){n="salescenter-marketplace-item-image"}return t.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['<div class="','" style="background-image:url(',')"></div>'])),n,i)}},{key:"getStatus",value:function e(){return t.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['<div class="salescenter-item-status-selected"></div>'])))}},{key:"getLabel",value:function e(){if(this.needNewLabel()){var i="salescenter-item-label-new";var n="salescenter-item-label-new-text";if(this.isActive()&&this.data.hasOwnProperty("activeColor")){i="salescenter-item-label-new-active";n="salescenter-item-label-new-text-active"}return t.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['<div class="','"><div class="','">',"</div></div>"])),i,n,BX.message("SALESCENTER_CONTROL_PANEL_ITEM_LABEL_NEW"))}return""}},{key:"getTitle",value:function e(){var i=this.isMarketplaceAll()?"salescenter-marketplace-item-title":"salescenter-item-title";return t.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['<div class="','">',"</div>"])),i,this.title)}},{key:"getMenuItems",value:function e(){return this.data.menu}},{key:"hasMenu",value:function e(){return t.Type.isArrayFilled(this.data.menu)}},{key:"dropMenu",value:function e(){delete this.data.menu;return this}},{key:"showMenu",value:function e(){i.PopupMenu.show(this.id+"-menu",this.layout.container,this.getMenuItems(),{offsetLeft:0,offsetTop:0,closeByEsc:true,className:"salescenter-panel-menu"})}},{key:"getUrl",value:function e(){if(t.Type.isString(this.data.url)){return this.data.url}return null}},{key:"getSliderOptions",value:function e(){if(t.Type.isPlainObject(this.data.sliderOptions)){return this.data.sliderOptions}return null}},{key:"reloadTile",value:function e(){var i=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return new Promise((function(e){if(t.Type.isString(i.data.reloadAction)){t.ajax.runComponentAction("bitrix:salescenter.control_panel",i.data.reloadAction,{analyticsLabel:n?"salescenterControlPanelReloadTile":null,getParameters:n?{tileId:i.id}:null,mode:"class",data:{id:i.id}}).then((function(n){if(!t.Type.isNil(n.data.active)){i.data.active=n.data.active}if(!t.Type.isNil(n.data.menu)){i.data.menu=n.data.menu}i.rerender();e()}))}else{e()}}))}},{key:"isMarketplaceAll",value:function e(){return this.data.hasOwnProperty("itemSubType")&&this.data.itemSubType==="marketplaceApp"}},{key:"needNewLabel",value:function e(){return this.data.hasOwnProperty("label")&&this.data.label==="new"}},{key:"openRestAppLayout",value:function e(i,n){t.ajax.runComponentAction("bitrix:salescenter.control_panel","getRestApp",{data:{code:n}}).then(function(e){var t=e.data;if(t.TYPE==="A"){this.showRestApplication(n)}else{BX.rest.AppLayout.openApplication(i)}}.bind(this))["catch"](function(e){this.restAppErrorPopup(" ",e.errors.pop().message)}.bind(this))}},{key:"showRestApplication",value:function e(t){var i="/marketplace/detail/#app#/";var a=i.replace("#app#",encodeURIComponent(t));n.Manager.openSlider(a).then(this.reloadTile.bind(this))}},{key:"restAppErrorPopup",value:function e(t,i){BX.UI.Dialogs.MessageBox.alert(i,t,(function(e){return e.close()}),BX.Loc.getMessage("SALESCENTER_CONTROL_PANEL_POPUP_CLOSE"))}}]);return u}(BX.TileGrid.Item);var p=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"dropMenu",value:function e(){return this}},{key:"onClick",value:function e(){if(this.isMarketplaceAll()){if(this.data.active){this.openRestAppLayout(this.data.appId,this.data.code)}else{this.showRestApplication(this.data.code)}}else if(this.opensSlider()){var i=this.getUrl();var a=this.getSliderOptions();if(i){n.Manager.openSlider(i,a).then(this.reloadTile.bind(this))}}else if(this.isRecommendTile()){n.Manager.openFeedbackPayOrderForm()}else{babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"onClick",this).call(this)}}},{key:"opensSlider",value:function e(){var t=this.isCrmStoreTile()||this.isCrmWithEshopTile()||this.isCrmFormTile()||this.isTerminalTile();var i=this.getUrl();var n=this.hasMenu();return t&&i&&!n}},{key:"isRecommendTile",value:function e(){return this.id==="recommendation"}},{key:"isCrmStoreTile",value:function e(){return this.id==="crmstore"}},{key:"isCrmWithEshopTile",value:function e(){return this.id==="crm-with-eshop"}},{key:"isCrmFormTile",value:function e(){return this.id&&this.id==="crmform"}},{key:"isTerminalTile",value:function e(){return this.id&&this.id==="terminal"}}]);return t}(d);var h=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"onClick",value:function e(){if(this.isDependsOnConnection()){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"onClick",this).call(this)}else if(this.id==="userconsent"){if(!this.isActive()){var i=this.getUrl();if(i){n.Manager.openSlider(i).then(this.reloadTile.bind(this))}}else{this.showMenu()}}else{var a=this.getUrl();if(a){n.Manager.openSlider(a).then(this.reloadTile.bind(this))}}}}]);return t}(d);u.ControlPanel=c;u.PaymentItem=p;u.PaymentSystemItem=h})(this.window=this.window||{},BX,BX.Main,BX.Salescenter);
//# sourceMappingURL=script.map.js