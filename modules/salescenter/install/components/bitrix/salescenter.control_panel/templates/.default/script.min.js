(function(e,t,n,i){"use strict";var a,s,l,r,o;var u=t.Reflection.namespace("BX.Salescenter");var c=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"init",value:function e(n){var i=this;if(t.Type.isPlainObject(n)){this.constructor.shopRoot=n.shopRoot}t.Event.ready((function(){if(BX.SidePanel.Instance){BX.SidePanel.Instance.bindAnchors(top.BX.clone({rules:[{condition:[i.constructor.shopRoot+"sale_delivery_service_edit/",i.constructor.shopRoot+"sale_pay_system_edit/"],handler:i.constructor.adjustSidePanelOpener},{condition:["/shop/orders/details/(\\d+)/","/shop/orders/payment/details/(\\d+)/","/shop/orders/shipment/details/(\\d+)/"]},{condition:["/crm/configs/sale/"]}]}))}var e=top.BX.adminSidePanel||BX.adminSidePanel;if(e){if(!top.window["adminSidePanel"]||!BX.is_subclass_of(top.window["adminSidePanel"],e)){top.window["adminSidePanel"]=new e({publicMode:true})}}}))}},{key:"addCommonConnectionDependentTile",value:function t(n){e.commonConnectionDependentTiles.push(n)}},{key:"addPageMenuTile",value:function t(n){e.pageMenuTiles.push(n)}},{key:"adjustSidePanelOpener",value:function e(t,n){if(BX.SidePanel.Instance){var i=n.url.indexOf("IFRAME=Y&IFRAME_TYPE=SIDE_SLIDER")>=0;if(!i||i&&!BX.SidePanel.Instance.getTopSlider()){t.preventDefault();n.url=BX.util.add_url_param(n.url,{publicSidePanel:"Y"});BX.SidePanel.Instance.open(n.url,{allowChangeHistory:false})}}}},{key:"connectShop",value:function t(n){i.Manager.startConnection({context:n}).then((function(){i.Manager.loadConfig().then((function(t){if(t.isSiteExists){i.Manager.showAfterConnectPopup();e.commonConnectionDependentTiles.forEach((function(e){e.data.active=true;e.dropMenu();e.rerender()}))}}))}))}},{key:"paymentSystemsTileClick",value:function t(){if(e.paymentSystemsTile){e.paymentSystemsTile.onClick()}}},{key:"closeMenu",value:function e(){var t=n.PopupMenu.getCurrentMenu();if(t){t.destroy()}}},{key:"dropPageMenus",value:function t(){e.pageMenuTiles.forEach((function(e){e.dropMenu()}))}},{key:"reloadUserConsentTile",value:function t(){if(e.userConsentTile){e.userConsentTile.reloadTile()}}}]);return e}();babelHelpers.defineProperty(c,"shopRoot","/shop/settings/");babelHelpers.defineProperty(c,"commonConnectionDependentTiles",[]);babelHelpers.defineProperty(c,"pageMenuTiles",[]);var d=function(e){babelHelpers.inherits(u,e);function u(e){var t;babelHelpers.classCallCheck(this,u);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(u).call(this,e));t.title=e.title;t.image=e.image;t.data=e.data||{};if(t.isDependsOnConnection()){c.addCommonConnectionDependentTile(babelHelpers.assertThisInitialized(t))}if(t.hasPagesMenu()){c.addPageMenuTile(babelHelpers.assertThisInitialized(t))}if(t.id==="payment-systems"){c.paymentSystemsTile=babelHelpers.assertThisInitialized(t)}else if(t.id==="userconsent"){c.userConsentTile=babelHelpers.assertThisInitialized(t)}return t}babelHelpers.createClass(u,[{key:"isDependsOnConnection",value:function e(){return this.data.isDependsOnConnection===true}},{key:"hasPagesMenu",value:function e(){return this.data.hasPagesMenu===true}},{key:"getContent",value:function e(){this.layout.innerContent=t.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<div class="salescenter-item ','" onclick="','" style="','">\n\t\t\t<div class="salescenter-item-content">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t</div>"])),this.getAdditionalContentClass(),this.onClick.bind(this),this.getContentStyles(),this.getImage(),this.getTitle(),this.isActive()?this.getStatus():"",this.getLabel());return this.layout.innerContent}},{key:"rerender",value:function e(){if(!this.layout.innerContent){return}var t=this.layout.innerContent.parentNode;t.removeChild(this.layout.innerContent);t.appendChild(this.getContent())}},{key:"getAdditionalContentClass",value:function e(){if(this.isActive()){return"salescenter-item-selected"}return""}},{key:"isActive",value:function e(){return this.data.active===true}},{key:"getLoadMenuItemsAction",value:function e(){return null}},{key:"onClick",value:function e(){var t=this;if(!this.isActive()){c.connectShop(this.id)}else{var n=this.getMenuItems();if(!n){this.reloadTile(true).then((function(e){n=t.getMenuItems();if(t.isActive()&&n){t.showMenu()}else{t.onClick()}}))}else{this.showMenu()}}}},{key:"getContentStyles",value:function e(){var t="";if(this.isActive()&&this.data.activeColor&&!this.isMarketplaceAll()){t="background-color: "+this.data.activeColor}return t}},{key:"getImage",value:function e(){var n="";var i="salescenter-item-image";if(this.image){n=this.image}if(this.isActive()&&this.data.activeImage){n=this.data.activeImage}n=encodeURI(n);if(this.isMarketplaceAll()&&this.data.hasOwnProperty("hasOwnIcon")&&this.data.hasOwnIcon){i="salescenter-marketplace-item-image"}return t.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['<div class="','" style="background-image:url(',')"></div>'])),i,n)}},{key:"getStatus",value:function e(){return t.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['<div class="salescenter-item-status-selected"></div>'])))}},{key:"getLabel",value:function e(){if(this.needNewLabel()){var n="salescenter-item-label-new";var i="salescenter-item-label-new-text";if(this.isActive()&&this.data.hasOwnProperty("activeColor")){n="salescenter-item-label-new-active";i="salescenter-item-label-new-text-active"}return t.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['<div class="','"><div class="','">',"</div></div>"])),n,i,BX.message("SALESCENTER_CONTROL_PANEL_ITEM_LABEL_NEW"))}return""}},{key:"getTitle",value:function e(){var n=this.isMarketplaceAll()?"salescenter-marketplace-item-title":"salescenter-item-title";return t.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['<div class="','">',"</div>"])),n,this.title)}},{key:"getMenuItems",value:function e(){return this.data.menu}},{key:"hasMenu",value:function e(){return t.Type.isArrayFilled(this.data.menu)}},{key:"dropMenu",value:function e(){delete this.data.menu;return this}},{key:"showMenu",value:function e(){n.PopupMenu.show(this.id+"-menu",this.layout.container,this.getMenuItems(),{offsetLeft:0,offsetTop:0,closeByEsc:true,className:"salescenter-panel-menu"})}},{key:"getUrl",value:function e(){if(t.Type.isString(this.data.url)){return this.data.url}return null}},{key:"getSliderOptions",value:function e(){if(t.Type.isPlainObject(this.data.sliderOptions)){return this.data.sliderOptions}return null}},{key:"reloadTile",value:function e(){var n=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return new Promise((function(e){if(t.Type.isString(n.data.reloadAction)){t.ajax.runComponentAction("bitrix:salescenter.control_panel",n.data.reloadAction,{analyticsLabel:i?"salescenterControlPanelReloadTile":null,getParameters:i?{tileId:n.id}:null,mode:"class",data:{id:n.id}}).then((function(i){if(!t.Type.isNil(i.data.active)){n.data.active=i.data.active}if(!t.Type.isNil(i.data.menu)){n.data.menu=i.data.menu}n.rerender();e()}))}else{e()}}))}},{key:"isMarketplaceAll",value:function e(){return this.data.hasOwnProperty("itemSubType")&&this.data.itemSubType==="marketplaceApp"}},{key:"needNewLabel",value:function e(){return this.data.hasOwnProperty("label")&&this.data.label==="new"}},{key:"openRestAppLayout",value:function e(n,i){t.ajax.runComponentAction("bitrix:salescenter.control_panel","getRestApp",{data:{code:i}}).then(function(e){var t=e.data;if(t.TYPE==="A"){this.showRestApplication(i)}else{BX.rest.AppLayout.openApplication(n)}}.bind(this))["catch"](function(e){this.restAppErrorPopup(" ",e.errors.pop().message)}.bind(this))}},{key:"showRestApplication",value:function e(t){var n="/marketplace/detail/#app#/";var a=n.replace("#app#",encodeURIComponent(t));i.Manager.openSlider(a).then(this.reloadTile.bind(this))}},{key:"restAppErrorPopup",value:function e(t,n){var i=new BX.PopupWindow("rest-app-error-alert",null,{closeIcon:true,closeByEsc:true,autoHide:false,titleBar:t,content:n,zIndex:16e3,overlay:{color:"gray",opacity:30},buttons:[new BX.PopupWindowButton({id:"close",text:BX.message("SALESCENTER_CONTROL_PANEL_POPUP_CLOSE"),events:{click:function e(){i.close()}}})],events:{onPopupClose:function e(){this.destroy()},onPopupDestroy:function e(){i=null}}});i.show()}}]);return u}(BX.TileGrid.Item);var p=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"dropMenu",value:function e(){return this}},{key:"onClick",value:function e(){if(this.isMarketplaceAll()){if(this.data.active){this.openRestAppLayout(this.data.appId,this.data.code)}else{this.showRestApplication(this.data.code)}}else if(this.opensSlider()){var n=this.getUrl();var a=this.getSliderOptions();if(n){i.Manager.openSlider(n,a).then(this.reloadTile.bind(this))}}else if(this.isRecommendTile()){i.Manager.openFeedbackPayOrderForm()}else{babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"onClick",this).call(this)}}},{key:"opensSlider",value:function e(){var t=this.isCrmStoreTile()||this.isCrmWithEshopTile()||this.isCrmFormTile()||this.isTerminalTile();var n=this.getUrl();var i=this.hasMenu();return t&&n&&!i}},{key:"isRecommendTile",value:function e(){return this.id==="recommendation"}},{key:"isCrmStoreTile",value:function e(){return this.id==="crmstore"}},{key:"isCrmWithEshopTile",value:function e(){return this.id==="crm-with-eshop"}},{key:"isCrmFormTile",value:function e(){return this.id&&this.id==="crmform"}},{key:"isTerminalTile",value:function e(){return this.id&&this.id==="terminal"}}]);return t}(d);var h=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"onClick",value:function e(){if(this.isDependsOnConnection()){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"onClick",this).call(this)}else if(this.id==="userconsent"){if(!this.isActive()){var n=this.getUrl();if(n){i.Manager.openSlider(n).then(this.reloadTile.bind(this))}}else{this.showMenu()}}else{var a=this.getUrl();if(a){i.Manager.openSlider(a).then(this.reloadTile.bind(this))}}}}]);return t}(d);u.ControlPanel=c;u.PaymentItem=p;u.PaymentSystemItem=h})(this.window=this.window||{},BX,BX.Main,BX.Salescenter);
//# sourceMappingURL=script.map.js