(function(){"use strict";BX.namespace("BX.Salescenter.Cashbox");BX.Salescenter.Cashbox.init=function(e){BX.Salescenter.Cashbox.signedParameters=e.signedParameters;BX.Salescenter.Cashbox.form=e.form;BX.Salescenter.Cashbox.errorMessageNode=e.errorMessageNode;BX.Salescenter.Cashbox.container=e.container;BX.Salescenter.Cashbox.isProgress=false;BX.Salescenter.Cashbox.renderForm();BX.Salescenter.Cashbox.bindEvents();BX.Salescenter.Cashbox.saveButtonNode=document.getElementById("ui-button-panel-save");BX.Salescenter.Cashbox.closeButtonNode=document.getElementById("ui-button-panel-close");BX.Salescenter.Cashbox.deleteButtonNode=document.getElementById("ui-button-panel-remove");BX.Salescenter.Cashbox.cashboxId=e.cashboxId;BX.Salescenter.Cashbox.initialFormData=BX.Salescenter.Cashbox.getAllFormData()};BX.Salescenter.Cashbox.renderForm=function(){var e=BX.Salescenter.Cashbox.form;e.setContainer(BX.Salescenter.Cashbox.container);var s=BX.Salescenter.Cashbox.getPage("cashbox_params");var a=e.renderSection(BX.Salescenter.Form.getByName(e.config,"parameters"));s.appendChild(a);var t=BX.Salescenter.Cashbox.getPage("settings");for(var n in e.config){if(n>0&&e.config.hasOwnProperty(n)&&e.config[n].name.indexOf("SETTINGS")>=0&&e.config[n].name.indexOf("OFD_SETTINGS")<0){t.appendChild(e.renderSection(e.config[n],true))}}var o=document.getElementById("cashbox-settings-SETTINGS_VAT");var r=document.getElementById("cashbox-settings-SETTINGS_TAX");if(o&&r){var i=o.firstChild;BX.addClass(i,"ui-color-light salescenter-angle-icon-after");var l=document.createElement("div");BX.addClass(l,"salescenter-angle-icon");i.appendChild(l);BX.removeClass(o,"salescenter-form-settings-section");o.removeChild(i.nextSibling);o.style.display="none";i.addEventListener("click",function(){BX.toggle(o)});r.appendChild(o);r.insertBefore(i,o)}BX.Salescenter.Cashbox.renderOfdPage()};BX.Salescenter.Cashbox.renderOfdPage=function(){var e=false;var s=BX.Salescenter.Cashbox.getPage("ofd_settings");if(s){while(s.firstChild){s.removeChild(s.firstChild)}var a=BX.Salescenter.Cashbox.form;for(var t in a.config){if(t>0&&a.config.hasOwnProperty(t)&&a.config[t].name.indexOf("OFD_SETTINGS")>=0){s.appendChild(a.renderSection(a.config[t],true));e=true}}if(!e){document.getElementById("salescenter-menu-page-ofd_settings").parentNode.style.display="none"}else{document.getElementById("salescenter-menu-page-ofd_settings").parentNode.style.display="block"}}};BX.Salescenter.Cashbox.bindEvents=function(){var e=BX.Salescenter.Form.getByName(BX.Salescenter.Cashbox.form.fields,"fields[OFD]");if(e){var s=BX.Salescenter.Cashbox.form.getFieldInput(e);if(s){BX.bind(s,"change",BX.Salescenter.Cashbox.onChangeOfd)}}if(BX.SidePanel.Instance){var a=BX.SidePanel.Instance.getSliderByWindow(window);if(a){BX.addCustomEvent(a,"SidePanel.Slider:onClose",BX.Salescenter.Cashbox.onCloseSlider.bind(BX.Salescenter.Cashbox))}}};BX.Salescenter.Cashbox.onChangeOfd=function(){if(!BX.Salescenter.Cashbox.isProgress){BX.Salescenter.Cashbox.startProgress();BX.ajax.runComponentAction("bitrix:salescenter.cashbox","getFormConfig",{mode:"class",data:BX.Salescenter.Cashbox.form.getData(),signedParameters:BX.Salescenter.Cashbox.signedParameters}).then(function(e){BX.Salescenter.Cashbox.form.config=e.data.config;BX.Salescenter.Cashbox.form.fields=e.data.fields;BX.Salescenter.Cashbox.form.data=e.data.data;BX.Salescenter.Cashbox.renderOfdPage();BX.Salescenter.Cashbox.stopProgress()}).catch(function(e){BX.Salescenter.Cashbox.stopProgress();BX.Salescenter.Cashbox.showError(e.errors.pop().message)})}};BX.Salescenter.Cashbox.save=function(e){e.preventDefault();if(!BX.Salescenter.Cashbox.isProgress){BX.Salescenter.Cashbox.startProgress();BX.ajax.runComponentAction("bitrix:salescenter.cashbox","save",{mode:"class",data:BX.Salescenter.Cashbox.form.getData(),signedParameters:BX.Salescenter.Cashbox.signedParameters}).then(function(e){BX.Salescenter.Cashbox.stopProgress();BX.Salescenter.Cashbox.closeSlider()}).catch(function(e){BX.Salescenter.Cashbox.stopProgress();var s="";for(var a in e.errors){s+=e.errors[a].message+"<br />"}BX.Salescenter.Cashbox.showError(s)})}};BX.Salescenter.Cashbox.getPages=function(){return document.querySelectorAll("[data-cashbox-page]")};BX.Salescenter.Cashbox.getPage=function(e){var s=BX.Salescenter.Cashbox.getPages();for(var a=0;a<s.length;a++){if(s[a].dataset.cashboxPage===e){return s[a]}}return null};BX.Salescenter.Cashbox.showPage=function(e){var s=BX.Salescenter.Cashbox.getPages();for(var a=0;a<s.length;a++){if((s[a].dataset.cashboxPage===e||!s[a].classList.contains("salescenter-cashbox-page-invisible"))&&!(s[a].dataset.cashboxPage===e&&!s[a].classList.contains("salescenter-cashbox-page-invisible"))){BX.Salescenter.ComponentAnimation.smoothShowHide(s[a]);if(s[a].dataset.cashboxPage===e){var t=s[a].dataset.cashboxTitle;if(BX("pagetitle")&&t!==""){BX("pagetitle").innerHTML=t}}}}};BX.Salescenter.Cashbox.showError=function(e){if(BX.Salescenter.Cashbox.errorMessageNode){document.getElementById("salescenter-menu-page-cashbox_params").click();BX.Salescenter.Cashbox.errorMessageNode.parentNode.style.display="block";BX.Salescenter.Cashbox.errorMessageNode.innerHTML=e}};BX.Salescenter.Cashbox.hideError=function(){if(BX.Salescenter.Cashbox.errorMessageNode){BX.Salescenter.Cashbox.errorMessageNode.parentNode.style.display="none"}};BX.Salescenter.Cashbox.startProgress=function(){BX.Salescenter.Cashbox.isProgress=true;if(!BX.Salescenter.Cashbox.getLoader().isShown()){BX.Salescenter.Cashbox.getLoader().show(BX.Salescenter.Cashbox.container)}BX.Salescenter.Cashbox.hideError()};BX.Salescenter.Cashbox.stopProgress=function(){BX.Salescenter.Cashbox.getLoader().hide();BX.Salescenter.Cashbox.isProgress=false;setTimeout(function(){BX.removeClass(BX.Salescenter.Cashbox.saveButtonNode,"ui-btn-wait");BX.removeClass(BX.Salescenter.Cashbox.closeButtonNode,"ui-btn-wait");if(BX.Salescenter.Cashbox.deleteButtonNode){BX.removeClass(BX.Salescenter.Cashbox.deleteButtonNode,"ui-btn-wait")}},100)};BX.Salescenter.Cashbox.getLoader=function(){if(!this.loader){this.loader=new BX.Loader({size:150})}return this.loader};BX.Salescenter.Cashbox.remove=function(e){e.preventDefault();if(BX.Salescenter.Cashbox.cashboxId>0){if(!BX.Salescenter.Cashbox.isProgress){if(confirm(BX.message("SC_CASHBOX_DELETE_CONFIRM"))){BX.Salescenter.Cashbox.startProgress();BX.ajax.runComponentAction("bitrix:salescenter.cashbox","delete",{mode:"class",data:{id:BX.Salescenter.Cashbox.cashboxId}}).then(function(){BX.Salescenter.Cashbox.stopProgress();BX.Salescenter.Cashbox.closeSlider()}).catch(function(e){BX.Salescenter.Cashbox.stopProgress();BX.Salescenter.Cashbox.showError(e.errors.pop().message)})}}}};BX.Salescenter.Cashbox.closeSlider=function(){var e=document.getElementById("salescenter-form-is-saved");if(e){e.value="y"}if(BX.SidePanel.Instance){BX.SidePanel.Instance.getTopSlider().close()}};BX.Salescenter.Cashbox.openHelper=function(e,s){if(top.BX.Helper){top.BX.Helper.show(s)}if(e){e.preventDefault()}};BX.Salescenter.Cashbox.onCloseSlider=function(e){var s=document.getElementById("salescenter-form-is-saved");if(s&&s.value==="y"){return true}var a=this.getAllFormData();if(this.initialFormData===a||this.isClose===true){this.isClose=false;return false}e.action=false;if(this.popup){this.popup.destroy()}this.popup=new BX.PopupWindow("salescenter_slider_close_confirmation",null,{autoHide:false,draggable:false,closeByEsc:false,offsetLeft:0,offsetTop:0,zIndex:e.slider.zIndex+100,bindOptions:{forceBindPosition:true},titleBar:BX.message("SCP_POPUP_TITLE"),content:BX.message("SCP_POPUP_CONTENT"),buttons:[new BX.PopupWindowButton({text:BX.message("SCP_POPUP_BUTTON_CLOSE"),className:"ui-btn ui-btn-success",events:{click:BX.delegate(this.onCloseConfirmButtonClick.bind(this,"close"))}}),new BX.PopupWindowButtonLink({text:BX.message("SCP_POPUP_BUTTON_CANCEL"),className:"ui-btn ui-btn-link",events:{click:BX.delegate(this.onCloseConfirmButtonClick.bind(this,"cancel"))}})],events:{onPopupClose:function(){this.destroy()}}});this.popup.show();return false};BX.Salescenter.Cashbox.onCloseConfirmButtonClick=function(e){this.popup.close();if(e==="close"){this.isClose=true;BX.SidePanel.Instance.getTopSlider().close()}};BX.Salescenter.Cashbox.getAllFormData=function(){var e=document.getElementsByTagName("form");if(e&&e.length>0){var s=BX.ajax.prepareForm(e[0]),a;for(a in s.data){if(s.data.hasOwnProperty(a)&&a===""){delete s.data[a]}}return!!s&&s.data?JSON.stringify(s.data):""}return""}})();
//# sourceMappingURL=script.map.js