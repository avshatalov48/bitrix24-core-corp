(function(){"use strict";BX.namespace("BX.SaleCenterSmsProvider");BX.SaleCenterSmsProvider={smsProvider:null,smsProviderApp:null,mode:"main",signedParameters:null,init:function(e){this.mode=e.mode;this.smsProviderParams=e.smsProviderParams;this.smsProviderAppParams=e.smsProviderAppParams;this.signedParameters=e.signedParameters;this.smsProvider=new BX.TileGrid.Grid(this.smsProviderParams);this.smsProvider.draw();if(this.mode==="main"){this.smsProviderApp=new BX.TileGrid.Grid(this.smsProviderAppParams);this.smsProviderApp.draw()}},reloadSlider:function(e){if(e.smsProviderPanelParams){this.smsProvider.redraw(e.smsProviderPanelParams)}if(e.smsProviderAppPanelParams&&this.mode==="main"){this.smsProviderApp.redraw(e.smsProviderAppPanelParams)}}};BX.SaleCenterSmsProvider.TileGrid=function(e){BX.TileGrid.Item.apply(this,arguments);this.title=e.title;this.titleColor=e.titleColor;this.image=e.image;this.itemSelected=e.itemSelected;this.itemSelectedColor=e.itemSelectedColor;this.itemSelectedImage=e.itemSelectedImage;this.outerImage=e.outerImage||false;this.layout={container:null,image:null,title:null};this.data=e.data||{}};BX.SaleCenterSmsProvider.TileGrid.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,getContent:function(){if(this.data.type==="counter"){return this.getItemCounter()}if(!this.layout.wrapper){this.layout.wrapper=BX.create("div",{props:{className:"salescenter-smsprovider-item"},children:[BX.create("div",{props:{className:"salescenter-smsprovider-item-content"},children:[this.getImage(),this.getTitle(),this.getStatus(),this.getLabel()]})],events:{click:function(){this.onClick()}.bind(this)}})}if(this.itemSelected||this.data.type==="actionbox"){this.setSelected()}return this.layout.wrapper},getImage:function(){if(!this.layout.image){var e=BX.create("div",{props:{className:"salescenter-smsprovider-item-image"},style:{backgroundSize:this.outerImage?"50px":"",backgroundImage:this.image?"url('"+this.image+"')":null}});if(this.data.type==="marketplaceApp"&&this.data.hasOwnIcon){e.style.backgroundSize="35% auto"}this.layout.image=e}return this.layout.image},getStatus:function(){if(!this.itemSelected)return;this.layout.itemSelected=BX.create("div",{props:{className:"salescenter-smsprovider-item-status-selected"}});return this.layout.itemSelected},getLabel:function(){if(!this.data.recommendation)return;this.layout.itemLabel=BX.create("div",{props:{className:"salescenter-item-label"},children:[BX.create("div",{props:{className:"salescenter-item-label-text"},text:BX.message("SALESCENTER_CONTROL_PANEL_ITEM_LABEL_RECOMMENDATION")})]});return this.layout.itemLabel},setSelected:function(){BX.addClass(this.layout.wrapper,"salescenter-smsprovider-item-selected");if(this.itemSelectedImage){this.layout.image.style.backgroundImage="url("+this.itemSelectedImage+")"}if(this.itemSelectedColor){if(this.itemSelectedColor.substring(0,1)!=="#"){this.layout.wrapper.style.backgroundColor="#"+this.itemSelectedColor}else{this.layout.wrapper.style.backgroundColor=this.itemSelectedColor}}},isValidColor:function(e){return BX.type.isNotEmptyString(e)&&e.match(/^([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)},isDarkColor:function(e){if(!e){return false}if(e.substring(0,1)==="#"){e=e.substring(1)}if(!this.isValidColor(e)){return false}if(e.length===3){e=e.replace(/([a-f0-9])/gi,"$1$1")}e=e.toLowerCase();var t=["8eb807","188a98","f12e45","1ec6fa"];if(BX.util.in_array(e,t)){return true}var i=parseInt(e,16);var a=i>>16&255;var s=i>>8&255;var r=i&255;var n=(a*299+s*587+r*114)/1e3;return n<128},getTitle:function(){if(!this.layout.title){this.layout.title=BX.create("div",{props:{className:"salescenter-smsprovider-item-title"},text:this.title});if(this.itemSelected){var e=this.data.isSelectedItemTitleDark||this.isDarkColor(this.itemSelectedColor);this.layout.title.style.color=e?"#fff":"#525c69"}}return this.layout.title},getItemCounter:function(){return BX.create("div",{props:{className:"salescenter-smsprovider-item salescenter-smsprovider-integration-marketplace-tile-item salescenter-smsprovider-integration-marketplace-tile-counter"},children:[BX.create("div",{props:{className:"salescenter-smsprovider-integration-marketplace-tile-counter-head"},children:[BX.create("div",{props:{className:"salescenter-smsprovider-integration-marketplace-tile-counter-name"},text:this.title}),BX.create("div",{props:{className:"salescenter-smsprovider-integration-marketplace-tile-counter-value"},text:this.data.count})]}),BX.create("div",{props:{className:"salescenter-smsprovider-integration-marketplace-tile-counter-link-box"},children:[BX.create("div",{props:{className:"salescenter-smsprovider-integration-marketplace-tile-counter-link"},text:this.data.description})]})],events:{click:function(){this.onClick()}.bind(this)}})},openRestAppLayout:function(e,t){BX.ajax.runComponentAction("bitrix:salescenter.smsprovider.panel","getRestApp",{data:{code:t}}).then(function(i){var a=i.data;if(a.TYPE==="A"){this.showRestApplication(t)}else{BX.rest.AppLayout.openApplication(e)}}.bind(this)).catch(function(e){this.restAppErrorPopup(" ",e.errors.pop().message)}.bind(this))},restAppErrorPopup:function(e,t){var i=new BX.PopupWindow("rest-app-error-alert",null,{closeIcon:true,closeByEsc:true,autoHide:false,titleBar:e,content:t,zIndex:16e3,overlay:{color:"gray",opacity:30},buttons:[new BX.PopupWindowButton({id:"close",text:BX.message("SPP_SALESCENTER_JS_POPUP_CLOSE"),events:{click:function(){i.close()}}})],events:{onPopupClose:function(){this.destroy()},onPopupDestroy:function(){i=null}}});i.show()},onClick:function(){if(this.data.type==="smsprovider"){BX.Salescenter.Manager.addAnalyticAction({analyticsLabel:"salescenterClickSmsProviderTile",isConnected:this.itemSelected?"y":"n",type:this.data.type});var e={allowChangeHistory:false,width:1e3,events:{onClose:this.reload.bind(this,BX.SaleCenterSmsProvider.mode,BX.SaleCenterSmsProvider.signedParameters)}};BX.SidePanel.Instance.open(this.data.connectPath,e)}else if(this.data.type==="counter"){BX.SidePanel.Instance.open(this.data.connectPath)}else if(this.data.type==="marketplaceApp"){if(this.itemSelected){this.openRestAppLayout(this.id,this.data.code)}else{this.showRestApplication(this.data.code)}}else if(this.data.type==="recommend"){BX.Salescenter.Manager.openFeedbackFormParams(event,{feedback_type:"smsprovider_offer"},{width:735})}else if(this.data.type==="actionbox"){if(this.data.handler==="anchor"){window.open(this.data.move)}else if(this.data.handler==="marketplace"){BX.rest.Marketplace.open({PLACEMENT:this.data.move})}else if(this.data.handler==="landing"){var t=this.data.move;BX.SidePanel.Instance.open("salecenter",{contentCallback:function(){return"<iframe src='"+t+"'"+" style='width: 100%; height:"+" -webkit-calc(100vh - 20px); height:"+" calc(100vh - 20px);'></iframe>"}})}}else if(this.data.type==="bitrix24"){var i=this;BX.Salescenter.SenderConfig.openSliderFreeMessages(this.data.connectPath)().then(function(){i.reload.call(i,BX.SaleCenterSmsProvider.mode,BX.SaleCenterSmsProvider.signedParameters)})}},showRestApplication:function(e){var t="/marketplace/detail/#app#/";var i=t.replace("#app#",encodeURIComponent(e));BX.SidePanel.Instance.open(i,{allowChangeHistory:false,events:{onClose:this.reload.bind(this,"main",BX.SaleCenterSmsProvider.signedParameters)}})},reloadPage:function(){var e=BX.SidePanel.Instance.getPreviousSlider(BX.SidePanel.Instance.getSliderByWindow(window));var t=e?e.getWindow():top;if(t){t.window.location.reload()}},reload:function(e,t){BX.ajax.runComponentAction("bitrix:salescenter.smsprovider.panel","getComponentResult",{mode:"ajax",data:{mode:e,signedParameters:t}}).then(function(e){BX.SaleCenterSmsProvider.reloadSlider(e.data)})}}})();
//# sourceMappingURL=script.map.js