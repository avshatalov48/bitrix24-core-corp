{"version":3,"file":"status.bundle.js","sources":["../src/status.js"],"sourcesContent":["import 'ui.design-tokens';\nimport { BitrixVue } from 'ui.vue3';\nimport { PullClient } from 'pull.client';\nimport { Browser } from 'main.core';\n\nimport './status.css';\n\nconst HIDE_TIMEOUT = 4000;\nconst STATUS_CHANGE_DEFAULT_TIMEOUT = 500;\nconst STATUS_CHANGE_CONNECTING_TIMEOUT = 5000;\nconst STATUS_CHANGE_OFFLINE_TIMEOUT = 1000;\n\n// @vue/component\nexport const PullStatus = {\n\tname: 'PullStatus',\n\tprops:\n\t{\n\t\tcanReconnect: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['reconnect'],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tstatus: PullClient.PullStatus.Online,\n\t\t\tshowed: null,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tcontainerClass(): string[]\n\t\t{\n\t\t\tconst result = [];\n\n\t\t\tlet visibilityClass = '';\n\t\t\tif (this.showed === true)\n\t\t\t{\n\t\t\t\tvisibilityClass = '--show';\n\t\t\t}\n\t\t\telse if (this.showed === false)\n\t\t\t{\n\t\t\t\tvisibilityClass = '--hide';\n\t\t\t}\n\t\t\tconst statusClass = `--${this.status}`;\n\t\t\tresult.push(visibilityClass, statusClass);\n\n\t\t\treturn result;\n\t\t},\n\t\tconnectionText(): string\n\t\t{\n\t\t\tlet result = '';\n\n\t\t\tif (this.status === PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\tresult = this.$Bitrix.Loc.getMessage('BX_PULL_STATUS_ONLINE');\n\t\t\t}\n\t\t\telse if (this.status === PullClient.PullStatus.Offline)\n\t\t\t{\n\t\t\t\tresult = this.$Bitrix.Loc.getMessage('BX_PULL_STATUS_OFFLINE');\n\t\t\t}\n\t\t\telse if (this.status === PullClient.PullStatus.Connecting)\n\t\t\t{\n\t\t\t\tresult = this.$Bitrix.Loc.getMessage('BX_PULL_STATUS_CONNECTING');\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tbutton(): ?Object\n\t\t{\n\t\t\tif (this.status === PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tlet hotkey = '';\n\t\t\tlet name = '';\n\n\t\t\tif (this.canReconnect)\n\t\t\t{\n\t\t\t\tname = this.$Bitrix.Loc.getMessage('BX_PULL_STATUS_BUTTON_RECONNECT');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thotkey = Browser.isMac() ? '&#8984;+R' : 'Ctrl+R';\n\t\t\t\tname = this.$Bitrix.Loc.getMessage('BX_PULL_STATUS_BUTTON_RELOAD');\n\t\t\t}\n\n\t\t\treturn { title: name, key: hotkey };\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tstatus()\n\t\t{\n\t\t\tclearTimeout(this.hideTimeout);\n\t\t\tif (this.status !== PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.hideTimeout = setTimeout(() => {\n\t\t\t\tthis.showed = false;\n\t\t\t}, HIDE_TIMEOUT);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.unsubscribeFunction = () => {};\n\t\tthis.initEvents();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.destroyEvents();\n\t},\n\tmethods:\n\t{\n\t\tinitEvents()\n\t\t{\n\t\t\tif (this.$Bitrix.PullClient.get())\n\t\t\t{\n\t\t\t\tthis.subscribeToPullStatus();\n\t\t\t}\n\t\t\tthis.$Bitrix.eventEmitter.subscribe(BitrixVue.events.pullClientChange, this.subscribeToPullStatus);\n\t\t},\n\t\tdestroyEvents()\n\t\t{\n\t\t\tthis.unsubscribeFunction();\n\t\t\tthis.$Bitrix.eventEmitter.unsubscribe(BitrixVue.events.pullClientChange, this.subscribeToPullStatus);\n\t\t},\n\t\tsubscribeToPullStatus()\n\t\t{\n\t\t\tthis.unsubscribeFunction();\n\t\t\tthis.unsubscribeFunction = this.$Bitrix.PullClient.get().subscribe({\n\t\t\t\ttype: PullClient.SubscriptionType.Status,\n\t\t\t\tcallback: (event) => this.onStatusChange(event.status),\n\t\t\t});\n\t\t},\n\t\treconnect()\n\t\t{\n\t\t\tif (this.canReconnect)\n\t\t\t{\n\t\t\t\tthis.$emit('reconnect');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlocation.reload();\n\t\t\t}\n\t\t},\n\t\tonStatusChange(status)\n\t\t{\n\t\t\tclearTimeout(this.setStatusTimeout);\n\n\t\t\tif (this.status === status)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst validStatuses = [\n\t\t\t\tPullClient.PullStatus.Online,\n\t\t\t\tPullClient.PullStatus.Offline,\n\t\t\t\tPullClient.PullStatus.Connecting,\n\t\t\t];\n\t\t\tif (!validStatuses.includes(status))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet timeout = STATUS_CHANGE_DEFAULT_TIMEOUT;\n\n\t\t\tif (status === PullClient.PullStatus.Connecting)\n\t\t\t{\n\t\t\t\ttimeout = STATUS_CHANGE_CONNECTING_TIMEOUT;\n\t\t\t}\n\t\t\telse if (status === PullClient.PullStatus.Offline)\n\t\t\t{\n\t\t\t\ttimeout = STATUS_CHANGE_OFFLINE_TIMEOUT;\n\t\t\t}\n\n\t\t\tthis.setStatusTimeout = setTimeout(() => {\n\t\t\t\tthis.status = status;\n\t\t\t\tthis.showed = true;\n\t\t\t}, timeout);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-pull-vue3-status\" :class=\"containerClass\">\n\t\t\t<div class=\"bx-pull-vue3-status-wrap\">\n\t\t\t\t<span class=\"bx-pull-vue3-status-text\">{{ connectionText }}</span>\n\t\t\t\t<span v-if=\"button\" class=\"bx-pull-vue3-status-button\" @click=\"reconnect\">\n\t\t\t\t\t<span class=\"bx-pull-vue3-status-button-title\">{{ button.title }}</span>\n\t\t\t\t\t<span class=\"bx-pull-vue3-status-button-key\" v-html=\"button.key\"></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n"],"names":["HIDE_TIMEOUT","STATUS_CHANGE_DEFAULT_TIMEOUT","STATUS_CHANGE_CONNECTING_TIMEOUT","STATUS_CHANGE_OFFLINE_TIMEOUT","PullStatus","name","props","canReconnect","type","Boolean","emits","data","status","PullClient","Online","showed","computed","containerClass","result","visibilityClass","statusClass","push","connectionText","$Bitrix","Loc","getMessage","Offline","Connecting","button","hotkey","Browser","isMac","title","key","watch","clearTimeout","hideTimeout","setTimeout","created","unsubscribeFunction","initEvents","beforeUnmount","destroyEvents","methods","get","subscribeToPullStatus","eventEmitter","subscribe","BitrixVue","events","pullClientChange","unsubscribe","SubscriptionType","Status","callback","event","onStatusChange","reconnect","$emit","location","reload","setStatusTimeout","validStatuses","includes","timeout","template"],"mappings":"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"}