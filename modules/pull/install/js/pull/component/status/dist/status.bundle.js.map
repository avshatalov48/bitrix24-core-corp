{"version":3,"file":"status.bundle.js","sources":["../src/status.js"],"sourcesContent":["/**\n * Bitrix UI\n * Pull connection status Vue component\n *\n * @package bitrix\n * @subpackage pull\n * @copyright 2001-2019 Bitrix\n */\n\nimport 'ui.design-tokens';\nimport \"./status.css\";\nimport {BitrixVue} from \"ui.vue\";\nimport {PullClient} from \"pull.client\";\n\nBitrixVue.component('bx-pull-component-status',\n{\n\t/**\n\t * @emits 'reconnect' {} - work only with props.canReconnect = true\n\t */\n\tprops:\n\t{\n\t\tcanReconnect: { default: false }\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tstatus: PullClient.PullStatus.Online,\n\t\t\tshowed: null\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.isMac = navigator.userAgent.toLowerCase().includes('macintosh');\n\n\t\tthis.setStatusTimeout = null;\n\t\tthis.hideTimeout = null;\n\n\t\tthis.pullUnSubscribe = () => {};\n\n\t\tif (this.$Bitrix.PullClient.get())\n\t\t{\n\t\t\tthis.subscribe();\n\t\t}\n\t\tthis.$Bitrix.eventEmitter.subscribe(BitrixVue.events.pullClientChange, () => this.subscribe());\n\n\t\twindow.component = this;\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.pullUnSubscribe();\n\t},\n\tmethods:\n\t{\n\t\tsubscribe()\n\t\t{\n\t\t\tthis.pullUnSubscribe();\n\t\t\tthis.pullUnSubscribe = this.$Bitrix.PullClient.get().subscribe({\n\t\t\t\ttype: PullClient.SubscriptionType.Status,\n\t\t\t\tcallback: event => this.statusChange(event.status)\n\t\t\t});\n\t\t},\n\t\treconnect()\n\t\t{\n\t\t\tif (this.canReconnect)\n\t\t\t{\n\t\t\t\tthis.$emit('reconnect');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlocation.reload();\n\t\t\t}\n\t\t},\n\t\tstatusChange(status)\n\t\t{\n\t\t\tclearTimeout(this.setStatusTimeout);\n\n\t\t\tif (this.status === status)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet validStatus = [\n\t\t\t\tPullClient.PullStatus.Online,\n\t\t\t\tPullClient.PullStatus.Offline,\n\t\t\t\tPullClient.PullStatus.Connecting\n\t\t\t];\n\t\t\tif (validStatus.indexOf(status) < 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet timeout = 500;\n\n\t\t\tif (status === PullClient.PullStatus.Connecting)\n\t\t\t{\n\t\t\t\ttimeout = 5000;\n\t\t\t}\n\t\t\telse if (status === PullClient.PullStatus.Offline)\n\t\t\t{\n\t\t\t\ttimeout = 2000;\n\t\t\t}\n\n\t\t\tthis.setStatusTimeout = setTimeout(() => {\n\t\t\t\tthis.status = status;\n\t\t\t\tthis.showed = true;\n\t\t\t}, timeout);\n\n\t\t\treturn true;\n\t\t},\n\t\tisMobile()\n\t\t{\n\t\t\treturn navigator.userAgent.toLowerCase().includes('android')\n\t\t\t|| navigator.userAgent.toLowerCase().includes('webos')\n\t\t\t|| navigator.userAgent.toLowerCase().includes('iphone')\n\t\t\t|| navigator.userAgent.toLowerCase().includes('ipad')\n\t\t\t|| navigator.userAgent.toLowerCase().includes('ipod')\n\t\t\t|| navigator.userAgent.toLowerCase().includes('blackberry')\n\t\t\t|| navigator.userAgent.toLowerCase().includes('windows phone')\n\t\t}\n\t},\n\twatch:\n\t{\n\t\tstatus()\n\t\t{\n\t\t\tclearTimeout(this.hideTimeout);\n\t\t\tif (this.status === PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\tclearTimeout(this.hideTimeout);\n\t\t\t\tthis.hideTimeout = setTimeout(() => this.showed = false, 4000);\n\t\t\t}\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tconnectionClass()\n\t\t{\n\t\t\tlet result = '';\n\t\t\tif (this.showed === true)\n\t\t\t{\n\t\t\t\tresult = \"bx-pull-status-show\";\n\t\t\t}\n\t\t\telse if (this.showed === false)\n\t\t\t{\n\t\t\t\tresult = \"bx-pull-status-hide\";\n\t\t\t}\n\n\t\t\tif (this.status === PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\tresult += \" bx-pull-status-online\";\n\t\t\t}\n\t\t\telse if (this.status === PullClient.PullStatus.Offline)\n\t\t\t{\n\t\t\t\tresult += \" bx-pull-status-offline\";\n\t\t\t}\n\t\t\telse if (this.status === PullClient.PullStatus.Connecting)\n\t\t\t{\n\t\t\t\tresult += \" bx-pull-status-connecting\";\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tconnectionText()\n\t\t{\n\t\t\tlet result = '';\n\n\t\t\tif (this.status === PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\tresult = this.localize.BX_PULL_STATUS_ONLINE;\n\t\t\t}\n\t\t\telse if (this.status === PullClient.PullStatus.Offline)\n\t\t\t{\n\t\t\t\tresult = this.localize.BX_PULL_STATUS_OFFLINE;\n\t\t\t}\n\t\t\telse if (this.status === PullClient.PullStatus.Connecting)\n\t\t\t{\n\t\t\t\tresult = this.localize.BX_PULL_STATUS_CONNECTING;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tbutton()\n\t\t{\n\t\t\tlet hotkey = '';\n\t\t\tlet name = '';\n\n\t\t\tif (this.canReconnect)\n\t\t\t{\n\t\t\t\tname = this.localize.BX_PULL_STATUS_BUTTON_RECONNECT;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thotkey = this.isMac? '&#8984;+R': \"Ctrl+R\";\n\t\t\t\tname = this.localize.BX_PULL_STATUS_BUTTON_RELOAD;\n\t\t\t}\n\n\t\t\treturn {title: name, key: hotkey};\n\t\t},\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases('BX_PULL_STATUS_', this);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div v-if=\"!isMobile()\" :class=\"['bx-pull-status', connectionClass]\">\n\t\t\t<div class=\"bx-pull-status-wrap\">\n\t\t\t\t<span class=\"bx-pull-status-text\">{{connectionText}}</span>\n\t\t\t\t<span class=\"bx-pull-status-button\" @click=\"reconnect\">\n\t\t\t\t\t<span class=\"bx-pull-status-button-title\">{{button.title}}</span>\n\t\t\t\t\t<span class=\"bx-pull-status-button-key\" v-html=\"button.key\"></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`\n});"],"names":["BitrixVue","component","props","canReconnect","data","status","PullClient","PullStatus","Online","showed","created","isMac","navigator","userAgent","toLowerCase","includes","setStatusTimeout","hideTimeout","pullUnSubscribe","$Bitrix","get","subscribe","eventEmitter","events","pullClientChange","window","beforeDestroy","methods","type","SubscriptionType","Status","callback","event","statusChange","reconnect","$emit","location","reload","clearTimeout","validStatus","Offline","Connecting","indexOf","timeout","setTimeout","isMobile","watch","computed","connectionClass","result","connectionText","localize","BX_PULL_STATUS_ONLINE","BX_PULL_STATUS_OFFLINE","BX_PULL_STATUS_CONNECTING","button","hotkey","name","BX_PULL_STATUS_BUTTON_RECONNECT","BX_PULL_STATUS_BUTTON_RELOAD","title","key","getFilteredPhrases","template"],"mappings":"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"}