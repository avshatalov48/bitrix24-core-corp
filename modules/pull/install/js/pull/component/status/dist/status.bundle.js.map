{"version":3,"file":"status.bundle.js","sources":["../src/status.js"],"sourcesContent":["/**\n * Bitrix UI\n * Pull connection status Vue component\n *\n * @package bitrix\n * @subpackage pull\n * @copyright 2001-2019 Bitrix\n */\n\nimport 'ui.design-tokens';\nimport \"./status.css\";\nimport {BitrixVue} from \"ui.vue\";\nimport {PullClient} from \"pull.client\";\n\nBitrixVue.component('bx-pull-component-status',\n{\n\t/**\n\t * @emits 'reconnect' {} - work only with props.canReconnect = true\n\t */\n\tprops:\n\t{\n\t\tcanReconnect: { default: false }\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tstatus: PullClient.PullStatus.Online,\n\t\t\tshowed: null\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.isMac = navigator.userAgent.toLowerCase().includes('macintosh');\n\n\t\tthis.setStatusTimeout = null;\n\t\tthis.hideTimeout = null;\n\n\t\tthis.pullUnSubscribe = () => {};\n\n\t\tif (this.$Bitrix.PullClient.get())\n\t\t{\n\t\t\tthis.subscribe();\n\t\t}\n\t\tthis.$Bitrix.eventEmitter.subscribe(BitrixVue.events.pullClientChange, () => this.subscribe());\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.pullUnSubscribe();\n\t},\n\tmethods:\n\t{\n\t\tsubscribe()\n\t\t{\n\t\t\tthis.pullUnSubscribe();\n\t\t\tthis.pullUnSubscribe = this.$Bitrix.PullClient.get().subscribe({\n\t\t\t\ttype: PullClient.SubscriptionType.Status,\n\t\t\t\tcallback: event => this.statusChange(event.status)\n\t\t\t});\n\t\t},\n\t\treconnect()\n\t\t{\n\t\t\tif (this.canReconnect)\n\t\t\t{\n\t\t\t\tthis.$emit('reconnect');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlocation.reload();\n\t\t\t}\n\t\t},\n\t\tstatusChange(status)\n\t\t{\n\t\t\tclearTimeout(this.setStatusTimeout);\n\n\t\t\tif (this.status === status)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet validStatus = [\n\t\t\t\tPullClient.PullStatus.Online,\n\t\t\t\tPullClient.PullStatus.Offline,\n\t\t\t\tPullClient.PullStatus.Connecting\n\t\t\t];\n\t\t\tif (validStatus.indexOf(status) < 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet timeout = 500;\n\n\t\t\tif (status === PullClient.PullStatus.Connecting)\n\t\t\t{\n\t\t\t\ttimeout = 5000;\n\t\t\t}\n\t\t\telse if (status === PullClient.PullStatus.Offline)\n\t\t\t{\n\t\t\t\ttimeout = 2000;\n\t\t\t}\n\n\t\t\tthis.setStatusTimeout = setTimeout(() => {\n\t\t\t\tthis.status = status;\n\t\t\t\tthis.showed = true;\n\t\t\t}, timeout);\n\n\t\t\treturn true;\n\t\t},\n\t\tisMobile()\n\t\t{\n\t\t\treturn navigator.userAgent.toLowerCase().includes('android')\n\t\t\t|| navigator.userAgent.toLowerCase().includes('webos')\n\t\t\t|| navigator.userAgent.toLowerCase().includes('iphone')\n\t\t\t|| navigator.userAgent.toLowerCase().includes('ipad')\n\t\t\t|| navigator.userAgent.toLowerCase().includes('ipod')\n\t\t\t|| navigator.userAgent.toLowerCase().includes('blackberry')\n\t\t\t|| navigator.userAgent.toLowerCase().includes('windows phone')\n\t\t}\n\t},\n\twatch:\n\t{\n\t\tstatus()\n\t\t{\n\t\t\tclearTimeout(this.hideTimeout);\n\t\t\tif (this.status === PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\tclearTimeout(this.hideTimeout);\n\t\t\t\tthis.hideTimeout = setTimeout(() => this.showed = false, 4000);\n\t\t\t}\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tconnectionClass()\n\t\t{\n\t\t\tlet result = '';\n\t\t\tif (this.showed === true)\n\t\t\t{\n\t\t\t\tresult = \"bx-pull-status-show\";\n\t\t\t}\n\t\t\telse if (this.showed === false)\n\t\t\t{\n\t\t\t\tresult = \"bx-pull-status-hide\";\n\t\t\t}\n\n\t\t\tif (this.status === PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\tresult += \" bx-pull-status-online\";\n\t\t\t}\n\t\t\telse if (this.status === PullClient.PullStatus.Offline)\n\t\t\t{\n\t\t\t\tresult += \" bx-pull-status-offline\";\n\t\t\t}\n\t\t\telse if (this.status === PullClient.PullStatus.Connecting)\n\t\t\t{\n\t\t\t\tresult += \" bx-pull-status-connecting\";\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tconnectionText()\n\t\t{\n\t\t\tlet result = '';\n\n\t\t\tif (this.status === PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\tresult = this.localize.BX_PULL_STATUS_ONLINE;\n\t\t\t}\n\t\t\telse if (this.status === PullClient.PullStatus.Offline)\n\t\t\t{\n\t\t\t\tresult = this.localize.BX_PULL_STATUS_OFFLINE;\n\t\t\t}\n\t\t\telse if (this.status === PullClient.PullStatus.Connecting)\n\t\t\t{\n\t\t\t\tresult = this.localize.BX_PULL_STATUS_CONNECTING;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tbutton()\n\t\t{\n\t\t\tlet hotkey = '';\n\t\t\tlet name = '';\n\n\t\t\tif (this.canReconnect)\n\t\t\t{\n\t\t\t\tname = this.localize.BX_PULL_STATUS_BUTTON_RECONNECT;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thotkey = this.isMac? '&#8984;+R': \"Ctrl+R\";\n\t\t\t\tname = this.localize.BX_PULL_STATUS_BUTTON_RELOAD;\n\t\t\t}\n\n\t\t\treturn {title: name, key: hotkey};\n\t\t},\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases('BX_PULL_STATUS_', this);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div v-if=\"!isMobile()\" :class=\"['bx-pull-status', connectionClass]\">\n\t\t\t<div class=\"bx-pull-status-wrap\">\n\t\t\t\t<span class=\"bx-pull-status-text\">{{connectionText}}</span>\n\t\t\t\t<span class=\"bx-pull-status-button\" @click=\"reconnect\">\n\t\t\t\t\t<span class=\"bx-pull-status-button-title\">{{button.title}}</span>\n\t\t\t\t\t<span class=\"bx-pull-status-button-key\" v-html=\"button.key\"></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`\n});"],"names":["BitrixVue","component","props","canReconnect","data","status","PullClient","PullStatus","Online","showed","created","isMac","navigator","userAgent","toLowerCase","includes","setStatusTimeout","hideTimeout","pullUnSubscribe","$Bitrix","get","subscribe","eventEmitter","events","pullClientChange","beforeDestroy","methods","type","SubscriptionType","Status","callback","event","statusChange","reconnect","$emit","location","reload","clearTimeout","validStatus","Offline","Connecting","indexOf","timeout","setTimeout","isMobile","watch","computed","connectionClass","result","connectionText","localize","BX_PULL_STATUS_ONLINE","BX_PULL_STATUS_OFFLINE","BX_PULL_STATUS_CONNECTING","button","hotkey","name","BX_PULL_STATUS_BUTTON_RECONNECT","BX_PULL_STATUS_BUTTON_RELOAD","title","key","getFilteredPhrases","template"],"mappings":";;;;CAAA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;AAOAA,iBAAS,CAACC,SAAS,CAAC,0BAA0B,EAC9C;;CAEA;CACA;GACCC,KAAK,EACL;KACCC,YAAY,EAAE;OAAE,WAAS;;IACzB;GACDC,IAAI,kBACJ;KACC,OAAO;OACNC,MAAM,EAAEC,sBAAU,CAACC,UAAU,CAACC,MAAM;OACpCC,MAAM,EAAE;MACR;IACD;GACDC,OAAO,qBACP;KAAA;KACC,IAAI,CAACC,KAAK,GAAGC,SAAS,CAACC,SAAS,CAACC,WAAW,EAAE,CAACC,QAAQ,CAAC,WAAW,CAAC;KAEpE,IAAI,CAACC,gBAAgB,GAAG,IAAI;KAC5B,IAAI,CAACC,WAAW,GAAG,IAAI;KAEvB,IAAI,CAACC,eAAe,GAAG,YAAM,EAAE;KAE/B,IAAI,IAAI,CAACC,OAAO,CAACb,UAAU,CAACc,GAAG,EAAE,EACjC;OACC,IAAI,CAACC,SAAS,EAAE;;KAEjB,IAAI,CAACF,OAAO,CAACG,YAAY,CAACD,SAAS,CAACrB,gBAAS,CAACuB,MAAM,CAACC,gBAAgB,EAAE;OAAA,OAAM,KAAI,CAACH,SAAS,EAAE;OAAC;IAC9F;GACDI,aAAa,2BACb;KACC,IAAI,CAACP,eAAe,EAAE;IACtB;GACDQ,OAAO,EACP;KACCL,SAAS,uBACT;OAAA;OACC,IAAI,CAACH,eAAe,EAAE;OACtB,IAAI,CAACA,eAAe,GAAG,IAAI,CAACC,OAAO,CAACb,UAAU,CAACc,GAAG,EAAE,CAACC,SAAS,CAAC;SAC9DM,IAAI,EAAErB,sBAAU,CAACsB,gBAAgB,CAACC,MAAM;SACxCC,QAAQ,EAAE,kBAAAC,KAAK;WAAA,OAAI,MAAI,CAACC,YAAY,CAACD,KAAK,CAAC1B,MAAM,CAAC;;QAClD,CAAC;MACF;KACD4B,SAAS,uBACT;OACC,IAAI,IAAI,CAAC9B,YAAY,EACrB;SACC,IAAI,CAAC+B,KAAK,CAAC,WAAW,CAAC;QACvB,MAED;SACCC,QAAQ,CAACC,MAAM,EAAE;;MAElB;KACDJ,YAAY,wBAAC3B,MAAM,EACnB;OAAA;OACCgC,YAAY,CAAC,IAAI,CAACrB,gBAAgB,CAAC;OAEnC,IAAI,IAAI,CAACX,MAAM,KAAKA,MAAM,EAC1B;SACC,OAAO,KAAK;;OAGb,IAAIiC,WAAW,GAAG,CACjBhC,sBAAU,CAACC,UAAU,CAACC,MAAM,EAC5BF,sBAAU,CAACC,UAAU,CAACgC,OAAO,EAC7BjC,sBAAU,CAACC,UAAU,CAACiC,UAAU,CAChC;OACD,IAAIF,WAAW,CAACG,OAAO,CAACpC,MAAM,CAAC,GAAG,CAAC,EACnC;SACC,OAAO,KAAK;;OAGb,IAAIqC,OAAO,GAAG,GAAG;OAEjB,IAAIrC,MAAM,KAAKC,sBAAU,CAACC,UAAU,CAACiC,UAAU,EAC/C;SACCE,OAAO,GAAG,IAAI;QACd,MACI,IAAIrC,MAAM,KAAKC,sBAAU,CAACC,UAAU,CAACgC,OAAO,EACjD;SACCG,OAAO,GAAG,IAAI;;OAGf,IAAI,CAAC1B,gBAAgB,GAAG2B,UAAU,CAAC,YAAM;SACxC,MAAI,CAACtC,MAAM,GAAGA,MAAM;SACpB,MAAI,CAACI,MAAM,GAAG,IAAI;QAClB,EAAEiC,OAAO,CAAC;OAEX,OAAO,IAAI;MACX;KACDE,QAAQ,sBACR;OACC,OAAOhC,SAAS,CAACC,SAAS,CAACC,WAAW,EAAE,CAACC,QAAQ,CAAC,SAAS,CAAC,IACzDH,SAAS,CAACC,SAAS,CAACC,WAAW,EAAE,CAACC,QAAQ,CAAC,OAAO,CAAC,IACnDH,SAAS,CAACC,SAAS,CAACC,WAAW,EAAE,CAACC,QAAQ,CAAC,QAAQ,CAAC,IACpDH,SAAS,CAACC,SAAS,CAACC,WAAW,EAAE,CAACC,QAAQ,CAAC,MAAM,CAAC,IAClDH,SAAS,CAACC,SAAS,CAACC,WAAW,EAAE,CAACC,QAAQ,CAAC,MAAM,CAAC,IAClDH,SAAS,CAACC,SAAS,CAACC,WAAW,EAAE,CAACC,QAAQ,CAAC,YAAY,CAAC,IACxDH,SAAS,CAACC,SAAS,CAACC,WAAW,EAAE,CAACC,QAAQ,CAAC,eAAe,CAAC;;IAE/D;GACD8B,KAAK,EACL;KACCxC,MAAM,oBACN;OAAA;OACCgC,YAAY,CAAC,IAAI,CAACpB,WAAW,CAAC;OAC9B,IAAI,IAAI,CAACZ,MAAM,KAAKC,sBAAU,CAACC,UAAU,CAACC,MAAM,EAChD;SACC6B,YAAY,CAAC,IAAI,CAACpB,WAAW,CAAC;SAC9B,IAAI,CAACA,WAAW,GAAG0B,UAAU,CAAC;WAAA,OAAM,MAAI,CAAClC,MAAM,GAAG,KAAK;YAAE,IAAI,CAAC;;;IAGhE;GACDqC,QAAQ,EACR;KACCC,eAAe,6BACf;OACC,IAAIC,MAAM,GAAG,EAAE;OACf,IAAI,IAAI,CAACvC,MAAM,KAAK,IAAI,EACxB;SACCuC,MAAM,GAAG,qBAAqB;QAC9B,MACI,IAAI,IAAI,CAACvC,MAAM,KAAK,KAAK,EAC9B;SACCuC,MAAM,GAAG,qBAAqB;;OAG/B,IAAI,IAAI,CAAC3C,MAAM,KAAKC,sBAAU,CAACC,UAAU,CAACC,MAAM,EAChD;SACCwC,MAAM,IAAI,wBAAwB;QAClC,MACI,IAAI,IAAI,CAAC3C,MAAM,KAAKC,sBAAU,CAACC,UAAU,CAACgC,OAAO,EACtD;SACCS,MAAM,IAAI,yBAAyB;QACnC,MACI,IAAI,IAAI,CAAC3C,MAAM,KAAKC,sBAAU,CAACC,UAAU,CAACiC,UAAU,EACzD;SACCQ,MAAM,IAAI,4BAA4B;;OAGvC,OAAOA,MAAM;MACb;KACDC,cAAc,4BACd;OACC,IAAID,MAAM,GAAG,EAAE;OAEf,IAAI,IAAI,CAAC3C,MAAM,KAAKC,sBAAU,CAACC,UAAU,CAACC,MAAM,EAChD;SACCwC,MAAM,GAAG,IAAI,CAACE,QAAQ,CAACC,qBAAqB;QAC5C,MACI,IAAI,IAAI,CAAC9C,MAAM,KAAKC,sBAAU,CAACC,UAAU,CAACgC,OAAO,EACtD;SACCS,MAAM,GAAG,IAAI,CAACE,QAAQ,CAACE,sBAAsB;QAC7C,MACI,IAAI,IAAI,CAAC/C,MAAM,KAAKC,sBAAU,CAACC,UAAU,CAACiC,UAAU,EACzD;SACCQ,MAAM,GAAG,IAAI,CAACE,QAAQ,CAACG,yBAAyB;;OAGjD,OAAOL,MAAM;MACb;KACDM,MAAM,oBACN;OACC,IAAIC,MAAM,GAAG,EAAE;OACf,IAAIC,IAAI,GAAG,EAAE;OAEb,IAAI,IAAI,CAACrD,YAAY,EACrB;SACCqD,IAAI,GAAG,IAAI,CAACN,QAAQ,CAACO,+BAA+B;QACpD,MAED;SACCF,MAAM,GAAG,IAAI,CAAC5C,KAAK,GAAE,WAAW,GAAE,QAAQ;SAC1C6C,IAAI,GAAG,IAAI,CAACN,QAAQ,CAACQ,4BAA4B;;OAGlD,OAAO;SAACC,KAAK,EAAEH,IAAI;SAAEI,GAAG,EAAEL;QAAO;MACjC;KACDL,QAAQ,sBACR;OACC,OAAOlD,gBAAS,CAAC6D,kBAAkB,CAAC,iBAAiB,EAAE,IAAI,CAAC;;IAE7D;GACDC,QAAQ;CAWT,CAAC,CAAC;;;;"}