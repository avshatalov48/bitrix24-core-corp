jn.define("bizproc/task/buttons",((t,s,e)=>{const n=t("apptheme");const{Alert:i}=t("alert");const{EventEmitter:o}=t("event-emitter");const{Haptics:r}=t("haptics");const{Loc:a}=t("loc");const{Type:u}=t("type");const{isFunction:c,isObjectLike:h}=t("utils/object");const{useCallback:l}=t("utils/function");const{PureComponent:p}=t("layout/pure-component");const{TaskUserStatus:T}=t("bizproc/task/task-constants");const{ButtonsWrapper:d}=t("bizproc/task/buttons/buttons-wrapper");const{Button:B}=t("bizproc/task/buttons/button");const{AcceptButton:k}=t("bizproc/task/buttons/accept-button");const{DeclineButton:g}=t("bizproc/task/buttons/decline-button");const{StartButton:S}=t("bizproc/task/buttons/start-button");const{DetailButton:f}=t("bizproc/task/buttons/detail-button");const{DelegateButton:I}=t("bizproc/task/buttons/delegate-button");class b extends p{constructor(t){super(t);this.testId=u.isStringFilled(t.testId)?t.testId:"MBP_TASK_BUTTONS";this.uid=t.uid||"bizproc";if(this.shouldUseEvents){this.customEventEmitter=o.createWithUid(this.uid)}this.onTaskTouch=this.onTaskTouch.bind(this);this.onStartClick=this.onStartClick.bind(this)}get shouldUseEvents(){return BX.prop.getBoolean(this.props,"shouldUseEvents",true)}componentDidMount(){if(this.shouldUseEvents){this.customEventEmitter.on("Task:onTouch",this.onTaskTouch)}}componentWillUnmount(){if(this.shouldUseEvents){this.customEventEmitter.off("Task:onTouch",this.onTaskTouch)}}onTaskTouch({task:t}){if(t.id===this.task.id&&this.props.isInline){this.setIsDoing(true)}}onStartClick(){void requireLazy("bizproc:task/details").then((({TaskDetails:t})=>{void t.open(this.props.layout,{taskId:this.task.id,title:this.props.title})}))}get task(){return this.props.task||{}}render(){return d({ref:t=>{this.elementRef=t}},this.renderIsDoing(),...this.getButtons())}getButtons(){const t=this.task;let s=[];if(this.state.isDoing){return s}if(this.props.isInline&&!t.isInline){s.push(this.renderStartButton(a.getMessage("BPMOBILE_TASK_BUTTONS_DETAILS"),this.onStartClick))}else if(t.buttons&&t.buttons.length>0){s=t.buttons.map((s=>{if(T.isDecline(s.TARGET_USER_STATUS)){return this.renderDeclineButton(s.TEXT,l((()=>{r.notifySuccess();this.onTaskButtonAction(t,s)})))}return this.renderAcceptButton(s.TEXT,l((()=>{r.impactMedium();this.onTaskButtonAction(t,s)})))}))}if(s.length<2&&this.props.isInline){s.push(this.renderDetailButton(a.getMessage("BPMOBILE_TASK_BUTTONS_DETAILS_LINK")))}return s}renderIsDoing(){if(this.state.isDoing!==true){return null}return View({},Text({text:a.getMessage("BPMOBILE_TASK_BUTTONS_STATUS_LABEL"),style:E.statusTitle}),Text({testId:`${this.testId}_STATUS_TEXT`,text:a.getMessage("BPMOBILE_TASK_BUTTONS_STATUS_IS_DOING"),style:E.statusText,numberOfLines:1,ellipsize:"end"}))}renderStartButton(t,s){return new S({style:this.alignButton(m.start),testId:`${this.testId}_BUTTON_START`,text:t,onClick:s})}renderAcceptButton(t,s){return new k({style:this.alignButton(m.accept),testId:`${this.testId}_BUTTON_ACCEPT`,text:t,onClick:s})}renderDeclineButton(t,s){return new g({style:this.alignButton(m.decline),testId:`${this.testId}_BUTTON_DECLINE`,text:t,onClick:s})}alignButton(t){const s=!this.props.isInline&&this.task.buttons.length===1;const e={width:s?"100%":"50%",maxWidth:s?"100%":"50%",fontSize:this.props.isInline?15:14};if(s){e.marginRight=0}return{...t,...e}}renderDetailButton(t){return new f({layout:this.props.layout,text:t,testId:`${this.testId}_BUTTON_DETAILS`,taskId:this.task.id,title:this.props.title})}onTaskButtonAction(t,s){const e={taskId:t.id,taskRequest:{INLINE_USER_STATUS:s.TARGET_USER_STATUS}};const n=c(this.props.onBeforeAction)?this.props.onBeforeAction(t,s):null;const i=c(n?.then)?n:Promise.resolve(n);i.then((t=>{if(!u.isNil(t)){e.taskRequest.fields=t}this.doTask(e)})).catch((()=>{}))}doTask(t){if(this.shouldUseEvents){this.customEventEmitter.emit("Task:onTouch",{task:this.task,isInline:this.props.isInline})}const s=()=>BX.ajax.runAction("bizprocmobile.Task.do",{data:t});const e=BX.prop.getFunction(this.props,"onTaskButtonClick",s);const n=e(t,s);const o=s=>{if(c(this.props.onComplete)){this.props.onComplete(s.data,t)}};const r=({errors:t})=>{if(c(this.props.onFail)){this.props.onFail(t)}else{i.alert(t.pop().message)}};if(h(n)){if(c(n.then)){n.then(o).catch(r)}else if(n.data){o(n.data)}else if(n.errors){r(n.errors)}}}setIsDoing(t){if(t===this.state.isDoing){return}if(!this.elementRef){return}const s=300;const e=0;this.elementRef.animate({duration:s,opacity:e},(()=>{this.setState({isDoing:t},(()=>{this.elementRef.animate({duration:s,opacity:1},(()=>{this.state.isDoing=!t}))}))}))}}const m={accept:{marginLeft:0,marginRight:6},decline:{marginLeft:6,marginRight:0},start:{marginLeft:0,marginRight:6}};const E={statusTitle:{fontSize:11,height:14,fontWeight:"400",color:n.colors.base4},statusText:{fontSize:14,height:17,fontWeight:"400",color:n.colors.base1}};e.exports={TaskButtons:b,Button:B,ButtonsWrapper:d,DetailButton:f,AcceptButton:k,DeclineButton:g,StartButton:S,DelegateButton:I}}));
//# sourceMappingURL=extension.map.js