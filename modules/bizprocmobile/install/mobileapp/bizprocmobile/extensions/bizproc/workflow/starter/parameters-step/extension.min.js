jn.define("bizproc/workflow/starter/parameters-step",((t,e,i)=>{const{Loc:r}=t("loc");const{EventEmitter:s}=t("event-emitter");const{NotifyManager:o}=t("notify-manager");const{WizardStep:n}=t("layout/ui/wizard/step");const{FocusManager:a}=t("layout/ui/fields/focus-manager");const{ProgressBarNumber:d}=t("bizproc/wizard/progress-bar-number");const{ParametersStepComponent:l}=t("bizproc/workflow/starter/parameters-step/component");class p extends n{constructor(t){super(t);this.uid=t.uid||Random.getString();this.customEventEmitter=s.createWithUid(this.uid);this.templateId=t.templateId||null;this.prevTemplateId=null;this.editorConfig=null;this.prevEditorConfig=null;this.component=null;this.componentRefCallback=t=>{this.component=t};this.subscribeOnEvents()}subscribeOnEvents(){this.customEventEmitter.on("ParametersStepComponent:OnAfterLoadEditor",(({editorConfig:t,hasErrors:e})=>{this.editorConfig=t;if(this.prevEditorConfig===null){this.prevEditorConfig=this.editorConfig}this.stepAvailabilityChangeCallback(!e);if(e){this.editorConfig=null;this.prevEditorConfig=null}})).on("ParametersStepComponent:OnFieldChangeState",(()=>{this.customEventEmitter.emit("ParametersStep:OnFieldChangeState")}))}get isLoaded(){return this.editorConfig!==null}updateProps(t){if(this.isLoaded){this.prevTemplateId=this.templateId;this.prevEditorConfig=this.editorConfig;this.editorConfig=null}this.templateId=t.templateId===undefined?this.templateId:t.templateId}get isPreviousSelectedTemplateId(){return this.prevTemplateId===this.templateId}onEnterStep(){super.onEnterStep();if(this.isPreviousSelectedTemplateId){this.editorConfig=this.prevEditorConfig;this.stepAvailabilityChangeCallback(true)}if(!this.isLoaded){this.stepAvailabilityChangeCallback(false)}}async onMoveToBackStep(t){await o.showLoadingIndicator();return new Promise((t=>{this.prevTemplateId=this.templateId;this.prevEditorConfig=this.editorConfig;this.editorConfig=null;this.component.getData().then((t=>{if(this.prevEditorConfig){this.prevEditorConfig.ENTITY_DATA=Object.assign(this.prevEditorConfig.ENTITY_DATA,t)}})).catch((t=>{console.error(t)})).finally((()=>{o.hideLoadingIndicator(true);t()}))}))}renderNumberBlock(){return new d({isCompleted:false,number:this.props.stepNumber})}getProgressBarSettings(){return{...super.getProgressBarSettings(),isEnabled:true,title:{text:r.getMessage("M_BP_STARTER_PARAMETERS_STEP_TITLE")},number:this.props.stepNumber,count:this.props.totalSteps}}getTitle(){return this.props.title||""}getNextStepButtonText(){return r.getMessage("M_BP_STARTER_PARAMETERS_STEP_FINISH_BUTTON_TEXT")}isNextStepEnabled(){return this.isLoaded}isPrevStepEnabled(){return this.isLoaded}async onMoveToNextStep(t){await o.showLoadingIndicator();return new Promise((t=>{a.blurFocusedFieldIfHas().then((()=>this.component.validate())).then((()=>this.component.getData())).then((t=>this.startWorkflow(t))).then((()=>{o.hideLoadingIndicator(true,r.getMessage("M_BP_STARTER_PARAMETERS_STEP_SUCCESS_MESSAGE"),1500);setTimeout((()=>t({finish:true,next:true})),1500)})).catch((e=>{o.hideLoadingIndicator(false);console.error(e);if(Array.isArray(e)){o.showErrors(e)}t({finish:false,next:false})}))}))}startWorkflow(t){return new Promise(((e,i)=>{BX.ajax.runAction("bizprocmobile.Workflow.start",{data:{signedDocument:this.props.signedDocument,templateId:this.templateId,parameters:t}}).then((()=>e())).catch((t=>i(t.errors)))}))}createLayout(t){return new l({layout:this.props.layout,uid:this.uid,templateId:this.templateId,signedDocument:this.props.signedDocument,editorConfig:this.isPreviousSelectedTemplateId?this.prevEditorConfig:this.editorConfig,ref:this.componentRefCallback})}}i.exports={ParametersStep:p}}));
//# sourceMappingURL=extension.map.js