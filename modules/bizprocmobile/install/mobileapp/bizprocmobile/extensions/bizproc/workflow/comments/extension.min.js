jn.define("bizproc/workflow/comments",((e,t,o)=>{const n=e("apptheme");const{Loc:i}=e("loc");const{PureComponent:s}=e("layout/pure-component");class r extends s{static getHeight(){return 56}constructor(e){super(e);this.containerRef=null;this.handleClick=this.onCommentsClick.bind(this);this.handlePullEvent=this.processPullEvent.bind(this);this.state={visible:true,commentsCount:e.commentCounter?.all,newCommentsCount:e.commentCounter?.new}}componentWillReceiveProps(e){this.state={...this.state,commentsCount:e.commentCounter?.all,newCommentsCount:e.commentCounter?.new}}componentDidMount(){Keyboard.on(Keyboard.Event.WillShow,(()=>{if(this.state.visible===true&&this.containerRef){this.containerRef.animate({opacity:0,duration:300},(()=>{this.setState({visible:false})}))}}));Keyboard.on(Keyboard.Event.WillHide,(()=>{if(this.state.visible===false&&this.containerRef){this.containerRef.animate({opacity:1,duration:100},(()=>{this.setState({visible:true})}))}}));this.unsubscribePushCallback=BX.PULL.subscribe({moduleId:"bizproc",callback:this.handlePullEvent})}componentWillUnmount(){if(this.unsubscribePushCallback){this.unsubscribePushCallback()}}processPullEvent(e={}){const{command:t,params:o}=e;if(t==="comment"&&o?.workflowId===this.props.workflowId){this.setState({commentsCount:o.counter?.all,newCommentsCount:o.counter?.new})}}render(){return this.renderFloatingCommentButton()}renderFloatingCommentButton(){let e=this.state.commentsCount>0?this.state.commentsCount:"";if(e>99){e="99+"}const t=this.state.newCommentsCount;return View({style:{flex:1,alignSelf:"center",position:"absolute",bottom:30},safeArea:{bottom:true}},View({style:{display:this.state.visible?"flex":"none",flexDirection:"row",backgroundColor:n.colors.accentExtraDarkblue,paddingHorizontal:24,paddingVertical:12,borderRadius:88},testId:"commentsField",onClick:this.handleClick,ref:e=>{this.containerRef=e}},Text({style:{fontSize:18,fontWeight:"400",color:n.colors.baseWhiteFixed},text:`${i.getMessage("MBP_WORKFLOW_COMMENTS_TITLE")} ${e}`,testId:"commentsFieldCounterAll"}),t>0&&View({style:{marginLeft:8,backgroundColor:n.colors.accentMainSuccess,paddingHorizontal:7,paddingVertical:2,borderRadius:55},testId:"commentsFieldCounterNew"},Text({style:{fontSize:15,fontWeight:"500",color:n.colors.baseWhiteFixed},text:`+${t>99?99:t}`}))))}renderCounter(e=null){let t=this.state.commentsCount;let o=n.colors.base6;let i=n.colors.base3;if(e){t=e.value;if(t>0){o=e.color;i=n.colors.base8}}return View({style:{height:22,justifyContent:"center",alignSelf:"center",marginLeft:8}},View({style:{justifyContent:"center",alignSelf:"center",paddingHorizontal:6,paddingVertical:2,backgroundColor:o,borderRadius:10},testId:"commentsFieldCounterNew"},Text({style:{fontSize:12,fontWeight:"500",color:i},text:t<100?t.toString():"99+"})))}onCommentsClick(){PageManager.openPage({backgroundColor:n.colors.bgSecondary,url:`${env.siteDir}mobile/bp/comments.php?workflowId=${this.props.workflowId}`,backdrop:{mediumPositionPercent:84,onlyMediumPosition:true,forceDismissOnSwipeDown:true,swipeAllowed:true,swipeContentAllowed:true,horizontalSwipeAllowed:false,navigationBarColor:n.colors.bgSecondary,enableNavigationBarBorder:false},titleParams:{text:i.getMessage("MBP_WORKFLOW_COMMENTS_TITLE")},enableNavigationBarBorder:false,loading:{type:"comments"},modal:true,cache:true})}}o.exports={WorkflowComments:r}}));
//# sourceMappingURL=extension.map.js