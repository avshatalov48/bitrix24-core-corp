jn.define("bizproc/workflow/starter",((t,e,s)=>{const i=t("apptheme");const{Loc:o}=t("loc");const{EventEmitter:n}=t("event-emitter");const{Feature:r}=t("feature");const{Haptics:a}=t("haptics");const{confirmClosing:l}=t("alert");const{PureComponent:h}=t("layout/pure-component");const{Wizard:d}=t("layout/ui/wizard");const{CatalogStep:p}=t("bizproc/workflow/starter/catalog-step");const{DescriptionStep:u}=t("bizproc/workflow/starter/description-step");const{ParametersStep:m}=t("bizproc/workflow/starter/parameters-step");class c extends h{static open(t={},e=PageManager){e.openWidget("layout",{modal:true,titleParams:{text:o.getMessage("M_BP_WORKFLOW_STARTER_TITLE")},backgroundColor:i.colors.bgContentPrimary,backdrop:{forceDismissOnSwipeDown:true,hideNavigationBar:false,horizontalSwipeAllowed:false,mediumPositionPercent:90,navigationBarColor:i.colors.bgSecondary,onlyMediumPosition:true,shouldResizeContent:true,swipeAllowed:true,swipeContentAllowed:true},onReady:e=>{e.showComponent(new c({...t,layout:e}))}},e)}constructor(t){super(t);this.uid=t.uid||Random.getString();this.customEventEmitter=n.createWithUid(this.uid);this.signedDocument=t.signedDocument||null;this.documentType=t.documentType||null;this.wizard=null;this.isClosing=false;this.isChanged=false;this.selectedTemplateId=null;this.steps=[];this.initSteps();this.handleSelectTemplate=this.handleSelectTemplate.bind(this);this.handleEditorChangeFields=this.handleEditorChangeFields.bind(this);this.handleExit=this.handleExit.bind(this)}get layout(){return this.props.layout||layout||{}}componentDidMount(){if(r.isPreventBottomSheetDismissSupported()){this.layout.preventBottomSheetDismiss(true);this.layout.on("preventDismiss",this.handleExit)}this.customEventEmitter.on("CatalogStep:OnSelectTemplate",this.handleSelectTemplate).on("ParametersStep:OnFieldChangeState",this.handleEditorChangeFields)}componentWillUnmount(){if(r.isPreventBottomSheetDismissSupported()){this.layout.preventBottomSheetDismiss(false);this.layout.off("preventDismiss",this.handleExit)}this.customEventEmitter.off("CatalogStep:OnSelectTemplate",this.handleSelectTemplate).off("ParametersStep:OnFieldChangeState",this.handleEditorChangeFields)}handleSelectTemplate(t){this.selectedTemplateId=t.key;const e=this.steps[1];if(e){e.updateProps({templateId:this.selectedTemplateId,name:t.name||"",description:t.description||"",hasParameters:t.hasParameters,isConstantsTuned:t.isConstantsTuned,formattedTime:t.formattedTime})}const s=this.steps[2];if(s){s.updateProps({templateId:this.selectedTemplateId})}}handleEditorChangeFields(){this.isChanged=true}handleExit(){if(this.isClosing){return Promise.resolve()}let t=Promise.resolve();if(this.isChanged&&this.wizard.getCurrentStepId()!==0){t=t.then((()=>{this.isClosing=true;return this.showConfirmExitAlert()}))}return t.then((()=>this.props.layout.close())).finally((()=>{this.isClosing=false}))}showConfirmExitAlert(){if(this.wizard.getCurrentStepId()===1){return new Promise(((t,e)=>{a.impactLight();l({hasSaveAndClose:false,description:"",onClose:()=>t(),onCancel:()=>{this.wizard.moveToNextStep();e()}})}))}return new Promise(((t,e)=>{a.impactLight();l({description:"",onSave:()=>{this.wizard.getCurrentStep().onMoveToNextStep().then((s=>s.next?t():e())).catch((()=>e()))},onClose:()=>t(),onCancel:()=>e()})}))}initSteps(){const t=3;const e={uid:this.uid,layout:this.layout,title:o.getMessage("M_BP_WORKFLOW_STARTER_TITLE"),totalSteps:t,signedDocument:this.signedDocument};const s=new p({...e,stepNumber:1,documentType:this.documentType});const i=new u({...e,stepNumber:2});const n=new m({...e,stepNumber:3});this.steps=[s,i,n]}render(){return View({style:{backgroundColor:i.colors.bgSecondary}},new d({parentLayout:this.layout,steps:Array.from({length:this.steps.length}).map(((t,e)=>e)),stepForId:this.getStepForId.bind(this),useProgressBar:true,isNavigationBarBorderEnabled:true,showNextStepButtonAtBottom:true,ref:t=>{this.wizard=t}}))}getStepForId(t){return this.steps[t]||null}}s.exports={WorkflowStarter:c}}));
//# sourceMappingURL=extension.map.js