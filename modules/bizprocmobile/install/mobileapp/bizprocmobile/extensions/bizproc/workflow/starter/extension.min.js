jn.define("bizproc/workflow/starter",((e,t,s)=>{const i=e("apptheme");const{Loc:o}=e("loc");const{EventEmitter:n}=e("event-emitter");const{Feature:r}=e("feature");const{Haptics:a}=e("haptics");const{Alert:l,ButtonType:h}=e("alert");const{PureComponent:d}=e("layout/pure-component");const{Wizard:p}=e("layout/ui/wizard");const{CatalogStep:u}=e("bizproc/workflow/starter/catalog-step");const{DescriptionStep:m}=e("bizproc/workflow/starter/description-step");const{ParametersStep:c}=e("bizproc/workflow/starter/parameters-step");class T extends d{static open(e={},t=PageManager){t.openWidget("layout",{modal:true,titleParams:{text:o.getMessage("M_BP_WORKFLOW_STARTER_TITLE")},backgroundColor:i.colors.bgContentPrimary,backdrop:{forceDismissOnSwipeDown:true,hideNavigationBar:false,horizontalSwipeAllowed:false,mediumPositionPercent:90,navigationBarColor:i.colors.bgSecondary,onlyMediumPosition:true,shouldResizeContent:true,swipeAllowed:true,swipeContentAllowed:false},onReady:t=>{t.showComponent(new T({...e,layout:t}))}},t)}constructor(e){super(e);this.uid=e.uid||Random.getString();this.customEventEmitter=n.createWithUid(this.uid);this.signedDocument=e.signedDocument||null;this.documentType=e.documentType||null;this.wizard=null;this.isClosing=false;this.isChanged=false;this.selectedTemplateId=null;this.steps=[];this.initSteps();this.handleSelectTemplate=this.handleSelectTemplate.bind(this);this.handleEditorChangeFields=this.handleEditorChangeFields.bind(this);this.handleExit=this.handleExit.bind(this)}get layout(){return this.props.layout||layout||{}}componentDidMount(){if(r.isPreventBottomSheetDismissSupported()){this.layout.preventBottomSheetDismiss(true);this.layout.on("preventDismiss",this.handleExit)}this.customEventEmitter.on("CatalogStep:OnSelectTemplate",this.handleSelectTemplate).on("ParametersStep:OnFieldChangeState",this.handleEditorChangeFields)}componentWillUnmount(){if(r.isPreventBottomSheetDismissSupported()){this.layout.preventBottomSheetDismiss(false);this.layout.off("preventDismiss",this.handleExit)}this.customEventEmitter.off("CatalogStep:OnSelectTemplate",this.handleSelectTemplate).off("ParametersStep:OnFieldChangeState",this.handleEditorChangeFields)}handleSelectTemplate(e){this.selectedTemplateId=e.key;const t=this.steps[1];if(t){t.updateProps({templateId:this.selectedTemplateId,name:e.name||"",description:e.description||"",hasParameters:e.hasParameters,isConstantsTuned:e.isConstantsTuned,formattedTime:e.formattedTime})}const s=this.steps[2];if(s){s.updateProps({templateId:this.selectedTemplateId})}}handleEditorChangeFields(){this.isChanged=true}handleExit(){if(this.isClosing){return Promise.resolve()}let e=Promise.resolve();if(this.isChanged&&this.wizard.getCurrentStepId()!==0){e=e.then((()=>{this.isClosing=true;return this.showConfirmExitAlert()}))}return e.then((()=>this.props.layout.close())).finally((()=>{this.isClosing=false}))}showConfirmExitAlert(){if(this.wizard.getCurrentStepId()===1){return new Promise(((e,t)=>{a.impactLight();l.confirm(o.getMessage("M_BP_WORKFLOW_STARTER_CONFIRM_TITLE"),"",[{text:o.getMessage("M_BP_WORKFLOW_STARTER_CONFIRM_BUTTON_EXIT_WITHOUT_SAVE"),type:h.DESTRUCTIVE,onPress:()=>e()},{text:o.getMessage("M_BP_WORKFLOW_STARTER_CONFIRM_BUTTON_CONTINUE"),type:h.CANCEL,onPress:()=>{this.wizard.moveToNextStep();t()}}])}))}return new Promise(((e,t)=>{a.impactLight();l.confirm(o.getMessage("M_BP_WORKFLOW_STARTER_CONFIRM_TITLE"),"",[{text:o.getMessage("M_BP_WORKFLOW_STARTER_CONFIRM_BUTTON_SAVE_AND_EXIT"),type:h.DESTRUCTIVE,onPress:()=>{this.wizard.getCurrentStep().onMoveToNextStep().then((s=>s.next?e():t())).catch((()=>t()))}},{text:o.getMessage("M_BP_WORKFLOW_STARTER_CONFIRM_BUTTON_EXIT_WITHOUT_SAVE"),type:h.DESTRUCTIVE,onPress:()=>e()},{text:o.getMessage("M_BP_WORKFLOW_STARTER_CONFIRM_BUTTON_CONTINUE"),type:h.CANCEL,onPress:()=>t()}])}))}initSteps(){const e=3;const t={uid:this.uid,layout:this.layout,title:o.getMessage("M_BP_WORKFLOW_STARTER_TITLE"),totalSteps:e,signedDocument:this.signedDocument};const s=new u({...t,stepNumber:1,documentType:this.documentType});const i=new m({...t,stepNumber:2});const n=new c({...t,stepNumber:3});this.steps=[s,i,n]}render(){return View({style:{backgroundColor:i.colors.bgSecondary}},new p({parentLayout:this.layout,steps:Array.from({length:this.steps.length}).map(((e,t)=>t)),stepForId:this.getStepForId.bind(this),useProgressBar:true,isNavigationBarBorderEnabled:true,showNextStepButtonAtBottom:true,ref:e=>{this.wizard=e}}))}getStepForId(e){return this.steps[e]||null}}s.exports={WorkflowStarter:T}}));
//# sourceMappingURL=extension.map.js