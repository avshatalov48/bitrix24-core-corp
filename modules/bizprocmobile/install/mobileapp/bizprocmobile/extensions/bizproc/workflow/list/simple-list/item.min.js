jn.define("bizproc/workflow/list/simple-list/item",((t,e,s)=>{const i=t("apptheme");const{Alert:o}=t("alert");const{EventEmitter:r}=t("event-emitter");const{Loc:n}=t("loc");const{mergeImmutable:a,get:l}=t("utils/object");const{useCallback:d}=t("utils/function");const{shortTime:h,dayMonth:u,longDate:c}=t("utils/date/formats");const{FriendlyDate:m}=t("layout/ui/friendly-date");const{Base:p}=t("layout/ui/simple-list/items/base");const{Checkbox:g}=t("ui-system/form/checkbox");const{WorkflowFaces:f}=t("bizproc/workflow/faces");const{TaskErrorCode:k}=t("bizproc/task/task-constants");const{TaskButtons:y}=t("bizproc/task/buttons");const{ViewMode:w}=t("bizproc/workflow/list/view-mode");const{CounterView:T}=t("layout/ui/counter-view");class b extends p{constructor(t){super(t);this.uid=t.item.uid||"bizproc";this.eventEmitter=r.createWithUid(this.uid);this.styles=a(this.styles,C);this.isLayoutHidden=false;if(this.layout){this.layout.on("onViewWillHidden",(()=>{this.isLayoutHidden=true})).on("onViewRemoved",(()=>{this.isLayoutHidden=true}))}}get viewMode(){return this.props.item.viewMode}get isSelected(){return this.props.item.selected}get isChecked(){return this.isSelected||!this.task&&this.viewMode===w.MULTISELECT}get isCheckboxDisabled(){return!this.task&&this.viewMode===w.MULTISELECT}get layout(){return this.props.layout}get task(){const{data:t}=this.props.item;return t.tasks.at(0)}get workflowId(){const{data:t}=this.props.item;return t.id}get typeName(){return l(this.props,"item.data.typeName","")}renderItemContent(){return View({style:this.styles.itemContent},this.renderHeader(),this.renderMenuIcon(),this.renderCounters(),this.renderBody())}renderMenuIcon(){return View({style:this.styles.menuContainer,testId:`${this.testId}_CONTEXT_MENU_BTN`,onClick:this.onCheckboxClicked.bind(this)},new g({testId:`${this.testId}_CHECKBOX_${this.workflowId}`,size:24,disabled:this.isCheckboxDisabled,checked:this.isChecked,useState:false}))}onCheckboxClicked(){const t=!this.isSelected;this.eventEmitter.emit(t?"Task:onSelect":"Task:onDeselect",{task:this.task,workflowId:this.workflowId,typeName:this.typeName,item:this.props.item})}renderCounters(){const{data:t}=this.props.item;const e=t.tasks.length;const s=t.newCommentsCounter;const o=t.useWorkflowCounter||false;if(!e&&!s){return null}return View({style:this.styles.tasksCounter},T(o?(e||0)+(s||0):e||s,{firstColor:e>0?i.colors.accentMainAlert:i.colors.accentMainSuccess,isDouble:e&&s}))}renderHeader(){return this.renderItemName()}renderBody(){const{data:t}=this.props.item;const e=t.tasks.length>0;return View({},this.renderTypeName(),this.renderTime(),this.renderWorkflowFaces(t.id,t.faces),!e&&this.renderStatus(),e&&this.renderTaskButtons())}renderItemName(){const{data:t}=this.props.item;return View({},Text({testId:`${this.testId}_ITEM_NAME`,text:jnComponent.convertHtmlEntities(t.itemName),style:this.styles.itemName,numberOfLines:2,ellipsize:"end"}))}renderTypeName(){const{data:t}=this.props.item;return View({testId:`${this.testId}_TYPE`,style:this.styles.header},Text({testId:`${this.testId}_TYPE_NAME`,style:this.styles.title,text:(t.typeName||"").toLocaleUpperCase(env.languageId),numberOfLines:1,ellipsize:"end"}))}renderTime(){const{data:t}=this.props.item;if(!t.itemTime){return null}return new m({timestamp:t.itemTime,timeSeparator:" ",defaultFormat:t=>{const e=t.format(t.inThisYear?u():c());const s=t.format(h);return`${e} ${s}`},showTime:true,useTimeAgo:false,style:{fontWeight:"400",fontSize:13,color:i.colors.base4,marginRight:60,marginLeft:13}})}renderWorkflowFaces(t,e){return View({style:this.styles.workflowFaces,onClick:()=>{void requireLazy("bizproc:workflow/timeline").then((({WorkflowTimeline:e})=>{void e.open(this.props.layout,{workflowId:t,taskId:this.props.item.data.tasks.at(0)?.id,readOnly:BX.prop.getBoolean(this.props.item.data,"readOnlyTimeline",false)})}))}},new f({layout:this.props.layout,workflowId:t,faces:e}))}renderStatus(){const{data:t}=this.props.item;return View({style:this.styles.statusWrap},Text({text:n.getMessage("BPMOBILE_WORKFLOW_SIMPLE_LIST_STATUS"),style:this.styles.statusTitle}),Text({testId:`${this.testId}_STATUS_TEXT`,text:t.statusText,style:this.styles.statusText,numberOfLines:1,ellipsize:"end"}))}renderTaskButtons(){const{data:t}=this.props.item;const e=t.tasks[0];return View({style:this.styles.taskButtons},new y({layout:this.layout,uid:this.uid,task:{...e,workflowId:t.id},isInline:true,title:t.typeName,onFail:d(this.onDoTaskFailed.bind(this)),ref:d((t=>{this.taskButtonsRef=t}))}))}onDoTaskFailed(t){if(Array.isArray(t)&&t.length>0&&!this.isLayoutHidden){const e=t.pop();if(!k.isTaskNotFoundErrorCode(e.code)){o.alert(e.message)}}}setIsDoing(t){if(this.taskButtonsRef){this.taskButtonsRef.setIsDoing(t)}}}const C={wrapper:{backgroundColor:i.colors.bgPrimary,paddingTop:12},item:{position:"relative",backgroundColor:i.colors.bgContentPrimary,borderRadius:12,paddingHorizontal:12},itemContent:{paddingTop:17,paddingBottom:8},header:{flexDirection:"column",marginRight:70,marginLeft:13},title:{color:i.colors.base4,fontWeight:"400",fontSize:12,height:18,marginRight:48,marginBottom:8},itemName:{fontWeight:"600",fontSize:17,color:i.colors.base1,marginLeft:13,marginRight:60,marginBottom:6,lineHeightMultiple:1.15},workflowFaces:{marginVertical:8},menu:{width:24,height:24},menuContainer:{position:"absolute",width:64,height:60,justifyContent:"flex-start",alignItems:"flex-end",right:0,top:0,paddingTop:19.5,paddingRight:14.5},tasksCounter:{position:"absolute",top:69,right:17,width:28,height:28},taskButtons:{marginHorizontal:13,paddingTop:17,paddingBottom:14},statusWrap:{marginHorizontal:13,paddingTop:17,paddingBottom:9},statusTitle:{fontSize:11,height:14,fontWeight:"400",color:i.colors.base4},statusText:{fontSize:14,height:19,fontWeight:"400",color:i.colors.base1,marginBottom:8}};s.exports={WorkflowSimpleListItem:b}}));
//# sourceMappingURL=item.map.js