jn.define("bizproc/workflow/starter/catalog-step/component",((e,t,a)=>{const{EventEmitter:s}=e("event-emitter");const{StorageCache:i}=e("storage-cache");const{NotifyManager:o}=e("notify-manager");const{isNil:l}=e("utils/type");const{PureComponent:n}=e("layout/pure-component");const{CatalogStepView:r}=e("bizproc/workflow/starter/catalog-step/view");const{formatRoundedTime:c,roundTimeInSeconds:m}=e("bizproc/helper/duration");class d extends n{constructor(e){super(e);this.state={templates:null,cachedTemplates:null};this.selectedTemplate=this.props.selectedTemplate||null;this.isLoading=false;this.uid=e.uid||Random.getString();this.customEventEmitter=s.createWithUid(this.uid);this.cache=new i("bizproc.workflow-starter.catalog-step",`catalog-${env.userId}-${e.documentType}`);this.loadFromCache();this.handleSelectTemplate=this.handleSelectTemplate.bind(this)}loadFromCache(){const e=this.cache.get();if(this.state.templates!==null||Object.keys(e).length===0){return}this.state.cachedTemplates=Object.values(e)}componentDidMount(){this.customEventEmitter.on("CatalogStepView:OnSelectTemplate",this.handleSelectTemplate);this.loadTemplates()}componentWillUnmount(){this.customEventEmitter.off("CatalogStepView:OnSelectTemplate",this.handleSelectTemplate)}handleSelectTemplate(e){this.selectedTemplate=e;this.customEventEmitter.emit("CatalogStepComponent:OnSelectTemplate",[e])}get isLoaded(){return this.state.templates!==null}get isLoadedFromCache(){return this.state.cachedTemplates!==null}loadTemplates(){if(this.isLoaded||this.isLoading){return}this.isLoading=true;let e=[];BX.ajax.runAction("bizprocmobile.Workflow.loadTemplates",{data:{signedDocument:this.props.signedDocument}}).then((t=>{e=t.data&&t.data.templates||[]})).catch((e=>{if(Array.isArray(e.errors)){o.showErrors(e.errors)}})).finally((()=>{this.isLoading=false;const t=e.map((e=>({...e,formattedTime:this.getFormattedTime(e),isSelected:false,key:e.id,type:"template"})));this.cache.set(t);this.setState({templates:t,cachedTemplates:t})}))}getFormattedTime(e){if(l(e.time)||e.time===""){return""}return c(m(e.time))}render(){return new r({uid:this.uid,layout:this.props.layout,isLoaded:this.isLoaded||this.isLoadedFromCache,templates:this.isLoaded?this.state.templates:this.state.cachedTemplates,selectedTemplate:this.selectedTemplate})}}a.exports={CatalogStepComponent:d}}));
//# sourceMappingURL=component.map.js