jn.define("bizproc/workflow/starter/catalog-step/component",((t,e,a)=>{const{EventEmitter:o}=t("event-emitter");const{StorageCache:s}=t("storage-cache");const{NotifyManager:i}=t("notify-manager");const{isNil:r}=t("utils/type");const{Duration:n}=t("utils/date/duration");const{PureComponent:m}=t("layout/pure-component");const{CatalogStepView:l}=t("bizproc/workflow/starter/catalog-step/view");class c extends m{constructor(t){super(t);this.state={templates:null,cachedTemplates:null};this.selectedTemplate=this.props.selectedTemplate||null;this.isLoading=false;this.uid=t.uid||Random.getString();this.customEventEmitter=o.createWithUid(this.uid);this.cache=new s("bizproc.workflow-starter.catalog-step",`catalog-${env.userId}-${t.documentType}`);this.loadFromCache();this.handleSelectTemplate=this.handleSelectTemplate.bind(this)}loadFromCache(){const t=this.cache.get();if(this.state.templates!==null||Object.keys(t).length===0){return}this.state.cachedTemplates=Object.values(t)}componentDidMount(){this.customEventEmitter.on("CatalogStepView:OnSelectTemplate",this.handleSelectTemplate);this.loadTemplates()}componentWillUnmount(){this.customEventEmitter.off("CatalogStepView:OnSelectTemplate",this.handleSelectTemplate)}handleSelectTemplate(t){this.selectedTemplate=t;this.customEventEmitter.emit("CatalogStepComponent:OnSelectTemplate",[t])}get isLoaded(){return this.state.templates!==null}get isLoadedFromCache(){return this.state.cachedTemplates!==null}loadTemplates(){if(this.isLoaded||this.isLoading){return}this.isLoading=true;let t=[];BX.ajax.runAction("bizprocmobile.Workflow.loadTemplates",{data:{signedDocument:this.props.signedDocument}}).then((e=>{t=e.data&&e.data.templates||[]})).catch((t=>{if(Array.isArray(t.errors)){i.showErrors(t.errors)}})).finally((()=>{this.isLoading=false;const e=t.map((t=>({...t,formattedTime:this.getFormattedTime(t),isSelected:false,key:t.id,type:"template"})));this.cache.set(e);this.setState({templates:e,cachedTemplates:e})}))}getFormattedTime(t){if(r(t.time)||t.time===""){return""}const e=n.createFromSeconds(t.time);const a=this.roundTime({s:e.getUnitPropertyModByFormat("s"),i:e.getUnitPropertyModByFormat("i"),H:e.getUnitPropertyModByFormat("H"),d:e.getUnitPropertyModByFormat("d"),m:e.getUnitPropertyModByFormat("m"),Y:e.getUnitPropertyModByFormat("Y")});if(a.Y!==0){return new n(a.Y*n.getLengthFormat().YEAR).format("Y")}if(a.m!==0){return new n(a.m*n.getLengthFormat().MONTH).format("m")}if(a.d!==0){return new n(a.d*n.getLengthFormat().DAY).format("d")}if(a.H!==0){return new n(a.H*n.getLengthFormat().HOUR).format("H")}if(a.i!==0){return new n(a.i*n.getLengthFormat().MINUTE).format("i")}return e.format("s")}roundTime(t){const e=t.s;const a=t.i!==0&&e>=30?t.i+1:t.i;const o=t.H!==0&&a>=30?t.H+1:t.H;const s=t.d!==0&&o>=12?t.d+1:t.d;const i=t.m!==0&&s>=15?t.m+1:t.m;const r=t.Y!==0&&i>=6?t.Y+1:t.Y;return{s:e,i:a,H:o,d:s,m:i,Y:r}}render(){return new l({uid:this.uid,layout:this.props.layout,isLoaded:this.isLoaded||this.isLoadedFromCache,templates:this.isLoaded?this.state.templates:this.state.cachedTemplates,selectedTemplate:this.selectedTemplate})}}a.exports={CatalogStepComponent:c}}));
//# sourceMappingURL=component.map.js