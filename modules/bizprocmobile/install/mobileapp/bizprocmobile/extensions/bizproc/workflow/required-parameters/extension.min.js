jn.define("bizproc/workflow/required-parameters",((e,t,o)=>{const s=e("apptheme");const{BottomSheet:i}=e("bottom-sheet");const{Feature:r}=e("feature");const{Loc:n}=e("loc");const{NotifyManager:a}=e("notify-manager");const{Type:l}=e("type");const{PureComponent:c}=e("layout/pure-component");const{WidgetHeaderButton:d}=e("layout/ui/widget-header-button");const{EntityManager:h}=e("layout/ui/entity-editor/manager");const{WorkflowRequiredParametersSkeleton:u}=e("bizproc/workflow/required-parameters/skeleton");class g extends c{static async open(e={},t=PageManager){return new Promise(((o,a)=>{(new i).setParentWidget(t).setTitle(e.widgetTitle||n.getMessage("M_BP_WORKFLOW_REQUIRED_PARAMETERS_WIDGET_TITLE")).setComponent((t=>new g({widget:t,onSaveCallback:o,onCancelCallback:a,signedDocument:e.signedDocument}))).disableSwipe().disableContentSwipe().disableHorizontalSwipe().enableResizeContent().disableOnlyMediumPosition().setMediumPositionPercent(50).showNavigationBar().setNavigationBarColor(s.colors.bgSecondary).setBackgroundColor(s.colors.bgContentPrimary).open().then((e=>{if(r.isPreventBottomSheetDismissSupported()){e.preventBottomSheetDismiss(true)}})).catch((()=>{}))}))}constructor(e){super(e);this.checkProps(e);this.state={editorConfig:null};this.isSaved=false;this.editorRef=null;this.startTime=null;this.headerButtons=new d({widget:this.props.widget,text:n.getMessage("M_BP_WORKFLOW_REQUIRED_PARAMETERS_WIDGET_SAVE_BUTTON"),loadingText:n.getMessage("M_BP_WORKFLOW_REQUIRED_PARAMETERS_WIDGET_SAVING_BUTTON"),disabled:()=>!this.isLoaded,onClick:this.onSaveClick.bind(this)})}checkProps(e){if(!e.widget){throw new Error('"widget" property must be specified')}if(!l.isStringFilled(e.signedDocument)){throw new Error('"signedDocument" property must be a non-empty string')}if(!l.isFunction(e.onSaveCallback)){throw new TypeError('"onSaveCallback" property must be a function')}if(!l.isFunction(e.onCancelCallback)){throw new TypeError('"onCancelCallback" property must be a function')}}componentDidMount(){this.props.widget.on("onViewHidden",(()=>{if(this.isSaved===false){this.props.onCancelCallback({cancel:true})}}));this.loadParameters()}loadParameters(){let e={};BX.ajax.runAction("bizprocmobile.RequiredParameters.load",{data:{signedDocument:this.props.signedDocument}}).then((({data:t})=>{e=t.editorConfig;if(Array.isArray(e)){this.closeSuccess({})}else{this.startTime=this.getCurrentTime();this.setState({editorConfig:e});this.headerButtons.refresh()}})).catch((({errors:e})=>{this.showErrorsAndClose(e)}))}onSaveClick(){if(this.editorRef?.validate()){return new Promise(((e,t)=>{this.editorRef.getValuesToSave().then((t=>{e();this.closeSuccess(t)})).catch((e=>{a.showErrors(e);t()}))}))}return Promise.reject()}get isLoaded(){return this.state.editorConfig!==null}showErrorsAndClose(e){console.error(e);const t=Array.isArray(e)?e[0]:{};if(t.message){Notify.alert(t.message,n.getMessage("M_BP_WORKFLOW_REQUIRED_PARAMETERS_WIDGET_ALERT_TITLE"),n.getMessage("M_BP_WORKFLOW_REQUIRED_PARAMETERS_WIDGET_ALERT_BUTTON_LABEL"),this.close.bind(this))}else{this.close()}}closeSuccess(e){if(this.startTime){e.timeToStart=this.getCurrentTime()-this.startTime}this.isSaved=true;this.props.onSaveCallback({data:e});this.close()}close(){if(this.props.widget){this.props.widget.close()}}getCurrentTime(){return Math.round(Date.now()/1e3)}render(){return View({style:{backgroundColor:s.colors.bgContentPrimary,paddingHorizontal:6}},!this.isLoaded&&new u({}),this.isLoaded&&h.create({layout:this.props.widget,editorProps:this.state.editorConfig,showBottomPadding:true,refCallback:e=>{this.editorRef=e}}))}}o.exports={WorkflowRequiredParameters:g}}));
//# sourceMappingURL=extension.map.js