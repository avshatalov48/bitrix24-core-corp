{"version":3,"file":"create-line.bundle.js","sources":["../src/create-line.js"],"sourcesContent":["// @flow\n\nimport { Cache, Loc, Tag, ajax} from 'main.core';\nimport { PopupManager } from 'main.popup';\n\ntype CreateLineOptions = {\n\tpath: string;\n\tsliderWidth: number;\n};\n\nexport class CreateLine\n{\n\tpath: string;\n\tisLocked: boolean = false;\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(options: CreateLineOptions)\n\t{\n\t\tthis.path = options.path;\n\t\tthis.sliderWidth = options.sliderWidth ;\n\n\t\tif (this.path)\n\t\t{\n\t\t\tthis.init();\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tif (this.isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isLocked = true;\n\n\t\tajax({\n\t\t\turl: '/bitrix/components/bitrix/imopenlines.lines/ajax.php',\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\t'action': 'create',\n\t\t\t\t'sessid': BX.bitrix_sessid()\n\t\t\t},\n\t\t\ttimeout: 30,\n\t\t\tdataType: 'json',\n\t\t\tprocessData: true,\n\t\t\tonsuccess: data => {\n\t\t\t\tdata = data || {};\n\t\t\t\tif(data.error)\n\t\t\t\t{\n\t\t\t\t\tthis.onFail(data);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.onSuccess(data);\n\t\t\t\t}\n\t\t\t},\n\t\t\tonfailure: data => this.onFail(data),\n\t\t});\n\t}\n\n\tonSuccess(data: {})\n\t{\n\t\tBX.SidePanel.Instance.open(\n\t\t\tthis.path.replace('#LINE#', data.config_id),\n\t\t\t{ width: this.sliderWidth, cacheable: false }\n\t\t);\n\t}\n\n\tonFail(responseData: {})\n\t{\n\t\tresponseData = responseData || {'error': true, 'text': ''};\n\t\tthis.isLocked = false;\n\n\t\tif (responseData.limited) //see \\Bitrix\\ImOpenLines\\Config::canActivateLine()\n\t\t{\n\t\t\tif (!B24 || !B24['licenseInfoPopup'])\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tBX.UI.InfoHelper.show('limit_contact_center_ol_number');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresponseData = responseData || {};\n\t\t\tconst errorMessage = responseData.text || Loc.getMessage('IMOPENLINES_CREATE_LINE_ERROR_ACTION')\n\n\t\t\tthis.showErrorPopup(errorMessage);\n\t\t}\n\t}\n\n\tshowErrorPopup(errorMessage: string)\n\t{\n\t\tconst popup = PopupManager.create({\n\t\t\tid: 'crm_webform_list_error',\n\t\t\tcontent: this.getPopupContent(errorMessage),\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\ttext: Loc.getMessage('IMOPENLINES_CREATE_LINE_CLOSE_BUTTON'),\n\t\t\t\t\tonclick: () => popup.close()\n\t\t\t\t})\n\t\t\t],\n\t\t\tautoHide: true,\n\t\t\tlightShadow: true,\n\t\t\tcloseByEsc: true,\n\t\t\toverlay: { backgroundColor: 'black', opacity: 500 }\n\t\t});\n\n\t\tpopup.show();\n\t}\n\n\tgetPopupContent(message: string)\n\t{\n\t\treturn this.cache.remember('popupContent', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"crm-webform-edit-warning-popup-alert\">${message}</span>\n\t\t\t`;\n\t\t});\n\t}\n}"],"names":["CreateLine","options","Cache","MemoryCache","path","sliderWidth","init","isLocked","ajax","url","method","data","BX","bitrix_sessid","timeout","dataType","processData","onsuccess","error","onFail","onSuccess","onfailure","SidePanel","Instance","open","replace","config_id","width","cacheable","responseData","limited","B24","UI","InfoHelper","show","errorMessage","text","Loc","getMessage","showErrorPopup","popup","PopupManager","create","id","content","getPopupContent","buttons","Button","onclick","close","autoHide","lightShadow","closeByEsc","overlay","backgroundColor","opacity","message","cache","remember","Tag","render"],"mappings":"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"}