{"version":3,"file":"create-line.bundle.js","sources":["../src/create-line.js"],"sourcesContent":["// @flow\n\nimport { Cache, Loc, Tag, ajax} from 'main.core';\nimport { PopupManager } from 'main.popup';\n\ntype CreateLineOptions = {\n\tpath: string;\n};\n\nexport class CreateLine\n{\n\tpath: string;\n\tisLocked: boolean = false;\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(options: CreateLineOptions)\n\t{\n\t\tthis.path = options.path;\n\n\t\tif (this.path)\n\t\t{\n\t\t\tthis.init();\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tif (this.isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isLocked = true;\n\n\t\tajax({\n\t\t\turl: '/bitrix/components/bitrix/imopenlines.lines/ajax.php',\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\t'action': 'create',\n\t\t\t\t'sessid': BX.bitrix_sessid()\n\t\t\t},\n\t\t\ttimeout: 30,\n\t\t\tdataType: 'json',\n\t\t\tprocessData: true,\n\t\t\tonsuccess: data => {\n\t\t\t\tdata = data || {};\n\t\t\t\tif(data.error)\n\t\t\t\t{\n\t\t\t\t\tthis.onFail(data);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.onSuccess(data);\n\t\t\t\t}\n\t\t\t},\n\t\t\tonfailure: data => this.onFail(data),\n\t\t});\n\t}\n\n\tonSuccess(data: {})\n\t{\n\t\tBX.SidePanel.Instance.open(\n\t\t\tthis.path.replace('#LINE#', data.config_id),\n\t\t\t{ width: 700, cacheable: false }\n\t\t);\n\t}\n\n\tonFail(responseData: {})\n\t{\n\t\tresponseData = responseData || {'error': true, 'text': ''};\n\t\tthis.isLocked = false;\n\n\t\tif (responseData.limited) //see \\Bitrix\\ImOpenLines\\Config::canActivateLine()\n\t\t{\n\t\t\tif (!B24 || !B24['licenseInfoPopup'])\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tBX.UI.InfoHelper.show('limit_contact_center_ol_number');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresponseData = responseData || {};\n\t\t\tconst errorMessage = responseData.text || Loc.getMessage('IMOPENLINES_CREATE_LINE_ERROR_ACTION')\n\n\t\t\tthis.showErrorPopup(errorMessage);\n\t\t}\n\t}\n\n\tshowErrorPopup(errorMessage: string)\n\t{\n\t\tconst popup = PopupManager.create({\n\t\t\tid: 'crm_webform_list_error',\n\t\t\tcontent: this.getPopupContent(errorMessage),\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\ttext: Loc.getMessage('IMOPENLINES_CREATE_LINE_CLOSE_BUTTON'),\n\t\t\t\t\tonclick: () => popup.close()\n\t\t\t\t})\n\t\t\t],\n\t\t\tautoHide: true,\n\t\t\tlightShadow: true,\n\t\t\tcloseByEsc: true,\n\t\t\toverlay: { backgroundColor: 'black', opacity: 500 }\n\t\t});\n\n\t\tpopup.show();\n\t}\n\n\tgetPopupContent(message: string)\n\t{\n\t\treturn this.cache.remember('popupContent', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"crm-webform-edit-warning-popup-alert\">${message}</span>\n\t\t\t`;\n\t\t});\n\t}\n}"],"names":["CreateLine","options","Cache","MemoryCache","path","init","isLocked","ajax","url","method","data","BX","bitrix_sessid","timeout","dataType","processData","onsuccess","error","onFail","onSuccess","onfailure","SidePanel","Instance","open","replace","config_id","width","cacheable","responseData","limited","B24","UI","InfoHelper","show","errorMessage","text","Loc","getMessage","showErrorPopup","popup","PopupManager","create","id","content","getPopupContent","buttons","Button","onclick","close","autoHide","lightShadow","closeByEsc","overlay","backgroundColor","opacity","message","cache","remember","Tag","render"],"mappings":"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"}