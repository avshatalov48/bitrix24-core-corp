{"version":3,"file":"widget.bundle.js","sources":["../src/const.js","../src/model.js","../src/utils/restclient.js","../src/rest.handler.js","../src/pull.handler.js","../src/widget.js","../src/public.js","../src/event-handler/widget-send-message-handler.js","../src/event-handler/widget-textarea-handler.js","../src/event-handler/widget-textarea-upload-handler.js","../src/event-handler/widget-reading-handler.js","../src/event-handler/widget-resize-handler.js","../src/event-handler/widget-consent-handler.js","../src/event-handler/widget-form-handler.js","../src/event-handler/widget-reaction-handler.js","../src/event-handler/widget-history-handler.js","../src/event-handler/widget-dialog-action-handler.js","../src/component/bx-livechat.js","../src/component/bx-livechat-body-error.js","../src/component/bx-livechat-body-head.js","../src/component/bx-livechat-body-loading.js","../src/component/bx-livechat-body-operators.js","../src/component/bx-livechat-dialogues-list.js","../src/component/bx-livechat-body-orientation-disabled.js","../src/component/bx-livechat-form-consent.js","../src/component/bx-livechat-form-vote.js","../src/component/bx-livechat-smiles.js","../src/registry.js"],"sourcesContent":["/**\n * Bitrix OpenLines widget\n * Widget constants\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nfunction GetObjectValues(source)\n{\n\tconst destination = [];\n\tfor (let value in source)\n\t{\n\t\tif (source.hasOwnProperty(value))\n\t\t{\n\t\t\tdestination.push(source[value]);\n\t\t}\n\t}\n\treturn destination;\n}\n\n/* region 01. Constants */\n\nexport const VoteType = Object.freeze({\n\tnone: 'none',\n\tlike: 'like',\n\tdislike: 'dislike',\n});\n\nexport const LanguageType = Object.freeze({\n\trussian: 'ru',\n\tukraine: 'ua',\n\tworld: 'en',\n});\n\nexport const FormType = Object.freeze({\n\tnone: 'none',\n\tlike: 'like',\n\tsmile: 'smile',\n\tconsent: 'consent',\n\twelcome: 'welcome',\n\toffline: 'offline',\n\thistory: 'history',\n});\n\nexport const LocationType = Object.freeze({\n\ttopLeft: 1,\n\ttopMiddle: 2,\n\ttopBottom: 3,\n\tbottomLeft: 6,\n\tbottomMiddle: 5,\n\tbottomRight: 4,\n});\n\nexport const LocationStyle = Object.freeze({\n\t1: 'top-left',\n\t2: 'top-center',\n\t3: 'top-right',\n\t6: 'bottom-left',\n\t5: 'bottom-center',\n\t4: 'bottom-right',\n});\n\nexport const WidgetBaseSize = Object.freeze({\n\twidth: 435,\n\theight: 557\n});\n\nexport const WidgetMinimumSize = Object.freeze({\n\twidth: 340,\n\theight: 435\n});\n\nexport const SubscriptionType = Object.freeze({\n\tconfigLoaded: 'configLoaded',\n\twidgetOpen: 'widgetOpen',\n\twidgetClose: 'widgetClose',\n\tsessionStart: 'sessionStart',\n\tsessionOperatorChange: 'sessionOperatorChange',\n\tsessionFinish: 'sessionFinish',\n\toperatorMessage: 'operatorMessage',\n\tuserForm: 'userForm',\n\tuserMessage: 'userMessage',\n\tuserFile: 'userFile',\n\tuserVote: 'userVote',\n\tevery: 'every',\n});\nexport const SubscriptionTypeCheck = GetObjectValues(SubscriptionType);\n\nexport const RestMethod = Object.freeze({\n\twidgetUserRegister: 'imopenlines.widget.user.register',\n\twidgetChatCreate: 'imopenlines.widget.chat.create',\n\twidgetConfigGet: 'imopenlines.widget.config.get',\n\twidgetDialogGet: 'imopenlines.widget.dialog.get',\n\twidgetDialogList: 'imopenlines.widget.dialog.list',\n\twidgetUserGet: 'imopenlines.widget.user.get',\n\twidgetUserConsentApply: 'imopenlines.widget.user.consent.apply',\n\twidgetVoteSend: 'imopenlines.widget.vote.send',\n\twidgetActionSend: 'imopenlines.widget.action.send',\n\tpullServerTime: 'server.time',\n\tpullConfigGet: 'pull.config.get',\n});\nexport const RestMethodCheck = GetObjectValues(RestMethod);\n\nexport const RestAuth = Object.freeze({\n\tguest: 'guest',\n});\n\nexport const SessionStatus = Object.freeze({\n\tnew: 0,\n\tskip: 5,\n\tanswer: 10,\n\tclient: 20,\n\tclientAfterOperator: 25,\n\toperator: 40,\n\twaitClient: 50,\n\tclose: 60,\n\tspam: 65,\n\tduplicate: 69,\n\tsilentlyClose: 75,\n});\n\nexport const WidgetEventType = Object.freeze({\n\tshowForm: 'IMOL.Widget:showForm',\n\thideForm: 'IMOL.Widget:hideForm',\n\tprocessMessagesToSendQueue: 'IMOL.Widget:processMessagesToSendQueue',\n\trequestData: 'IMOL.Widget:requestData',\n\tshowConsent: 'IMOL.Widget:showConsent',\n\tacceptConsent: 'IMOL.Widget:acceptConsent',\n\tconsentAccepted: 'IMOL.Widget:consentAccepted',\n\tdeclineConsent: 'IMOL.Widget:declineConsent',\n\tconsentDeclined: 'IMOL.Widget:consentDeclined',\n\tsendDialogVote: 'IMOL.Widget:sendDialogVote',\n\tcreateSession: 'IMOL.Widget:createSession',\n\topenSession: 'IMOL.Widget:openSession',\n});","/**\n * Bitrix OpenLines widget\n * Widget model (Vuex Builder model)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {VuexBuilderModel} from 'ui.vue.vuex';\n\nimport {Utils} from 'im.lib.utils';\nimport {Cookie} from \"im.lib.cookie\";\nimport {FormType, LocationStyle, LocationType, VoteType} from \"./const\";\n\nexport class WidgetModel extends VuexBuilderModel\n{\n\t/**\n\t * @inheritDoc\n\t */\n\tgetName()\n\t{\n\t\treturn 'widget';\n\t}\n\n\tgetState()\n\t{\n\t\treturn {\n\t\t\tcommon:\n\t\t\t{\n\t\t\t\tconfigId: 0,\n\t\t\t\tconfigName: '',\n\t\t\t\thost: this.getVariable('common.host', location.protocol+'//'+location.host),\n\t\t\t\tpageMode: this.getVariable('common.pageMode', false),\n\t\t\t\tcopyright: this.getVariable('common.copyright', true),\n\t\t\t\tcopyrightUrl: this.getVariable('common.copyrightUrl', 'https://bitrix24.com'),\n\t\t\t\tlocation: this.getVariable('common.location', LocationType.bottomRight),\n\t\t\t\tstyles: {\n\t\t\t\t\tbackgroundColor: this.getVariable('styles.backgroundColor', '#17a3ea'),\n\t\t\t\t\ticonColor: this.getVariable('styles.iconColor', '#ffffff')\n\t\t\t\t},\n\t\t\t\tvote: {\n\t\t\t\t\tenable: false,\n\t\t\t\t\tbeforeFinish: true,\n\t\t\t\t\tmessageText: this.getVariable('vote.messageText', ''),\n\t\t\t\t\tmessageLike: this.getVariable('vote.messageLike', ''),\n\t\t\t\t\tmessageDislike: this.getVariable('vote.messageDislike', '')\n\t\t\t\t},\n\t\t\t\ttextMessages: {\n\t\t\t\t\tbxLivechatOnlineLine1: this.getVariable('textMessages.bxLivechatOnlineLine1', ''),\n\t\t\t\t\tbxLivechatOnlineLine2: this.getVariable('textMessages.bxLivechatOnlineLine2', ''),\n\t\t\t\t\tbxLivechatOffline: this.getVariable('textMessages.bxLivechatOffline', ''),\n\t\t\t\t\tbxLivechatTitle: '',\n\t\t\t\t},\n\t\t\t\tonline: false,\n\t\t\t\toperators: [],\n\t\t\t\tconnectors: [],\n\t\t\t\tshowForm: FormType.none,\n\t\t\t\tshowed: false,\n\t\t\t\treopen: false,\n\t\t\t\tdragged: false,\n\t\t\t\ttextareaHeight: 0,\n\t\t\t\twidgetHeight: 0,\n\t\t\t\twidgetWidth: 0,\n\t\t\t\tshowConsent: false,\n\t\t\t\tconsentUrl: '',\n\t\t\t\tdialogStart: false,\n\t\t\t\twatchTyping: false,\n\t\t\t\tshowSessionId: false,\n\t\t\t\tisCreateSessionMode: false,\n\t\t\t\tcrmFormsSettings: {\n\t\t\t\t\tuseWelcomeForm: false,\n\t\t\t\t\twelcomeFormId: 0,\n\t\t\t\t\twelcomeFormSec: '',\n\t\t\t\t\twelcomeFormDelay: false,\n\t\t\t\t\twelcomeFormFilled: false,\n\t\t\t\t\tsuccessText: '',\n\t\t\t\t\terrorText: ''\n\t\t\t\t}\n\t\t\t},\n\t\t\tdialog:\n\t\t\t{\n\t\t\t\tsessionId: 0,\n\t\t\t\tsessionClose: true,\n\t\t\t\tsessionStatus: 0,\n\t\t\t\tuserVote: VoteType.none,\n\t\t\t\tcloseVote: false,\n\t\t\t\tuserConsent: false,\n\t\t\t\toperatorChatId: 0,\n\t\t\t\toperator: {\n\t\t\t\t\tid: 0,\n\t\t\t\t\tname: '',\n\t\t\t\t\tfirstName: '',\n\t\t\t\t\tlastName: '',\n\t\t\t\t\tworkPosition: '',\n\t\t\t\t\tavatar: '',\n\t\t\t\t\tonline: false,\n\t\t\t\t}\n\t\t\t},\n\t\t\tuser:\n\t\t\t{\n\t\t\t\tid: -1,\n\t\t\t\thash: '',\n\t\t\t\tname: '',\n\t\t\t\tfirstName: '',\n\t\t\t\tlastName: '',\n\t\t\t\tavatar: '',\n\t\t\t\temail: '',\n\t\t\t\tphone: '',\n\t\t\t\twww: '',\n\t\t\t\tgender: 'M',\n\t\t\t\tposition: '',\n\t\t\t},\n\t\t}\n\t}\n\n\tgetStateSaveException()\n\t{\n\t\treturn {\n\t\t\tcommon: {\n\t\t\t\thost: null,\n\t\t\t\tpageMode: null,\n\t\t\t\tcopyright: null,\n\t\t\t\tcopyrightUrl: null,\n\t\t\t\tstyles: null,\n\t\t\t\tdragged: null,\n\t\t\t\tshowed: null,\n\t\t\t\tshowConsent: null,\n\t\t\t\tshowForm: null,\n\t\t\t},\n\t\t}\n\t}\n\n\tgetMutations()\n\t{\n\t\treturn {\n\n\t\t\tcommon: (state, payload) =>\n\t\t\t{\n\t\t\t\tif (typeof payload.configId === 'number')\n\t\t\t\t{\n\t\t\t\t\tstate.common.configId = payload.configId;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.configName === 'string')\n\t\t\t\t{\n\t\t\t\t\tstate.common.configName = payload.configName;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.online === 'boolean')\n\t\t\t\t{\n\t\t\t\t\tstate.common.online = payload.online;\n\t\t\t\t}\n\t\t\t\tif (Utils.types.isPlainObject(payload.vote))\n\t\t\t\t{\n\t\t\t\t\tif (typeof payload.vote.enable === 'boolean')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.vote.enable = payload.vote.enable;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.vote.beforeFinish === 'boolean')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.vote.beforeFinish = payload.vote.beforeFinish;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.vote.messageText === 'string')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.vote.messageText = payload.vote.messageText;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.vote.messageLike === 'string')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.vote.messageLike = payload.vote.messageLike;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.vote.messageDislike === 'string')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.vote.messageDislike = payload.vote.messageDislike;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (Utils.types.isPlainObject(payload.textMessages))\n\t\t\t\t{\n\t\t\t\t\tif (typeof payload.textMessages.bxLivechatOnlineLine1 === 'string' && payload.textMessages.bxLivechatOnlineLine1 !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.textMessages.bxLivechatOnlineLine1 = payload.textMessages.bxLivechatOnlineLine1;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.textMessages.bxLivechatOnlineLine2 === 'string' && payload.textMessages.bxLivechatOnlineLine2 !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.textMessages.bxLivechatOnlineLine2 = payload.textMessages.bxLivechatOnlineLine2;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.textMessages.bxLivechatOffline === 'string' && payload.textMessages.bxLivechatOffline !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.textMessages.bxLivechatOffline = payload.textMessages.bxLivechatOffline;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.textMessages.bxLivechatTitle === 'string' && payload.textMessages.bxLivechatTitle !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.textMessages.bxLivechatTitle = payload.textMessages.bxLivechatTitle;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (typeof payload.dragged === 'boolean')\n\t\t\t\t{\n\t\t\t\t\tstate.common.dragged = payload.dragged;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.textareaHeight === 'number')\n\t\t\t\t{\n\t\t\t\t\tstate.common.textareaHeight = payload.textareaHeight;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.widgetHeight === 'number')\n\t\t\t\t{\n\t\t\t\t\tstate.common.widgetHeight = payload.widgetHeight;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.widgetWidth === 'number')\n\t\t\t\t{\n\t\t\t\t\tstate.common.widgetWidth = payload.widgetWidth;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.showConsent === 'boolean')\n\t\t\t\t{\n\t\t\t\t\tstate.common.showConsent = payload.showConsent;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.consentUrl === 'string')\n\t\t\t\t{\n\t\t\t\t\tstate.common.consentUrl = payload.consentUrl;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.showed === 'boolean')\n\t\t\t\t{\n\t\t\t\t\tstate.common.showed = payload.showed;\n\t\t\t\t\tpayload.reopen = Utils.device.isMobile()? false: payload.showed;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.reopen === 'boolean')\n\t\t\t\t{\n\t\t\t\t\tstate.common.reopen = payload.reopen;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.copyright === 'boolean')\n\t\t\t\t{\n\t\t\t\t\tstate.common.copyright = payload.copyright;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.dialogStart === 'boolean')\n\t\t\t\t{\n\t\t\t\t\tstate.common.dialogStart = payload.dialogStart;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.watchTyping === 'boolean')\n\t\t\t\t{\n\t\t\t\t\tstate.common.watchTyping = payload.watchTyping;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.showSessionId === 'boolean')\n\t\t\t\t{\n\t\t\t\t\tstate.common.showSessionId = payload.showSessionId;\n\t\t\t\t}\n\t\t\t\tif (payload.operators instanceof Array)\n\t\t\t\t{\n\t\t\t\t\tstate.common.operators = payload.operators;\n\t\t\t\t}\n\t\t\t\tif (payload.connectors instanceof Array)\n\t\t\t\t{\n\t\t\t\t\tstate.common.connectors = payload.connectors;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.showForm === 'string' && typeof FormType[payload.showForm] !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tif (payload.showForm === FormType.like && !!state.dialog.closeVote)\n\t\t\t\t\t{\n\t\t\t\t\t\tpayload.showForm = FormType.none;\n\t\t\t\t\t}\n\t\t\t\t\tstate.common.showForm = payload.showForm;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.location === 'number' && typeof LocationStyle[payload.location] !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tif (state.common.location !== payload.location)\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.widgetHeight = 0;\n\t\t\t\t\t\tstate.common.widgetWidth = 0;\n\t\t\t\t\t\tstate.common.location = payload.location;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (Utils.types.isPlainObject(payload.crmFormsSettings))\n\t\t\t\t{\n\t\t\t\t\tif (typeof payload.crmFormsSettings.useWelcomeForm === 'string')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.crmFormsSettings.useWelcomeForm = payload.crmFormsSettings.useWelcomeForm === 'Y';\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.crmFormsSettings.welcomeFormId === 'string')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.crmFormsSettings.welcomeFormId = payload.crmFormsSettings.welcomeFormId;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.crmFormsSettings.welcomeFormSec === 'string')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.crmFormsSettings.welcomeFormSec = payload.crmFormsSettings.welcomeFormSec;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.crmFormsSettings.welcomeFormDelay === 'string')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.crmFormsSettings.welcomeFormDelay = payload.crmFormsSettings.welcomeFormDelay === 'Y';\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.crmFormsSettings.successText === 'string' && payload.crmFormsSettings.successText !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.crmFormsSettings.successText = payload.crmFormsSettings.successText;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.crmFormsSettings.errorText === 'string' && payload.crmFormsSettings.errorText !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.crmFormsSettings.errorText = payload.crmFormsSettings.errorText;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (typeof payload.isCreateSessionMode === 'boolean')\n\t\t\t\t{\n\t\t\t\t\tstate.common.isCreateSessionMode = payload.isCreateSessionMode;\n\t\t\t\t}\n\n\t\t\t\tif (this.isSaveNeeded({common: payload}))\n\t\t\t\t{\n\t\t\t\t\tthis.saveState(state);\n\t\t\t\t}\n\t\t\t},\n\t\t\tdialog: (state, payload) =>\n\t\t\t{\n\t\t\t\tif (typeof payload.sessionId === 'number')\n\t\t\t\t{\n\t\t\t\t\tstate.dialog.sessionId = payload.sessionId;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.sessionClose === 'boolean')\n\t\t\t\t{\n\t\t\t\t\tstate.dialog.sessionClose = payload.sessionClose;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.sessionStatus === 'number')\n\t\t\t\t{\n\t\t\t\t\tstate.dialog.sessionStatus = payload.sessionStatus;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.userConsent === 'boolean')\n\t\t\t\t{\n\t\t\t\t\tstate.dialog.userConsent = payload.userConsent;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.userVote === 'string' && typeof payload.userVote !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tstate.dialog.userVote = payload.userVote;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.closeVote === 'boolean')\n\t\t\t\t{\n\t\t\t\t\tstate.dialog.closeVote = payload.closeVote;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\t!!payload.closeVote\n\t\t\t\t\t\t&& state.common.showForm === FormType.like\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.common.showForm = FormType.none;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (typeof payload.operatorChatId === 'number')\n\t\t\t\t{\n\t\t\t\t\tstate.dialog.operatorChatId = payload.operatorChatId;\n\t\t\t\t}\n\t\t\t\tif (Utils.types.isPlainObject(payload.operator))\n\t\t\t\t{\n\t\t\t\t\tif (typeof payload.operator.id === 'number')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.dialog.operator.id = payload.operator.id;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.operator.name === 'string' || typeof payload.operator.name === 'number')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.dialog.operator.name = payload.operator.name.toString();\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.operator.lastName === 'string' || typeof payload.operator.lastName === 'number')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.dialog.operator.lastName = payload.operator.lastName.toString();\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.operator.firstName === 'string' || typeof payload.operator.firstName === 'number')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.dialog.operator.firstName = payload.operator.firstName.toString();\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.operator.workPosition === 'string' || typeof payload.operator.workPosition === 'number')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.dialog.operator.workPosition = payload.operator.workPosition.toString();\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.operator.avatar === 'string')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!payload.operator.avatar || payload.operator.avatar.startsWith('http'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate.dialog.operator.avatar = payload.operator.avatar;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate.dialog.operator.avatar = state.common.host+payload.operator.avatar;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof payload.operator.online === 'boolean')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.dialog.operator.online = payload.operator.online;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.isSaveNeeded({dialog: payload}))\n\t\t\t\t{\n\t\t\t\t\tthis.saveState(state);\n\t\t\t\t}\n\t\t\t},\n\t\t\tuser: (state, payload) =>\n\t\t\t{\n\t\t\t\tif (typeof payload.id === 'number')\n\t\t\t\t{\n\t\t\t\t\tstate.user.id = payload.id;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.hash === 'string' && payload.hash !== state.user.hash)\n\t\t\t\t{\n\t\t\t\t\tstate.user.hash = payload.hash;\n\t\t\t\t\tCookie.set(null, 'LIVECHAT_HASH', payload.hash, {expires: 365*86400, path: '/'});\n\t\t\t\t}\n\t\t\t\tif (typeof payload.name === 'string' || typeof payload.name === 'number')\n\t\t\t\t{\n\t\t\t\t\tstate.user.name = payload.name.toString();\n\t\t\t\t}\n\t\t\t\tif (typeof payload.firstName === 'string' || typeof payload.firstName === 'number')\n\t\t\t\t{\n\t\t\t\t\tstate.user.firstName = payload.firstName.toString();\n\t\t\t\t}\n\t\t\t\tif (typeof payload.lastName === 'string' || typeof payload.lastName === 'number')\n\t\t\t\t{\n\t\t\t\t\tstate.user.lastName = payload.lastName.toString();\n\t\t\t\t}\n\t\t\t\tif (typeof payload.avatar === 'string')\n\t\t\t\t{\n\t\t\t\t\tstate.user.avatar = payload.avatar;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.email === 'string')\n\t\t\t\t{\n\t\t\t\t\tstate.user.email = payload.email;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.phone === 'string' || typeof payload.phone === 'number')\n\t\t\t\t{\n\t\t\t\t\tstate.user.phone = payload.phone.toString();\n\t\t\t\t}\n\t\t\t\tif (typeof payload.www === 'string')\n\t\t\t\t{\n\t\t\t\t\tstate.user.www = payload.www;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.gender === 'string')\n\t\t\t\t{\n\t\t\t\t\tstate.user.gender = payload.gender;\n\t\t\t\t}\n\t\t\t\tif (typeof payload.position === 'string')\n\t\t\t\t{\n\t\t\t\t\tstate.user.position = payload.position;\n\t\t\t\t}\n\n\t\t\t\tif (this.isSaveNeeded({user: payload}))\n\t\t\t\t{\n\t\t\t\t\tthis.saveState(state);\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\tgetActions()\n\t{\n\t\treturn {\n\t\t\tshow: ({ commit }) =>\n\t\t\t{\n\t\t\t\tcommit('common', {showed: true});\n\t\t\t},\n\t\t\tsetVoteDateFinish: ({ commit, dispatch, state }, payload) =>\n\t\t\t{\n\t\t\t\tif (!payload)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.setVoteDateTimeout);\n\t\t\t\t\tcommit('dialog', {closeVote: false});\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tconst totalDelay = new Date(payload).getTime() - new Date().getTime();\n\t\t\t\tconst dayTimestamp = 10000;\n\t\t\t\tclearTimeout(this.setVoteDateTimeout);\n\n\t\t\t\tif (payload)\n\t\t\t\t{\n\t\t\t\t\tif (totalDelay && !state.dialog.closeVote)\n\t\t\t\t\t{\n\t\t\t\t\t\tcommit('dialog', {closeVote: false});\n\t\t\t\t\t}\n\n\t\t\t\t\tvar delay = totalDelay;\n\n\t\t\t\t\tif(totalDelay > dayTimestamp)\n\t\t\t\t\t{\n\t\t\t\t\t\tdelay = dayTimestamp;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.setVoteDateTimeout = setTimeout(function requestCloseVote() {\n\t\t\t\t\t\tdelay = new Date(payload).getTime() - new Date().getTime();\n\t\t\t\t\t\tif(delay > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(delay > dayTimestamp)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdelay = dayTimestamp;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsetTimeout(requestCloseVote, delay);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcommit('dialog', {closeVote: true});\n\t\t\t\t\t\t}\n\t\t\t\t\t}, delay);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}","/**\n * Bitrix OpenLines widget\n * Rest client (base on BX.RestClient)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\n// TODO change BX.RestClient, BX.promise to import\n\nimport {Utils} from \"im.lib.utils\";\nimport {RestAuth, RestMethod} from \"../const\";\nimport {RestClient} from \"rest.client\";\n\nexport class WidgetRestClient\n{\n\tconstructor(params)\n\t{\n\t\tthis.queryAuthRestore = false;\n\n\t\tthis.setAuthId(RestAuth.guest);\n\n\t\tthis.restClient = new RestClient({\n\t\t\tendpoint: params.endpoint,\n\t\t\tqueryParams: this.queryParams,\n\t\t\tcors: true\n\t\t});\n\t}\n\n\tsetAuthId(authId, customAuthId = '')\n\t{\n\t\tif (typeof this.queryParams !== 'object')\n\t\t{\n\t\t\tthis.queryParams = {};\n\t\t}\n\n\t\tif (\n\t\t\tauthId == RestAuth.guest\n\t\t\t|| typeof authId === 'string' && authId.match(/^[a-f0-9]{32}$/)\n\t\t)\n\t\t{\n\t\t\tthis.queryParams.livechat_auth_id = authId;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(`%LiveChatRestClient.setAuthId: auth is not correct (%c${authId}%c)`, \"color: black;\", \"font-weight: bold; color: red\", \"color: black\");\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\tauthId == RestAuth.guest\n\t\t\t&& typeof customAuthId === 'string' && customAuthId.match(/^[a-f0-9]{32}$/)\n\t\t)\n\t\t{\n\t\t\tthis.queryParams.livechat_custom_auth_id = customAuthId;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetAuthId()\n\t{\n\t\tif (typeof this.queryParams !== 'object')\n\t\t{\n\t\t\tthis.queryParams = {};\n\t\t}\n\n\t\treturn this.queryParams.livechat_auth_id || null;\n\t}\n\n\tcallMethod(method, params, callback, sendCallback, logTag = null)\n\t{\n\t\tif (!logTag)\n\t\t{\n\t\t\tlogTag = Utils.getLogTrackingParams({\n\t\t\t\tname: method,\n\t\t\t});\n\t\t}\n\n\t\tconst promise = new BX.Promise();\n\n\t\t// TODO: Callbacks methods will not work!\n\t\tthis.restClient.callMethod(method, params, null, sendCallback, logTag).then(result => {\n\n\t\t\tthis.queryAuthRestore = false;\n\t\t\tpromise.fulfill(result);\n\n\t\t}).catch(result => {\n\n\t\t\tlet error = result.error();\n\t\t\tif (error.ex.error == 'LIVECHAT_AUTH_WIDGET_USER')\n\t\t\t{\n\t\t\t\tthis.setAuthId(error.ex.hash);\n\n\t\t\t\tif (method === RestMethod.widgetUserRegister)\n\t\t\t\t{\n\t\t\t\t\tconsole.warn(`BX.LiveChatRestClient: ${error.ex.error_description} (${error.ex.error})`);\n\n\t\t\t\t\tthis.queryAuthRestore = false;\n\t\t\t\t\tpromise.reject(result);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!this.queryAuthRestore)\n\t\t\t\t{\n\t\t\t\t\tconsole.warn('BX.LiveChatRestClient: your auth-token has expired, send query with a new token');\n\n\t\t\t\t\tthis.queryAuthRestore = true;\n\t\t\t\t\tthis.restClient.callMethod(method, params, null, sendCallback, logTag).then(result => {\n\t\t\t\t\t\tthis.queryAuthRestore = false;\n\t\t\t\t\t\tpromise.fulfill(result);\n\t\t\t\t\t}).catch(result => {\n\t\t\t\t\t\tthis.queryAuthRestore = false;\n\t\t\t\t\t\tpromise.reject(result);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.queryAuthRestore = false;\n\t\t\tpromise.reject(result);\n\t\t});\n\n\t\treturn promise;\n\t};\n\n\tcallBatch(calls, callback, bHaltOnError, sendCallback, logTag)\n\t{\n\t\tlet resultCallback = (result) =>\n\t\t{\n\t\t\tlet error = null;\n\t\t\tfor (let method in calls)\n\t\t\t{\n\t\t\t\tif (!calls.hasOwnProperty(method))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet error = result[method].error();\n\t\t\t\tif (error && error.ex.error == 'LIVECHAT_AUTH_WIDGET_USER')\n\t\t\t\t{\n\t\t\t\t\tthis.setAuthId(error.ex.hash);\n\t\t\t\t\tif (method === RestMethod.widgetUserRegister)\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.warn(`BX.LiveChatRestClient: ${error.ex.error_description} (${error.ex.error})`);\n\n\t\t\t\t\t\tthis.queryAuthRestore = false;\n\t\t\t\t\t\tcallback(result);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.queryAuthRestore)\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.warn('BX.LiveChatRestClient: your auth-token has expired, send query with a new token');\n\n\t\t\t\t\t\tthis.queryAuthRestore = true;\n\t\t\t\t\t\tthis.restClient.callBatch(calls, callback, bHaltOnError, sendCallback, logTag);\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.queryAuthRestore = false;\n\t\t\tcallback(result);\n\n\t\t\treturn true;\n\t\t};\n\n\t\treturn this.restClient.callBatch(calls, resultCallback, bHaltOnError, sendCallback, logTag);\n\t};\n}","/**\n * Bitrix OpenLines widget\n * Widget Rest answers (Rest Answer Handler)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BaseRestHandler} from \"im.provider.rest\";\nimport {LocalStorage} from \"im.lib.localstorage\";\nimport {SubscriptionType} from \"./const\";\n\nclass WidgetRestAnswerHandler extends BaseRestHandler\n{\n\tconstructor(props = {})\n\t{\n\t\tsuper(props);\n\n\t\tthis.widget = props.widget;\n\t}\n\n\thandleImopenlinesWidgetConfigGetSuccess(data)\n\t{\n\t\tthis.store.commit('widget/common', {\n\t\t\tconfigId: data.configId,\n\t\t\tconfigName: data.configName,\n\t\t\tvote: data.vote,\n\t\t\ttextMessages: data.textMessages,\n\t\t\toperators: data.operators || [],\n\t\t\tonline: data.online,\n\t\t\tconsentUrl: data.consentUrl,\n\t\t\tconnectors: data.connectors || [],\n\t\t\twatchTyping: data.watchTyping,\n\t\t\tshowSessionId: data.showSessionId,\n\t\t\tcrmFormsSettings: data.crmFormsSettings\n\t\t});\n\n\t\tthis.store.commit('application/set', {disk: data.disk});\n\n\t\tthis.widget.addLocalize(data.serverVariables);\n\t\tLocalStorage.set(this.widget.getSiteId(), 0, 'serverVariables', data.serverVariables || {});\n\t}\n\n\thandleImopenlinesWidgetUserRegisterSuccess(data)\n\t{\n\t\tthis.widget.restClient.setAuthId(data.hash);\n\n\t\tlet previousData = [];\n\t\tif (typeof this.store.state.messages.collection[this.controller.application.getChatId()] !== 'undefined')\n\t\t{\n\t\t\tpreviousData = this.store.state.messages.collection[this.controller.application.getChatId()];\n\t\t}\n\t\tthis.store.commit('messages/initCollection', {chatId: data.chatId, messages: previousData});\n\n\t\tthis.store.commit('dialogues/initCollection', {dialogId: data.dialogId, fields: {\n\t\t\tentityType: 'LIVECHAT',\n\t\t\ttype: 'livechat'\n\t\t}});\n\n\t\tthis.store.commit('application/set', {dialog: {\n\t\t\tchatId: data.chatId,\n\t\t\tdialogId: 'chat'+data.chatId\n\t\t}});\n\t}\n\n\thandleImopenlinesWidgetChatCreateSuccess(data)\n\t{\n\t\tthis.widget.restClient.setAuthId(data.hash);\n\n\t\tthis.store.commit('messages/initCollection', {chatId: data.chatId, messages: []});\n\t\tthis.store.commit('dialogues/initCollection', {\n\t\t\tdialogId: data.dialogId, fields: {\n\t\t\t\tentityType: 'LIVECHAT',\n\t\t\t\ttype: 'livechat'\n\t\t\t}\n\t\t});\n\n\t\tthis.store.commit('application/set', {\n\t\t\tdialog: {\n\t\t\t\tchatId: data.chatId,\n\t\t\t\tdialogId: 'chat' + data.chatId\n\t\t\t}\n\t\t});\n\t}\n\n\thandleImopenlinesWidgetUserGetSuccess(data)\n\t{\n\t\tthis.store.commit('widget/user', {\n\t\t\tid: data.id,\n\t\t\thash: data.hash,\n\t\t\tname: data.name,\n\t\t\tfirstName: data.firstName,\n\t\t\tlastName: data.lastName,\n\t\t\tphone: data.phone,\n\t\t\tavatar: data.avatar,\n\t\t\temail: data.email,\n\t\t\twww: data.www,\n\t\t\tgender: data.gender,\n\t\t\tposition: data.position,\n\t\t});\n\t\tthis.store.dispatch('users/set', [{\n\t\t\tid: data.id,\n\t\t\tname: data.name,\n\t\t\tfirstName: data.firstName,\n\t\t\tlastName: data.lastName,\n\t\t\tavatar: data.avatar,\n\t\t\tgender: data.gender,\n\t\t\tworkPosition: data.position,\n\t\t}]);\n\t\tthis.store.commit('application/set', {common: {\n\t\t\tuserId: data.id\n\t\t}});\n\t}\n\n\thandleImopenlinesWidgetDialogGetSuccess(data)\n\t{\n\t\tthis.store.commit('messages/initCollection', {chatId: data.chatId});\n\n\t\tthis.store.commit('widget/dialog', data);\n\n\t\tthis.store.commit('application/set', {dialog: {\n\t\t\tchatId: data.chatId,\n\t\t\tdialogId: 'chat'+data.chatId,\n\t\t\tdiskFolderId: data.diskFolderId,\n\t\t}});\n\n\t\tthis.store.dispatch('widget/setVoteDateFinish', data.dateCloseVote);\n\t}\n\n\thandleImDialogMessagesGetInitSuccess(data)\n\t{\n\t\tthis.handleImDialogMessagesGetSuccess(data);\n\t}\n\n\thandleImDialogMessagesGetSuccess(data)\n\t{\n\t\tif (data.messages && data.messages.length > 0 && !this.widget.isDialogStart())\n\t\t{\n\t\t\tthis.store.commit('widget/common', {\n\t\t\t\tdialogStart: true\n\t\t\t});\n\t\t\tthis.store.commit('widget/dialog', {\n\t\t\t\tuserConsent: true\n\t\t\t});\n\t\t}\n\t}\n\n\thandleImMessageAddSuccess(messageId, message)\n\t{\n\t\tthis.widget.sendEvent({\n\t\t\ttype: SubscriptionType.userMessage,\n\t\t\tdata: {\n\t\t\t\tid: messageId,\n\t\t\t\ttext: message.text\n\t\t\t}\n\t\t});\n\t}\n\n\thandleImDiskFileCommitSuccess(result, message)\n\t{\n\t\tthis.widget.sendEvent({\n\t\t\ttype: SubscriptionType.userFile,\n\t\t\tdata: {}\n\t\t});\n\t}\n}\n\nexport {WidgetRestAnswerHandler};","/**\n * Bitrix OpenLines widget\n * Widget pull commands (Pull Command Handler)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {SubscriptionType, VoteType} from \"./const\";\n\nclass WidgetImPullCommandHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\tconstructor(params)\n\t{\n\t\tthis.controller = params.controller;\n\t\tthis.store = params.store;\n\t\tthis.widget = params.widget;\n\t}\n\n\thandleMessageChat(params, extra, command)\n\t{\n\t\tif (params.message.senderId != this.controller.application.getUserId())\n\t\t{\n\t\t\tthis.widget.sendEvent({\n\t\t\t\ttype: SubscriptionType.operatorMessage,\n\t\t\t\tdata: params\n\t\t\t});\n\n\t\t\tif (!this.store.state.widget.common.showed && !this.widget.onceShowed)\n\t\t\t{\n\t\t\t\tthis.widget.onceShowed = true;\n\t\t\t\tthis.widget.open();\n\t\t\t}\n\t\t}\n\t}\n}\n\nclass WidgetImopenlinesPullCommandHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tconstructor(params = {})\n\t{\n\t\tthis.controller = params.controller;\n\t\tthis.store = params.store;\n\t\tthis.widget = params.widget;\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'imopenlines';\n\t}\n\n\thandleSessionStart(params, extra, command)\n\t{\n\t\tthis.store.commit('widget/dialog', {\n\t\t\tsessionId: params.sessionId,\n\t\t\tsessionClose: false,\n\t\t\tsessionStatus: 0,\n\t\t\tuserVote: VoteType.none,\n\t\t});\n\n\t\tthis.store.dispatch('widget/setVoteDateFinish', '');\n\n\t\tthis.widget.sendEvent({\n\t\t\ttype: SubscriptionType.sessionStart,\n\t\t\tdata: {\n\t\t\t\tsessionId: params.sessionId\n\t\t\t}\n\t\t});\n\t}\n\n\thandleSessionOperatorChange(params, extra, command)\n\t{\n\t\tthis.store.commit('widget/dialog', {\n\t\t\toperator: params.operator,\n\t\t\toperatorChatId: params.operatorChatId\n\t\t});\n\n\t\tthis.widget.sendEvent({\n\t\t\ttype: SubscriptionType.sessionOperatorChange,\n\t\t\tdata: {\n\t\t\t\toperator: params.operator\n\t\t\t}\n\t\t});\n\t}\n\n\thandleSessionStatus(params, extra, command)\n\t{\n\t\tthis.store.commit('widget/dialog', {\n\t\t\tsessionId: params.sessionId,\n\t\t\tsessionStatus: params.sessionStatus,\n\t\t\tsessionClose: params.sessionClose,\n\t\t});\n\n\t\tthis.widget.sendEvent({\n\t\t\ttype: SubscriptionType.sessionStatus,\n\t\t\tdata: {\n\t\t\t\tsessionId: params.sessionId,\n\t\t\t\tsessionStatus: params.sessionStatus\n\t\t\t}\n\t\t});\n\n\t\tif (params.sessionClose)\n\t\t{\n\t\t\tthis.widget.sendEvent({\n\t\t\t\ttype: SubscriptionType.sessionFinish,\n\t\t\t\tdata: {\n\t\t\t\t\tsessionId: params.sessionId,\n\t\t\t\t\tsessionStatus: params.sessionStatus\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!params.spam)\n\t\t\t{\n\t\t\t\tthis.store.commit('widget/dialog', {\n\t\t\t\t\toperator: {\n\t\t\t\t\t\tname: '',\n\t\t\t\t\t\tfirstName: '',\n\t\t\t\t\t\tlastName: '',\n\t\t\t\t\t\tworkPosition: '',\n\t\t\t\t\t\tavatar: '',\n\t\t\t\t\t\tonline: false,\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\thandleSessionDateCloseVote(params, extra, command)\n\t{\n\t\tthis.store.dispatch('widget/setVoteDateFinish', params.dateCloseVote);\n\t}\n}\n\nexport {\n\tWidgetImPullCommandHandler,\n\tWidgetImopenlinesPullCommandHandler,\n};","/**\n * Bitrix OpenLines widget\n * Widget private interface (base class)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2020 Bitrix\n */\n\n// widget files\nimport {\n\tLocationStyle,\n\tSubscriptionType,\n\tSubscriptionTypeCheck,\n\tRestMethod,\n\tRestAuth,\n\tWidgetEventType\n} from \"./const\";\n\nimport {WidgetModel} from \"./model\";\nimport {WidgetRestClient} from \"./utils/restclient\";\nimport {WidgetRestAnswerHandler} from \"./rest.handler\";\nimport {WidgetImPullCommandHandler, WidgetImopenlinesPullCommandHandler} from \"./pull.handler\";\n\n// main\nimport {md5} from \"main.md5\";\nimport \"main.date\";\n\n// pull\nimport {PullClient} from \"pull.client\";\n\n// ui\nimport {Vue} from \"ui.vue\";\nimport {VuexBuilder} from \"ui.vue.vuex\";\nimport 'ui.vue.components.crm.form';\n\n// messenger files\nimport {Controller} from 'im.controller';\nimport {\n\tRestMethod as ImRestMethod,\n\tRestMethodHandler as ImRestMethodHandler,\n\tEventType\n} from 'im.const';\n\nimport {Cookie} from \"im.lib.cookie\";\nimport {Utils} from \"im.lib.utils\";\nimport {LocalStorage} from \"im.lib.localstorage\";\nimport {Logger} from \"im.lib.logger\";\n\nimport { EventEmitter } from \"main.core.events\";\nimport { ZIndexManager } from \"main.core.minimal\";\n\nexport class Widget\n{\n/* region 01. Initialize and store data */\n\tparams: Object = null;\n\ttemplate: Object = null; // Vue instance\n\trootNode: Object = null;\n\n\trestClient: Object = null;\n\tpullClient: Object = null;\n\n\tready: boolean = true; // true if there are no initialization errors\n\tinited: boolean = false; // true if all preparations are done\n\toffline: boolean = false; // true if Pull-client is offline\n\twidgetConfigRequest: Object = null; // XHR-request from widget.config.get, can be aborted before completion\n\n\t// this block can be set from public config\n\tuserRegisterData: Object = {}; // user info\n\tcustomData: Array = []; // additional info to send to server\n\toptions: Object = { checkSameDomain: true };\n\tsubscribers: Object = {}; // external event subscribers\n\n\t// fields from params\n\tcode: string = ''; // livechat code\n\thost: string = '';\n\tlanguage: string = '';\n\tcopyright: boolean = true;\n\tcopyrightUrl: string = '';\n\tbuttonInstance: Object = null; // widget button\n\tlocalize: Object = null;\n\tpageMode: Object = null; // fullscreen livechat mode options\n\n\tconstructor(params = {})\n\t{\n\t\tthis.params = params;\n\n\t\t//TODO: remove\n\t\tthis.messagesQueue = [];\n\n\t\tEventEmitter.subscribe(WidgetEventType.requestData, this.requestData.bind(this));\n\t\tEventEmitter.subscribe(WidgetEventType.createSession, this.createChat.bind(this));\n\t\tEventEmitter.subscribe(WidgetEventType.openSession, this.openSession.bind(this));\n\n\t\tthis.initParams();\n\t\tthis.initRestClient();\n\t\tthis.initPullClient();\n\t\tthis.initCore().then(() => {\n\t\t\tthis.initWidget();\n\t\t\tthis.initComplete();\n\t\t});\n\t}\n\n\tinitParams()\n\t{\n\t\tthis.rootNode = this.params.node || document.createElement('div');\n\n\t\tthis.code = this.params.code || '';\n\t\tthis.host = this.params.host || '';\n\t\tthis.language = this.params.language || 'en';\n\t\tthis.copyright = this.params.copyright !== false;\n\t\tthis.copyrightUrl = (this.copyright && this.params.copyrightUrl) ? this.params.copyrightUrl: '';\n\t\tif (this.params.buttonInstance && typeof this.params.buttonInstance === 'object')\n\t\t{\n\t\t\tthis.buttonInstance = this.params.buttonInstance;\n\t\t}\n\n\t\tif (this.params.pageMode && typeof this.params.pageMode === 'object')\n\t\t{\n\t\t\tthis.pageMode = {\n\t\t\t\tuseBitrixLocalize: this.params.pageMode.useBitrixLocalize === true,\n\t\t\t\tplaceholder: document.querySelector(`#${this.params.pageMode.placeholder}`)\n\t\t\t};\n\t\t}\n\n\t\tconst errors = this.checkRequiredFields();\n\t\tif (errors.length > 0)\n\t\t{\n\t\t\terrors.forEach(error => console.warn(error));\n\t\t\tthis.ready = false;\n\t\t}\n\n\t\tthis.setRootNode();\n\n\t\tthis.localize = this.pageMode && this.pageMode.useBitrixLocalize? window.BX.message: {};\n\t\tthis.setLocalize();\n\t}\n\n\tinitRestClient()\n\t{\n\t\tthis.restClient = new WidgetRestClient({endpoint: `${this.host}/rest`});\n\t}\n\n\tinitPullClient()\n\t{\n\t\tthis.pullClient = new PullClient({\n\t\t\tserverEnabled: true,\n\t\t\tuserId: 0,\n\t\t\tsiteId: this.getSiteId(),\n\t\t\trestClient: this.restClient,\n\t\t\tskipStorageInit: true,\n\t\t\tconfigTimestamp: 0,\n\t\t\tskipCheckRevision: true,\n\t\t\tgetPublicListMethod: 'imopenlines.widget.operator.get',\n\t\t});\n\t}\n\n\tinitCore()\n\t{\n\t\tthis.controller = new Controller({\n\t\t\thost: this.getHost(),\n\t\t\tsiteId: this.getSiteId(),\n\t\t\tuserId: 0,\n\t\t\tlanguageId: this.language,\n\t\t\tpull: {client: this.pullClient},\n\t\t\trest: {client: this.restClient},\n\t\t\tlocalize: this.localize,\n\t\t\tvuexBuilder: {\n\t\t\t\tdatabase: !Utils.browser.isIe(),\n\t\t\t\tdatabaseName: 'imol/widget',\n\t\t\t\tdatabaseType: VuexBuilder.DatabaseType.localStorage,\n\t\t\t\tmodels: [\n\t\t\t\t\tWidgetModel.create().setVariables(this.getWidgetVariables())\n\t\t\t\t],\n\t\t\t}\n\t\t});\n\n\t\treturn this.controller.ready();\n\t}\n\n\tinitWidget()\n\t{\n\t\tthis.restClient.setAuthId(this.getRestAuthId());\n\t\tthis.setModelData();\n\t\t// TODO: move from controller\n\t\tthis.controller.application.setPrepareFilesBeforeSaveFunction(this.prepareFileData.bind(this));\n\n\t\tthis.controller.addRestAnswerHandler(\n\t\t\tWidgetRestAnswerHandler.create({\n\t\t\t\twidget: this,\n\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\tcontroller: this.controller,\n\t\t\t})\n\t\t);\n\t}\n\n\t// if start or open methods were called before core init - we will have appropriate flags\n\t// for full-page livechat we always call open\n\tinitComplete()\n\t{\n\t\twindow.dispatchEvent(new CustomEvent('onBitrixLiveChat', {detail: {\n\t\t\twidget: this,\n\t\t\twidgetCode: this.code,\n\t\t\twidgetHost: this.host,\n\t\t}}));\n\n\t\tif (this.callStartFlag)\n\t\t{\n\t\t\tthis.start();\n\t\t}\n\n\t\tif (this.pageMode || this.callOpenFlag)\n\t\t{\n\t\t\tthis.open();\n\t\t}\n\t}\n\n\t// public method\n\t// initially called from imopenlines/lib/livechatmanager.php:16\n\t// if core is not ready yet - set flag and call start once again in this.initComplete()\n\tstart()\n\t{\n\t\tif (!this.controller || !this.controller.getStore())\n\t\t{\n\t\t\tthis.callStartFlag = true;\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.isSessionActive())\n\t\t{\n\t\t\tthis.requestWidgetData();\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t// public method\n\t// if core is not ready yet - set flag and call start once again in this.initComplete()\n\t// if not inited yet - request widget data\n\topen(params = {})\n\t{\n\t\tif (!this.controller.getStore())\n\t\t{\n\t\t\tthis.callOpenFlag = true;\n\t\t\treturn true;\n\t\t}\n\n\t\tif (!params.openFromButton && this.buttonInstance)\n\t\t{\n\t\t\tthis.buttonInstance.wm.showById('openline_livechat');\n\t\t}\n\n\t\tconst {error, stop} = this.checkForErrorsBeforeOpen();\n\t\tif (stop)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!error && !this.inited)\n\t\t{\n\t\t\tthis.requestWidgetData();\n\t\t}\n\n\t\tthis.attachTemplate();\n\t}\n\n\trequestWidgetData()\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tconsole.error('LiveChatWidget.start: widget code or host is not specified');\n\t\t\treturn false;\n\t\t}\n\n\t\t// if user is registered or we have its hash - proceed to getting chat and messages\n\t\tif (this.isUserReady() || this.isHashAvailable())\n\t\t{\n\t\t\tthis.requestData();\n\t\t\tthis.inited = true;\n\t\t\tthis.fireInitEvent();\n\n\t\t\treturn true;\n\t\t}\n\n\t\t// if there is no info about user - we need to get config and wait for first message\n\t\tthis.controller.restClient.callMethod(\n\t\t\tRestMethod.widgetConfigGet,\n\t\t\t{code: this.code},\n\t\t\t(xhr) => { this.widgetConfigRequest = xhr; }\n\t\t).then((result) => {\n\t\t\tthis.widgetConfigRequest = null;\n\t\t\tthis.clearError();\n\n\t\t\tthis.controller.executeRestAnswer(RestMethod.widgetConfigGet, result);\n\n\t\t\tif (!this.inited)\n\t\t\t{\n\t\t\t\tthis.inited = true;\n\t\t\t\tthis.fireInitEvent();\n\t\t\t}\n\t\t}).catch(error => {\n\t\t\tthis.widgetConfigRequest = null;\n\t\t\tthis.setError(error.error().ex.error, error.error().ex.error_description);\n\t\t});\n\n\t\tif (this.isConfigDataLoaded())\n\t\t{\n\t\t\tthis.inited = true;\n\t\t\tthis.fireInitEvent();\n\t\t}\n\t}\n\n\t// get all other info (dialog, chat, messages etc)\n\trequestData()\n\t{\n\t\tLogger.log('requesting data from widget');\n\t\tif (this.requestDataSend)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.requestDataSend = true;\n\n\t\t// if there is uncompleted widget.config.get request - abort it (because we will do it anyway)\n\t\tif (this.widgetConfigRequest)\n\t\t{\n\t\t\tthis.widgetConfigRequest.abort();\n\t\t}\n\n\t\tconst callback = this.handleBatchRequestResult.bind(this);\n\t\tthis.controller.restClient.callBatch(\n\t\t\tthis.getDataRequestQuery(),\n\t\t\tcallback,\n\t\t\tfalse,\n\t\t\tfalse,\n\t\t\tUtils.getLogTrackingParams(\n\t\t\t\t{\n\t\t\t\t\tname: 'widget.init.config',\n\t\t\t\t\tdialog: this.controller.application.getDialogData()\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\t}\n\n\tcreateChat()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.controller.restClient.callBatch(\n\t\t\t\tthis.getCreateChatRequestQuery(),\n\t\t\t\t(result) => {\n\t\t\t\t\tthis.handleBatchCreateChatRequestResult(result).then(() => {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tfalse,\n\t\t\t\tfalse,\n\t\t\t);\n\t\t});\n\t}\n\n\thandleBatchRequestResult(response)\n\t{\n\t\tif (!response)\n\t\t{\n\t\t\tthis.requestDataSend = false;\n\t\t\tthis.setError('EMPTY_RESPONSE', 'Server returned an empty response.');\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.handleConfigGet(response)\n\t\t\t.then(() => this.handleUserGet(response))\n\t\t\t.then(() => this.handleChatGet(response))\n\t\t\t.then(() => this.handleDialogGet(response))\n\t\t\t.then(() => this.handleDialogMessagesGet(response))\n\t\t\t.then(() => this.handleUserRegister(response))\n\t\t\t.then(() => this.handlePullRequests(response))\n\t\t\t.catch(({code, description}) => {\n\t\t\t\tthis.setError(code, description);\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis.requestDataSend = false;\n\t\t\t});\n\t}\n\n\thandleBatchCreateChatRequestResult(response)\n\t{\n\t\tif (!response)\n\t\t{\n\t\t\tthis.requestDataSend = false;\n\t\t\tthis.setError('EMPTY_RESPONSE', 'Server returned an empty response.');\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.handleChatCreate(response)\n\t\t\t.then(() => this.handleChatGet(response))\n\t\t\t.then(() => this.handleDialogGet(response))\n\t\t\t.catch(({code, description}) => {\n\t\t\t\tthis.setError(code, description);\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis.requestDataSend = false;\n\t\t\t});\n\t}\n\n\thandleBatchOpenSessionRequestResult(response)\n\t{\n\t\tif (!response)\n\t\t{\n\t\t\tthis.requestDataSend = false;\n\t\t\tthis.setError('EMPTY_RESPONSE', 'Server returned an empty response.');\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.handleChatGet(response)\n\t\t\t.then(() => this.handleDialogGet(response))\n\t\t\t.then(() => this.handleDialogMessagesGet(response))\n\t\t\t.catch(({code, description}) => {\n\t\t\t\tthis.setError(code, description);\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis.requestDataSend = false;\n\t\t\t});\n\t}\n\n\tgetDataRequestQuery(): Object\n\t{\n\t\t// always widget.config.get\n\t\tconst query = {\n\t\t\t[RestMethod.widgetConfigGet]: [RestMethod.widgetConfigGet, {code: this.code}]\n\t\t};\n\n\t\tif (this.isUserRegistered())\n\t\t{\n\t\t\t// widget.dialog.get\n\t\t\tquery[RestMethod.widgetDialogGet] = [\n\t\t\t\tRestMethod.widgetDialogGet,\n\t\t\t\t{\n\t\t\t\t\tconfig_id: this.getConfigId(),\n\t\t\t\t\ttrace_data: this.getCrmTraceData(),\n\t\t\t\t\tcustom_data: this.getCustomData()\n\t\t\t\t}\n\t\t\t];\n\n\t\t\t// im.chat.get\n\t\t\tquery[ImRestMethodHandler.imChatGet] = [\n\t\t\t\tImRestMethod.imChatGet,\n\t\t\t\t{\n\t\t\t\t\tdialog_id: `$result[${RestMethod.widgetDialogGet}][dialogId]`\n\t\t\t\t}\n\t\t\t];\n\n\t\t\t// im.dialog.messages.get\n\t\t\tquery[ImRestMethodHandler.imDialogMessagesGetInit] = [\n\t\t\t\tImRestMethod.imDialogMessagesGet,\n\t\t\t\t{\n\t\t\t\t\tchat_id: `$result[${RestMethod.widgetDialogGet}][chatId]`,\n\t\t\t\t\tlimit: this.controller.application.getRequestMessageLimit(),\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// widget.user.register\n\t\t\tquery[RestMethod.widgetUserRegister] = [\n\t\t\t\tRestMethod.widgetUserRegister,\n\t\t\t\t{\n\t\t\t\t\tconfig_id: `$result[${RestMethod.widgetConfigGet}][configId]`,\n\t\t\t\t\t...this.getUserRegisterFields()\n\t\t\t\t}\n\t\t\t];\n\n\t\t\t// im.chat.get\n\t\t\tquery[ImRestMethodHandler.imChatGet] = [\n\t\t\t\tImRestMethod.imChatGet,\n\t\t\t\t{dialog_id: `$result[${RestMethod.widgetUserRegister}][dialogId]`}\n\t\t\t];\n\n\t\t\tif (this.userRegisterData.hash || this.getUserHashCookie())\n\t\t\t{\n\t\t\t\t// widget.dialog.get\n\t\t\t\tquery[RestMethod.widgetDialogGet] = [\n\t\t\t\t\tRestMethod.widgetDialogGet,\n\t\t\t\t\t{\n\t\t\t\t\t\tconfig_id: `$result[${RestMethod.widgetConfigGet}][configId]`,\n\t\t\t\t\t\ttrace_data: this.getCrmTraceData(),\n\t\t\t\t\t\tcustom_data: this.getCustomData()\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\t// im.dialog.messages.get\n\t\t\t\tquery[ImRestMethodHandler.imDialogMessagesGetInit] = [\n\t\t\t\t\tImRestMethod.imDialogMessagesGet,\n\t\t\t\t\t{\n\t\t\t\t\t\tchat_id: `$result[${RestMethod.widgetDialogGet}][chatId]`,\n\t\t\t\t\t\tlimit: this.controller.application.getRequestMessageLimit(),\n\t\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t\t}\n\t\t\t\t];\n\t\t\t}\n\n\t\t\tif (this.isUserAgreeConsent())\n\t\t\t{\n\t\t\t\t// widget.user.consent.apply\n\t\t\t\tquery[RestMethod.widgetUserConsentApply] = [\n\t\t\t\t\tRestMethod.widgetUserConsentApply,\n\t\t\t\t\t{\n\t\t\t\t\t\tconfig_id: `$result[${RestMethod.widgetConfigGet}][configId]`,\n\t\t\t\t\t\tconsent_url: location.href\n\t\t\t\t\t}\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\n\t\tquery[RestMethod.pullServerTime] = [RestMethod.pullServerTime, {}];\n\t\tquery[RestMethod.pullConfigGet] = [RestMethod.pullConfigGet, {'CACHE': 'N'}];\n\t\tquery[RestMethod.widgetUserGet] = [RestMethod.widgetUserGet, {}];\n\n\t\treturn query;\n\t}\n\n\tgetOpenSessionQuery(chatId): Object\n\t{\n\t\t// imopenlines.widget.dialog.get\n\t\tconst query = {\n\t\t\t[RestMethod.widgetDialogGet]: [RestMethod.widgetDialogGet, {\n\t\t\t\tconfig_id: this.getConfigId(),\n\t\t\t\tchat_id: chatId\n\t\t\t}]\n\t\t};\n\n\t\tquery[ImRestMethodHandler.imChatGet] = [\n\t\t\tImRestMethod.imChatGet,\n\t\t\t{\n\t\t\t\tdialog_id: `chat${chatId}`\n\t\t\t}\n\t\t];\n\n\t\t// im.dialog.messages.get\n\t\tquery[ImRestMethodHandler.imDialogMessagesGetInit] = [\n\t\t\tImRestMethod.imDialogMessagesGet,\n\t\t\t{\n\t\t\t\tchat_id: chatId,\n\t\t\t\tlimit: 50,\n\t\t\t\tconvert_text: 'Y'\n\t\t\t}\n\t\t];\n\n\t\treturn query;\n\t}\n\n\tgetCreateChatRequestQuery(): Object\n\t{\n\t\tconst query = {};\n\n\t\t// widget.chat.register\n\t\tquery[RestMethod.widgetChatCreate] = [\n\t\t\tRestMethod.widgetChatCreate,\n\t\t\t{\n\t\t\t\tconfig_id: this.getConfigId(),\n\t\t\t\t...this.getUserRegisterFields()\n\t\t\t}\n\t\t];\n\n\t\t// im.chat.get\n\t\tquery[ImRestMethodHandler.imChatGet] = [\n\t\t\tImRestMethod.imChatGet,\n\t\t\t{dialog_id: `$result[${RestMethod.widgetChatCreate}][dialogId]`}\n\t\t];\n\n\t\t// widget.dialog.get\n\t\tquery[RestMethod.widgetDialogGet] = [\n\t\t\tRestMethod.widgetDialogGet,\n\t\t\t{\n\t\t\t\tconfig_id: this.getConfigId(),\n\t\t\t\ttrace_data: this.getCrmTraceData(),\n\t\t\t\tcustom_data: this.getCustomData()\n\t\t\t}\n\t\t];\n\n\t\tif (this.isUserAgreeConsent())\n\t\t{\n\t\t\t// widget.user.consent.apply\n\t\t\tquery[RestMethod.widgetUserConsentApply] = [\n\t\t\t\tRestMethod.widgetUserConsentApply,\n\t\t\t\t{\n\t\t\t\t\tconfig_id: this.getConfigId(),\n\t\t\t\t\tconsent_url: location.href\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\n\t\tquery[RestMethod.pullServerTime] = [RestMethod.pullServerTime, {}];\n\t\tquery[RestMethod.pullConfigGet] = [RestMethod.pullConfigGet, {'CACHE': 'N'}];\n\t\tquery[RestMethod.widgetUserGet] = [RestMethod.widgetUserGet, {}];\n\n\t\treturn query;\n\t}\n\n\topenSession(event)\n\t{\n\t\tconst eventData = event.getData();\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst dialog = this.controller.getStore().getters['dialogues/get'](eventData.session.dialogId);\n\t\t\tif (dialog)\n\t\t\t{\n\t\t\t\tthis.controller.getStore().commit('application/set', {dialog: {\n\t\t\t\t\t\tchatId: eventData.session.chatId,\n\t\t\t\t\t\tdialogId: eventData.session.dialogId,\n\t\t\t\t\t\tdiskFolderId: 0,\n\t\t\t\t\t}});\n\n\t\t\t\tthis.controller.getStore().commit('widget/common', {isCreateSessionMode: false});\n\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.controller.restClient.callBatch(\n\t\t\t\tthis.getOpenSessionQuery(eventData.session.chatId),\n\t\t\t\t(result) => {\n\t\t\t\t\tthis.handleBatchOpenSessionRequestResult(result).then(() => {\n\t\t\t\t\t\tthis.controller.getStore().commit('widget/common', {isCreateSessionMode: false});\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tfalse,\n\t\t\t\tfalse,\n\t\t\t);\n\t\t});\n\t}\n\n\tprepareFileData(files)\n\t{\n\t\tif (!Array.isArray(files))\n\t\t{\n\t\t\treturn files;\n\t\t}\n\n\t\treturn files.map(file =>\n\t\t{\n\t\t\tconst hash = (window.md5 || md5)(`${this.getUserId()}|${file.id}|${this.getUserHash()}`);\n\t\t\tconst urlParam = `livechat_auth_id=${hash}&livechat_user_id=${this.getUserId()}`;\n\t\t\tif (file.urlPreview)\n\t\t\t{\n\t\t\t\tfile.urlPreview = `${file.urlPreview}&${urlParam}`;\n\t\t\t}\n\t\t\tif (file.urlShow)\n\t\t\t{\n\t\t\t\tfile.urlShow = `${file.urlShow}&${urlParam}`;\n\t\t\t}\n\t\t\tif (file.urlDownload)\n\t\t\t{\n\t\t\t\tfile.urlDownload = `${file.urlDownload}&${urlParam}`;\n\t\t\t}\n\n\t\t\treturn file;\n\t\t});\n\t}\n\n\tcheckRequiredFields(): Array\n\t{\n\t\tconst errors = [];\n\t\tif (typeof this.code === 'string' && this.code.length <= 0)\n\t\t{\n\t\t\terrors.push(`LiveChatWidget.constructor: code is not correct (${this.code})`);\n\t\t}\n\n\t\tif (typeof this.host === 'string' && (this.host.length <= 0 || !this.host.startsWith('http')))\n\t\t{\n\t\t\terrors.push(`LiveChatWidget.constructor: host is not correct (${this.host})`);\n\t\t}\n\n\t\treturn errors;\n\t}\n\n\tsetRootNode()\n\t{\n\t\tif (this.pageMode && this.pageMode.placeholder)\n\t\t{\n\t\t\tthis.rootNode = this.pageMode.placeholder;\n\t\t}\n\t\telse if (document.body.firstChild)\n\t\t{\n\t\t\tdocument.body.insertBefore(this.rootNode, document.body.firstChild);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdocument.body.append(this.rootNode);\n\t\t}\n\t}\n\n\tsetLocalize()\n\t{\n\t\tif (typeof this.params.localize === 'object')\n\t\t{\n\t\t\tthis.addLocalize(this.params.localize);\n\t\t}\n\n\t\tconst serverVariables = LocalStorage.get(this.getSiteId(), 0, 'serverVariables', false);\n\t\tif (serverVariables)\n\t\t{\n\t\t\tthis.addLocalize(serverVariables);\n\t\t}\n\t}\n\n\tgetWidgetVariables(): Object\n\t{\n\t\tconst variables = {\n\t\t\tcommon: {\n\t\t\t\thost: this.getHost(),\n\t\t\t\tpageMode: !!this.pageMode,\n\t\t\t\tcopyright: this.copyright,\n\t\t\t\tcopyrightUrl: this.copyrightUrl,\n\t\t\t},\n\t\t\tvote: {\n\t\t\t\tmessageText: this.getLocalize('BX_LIVECHAT_VOTE_TITLE'),\n\t\t\t\tmessageLike: this.getLocalize('BX_LIVECHAT_VOTE_PLUS_TITLE'),\n\t\t\t\tmessageDislike: this.getLocalize('BX_LIVECHAT_VOTE_MINUS_TITLE'),\n\t\t\t},\n\t\t\ttextMessages: {\n\t\t\t\tbxLivechatOnlineLine1: this.getLocalize('BX_LIVECHAT_ONLINE_LINE_1'),\n\t\t\t\tbxLivechatOnlineLine2: this.getLocalize('BX_LIVECHAT_ONLINE_LINE_2'),\n\t\t\t\tbxLivechatOffline: this.getLocalize('BX_LIVECHAT_OFFLINE'),\n\t\t\t}\n\t\t};\n\n\t\tif (this.params.styles)\n\t\t{\n\t\t\tvariables.styles = {};\n\t\t\tif (this.params.styles.backgroundColor)\n\t\t\t{\n\t\t\t\tvariables.styles.backgroundColor = this.params.styles.backgroundColor;\n\t\t\t}\n\t\t\tif (this.params.styles.iconColor)\n\t\t\t{\n\t\t\t\tvariables.styles.iconColor = this.params.styles.iconColor;\n\t\t\t}\n\t\t}\n\n\t\treturn variables;\n\t}\n\n\tgetRestAuthId()\n\t{\n\t\treturn this.isUserRegistered() ? this.getUserHash() : RestAuth.guest;\n\t}\n\n\tsetModelData()\n\t{\n\t\tif (this.params.location && LocationStyle[this.params.location])\n\t\t{\n\t\t\tthis.controller.getStore().commit('widget/common', {location: this.params.location});\n\t\t}\n\t}\n\n\tcheckForErrorsBeforeOpen()\n\t{\n\t\tconst result = {\n\t\t\terror: false,\n\t\t\tstop: false\n\t\t};\n\n\t\tif (!this.checkBrowserVersion())\n\t\t{\n\t\t\tthis.setError('OLD_BROWSER_LOCALIZED', this.localize.BX_LIVECHAT_OLD_BROWSER);\n\t\t\tresult.error = true;\n\t\t}\n\t\telse if (Utils.versionCompare(Vue.version(), '2.1') < 0)\n\t\t{\n\t\t\talert(this.localize.BX_LIVECHAT_OLD_VUE);\n\t\t\tconsole.error(`LiveChatWidget.error: OLD_VUE_VERSION (${this.localize.BX_LIVECHAT_OLD_VUE_DEV.replace('#CURRENT_VERSION#', Vue.version())})`);\n\t\t\tresult.error = true;\n\t\t\tresult.stop = true;\n\t\t}\n\t\telse if (this.isSameDomain())\n\t\t{\n\t\t\tthis.setError('LIVECHAT_SAME_DOMAIN', this.localize.BX_LIVECHAT_SAME_DOMAIN);\n\t\t\tresult.error = true;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tisSameDomain()\n\t{\n\t\tif (typeof BX === 'undefined' || !BX.isReady)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.options.checkSameDomain)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.host.lastIndexOf(`.${location.hostname}`) > -1;\n\t}\n\n\tcheckBrowserVersion()\n\t{\n\t\tif (Utils.platform.isIos())\n\t\t{\n\t\t\tlet version = Utils.platform.getIosVersion();\n\t\t\tif (version && version <= 10)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n/* endregion 01. Initialize and store data */\n\n/* region 02. Push & Pull */\n\n\tstartPullClient(config): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (!this.getUserId() || !this.getSiteId() || !this.restClient)\n\t\t\t{\n\t\t\t\treturn reject({\n\t\t\t\t\tex: { error: 'WIDGET_NOT_LOADED', error_description: 'Widget is not loaded.'}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.pullClientInited)\n\t\t\t{\n\t\t\t\tif (!this.pullClient.isConnected())\n\t\t\t\t{\n\t\t\t\t\tthis.pullClient.scheduleReconnect();\n\t\t\t\t}\n\t\t\t\treturn resolve(true);\n\t\t\t}\n\n\t\t\tthis.controller.userId = this.getUserId();\n\t\t\tthis.pullClient.userId = this.getUserId();\n\t\t\tthis.pullClient.configTimestamp = config? config.server.config_timestamp: 0;\n\t\t\tthis.pullClient.skipStorageInit = false;\n\t\t\tthis.pullClient.storage = PullClient.StorageManager({\n\t\t\t\tuserId: this.getUserId(),\n\t\t\t\tsiteId: this.getSiteId()\n\t\t\t});\n\n\t\t\tthis.pullClient.subscribe(\n\t\t\t\tnew WidgetImPullCommandHandler({\n\t\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\t\tcontroller: this.controller,\n\t\t\t\t\twidget: this,\n\t\t\t\t})\n\t\t\t);\n\t\t\tthis.pullClient.subscribe(\n\t\t\t\tnew WidgetImopenlinesPullCommandHandler({\n\t\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\t\tcontroller: this.controller,\n\t\t\t\t\twidget: this,\n\t\t\t\t})\n\t\t\t);\n\n\t\t\tthis.pullClient.subscribe({\n\t\t\t\ttype: PullClient.SubscriptionType.Status,\n\t\t\t\tcallback: this.eventStatusInteraction.bind(this)\n\t\t\t});\n\n\t\t\tthis.pullConnectedFirstTime = this.pullClient.subscribe({\n\t\t\t\ttype: PullClient.SubscriptionType.Status,\n\t\t\t\tcallback: (result) => {\n\t\t\t\t\tif (result.status === PullClient.PullStatus.Online)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t\tthis.pullConnectedFirstTime();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.template)\n\t\t\t{\n\t\t\t\tthis.template.$Bitrix.PullClient.set(this.pullClient);\n\t\t\t}\n\n\t\t\tthis.pullClient.start({\n\t\t\t\t...config,\n\t\t\t\tskipReconnectToLastSession: true\n\t\t\t}).catch(() => {\n\t\t\t\treject({\n\t\t\t\t\tex: { error: 'PULL_CONNECTION_ERROR', error_description: 'Pull is not connected.'}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.pullClientInited = true;\n\t\t});\n\t}\n\n\tstopPullClient()\n\t{\n\t\tif (this.pullClient)\n\t\t{\n\t\t\tthis.pullClient.stop(PullClient.CloseReasons.MANUAL, 'Closed manually');\n\t\t}\n\t}\n\n\trecoverPullConnection()\n\t{\n\t\t// this.pullClient.session.mid = 0; // TODO specially for disable pull history, remove after recode im\n\t\tthis.pullClient.restart(PullClient.CloseReasons.MANUAL, 'Restart after click by connection status button.');\n\t}\n\n\teventStatusInteraction(data)\n\t{\n\t\tif (data.status === PullClient.PullStatus.Online)\n\t\t{\n\t\t\tthis.onPullOnlineStatus();\n\t\t}\n\t\telse if (data.status === PullClient.PullStatus.Offline)\n\t\t{\n\t\t\tthis.pullRequestMessage = true;\n\t\t\tthis.offline = true;\n\t\t}\n\t}\n\n\tonPullOnlineStatus()\n\t{\n\t\tthis.offline = false;\n\n\t\t// if we go online after going offline - we need to request messages\n\t\tif (this.pullRequestMessage)\n\t\t{\n\t\t\tthis.controller.pullBaseHandler.option.skip = true;\n\n\t\t\tLogger.warn('Requesting getDialogUnread after going online');\n\t\t\tEventEmitter.emitAsync(EventType.dialog.requestUnread, {chatId: this.controller.application.getChatId()}).then(() => {\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollOnStart, {chatId: this.controller.application.getChatId()});\n\t\t\t\t\tthis.controller.pullBaseHandler.option.skip = false;\n\t\t\t\t\tEventEmitter.emit(WidgetEventType.processMessagesToSendQueue);\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.controller.pullBaseHandler.option.skip = false;\n\t\t\t\t});\n\n\t\t\tthis.pullRequestMessage = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.readMessage);\n\t\t\tEventEmitter.emit(WidgetEventType.processMessagesToSendQueue);\n\t\t}\n\t}\n\n/* endregion 02. Push & Pull */\n\n/* region 03. Template engine */\n\n\tattachTemplate()\n\t{\n\t\tif (this.template)\n\t\t{\n\t\t\tthis.controller.getStore().commit('widget/common', {showed: true});\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.rootNode.innerHTML = '';\n\t\tthis.rootNode.append(document.createElement('div'));\n\n\t\tconst application = this;\n\n\t\treturn this.controller.createVue(application, {\n\t\t\tel: this.rootNode.firstChild,\n\t\t\ttemplate: '<bx-livechat/>',\n\t\t\tbeforeCreate()\n\t\t\t{\n\t\t\t\tapplication.sendEvent({\n\t\t\t\t\ttype: SubscriptionType.widgetOpen,\n\t\t\t\t\tdata: {}\n\t\t\t\t});\n\t\t\t\tapplication.template = this;\n\n\t\t\t\tif (ZIndexManager !== undefined)\n\t\t\t\t{\n\t\t\t\t\tconst stack = ZIndexManager.getOrAddStack(document.body);\n\t\t\t\t\tstack.setBaseIndex(1000000); // some big value\n\t\t\t\t\tthis.$bitrix.Data.set('zIndexStack', stack);\n\t\t\t\t}\n\t\t\t},\n\t\t\tdestroyed()\n\t\t\t{\n\t\t\t\tapplication.sendEvent({\n\t\t\t\t\ttype: SubscriptionType.widgetClose,\n\t\t\t\t\tdata: {}\n\t\t\t\t});\n\t\t\t\tapplication.template = null;\n\t\t\t\tapplication.templateAttached = false;\n\t\t\t\tapplication.rootNode.innerHTML = '';\n\t\t\t}\n\t\t}).then(() => {\n\t\t\treturn new Promise((resolve, reject) => resolve());\n\t\t});\n\t}\n\n\tdetachTemplate()\n\t{\n\t\tif (!this.template)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.template.$destroy();\n\n\t\treturn true;\n\t}\n\n\t// public method\n\tmutateTemplateComponent(id, params)\n\t{\n\t\treturn Vue.mutateComponent(id, params);\n\t}\n\n/* endregion 03. Template engine */\n\n/* region 04. Widget interaction and utils */\n\n\t// public method\n\tclose()\n\t{\n\t\tif (this.pageMode)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.buttonInstance)\n\t\t{\n\t\t\tthis.buttonInstance.onWidgetClose();\n\t\t}\n\n\t\tthis.detachTemplate();\n\t}\n\n\tfireInitEvent()\n\t{\n\t\tif (this.initEventFired)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.sendEvent({\n\t\t\ttype: SubscriptionType.configLoaded,\n\t\t\tdata: {}\n\t\t});\n\n\t\tif (this.controller.getStore().state.widget.common.reopen)\n\t\t{\n\t\t\tthis.open();\n\t\t}\n\n\t\tthis.initEventFired = true;\n\t}\n\n\tisUserRegistered()\n\t{\n\t\treturn !!this.getUserHash();\n\t}\n\n\tisConfigDataLoaded()\n\t{\n\t\treturn this.controller.getStore().state.widget.common.configId;\n\t}\n\n\tisChatLoaded()\n\t{\n\t\treturn this.controller.getStore().state.application.dialog.chatId > 0;\n\t}\n\n\tisSessionActive()\n\t{\n\t\treturn !this.controller.getStore().state.widget.dialog.sessionClose;\n\t}\n\n\tisUserAgreeConsent()\n\t{\n\t\treturn this.controller.getStore().state.widget.dialog.userConsent;\n\t}\n\n\tgetCrmTraceData()\n\t{\n\t\tlet traceData = '';\n\n\t\tif (!this.buttonInstance)\n\t\t{\n\t\t\treturn traceData;\n\t\t}\n\n\t\tif (typeof this.buttonInstance.getTrace !== 'function')\n\t\t{\n\t\t\ttraceData = this.buttonInstance.getTrace();\n\t\t}\n\t\telse if (\n\t\t\ttypeof this.buttonInstance.b24Tracker !== 'undefined'\n\t\t\t&& typeof this.buttonInstance.b24Tracker.guest !== 'undefined'\n\t\t)\n\t\t{\n\t\t\ttraceData = this.buttonInstance.b24Tracker.guest.getTrace();\n\t\t}\n\n\t\treturn traceData;\n\t}\n\n\tgetCustomData()\n\t{\n\t\tlet customData = [];\n\n\t\tif (this.customData.length > 0)\n\t\t{\n\t\t\tcustomData = this.customData;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcustomData = [{MESSAGE: this.localize.BX_LIVECHAT_EXTRA_SITE+': [URL]'+location.href+'[/URL]'}];\n\t\t}\n\n\t\treturn JSON.stringify(customData);\n\t}\n\n\tisUserLoaded()\n\t{\n\t\treturn this.controller.getStore().state.widget.user.id > 0;\n\t}\n\n\tisUserReady()\n\t{\n\t\treturn this.isConfigDataLoaded() && this.isUserRegistered();\n\t}\n\n\tisHashAvailable()\n\t{\n\t\treturn !this.isUserRegistered()\n\t\t\t&& (this.userRegisterData.hash || this.getUserHashCookie());\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.host.replace(/(http.?:\\/\\/)|([:.\\\\\\/])/mg, \"\")+this.code;\n\t}\n\n\tgetHost()\n\t{\n\t\treturn this.host;\n\t}\n\n\tgetConfigId()\n\t{\n\t\treturn this.controller.getStore().state.widget.common.configId;\n\t}\n\n\tisDialogStart()\n\t{\n\t\treturn this.controller.getStore().state.widget.common.dialogStart;\n\t}\n\n\tgetChatId()\n\t{\n\t\treturn this.controller.getStore().state.application.dialog.chatId;\n\t}\n\n\tgetDialogId()\n\t{\n\t\treturn this.controller.getStore().state.application.dialog.dialogId;\n\t}\n\n\tgetDiskFolderId()\n\t{\n\t\treturn this.controller.getStore().state.application.dialog.diskFolderId;\n\t}\n\n\tgetDialogData(dialogId = this.getDialogId())\n\t{\n\t\treturn this.controller.getStore().state.dialogues.collection[dialogId];\n\t}\n\n\tgetSessionId()\n\t{\n\t\treturn this.controller.getStore().state.widget.dialog.sessionId;\n\t}\n\n\tisSessionClose()\n\t{\n\t\treturn this.controller.getStore().state.widget.dialog.sessionClose;\n\t}\n\n\tgetUserHash()\n\t{\n\t\treturn this.controller.getStore().state.widget.user.hash;\n\t}\n\n\tgetUserHashCookie()\n\t{\n\t\tlet userHash = '';\n\n\t\tlet cookie = Cookie.get(null, 'LIVECHAT_HASH');\n\t\tif (typeof cookie === 'string' && cookie.match(/^[a-f0-9]{32}$/))\n\t\t{\n\t\t\tuserHash= cookie;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet cookie = Cookie.get(this.getSiteId(), 'LIVECHAT_HASH');\n\t\t\tif (typeof cookie === 'string' && cookie.match(/^[a-f0-9]{32}$/))\n\t\t\t{\n\t\t\t\tuserHash = cookie;\n\t\t\t}\n\t\t}\n\n\t\treturn userHash;\n\t}\n\n\tgetUserId()\n\t{\n\t\treturn this.controller.getStore().state.widget.user.id;\n\t}\n\n\tgetUserData()\n\t{\n\t\tif (!this.controller || !this.controller.getStore())\n\t\t{\n\t\t\tconsole.error('LiveChatWidget.getUserData: method can be called after fired event - onBitrixLiveChat');\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.controller.getStore().state.widget.user;\n\t}\n\n\tgetUserRegisterFields()\n\t{\n\t\treturn {\n\t\t\t'name': this.userRegisterData.name || '',\n\t\t\t'last_name': this.userRegisterData.lastName || '',\n\t\t\t'avatar': this.userRegisterData.avatar || '',\n\t\t\t'email': this.userRegisterData.email || '',\n\t\t\t'www': this.userRegisterData.www || '',\n\t\t\t'gender': this.userRegisterData.gender || '',\n\t\t\t'position': this.userRegisterData.position || '',\n\t\t\t'user_hash': this.userRegisterData.hash || this.getUserHashCookie() || '',\n\t\t\t'consent_url': this.controller.getStore().state.widget.common.consentUrl? location.href: '',\n\t\t\t'trace_data': this.getCrmTraceData(),\n\t\t\t'custom_data': this.getCustomData()\n\t\t};\n\t}\n\n\tgetWidgetLocationCode()\n\t{\n\t\treturn LocationStyle[this.controller.getStore().state.widget.common.location];\n\t}\n\n\t// public method\n\tsetUserRegisterData(params)\n\t{\n\t\tif (!this.controller || !this.controller.getStore())\n\t\t{\n\t\t\tconsole.error('LiveChatWidget.getUserData: method can be called after fired event - onBitrixLiveChat');\n\t\t\treturn false;\n\t\t}\n\n\t\tconst validUserFields = ['hash', 'name', 'lastName', 'avatar', 'email', 'www', 'gender', 'position'];\n\n\t\tif (!Utils.types.isPlainObject(params))\n\t\t{\n\t\t\tconsole.error(`%cLiveChatWidget.setUserData: params is not a object`, \"color: black;\");\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (let field in this.userRegisterData)\n\t\t{\n\t\t\tif (!this.userRegisterData.hasOwnProperty(field))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (!params[field])\n\t\t\t{\n\t\t\t\tdelete this.userRegisterData[field];\n\t\t\t}\n\t\t}\n\n\t\tfor (let field in params)\n\t\t{\n\t\t\tif (!params.hasOwnProperty(field))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (validUserFields.indexOf(field) === -1)\n\t\t\t{\n\t\t\t\tconsole.warn(`%cLiveChatWidget.setUserData: user field is not set, because you are trying to set an unknown field (%c${field}%c)`, \"color: black;\", \"font-weight: bold; color: red\", \"color: black\");\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.userRegisterData[field] = params[field];\n\t\t}\n\n\t\tif (\n\t\t\tthis.userRegisterData.hash\n\t\t\t&& this.getUserHash()\n\t\t\t&& this.userRegisterData.hash !== this.getUserHash()\n\t\t)\n\t\t{\n\t\t\tthis.setNewAuthToken(this.userRegisterData.hash);\n\t\t}\n\t}\n\n\tsetNewAuthToken(authToken = '')\n\t{\n\t\tthis.controller.getStoreBuilder().clearModelState();\n\t\tCookie.set(null, 'LIVECHAT_HASH', '', {expires: 365*86400, path: '/'});\n\n\t\tthis.controller.restClient.setAuthId(RestAuth.guest, authToken);\n\t}\n\n\t// public method\n\tsetOption(name, value)\n\t{\n\t\tthis.options[name] = value;\n\t\treturn true;\n\t}\n\n\t// public method\n\tsetCustomData(params)\n\t{\n\t\tif (!this.controller || !this.controller.getStore())\n\t\t{\n\t\t\tconsole.error('LiveChatWidget.getUserData: method can be called after fired event - onBitrixLiveChat');\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = [];\n\t\tif (params instanceof Array)\n\t\t{\n\t\t\tparams.forEach(element =>\n\t\t\t{\n\t\t\t\tif (element && typeof element === 'object')\n\t\t\t\t{\n\t\t\t\t\tresult.push(element);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (result.length <= 0)\n\t\t\t{\n\t\t\t\tconsole.error('LiveChatWidget.setCustomData: params is empty');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!params)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tresult = [{'MESSAGE': params}]\n\t\t}\n\n\t\tthis.customData = this.customData.concat(result);\n\n\t\treturn true;\n\t}\n\n\tsetError(code = '', description = '')\n\t{\n\t\tconsole.error(`LiveChatWidget.error: ${code} (${description})`);\n\n\t\tlet localizeDescription = '';\n\t\tif (code === 'LIVECHAT_AUTH_FAILED')\n\t\t{\n\t\t\tlocalizeDescription = this.getLocalize('BX_LIVECHAT_AUTH_FAILED').replace('#LINK_START#', '<a href=\"javascript:void();\" onclick=\"location.reload()\">').replace('#LINK_END#', '</a>');\n\t\t\tthis.setNewAuthToken();\n\t\t}\n\t\telse if (code === 'LIVECHAT_AUTH_PORTAL_USER')\n\t\t{\n\t\t\tlocalizeDescription = this.getLocalize('BX_LIVECHAT_PORTAL_USER_NEW').replace('#LINK_START#', '<a href=\"'+this.host+'\">').replace('#LINK_END#', '</a>');\n\t\t}\n\t\telse if (code === 'LIVECHAT_SAME_DOMAIN')\n\t\t{\n\t\t\tlocalizeDescription = this.getLocalize('BX_LIVECHAT_SAME_DOMAIN');\n\t\t\tlet link = this.getLocalize('BX_LIVECHAT_SAME_DOMAIN_LINK');\n\t\t\tif (link)\n\t\t\t{\n\t\t\t\tlocalizeDescription += '<br><br><a href=\"'+link+'\">'+this.getLocalize('BX_LIVECHAT_SAME_DOMAIN_MORE')+'</a>';\n\t\t\t}\n\t\t}\n\t\telse if (code.endsWith('LOCALIZED'))\n\t\t{\n\t\t\tlocalizeDescription = description;\n\t\t}\n\n\t\tthis.controller.getStore().commit('application/set', {error: {\n\t\t\tactive: true,\n\t\t\tcode,\n\t\t\tdescription: localizeDescription\n\t\t}});\n\t}\n\n\tclearError()\n\t{\n\t\tthis.controller.getStore().commit('application/set', {error: {\n\t\t\tactive: false,\n\t\t\tcode: '',\n\t\t\tdescription: ''}\n\t\t});\n\t}\n\n\t// public method\n\tsubscribe(params)\n\t{\n\t\tif (!Utils.types.isPlainObject(params))\n\t\t{\n\t\t\tconsole.error(`%cLiveChatWidget.subscribe: params is not a object`, \"color: black;\");\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!SubscriptionTypeCheck.includes(params.type))\n\t\t{\n\t\t\tconsole.error(`%cLiveChatWidget.subscribe: subscription type is not correct (%c${params.type}%c)`, \"color: black;\", \"font-weight: bold; color: red\", \"color: black\");\n\t\t\treturn false;\n\t\t}\n\n\t\tif (typeof params.callback !== 'function')\n\t\t{\n\t\t\tconsole.error(`%cLiveChatWidget.subscribe: callback is not a function (%c${typeof params.callback}%c)`, \"color: black;\", \"font-weight: bold; color: red\", \"color: black\");\n\t\t\treturn false;\n\t\t}\n\n\t\tif (typeof (this.subscribers[params.type]) === 'undefined')\n\t\t{\n\t\t\tthis.subscribers[params.type] = [];\n\t\t}\n\n\t\tthis.subscribers[params.type].push(params.callback);\n\n\t\treturn function () {\n\t\t\tthis.subscribers[params.type] = this.subscribers[params.type].filter(function(element) {\n\t\t\t\treturn element !== params.callback;\n\t\t\t});\n\t\t}.bind(this);\n\t}\n\n\tsendEvent(params)\n\t{\n\t\tparams = params || {};\n\n\t\tif (!params.type)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (typeof params.data !== 'object' || !params.data)\n\t\t{\n\t\t\tparams.data = {};\n\t\t}\n\n\t\tif (this.subscribers[params.type] instanceof Array && this.subscribers[params.type].length > 0)\n\t\t{\n\t\t\tthis.subscribers[params.type].forEach(callback => callback(params.data));\n\t\t}\n\n\t\tif (this.subscribers[SubscriptionType.every] instanceof Array && this.subscribers[SubscriptionType.every].length > 0)\n\t\t{\n\t\t\tthis.subscribers[SubscriptionType.every].forEach(callback => callback({type: params.type, data: params.data}));\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t// public method\n\taddLocalize(phrases)\n\t{\n\t\tif (typeof phrases !== \"object\" || !phrases)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (let name in phrases)\n\t\t{\n\t\t\tif (phrases.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.localize[name] = phrases[name];\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetLocalize(name)\n\t{\n\t\tlet phrase = '';\n\t\tif (typeof name === 'undefined')\n\t\t{\n\t\t\treturn this.localize;\n\t\t}\n\t\telse if (typeof this.localize[name.toString()] === 'undefined')\n\t\t{\n\t\t\tconsole.warn(`LiveChatWidget.getLocalize: message with code '${name.toString()}' is undefined.`)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tphrase = this.localize[name];\n\t\t}\n\n\t\treturn phrase;\n\t}\n\n/* endregion 04. Widget interaction and utils */\n\n/* region 05. Rest batch handlers */\n\thandleConfigGet(response): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst configGet = response[RestMethod.widgetConfigGet];\n\t\t\tif (configGet && configGet.error())\n\t\t\t{\n\t\t\t\treturn reject({\n\t\t\t\t\tcode: configGet.error().ex.error,\n\t\t\t\t\tdescription: configGet.error().ex.error_description\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.controller.executeRestAnswer(RestMethod.widgetConfigGet, configGet);\n\n\t\t\tresolve();\n\t\t});\n\t}\n\n\thandleUserGet(response): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst userGetResult = response[RestMethod.widgetUserGet];\n\t\t\tif (userGetResult.error())\n\t\t\t{\n\t\t\t\treturn reject({\n\t\t\t\t\tcode: userGetResult.error().ex.error,\n\t\t\t\t\tdescription: userGetResult.error().ex.error_description\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.controller.executeRestAnswer(RestMethod.widgetUserGet, userGetResult);\n\n\t\t\tresolve();\n\t\t});\n\t}\n\n\thandleChatGet(response): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst chatGetResult = response[ImRestMethodHandler.imChatGet];\n\t\t\tif (chatGetResult.error())\n\t\t\t{\n\t\t\t\treturn reject({\n\t\t\t\t\tcode: chatGetResult.error().ex.error,\n\t\t\t\t\tdescription: chatGetResult.error().ex.error_description\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.controller.executeRestAnswer(ImRestMethodHandler.imChatGet, chatGetResult);\n\n\t\t\tresolve();\n\t\t});\n\t}\n\n\thandleDialogGet(response): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst dialogGetResult = response[RestMethod.widgetDialogGet];\n\t\t\tif (!dialogGetResult)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\n\t\t\tif (dialogGetResult.error())\n\t\t\t{\n\t\t\t\treturn reject({\n\t\t\t\t\tcode: dialogGetResult.error().ex.error,\n\t\t\t\t\tdescription: dialogGetResult.error().ex.error_description\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.controller.executeRestAnswer(RestMethod.widgetDialogGet, dialogGetResult);\n\n\t\t\tresolve();\n\t\t});\n\t}\n\n\thandleDialogMessagesGet(response): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst dialogMessagesGetResult = response[ImRestMethodHandler.imDialogMessagesGetInit];\n\t\t\tif (!dialogMessagesGetResult)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\n\t\t\tif (dialogMessagesGetResult.error())\n\t\t\t{\n\t\t\t\treturn reject({\n\t\t\t\t\tcode: dialogMessagesGetResult.error().ex.error,\n\t\t\t\t\tdescription: dialogMessagesGetResult.error().ex.error_description\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.controller.getStore().dispatch('dialogues/saveDialog', {\n\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t});\n\n\t\t\tthis.controller.executeRestAnswer(ImRestMethodHandler.imDialogMessagesGetInit, dialogMessagesGetResult);\n\n\t\t\tresolve();\n\t\t});\n\t}\n\n\thandleUserRegister(response): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst userRegisterResult = response[RestMethod.widgetUserRegister];\n\t\t\tif (!userRegisterResult)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\n\t\t\tif (userRegisterResult.error())\n\t\t\t{\n\t\t\t\treturn reject({\n\t\t\t\t\tcode: userRegisterResult.error().ex.error,\n\t\t\t\t\tdescription: userRegisterResult.error().ex.error_description\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.controller.executeRestAnswer(RestMethod.widgetUserRegister, userRegisterResult);\n\n\t\t\tresolve();\n\t\t});\n\t}\n\n\thandleChatCreate(response): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst chatCreateResult = response[RestMethod.widgetChatCreate];\n\t\t\tif (!chatCreateResult)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\n\t\t\tif (chatCreateResult.error())\n\t\t\t{\n\t\t\t\treturn reject({\n\t\t\t\t\tcode: chatCreateResult.error().ex.error,\n\t\t\t\t\tdescription: chatCreateResult.error().ex.error_description\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.controller.executeRestAnswer(RestMethod.widgetChatCreate, chatCreateResult);\n\n\t\t\tresolve();\n\t\t});\n\t}\n\n\thandlePullRequests(response): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tlet timeShift = 0;\n\n\t\t\tconst serverTimeResult = response[RestMethod.pullServerTime];\n\t\t\tif (serverTimeResult && !serverTimeResult.error())\n\t\t\t{\n\t\t\t\ttimeShift = Math.floor((Date.now() - new Date(serverTimeResult.data()).getTime()) / 1000);\n\t\t\t}\n\n\t\t\tlet config = null;\n\t\t\tconst pullConfigResult = response[RestMethod.pullConfigGet];\n\t\t\tif (pullConfigResult && !pullConfigResult.error())\n\t\t\t{\n\t\t\t\tconfig = pullConfigResult.data();\n\t\t\t\tconfig.server.timeShift = timeShift;\n\t\t\t}\n\n\t\t\tthis.startPullClient(config).then(() => {\n\t\t\t\tEventEmitter.emit(WidgetEventType.processMessagesToSendQueue);\n\t\t\t}).catch((error) => {\n\t\t\t\tthis.setError(error.ex.error, error.ex.error_description);\n\t\t\t}).finally(resolve);\n\t\t});\n\t}\n/* endregion 05. Rest batch handlers */\n}\n","/**\n * Bitrix OpenLines widget\n * Widget public interface\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {Widget} from \"./widget\"\nimport {SubscriptionType} from \"./const\";\n\nexport class WidgetPublicManager\n{\n\tconstructor(config)\n\t{\n\t\tthis.developerInfo = 'Do not use private methods.';\n\t\tthis.__privateMethods__ = new Widget(config);\n\t\tthis.__createLegacyMethods();\n\t}\n\n\topen(params)\n\t{\n\t\treturn this.__privateMethods__.open(params);\n\t}\n\n\tclose()\n\t{\n\t\treturn this.__privateMethods__.close();\n\t}\n\n\tshowNotification(params)\n\t{\n\t\treturn this.__privateMethods__.showNotification(params);\n\t}\n\n\tgetUserData()\n\t{\n\t\treturn this.__privateMethods__.getUserData();\n\t}\n\n\tsetUserRegisterData(params)\n\t{\n\t\treturn this.__privateMethods__.setUserRegisterData(params);\n\t}\n\n\tsetCustomData(params)\n\t{\n\t\treturn this.__privateMethods__.setCustomData(params);\n\t}\n\n\tmutateTemplateComponent(id, params)\n\t{\n\t\treturn this.__privateMethods__.mutateTemplateComponent(id, params);\n\t}\n\n\taddLocalize(phrases)\n\t{\n\t\treturn this.__privateMethods__.addLocalize(phrases);\n\t}\n\n\t/**\n\t *\n\t * @param params {Object}\n\t * @returns {Function|Boolean} - Unsubscribe callback function or False\n\t */\n\tsubscribe(params)\n\t{\n\t\treturn this.__privateMethods__.subscribe(params);\n\t}\n\n\tstart()\n\t{\n\t\treturn this.__privateMethods__.start();\n\t}\n\n\t__createLegacyMethods()\n\t{\n\t\tif (typeof window.BX.LiveChat === 'undefined')\n\t\t{\n\t\t\tlet sourceHref = document.createElement('a');\n\t\t\tsourceHref.href = this.__privateMethods__.host;\n\n\t\t\tlet sourceDomain = sourceHref.protocol+'//'+sourceHref.hostname+(sourceHref.port && sourceHref.port != '80' && sourceHref.port != '443'? \":\"+sourceHref.port: \"\");\n\n\t\t\twindow.BX.LiveChat = {\n\t\t\t\topenLiveChat: () => {\n\t\t\t\t\tthis.open({openFromButton: true});\n\t\t\t\t},\n\t\t\t\tcloseLiveChat: () => {\n\t\t\t\t\tthis.close();\n\t\t\t\t},\n\t\t\t\taddEventListener: (el, eventName, handler) =>\n\t\t\t\t{\n\t\t\t\t\tif (eventName === 'message')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.subscribe({\n\t\t\t\t\t\t\ttype: SubscriptionType.userMessage,\n\t\t\t\t\t\t\tcallback: function (event)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\thandler({origin: sourceDomain, data: JSON.stringify({action: 'sendMessage'}), event});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.warn('Method BX.LiveChat.addEventListener is not supported, user new format for subscribe.')\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetCookie: () => {},\n\t\t\t\tgetCookie: () => {},\n\t\t\t\tsourceDomain\n\t\t\t};\n\t\t}\n\n\t\tif (typeof window.BxLiveChatInit === 'function')\n\t\t{\n\t\t\tlet config = window.BxLiveChatInit();\n\n\t\t\tif (config.user)\n\t\t\t{\n\t\t\t\tthis.__privateMethods__.setUserRegisterData(config.user);\n\t\t\t}\n\t\t\tif (config.firstMessage)\n\t\t\t{\n\t\t\t\tthis.__privateMethods__.setCustomData(config.firstMessage)\n\t\t\t}\n\t\t}\n\n\t\tif (window.BxLiveChatLoader instanceof Array)\n\t\t{\n\t\t\twindow.BxLiveChatLoader.forEach(callback => callback());\n\t\t}\n\n\t\treturn true;\n\t}\n}","import {SendMessageHandler} from 'im.event-handler';\nimport {FormType, WidgetEventType, RestMethod as WidgetRestMethod} from '../const';\nimport {EventEmitter} from 'main.core.events';\nimport {DeviceType, EventType, RestMethod as ImRestMethod, RestMethodHandler} from 'im.const';\nimport {Utils} from 'im.lib.utils';\nimport {Logger} from 'im.lib.logger';\n\nexport class WidgetSendMessageHandler extends SendMessageHandler\n{\n\tapplication: Object = null;\n\tstoredMessage: string = null;\n\n\tconstructor($Bitrix)\n\t{\n\t\tsuper($Bitrix);\n\n\t\tthis.application = $Bitrix.Application.get();\n\n\t\tthis.onProcessQueueHandler = this.processQueue.bind(this);\n\t\tthis.onConsentAcceptedHandler = this.onConsentAccepted.bind(this);\n\t\tthis.onConsentDeclinedHandler = this.onConsentDeclined.bind(this);\n\n\t\tEventEmitter.subscribe(WidgetEventType.processMessagesToSendQueue, this.onProcessQueueHandler);\n\t\tEventEmitter.subscribe(WidgetEventType.consentAccepted, this.onConsentAcceptedHandler);\n\t\tEventEmitter.subscribe(WidgetEventType.consentDeclined, this.onConsentDeclinedHandler);\n\t}\n\n\tdestroy(): void\n\t{\n\t\tsuper.destroy();\n\t\tEventEmitter.unsubscribe(WidgetEventType.processMessagesToSendQueue, this.onProcessQueueHandler);\n\t\tEventEmitter.unsubscribe(WidgetEventType.consentAccepted, this.onConsentAcceptedHandler);\n\t\tEventEmitter.unsubscribe(WidgetEventType.consentDeclined, this.onConsentDeclinedHandler);\n\t}\n\n\tonSendMessage({data: event})\n\t{\n\t\tevent.focus = event.focus !== false;\n\n\t\t//hide smiles\n\t\tif (this.getWidgetData().common.showForm === FormType.smile)\n\t\t{\n\t\t\tEventEmitter.emit(WidgetEventType.hideForm);\n\t\t}\n\n\t\t//show consent window if needed\n\t\tif (!this.getWidgetData().dialog.userConsent && this.getWidgetData().common.consentUrl)\n\t\t{\n\t\t\tif (event.text)\n\t\t\t{\n\t\t\t\tthis.storedMessage = event.text;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(WidgetEventType.showConsent);\n\n\t\t\treturn false;\n\t\t}\n\n\t\tevent.text = event.text ? event.text : this.storedMessage;\n\t\tif (!event.text && !event.file)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tEventEmitter.emit(WidgetEventType.hideForm);\n\n\t\tif (this.isCreateSessionMode())\n\t\t{\n\t\t\tEventEmitter.emit(WidgetEventType.hideForm);\n\t\t\tEventEmitter.emit(EventType.textarea.stopWriting);\n\t\t\tEventEmitter.emitAsync(WidgetEventType.createSession).then(() => {\n\t\t\t\tthis.store.commit('widget/common', {isCreateSessionMode: false});\n\t\t\t\tthis.sendMessage(event.text, event.file);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendMessage(event.text, event.file);\n\t\t}\n\n\t\tif (event.focus)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.textarea.setFocus);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tsendMessage(text = '', file = null)\n\t{\n\t\tif (!text && !file)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst quoteId = this.store.getters['dialogues/getQuoteId'](this.getDialogId());\n\t\tif (quoteId)\n\t\t{\n\t\t\tconst quoteMessage = this.store.getters['messages/getMessage'](this.getChatId(), quoteId);\n\n\t\t\tif (quoteMessage)\n\t\t\t{\n\t\t\t\ttext = this.getMessageTextWithQuote(quoteMessage, text);\n\t\t\t\tEventEmitter.emit(EventType.dialog.quotePanelClose);\n\t\t\t}\n\t\t}\n\n\t\tif (!this.controller.application.isUnreadMessagesLoaded())\n\t\t{\n\t\t\tthis.sendMessageToServer({\n\t\t\t\tid: 0,\n\t\t\t\tchatId: this.getChatId(),\n\t\t\t\tdialogId: this.getDialogId(),\n\t\t\t\ttext,\n\t\t\t\tfile\n\t\t\t});\n\t\t\tthis.processQueue();\n\n\t\t\treturn true;\n\t\t}\n\n\t\tconst params = {};\n\t\tif (file)\n\t\t{\n\t\t\tparams.FILE_ID = [file.id];\n\t\t}\n\n\t\tthis.addMessageToModel({\n\t\t\ttext,\n\t\t\tparams,\n\t\t\tsending: !file\n\t\t}).then(messageId => {\n\t\t\tif (!this.isDialogStart())\n\t\t\t{\n\t\t\t\tthis.store.commit('widget/common', {dialogStart: true});\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\tchatId: this.getChatId(),\n\t\t\t\tcancelIfScrollChange: true\n\t\t\t});\n\n\t\t\tthis.addMessageToQueue({messageId, text, file});\n\n\t\t\tif (this.getChatId())\n\t\t\t{\n\t\t\t\tthis.processQueue();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tEventEmitter.emit(WidgetEventType.requestData);\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tonClickOnKeyboard({data: event})\n\t{\n\t\tif (event.action === 'ACTION' && event.params.action === 'LIVECHAT')\n\t\t{\n\t\t\tconst {dialogId, messageId, value} = event.params;\n\t\t\tconst values = JSON.parse(value);\n\n\t\t\tconst sessionId = Number.parseInt(values.SESSION_ID, 10);\n\t\t\tif (sessionId !== this.getSessionId() || this.isSessionClose())\n\t\t\t{\n\t\t\t\tconsole.error('WidgetSendMessageHandler', this.loc['BX_LIVECHAT_ACTION_EXPIRED']);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.restClient.callMethod(WidgetRestMethod.widgetActionSend, {\n\t\t\t\t'MESSAGE_ID': messageId,\n\t\t\t\t'DIALOG_ID': dialogId,\n\t\t\t\t'ACTION_VALUE': value,\n\t\t\t});\n\t\t}\n\n\t\tif (event.action === 'COMMAND')\n\t\t{\n\t\t\tconst {dialogId, messageId, botId, command, params} = event.params;\n\n\t\t\tthis.restClient.callMethod(ImRestMethod.imMessageCommand, {\n\t\t\t\t'MESSAGE_ID': messageId,\n\t\t\t\t'DIALOG_ID': dialogId,\n\t\t\t\t'BOT_ID': botId,\n\t\t\t\t'COMMAND': command,\n\t\t\t\t'COMMAND_PARAMS': params,\n\t\t\t}).catch(error => console.error('WidgetSendMessageHandler: command processing error', error));\n\t\t}\n\t}\n\n\tgetWidgetData(): Object\n\t{\n\t\treturn this.store.state.widget;\n\t}\n\n\tgetChatId(): number\n\t{\n\t\treturn this.store.state.application.dialog.chatId;\n\t}\n\n\tgetDialogId(): number | string\n\t{\n\t\treturn this.store.state.application.dialog.dialogId;\n\t}\n\n\tgetUserId(): number\n\t{\n\t\treturn this.store.state.widget.user.id;\n\t}\n\n\tgetMessageTextWithQuote(quoteMessage, text): string\n\t{\n\t\tlet user = null;\n\t\tif (quoteMessage.authorId)\n\t\t{\n\t\t\tuser = this.store.getters['users/get'](quoteMessage.authorId);\n\t\t}\n\n\t\tconst files = this.store.getters['files/getList'](this.getChatId());\n\n\t\tconst quoteDelimiter = '-'.repeat(54);\n\t\tconst quoteTitle = (user && user.name) ? user.name : this.loc['BX_LIVECHAT_SYSTEM_MESSAGE'];\n\t\tconst quoteDate = Utils.date.format(quoteMessage.date, null, this.loc);\n\t\tconst quoteContent = Utils.text.quote(quoteMessage.text, quoteMessage.params, files, this.loc);\n\n\t\tconst message = [];\n\t\tmessage.push(quoteDelimiter);\n\t\tmessage.push(`${quoteTitle} [${quoteDate}]`);\n\t\tmessage.push(quoteContent);\n\t\tmessage.push(quoteDelimiter);\n\t\tmessage.push(text);\n\n\t\treturn message.join(\"\\n\");\n\t}\n\n\taddMessageToQueue({messageId, text, file}): void\n\t{\n\t\tthis.messagesToSend.push({\n\t\t\tid: messageId,\n\t\t\tchatId: this.getChatId(),\n\t\t\tdialogId: this.getDialogId(),\n\t\t\ttext,\n\t\t\tfile,\n\t\t\tsending: false\n\t\t});\n\t}\n\n\tsendMessageToServer(message)\n\t{\n\t\tEventEmitter.emit(EventType.textarea.stopWriting);\n\n\t\t// first message, when we didn't have chat\n\t\tif (message.chatId === 0)\n\t\t{\n\t\t\tmessage.chatId = this.getChatId();\n\t\t}\n\n\t\tthis.restClient.callMethod(ImRestMethod.imMessageAdd, {\n\t\t\t'TEMPLATE_ID': message.id,\n\t\t\t'CHAT_ID': message.chatId,\n\t\t\t'MESSAGE': message.text\n\t\t}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: ImRestMethod.imMessageAdd,\n\t\t\tdata: {timMessageType: 'text'},\n\t\t\tdialog: this.getDialogData()\n\t\t})).then(response => {\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, response, message);\n\t\t}).catch(error => {\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, error, message);\n\t\t\tLogger.warn('Error during sending message', error);\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tisDialogStart(): boolean\n\t{\n\t\treturn this.store.state.widget.common.dialogStart;\n\t}\n\n\tisCreateSessionMode(): boolean\n\t{\n\t\treturn this.store.state.widget.common.isCreateSessionMode;\n\t}\n\n\tgetDialogData(): Object\n\t{\n\t\tconst dialogId = this.getDialogId();\n\n\t\treturn this.store.state.dialogues.collection[dialogId];\n\t}\n\n\tgetApplicationModel()\n\t{\n\t\treturn this.store.state.application;\n\t}\n\n\tgetSessionId()\n\t{\n\t\treturn this.store.state.widget.dialog.sessionId;\n\t}\n\n\tisSessionClose()\n\t{\n\t\treturn this.store.state.widget.dialog.sessionClose;\n\t}\n\n\tprocessQueue(): void\n\t{\n\t\tif (this.application.offline)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.messagesToSend.filter(element => !element.sending).forEach(element => {\n\t\t\tthis.deleteFromQueue(element.id);\n\t\t\telement.sending = true;\n\t\t\tif (element.file)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.textarea.stopWriting);\n\t\t\t\tEventEmitter.emit(EventType.uploader.addMessageWithFile, element);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.sendMessageToServer(element);\n\t\t\t}\n\t\t});\n\t}\n\n\tonConsentAccepted()\n\t{\n\t\tif (!this.storedMessage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isFocusNeeded = this.getApplicationModel().device.type !== DeviceType.mobile;\n\t\tthis.onSendMessage({\n\t\t\tdata: {focus: isFocusNeeded}\n\t\t});\n\t\tthis.storedMessage = '';\n\t}\n\n\tonConsentDeclined()\n\t{\n\t\tif (!this.storedMessage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEventEmitter.emit(EventType.textarea.insertText, {\n\t\t\ttext: this.storedMessage,\n\t\t\tfocus: this.getApplicationModel().device.type !== DeviceType.mobile\n\t\t});\n\t\tthis.storedMessage = '';\n\t}\n}","import { TextareaHandler } from \"im.event-handler\";\nimport { EventEmitter } from \"main.core.events\";\nimport { DeviceType, EventType } from \"im.const\";\nimport { WidgetEventType, FormType } from \"../const\";\nimport { Utils } from \"im.lib.utils\";\nimport { md5 } from \"main.md5\";\n\nexport class WidgetTextareaHandler extends TextareaHandler\n{\n\tapplication: Object = null;\n\tpullClient: Object = null;\n\n\tconstructor($Bitrix)\n\t{\n\t\tsuper($Bitrix);\n\t\tthis.application = $Bitrix.Application.get();\n\t\tthis.pullClient = $Bitrix.PullClient.get();\n\t}\n\n\tonAppButtonClick({data: event})\n\t{\n\t\tif (event.appId === FormType.smile)\n\t\t{\n\t\t\tif (this.getWidgetModel().common.showForm === FormType.smile)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(WidgetEventType.hideForm);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tEventEmitter.emit(WidgetEventType.showForm, {\n\t\t\t\t\ttype: FormType.smile\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEventEmitter.emit(EventType.textarea.setFocus);\n\t\t}\n\t}\n\n\tonFocus()\n\t{\n\t\tif (\n\t\t\tthis.getWidgetModel().common.copyright\n\t\t\t&& this.getApplicationModel().device.type === DeviceType.mobile\n\t\t)\n\t\t{\n\t\t\tthis.getWidgetModel().common.copyright = false;\n\t\t}\n\n\t\tif (Utils.device.isMobile())\n\t\t{\n\t\t\tclearTimeout(this.onFocusScrollTimeout);\n\t\t\tthis.onScrollHandler = this.onScroll.bind(this);\n\t\t\tthis.onFocusScrollTimeout = setTimeout(() => {\n\t\t\t\tdocument.addEventListener('scroll', this.onScrollHandler);\n\t\t\t}, 1000);\n\t\t}\n\t}\n\n\tonBlur()\n\t{\n\t\tif (\n\t\t\t!this.getWidgetModel().common.copyright\n\t\t\t&& this.getWidgetModel().common.copyright !== this.application.copyright\n\t\t)\n\t\t{\n\t\t\tthis.getWidgetModel().common.copyright = this.application.copyright;\n\t\t\tsetTimeout(() => {\n\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\tchatId: this.getChatId(),\n\t\t\t\t\tforce: true\n\t\t\t\t});\n\t\t\t}, 100);\n\t\t}\n\n\t\tif (Utils.device.isMobile())\n\t\t{\n\t\t\tclearTimeout(this.onFocusScrollTimeout);\n\t\t\tdocument.removeEventListener('scroll', this.onScrollHandler);\n\t\t}\n\t}\n\n\t// send typed client message to operator\n\tonKeyUp({data: event})\n\t{\n\t\tif (this.canSendTypedText())\n\t\t{\n\t\t\tconst {sessionId} = this.getWidgetModel().dialog;\n\t\t\tconst chatId = this.getChatId();\n\t\t\tconst userId = this.getWidgetModel().user.id;\n\t\t\tconst infoString = md5(`${sessionId}/${chatId}/${userId}`);\n\n\t\t\tconst operatorId = this.getWidgetModel().dialog.operator.id;\n\t\t\tconst {operatorChatId} = this.getWidgetModel().dialog;\n\t\t\tthis.pullClient.sendMessage([operatorId], 'imopenlines', 'linesMessageWrite', {\n\t\t\t\t\ttext: event.text,\n\t\t\t\t\tinfoString,\n\t\t\t\t\toperatorChatId: operatorChatId\n\t\t\t});\n\t\t}\n\t}\n\n\tcanSendTypedText()\n\t{\n\t\treturn this.getWidgetModel().common.watchTyping\n\t\t\t&& this.getWidgetModel().dialog.sessionId\n\t\t\t&& !this.getWidgetModel().dialog.sessionClose\n\t\t\t&& this.getWidgetModel().dialog.operator.id\n\t\t\t&& this.getWidgetModel().dialog.operatorChatId\n\t\t\t&& this.pullClient.isPublishingEnabled();\n\t}\n\n\tonScroll()\n\t{\n\t\tclearTimeout(this.onScrollTimeout);\n\t\tthis.onScrollTimeout = setTimeout(() => {\n\t\t\tEventEmitter.emit(EventType.textarea.setBlur, true);\n\t\t}, 50);\n\t}\n\n\tgetWidgetModel()\n\t{\n\t\treturn this.store.state.widget;\n\t}\n\n\tgetApplicationModel()\n\t{\n\t\treturn this.store.state.application;\n\t}\n}","import { TextareaUploadHandler } from 'im.event-handler';\nimport { Logger } from \"im.lib.logger\";\nimport { EventEmitter } from \"main.core.events\";\nimport { WidgetEventType } from \"../const\";\n\nexport class WidgetTextareaUploadHandler extends TextareaUploadHandler\n{\n\tstoredFile: Object = null;\n\n\tconstructor($Bitrix)\n\t{\n\t\tsuper($Bitrix);\n\n\t\tthis.onConsentAcceptedHandler = this.onConsentAccepted.bind(this);\n\t\tthis.onConsentDeclinedHandler = this.onConsentDeclined.bind(this);\n\t\tEventEmitter.subscribe(WidgetEventType.consentAccepted, this.onConsentAcceptedHandler);\n\t\tEventEmitter.subscribe(WidgetEventType.consentDeclined, this.onConsentDeclinedHandler);\n\t}\n\n\tdestroy(): void\n\t{\n\t\tsuper.destroy();\n\t\tEventEmitter.unsubscribe(WidgetEventType.consentAccepted, this.onConsentAcceptedHandler);\n\t\tEventEmitter.unsubscribe(WidgetEventType.consentDeclined, this.onConsentDeclinedHandler);\n\t}\n\n\tgetUserId(): number\n\t{\n\t\treturn this.controller.store.state.widget.user.id;\n\t}\n\n\tgetUserHash(): string\n\t{\n\t\treturn this.controller.store.state.widget.user.hash;\n\t}\n\n\tgetHost(): string\n\t{\n\t\treturn this.controller.store.state.widget.common.host;\n\t}\n\n\taddMessageWithFile(event)\n\t{\n\t\tconst message = event.getData();\n\t\tif (!this.getDiskFolderId())\n\t\t{\n\t\t\tthis.requestDiskFolderId(message.chatId).then(() => {\n\t\t\t\tthis.addMessageWithFile(event);\n\t\t\t}).catch(error => {\n\t\t\t\tLogger.error('addMessageWithFile error', error);\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.uploader.senderOptions.customHeaders['Livechat-Dialog-Id'] = this.getDialogId();\n\t\tthis.uploader.senderOptions.customHeaders['Livechat-Auth-Id'] = this.getUserHash();\n\n\t\tthis.uploader.addTask({\n\t\t\ttaskId: message.file.id,\n\t\t\tfileData: message.file.source.file,\n\t\t\tfileName: message.file.source.file.name,\n\t\t\tgenerateUniqueName: true,\n\t\t\tdiskFolderId: this.getDiskFolderId(),\n\t\t\tpreviewBlob: message.file.previewBlob,\n\t\t});\n\t}\n\n\tonTextareaFileSelected({data: event} = {})\n\t{\n\t\tlet fileInputEvent = null;\n\t\tif (event && event.fileChangeEvent && event.fileChangeEvent.target.files.length > 0)\n\t\t{\n\t\t\tfileInputEvent = event.fileChangeEvent;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfileInputEvent = this.storedFile;\n\t\t}\n\n\t\tif (!fileInputEvent)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.controller.store.state.widget.dialog.userConsent && this.controller.store.state.widget.common.consentUrl)\n\t\t{\n\t\t\tthis.storedFile = event.fileChangeEvent;\n\t\t\tEventEmitter.emit(WidgetEventType.showConsent);\n\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.uploadFile(fileInputEvent);\n\t}\n\n\tuploadFile(event)\n\t{\n\t\tif (!event)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.getChatId())\n\t\t{\n\t\t\tEventEmitter.emit(WidgetEventType.requestData);\n\t\t}\n\n\t\tthis.uploader.addFilesFromEvent(event);\n\t}\n\n\tonConsentAccepted()\n\t{\n\t\tif (!this.storedFile)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.onTextareaFileSelected();\n\t\tthis.storedFile = '';\n\t}\n\n\tonConsentDeclined()\n\t{\n\t\tif (!this.storedFile)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.storedFile = '';\n\t}\n\n\tgetUploaderSenderOptions()\n\t{\n\t\treturn {\n\t\t\thost: this.getHost(),\n\t\t\tcustomHeaders: {\n\t\t\t\t'Livechat-Auth-Id': this.getUserHash()\n\t\t\t},\n\t\t\tactionUploadChunk: 'imopenlines.widget.disk.upload',\n\t\t\tactionCommitFile: 'imopenlines.widget.disk.commit',\n\t\t\tactionRollbackUpload: 'imopenlines.widget.disk.rollbackUpload',\n\t\t};\n\t}\n}","import {ReadingHandler} from \"im.event-handler\";\n\nexport class WidgetReadingHandler extends ReadingHandler\n{\n\tapplication: Object = null;\n\n\tconstructor($Bitrix)\n\t{\n\t\tsuper($Bitrix);\n\t\tthis.application = $Bitrix.Application.get();\n\t}\n\n\treadMessage(messageId, skipTimer = false, skipAjax = false): Promise\n\t{\n\t\tif (this.application.offline)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn super.readMessage(messageId, skipTimer, skipAjax);\n\t}\n}","import { LocationType, WidgetMinimumSize } from \"../const\";\nimport { EventEmitter } from \"main.core.events\";\nimport { Type } from \"main.core\";\n\nexport class WidgetResizeHandler extends EventEmitter\n{\n\tstatic events = {\n\t\tonSizeChange: 'onSizeChange',\n\t\tonStopResize: 'onStopResize'\n\t};\n\n\tisResizing: boolean = false;\n\twidgetLocation: number = null;\n\tavailableWidth: number = null;\n\tavailableHeight: number = null;\n\n\tconstructor({widgetLocation, availableWidth, availableHeight, events})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.IMOL.WidgetResizeHandler');\n\t\tthis.subscribeToEvents(events);\n\n\t\tthis.widgetLocation = widgetLocation;\n\t\tthis.availableWidth = availableWidth;\n\t\tthis.availableHeight = availableHeight;\n\t}\n\n\tsubscribeToEvents(configEvents)\n\t{\n\t\tconst events = Type.isObject(configEvents) ? configEvents : {};\n\t\tObject.entries(events).forEach(([name, callback]) => {\n\t\t\tif (Type.isFunction(callback))\n\t\t\t{\n\t\t\t\tthis.subscribe(name, callback);\n\t\t\t}\n\t\t});\n\t}\n\n\tstartResize(event, currentHeight, currentWidth)\n\t{\n\t\tif (this.isResizing)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.isResizing = true;\n\t\tevent = event.changedTouches ? event.changedTouches[0] : event;\n\n\t\tthis.cursorStartPointY = event.clientY;\n\t\tthis.cursorStartPointX = event.clientX;\n\t\tthis.heightStartPoint = currentHeight;\n\t\tthis.widthStartPoint = currentWidth;\n\n\t\tthis.addWidgetResizeEvents();\n\t}\n\n\tonContinueResize(event)\n\t{\n\t\tif (!this.isResizing)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tevent = event.changedTouches ? event.changedTouches[0] : event;\n\n\t\tthis.cursorControlPointY = event.clientY;\n\t\tthis.cursorControlPointX = event.clientX;\n\n\t\tconst maxHeight = this.isBottomLocation()\n\t\t\t? Math.min(this.heightStartPoint + this.cursorStartPointY - this.cursorControlPointY, this.availableHeight)\n\t\t\t: Math.min(this.heightStartPoint - this.cursorStartPointY + this.cursorControlPointY, this.availableHeight)\n\t\t;\n\t\tconst height = Math.max(maxHeight, WidgetMinimumSize.height);\n\n\t\tconst maxWidth = this.isLeftLocation()\n\t\t\t? Math.min(this.widthStartPoint - this.cursorStartPointX + this.cursorControlPointX, this.availableWidth)\n\t\t\t: Math.min(this.widthStartPoint + this.cursorStartPointX - this.cursorControlPointX, this.availableWidth)\n\t\t;\n\t\tconst width = Math.max(maxWidth, WidgetMinimumSize.width);\n\n\t\tthis.emit(WidgetResizeHandler.events.onSizeChange, {newHeight: height, newWidth: width});\n\t}\n\n\tonStopResize()\n\t{\n\t\tif (!this.isResizing)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.isResizing = false;\n\t\tthis.removeWidgetResizeEvents();\n\n\t\tthis.emit(WidgetResizeHandler.events.onStopResize);\n\t}\n\n\tsetAvailableWidth(width)\n\t{\n\t\tthis.availableWidth = width;\n\t}\n\n\tsetAvailableHeight(height)\n\t{\n\t\tthis.availableHeight = height;\n\t}\n\n\taddWidgetResizeEvents()\n\t{\n\t\tthis.onContinueResizeHandler = this.onContinueResize.bind(this);\n\t\tthis.onStopResizeHandler = this.onStopResize.bind(this);\n\t\tdocument.addEventListener('mousemove', this.onContinueResizeHandler);\n\t\tdocument.addEventListener('mouseup', this.onStopResizeHandler);\n\t\tdocument.addEventListener('mouseleave', this.onStopResizeHandler);\n\t}\n\n\tremoveWidgetResizeEvents()\n\t{\n\t\tdocument.removeEventListener('mousemove', this.onContinueResizeHandler);\n\t\tdocument.removeEventListener('mouseup', this.onStopResizeHandler);\n\t\tdocument.removeEventListener('mouseleave', this.onStopResizeHandler);\n\t}\n\n\tisBottomLocation()\n\t{\n\t\treturn [LocationType.bottomLeft, LocationType.bottomMiddle, LocationType.bottomRight].includes(this.widgetLocation);\n\t}\n\n\tisLeftLocation()\n\t{\n\t\treturn [LocationType.bottomLeft, LocationType.topLeft, LocationType.topMiddle].includes(this.widgetLocation);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.removeWidgetResizeEvents();\n\t}\n}","import { EventEmitter } from \"main.core.events\";\nimport { WidgetEventType, FormType, RestMethod } from \"../const\";\nimport { DeviceType, EventType } from \"im.const\";\n\nexport class WidgetConsentHandler\n{\n\tstore: Object = null;\n\trestClient: Object = null;\n\tapplication: Object = null;\n\n\tconstructor($Bitrix)\n\t{\n\t\tthis.store = $Bitrix.Data.get('controller').store;\n\t\tthis.restClient = $Bitrix.RestClient.get();\n\t\tthis.application = $Bitrix.Application.get();\n\n\t\tthis.subscribeToEvents();\n\t}\n\n\tsubscribeToEvents()\n\t{\n\t\tthis.showConsentHandler = this.onShowConsent.bind(this);\n\t\tthis.acceptConsentHandler = this.onAcceptConsent.bind(this);\n\t\tthis.declineConsentHandler = this.onDeclineConsent.bind(this);\n\t\tEventEmitter.subscribe(WidgetEventType.showConsent, this.showConsentHandler);\n\t\tEventEmitter.subscribe(WidgetEventType.acceptConsent, this.acceptConsentHandler);\n\t\tEventEmitter.subscribe(WidgetEventType.declineConsent, this.declineConsentHandler);\n\t}\n\n\tonShowConsent()\n\t{\n\t\tthis.showConsent();\n\t}\n\n\tonAcceptConsent()\n\t{\n\t\tthis.acceptConsent();\n\t}\n\n\tonDeclineConsent()\n\t{\n\t\tthis.declineConsent();\n\t}\n\n\tshowConsent()\n\t{\n\t\tthis.store.commit('widget/common', {showConsent: true});\n\t}\n\n\thideConsent()\n\t{\n\t\tthis.store.commit('widget/common', {showConsent: false});\n\t}\n\n\tacceptConsent()\n\t{\n\t\tthis.hideConsent();\n\n\t\tthis.sendConsentDecision(true);\n\n\t\tEventEmitter.emit(WidgetEventType.consentAccepted);\n\n\t\tif (this.getWidgetModel().common.showForm === FormType.none)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.textarea.setFocus);\n\t\t}\n\t}\n\n\tdeclineConsent()\n\t{\n\t\tEventEmitter.emit(WidgetEventType.hideForm);\n\t\tthis.hideConsent();\n\t\tthis.sendConsentDecision(false);\n\n\t\tEventEmitter.emit(WidgetEventType.consentDeclined);\n\n\t\tif (this.getApplicationModel().device.type !== DeviceType.mobile)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.textarea.setFocus);\n\t\t}\n\t}\n\n\tsendConsentDecision(result)\n\t{\n\t\tthis.store.commit('widget/dialog', {userConsent: result});\n\n\t\tif (result && this.application.isUserRegistered())\n\t\t{\n\t\t\tthis.restClient.callMethod(RestMethod.widgetUserConsentApply, {\n\t\t\t\tconfig_id: this.getWidgetModel().common.configId,\n\t\t\t\tconsent_url: location.href\n\t\t\t});\n\t\t}\n\t}\n\n\tgetWidgetModel()\n\t{\n\t\treturn this.store.state.widget;\n\t}\n\n\tgetApplicationModel()\n\t{\n\t\treturn this.store.state.application;\n\t}\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(WidgetEventType.showConsent, this.showConsentHandler);\n\t\tEventEmitter.unsubscribe(WidgetEventType.acceptConsent, this.acceptConsentHandler);\n\t\tEventEmitter.unsubscribe(WidgetEventType.declineConsent, this.declineConsentHandler);\n\t}\n}","import { EventEmitter } from \"main.core.events\";\nimport { WidgetEventType, FormType, RestMethod, SubscriptionType, VoteType } from \"../const\";\n\nexport class WidgetFormHandler\n{\n\tstore: Object = null;\n\tapplication: Object = null;\n\trestClient: Object = null;\n\n\tconstructor($Bitrix)\n\t{\n\t\tthis.store = $Bitrix.Data.get('controller').store;\n\t\tthis.restClient = $Bitrix.RestClient.get();\n\t\tthis.application = $Bitrix.Application.get();\n\n\t\tthis.showFormHandler = this.onShowForm.bind(this);\n\t\tthis.hideFormHandler = this.onHideForm.bind(this);\n\t\tthis.sendVoteHandler = this.onSendVote.bind(this);\n\t\tEventEmitter.subscribe(WidgetEventType.showForm, this.showFormHandler);\n\t\tEventEmitter.subscribe(WidgetEventType.hideForm, this.hideFormHandler);\n\t\tEventEmitter.subscribe(WidgetEventType.sendDialogVote, this.sendVoteHandler);\n\t}\n\n\tonShowForm({data: event})\n\t{\n\t\tclearTimeout(this.showFormTimeout);\n\t\tif (event.type === FormType.like)\n\t\t{\n\t\t\tif (event.delayed)\n\t\t\t{\n\t\t\t\tthis.showFormTimeout = setTimeout(() => {\n\t\t\t\t\tthis.showLikeForm();\n\t\t\t\t}, 5000);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showLikeForm();\n\t\t\t}\n\t\t}\n\t\telse if (event.type === FormType.smile)\n\t\t{\n\t\t\tthis.showSmiles();\n\t\t}\n\t}\n\n\tonHideForm()\n\t{\n\t\tthis.hideForm();\n\t}\n\n\tonSendVote({data: {vote}})\n\t{\n\t\tconsole.warn('VOTE', vote);\n\t\tthis.sendVote(vote);\n\t}\n\n\tshowLikeForm()\n\t{\n\t\tif (this.application.offline)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tclearTimeout(this.showFormTimeout);\n\t\tif (!this.getWidgetModel().common.vote.enable)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\tthis.getWidgetModel().dialog.sessionClose\n\t\t\t&& this.getWidgetModel().dialog.userVote !== VoteType.none\n\t\t)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.commit('widget/common', {showForm: FormType.like});\n\t}\n\n\tshowSmiles()\n\t{\n\t\tthis.store.commit('widget/common', {showForm: FormType.smile});\n\t}\n\n\tsendVote(vote)\n\t{\n\t\tconst {sessionId} = this.getWidgetModel().dialog;\n\t\tif (!sessionId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.restClient.callMethod(RestMethod.widgetVoteSend, {\n\t\t\t'SESSION_ID': sessionId,\n\t\t\t'ACTION': vote\n\t\t}).catch(() => {\n\t\t\tthis.store.commit('widget/dialog', {userVote: VoteType.none});\n\t\t});\n\n\t\tthis.application.sendEvent({\n\t\t\ttype: SubscriptionType.userVote,\n\t\t\tdata: { vote }\n\t\t});\n\t}\n\n\thideForm()\n\t{\n\t\tclearTimeout(this.showFormTimeout);\n\n\t\tif (this.getWidgetModel().common.showForm !== FormType.none)\n\t\t{\n\t\t\tthis.store.commit('widget/common', {showForm: FormType.none});\n\t\t}\n\t}\n\n\tgetWidgetModel()\n\t{\n\t\treturn this.store.state.widget;\n\t}\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(WidgetEventType.showForm, this.showFormHandler);\n\t\tEventEmitter.unsubscribe(WidgetEventType.hideForm, this.hideFormHandler);\n\t\tEventEmitter.unsubscribe(WidgetEventType.sendDialogVote, this.sendVoteHandler);\n\t}\n}","import { ReactionHandler } from 'im.event-handler';\nimport { Logger } from 'im.lib.logger';\n\nexport class WidgetReactionHandler extends ReactionHandler\n{\n\tonOpenMessageReactionList({data})\n\t{\n\t\tLogger.warn('Reactions list is blocked for the widget', data);\n\t}\n}","export class WidgetHistoryHandler\n{\n\tstore: Object = null;\n\tapplication: Object = null;\n\n\tconstructor($Bitrix)\n\t{\n\t\tthis.store = $Bitrix.Data.get('controller').store;\n\t\tthis.application = $Bitrix.Application.get();\n\t}\n\n\tgetHtmlHistory()\n\t{\n\t\tconst chatId = this.getChatId();\n\t\tif (chatId <= 0)\n\t\t{\n\t\t\tconsole.error('WidgetHistoryHandler: Incorrect chatId value');\n\t\t}\n\n\t\tconst config = { chatId: this.getChatId() };\n\t\tthis.requestControllerAction('imopenlines.widget.history.download', config)\n\t\t\t.then(this.handleRequest.bind(this))\n\t\t\t.then(this.downloadHistory.bind(this))\n\t\t\t.catch((error) => console.error('WidgetHistoryHandler: fetch error.', error));\n\t}\n\n\trequestControllerAction(action, config)\n\t{\n\t\tconst host = this.application.host ? this.application.host : '';\n\t\tconst ajaxEndpoint = '/bitrix/services/main/ajax.php';\n\n\t\tconst url = new URL(ajaxEndpoint, host);\n\t\turl.searchParams.set('action', action);\n\n\t\tconst formData = new FormData();\n\t\tfor (const key in config)\n\t\t{\n\t\t\tif (config.hasOwnProperty(key))\n\t\t\t{\n\t\t\t\tformData.append(key, config[key]);\n\t\t\t}\n\t\t}\n\n\t\treturn fetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Livechat-Auth-Id': this.getUserHash()\n\t\t\t},\n\t\t\tbody: formData\n\t\t});\n\t}\n\n\thandleRequest(response)\n\t{\n\t\tconst contentType = response.headers.get('Content-Type');\n\t\tif (contentType.startsWith('application/json'))\n\t\t{\n\t\t\treturn response.json();\n\t\t}\n\n\t\treturn response.blob();\n\t}\n\n\tdownloadHistory(result)\n\t{\n\t\tif (result instanceof Blob)\n\t\t{\n\t\t\tconst url = window.URL.createObjectURL(result);\n\t\t\tconst a = document.createElement('a');\n\t\t\ta.href = url;\n\t\t\ta.download = `${this.getChatId()}.html`;\n\t\t\tdocument.body.append(a);\n\t\t\ta.click();\n\t\t\ta.remove();\n\t\t}\n\t\telse if (result.hasOwnProperty('errors'))\n\t\t{\n\t\t\tconsole.error(`WidgetHistoryHandler: ${result.errors[0]}`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error('WidgetHistoryHandler: unknown error.');\n\t\t}\n\t}\n\n\tgetChatId()\n\t{\n\t\treturn this.store.state.application.dialog.chatId;\n\t}\n\n\tgetUserHash()\n\t{\n\t\treturn this.store.state.widget.user.hash;\n\t}\n\n\tdestroy()\n\t{\n\t\t//\n\t}\n}","import { DialogActionHandler } from \"im.event-handler\";\nimport { EventEmitter } from \"main.core.events\";\nimport { WidgetEventType } from \"../const\";\n\nexport class WidgetDialogActionHandler extends DialogActionHandler\n{\n\tonClickOnDialog()\n\t{\n\t\tEventEmitter.emit(WidgetEventType.hideForm);\n\t}\n}","/**\n * Bitrix OpenLines widget\n * LiveChat base component (Vue component)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BitrixVue} from 'ui.vue';\nimport {Vuex} from 'ui.vue.vuex';\nimport {Utils} from 'im.lib.utils';\nimport {Logger} from 'im.lib.logger';\nimport {\n\tFormType,\n\tVoteType,\n\tLocationStyle,\n\tLocationType,\n\tLanguageType,\n\tWidgetEventType,\n\tWidgetBaseSize,\n\tWidgetMinimumSize\n} from '../const';\nimport {DeviceType, DeviceOrientation, EventType} from 'im.const';\nimport {EventEmitter} from 'main.core.events';\n\nimport {WidgetSendMessageHandler} from '../event-handler/widget-send-message-handler';\nimport {WidgetTextareaHandler} from '../event-handler/widget-textarea-handler';\nimport {WidgetTextareaUploadHandler} from '../event-handler/widget-textarea-upload-handler';\nimport {WidgetReadingHandler} from '../event-handler/widget-reading-handler';\nimport {WidgetResizeHandler} from '../event-handler/widget-resize-handler';\nimport {WidgetConsentHandler} from '../event-handler/widget-consent-handler';\nimport {WidgetFormHandler} from '../event-handler/widget-form-handler';\nimport {TextareaDragHandler} from 'im.event-handler';\nimport {WidgetReactionHandler} from '../event-handler/widget-reaction-handler';\nimport {WidgetHistoryHandler} from '../event-handler/widget-history-handler';\nimport {WidgetDialogActionHandler} from '../event-handler/widget-dialog-action-handler';\n\nBitrixVue.component('bx-livechat',\n{\n\tdata()\n\t{\n\t\treturn {\n\t\t\t// sizes\n\t\t\twidgetAvailableHeight: 0,\n\t\t\twidgetAvailableWidth: 0,\n\t\t\twidgetCurrentHeight: 0,\n\t\t\twidgetCurrentWidth: 0,\n\t\t\twidgetIsResizing: false,\n\t\t\ttextareaHeight: 100,\n\t\t\t// welcome form\n\t\t\twelcomeFormFilled: false,\n\t\t\t// multi dialog\n\t\t\tstartNewChatMode: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tFormType: () => FormType,\n\t\tVoteType: () => VoteType,\n\t\tDeviceType: () => DeviceType,\n\t\tEventType: () => EventType,\n\n\t\tshowTextarea()\n\t\t{\n\t\t\tif (this.widget.common.isCreateSessionMode)\n\t\t\t{\n\t\t\t\treturn this.startNewChatMode;\n\t\t\t}\n\n\t\t\tconst {crmFormsSettings} = this.widget.common;\n\n\t\t\t// show if we dont use welcome form\n\t\t\tif (!crmFormsSettings.useWelcomeForm || !crmFormsSettings.welcomeFormId)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// show if we use welcome form with delay, otherwise check if it was filled\n\t\t\t\treturn crmFormsSettings.welcomeFormDelay ? true : this.welcomeFormFilled;\n\t\t\t}\n\t\t},\n\t\t// for welcome CRM-form before dialog start\n\t\tshowWelcomeForm()\n\t\t{\n\t\t\t//we are using welcome form, it doesnt have delay and it was not already filled\n\t\t\treturn this.widget.common.crmFormsSettings.useWelcomeForm\n\t\t\t\t&& !this.widget.common.crmFormsSettings.welcomeFormDelay\n\t\t\t\t&& this.widget.common.crmFormsSettings.welcomeFormId\n\t\t\t\t&& !this.welcomeFormFilled;\n\t\t},\n\t\ttextareaHeightStyle()\n\t\t{\n\t\t\treturn {flex: `0 0 ${this.textareaHeight}px`};\n\t\t},\n\t\ttextareaBottomMargin()\n\t\t{\n\t\t\tif (!this.widget.common.copyright && !this.isBottomLocation())\n\t\t\t{\n\t\t\t\treturn {marginBottom: '5px'};\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\twidgetHeightStyle()\n\t\t{\n\t\t\tif (Utils.device.isMobile() || this.widget.common.pageMode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.widgetAvailableHeight < WidgetBaseSize.height || this.widgetAvailableHeight < this.widgetCurrentHeight)\n\t\t\t{\n\t\t\t\tthis.widgetCurrentHeight = Math.max(this.widgetAvailableHeight, WidgetMinimumSize.height);\n\t\t\t}\n\n\t\t\treturn `${this.widgetCurrentHeight}px`;\n\t\t},\n\t\twidgetWidthStyle()\n\t\t{\n\t\t\tif (Utils.device.isMobile() || this.widget.common.pageMode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.widgetAvailableWidth < WidgetBaseSize.width || this.widgetAvailableWidth < this.widgetCurrentWidth)\n\t\t\t{\n\t\t\t\tthis.widgetCurrentWidth = Math.max(this.widgetAvailableWidth, WidgetMinimumSize.width);\n\t\t\t}\n\n\t\t\treturn `${this.widgetCurrentWidth}px`;\n\t\t},\n\t\tuserSelectStyle()\n\t\t{\n\t\t\treturn this.widgetIsResizing ? 'none' : 'auto';\n\t\t},\n\t\twidgetMobileDisabled()\n\t\t{\n\t\t\tif (this.application.device.type !== DeviceType.mobile)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.application.device.orientation !== DeviceOrientation.horizontal)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (navigator.userAgent.toString().includes('iPhone'))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn (typeof window.screen !== 'object') || window.screen.availHeight < 800;\n\t\t\t}\n\t\t},\n\t\twidgetPositionClass()\n\t\t{\n\t\t\tconst className = [];\n\n\t\t\tif (this.widget.common.pageMode)\n\t\t\t{\n\t\t\t\tclassName.push('bx-livechat-page-mode');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tclassName.push(`bx-livechat-position-${LocationStyle[this.widget.common.location]}`);\n\t\t\t}\n\n\t\t\treturn className;\n\t\t},\n\t\twidgetLanguageClass()\n\t\t{\n\t\t\tconst className = [];\n\n\t\t\tif (this.application.common.languageId === LanguageType.russian)\n\t\t\t{\n\t\t\t\tclassName.push('bx-livechat-logo-ru');\n\t\t\t}\n\t\t\telse if (this.application.common.languageId === LanguageType.ukraine)\n\t\t\t{\n\t\t\t\tclassName.push('bx-livechat-logo-ua');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tclassName.push('bx-livechat-logo-en');\n\t\t\t}\n\n\t\t\treturn className;\n\t\t},\n\t\twidgetPlatformClass()\n\t\t{\n\t\t\tconst className = [];\n\n\t\t\tif (Utils.device.isMobile())\n\t\t\t{\n\t\t\t\tclassName.push('bx-livechat-mobile');\n\t\t\t}\n\t\t\telse if (Utils.browser.isSafari())\n\t\t\t{\n\t\t\t\tclassName.push('bx-livechat-browser-safari');\n\t\t\t}\n\t\t\telse if (Utils.browser.isIe())\n\t\t\t{\n\t\t\t\tclassName.push('bx-livechat-browser-ie');\n\t\t\t}\n\n\t\t\tif (Utils.platform.isMac())\n\t\t\t{\n\t\t\t\tclassName.push('bx-livechat-mac');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tclassName.push('bx-livechat-custom-scroll');\n\t\t\t}\n\n\t\t\treturn className;\n\t\t},\n\t\twidgetClassName()\n\t\t{\n\t\t\tconst className = [];\n\n\t\t\tclassName.push(...this.widgetPositionClass, ...this.widgetLanguageClass, ...this.widgetPlatformClass);\n\n\t\t\tif (!this.widget.common.online)\n\t\t\t{\n\t\t\t\tclassName.push('bx-livechat-offline-state');\n\t\t\t}\n\n\t\t\tif (this.widget.common.dragged)\n\t\t\t{\n\t\t\t\tclassName.push('bx-livechat-drag-n-drop');\n\t\t\t}\n\n\t\t\tif (this.widget.common.dialogStart)\n\t\t\t{\n\t\t\t\tclassName.push('bx-livechat-chat-start');\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.widget.dialog.operator.name\n\t\t\t\t&& !(this.application.device.type === DeviceType.mobile && this.application.device.orientation === DeviceOrientation.horizontal)\n\t\t\t)\n\t\t\t{\n\t\t\t\tclassName.push('bx-livechat-has-operator');\n\t\t\t}\n\n\t\t\tif (this.widget.common.styles.backgroundColor && Utils.isDarkColor(this.widget.common.styles.iconColor))\n\t\t\t{\n\t\t\t\tclassName.push('bx-livechat-bright-header');\n\t\t\t}\n\n\t\t\treturn className;\n\t\t},\n\t\tshowMessageDialog()\n\t\t{\n\t\t\treturn this.messageCollection.length > 0;\n\t\t},\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases('BX_LIVECHAT_', this);\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\twidget: state => state.widget,\n\t\t\tapplication: state => state.application,\n\t\t\tdialog: state => state.dialogues.collection[state.application.dialog.dialogId],\n\t\t\tmessageCollection: state => state.messages.collection[state.application.dialog.chatId]\n\t\t})\n\t},\n\tcreated()\n\t{\n\t\tLogger.warn('Livechat component created');\n\t\t// we need to wait for initialization and widget opening to init logic handlers\n\t\tthis.onCreated().then(() => {\n\t\t\tthis.subscribeToEvents();\n\t\t\tthis.initEventHandlers();\n\t\t});\n\t},\n\tmounted()\n\t{\n\t\tif (this.widget.user.id > 0)\n\t\t{\n\t\t\tthis.welcomeFormFilled = true;\n\t\t}\n\t\tthis.registerZIndex();\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.unsubscribeEvents();\n\t\tthis.destroyHandlers();\n\t\tthis.unregisterZIndex();\n\t},\n\tmethods:\n\t{\n\t\t// region initialization\n\t\tinitEventHandlers()\n\t\t{\n\t\t\tthis.sendMessageHandler = new WidgetSendMessageHandler(this.$Bitrix);\n\t\t\tthis.textareaHandler = new WidgetTextareaHandler(this.$Bitrix);\n\t\t\tthis.textareaUploadHandler = new WidgetTextareaUploadHandler(this.$Bitrix);\n\t\t\tthis.readingHandler = new WidgetReadingHandler(this.$Bitrix);\n\t\t\tthis.consentHandler = new WidgetConsentHandler(this.$Bitrix);\n\t\t\tthis.formHandler = new WidgetFormHandler(this.$Bitrix);\n\t\t\tthis.textareaDragHandler = this.getTextareaDragHandler();\n\t\t\tthis.resizeHandler = this.getWidgetResizeHandler();\n\t\t\tthis.reactionHandler = new WidgetReactionHandler(this.$Bitrix);\n\t\t\tthis.historyHandler = new WidgetHistoryHandler(this.$Bitrix);\n\t\t\tthis.dialogActionHandler = new WidgetDialogActionHandler(this.$Bitrix);\n\t\t},\n\t\tdestroyHandlers()\n\t\t{\n\t\t\tthis.sendMessageHandler.destroy();\n\t\t\tthis.textareaHandler.destroy();\n\t\t\tthis.textareaUploadHandler.destroy();\n\t\t\tthis.readingHandler.destroy();\n\t\t\tthis.consentHandler.destroy();\n\t\t\tthis.formHandler.destroy();\n\t\t\tthis.textareaDragHandler.destroy();\n\t\t\tthis.resizeHandler.destroy();\n\t\t\tthis.reactionHandler.destroy();\n\t\t\tthis.historyHandler.destroy();\n\t\t\tthis.dialogActionHandler.destroy();\n\t\t},\n\t\tsubscribeToEvents()\n\t\t{\n\t\t\tdocument.addEventListener('keydown', this.onWindowKeyDown);\n\n\t\t\tif (!Utils.device.isMobile() && !this.widget.common.pageMode)\n\t\t\t{\n\t\t\t\tthis.getAvailableSpaceFunc = Utils.throttle(this.getAvailableSpace, 50);\n\t\t\t\twindow.addEventListener('resize', this.getAvailableSpaceFunc);\n\t\t\t}\n\t\t},\n\t\tunsubscribeEvents()\n\t\t{\n\t\t\tdocument.removeEventListener('keydown', this.onWindowKeyDown);\n\n\t\t\tif (!Utils.device.isMobile() && !this.widget.common.pageMode)\n\t\t\t{\n\t\t\t\twindow.removeEventListener('resize', this.getAvailableSpaceFunc);\n\t\t\t}\n\t\t},\n\t\tinitMobileEnv(): Promise\n\t\t{\n\t\t\tconst metaTags = document.head.querySelectorAll('meta');\n\t\t\tconst viewPortMetaSiteNode = [...metaTags].find(element => element.name === 'viewport');\n\n\t\t\tif (viewPortMetaSiteNode)\n\t\t\t{\n\t\t\t\t// save tag and remove it from DOM\n\t\t\t\tthis.viewPortMetaSiteNode = viewPortMetaSiteNode;\n\t\t\t\tthis.viewPortMetaSiteNode.remove();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.createViewportMeta();\n\t\t\t}\n\n\t\t\tif (!this.viewPortMetaWidgetNode)\n\t\t\t{\n\t\t\t\tthis.viewPortMetaWidgetNode = document.createElement('meta');\n\t\t\t\tthis.viewPortMetaWidgetNode.setAttribute('name', 'viewport');\n\t\t\t\tthis.viewPortMetaWidgetNode.setAttribute('content', 'width=device-width, initial-scale=1.0, user-scalable=0');\n\t\t\t\tdocument.head.append(this.viewPortMetaWidgetNode);\n\t\t\t}\n\n\t\t\tdocument.body.classList.add('bx-livechat-mobile-state');\n\n\t\t\tif (Utils.browser.isSafariBased())\n\t\t\t{\n\t\t\t\tdocument.body.classList.add('bx-livechat-mobile-safari-based');\n\t\t\t}\n\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.$store.dispatch('widget/show').then(resolve);\n\t\t\t\t}, 50);\n\t\t\t});\n\t\t},\n\t\tcreateViewportMeta()\n\t\t{\n\t\t\tlet contentWidth = document.body.offsetWidth;\n\t\t\tif (contentWidth < window.innerWidth)\n\t\t\t{\n\t\t\t\tcontentWidth = window.innerWidth;\n\t\t\t}\n\t\t\tif (contentWidth < 1024)\n\t\t\t{\n\t\t\t\tcontentWidth = 1024;\n\t\t\t}\n\n\t\t\tthis.viewPortMetaSiteNode = document.createElement('meta');\n\t\t\tthis.viewPortMetaSiteNode.setAttribute('name', 'viewport');\n\t\t\tthis.viewPortMetaSiteNode.setAttribute('content', `width=${contentWidth}, initial-scale=1.0, user-scalable=1`);\n\t\t},\n\t\tremoveMobileEnv()\n\t\t{\n\t\t\tdocument.body.classList.remove('bx-livechat-mobile-state');\n\n\t\t\tif (Utils.browser.isSafariBased())\n\t\t\t{\n\t\t\t\tdocument.body.classList.remove('bx-livechat-mobile-safari-based');\n\t\t\t}\n\n\t\t\tif (this.viewPortMetaWidgetNode)\n\t\t\t{\n\t\t\t\tthis.viewPortMetaWidgetNode.remove();\n\t\t\t\tthis.viewPortMetaWidgetNode = null;\n\t\t\t}\n\n\t\t\tif (this.viewPortMetaSiteNode)\n\t\t\t{\n\t\t\t\tdocument.head.append(this.viewPortMetaSiteNode);\n\t\t\t\tthis.viewPortMetaSiteNode = null;\n\t\t\t}\n\t\t},\n\t\tonCreated(): Promise\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tif (Utils.device.isMobile())\n\t\t\t\t{\n\t\t\t\t\tthis.initMobileEnv().then(resolve);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.$store.dispatch('widget/show').then(() => {\n\t\t\t\t\t\tthis.widgetCurrentHeight = WidgetBaseSize.height;\n\t\t\t\t\t\tthis.widgetCurrentWidth = WidgetBaseSize.width;\n\t\t\t\t\t\tthis.getAvailableSpace();\n\n\t\t\t\t\t\t// restore widget size from cache\n\t\t\t\t\t\tthis.widgetCurrentHeight = this.widget.common.widgetHeight || this.widgetCurrentHeight;\n\t\t\t\t\t\tthis.widgetCurrentWidth = this.widget.common.widgetWidth || this.widgetCurrentWidth;\n\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// restore textarea size from cache\n\t\t\t\tthis.textareaHeight = this.widget.common.textareaHeight || this.textareaHeight;\n\t\t\t\tthis.initCollections();\n\t\t\t});\n\t\t},\n\t\tinitCollections()\n\t\t{\n\t\t\tthis.$store.commit('files/initCollection', { chatId: this.getApplication().getChatId() });\n\t\t\tthis.$store.commit('messages/initCollection', { chatId: this.getApplication().getChatId() });\n\t\t\tthis.$store.commit('dialogues/initCollection', {\n\t\t\t\tdialogId: this.getApplication().getDialogId(),\n\t\t\t\tfields: {\n\t\t\t\t\tentityType: 'LIVECHAT',\n\t\t\t\t\ttype: 'livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t// endregion initialization\n\t\t// region events\n\t\tonBeforeClose()\n\t\t{\n\t\t\tif (Utils.device.isMobile())\n\t\t\t{\n\t\t\t\tthis.removeMobileEnv();\n\t\t\t}\n\t\t},\n\t\tonAfterClose()\n\t\t{\n\t\t\tthis.getApplication().close();\n\t\t},\n\t\tonOpenMenu()\n\t\t{\n\t\t\tthis.historyHandler.getHtmlHistory();\n\t\t},\n\t\tonPullRequestConfig()\n\t\t{\n\t\t\tthis.getApplication().recoverPullConnection();\n\t\t},\n\t\tonSmilesSelectSmile(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.textarea.insertText, {text: event.text});\n\t\t},\n\t\tonSmilesSelectSet()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.textarea.setFocus);\n\t\t},\n\t\tonWidgetStartDrag(event)\n\t\t{\n\t\t\tthis.resizeHandler.startResize(event, this.widgetCurrentHeight, this.widgetCurrentWidth);\n\t\t\tthis.widgetIsResizing = true;\n\t\t\tEventEmitter.emit(EventType.textarea.setBlur, true);\n\t\t},\n\t\tonWindowKeyDown(event)\n\t\t{\n\t\t\t// not escape\n\t\t\tif (event.keyCode !== 27)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// hide form\n\t\t\tif (this.widget.common.showForm !== FormType.none)\n\t\t\t{\n\t\t\t\tthis.$store.commit('widget/common', {showForm: FormType.none});\n\t\t\t}\n\t\t\t// decline consent\n\t\t\telse if (this.widget.common.showConsent)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(WidgetEventType.declineConsent);\n\t\t\t}\n\t\t\t// close widget\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.close();\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tEventEmitter.emit(EventType.textarea.setFocus);\n\t\t},\n\t\tonWelcomeFormSendSuccess()\n\t\t{\n\t\t\tthis.welcomeFormFilled = true;\n\t\t},\n\t\tonWelcomeFormSendError(error)\n\t\t{\n\t\t\tconsole.error('onWelcomeFormSendError', error);\n\t\t\tthis.welcomeFormFilled = true;\n\t\t},\n\t\tonTextareaStartDrag(event)\n\t\t{\n\t\t\tthis.textareaDragHandler.onStartDrag(event, this.textareaHeight);\n\t\t\tEventEmitter.emit(EventType.textarea.setBlur, true);\n\t\t},\n\t\topenDialogList()\n\t\t{\n\t\t\tthis.$store.commit('widget/common', {isCreateSessionMode: !this.widget.common.isCreateSessionMode});\n\t\t\tthis.startNewChatMode = false;\n\t\t},\n\t\tonStartNewChat()\n\t\t{\n\t\t\tthis.startNewChatMode = true;\n\t\t},\n\t\t// endregion events\n\t\t// region helpers\n\t\tgetApplication()\n\t\t{\n\t\t\treturn this.$Bitrix.Application.get();\n\t\t},\n\t\tclose()\n\t\t{\n\t\t\tif (this.widget.common.pageMode)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.onBeforeClose();\n\t\t\tthis.$store.commit('widget/common', {showed: false});\n\t\t},\n\t\t// how much width and height we have for resizing\n\t\tgetAvailableSpace()\n\t\t{\n\t\t\tconst widgetMargin = 50;\n\t\t\tif (this.isBottomLocation())\n\t\t\t{\n\t\t\t\tconst bottomPosition = this.$refs.widgetWrapper.getBoundingClientRect().bottom;\n\t\t\t\tconst widgetBottomMargin = window.innerHeight - bottomPosition;\n\t\t\t\tthis.widgetAvailableHeight = window.innerHeight - widgetMargin - widgetBottomMargin;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst topPosition = this.$refs.widgetWrapper.getBoundingClientRect().top;\n\t\t\t\tthis.widgetAvailableHeight = window.innerHeight - widgetMargin - topPosition;\n\t\t\t}\n\n\t\t\tthis.widgetAvailableWidth = window.innerWidth - widgetMargin * 2;\n\n\t\t\tif (this.resizeHandler)\n\t\t\t{\n\t\t\t\tthis.resizeHandler.setAvailableWidth(this.widgetAvailableWidth);\n\t\t\t\tthis.resizeHandler.setAvailableHeight(this.widgetAvailableHeight);\n\t\t\t}\n\t\t},\n\t\tgetTextareaDragHandler(): TextareaDragHandler\n\t\t{\n\t\t\treturn new TextareaDragHandler({\n\t\t\t\t[TextareaDragHandler.events.onHeightChange]: ({data}) => {\n\t\t\t\t\tconst {newHeight} = data;\n\t\t\t\t\tif (this.textareaHeight !== newHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.textareaHeight = newHeight;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t[TextareaDragHandler.events.onStopDrag]: () => {\n\t\t\t\t\tthis.$store.commit('widget/common', {textareaHeight: this.textareaHeight});\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.chatId, force: true});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tgetWidgetResizeHandler(): WidgetResizeHandler\n\t\t{\n\t\t\treturn new WidgetResizeHandler({\n\t\t\t\twidgetLocation: this.widget.common.location,\n\t\t\t\tavailableWidth: this.widgetAvailableWidth,\n\t\t\t\tavailableHeight: this.widgetAvailableHeight,\n\t\t\t\tevents: {\n\t\t\t\t\t[WidgetResizeHandler.events.onSizeChange]: ({data}) => {\n\t\t\t\t\t\tconst {newHeight, newWidth} = data;\n\t\t\t\t\t\tif (this.widgetCurrentHeight !== newHeight)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.widgetCurrentHeight = newHeight;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (this.widgetCurrentWidth !== newWidth)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.widgetCurrentWidth = newWidth;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t[WidgetResizeHandler.events.onStopResize]: () => {\n\t\t\t\t\t\tthis.widgetIsResizing = false;\n\t\t\t\t\t\tthis.$store.commit('widget/common', {widgetHeight: this.widgetCurrentHeight, widgetWidth: this.widgetCurrentWidth});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tisBottomLocation()\n\t\t{\n\t\t\treturn [LocationType.bottomLeft, LocationType.bottomMiddle, LocationType.bottomRight].includes(this.widget.common.location);\n\t\t},\n\t\tisPageMode()\n\t\t{\n\t\t\treturn this.widget.common.pageMode;\n\t\t},\n\t\tregisterZIndex()\n\t\t{\n\t\t\tthis.zIndexStackInstance = this.$Bitrix.Data.get('zIndexStack');\n\t\t\tif (this.zIndexStackInstance && !!this.$refs.widgetWrapper)\n\t\t\t{\n\t\t\t\tthis.zIndexStackInstance.register(this.$refs.widgetWrapper);\n\t\t\t}\n\t\t},\n\t\tunregisterZIndex()\n\t\t{\n\t\t\tif (this.zIndexStackInstance)\n\t\t\t{\n\t\t\t\tthis.zIndexStackInstance.unregister(this.$refs.widgetWrapper);\n\t\t\t}\n\t\t}\n\t\t// endregion helpers\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<transition enter-active-class=\"bx-livechat-show\" leave-active-class=\"bx-livechat-close\" @after-leave=\"onAfterClose\">\n\t\t\t<div\n\t\t\t\t:class=\"widgetClassName\"\n\t\t\t\tv-if=\"widget.common.showed\"\n\t\t\t\t:style=\"{height: widgetHeightStyle, width: widgetWidthStyle, userSelect: userSelectStyle}\"\n\t\t\t\tclass=\"bx-livechat-wrapper bx-livechat-show\"\n\t\t\t\tref=\"widgetWrapper\"\n\t\t\t>\n\t\t\t\t<div class=\"bx-livechat-box\">\n\t\t\t\t\t<div v-if=\"isBottomLocation() && !isPageMode()\" class=\"bx-livechat-widget-resize-handle\" @mousedown=\"onWidgetStartDrag\"></div>\n\t\t\t\t\t<bx-livechat-head \n\t\t\t\t\t\t:isWidgetDisabled=\"widgetMobileDisabled\" \n\t\t\t\t\t\t@openMenu=\"onOpenMenu\" \n\t\t\t\t\t\t@close=\"close\"\n\t\t\t\t\t\t@openDialogList=\"openDialogList\"\n\t\t\t\t\t/>\n\t\t\t\t\t<template v-if=\"widgetMobileDisabled\">\n\t\t\t\t\t\t<bx-livechat-body-orientation-disabled/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"application.error.active\">\n\t\t\t\t\t\t<bx-livechat-body-error/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"!widget.common.configId\">\n\t\t\t\t\t\t<div class=\"bx-livechat-body\" key=\"loading-body\">\n\t\t\t\t\t\t\t<bx-livechat-body-loading/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<div v-show=\"!widget.common.dialogStart\" class=\"bx-livechat-body\" :class=\"{'bx-livechat-body-with-scroll': showWelcomeForm}\" key=\"welcome-body\">\n\t\t\t\t\t\t\t<bx-imopenlines-form\n\t\t\t\t\t\t\t  v-show=\"showWelcomeForm\"\n\t\t\t\t\t\t\t  @formSendSuccess=\"onWelcomeFormSendSuccess\"\n\t\t\t\t\t\t\t  @formSendError=\"onWelcomeFormSendError\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<template v-if=\"!showWelcomeForm\">\n\t\t\t\t\t\t\t\t<bx-livechat-body-operators/>\n\t\t\t\t\t\t\t\t<keep-alive include=\"bx-livechat-smiles\">\n\t\t\t\t\t\t\t\t\t<template v-if=\"widget.common.showForm === FormType.smile\">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-smiles @selectSmile=\"onSmilesSelectSmile\" @selectSet=\"onSmilesSelectSet\"/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</keep-alive>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<template v-if=\"widget.common.dialogStart\">\n\t\t\t\t\t\t\t<bx-pull-component-status :canReconnect=\"true\" @reconnect=\"onPullRequestConfig\"/>\n\t\t\t\t\t\t\t<div :class=\"['bx-livechat-body', {'bx-livechat-body-with-message': showMessageDialog}]\" key=\"with-message\">\n\t\t\t\t\t\t\t\t<template v-if=\"widget.common.isCreateSessionMode\">\n\t\t\t\t\t\t\t\t\t<bx-livechat-dialogues-list @startNewChat=\"onStartNewChat\"/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else-if=\"showMessageDialog\">\n\t\t\t\t\t\t\t\t\t<div class=\"bx-livechat-dialog\">\n\t\t\t\t\t\t\t\t\t\t<bx-im-component-dialog\n\t\t\t\t\t\t\t\t\t\t\t:userId=\"application.common.userId\"\n\t\t\t\t\t\t\t\t\t\t\t:dialogId=\"application.dialog.dialogId\"\n\t\t\t\t\t\t\t\t\t\t\t:messageLimit=\"application.dialog.messageLimit\"\n\t\t\t\t\t\t\t\t\t\t\t:enableReactions=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t:enableDateActions=\"false\"\n\t\t\t\t\t\t\t\t\t\t\t:enableCreateContent=\"false\"\n\t\t\t\t\t\t\t\t\t\t\t:enableGestureQuote=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t:enableGestureMenu=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t:showMessageAvatar=\"false\"\n\t\t\t\t\t\t\t\t\t\t\t:showMessageMenu=\"false\"\n\t\t\t\t\t\t\t\t\t\t\t:skipDataRequest=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t:showLoadingState=\"false\"\n\t\t\t\t\t\t\t\t\t\t\t:showEmptyState=\"false\"\n\t\t\t\t\t\t\t\t\t\t />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t<bx-livechat-body-loading/>\n\t\t\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\t\t<keep-alive include=\"bx-livechat-smiles\">\n\t\t\t\t\t\t\t\t\t<template v-if=\"widget.common.showForm === FormType.like && widget.common.vote.enable\">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-vote/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if=\"widget.common.showForm === FormType.welcome\">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-welcome/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if=\"widget.common.showForm === FormType.offline\">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-offline/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if=\"widget.common.showForm === FormType.history\">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-history/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if=\"widget.common.showForm === FormType.smile\">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-smiles @selectSmile=\"onSmilesSelectSmile\" @selectSet=\"onSmilesSelectSet\"/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</keep-alive>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<div v-if=\"showTextarea || startNewChatMode\" class=\"bx-livechat-textarea\" :style=\"[textareaHeightStyle, textareaBottomMargin]\" ref=\"textarea\">\n\t\t\t\t\t\t\t<div class=\"bx-livechat-textarea-resize-handle\" @mousedown=\"onTextareaStartDrag\" @touchstart=\"onTextareaStartDrag\"></div>\n\t\t\t\t\t\t\t<bx-im-component-textarea\n\t\t\t\t\t\t\t\t:siteId=\"application.common.siteId\"\n\t\t\t\t\t\t\t\t:userId=\"application.common.userId\"\n\t\t\t\t\t\t\t\t:dialogId=\"application.dialog.dialogId\"\n\t\t\t\t\t\t\t\t:writesEventLetter=\"3\"\n\t\t\t\t\t\t\t\t:enableEdit=\"true\"\n\t\t\t\t\t\t\t\t:enableCommand=\"false\"\n\t\t\t\t\t\t\t\t:enableMention=\"false\"\n\t\t\t\t\t\t\t\t:enableFile=\"application.disk.enabled\"\n\t\t\t\t\t\t\t\t:autoFocus=\"application.device.type !== DeviceType.mobile\"\n\t\t\t\t\t\t\t\t:styles=\"{button: {backgroundColor: widget.common.styles.backgroundColor, iconColor: widget.common.styles.iconColor}}\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if=\"!widget.common.copyright && !isBottomLocation\" class=\"bx-livechat-nocopyright-resize-wrap\" style=\"position: relative;\">\n\t\t\t\t\t\t\t<div class=\"bx-livechat-widget-resize-handle\" @mousedown=\"onWidgetStartDrag\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<bx-livechat-form-consent />\n\t\t\t\t\t\t<template v-if=\"widget.common.copyright\">\n\t\t\t\t\t\t\t<div class=\"bx-livechat-copyright\">\n\t\t\t\t\t\t\t\t<template v-if=\"widget.common.copyrightUrl\">\n\t\t\t\t\t\t\t\t\t<a class=\"bx-livechat-copyright-link\" :href=\"widget.common.copyrightUrl\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"bx-livechat-logo-name\">{{localize.BX_LIVECHAT_COPYRIGHT_TEXT}}</span>\n\t\t\t\t\t\t\t\t\t\t<span class=\"bx-livechat-logo-icon\"></span>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t<span class=\"bx-livechat-logo-name\">{{localize.BX_LIVECHAT_COPYRIGHT_TEXT}}</span>\n\t\t\t\t\t\t\t\t\t<span class=\"bx-livechat-logo-icon\"></span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<div v-if=\"!isBottomLocation() && !isPageMode()\" class=\"bx-livechat-widget-resize-handle\" @mousedown=\"onWidgetStartDrag\"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t`\n});\n","/**\n * Bitrix OpenLines widget\n * Body error component (Vue component)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BitrixVue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\n\nBitrixVue.component('bx-livechat-body-error',\n{\n\tcomputed:\n\t{\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application\n\t\t}),\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-livechat-body\" key=\"error-body\">\n\t\t\t<div class=\"bx-livechat-warning-window\">\n\t\t\t\t<div class=\"bx-livechat-warning-icon\"></div>\n\t\t\t\t<template v-if=\"application.error.description\"> \n\t\t\t\t\t<div class=\"bx-livechat-help-title bx-livechat-help-title-sm bx-livechat-warning-msg\" v-html=\"application.error.description\"></div>\n\t\t\t\t</template> \n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class=\"bx-livechat-help-title bx-livechat-help-title-md bx-livechat-warning-msg\">{{$Bitrix.Loc.getMessage('BX_LIVECHAT_ERROR_TITLE')}}</div>\n\t\t\t\t\t<div class=\"bx-livechat-help-title bx-livechat-help-title-sm bx-livechat-warning-msg\">{{$Bitrix.Loc.getMessage('BX_LIVECHAT_ERROR_DESC')}}</div>\n\t\t\t\t</template> \n\t\t\t</div>\n\t\t</div>\n\t`\n});\n","/**\n * Bitrix OpenLines widget\n * Head component (Vue component)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BitrixVue} from 'ui.vue';\nimport {Vuex} from 'ui.vue.vuex';\nimport {WidgetEventType, FormType, SessionStatus, VoteType} from '../const';\nimport {EventType} from 'im.const';\nimport {Browser} from 'main.core.minimal';\nimport {EventEmitter} from 'main.core.events';\n\nBitrixVue.component('bx-livechat-head',\n{\n\t/**\n\t * @emits 'close'\n\t * @emits 'like'\n\t * @emits 'history'\n\t */\n\tprops:\n\t{\n\t\tisWidgetDisabled: { default: false },\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tmultiDialog: false // disabled because of beta status\n\t\t};\n\t},\n\tmethods:\n\t{\n\t\topenDialogList()\n\t\t{\n\t\t\tEventEmitter.emit(WidgetEventType.hideForm);\n\t\t\tthis.$emit('openDialogList');\n\t\t},\n\t\tclose(event)\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tlike()\n\t\t{\n\t\t\tEventEmitter.emit(WidgetEventType.showForm, {\n\t\t\t\ttype: FormType.like\n\t\t\t});\n\t\t},\n\t\topenMenu(event)\n\t\t{\n\t\t\tthis.$emit('openMenu', event);\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tVoteType: () => VoteType,\n\n\t\tchatId()\n\t\t{\n\t\t\tif (this.application)\n\t\t\t{\n\t\t\t\treturn this.application.dialog.chatId;\n\t\t\t}\n\t\t},\n\n\t\tcustomBackgroundStyle(state)\n\t\t{\n\t\t\treturn state.widget.common.styles.backgroundColor? 'background-color: '+state.widget.common.styles.backgroundColor+'!important;': '';\n\t\t},\n\t\tcustomBackgroundOnlineStyle(state)\n\t\t{\n\t\t\treturn state.widget.common.styles.backgroundColor? 'border-color: '+state.widget.common.styles.backgroundColor+'!important;': '';\n\t\t},\n\t\tshowName(state)\n\t\t{\n\t\t\treturn state.widget.dialog.operator.firstName || state.widget.dialog.operator.lastName;\n\t\t},\n\t\tvoteActive(state)\n\t\t{\n\t\t\tif (!!state.widget.dialog.closeVote)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!state.widget.common.vote.beforeFinish\n\t\t\t\t&& state.widget.dialog.sessionStatus < SessionStatus.waitClient\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!state.widget.dialog.sessionClose || state.widget.dialog.sessionClose && state.widget.dialog.userVote === VoteType.none)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (state.widget.dialog.sessionClose && state.widget.dialog.userVote !== VoteType.none)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tchatTitle(state)\n\t\t{\n\t\t\treturn state.widget.common.textMessages.bxLivechatTitle\n\t\t\t\t|| state.widget.common.configName\n\t\t\t\t|| this.localize.BX_LIVECHAT_TITLE\n\t\t},\n\t\toperatorName(state)\n\t\t{\n\t\t\tif (!this.showName)\n\t\t\t\treturn '';\n\n\t\t\treturn state.widget.dialog.operator.firstName? state.widget.dialog.operator.firstName: state.widget.dialog.operator.name\n\t\t},\n\t\toperatorDescription(state)\n\t\t{\n\t\t\tif (!this.showName)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tconst operatorPosition = state.widget.dialog.operator.workPosition? state.widget.dialog.operator.workPosition: this.localize.BX_LIVECHAT_USER;\n\n\t\t\tif (state.widget.common.showSessionId && state.widget.dialog.sessionId >= 0)\n\t\t\t{\n\t\t\t\treturn this.localize.BX_LIVECHAT_OPERATOR_POSITION_AND_SESSION_ID\n\t\t\t\t\t.replace(\"#POSITION#\", operatorPosition)\n\t\t\t\t\t.replace(\"#ID#\", state.widget.dialog.sessionId);\n\t\t\t}\n\n\t\t\treturn this.localize.BX_LIVECHAT_OPERATOR_POSITION_ONLY.replace(\"#POSITION#\", operatorPosition);\n\t\t},\n\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases('BX_LIVECHAT_', this);\n\t\t},\n\n\t\tie11()\n\t\t{\n\t\t\treturn Browser.isIE11();\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\twidget: state => state.widget,\n\t\t\tapplication: state => state.application,\n\t\t})\n\t},\n\twatch:\n\t{\n\t\tshowName(value)\n\t\t{\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.$root.$emit(EventType.dialog.scrollToBottom, {chatId: this.chatId});\n\t\t\t\t}, 300);\n\t\t\t}\n\t\t},\n\t},\n\t//language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-livechat-head-wrap\">\n\t\t\t<template v-if=\"isWidgetDisabled\">\n\t\t\t\t<div class=\"bx-livechat-head\" :style=\"customBackgroundStyle\">\n\t\t\t\t\t<div class=\"bx-livechat-title\">{{chatTitle}}</div>\n\t\t\t\t\t<div class=\"bx-livechat-control-box\">\n\t\t\t\t\t\t<button v-if=\"!widget.common.pageMode\" class=\"bx-livechat-control-btn bx-livechat-control-btn-close\" :title=\"localize.BX_LIVECHAT_CLOSE_BUTTON\" @click=\"close\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\t\n\t\t\t</template>\n\t\t\t<template v-else-if=\"application.error.active\">\n\t\t\t\t<div class=\"bx-livechat-head\" :style=\"customBackgroundStyle\">\n\t\t\t\t\t<div class=\"bx-livechat-title\">{{chatTitle}}</div>\n\t\t\t\t\t<div class=\"bx-livechat-control-box\">\n\t\t\t\t\t\t<button v-if=\"!widget.common.pageMode\" class=\"bx-livechat-control-btn bx-livechat-control-btn-close\" :title=\"localize.BX_LIVECHAT_CLOSE_BUTTON\" @click=\"close\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else-if=\"!widget.common.configId\">\n\t\t\t\t<div class=\"bx-livechat-head\" :style=\"customBackgroundStyle\">\n\t\t\t\t\t<div class=\"bx-livechat-title\">{{chatTitle}}</div>\n\t\t\t\t\t<div class=\"bx-livechat-control-box\">\n\t\t\t\t\t\t<button v-if=\"!widget.common.pageMode\" class=\"bx-livechat-control-btn bx-livechat-control-btn-close\" :title=\"localize.BX_LIVECHAT_CLOSE_BUTTON\" @click=\"close\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\t\t\t\n\t\t\t<template v-else>\n\t\t\t\t<div class=\"bx-livechat-head\" :style=\"customBackgroundStyle\">\n\t\t\t\t\t<template v-if=\"!showName\">\n\t\t\t\t\t\t<div class=\"bx-livechat-title\">{{chatTitle}}</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<div class=\"bx-livechat-user bx-livechat-status-online\">\n\t\t\t\t\t\t\t<template v-if=\"widget.dialog.operator.avatar\">\n\t\t\t\t\t\t\t\t<div class=\"bx-livechat-user-icon\" :style=\"'background-image: url('+encodeURI(widget.dialog.operator.avatar)+')'\">\n\t\t\t\t\t\t\t\t\t<div v-if=\"widget.dialog.operator.online\" class=\"bx-livechat-user-status\" :style=\"customBackgroundOnlineStyle\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class=\"bx-livechat-user-icon\">\n\t\t\t\t\t\t\t\t\t<div v-if=\"widget.dialog.operator.online\" class=\"bx-livechat-user-status\" :style=\"customBackgroundOnlineStyle\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"bx-livechat-user-info\">\n\t\t\t\t\t\t\t<div class=\"bx-livechat-user-name\">{{operatorName}}</div>\n\t\t\t\t\t\t\t<div class=\"bx-livechat-user-position\">{{operatorDescription}}</div>\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<div class=\"bx-livechat-control-box\">\n\t\t\t\t\t\t<span class=\"bx-livechat-control-box-active\" v-if=\"widget.common.dialogStart && widget.dialog.sessionId\">\n\t\t\t\t\t\t\t<button v-if=\"widget.common.vote.enable && voteActive\" :class=\"'bx-livechat-control-btn bx-livechat-control-btn-like bx-livechat-dialog-vote-'+(widget.dialog.userVote)\" :title=\"localize.BX_LIVECHAT_VOTE_BUTTON\" @click=\"like\"></button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tv-if=\"!ie11 && application.dialog.chatId > 0\"\n\t\t\t\t\t\t\t\tclass=\"bx-livechat-control-btn bx-livechat-control-btn-menu\"\n\t\t\t\t\t\t\t\t@click=\"openMenu\"\n\t\t\t\t\t\t\t\t:title=\"localize.BX_LIVECHAT_DOWNLOAD_HISTORY\"\n\t\t\t\t\t\t\t></button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tv-if=\"multiDialog && application.dialog.chatId > 0\"\n\t\t\t\t\t\t\t\tclass=\"bx-livechat-control-btn bx-livechat-control-btn-list\"\n\t\t\t\t\t\t\t\t@click=\"openDialogList\"\n\t\t\t\t\t\t\t></button>\n\t\t\t\t\t\t</span>\t\n\t\t\t\t\t\t<button v-if=\"!widget.common.pageMode\" class=\"bx-livechat-control-btn bx-livechat-control-btn-close\" :title=\"localize.BX_LIVECHAT_CLOSE_BUTTON\" @click=\"close\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`\n});","/**\n * Bitrix OpenLines widget\n * Body loading component (Vue component)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BitrixVue} from \"ui.vue\";\n\nBitrixVue.component('bx-livechat-body-loading',\n{\n\ttemplate: `\n\t\t<div class=\"bx-livechat-loading-window\">\n\t\t\t<svg class=\"bx-livechat-loading-circular\" viewBox=\"25 25 50 50\">\n\t\t\t\t<circle class=\"bx-livechat-loading-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t\t<circle class=\"bx-livechat-loading-inner-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t</svg>\n\t\t\t<h3 class=\"bx-livechat-help-title bx-livechat-help-title-md bx-livechat-loading-msg\">{{$Bitrix.Loc.getMessage('BX_LIVECHAT_LOADING')}}</h3>\n\t\t</div>\n\t`\n});","/**\n * Bitrix OpenLines widget\n * Body operators component (Vue component)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BitrixVue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\n\nBitrixVue.component('bx-livechat-body-operators',\n{\n\tcomputed:\n\t{\n\t\t...Vuex.mapState({\n\t\t\twidget: state => state.widget\n\t\t})\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-livechat-help-container\">\n\t\t\t<transition name=\"bx-livechat-animation-fade\">\n\t\t\t\t<h2 v-if=\"widget.common.online\" key=\"online\" class=\"bx-livechat-help-title bx-livechat-help-title-lg\">{{widget.common.textMessages.bxLivechatOnlineLine1}}<div class=\"bx-livechat-help-subtitle\">{{widget.common.textMessages.bxLivechatOnlineLine2}}</div></h2>\n\t\t\t\t<h2 v-else key=\"offline\" class=\"bx-livechat-help-title bx-livechat-help-title-sm\">{{widget.common.textMessages.bxLivechatOffline}}</h2>\n\t\t\t</transition>\t\n\t\t\t<div class=\"bx-livechat-help-user\">\n\t\t\t\t<template v-for=\"operator in widget.common.operators\">\n\t\t\t\t\t<div class=\"bx-livechat-user\" :key=\"operator.id\">\n\t\t\t\t\t\t<template v-if=\"operator.avatar\">\n\t\t\t\t\t\t\t<div class=\"bx-livechat-user-icon\" :style=\"'background-image: url('+encodeURI(operator.avatar)+')'\"></div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class=\"bx-livechat-user-icon\"></div>\n\t\t\t\t\t\t</template>\t\n\t\t\t\t\t\t<div class=\"bx-livechat-user-info\">\n\t\t\t\t\t\t\t<div class=\"bx-livechat-user-name\">{{operator.firstName? operator.firstName: operator.name}}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\t\n\t\t\t</div>\n\t\t</div>\n\t`\n});","import {BitrixVue} from 'ui.vue';\nimport {Vuex} from 'ui.vue.vuex';\nimport {RestMethod, WidgetEventType} from '../const';\nimport {EventEmitter} from 'main.core.events';\n\nBitrixVue.component('bx-livechat-dialogues-list',\n{\n\tdata()\n\t{\n\t\treturn {\n\t\t\tnewChatMode: false,\n\t\t\tsessionList: [],\n\t\t\tisLoading: false,\n\t\t\tpagesLoaded: 0,\n\t\t\thasMoreItemsToLoad: true,\n\t\t\titemsPerPage: 25\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\t...Vuex.mapState({\n\t\t\tdialogues: state => state.dialogues\n\t\t})\n\t},\n\tmounted()\n\t{\n\t\tthis.requestDialogList();\n\t},\n\tmethods:\n\t{\n\t\trequestDialogList(offset = 0)\n\t\t{\n\t\t\tthis.isLoading = true;\n\n\t\t\tconst requestParams = {'CONFIG_ID': this.$Bitrix.Application.get().getConfigId()};\n\t\t\tif (offset > 0)\n\t\t\t{\n\t\t\t\trequestParams['OFFSET'] = offset;\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Application.get().controller.restClient.callMethod(\n\t\t\t\tRestMethod.widgetDialogList,\n\t\t\t\trequestParams\n\t\t\t).then(result => {\n\t\t\t\tif (result.data().length === 0 || result.data().length < this.itemsPerPage)\n\t\t\t\t{\n\t\t\t\t\tthis.hasMoreItemsToLoad = false;\n\t\t\t\t}\n\t\t\t\tthis.pagesLoaded++;\n\t\t\t\tthis.isLoading = false;\n\t\t\t\tthis.sessionList = [...this.sessionList, ...this.prepareSessionList(result.data())];\n\t\t\t}).catch(error => {\n\t\t\t\tconsole.warn('error', error);\n\t\t\t});\n\t\t},\n\t\tprepareSessionList(sessionList)\n\t\t{\n\t\t\treturn Object.values(sessionList).map(dialog => {\n\t\t\t\treturn {\n\t\t\t\t\tchatId: dialog.chatId,\n\t\t\t\t\tdialogId: dialog.dialogId,\n\t\t\t\t\tname: `Dialog #${dialog.sessionId}`\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\n\t\topenSession(event)\n\t\t{\n\t\t\tEventEmitter.emit(WidgetEventType.openSession, event);\n\t\t},\n\n\t\tstartNewChat(event)\n\t\t{\n\t\t\tthis.newChatMode = true;\n\t\t\tthis.$emit('startNewChat', event);\n\t\t},\n\n\t\tisOneScreenRemaining(event)\n\t\t{\n\t\t\treturn event.target.scrollTop + event.target.clientHeight >= event.target.scrollHeight - event.target.clientHeight;\n\t\t},\n\n\t\tonScroll(event)\n\t\t{\n\t\t\tif (this.isOneScreenRemaining(event))\n\t\t\t{\n\t\t\t\tif (this.isLoading || !this.hasMoreItemsToLoad)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst offset = this.itemsPerPage * this.pagesLoaded;\n\t\t\t\tthis.requestDialogList(offset);\n\t\t\t}\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t<div class=\"bx-livechat-help-container\" style=\" height: 100%; display: flex; flex-direction: column; justify-content: space-between;\">\n\t\t<div \n\t\t\tstyle=\"margin-top: 25px;overflow-y: scroll;position:relative\"\n\t\t\t:style=\"{marginBottom: newChatMode ? 0 : '10px'}\"\n\t\t\t@scroll=\"onScroll\"\n\t\t>\n\t\t\t<div\n\t\t\t\tv-for=\"session in sessionList\"\n\t\t\t\t:key=\"session.chatId\"\n\t\t\t\tclass=\"bx-livechat-help-subtitle\"\n\t\t\t\t@click=\"openSession({event: $event, session: session})\"\n\t\t\t\tstyle=\"cursor: pointer; border: solid 1px black;border-radius: 10px;margin: 10px;padding: 5px;background-color: #0ae4ff\">\n\t\t\t\t{{ session.name }}\n\t\t\t</div>\n\t\t\t<div v-if=\"isLoading\" style=\"margin: 10px\">Loading</div>\n\t\t</div>\n\t\t\n\t\t<div v-if=\"!newChatMode\" style=\"margin-bottom: 10px;\">\n\t\t\t<button \n\t\t\t\tclass=\"bx-livechat-btn\" \n\t\t\t\tstyle=\"background-color: rgb(23, 163, 234); border-radius: 5px;width: 150px;\" \n\t\t\t\t@click=\"startNewChat\">\n\t\t\t\tStart new chat!\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\t`\n\t}\n);","/**\n * Bitrix OpenLines widget\n * Body orientation disabled component (Vue component)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BitrixVue} from \"ui.vue\";\n\nBitrixVue.component('bx-livechat-body-orientation-disabled',\n{\n\ttemplate: `\n\t\t<div class=\"bx-livechat-body\" key=\"orientation-head\">\n\t\t\t<div class=\"bx-livechat-mobile-orientation-box\">\n\t\t\t\t<div class=\"bx-livechat-mobile-orientation-icon\"></div>\n\t\t\t\t<div class=\"bx-livechat-mobile-orientation-text\">{{$Bitrix.Loc.getMessage('BX_LIVECHAT_MOBILE_ROTATE')}}</div>\n\t\t\t</div>\n\t\t</div>\n\t`\n});","/**\n * Bitrix OpenLines widget\n * Form consent component (Vue component)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BitrixVue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\nimport { EventEmitter } from \"main.core.events\";\nimport { WidgetEventType } from \"../const\";\n\nBitrixVue.component('bx-livechat-form-consent',\n{\n\tcomputed:\n\t{\n\t\t...Vuex.mapState({\n\t\t\twidget: state => state.widget,\n\t\t})\n\t},\n\tmethods:\n\t{\n\t\tagree()\n\t\t{\n\t\t\tEventEmitter.emit(WidgetEventType.acceptConsent);\n\t\t},\n\t\tdisagree()\n\t\t{\n\t\t\tEventEmitter.emit(WidgetEventType.declineConsent);\n\t\t},\n\t\tonShow(element, done)\n\t\t{\n\t\t\telement.classList.add('bx-livechat-consent-window-show');\n\t\t\tdone();\n\t\t},\n\t\tonHide(element, done)\n\t\t{\n\t\t\telement.classList.remove('bx-livechat-consent-window-show');\n\t\t\telement.classList.add('bx-livechat-consent-window-close');\n\t\t\tsetTimeout(function() {\n\t\t\t\tdone();\n\t\t\t}, 400);\n\t\t},\n\t\tonKeyDown(event)\n\t\t{\n\t\t\tif (event.keyCode == 9)\n\t\t\t{\n\t\t\t\tif (event.target === this.$refs.iframe)\n\t\t\t\t{\n\t\t\t\t\tif (event.shiftKey)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$refs.cancel.focus();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$refs.success.focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (event.target === this.$refs.success)\n\t\t\t\t{\n\t\t\t\t\tif (event.shiftKey)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$refs.iframe.focus();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$refs.cancel.focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (event.target === this.$refs.cancel)\n\t\t\t\t{\n\t\t\t\t\tif (event.shiftKey)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$refs.success.focus();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$refs.iframe.focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t\telse if (event.keyCode == 39 || event.keyCode == 37)\n\t\t\t{\n\t\t\t\tif (event.target.nextElementSibling)\n\t\t\t\t{\n\t\t\t\t\tevent.target.nextElementSibling.focus();\n\t\t\t\t}\n\t\t\t\telse if (event.target.previousElementSibling)\n\t\t\t\t{\n\t\t\t\t\tevent.target.previousElementSibling.focus();\n\t\t\t\t}\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t},\n\t},\n\tdirectives:\n\t{\n\t\tfocus:\n\t\t{\n\t\t\tinserted(element, params)\n\t\t\t{\n\t\t\t\telement.focus();\n\t\t\t}\n\t\t}\n\t},\n\ttemplate: `\n\t\t<transition @enter=\"onShow\" @leave=\"onHide\">\n\t\t\t<template v-if=\"widget.common.showConsent && widget.common.consentUrl\">\n\t\t\t\t<div class=\"bx-livechat-consent-window\">\n\t\t\t\t\t<div class=\"bx-livechat-consent-window-title\">{{$Bitrix.Loc.getMessage('BX_LIVECHAT_CONSENT_TITLE')}}</div>\n\t\t\t\t\t<div class=\"bx-livechat-consent-window-content\">\n\t\t\t\t\t\t<iframe class=\"bx-livechat-consent-window-content-iframe\" ref=\"iframe\" frameborder=\"0\" marginheight=\"0\"  marginwidth=\"0\" allowtransparency=\"allow-same-origin\" seamless=\"true\" :src=\"widget.common.consentUrl\" @keydown=\"onKeyDown\"></iframe>\n\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\n\t\t\t\t\t<div class=\"bx-livechat-consent-window-btn-box\">\n\t\t\t\t\t\t<button class=\"bx-livechat-btn bx-livechat-btn-success\" ref=\"success\" @click=\"agree\" @keydown=\"onKeyDown\" v-focus>{{$Bitrix.Loc.getMessage('BX_LIVECHAT_CONSENT_AGREE')}}</button>\n\t\t\t\t\t\t<button class=\"bx-livechat-btn bx-livechat-btn-cancel\" ref=\"cancel\" @click=\"disagree\" @keydown=\"onKeyDown\">{{$Bitrix.Loc.getMessage('BX_LIVECHAT_CONSENT_DISAGREE')}}</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</transition>\n\t`\n});","/**\n * Bitrix OpenLines widget\n * Form vote component (Vue component)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BitrixVue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\nimport { VoteType, WidgetEventType } from \"../const\";\nimport { EventEmitter } from \"main.core.events\";\n\nBitrixVue.component('bx-livechat-form-vote',\n{\n\tcomputed:\n\t{\n\t\tVoteType: () => VoteType,\n\n\t\t...Vuex.mapState({\n\t\t\twidget: state => state.widget,\n\t\t})\n\t},\n\tmethods: {\n\t\tuserVote(vote)\n\t\t{\n\t\t\tEventEmitter.emit(WidgetEventType.hideForm);\n\t\t\tthis.$store.commit('widget/dialog', {userVote: vote});\n\n\t\t\tEventEmitter.emit(WidgetEventType.sendDialogVote, {vote});\n\t\t},\n\t\thideForm()\n\t\t{\n\t\t\tEventEmitter.emit(WidgetEventType.hideForm);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<transition enter-active-class=\"bx-livechat-consent-window-show\" leave-active-class=\"bx-livechat-form-close\">\n\t\t\t<div class=\"bx-livechat-alert-box bx-livechat-form-rate-show\" key=\"vote\">\n\t\t\t\t<div class=\"bx-livechat-alert-close\" @click=\"hideForm\"></div>\n\t\t\t\t<div class=\"bx-livechat-alert-rate-box\">\n\t\t\t\t\t<h4 class=\"bx-livechat-alert-title bx-livechat-alert-title-mdl\">{{widget.common.vote.messageText}}</h4>\n\t\t\t\t\t<div class=\"bx-livechat-btn-box\">\n\t\t\t\t\t\t<button class=\"bx-livechat-btn bx-livechat-btn-like\" @click=\"userVote(VoteType.like)\" :title=\"widget.common.vote.messageLike\"></button>\n\t\t\t\t\t\t<button class=\"bx-livechat-btn bx-livechat-btn-dislike\" @click=\"userVote(VoteType.dislike)\" :title=\"widget.common.vote.messageDislike\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\t\n\t`\n});","/**\n * Bitrix OpenLines widget\n * Smiles component (Vue component)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {Vue} from \"ui.vue\";\nimport { EventEmitter } from \"main.core.events\";\nimport { WidgetEventType } from \"../const\";\n\nVue.cloneComponent('bx-livechat-smiles', 'bx-smiles',\n{\n\tmethods:\n\t{\n\t\thideForm()\n\t\t{\n\t\t\tEventEmitter.emit(WidgetEventType.hideForm);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<transition enter-active-class=\"bx-livechat-consent-window-show\" leave-active-class=\"bx-livechat-form-close\">\n\t\t\t<div class=\"bx-livechat-alert-box bx-livechat-alert-box-zero-padding bx-livechat-form-show\" key=\"vote\">\n\t\t\t\t<div class=\"bx-livechat-alert-close\" @click=\"hideForm\"></div>\n\t\t\t\t<div class=\"bx-livechat-alert-smiles-box\">\n\t\t\t\t\t#PARENT_TEMPLATE#\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t`\n});","/**\n * Bitrix OpenLines widget\n * Widget component & controller\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\n// core\nimport 'main.polyfill.customevent';\n\n// vue components\nimport 'pull.component.status';\nimport 'ui.vue.components.smiles';\nimport 'im.component.dialog';\nimport 'im.component.textarea';\nimport 'im.view.quotepanel';\nimport 'imopenlines.component.message';\nimport 'imopenlines.component.form';\n\n// widget files\nimport \"./widget.css\";\nimport {VoteType, LocationStyle, SubscriptionType} from \"./const\";\n\n// widget utils\nimport {Cookie} from \"im.lib.cookie\";\nimport {WidgetPublicManager} from \"./public\";\n\n// widget components\nimport \"./component/bx-livechat\";\nimport \"./component/bx-livechat-body-error\";\nimport \"./component/bx-livechat-body-head\";\nimport \"./component/bx-livechat-body-loading\";\nimport \"./component/bx-livechat-body-operators\";\nimport \"./component/bx-livechat-dialogues-list\";\nimport \"./component/bx-livechat-body-orientation-disabled\";\nimport \"./component/bx-livechat-form-consent\";\nimport \"./component/bx-livechat-form-vote\";\nimport \"./component/bx-livechat-smiles\";\n\n\nBX.LiveChatWidget = WidgetPublicManager;\nBX.LiveChatWidget.VoteType = VoteType;\nBX.LiveChatWidget.SubscriptionType = SubscriptionType;\nBX.LiveChatWidget.LocationStyle = LocationStyle;\nBX.LiveChatWidget.Cookie = Cookie;\n\nwindow.dispatchEvent(new CustomEvent('onBitrixLiveChatSourceLoaded', {detail: {}}));\n"],"names":["GetObjectValues","source","destination","value","hasOwnProperty","push","VoteType","Object","freeze","none","like","dislike","LanguageType","russian","ukraine","world","FormType","smile","consent","welcome","offline","history","LocationType","topLeft","topMiddle","topBottom","bottomLeft","bottomMiddle","bottomRight","LocationStyle","WidgetBaseSize","width","height","WidgetMinimumSize","SubscriptionType","configLoaded","widgetOpen","widgetClose","sessionStart","sessionOperatorChange","sessionFinish","operatorMessage","userForm","userMessage","userFile","userVote","every","SubscriptionTypeCheck","RestMethod","widgetUserRegister","widgetChatCreate","widgetConfigGet","widgetDialogGet","widgetDialogList","widgetUserGet","widgetUserConsentApply","widgetVoteSend","widgetActionSend","pullServerTime","pullConfigGet","RestMethodCheck","RestAuth","guest","SessionStatus","skip","answer","client","clientAfterOperator","operator","waitClient","close","spam","duplicate","silentlyClose","WidgetEventType","showForm","hideForm","processMessagesToSendQueue","requestData","showConsent","acceptConsent","consentAccepted","declineConsent","consentDeclined","sendDialogVote","createSession","openSession","WidgetModel","common","configId","configName","host","getVariable","location","protocol","pageMode","copyright","copyrightUrl","styles","backgroundColor","iconColor","vote","enable","beforeFinish","messageText","messageLike","messageDislike","textMessages","bxLivechatOnlineLine1","bxLivechatOnlineLine2","bxLivechatOffline","bxLivechatTitle","online","operators","connectors","showed","reopen","dragged","textareaHeight","widgetHeight","widgetWidth","consentUrl","dialogStart","watchTyping","showSessionId","isCreateSessionMode","crmFormsSettings","useWelcomeForm","welcomeFormId","welcomeFormSec","welcomeFormDelay","welcomeFormFilled","successText","errorText","dialog","sessionId","sessionClose","sessionStatus","closeVote","userConsent","operatorChatId","id","name","firstName","lastName","workPosition","avatar","user","hash","email","phone","www","gender","position","state","payload","Utils","types","isPlainObject","device","isMobile","Array","isSaveNeeded","saveState","toString","startsWith","Cookie","set","expires","path","show","commit","setVoteDateFinish","dispatch","clearTimeout","setVoteDateTimeout","totalDelay","Date","getTime","dayTimestamp","delay","setTimeout","requestCloseVote","VuexBuilderModel","WidgetRestClient","params","queryAuthRestore","setAuthId","restClient","RestClient","endpoint","queryParams","cors","authId","customAuthId","match","livechat_auth_id","console","error","livechat_custom_auth_id","method","callback","sendCallback","logTag","getLogTrackingParams","promise","BX","Promise","callMethod","then","result","fulfill","ex","warn","error_description","reject","calls","bHaltOnError","resultCallback","callBatch","WidgetRestAnswerHandler","props","widget","data","store","disk","addLocalize","serverVariables","LocalStorage","getSiteId","previousData","messages","collection","controller","application","getChatId","chatId","dialogId","fields","entityType","type","userId","diskFolderId","dateCloseVote","handleImDialogMessagesGetSuccess","length","isDialogStart","messageId","message","sendEvent","text","BaseRestHandler","WidgetImPullCommandHandler","extra","command","senderId","getUserId","onceShowed","open","WidgetImopenlinesPullCommandHandler","Widget","checkSameDomain","messagesQueue","EventEmitter","subscribe","bind","createChat","initParams","initRestClient","initPullClient","initCore","initWidget","initComplete","rootNode","node","document","createElement","code","language","buttonInstance","useBitrixLocalize","placeholder","querySelector","errors","checkRequiredFields","forEach","ready","setRootNode","localize","window","setLocalize","pullClient","PullClient","serverEnabled","siteId","skipStorageInit","configTimestamp","skipCheckRevision","getPublicListMethod","Controller","getHost","languageId","pull","rest","vuexBuilder","database","browser","isIe","databaseName","databaseType","VuexBuilder","DatabaseType","localStorage","models","create","setVariables","getWidgetVariables","getRestAuthId","setModelData","setPrepareFilesBeforeSaveFunction","prepareFileData","addRestAnswerHandler","getStore","dispatchEvent","CustomEvent","detail","widgetCode","widgetHost","callStartFlag","start","callOpenFlag","isSessionActive","requestWidgetData","openFromButton","wm","showById","checkForErrorsBeforeOpen","stop","inited","attachTemplate","isUserReady","isHashAvailable","fireInitEvent","xhr","widgetConfigRequest","clearError","executeRestAnswer","setError","isConfigDataLoaded","Logger","log","requestDataSend","abort","handleBatchRequestResult","getDataRequestQuery","getDialogData","resolve","getCreateChatRequestQuery","handleBatchCreateChatRequestResult","response","handleConfigGet","handleUserGet","handleChatGet","handleDialogGet","handleDialogMessagesGet","handleUserRegister","handlePullRequests","description","handleChatCreate","query","isUserRegistered","config_id","getConfigId","trace_data","getCrmTraceData","custom_data","getCustomData","ImRestMethodHandler","imChatGet","ImRestMethod","dialog_id","imDialogMessagesGetInit","imDialogMessagesGet","chat_id","limit","getRequestMessageLimit","convert_text","getUserRegisterFields","userRegisterData","getUserHashCookie","isUserAgreeConsent","consent_url","href","event","eventData","getData","getters","session","getOpenSessionQuery","handleBatchOpenSessionRequestResult","files","isArray","map","file","md5","getUserHash","urlParam","urlPreview","urlShow","urlDownload","body","firstChild","insertBefore","append","get","variables","getLocalize","checkBrowserVersion","BX_LIVECHAT_OLD_BROWSER","versionCompare","Vue","version","alert","BX_LIVECHAT_OLD_VUE","BX_LIVECHAT_OLD_VUE_DEV","replace","isSameDomain","BX_LIVECHAT_SAME_DOMAIN","isReady","options","lastIndexOf","hostname","platform","isIos","getIosVersion","config","pullClientInited","isConnected","scheduleReconnect","server","config_timestamp","storage","StorageManager","Status","eventStatusInteraction","pullConnectedFirstTime","status","PullStatus","Online","template","$Bitrix","skipReconnectToLastSession","CloseReasons","MANUAL","restart","onPullOnlineStatus","Offline","pullRequestMessage","pullBaseHandler","option","emitAsync","EventType","requestUnread","emit","scrollOnStart","readMessage","innerHTML","createVue","el","beforeCreate","ZIndexManager","undefined","stack","getOrAddStack","setBaseIndex","$bitrix","Data","destroyed","templateAttached","$destroy","mutateComponent","onWidgetClose","detachTemplate","initEventFired","traceData","getTrace","b24Tracker","customData","MESSAGE","BX_LIVECHAT_EXTRA_SITE","JSON","stringify","getDialogId","dialogues","userHash","cookie","validUserFields","field","indexOf","setNewAuthToken","authToken","getStoreBuilder","clearModelState","element","concat","localizeDescription","link","endsWith","active","includes","subscribers","filter","phrases","phrase","configGet","userGetResult","chatGetResult","dialogGetResult","dialogMessagesGetResult","userRegisterResult","chatCreateResult","timeShift","serverTimeResult","Math","floor","now","pullConfigResult","startPullClient","WidgetPublicManager","developerInfo","__privateMethods__","__createLegacyMethods","showNotification","getUserData","setUserRegisterData","setCustomData","mutateTemplateComponent","LiveChat","sourceHref","sourceDomain","port","openLiveChat","closeLiveChat","addEventListener","eventName","handler","origin","action","setCookie","getCookie","BxLiveChatInit","firstMessage","BxLiveChatLoader","WidgetSendMessageHandler","Application","onProcessQueueHandler","processQueue","onConsentAcceptedHandler","onConsentAccepted","onConsentDeclinedHandler","onConsentDeclined","unsubscribe","focus","getWidgetData","storedMessage","textarea","stopWriting","sendMessage","setFocus","quoteId","quoteMessage","getMessageTextWithQuote","quotePanelClose","isUnreadMessagesLoaded","sendMessageToServer","FILE_ID","addMessageToModel","sending","scrollToBottom","cancelIfScrollChange","addMessageToQueue","values","parse","Number","parseInt","SESSION_ID","getSessionId","isSessionClose","loc","WidgetRestMethod","botId","imMessageCommand","authorId","quoteDelimiter","repeat","quoteTitle","quoteDate","date","format","quoteContent","quote","join","messagesToSend","imMessageAdd","timMessageType","RestMethodHandler","deleteFromQueue","uploader","addMessageWithFile","isFocusNeeded","getApplicationModel","DeviceType","mobile","onSendMessage","insertText","SendMessageHandler","WidgetTextareaHandler","appId","getWidgetModel","onFocusScrollTimeout","onScrollHandler","onScroll","force","removeEventListener","canSendTypedText","infoString","operatorId","isPublishingEnabled","onScrollTimeout","setBlur","TextareaHandler","WidgetTextareaUploadHandler","getDiskFolderId","requestDiskFolderId","senderOptions","customHeaders","addTask","taskId","fileData","fileName","generateUniqueName","previewBlob","fileInputEvent","fileChangeEvent","target","storedFile","uploadFile","addFilesFromEvent","onTextareaFileSelected","actionUploadChunk","actionCommitFile","actionRollbackUpload","TextareaUploadHandler","WidgetReadingHandler","skipTimer","skipAjax","ReadingHandler","WidgetResizeHandler","widgetLocation","availableWidth","availableHeight","events","setEventNamespace","subscribeToEvents","configEvents","Type","isObject","entries","isFunction","currentHeight","currentWidth","isResizing","changedTouches","cursorStartPointY","clientY","cursorStartPointX","clientX","heightStartPoint","widthStartPoint","addWidgetResizeEvents","cursorControlPointY","cursorControlPointX","maxHeight","isBottomLocation","min","max","maxWidth","isLeftLocation","onSizeChange","newHeight","newWidth","removeWidgetResizeEvents","onStopResize","onContinueResizeHandler","onContinueResize","onStopResizeHandler","WidgetConsentHandler","showConsentHandler","onShowConsent","acceptConsentHandler","onAcceptConsent","declineConsentHandler","onDeclineConsent","hideConsent","sendConsentDecision","WidgetFormHandler","showFormHandler","onShowForm","hideFormHandler","onHideForm","sendVoteHandler","onSendVote","showFormTimeout","delayed","showLikeForm","showSmiles","sendVote","WidgetReactionHandler","ReactionHandler","WidgetHistoryHandler","requestControllerAction","handleRequest","downloadHistory","ajaxEndpoint","url","URL","searchParams","formData","FormData","key","fetch","headers","contentType","json","blob","Blob","createObjectURL","a","download","click","remove","WidgetDialogActionHandler","DialogActionHandler","BitrixVue","component","widgetAvailableHeight","widgetAvailableWidth","widgetCurrentHeight","widgetCurrentWidth","widgetIsResizing","startNewChatMode","computed","showTextarea","showWelcomeForm","textareaHeightStyle","flex","textareaBottomMargin","marginBottom","widgetHeightStyle","widgetWidthStyle","userSelectStyle","widgetMobileDisabled","orientation","DeviceOrientation","horizontal","navigator","userAgent","screen","availHeight","widgetPositionClass","className","widgetLanguageClass","widgetPlatformClass","isSafari","isMac","widgetClassName","isDarkColor","showMessageDialog","messageCollection","getFilteredPhrases","Vuex","mapState","created","onCreated","initEventHandlers","mounted","registerZIndex","beforeDestroy","unsubscribeEvents","destroyHandlers","unregisterZIndex","methods","sendMessageHandler","textareaHandler","textareaUploadHandler","readingHandler","consentHandler","formHandler","textareaDragHandler","getTextareaDragHandler","resizeHandler","getWidgetResizeHandler","reactionHandler","historyHandler","dialogActionHandler","destroy","onWindowKeyDown","getAvailableSpaceFunc","throttle","getAvailableSpace","initMobileEnv","metaTags","head","querySelectorAll","viewPortMetaSiteNode","find","createViewportMeta","viewPortMetaWidgetNode","setAttribute","classList","add","isSafariBased","$store","contentWidth","offsetWidth","innerWidth","removeMobileEnv","initCollections","getApplication","onBeforeClose","onAfterClose","onOpenMenu","getHtmlHistory","onPullRequestConfig","recoverPullConnection","onSmilesSelectSmile","onSmilesSelectSet","onWidgetStartDrag","startResize","keyCode","preventDefault","stopPropagation","onWelcomeFormSendSuccess","onWelcomeFormSendError","onTextareaStartDrag","onStartDrag","openDialogList","onStartNewChat","widgetMargin","bottomPosition","$refs","widgetWrapper","getBoundingClientRect","bottom","widgetBottomMargin","innerHeight","topPosition","top","setAvailableWidth","setAvailableHeight","TextareaDragHandler","onHeightChange","onStopDrag","isPageMode","zIndexStackInstance","register","unregister","isWidgetDisabled","multiDialog","$emit","openMenu","customBackgroundStyle","customBackgroundOnlineStyle","showName","voteActive","chatTitle","BX_LIVECHAT_TITLE","operatorName","operatorDescription","operatorPosition","BX_LIVECHAT_USER","BX_LIVECHAT_OPERATOR_POSITION_AND_SESSION_ID","BX_LIVECHAT_OPERATOR_POSITION_ONLY","ie11","Browser","isIE11","watch","$root","newChatMode","sessionList","isLoading","pagesLoaded","hasMoreItemsToLoad","itemsPerPage","requestDialogList","offset","requestParams","prepareSessionList","startNewChat","isOneScreenRemaining","scrollTop","clientHeight","scrollHeight","agree","disagree","onShow","done","onHide","onKeyDown","iframe","shiftKey","cancel","success","nextElementSibling","previousElementSibling","directives","inserted","cloneComponent","LiveChatWidget"],"mappings":"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"}