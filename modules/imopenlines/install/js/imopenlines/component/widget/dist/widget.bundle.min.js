(function(t,e,i,s,o,a,n,r,l,c,d,h,u,m,g,f,v,p,b,w,x,y,C,I,T){"use strict";function E(t){var e=[];for(var i in t){if(t.hasOwnProperty(i)){e.push(t[i])}}return e}var _=Object.freeze({none:"none",like:"like",dislike:"dislike"});var M=Object.freeze({russian:"ru",ukraine:"ua",world:"en"});var L=Object.freeze({none:"none",like:"like",smile:"smile",consent:"consent",welcome:"welcome",offline:"offline",history:"history"});var k=Object.freeze({topLeft:1,topMiddle:2,topBottom:3,bottomLeft:6,bottomMiddle:5,bottomRight:4});var D=Object.freeze({1:"top-left",2:"top-center",3:"top-right",6:"bottom-left",5:"bottom-center",4:"bottom-right"});var S=Object.freeze({configLoaded:"configLoaded",widgetOpen:"widgetOpen",widgetClose:"widgetClose",sessionStart:"sessionStart",sessionOperatorChange:"sessionOperatorChange",sessionFinish:"sessionFinish",operatorMessage:"operatorMessage",userForm:"userForm",userMessage:"userMessage",userFile:"userFile",userVote:"userVote",every:"every"});var F=E(S);var R=Object.freeze({widgetUserRegister:"imopenlines.widget.user.register",widgetConfigGet:"imopenlines.widget.config.get",widgetDialogGet:"imopenlines.widget.dialog.get",widgetUserGet:"imopenlines.widget.user.get",widgetUserConsentApply:"imopenlines.widget.user.consent.apply",widgetVoteSend:"imopenlines.widget.vote.send",widgetFormSend:"imopenlines.widget.form.send",pullServerTime:"server.time",pullConfigGet:"pull.config.get"});var A=E(R);var H=Object.freeze({guest:"guest"});var $=Object.freeze({new:0,skip:5,answer:10,client:20,clientAfterOperator:25,operator:40,waitClient:50,close:60,spam:65,duplicate:69,silentlyClose:75});var B={get:function t(e,i){var s=e?e+"_"+i:i;if(navigator.cookieEnabled){var o=document.cookie.match(new RegExp("(?:^|; )"+s.replace(/([.$?*|{}()\[\]\\\/+^])/g,"\\$1")+"=([^;]*)"));if(o){return decodeURIComponent(o[1])}}if(f.LocalStorage.isEnabled()){var a=f.LocalStorage.get(e,0,i,undefined);if(typeof a!=="undefined"){return a}}if(typeof window.BX.LiveChatCookie==="undefined"){window.BX.LiveChatCookie={}}return window.BX.LiveChatCookie[s]},set:function t(e,i,s,o){o=o||{};var a=o.expires;if(typeof a=="number"&&a){var n=new Date;n.setTime(n.getTime()+a*1e3);a=o.expires=n}if(a&&a.toUTCString){o.expires=a.toUTCString()}s=encodeURIComponent(s);var r=e?e+"_"+i:i;var l=r+"="+s;for(var c in o){if(!o.hasOwnProperty(c)){continue}l+="; "+c;var d=o[c];if(d!==true){l+="="+d}}document.cookie=l;if(typeof window.BX.LiveChatCookie==="undefined"){BX.LiveChatCookie={}}window.BX.LiveChatCookie[r]=s;f.LocalStorage.set(e,0,i,s);return true}};var U=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getName",value:function t(){return"widget"}},{key:"getState",value:function t(){return{common:{configId:0,configName:"",host:this.getVariable("common.host",location.protocol+"//"+location.host),pageMode:this.getVariable("common.pageMode",false),copyright:this.getVariable("common.copyright",true),copyrightUrl:this.getVariable("common.copyrightUrl","https://bitrix24.com"),location:this.getVariable("common.location",k.bottomRight),styles:{backgroundColor:this.getVariable("styles.backgroundColor","#17a3ea"),iconColor:this.getVariable("styles.iconColor","#ffffff")},vote:{enable:false,beforeFinish:true,messageText:this.getVariable("vote.messageText",""),messageLike:this.getVariable("vote.messageLike",""),messageDislike:this.getVariable("vote.messageDislike","")},textMessages:{bxLivechatOnlineLine1:this.getVariable("textMessages.bxLivechatOnlineLine1",""),bxLivechatOnlineLine2:this.getVariable("textMessages.bxLivechatOnlineLine2",""),bxLivechatOffline:this.getVariable("textMessages.bxLivechatOffline","")},online:false,operators:[],connectors:[],showForm:L.none,showed:false,reopen:false,dragged:false,textareaHeight:0,showConsent:false,consentUrl:"",dialogStart:false},dialog:{sessionId:0,sessionClose:true,sessionStatus:0,userVote:_.none,userConsent:false,operator:{name:"",firstName:"",lastName:"",workPosition:"",avatar:"",online:false}},user:{id:-1,hash:"",name:"",firstName:"",lastName:"",avatar:"",email:"",phone:"",www:"",gender:"M",position:""}}}},{key:"getStateSaveException",value:function t(){return{common:{host:null,pageMode:null,copyright:null,copyrightUrl:null,styles:null,dragged:null,showed:null,showConsent:null,showForm:null,location:null}}}},{key:"getMutations",value:function t(){var e=this;return{common:function t(i,s){if(typeof s.configId==="number"){i.common.configId=s.configId}if(typeof s.configName==="string"){i.common.configName=s.configName}if(typeof s.online==="boolean"){i.common.online=s.online}if(C.Utils.types.isPlainObject(s.vote)){if(typeof s.vote.enable==="boolean"){i.common.vote.enable=s.vote.enable}if(typeof s.vote.beforeFinish==="boolean"){i.common.vote.beforeFinish=s.vote.beforeFinish}if(typeof s.vote.messageText==="string"){i.common.vote.messageText=s.vote.messageText}if(typeof s.vote.messageLike==="string"){i.common.vote.messageLike=s.vote.messageLike}if(typeof s.vote.messageDislike==="string"){i.common.vote.messageDislike=s.vote.messageDislike}}if(C.Utils.types.isPlainObject(s.textMessages)){if(typeof s.textMessages.bxLivechatOnlineLine1==="string"&&s.textMessages.bxLivechatOnlineLine1!==""){i.common.textMessages.bxLivechatOnlineLine1=s.textMessages.bxLivechatOnlineLine1}if(typeof s.textMessages.bxLivechatOnlineLine2==="string"&&s.textMessages.bxLivechatOnlineLine2!==""){i.common.textMessages.bxLivechatOnlineLine2=s.textMessages.bxLivechatOnlineLine2}if(typeof s.textMessages.bxLivechatOffline==="string"&&s.textMessages.bxLivechatOffline!==""){i.common.textMessages.bxLivechatOffline=s.textMessages.bxLivechatOffline}}if(typeof s.dragged==="boolean"){i.common.dragged=s.dragged}if(typeof s.textareaHeight==="number"){i.common.textareaHeight=s.textareaHeight}if(typeof s.showConsent==="boolean"){i.common.showConsent=s.showConsent}if(typeof s.consentUrl==="string"){i.common.consentUrl=s.consentUrl}if(typeof s.showed==="boolean"){i.common.showed=s.showed;s.reopen=C.Utils.device.isMobile()?false:s.showed}if(typeof s.reopen==="boolean"){i.common.reopen=s.reopen}if(typeof s.copyright==="boolean"){i.common.copyright=s.copyright}if(typeof s.dialogStart==="boolean"){i.common.dialogStart=s.dialogStart}if(s.operators instanceof Array){i.common.operators=s.operators}if(s.connectors instanceof Array){i.common.connectors=s.connectors}if(typeof s.showForm==="string"&&typeof L[s.showForm]!=="undefined"){i.common.showForm=s.showForm}if(typeof s.location==="number"&&typeof D[s.location]!=="undefined"){i.common.location=s.location}if(e.isSaveNeeded({common:s})){e.saveState(i)}},dialog:function t(i,s){if(typeof s.sessionId==="number"){i.dialog.sessionId=s.sessionId}if(typeof s.sessionClose==="boolean"){i.dialog.sessionClose=s.sessionClose}if(typeof s.sessionStatus==="number"){i.dialog.sessionStatus=s.sessionStatus}if(typeof s.userConsent==="boolean"){i.dialog.userConsent=s.userConsent}if(typeof s.userVote==="string"&&typeof s.userVote!=="undefined"){i.dialog.userVote=s.userVote}if(C.Utils.types.isPlainObject(s.operator)){if(typeof s.operator.name==="string"||typeof s.operator.name==="number"){i.dialog.operator.name=s.operator.name.toString()}if(typeof s.operator.lastName==="string"||typeof s.operator.lastName==="number"){i.dialog.operator.lastName=s.operator.lastName.toString()}if(typeof s.operator.firstName==="string"||typeof s.operator.firstName==="number"){i.dialog.operator.firstName=s.operator.firstName.toString()}if(typeof s.operator.workPosition==="string"||typeof s.operator.workPosition==="number"){i.dialog.operator.workPosition=s.operator.workPosition.toString()}if(typeof s.operator.avatar==="string"){if(!s.operator.avatar||s.operator.avatar.startsWith("http")){i.dialog.operator.avatar=s.operator.avatar}else{i.dialog.operator.avatar=i.common.host+s.operator.avatar}}if(typeof s.operator.online==="boolean"){i.dialog.operator.online=s.operator.online}}if(e.isSaveNeeded({dialog:s})){e.saveState(i)}},user:function t(i,s){if(typeof s.id==="number"){i.user.id=s.id}if(typeof s.hash==="string"&&s.hash!==i.user.hash){i.user.hash=s.hash;B.set(null,"LIVECHAT_HASH",s.hash,{expires:365*86400,path:"/"})}if(typeof s.name==="string"||typeof s.name==="number"){i.user.name=s.name.toString()}if(typeof s.firstName==="string"||typeof s.firstName==="number"){i.user.firstName=s.firstName.toString()}if(typeof s.lastName==="string"||typeof s.lastName==="number"){i.user.lastName=s.lastName.toString()}if(typeof s.avatar==="string"){i.user.avatar=s.avatar}if(typeof s.email==="string"){i.user.email=s.email}if(typeof s.phone==="string"||typeof s.phone==="number"){i.user.phone=s.phone.toString()}if(typeof s.www==="string"){i.user.www=s.www}if(typeof s.gender==="string"){i.user.gender=s.gender}if(typeof s.position==="string"){i.user.position=s.position}if(e.isSaveNeeded({user:s})){e.saveState(i)}}}}}]);return e}(T.VuexBuilderModel);var N=function(){function t(e){babelHelpers.classCallCheck(this,t);this.queryAuthRestore=false;this.setAuthId(H.guest);this.restClient=new c.RestClient({endpoint:e.endpoint,queryParams:this.queryParams,cors:true})}babelHelpers.createClass(t,[{key:"setAuthId",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";if(babelHelpers.typeof(this.queryParams)!=="object"){this.queryParams={}}if(e==H.guest||typeof e==="string"&&e.match(/^[a-f0-9]{32}$/)){this.queryParams.livechat_auth_id=e}else{console.error("%LiveChatRestClient.setAuthId: auth is not correct (%c".concat(e,"%c)"),"color: black;","font-weight: bold; color: red","color: black");return false}if(e==H.guest&&typeof i==="string"&&i.match(/^[a-f0-9]{32}$/)){this.queryParams.livechat_custom_auth_id=i}return true}},{key:"getAuthId",value:function t(){if(babelHelpers.typeof(this.queryParams)!=="object"){this.queryParams={}}return this.queryParams.livechat_auth_id||null}},{key:"callMethod",value:function t(e,i,s,o){var a=this;var n=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;if(!n){n=C.Utils.getLogTrackingParams({name:e})}var r=new BX.Promise;this.restClient.callMethod(e,i,null,o,n).then(function(t){a.queryAuthRestore=false;r.fulfill(t)}).catch(function(t){var s=t.error();if(s.ex.error=="LIVECHAT_AUTH_WIDGET_USER"){a.setAuthId(s.ex.hash);if(e===R.widgetUserRegister){console.warn("BX.LiveChatRestClient: ".concat(s.ex.error_description," (").concat(s.ex.error,")"));a.queryAuthRestore=false;r.reject(t);return false}if(!a.queryAuthRestore){console.warn("BX.LiveChatRestClient: your auth-token has expired, send query with a new token");a.queryAuthRestore=true;a.restClient.callMethod(e,i,null,o,n).then(function(t){a.queryAuthRestore=false;r.fulfill(t)}).catch(function(t){a.queryAuthRestore=false;r.reject(t)});return false}}a.queryAuthRestore=false;r.reject(t)});return r}},{key:"callBatch",value:function t(e,i,s,o,a){var n=this;var r=function t(r){for(var l in e){if(!e.hasOwnProperty(l)){continue}var c=r[l].error();if(c&&c.ex.error=="LIVECHAT_AUTH_WIDGET_USER"){n.setAuthId(c.ex.hash);if(l===R.widgetUserRegister){console.warn("BX.LiveChatRestClient: ".concat(c.ex.error_description," (").concat(c.ex.error,")"));n.queryAuthRestore=false;i(r);return false}if(!n.queryAuthRestore){console.warn("BX.LiveChatRestClient: your auth-token has expired, send query with a new token");n.queryAuthRestore=true;n.restClient.callBatch(e,i,s,o,a);return false}}}n.queryAuthRestore=false;i(r);return true};return this.restClient.callBatch(e,r,s,o,a)}}]);return t}();var P=function(t){babelHelpers.inherits(e,t);function e(){var t;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,i));t.widget=i.widget;return t}babelHelpers.createClass(e,[{key:"handleImopenlinesWidgetConfigGetSuccess",value:function t(e){this.store.commit("widget/common",{configId:e.configId,configName:e.configName,vote:e.vote,textMessages:e.textMessages,operators:e.operators||[],online:e.online,consentUrl:e.consentUrl,connectors:e.connectors||[]});this.store.commit("application/set",{disk:e.disk});this.widget.addLocalize(e.serverVariables);f.LocalStorage.set(this.widget.getSiteId(),0,"serverVariables",e.serverVariables||{})}},{key:"handleImopenlinesWidgetUserRegisterSuccess",value:function t(e){this.widget.restClient.setAuthId(e.hash);var i=[];if(typeof this.store.state.messages.collection[this.controller.getChatId()]!=="undefined"){i=this.store.state.messages.collection[this.controller.getChatId()]}this.store.commit("messages/initCollection",{chatId:e.chatId,messages:i});this.store.commit("dialogues/initCollection",{dialogId:e.dialogId,fields:{entityType:"LIVECHAT",type:"livechat"}});this.store.commit("application/set",{dialog:{chatId:e.chatId,dialogId:"chat"+e.chatId}})}},{key:"handleImopenlinesWidgetUserGetSuccess",value:function t(e){this.store.commit("widget/user",{id:e.id,hash:e.hash,name:e.name,firstName:e.firstName,lastName:e.lastName,phone:e.phone,avatar:e.avatar,email:e.email,www:e.www,gender:e.gender,position:e.position});this.store.dispatch("users/set",[{id:e.id,name:e.name,firstName:e.firstName,lastName:e.lastName,avatar:e.avatar,gender:e.gender,workPosition:e.position}]);this.store.commit("application/set",{common:{userId:e.id}})}},{key:"handleImopenlinesWidgetDialogGetSuccess",value:function t(e){this.store.commit("messages/initCollection",{chatId:e.chatId});this.store.commit("widget/dialog",e);this.store.commit("application/set",{dialog:{chatId:e.chatId,dialogId:"chat"+e.chatId,diskFolderId:e.diskFolderId}})}},{key:"handleImDialogMessagesGetSuccess",value:function t(e){if(e.messages&&e.messages.length>0&&!this.widget.isDialogStart()){this.store.commit("widget/common",{dialogStart:true})}}},{key:"handleImMessageAddSuccess",value:function t(e,i){this.widget.messagesQueue=this.widget.messagesQueue.filter(function(t){return t.id!=i.id});this.widget.sendEvent({type:S.userMessage,data:{id:e,text:i.text}})}},{key:"handleImMessageAddError",value:function t(e,i){this.widget.messagesQueue=this.widget.messagesQueue.filter(function(t){return t.id!=i.id})}},{key:"handleImDiskFileCommitSuccess",value:function t(e,i){this.widget.messagesQueue=this.widget.messagesQueue.filter(function(t){return t.id!=i.id});this.widget.sendEvent({type:S.userFile,data:{}})}}]);return e}(v.BaseRestAnswerHandler);var V=function(){babelHelpers.createClass(t,[{key:"getModuleId",value:function t(){return"im"}}],[{key:"create",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(e)}}]);function t(e){babelHelpers.classCallCheck(this,t);this.controller=e.controller;this.store=e.store;this.widget=e.widget}babelHelpers.createClass(t,[{key:"handleMessageChat",value:function t(e,i,s){if(e.message.senderId!=this.controller.getUserId()){this.widget.sendEvent({type:S.operatorMessage,data:e});if(!this.store.state.widget.common.showed&&!this.widget.onceShowed){this.widget.onceShowed=true;this.widget.open()}}}}]);return t}();var O=function(){babelHelpers.createClass(t,null,[{key:"create",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(e)}}]);function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);this.controller=e.controller;this.store=e.store;this.widget=e.widget}babelHelpers.createClass(t,[{key:"getModuleId",value:function t(){return"imopenlines"}},{key:"handleSessionStart",value:function t(e,i,s){this.store.commit("widget/dialog",{sessionId:e.sessionId,sessionClose:false,sessionStatus:0,userVote:_.none});this.widget.sendEvent({type:S.sessionStart,data:{sessionId:e.sessionId}})}},{key:"handleSessionOperatorChange",value:function t(e,i,s){this.store.commit("widget/dialog",{operator:e.operator});this.widget.sendEvent({type:S.sessionOperatorChange,data:{operator:e.operator}})}},{key:"handleSessionStatus",value:function t(e,i,s){this.store.commit("widget/dialog",{sessionId:e.sessionId,sessionStatus:e.sessionStatus,sessionClose:true});this.widget.sendEvent({type:S.sessionStatus,data:{sessionId:e.sessionId,sessionStatus:e.sessionStatus}})}},{key:"handleSessionFinish",value:function t(e,i,s){this.store.commit("widget/dialog",{sessionId:e.sessionId,sessionStatus:e.sessionStatus,sessionClose:true});this.widget.sendEvent({type:S.sessionFinish,data:{sessionId:e.sessionId,sessionStatus:e.sessionStatus}});if(!e.spam){this.store.commit("widget/dialog",{operator:{name:"",firstName:"",lastName:"",workPosition:"",avatar:"",online:false}})}}}]);return t}();var X=function(){function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);this.ready=true;this.widgetDataRequested=false;this.offline=false;this.code=i.code||"";this.host=i.host||"";this.language=i.language||"en";this.copyright=i.copyright!==false;this.copyrightUrl=this.copyright&&i.copyrightUrl?i.copyrightUrl:"";this.buttonInstance=babelHelpers.typeof(i.buttonInstance)==="object"&&i.buttonInstance!==null?i.buttonInstance:null;this.pageMode=babelHelpers.typeof(i.pageMode)==="object"&&i.pageMode;if(this.pageMode){this.pageMode.useBitrixLocalize=i.pageMode.useBitrixLocalize===true;this.pageMode.placeholder=document.getElementById(i.pageMode.placeholder)}if(typeof this.code==="string"){if(this.code.length<=0){console.warn("%cLiveChatWidget.constructor: code is not correct (%c".concat(this.code,"%c)"),"color: black;","font-weight: bold; color: red","color: black");this.ready=false}}if(typeof this.host==="string"){if(this.host.length<=0||!this.host.startsWith("http")){console.warn("%cLiveChatWidget.constructor: host is not correct (%c".concat(this.host,"%c)"),"color: black;","font-weight: bold; color: red","color: black");this.ready=false}}this.inited=false;this.initEventFired=false;this.restClient=null;this.userRegisterData={};this.customData=[];this.localize=this.pageMode&&this.pageMode.useBitrixLocalize?window.BX.message:{};if(babelHelpers.typeof(i.localize)==="object"){this.addLocalize(i.localize)}this.subscribers={};this.dateFormat=null;this.messagesQueue=[];this.configRequestXhr=null;if(this.pageMode&&this.pageMode.placeholder){this.rootNode=this.pageMode.placeholder}else{this.rootNode=document.createElement("div");if(document.body.firstChild){document.body.insertBefore(this.rootNode,document.body.firstChild)}else{document.body.appendChild(this.rootNode)}}this.template=null;window.addEventListener("orientationchange",function(){if(!e.store){return}e.store.commit("application/set",{device:{orientation:C.Utils.device.getOrientation()}});if(e.store.state.widget.common.showed&&e.store.state.application.device.type===w.DeviceType.mobile&&e.store.state.application.device.orientation===w.DeviceOrientation.horizontal){document.activeElement.blur()}});var s=f.LocalStorage.get(this.getSiteId(),0,"serverVariables",false);if(s){this.addLocalize(s)}var o={common:{host:this.getHost(),pageMode:this.pageMode!==false,copyright:this.copyright,copyrightUrl:this.copyrightUrl},vote:{messageText:this.getLocalize("BX_LIVECHAT_VOTE_TITLE"),messageLike:this.getLocalize("BX_LIVECHAT_VOTE_PLUS_TITLE"),messageDislike:this.getLocalize("BX_LIVECHAT_VOTE_MINUS_TITLE")},textMessages:{bxLivechatOnlineLine1:this.getLocalize("BX_LIVECHAT_ONLINE_LINE_1"),bxLivechatOnlineLine2:this.getLocalize("BX_LIVECHAT_ONLINE_LINE_2"),bxLivechatOffline:this.getLocalize("BX_LIVECHAT_OFFLINE")}};if(i.location&&typeof D[i.location]!=="undefined"){o.common.location=i.location}if(C.Utils.types.isPlainObject(i.styles)&&(i.styles.backgroundColor||i.styles.iconColor)){o.styles={};if(i.styles.backgroundColor){o.styles.backgroundColor=i.styles.backgroundColor}if(i.styles.iconColor){o.styles.iconColor=i.styles.iconColor}}this.controller=new g.ApplicationController;var a={common:{host:this.getHost(),siteId:this.getSiteId(),languageId:this.language},device:{type:C.Utils.device.isMobile()?w.DeviceType.mobile:w.DeviceType.desktop,orientation:C.Utils.device.getOrientation()},dialog:{messageLimit:this.controller.getDefaultMessageLimit()},saveException:{common:{host:null,siteId:null,languageId:null},dialog:{messageLimit:null,messageExtraCount:null}}};var n=!C.Utils.browser.isIe();(new T.VuexBuilder).addModel(U.create().setVariables(o)).addModel(m.ApplicationModel.create().setVariables(a)).addModel(m.DialoguesModel.create().useDatabase(n).setVariables({host:this.host})).addModel(m.MessagesModel.create().useDatabase(n)).addModel(m.FilesModel.create().useDatabase(n).setVariables({host:this.host,default:{name:this.getLocalize("IM_MESSENGER_MESSAGE_FILE_DELETED")}})).addModel(m.UsersModel.create().useDatabase(n).setVariables({host:this.host,default:{name:this.getLocalize("IM_MESSENGER_MESSAGE_USER_ANONYM")}})).setDatabaseConfig({name:"imol/widget",type:T.VuexBuilder.DatabaseType.localStorage,siteId:this.getSiteId()}).build(function(t){e.store=t.store;e.storeCollector=t.builder;e.initRestClient();e.controller.setStore(e.store);e.controller.setRestClient(e.restClient);e.controller.setPrepareFilesBeforeSaveFunction(e.prepareFileData.bind(e));e.imRestAnswer=v.ImRestAnswerHandler.create({store:e.store,controller:e.controller});e.widgetRestAnswer=P.create({widget:e,store:e.store,controller:e.controller});window.dispatchEvent(new CustomEvent("onBitrixLiveChat",{detail:{widget:e,widgetCode:e.code,widgetHost:e.host}}));if(e.callStartFlag){e.start()}if(e.pageMode||e.callOpenFlag){e.open()}})}babelHelpers.createClass(t,[{key:"initRestClient",value:function t(){this.restClient=new N({endpoint:this.host+"/rest"});if(this.isUserRegistered()){this.restClient.setAuthId(this.getUserHash())}else{this.restClient.setAuthId(H.guest)}}},{key:"requestWidgetData",value:function t(){var e=this;if(!this.isReady()){console.error("LiveChatWidget.start: widget code or host is not specified");return false}this.widgetDataRequested=true;if(!this.isUserRegistered()&&(this.userRegisterData.hash||this.getUserHashCookie())){this.requestData();this.inited=true;this.fireInitEvent()}else if(this.isConfigDataLoaded()&&this.isUserRegistered()){this.requestData();this.inited=true;this.fireInitEvent()}else{this.restClient.callMethod(R.widgetConfigGet,{code:this.code},function(t){e.configRequestXhr=t}).then(function(t){e.configRequestXhr=null;e.clearError();e.executeRestAnswer(R.widgetConfigGet,t);if(!e.inited){e.inited=true;e.fireInitEvent()}}).catch(function(t){e.configRequestXhr=null;e.setError(t.error().ex.error,t.error().ex.error_description)});if(this.isConfigDataLoaded()){this.inited=true;this.fireInitEvent()}}}},{key:"requestData",value:function t(){var e=this;if(this.requestDataSend){return true}this.requestDataSend=true;if(this.configRequestXhr){this.configRequestXhr.abort()}var i=babelHelpers.defineProperty({},R.widgetConfigGet,[R.widgetConfigGet,{code:this.code}]);if(this.isUserRegistered()){i[R.widgetDialogGet]=[R.widgetDialogGet,{config_id:this.getConfigId(),trace_data:this.getCrmTraceData(),custom_data:this.getCustomData()}];i[w.RestMethodHandler.imChatGet]=[w.RestMethod.imChatGet,{dialog_id:"$result["+R.widgetDialogGet+"][dialogId]"}];i[w.RestMethodHandler.imDialogMessagesGetInit]=[w.RestMethod.imDialogMessagesGet,{chat_id:"$result["+R.widgetDialogGet+"][chatId]",limit:this.controller.getRequestMessageLimit(),convert_text:"Y"}]}else{i[R.widgetUserRegister]=[R.widgetUserRegister,babelHelpers.objectSpread({config_id:"$result["+R.widgetConfigGet+"][configId]"},this.getUserRegisterFields())];i[w.RestMethodHandler.imChatGet]=[w.RestMethod.imChatGet,{dialog_id:"$result["+R.widgetUserRegister+"][dialogId]"}];if(this.userRegisterData.hash||this.getUserHashCookie()){i[R.widgetDialogGet]=[R.widgetDialogGet,{config_id:"$result["+R.widgetConfigGet+"][configId]",trace_data:this.getCrmTraceData(),custom_data:this.getCustomData()}];i[w.RestMethodHandler.imDialogMessagesGetInit]=[w.RestMethod.imDialogMessagesGet,{chat_id:"$result["+R.widgetDialogGet+"][chatId]",limit:this.controller.getRequestMessageLimit(),convert_text:"Y"}]}if(this.isUserAgreeConsent()){i[R.widgetUserConsentApply]=[R.widgetUserConsentApply,{config_id:"$result["+R.widgetConfigGet+"][configId]",consent_url:location.href}]}}i[R.pullServerTime]=[R.pullServerTime,{}];i[R.pullConfigGet]=[R.pullConfigGet,{CACHE:"N"}];i[R.widgetUserGet]=[R.widgetUserGet,{}];this.restClient.callBatch(i,function(t){if(!t){e.requestDataSend=false;e.setError("EMPTY_RESPONSE","Server returned an empty response.");return false}var i=t[R.widgetConfigGet];if(i&&i.error()){e.requestDataSend=false;e.setError(i.error().ex.error,i.error().ex.error_description);return false}e.executeRestAnswer(R.widgetConfigGet,i);var s=t[R.widgetUserGet];if(s.error()){e.requestDataSend=false;e.setError(s.error().ex.error,s.error().ex.error_description);return false}e.executeRestAnswer(R.widgetUserGet,s);var o=t[w.RestMethodHandler.imChatGet];if(o.error()){e.requestDataSend=false;e.setError(o.error().ex.error,o.error().ex.error_description);return false}e.executeRestAnswer(w.RestMethodHandler.imChatGet,o);var a=t[R.widgetDialogGet];if(a){if(a.error()){e.requestDataSend=false;e.setError(a.error().ex.error,a.error().ex.error_description);return false}e.executeRestAnswer(R.widgetDialogGet,a)}var n=t[w.RestMethodHandler.imDialogMessagesGetInit];if(n){if(n.error()){e.requestDataSend=false;e.setError(n.error().ex.error,n.error().ex.error_description);return false}e.store.dispatch("dialogues/saveDialog",{dialogId:e.controller.getDialogId(),chatId:e.controller.getChatId()});e.executeRestAnswer(w.RestMethodHandler.imDialogMessagesGetInit,n)}var r=t[R.widgetUserRegister];if(r){if(r.error()){e.requestDataSend=false;e.setError(r.error().ex.error,r.error().ex.error_description);return false}e.executeRestAnswer(R.widgetUserRegister,r)}var l=0;var c=t[R.pullServerTime];if(c&&!c.error()){l=Math.floor(((new Date).getTime()-new Date(c.data()).getTime())/1e3)}var d=null;var h=t[R.pullConfigGet];if(h&&!h.error()){d=h.data();d.server.timeShift=l}e.startPullClient(d).then(function(){e.processSendMessages()}).catch(function(t){e.setError(t.ex.error,t.ex.error_description)});e.requestDataSend=false},false,false,C.Utils.getLogTrackingParams({name:"widget.init.config",dialog:this.controller.getDialogData()}))}},{key:"executeRestAnswer",value:function t(e,i,s){this.imRestAnswer.execute(e,i,s);this.widgetRestAnswer.execute(e,i,s)}},{key:"prepareFileData",value:function t(e){var i=this;if(B.get(null,"BITRIX_LIVECHAT_AUTH")){return e}if(!C.Utils.types.isArray(e)){return e}return e.map(function(t){var e=(window.md5||d.md5)(i.getUserId()+"|"+t.id+"|"+i.getUserHash());var s="livechat_auth_id="+e+"&livechat_user_id="+i.getUserId();if(t.urlPreview){t.urlPreview=t.urlPreview+"&"+s}if(t.urlShow){t.urlShow=t.urlShow+"&"+s}if(t.urlDownload){t.urlDownload=t.urlDownload+"&"+s}return t})}},{key:"checkBrowserVersion",value:function t(){if(C.Utils.platform.isIos()){var e=C.Utils.platform.getIosVersion();if(e&&e<=10){return false}}return true}},{key:"startPullClient",value:function t(e){var i=this;var s=new BX.Promise;if(this.pullClient){if(!this.pullClient.isConnected()){this.pullClient.scheduleReconnect()}s.resolve(true);return s}if(!this.getUserId()||!this.getSiteId()||!this.restClient){s.reject({ex:{error:"WIDGET_NOT_LOADED",error_description:"Widget is not loaded."}});return s}this.pullClient=new u.PullClient({serverEnabled:true,userId:this.getUserId(),siteId:this.getSiteId(),restClient:this.restClient,configTimestamp:e?e.server.config_timestamp:0,skipCheckRevision:true});this.pullClient.subscribe(new p.ImPullCommandHandler({store:this.store,controller:this.controller}));this.pullClient.subscribe(new V({store:this.store,controller:this.controller,widget:this}));this.pullClient.subscribe(new O({store:this.store,controller:this.controller,widget:this}));this.pullClient.subscribe({type:u.PullClient.SubscriptionType.Status,callback:this.eventStatusInteraction.bind(this)});this.pullConnectedFirstTime=this.pullClient.subscribe({type:u.PullClient.SubscriptionType.Status,callback:function t(e){if(e.status===u.PullClient.PullStatus.Online){s.resolve(true);i.pullConnectedFirstTime()}}});if(this.template){this.template.$root.$bitrixPullClient=this.pullClient;this.template.$root.$emit("onBitrixPullClientInited",this.pullClient)}this.pullClient.start(babelHelpers.objectSpread({},e,{skipReconnectToLastSession:true})).catch(function(){s.reject({ex:{error:"PULL_CONNECTION_ERROR",error_description:"Pull is not connected."}})});return s}},{key:"stopPullClient",value:function t(){if(this.pullClient){this.pullClient.stop(u.PullClient.CloseReasons.MANUAL,"Closed manually")}}},{key:"recoverPullConnection",value:function t(){this.pullClient.restart(u.PullClient.CloseReasons.MANUAL,"Restart after click by connection status button.")}},{key:"eventStatusInteraction",value:function t(e){var i=this;if(e.status===u.PullClient.PullStatus.Online){this.offline=false;if(this.pullRequestMessage){this.getDialogUnread().then(function(){i.processSendMessages()});this.pullRequestMessage=false}else{this.readMessage();this.processSendMessages()}}else if(e.status===u.PullClient.PullStatus.Offline){this.pullRequestMessage=true;this.offline=true}}},{key:"attachTemplate",value:function t(){if(this.template){this.store.commit("widget/common",{showed:true});return true}this.rootNode.innerHTML="";this.rootNode.appendChild(document.createElement("div"));var e=this;var i=this.controller;var s=this.restClient;var o=this.pullClient||null;this.template=I.Vue.create({el:this.rootNode.firstChild,store:this.store,template:"<bx-livechat/>",beforeCreate:function t(){this.$bitrixWidget=e;this.$bitrixController=i;this.$bitrixRestClient=s;this.$bitrixPullClient=o;this.$bitrixMessages=e.localize;e.sendEvent({type:S.widgetOpen,data:{}})},destroyed:function t(){e.sendEvent({type:S.widgetClose,data:{}});this.$bitrixWidget.template=null;this.$bitrixWidget.templateAttached=false;this.$bitrixWidget.rootNode.innerHTML="";this.$bitrixWidget=null;this.$bitrixRestClient=null;this.$bitrixPullClient=null;this.$bitrixMessages=null}});this.controller.setTemplateEngine(this.template);return true}},{key:"detachTemplate",value:function t(){if(!this.template){return true}this.template.$destroy();return true}},{key:"mutateTemplateComponent",value:function t(e,i){return I.Vue.mutateComponent(e,i)}},{key:"addMessage",value:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!i&&!s){return false}b.Logger.warn("addMessage",i,s);if(!this.controller.isUnreadMessagesLoaded()){this.sendMessage({id:0,text:i,file:s});this.processSendMessages();return true}this.store.commit("application/increaseDialogExtraCount");var o={};if(s){o.FILE_ID=[s.id]}this.store.dispatch("messages/add",{chatId:this.getChatId(),authorId:this.getUserId(),text:i,params:o,sending:!s}).then(function(t){if(!e.isDialogStart()){e.store.commit("widget/common",{dialogStart:true})}e.messagesQueue.push({id:t,text:i,file:s,sending:false});if(e.getChatId()){e.processSendMessages()}else{e.requestData()}});return true}},{key:"uploadFile",value:function t(e){var i=this;if(!e){return false}b.Logger.warn("addFile",e.files[0].name,e.files[0].size,e.files[0]);var s=e.files[0];var o="file";if(s.type.toString().startsWith("image")){o="image"}if(!this.controller.isUnreadMessagesLoaded()){this.addMessage("",{id:0,source:e});return true}this.store.dispatch("files/add",{chatId:this.getChatId(),authorId:this.getUserId(),name:s.name,type:o,extension:s.name.split(".").splice(-1)[0],size:s.size,image:false,status:w.FileStatus.upload,progress:0,authorName:this.controller.getCurrentUser().name,urlPreview:""}).then(function(t){return i.addMessage("",{id:t,source:e})});return true}},{key:"cancelUploadFile",value:function t(e){var i=this;var s=this.messagesQueue.find(function(t){return t.file&&t.file.id===e});if(s){if(s.xhr){s.xhr.abort()}this.store.dispatch("messages/delete",{chatId:this.getChatId(),id:s.id}).then(function(){i.store.dispatch("files/delete",{chatId:i.getChatId(),id:s.file.id});i.messagesQueue=i.messagesQueue.filter(function(t){return t.id!==s.id})})}}},{key:"processSendMessages",value:function t(){var e=this;if(this.offline){return false}this.messagesQueue.filter(function(t){return!t.sending}).forEach(function(t){t.sending=true;if(t.file){e.sendMessageWithFile(t)}else{e.sendMessage(t)}});return true}},{key:"sendMessage",value:function t(e){var i=this;this.controller.stopWriting();var s=this.store.getters["dialogues/getQuoteId"](this.getDialogId());if(s){var o=this.store.getters["messages/getMessage"](this.getChatId(),s);if(o){var a=this.store.getters["users/get"](o.authorId);var n=[];n.push("------------------------------------------------------");n.push(a.name?a.name:this.getLocalize("BX_LIVECHAT_SYSTEM_MESSAGE"));n.push(o.text);n.push("------------------------------------------------------");n.push(e.text);e.text=n.join("\n");this.quoteMessageClear()}}e.chatId=this.getChatId();this.restClient.callMethod(w.RestMethod.imMessageAdd,{TEMPLATE_ID:e.id,CHAT_ID:e.chatId,MESSAGE:e.text},null,null,C.Utils.getLogTrackingParams({name:w.RestMethod.imMessageAdd,data:{timMessageType:"text"},dialog:this.getDialogData()})).then(function(t){i.executeRestAnswer(w.RestMethodHandler.imMessageAdd,t,e)}).catch(function(t){i.executeRestAnswer(w.RestMethodHandler.imMessageAdd,t,e)});return true}},{key:"sendMessageWithFile",value:function t(e){var i=this;this.controller.stopWriting();var s=this.store.getters["files/get"](this.getChatId(),e.file.id,true).type;var o=this.getDiskFolderId();var a={};if(o){a[w.RestMethodHandler.imDiskFileUpload]=[w.RestMethod.imDiskFileUpload,{id:o,data:{NAME:e.file.source.files[0].name},fileContent:e.file.source,generateUniqueName:true}]}else{a[w.RestMethodHandler.imDiskFolderGet]=[w.RestMethod.imDiskFolderGet,{chat_id:this.getChatId()}];a[w.RestMethodHandler.imDiskFileUpload]=[w.RestMethod.imDiskFileUpload,{id:"$result["+w.RestMethodHandler.imDiskFolderGet+"][ID]",data:{NAME:e.file.source.files[0].name},fileContent:e.file.source,generateUniqueName:true}]}this.restClient.callBatch(a,function(t){if(!t){i.requestDataSend=false;console.warn("EMPTY_RESPONSE","Server returned an empty response. [1]");i.fileError(i.getChatId,e.file.id,e.id);return false}if(!o){var a=t[w.RestMethodHandler.imDiskFolderGet];if(a&&a.error()){console.warn(a.error().ex.error,a.error().ex.error_description);i.fileError(i.getChatId(),e.file.id,e.id);return false}i.executeRestAnswer(w.RestMethodHandler.imDiskFolderGet,a)}var n=0;var r=t[w.RestMethodHandler.imDiskFileUpload];if(r){var l=r.data();if(r.error()){console.warn(r.error().ex.error,r.error().ex.error_description);i.fileError(i.getChatId(),e.file.id,e.id);return false}else if(!l){console.warn("EMPTY_RESPONSE","Server returned an empty response. [2]");i.fileError(i.getChatId(),e.file.id,e.id);return false}n=l.ID}else{console.warn("EMPTY_RESPONSE","Server returned an empty response. [3]");i.fileError(i.getChatId(),e.file.id,e.id);return false}e.chatId=i.getChatId();i.store.dispatch("files/update",{chatId:e.chatId,id:e.file.id,fields:{status:w.FileStatus.wait,progress:95}});i.fileCommit({chatId:e.chatId,uploadId:n,messageText:e.text,messageId:e.id,fileId:e.file.id,fileType:s},e)},false,function(t){e.xhr=t},C.Utils.getLogTrackingParams({name:w.RestMethodHandler.imDiskFileCommit,data:{timMessageType:s},dialog:this.getDialogData()}))}},{key:"fileError",value:function t(e,i){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;this.store.dispatch("files/update",{chatId:e,id:i,fields:{status:w.FileStatus.error,progress:0}});if(s){this.store.dispatch("messages/actionError",{chatId:e,id:s,retry:false})}}},{key:"fileCommit",value:function t(e,i){var s=this;this.restClient.callMethod(w.RestMethod.imDiskFileCommit,{chat_id:e.chatId,upload_id:e.uploadId,message:e.messageText,template_id:e.messageId,file_template_id:e.fileId},null,null,C.Utils.getLogTrackingParams({name:w.RestMethod.imDiskFileCommit,data:{timMessageType:e.fileType},dialog:this.getDialogData()})).then(function(t){s.executeRestAnswer(w.RestMethodHandler.imDiskFileCommit,t,i)}).catch(function(t){s.executeRestAnswer(w.RestMethodHandler.imDiskFileCommit,t,i)});return true}},{key:"getDialogHistory",value:function t(e){var i=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.controller.getRequestMessageLimit();this.restClient.callMethod(w.RestMethod.imDialogMessagesGet,{CHAT_ID:this.getChatId(),LAST_ID:e,LIMIT:s,CONVERT_TEXT:"Y"}).then(function(t){i.executeRestAnswer(w.RestMethodHandler.imDialogMessagesGet,t);i.template.$emit(w.EventType.dialog.requestHistoryResult,{count:t.data().messages.length})}).catch(function(t){i.template.$emit(w.EventType.dialog.requestHistoryResult,{error:t.error().ex})})}},{key:"getDialogUnread",value:function t(e){var i=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.controller.getRequestMessageLimit();var o=new BX.Promise;if(!e){e=this.store.getters["messages/getLastId"](this.controller.getChatId())}if(!e){this.template.$emit(w.EventType.dialog.requestUnreadResult,{error:{error:"LAST_ID_EMPTY",error_description:"LastId is empty."}});o.reject();return o}this.controller.readMessage(e,true,true).then(function(){var t;var a=(t={},babelHelpers.defineProperty(t,w.RestMethodHandler.imDialogRead,[w.RestMethod.imDialogRead,{dialog_id:i.getDialogId(),message_id:e}]),babelHelpers.defineProperty(t,w.RestMethodHandler.imChatGet,[w.RestMethod.imChatGet,{dialog_id:i.getDialogId()}]),babelHelpers.defineProperty(t,w.RestMethodHandler.imDialogMessagesGetUnread,[w.RestMethod.imDialogMessagesGet,{chat_id:i.getChatId(),first_id:e,limit:s,convert_text:"Y"}]),t);i.restClient.callBatch(a,function(t){if(!t){i.template.$emit(w.EventType.dialog.requestUnreadResult,{error:{error:"EMPTY_RESPONSE",error_description:"Server returned an empty response."}});o.reject();return false}var e=t[w.RestMethodHandler.imChatGet];if(!e.error()){i.executeRestAnswer(w.RestMethodHandler.imChatGet,e)}var s=t[w.RestMethodHandler.imDialogMessagesGetUnread];if(s.error()){i.template.$emit(w.EventType.dialog.requestUnreadResult,{error:s.error().ex})}else{i.executeRestAnswer(w.RestMethodHandler.imDialogMessagesGetUnread,s);i.template.$emit(w.EventType.dialog.requestUnreadResult,{firstMessageId:s.data().messages.length>0?s.data().messages[0].id:0,count:s.data().messages.length})}o.fulfill(t)},false,false,C.Utils.getLogTrackingParams({name:w.RestMethodHandler.imDialogMessagesGetUnread,dialog:i.getDialogData()}))});return o}},{key:"retrySendMessage",value:function t(e){if(this.messagesQueue.find(function(t){return t.id===e.id})){return false}this.messagesQueue.push({id:e.id,text:e.text,sending:false});this.controller.setSendingMessageFlag(e.id);this.processSendMessages()}},{key:"readMessage",value:function t(e){if(this.offline){return false}return this.controller.readMessage(e)}},{key:"quoteMessage",value:function t(e){this.store.dispatch("dialogues/update",{dialogId:this.controller.getDialogId(),fields:{quoteId:e}})}},{key:"reactMessage",value:function t(e,i){this.controller.reactMessage(e,i.type,i.action)}},{key:"execMessageKeyboardCommand",value:function t(e){if(e.action!=="COMMAND"){return false}var i=e.params,s=i.dialogId,o=i.messageId,a=i.botId,n=i.command,r=i.params;this.restClient.callMethod(w.RestMethod.imMessageCommand,{MESSAGE_ID:o,DIALOG_ID:s,BOT_ID:a,COMMAND:n,COMMAND_PARAMS:r});return true}},{key:"quoteMessageClear",value:function t(){this.store.dispatch("dialogues/update",{dialogId:this.controller.getDialogId(),fields:{quoteId:0}})}},{key:"sendDialogVote",value:function t(e){var i=this;if(!this.getSessionId()){return false}this.restClient.callMethod(R.widgetVoteSend,{SESSION_ID:this.getSessionId(),ACTION:e}).catch(function(t){i.store.commit("widget/dialog",{userVote:_.none})});this.sendEvent({type:S.userVote,data:{vote:e}})}},{key:"sendForm",value:function t(e,i){var s,o=this;b.Logger.info("LiveChatWidgetPrivate.sendForm:",e,i);var a=(s={},babelHelpers.defineProperty(s,R.widgetFormSend,[R.widgetFormSend,{CHAT_ID:this.getChatId(),FORM:e.toUpperCase(),FIELDS:i}]),babelHelpers.defineProperty(s,R.widgetUserGet,[R.widgetUserGet,{}]),s);this.restClient.callBatch(a,function(t){if(!t){o.requestDataSend=false;o.setError("EMPTY_RESPONSE","Server returned an empty response.");return false}var s=t[R.widgetUserGet];if(s.error()){o.requestDataSend=false;o.setError(s.error().ex.error,s.error().ex.error_description);return false}o.executeRestAnswer(R.widgetUserGet,s);o.sendEvent({type:S.userForm,data:{form:e,fields:i}})},false,false,C.Utils.getLogTrackingParams({name:R.widgetUserGet,dialog:this.getDialogData()}))}},{key:"sendConsentDecision",value:function t(e){e=e===true;this.store.commit("widget/dialog",{userConsent:e});if(e&&this.isUserRegistered()){this.restClient.callMethod(R.widgetUserConsentApply,{config_id:this.getConfigId(),consent_url:location.href})}}},{key:"start",value:function t(){if(!this.store){this.callStartFlag=true;return true}if(this.isSessionActive()){this.requestWidgetData()}return true}},{key:"open",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};clearTimeout(this.openTimeout);if(!this.store){this.callOpenFlag=true;return true}if(!e.openFromButton&&this.buttonInstance){this.buttonInstance.wm.showById("openline_livechat")}if(!this.checkBrowserVersion()){this.setError("OLD_BROWSER_LOCALIZED",this.localize.BX_LIVECHAT_OLD_BROWSER)}else if(C.Utils.versionCompare(I.Vue.version(),"2.1")<0){alert(this.localize.BX_LIVECHAT_OLD_VUE);console.error("LiveChatWidget.error: OLD_VUE_VERSION (".concat(this.localize.BX_LIVECHAT_OLD_VUE_DEV.replace("#CURRENT_VERSION#",I.Vue.version()),")"));return false}else if(!this.isWidgetDataRequested()){this.requestWidgetData()}this.attachTemplate()}},{key:"close",value:function t(){if(this.pageMode){return false}if(this.buttonInstance){this.buttonInstance.onWidgetClose()}this.detachTemplate()}},{key:"showNotification",value:function t(e){if(!this.store){console.error("LiveChatWidget.showNotification: method can be called after fired event - onBitrixLiveChat");return false}}},{key:"fireInitEvent",value:function t(){if(this.initEventFired){return true}this.sendEvent({type:S.configLoaded,data:{}});if(this.store.state.widget.common.reopen){this.open()}this.initEventFired=true;return true}},{key:"isReady",value:function t(){return this.ready}},{key:"isInited",value:function t(){return this.inited}},{key:"isUserRegistered",value:function t(){return!!this.getUserHash()}},{key:"isConfigDataLoaded",value:function t(){return this.store.state.widget.common.configId}},{key:"isWidgetDataRequested",value:function t(){return this.widgetDataRequested}},{key:"isChatLoaded",value:function t(){return this.store.state.application.dialog.chatId>0}},{key:"isSessionActive",value:function t(){return!this.store.state.widget.dialog.sessionClose}},{key:"isUserAgreeConsent",value:function t(){return this.store.state.widget.dialog.userConsent}},{key:"getCrmTraceData",value:function t(){var e="";if(!this.buttonInstance){return e}if(typeof this.buttonInstance.getTrace!=="function"){e=this.buttonInstance.getTrace()}else if(typeof this.buttonInstance.b24Tracker!=="undefined"&&typeof this.buttonInstance.b24Tracker.guest!=="undefined"){e=this.buttonInstance.b24Tracker.guest.getTrace()}return e}},{key:"getCustomData",value:function t(){var e=[];if(this.customData.length>0){e=this.customData}else{e=[{MESSAGE:this.localize.BX_LIVECHAT_EXTRA_SITE+": "+location.href}]}return JSON.stringify(e)}},{key:"isUserLoaded",value:function t(){return this.store.state.widget.user.id>0}},{key:"getSiteId",value:function t(){return this.host.replace(/(http.?:\/\/)|([:.\\\/])/gm,"")+this.code}},{key:"getHost",value:function t(){return this.host}},{key:"getConfigId",value:function t(){return this.store.state.widget.common.configId}},{key:"isDialogStart",value:function t(){return this.store.state.widget.common.dialogStart}},{key:"getChatId",value:function t(){return this.store.state.application.dialog.chatId}},{key:"getDialogId",value:function t(){return this.store.state.application.dialog.dialogId}},{key:"getDiskFolderId",value:function t(){return this.store.state.application.dialog.diskFolderId}},{key:"getDialogData",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getDialogId();return this.store.state.dialogues.collection[e]}},{key:"getSessionId",value:function t(){return this.store.state.widget.dialog.sessionId}},{key:"getUserHash",value:function t(){return this.store.state.widget.user.hash}},{key:"getUserHashCookie",value:function t(){var e="";var i=B.get(null,"LIVECHAT_HASH");if(typeof i==="string"&&i.match(/^[a-f0-9]{32}$/)){e=i}else{var s=B.get(this.getSiteId(),"LIVECHAT_HASH");if(typeof s==="string"&&s.match(/^[a-f0-9]{32}$/)){e=s}}return e}},{key:"getUserId",value:function t(){return this.store.state.widget.user.id}},{key:"getUserData",value:function t(){if(!this.store){console.error("LiveChatWidget.getUserData: method can be called after fired event - onBitrixLiveChat");return false}return this.store.state.widget.user}},{key:"getUserRegisterFields",value:function t(){return{name:this.userRegisterData.name||"",last_name:this.userRegisterData.lastName||"",avatar:this.userRegisterData.avatar||"",email:this.userRegisterData.email||"",www:this.userRegisterData.www||"",gender:this.userRegisterData.gender||"",position:this.userRegisterData.position||"",user_hash:this.userRegisterData.hash||this.getUserHashCookie()||"",consent_url:this.store.state.widget.common.consentUrl?location.href:"",trace_data:this.getCrmTraceData(),custom_data:this.getCustomData()}}},{key:"getWidgetLocationCode",value:function t(){return D[this.store.state.widget.common.location]}},{key:"setUserRegisterData",value:function t(e){if(!this.store){console.error("LiveChatWidget.getUserData: method can be called after fired event - onBitrixLiveChat");return false}var i=["hash","name","lastName","avatar","email","www","gender","position"];if(!C.Utils.types.isPlainObject(e)){console.error("%cLiveChatWidget.setUserData: params is not a object","color: black;");return false}for(var s in this.userRegisterData){if(!this.userRegisterData.hasOwnProperty(s)){continue}if(!e[s]){delete this.userRegisterData[s]}}for(var o in e){if(!e.hasOwnProperty(o)){continue}if(i.indexOf(o)===-1){console.warn("%cLiveChatWidget.setUserData: user field is not set, because you are trying to set an unknown field (%c".concat(o,"%c)"),"color: black;","font-weight: bold; color: red","color: black");continue}this.userRegisterData[o]=e[o]}if(this.userRegisterData.hash&&this.getUserHash()&&this.userRegisterData.hash!==this.getUserHash()){this.setNewAuthToken(this.userRegisterData.hash)}}},{key:"setNewAuthToken",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";this.storeCollector.clearModelState();B.set(null,"LIVECHAT_HASH","",{expires:365*86400,path:"/"});this.restClient.setAuthId(H.guest,e)}},{key:"setCustomData",value:function t(e){if(!this.store){console.error("LiveChatWidget.getUserData: method can be called after fired event - onBitrixLiveChat");return false}var i=[];if(e instanceof Array){e.forEach(function(t){if(t&&babelHelpers.typeof(t)==="object"){i.push(t)}});if(i.length<=0){console.error("LiveChatWidget.setCustomData: params is empty");return false}}else{if(!e){return false}i=[{MESSAGE:e}]}this.customData=this.customData.concat(i);return true}},{key:"setError",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";console.error("LiveChatWidget.error: ".concat(e," (").concat(i,")"));var s="";if(e==="LIVECHAT_AUTH_FAILED"){s=this.getLocalize("BX_LIVECHAT_AUTH_FAILED").replace("#LINK_START#",'<a href="javascript:void();" onclick="location.reload()">').replace("#LINK_END#","</a>");this.setNewAuthToken()}else if(e==="LIVECHAT_AUTH_PORTAL_USER"){s=this.getLocalize("BX_LIVECHAT_PORTAL_USER_NEW").replace("#LINK_START#",'<a href="'+this.host+'">').replace("#LINK_END#","</a>")}else if(e.endsWith("LOCALIZED")){s=i}this.store.commit("application/set",{error:{active:true,code:e,description:s}})}},{key:"clearError",value:function t(){this.store.commit("application/set",{error:{active:false,code:"",description:""}})}},{key:"subscribe",value:function t(e){if(!C.Utils.types.isPlainObject(e)){console.error("%cLiveChatWidget.subscribe: params is not a object","color: black;");return false}if(!F.includes(e.type)){console.error("%cLiveChatWidget.subscribe: subscription type is not correct (%c".concat(e.type,"%c)"),"color: black;","font-weight: bold; color: red","color: black");return false}if(typeof e.callback!=="function"){console.error("%cLiveChatWidget.subscribe: callback is not a function (%c".concat(babelHelpers.typeof(e.callback),"%c)"),"color: black;","font-weight: bold; color: red","color: black");return false}if(typeof this.subscribers[e.type]==="undefined"){this.subscribers[e.type]=[]}this.subscribers[e.type].push(e.callback);return function(){this.subscribers[e.type]=this.subscribers[e.type].filter(function(t){return t!==e.callback})}.bind(this)}},{key:"sendEvent",value:function t(e){e=e||{};if(!e.type){return false}if(babelHelpers.typeof(e.data)!=="object"||!e.data){e.data={}}if(this.subscribers[e.type]instanceof Array&&this.subscribers[e.type].length>0){this.subscribers[e.type].forEach(function(t){return t(e.data)})}if(this.subscribers[S.every]instanceof Array&&this.subscribers[S.every].length>0){this.subscribers[S.every].forEach(function(t){return t({type:e.type,data:e.data})})}return true}},{key:"addLocalize",value:function t(e){if(babelHelpers.typeof(e)!=="object"||!e){return false}for(var i in e){if(e.hasOwnProperty(i)){this.localize[i]=e[i]}}return true}},{key:"getLocalize",value:function t(e){var i="";if(typeof e==="undefined"){return this.localize}else if(typeof this.localize[e.toString()]==="undefined"){console.warn("LiveChatWidget.getLocalize: message with code '".concat(e.toString(),"' is undefined."))}else{i=this.localize[e]}return i}}]);return t}();var W=function(){function t(e){babelHelpers.classCallCheck(this,t);this.developerInfo="Do not use private methods.";this.__privateMethods__=new X(e);this.__createLegacyMethods()}babelHelpers.createClass(t,[{key:"open",value:function t(e){return this.__privateMethods__.open(e)}},{key:"close",value:function t(){return this.__privateMethods__.close()}},{key:"showNotification",value:function t(e){return this.__privateMethods__.showNotification(e)}},{key:"getUserData",value:function t(){return this.__privateMethods__.getUserData()}},{key:"setUserRegisterData",value:function t(e){return this.__privateMethods__.setUserRegisterData(e)}},{key:"setCustomData",value:function t(e){return this.__privateMethods__.setCustomData(e)}},{key:"mutateTemplateComponent",value:function t(e,i){return this.__privateMethods__.mutateTemplateComponent(e,i)}},{key:"addLocalize",value:function t(e){return this.__privateMethods__.addLocalize(e)}},{key:"subscribe",value:function t(e){return this.__privateMethods__.subscribe(e)}},{key:"start",value:function t(){return this.__privateMethods__.start()}},{key:"__createLegacyMethods",value:function t(){var e=this;if(typeof window.BX.LiveChat==="undefined"){var i=document.createElement("a");i.href=this.__privateMethods__.host;var s=i.protocol+"//"+i.hostname+(i.port&&i.port!="80"&&i.port!="443"?":"+i.port:"");window.BX.LiveChat={openLiveChat:function t(){e.open({openFromButton:true})},closeLiveChat:function t(){e.close()},addEventListener:function t(i,o,a){if(o==="message"){e.subscribe({type:S.userMessage,callback:function t(e){a({origin:s,data:JSON.stringify({action:"sendMessage"}),event:e})}})}else{console.warn("Method BX.LiveChat.addEventListener is not supported, user new format for subscribe.")}},setCookie:function t(){},getCookie:function t(){},sourceDomain:s}}if(typeof window.BxLiveChatInit==="function"){var o=window.BxLiveChatInit();if(o.user){this.__privateMethods__.setUserRegisterData(o.user)}if(o.firstMessage){this.__privateMethods__.setCustomData(o.firstMessage)}}if(window.BxLiveChatLoader instanceof Array){window.BxLiveChatLoader.forEach(function(t){return t()})}return true}}]);return t}();I.Vue.component("bx-livechat",{data:function t(){return{viewPortMetaSiteNode:null,viewPortMetaWidgetNode:null,storedMessage:"",storedFile:null,textareaFocused:false,textareaDrag:false,textareaHeight:100,textareaMinimumHeight:100,textareaMaximumHeight:C.Utils.device.isMobile()?200:300}},created:function t(){this.onCreated();document.addEventListener("keydown",this.onWindowKeyDown);this.$root.$on("requestShowForm",this.onRequestShowForm)},beforeDestroy:function t(){document.removeEventListener("keydown",this.onWindowKeyDown);this.$root.$off("requestShowForm",this.onRequestShowForm);this.onTextareaDragEventRemove()},computed:babelHelpers.objectSpread({FormType:function t(){return L},VoteType:function t(){return _},DeviceType:function t(){return w.DeviceType},EventType:function t(){return w.EventType},textareaHeightStyle:function t(e){return"flex: 0 0 "+this.textareaHeight+"px;"},localize:function t(){return I.Vue.getFilteredPhrases("BX_LIVECHAT_",this.$root.$bitrixMessages)},widgetMobileDisabled:function t(e){if(e.application.device.type===w.DeviceType.mobile){if(navigator.userAgent.toString().includes("iPad"));else if(e.application.device.orientation===w.DeviceOrientation.horizontal){if(navigator.userAgent.toString().includes("iPhone")){return true}else{return!(babelHelpers.typeof(window.screen)==="object"&&window.screen.availHeight>=800)}}}return false},widgetClassName:function t(e){var i=["bx-livechat-wrapper"];i.push("bx-livechat-show");if(e.widget.common.pageMode){i.push("bx-livechat-page-mode")}else{i.push("bx-livechat-position-"+D[e.widget.common.location])}if(e.application.common.languageId===M.russian){i.push("bx-livechat-logo-ru")}else if(e.application.common.languageId===M.ukraine){i.push("bx-livechat-logo-ua")}else{i.push("bx-livechat-logo-en")}if(!e.widget.common.online){i.push("bx-livechat-offline-state")}if(e.widget.common.dragged){i.push("bx-livechat-drag-n-drop")}if(e.widget.common.dialogStart){i.push("bx-livechat-chat-start")}if(e.widget.dialog.operator.name&&!(e.application.device.type===w.DeviceType.mobile&&e.application.device.orientation===w.DeviceOrientation.horizontal)){i.push("bx-livechat-has-operator")}if(C.Utils.device.isMobile()){i.push("bx-livechat-mobile")}else if(C.Utils.browser.isSafari()){i.push("bx-livechat-browser-safari")}else if(C.Utils.browser.isIe()){i.push("bx-livechat-browser-ie")}if(C.Utils.platform.isMac()){i.push("bx-livechat-mac")}else{i.push("bx-livechat-custom-scroll")}if(e.widget.common.styles.backgroundColor&&C.Utils.isDarkColor(e.widget.common.styles.iconColor)){i.push("bx-livechat-bright-header")}return i.join(" ")},showMessageDialog:function t(){return this.messageCollection.length>0},quotePanelData:function t(){var e={id:0,title:"",description:"",color:""};if(!this.dialog.quoteId){return e}var i=this.$store.getters["messages/getMessage"](this.dialog.chatId,this.dialog.quoteId);if(!i){return e}var s=this.$store.getters["users/get"](i.authorId);e={id:this.dialog.quoteId,title:s?s.name:"",color:s?s.color:"",description:i.textConverted?i.textConverted:this.localize.BX_LIVECHAT_FILE_MESSAGE};return e}},T.Vuex.mapState({widget:function t(e){return e.widget},application:function t(e){return e.application},dialog:function t(e){return e.dialogues.collection[e.application.dialog.dialogId]},messageCollection:function t(e){return e.messages.collection[e.application.dialog.chatId]}})),watch:{sessionClose:function t(e){b.Logger.log("sessionClose change",e)}},methods:{close:function t(e){if(this.widget.common.pageMode){return false}this.onBeforeClose();this.$store.commit("widget/common",{showed:false})},showLikeForm:function t(){if(this.offline){return false}clearTimeout(this.showFormTimeout);if(!this.widget.common.vote.enable){return false}if(this.widget.dialog.sessionClose&&this.widget.dialog.userVote!==_.none){return false}this.$store.commit("widget/common",{showForm:L.like})},showWelcomeForm:function t(){clearTimeout(this.showFormTimeout);this.$store.commit("widget/common",{showForm:L.welcome})},showOfflineForm:function t(){clearTimeout(this.showFormTimeout);if(this.widget.dialog.showForm!==L.welcome){this.$store.commit("widget/common",{showForm:L.offline})}},showHistoryForm:function t(){clearTimeout(this.showFormTimeout);this.$store.commit("widget/common",{showForm:L.history})},hideForm:function t(){clearTimeout(this.showFormTimeout);if(this.widget.common.showForm!==L.none){this.$store.commit("widget/common",{showForm:L.none})}},showConsentWidow:function t(){this.$store.commit("widget/common",{showConsent:true})},agreeConsentWidow:function t(){this.$store.commit("widget/common",{showConsent:false});this.$root.$bitrixWidget.sendConsentDecision(true);if(this.storedMessage||this.storedFile){if(this.storedMessage){this.onTextareaSend({focus:this.application.device.type!==w.DeviceType.mobile});this.storedMessage=""}if(this.storedFile){this.onTextareaFileSelected();this.storedFile=""}}else if(this.widget.common.showForm===L.none){this.$root.$emit(w.EventType.textarea.focus)}},disagreeConsentWidow:function t(){this.$store.commit("widget/common",{showForm:L.none});this.$store.commit("widget/common",{showConsent:false});this.$root.$bitrixWidget.sendConsentDecision(false);if(this.storedMessage){this.$root.$emit(w.EventType.textarea.insertText,{text:this.storedMessage,focus:this.application.device.type!==w.DeviceType.mobile});this.storedMessage=""}if(this.storedFile){this.storedFile=""}if(this.application.device.type!==w.DeviceType.mobile){this.$root.$emit(w.EventType.textarea.focus)}},logEvent:function t(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++){s[o-1]=arguments[o]}b.Logger.info.apply(b.Logger,[e].concat(s))},onCreated:function t(){var e=this;if(C.Utils.device.isMobile()){var i=Array.from(document.head.getElementsByTagName("meta")).filter(function(t){return t.name==="viewport"})[0];if(i){this.viewPortMetaSiteNode=i;document.head.removeChild(this.viewPortMetaSiteNode)}else{var s=document.body.offsetWidth;if(s<window.innerWidth){s=window.innerWidth}if(s<1024){s=1024}this.viewPortMetaSiteNode=document.createElement("meta");this.viewPortMetaSiteNode.setAttribute("name","viewport");this.viewPortMetaSiteNode.setAttribute("content","width=".concat(s,", initial-scale=1.0, user-scalable=1"))}if(!this.viewPortMetaWidgetNode){this.viewPortMetaWidgetNode=document.createElement("meta");this.viewPortMetaWidgetNode.setAttribute("name","viewport");this.viewPortMetaWidgetNode.setAttribute("content","width=device-width, initial-scale=1.0, user-scalable=0");document.head.appendChild(this.viewPortMetaWidgetNode)}document.body.classList.add("bx-livechat-mobile-state");if(C.Utils.browser.isSafariBased()){document.body.classList.add("bx-livechat-mobile-safari-based")}setTimeout(function(){e.$store.commit("widget/common",{showed:true})},50)}else{this.$store.commit("widget/common",{showed:true})}this.textareaHeight=this.widget.common.textareaHeight||this.textareaHeight;this.$store.commit("files/initCollection",{chatId:this.$root.$bitrixWidget.getChatId()});this.$store.commit("messages/initCollection",{chatId:this.$root.$bitrixWidget.getChatId()});this.$store.commit("dialogues/initCollection",{dialogId:this.$root.$bitrixWidget.getDialogId(),fields:{entityType:"LIVECHAT",type:"livechat"}})},onBeforeClose:function t(){if(C.Utils.device.isMobile()){document.body.classList.remove("bx-livechat-mobile-state");if(C.Utils.browser.isSafariBased()){document.body.classList.remove("bx-livechat-mobile-safari-based")}if(this.viewPortMetaWidgetNode){document.head.removeChild(this.viewPortMetaWidgetNode);this.viewPortMetaWidgetNode=null}if(this.viewPortMetaSiteNode){document.head.appendChild(this.viewPortMetaSiteNode);this.viewPortMetaSiteNode=null}}},onAfterClose:function t(){this.$root.$bitrixWidget.close()},onRequestShowForm:function t(e){var i=this;clearTimeout(this.showFormTimeout);if(e.type===L.welcome){if(e.delayed){this.showFormTimeout=setTimeout(function(){i.showWelcomeForm()},5e3)}else{this.showWelcomeForm()}}else if(e.type===L.offline){if(e.delayed){this.showFormTimeout=setTimeout(function(){i.showOfflineForm()},3e3)}else{this.showOfflineForm()}}else if(e.type===L.like){if(e.delayed){this.showFormTimeout=setTimeout(function(){i.showLikeForm()},5e3)}else{this.showLikeForm()}}},onDialogRequestHistory:function t(e){this.$root.$bitrixWidget.getDialogHistory(e.lastId)},onDialogRequestUnread:function t(e){this.$root.$bitrixWidget.getDialogUnread(e.lastId)},onDialogMessageClickByUserName:function t(e){this.$root.$emit(w.EventType.textarea.insertText,{text:e.user.name+" "})},onDialogMessageClickByUploadCancel:function t(e){this.$root.$bitrixWidget.cancelUploadFile(e.file.id)},onDialogMessageClickByKeyboardButton:function t(e){this.$root.$bitrixWidget.execMessageKeyboardCommand(e)},onDialogMessageClickByCommand:function t(e){if(e.type==="put"){this.$root.$emit(w.EventType.textarea.insertText,{text:e.value+" "})}else if(e.type==="send"){this.$root.$bitrixWidget.addMessage(e.value)}else{b.Logger.warn("Unprocessed command",e)}},onDialogMessageMenuClick:function t(e){b.Logger.warn("Message menu:",e)},onDialogMessageRetryClick:function t(e){b.Logger.warn("Message retry:",e);this.$root.$bitrixWidget.retrySendMessage(e.message)},onDialogReadMessage:function t(e){this.$root.$bitrixWidget.readMessage(e.id)},onDialogQuoteMessage:function t(e){this.$root.$bitrixWidget.quoteMessage(e.message.id)},onDialogMessageReactionSet:function t(e){this.$root.$bitrixWidget.reactMessage(e.message.id,e.reaction)},onDialogClick:function t(e){if(this.widget.common.showForm!==L.none){this.$store.commit("widget/common",{showForm:L.none})}},onTextareaSend:function t(e){e.focus=e.focus!==false;if(this.widget.common.showForm===L.smile){this.$store.commit("widget/common",{showForm:L.none})}if(!this.widget.dialog.userConsent&&this.widget.common.consentUrl){if(e.text){this.storedMessage=e.text}this.showConsentWidow();return false}e.text=e.text?e.text:this.storedMessage;if(!e.text){return false}this.hideForm();this.$root.$bitrixWidget.addMessage(e.text);if(e.focus){this.$root.$emit(w.EventType.textarea.focus)}return true},onTextareaWrites:function t(e){this.$root.$bitrixController.startWriting()},onTextareaFocus:function t(e){var i=this;if(this.widget.common.copyright&&this.application.device.type===w.DeviceType.mobile){this.widget.common.copyright=false}if(C.Utils.device.isMobile()){clearTimeout(this.onTextareaFocusScrollTimeout);this.onTextareaFocusScrollTimeout=setTimeout(function(){document.addEventListener("scroll",i.onWindowScroll)},1e3)}this.textareaFocused=true},onTextareaBlur:function t(e){var i=this;if(!this.widget.common.copyright&&this.widget.common.copyright!==this.$root.$bitrixWidget.copyright){this.widget.common.copyright=this.$root.$bitrixWidget.copyright;this.$nextTick(function(){i.$root.$emit(w.EventType.dialog.scrollToBottom,{force:true})})}if(C.Utils.device.isMobile()){clearTimeout(this.onTextareaFocusScrollTimeout);document.removeEventListener("scroll",this.onWindowScroll)}this.textareaFocused=false},onTextareaStartDrag:function t(e){if(this.textareaDrag){return}b.Logger.log("Livechat: textarea drag started");this.textareaDrag=true;e=e.changedTouches?e.changedTouches[0]:e;this.textareaDragCursorStartPoint=e.clientY;this.textareaDragHeightStartPoint=this.textareaHeight;this.onTextareaDragEventAdd();this.$root.$emit(w.EventType.textarea.blur,true)},onTextareaContinueDrag:function t(e){if(!this.textareaDrag){return}e=e.changedTouches?e.changedTouches[0]:e;this.textareaDragCursorControlPoint=e.clientY;var i=Math.max(Math.min(this.textareaDragHeightStartPoint+this.textareaDragCursorStartPoint-this.textareaDragCursorControlPoint,this.textareaMaximumHeight),this.textareaMinimumHeight);b.Logger.log("Livechat: textarea drag","new: "+i,"curr: "+this.textareaHeight);if(this.textareaHeight!==i){this.textareaHeight=i}},onTextareaStopDrag:function t(){if(!this.textareaDrag){return}b.Logger.log("Livechat: textarea drag ended");this.textareaDrag=false;this.onTextareaDragEventRemove();this.$store.commit("widget/common",{textareaHeight:this.textareaHeight});this.$root.$emit(w.EventType.dialog.scrollToBottom,{force:true})},onTextareaDragEventAdd:function t(){document.addEventListener("mousemove",this.onTextareaContinueDrag);document.addEventListener("touchmove",this.onTextareaContinueDrag);document.addEventListener("touchend",this.onTextareaStopDrag);document.addEventListener("mouseup",this.onTextareaStopDrag);document.addEventListener("mouseleave",this.onTextareaStopDrag)},onTextareaDragEventRemove:function t(){document.removeEventListener("mousemove",this.onTextareaContinueDrag);document.removeEventListener("touchmove",this.onTextareaContinueDrag);document.removeEventListener("touchend",this.onTextareaStopDrag);document.removeEventListener("mouseup",this.onTextareaStopDrag);document.removeEventListener("mouseleave",this.onTextareaStopDrag)},onTextareaFileSelected:function t(e){var i=e&&e.fileInput?e.fileInput:this.storedFile;if(!i){return false}if(i.files[0].size>this.application.disk.maxFileSize){alert(this.localize.BX_LIVECHAT_FILE_SIZE_EXCEEDED.replace("#LIMIT#",Math.round(this.application.disk.maxFileSize/1024/1024)));return false}if(!this.widget.dialog.userConsent&&this.widget.common.consentUrl){this.storedFile=e.fileInput;this.showConsentWidow();return false}this.$root.$bitrixWidget.uploadFile(i)},onTextareaAppButtonClick:function t(e){if(e.appId===L.smile){if(this.widget.common.showForm===L.smile){this.$store.commit("widget/common",{showForm:L.none})}else{this.$store.commit("widget/common",{showForm:L.smile})}}else{this.$root.$emit(w.EventType.textarea.focus)}},onPullRequestConfig:function t(e){this.$root.$bitrixWidget.recoverPullConnection()},onSmilesSelectSmile:function t(e){this.$root.$emit(w.EventType.textarea.insertText,{text:e.text})},onSmilesSelectSet:function t(){this.$root.$emit(w.EventType.textarea.focus)},onQuotePanelClose:function t(){this.$root.$bitrixWidget.quoteMessageClear()},onWindowKeyDown:function t(e){if(e.keyCode===27){if(this.widget.common.showForm!==L.none){this.$store.commit("widget/common",{showForm:L.none})}else if(this.widget.common.showConsent){this.disagreeConsentWidow()}else{this.close()}e.preventDefault();e.stopPropagation();this.$root.$emit(w.EventType.textarea.focus)}},onWindowScroll:function t(e){var i=this;clearTimeout(this.onWindowScrollTimeout);this.onWindowScrollTimeout=setTimeout(function(){i.$root.$emit(w.EventType.textarea.blur,true)},50)}},template:'\n\t\t<transition enter-active-class="bx-livechat-show" leave-active-class="bx-livechat-close" @after-leave="onAfterClose">\n\t\t\t<div :class="widgetClassName" v-if="widget.common.showed">\n\t\t\t\t<div class="bx-livechat-box">\n\t\t\t\t\t<bx-livechat-head :isWidgetDisabled="widgetMobileDisabled" @like="showLikeForm" @history="showHistoryForm" @close="close"/>\n\t\t\t\t\t<template v-if="widgetMobileDisabled">\n\t\t\t\t\t\t<bx-livechat-body-orientation-disabled/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if="application.error.active">\n\t\t\t\t\t\t<bx-livechat-body-error/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if="!widget.common.configId">\n\t\t\t\t\t\t<div class="bx-livechat-body" key="loading-body">\n\t\t\t\t\t\t\t<bx-livechat-body-loading/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\t\t\t\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<template v-if="!widget.common.dialogStart">\n\t\t\t\t\t\t\t<div class="bx-livechat-body" key="welcome-body">\n\t\t\t\t\t\t\t\t<bx-livechat-body-operators/>\n\t\t\t\t\t\t\t\t<keep-alive include="bx-livechat-smiles">\n\t\t\t\t\t\t\t\t\t<template v-if="widget.common.showForm == FormType.smile">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-smiles @selectSmile="onSmilesSelectSmile" @selectSet="onSmilesSelectSet"/>\t\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</keep-alive>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else-if="widget.common.dialogStart">\n\t\t\t\t\t\t\t<bx-pull-status :canReconnect="true" @reconnect="onPullRequestConfig"/>\n\t\t\t\t\t\t\t<div :class="[\'bx-livechat-body\', {\'bx-livechat-body-with-message\': showMessageDialog}]" key="with-message">\n\t\t\t\t\t\t\t\t<template v-if="showMessageDialog">\n\t\t\t\t\t\t\t\t\t<div class="bx-livechat-dialog">\n\t\t\t\t\t\t\t\t\t\t<bx-messenger-dialog\n\t\t\t\t\t\t\t\t\t\t\t:userId="application.common.userId" \n\t\t\t\t\t\t\t\t\t\t\t:dialogId="application.dialog.dialogId"\n\t\t\t\t\t\t\t\t\t\t\t:chatId="application.dialog.chatId"\n\t\t\t\t\t\t\t\t\t\t\t:messageLimit="application.dialog.messageLimit"\n\t\t\t\t\t\t\t\t\t\t\t:messageExtraCount="application.dialog.messageExtraCount"\n\t\t\t\t\t\t\t\t\t\t\t:enableReactions="true"\n\t\t\t\t\t\t\t\t\t\t\t:enableDateActions="false"\n\t\t\t\t\t\t\t\t\t\t\t:enableCreateContent="false"\n\t\t\t\t\t\t\t\t\t\t\t:enableGestureQuote="true"\n\t\t\t\t\t\t\t\t\t\t\t:enableGestureMenu="true"\n\t\t\t\t\t\t\t\t\t\t\t:showMessageAvatar="false"\n\t\t\t\t\t\t\t\t\t\t\t:showMessageMenu="false"\n\t\t\t\t\t\t\t\t\t\t\t:listenEventScrollToBottom="EventType.dialog.scrollToBottom"\n\t\t\t\t\t\t\t\t\t\t\t:listenEventRequestHistory="EventType.dialog.requestHistoryResult"\n\t\t\t\t\t\t\t\t\t\t\t:listenEventRequestUnread="EventType.dialog.requestUnreadResult"\n\t\t\t\t\t\t\t\t\t\t\t@readMessage="onDialogReadMessage"\n\t\t\t\t\t\t\t\t\t\t\t@requestHistory="onDialogRequestHistory"\n\t\t\t\t\t\t\t\t\t\t\t@requestUnread="onDialogRequestUnread"\n\t\t\t\t\t\t\t\t\t\t\t@quoteMessage="onDialogQuoteMessage"\n\t\t\t\t\t\t\t\t\t\t\t@clickByCommand="onDialogMessageClickByCommand"\n\t\t\t\t\t\t\t\t\t\t\t@clickByUserName="onDialogMessageClickByUserName"\n\t\t\t\t\t\t\t\t\t\t\t@clickByUploadCancel="onDialogMessageClickByUploadCancel"\n\t\t\t\t\t\t\t\t\t\t\t@clickByKeyboardButton="onDialogMessageClickByKeyboardButton"\n\t\t\t\t\t\t\t\t\t\t\t@clickByMessageMenu="onDialogMessageMenuClick"\n\t\t\t\t\t\t\t\t\t\t\t@clickByMessageRetry="onDialogMessageRetryClick"\n\t\t\t\t\t\t\t\t\t\t\t@setMessageReaction="onDialogMessageReactionSet"\n\t\t\t\t\t\t\t\t\t\t\t@click="onDialogClick"\n\t\t\t\t\t\t\t\t\t\t />\n\t\t\t\t\t\t\t\t\t</div>\t \n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t<bx-livechat-body-loading/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<bx-messenger-quote-panel :id="quotePanelData.id" :title="quotePanelData.title" :description="quotePanelData.description" :color="quotePanelData.color" @close="onQuotePanelClose"/>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<keep-alive include="bx-livechat-smiles">\n\t\t\t\t\t\t\t\t\t<template v-if="widget.common.showForm == FormType.like && widget.common.vote.enable">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-vote/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widget.common.showForm == FormType.welcome">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-welcome/>\t\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widget.common.showForm == FormType.offline">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-offline/>\t\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widget.common.showForm == FormType.history">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-history/>\t\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widget.common.showForm == FormType.smile">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-smiles @selectSmile="onSmilesSelectSmile" @selectSet="onSmilesSelectSet"/>\t\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</keep-alive>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\t\n\t\t\t\t\t\t<div class="bx-livechat-textarea" :style="textareaHeightStyle" ref="textarea">\n\t\t\t\t\t\t\t<div class="bx-livechat-textarea-resize-handle" @mousedown="onTextareaStartDrag" @touchstart="onTextareaStartDrag"></div>\n\t\t\t\t\t\t\t<bx-messenger-textarea\n\t\t\t\t\t\t\t\t:siteId="application.common.siteId"\n\t\t\t\t\t\t\t\t:userId="application.common.userId"\n\t\t\t\t\t\t\t\t:dialogId="application.dialog.dialogId"\n\t\t\t\t\t\t\t\t:writesEventLetter="3"\n\t\t\t\t\t\t\t\t:enableEdit="true"\n\t\t\t\t\t\t\t\t:enableCommand="false"\n\t\t\t\t\t\t\t\t:enableMention="false"\n\t\t\t\t\t\t\t\t:enableFile="application.disk.enabled"\n\t\t\t\t\t\t\t\t:autoFocus="application.device.type !== DeviceType.mobile"\n\t\t\t\t\t\t\t\t:styles="{button: {backgroundColor: widget.common.styles.backgroundColor, iconColor: widget.common.styles.iconColor}}"\n\t\t\t\t\t\t\t\t:listenEventInsertText="EventType.textarea.insertText"\n\t\t\t\t\t\t\t\t:listenEventFocus="EventType.textarea.focus"\n\t\t\t\t\t\t\t\t:listenEventBlur="EventType.textarea.blur"\n\t\t\t\t\t\t\t\t@writes="onTextareaWrites" \n\t\t\t\t\t\t\t\t@send="onTextareaSend" \n\t\t\t\t\t\t\t\t@focus="onTextareaFocus" \n\t\t\t\t\t\t\t\t@blur="onTextareaBlur" \n\t\t\t\t\t\t\t\t@edit="logEvent(\'edit message\', $event)"\n\t\t\t\t\t\t\t\t@fileSelected="onTextareaFileSelected"\n\t\t\t\t\t\t\t\t@appButtonClick="onTextareaAppButtonClick"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<bx-livechat-form-consent @agree="agreeConsentWidow" @disagree="disagreeConsentWidow"/>\n\t\t\t\t\t\t<template v-if="widget.common.copyright">\n\t\t\t\t\t\t\t<bx-livechat-footer/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t'});I.Vue.component("bx-livechat-body-error",{computed:babelHelpers.objectSpread({localize:function t(){return Object.freeze({BX_LIVECHAT_ERROR_TITLE:this.$root.$bitrixMessages.BX_LIVECHAT_ERROR_TITLE,BX_LIVECHAT_ERROR_DESC:this.$root.$bitrixMessages.BX_LIVECHAT_ERROR_DESC})}},T.Vuex.mapState({application:function t(e){return e.application}})),template:'\n\t\t<div class="bx-livechat-body" key="error-body">\n\t\t\t<div class="bx-livechat-warning-window">\n\t\t\t\t<div class="bx-livechat-warning-icon"></div>\n\t\t\t\t<template v-if="application.error.description"> \n\t\t\t\t\t<div class="bx-livechat-help-title bx-livechat-help-title-sm bx-livechat-warning-msg" v-html="application.error.description"></div>\n\t\t\t\t</template> \n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class="bx-livechat-help-title bx-livechat-help-title-md bx-livechat-warning-msg">{{localize.BX_LIVECHAT_ERROR_TITLE}}</div>\n\t\t\t\t\t<div class="bx-livechat-help-title bx-livechat-help-title-sm bx-livechat-warning-msg">{{localize.BX_LIVECHAT_ERROR_DESC}}</div>\n\t\t\t\t</template> \n\t\t\t</div>\n\t\t</div>\n\t'});I.Vue.component("bx-livechat-head",{props:{isWidgetDisabled:{default:false}},methods:{close:function t(e){this.$emit("close")},like:function t(e){this.$emit("like")},history:function t(e){this.$emit("history")}},computed:babelHelpers.objectSpread({VoteType:function t(){return _},customBackgroundStyle:function t(e){return e.widget.common.styles.backgroundColor?"background-color: "+e.widget.common.styles.backgroundColor+"!important;":""},customBackgroundOnlineStyle:function t(e){return e.widget.common.styles.backgroundColor?"border-color: "+e.widget.common.styles.backgroundColor+"!important;":""},showName:function t(e){return e.widget.dialog.operator.firstName||e.widget.dialog.operator.lastName},voteActive:function t(e){if(!e.widget.common.vote.beforeFinish&&e.widget.dialog.sessionStatus<$.waitClient){return false}if(!e.widget.dialog.sessionClose||e.widget.dialog.sessionClose&&e.widget.dialog.userVote===_.none){return true}if(e.widget.dialog.sessionClose&&e.widget.dialog.userVote!==_.none){return true}return false},localize:function t(){return I.Vue.getFilteredPhrases("BX_LIVECHAT_",this.$root.$bitrixMessages)}},T.Vuex.mapState({widget:function t(e){return e.widget},application:function t(e){return e.application}})),watch:{showName:function t(e){var i=this;if(e){setTimeout(function(){i.$root.$emit(w.EventType.dialog.scrollToBottom)},300)}}},template:'\n\t\t<div class="bx-livechat-head-wrap">\n\t\t\t<template v-if="isWidgetDisabled">\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<div class="bx-livechat-title">{{widget.common.configName || localize.BX_LIVECHAT_TITLE}}</div>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<button v-if="!widget.common.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\t\n\t\t\t</template>\n\t\t\t<template v-else-if="application.error.active">\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<div class="bx-livechat-title">{{widget.common.configName || localize.BX_LIVECHAT_TITLE}}</div>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<button v-if="!widget.common.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else-if="!widget.common.configId">\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<div class="bx-livechat-title">{{widget.common.configName || localize.BX_LIVECHAT_TITLE}}</div>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<button v-if="!widget.common.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\t\t\t\n\t\t\t<template v-else>\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<template v-if="!showName">\n\t\t\t\t\t\t<div class="bx-livechat-title">{{widget.common.configName || localize.BX_LIVECHAT_TITLE}}</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<div class="bx-livechat-user bx-livechat-status-online">\n\t\t\t\t\t\t\t<template v-if="widget.dialog.operator.avatar">\n\t\t\t\t\t\t\t\t<div class="bx-livechat-user-icon" :style="\'background-image: url(\'+encodeURI(widget.dialog.operator.avatar)+\')\'">\n\t\t\t\t\t\t\t\t\t<div v-if="widget.dialog.operator.online" class="bx-livechat-user-status" :style="customBackgroundOnlineStyle"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class="bx-livechat-user-icon">\n\t\t\t\t\t\t\t\t\t<div v-if="widget.dialog.operator.online" class="bx-livechat-user-status" :style="customBackgroundOnlineStyle"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-livechat-user-info">\n\t\t\t\t\t\t\t<div class="bx-livechat-user-name">{{widget.dialog.operator.firstName? widget.dialog.operator.firstName: widget.dialog.operator.name}}</div>\n\t\t\t\t\t\t\t<div class="bx-livechat-user-position">{{widget.dialog.operator.workPosition? widget.dialog.operator.workPosition: localize.BX_LIVECHAT_USER}}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<span class="bx-livechat-control-box-active" v-if="widget.common.dialogStart && widget.dialog.sessionId">\n\t\t\t\t\t\t\t<button v-if="widget.common.vote.enable && voteActive" :class="\'bx-livechat-control-btn bx-livechat-control-btn-like bx-livechat-dialog-vote-\'+(widget.dialog.userVote)" :title="localize.BX_LIVECHAT_VOTE_BUTTON" @click="like"></button>\n\t\t\t\t\t\t\t<button class="bx-livechat-control-btn bx-livechat-control-btn-mail" :title="localize.BX_LIVECHAT_MAIL_BUTTON_NEW" @click="history"></button>\n\t\t\t\t\t\t</span>\t\n\t\t\t\t\t\t<button v-if="!widget.common.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t'});I.Vue.component("bx-livechat-body-loading",{computed:{localize:function t(){return Object.freeze({BX_LIVECHAT_LOADING:this.$root.$bitrixMessages.BX_LIVECHAT_LOADING})}},template:'\n\t\t<div class="bx-livechat-loading-window">\n\t\t\t<svg class="bx-livechat-loading-circular" viewBox="25 25 50 50">\n\t\t\t\t<circle class="bx-livechat-loading-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>\n\t\t\t\t<circle class="bx-livechat-loading-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>\n\t\t\t</svg>\n\t\t\t<h3 class="bx-livechat-help-title bx-livechat-help-title-md bx-livechat-loading-msg">{{localize.BX_LIVECHAT_LOADING}}</h3>\n\t\t</div>\n\t'});I.Vue.component("bx-livechat-body-operators",{computed:babelHelpers.objectSpread({localize:function t(){return I.Vue.getFilteredPhrases("BX_LIVECHAT_",this.$root.$bitrixMessages)}},T.Vuex.mapState({widget:function t(e){return e.widget}})),template:'\n\t\t<div class="bx-livechat-help-container">\n\t\t\t<transition name="bx-livechat-animation-fade">\n\t\t\t\t<h2 v-if="widget.common.online" key="online" class="bx-livechat-help-title bx-livechat-help-title-lg">{{widget.common.textMessages.bxLivechatOnlineLine1}}<div class="bx-livechat-help-subtitle">{{widget.common.textMessages.bxLivechatOnlineLine2}}</div></h2>\n\t\t\t\t<h2 v-else key="offline" class="bx-livechat-help-title bx-livechat-help-title-sm">{{widget.common.textMessages.bxLivechatOffline}}</h2>\n\t\t\t</transition>\t\n\t\t\t<div class="bx-livechat-help-user">\n\t\t\t\t<template v-for="operator in widget.common.operators">\n\t\t\t\t\t<div class="bx-livechat-user" :key="operator.id">\n\t\t\t\t\t\t<template v-if="operator.avatar">\n\t\t\t\t\t\t\t<div class="bx-livechat-user-icon" :style="\'background-image: url(\'+encodeURI(operator.avatar)+\')\'"></div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class="bx-livechat-user-icon"></div>\n\t\t\t\t\t\t</template>\t\n\t\t\t\t\t\t<div class="bx-livechat-user-info">\n\t\t\t\t\t\t\t<div class="bx-livechat-user-name">{{operator.firstName? operator.firstName: operator.name}}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\t\n\t\t\t</div>\n\t\t</div>\n\t'});I.Vue.component("bx-livechat-body-orientation-disabled",{computed:{localize:function t(){return Object.freeze({BX_LIVECHAT_MOBILE_ROTATE:this.$root.$bitrixMessages.BX_LIVECHAT_MOBILE_ROTATE})}},template:'\n\t\t<div class="bx-livechat-body" key="orientation-head">\n\t\t\t<div class="bx-livechat-mobile-orientation-box">\n\t\t\t\t<div class="bx-livechat-mobile-orientation-icon"></div>\n\t\t\t\t<div class="bx-livechat-mobile-orientation-text">{{localize.BX_LIVECHAT_MOBILE_ROTATE}}</div>\n\t\t\t</div>\n\t\t</div>\n\t'});I.Vue.component("bx-livechat-form-consent",{computed:babelHelpers.objectSpread({localize:function t(){return I.Vue.getFilteredPhrases("BX_LIVECHAT_",this.$root.$bitrixMessages)}},T.Vuex.mapState({widget:function t(e){return e.widget}})),methods:{agree:function t(e){this.$emit("agree",{event:e})},disagree:function t(e){this.$emit("disagree",{event:e})},onShow:function t(e,i){e.classList.add("bx-livechat-consent-window-show");i()},onHide:function t(e,i){e.classList.remove("bx-livechat-consent-window-show");e.classList.add("bx-livechat-consent-window-close");setTimeout(function(){i()},400)},onKeyDown:function t(e){if(e.keyCode==9){if(e.target===this.$refs.iframe){if(e.shiftKey){this.$refs.cancel.focus()}else{this.$refs.success.focus()}}else if(e.target===this.$refs.success){if(e.shiftKey){this.$refs.iframe.focus()}else{this.$refs.cancel.focus()}}else if(e.target===this.$refs.cancel){if(e.shiftKey){this.$refs.success.focus()}else{this.$refs.iframe.focus()}}e.preventDefault()}else if(e.keyCode==39||e.keyCode==37){if(e.target.nextElementSibling){e.target.nextElementSibling.focus()}else if(e.target.previousElementSibling){e.target.previousElementSibling.focus()}e.preventDefault()}}},directives:{focus:{inserted:function t(e,i){e.focus()}}},template:'\n\t\t<transition @enter="onShow" @leave="onHide">\n\t\t\t<template v-if="widget.common.showConsent && widget.common.consentUrl">\n\t\t\t\t<div class="bx-livechat-consent-window">\n\t\t\t\t\t<div class="bx-livechat-consent-window-title">{{localize.BX_LIVECHAT_CONSENT_TITLE}}</div>\n\t\t\t\t\t<div class="bx-livechat-consent-window-content">\n\t\t\t\t\t\t<iframe class="bx-livechat-consent-window-content-iframe" ref="iframe" frameborder="0" marginheight="0"  marginwidth="0" allowtransparency="allow-same-origin" seamless="true" :src="widget.common.consentUrl" @keydown="onKeyDown"></iframe>\n\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\n\t\t\t\t\t<div class="bx-livechat-consent-window-btn-box">\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-success" ref="success" @click="agree" @keydown="onKeyDown" v-focus>{{localize.BX_LIVECHAT_CONSENT_AGREE}}</button>\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-cancel" ref="cancel" @click="disagree" @keydown="onKeyDown">{{localize.BX_LIVECHAT_CONSENT_DISAGREE}}</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</transition>\n\t'});I.Vue.component("bx-livechat-form-history",{data:function t(){return{fieldEmail:""}},watch:{fieldEmail:function t(e){clearTimeout(this.fieldEmailTimeout);this.fieldEmailTimeout=setTimeout(this.checkEmailField,300)}},computed:babelHelpers.objectSpread({localize:function t(){return I.Vue.getFilteredPhrases("BX_LIVECHAT_",this.$root.$bitrixMessages)}},T.Vuex.mapState({widget:function t(e){return e.widget}})),created:function t(){this.fieldEmail=""+this.widget.user.email},methods:{formShowed:function t(){if(!C.Utils.platform.isMobile()){this.$refs.emailInput.focus()}},sendForm:function t(){var e=this.checkEmailField()?this.fieldEmail:"";if(e){this.$root.$bitrixWidget.sendForm(L.history,{email:e})}this.hideForm()},hideForm:function t(e){clearTimeout(this.fieldEmailTimeout);this.$parent.hideForm()},onFieldEnterPress:function t(e){this.sendForm();e.preventDefault()},checkEmailField:function t(){if(this.fieldEmail.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){if(this.$refs.email){this.$refs.email.classList.remove("ui-ctl-danger")}return true}else{if(document.activeElement!==this.$refs.emailInput){if(this.$refs.email){this.$refs.email.classList.add("ui-ctl-danger")}}return false}}},template:'\n\t\t<transition enter-active-class="bx-livechat-consent-window-show" leave-active-class="bx-livechat-form-close" @after-enter="formShowed">\n\t\t\t<div class="bx-livechat-alert-box bx-livechat-form-show" key="welcome">\t\n\t\t\t\t<div class="bx-livechat-alert-close" @click="hideForm"></div>\n\t\t\t\t<div class="bx-livechat-alert-form-box">\n\t\t\t\t\t<h4 class="bx-livechat-alert-title bx-livechat-alert-title-sm">{{localize.BX_LIVECHAT_MAIL_TITLE_NEW}}</h4>\n\t\t\t\t\t<div class="bx-livechat-form-item ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-lg" ref="email">\n\t\t\t\t\t   <div class="ui-ctl-after ui-ctl-icon-mail bx-livechat-form-icon" :title="localize.BX_LIVECHAT_FIELD_MAIL_TOOLTIP"></div>\n\t\t\t\t\t   <input type="text" class="ui-ctl-element ui-ctl-textbox" :placeholder="localize.BX_LIVECHAT_FIELD_MAIL" v-model="fieldEmail" ref="emailInput" @blur="checkEmailField" @keydown.enter="onFieldEnterPress">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bx-livechat-btn-box">\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-success" @click="sendForm">{{localize.BX_LIVECHAT_MAIL_BUTTON_NEW}}</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\t\n\t\t</transition>\t\n\t'});I.Vue.cloneComponent("bx-livechat-form-offline","bx-livechat-form-welcome",{methods:{formShowed:function t(){if(!C.Utils.platform.isMobile()){this.$refs.emailInput.focus()}},sendForm:function t(){var e=this.fieldName;var i=this.checkEmailField()?this.fieldEmail:"";var s=this.checkPhoneField()?this.fieldPhone:"";if(e||i||s){this.$root.$bitrixWidget.sendForm(L.offline,{name:e,email:i,phone:s})}this.hideForm()},onFieldEnterPress:function t(e){if(e.target===this.$refs.emailInput){this.showFullForm();this.$refs.phoneInput.focus()}else if(e.target===this.$refs.phoneInput){this.$refs.nameInput.focus()}else{this.sendForm()}e.preventDefault()}},watch:{fieldName:function t(){clearTimeout(this.fieldNameTimeout);this.fieldNameTimeout=setTimeout(this.checkNameField,300)},fieldEmail:function t(){clearTimeout(this.showFormTimeout);this.showFormTimeout=setTimeout(this.showFullForm,1e3);clearTimeout(this.fieldEmailTimeout);this.fieldEmailTimeout=setTimeout(this.checkEmailField,300)}},template:'\n\t\t<transition enter-active-class="bx-livechat-consent-window-show" leave-active-class="bx-livechat-form-close" @after-enter="formShowed">\n\t\t\t<div class="bx-livechat-alert-box bx-livechat-form-show" key="welcome">\t\n\t\t\t\t<div class="bx-livechat-alert-close" @click="hideForm"></div>\n\t\t\t\t<div class="bx-livechat-alert-form-box">\n\t\t\t\t\t<h4 class="bx-livechat-alert-title bx-livechat-alert-title-sm">{{localize.BX_LIVECHAT_OFFLINE_TITLE}}</h4>\n\t\t\t\t\t<div class="bx-livechat-form-item ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-lg" ref="email">\n\t\t\t\t\t   <div class="ui-ctl-after ui-ctl-icon-mail bx-livechat-form-icon" :title="localize.BX_LIVECHAT_FIELD_MAIL_TOOLTIP"></div>\n\t\t\t\t\t   <input type="text" class="ui-ctl-element ui-ctl-textbox" :placeholder="localize.BX_LIVECHAT_FIELD_MAIL" v-model="fieldEmail" ref="emailInput" @blur="checkEmailField" @keydown.enter="onFieldEnterPress">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div :class="[\'bx-livechat-form-short\', {\n\t\t\t\t\t\t\'bx-livechat-form-full\': isFullForm,\n\t\t\t\t\t}]">\n\t\t\t\t\t\t<div class="bx-livechat-form-item ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-lg" ref="phone">\n\t\t\t\t\t\t   <div class="ui-ctl-after ui-ctl-icon-phone bx-livechat-form-icon" :title="localize.BX_LIVECHAT_FIELD_PHONE_TOOLTIP"></div>\n\t\t\t\t\t\t   <input type="text" class="ui-ctl-element ui-ctl-textbox" :placeholder="localize.BX_LIVECHAT_FIELD_PHONE" v-model="fieldPhone" ref="phoneInput" @blur="checkPhoneField" @keydown.enter="onFieldEnterPress">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-livechat-form-item ui-ctl ui-ctl-w100 ui-ctl-lg" ref="name">\n\t\t\t\t\t\t   <input type="text" class="ui-ctl-element ui-ctl-textbox" :placeholder="localize.BX_LIVECHAT_FIELD_NAME" v-model="fieldName" ref="nameInput" @blur="checkNameField" @keydown.enter="onFieldEnterPress"  @keydown.tab="onFieldEnterPress">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-livechat-btn-box">\n\t\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-success" @click="sendForm">{{localize.BX_LIVECHAT_ABOUT_SEND}}</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\t\n\t\t</transition>\t\n\t'});I.Vue.component("bx-livechat-form-vote",{computed:babelHelpers.objectSpread({VoteType:function t(){return _},localize:function t(){return I.Vue.getFilteredPhrases("BX_LIVECHAT_",this.$root.$bitrixMessages)}},T.Vuex.mapState({widget:function t(e){return e.widget}})),methods:{userVote:function t(e){this.$store.commit("widget/common",{showForm:L.none});this.$store.commit("widget/dialog",{userVote:e});this.$root.$bitrixWidget.sendDialogVote(e)},hideForm:function t(e){this.$parent.hideForm()}},template:'\n\t\t<transition enter-active-class="bx-livechat-consent-window-show" leave-active-class="bx-livechat-form-close">\n\t\t\t<div class="bx-livechat-alert-box bx-livechat-form-rate-show" key="vote">\n\t\t\t\t<div class="bx-livechat-alert-close" @click="hideForm"></div>\n\t\t\t\t<div class="bx-livechat-alert-rate-box">\n\t\t\t\t\t<h4 class="bx-livechat-alert-title bx-livechat-alert-title-mdl">{{widget.common.vote.messageText}}</h4>\n\t\t\t\t\t<div class="bx-livechat-btn-box">\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-like" @click="userVote(VoteType.like)" :title="widget.common.vote.messageLike"></button>\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-dislike" @click="userVote(VoteType.dislike)" :title="widget.common.vote.messageDislike"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\t\n\t'});I.Vue.component("bx-livechat-form-welcome",{data:function t(){return{fieldName:"",fieldEmail:"",fieldPhone:"",isFullForm:C.Utils.platform.isMobile()}},watch:{fieldName:function t(){clearTimeout(this.showFormTimeout);this.showFormTimeout=setTimeout(this.showFullForm,1e3);clearTimeout(this.fieldNameTimeout);this.fieldNameTimeout=setTimeout(this.checkNameField,300)},fieldEmail:function t(e){clearTimeout(this.fieldEmailTimeout);this.fieldEmailTimeout=setTimeout(this.checkEmailField,300)},fieldPhone:function t(e){clearTimeout(this.fieldPhoneTimeout);this.fieldPhoneTimeout=setTimeout(this.checkPhoneField,300)}},computed:babelHelpers.objectSpread({localize:function t(){return I.Vue.getFilteredPhrases("BX_LIVECHAT_",this.$root.$bitrixMessages)}},T.Vuex.mapState({widget:function t(e){return e.widget}})),created:function t(){this.fieldName=""+this.widget.user.name;this.fieldEmail=""+this.widget.user.email;this.fieldPhone=""+this.widget.user.phone},methods:{formShowed:function t(){if(!C.Utils.platform.isMobile()){this.$refs.nameInput.focus()}},showFullForm:function t(){clearTimeout(this.showFormTimeout);this.isFullForm=true},sendForm:function t(){var e=this.fieldName;var i=this.checkEmailField()?this.fieldEmail:"";var s=this.checkPhoneField()?this.fieldPhone:"";if(e||i||s){this.$root.$bitrixWidget.sendForm(L.welcome,{name:e,email:i,phone:s})}this.hideForm()},hideForm:function t(e){clearTimeout(this.showFormTimeout);clearTimeout(this.fieldNameTimeout);clearTimeout(this.fieldEmailTimeout);clearTimeout(this.fieldPhoneTimeout);this.$parent.hideForm()},onFieldEnterPress:function t(e){if(e.target===this.$refs.nameInput){this.showFullForm();this.$refs.emailInput.focus()}else if(e.target===this.$refs.emailInput){this.$refs.phoneInput.focus()}else{this.sendForm()}e.preventDefault()},checkNameField:function t(){if(this.fieldName.length>0){if(this.$refs.name){this.$refs.name.classList.remove("ui-ctl-danger")}return true}else{if(document.activeElement!==this.$refs.nameInput){if(this.$refs.name){this.$refs.name.classList.add("ui-ctl-danger")}}return false}},checkEmailField:function t(){if(this.fieldEmail.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){if(this.$refs.email){this.$refs.email.classList.remove("ui-ctl-danger")}return true}else{if(document.activeElement!==this.$refs.emailInput){if(this.$refs.email){this.$refs.email.classList.add("ui-ctl-danger")}}return false}},checkPhoneField:function t(){if(this.fieldPhone.match(/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){10,14}(\s*)?$/)){if(this.$refs.phone){this.$refs.phone.classList.remove("ui-ctl-danger")}return true}else{if(document.activeElement!==this.$refs.phoneInput){if(this.$refs.phone){this.$refs.phone.classList.add("ui-ctl-danger")}}return false}}},template:'\n\t\t<transition enter-active-class="bx-livechat-consent-window-show" leave-active-class="bx-livechat-form-close" @after-enter="formShowed">\n\t\t\t<div class="bx-livechat-alert-box bx-livechat-form-show" key="welcome">\t\n\t\t\t\t<div class="bx-livechat-alert-close" @click="hideForm"></div>\n\t\t\t\t<div class="bx-livechat-alert-form-box">\n\t\t\t\t\t<h4 class="bx-livechat-alert-title bx-livechat-alert-title-sm">{{localize.BX_LIVECHAT_ABOUT_TITLE}}</h4>\n\t\t\t\t\t<div class="bx-livechat-form-item ui-ctl ui-ctl-w100 ui-ctl-lg" ref="name">\n\t\t\t\t\t   <input type="text" class="ui-ctl-element ui-ctl-textbox" :placeholder="localize.BX_LIVECHAT_FIELD_NAME" v-model="fieldName" ref="nameInput" @blur="checkNameField" @keydown.enter="onFieldEnterPress"  @keydown.tab="onFieldEnterPress">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div :class="[\'bx-livechat-form-short\', {\n\t\t\t\t\t\t\'bx-livechat-form-full\': isFullForm,\n\t\t\t\t\t}]">\n\t\t\t\t\t\t<div class="bx-livechat-form-item ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-lg" ref="email">\n\t\t\t\t\t\t   <div class="ui-ctl-after ui-ctl-icon-mail bx-livechat-form-icon" :title="localize.BX_LIVECHAT_FIELD_MAIL_TOOLTIP"></div>\n\t\t\t\t\t\t   <input type="text" class="ui-ctl-element ui-ctl-textbox" :placeholder="localize.BX_LIVECHAT_FIELD_MAIL" v-model="fieldEmail" ref="emailInput" @blur="checkEmailField" @keydown.enter="onFieldEnterPress">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-livechat-form-item ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-lg" ref="phone">\n\t\t\t\t\t\t   <div class="ui-ctl-after ui-ctl-icon-phone bx-livechat-form-icon" :title="localize.BX_LIVECHAT_FIELD_PHONE_TOOLTIP"></div>\n\t\t\t\t\t\t   <input type="text" class="ui-ctl-element ui-ctl-textbox" :placeholder="localize.BX_LIVECHAT_FIELD_PHONE" v-model="fieldPhone" ref="phoneInput" @blur="checkPhoneField" @keydown.enter="onFieldEnterPress">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-livechat-btn-box">\n\t\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-success" @click="sendForm">{{localize.BX_LIVECHAT_ABOUT_SEND}}</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\t\n\t\t</transition>\t\n\t'});I.Vue.cloneComponent("bx-livechat-smiles","bx-smiles",{methods:{hideForm:function t(e){this.$parent.hideForm()}},template:'\n\t\t<transition enter-active-class="bx-livechat-consent-window-show" leave-active-class="bx-livechat-form-close">\n\t\t\t<div class="bx-livechat-alert-box bx-livechat-alert-box-zero-padding bx-livechat-form-show" key="vote">\n\t\t\t\t<div class="bx-livechat-alert-close" @click="hideForm"></div>\n\t\t\t\t<div class="bx-livechat-alert-smiles-box">\n\t\t\t\t\t#PARENT_TEMPLATE#\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t'});I.Vue.component("bx-livechat-footer",{computed:babelHelpers.objectSpread({localize:function t(){return I.Vue.getFilteredPhrases("BX_LIVECHAT_COPYRIGHT_",this.$root.$bitrixMessages)}},T.Vuex.mapState({widget:function t(e){return e.widget}})),template:'\n\t\t<div class="bx-livechat-copyright">\t\n\t\t\t<template v-if="widget.common.copyrightUrl">\n\t\t\t\t<a :href="widget.common.copyrightUrl" target="_blank">\n\t\t\t\t\t<span class="bx-livechat-logo-name">{{localize.BX_LIVECHAT_COPYRIGHT_TEXT}}</span>\n\t\t\t\t\t<span class="bx-livechat-logo-icon"></span>\n\t\t\t\t</a>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<span class="bx-livechat-logo-name">{{localize.BX_LIVECHAT_COPYRIGHT_TEXT}}</span>\n\t\t\t\t<span class="bx-livechat-logo-icon"></span>\n\t\t\t</template>\n\t\t</div>\n\t'});BX.LiveChatWidget=W;BX.LiveChatWidget.VoteType=_;BX.LiveChatWidget.SubscriptionType=S;BX.LiveChatWidget.LocationStyle=D;BX.LiveChatWidget.Cookie=B;window.dispatchEvent(new CustomEvent("onBitrixLiveChatSourceLoaded",{detail:{}}))})(this.window=this.window||{},BX,window,window,window,window,window,window,window,BX,BX,BX,BX,BX.Messenger.Model,BX.Messenger.Controller,BX.Messenger,BX.Messenger.Provider.Pull,BX.Messenger.Provider.Pull,BX.Messenger,BX.Messenger.Const,BX,BX,BX.Messenger,BX,BX);
//# sourceMappingURL=widget.bundle.map.js