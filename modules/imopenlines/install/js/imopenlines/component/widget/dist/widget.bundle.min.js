(function(e,t,i,o,n,s,r,a,l,c,d,h,u,g,p,f,m,v,b,w,y,C,S,x,I,E,H){"use strict";
/**
	 * Bitrix OpenLines widget
	 * Widget constants
	 *
	 * @package bitrix
	 * @subpackage imopenlines
	 * @copyright 2001-2019 Bitrix
	 */function k(e){var t=[];for(var i in e){if(e.hasOwnProperty(i)){t.push(e[i])}}return t}var M=Object.freeze({none:"none",like:"like",dislike:"dislike"});var L=Object.freeze({russian:"ru",ukraine:"ua",world:"en"});var T=Object.freeze({none:"none",like:"like",smile:"smile",consent:"consent",welcome:"welcome",offline:"offline",history:"history"});var D=Object.freeze({topLeft:1,topMiddle:2,topBottom:3,bottomLeft:6,bottomMiddle:5,bottomRight:4});var O=Object.freeze({1:"top-left",2:"top-center",3:"top-right",6:"bottom-left",5:"bottom-center",4:"bottom-right"});var _=Object.freeze({width:435,height:557});var P=Object.freeze({width:340,height:435});var A=Object.freeze({configLoaded:"configLoaded",widgetOpen:"widgetOpen",widgetClose:"widgetClose",sessionStart:"sessionStart",sessionOperatorChange:"sessionOperatorChange",sessionFinish:"sessionFinish",operatorMessage:"operatorMessage",userForm:"userForm",userMessage:"userMessage",userFile:"userFile",userVote:"userVote",every:"every"});var R=k(A);var F=Object.freeze({widgetUserRegister:"imopenlines.widget.user.register",widgetChatCreate:"imopenlines.widget.chat.create",widgetConfigGet:"imopenlines.widget.config.get",widgetDialogGet:"imopenlines.widget.dialog.get",widgetDialogList:"imopenlines.widget.dialog.list",widgetUserGet:"imopenlines.widget.user.get",widgetUserConsentApply:"imopenlines.widget.user.consent.apply",widgetVoteSend:"imopenlines.widget.vote.send",widgetActionSend:"imopenlines.widget.action.send",pullServerTime:"server.time",pullConfigGet:"pull.config.get"});var B=k(F);var W=Object.freeze({guest:"guest"});var U=Object.freeze({new:0,skip:5,answer:10,client:20,clientAfterOperator:25,operator:40,waitClient:50,close:60,spam:65,duplicate:69,silentlyClose:75});var N=Object.freeze({showForm:"IMOL.Widget:showForm",hideForm:"IMOL.Widget:hideForm",processMessagesToSendQueue:"IMOL.Widget:processMessagesToSendQueue",requestData:"IMOL.Widget:requestData",showConsent:"IMOL.Widget:showConsent",acceptConsent:"IMOL.Widget:acceptConsent",consentAccepted:"IMOL.Widget:consentAccepted",declineConsent:"IMOL.Widget:declineConsent",consentDeclined:"IMOL.Widget:consentDeclined",sendDialogVote:"IMOL.Widget:sendDialogVote",createSession:"IMOL.Widget:createSession",openSession:"IMOL.Widget:openSession"});
/**
	 * Bitrix OpenLines widget
	 * Widget model (Vuex Builder model)
	 *
	 * @package bitrix
	 * @subpackage imopenlines
	 * @copyright 2001-2019 Bitrix
	 */var V=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"widget"}},{key:"getState",value:function e(){return{common:{configId:0,configName:"",host:this.getVariable("common.host",location.protocol+"//"+location.host),pageMode:this.getVariable("common.pageMode",false),copyright:this.getVariable("common.copyright",true),copyrightUrl:this.getVariable("common.copyrightUrl","https://bitrix24.com"),location:this.getVariable("common.location",D.bottomRight),styles:{backgroundColor:this.getVariable("styles.backgroundColor","#17a3ea"),iconColor:this.getVariable("styles.iconColor","#ffffff")},vote:{enable:false,beforeFinish:true,messageText:this.getVariable("vote.messageText",""),messageLike:this.getVariable("vote.messageLike",""),messageDislike:this.getVariable("vote.messageDislike","")},textMessages:{bxLivechatOnlineLine1:this.getVariable("textMessages.bxLivechatOnlineLine1",""),bxLivechatOnlineLine2:this.getVariable("textMessages.bxLivechatOnlineLine2",""),bxLivechatOffline:this.getVariable("textMessages.bxLivechatOffline",""),bxLivechatTitle:""},online:false,operators:[],connectors:[],showForm:T.none,showed:false,reopen:false,dragged:false,textareaHeight:0,widgetHeight:0,widgetWidth:0,showConsent:false,consentUrl:"",dialogStart:false,watchTyping:false,showSessionId:false,isCreateSessionMode:false,crmFormsSettings:{useWelcomeForm:false,welcomeFormId:0,welcomeFormSec:"",welcomeFormDelay:false,welcomeFormFilled:false,successText:"",errorText:""}},dialog:{sessionId:0,sessionClose:true,sessionStatus:0,userVote:M.none,closeVote:false,userConsent:false,operatorChatId:0,operator:{id:0,name:"",firstName:"",lastName:"",workPosition:"",avatar:"",online:false}},user:{id:-1,hash:"",name:"",firstName:"",lastName:"",avatar:"",email:"",phone:"",www:"",gender:"M",position:""}}}},{key:"getStateSaveException",value:function e(){return{common:{host:null,pageMode:null,copyright:null,copyrightUrl:null,styles:null,dragged:null,showed:null,showConsent:null,showForm:null}}}},{key:"getMutations",value:function e(){var t=this;return{common:function e(i,o){if(typeof o.configId==="number"){i.common.configId=o.configId}if(typeof o.configName==="string"){i.common.configName=o.configName}if(typeof o.online==="boolean"){i.common.online=o.online}if(m.Utils.types.isPlainObject(o.vote)){if(typeof o.vote.enable==="boolean"){i.common.vote.enable=o.vote.enable}if(typeof o.vote.beforeFinish==="boolean"){i.common.vote.beforeFinish=o.vote.beforeFinish}if(typeof o.vote.messageText==="string"){i.common.vote.messageText=o.vote.messageText}if(typeof o.vote.messageLike==="string"){i.common.vote.messageLike=o.vote.messageLike}if(typeof o.vote.messageDislike==="string"){i.common.vote.messageDislike=o.vote.messageDislike}}if(m.Utils.types.isPlainObject(o.textMessages)){if(typeof o.textMessages.bxLivechatOnlineLine1==="string"&&o.textMessages.bxLivechatOnlineLine1!==""){i.common.textMessages.bxLivechatOnlineLine1=o.textMessages.bxLivechatOnlineLine1}if(typeof o.textMessages.bxLivechatOnlineLine2==="string"&&o.textMessages.bxLivechatOnlineLine2!==""){i.common.textMessages.bxLivechatOnlineLine2=o.textMessages.bxLivechatOnlineLine2}if(typeof o.textMessages.bxLivechatOffline==="string"&&o.textMessages.bxLivechatOffline!==""){i.common.textMessages.bxLivechatOffline=o.textMessages.bxLivechatOffline}if(typeof o.textMessages.bxLivechatTitle==="string"&&o.textMessages.bxLivechatTitle!==""){i.common.textMessages.bxLivechatTitle=o.textMessages.bxLivechatTitle}}if(typeof o.dragged==="boolean"){i.common.dragged=o.dragged}if(typeof o.textareaHeight==="number"){i.common.textareaHeight=o.textareaHeight}if(typeof o.widgetHeight==="number"){i.common.widgetHeight=o.widgetHeight}if(typeof o.widgetWidth==="number"){i.common.widgetWidth=o.widgetWidth}if(typeof o.showConsent==="boolean"){i.common.showConsent=o.showConsent}if(typeof o.consentUrl==="string"){i.common.consentUrl=o.consentUrl}if(typeof o.showed==="boolean"){i.common.showed=o.showed;o.reopen=m.Utils.device.isMobile()?false:o.showed}if(typeof o.reopen==="boolean"){i.common.reopen=o.reopen}if(typeof o.copyright==="boolean"){i.common.copyright=o.copyright}if(typeof o.dialogStart==="boolean"){i.common.dialogStart=o.dialogStart}if(typeof o.watchTyping==="boolean"){i.common.watchTyping=o.watchTyping}if(typeof o.showSessionId==="boolean"){i.common.showSessionId=o.showSessionId}if(o.operators instanceof Array){i.common.operators=o.operators}if(o.connectors instanceof Array){i.common.connectors=o.connectors}if(typeof o.showForm==="string"&&typeof T[o.showForm]!=="undefined"){if(o.showForm===T.like&&!!i.dialog.closeVote){o.showForm=T.none}i.common.showForm=o.showForm}if(typeof o.location==="number"&&typeof O[o.location]!=="undefined"){if(i.common.location!==o.location){i.common.widgetHeight=0;i.common.widgetWidth=0;i.common.location=o.location}}if(m.Utils.types.isPlainObject(o.crmFormsSettings)){if(typeof o.crmFormsSettings.useWelcomeForm==="string"){i.common.crmFormsSettings.useWelcomeForm=o.crmFormsSettings.useWelcomeForm==="Y"}if(typeof o.crmFormsSettings.welcomeFormId==="string"){i.common.crmFormsSettings.welcomeFormId=o.crmFormsSettings.welcomeFormId}if(typeof o.crmFormsSettings.welcomeFormSec==="string"){i.common.crmFormsSettings.welcomeFormSec=o.crmFormsSettings.welcomeFormSec}if(typeof o.crmFormsSettings.welcomeFormDelay==="string"){i.common.crmFormsSettings.welcomeFormDelay=o.crmFormsSettings.welcomeFormDelay==="Y"}if(typeof o.crmFormsSettings.successText==="string"&&o.crmFormsSettings.successText!==""){i.common.crmFormsSettings.successText=o.crmFormsSettings.successText}if(typeof o.crmFormsSettings.errorText==="string"&&o.crmFormsSettings.errorText!==""){i.common.crmFormsSettings.errorText=o.crmFormsSettings.errorText}}if(typeof o.isCreateSessionMode==="boolean"){i.common.isCreateSessionMode=o.isCreateSessionMode}if(t.isSaveNeeded({common:o})){t.saveState(i)}},dialog:function e(i,o){if(typeof o.sessionId==="number"){i.dialog.sessionId=o.sessionId}if(typeof o.sessionClose==="boolean"){i.dialog.sessionClose=o.sessionClose}if(typeof o.sessionStatus==="number"){i.dialog.sessionStatus=o.sessionStatus}if(typeof o.userConsent==="boolean"){i.dialog.userConsent=o.userConsent}if(typeof o.userVote==="string"&&typeof o.userVote!=="undefined"){i.dialog.userVote=o.userVote}if(typeof o.closeVote==="boolean"){i.dialog.closeVote=o.closeVote;if(!!o.closeVote&&i.common.showForm===T.like){i.common.showForm=T.none}}if(typeof o.operatorChatId==="number"){i.dialog.operatorChatId=o.operatorChatId}if(m.Utils.types.isPlainObject(o.operator)){if(typeof o.operator.id==="number"){i.dialog.operator.id=o.operator.id}if(typeof o.operator.name==="string"||typeof o.operator.name==="number"){i.dialog.operator.name=o.operator.name.toString()}if(typeof o.operator.lastName==="string"||typeof o.operator.lastName==="number"){i.dialog.operator.lastName=o.operator.lastName.toString()}if(typeof o.operator.firstName==="string"||typeof o.operator.firstName==="number"){i.dialog.operator.firstName=o.operator.firstName.toString()}if(typeof o.operator.workPosition==="string"||typeof o.operator.workPosition==="number"){i.dialog.operator.workPosition=o.operator.workPosition.toString()}if(typeof o.operator.avatar==="string"){if(!o.operator.avatar||o.operator.avatar.startsWith("http")){i.dialog.operator.avatar=o.operator.avatar}else{i.dialog.operator.avatar=i.common.host+o.operator.avatar}}if(typeof o.operator.online==="boolean"){i.dialog.operator.online=o.operator.online}}if(t.isSaveNeeded({dialog:o})){t.saveState(i)}},user:function e(i,o){if(typeof o.id==="number"){i.user.id=o.id}if(typeof o.hash==="string"&&o.hash!==i.user.hash){i.user.hash=o.hash;p.Cookie.set(null,"LIVECHAT_HASH",o.hash,{expires:365*86400,path:"/"})}if(typeof o.name==="string"||typeof o.name==="number"){i.user.name=o.name.toString()}if(typeof o.firstName==="string"||typeof o.firstName==="number"){i.user.firstName=o.firstName.toString()}if(typeof o.lastName==="string"||typeof o.lastName==="number"){i.user.lastName=o.lastName.toString()}if(typeof o.avatar==="string"){i.user.avatar=o.avatar}if(typeof o.email==="string"){i.user.email=o.email}if(typeof o.phone==="string"||typeof o.phone==="number"){i.user.phone=o.phone.toString()}if(typeof o.www==="string"){i.user.www=o.www}if(typeof o.gender==="string"){i.user.gender=o.gender}if(typeof o.position==="string"){i.user.position=o.position}if(t.isSaveNeeded({user:o})){t.saveState(i)}}}}},{key:"getActions",value:function e(){var t=this;return{show:function e(t){var i=t.commit;i("common",{showed:true})},setVoteDateFinish:function e(i,o){var n=i.commit,s=i.dispatch,r=i.state;if(!o){clearTimeout(t.setVoteDateTimeout);n("dialog",{closeVote:false});return true}var a=new Date(o).getTime()-(new Date).getTime();var l=1e4;clearTimeout(t.setVoteDateTimeout);if(o){if(a&&!r.dialog.closeVote){n("dialog",{closeVote:false})}var c=a;if(a>l){c=l}t.setVoteDateTimeout=setTimeout((function e(){c=new Date(o).getTime()-(new Date).getTime();if(c>0){if(c>l){c=l}setTimeout(e,c)}else{n("dialog",{closeVote:true})}}),c)}}}}}]);return t}(I.VuexBuilderModel);
/**
	 * Bitrix OpenLines widget
	 * Rest client (base on BX.RestClient)
	 *
	 * @package bitrix
	 * @subpackage imopenlines
	 * @copyright 2001-2019 Bitrix
	 */var z=function(){function e(t){babelHelpers.classCallCheck(this,e);this.queryAuthRestore=false;this.setAuthId(W.guest);this.restClient=new l.RestClient({endpoint:t.endpoint,queryParams:this.queryParams,cors:true})}babelHelpers.createClass(e,[{key:"setAuthId",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";if(babelHelpers["typeof"](this.queryParams)!=="object"){this.queryParams={}}if(t==W.guest||typeof t==="string"&&t.match(/^[a-f0-9]{32}$/)){this.queryParams.livechat_auth_id=t}else{console.error("%LiveChatRestClient.setAuthId: auth is not correct (%c".concat(t,"%c)"),"color: black;","font-weight: bold; color: red","color: black");return false}if(t==W.guest&&typeof i==="string"&&i.match(/^[a-f0-9]{32}$/)){this.queryParams.livechat_custom_auth_id=i}return true}},{key:"getAuthId",value:function e(){if(babelHelpers["typeof"](this.queryParams)!=="object"){this.queryParams={}}return this.queryParams.livechat_auth_id||null}},{key:"callMethod",value:function e(t,i,o,n){var s=this;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;if(!r){r=m.Utils.getLogTrackingParams({name:t})}var a=new BX.Promise;this.restClient.callMethod(t,i,null,n,r).then((function(e){s.queryAuthRestore=false;a.fulfill(e)}))["catch"]((function(e){var o=e.error();if(o.ex.error=="LIVECHAT_AUTH_WIDGET_USER"){s.setAuthId(o.ex.hash);if(t===F.widgetUserRegister){console.warn("BX.LiveChatRestClient: ".concat(o.ex.error_description," (").concat(o.ex.error,")"));s.queryAuthRestore=false;a.reject(e);return false}if(!s.queryAuthRestore){console.warn("BX.LiveChatRestClient: your auth-token has expired, send query with a new token");s.queryAuthRestore=true;s.restClient.callMethod(t,i,null,n,r).then((function(e){s.queryAuthRestore=false;a.fulfill(e)}))["catch"]((function(e){s.queryAuthRestore=false;a.reject(e)}));return false}}s.queryAuthRestore=false;a.reject(e)}));return a}},{key:"callBatch",value:function e(t,i,o,n,s){var r=this;var a=function e(a){for(var l in t){if(!t.hasOwnProperty(l)){continue}var c=a[l].error();if(c&&c.ex.error=="LIVECHAT_AUTH_WIDGET_USER"){r.setAuthId(c.ex.hash);if(l===F.widgetUserRegister){console.warn("BX.LiveChatRestClient: ".concat(c.ex.error_description," (").concat(c.ex.error,")"));r.queryAuthRestore=false;i(a);return false}if(!r.queryAuthRestore){console.warn("BX.LiveChatRestClient: your auth-token has expired, send query with a new token");r.queryAuthRestore=true;r.restClient.callBatch(t,i,o,n,s);return false}}}r.queryAuthRestore=false;i(a);return true};return this.restClient.callBatch(t,a,o,n,s)}}]);return e}();
/**
	 * Bitrix OpenLines widget
	 * Widget Rest answers (Rest Answer Handler)
	 *
	 * @package bitrix
	 * @subpackage imopenlines
	 * @copyright 2001-2019 Bitrix
	 */var j=function(e){babelHelpers.inherits(t,e);function t(){var e;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,i));e.widget=i.widget;return e}babelHelpers.createClass(t,[{key:"handleImopenlinesWidgetConfigGetSuccess",value:function e(t){this.store.commit("widget/common",{configId:t.configId,configName:t.configName,vote:t.vote,textMessages:t.textMessages,operators:t.operators||[],online:t.online,consentUrl:t.consentUrl,connectors:t.connectors||[],watchTyping:t.watchTyping,showSessionId:t.showSessionId,crmFormsSettings:t.crmFormsSettings});this.store.commit("application/set",{disk:t.disk});this.widget.addLocalize(t.serverVariables);f.LocalStorage.set(this.widget.getSiteId(),0,"serverVariables",t.serverVariables||{})}},{key:"handleImopenlinesWidgetUserRegisterSuccess",value:function e(t){this.widget.restClient.setAuthId(t.hash);var i=[];if(typeof this.store.state.messages.collection[this.controller.application.getChatId()]!=="undefined"){i=this.store.state.messages.collection[this.controller.application.getChatId()]}this.store.commit("messages/initCollection",{chatId:t.chatId,messages:i});this.store.commit("dialogues/initCollection",{dialogId:t.dialogId,fields:{entityType:"LIVECHAT",type:"livechat"}});this.store.commit("application/set",{dialog:{chatId:t.chatId,dialogId:"chat"+t.chatId}})}},{key:"handleImopenlinesWidgetChatCreateSuccess",value:function e(t){this.widget.restClient.setAuthId(t.hash);this.store.commit("messages/initCollection",{chatId:t.chatId,messages:[]});this.store.commit("dialogues/initCollection",{dialogId:t.dialogId,fields:{entityType:"LIVECHAT",type:"livechat"}});this.store.commit("application/set",{dialog:{chatId:t.chatId,dialogId:"chat"+t.chatId}})}},{key:"handleImopenlinesWidgetUserGetSuccess",value:function e(t){this.store.commit("widget/user",{id:t.id,hash:t.hash,name:t.name,firstName:t.firstName,lastName:t.lastName,phone:t.phone,avatar:t.avatar,email:t.email,www:t.www,gender:t.gender,position:t.position});this.store.dispatch("users/set",[{id:t.id,name:t.name,firstName:t.firstName,lastName:t.lastName,avatar:t.avatar,gender:t.gender,workPosition:t.position}]);this.store.commit("application/set",{common:{userId:t.id}})}},{key:"handleImopenlinesWidgetDialogGetSuccess",value:function e(t){this.store.commit("messages/initCollection",{chatId:t.chatId});this.store.commit("widget/dialog",t);this.store.commit("application/set",{dialog:{chatId:t.chatId,dialogId:"chat"+t.chatId,diskFolderId:t.diskFolderId}});this.store.dispatch("widget/setVoteDateFinish",t.dateCloseVote)}},{key:"handleImDialogMessagesGetInitSuccess",value:function e(t){this.handleImDialogMessagesGetSuccess(t)}},{key:"handleImDialogMessagesGetSuccess",value:function e(t){if(t.messages&&t.messages.length>0&&!this.widget.isDialogStart()){this.store.commit("widget/common",{dialogStart:true});this.store.commit("widget/dialog",{userConsent:true})}}},{key:"handleImMessageAddSuccess",value:function e(t,i){this.widget.sendEvent({type:A.userMessage,data:{id:t,text:i.text}})}},{key:"handleImDiskFileCommitSuccess",value:function e(t,i){this.widget.sendEvent({type:A.userFile,data:{}})}}]);return t}(c.BaseRestHandler);
/**
	 * Bitrix OpenLines widget
	 * Widget pull commands (Pull Command Handler)
	 *
	 * @package bitrix
	 * @subpackage imopenlines
	 * @copyright 2001-2019 Bitrix
	 */var G=function(){babelHelpers.createClass(e,[{key:"getModuleId",value:function e(){return"im"}}],[{key:"create",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(t)}}]);function e(t){babelHelpers.classCallCheck(this,e);this.controller=t.controller;this.store=t.store;this.widget=t.widget}babelHelpers.createClass(e,[{key:"handleMessageChat",value:function e(t,i,o){if(t.message.senderId!=this.controller.application.getUserId()){this.widget.sendEvent({type:A.operatorMessage,data:t});if(!this.store.state.widget.common.showed&&!this.widget.onceShowed){this.widget.onceShowed=true;this.widget.open()}}}}]);return e}();var X=function(){babelHelpers.createClass(e,null,[{key:"create",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(t)}}]);function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);this.controller=t.controller;this.store=t.store;this.widget=t.widget}babelHelpers.createClass(e,[{key:"getModuleId",value:function e(){return"imopenlines"}},{key:"handleSessionStart",value:function e(t,i,o){this.store.commit("widget/dialog",{sessionId:t.sessionId,sessionClose:false,sessionStatus:0,userVote:M.none});this.store.dispatch("widget/setVoteDateFinish","");this.widget.sendEvent({type:A.sessionStart,data:{sessionId:t.sessionId}})}},{key:"handleSessionOperatorChange",value:function e(t,i,o){this.store.commit("widget/dialog",{operator:t.operator,operatorChatId:t.operatorChatId});this.widget.sendEvent({type:A.sessionOperatorChange,data:{operator:t.operator}})}},{key:"handleSessionStatus",value:function e(t,i,o){this.store.commit("widget/dialog",{sessionId:t.sessionId,sessionStatus:t.sessionStatus,sessionClose:t.sessionClose});this.widget.sendEvent({type:A.sessionStatus,data:{sessionId:t.sessionId,sessionStatus:t.sessionStatus}});if(t.sessionClose){this.widget.sendEvent({type:A.sessionFinish,data:{sessionId:t.sessionId,sessionStatus:t.sessionStatus}});if(!t.spam){this.store.commit("widget/dialog",{operator:{name:"",firstName:"",lastName:"",workPosition:"",avatar:"",online:false}})}}}},{key:"handleSessionDateCloseVote",value:function e(t,i,o){this.store.dispatch("widget/setVoteDateFinish",t.dateCloseVote)}}]);return e}();function q(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function $(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?q(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):q(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var Q=function(){function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"params",null);babelHelpers.defineProperty(this,"template",null);babelHelpers.defineProperty(this,"rootNode",null);babelHelpers.defineProperty(this,"restClient",null);babelHelpers.defineProperty(this,"pullClient",null);babelHelpers.defineProperty(this,"ready",true);babelHelpers.defineProperty(this,"inited",false);babelHelpers.defineProperty(this,"offline",false);babelHelpers.defineProperty(this,"widgetConfigRequest",null);babelHelpers.defineProperty(this,"userRegisterData",{});babelHelpers.defineProperty(this,"customData",[]);babelHelpers.defineProperty(this,"options",{checkSameDomain:true});babelHelpers.defineProperty(this,"subscribers",{});babelHelpers.defineProperty(this,"code","");babelHelpers.defineProperty(this,"host","");babelHelpers.defineProperty(this,"language","");babelHelpers.defineProperty(this,"copyright",true);babelHelpers.defineProperty(this,"copyrightUrl","");babelHelpers.defineProperty(this,"buttonInstance",null);babelHelpers.defineProperty(this,"localize",null);babelHelpers.defineProperty(this,"pageMode",null);this.params=i;this.messagesQueue=[];H.EventEmitter.subscribe(N.requestData,this.requestData.bind(this));H.EventEmitter.subscribe(N.createSession,this.createChat.bind(this));H.EventEmitter.subscribe(N.openSession,this.openSession.bind(this));this.initParams();this.initRestClient();this.initPullClient();this.initCore().then((function(){t.initWidget();t.initComplete()}))}babelHelpers.createClass(e,[{key:"initParams",value:function e(){this.rootNode=this.params.node||document.createElement("div");this.code=this.params.code||"";this.host=this.params.host||"";this.language=this.params.language||"en";this.copyright=this.params.copyright!==false;this.copyrightUrl=this.copyright&&this.params.copyrightUrl?this.params.copyrightUrl:"";if(this.params.buttonInstance&&babelHelpers["typeof"](this.params.buttonInstance)==="object"){this.buttonInstance=this.params.buttonInstance}if(this.params.pageMode&&babelHelpers["typeof"](this.params.pageMode)==="object"){this.pageMode={useBitrixLocalize:this.params.pageMode.useBitrixLocalize===true,placeholder:document.querySelector("#".concat(this.params.pageMode.placeholder))}}var t=this.checkRequiredFields();if(t.length>0){t.forEach((function(e){return console.warn(e)}));this.ready=false}this.setRootNode();this.localize=this.pageMode&&this.pageMode.useBitrixLocalize?window.BX.message:{};this.setLocalize()}},{key:"initRestClient",value:function e(){this.restClient=new z({endpoint:"".concat(this.host,"/rest")})}},{key:"initPullClient",value:function e(){this.pullClient=new h.PullClient({serverEnabled:true,userId:0,siteId:this.getSiteId(),restClient:this.restClient,skipStorageInit:true,configTimestamp:0,skipCheckRevision:true,getPublicListMethod:"imopenlines.widget.operator.get"})}},{key:"initCore",value:function e(){this.controller=new g.Controller({host:this.getHost(),siteId:this.getSiteId(),userId:0,languageId:this.language,pull:{client:this.pullClient},rest:{client:this.restClient},localize:this.localize,vuexBuilder:{database:!m.Utils.browser.isIe(),databaseName:"imol/widget",databaseType:I.VuexBuilder.DatabaseType.localStorage,models:[V.create().setVariables(this.getWidgetVariables())]}});return this.controller.ready()}},{key:"initWidget",value:function e(){this.restClient.setAuthId(this.getRestAuthId());this.setModelData();this.controller.application.setPrepareFilesBeforeSaveFunction(this.prepareFileData.bind(this));this.controller.addRestAnswerHandler(j.create({widget:this,store:this.controller.getStore(),controller:this.controller}))}},{key:"initComplete",value:function e(){window.dispatchEvent(new CustomEvent("onBitrixLiveChat",{detail:{widget:this,widgetCode:this.code,widgetHost:this.host}}));if(this.callStartFlag){this.start()}if(this.pageMode||this.callOpenFlag){this.open()}}},{key:"start",value:function e(){if(!this.controller||!this.controller.getStore()){this.callStartFlag=true;return true}if(this.isSessionActive()){this.requestWidgetData()}return true}},{key:"open",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!this.controller.getStore()){this.callOpenFlag=true;return true}if(!t.openFromButton&&this.buttonInstance){this.buttonInstance.wm.showById("openline_livechat")}var i=this.checkForErrorsBeforeOpen(),o=i.error,n=i.stop;if(n){return false}if(!o&&!this.inited){this.requestWidgetData()}this.attachTemplate()}},{key:"requestWidgetData",value:function e(){var t=this;if(!this.ready){console.error("LiveChatWidget.start: widget code or host is not specified");return false}if(this.isUserReady()||this.isHashAvailable()){this.requestData();this.inited=true;this.fireInitEvent();return true}this.controller.restClient.callMethod(F.widgetConfigGet,{code:this.code},(function(e){t.widgetConfigRequest=e})).then((function(e){t.widgetConfigRequest=null;t.clearError();t.controller.executeRestAnswer(F.widgetConfigGet,e);if(!t.inited){t.inited=true;t.fireInitEvent()}}))["catch"]((function(e){t.widgetConfigRequest=null;t.setError(e.error().ex.error,e.error().ex.error_description)}));if(this.isConfigDataLoaded()){this.inited=true;this.fireInitEvent()}}},{key:"requestData",value:function e(){y.Logger.log("requesting data from widget");if(this.requestDataSend){return true}this.requestDataSend=true;if(this.widgetConfigRequest){this.widgetConfigRequest.abort()}var t=this.handleBatchRequestResult.bind(this);this.controller.restClient.callBatch(this.getDataRequestQuery(),t,false,false,m.Utils.getLogTrackingParams({name:"widget.init.config",dialog:this.controller.application.getDialogData()}))}},{key:"createChat",value:function e(){var t=this;return new Promise((function(e,i){t.controller.restClient.callBatch(t.getCreateChatRequestQuery(),(function(i){t.handleBatchCreateChatRequestResult(i).then((function(){e()}))}),false,false)}))}},{key:"handleBatchRequestResult",value:function e(t){var i=this;if(!t){this.requestDataSend=false;this.setError("EMPTY_RESPONSE","Server returned an empty response.");return false}this.handleConfigGet(t).then((function(){return i.handleUserGet(t)})).then((function(){return i.handleChatGet(t)})).then((function(){return i.handleDialogGet(t)})).then((function(){return i.handleDialogMessagesGet(t)})).then((function(){return i.handleUserRegister(t)})).then((function(){return i.handlePullRequests(t)}))["catch"]((function(e){var t=e.code,o=e.description;i.setError(t,o)}))["finally"]((function(){i.requestDataSend=false}))}},{key:"handleBatchCreateChatRequestResult",value:function e(t){var i=this;if(!t){this.requestDataSend=false;this.setError("EMPTY_RESPONSE","Server returned an empty response.");return false}return this.handleChatCreate(t).then((function(){return i.handleChatGet(t)})).then((function(){return i.handleDialogGet(t)}))["catch"]((function(e){var t=e.code,o=e.description;i.setError(t,o)}))["finally"]((function(){i.requestDataSend=false}))}},{key:"handleBatchOpenSessionRequestResult",value:function e(t){var i=this;if(!t){this.requestDataSend=false;this.setError("EMPTY_RESPONSE","Server returned an empty response.");return false}return this.handleChatGet(t).then((function(){return i.handleDialogGet(t)})).then((function(){return i.handleDialogMessagesGet(t)}))["catch"]((function(e){var t=e.code,o=e.description;i.setError(t,o)}))["finally"]((function(){i.requestDataSend=false}))}},{key:"getDataRequestQuery",value:function e(){var t=babelHelpers.defineProperty({},F.widgetConfigGet,[F.widgetConfigGet,{code:this.code}]);if(this.isUserRegistered()){t[F.widgetDialogGet]=[F.widgetDialogGet,{config_id:this.getConfigId(),trace_data:this.getCrmTraceData(),custom_data:this.getCustomData()}];t[S.RestMethodHandler.imChatGet]=[S.RestMethod.imChatGet,{dialog_id:"$result[".concat(F.widgetDialogGet,"][dialogId]")}];t[S.RestMethodHandler.imDialogMessagesGetInit]=[S.RestMethod.imDialogMessagesGet,{chat_id:"$result[".concat(F.widgetDialogGet,"][chatId]"),limit:this.controller.application.getRequestMessageLimit(),convert_text:"Y"}]}else{t[F.widgetUserRegister]=[F.widgetUserRegister,$({config_id:"$result[".concat(F.widgetConfigGet,"][configId]")},this.getUserRegisterFields())];t[S.RestMethodHandler.imChatGet]=[S.RestMethod.imChatGet,{dialog_id:"$result[".concat(F.widgetUserRegister,"][dialogId]")}];if(this.userRegisterData.hash||this.getUserHashCookie()){t[F.widgetDialogGet]=[F.widgetDialogGet,{config_id:"$result[".concat(F.widgetConfigGet,"][configId]"),trace_data:this.getCrmTraceData(),custom_data:this.getCustomData()}];t[S.RestMethodHandler.imDialogMessagesGetInit]=[S.RestMethod.imDialogMessagesGet,{chat_id:"$result[".concat(F.widgetDialogGet,"][chatId]"),limit:this.controller.application.getRequestMessageLimit(),convert_text:"Y"}]}if(this.isUserAgreeConsent()){t[F.widgetUserConsentApply]=[F.widgetUserConsentApply,{config_id:"$result[".concat(F.widgetConfigGet,"][configId]"),consent_url:location.href}]}}t[F.pullServerTime]=[F.pullServerTime,{}];t[F.pullConfigGet]=[F.pullConfigGet,{CACHE:"N"}];t[F.widgetUserGet]=[F.widgetUserGet,{}];return t}},{key:"getOpenSessionQuery",value:function e(t){var i=babelHelpers.defineProperty({},F.widgetDialogGet,[F.widgetDialogGet,{config_id:this.getConfigId(),chat_id:t}]);i[S.RestMethodHandler.imChatGet]=[S.RestMethod.imChatGet,{dialog_id:"chat".concat(t)}];i[S.RestMethodHandler.imDialogMessagesGetInit]=[S.RestMethod.imDialogMessagesGet,{chat_id:t,limit:50,convert_text:"Y"}];return i}},{key:"getCreateChatRequestQuery",value:function e(){var t={};t[F.widgetChatCreate]=[F.widgetChatCreate,$({config_id:this.getConfigId()},this.getUserRegisterFields())];t[S.RestMethodHandler.imChatGet]=[S.RestMethod.imChatGet,{dialog_id:"$result[".concat(F.widgetChatCreate,"][dialogId]")}];t[F.widgetDialogGet]=[F.widgetDialogGet,{config_id:this.getConfigId(),trace_data:this.getCrmTraceData(),custom_data:this.getCustomData()}];if(this.isUserAgreeConsent()){t[F.widgetUserConsentApply]=[F.widgetUserConsentApply,{config_id:this.getConfigId(),consent_url:location.href}]}t[F.pullServerTime]=[F.pullServerTime,{}];t[F.pullConfigGet]=[F.pullConfigGet,{CACHE:"N"}];t[F.widgetUserGet]=[F.widgetUserGet,{}];return t}},{key:"openSession",value:function e(t){var i=this;var o=t.getData();return new Promise((function(e,t){var n=i.controller.getStore().getters["dialogues/get"](o.session.dialogId);if(n){i.controller.getStore().commit("application/set",{dialog:{chatId:o.session.chatId,dialogId:o.session.dialogId,diskFolderId:0}});i.controller.getStore().commit("widget/common",{isCreateSessionMode:false});e();return}i.controller.restClient.callBatch(i.getOpenSessionQuery(o.session.chatId),(function(t){i.handleBatchOpenSessionRequestResult(t).then((function(){i.controller.getStore().commit("widget/common",{isCreateSessionMode:false});e()}))}),false,false)}))}},{key:"prepareFileData",value:function e(t){var i=this;if(!Array.isArray(t)){return t}return t.map((function(e){var t=(window.md5||v.md5)("".concat(i.getUserId(),"|").concat(e.id,"|").concat(i.getUserHash()));var o="livechat_auth_id=".concat(t,"&livechat_user_id=").concat(i.getUserId());if(e.urlPreview){e.urlPreview="".concat(e.urlPreview,"&").concat(o)}if(e.urlShow){e.urlShow="".concat(e.urlShow,"&").concat(o)}if(e.urlDownload){e.urlDownload="".concat(e.urlDownload,"&").concat(o)}return e}))}},{key:"checkRequiredFields",value:function e(){var t=[];if(typeof this.code==="string"&&this.code.length<=0){t.push("LiveChatWidget.constructor: code is not correct (".concat(this.code,")"))}if(typeof this.host==="string"&&(this.host.length<=0||!this.host.startsWith("http"))){t.push("LiveChatWidget.constructor: host is not correct (".concat(this.host,")"))}return t}},{key:"setRootNode",value:function e(){if(this.pageMode&&this.pageMode.placeholder){this.rootNode=this.pageMode.placeholder}else if(document.body.firstChild){document.body.insertBefore(this.rootNode,document.body.firstChild)}else{document.body.append(this.rootNode)}}},{key:"setLocalize",value:function e(){if(babelHelpers["typeof"](this.params.localize)==="object"){this.addLocalize(this.params.localize)}var t=f.LocalStorage.get(this.getSiteId(),0,"serverVariables",false);if(t){this.addLocalize(t)}}},{key:"getWidgetVariables",value:function e(){var t={common:{host:this.getHost(),pageMode:!!this.pageMode,copyright:this.copyright,copyrightUrl:this.copyrightUrl},vote:{messageText:this.getLocalize("BX_LIVECHAT_VOTE_TITLE"),messageLike:this.getLocalize("BX_LIVECHAT_VOTE_PLUS_TITLE"),messageDislike:this.getLocalize("BX_LIVECHAT_VOTE_MINUS_TITLE")},textMessages:{bxLivechatOnlineLine1:this.getLocalize("BX_LIVECHAT_ONLINE_LINE_1"),bxLivechatOnlineLine2:this.getLocalize("BX_LIVECHAT_ONLINE_LINE_2"),bxLivechatOffline:this.getLocalize("BX_LIVECHAT_OFFLINE")}};if(this.params.styles){t.styles={};if(this.params.styles.backgroundColor){t.styles.backgroundColor=this.params.styles.backgroundColor}if(this.params.styles.iconColor){t.styles.iconColor=this.params.styles.iconColor}}return t}},{key:"getRestAuthId",value:function e(){return this.isUserRegistered()?this.getUserHash():W.guest}},{key:"setModelData",value:function e(){if(this.params.location&&O[this.params.location]){this.controller.getStore().commit("widget/common",{location:this.params.location})}}},{key:"checkForErrorsBeforeOpen",value:function e(){var t={error:false,stop:false};if(!this.checkBrowserVersion()){this.setError("OLD_BROWSER_LOCALIZED",this.localize.BX_LIVECHAT_OLD_BROWSER);t.error=true}else if(m.Utils.versionCompare(E.Vue.version(),"2.1")<0){alert(this.localize.BX_LIVECHAT_OLD_VUE);console.error("LiveChatWidget.error: OLD_VUE_VERSION (".concat(this.localize.BX_LIVECHAT_OLD_VUE_DEV.replace("#CURRENT_VERSION#",E.Vue.version()),")"));t.error=true;t.stop=true}else if(this.isSameDomain()){this.setError("LIVECHAT_SAME_DOMAIN",this.localize.BX_LIVECHAT_SAME_DOMAIN);t.error=true}return t}},{key:"isSameDomain",value:function e(){if(typeof BX==="undefined"||!BX.isReady){return false}if(!this.options.checkSameDomain){return false}return this.host.lastIndexOf(".".concat(location.hostname))>-1}},{key:"checkBrowserVersion",value:function e(){if(m.Utils.platform.isIos()){var t=m.Utils.platform.getIosVersion();if(t&&t<=10){return false}}return true}},{key:"startPullClient",value:function e(t){var i=this;return new Promise((function(e,o){if(!i.getUserId()||!i.getSiteId()||!i.restClient){return o({ex:{error:"WIDGET_NOT_LOADED",error_description:"Widget is not loaded."}})}if(i.pullClientInited){if(!i.pullClient.isConnected()){i.pullClient.scheduleReconnect()}return e(true)}i.controller.userId=i.getUserId();i.pullClient.userId=i.getUserId();i.pullClient.configTimestamp=t?t.server.config_timestamp:0;i.pullClient.skipStorageInit=false;i.pullClient.storage=new h.PullClient.StorageManager({userId:i.getUserId(),siteId:i.getSiteId()});i.pullClient.subscribe(new G({store:i.controller.getStore(),controller:i.controller,widget:i}));i.pullClient.subscribe(new X({store:i.controller.getStore(),controller:i.controller,widget:i}));i.pullClient.subscribe({type:h.PullClient.SubscriptionType.Status,callback:i.eventStatusInteraction.bind(i)});i.pullConnectedFirstTime=i.pullClient.subscribe({type:h.PullClient.SubscriptionType.Status,callback:function t(o){if(o.status===h.PullClient.PullStatus.Online){e(true);i.pullConnectedFirstTime()}}});if(i.template){i.template.$Bitrix.PullClient.set(i.pullClient)}i.pullClient.start($($({},t),{},{skipReconnectToLastSession:true}))["catch"]((function(){o({ex:{error:"PULL_CONNECTION_ERROR",error_description:"Pull is not connected."}})}));i.pullClientInited=true}))}},{key:"stopPullClient",value:function e(){if(this.pullClient){this.pullClient.stop(h.PullClient.CloseReasons.MANUAL,"Closed manually")}}},{key:"recoverPullConnection",value:function e(){this.pullClient.restart(h.PullClient.CloseReasons.MANUAL,"Restart after click by connection status button.")}},{key:"eventStatusInteraction",value:function e(t){if(t.status===h.PullClient.PullStatus.Online){this.onPullOnlineStatus()}else if(t.status===h.PullClient.PullStatus.Offline){this.pullRequestMessage=true;this.offline=true}}},{key:"onPullOnlineStatus",value:function e(){var t=this;this.offline=false;if(this.pullRequestMessage){this.controller.pullBaseHandler.option.skip=true;y.Logger.warn("Requesting getDialogUnread after going online");H.EventEmitter.emitAsync(S.EventType.dialog.requestUnread,{chatId:this.controller.application.getChatId()}).then((function(){H.EventEmitter.emit(S.EventType.dialog.scrollOnStart,{chatId:t.controller.application.getChatId()});t.controller.pullBaseHandler.option.skip=false;H.EventEmitter.emit(N.processMessagesToSendQueue)}))["catch"]((function(){t.controller.pullBaseHandler.option.skip=false}));this.pullRequestMessage=false}else{H.EventEmitter.emit(S.EventType.dialog.readMessage);H.EventEmitter.emit(N.processMessagesToSendQueue)}}},{key:"attachTemplate",value:function e(){if(this.template){this.controller.getStore().commit("widget/common",{showed:true});return true}this.rootNode.innerHTML="";this.rootNode.append(document.createElement("div"));var t=this;return this.controller.createVue(t,{el:this.rootNode.firstChild,template:"<bx-livechat/>",beforeCreate:function e(){t.sendEvent({type:A.widgetOpen,data:{}});t.template=this;if(x.ZIndexManager!==undefined){var i=x.ZIndexManager.getOrAddStack(document.body);i.setBaseIndex(1e6);this.$bitrix.Data.set("zIndexStack",i)}},destroyed:function e(){t.sendEvent({type:A.widgetClose,data:{}});t.template=null;t.templateAttached=false;t.rootNode.innerHTML=""}}).then((function(){return new Promise((function(e,t){return e()}))}))}},{key:"detachTemplate",value:function e(){if(!this.template){return true}this.template.$destroy();return true}},{key:"mutateTemplateComponent",value:function e(t,i){return E.Vue.mutateComponent(t,i)}},{key:"close",value:function e(){if(this.pageMode){return false}if(this.buttonInstance){this.buttonInstance.onWidgetClose()}this.detachTemplate()}},{key:"fireInitEvent",value:function e(){if(this.initEventFired){return true}this.sendEvent({type:A.configLoaded,data:{}});if(this.controller.getStore().state.widget.common.reopen){this.open()}this.initEventFired=true}},{key:"isUserRegistered",value:function e(){return!!this.getUserHash()}},{key:"isConfigDataLoaded",value:function e(){return this.controller.getStore().state.widget.common.configId}},{key:"isChatLoaded",value:function e(){return this.controller.getStore().state.application.dialog.chatId>0}},{key:"isSessionActive",value:function e(){return!this.controller.getStore().state.widget.dialog.sessionClose}},{key:"isUserAgreeConsent",value:function e(){return this.controller.getStore().state.widget.dialog.userConsent}},{key:"getCrmTraceData",value:function e(){var t="";if(!this.buttonInstance){return t}if(typeof this.buttonInstance.getTrace!=="function"){t=this.buttonInstance.getTrace()}else if(typeof this.buttonInstance.b24Tracker!=="undefined"&&typeof this.buttonInstance.b24Tracker.guest!=="undefined"){t=this.buttonInstance.b24Tracker.guest.getTrace()}return t}},{key:"getCustomData",value:function e(){var t=[];if(this.customData.length>0){t=this.customData}else{t=[{MESSAGE:this.localize.BX_LIVECHAT_EXTRA_SITE+": [URL]"+location.href+"[/URL]"}]}return JSON.stringify(t)}},{key:"isUserLoaded",value:function e(){return this.controller.getStore().state.widget.user.id>0}},{key:"isUserReady",value:function e(){return this.isConfigDataLoaded()&&this.isUserRegistered()}},{key:"isHashAvailable",value:function e(){return!this.isUserRegistered()&&(this.userRegisterData.hash||this.getUserHashCookie())}},{key:"getSiteId",value:function e(){return this.host.replace(/(http.?:\/\/)|([:.\\\/])/gm,"")+this.code}},{key:"getHost",value:function e(){return this.host}},{key:"getConfigId",value:function e(){return this.controller.getStore().state.widget.common.configId}},{key:"isDialogStart",value:function e(){return this.controller.getStore().state.widget.common.dialogStart}},{key:"getChatId",value:function e(){return this.controller.getStore().state.application.dialog.chatId}},{key:"getDialogId",value:function e(){return this.controller.getStore().state.application.dialog.dialogId}},{key:"getDiskFolderId",value:function e(){return this.controller.getStore().state.application.dialog.diskFolderId}},{key:"getDialogData",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getDialogId();return this.controller.getStore().state.dialogues.collection[t]}},{key:"getSessionId",value:function e(){return this.controller.getStore().state.widget.dialog.sessionId}},{key:"isSessionClose",value:function e(){return this.controller.getStore().state.widget.dialog.sessionClose}},{key:"getUserHash",value:function e(){return this.controller.getStore().state.widget.user.hash}},{key:"getUserHashCookie",value:function e(){var t="";var i=p.Cookie.get(null,"LIVECHAT_HASH");if(typeof i==="string"&&i.match(/^[a-f0-9]{32}$/)){t=i}else{var o=p.Cookie.get(this.getSiteId(),"LIVECHAT_HASH");if(typeof o==="string"&&o.match(/^[a-f0-9]{32}$/)){t=o}}return t}},{key:"getUserId",value:function e(){return this.controller.getStore().state.widget.user.id}},{key:"getUserData",value:function e(){if(!this.controller||!this.controller.getStore()){console.error("LiveChatWidget.getUserData: method can be called after fired event - onBitrixLiveChat");return false}return this.controller.getStore().state.widget.user}},{key:"getUserRegisterFields",value:function e(){return{name:this.userRegisterData.name||"",last_name:this.userRegisterData.lastName||"",avatar:this.userRegisterData.avatar||"",email:this.userRegisterData.email||"",www:this.userRegisterData.www||"",gender:this.userRegisterData.gender||"",position:this.userRegisterData.position||"",user_hash:this.userRegisterData.hash||this.getUserHashCookie()||"",consent_url:this.controller.getStore().state.widget.common.consentUrl?location.href:"",trace_data:this.getCrmTraceData(),custom_data:this.getCustomData()}}},{key:"getWidgetLocationCode",value:function e(){return O[this.controller.getStore().state.widget.common.location]}},{key:"setUserRegisterData",value:function e(t){if(!this.controller||!this.controller.getStore()){console.error("LiveChatWidget.getUserData: method can be called after fired event - onBitrixLiveChat");return false}var i=["hash","name","lastName","avatar","email","www","gender","position"];if(!m.Utils.types.isPlainObject(t)){console.error("%cLiveChatWidget.setUserData: params is not a object","color: black;");return false}for(var o in this.userRegisterData){if(!this.userRegisterData.hasOwnProperty(o)){continue}if(!t[o]){delete this.userRegisterData[o]}}for(var n in t){if(!t.hasOwnProperty(n)){continue}if(i.indexOf(n)===-1){console.warn("%cLiveChatWidget.setUserData: user field is not set, because you are trying to set an unknown field (%c".concat(n,"%c)"),"color: black;","font-weight: bold; color: red","color: black");continue}this.userRegisterData[n]=t[n]}if(this.userRegisterData.hash&&this.getUserHash()&&this.userRegisterData.hash!==this.getUserHash()){this.setNewAuthToken(this.userRegisterData.hash)}}},{key:"setNewAuthToken",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";this.controller.getStoreBuilder().clearModelState();p.Cookie.set(null,"LIVECHAT_HASH","",{expires:365*86400,path:"/"});this.controller.restClient.setAuthId(W.guest,t)}},{key:"setOption",value:function e(t,i){this.options[t]=i;return true}},{key:"setCustomData",value:function e(t){if(!this.controller||!this.controller.getStore()){console.error("LiveChatWidget.getUserData: method can be called after fired event - onBitrixLiveChat");return false}var i=[];if(t instanceof Array){t.forEach((function(e){if(e&&babelHelpers["typeof"](e)==="object"){i.push(e)}}));if(i.length<=0){console.error("LiveChatWidget.setCustomData: params is empty");return false}}else{if(!t){return false}i=[{MESSAGE:t}]}this.customData=this.customData.concat(i);return true}},{key:"setError",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";console.error("LiveChatWidget.error: ".concat(t," (").concat(i,")"));var o="";if(t==="LIVECHAT_AUTH_FAILED"){o=this.getLocalize("BX_LIVECHAT_AUTH_FAILED").replace("#LINK_START#",'<a href="javascript:void();" onclick="location.reload()">').replace("#LINK_END#","</a>");this.setNewAuthToken()}else if(t==="LIVECHAT_AUTH_PORTAL_USER"){o=this.getLocalize("BX_LIVECHAT_PORTAL_USER_NEW").replace("#LINK_START#",'<a href="'+this.host+'">').replace("#LINK_END#","</a>")}else if(t==="LIVECHAT_SAME_DOMAIN"){o=this.getLocalize("BX_LIVECHAT_SAME_DOMAIN");var n=this.getLocalize("BX_LIVECHAT_SAME_DOMAIN_LINK");if(n){o+='<br><br><a href="'+n+'">'+this.getLocalize("BX_LIVECHAT_SAME_DOMAIN_MORE")+"</a>"}}else if(t.endsWith("LOCALIZED")){o=i}this.controller.getStore().commit("application/set",{error:{active:true,code:t,description:o}})}},{key:"clearError",value:function e(){this.controller.getStore().commit("application/set",{error:{active:false,code:"",description:""}})}},{key:"subscribe",value:function e(t){if(!m.Utils.types.isPlainObject(t)){console.error("%cLiveChatWidget.subscribe: params is not a object","color: black;");return false}if(!R.includes(t.type)){console.error("%cLiveChatWidget.subscribe: subscription type is not correct (%c".concat(t.type,"%c)"),"color: black;","font-weight: bold; color: red","color: black");return false}if(typeof t.callback!=="function"){console.error("%cLiveChatWidget.subscribe: callback is not a function (%c".concat(babelHelpers["typeof"](t.callback),"%c)"),"color: black;","font-weight: bold; color: red","color: black");return false}if(typeof this.subscribers[t.type]==="undefined"){this.subscribers[t.type]=[]}this.subscribers[t.type].push(t.callback);return function(){this.subscribers[t.type]=this.subscribers[t.type].filter((function(e){return e!==t.callback}))}.bind(this)}},{key:"sendEvent",value:function e(t){t=t||{};if(!t.type){return false}if(babelHelpers["typeof"](t.data)!=="object"||!t.data){t.data={}}if(this.subscribers[t.type]instanceof Array&&this.subscribers[t.type].length>0){this.subscribers[t.type].forEach((function(e){return e(t.data)}))}if(this.subscribers[A.every]instanceof Array&&this.subscribers[A.every].length>0){this.subscribers[A.every].forEach((function(e){return e({type:t.type,data:t.data})}))}return true}},{key:"addLocalize",value:function e(t){if(babelHelpers["typeof"](t)!=="object"||!t){return false}for(var i in t){if(t.hasOwnProperty(i)){this.localize[i]=t[i]}}return true}},{key:"getLocalize",value:function e(t){var i="";if(typeof t==="undefined"){return this.localize}else if(typeof this.localize[t.toString()]==="undefined"){console.warn("LiveChatWidget.getLocalize: message with code '".concat(t.toString(),"' is undefined."))}else{i=this.localize[t]}return i}},{key:"handleConfigGet",value:function e(t){var i=this;return new Promise((function(e,o){var n=t[F.widgetConfigGet];if(n&&n.error()){return o({code:n.error().ex.error,description:n.error().ex.error_description})}i.controller.executeRestAnswer(F.widgetConfigGet,n);e()}))}},{key:"handleUserGet",value:function e(t){var i=this;return new Promise((function(e,o){var n=t[F.widgetUserGet];if(n.error()){return o({code:n.error().ex.error,description:n.error().ex.error_description})}i.controller.executeRestAnswer(F.widgetUserGet,n);e()}))}},{key:"handleChatGet",value:function e(t){var i=this;return new Promise((function(e,o){var n=t[S.RestMethodHandler.imChatGet];if(n.error()){return o({code:n.error().ex.error,description:n.error().ex.error_description})}i.controller.executeRestAnswer(S.RestMethodHandler.imChatGet,n);e()}))}},{key:"handleDialogGet",value:function e(t){var i=this;return new Promise((function(e,o){var n=t[F.widgetDialogGet];if(!n){return e()}if(n.error()){return o({code:n.error().ex.error,description:n.error().ex.error_description})}i.controller.executeRestAnswer(F.widgetDialogGet,n);e()}))}},{key:"handleDialogMessagesGet",value:function e(t){var i=this;return new Promise((function(e,o){var n=t[S.RestMethodHandler.imDialogMessagesGetInit];if(!n){return e()}if(n.error()){return o({code:n.error().ex.error,description:n.error().ex.error_description})}i.controller.getStore().dispatch("dialogues/saveDialog",{dialogId:i.controller.application.getDialogId(),chatId:i.controller.application.getChatId()});i.controller.executeRestAnswer(S.RestMethodHandler.imDialogMessagesGetInit,n);e()}))}},{key:"handleUserRegister",value:function e(t){var i=this;return new Promise((function(e,o){var n=t[F.widgetUserRegister];if(!n){return e()}if(n.error()){return o({code:n.error().ex.error,description:n.error().ex.error_description})}i.controller.executeRestAnswer(F.widgetUserRegister,n);e()}))}},{key:"handleChatCreate",value:function e(t){var i=this;return new Promise((function(e,o){var n=t[F.widgetChatCreate];if(!n){return e()}if(n.error()){return o({code:n.error().ex.error,description:n.error().ex.error_description})}i.controller.executeRestAnswer(F.widgetChatCreate,n);e()}))}},{key:"handlePullRequests",value:function e(t){var i=this;return new Promise((function(e){var o=0;var n=t[F.pullServerTime];if(n&&!n.error()){o=Math.floor((Date.now()-new Date(n.data()).getTime())/1e3)}var s=null;var r=t[F.pullConfigGet];if(r&&!r.error()){s=r.data();s.server.timeShift=o}i.startPullClient(s).then((function(){H.EventEmitter.emit(N.processMessagesToSendQueue)}))["catch"]((function(e){i.setError(e.ex.error,e.ex.error_description)}))["finally"](e)}))}}]);return e}();
/**
	 * Bitrix OpenLines widget
	 * Widget public interface
	 *
	 * @package bitrix
	 * @subpackage imopenlines
	 * @copyright 2001-2019 Bitrix
	 */var Y=function(){function e(t){babelHelpers.classCallCheck(this,e);this.developerInfo="Do not use private methods.";this.__privateMethods__=new Q(t);this.__createLegacyMethods()}babelHelpers.createClass(e,[{key:"open",value:function e(t){return this.__privateMethods__.open(t)}},{key:"close",value:function e(){return this.__privateMethods__.close()}},{key:"showNotification",value:function e(t){return this.__privateMethods__.showNotification(t)}},{key:"getUserData",value:function e(){return this.__privateMethods__.getUserData()}},{key:"setUserRegisterData",value:function e(t){return this.__privateMethods__.setUserRegisterData(t)}},{key:"setCustomData",value:function e(t){return this.__privateMethods__.setCustomData(t)}},{key:"mutateTemplateComponent",value:function e(t,i){return this.__privateMethods__.mutateTemplateComponent(t,i)}},{key:"addLocalize",value:function e(t){return this.__privateMethods__.addLocalize(t)}},{key:"subscribe",value:function e(t){return this.__privateMethods__.subscribe(t)}},{key:"start",value:function e(){return this.__privateMethods__.start()}},{key:"__createLegacyMethods",value:function e(){var t=this;if(typeof window.BX.LiveChat==="undefined"){var i=document.createElement("a");i.href=this.__privateMethods__.host;var o=i.protocol+"//"+i.hostname+(i.port&&i.port!="80"&&i.port!="443"?":"+i.port:"");window.BX.LiveChat={openLiveChat:function e(){t.open({openFromButton:true})},closeLiveChat:function e(){t.close()},addEventListener:function e(i,n,s){if(n==="message"){t.subscribe({type:A.userMessage,callback:function e(t){s({origin:o,data:JSON.stringify({action:"sendMessage"}),event:t})}})}else{console.warn("Method BX.LiveChat.addEventListener is not supported, user new format for subscribe.")}},setCookie:function e(){},getCookie:function e(){},sourceDomain:o}}if(typeof window.BxLiveChatInit==="function"){var n=window.BxLiveChatInit();if(n.user){this.__privateMethods__.setUserRegisterData(n.user)}if(n.firstMessage){this.__privateMethods__.setCustomData(n.firstMessage)}}if(window.BxLiveChatLoader instanceof Array){window.BxLiveChatLoader.forEach((function(e){return e()}))}return true}}]);return e}();var K=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"application",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"storedMessage",null);i.application=e.Application.get();i.onProcessQueueHandler=i.processQueue.bind(babelHelpers.assertThisInitialized(i));i.onConsentAcceptedHandler=i.onConsentAccepted.bind(babelHelpers.assertThisInitialized(i));i.onConsentDeclinedHandler=i.onConsentDeclined.bind(babelHelpers.assertThisInitialized(i));H.EventEmitter.subscribe(N.processMessagesToSendQueue,i.onProcessQueueHandler);H.EventEmitter.subscribe(N.consentAccepted,i.onConsentAcceptedHandler);H.EventEmitter.subscribe(N.consentDeclined,i.onConsentDeclinedHandler);return i}babelHelpers.createClass(t,[{key:"destroy",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"destroy",this).call(this);H.EventEmitter.unsubscribe(N.processMessagesToSendQueue,this.onProcessQueueHandler);H.EventEmitter.unsubscribe(N.consentAccepted,this.onConsentAcceptedHandler);H.EventEmitter.unsubscribe(N.consentDeclined,this.onConsentDeclinedHandler)}},{key:"onSendMessage",value:function e(t){var i=this;var o=t.data;o.focus=o.focus!==false;if(this.getWidgetData().common.showForm===T.smile){H.EventEmitter.emit(N.hideForm)}if(!this.getWidgetData().dialog.userConsent&&this.getWidgetData().common.consentUrl){if(o.text){this.storedMessage=o.text}H.EventEmitter.emit(N.showConsent);return false}o.text=o.text?o.text:this.storedMessage;if(!o.text&&!o.file){return false}H.EventEmitter.emit(N.hideForm);if(this.isCreateSessionMode()){H.EventEmitter.emit(N.hideForm);H.EventEmitter.emit(S.EventType.textarea.stopWriting);H.EventEmitter.emitAsync(N.createSession).then((function(){i.store.commit("widget/common",{isCreateSessionMode:false});i.sendMessage(o.text,o.file)}))}else{this.sendMessage(o.text,o.file)}if(o.focus){H.EventEmitter.emit(S.EventType.textarea.setFocus)}return true}},{key:"sendMessage",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var o=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!i&&!o){return false}var n=this.store.getters["dialogues/getQuoteId"](this.getDialogId());if(n){var s=this.store.getters["messages/getMessage"](this.getChatId(),n);if(s){i=this.getMessageTextWithQuote(s,i);H.EventEmitter.emit(S.EventType.dialog.quotePanelClose)}}if(!this.controller.application.isUnreadMessagesLoaded()){this.sendMessageToServer({id:0,chatId:this.getChatId(),dialogId:this.getDialogId(),text:i,file:o});this.processQueue();return true}var r={};if(o){r.FILE_ID=[o.id]}this.addMessageToModel({text:i,params:r,sending:!o}).then((function(e){if(!t.isDialogStart()){t.store.commit("widget/common",{dialogStart:true})}H.EventEmitter.emit(S.EventType.dialog.scrollToBottom,{chatId:t.getChatId(),cancelIfScrollChange:true});t.addMessageToQueue({messageId:e,text:i,file:o});if(t.getChatId()){t.processQueue()}else{H.EventEmitter.emit(N.requestData)}}));return true}},{key:"onClickOnKeyboard",value:function e(t){var i=t.data;if(i.action==="ACTION"&&i.params.action==="LIVECHAT"){var o=i.params,n=o.dialogId,s=o.messageId,r=o.value;var a=JSON.parse(r);var l=Number.parseInt(a.SESSION_ID,10);if(l!==this.getSessionId()||this.isSessionClose()){console.error("WidgetSendMessageHandler",this.loc["BX_LIVECHAT_ACTION_EXPIRED"]);return false}this.restClient.callMethod(F.widgetActionSend,{MESSAGE_ID:s,DIALOG_ID:n,ACTION_VALUE:r})}if(i.action==="COMMAND"){var c=i.params,d=c.dialogId,h=c.messageId,u=c.botId,g=c.command,p=c.params;this.restClient.callMethod(S.RestMethod.imMessageCommand,{MESSAGE_ID:h,DIALOG_ID:d,BOT_ID:u,COMMAND:g,COMMAND_PARAMS:p})["catch"]((function(e){return console.error("WidgetSendMessageHandler: command processing error",e)}))}}},{key:"getWidgetData",value:function e(){return this.store.state.widget}},{key:"getChatId",value:function e(){return this.store.state.application.dialog.chatId}},{key:"getDialogId",value:function e(){return this.store.state.application.dialog.dialogId}},{key:"getUserId",value:function e(){return this.store.state.widget.user.id}},{key:"getMessageTextWithQuote",value:function e(t,i){var o=null;if(t.authorId){o=this.store.getters["users/get"](t.authorId)}var n=this.store.getters["files/getList"](this.getChatId());var s="-".repeat(54);var r=o&&o.name?o.name:this.loc["BX_LIVECHAT_SYSTEM_MESSAGE"];var a=m.Utils.date.format(t.date,null,this.loc);var l=m.Utils.text.quote(t.text,t.params,n,this.loc);var c=[];c.push(s);c.push("".concat(r," [").concat(a,"]"));c.push(l);c.push(s);c.push(i);return c.join("\n")}},{key:"addMessageToQueue",value:function e(t){var i=t.messageId,o=t.text,n=t.file;this.messagesToSend.push({id:i,chatId:this.getChatId(),dialogId:this.getDialogId(),text:o,file:n,sending:false})}},{key:"sendMessageToServer",value:function e(t){var i=this;H.EventEmitter.emit(S.EventType.textarea.stopWriting);if(t.chatId===0){t.chatId=this.getChatId()}this.restClient.callMethod(S.RestMethod.imMessageAdd,{TEMPLATE_ID:t.id,CHAT_ID:t.chatId,MESSAGE:t.text},null,null,m.Utils.getLogTrackingParams({name:S.RestMethod.imMessageAdd,data:{timMessageType:"text"},dialog:this.getDialogData()})).then((function(e){i.controller.executeRestAnswer(S.RestMethodHandler.imMessageAdd,e,t)}))["catch"]((function(e){i.controller.executeRestAnswer(S.RestMethodHandler.imMessageAdd,e,t);y.Logger.warn("Error during sending message",e)}));return true}},{key:"isDialogStart",value:function e(){return this.store.state.widget.common.dialogStart}},{key:"isCreateSessionMode",value:function e(){return this.store.state.widget.common.isCreateSessionMode}},{key:"getDialogData",value:function e(){var t=this.getDialogId();return this.store.state.dialogues.collection[t]}},{key:"getApplicationModel",value:function e(){return this.store.state.application}},{key:"getSessionId",value:function e(){return this.store.state.widget.dialog.sessionId}},{key:"isSessionClose",value:function e(){return this.store.state.widget.dialog.sessionClose}},{key:"processQueue",value:function e(){var t=this;if(this.application.offline){return false}this.messagesToSend.filter((function(e){return!e.sending})).forEach((function(e){t.deleteFromQueue(e.id);e.sending=true;if(e.file){H.EventEmitter.emit(S.EventType.textarea.stopWriting);H.EventEmitter.emit(S.EventType.uploader.addMessageWithFile,e)}else{t.sendMessageToServer(e)}}))}},{key:"onConsentAccepted",value:function e(){if(!this.storedMessage){return}var t=this.getApplicationModel().device.type!==S.DeviceType.mobile;this.onSendMessage({data:{focus:t}});this.storedMessage=""}},{key:"onConsentDeclined",value:function e(){if(!this.storedMessage){return}H.EventEmitter.emit(S.EventType.textarea.insertText,{text:this.storedMessage,focus:this.getApplicationModel().device.type!==S.DeviceType.mobile});this.storedMessage=""}}]);return t}(C.SendMessageHandler);var Z=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"application",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"pullClient",null);i.application=e.Application.get();i.pullClient=e.PullClient.get();return i}babelHelpers.createClass(t,[{key:"onAppButtonClick",value:function e(t){var i=t.data;if(i.appId===T.smile){if(this.getWidgetModel().common.showForm===T.smile){H.EventEmitter.emit(N.hideForm)}else{H.EventEmitter.emit(N.showForm,{type:T.smile})}}else{H.EventEmitter.emit(S.EventType.textarea.setFocus)}}},{key:"onFocus",value:function e(){var t=this;if(this.getWidgetModel().common.copyright&&this.getApplicationModel().device.type===S.DeviceType.mobile){this.getWidgetModel().common.copyright=false}if(m.Utils.device.isMobile()){clearTimeout(this.onFocusScrollTimeout);this.onScrollHandler=this.onScroll.bind(this);this.onFocusScrollTimeout=setTimeout((function(){document.addEventListener("scroll",t.onScrollHandler)}),1e3)}}},{key:"onBlur",value:function e(){var t=this;if(!this.getWidgetModel().common.copyright&&this.getWidgetModel().common.copyright!==this.application.copyright){this.getWidgetModel().common.copyright=this.application.copyright;setTimeout((function(){H.EventEmitter.emit(S.EventType.dialog.scrollToBottom,{chatId:t.getChatId(),force:true})}),100)}if(m.Utils.device.isMobile()){clearTimeout(this.onFocusScrollTimeout);document.removeEventListener("scroll",this.onScrollHandler)}}},{key:"onKeyUp",value:function e(t){var i=t.data;if(this.canSendTypedText()){var o=this.getWidgetModel().dialog.sessionId;var n=this.getChatId();var s=this.getWidgetModel().user.id;var r=v.md5("".concat(o,"/").concat(n,"/").concat(s));var a=this.getWidgetModel().dialog.operator.id;var l=this.getWidgetModel().dialog.operatorChatId;this.pullClient.sendMessage([a],"imopenlines","linesMessageWrite",{text:i.text,infoString:r,operatorChatId:l})}}},{key:"canSendTypedText",value:function e(){return this.getWidgetModel().common.watchTyping&&this.getWidgetModel().dialog.sessionId&&!this.getWidgetModel().dialog.sessionClose&&this.getWidgetModel().dialog.operator.id&&this.getWidgetModel().dialog.operatorChatId&&this.pullClient.isPublishingEnabled()}},{key:"onScroll",value:function e(){clearTimeout(this.onScrollTimeout);this.onScrollTimeout=setTimeout((function(){H.EventEmitter.emit(S.EventType.textarea.setBlur,true)}),50)}},{key:"getWidgetModel",value:function e(){return this.store.state.widget}},{key:"getApplicationModel",value:function e(){return this.store.state.application}}]);return t}(C.TextareaHandler);var J=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"storedFile",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"widgetApplication",null);i.widgetApplication=e.Application.get();i.onConsentAcceptedHandler=i.onConsentAccepted.bind(babelHelpers.assertThisInitialized(i));i.onConsentDeclinedHandler=i.onConsentDeclined.bind(babelHelpers.assertThisInitialized(i));H.EventEmitter.subscribe(N.consentAccepted,i.onConsentAcceptedHandler);H.EventEmitter.subscribe(N.consentDeclined,i.onConsentDeclinedHandler);return i}babelHelpers.createClass(t,[{key:"destroy",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"destroy",this).call(this);H.EventEmitter.unsubscribe(N.consentAccepted,this.onConsentAcceptedHandler);H.EventEmitter.unsubscribe(N.consentDeclined,this.onConsentDeclinedHandler)}},{key:"getUserId",value:function e(){return this.controller.store.state.widget.user.id}},{key:"getUserHash",value:function e(){return this.controller.store.state.widget.user.hash}},{key:"getHost",value:function e(){return this.controller.store.state.widget.common.host}},{key:"addMessageWithFile",value:function e(t){var i=this;var o=t.getData();if(!this.getDiskFolderId()){this.requestDiskFolderId(o.chatId).then((function(){i.addMessageWithFile(t)}))["catch"]((function(e){y.Logger.error("addMessageWithFile error",e);return false}));return false}this.uploader.senderOptions.customHeaders["Livechat-Dialog-Id"]=this.getDialogId();this.uploader.senderOptions.customHeaders["Livechat-Auth-Id"]=this.getUserHash();this.uploader.addTask({taskId:o.file.id,fileData:o.file.source.file,fileName:o.file.source.file.name,generateUniqueName:true,diskFolderId:this.getDiskFolderId(),previewBlob:o.file.previewBlob,chunkSize:this.widgetApplication.getLocalize("isCloud")?b.Uploader.CLOUD_MAX_CHUNK_SIZE:b.Uploader.BOX_MIN_CHUNK_SIZE})}},{key:"onTextareaFileSelected",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},i=t.data;var o=null;if(i&&i.fileChangeEvent&&i.fileChangeEvent.target.files.length>0){o=i.fileChangeEvent}else{o=this.storedFile}if(!o){return false}if(!this.controller.store.state.widget.dialog.userConsent&&this.controller.store.state.widget.common.consentUrl){this.storedFile=i.fileChangeEvent;H.EventEmitter.emit(N.showConsent);return false}this.uploadFile(o)}},{key:"uploadFile",value:function e(t){if(!t){return false}if(!this.getChatId()){H.EventEmitter.emit(N.requestData)}this.uploader.addFilesFromEvent(t)}},{key:"onConsentAccepted",value:function e(){if(!this.storedFile){return}this.onTextareaFileSelected();this.storedFile=""}},{key:"onConsentDeclined",value:function e(){if(!this.storedFile){return}this.storedFile=""}},{key:"getUploaderSenderOptions",value:function e(){return{host:this.getHost(),customHeaders:{"Livechat-Auth-Id":this.getUserHash()},actionUploadChunk:"imopenlines.widget.disk.upload",actionCommitFile:"imopenlines.widget.disk.commit",actionRollbackUpload:"imopenlines.widget.disk.rollbackUpload"}}}]);return t}(C.TextareaUploadHandler);var ee=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"application",null);i.application=e.Application.get();return i}babelHelpers.createClass(t,[{key:"readMessage",value:function e(i){var o=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(this.application.offline){return false}return babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"readMessage",this).call(this,i,o,n)}}]);return t}(C.ReadingHandler);var te=function(e){babelHelpers.inherits(t,e);function t(e){var i;var o=e.widgetLocation,n=e.availableWidth,s=e.availableHeight,r=e.events;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"isResizing",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"widgetLocation",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"availableWidth",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"availableHeight",null);i.setEventNamespace("BX.IMOL.WidgetResizeHandler");i.subscribeToEvents(r);i.widgetLocation=o;i.availableWidth=n;i.availableHeight=s;return i}babelHelpers.createClass(t,[{key:"subscribeToEvents",value:function e(t){var i=this;var o=w.Type.isObject(t)?t:{};Object.entries(o).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),o=t[0],n=t[1];if(w.Type.isFunction(n)){i.subscribe(o,n)}}))}},{key:"startResize",value:function e(t,i,o){if(this.isResizing){return false}this.isResizing=true;t=t.changedTouches?t.changedTouches[0]:t;this.cursorStartPointY=t.clientY;this.cursorStartPointX=t.clientX;this.heightStartPoint=i;this.widthStartPoint=o;this.addWidgetResizeEvents()}},{key:"onContinueResize",value:function e(i){if(!this.isResizing){return false}i=i.changedTouches?i.changedTouches[0]:i;this.cursorControlPointY=i.clientY;this.cursorControlPointX=i.clientX;var o=this.isBottomLocation()?Math.min(this.heightStartPoint+this.cursorStartPointY-this.cursorControlPointY,this.availableHeight):Math.min(this.heightStartPoint-this.cursorStartPointY+this.cursorControlPointY,this.availableHeight);var n=Math.max(o,P.height);var s=this.isLeftLocation()?Math.min(this.widthStartPoint-this.cursorStartPointX+this.cursorControlPointX,this.availableWidth):Math.min(this.widthStartPoint+this.cursorStartPointX-this.cursorControlPointX,this.availableWidth);var r=Math.max(s,P.width);this.emit(t.events.onSizeChange,{newHeight:n,newWidth:r})}},{key:"onStopResize",value:function e(){if(!this.isResizing){return false}this.isResizing=false;this.removeWidgetResizeEvents();this.emit(t.events.onStopResize)}},{key:"setAvailableWidth",value:function e(t){this.availableWidth=t}},{key:"setAvailableHeight",value:function e(t){this.availableHeight=t}},{key:"addWidgetResizeEvents",value:function e(){this.onContinueResizeHandler=this.onContinueResize.bind(this);this.onStopResizeHandler=this.onStopResize.bind(this);document.addEventListener("mousemove",this.onContinueResizeHandler);document.addEventListener("mouseup",this.onStopResizeHandler);document.addEventListener("mouseleave",this.onStopResizeHandler)}},{key:"removeWidgetResizeEvents",value:function e(){document.removeEventListener("mousemove",this.onContinueResizeHandler);document.removeEventListener("mouseup",this.onStopResizeHandler);document.removeEventListener("mouseleave",this.onStopResizeHandler)}},{key:"isBottomLocation",value:function e(){return[D.bottomLeft,D.bottomMiddle,D.bottomRight].includes(this.widgetLocation)}},{key:"isLeftLocation",value:function e(){return[D.bottomLeft,D.topLeft,D.topMiddle].includes(this.widgetLocation)}},{key:"destroy",value:function e(){this.removeWidgetResizeEvents()}}]);return t}(H.EventEmitter);babelHelpers.defineProperty(te,"events",{onSizeChange:"onSizeChange",onStopResize:"onStopResize"});var ie=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"store",null);babelHelpers.defineProperty(this,"restClient",null);babelHelpers.defineProperty(this,"application",null);this.store=t.Data.get("controller").store;this.restClient=t.RestClient.get();this.application=t.Application.get();this.subscribeToEvents()}babelHelpers.createClass(e,[{key:"subscribeToEvents",value:function e(){this.showConsentHandler=this.onShowConsent.bind(this);this.acceptConsentHandler=this.onAcceptConsent.bind(this);this.declineConsentHandler=this.onDeclineConsent.bind(this);H.EventEmitter.subscribe(N.showConsent,this.showConsentHandler);H.EventEmitter.subscribe(N.acceptConsent,this.acceptConsentHandler);H.EventEmitter.subscribe(N.declineConsent,this.declineConsentHandler)}},{key:"onShowConsent",value:function e(){this.showConsent()}},{key:"onAcceptConsent",value:function e(){this.acceptConsent()}},{key:"onDeclineConsent",value:function e(){this.declineConsent()}},{key:"showConsent",value:function e(){this.store.commit("widget/common",{showConsent:true})}},{key:"hideConsent",value:function e(){this.store.commit("widget/common",{showConsent:false})}},{key:"acceptConsent",value:function e(){this.hideConsent();this.sendConsentDecision(true);H.EventEmitter.emit(N.consentAccepted);if(this.getWidgetModel().common.showForm===T.none){H.EventEmitter.emit(S.EventType.textarea.setFocus)}}},{key:"declineConsent",value:function e(){H.EventEmitter.emit(N.hideForm);this.hideConsent();this.sendConsentDecision(false);H.EventEmitter.emit(N.consentDeclined);if(this.getApplicationModel().device.type!==S.DeviceType.mobile){H.EventEmitter.emit(S.EventType.textarea.setFocus)}}},{key:"sendConsentDecision",value:function e(t){this.store.commit("widget/dialog",{userConsent:t});if(t&&this.application.isUserRegistered()){this.restClient.callMethod(F.widgetUserConsentApply,{config_id:this.getWidgetModel().common.configId,consent_url:location.href})}}},{key:"getWidgetModel",value:function e(){return this.store.state.widget}},{key:"getApplicationModel",value:function e(){return this.store.state.application}},{key:"destroy",value:function e(){H.EventEmitter.unsubscribe(N.showConsent,this.showConsentHandler);H.EventEmitter.unsubscribe(N.acceptConsent,this.acceptConsentHandler);H.EventEmitter.unsubscribe(N.declineConsent,this.declineConsentHandler)}}]);return e}();var oe=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"store",null);babelHelpers.defineProperty(this,"application",null);babelHelpers.defineProperty(this,"restClient",null);this.store=t.Data.get("controller").store;this.restClient=t.RestClient.get();this.application=t.Application.get();this.showFormHandler=this.onShowForm.bind(this);this.hideFormHandler=this.onHideForm.bind(this);this.sendVoteHandler=this.onSendVote.bind(this);H.EventEmitter.subscribe(N.showForm,this.showFormHandler);H.EventEmitter.subscribe(N.hideForm,this.hideFormHandler);H.EventEmitter.subscribe(N.sendDialogVote,this.sendVoteHandler)}babelHelpers.createClass(e,[{key:"onShowForm",value:function e(t){var i=this;var o=t.data;clearTimeout(this.showFormTimeout);if(o.type===T.like){if(o.delayed){this.showFormTimeout=setTimeout((function(){i.showLikeForm()}),5e3)}else{this.showLikeForm()}}else if(o.type===T.smile){this.showSmiles()}}},{key:"onHideForm",value:function e(){this.hideForm()}},{key:"onSendVote",value:function e(t){var i=t.data.vote;console.warn("VOTE",i);this.sendVote(i)}},{key:"showLikeForm",value:function e(){if(this.application.offline){return false}clearTimeout(this.showFormTimeout);if(!this.getWidgetModel().common.vote.enable){return false}if(this.getWidgetModel().dialog.sessionClose&&this.getWidgetModel().dialog.userVote!==M.none){return false}this.store.commit("widget/common",{showForm:T.like})}},{key:"showSmiles",value:function e(){this.store.commit("widget/common",{showForm:T.smile})}},{key:"sendVote",value:function e(t){var i=this;var o=this.getWidgetModel().dialog.sessionId;if(!o){return false}this.restClient.callMethod(F.widgetVoteSend,{SESSION_ID:o,ACTION:t})["catch"]((function(){i.store.commit("widget/dialog",{userVote:M.none})}));this.application.sendEvent({type:A.userVote,data:{vote:t}})}},{key:"hideForm",value:function e(){clearTimeout(this.showFormTimeout);if(this.getWidgetModel().common.showForm!==T.none){this.store.commit("widget/common",{showForm:T.none})}}},{key:"getWidgetModel",value:function e(){return this.store.state.widget}},{key:"destroy",value:function e(){H.EventEmitter.unsubscribe(N.showForm,this.showFormHandler);H.EventEmitter.unsubscribe(N.hideForm,this.hideFormHandler);H.EventEmitter.unsubscribe(N.sendDialogVote,this.sendVoteHandler)}}]);return e}();var ne=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"onOpenMessageReactionList",value:function e(t){var i=t.data;y.Logger.warn("Reactions list is blocked for the widget",i)}}]);return t}(C.ReactionHandler);var se=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"store",null);babelHelpers.defineProperty(this,"application",null);this.store=t.Data.get("controller").store;this.application=t.Application.get()}babelHelpers.createClass(e,[{key:"getHtmlHistory",value:function e(){var t=this.getChatId();if(t<=0){console.error("WidgetHistoryHandler: Incorrect chatId value")}var i={chatId:this.getChatId()};this.requestControllerAction("imopenlines.widget.history.download",i).then(this.handleRequest.bind(this)).then(this.downloadHistory.bind(this))["catch"]((function(e){return console.error("WidgetHistoryHandler: fetch error.",e)}))}},{key:"requestControllerAction",value:function e(t,i){var o=this.application.host?this.application.host:"";var n="/bitrix/services/main/ajax.php";var s=new URL(n,o);s.searchParams.set("action",t);var r=new FormData;for(var a in i){if(i.hasOwnProperty(a)){r.append(a,i[a])}}return fetch(s,{method:"POST",headers:{"Livechat-Auth-Id":this.getUserHash()},body:r})}},{key:"handleRequest",value:function e(t){var i=t.headers.get("Content-Type");if(i.startsWith("application/json")){return t.json()}return t.blob()}},{key:"downloadHistory",value:function e(t){if(t instanceof Blob){var i=window.URL.createObjectURL(t);var o=document.createElement("a");o.href=i;o.download="".concat(this.getChatId(),".html");document.body.append(o);o.click();o.remove()}else if(t.hasOwnProperty("errors")){console.error("WidgetHistoryHandler: ".concat(t.errors[0]))}else{console.error("WidgetHistoryHandler: unknown error.")}}},{key:"getChatId",value:function e(){return this.store.state.application.dialog.chatId}},{key:"getUserHash",value:function e(){return this.store.state.widget.user.hash}},{key:"destroy",value:function e(){}}]);return e}();var re=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"onClickOnDialog",value:function e(){H.EventEmitter.emit(N.hideForm)}}]);return t}(C.DialogActionHandler);function ae(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function le(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ae(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}E.BitrixVue.component("bx-livechat",{data:function e(){return{widgetAvailableHeight:0,widgetAvailableWidth:0,widgetCurrentHeight:0,widgetCurrentWidth:0,widgetIsResizing:false,textareaHeight:100,welcomeFormFilled:false,startNewChatMode:false}},computed:le({FormType:function e(){return T},VoteType:function e(){return M},DeviceType:function e(){return S.DeviceType},EventType:function e(){return S.EventType},showTextarea:function e(){if(this.widget.common.isCreateSessionMode){return this.startNewChatMode}var t=this.widget.common.crmFormsSettings;if(!t.useWelcomeForm||!t.welcomeFormId){return true}else{return t.welcomeFormDelay?true:this.welcomeFormFilled}},showWelcomeForm:function e(){return this.widget.common.crmFormsSettings.useWelcomeForm&&!this.widget.common.crmFormsSettings.welcomeFormDelay&&this.widget.common.crmFormsSettings.welcomeFormId&&!this.welcomeFormFilled},textareaHeightStyle:function e(){return{flex:"0 0 ".concat(this.textareaHeight,"px")}},textareaBottomMargin:function e(){if(!this.widget.common.copyright&&!this.isBottomLocation()){return{marginBottom:"5px"}}return""},widgetHeightStyle:function e(){if(m.Utils.device.isMobile()||this.widget.common.pageMode){return}if(this.widgetAvailableHeight<_.height||this.widgetAvailableHeight<this.widgetCurrentHeight){this.widgetCurrentHeight=Math.max(this.widgetAvailableHeight,P.height)}return"".concat(this.widgetCurrentHeight,"px")},widgetWidthStyle:function e(){if(m.Utils.device.isMobile()||this.widget.common.pageMode){return}if(this.widgetAvailableWidth<_.width||this.widgetAvailableWidth<this.widgetCurrentWidth){this.widgetCurrentWidth=Math.max(this.widgetAvailableWidth,P.width)}return"".concat(this.widgetCurrentWidth,"px")},userSelectStyle:function e(){return this.widgetIsResizing?"none":"auto"},widgetMobileDisabled:function e(){if(this.application.device.type!==S.DeviceType.mobile){return false}if(this.application.device.orientation!==S.DeviceOrientation.horizontal){return false}if(navigator.userAgent.toString().includes("iPhone")){return true}else{return babelHelpers["typeof"](window.screen)!=="object"||window.screen.availHeight<800}},widgetPositionClass:function e(){var t=[];if(this.widget.common.pageMode){t.push("bx-livechat-page-mode")}else{t.push("bx-livechat-position-".concat(O[this.widget.common.location]))}return t},widgetLanguageClass:function e(){var t=[];if(this.application.common.languageId===L.russian){t.push("bx-livechat-logo-ru")}else if(this.application.common.languageId===L.ukraine){t.push("bx-livechat-logo-ua")}else{t.push("bx-livechat-logo-en")}return t},widgetPlatformClass:function e(){var t=[];if(m.Utils.device.isMobile()){t.push("bx-livechat-mobile")}else if(m.Utils.browser.isSafari()){t.push("bx-livechat-browser-safari")}else if(m.Utils.browser.isIe()){t.push("bx-livechat-browser-ie")}if(m.Utils.platform.isMac()){t.push("bx-livechat-mac")}else{t.push("bx-livechat-custom-scroll")}return t},widgetClassName:function e(){var t=[];t.push.apply(t,babelHelpers.toConsumableArray(this.widgetPositionClass).concat(babelHelpers.toConsumableArray(this.widgetLanguageClass),babelHelpers.toConsumableArray(this.widgetPlatformClass)));if(!this.widget.common.online){t.push("bx-livechat-offline-state")}if(this.widget.common.dragged){t.push("bx-livechat-drag-n-drop")}if(this.widget.common.dialogStart){t.push("bx-livechat-chat-start")}if(this.widget.dialog.operator.name&&!(this.application.device.type===S.DeviceType.mobile&&this.application.device.orientation===S.DeviceOrientation.horizontal)){t.push("bx-livechat-has-operator")}if(this.widget.common.styles.backgroundColor&&m.Utils.isDarkColor(this.widget.common.styles.iconColor)){t.push("bx-livechat-bright-header")}return t},showMessageDialog:function e(){return this.messageCollection.length>0},localize:function e(){return E.BitrixVue.getFilteredPhrases("BX_LIVECHAT_",this)}},I.Vuex.mapState({widget:function e(t){return t.widget},application:function e(t){return t.application},dialog:function e(t){return t.dialogues.collection[t.application.dialog.dialogId]},messageCollection:function e(t){return t.messages.collection[t.application.dialog.chatId]}})),created:function e(){var t=this;y.Logger.warn("Livechat component created");this.onCreated().then((function(){t.subscribeToEvents();t.initEventHandlers()}))},mounted:function e(){if(this.widget.user.id>0){this.welcomeFormFilled=true}this.registerZIndex()},beforeDestroy:function e(){this.unsubscribeEvents();this.destroyHandlers();this.unregisterZIndex()},methods:{initEventHandlers:function e(){this.sendMessageHandler=new K(this.$Bitrix);this.textareaHandler=new Z(this.$Bitrix);this.textareaUploadHandler=new J(this.$Bitrix);this.readingHandler=new ee(this.$Bitrix);this.consentHandler=new ie(this.$Bitrix);this.formHandler=new oe(this.$Bitrix);this.textareaDragHandler=this.getTextareaDragHandler();this.resizeHandler=this.getWidgetResizeHandler();this.reactionHandler=new ne(this.$Bitrix);this.historyHandler=new se(this.$Bitrix);this.dialogActionHandler=new re(this.$Bitrix)},destroyHandlers:function e(){this.sendMessageHandler.destroy();this.textareaHandler.destroy();this.textareaUploadHandler.destroy();this.readingHandler.destroy();this.consentHandler.destroy();this.formHandler.destroy();this.textareaDragHandler.destroy();this.resizeHandler.destroy();this.reactionHandler.destroy();this.historyHandler.destroy();this.dialogActionHandler.destroy()},subscribeToEvents:function e(){document.addEventListener("keydown",this.onWindowKeyDown);if(!m.Utils.device.isMobile()&&!this.widget.common.pageMode){this.getAvailableSpaceFunc=m.Utils.throttle(this.getAvailableSpace,50);window.addEventListener("resize",this.getAvailableSpaceFunc)}},unsubscribeEvents:function e(){document.removeEventListener("keydown",this.onWindowKeyDown);if(!m.Utils.device.isMobile()&&!this.widget.common.pageMode){window.removeEventListener("resize",this.getAvailableSpaceFunc)}},initMobileEnv:function e(){var t=this;var i=document.head.querySelectorAll("meta");var o=babelHelpers.toConsumableArray(i).find((function(e){return e.name==="viewport"}));if(o){this.viewPortMetaSiteNode=o;this.viewPortMetaSiteNode.remove()}else{this.createViewportMeta()}if(!this.viewPortMetaWidgetNode){this.viewPortMetaWidgetNode=document.createElement("meta");this.viewPortMetaWidgetNode.setAttribute("name","viewport");this.viewPortMetaWidgetNode.setAttribute("content","width=device-width, initial-scale=1.0, user-scalable=0");document.head.append(this.viewPortMetaWidgetNode)}document.body.classList.add("bx-livechat-mobile-state");if(m.Utils.browser.isSafariBased()){document.body.classList.add("bx-livechat-mobile-safari-based")}return new Promise((function(e){setTimeout((function(){t.$store.dispatch("widget/show").then(e)}),50)}))},createViewportMeta:function e(){var t=document.body.offsetWidth;if(t<window.innerWidth){t=window.innerWidth}if(t<1024){t=1024}this.viewPortMetaSiteNode=document.createElement("meta");this.viewPortMetaSiteNode.setAttribute("name","viewport");this.viewPortMetaSiteNode.setAttribute("content","width=".concat(t,", initial-scale=1.0, user-scalable=1"))},removeMobileEnv:function e(){document.body.classList.remove("bx-livechat-mobile-state");if(m.Utils.browser.isSafariBased()){document.body.classList.remove("bx-livechat-mobile-safari-based")}if(this.viewPortMetaWidgetNode){this.viewPortMetaWidgetNode.remove();this.viewPortMetaWidgetNode=null}if(this.viewPortMetaSiteNode){document.head.append(this.viewPortMetaSiteNode);this.viewPortMetaSiteNode=null}},onCreated:function e(){var t=this;return new Promise((function(e){if(m.Utils.device.isMobile()){t.initMobileEnv().then(e)}else{t.$store.dispatch("widget/show").then((function(){t.widgetCurrentHeight=_.height;t.widgetCurrentWidth=_.width;t.getAvailableSpace();t.widgetCurrentHeight=t.widget.common.widgetHeight||t.widgetCurrentHeight;t.widgetCurrentWidth=t.widget.common.widgetWidth||t.widgetCurrentWidth;e()}))}t.textareaHeight=t.widget.common.textareaHeight||t.textareaHeight;t.initCollections()}))},initCollections:function e(){this.$store.commit("files/initCollection",{chatId:this.getApplication().getChatId()});this.$store.commit("messages/initCollection",{chatId:this.getApplication().getChatId()});this.$store.commit("dialogues/initCollection",{dialogId:this.getApplication().getDialogId(),fields:{entityType:"LIVECHAT",type:"livechat"}})},onBeforeClose:function e(){if(m.Utils.device.isMobile()){this.removeMobileEnv()}},onAfterClose:function e(){this.getApplication().close()},onOpenMenu:function e(){this.historyHandler.getHtmlHistory()},onPullRequestConfig:function e(){this.getApplication().recoverPullConnection()},onSmilesSelectSmile:function e(t){H.EventEmitter.emit(S.EventType.textarea.insertText,{text:t.text})},onSmilesSelectSet:function e(){H.EventEmitter.emit(S.EventType.textarea.setFocus)},onWidgetStartDrag:function e(t){this.resizeHandler.startResize(t,this.widgetCurrentHeight,this.widgetCurrentWidth);this.widgetIsResizing=true;H.EventEmitter.emit(S.EventType.textarea.setBlur,true)},onWindowKeyDown:function e(t){if(t.keyCode!==27){return}if(this.widget.common.showForm!==T.none){this.$store.commit("widget/common",{showForm:T.none})}else if(this.widget.common.showConsent){H.EventEmitter.emit(N.declineConsent)}else{this.close()}t.preventDefault();t.stopPropagation();H.EventEmitter.emit(S.EventType.textarea.setFocus)},onWelcomeFormSendSuccess:function e(){this.welcomeFormFilled=true},onWelcomeFormSendError:function e(t){console.error("onWelcomeFormSendError",t);this.welcomeFormFilled=true},onTextareaStartDrag:function e(t){this.textareaDragHandler.onStartDrag(t,this.textareaHeight);H.EventEmitter.emit(S.EventType.textarea.setBlur,true)},openDialogList:function e(){this.$store.commit("widget/common",{isCreateSessionMode:!this.widget.common.isCreateSessionMode});this.startNewChatMode=false},onStartNewChat:function e(){this.startNewChatMode=true},getApplication:function e(){return this.$Bitrix.Application.get()},close:function e(){if(this.widget.common.pageMode){return false}this.onBeforeClose();this.$store.commit("widget/common",{showed:false})},getAvailableSpace:function e(){var t=50;if(this.isBottomLocation()){var i=this.$refs.widgetWrapper.getBoundingClientRect().bottom;var o=window.innerHeight-i;this.widgetAvailableHeight=window.innerHeight-t-o}else{var n=this.$refs.widgetWrapper.getBoundingClientRect().top;this.widgetAvailableHeight=window.innerHeight-t-n}this.widgetAvailableWidth=window.innerWidth-t*2;if(this.resizeHandler){this.resizeHandler.setAvailableWidth(this.widgetAvailableWidth);this.resizeHandler.setAvailableHeight(this.widgetAvailableHeight)}},getTextareaDragHandler:function e(){var t=this,i;return new C.TextareaDragHandler((i={},babelHelpers.defineProperty(i,C.TextareaDragHandler.events.onHeightChange,(function(e){var i=e.data;var o=i.newHeight;if(t.textareaHeight!==o){t.textareaHeight=o}})),babelHelpers.defineProperty(i,C.TextareaDragHandler.events.onStopDrag,(function(){t.$store.commit("widget/common",{textareaHeight:t.textareaHeight});H.EventEmitter.emit(S.EventType.dialog.scrollToBottom,{chatId:t.chatId,force:true})})),i))},getWidgetResizeHandler:function e(){var t=this,i;return new te({widgetLocation:this.widget.common.location,availableWidth:this.widgetAvailableWidth,availableHeight:this.widgetAvailableHeight,events:(i={},babelHelpers.defineProperty(i,te.events.onSizeChange,(function(e){var i=e.data;var o=i.newHeight,n=i.newWidth;if(t.widgetCurrentHeight!==o){t.widgetCurrentHeight=o}if(t.widgetCurrentWidth!==n){t.widgetCurrentWidth=n}})),babelHelpers.defineProperty(i,te.events.onStopResize,(function(){t.widgetIsResizing=false;t.$store.commit("widget/common",{widgetHeight:t.widgetCurrentHeight,widgetWidth:t.widgetCurrentWidth})})),i)})},isBottomLocation:function e(){return[D.bottomLeft,D.bottomMiddle,D.bottomRight].includes(this.widget.common.location)},isPageMode:function e(){return this.widget.common.pageMode},registerZIndex:function e(){this.zIndexStackInstance=this.$Bitrix.Data.get("zIndexStack");if(this.zIndexStackInstance&&!!this.$refs.widgetWrapper){this.zIndexStackInstance.register(this.$refs.widgetWrapper)}},unregisterZIndex:function e(){if(this.zIndexStackInstance){this.zIndexStackInstance.unregister(this.$refs.widgetWrapper)}}},template:'\n\t\t<transition enter-active-class="bx-livechat-show" leave-active-class="bx-livechat-close" @after-leave="onAfterClose">\n\t\t\t<div\n\t\t\t\t:class="widgetClassName"\n\t\t\t\tv-if="widget.common.showed"\n\t\t\t\t:style="{height: widgetHeightStyle, width: widgetWidthStyle, userSelect: userSelectStyle}"\n\t\t\t\tclass="bx-livechat-wrapper bx-livechat-show"\n\t\t\t\tref="widgetWrapper"\n\t\t\t>\n\t\t\t\t<div class="bx-livechat-box">\n\t\t\t\t\t<div v-if="isBottomLocation() && !isPageMode()" class="bx-livechat-widget-resize-handle" @mousedown="onWidgetStartDrag"></div>\n\t\t\t\t\t<bx-livechat-head \n\t\t\t\t\t\t:isWidgetDisabled="widgetMobileDisabled" \n\t\t\t\t\t\t@openMenu="onOpenMenu" \n\t\t\t\t\t\t@close="close"\n\t\t\t\t\t\t@openDialogList="openDialogList"\n\t\t\t\t\t/>\n\t\t\t\t\t<template v-if="widgetMobileDisabled">\n\t\t\t\t\t\t<bx-livechat-body-orientation-disabled/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if="application.error.active">\n\t\t\t\t\t\t<bx-livechat-body-error/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if="!widget.common.configId">\n\t\t\t\t\t\t<div class="bx-livechat-body" key="loading-body">\n\t\t\t\t\t\t\t<bx-livechat-body-loading/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<div v-show="!widget.common.dialogStart" class="bx-livechat-body" :class="{\'bx-livechat-body-with-scroll\': showWelcomeForm}" key="welcome-body">\n\t\t\t\t\t\t\t<bx-imopenlines-form\n\t\t\t\t\t\t\t  v-show="showWelcomeForm"\n\t\t\t\t\t\t\t  @formSendSuccess="onWelcomeFormSendSuccess"\n\t\t\t\t\t\t\t  @formSendError="onWelcomeFormSendError"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<template v-if="!showWelcomeForm">\n\t\t\t\t\t\t\t\t<bx-livechat-body-operators/>\n\t\t\t\t\t\t\t\t<keep-alive include="bx-livechat-smiles">\n\t\t\t\t\t\t\t\t\t<template v-if="widget.common.showForm === FormType.smile">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-smiles @selectSmile="onSmilesSelectSmile" @selectSet="onSmilesSelectSet"/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</keep-alive>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<template v-if="widget.common.dialogStart">\n\t\t\t\t\t\t\t<bx-pull-component-status :canReconnect="true" @reconnect="onPullRequestConfig"/>\n\t\t\t\t\t\t\t<div :class="[\'bx-livechat-body\', {\'bx-livechat-body-with-message\': showMessageDialog}]" key="with-message">\n\t\t\t\t\t\t\t\t<template v-if="widget.common.isCreateSessionMode">\n\t\t\t\t\t\t\t\t\t<bx-livechat-dialogues-list @startNewChat="onStartNewChat"/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else-if="showMessageDialog">\n\t\t\t\t\t\t\t\t\t<div class="bx-livechat-dialog">\n\t\t\t\t\t\t\t\t\t\t<bx-im-component-dialog\n\t\t\t\t\t\t\t\t\t\t\t:userId="application.common.userId"\n\t\t\t\t\t\t\t\t\t\t\t:dialogId="application.dialog.dialogId"\n\t\t\t\t\t\t\t\t\t\t\t:messageLimit="application.dialog.messageLimit"\n\t\t\t\t\t\t\t\t\t\t\t:enableReactions="true"\n\t\t\t\t\t\t\t\t\t\t\t:enableDateActions="false"\n\t\t\t\t\t\t\t\t\t\t\t:enableCreateContent="false"\n\t\t\t\t\t\t\t\t\t\t\t:enableGestureQuote="true"\n\t\t\t\t\t\t\t\t\t\t\t:enableGestureMenu="true"\n\t\t\t\t\t\t\t\t\t\t\t:showMessageAvatar="false"\n\t\t\t\t\t\t\t\t\t\t\t:showMessageMenu="false"\n\t\t\t\t\t\t\t\t\t\t\t:skipDataRequest="true"\n\t\t\t\t\t\t\t\t\t\t\t:showLoadingState="false"\n\t\t\t\t\t\t\t\t\t\t\t:showEmptyState="false"\n\t\t\t\t\t\t\t\t\t\t />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t<bx-livechat-body-loading/>\n\t\t\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\t\t<keep-alive include="bx-livechat-smiles">\n\t\t\t\t\t\t\t\t\t<template v-if="widget.common.showForm === FormType.like && widget.common.vote.enable">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-vote/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widget.common.showForm === FormType.welcome">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-welcome/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widget.common.showForm === FormType.offline">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-offline/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widget.common.showForm === FormType.history">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-history/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widget.common.showForm === FormType.smile">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-smiles @selectSmile="onSmilesSelectSmile" @selectSet="onSmilesSelectSet"/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</keep-alive>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<div v-if="showTextarea || startNewChatMode" class="bx-livechat-textarea" :style="[textareaHeightStyle, textareaBottomMargin]" ref="textarea">\n\t\t\t\t\t\t\t<div class="bx-livechat-textarea-resize-handle" @mousedown="onTextareaStartDrag" @touchstart="onTextareaStartDrag"></div>\n\t\t\t\t\t\t\t<bx-im-component-textarea\n\t\t\t\t\t\t\t\t:siteId="application.common.siteId"\n\t\t\t\t\t\t\t\t:userId="application.common.userId"\n\t\t\t\t\t\t\t\t:dialogId="application.dialog.dialogId"\n\t\t\t\t\t\t\t\t:writesEventLetter="3"\n\t\t\t\t\t\t\t\t:enableEdit="true"\n\t\t\t\t\t\t\t\t:enableCommand="false"\n\t\t\t\t\t\t\t\t:enableMention="false"\n\t\t\t\t\t\t\t\t:enableFile="application.disk.enabled"\n\t\t\t\t\t\t\t\t:autoFocus="application.device.type !== DeviceType.mobile"\n\t\t\t\t\t\t\t\t:styles="{button: {backgroundColor: widget.common.styles.backgroundColor, iconColor: widget.common.styles.iconColor}}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="!widget.common.copyright && !isBottomLocation" class="bx-livechat-nocopyright-resize-wrap" style="position: relative;">\n\t\t\t\t\t\t\t<div class="bx-livechat-widget-resize-handle" @mousedown="onWidgetStartDrag"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<bx-livechat-form-consent />\n\t\t\t\t\t\t<template v-if="widget.common.copyright">\n\t\t\t\t\t\t\t<div class="bx-livechat-copyright">\n\t\t\t\t\t\t\t\t<template v-if="widget.common.copyrightUrl">\n\t\t\t\t\t\t\t\t\t<a class="bx-livechat-copyright-link" :href="widget.common.copyrightUrl" target="_blank">\n\t\t\t\t\t\t\t\t\t\t<span class="bx-livechat-logo-name">{{localize.BX_LIVECHAT_COPYRIGHT_TEXT}}</span>\n\t\t\t\t\t\t\t\t\t\t<span class="bx-livechat-logo-icon"></span>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t<span class="bx-livechat-logo-name">{{localize.BX_LIVECHAT_COPYRIGHT_TEXT}}</span>\n\t\t\t\t\t\t\t\t\t<span class="bx-livechat-logo-icon"></span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<div v-if="!isBottomLocation() && !isPageMode()" class="bx-livechat-widget-resize-handle" @mousedown="onWidgetStartDrag"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t'});function ce(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function de(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ce(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}E.BitrixVue.component("bx-livechat-body-error",{computed:de({},I.Vuex.mapState({application:function e(t){return t.application}})),template:'\n\t\t<div class="bx-livechat-body" key="error-body">\n\t\t\t<div class="bx-livechat-warning-window">\n\t\t\t\t<div class="bx-livechat-warning-icon"></div>\n\t\t\t\t<template v-if="application.error.description"> \n\t\t\t\t\t<div class="bx-livechat-help-title bx-livechat-help-title-sm bx-livechat-warning-msg" v-html="application.error.description"></div>\n\t\t\t\t</template> \n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class="bx-livechat-help-title bx-livechat-help-title-md bx-livechat-warning-msg">{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_ERROR_TITLE\')}}</div>\n\t\t\t\t\t<div class="bx-livechat-help-title bx-livechat-help-title-sm bx-livechat-warning-msg">{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_ERROR_DESC\')}}</div>\n\t\t\t\t</template> \n\t\t\t</div>\n\t\t</div>\n\t'});function he(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function ue(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?he(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):he(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}E.BitrixVue.component("bx-livechat-head",{props:{isWidgetDisabled:{default:false}},data:function e(){return{multiDialog:false}},methods:{openDialogList:function e(){H.EventEmitter.emit(N.hideForm);this.$emit("openDialogList")},close:function e(t){this.$emit("close")},like:function e(){H.EventEmitter.emit(N.showForm,{type:T.like})},openMenu:function e(t){this.$emit("openMenu",t)}},computed:ue({VoteType:function e(){return M},chatId:function e(){if(this.application){return this.application.dialog.chatId}},customBackgroundStyle:function e(t){return t.widget.common.styles.backgroundColor?"background-color: "+t.widget.common.styles.backgroundColor+"!important;":""},customBackgroundOnlineStyle:function e(t){return t.widget.common.styles.backgroundColor?"border-color: "+t.widget.common.styles.backgroundColor+"!important;":""},showName:function e(t){return t.widget.dialog.operator.firstName||t.widget.dialog.operator.lastName},voteActive:function e(t){if(!!t.widget.dialog.closeVote){return false}if(!t.widget.common.vote.beforeFinish&&t.widget.dialog.sessionStatus<U.waitClient){return false}if(!t.widget.dialog.sessionClose||t.widget.dialog.sessionClose&&t.widget.dialog.userVote===M.none){return true}if(t.widget.dialog.sessionClose&&t.widget.dialog.userVote!==M.none){return true}return false},chatTitle:function e(t){return t.widget.common.textMessages.bxLivechatTitle||t.widget.common.configName||this.localize.BX_LIVECHAT_TITLE},operatorName:function e(t){if(!this.showName)return"";return t.widget.dialog.operator.firstName?t.widget.dialog.operator.firstName:t.widget.dialog.operator.name},operatorDescription:function e(t){if(!this.showName){return""}var i=t.widget.dialog.operator.workPosition?t.widget.dialog.operator.workPosition:this.localize.BX_LIVECHAT_USER;if(t.widget.common.showSessionId&&t.widget.dialog.sessionId>=0){return this.localize.BX_LIVECHAT_OPERATOR_POSITION_AND_SESSION_ID.replace("#POSITION#",i).replace("#ID#",t.widget.dialog.sessionId)}return this.localize.BX_LIVECHAT_OPERATOR_POSITION_ONLY.replace("#POSITION#",i)},localize:function e(){return E.BitrixVue.getFilteredPhrases("BX_LIVECHAT_",this)},ie11:function e(){return x.Browser.isIE11()}},I.Vuex.mapState({widget:function e(t){return t.widget},application:function e(t){return t.application}})),watch:{showName:function e(t){var i=this;if(t){setTimeout((function(){i.$root.$emit(S.EventType.dialog.scrollToBottom,{chatId:i.chatId})}),300)}}},template:'\n\t\t<div class="bx-livechat-head-wrap">\n\t\t\t<template v-if="isWidgetDisabled">\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<div class="bx-livechat-title">{{chatTitle}}</div>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<button v-if="!widget.common.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\t\n\t\t\t</template>\n\t\t\t<template v-else-if="application.error.active">\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<div class="bx-livechat-title">{{chatTitle}}</div>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<button v-if="!widget.common.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else-if="!widget.common.configId">\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<div class="bx-livechat-title">{{chatTitle}}</div>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<button v-if="!widget.common.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\t\t\t\n\t\t\t<template v-else>\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<template v-if="!showName">\n\t\t\t\t\t\t<div class="bx-livechat-title">{{chatTitle}}</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<div class="bx-livechat-user bx-livechat-status-online">\n\t\t\t\t\t\t\t<template v-if="widget.dialog.operator.avatar">\n\t\t\t\t\t\t\t\t<div class="bx-livechat-user-icon" :style="\'background-image: url(\'+encodeURI(widget.dialog.operator.avatar)+\')\'">\n\t\t\t\t\t\t\t\t\t<div v-if="widget.dialog.operator.online" class="bx-livechat-user-status" :style="customBackgroundOnlineStyle"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class="bx-livechat-user-icon">\n\t\t\t\t\t\t\t\t\t<div v-if="widget.dialog.operator.online" class="bx-livechat-user-status" :style="customBackgroundOnlineStyle"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-livechat-user-info">\n\t\t\t\t\t\t\t<div class="bx-livechat-user-name">{{operatorName}}</div>\n\t\t\t\t\t\t\t<div class="bx-livechat-user-position">{{operatorDescription}}</div>\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<span class="bx-livechat-control-box-active" v-if="widget.common.dialogStart && widget.dialog.sessionId">\n\t\t\t\t\t\t\t<button v-if="widget.common.vote.enable && voteActive" :class="\'bx-livechat-control-btn bx-livechat-control-btn-like bx-livechat-dialog-vote-\'+(widget.dialog.userVote)" :title="localize.BX_LIVECHAT_VOTE_BUTTON" @click="like"></button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tv-if="!ie11 && application.dialog.chatId > 0"\n\t\t\t\t\t\t\t\tclass="bx-livechat-control-btn bx-livechat-control-btn-menu"\n\t\t\t\t\t\t\t\t@click="openMenu"\n\t\t\t\t\t\t\t\t:title="localize.BX_LIVECHAT_DOWNLOAD_HISTORY"\n\t\t\t\t\t\t\t></button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tv-if="multiDialog && application.dialog.chatId > 0"\n\t\t\t\t\t\t\t\tclass="bx-livechat-control-btn bx-livechat-control-btn-list"\n\t\t\t\t\t\t\t\t@click="openDialogList"\n\t\t\t\t\t\t\t></button>\n\t\t\t\t\t\t</span>\t\n\t\t\t\t\t\t<button v-if="!widget.common.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t'});
/**
	 * Bitrix OpenLines widget
	 * Body loading component (Vue component)
	 *
	 * @package bitrix
	 * @subpackage imopenlines
	 * @copyright 2001-2019 Bitrix
	 */E.BitrixVue.component("bx-livechat-body-loading",{template:'\n\t\t<div class="bx-livechat-loading-window">\n\t\t\t<svg class="bx-livechat-loading-circular" viewBox="25 25 50 50">\n\t\t\t\t<circle class="bx-livechat-loading-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>\n\t\t\t\t<circle class="bx-livechat-loading-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>\n\t\t\t</svg>\n\t\t\t<h3 class="bx-livechat-help-title bx-livechat-help-title-md bx-livechat-loading-msg">{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_LOADING\')}}</h3>\n\t\t</div>\n\t'});function ge(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function pe(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ge(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}E.BitrixVue.component("bx-livechat-body-operators",{computed:pe({},I.Vuex.mapState({widget:function e(t){return t.widget}})),template:'\n\t\t<div class="bx-livechat-help-container">\n\t\t\t<transition name="bx-livechat-animation-fade">\n\t\t\t\t<h2 v-if="widget.common.online" key="online" class="bx-livechat-help-title bx-livechat-help-title-lg">{{widget.common.textMessages.bxLivechatOnlineLine1}}<div class="bx-livechat-help-subtitle">{{widget.common.textMessages.bxLivechatOnlineLine2}}</div></h2>\n\t\t\t\t<h2 v-else key="offline" class="bx-livechat-help-title bx-livechat-help-title-sm">{{widget.common.textMessages.bxLivechatOffline}}</h2>\n\t\t\t</transition>\t\n\t\t\t<div class="bx-livechat-help-user">\n\t\t\t\t<template v-for="operator in widget.common.operators">\n\t\t\t\t\t<div class="bx-livechat-user" :key="operator.id">\n\t\t\t\t\t\t<template v-if="operator.avatar">\n\t\t\t\t\t\t\t<div class="bx-livechat-user-icon" :style="\'background-image: url(\'+encodeURI(operator.avatar)+\')\'"></div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class="bx-livechat-user-icon"></div>\n\t\t\t\t\t\t</template>\t\n\t\t\t\t\t\t<div class="bx-livechat-user-info">\n\t\t\t\t\t\t\t<div class="bx-livechat-user-name">{{operator.firstName? operator.firstName: operator.name}}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\t\n\t\t\t</div>\n\t\t</div>\n\t'});function fe(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function me(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):fe(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}E.BitrixVue.component("bx-livechat-dialogues-list",{data:function e(){return{newChatMode:false,sessionList:[],isLoading:false,pagesLoaded:0,hasMoreItemsToLoad:true,itemsPerPage:25}},computed:me({},I.Vuex.mapState({dialogues:function e(t){return t.dialogues}})),mounted:function e(){this.requestDialogList()},methods:{requestDialogList:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;this.isLoading=true;var o={CONFIG_ID:this.$Bitrix.Application.get().getConfigId()};if(i>0){o["OFFSET"]=i}return this.$Bitrix.Application.get().controller.restClient.callMethod(F.widgetDialogList,o).then((function(e){if(e.data().length===0||e.data().length<t.itemsPerPage){t.hasMoreItemsToLoad=false}t.pagesLoaded++;t.isLoading=false;t.sessionList=[].concat(babelHelpers.toConsumableArray(t.sessionList),babelHelpers.toConsumableArray(t.prepareSessionList(e.data())))}))["catch"]((function(e){console.warn("error",e)}))},prepareSessionList:function e(t){return Object.values(t).map((function(e){return{chatId:e.chatId,dialogId:e.dialogId,name:"Dialog #".concat(e.sessionId)}}))},openSession:function e(t){H.EventEmitter.emit(N.openSession,t)},startNewChat:function e(t){this.newChatMode=true;this.$emit("startNewChat",t)},isOneScreenRemaining:function e(t){return t.target.scrollTop+t.target.clientHeight>=t.target.scrollHeight-t.target.clientHeight},onScroll:function e(t){if(this.isOneScreenRemaining(t)){if(this.isLoading||!this.hasMoreItemsToLoad){return}var i=this.itemsPerPage*this.pagesLoaded;this.requestDialogList(i)}}},template:'\n\t<div class="bx-livechat-help-container" style=" height: 100%; display: flex; flex-direction: column; justify-content: space-between;">\n\t\t<div \n\t\t\tstyle="margin-top: 25px;overflow-y: scroll;position:relative"\n\t\t\t:style="{marginBottom: newChatMode ? 0 : \'10px\'}"\n\t\t\t@scroll="onScroll"\n\t\t>\n\t\t\t<div\n\t\t\t\tv-for="session in sessionList"\n\t\t\t\t:key="session.chatId"\n\t\t\t\tclass="bx-livechat-help-subtitle"\n\t\t\t\t@click="openSession({event: $event, session: session})"\n\t\t\t\tstyle="cursor: pointer; border: solid 1px black;border-radius: 10px;margin: 10px;padding: 5px;background-color: #0ae4ff">\n\t\t\t\t{{ session.name }}\n\t\t\t</div>\n\t\t\t<div v-if="isLoading" style="margin: 10px">Loading</div>\n\t\t</div>\n\t\t\n\t\t<div v-if="!newChatMode" style="margin-bottom: 10px;">\n\t\t\t<button \n\t\t\t\tclass="bx-livechat-btn" \n\t\t\t\tstyle="background-color: rgb(23, 163, 234); border-radius: 5px;width: 150px;" \n\t\t\t\t@click="startNewChat">\n\t\t\t\tStart new chat!\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\t'});
/**
	 * Bitrix OpenLines widget
	 * Body orientation disabled component (Vue component)
	 *
	 * @package bitrix
	 * @subpackage imopenlines
	 * @copyright 2001-2019 Bitrix
	 */E.BitrixVue.component("bx-livechat-body-orientation-disabled",{template:'\n\t\t<div class="bx-livechat-body" key="orientation-head">\n\t\t\t<div class="bx-livechat-mobile-orientation-box">\n\t\t\t\t<div class="bx-livechat-mobile-orientation-icon"></div>\n\t\t\t\t<div class="bx-livechat-mobile-orientation-text">{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_MOBILE_ROTATE\')}}</div>\n\t\t\t</div>\n\t\t</div>\n\t'});function ve(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function be(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ve(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}E.BitrixVue.component("bx-livechat-form-consent",{computed:be({},I.Vuex.mapState({widget:function e(t){return t.widget}})),methods:{agree:function e(){H.EventEmitter.emit(N.acceptConsent)},disagree:function e(){H.EventEmitter.emit(N.declineConsent)},onShow:function e(t,i){t.classList.add("bx-livechat-consent-window-show");i()},onHide:function e(t,i){t.classList.remove("bx-livechat-consent-window-show");t.classList.add("bx-livechat-consent-window-close");setTimeout((function(){i()}),400)},onKeyDown:function e(t){if(t.keyCode==9){if(t.target===this.$refs.iframe){if(t.shiftKey){this.$refs.cancel.focus()}else{this.$refs.success.focus()}}else if(t.target===this.$refs.success){if(t.shiftKey){this.$refs.iframe.focus()}else{this.$refs.cancel.focus()}}else if(t.target===this.$refs.cancel){if(t.shiftKey){this.$refs.success.focus()}else{this.$refs.iframe.focus()}}t.preventDefault()}else if(t.keyCode==39||t.keyCode==37){if(t.target.nextElementSibling){t.target.nextElementSibling.focus()}else if(t.target.previousElementSibling){t.target.previousElementSibling.focus()}t.preventDefault()}}},directives:{focus:{inserted:function e(t,i){t.focus()}}},template:'\n\t\t<transition @enter="onShow" @leave="onHide">\n\t\t\t<template v-if="widget.common.showConsent && widget.common.consentUrl">\n\t\t\t\t<div class="bx-livechat-consent-window">\n\t\t\t\t\t<div class="bx-livechat-consent-window-title">{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_CONSENT_TITLE\')}}</div>\n\t\t\t\t\t<div class="bx-livechat-consent-window-content">\n\t\t\t\t\t\t<iframe class="bx-livechat-consent-window-content-iframe" ref="iframe" frameborder="0" marginheight="0"  marginwidth="0" allowtransparency="allow-same-origin" seamless="true" :src="widget.common.consentUrl" @keydown="onKeyDown"></iframe>\n\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\n\t\t\t\t\t<div class="bx-livechat-consent-window-btn-box">\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-success" ref="success" @click="agree" @keydown="onKeyDown" v-focus>{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_CONSENT_AGREE\')}}</button>\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-cancel" ref="cancel" @click="disagree" @keydown="onKeyDown">{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_CONSENT_DISAGREE\')}}</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</transition>\n\t'});function we(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function ye(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?we(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):we(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}E.BitrixVue.component("bx-livechat-form-vote",{computed:ye({VoteType:function e(){return M}},I.Vuex.mapState({widget:function e(t){return t.widget}})),methods:{userVote:function e(t){H.EventEmitter.emit(N.hideForm);this.$store.commit("widget/dialog",{userVote:t});H.EventEmitter.emit(N.sendDialogVote,{vote:t})},hideForm:function e(){H.EventEmitter.emit(N.hideForm)}},template:'\n\t\t<transition enter-active-class="bx-livechat-consent-window-show" leave-active-class="bx-livechat-form-close">\n\t\t\t<div class="bx-livechat-alert-box bx-livechat-form-rate-show" key="vote">\n\t\t\t\t<div class="bx-livechat-alert-close" :title="$Bitrix.Loc.getMessage(\'BX_LIVECHAT_VOTE_LATER\')" @click="hideForm"></div>\n\t\t\t\t<div class="bx-livechat-alert-rate-box">\n\t\t\t\t\t<h4 class="bx-livechat-alert-title bx-livechat-alert-title-mdl">{{widget.common.vote.messageText}}</h4>\n\t\t\t\t\t<div class="bx-livechat-btn-box">\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-like" @click="userVote(VoteType.like)" :title="widget.common.vote.messageLike"></button>\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-dislike" @click="userVote(VoteType.dislike)" :title="widget.common.vote.messageDislike"></button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bx-livechat-alert-later"><span class="bx-livechat-alert-later-btn" @click="hideForm">{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_VOTE_LATER\')}}</span></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\t\n\t'});
/**
	 * Bitrix OpenLines widget
	 * Smiles component (Vue component)
	 *
	 * @package bitrix
	 * @subpackage imopenlines
	 * @copyright 2001-2019 Bitrix
	 */E.Vue.cloneComponent("bx-livechat-smiles","bx-smiles",{methods:{hideForm:function e(){H.EventEmitter.emit(N.hideForm)}},template:'\n\t\t<transition enter-active-class="bx-livechat-consent-window-show" leave-active-class="bx-livechat-form-close">\n\t\t\t<div class="bx-livechat-alert-box bx-livechat-alert-box-zero-padding bx-livechat-form-show" key="vote">\n\t\t\t\t<div class="bx-livechat-alert-close" @click="hideForm"></div>\n\t\t\t\t<div class="bx-livechat-alert-smiles-box">\n\t\t\t\t\t#PARENT_TEMPLATE#\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t'});
/**
	 * Bitrix OpenLines widget
	 * Widget component & controller
	 *
	 * @package bitrix
	 * @subpackage imopenlines
	 * @copyright 2001-2019 Bitrix
	 */BX.LiveChatWidget=Y;BX.LiveChatWidget.VoteType=M;BX.LiveChatWidget.SubscriptionType=A;BX.LiveChatWidget.LocationStyle=O;BX.LiveChatWidget.Cookie=p.Cookie;window.dispatchEvent(new CustomEvent("onBitrixLiveChatSourceLoaded",{detail:{}}))})(this.window=this.window||{},BX,window,BX.Messenger,window,BX,window,window,BX,BX.Messenger.Provider.Rest,BX.Main,BX,BX.Ui.Vue.Components.Crm,BX.Messenger,BX.Messenger.Lib,BX.Messenger.Lib,BX.Messenger.Lib,BX,BX.Messenger.Lib,BX,BX.Messenger.Lib,BX.Messenger.EventHandler,BX.Messenger.Const,BX,BX,BX,BX.Event);
//# sourceMappingURL=widget.bundle.map.js