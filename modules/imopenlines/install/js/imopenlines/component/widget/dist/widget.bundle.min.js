(function(t,e,i,o,n,s,r,a,l,c,d,h,u,g,p,f,m,v,b,w,y,C,S,x,I,E,H){"use strict";function k(t){var e=[];for(var i in t){if(t.hasOwnProperty(i)){e.push(t[i])}}return e}var M=Object.freeze({none:"none",like:"like",dislike:"dislike"});var T=Object.freeze({russian:"ru",ukraine:"ua",world:"en"});var L=Object.freeze({none:"none",like:"like",smile:"smile",consent:"consent",welcome:"welcome",offline:"offline",history:"history"});var D=Object.freeze({topLeft:1,topMiddle:2,topBottom:3,bottomLeft:6,bottomMiddle:5,bottomRight:4});var O=Object.freeze({1:"top-left",2:"top-center",3:"top-right",6:"bottom-left",5:"bottom-center",4:"bottom-right"});var P=Object.freeze({width:435,height:557});var _=Object.freeze({width:340,height:435});var A=Object.freeze({configLoaded:"configLoaded",widgetOpen:"widgetOpen",widgetClose:"widgetClose",sessionStart:"sessionStart",sessionOperatorChange:"sessionOperatorChange",sessionFinish:"sessionFinish",operatorMessage:"operatorMessage",userForm:"userForm",userMessage:"userMessage",userFile:"userFile",userVote:"userVote",every:"every"});var R=k(A);var F=Object.freeze({widgetUserRegister:"imopenlines.widget.user.register",widgetChatCreate:"imopenlines.widget.chat.create",widgetConfigGet:"imopenlines.widget.config.get",widgetDialogGet:"imopenlines.widget.dialog.get",widgetDialogList:"imopenlines.widget.dialog.list",widgetUserGet:"imopenlines.widget.user.get",widgetUserConsentApply:"imopenlines.widget.user.consent.apply",widgetVoteSend:"imopenlines.widget.vote.send",widgetActionSend:"imopenlines.widget.action.send",pullServerTime:"server.time",pullConfigGet:"pull.config.get"});var B=k(F);var W=Object.freeze({guest:"guest"});var U=Object.freeze({new:0,skip:5,answer:10,client:20,clientAfterOperator:25,operator:40,waitClient:50,close:60,spam:65,duplicate:69,silentlyClose:75});var N=Object.freeze({showForm:"IMOL.Widget:showForm",hideForm:"IMOL.Widget:hideForm",processMessagesToSendQueue:"IMOL.Widget:processMessagesToSendQueue",requestData:"IMOL.Widget:requestData",showConsent:"IMOL.Widget:showConsent",acceptConsent:"IMOL.Widget:acceptConsent",consentAccepted:"IMOL.Widget:consentAccepted",declineConsent:"IMOL.Widget:declineConsent",consentDeclined:"IMOL.Widget:consentDeclined",sendDialogVote:"IMOL.Widget:sendDialogVote",createSession:"IMOL.Widget:createSession",openSession:"IMOL.Widget:openSession"});var V=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getName",value:function t(){return"widget"}},{key:"getState",value:function t(){return{common:{configId:0,configName:"",host:this.getVariable("common.host",location.protocol+"//"+location.host),pageMode:this.getVariable("common.pageMode",false),copyright:this.getVariable("common.copyright",true),copyrightUrl:this.getVariable("common.copyrightUrl","https://bitrix24.com"),location:this.getVariable("common.location",D.bottomRight),styles:{backgroundColor:this.getVariable("styles.backgroundColor","#17a3ea"),iconColor:this.getVariable("styles.iconColor","#ffffff")},vote:{enable:false,beforeFinish:true,messageText:this.getVariable("vote.messageText",""),messageLike:this.getVariable("vote.messageLike",""),messageDislike:this.getVariable("vote.messageDislike","")},textMessages:{bxLivechatOnlineLine1:this.getVariable("textMessages.bxLivechatOnlineLine1",""),bxLivechatOnlineLine2:this.getVariable("textMessages.bxLivechatOnlineLine2",""),bxLivechatOffline:this.getVariable("textMessages.bxLivechatOffline",""),bxLivechatTitle:""},online:false,operators:[],connectors:[],showForm:L.none,showed:false,reopen:false,dragged:false,textareaHeight:0,widgetHeight:0,widgetWidth:0,showConsent:false,consentUrl:"",dialogStart:false,watchTyping:false,showSessionId:false,isCreateSessionMode:false,crmFormsSettings:{useWelcomeForm:false,welcomeFormId:0,welcomeFormSec:"",welcomeFormDelay:false,welcomeFormFilled:false,successText:"",errorText:""}},dialog:{sessionId:0,sessionClose:true,sessionStatus:0,userVote:M.none,closeVote:false,userConsent:false,operatorChatId:0,operator:{id:0,name:"",firstName:"",lastName:"",workPosition:"",avatar:"",online:false}},user:{id:-1,hash:"",name:"",firstName:"",lastName:"",avatar:"",email:"",phone:"",www:"",gender:"M",position:""}}}},{key:"getStateSaveException",value:function t(){return{common:{host:null,pageMode:null,copyright:null,copyrightUrl:null,styles:null,dragged:null,showed:null,showConsent:null,showForm:null}}}},{key:"getMutations",value:function t(){var e=this;return{common:function t(i,o){if(typeof o.configId==="number"){i.common.configId=o.configId}if(typeof o.configName==="string"){i.common.configName=o.configName}if(typeof o.online==="boolean"){i.common.online=o.online}if(v.Utils.types.isPlainObject(o.vote)){if(typeof o.vote.enable==="boolean"){i.common.vote.enable=o.vote.enable}if(typeof o.vote.beforeFinish==="boolean"){i.common.vote.beforeFinish=o.vote.beforeFinish}if(typeof o.vote.messageText==="string"){i.common.vote.messageText=o.vote.messageText}if(typeof o.vote.messageLike==="string"){i.common.vote.messageLike=o.vote.messageLike}if(typeof o.vote.messageDislike==="string"){i.common.vote.messageDislike=o.vote.messageDislike}}if(v.Utils.types.isPlainObject(o.textMessages)){if(typeof o.textMessages.bxLivechatOnlineLine1==="string"&&o.textMessages.bxLivechatOnlineLine1!==""){i.common.textMessages.bxLivechatOnlineLine1=o.textMessages.bxLivechatOnlineLine1}if(typeof o.textMessages.bxLivechatOnlineLine2==="string"&&o.textMessages.bxLivechatOnlineLine2!==""){i.common.textMessages.bxLivechatOnlineLine2=o.textMessages.bxLivechatOnlineLine2}if(typeof o.textMessages.bxLivechatOffline==="string"&&o.textMessages.bxLivechatOffline!==""){i.common.textMessages.bxLivechatOffline=o.textMessages.bxLivechatOffline}if(typeof o.textMessages.bxLivechatTitle==="string"&&o.textMessages.bxLivechatTitle!==""){i.common.textMessages.bxLivechatTitle=o.textMessages.bxLivechatTitle}}if(typeof o.dragged==="boolean"){i.common.dragged=o.dragged}if(typeof o.textareaHeight==="number"){i.common.textareaHeight=o.textareaHeight}if(typeof o.widgetHeight==="number"){i.common.widgetHeight=o.widgetHeight}if(typeof o.widgetWidth==="number"){i.common.widgetWidth=o.widgetWidth}if(typeof o.showConsent==="boolean"){i.common.showConsent=o.showConsent}if(typeof o.consentUrl==="string"){i.common.consentUrl=o.consentUrl}if(typeof o.showed==="boolean"){i.common.showed=o.showed;o.reopen=v.Utils.device.isMobile()?false:o.showed}if(typeof o.reopen==="boolean"){i.common.reopen=o.reopen}if(typeof o.copyright==="boolean"){i.common.copyright=o.copyright}if(typeof o.dialogStart==="boolean"){i.common.dialogStart=o.dialogStart}if(typeof o.watchTyping==="boolean"){i.common.watchTyping=o.watchTyping}if(typeof o.showSessionId==="boolean"){i.common.showSessionId=o.showSessionId}if(o.operators instanceof Array){i.common.operators=o.operators}if(o.connectors instanceof Array){i.common.connectors=o.connectors}if(typeof o.showForm==="string"&&typeof L[o.showForm]!=="undefined"){if(o.showForm===L.like&&!!i.dialog.closeVote){o.showForm=L.none}i.common.showForm=o.showForm}if(typeof o.location==="number"&&typeof O[o.location]!=="undefined"){if(i.common.location!==o.location){i.common.widgetHeight=0;i.common.widgetWidth=0;i.common.location=o.location}}if(v.Utils.types.isPlainObject(o.crmFormsSettings)){if(typeof o.crmFormsSettings.useWelcomeForm==="string"){i.common.crmFormsSettings.useWelcomeForm=o.crmFormsSettings.useWelcomeForm==="Y"}if(typeof o.crmFormsSettings.welcomeFormId==="string"){i.common.crmFormsSettings.welcomeFormId=o.crmFormsSettings.welcomeFormId}if(typeof o.crmFormsSettings.welcomeFormSec==="string"){i.common.crmFormsSettings.welcomeFormSec=o.crmFormsSettings.welcomeFormSec}if(typeof o.crmFormsSettings.welcomeFormDelay==="string"){i.common.crmFormsSettings.welcomeFormDelay=o.crmFormsSettings.welcomeFormDelay==="Y"}if(typeof o.crmFormsSettings.successText==="string"&&o.crmFormsSettings.successText!==""){i.common.crmFormsSettings.successText=o.crmFormsSettings.successText}if(typeof o.crmFormsSettings.errorText==="string"&&o.crmFormsSettings.errorText!==""){i.common.crmFormsSettings.errorText=o.crmFormsSettings.errorText}}if(typeof o.isCreateSessionMode==="boolean"){i.common.isCreateSessionMode=o.isCreateSessionMode}if(e.isSaveNeeded({common:o})){e.saveState(i)}},dialog:function t(i,o){if(typeof o.sessionId==="number"){i.dialog.sessionId=o.sessionId}if(typeof o.sessionClose==="boolean"){i.dialog.sessionClose=o.sessionClose}if(typeof o.sessionStatus==="number"){i.dialog.sessionStatus=o.sessionStatus}if(typeof o.userConsent==="boolean"){i.dialog.userConsent=o.userConsent}if(typeof o.userVote==="string"&&typeof o.userVote!=="undefined"){i.dialog.userVote=o.userVote}if(typeof o.closeVote==="boolean"){i.dialog.closeVote=o.closeVote;if(!!o.closeVote&&i.common.showForm===L.like){i.common.showForm=L.none}}if(typeof o.operatorChatId==="number"){i.dialog.operatorChatId=o.operatorChatId}if(v.Utils.types.isPlainObject(o.operator)){if(typeof o.operator.id==="number"){i.dialog.operator.id=o.operator.id}if(typeof o.operator.name==="string"||typeof o.operator.name==="number"){i.dialog.operator.name=o.operator.name.toString()}if(typeof o.operator.lastName==="string"||typeof o.operator.lastName==="number"){i.dialog.operator.lastName=o.operator.lastName.toString()}if(typeof o.operator.firstName==="string"||typeof o.operator.firstName==="number"){i.dialog.operator.firstName=o.operator.firstName.toString()}if(typeof o.operator.workPosition==="string"||typeof o.operator.workPosition==="number"){i.dialog.operator.workPosition=o.operator.workPosition.toString()}if(typeof o.operator.avatar==="string"){if(!o.operator.avatar||o.operator.avatar.startsWith("http")){i.dialog.operator.avatar=o.operator.avatar}else{i.dialog.operator.avatar=i.common.host+o.operator.avatar}}if(typeof o.operator.online==="boolean"){i.dialog.operator.online=o.operator.online}}if(e.isSaveNeeded({dialog:o})){e.saveState(i)}},user:function t(i,o){if(typeof o.id==="number"){i.user.id=o.id}if(typeof o.hash==="string"&&o.hash!==i.user.hash){i.user.hash=o.hash;f.Cookie.set(null,"LIVECHAT_HASH",o.hash,{expires:365*86400,path:"/"})}if(typeof o.name==="string"||typeof o.name==="number"){i.user.name=o.name.toString()}if(typeof o.firstName==="string"||typeof o.firstName==="number"){i.user.firstName=o.firstName.toString()}if(typeof o.lastName==="string"||typeof o.lastName==="number"){i.user.lastName=o.lastName.toString()}if(typeof o.avatar==="string"){i.user.avatar=o.avatar}if(typeof o.email==="string"){i.user.email=o.email}if(typeof o.phone==="string"||typeof o.phone==="number"){i.user.phone=o.phone.toString()}if(typeof o.www==="string"){i.user.www=o.www}if(typeof o.gender==="string"){i.user.gender=o.gender}if(typeof o.position==="string"){i.user.position=o.position}if(e.isSaveNeeded({user:o})){e.saveState(i)}}}}},{key:"getActions",value:function t(){var e=this;return{show:function t(e){var i=e.commit;i("common",{showed:true})},setVoteDateFinish:function t(i,o){var n=i.commit,s=i.dispatch,r=i.state;if(!o){clearTimeout(e.setVoteDateTimeout);n("dialog",{closeVote:false});return true}var a=new Date(o).getTime()-(new Date).getTime();var l=1e4;clearTimeout(e.setVoteDateTimeout);if(o){if(a&&!r.dialog.closeVote){n("dialog",{closeVote:false})}var c=a;if(a>l){c=l}e.setVoteDateTimeout=setTimeout((function t(){c=new Date(o).getTime()-(new Date).getTime();if(c>0){if(c>l){c=l}setTimeout(t,c)}else{n("dialog",{closeVote:true})}}),c)}}}}}]);return e}(I.VuexBuilderModel);var z=function(){function t(e){babelHelpers.classCallCheck(this,t);this.queryAuthRestore=false;this.setAuthId(W.guest);this.restClient=new c.RestClient({endpoint:e.endpoint,queryParams:this.queryParams,cors:true})}babelHelpers.createClass(t,[{key:"setAuthId",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";if(babelHelpers["typeof"](this.queryParams)!=="object"){this.queryParams={}}if(e==W.guest||typeof e==="string"&&e.match(/^[a-f0-9]{32}$/)){this.queryParams.livechat_auth_id=e}else{console.error("%LiveChatRestClient.setAuthId: auth is not correct (%c".concat(e,"%c)"),"color: black;","font-weight: bold; color: red","color: black");return false}if(e==W.guest&&typeof i==="string"&&i.match(/^[a-f0-9]{32}$/)){this.queryParams.livechat_custom_auth_id=i}return true}},{key:"getAuthId",value:function t(){if(babelHelpers["typeof"](this.queryParams)!=="object"){this.queryParams={}}return this.queryParams.livechat_auth_id||null}},{key:"callMethod",value:function t(e,i,o,n){var s=this;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;if(!r){r=v.Utils.getLogTrackingParams({name:e})}var a=new BX.Promise;this.restClient.callMethod(e,i,null,n,r).then((function(t){s.queryAuthRestore=false;a.fulfill(t)}))["catch"]((function(t){var o=t.error();if(o.ex.error=="LIVECHAT_AUTH_WIDGET_USER"){s.setAuthId(o.ex.hash);if(e===F.widgetUserRegister){console.warn("BX.LiveChatRestClient: ".concat(o.ex.error_description," (").concat(o.ex.error,")"));s.queryAuthRestore=false;a.reject(t);return false}if(!s.queryAuthRestore){console.warn("BX.LiveChatRestClient: your auth-token has expired, send query with a new token");s.queryAuthRestore=true;s.restClient.callMethod(e,i,null,n,r).then((function(t){s.queryAuthRestore=false;a.fulfill(t)}))["catch"]((function(t){s.queryAuthRestore=false;a.reject(t)}));return false}}s.queryAuthRestore=false;a.reject(t)}));return a}},{key:"callBatch",value:function t(e,i,o,n,s){var r=this;var a=function t(a){for(var l in e){if(!e.hasOwnProperty(l)){continue}var c=a[l].error();if(c&&c.ex.error=="LIVECHAT_AUTH_WIDGET_USER"){r.setAuthId(c.ex.hash);if(l===F.widgetUserRegister){console.warn("BX.LiveChatRestClient: ".concat(c.ex.error_description," (").concat(c.ex.error,")"));r.queryAuthRestore=false;i(a);return false}if(!r.queryAuthRestore){console.warn("BX.LiveChatRestClient: your auth-token has expired, send query with a new token");r.queryAuthRestore=true;r.restClient.callBatch(e,i,o,n,s);return false}}}r.queryAuthRestore=false;i(a);return true};return this.restClient.callBatch(e,a,o,n,s)}}]);return t}();var j=function(t){babelHelpers.inherits(e,t);function e(){var t;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,i));t.widget=i.widget;return t}babelHelpers.createClass(e,[{key:"handleImopenlinesWidgetConfigGetSuccess",value:function t(e){this.store.commit("widget/common",{configId:e.configId,configName:e.configName,vote:e.vote,textMessages:e.textMessages,operators:e.operators||[],online:e.online,consentUrl:e.consentUrl,connectors:e.connectors||[],watchTyping:e.watchTyping,showSessionId:e.showSessionId,crmFormsSettings:e.crmFormsSettings});this.store.commit("application/set",{disk:e.disk});this.widget.addLocalize(e.serverVariables);m.LocalStorage.set(this.widget.getSiteId(),0,"serverVariables",e.serverVariables||{})}},{key:"handleImopenlinesWidgetUserRegisterSuccess",value:function t(e){this.widget.restClient.setAuthId(e.hash);var i=[];if(typeof this.store.state.messages.collection[this.controller.application.getChatId()]!=="undefined"){i=this.store.state.messages.collection[this.controller.application.getChatId()]}this.store.commit("messages/initCollection",{chatId:e.chatId,messages:i});this.store.commit("dialogues/initCollection",{dialogId:e.dialogId,fields:{entityType:"LIVECHAT",type:"livechat"}});this.store.commit("application/set",{dialog:{chatId:e.chatId,dialogId:"chat"+e.chatId}})}},{key:"handleImopenlinesWidgetChatCreateSuccess",value:function t(e){this.widget.restClient.setAuthId(e.hash);this.store.commit("messages/initCollection",{chatId:e.chatId,messages:[]});this.store.commit("dialogues/initCollection",{dialogId:e.dialogId,fields:{entityType:"LIVECHAT",type:"livechat"}});this.store.commit("application/set",{dialog:{chatId:e.chatId,dialogId:"chat"+e.chatId}})}},{key:"handleImopenlinesWidgetUserGetSuccess",value:function t(e){this.store.commit("widget/user",{id:e.id,hash:e.hash,name:e.name,firstName:e.firstName,lastName:e.lastName,phone:e.phone,avatar:e.avatar,email:e.email,www:e.www,gender:e.gender,position:e.position});this.store.dispatch("users/set",[{id:e.id,name:e.name,firstName:e.firstName,lastName:e.lastName,avatar:e.avatar,gender:e.gender,workPosition:e.position}]);this.store.commit("application/set",{common:{userId:e.id}})}},{key:"handleImopenlinesWidgetDialogGetSuccess",value:function t(e){this.store.commit("messages/initCollection",{chatId:e.chatId});this.store.commit("widget/dialog",e);this.store.commit("application/set",{dialog:{chatId:e.chatId,dialogId:"chat"+e.chatId,diskFolderId:e.diskFolderId}});this.store.dispatch("widget/setVoteDateFinish",e.dateCloseVote)}},{key:"handleImDialogMessagesGetInitSuccess",value:function t(e){this.handleImDialogMessagesGetSuccess(e)}},{key:"handleImDialogMessagesGetSuccess",value:function t(e){if(e.messages&&e.messages.length>0&&!this.widget.isDialogStart()){this.store.commit("widget/common",{dialogStart:true});this.store.commit("widget/dialog",{userConsent:true})}}},{key:"handleImMessageAddSuccess",value:function t(e,i){this.widget.sendEvent({type:A.userMessage,data:{id:e,text:i.text}})}},{key:"handleImDiskFileCommitSuccess",value:function t(e,i){this.widget.sendEvent({type:A.userFile,data:{}})}}]);return e}(d.BaseRestHandler);var G=function(){babelHelpers.createClass(t,[{key:"getModuleId",value:function t(){return"im"}}],[{key:"create",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(e)}}]);function t(e){babelHelpers.classCallCheck(this,t);this.controller=e.controller;this.store=e.store;this.widget=e.widget}babelHelpers.createClass(t,[{key:"handleMessageChat",value:function t(e,i,o){if(e.message.senderId!=this.controller.application.getUserId()){this.widget.sendEvent({type:A.operatorMessage,data:e});if(!this.store.state.widget.common.showed&&!this.widget.onceShowed){this.widget.onceShowed=true;this.widget.open()}}}}]);return t}();var X=function(){babelHelpers.createClass(t,null,[{key:"create",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(e)}}]);function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);this.controller=e.controller;this.store=e.store;this.widget=e.widget}babelHelpers.createClass(t,[{key:"getModuleId",value:function t(){return"imopenlines"}},{key:"handleSessionStart",value:function t(e,i,o){this.store.commit("widget/dialog",{sessionId:e.sessionId,sessionClose:false,sessionStatus:0,userVote:M.none});this.store.dispatch("widget/setVoteDateFinish","");this.widget.sendEvent({type:A.sessionStart,data:{sessionId:e.sessionId}})}},{key:"handleSessionOperatorChange",value:function t(e,i,o){this.store.commit("widget/dialog",{operator:e.operator,operatorChatId:e.operatorChatId});this.widget.sendEvent({type:A.sessionOperatorChange,data:{operator:e.operator}})}},{key:"handleSessionStatus",value:function t(e,i,o){this.store.commit("widget/dialog",{sessionId:e.sessionId,sessionStatus:e.sessionStatus,sessionClose:e.sessionClose});this.widget.sendEvent({type:A.sessionStatus,data:{sessionId:e.sessionId,sessionStatus:e.sessionStatus}});if(e.sessionClose){this.widget.sendEvent({type:A.sessionFinish,data:{sessionId:e.sessionId,sessionStatus:e.sessionStatus}});if(!e.spam){this.store.commit("widget/dialog",{operator:{name:"",firstName:"",lastName:"",workPosition:"",avatar:"",online:false}})}}}},{key:"handleSessionDateCloseVote",value:function t(e,i,o){this.store.dispatch("widget/setVoteDateFinish",e.dateCloseVote)}}]);return t}();function q(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function $(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?q(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):q(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var Q=function(){function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"params",null);babelHelpers.defineProperty(this,"template",null);babelHelpers.defineProperty(this,"rootNode",null);babelHelpers.defineProperty(this,"restClient",null);babelHelpers.defineProperty(this,"pullClient",null);babelHelpers.defineProperty(this,"ready",true);babelHelpers.defineProperty(this,"inited",false);babelHelpers.defineProperty(this,"offline",false);babelHelpers.defineProperty(this,"widgetConfigRequest",null);babelHelpers.defineProperty(this,"userRegisterData",{});babelHelpers.defineProperty(this,"customData",[]);babelHelpers.defineProperty(this,"options",{checkSameDomain:true});babelHelpers.defineProperty(this,"subscribers",{});babelHelpers.defineProperty(this,"code","");babelHelpers.defineProperty(this,"host","");babelHelpers.defineProperty(this,"language","");babelHelpers.defineProperty(this,"copyright",true);babelHelpers.defineProperty(this,"copyrightUrl","");babelHelpers.defineProperty(this,"buttonInstance",null);babelHelpers.defineProperty(this,"localize",null);babelHelpers.defineProperty(this,"pageMode",null);this.params=i;this.messagesQueue=[];H.EventEmitter.subscribe(N.requestData,this.requestData.bind(this));H.EventEmitter.subscribe(N.createSession,this.createChat.bind(this));H.EventEmitter.subscribe(N.openSession,this.openSession.bind(this));this.initParams();this.initRestClient();this.initPullClient();this.initCore().then((function(){e.initWidget();e.initComplete()}))}babelHelpers.createClass(t,[{key:"initParams",value:function t(){this.rootNode=this.params.node||document.createElement("div");this.code=this.params.code||"";this.host=this.params.host||"";this.language=this.params.language||"en";this.copyright=this.params.copyright!==false;this.copyrightUrl=this.copyright&&this.params.copyrightUrl?this.params.copyrightUrl:"";if(this.params.buttonInstance&&babelHelpers["typeof"](this.params.buttonInstance)==="object"){this.buttonInstance=this.params.buttonInstance}if(this.params.pageMode&&babelHelpers["typeof"](this.params.pageMode)==="object"){this.pageMode={useBitrixLocalize:this.params.pageMode.useBitrixLocalize===true,placeholder:document.querySelector("#".concat(this.params.pageMode.placeholder))}}var e=this.checkRequiredFields();if(e.length>0){e.forEach((function(t){return console.warn(t)}));this.ready=false}this.setRootNode();this.localize=this.pageMode&&this.pageMode.useBitrixLocalize?window.BX.message:{};this.setLocalize()}},{key:"initRestClient",value:function t(){this.restClient=new z({endpoint:"".concat(this.host,"/rest")})}},{key:"initPullClient",value:function t(){this.pullClient=new u.PullClient({serverEnabled:true,userId:0,siteId:this.getSiteId(),restClient:this.restClient,skipStorageInit:true,configTimestamp:0,skipCheckRevision:true,getPublicListMethod:"imopenlines.widget.operator.get"})}},{key:"initCore",value:function t(){this.controller=new p.Controller({host:this.getHost(),siteId:this.getSiteId(),userId:0,languageId:this.language,pull:{client:this.pullClient},rest:{client:this.restClient},localize:this.localize,vuexBuilder:{database:!v.Utils.browser.isIe(),databaseName:"imol/widget",databaseType:I.VuexBuilder.DatabaseType.localStorage,models:[V.create().setVariables(this.getWidgetVariables())]}});return this.controller.ready()}},{key:"initWidget",value:function t(){this.restClient.setAuthId(this.getRestAuthId());this.setModelData();this.controller.application.setPrepareFilesBeforeSaveFunction(this.prepareFileData.bind(this));this.controller.addRestAnswerHandler(j.create({widget:this,store:this.controller.getStore(),controller:this.controller}))}},{key:"initComplete",value:function t(){window.dispatchEvent(new CustomEvent("onBitrixLiveChat",{detail:{widget:this,widgetCode:this.code,widgetHost:this.host}}));if(this.callStartFlag){this.start()}if(this.pageMode||this.callOpenFlag){this.open()}}},{key:"start",value:function t(){if(!this.controller||!this.controller.getStore()){this.callStartFlag=true;return true}if(this.isSessionActive()){this.requestWidgetData()}return true}},{key:"open",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!this.controller.getStore()){this.callOpenFlag=true;return true}if(!e.openFromButton&&this.buttonInstance){this.buttonInstance.wm.showById("openline_livechat")}var i=this.checkForErrorsBeforeOpen(),o=i.error,n=i.stop;if(n){return false}if(!o&&!this.inited){this.requestWidgetData()}this.attachTemplate()}},{key:"requestWidgetData",value:function t(){var e=this;if(!this.ready){console.error("LiveChatWidget.start: widget code or host is not specified");return false}if(this.isUserReady()||this.isHashAvailable()){this.requestData();this.inited=true;this.fireInitEvent();return true}this.controller.restClient.callMethod(F.widgetConfigGet,{code:this.code},(function(t){e.widgetConfigRequest=t})).then((function(t){e.widgetConfigRequest=null;e.clearError();e.controller.executeRestAnswer(F.widgetConfigGet,t);if(!e.inited){e.inited=true;e.fireInitEvent()}}))["catch"]((function(t){e.widgetConfigRequest=null;e.setError(t.error().ex.error,t.error().ex.error_description)}));if(this.isConfigDataLoaded()){this.inited=true;this.fireInitEvent()}}},{key:"requestData",value:function t(){y.Logger.log("requesting data from widget");if(this.requestDataSend){return true}this.requestDataSend=true;if(this.widgetConfigRequest){this.widgetConfigRequest.abort()}var e=this.handleBatchRequestResult.bind(this);this.controller.restClient.callBatch(this.getDataRequestQuery(),e,false,false,v.Utils.getLogTrackingParams({name:"widget.init.config",dialog:this.controller.application.getDialogData()}))}},{key:"createChat",value:function t(){var e=this;return new Promise((function(t,i){e.controller.restClient.callBatch(e.getCreateChatRequestQuery(),(function(i){e.handleBatchCreateChatRequestResult(i).then((function(){t()}))}),false,false)}))}},{key:"handleBatchRequestResult",value:function t(e){var i=this;if(!e){this.requestDataSend=false;this.setError("EMPTY_RESPONSE","Server returned an empty response.");return false}this.handleConfigGet(e).then((function(){return i.handleUserGet(e)})).then((function(){return i.handleChatGet(e)})).then((function(){return i.handleDialogGet(e)})).then((function(){return i.handleDialogMessagesGet(e)})).then((function(){return i.handleUserRegister(e)})).then((function(){return i.handlePullRequests(e)}))["catch"]((function(t){var e=t.code,o=t.description;i.setError(e,o)}))["finally"]((function(){i.requestDataSend=false}))}},{key:"handleBatchCreateChatRequestResult",value:function t(e){var i=this;if(!e){this.requestDataSend=false;this.setError("EMPTY_RESPONSE","Server returned an empty response.");return false}return this.handleChatCreate(e).then((function(){return i.handleChatGet(e)})).then((function(){return i.handleDialogGet(e)}))["catch"]((function(t){var e=t.code,o=t.description;i.setError(e,o)}))["finally"]((function(){i.requestDataSend=false}))}},{key:"handleBatchOpenSessionRequestResult",value:function t(e){var i=this;if(!e){this.requestDataSend=false;this.setError("EMPTY_RESPONSE","Server returned an empty response.");return false}return this.handleChatGet(e).then((function(){return i.handleDialogGet(e)})).then((function(){return i.handleDialogMessagesGet(e)}))["catch"]((function(t){var e=t.code,o=t.description;i.setError(e,o)}))["finally"]((function(){i.requestDataSend=false}))}},{key:"getDataRequestQuery",value:function t(){var e=babelHelpers.defineProperty({},F.widgetConfigGet,[F.widgetConfigGet,{code:this.code}]);if(this.isUserRegistered()){e[F.widgetDialogGet]=[F.widgetDialogGet,{config_id:this.getConfigId(),trace_data:this.getCrmTraceData(),custom_data:this.getCustomData()}];e[S.RestMethodHandler.imChatGet]=[S.RestMethod.imChatGet,{dialog_id:"$result[".concat(F.widgetDialogGet,"][dialogId]")}];e[S.RestMethodHandler.imDialogMessagesGetInit]=[S.RestMethod.imDialogMessagesGet,{chat_id:"$result[".concat(F.widgetDialogGet,"][chatId]"),limit:this.controller.application.getRequestMessageLimit(),convert_text:"Y"}]}else{e[F.widgetUserRegister]=[F.widgetUserRegister,$({config_id:"$result[".concat(F.widgetConfigGet,"][configId]")},this.getUserRegisterFields())];e[S.RestMethodHandler.imChatGet]=[S.RestMethod.imChatGet,{dialog_id:"$result[".concat(F.widgetUserRegister,"][dialogId]")}];if(this.userRegisterData.hash||this.getUserHashCookie()){e[F.widgetDialogGet]=[F.widgetDialogGet,{config_id:"$result[".concat(F.widgetConfigGet,"][configId]"),trace_data:this.getCrmTraceData(),custom_data:this.getCustomData()}];e[S.RestMethodHandler.imDialogMessagesGetInit]=[S.RestMethod.imDialogMessagesGet,{chat_id:"$result[".concat(F.widgetDialogGet,"][chatId]"),limit:this.controller.application.getRequestMessageLimit(),convert_text:"Y"}]}if(this.isUserAgreeConsent()){e[F.widgetUserConsentApply]=[F.widgetUserConsentApply,{config_id:"$result[".concat(F.widgetConfigGet,"][configId]"),consent_url:location.href}]}}e[F.pullServerTime]=[F.pullServerTime,{}];e[F.pullConfigGet]=[F.pullConfigGet,{CACHE:"N"}];e[F.widgetUserGet]=[F.widgetUserGet,{}];return e}},{key:"getOpenSessionQuery",value:function t(e){var i=babelHelpers.defineProperty({},F.widgetDialogGet,[F.widgetDialogGet,{config_id:this.getConfigId(),chat_id:e}]);i[S.RestMethodHandler.imChatGet]=[S.RestMethod.imChatGet,{dialog_id:"chat".concat(e)}];i[S.RestMethodHandler.imDialogMessagesGetInit]=[S.RestMethod.imDialogMessagesGet,{chat_id:e,limit:50,convert_text:"Y"}];return i}},{key:"getCreateChatRequestQuery",value:function t(){var e={};e[F.widgetChatCreate]=[F.widgetChatCreate,$({config_id:this.getConfigId()},this.getUserRegisterFields())];e[S.RestMethodHandler.imChatGet]=[S.RestMethod.imChatGet,{dialog_id:"$result[".concat(F.widgetChatCreate,"][dialogId]")}];e[F.widgetDialogGet]=[F.widgetDialogGet,{config_id:this.getConfigId(),trace_data:this.getCrmTraceData(),custom_data:this.getCustomData()}];if(this.isUserAgreeConsent()){e[F.widgetUserConsentApply]=[F.widgetUserConsentApply,{config_id:this.getConfigId(),consent_url:location.href}]}e[F.pullServerTime]=[F.pullServerTime,{}];e[F.pullConfigGet]=[F.pullConfigGet,{CACHE:"N"}];e[F.widgetUserGet]=[F.widgetUserGet,{}];return e}},{key:"openSession",value:function t(e){var i=this;var o=e.getData();return new Promise((function(t,e){var n=i.controller.getStore().getters["dialogues/get"](o.session.dialogId);if(n){i.controller.getStore().commit("application/set",{dialog:{chatId:o.session.chatId,dialogId:o.session.dialogId,diskFolderId:0}});i.controller.getStore().commit("widget/common",{isCreateSessionMode:false});t();return}i.controller.restClient.callBatch(i.getOpenSessionQuery(o.session.chatId),(function(e){i.handleBatchOpenSessionRequestResult(e).then((function(){i.controller.getStore().commit("widget/common",{isCreateSessionMode:false});t()}))}),false,false)}))}},{key:"prepareFileData",value:function t(e){var i=this;if(!Array.isArray(e)){return e}return e.map((function(t){var e=(window.md5||b.md5)("".concat(i.getUserId(),"|").concat(t.id,"|").concat(i.getUserHash()));var o="livechat_auth_id=".concat(e,"&livechat_user_id=").concat(i.getUserId());if(t.urlPreview){t.urlPreview="".concat(t.urlPreview,"&").concat(o)}if(t.urlShow){t.urlShow="".concat(t.urlShow,"&").concat(o)}if(t.urlDownload){t.urlDownload="".concat(t.urlDownload,"&").concat(o)}return t}))}},{key:"checkRequiredFields",value:function t(){var e=[];if(typeof this.code==="string"&&this.code.length<=0){e.push("LiveChatWidget.constructor: code is not correct (".concat(this.code,")"))}if(typeof this.host==="string"&&(this.host.length<=0||!this.host.startsWith("http"))){e.push("LiveChatWidget.constructor: host is not correct (".concat(this.host,")"))}return e}},{key:"setRootNode",value:function t(){if(this.pageMode&&this.pageMode.placeholder){this.rootNode=this.pageMode.placeholder}else if(document.body.firstChild){document.body.insertBefore(this.rootNode,document.body.firstChild)}else{document.body.append(this.rootNode)}}},{key:"setLocalize",value:function t(){if(babelHelpers["typeof"](this.params.localize)==="object"){this.addLocalize(this.params.localize)}var e=m.LocalStorage.get(this.getSiteId(),0,"serverVariables",false);if(e){this.addLocalize(e)}}},{key:"getWidgetVariables",value:function t(){var e={common:{host:this.getHost(),pageMode:!!this.pageMode,copyright:this.copyright,copyrightUrl:this.copyrightUrl},vote:{messageText:this.getLocalize("BX_LIVECHAT_VOTE_TITLE"),messageLike:this.getLocalize("BX_LIVECHAT_VOTE_PLUS_TITLE"),messageDislike:this.getLocalize("BX_LIVECHAT_VOTE_MINUS_TITLE")},textMessages:{bxLivechatOnlineLine1:this.getLocalize("BX_LIVECHAT_ONLINE_LINE_1"),bxLivechatOnlineLine2:this.getLocalize("BX_LIVECHAT_ONLINE_LINE_2"),bxLivechatOffline:this.getLocalize("BX_LIVECHAT_OFFLINE")}};if(this.params.styles){e.styles={};if(this.params.styles.backgroundColor){e.styles.backgroundColor=this.params.styles.backgroundColor}if(this.params.styles.iconColor){e.styles.iconColor=this.params.styles.iconColor}}return e}},{key:"getRestAuthId",value:function t(){return this.isUserRegistered()?this.getUserHash():W.guest}},{key:"setModelData",value:function t(){if(this.params.location&&O[this.params.location]){this.controller.getStore().commit("widget/common",{location:this.params.location})}}},{key:"checkForErrorsBeforeOpen",value:function t(){var e={error:false,stop:false};if(!this.checkBrowserVersion()){this.setError("OLD_BROWSER_LOCALIZED",this.localize.BX_LIVECHAT_OLD_BROWSER);e.error=true}else if(v.Utils.versionCompare(E.Vue.version(),"2.1")<0){alert(this.localize.BX_LIVECHAT_OLD_VUE);console.error("LiveChatWidget.error: OLD_VUE_VERSION (".concat(this.localize.BX_LIVECHAT_OLD_VUE_DEV.replace("#CURRENT_VERSION#",E.Vue.version()),")"));e.error=true;e.stop=true}else if(this.isSameDomain()){this.setError("LIVECHAT_SAME_DOMAIN",this.localize.BX_LIVECHAT_SAME_DOMAIN);e.error=true}return e}},{key:"isSameDomain",value:function t(){if(typeof BX==="undefined"||!BX.isReady){return false}if(!this.options.checkSameDomain){return false}return this.host.lastIndexOf(".".concat(location.hostname))>-1}},{key:"checkBrowserVersion",value:function t(){if(v.Utils.platform.isIos()){var e=v.Utils.platform.getIosVersion();if(e&&e<=10){return false}}return true}},{key:"startPullClient",value:function t(e){var i=this;return new Promise((function(t,o){if(!i.getUserId()||!i.getSiteId()||!i.restClient){return o({ex:{error:"WIDGET_NOT_LOADED",error_description:"Widget is not loaded."}})}if(i.pullClientInited){if(!i.pullClient.isConnected()){i.pullClient.scheduleReconnect()}return t(true)}i.controller.userId=i.getUserId();i.pullClient.userId=i.getUserId();i.pullClient.configTimestamp=e?e.server.config_timestamp:0;i.pullClient.skipStorageInit=false;i.pullClient.storage=u.PullClient.StorageManager({userId:i.getUserId(),siteId:i.getSiteId()});i.pullClient.subscribe(new G({store:i.controller.getStore(),controller:i.controller,widget:i}));i.pullClient.subscribe(new X({store:i.controller.getStore(),controller:i.controller,widget:i}));i.pullClient.subscribe({type:u.PullClient.SubscriptionType.Status,callback:i.eventStatusInteraction.bind(i)});i.pullConnectedFirstTime=i.pullClient.subscribe({type:u.PullClient.SubscriptionType.Status,callback:function e(o){if(o.status===u.PullClient.PullStatus.Online){t(true);i.pullConnectedFirstTime()}}});if(i.template){i.template.$Bitrix.PullClient.set(i.pullClient)}i.pullClient.start($($({},e),{},{skipReconnectToLastSession:true}))["catch"]((function(){o({ex:{error:"PULL_CONNECTION_ERROR",error_description:"Pull is not connected."}})}));i.pullClientInited=true}))}},{key:"stopPullClient",value:function t(){if(this.pullClient){this.pullClient.stop(u.PullClient.CloseReasons.MANUAL,"Closed manually")}}},{key:"recoverPullConnection",value:function t(){this.pullClient.restart(u.PullClient.CloseReasons.MANUAL,"Restart after click by connection status button.")}},{key:"eventStatusInteraction",value:function t(e){if(e.status===u.PullClient.PullStatus.Online){this.onPullOnlineStatus()}else if(e.status===u.PullClient.PullStatus.Offline){this.pullRequestMessage=true;this.offline=true}}},{key:"onPullOnlineStatus",value:function t(){var e=this;this.offline=false;if(this.pullRequestMessage){this.controller.pullBaseHandler.option.skip=true;y.Logger.warn("Requesting getDialogUnread after going online");H.EventEmitter.emitAsync(S.EventType.dialog.requestUnread,{chatId:this.controller.application.getChatId()}).then((function(){H.EventEmitter.emit(S.EventType.dialog.scrollOnStart,{chatId:e.controller.application.getChatId()});e.controller.pullBaseHandler.option.skip=false;H.EventEmitter.emit(N.processMessagesToSendQueue)}))["catch"]((function(){e.controller.pullBaseHandler.option.skip=false}));this.pullRequestMessage=false}else{H.EventEmitter.emit(S.EventType.dialog.readMessage);H.EventEmitter.emit(N.processMessagesToSendQueue)}}},{key:"attachTemplate",value:function t(){if(this.template){this.controller.getStore().commit("widget/common",{showed:true});return true}this.rootNode.innerHTML="";this.rootNode.append(document.createElement("div"));var e=this;return this.controller.createVue(e,{el:this.rootNode.firstChild,template:"<bx-livechat/>",beforeCreate:function t(){e.sendEvent({type:A.widgetOpen,data:{}});e.template=this;if(x.ZIndexManager!==undefined){var i=x.ZIndexManager.getOrAddStack(document.body);i.setBaseIndex(1e6);this.$bitrix.Data.set("zIndexStack",i)}},destroyed:function t(){e.sendEvent({type:A.widgetClose,data:{}});e.template=null;e.templateAttached=false;e.rootNode.innerHTML=""}}).then((function(){return new Promise((function(t,e){return t()}))}))}},{key:"detachTemplate",value:function t(){if(!this.template){return true}this.template.$destroy();return true}},{key:"mutateTemplateComponent",value:function t(e,i){return E.Vue.mutateComponent(e,i)}},{key:"close",value:function t(){if(this.pageMode){return false}if(this.buttonInstance){this.buttonInstance.onWidgetClose()}this.detachTemplate()}},{key:"fireInitEvent",value:function t(){if(this.initEventFired){return true}this.sendEvent({type:A.configLoaded,data:{}});if(this.controller.getStore().state.widget.common.reopen){this.open()}this.initEventFired=true}},{key:"isUserRegistered",value:function t(){return!!this.getUserHash()}},{key:"isConfigDataLoaded",value:function t(){return this.controller.getStore().state.widget.common.configId}},{key:"isChatLoaded",value:function t(){return this.controller.getStore().state.application.dialog.chatId>0}},{key:"isSessionActive",value:function t(){return!this.controller.getStore().state.widget.dialog.sessionClose}},{key:"isUserAgreeConsent",value:function t(){return this.controller.getStore().state.widget.dialog.userConsent}},{key:"getCrmTraceData",value:function t(){var e="";if(!this.buttonInstance){return e}if(typeof this.buttonInstance.getTrace!=="function"){e=this.buttonInstance.getTrace()}else if(typeof this.buttonInstance.b24Tracker!=="undefined"&&typeof this.buttonInstance.b24Tracker.guest!=="undefined"){e=this.buttonInstance.b24Tracker.guest.getTrace()}return e}},{key:"getCustomData",value:function t(){var e=[];if(this.customData.length>0){e=this.customData}else{e=[{MESSAGE:this.localize.BX_LIVECHAT_EXTRA_SITE+": [URL]"+location.href+"[/URL]"}]}return JSON.stringify(e)}},{key:"isUserLoaded",value:function t(){return this.controller.getStore().state.widget.user.id>0}},{key:"isUserReady",value:function t(){return this.isConfigDataLoaded()&&this.isUserRegistered()}},{key:"isHashAvailable",value:function t(){return!this.isUserRegistered()&&(this.userRegisterData.hash||this.getUserHashCookie())}},{key:"getSiteId",value:function t(){return this.host.replace(/(http.?:\/\/)|([:.\\\/])/gm,"")+this.code}},{key:"getHost",value:function t(){return this.host}},{key:"getConfigId",value:function t(){return this.controller.getStore().state.widget.common.configId}},{key:"isDialogStart",value:function t(){return this.controller.getStore().state.widget.common.dialogStart}},{key:"getChatId",value:function t(){return this.controller.getStore().state.application.dialog.chatId}},{key:"getDialogId",value:function t(){return this.controller.getStore().state.application.dialog.dialogId}},{key:"getDiskFolderId",value:function t(){return this.controller.getStore().state.application.dialog.diskFolderId}},{key:"getDialogData",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getDialogId();return this.controller.getStore().state.dialogues.collection[e]}},{key:"getSessionId",value:function t(){return this.controller.getStore().state.widget.dialog.sessionId}},{key:"isSessionClose",value:function t(){return this.controller.getStore().state.widget.dialog.sessionClose}},{key:"getUserHash",value:function t(){return this.controller.getStore().state.widget.user.hash}},{key:"getUserHashCookie",value:function t(){var e="";var i=f.Cookie.get(null,"LIVECHAT_HASH");if(typeof i==="string"&&i.match(/^[a-f0-9]{32}$/)){e=i}else{var o=f.Cookie.get(this.getSiteId(),"LIVECHAT_HASH");if(typeof o==="string"&&o.match(/^[a-f0-9]{32}$/)){e=o}}return e}},{key:"getUserId",value:function t(){return this.controller.getStore().state.widget.user.id}},{key:"getUserData",value:function t(){if(!this.controller||!this.controller.getStore()){console.error("LiveChatWidget.getUserData: method can be called after fired event - onBitrixLiveChat");return false}return this.controller.getStore().state.widget.user}},{key:"getUserRegisterFields",value:function t(){return{name:this.userRegisterData.name||"",last_name:this.userRegisterData.lastName||"",avatar:this.userRegisterData.avatar||"",email:this.userRegisterData.email||"",www:this.userRegisterData.www||"",gender:this.userRegisterData.gender||"",position:this.userRegisterData.position||"",user_hash:this.userRegisterData.hash||this.getUserHashCookie()||"",consent_url:this.controller.getStore().state.widget.common.consentUrl?location.href:"",trace_data:this.getCrmTraceData(),custom_data:this.getCustomData()}}},{key:"getWidgetLocationCode",value:function t(){return O[this.controller.getStore().state.widget.common.location]}},{key:"setUserRegisterData",value:function t(e){if(!this.controller||!this.controller.getStore()){console.error("LiveChatWidget.getUserData: method can be called after fired event - onBitrixLiveChat");return false}var i=["hash","name","lastName","avatar","email","www","gender","position"];if(!v.Utils.types.isPlainObject(e)){console.error("%cLiveChatWidget.setUserData: params is not a object","color: black;");return false}for(var o in this.userRegisterData){if(!this.userRegisterData.hasOwnProperty(o)){continue}if(!e[o]){delete this.userRegisterData[o]}}for(var n in e){if(!e.hasOwnProperty(n)){continue}if(i.indexOf(n)===-1){console.warn("%cLiveChatWidget.setUserData: user field is not set, because you are trying to set an unknown field (%c".concat(n,"%c)"),"color: black;","font-weight: bold; color: red","color: black");continue}this.userRegisterData[n]=e[n]}if(this.userRegisterData.hash&&this.getUserHash()&&this.userRegisterData.hash!==this.getUserHash()){this.setNewAuthToken(this.userRegisterData.hash)}}},{key:"setNewAuthToken",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";this.controller.getStoreBuilder().clearModelState();f.Cookie.set(null,"LIVECHAT_HASH","",{expires:365*86400,path:"/"});this.controller.restClient.setAuthId(W.guest,e)}},{key:"setOption",value:function t(e,i){this.options[e]=i;return true}},{key:"setCustomData",value:function t(e){if(!this.controller||!this.controller.getStore()){console.error("LiveChatWidget.getUserData: method can be called after fired event - onBitrixLiveChat");return false}var i=[];if(e instanceof Array){e.forEach((function(t){if(t&&babelHelpers["typeof"](t)==="object"){i.push(t)}}));if(i.length<=0){console.error("LiveChatWidget.setCustomData: params is empty");return false}}else{if(!e){return false}i=[{MESSAGE:e}]}this.customData=this.customData.concat(i);return true}},{key:"setError",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";console.error("LiveChatWidget.error: ".concat(e," (").concat(i,")"));var o="";if(e==="LIVECHAT_AUTH_FAILED"){o=this.getLocalize("BX_LIVECHAT_AUTH_FAILED").replace("#LINK_START#",'<a href="javascript:void();" onclick="location.reload()">').replace("#LINK_END#","</a>");this.setNewAuthToken()}else if(e==="LIVECHAT_AUTH_PORTAL_USER"){o=this.getLocalize("BX_LIVECHAT_PORTAL_USER_NEW").replace("#LINK_START#",'<a href="'+this.host+'">').replace("#LINK_END#","</a>")}else if(e==="LIVECHAT_SAME_DOMAIN"){o=this.getLocalize("BX_LIVECHAT_SAME_DOMAIN");var n=this.getLocalize("BX_LIVECHAT_SAME_DOMAIN_LINK");if(n){o+='<br><br><a href="'+n+'">'+this.getLocalize("BX_LIVECHAT_SAME_DOMAIN_MORE")+"</a>"}}else if(e.endsWith("LOCALIZED")){o=i}this.controller.getStore().commit("application/set",{error:{active:true,code:e,description:o}})}},{key:"clearError",value:function t(){this.controller.getStore().commit("application/set",{error:{active:false,code:"",description:""}})}},{key:"subscribe",value:function t(e){if(!v.Utils.types.isPlainObject(e)){console.error("%cLiveChatWidget.subscribe: params is not a object","color: black;");return false}if(!R.includes(e.type)){console.error("%cLiveChatWidget.subscribe: subscription type is not correct (%c".concat(e.type,"%c)"),"color: black;","font-weight: bold; color: red","color: black");return false}if(typeof e.callback!=="function"){console.error("%cLiveChatWidget.subscribe: callback is not a function (%c".concat(babelHelpers["typeof"](e.callback),"%c)"),"color: black;","font-weight: bold; color: red","color: black");return false}if(typeof this.subscribers[e.type]==="undefined"){this.subscribers[e.type]=[]}this.subscribers[e.type].push(e.callback);return function(){this.subscribers[e.type]=this.subscribers[e.type].filter((function(t){return t!==e.callback}))}.bind(this)}},{key:"sendEvent",value:function t(e){e=e||{};if(!e.type){return false}if(babelHelpers["typeof"](e.data)!=="object"||!e.data){e.data={}}if(this.subscribers[e.type]instanceof Array&&this.subscribers[e.type].length>0){this.subscribers[e.type].forEach((function(t){return t(e.data)}))}if(this.subscribers[A.every]instanceof Array&&this.subscribers[A.every].length>0){this.subscribers[A.every].forEach((function(t){return t({type:e.type,data:e.data})}))}return true}},{key:"addLocalize",value:function t(e){if(babelHelpers["typeof"](e)!=="object"||!e){return false}for(var i in e){if(e.hasOwnProperty(i)){this.localize[i]=e[i]}}return true}},{key:"getLocalize",value:function t(e){var i="";if(typeof e==="undefined"){return this.localize}else if(typeof this.localize[e.toString()]==="undefined"){console.warn("LiveChatWidget.getLocalize: message with code '".concat(e.toString(),"' is undefined."))}else{i=this.localize[e]}return i}},{key:"handleConfigGet",value:function t(e){var i=this;return new Promise((function(t,o){var n=e[F.widgetConfigGet];if(n&&n.error()){return o({code:n.error().ex.error,description:n.error().ex.error_description})}i.controller.executeRestAnswer(F.widgetConfigGet,n);t()}))}},{key:"handleUserGet",value:function t(e){var i=this;return new Promise((function(t,o){var n=e[F.widgetUserGet];if(n.error()){return o({code:n.error().ex.error,description:n.error().ex.error_description})}i.controller.executeRestAnswer(F.widgetUserGet,n);t()}))}},{key:"handleChatGet",value:function t(e){var i=this;return new Promise((function(t,o){var n=e[S.RestMethodHandler.imChatGet];if(n.error()){return o({code:n.error().ex.error,description:n.error().ex.error_description})}i.controller.executeRestAnswer(S.RestMethodHandler.imChatGet,n);t()}))}},{key:"handleDialogGet",value:function t(e){var i=this;return new Promise((function(t,o){var n=e[F.widgetDialogGet];if(!n){return t()}if(n.error()){return o({code:n.error().ex.error,description:n.error().ex.error_description})}i.controller.executeRestAnswer(F.widgetDialogGet,n);t()}))}},{key:"handleDialogMessagesGet",value:function t(e){var i=this;return new Promise((function(t,o){var n=e[S.RestMethodHandler.imDialogMessagesGetInit];if(!n){return t()}if(n.error()){return o({code:n.error().ex.error,description:n.error().ex.error_description})}i.controller.getStore().dispatch("dialogues/saveDialog",{dialogId:i.controller.application.getDialogId(),chatId:i.controller.application.getChatId()});i.controller.executeRestAnswer(S.RestMethodHandler.imDialogMessagesGetInit,n);t()}))}},{key:"handleUserRegister",value:function t(e){var i=this;return new Promise((function(t,o){var n=e[F.widgetUserRegister];if(!n){return t()}if(n.error()){return o({code:n.error().ex.error,description:n.error().ex.error_description})}i.controller.executeRestAnswer(F.widgetUserRegister,n);t()}))}},{key:"handleChatCreate",value:function t(e){var i=this;return new Promise((function(t,o){var n=e[F.widgetChatCreate];if(!n){return t()}if(n.error()){return o({code:n.error().ex.error,description:n.error().ex.error_description})}i.controller.executeRestAnswer(F.widgetChatCreate,n);t()}))}},{key:"handlePullRequests",value:function t(e){var i=this;return new Promise((function(t){var o=0;var n=e[F.pullServerTime];if(n&&!n.error()){o=Math.floor((Date.now()-new Date(n.data()).getTime())/1e3)}var s=null;var r=e[F.pullConfigGet];if(r&&!r.error()){s=r.data();s.server.timeShift=o}i.startPullClient(s).then((function(){H.EventEmitter.emit(N.processMessagesToSendQueue)}))["catch"]((function(t){i.setError(t.ex.error,t.ex.error_description)}))["finally"](t)}))}}]);return t}();var Y=function(){function t(e){babelHelpers.classCallCheck(this,t);this.developerInfo="Do not use private methods.";this.__privateMethods__=new Q(e);this.__createLegacyMethods()}babelHelpers.createClass(t,[{key:"open",value:function t(e){return this.__privateMethods__.open(e)}},{key:"close",value:function t(){return this.__privateMethods__.close()}},{key:"showNotification",value:function t(e){return this.__privateMethods__.showNotification(e)}},{key:"getUserData",value:function t(){return this.__privateMethods__.getUserData()}},{key:"setUserRegisterData",value:function t(e){return this.__privateMethods__.setUserRegisterData(e)}},{key:"setCustomData",value:function t(e){return this.__privateMethods__.setCustomData(e)}},{key:"mutateTemplateComponent",value:function t(e,i){return this.__privateMethods__.mutateTemplateComponent(e,i)}},{key:"addLocalize",value:function t(e){return this.__privateMethods__.addLocalize(e)}},{key:"subscribe",value:function t(e){return this.__privateMethods__.subscribe(e)}},{key:"start",value:function t(){return this.__privateMethods__.start()}},{key:"__createLegacyMethods",value:function t(){var e=this;if(typeof window.BX.LiveChat==="undefined"){var i=document.createElement("a");i.href=this.__privateMethods__.host;var o=i.protocol+"//"+i.hostname+(i.port&&i.port!="80"&&i.port!="443"?":"+i.port:"");window.BX.LiveChat={openLiveChat:function t(){e.open({openFromButton:true})},closeLiveChat:function t(){e.close()},addEventListener:function t(i,n,s){if(n==="message"){e.subscribe({type:A.userMessage,callback:function t(e){s({origin:o,data:JSON.stringify({action:"sendMessage"}),event:e})}})}else{console.warn("Method BX.LiveChat.addEventListener is not supported, user new format for subscribe.")}},setCookie:function t(){},getCookie:function t(){},sourceDomain:o}}if(typeof window.BxLiveChatInit==="function"){var n=window.BxLiveChatInit();if(n.user){this.__privateMethods__.setUserRegisterData(n.user)}if(n.firstMessage){this.__privateMethods__.setCustomData(n.firstMessage)}}if(window.BxLiveChatLoader instanceof Array){window.BxLiveChatLoader.forEach((function(t){return t()}))}return true}}]);return t}();var K=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"application",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"storedMessage",null);i.application=t.Application.get();i.onProcessQueueHandler=i.processQueue.bind(babelHelpers.assertThisInitialized(i));i.onConsentAcceptedHandler=i.onConsentAccepted.bind(babelHelpers.assertThisInitialized(i));i.onConsentDeclinedHandler=i.onConsentDeclined.bind(babelHelpers.assertThisInitialized(i));H.EventEmitter.subscribe(N.processMessagesToSendQueue,i.onProcessQueueHandler);H.EventEmitter.subscribe(N.consentAccepted,i.onConsentAcceptedHandler);H.EventEmitter.subscribe(N.consentDeclined,i.onConsentDeclinedHandler);return i}babelHelpers.createClass(e,[{key:"destroy",value:function t(){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"destroy",this).call(this);H.EventEmitter.unsubscribe(N.processMessagesToSendQueue,this.onProcessQueueHandler);H.EventEmitter.unsubscribe(N.consentAccepted,this.onConsentAcceptedHandler);H.EventEmitter.unsubscribe(N.consentDeclined,this.onConsentDeclinedHandler)}},{key:"onSendMessage",value:function t(e){var i=this;var o=e.data;o.focus=o.focus!==false;if(this.getWidgetData().common.showForm===L.smile){H.EventEmitter.emit(N.hideForm)}if(!this.getWidgetData().dialog.userConsent&&this.getWidgetData().common.consentUrl){if(o.text){this.storedMessage=o.text}H.EventEmitter.emit(N.showConsent);return false}o.text=o.text?o.text:this.storedMessage;if(!o.text&&!o.file){return false}H.EventEmitter.emit(N.hideForm);if(this.isCreateSessionMode()){H.EventEmitter.emit(N.hideForm);H.EventEmitter.emit(S.EventType.textarea.stopWriting);H.EventEmitter.emitAsync(N.createSession).then((function(){i.store.commit("widget/common",{isCreateSessionMode:false});i.sendMessage(o.text,o.file)}))}else{this.sendMessage(o.text,o.file)}if(o.focus){H.EventEmitter.emit(S.EventType.textarea.setFocus)}return true}},{key:"sendMessage",value:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var o=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!i&&!o){return false}var n=this.store.getters["dialogues/getQuoteId"](this.getDialogId());if(n){var s=this.store.getters["messages/getMessage"](this.getChatId(),n);if(s){i=this.getMessageTextWithQuote(s,i);H.EventEmitter.emit(S.EventType.dialog.quotePanelClose)}}if(!this.controller.application.isUnreadMessagesLoaded()){this.sendMessageToServer({id:0,chatId:this.getChatId(),dialogId:this.getDialogId(),text:i,file:o});this.processQueue();return true}var r={};if(o){r.FILE_ID=[o.id]}this.addMessageToModel({text:i,params:r,sending:!o}).then((function(t){if(!e.isDialogStart()){e.store.commit("widget/common",{dialogStart:true})}H.EventEmitter.emit(S.EventType.dialog.scrollToBottom,{chatId:e.getChatId(),cancelIfScrollChange:true});e.addMessageToQueue({messageId:t,text:i,file:o});if(e.getChatId()){e.processQueue()}else{H.EventEmitter.emit(N.requestData)}}));return true}},{key:"onClickOnKeyboard",value:function t(e){var i=e.data;if(i.action==="ACTION"&&i.params.action==="LIVECHAT"){var o=i.params,n=o.dialogId,s=o.messageId,r=o.value;var a=JSON.parse(r);var l=Number.parseInt(a.SESSION_ID,10);if(l!==this.getSessionId()||this.isSessionClose()){console.error("WidgetSendMessageHandler",this.loc["BX_LIVECHAT_ACTION_EXPIRED"]);return false}this.restClient.callMethod(F.widgetActionSend,{MESSAGE_ID:s,DIALOG_ID:n,ACTION_VALUE:r})}if(i.action==="COMMAND"){var c=i.params,d=c.dialogId,h=c.messageId,u=c.botId,g=c.command,p=c.params;this.restClient.callMethod(S.RestMethod.imMessageCommand,{MESSAGE_ID:h,DIALOG_ID:d,BOT_ID:u,COMMAND:g,COMMAND_PARAMS:p})["catch"]((function(t){return console.error("WidgetSendMessageHandler: command processing error",t)}))}}},{key:"getWidgetData",value:function t(){return this.store.state.widget}},{key:"getChatId",value:function t(){return this.store.state.application.dialog.chatId}},{key:"getDialogId",value:function t(){return this.store.state.application.dialog.dialogId}},{key:"getUserId",value:function t(){return this.store.state.widget.user.id}},{key:"getMessageTextWithQuote",value:function t(e,i){var o=null;if(e.authorId){o=this.store.getters["users/get"](e.authorId)}var n=this.store.getters["files/getList"](this.getChatId());var s="-".repeat(54);var r=o&&o.name?o.name:this.loc["BX_LIVECHAT_SYSTEM_MESSAGE"];var a=v.Utils.date.format(e.date,null,this.loc);var l=v.Utils.text.quote(e.text,e.params,n,this.loc);var c=[];c.push(s);c.push("".concat(r," [").concat(a,"]"));c.push(l);c.push(s);c.push(i);return c.join("\n")}},{key:"addMessageToQueue",value:function t(e){var i=e.messageId,o=e.text,n=e.file;this.messagesToSend.push({id:i,chatId:this.getChatId(),dialogId:this.getDialogId(),text:o,file:n,sending:false})}},{key:"sendMessageToServer",value:function t(e){var i=this;H.EventEmitter.emit(S.EventType.textarea.stopWriting);if(e.chatId===0){e.chatId=this.getChatId()}this.restClient.callMethod(S.RestMethod.imMessageAdd,{TEMPLATE_ID:e.id,CHAT_ID:e.chatId,MESSAGE:e.text},null,null,v.Utils.getLogTrackingParams({name:S.RestMethod.imMessageAdd,data:{timMessageType:"text"},dialog:this.getDialogData()})).then((function(t){i.controller.executeRestAnswer(S.RestMethodHandler.imMessageAdd,t,e)}))["catch"]((function(t){i.controller.executeRestAnswer(S.RestMethodHandler.imMessageAdd,t,e);y.Logger.warn("Error during sending message",t)}));return true}},{key:"isDialogStart",value:function t(){return this.store.state.widget.common.dialogStart}},{key:"isCreateSessionMode",value:function t(){return this.store.state.widget.common.isCreateSessionMode}},{key:"getDialogData",value:function t(){var e=this.getDialogId();return this.store.state.dialogues.collection[e]}},{key:"getApplicationModel",value:function t(){return this.store.state.application}},{key:"getSessionId",value:function t(){return this.store.state.widget.dialog.sessionId}},{key:"isSessionClose",value:function t(){return this.store.state.widget.dialog.sessionClose}},{key:"processQueue",value:function t(){var e=this;if(this.application.offline){return false}this.messagesToSend.filter((function(t){return!t.sending})).forEach((function(t){e.deleteFromQueue(t.id);t.sending=true;if(t.file){H.EventEmitter.emit(S.EventType.textarea.stopWriting);H.EventEmitter.emit(S.EventType.uploader.addMessageWithFile,t)}else{e.sendMessageToServer(t)}}))}},{key:"onConsentAccepted",value:function t(){if(!this.storedMessage){return}var e=this.getApplicationModel().device.type!==S.DeviceType.mobile;this.onSendMessage({data:{focus:e}});this.storedMessage=""}},{key:"onConsentDeclined",value:function t(){if(!this.storedMessage){return}H.EventEmitter.emit(S.EventType.textarea.insertText,{text:this.storedMessage,focus:this.getApplicationModel().device.type!==S.DeviceType.mobile});this.storedMessage=""}}]);return e}(C.SendMessageHandler);var Z=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"application",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"pullClient",null);i.application=t.Application.get();i.pullClient=t.PullClient.get();return i}babelHelpers.createClass(e,[{key:"onAppButtonClick",value:function t(e){var i=e.data;if(i.appId===L.smile){if(this.getWidgetModel().common.showForm===L.smile){H.EventEmitter.emit(N.hideForm)}else{H.EventEmitter.emit(N.showForm,{type:L.smile})}}else{H.EventEmitter.emit(S.EventType.textarea.setFocus)}}},{key:"onFocus",value:function t(){var e=this;if(this.getWidgetModel().common.copyright&&this.getApplicationModel().device.type===S.DeviceType.mobile){this.getWidgetModel().common.copyright=false}if(v.Utils.device.isMobile()){clearTimeout(this.onFocusScrollTimeout);this.onScrollHandler=this.onScroll.bind(this);this.onFocusScrollTimeout=setTimeout((function(){document.addEventListener("scroll",e.onScrollHandler)}),1e3)}}},{key:"onBlur",value:function t(){var e=this;if(!this.getWidgetModel().common.copyright&&this.getWidgetModel().common.copyright!==this.application.copyright){this.getWidgetModel().common.copyright=this.application.copyright;setTimeout((function(){H.EventEmitter.emit(S.EventType.dialog.scrollToBottom,{chatId:e.getChatId(),force:true})}),100)}if(v.Utils.device.isMobile()){clearTimeout(this.onFocusScrollTimeout);document.removeEventListener("scroll",this.onScrollHandler)}}},{key:"onKeyUp",value:function t(e){var i=e.data;if(this.canSendTypedText()){var o=this.getWidgetModel().dialog.sessionId;var n=this.getChatId();var s=this.getWidgetModel().user.id;var r=b.md5("".concat(o,"/").concat(n,"/").concat(s));var a=this.getWidgetModel().dialog.operator.id;var l=this.getWidgetModel().dialog.operatorChatId;this.pullClient.sendMessage([a],"imopenlines","linesMessageWrite",{text:i.text,infoString:r,operatorChatId:l})}}},{key:"canSendTypedText",value:function t(){return this.getWidgetModel().common.watchTyping&&this.getWidgetModel().dialog.sessionId&&!this.getWidgetModel().dialog.sessionClose&&this.getWidgetModel().dialog.operator.id&&this.getWidgetModel().dialog.operatorChatId&&this.pullClient.isPublishingEnabled()}},{key:"onScroll",value:function t(){clearTimeout(this.onScrollTimeout);this.onScrollTimeout=setTimeout((function(){H.EventEmitter.emit(S.EventType.textarea.setBlur,true)}),50)}},{key:"getWidgetModel",value:function t(){return this.store.state.widget}},{key:"getApplicationModel",value:function t(){return this.store.state.application}}]);return e}(C.TextareaHandler);var J=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"storedFile",null);i.onConsentAcceptedHandler=i.onConsentAccepted.bind(babelHelpers.assertThisInitialized(i));i.onConsentDeclinedHandler=i.onConsentDeclined.bind(babelHelpers.assertThisInitialized(i));H.EventEmitter.subscribe(N.consentAccepted,i.onConsentAcceptedHandler);H.EventEmitter.subscribe(N.consentDeclined,i.onConsentDeclinedHandler);return i}babelHelpers.createClass(e,[{key:"destroy",value:function t(){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"destroy",this).call(this);H.EventEmitter.unsubscribe(N.consentAccepted,this.onConsentAcceptedHandler);H.EventEmitter.unsubscribe(N.consentDeclined,this.onConsentDeclinedHandler)}},{key:"getUserId",value:function t(){return this.controller.store.state.widget.user.id}},{key:"getUserHash",value:function t(){return this.controller.store.state.widget.user.hash}},{key:"getHost",value:function t(){return this.controller.store.state.widget.common.host}},{key:"addMessageWithFile",value:function t(e){var i=this;var o=e.getData();if(!this.getDiskFolderId()){this.requestDiskFolderId(o.chatId).then((function(){i.addMessageWithFile(e)}))["catch"]((function(t){y.Logger.error("addMessageWithFile error",t);return false}));return false}this.uploader.senderOptions.customHeaders["Livechat-Dialog-Id"]=this.getDialogId();this.uploader.senderOptions.customHeaders["Livechat-Auth-Id"]=this.getUserHash();this.uploader.addTask({taskId:o.file.id,fileData:o.file.source.file,fileName:o.file.source.file.name,generateUniqueName:true,diskFolderId:this.getDiskFolderId(),previewBlob:o.file.previewBlob})}},{key:"onTextareaFileSelected",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},i=e.data;var o=null;if(i&&i.fileChangeEvent&&i.fileChangeEvent.target.files.length>0){o=i.fileChangeEvent}else{o=this.storedFile}if(!o){return false}if(!this.controller.store.state.widget.dialog.userConsent&&this.controller.store.state.widget.common.consentUrl){this.storedFile=i.fileChangeEvent;H.EventEmitter.emit(N.showConsent);return false}this.uploadFile(o)}},{key:"uploadFile",value:function t(e){if(!e){return false}if(!this.getChatId()){H.EventEmitter.emit(N.requestData)}this.uploader.addFilesFromEvent(e)}},{key:"onConsentAccepted",value:function t(){if(!this.storedFile){return}this.onTextareaFileSelected();this.storedFile=""}},{key:"onConsentDeclined",value:function t(){if(!this.storedFile){return}this.storedFile=""}},{key:"getUploaderSenderOptions",value:function t(){return{host:this.getHost(),customHeaders:{"Livechat-Auth-Id":this.getUserHash()},actionUploadChunk:"imopenlines.widget.disk.upload",actionCommitFile:"imopenlines.widget.disk.commit",actionRollbackUpload:"imopenlines.widget.disk.rollbackUpload"}}}]);return e}(C.TextareaUploadHandler);var tt=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"application",null);i.application=t.Application.get();return i}babelHelpers.createClass(e,[{key:"readMessage",value:function t(i){var o=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(this.application.offline){return false}return babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"readMessage",this).call(this,i,o,n)}}]);return e}(C.ReadingHandler);var et=function(t){babelHelpers.inherits(e,t);function e(t){var i;var o=t.widgetLocation,n=t.availableWidth,s=t.availableHeight,r=t.events;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"isResizing",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"widgetLocation",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"availableWidth",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"availableHeight",null);i.setEventNamespace("BX.IMOL.WidgetResizeHandler");i.subscribeToEvents(r);i.widgetLocation=o;i.availableWidth=n;i.availableHeight=s;return i}babelHelpers.createClass(e,[{key:"subscribeToEvents",value:function t(e){var i=this;var o=w.Type.isObject(e)?e:{};Object.entries(o).forEach((function(t){var e=babelHelpers.slicedToArray(t,2),o=e[0],n=e[1];if(w.Type.isFunction(n)){i.subscribe(o,n)}}))}},{key:"startResize",value:function t(e,i,o){if(this.isResizing){return false}this.isResizing=true;e=e.changedTouches?e.changedTouches[0]:e;this.cursorStartPointY=e.clientY;this.cursorStartPointX=e.clientX;this.heightStartPoint=i;this.widthStartPoint=o;this.addWidgetResizeEvents()}},{key:"onContinueResize",value:function t(i){if(!this.isResizing){return false}i=i.changedTouches?i.changedTouches[0]:i;this.cursorControlPointY=i.clientY;this.cursorControlPointX=i.clientX;var o=this.isBottomLocation()?Math.min(this.heightStartPoint+this.cursorStartPointY-this.cursorControlPointY,this.availableHeight):Math.min(this.heightStartPoint-this.cursorStartPointY+this.cursorControlPointY,this.availableHeight);var n=Math.max(o,_.height);var s=this.isLeftLocation()?Math.min(this.widthStartPoint-this.cursorStartPointX+this.cursorControlPointX,this.availableWidth):Math.min(this.widthStartPoint+this.cursorStartPointX-this.cursorControlPointX,this.availableWidth);var r=Math.max(s,_.width);this.emit(e.events.onSizeChange,{newHeight:n,newWidth:r})}},{key:"onStopResize",value:function t(){if(!this.isResizing){return false}this.isResizing=false;this.removeWidgetResizeEvents();this.emit(e.events.onStopResize)}},{key:"setAvailableWidth",value:function t(e){this.availableWidth=e}},{key:"setAvailableHeight",value:function t(e){this.availableHeight=e}},{key:"addWidgetResizeEvents",value:function t(){this.onContinueResizeHandler=this.onContinueResize.bind(this);this.onStopResizeHandler=this.onStopResize.bind(this);document.addEventListener("mousemove",this.onContinueResizeHandler);document.addEventListener("mouseup",this.onStopResizeHandler);document.addEventListener("mouseleave",this.onStopResizeHandler)}},{key:"removeWidgetResizeEvents",value:function t(){document.removeEventListener("mousemove",this.onContinueResizeHandler);document.removeEventListener("mouseup",this.onStopResizeHandler);document.removeEventListener("mouseleave",this.onStopResizeHandler)}},{key:"isBottomLocation",value:function t(){return[D.bottomLeft,D.bottomMiddle,D.bottomRight].includes(this.widgetLocation)}},{key:"isLeftLocation",value:function t(){return[D.bottomLeft,D.topLeft,D.topMiddle].includes(this.widgetLocation)}},{key:"destroy",value:function t(){this.removeWidgetResizeEvents()}}]);return e}(H.EventEmitter);babelHelpers.defineProperty(et,"events",{onSizeChange:"onSizeChange",onStopResize:"onStopResize"});var it=function(){function t(e){babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"store",null);babelHelpers.defineProperty(this,"restClient",null);babelHelpers.defineProperty(this,"application",null);this.store=e.Data.get("controller").store;this.restClient=e.RestClient.get();this.application=e.Application.get();this.subscribeToEvents()}babelHelpers.createClass(t,[{key:"subscribeToEvents",value:function t(){this.showConsentHandler=this.onShowConsent.bind(this);this.acceptConsentHandler=this.onAcceptConsent.bind(this);this.declineConsentHandler=this.onDeclineConsent.bind(this);H.EventEmitter.subscribe(N.showConsent,this.showConsentHandler);H.EventEmitter.subscribe(N.acceptConsent,this.acceptConsentHandler);H.EventEmitter.subscribe(N.declineConsent,this.declineConsentHandler)}},{key:"onShowConsent",value:function t(){this.showConsent()}},{key:"onAcceptConsent",value:function t(){this.acceptConsent()}},{key:"onDeclineConsent",value:function t(){this.declineConsent()}},{key:"showConsent",value:function t(){this.store.commit("widget/common",{showConsent:true})}},{key:"hideConsent",value:function t(){this.store.commit("widget/common",{showConsent:false})}},{key:"acceptConsent",value:function t(){this.hideConsent();this.sendConsentDecision(true);H.EventEmitter.emit(N.consentAccepted);if(this.getWidgetModel().common.showForm===L.none){H.EventEmitter.emit(S.EventType.textarea.setFocus)}}},{key:"declineConsent",value:function t(){H.EventEmitter.emit(N.hideForm);this.hideConsent();this.sendConsentDecision(false);H.EventEmitter.emit(N.consentDeclined);if(this.getApplicationModel().device.type!==S.DeviceType.mobile){H.EventEmitter.emit(S.EventType.textarea.setFocus)}}},{key:"sendConsentDecision",value:function t(e){this.store.commit("widget/dialog",{userConsent:e});if(e&&this.application.isUserRegistered()){this.restClient.callMethod(F.widgetUserConsentApply,{config_id:this.getWidgetModel().common.configId,consent_url:location.href})}}},{key:"getWidgetModel",value:function t(){return this.store.state.widget}},{key:"getApplicationModel",value:function t(){return this.store.state.application}},{key:"destroy",value:function t(){H.EventEmitter.unsubscribe(N.showConsent,this.showConsentHandler);H.EventEmitter.unsubscribe(N.acceptConsent,this.acceptConsentHandler);H.EventEmitter.unsubscribe(N.declineConsent,this.declineConsentHandler)}}]);return t}();var ot=function(){function t(e){babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"store",null);babelHelpers.defineProperty(this,"application",null);babelHelpers.defineProperty(this,"restClient",null);this.store=e.Data.get("controller").store;this.restClient=e.RestClient.get();this.application=e.Application.get();this.showFormHandler=this.onShowForm.bind(this);this.hideFormHandler=this.onHideForm.bind(this);this.sendVoteHandler=this.onSendVote.bind(this);H.EventEmitter.subscribe(N.showForm,this.showFormHandler);H.EventEmitter.subscribe(N.hideForm,this.hideFormHandler);H.EventEmitter.subscribe(N.sendDialogVote,this.sendVoteHandler)}babelHelpers.createClass(t,[{key:"onShowForm",value:function t(e){var i=this;var o=e.data;clearTimeout(this.showFormTimeout);if(o.type===L.like){if(o.delayed){this.showFormTimeout=setTimeout((function(){i.showLikeForm()}),5e3)}else{this.showLikeForm()}}else if(o.type===L.smile){this.showSmiles()}}},{key:"onHideForm",value:function t(){this.hideForm()}},{key:"onSendVote",value:function t(e){var i=e.data.vote;console.warn("VOTE",i);this.sendVote(i)}},{key:"showLikeForm",value:function t(){if(this.application.offline){return false}clearTimeout(this.showFormTimeout);if(!this.getWidgetModel().common.vote.enable){return false}if(this.getWidgetModel().dialog.sessionClose&&this.getWidgetModel().dialog.userVote!==M.none){return false}this.store.commit("widget/common",{showForm:L.like})}},{key:"showSmiles",value:function t(){this.store.commit("widget/common",{showForm:L.smile})}},{key:"sendVote",value:function t(e){var i=this;var o=this.getWidgetModel().dialog.sessionId;if(!o){return false}this.restClient.callMethod(F.widgetVoteSend,{SESSION_ID:o,ACTION:e})["catch"]((function(){i.store.commit("widget/dialog",{userVote:M.none})}));this.application.sendEvent({type:A.userVote,data:{vote:e}})}},{key:"hideForm",value:function t(){clearTimeout(this.showFormTimeout);if(this.getWidgetModel().common.showForm!==L.none){this.store.commit("widget/common",{showForm:L.none})}}},{key:"getWidgetModel",value:function t(){return this.store.state.widget}},{key:"destroy",value:function t(){H.EventEmitter.unsubscribe(N.showForm,this.showFormHandler);H.EventEmitter.unsubscribe(N.hideForm,this.hideFormHandler);H.EventEmitter.unsubscribe(N.sendDialogVote,this.sendVoteHandler)}}]);return t}();var nt=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"onOpenMessageReactionList",value:function t(e){var i=e.data;y.Logger.warn("Reactions list is blocked for the widget",i)}}]);return e}(C.ReactionHandler);var st=function(){function t(e){babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"store",null);babelHelpers.defineProperty(this,"application",null);this.store=e.Data.get("controller").store;this.application=e.Application.get()}babelHelpers.createClass(t,[{key:"getHtmlHistory",value:function t(){var e=this.getChatId();if(e<=0){console.error("WidgetHistoryHandler: Incorrect chatId value")}var i={chatId:this.getChatId()};this.requestControllerAction("imopenlines.widget.history.download",i).then(this.handleRequest.bind(this)).then(this.downloadHistory.bind(this))["catch"]((function(t){return console.error("WidgetHistoryHandler: fetch error.",t)}))}},{key:"requestControllerAction",value:function t(e,i){var o=this.application.host?this.application.host:"";var n="/bitrix/services/main/ajax.php";var s=new URL(n,o);s.searchParams.set("action",e);var r=new FormData;for(var a in i){if(i.hasOwnProperty(a)){r.append(a,i[a])}}return fetch(s,{method:"POST",headers:{"Livechat-Auth-Id":this.getUserHash()},body:r})}},{key:"handleRequest",value:function t(e){var i=e.headers.get("Content-Type");if(i.startsWith("application/json")){return e.json()}return e.blob()}},{key:"downloadHistory",value:function t(e){if(e instanceof Blob){var i=window.URL.createObjectURL(e);var o=document.createElement("a");o.href=i;o.download="".concat(this.getChatId(),".html");document.body.append(o);o.click();o.remove()}else if(e.hasOwnProperty("errors")){console.error("WidgetHistoryHandler: ".concat(e.errors[0]))}else{console.error("WidgetHistoryHandler: unknown error.")}}},{key:"getChatId",value:function t(){return this.store.state.application.dialog.chatId}},{key:"getUserHash",value:function t(){return this.store.state.widget.user.hash}},{key:"destroy",value:function t(){}}]);return t}();var rt=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"onClickOnDialog",value:function t(){H.EventEmitter.emit(N.hideForm)}}]);return e}(C.DialogActionHandler);function at(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function lt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?at(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):at(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}E.BitrixVue.component("bx-livechat",{data:function t(){return{widgetAvailableHeight:0,widgetAvailableWidth:0,widgetCurrentHeight:0,widgetCurrentWidth:0,widgetIsResizing:false,textareaHeight:100,welcomeFormFilled:false,startNewChatMode:false}},computed:lt({FormType:function t(){return L},VoteType:function t(){return M},DeviceType:function t(){return S.DeviceType},EventType:function t(){return S.EventType},showTextarea:function t(){if(this.widget.common.isCreateSessionMode){return this.startNewChatMode}var e=this.widget.common.crmFormsSettings;if(!e.useWelcomeForm||!e.welcomeFormId){return true}else{return e.welcomeFormDelay?true:this.welcomeFormFilled}},showWelcomeForm:function t(){return this.widget.common.crmFormsSettings.useWelcomeForm&&!this.widget.common.crmFormsSettings.welcomeFormDelay&&this.widget.common.crmFormsSettings.welcomeFormId&&!this.welcomeFormFilled},textareaHeightStyle:function t(){return{flex:"0 0 ".concat(this.textareaHeight,"px")}},textareaBottomMargin:function t(){if(!this.widget.common.copyright&&!this.isBottomLocation()){return{marginBottom:"5px"}}return""},widgetHeightStyle:function t(){if(v.Utils.device.isMobile()||this.widget.common.pageMode){return}if(this.widgetAvailableHeight<P.height||this.widgetAvailableHeight<this.widgetCurrentHeight){this.widgetCurrentHeight=Math.max(this.widgetAvailableHeight,_.height)}return"".concat(this.widgetCurrentHeight,"px")},widgetWidthStyle:function t(){if(v.Utils.device.isMobile()||this.widget.common.pageMode){return}if(this.widgetAvailableWidth<P.width||this.widgetAvailableWidth<this.widgetCurrentWidth){this.widgetCurrentWidth=Math.max(this.widgetAvailableWidth,_.width)}return"".concat(this.widgetCurrentWidth,"px")},userSelectStyle:function t(){return this.widgetIsResizing?"none":"auto"},widgetMobileDisabled:function t(){if(this.application.device.type!==S.DeviceType.mobile){return false}if(this.application.device.orientation!==S.DeviceOrientation.horizontal){return false}if(navigator.userAgent.toString().includes("iPhone")){return true}else{return babelHelpers["typeof"](window.screen)!=="object"||window.screen.availHeight<800}},widgetPositionClass:function t(){var e=[];if(this.widget.common.pageMode){e.push("bx-livechat-page-mode")}else{e.push("bx-livechat-position-".concat(O[this.widget.common.location]))}return e},widgetLanguageClass:function t(){var e=[];if(this.application.common.languageId===T.russian){e.push("bx-livechat-logo-ru")}else if(this.application.common.languageId===T.ukraine){e.push("bx-livechat-logo-ua")}else{e.push("bx-livechat-logo-en")}return e},widgetPlatformClass:function t(){var e=[];if(v.Utils.device.isMobile()){e.push("bx-livechat-mobile")}else if(v.Utils.browser.isSafari()){e.push("bx-livechat-browser-safari")}else if(v.Utils.browser.isIe()){e.push("bx-livechat-browser-ie")}if(v.Utils.platform.isMac()){e.push("bx-livechat-mac")}else{e.push("bx-livechat-custom-scroll")}return e},widgetClassName:function t(){var e=[];e.push.apply(e,babelHelpers.toConsumableArray(this.widgetPositionClass).concat(babelHelpers.toConsumableArray(this.widgetLanguageClass),babelHelpers.toConsumableArray(this.widgetPlatformClass)));if(!this.widget.common.online){e.push("bx-livechat-offline-state")}if(this.widget.common.dragged){e.push("bx-livechat-drag-n-drop")}if(this.widget.common.dialogStart){e.push("bx-livechat-chat-start")}if(this.widget.dialog.operator.name&&!(this.application.device.type===S.DeviceType.mobile&&this.application.device.orientation===S.DeviceOrientation.horizontal)){e.push("bx-livechat-has-operator")}if(this.widget.common.styles.backgroundColor&&v.Utils.isDarkColor(this.widget.common.styles.iconColor)){e.push("bx-livechat-bright-header")}return e},showMessageDialog:function t(){return this.messageCollection.length>0},localize:function t(){return E.BitrixVue.getFilteredPhrases("BX_LIVECHAT_",this)}},I.Vuex.mapState({widget:function t(e){return e.widget},application:function t(e){return e.application},dialog:function t(e){return e.dialogues.collection[e.application.dialog.dialogId]},messageCollection:function t(e){return e.messages.collection[e.application.dialog.chatId]}})),created:function t(){var e=this;y.Logger.warn("Livechat component created");this.onCreated().then((function(){e.subscribeToEvents();e.initEventHandlers()}))},mounted:function t(){if(this.widget.user.id>0){this.welcomeFormFilled=true}this.registerZIndex()},beforeDestroy:function t(){this.unsubscribeEvents();this.destroyHandlers();this.unregisterZIndex()},methods:{initEventHandlers:function t(){this.sendMessageHandler=new K(this.$Bitrix);this.textareaHandler=new Z(this.$Bitrix);this.textareaUploadHandler=new J(this.$Bitrix);this.readingHandler=new tt(this.$Bitrix);this.consentHandler=new it(this.$Bitrix);this.formHandler=new ot(this.$Bitrix);this.textareaDragHandler=this.getTextareaDragHandler();this.resizeHandler=this.getWidgetResizeHandler();this.reactionHandler=new nt(this.$Bitrix);this.historyHandler=new st(this.$Bitrix);this.dialogActionHandler=new rt(this.$Bitrix)},destroyHandlers:function t(){this.sendMessageHandler.destroy();this.textareaHandler.destroy();this.textareaUploadHandler.destroy();this.readingHandler.destroy();this.consentHandler.destroy();this.formHandler.destroy();this.textareaDragHandler.destroy();this.resizeHandler.destroy();this.reactionHandler.destroy();this.historyHandler.destroy();this.dialogActionHandler.destroy()},subscribeToEvents:function t(){document.addEventListener("keydown",this.onWindowKeyDown);if(!v.Utils.device.isMobile()&&!this.widget.common.pageMode){this.getAvailableSpaceFunc=v.Utils.throttle(this.getAvailableSpace,50);window.addEventListener("resize",this.getAvailableSpaceFunc)}},unsubscribeEvents:function t(){document.removeEventListener("keydown",this.onWindowKeyDown);if(!v.Utils.device.isMobile()&&!this.widget.common.pageMode){window.removeEventListener("resize",this.getAvailableSpaceFunc)}},initMobileEnv:function t(){var e=this;var i=document.head.querySelectorAll("meta");var o=babelHelpers.toConsumableArray(i).find((function(t){return t.name==="viewport"}));if(o){this.viewPortMetaSiteNode=o;this.viewPortMetaSiteNode.remove()}else{this.createViewportMeta()}if(!this.viewPortMetaWidgetNode){this.viewPortMetaWidgetNode=document.createElement("meta");this.viewPortMetaWidgetNode.setAttribute("name","viewport");this.viewPortMetaWidgetNode.setAttribute("content","width=device-width, initial-scale=1.0, user-scalable=0");document.head.append(this.viewPortMetaWidgetNode)}document.body.classList.add("bx-livechat-mobile-state");if(v.Utils.browser.isSafariBased()){document.body.classList.add("bx-livechat-mobile-safari-based")}return new Promise((function(t){setTimeout((function(){e.$store.dispatch("widget/show").then(t)}),50)}))},createViewportMeta:function t(){var e=document.body.offsetWidth;if(e<window.innerWidth){e=window.innerWidth}if(e<1024){e=1024}this.viewPortMetaSiteNode=document.createElement("meta");this.viewPortMetaSiteNode.setAttribute("name","viewport");this.viewPortMetaSiteNode.setAttribute("content","width=".concat(e,", initial-scale=1.0, user-scalable=1"))},removeMobileEnv:function t(){document.body.classList.remove("bx-livechat-mobile-state");if(v.Utils.browser.isSafariBased()){document.body.classList.remove("bx-livechat-mobile-safari-based")}if(this.viewPortMetaWidgetNode){this.viewPortMetaWidgetNode.remove();this.viewPortMetaWidgetNode=null}if(this.viewPortMetaSiteNode){document.head.append(this.viewPortMetaSiteNode);this.viewPortMetaSiteNode=null}},onCreated:function t(){var e=this;return new Promise((function(t){if(v.Utils.device.isMobile()){e.initMobileEnv().then(t)}else{e.$store.dispatch("widget/show").then((function(){e.widgetCurrentHeight=P.height;e.widgetCurrentWidth=P.width;e.getAvailableSpace();e.widgetCurrentHeight=e.widget.common.widgetHeight||e.widgetCurrentHeight;e.widgetCurrentWidth=e.widget.common.widgetWidth||e.widgetCurrentWidth;t()}))}e.textareaHeight=e.widget.common.textareaHeight||e.textareaHeight;e.initCollections()}))},initCollections:function t(){this.$store.commit("files/initCollection",{chatId:this.getApplication().getChatId()});this.$store.commit("messages/initCollection",{chatId:this.getApplication().getChatId()});this.$store.commit("dialogues/initCollection",{dialogId:this.getApplication().getDialogId(),fields:{entityType:"LIVECHAT",type:"livechat"}})},onBeforeClose:function t(){if(v.Utils.device.isMobile()){this.removeMobileEnv()}},onAfterClose:function t(){this.getApplication().close()},onOpenMenu:function t(){this.historyHandler.getHtmlHistory()},onPullRequestConfig:function t(){this.getApplication().recoverPullConnection()},onSmilesSelectSmile:function t(e){H.EventEmitter.emit(S.EventType.textarea.insertText,{text:e.text})},onSmilesSelectSet:function t(){H.EventEmitter.emit(S.EventType.textarea.setFocus)},onWidgetStartDrag:function t(e){this.resizeHandler.startResize(e,this.widgetCurrentHeight,this.widgetCurrentWidth);this.widgetIsResizing=true;H.EventEmitter.emit(S.EventType.textarea.setBlur,true)},onWindowKeyDown:function t(e){if(e.keyCode!==27){return}if(this.widget.common.showForm!==L.none){this.$store.commit("widget/common",{showForm:L.none})}else if(this.widget.common.showConsent){H.EventEmitter.emit(N.declineConsent)}else{this.close()}e.preventDefault();e.stopPropagation();H.EventEmitter.emit(S.EventType.textarea.setFocus)},onWelcomeFormSendSuccess:function t(){this.welcomeFormFilled=true},onWelcomeFormSendError:function t(e){console.error("onWelcomeFormSendError",e);this.welcomeFormFilled=true},onTextareaStartDrag:function t(e){this.textareaDragHandler.onStartDrag(e,this.textareaHeight);H.EventEmitter.emit(S.EventType.textarea.setBlur,true)},openDialogList:function t(){this.$store.commit("widget/common",{isCreateSessionMode:!this.widget.common.isCreateSessionMode});this.startNewChatMode=false},onStartNewChat:function t(){this.startNewChatMode=true},getApplication:function t(){return this.$Bitrix.Application.get()},close:function t(){if(this.widget.common.pageMode){return false}this.onBeforeClose();this.$store.commit("widget/common",{showed:false})},getAvailableSpace:function t(){var e=50;if(this.isBottomLocation()){var i=this.$refs.widgetWrapper.getBoundingClientRect().bottom;var o=window.innerHeight-i;this.widgetAvailableHeight=window.innerHeight-e-o}else{var n=this.$refs.widgetWrapper.getBoundingClientRect().top;this.widgetAvailableHeight=window.innerHeight-e-n}this.widgetAvailableWidth=window.innerWidth-e*2;if(this.resizeHandler){this.resizeHandler.setAvailableWidth(this.widgetAvailableWidth);this.resizeHandler.setAvailableHeight(this.widgetAvailableHeight)}},getTextareaDragHandler:function t(){var e=this,i;return new C.TextareaDragHandler((i={},babelHelpers.defineProperty(i,C.TextareaDragHandler.events.onHeightChange,(function(t){var i=t.data;var o=i.newHeight;if(e.textareaHeight!==o){e.textareaHeight=o}})),babelHelpers.defineProperty(i,C.TextareaDragHandler.events.onStopDrag,(function(){e.$store.commit("widget/common",{textareaHeight:e.textareaHeight});H.EventEmitter.emit(S.EventType.dialog.scrollToBottom,{chatId:e.chatId,force:true})})),i))},getWidgetResizeHandler:function t(){var e=this,i;return new et({widgetLocation:this.widget.common.location,availableWidth:this.widgetAvailableWidth,availableHeight:this.widgetAvailableHeight,events:(i={},babelHelpers.defineProperty(i,et.events.onSizeChange,(function(t){var i=t.data;var o=i.newHeight,n=i.newWidth;if(e.widgetCurrentHeight!==o){e.widgetCurrentHeight=o}if(e.widgetCurrentWidth!==n){e.widgetCurrentWidth=n}})),babelHelpers.defineProperty(i,et.events.onStopResize,(function(){e.widgetIsResizing=false;e.$store.commit("widget/common",{widgetHeight:e.widgetCurrentHeight,widgetWidth:e.widgetCurrentWidth})})),i)})},isBottomLocation:function t(){return[D.bottomLeft,D.bottomMiddle,D.bottomRight].includes(this.widget.common.location)},isPageMode:function t(){return this.widget.common.pageMode},registerZIndex:function t(){this.zIndexStackInstance=this.$Bitrix.Data.get("zIndexStack");if(this.zIndexStackInstance&&!!this.$refs.widgetWrapper){this.zIndexStackInstance.register(this.$refs.widgetWrapper)}},unregisterZIndex:function t(){if(this.zIndexStackInstance){this.zIndexStackInstance.unregister(this.$refs.widgetWrapper)}}},template:'\n\t\t<transition enter-active-class="bx-livechat-show" leave-active-class="bx-livechat-close" @after-leave="onAfterClose">\n\t\t\t<div\n\t\t\t\t:class="widgetClassName"\n\t\t\t\tv-if="widget.common.showed"\n\t\t\t\t:style="{height: widgetHeightStyle, width: widgetWidthStyle, userSelect: userSelectStyle}"\n\t\t\t\tclass="bx-livechat-wrapper bx-livechat-show"\n\t\t\t\tref="widgetWrapper"\n\t\t\t>\n\t\t\t\t<div class="bx-livechat-box">\n\t\t\t\t\t<div v-if="isBottomLocation() && !isPageMode()" class="bx-livechat-widget-resize-handle" @mousedown="onWidgetStartDrag"></div>\n\t\t\t\t\t<bx-livechat-head \n\t\t\t\t\t\t:isWidgetDisabled="widgetMobileDisabled" \n\t\t\t\t\t\t@openMenu="onOpenMenu" \n\t\t\t\t\t\t@close="close"\n\t\t\t\t\t\t@openDialogList="openDialogList"\n\t\t\t\t\t/>\n\t\t\t\t\t<template v-if="widgetMobileDisabled">\n\t\t\t\t\t\t<bx-livechat-body-orientation-disabled/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if="application.error.active">\n\t\t\t\t\t\t<bx-livechat-body-error/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if="!widget.common.configId">\n\t\t\t\t\t\t<div class="bx-livechat-body" key="loading-body">\n\t\t\t\t\t\t\t<bx-livechat-body-loading/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<div v-show="!widget.common.dialogStart" class="bx-livechat-body" :class="{\'bx-livechat-body-with-scroll\': showWelcomeForm}" key="welcome-body">\n\t\t\t\t\t\t\t<bx-imopenlines-form\n\t\t\t\t\t\t\t  v-show="showWelcomeForm"\n\t\t\t\t\t\t\t  @formSendSuccess="onWelcomeFormSendSuccess"\n\t\t\t\t\t\t\t  @formSendError="onWelcomeFormSendError"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<template v-if="!showWelcomeForm">\n\t\t\t\t\t\t\t\t<bx-livechat-body-operators/>\n\t\t\t\t\t\t\t\t<keep-alive include="bx-livechat-smiles">\n\t\t\t\t\t\t\t\t\t<template v-if="widget.common.showForm === FormType.smile">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-smiles @selectSmile="onSmilesSelectSmile" @selectSet="onSmilesSelectSet"/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</keep-alive>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<template v-if="widget.common.dialogStart">\n\t\t\t\t\t\t\t<bx-pull-component-status :canReconnect="true" @reconnect="onPullRequestConfig"/>\n\t\t\t\t\t\t\t<div :class="[\'bx-livechat-body\', {\'bx-livechat-body-with-message\': showMessageDialog}]" key="with-message">\n\t\t\t\t\t\t\t\t<template v-if="widget.common.isCreateSessionMode">\n\t\t\t\t\t\t\t\t\t<bx-livechat-dialogues-list @startNewChat="onStartNewChat"/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else-if="showMessageDialog">\n\t\t\t\t\t\t\t\t\t<div class="bx-livechat-dialog">\n\t\t\t\t\t\t\t\t\t\t<bx-im-component-dialog\n\t\t\t\t\t\t\t\t\t\t\t:userId="application.common.userId"\n\t\t\t\t\t\t\t\t\t\t\t:dialogId="application.dialog.dialogId"\n\t\t\t\t\t\t\t\t\t\t\t:messageLimit="application.dialog.messageLimit"\n\t\t\t\t\t\t\t\t\t\t\t:enableReactions="true"\n\t\t\t\t\t\t\t\t\t\t\t:enableDateActions="false"\n\t\t\t\t\t\t\t\t\t\t\t:enableCreateContent="false"\n\t\t\t\t\t\t\t\t\t\t\t:enableGestureQuote="true"\n\t\t\t\t\t\t\t\t\t\t\t:enableGestureMenu="true"\n\t\t\t\t\t\t\t\t\t\t\t:showMessageAvatar="false"\n\t\t\t\t\t\t\t\t\t\t\t:showMessageMenu="false"\n\t\t\t\t\t\t\t\t\t\t\t:skipDataRequest="true"\n\t\t\t\t\t\t\t\t\t\t\t:showLoadingState="false"\n\t\t\t\t\t\t\t\t\t\t\t:showEmptyState="false"\n\t\t\t\t\t\t\t\t\t\t />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t<bx-livechat-body-loading/>\n\t\t\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\t\t<keep-alive include="bx-livechat-smiles">\n\t\t\t\t\t\t\t\t\t<template v-if="widget.common.showForm === FormType.like && widget.common.vote.enable">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-vote/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widget.common.showForm === FormType.welcome">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-welcome/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widget.common.showForm === FormType.offline">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-offline/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widget.common.showForm === FormType.history">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-history/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widget.common.showForm === FormType.smile">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-smiles @selectSmile="onSmilesSelectSmile" @selectSet="onSmilesSelectSet"/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</keep-alive>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<div v-if="showTextarea || startNewChatMode" class="bx-livechat-textarea" :style="[textareaHeightStyle, textareaBottomMargin]" ref="textarea">\n\t\t\t\t\t\t\t<div class="bx-livechat-textarea-resize-handle" @mousedown="onTextareaStartDrag" @touchstart="onTextareaStartDrag"></div>\n\t\t\t\t\t\t\t<bx-im-component-textarea\n\t\t\t\t\t\t\t\t:siteId="application.common.siteId"\n\t\t\t\t\t\t\t\t:userId="application.common.userId"\n\t\t\t\t\t\t\t\t:dialogId="application.dialog.dialogId"\n\t\t\t\t\t\t\t\t:writesEventLetter="3"\n\t\t\t\t\t\t\t\t:enableEdit="true"\n\t\t\t\t\t\t\t\t:enableCommand="false"\n\t\t\t\t\t\t\t\t:enableMention="false"\n\t\t\t\t\t\t\t\t:enableFile="application.disk.enabled"\n\t\t\t\t\t\t\t\t:autoFocus="application.device.type !== DeviceType.mobile"\n\t\t\t\t\t\t\t\t:styles="{button: {backgroundColor: widget.common.styles.backgroundColor, iconColor: widget.common.styles.iconColor}}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="!widget.common.copyright && !isBottomLocation" class="bx-livechat-nocopyright-resize-wrap" style="position: relative;">\n\t\t\t\t\t\t\t<div class="bx-livechat-widget-resize-handle" @mousedown="onWidgetStartDrag"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<bx-livechat-form-consent />\n\t\t\t\t\t\t<template v-if="widget.common.copyright">\n\t\t\t\t\t\t\t<div class="bx-livechat-copyright">\n\t\t\t\t\t\t\t\t<template v-if="widget.common.copyrightUrl">\n\t\t\t\t\t\t\t\t\t<a class="bx-livechat-copyright-link" :href="widget.common.copyrightUrl" target="_blank">\n\t\t\t\t\t\t\t\t\t\t<span class="bx-livechat-logo-name">{{localize.BX_LIVECHAT_COPYRIGHT_TEXT}}</span>\n\t\t\t\t\t\t\t\t\t\t<span class="bx-livechat-logo-icon"></span>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t<span class="bx-livechat-logo-name">{{localize.BX_LIVECHAT_COPYRIGHT_TEXT}}</span>\n\t\t\t\t\t\t\t\t\t<span class="bx-livechat-logo-icon"></span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<div v-if="!isBottomLocation() && !isPageMode()" class="bx-livechat-widget-resize-handle" @mousedown="onWidgetStartDrag"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t'});function ct(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function dt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ct(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ct(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}E.BitrixVue.component("bx-livechat-body-error",{computed:dt({},I.Vuex.mapState({application:function t(e){return e.application}})),template:'\n\t\t<div class="bx-livechat-body" key="error-body">\n\t\t\t<div class="bx-livechat-warning-window">\n\t\t\t\t<div class="bx-livechat-warning-icon"></div>\n\t\t\t\t<template v-if="application.error.description"> \n\t\t\t\t\t<div class="bx-livechat-help-title bx-livechat-help-title-sm bx-livechat-warning-msg" v-html="application.error.description"></div>\n\t\t\t\t</template> \n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class="bx-livechat-help-title bx-livechat-help-title-md bx-livechat-warning-msg">{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_ERROR_TITLE\')}}</div>\n\t\t\t\t\t<div class="bx-livechat-help-title bx-livechat-help-title-sm bx-livechat-warning-msg">{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_ERROR_DESC\')}}</div>\n\t\t\t\t</template> \n\t\t\t</div>\n\t\t</div>\n\t'});function ht(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function ut(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ht(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ht(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}E.BitrixVue.component("bx-livechat-head",{props:{isWidgetDisabled:{default:false}},data:function t(){return{multiDialog:false}},methods:{openDialogList:function t(){H.EventEmitter.emit(N.hideForm);this.$emit("openDialogList")},close:function t(e){this.$emit("close")},like:function t(){H.EventEmitter.emit(N.showForm,{type:L.like})},openMenu:function t(e){this.$emit("openMenu",e)}},computed:ut({VoteType:function t(){return M},chatId:function t(){if(this.application){return this.application.dialog.chatId}},customBackgroundStyle:function t(e){return e.widget.common.styles.backgroundColor?"background-color: "+e.widget.common.styles.backgroundColor+"!important;":""},customBackgroundOnlineStyle:function t(e){return e.widget.common.styles.backgroundColor?"border-color: "+e.widget.common.styles.backgroundColor+"!important;":""},showName:function t(e){return e.widget.dialog.operator.firstName||e.widget.dialog.operator.lastName},voteActive:function t(e){if(!!e.widget.dialog.closeVote){return false}if(!e.widget.common.vote.beforeFinish&&e.widget.dialog.sessionStatus<U.waitClient){return false}if(!e.widget.dialog.sessionClose||e.widget.dialog.sessionClose&&e.widget.dialog.userVote===M.none){return true}if(e.widget.dialog.sessionClose&&e.widget.dialog.userVote!==M.none){return true}return false},chatTitle:function t(e){return e.widget.common.textMessages.bxLivechatTitle||e.widget.common.configName||this.localize.BX_LIVECHAT_TITLE},operatorName:function t(e){if(!this.showName)return"";return e.widget.dialog.operator.firstName?e.widget.dialog.operator.firstName:e.widget.dialog.operator.name},operatorDescription:function t(e){if(!this.showName){return""}var i=e.widget.dialog.operator.workPosition?e.widget.dialog.operator.workPosition:this.localize.BX_LIVECHAT_USER;if(e.widget.common.showSessionId&&e.widget.dialog.sessionId>=0){return this.localize.BX_LIVECHAT_OPERATOR_POSITION_AND_SESSION_ID.replace("#POSITION#",i).replace("#ID#",e.widget.dialog.sessionId)}return this.localize.BX_LIVECHAT_OPERATOR_POSITION_ONLY.replace("#POSITION#",i)},localize:function t(){return E.BitrixVue.getFilteredPhrases("BX_LIVECHAT_",this)},ie11:function t(){return x.Browser.isIE11()}},I.Vuex.mapState({widget:function t(e){return e.widget},application:function t(e){return e.application}})),watch:{showName:function t(e){var i=this;if(e){setTimeout((function(){i.$root.$emit(S.EventType.dialog.scrollToBottom,{chatId:i.chatId})}),300)}}},template:'\n\t\t<div class="bx-livechat-head-wrap">\n\t\t\t<template v-if="isWidgetDisabled">\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<div class="bx-livechat-title">{{chatTitle}}</div>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<button v-if="!widget.common.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\t\n\t\t\t</template>\n\t\t\t<template v-else-if="application.error.active">\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<div class="bx-livechat-title">{{chatTitle}}</div>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<button v-if="!widget.common.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else-if="!widget.common.configId">\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<div class="bx-livechat-title">{{chatTitle}}</div>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<button v-if="!widget.common.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\t\t\t\n\t\t\t<template v-else>\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<template v-if="!showName">\n\t\t\t\t\t\t<div class="bx-livechat-title">{{chatTitle}}</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<div class="bx-livechat-user bx-livechat-status-online">\n\t\t\t\t\t\t\t<template v-if="widget.dialog.operator.avatar">\n\t\t\t\t\t\t\t\t<div class="bx-livechat-user-icon" :style="\'background-image: url(\'+encodeURI(widget.dialog.operator.avatar)+\')\'">\n\t\t\t\t\t\t\t\t\t<div v-if="widget.dialog.operator.online" class="bx-livechat-user-status" :style="customBackgroundOnlineStyle"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class="bx-livechat-user-icon">\n\t\t\t\t\t\t\t\t\t<div v-if="widget.dialog.operator.online" class="bx-livechat-user-status" :style="customBackgroundOnlineStyle"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-livechat-user-info">\n\t\t\t\t\t\t\t<div class="bx-livechat-user-name">{{operatorName}}</div>\n\t\t\t\t\t\t\t<div class="bx-livechat-user-position">{{operatorDescription}}</div>\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<span class="bx-livechat-control-box-active" v-if="widget.common.dialogStart && widget.dialog.sessionId">\n\t\t\t\t\t\t\t<button v-if="widget.common.vote.enable && voteActive" :class="\'bx-livechat-control-btn bx-livechat-control-btn-like bx-livechat-dialog-vote-\'+(widget.dialog.userVote)" :title="localize.BX_LIVECHAT_VOTE_BUTTON" @click="like"></button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tv-if="!ie11 && application.dialog.chatId > 0"\n\t\t\t\t\t\t\t\tclass="bx-livechat-control-btn bx-livechat-control-btn-menu"\n\t\t\t\t\t\t\t\t@click="openMenu"\n\t\t\t\t\t\t\t\t:title="localize.BX_LIVECHAT_DOWNLOAD_HISTORY"\n\t\t\t\t\t\t\t></button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tv-if="multiDialog && application.dialog.chatId > 0"\n\t\t\t\t\t\t\t\tclass="bx-livechat-control-btn bx-livechat-control-btn-list"\n\t\t\t\t\t\t\t\t@click="openDialogList"\n\t\t\t\t\t\t\t></button>\n\t\t\t\t\t\t</span>\t\n\t\t\t\t\t\t<button v-if="!widget.common.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t'});E.BitrixVue.component("bx-livechat-body-loading",{template:'\n\t\t<div class="bx-livechat-loading-window">\n\t\t\t<svg class="bx-livechat-loading-circular" viewBox="25 25 50 50">\n\t\t\t\t<circle class="bx-livechat-loading-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>\n\t\t\t\t<circle class="bx-livechat-loading-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>\n\t\t\t</svg>\n\t\t\t<h3 class="bx-livechat-help-title bx-livechat-help-title-md bx-livechat-loading-msg">{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_LOADING\')}}</h3>\n\t\t</div>\n\t'});function gt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function pt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?gt(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):gt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}E.BitrixVue.component("bx-livechat-body-operators",{computed:pt({},I.Vuex.mapState({widget:function t(e){return e.widget}})),template:'\n\t\t<div class="bx-livechat-help-container">\n\t\t\t<transition name="bx-livechat-animation-fade">\n\t\t\t\t<h2 v-if="widget.common.online" key="online" class="bx-livechat-help-title bx-livechat-help-title-lg">{{widget.common.textMessages.bxLivechatOnlineLine1}}<div class="bx-livechat-help-subtitle">{{widget.common.textMessages.bxLivechatOnlineLine2}}</div></h2>\n\t\t\t\t<h2 v-else key="offline" class="bx-livechat-help-title bx-livechat-help-title-sm">{{widget.common.textMessages.bxLivechatOffline}}</h2>\n\t\t\t</transition>\t\n\t\t\t<div class="bx-livechat-help-user">\n\t\t\t\t<template v-for="operator in widget.common.operators">\n\t\t\t\t\t<div class="bx-livechat-user" :key="operator.id">\n\t\t\t\t\t\t<template v-if="operator.avatar">\n\t\t\t\t\t\t\t<div class="bx-livechat-user-icon" :style="\'background-image: url(\'+encodeURI(operator.avatar)+\')\'"></div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class="bx-livechat-user-icon"></div>\n\t\t\t\t\t\t</template>\t\n\t\t\t\t\t\t<div class="bx-livechat-user-info">\n\t\t\t\t\t\t\t<div class="bx-livechat-user-name">{{operator.firstName? operator.firstName: operator.name}}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\t\n\t\t\t</div>\n\t\t</div>\n\t'});function ft(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function mt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ft(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ft(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}E.BitrixVue.component("bx-livechat-dialogues-list",{data:function t(){return{newChatMode:false,sessionList:[],isLoading:false,pagesLoaded:0,hasMoreItemsToLoad:true,itemsPerPage:25}},computed:mt({},I.Vuex.mapState({dialogues:function t(e){return e.dialogues}})),mounted:function t(){this.requestDialogList()},methods:{requestDialogList:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;this.isLoading=true;var o={CONFIG_ID:this.$Bitrix.Application.get().getConfigId()};if(i>0){o["OFFSET"]=i}return this.$Bitrix.Application.get().controller.restClient.callMethod(F.widgetDialogList,o).then((function(t){if(t.data().length===0||t.data().length<e.itemsPerPage){e.hasMoreItemsToLoad=false}e.pagesLoaded++;e.isLoading=false;e.sessionList=[].concat(babelHelpers.toConsumableArray(e.sessionList),babelHelpers.toConsumableArray(e.prepareSessionList(t.data())))}))["catch"]((function(t){console.warn("error",t)}))},prepareSessionList:function t(e){return Object.values(e).map((function(t){return{chatId:t.chatId,dialogId:t.dialogId,name:"Dialog #".concat(t.sessionId)}}))},openSession:function t(e){H.EventEmitter.emit(N.openSession,e)},startNewChat:function t(e){this.newChatMode=true;this.$emit("startNewChat",e)},isOneScreenRemaining:function t(e){return e.target.scrollTop+e.target.clientHeight>=e.target.scrollHeight-e.target.clientHeight},onScroll:function t(e){if(this.isOneScreenRemaining(e)){if(this.isLoading||!this.hasMoreItemsToLoad){return}var i=this.itemsPerPage*this.pagesLoaded;this.requestDialogList(i)}}},template:'\n\t<div class="bx-livechat-help-container" style=" height: 100%; display: flex; flex-direction: column; justify-content: space-between;">\n\t\t<div \n\t\t\tstyle="margin-top: 25px;overflow-y: scroll;position:relative"\n\t\t\t:style="{marginBottom: newChatMode ? 0 : \'10px\'}"\n\t\t\t@scroll="onScroll"\n\t\t>\n\t\t\t<div\n\t\t\t\tv-for="session in sessionList"\n\t\t\t\t:key="session.chatId"\n\t\t\t\tclass="bx-livechat-help-subtitle"\n\t\t\t\t@click="openSession({event: $event, session: session})"\n\t\t\t\tstyle="cursor: pointer; border: solid 1px black;border-radius: 10px;margin: 10px;padding: 5px;background-color: #0ae4ff">\n\t\t\t\t{{ session.name }}\n\t\t\t</div>\n\t\t\t<div v-if="isLoading" style="margin: 10px">Loading</div>\n\t\t</div>\n\t\t\n\t\t<div v-if="!newChatMode" style="margin-bottom: 10px;">\n\t\t\t<button \n\t\t\t\tclass="bx-livechat-btn" \n\t\t\t\tstyle="background-color: rgb(23, 163, 234); border-radius: 5px;width: 150px;" \n\t\t\t\t@click="startNewChat">\n\t\t\t\tStart new chat!\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\t'});E.BitrixVue.component("bx-livechat-body-orientation-disabled",{template:'\n\t\t<div class="bx-livechat-body" key="orientation-head">\n\t\t\t<div class="bx-livechat-mobile-orientation-box">\n\t\t\t\t<div class="bx-livechat-mobile-orientation-icon"></div>\n\t\t\t\t<div class="bx-livechat-mobile-orientation-text">{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_MOBILE_ROTATE\')}}</div>\n\t\t\t</div>\n\t\t</div>\n\t'});function vt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function bt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?vt(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):vt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}E.BitrixVue.component("bx-livechat-form-consent",{computed:bt({},I.Vuex.mapState({widget:function t(e){return e.widget}})),methods:{agree:function t(){H.EventEmitter.emit(N.acceptConsent)},disagree:function t(){H.EventEmitter.emit(N.declineConsent)},onShow:function t(e,i){e.classList.add("bx-livechat-consent-window-show");i()},onHide:function t(e,i){e.classList.remove("bx-livechat-consent-window-show");e.classList.add("bx-livechat-consent-window-close");setTimeout((function(){i()}),400)},onKeyDown:function t(e){if(e.keyCode==9){if(e.target===this.$refs.iframe){if(e.shiftKey){this.$refs.cancel.focus()}else{this.$refs.success.focus()}}else if(e.target===this.$refs.success){if(e.shiftKey){this.$refs.iframe.focus()}else{this.$refs.cancel.focus()}}else if(e.target===this.$refs.cancel){if(e.shiftKey){this.$refs.success.focus()}else{this.$refs.iframe.focus()}}e.preventDefault()}else if(e.keyCode==39||e.keyCode==37){if(e.target.nextElementSibling){e.target.nextElementSibling.focus()}else if(e.target.previousElementSibling){e.target.previousElementSibling.focus()}e.preventDefault()}}},directives:{focus:{inserted:function t(e,i){e.focus()}}},template:'\n\t\t<transition @enter="onShow" @leave="onHide">\n\t\t\t<template v-if="widget.common.showConsent && widget.common.consentUrl">\n\t\t\t\t<div class="bx-livechat-consent-window">\n\t\t\t\t\t<div class="bx-livechat-consent-window-title">{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_CONSENT_TITLE\')}}</div>\n\t\t\t\t\t<div class="bx-livechat-consent-window-content">\n\t\t\t\t\t\t<iframe class="bx-livechat-consent-window-content-iframe" ref="iframe" frameborder="0" marginheight="0"  marginwidth="0" allowtransparency="allow-same-origin" seamless="true" :src="widget.common.consentUrl" @keydown="onKeyDown"></iframe>\n\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\n\t\t\t\t\t<div class="bx-livechat-consent-window-btn-box">\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-success" ref="success" @click="agree" @keydown="onKeyDown" v-focus>{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_CONSENT_AGREE\')}}</button>\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-cancel" ref="cancel" @click="disagree" @keydown="onKeyDown">{{$Bitrix.Loc.getMessage(\'BX_LIVECHAT_CONSENT_DISAGREE\')}}</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</transition>\n\t'});function wt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function yt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?wt(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):wt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}E.BitrixVue.component("bx-livechat-form-vote",{computed:yt({VoteType:function t(){return M}},I.Vuex.mapState({widget:function t(e){return e.widget}})),methods:{userVote:function t(e){H.EventEmitter.emit(N.hideForm);this.$store.commit("widget/dialog",{userVote:e});H.EventEmitter.emit(N.sendDialogVote,{vote:e})},hideForm:function t(){H.EventEmitter.emit(N.hideForm)}},template:'\n\t\t<transition enter-active-class="bx-livechat-consent-window-show" leave-active-class="bx-livechat-form-close">\n\t\t\t<div class="bx-livechat-alert-box bx-livechat-form-rate-show" key="vote">\n\t\t\t\t<div class="bx-livechat-alert-close" @click="hideForm"></div>\n\t\t\t\t<div class="bx-livechat-alert-rate-box">\n\t\t\t\t\t<h4 class="bx-livechat-alert-title bx-livechat-alert-title-mdl">{{widget.common.vote.messageText}}</h4>\n\t\t\t\t\t<div class="bx-livechat-btn-box">\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-like" @click="userVote(VoteType.like)" :title="widget.common.vote.messageLike"></button>\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-dislike" @click="userVote(VoteType.dislike)" :title="widget.common.vote.messageDislike"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\t\n\t'});E.Vue.cloneComponent("bx-livechat-smiles","bx-smiles",{methods:{hideForm:function t(){H.EventEmitter.emit(N.hideForm)}},template:'\n\t\t<transition enter-active-class="bx-livechat-consent-window-show" leave-active-class="bx-livechat-form-close">\n\t\t\t<div class="bx-livechat-alert-box bx-livechat-alert-box-zero-padding bx-livechat-form-show" key="vote">\n\t\t\t\t<div class="bx-livechat-alert-close" @click="hideForm"></div>\n\t\t\t\t<div class="bx-livechat-alert-smiles-box">\n\t\t\t\t\t#PARENT_TEMPLATE#\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t'});BX.LiveChatWidget=Y;BX.LiveChatWidget.VoteType=M;BX.LiveChatWidget.SubscriptionType=A;BX.LiveChatWidget.LocationStyle=O;BX.LiveChatWidget.Cookie=f.Cookie;window.dispatchEvent(new CustomEvent("onBitrixLiveChatSourceLoaded",{detail:{}}))})(this.window=this.window||{},BX,window,window,BX.Messenger,window,BX,window,window,BX,BX.Messenger.Provider.Rest,BX.Main,BX,BX.Ui.Vue.Components.Crm,BX.Messenger,BX.Messenger.Lib,BX.Messenger.Lib,BX.Messenger.Lib,BX,BX,BX.Messenger.Lib,BX.Messenger,BX.Messenger.Const,BX,BX,BX,BX.Event);
//# sourceMappingURL=widget.bundle.map.js