(function(t){"use strict";var e=function t(e){var i=[];for(var s in e){if(e.hasOwnProperty(s)){i.push(e[s])}}return i};var i=Object.freeze({none:"none",like:"like",dislike:"dislike"});var s=Object.freeze({horizontal:"horizontal",portrait:"portrait"});var a=Object.freeze({mobile:"mobile",desktop:"desktop"});var o=Object.freeze({russian:"ru",ukraine:"ua",world:"en"});var r=Object.freeze({none:"none",like:"like",smile:"smile",consent:"consent",welcome:"welcome",offline:"offline",history:"history"});var n=Object.freeze({topLeft:1,topMiddle:2,topBottom:3,bottomLeft:6,bottomMiddle:5,bottomRight:4});var l=Object.freeze({1:"top-left",2:"top-center",3:"top-right",6:"bottom-left",5:"bottom-center",4:"bottom-right"});var d=Object.freeze({configLoaded:"configLoaded",widgetOpen:"widgetOpen",widgetClose:"widgetClose",sessionStart:"sessionStart",sessionOperatorChange:"sessionOperatorChange",sessionFinish:"sessionFinish",operatorMessage:"operatorMessage",userForm:"userForm",userMessage:"userMessage",userVote:"userVote",every:"every"});var c=e(d);var h=Object.freeze({dialogData:"widget/dialogData",widgetData:"widget/widgetData",userData:"widget/userData"});var u=Object.freeze({messages:BX.Messenger.Model.Messages.getName(),dialogues:BX.Messenger.Model.Dialogues.getName(),users:BX.Messenger.Model.Users.getName(),files:BX.Messenger.Model.Files.getName()});var g=Object.freeze({initCollection:u.messages+"/initCollection",add:u.messages+"/add",set:u.messages+"/set",setBefore:u.messages+"/setBefore",update:u.messages+"/update",delete:u.messages+"/delete",actionStart:u.messages+"/actionStart",actionFinish:u.messages+"/actionFinish",actionError:u.messages+"/actionError",readMessages:u.messages+"/readMessages"});var f=Object.freeze({getLastId:u.messages+"/getLastId"});var m=Object.freeze({set:u.users+"/set",update:u.users+"/update",delete:u.users+"/delete"});var v=Object.freeze({initCollection:u.files+"/initCollection",set:u.files+"/set",setBefore:u.files+"/setBefore",update:u.files+"/update",delete:u.dialogues+"/delete"});var p=Object.freeze({initCollection:u.dialogues+"/initCollection",set:u.dialogues+"/set",update:u.dialogues+"/update",updateWriting:u.dialogues+"/updateWriting",decreaseCounter:u.dialogues+"/decreaseCounter",increaseCounter:u.dialogues+"/increaseCounter",delete:u.dialogues+"/delete"});var b=Object.freeze({widgetUserRegister:"imopenlines.widget.user.register",widgetConfigGet:"imopenlines.widget.config.get",widgetDialogGet:"imopenlines.widget.dialog.get",widgetUserGet:"imopenlines.widget.user.get",widgetUserConsentApply:"imopenlines.widget.user.consent.apply",widgetVoteSend:"imopenlines.widget.vote.send",widgetFormSend:"imopenlines.widget.form.send",pullServerTime:"server.time",pullConfigGet:"pull.config.get",imMessageAdd:"im.message.add",imMessageUpdate:"im.message.update",imMessageDelete:"im.message.delete",imMessageLike:"im.message.like",imChatGet:"im.chat.get",imChatSendTyping:"im.chat.sendTyping",imDialogMessagesGet:"im.dialog.messages.get",imDialogMessagesUnread:"im.dialog.messages.unread",imDialogRead:"im.dialog.read",diskFolderGet:"im.disk.folder.get",diskFileUpload:"disk.folder.uploadfile",diskFileCommit:"im.disk.file.commit"});var w=e(b);var D=Object.freeze({guest:"guest"});var y=function(){function t(e){babelHelpers.classCallCheck(this,t);this.developerInfo="Do not use private methods.";this.__privateMethods__=new x(e);this.createLegacyMethods()}babelHelpers.createClass(t,[{key:"open",value:function t(e){return this.__privateMethods__.open(e)}},{key:"close",value:function t(){return this.__privateMethods__.close()}},{key:"showNotification",value:function t(e){return this.__privateMethods__.showNotification(e)}},{key:"getUserData",value:function t(){return this.__privateMethods__.getUserData()}},{key:"setUserRegisterData",value:function t(e){return this.__privateMethods__.setUserRegisterData(e)}},{key:"setCustomData",value:function t(e){return this.__privateMethods__.setCustomData(e)}},{key:"mutateTemplateComponent",value:function t(e,i){return this.__privateMethods__.mutateTemplateComponent(e,i)}},{key:"addLocalize",value:function t(e){return this.__privateMethods__.addLocalize(e)}},{key:"subscribe",value:function t(e){return this.__privateMethods__.subscribe(e)}},{key:"start",value:function t(){return this.__privateMethods__.start()}},{key:"createLegacyMethods",value:function t(){var e=this;if(typeof window.BX.LiveChat==="undefined"){var i=document.createElement("a");i.href=this.__privateMethods__.host;var s=i.protocol+"//"+i.hostname+(i.port&&i.port!="80"&&i.port!="443"?":"+i.port:"");window.BX.LiveChat={openLiveChat:function t(){e.open({openFromButton:true})},closeLiveChat:function t(){e.close()},addEventListener:function t(i,a,o){if(a==="message"){e.subscribe({type:d.userMessage,callback:function t(e){o({origin:s,data:JSON.stringify({action:"sendMessage"}),event:e})}})}else{console.warn("Method BX.LiveChat.addEventListener is not supported, user new format for subscribe.")}},setCookie:function t(){},getCookie:function t(){},sourceDomain:s}}if(typeof window.BxLiveChatInit==="function"){var a=window.BxLiveChatInit();if(a.user){this.__privateMethods__.setUserRegisterData(a.user)}if(a.firstMessage){this.__privateMethods__.setCustomData(a.firstMessage)}}if(window.BxLiveChatLoader instanceof Array){window.BxLiveChatLoader.forEach(function(t){return t()})}return true}}]);return t}();var x=function(){function t(){var e,i=this;var o=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);this.ready=true;this.widgetDataRequested=false;this.offline=false;this.code=o.code||"";this.host=o.host||"";this.language=o.language||"en";this.copyright=o.copyright!==false;this.copyrightUrl=this.copyright&&o.copyrightUrl?o.copyrightUrl:"";this.buttonInstance=babelHelpers.typeof(o.buttonInstance)==="object"&&o.buttonInstance!==null?o.buttonInstance:null;this.pageMode=babelHelpers.typeof(o.pageMode)==="object"&&o.pageMode;if(this.pageMode){this.pageMode.useBitrixLocalize=o.pageMode.useBitrixLocalize===true;this.pageMode.placeholder=document.getElementById(o.pageMode.placeholder)}if(typeof this.code==="string"){if(this.code.length<=0){console.warn("%cLiveChatWidget.constructor: code is not correct (%c".concat(this.code,"%c)"),"color: black;","font-weight: bold; color: red","color: black");this.ready=false}}if(typeof this.host==="string"){if(this.host.length<=0||!this.host.startsWith("http")){console.warn("%cLiveChatWidget.constructor: host is not correct (%c".concat(this.host,"%c)"),"color: black;","font-weight: bold; color: red","color: black");this.ready=false}}this.inited=false;this.initEventFired=false;this.restClient=null;this.pullClient=null;this.userRegisterData={};this.customData=[];this.localize=this.pageMode&&this.pageMode.useBitrixLocalize?BX.message:{};this.subscribers={};this.dateFormat=null;this.messagesQueue=[];this.filesQueue=[];this.filesQueueIndex=0;this.messageLastReadId=null;this.messageReadQueue=[];this.defaultMessageLimit=20;this.requestMessageLimit=this.defaultMessageLimit;this.configRequestXhr=null;var r={};if(o.location&&typeof l[o.location]!=="undefined"){r.location=o.location}if(BX.Messenger.Utils.types.isPlainObject(o.styles)&&(o.styles.backgroundColor||o.styles.iconColor)){if(typeof r.styles==="undefined"){r.styles={}}if(o.styles.backgroundColor){r.styles.backgroundColor=o.styles.backgroundColor}if(o.styles.iconColor){r.styles.iconColor=o.styles.iconColor}}this.store=new BX.Vuex.store({name:"Bitrix LiveChat Widget ("+this.code+" / "+this.host+")",modules:(e={widget:this.getWidgetStore({widgetData:r})},babelHelpers.defineProperty(e,u.messages,BX.Messenger.Model.Messages.getInstance().getStore()),babelHelpers.defineProperty(e,u.dialogues,BX.Messenger.Model.Dialogues.getInstance().getStore({host:this.host})),babelHelpers.defineProperty(e,u.users,BX.Messenger.Model.Users.getInstance().getStore({host:this.host})),babelHelpers.defineProperty(e,u.files,BX.Messenger.Model.Files.getInstance().getStore({host:this.host})),e)});if(this.pageMode&&this.pageMode.placeholder){this.rootNode=this.pageMode.placeholder}else{this.rootNode=document.createElement("div");if(document.body.firstChild){document.body.insertBefore(this.rootNode,document.body.firstChild)}else{document.body.appendChild(this.rootNode)}}this.template=null;window.addEventListener("orientationchange",function(){i.store.commit(h.widgetData,{deviceOrientation:BX.Messenger.Utils.device.getOrientation()});if(i.store.state.widget.widgetData.showed&&i.store.state.widget.widgetData.deviceType==a.mobile&&i.store.state.widget.widgetData.deviceOrientation==s.horizontal){document.activeElement.blur()}});var n=BX.Messenger.LocalStorage.get(this.getSiteId(),0,"serverVariables",false);if(n){this.addLocalize(n)}this.initRestClient();window.dispatchEvent(new CustomEvent("onBitrixLiveChat",{detail:{widget:this,widgetCode:this.code,widgetHost:this.host}}));if(this.pageMode){this.open()}}babelHelpers.createClass(t,[{key:"getWidgetStore",value:function t(e){var o={siteId:this.getSiteId(),host:this.getHost(),configId:0,configName:"",vote:{enable:false,messageText:this.getLocalize("BX_LIVECHAT_VOTE_TITLE"),messageLike:this.getLocalize("BX_LIVECHAT_VOTE_PLUS_TITLE"),messageDislike:this.getLocalize("BX_LIVECHAT_VOTE_MINUS_TITLE")},pageMode:false,language:this.language,copyright:this.copyright,copyrightUrl:this.copyrightUrl,online:false,operators:[],connectors:[],disk:{enabled:false,maxFileSize:5242880},styles:{backgroundColor:"#17a3ea",iconColor:"#ffffff"},showForm:r.none,uploadFile:false,deviceType:a.desktop,deviceOrientation:s.portrait,location:n.bottomRight,showed:false,reopen:false,dragged:false,textareaHeight:0,showConsent:false,consentUrl:"",dialogStart:false,error:{active:false,code:"",description:""}};var d=BX.Messenger.LocalStorage.get(this.getSiteId(),0,h.widgetData,o);d.deviceType=BX.Messenger.Utils.device.isMobile()?a.mobile:a.desktop;d.deviceOrientation=BX.Messenger.Utils.device.getOrientation();d.language=this.language;d.copyright=this.copyright;d.copyrightUrl=this.copyrightUrl;d.pageMode=this.pageMode!==false;d.dragged=false;d.showConsent=false;d.showForm=r.none;d.uploadFile=false;d.error={active:false,code:"",description:""};d.showed=false;if(BX.Messenger.Utils.types.isPlainObject(e.widgetData)){if(e.widgetData.location&&typeof l[e.widgetData.location]!=="undefined"){d.location=e.widgetData.location}if(BX.Messenger.Utils.types.isPlainObject(e.widgetData.styles)&&(e.widgetData.styles.backgroundColor||e.widgetData.styles.iconColor)){if(e.widgetData.styles.backgroundColor){d.styles.backgroundColor=e.widgetData.styles.backgroundColor}if(e.widgetData.styles.iconColor){d.styles.iconColor=e.widgetData.styles.iconColor}}}for(var c in o){if(!o.hasOwnProperty(c))continue;if(typeof d[c]=="undefined"){d[c]=o[c]}}var u={dialogId:"chat0",chatId:0,diskFolderId:0,sessionId:0,sessionClose:true,userVote:i.none,userConsent:false,messageLimit:0,operator:{name:"",firstName:"",lastName:"",workPosition:"",avatar:"",online:false}};var g=BX.Messenger.LocalStorage.get(this.getSiteId(),0,h.dialogData,u);for(var f in u){if(!u.hasOwnProperty(f))continue;if(typeof g[f]=="undefined"){g[f]=u[f]}}g.messageLimit=this.defaultMessageLimit;var m={id:-1,hash:"",name:"",firstName:"",lastName:"",avatar:"",email:"",phone:"",www:"",gender:"M",position:""};var v=BX.Messenger.LocalStorage.get(this.getSiteId(),0,h.userData,m);if(!v.hash){var p=this.getUserHashCookie();if(p){v.hash=p}}for(var b in m){if(!m.hasOwnProperty(b))continue;if(typeof v[b]=="undefined"){v[b]=m[b]}}return{namespaced:true,state:{widgetData:d,dialogData:g,userData:v},mutations:{widgetData:function t(e,i){if(typeof i.configId==="number"){e.widgetData.configId=i.configId}if(typeof i.configName==="string"){e.widgetData.configName=i.configName}if(typeof i.language==="string"){e.widgetData.language=i.language}if(typeof i.online==="boolean"){e.widgetData.online=i.online}if(BX.Messenger.Utils.types.isPlainObject(i.vote)){if(typeof i.vote.enable==="boolean"){e.widgetData.vote.enable=i.vote.enable}if(typeof i.vote.messageText==="string"){e.widgetData.vote.messageText=i.vote.messageText}if(typeof i.vote.messageLike==="string"){e.widgetData.vote.messageLike=i.vote.messageLike}if(typeof i.vote.messageDislike==="string"){e.widgetData.vote.messageDislike=i.vote.messageDislike}}if(typeof i.dragged==="boolean"){e.widgetData.dragged=i.dragged}if(typeof i.textareaHeight==="number"){e.widgetData.textareaHeight=i.textareaHeight}if(typeof i.showConsent==="boolean"){e.widgetData.showConsent=i.showConsent}if(typeof i.consentUrl==="string"){e.widgetData.consentUrl=i.consentUrl}if(typeof i.showed==="boolean"){e.widgetData.showed=i.showed;e.widgetData.reopen=i.showed}if(typeof i.copyright==="boolean"){e.widgetData.copyright=i.copyright}if(typeof i.dialogStart==="boolean"){e.widgetData.dialogStart=i.dialogStart}if(BX.Messenger.Utils.types.isPlainObject(i.disk)){if(typeof i.disk.enabled==="boolean"){e.widgetData.disk.enabled=i.disk.enabled}if(typeof i.disk.maxFileSize==="number"){e.widgetData.disk.maxFileSize=i.disk.maxFileSize}}if(BX.Messenger.Utils.types.isPlainObject(i.error)&&typeof i.error.active==="boolean"){e.widgetData.error={active:i.error.active,code:i.error.code||"",description:i.error.description||""}}if(i.operators instanceof Array){e.widgetData.operators=i.operators}if(i.connectors instanceof Array){e.widgetData.connectors=i.connectors}if(typeof i.uploadFilePlus!=="undefined"){e.widgetData.uploadFile=e.widgetData.uploadFile+1}if(typeof i.uploadFileMinus!=="undefined"){e.widgetData.uploadFile=e.widgetData.uploadFile-1}if(typeof i.showForm==="string"&&typeof r[i.showForm]!=="undefined"){e.widgetData.showForm=i.showForm}if(typeof i.deviceType==="string"&&typeof a[i.deviceType]!=="undefined"){e.widgetData.deviceType=i.deviceType}if(typeof i.deviceOrientation==="string"&&typeof s[i.deviceOrientation]!=="undefined"){e.widgetData.deviceOrientation=i.deviceOrientation}if(typeof i.location==="number"&&typeof l[i.location]!=="undefined"){e.widgetData.location=i.location}BX.Messenger.LocalStorage.set(e.widgetData.siteId,0,h.widgetData,e.widgetData)},dialogData:function t(e,i){if(typeof i.chatId==="number"){e.dialogData.chatId=i.chatId;e.dialogData.dialogId=i.chatId?"chat"+i.chatId:0}if(typeof i.diskFolderId==="number"){e.dialogData.diskFolderId=i.diskFolderId}if(typeof i.sessionId==="number"){e.dialogData.sessionId=i.sessionId}if(typeof i.messageLimit==="number"){e.dialogData.messageLimit=i.messageLimit}if(typeof i.sessionClose==="boolean"){e.dialogData.sessionClose=i.sessionClose}if(typeof i.userConsent==="boolean"){e.dialogData.userConsent=i.userConsent}if(typeof i.userVote==="string"&&typeof i.userVote!=="undefined"){e.dialogData.userVote=i.userVote}if(BX.Messenger.Utils.types.isPlainObject(i.operator)){if(typeof i.operator.name==="string"||typeof i.operator.name==="number"){e.dialogData.operator.name=i.operator.name.toString()}if(typeof i.operator.lastName==="string"||typeof i.operator.lastName==="number"){e.dialogData.operator.lastName=i.operator.lastName.toString()}if(typeof i.operator.firstName==="string"||typeof i.operator.firstName==="number"){e.dialogData.operator.firstName=i.operator.firstName.toString()}if(typeof i.operator.workPosition==="string"||typeof i.operator.workPosition==="number"){e.dialogData.operator.workPosition=i.operator.workPosition.toString()}if(typeof i.operator.avatar==="string"){if(!i.operator.avatar||i.operator.avatar.startsWith("http")){e.dialogData.operator.avatar=i.operator.avatar}else{e.dialogData.operator.avatar=e.widgetData.host+i.operator.avatar}}if(typeof i.operator.online==="boolean"){e.dialogData.operator.online=i.operator.online}}BX.Messenger.LocalStorage.set(e.widgetData.siteId,0,h.dialogData,e.dialogData)},userData:function t(e,i){if(typeof i.id==="number"){e.userData.id=i.id}if(typeof i.hash==="string"&&i.hash!==e.userData.hash){e.userData.hash=i.hash;C.set(null,"LIVECHAT_HASH",i.hash,{expires:365*86400,path:"/"})}if(typeof i.name==="string"||typeof i.name==="number"){e.userData.name=i.name.toString()}if(typeof i.firstName==="string"||typeof i.firstName==="number"){e.userData.firstName=i.firstName.toString()}if(typeof i.lastName==="string"||typeof i.lastName==="number"){e.userData.lastName=i.lastName.toString()}if(typeof i.avatar==="string"){e.userData.avatar=i.avatar}if(typeof i.email==="string"){e.userData.email=i.email}if(typeof i.phone==="string"||typeof i.phone==="number"){e.userData.phone=i.phone.toString()}if(typeof i.www==="string"){e.userData.www=i.www}if(typeof i.gender==="string"){e.userData.gender=i.gender}if(typeof i.position==="string"){e.userData.position=i.position}BX.Messenger.LocalStorage.set(e.widgetData.siteId,0,h.userData,e.userData)}}}}},{key:"initRestClient",value:function t(){this.restClient=new I({endpoint:this.host+"/rest"});if(this.isUserRegistered()){this.restClient.setAuthId(this.getUserHash())}else{this.restClient.setAuthId(D.guest)}}},{key:"requestWidgetData",value:function t(){var e=this;if(!this.isReady()){console.error("LiveChatWidget.start: widget code or host is not specified");return false}this.widgetDataRequested=true;if(!this.isUserRegistered()&&this.userRegisterData.hash){this.requestData();this.inited=true;this.fireInitEvent()}else if(this.isConfigDataLoaded()&&this.isUserRegistered()){this.requestData();this.inited=true;this.fireInitEvent()}else{this.restClient.callMethod(b.widgetConfigGet,{code:this.code},function(t){e.configRequestXhr=t}).then(function(t){e.configRequestXhr=null;e.clearError();e.storeDataFromRest(b.widgetConfigGet,t.data());if(!e.inited){e.inited=true;e.fireInitEvent()}}).catch(function(t){e.configRequestXhr=null;e.setError(t.error().ex.error,t.error().ex.error_description)});if(this.isConfigDataLoaded()){this.inited=true;this.fireInitEvent()}}this.timer=new BX.Messenger.Timer}},{key:"requestData",value:function t(){var e=this;if(this.requestDataSend){return true}this.requestDataSend=true;if(this.configRequestXhr){this.configRequestXhr.abort()}var i=babelHelpers.defineProperty({},b.widgetConfigGet,[b.widgetConfigGet,{code:this.code}]);if(this.isUserRegistered()){i[b.widgetDialogGet]=[b.widgetDialogGet,{config_id:this.getConfigId(),trace_data:this.getCrmTraceData(),custom_data:this.getCustomData()}];i[b.imChatGet]=[b.imChatGet,{dialog_id:"$result["+b.widgetDialogGet+"][dialogId]"}];i[b.imDialogMessagesGet]=[b.imDialogMessagesGet,{chat_id:"$result["+b.widgetDialogGet+"][chatId]",limit:this.requestMessageLimit,convert_text:"Y"}]}else{i[b.widgetUserRegister]=[b.widgetUserRegister,babelHelpers.objectSpread({config_id:"$result["+b.widgetConfigGet+"][configId]"},this.getUserRegisterFields())];i[b.imChatGet]=[b.imChatGet,{dialog_id:"$result["+b.widgetUserRegister+"][dialogId]"}];if(this.userRegisterData.hash){i[b.widgetDialogGet]=[b.widgetDialogGet,{config_id:"$result["+b.widgetConfigGet+"][configId]",trace_data:this.getCrmTraceData(),custom_data:this.getCustomData()}];i[b.imDialogMessagesGet]=[b.imDialogMessagesGet,{chat_id:"$result["+b.widgetDialogGet+"][chatId]",limit:this.requestMessageLimit,convert_text:"Y"}]}}i[b.pullServerTime]=[b.pullServerTime,{}];i[b.pullConfigGet]=[b.pullConfigGet,{CACHE:"N"}];i[b.widgetUserGet]=[b.widgetUserGet,{}];this.restClient.callBatch(i,function(t){if(!t){e.requestDataSend=false;e.setError("EMPTY_RESPONSE","Server returned an empty response.");return false}var i=t[b.widgetConfigGet];if(i&&i.error()){e.requestDataSend=false;e.setError(i.error().ex.error,i.error().ex.error_description);return false}e.storeDataFromRest(b.widgetConfigGet,i.data());var s=t[b.widgetUserGet];if(s.error()){e.requestDataSend=false;e.setError(s.error().ex.error,s.error().ex.error_description);return false}e.storeDataFromRest(b.widgetUserGet,s.data());var a=t[b.imChatGet];if(a.error()){e.requestDataSend=false;e.setError(a.error().ex.error,a.error().ex.error_description);return false}e.storeDataFromRest(b.imChatGet,a.data());var o=t[b.widgetDialogGet];if(o){if(o.error()){e.requestDataSend=false;e.setError(o.error().ex.error,o.error().ex.error_description);return false}e.storeDataFromRest(b.widgetDialogGet,o.data())}var r=t[b.imDialogMessagesGet];if(r){if(r.error()){e.requestDataSend=false;e.setError(r.error().ex.error,r.error().ex.error_description);return false}e.storeDataFromRest(b.imDialogMessagesGet,r.data())}var n=t[b.widgetUserRegister];if(n){if(n.error()){e.requestDataSend=false;e.setError(n.error().ex.error,n.error().ex.error_description);return false}e.storeDataFromRest(b.widgetUserRegister,n.data())}var l=0;var d=t[b.pullServerTime];if(d&&!d.error()){l=Math.floor(((new Date).getTime()-new Date(d.data()).getTime())/1e3)}var c=null;var h=t[b.pullConfigGet];if(h&&!h.error()){c=h.data();c.server.timeShift=l}e.startPullClient(c).then(function(){e.processSendMessages();e.processSendFiles()}).catch(function(t){e.setError(t.ex.error,t.ex.error_description)});e.requestDataSend=false},false,false,BX.Messenger.Utils.getLogTrackingParams({name:"widget.init.config",dialog:this.getDialogData()}))}},{key:"storeDataFromRest",value:function t(e,i){if(!w.includes(e)){console.warn("%cLiveChatWidget.storeDataFromRest: config is not set, because you are trying to set as unknown type (%c".concat(e,"%c)"),"color: black;","font-weight: bold; color: red","color: black");return false}if(e==b.widgetConfigGet){this.store.commit(h.widgetData,{configId:i.configId,configName:i.configName,vote:i.vote,operators:i.operators||[],online:i.online,consentUrl:i.consentUrl,connectors:i.connectors||[],disk:i.disk});this.addLocalize(i.serverVariables);BX.Messenger.LocalStorage.set(this.getSiteId(),0,"serverVariables",i.serverVariables||{})}else if(e==b.widgetUserRegister){this.restClient.setAuthId(i.hash);var s=[];if(typeof this.store.state[u.messages].collection[this.getChatId()]!=="undefined"){s=this.store.state[u.messages].collection[this.getChatId()]}this.store.commit(g.initCollection,{chatId:i.chatId,messages:s});this.store.commit(p.initCollection,{dialogId:i.dialogId,fields:{entityType:"LIVECHAT",type:"livechat"}});this.store.commit(h.dialogData,{chatId:i.chatId})}else if(e==b.imChatGet){this.store.dispatch(p.set,i)}else if(e==b.widgetUserGet){this.store.commit(h.userData,{id:i.id,hash:i.hash,name:i.name,firstName:i.firstName,lastName:i.lastName,phone:i.phone,avatar:i.avatar,email:i.email,www:i.www,gender:i.gender,position:i.position})}else if(e==b.widgetDialogGet){this.store.commit(g.initCollection,{chatId:i.chatId});this.store.commit(h.dialogData,{chatId:i.chatId,diskFolderId:i.diskFolderId,sessionId:i.sessionId,sessionClose:i.sessionClose,userVote:i.userVote,userConsent:i.userConsent,operator:i.operator})}else if(e==b.diskFolderGet){this.store.commit(h.dialogData,{diskFolderGet:i.ID})}else if(e==b.imDialogMessagesGet){this.store.dispatch(g.setBefore,i.messages);this.store.dispatch(m.set,i.users);this.store.dispatch(v.setBefore,this.prepareFileData(i.files));if(i.messages&&i.messages.length>0&&!this.isDialogStart()){this.store.commit(h.widgetData,{dialogStart:true})}}else if(e==b.imDialogMessagesUnread){this.store.dispatch(g.set,i.messages);this.store.dispatch(m.set,i.users);this.store.dispatch(v.set,this.prepareFileData(i.files))}return true}},{key:"prepareFileData",value:function t(e){var i=this;if(C.get(null,"BITRIX_LIVECHAT_AUTH")){return e}return e.map(function(t){var e=md5(i.getUserId()+"|"+t.id+"|"+i.getUserHash());var s="livechat_auth_id="+e+"&livechat_user_id="+i.getUserId();if(t.urlPreview){t.urlPreview=t.urlPreview+"&"+s}if(t.urlShow){t.urlShow=t.urlShow+"&"+s}if(t.urlDownload){t.urlDownload=t.urlDownload+"&"+s}return t})}},{key:"checkBrowserVersion",value:function t(){if(BX.Messenger.Utils.platform.isIos()){var e=BX.Messenger.Utils.platform.getIosVersion();if(e&&e<=10){return false}}return true}},{key:"startPullClient",value:function t(e){var i=this;var s=new BX.Promise;if(this.pullClient){if(!this.pullClient.isConnected()){this.pullClient.scheduleReconnect()}s.resolve(true);return s}if(!this.getUserId()||!this.getSiteId()||!this.restClient){s.reject({ex:{error:"WIDGET_NOT_LOADED",error_description:"Widget is not loaded."}});return s}this.pullClient=new BX.PullClient({serverEnabled:true,userId:this.getUserId(),siteId:this.getSiteId(),restClient:this.restClient,configTimestamp:e?e.server.config_timestamp:0,skipCheckRevision:true});this.pullClient.subscribe({type:BX.PullClient.SubscriptionType.Server,moduleId:"im",callback:this.eventMessengerInteraction.bind(this)});this.pullClient.subscribe({type:BX.PullClient.SubscriptionType.Server,moduleId:"imopenlines",callback:this.eventLinesInteraction.bind(this)});this.pullClient.subscribe({type:BX.PullClient.SubscriptionType.Status,callback:this.eventStatusInteraction.bind(this)});this.pullConnectedFirstTime=this.pullClient.subscribe({type:BX.PullClient.SubscriptionType.Status,callback:function t(e){if(e.status==BX.PullClient.PullStatus.Online){s.resolve(true);i.pullConnectedFirstTime()}}});if(this.template){this.template.$bitrixPullClient=this.pullClient;this.template.$root.$emit("onBitrixPullClientInited")}this.pullClient.start(e).catch(function(){s.reject({ex:{error:"PULL_CONNECTION_ERROR",error_description:"Pull is not connected."}})});return s}},{key:"recoverPullConnection",value:function t(){this.pullClient.restart(BX.PullClient.CloseReasons.MANUAL,"Restart after click by connection status button.")}},{key:"stopPullClient",value:function t(){if(this.pullClient){this.pullClient.stop(BX.PullClient.CloseReasons.MANUAL,"Closed manually")}}},{key:"eventMessengerInteraction",value:function t(e){var i=this;BX.Messenger.Logger.info("eventMessengerInteraction",e);if(e.command=="messageChat"){if(e.params.chat&&e.params.chat[e.params.chatId]){this.store.dispatch(p.update,{dialogId:"chat"+e.params.chatId,fields:e.params.chat[e.params.chatId]})}if(e.params.users){this.store.dispatch(m.set,BX.Messenger.Model.Users.convertToArray(e.params.users))}if(e.params.files){var s=BX.Messenger.Model.Files.convertToArray(e.params.files);this.store.dispatch(v.set,this.prepareFileData(s))}var a=this.store.state[u.messages].collection[this.getChatId()];if(!a){a=[]}var o=false;if(e.params.message.tempId&&a.length>0){for(var r=a.length-1;r>=0;r--){if(a[r].id==e.params.message.tempId){o=true;break}}}if(o){this.store.dispatch(g.update,{id:e.params.message.tempId,chatId:e.params.message.chatId,fields:e.params.message})}else if(this.isUnreadMessagesLoaded()){var n=0;if(a.length>0){a.forEach(function(t){return t.unread?n++:0})}if(n>0){this.store.commit(h.dialogData,{messageLimit:this.requestMessageLimit+n})}else if(this.getMessageLimit()!=this.requestMessageLimit){this.store.commit(h.dialogData,{messageLimit:this.requestMessageLimit})}this.store.dispatch(g.set,babelHelpers.objectSpread({},e.params.message,{unread:true}))}this.startWriting({dialogId:"chat"+e.params.message.chatId,userId:e.params.message.senderId,action:false});if(e.params.message.senderId==this.getUserId()){this.store.dispatch(g.readMessages,{chatId:e.params.message.chatId}).then(function(t){i.store.dispatch(p.update,{dialogId:"chat"+e.params.message.chatId,fields:{counter:0}})})}else{this.store.dispatch(p.increaseCounter,{dialogId:"chat"+e.params.message.chatId,count:1});this.sendEvent({type:d.operatorMessage,data:e.params});if(!this.store.state.widget.widgetData.showed&&!this.onceShowed){this.onceShowed=true;this.open()}}}else if(e.command=="messageUpdate"||e.command=="messageDelete"){this.store.dispatch(g.update,{id:e.params.id,chatId:e.params.chatId,fields:{text:e.command=="messageUpdate"?e.params.text:"",textOriginal:e.command=="messageUpdate"?e.params.textOriginal:"",params:e.params.params,blink:true}});this.startWriting({dialogId:e.params.dialogId,userId:e.params.senderId,action:false})}else if(e.command=="messageDeleteComplete"){this.store.dispatch(g.delete,{id:e.params.id,chatId:e.params.chatId});this.startWriting({dialogId:e.params.dialogId,userId:e.params.senderId,action:false})}else if(e.command=="messageParamsUpdate"){this.store.dispatch(g.update,{id:e.params.id,chatId:e.params.chatId,fields:{params:e.params.params}})}else if(e.command=="startWriting"){this.startWriting(e.params)}else if(e.command=="readMessageChat"){this.store.dispatch(g.readMessages,{chatId:e.params.chatId,readId:e.params.lastId}).then(function(t){i.store.dispatch(p.update,{dialogId:"chat"+e.params.chatId,fields:{counter:e.params.counter}})})}}},{key:"eventLinesInteraction",value:function t(e){BX.Messenger.Logger.info("eventLinesInteraction",e);if(e.command=="sessionStart"){this.store.commit(h.dialogData,{sessionId:e.params.sessionId,sessionClose:false,userVote:i.none});this.sendEvent({type:d.sessionStart,data:{sessionId:e.params.sessionId}})}else if(e.command=="sessionOperatorChange"){this.store.commit(h.dialogData,{operator:e.params.operator});this.sendEvent({type:d.sessionOperatorChange,data:{operator:e.params.operator}})}else if(e.command=="sessionFinish"){this.store.commit(h.dialogData,{sessionId:e.params.sessionId,sessionClose:true});this.sendEvent({type:d.sessionFinish,data:{sessionId:e.params.sessionId}});if(!e.params.spam){this.store.commit(h.dialogData,{operator:{name:"",firstName:"",lastName:"",workPosition:"",avatar:"",online:false}})}}}},{key:"eventStatusInteraction",value:function t(e){var i=this;if(e.status===BX.PullClient.PullStatus.Online){this.offline=false;if(this.pullRequestMessage){this.getDialogUnread().then(function(){i.readMessage();i.processSendMessages();i.processSendFiles()});this.pullRequestMessage=false}else{this.readMessage();this.processSendMessages();this.processSendFiles()}}else if(e.status===BX.PullClient.PullStatus.Offline){this.pullRequestMessage=true;this.offline=true}}},{key:"attachTemplate",value:function t(){if(this.template){this.store.commit(h.widgetData,{showed:true});return true}this.rootNode.innerHTML="";this.rootNode.appendChild(document.createElement("div"));var e=this;var i=this.restClient;var s=this.pullClient;this.template=BX.Vue.create({el:this.rootNode.firstChild,store:this.store,template:"<bx-livechat/>",beforeCreate:function t(){this.$bitrixController=e;this.$bitrixRestClient=i;this.$bitrixPullClient=s;this.$bitrixMessages=e.localize;e.sendEvent({type:d.widgetOpen,data:{}})},destroyed:function t(){e.sendEvent({type:d.widgetClose,data:{}});this.$bitrixController.template=null;this.$bitrixController.templateAttached=false;this.$bitrixController.rootNode.innerHTML="";this.$bitrixController=null;this.$bitrixRestClient=null;this.$bitrixPullClient=null;this.$bitrixMessages=null}});return true}},{key:"detachTemplate",value:function t(){if(!this.template){return true}this.template.$destroy();return true}},{key:"mutateTemplateComponent",value:function t(e,i){return BX.Vue.mutateComponent(e,i)}},{key:"addMessage",value:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";if(!i){return false}BX.Messenger.Logger.warn("addMessage",i);if(!this.isUnreadMessagesLoaded()){this.sendMessage({id:0,text:i});this.processSendMessages();return true}this.store.dispatch(g.add,{chatId:this.getChatId(),authorId:this.getUserId(),text:i}).then(function(t){if(!e.isDialogStart()){e.store.commit(h.widgetData,{dialogStart:true})}e.messagesQueue.push({id:t,text:i,sending:false});if(e.getChatId()){e.processSendMessages()}else{e.requestData()}});return true}},{key:"addFile",value:function t(e){if(!e){return false}BX.Messenger.Logger.warn("addFile",e.files[0].name,e.files[0].size);if(!this.isDialogStart()){this.store.commit(h.widgetData,{dialogStart:true})}this.filesQueue.push({id:this.filesQueueIndex,fileInput:e});this.filesQueueIndex++;if(this.getChatId()){this.processSendFiles()}else{this.requestData()}return true}},{key:"writesMessage",value:function t(){var e=this;if(!this.getChatId()||this.timer.has("writes")){return}this.timer.start("writes",null,28);this.timer.start("writesSend",null,5,function(t){e.restClient.callMethod(b.imChatSendTyping,{CHAT_ID:e.getChatId()}).catch(function(){e.timer.stop("writes",e.getChatId())})})}},{key:"stopWritesMessage",value:function t(){this.timer.stop("writes");this.timer.stop("writesSend")}},{key:"processSendMessages",value:function t(){var e=this;if(this.offline){return false}this.messagesQueue.filter(function(t){return!t.sending}).forEach(function(t){t.sending=true;e.sendMessage(t)});return true}},{key:"processSendFiles",value:function t(){var e=this;if(this.offline){return false}this.filesQueue.filter(function(t){return!t.sending}).forEach(function(t){t.sending=true;e.sendFile(t)});return true}},{key:"sendMessage",value:function t(e){var i=this;this.stopWritesMessage();this.restClient.callMethod(b.imMessageAdd,{TEMP_ID:e.id,CHAT_ID:this.getChatId(),MESSAGE:e.text},null,null,BX.Messenger.Utils.getLogTrackingParams({name:b.imMessageAdd,data:{timMessageType:"text"},dialog:this.getDialogData()})).then(function(t){var s=t.data();if(typeof s==="number"){i.store.dispatch(g.update,{id:e.id,chatId:i.getChatId(),fields:{id:s,sending:false,error:false}});i.store.dispatch(g.actionFinish,{id:s,chatId:i.getChatId()})}else{i.store.dispatch(g.actionError,{id:e.id,chatId:i.getChatId()})}i.messagesQueue=i.messagesQueue.filter(function(t){return t.id!=e.id});i.sendEvent({type:d.userMessage,data:{id:s,text:e.text}})}).catch(function(t){i.store.dispatch(g.actionError,{id:e.id,chatId:i.getChatId()});i.messagesQueue=i.messagesQueue.filter(function(t){return t.id!=e.id})})}},{key:"sendFile",value:function t(e){var i=this;var s=e.fileInput.files[0].name;var a="file";var o=this.getDiskFolderId();var r={};if(o){r[b.diskFileUpload]=[b.diskFileUpload,{id:o,data:{NAME:s},fileContent:e.fileInput,generateUniqueName:true}]}else{r[b.diskFolderGet]=[b.diskFolderGet,{chat_id:this.getChatId()}];r[b.diskFileUpload]=[b.diskFileUpload,{id:"$result["+b.diskFolderGet+"][ID]",data:{NAME:s},fileContent:e.fileInput,generateUniqueName:true}]}r[b.diskFileCommit]=[b.diskFileCommit,{chat_id:this.getChatId(),upload_id:"$result["+b.diskFileUpload+"][ID]"}];this.store.commit(h.widgetData,{uploadFilePlus:true});this.restClient.callBatch(r,function(t){i.store.commit(h.widgetData,{uploadFileMinus:true});if(!t){i.requestDataSend=false;i.setError("EMPTY_RESPONSE","Server returned an empty response.");return false}if(!o){var e=t[b.diskFolderGet];if(e&&e.error()){console.warn(e.error().ex.error,e.error().ex.error_description);return false}i.storeDataFromRest(b.diskFolderGet,e.data())}var s=t[b.diskFileUpload];if(s&&s.error()){console.warn(s.error().ex.error,s.error().ex.error_description);return false}else{BX.Messenger.Logger.log("upload success",s.data())}var a=t[b.diskFileCommit];if(a&&a.error()){console.warn(a.error().ex.error,a.error().ex.error_description);return false}else{BX.Messenger.Logger.log("commit success",a.data())}},false,false,BX.Messenger.Utils.getLogTrackingParams({name:b.diskFileCommit,data:{timMessageType:a},dialog:this.getDialogData()}));this.filesQueue=this.filesQueue.filter(function(t){return t.id!=e.id})}},{key:"sendDialogVote",value:function t(e){var s=this;if(!this.getSessionId()){return false}this.restClient.callMethod(b.widgetVoteSend,{SESSION_ID:this.getSessionId(),ACTION:e}).catch(function(t){s.store.commit(h.dialogData,{userVote:i.none})});this.sendEvent({type:d.userVote,data:{vote:e}})}},{key:"sendForm",value:function t(e,i){var s,a=this;BX.Messenger.Logger.info("LiveChatWidgetPrivate.sendForm:",e,i);var o=(s={},babelHelpers.defineProperty(s,b.widgetFormSend,[b.widgetFormSend,{CHAT_ID:this.getChatId(),FORM:e.toUpperCase(),FIELDS:i}]),babelHelpers.defineProperty(s,b.widgetUserGet,[b.widgetUserGet,{}]),s);this.restClient.callBatch(o,function(t){if(!t){a.requestDataSend=false;a.setError("EMPTY_RESPONSE","Server returned an empty response.");return false}var s=t[b.widgetUserGet];if(s.error()){a.requestDataSend=false;a.setError(s.error().ex.error,s.error().ex.error_description);return false}a.storeDataFromRest(b.widgetUserGet,s.data());a.sendEvent({type:d.userForm,data:{form:e,fields:i}})},false,false,BX.Messenger.Utils.getLogTrackingParams({name:b.widgetUserGet,dialog:this.getDialogData()}))}},{key:"sendConsentDecision",value:function t(e){e=e===true;this.store.commit(h.dialogData,{userConsent:e});if(e&&this.isUserRegistered()){this.restClient.callMethod(b.widgetUserConsentApply,{config_id:this.getConfigId(),consent_url:location.href})}}},{key:"getDialogHistory",value:function t(e){var i=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.requestMessageLimit;this.restClient.callMethod(b.imDialogMessagesGet,{CHAT_ID:this.getChatId(),LAST_ID:e,LIMIT:s,CONVERT_TEXT:"Y"}).then(function(t){var e=t.data();i.storeDataFromRest(b.imDialogMessagesGet,e);i.template.$emit("onDialogRequestHistoryResult",{count:e.messages.length})}).catch(function(t){i.template.$emit("onDialogRequestHistoryResult",{error:t.error().ex})})}},{key:"getDialogUnread",value:function t(e){var i,s=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.requestMessageLimit;var o=new BX.Promise;if(!e){e=this.store.getters[f.getLastId](this.getChatId())}if(!e){this.template.$emit("onDialogRequestUnreadResult",{error:{error:"LAST_ID_EMPTY",error_description:"LastId is empty."}});o.reject();return o}var r=(i={},babelHelpers.defineProperty(i,b.imChatGet,[b.imChatGet,{dialog_id:this.getDialogId()}]),babelHelpers.defineProperty(i,b.imDialogMessagesUnread,[b.imDialogMessagesGet,{chat_id:this.getChatId(),first_id:e,limit:a,convert_text:"Y"}]),i);this.restClient.callBatch(r,function(t){if(!t){s.template.$emit("onDialogRequestUnreadResult",{error:{error:"EMPTY_RESPONSE",error_description:"Server returned an empty response."}});o.reject();return false}var e=t[b.imChatGet];if(!e.error()){s.storeDataFromRest(b.imChatGet,e.data())}var i=t[b.imDialogMessagesUnread];if(i.error()){s.template.$emit("onDialogRequestUnreadResult",{error:i.error().ex})}else{var a=i.data();s.storeDataFromRest(b.imDialogMessagesUnread,a);s.template.$emit("onDialogRequestUnreadResult",{count:a.messages.length})}o.fulfill(t)},false,false,BX.Messenger.Utils.getLogTrackingParams({name:b.imDialogMessagesUnread,dialog:this.getDialogData()}));return o}},{key:"retrySendMessage",value:function t(e){if(this.messagesQueue.find(function(t){return t.id==e.id})){return false}this.messagesQueue.push({id:e.id,text:e.text,sending:false});this.store.dispatch(g.actionStart,{id:e.id,chatId:this.getChatId()});this.processSendMessages()}},{key:"readMessage",value:function t(e){var i=this;if(e){this.messageReadQueue.push(parseInt(e))}if(this.offline){return false}this.timer.start("readMessage",null,.1,function(t,e){i.messageReadQueue=i.messageReadQueue.filter(function(t){if(!i.messageLastReadId){i.messageLastReadId=t}else if(i.messageLastReadId<t){i.messageLastReadId=t}return false});if(i.messageLastReadId<=0){return false}i.store.dispatch(g.readMessages,{chatId:i.getChatId(),readId:i.messageLastReadId}).then(function(t){i.store.dispatch(p.decreaseCounter,{dialogId:i.getDialogId(),count:t.count})});i.timer.start("readMessageServer",null,.5,function(t,e){i.restClient.callMethod(b.imDialogRead,{DIALOG_ID:i.getDialogId(),MESSAGE_ID:i.messageLastReadId})})})}},{key:"startWriting",value:function t(e){var i=this;var s=e.dialogId,a=e.userId,o=e.userName,r=e.action,n=r===void 0?true:r;if(n){this.store.dispatch(p.updateWriting,{dialogId:s,userId:a,userName:o,action:true});this.timer.start("writingEnd",s+"|"+a,35,function(t,e){var s=e.dialogId,a=e.userId;i.store.dispatch(p.updateWriting,{dialogId:s,userId:a,action:false})},{dialogId:s,userId:a})}else{this.timer.stop("writingStart",s+"|"+a,true);this.timer.stop("writingEnd",s+"|"+a)}}},{key:"start",value:function t(){if(this.isSessionActive()){this.requestWidgetData()}}},{key:"open",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!e.openFromButton&&this.buttonInstance){this.buttonInstance.wm.showById("openline_livechat")}if(!this.checkBrowserVersion()){this.setError("OLD_BROWSER_LOCALIZED",this.localize.BX_LIVECHAT_OLD_BROWSER)}else if(BX.Messenger.Utils.versionCompare(Vue.version,"2.1")<0){alert(this.localize.BX_LIVECHAT_OLD_VUE);console.error("LiveChatWidget.error: OLD_VUE_VERSION (".concat(this.localize.BX_LIVECHAT_OLD_VUE_DEV.replace("#CURRENT_VERSION#",Vue.version),")"));return false}else if(!this.isWidgetDataRequested()){this.requestWidgetData()}this.attachTemplate()}},{key:"close",value:function t(){if(this.pageMode){return false}if(this.buttonInstance){this.buttonInstance.onWidgetClose()}this.detachTemplate()}},{key:"showNotification",value:function t(e){}},{key:"fireInitEvent",value:function t(){if(this.initEventFired){return true}this.sendEvent({type:d.configLoaded,data:{}});if(this.store.state.widget.widgetData.reopen){this.open()}this.initEventFired=true;return true}},{key:"isReady",value:function t(){return this.ready}},{key:"isInited",value:function t(){return this.inited}},{key:"isUserRegistered",value:function t(){return!!this.getUserHash()}},{key:"isConfigDataLoaded",value:function t(){return this.store.state.widget.widgetData.configId}},{key:"isWidgetDataRequested",value:function t(){return this.widgetDataRequested}},{key:"isChatLoaded",value:function t(){return this.store.state.widget.dialogData.chatId>0}},{key:"isSessionActive",value:function t(){return!this.store.state.widget.dialogData.sessionClose}},{key:"getCrmTraceData",value:function t(){var e="";if(!this.buttonInstance){return e}if(typeof this.buttonInstance.getTrace!=="function"){e=this.buttonInstance.getTrace()}else if(typeof this.buttonInstance.b24Tracker!=="undefined"&&typeof this.buttonInstance.b24Tracker.guest!=="undefined"){e=this.buttonInstance.b24Tracker.guest.getTrace()}return e}},{key:"getCustomData",value:function t(){var e=[];if(this.customData.length>0){e=this.customData}else{e=[{MESSAGE:this.localize.BX_LIVECHAT_EXTRA_SITE+": "+location.href}]}return JSON.stringify(e)}},{key:"isUserLoaded",value:function t(){return this.store.state.widget.userData.id>0}},{key:"getSiteId",value:function t(){return this.host.replace(/(http.?:\/\/)|([:.\\\/])/gm,"")+this.code}},{key:"getMessageLimit",value:function t(){return this.store.state.widget.dialogData.messageLimit}},{key:"isUnreadMessagesLoaded",value:function t(){var e=this.store.state[u.dialogues].collection[this.getDialogId()];if(!e){return true}if(e.unreadLastId<=0){return true}var i=this.store.state[u.messages].collection[this.getChatId()];if(!i||i.length<=0){return true}var s=0;for(var a=i.length-1;a>=0;a--){var o=i[a];if(typeof o.id==="number"){s=o.id;break}}return s>=e.unreadLastId}},{key:"getHost",value:function t(){return this.host}},{key:"getConfigId",value:function t(){return this.store.state.widget.widgetData.configId}},{key:"getChatId",value:function t(){return this.store.state.widget.dialogData.chatId}},{key:"isDialogStart",value:function t(){return this.store.state.widget.widgetData.dialogStart}},{key:"getDialogId",value:function t(){return"chat"+this.getChatId()}},{key:"getDialogData",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getDialogId();return this.store.state[u.dialogues].collection[e]}},{key:"getDiskFolderId",value:function t(){return this.store.state.widget.dialogData.diskFolderId}},{key:"getSessionId",value:function t(){return this.store.state.widget.dialogData.sessionId}},{key:"getUserHash",value:function t(){return this.store.state.widget.userData.hash}},{key:"getUserHashCookie",value:function t(){var e="";var i=C.get(null,"LIVECHAT_HASH");if(typeof i==="string"&&i.match(/^[a-f0-9]{32}$/)){e=i}else{var s=C.get(this.getSiteId(),"LIVECHAT_HASH");if(typeof s==="string"&&s.match(/^[a-f0-9]{32}$/)){e=s}}return e}},{key:"getUserId",value:function t(){return this.store.state.widget.userData.id}},{key:"getUserData",value:function t(){return this.store.state.widget.userData}},{key:"getUserRegisterFields",value:function t(){return{name:this.userRegisterData.name||"",last_name:this.userRegisterData.lastName||"",avatar:this.userRegisterData.avatar||"",email:this.userRegisterData.email||"",www:this.userRegisterData.www||"",gender:this.userRegisterData.gender||"",position:this.userRegisterData.position||"",user_hash:this.userRegisterData.hash||"",consent_url:this.store.state.widget.widgetData.consentUrl?location.href:"",trace_data:this.getCrmTraceData(),custom_data:this.getCustomData()}}},{key:"getWidgetLocationCode",value:function t(){return l[this.store.state.widget.widgetData.location]}},{key:"setUserRegisterData",value:function t(e){var i=["hash","name","lastName","avatar","email","www","gender","position"];if(!BX.Messenger.Utils.types.isPlainObject(e)){console.error("%cLiveChatWidget.setUserData: params is not a object","color: black;");return false}for(var s in this.userRegisterData){if(!this.userRegisterData.hasOwnProperty(s)){continue}if(!e[s]){delete this.userRegisterData[s]}}for(var a in e){if(!e.hasOwnProperty(a)){continue}if(i.indexOf(a)===-1){console.warn("%cLiveChatWidget.setUserData: user field is not set, because you are trying to set an unknown field (%c".concat(a,"%c)"),"color: black;","font-weight: bold; color: red","color: black");continue}this.userRegisterData[a]=e[a]}if(this.userRegisterData.hash&&this.getUserHash()&&this.userRegisterData.hash!=this.getUserHash()){this.setNewAuthToken(this.userRegisterData.hash)}}},{key:"setNewAuthToken",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var i=this.getSiteId();this.store.commit(h.userData,{id:0,hash:""});this.store.commit(h.widgetData,{configId:0,dialogStart:false});this.store.commit(h.dialogData,{chatId:0,diskFolderId:0,sessionId:0,sessionClose:false,userVote:false,userConsent:false});BX.LiveChatCookie={};BX.Messenger.LocalStorage.remove(i,0,h.widgetData);BX.Messenger.LocalStorage.remove(i,0,h.dialogData);BX.Messenger.LocalStorage.remove(i,0,h.userData);C.set(null,"LIVECHAT_HASH","",{expires:365*86400,path:"/"});this.restClient.setAuthId(D.guest,e)}},{key:"setCustomData",value:function t(e){var i=[];if(e instanceof Array){e.forEach(function(t){if(t&&babelHelpers.typeof(t)==="object"){i.push(t)}});if(i.length<=0){console.error("LiveChatWidget.setCustomData: params is empty");return false}}else{if(!e){return false}i=[{MESSAGE:e}]}this.customData=this.customData.concat(i);return true}},{key:"setError",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";console.error("LiveChatWidget.error: ".concat(e," (").concat(i,")"));var s="";if(e=="LIVECHAT_AUTH_FAILED"){s=this.getLocalize("BX_LIVECHAT_AUTH_FAILED").replace("#LINK_START#",'<a href="#reload" onclick="location.reload()">').replace("#LINK_END#","</a>");this.setNewAuthToken()}else if(e=="LIVECHAT_AUTH_PORTAL_USER"){s=this.getLocalize("BX_LIVECHAT_PORTAL_USER_NEW").replace("#LINK_START#",'<a href="'+this.host+'">').replace("#LINK_END#","</a>")}else if(e.endsWith("LOCALIZED")){s=i}this.store.commit(h.widgetData,{error:{active:true,code:e,description:s}})}},{key:"clearError",value:function t(){this.store.commit(h.widgetData,{error:{active:false,code:"",description:""}})}},{key:"subscribe",value:function t(e){if(!BX.Messenger.Utils.types.isPlainObject(e)){console.error("%cLiveChatWidget.subscribe: params is not a object","color: black;");return false}if(!c.includes(e.type)){console.error("%cLiveChatWidget.subscribe: subscription type is not correct (%c".concat(e.type,"%c)"),"color: black;","font-weight: bold; color: red","color: black");return false}if(typeof e.callback!=="function"){console.error("%cLiveChatWidget.subscribe: callback is not a function (%c".concat(babelHelpers.typeof(e.callback),"%c)"),"color: black;","font-weight: bold; color: red","color: black");return false}if(typeof this.subscribers[e.type]==="undefined"){this.subscribers[e.type]=[]}this.subscribers[e.type].push(e.callback);return function(){this.subscribers[e.type]=this.subscribers[e.type].filter(function(t){return t!==e.callback})}.bind(this)}},{key:"sendEvent",value:function t(e){e=e||{};if(!e.type){return false}if(babelHelpers.typeof(e.data)!=="object"||!e.data){e.data={}}if(this.subscribers[e.type]instanceof Array&&this.subscribers[e.type].length>0){this.subscribers[e.type].forEach(function(t){return t(e.data)})}if(this.subscribers[d.every]instanceof Array&&this.subscribers[d.every].length>0){this.subscribers[d.every].forEach(function(t){return t({type:e.type,data:e.data})})}return true}},{key:"addLocalize",value:function t(e){if(babelHelpers.typeof(e)!=="object"){return false}for(var i in e){if(e.hasOwnProperty(i)){this.localize[i]=e[i]}}return true}},{key:"getLocalize",value:function t(e){var i="";if(typeof e==="undefined"){return this.localize}else if(typeof this.localize[e.toString()]==="undefined"){console.warn("LiveChatWidget.getLocalize: message with code '".concat(e.toString(),"' is undefined."))}else{i=this.localize[e]}return i}},{key:"getDateFormat",value:function t(){var e=this;if(this.dateFormat){return this.dateFormat}this.dateFormat=Object.create(BX.Main.Date);this.dateFormat._getMessage=function(t){return e.getLocalize(t)};return this.dateFormat}}]);return t}();var C={get:function t(e,i){var s=e?e+"_"+i:i;if(navigator.cookieEnabled){var a=document.cookie.match(new RegExp("(?:^|; )"+s.replace(/([.$?*|{}()\[\]\\\/+^])/g,"\\$1")+"=([^;]*)"));if(a){return decodeURIComponent(a[1])}}if(BX.Messenger.LocalStorage.isEnabled()){var o=BX.Messenger.LocalStorage.get(e,0,i,undefined);if(typeof o!=="undefined"){return o}}if(typeof BX.LiveChatCookie==="undefined"){BX.LiveChatCookie={}}return BX.LiveChatCookie[s]},set:function t(e,i,s,a){a=a||{};var o=a.expires;if(typeof o=="number"&&o){var r=new Date;r.setTime(r.getTime()+o*1e3);o=a.expires=r}if(o&&o.toUTCString){a.expires=o.toUTCString()}s=encodeURIComponent(s);var n=e?e+"_"+i:i;var l=n+"="+s;for(var d in a){if(!a.hasOwnProperty(d)){continue}l+="; "+d;var c=a[d];if(c!==true){l+="="+c}}document.cookie=l;if(typeof BX.LiveChatCookie==="undefined"){BX.LiveChatCookie={}}BX.LiveChatCookie[n]=s;BX.Messenger.LocalStorage.set(e,0,i,s);return true}};var I=function(){function t(e){babelHelpers.classCallCheck(this,t);this.queryAuthRestore=false;this.setAuthId(D.guest);this.restClient=new BX.RestClient({endpoint:e.endpoint,queryParams:this.queryParams,cors:true})}babelHelpers.createClass(t,[{key:"setAuthId",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";if(babelHelpers.typeof(this.queryParams)!=="object"){this.queryParams={}}if(e==D.guest||typeof e==="string"&&e.match(/^[a-f0-9]{32}$/)){this.queryParams.livechat_auth_id=e}else{console.error("%LiveChatRestClient.setAuthId: auth is not correct (%c".concat(e,"%c)"),"color: black;","font-weight: bold; color: red","color: black");return false}if(e==D.guest&&typeof i==="string"&&i.match(/^[a-f0-9]{32}$/)){this.queryParams.livechat_custom_auth_id=i}return true}},{key:"getAuthId",value:function t(){if(babelHelpers.typeof(this.queryParams)!=="object"){this.queryParams={}}return this.queryParams.livechat_auth_id||null}},{key:"callMethod",value:function t(e,i,s,a){var o=this;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;if(!r){r=BX.Messenger.Utils.getLogTrackingParams({name:e})}var n=new BX.Promise;this.restClient.callMethod(e,i,null,a,r).then(function(t){o.queryAuthRestore=false;n.fulfill(t)}).catch(function(t){var s=t.error();if(s.ex.error=="LIVECHAT_AUTH_WIDGET_USER"){o.setAuthId(s.ex.hash);if(e===b.widgetUserRegister){console.warn("BX.LiveChatRestClient: ".concat(s.ex.error_description," (").concat(s.ex.error,")"));o.queryAuthRestore=false;n.reject(t);return false}if(!o.queryAuthRestore){console.warn("BX.LiveChatRestClient: your auth-token has expired, send query with a new token");o.queryAuthRestore=true;o.restClient.callMethod(e,i,null,a,r).then(function(t){o.queryAuthRestore=false;n.fulfill(t)}).catch(function(t){o.queryAuthRestore=false;n.reject(t)});return false}}o.queryAuthRestore=false;n.reject(t)});return n}},{key:"callBatch",value:function t(e,i,s,a,o){var r=this;var n=function t(n){for(var l in e){if(!e.hasOwnProperty(l)){continue}var d=n[l].error();if(d&&d.ex.error=="LIVECHAT_AUTH_WIDGET_USER"){r.setAuthId(d.ex.hash);if(l===b.widgetUserRegister){console.warn("BX.LiveChatRestClient: ".concat(d.ex.error_description," (").concat(d.ex.error,")"));r.queryAuthRestore=false;i(n);return false}if(!r.queryAuthRestore){console.warn("BX.LiveChatRestClient: your auth-token has expired, send query with a new token");r.queryAuthRestore=true;r.restClient.callBatch(e,i,s,a,o);return false}}}r.queryAuthRestore=false;i(n);return true};return this.restClient.callBatch(e,n,s,a,o)}}]);return t}();BX.Vue.component("bx-livechat",{data:function t(){return{viewPortMetaSiteNode:null,viewPortMetaWidgetNode:null,storedMessage:"",storedFile:null,textareaFocused:false,textareaDrag:false,textareaHeight:100,textareaMinimumHeight:100,textareaMaximumHeight:BX.Messenger.Utils.device.isMobile()?200:300,chat:{id:0}}},created:function t(){this.onCreated();document.addEventListener("keydown",this.onWindowKeyDown);this.$root.$on("requestShowForm",this.onRequestShowForm)},beforeDestroy:function t(){document.removeEventListener("keydown",this.onWindowKeyDown);this.$root.$off("requestShowForm",this.onRequestShowForm);this.onTextareaDragEventRemove()},computed:babelHelpers.objectSpread({FormType:function t(){return r},VoteType:function t(){return i},DeviceType:function t(){return a},textareaHeightStyle:function t(e){return"flex: 0 0 "+this.textareaHeight+"px;"},localize:function t(){return BX.Vue.getFilteredPhrases("BX_LIVECHAT_",this.$root.$bitrixMessages)},widgetMobileDisabled:function t(e){if(e.widgetData.deviceType==a.mobile){if(navigator.userAgent.toString().includes("iPad"));else if(e.widgetData.deviceOrientation==s.horizontal){if(navigator.userAgent.toString().includes("iPhone")){return true}else{return!(babelHelpers.typeof(window.screen)==="object"&&window.screen.availHeight>=800)}}}return false},widgetClassName:function t(e){var i=["bx-livechat-wrapper"];i.push("bx-livechat-show");if(e.widgetData.pageMode){i.push("bx-livechat-page-mode")}else{i.push("bx-livechat-position-"+l[e.widgetData.location])}if(e.widgetData.language==o.russian){i.push("bx-livechat-logo-ru")}else if(e.widgetData.language==o.ukraine){i.push("bx-livechat-logo-ua")}else{i.push("bx-livechat-logo-en")}if(!e.widgetData.online){i.push("bx-livechat-offline-state")}if(e.widgetData.dragged){i.push("bx-livechat-drag-n-drop")}if(e.widgetData.dialogStart){i.push("bx-livechat-chat-start")}if(e.dialogData.operator.name&&!(e.widgetData.deviceType==a.mobile&&e.widgetData.deviceOrientation==s.horizontal)){i.push("bx-livechat-has-operator")}if(BX.Messenger.Utils.device.isMobile()){i.push("bx-livechat-mobile")}else if(BX.Messenger.Utils.browser.isSafari()){i.push("bx-livechat-browser-safari")}else if(BX.Messenger.Utils.browser.isIe()){i.push("bx-livechat-browser-ie")}if(BX.Messenger.Utils.platform.isMac()){i.push("bx-livechat-mac")}else{i.push("bx-livechat-custom-scroll")}if(e.widgetData.styles.backgroundColor&&BX.Messenger.Utils.isDarkColor(e.widgetData.styles.iconColor)){i.push("bx-livechat-bright-header")}return i.join(" ")},showMessageDialog:function t(){return this.messageCollection.length>0}},BX.Vuex.mapState({widgetData:function t(e){return e.widget.widgetData},userData:function t(e){return e.widget.userData},dialogData:function t(e){return e.widget.dialogData},messageCollection:function t(e){return e[u.messages].collection[e.widget.dialogData.chatId]}})),watch:{sessionClose:function t(e){BX.Messenger.Logger.log("sessionClose change",e)}},methods:{close:function t(e){if(this.$store.state.widget.widgetData.pageMode){return false}this.onBeforeClose();this.$store.commit(h.widgetData,{showed:false})},showLikeForm:function t(){if(this.offline){return false}clearTimeout(this.showFormTimeout);if(!this.$store.state.widget.widgetData.vote.enable){return false}if(this.$store.state.widget.dialogData.sessionClose&&this.$store.state.widget.dialogData.userVote!=i.none){return false}this.$store.commit(h.widgetData,{showForm:r.like})},showWelcomeForm:function t(){clearTimeout(this.showFormTimeout);this.$store.commit(h.widgetData,{showForm:r.welcome})},showOfflineForm:function t(){clearTimeout(this.showFormTimeout);if(this.$store.state.widget.dialogData.showForm!==r.welcome){this.$store.commit(h.widgetData,{showForm:r.offline})}},showHistoryForm:function t(){clearTimeout(this.showFormTimeout);this.$store.commit(h.widgetData,{showForm:r.history})},hideForm:function t(){clearTimeout(this.showFormTimeout);this.$store.commit(h.widgetData,{showForm:r.none})},showConsentWidow:function t(){this.$store.commit(h.widgetData,{showConsent:true})},agreeConsentWidow:function t(){this.$store.commit(h.widgetData,{showConsent:false});this.$root.$bitrixController.sendConsentDecision(true);if(this.storedMessage||this.storedFile){if(this.storedMessage){this.onTextareaSend({focus:this.widgetData.deviceType!=a.mobile});this.storedMessage=""}if(this.storedFile){this.onTextareaFileSelected();this.storedFile=""}}else if(this.widgetData.showForm==r.none){this.$root.$emit("onMessengerTextareaFocus")}},disagreeConsentWidow:function t(){this.$store.commit(h.widgetData,{showForm:r.none});this.$store.commit(h.widgetData,{showConsent:false});this.$root.$bitrixController.sendConsentDecision(false);if(this.storedMessage){this.$root.$emit("onMessengerTextareaInsertText",{text:this.storedMessage,focus:this.widgetData.deviceType!=a.mobile});this.storedMessage=""}if(this.storedFile){this.storedFile=""}if(this.widgetData.deviceType!=a.mobile){this.$root.$emit("onMessengerTextareaFocus")}},logEvent:function t(e){var i;for(var s=arguments.length,a=new Array(s>1?s-1:0),o=1;o<s;o++){a[o-1]=arguments[o]}(i=BX.Messenger.Logger).info.apply(i,[e].concat(a))},onCreated:function t(){var e=this;if(BX.Messenger.Utils.device.isMobile()){var i=Array.from(document.head.getElementsByTagName("meta")).filter(function(t){return t.name=="viewport"})[0];if(i){this.viewPortMetaSiteNode=i;document.head.removeChild(this.viewPortMetaSiteNode)}else{var s=document.body.offsetWidth;if(s<window.innerWidth){s=window.innerWidth}if(s<1024){s=1024}this.viewPortMetaSiteNode=document.createElement("meta");this.viewPortMetaSiteNode.setAttribute("name","viewport");this.viewPortMetaSiteNode.setAttribute("content","width=".concat(s,", initial-scale=1.0, user-scalable=1"))}if(!this.viewPortMetaWidgetNode){this.viewPortMetaWidgetNode=document.createElement("meta");this.viewPortMetaWidgetNode.setAttribute("name","viewport");this.viewPortMetaWidgetNode.setAttribute("content","width=device-width, initial-scale=1.0, user-scalable=0");document.head.appendChild(this.viewPortMetaWidgetNode)}document.body.classList.add("bx-livechat-mobile-state");if(BX.Messenger.Utils.browser.isSafariBased()){document.body.classList.add("bx-livechat-mobile-safari-based")}setTimeout(function(){e.$store.commit(h.widgetData,{showed:true})},50)}else{this.$store.commit(h.widgetData,{showed:true})}this.textareaHeight=this.$store.state.widget.widgetData.textareaHeight||this.textareaHeight;this.$store.commit(v.initCollection,{chatId:this.$root.$bitrixController.getChatId()});this.$store.commit(g.initCollection,{chatId:this.$root.$bitrixController.getChatId()});this.$store.commit(p.initCollection,{dialogId:this.$root.$bitrixController.getDialogId(),fields:{entityType:"LIVECHAT",type:"livechat"}})},onBeforeClose:function t(){if(BX.Messenger.Utils.device.isMobile()){document.body.classList.remove("bx-livechat-mobile-state");if(BX.Messenger.Utils.browser.isSafariBased()){document.body.classList.remove("bx-livechat-mobile-safari-based")}if(this.viewPortMetaWidgetNode){document.head.removeChild(this.viewPortMetaWidgetNode);this.viewPortMetaWidgetNode=null}if(this.viewPortMetaSiteNode){document.head.appendChild(this.viewPortMetaSiteNode);this.viewPortMetaSiteNode=null}}},onAfterClose:function t(){this.$root.$bitrixController.close()},onRequestShowForm:function t(e){var i=this;clearTimeout(this.showFormTimeout);if(e.type==r.welcome){if(e.delayed){this.showFormTimeout=setTimeout(function(){i.showWelcomeForm()},5e3)}else{this.showWelcomeForm()}}else if(e.type==r.offline){if(e.delayed){this.showFormTimeout=setTimeout(function(){i.showOfflineForm()},3e3)}else{this.showOfflineForm()}}else if(e.type==r.like){if(e.delayed){this.showFormTimeout=setTimeout(function(){i.showLikeForm()},5e3)}else{this.showLikeForm()}}},onDialogRequestHistory:function t(e){this.$root.$bitrixController.getDialogHistory(e.lastId)},onDialogRequestUnread:function t(e){this.$root.$bitrixController.getDialogUnread(e.lastId)},onDialogMessageClickByUserName:function t(e){this.$root.$emit("onMessengerTextareaInsertText",{text:e.user.name+" "})},onDialogMessageClickByCommand:function t(e){if(e.type==="put"){this.$root.$emit("onMessengerTextareaInsertText",{text:e.value+" "})}else if(e.type==="send"){this.$root.$bitrixController.addMessage(e.value)}else{BX.Messenger.Logger.warn("Unprocessed command",e)}},onDialogMessageMenuClick:function t(e){BX.Messenger.Logger.warn("Message menu:",e)},onDialogMessageRetryClick:function t(e){BX.Messenger.Logger.warn("Message retry:",e);this.$root.$bitrixController.retrySendMessage(e.message)},onDialogReadMessage:function t(e){this.$root.$bitrixController.readMessage(e.id)},onDialogClick:function t(e){this.$store.commit(h.widgetData,{showForm:r.none})},onTextareaSend:function t(e){e.focus=e.focus!==false;if(this.widgetData.showForm==r.smile){this.$store.commit(h.widgetData,{showForm:r.none})}if(!this.dialogData.userConsent&&this.widgetData.consentUrl){if(e.text){this.storedMessage=e.text}this.showConsentWidow();return false}e.text=e.text?e.text:this.storedMessage;if(!e.text){return false}this.hideForm();this.$root.$bitrixController.addMessage(e.text);if(e.focus){this.$root.$emit("onMessengerTextareaFocus")}return true},onTextareaWrites:function t(e){this.$root.$bitrixController.writesMessage()},onTextareaFocus:function t(e){var i=this;if(this.widgetData.copyright&&this.widgetData.deviceType==a.mobile){this.widgetData.copyright=false}if(BX.Messenger.Utils.device.isMobile()){clearTimeout(this.onTextareaFocusScrollTimeout);this.onTextareaFocusScrollTimeout=setTimeout(function(){document.addEventListener("scroll",i.onWindowScroll)},1e3)}this.textareaFocused=true},onTextareaBlur:function t(e){var i=this;if(!this.widgetData.copyright&&this.widgetData.copyright!==this.$root.$bitrixController.copyright){this.widgetData.copyright=this.$root.$bitrixController.copyright;this.$nextTick(function(){i.$root.$emit("onMessengerDialogScrollToBottom",{force:true})})}if(BX.Messenger.Utils.device.isMobile()){clearTimeout(this.onTextareaFocusScrollTimeout);document.removeEventListener("scroll",this.onWindowScroll)}this.textareaFocused=false},onTextareaStartDrag:function t(e){if(this.textareaDrag){return}BX.Messenger.Logger.log("Livechat: textarea drag started");this.textareaDrag=true;e=e.changedTouches?e.changedTouches[0]:e;this.textareaDragCursorStartPoint=e.clientY;this.textareaDragHeightStartPoint=this.textareaHeight;this.onTextareaDragEventAdd();this.$root.$emit("onMessengerTextareaBlur",true)},onTextareaContinueDrag:function t(e){if(!this.textareaDrag){return}e=e.changedTouches?e.changedTouches[0]:e;this.textareaDragCursorControlPoint=e.clientY;var i=Math.max(Math.min(this.textareaDragHeightStartPoint+this.textareaDragCursorStartPoint-this.textareaDragCursorControlPoint,this.textareaMaximumHeight),this.textareaMinimumHeight);BX.Messenger.Logger.log("Livechat: textarea drag","new: "+i,"curr: "+this.textareaHeight);if(this.textareaHeight!=i){this.textareaHeight=i}},onTextareaStopDrag:function t(){if(!this.textareaDrag){return}BX.Messenger.Logger.log("Livechat: textarea drag ended");this.textareaDrag=false;this.onTextareaDragEventRemove();this.$store.commit(h.widgetData,{textareaHeight:this.textareaHeight});this.$root.$emit("onMessengerDialogScrollToBottom",{force:true})},onTextareaDragEventAdd:function t(){document.addEventListener("mousemove",this.onTextareaContinueDrag);document.addEventListener("touchmove",this.onTextareaContinueDrag);document.addEventListener("touchend",this.onTextareaStopDrag);document.addEventListener("mouseup",this.onTextareaStopDrag);document.addEventListener("mouseleave",this.onTextareaStopDrag)},onTextareaDragEventRemove:function t(){document.removeEventListener("mousemove",this.onTextareaContinueDrag);document.removeEventListener("touchmove",this.onTextareaContinueDrag);document.removeEventListener("touchend",this.onTextareaStopDrag);document.removeEventListener("mouseup",this.onTextareaStopDrag);document.removeEventListener("mouseleave",this.onTextareaStopDrag)},onTextareaFileSelected:function t(e){var i=e&&e.fileInput?e.fileInput:this.storedFile;if(!i){return false}if(i.files[0].size>this.widgetData.disk.maxFileSize){alert(this.localize.BX_LIVECHAT_FILE_SIZE_EXCEEDED.replace("#LIMIT#",Math.round(this.widgetData.disk.maxFileSize/1024/1024)));return false}if(!this.dialogData.userConsent&&this.widgetData.consentUrl){this.storedFile=e.fileInput;this.showConsentWidow();return false}this.$root.$bitrixController.addFile(i)},onTextareaAppButtonClick:function t(e){if(e.appId==r.smile){if(this.widgetData.showForm==r.smile){this.$store.commit(h.widgetData,{showForm:r.none})}else{this.$store.commit(h.widgetData,{showForm:r.smile})}}else{this.$root.$emit("onMessengerTextareaFocus")}},onPullRequestConfig:function t(e){this.$root.$bitrixController.recoverPullConnection()},onSmilesSelectSmile:function t(e){this.$root.$emit("onMessengerTextareaInsertText",{text:e.text})},onSmilesSelectSet:function t(){this.$root.$emit("onMessengerTextareaFocus")},onWindowKeyDown:function t(e){if(e.keyCode==27){if(this.widgetData.showForm!=r.none){this.$store.commit(h.widgetData,{showForm:r.none})}else if(this.widgetData.showConsent){this.disagreeConsentWidow()}else{this.close()}e.preventDefault();e.stopPropagation();this.$root.$emit("onMessengerTextareaFocus")}},onWindowScroll:function t(e){var i=this;clearTimeout(this.onWindowScrollTimeout);this.onWindowScrollTimeout=setTimeout(function(){i.$root.$emit("onMessengerTextareaBlur",true)},50)}},template:'\n\t\t<transition enter-active-class="bx-livechat-show" leave-active-class="bx-livechat-close" @after-leave="onAfterClose">\n\t\t\t<div :class="widgetClassName" v-if="widgetData.showed">\n\t\t\t\t<div class="bx-livechat-box">\n\t\t\t\t\t<bx-livechat-head :isWidgetDisabled="widgetMobileDisabled" @like="showLikeForm" @history="showHistoryForm" @close="close"/>\n\t\t\t\t\t<template v-if="widgetMobileDisabled">\n\t\t\t\t\t\t<bx-livechat-body-orientation-disabled/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if="widgetData.error.active">\n\t\t\t\t\t\t<bx-livechat-body-error/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if="!widgetData.configId">\n\t\t\t\t\t\t<div class="bx-livechat-body" key="loading-body">\n\t\t\t\t\t\t\t<bx-livechat-body-loading/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\t\t\t\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<template v-if="!widgetData.dialogStart">\n\t\t\t\t\t\t\t<div class="bx-livechat-body" key="welcome-body">\n\t\t\t\t\t\t\t\t<bx-livechat-body-operators/>\n\t\t\t\t\t\t\t\t<keep-alive include="bx-livechat-smiles">\n\t\t\t\t\t\t\t\t\t<template v-if="widgetData.showForm == FormType.smile">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-smiles @selectSmile="onSmilesSelectSmile" @selectSet="onSmilesSelectSet"/>\t\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</keep-alive>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else-if="widgetData.dialogStart">\n\t\t\t\t\t\t\t<bx-pull-status :canReconnect="true" @reconnect="onPullRequestConfig"/>\n\t\t\t\t\t\t\t<div :class="[\'bx-livechat-body\', {\'bx-livechat-body-with-message\': showMessageDialog}]" key="with-message">\n\t\t\t\t\t\t\t\t<transition name="bx-livechat-animation-upload-file">\n\t\t\t\t\t\t\t\t\t<template v-if="widgetData.uploadFile">\n\t\t\t\t\t\t\t\t\t\t<div class="bx-livechat-file-upload">\t\n\t\t\t\t\t\t\t\t\t\t\t<div class="bx-livechat-file-upload-sending"></div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="bx-livechat-file-upload-text">{{localize.BX_LIVECHAT_FILE_UPLOAD}}</div>\n\t\t\t\t\t\t\t\t\t\t</div>\t\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</transition>\t\n\t\t\t\t\t\t\t\t<template v-if="showMessageDialog">\n\t\t\t\t\t\t\t\t\t<div class="bx-livechat-dialog">\n\t\t\t\t\t\t\t\t\t\t<bx-messenger-dialog\n\t\t\t\t\t\t\t\t\t\t\t:userId="userData.id" \n\t\t\t\t\t\t\t\t\t\t\t:dialogId="dialogData.dialogId"\n\t\t\t\t\t\t\t\t\t\t\t:chatId="dialogData.chatId"\n\t\t\t\t\t\t\t\t\t\t\t:messageLimit="dialogData.messageLimit"\n\t\t\t\t\t\t\t\t\t\t\t:enableEmotions="false"\n\t\t\t\t\t\t\t\t\t\t\t:enableDateActions="false"\n\t\t\t\t\t\t\t\t\t\t\t:enableCreateContent="false"\n\t\t\t\t\t\t\t\t\t\t\t:showMessageAvatar="false"\n\t\t\t\t\t\t\t\t\t\t\t:showMessageMenu="false"\n\t\t\t\t\t\t\t\t\t\t\tlistenEventScrollToBottom="onMessengerDialogScrollToBottom"\n\t\t\t\t\t\t\t\t\t\t\tlistenEventRequestHistory="onDialogRequestHistoryResult"\n\t\t\t\t\t\t\t\t\t\t\tlistenEventRequestUnread="onDialogRequestUnreadResult"\n\t\t\t\t\t\t\t\t\t\t\t@readMessage="onDialogReadMessage"\n\t\t\t\t\t\t\t\t\t\t\t@requestHistory="onDialogRequestHistory"\n\t\t\t\t\t\t\t\t\t\t\t@requestUnread="onDialogRequestUnread"\n\t\t\t\t\t\t\t\t\t\t\t@clickByCommand="onDialogMessageClickByCommand"\n\t\t\t\t\t\t\t\t\t\t\t@clickByUserName="onDialogMessageClickByUserName"\n\t\t\t\t\t\t\t\t\t\t\t@clickByMessageMenu="onDialogMessageMenuClick"\n\t\t\t\t\t\t\t\t\t\t\t@clickByMessageRetry="onDialogMessageRetryClick"\n\t\t\t\t\t\t\t\t\t\t\t@click="onDialogClick"\n\t\t\t\t\t\t\t\t\t\t />\n\t\t\t\t\t\t\t\t\t</div>\t \n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t<bx-livechat-body-loading/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<keep-alive include="bx-livechat-smiles">\n\t\t\t\t\t\t\t\t\t<template v-if="widgetData.showForm == FormType.like && widgetData.vote.enable">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-vote/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widgetData.showForm == FormType.welcome">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-welcome/>\t\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widgetData.showForm == FormType.offline">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-offline/>\t\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widgetData.showForm == FormType.history">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-form-history/>\t\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else-if="widgetData.showForm == FormType.smile">\n\t\t\t\t\t\t\t\t\t\t<bx-livechat-smiles @selectSmile="onSmilesSelectSmile" @selectSet="onSmilesSelectSet"/>\t\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</keep-alive>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\t\n\t\t\t\t\t\t<div class="bx-livechat-textarea" :style="textareaHeightStyle" ref="textarea">\n\t\t\t\t\t\t\t<div class="bx-livechat-textarea-resize-handle" @mousedown="onTextareaStartDrag" @touchstart="onTextareaStartDrag"></div>\n\t\t\t\t\t\t\t<bx-messenger-textarea\n\t\t\t\t\t\t\t\t:siteId="widgetData.siteId"\n\t\t\t\t\t\t\t\t:userId="userData.id"\n\t\t\t\t\t\t\t\t:dialogId="dialogData.dialogId"\n\t\t\t\t\t\t\t\t:writesEventLetter="3"\n\t\t\t\t\t\t\t\t:enableEdit="true"\n\t\t\t\t\t\t\t\t:enableCommand="false"\n\t\t\t\t\t\t\t\t:enableMention="false"\n\t\t\t\t\t\t\t\t:enableFile="widgetData.disk.enabled"\n\t\t\t\t\t\t\t\t:autoFocus="widgetData.deviceType !== DeviceType.mobile"\n\t\t\t\t\t\t\t\t:isMobile="widgetData.deviceType === DeviceType.mobile"\n\t\t\t\t\t\t\t\t:styles="{button: {backgroundColor: widgetData.styles.backgroundColor, iconColor: widgetData.styles.iconColor}}"\n\t\t\t\t\t\t\t\tlistenEventInsertText="onMessengerTextareaInsertText"\n\t\t\t\t\t\t\t\tlistenEventFocus="onMessengerTextareaFocus"\n\t\t\t\t\t\t\t\tlistenEventBlur="onMessengerTextareaBlur"\n\t\t\t\t\t\t\t\t@writes="onTextareaWrites" \n\t\t\t\t\t\t\t\t@send="onTextareaSend" \n\t\t\t\t\t\t\t\t@focus="onTextareaFocus" \n\t\t\t\t\t\t\t\t@blur="onTextareaBlur" \n\t\t\t\t\t\t\t\t@edit="logEvent(\'edit message\', $event)"\n\t\t\t\t\t\t\t\t@fileSelected="onTextareaFileSelected"\n\t\t\t\t\t\t\t\t@appButtonClick="onTextareaAppButtonClick"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<bx-livechat-form-consent @agree="agreeConsentWidow" @disagree="disagreeConsentWidow"/>\n\t\t\t\t\t\t<template v-if="widgetData.copyright">\n\t\t\t\t\t\t\t<bx-livechat-footer/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t'});BX.Vue.component("bx-livechat-head",{props:{isWidgetDisabled:{default:false}},methods:{close:function t(e){this.$emit("close")},like:function t(e){this.$emit("like")},history:function t(e){this.$emit("history")}},computed:babelHelpers.objectSpread({VoteType:function t(){return i},customBackgroundStyle:function t(e){return e.widgetData.styles.backgroundColor?"background-color: "+e.widgetData.styles.backgroundColor+"!important;":""},customBackgroundOnlineStyle:function t(e){return e.widgetData.styles.backgroundColor?"border-color: "+e.widgetData.styles.backgroundColor+"!important;":""},showName:function t(){return this.dialogData.operator.firstName||this.dialogData.operator.lastName},localize:function t(){return BX.Vue.getFilteredPhrases("BX_LIVECHAT_",this.$root.$bitrixMessages)}},BX.Vuex.mapState({widgetData:function t(e){return e.widget.widgetData},dialogData:function t(e){return e.widget.dialogData}})),watch:{showName:function t(e){var i=this;if(e){setTimeout(function(){i.$root.$emit("onMessengerDialogScrollToBottom")},300)}}},template:'\n\t\t<div class="bx-livechat-head-wrap">\n\t\t\t<template v-if="isWidgetDisabled">\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<div class="bx-livechat-title">{{widgetData.configName || localize.BX_LIVECHAT_TITLE}}</div>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<button v-if="!widgetData.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\t\n\t\t\t</template>\n\t\t\t<template v-else-if="widgetData.error.active">\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<div class="bx-livechat-title">{{widgetData.configName || localize.BX_LIVECHAT_TITLE}}</div>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<button v-if="!widgetData.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else-if="!widgetData.configId">\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<div class="bx-livechat-title">{{widgetData.configName || localize.BX_LIVECHAT_TITLE}}</div>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<button v-if="!widgetData.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\t\t\t\n\t\t\t<template v-else>\n\t\t\t\t<div class="bx-livechat-head" :style="customBackgroundStyle">\n\t\t\t\t\t<template v-if="!showName">\n\t\t\t\t\t\t<div class="bx-livechat-title">{{widgetData.configName || localize.BX_LIVECHAT_TITLE}}</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<div class="bx-livechat-user bx-livechat-status-online">\n\t\t\t\t\t\t\t<template v-if="dialogData.operator.avatar">\n\t\t\t\t\t\t\t\t<div class="bx-livechat-user-icon" :style="\'background-image: url(\'+encodeURI(dialogData.operator.avatar)+\')\'">\n\t\t\t\t\t\t\t\t\t<div v-if="dialogData.operator.online" class="bx-livechat-user-status" :style="customBackgroundOnlineStyle"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class="bx-livechat-user-icon">\n\t\t\t\t\t\t\t\t\t<div v-if="dialogData.operator.online" class="bx-livechat-user-status" :style="customBackgroundOnlineStyle"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-livechat-user-info">\n\t\t\t\t\t\t\t<div class="bx-livechat-user-name">{{dialogData.operator.firstName? dialogData.operator.firstName: dialogData.operator.name}}</div>\n\t\t\t\t\t\t\t<div class="bx-livechat-user-position">{{dialogData.operator.workPosition? dialogData.operator.workPosition: localize.BX_LIVECHAT_USER}}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<div class="bx-livechat-control-box">\n\t\t\t\t\t\t<span class="bx-livechat-control-box-active" v-if="widgetData.dialogStart && dialogData.sessionId">\n\t\t\t\t\t\t\t<button v-if="widgetData.vote.enable && (!dialogData.sessionClose || dialogData.sessionClose && dialogData.userVote == VoteType.none)" :class="\'bx-livechat-control-btn bx-livechat-control-btn-like bx-livechat-dialog-vote-\'+(dialogData.userVote)" :title="localize.BX_LIVECHAT_VOTE_BUTTON" @click="like"></button>\n\t\t\t\t\t\t\t<button v-if="widgetData.vote.enable && dialogData.sessionClose && dialogData.userVote != VoteType.none" :class="\'bx-livechat-control-btn bx-livechat-control-btn-disabled bx-livechat-control-btn-like bx-livechat-dialog-vote-\'+(dialogData.userVote)"></button>\n\t\t\t\t\t\t\t<button class="bx-livechat-control-btn bx-livechat-control-btn-mail" :title="localize.BX_LIVECHAT_MAIL_BUTTON_NEW" @click="history"></button>\n\t\t\t\t\t\t</span>\t\n\t\t\t\t\t\t<button v-if="!widgetData.pageMode" class="bx-livechat-control-btn bx-livechat-control-btn-close" :title="localize.BX_LIVECHAT_CLOSE_BUTTON" @click="close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t'});BX.Vue.component("bx-livechat-body-orientation-disabled",{computed:{localize:function t(){return Object.freeze({BX_LIVECHAT_MOBILE_ROTATE:this.$root.$bitrixMessages.BX_LIVECHAT_MOBILE_ROTATE})}},template:'\n\t\t<div class="bx-livechat-body" key="orientation-head">\n\t\t\t<div class="bx-livechat-mobile-orientation-box">\n\t\t\t\t<div class="bx-livechat-mobile-orientation-icon"></div>\n\t\t\t\t<div class="bx-livechat-mobile-orientation-text">{{localize.BX_LIVECHAT_MOBILE_ROTATE}}</div>\n\t\t\t</div>\n\t\t</div>\n\t'});BX.Vue.component("bx-livechat-body-loading",{computed:{localize:function t(){return Object.freeze({BX_LIVECHAT_LOADING:this.$root.$bitrixMessages.BX_LIVECHAT_LOADING})}},template:'\n\t\t<div class="bx-livechat-loading-window">\n\t\t\t<svg class="bx-livechat-loading-circular" viewBox="25 25 50 50">\n\t\t\t\t<circle class="bx-livechat-loading-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>\n\t\t\t\t<circle class="bx-livechat-loading-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>\n\t\t\t</svg>\n\t\t\t<h3 class="bx-livechat-help-title bx-livechat-help-title-md bx-livechat-loading-msg">{{localize.BX_LIVECHAT_LOADING}}</h3>\n\t\t</div>\n\t'});BX.Vue.component("bx-livechat-body-operators",{computed:babelHelpers.objectSpread({localize:function t(){return BX.Vue.getFilteredPhrases("BX_LIVECHAT_",this.$root.$bitrixMessages)}},BX.Vuex.mapState({widgetData:function t(e){return e.widget.widgetData}})),template:'\n\t\t<div class="bx-livechat-help-container">\n\t\t\t<transition name="bx-livechat-animation-fade">\n\t\t\t\t<h2 v-if="widgetData.online" key="online" class="bx-livechat-help-title bx-livechat-help-title-lg">{{localize.BX_LIVECHAT_ONLINE_LINE_1}}<div class="bx-livechat-help-subtitle">{{localize.BX_LIVECHAT_ONLINE_LINE_2}}</div></h2>\n\t\t\t\t<h2 v-else key="offline" class="bx-livechat-help-title bx-livechat-help-title-sm">{{localize.BX_LIVECHAT_OFFLINE}}</h2>\n\t\t\t</transition>\t\n\t\t\t<div class="bx-livechat-help-user">\n\t\t\t\t<template v-for="operator in widgetData.operators">\n\t\t\t\t\t<div class="bx-livechat-user" :key="operator.id">\n\t\t\t\t\t\t<template v-if="operator.avatar">\n\t\t\t\t\t\t\t<div class="bx-livechat-user-icon" :style="\'background-image: url(\'+encodeURI(operator.avatar)+\')\'"></div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class="bx-livechat-user-icon"></div>\n\t\t\t\t\t\t</template>\t\n\t\t\t\t\t\t<div class="bx-livechat-user-info">\n\t\t\t\t\t\t\t<div class="bx-livechat-user-name">{{operator.firstName? operator.firstName: operator.name}}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\t\n\t\t\t</div>\n\t\t</div>\n\t'});BX.Vue.component("bx-livechat-body-error",{computed:babelHelpers.objectSpread({localize:function t(){return Object.freeze({BX_LIVECHAT_ERROR_TITLE:this.$root.$bitrixMessages.BX_LIVECHAT_ERROR_TITLE,BX_LIVECHAT_ERROR_DESC:this.$root.$bitrixMessages.BX_LIVECHAT_ERROR_DESC})}},BX.Vuex.mapState({widgetData:function t(e){return e.widget.widgetData}})),template:'\n\t\t<div class="bx-livechat-body" key="error-body">\n\t\t\t<div class="bx-livechat-warning-window">\n\t\t\t\t<div class="bx-livechat-warning-icon"></div>\n\t\t\t\t<template v-if="widgetData.error.description"> \n\t\t\t\t\t<div class="bx-livechat-help-title bx-livechat-help-title-sm bx-livechat-warning-msg" v-html="widgetData.error.description"></div>\n\t\t\t\t</template> \n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class="bx-livechat-help-title bx-livechat-help-title-md bx-livechat-warning-msg">{{localize.BX_LIVECHAT_ERROR_TITLE}}</div>\n\t\t\t\t\t<div class="bx-livechat-help-title bx-livechat-help-title-sm bx-livechat-warning-msg">{{localize.BX_LIVECHAT_ERROR_DESC}}</div>\n\t\t\t\t</template> \n\t\t\t</div>\n\t\t</div>\n\t'});BX.Vue.cloneComponent("bx-livechat-smiles","bx-smiles",{methods:{hideForm:function t(e){this.$parent.hideForm()}},template:'\n\t\t<transition enter-active-class="bx-livechat-consent-window-show" leave-active-class="bx-livechat-form-close">\n\t\t\t<div class="bx-livechat-alert-box bx-livechat-alert-box-zero-padding bx-livechat-form-show" key="vote">\n\t\t\t\t<div class="bx-livechat-alert-close" @click="hideForm"></div>\n\t\t\t\t<div class="bx-livechat-alert-smiles-box">\n\t\t\t\t\t#PARENT_TEMPLATE#\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t'});BX.Vue.component("bx-livechat-form-welcome",{data:function t(){return{fieldName:"",fieldEmail:"",fieldPhone:"",isFullForm:BX.Messenger.Utils.platform.isMobile()}},watch:{fieldName:function t(){clearTimeout(this.showFormTimeout);this.showFormTimeout=setTimeout(this.showFullForm,1e3);clearTimeout(this.fieldNameTimeout);this.fieldNameTimeout=setTimeout(this.checkNameField,300)},fieldEmail:function t(e){clearTimeout(this.fieldEmailTimeout);this.fieldEmailTimeout=setTimeout(this.checkEmailField,300)},fieldPhone:function t(e){clearTimeout(this.fieldPhoneTimeout);this.fieldPhoneTimeout=setTimeout(this.checkPhoneField,300)}},computed:babelHelpers.objectSpread({localize:function t(){return BX.Vue.getFilteredPhrases("BX_LIVECHAT_",this.$root.$bitrixMessages)}},BX.Vuex.mapState({userData:function t(e){return e.widget.userData}})),created:function t(){this.fieldName=""+this.userData.name;this.fieldEmail=""+this.userData.email;this.fieldPhone=""+this.userData.phone},methods:{formShowed:function t(){if(!BX.Messenger.Utils.platform.isMobile()){this.$refs.nameInput.focus()}},showFullForm:function t(){clearTimeout(this.showFormTimeout);this.isFullForm=true},sendForm:function t(){var e=this.fieldName;var i=this.checkEmailField()?this.fieldEmail:"";var s=this.checkPhoneField()?this.fieldPhone:"";if(e||i||s){this.$root.$bitrixController.sendForm(r.welcome,{name:e,email:i,phone:s})}this.hideForm()},hideForm:function t(e){clearTimeout(this.showFormTimeout);clearTimeout(this.fieldNameTimeout);clearTimeout(this.fieldEmailTimeout);clearTimeout(this.fieldPhoneTimeout);this.$parent.hideForm()},onFieldEnterPress:function t(e){if(e.target===this.$refs.nameInput){this.showFullForm();this.$refs.emailInput.focus()}else if(e.target===this.$refs.emailInput){this.$refs.phoneInput.focus()}else{this.sendForm()}e.preventDefault()},checkNameField:function t(){if(this.fieldName.length>0){if(this.$refs.name){this.$refs.name.classList.remove("ui-ctl-danger")}return true}else{if(document.activeElement!==this.$refs.nameInput){if(this.$refs.name){this.$refs.name.classList.add("ui-ctl-danger")}}return false}},checkEmailField:function t(){if(this.fieldEmail.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){if(this.$refs.email){this.$refs.email.classList.remove("ui-ctl-danger")}return true}else{if(document.activeElement!==this.$refs.emailInput){if(this.$refs.email){this.$refs.email.classList.add("ui-ctl-danger")}}return false}},checkPhoneField:function t(){if(this.fieldPhone.match(/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){10,14}(\s*)?$/)){if(this.$refs.phone){this.$refs.phone.classList.remove("ui-ctl-danger")}return true}else{if(document.activeElement!==this.$refs.phoneInput){if(this.$refs.phone){this.$refs.phone.classList.add("ui-ctl-danger")}}return false}}},template:'\n\t\t<transition enter-active-class="bx-livechat-consent-window-show" leave-active-class="bx-livechat-form-close" @after-enter="formShowed">\n\t\t\t<div class="bx-livechat-alert-box bx-livechat-form-show" key="welcome">\t\n\t\t\t\t<div class="bx-livechat-alert-close" @click="hideForm"></div>\n\t\t\t\t<div class="bx-livechat-alert-form-box">\n\t\t\t\t\t<h4 class="bx-livechat-alert-title bx-livechat-alert-title-sm">{{localize.BX_LIVECHAT_ABOUT_TITLE}}</h4>\n\t\t\t\t\t<div class="bx-livechat-form-item ui-ctl ui-ctl-w100 ui-ctl-lg" ref="name">\n\t\t\t\t\t   <input type="text" class="ui-ctl-element ui-ctl-textbox" :placeholder="localize.BX_LIVECHAT_FIELD_NAME" v-model="fieldName" ref="nameInput" @blur="checkNameField" @keydown.enter="onFieldEnterPress"  @keydown.tab="onFieldEnterPress">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div :class="[\'bx-livechat-form-short\', {\n\t\t\t\t\t\t\'bx-livechat-form-full\': isFullForm,\n\t\t\t\t\t}]">\n\t\t\t\t\t\t<div class="bx-livechat-form-item ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-lg" ref="email">\n\t\t\t\t\t\t   <div class="ui-ctl-after ui-ctl-icon-mail bx-livechat-form-icon" :title="localize.BX_LIVECHAT_FIELD_MAIL_TOOLTIP"></div>\n\t\t\t\t\t\t   <input type="text" class="ui-ctl-element ui-ctl-textbox" :placeholder="localize.BX_LIVECHAT_FIELD_MAIL" v-model="fieldEmail" ref="emailInput" @blur="checkEmailField" @keydown.enter="onFieldEnterPress">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-livechat-form-item ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-lg" ref="phone">\n\t\t\t\t\t\t   <div class="ui-ctl-after ui-ctl-icon-phone bx-livechat-form-icon" :title="localize.BX_LIVECHAT_FIELD_PHONE_TOOLTIP"></div>\n\t\t\t\t\t\t   <input type="text" class="ui-ctl-element ui-ctl-textbox" :placeholder="localize.BX_LIVECHAT_FIELD_PHONE" v-model="fieldPhone" ref="phoneInput" @blur="checkPhoneField" @keydown.enter="onFieldEnterPress">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-livechat-btn-box">\n\t\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-success" @click="sendForm">{{localize.BX_LIVECHAT_ABOUT_SEND}}</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\t\n\t\t</transition>\t\n\t'});BX.Vue.cloneComponent("bx-livechat-form-offline","bx-livechat-form-welcome",{methods:{formShowed:function t(){if(!BX.Messenger.Utils.platform.isMobile()){this.$refs.emailInput.focus()}},sendForm:function t(){var e=this.fieldName;var i=this.checkEmailField()?this.fieldEmail:"";var s=this.checkPhoneField()?this.fieldPhone:"";if(e||i||s){this.$root.$bitrixController.sendForm(r.offline,{name:e,email:i,phone:s})}this.hideForm()},onFieldEnterPress:function t(e){if(e.target===this.$refs.emailInput){this.showFullForm();this.$refs.phoneInput.focus()}else if(e.target===this.$refs.phoneInput){this.$refs.nameInput.focus()}else{this.sendForm()}e.preventDefault()}},watch:{fieldName:function t(){clearTimeout(this.fieldNameTimeout);this.fieldNameTimeout=setTimeout(this.checkNameField,300)},fieldEmail:function t(){clearTimeout(this.showFormTimeout);this.showFormTimeout=setTimeout(this.showFullForm,1e3);clearTimeout(this.fieldEmailTimeout);this.fieldEmailTimeout=setTimeout(this.checkEmailField,300)}},template:'\n\t\t<transition enter-active-class="bx-livechat-consent-window-show" leave-active-class="bx-livechat-form-close" @after-enter="formShowed">\n\t\t\t<div class="bx-livechat-alert-box bx-livechat-form-show" key="welcome">\t\n\t\t\t\t<div class="bx-livechat-alert-close" @click="hideForm"></div>\n\t\t\t\t<div class="bx-livechat-alert-form-box">\n\t\t\t\t\t<h4 class="bx-livechat-alert-title bx-livechat-alert-title-sm">{{localize.BX_LIVECHAT_OFFLINE_TITLE}}</h4>\n\t\t\t\t\t<div class="bx-livechat-form-item ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-lg" ref="email">\n\t\t\t\t\t   <div class="ui-ctl-after ui-ctl-icon-mail bx-livechat-form-icon" :title="localize.BX_LIVECHAT_FIELD_MAIL_TOOLTIP"></div>\n\t\t\t\t\t   <input type="text" class="ui-ctl-element ui-ctl-textbox" :placeholder="localize.BX_LIVECHAT_FIELD_MAIL" v-model="fieldEmail" ref="emailInput" @blur="checkEmailField" @keydown.enter="onFieldEnterPress">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div :class="[\'bx-livechat-form-short\', {\n\t\t\t\t\t\t\'bx-livechat-form-full\': isFullForm,\n\t\t\t\t\t}]">\n\t\t\t\t\t\t<div class="bx-livechat-form-item ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-lg" ref="phone">\n\t\t\t\t\t\t   <div class="ui-ctl-after ui-ctl-icon-phone bx-livechat-form-icon" :title="localize.BX_LIVECHAT_FIELD_PHONE_TOOLTIP"></div>\n\t\t\t\t\t\t   <input type="text" class="ui-ctl-element ui-ctl-textbox" :placeholder="localize.BX_LIVECHAT_FIELD_PHONE" v-model="fieldPhone" ref="phoneInput" @blur="checkPhoneField" @keydown.enter="onFieldEnterPress">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-livechat-form-item ui-ctl ui-ctl-w100 ui-ctl-lg" ref="name">\n\t\t\t\t\t\t   <input type="text" class="ui-ctl-element ui-ctl-textbox" :placeholder="localize.BX_LIVECHAT_FIELD_NAME" v-model="fieldName" ref="nameInput" @blur="checkNameField" @keydown.enter="onFieldEnterPress"  @keydown.tab="onFieldEnterPress">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-livechat-btn-box">\n\t\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-success" @click="sendForm">{{localize.BX_LIVECHAT_ABOUT_SEND}}</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\t\n\t\t</transition>\t\n\t'});BX.Vue.component("bx-livechat-form-history",{data:function t(){return{fieldEmail:""}},watch:{fieldEmail:function t(e){clearTimeout(this.fieldEmailTimeout);this.fieldEmailTimeout=setTimeout(this.checkEmailField,300)}},computed:babelHelpers.objectSpread({localize:function t(){return BX.Vue.getFilteredPhrases("BX_LIVECHAT_",this.$root.$bitrixMessages)}},BX.Vuex.mapState({userData:function t(e){return e.widget.userData}})),created:function t(){this.fieldEmail=""+this.userData.email},methods:{formShowed:function t(){if(!BX.Messenger.Utils.platform.isMobile()){this.$refs.emailInput.focus()}},sendForm:function t(){var e=this.checkEmailField()?this.fieldEmail:"";if(e){this.$root.$bitrixController.sendForm(r.history,{email:e})}this.hideForm()},hideForm:function t(e){clearTimeout(this.fieldEmailTimeout);this.$parent.hideForm()},onFieldEnterPress:function t(e){this.sendForm();e.preventDefault()},checkEmailField:function t(){if(this.fieldEmail.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){if(this.$refs.email){this.$refs.email.classList.remove("ui-ctl-danger")}return true}else{if(document.activeElement!==this.$refs.emailInput){if(this.$refs.email){this.$refs.email.classList.add("ui-ctl-danger")}}return false}}},template:'\n\t\t<transition enter-active-class="bx-livechat-consent-window-show" leave-active-class="bx-livechat-form-close" @after-enter="formShowed">\n\t\t\t<div class="bx-livechat-alert-box bx-livechat-form-show" key="welcome">\t\n\t\t\t\t<div class="bx-livechat-alert-close" @click="hideForm"></div>\n\t\t\t\t<div class="bx-livechat-alert-form-box">\n\t\t\t\t\t<h4 class="bx-livechat-alert-title bx-livechat-alert-title-sm">{{localize.BX_LIVECHAT_MAIL_TITLE_NEW}}</h4>\n\t\t\t\t\t<div class="bx-livechat-form-item ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-lg" ref="email">\n\t\t\t\t\t   <div class="ui-ctl-after ui-ctl-icon-mail bx-livechat-form-icon" :title="localize.BX_LIVECHAT_FIELD_MAIL_TOOLTIP"></div>\n\t\t\t\t\t   <input type="text" class="ui-ctl-element ui-ctl-textbox" :placeholder="localize.BX_LIVECHAT_FIELD_MAIL" v-model="fieldEmail" ref="emailInput" @blur="checkEmailField" @keydown.enter="onFieldEnterPress">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bx-livechat-btn-box">\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-success" @click="sendForm">{{localize.BX_LIVECHAT_MAIL_BUTTON_NEW}}</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\t\n\t\t</transition>\t\n\t'});BX.Vue.component("bx-livechat-form-vote",{computed:babelHelpers.objectSpread({VoteType:function t(){return i},localize:function t(){return BX.Vue.getFilteredPhrases("BX_LIVECHAT_",this.$root.$bitrixMessages)}},BX.Vuex.mapState({widgetData:function t(e){return e.widget.widgetData}})),methods:{userVote:function t(e){this.$store.commit(h.widgetData,{showForm:r.none});this.$store.commit(h.dialogData,{userVote:e});this.$root.$bitrixController.sendDialogVote(e)},hideForm:function t(e){this.$parent.hideForm()}},template:'\n\t\t<transition enter-active-class="bx-livechat-consent-window-show" leave-active-class="bx-livechat-form-close">\n\t\t\t<div class="bx-livechat-alert-box bx-livechat-form-rate-show" key="vote">\n\t\t\t\t<div class="bx-livechat-alert-close" @click="hideForm"></div>\n\t\t\t\t<div class="bx-livechat-alert-rate-box">\n\t\t\t\t\t<h4 class="bx-livechat-alert-title bx-livechat-alert-title-mdl">{{widgetData.vote.messageText}}</h4>\n\t\t\t\t\t<div class="bx-livechat-btn-box">\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-like" @click="userVote(VoteType.like)" :title="widgetData.vote.messageLike"></button>\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-dislike" @click="userVote(VoteType.dislike)" :title="widgetData.vote.messageDislike"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\t\n\t'});BX.Vue.component("bx-livechat-form-consent",{computed:babelHelpers.objectSpread({localize:function t(){return BX.Vue.getFilteredPhrases("BX_LIVECHAT_",this.$root.$bitrixMessages)}},BX.Vuex.mapState({widgetData:function t(e){return e.widget.widgetData}})),methods:{agree:function t(e){this.$emit("agree",{event:e})},disagree:function t(e){this.$emit("disagree",{event:e})},onShow:function t(e,i){e.classList.add("bx-livechat-consent-window-show");i()},onHide:function t(e,i){e.classList.remove("bx-livechat-consent-window-show");e.classList.add("bx-livechat-consent-window-close");setTimeout(function(){i()},400)},onKeyDown:function t(e){if(e.keyCode==9){if(e.target===this.$refs.iframe){if(e.shiftKey){this.$refs.cancel.focus()}else{this.$refs.success.focus()}}else if(e.target===this.$refs.success){if(e.shiftKey){this.$refs.iframe.focus()}else{this.$refs.cancel.focus()}}else if(e.target===this.$refs.cancel){if(e.shiftKey){this.$refs.success.focus()}else{this.$refs.iframe.focus()}}e.preventDefault()}else if(e.keyCode==39||e.keyCode==37){if(e.target.nextElementSibling){e.target.nextElementSibling.focus()}else if(e.target.previousElementSibling){e.target.previousElementSibling.focus()}e.preventDefault()}}},directives:{focus:{inserted:function t(e,i){e.focus()}}},template:'\n\t\t<transition @enter="onShow" @leave="onHide">\n\t\t\t<template v-if="widgetData.showConsent && widgetData.consentUrl">\n\t\t\t\t<div class="bx-livechat-consent-window">\n\t\t\t\t\t<div class="bx-livechat-consent-window-title">{{localize.BX_LIVECHAT_CONSENT_TITLE}}</div>\n\t\t\t\t\t<div class="bx-livechat-consent-window-content">\n\t\t\t\t\t\t<iframe class="bx-livechat-consent-window-content-iframe" ref="iframe" frameborder="0" marginheight="0"  marginwidth="0" allowtransparency="allow-same-origin" seamless="true" :src="widgetData.consentUrl" @keydown="onKeyDown"></iframe>\n\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\n\t\t\t\t\t<div class="bx-livechat-consent-window-btn-box">\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-success" ref="success" @click="agree" @keydown="onKeyDown" v-focus>{{localize.BX_LIVECHAT_CONSENT_AGREE}}</button>\n\t\t\t\t\t\t<button class="bx-livechat-btn bx-livechat-btn-cancel" ref="cancel" @click="disagree" @keydown="onKeyDown">{{localize.BX_LIVECHAT_CONSENT_DISAGREE}}</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</transition>\n\t'});BX.Vue.component("bx-livechat-footer",{computed:babelHelpers.objectSpread({localize:function t(){return BX.Vue.getFilteredPhrases("BX_LIVECHAT_COPYRIGHT_",this.$root.$bitrixMessages)}},BX.Vuex.mapState({widgetData:function t(e){return e.widget.widgetData}})),template:'\n\t\t<div class="bx-livechat-copyright">\t\n\t\t\t<template v-if="widgetData.copyrightUrl">\n\t\t\t\t<a :href="widgetData.copyrightUrl" target="_blank">\n\t\t\t\t\t<span class="bx-livechat-logo-name">{{localize.BX_LIVECHAT_COPYRIGHT_TEXT}}</span>\n\t\t\t\t\t<span class="bx-livechat-logo-icon"></span>\n\t\t\t\t</a>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<span class="bx-livechat-logo-name">{{localize.BX_LIVECHAT_COPYRIGHT_TEXT}}</span>\n\t\t\t\t<span class="bx-livechat-logo-icon"></span>\n\t\t\t</template>\n\t\t</div>\n\t'});if(!window.BX){window.BX={}}if(!window.BX.LiveChatWidget){BX.LiveChatWidget=y;BX.LiveChatWidget.VoteType=i;BX.LiveChatWidget.SubscriptionType=d;BX.LiveChatWidget.LocationStyle=l;BX.LiveChatWidget.WidgetStore=h}window.dispatchEvent(new CustomEvent("onBitrixLiveChatSourceLoaded",{detail:{}}))})(this.window=this.window||{});
//# sourceMappingURL=imopenlines.component.widget.bundle.map.js