{"version":3,"file":"message.bundle.js","sources":["../src/message.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Message Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport './message.css';\nimport 'im.component.message';\n\nconst FormType = Object.freeze({\n\tnone: 'none',\n\tlike: 'like',\n\twelcome: 'welcome',\n\toffline: 'offline',\n\thistory: 'history',\n});\n\nconst VoteType = Object.freeze({\n\tnone: 'none',\n\tlike: 'like',\n\tdislike: 'dislike',\n});\n\nBX.Vue.cloneComponent('bx-imopenlines-message', 'bx-messenger-message',\n{\n\tmethods:\n\t{\n\t\tcheckFormShow()\n\t\t{\n\t\t\tif (\n\t\t\t\t!this.message.params\n\t\t\t\t|| !this.message.params.IMOL_FORM\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.message.params.IMOL_FORM === 'welcome')\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\t!this.widget.dialog.sessionClose\n\t\t\t\t\t&& (\n\t\t\t\t\t\t!this.widget.user.name\n\t\t\t\t\t\t&& !this.widget.user.lastName\n\t\t\t\t\t\t&& !this.widget.user.email\n\t\t\t\t\t\t&& !this.widget.user.phone\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.$root.$emit('requestShowForm', {\n\t\t\t\t\t\ttype: FormType.welcome,\n\t\t\t\t\t\tdelayed: true\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.message.params.IMOL_FORM === 'offline')\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\t!this.widget.dialog.sessionClose\n\t\t\t\t\t&& (!this.widget.user.email)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.$root.$emit('requestShowForm', {\n\t\t\t\t\t\ttype: FormType.offline,\n\t\t\t\t\t\tdelayed: true\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.message.params.IMOL_FORM === 'history-delay')\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tparseInt(this.message.params.IMOL_VOTE) === this.widget.dialog.sessionId\n\t\t\t\t\t&& this.widget.dialog.userVote === VoteType.none\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.$root.$emit('requestShowForm', {\n\t\t\t\t\t\ttype: FormType.like,\n\t\t\t\t\t\tdelayed: true\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.checkFormShow();\n\t},\n\tcomputed:\n\t{\n\t\tdialogNumber()\n\t\t{\n\t\t\tif (!this.message.params)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!this.message.params.IMOL_SID)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.localize.IMOL_MESSAGE_DIALOG_ID.replace('#ID#', this.message.params.IMOL_SID);\n\t\t},\n\t\tlocalize()\n\t\t{\n\t\t\treturn Object.freeze(\n\t\t\t\tObject.assign({},\n\t\t\t\t\tthis.parentLocalize,\n\t\t\t\t\tBX.Vue.getFilteredPhrases('IMOL_MESSAGE_', this.$root.$bitrixMessages)\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\tshowMessage()\n\t\t{\n\t\t\tif (!this.message.params)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.message.params.IMOL_FORM &&\n\t\t\t\tthis.message.params.IMOL_FORM === 'history-delay' // TODO change after release to vote\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\t...BX.Vuex.mapState({\n\t\t\twidget: state => state.widget,\n\t\t})\n\t},\n\ttemplate: `\n\t\t<div v-if=\"showMessage\" class=\"bx-imopenlines-message\">\n\t\t\t<div v-if=\"dialogNumber\" class=\"bx-imopenlines-message-dialog-number\">{{dialogNumber}}</div>\n\t\t\t#PARENT_TEMPLATE#\n\t\t</div>\n\t`\n});"],"names":["FormType","Object","freeze","none","like","welcome","offline","history","VoteType","dislike","BX","Vue","cloneComponent","methods","checkFormShow","message","params","IMOL_FORM","widget","dialog","sessionClose","user","name","lastName","email","phone","$root","$emit","type","delayed","parseInt","IMOL_VOTE","sessionId","userVote","created","computed","dialogNumber","IMOL_SID","localize","IMOL_MESSAGE_DIALOG_ID","replace","assign","parentLocalize","getFilteredPhrases","$bitrixMessages","showMessage","Vuex","mapState","state","template"],"mappings":"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"}