{"version":3,"file":"message.bundle.js","sources":["../../widget/src/const.js","../src/message.js"],"sourcesContent":["/**\n * Bitrix OpenLines widget\n * Widget constants\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nfunction GetObjectValues(source)\n{\n\tconst destination = [];\n\tfor (let value in source)\n\t{\n\t\tif (source.hasOwnProperty(value))\n\t\t{\n\t\t\tdestination.push(source[value]);\n\t\t}\n\t}\n\treturn destination;\n}\n\n/* region 01. Constants */\n\nexport const VoteType = Object.freeze({\n\tnone: 'none',\n\tlike: 'like',\n\tdislike: 'dislike',\n});\n\nexport const LanguageType = Object.freeze({\n\trussian: 'ru',\n\tukraine: 'ua',\n\tworld: 'en',\n});\n\nexport const FormType = Object.freeze({\n\tnone: 'none',\n\tlike: 'like',\n\tsmile: 'smile',\n\tconsent: 'consent',\n\twelcome: 'welcome',\n\toffline: 'offline',\n\thistory: 'history',\n});\n\nexport const LocationType = Object.freeze({\n\ttopLeft: 1,\n\ttopMiddle: 2,\n\ttopBottom: 3,\n\tbottomLeft: 6,\n\tbottomMiddle: 5,\n\tbottomRight: 4,\n});\n\nexport const LocationStyle = Object.freeze({\n\t1: 'top-left',\n\t2: 'top-center',\n\t3: 'top-right',\n\t6: 'bottom-left',\n\t5: 'bottom-center',\n\t4: 'bottom-right',\n});\n\nexport const SubscriptionType = Object.freeze({\n\tconfigLoaded: 'configLoaded',\n\twidgetOpen: 'widgetOpen',\n\twidgetClose: 'widgetClose',\n\tsessionStart: 'sessionStart',\n\tsessionOperatorChange: 'sessionOperatorChange',\n\tsessionFinish: 'sessionFinish',\n\toperatorMessage: 'operatorMessage',\n\tuserForm: 'userForm',\n\tuserMessage: 'userMessage',\n\tuserFile: 'userFile',\n\tuserVote: 'userVote',\n\tevery: 'every',\n});\nexport const SubscriptionTypeCheck = GetObjectValues(SubscriptionType);\n\nexport const RestMethod = Object.freeze({\n\twidgetUserRegister: 'imopenlines.widget.user.register',\n\twidgetConfigGet: 'imopenlines.widget.config.get',\n\twidgetDialogGet: 'imopenlines.widget.dialog.get',\n\twidgetUserGet: 'imopenlines.widget.user.get',\n\twidgetUserConsentApply: 'imopenlines.widget.user.consent.apply',\n\twidgetVoteSend: 'imopenlines.widget.vote.send',\n\twidgetFormSend: 'imopenlines.widget.form.send',\n\twidgetActionSend: 'imopenlines.widget.action.send',\n\tpullServerTime: 'server.time',\n\tpullConfigGet: 'pull.config.get',\n});\nexport const RestMethodCheck = GetObjectValues(RestMethod);\n\nexport const RestAuth = Object.freeze({\n\tguest: 'guest',\n});\n\nexport const SessionStatus = Object.freeze({\n\tnew: 0,\n\tskip: 5,\n\tanswer: 10,\n\tclient: 20,\n\tclientAfterOperator: 25,\n\toperator: 40,\n\twaitClient: 50,\n\tclose: 60,\n\tspam: 65,\n\tduplicate: 69,\n\tsilentlyClose: 75,\n});\n\nexport const EventType = Object.freeze({\n\trequestShowForm: 'IMOL.Widget:requestShowForm',\n});","/**\n * Bitrix Messenger\n * Message Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport './message.css';\nimport 'im.view.message';\nimport { EventEmitter } from \"main.core.events\";\nimport { EventType as WidgetEventType } from \"../../widget/src/const\";\n\nconst FormType = Object.freeze({\n\tnone: 'none',\n\tlike: 'like',\n\twelcome: 'welcome',\n\toffline: 'offline',\n\thistory: 'history',\n});\n\nconst VoteType = Object.freeze({\n\tnone: 'none',\n\tlike: 'like',\n\tdislike: 'dislike',\n});\n\nBX.Vue.cloneComponent('bx-imopenlines-message', 'bx-im-view-message',\n{\n\tmethods:\n\t{\n\t\tcheckFormShow()\n\t\t{\n\t\t\tif (\n\t\t\t\t!this.message.params\n\t\t\t\t|| !this.message.params.IMOL_FORM\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.message.params.IMOL_FORM === 'welcome')\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\t!this.widget.dialog.sessionClose\n\t\t\t\t\t&& (\n\t\t\t\t\t\t!this.widget.user.name\n\t\t\t\t\t\t&& !this.widget.user.lastName\n\t\t\t\t\t\t&& !this.widget.user.email\n\t\t\t\t\t\t&& !this.widget.user.phone\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(WidgetEventType.requestShowForm, {\n\t\t\t\t\t\ttype: FormType.welcome,\n\t\t\t\t\t\tdelayed: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.message.params.IMOL_FORM === 'offline')\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\t!this.widget.dialog.sessionClose\n\t\t\t\t\t&& (!this.widget.user.email)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(WidgetEventType.requestShowForm, {\n\t\t\t\t\t\ttype: FormType.offline,\n\t\t\t\t\t\tdelayed: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.message.params.IMOL_FORM === 'history-delay')\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tparseInt(this.message.params.IMOL_VOTE) === this.widget.dialog.sessionId\n\t\t\t\t\t&& this.widget.dialog.userVote === VoteType.none\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(WidgetEventType.requestShowForm, {\n\t\t\t\t\t\ttype: FormType.like,\n\t\t\t\t\t\tdelayed: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.checkFormShow();\n\t},\n\tcomputed:\n\t{\n\t\tdialogNumber()\n\t\t{\n\t\t\tif (!this.message.params)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!this.message.params.IMOL_SID)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('IMOL_MESSAGE_DIALOG_ID').replace('#ID#', this.message.params.IMOL_SID);\n\t\t},\n\t\tshowMessage()\n\t\t{\n\t\t\tif (!this.message.params)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.message.params.IMOL_FORM &&\n\t\t\t\tthis.message.params.IMOL_FORM === 'history-delay' // TODO change after release to vote\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\t...BX.Vuex.mapState({\n\t\t\twidget: state => state.widget,\n\t\t})\n\t},\n\ttemplate: `\n\t\t<div v-if=\"showMessage\" class=\"bx-imopenlines-message\">\n\t\t\t<div v-if=\"dialogNumber\" class=\"bx-imopenlines-message-dialog-number\">{{dialogNumber}}</div>\n\t\t\t#PARENT_TEMPLATE#\n\t\t</div>\n\t`\n});"],"names":["GetObjectValues","source","destination","value","hasOwnProperty","push","VoteType","Object","freeze","none","like","dislike","LanguageType","russian","ukraine","world","FormType","smile","consent","welcome","offline","history","LocationType","topLeft","topMiddle","topBottom","bottomLeft","bottomMiddle","bottomRight","LocationStyle","SubscriptionType","configLoaded","widgetOpen","widgetClose","sessionStart","sessionOperatorChange","sessionFinish","operatorMessage","userForm","userMessage","userFile","userVote","every","SubscriptionTypeCheck","RestMethod","widgetUserRegister","widgetConfigGet","widgetDialogGet","widgetUserGet","widgetUserConsentApply","widgetVoteSend","widgetFormSend","widgetActionSend","pullServerTime","pullConfigGet","RestMethodCheck","RestAuth","guest","SessionStatus","new","skip","answer","client","clientAfterOperator","operator","waitClient","close","spam","duplicate","silentlyClose","EventType","requestShowForm","BX","Vue","cloneComponent","methods","checkFormShow","message","params","IMOL_FORM","widget","dialog","sessionClose","user","name","lastName","email","phone","EventEmitter","emit","WidgetEventType","type","delayed","parseInt","IMOL_VOTE","sessionId","created","computed","dialogNumber","IMOL_SID","$Bitrix","Loc","getMessage","replace","showMessage","Vuex","mapState","state","template"],"mappings":";;;CAAA;;;;;;;;CASA,SAASA,eAAT,CAAyBC,MAAzB,EACA;CACC,MAAMC,WAAW,GAAG,EAApB;;CACA,OAAK,IAAIC,KAAT,IAAkBF,MAAlB,EACA;CACC,QAAIA,MAAM,CAACG,cAAP,CAAsBD,KAAtB,CAAJ,EACA;CACCD,MAAAA,WAAW,CAACG,IAAZ,CAAiBJ,MAAM,CAACE,KAAD,CAAvB;CACA;CACD;;CACD,SAAOD,WAAP;CACA;CAED;;;AAEA,CAAO,IAAMI,QAAQ,GAAGC,MAAM,CAACC,MAAP,CAAc;CACrCC,EAAAA,IAAI,EAAE,MAD+B;CAErCC,EAAAA,IAAI,EAAE,MAF+B;CAGrCC,EAAAA,OAAO,EAAE;CAH4B,CAAd,CAAjB;AAMP,CAAO,IAAMC,YAAY,GAAGL,MAAM,CAACC,MAAP,CAAc;CACzCK,EAAAA,OAAO,EAAE,IADgC;CAEzCC,EAAAA,OAAO,EAAE,IAFgC;CAGzCC,EAAAA,KAAK,EAAE;CAHkC,CAAd,CAArB;AAMP,CAAO,IAAMC,QAAQ,GAAGT,MAAM,CAACC,MAAP,CAAc;CACrCC,EAAAA,IAAI,EAAE,MAD+B;CAErCC,EAAAA,IAAI,EAAE,MAF+B;CAGrCO,EAAAA,KAAK,EAAE,OAH8B;CAIrCC,EAAAA,OAAO,EAAE,SAJ4B;CAKrCC,EAAAA,OAAO,EAAE,SAL4B;CAMrCC,EAAAA,OAAO,EAAE,SAN4B;CAOrCC,EAAAA,OAAO,EAAE;CAP4B,CAAd,CAAjB;AAUP,CAAO,IAAMC,YAAY,GAAGf,MAAM,CAACC,MAAP,CAAc;CACzCe,EAAAA,OAAO,EAAE,CADgC;CAEzCC,EAAAA,SAAS,EAAE,CAF8B;CAGzCC,EAAAA,SAAS,EAAE,CAH8B;CAIzCC,EAAAA,UAAU,EAAE,CAJ6B;CAKzCC,EAAAA,YAAY,EAAE,CAL2B;CAMzCC,EAAAA,WAAW,EAAE;CAN4B,CAAd,CAArB;AASP,CAAO,IAAMC,aAAa,GAAGtB,MAAM,CAACC,MAAP,CAAc;CAC1C,KAAG,UADuC;CAE1C,KAAG,YAFuC;CAG1C,KAAG,WAHuC;CAI1C,KAAG,aAJuC;CAK1C,KAAG,eALuC;CAM1C,KAAG;CANuC,CAAd,CAAtB;AASP,CAAO,IAAMsB,gBAAgB,GAAGvB,MAAM,CAACC,MAAP,CAAc;CAC7CuB,EAAAA,YAAY,EAAE,cAD+B;CAE7CC,EAAAA,UAAU,EAAE,YAFiC;CAG7CC,EAAAA,WAAW,EAAE,aAHgC;CAI7CC,EAAAA,YAAY,EAAE,cAJ+B;CAK7CC,EAAAA,qBAAqB,EAAE,uBALsB;CAM7CC,EAAAA,aAAa,EAAE,eAN8B;CAO7CC,EAAAA,eAAe,EAAE,iBAP4B;CAQ7CC,EAAAA,QAAQ,EAAE,UARmC;CAS7CC,EAAAA,WAAW,EAAE,aATgC;CAU7CC,EAAAA,QAAQ,EAAE,UAVmC;CAW7CC,EAAAA,QAAQ,EAAE,UAXmC;CAY7CC,EAAAA,KAAK,EAAE;CAZsC,CAAd,CAAzB;AAcP,CAAO,IAAMC,qBAAqB,GAAG3C,eAAe,CAAC8B,gBAAD,CAA7C;AAEP,CAAO,IAAMc,UAAU,GAAGrC,MAAM,CAACC,MAAP,CAAc;CACvCqC,EAAAA,kBAAkB,EAAE,kCADmB;CAEvCC,EAAAA,eAAe,EAAE,+BAFsB;CAGvCC,EAAAA,eAAe,EAAE,+BAHsB;CAIvCC,EAAAA,aAAa,EAAE,6BAJwB;CAKvCC,EAAAA,sBAAsB,EAAE,uCALe;CAMvCC,EAAAA,cAAc,EAAE,8BANuB;CAOvCC,EAAAA,cAAc,EAAE,8BAPuB;CAQvCC,EAAAA,gBAAgB,EAAE,gCARqB;CASvCC,EAAAA,cAAc,EAAE,aATuB;CAUvCC,EAAAA,aAAa,EAAE;CAVwB,CAAd,CAAnB;AAYP,CAAO,IAAMC,eAAe,GAAGvD,eAAe,CAAC4C,UAAD,CAAvC;AAEP,CAAO,IAAMY,QAAQ,GAAGjD,MAAM,CAACC,MAAP,CAAc;CACrCiD,EAAAA,KAAK,EAAE;CAD8B,CAAd,CAAjB;AAIP,CAAO,IAAMC,aAAa,GAAGnD,MAAM,CAACC,MAAP,CAAc;CAC1CmD,EAAAA,GAAG,EAAE,CADqC;CAE1CC,EAAAA,IAAI,EAAE,CAFoC;CAG1CC,EAAAA,MAAM,EAAE,EAHkC;CAI1CC,EAAAA,MAAM,EAAE,EAJkC;CAK1CC,EAAAA,mBAAmB,EAAE,EALqB;CAM1CC,EAAAA,QAAQ,EAAE,EANgC;CAO1CC,EAAAA,UAAU,EAAE,EAP8B;CAQ1CC,EAAAA,KAAK,EAAE,EARmC;CAS1CC,EAAAA,IAAI,EAAE,EAToC;CAU1CC,EAAAA,SAAS,EAAE,EAV+B;CAW1CC,EAAAA,aAAa,EAAE;CAX2B,CAAd,CAAtB;AAcP,CAAO,IAAMC,SAAS,GAAG/D,MAAM,CAACC,MAAP,CAAc;CACtC+D,EAAAA,eAAe,EAAE;CADqB,CAAd,CAAlB;;CChHP;;;;;;;;AASA,CAKA,IAAMvD,UAAQ,GAAGT,MAAM,CAACC,MAAP,CAAc;CAC9BC,EAAAA,IAAI,EAAE,MADwB;CAE9BC,EAAAA,IAAI,EAAE,MAFwB;CAG9BS,EAAAA,OAAO,EAAE,SAHqB;CAI9BC,EAAAA,OAAO,EAAE,SAJqB;CAK9BC,EAAAA,OAAO,EAAE;CALqB,CAAd,CAAjB;CAQA,IAAMf,UAAQ,GAAGC,MAAM,CAACC,MAAP,CAAc;CAC9BC,EAAAA,IAAI,EAAE,MADwB;CAE9BC,EAAAA,IAAI,EAAE,MAFwB;CAG9BC,EAAAA,OAAO,EAAE;CAHqB,CAAd,CAAjB;CAMA6D,EAAE,CAACC,GAAH,CAAOC,cAAP,CAAsB,wBAAtB,EAAgD,oBAAhD,EACA;CACCC,EAAAA,OAAO,EACP;CACCC,IAAAA,aADD,2BAEC;CACC,UACC,CAAC,KAAKC,OAAL,CAAaC,MAAd,IACG,CAAC,KAAKD,OAAL,CAAaC,MAAb,CAAoBC,SAFzB,EAIA;CACC,eAAO,IAAP;CACA;;CAED,UAAI,KAAKF,OAAL,CAAaC,MAAb,CAAoBC,SAApB,KAAkC,SAAtC,EACA;CACC,YACC,CAAC,KAAKC,MAAL,CAAYC,MAAZ,CAAmBC,YAApB,IAEC,CAAC,KAAKF,MAAL,CAAYG,IAAZ,CAAiBC,IAAlB,IACG,CAAC,KAAKJ,MAAL,CAAYG,IAAZ,CAAiBE,QADrB,IAEG,CAAC,KAAKL,MAAL,CAAYG,IAAZ,CAAiBG,KAFrB,IAGG,CAAC,KAAKN,MAAL,CAAYG,IAAZ,CAAiBI,KANvB,EASA;CACCC,UAAAA,6BAAY,CAACC,IAAb,CAAkBC,SAAe,CAACnB,eAAlC,EAAmD;CAClDoB,YAAAA,IAAI,EAAE3E,UAAQ,CAACG,OADmC;CAElDyE,YAAAA,OAAO,EAAE;CAFyC,WAAnD;CAIA;CACD,OAjBD,MAkBK,IAAI,KAAKf,OAAL,CAAaC,MAAb,CAAoBC,SAApB,KAAkC,SAAtC,EACL;CACC,YACC,CAAC,KAAKC,MAAL,CAAYC,MAAZ,CAAmBC,YAApB,IACI,CAAC,KAAKF,MAAL,CAAYG,IAAZ,CAAiBG,KAFvB,EAIA;CACCE,UAAAA,6BAAY,CAACC,IAAb,CAAkBC,SAAe,CAACnB,eAAlC,EAAmD;CAClDoB,YAAAA,IAAI,EAAE3E,UAAQ,CAACI,OADmC;CAElDwE,YAAAA,OAAO,EAAE;CAFyC,WAAnD;CAIA;CACD,OAZI,MAaA,IAAI,KAAKf,OAAL,CAAaC,MAAb,CAAoBC,SAApB,KAAkC,eAAtC,EACL;CACC,YACCc,QAAQ,CAAC,KAAKhB,OAAL,CAAaC,MAAb,CAAoBgB,SAArB,CAAR,KAA4C,KAAKd,MAAL,CAAYC,MAAZ,CAAmBc,SAA/D,IACG,KAAKf,MAAL,CAAYC,MAAZ,CAAmBxC,QAAnB,KAAgCnC,UAAQ,CAACG,IAF7C,EAIA;CACC+E,UAAAA,6BAAY,CAACC,IAAb,CAAkBC,SAAe,CAACnB,eAAlC,EAAmD;CAClDoB,YAAAA,IAAI,EAAE3E,UAAQ,CAACN,IADmC;CAElDkF,YAAAA,OAAO,EAAE;CAFyC,WAAnD;CAIA;CACD;CACD;CAvDF,GAFD;CA2DCI,EAAAA,OA3DD,qBA4DC;CACC,SAAKpB,aAAL;CACA,GA9DF;CA+DCqB,EAAAA,QAAQ;CAEPC,IAAAA,YAFO,0BAGP;CACC,UAAI,CAAC,KAAKrB,OAAL,CAAaC,MAAlB,EACA;CACC,eAAO,KAAP;CACA;;CAED,UAAI,CAAC,KAAKD,OAAL,CAAaC,MAAb,CAAoBqB,QAAzB,EACA;CACC,eAAO,KAAP;CACA;;CAED,aAAO,KAAKC,OAAL,CAAaC,GAAb,CAAiBC,UAAjB,CAA4B,wBAA5B,EAAsDC,OAAtD,CAA8D,MAA9D,EAAsE,KAAK1B,OAAL,CAAaC,MAAb,CAAoBqB,QAA1F,CAAP;CACA,KAfM;CAgBPK,IAAAA,WAhBO,yBAiBP;CACC,UAAI,CAAC,KAAK3B,OAAL,CAAaC,MAAlB,EACA;CACC,eAAO,IAAP;CACA;;CAED,UACC,KAAKD,OAAL,CAAaC,MAAb,CAAoBC,SAApB,IACA,KAAKF,OAAL,CAAaC,MAAb,CAAoBC,SAApB,KAAkC,eAFnC;CAAA,QAIA;CACC,iBAAO,KAAP;CACA;;CAED,aAAO,IAAP;CACA;CAhCM,KAkCJP,EAAE,CAACiC,IAAH,CAAQC,QAAR,CAAiB;CACnB1B,IAAAA,MAAM,EAAE,gBAAA2B,KAAK;CAAA,aAAIA,KAAK,CAAC3B,MAAV;CAAA;CADM,GAAjB,CAlCI,CA/DT;CAqGC4B,EAAAA,QAAQ;CArGT,CADA;;;;"}