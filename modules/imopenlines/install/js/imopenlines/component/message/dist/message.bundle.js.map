{"version":3,"file":"message.bundle.js","sources":["../../widget/src/const.js","../src/message.js"],"sourcesContent":["/**\n * Bitrix OpenLines widget\n * Widget constants\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nfunction GetObjectValues(source)\n{\n\tconst destination = [];\n\tfor (let value in source)\n\t{\n\t\tif (source.hasOwnProperty(value))\n\t\t{\n\t\t\tdestination.push(source[value]);\n\t\t}\n\t}\n\treturn destination;\n}\n\n/* region 01. Constants */\n\nexport const VoteType = Object.freeze({\n\tnone: 'none',\n\tlike: 'like',\n\tdislike: 'dislike',\n});\n\nexport const LanguageType = Object.freeze({\n\trussian: 'ru',\n\tukraine: 'ua',\n\tworld: 'en',\n});\n\nexport const FormType = Object.freeze({\n\tnone: 'none',\n\tlike: 'like',\n\tsmile: 'smile',\n\tconsent: 'consent',\n\twelcome: 'welcome',\n\toffline: 'offline',\n\thistory: 'history',\n});\n\nexport const LocationType = Object.freeze({\n\ttopLeft: 1,\n\ttopMiddle: 2,\n\ttopBottom: 3,\n\tbottomLeft: 6,\n\tbottomMiddle: 5,\n\tbottomRight: 4,\n});\n\nexport const LocationStyle = Object.freeze({\n\t1: 'top-left',\n\t2: 'top-center',\n\t3: 'top-right',\n\t6: 'bottom-left',\n\t5: 'bottom-center',\n\t4: 'bottom-right',\n});\n\nexport const WidgetBaseSize = Object.freeze({\n\twidth: 435,\n\theight: 557\n});\n\nexport const WidgetMinimumSize = Object.freeze({\n\twidth: 340,\n\theight: 435\n});\n\nexport const SubscriptionType = Object.freeze({\n\tconfigLoaded: 'configLoaded',\n\twidgetOpen: 'widgetOpen',\n\twidgetClose: 'widgetClose',\n\tsessionStart: 'sessionStart',\n\tsessionOperatorChange: 'sessionOperatorChange',\n\tsessionFinish: 'sessionFinish',\n\toperatorMessage: 'operatorMessage',\n\tuserForm: 'userForm',\n\tuserMessage: 'userMessage',\n\tuserFile: 'userFile',\n\tuserVote: 'userVote',\n\tevery: 'every',\n});\nexport const SubscriptionTypeCheck = GetObjectValues(SubscriptionType);\n\nexport const RestMethod = Object.freeze({\n\twidgetUserRegister: 'imopenlines.widget.user.register',\n\twidgetChatCreate: 'imopenlines.widget.chat.create',\n\twidgetConfigGet: 'imopenlines.widget.config.get',\n\twidgetDialogGet: 'imopenlines.widget.dialog.get',\n\twidgetDialogList: 'imopenlines.widget.dialog.list',\n\twidgetUserGet: 'imopenlines.widget.user.get',\n\twidgetUserConsentApply: 'imopenlines.widget.user.consent.apply',\n\twidgetVoteSend: 'imopenlines.widget.vote.send',\n\twidgetActionSend: 'imopenlines.widget.action.send',\n\tpullServerTime: 'server.time',\n\tpullConfigGet: 'pull.config.get',\n});\nexport const RestMethodCheck = GetObjectValues(RestMethod);\n\nexport const RestAuth = Object.freeze({\n\tguest: 'guest',\n});\n\nexport const SessionStatus = Object.freeze({\n\tnew: 0,\n\tskip: 5,\n\tanswer: 10,\n\tclient: 20,\n\tclientAfterOperator: 25,\n\toperator: 40,\n\twaitClient: 50,\n\tclose: 60,\n\tspam: 65,\n\tduplicate: 69,\n\tsilentlyClose: 75,\n});\n\nexport const WidgetEventType = Object.freeze({\n\tshowForm: 'IMOL.Widget:showForm',\n\thideForm: 'IMOL.Widget:hideForm',\n\tprocessMessagesToSendQueue: 'IMOL.Widget:processMessagesToSendQueue',\n\trequestData: 'IMOL.Widget:requestData',\n\tshowConsent: 'IMOL.Widget:showConsent',\n\tacceptConsent: 'IMOL.Widget:acceptConsent',\n\tconsentAccepted: 'IMOL.Widget:consentAccepted',\n\tdeclineConsent: 'IMOL.Widget:declineConsent',\n\tconsentDeclined: 'IMOL.Widget:consentDeclined',\n\tsendDialogVote: 'IMOL.Widget:sendDialogVote',\n\tcreateSession: 'IMOL.Widget:createSession',\n\topenSession: 'IMOL.Widget:openSession',\n});","/**\n * Bitrix Messenger\n * Message Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport { BitrixVue } from \"ui.vue\";\nimport { Vuex } from \"ui.vue.vuex\";\nimport './message.css';\nimport 'im.view.message';\nimport 'ui.fonts.opensans';\nimport { EventEmitter } from \"main.core.events\";\nimport { WidgetEventType } from \"../../widget/src/const\";\n\nconst FormType = Object.freeze({\n\tnone: 'none',\n\tlike: 'like',\n\twelcome: 'welcome',\n\toffline: 'offline',\n\thistory: 'history',\n});\n\nconst VoteType = Object.freeze({\n\tnone: 'none',\n\tlike: 'like',\n\tdislike: 'dislike',\n});\n\nBitrixVue.cloneComponent('bx-imopenlines-message', 'bx-im-view-message',\n{\n\tmethods:\n\t{\n\t\tcheckMessageParamsForForm()\n\t\t{\n\t\t\tif (!this.message.params || !this.message.params.IMOL_FORM)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.message.params.IMOL_FORM === FormType.like)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tparseInt(this.message.params.IMOL_VOTE) === this.widget.dialog.sessionId\n\t\t\t\t\t&& this.widget.dialog.userVote === VoteType.none\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(WidgetEventType.showForm, {\n\t\t\t\t\t\ttype: FormType.like,\n\t\t\t\t\t\tdelayed: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.checkMessageParamsForForm();\n\t},\n\tcomputed:\n\t{\n\t\tdialogNumber()\n\t\t{\n\t\t\tif (!this.message.params)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!this.message.params.IMOL_SID)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('IMOL_MESSAGE_DIALOG_ID').replace('#ID#', this.message.params.IMOL_SID);\n\t\t},\n\t\tshowMessage()\n\t\t{\n\t\t\tif (!this.message.params)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.message.params.IMOL_FORM &&\n\t\t\t\tthis.message.params.IMOL_FORM === 'like'\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\twidget: state => state.widget,\n\t\t})\n\t},\n\ttemplate: `\n\t\t<div v-if=\"showMessage\" class=\"bx-imopenlines-message\">\n\t\t\t<div v-if=\"dialogNumber\" class=\"bx-imopenlines-message-dialog-number\">{{dialogNumber}}</div>\n\t\t\t#PARENT_TEMPLATE#\n\t\t</div>\n\t`\n});"],"names":["GetObjectValues","source","destination","value","hasOwnProperty","push","VoteType","Object","freeze","none","like","dislike","LanguageType","russian","ukraine","world","FormType","smile","consent","welcome","offline","history","LocationType","topLeft","topMiddle","topBottom","bottomLeft","bottomMiddle","bottomRight","LocationStyle","WidgetBaseSize","width","height","WidgetMinimumSize","SubscriptionType","configLoaded","widgetOpen","widgetClose","sessionStart","sessionOperatorChange","sessionFinish","operatorMessage","userForm","userMessage","userFile","userVote","every","SubscriptionTypeCheck","RestMethod","widgetUserRegister","widgetChatCreate","widgetConfigGet","widgetDialogGet","widgetDialogList","widgetUserGet","widgetUserConsentApply","widgetVoteSend","widgetActionSend","pullServerTime","pullConfigGet","RestMethodCheck","RestAuth","guest","SessionStatus","skip","answer","client","clientAfterOperator","operator","waitClient","close","spam","duplicate","silentlyClose","WidgetEventType","showForm","hideForm","processMessagesToSendQueue","requestData","showConsent","acceptConsent","consentAccepted","declineConsent","consentDeclined","sendDialogVote","createSession","openSession","BitrixVue","cloneComponent","methods","checkMessageParamsForForm","message","params","IMOL_FORM","parseInt","IMOL_VOTE","widget","dialog","sessionId","EventEmitter","emit","type","delayed","created","computed","dialogNumber","IMOL_SID","$Bitrix","Loc","getMessage","replace","showMessage","Vuex","mapState","state","template"],"mappings":"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"}