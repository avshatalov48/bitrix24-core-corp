BX.ready(function(){BX.PULL.extendWatch("IMOL_STATISTICS");BX.addCustomEvent("onPullEvent-imopenlines",function(e,t){if(e=="voteHead"){if(typeof t.voteValue!=="undefined"){var n=BX("ol-vote-head-placeholder-"+t.sessionId);if(n){BX.cleanNode(n);n.appendChild(BX.MessengerCommon.linesVoteHeadNodes(t.sessionId,t.voteValue,true))}}if(typeof t.commentValue!=="undefined"){var i=BX("ol-comment-head-placeholder-"+t.sessionId);if(i){BX.cleanNode(i);i.appendChild(BX.MessengerCommon.linesCommentHeadNodes(t.sessionId,t.commentValue,true,"statistics"))}}}});BX.namespace("BX.OpenLines");if(typeof BX.OpenLines.ExportManager==="undefined"){BX.OpenLines.ExportManager=function(){this._id="";this._settings={};this._processDialog=null;this._siteId="";this._sToken="";this._cToken="";this._token=""};BX.OpenLines.ExportManager.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(4);this._settings=t?t:{};this._siteId=this.getSetting("siteId","");if(!BX.type.isNotEmptyString(this._siteId))throw"BX.OpenLines.ExportManager: parameter 'siteId' is not found.";this._sToken=this.getSetting("sToken","");if(!BX.type.isNotEmptyString(this._sToken))throw"BX.OpenLines.ExportManager: parameter 'sToken' is not found."},getId:function(){return this._id},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},callAction:function(e){this._processDialog.setAction(e);this._processDialog.start()},startExport:function(e){if(!BX.type.isNotEmptyString(e))throw"BX.OpenLines.ExportManager: parameter 'exportType' has invalid value.";this._cToken="c"+Date.now();this._token=this._sToken+this._cToken;var t={SITE_ID:this._siteId,PROCESS_TOKEN:this._token,EXPORT_TYPE:e,COMPONENT_NAME:"bitrix:imopenlines.statistics.detail",signedParameters:this.getSetting("componentParams",{})};var n=e.charAt(0).toUpperCase()+e.slice(1);this._processDialog=BX.OpenlinesLongRunningProcessDialog.create(this._id+"_LrpDlg",{componentName:"bitrix:imopenlines.statistics.detail",action:"dispatcher",params:t,title:this.getMessage("stExport"+n+"DlgTitle"),summary:this.getMessage("stExport"+n+"DlgSummary"),isSummaryHtml:false,requestHandler:function(e){if(BX.type.isNotEmptyString(e["STATUS"])&&e["STATUS"]=="COMPLETED"){if(BX.type.isNotEmptyString(e["DOWNLOAD_LINK"])){e["SUMMARY_HTML"]+="<br><br>"+'<a href="'+e["DOWNLOAD_LINK"]+'" class="ui-btn ui-btn-sm ui-btn-success ui-btn-icon-download">'+e["DOWNLOAD_LINK_NAME"]+"</a>"+'<button onclick="BX.OpenLines.ExportManager.currentInstance().callAction(\'clear\')" class="ui-btn ui-btn-sm ui-btn-default ui-btn-icon-remove">'+e["CLEAR_LINK_NAME"]+"</button>"}}}});this._processDialog.show()},destroy:function(){this._id="";this._settings={};this._processDialog=null;this._siteId="";this._sToken="";this._cToken="";this._token=""}};BX.OpenLines.ExportManager.prototype.getMessage=function(e){var t=e;var n=this.getSetting("messages",null);if(n!==null&&typeof n==="object"&&n.hasOwnProperty(e)){t=n[e]}else{n=BX.OpenLines.ExportManager.messages;if(n!==null&&typeof n==="object"&&n.hasOwnProperty(e)){t=n[e]}}return t};if(typeof BX.OpenLines.ExportManager.messages==="undefined"){BX.OpenLines.ExportManager.messages={}}if(typeof BX.OpenLines.ExportManager.items==="undefined"){BX.OpenLines.ExportManager.items={}}BX.OpenLines.ExportManager.create=function(e,t){var n=new BX.OpenLines.ExportManager;n.initialize(e,t);BX.OpenLines.ExportManager.items[e]=n;BX.OpenLines.ExportManager.currentId=e;return n};BX.OpenLines.ExportManager.delete=function(e){if(BX.OpenLines.ExportManager.items.hasOwnProperty(e)){BX.OpenLines.ExportManager.items[e].destroy();delete BX.OpenLines.ExportManager.items[e]}};BX.OpenLines.ExportManager.currentId="";BX.OpenLines.ExportManager.currentInstance=function(){return BX.OpenLines.ExportManager.items[BX.OpenLines.ExportManager.currentId]}}BX.namespace("BX.OpenLines.Actions");BX.OpenLines.Actions.getGridInstance=function(){if(window.top.BX.Main.gridManager){var e=window.top.BX.Main.gridManager.data.filter(function(e){return e.id.indexOf(BX.message("IMOL_STATISTICS_GRID_ID"))===0});if(e[0]&&e[0].hasOwnProperty("instance")){return e[0].instance}}return false};BX.OpenLines.Actions.closeSpam=function(e){BX.MessengerCommon.linesMarkAsSpam(e);BX.OpenLines.Actions.getGridInstance().reloadTable("POST")};BX.OpenLines.Actions.close=function(e){BX.MessengerCommon.linesCloseDialog(e,true);BX.OpenLines.Actions.getGridInstance().reloadTable("POST")}});
//# sourceMappingURL=script.map.js