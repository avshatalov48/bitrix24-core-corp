{"version":3,"file":"product-selector.bundle.js","sources":["../src/product-search-selector-footer.js","../src/product-creation-limited-footer.js","../src/selector-error-code.js","../src/product-search-input.js","../src/product-image-input.js","../src/barcode-search-selector-footer.js","../src/barcode-search-input.js","../src/product-selector.js"],"sourcesContent":["import {DefaultFooter, Dialog} from 'ui.entity-selector';\nimport {Dom, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent} from \"main.core.events\";\nimport {Loader} from \"main.loader\";\nimport {ProductSelector} from \"catalog.product-selector\";\n\nexport default class ProductSearchSelectorFooter extends DefaultFooter\n{\n\tloader: Loader = null;\n\n\tconstructor(dialog: Dialog, options: { [option: string]: any })\n\t{\n\t\tsuper(dialog, options);\n\n\t\tthis.errorAdminHint = options.errorAdminHint || '';\n\t\tthis.getDialog().subscribe('onSearch', this.handleOnSearch.bind(this));\n\t}\n\n\tgetContent(): HTMLElement\n\t{\n\t\tlet phrase = '';\n\n\t\tconst isViewCreateButton = this.options.allowCreateItem === true || this.options.allowEditItem === false;\n\n\t\tif (this.isViewEditButton() && isViewCreateButton)\n\t\t{\n\t\t\tphrase = Tag.render`\n\t\t\t\t<div>${Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_1')}</div>\n\t\t\t`;\n\n\t\t\tconst createButton = phrase.querySelector('create-button');\n\t\t\tDom.replace(createButton, this.getLabelContainer());\n\n\t\t\tconst changeButton = phrase.querySelector('change-button');\n\t\t\tDom.replace(changeButton, this.getSaveContainer());\n\t\t}\n\t\telse if (this.isViewEditButton())\n\t\t{\n\t\t\tphrase = this.getSaveContainer();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tphrase = this.getLabelContainer();\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-selector-search-footer-box\">\n\t\t\t\t${phrase}\n\t\t\t\t${this.getHintContainer()}\n\t\t\t\t${this.getLoaderContainer()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tisViewEditButton(): boolean\n\t{\n\t\treturn this.options.allowEditItem === true;\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif (Type.isNil(this.loader))\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\ttarget: this.getLoaderContainer(),\n\t\t\t\tsize: 17,\n\t\t\t\tcolor: 'rgba(82, 92, 105, 0.9)'\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tshowLoader(): void\n\t{\n\t\tvoid this.getLoader().show();\n\t}\n\n\thideLoader(): void\n\t{\n\t\tvoid this.getLoader().hide();\n\t}\n\n\tsetLabel(label: string)\n\t{\n\t\tif (Type.isString(label))\n\t\t{\n\t\t\tthis.getLabelContainer().textContent = label;\n\t\t}\n\t}\n\n\tgetLabelContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('label', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span>\n\t\t\t\t\t<span onclick=\"${this.handleClick.bind(this)}\" class=\"ui-selector-footer-link  ui-selector-footer-link-add\">\n\t\t\t\t\t\t${\n\t\t\t\t\t\t\tthis.getOption('creationLabel', Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CREATE'))\n\t\t\t\t\t\t}\n\t\t\t\t\t</span>\n\t\t\t\t\t${this.getQueryContainer()}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetQueryContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('name-container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"ui-selector-search-footer-query\"></span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetSaveContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('save-container', () => {\n\t\t\tconst className = `ui-selector-footer-link`;\n\n\t\t\tconst messageId =\n\t\t\t\t(this.options.inputName === ProductSelector.INPUT_FIELD_BARCODE)\n\t\t\t\t\t? 'CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_BARCODE_CHANGE'\n\t\t\t\t\t: 'CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CHANGE'\n\t\t\t;\n\n\t\t\treturn Tag.render`\n\t\t\t<span class=\"${className}\" onclick=\"${this.onClickSaveChanges.bind(this)}\">\n\t\t\t\t${Loc.getMessage(messageId)}\n\t\t\t</span>\n\t\t`;\n\t\t});\n\t}\n\n\tgetLoaderContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('loader', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"ui-selector-search-footer-loader\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetHintContainer(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('hint', () => {\n\t\t\tlet message = null;\n\t\t\tif (!this.options.allowEditItem && !this.options.allowCreateItem)\n\t\t\t{\n\t\t\t\tmessage = Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_DISABLED_FOOTER_ALL_HINT', {\n\t\t\t\t\t'#ADMIN_HINT#': this.errorAdminHint\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (!this.options.allowEditItem)\n\t\t\t{\n\t\t\t\tmessage = Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_DISABLED_FOOTER_EDIT_HINT', {\n\t\t\t\t\t'#ADMIN_HINT#': this.errorAdminHint\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (!this.options.allowCreateItem)\n\t\t\t{\n\t\t\t\tmessage = Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_DISABLED_FOOTER_ADD_HINT', {\n\t\t\t\t\t'#ADMIN_HINT#': this.errorAdminHint\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst hintNode = Tag.render`<span class=\"ui-btn ui-btn-icon-lock ui-btn-link\"></span>`;\n\t\t\thintNode.dataset.hint = message;\n\t\t\thintNode.dataset.hintNoIcon = true;\n\n\t\t\tBX.UI.Hint.initNode(hintNode);\n\n\t\t\treturn Tag.render`<div class=\"product-search-selector-disabled-footer-hint\">${hintNode}</div>`;\n\t\t});\n\t}\n\n\tonClickSaveChanges()\n\t{\n\t\tif (!this.options.allowEditItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst lastQuery = this.getDialog().getActiveTab().getLastSearchQuery();\n\t\tthis.getDialog().emit('ChangeItem:onClick', { query: lastQuery.query });\n\t\tthis.getDialog().clearSearch();\n\t\tthis.getDialog().hide();\n\t}\n\n\tcreateItem(): void\n\t{\n\t\tif (!this.options.allowCreateItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst tagSelector = this.getDialog().getTagSelector();\n\t\tif (tagSelector && tagSelector.isLocked())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst finalize = () => {\n\t\t\tthis.hideLoader();\n\t\t\tif (this.getDialog().getTagSelector())\n\t\t\t{\n\t\t\t\tthis.getDialog().getTagSelector().unlock();\n\t\t\t\tthis.getDialog().focusSearch();\n\t\t\t}\n\t\t};\n\n\t\tevent.preventDefault();\n\t\tthis.showLoader();\n\n\t\tif (tagSelector)\n\t\t{\n\t\t\ttagSelector.lock();\n\t\t}\n\n\t\tthis.getDialog()\n\t\t\t.emitAsync('Search:onItemCreateAsync', {\n\t\t\t\tsearchQuery: this.getDialog().getActiveTab().getLastSearchQuery()\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.getTab().clearResults();\n\t\t\t\tthis.getDialog().clearSearch();\n\t\t\t\tif (this.getDialog().getActiveTab() === this.getTab())\n\t\t\t\t{\n\t\t\t\t\tthis.getDialog().selectFirstTab();\n\t\t\t\t}\n\n\t\t\t\tfinalize();\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tfinalize();\n\t\t\t})\n\t\t;\n\t}\n\n\thandleClick(): void\n\t{\n\t\tthis.createItem();\n\t}\n\n\thandleOnSearch(event: BaseEvent): void\n\t{\n\t\tconst { query } = event.getData();\n\n\t\tif (this.options.currentValue === query || query === '')\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.show();\n\t\t}\n\n\t\tthis.getQueryContainer().textContent = \" \" + query;\n\t}\n}\n","import {DefaultFooter} from 'ui.entity-selector';\nimport {Event, Loc, Tag} from 'main.core';\nimport 'ui.info-helper';\n\nexport default class ProductCreationLimitedFooter extends DefaultFooter\n{\n\tgetContent(): HTMLElement\n\t{\n\t\tconst phrase = Tag.render`\n\t\t\t<div>${Loc.getMessage('CATALOG_SELECTOR_LIMITED_PRODUCT_CREATION')}</div>\n\t\t`;\n\n\t\tconst infoButton = Tag.render`\n\t\t\t<a class=\"ui-btn ui-btn-sm ui-btn-primary ui-btn-hover ui-btn-round\">\n\t\t\t\t${Loc.getMessage('CATALOG_SELECTOR_LICENSE_EXPLODE')}\n\t\t\t</a>\n\t\t`;\n\n\t\tEvent.bind(infoButton, 'click', () => {\n\t\t\tBX.UI.InfoHelper.show('limit_shop_products');\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-selector-search-footer-box\">\n\t\t\t\t<div class=\"ui-selector-search-footer-box\">\n\t\t\t\t\t<div class=\"tariff-lock\"></div>\n\t\t\t\t\t${phrase}\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t${infoButton}\n\t\t\t\t</div>\t\t\t\t\n\t\t\t</div>\n\t\t`;\n\t}\n}","export class SelectorErrorCode\n{\n\tstatic NOT_SELECTED_PRODUCT: string = 'NOT_SELECTED_PRODUCT';\n\tstatic FAILED_PRODUCT: string = 'FAILED_PRODUCT';\n\n\tstatic getCodes(): Array<string>\n\t{\n\t\treturn [\n\t\t\tSelectorErrorCode.NOT_SELECTED_PRODUCT,\n\t\t\tSelectorErrorCode.FAILED_PRODUCT,\n\t\t]\n\t}\n}","import {ajax, Browser, Cache, Dom, Event, Extension, Loc, Runtime, Tag, Text, Type} from 'main.core';\nimport {Dialog, Item} from 'ui.entity-selector';\nimport './component.css';\nimport {EventEmitter} from 'main.core.events';\nimport {ProductModel} from 'catalog.product-model';\nimport {ProductSelector} from 'catalog.product-selector';\nimport ProductSearchSelectorFooter from './product-search-selector-footer';\nimport ProductCreationLimitedFooter from './product-creation-limited-footer';\nimport {SelectorErrorCode} from './selector-error-code';\nimport 'ui.notification';\n\nclass DialogMode\n{\n\tstatic SEARCHING: string = 'SEARCHING';\n\tstatic SHOW_PRODUCT_ITEM: string = 'SHOW_PRODUCT_ITEM';\n\tstatic SHOW_RECENT: string = 'SHOW_RECENT';\n}\n\nexport class ProductSearchInput\n{\n\tstatic SEARCH_TYPE_ID = 'product';\n\n\tmodel: ProductModel;\n\tselector: ProductSelector;\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(id, options = {})\n\t{\n\t\tthis.id = id || Text.getRandom();\n\t\tthis.selector = options.selector;\n\t\tif (!(this.selector instanceof ProductSelector))\n\t\t{\n\t\t\tthrow new Error('Product selector instance not found.');\n\t\t}\n\n\t\tthis.model = options.model || {};\n\t\tthis.isEnabledSearch = options.isSearchEnabled;\n\t\tthis.isEnabledDetailLink = options.isEnabledDetailLink;\n\t\tthis.inputName = options.inputName || ProductSelector.INPUT_FIELD_NAME;\n\t\tthis.immutableFieldNames = [ProductSelector.INPUT_FIELD_BARCODE, ProductSelector.INPUT_FIELD_NAME];\n\t\tif (!this.immutableFieldNames.includes(this.inputName))\n\t\t{\n\t\t\tthis.immutableFieldNames.push(this.inputName);\n\t\t}\n\t\tthis.ajaxInProcess = false;\n\t\tthis.loadedSelectedItem = null;\n\n\t\tthis.handleSearchInput = Runtime.debounce(this.searchInDialog, 500, this);\n\t}\n\n\tdestroy()\n\t{\n\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetSelectorType(): string\n\t{\n\t\treturn ProductSelector.INPUT_FIELD_NAME;\n\t}\n\n\tgetField(fieldName): string\n\t{\n\t\treturn this.model.getField(fieldName);\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.getField(this.inputName);\n\t}\n\n\tgetFilledValue(): string\n\t{\n\t\treturn this.getNameInput().value || '';\n\t}\n\n\tisSearchEnabled(): boolean\n\t{\n\t\treturn this.isEnabledSearch;\n\t}\n\n\ttoggleIcon(icon, value)\n\t{\n\t\tif (Type.isDomNode(icon))\n\t\t{\n\t\t\tDom.style(icon, 'display', value);\n\t\t}\n\t}\n\n\tgetNameBlock(): HTMLElement\n\t{\n\t\treturn this.cache.remember('nameBlock', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t${this.getNameTag()}\n\t\t\t\t\t${this.getNameInput()}\n\t\t\t\t\t${this.getHiddenNameInput()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetNameTag(): ?HTMLElement\n\t{\n\t\tif (!this.model.isNew())\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-ctl-tag\">${Loc.getMessage('CATALOG_SELECTOR_NEW_TAG_TITLE')}</div>\n\t\t`;\n\t}\n\n\tgetNameInput(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('nameInput', () => {\n\t\t\tconst input = Tag.render`\n\t\t\t\t<input type=\"text\"\n\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox\"\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\tdata-name=\"${Text.encode(this.inputName)}\"\n\t\t\t\t\tvalue=\"${Text.encode(this.getValue())}\"\n\t\t\t\t\tplaceholder=\"${Text.encode(this.getPlaceholder())}\"\n\t\t\t\t\ttitle=\"${Text.encode(this.getValue())}\"\n\t\t\t\t\tonchange=\"${this.handleNameInputHiddenChange.bind(this)}\"\n\t\t\t\t>\n\t\t\t`;\n\n\t\t\tif (this.selector.getConfig('SELECTOR_INPUT_DISABLED', false))\n\t\t\t{\n\t\t\t\tDom.addClass(input, 'ui-ctl-disabled');\n\t\t\t\tinput.setAttribute('disabled', true);\n\t\t\t}\n\n\t\t\treturn input;\n\t\t});\n\t}\n\n\tgetHiddenNameInput(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('hiddenNameInput', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input\n\t\t\t\t \ttype=\"hidden\"\n\t\t\t\t\tname=\"${Text.encode(this.inputName)}\"\n\t\t\t\t\tvalue=\"${Text.encode(this.getValue())}\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\thandleNameInputHiddenChange(event: UIEvent)\n\t{\n\t\tthis.getHiddenNameInput().value = event.target.value;\n\t}\n\n\tgetClearIcon(): HTMLElement\n\t{\n\t\treturn this.cache.remember('closeIcon', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-clear\"\n\t\t\t\t\tonclick=\"${this.handleClearIconClick.bind(this)}\"\n\t\t\t\t></button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetArrowIcon(): HTMLElement\n\t{\n\t\treturn this.cache.remember('arrowIcon', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"${Text.encode(this.model.getDetailPath())}\"\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-forward\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetSearchIcon(): HTMLElement\n\t{\n\t\treturn this.cache.remember('searchIcon', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-search\"\n\t\t\t\t\tonclick=\"${this.handleSearchIconClick.bind(this)}\"\n\t\t\t\t></button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tlayout(): HTMLElement\n\t{\n\t\tthis.clearInputCache();\n\t\tconst block = Tag.render`<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\"></div>`;\n\n\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\tDom.append(this.getClearIcon(), block);\n\n\t\tif (this.isSearchEnabled())\n\t\t{\n\t\t\tif (this.selector.isProductSearchEnabled())\n\t\t\t{\n\t\t\t\tthis.initHasDialogItems();\n\t\t\t}\n\n\t\t\tthis.toggleIcon(\n\t\t\t\tthis.getSearchIcon(),\n\t\t\t\tType.isStringFilled(this.getFilledValue()) ? 'none' : 'block'\n\t\t\t);\n\t\t\tDom.append(this.getSearchIcon(), block);\n\n\t\t\tEvent.bind(this.getNameInput(), 'click', this.handleClickNameInput.bind(this));\n\t\t\tEvent.bind(this.getNameInput(), 'input', this.handleSearchInput);\n\t\t\tEvent.bind(this.getNameInput(), 'blur', this.handleNameInputBlur.bind(this));\n\t\t\tEvent.bind(this.getNameInput(), 'keydown', this.handleNameInputKeyDown.bind(this));\n\n\t\t\tthis.dialogMode =\n\t\t\t\tthis.model.isCatalogExisted()\n\t\t\t\t\t? DialogMode.SHOW_PRODUCT_ITEM\n\t\t\t\t\t: DialogMode.SHOW_RECENT\n\t\t\t;\n\t\t}\n\n\t\tif (this.showDetailLink() && Type.isStringFilled(this.getValue()))\n\t\t{\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\t\tthis.toggleIcon(this.getArrowIcon(), 'block');\n\t\t\tDom.append(this.getArrowIcon(), block);\n\t\t}\n\n\t\tEvent.bind(this.getNameInput(), 'click', this.handleIconsSwitchingOnNameInput.bind(this));\n\t\tEvent.bind(this.getNameInput(), 'input', this.handleIconsSwitchingOnNameInput.bind(this));\n\t\tEvent.bind(this.getNameInput(), 'change', this.handleNameInputChange.bind(this));\n\n\t\tDom.append(this.getNameBlock(), block);\n\t\treturn block;\n\t}\n\n\tshowDetailLink(): boolean\n\t{\n\t\treturn this.isEnabledDetailLink;\n\t}\n\n\tgetDialog(): ?Dialog\n\t{\n\t\treturn this.cache.remember('dialog', () => {\n\t\t\tconst searchTypeId = ProductSearchInput.SEARCH_TYPE_ID ;\n\t\t\tconst entity = {\n\t\t\t\tid: searchTypeId,\n\t\t\t\toptions: {\n\t\t\t\t\tiblockId: this.model.getIblockId(),\n\t\t\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\t},\n\t\t\t\tdynamicLoad: true,\n\t\t\t\tdynamicSearch: true,\n\t\t\t};\n\t\t\tconst restrictedProductTypes = this.selector.getConfig('RESTRICTED_PRODUCT_TYPES', null);\n\t\t\tif (!Type.isNil(restrictedProductTypes))\n\t\t\t{\n\t\t\t\tentity.options.restrictedProductTypes = restrictedProductTypes;\n\t\t\t}\n\n\t\t\tconst params = {\n\t\t\t\tid: this.id + '_' + searchTypeId,\n\t\t\t\theight: 300,\n\t\t\t\twidth: Math.max(this.getNameInput()?.offsetWidth, 565),\n\t\t\t\tcontext: 'catalog-products',\n\t\t\t\ttargetNode: this.getNameInput(),\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tsearchTabOptions: {\n\t\t\t\t\tstub: true,\n\t\t\t\t\tstubOptions: {\n\t\t\t\t\t\ttitle: Tag.message`${'CATALOG_SELECTOR_IS_EMPTY_TITLE'}`,\n\t\t\t\t\t\tsubtitle:\n\t\t\t\t\t\t\tthis.isAllowedCreateProduct()\n\t\t\t\t\t\t\t\t? Tag.message`${'CATALOG_SELECTOR_IS_EMPTY_SUBTITLE'}`\n\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t,\n\t\t\t\t\t\tarrow: true\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.onProductSelect.bind(this),\n\t\t\t\t\t'Search:onItemCreateAsync': this.createProduct.bind(this),\n\t\t\t\t\t'ChangeItem:onClick': this.showChangeNotification.bind(this),\n\t\t\t\t},\n\t\t\t\tentities: [entity]\n\t\t\t};\n\n\t\t\tconst settingsCollection = Extension.getSettings('catalog.product-selector');\n\t\t\tif (Type.isObject(settingsCollection.get('limitInfo')))\n\t\t\t{\n\t\t\t\tparams.footer = ProductCreationLimitedFooter;\n\t\t\t}\n\t\t\telse if (this.model && this.model.isCatalogExisted())\n\t\t\t{\n\t\t\t\tparams.footer = ProductSearchSelectorFooter;\n\t\t\t\tparams.footerOptions = {\n\t\t\t\t\tinputName: this.inputName,\n\t\t\t\t\tallowEditItem: this.isAllowedEditProduct(),\n\t\t\t\t\tallowCreateItem: this.isAllowedCreateProduct(),\n\t\t\t\t\terrorAdminHint: settingsCollection.get('errorAdminHint'),\n\t\t\t\t\tcreationLabel: Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CREATE'),\n\t\t\t\t\tcurrentValue: this.getValue(),\n\t\t\t\t};\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tparams.searchOptions = { allowCreateItem: this.isAllowedCreateProduct() };\n\t\t\t}\n\n\t\t\treturn new Dialog(params);\n\t\t});\n\t}\n\n\tinitHasDialogItems()\n\t{\n\t\tif (!Type.isNil(this.selector.getConfig('EXIST_DIALOG_ITEMS')))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.selector.getModel().isEmpty())\n\t\t{\n\t\t\tthis.selector.setConfig('EXIST_DIALOG_ITEMS', true);\n\t\t\treturn;\n\t\t}\n\n\t\t// is null, that not send ajax\n\t\tthis.selector.setConfig('EXIST_DIALOG_ITEMS', false);\n\n\t\tconst dialog = this.getDialog();\n\t\tif (dialog.hasDynamicLoad())\n\t\t{\n\t\t\tthis.#loadPreselectedItems();\n\t\t\tdialog.subscribeOnce('onLoad', () => {\n\t\t\t\tif (dialog.getPreselectedItems().length > 1)\n\t\t\t\t{\n\t\t\t\t\tthis.selector.setConfig('EXIST_DIALOG_ITEMS', true);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.selector.setConfig('EXIST_DIALOG_ITEMS', true);\n\t\t}\n\t}\n\n\tisAllowedCreateProduct(): boolean\n\t{\n\t\treturn this.selector.getConfig('IS_ALLOWED_CREATION_PRODUCT', true) && this.selector.checkProductAddRights();\n\t}\n\n\tisAllowedEditProduct(): boolean\n\t{\n\t\treturn this.selector.checkProductEditRights();\n\t}\n\n\thandleNameInputKeyDown(event: KeyboardEvent): void\n\t{\n\t\tconst dialog = this.getDialog();\n\t\tif (event.key === 'Enter' && dialog.getActiveTab() === dialog.getSearchTab())\n\t\t{\n\t\t\t// prevent a form submit\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\n\t\t\tif ((Browser.isMac() && event.metaKey) || event.ctrlKey)\n\t\t\t{\n\t\t\t\tdialog.getSearchTab().getFooter().createItem();\n\t\t\t}\n\t\t}\n\t}\n\n\thandleIconsSwitchingOnNameInput(event: UIEvent): void\n\t{\n\t\tthis.toggleIcon(this.getArrowIcon(), 'none');\n\n\t\tif (Type.isStringFilled(event.target.value))\n\t\t{\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'block');\n\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\t\tif (this.isSearchEnabled())\n\t\t\t{\n\t\t\t\tthis.toggleIcon(this.getSearchIcon(), 'block');\n\t\t\t}\n\t\t}\n\t}\n\n\tclearInputCache()\n\t{\n\t\tthis.cache.delete('dialog');\n\t\tthis.cache.delete('nameBlock');\n\t\tthis.cache.delete('nameInput');\n\t\tthis.cache.delete('hiddenNameInput');\n\t}\n\n\thandleClearIconClick(event: UIEvent)\n\t{\n\t\tthis.selector.emit('onBeforeClear', {\n\t\t\tselectorId: this.selector.getId(),\n\t\t\trowId: this.selector.getRowId()\n\t\t});\n\n\t\tthis.loadedSelectedItem = null;\n\t\tif (this.selector.isProductSearchEnabled() && !this.model.isEmpty())\n\t\t{\n\t\t\tthis.selector.clearState();\n\t\t\tthis.selector.clearLayout();\n\t\t\tthis.selector.layout();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst newValue = '';\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\t\tthis.onChangeValue(newValue);\n\t\t}\n\n\t\tthis.selector.focusName();\n\n\t\tthis.selector.emit('onClear', {\n\t\t\tselectorId: this.selector.getId(),\n\t\t\trowId: this.selector.getRowId()\n\t\t});\n\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t}\n\n\thandleNameInputChange(event: UIEvent)\n\t{\n\t\tconst value = event.target.value;\n\t\tthis.onChangeValue(value);\n\t}\n\n\tonChangeValue(value: string)\n\t{\n\t\tconst fields = {};\n\t\tthis.getNameInput().title = value;\n\t\tthis.getNameInput().value = value;\n\t\tfields[this.inputName] = value;\n\t\tEventEmitter.emit('ProductSelector::onNameChange', {\n\t\t\trowId: this.selector.getRowId(),\n\t\t\tfields\n\t\t});\n\n\t\tif (!this.selector.isEnabledAutosave())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.selector.getModel().setFields(fields);\n\t\tthis.selector.getModel().save().then(() => {\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tid: 'saving_field_notify_name',\n\t\t\t\tcloseButton: false,\n\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_NAME')}</div>`,\n\t\t\t\tautoHide: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tfocusName()\n\t{\n\t\trequestAnimationFrame(() => this.getNameInput().focus());\n\t}\n\n\tsearchInDialog(): void\n\t{\n\t\tconst searchQuery = this.getFilledValue().trim();\n\t\tif (searchQuery === '')\n\t\t{\n\t\t\tif (this.isHasDialogItems === false)\n\t\t\t{\n\t\t\t\tthis.getDialog().hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.loadedSelectedItem = null;\n\t\t\tthis.#showPreselectedItems()\n\t\t\treturn;\n\t\t}\n\n\t\tthis.dialogMode = DialogMode.SEARCHING;\n\t\tthis.#searchItem(searchQuery);\n\t\tthis.isSearchingInProcess = true;\n\t}\n\n\t#showSelectedItem()\n\t{\n\t\tif (!this.selector.isProductSearchEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst dialog = this.getDialog();\n\t\tdialog.removeItems();\n\n\t\tnew Promise((resolve) => {\n\t\t\tif (!Type.isNil(this.loadedSelectedItem))\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdialog.showLoader();\n\t\t\tajax.runAction(\n\t\t\t\t'catalog.productSelector.getSkuSelectorItem',\n\t\t\t\t{\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tid: this.selector.getModel().getSkuId(),\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tiblockId: this.model.getIblockId(),\n\t\t\t\t\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\t\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tdialog.hideLoader();\n\t\t\t\t\tthis.loadedSelectedItem = null;\n\t\t\t\t\tif (Type.isObject(response.data) && !dialog.isLoading())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.loadedSelectedItem = dialog.addItem(response.data);\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tif (!Type.isNil(this.loadedSelectedItem))\n\t\t\t\t{\n\t\t\t\t\tdialog.setPreselectedItems([this.selector.getModel().getSkuId()]);\n\t\t\t\t\tdialog.getRecentTab().getRootNode().addItem(this.loadedSelectedItem);\n\t\t\t\t\tdialog.selectFirstTab();\n\t\t\t\t\tdialog.getFooter()?.hide();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.searchInDialog();\n\t\t\t\t}\n\t\t\t});\n\n\t\tdialog.getPopup().show();\n\t\tdialog.getFooter()?.hide();\n\t}\n\n\t#loadPreselectedItems()\n\t{\n\t\tconst dialog = this.getDialog();\n\t\tif (dialog.isLoading())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.loadedSelectedItem)\n\t\t{\n\t\t\tdialog.removeItems();\n\t\t\tdialog.loadState = 'UNSENT';\n\t\t\tthis.loadedSelectedItem = null;\n\t\t}\n\n\t\tdialog.load();\n\t}\n\n\t#showPreselectedItems()\n\t{\n\t\tif (!this.selector.isProductSearchEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.dialogMode = DialogMode.SHOW_RECENT;\n\t\tconst dialog = this.getDialog();\n\t\tthis.#loadPreselectedItems();\n\n\t\tdialog.selectFirstTab();\n\t\tdialog.getFooter()?.hide();\n\t\tdialog.show();\n\t}\n\n\t#searchItem(searchQuery: string = '')\n\t{\n\t\tif (!this.selector.isProductSearchEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst dialog = this.getDialog();\n\t\tdialog.getPopup().show();\n\t\tdialog.search(searchQuery);\n\t}\n\n\thandleClickNameInput(): void\n\t{\n\t\tconst dialog = this.getDialog();\n\n\t\tif (\n\t\t\tdialog.isOpen()\n\t\t\t|| (this.getFilledValue() === '' && this.isHasDialogItems === false)\n\t\t)\n\t\t{\n\t\t\tdialog.hide();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showItems();\n\t}\n\n\tshowItems()\n\t{\n\t\tif (this.getFilledValue() === '')\n\t\t{\n\t\t\tthis.#showPreselectedItems();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.model.isCatalogExisted() || this.dialogMode !== DialogMode.SHOW_PRODUCT_ITEM)\n\t\t{\n\t\t\tthis.searchInDialog();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#showSelectedItem();\n\t}\n\n\thandleNameInputBlur(event: UIEvent)\n\t{\n\t\t// timeout to toggle clear icon handler while cursor is inside of name input\n\t\tsetTimeout(() => {\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\n\t\t\tif (this.showDetailLink() && Type.isStringFilled(this.getValue()))\n\t\t\t{\n\t\t\t\tif (this.isSearchEnabled())\n\t\t\t\t{\n\t\t\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\t\t\t}\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'block');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'none');\n\t\t\t\tif (this.isSearchEnabled())\n\t\t\t\t{\n\t\t\t\t\tthis.toggleIcon(\n\t\t\t\t\t\tthis.getSearchIcon(),\n\t\t\t\t\t\tType.isStringFilled(this.getFilledValue()) ? 'none' : 'block'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}, 200);\n\n\t\tif (this.isSearchEnabled() && this.selector.isEnabledEmptyProductError())\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (\n\t\t\t\t\t!this.selector.inProcess()\n\t\t\t\t\t&& (\n\t\t\t\t\t\tthis.model.isEmpty()\n\t\t\t\t\t\t|| !Type.isStringFilled(this.getFilledValue())\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.model.getErrorCollection().setError(\n\t\t\t\t\t\tSelectorErrorCode.NOT_SELECTED_PRODUCT,\n\t\t\t\t\t\tthis.selector.getEmptySelectErrorMessage()\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.selector.layoutErrors();\n\t\t\t\t}\n\t\t\t}, 200);\n\t\t}\n\t}\n\n\thandleSearchIconClick(event: UIEvent)\n\t{\n\t\tthis.searchInDialog();\n\t\tthis.focusName();\n\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t}\n\n\tgetImmutableFieldNames(): []\n\t{\n\t\treturn this.immutableFieldNames;\n\t}\n\n\tsetInputValueOnProductSelect(item: Item)\n\t{\n\t\titem.getDialog().getTargetNode().value = item.getTitle()\n\t}\n\n\tonProductSelect(event)\n\t{\n\t\tconst item = event.getData().item;\n\t\tthis.setInputValueOnProductSelect(item);\n\n\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\tthis.clearErrors();\n\t\tif (this.selector)\n\t\t{\n\t\t\tconst isNew = item.getCustomData().get('isNew');\n\t\t\tconst immutableFields = [];\n\t\t\tthis.getImmutableFieldNames().forEach((key) => {\n\t\t\t\tif (!Type.isNil(item.getCustomData().get(key)))\n\t\t\t\t{\n\t\t\t\t\tthis.model.setField(key, item.getCustomData().get(key));\n\t\t\t\t\timmutableFields.push(key);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.selector.onProductSelect(\n\t\t\t\titem.getId(),\n\t\t\t\t\t{\n\t\t\t\t\t\tisNew,\n\t\t\t\t\t\timmutableFields,\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.selector.clearLayout();\n\t\t\tthis.selector.layout();\n\t\t}\n\n\t\tthis.dialogMode = DialogMode.SHOW_PRODUCT_ITEM;\n\t\tthis.loadedSelectedItem = item;\n\t\tthis.cache.delete('dialog');\n\t}\n\n\tclearErrors()\n\t{\n\t\tconst errors = this.model.getErrorCollection().getErrors();\n\t\tfor (const code in errors)\n\t\t{\n\t\t\tif (ProductSelector.ErrorCodes.getCodes().includes(code))\n\t\t\t{\n\t\t\t\tthis.model.getErrorCollection().removeError(code);\n\t\t\t}\n\t\t}\n\t}\n\n\tcreateProductModelFromSearchQuery(searchQuery: string): ProductModel\n\t{\n\t\tconst fields = {...this.selector.getModel().getFields()};\n\t\tfields[this.inputName] = searchQuery;\n\n\t\treturn new ProductModel({\n\t\t\tisSimpleModel: true,\n\t\t\tisNew: true,\n\t\t\tcurrency: this.selector.options.currency,\n\t\t\tiblockId: this.selector.getModel().getIblockId(),\n\t\t\tbasePriceId: this.selector.getModel().getBasePriceId(),\n\t\t\tfields\n\t\t})\n\t}\n\n\tcreateProduct(event): ?Promise\n\t{\n\t\tif (this.ajaxInProcess)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ajaxInProcess = true;\n\t\tconst dialog: Dialog = event.getTarget();\n\t\tconst {searchQuery} = event.getData();\n\t\tconst newProduct = this.createProductModelFromSearchQuery(searchQuery.getQuery());\n\n\t\tEventEmitter.emit(this.selector, 'onBeforeCreate', {model: newProduct});\n\n\t\treturn new Promise(\n\t\t\t(resolve, reject) => {\n\t\t\t\tif (!this.checkCreationModel(newProduct))\n\t\t\t\t{\n\t\t\t\t\tthis.ajaxInProcess = false;\n\t\t\t\t\tdialog.hide();\n\t\t\t\t\treject();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdialog.showLoader();\n\t\t\t\tnewProduct.save()\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tdialog.hideLoader();\n\t\t\t\t\t\tconst id = Text.toInteger(response.data.id);\n\t\t\t\t\t\tconst item = dialog.addItem({\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\tentityId: ProductSearchInput.SEARCH_TYPE_ID,\n\t\t\t\t\t\t\ttitle: searchQuery.getQuery(),\n\t\t\t\t\t\t\ttabs: dialog.getRecentTab().getId(),\n\t\t\t\t\t\t\tcustomData: {\n\t\t\t\t\t\t\t\tisNew: true,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.selector.getModel().setOption('isSimpleModel', false);\n\t\t\t\t\t\tthis.selector.getModel().setOption('isNew', true);\n\n\t\t\t\t\t\tthis.getImmutableFieldNames().forEach((name) => {\n\t\t\t\t\t\t\tthis.selector.getModel().setField(name, newProduct.getField(name));\n\t\t\t\t\t\t\tthis.selector.getModel().setOption(name, newProduct.getField(name));\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (item)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem.select();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t\tthis.cache.delete('dialog');\n\t\t\t\t\t\tthis.ajaxInProcess = false;\n\t\t\t\t\t\tthis.isHasDialogItems = true;\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((errorResponse) => {\n\t\t\t\t\t\tdialog.hideLoader();\n\t\t\t\t\t\terrorResponse.errors.forEach((error) => {\n\t\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\t\t\tcontent: Tag.render`<div>${error.message}</div>`,\n\t\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.ajaxInProcess = false;\n\t\t\t\t\t\treject();\n\t\t\t\t\t});\n\t\t\t});\n\t}\n\n\tcheckCreationModel(creationModel: ProductModel): boolean\n\t{\n\t\treturn true;\n\t}\n\n\tshowChangeNotification(event): void\n\t{\n\t\tconst {query} = event.getData();\n\t\tconst options = {\n\t\t\ttitle: Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_' + this.selector.getType()),\n\t\t\tevents: {\n\t\t\t\tonSave: () => {\n\t\t\t\t\tif (this.selector)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selector.getModel().setField(this.inputName, query);\n\t\t\t\t\t\tthis.selector.getModel().save([this.inputName])\n\t\t\t\t\t\t\t.catch((errorResponse) => {\n\t\t\t\t\t\t\t\terrorResponse.errors.forEach((error) => {\n\t\t\t\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\t\t\t\t\tcontent: Tag.render`<div>${error.message}</div>`,\n\t\t\t\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\n\t\tif (this.selector.getConfig('ROLLBACK_INPUT_AFTER_CANCEL', false))\n\t\t{\n\t\t\toptions.declineCancelTitle = Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_CANCEL_TITLE');\n\t\t\toptions.events.onCancel = () => {\n\t\t\t\tthis.selector.clearLayout();\n\t\t\t\tthis.selector.layout();\n\t\t\t};\n\t\t}\n\n\t\tthis.selector.getModel().showSaveNotifier(\n\t\t\t'nameChanger_' + this.selector.getId(),\n\t\t\toptions\n\t\t);\n\t}\n\n\tgetPlaceholder(): string\n\t{\n\t\treturn (\n\t\t\tthis.isSearchEnabled() && this.model.isEmpty()\n\t\t\t\t? Loc.getMessage('CATALOG_SELECTOR_BEFORE_SEARCH_TITLE')\n\t\t\t\t: Loc.getMessage('CATALOG_SELECTOR_VIEW_NAME_TITLE')\n\t\t);\n\t}\n\n\tremoveSpotlight()\n\t{\n\t}\n\n\tremoveQrAuth()\n\t{\n\t}\n}\n","import {Runtime, Tag, Text, Type, Dom} from 'main.core';\nimport './component.css';\nimport {ProductSelector} from 'catalog.product-selector';\n\nexport class ProductImageInput\n{\n\tconstructor(id, options = {})\n\t{\n\t\tthis.id = id || Text.getRandom();\n\t\tthis.selector = options.selector || null;\n\t\tif (!(this.selector instanceof ProductSelector))\n\t\t{\n\t\t\tthrow new Error('Product selector instance not found.');\n\t\t}\n\n\t\tthis.config = options.config || {};\n\n\t\tif (!Type.isStringFilled(this.selector.getModel()?.getImageCollection().getEditInput()))\n\t\t{\n\t\t\tthis.restoreDefaultInputHtml();\n\t\t}\n\n\t\tthis.enableSaving = options.enableSaving;\n\n\t\tthis.uploaderFieldMap = {};\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\tsetView(html): void\n\t{\n\t\tthis.selector.getModel()?.getImageCollection().setPreview(html);\n\t}\n\n\tsetInputHtml(html): void\n\t{\n\t\tthis.selector.getModel()?.getImageCollection().setEditInput(html);\n\t}\n\n\trestoreDefaultInputHtml(): void\n\t{\n\t\tconst defaultInput = `\n\t\t\t<div class='ui-image-input-container ui-image-input-img--disabled'>\n\t\t\t\t<div class='adm-fileinput-wrapper '>\n\t\t\t\t\t<div class='adm-fileinput-area mode-pict adm-fileinput-drag-area'></div>\n\t\t\t\t</div>\n\t\t\t</div>\n`\t\t;\n\n\t\tthis.selector.getModel()?.getImageCollection().setEditInput(defaultInput);\n\t\tthis.selector.getModel()?.getImageCollection().setPreview(defaultInput);\n\t}\n\n\tisViewMode(): boolean\n\t{\n\t\treturn this.selector && (this.selector.isViewMode() || !this.selector.model.isSaveable());\n\t}\n\n\tisEnabledLiveSaving(): boolean\n\t{\n\t\treturn this.enableSaving;\n\t}\n\n\tlayout(): HTMLElement\n\t{\n\t\tconst imageContainer = Tag.render`<div></div>`;\n\t\tconst html =\n\t\t\tthis.isViewMode()\n\t\t\t\t? this.selector.getModel()?.getImageCollection()?.getPreview()\n\t\t\t\t: this.selector.getModel()?.getImageCollection()?.getEditInput()\n\t\t;\n\n\t\tRuntime.html(imageContainer, html);\n\n\t\treturn imageContainer;\n\t}\n}","import {Loc, Tag, Dom, Type} from 'main.core';\nimport {BaseEvent} from \"main.core.events\";\nimport ProductSearchSelectorFooter from \"./product-search-selector-footer\";\n\nexport class BarcodeSearchSelectorFooter extends ProductSearchSelectorFooter\n{\n\tconstructor(id, options = {})\n\t{\n\t\tsuper(id, options);\n\t\tthis.isEmptyBarcode = options.isEmptyBarcode;\n\t\tthis.getDialog().subscribe('SearchTab:onLoad', this.handleOnSearchLoad.bind(this));\n\t}\n\n\tgetContent(): HTMLElement\n\t{\n\t\tthis.barcodeContent = super.getContent();\n\t\tthis.scannerContent = this.getScannerContent();\n\t\tDom.style(this.barcodeContent, 'display', 'none');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"catalog-footers-container\">\n\t\t\t\t${this.barcodeContent}\n\t\t\t\t${this.scannerContent}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tisViewEditButton(): boolean\n\t{\n\t\treturn !this.isEmptyBarcode && super.isViewEditButton();\n\t}\n\n\tgetScannerContent(): HTMLElement\n\t{\n\t\tconst phrase = Tag.render`\n\t\t\t<div>${Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_BARCODE')}</div>\n\t\t`;\n\n\t\tconst createButton = phrase.querySelector('create-button');\n\n\t\tDom.replace(createButton, this.getScannerLabelContainer());\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-selector-search-footer-box\">\n\t\t\t\t${phrase}\n\t\t\t\t${this.getLoaderContainer()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetScannerLabelContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('scannerLabel', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span onclick=\"${this.handleScannerClick.bind(this)}\">\n\t\t\t\t\t<span class=\"ui-selector-footer-link ui-selector-footer-link-add footer-link--warehouse-barcode-icon\">\n\t\t\t\t\t\t${Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_BARCODE_START_SCAN_LABEL')}\n\t\t\t\t\t</span>\n\t\t\t\t\t${this.getScannerQueryContainer()}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetScannerQueryContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('scanner_name-container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"ui-selector-search-footer-query\"></span>\n\t\t\t`;\n\t\t});\n\t}\n\n\thandleScannerClick(): void\n\t{\n\t\tconst inputEntity = this.options?.inputEntity;\n\t\tif (inputEntity)\n\t\t{\n\t\t\tinputEntity.startMobileScanner();\n\t\t}\n\t}\n\n\thandleOnSearch(event: BaseEvent): void\n\t{\n\t\tconst { query } = event.getData();\n\n\t\tif (!Type.isStringFilled(query))\n\t\t{\n\t\t\tthis.show();\n\t\t\tDom.style(this.scannerContent, 'display', '');\n\t\t\tDom.style(this.barcodeContent, 'display', 'none');\n\t\t}\n\t\telse if (this.options.currentValue === query)\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.show();\n\t\t\tDom.style(this.barcodeContent, 'display', '');\n\t\t\tDom.style(this.scannerContent, 'display', 'none');\n\t\t}\n\n\t\tthis.getQueryContainer().textContent = \" \" + query;\n\t\tthis.getScannerQueryContainer().textContent = \" \" + query;\n\t}\n\n\thandleOnSearchLoad(event: BaseEvent): void\n\t{\n\t\tconst {searchTab} = event.getData();\n\t\tthis.getDialog().getItems().forEach(item => {\n\t\t\tif (item.getCustomData().get('BARCODE') === searchTab.getLastSearchQuery().getQuery())\n\t\t\t{\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t});\n\t}\n}","import {Extension, Loc, Tag, Type, Text, Dom, Event, userOptions, ajax} from 'main.core';\nimport {Dialog, Item} from 'ui.entity-selector';\nimport './component.css';\nimport {EventEmitter} from 'main.core.events';\nimport {ProductModel} from 'catalog.product-model';\nimport ProductCreationLimitedFooter from './product-creation-limited-footer';\nimport {ProductSearchInput} from './product-search-input';\nimport {ProductSelector} from 'catalog.product-selector';\nimport {BarcodeScanner} from 'catalog.barcode-scanner';\nimport 'ui.notification';\nimport {BarcodeSearchSelectorFooter} from './barcode-search-selector-footer';\nimport {QrAuthorization} from 'ui.qrauthorization';\nimport {SelectorErrorCode} from './selector-error-code';\nimport 'spotlight';\nimport {Guide} from 'ui.tour';\n\nexport class BarcodeSearchInput extends ProductSearchInput\n{\n\tstatic SEARCH_TYPE_ID = 'barcode';\n\n\tonFocusHandler = this.handleFocusEvent.bind(this);\n\tonBlurHandler = this.handleBlurEvent.bind(this);\n\n\tconstructor(id, options = {})\n\t{\n\t\tsuper(id, options);\n\n\t\tthis.focused = false;\n\t\tthis.settingsCollection = Extension.getSettings('catalog.product-selector');\n\n\t\tthis.isInstalledMobileApp =\n\t\t\tthis.selector.getConfig('IS_INSTALLED_MOBILE_APP')\n\t\t\t|| this.settingsCollection.get('isInstallMobileApp')\n\t\t;\n\n\t\tif (\n\t\t\t!this.settingsCollection.get('isEnabledQrAuth')\n\t\t\t&& this.selector.getConfig('ENABLE_BARCODE_QR_AUTH', true)\n\t\t)\n\t\t{\n\t\t\tthis.qrAuth = new QrAuthorization();\n\t\t\tthis.qrAuth.createQrCodeImage();\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tEvent.unbind(this.getNameInput(), 'focus', this.onFocusHandler);\n\t\tEvent.unbind(this.getNameInput(), 'blur', this.onBlurHandler);\n\t}\n\n\thandleFocusEvent()\n\t{\n\t\tthis.focused = true;\n\t}\n\n\thandleBlurEvent()\n\t{\n\t\tthis.focused = false;\n\t}\n\n\tisSearchEnabled(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\tshowDetailLink(): boolean\n\t{\n\t\treturn false\n\t}\n\n\tgetNameBlock(): HTMLElement\n\t{\n\t\treturn this.cache.remember('nameBlock', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t${this.getNameInput()}\n\t\t\t\t\t${this.getHiddenNameInput()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetDialog(): ?Dialog\n\t{\n\t\treturn this.cache.remember('dialog', () => {\n\t\t\tconst entity = {\n\t\t\t\tid: BarcodeSearchInput.SEARCH_TYPE_ID,\n\t\t\t\toptions: {\n\t\t\t\t\tiblockId: this.model.getIblockId(),\n\t\t\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\t},\n\t\t\t\tdynamicLoad: true,\n\t\t\t\tdynamicSearch: true,\n\t\t\t\tsearchFields: [\n\t\t\t\t\t{ name: 'title', type: 'string', system: true, searchable: false },\n\t\t\t\t],\n\t\t\t};\n\n\t\t\tconst restrictedProductTypes = this.selector.getConfig('RESTRICTED_PRODUCT_TYPES', null);\n\t\t\tif (!Type.isNil(restrictedProductTypes))\n\t\t\t{\n\t\t\t\tentity.options.restrictedProductTypes = restrictedProductTypes;\n\t\t\t}\n\n\t\t\tconst params = {\n\t\t\t\tid: this.id + '_' + BarcodeSearchInput.SEARCH_TYPE_ID,\n\t\t\t\theight: 300,\n\t\t\t\twidth: Math.max(this.getNameInput()?.offsetWidth, 565),\n\t\t\t\tcontext: null,\n\t\t\t\ttargetNode: this.getNameInput(),\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tsearchTabOptions: {\n\t\t\t\t\tstub: true,\n\t\t\t\t\tstubOptions: {\n\t\t\t\t\t\ttitle: Tag.message`${'CATALOG_SELECTOR_IS_EMPTY_TITLE'}`,\n\t\t\t\t\t\tsubtitle:\n\t\t\t\t\t\t\tthis.isAllowedCreateProduct()\n\t\t\t\t\t\t\t\t? Tag.message`${'CATALOG_SELECTOR_IS_EMPTY_SUBTITLE'}`\n\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t,\n\t\t\t\t\t\tarrow: true\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.onProductSelect.bind(this),\n\t\t\t\t\t'Search:onItemCreateAsync': this.createProduct.bind(this),\n\t\t\t\t\t'ChangeItem:onClick': this.showChangeNotification.bind(this),\n\t\t\t\t},\n\t\t\t\tentities: [entity]\n\t\t\t};\n\n\t\t\tif (this.model.getSkuId() && !Type.isStringFilled(this.model.getField(this.inputName)))\n\t\t\t{\n\t\t\t\tparams.preselectedItems = [[BarcodeSearchInput.SEARCH_TYPE_ID, this.model.getSkuId()]];\n\t\t\t}\n\n\t\t\tif (Type.isObject(this.settingsCollection.get('limitInfo')))\n\t\t\t{\n\t\t\t\tparams.footer = ProductCreationLimitedFooter;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tparams.footer = BarcodeSearchSelectorFooter;\n\t\t\t\tparams.footerOptions = {\n\t\t\t\t\tinputEntity: this,\n\t\t\t\t\tisEmptyBarcode: !this.model || !this.model.isCatalogExisted(),\n\t\t\t\t\tinputName: this.inputName,\n\t\t\t\t\terrorAdminHint: this.settingsCollection.get('errorAdminHint'),\n\t\t\t\t\tallowEditItem: this.isAllowedEditProduct(),\n\t\t\t\t\tallowCreateItem: this.isAllowedCreateProduct(),\n\t\t\t\t\tcreationLabel: Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CREATE_WITH_BARCODE'),\n\t\t\t\t\tcurrentValue: this.getValue(),\n\t\t\t\t\tsearchOptions: {\n\t\t\t\t\t\tallowCreateItem: this.isAllowedCreateProduct(),\n\t\t\t\t\t\tfooterOptions: {\n\t\t\t\t\t\t\tlabel: Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CREATE_WITH_BARCODE')\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn new Dialog(params);\n\t\t});\n\t}\n\n\tlayoutMobileQrPopup(): HTMLElement\n\t{\n\t\treturn this.cache.remember('qrMobilePopup', () => {\n\n\t\t\tconst closeIcon = Tag.render`<span class=\"popup-window-close-icon\"></span>`;\n\t\t\tEvent.bind(closeIcon, 'click', this.closeMobilePopup.bind(this));\n\n\t\t\tlet sendButton = '';\n\t\t\tlet helpButton = '';\n\t\t\tif (top.BX.Helper)\n\t\t\t{\n\t\t\t\thelpButton = Tag.render`\n\t\t\t\t\t<a class=\"product-selector-mobile-popup-link ui-btn ui-btn-light-border ui-btn-round\">\n\t\t\t\t\t\t${Loc.getMessage('CATALOG_SELECTOR_MOBILE_POPUP_HELP_BUTTON')}\n\t\t\t\t\t</a>\n\t\t\t\t`;\n\t\t\t\tEvent.bind(helpButton, 'click', () => {\n\t\t\t\t\ttop.BX.Helper.show(\"redirect=detail&code=14956818\");\n\t\t\t\t});\n\n\t\t\t\tsendButton = Tag.render`\n\t\t\t\t\t<a class=\"product-selector-mobile-popup-link ui-btn ui-btn-link\">\n\t\t\t\t\t\t${Loc.getMessage('CATALOG_SELECTOR_MOBILE_POPUP_SEND_PUSH_BUTTON')}\n\t\t\t\t\t</a>\n\t\t\t\t`;\n\n\t\t\t\tEvent.bind(sendButton, 'click', () => {\n\t\t\t\t\ttop.BX.Helper.show(\"redirect=detail&code=15042444\");\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div data-role=\"mobile-popup\">\n\t\t\t\t\t<div class=\"product-selector-mobile-popup-overlay\"></div>\n\t\t\t\t\t<div class=\"product-selector-mobile-popup-content\">\n\t\t\t\t\t\t<div class=\"product-selector-mobile-popup-title\">${Loc.getMessage('CATALOG_SELECTOR_MOBILE_POPUP_TITLE')}</div>\n\t\t\t\t\t\t<div class=\"product-selector-mobile-popup-text\">${Loc.getMessage('CATALOG_SELECTOR_MOBILE_POPUP_INSTRUCTION')}</div>\n\t\t\t\t\t\t<div class=\"product-selector-mobile-popup-qr\">\n\t\t\t\t\t\t\t${this.qrAuth.getQrNode()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"product-selector-mobile-popup-link-container\">\n\t\t\t\t\t\t\t${helpButton}\n\t\t\t\t\t\t\t${sendButton}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${closeIcon}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tcloseMobilePopup()\n\t{\n\t\tthis.removeQrAuth();\n\n\t\tajax\n\t\t\t.runAction(\n\t\t\t\t'catalog.ProductSelector.isInstalledMobileApp',\n\t\t\t\t{\n\t\t\t\t\tjson: {}\n\t\t\t\t}\n\t\t\t)\n\t\t\t.then((result) => {\n\t\t\t\tthis.selector.emit('onBarcodeQrClose', {});\n\n\t\t\t\tif (result.data === true)\n\t\t\t\t{\n\t\t\t\t\tthis.selector.emit('onBarcodeScannerInstallChecked', {});\n\t\t\t\t\tthis.isInstalledMobileApp = true;\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\tuserOptions.save('product-selector', 'barcodeQrAuth', 'showed', 'Y');\n\t}\n\n\thandleClickNameInput(event: UIEvent)\n\t{\n\t\tif (this.qrAuth && this.getDialog().getContainer())\n\t\t{\n\t\t\tif (!Dom.hasClass(this.getDialog().getContainer(), 'qr-barcode-info'))\n\t\t\t{\n\t\t\t\tDom.addClass(this.getDialog().getContainer(),'qr-barcode-info');\n\t\t\t}\n\n\t\t\tif (this.getDialog().getContainer())\n\t\t\t{\n\t\t\t\tDom.append(this.layoutMobileQrPopup(), this.getDialog().getContainer());\n\t\t\t}\n\t\t}\n\n\t\tsuper.handleClickNameInput(event);\n\t}\n\n\tshowItems()\n\t{\n\t\tthis.searchInDialog();\n\t}\n\n\tonChangeValue(value: string)\n\t{\n\t\tconst fields = {};\n\n\t\tthis.getNameInput().title = value;\n\t\tthis.getNameInput().value = value;\n\n\t\tfields[this.inputName] = value;\n\n\t\tEventEmitter.emit('ProductSelector::onBarcodeChange', {\n\t\t\trowId: this.selector.getRowId(),\n\t\t\tfields\n\t\t});\n\n\t\tthis.selector.emit('onBarcodeChange', {value});\n\n\t\tif (this.selector.isEnabledAutosave())\n\t\t{\n\t\t\tthis.selector.getModel().setField(this.inputName, value);\n\t\t\tthis.selector.getModel().showSaveNotifier(\n\t\t\t\t'barcodeChanger_' + this.selector.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_BARCODE'),\n\t\t\t\t\tdisableCancel: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tif (this.selector)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.selector.getModel().save([this.inputName]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tsearchInDialog(): void\n\t{\n\t\tconst searchQuery = this.getFilledValue().trim();\n\t\tthis.searchByBarcode(searchQuery);\n\t}\n\n\tsearchByBarcode(searchQuery: string = ''): void\n\t{\n\t\tif (!this.selector.isProductSearchEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst dialog = this.getDialog();\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdialog.removeItems();\n\t\tif (!Type.isStringFilled(searchQuery))\n\t\t{\n\t\t\tif (this.model && this.model.isCatalogExisted())\n\t\t\t{\n\t\t\t\tdialog.setPreselectedItems([[BarcodeSearchInput.SEARCH_TYPE_ID, this.model.getSkuId()]])\n\t\t\t\tdialog.loadState = 'UNSENT';\n\t\t\t\tdialog.load();\n\t\t\t}\n\t\t}\n\n\t\tdialog.show();\n\t\tdialog.search(searchQuery);\n\t}\n\n\thandleNameInputBlur(event: UIEvent)\n\t{\n\t\t// timeout to toggle clear icon handler while cursor is inside of name input\n\t\tsetTimeout(() => {\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\n\t\t\tif (this.showDetailLink() && Type.isStringFilled(this.getValue()))\n\t\t\t{\n\t\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'block');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'none');\n\t\t\t\tthis.toggleIcon(\n\t\t\t\t\tthis.getSearchIcon(),\n\t\t\t\t\tType.isStringFilled(this.getFilledValue()) ? 'none' : 'block'\n\t\t\t\t);\n\t\t\t}\n\t\t}, 200);\n\t}\n\n\tsetInputValueOnProductSelect(item: Item)\n\t{\n\t\titem.getDialog().getTargetNode().value = item.getSubtitle()\n\t}\n\n\tgetCreationProduct(name)\n\t{\n\t\tconst fields = {...this.selector.getModel().getFields()};\n\t\tfields[ProductSelector.INPUT_FIELD_NAME] = name;\n\n\t\treturn new ProductModel({\n\t\t\tisSimpleModel: true,\n\t\t\tisNew: true,\n\t\t\tcurrency: this.selector.options.currency,\n\t\t\tiblockId: this.selector.getModel().getIblockId(),\n\t\t\tbasePriceId: this.selector.getModel().getBasePriceId(),\n\t\t\tfields\n\t\t})\n\t}\n\n\tcreateProductModelFromSearchQuery(searchQuery: string)\n\t{\n\t\tconst model = super.createProductModelFromSearchQuery(searchQuery);\n\t\tmodel.setField(ProductSelector.INPUT_FIELD_NAME, Loc.getMessage('CATALOG_SELECTOR_NEW_BARCODE_PRODUCT_NAME'));\n\t\tmodel.setField(this.inputName, searchQuery);\n\n\t\treturn model;\n\t}\n\n\tcheckCreationModel(creationModel: ProductModel): boolean\n\t{\n\t\tif (!Type.isStringFilled(creationModel.getField(ProductSelector.INPUT_FIELD_NAME)))\n\t\t{\n\t\t\tthis.model.getErrorCollection().setError(\n\t\t\t\tSelectorErrorCode.NOT_SELECTED_PRODUCT,\n\t\t\t\tLoc.getMessage('CATALOG_SELECTOR_EMPTY_TITLE')\n\t\t\t);\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetPlaceholder(): string\n\t{\n\t\treturn (\n\t\t\tthis.isSearchEnabled() && this.model.isEmpty()\n\t\t\t\t? Loc.getMessage('CATALOG_SELECTOR_BEFORE_SEARCH_BARCODE_TITLE')\n\t\t\t\t: Loc.getMessage('CATALOG_SELECTOR_VIEW_BARCODE_TITLE')\n\t\t);\n\t}\n\n\thandleClearIconClick(event: UIEvent)\n\t{\n\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\tthis.onChangeValue('');\n\n\t\tthis.selector.focusName();\n\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t}\n\n\tstartMobileScanner(event)\n\t{\n\t\tif (this.isInstalledMobileApp)\n\t\t{\n\t\t\tthis.sendMobilePush(event);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.qrAuth)\n\t\t{\n\t\t\tthis.qrAuth = new QrAuthorization();\n\t\t\tthis.qrAuth.createQrCodeImage();\n\t\t}\n\n\t\tif (this.getDialog().isOpen())\n\t\t{\n\t\t\tthis.getDialog().hide();\n\t\t\tthis.getDialog().subscribeOnce('onHide', this.handleClickNameInput.bind(this));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.handleClickNameInput(event);\n\t\t}\n\t}\n\n\tsendMobilePush(event)\n\t{\n\t\tevent?.preventDefault();\n\t\tthis.getDialog().hide();\n\t\tthis.getNameInput().focus();\n\n\t\tif (!this.selector.isEnabledMobileScanning())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst token = this.selector.getMobileScannerToken();\n\t\tBarcodeScanner.open(token);\n\n\t\tconst repeatLink = Tag.render`<span class='ui-notification-balloon-action'>${Loc.getMessage('CATALOG_SELECTOR_SEND_PUSH_ON_SCANNER_NOTIFICATION_REPEAT')}</span>`;\n\t\tEvent.bind(repeatLink, 'click', this.sendMobilePush.bind(this));\n\n\t\tconst content = Tag.render`\n\t\t\t<div>\n\t\t\t\t<span>${Loc.getMessage('CATALOG_SELECTOR_SEND_PUSH_ON_SCANNER_NOTIFICATION')}</span>\n\t\t\t\t${repeatLink}\n\t\t\t</div>\n\t\t`;\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent,\n\t\t\tcategory: 'sending_push_barcode_scanner_notification',\n\t\t\tautoHideDelay: 5000,\n\t\t});\n\t}\n\n\tgetProductIdByBarcode(barcode)\n\t{\n\t\treturn ajax.runAction(\n\t\t\t'catalog.ProductSelector.getProductIdByBarcode',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\tbarcode: barcode,\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t}\n\n\tapplyScannerData(barcode)\n\t{\n\t\tthis.getProductIdByBarcode(barcode).then((response) => {\n\t\t\tconst productId = response?.data;\n\t\t\tif (productId)\n\t\t\t{\n\t\t\t\tthis.selectScannedBarcodeProduct(productId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.searchByBarcode(barcode);\n\t\t\t}\n\t\t\tthis.getNameInput().value = Text.encode(barcode);\n\t\t});\n\t}\n\n\tselectScannedBarcodeProduct(productId)\n\t{\n\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\tthis.clearErrors();\n\t\tif (this.selector)\n\t\t{\n\t\t\tthis.selector.onProductSelect(\n\t\t\t\tproductId,\n\t\t\t\t{\n\t\t\t\t\tisNew: false,\n\t\t\t\t\timmutableFields: [],\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.selector.clearLayout();\n\t\t\tthis.selector.layout();\n\t\t}\n\n\t\tthis.cache.delete('dialog');\n\t}\n\n\tgetBarcodeIcon(): HTMLElement\n\t{\n\t\treturn this.cache.remember('barcodeIcon', () => {\n\t\t\tconst barcodeIcon = Tag.render`\n\t\t\t\t<button\tclass=\"ui-ctl-before warehouse-barcode-icon\" title=\"${Loc.getMessage('CATALOG_SELECTOR_BARCODE_ICON_TITLE')}\"></button>\n\t\t\t`;\n\n\t\t\tif (\n\t\t\t\t!this.settingsCollection.get('isShowedBarcodeSpotlightInfo')\n\t\t\t\t&& this.settingsCollection.get('isAllowedShowBarcodeSpotlightInfo')\n\t\t\t\t&& this.selector.getConfig('ENABLE_INFO_SPOTLIGHT', true)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.spotlight = new BX.SpotLight(\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'selector_barcode_scanner_info',\n\t\t\t\t\t\ttargetElement: barcodeIcon,\n\t\t\t\t\t\tautoSave: true,\n\t\t\t\t\t\ttargetVertex: \"middle-center\",\n\t\t\t\t\t\tzIndex: 200\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tthis.spotlight.show();\n\n\t\t\t\tEventEmitter.subscribe(this.spotlight, 'BX.SpotLight:onTargetEnter', () => {\n\t\t\t\t\tconst guide = new Guide({\n\t\t\t\t\t\tsteps: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttarget: barcodeIcon,\n\t\t\t\t\t\t\t\ttitle: Loc.getMessage('CATALOG_SELECTOR_BARCODE_SCANNER_FIRST_TIME_HINT_TITLE'),\n\t\t\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_SELECTOR_BARCODE_SCANNER_FIRST_TIME_HINT_TEXT'),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t\tonEvents: true,\n\t\t\t\t\t});\n\n\t\t\t\t\tguide.getPopup().setAutoHide(true);\n\t\t\t\t\tguide.showNextStep();\n\t\t\t\t\tthis.selector.setConfig('ENABLE_INFO_SPOTLIGHT', false);\n\t\t\t\t\tthis.selector.emit('onSpotlightClose', {});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tEvent.bind(barcodeIcon, 'click', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif (this.qrAuth)\n\t\t\t\t{\n\t\t\t\t\tthis.handleClickNameInput(event);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.startMobileScanner(event);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn barcodeIcon;\n\t\t});\n\t}\n\n\tlayout(): HTMLElement\n\t{\n\t\tconst block = super.layout();\n\t\tDom.append(this.getBarcodeIcon(), block);\n\t\tthis.getNameInput().className += ' catalog-product-field-input-barcode';\n\t\tEvent.bind(this.getNameInput(), 'focus', this.onFocusHandler);\n\t\tEvent.bind(this.getNameInput(), 'blur', this.onBlurHandler);\n\n\t\treturn block;\n\t}\n\n\tremoveSpotlight()\n\t{\n\t\tif (this.spotlight)\n\t\t{\n\t\t\tthis.spotlight.close();\n\t\t}\n\t}\n\n\tremoveQrAuth()\n\t{\n\t\tconst mobilePopup = this.getDialog().getContainer()?.querySelector('[data-role=\"mobile-popup\"]');\n\t\tif (mobilePopup)\n\t\t{\n\t\t\tDom.remove(mobilePopup);\n\t\t\tif (Dom.hasClass(this.getDialog().getContainer(), 'qr-barcode-info'))\n\t\t\t{\n\t\t\t\tDom.removeClass(this.getDialog().getContainer(),'qr-barcode-info');\n\t\t\t}\n\t\t}\n\n\t\tthis.qrAuth = null;\n\t}\n}\n","import {ajax, Cache, Dom, Event, Extension, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport 'ui.design-tokens';\nimport 'ui.forms';\nimport 'fileinput';\nimport 'ui.notification';\nimport {EventEmitter} from 'main.core.events';\nimport {SkuTree} from 'catalog.sku-tree';\nimport {ProductSearchInput} from \"./product-search-input\";\nimport {ProductImageInput} from \"./product-image-input\";\nimport {ProductModel, RightActionDictionary} from \"catalog.product-model\";\nimport './component.css';\nimport {BarcodeSearchInput} from \"./barcode-search-input\";\nimport {SelectorErrorCode} from \"./selector-error-code\";\n\nconst instances = new Map();\nconst iblockSkuTreeProperties = new Map();\n\nexport class ProductSelector extends EventEmitter\n{\n\tstatic MODE_VIEW = 'view';\n\tstatic MODE_EDIT = 'edit';\n\tstatic SHORT_VIEW_FORMAT = 'short';\n\tstatic FULL_VIEW_FORMAT = 'full';\n\tstatic INPUT_FIELD_NAME = 'NAME';\n\tstatic INPUT_FIELD_BARCODE = 'BARCODE';\n\n\tstatic ErrorCodes = SelectorErrorCode;\n\tstatic UIInputRequest = null;\n\t#inAjaxProcess = false;\n\tmode: ProductSelector.MODE_EDIT | ProductSelector.MODE_VIEW = ProductSelector.MODE_EDIT;\n\tcache = new Cache.MemoryCache();\n\ttype = ProductSelector.INPUT_FIELD_NAME;\n\tfileInput: ?ProductImageInput;\n\tsearchInput: ?ProductSearchInput;\n\tskuTreeInstance: ?SkuTree;\n\tmobileScannerToken = null;\n\n\tvariationChangeHandler = this.handleVariationChange.bind(this);\n\tonSaveImageHandler = this.onSaveImage.bind(this);\n\tonChangeFieldsHandler = Runtime.debounce(this.onChangeFields, 500, this);\n\tonUploaderIsInitedHandler = this.onUploaderIsInited.bind(this);\n\tonNameChangeFieldHandler = Runtime.debounce(this.onNameChange, 500, this);\n\n\tstatic getById(id: string): ?ProductSelector\n\t{\n\t\treturn instances.get(id) || null;\n\t}\n\n\tconstructor(id, options = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Catalog.ProductSelector');\n\n\t\tthis.id = id || Text.getRandom();\n\t\toptions.inputFieldName = options.inputFieldName || ProductSelector.INPUT_FIELD_NAME;\n\t\tthis.options = options || {};\n\t\tthis.settings = Extension.getSettings('catalog.product-selector');\n\n\t\tthis.type = this.options.type || ProductSelector.INPUT_FIELD_NAME;\n\n\t\tthis.setMode(options.mode);\n\n\t\tif (options.model && (options.model instanceof ProductModel))\n\t\t{\n\t\t\tthis.model = options.model;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.model = ProductModel.getById(this.id);\n\t\t}\n\n\t\tif (!(this.model instanceof ProductModel))\n\t\t{\n\t\t\tthis.model = new ProductModel(\n\t\t\t\t{\n\t\t\t\t\tcurrency: options.currency,\n\t\t\t\t\tiblockId: Text.toNumber(options.iblockId),\n\t\t\t\t\tbasePriceId: Text.toNumber(options.basePriceId),\n\t\t\t\t\tfields: options.fields,\n\t\t\t\t\tskuTree: options.skuTree,\n\t\t\t\t\tstoreMap: options.storeMap,\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.model.getImageCollection().setMorePhotoValues(options.morePhotoValues);\n\t\tif (!Type.isNil(this.getConfig('DETAIL_PATH')))\n\t\t{\n\t\t\tthis.model.setDetailPath(this.getConfig('DETAIL_PATH'));\n\t\t}\n\n\t\tif (options.failedProduct)\n\t\t{\n\t\t\tthis.model.getErrorCollection().setError(\n\t\t\t\tSelectorErrorCode.FAILED_PRODUCT,\n\t\t\t\t''\n\t\t\t);\n\t\t}\n\n\t\tif (this.isShowableEmptyProductError())\n\t\t{\n\t\t\tthis.model.getErrorCollection().setError(\n\t\t\t\tSelectorErrorCode.NOT_SELECTED_PRODUCT,\n\t\t\t\tthis.getEmptySelectErrorMessage()\n\t\t\t);\n\t\t}\n\n\t\tif (options.fileView)\n\t\t{\n\t\t\tthis.model.getImageCollection().setPreview(options.fileView);\n\t\t}\n\t\tif (options.fileInput)\n\t\t{\n\t\t\tthis.model.getImageCollection().setEditInput(options.fileInput);\n\t\t}\n\n\t\tthis.layout();\n\n\t\tif (options.skuTree)\n\t\t{\n\t\t\tthis.updateSkuTree(options.skuTree);\n\t\t}\n\n\t\tif (options.scannerToken)\n\t\t{\n\t\t\tthis.setMobileScannerToken(options.scannerToken);\n\t\t}\n\n\t\tthis.subscribeEvents();\n\n\t\tinstances.set(this.id, this);\n\t}\n\n\tsetModel(model: ProductModel): void\n\t{\n\t\tthis.model = model;\n\t}\n\n\tgetModel(): ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\tsetMode(mode: ProductSelector.MODE_VIEW | ProductSelector.MODE_EDIT ): void\n\t{\n\t\tif (!Type.isNil(mode))\n\t\t{\n\t\t\tthis.mode = mode === ProductSelector.MODE_VIEW ? ProductSelector.MODE_VIEW : ProductSelector.MODE_EDIT;\n\t\t}\n\t}\n\n\tisViewMode(): boolean\n\t{\n\t\treturn this.mode === ProductSelector.MODE_VIEW;\n\t}\n\n\tisShortViewFormat(): boolean\n\t{\n\t\treturn this.getConfig('VIEW_FORMAT', ProductSelector.FULL_VIEW_FORMAT) === ProductSelector.SHORT_VIEW_FORMAT;\n\t}\n\n\tisSaveable(): boolean\n\t{\n\t\treturn !this.isViewMode() && this.model.isSaveable();\n\t}\n\n\tisEnabledAutosave(): boolean\n\t{\n\t\treturn this.isSaveable() && this.getConfig('ENABLE_AUTO_SAVE', false);\n\t}\n\n\tisEnabledMobileScanning(): boolean\n\t{\n\t\treturn !this.isViewMode() && this.getConfig('ENABLE_MOBILE_SCANNING', true);\n\t}\n\n\tgetEmptySelectErrorMessage()\n\t{\n\t\treturn this.checkProductAddRights()\n\t\t\t? Loc.getMessage('CATALOG_SELECTOR_SELECTED_PRODUCT_TITLE')\n\t\t\t: Loc.getMessage('CATALOG_SELECTOR_SELECT_PRODUCT_TITLE')\n\t\t;\n\t}\n\n\n\tgetMobileScannerToken(): string\n\t{\n\t\treturn this.mobileScannerToken || Text.getRandom(16);\n\t}\n\n\tcheckProductViewRights(): boolean\n\t{\n\t\treturn this.model.checkAccess(RightActionDictionary.ACTION_PRODUCT_VIEW) ?? true;\n\t}\n\n\tcheckProductEditRights(): boolean\n\t{\n\t\treturn this.model.checkAccess(RightActionDictionary.ACTION_PRODUCT_EDIT) ?? false;\n\t}\n\n\tcheckProductAddRights(): boolean\n\t{\n\t\treturn this.model.checkAccess(RightActionDictionary.ACTION_PRODUCT_ADD) ?? false;\n\t}\n\n\tsetMobileScannerToken(token: string): void\n\t{\n\t\tthis.mobileScannerToken = token;\n\t}\n\n\tremoveMobileScannerToken(): void\n\t{\n\t\tthis.mobileScannerToken = null;\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetType(): string\n\t{\n\t\treturn this.type;\n\t}\n\n\tgetConfig(name, defaultValue)\n\t{\n\t\treturn BX.prop.get(this.options.config, name, defaultValue);\n\t}\n\n\tsetConfig(name, value): this\n\t{\n\t\tthis.options.config[name] = value;\n\n\t\treturn this;\n\t}\n\n\tgetRowId(): string\n\t{\n\t\treturn this.getConfig('ROW_ID');\n\t}\n\n\tgetFileInput(): ProductImageInput\n\t{\n\t\tif (!this.fileInput)\n\t\t{\n\t\t\tthis.fileInput = new ProductImageInput(\n\t\t\t\tthis.options.fileInputId,\n\t\t\t\t{\n\t\t\t\t\tselector: this,\n\t\t\t\t\tenableSaving: this.getConfig('ENABLE_IMAGE_CHANGE_SAVING', false)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn this.fileInput;\n\t}\n\n\tisProductSearchEnabled(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_SEARCH', false)\n\t\t\t&& this.model.getIblockId() > 0\n\t\t\t&& this.checkProductViewRights()\n\t\t;\n\t}\n\n\tisSkuTreeEnabled(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_SKU_TREE', true) !== false;\n\t}\n\n\tisImageFieldEnabled(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_IMAGE_INPUT', true) !== false;\n\t}\n\n\tisShowableEmptyProductError(): boolean\n\t{\n\t\treturn this.isEnabledEmptyProductError() &&\n\t\t\t(\n\t\t\t\tthis.model.isEmpty() && this.model.isChanged()\n\t\t\t\t|| this.model.isSimple()\n\t\t\t);\n\t}\n\n\tisShowableErrors(): boolean\n\t{\n\t\treturn this.isEnabledEmptyProductError() || this.isEnabledEmptyImagesError();\n\t}\n\n\tisEnabledEmptyProductError(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_EMPTY_PRODUCT_ERROR', false);\n\t}\n\n\tisEnabledEmptyImagesError(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_EMPTY_IMAGES_ERROR', false);\n\t}\n\n\tisEnabledChangesRendering(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_CHANGES_RENDERING', true);\n\t}\n\n\tisInputDetailLinkEnabled(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_INPUT_DETAIL_LINK', false)\n\t\t\t&& Type.isStringFilled(this.model.getDetailPath())\n\t\t\t&& this.checkProductViewRights()\n\t\t;\n\t}\n\n\tgetWrapper(): HTMLElement\n\t{\n\t\tif (!this.wrapper)\n\t\t{\n\t\t\tthis.wrapper = document.getElementById(this.id);\n\t\t}\n\n\t\treturn this.wrapper;\n\t}\n\n\trenderTo(node)\n\t{\n\t\tthis.clearLayout();\n\t\tthis.wrapper = node;\n\t\tthis.layout();\n\t}\n\n\tlayout()\n\t{\n\t\tconst wrapper = this.getWrapper();\n\t\tif (!wrapper)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.defineWrapperClass(wrapper);\n\t\twrapper.innerHTML = '';\n\n\t\tconst block = Tag.render`<div class=\"catalog-product-field-inner\"></div>`;\n\t\tDom.append(this.layoutNameBlock(), block);\n\n\t\tif (this.getSkuTreeInstance())\n\t\t{\n\t\t\tDom.append(this.getSkuTreeInstance().layout(), block);\n\t\t}\n\n\t\tDom.append(this.getErrorContainer(), block);\n\n\t\tif (!this.isViewMode())\n\t\t{\n\t\t\tDom.append(block, wrapper);\n\t\t}\n\n\t\tif (this.isImageFieldEnabled())\n\t\t{\n\t\t\tif (!Reflection.getClass('BX.UI.ImageInput'))\n\t\t\t{\n\t\t\t\tif (ProductSelector.UIInputRequest instanceof Promise)\n\t\t\t\t{\n\t\t\t\t\tProductSelector.UIInputRequest.then(() => {\n\t\t\t\t\t\tthis.layoutImage();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tProductSelector.UIInputRequest = new Promise(resolve => {\n\t\t\t\t\t\tajax\n\t\t\t\t\t\t\t.runAction(\t'catalog.productSelector.getFileInput', {\n\t\t\t\t\t\t\t\tjson:{\n\t\t\t\t\t\t\t\t\tiblockId: this.getModel().getIblockId()\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tthis.layoutImage();\n\t\t\t\t\t\t\t\tProductSelector.UIInputRequest = null;\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.layoutImage();\n\t\t\t}\n\n\t\t\tDom.append(this.getImageContainer(), wrapper);\n\t\t}\n\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tDom.append(block, wrapper);\n\t\t}\n\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tDom.append(block, wrapper);\n\t\t}\n\n\t\tif (this.isShowableErrors)\n\t\t{\n\t\t\tthis.layoutErrors();\n\t\t}\n\n\t\tthis.subscribeToVariationChange();\n\t}\n\n\tfocusName(): this\n\t{\n\t\tif (this.searchInput)\n\t\t{\n\t\t\tthis.searchInput.focusName();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetImageContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('imageContainer', () => (\n\t\t\tTag.render`<div class=\"catalog-product-img\"></div>`\n\t\t));\n\t}\n\n\tgetErrorContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('errorContainer', () => (\n\t\t\tTag.render`<div class=\"catalog-product-error\"></div>`\n\t\t));\n\t}\n\n\tlayoutErrors()\n\t{\n\t\tthis.getErrorContainer().innerHTML = '';\n\t\tthis.clearImageErrorBorder();\n\t\tif (!this.model.getErrorCollection().hasErrors())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst errors = this.model.getErrorCollection().getErrors();\n\t\tfor (const code in errors)\n\t\t{\n\t\t\tif (!ProductSelector.ErrorCodes.getCodes().includes(code))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (code === 'EMPTY_IMAGE')\n\t\t\t{\n\t\t\t\tthis.setImageErrorBorder();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<div class=\"catalog-product-error-item\">${errors[code].text}</div>`,\n\t\t\t\t\tthis.getErrorContainer()\n\t\t\t\t);\n\n\t\t\t\tif (this.searchInput)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.searchInput.getNameBlock(), 'ui-ctl-danger');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsetImageErrorBorder()\n\t{\n\t\tDom.addClass(\n\t\t\tthis.getImageContainer().querySelector('.adm-fileinput-area'),\n\t\t\t'adm-fileinput-drag-area-error'\n\t\t);\n\t}\n\n\tclearImageErrorBorder()\n\t{\n\t\tDom.removeClass(\n\t\t\tthis.getImageContainer().querySelector('.adm-fileinput-area'),\n\t\t\t'adm-fileinput-drag-area-error'\n\t\t);\n\t}\n\n\tonUploaderIsInited()\n\t{\n\t\tif (this.isEnabledEmptyImagesError())\n\t\t{\n\t\t\trequestAnimationFrame(this.layoutErrors.bind(this));\n\t\t}\n\t}\n\n\tlayoutImage()\n\t{\n\t\tthis.getImageContainer().innerHTML = '';\n\t\tDom.append(this.getFileInput().layout(), this.getImageContainer());\n\t\tthis.refreshImageSelectorId = null;\n\t}\n\n\tclearState(): void\n\t{\n\t\tthis\n\t\t\t.getModel()\n\t\t\t.initFields({\n\t\t\t\tID: '',\n\t\t\t\tNAME: '',\n\t\t\t\tBARCODE: '',\n\t\t\t\tPRODUCT_ID: null,\n\t\t\t\tSKU_ID: null,\n\t\t\t})\n\t\t\t.setOption('isNew', false)\n\t\t;\n\n\t\tthis\n\t\t\t.getFileInput()\n\t\t\t.restoreDefaultInputHtml()\n\t\t;\n\n\t\tthis\n\t\t\t.getModel()\n\t\t\t.clearSkuTree()\n\t\t;\n\t\tthis.skuTreeInstance = null;\n\n\t\tthis\n\t\t\t.getModel()\n\t\t\t.getStoreCollection()\n\t\t\t.clear()\n\t\t;\n\t}\n\n\tclearLayout(): void\n\t{\n\t\tconst wrapper = this.getWrapper();\n\t\tif (wrapper)\n\t\t{\n\t\t\twrapper.innerHTML = '';\n\t\t}\n\n\t\tthis.unsubscribeToVariationChange();\n\t}\n\n\tsubscribeEvents()\n\t{\n\t\tEventEmitter.subscribe('ProductList::onChangeFields', this.onChangeFieldsHandler);\n\t\tEventEmitter.subscribe('ProductSelector::onNameChange', this.onNameChangeFieldHandler);\n\t\tEventEmitter.subscribe('Catalog.ImageInput::save', this.onSaveImageHandler);\n\t\tEventEmitter.subscribe('onUploaderIsInited', this.onUploaderIsInitedHandler);\n\t}\n\n\tunsubscribeEvents()\n\t{\n\t\tthis.unsubscribeToVariationChange();\n\n\t\tEventEmitter.unsubscribe('Catalog.ImageInput::save', this.onSaveImageHandler);\n\t\tEventEmitter.unsubscribe('ProductList::onChangeFields', this.onChangeFieldsHandler);\n\t\tEventEmitter.unsubscribe('onUploaderIsInited', this.onUploaderIsInitedHandler);\n\t\tEventEmitter.unsubscribe('onUploaderIsInited', this.onUploaderIsInitedHandler);\n\t\tEventEmitter.unsubscribe('ProductSelector::onNameChange', this.onNameChangeFieldHandler);\n\t}\n\n\tdefineWrapperClass(wrapper)\n\t{\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tDom.addClass(wrapper, 'catalog-product-view');\n\t\t\tDom.removeClass(wrapper, 'catalog-product-edit');\n\n\t\t\tif (this.isShortViewFormat())\n\t\t\t{\n\t\t\t\tDom.addClass(wrapper, '--short-format');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(wrapper, 'catalog-product-edit');\n\t\t\tDom.removeClass(wrapper, 'catalog-product-view');\n\t\t}\n\t}\n\n\tgetNameBlockView(): HTMLElement\n\t{\n\t\tconst productName = Text.encode(this.model.getField('NAME'));\n\t\tconst namePlaceholder = Loc.getMessage('CATALOG_SELECTOR_VIEW_NAME_TITLE');\n\n\t\tif (this.getModel().getDetailPath())\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<a href=\"${this.getModel().getDetailPath()}\" title=\"${namePlaceholder}\">${productName}</a>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`<span title=\"${namePlaceholder}\">${productName}</span>`;\n\n\t}\n\n\tgetNameInputFilledValue(): string\n\t{\n\t\tif (this.searchInput)\n\t\t{\n\t\t\treturn this.searchInput.getFilledValue();\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tlayoutNameBlock(): HTMLElement\n\t{\n\t\tconst block = Tag.render`<div class=\"catalog-product-field-input\"></div>`;\n\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tDom.append(this.getNameBlockView(), block);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.getType() === ProductSelector.INPUT_FIELD_BARCODE)\n\t\t\t{\n\t\t\t\tif (!this.searchInput)\n\t\t\t\t{\n\t\t\t\t\tthis.searchInput = new BarcodeSearchInput(\n\t\t\t\t\t\tthis.id,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tselector: this,\n\t\t\t\t\t\t\tmodel: this.getModel(),\n\t\t\t\t\t\t\tinputName: this.options.inputFieldName,\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.searchInput = new ProductSearchInput(\n\t\t\t\t\tthis.id,\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: this,\n\t\t\t\t\t\tmodel: this.getModel(),\n\t\t\t\t\t\tinputName: this.options.inputFieldName,\n\t\t\t\t\t\tisSearchEnabled: this.isProductSearchEnabled(),\n\t\t\t\t\t\tisEnabledEmptyProductError: this.isEnabledEmptyProductError(),\n\t\t\t\t\t\tisEnabledDetailLink: this.isInputDetailLinkEnabled()\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tDom.append(this.searchInput.layout(), block);\n\t\t}\n\n\t\treturn block;\n\t}\n\n\tsearchInDialog(): ProductSelector\n\t{\n\t\tthis.searchInput.searchInDialog();\n\n\t\treturn this;\n\t}\n\n\tupdateSkuTree(tree): ProductSelector\n\t{\n\t\tthis.getModel().setSkuTree(tree);\n\t\tthis.skuTreeInstance = null;\n\n\t\treturn this;\n\t}\n\n\tgetIblockSkuTreeProperties(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif (iblockSkuTreeProperties.has(this.getModel().getIblockId()))\n\t\t\t{\n\t\t\t\tresolve(iblockSkuTreeProperties.get(this.getModel().getIblockId()));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tajax.runAction(\n\t\t\t\t\t'catalog.productSelector.getSkuTreeProperties',\n\t\t\t\t\t{\n\t\t\t\t\t\tjson: {\n\t\t\t\t\t\t\tiblockId: this.getModel().getIblockId(),\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tiblockSkuTreeProperties.set(this.getModel().getIblockId(), response)\n\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tgetSkuTreeInstance(): SkuTree\n\t{\n\t\tif (this.isSkuTreeEnabled() && this.getModel()?.getSkuTree() && !this.skuTreeInstance)\n\t\t{\n\t\t\tthis.skuTreeInstance = new SkuTree({\n\t\t\t\tskuTree: this.getModel().getSkuTree(),\n\t\t\t\tselectable: this.getConfig('ENABLE_SKU_SELECTION', true),\n\t\t\t\thideUnselected: this.getConfig('HIDE_UNSELECTED_ITEMS', false),\n\t\t\t\tisShortView: this.isViewMode() && this.isShortViewFormat(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.skuTreeInstance;\n\t}\n\n\tsubscribeToVariationChange()\n\t{\n\t\tconst skuTree = this.getSkuTreeInstance();\n\t\tif (skuTree)\n\t\t{\n\t\t\tthis.unsubscribeToVariationChange();\n\t\t\tskuTree.subscribe('SkuProperty::onChange', this.variationChangeHandler);\n\t\t}\n\t}\n\n\tunsubscribeToVariationChange()\n\t{\n\t\tconst skuTree = this.getSkuTreeInstance();\n\t\tif (skuTree)\n\t\t{\n\t\t\tskuTree.unsubscribe('SkuProperty::onChange', this.variationChangeHandler);\n\t\t}\n\t}\n\n\thandleVariationChange(event)\n\t{\n\t\tconst [skuFields] = event.getData();\n\t\tconst productId = Text.toNumber(skuFields.PARENT_PRODUCT_ID);\n\t\tconst variationId = Text.toNumber(skuFields.ID);\n\n\t\tif (productId <= 0 || variationId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emit('onBeforeChange', {\n\t\t\tselectorId: this.getId(),\n\t\t\trowId: this.getRowId()\n\t\t});\n\n\t\tthis.#inAjaxProcess = true;\n\t\tajax.runAction(\n\t\t\t'catalog.productSelector.getSelectedSku',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\tvariationId,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tpriceId: this.basePriceId,\n\t\t\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\t\t\turlBuilder: this.getConfig('URL_BUILDER_CONTEXT')\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(response => this.processResponse(response, {...this.options.config}));\n\t}\n\n\tonChangeFields(event)\n\t{\n\t\tconst eventData = event.getData();\n\n\t\tif (eventData.rowId !== this.getRowId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fields = eventData.fields;\n\t\tthis.getModel().setFields(fields);\n\t}\n\n\treloadFileInput()\n\t{\n\t\tajax\n\t\t\t.runAction(\t'catalog.productSelector.getFileInput', {\n\t\t\t\tjson:{\n\t\t\t\t\tiblockId: this.getModel().getIblockId(),\n\t\t\t\t\tskuId: this.getModel()?.getSkuId()\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then((event) => {\n\t\t\t\tthis.getModel().getImageCollection().setEditInput(event.data.html);\n\t\t\t\tif (this.isImageFieldEnabled())\n\t\t\t\t{\n\t\t\t\t\tthis.layoutImage();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tonNameChange(event)\n\t{\n\t\tconst eventData = event.getData();\n\n\t\tif (eventData.rowId !== this.getRowId() || !this.isEnabledAutosave())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fields = eventData.fields;\n\t\tthis.getModel().setFields(fields);\n\t\tthis.getModel().save().then(() => {\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tid: 'saving_field_notify_name',\n\t\t\t\tcloseButton: false,\n\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_NAME_CHANGED')}</div>`,\n\t\t\t\tautoHide: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tonSaveImage(event)\n\t{\n\t\tconst [, inputId, response] = event.getData();\n\t\tif (inputId !== this.getFileInput().getId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getFileInput().setId(response.data.id);\n\t\tthis.getFileInput().setInputHtml(response.data.input);\n\t\tthis.getFileInput().setView(response.data.preview);\n\t\tthis.getModel().getImageCollection().setMorePhotoValues(response.data.values);\n\t\tif (this.isImageFieldEnabled())\n\t\t{\n\t\t\tthis.layoutImage();\n\t\t}\n\n\t\tthis.emit('onChange', {\n\t\t\tselectorId: this.id,\n\t\t\trowId: this.getRowId(),\n\t\t\tfields: this.getModel().getFields(),\n\t\t\tmorePhoto: this.getModel().getImageCollection().getMorePhotoValues(),\n\t\t});\n\t}\n\n\tinProcess()\n\t{\n\t\treturn this.#inAjaxProcess;\n\t}\n\n\tonProductSelect(productId, itemConfig)\n\t{\n\t\tthis.emit('onProductSelect', {\n\t\t\tselectorId: this.getId(),\n\t\t\trowId: this.getRowId()\n\t\t});\n\n\t\tthis.emit('onBeforeChange', {\n\t\t\tselectorId: this.getId(),\n\t\t\trowId: this.getRowId()\n\t\t});\n\n\t\tthis.productSelectAjaxAction(productId, itemConfig);\n\t}\n\n\tproductSelectAjaxAction(\n\t\tproductId,\n\t\titemConfig = {\n\t\t\tisNew: false,\n\t\t\timmutableFields: [],\n\t\t}\n\t)\n\t{\n\t\tthis.#inAjaxProcess = true\n\t\tajax\n\t\t\t.runAction(\n\t\t\t\t'catalog.productSelector.getProduct',\n\t\t\t\t{\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tproductId,\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tpriceId: this.basePriceId,\n\t\t\t\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\t\t\t\turlBuilder: this.getConfig('URL_BUILDER_CONTEXT')\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t\t.then(response => this.processResponse(response, {...this.options.config, ...itemConfig}, true));\n\t}\n\n\tprocessResponse(response, config = {}, isProductAction = false)\n\t{\n\t\tconst data = response?.data || null;\n\t\tthis.#inAjaxProcess = false;\n\n\t\tconst fields = data?.fields || [];\n\t\tif (Type.isArray(config.immutableFields))\n\t\t{\n\t\t\tconfig.immutableFields.forEach((field) => {\n\t\t\t\tfields[field] = this.getModel().getField(field);\n\t\t\t});\n\n\t\t\tdata.fields = fields;\n\t\t}\n\n\t\tif (isProductAction)\n\t\t{\n\t\t\tthis.clearState();\n\t\t}\n\n\t\tif (data)\n\t\t{\n\t\t\tthis.changeSelectedElement(data, config);\n\t\t}\n\t\telse if (!isProductAction)\n\t\t{\n\t\t\tthis.productSelectAjaxAction(this.getModel().getProductId());\n\t\t}\n\n\t\tthis.unsubscribeToVariationChange();\n\n\t\tif (this.isEnabledChangesRendering())\n\t\t{\n\t\t\tthis.clearLayout();\n\t\t\tthis.layout();\n\t\t}\n\n\t\tthis.emit('onChange', {\n\t\t\tselectorId: this.id,\n\t\t\trowId: this.getRowId(),\n\t\t\tisNew: config.isNew || false,\n\t\t\tfields,\n\t\t\tmorePhoto: this.getModel().getImageCollection().getMorePhotoValues(),\n\t\t});\n\t}\n\n\tchangeSelectedElement(data, config)\n\t{\n\t\tconst productId = Text.toInteger(data.productId);\n\t\tconst productChanged = this.getModel().getProductId() !== productId;\n\n\t\tif (productChanged)\n\t\t{\n\t\t\tthis.getModel().setOption('productId', productId);\n\t\t\tthis.getModel().setOption('skuId', Text.toInteger(data.skuId));\n\t\t\tthis.getModel().setOption('isSimpleModel', false);\n\t\t\tthis.getModel().setOption('isNew', config.isNew);\n\t\t}\n\n\t\tthis.getModel().initFields(data.fields);\n\n\t\tconst imageField = {\n\t\t\tid: '',\n\t\t\tinput: '',\n\t\t\tpreview: '',\n\t\t\tvalues: []\n\t\t};\n\n\t\tif (Type.isObject(data.image))\n\t\t{\n\t\t\timageField.id = data.image.id;\n\t\t\timageField.input = data.image.input;\n\t\t\timageField.preview = data.image.preview;\n\t\t\timageField.values = data.image.values;\n\t\t}\n\n\t\tthis.getFileInput().setId(imageField.id);\n\t\tthis.getFileInput().setInputHtml(imageField.input);\n\t\tthis.getFileInput().setView(imageField.preview);\n\n\t\tthis.getModel().getImageCollection().setMorePhotoValues(imageField.values);\n\t\tthis.checkEmptyImageError();\n\n\t\tif (data.detailUrl)\n\t\t{\n\t\t\tthis.getModel().setDetailPath(data.detailUrl);\n\t\t}\n\n\t\tif (Type.isObject(data.skuTree))\n\t\t{\n\t\t\tthis.updateSkuTree(data.skuTree);\n\t\t}\n\t}\n\n\tcheckEmptyImageError()\n\t{\n\t\tif (\n\t\t\t!Type.isArrayFilled(this.getModel().getImageCollection().getMorePhotoValues())\n\t\t\t&& this.isEnabledEmptyImagesError()\n\t\t)\n\t\t{\n\t\t\tthis.getModel().getErrorCollection().setError(\n\t\t\t\t'EMPTY_IMAGE',\n\t\t\t\tLoc.getMessage('CATALOG_SELECTOR_EMPTY_IMAGE_ERROR'),\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getModel().getErrorCollection().removeError('EMPTY_IMAGE');\n\t\t}\n\t}\n\n\tremoveSpotlight()\n\t{\n\t\tthis.searchInput?.removeSpotlight();\n\t\tthis.setConfig('ENABLE_INFO_SPOTLIGHT', false);\n\t}\n\n\tremoveQrAuth()\n\t{\n\t\tthis.searchInput?.removeQrAuth();\n\t\tthis.setConfig('ENABLE_BARCODE_QR_AUTH', false);\n\t}\n}\n"],"names":["ProductSearchSelectorFooter","DefaultFooter","constructor","dialog","options","loader","errorAdminHint","getDialog","subscribe","handleOnSearch","bind","getContent","phrase","isViewCreateButton","allowCreateItem","allowEditItem","isViewEditButton","Tag","render","Loc","getMessage","createButton","querySelector","Dom","replace","getLabelContainer","changeButton","getSaveContainer","getHintContainer","getLoaderContainer","getLoader","Type","isNil","Loader","target","size","color","showLoader","show","hideLoader","hide","setLabel","label","isString","textContent","cache","remember","handleClick","getOption","getQueryContainer","className","messageId","inputName","ProductSelector","INPUT_FIELD_BARCODE","onClickSaveChanges","message","hintNode","dataset","hint","hintNoIcon","BX","UI","Hint","initNode","lastQuery","getActiveTab","getLastSearchQuery","emit","query","clearSearch","createItem","tagSelector","getTagSelector","isLocked","finalize","unlock","focusSearch","event","preventDefault","lock","emitAsync","searchQuery","then","getTab","clearResults","selectFirstTab","catch","getData","currentValue","ProductCreationLimitedFooter","infoButton","Event","InfoHelper","SelectorErrorCode","getCodes","NOT_SELECTED_PRODUCT","FAILED_PRODUCT","DialogMode","SEARCHING","SHOW_PRODUCT_ITEM","SHOW_RECENT","ProductSearchInput","id","Cache","MemoryCache","Text","getRandom","selector","Error","model","isEnabledSearch","isSearchEnabled","isEnabledDetailLink","INPUT_FIELD_NAME","immutableFieldNames","includes","push","ajaxInProcess","loadedSelectedItem","handleSearchInput","Runtime","debounce","searchInDialog","destroy","getId","getSelectorType","getField","fieldName","getValue","getFilledValue","getNameInput","value","toggleIcon","icon","isDomNode","style","getNameBlock","getNameTag","getHiddenNameInput","isNew","input","encode","getPlaceholder","handleNameInputHiddenChange","getConfig","addClass","setAttribute","getClearIcon","handleClearIconClick","getArrowIcon","getDetailPath","getSearchIcon","handleSearchIconClick","layout","clearInputCache","block","append","isProductSearchEnabled","initHasDialogItems","isStringFilled","handleClickNameInput","handleNameInputBlur","handleNameInputKeyDown","dialogMode","isCatalogExisted","showDetailLink","handleIconsSwitchingOnNameInput","handleNameInputChange","searchTypeId","SEARCH_TYPE_ID","entity","iblockId","getIblockId","basePriceId","getBasePriceId","currency","getCurrency","dynamicLoad","dynamicSearch","restrictedProductTypes","params","height","width","Math","max","offsetWidth","context","targetNode","enableSearch","multiple","dropdownMode","searchTabOptions","stub","stubOptions","title","subtitle","isAllowedCreateProduct","arrow","events","onProductSelect","createProduct","showChangeNotification","entities","settingsCollection","Extension","getSettings","isObject","get","footer","footerOptions","isAllowedEditProduct","creationLabel","searchOptions","Dialog","getModel","isEmpty","setConfig","hasDynamicLoad","subscribeOnce","getPreselectedItems","length","checkProductAddRights","checkProductEditRights","key","getSearchTab","stopPropagation","Browser","isMac","metaKey","ctrlKey","getFooter","delete","selectorId","rowId","getRowId","clearState","clearLayout","newValue","onChangeValue","focusName","fields","EventEmitter","isEnabledAutosave","setFields","save","Notification","Center","notify","closeButton","content","autoHide","requestAnimationFrame","focus","trim","isHasDialogItems","isSearchingInProcess","isOpen","showItems","setTimeout","isEnabledEmptyProductError","inProcess","getErrorCollection","setError","getEmptySelectErrorMessage","layoutErrors","getImmutableFieldNames","setInputValueOnProductSelect","item","getTargetNode","getTitle","clearErrors","getCustomData","immutableFields","forEach","setField","errors","getErrors","code","ErrorCodes","removeError","createProductModelFromSearchQuery","getFields","ProductModel","isSimpleModel","getTarget","newProduct","getQuery","Promise","resolve","reject","checkCreationModel","response","toInteger","data","addItem","entityId","tabs","getRecentTab","customData","setOption","name","select","errorResponse","error","creationModel","getType","onSave","declineCancelTitle","onCancel","showSaveNotifier","removeSpotlight","removeQrAuth","removeItems","ajax","runAction","json","getSkuId","isLoading","setPreselectedItems","getRootNode","getPopup","loadState","load","search","ProductImageInput","config","getImageCollection","getEditInput","restoreDefaultInputHtml","enableSaving","uploaderFieldMap","setId","setView","html","setPreview","setInputHtml","setEditInput","defaultInput","isViewMode","isSaveable","isEnabledLiveSaving","imageContainer","getPreview","BarcodeSearchSelectorFooter","isEmptyBarcode","handleOnSearchLoad","barcodeContent","scannerContent","getScannerContent","getScannerLabelContainer","handleScannerClick","getScannerQueryContainer","inputEntity","startMobileScanner","searchTab","getItems","BarcodeSearchInput","onFocusHandler","handleFocusEvent","onBlurHandler","handleBlurEvent","focused","isInstalledMobileApp","qrAuth","QrAuthorization","createQrCodeImage","unbind","searchFields","type","system","searchable","preselectedItems","layoutMobileQrPopup","closeIcon","closeMobilePopup","sendButton","helpButton","top","Helper","getQrNode","result","userOptions","getContainer","hasClass","disableCancel","searchByBarcode","getSubtitle","getCreationProduct","sendMobilePush","isEnabledMobileScanning","token","getMobileScannerToken","BarcodeScanner","open","repeatLink","category","autoHideDelay","getProductIdByBarcode","barcode","applyScannerData","productId","selectScannedBarcodeProduct","getBarcodeIcon","barcodeIcon","spotlight","SpotLight","targetElement","autoSave","targetVertex","zIndex","guide","Guide","steps","text","onEvents","setAutoHide","showNextStep","close","mobilePopup","remove","removeClass","instances","Map","iblockSkuTreeProperties","getById","mode","MODE_EDIT","mobileScannerToken","variationChangeHandler","handleVariationChange","onSaveImageHandler","onSaveImage","onChangeFieldsHandler","onChangeFields","onUploaderIsInitedHandler","onUploaderIsInited","onNameChangeFieldHandler","onNameChange","setEventNamespace","inputFieldName","settings","setMode","toNumber","skuTree","storeMap","setMorePhotoValues","morePhotoValues","setDetailPath","failedProduct","isShowableEmptyProductError","fileView","fileInput","updateSkuTree","scannerToken","setMobileScannerToken","subscribeEvents","set","setModel","MODE_VIEW","isShortViewFormat","FULL_VIEW_FORMAT","SHORT_VIEW_FORMAT","checkProductViewRights","checkAccess","RightActionDictionary","ACTION_PRODUCT_VIEW","ACTION_PRODUCT_EDIT","ACTION_PRODUCT_ADD","removeMobileScannerToken","defaultValue","prop","getFileInput","fileInputId","isSkuTreeEnabled","isImageFieldEnabled","isChanged","isSimple","isShowableErrors","isEnabledEmptyImagesError","isEnabledChangesRendering","isInputDetailLinkEnabled","getWrapper","wrapper","document","getElementById","renderTo","node","defineWrapperClass","innerHTML","layoutNameBlock","getSkuTreeInstance","getErrorContainer","Reflection","getClass","UIInputRequest","layoutImage","getImageContainer","subscribeToVariationChange","searchInput","clearImageErrorBorder","hasErrors","setImageErrorBorder","refreshImageSelectorId","initFields","ID","NAME","BARCODE","PRODUCT_ID","SKU_ID","clearSkuTree","skuTreeInstance","getStoreCollection","clear","unsubscribeToVariationChange","unsubscribeEvents","unsubscribe","getNameBlockView","productName","namePlaceholder","getNameInputFilledValue","tree","setSkuTree","getIblockSkuTreeProperties","has","getSkuTree","SkuTree","selectable","hideUnselected","isShortView","skuFields","PARENT_PRODUCT_ID","variationId","priceId","urlBuilder","processResponse","eventData","reloadFileInput","skuId","inputId","preview","values","morePhoto","getMorePhotoValues","itemConfig","productSelectAjaxAction","isProductAction","isArray","field","changeSelectedElement","getProductId","productChanged","imageField","image","checkEmptyImageError","detailUrl","isArrayFilled"],"mappings":"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"}