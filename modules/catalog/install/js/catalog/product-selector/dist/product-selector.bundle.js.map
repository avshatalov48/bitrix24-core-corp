{"version":3,"file":"product-selector.bundle.js","sources":["../src/models/base.js","../src/product-search-input.js","../src/product-image-input.js","../src/models/empty.js","../src/models/product.js","../src/models/sku.js","../src/models/simple.js","../src/product-selector.js"],"sourcesContent":["import {Text, Type} from 'main.core';\n\nexport class Base\n{\n\tconstructor(id, config = {})\n\t{\n\t\tthis.id = id || Text.getRandom();\n\t\tthis.config = config || {};\n\t\tthis.errors = {};\n\t\tthis.setMorePhotoValues(config.morePhoto);\n\t\tthis.setFields(config.fields);\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetProductId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tisSaveable(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\tsetSaveable(value)\n\t{\n\t\tthis.config.saveProductFields = value;\n\t}\n\n\tisNew(): boolean\n\t{\n\t\treturn this.getConfig('isNew', false);\n\t}\n\n\tgetConfig(name, defaultValue)\n\t{\n\t\treturn BX.prop.get(this.config, name, defaultValue);\n\t}\n\n\tgetFields()\n\t{\n\t\treturn this.fields;\n\t}\n\n\tgetField(fieldName, defaultValue = '')\n\t{\n\t\treturn BX.prop.get(this.fields, fieldName, defaultValue);\n\t}\n\n\tsetFields(fields)\n\t{\n\t\tthis.fields = Type.isObject(fields) ? fields : {};\n\t}\n\n\tgetErrors()\n\t{\n\t\treturn this.errors;\n\t}\n\n\tsetError(code, text)\n\t{\n\t\tthis.errors[code] = text;\n\t}\n\n\tclearErrors(code, text)\n\t{\n\t\tthis.errors = {};\n\t}\n\n\thasErrors()\n\t{\n\t\treturn Object.keys(this.errors).length > 0;\n\t}\n\n\tisEnableFileSaving(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\tgetMorePhotoValues()\n\t{\n\t\treturn this.morePhoto;\n\t}\n\n\tsetMorePhotoValues(values)\n\t{\n\t\tthis.morePhoto = Type.isPlainObject(values) ? values : {};\n\t}\n\n\tremoveMorePhotoItem(fileId): boolean\n\t{\n\t\treturn false;\n\t}\n\n\taddMorePhotoItem(fileId, value)\n\t{\n\t\tthis.morePhoto[fileId] = value;\n\t}\n\n\tsetFileType(value): string\n\t{\n\t\tthis.config.fileType = value || '';\n\t}\n\n\tgetDetailPath(): string\n\t{\n\t\treturn '';\n\t}\n\n\tsetDetailPath(value): string\n\t{\n\t\tthis.config.DETAIL_PATH = value || '';\n\t}\n}","import {ajax, Browser, Cache, Dom, Event, Loc, Tag, Text, Type} from 'main.core';\nimport {Dialog} from 'ui.entity-selector';\nimport './component.css';\nimport {EventEmitter} from 'main.core.events';\nimport {Base} from './models/base';\nimport {ProductSelector} from 'catalog.product-selector';\n\nexport class ProductSearchInput\n{\n\tmodel: Base;\n\tselector: ProductSelector;\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(id, options = {})\n\t{\n\t\tthis.id = id || Text.getRandom();\n\t\tthis.selector = options.selector;\n\t\tif (!(this.selector instanceof ProductSelector))\n\t\t{\n\t\t\tthrow new Error('Product selector instance not found.');\n\t\t}\n\n\t\tthis.model = options.model || {};\n\t\tthis.isEnabledSearch = options.isSearchEnabled;\n\t\tthis.isEnabledDetailLink = options.isEnabledDetailLink;\n\t\tthis.isEnabledEmptyProductError = options.isEnabledEmptyProductError;\n\t\tthis.inputName = options.inputName || '';\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetField(fieldName): string\n\t{\n\t\treturn this.model.getField(fieldName);\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.getField(this.inputName);\n\t}\n\n\tisSearchEnabled(): boolean\n\t{\n\t\treturn this.isEnabledSearch;\n\t}\n\n\ttoggleIcon(icon, value)\n\t{\n\t\tif (Type.isDomNode(icon))\n\t\t{\n\t\t\tDom.style(icon, 'display', value);\n\t\t}\n\t}\n\n\tgetNameBlock(): HTMLElement\n\t{\n\t\treturn this.cache.remember('nameBlock', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t${this.getNameTag()}\n\t\t\t\t\t${this.getNameInput()}\n\t\t\t\t\t${this.getHiddenNameInput()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetNameTag(): ?HTMLElement\n\t{\n\t\tif (!this.model.isNew())\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-ctl-tag\">${Loc.getMessage('CATALOG_SELECTOR_NEW_TAG_TITLE')}</div>\n\t\t`;\n\t}\n\n\tgetNameInput(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('nameInput', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input type=\"text\" \n\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox\" \n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\tvalue=\"${Text.encode(this.getValue())}\"\n\t\t\t\t\tplaceholder=\"${Text.encode(this.getPlaceholder())}\"\n\t\t\t\t\tonchange=\"${this.handleNameInputHiddenChange.bind(this)}\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetHiddenNameInput(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('hiddenNameInput', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input\n\t\t\t\t \ttype=\"hidden\" \n\t\t\t\t\tname=\"${Text.encode(this.inputName)}\" \n\t\t\t\t\tvalue=\"${Text.encode(this.getValue())}\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\thandleNameInputHiddenChange(event: UIEvent)\n\t{\n\t\tthis.getHiddenNameInput().value = event.target.value;\n\t}\n\n\tgetClearIcon(): HTMLElement\n\t{\n\t\treturn this.cache.remember('closeIcon', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-clear\" \n\t\t\t\t\tonclick=\"${this.handleClearIconClick.bind(this)}\"\n\t\t\t\t></button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetArrowIcon(): HTMLElement\n\t{\n\t\treturn this.cache.remember('arrowIcon', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"${this.model.getDetailPath()}\"\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-forward\"\n\t\t\t\t></button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetSearchIcon(): HTMLElement\n\t{\n\t\treturn this.cache.remember('searchIcon', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-search\"\n\t\t\t\t\tonclick=\"${this.handleSearchIconClick.bind(this)}\"\n\t\t\t\t></button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tlayout(): HTMLElement\n\t{\n\t\tconst block = Tag.render`<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\"></div>`;\n\n\t\tif (!Type.isStringFilled(this.getValue()))\n\t\t{\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\t}\n\n\t\tblock.appendChild(this.getClearIcon());\n\n\t\tif (this.showDetailLink() && Type.isStringFilled(this.getValue()))\n\t\t{\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\t\tthis.toggleIcon(this.getArrowIcon(), 'block');\n\t\t\tblock.appendChild(this.getArrowIcon());\n\t\t}\n\n\t\tif (this.isSearchEnabled())\n\t\t{\n\t\t\tconst iconValue = Type.isStringFilled(this.getValue()) ? 'none' : 'block';\n\t\t\tthis.toggleIcon(this.getSearchIcon(), iconValue);\n\t\t\tblock.appendChild(this.getSearchIcon());\n\n\t\t\tEvent.bind(this.getNameInput(), 'click', this.handleShowSearchDialog.bind(this));\n\t\t\tEvent.bind(this.getNameInput(), 'input', this.handleShowSearchDialog.bind(this));\n\t\t\tEvent.bind(this.getNameInput(), 'blur', this.handleNameInputBlur.bind(this));\n\t\t\tEvent.bind(this.getNameInput(), 'keydown', this.handleNameInputKeyDown.bind(this));\n\t\t}\n\n\t\tEvent.bind(this.getNameInput(), 'click', this.handleIconsSwitchingOnNameInput.bind(this));\n\t\tEvent.bind(this.getNameInput(), 'input', this.handleIconsSwitchingOnNameInput.bind(this));\n\n\t\tif (this.selector && this.selector.isSaveable())\n\t\t{\n\t\t\tEvent.bind(this.getNameInput(), 'change', this.handleNameInputChange.bind(this));\n\t\t}\n\n\t\tblock.appendChild(this.getNameBlock());\n\t\treturn block;\n\t}\n\n\tshowDetailLink(): string\n\t{\n\t\treturn this.isEnabledDetailLink;\n\t}\n\n\tgetDialog(): ?Dialog\n\t{\n\t\treturn this.cache.remember('dialog', () => {\n\t\t\treturn new Dialog({\n\t\t\t\tid: this.id,\n\t\t\t\theight: 300,\n\t\t\t\tcontext: 'catalog-products',\n\t\t\t\ttargetNode: this.getNameInput(),\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tsearchTabOptions: {\n\t\t\t\t\tstub: true,\n\t\t\t\t\tstubOptions: {\n\t\t\t\t\t\ttitle: Tag.message`${'CATALOG_SELECTOR_IS_EMPTY_TITLE'}`,\n\t\t\t\t\t\tsubtitle: Tag.message`${'CATALOG_SELECTOR_IS_EMPTY_SUBTITLE'}`,\n\t\t\t\t\t\tarrow: true\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsearchOptions: {\n\t\t\t\t\tallowCreateItem: true\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.onProductSelect.bind(this),\n\t\t\t\t\t'Search:onItemCreateAsync': this.createProduct.bind(this)\n\t\t\t\t},\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'product',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tiblockId: this.selector.getIblockId(),\n\t\t\t\t\t\t\tbasePriceId: this.selector.getBasePriceId()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t});\n\t}\n\n\thandleNameInputKeyDown(event: KeyboardEvent): void\n\t{\n\t\tconst dialog = this.getDialog();\n\t\tif (event.key === 'Enter' && dialog.getActiveTab() === dialog.getSearchTab())\n\t\t{\n\t\t\t// prevent a form submit\n\t\t\tevent.preventDefault();\n\n\t\t\tif ((Browser.isMac() && event.metaKey) || event.ctrlKey)\n\t\t\t{\n\t\t\t\tdialog.getSearchTab().getFooter().createItem();\n\t\t\t}\n\t\t}\n\t}\n\n\thandleIconsSwitchingOnNameInput(event: UIEvent): void\n\t{\n\t\tthis.toggleIcon(this.getArrowIcon(), 'none');\n\n\t\tif (Type.isStringFilled(event.target.value))\n\t\t{\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'block');\n\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\t\tthis.toggleIcon(this.getSearchIcon(), 'block');\n\t\t}\n\t}\n\n\thandleClearIconClick(event: UIEvent)\n\t{\n\t\tif (this.selector.isProductSearchEnabled() && !this.selector.isEmptyModel())\n\t\t{\n\t\t\tthis.selector.clearState();\n\t\t\tthis.selector.clearLayout();\n\t\t\tthis.selector.layout();\n\t\t\tthis.selector.searchInDialog();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getNameInput().value = '';\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\t}\n\n\t\tthis.selector.focusName();\n\n\t\tthis.selector.emit('onClear', {\n\t\t\tselectorId: this.selector.getId(),\n\t\t\trowId: this.selector.getRowId()\n\t\t});\n\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t}\n\n\thandleNameInputChange(event: UIEvent)\n\t{\n\t\tconst value = event.target.value;\n\n\t\tEventEmitter.emit('ProductList::onChangeFields', {\n\t\t\trowId: this.selector.getRowId(),\n\t\t\tfields: {\n\t\t\t\t'NAME': value\n\t\t\t}\n\t\t});\n\t}\n\n\tfocusName()\n\t{\n\t\trequestAnimationFrame(() => this.getNameInput().focus());\n\t}\n\n\tsearchInDialog(searchQuery: string = '')\n\t{\n\t\tif (!this.selector.isProductSearchEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst dialog = this.getDialog();\n\t\tif (dialog)\n\t\t{\n\t\t\tdialog.show();\n\t\t\tdialog.search(searchQuery);\n\t\t}\n\t}\n\n\thandleShowSearchDialog(event: UIEvent)\n\t{\n\t\tif (this.selector.isEmptyModel() || this.selector.isSimpleModel())\n\t\t{\n\t\t\tthis.selector.searchInDialog(event.target.value);\n\t\t}\n\t}\n\n\thandleNameInputBlur(event: UIEvent)\n\t{\n\t\t// timeout to toggle clear icon handler while cursor is inside of name input\n\t\tsetTimeout(() => {\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\n\t\t\tif (this.showDetailLink() && Type.isStringFilled(this.getValue()))\n\t\t\t{\n\t\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'block');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'none');\n\t\t\t\tthis.toggleIcon(this.getSearchIcon(), 'block');\n\t\t\t}\n\t\t}, 200);\n\n\t\tif (this.isSearchEnabled() && this.isEnabledEmptyProductError)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (this.selector.isEmptyModel())\n\t\t\t\t{\n\t\t\t\t\tthis.model.setError(\n\t\t\t\t\t\t'NOT_SELECTED_PRODUCT',\n\t\t\t\t\t\tLoc.getMessage('CATALOG_SELECTOR_SELECTED_PRODUCT_TITLE')\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.selector.layoutErrors();\n\t\t\t\t}\n\t\t\t}, 200);\n\t\t}\n\t}\n\n\thandleSearchIconClick(event: UIEvent)\n\t{\n\t\tthis.selector.searchInDialog();\n\t\tthis.selector.focusName();\n\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t}\n\n\tresetModel(title)\n\t{\n\t\tconst fields = this.selector.getModel().getFields();\n\t\tconst newModel = this.selector.createModel({isSimpleModel: true});\n\t\tthis.selector.setModel(newModel);\n\t\tfields['NAME'] = title;\n\t\tthis.selector.getModel().setFields(fields);\n\t}\n\n\tonProductSelect(event)\n\t{\n\t\tconst item = event.getData().item;\n\t\titem.getDialog().getTargetNode().value = item.getTitle();\n\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\n\t\tthis.resetModel(item.getTitle());\n\n\t\tthis.selector.getFileInput().unsubscribeImageInputEvents();\n\t\tthis.selector.clearLayout();\n\t\tthis.selector.layout();\n\n\t\tif (this.selector)\n\t\t{\n\t\t\tthis.selector.onProductSelect(item.getId(), {\n\t\t\t\tsaveProductFields: item.getCustomData().get('saveProductFields'),\n\t\t\t\tisNew: item.getCustomData().get('isNew')\n\t\t\t});\n\t\t}\n\n\t\titem.getDialog().hide();\n\t}\n\n\tcreateProduct(event): Promise\n\t{\n\t\tconst {searchQuery} = event.getData();\n\t\tthis.resetModel(searchQuery.getQuery());\n\t\treturn new Promise(\n\t\t\t(resolve, reject) => {\n\t\t\t\tconst dialog: Dialog = event.getTarget();\n\t\t\t\tconst fields = {\n\t\t\t\t\tNAME: searchQuery.getQuery(),\n\t\t\t\t\tIBLOCK_ID: this.selector.getIblockId()\n\t\t\t\t};\n\n\t\t\t\tconst price = this.selector.getModel().getField('PRICE', null);\n\t\t\t\tif (!Type.isNil(price))\n\t\t\t\t{\n\t\t\t\t\tfields['PRICE'] = price;\n\t\t\t\t}\n\n\t\t\t\tconst currency = this.selector.getModel().getField('CURRENCY', null);\n\t\t\t\tif (Type.isStringFilled(currency))\n\t\t\t\t{\n\t\t\t\t\tfields['CURRENCY'] = currency;\n\t\t\t\t}\n\n\t\t\t\tdialog.showLoader();\n\t\t\t\tajax.runAction(\n\t\t\t\t\t'catalog.productSelector.createProduct',\n\t\t\t\t\t{\n\t\t\t\t\t\tjson: {\n\t\t\t\t\t\t\tfields\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tdialog.hideLoader();\n\t\t\t\t\t\tconst item = dialog.addItem({\n\t\t\t\t\t\t\tid: response.data.id,\n\t\t\t\t\t\t\tentityId: 'product',\n\t\t\t\t\t\t\ttitle: searchQuery.getQuery(),\n\t\t\t\t\t\t\ttabs: dialog.getRecentTab().getId(),\n\t\t\t\t\t\t\tcustomData: {\n\t\t\t\t\t\t\t\tsaveProductFields: true,\n\t\t\t\t\t\t\t\tisNew: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (item)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem.select();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => reject());\n\t\t\t});\n\t}\n\n\tgetPlaceholder(): string\n\t{\n\t\treturn (\n\t\t\tthis.isSearchEnabled() && this.selector.isEmptyModel()\n\t\t\t\t? Loc.getMessage('CATALOG_SELECTOR_BEFORE_SEARCH_TITLE')\n\t\t\t\t: Loc.getMessage('CATALOG_SELECTOR_VIEW_NAME_TITLE')\n\t\t);\n\t}\n}\n","import {Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport './component.css';\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\nimport {ProductSelector} from 'catalog.product-selector';\n\nexport class ProductImageInput\n{\n\tonUploaderIsInitedHandler = this.handleOnUploaderIsInited.bind(this);\n\n\tconstructor(id, options = {})\n\t{\n\t\tthis.id = id || Text.getRandom();\n\t\tthis.selector = options.selector || null;\n\t\tif (!(this.selector instanceof ProductSelector))\n\t\t{\n\t\t\tthrow new Error('Product selector instance not found.');\n\t\t}\n\n\t\tthis.config = options.config || {};\n\t\tthis.setView(options.view);\n\n\t\tif (Type.isStringFilled(options.inputHtml))\n\t\t{\n\t\t\tthis.setInputHtml(options.inputHtml);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.restoreDefaultInputHtml();\n\t\t}\n\n\t\tthis.enableSaving = options.enableSaving;\n\n\t\tthis.uploaderFieldMap = {};\n\t\tif (this.isEnabledLiveSaving())\n\t\t{\n\t\t\tEventEmitter.subscribe('onUploaderIsInited', this.onUploaderIsInitedHandler);\n\t\t}\n\t}\n\n\thandleOnUploaderIsInited(event)\n\t{\n\t\tconst [id, uploader] = event.getCompatData();\n\t\tif (!this.isViewMode() && Type.isStringFilled(this.id) && this.id === id)\n\t\t{\n\t\t\tthis.uploaderFieldMap = {};\n\t\t\tEventEmitter.subscribe(uploader, 'onFileIsDeleted', this.onFileDelete.bind(this));\n\t\t\tEventEmitter.subscribe(uploader, 'onFileIsUploaded', this.onFileUpload.bind(this));\n\t\t\tEventEmitter.subscribe(uploader, 'onQueueIsChanged', this.onQueueIsChanged.bind(this));\n\t\t}\n\t}\n\n\tunsubscribeEvents()\n\t{\n\t\tif (this.isEnabledLiveSaving())\n\t\t{\n\t\t\tEventEmitter.unsubscribe('onUploaderIsInited', this.onUploaderIsInitedHandler);\n\t\t}\n\t}\n\n\tunsubscribeImageInputEvents()\n\t{\n\t\tif (Reflection.getClass('BX.UI.ImageInput'))\n\t\t{\n\t\t\tconst imageInput = BX.UI.ImageInput.getById(this.getId());\n\t\t\tif (imageInput)\n\t\t\t{\n\t\t\t\timageInput.unsubscribeEvents();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\tsetView(html)\n\t{\n\t\tthis.view = Type.isStringFilled(html) ? html : '';\n\t}\n\n\tsetInputHtml(html)\n\t{\n\t\tthis.inputHtml = Type.isStringFilled(html) ? html : '';\n\t}\n\n\trestoreDefaultInputHtml()\n\t{\n\t\tthis.inputHtml = `\n\t\t\t<div class='ui-image-input-container ui-image-input-img--disabled'>\n\t\t\t\t<div class='adm-fileinput-wrapper '>\n\t\t\t\t\t<div class='adm-fileinput-area mode-pict adm-fileinput-drag-area'></div>\n\t\t\t\t</div>\n\t\t\t</div>\n`\t\t;\n\t}\n\n\tisViewMode(): boolean\n\t{\n\t\treturn this.selector && this.selector.isViewMode();\n\t}\n\n\tisEnabledLiveSaving(): boolean\n\t{\n\t\treturn this.enableSaving;\n\t}\n\n\tlayout()\n\t{\n\t\tconst imageContainer = Tag.render`<div></div>`;\n\n\t\tRuntime.html(imageContainer, this.isViewMode() ? this.view : this.inputHtml);\n\n\t\treturn imageContainer;\n\t}\n\n\tonFileDelete(event: BaseEvent)\n\t{\n\t\tconst [, , , file] = event.getCompatData();\n\t\tconst fileId = file.fileId;\n\n\t\tif (this.isViewMode() || !this.selector)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst deleteResult = this.selector.getModel().removeMorePhotoItem(fileId);\n\t\tif (deleteResult)\n\t\t{\n\t\t\tthis.save();\n\t\t}\n\t}\n\n\tonQueueIsChanged(event: BaseEvent)\n\t{\n\t\tconst [, type, itemId, uploaderItem] = event.getCompatData();\n\t\tconst image = uploaderItem.file;\n\n\t\tif (\n\t\t\ttype === 'add'\n\t\t\t&& 'input_name' in image\n\t\t\t&& Type.isNil(this.uploaderFieldMap[itemId])\n\t\t)\n\t\t{\n\t\t\tthis.uploaderFieldMap[itemId] = image['input_name'];\n\t\t}\n\t}\n\n\tonFileUpload(event: BaseEvent)\n\t{\n\t\tconst [itemId, , params] = event.getCompatData();\n\n\t\tif (!Type.isObject(params)\n\t\t\t|| !('file' in params)\n\t\t\t|| !('files' in params.file)\n\t\t\t|| !('default' in params.file.files)\n\t\t\t|| this.isViewMode()\n\t\t\t|| !this.selector\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentUploadedFile = params['file']['files']['default'];\n\t\tconst photoItem = {\n\t\t\tfileId: itemId,\n\t\t\tdata: {\n\t\t\t\tname: currentUploadedFile.name,\n\t\t\t\ttype: currentUploadedFile.type,\n\t\t\t\ttmp_name: currentUploadedFile.path,\n\t\t\t\tsize: currentUploadedFile.size,\n\t\t\t\terror: null\n\t\t\t}\n\t\t};\n\t\tconst fileFieldName = this.uploaderFieldMap[itemId] || itemId;\n\t\tthis.selector.getModel().addMorePhotoItem(fileFieldName, photoItem);\n\n\t\tthis.save(true);\n\t}\n\n\tsave(rebuild)\n\t{\n\t\tif (this.selector)\n\t\t{\n\t\t\tthis.selector.saveFiles(rebuild);\n\t\t}\n\t}\n}","import {Base} from \"./base\";\n\nexport class Empty extends Base\n{\n}","import {Text, Type} from \"main.core\";\nimport {Base} from './base';\n\nexport class Product extends Base\n{\n\tisSaveable(): boolean\n\t{\n\t\treturn this.getConfig('saveProductFields', false);\n\t}\n\n\tisEnableFileSaving(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\tgetDetailPath(): string\n\t{\n\t\treturn this.getConfig('DETAIL_PATH', '');\n\t}\n\n\tremoveMorePhotoItem(fileId): boolean\n\t{\n\t\tfor (const index in this.morePhoto)\n\t\t{\n\t\t\tlet value = this.morePhoto[index];\n\n\t\t\tif (!Type.isObject(value))\n\t\t\t{\n\t\t\t\tvalue = Text.toInteger(value);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t(Type.isNumber(value) && value === Text.toInteger(fileId))\n\t\t\t\t|| (Type.isObject(value) && value.fileId === fileId)\n\t\t\t)\n\t\t\t{\n\t\t\t\tdelete this.morePhoto[index];\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n}","import {Product} from \"./product\";\n\nexport class Sku extends Product\n{\n\tgetProductId()\n\t{\n\t\treturn this.getConfig('productId');\n\t}\n}","import {Base} from \"./base\";\n\nexport class Simple extends Base\n{\n\tgetName(): string\n\t{\n\t\treturn this.getConfig('NAME', '');\n\t}\n}","import {ajax, Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {SkuTree} from 'catalog.sku-tree';\nimport {ProductSearchInput} from \"./product-search-input\";\nimport {ProductImageInput} from \"./product-image-input\";\nimport {Empty} from \"./models/empty\";\nimport {Sku} from \"./models/sku\";\nimport {Product} from \"./models/product\";\nimport {Base} from \"./models/base\";\nimport {Simple} from \"./models/simple\";\nimport 'ui.forms';\nimport './component.css';\n\nconst instances = new Map();\n\nexport class ProductSelector extends EventEmitter\n{\n\tstatic MODE_VIEW = 'view';\n\tstatic MODE_EDIT = 'edit';\n\n\tstatic PRODUCT_TYPE = 'product';\n\tstatic SKU_TYPE = 'sku';\n\n\tmode: ProductSelector.MODE_EDIT | ProductSelector.MODE_VIEW = ProductSelector.MODE_EDIT;\n\tcache = new Cache.MemoryCache();\n\tfileInput: ?ProductImageInput;\n\tsearchInput: ?ProductSearchInput;\n\tskuTreeInstance: ?SkuTree;\n\n\tvariationChangeHandler = this.handleVariationChange.bind(this);\n\tonChangeFieldsHandler = Runtime.debounce(this.onChangeFields, 500, this);\n\n\tstatic getById(id: string): ?ProductSelector\n\t{\n\t\treturn instances.get(id) || null;\n\t}\n\n\tconstructor(id, options = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Catalog.ProductSelector');\n\n\t\tthis.id = id || Text.getRandom();\n\t\toptions.inputFieldName = options.inputFieldName || 'NAME';\n\t\tthis.options = options || {};\n\t\tthis.iblockId = Text.toNumber(options.iblockId);\n\t\tthis.basePriceId = Text.toNumber(options.basePriceId);\n\n\t\tthis.setMode(options.mode);\n\n\t\tthis.model = this.createModel(options);\n\t\tthis.model.setFields(options.fields);\n\t\tthis.model.setMorePhotoValues(options.morePhotoValues);\n\t\tthis.model.setDetailPath(this.getConfig('DETAIL_PATH'));\n\n\t\tif (this.isSimpleModel() && this.isEnabledEmptyProductError())\n\t\t{\n\t\t\tthis.model.setError(\n\t\t\t\t'NOT_SELECTED_PRODUCT',\n\t\t\t\tLoc.getMessage('CATALOG_SELECTOR_SELECTED_PRODUCT_TITLE')\n\t\t\t);\n\t\t}\n\n\t\tthis.skuTree = options.skuTree || null;\n\t\tthis.setFileType(options.fileType);\n\n\t\tthis.layout();\n\n\t\tEventEmitter.subscribe('ProductList::onChangeFields', this.onChangeFieldsHandler);\n\n\t\tinstances.set(this.id, this);\n\t}\n\n\tcreateModel(options = {}): Base\n\t{\n\t\tif (options.isSimpleModel)\n\t\t{\n\t\t\treturn new Simple();\n\t\t}\n\n\t\tconst productId = Text.toInteger(options.productId) || 0;\n\t\tif (productId <= 0)\n\t\t{\n\t\t\treturn new Empty();\n\t\t}\n\n\t\tconst modelConfig = options?.config?.MODEL_CONFIG || {};\n\t\tconst skuId = Text.toInteger(options.skuId) || 0;\n\t\tif (skuId > 0 && skuId !== productId)\n\t\t{\n\t\t\treturn new Sku(skuId, {...modelConfig, ...{productId}});\n\t\t}\n\n\t\treturn new Product(productId, modelConfig);\n\t}\n\n\tsetModel(model: Base): void\n\t{\n\t\tthis.model = model;\n\t}\n\n\tgetModel(): Base\n\t{\n\t\treturn this.model;\n\t}\n\n\tisEmptyModel(): boolean\n\t{\n\t\treturn (this.getModel() instanceof Empty);\n\t}\n\n\tisSimpleModel(): boolean\n\t{\n\t\treturn (this.getModel() instanceof Simple);\n\t}\n\n\tsetMode(mode): void\n\t{\n\t\tif (!Type.isNil(mode))\n\t\t{\n\t\t\tthis.mode = mode === ProductSelector.MODE_VIEW ? ProductSelector.MODE_VIEW : ProductSelector.MODE_EDIT;\n\t\t}\n\t}\n\n\tsetFileType(fileType): void\n\t{\n\t\tthis.fileType = fileType === ProductSelector.SKU_TYPE ? ProductSelector.SKU_TYPE : ProductSelector.PRODUCT_TYPE;\n\t}\n\n\tisViewMode(): boolean\n\t{\n\t\treturn this.mode === ProductSelector.MODE_VIEW;\n\t}\n\n\tisSaveable(): boolean\n\t{\n\t\treturn !this.isViewMode() && this.model.isSaveable();\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetIblockId(): number\n\t{\n\t\treturn this.iblockId;\n\t}\n\n\tgetBasePriceId(): number\n\t{\n\t\treturn this.basePriceId;\n\t}\n\n\tgetConfig(name, defaultValue)\n\t{\n\t\treturn BX.prop.get(this.options.config, name, defaultValue);\n\t}\n\n\tgetRowId(): string\n\t{\n\t\treturn this.getConfig('ROW_ID');\n\t}\n\n\tgetFileInput(): ProductImageInput\n\t{\n\t\tif (!this.fileInput)\n\t\t{\n\t\t\tthis.fileInput = new ProductImageInput(\n\t\t\t\tthis.options.fileInputId,\n\t\t\t\t{\n\t\t\t\t\tselector: this,\n\t\t\t\t\tview: this.options.fileView,\n\t\t\t\t\tinputHtml: this.options.fileInput,\n\t\t\t\t\tenableSaving: this.getConfig('ENABLE_IMAGE_CHANGE_SAVING', false)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn this.fileInput;\n\t}\n\n\tisProductFileType(): boolean\n\t{\n\t\treturn this.fileType === ProductSelector.PRODUCT_TYPE;\n\t}\n\n\tisProductSearchEnabled(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_SEARCH', false) && this.getIblockId() > 0;\n\t}\n\n\tisImageFieldEnabled(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_IMAGE_INPUT', true) !== false;\n\t}\n\n\tisEnabledEmptyProductError(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_EMPTY_PRODUCT_ERROR', false);\n\t}\n\n\tisInputDetailLinkEnabled(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_INPUT_DETAIL_LINK', false) && Type.isStringFilled(this.model.getDetailPath());\n\t}\n\n\tgetWrapper(): HTMLElement\n\t{\n\t\tif (!this.wrapper)\n\t\t{\n\t\t\tthis.wrapper = document.getElementById(this.id);\n\t\t}\n\n\t\treturn this.wrapper;\n\t}\n\n\trenderTo(node)\n\t{\n\t\tthis.clearLayout();\n\t\tthis.wrapper = node;\n\t\tthis.layout();\n\t}\n\n\tlayout()\n\t{\n\t\tconst wrapper = this.getWrapper();\n\t\tif (!wrapper)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.defineWrapperClass(wrapper);\n\t\tconst block = Tag.render`<div class=\"catalog-product-field-inner\"></div>`;\n\t\twrapper.appendChild(block);\n\t\tblock.appendChild(this.layoutNameBlock());\n\n\t\tif (this.isImageFieldEnabled())\n\t\t{\n\t\t\tif (!Reflection.getClass('BX.UI.ImageInput'))\n\t\t\t{\n\t\t\t\tajax\n\t\t\t\t\t.runAction(\t'catalog.productSelector.getFileInput', {\n\t\t\t\t\t\tjson:{\n\t\t\t\t\t\t\tiblockId: this.iblockId\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tthis.layoutImage();\n\t\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.layoutImage();\n\t\t\t}\n\t\t\tblock.appendChild(this.getImageContainer());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(wrapper, 'catalog-product-field-no-image');\n\t\t}\n\n\t\twrapper.appendChild(this.getErrorContainer());\n\t\tthis.layoutErrors();\n\n\t\tthis.layoutSkuTree();\n\t\tthis.subscribeToVariationChange();\n\t}\n\n\tfocusName(): this\n\t{\n\t\tif (this.searchInput)\n\t\t{\n\t\t\tthis.searchInput.focusName();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsearchInDialog(searchQuery: string = ''): this\n\t{\n\t\tif (this.searchInput)\n\t\t{\n\t\t\tthis.searchInput.searchInDialog(searchQuery);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetImageContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('imageContainer', () => (\n\t\t\tTag.render`<div class=\"catalog-product-img\"></div>`\n\t\t));\n\t}\n\n\tgetErrorContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('errorContainer', () => (\n\t\t\tTag.render`<div class=\"catalog-product-error\"></div>`\n\t\t));\n\t}\n\n\tlayoutErrors()\n\t{\n\t\tthis.getErrorContainer().innerHTML = '';\n\t\tif (!this.model.hasErrors())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst errors = this.model.getErrors();\n\t\tfor (const code in errors)\n\t\t{\n\t\t\tthis.getErrorContainer().appendChild(\n\t\t\t\tTag.render`<div class=\"catalog-product-error-item\">${errors[code]}</div>`\n\t\t\t);\n\t\t}\n\n\t\tif (this.searchInput)\n\t\t{\n\t\t\tDom.addClass(this.searchInput.getNameBlock(), 'ui-ctl-danger');\n\t\t}\n\t}\n\n\tlayoutImage()\n\t{\n\t\tthis.getImageContainer().innerHTML = '';\n\t\tthis.getImageContainer().appendChild(this.getFileInput().layout());\n\t\tthis.refreshImageSelectorId = null;\n\t}\n\n\tclearState(): void\n\t{\n\t\tthis.model = this.createModel();\n\t\tthis.fileInput.restoreDefaultInputHtml();\n\t\tthis.skuTree = null;\n\t\tthis.skuTreeInstance = null;\n\t\tthis.refreshImageSelectorId = null;\n\t}\n\n\tclearLayout(): void\n\t{\n\t\tconst wrapper = this.getWrapper();\n\t\tif (wrapper)\n\t\t{\n\t\t\tEvent.unbindAll(wrapper);\n\t\t\twrapper.innerHTML = '';\n\t\t}\n\n\t\tthis.unsubscribeToVariationChange();\n\t}\n\n\tunsubscribeEvents()\n\t{\n\t\tthis.unsubscribeToVariationChange();\n\t\tthis.getFileInput().unsubscribeImageInputEvents();\n\t\tthis.getFileInput().unsubscribeEvents();\n\n\t\tEventEmitter.unsubscribe('ProductList::onChangeFields', this.onChangeFieldsHandler);\n\t}\n\n\tdefineWrapperClass(wrapper)\n\t{\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tDom.addClass(wrapper, 'catalog-product-view');\n\t\t\tDom.removeClass(wrapper, 'catalog-product-edit');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(wrapper, 'catalog-product-edit');\n\t\t\tDom.removeClass(wrapper, 'catalog-product-view');\n\t\t}\n\t}\n\n\tgetNameBlockView(): HTMLElement\n\t{\n\t\tconst productName = Text.encode(this.model.getField('NAME'));\n\t\tconst namePlaceholder = Loc.getMessage('CATALOG_SELECTOR_VIEW_NAME_TITLE');\n\n\t\tif (this.getModel().getDetailPath())\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<a href=\"${this.getModel().getDetailPath()}\" title=\"${namePlaceholder}\">${productName}</a>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`<span title=\"${namePlaceholder}\">${productName}</span>`;\n\n\t}\n\n\tlayoutNameBlock(): HTMLElement\n\t{\n\t\tconst block = Tag.render`<div class=\"catalog-product-field-input\"></div>`;\n\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tblock.appendChild(this.getNameBlockView());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.searchInput = new ProductSearchInput(this.id, {\n\t\t\t\tselector: this,\n\t\t\t\tmodel: this.getModel(),\n\t\t\t\tinputName: this.options.inputFieldName,\n\t\t\t\tisSearchEnabled: this.isProductSearchEnabled(),\n\t\t\t\tisEnabledEmptyProductError: this.isEnabledEmptyProductError(),\n\t\t\t\tiblockId: this.getIblockId(),\n\t\t\t\tbasePriceId: this.getBasePriceId(),\n\t\t\t\tisEnabledDetailLink: this.isInputDetailLinkEnabled()\n\t\t\t});\n\t\t\tblock.appendChild(this.searchInput.layout());\n\t\t}\n\n\t\treturn block;\n\t}\n\n\tupdateSkuTree(tree): void\n\t{\n\t\tthis.skuTree = tree;\n\t\tthis.skuTreeInstance = null;\n\t}\n\n\tgetSkuTreeInstance(): SkuTree\n\t{\n\t\tif (this.skuTree && !this.skuTreeInstance)\n\t\t{\n\t\t\tthis.skuTreeInstance = new SkuTree({\n\t\t\t\tskuTree: this.skuTree,\n\t\t\t\tselectable: this.getConfig('ENABLE_SKU_SELECTION', true),\n\t\t\t\thideUnselected: this.getConfig('HIDE_UNSELECTED_ITEMS', false),\n\t\t\t});\n\t\t}\n\n\t\treturn this.skuTreeInstance;\n\t}\n\n\tlayoutSkuTree(): void\n\t{\n\t\tconst skuTree = this.getSkuTreeInstance();\n\t\tconst wrapper = this.getWrapper();\n\n\t\tif (skuTree && wrapper)\n\t\t{\n\t\t\tconst skuTreeWrapper = skuTree.layout();\n\n\t\t\twrapper.appendChild(skuTreeWrapper);\n\t\t}\n\t}\n\n\tsubscribeToVariationChange()\n\t{\n\t\tconst skuTree = this.getSkuTreeInstance();\n\t\tif (skuTree)\n\t\t{\n\t\t\tskuTree.subscribe('SkuProperty::onChange', this.variationChangeHandler);\n\t\t}\n\t}\n\n\tunsubscribeToVariationChange()\n\t{\n\t\tconst skuTree = this.getSkuTreeInstance();\n\t\tif (skuTree)\n\t\t{\n\t\t\tskuTree.unsubscribe('SkuProperty::onChange', this.variationChangeHandler);\n\t\t}\n\t}\n\n\thandleVariationChange(event)\n\t{\n\t\tconst [skuFields] = event.getData();\n\t\tconst productId = Text.toNumber(skuFields.PARENT_PRODUCT_ID);\n\t\tconst variationId = Text.toNumber(skuFields.ID);\n\n\t\tif (productId <= 0 || variationId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.model.setSaveable(false);\n\t\tthis.emit('onBeforeChange', {\n\t\t\tselectorId: this.getId(),\n\t\t\trowId: this.getRowId()\n\t\t});\n\n\t\tajax.runAction(\n\t\t\t'catalog.productSelector.getSelectedSku',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\tvariationId,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tpriceId: this.basePriceId,\n\t\t\t\t\t\turlBuilder: this.getConfig('URL_BUILDER_CONTEXT')\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(response => this.processResponse(response, {...this.options.config}));\n\t}\n\n\tonChangeFields(event)\n\t{\n\t\tconst eventData = event.getData();\n\n\t\tif (!this.isSaveable() || eventData.rowId !== this.getRowId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isNil(eventData.productId) && eventData.productId !== this.getModel().getProductId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fields = eventData.fields;\n\t\tconst priceValue = Text.toNumber(fields.PRICE);\n\t\tif (priceValue > 0 && Type.isStringFilled(fields.CURRENCY))\n\t\t{\n\t\t\tfields.PRICES = {};\n\t\t\tfields.PRICES[this.getBasePriceId()] = {\n\t\t\t\tPRICE: priceValue,\n\t\t\t\tCURRENCY: fields.CURRENCY\n\t\t\t};\n\t\t}\n\n\t\tthis.updateProduct(fields);\n\t}\n\n\tupdateProduct(fields)\n\t{\n\t\tif (!Type.isPlainObject(fields))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.getModel().getId() <= 0 || this.getIblockId() <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tajax.runAction(\n\t\t\t'catalog.productSelector.updateProduct',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\tid: this.getModel().getId(),\n\t\t\t\t\tiblockId: this.getIblockId(),\n\t\t\t\t\tupdateFields: fields\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tsaveFiles(rebuild)\n\t{\n\t\tif (this.isEmptyModel() || this.isSimpleModel())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst imageValues = this.getModel().getMorePhotoValues();\n\t\tif (this.submitFileTimeOut)\n\t\t{\n\t\t\tclearTimeout(this.submitFileTimeOut);\n\t\t}\n\n\t\tconst requestId = Text.getRandom(20);\n\t\tthis.refreshImageSelectorId = requestId;\n\t\tthis.submitFileTimeOut = setTimeout(() => {\n\t\t\tajax.runAction(\n\t\t\t\t'catalog.productSelector.saveMorePhoto',\n\t\t\t\t{\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tproductId: this.model.getProductId(),\n\t\t\t\t\t\tvariationId: this.model.getId(),\n\t\t\t\t\t\tiblockId: this.getIblockId(),\n\t\t\t\t\t\timageValues\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then((response) => {\n\t\t\t\tif (!rebuild && this.refreshImageSelectorId === requestId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.getFileInput().setId(response.data.id);\n\t\t\t\tthis.getFileInput().setInputHtml(response.data.input);\n\t\t\t\tthis.getFileInput().setView(response.data.preview);\n\t\t\t\tthis.getModel().setMorePhotoValues(response.data.values);\n\t\t\t\tif (this.isImageFieldEnabled())\n\t\t\t\t{\n\t\t\t\t\tthis.layoutImage();\n\t\t\t\t}\n\t\t\t});\n\t\t}, 500);\n\t}\n\n\tonProductSelect(productId, itemConfig)\n\t{\n\t\tthis.emit('onBeforeChange', {\n\t\t\tselectorId: this.getId(),\n\t\t\trowId: this.getRowId()\n\t\t});\n\n\t\tthis.productSelectAjaxAction(productId, itemConfig);\n\t}\n\n\tproductSelectAjaxAction(\n\t\tproductId,\n\t\titemConfig = {\n\t\t\tsaveProductFields: false,\n\t\t\tisNew: false\n\t\t}\n\t)\n\t{\n\t\tajax\n\t\t\t.runAction(\n\t\t\t\t'catalog.productSelector.getProduct',\n\t\t\t\t{\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tproductId,\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tpriceId: this.basePriceId,\n\t\t\t\t\t\t\turlBuilder: this.getConfig('URL_BUILDER_CONTEXT')\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t\t.then(response => this.processResponse(response, {...this.options.config, ...itemConfig}, true));\n\t}\n\n\tprocessResponse(response, config = {}, isProductAction = false)\n\t{\n\t\tconst data = response?.data || null;\n\n\t\tthis.getFileInput().unsubscribeImageInputEvents();\n\t\tif (data)\n\t\t{\n\t\t\tthis.changeSelectedElement(data, config);\n\t\t}\n\t\telse if (isProductAction)\n\t\t{\n\t\t\tthis.clearState();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.productSelectAjaxAction(this.getModel().getProductId());\n\t\t}\n\n\t\tthis.unsubscribeToVariationChange();\n\n\t\tthis.clearLayout();\n\t\tthis.layout();\n\n\t\tconst fields = data?.fields || null;\n\n\t\tthis.emit('onChange', {\n\t\t\tselectorId: this.id,\n\t\t\trowId: this.getRowId(),\n\t\t\tisNew: config.isNew || false,\n\t\t\tfields\n\t\t});\n\t}\n\n\tchangeSelectedElement(data, config)\n\t{\n\t\tconst productId = Text.toInteger(data.productId);\n\t\tconst productChanged = this.getModel().getId() !== productId;\n\n\t\tif (productChanged)\n\t\t{\n\t\t\tconst skuId = Text.toInteger(data.skuId);\n\t\t\tif (skuId > 0 && skuId !== productId)\n\t\t\t{\n\t\t\t\tconfig.productId = productId;\n\t\t\t\tthis.model = new Sku(skuId, config);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.model = new Product(productId, config);\n\t\t\t}\n\t\t}\n\n\t\tthis.getModel().setFields(data.fields);\n\n\t\tconst imageField = {\n\t\t\tid: '',\n\t\t\tinput: '',\n\t\t\tpreview: '',\n\t\t\tvalues: []\n\t\t};\n\n\t\tif (Type.isObject(data.image))\n\t\t{\n\t\t\timageField.id = data.image.id;\n\t\t\timageField.input = data.image.input;\n\t\t\timageField.preview = data.image.preview;\n\t\t\timageField.values = data.image.values;\n\t\t\tthis.getModel().setFileType(data.fileType);\n\t\t}\n\n\t\tthis.getFileInput().setId(imageField.id);\n\t\tthis.getFileInput().setInputHtml(imageField.input);\n\t\tthis.getFileInput().setView(imageField.preview);\n\n\t\tthis.getModel().setMorePhotoValues(imageField.values);\n\n\t\tif (data.detailUrl)\n\t\t{\n\t\t\tthis.getModel().setDetailPath(data.detailUrl);\n\t\t}\n\n\t\tif (Type.isObject(data.skuTree))\n\t\t{\n\t\t\tthis.updateSkuTree(data.skuTree);\n\t\t}\n\t}\n}\n"],"names":["Base","id","config","Text","getRandom","errors","setMorePhotoValues","morePhoto","setFields","fields","value","saveProductFields","getConfig","name","defaultValue","BX","prop","get","fieldName","Type","isObject","code","text","Object","keys","length","values","isPlainObject","fileId","fileType","DETAIL_PATH","ProductSearchInput","options","Cache","MemoryCache","selector","ProductSelector","Error","model","isEnabledSearch","isSearchEnabled","isEnabledDetailLink","isEnabledEmptyProductError","inputName","getField","icon","isDomNode","Dom","style","cache","remember","Tag","render","getNameTag","getNameInput","getHiddenNameInput","isNew","Loc","getMessage","encode","getValue","getPlaceholder","handleNameInputHiddenChange","bind","event","target","handleClearIconClick","getDetailPath","handleSearchIconClick","block","isStringFilled","toggleIcon","getClearIcon","appendChild","showDetailLink","getArrowIcon","iconValue","getSearchIcon","Event","handleShowSearchDialog","handleNameInputBlur","handleNameInputKeyDown","handleIconsSwitchingOnNameInput","isSaveable","handleNameInputChange","getNameBlock","Dialog","height","context","targetNode","enableSearch","multiple","dropdownMode","searchTabOptions","stub","stubOptions","title","message","subtitle","arrow","searchOptions","allowCreateItem","events","onProductSelect","createProduct","entities","iblockId","getIblockId","basePriceId","getBasePriceId","dialog","getDialog","key","getActiveTab","getSearchTab","preventDefault","Browser","isMac","metaKey","ctrlKey","getFooter","createItem","isProductSearchEnabled","isEmptyModel","clearState","clearLayout","layout","searchInDialog","focusName","emit","selectorId","getId","rowId","getRowId","stopPropagation","EventEmitter","requestAnimationFrame","focus","searchQuery","show","search","isSimpleModel","setTimeout","setError","layoutErrors","getModel","getFields","newModel","createModel","setModel","item","getData","getTargetNode","getTitle","resetModel","getFileInput","unsubscribeImageInputEvents","getCustomData","hide","getQuery","Promise","resolve","reject","getTarget","NAME","IBLOCK_ID","price","isNil","currency","showLoader","ajax","runAction","json","then","response","hideLoader","addItem","data","entityId","tabs","getRecentTab","customData","select","catch","ProductImageInput","handleOnUploaderIsInited","setView","view","inputHtml","setInputHtml","restoreDefaultInputHtml","enableSaving","uploaderFieldMap","isEnabledLiveSaving","subscribe","onUploaderIsInitedHandler","getCompatData","uploader","isViewMode","onFileDelete","onFileUpload","onQueueIsChanged","unsubscribe","Reflection","getClass","imageInput","UI","ImageInput","getById","unsubscribeEvents","html","imageContainer","Runtime","file","deleteResult","removeMorePhotoItem","save","type","itemId","uploaderItem","image","params","files","currentUploadedFile","photoItem","tmp_name","path","size","error","fileFieldName","addMorePhotoItem","rebuild","saveFiles","Empty","Product","index","toInteger","isNumber","Sku","Simple","instances","Map","MODE_EDIT","handleVariationChange","debounce","onChangeFields","setEventNamespace","inputFieldName","toNumber","setMode","mode","morePhotoValues","setDetailPath","skuTree","setFileType","onChangeFieldsHandler","set","productId","modelConfig","MODEL_CONFIG","skuId","MODE_VIEW","SKU_TYPE","PRODUCT_TYPE","fileInput","fileInputId","fileView","wrapper","document","getElementById","node","getWrapper","defineWrapperClass","layoutNameBlock","isImageFieldEnabled","layoutImage","getImageContainer","addClass","getErrorContainer","layoutSkuTree","subscribeToVariationChange","searchInput","innerHTML","hasErrors","getErrors","refreshImageSelectorId","skuTreeInstance","unbindAll","unsubscribeToVariationChange","removeClass","productName","namePlaceholder","getNameBlockView","isInputDetailLinkEnabled","tree","SkuTree","selectable","hideUnselected","getSkuTreeInstance","skuTreeWrapper","variationChangeHandler","skuFields","PARENT_PRODUCT_ID","variationId","ID","setSaveable","priceId","urlBuilder","processResponse","eventData","getProductId","priceValue","PRICE","CURRENCY","PRICES","updateProduct","updateFields","imageValues","getMorePhotoValues","submitFileTimeOut","clearTimeout","requestId","setId","input","preview","itemConfig","productSelectAjaxAction","isProductAction","changeSelectedElement","productChanged","imageField","detailUrl","updateSkuTree"],"mappings":"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"}