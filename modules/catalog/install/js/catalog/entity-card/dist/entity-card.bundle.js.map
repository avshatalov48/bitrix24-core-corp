{"version":3,"file":"entity-card.bundle.js","sources":["../src/tab/lazy-loader.js","../src/tab/tab.js","../src/tab/manager.js","../src/iblock-section/field.js","../src/fields-factory.js","../src/iblock-section/controller.js","../src/variation-grid/controller.js","../src/controllers-factory.js","../src/field-configurator/iblock-directory-field-item.js","../src/field-configurator/iblock-field-configurator.js","../src/field-configurator/iblock-field-configuration-manager.js","../src/field-configurator/grid-field-configurator.js","../src/field-configurator/grid-field-configuration-manager.js","../src/entity-card.js"],"sourcesContent":["import {Text, Type} from 'main.core';\n\nexport default class LazyLoader\n{\n\tconstructor(id, settings)\n\t{\n\t\tthis.id = Type.isStringFilled(id) ? id : Text.getRandom();\n\t\tthis.settings = Type.isObjectLike(settings) ? settings : {};\n\n\t\tthis.container = this.settings.container;\n\t\tif (!this.container)\n\t\t{\n\t\t\tthrow 'Error: Could not find container.';\n\t\t}\n\n\t\tthis.serviceUrl = this.settings.serviceUrl || '';\n\t\tif (!Type.isStringFilled(this.serviceUrl))\n\t\t{\n\t\t\tthrow 'Error. Could not find service url.';\n\t\t}\n\n\t\tthis.tabId = this.settings.tabId || '';\n\t\tif (!Type.isStringFilled(this.tabId))\n\t\t{\n\t\t\tthrow 'Error: Could not find tab id.';\n\t\t}\n\n\t\tthis.params = Type.isObjectLike(this.settings.componentData) ? this.settings.componentData : {};\n\n\t\tthis.isRequestRunning = false;\n\t\tthis.loaded = false;\n\t}\n\n\tisLoaded()\n\t{\n\t\treturn this.loaded;\n\t}\n\n\tload()\n\t{\n\t\tif (!this.isLoaded())\n\t\t{\n\t\t\tthis.startRequest({...this.params, ...{'TABID': this.tabId}});\n\t\t}\n\t}\n\n\tstartRequest(params)\n\t{\n\t\tif (this.isRequestRunning)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.isRequestRunning = true;\n\n\t\tBX.ajax({\n\t\t\turl: this.serviceUrl,\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'html',\n\t\t\tdata: {\n\t\t\t\t'LOADERID': this.id,\n\t\t\t\t'PARAMS': params\n\t\t\t},\n\t\t\tonsuccess: this.onRequestSuccess.bind(this),\n\t\t\tonfailure: this.onRequestFailure.bind(this)\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tonRequestSuccess(data)\n\t{\n\t\tthis.isRequestRunning = false;\n\t\tthis.container.innerHTML = data;\n\t\tthis.loaded = true;\n\t}\n\n\tonRequestFailure()\n\t{\n\t\tthis.isRequestRunning = false;\n\t\tthis.loaded = true;\n\t}\n}","import {Dom, Event, Text, Type} from 'main.core';\nimport LazyLoader from './lazy-loader';\n\nexport default class Tab\n{\n\tconstructor(id, settings)\n\t{\n\t\tthis.id = Type.isStringFilled(id) ? id : Text.getRandom();\n\t\tthis.settings = Type.isObjectLike(settings) ? settings : {};\n\t\tthis.data = Type.isObjectLike(this.settings.data) ? this.settings.data : {};\n\n\t\tthis.manager = settings.manager || null;\n\n\t\tthis.container = this.settings.container;\n\t\tthis.menuContainer = this.settings.menuContainer;\n\n\t\tthis.active = Type.isBoolean(this.data.active) ? this.data.active : false;\n\t\tthis.enabled = Type.isBoolean(this.data.enabled) ? this.data.enabled : true;\n\n\t\tEvent.bind(\n\t\t\tthis.menuContainer.querySelector('a.catalog-entity-section-tab-link'),\n\t\t\t'click',\n\t\t\tthis.onMenuClick.bind(this)\n\t\t);\n\n\t\tthis.loader = null;\n\n\t\tif (Type.isObjectLike(this.data.loader))\n\t\t{\n\t\t\tthis.loader = new LazyLoader(this.id, {\n\t\t\t\t...this.data.loader,\n\t\t\t\t...{\n\t\t\t\t\ttabId: this.id,\n\t\t\t\t\tcontainer: this.container\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tisEnabled()\n\t{\n\t\treturn this.enabled;\n\t}\n\n\tisActive()\n\t{\n\t\treturn this.active;\n\t}\n\n\tsetActive(active)\n\t{\n\t\tactive = !!active;\n\n\t\tif (this.isActive() === active)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.active = active;\n\n\t\tif (this.isActive())\n\t\t{\n\t\t\tthis.showTab()\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideTab()\n\t\t}\n\t}\n\n\tshowTab()\n\t{\n\t\tDom.addClass(this.container, 'catalog-entity-section-tab-content-show');\n\t\tDom.removeClass(this.container, 'catalog-entity-section-tab-content-hide');\n\t\tDom.addClass(this.menuContainer, 'catalog-entity-section-tab-current');\n\n\t\tthis.container.style.display = '';\n\t\tthis.container.style.position = 'absolute';\n\t\tthis.container.style.top = 0;\n\t\tthis.container.style.left = 0;\n\t\tthis.container.style.width = '100%';\n\n\t\t(new BX.easing({\n\t\t\tduration: 350,\n\t\t\tstart: {opacity: 0, translateX: 100},\n\t\t\tfinish: {opacity: 100, translateX: 0},\n\t\t\ttransition: BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\tstep: (state) => {\n\t\t\t\tthis.container.style.opacity = state.opacity / 100;\n\t\t\t\tthis.container.style.transform = 'translateX(' + state.translateX + '%)';\n\t\t\t},\n\t\t\tcomplete: () => {\n\t\t\t\tDom.removeClass(this.container, 'catalog-entity-section-tab-content-show');\n\t\t\t\tthis.container.style.cssText = '';\n\n\t\t\t\tEvent.EventEmitter.emit(window, 'onEntityDetailsTabShow', [this]);\n\t\t\t}\n\t\t})).animate();\n\n\t}\n\n\thideTab()\n\t{\n\t\tDom.addClass(this.container, 'catalog-entity-section-tab-content-hide');\n\t\tDom.removeClass(this.container, 'catalog-entity-section-tab-content-show');\n\t\tDom.removeClass(this.menuContainer, 'catalog-entity-section-tab-current');\n\n\t\t(new BX.easing({\n\t\t\tduration: 350,\n\t\t\tstart: {opacity: 100},\n\t\t\tfinish: {opacity: 0},\n\t\t\ttransition: BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\tstep: (state) => {\n\t\t\t\tthis.container.style.opacity = state.opacity / 100;\n\t\t\t},\n\t\t\tcomplete: () => {\n\t\t\t\tthis.container.style.display = 'none';\n\t\t\t\tthis.container.style.transform = 'translateX(100%)';\n\t\t\t\tthis.container.style.opacity = 0;\n\t\t\t}\n\t\t})).animate();\n\t}\n\n\tonMenuClick(event)\n\t{\n\t\tif (this.isEnabled())\n\t\t{\n\t\t\tif (this.loader && !this.loader.isLoaded())\n\t\t\t{\n\t\t\t\tthis.loader.load();\n\t\t\t}\n\n\t\t\tthis.manager.selectItem(this);\n\t\t}\n\n\t\tevent.preventDefault()\n\t}\n}","import {Text, Type} from 'main.core';\nimport Tab from './tab';\n\nexport default class Manager\n{\n\tconstructor(id, settings)\n\t{\n\t\tthis.id = Type.isStringFilled(id) ? id : Text.getRandom();\n\t\tthis.settings = Type.isObjectLike(settings) ? settings : {};\n\n\t\tthis.container = this.settings.container;\n\t\tthis.menuContainer = this.settings.menuContainer;\n\n\t\tthis.items = [];\n\n\t\tif (Type.isArray(this.settings.data))\n\t\t{\n\t\t\tthis.settings.data.forEach(item => {\n\t\t\t\tthis.items.push(\n\t\t\t\t\tnew Tab(item.id, {\n\t\t\t\t\t\tmanager: this,\n\t\t\t\t\t\tdata: item,\n\t\t\t\t\t\tcontainer: this.container.querySelector('[data-tab-id=\"' + item.id + '\"]'),\n\t\t\t\t\t\tmenuContainer: this.menuContainer.querySelector('[data-tab-id=\"' + item.id + '\"]')\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tfindItemById(id)\n\t{\n\t\treturn this.items.find(item => item.id === id) || null;\n\t}\n\n\tselectItem(item)\n\t{\n\t\tthis.items.forEach(current => current.setActive(current === item));\n\t}\n}","import './field.css'\nimport {ajax, Dom, Event, Loc, Runtime, Tag, Text} from 'main.core'\nimport {type BaseEvent, EventEmitter} from 'main.core.events'\n\nexport default class IblockSectionField extends BX.UI.EntityEditorField\n{\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\n\t\tthis.innerWrapper = null;\n\t\tthis.tileSelector = null;\n\t}\n\n\tgetContentWrapper()\n\t{\n\t\treturn this.innerWrapper;\n\t}\n\n\tlayout(options = {})\n\t{\n\t\tif (this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ensureWrapperCreated({classNames: ['catalog-entity-editor-content-block-field-iblock-section']});\n\t\tthis.adjustWrapper();\n\n\t\tif (this.isNeedToDisplay())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createTitleNode(this.getTitle()));\n\n\t\t\tif (this._mode === BX.UI.EntityEditorMode.edit)\n\t\t\t{\n\t\t\t\tthis.drawEditMode();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.drawViewMode();\n\t\t\t}\n\n\t\t\tif (this.isContextMenuEnabled())\n\t\t\t{\n\t\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\n\t\t\t}\n\t\t}\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\tdrawEditMode()\n\t{\n\t\tthis.defaultInput = Tag.render`<input type=\"hidden\" name=\"${this.getName()}[]\" value=\"0\">`;\n\t\tthis._wrapper.appendChild(this.defaultInput);\n\n\t\tthis.innerWrapper = Tag.render`<div class=\"ui-entity-editor-content-block\"></div>`;\n\t\tthis._wrapper.appendChild(this.innerWrapper);\n\n\t\tajax.runComponentAction(\n\t\t\t'bitrix:catalog.productcard.iblocksectionfield',\n\t\t\t'lazyLoad',\n\t\t\t{\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: {\n\t\t\t\t\tiblockId: this.getIblockId(),\n\t\t\t\t\tproductId: this.getProductId(),\n\t\t\t\t\tselectedSectionIds: this.getValue()\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(this.renderFromResponse.bind(this))\n\t\t\t.catch(response => {\n\t\t\t\tthrow new Error(response.errors.join(\"\\n\"));\n\t\t\t})\n\t\t;\n\t}\n\n\trenderFromResponse(response)\n\t{\n\t\tif (!this._wrapper)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tRuntime.html(this.innerWrapper, response.data.html, {\n\t\t\tcallback: this.initTileSelector.bind(this)\n\t\t});\n\t}\n\n\tinitTileSelector()\n\t{\n\t\tif (BX.UI && BX.UI.TileSelector)\n\t\t{\n\t\t\tthis.tileSelector = BX.UI.TileSelector.getById(this.getTileSelectorId());\n\n\t\t\tif (!this.tileSelector)\n\t\t\t{\n\t\t\t\tthrow new Error('Tile selector `' + this.getTileSelectorId() + '` not found.');\n\t\t\t}\n\t\t\tif (this.tileSelector)\n\t\t\t{\n\t\t\t\tthis.changeDisplay(this.tileSelector.buttonAdd, false);\n\t\t\t}\n\n\t\t\tEventEmitter.subscribe(this.tileSelector, this.tileSelector.events.buttonSelectFirst, this.tileSelectorSelectFirstHandler.bind(this));\n\t\t\tEventEmitter.subscribe(this.tileSelector, this.tileSelector.events.input, this.onInputSearch.bind(this));\n\t\t\tEventEmitter.subscribe(this.tileSelector, this.tileSelector.events.buttonAdd, this.onButtonAdd.bind(this));\n\t\t\tEventEmitter.subscribe(this.tileSelector, this.tileSelector.events.buttonSelect, this.onButtonSelect.bind(this));\n\t\t\tEventEmitter.subscribe(this.tileSelector, this.tileSelector.events.tileAdd, this.markAsChanged.bind(this));\n\t\t\tEventEmitter.subscribe(this.tileSelector, this.tileSelector.events.tileRemove, this.markAsChanged.bind(this));\n\t\t\tEventEmitter.subscribe(this.tileSelector, this.tileSelector.events.search, this.onInputEnd.bind(this));\n\t\t\tEventEmitter.subscribe(this.tileSelector, this.tileSelector.events.searcherInit, this.onSearcherInit.bind(this));\n\t\t\tEvent.bind(this.tileSelector.input, 'blur', this.onBlur.bind(this));\n\t\t\tif (this.tileSelector.buttonAdd)\n\t\t\t{\n\t\t\t\tthis.tileSelector.buttonAdd.style.top = 'auto';\n\t\t\t\tthis.tileSelector.buttonAdd.style.bottom = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeDisplay(node, isShow)\n\t{\n\t\tif (!node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnode.style.display = isShow ? '' : 'none';\n\t}\n\n\tmarkAsChanged(event: BaseEvent)\n\t{\n\t\tsuper.markAsChanged();\n\t\tEventEmitter.emit(this.getEditor(), 'IblockSectionField:onChange', [this, ...event.getData()]);\n\t}\n\n\tonBlur()\n\t{\n\t\twindow.setTimeout(() => {\n\t\t\tthis.tileSelector.onInputEnd()\n\t\t}, 500);\n\t}\n\n\tonSearcherInit(event)\n\t{\n\t\tconst [seacher] = event.getData();\n\t\tconst popup = BX.PopupWindowManager.getPopupById(seacher.id);\n\t\tif (popup)\n\t\t{\n\t\t\tpopup.destroy();\n\t\t}\n\t\tif (seacher.categoryContainer)\n\t\t{\n\t\t\tseacher.categoryContainer.parentNode.removeChild(seacher.categoryContainer);\n\t\t}\n\t}\n\n\tonInputEnd()\n\t{\n\t\tthis.changeDisplay(this.tileSelector.buttonAdd, false);\n\t}\n\n\tgetTileSelectorId()\n\t{\n\t\tconst iblockId = this.getIblockId() || 0;\n\t\tconst productId = this.getProductId() || 0;\n\n\t\treturn `catalog-iblocksectionfield-${iblockId}-${productId}`;\n\t}\n\n\tonButtonSelect()\n\t{\n\t\tif (this.tileSelector)\n\t\t{\n\t\t\tthis.tileSelector.showSearcher();\n\t\t}\n\t}\n\n\tonButtonAdd()\n\t{\n\t\tif (!BX.type.isNotEmptyString(this.tileSelector.input.value))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tajax.runComponentAction(\n\t\t\t'bitrix:catalog.productcard.iblocksectionfield',\n\t\t\t'addSection',\n\t\t\t{\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: {\n\t\t\t\t\tiblockId: this.getIblockId(),\n\t\t\t\t\tname: this.tileSelector.input.value\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(this.onAddSection.bind(this))\n\t\t\t.catch(response => {\n\t\t\t\tthrow new Error(response.errors.join(\"\\n\"));\n\t\t\t})\n\t\t;\n\t}\n\n\tonAddSection(response)\n\t{\n\t\tconst item = this.tileSelector.searcher.addItem('all', response.data.id, response.data.name);\n\t\tthis.tileSelector.searcher.onItemClick(item);\n\t\tif (this.tileSelector.searcher.popup)\n\t\t{\n\t\t\tthis.tileSelector.searcher.popup.destroy();\n\t\t\tthis.tileSelector.searcher.popup = null;\n\t\t}\n\t\tthis.changeDisplay(item.node, false);\n\t\tthis.tileSelector.onInputEnd();\n\t\tthis.onInputEnd();\n\t}\n\n\tonInputSearch()\n\t{\n\t\tconst name = this.tileSelector.input.value;\n\t\tvar regexp = new RegExp(BX.util.escapeRegExp(name), 'i');\n\t\tif (!this.tileSelector.searcher)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst filtered = this.tileSelector.searcher.items.filter((item) => regexp.test(item.name));\n\t\tif (filtered.length === 0)\n\t\t{\n\t\t\tthis.changeDisplay(this.tileSelector.buttonAdd, true);\n\t\t\tthis.tileSelector.searcher.hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.changeDisplay(this.tileSelector.buttonAdd, false);\n\t\t\tthis.tileSelector.searcher.show();\n\t\t}\n\t}\n\n\ttileSelectorSelectFirstHandler()\n\t{\n\t\tajax.runComponentAction(\n\t\t\t'bitrix:catalog.productcard.iblocksectionfield',\n\t\t\t'getSections',\n\t\t\t{\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: {\n\t\t\t\t\tiblockId: this.getIblockId()\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(response => {\n\t\t\t\tthis.tileSelector.setSearcherData(response.data || []);\n\t\t\t})\n\t\t\t.catch(this.tileSelector.hideSearcher.bind(this.tileSelector))\n\t\t;\n\t}\n\n\tdrawViewMode()\n\t{\n\t\tif (this.hasNoSections())\n\t\t{\n\t\t\tthis.innerWrapper = Tag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t\t${Loc.getMessage(\"CATALOG_ENTITY_CARD_EMPTY_SECTION\")}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tDom.addClass(this._wrapper, 'ui-entity-editor-content-block-click-empty');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst content = [];\n\t\t\tObject.entries(this.getSections()).forEach(([id, name]) => {\n\t\t\t\t// ui-tile-selector-item-%type%\n\t\t\t\tcontent.push(Tag.render`\n\t\t\t\t\t<span class=\"ui-tile-selector-item ui-tile-selector-item-readonly-yes\">\n\t\t\t\t\t\t<span data-role=\"tile-item-name\">${Text.encode(name)}</span>\n\t\t\t\t\t</span>\n\t\t\t\t`)\n\t\t\t});\n\t\t\tthis.innerWrapper = Tag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t\t<span class=\"ui-tile-selector-selector-wrap readonly\">\n\t\t\t\t\t\t${content}\n\t\t\t\t\t</span>\n\t\t\t\t</div>`\n\t\t\t;\n\t\t}\n\n\t\tthis._wrapper.appendChild(this.innerWrapper);\n\t}\n\n\tgetSections()\n\t{\n\t\treturn this._model.getField('IBLOCK_SECTION_DATA', {});\n\t}\n\n\tgetIblockId()\n\t{\n\t\treturn this._model.getField('IBLOCK_ID', 0);\n\t}\n\n\tgetProductId()\n\t{\n\t\treturn this._model.getField('ID', 0);\n\t}\n\n\thasNoSections()\n\t{\n\t\tconst sectionIds = this.getValue();\n\n\t\treturn sectionIds.length === 0\n\t\t\t|| (\n\t\t\t\tsectionIds.length === 1\n\t\t\t\t&& (sectionIds.includes('0') || sectionIds.includes(0))\n\t\t\t);\n\t}\n\n\tdoClearLayout(options)\n\t{\n\t\tif (this.tileSelector)\n\t\t{\n\t\t\tEventEmitter.unsubscribeAll(this.tileSelector, this.tileSelector.events.buttonSelect);\n\t\t\tEventEmitter.unsubscribeAll(this.tileSelector, this.tileSelector.events.buttonSelectFirst);\n\t\t\tEventEmitter.unsubscribeAll(this.tileSelector, this.tileSelector.events.tileAdd);\n\t\t\tEventEmitter.unsubscribeAll(this.tileSelector, this.tileSelector.events.tileRemove);\n\t\t\tEventEmitter.unsubscribeAll(this.tileSelector, this.tileSelector.events.searcherInit);\n\t\t\tEventEmitter.unsubscribeAll(this.tileSelector, this.tileSelector.events.search);\n\t\t\tEventEmitter.unsubscribeAll(this.tileSelector, this.tileSelector.events.buttonAdd);\n\t\t}\n\n\t\tif (this.defaultInput)\n\t\t{\n\t\t\tDom.clean(this.defaultInput);\n\t\t\tthis.defaultInput = null;\n\t\t}\n\n\t\tif (this.innerWrapper)\n\t\t{\n\t\t\tDom.clean(this.innerWrapper);\n\t\t\tthis.innerWrapper = null;\n\t\t}\n\n\t\tthis._hasLayout = false;\n\t}\n\n\tgetModeSwitchType(mode)\n\t{\n\t\tlet result = BX.UI.EntityEditorModeSwitchType.common;\n\n\t\tif (mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tresult |= BX.UI.EntityEditorModeSwitchType.button | BX.UI.EntityEditorModeSwitchType.content;\n\t\t}\n\n\t\treturn result;\n\t}\n}","import IblockSectionField from './iblock-section/field';\nimport {type BaseEvent, EventEmitter} from 'main.core.events'\n\nexport default class FieldsFactory\n{\n\tconstructor()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorControlFactory:onInitialize', (event: BaseEvent) => {\n\t\t\tconst [, eventArgs] = event.getCompatData();\n\t\t\teventArgs.methods['entityCard'] = this.factory.bind(this);\n\t\t});\n\t}\n\n\tfactory(type, controlId, settings)\n\t{\n\t\tif (type === 'iblock_section')\n\t\t{\n\t\t\treturn new IblockSectionField(controlId, settings);\n\t\t}\n\n\t\treturn null;\n\t}\n}","import {ajax} from 'main.core';\nimport {type BaseEvent, EventEmitter} from 'main.core.events'\n\nconst PROPERTY_PREFIX = 'PROPERTY_';\nconst PROPERTY_BLOCK_NAME = 'properties';\n\nexport default class IblockSectionController extends BX.UI.EntityEditorController\n{\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\n\t\tthis.isRequesting = false;\n\t\tthis.clearServiceFields();\n\n\t\tEventEmitter.subscribe(this._editor, 'IblockSectionField:onChange', this.onChangeHandler.bind(this));\n\t\tEventEmitter.subscribe(this._editor, 'BX.UI.EntityEditor:onFieldCreate', this.onFieldAdd.bind(this));\n\t\tEventEmitter.subscribe(this._editor, 'BX.UI.EntityEditor:onFieldModify', this.onFieldUpdate.bind(this));\n\t}\n\n\tclearServiceFields()\n\t{\n\t\tthis.lastDataHash = null;\n\t\tthis.initialElements = null;\n\t\tthis.deletedControls = {};\n\t\tthis.deletedAvailableSchemes = {};\n\t}\n\n\tonChangeHandler(event: BaseEvent)\n\t{\n\t\tconst [field] = event.getData();\n\t\tconst newData = field.tileSelector.list.map(tile => tile.id);\n\t\tconst newDataHash = JSON.stringify(newData);\n\n\t\tif (this.lastDataHash === null || this.lastDataHash !== newDataHash)\n\t\t{\n\t\t\tthis.lastDataHash = newDataHash;\n\n\t\t\tclearTimeout(this.timeout);\n\t\t\tthis.timeout = setTimeout(() => {\n\t\t\t\tthis.refreshLinkedProperties(newData)\n\t\t\t}, 50);\n\t\t}\n\t}\n\n\tonFieldAdd(event: BaseEvent)\n\t{\n\t\tconst [section, eventArgs] = event.getCompatData();\n\t\tconst fields = this.getFieldsForm(eventArgs);\n\t\tajax.runComponentAction(\n\t\t\tthis._editor._settings.ajaxData.COMPONENT_NAME,\n\t\t\t'addProperty',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this._editor._settings.ajaxData.SIGNED_PARAMETERS,\n\t\t\t\tdata: fields\n\t\t\t}\n\t\t)\n\t\t\t.then(response => {\n\t\t\t\tconst propertySection = this._editor.getSchemeElementByName(PROPERTY_BLOCK_NAME);\n\t\t\t\tconst property = response.data.PROPERTY_FIELDS;\n\n\t\t\t\tif (!propertySection || !property)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst additionalValues = response.data.ADDITIONAL_VALUES;\n\t\t\t\tif (additionalValues)\n\t\t\t\t{\n\t\t\t\t\tconst model = this._editor._model;\n\t\t\t\t\tfor (let [key, value] of Object.entries(additionalValues))\n\t\t\t\t\t{\n\t\t\t\t\t\tmodel.setField(key, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet mode = BX.UI.EntityEditorMode.view;\n\t\t\t\tif (section instanceof BX.UI.EntityEditorSection)\n\t\t\t\t{\n\t\t\t\t\tmode = section.getMode()\n\t\t\t\t}\n\n\t\t\t\tconst control = this.createProperty(property, {\n\t\t\t\t\tlayout: {\n\t\t\t\t\t\tnotifyIfNotDisplayed: true,\n\t\t\t\t\t\tforceDisplay: eventArgs.showAlways,\n\t\t\t\t\t},\n\t\t\t\t\tmode: mode\n\t\t\t\t});\n\n\t\t\t\tcontrol.toggleOptionFlag(eventArgs.showAlways);\n\n\t\t\t\tthis._editor.saveSchemeChanges();\n\n\t\t\t\tthis.isRequesting = false;\n\t\t\t})\n\t\t\t.catch(response => {\n\t\t\t\tthis.isRequesting = false;\n\t\t\t})\n\t\t;\n\t}\n\n\tonFieldUpdate(event: BaseEvent)\n\t{\n\t\tconst [section, eventArgs] = event.getCompatData();\n\t\tif (!(eventArgs.field instanceof BX.UI.EntityEditorControl))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentField = eventArgs.field;\n\t\teventArgs.CODE = currentField.getId();\n\n\t\tconst fields = this.getFieldsForm(eventArgs);\n\t\tconst schemeElement = currentField.getSchemeElement();\n\t\tschemeElement._isRequired = eventArgs.mandatory;\n\n\t\tajax.runComponentAction(\n\t\t\tthis._editor._settings.ajaxData.COMPONENT_NAME,\n\t\t\t'updateProperty',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this._editor._settings.ajaxData.SIGNED_PARAMETERS,\n\t\t\t\tdata: fields\n\t\t\t}\n\t\t).then(response => {\n\t\t\tif (currentField instanceof BX.UI.EntityEditorDatetime || currentField instanceof BX.UI.EntityEditorMultiDatetime)\n\t\t\t{\n\t\t\t\tconst data = currentField.getSchemeElement().getData();\n\t\t\t\tdata.enableTime = eventArgs.enableTime;\n\t\t\t}\n\t\t\tlet newType = null;\n\t\t\tlet schemeElement = null;\n\t\t\tif (eventArgs.multiple === true)\n\t\t\t{\n\t\t\t\tif (currentField instanceof BX.UI.EntityEditorText)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'multitext';\n\t\t\t\t}\n\t\t\t\telse if (currentField instanceof BX.UI.EntityEditorList)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'multilist';\n\t\t\t\t}\n\t\t\t\telse if (currentField instanceof BX.UI.EntityEditorDatetime)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'multidatetime';\n\t\t\t\t}\n\t\t\t\telse if (currentField instanceof BX.UI.EntityEditorNumber)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'multinumber';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (currentField instanceof BX.UI.EntityEditorMultiList)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'list';\n\t\t\t\t}\n\t\t\t\telse if (currentField instanceof BX.UI.EntityEditorMultiDatetime)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'datetime';\n\t\t\t\t}\n\t\t\t\telse if (currentField instanceof BX.UI.EntityEditorMultiNumber)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'number';\n\t\t\t\t}\n\t\t\t\telse if (currentField instanceof BX.UI.EntityEditorMultiText)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'text';\n\t\t\t\t}\n\n\t\t\t\tschemeElement = currentField.getSchemeElement();\n\t\t\t}\n\n\t\t\tconst property = response.data.PROPERTY_FIELDS;\n\t\t\tif (\n\t\t\t\t((currentField instanceof BX.UI.EntityEditorList) || (currentField instanceof BX.UI.EntityEditorMultiList))\n\t\t\t\t&& property\n\t\t\t)\n\t\t\t{\n\t\t\t\tschemeElement = BX.UI.EntitySchemeElement.create(property);\n\t\t\t\tnewType = property.type;\n\t\t\t}\n\t\t\tif (newType)\n\t\t\t{\n\t\t\t\tconst index = section.getChildIndex(currentField);\n\t\t\t\tconst newControl = this._editor.createControl(\n\t\t\t\t\tnewType,\n\t\t\t\t\teventArgs.CODE,\n\t\t\t\t\t{\n\t\t\t\t\t\tschemeElement: schemeElement,\n\t\t\t\t\t\tmodel: section._model,\n\t\t\t\t\t\tparent: section,\n\t\t\t\t\t\tmode: section.getMode()\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tsection.addChild(newControl, {\n\t\t\t\t\tindex,\n\t\t\t\t\tlayout: {\n\t\t\t\t\t\tforceDisplay: true\n\t\t\t\t\t},\n\t\t\t\t\tenableSaving: false\n\t\t\t\t});\n\n\t\t\t\tsection.removeChild(currentField, {\n\t\t\t\t\tenableSaving: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.isRequesting = false;\n\t\t})\n\t\t\t.catch(response => {\n\t\t\t\tthis.isRequesting = false;\n\t\t\t});\n\t}\n\n\tgetFieldsForm(fields)\n\t{\n\t\tconst form = new FormData();\n\t\tconst formatted = {\n\t\t\tNAME: fields.label,\n\t\t\tMULTIPLE: fields.multiple ? 'Y' : 'N',\n\t\t\tIS_REQUIRED: fields.mandatory ? 'Y' : 'N',\n\t\t\tPROPERTY_TYPE: 'S',\n\t\t\tCODE: fields.CODE || ''\n\t\t};\n\n\t\tswitch (fields.typeId)\n\t\t{\n\t\t\tcase 'integer':\n\t\t\tcase 'double':\n\t\t\t\tformatted.PROPERTY_TYPE = 'N';\n\t\t\t\tbreak;\n\t\t\tcase 'list':\n\t\t\tcase 'multilist':\n\t\t\t\tformatted.PROPERTY_TYPE = 'L';\n\t\t\t\tfields.enumeration.forEach((enumItem, key) => {\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES][' + key + '][SORT'), enumItem.SORT);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES][' + key + '][VALUE'), enumItem.VALUE);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES][' + key + '][ID'), enumItem.ID);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'directory':\n\t\t\t\tformatted.USER_TYPE = 'directory';\n\t\t\t\tfields.enumeration.forEach((enumItem, key) => {\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES][' + key + '][SORT'), enumItem.SORT);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES][' + key + '][VALUE'), enumItem.VALUE.value);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES][' + key + '][XML_ID'), enumItem.XML_ID);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES][' + key + '][FILE_ID'), enumItem.FILE_ID);\n\t\t\t\t\tform.append('FILES[' + enumItem.SORT + ']', enumItem.VALUE.file);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'boolean':\n\t\t\t\tformatted.PROPERTY_TYPE = 'L';\n\t\t\t\tform.append(this.getFormFieldName('VALUES][0][VALUE'), 'Y')\n\t\t\t\tformatted.LIST_TYPE = 'C';\n\t\t\t\tbreak;\n\t\t\tcase 'money':\n\t\t\t\tformatted.USER_TYPE = 'Money';\n\t\t\t\tbreak;\n\t\t\tcase 'address':\n\t\t\t\tformatted.USER_TYPE = 'map_google';\n\t\t\t\tbreak;\n\t\t\tcase 'datetime':\n\t\t\tcase 'multidatetime':\n\t\t\t\tformatted.USER_TYPE = (fields.enableTime === true) ? 'DateTime' : 'Date';\n\t\t\t\tbreak;\n\t\t\tcase 'file':\n\t\t\t\tformatted.USER_TYPE = 'DiskFile';\n\t\t\t\tbreak;\n\t\t}\n\n\t\tfor (let [key, item] of Object.entries(formatted))\n\t\t{\n\t\t\tform.append(this.getFormFieldName(key), item);\n\t\t}\n\t\treturn form;\n\t}\n\n\tgetFormFieldName(name)\n\t{\n\t\treturn 'fields[' + name + ']';\n\t}\n\n\trefreshLinkedProperties(sectionIds)\n\t{\n\t\tif (this.isRequesting)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isRequesting = true;\n\n\t\tajax.runComponentAction(\n\t\t\tthis._editor._settings.ajaxData.COMPONENT_NAME,\n\t\t\t'refreshLinkedProperties',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this._editor._settings.ajaxData.SIGNED_PARAMETERS,\n\t\t\t\tdata: {sectionIds}\n\t\t\t}\n\t\t)\n\t\t\t.then(response => {\n\t\t\t\tconst allCurrentProperties = this.getAllCurrentProperties();\n\n\t\t\t\tif (this.initialElements === null)\n\t\t\t\t{\n\t\t\t\t\tthis.initialElements = [...allCurrentProperties];\n\t\t\t\t}\n\n\t\t\t\tresponse.data.ENTITY_FIELDS.forEach(property => {\n\t\t\t\t\tif (!allCurrentProperties.includes(property.name))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.addProperty(property, {\n\t\t\t\t\t\t\tlayout: {\n\t\t\t\t\t\t\t\tforceDisplay: true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmode: BX.UI.EntityEditorMode.edit\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tconst newProperties = response.data.ENTITY_FIELDS.map(el => el.name);\n\t\t\t\tallCurrentProperties.forEach(name => {\n\t\t\t\t\tif (!newProperties.includes(name))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.removeProperty(name);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis._editor.commitSchemeChanges();\n\t\t\t\tthis.isRequesting = false;\n\t\t\t})\n\t\t\t.catch(response => {\n\t\t\t\tthis.isRequesting = false;\n\t\t\t})\n\t\t;\n\t}\n\n\tgetAllCurrentProperties()\n\t{\n\t\tconst activeProperties = this._editor.getAllControls()\n\t\t\t.filter(el => el.getName().indexOf(PROPERTY_PREFIX) === 0)\n\t\t\t.map(el => el.getName());\n\n\t\tconst hiddenProperties = this._editor.getAvailableSchemeElements()\n\t\t\t.filter(el => el.getName().indexOf(PROPERTY_PREFIX) === 0)\n\t\t\t.map(el => el.getName());\n\n\t\treturn [...activeProperties, ...hiddenProperties];\n\t}\n\n\taddProperty(property, options = {})\n\t{\n\t\tif (property.name in this.deletedControls)\n\t\t{\n\t\t\tthis.restoreDeletedProperty(this.deletedControls[property.name], options);\n\t\t}\n\t\telse if (property.name in this.deletedAvailableSchemes)\n\t\t{\n\t\t\tthis.restoreDeletedAvailableProperty(this.deletedAvailableSchemes[property.name], options);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.createProperty(property, options);\n\t\t}\n\t}\n\n\trestoreDeletedProperty(control, options = {})\n\t{\n\t\tconst mode = options.mode || control._mode;\n\t\tcontrol._mode = mode;\n\n\t\tcontrol.getParent().addChild(control, {\n\t\t\t...options,\n\t\t\tenableSaving: false\n\t\t});\n\n\t\tif (mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tthis._editor.registerActiveControl(control);\n\t\t}\n\t\telse if (mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\tthis._editor.unregisterActiveControl(control);\n\t\t}\n\t}\n\n\trestoreDeletedAvailableProperty(schemeElement, options = {})\n\t{\n\t\tthis._editor.addAvailableSchemeElement(schemeElement);\n\t}\n\n\tcreateProperty(property, options = {})\n\t{\n\t\tconst propertyBlockScheme = this._editor.getSchemeElementByName(PROPERTY_BLOCK_NAME);\n\t\tconst schemeElement = BX.UI.EntitySchemeElement.create(property);\n\t\tpropertyBlockScheme._elements.push(schemeElement);\n\n\t\tconst mode = options.mode || BX.UI.EntityEditorMode.edit;\n\t\tconst control = this._editor.createControl(\n\t\t\tschemeElement.getType(),\n\t\t\tschemeElement.getName(),\n\t\t\t{\n\t\t\t\tschemeElement: schemeElement,\n\t\t\t\tmodel: this._model,\n\t\t\t\tparent: this,\n\t\t\t\tmode: mode\n\t\t\t}\n\t\t);\n\n\t\tif (!control)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst propertyBlockControl = this._editor.getControlById(PROPERTY_BLOCK_NAME);\n\t\tpropertyBlockControl.addChild(control, {\n\t\t\t...options,\n\t\t\tenableSaving: false\n\t\t});\n\n\t\treturn control;\n\t}\n\n\tremoveProperty(name)\n\t{\n\t\tconst control = this._editor.getControlByIdRecursive(name);\n\n\t\tif (control)\n\t\t{\n\t\t\tthis.deletedControls[control.getName()] = control;\n\t\t\tcontrol.getParent().removeChild(control, {enableSaving: false});\n\t\t\tthis._editor.removeAvailableSchemeElement(control.getSchemeElement());\n\t\t\tthis._editor.unregisterActiveControl(control);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst schemeElement = this._editor.getAvailableSchemeElementByName(name);\n\n\t\t\tif (schemeElement)\n\t\t\t{\n\t\t\t\tthis.deletedAvailableSchemes[schemeElement.getName()] = schemeElement;\n\t\t\t\tthis._editor.removeAvailableSchemeElement(schemeElement);\n\t\t\t}\n\t\t}\n\t}\n\n\trollback()\n\t{\n\t\tsuper.rollback();\n\n\t\tif (this.initialElements === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst allCurrentProperties = this.getAllCurrentProperties();\n\n\t\tallCurrentProperties.forEach(element => {\n\t\t\tif (!this.initialElements.includes(element))\n\t\t\t{\n\t\t\t\tthis.removeProperty(element);\n\t\t\t}\n\t\t});\n\n\t\tthis.initialElements.forEach(element => {\n\t\t\tif (!allCurrentProperties.includes(element))\n\t\t\t{\n\t\t\t\tthis.addProperty({name: element}, {\n\t\t\t\t\tlayout: {\n\t\t\t\t\t\tforceDisplay: false\n\t\t\t\t\t},\n\t\t\t\t\tmode: BX.UI.EntityEditorMode.view\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis._editor.commitSchemeChanges();\n\n\t\tthis.clearServiceFields()\n\t}\n}","import {type BaseEvent, EventEmitter} from 'main.core.events';\nimport {Dom, Reflection, Type} from 'main.core';\n\nexport default class VariationGridController extends BX.UI.EntityEditorController\n{\n\tareaHeight = null\n\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\t}\n\n\tdoInitialize()\n\t{\n\t\tsuper.doInitialize();\n\n\t\tEventEmitter.subscribe('Grid::thereEditedRows', this.markAsChangedHandler.bind(this));\n\t\tEventEmitter.subscribe('Grid::noEditedRows', this.checkEditorToolbar.bind(this));\n\t\tEventEmitter.subscribe('Grid::updated', this.checkEditorToolbar.bind(this));\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequest.bind(this));\n\n\t\tEventEmitter.subscribe('onAjaxSuccess', this.ajaxSuccessHandler.bind(this));\n\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorIncludedArea:onBeforeLoad', this.onBeforeIncludedAreaLoaded.bind(this));\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorIncludedArea:onAfterLoad', this.onAfterIncludedAreaLoaded.bind(this));\n\n\t\tthis.subscribeToFormSubmit();\n\t}\n\n\tonBeforeIncludedAreaLoaded(event: BaseEvent)\n\t{\n\t\tif (Type.isNumber(this.areaHeight))\n\t\t{\n\t\t\tDom.style(this.getVariationGridLoader(), 'height', this.areaHeight + 'px');\n\t\t}\n\t}\n\n\tonAfterIncludedAreaLoaded(event: BaseEvent)\n\t{\n\t\tDom.style(this.getVariationGridLoader(), 'height', '');\n\t\tthis.areaHeight = null;\n\t}\n\n\tgetVariationGridLoader()\n\t{\n\t\tconst control = this.getGridControl();\n\n\t\tif (control)\n\t\t{\n\t\t\tconst wrapper = control.getWrapper();\n\n\t\t\tif (wrapper)\n\t\t\t{\n\t\t\t\treturn wrapper.querySelector('.ui-entity-editor-included-area-container-loader');\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trollback()\n\t{\n\t\tsuper.rollback();\n\t\tthis.checkEditorToolbar();\n\t\tthis.unsubscribeGridEvents();\n\t}\n\n\tonAfterSave()\n\t{\n\t\tif (this.isChanged())\n\t\t{\n\t\t\tthis.setGridControlCache(null);\n\t\t}\n\n\t\tthis.subscribeToFormSubmit();\n\t\tsuper.onAfterSave();\n\t}\n\n\tsetGridControlCache(html)\n\t{\n\t\tconst control = this.getGridControl();\n\n\t\tif (control)\n\t\t{\n\t\t\tcontrol._loadedHtml = html;\n\t\t}\n\t}\n\n\tonBeforeSubmit()\n\t{\n\t\tthis.unsubscribeGridEvents();\n\t}\n\n\t/**\n\t * @returns {BX.Catalog.VariationGrid|null}\n\t */\n\tgetVariationGridComponent()\n\t{\n\t\treturn Reflection.getClass('BX.Catalog.VariationGrid.Instance');\n\t}\n\n\tunsubscribeGridEvents()\n\t{\n\t\tconst gridComponent = this.getVariationGridComponent();\n\t\tif (gridComponent)\n\t\t{\n\t\t\tgridComponent.unsubscribeCustomEvents();\n\t\t}\n\t}\n\n\tajaxSuccessHandler(event: BaseEvent)\n\t{\n\t\tconst [, xhrData] = event.getCompatData();\n\n\t\tif (xhrData.url.indexOf(this.getReloadUrl()) === 0)\n\t\t{\n\t\t\tthis.setGridControlCache(null);\n\t\t}\n\t}\n\n\t// ajax form initializes every \"save\" action\n\tsubscribeToFormSubmit()\n\t{\n\t\tEventEmitter.subscribe(this._editor._ajaxForm, 'onBeforeSubmit', this.onBeforeSubmitForm.bind(this));\n\t}\n\n\tmarkAsChangedHandler()\n\t{\n\t\tif (!this._editor.isNew())\n\t\t{\n\t\t\tthis.markAsChanged();\n\t\t}\n\t}\n\n\tcheckEditorToolbar()\n\t{\n\t\tthis._isChanged = false;\n\n\t\tif (this._editor.getActiveControlCount() > 0)\n\t\t{\n\t\t\tthis._editor.showToolPanel();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._editor.hideToolPanel();\n\t\t}\n\n\t\tif (this._editor._toolPanel)\n\t\t{\n\t\t\tthis._editor._toolPanel.clearErrors();\n\t\t}\n\t}\n\n\tgetGridControl()\n\t{\n\t\treturn this._editor.getControlById('variation_grid');\n\t}\n\n\tonBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [, eventArgs] = event.getCompatData();\n\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tsignedParameters: this.getSignedParameters()\n\t\t};\n\n\t\tthis.unsubscribeGridEvents();\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getConfigStringParam('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getConfigStringParam('signedParameters', '');\n\t}\n\n\tgetGridId()\n\t{\n\t\treturn this.getConfigStringParam('gridId', '');\n\t}\n\n\tgetGrid()\n\t{\n\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.gridManager.getInstanceById(this.getGridId());\n\t}\n\n\tonBeforeSubmitForm(event: BaseEvent)\n\t{\n\t\tconst [, eventArgs] = event.getCompatData();\n\t\tconst grid = this.getGrid();\n\n\t\tif (!grid)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst skuGridName = this.getGridId();\n\t\tconst skuGridData = grid.getRows().getEditSelectedValues();\n\n\t\t// replace sku custom properties edit data names with original names\n\t\tfor (let id in skuGridData)\n\t\t{\n\t\t\tfor (let name in skuGridData[id])\n\t\t\t{\n\t\t\t\tif (!skuGridData[id].hasOwnProperty(name))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (name.includes('SKU_GRID_CATALOG_GROUP')\n\t\t\t\t\t|| name.includes('SKU_GRID_PURCHASING')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tfor (let priceField in skuGridData[id][name])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (skuGridData[id][name].hasOwnProperty(priceField))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tskuGridData[id][priceField] = skuGridData[id][name][priceField];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (name.includes('[EDIT_HTML]'))\n\t\t\t\t{\n\t\t\t\t\tlet newName = name.replace('[EDIT_HTML]', '');\n\n\t\t\t\t\t// lookup for a custom file fields\n\t\t\t\t\tif (newName.endsWith('_custom'))\n\t\t\t\t\t{\n\t\t\t\t\t\tif ('bxu_files[]' in skuGridData[id][name])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tskuGridData[id][name].isFile = true;\n\t\t\t\t\t\t\tdelete skuGridData[id][name]['bxu_files[]'];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (skuGridData[id][name].isFile)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfor (let fieldName in skuGridData[id][name])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (skuGridData[id][name].hasOwnProperty(fieldName))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t// check for new files like \"MORE_PHOTO_n1[name]\"(multiple) or \"DETAIL_PICTURE[name]\"(single)\n\t\t\t\t\t\t\t\t\tlet newFilesRegExp = new RegExp(/([0-9A-Za-z_]+?(_n\\d+)*)\\[([A-Za-z_]+)\\]/);\n\n\t\t\t\t\t\t\t\t\tif (newFilesRegExp.test(fieldName))\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tlet fileCounter, fileSetting;\n\n\t\t\t\t\t\t\t\t\t\t[, fileCounter, , fileSetting] = fieldName.match(newFilesRegExp);\n\n\t\t\t\t\t\t\t\t\t\tif (fileCounter && fileSetting)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tskuGridData[id][name][fileCounter] = skuGridData[id][name][fileCounter] || {};\n\t\t\t\t\t\t\t\t\t\t\tskuGridData[id][name][fileCounter][fileSetting] = skuGridData[id][name][fieldName];\n\t\t\t\t\t\t\t\t\t\t\tdelete skuGridData[id][name][fieldName];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tskuGridData[id][newName] = skuGridData[id][name];\n\t\t\t\t\tdelete skuGridData[id][name];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!Type.isPlainObject(eventArgs.options))\n\t\t{\n\t\t\teventArgs.options = {};\n\t\t}\n\n\t\tif (!Type.isPlainObject(eventArgs.options.data))\n\t\t{\n\t\t\teventArgs.options.data = {};\n\t\t}\n\n\t\teventArgs.options.data[skuGridName] = skuGridData;\n\n\t\tthis.areaHeight = this.getGridControl().getWrapper().offsetHeight;\n\t}\n}","import IblockSectionController from './iblock-section/controller';\nimport {type BaseEvent, EventEmitter} from 'main.core.events'\nimport VariationGridController from './variation-grid/controller';\n\nexport default class ControllersFactory\n{\n\tconstructor()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorControllerFactory:onInitialize', (event: BaseEvent) => {\n\t\t\tconst [, eventArgs] = event.getCompatData();\n\t\t\teventArgs.methods['entityCard'] = this.factory.bind(this);\n\t\t});\n\t}\n\n\tfactory(type, controlId, settings)\n\t{\n\t\tif (type === 'iblock_section')\n\t\t{\n\t\t\treturn new IblockSectionController(controlId, settings);\n\t\t}\n\n\t\tif (type === 'variation_grid')\n\t\t{\n\t\t\treturn new VariationGridController(controlId, settings);\n\t\t}\n\n\t\treturn null;\n\t}\n}","import {Event, Tag, Text} from \"main.core\";\n\nexport default class IblockDirectoryFieldItem extends BX.UI.EntityEditorUserFieldListItem\n{\n\tfileChanged = false;\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new this;\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tlayout()\n\t{\n\t\tif (this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._wrapper = Tag.render`\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row\"></div>\n\t\t\t`;\n\n\t\tthis._fileInput = Tag.render`\n\t\t\t\t<input class=\"input-image-hidden\" value=\"${BX.prop.getString(this._data, 'FILE_ID', '')}\" type=\"file\" accept=\"image/*\">\n\t\t\t`;\n\t\tEvent.bind(this._fileInput, 'change', this.onFileLoaderChange.bind(this));\n\t\tconst link = BX.prop.getString(this._data, 'IMAGE_SRC', '');\n\t\tthis._wrapper.appendChild(\n\t\t\tTag.render`\n\t\t\t<label class=\"catalog-dictionary-item ${link === '' ? 'catalog-dictionary-item-empty' : ''}\">\n\t\t\t\t<img src=\"${link}\" alt=\"\">\n\t\t\t\t${this._fileInput}\n\t\t\t</label>\n\t\t\t`\n\t\t);\n\n\t\tconst labelText = Text.encode(BX.prop.getString(this._data, 'TEXT', ''));\n\t\tthis._labelInput = Tag.render`\n\t\t\t\t<input \n\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t\tvalue=\"${labelText}\"\n\t\t\t\t\tplaceholder=\"${BX.message('CATALOG_ENTITY_CARD_NEW_FIELD_ITEM_PLACEHOLDER')}\"\n\t\t\t\t>\n\t\t\t`;\n\t\tthis._wrapper.appendChild(this._labelInput);\n\n\t\tconst deleteButton = Tag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-remove-block\"></div>\n\t\t\t`;\n\n\t\tEvent.bind(deleteButton, 'click', this.onDeleteButtonClick.bind(this));\n\t\tthis._wrapper.appendChild(deleteButton);\n\n\t\tvar anchor = BX.prop.getElementNode(this._settings, 'anchor');\n\t\tif (anchor)\n\t\t{\n\t\t\tthis._container.insertBefore(this._wrapper, anchor);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._container.appendChild(this._wrapper);\n\t\t}\n\n\t\tthis._hasLayout = true;\n\t}\n\n\tonFileLoaderChange(event)\n\t{\n\t\tconst input = event.target;\n\t\tif (input.files && input.files[0])\n\t\t{\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onload = function(e) {\n\t\t\t\tinput.parentNode.querySelector('img').src = e.target.result;\n\t\t\t};\n\n\t\t\tthis.fileChanged = true;\n\t\t\treader.readAsDataURL(input.files[0]);\n\t\t\tinput.parentNode.classList.remove('catalog-dictionary-item-empty');\n\t\t}\n\t}\n\n\tisFileChanged()\n\t{\n\t\treturn this.fileChanged;\n\t}\n\n\tprepareData()\n\t{\n\t\tconst textValue = this._labelInput ? BX.util.trim(this._labelInput.value) : '';\n\t\tconst fileValue = (this._fileInput && this._fileInput.files && this._fileInput.files[0]) ? this._fileInput.files[0] : {};\n\n\t\tif (textValue === '' && !this.isFileChanged())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst data = {\n\t\t\t'VALUE': {\n\t\t\t\tvalue: textValue,\n\t\t\t\tfile: fileValue\n\t\t\t},\n\t\t\t'XML_ID': '',\n\t\t\t'FILE_ID': ''\n\t\t};\n\t\tconst xmlId = BX.prop.getString(this._data, 'ID', '');\n\t\tif (BX.type.isNotEmptyString(xmlId))\n\t\t{\n\t\t\tdata['XML_ID'] = xmlId;\n\t\t\tdata['FILE_ID'] = BX.prop.getString(this._data, 'FILE_ID', '');\n\t\t}\n\n\t\treturn data;\n\t}\n}","import {Dom, Event, Reflection, Tag} from \"main.core\";\nimport {translit} from 'translit';\nimport IblockDirectoryFieldItem from \"./iblock-directory-field-item\";\n\nexport default class IblockFieldConfigurator extends BX.UI.EntityEditorFieldConfigurator\n{\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new this;\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\tlayoutInternal()\n\t{\n\t\tthis._wrapper.appendChild(this.getInputContainer());\n\t\tif(this._typeId === \"list\" || this._typeId === \"multilist\" || this._typeId === \"directory\")\n\t\t{\n\t\t\tthis._wrapper.appendChild(Tag.render`<hr class=\"ui-entity-editor-line\">`);\n\t\t\tthis._wrapper.appendChild(this.getEnumerationContainer());\n\t\t}\n\n\t\tthis._wrapper.appendChild(this.getOptionContainer());\n\t\tthis._wrapper.appendChild(this.getErrorContainer());\n\t\tDom.append(Tag.render`<hr class=\"ui-entity-editor-line\">`, this._wrapper);\n\t\tthis._wrapper.appendChild(this.getButtonContainer());\n\t}\n\tgetOptionContainer()\n\t{\n\t\tvar isNew = (this._field === null);\n\t\tthis._optionWrapper = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\"></div>\n\t\t`;\n\n\t\tif (this._typeId === \"datetime\" || this._typeId === \"multidatetime\")\n\t\t{\n\t\t\tthis._isTimeEnabledCheckBox = this.getIsTimeEnabledCheckBox();\n\t\t}\n\n\t\tif (this._typeId !== \"boolean\" && this._enableMandatoryControl)\n\t\t{\n\t\t\tthis._isRequiredCheckBox = this.getIsRequiredCheckBox();\n\t\t}\n\n\t\tif (this._typeId !== \"directory\")\n\t\t{\n\t\t\tthis._isMultipleCheckBox = this.getMultipleCheckBox();\n\t\t}\n\n\t\t//region Show Always\n\t\tthis._showAlwaysCheckBox = this.createOption(\n\t\t\t{ caption: BX.message(\"UI_ENTITY_EDITOR_SHOW_ALWAYS\"), helpUrl: \"https://helpdesk.bitrix24.ru/open/7046149/\", helpCode: \"9627471\" }\n\t\t);\n\t\tthis._showAlwaysCheckBox.checked = isNew\n\t\t\t? BX.prop.getBoolean(this._settings, \"showAlways\", true)\n\t\t\t: this._field.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways);\n\t\t//endregion\n\n\t\treturn this._optionWrapper;\n\t}\n\n\tgetInputTitle()\n\t{\n\t\tconst manager = this._editor.getUserFieldManager();\n\t\treturn this._field ? this._field.getTitle() : manager.getDefaultFieldLabel(this._typeId);\n\t}\n\tgetErrorContainer()\n\t{\n\t\tthis._errorContainer = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\"></div>\n\t\t`;\n\t\treturn this._errorContainer;\n\t}\n\n\tgetEnumerationContainer()\n\t{\n\t\tconst enumWrapper = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t<div class=\"ui-entity-editor-block-title\">\n\t\t\t\t\t<span class=\"ui-entity-editor-block-title-text\">${BX.message(\"UI_ENTITY_EDITOR_UF_ENUM_ITEMS\")}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis._enumItemContainer = Tag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block\"></div>\n\t\t\t`;\n\t\tDom.append(this._enumItemContainer, enumWrapper);\n\n\t\tconst addButton = Tag.render`\n\t\t\t\t<div class=\"ui-entity-card-content-add-field\">\n\t\t\t\t\t${BX.message(\"UI_ENTITY_EDITOR_ADD\")}\n\t\t\t\t</div>\n\t\t\t`;\n\t\tEvent.bind(addButton, \"click\", this.onEnumerationItemAddButtonClick.bind(this));\n\n\t\tDom.append(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block-add-field\">\n\t\t\t\t\t${addButton}\n\t\t\t\t</div>\n\t\t\t`,\n\t\t\tenumWrapper\n\t\t);\n\n\t\tif (this._field)\n\t\t{\n\t\t\tthis._field.getItems().forEach(enumFields => {\n\t\t\t\tif (enumFields.VALUE !== '')\n\t\t\t\t{\n\t\t\t\t\tthis.createEnumerationItem({\n\t\t\t\t\t\tVALUE: enumFields.NAME,\n\t\t\t\t\t\tFILE_ID: enumFields.IMAGE || null,\n\t\t\t\t\t\tIMAGE_SRC: enumFields.IMAGE_SRC || '',\n\t\t\t\t\t\tTEXT: enumFields.TEXT || '',\n\t\t\t\t\t\tID: enumFields.VALUE\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst lastItem = this.createEnumerationItem();\n\t\tlastItem.focus();\n\t\tthis.initItemClickHandlers();\n\t\treturn enumWrapper;\n\t}\n\n\tonEnumerationItemAddButtonClick()\n\t{\n\t\tthis.unbindItemClickHandlers();\n\t\tthis.createEnumerationItem().focus();\n\t\tthis.bindLastItemClickHandler();\n\t}\n\n\tonEnumerationItemClick()\n\t{\n\t\tthis.unbindItemClickHandlers();\n\t\tthis.createEnumerationItem();\n\t\tthis.bindLastItemClickHandler();\n\t}\n\n\tinitItemClickHandlers()\n\t{\n\t\tthis.unbindItemClickHandlers();\n\t\tthis.bindLastItemClickHandler();\n\t}\n\n\tunbindItemClickHandlers()\n\t{\n\t\tthis._enumItems.forEach(item => Event.unbindAll(item._labelInput, 'click'));\n\t}\n\n\tbindLastItemClickHandler()\n\t{\n\t\tconst lastItem = this._enumItems[this._enumItems.length - 1];\n\t\tif (lastItem)\n\t\t{\n\t\t\tEvent.bindOnce(lastItem._labelInput, 'click', this.onEnumerationItemClick.bind(this));\n\t\t}\n\t}\n\n\tcreateEnumerationItem(data)\n\t{\n\t\tlet item = null;\n\t\tif (this._typeId === 'directory')\n\t\t{\n\t\t\titem = IblockDirectoryFieldItem.create(\n\t\t\t\t\"\",\n\t\t\t\t{\n\t\t\t\t\tconfigurator: this,\n\t\t\t\t\tcontainer: this._enumItemContainer,\n\t\t\t\t\tdata: data\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\titem = BX.UI.EntityEditorUserFieldListItem.create(\n\t\t\t\t\"\",\n\t\t\t\t{\n\t\t\t\t\tconfigurator: this,\n\t\t\t\t\tcontainer: this._enumItemContainer,\n\t\t\t\t\tdata: data\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis._enumItems.push(item);\n\t\titem.layout();\n\t\treturn item;\n\t}\n\n\tremoveEnumerationItem(item)\n\t{\n\t\tfor (var i = 0, length = this._enumItems.length; i < length; i++)\n\t\t{\n\t\t\tif (this._enumItems[i] === item)\n\t\t\t{\n\t\t\t\tthis._enumItems[i].clearLayout();\n\t\t\t\tthis._enumItems.splice(i, 1);\n\t\t\t\tthis.initItemClickHandlers();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tprepareSaveParams(e)\n\t{\n\t\tconst params = super.prepareSaveParams(this, arguments);\n\t\tif (this._typeId === 'list' || this._typeId === 'multilist')\n\t\t{\n\t\t\tparams['enumeration'] = [];\n\t\t\tconst hashes = [];\n\t\t\tthis._enumItems.forEach(enumItem => {\n\t\t\t\tif (!(enumItem instanceof BX.UI.EntityEditorUserFieldListItem))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst enumData = enumItem.prepareData();\n\t\t\t\tif (!enumData)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst hash = BX.util.hashCode(enumData['VALUE']);\n\t\t\t\tif (BX.util.in_array(hash, hashes))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\thashes.push(hash);\n\t\t\t\tenumData['SORT'] = (params['enumeration'].length + 1) * 100;\n\t\t\t\tparams['enumeration'].push(enumData);\n\t\t\t});\n\t\t}\n\t\tif (this._typeId === 'directory')\n\t\t{\n\t\t\tparams['enumeration'] = [];\n\t\t\tthis._enumItems.forEach(enumItem => {\n\t\t\t\tif (!(enumItem instanceof IblockDirectoryFieldItem))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst enumData = enumItem.prepareData();\n\t\t\t\tif (!enumData)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tenumData['SORT'] = (params['enumeration'].length + 1) * 100;\n\t\t\t\tparams['enumeration'].push(enumData);\n\t\t\t});\n\t\t}\n\t\telse if (this._typeId === 'datetime' || this._typeId === 'multidatetime')\n\t\t{\n\t\t\tparams['enableTime'] = this._isTimeEnabledCheckBox.checked;\n\t\t}\n\n\t\tif (this._field)\n\t\t{\n\t\t\tif (this._isMultipleCheckBox)\n\t\t\t{\n\t\t\t\tparams[\"multiple\"] = this._isMultipleCheckBox.checked;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(this._typeId === \"boolean\")\n\t\t\t{\n\t\t\t\tparams[\"multiple\"] = false;\n\t\t\t}\n\t\t\telse if(this._isMultipleCheckBox)\n\t\t\t{\n\t\t\t\tparams[\"multiple\"] = this._isMultipleCheckBox.checked;\n\t\t\t}\n\t\t}\n\n\t\treturn params;\n\t}\n\n\tgetMultipleCheckBox()\n\t{\n\t\tconst checkBox = this.createOption({caption: BX.message(\"UI_ENTITY_EDITOR_UF_MULTIPLE_FIELD\")});\n\t\tif (\n\t\t\tthis._field instanceof BX.UI.EntityEditorMultiText\n\t\t\t|| this._field instanceof BX.UI.EntityEditorMultiNumber\n\t\t\t|| this._field instanceof BX.UI.EntityEditorMultiList\n\t\t\t|| this._field instanceof BX.UI.EntityEditorMultiDatetime\n\t\t)\n\t\t{\n\t\t\tcheckBox.checked = true;\n\t\t}\n\n\t\treturn checkBox;\n\t}\n\n\tgetIsRequiredCheckBox()\n\t{\n\t\tlet checkBox;\n\t\tif (this._mandatoryConfigurator)\n\t\t{\n\t\t\tcheckBox = this.createOption(\n\t\t\t\t{\n\t\t\t\t\tcaption: this._mandatoryConfigurator.getTitle() + \":\",\n\t\t\t\t\tlabelSettings: {props: {className: \"ui-entity-new-field-addiction-label\"}},\n\t\t\t\t\tcontainerSettings: {style: {alignItems: \"center\"}},\n\t\t\t\t\telements: this._mandatoryConfigurator.getButton().prepareLayout()\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tcheckBox.checked = (this._field && this._field.isRequired())\n\t\t\t\t|| this._mandatoryConfigurator.isCustomized();\n\n\t\t\tthis._mandatoryConfigurator.setSwitchCheckBox(checkBox);\n\t\t\tthis._mandatoryConfigurator.setLabel(checkBox.nextSibling);\n\n\t\t\tthis._mandatoryConfigurator.setEnabled(checkBox.checked);\n\t\t\tthis._mandatoryConfigurator.adjust();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcheckBox = this.createOption({caption: BX.message(\"UI_ENTITY_EDITOR_UF_REQUIRED_FIELD\")});\n\t\t\tcheckBox.checked = this._field && this._field.isRequired();\n\t\t}\n\t\treturn checkBox;\n\t}\n\n\tgetIsTimeEnabledCheckBox()\n\t{\n\t\tconst checkBox = this.createOption({caption: BX.message(\"UI_ENTITY_EDITOR_UF_ENABLE_TIME\")});\n\t\tcheckBox.checked = this._field && this._field.isTimeEnabled();\n\t\treturn checkBox;\n\t}\n}\n\nReflection.namespace('BX.Catalog').IblockFieldConfigurator = IblockFieldConfigurator;","import IblockFieldConfigurator from './iblock-field-configurator'\n\nexport default class IblockFieldConfigurationManager extends BX.UI.EntityConfigurationManager\n{\n\tcreateFieldConfigurator(params, parent)\n\t{\n\t\tif (!BX.type.isPlainObject(params))\n\t\t{\n\t\t\tthrow \"IblockFieldConfigurationManager: The 'params' argument must be object.\";\n\t\t}\n\n\t\treturn this.getSimpleFieldConfigurator(params, parent);\n\t}\n\n\tgetSimpleFieldConfigurator(params, parent)\n\t{\n\t\tlet typeId = \"\";\n\t\tconst field = BX.prop.get(params, 'field', null);\n\t\tif (field)\n\t\t{\n\t\t\ttypeId = field.getType();\n\t\t\tfield.setVisible(false);\n\n\t\t\tif (!BX.prop.get(field.getSchemeElement().getData(), \"isProductProperty\", false))\n\t\t\t{\n\t\t\t\treturn this._fieldConfigurator = BX.UI.EntityEditorFieldConfigurator.create(\n\t\t\t\t\t\"\",\n\t\t\t\t\t{\n\t\t\t\t\t\teditor: this._editor,\n\t\t\t\t\t\tschemeElement: null,\n\t\t\t\t\t\tmodel: parent._model,\n\t\t\t\t\t\tmode: BX.UI.EntityEditorMode.edit,\n\t\t\t\t\t\tparent: parent,\n\t\t\t\t\t\ttypeId: typeId,\n\t\t\t\t\t\tfield: field,\n\t\t\t\t\t\tmandatoryConfigurator: null\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t\telse if (BX.prop.get(field.getSchemeElement().getData(), \"userType\", false))\n\t\t\t{\n\t\t\t\ttypeId = BX.prop.getString(field.getSchemeElement().getData(), \"userType\")\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttypeId = BX.prop.get(params, 'typeId', BX.UI.EntityUserFieldType.string);\n\t\t}\n\n\t\tthis._fieldConfigurator = IblockFieldConfigurator.create(\n\t\t\t'',\n\t\t\t{\n\t\t\t\teditor: this._editor,\n\t\t\t\tschemeElement: null,\n\t\t\t\tmodel: parent._model,\n\t\t\t\tmode: BX.UI.EntityEditorMode.edit,\n\t\t\t\tparent: parent,\n\t\t\t\ttypeId: typeId,\n\t\t\t\tfield: field,\n\t\t\t\tmandatoryConfigurator: null\n\t\t\t}\n\t\t);\n\n\t\treturn this._fieldConfigurator;\n\t}\n\n\tisCreationEnabled()\n\t{\n\t\treturn true;\n\t}\n\n\tgetCreationPageUrl(typeId)\n\t{\n\t\treturn this.creationPageUrl;\n\t}\n\n\topenCreationPageUrl(typeId)\n\t{\n\t\tBX.SidePanel.Instance.open(this.getCreationPageUrl(typeId), {\n\t\t\tallowChangeHistory: false,\n\t\t\tcacheable: false\n\t\t});\n\t}\n\n\tsetCreationPageUrl(url)\n\t{\n\t\treturn this.creationPageUrl = url;\n\t}\n\n\tgetTypeInfos()\n\t{\n\t\tvar items = [];\n\t\titems.push({\n\t\t\tname: \"string\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_UF_STRING_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_STRING_LEGEND\")\n\t\t});\n\t\titems.push({\n\t\t\tname: \"list\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_UF_ENUM_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_ENUM_LEGEND\")\n\t\t});\n\t\titems.push({\n\t\t\tname: \"datetime\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_UF_DATETIME_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_DATETIME_LEGEND\")\n\t\t});\n\t\titems.push({\n\t\t\tname: \"address\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_UF_ADDRESS_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_ADDRESS_LEGEND\")\n\t\t});\n\n\t\titems.push({\n\t\t\tname: \"money\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_UF_MONEY_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_MONEY_LEGEND\")\n\t\t});\n\t\titems.push({\n\t\t\tname: \"boolean\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_BOOLEAN_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_BOOLEAN_LEGEND\")\n\t\t});\n\t\titems.push({\n\t\t\tname: \"double\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_UF_DOUBLE_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_DOUBLE_LEGEND\")\n\t\t});\n\t\titems.push({\n\t\t\tname: \"directory\",\n\t\t\ttitle: BX.message(\"CATALOG_ENTITY_CARD_DICTIONARY_TITLE\"),\n\t\t\tlegend: BX.message(\"CATALOG_ENTITY_CARD_DICTIONARY_LEGEND\")\n\t\t});\n\n\t\titems.push({\n\t\t\tname: \"custom\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_UF_CUSTOM_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_CUSTOM_LEGEND\")\n\t\t});\n\n\t\treturn items;\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new this;\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}","import {Dom, Event, Tag} from \"main.core\";\n\nexport default class GridFieldConfigurator extends BX.UI.EntityEditorFieldConfigurator\n{\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new this;\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\t// ToDo remove unused methods\n\tappendEnumerationSettings()\n\t{\n\t\tif (this._typeId === \"list\" || this._typeId === \"multilist\")\n\t\t{\n\t\t\tDom.append(Tag.render`<hr class=\"ui-entity-editor-line\">`, this._wrapper);\n\n\t\t\tconst enumWrapper = Tag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t\t<div class=\"ui-entity-editor-block-title\">\n\t\t\t\t\t\t<span class=\"ui-entity-editor-block-title-text\">${BX.message(\"UI_ENTITY_EDITOR_UF_ENUM_ITEMS\")}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tDom.append(enumWrapper, this._wrapper);\n\n\t\t\tthis._enumItemContainer = Tag.render`\n\t\t\t\t\t<div class=\"ui-entity-editor-content-block\"></div>\n\t\t\t\t`;\n\t\t\tDom.append(this._enumItemContainer, enumWrapper);\n\n\t\t\tconst addButton = Tag.render`\n\t\t\t\t\t<div class=\"ui-entity-card-content-add-field\">\n\t\t\t\t\t\t${BX.message(\"UI_ENTITY_EDITOR_ADD\")}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\tEvent.bind(addButton, \"click\", this.onEnumerationItemAddButtonClick.bind(this));\n\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"ui-entity-editor-content-block-add-field\">\n\t\t\t\t\t\t${addButton}\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\tenumWrapper\n\t\t\t);\n\n\t\t\tif (this._field)\n\t\t\t{\n\t\t\t\tthis._field.getItems().forEach(enumFields => {\n\t\t\t\t\tif (enumFields.VALUE !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.createEnumerationItem({\n\t\t\t\t\t\t\tVALUE: enumFields.NAME,\n\t\t\t\t\t\t\tID: enumFields.VALUE\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.createEnumerationItem();\n\t\t\tthis.initItemFocusHandlers();\n\t\t}\n\t}\n\n\tonEnumerationItemAddButtonClick()\n\t{\n\t\tthis.unbindItemFocusHandlers();\n\t\tthis.createEnumerationItem().focus();\n\t\tthis.bindLastItemFocusHandler();\n\t}\n\n\tonEnumerationItemFocus()\n\t{\n\t\tthis.unbindItemFocusHandlers();\n\t\tthis.createEnumerationItem();\n\t\tthis.bindLastItemFocusHandler();\n\t}\n\n\tinitItemFocusHandlers()\n\t{\n\t\tthis.unbindItemFocusHandlers();\n\t\tthis.bindLastItemFocusHandler();\n\t}\n\n\tunbindItemFocusHandlers()\n\t{\n\t\tthis._enumItems.forEach(item => Event.unbindAll(item._labelInput, 'focus'));\n\t}\n\n\tbindLastItemFocusHandler()\n\t{\n\t\tconst lastItem = this._enumItems[this._enumItems.length - 1];\n\t\tif (lastItem)\n\t\t{\n\t\t\tEvent.bindOnce(lastItem._labelInput, 'focus', this.onEnumerationItemFocus.bind(this));\n\t\t}\n\t}\n\n\tcreateEnumerationItem(data)\n\t{\n\t\tvar item = BX.UI.EntityEditorUserFieldListItem.create(\n\t\t\t\"\",\n\t\t\t{\n\t\t\t\tconfigurator: this,\n\t\t\t\tcontainer: this._enumItemContainer,\n\t\t\t\tdata: data\n\t\t\t}\n\t\t);\n\n\t\tthis._enumItems.push(item);\n\t\titem.layout();\n\t\treturn item;\n\t}\n\n\tremoveEnumerationItem(item)\n\t{\n\t\tfor (var i = 0, length = this._enumItems.length; i < length; i++)\n\t\t{\n\t\t\tif (this._enumItems[i] === item)\n\t\t\t{\n\t\t\t\tthis._enumItems[i].clearLayout();\n\t\t\t\tthis._enumItems.splice(i, 1);\n\t\t\t\tthis.initItemFocusHandlers();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tprepareSaveParams(e)\n\t{\n\t\tconst params = super.prepareSaveParams(this, arguments);\n\t\tif (this._typeId === 'list' || this._typeId === 'multilist')\n\t\t{\n\t\t\tparams['enumeration'] = [];\n\t\t\tconst hashes = [];\n\t\t\tthis._enumItems.forEach(enumItem => {\n\t\t\t\tif (!(enumItem instanceof BX.UI.EntityEditorUserFieldListItem))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst enumData = enumItem.prepareData();\n\t\t\t\tif (!enumData)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst hash = BX.util.hashCode(enumData['VALUE']);\n\t\t\t\tif (BX.util.in_array(hash, hashes))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\thashes.push(hash);\n\t\t\t\tenumData['SORT'] = (params['enumeration'].length + 1) * 100;\n\t\t\t\tparams['enumeration'].push(enumData);\n\t\t\t});\n\t\t}\n\t\telse if (this._typeId === 'datetime' || this._typeId === 'multidatetime')\n\t\t{\n\t\t\tparams['enableTime'] = this._isTimeEnabledCheckBox.checked;\n\t\t}\n\n\t\treturn params;\n\t}\n\n\tgetMultipleCheckBox()\n\t{\n\t\tvar checkBox = this.createOption({caption: BX.message(\"UI_ENTITY_EDITOR_UF_MULTIPLE_FIELD\")});\n\t\tif (\n\t\t\tthis._field instanceof BX.UI.EntityEditorMultiText\n\t\t\t|| this._field instanceof BX.UI.EntityEditorMultiNumber\n\t\t\t|| this._field instanceof BX.UI.EntityEditorMultiList\n\t\t\t|| this._field instanceof BX.UI.EntityEditorMultiDatetime\n\t\t)\n\t\t{\n\t\t\tcheckBox.checked = true;\n\t\t}\n\n\t\treturn checkBox;\n\t}\n\n\tgetIsRequiredCheckBox()\n\t{\n\t\tlet checkBox = null;\n\t\tif (this._typeId !== \"boolean\")\n\t\t{\n\t\t\tif (this._enableMandatoryControl)\n\t\t\t{\n\t\t\t\tif (this._mandatoryConfigurator)\n\t\t\t\t{\n\t\t\t\t\tcheckBox = this.createOption(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcaption: this._mandatoryConfigurator.getTitle() + \":\",\n\t\t\t\t\t\t\tlabelSettings: {props: {className: \"ui-entity-new-field-addiction-label\"}},\n\t\t\t\t\t\t\tcontainerSettings: {style: {alignItems: \"center\"}},\n\t\t\t\t\t\t\telements: this._mandatoryConfigurator.getButton().prepareLayout()\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tcheckBox.checked = (this._field && this._field.isRequired())\n\t\t\t\t\t\t|| this._mandatoryConfigurator.isCustomized();\n\n\t\t\t\t\tthis._mandatoryConfigurator.setSwitchCheckBox(checkBox);\n\t\t\t\t\tthis._mandatoryConfigurator.setLabel(checkBox.nextSibling);\n\n\t\t\t\t\tthis._mandatoryConfigurator.setEnabled(checkBox.checked);\n\t\t\t\t\tthis._mandatoryConfigurator.adjust();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcheckBox = this.createOption({caption: BX.message(\"UI_ENTITY_EDITOR_UF_REQUIRED_FIELD\")});\n\t\t\t\t\tcheckBox.checked = this._field && this._field.isRequired();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn checkBox;\n\t}\n\n\tgetIsTimeEnabledCheckBox()\n\t{\n\t\tvar checkBox = null;\n\t\tif (this._typeId === \"datetime\" || this._typeId === \"multidatetime\")\n\t\t{\n\t\t\tcheckBox = this.createOption({caption: BX.message(\"UI_ENTITY_EDITOR_UF_ENABLE_TIME\")});\n\t\t\tcheckBox.checked = this._field && this._field.isTimeEnabled();\n\t\t}\n\t\treturn checkBox;\n\t}\n}","import GridFieldConfigurator from './grid-field-configurator'\nimport {Loc, Reflection, Type} from 'main.core';\n\nexport default class GridFieldConfigurationManager extends BX.UI.EntityConfigurationManager\n{\n\tcreateFieldConfigurator(params, parent)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tthrow \"GridFieldConfigurationManager: The 'params' argument must be object.\";\n\t\t}\n\n\t\treturn this.getSimpleFieldConfigurator(params, parent);\n\t}\n\n\tgetSimpleFieldConfigurator(params, parent)\n\t{\n\t\tlet typeId = \"\";\n\t\tconst child = BX.prop.get(params, 'field', null);\n\t\tif (child)\n\t\t{\n\t\t\ttypeId = child.getType();\n\t\t\tchild.setVisible(false);\n\n\t\t\tif (!BX.prop.get(child.getSchemeElement().getData(), \"isProductProperty\", false))\n\t\t\t{\n\t\t\t\treturn this._fieldConfigurator = BX.UI.EntityEditorFieldConfigurator.create(\n\t\t\t\t\t\"\",\n\t\t\t\t\t{\n\t\t\t\t\t\teditor: this._editor,\n\t\t\t\t\t\tschemeElement: null,\n\t\t\t\t\t\tmodel: parent._model,\n\t\t\t\t\t\tmode: BX.UI.EntityEditorMode.edit,\n\t\t\t\t\t\tparent: parent,\n\t\t\t\t\t\ttypeId: typeId,\n\t\t\t\t\t\tfield: child,\n\t\t\t\t\t\tmandatoryConfigurator: null\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttypeId = BX.prop.get(params, 'typeId', BX.UI.EntityUserFieldType.string);\n\t\t}\n\n\t\tthis._fieldConfigurator = GridFieldConfigurator.create(\n\t\t\t'',\n\t\t\t{\n\t\t\t\teditor: this._editor,\n\t\t\t\tschemeElement: null,\n\t\t\t\tmodel: parent._model,\n\t\t\t\tmode: BX.UI.EntityEditorMode.edit,\n\t\t\t\tparent: parent,\n\t\t\t\ttypeId: typeId,\n\t\t\t\tfield: child,\n\t\t\t\tmandatoryConfigurator: null\n\t\t\t}\n\t\t);\n\n\t\treturn this._fieldConfigurator;\n\t}\n\n\tisSelectionEnabled()\n\t{\n\t\treturn false;\n\t}\n\n\tisCreationEnabled()\n\t{\n\t\treturn false;\n\t}\n\n\thasExternalForm(typeId)\n\t{\n\t\treturn true;\n\t}\n\n\tgetCreationPageUrl(typeId)\n\t{\n\t\tconst filtered = this.getTypeInfos().filter((item) => {\n\t\t\treturn item.name === typeId\n\t\t});\n\t\tif (filtered.length > 0)\n\t\t{\n\t\t\treturn this.creationPageUrl.replace('#PROPERTY_TYPE#', typeId);\n\t\t}\n\t}\n\n\topenCreationPageUrl(typeId)\n\t{\n\t\tconst okCallback = () => this.openCreationPageSlider(this.getCreationPageUrl(typeId));\n\t\tconst variationGridInstance = Reflection.getClass('BX.Catalog.VariationGrid.Instance');\n\n\t\tif (variationGridInstance)\n\t\t{\n\t\t\tvariationGridInstance.askToLossGridData(okCallback, null, {\n\t\t\t\tmessage: Loc.getMessage('CATALOG_ENTITY_CARD_UNSAVED_DATA_MESSAGE')\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tokCallback();\n\t\t}\n\t}\n\n\topenCreationPageSlider(url)\n\t{\n\t\tif (Type.isStringFilled(url))\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(url, {\n\t\t\t\twidth: 550,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tcacheable: false\n\t\t\t});\n\t\t}\n\t}\n\n\tsetCreationPageUrl(url)\n\t{\n\t\treturn this.creationPageUrl = url;\n\t}\n\n\tgetTypeInfos()\n\t{\n\t\treturn [\n\t\t\t{\n\t\t\t\tname: \"list\",\n\t\t\t\ttitle: BX.message(\"CATALOG_ENTITY_CARD_LIST_TITLE\"),\n\t\t\t\tlegend: BX.message(\"CATALOG_ENTITY_CARD_LIST_LEGEND\")\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"directory\",\n\t\t\t\ttitle: BX.message(\"CATALOG_ENTITY_CARD_DICTIONARY_TITLE\"),\n\t\t\t\tlegend: BX.message(\"CATALOG_ENTITY_CARD_DICTIONARY_LEGEND\")\n\t\t\t}\n\t\t];\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new this;\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}","import {Dom, Loc, Reflection, Tag, Text, Type} from 'main.core';\nimport {type BaseEvent, EventEmitter} from 'main.core.events'\nimport './entity-card.css';\nimport TabManager from './tab/manager';\nimport 'ui.entity-editor';\nimport 'ui.notification';\nimport FieldsFactory from './fields-factory'\nimport ControllersFactory from './controllers-factory'\nimport IblockFieldConfigurationManager from './field-configurator/iblock-field-configuration-manager'\nimport GridFieldConfigurationManager from './field-configurator/grid-field-configuration-manager';\n\nexport class EntityCard\n{\n\tstackWithOffset = null;\n\n\tconstructor(id, settings = {})\n\t{\n\t\tthis.id = Type.isStringFilled(id) ? id : Text.getRandom();\n\t\tthis.settings = settings;\n\t\tthis.cardSettings = settings.cardSettings || [];\n\t\tthis.feedbackUrl = settings.feedbackUrl || ''\n\n\t\tthis.entityId = Text.toInteger(settings.entityId) || 0;\n\t\tthis.container = document.getElementById(settings.containerId);\n\n\t\tthis.componentName = settings.componentName || null;\n\t\tthis.componentSignedParams = settings.componentSignedParams || null;\n\n\t\tthis.isSimpleProduct = settings.isSimpleProduct || false;\n\n\t\tthis.initializeTabManager();\n\t\tthis.checkFadeOverlay();\n\t\tthis.registerFieldsFactory();\n\t\tthis.registerControllersFactory();\n\t\tthis.registerEvents();\n\t}\n\n\tgetEntityType()\n\t{\n\t\treturn 'Entity';\n\t}\n\n\tgetCardSetting(id: string)\n\t{\n\t\treturn this.cardSettings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\tisCardSettingEnabled(id: string)\n\t{\n\t\tconst settingItem = this.getCardSetting(id);\n\n\t\treturn settingItem && settingItem.checked;\n\t}\n\n\tinitializeTabManager()\n\t{\n\t\treturn new TabManager(this.id, {\n\t\t\tcontainer: document.getElementById(this.settings.tabContainerId),\n\t\t\tmenuContainer: document.getElementById(this.settings.tabMenuContainerId),\n\t\t\tdata: this.settings.tabs || []\n\t\t});\n\t}\n\n\tcheckFadeOverlay()\n\t{\n\t\tif (this.entityId <= 0)\n\t\t{\n\t\t\tthis.overlay = Tag.render`<div class=\"catalog-entity-overlay\"></div>`;\n\t\t\tDom.append(this.overlay, this.container);\n\n\t\t\tif (window === window.top)\n\t\t\t{\n\t\t\t\tthis.overlay.style.position = 'absolute';\n\t\t\t\tthis.overlay.style.top = this.overlay.style.left = this.overlay.style.right = '-15px';\n\t\t\t}\n\t\t}\n\t}\n\n\tregisterFieldsFactory()\n\t{\n\t\treturn new FieldsFactory();\n\t}\n\n\tregisterControllersFactory()\n\t{\n\t\treturn new ControllersFactory();\n\t}\n\n\tregisterEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.EntityConfigurationManager:onInitialize', this.onConfigurationManagerInit.bind(this));\n\t\tEventEmitter.subscribe('BX.UI.EntityEditor:onCancel', this.removeFileHiddenInputs.bind(this));\n\t\tEventEmitter.subscribe('BX.UI.EntityEditor:onInit', this.onEditorInitHandler.bind(this));\n\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorAjaxSubmit.bind(this));\n\t\tEventEmitter.subscribe('onEntityCreate', this.onEntityCreateHandler.bind(this));\n\t\tEventEmitter.subscribe('onEntityUpdate', this.onEntityUpdateHandler.bind(this));\n\n\t\tEventEmitter.subscribe('onAttachFiles', this.onAttachFilesHandler.bind(this));\n\t\tEventEmitter.subscribe('BX.Main.Popup:onClose', this.onFileEditorCloseHandler.bind(this));\n\t}\n\n\tonAttachFilesHandler(event: BaseEvent)\n\t{\n\t\tconst editor = this.getEditorInstance();\n\t\tif (!editor)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst [, , uploader] = event.getCompatData();\n\t\tif (uploader && Type.isDomNode(uploader.fileInput))\n\t\t{\n\t\t\tconst parent = uploader.fileInput.closest('[data-cid]');\n\n\t\t\tif (Type.isDomNode(parent))\n\t\t\t{\n\t\t\t\tconst controlName = parent.getAttribute('data-cid');\n\t\t\t\tconst control = editor.getControlByIdRecursive(controlName);\n\n\t\t\t\tif (control)\n\t\t\t\t{\n\t\t\t\t\tcontrol.markAsChanged();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonFileEditorCloseHandler(event: BaseEvent)\n\t{\n\t\tconst [popup] = event.getCompatData();\n\t\tif (popup && popup.getId() === 'popupFM' && popup.onApplyFlag)\n\t\t{\n\t\t\tthis.showNotification(Loc.getMessage('CATALOG_ENTITY_CARD_FILE_CLOSE_NOTIFICATION'), {\n\t\t\t\tautoHideDelay: 5000\n\t\t\t});\n\t\t}\n\t}\n\n\tonEditorInitHandler(event: BaseEvent)\n\t{\n\t\tconst [editor, fields] = event.getCompatData();\n\n\t\tif (editor && !fields.entityId)\n\t\t{\n\t\t\tconst control = editor.getControlByIdRecursive('NAME');\n\n\t\t\tif (control)\n\t\t\t{\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tcontrol.focus()\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @returns {BX.UI.EntityEditor|null}\n\t */\n\tgetEditorInstance()\n\t{\n\t\tif (Reflection.getClass('BX.UI.EntityEditor'))\n\t\t{\n\t\t\treturn BX.UI.EntityEditor.getDefault();\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tonEditorAjaxSubmit(event: BaseEvent)\n\t{\n\t\tconst [fields, response] = event.getCompatData();\n\n\t\tconst title = fields.NAME || '';\n\t\tthis.changePageTitle(title);\n\n\t\tif (response.data)\n\t\t{\n\t\t\tif (Type.isBoolean(response.data.IS_SIMPLE_PRODUCT))\n\t\t\t{\n\t\t\t\tthis.isSimpleProduct = response.data.IS_SIMPLE_PRODUCT;\n\t\t\t}\n\t\t}\n\n\t\tif (response.status === 'success')\n\t\t{\n\t\t\tthis.removeFileHiddenInputs();\n\t\t}\n\t}\n\n\tonEntityCreateHandler(event: BaseEvent)\n\t{\n\t\tconst [data] = event.getCompatData();\n\t\tthis.postSliderMessage('onCreate', data)\n\t}\n\n\tonEntityUpdateHandler(event: BaseEvent)\n\t{\n\t\tconst [data] = event.getCompatData();\n\t\tthis.postSliderMessage('onUpdate', data)\n\t}\n\n\tpostSliderMessage(action, fields)\n\t{\n\t\tBX.SidePanel.Instance.postMessage(\n\t\t\twindow,\n\t\t\t`Catalog.${this.getEntityType()}Card::${action}`,\n\t\t\tfields\n\t\t);\n\t}\n\n\tchangePageTitle(title)\n\t{\n\t\tconst titleNode = document.getElementById('pagetitle');\n\n\t\tif (Type.isDomNode(titleNode))\n\t\t{\n\t\t\ttitleNode.innerText = title;\n\t\t}\n\n\t\tdocument.title = title;\n\n\t\tif (BX.getClass('BX.SidePanel.Instance.updateBrowserTitle'))\n\t\t{\n\t\t\tBX.SidePanel.Instance.updateBrowserTitle();\n\t\t}\n\t}\n\n\tremoveFileHiddenInputs()\n\t{\n\t\tdocument.querySelectorAll('form>input[type=\"hidden\"]')\n\t\t\t.forEach(input => {\n\t\t\t\tlet name = input.getAttribute('name');\n\t\t\t\tlet deleteInput = document.querySelector(`form>input[name=\"${name}_del\"]`);\n\n\t\t\t\tif (deleteInput)\n\t\t\t\t{\n\t\t\t\t\tDom.remove(input);\n\t\t\t\t\tDom.remove(deleteInput);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tonConfigurationManagerInit(event: BaseEvent)\n\t{\n\t\tconst [, eventArgs] = event.getCompatData();\n\n\t\tif (!eventArgs.type || eventArgs.type === 'editor')\n\t\t{\n\t\t\teventArgs.configurationFieldManager = this.initializeIblockFieldConfigurationManager(eventArgs);\n\t\t}\n\n\t\tif (eventArgs.id === 'variation_grid')\n\t\t{\n\t\t\teventArgs.configurationFieldManager = this.initializeVariationPropertyConfigurationManager(eventArgs);\n\t\t}\n\t}\n\n\tinitializeIblockFieldConfigurationManager(eventArgs)\n\t{\n\t\tconst configurationManager = IblockFieldConfigurationManager.create(this.id, eventArgs);\n\t\tconfigurationManager.setCreationPageUrl(this.settings.creationPropertyUrl);\n\n\t\treturn configurationManager;\n\t}\n\n\tinitializeVariationPropertyConfigurationManager(eventArgs)\n\t{\n\t\tconst configurationManager = GridFieldConfigurationManager.create(this.id, eventArgs);\n\t\tconfigurationManager.setCreationPageUrl(this.settings.creationVariationPropertyUrl);\n\n\t\treturn configurationManager;\n\t}\n\n\tshowNotification(content, options)\n\t{\n\t\toptions = options || {};\n\n\t\tif (BX.GetWindowScrollPos().scrollTop <= 10)\n\t\t{\n\t\t\toptions.stack = this.getStackWithOffset();\n\t\t}\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tgetStackWithOffset()\n\t{\n\t\tif (this.stackWithOffset === null)\n\t\t{\n\t\t\tthis.stackWithOffset = new BX.UI.Notification.Stack(BX.mergeEx(\n\t\t\t\t{},\n\t\t\t\tBX.UI.Notification.Center.getStackDefaults(),\n\t\t\t\t{\n\t\t\t\t\tid: 'top-right-with-offset',\n\t\t\t\t\tposition: 'top-right-with-offset',\n\t\t\t\t\toffsetY: 74\n\t\t\t\t}\n\t\t\t));\n\t\t}\n\n\t\treturn this.stackWithOffset;\n\t}\n\n\topenFeedbackPanel()\n\t{\n\t\tif (!Reflection.getClass('BX.SidePanel.Instance') || !Type.isStringFilled(this.feedbackUrl))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.SidePanel.Instance.open(this.feedbackUrl, {\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: false,\n\t\t\twidth: 580\n\t\t});\n\t}\n}"],"names":["LazyLoader","id","settings","Type","isStringFilled","Text","getRandom","isObjectLike","container","serviceUrl","tabId","params","componentData","isRequestRunning","loaded","isLoaded","startRequest","BX","ajax","url","method","dataType","data","onsuccess","onRequestSuccess","bind","onfailure","onRequestFailure","innerHTML","Tab","manager","menuContainer","active","isBoolean","enabled","Event","querySelector","onMenuClick","loader","isActive","showTab","hideTab","Dom","addClass","removeClass","style","display","position","top","left","width","easing","duration","start","opacity","translateX","finish","transition","makeEaseOut","transitions","quart","step","state","transform","complete","cssText","EventEmitter","emit","window","animate","event","isEnabled","load","selectItem","preventDefault","Manager","items","isArray","forEach","item","push","find","current","setActive","IblockSectionField","initialize","innerWrapper","tileSelector","options","_hasLayout","ensureWrapperCreated","classNames","adjustWrapper","isNeedToDisplay","_wrapper","appendChild","createTitleNode","getTitle","_mode","UI","EntityEditorMode","edit","drawEditMode","drawViewMode","isContextMenuEnabled","createContextMenuButton","registerLayout","defaultInput","Tag","render","getName","runComponentAction","mode","iblockId","getIblockId","productId","getProductId","selectedSectionIds","getValue","then","renderFromResponse","catch","response","Error","errors","join","Runtime","html","callback","initTileSelector","TileSelector","getById","getTileSelectorId","changeDisplay","buttonAdd","subscribe","events","buttonSelectFirst","tileSelectorSelectFirstHandler","input","onInputSearch","onButtonAdd","buttonSelect","onButtonSelect","tileAdd","markAsChanged","tileRemove","search","onInputEnd","searcherInit","onSearcherInit","onBlur","bottom","node","isShow","getEditor","getData","setTimeout","seacher","popup","PopupWindowManager","getPopupById","destroy","categoryContainer","parentNode","removeChild","showSearcher","type","isNotEmptyString","value","name","onAddSection","searcher","addItem","onItemClick","regexp","RegExp","util","escapeRegExp","filtered","filter","test","length","hide","show","setSearcherData","hideSearcher","hasNoSections","Loc","getMessage","content","Object","entries","getSections","encode","_model","getField","sectionIds","includes","unsubscribeAll","clean","result","EntityEditorModeSwitchType","common","button","EntityEditorField","FieldsFactory","getCompatData","eventArgs","methods","factory","controlId","PROPERTY_PREFIX","PROPERTY_BLOCK_NAME","IblockSectionController","isRequesting","clearServiceFields","_editor","onChangeHandler","onFieldAdd","onFieldUpdate","lastDataHash","initialElements","deletedControls","deletedAvailableSchemes","field","newData","list","map","tile","newDataHash","JSON","stringify","clearTimeout","timeout","refreshLinkedProperties","section","fields","getFieldsForm","_settings","ajaxData","COMPONENT_NAME","signedParameters","SIGNED_PARAMETERS","propertySection","getSchemeElementByName","property","PROPERTY_FIELDS","additionalValues","ADDITIONAL_VALUES","model","key","setField","view","EntityEditorSection","getMode","control","createProperty","layout","notifyIfNotDisplayed","forceDisplay","showAlways","toggleOptionFlag","saveSchemeChanges","EntityEditorControl","currentField","CODE","getId","schemeElement","getSchemeElement","_isRequired","mandatory","EntityEditorDatetime","EntityEditorMultiDatetime","enableTime","newType","multiple","EntityEditorText","EntityEditorList","EntityEditorNumber","EntityEditorMultiList","EntityEditorMultiNumber","EntityEditorMultiText","EntitySchemeElement","create","index","getChildIndex","newControl","createControl","parent","addChild","enableSaving","form","FormData","formatted","NAME","label","MULTIPLE","IS_REQUIRED","PROPERTY_TYPE","typeId","enumeration","enumItem","append","getFormFieldName","SORT","VALUE","ID","USER_TYPE","XML_ID","FILE_ID","file","LIST_TYPE","allCurrentProperties","getAllCurrentProperties","ENTITY_FIELDS","addProperty","newProperties","el","removeProperty","commitSchemeChanges","activeProperties","getAllControls","indexOf","hiddenProperties","getAvailableSchemeElements","restoreDeletedProperty","restoreDeletedAvailableProperty","getParent","registerActiveControl","unregisterActiveControl","addAvailableSchemeElement","propertyBlockScheme","_elements","getType","propertyBlockControl","getControlById","getControlByIdRecursive","removeAvailableSchemeElement","getAvailableSchemeElementByName","element","EntityEditorController","VariationGridController","markAsChangedHandler","checkEditorToolbar","onBeforeGridRequest","ajaxSuccessHandler","onBeforeIncludedAreaLoaded","onAfterIncludedAreaLoaded","subscribeToFormSubmit","isNumber","areaHeight","getVariationGridLoader","getGridControl","wrapper","getWrapper","unsubscribeGridEvents","isChanged","setGridControlCache","_loadedHtml","Reflection","getClass","gridComponent","getVariationGridComponent","unsubscribeCustomEvents","xhrData","getReloadUrl","_ajaxForm","onBeforeSubmitForm","isNew","_isChanged","getActiveControlCount","showToolPanel","hideToolPanel","_toolPanel","clearErrors","sessid","bitrix_sessid","getSignedParameters","getConfigStringParam","Main","gridManager","getInstanceById","getGridId","grid","getGrid","skuGridName","skuGridData","getRows","getEditSelectedValues","hasOwnProperty","priceField","newName","replace","endsWith","isFile","fieldName","newFilesRegExp","fileCounter","fileSetting","match","isPlainObject","offsetHeight","ControllersFactory","IblockDirectoryFieldItem","_fileInput","prop","getString","_data","onFileLoaderChange","link","labelText","_labelInput","message","deleteButton","onDeleteButtonClick","anchor","getElementNode","_container","insertBefore","target","files","reader","FileReader","onload","e","src","fileChanged","readAsDataURL","classList","remove","textValue","trim","fileValue","isFileChanged","xmlId","self","EntityEditorUserFieldListItem","IblockFieldConfigurator","getInputContainer","_typeId","getEnumerationContainer","getOptionContainer","getErrorContainer","getButtonContainer","_field","_optionWrapper","_isTimeEnabledCheckBox","getIsTimeEnabledCheckBox","_enableMandatoryControl","_isRequiredCheckBox","getIsRequiredCheckBox","_isMultipleCheckBox","getMultipleCheckBox","_showAlwaysCheckBox","createOption","caption","helpUrl","helpCode","checked","getBoolean","checkOptionFlag","EntityEditorControlOptions","getUserFieldManager","getDefaultFieldLabel","_errorContainer","enumWrapper","_enumItemContainer","addButton","onEnumerationItemAddButtonClick","getItems","enumFields","createEnumerationItem","IMAGE","IMAGE_SRC","TEXT","lastItem","focus","initItemClickHandlers","unbindItemClickHandlers","bindLastItemClickHandler","_enumItems","unbindAll","bindOnce","onEnumerationItemClick","configurator","i","clearLayout","splice","arguments","hashes","enumData","prepareData","hash","hashCode","in_array","checkBox","_mandatoryConfigurator","labelSettings","props","className","containerSettings","alignItems","elements","getButton","prepareLayout","isRequired","isCustomized","setSwitchCheckBox","setLabel","nextSibling","setEnabled","adjust","isTimeEnabled","EntityEditorFieldConfigurator","namespace","IblockFieldConfigurationManager","getSimpleFieldConfigurator","get","setVisible","_fieldConfigurator","editor","mandatoryConfigurator","EntityUserFieldType","string","creationPageUrl","SidePanel","Instance","open","getCreationPageUrl","allowChangeHistory","cacheable","title","legend","EntityConfigurationManager","GridFieldConfigurator","initItemFocusHandlers","unbindItemFocusHandlers","bindLastItemFocusHandler","onEnumerationItemFocus","GridFieldConfigurationManager","child","getTypeInfos","okCallback","openCreationPageSlider","variationGridInstance","askToLossGridData","EntityCard","cardSettings","feedbackUrl","entityId","toInteger","document","getElementById","containerId","componentName","componentSignedParams","isSimpleProduct","initializeTabManager","checkFadeOverlay","registerFieldsFactory","registerControllersFactory","registerEvents","settingItem","getCardSetting","TabManager","tabContainerId","tabMenuContainerId","tabs","overlay","right","onConfigurationManagerInit","removeFileHiddenInputs","onEditorInitHandler","onEditorAjaxSubmit","onEntityCreateHandler","onEntityUpdateHandler","onAttachFilesHandler","onFileEditorCloseHandler","getEditorInstance","uploader","isDomNode","fileInput","closest","controlName","getAttribute","onApplyFlag","showNotification","autoHideDelay","requestAnimationFrame","EntityEditor","getDefault","changePageTitle","IS_SIMPLE_PRODUCT","status","postSliderMessage","action","postMessage","getEntityType","titleNode","innerText","updateBrowserTitle","querySelectorAll","deleteInput","configurationFieldManager","initializeIblockFieldConfigurationManager","initializeVariationPropertyConfigurationManager","configurationManager","setCreationPageUrl","creationPropertyUrl","creationVariationPropertyUrl","GetWindowScrollPos","scrollTop","stack","getStackWithOffset","Notification","Center","notify","category","stackWithOffset","Stack","mergeEx","getStackDefaults","offsetY"],"mappings":";;;;;KAEqBA;;;CAEpB,sBAAYC,EAAZ,EAAgBC,QAAhB,EACA;CAAA;CACC,SAAKD,EAAL,GAAUE,cAAI,CAACC,cAAL,CAAoBH,EAApB,IAA0BA,EAA1B,GAA+BI,cAAI,CAACC,SAAL,EAAzC;CACA,SAAKJ,QAAL,GAAgBC,cAAI,CAACI,YAAL,CAAkBL,QAAlB,IAA8BA,QAA9B,GAAyC,EAAzD;CAEA,SAAKM,SAAL,GAAiB,KAAKN,QAAL,CAAcM,SAA/B;;CACA,QAAI,CAAC,KAAKA,SAAV,EACA;CACC,YAAM,kCAAN;CACA;;CAED,SAAKC,UAAL,GAAkB,KAAKP,QAAL,CAAcO,UAAd,IAA4B,EAA9C;;CACA,QAAI,CAACN,cAAI,CAACC,cAAL,CAAoB,KAAKK,UAAzB,CAAL,EACA;CACC,YAAM,oCAAN;CACA;;CAED,SAAKC,KAAL,GAAa,KAAKR,QAAL,CAAcQ,KAAd,IAAuB,EAApC;;CACA,QAAI,CAACP,cAAI,CAACC,cAAL,CAAoB,KAAKM,KAAzB,CAAL,EACA;CACC,YAAM,+BAAN;CACA;;CAED,SAAKC,MAAL,GAAcR,cAAI,CAACI,YAAL,CAAkB,KAAKL,QAAL,CAAcU,aAAhC,IAAiD,KAAKV,QAAL,CAAcU,aAA/D,GAA+E,EAA7F;CAEA,SAAKC,gBAAL,GAAwB,KAAxB;CACA,SAAKC,MAAL,GAAc,KAAd;CACA;;;;gCAGD;CACC,aAAO,KAAKA,MAAZ;CACA;;;4BAGD;CACC,UAAI,CAAC,KAAKC,QAAL,EAAL,EACA;CACC,aAAKC,YAAL,+BAAsB,KAAKL,MAA3B,EAAsC;CAAC,mBAAS,KAAKD;CAAf,SAAtC;CACA;CACD;;;kCAEYC,QACb;CACC,UAAI,KAAKE,gBAAT,EACA;CACC,eAAO,KAAP;CACA;;CAED,WAAKA,gBAAL,GAAwB,IAAxB;CAEAI,MAAAA,EAAE,CAACC,IAAH,CAAQ;CACPC,QAAAA,GAAG,EAAE,KAAKV,UADH;CAEPW,QAAAA,MAAM,EAAE,MAFD;CAGPC,QAAAA,QAAQ,EAAE,MAHH;CAIPC,QAAAA,IAAI,EAAE;CACL,sBAAY,KAAKrB,EADZ;CAEL,oBAAUU;CAFL,SAJC;CAQPY,QAAAA,SAAS,EAAE,KAAKC,gBAAL,CAAsBC,IAAtB,CAA2B,IAA3B,CARJ;CASPC,QAAAA,SAAS,EAAE,KAAKC,gBAAL,CAAsBF,IAAtB,CAA2B,IAA3B;CATJ,OAAR;CAYA,aAAO,IAAP;CACA;;;sCAEgBH,MACjB;CACC,WAAKT,gBAAL,GAAwB,KAAxB;CACA,WAAKL,SAAL,CAAeoB,SAAf,GAA2BN,IAA3B;CACA,WAAKR,MAAL,GAAc,IAAd;CACA;;;wCAGD;CACC,WAAKD,gBAAL,GAAwB,KAAxB;CACA,WAAKC,MAAL,GAAc,IAAd;CACA;;;;;KC9EmBe;;;CAEpB,eAAY5B,EAAZ,EAAgBC,QAAhB,EACA;CAAA;CACC,SAAKD,EAAL,GAAUE,cAAI,CAACC,cAAL,CAAoBH,EAApB,IAA0BA,EAA1B,GAA+BI,cAAI,CAACC,SAAL,EAAzC;CACA,SAAKJ,QAAL,GAAgBC,cAAI,CAACI,YAAL,CAAkBL,QAAlB,IAA8BA,QAA9B,GAAyC,EAAzD;CACA,SAAKoB,IAAL,GAAYnB,cAAI,CAACI,YAAL,CAAkB,KAAKL,QAAL,CAAcoB,IAAhC,IAAwC,KAAKpB,QAAL,CAAcoB,IAAtD,GAA6D,EAAzE;CAEA,SAAKQ,OAAL,GAAe5B,QAAQ,CAAC4B,OAAT,IAAoB,IAAnC;CAEA,SAAKtB,SAAL,GAAiB,KAAKN,QAAL,CAAcM,SAA/B;CACA,SAAKuB,aAAL,GAAqB,KAAK7B,QAAL,CAAc6B,aAAnC;CAEA,SAAKC,MAAL,GAAc7B,cAAI,CAAC8B,SAAL,CAAe,KAAKX,IAAL,CAAUU,MAAzB,IAAmC,KAAKV,IAAL,CAAUU,MAA7C,GAAsD,KAApE;CACA,SAAKE,OAAL,GAAe/B,cAAI,CAAC8B,SAAL,CAAe,KAAKX,IAAL,CAAUY,OAAzB,IAAoC,KAAKZ,IAAL,CAAUY,OAA9C,GAAwD,IAAvE;CAEAC,IAAAA,eAAK,CAACV,IAAN,CACC,KAAKM,aAAL,CAAmBK,aAAnB,CAAiC,mCAAjC,CADD,EAEC,OAFD,EAGC,KAAKC,WAAL,CAAiBZ,IAAjB,CAAsB,IAAtB,CAHD;CAMA,SAAKa,MAAL,GAAc,IAAd;;CAEA,QAAInC,cAAI,CAACI,YAAL,CAAkB,KAAKe,IAAL,CAAUgB,MAA5B,CAAJ,EACA;CACC,WAAKA,MAAL,GAAc,IAAItC,UAAJ,CAAe,KAAKC,EAApB,gCACV,KAAKqB,IAAL,CAAUgB,MADA,EAEV;CACF5B,QAAAA,KAAK,EAAE,KAAKT,EADV;CAEFO,QAAAA,SAAS,EAAE,KAAKA;CAFd,OAFU,EAAd;CAOA;CACD;;;;iCAGD;CACC,aAAO,KAAK0B,OAAZ;CACA;;;gCAGD;CACC,aAAO,KAAKF,MAAZ;CACA;;;+BAESA,QACV;CACCA,MAAAA,MAAM,GAAG,CAAC,CAACA,MAAX;;CAEA,UAAI,KAAKO,QAAL,OAAoBP,MAAxB,EACA;CACC;CACA;;CAED,WAAKA,MAAL,GAAcA,MAAd;;CAEA,UAAI,KAAKO,QAAL,EAAJ,EACA;CACC,aAAKC,OAAL;CACA,OAHD,MAKA;CACC,aAAKC,OAAL;CACA;CACD;;;+BAGD;CAAA;;CACCC,MAAAA,aAAG,CAACC,QAAJ,CAAa,KAAKnC,SAAlB,EAA6B,yCAA7B;CACAkC,MAAAA,aAAG,CAACE,WAAJ,CAAgB,KAAKpC,SAArB,EAAgC,yCAAhC;CACAkC,MAAAA,aAAG,CAACC,QAAJ,CAAa,KAAKZ,aAAlB,EAAiC,oCAAjC;CAEA,WAAKvB,SAAL,CAAeqC,KAAf,CAAqBC,OAArB,GAA+B,EAA/B;CACA,WAAKtC,SAAL,CAAeqC,KAAf,CAAqBE,QAArB,GAAgC,UAAhC;CACA,WAAKvC,SAAL,CAAeqC,KAAf,CAAqBG,GAArB,GAA2B,CAA3B;CACA,WAAKxC,SAAL,CAAeqC,KAAf,CAAqBI,IAArB,GAA4B,CAA5B;CACA,WAAKzC,SAAL,CAAeqC,KAAf,CAAqBK,KAArB,GAA6B,MAA7B;CAEC,UAAIjC,EAAE,CAACkC,MAAP,CAAc;CACdC,QAAAA,QAAQ,EAAE,GADI;CAEdC,QAAAA,KAAK,EAAE;CAACC,UAAAA,OAAO,EAAE,CAAV;CAAaC,UAAAA,UAAU,EAAE;CAAzB,SAFO;CAGdC,QAAAA,MAAM,EAAE;CAACF,UAAAA,OAAO,EAAE,GAAV;CAAeC,UAAAA,UAAU,EAAE;CAA3B,SAHM;CAIdE,QAAAA,UAAU,EAAExC,EAAE,CAACkC,MAAH,CAAUO,WAAV,CAAsBzC,EAAE,CAACkC,MAAH,CAAUQ,WAAV,CAAsBC,KAA5C,CAJE;CAKdC,QAAAA,IAAI,EAAE,cAACC,KAAD,EAAW;CAChB,UAAA,KAAI,CAACtD,SAAL,CAAeqC,KAAf,CAAqBS,OAArB,GAA+BQ,KAAK,CAACR,OAAN,GAAgB,GAA/C;CACA,UAAA,KAAI,CAAC9C,SAAL,CAAeqC,KAAf,CAAqBkB,SAArB,GAAiC,gBAAgBD,KAAK,CAACP,UAAtB,GAAmC,IAApE;CACA,SARa;CASdS,QAAAA,QAAQ,EAAE,oBAAM;CACftB,UAAAA,aAAG,CAACE,WAAJ,CAAgB,KAAI,CAACpC,SAArB,EAAgC,yCAAhC;CACA,UAAA,KAAI,CAACA,SAAL,CAAeqC,KAAf,CAAqBoB,OAArB,GAA+B,EAA/B;CAEA9B,UAAAA,eAAK,CAAC+B,YAAN,CAAmBC,IAAnB,CAAwBC,MAAxB,EAAgC,wBAAhC,EAA0D,CAAC,KAAD,CAA1D;CACA;CAda,OAAd,CAAD,CAeIC,OAfJ;CAiBA;;;+BAGD;CAAA;;CACC3B,MAAAA,aAAG,CAACC,QAAJ,CAAa,KAAKnC,SAAlB,EAA6B,yCAA7B;CACAkC,MAAAA,aAAG,CAACE,WAAJ,CAAgB,KAAKpC,SAArB,EAAgC,yCAAhC;CACAkC,MAAAA,aAAG,CAACE,WAAJ,CAAgB,KAAKb,aAArB,EAAoC,oCAApC;CAEC,UAAId,EAAE,CAACkC,MAAP,CAAc;CACdC,QAAAA,QAAQ,EAAE,GADI;CAEdC,QAAAA,KAAK,EAAE;CAACC,UAAAA,OAAO,EAAE;CAAV,SAFO;CAGdE,QAAAA,MAAM,EAAE;CAACF,UAAAA,OAAO,EAAE;CAAV,SAHM;CAIdG,QAAAA,UAAU,EAAExC,EAAE,CAACkC,MAAH,CAAUO,WAAV,CAAsBzC,EAAE,CAACkC,MAAH,CAAUQ,WAAV,CAAsBC,KAA5C,CAJE;CAKdC,QAAAA,IAAI,EAAE,cAACC,KAAD,EAAW;CAChB,UAAA,MAAI,CAACtD,SAAL,CAAeqC,KAAf,CAAqBS,OAArB,GAA+BQ,KAAK,CAACR,OAAN,GAAgB,GAA/C;CACA,SAPa;CAQdU,QAAAA,QAAQ,EAAE,oBAAM;CACf,UAAA,MAAI,CAACxD,SAAL,CAAeqC,KAAf,CAAqBC,OAArB,GAA+B,MAA/B;CACA,UAAA,MAAI,CAACtC,SAAL,CAAeqC,KAAf,CAAqBkB,SAArB,GAAiC,kBAAjC;CACA,UAAA,MAAI,CAACvD,SAAL,CAAeqC,KAAf,CAAqBS,OAArB,GAA+B,CAA/B;CACA;CAZa,OAAd,CAAD,CAaIe,OAbJ;CAcA;;;iCAEWC,OACZ;CACC,UAAI,KAAKC,SAAL,EAAJ,EACA;CACC,YAAI,KAAKjC,MAAL,IAAe,CAAC,KAAKA,MAAL,CAAYvB,QAAZ,EAApB,EACA;CACC,eAAKuB,MAAL,CAAYkC,IAAZ;CACA;;CAED,aAAK1C,OAAL,CAAa2C,UAAb,CAAwB,IAAxB;CACA;;CAEDH,MAAAA,KAAK,CAACI,cAAN;CACA;;;;;KCrImBC;;;CAEpB,mBAAY1E,EAAZ,EAAgBC,QAAhB,EACA;CAAA;;CAAA;CACC,SAAKD,EAAL,GAAUE,cAAI,CAACC,cAAL,CAAoBH,EAApB,IAA0BA,EAA1B,GAA+BI,cAAI,CAACC,SAAL,EAAzC;CACA,SAAKJ,QAAL,GAAgBC,cAAI,CAACI,YAAL,CAAkBL,QAAlB,IAA8BA,QAA9B,GAAyC,EAAzD;CAEA,SAAKM,SAAL,GAAiB,KAAKN,QAAL,CAAcM,SAA/B;CACA,SAAKuB,aAAL,GAAqB,KAAK7B,QAAL,CAAc6B,aAAnC;CAEA,SAAK6C,KAAL,GAAa,EAAb;;CAEA,QAAIzE,cAAI,CAAC0E,OAAL,CAAa,KAAK3E,QAAL,CAAcoB,IAA3B,CAAJ,EACA;CACC,WAAKpB,QAAL,CAAcoB,IAAd,CAAmBwD,OAAnB,CAA2B,UAAAC,IAAI,EAAI;CAClC,QAAA,KAAI,CAACH,KAAL,CAAWI,IAAX,CACC,IAAInD,GAAJ,CAAQkD,IAAI,CAAC9E,EAAb,EAAiB;CAChB6B,UAAAA,OAAO,EAAE,KADO;CAEhBR,UAAAA,IAAI,EAAEyD,IAFU;CAGhBvE,UAAAA,SAAS,EAAE,KAAI,CAACA,SAAL,CAAe4B,aAAf,CAA6B,mBAAmB2C,IAAI,CAAC9E,EAAxB,GAA6B,IAA1D,CAHK;CAIhB8B,UAAAA,aAAa,EAAE,KAAI,CAACA,aAAL,CAAmBK,aAAnB,CAAiC,mBAAmB2C,IAAI,CAAC9E,EAAxB,GAA6B,IAA9D;CAJC,SAAjB,CADD;CAQA,OATD;CAUA;CACD;;;;kCAEYA,IACb;CACC,aAAO,KAAK2E,KAAL,CAAWK,IAAX,CAAgB,UAAAF,IAAI;CAAA,eAAIA,IAAI,CAAC9E,EAAL,KAAYA,EAAhB;CAAA,OAApB,KAA2C,IAAlD;CACA;;;gCAEU8E,MACX;CACC,WAAKH,KAAL,CAAWE,OAAX,CAAmB,UAAAI,OAAO;CAAA,eAAIA,OAAO,CAACC,SAAR,CAAkBD,OAAO,KAAKH,IAA9B,CAAJ;CAAA,OAA1B;CACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;KClCmBK;;;;;CAEpB,8BAAYnF,EAAZ,EAAgBC,QAAhB,EACA;CAAA;;CAAA;CACC;;CACA,UAAKmF,UAAL,CAAgBpF,EAAhB,EAAoBC,QAApB;;CAEA,UAAKoF,YAAL,GAAoB,IAApB;CACA,UAAKC,YAAL,GAAoB,IAApB;CALD;CAMC;;;;yCAGD;CACC,aAAO,KAAKD,YAAZ;CACA;;;8BAGD;CAAA,UADOE,OACP,uEADiB,EACjB;;CACC,UAAI,KAAKC,UAAT,EACA;CACC;CACA;;CAED,WAAKC,oBAAL,CAA0B;CAACC,QAAAA,UAAU,EAAE,CAAC,0DAAD;CAAb,OAA1B;CACA,WAAKC,aAAL;;CAEA,UAAI,KAAKC,eAAL,EAAJ,EACA;CACC,aAAKC,QAAL,CAAcC,WAAd,CAA0B,KAAKC,eAAL,CAAqB,KAAKC,QAAL,EAArB,CAA1B;;CAEA,YAAI,KAAKC,KAAL,KAAejF,EAAE,CAACkF,EAAH,CAAMC,gBAAN,CAAuBC,IAA1C,EACA;CACC,eAAKC,YAAL;CACA,SAHD,MAKA;CACC,eAAKC,YAAL;CACA;;CAED,YAAI,KAAKC,oBAAL,EAAJ,EACA;CACC,eAAKV,QAAL,CAAcC,WAAd,CAA0B,KAAKU,uBAAL,EAA1B;CACA;CACD;;CAED,WAAKC,cAAL,CAAoBlB,OAApB;CACA,WAAKC,UAAL,GAAkB,IAAlB;CACA;;;oCAGD;CACC,WAAKkB,YAAL,GAAoBC,aAAG,CAACC,MAAxB,oBAA4D,KAAKC,OAAL,EAA5D;;CACA,WAAKhB,QAAL,CAAcC,WAAd,CAA0B,KAAKY,YAA/B;;CAEA,WAAKrB,YAAL,GAAoBsB,aAAG,CAACC,MAAxB;;CACA,WAAKf,QAAL,CAAcC,WAAd,CAA0B,KAAKT,YAA/B;;CAEApE,MAAAA,cAAI,CAAC6F,kBAAL,CACC,+CADD,EAEC,UAFD,EAGC;CACCC,QAAAA,IAAI,EAAE,MADP;CAEC1F,QAAAA,IAAI,EAAE;CACL2F,UAAAA,QAAQ,EAAE,KAAKC,WAAL,EADL;CAELC,UAAAA,SAAS,EAAE,KAAKC,YAAL,EAFN;CAGLC,UAAAA,kBAAkB,EAAE,KAAKC,QAAL;CAHf;CAFP,OAHD,EAYEC,IAZF,CAYO,KAAKC,kBAAL,CAAwB/F,IAAxB,CAA6B,IAA7B,CAZP,EAaEgG,KAbF,CAaQ,UAAAC,QAAQ,EAAI;CAClB,cAAM,IAAIC,KAAJ,CAAUD,QAAQ,CAACE,MAAT,CAAgBC,IAAhB,CAAqB,IAArB,CAAV,CAAN;CACA,OAfF;CAiBA;;;wCAEkBH,UACnB;CACC,UAAI,CAAC,KAAK5B,QAAV,EACA;CACC;CACA;;CAEDgC,MAAAA,iBAAO,CAACC,IAAR,CAAa,KAAKzC,YAAlB,EAAgCoC,QAAQ,CAACpG,IAAT,CAAcyG,IAA9C,EAAoD;CACnDC,QAAAA,QAAQ,EAAE,KAAKC,gBAAL,CAAsBxG,IAAtB,CAA2B,IAA3B;CADyC,OAApD;CAGA;;;wCAGD;CACC,UAAIR,EAAE,CAACkF,EAAH,IAASlF,EAAE,CAACkF,EAAH,CAAM+B,YAAnB,EACA;CACC,aAAK3C,YAAL,GAAoBtE,EAAE,CAACkF,EAAH,CAAM+B,YAAN,CAAmBC,OAAnB,CAA2B,KAAKC,iBAAL,EAA3B,CAApB;;CAEA,YAAI,CAAC,KAAK7C,YAAV,EACA;CACC,gBAAM,IAAIoC,KAAJ,CAAU,oBAAoB,KAAKS,iBAAL,EAApB,GAA+C,cAAzD,CAAN;CACA;;CACD,YAAI,KAAK7C,YAAT,EACA;CACC,eAAK8C,aAAL,CAAmB,KAAK9C,YAAL,CAAkB+C,SAArC,EAAgD,KAAhD;CACA;;CAEDpE,QAAAA,6BAAY,CAACqE,SAAb,CAAuB,KAAKhD,YAA5B,EAA0C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBC,iBAAnE,EAAsF,KAAKC,8BAAL,CAAoCjH,IAApC,CAAyC,IAAzC,CAAtF;CACAyC,QAAAA,6BAAY,CAACqE,SAAb,CAAuB,KAAKhD,YAA5B,EAA0C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBG,KAAnE,EAA0E,KAAKC,aAAL,CAAmBnH,IAAnB,CAAwB,IAAxB,CAA1E;CACAyC,QAAAA,6BAAY,CAACqE,SAAb,CAAuB,KAAKhD,YAA5B,EAA0C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBF,SAAnE,EAA8E,KAAKO,WAAL,CAAiBpH,IAAjB,CAAsB,IAAtB,CAA9E;CACAyC,QAAAA,6BAAY,CAACqE,SAAb,CAAuB,KAAKhD,YAA5B,EAA0C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBM,YAAnE,EAAiF,KAAKC,cAAL,CAAoBtH,IAApB,CAAyB,IAAzB,CAAjF;CACAyC,QAAAA,6BAAY,CAACqE,SAAb,CAAuB,KAAKhD,YAA5B,EAA0C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBQ,OAAnE,EAA4E,KAAKC,aAAL,CAAmBxH,IAAnB,CAAwB,IAAxB,CAA5E;CACAyC,QAAAA,6BAAY,CAACqE,SAAb,CAAuB,KAAKhD,YAA5B,EAA0C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBU,UAAnE,EAA+E,KAAKD,aAAL,CAAmBxH,IAAnB,CAAwB,IAAxB,CAA/E;CACAyC,QAAAA,6BAAY,CAACqE,SAAb,CAAuB,KAAKhD,YAA5B,EAA0C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBW,MAAnE,EAA2E,KAAKC,UAAL,CAAgB3H,IAAhB,CAAqB,IAArB,CAA3E;CACAyC,QAAAA,6BAAY,CAACqE,SAAb,CAAuB,KAAKhD,YAA5B,EAA0C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBa,YAAnE,EAAiF,KAAKC,cAAL,CAAoB7H,IAApB,CAAyB,IAAzB,CAAjF;CACAU,QAAAA,eAAK,CAACV,IAAN,CAAW,KAAK8D,YAAL,CAAkBoD,KAA7B,EAAoC,MAApC,EAA4C,KAAKY,MAAL,CAAY9H,IAAZ,CAAiB,IAAjB,CAA5C;;CACA,YAAI,KAAK8D,YAAL,CAAkB+C,SAAtB,EACA;CACC,eAAK/C,YAAL,CAAkB+C,SAAlB,CAA4BzF,KAA5B,CAAkCG,GAAlC,GAAwC,MAAxC;CACA,eAAKuC,YAAL,CAAkB+C,SAAlB,CAA4BzF,KAA5B,CAAkC2G,MAAlC,GAA2C,CAA3C;CACA;CACD;CACD;;;mCAEaC,MAAMC,QACpB;CACC,UAAI,CAACD,IAAL,EACA;CACC;CACA;;CAEDA,MAAAA,IAAI,CAAC5G,KAAL,CAAWC,OAAX,GAAqB4G,MAAM,GAAG,EAAH,GAAQ,MAAnC;CACA;;;mCAEapF,OACd;CACC;CACAJ,MAAAA,6BAAY,CAACC,IAAb,CAAkB,KAAKwF,SAAL,EAAlB,EAAoC,6BAApC,GAAoE,IAApE,wCAA6ErF,KAAK,CAACsF,OAAN,EAA7E;CACA;;;8BAGD;CAAA;;CACCxF,MAAAA,MAAM,CAACyF,UAAP,CAAkB,YAAM;CACvB,QAAA,MAAI,CAACtE,YAAL,CAAkB6D,UAAlB;CACA,OAFD,EAEG,GAFH;CAGA;;;oCAEc9E,OACf;CAAA,2BACmBA,KAAK,CAACsF,OAAN,EADnB;CAAA;CAAA,UACQE,OADR;;CAEC,UAAMC,KAAK,GAAG9I,EAAE,CAAC+I,kBAAH,CAAsBC,YAAtB,CAAmCH,OAAO,CAAC7J,EAA3C,CAAd;;CACA,UAAI8J,KAAJ,EACA;CACCA,QAAAA,KAAK,CAACG,OAAN;CACA;;CACD,UAAIJ,OAAO,CAACK,iBAAZ,EACA;CACCL,QAAAA,OAAO,CAACK,iBAAR,CAA0BC,UAA1B,CAAqCC,WAArC,CAAiDP,OAAO,CAACK,iBAAzD;CACA;CACD;;;kCAGD;CACC,WAAK9B,aAAL,CAAmB,KAAK9C,YAAL,CAAkB+C,SAArC,EAAgD,KAAhD;CACA;;;yCAGD;CACC,UAAMrB,QAAQ,GAAG,KAAKC,WAAL,MAAsB,CAAvC;CACA,UAAMC,SAAS,GAAG,KAAKC,YAAL,MAAuB,CAAzC;CAEA,kDAAqCH,QAArC,cAAiDE,SAAjD;CACA;;;sCAGD;CACC,UAAI,KAAK5B,YAAT,EACA;CACC,aAAKA,YAAL,CAAkB+E,YAAlB;CACA;CACD;;;mCAGD;CACC,UAAI,CAACrJ,EAAE,CAACsJ,IAAH,CAAQC,gBAAR,CAAyB,KAAKjF,YAAL,CAAkBoD,KAAlB,CAAwB8B,KAAjD,CAAL,EACA;CACC;CACA;;CACDvJ,MAAAA,cAAI,CAAC6F,kBAAL,CACC,+CADD,EAEC,YAFD,EAGC;CACCC,QAAAA,IAAI,EAAE,MADP;CAEC1F,QAAAA,IAAI,EAAE;CACL2F,UAAAA,QAAQ,EAAE,KAAKC,WAAL,EADL;CAELwD,UAAAA,IAAI,EAAE,KAAKnF,YAAL,CAAkBoD,KAAlB,CAAwB8B;CAFzB;CAFP,OAHD,EAWElD,IAXF,CAWO,KAAKoD,YAAL,CAAkBlJ,IAAlB,CAAuB,IAAvB,CAXP,EAYEgG,KAZF,CAYQ,UAAAC,QAAQ,EAAI;CAClB,cAAM,IAAIC,KAAJ,CAAUD,QAAQ,CAACE,MAAT,CAAgBC,IAAhB,CAAqB,IAArB,CAAV,CAAN;CACA,OAdF;CAgBA;;;kCAEYH,UACb;CACC,UAAM3C,IAAI,GAAG,KAAKQ,YAAL,CAAkBqF,QAAlB,CAA2BC,OAA3B,CAAmC,KAAnC,EAA0CnD,QAAQ,CAACpG,IAAT,CAAcrB,EAAxD,EAA4DyH,QAAQ,CAACpG,IAAT,CAAcoJ,IAA1E,CAAb;CACA,WAAKnF,YAAL,CAAkBqF,QAAlB,CAA2BE,WAA3B,CAAuC/F,IAAvC;;CACA,UAAI,KAAKQ,YAAL,CAAkBqF,QAAlB,CAA2Bb,KAA/B,EACA;CACC,aAAKxE,YAAL,CAAkBqF,QAAlB,CAA2Bb,KAA3B,CAAiCG,OAAjC;CACA,aAAK3E,YAAL,CAAkBqF,QAAlB,CAA2Bb,KAA3B,GAAmC,IAAnC;CACA;;CACD,WAAK1B,aAAL,CAAmBtD,IAAI,CAAC0E,IAAxB,EAA8B,KAA9B;CACA,WAAKlE,YAAL,CAAkB6D,UAAlB;CACA,WAAKA,UAAL;CACA;;;qCAGD;CACC,UAAMsB,IAAI,GAAG,KAAKnF,YAAL,CAAkBoD,KAAlB,CAAwB8B,KAArC;CACA,UAAIM,MAAM,GAAG,IAAIC,MAAJ,CAAW/J,EAAE,CAACgK,IAAH,CAAQC,YAAR,CAAqBR,IAArB,CAAX,EAAuC,GAAvC,CAAb;;CACA,UAAI,CAAC,KAAKnF,YAAL,CAAkBqF,QAAvB,EACA;CACC;CACA;;CACD,UAAMO,QAAQ,GAAG,KAAK5F,YAAL,CAAkBqF,QAAlB,CAA2BhG,KAA3B,CAAiCwG,MAAjC,CAAwC,UAACrG,IAAD;CAAA,eAAUgG,MAAM,CAACM,IAAP,CAAYtG,IAAI,CAAC2F,IAAjB,CAAV;CAAA,OAAxC,CAAjB;;CACA,UAAIS,QAAQ,CAACG,MAAT,KAAoB,CAAxB,EACA;CACC,aAAKjD,aAAL,CAAmB,KAAK9C,YAAL,CAAkB+C,SAArC,EAAgD,IAAhD;CACA,aAAK/C,YAAL,CAAkBqF,QAAlB,CAA2BW,IAA3B;CACA,OAJD,MAMA;CACC,aAAKlD,aAAL,CAAmB,KAAK9C,YAAL,CAAkB+C,SAArC,EAAgD,KAAhD;CACA,aAAK/C,YAAL,CAAkBqF,QAAlB,CAA2BY,IAA3B;CACA;CACD;;;sDAGD;CAAA;;CACCtK,MAAAA,cAAI,CAAC6F,kBAAL,CACC,+CADD,EAEC,aAFD,EAGC;CACCC,QAAAA,IAAI,EAAE,MADP;CAEC1F,QAAAA,IAAI,EAAE;CACL2F,UAAAA,QAAQ,EAAE,KAAKC,WAAL;CADL;CAFP,OAHD,EAUEK,IAVF,CAUO,UAAAG,QAAQ,EAAI;CACjB,QAAA,MAAI,CAACnC,YAAL,CAAkBkG,eAAlB,CAAkC/D,QAAQ,CAACpG,IAAT,IAAiB,EAAnD;CACA,OAZF,EAaEmG,KAbF,CAaQ,KAAKlC,YAAL,CAAkBmG,YAAlB,CAA+BjK,IAA/B,CAAoC,KAAK8D,YAAzC,CAbR;CAeA;;;oCAGD;CACC,UAAI,KAAKoG,aAAL,EAAJ,EACA;CACC,aAAKrG,YAAL,GAAoBsB,aAAG,CAACC,MAAxB,qBAEI+E,aAAG,CAACC,UAAJ,CAAe,mCAAf,CAFJ;CAKAnJ,QAAAA,aAAG,CAACC,QAAJ,CAAa,KAAKmD,QAAlB,EAA4B,4CAA5B;CACA,OARD,MAUA;CACC,YAAMgG,OAAO,GAAG,EAAhB;CACAC,QAAAA,MAAM,CAACC,OAAP,CAAe,KAAKC,WAAL,EAAf,EAAmCnH,OAAnC,CAA2C,gBAAgB;CAAA;CAAA,cAAd7E,EAAc;CAAA,cAAVyK,IAAU;;CAC1D;CACAoB,UAAAA,OAAO,CAAC9G,IAAR,CAAa4B,aAAG,CAACC,MAAjB,qBAEqCxG,cAAI,CAAC6L,MAAL,CAAYxB,IAAZ,CAFrC;CAKA,SAPD;CAQA,aAAKpF,YAAL,GAAoBsB,aAAG,CAACC,MAAxB,qBAGKiF,OAHL;CAOA;;CAED,WAAKhG,QAAL,CAAcC,WAAd,CAA0B,KAAKT,YAA/B;CACA;;;mCAGD;CACC,aAAO,KAAK6G,MAAL,CAAYC,QAAZ,CAAqB,qBAArB,EAA4C,EAA5C,CAAP;CACA;;;mCAGD;CACC,aAAO,KAAKD,MAAL,CAAYC,QAAZ,CAAqB,WAArB,EAAkC,CAAlC,CAAP;CACA;;;oCAGD;CACC,aAAO,KAAKD,MAAL,CAAYC,QAAZ,CAAqB,IAArB,EAA2B,CAA3B,CAAP;CACA;;;qCAGD;CACC,UAAMC,UAAU,GAAG,KAAK/E,QAAL,EAAnB;CAEA,aAAO+E,UAAU,CAACf,MAAX,KAAsB,CAAtB,IAELe,UAAU,CAACf,MAAX,KAAsB,CAAtB,KACIe,UAAU,CAACC,QAAX,CAAoB,GAApB,KAA4BD,UAAU,CAACC,QAAX,CAAoB,CAApB,CADhC,CAFF;CAKA;;;mCAEa9G,SACd;CACC,UAAI,KAAKD,YAAT,EACA;CACCrB,QAAAA,6BAAY,CAACqI,cAAb,CAA4B,KAAKhH,YAAjC,EAA+C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBM,YAAxE;CACA5E,QAAAA,6BAAY,CAACqI,cAAb,CAA4B,KAAKhH,YAAjC,EAA+C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBC,iBAAxE;CACAvE,QAAAA,6BAAY,CAACqI,cAAb,CAA4B,KAAKhH,YAAjC,EAA+C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBQ,OAAxE;CACA9E,QAAAA,6BAAY,CAACqI,cAAb,CAA4B,KAAKhH,YAAjC,EAA+C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBU,UAAxE;CACAhF,QAAAA,6BAAY,CAACqI,cAAb,CAA4B,KAAKhH,YAAjC,EAA+C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBa,YAAxE;CACAnF,QAAAA,6BAAY,CAACqI,cAAb,CAA4B,KAAKhH,YAAjC,EAA+C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBW,MAAxE;CACAjF,QAAAA,6BAAY,CAACqI,cAAb,CAA4B,KAAKhH,YAAjC,EAA+C,KAAKA,YAAL,CAAkBiD,MAAlB,CAAyBF,SAAxE;CACA;;CAED,UAAI,KAAK3B,YAAT,EACA;CACCjE,QAAAA,aAAG,CAAC8J,KAAJ,CAAU,KAAK7F,YAAf;CACA,aAAKA,YAAL,GAAoB,IAApB;CACA;;CAED,UAAI,KAAKrB,YAAT,EACA;CACC5C,QAAAA,aAAG,CAAC8J,KAAJ,CAAU,KAAKlH,YAAf;CACA,aAAKA,YAAL,GAAoB,IAApB;CACA;;CAED,WAAKG,UAAL,GAAkB,KAAlB;CACA;;;uCAEiBuB,MAClB;CACC,UAAIyF,MAAM,GAAGxL,EAAE,CAACkF,EAAH,CAAMuG,0BAAN,CAAiCC,MAA9C;;CAEA,UAAI3F,IAAI,KAAK/F,EAAE,CAACkF,EAAH,CAAMC,gBAAN,CAAuBC,IAApC,EACA;CACCoG,QAAAA,MAAM,IAAIxL,EAAE,CAACkF,EAAH,CAAMuG,0BAAN,CAAiCE,MAAjC,GAA0C3L,EAAE,CAACkF,EAAH,CAAMuG,0BAAN,CAAiCZ,OAArF;CACA;;CAED,aAAOW,MAAP;CACA;;;GAlW8CxL,EAAE,CAACkF,EAAH,CAAM0G;;KCDjCC;;;CAEpB,2BACA;CAAA;;CAAA;CACC5I,IAAAA,6BAAY,CAACqE,SAAb,CAAuB,+CAAvB,EAAwE,UAACjE,KAAD,EAAsB;CAAA,iCACvEA,KAAK,CAACyI,aAAN,EADuE;CAAA;CAAA,UACpFC,SADoF;;CAE7FA,MAAAA,SAAS,CAACC,OAAV,CAAkB,YAAlB,IAAkC,KAAI,CAACC,OAAL,CAAazL,IAAb,CAAkB,KAAlB,CAAlC;CACA,KAHD;CAIA;;;;6BAEO8I,MAAM4C,WAAWjN,UACzB;CACC,UAAIqK,IAAI,KAAK,gBAAb,EACA;CACC,eAAO,IAAInF,kBAAJ,CAAuB+H,SAAvB,EAAkCjN,QAAlC,CAAP;CACA;;CAED,aAAO,IAAP;CACA;;;;;CClBF,IAAMkN,eAAe,GAAG,WAAxB;CACA,IAAMC,mBAAmB,GAAG,YAA5B;;KAEqBC;;;;;CAEpB,mCAAYrN,EAAZ,EAAgBC,QAAhB,EACA;CAAA;;CAAA;CACC;;CACA,UAAKmF,UAAL,CAAgBpF,EAAhB,EAAoBC,QAApB;;CAEA,UAAKqN,YAAL,GAAoB,KAApB;;CACA,UAAKC,kBAAL;;CAEAtJ,IAAAA,6BAAY,CAACqE,SAAb,CAAuB,MAAKkF,OAA5B,EAAqC,6BAArC,EAAoE,MAAKC,eAAL,CAAqBjM,IAArB,2CAApE;CACAyC,IAAAA,6BAAY,CAACqE,SAAb,CAAuB,MAAKkF,OAA5B,EAAqC,kCAArC,EAAyE,MAAKE,UAAL,CAAgBlM,IAAhB,2CAAzE;CACAyC,IAAAA,6BAAY,CAACqE,SAAb,CAAuB,MAAKkF,OAA5B,EAAqC,kCAArC,EAAyE,MAAKG,aAAL,CAAmBnM,IAAnB,2CAAzE;CATD;CAUC;;;;0CAGD;CACC,WAAKoM,YAAL,GAAoB,IAApB;CACA,WAAKC,eAAL,GAAuB,IAAvB;CACA,WAAKC,eAAL,GAAuB,EAAvB;CACA,WAAKC,uBAAL,GAA+B,EAA/B;CACA;;;qCAEe1J,OAChB;CAAA;;CAAA,2BACiBA,KAAK,CAACsF,OAAN,EADjB;CAAA;CAAA,UACQqE,KADR;;CAEC,UAAMC,OAAO,GAAGD,KAAK,CAAC1I,YAAN,CAAmB4I,IAAnB,CAAwBC,GAAxB,CAA4B,UAAAC,IAAI;CAAA,eAAIA,IAAI,CAACpO,EAAT;CAAA,OAAhC,CAAhB;CACA,UAAMqO,WAAW,GAAGC,IAAI,CAACC,SAAL,CAAeN,OAAf,CAApB;;CAEA,UAAI,KAAKL,YAAL,KAAsB,IAAtB,IAA8B,KAAKA,YAAL,KAAsBS,WAAxD,EACA;CACC,aAAKT,YAAL,GAAoBS,WAApB;CAEAG,QAAAA,YAAY,CAAC,KAAKC,OAAN,CAAZ;CACA,aAAKA,OAAL,GAAe7E,UAAU,CAAC,YAAM;CAC/B,UAAA,MAAI,CAAC8E,uBAAL,CAA6BT,OAA7B;CACA,SAFwB,EAEtB,EAFsB,CAAzB;CAGA;CACD;;;gCAEU5J,OACX;CAAA;;CAAA,iCAC8BA,KAAK,CAACyI,aAAN,EAD9B;CAAA;CAAA,UACQ6B,OADR;CAAA,UACiB5B,SADjB;;CAEC,UAAM6B,MAAM,GAAG,KAAKC,aAAL,CAAmB9B,SAAnB,CAAf;CACA9L,MAAAA,cAAI,CAAC6F,kBAAL,CACC,KAAK0G,OAAL,CAAasB,SAAb,CAAuBC,QAAvB,CAAgCC,cADjC,EAEC,aAFD,EAGC;CACCjI,QAAAA,IAAI,EAAE,OADP;CAECkI,QAAAA,gBAAgB,EAAE,KAAKzB,OAAL,CAAasB,SAAb,CAAuBC,QAAvB,CAAgCG,iBAFnD;CAGC7N,QAAAA,IAAI,EAAEuN;CAHP,OAHD,EASEtH,IATF,CASO,UAAAG,QAAQ,EAAI;CACjB,YAAM0H,eAAe,GAAG,MAAI,CAAC3B,OAAL,CAAa4B,sBAAb,CAAoChC,mBAApC,CAAxB;;CACA,YAAMiC,QAAQ,GAAG5H,QAAQ,CAACpG,IAAT,CAAciO,eAA/B;;CAEA,YAAI,CAACH,eAAD,IAAoB,CAACE,QAAzB,EACA;CACC;CACA;;CAED,YAAME,gBAAgB,GAAG9H,QAAQ,CAACpG,IAAT,CAAcmO,iBAAvC;;CACA,YAAID,gBAAJ,EACA;CACC,cAAME,KAAK,GAAG,MAAI,CAACjC,OAAL,CAAatB,MAA3B;;CACA,6CAAyBJ,MAAM,CAACC,OAAP,CAAewD,gBAAf,CAAzB,qCACA;CAAA;CAAA,gBADUG,GACV;CAAA,gBADelF,KACf;;CACCiF,YAAAA,KAAK,CAACE,QAAN,CAAeD,GAAf,EAAoBlF,KAApB;CACA;CACD;;CACD,YAAIzD,IAAI,GAAG/F,EAAE,CAACkF,EAAH,CAAMC,gBAAN,CAAuByJ,IAAlC;;CACA,YAAIjB,OAAO,YAAY3N,EAAE,CAACkF,EAAH,CAAM2J,mBAA7B,EACA;CACC9I,UAAAA,IAAI,GAAG4H,OAAO,CAACmB,OAAR,EAAP;CACA;;CAED,YAAMC,OAAO,GAAG,MAAI,CAACC,cAAL,CAAoBX,QAApB,EAA8B;CAC7CY,UAAAA,MAAM,EAAE;CACPC,YAAAA,oBAAoB,EAAE,IADf;CAEPC,YAAAA,YAAY,EAAEpD,SAAS,CAACqD;CAFjB,WADqC;CAK7CrJ,UAAAA,IAAI,EAAEA;CALuC,SAA9B,CAAhB;;CAQAgJ,QAAAA,OAAO,CAACM,gBAAR,CAAyBtD,SAAS,CAACqD,UAAnC;;CAEA,QAAA,MAAI,CAAC5C,OAAL,CAAa8C,iBAAb;;CAEA,QAAA,MAAI,CAAChD,YAAL,GAAoB,KAApB;CACA,OA9CF,EA+CE9F,KA/CF,CA+CQ,UAAAC,QAAQ,EAAI;CAClB,QAAA,MAAI,CAAC6F,YAAL,GAAoB,KAApB;CACA,OAjDF;CAmDA;;;mCAEajJ,OACd;CAAA;;CAAA,kCAC8BA,KAAK,CAACyI,aAAN,EAD9B;CAAA;CAAA,UACQ6B,OADR;CAAA,UACiB5B,SADjB;;CAEC,UAAI,EAAEA,SAAS,CAACiB,KAAV,YAA2BhN,EAAE,CAACkF,EAAH,CAAMqK,mBAAnC,CAAJ,EACA;CACC;CACA;;CAED,UAAMC,YAAY,GAAGzD,SAAS,CAACiB,KAA/B;CACAjB,MAAAA,SAAS,CAAC0D,IAAV,GAAiBD,YAAY,CAACE,KAAb,EAAjB;CAEA,UAAM9B,MAAM,GAAG,KAAKC,aAAL,CAAmB9B,SAAnB,CAAf;CACA,UAAM4D,aAAa,GAAGH,YAAY,CAACI,gBAAb,EAAtB;CACAD,MAAAA,aAAa,CAACE,WAAd,GAA4B9D,SAAS,CAAC+D,SAAtC;CAEA7P,MAAAA,cAAI,CAAC6F,kBAAL,CACC,KAAK0G,OAAL,CAAasB,SAAb,CAAuBC,QAAvB,CAAgCC,cADjC,EAEC,gBAFD,EAGC;CACCjI,QAAAA,IAAI,EAAE,OADP;CAECkI,QAAAA,gBAAgB,EAAE,KAAKzB,OAAL,CAAasB,SAAb,CAAuBC,QAAvB,CAAgCG,iBAFnD;CAGC7N,QAAAA,IAAI,EAAEuN;CAHP,OAHD,EAQEtH,IARF,CAQO,UAAAG,QAAQ,EAAI;CAClB,YAAI+I,YAAY,YAAYxP,EAAE,CAACkF,EAAH,CAAM6K,oBAA9B,IAAsDP,YAAY,YAAYxP,EAAE,CAACkF,EAAH,CAAM8K,yBAAxF,EACA;CACC,cAAM3P,IAAI,GAAGmP,YAAY,CAACI,gBAAb,GAAgCjH,OAAhC,EAAb;CACAtI,UAAAA,IAAI,CAAC4P,UAAL,GAAkBlE,SAAS,CAACkE,UAA5B;CACA;;CACD,YAAIC,OAAO,GAAG,IAAd;CACA,YAAIP,aAAa,GAAG,IAApB;;CACA,YAAI5D,SAAS,CAACoE,QAAV,KAAuB,IAA3B,EACA;CACC,cAAIX,YAAY,YAAYxP,EAAE,CAACkF,EAAH,CAAMkL,gBAAlC,EACA;CACCF,YAAAA,OAAO,GAAG,WAAV;CACA,WAHD,MAIK,IAAIV,YAAY,YAAYxP,EAAE,CAACkF,EAAH,CAAMmL,gBAAlC,EACL;CACCH,YAAAA,OAAO,GAAG,WAAV;CACA,WAHI,MAIA,IAAIV,YAAY,YAAYxP,EAAE,CAACkF,EAAH,CAAM6K,oBAAlC,EACL;CACCG,YAAAA,OAAO,GAAG,eAAV;CACA,WAHI,MAIA,IAAIV,YAAY,YAAYxP,EAAE,CAACkF,EAAH,CAAMoL,kBAAlC,EACL;CACCJ,YAAAA,OAAO,GAAG,aAAV;CACA;CACD,SAlBD,MAoBA;CACC,cAAIV,YAAY,YAAYxP,EAAE,CAACkF,EAAH,CAAMqL,qBAAlC,EACA;CACCL,YAAAA,OAAO,GAAG,MAAV;CACA,WAHD,MAIK,IAAIV,YAAY,YAAYxP,EAAE,CAACkF,EAAH,CAAM8K,yBAAlC,EACL;CACCE,YAAAA,OAAO,GAAG,UAAV;CACA,WAHI,MAIA,IAAIV,YAAY,YAAYxP,EAAE,CAACkF,EAAH,CAAMsL,uBAAlC,EACL;CACCN,YAAAA,OAAO,GAAG,QAAV;CACA,WAHI,MAIA,IAAIV,YAAY,YAAYxP,EAAE,CAACkF,EAAH,CAAMuL,qBAAlC,EACL;CACCP,YAAAA,OAAO,GAAG,MAAV;CACA;;CAEDP,UAAAA,aAAa,GAAGH,YAAY,CAACI,gBAAb,EAAhB;CACA;;CAED,YAAMvB,QAAQ,GAAG5H,QAAQ,CAACpG,IAAT,CAAciO,eAA/B;;CACA,YACC,CAAEkB,YAAY,YAAYxP,EAAE,CAACkF,EAAH,CAAMmL,gBAA/B,IAAqDb,YAAY,YAAYxP,EAAE,CAACkF,EAAH,CAAMqL,qBAApF,KACGlC,QAFJ,EAIA;CACCsB,UAAAA,aAAa,GAAG3P,EAAE,CAACkF,EAAH,CAAMwL,mBAAN,CAA0BC,MAA1B,CAAiCtC,QAAjC,CAAhB;CACA6B,UAAAA,OAAO,GAAG7B,QAAQ,CAAC/E,IAAnB;CACA;;CACD,YAAI4G,OAAJ,EACA;CACC,cAAMU,KAAK,GAAGjD,OAAO,CAACkD,aAAR,CAAsBrB,YAAtB,CAAd;;CACA,cAAMsB,UAAU,GAAG,MAAI,CAACtE,OAAL,CAAauE,aAAb,CAClBb,OADkB,EAElBnE,SAAS,CAAC0D,IAFQ,EAGlB;CACCE,YAAAA,aAAa,EAAEA,aADhB;CAEClB,YAAAA,KAAK,EAAEd,OAAO,CAACzC,MAFhB;CAGC8F,YAAAA,MAAM,EAAErD,OAHT;CAIC5H,YAAAA,IAAI,EAAE4H,OAAO,CAACmB,OAAR;CAJP,WAHkB,CAAnB;;CAWAnB,UAAAA,OAAO,CAACsD,QAAR,CAAiBH,UAAjB,EAA6B;CAC5BF,YAAAA,KAAK,EAALA,KAD4B;CAE5B3B,YAAAA,MAAM,EAAE;CACPE,cAAAA,YAAY,EAAE;CADP,aAFoB;CAK5B+B,YAAAA,YAAY,EAAE;CALc,WAA7B;CAQAvD,UAAAA,OAAO,CAACvE,WAAR,CAAoBoG,YAApB,EAAkC;CACjC0B,YAAAA,YAAY,EAAE;CADmB,WAAlC;CAGA;;CAED,QAAA,MAAI,CAAC5E,YAAL,GAAoB,KAApB;CACA,OA9FD,EA+FE9F,KA/FF,CA+FQ,UAAAC,QAAQ,EAAI;CAClB,QAAA,MAAI,CAAC6F,YAAL,GAAoB,KAApB;CACA,OAjGF;CAkGA;;;mCAEasB,QACd;CAAA;;CACC,UAAMuD,IAAI,GAAG,IAAIC,QAAJ,EAAb;CACA,UAAMC,SAAS,GAAG;CACjBC,QAAAA,IAAI,EAAE1D,MAAM,CAAC2D,KADI;CAEjBC,QAAAA,QAAQ,EAAE5D,MAAM,CAACuC,QAAP,GAAkB,GAAlB,GAAwB,GAFjB;CAGjBsB,QAAAA,WAAW,EAAE7D,MAAM,CAACkC,SAAP,GAAmB,GAAnB,GAAyB,GAHrB;CAIjB4B,QAAAA,aAAa,EAAE,GAJE;CAKjBjC,QAAAA,IAAI,EAAE7B,MAAM,CAAC6B,IAAP,IAAe;CALJ,OAAlB;;CAQA,cAAQ7B,MAAM,CAAC+D,MAAf;CAEC,aAAK,SAAL;CACA,aAAK,QAAL;CACCN,UAAAA,SAAS,CAACK,aAAV,GAA0B,GAA1B;CACA;;CACD,aAAK,MAAL;CACA,aAAK,WAAL;CACCL,UAAAA,SAAS,CAACK,aAAV,GAA0B,GAA1B;CACA9D,UAAAA,MAAM,CAACgE,WAAP,CAAmB/N,OAAnB,CAA2B,UAACgO,QAAD,EAAWnD,GAAX,EAAmB;CAC7CyC,YAAAA,IAAI,CAACW,MAAL,CAAY,MAAI,CAACC,gBAAL,CAAsB,aAAarD,GAAb,GAAmB,QAAzC,CAAZ,EAAgEmD,QAAQ,CAACG,IAAzE;CACAb,YAAAA,IAAI,CAACW,MAAL,CAAY,MAAI,CAACC,gBAAL,CAAsB,aAAarD,GAAb,GAAmB,SAAzC,CAAZ,EAAiEmD,QAAQ,CAACI,KAA1E;CACAd,YAAAA,IAAI,CAACW,MAAL,CAAY,MAAI,CAACC,gBAAL,CAAsB,aAAarD,GAAb,GAAmB,MAAzC,CAAZ,EAA8DmD,QAAQ,CAACK,EAAvE;CACA,WAJD;CAKA;;CACD,aAAK,WAAL;CACCb,UAAAA,SAAS,CAACc,SAAV,GAAsB,WAAtB;CACAvE,UAAAA,MAAM,CAACgE,WAAP,CAAmB/N,OAAnB,CAA2B,UAACgO,QAAD,EAAWnD,GAAX,EAAmB;CAC7CyC,YAAAA,IAAI,CAACW,MAAL,CAAY,MAAI,CAACC,gBAAL,CAAsB,aAAarD,GAAb,GAAmB,QAAzC,CAAZ,EAAgEmD,QAAQ,CAACG,IAAzE;CACAb,YAAAA,IAAI,CAACW,MAAL,CAAY,MAAI,CAACC,gBAAL,CAAsB,aAAarD,GAAb,GAAmB,SAAzC,CAAZ,EAAiEmD,QAAQ,CAACI,KAAT,CAAezI,KAAhF;CACA2H,YAAAA,IAAI,CAACW,MAAL,CAAY,MAAI,CAACC,gBAAL,CAAsB,aAAarD,GAAb,GAAmB,UAAzC,CAAZ,EAAkEmD,QAAQ,CAACO,MAA3E;CACAjB,YAAAA,IAAI,CAACW,MAAL,CAAY,MAAI,CAACC,gBAAL,CAAsB,aAAarD,GAAb,GAAmB,WAAzC,CAAZ,EAAmEmD,QAAQ,CAACQ,OAA5E;CACAlB,YAAAA,IAAI,CAACW,MAAL,CAAY,WAAWD,QAAQ,CAACG,IAApB,GAA2B,GAAvC,EAA4CH,QAAQ,CAACI,KAAT,CAAeK,IAA3D;CACA,WAND;CAOA;;CACD,aAAK,SAAL;CACCjB,UAAAA,SAAS,CAACK,aAAV,GAA0B,GAA1B;CACAP,UAAAA,IAAI,CAACW,MAAL,CAAY,KAAKC,gBAAL,CAAsB,kBAAtB,CAAZ,EAAuD,GAAvD;CACAV,UAAAA,SAAS,CAACkB,SAAV,GAAsB,GAAtB;CACA;;CACD,aAAK,OAAL;CACClB,UAAAA,SAAS,CAACc,SAAV,GAAsB,OAAtB;CACA;;CACD,aAAK,SAAL;CACCd,UAAAA,SAAS,CAACc,SAAV,GAAsB,YAAtB;CACA;;CACD,aAAK,UAAL;CACA,aAAK,eAAL;CACCd,UAAAA,SAAS,CAACc,SAAV,GAAuBvE,MAAM,CAACqC,UAAP,KAAsB,IAAvB,GAA+B,UAA/B,GAA4C,MAAlE;CACA;;CACD,aAAK,MAAL;CACCoB,UAAAA,SAAS,CAACc,SAAV,GAAsB,UAAtB;CACA;CA1CF;;CA6CA,2CAAwBrH,MAAM,CAACC,OAAP,CAAesG,SAAf,CAAxB,wCACA;CAAA;CAAA,YADU3C,GACV;CAAA,YADe5K,IACf;;CACCqN,QAAAA,IAAI,CAACW,MAAL,CAAY,KAAKC,gBAAL,CAAsBrD,GAAtB,CAAZ,EAAwC5K,IAAxC;CACA;;CACD,aAAOqN,IAAP;CACA;;;sCAEgB1H,MACjB;CACC,aAAO,YAAYA,IAAZ,GAAmB,GAA1B;CACA;;;6CAEuB2B,YACxB;CAAA;;CACC,UAAI,KAAKkB,YAAT,EACA;CACC;CACA;;CAED,WAAKA,YAAL,GAAoB,IAApB;CAEArM,MAAAA,cAAI,CAAC6F,kBAAL,CACC,KAAK0G,OAAL,CAAasB,SAAb,CAAuBC,QAAvB,CAAgCC,cADjC,EAEC,yBAFD,EAGC;CACCjI,QAAAA,IAAI,EAAE,OADP;CAECkI,QAAAA,gBAAgB,EAAE,KAAKzB,OAAL,CAAasB,SAAb,CAAuBC,QAAvB,CAAgCG,iBAFnD;CAGC7N,QAAAA,IAAI,EAAE;CAAC+K,UAAAA,UAAU,EAAVA;CAAD;CAHP,OAHD,EASE9E,IATF,CASO,UAAAG,QAAQ,EAAI;CACjB,YAAM+L,oBAAoB,GAAG,MAAI,CAACC,uBAAL,EAA7B;;CAEA,YAAI,MAAI,CAAC5F,eAAL,KAAyB,IAA7B,EACA;CACC,UAAA,MAAI,CAACA,eAAL,kCAA2B2F,oBAA3B;CACA;;CAED/L,QAAAA,QAAQ,CAACpG,IAAT,CAAcqS,aAAd,CAA4B7O,OAA5B,CAAoC,UAAAwK,QAAQ,EAAI;CAC/C,cAAI,CAACmE,oBAAoB,CAACnH,QAArB,CAA8BgD,QAAQ,CAAC5E,IAAvC,CAAL,EACA;CACC,YAAA,MAAI,CAACkJ,WAAL,CAAiBtE,QAAjB,EAA2B;CAC1BY,cAAAA,MAAM,EAAE;CACPE,gBAAAA,YAAY,EAAE;CADP,eADkB;CAI1BpJ,cAAAA,IAAI,EAAE/F,EAAE,CAACkF,EAAH,CAAMC,gBAAN,CAAuBC;CAJH,aAA3B;CAMA;CACD,SAVD;CAYA,YAAMwN,aAAa,GAAGnM,QAAQ,CAACpG,IAAT,CAAcqS,aAAd,CAA4BvF,GAA5B,CAAgC,UAAA0F,EAAE;CAAA,iBAAIA,EAAE,CAACpJ,IAAP;CAAA,SAAlC,CAAtB;CACA+I,QAAAA,oBAAoB,CAAC3O,OAArB,CAA6B,UAAA4F,IAAI,EAAI;CACpC,cAAI,CAACmJ,aAAa,CAACvH,QAAd,CAAuB5B,IAAvB,CAAL,EACA;CACC,YAAA,MAAI,CAACqJ,cAAL,CAAoBrJ,IAApB;CACA;CACD,SALD;;CAOA,QAAA,MAAI,CAAC+C,OAAL,CAAauG,mBAAb;;CACA,QAAA,MAAI,CAACzG,YAAL,GAAoB,KAApB;CACA,OAvCF,EAwCE9F,KAxCF,CAwCQ,UAAAC,QAAQ,EAAI;CAClB,QAAA,MAAI,CAAC6F,YAAL,GAAoB,KAApB;CACA,OA1CF;CA4CA;;;+CAGD;CACC,UAAM0G,gBAAgB,GAAG,KAAKxG,OAAL,CAAayG,cAAb,GACvB9I,MADuB,CAChB,UAAA0I,EAAE;CAAA,eAAIA,EAAE,CAAChN,OAAH,GAAaqN,OAAb,CAAqB/G,eAArB,MAA0C,CAA9C;CAAA,OADc,EAEvBgB,GAFuB,CAEnB,UAAA0F,EAAE;CAAA,eAAIA,EAAE,CAAChN,OAAH,EAAJ;CAAA,OAFiB,CAAzB;;CAIA,UAAMsN,gBAAgB,GAAG,KAAK3G,OAAL,CAAa4G,0BAAb,GACvBjJ,MADuB,CAChB,UAAA0I,EAAE;CAAA,eAAIA,EAAE,CAAChN,OAAH,GAAaqN,OAAb,CAAqB/G,eAArB,MAA0C,CAA9C;CAAA,OADc,EAEvBgB,GAFuB,CAEnB,UAAA0F,EAAE;CAAA,eAAIA,EAAE,CAAChN,OAAH,EAAJ;CAAA,OAFiB,CAAzB;;CAIA,sDAAWmN,gBAAX,kCAAgCG,gBAAhC;CACA;;;iCAEW9E,UACZ;CAAA,UADsB9J,OACtB,uEADgC,EAChC;;CACC,UAAI8J,QAAQ,CAAC5E,IAAT,IAAiB,KAAKqD,eAA1B,EACA;CACC,aAAKuG,sBAAL,CAA4B,KAAKvG,eAAL,CAAqBuB,QAAQ,CAAC5E,IAA9B,CAA5B,EAAiElF,OAAjE;CACA,OAHD,MAIK,IAAI8J,QAAQ,CAAC5E,IAAT,IAAiB,KAAKsD,uBAA1B,EACL;CACC,aAAKuG,+BAAL,CAAqC,KAAKvG,uBAAL,CAA6BsB,QAAQ,CAAC5E,IAAtC,CAArC,EAAkFlF,OAAlF;CACA,OAHI,MAKL;CACC,aAAKyK,cAAL,CAAoBX,QAApB,EAA8B9J,OAA9B;CACA;CACD;;;4CAEsBwK,SACvB;CAAA,UADgCxK,OAChC,uEAD0C,EAC1C;CACC,UAAMwB,IAAI,GAAGxB,OAAO,CAACwB,IAAR,IAAgBgJ,OAAO,CAAC9J,KAArC;CACA8J,MAAAA,OAAO,CAAC9J,KAAR,GAAgBc,IAAhB;CAEAgJ,MAAAA,OAAO,CAACwE,SAAR,GAAoBtC,QAApB,CAA6BlC,OAA7B,gCACIxK,OADJ;CAEC2M,QAAAA,YAAY,EAAE;CAFf;;CAKA,UAAInL,IAAI,KAAK/F,EAAE,CAACkF,EAAH,CAAMC,gBAAN,CAAuBC,IAApC,EACA;CACC,aAAKoH,OAAL,CAAagH,qBAAb,CAAmCzE,OAAnC;CACA,OAHD,MAIK,IAAIhJ,IAAI,KAAK/F,EAAE,CAACkF,EAAH,CAAMC,gBAAN,CAAuByJ,IAApC,EACL;CACC,aAAKpC,OAAL,CAAaiH,uBAAb,CAAqC1E,OAArC;CACA;CACD;;;qDAE+BY,eAChC;AAAA;CACC,WAAKnD,OAAL,CAAakH,yBAAb,CAAuC/D,aAAvC;CACA;;;oCAEctB,UACf;CAAA,UADyB9J,OACzB,uEADmC,EACnC;;CACC,UAAMoP,mBAAmB,GAAG,KAAKnH,OAAL,CAAa4B,sBAAb,CAAoChC,mBAApC,CAA5B;;CACA,UAAMuD,aAAa,GAAG3P,EAAE,CAACkF,EAAH,CAAMwL,mBAAN,CAA0BC,MAA1B,CAAiCtC,QAAjC,CAAtB;;CACAsF,MAAAA,mBAAmB,CAACC,SAApB,CAA8B7P,IAA9B,CAAmC4L,aAAnC;;CAEA,UAAM5J,IAAI,GAAGxB,OAAO,CAACwB,IAAR,IAAgB/F,EAAE,CAACkF,EAAH,CAAMC,gBAAN,CAAuBC,IAApD;;CACA,UAAM2J,OAAO,GAAG,KAAKvC,OAAL,CAAauE,aAAb,CACfpB,aAAa,CAACkE,OAAd,EADe,EAEflE,aAAa,CAAC9J,OAAd,EAFe,EAGf;CACC8J,QAAAA,aAAa,EAAEA,aADhB;CAEClB,QAAAA,KAAK,EAAE,KAAKvD,MAFb;CAGC8F,QAAAA,MAAM,EAAE,IAHT;CAICjL,QAAAA,IAAI,EAAEA;CAJP,OAHe,CAAhB;;CAWA,UAAI,CAACgJ,OAAL,EACA;CACC;CACA;;CAED,UAAM+E,oBAAoB,GAAG,KAAKtH,OAAL,CAAauH,cAAb,CAA4B3H,mBAA5B,CAA7B;;CACA0H,MAAAA,oBAAoB,CAAC7C,QAArB,CAA8BlC,OAA9B,gCACIxK,OADJ;CAEC2M,QAAAA,YAAY,EAAE;CAFf;CAKA,aAAOnC,OAAP;CACA;;;oCAEctF,MACf;CACC,UAAMsF,OAAO,GAAG,KAAKvC,OAAL,CAAawH,uBAAb,CAAqCvK,IAArC,CAAhB;;CAEA,UAAIsF,OAAJ,EACA;CACC,aAAKjC,eAAL,CAAqBiC,OAAO,CAAClJ,OAAR,EAArB,IAA0CkJ,OAA1C;CACAA,QAAAA,OAAO,CAACwE,SAAR,GAAoBnK,WAApB,CAAgC2F,OAAhC,EAAyC;CAACmC,UAAAA,YAAY,EAAE;CAAf,SAAzC;;CACA,aAAK1E,OAAL,CAAayH,4BAAb,CAA0ClF,OAAO,CAACa,gBAAR,EAA1C;;CACA,aAAKpD,OAAL,CAAaiH,uBAAb,CAAqC1E,OAArC;CACA,OAND,MAQA;CACC,YAAMY,aAAa,GAAG,KAAKnD,OAAL,CAAa0H,+BAAb,CAA6CzK,IAA7C,CAAtB;;CAEA,YAAIkG,aAAJ,EACA;CACC,eAAK5C,uBAAL,CAA6B4C,aAAa,CAAC9J,OAAd,EAA7B,IAAwD8J,aAAxD;;CACA,eAAKnD,OAAL,CAAayH,4BAAb,CAA0CtE,aAA1C;CACA;CACD;CACD;;;gCAGD;CAAA;;CACC;;CAEA,UAAI,KAAK9C,eAAL,KAAyB,IAA7B,EACA;CACC;CACA;;CAED,UAAM2F,oBAAoB,GAAG,KAAKC,uBAAL,EAA7B;CAEAD,MAAAA,oBAAoB,CAAC3O,OAArB,CAA6B,UAAAsQ,OAAO,EAAI;CACvC,YAAI,CAAC,MAAI,CAACtH,eAAL,CAAqBxB,QAArB,CAA8B8I,OAA9B,CAAL,EACA;CACC,UAAA,MAAI,CAACrB,cAAL,CAAoBqB,OAApB;CACA;CACD,OALD;CAOA,WAAKtH,eAAL,CAAqBhJ,OAArB,CAA6B,UAAAsQ,OAAO,EAAI;CACvC,YAAI,CAAC3B,oBAAoB,CAACnH,QAArB,CAA8B8I,OAA9B,CAAL,EACA;CACC,UAAA,MAAI,CAACxB,WAAL,CAAiB;CAAClJ,YAAAA,IAAI,EAAE0K;CAAP,WAAjB,EAAkC;CACjClF,YAAAA,MAAM,EAAE;CACPE,cAAAA,YAAY,EAAE;CADP,aADyB;CAIjCpJ,YAAAA,IAAI,EAAE/F,EAAE,CAACkF,EAAH,CAAMC,gBAAN,CAAuByJ;CAJI,WAAlC;CAMA;CACD,OAVD;;CAYA,WAAKpC,OAAL,CAAauG,mBAAb;;CAEA,WAAKxG,kBAAL;CACA;;;GA7dmDvM,EAAE,CAACkF,EAAH,CAAMkP;;KCHtCC;;;;;CAIpB,mCAAYrV,EAAZ,EAAgBC,QAAhB,EACA;CAAA;;CAAA;CACC;CADD,yFAHa,IAGb;;CAEC,UAAKmF,UAAL,CAAgBpF,EAAhB,EAAoBC,QAApB;;CAFD;CAGC;;;;oCAGD;CACC;CAEAgE,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,uBAAvB,EAAgD,KAAKgN,oBAAL,CAA0B9T,IAA1B,CAA+B,IAA/B,CAAhD;CACAyC,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,oBAAvB,EAA6C,KAAKiN,kBAAL,CAAwB/T,IAAxB,CAA6B,IAA7B,CAA7C;CACAyC,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,eAAvB,EAAwC,KAAKiN,kBAAL,CAAwB/T,IAAxB,CAA6B,IAA7B,CAAxC;CACAyC,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,qBAAvB,EAA8C,KAAKkN,mBAAL,CAAyBhU,IAAzB,CAA8B,IAA9B,CAA9C;CAEAyC,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,eAAvB,EAAwC,KAAKmN,kBAAL,CAAwBjU,IAAxB,CAA6B,IAA7B,CAAxC;CAEAyC,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,6CAAvB,EAAsE,KAAKoN,0BAAL,CAAgClU,IAAhC,CAAqC,IAArC,CAAtE;CACAyC,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,4CAAvB,EAAqE,KAAKqN,yBAAL,CAA+BnU,IAA/B,CAAoC,IAApC,CAArE;CAEA,WAAKoU,qBAAL;CACA;;;gDAE0BvR,OAC3B;CACC,UAAInE,cAAI,CAAC2V,QAAL,CAAc,KAAKC,UAAnB,CAAJ,EACA;CACCrT,QAAAA,aAAG,CAACG,KAAJ,CAAU,KAAKmT,sBAAL,EAAV,EAAyC,QAAzC,EAAmD,KAAKD,UAAL,GAAkB,IAArE;CACA;CACD;;;+CAEyBzR,OAC1B;CACC5B,MAAAA,aAAG,CAACG,KAAJ,CAAU,KAAKmT,sBAAL,EAAV,EAAyC,QAAzC,EAAmD,EAAnD;CACA,WAAKD,UAAL,GAAkB,IAAlB;CACA;;;8CAGD;CACC,UAAM/F,OAAO,GAAG,KAAKiG,cAAL,EAAhB;;CAEA,UAAIjG,OAAJ,EACA;CACC,YAAMkG,OAAO,GAAGlG,OAAO,CAACmG,UAAR,EAAhB;;CAEA,YAAID,OAAJ,EACA;CACC,iBAAOA,OAAO,CAAC9T,aAAR,CAAsB,kDAAtB,CAAP;CACA;CACD;;CAED,aAAO,IAAP;CACA;;;gCAGD;CACC;CACA,WAAKoT,kBAAL;CACA,WAAKY,qBAAL;CACA;;;mCAGD;CACC,UAAI,KAAKC,SAAL,EAAJ,EACA;CACC,aAAKC,mBAAL,CAAyB,IAAzB;CACA;;CAED,WAAKT,qBAAL;CACA;CACA;;;yCAEmB9N,MACpB;CACC,UAAMiI,OAAO,GAAG,KAAKiG,cAAL,EAAhB;;CAEA,UAAIjG,OAAJ,EACA;CACCA,QAAAA,OAAO,CAACuG,WAAR,GAAsBxO,IAAtB;CACA;CACD;;;sCAGD;CACC,WAAKqO,qBAAL;CACA;CAED;;;;;;iDAIA;CACC,aAAOI,oBAAU,CAACC,QAAX,CAAoB,mCAApB,CAAP;CACA;;;6CAGD;CACC,UAAMC,aAAa,GAAG,KAAKC,yBAAL,EAAtB;;CACA,UAAID,aAAJ,EACA;CACCA,QAAAA,aAAa,CAACE,uBAAd;CACA;CACD;;;wCAEkBtS,OACnB;CAAA,iCACqBA,KAAK,CAACyI,aAAN,EADrB;CAAA;CAAA,UACU8J,OADV;;CAGC,UAAIA,OAAO,CAAC1V,GAAR,CAAYgT,OAAZ,CAAoB,KAAK2C,YAAL,EAApB,MAA6C,CAAjD,EACA;CACC,aAAKR,mBAAL,CAAyB,IAAzB;CACA;CACD;;;;6CAID;CACCpS,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,KAAKkF,OAAL,CAAasJ,SAApC,EAA+C,gBAA/C,EAAiE,KAAKC,kBAAL,CAAwBvV,IAAxB,CAA6B,IAA7B,CAAjE;CACA;;;4CAGD;CACC,UAAI,CAAC,KAAKgM,OAAL,CAAawJ,KAAb,EAAL,EACA;CACC,aAAKhO,aAAL;CACA;CACD;;;0CAGD;CACC,WAAKiO,UAAL,GAAkB,KAAlB;;CAEA,UAAI,KAAKzJ,OAAL,CAAa0J,qBAAb,KAAuC,CAA3C,EACA;CACC,aAAK1J,OAAL,CAAa2J,aAAb;CACA,OAHD,MAKA;CACC,aAAK3J,OAAL,CAAa4J,aAAb;CACA;;CAED,UAAI,KAAK5J,OAAL,CAAa6J,UAAjB,EACA;CACC,aAAK7J,OAAL,CAAa6J,UAAb,CAAwBC,WAAxB;CACA;CACD;;;sCAGD;CACC,aAAO,KAAK9J,OAAL,CAAauH,cAAb,CAA4B,gBAA5B,CAAP;CACA;;;yCAEmB1Q,OACpB;CAAA,kCACuBA,KAAK,CAACyI,aAAN,EADvB;CAAA;CAAA,UACUC,SADV;;CAGCA,MAAAA,SAAS,CAACwK,MAAV,GAAmBvW,EAAE,CAACwW,aAAH,EAAnB;CACAzK,MAAAA,SAAS,CAAC5L,MAAV,GAAmB,MAAnB;CACA4L,MAAAA,SAAS,CAAC7L,GAAV,GAAgB,KAAK2V,YAAL,EAAhB;CACA9J,MAAAA,SAAS,CAAC1L,IAAV,iCACI0L,SAAS,CAAC1L,IADd;CAEC4N,QAAAA,gBAAgB,EAAE,KAAKwI,mBAAL;CAFnB;CAKA,WAAKtB,qBAAL;CACA;;;oCAGD;CACC,aAAO,KAAKuB,oBAAL,CAA0B,WAA1B,EAAuC,EAAvC,CAAP;CACA;;;2CAGD;CACC,aAAO,KAAKA,oBAAL,CAA0B,kBAA1B,EAA8C,EAA9C,CAAP;CACA;;;iCAGD;CACC,aAAO,KAAKA,oBAAL,CAA0B,QAA1B,EAAoC,EAApC,CAAP;CACA;;;+BAGD;CACC,UAAI,CAACnB,oBAAU,CAACC,QAAX,CAAoB,qCAApB,CAAL,EACA;CACC,eAAO,IAAP;CACA;;CAED,aAAOxV,EAAE,CAAC2W,IAAH,CAAQC,WAAR,CAAoBC,eAApB,CAAoC,KAAKC,SAAL,EAApC,CAAP;CACA;;;wCAEkBzT,OACnB;CAAA,kCACuBA,KAAK,CAACyI,aAAN,EADvB;CAAA;CAAA,UACUC,SADV;;CAEC,UAAMgL,IAAI,GAAG,KAAKC,OAAL,EAAb;;CAEA,UAAI,CAACD,IAAL,EACA;CACC;CACA;;CAED,UAAME,WAAW,GAAG,KAAKH,SAAL,EAApB;CACA,UAAMI,WAAW,GAAGH,IAAI,CAACI,OAAL,GAAeC,qBAAf,EAApB,CAVD;;CAaC,WAAK,IAAIpY,EAAT,IAAekY,WAAf,EACA;CACC,aAAK,IAAIzN,IAAT,IAAiByN,WAAW,CAAClY,EAAD,CAA5B,EACA;CACC,cAAI,CAACkY,WAAW,CAAClY,EAAD,CAAX,CAAgBqY,cAAhB,CAA+B5N,IAA/B,CAAL,EACA;CACC;CACA;;CAED,cAAIA,IAAI,CAAC4B,QAAL,CAAc,wBAAd,KACA5B,IAAI,CAAC4B,QAAL,CAAc,qBAAd,CADJ,EAGA;CACC,iBAAK,IAAIiM,UAAT,IAAuBJ,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,CAAvB,EACA;CACC,kBAAIyN,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,EAAsB4N,cAAtB,CAAqCC,UAArC,CAAJ,EACA;CACCJ,gBAAAA,WAAW,CAAClY,EAAD,CAAX,CAAgBsY,UAAhB,IAA8BJ,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,EAAsB6N,UAAtB,CAA9B;CACA;CACD;CACD,WAXD,MAYK,IAAI7N,IAAI,CAAC4B,QAAL,CAAc,aAAd,CAAJ,EACL;CACC,gBAAIkM,OAAO,GAAG9N,IAAI,CAAC+N,OAAL,CAAa,aAAb,EAA4B,EAA5B,CAAd,CADD;;CAIC,gBAAID,OAAO,CAACE,QAAR,CAAiB,SAAjB,CAAJ,EACA;CACC,kBAAI,iBAAiBP,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,CAArB,EACA;CACCyN,gBAAAA,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,EAAsBiO,MAAtB,GAA+B,IAA/B;CACA,uBAAOR,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,EAAsB,aAAtB,CAAP;CACA;;CAED,kBAAIyN,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,EAAsBiO,MAA1B,EACA;CACC,qBAAK,IAAIC,SAAT,IAAsBT,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,CAAtB,EACA;CACC,sBAAIyN,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,EAAsB4N,cAAtB,CAAqCM,SAArC,CAAJ,EACA;CACC;CACA,wBAAIC,cAAc,GAAG,IAAI7N,MAAJ,CAAW,0CAAX,CAArB;;CAEA,wBAAI6N,cAAc,CAACxN,IAAf,CAAoBuN,SAApB,CAAJ,EACA;CACC,0BAAIE,WAAW,SAAf;CAAA,0BAAiBC,WAAW,SAA5B;;CADD,6CAGkCH,SAAS,CAACI,KAAV,CAAgBH,cAAhB,CAHlC;;CAAA;;CAGIC,sBAAAA,WAHJ;CAGmBC,sBAAAA,WAHnB;;CAKC,0BAAID,WAAW,IAAIC,WAAnB,EACA;CACCZ,wBAAAA,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,EAAsBoO,WAAtB,IAAqCX,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,EAAsBoO,WAAtB,KAAsC,EAA3E;CACAX,wBAAAA,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,EAAsBoO,WAAtB,EAAmCC,WAAnC,IAAkDZ,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,EAAsBkO,SAAtB,CAAlD;CACA,+BAAOT,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,EAAsBkO,SAAtB,CAAP;CACA;CACD;CACD;CACD;CACD;CACD;;CAEDT,YAAAA,WAAW,CAAClY,EAAD,CAAX,CAAgBuY,OAAhB,IAA2BL,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,CAA3B;CACA,mBAAOyN,WAAW,CAAClY,EAAD,CAAX,CAAgByK,IAAhB,CAAP;CACA;CACD;CACD;;CAED,UAAI,CAACvK,cAAI,CAAC8Y,aAAL,CAAmBjM,SAAS,CAACxH,OAA7B,CAAL,EACA;CACCwH,QAAAA,SAAS,CAACxH,OAAV,GAAoB,EAApB;CACA;;CAED,UAAI,CAACrF,cAAI,CAAC8Y,aAAL,CAAmBjM,SAAS,CAACxH,OAAV,CAAkBlE,IAArC,CAAL,EACA;CACC0L,QAAAA,SAAS,CAACxH,OAAV,CAAkBlE,IAAlB,GAAyB,EAAzB;CACA;;CAED0L,MAAAA,SAAS,CAACxH,OAAV,CAAkBlE,IAAlB,CAAuB4W,WAAvB,IAAsCC,WAAtC;CAEA,WAAKpC,UAAL,GAAkB,KAAKE,cAAL,GAAsBE,UAAtB,GAAmC+C,YAArD;CACA;;;GAlSmDjY,EAAE,CAACkF,EAAH,CAAMkP;;KCCtC8D;;;CAEpB,gCACA;CAAA;;CAAA;CACCjV,IAAAA,6BAAY,CAACqE,SAAb,CAAuB,kDAAvB,EAA2E,UAACjE,KAAD,EAAsB;CAAA,iCAC1EA,KAAK,CAACyI,aAAN,EAD0E;CAAA;CAAA,UACvFC,SADuF;;CAEhGA,MAAAA,SAAS,CAACC,OAAV,CAAkB,YAAlB,IAAkC,KAAI,CAACC,OAAL,CAAazL,IAAb,CAAkB,KAAlB,CAAlC;CACA,KAHD;CAIA;;;;6BAEO8I,MAAM4C,WAAWjN,UACzB;CACC,UAAIqK,IAAI,KAAK,gBAAb,EACA;CACC,eAAO,IAAI+C,uBAAJ,CAA4BH,SAA5B,EAAuCjN,QAAvC,CAAP;CACA;;CAED,UAAIqK,IAAI,KAAK,gBAAb,EACA;CACC,eAAO,IAAI+K,uBAAJ,CAA4BnI,SAA5B,EAAuCjN,QAAvC,CAAP;CACA;;CAED,aAAO,IAAP;CACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;KCzBmBkZ;;;;;;;;;;;;;;;;;2FAEN;;;;;;8BAUd;CACC,UAAI,KAAK3T,UAAT,EACA;CACC;CACA;;CAED,WAAKK,QAAL,GAAgBc,aAAG,CAACC,MAApB;CAIA,WAAKwS,UAAL,GAAkBzS,aAAG,CAACC,MAAtB,uBAC6C5F,EAAE,CAACqY,IAAH,CAAQC,SAAR,CAAkB,KAAKC,KAAvB,EAA8B,SAA9B,EAAyC,EAAzC,CAD7C;CAGArX,MAAAA,eAAK,CAACV,IAAN,CAAW,KAAK4X,UAAhB,EAA4B,QAA5B,EAAsC,KAAKI,kBAAL,CAAwBhY,IAAxB,CAA6B,IAA7B,CAAtC;CACA,UAAMiY,IAAI,GAAGzY,EAAE,CAACqY,IAAH,CAAQC,SAAR,CAAkB,KAAKC,KAAvB,EAA8B,WAA9B,EAA2C,EAA3C,CAAb;;CACA,WAAK1T,QAAL,CAAcC,WAAd,CACCa,aAAG,CAACC,MADL,uBAEyC6S,IAAI,KAAK,EAAT,GAAc,+BAAd,GAAgD,EAFzF,EAGcA,IAHd,EAII,KAAKL,UAJT;;CASA,UAAMM,SAAS,GAAGtZ,cAAI,CAAC6L,MAAL,CAAYjL,EAAE,CAACqY,IAAH,CAAQC,SAAR,CAAkB,KAAKC,KAAvB,EAA8B,MAA9B,EAAsC,EAAtC,CAAZ,CAAlB;CACA,WAAKI,WAAL,GAAmBhT,aAAG,CAACC,MAAvB,uBAGY8S,SAHZ,EAIkB1Y,EAAE,CAAC4Y,OAAH,CAAW,gDAAX,CAJlB;;CAOA,WAAK/T,QAAL,CAAcC,WAAd,CAA0B,KAAK6T,WAA/B;;CAEA,UAAME,YAAY,GAAGlT,aAAG,CAACC,MAAP,sBAAlB;CAIA1E,MAAAA,eAAK,CAACV,IAAN,CAAWqY,YAAX,EAAyB,OAAzB,EAAkC,KAAKC,mBAAL,CAAyBtY,IAAzB,CAA8B,IAA9B,CAAlC;;CACA,WAAKqE,QAAL,CAAcC,WAAd,CAA0B+T,YAA1B;;CAEA,UAAIE,MAAM,GAAG/Y,EAAE,CAACqY,IAAH,CAAQW,cAAR,CAAuB,KAAKlL,SAA5B,EAAuC,QAAvC,CAAb;;CACA,UAAIiL,MAAJ,EACA;CACC,aAAKE,UAAL,CAAgBC,YAAhB,CAA6B,KAAKrU,QAAlC,EAA4CkU,MAA5C;CACA,OAHD,MAKA;CACC,aAAKE,UAAL,CAAgBnU,WAAhB,CAA4B,KAAKD,QAAjC;CACA;;CAED,WAAKL,UAAL,GAAkB,IAAlB;CACA;;;wCAEkBnB,OACnB;CACC,UAAMqE,KAAK,GAAGrE,KAAK,CAAC8V,MAApB;;CACA,UAAIzR,KAAK,CAAC0R,KAAN,IAAe1R,KAAK,CAAC0R,KAAN,CAAY,CAAZ,CAAnB,EACA;CACC,YAAMC,MAAM,GAAG,IAAIC,UAAJ,EAAf;;CACAD,QAAAA,MAAM,CAACE,MAAP,GAAgB,UAASC,CAAT,EAAY;CAC3B9R,UAAAA,KAAK,CAACyB,UAAN,CAAiBhI,aAAjB,CAA+B,KAA/B,EAAsCsY,GAAtC,GAA4CD,CAAC,CAACL,MAAF,CAAS3N,MAArD;CACA,SAFD;;CAIA,aAAKkO,WAAL,GAAmB,IAAnB;CACAL,QAAAA,MAAM,CAACM,aAAP,CAAqBjS,KAAK,CAAC0R,KAAN,CAAY,CAAZ,CAArB;CACA1R,QAAAA,KAAK,CAACyB,UAAN,CAAiByQ,SAAjB,CAA2BC,MAA3B,CAAkC,+BAAlC;CACA;CACD;;;qCAGD;CACC,aAAO,KAAKH,WAAZ;CACA;;;mCAGD;CACC,UAAMI,SAAS,GAAG,KAAKnB,WAAL,GAAmB3Y,EAAE,CAACgK,IAAH,CAAQ+P,IAAR,CAAa,KAAKpB,WAAL,CAAiBnP,KAA9B,CAAnB,GAA0D,EAA5E;CACA,UAAMwQ,SAAS,GAAI,KAAK5B,UAAL,IAAmB,KAAKA,UAAL,CAAgBgB,KAAnC,IAA4C,KAAKhB,UAAL,CAAgBgB,KAAhB,CAAsB,CAAtB,CAA7C,GAAyE,KAAKhB,UAAL,CAAgBgB,KAAhB,CAAsB,CAAtB,CAAzE,GAAoG,EAAtH;;CAEA,UAAIU,SAAS,KAAK,EAAd,IAAoB,CAAC,KAAKG,aAAL,EAAzB,EACA;CACC;CACA;;CAED,UAAM5Z,IAAI,GAAG;CACZ,iBAAS;CACRmJ,UAAAA,KAAK,EAAEsQ,SADC;CAERxH,UAAAA,IAAI,EAAE0H;CAFE,SADG;CAKZ,kBAAU,EALE;CAMZ,mBAAW;CANC,OAAb;CAQA,UAAME,KAAK,GAAGla,EAAE,CAACqY,IAAH,CAAQC,SAAR,CAAkB,KAAKC,KAAvB,EAA8B,IAA9B,EAAoC,EAApC,CAAd;;CACA,UAAIvY,EAAE,CAACsJ,IAAH,CAAQC,gBAAR,CAAyB2Q,KAAzB,CAAJ,EACA;CACC7Z,QAAAA,IAAI,CAAC,QAAD,CAAJ,GAAiB6Z,KAAjB;CACA7Z,QAAAA,IAAI,CAAC,SAAD,CAAJ,GAAkBL,EAAE,CAACqY,IAAH,CAAQC,SAAR,CAAkB,KAAKC,KAAvB,EAA8B,SAA9B,EAAyC,EAAzC,CAAlB;CACA;;CAED,aAAOlY,IAAP;CACA;;;4BA7GarB,IAAIC,UAClB;CACC,UAAMkb,IAAI,GAAG,IAAI,IAAJ,EAAb;CACAA,MAAAA,IAAI,CAAC/V,UAAL,CAAgBpF,EAAhB,EAAoBC,QAApB;CACA,aAAOkb,IAAP;CACA;;;GAToDna,EAAE,CAACkF,EAAH,CAAMkV;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;KCEvCC;;;;;;;;;;;;sCASpB;CACC,WAAKxV,QAAL,CAAcC,WAAd,CAA0B,KAAKwV,iBAAL,EAA1B;;CACA,UAAG,KAAKC,OAAL,KAAiB,MAAjB,IAA2B,KAAKA,OAAL,KAAiB,WAA5C,IAA2D,KAAKA,OAAL,KAAiB,WAA/E,EACA;CACC,aAAK1V,QAAL,CAAcC,WAAd,CAA0Ba,aAAG,CAACC,MAA9B;;CACA,aAAKf,QAAL,CAAcC,WAAd,CAA0B,KAAK0V,uBAAL,EAA1B;CACA;;CAED,WAAK3V,QAAL,CAAcC,WAAd,CAA0B,KAAK2V,kBAAL,EAA1B;;CACA,WAAK5V,QAAL,CAAcC,WAAd,CAA0B,KAAK4V,iBAAL,EAA1B;;CACAjZ,MAAAA,aAAG,CAACqQ,MAAJ,CAAWnM,aAAG,CAACC,MAAf,wBAA2D,KAAKf,QAAhE;;CACA,WAAKA,QAAL,CAAcC,WAAd,CAA0B,KAAK6V,kBAAL,EAA1B;CACA;;;0CAED;CACC,UAAI3E,KAAK,GAAI,KAAK4E,MAAL,KAAgB,IAA7B;CACA,WAAKC,cAAL,GAAsBlV,aAAG,CAACC,MAA1B;;CAIA,UAAI,KAAK2U,OAAL,KAAiB,UAAjB,IAA+B,KAAKA,OAAL,KAAiB,eAApD,EACA;CACC,aAAKO,sBAAL,GAA8B,KAAKC,wBAAL,EAA9B;CACA;;CAED,UAAI,KAAKR,OAAL,KAAiB,SAAjB,IAA8B,KAAKS,uBAAvC,EACA;CACC,aAAKC,mBAAL,GAA2B,KAAKC,qBAAL,EAA3B;CACA;;CAED,UAAI,KAAKX,OAAL,KAAiB,WAArB,EACA;CACC,aAAKY,mBAAL,GAA2B,KAAKC,mBAAL,EAA3B;CACA,OAnBF;;;CAsBC,WAAKC,mBAAL,GAA2B,KAAKC,YAAL,CAC1B;CAAEC,QAAAA,OAAO,EAAEvb,EAAE,CAAC4Y,OAAH,CAAW,8BAAX,CAAX;CAAuD4C,QAAAA,OAAO,EAAE,4CAAhE;CAA8GC,QAAAA,QAAQ,EAAE;CAAxH,OAD0B,CAA3B;CAGA,WAAKJ,mBAAL,CAAyBK,OAAzB,GAAmC1F,KAAK,GACrChW,EAAE,CAACqY,IAAH,CAAQsD,UAAR,CAAmB,KAAK7N,SAAxB,EAAmC,YAAnC,EAAiD,IAAjD,CADqC,GAErC,KAAK8M,MAAL,CAAYgB,eAAZ,CAA4B5b,EAAE,CAACkF,EAAH,CAAM2W,0BAAN,CAAiCzM,UAA7D,CAFH,CAzBD;;CA8BC,aAAO,KAAKyL,cAAZ;CACA;;;qCAGD;CACC,UAAMha,OAAO,GAAG,KAAK2L,OAAL,CAAasP,mBAAb,EAAhB;;CACA,aAAO,KAAKlB,MAAL,GAAc,KAAKA,MAAL,CAAY5V,QAAZ,EAAd,GAAuCnE,OAAO,CAACkb,oBAAR,CAA6B,KAAKxB,OAAlC,CAA9C;CACA;;;yCAED;CACC,WAAKyB,eAAL,GAAuBrW,aAAG,CAACC,MAA3B;CAGA,aAAO,KAAKoW,eAAZ;CACA;;;+CAGD;CAAA;;CACC,UAAMC,WAAW,GAAGtW,aAAG,CAACC,MAAP,uBAGoC5F,EAAE,CAAC4Y,OAAH,CAAW,gCAAX,CAHpC,CAAjB;CAQA,WAAKsD,kBAAL,GAA0BvW,aAAG,CAACC,MAA9B;CAGAnE,MAAAA,aAAG,CAACqQ,MAAJ,CAAW,KAAKoK,kBAAhB,EAAoCD,WAApC;CAEA,UAAME,SAAS,GAAGxW,aAAG,CAACC,MAAP,qBAEV5F,EAAE,CAAC4Y,OAAH,CAAW,sBAAX,CAFU,CAAf;CAKA1X,MAAAA,eAAK,CAACV,IAAN,CAAW2b,SAAX,EAAsB,OAAtB,EAA+B,KAAKC,+BAAL,CAAqC5b,IAArC,CAA0C,IAA1C,CAA/B;CAEAiB,MAAAA,aAAG,CAACqQ,MAAJ,CACCnM,aAAG,CAACC,MADL,qBAGKuW,SAHL,GAMCF,WAND;;CASA,UAAI,KAAKrB,MAAT,EACA;CACC,aAAKA,MAAL,CAAYyB,QAAZ,GAAuBxY,OAAvB,CAA+B,UAAAyY,UAAU,EAAI;CAC5C,cAAIA,UAAU,CAACrK,KAAX,KAAqB,EAAzB,EACA;CACC,YAAA,KAAI,CAACsK,qBAAL,CAA2B;CAC1BtK,cAAAA,KAAK,EAAEqK,UAAU,CAAChL,IADQ;CAE1Be,cAAAA,OAAO,EAAEiK,UAAU,CAACE,KAAX,IAAoB,IAFH;CAG1BC,cAAAA,SAAS,EAAEH,UAAU,CAACG,SAAX,IAAwB,EAHT;CAI1BC,cAAAA,IAAI,EAAEJ,UAAU,CAACI,IAAX,IAAmB,EAJC;CAK1BxK,cAAAA,EAAE,EAAEoK,UAAU,CAACrK;CALW,aAA3B;CAOA;CACD,SAXD;CAYA;;CAED,UAAM0K,QAAQ,GAAG,KAAKJ,qBAAL,EAAjB;CACAI,MAAAA,QAAQ,CAACC,KAAT;CACA,WAAKC,qBAAL;CACA,aAAOZ,WAAP;CACA;;;uDAGD;CACC,WAAKa,uBAAL;CACA,WAAKP,qBAAL,GAA6BK,KAA7B;CACA,WAAKG,wBAAL;CACA;;;8CAGD;CACC,WAAKD,uBAAL;CACA,WAAKP,qBAAL;CACA,WAAKQ,wBAAL;CACA;;;6CAGD;CACC,WAAKD,uBAAL;CACA,WAAKC,wBAAL;CACA;;;+CAGD;CACC,WAAKC,UAAL,CAAgBnZ,OAAhB,CAAwB,UAAAC,IAAI;CAAA,eAAI5C,eAAK,CAAC+b,SAAN,CAAgBnZ,IAAI,CAAC6U,WAArB,EAAkC,OAAlC,CAAJ;CAAA,OAA5B;CACA;;;gDAGD;CACC,UAAMgE,QAAQ,GAAG,KAAKK,UAAL,CAAgB,KAAKA,UAAL,CAAgB3S,MAAhB,GAAyB,CAAzC,CAAjB;;CACA,UAAIsS,QAAJ,EACA;CACCzb,QAAAA,eAAK,CAACgc,QAAN,CAAeP,QAAQ,CAAChE,WAAxB,EAAqC,OAArC,EAA8C,KAAKwE,sBAAL,CAA4B3c,IAA5B,CAAiC,IAAjC,CAA9C;CACA;CACD;;;2CAEqBH,MACtB;CACC,UAAIyD,IAAI,GAAG,IAAX;;CACA,UAAI,KAAKyW,OAAL,KAAiB,WAArB,EACA;CACCzW,QAAAA,IAAI,GAAGqU,wBAAwB,CAACxH,MAAzB,CACN,EADM,EAEN;CACCyM,UAAAA,YAAY,EAAE,IADf;CAEC7d,UAAAA,SAAS,EAAE,KAAK2c,kBAFjB;CAGC7b,UAAAA,IAAI,EAAEA;CAHP,SAFM,CAAP;CAQA,OAVD,MAYA;CACCyD,QAAAA,IAAI,GAAG9D,EAAE,CAACkF,EAAH,CAAMkV,6BAAN,CAAoCzJ,MAApC,CACN,EADM,EAEN;CACCyM,UAAAA,YAAY,EAAE,IADf;CAEC7d,UAAAA,SAAS,EAAE,KAAK2c,kBAFjB;CAGC7b,UAAAA,IAAI,EAAEA;CAHP,SAFM,CAAP;CAQA;;CAED,WAAK2c,UAAL,CAAgBjZ,IAAhB,CAAqBD,IAArB;;CACAA,MAAAA,IAAI,CAACmL,MAAL;CACA,aAAOnL,IAAP;CACA;;;2CAEqBA,MACtB;CACC,WAAK,IAAIuZ,CAAC,GAAG,CAAR,EAAWhT,MAAM,GAAG,KAAK2S,UAAL,CAAgB3S,MAAzC,EAAiDgT,CAAC,GAAGhT,MAArD,EAA6DgT,CAAC,EAA9D,EACA;CACC,YAAI,KAAKL,UAAL,CAAgBK,CAAhB,MAAuBvZ,IAA3B,EACA;CACC,eAAKkZ,UAAL,CAAgBK,CAAhB,EAAmBC,WAAnB;;CACA,eAAKN,UAAL,CAAgBO,MAAhB,CAAuBF,CAAvB,EAA0B,CAA1B;;CACA,eAAKR,qBAAL;CACA;CACA;CACD;CACD;;;uCAEiBrD,GAClB;CACC,UAAM9Z,MAAM,0HAA2B,IAA3B,EAAiC8d,SAAjC,CAAZ;;CACA,UAAI,KAAKjD,OAAL,KAAiB,MAAjB,IAA2B,KAAKA,OAAL,KAAiB,WAAhD,EACA;CACC7a,QAAAA,MAAM,CAAC,aAAD,CAAN,GAAwB,EAAxB;CACA,YAAM+d,MAAM,GAAG,EAAf;;CACA,aAAKT,UAAL,CAAgBnZ,OAAhB,CAAwB,UAAAgO,QAAQ,EAAI;CACnC,cAAI,EAAEA,QAAQ,YAAY7R,EAAE,CAACkF,EAAH,CAAMkV,6BAA5B,CAAJ,EACA;CACC;CACA;;CAED,cAAMsD,QAAQ,GAAG7L,QAAQ,CAAC8L,WAAT,EAAjB;;CACA,cAAI,CAACD,QAAL,EACA;CACC;CACA;;CAED,cAAME,IAAI,GAAG5d,EAAE,CAACgK,IAAH,CAAQ6T,QAAR,CAAiBH,QAAQ,CAAC,OAAD,CAAzB,CAAb;;CACA,cAAI1d,EAAE,CAACgK,IAAH,CAAQ8T,QAAR,CAAiBF,IAAjB,EAAuBH,MAAvB,CAAJ,EACA;CACC;CACA;;CAEDA,UAAAA,MAAM,CAAC1Z,IAAP,CAAY6Z,IAAZ;CACAF,UAAAA,QAAQ,CAAC,MAAD,CAAR,GAAmB,CAAChe,MAAM,CAAC,aAAD,CAAN,CAAsB2K,MAAtB,GAA+B,CAAhC,IAAqC,GAAxD;CACA3K,UAAAA,MAAM,CAAC,aAAD,CAAN,CAAsBqE,IAAtB,CAA2B2Z,QAA3B;CACA,SArBD;CAsBA;;CACD,UAAI,KAAKnD,OAAL,KAAiB,WAArB,EACA;CACC7a,QAAAA,MAAM,CAAC,aAAD,CAAN,GAAwB,EAAxB;;CACA,aAAKsd,UAAL,CAAgBnZ,OAAhB,CAAwB,UAAAgO,QAAQ,EAAI;CACnC,cAAI,EAAEA,QAAQ,YAAYsG,wBAAtB,CAAJ,EACA;CACC;CACA;;CAED,cAAMuF,QAAQ,GAAG7L,QAAQ,CAAC8L,WAAT,EAAjB;;CACA,cAAI,CAACD,QAAL,EACA;CACC;CACA;;CAEDA,UAAAA,QAAQ,CAAC,MAAD,CAAR,GAAmB,CAAChe,MAAM,CAAC,aAAD,CAAN,CAAsB2K,MAAtB,GAA+B,CAAhC,IAAqC,GAAxD;CACA3K,UAAAA,MAAM,CAAC,aAAD,CAAN,CAAsBqE,IAAtB,CAA2B2Z,QAA3B;CACA,SAdD;CAeA,OAlBD,MAmBK,IAAI,KAAKnD,OAAL,KAAiB,UAAjB,IAA+B,KAAKA,OAAL,KAAiB,eAApD,EACL;CACC7a,QAAAA,MAAM,CAAC,YAAD,CAAN,GAAuB,KAAKob,sBAAL,CAA4BY,OAAnD;CACA;;CAED,UAAI,KAAKd,MAAT,EACA;CACC,YAAI,KAAKO,mBAAT,EACA;CACCzb,UAAAA,MAAM,CAAC,UAAD,CAAN,GAAqB,KAAKyb,mBAAL,CAAyBO,OAA9C;CACA;CACD,OAND,MAQA;CACC,YAAG,KAAKnB,OAAL,KAAiB,SAApB,EACA;CACC7a,UAAAA,MAAM,CAAC,UAAD,CAAN,GAAqB,KAArB;CACA,SAHD,MAIK,IAAG,KAAKyb,mBAAR,EACL;CACCzb,UAAAA,MAAM,CAAC,UAAD,CAAN,GAAqB,KAAKyb,mBAAL,CAAyBO,OAA9C;CACA;CACD;;CAED,aAAOhc,MAAP;CACA;;;2CAGD;CACC,UAAMqe,QAAQ,GAAG,KAAKzC,YAAL,CAAkB;CAACC,QAAAA,OAAO,EAAEvb,EAAE,CAAC4Y,OAAH,CAAW,oCAAX;CAAV,OAAlB,CAAjB;;CACA,UACC,KAAKgC,MAAL,YAAuB5a,EAAE,CAACkF,EAAH,CAAMuL,qBAA7B,IACG,KAAKmK,MAAL,YAAuB5a,EAAE,CAACkF,EAAH,CAAMsL,uBADhC,IAEG,KAAKoK,MAAL,YAAuB5a,EAAE,CAACkF,EAAH,CAAMqL,qBAFhC,IAGG,KAAKqK,MAAL,YAAuB5a,EAAE,CAACkF,EAAH,CAAM8K,yBAJjC,EAMA;CACC+N,QAAAA,QAAQ,CAACrC,OAAT,GAAmB,IAAnB;CACA;;CAED,aAAOqC,QAAP;CACA;;;6CAGD;CACC,UAAIA,QAAJ;;CACA,UAAI,KAAKC,sBAAT,EACA;CACCD,QAAAA,QAAQ,GAAG,KAAKzC,YAAL,CACV;CACCC,UAAAA,OAAO,EAAE,KAAKyC,sBAAL,CAA4BhZ,QAA5B,KAAyC,GADnD;CAECiZ,UAAAA,aAAa,EAAE;CAACC,YAAAA,KAAK,EAAE;CAACC,cAAAA,SAAS,EAAE;CAAZ;CAAR,WAFhB;CAGCC,UAAAA,iBAAiB,EAAE;CAACxc,YAAAA,KAAK,EAAE;CAACyc,cAAAA,UAAU,EAAE;CAAb;CAAR,WAHpB;CAICC,UAAAA,QAAQ,EAAE,KAAKN,sBAAL,CAA4BO,SAA5B,GAAwCC,aAAxC;CAJX,SADU,CAAX;CASAT,QAAAA,QAAQ,CAACrC,OAAT,GAAoB,KAAKd,MAAL,IAAe,KAAKA,MAAL,CAAY6D,UAAZ,EAAhB,IACf,KAAKT,sBAAL,CAA4BU,YAA5B,EADJ;;CAGA,aAAKV,sBAAL,CAA4BW,iBAA5B,CAA8CZ,QAA9C;;CACA,aAAKC,sBAAL,CAA4BY,QAA5B,CAAqCb,QAAQ,CAACc,WAA9C;;CAEA,aAAKb,sBAAL,CAA4Bc,UAA5B,CAAuCf,QAAQ,CAACrC,OAAhD;;CACA,aAAKsC,sBAAL,CAA4Be,MAA5B;CACA,OAnBD,MAqBA;CACChB,QAAAA,QAAQ,GAAG,KAAKzC,YAAL,CAAkB;CAACC,UAAAA,OAAO,EAAEvb,EAAE,CAAC4Y,OAAH,CAAW,oCAAX;CAAV,SAAlB,CAAX;CACAmF,QAAAA,QAAQ,CAACrC,OAAT,GAAmB,KAAKd,MAAL,IAAe,KAAKA,MAAL,CAAY6D,UAAZ,EAAlC;CACA;;CACD,aAAOV,QAAP;CACA;;;gDAGD;CACC,UAAMA,QAAQ,GAAG,KAAKzC,YAAL,CAAkB;CAACC,QAAAA,OAAO,EAAEvb,EAAE,CAAC4Y,OAAH,CAAW,iCAAX;CAAV,OAAlB,CAAjB;CACAmF,MAAAA,QAAQ,CAACrC,OAAT,GAAmB,KAAKd,MAAL,IAAe,KAAKA,MAAL,CAAYoE,aAAZ,EAAlC;CACA,aAAOjB,QAAP;CACA;;;4BAvUa/e,IAAIC,UAClB;CACC,UAAMkb,IAAI,GAAG,IAAI,IAAJ,EAAb;CACAA,MAAAA,IAAI,CAAC/V,UAAL,CAAgBpF,EAAhB,EAAoBC,QAApB;CACA,aAAOkb,IAAP;CACA;;;GAPmDna,EAAE,CAACkF,EAAH,CAAM+Z;AA4U3D1J,qBAAU,CAAC2J,SAAX,CAAqB,YAArB,EAAmC7E,uBAAnC,GAA6DA,uBAA7D;;KC9UqB8E;;;;;;;;;;;;6CAEIzf,QAAQsR,QAChC;CACC,UAAI,CAAChR,EAAE,CAACsJ,IAAH,CAAQ0O,aAAR,CAAsBtY,MAAtB,CAAL,EACA;CACC,cAAM,wEAAN;CACA;;CAED,aAAO,KAAK0f,0BAAL,CAAgC1f,MAAhC,EAAwCsR,MAAxC,CAAP;CACA;;;gDAE0BtR,QAAQsR,QACnC;CACC,UAAIW,MAAM,GAAG,EAAb;CACA,UAAM3E,KAAK,GAAGhN,EAAE,CAACqY,IAAH,CAAQgH,GAAR,CAAY3f,MAAZ,EAAoB,OAApB,EAA6B,IAA7B,CAAd;;CACA,UAAIsN,KAAJ,EACA;CACC2E,QAAAA,MAAM,GAAG3E,KAAK,CAAC6G,OAAN,EAAT;CACA7G,QAAAA,KAAK,CAACsS,UAAN,CAAiB,KAAjB;;CAEA,YAAI,CAACtf,EAAE,CAACqY,IAAH,CAAQgH,GAAR,CAAYrS,KAAK,CAAC4C,gBAAN,GAAyBjH,OAAzB,EAAZ,EAAgD,mBAAhD,EAAqE,KAArE,CAAL,EACA;CACC,iBAAO,KAAK4W,kBAAL,GAA0Bvf,EAAE,CAACkF,EAAH,CAAM+Z,6BAAN,CAAoCtO,MAApC,CAChC,EADgC,EAEhC;CACC6O,YAAAA,MAAM,EAAE,KAAKhT,OADd;CAECmD,YAAAA,aAAa,EAAE,IAFhB;CAGClB,YAAAA,KAAK,EAAEuC,MAAM,CAAC9F,MAHf;CAICnF,YAAAA,IAAI,EAAE/F,EAAE,CAACkF,EAAH,CAAMC,gBAAN,CAAuBC,IAJ9B;CAKC4L,YAAAA,MAAM,EAAEA,MALT;CAMCW,YAAAA,MAAM,EAAEA,MANT;CAOC3E,YAAAA,KAAK,EAAEA,KAPR;CAQCyS,YAAAA,qBAAqB,EAAE;CARxB,WAFgC,CAAjC;CAaA,SAfD,MAgBK,IAAIzf,EAAE,CAACqY,IAAH,CAAQgH,GAAR,CAAYrS,KAAK,CAAC4C,gBAAN,GAAyBjH,OAAzB,EAAZ,EAAgD,UAAhD,EAA4D,KAA5D,CAAJ,EACL;CACCgJ,UAAAA,MAAM,GAAG3R,EAAE,CAACqY,IAAH,CAAQC,SAAR,CAAkBtL,KAAK,CAAC4C,gBAAN,GAAyBjH,OAAzB,EAAlB,EAAsD,UAAtD,CAAT;CACA;CACD,OAzBD,MA2BA;CACCgJ,QAAAA,MAAM,GAAG3R,EAAE,CAACqY,IAAH,CAAQgH,GAAR,CAAY3f,MAAZ,EAAoB,QAApB,EAA8BM,EAAE,CAACkF,EAAH,CAAMwa,mBAAN,CAA0BC,MAAxD,CAAT;CACA;;CAED,WAAKJ,kBAAL,GAA0BlF,uBAAuB,CAAC1J,MAAxB,CACzB,EADyB,EAEzB;CACC6O,QAAAA,MAAM,EAAE,KAAKhT,OADd;CAECmD,QAAAA,aAAa,EAAE,IAFhB;CAGClB,QAAAA,KAAK,EAAEuC,MAAM,CAAC9F,MAHf;CAICnF,QAAAA,IAAI,EAAE/F,EAAE,CAACkF,EAAH,CAAMC,gBAAN,CAAuBC,IAJ9B;CAKC4L,QAAAA,MAAM,EAAEA,MALT;CAMCW,QAAAA,MAAM,EAAEA,MANT;CAOC3E,QAAAA,KAAK,EAAEA,KAPR;CAQCyS,QAAAA,qBAAqB,EAAE;CARxB,OAFyB,CAA1B;CAcA,aAAO,KAAKF,kBAAZ;CACA;;;yCAGD;CACC,aAAO,IAAP;CACA;;;wCAEkB5N,QACnB;CACC,aAAO,KAAKiO,eAAZ;CACA;;;yCAEmBjO,QACpB;CACC3R,MAAAA,EAAE,CAAC6f,SAAH,CAAaC,QAAb,CAAsBC,IAAtB,CAA2B,KAAKC,kBAAL,CAAwBrO,MAAxB,CAA3B,EAA4D;CAC3DsO,QAAAA,kBAAkB,EAAE,KADuC;CAE3DC,QAAAA,SAAS,EAAE;CAFgD,OAA5D;CAIA;;;wCAEkBhgB,KACnB;CACC,aAAO,KAAK0f,eAAL,GAAuB1f,GAA9B;CACA;;;oCAGD;CACC,UAAIyD,KAAK,GAAG,EAAZ;CACAA,MAAAA,KAAK,CAACI,IAAN,CAAW;CACV0F,QAAAA,IAAI,EAAE,QADI;CAEV0W,QAAAA,KAAK,EAAEngB,EAAE,CAAC4Y,OAAH,CAAW,kCAAX,CAFG;CAGVwH,QAAAA,MAAM,EAAEpgB,EAAE,CAAC4Y,OAAH,CAAW,mCAAX;CAHE,OAAX;CAKAjV,MAAAA,KAAK,CAACI,IAAN,CAAW;CACV0F,QAAAA,IAAI,EAAE,MADI;CAEV0W,QAAAA,KAAK,EAAEngB,EAAE,CAAC4Y,OAAH,CAAW,gCAAX,CAFG;CAGVwH,QAAAA,MAAM,EAAEpgB,EAAE,CAAC4Y,OAAH,CAAW,iCAAX;CAHE,OAAX;CAKAjV,MAAAA,KAAK,CAACI,IAAN,CAAW;CACV0F,QAAAA,IAAI,EAAE,UADI;CAEV0W,QAAAA,KAAK,EAAEngB,EAAE,CAAC4Y,OAAH,CAAW,oCAAX,CAFG;CAGVwH,QAAAA,MAAM,EAAEpgB,EAAE,CAAC4Y,OAAH,CAAW,qCAAX;CAHE,OAAX;CAKAjV,MAAAA,KAAK,CAACI,IAAN,CAAW;CACV0F,QAAAA,IAAI,EAAE,SADI;CAEV0W,QAAAA,KAAK,EAAEngB,EAAE,CAAC4Y,OAAH,CAAW,mCAAX,CAFG;CAGVwH,QAAAA,MAAM,EAAEpgB,EAAE,CAAC4Y,OAAH,CAAW,oCAAX;CAHE,OAAX;CAMAjV,MAAAA,KAAK,CAACI,IAAN,CAAW;CACV0F,QAAAA,IAAI,EAAE,OADI;CAEV0W,QAAAA,KAAK,EAAEngB,EAAE,CAAC4Y,OAAH,CAAW,iCAAX,CAFG;CAGVwH,QAAAA,MAAM,EAAEpgB,EAAE,CAAC4Y,OAAH,CAAW,kCAAX;CAHE,OAAX;CAKAjV,MAAAA,KAAK,CAACI,IAAN,CAAW;CACV0F,QAAAA,IAAI,EAAE,SADI;CAEV0W,QAAAA,KAAK,EAAEngB,EAAE,CAAC4Y,OAAH,CAAW,gCAAX,CAFG;CAGVwH,QAAAA,MAAM,EAAEpgB,EAAE,CAAC4Y,OAAH,CAAW,oCAAX;CAHE,OAAX;CAKAjV,MAAAA,KAAK,CAACI,IAAN,CAAW;CACV0F,QAAAA,IAAI,EAAE,QADI;CAEV0W,QAAAA,KAAK,EAAEngB,EAAE,CAAC4Y,OAAH,CAAW,kCAAX,CAFG;CAGVwH,QAAAA,MAAM,EAAEpgB,EAAE,CAAC4Y,OAAH,CAAW,mCAAX;CAHE,OAAX;CAKAjV,MAAAA,KAAK,CAACI,IAAN,CAAW;CACV0F,QAAAA,IAAI,EAAE,WADI;CAEV0W,QAAAA,KAAK,EAAEngB,EAAE,CAAC4Y,OAAH,CAAW,sCAAX,CAFG;CAGVwH,QAAAA,MAAM,EAAEpgB,EAAE,CAAC4Y,OAAH,CAAW,uCAAX;CAHE,OAAX;CAMAjV,MAAAA,KAAK,CAACI,IAAN,CAAW;CACV0F,QAAAA,IAAI,EAAE,QADI;CAEV0W,QAAAA,KAAK,EAAEngB,EAAE,CAAC4Y,OAAH,CAAW,kCAAX,CAFG;CAGVwH,QAAAA,MAAM,EAAEpgB,EAAE,CAAC4Y,OAAH,CAAW,mCAAX;CAHE,OAAX;CAMA,aAAOjV,KAAP;CACA;;;4BAEa3E,IAAIC,UAClB;CACC,UAAMkb,IAAI,GAAG,IAAI,IAAJ,EAAb;CACAA,MAAAA,IAAI,CAAC/V,UAAL,CAAgBpF,EAAhB,EAAoBC,QAApB;CACA,aAAOkb,IAAP;CACA;;;GAlJ2Dna,EAAE,CAACkF,EAAH,CAAMmb;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;KCA9CC;;;;;;;;;;;;CASpB;iDAEA;CAAA;;CACC,UAAI,KAAK/F,OAAL,KAAiB,MAAjB,IAA2B,KAAKA,OAAL,KAAiB,WAAhD,EACA;CACC9Y,QAAAA,aAAG,CAACqQ,MAAJ,CAAWnM,aAAG,CAACC,MAAf,uBAA2D,KAAKf,QAAhE;CAEA,YAAMoX,WAAW,GAAGtW,aAAG,CAACC,MAAP,uBAGoC5F,EAAE,CAAC4Y,OAAH,CAAW,gCAAX,CAHpC,CAAjB;CAQAnX,QAAAA,aAAG,CAACqQ,MAAJ,CAAWmK,WAAX,EAAwB,KAAKpX,QAA7B;CAEA,aAAKqX,kBAAL,GAA0BvW,aAAG,CAACC,MAA9B;CAGAnE,QAAAA,aAAG,CAACqQ,MAAJ,CAAW,KAAKoK,kBAAhB,EAAoCD,WAApC;CAEA,YAAME,SAAS,GAAGxW,aAAG,CAACC,MAAP,uBAEV5F,EAAE,CAAC4Y,OAAH,CAAW,sBAAX,CAFU,CAAf;CAKA1X,QAAAA,eAAK,CAACV,IAAN,CAAW2b,SAAX,EAAsB,OAAtB,EAA+B,KAAKC,+BAAL,CAAqC5b,IAArC,CAA0C,IAA1C,CAA/B;CAEAiB,QAAAA,aAAG,CAACqQ,MAAJ,CACCnM,aAAG,CAACC,MADL,uBAGKuW,SAHL,GAMCF,WAND;;CASA,YAAI,KAAKrB,MAAT,EACA;CACC,eAAKA,MAAL,CAAYyB,QAAZ,GAAuBxY,OAAvB,CAA+B,UAAAyY,UAAU,EAAI;CAC5C,gBAAIA,UAAU,CAACrK,KAAX,KAAqB,EAAzB,EACA;CACC,cAAA,KAAI,CAACsK,qBAAL,CAA2B;CAC1BtK,gBAAAA,KAAK,EAAEqK,UAAU,CAAChL,IADQ;CAE1BY,gBAAAA,EAAE,EAAEoK,UAAU,CAACrK;CAFW,eAA3B;CAIA;CACD,WARD;CASA;;CAED,aAAKsK,qBAAL;CACA,aAAKgE,qBAAL;CACA;CACD;;;uDAGD;CACC,WAAKC,uBAAL;CACA,WAAKjE,qBAAL,GAA6BK,KAA7B;CACA,WAAK6D,wBAAL;CACA;;;8CAGD;CACC,WAAKD,uBAAL;CACA,WAAKjE,qBAAL;CACA,WAAKkE,wBAAL;CACA;;;6CAGD;CACC,WAAKD,uBAAL;CACA,WAAKC,wBAAL;CACA;;;+CAGD;CACC,WAAKzD,UAAL,CAAgBnZ,OAAhB,CAAwB,UAAAC,IAAI;CAAA,eAAI5C,eAAK,CAAC+b,SAAN,CAAgBnZ,IAAI,CAAC6U,WAArB,EAAkC,OAAlC,CAAJ;CAAA,OAA5B;CACA;;;gDAGD;CACC,UAAMgE,QAAQ,GAAG,KAAKK,UAAL,CAAgB,KAAKA,UAAL,CAAgB3S,MAAhB,GAAyB,CAAzC,CAAjB;;CACA,UAAIsS,QAAJ,EACA;CACCzb,QAAAA,eAAK,CAACgc,QAAN,CAAeP,QAAQ,CAAChE,WAAxB,EAAqC,OAArC,EAA8C,KAAK+H,sBAAL,CAA4BlgB,IAA5B,CAAiC,IAAjC,CAA9C;CACA;CACD;;;2CAEqBH,MACtB;CACC,UAAIyD,IAAI,GAAG9D,EAAE,CAACkF,EAAH,CAAMkV,6BAAN,CAAoCzJ,MAApC,CACV,EADU,EAEV;CACCyM,QAAAA,YAAY,EAAE,IADf;CAEC7d,QAAAA,SAAS,EAAE,KAAK2c,kBAFjB;CAGC7b,QAAAA,IAAI,EAAEA;CAHP,OAFU,CAAX;;CASA,WAAK2c,UAAL,CAAgBjZ,IAAhB,CAAqBD,IAArB;;CACAA,MAAAA,IAAI,CAACmL,MAAL;CACA,aAAOnL,IAAP;CACA;;;2CAEqBA,MACtB;CACC,WAAK,IAAIuZ,CAAC,GAAG,CAAR,EAAWhT,MAAM,GAAG,KAAK2S,UAAL,CAAgB3S,MAAzC,EAAiDgT,CAAC,GAAGhT,MAArD,EAA6DgT,CAAC,EAA9D,EACA;CACC,YAAI,KAAKL,UAAL,CAAgBK,CAAhB,MAAuBvZ,IAA3B,EACA;CACC,eAAKkZ,UAAL,CAAgBK,CAAhB,EAAmBC,WAAnB;;CACA,eAAKN,UAAL,CAAgBO,MAAhB,CAAuBF,CAAvB,EAA0B,CAA1B;;CACA,eAAKkD,qBAAL;CACA;CACA;CACD;CACD;;;uCAEiB/G,GAClB;CACC,UAAM9Z,MAAM,wHAA2B,IAA3B,EAAiC8d,SAAjC,CAAZ;;CACA,UAAI,KAAKjD,OAAL,KAAiB,MAAjB,IAA2B,KAAKA,OAAL,KAAiB,WAAhD,EACA;CACC7a,QAAAA,MAAM,CAAC,aAAD,CAAN,GAAwB,EAAxB;CACA,YAAM+d,MAAM,GAAG,EAAf;;CACA,aAAKT,UAAL,CAAgBnZ,OAAhB,CAAwB,UAAAgO,QAAQ,EAAI;CACnC,cAAI,EAAEA,QAAQ,YAAY7R,EAAE,CAACkF,EAAH,CAAMkV,6BAA5B,CAAJ,EACA;CACC;CACA;;CAED,cAAMsD,QAAQ,GAAG7L,QAAQ,CAAC8L,WAAT,EAAjB;;CACA,cAAI,CAACD,QAAL,EACA;CACC;CACA;;CAED,cAAME,IAAI,GAAG5d,EAAE,CAACgK,IAAH,CAAQ6T,QAAR,CAAiBH,QAAQ,CAAC,OAAD,CAAzB,CAAb;;CACA,cAAI1d,EAAE,CAACgK,IAAH,CAAQ8T,QAAR,CAAiBF,IAAjB,EAAuBH,MAAvB,CAAJ,EACA;CACC;CACA;;CAEDA,UAAAA,MAAM,CAAC1Z,IAAP,CAAY6Z,IAAZ;CACAF,UAAAA,QAAQ,CAAC,MAAD,CAAR,GAAmB,CAAChe,MAAM,CAAC,aAAD,CAAN,CAAsB2K,MAAtB,GAA+B,CAAhC,IAAqC,GAAxD;CACA3K,UAAAA,MAAM,CAAC,aAAD,CAAN,CAAsBqE,IAAtB,CAA2B2Z,QAA3B;CACA,SArBD;CAsBA,OA1BD,MA2BK,IAAI,KAAKnD,OAAL,KAAiB,UAAjB,IAA+B,KAAKA,OAAL,KAAiB,eAApD,EACL;CACC7a,QAAAA,MAAM,CAAC,YAAD,CAAN,GAAuB,KAAKob,sBAAL,CAA4BY,OAAnD;CACA;;CAED,aAAOhc,MAAP;CACA;;;2CAGD;CACC,UAAIqe,QAAQ,GAAG,KAAKzC,YAAL,CAAkB;CAACC,QAAAA,OAAO,EAAEvb,EAAE,CAAC4Y,OAAH,CAAW,oCAAX;CAAV,OAAlB,CAAf;;CACA,UACC,KAAKgC,MAAL,YAAuB5a,EAAE,CAACkF,EAAH,CAAMuL,qBAA7B,IACG,KAAKmK,MAAL,YAAuB5a,EAAE,CAACkF,EAAH,CAAMsL,uBADhC,IAEG,KAAKoK,MAAL,YAAuB5a,EAAE,CAACkF,EAAH,CAAMqL,qBAFhC,IAGG,KAAKqK,MAAL,YAAuB5a,EAAE,CAACkF,EAAH,CAAM8K,yBAJjC,EAMA;CACC+N,QAAAA,QAAQ,CAACrC,OAAT,GAAmB,IAAnB;CACA;;CAED,aAAOqC,QAAP;CACA;;;6CAGD;CACC,UAAIA,QAAQ,GAAG,IAAf;;CACA,UAAI,KAAKxD,OAAL,KAAiB,SAArB,EACA;CACC,YAAI,KAAKS,uBAAT,EACA;CACC,cAAI,KAAKgD,sBAAT,EACA;CACCD,YAAAA,QAAQ,GAAG,KAAKzC,YAAL,CACV;CACCC,cAAAA,OAAO,EAAE,KAAKyC,sBAAL,CAA4BhZ,QAA5B,KAAyC,GADnD;CAECiZ,cAAAA,aAAa,EAAE;CAACC,gBAAAA,KAAK,EAAE;CAACC,kBAAAA,SAAS,EAAE;CAAZ;CAAR,eAFhB;CAGCC,cAAAA,iBAAiB,EAAE;CAACxc,gBAAAA,KAAK,EAAE;CAACyc,kBAAAA,UAAU,EAAE;CAAb;CAAR,eAHpB;CAICC,cAAAA,QAAQ,EAAE,KAAKN,sBAAL,CAA4BO,SAA5B,GAAwCC,aAAxC;CAJX,aADU,CAAX;CASAT,YAAAA,QAAQ,CAACrC,OAAT,GAAoB,KAAKd,MAAL,IAAe,KAAKA,MAAL,CAAY6D,UAAZ,EAAhB,IACf,KAAKT,sBAAL,CAA4BU,YAA5B,EADJ;;CAGA,iBAAKV,sBAAL,CAA4BW,iBAA5B,CAA8CZ,QAA9C;;CACA,iBAAKC,sBAAL,CAA4BY,QAA5B,CAAqCb,QAAQ,CAACc,WAA9C;;CAEA,iBAAKb,sBAAL,CAA4Bc,UAA5B,CAAuCf,QAAQ,CAACrC,OAAhD;;CACA,iBAAKsC,sBAAL,CAA4Be,MAA5B;CACA,WAnBD,MAqBA;CACChB,YAAAA,QAAQ,GAAG,KAAKzC,YAAL,CAAkB;CAACC,cAAAA,OAAO,EAAEvb,EAAE,CAAC4Y,OAAH,CAAW,oCAAX;CAAV,aAAlB,CAAX;CACAmF,YAAAA,QAAQ,CAACrC,OAAT,GAAmB,KAAKd,MAAL,IAAe,KAAKA,MAAL,CAAY6D,UAAZ,EAAlC;CACA;CACD;CACD;;CAED,aAAOV,QAAP;CACA;;;gDAGD;CACC,UAAIA,QAAQ,GAAG,IAAf;;CACA,UAAI,KAAKxD,OAAL,KAAiB,UAAjB,IAA+B,KAAKA,OAAL,KAAiB,eAApD,EACA;CACCwD,QAAAA,QAAQ,GAAG,KAAKzC,YAAL,CAAkB;CAACC,UAAAA,OAAO,EAAEvb,EAAE,CAAC4Y,OAAH,CAAW,iCAAX;CAAV,SAAlB,CAAX;CACAmF,QAAAA,QAAQ,CAACrC,OAAT,GAAmB,KAAKd,MAAL,IAAe,KAAKA,MAAL,CAAYoE,aAAZ,EAAlC;CACA;;CACD,aAAOjB,QAAP;CACA;;;4BApOa/e,IAAIC,UAClB;CACC,UAAMkb,IAAI,GAAG,IAAI,IAAJ,EAAb;CACAA,MAAAA,IAAI,CAAC/V,UAAL,CAAgBpF,EAAhB,EAAoBC,QAApB;CACA,aAAOkb,IAAP;CACA;;;GAPiDna,EAAE,CAACkF,EAAH,CAAM+Z;;KCCpC0B;;;;;;;;;;;;6CAEIjhB,QAAQsR,QAChC;CACC,UAAI,CAAC9R,cAAI,CAAC8Y,aAAL,CAAmBtY,MAAnB,CAAL,EACA;CACC,cAAM,sEAAN;CACA;;CAED,aAAO,KAAK0f,0BAAL,CAAgC1f,MAAhC,EAAwCsR,MAAxC,CAAP;CACA;;;gDAE0BtR,QAAQsR,QACnC;CACC,UAAIW,MAAM,GAAG,EAAb;CACA,UAAMiP,KAAK,GAAG5gB,EAAE,CAACqY,IAAH,CAAQgH,GAAR,CAAY3f,MAAZ,EAAoB,OAApB,EAA6B,IAA7B,CAAd;;CACA,UAAIkhB,KAAJ,EACA;CACCjP,QAAAA,MAAM,GAAGiP,KAAK,CAAC/M,OAAN,EAAT;CACA+M,QAAAA,KAAK,CAACtB,UAAN,CAAiB,KAAjB;;CAEA,YAAI,CAACtf,EAAE,CAACqY,IAAH,CAAQgH,GAAR,CAAYuB,KAAK,CAAChR,gBAAN,GAAyBjH,OAAzB,EAAZ,EAAgD,mBAAhD,EAAqE,KAArE,CAAL,EACA;CACC,iBAAO,KAAK4W,kBAAL,GAA0Bvf,EAAE,CAACkF,EAAH,CAAM+Z,6BAAN,CAAoCtO,MAApC,CAChC,EADgC,EAEhC;CACC6O,YAAAA,MAAM,EAAE,KAAKhT,OADd;CAECmD,YAAAA,aAAa,EAAE,IAFhB;CAGClB,YAAAA,KAAK,EAAEuC,MAAM,CAAC9F,MAHf;CAICnF,YAAAA,IAAI,EAAE/F,EAAE,CAACkF,EAAH,CAAMC,gBAAN,CAAuBC,IAJ9B;CAKC4L,YAAAA,MAAM,EAAEA,MALT;CAMCW,YAAAA,MAAM,EAAEA,MANT;CAOC3E,YAAAA,KAAK,EAAE4T,KAPR;CAQCnB,YAAAA,qBAAqB,EAAE;CARxB,WAFgC,CAAjC;CAaA;CACD,OArBD,MAuBA;CACC9N,QAAAA,MAAM,GAAG3R,EAAE,CAACqY,IAAH,CAAQgH,GAAR,CAAY3f,MAAZ,EAAoB,QAApB,EAA8BM,EAAE,CAACkF,EAAH,CAAMwa,mBAAN,CAA0BC,MAAxD,CAAT;CACA;;CAED,WAAKJ,kBAAL,GAA0Be,qBAAqB,CAAC3P,MAAtB,CACzB,EADyB,EAEzB;CACC6O,QAAAA,MAAM,EAAE,KAAKhT,OADd;CAECmD,QAAAA,aAAa,EAAE,IAFhB;CAGClB,QAAAA,KAAK,EAAEuC,MAAM,CAAC9F,MAHf;CAICnF,QAAAA,IAAI,EAAE/F,EAAE,CAACkF,EAAH,CAAMC,gBAAN,CAAuBC,IAJ9B;CAKC4L,QAAAA,MAAM,EAAEA,MALT;CAMCW,QAAAA,MAAM,EAAEA,MANT;CAOC3E,QAAAA,KAAK,EAAE4T,KAPR;CAQCnB,QAAAA,qBAAqB,EAAE;CARxB,OAFyB,CAA1B;CAcA,aAAO,KAAKF,kBAAZ;CACA;;;0CAGD;CACC,aAAO,KAAP;CACA;;;yCAGD;CACC,aAAO,KAAP;CACA;;;qCAEe5N,QAChB;CACC,aAAO,IAAP;CACA;;;wCAEkBA,QACnB;CACC,UAAMzH,QAAQ,GAAG,KAAK2W,YAAL,GAAoB1W,MAApB,CAA2B,UAACrG,IAAD,EAAU;CACrD,eAAOA,IAAI,CAAC2F,IAAL,KAAckI,MAArB;CACA,OAFgB,CAAjB;;CAGA,UAAIzH,QAAQ,CAACG,MAAT,GAAkB,CAAtB,EACA;CACC,eAAO,KAAKuV,eAAL,CAAqBpI,OAArB,CAA6B,iBAA7B,EAAgD7F,MAAhD,CAAP;CACA;CACD;;;yCAEmBA,QACpB;CAAA;;CACC,UAAMmP,UAAU,GAAG,SAAbA,UAAa;CAAA,eAAM,KAAI,CAACC,sBAAL,CAA4B,KAAI,CAACf,kBAAL,CAAwBrO,MAAxB,CAA5B,CAAN;CAAA,OAAnB;;CACA,UAAMqP,qBAAqB,GAAGzL,oBAAU,CAACC,QAAX,CAAoB,mCAApB,CAA9B;;CAEA,UAAIwL,qBAAJ,EACA;CACCA,QAAAA,qBAAqB,CAACC,iBAAtB,CAAwCH,UAAxC,EAAoD,IAApD,EAA0D;CACzDlI,UAAAA,OAAO,EAAEjO,aAAG,CAACC,UAAJ,CAAe,0CAAf;CADgD,SAA1D;CAGA,OALD,MAOA;CACCkW,QAAAA,UAAU;CACV;CACD;;;4CAEsB5gB,KACvB;CACC,UAAIhB,cAAI,CAACC,cAAL,CAAoBe,GAApB,CAAJ,EACA;CACCF,QAAAA,EAAE,CAAC6f,SAAH,CAAaC,QAAb,CAAsBC,IAAtB,CAA2B7f,GAA3B,EAAgC;CAC/B+B,UAAAA,KAAK,EAAE,GADwB;CAE/Bge,UAAAA,kBAAkB,EAAE,KAFW;CAG/BC,UAAAA,SAAS,EAAE;CAHoB,SAAhC;CAKA;CACD;;;wCAEkBhgB,KACnB;CACC,aAAO,KAAK0f,eAAL,GAAuB1f,GAA9B;CACA;;;oCAGD;CACC,aAAO,CACN;CACCuJ,QAAAA,IAAI,EAAE,MADP;CAEC0W,QAAAA,KAAK,EAAEngB,EAAE,CAAC4Y,OAAH,CAAW,gCAAX,CAFR;CAGCwH,QAAAA,MAAM,EAAEpgB,EAAE,CAAC4Y,OAAH,CAAW,iCAAX;CAHT,OADM,EAMN;CACCnP,QAAAA,IAAI,EAAE,WADP;CAEC0W,QAAAA,KAAK,EAAEngB,EAAE,CAAC4Y,OAAH,CAAW,sCAAX,CAFR;CAGCwH,QAAAA,MAAM,EAAEpgB,EAAE,CAAC4Y,OAAH,CAAW,uCAAX;CAHT,OANM,CAAP;CAYA;;;4BAEa5Z,IAAIC,UAClB;CACC,UAAMkb,IAAI,GAAG,IAAI,IAAJ,EAAb;CACAA,MAAAA,IAAI,CAAC/V,UAAL,CAAgBpF,EAAhB,EAAoBC,QAApB;CACA,aAAOkb,IAAP;CACA;;;GA7IyDna,EAAE,CAACkF,EAAH,CAAMmb;;;;;;;;;;;KCQpDa,UAAb;CAAA;CAAA;CAIC,sBAAYliB,EAAZ,EACA;CAAA,QADgBC,QAChB,uEAD2B,EAC3B;CAAA;CAAA,yDAHkB,IAGlB;CACC,SAAKD,EAAL,GAAUE,cAAI,CAACC,cAAL,CAAoBH,EAApB,IAA0BA,EAA1B,GAA+BI,cAAI,CAACC,SAAL,EAAzC;CACA,SAAKJ,QAAL,GAAgBA,QAAhB;CACA,SAAKkiB,YAAL,GAAoBliB,QAAQ,CAACkiB,YAAT,IAAyB,EAA7C;CACA,SAAKC,WAAL,GAAmBniB,QAAQ,CAACmiB,WAAT,IAAwB,EAA3C;CAEA,SAAKC,QAAL,GAAgBjiB,cAAI,CAACkiB,SAAL,CAAeriB,QAAQ,CAACoiB,QAAxB,KAAqC,CAArD;CACA,SAAK9hB,SAAL,GAAiBgiB,QAAQ,CAACC,cAAT,CAAwBviB,QAAQ,CAACwiB,WAAjC,CAAjB;CAEA,SAAKC,aAAL,GAAqBziB,QAAQ,CAACyiB,aAAT,IAA0B,IAA/C;CACA,SAAKC,qBAAL,GAA6B1iB,QAAQ,CAAC0iB,qBAAT,IAAkC,IAA/D;CAEA,SAAKC,eAAL,GAAuB3iB,QAAQ,CAAC2iB,eAAT,IAA4B,KAAnD;CAEA,SAAKC,oBAAL;CACA,SAAKC,gBAAL;CACA,SAAKC,qBAAL;CACA,SAAKC,0BAAL;CACA,SAAKC,cAAL;CACA;;CAxBF;CAAA;CAAA,oCA2BC;CACC,aAAO,QAAP;CACA;CA7BF;CAAA;CAAA,mCA+BgBjjB,EA/BhB,EAgCC;CACC,aAAO,KAAKmiB,YAAL,CAAkBhX,MAAlB,CAAyB,UAAArG,IAAI,EAAI;CACvC,eAAOA,IAAI,CAAC9E,EAAL,KAAYA,EAAnB;CACA,OAFM,EAEJ,CAFI,CAAP;CAGA;CApCF;CAAA;CAAA,yCAsCsBA,EAtCtB,EAuCC;CACC,UAAMkjB,WAAW,GAAG,KAAKC,cAAL,CAAoBnjB,EAApB,CAApB;CAEA,aAAOkjB,WAAW,IAAIA,WAAW,CAACxG,OAAlC;CACA;CA3CF;CAAA;CAAA,2CA8CC;CACC,aAAO,IAAI0G,OAAJ,CAAe,KAAKpjB,EAApB,EAAwB;CAC9BO,QAAAA,SAAS,EAAEgiB,QAAQ,CAACC,cAAT,CAAwB,KAAKviB,QAAL,CAAcojB,cAAtC,CADmB;CAE9BvhB,QAAAA,aAAa,EAAEygB,QAAQ,CAACC,cAAT,CAAwB,KAAKviB,QAAL,CAAcqjB,kBAAtC,CAFe;CAG9BjiB,QAAAA,IAAI,EAAE,KAAKpB,QAAL,CAAcsjB,IAAd,IAAsB;CAHE,OAAxB,CAAP;CAKA;CApDF;CAAA;CAAA,uCAuDC;CACC,UAAI,KAAKlB,QAAL,IAAiB,CAArB,EACA;CACC,aAAKmB,OAAL,GAAe7c,aAAG,CAACC,MAAnB;CACAnE,QAAAA,aAAG,CAACqQ,MAAJ,CAAW,KAAK0Q,OAAhB,EAAyB,KAAKjjB,SAA9B;;CAEA,YAAI4D,MAAM,KAAKA,MAAM,CAACpB,GAAtB,EACA;CACC,eAAKygB,OAAL,CAAa5gB,KAAb,CAAmBE,QAAnB,GAA8B,UAA9B;CACA,eAAK0gB,OAAL,CAAa5gB,KAAb,CAAmBG,GAAnB,GAAyB,KAAKygB,OAAL,CAAa5gB,KAAb,CAAmBI,IAAnB,GAA0B,KAAKwgB,OAAL,CAAa5gB,KAAb,CAAmB6gB,KAAnB,GAA2B,OAA9E;CACA;CACD;CACD;CAnEF;CAAA;CAAA,4CAsEC;CACC,aAAO,IAAI5W,aAAJ,EAAP;CACA;CAxEF;CAAA;CAAA,iDA2EC;CACC,aAAO,IAAIqM,kBAAJ,EAAP;CACA;CA7EF;CAAA;CAAA,qCAgFC;CACCjV,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,+CAAvB,EAAwE,KAAKob,0BAAL,CAAgCliB,IAAhC,CAAqC,IAArC,CAAxE;CACAyC,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,6BAAvB,EAAsD,KAAKqb,sBAAL,CAA4BniB,IAA5B,CAAiC,IAAjC,CAAtD;CACAyC,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,2BAAvB,EAAoD,KAAKsb,mBAAL,CAAyBpiB,IAAzB,CAA8B,IAA9B,CAApD;CAEAyC,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,iCAAvB,EAA0D,KAAKub,kBAAL,CAAwBriB,IAAxB,CAA6B,IAA7B,CAA1D;CACAyC,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,gBAAvB,EAAyC,KAAKwb,qBAAL,CAA2BtiB,IAA3B,CAAgC,IAAhC,CAAzC;CACAyC,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,gBAAvB,EAAyC,KAAKyb,qBAAL,CAA2BviB,IAA3B,CAAgC,IAAhC,CAAzC;CAEAyC,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,eAAvB,EAAwC,KAAK0b,oBAAL,CAA0BxiB,IAA1B,CAA+B,IAA/B,CAAxC;CACAyC,MAAAA,6BAAY,CAACqE,SAAb,CAAuB,uBAAvB,EAAgD,KAAK2b,wBAAL,CAA8BziB,IAA9B,CAAmC,IAAnC,CAAhD;CACA;CA3FF;CAAA;CAAA,yCA6FsB6C,KA7FtB,EA8FC;CACC,UAAMmc,MAAM,GAAG,KAAK0D,iBAAL,EAAf;;CACA,UAAI,CAAC1D,MAAL,EACA;CACC;CACA;;CALF,iCAOwBnc,KAAK,CAACyI,aAAN,EAPxB;CAAA;CAAA,UAOYqX,QAPZ;;CAQC,UAAIA,QAAQ,IAAIjkB,cAAI,CAACkkB,SAAL,CAAeD,QAAQ,CAACE,SAAxB,CAAhB,EACA;CACC,YAAMrS,MAAM,GAAGmS,QAAQ,CAACE,SAAT,CAAmBC,OAAnB,CAA2B,YAA3B,CAAf;;CAEA,YAAIpkB,cAAI,CAACkkB,SAAL,CAAepS,MAAf,CAAJ,EACA;CACC,cAAMuS,WAAW,GAAGvS,MAAM,CAACwS,YAAP,CAAoB,UAApB,CAApB;CACA,cAAMzU,OAAO,GAAGyQ,MAAM,CAACxL,uBAAP,CAA+BuP,WAA/B,CAAhB;;CAEA,cAAIxU,OAAJ,EACA;CACCA,YAAAA,OAAO,CAAC/G,aAAR;CACA;CACD;CACD;CACD;CArHF;CAAA;CAAA,6CAuH0B3E,KAvH1B,EAwHC;CAAA,kCACiBA,KAAK,CAACyI,aAAN,EADjB;CAAA;CAAA,UACQhD,KADR;;CAEC,UAAIA,KAAK,IAAIA,KAAK,CAAC4G,KAAN,OAAkB,SAA3B,IAAwC5G,KAAK,CAAC2a,WAAlD,EACA;CACC,aAAKC,gBAAL,CAAsB/Y,aAAG,CAACC,UAAJ,CAAe,6CAAf,CAAtB,EAAqF;CACpF+Y,UAAAA,aAAa,EAAE;CADqE,SAArF;CAGA;CACD;CAhIF;CAAA;CAAA,wCAkIqBtgB,KAlIrB,EAmIC;CAAA,kCAC0BA,KAAK,CAACyI,aAAN,EAD1B;CAAA;CAAA,UACQ0T,MADR;CAAA,UACgB5R,MADhB;;CAGC,UAAI4R,MAAM,IAAI,CAAC5R,MAAM,CAACyT,QAAtB,EACA;CACC,YAAMtS,OAAO,GAAGyQ,MAAM,CAACxL,uBAAP,CAA+B,MAA/B,CAAhB;;CAEA,YAAIjF,OAAJ,EACA;CACC6U,UAAAA,qBAAqB,CAAC,YAAM;CAC3B7U,YAAAA,OAAO,CAAC6N,KAAR;CACA,WAFoB,CAArB;CAGA;CACD;CACD;CAED;;;;CAnJD;CAAA;CAAA,wCAuJC;CACC,UAAIrH,oBAAU,CAACC,QAAX,CAAoB,oBAApB,CAAJ,EACA;CACC,eAAOxV,EAAE,CAACkF,EAAH,CAAM2e,YAAN,CAAmBC,UAAnB,EAAP;CACA;;CAED,aAAO,IAAP;CACA;CA9JF;CAAA;CAAA,uCAgKoBzgB,KAhKpB,EAiKC;CAAA,kCAC4BA,KAAK,CAACyI,aAAN,EAD5B;CAAA;CAAA,UACQ8B,MADR;CAAA,UACgBnH,QADhB;;CAGC,UAAM0Z,KAAK,GAAGvS,MAAM,CAAC0D,IAAP,IAAe,EAA7B;CACA,WAAKyS,eAAL,CAAqB5D,KAArB;;CAEA,UAAI1Z,QAAQ,CAACpG,IAAb,EACA;CACC,YAAInB,cAAI,CAAC8B,SAAL,CAAeyF,QAAQ,CAACpG,IAAT,CAAc2jB,iBAA7B,CAAJ,EACA;CACC,eAAKpC,eAAL,GAAuBnb,QAAQ,CAACpG,IAAT,CAAc2jB,iBAArC;CACA;CACD;;CAED,UAAIvd,QAAQ,CAACwd,MAAT,KAAoB,SAAxB,EACA;CACC,aAAKtB,sBAAL;CACA;CACD;CAnLF;CAAA;CAAA,0CAqLuBtf,KArLvB,EAsLC;CAAA,kCACgBA,KAAK,CAACyI,aAAN,EADhB;CAAA;CAAA,UACQzL,IADR;;CAEC,WAAK6jB,iBAAL,CAAuB,UAAvB,EAAmC7jB,IAAnC;CACA;CAzLF;CAAA;CAAA,0CA2LuBgD,KA3LvB,EA4LC;CAAA,mCACgBA,KAAK,CAACyI,aAAN,EADhB;CAAA;CAAA,UACQzL,IADR;;CAEC,WAAK6jB,iBAAL,CAAuB,UAAvB,EAAmC7jB,IAAnC;CACA;CA/LF;CAAA;CAAA,sCAiMmB8jB,MAjMnB,EAiM2BvW,MAjM3B,EAkMC;CACC5N,MAAAA,EAAE,CAAC6f,SAAH,CAAaC,QAAb,CAAsBsE,WAAtB,CACCjhB,MADD,oBAEY,KAAKkhB,aAAL,EAFZ,mBAEyCF,MAFzC,GAGCvW,MAHD;CAKA;CAxMF;CAAA;CAAA,oCA0MiBuS,KA1MjB,EA2MC;CACC,UAAMmE,SAAS,GAAG/C,QAAQ,CAACC,cAAT,CAAwB,WAAxB,CAAlB;;CAEA,UAAItiB,cAAI,CAACkkB,SAAL,CAAekB,SAAf,CAAJ,EACA;CACCA,QAAAA,SAAS,CAACC,SAAV,GAAsBpE,KAAtB;CACA;;CAEDoB,MAAAA,QAAQ,CAACpB,KAAT,GAAiBA,KAAjB;;CAEA,UAAIngB,EAAE,CAACwV,QAAH,CAAY,0CAAZ,CAAJ,EACA;CACCxV,QAAAA,EAAE,CAAC6f,SAAH,CAAaC,QAAb,CAAsB0E,kBAAtB;CACA;CACD;CAzNF;CAAA;CAAA,6CA4NC;CACCjD,MAAAA,QAAQ,CAACkD,gBAAT,CAA0B,2BAA1B,EACE5gB,OADF,CACU,UAAA6D,KAAK,EAAI;CACjB,YAAI+B,IAAI,GAAG/B,KAAK,CAAC8b,YAAN,CAAmB,MAAnB,CAAX;CACA,YAAIkB,WAAW,GAAGnD,QAAQ,CAACpgB,aAAT,6BAA2CsI,IAA3C,aAAlB;;CAEA,YAAIib,WAAJ,EACA;CACCjjB,UAAAA,aAAG,CAACoY,MAAJ,CAAWnS,KAAX;CACAjG,UAAAA,aAAG,CAACoY,MAAJ,CAAW6K,WAAX;CACA;CACD,OAVF;CAWA;CAxOF;CAAA;CAAA,+CA0O4BrhB,KA1O5B,EA2OC;CAAA,mCACuBA,KAAK,CAACyI,aAAN,EADvB;CAAA;CAAA,UACUC,SADV;;CAGC,UAAI,CAACA,SAAS,CAACzC,IAAX,IAAmByC,SAAS,CAACzC,IAAV,KAAmB,QAA1C,EACA;CACCyC,QAAAA,SAAS,CAAC4Y,yBAAV,GAAsC,KAAKC,yCAAL,CAA+C7Y,SAA/C,CAAtC;CACA;;CAED,UAAIA,SAAS,CAAC/M,EAAV,KAAiB,gBAArB,EACA;CACC+M,QAAAA,SAAS,CAAC4Y,yBAAV,GAAsC,KAAKE,+CAAL,CAAqD9Y,SAArD,CAAtC;CACA;CACD;CAvPF;CAAA;CAAA,8DAyP2CA,SAzP3C,EA0PC;CACC,UAAM+Y,oBAAoB,GAAG3F,+BAA+B,CAACxO,MAAhC,CAAuC,KAAK3R,EAA5C,EAAgD+M,SAAhD,CAA7B;CACA+Y,MAAAA,oBAAoB,CAACC,kBAArB,CAAwC,KAAK9lB,QAAL,CAAc+lB,mBAAtD;CAEA,aAAOF,oBAAP;CACA;CA/PF;CAAA;CAAA,oEAiQiD/Y,SAjQjD,EAkQC;CACC,UAAM+Y,oBAAoB,GAAGnE,6BAA6B,CAAChQ,MAA9B,CAAqC,KAAK3R,EAA1C,EAA8C+M,SAA9C,CAA7B;CACA+Y,MAAAA,oBAAoB,CAACC,kBAArB,CAAwC,KAAK9lB,QAAL,CAAcgmB,4BAAtD;CAEA,aAAOH,oBAAP;CACA;CAvQF;CAAA;CAAA,qCAyQkBja,OAzQlB,EAyQ2BtG,OAzQ3B,EA0QC;CACCA,MAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;;CAEA,UAAIvE,EAAE,CAACklB,kBAAH,GAAwBC,SAAxB,IAAqC,EAAzC,EACA;CACC5gB,QAAAA,OAAO,CAAC6gB,KAAR,GAAgB,KAAKC,kBAAL,EAAhB;CACA;;CAEDrlB,MAAAA,EAAE,CAACkF,EAAH,CAAMogB,YAAN,CAAmBC,MAAnB,CAA0BC,MAA1B,CAAiC;CAChC3a,QAAAA,OAAO,EAAEA,OADuB;CAEhCua,QAAAA,KAAK,EAAE7gB,OAAO,CAAC6gB,KAAR,IAAiB,IAFQ;CAGhCtjB,QAAAA,QAAQ,EAAE,WAHsB;CAIhCG,QAAAA,KAAK,EAAE,MAJyB;CAKhCwjB,QAAAA,QAAQ,EAAElhB,OAAO,CAACkhB,QAAR,IAAoB,IALE;CAMhC9B,QAAAA,aAAa,EAAEpf,OAAO,CAACof,aAAR,IAAyB;CANR,OAAjC;CAQA;CA1RF;CAAA;CAAA,yCA6RC;CACC,UAAI,KAAK+B,eAAL,KAAyB,IAA7B,EACA;CACC,aAAKA,eAAL,GAAuB,IAAI1lB,EAAE,CAACkF,EAAH,CAAMogB,YAAN,CAAmBK,KAAvB,CAA6B3lB,EAAE,CAAC4lB,OAAH,CACnD,EADmD,EAEnD5lB,EAAE,CAACkF,EAAH,CAAMogB,YAAN,CAAmBC,MAAnB,CAA0BM,gBAA1B,EAFmD,EAGnD;CACC7mB,UAAAA,EAAE,EAAE,uBADL;CAEC8C,UAAAA,QAAQ,EAAE,uBAFX;CAGCgkB,UAAAA,OAAO,EAAE;CAHV,SAHmD,CAA7B,CAAvB;CASA;;CAED,aAAO,KAAKJ,eAAZ;CACA;CA5SF;CAAA;CAAA,wCA+SC;CACC,UAAI,CAACnQ,oBAAU,CAACC,QAAX,CAAoB,uBAApB,CAAD,IAAiD,CAACtW,cAAI,CAACC,cAAL,CAAoB,KAAKiiB,WAAzB,CAAtD,EACA;CACC;CACA;;CAEDphB,MAAAA,EAAE,CAAC6f,SAAH,CAAaC,QAAb,CAAsBC,IAAtB,CAA2B,KAAKqB,WAAhC,EAA6C;CAC5ClB,QAAAA,SAAS,EAAE,KADiC;CAE5CD,QAAAA,kBAAkB,EAAE,KAFwB;CAG5Che,QAAAA,KAAK,EAAE;CAHqC,OAA7C;CAKA;CA1TF;CAAA;CAAA;;;;;;;;"}