{"version":3,"file":"entity-card.bundle.js","sources":["../src/iblock-section/field.js","../src/name-code/field.js","../src/fields-factory.js","../src/iblock-section/controller.js","../src/variation-grid/controller.js","../src/variation-link/controller.js","../src/google-map/controller.js","../src/employee/controller.js","../src/user/controller.js","../src/iblock-element/controller.js","../src/binding-to-crm-element/controller.js","../src/field-configurator/controller.js","../src/product-service-grid/controller.js","../src/controllers-factory.js","../src/field-configurator/iblock-directory-field-item.js","../src/field-configurator/iblock-field-configurator.js","../src/field-configurator/iblock-field-configuration-manager.js","../src/field-configurator/grid-field-configurator.js","../src/field-configurator/grid-field-configuration-manager.js","../src/tab/lazy-loader.js","../src/tab/tab.js","../src/tab/manager.js","../src/base-card/base-card.js","../src/entity-card.js"],"sourcesContent":["import 'ui.design-tokens';\nimport './field.css'\nimport {ajax, Dom, Event, Loc, Runtime, Tag, Text, Type} from 'main.core'\nimport {type BaseEvent, EventEmitter} from 'main.core.events'\n\nexport default class IblockSectionField extends BX.UI.EntityEditorField\n{\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\n\t\tthis.innerWrapper = null;\n\t}\n\n\tgetContentWrapper()\n\t{\n\t\treturn this.innerWrapper;\n\t}\n\n\tlayout(options = {})\n\t{\n\t\tif (this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ensureWrapperCreated({classNames: ['catalog-entity-editor-content-block-field-iblock-section']});\n\t\tthis.adjustWrapper();\n\n\t\tif (this.isNeedToDisplay())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createTitleNode(this.getTitle()));\n\n\t\t\tif (this._mode === BX.UI.EntityEditorMode.edit)\n\t\t\t{\n\t\t\t\tthis.drawEditMode();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.drawViewMode();\n\t\t\t}\n\n\t\t\tif (this.isContextMenuEnabled())\n\t\t\t{\n\t\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\n\t\t\t}\n\t\t}\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\tdrawEditMode()\n\t{\n\t\tthis.defaultInput = Tag.render`<input type=\"hidden\" name=\"${this.getName()}[]\" value=\"0\">`;\n\t\tthis._wrapper.appendChild(this.defaultInput);\n\n\t\tthis.innerWrapper = Tag.render`<div class=\"ui-entity-editor-content-block\"></div>`;\n\t\tthis._wrapper.appendChild(this.innerWrapper);\n\n\t\tajax.runComponentAction(\n\t\t\t'bitrix:catalog.productcard.iblocksectionfield',\n\t\t\t'lazyLoad',\n\t\t\t{\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: {\n\t\t\t\t\tiblockId: this.getIblockId(),\n\t\t\t\t\tproductId: this.getProductId(),\n\t\t\t\t\tselectedSectionIds: this.getValue()\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(this.renderFromResponse.bind(this))\n\t\t\t.catch(response => {\n\t\t\t\tthrow new Error(response.errors.join(\"\\n\"));\n\t\t\t})\n\t\t;\n\t}\n\n\trenderFromResponse(response)\n\t{\n\t\tif (!this._wrapper)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tRuntime.html(this.innerWrapper, response.data.html, {\n\t\t\tcallback: this.initEntitySelector.bind(this)\n\t\t});\n\t}\n\n\tinitEntitySelector()\n\t{\n\t\tEventEmitter.subscribe(EventEmitter.GLOBAL_TARGET, 'Item:onSelect', this.markAsChanged.bind(this));\n\t\tEventEmitter.subscribe(EventEmitter.GLOBAL_TARGET, 'Item:onDeselect', this.markAsChanged.bind(this));\n\t}\n\n\tchangeDisplay(node, isShow)\n\t{\n\t\tif (!node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnode.style.display = isShow ? '' : 'none';\n\t}\n\n\tmarkAsChanged(event: BaseEvent)\n\t{\n\t\tsuper.markAsChanged();\n\t\tEventEmitter.emit(this.getEditor(), 'IblockSectionField:onChange', [this, ...event.getData()]);\n\t}\n\n\tdrawViewMode()\n\t{\n\t\tif (this.hasNoSections())\n\t\t{\n\t\t\tthis.innerWrapper = Tag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t\t${Loc.getMessage(\"CATALOG_ENTITY_CARD_EMPTY_SECTION\")}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tDom.addClass(this._wrapper, 'ui-entity-editor-content-block-click-empty');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst content = [];\n\t\t\tthis.getSections().forEach((section) => {\n\t\t\t\t// ui-tile-selector-item-%type%\n\t\t\t\tlet picture = '';\n\t\t\t\tif (Type.isStringFilled(section.PICTURE))\n\t\t\t\t{\n\t\t\t\t\tpicture = Tag.render`<span class=\"ui-tile-selector-item-picture\" style=\"background-image: url('${Text.encode(section.PICTURE)}');\"></span>`;\n\t\t\t\t}\n\t\t\t\tcontent.push(Tag.render`\n\t\t\t\t\t<span class=\"ui-tile-selector-item ui-tile-selector-item-readonly-yes\">\n\t\t\t\t\t\t${picture}\n\t\t\t\t\t\t<span data-role=\"tile-item-name\">${Text.encode(section.NAME)}</span>\n\t\t\t\t\t</span>\n\t\t\t\t`)\n\t\t\t});\n\t\t\tthis.innerWrapper = Tag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t\t<span class=\"ui-tile-selector-selector-wrap readonly\">\n\t\t\t\t\t\t${content}\n\t\t\t\t\t</span>\n\t\t\t\t</div>`\n\t\t\t;\n\t\t}\n\n\t\tthis._wrapper.appendChild(this.innerWrapper);\n\t}\n\n\tgetSections()\n\t{\n\t\treturn this._model.getField('IBLOCK_SECTION_DATA', {});\n\t}\n\n\tgetIblockId()\n\t{\n\t\treturn this._model.getField('IBLOCK_ID', 0);\n\t}\n\n\tgetProductId()\n\t{\n\t\treturn this._model.getField('ID', 0);\n\t}\n\n\thasNoSections()\n\t{\n\t\tconst sectionIds = this.getValue();\n\n\t\treturn sectionIds.length === 0\n\t\t\t|| (\n\t\t\t\tsectionIds.length === 1\n\t\t\t\t&& (sectionIds.includes('0') || sectionIds.includes(0))\n\t\t\t);\n\t}\n\n\tdoClearLayout(options)\n\t{\n\t\tif (this.defaultInput)\n\t\t{\n\t\t\tDom.clean(this.defaultInput);\n\t\t\tthis.defaultInput = null;\n\t\t}\n\n\t\tif (this.innerWrapper)\n\t\t{\n\t\t\tDom.clean(this.innerWrapper);\n\t\t\tthis.innerWrapper = null;\n\t\t}\n\n\t\tthis._hasLayout = false;\n\t}\n\n\tgetModeSwitchType(mode)\n\t{\n\t\tlet result = BX.UI.EntityEditorModeSwitchType.common;\n\n\t\tif (mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tresult |= BX.UI.EntityEditorModeSwitchType.button | BX.UI.EntityEditorModeSwitchType.content;\n\t\t}\n\n\t\treturn result;\n\t}\n}","import {Loc, Dom, Tag, Event} from 'main.core';\nimport 'translit';\nimport './field.css';\n\nexport default class NameCodeField extends BX.UI.EntityEditorMultiText\n{\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\t\tthis.isShownSymbolicCode = this.getSchemeShowCodeState() === 'true';\n\t\tthis.allowToGenerateCode = this._editor.isNew();\n\t}\n\n\tgetSchemeShowCodeState()\n\t{\n\t\treturn BX.prop.get(this.getSchemeElement()._options, 'showCode');\n\t}\n\n\tsetSchemeShowCodeState(state)\n\t{\n\t\tthis.getSchemeElement()._options['showCode'] = state;\n\t}\n\n\tgetValue = function()\n\t{\n\t\treturn BX.UI.EntityEditorBoolean.superclass.getValue.apply(this);\n\t}\n\n\thasContentToDisplay = function()\n\t{\n\t\treturn true;\n\t}\n\n\tdoPrepareContextMenuItems = function(menuItems)\n\t{\n\t\tif (this.isShownSymbolicCode)\n\t\t{\n\t\t\tmenuItems.push(\n\t\t\t\t{\n\t\t\t\t\tvalue: 'hide_symbolic_code',\n\t\t\t\t\ttext: Loc.getMessage('CATALOG_ENTITY_CARD_HIDE_SYMBOLIC_CODE'),\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmenuItems.push(\n\t\t\t\t{\n\t\t\t\t\tvalue: 'show_symbolic_code',\n\t\t\t\t\ttext: Loc.getMessage('CATALOG_ENTITY_CARD_SHOW_SYMBOLIC_CODE'),\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tprocessContextMenuCommand(e, command)\n\t{\n\t\tsuper.processContextMenuCommand(e, command);\n\n\t\tconst codeContainerElement = document.getElementById('code_container');\n\t\tconst nameCodeMarkerElement = document.getElementById('name_code_marker');\n\n\t\tif (command === 'hide_symbolic_code')\n\t\t{\n\t\t\tthis.isShownSymbolicCode = false;\n\t\t\tthis.allowToGenerateCode = this._editor.isNew();\n\n\t\t\tif(this._mode === BX.UI.EntityEditorMode.edit)\n\t\t\t{\n\t\t\t\tconst codeTextElement = document.getElementById('code_text');\n\t\t\t\tconst codeStateButtonElement = document.getElementById('code_state_button');\n\t\t\t\tcodeTextElement.readOnly = this.allowToGenerateCode;\n\t\t\t\tif (this.allowToGenerateCode)\n\t\t\t\t{\n\t\t\t\t\tcodeTextElement.className = 'ui-ctl-element ui-ctl-element-symbol-code-input-disabled';\n\t\t\t\t\tcodeStateButtonElement.className = 'ui-ctl-before ui-ctl-icon-chain';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcodeTextElement.className = 'ui-ctl-element';\n\t\t\t\t\tcodeStateButtonElement.className = 'ui-ctl-before ui-ctl-icon-unchain';\n\t\t\t\t}\n\t\t\t\tcodeContainerElement.className = 'name-code-container name-code-container-hidden';\n\n\t\t\t\tDom.removeClass(this._innerWrapper, 'ui-entity-editor-content-block--code');\n\t\t\t\tDom.addClass(this._innerWrapper, 'ui-entity-editor-content-block--no-code');\n\t\t\t\tnameCodeMarkerElement.style.display = 'inline';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.refreshLayout();\n\t\t\t}\n\t\t\tthis.setSchemeShowCodeState(false);\n\t\t\tthis._parent.processChildControlSchemeChange(this);\n\t\t}\n\t\telse if (command === 'show_symbolic_code')\n\t\t{\n\t\t\tthis.isShownSymbolicCode = true;\n\t\t\tif(this._mode === BX.UI.EntityEditorMode.edit)\n\t\t\t{\n\t\t\t\tcodeContainerElement.className = 'name-code-container';\n\t\t\t\tDom.removeClass(this._innerWrapper, 'ui-entity-editor-content-block--no-code');\n\t\t\t\tDom.addClass(this._innerWrapper, 'ui-entity-editor-content-block--code');\n\t\t\t\tnameCodeMarkerElement.style.display = 'none';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.refreshLayout();\n\t\t\t}\n\t\t\tthis.setSchemeShowCodeState(true);\n\t\t\tthis._parent.processChildControlSchemeChange(this);\n\t\t}\n\t}\n\n\tcreateTitleMarker()\n\t{\n\t\tif(this._mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst display = this.isShownSymbolicCode ? 'none' : 'inline';\n\n\t\tif(this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\treturn Tag.render`<span id=\"name_code_marker\" style=\"color: rgb(255, 0, 0); display: ${display};\">*</span>`;\n\t\t}\n\t}\n\n\tlayout(options)\n\t{\n\t\tif(this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ensureWrapperCreated({ classNames: [ 'ui-entity-editor-field-multitext' ] });\n\t\tthis.adjustWrapper();\n\n\t\tif(!this.isNeedToDisplay())\n\t\t{\n\t\t\tthis.registerLayout(options);\n\t\t\tthis._hasLayout = true;\n\t\t\treturn;\n\t\t}\n\n\t\tconst title = this.getTitle();\n\n\t\tconst values = this.getValue();\n\t\tthis._inputValue = values;\n\t\tthis._innerWrapper = null;\n\t\tif(this.isDragEnabled())\n\t\t{\n\t\t\tDom.append(this.createDragButton(), this._wrapper);\n\t\t}\n\n\t\tDom.append(this.createTitleNode(title), this._wrapper);\n\t\tif(this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tthis._inputContainer = Tag.render`<div></div>`;\n\n\t\t\tfor (let valueKey in values)\n\t\t\t{\n\t\t\t\tDom.append(this.createSingleInput(values[valueKey], valueKey), this._inputContainer);\n\t\t\t}\n\n\t\t\tthis._innerWrapper = Tag.render`<div class=\"ui-entity-editor-content-block\">${this._inputContainer}</div>`;\n\t\t\tif (this.isShownSymbolicCode)\n\t\t\t{\n\t\t\t\tDom.addClass(this._innerWrapper, 'ui-entity-editor-content-block--code');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.addClass(this._innerWrapper, 'ui-entity-editor-content-block--no-code');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._innerWrapper = Tag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block\">${this.getViewInnerLayout()}</div>\n\t\t\t`;\n\t\t}\n\n\t\tDom.append(this._innerWrapper, this._wrapper);\n\n\t\tif(this.isContextMenuEnabled())\n\t\t{\n\t\t\tDom.append(this.createContextMenuButton() ,this._wrapper);\n\t\t}\n\n\t\tif(this.isDragEnabled())\n\t\t{\n\t\t\tthis.initializeDragDropAbilities();\n\t\t}\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\tvalidate(result)\n\t{\n\t\tif(this._mode !== BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tthrow 'BX.UI.EntityEditorMultiText. Invalid validation context';\n\t\t}\n\n\t\tif(!this.isEditable())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.clearError();\n\n\t\tif(this.hasValidators())\n\t\t{\n\t\t\treturn this.executeValidators(result);\n\t\t}\n\n\t\tlet isEmptyField = false;\n\t\tif(this._inputContainer)\n\t\t{\n\t\t\tconst nameTextElement = document.getElementById('name_text');\n\n\t\t\tif (BX.util.trim(nameTextElement.value) === '')\n\t\t\t{\n\t\t\t\tisEmptyField = true;\n\t\t\t\tDom.addClass(nameTextElement.parentNode, \"ui-ctl-danger\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(nameTextElement.parentNode, \"ui-ctl-danger\");\n\t\t\t}\n\t\t}\n\n\t\tconst isValid = !this.isRequired() || !isEmptyField;\n\t\tif(!isValid)\n\t\t{\n\t\t\tresult.addError(BX.UI.EntityValidationError.create({ field: this }));\n\t\t\tthis.showRequiredFieldError(this._input);\n\t\t}\n\t\treturn isValid;\n\t}\n\n\tshowError(error, anchor)\n\t{\n\t\tif(!this._errorContainer)\n\t\t{\n\t\t\tthis._errorContainer = Tag.render`<div class=\"ui-entity-editor-field-error-text\"></div>`;\n\t\t}\n\n\t\tthis._errorContainer.innerHTML = BX.util.htmlspecialchars(error);\n\t\tif (this._wrapper)\n\t\t{\n\t\t\tDom.append(this._errorContainer, this._wrapper);\n\t\t}\n\t\tthis._hasError = true;\n\t}\n\n\tcreateSingleInput(value, name)\n\t{\n\t\tconst inputWrapper = Tag.render`\n\t\t\t<div id=\"${name.toLowerCase()}_container\"></div>\n\t\t`;\n\t\tconst inputContainer = Tag.render`\n\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-textbox\"></div>\n\t\t`;\n\n\t\tlet input;\n\t\tif (this.getLineCount() > 1)\n\t\t{\n\t\t\tinput = Tag.render`\n\t\t\t\t<textarea\n\t\t\t\t\tclass=\"ui-ctl-element ui-entity-editor-field-textarea\"\n\t\t\t\t\tname=\"${name}\"\n\t\t\t\t\tid=\"${name.toLowerCase() + '_text'}\"\n\t\t\t\t\trows=\"${this.getLineCount()}\">${BX.util.htmlspecialchars(value) || ''}</textarea>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tinput = Tag.render`\n\t\t\t\t<input\n\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\tname=\"${name}\"\n\t\t\t\t\tid=\"${name.toLowerCase() + '_text'}\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tvalue=\"${BX.util.htmlspecialchars(value) || ''}\"/>\n\t\t\t`;\n\t\t}\n\n\t\tEvent.bind(input, 'input', this.#onInputHandler.bind(this, name));\n\n\t\tif (name === 'CODE')\n\t\t{\n\t\t\tif (!this.isShownSymbolicCode)\n\t\t\t{\n\t\t\t\tDom.addClass(inputWrapper, 'name-code-container-hidden');\n\t\t\t}\n\n\t\t\tif (this.allowToGenerateCode === true)\n\t\t\t{\n\t\t\t\tDom.addClass(input, 'ui-ctl-element-symbol-code-input-disabled');\n\t\t\t\tDom.attr(input, 'readonly', this.allowToGenerateCode);\n\t\t\t}\n\n\t\t\tDom.addClass(inputContainer, 'ui-ctl-ext-before-icon');\n\t\t\tDom.addClass(inputWrapper, 'name-code-container');\n\n\t\t\tconst chainState = this.allowToGenerateCode ? 'chain' : 'unchain';\n\t\t\tconst button = Tag.render`\n\t\t\t\t<button name=\"${name}\" class=\"ui-ctl-before ui-ctl-icon-${chainState}\" id=\"code_state_button\"></button>\n\t\t\t`;\n\t\t\tEvent.bind(button, 'click', this.#onCodeStateButtonClick.bind(this));\n\t\t\tDom.append(button, inputContainer);\n\t\t}\n\n\t\tconst label = this.#creatLabelForEditMode(name);\n\n\t\tDom.append(label, inputWrapper);\n\t\tDom.append(input, inputContainer);\n\t\tDom.append(inputContainer, inputWrapper);\n\n\t\treturn inputWrapper;\n\t}\n\n\t#creatLabelForEditMode(name)\n\t{\n\t\tconst label = Tag.render`<label class=\"ui-entity-editor-block-title\"></label>`;\n\t\tlet labelText;\n\n\t\tif (name === 'CODE')\n\t\t{\n\t\t\tlabelText = Tag.render`<span>${Loc.getMessage('CATALOG_ENTITY_CARD_SYMBOLIC_CODE')}</span>`;\n\t\t\tDom.append(labelText, label);\n\t\t\tDom.append(this.#getHintNode(), label);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlabelText = Tag.render`\n\t\t\t\t<span>\n\t\t\t\t\t${Loc.getMessage('CATALOG_ENTITY_CARD_NAME')}\n\t\t\t\t\t<span style=\"color: rgb(255, 0, 0);\">*</span>\n\t\t\t\t</span>\n\t\t\t`;\n\t\t\tDom.append(labelText, label);\n\t\t}\n\n\t\treturn label;\n\t}\n\n\t#onInputHandler(name)\n\t{\n\t\tthis._changeHandler();\n\t\tif (this.allowToGenerateCode && name === 'NAME')\n\t\t{\n\t\t\tconst codeTextElement = document.getElementById('code_text');\n\t\t\tconst nameTextElement = document.getElementById('name_text');\n\t\t\tcodeTextElement.value = BX.translit(nameTextElement.value, null);\n\t\t}\n\t}\n\n\t#getHintNode()\n\t{\n\t\treturn BX.UI.Hint.createNode(Loc.getMessage('CATALOG_ENTITY_CARD_SYMBOLIC_CODE_HINT'));\n\t}\n\n\t#onCodeStateButtonClick()\n\t{\n\t\tconst codeTextElement = document.getElementById('code_text');\n\t\tconst nameTextElement = document.getElementById('name_text');\n\t\tconst codeStateButtonElement = document.getElementById('code_state_button');\n\n\t\tthis.allowToGenerateCode = !this.allowToGenerateCode;\n\t\tcodeTextElement.readOnly = this.allowToGenerateCode;\n\n\t\tif (this.allowToGenerateCode)\n\t\t{\n\t\t\tcodeTextElement.className = 'ui-ctl-element ui-ctl-element-symbol-code-input-disabled';\n\t\t\tcodeStateButtonElement.className = 'ui-ctl-before ui-ctl-icon-chain';\n\t\t\tcodeTextElement.value = BX.translit(nameTextElement.value, null);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcodeTextElement.className = 'ui-ctl-element';\n\t\t\tcodeStateButtonElement.className = 'ui-ctl-before ui-ctl-icon-unchain';\n\n\t\t\tconst nameTextElement = document.getElementById('name_text');\n\t\t\tconst newValue = BX.translit(nameTextElement.value, null);\n\n\t\t\tif (codeTextElement.value !== newValue)\n\t\t\t{\n\t\t\t\tthis.markAsChanged();\n\t\t\t}\n\t\t\tcodeTextElement.value = newValue;\n\t\t}\n\t}\n\n\tgetViewInnerLayout()\n\t{\n\t\tconst textValue = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block-text\"></div>\n\t\t`;\n\n\t\tconst values = this.getValue();\n\n\t\tif (!this.isShownSymbolicCode)\n\t\t{\n\t\t\tDom.append(Tag.render`<p>${BX.util.htmlspecialchars(values.NAME)}</p>`, textValue);\n\n\t\t\treturn textValue;\n\t\t}\n\n\t\tDom.append(Tag.render`\n\t\t\t<div class=\"ui-entity-editor-symbol-code-label\">\n\t\t\t\t${Loc.getMessage('CATALOG_ENTITY_CARD_NAME')}\n\t\t\t</div>\n\t\t`, textValue);\n\n\t\tDom.append(Tag.render`<p>${BX.util.htmlspecialchars(values.NAME)}</p>`, textValue);\n\n\t\tDom.addClass(textValue, 'ui-entity-editor-symbol-code');\n\t\tconst codeValue = values.CODE === '' ? Loc.getMessage('UI_ENTITY_EDITOR_FIELD_EMPTY') : values.CODE;\n\t\tconst chainClass = this.allowToGenerateCode\n\t\t\t? 'ui-entity-editor-symbol-code-value-chain'\n\t\t\t: 'ui-entity-editor-symbol-code-value-unchain'\n\t\t;\n\n\t\tDom.append(Tag.render`\n\t\t\t<div class=\"ui-entity-editor-symbol-code-box\">\n\t\t\t\t<div class=\"ui-entity-editor-symbol-code-label\">\n\t\t\t\t\t${Loc.getMessage('CATALOG_ENTITY_CARD_SYMBOLIC_CODE')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-entity-editor-symbol-code-value ${chainClass}\">\n\t\t\t\t\t${BX.util.htmlspecialchars(codeValue)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`, textValue);\n\n\t\treturn textValue;\n\t}\n}","import IblockSectionField from './iblock-section/field';\nimport NameCodeField from './name-code/field';\nimport {type BaseEvent, EventEmitter} from 'main.core.events'\n\nexport default class FieldsFactory\n{\n\tconstructor()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorControlFactory:onInitialize', (event: BaseEvent) => {\n\t\t\tconst [, eventArgs] = event.getCompatData();\n\t\t\teventArgs.methods['entityCard'] = this.factory.bind(this);\n\t\t});\n\t}\n\n\tfactory(type, controlId, settings)\n\t{\n\t\tif (type === 'iblock_section')\n\t\t{\n\t\t\treturn new IblockSectionField(controlId, settings);\n\t\t}\n\t\telse if (type === 'name-code')\n\t\t{\n\t\t\treturn new NameCodeField(controlId, settings);\n\t\t}\n\n\t\treturn null;\n\t}\n}","import {ajax} from 'main.core';\nimport {type BaseEvent, EventEmitter} from 'main.core.events'\n\nconst PROPERTY_PREFIX = 'PROPERTY_';\nconst PROPERTY_BLOCK_NAME = 'properties';\n\nexport default class IblockSectionController extends BX.UI.EntityEditorController\n{\n\tonChangeHandler = this.handleChange.bind(this);\n\n\tconstructor(id, settings = {})\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\n\t\tthis.isRequesting = false;\n\t\tthis.clearServiceFields();\n\n\t\tEventEmitter.subscribe(this._editor, 'IblockSectionField:onChange', this.onChangeHandler);\n\t}\n\n\tclearServiceFields()\n\t{\n\t\tthis.lastDataHash = null;\n\t\tthis.initialElements = null;\n\t\tthis.deletedControls = {};\n\t\tthis.deletedAvailableSchemes = {};\n\t}\n\n\thandleChange(event: BaseEvent)\n\t{\n\t\tconst newData = event.getData();\n\t\tnewData.shift();\n\t\tconst newDataHash = JSON.stringify(newData);\n\n\t\tif (this.lastDataHash === null || this.lastDataHash !== newDataHash)\n\t\t{\n\t\t\tthis.lastDataHash = newDataHash;\n\n\t\t\tclearTimeout(this.timeout);\n\t\t\tthis.timeout = setTimeout(() => {\n\t\t\t\tthis.refreshLinkedProperties(newData)\n\t\t\t}, 50);\n\t\t}\n\t}\n\n\trefreshLinkedProperties(sectionIds)\n\t{\n\t\tif (this.isRequesting)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isRequesting = true;\n\n\t\tajax.runComponentAction(\n\t\t\tthis._editor._settings.ajaxData.COMPONENT_NAME,\n\t\t\t'refreshLinkedProperties',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this._editor._settings.ajaxData.SIGNED_PARAMETERS,\n\t\t\t\tdata: {sectionIds}\n\t\t\t}\n\t\t)\n\t\t\t.then(response => {\n\t\t\t\tconst allCurrentProperties = this.getAllCurrentProperties();\n\n\t\t\t\tif (this.initialElements === null)\n\t\t\t\t{\n\t\t\t\t\tthis.initialElements = [...allCurrentProperties];\n\t\t\t\t}\n\n\t\t\t\tresponse.data.ENTITY_FIELDS.forEach(property => {\n\t\t\t\t\tif (!allCurrentProperties.includes(property.name))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.addProperty(property, {\n\t\t\t\t\t\t\tlayout: {\n\t\t\t\t\t\t\t\tforceDisplay: true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmode: BX.UI.EntityEditorMode.edit\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tconst newProperties = response.data.ENTITY_FIELDS.map(el => el.name);\n\t\t\t\tallCurrentProperties.forEach(name => {\n\t\t\t\t\tif (!newProperties.includes(name))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.removeProperty(name);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis._editor.commitSchemeChanges();\n\t\t\t\tthis.isRequesting = false;\n\t\t\t})\n\t\t\t.catch(response => {\n\t\t\t\tthis.isRequesting = false;\n\t\t\t})\n\t\t;\n\t}\n\n\tgetAllCurrentProperties()\n\t{\n\t\tconst activeProperties = this._editor.getAllControls()\n\t\t\t.filter(el => el.getName().indexOf(PROPERTY_PREFIX) === 0)\n\t\t\t.map(el => el.getName());\n\n\t\tconst hiddenProperties = this._editor.getAvailableSchemeElements()\n\t\t\t.filter(el => el.getName().indexOf(PROPERTY_PREFIX) === 0)\n\t\t\t.map(el => el.getName());\n\n\t\treturn [...activeProperties, ...hiddenProperties];\n\t}\n\n\taddProperty(property, options = {})\n\t{\n\t\tif (property.name in this.deletedControls)\n\t\t{\n\t\t\tthis.restoreDeletedProperty(this.deletedControls[property.name], options);\n\t\t}\n\t\telse if (property.name in this.deletedAvailableSchemes)\n\t\t{\n\t\t\tthis.restoreDeletedAvailableProperty(this.deletedAvailableSchemes[property.name], options);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.createProperty(property, options);\n\t\t}\n\t}\n\n\trestoreDeletedProperty(control, options = {})\n\t{\n\t\tconst mode = options.mode || control._mode;\n\t\tcontrol._mode = mode;\n\n\t\tcontrol.getParent().addChild(control, {\n\t\t\t...options,\n\t\t\tenableSaving: false\n\t\t});\n\n\t\tif (mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tthis._editor.registerActiveControl(control);\n\t\t}\n\t\telse if (mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\tthis._editor.unregisterActiveControl(control);\n\t\t}\n\t}\n\n\trestoreDeletedAvailableProperty(schemeElement, options = {})\n\t{\n\t\tthis._editor.addAvailableSchemeElement(schemeElement);\n\t}\n\n\tcreateProperty(property, options = {})\n\t{\n\t\tconst propertyBlockScheme = this._editor.getSchemeElementByName(PROPERTY_BLOCK_NAME);\n\t\tconst schemeElement = BX.UI.EntitySchemeElement.create(property);\n\t\tpropertyBlockScheme._elements.push(schemeElement);\n\n\t\tconst mode = options.mode || BX.UI.EntityEditorMode.edit;\n\t\tconst control = this._editor.createControl(\n\t\t\tschemeElement.getType(),\n\t\t\tschemeElement.getName(),\n\t\t\t{\n\t\t\t\tschemeElement: schemeElement,\n\t\t\t\tmodel: this._model,\n\t\t\t\tparent: this,\n\t\t\t\tmode: mode\n\t\t\t}\n\t\t);\n\n\t\tif (!control)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst propertyBlockControl = this._editor.getControlById(PROPERTY_BLOCK_NAME);\n\t\tpropertyBlockControl.addChild(control, {\n\t\t\t...options,\n\t\t\tenableSaving: false\n\t\t});\n\n\t\treturn control;\n\t}\n\n\tremoveProperty(name)\n\t{\n\t\tconst control = this._editor.getControlByIdRecursive(name);\n\n\t\tif (control)\n\t\t{\n\t\t\tthis.deletedControls[control.getName()] = control;\n\t\t\tcontrol.getParent().removeChild(control, {enableSaving: false});\n\t\t\tthis._editor.removeAvailableSchemeElement(control.getSchemeElement());\n\t\t\tthis._editor.unregisterActiveControl(control);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst schemeElement = this._editor.getAvailableSchemeElementByName(name);\n\n\t\t\tif (schemeElement)\n\t\t\t{\n\t\t\t\tthis.deletedAvailableSchemes[schemeElement.getName()] = schemeElement;\n\t\t\t\tthis._editor.removeAvailableSchemeElement(schemeElement);\n\t\t\t}\n\t\t}\n\t}\n\n\trollback()\n\t{\n\t\tsuper.rollback();\n\n\t\tif (this.initialElements === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst allCurrentProperties = this.getAllCurrentProperties();\n\n\t\tallCurrentProperties.forEach(element => {\n\t\t\tif (!this.initialElements.includes(element))\n\t\t\t{\n\t\t\t\tthis.removeProperty(element);\n\t\t\t}\n\t\t});\n\n\t\tthis.initialElements.forEach(element => {\n\t\t\tif (!allCurrentProperties.includes(element))\n\t\t\t{\n\t\t\t\tthis.addProperty({name: element}, {\n\t\t\t\t\tlayout: {\n\t\t\t\t\t\tforceDisplay: false\n\t\t\t\t\t},\n\t\t\t\t\tmode: BX.UI.EntityEditorMode.view\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis._editor.commitSchemeChanges();\n\n\t\tthis.clearServiceFields()\n\t}\n}","import {type BaseEvent, EventEmitter} from 'main.core.events';\nimport {Dom, Reflection, Type, Uri} from 'main.core';\n\nexport default class VariationGridController extends BX.UI.EntityEditorController\n{\n\tareaHeight = null\n\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\t}\n\n\tdoInitialize()\n\t{\n\t\tsuper.doInitialize();\n\n\t\tEventEmitter.subscribe('Grid::thereEditedRows', this.markAsChangedHandler.bind(this));\n\t\tEventEmitter.subscribe('Grid::noEditedRows', this.checkEditorToolbar.bind(this));\n\t\tEventEmitter.subscribe('Grid::updated', this.checkEditorToolbar.bind(this));\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequest.bind(this));\n\n\t\tEventEmitter.subscribe('onAjaxSuccess', this.ajaxSuccessHandler.bind(this));\n\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorIncludedArea:onBeforeLoad', this.onBeforeIncludedAreaLoaded.bind(this));\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorIncludedArea:onAfterLoad', this.onAfterIncludedAreaLoaded.bind(this));\n\t\tEventEmitter.subscribe(\"BX.UI.EntityEditor:onNothingChanged\", this.onNothingChanged.bind(this));\n\n\t\tthis.subscribeToFormSubmit();\n\t}\n\n\tonBeforeIncludedAreaLoaded(event: BaseEvent)\n\t{\n\t\tif (Type.isNumber(this.areaHeight))\n\t\t{\n\t\t\tDom.style(this.getVariationGridLoader(), 'height', this.areaHeight + 'px');\n\t\t}\n\t}\n\n\tonAfterIncludedAreaLoaded(event: BaseEvent)\n\t{\n\t\tDom.style(this.getVariationGridLoader(), 'height', '');\n\t\tthis.areaHeight = null;\n\t}\n\n\tonNothingChanged(event: BaseEvent)\n\t{\n\t\tthis.rollback();\n\t}\n\n\tgetVariationGridLoader()\n\t{\n\t\tconst control = this.getGridControl();\n\n\t\tif (control)\n\t\t{\n\t\t\tconst wrapper = control.getWrapper();\n\n\t\t\tif (wrapper)\n\t\t\t{\n\t\t\t\treturn wrapper.querySelector('.ui-entity-editor-included-area-container-loader');\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trollback()\n\t{\n\t\tsuper.rollback();\n\t\tthis.checkEditorToolbar();\n\t\tthis.unsubscribeGridEvents();\n\t\tBX.Main.gridManager.destroy(this.getGridId());\n\t}\n\n\tonAfterSave()\n\t{\n\t\tif (this.isChanged() || this._editor.isChanged())\n\t\t{\n\t\t\tthis.setGridControlCache(null);\n\t\t\tEventEmitter.emit(\n\t\t\t\t'onAfterVariationGridSave',\n\t\t\t\t{\n\t\t\t\t\tgridId: this.getGridId(),\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tBX.Main.gridManager.destroy(this.getGridId());\n\t\tthis.subscribeToFormSubmit();\n\t\tsuper.onAfterSave();\n\t}\n\n\tsetGridControlCache(html)\n\t{\n\t\tconst control = this.getGridControl();\n\n\t\tif (control)\n\t\t{\n\t\t\tcontrol._loadedHtml = html;\n\t\t}\n\t}\n\n\tonBeforeSubmit()\n\t{\n\t\tthis.unsubscribeGridEvents();\n\t}\n\n\t/**\n\t * @returns {BX.Catalog.VariationGrid|null}\n\t */\n\tgetVariationGridComponent()\n\t{\n\t\treturn Reflection.getClass('BX.Catalog.VariationGrid.Instance');\n\t}\n\n\tunsubscribeGridEvents()\n\t{\n\t\tconst gridComponent = this.getVariationGridComponent();\n\t\tif (gridComponent)\n\t\t{\n\t\t\tgridComponent.destroy();\n\t\t}\n\n\t\tconst popup = this.getGrid()?.getSettingsWindow()?.getPopup();\n\t\tif (popup)\n\t\t{\n\t\t\tEventEmitter.emit(this.getGrid().getSettingsWindow().getPopup(), 'onDestroy');\n\t\t}\n\n\t\tEventEmitter.unsubscribeAll('BX.Main.grid:paramsUpdated');\n\t}\n\n\tajaxSuccessHandler(event: BaseEvent)\n\t{\n\t\tconst [, xhrData] = event.getCompatData();\n\n\t\tif (xhrData.url.indexOf(this.getReloadUrl()) === 0)\n\t\t{\n\t\t\tthis.setGridControlCache(null);\n\t\t}\n\t}\n\n\t// ajax form initializes every \"save\" action\n\tsubscribeToFormSubmit()\n\t{\n\t\tEventEmitter.subscribe(this._editor._ajaxForm, 'onBeforeSubmit', this.onBeforeSubmitForm.bind(this));\n\t}\n\n\tmarkAsChangedHandler()\n\t{\n\t\tif (!this._editor.isNew())\n\t\t{\n\t\t\tthis.markAsChanged();\n\t\t}\n\t}\n\n\tcheckEditorToolbar()\n\t{\n\t\tthis._isChanged = false;\n\n\t\tif (this._editor.getActiveControlCount() > 0)\n\t\t{\n\t\t\tthis._editor.showToolPanel();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._editor.hideToolPanel();\n\t\t}\n\n\t\tif (this._editor._toolPanel)\n\t\t{\n\t\t\tthis._editor._toolPanel.clearErrors();\n\t\t}\n\t}\n\n\tgetGridControl()\n\t{\n\t\treturn this._editor.getControlById('variation_grid');\n\t}\n\n\tonBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet url = eventArgs.url;\n\t\tif (url)\n\t\t{\n\t\t\tconst params = (new Uri(url)).getQueryParams();\n\t\t\turl = new Uri(this.getReloadUrl());\n\n\t\t\tif (params)\n\t\t\t{\n\t\t\t\tfor (const key in params) {\n\t\t\t\t\tif (Object.hasOwnProperty.call(params, key)) {\n\t\t\t\t\t\turl.setQueryParam(key, params[key])\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\turl = url.toString();\n\t\t}\n\t\telse\n\t\t{\n\t\t\turl = this.getReloadUrl();\n\t\t}\n\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.url = url;\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tsignedParameters: this.getSignedParameters()\n\t\t};\n\n\t\tthis.unsubscribeGridEvents();\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getConfigStringParam('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getConfigStringParam('signedParameters', '');\n\t}\n\n\tgetGridId()\n\t{\n\t\treturn this.getConfigStringParam('gridId', '');\n\t}\n\n\tgetGrid()\n\t{\n\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.gridManager.getInstanceById(this.getGridId());\n\t}\n\n\tonBeforeSubmitForm(event: BaseEvent)\n\t{\n\t\tconst [, eventArgs] = event.getCompatData();\n\t\tconst grid = this.getGrid();\n\n\t\tif (!grid)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst skuGridName = this.getGridId();\n\t\tconst skuGridData = grid.getRows().getEditSelectedValues();\n\t\tconst copyItemsMap = grid.getParam('COPY_ITEMS_MAP', {});\n\n\t\t// replace sku custom properties edit data names with original names\n\t\tfor (let id in skuGridData)\n\t\t{\n\t\t\tif (!skuGridData.hasOwnProperty(id))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (let name in skuGridData[id])\n\t\t\t{\n\t\t\t\tif (!skuGridData[id].hasOwnProperty(name))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (name.includes('SKU_GRID_CATALOG_GROUP')\n\t\t\t\t\t|| name.includes('SKU_GRID_PURCHASING')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tfor (let priceField in skuGridData[id][name])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (skuGridData[id][name].hasOwnProperty(priceField))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tskuGridData[id][priceField] = skuGridData[id][name][priceField];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (name.includes('[EDIT_HTML]'))\n\t\t\t\t{\n\t\t\t\t\tlet newName = name.replace('[EDIT_HTML]', '');\n\n\t\t\t\t\t// lookup for a custom file fields\n\t\t\t\t\tif (newName.endsWith('_custom'))\n\t\t\t\t\t{\n\t\t\t\t\t\tif ('bxu_files[]' in skuGridData[id][name])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tskuGridData[id][name].isFile = true;\n\t\t\t\t\t\t\tdelete skuGridData[id][name]['bxu_files[]'];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (skuGridData[id][name].isFile)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfor (let fieldName in skuGridData[id][name])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (skuGridData[id][name].hasOwnProperty(fieldName))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t// check for new files like \"MORE_PHOTO_n1[name]\"(multiple) or \"DETAIL_PICTURE[name]\"(single)\n\t\t\t\t\t\t\t\t\tlet newFilesRegExp = new RegExp(/([0-9A-Za-z_]+?(_n\\d+)*)\\[([A-Za-z_]+)\\]/);\n\n\t\t\t\t\t\t\t\t\tif (newFilesRegExp.test(fieldName))\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tlet fileCounter, fileSetting;\n\n\t\t\t\t\t\t\t\t\t\t[, fileCounter, , fileSetting] = fieldName.match(newFilesRegExp);\n\n\t\t\t\t\t\t\t\t\t\tif (fileCounter && fileSetting)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tskuGridData[id][name][fileCounter] = skuGridData[id][name][fileCounter] || {};\n\t\t\t\t\t\t\t\t\t\t\tskuGridData[id][name][fileCounter][fileSetting] = skuGridData[id][name][fieldName];\n\t\t\t\t\t\t\t\t\t\t\tdelete skuGridData[id][name][fieldName];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tskuGridData[id][newName] = skuGridData[id][name];\n\t\t\t\t\tdelete skuGridData[id][name];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!Type.isNil(copyItemsMap[id]))\n\t\t\t{\n\t\t\t\tskuGridData[id]['COPY_SKU_ID'] = copyItemsMap[id];\n\t\t\t}\n\t\t}\n\n\t\tif (!Type.isPlainObject(eventArgs.options))\n\t\t{\n\t\t\teventArgs.options = {};\n\t\t}\n\n\t\tif (!Type.isPlainObject(eventArgs.options.data))\n\t\t{\n\t\t\teventArgs.options.data = {};\n\t\t}\n\n\t\teventArgs.options.data[skuGridName] = skuGridData;\n\n\t\tthis.areaHeight = this.getGridControl().getWrapper().offsetHeight;\n\t}\n}\n","import {EventEmitter} from 'main.core.events'\n\n\nexport default class VariationLinkController extends BX.UI.EntityEditorController\n{\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\t\tEventEmitter.subscribe('onChangeVariationLink', this.markAsChanged.bind(this));\n\t}\n\n\trollback()\n\t{\n\t\tsuper.rollback();\n\t\tif (this._isChanged)\n\t\t{\n\t\t\tthis._isChanged = false;\n\t\t}\n\t}\n}","import {EventEmitter} from 'main.core.events'\n\n\nexport default class GoogleMapController extends BX.UI.EntityEditorController\n{\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\t\tEventEmitter.subscribe('onAddGoogleMapPoint', this.markAsChanged.bind(this));\n\t}\n\n\trollback()\n\t{\n\t\tsuper.rollback();\n\t\tif (this._isChanged)\n\t\t{\n\t\t\tthis._isChanged = false;\n\t\t}\n\t}\n}","import {EventEmitter} from 'main.core.events'\n\n\nexport default class EmployeeController extends BX.UI.EntityEditorController\n{\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\t\tEventEmitter.subscribe('onChangeEmployee', this.markAsChanged.bind(this));\n\t}\n\n\trollback()\n\t{\n\t\tsuper.rollback();\n\t\tif (this._isChanged)\n\t\t{\n\t\t\tthis._isChanged = false;\n\t\t}\n\t}\n}","import {EventEmitter} from 'main.core.events'\n\n\nexport default class UserController extends BX.UI.EntityEditorController\n{\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\t\tEventEmitter.subscribe('onChangeUser', this.markAsChanged.bind(this));\n\t}\n\n\trollback()\n\t{\n\t\tsuper.rollback();\n\t\tif (this._isChanged)\n\t\t{\n\t\t\tthis._isChanged = false;\n\t\t}\n\t}\n}","import {EventEmitter} from 'main.core.events'\n\n\nexport default class IblockElementController extends BX.UI.EntityEditorController\n{\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\t\tEventEmitter.subscribe('onChangeIblockElement', this.markAsChanged.bind(this));\n\t}\n\n\trollback()\n\t{\n\t\tsuper.rollback();\n\t\tif (this._isChanged)\n\t\t{\n\t\t\tthis._isChanged = false;\n\t\t}\n\t}\n}","import {EventEmitter} from 'main.core.events'\n\nexport default class BindingToCrmElementController extends BX.UI.EntityEditorController\n{\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\t}\n\n\trollback()\n\t{\n\t\tsuper.rollback();\n\t\tif (this._isChanged)\n\t\t{\n\t\t\tthis._isChanged = false;\n\t\t}\n\t\tEventEmitter.unsubscribeAll('BX.Main.User.SelectorController::open');\n\t}\n\n\tonBeforeSubmit()\n\t{\n\t\tsuper.onBeforeSubmit();\n\t\tEventEmitter.unsubscribeAll('BX.Main.User.SelectorController::open');\n\t}\n}","import {ajax} from 'main.core';\nimport {type BaseEvent, EventEmitter} from 'main.core.events'\n\nexport default class FieldConfiguratorController extends BX.UI.EntityEditorController\n{\n\tfieldAddHandler = this.handleFieldAdd.bind(this);\n\tfieldUpdateHandler = this.handleFieldUpdate.bind(this);\n\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\n\t\tEventEmitter.subscribe(this._editor, 'BX.UI.EntityEditor:onFieldCreate', this.fieldAddHandler);\n\t\tEventEmitter.subscribe(this._editor, 'BX.UI.EntityEditor:onFieldModify', this.fieldUpdateHandler);\n\t}\n\n\thandleFieldAdd(event: BaseEvent)\n\t{\n\t\tconst [section, eventArgs] = event.getCompatData();\n\t\tconst fields = this.getFieldsForm(eventArgs);\n\n\t\tajax.runComponentAction(\n\t\t\tthis._editor._settings.ajaxData.COMPONENT_NAME,\n\t\t\t'addProperty',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this._editor._settings.ajaxData.SIGNED_PARAMETERS,\n\t\t\t\tdata: fields\n\t\t\t}\n\t\t)\n\t\t\t.then(response => {\n\t\t\t\tconst property = response.data.PROPERTY_FIELDS;\n\t\t\t\tif (!property)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst additionalValues = response.data.ADDITIONAL_VALUES;\n\t\t\t\tif (additionalValues)\n\t\t\t\t{\n\t\t\t\t\tconst model = this._editor._model;\n\t\t\t\t\tfor (let [key, value] of Object.entries(additionalValues))\n\t\t\t\t\t{\n\t\t\t\t\t\tmodel.setField(key, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet mode = BX.UI.EntityEditorMode.view;\n\t\t\t\tif (section instanceof BX.UI.EntityEditorSection)\n\t\t\t\t{\n\t\t\t\t\tmode = section.getMode()\n\t\t\t\t}\n\n\t\t\t\tconst control = this.createProperty(property, section.getName(), {\n\t\t\t\t\tlayout: {\n\t\t\t\t\t\tnotifyIfNotDisplayed: true,\n\t\t\t\t\t\tforceDisplay: eventArgs.showAlways\n\t\t\t\t\t},\n\t\t\t\t\tmode: mode\n\t\t\t\t});\n\n\t\t\t\tcontrol.toggleOptionFlag(eventArgs.showAlways);\n\n\t\t\t\tthis._editor.saveSchemeChanges();\n\n\t\t\t\tthis.isRequesting = false;\n\t\t\t})\n\t\t\t.catch(response => {\n\t\t\t\tthis.isRequesting = false;\n\t\t\t})\n\t\t;\n\t}\n\n\thandleFieldUpdate(event: BaseEvent)\n\t{\n\t\tconst [section, eventArgs] = event.getCompatData();\n\t\tif (!(eventArgs.field instanceof BX.UI.EntityEditorControl))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentField = eventArgs.field;\n\t\teventArgs.CODE = currentField.getId();\n\n\t\tconst fields = this.getFieldsForm(eventArgs);\n\t\tconst schemeElement = currentField.getSchemeElement();\n\t\tschemeElement._isRequired = eventArgs.mandatory;\n\n\t\tajax.runComponentAction(\n\t\t\tthis._editor._settings.ajaxData.COMPONENT_NAME,\n\t\t\t'updateProperty',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this._editor._settings.ajaxData.SIGNED_PARAMETERS,\n\t\t\t\tdata: fields\n\t\t\t}\n\t\t).then(response => {\n\t\t\tconst property = response?.data?.PROPERTY_FIELDS;\n\t\t\tif (currentField instanceof BX.UI.EntityEditorDatetime || currentField instanceof BX.UI.EntityEditorMultiDatetime)\n\t\t\t{\n\t\t\t\tconst schemeElementData = currentField.getSchemeElement().getData();\n\t\t\t\tconst propertyData = property?.data;\n\t\t\t\tif (propertyData)\n\t\t\t\t{\n\t\t\t\t\tschemeElementData.enableTime = propertyData.enableTime;\n\t\t\t\t\tschemeElementData.dateViewFormat = propertyData.dateViewFormat;\n\t\t\t\t\tcurrentField.refreshLayout();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (currentField instanceof BX.UI.EntityEditorCustom)\n\t\t\t{\n\t\t\t\tcurrentField.refreshLayout();\n\t\t\t}\n\n\t\t\tlet newType = null;\n\t\t\tlet schemeElement = null;\n\t\t\tif (eventArgs.multiple === true)\n\t\t\t{\n\t\t\t\tif (currentField instanceof BX.UI.EntityEditorText)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'multitext';\n\t\t\t\t}\n\t\t\t\telse if (currentField instanceof BX.UI.EntityEditorList)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'multilist';\n\t\t\t\t}\n\t\t\t\telse if (currentField instanceof BX.UI.EntityEditorDatetime)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'multidatetime';\n\t\t\t\t}\n\t\t\t\telse if (currentField instanceof BX.UI.EntityEditorNumber)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'multinumber';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (currentField instanceof BX.UI.EntityEditorMultiList)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'list';\n\t\t\t\t}\n\t\t\t\telse if (currentField instanceof BX.UI.EntityEditorMultiDatetime)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'datetime';\n\t\t\t\t}\n\t\t\t\telse if (currentField instanceof BX.UI.EntityEditorMultiNumber)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'number';\n\t\t\t\t}\n\t\t\t\telse if (currentField instanceof BX.UI.EntityEditorMultiText)\n\t\t\t\t{\n\t\t\t\t\tnewType = 'text';\n\t\t\t\t}\n\t\t\t}\n\t\t\tschemeElement = currentField.getSchemeElement();\n\t\t\tif (\n\t\t\t\t((currentField instanceof BX.UI.EntityEditorList) || (currentField instanceof BX.UI.EntityEditorMultiList))\n\t\t\t\t&& property\n\t\t\t)\n\t\t\t{\n\t\t\t\tschemeElement = BX.UI.EntitySchemeElement.create(property);\n\t\t\t\tnewType = property.type;\n\t\t\t}\n\t\t\tif (newType)\n\t\t\t{\n\t\t\t\tconst index = section.getChildIndex(currentField);\n\t\t\t\tconst newControl = this._editor.createControl(\n\t\t\t\t\tnewType,\n\t\t\t\t\teventArgs.CODE,\n\t\t\t\t\t{\n\t\t\t\t\t\tschemeElement: schemeElement,\n\t\t\t\t\t\tmodel: section._model,\n\t\t\t\t\t\tparent: section,\n\t\t\t\t\t\tmode: section.getMode()\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tsection.addChild(newControl, {\n\t\t\t\t\tindex,\n\t\t\t\t\tlayout: {\n\t\t\t\t\t\tforceDisplay: true\n\t\t\t\t\t},\n\t\t\t\t\tenableSaving: false\n\t\t\t\t});\n\n\t\t\t\tcurrentField._schemeElement = null;\n\t\t\t\tsection.removeChild(currentField, {\n\t\t\t\t\tenableSaving: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.isRequesting = false;\n\t\t})\n\t\t\t.catch(response => {\n\t\t\t\tthis.isRequesting = false;\n\t\t\t});\n\t}\n\n\tgetFieldsForm(fields)\n\t{\n\t\tconst form = new FormData();\n\t\tconst formatted = {\n\t\t\tNAME: fields.label,\n\t\t\tMULTIPLE: fields.multiple ? 'Y' : 'N',\n\t\t\tIS_REQUIRED: fields.mandatory ? 'Y' : 'N',\n\t\t\tIS_PUBLIC: fields.isPublic ? 'Y' : 'N',\n\t\t\tPROPERTY_TYPE: 'S',\n\t\t\tCODE: fields.CODE || ''\n\t\t};\n\n\t\tswitch (fields.typeId)\n\t\t{\n\t\t\tcase 'integer':\n\t\t\tcase 'double':\n\t\t\t\tformatted.PROPERTY_TYPE = 'N';\n\t\t\t\tbreak;\n\t\t\tcase 'list':\n\t\t\tcase 'multilist':\n\t\t\t\tformatted.PROPERTY_TYPE = 'L';\n\t\t\t\t(fields.enumeration || []).forEach((enumItem, key) => {\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES][' + key + '][SORT'), enumItem.SORT);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES][' + key + '][VALUE'), enumItem.VALUE);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES][' + key + '][ID'), enumItem.ID);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'directory':\n\t\t\t\tformatted.USER_TYPE = 'directory';\n\t\t\t\t(fields.enumeration || []).forEach((enumItem, key) => {\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES][' + key + '][SORT'), enumItem.SORT);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES][' + key + '][VALUE'), enumItem.VALUE.value);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES][' + key + '][XML_ID'), enumItem.XML_ID);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES][' + key + '][FILE_ID'), enumItem.FILE_ID);\n\t\t\t\t\tform.append('FILES[' + enumItem.SORT + ']', enumItem.VALUE.file);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'boolean':\n\t\t\t\tformatted.PROPERTY_TYPE = 'L';\n\t\t\t\tform.append(this.getFormFieldName('VALUES][0][VALUE'), 'Y')\n\t\t\t\tformatted.LIST_TYPE = 'C';\n\t\t\t\tbreak;\n\t\t\tcase 'money':\n\t\t\t\tformatted.USER_TYPE = 'Money';\n\t\t\t\tbreak;\n\t\t\tcase 'address':\n\t\t\t\tformatted.USER_TYPE = 'map_google';\n\t\t\t\tbreak;\n\t\t\tcase 'datetime':\n\t\t\tcase 'multidatetime':\n\t\t\t\tformatted.USER_TYPE = (fields.enableTime === true) ? 'DateTime' : 'Date';\n\t\t\t\tbreak;\n\t\t\tcase 'file':\n\t\t\t\tformatted.USER_TYPE = 'DiskFile';\n\t\t\t\tbreak;\n\t\t\tcase 'custom':\n\t\t\t\tformatted.USER_TYPE = fields.userType;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tfor (let [key, item] of Object.entries(formatted))\n\t\t{\n\t\t\tform.append(this.getFormFieldName(key), item);\n\t\t}\n\t\treturn form;\n\t}\n\n\tgetFormFieldName(name)\n\t{\n\t\treturn 'fields[' + name + ']';\n\t}\n\n\tcreateProperty(property, sectionName, options = {})\n\t{\n\t\tconst sectionSchemeElement = this._editor.getSchemeElementByName(sectionName);\n\t\tif (!sectionSchemeElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst schemeElement = BX.UI.EntitySchemeElement.create(property);\n\t\tsectionSchemeElement._elements.push(schemeElement);\n\n\t\tconst mode = options.mode || BX.UI.EntityEditorMode.edit;\n\t\tconst control = this._editor.createControl(\n\t\t\tschemeElement.getType(),\n\t\t\tschemeElement.getName(),\n\t\t\t{\n\t\t\t\tschemeElement: schemeElement,\n\t\t\t\tmodel: this._model,\n\t\t\t\tparent: this,\n\t\t\t\tmode: mode\n\t\t\t}\n\t\t);\n\n\t\tif (!control)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst sectionControl = this._editor.getControlById(sectionName);\n\t\tsectionControl.addChild(control, {\n\t\t\t...options,\n\t\t\tenableSaving: false\n\t\t});\n\n\t\treturn control;\n\t}\n}","import {type BaseEvent, EventEmitter} from 'main.core.events';\nimport {Dom, Reflection, Type} from 'main.core';\n\nexport default class ProductServiceGridController extends BX.UI.EntityEditorController\n{\n\tareaHeight = null\n\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.initialize(id, settings);\n\t}\n\n\tdoInitialize()\n\t{\n\t\tsuper.doInitialize();\n\n\t\tEventEmitter.subscribe('Grid::thereEditedRows', this.markAsChangedHandler.bind(this));\n\t\tEventEmitter.subscribe('Grid::noEditedRows', this.checkEditorToolbar.bind(this));\n\t\tEventEmitter.subscribe('Grid::updated', this.checkEditorToolbar.bind(this));\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequest.bind(this));\n\n\t\tEventEmitter.subscribe('onAjaxSuccess', this.ajaxSuccessHandler.bind(this));\n\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorIncludedArea:onBeforeLoad', this.onBeforeIncludedAreaLoaded.bind(this));\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorIncludedArea:onAfterLoad', this.onAfterIncludedAreaLoaded.bind(this));\n\t\tEventEmitter.subscribe(\"BX.UI.EntityEditor:onNothingChanged\", this.onNothingChanged.bind(this));\n\n\t\tthis.subscribeToFormSubmit();\n\t}\n\n\tonBeforeIncludedAreaLoaded(event: BaseEvent)\n\t{\n\t\tif (Type.isNumber(this.areaHeight))\n\t\t{\n\t\t\tDom.style(this.getProductServiceGridLoader(), 'height', this.areaHeight + 'px');\n\t\t}\n\t}\n\n\tonAfterIncludedAreaLoaded(event: BaseEvent)\n\t{\n\t\tDom.style(this.getProductServiceGridLoader(), 'height', '');\n\t\tthis.areaHeight = null;\n\t}\n\n\tonNothingChanged(event: BaseEvent)\n\t{\n\t\tthis.rollback();\n\t}\n\n\tgetProductServiceGridLoader()\n\t{\n\t\tconst control = this.getGridControl();\n\n\t\tif (control)\n\t\t{\n\t\t\tconst wrapper = control.getWrapper();\n\n\t\t\tif (wrapper)\n\t\t\t{\n\t\t\t\treturn wrapper.querySelector('.ui-entity-editor-included-area-container-loader');\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trollback()\n\t{\n\t\tsuper.rollback();\n\t\tthis.checkEditorToolbar();\n\t\tthis.unsubscribeGridEvents();\n\n\t\tBX.Main.gridManager.destroy(this.getGridId());\n\t}\n\n\tonAfterSave()\n\t{\n\t\tif (this.isChanged() || this._editor.isChanged())\n\t\t{\n\t\t\tthis.setGridControlCache(null);\n\t\t\tEventEmitter.emit(\n\t\t\t\t'onAfterProducServiceGridSave',\n\t\t\t\t{\n\t\t\t\t\tgridId: this.getGridId(),\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tBX.Main.gridManager.destroy(this.getGridId());\n\t\tthis.subscribeToFormSubmit();\n\t\tsuper.onAfterSave();\n\t}\n\n\tsetGridControlCache(html)\n\t{\n\t\tconst control = this.getGridControl();\n\n\t\tif (control)\n\t\t{\n\t\t\tcontrol._loadedHtml = html;\n\t\t}\n\t}\n\n\tonBeforeSubmit()\n\t{\n\t\tthis.unsubscribeGridEvents();\n\t}\n\n\t/**\n\t * @returns {BX.Catalog.ProductServiceGrid|null}\n\t */\n\tgetVariationGridComponent()\n\t{\n\t\treturn Reflection.getClass('BX.Catalog.ProductServiceGrid.Instance');\n\t}\n\n\tunsubscribeGridEvents()\n\t{\n\t\tconst gridComponent = this.getVariationGridComponent();\n\t\tif (gridComponent)\n\t\t{\n\t\t\tgridComponent.destroy();\n\t\t}\n\n\t\tconst popup = this.getGrid()?.getSettingsWindow()?.getPopup();\n\t\tif (popup)\n\t\t{\n\t\t\tEventEmitter.emit(this.getGrid().getSettingsWindow().getPopup(), 'onDestroy');\n\t\t}\n\n\t\tEventEmitter.unsubscribeAll('BX.Main.grid:paramsUpdated');\n\t}\n\n\tajaxSuccessHandler(event: BaseEvent)\n\t{\n\t\tconst [, xhrData] = event.getCompatData();\n\n\t\tif (xhrData.url.indexOf(this.getReloadUrl()) === 0)\n\t\t{\n\t\t\tthis.setGridControlCache(null);\n\t\t}\n\t}\n\n\t// ajax form initializes every \"save\" action\n\tsubscribeToFormSubmit()\n\t{\n\t\tEventEmitter.subscribe(this._editor._ajaxForm, 'onBeforeSubmit', this.onBeforeSubmitForm.bind(this));\n\t}\n\n\tmarkAsChangedHandler()\n\t{\n\t\tif (!this._editor.isNew())\n\t\t{\n\t\t\tthis.markAsChanged();\n\t\t}\n\t}\n\n\tcheckEditorToolbar()\n\t{\n\t\tthis._isChanged = false;\n\n\t\tif (this._editor.getActiveControlCount() > 0)\n\t\t{\n\t\t\tthis._editor.showToolPanel();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._editor.hideToolPanel();\n\t\t}\n\n\t\tif (this._editor._toolPanel)\n\t\t{\n\t\t\tthis._editor._toolPanel.clearErrors();\n\t\t}\n\t}\n\n\tgetGridControl()\n\t{\n\t\treturn this._editor.getControlById('service_grid');\n\t}\n\n\tonBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tsignedParameters: this.getSignedParameters()\n\t\t};\n\n\t\tthis.unsubscribeGridEvents();\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getConfigStringParam('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getConfigStringParam('signedParameters', '');\n\t}\n\n\tgetGridId()\n\t{\n\t\treturn this.getConfigStringParam('gridId', '');\n\t}\n\n\tgetGrid()\n\t{\n\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.gridManager.getInstanceById(this.getGridId());\n\t}\n\n\tonBeforeSubmitForm(event: BaseEvent)\n\t{\n\t\tconst [, eventArgs] = event.getCompatData();\n\t\tconst grid = this.getGrid();\n\n\t\tif (!grid)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst skuGridName = this.getGridId();\n\t\tconst skuGridData = grid.getRows().getEditSelectedValues();\n\t\tconst copyItemsMap = grid.getParam('COPY_ITEMS_MAP', {});\n\n\t\t// replace sku custom properties edit data names with original names\n\t\tfor (let id in skuGridData)\n\t\t{\n\t\t\tif (!skuGridData.hasOwnProperty(id))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (let name in skuGridData[id])\n\t\t\t{\n\t\t\t\tif (!skuGridData[id].hasOwnProperty(name))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (name.includes('SKU_GRID_CATALOG_GROUP')\n\t\t\t\t\t|| name.includes('SKU_GRID_PURCHASING')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tfor (let priceField in skuGridData[id][name])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (skuGridData[id][name].hasOwnProperty(priceField))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tskuGridData[id][priceField] = skuGridData[id][name][priceField];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (name.includes('[EDIT_HTML]'))\n\t\t\t\t{\n\t\t\t\t\tlet newName = name.replace('[EDIT_HTML]', '');\n\n\t\t\t\t\t// lookup for a custom file fields\n\t\t\t\t\tif (newName.endsWith('_custom'))\n\t\t\t\t\t{\n\t\t\t\t\t\tif ('bxu_files[]' in skuGridData[id][name])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tskuGridData[id][name].isFile = true;\n\t\t\t\t\t\t\tdelete skuGridData[id][name]['bxu_files[]'];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (skuGridData[id][name].isFile)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfor (let fieldName in skuGridData[id][name])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (skuGridData[id][name].hasOwnProperty(fieldName))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t// check for new files like \"MORE_PHOTO_n1[name]\"(multiple) or \"DETAIL_PICTURE[name]\"(single)\n\t\t\t\t\t\t\t\t\tlet newFilesRegExp = new RegExp(/([0-9A-Za-z_]+?(_n\\d+)*)\\[([A-Za-z_]+)\\]/);\n\n\t\t\t\t\t\t\t\t\tif (newFilesRegExp.test(fieldName))\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tlet fileCounter, fileSetting;\n\n\t\t\t\t\t\t\t\t\t\t[, fileCounter, , fileSetting] = fieldName.match(newFilesRegExp);\n\n\t\t\t\t\t\t\t\t\t\tif (fileCounter && fileSetting)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tskuGridData[id][name][fileCounter] = skuGridData[id][name][fileCounter] || {};\n\t\t\t\t\t\t\t\t\t\t\tskuGridData[id][name][fileCounter][fileSetting] = skuGridData[id][name][fieldName];\n\t\t\t\t\t\t\t\t\t\t\tdelete skuGridData[id][name][fieldName];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tskuGridData[id][newName] = skuGridData[id][name];\n\t\t\t\t\tdelete skuGridData[id][name];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!Type.isNil(copyItemsMap[id]))\n\t\t\t{\n\t\t\t\tskuGridData[id]['COPY_SKU_ID'] = copyItemsMap[id];\n\t\t\t}\n\t\t}\n\n\t\tif (!Type.isPlainObject(eventArgs.options))\n\t\t{\n\t\t\teventArgs.options = {};\n\t\t}\n\n\t\tif (!Type.isPlainObject(eventArgs.options.data))\n\t\t{\n\t\t\teventArgs.options.data = {};\n\t\t}\n\n\t\teventArgs.options.data[skuGridName] = skuGridData;\n\n\t\tthis.areaHeight = this.getGridControl().getWrapper().offsetHeight;\n\t}\n}","import IblockSectionController from './iblock-section/controller';\nimport {type BaseEvent, EventEmitter} from 'main.core.events'\nimport VariationGridController from './variation-grid/controller';\nimport VariationLinkController from './variation-link/controller';\nimport GoogleMapController from './google-map/controller';\nimport EmployeeController from './employee/controller';\nimport UserController from './user/controller';\nimport IblockElementController from './iblock-element/controller';\nimport BindingToCrmElementController from './binding-to-crm-element/controller';\nimport FieldConfiguratorController from './field-configurator/controller';\nimport ProductServiceGridController from \"./product-service-grid/controller\"\n\nexport default class ControllersFactory\n{\n\tconstructor()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorControllerFactory:onInitialize', (event: BaseEvent) => {\n\t\t\tconst [, eventArgs] = event.getCompatData();\n\t\t\teventArgs.methods['entityCard'] = this.factory.bind(this);\n\t\t});\n\t}\n\n\tfactory(type, controlId, settings)\n\t{\n\t\tif (type === 'field_configurator')\n\t\t{\n\t\t\treturn new FieldConfiguratorController(controlId, settings);\n\t\t}\n\n\t\tif (type === 'iblock_section')\n\t\t{\n\t\t\treturn new IblockSectionController(controlId, settings);\n\t\t}\n\n\t\tif (type === 'iblock_element')\n\t\t{\n\t\t\treturn new IblockElementController(controlId, settings);\n\t\t}\n\n\t\tif (type === 'variation_grid')\n\t\t{\n\t\t\treturn new VariationGridController(controlId, settings);\n\t\t}\n\n\t\tif (type === 'variation_link')\n\t\t{\n\t\t\treturn new VariationLinkController(controlId, settings);\n\t\t}\n\n\t\tif (type === 'google_map')\n\t\t{\n\t\t\treturn new GoogleMapController(controlId, settings);\n\t\t}\n\n\t\tif (type === 'employee')\n\t\t{\n\t\t\treturn new EmployeeController(controlId, settings);\n\t\t}\n\n\t\tif (type === 'user')\n\t\t{\n\t\t\treturn new UserController(controlId, settings);\n\t\t}\n\n\t\tif (type === 'binding_to_crm_element')\n\t\t{\n\t\t\treturn new BindingToCrmElementController(controlId, settings);\n\t\t}\n\n\t\tif (type === 'service_grid')\n\t\t{\n\t\t\treturn new ProductServiceGridController(controlId, settings);\n\t\t}\n\n\t\treturn null;\n\t}\n}","import {Event, Tag, Text} from \"main.core\";\n\nexport default class IblockDirectoryFieldItem extends BX.UI.EntityEditorUserFieldListItem\n{\n\tfileChanged = false;\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new this;\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tlayout()\n\t{\n\t\tif (this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._wrapper = Tag.render`\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row\"></div>\n\t\t\t`;\n\n\t\tthis._fileInput = Tag.render`\n\t\t\t\t<input class=\"input-image-hidden\" value=\"${BX.prop.getString(this._data, 'FILE_ID', '')}\" type=\"file\" accept=\"image/*\">\n\t\t\t`;\n\t\tEvent.bind(this._fileInput, 'change', this.onFileLoaderChange.bind(this));\n\t\tconst link = BX.prop.getString(this._data, 'IMAGE_SRC', '');\n\t\tthis._wrapper.appendChild(\n\t\t\tTag.render`\n\t\t\t<label class=\"catalog-dictionary-item ${link === '' ? 'catalog-dictionary-item-empty' : ''}\">\n\t\t\t\t<img src=\"${link}\" alt=\"\">\n\t\t\t\t${this._fileInput}\n\t\t\t</label>\n\t\t\t`\n\t\t);\n\n\t\tconst labelText = Text.encode(BX.prop.getString(this._data, 'TEXT', ''));\n\t\tthis._labelInput = Tag.render`\n\t\t\t\t<input \n\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t\tvalue=\"${labelText}\"\n\t\t\t\t\tplaceholder=\"${BX.message('CATALOG_ENTITY_CARD_NEW_FIELD_ITEM_PLACEHOLDER')}\"\n\t\t\t\t>\n\t\t\t`;\n\t\tthis._wrapper.appendChild(this._labelInput);\n\n\t\tconst deleteButton = Tag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-remove-block\"></div>\n\t\t\t`;\n\n\t\tEvent.bind(deleteButton, 'click', this.onDeleteButtonClick.bind(this));\n\t\tthis._wrapper.appendChild(deleteButton);\n\n\t\tvar anchor = BX.prop.getElementNode(this._settings, 'anchor');\n\t\tif (anchor)\n\t\t{\n\t\t\tthis._container.insertBefore(this._wrapper, anchor);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._container.appendChild(this._wrapper);\n\t\t}\n\n\t\tthis._hasLayout = true;\n\t}\n\n\tonFileLoaderChange(event)\n\t{\n\t\tconst input = event.target;\n\t\tif (input.files && input.files[0])\n\t\t{\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onload = function(e) {\n\t\t\t\tinput.parentNode.querySelector('img').src = e.target.result;\n\t\t\t};\n\n\t\t\tthis.fileChanged = true;\n\t\t\treader.readAsDataURL(input.files[0]);\n\t\t\tinput.parentNode.classList.remove('catalog-dictionary-item-empty');\n\t\t}\n\t}\n\n\tisFileChanged()\n\t{\n\t\treturn this.fileChanged;\n\t}\n\n\tprepareData()\n\t{\n\t\tconst textValue = this._labelInput ? BX.util.trim(this._labelInput.value) : '';\n\t\tconst fileValue = (this._fileInput && this._fileInput.files && this._fileInput.files[0]) ? this._fileInput.files[0] : {};\n\n\t\tconst data = {\n\t\t\t'VALUE': {\n\t\t\t\tvalue: textValue,\n\t\t\t\tfile: fileValue\n\t\t\t},\n\t\t\t'XML_ID': '',\n\t\t\t'FILE_ID': ''\n\t\t};\n\t\tconst xmlId = BX.prop.getString(this._data, 'ID', '');\n\t\tif (BX.type.isNotEmptyString(xmlId))\n\t\t{\n\t\t\tdata['XML_ID'] = xmlId;\n\t\t\tdata['FILE_ID'] = BX.prop.getString(this._data, 'FILE_ID', '');\n\t\t}\n\n\t\treturn data;\n\t}\n}","import {Dom, Event, Reflection, Tag, Text, Type} from \"main.core\";\nimport IblockDirectoryFieldItem from \"./iblock-directory-field-item\";\n\nexport default class IblockFieldConfigurator extends BX.UI.EntityEditorFieldConfigurator\n{\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new this;\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._enumItems = [];\n\t}\n\tlayoutInternal()\n\t{\n\t\tthis._wrapper.appendChild(this.getInputContainer());\n\t\tif(this._typeId === \"list\" || this._typeId === \"multilist\" || this._typeId === \"directory\")\n\t\t{\n\t\t\tthis._wrapper.appendChild(Tag.render`<hr class=\"ui-entity-editor-line\">`);\n\t\t\tif (BX.prop.get(this._field?.getSchemeElement().getData(), 'isConfigurable', null) !== false)\n\t\t\t{\n\t\t\t\tthis._wrapper.appendChild(this.getEnumerationContainer());\n\t\t\t}\n\t\t}\n\n\t\tthis._wrapper.appendChild(this.getOptionContainer());\n\t\tthis._wrapper.appendChild(this.getErrorContainer());\n\t\tDom.append(Tag.render`<hr class=\"ui-entity-editor-line\">`, this._wrapper);\n\t\tthis._wrapper.appendChild(this.getButtonContainer());\n\t}\n\tgetOptionContainer()\n\t{\n\t\tvar isNew = (this._field === null);\n\t\tthis._optionWrapper = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\"></div>\n\t\t`;\n\n\t\tif (this._typeId === \"datetime\" || this._typeId === \"multidatetime\")\n\t\t{\n\t\t\tthis._isTimeEnabledCheckBox = this.getIsTimeEnabledCheckBox();\n\t\t}\n\n\t\tif (this._typeId !== \"boolean\" && this._enableMandatoryControl)\n\t\t{\n\t\t\tthis._isRequiredCheckBox = this.getIsRequiredCheckBox();\n\t\t}\n\n\t\tif (this.isAllowedMultipleCheckBox())\n\t\t{\n\t\t\tthis._isMultipleCheckBox = this.getMultipleCheckBox();\n\t\t}\n\n\t\tthis._isPublic = this.getIsPublicCheckBox();\n\n\t\t//region Show Always\n\t\tthis._showAlwaysCheckBox = this.createOption({\n\t\t\tcaption: BX.message('UI_ENTITY_EDITOR_SHOW_ALWAYS'),\n\t\t\thelpUrl: 'https://helpdesk.bitrix24.ru/open/7046149/',\n\t\t\thelpCode: '9627471'\n\t\t});\n\t\tthis._showAlwaysCheckBox.checked = (\n\t\t\tisNew\n\t\t\t\t? BX.prop.getBoolean(this._settings, 'showAlways', true)\n\t\t\t\t: this._field.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)\n\t\t);\n\n\t\tif (!this.isAllowedShowAlwaysCheckBox())\n\t\t{\n\t\t\tDom.style(this._showAlwaysCheckBox.closest('div.ui-ctl-checkbox'), 'display', 'none');\n\t\t}\n\t\t//endregion\n\n\t\treturn this._optionWrapper;\n\t}\n\n\tisAllowedMultipleCheckBox()\n\t{\n\t\tif (BX.prop.get(this?._field?.getSchemeElement()?._settings, 'allowedMultiple', true) === false)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tif (this._typeId === 'boolean')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst isEnabledOfferTree = this?._field?.getSchemeElement()?._settings?.isEnabledOfferTree;\n\t\tconst isMultiple = this?._field?.getSchemeElement()?._settings?.multiple;\n\n\t\treturn !isEnabledOfferTree || isMultiple;\n\t}\n\n\tisAllowedShowAlwaysCheckBox()\n\t{\n\t\treturn true;\n\t}\n\n\tgetInputTitle()\n\t{\n\t\tconst manager = this._editor.getUserFieldManager();\n\t\treturn this._field ? this._field.getTitle() : manager.getDefaultFieldLabel(this._typeId);\n\t}\n\tgetErrorContainer()\n\t{\n\t\tthis._errorContainer = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\"></div>\n\t\t`;\n\t\treturn this._errorContainer;\n\t}\n\n\tgetEnumerationContainer()\n\t{\n\t\tconst enumWrapper = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t<div class=\"ui-entity-editor-block-title\">\n\t\t\t\t\t<span class=\"ui-entity-editor-block-title-text\">${BX.message(\"UI_ENTITY_EDITOR_UF_ENUM_ITEMS\")}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis._enumItemContainer = Tag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block\"></div>\n\t\t\t`;\n\t\tDom.append(this._enumItemContainer, enumWrapper);\n\n\t\tconst addButton = Tag.render`\n\t\t\t\t<div class=\"ui-entity-card-content-add-field\">\n\t\t\t\t\t${BX.message(\"UI_ENTITY_EDITOR_ADD\")}\n\t\t\t\t</div>\n\t\t\t`;\n\t\tEvent.bind(addButton, \"click\", this.onEnumerationItemAddButtonClick.bind(this));\n\n\t\tDom.append(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block-add-field\">\n\t\t\t\t\t${addButton}\n\t\t\t\t</div>\n\t\t\t`,\n\t\t\tenumWrapper\n\t\t);\n\n\t\tif (this._field)\n\t\t{\n\t\t\tthis._field.getItems().forEach(enumFields => {\n\t\t\t\tif (enumFields.VALUE !== '')\n\t\t\t\t{\n\t\t\t\t\tthis.createEnumerationItem({\n\t\t\t\t\t\tVALUE: enumFields.NAME,\n\t\t\t\t\t\tFILE_ID: enumFields.IMAGE || null,\n\t\t\t\t\t\tIMAGE_SRC: enumFields.IMAGE_SRC || '',\n\t\t\t\t\t\tTEXT: enumFields.TEXT || '',\n\t\t\t\t\t\tID: enumFields.VALUE\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst lastItem = this.createEnumerationItem();\n\t\tlastItem.focus();\n\t\tthis.initItemClickHandlers();\n\t\treturn enumWrapper;\n\t}\n\n\tonEnumerationItemAddButtonClick()\n\t{\n\t\tthis.unbindItemClickHandlers();\n\t\tthis.createEnumerationItem().focus();\n\t\tthis.bindLastItemClickHandler();\n\t}\n\n\tonEnumerationItemClick()\n\t{\n\t\tthis.unbindItemClickHandlers();\n\t\tthis.createEnumerationItem();\n\t\tthis.bindLastItemClickHandler();\n\t}\n\n\tinitItemClickHandlers()\n\t{\n\t\tthis.unbindItemClickHandlers();\n\t\tthis.bindLastItemClickHandler();\n\t}\n\n\tunbindItemClickHandlers()\n\t{\n\t\tthis._enumItems.forEach(item => Event.unbindAll(item._labelInput, 'click'));\n\t}\n\n\tbindLastItemClickHandler()\n\t{\n\t\tconst lastItem = this._enumItems[this._enumItems.length - 1];\n\t\tif (lastItem)\n\t\t{\n\t\t\tEvent.bindOnce(lastItem._labelInput, 'click', this.onEnumerationItemClick.bind(this));\n\t\t}\n\t}\n\n\tcreateEnumerationItem(data)\n\t{\n\t\tlet item = null;\n\t\tif (this._typeId === 'directory')\n\t\t{\n\t\t\titem = IblockDirectoryFieldItem.create(\n\t\t\t\t\"\",\n\t\t\t\t{\n\t\t\t\t\tconfigurator: this,\n\t\t\t\t\tcontainer: this._enumItemContainer,\n\t\t\t\t\tdata: data\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\titem = BX.UI.EntityEditorUserFieldListItem.create(\n\t\t\t\t\"\",\n\t\t\t\t{\n\t\t\t\t\tconfigurator: this,\n\t\t\t\t\tcontainer: this._enumItemContainer,\n\t\t\t\t\tdata: data\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis._enumItems.push(item);\n\t\titem.layout();\n\t\treturn item;\n\t}\n\n\tremoveEnumerationItem(item)\n\t{\n\t\tfor (var i = 0, length = this._enumItems.length; i < length; i++)\n\t\t{\n\t\t\tif (this._enumItems[i] === item)\n\t\t\t{\n\t\t\t\tthis._enumItems[i].clearLayout();\n\t\t\t\tthis._enumItems.splice(i, 1);\n\t\t\t\tthis.initItemClickHandlers();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tprepareSaveParams(e)\n\t{\n\t\tconst params = super.prepareSaveParams(this, arguments);\n\t\tif (this._typeId === 'list' || this._typeId === 'multilist')\n\t\t{\n\t\t\tparams['enumeration'] = [];\n\t\t\tconst hashes = [];\n\t\t\tthis._enumItems.forEach(enumItem => {\n\t\t\t\tif (!(enumItem instanceof BX.UI.EntityEditorUserFieldListItem))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst enumData = enumItem.prepareData();\n\t\t\t\tif (!enumData)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst hash = BX.util.hashCode(enumData['VALUE']);\n\t\t\t\tif (BX.util.in_array(hash, hashes))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\thashes.push(hash);\n\n\t\t\t\tif (Type.isNil(enumData['ID']))\n\t\t\t\t{\n\t\t\t\t\tenumData['ID'] = Text.getRandom();\n\t\t\t\t}\n\n\t\t\t\tenumData['SORT'] = (params['enumeration'].length + 1) * 100;\n\t\t\t\tparams['enumeration'].push(enumData);\n\t\t\t});\n\t\t}\n\t\tif (this._typeId === 'directory')\n\t\t{\n\t\t\tparams['enumeration'] = [];\n\t\t\tthis._enumItems.forEach(enumItem => {\n\t\t\t\tif (!(enumItem instanceof IblockDirectoryFieldItem))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst enumData = enumItem.prepareData();\n\t\t\t\tif (!enumData)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tenumData['SORT'] = (params['enumeration'].length + 1) * 100;\n\t\t\t\tparams['enumeration'].push(enumData);\n\t\t\t});\n\t\t}\n\t\telse if (this._typeId === 'datetime' || this._typeId === 'multidatetime')\n\t\t{\n\t\t\tparams['enableTime'] = this._isTimeEnabledCheckBox.checked;\n\t\t}\n\n\t\tif (this._field)\n\t\t{\n\t\t\tif (this._isMultipleCheckBox)\n\t\t\t{\n\t\t\t\tparams[\"multiple\"] = this._isMultipleCheckBox.checked;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(this._typeId === \"boolean\")\n\t\t\t{\n\t\t\t\tparams[\"multiple\"] = false;\n\t\t\t}\n\t\t\telse if(this._isMultipleCheckBox)\n\t\t\t{\n\t\t\t\tparams[\"multiple\"] = this._isMultipleCheckBox.checked;\n\t\t\t}\n\t\t}\n\n\t\tif (this._isPublic)\n\t\t{\n\t\t\tparams[\"isPublic\"] = this._isPublic.checked;\n\t\t}\n\n\t\tif (this._typeId === 'custom')\n\t\t{\n\t\t\tparams['userType'] = this._field?.getSchemeElement()?._settings?.settings['USER_TYPE'];\n\t\t}\n\n\t\treturn params;\n\t}\n\n\tgetMultipleCheckBox()\n\t{\n\t\tconst checkBox = this.createOption({caption: BX.message(\"UI_ENTITY_EDITOR_UF_MULTIPLE_FIELD\")});\n\t\tif (\n\t\t\tthis._field instanceof BX.UI.EntityEditorMultiText\n\t\t\t|| this._field instanceof BX.UI.EntityEditorMultiNumber\n\t\t\t|| this._field instanceof BX.UI.EntityEditorMultiList\n\t\t\t|| this._field instanceof BX.UI.EntityEditorMultiDatetime\n\t\t\t|| this._field instanceof BX.UI.EntityEditorMultiMoney\n\t\t\t|| (this._field instanceof BX.UI.EntityEditorCustom && this._field.getSchemeElement()._settings.multiple)\n\t\t)\n\t\t{\n\t\t\tcheckBox.checked = true;\n\t\t}\n\n\t\treturn checkBox;\n\t}\n\n\tonSaveButtonClick()\n\t{\n\t\tif(this._isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._mandatoryConfigurator)\n\t\t{\n\t\t\tif(this._mandatoryConfigurator.isChanged())\n\t\t\t{\n\t\t\t\tthis._mandatoryConfigurator.acceptChanges();\n\t\t\t}\n\t\t\tthis._mandatoryConfigurator.close();\n\t\t}\n\n\t\tlet params = this.prepareSaveParams();\n\n\t\tif (this._field instanceof BX.UI.EntityEditorCustom)\n\t\t{\n\t\t\tthis._field.getSchemeElement().mergeSettings({multiple: params.multiple});\n\n\t\t\tlet modes = ['edit', 'view'];\n\t\t\tfor (let i = 0; i < modes.length; i++)\n\t\t\t{\n\t\t\t\tlet htmlListName = BX.prop.getString(this._field.getSchemeElement().getData(), modes[i] + 'List', null);\n\t\t\t\tlet htmlList = BX.prop.getObject(this._field.getModel().getData(), htmlListName, null);\n\n\t\t\t\tif (htmlList !== null)\n\t\t\t\t{\n\t\t\t\t\tlet newHtml = params.multiple ? htmlList.MULTIPLE : htmlList.SINGLE;\n\t\t\t\t\tlet htmlName = BX.prop.getString(this._field.getSchemeElement().getData(), modes[i], null);\n\n\t\t\t\t\tif (BX.prop.getString(this._field.getModel().getData(), htmlName, null) !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._field.getModel().setField(htmlName, newHtml);\n\t\t\t\t\t\tthis._field.getModel().setInitFieldValue(htmlName, newHtml);\n\t\t\t\t\t\tif (modes[i] === 'view')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (newHtml === '')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tDom.clean(this._field.getContentWrapper());\n\t\t\t\t\t\t\t\tthis._field.getContentWrapper().appendChild(BX.create(\"div\",\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tprops: { className: \"ui-entity-editor-content-block-text\" },\n\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"UI_ENTITY_EDITOR_FIELD_EMPTY\")\n\t\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis._field.getContentWrapper().innerHTML = newHtml;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._field?.getSchemeElement()?.setDataParam('isPublic', params['isPublic']);\n\n\t\tBX.onCustomEvent(this, \"onSave\", [ this, params]);\n\t}\n\n\tgetIsRequiredCheckBox()\n\t{\n\t\tlet checkBox;\n\t\tif (this._mandatoryConfigurator)\n\t\t{\n\t\t\tcheckBox = this.createOption(\n\t\t\t\t{\n\t\t\t\t\tcaption: this._mandatoryConfigurator.getTitle() + \":\",\n\t\t\t\t\tlabelSettings: {props: {className: \"ui-entity-new-field-addiction-label\"}},\n\t\t\t\t\tcontainerSettings: {style: {alignItems: \"center\"}},\n\t\t\t\t\telements: this._mandatoryConfigurator.getButton().prepareLayout()\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tcheckBox.checked = (this._field && this._field.isRequired())\n\t\t\t\t|| this._mandatoryConfigurator.isCustomized();\n\n\t\t\tthis._mandatoryConfigurator.setSwitchCheckBox(checkBox);\n\t\t\tthis._mandatoryConfigurator.setLabel(checkBox.nextSibling);\n\n\t\t\tthis._mandatoryConfigurator.setEnabled(checkBox.checked);\n\t\t\tthis._mandatoryConfigurator.adjust();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcheckBox = this.createOption({caption: BX.message(\"UI_ENTITY_EDITOR_UF_REQUIRED_FIELD\")});\n\t\t\tcheckBox.checked = this._field && this._field.isRequired();\n\t\t}\n\t\treturn checkBox;\n\t}\n\n\tgetIsTimeEnabledCheckBox()\n\t{\n\t\tconst checkBox = this.createOption({caption: BX.message(\"UI_ENTITY_EDITOR_UF_ENABLE_TIME\")});\n\t\tcheckBox.checked = this._field && this._field.isTimeEnabled();\n\t\treturn checkBox;\n\t}\n\n\tgetIsPublicCheckBox()\n\t{\n\t\tconst checkBox = this.createOption({caption: BX.message(\"CATALOG_ENTITY_EDITOR_IS_PUBLIC_PROPERTY\")});\n\t\tif (!this._field)\n\t\t{\n\t\t\tcheckBox.checked = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcheckBox.checked = this._field.getSchemeElement() && BX.prop.get(this._field.getSchemeElement().getData(), \"isPublic\", true);\n\t\t}\n\t\treturn checkBox;\n\t}\n}\n\nReflection.namespace('BX.Catalog').IblockFieldConfigurator = IblockFieldConfigurator;","import IblockFieldConfigurator from './iblock-field-configurator'\n\nexport default class IblockFieldConfigurationManager extends BX.UI.EntityConfigurationManager\n{\n\tcreateFieldConfigurator(params, parent)\n\t{\n\t\tif (!BX.type.isPlainObject(params))\n\t\t{\n\t\t\tthrow \"IblockFieldConfigurationManager: The 'params' argument must be object.\";\n\t\t}\n\n\t\treturn this.getSimpleFieldConfigurator(params, parent);\n\t}\n\n\tgetSimpleFieldConfigurator(params, parent)\n\t{\n\t\tlet typeId = \"\";\n\t\tconst field = BX.prop.get(params, 'field', null);\n\t\tif (field)\n\t\t{\n\t\t\ttypeId = field.getType();\n\t\t\tfield.setVisible(false);\n\n\t\t\tif (!BX.prop.get(field.getSchemeElement().getData(), \"isProductProperty\", false))\n\t\t\t{\n\t\t\t\treturn this._fieldConfigurator = BX.UI.EntityEditorFieldConfigurator.create(\n\t\t\t\t\t\"\",\n\t\t\t\t\t{\n\t\t\t\t\t\teditor: this._editor,\n\t\t\t\t\t\tschemeElement: null,\n\t\t\t\t\t\tmodel: parent._model,\n\t\t\t\t\t\tmode: BX.UI.EntityEditorMode.edit,\n\t\t\t\t\t\tparent: parent,\n\t\t\t\t\t\ttypeId: typeId,\n\t\t\t\t\t\tfield: field,\n\t\t\t\t\t\tmandatoryConfigurator: null\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t\telse if (BX.prop.get(field.getSchemeElement().getData(), \"userType\", false))\n\t\t\t{\n\t\t\t\ttypeId = BX.prop.getString(field.getSchemeElement().getData(), \"userType\")\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttypeId = BX.prop.get(params, 'typeId', BX.UI.EntityUserFieldType.string);\n\t\t}\n\n\t\tthis._fieldConfigurator = IblockFieldConfigurator.create(\n\t\t\t'',\n\t\t\t{\n\t\t\t\teditor: this._editor,\n\t\t\t\tschemeElement: null,\n\t\t\t\tmodel: parent._model,\n\t\t\t\tmode: BX.UI.EntityEditorMode.edit,\n\t\t\t\tparent: parent,\n\t\t\t\ttypeId: typeId,\n\t\t\t\tfield: field,\n\t\t\t\tmandatoryConfigurator: null\n\t\t\t}\n\t\t);\n\n\t\treturn this._fieldConfigurator;\n\t}\n\n\tisCreationEnabled()\n\t{\n\t\treturn this._editor?.isSectionEditEnabled() && !this._editor?.isReadOnly();\n\t}\n\n\tgetCreationPageUrl(typeId)\n\t{\n\t\treturn this.creationPageUrl;\n\t}\n\n\topenCreationPageUrl(typeId)\n\t{\n\t\tBX.SidePanel.Instance.open(this.getCreationPageUrl(typeId), {\n\t\t\tallowChangeHistory: false,\n\t\t\tcacheable: false\n\t\t});\n\t}\n\n\tsetCreationPageUrl(url)\n\t{\n\t\treturn this.creationPageUrl = url;\n\t}\n\n\tgetTypeInfos()\n\t{\n\t\tvar items = [];\n\t\titems.push({\n\t\t\tname: \"string\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_UF_STRING_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_STRING_LEGEND\")\n\t\t});\n\t\titems.push({\n\t\t\tname: \"list\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_UF_ENUM_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_ENUM_LEGEND\")\n\t\t});\n\t\titems.push({\n\t\t\tname: \"datetime\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_UF_DATETIME_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_DATETIME_LEGEND\")\n\t\t});\n\t\titems.push({\n\t\t\tname: \"address\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_UF_ADDRESS_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_ADDRESS_LEGEND\")\n\t\t});\n\n\t\titems.push({\n\t\t\tname: \"money\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_UF_MONEY_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_MONEY_LEGEND\")\n\t\t});\n\t\titems.push({\n\t\t\tname: \"boolean\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_BOOLEAN_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_BOOLEAN_LEGEND\")\n\t\t});\n\t\titems.push({\n\t\t\tname: \"double\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_UF_DOUBLE_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_DOUBLE_LEGEND\")\n\t\t});\n\t\titems.push({\n\t\t\tname: \"directory\",\n\t\t\ttitle: BX.message(\"CATALOG_ENTITY_CARD_DICTIONARY_TITLE\"),\n\t\t\tlegend: BX.message(\"CATALOG_ENTITY_CARD_DICTIONARY_LEGEND\")\n\t\t});\n\n\t\titems.push({\n\t\t\tname: \"custom\",\n\t\t\ttitle: BX.message(\"UI_ENTITY_EDITOR_UF_CUSTOM_TITLE\"),\n\t\t\tlegend: BX.message(\"UI_ENTITY_EDITOR_UF_CUSTOM_LEGEND\")\n\t\t});\n\n\t\treturn items;\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new this;\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}","import {Dom, Event, Tag} from \"main.core\";\n\nexport default class GridFieldConfigurator extends BX.UI.EntityEditorFieldConfigurator\n{\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new this;\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\t// ToDo remove unused methods\n\tappendEnumerationSettings()\n\t{\n\t\tif (this._typeId === \"list\" || this._typeId === \"multilist\")\n\t\t{\n\t\t\tDom.append(Tag.render`<hr class=\"ui-entity-editor-line\">`, this._wrapper);\n\n\t\t\tconst enumWrapper = Tag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t\t<div class=\"ui-entity-editor-block-title\">\n\t\t\t\t\t\t<span class=\"ui-entity-editor-block-title-text\">${BX.message(\"UI_ENTITY_EDITOR_UF_ENUM_ITEMS\")}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tDom.append(enumWrapper, this._wrapper);\n\n\t\t\tthis._enumItemContainer = Tag.render`\n\t\t\t\t\t<div class=\"ui-entity-editor-content-block\"></div>\n\t\t\t\t`;\n\t\t\tDom.append(this._enumItemContainer, enumWrapper);\n\n\t\t\tconst addButton = Tag.render`\n\t\t\t\t\t<div class=\"ui-entity-card-content-add-field\">\n\t\t\t\t\t\t${BX.message(\"UI_ENTITY_EDITOR_ADD\")}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\tEvent.bind(addButton, \"click\", this.onEnumerationItemAddButtonClick.bind(this));\n\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"ui-entity-editor-content-block-add-field\">\n\t\t\t\t\t\t${addButton}\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\tenumWrapper\n\t\t\t);\n\n\t\t\tif (this._field)\n\t\t\t{\n\t\t\t\tthis._field.getItems().forEach(enumFields => {\n\t\t\t\t\tif (enumFields.VALUE !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.createEnumerationItem({\n\t\t\t\t\t\t\tVALUE: enumFields.NAME,\n\t\t\t\t\t\t\tID: enumFields.VALUE\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.createEnumerationItem();\n\t\t\tthis.initItemFocusHandlers();\n\t\t}\n\t}\n\n\tonEnumerationItemAddButtonClick()\n\t{\n\t\tthis.unbindItemFocusHandlers();\n\t\tthis.createEnumerationItem().focus();\n\t\tthis.bindLastItemFocusHandler();\n\t}\n\n\tonEnumerationItemFocus()\n\t{\n\t\tthis.unbindItemFocusHandlers();\n\t\tthis.createEnumerationItem();\n\t\tthis.bindLastItemFocusHandler();\n\t}\n\n\tinitItemFocusHandlers()\n\t{\n\t\tthis.unbindItemFocusHandlers();\n\t\tthis.bindLastItemFocusHandler();\n\t}\n\n\tunbindItemFocusHandlers()\n\t{\n\t\tthis._enumItems.forEach(item => Event.unbindAll(item._labelInput, 'focus'));\n\t}\n\n\tbindLastItemFocusHandler()\n\t{\n\t\tconst lastItem = this._enumItems[this._enumItems.length - 1];\n\t\tif (lastItem)\n\t\t{\n\t\t\tEvent.bindOnce(lastItem._labelInput, 'focus', this.onEnumerationItemFocus.bind(this));\n\t\t}\n\t}\n\n\tcreateEnumerationItem(data)\n\t{\n\t\tvar item = BX.UI.EntityEditorUserFieldListItem.create(\n\t\t\t\"\",\n\t\t\t{\n\t\t\t\tconfigurator: this,\n\t\t\t\tcontainer: this._enumItemContainer,\n\t\t\t\tdata: data\n\t\t\t}\n\t\t);\n\n\t\tthis._enumItems.push(item);\n\t\titem.layout();\n\t\treturn item;\n\t}\n\n\tremoveEnumerationItem(item)\n\t{\n\t\tfor (var i = 0, length = this._enumItems.length; i < length; i++)\n\t\t{\n\t\t\tif (this._enumItems[i] === item)\n\t\t\t{\n\t\t\t\tthis._enumItems[i].clearLayout();\n\t\t\t\tthis._enumItems.splice(i, 1);\n\t\t\t\tthis.initItemFocusHandlers();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tprepareSaveParams(e)\n\t{\n\t\tconst params = super.prepareSaveParams(this, arguments);\n\t\tif (this._typeId === 'list' || this._typeId === 'multilist')\n\t\t{\n\t\t\tparams['enumeration'] = [];\n\t\t\tconst hashes = [];\n\t\t\tthis._enumItems.forEach(enumItem => {\n\t\t\t\tif (!(enumItem instanceof BX.UI.EntityEditorUserFieldListItem))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst enumData = enumItem.prepareData();\n\t\t\t\tif (!enumData)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst hash = BX.util.hashCode(enumData['VALUE']);\n\t\t\t\tif (BX.util.in_array(hash, hashes))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\thashes.push(hash);\n\t\t\t\tenumData['SORT'] = (params['enumeration'].length + 1) * 100;\n\t\t\t\tparams['enumeration'].push(enumData);\n\t\t\t});\n\t\t}\n\t\telse if (this._typeId === 'datetime' || this._typeId === 'multidatetime')\n\t\t{\n\t\t\tparams['enableTime'] = this._isTimeEnabledCheckBox.checked;\n\t\t}\n\n\t\treturn params;\n\t}\n\n\tgetMultipleCheckBox()\n\t{\n\t\tvar checkBox = this.createOption({caption: BX.message(\"UI_ENTITY_EDITOR_UF_MULTIPLE_FIELD\")});\n\t\tif (\n\t\t\tthis._field instanceof BX.UI.EntityEditorMultiText\n\t\t\t|| this._field instanceof BX.UI.EntityEditorMultiNumber\n\t\t\t|| this._field instanceof BX.UI.EntityEditorMultiList\n\t\t\t|| this._field instanceof BX.UI.EntityEditorMultiDatetime\n\t\t)\n\t\t{\n\t\t\tcheckBox.checked = true;\n\t\t}\n\n\t\treturn checkBox;\n\t}\n\n\tgetIsRequiredCheckBox()\n\t{\n\t\tlet checkBox = null;\n\t\tif (this._typeId !== \"boolean\")\n\t\t{\n\t\t\tif (this._enableMandatoryControl)\n\t\t\t{\n\t\t\t\tif (this._mandatoryConfigurator)\n\t\t\t\t{\n\t\t\t\t\tcheckBox = this.createOption(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcaption: this._mandatoryConfigurator.getTitle() + \":\",\n\t\t\t\t\t\t\tlabelSettings: {props: {className: \"ui-entity-new-field-addiction-label\"}},\n\t\t\t\t\t\t\tcontainerSettings: {style: {alignItems: \"center\"}},\n\t\t\t\t\t\t\telements: this._mandatoryConfigurator.getButton().prepareLayout()\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tcheckBox.checked = (this._field && this._field.isRequired())\n\t\t\t\t\t\t|| this._mandatoryConfigurator.isCustomized();\n\n\t\t\t\t\tthis._mandatoryConfigurator.setSwitchCheckBox(checkBox);\n\t\t\t\t\tthis._mandatoryConfigurator.setLabel(checkBox.nextSibling);\n\n\t\t\t\t\tthis._mandatoryConfigurator.setEnabled(checkBox.checked);\n\t\t\t\t\tthis._mandatoryConfigurator.adjust();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcheckBox = this.createOption({caption: BX.message(\"UI_ENTITY_EDITOR_UF_REQUIRED_FIELD\")});\n\t\t\t\t\tcheckBox.checked = this._field && this._field.isRequired();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn checkBox;\n\t}\n\n\tgetIsTimeEnabledCheckBox()\n\t{\n\t\tvar checkBox = null;\n\t\tif (this._typeId === \"datetime\" || this._typeId === \"multidatetime\")\n\t\t{\n\t\t\tcheckBox = this.createOption({caption: BX.message(\"UI_ENTITY_EDITOR_UF_ENABLE_TIME\")});\n\t\t\tcheckBox.checked = this._field && this._field.isTimeEnabled();\n\t\t}\n\t\treturn checkBox;\n\t}\n}","import GridFieldConfigurator from './grid-field-configurator'\nimport {Loc, Reflection, Type} from 'main.core';\n\nexport default class GridFieldConfigurationManager extends BX.UI.EntityConfigurationManager\n{\n\tcreateFieldConfigurator(params, parent)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tthrow \"GridFieldConfigurationManager: The 'params' argument must be object.\";\n\t\t}\n\n\t\treturn this.getSimpleFieldConfigurator(params, parent);\n\t}\n\n\tgetSimpleFieldConfigurator(params, parent)\n\t{\n\t\tlet typeId = \"\";\n\t\tconst child = BX.prop.get(params, 'field', null);\n\t\tif (child)\n\t\t{\n\t\t\ttypeId = child.getType();\n\t\t\tchild.setVisible(false);\n\n\t\t\tif (!BX.prop.get(child.getSchemeElement().getData(), \"isProductProperty\", false))\n\t\t\t{\n\t\t\t\treturn this._fieldConfigurator = BX.UI.EntityEditorFieldConfigurator.create(\n\t\t\t\t\t\"\",\n\t\t\t\t\t{\n\t\t\t\t\t\teditor: this._editor,\n\t\t\t\t\t\tschemeElement: null,\n\t\t\t\t\t\tmodel: parent._model,\n\t\t\t\t\t\tmode: BX.UI.EntityEditorMode.edit,\n\t\t\t\t\t\tparent: parent,\n\t\t\t\t\t\ttypeId: typeId,\n\t\t\t\t\t\tfield: child,\n\t\t\t\t\t\tmandatoryConfigurator: null\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttypeId = BX.prop.get(params, 'typeId', BX.UI.EntityUserFieldType.string);\n\t\t}\n\n\t\tthis._fieldConfigurator = GridFieldConfigurator.create(\n\t\t\t'',\n\t\t\t{\n\t\t\t\teditor: this._editor,\n\t\t\t\tschemeElement: null,\n\t\t\t\tmodel: parent._model,\n\t\t\t\tmode: BX.UI.EntityEditorMode.edit,\n\t\t\t\tparent: parent,\n\t\t\t\ttypeId: typeId,\n\t\t\t\tfield: child,\n\t\t\t\tmandatoryConfigurator: null\n\t\t\t}\n\t\t);\n\n\t\treturn this._fieldConfigurator;\n\t}\n\n\tisSelectionEnabled()\n\t{\n\t\treturn false;\n\t}\n\n\tisCreationEnabled()\n\t{\n\t\treturn false;\n\t}\n\n\thasExternalForm(typeId)\n\t{\n\t\treturn true;\n\t}\n\n\tgetCreationPageUrl(typeId)\n\t{\n\t\tconst filtered = this.getTypeInfos().filter((item) => {\n\t\t\treturn item.name === typeId\n\t\t});\n\t\tif (filtered.length > 0)\n\t\t{\n\t\t\treturn this.creationPageUrl.replace('#PROPERTY_TYPE#', typeId);\n\t\t}\n\t}\n\n\topenCreationPageUrl(typeId)\n\t{\n\t\tconst okCallback = () => this.openCreationPageSlider(this.getCreationPageUrl(typeId));\n\t\tconst variationGridInstance = Reflection.getClass('BX.Catalog.VariationGrid.Instance');\n\n\t\tif (variationGridInstance)\n\t\t{\n\t\t\tvariationGridInstance.askToLossGridData(okCallback, null, {\n\t\t\t\tmessage: Loc.getMessage('CATALOG_ENTITY_CARD_UNSAVED_DATA_MESSAGE')\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tokCallback();\n\t\t}\n\t}\n\n\topenCreationPageSlider(url)\n\t{\n\t\tif (Type.isStringFilled(url))\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(url, {\n\t\t\t\twidth: 550,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tcacheable: false\n\t\t\t});\n\t\t}\n\t}\n\n\tsetCreationPageUrl(url)\n\t{\n\t\treturn this.creationPageUrl = url;\n\t}\n\n\tgetTypeInfos()\n\t{\n\t\treturn [\n\t\t\t{\n\t\t\t\tname: \"list\",\n\t\t\t\ttitle: BX.message(\"CATALOG_ENTITY_CARD_LIST_TITLE\"),\n\t\t\t\tlegend: BX.message(\"CATALOG_ENTITY_CARD_LIST_LEGEND\")\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"directory\",\n\t\t\t\ttitle: BX.message(\"CATALOG_ENTITY_CARD_DICTIONARY_TITLE\"),\n\t\t\t\tlegend: BX.message(\"CATALOG_ENTITY_CARD_DICTIONARY_LEGEND\")\n\t\t\t}\n\t\t];\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new this;\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n}","import {Text, Type} from 'main.core';\n\nexport default class LazyLoader\n{\n\tconstructor(id, settings)\n\t{\n\t\tthis.id = Type.isStringFilled(id) ? id : Text.getRandom();\n\t\tthis.settings = Type.isObjectLike(settings) ? settings : {};\n\n\t\tthis.container = this.settings.container;\n\t\tif (!this.container)\n\t\t{\n\t\t\tthrow 'Error: Could not find container.';\n\t\t}\n\n\t\tthis.serviceUrl = this.settings.serviceUrl || '';\n\t\tif (!Type.isStringFilled(this.serviceUrl))\n\t\t{\n\t\t\tthrow 'Error. Could not find service url.';\n\t\t}\n\n\t\tthis.tabId = this.settings.tabId || '';\n\t\tif (!Type.isStringFilled(this.tabId))\n\t\t{\n\t\t\tthrow 'Error: Could not find tab id.';\n\t\t}\n\n\t\tthis.params = Type.isObjectLike(this.settings.componentData) ? this.settings.componentData : {};\n\n\t\tthis.isRequestRunning = false;\n\t\tthis.loaded = false;\n\t}\n\n\tisLoaded()\n\t{\n\t\treturn this.loaded;\n\t}\n\n\tload()\n\t{\n\t\tif (!this.isLoaded())\n\t\t{\n\t\t\tthis.startRequest({...this.params, ...{'TABID': this.tabId}});\n\t\t}\n\t}\n\n\tstartRequest(params)\n\t{\n\t\tif (this.isRequestRunning)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.isRequestRunning = true;\n\n\t\tBX.ajax({\n\t\t\turl: this.serviceUrl,\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'html',\n\t\t\tdata: {\n\t\t\t\t'LOADERID': this.id,\n\t\t\t\t'PARAMS': params\n\t\t\t},\n\t\t\tonsuccess: this.onRequestSuccess.bind(this),\n\t\t\tonfailure: this.onRequestFailure.bind(this)\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tonRequestSuccess(data)\n\t{\n\t\tthis.isRequestRunning = false;\n\t\tthis.container.innerHTML = data;\n\t\tthis.loaded = true;\n\t}\n\n\tonRequestFailure()\n\t{\n\t\tthis.isRequestRunning = false;\n\t\tthis.loaded = true;\n\t}\n}","import {Dom, Event, Text, Type} from 'main.core';\nimport LazyLoader from './lazy-loader';\n\nexport default class Tab\n{\n\tconstructor(id, settings)\n\t{\n\t\tthis.id = Type.isStringFilled(id) ? id : Text.getRandom();\n\t\tthis.settings = Type.isObjectLike(settings) ? settings : {};\n\t\tthis.data = Type.isObjectLike(this.settings.data) ? this.settings.data : {};\n\n\t\tthis.manager = settings.manager || null;\n\n\t\tthis.container = this.settings.container;\n\t\tthis.menuContainer = this.settings.menuContainer;\n\n\t\tthis.active = Type.isBoolean(this.data.active) ? this.data.active : false;\n\t\tthis.enabled = Type.isBoolean(this.data.enabled) ? this.data.enabled : true;\n\n\t\tEvent.bind(\n\t\t\tthis.menuContainer.querySelector('a.catalog-entity-section-tab-link'),\n\t\t\t'click',\n\t\t\tthis.onMenuClick.bind(this)\n\t\t);\n\n\t\tthis.loader = null;\n\n\t\tif (Type.isObjectLike(this.data.loader))\n\t\t{\n\t\t\tthis.loader = new LazyLoader(this.id, {\n\t\t\t\t...this.data.loader,\n\t\t\t\t...{\n\t\t\t\t\ttabId: this.id,\n\t\t\t\t\tcontainer: this.container\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tisEnabled()\n\t{\n\t\treturn this.enabled;\n\t}\n\n\tisActive()\n\t{\n\t\treturn this.active;\n\t}\n\n\tsetActive(active)\n\t{\n\t\tactive = !!active;\n\n\t\tif (this.isActive() === active)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.active = active;\n\n\t\tif (this.isActive())\n\t\t{\n\t\t\tthis.showTab()\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideTab()\n\t\t}\n\t}\n\n\tshowTab()\n\t{\n\t\tDom.addClass(this.container, 'catalog-entity-section-tab-content-show');\n\t\tDom.removeClass(this.container, 'catalog-entity-section-tab-content-hide');\n\t\tDom.addClass(this.menuContainer, 'catalog-entity-section-tab-current');\n\n\t\tthis.container.style.display = '';\n\t\tthis.container.style.position = 'absolute';\n\t\tthis.container.style.top = 0;\n\t\tthis.container.style.left = 0;\n\t\tthis.container.style.width = '100%';\n\n\t\t(new BX.easing({\n\t\t\tduration: 350,\n\t\t\tstart: {opacity: 0, translateX: 100},\n\t\t\tfinish: {opacity: 100, translateX: 0},\n\t\t\ttransition: BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\tstep: (state) => {\n\t\t\t\tthis.container.style.opacity = state.opacity / 100;\n\t\t\t\tthis.container.style.transform = 'translateX(' + state.translateX + '%)';\n\t\t\t},\n\t\t\tcomplete: () => {\n\t\t\t\tDom.removeClass(this.container, 'catalog-entity-section-tab-content-show');\n\t\t\t\tthis.container.style.cssText = '';\n\n\t\t\t\tEvent.EventEmitter.emit(window, 'onEntityDetailsTabShow', [this]);\n\t\t\t}\n\t\t})).animate();\n\n\t}\n\n\thideTab()\n\t{\n\t\tDom.addClass(this.container, 'catalog-entity-section-tab-content-hide');\n\t\tDom.removeClass(this.container, 'catalog-entity-section-tab-content-show');\n\t\tDom.removeClass(this.menuContainer, 'catalog-entity-section-tab-current');\n\n\t\t(new BX.easing({\n\t\t\tduration: 350,\n\t\t\tstart: {opacity: 100},\n\t\t\tfinish: {opacity: 0},\n\t\t\ttransition: BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\tstep: (state) => {\n\t\t\t\tthis.container.style.opacity = state.opacity / 100;\n\t\t\t},\n\t\t\tcomplete: () => {\n\t\t\t\tthis.container.style.display = 'none';\n\t\t\t\tthis.container.style.transform = 'translateX(100%)';\n\t\t\t\tthis.container.style.opacity = 0;\n\t\t\t}\n\t\t})).animate();\n\t}\n\n\tonMenuClick(event)\n\t{\n\t\tif (this.isEnabled())\n\t\t{\n\t\t\tif (this.loader && !this.loader.isLoaded())\n\t\t\t{\n\t\t\t\tthis.loader.load();\n\t\t\t}\n\n\t\t\tthis.manager.selectItem(this);\n\t\t}\n\n\t\tevent.preventDefault()\n\t}\n}","import {Text, Type} from 'main.core';\nimport Tab from './tab';\nimport {EventEmitter} from \"main.core.events\";\n\nexport default class Manager\n{\n\tconstructor(id, settings)\n\t{\n\t\tthis.id = Type.isStringFilled(id) ? id : Text.getRandom();\n\t\tthis.settings = Type.isObjectLike(settings) ? settings : {};\n\n\t\tthis.container = this.settings.container;\n\t\tthis.menuContainer = this.settings.menuContainer;\n\n\t\tthis.items = [];\n\n\t\tif (Type.isArray(this.settings.data))\n\t\t{\n\t\t\tthis.settings.data.forEach(item => {\n\t\t\t\tthis.items.push(\n\t\t\t\t\tnew Tab(item.id, {\n\t\t\t\t\t\tmanager: this,\n\t\t\t\t\t\tdata: item,\n\t\t\t\t\t\tcontainer: this.container.querySelector('[data-tab-id=\"' + item.id + '\"]'),\n\t\t\t\t\t\tmenuContainer: this.menuContainer.querySelector('[data-tab-id=\"' + item.id + '\"]')\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\tEventEmitter.subscribe('BX.Catalog.EntityCard.TabManager:onOpenTab', (event) => {\n\t\t\tlet tabId = event.data.tabId;\n\t\t\tlet item = this.findItemById(tabId);\n\t\t\tif (item)\n\t\t\t{\n\t\t\t\tthis.selectItem(item);\n\t\t\t}\n\t\t});\n\t}\n\n\tfindItemById(id)\n\t{\n\t\treturn this.items.find(item => item.id === id) || null;\n\t}\n\n\tselectItem(item)\n\t{\n\t\tEventEmitter.emit('BX.Catalog.EntityCard.TabManager:onSelectItem', {tabId: item.id});\n\t\tthis.items.forEach(current => current.setActive(current === item));\n\t}\n}\n","import {Dom, Tag, Text, Type} from \"main.core\";\nimport TabManager from \"../tab/manager\";\n\nexport class BaseCard\n{\n\tconstructor(id, settings = {})\n\t{\n\t\tthis.id = Type.isStringFilled(id) ? id : Text.getRandom();\n\t\tthis.entityId = Text.toInteger(settings.entityId) || 0;\n\t\tthis.settings = settings;\n\t\tthis.container = document.getElementById(settings.containerId);\n\n\t\tthis.initializeTabManager();\n\t\tthis.checkFadeOverlay();\n\t}\n\n\tinitializeTabManager()\n\t{\n\t\treturn new TabManager(this.id, {\n\t\t\tcontainer: document.getElementById(this.settings.tabContainerId),\n\t\t\tmenuContainer: document.getElementById(this.settings.tabMenuContainerId),\n\t\t\tdata: this.settings.tabs || []\n\t\t});\n\t}\n\n\tcheckFadeOverlay()\n\t{\n\t\tif (this.entityId <= 0)\n\t\t{\n\t\t\tthis.overlay = Tag.render`<div class=\"catalog-entity-overlay\"></div>`;\n\t\t\tDom.append(this.overlay, this.container);\n\n\t\t\tif (window === window.top)\n\t\t\t{\n\t\t\t\tthis.overlay.style.position = 'absolute';\n\t\t\t\tthis.overlay.style.top = this.overlay.style.left = this.overlay.style.right = '-15px';\n\t\t\t}\n\t\t}\n\t}\n}\n","import {Dom, Event, Loc, Reflection, Tag, Type} from 'main.core';\nimport {type BaseEvent, EventEmitter} from 'main.core.events'\nimport './entity-card.css';\nimport 'ui.entity-editor';\nimport 'ui.notification';\nimport 'ui.feedback.form';\nimport 'ui.hint';\nimport 'ui.design-tokens';\nimport 'ui.fonts.opensans';\nimport FieldsFactory from './fields-factory'\nimport ControllersFactory from './controllers-factory'\nimport IblockFieldConfigurationManager from './field-configurator/iblock-field-configuration-manager'\nimport GridFieldConfigurationManager from './field-configurator/grid-field-configuration-manager';\nimport {Popup} from \"main.popup\";\nimport {BaseCard} from \"./base-card/base-card\";\nimport {Slider} from 'catalog.store-use'\n\nclass EntityCard extends BaseCard\n{\n\tstackWithOffset = null;\n\n\tconstructor(id, settings = {})\n\t{\n\t\tsuper(id, settings);\n\n\t\tthis.cardSettings = settings.cardSettings || [];\n\t\tthis.hiddenFields = settings.hiddenFields || [];\n\t\tthis.feedbackUrl = settings.feedbackUrl || '';\n\t\tthis.variationGridId = settings.variationGridId;\n\t\tthis.productStoreGridId = settings.productStoreGridId || null;\n\t\tthis.settingsButtonId = settings.settingsButtonId;\n\t\tthis.createDocumentButtonId = settings.createDocumentButtonId;\n\t\tthis.createDocumentButtonMenuPopupItems = settings.createDocumentButtonMenuPopupItems;\n\n\t\tthis.componentName = settings.componentName || null;\n\t\tthis.componentSignedParams = settings.componentSignedParams || null;\n\t\tthis.variationGridComponentName = (settings.variationGridComponentName || 'BX.Catalog.VariationGrid') + '.Instance';\n\n\t\tthis.isSimpleProduct = settings.isSimpleProduct || false;\n\t\tthis.isWithOrdersMode = settings.isWithOrdersMode || false;\n\t\tthis.isInventoryManagementUsed = settings.isInventoryManagementUsed || false;\n\n\t\tthis.registerFieldsFactory();\n\t\tthis.registerControllersFactory();\n\t\tthis.registerEvents();\n\t\tthis.bindCardSettingsButton();\n\t\tthis.bindCreateDocumentButtonMenu();\n\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', this.onSliderMessage.bind(this));\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorSection:onLayout', this.onSectionLayout.bind(this));\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler.bind(this));\n\t}\n\n\tgetEntityType()\n\t{\n\t\treturn 'Entity';\n\t}\n\n\tgetCardSetting(id: string)\n\t{\n\t\treturn this.cardSettings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\tisCardSettingEnabled(id: string)\n\t{\n\t\tconst settingItem = this.getCardSetting(id);\n\n\t\treturn settingItem && settingItem.checked;\n\t}\n\n\tbindCardSettingsButton()\n\t{\n\t\tconst settingsButton = this.getSettingsButton();\n\t\tif (settingsButton)\n\t\t{\n\t\t\tEvent.bind(settingsButton.getContainer(), 'click', this.showCardSettingsPopup.bind(this));\n\t\t}\n\t}\n\n\tgetSettingsButton()\n\t{\n\t\treturn BX.UI.ButtonManager.getByUniqid(this.settingsButtonId);\n\t}\n\n\tregisterFieldsFactory()\n\t{\n\t\treturn new FieldsFactory();\n\t}\n\n\tonGridUpdatedHandler(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (grid && grid.getId() === this.getVariationGridId())\n\t\t{\n\t\t\tthis.updateSettingsCheckboxState();\n\t\t}\n\t}\n\n\tonSectionLayout()\n\t{\n\n\t}\n\n\tgetProductStoreGridId()\n\t{\n\t\treturn this.productStoreGridId;\n\t}\n\n\tgetProductStoreGridComponent()\n\t{\n\t\treturn Reflection.getClass('BX.Catalog.ProductStoreGridManager.Instance');\n\t}\n\n\treloadProductStoreGrid()\n\t{\n\t\tconst gridComponent = this.getProductStoreGridComponent();\n\t\tif (gridComponent)\n\t\t{\n\t\t\tif (this.getProductStoreGridId() && this.getProductStoreGridId() === gridComponent.getGridId())\n\t\t\t{\n\t\t\t\tgridComponent.reloadGrid();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @returns {BX.Catalog.VariationGrid|BX.Catalog.ProductServiceGrid|null}\n\t */\n\tgetVariationGridComponent()\n\t{\n\t\t//return Reflection.getClass('BX.Catalog.VariationGrid.Instance');\n\t\treturn Reflection.getClass(this.variationGridComponentName);\n\t}\n\n\treloadVariationGrid()\n\t{\n\t\tconst gridComponent = this.getVariationGridComponent();\n\t\tif (gridComponent)\n\t\t{\n\t\t\tgridComponent.reloadGrid();\n\t\t}\n\t}\n\n\tgetVariationGridId()\n\t{\n\t\treturn this.variationGridId;\n\t}\n\n\tgetVariationGrid()\n\t{\n\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.gridManager.getInstanceById(this.getVariationGridId());\n\t}\n\n\tregisterControllersFactory()\n\t{\n\t\treturn new ControllersFactory();\n\t}\n\n\tregisterEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.EntityConfigurationManager:onInitialize', this.onConfigurationManagerInit.bind(this));\n\t\tEventEmitter.subscribe('BX.UI.EntityEditor:onCancel', this.removeFileHiddenInputs.bind(this));\n\t\tEventEmitter.subscribe('BX.UI.EntityEditor:onInit', this.onEditorInitHandler.bind(this));\n\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorAjaxSubmit.bind(this));\n\t\tEventEmitter.subscribe('onEntityCreate', this.onEntityCreateHandler.bind(this));\n\t\tEventEmitter.subscribe('onEntityUpdate', this.onEntityUpdateHandler.bind(this));\n\n\t\tEventEmitter.subscribe('onAttachFiles', this.onAttachFilesHandler.bind(this));\n\t\tEventEmitter.subscribe('BX.Main.Popup:onClose', this.onFileEditorCloseHandler.bind(this));\n\n\t\tEventEmitter.subscribe('onAfterVariationGridSave', this.onAfterVariationGridSave.bind(this));\n\t}\n\n\tonAfterVariationGridSave(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tif (data.gridId === this.getVariationGridId())\n\t\t{\n\t\t\tthis.reloadProductStoreGrid();\n\t\t}\n\t}\n\n\tonAttachFilesHandler(event: BaseEvent)\n\t{\n\t\tconst editor = this.getEditorInstance();\n\t\tif (!editor)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst [, , uploader] = event.getCompatData();\n\t\tif (uploader && Type.isDomNode(uploader.fileInput))\n\t\t{\n\t\t\tconst parent = uploader.fileInput.closest('[data-cid]');\n\n\t\t\tif (Type.isDomNode(parent))\n\t\t\t{\n\t\t\t\tconst controlName = parent.getAttribute('data-cid');\n\t\t\t\tconst control = editor.getControlByIdRecursive(controlName);\n\n\t\t\t\tif (control)\n\t\t\t\t{\n\t\t\t\t\tcontrol.markAsChanged();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonFileEditorCloseHandler(event: BaseEvent)\n\t{\n\t\tconst [popup] = event.getCompatData();\n\t\tif (popup && popup.getId() === 'popupFM' && popup.onApplyFlag)\n\t\t{\n\t\t\tthis.showNotification(Loc.getMessage('CATALOG_ENTITY_CARD_FILE_CLOSE_NOTIFICATION'), {\n\t\t\t\tautoHideDelay: 5000\n\t\t\t});\n\t\t}\n\t}\n\n\tonEditorInitHandler(event: BaseEvent)\n\t{\n\t\tconst [editor, fields] = event.getCompatData();\n\n\t\tif (editor && !fields.entityId)\n\t\t{\n\t\t\tconst control = editor.getControlByIdRecursive('NAME');\n\n\t\t\tif (control)\n\t\t\t{\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tcontrol.focus()\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @returns {BX.UI.EntityEditor|null}\n\t */\n\tgetEditorInstance()\n\t{\n\t\tif (Reflection.getClass('BX.UI.EntityEditor'))\n\t\t{\n\t\t\treturn BX.UI.EntityEditor.getDefault();\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tonEditorAjaxSubmit(event: BaseEvent)\n\t{\n\t\tconst [fields, response] = event.getCompatData();\n\n\t\tconst title = fields['NAME-CODE'].NAME || '';\n\t\tthis.changePageTitle(title);\n\n\t\tif (response.data)\n\t\t{\n\t\t\tif (Type.isBoolean(response.data.IS_SIMPLE_PRODUCT))\n\t\t\t{\n\t\t\t\tthis.isSimpleProduct = response.data.IS_SIMPLE_PRODUCT;\n\t\t\t}\n\t\t}\n\n\t\tif (response.status === 'success')\n\t\t{\n\t\t\tthis.removeFileHiddenInputs();\n\t\t}\n\t}\n\n\tonEntityCreateHandler(event: BaseEvent)\n\t{\n\t\tconst [data] = event.getCompatData();\n\t\tthis.postSliderMessage('onCreate', data)\n\t}\n\n\tonEntityUpdateHandler(event: BaseEvent)\n\t{\n\t\tconst [data] = event.getCompatData();\n\t\tthis.postSliderMessage('onUpdate', data)\n\t}\n\n\tpostSliderMessage(action, fields)\n\t{\n\t\tBX.SidePanel.Instance.postMessage(\n\t\t\twindow,\n\t\t\t`Catalog.${this.getEntityType()}Card::${action}`,\n\t\t\tfields\n\t\t);\n\t}\n\n\tchangePageTitle(title)\n\t{\n\t\tconst titleNode = document.getElementById('pagetitle');\n\n\t\tif (Type.isDomNode(titleNode))\n\t\t{\n\t\t\ttitleNode.innerText = title;\n\t\t}\n\n\t\tdocument.title = title;\n\n\t\tif (BX.getClass('BX.SidePanel.Instance.updateBrowserTitle'))\n\t\t{\n\t\t\tBX.SidePanel.Instance.updateBrowserTitle();\n\t\t}\n\t}\n\n\tremoveFileHiddenInputs()\n\t{\n\t\tdocument.querySelectorAll('form>input[type=\"hidden\"]')\n\t\t\t.forEach(input => {\n\t\t\t\tlet name = input.getAttribute('name');\n\t\t\t\tlet deleteInput = document.querySelector(`form>input[name=\"${name}_del\"]`);\n\n\t\t\t\tif (deleteInput)\n\t\t\t\t{\n\t\t\t\t\tDom.remove(input);\n\t\t\t\t\tDom.remove(deleteInput);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tonConfigurationManagerInit(event: BaseEvent)\n\t{\n\t\tconst [, eventArgs] = event.getCompatData();\n\n\t\tif (!eventArgs.type || eventArgs.type === 'editor')\n\t\t{\n\t\t\teventArgs.configurationFieldManager = this.initializeIblockFieldConfigurationManager(eventArgs);\n\t\t}\n\n\t\tif (eventArgs.id === 'variation_grid')\n\t\t{\n\t\t\teventArgs.configurationFieldManager = this.initializeVariationPropertyConfigurationManager(eventArgs);\n\t\t}\n\n\t\tif (eventArgs.id === 'service_grid')\n\t\t{\n\t\t\teventArgs.configurationFieldManager = this.initializeServicePropertyConfigurationManager(eventArgs);\n\t\t}\n\t}\n\n\tinitializeIblockFieldConfigurationManager(eventArgs)\n\t{\n\t\tconst configurationManager = IblockFieldConfigurationManager.create(this.id, eventArgs);\n\t\tconfigurationManager.setCreationPageUrl(this.settings.creationPropertyUrl);\n\n\t\treturn configurationManager;\n\t}\n\n\tinitializeVariationPropertyConfigurationManager(eventArgs)\n\t{\n\t\tconst configurationManager = GridFieldConfigurationManager.create(this.id, eventArgs);\n\t\tconfigurationManager.setCreationPageUrl(this.settings.creationVariationPropertyUrl);\n\n\t\treturn configurationManager;\n\t}\n\n\tinitializeServicePropertyConfigurationManager(eventArgs)\n\t{\n\t\treturn GridFieldConfigurationManager.create(this.id, eventArgs);\n\t}\n\n\tshowNotification(content, options)\n\t{\n\t\toptions = options || {};\n\n\t\tif (BX.GetWindowScrollPos().scrollTop <= 10)\n\t\t{\n\t\t\toptions.stack = this.getStackWithOffset();\n\t\t}\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tgetStackWithOffset()\n\t{\n\t\tif (this.stackWithOffset === null)\n\t\t{\n\t\t\tthis.stackWithOffset = new BX.UI.Notification.Stack(BX.mergeEx(\n\t\t\t\t{},\n\t\t\t\tBX.UI.Notification.Center.getStackDefaults(),\n\t\t\t\t{\n\t\t\t\t\tid: 'top-right-with-offset',\n\t\t\t\t\tposition: 'top-right-with-offset',\n\t\t\t\t\toffsetY: 74\n\t\t\t\t}\n\t\t\t));\n\t\t}\n\n\t\treturn this.stackWithOffset;\n\t}\n\n\topenFeedbackPanel()\n\t{\n\t\tEntityCard.openFeedbackPanelStatic();\n\t}\n\n\tstatic openFeedbackPanelStatic()\n\t{\n\t\tBX.UI.Feedback.Form.open({\n\t\t\tid: 'catalog-product-card-feedback',\n\t\t\tforms: [\n\t\t\t\t{'id': 269, 'lang': 'ru', 'sec': 'mqerov', 'zones': ['ru', 'by', 'kz']},\n\t\t\t\t{'id': 347, 'lang': 'en', 'sec': 'lxfji8', 'zones': ['en']},\n\t\t\t\t{'id': 349, 'lang': 'es', 'sec': 'gdf9i1', 'zones': ['es']},\n\t\t\t\t{'id': 355, 'lang': 'de', 'sec': 'x8k56n', 'zones': ['de']},\n\t\t\t\t{'id': 357, 'lang': 'ua', 'sec': '2z19xl', 'zones': ['ua']},\n\t\t\t\t{'id': 353, 'lang': 'com.br', 'sec': '5cleqn', 'zones': ['com.br']},\n\t\t\t],\n\t\t});\n\t}\n\n\tbindCreateDocumentButtonMenu()\n\t{\n\t\tconst createDocumentButtonMenu = this.getCreateDocumentButtonMenu();\n\t\tif (createDocumentButtonMenu)\n\t\t{\n\t\t\tEvent.bind(createDocumentButtonMenu.getContainer(), 'click', this.showCreateDocumentPopup.bind(this));\n\t\t}\n\t}\n\n\tgetCreateDocumentButtonMenu()\n\t{\n\t\tconst createDocumentButton = BX.UI.ButtonManager.getByUniqid(this.createDocumentButtonId);\n\t\tif (createDocumentButton)\n\t\t{\n\t\t\treturn BX.UI.ButtonManager.getByUniqid(this.createDocumentButtonId).getMenuButton();\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetCreateDocumentPopup()\n\t{\n\t\tif (!this.createDocumentPopup)\n\t\t{\n\t\t\tthis.createDocumentPopup = new Popup(\n\t\t\t\tthis.id + '-create-document',\n\t\t\t\tthis.getCreateDocumentButtonMenu().getContainer(),\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.getCreateDocumentMenuContent()\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn this.createDocumentPopup;\n\t}\n\n\tshowCreateDocumentPopup()\n\t{\n\t\tthis.getCreateDocumentPopup().show();\n\t}\n\n\tgetCreateDocumentMenuContent()\n\t{\n\t\tconst popupWrapper = Tag.render`<div class=\"menu-popup\"></div>`;\n\t\tconst popupItemsContainer = Tag.render`<div class=\"menu-popup-items\"></div>`;\n\t\tpopupWrapper.appendChild(popupItemsContainer);\n\n\t\tthis.createDocumentButtonMenuPopupItems.forEach((item) => {\n\t\t\tpopupItemsContainer.appendChild(Tag.render`\n\t\t\t\t<a class=\"menu-popup-item menu-popup-item-no-icon\" href=\"${item.link}\">\n\t\t\t\t\t<span class=\"menu-popup-item-text\">${item.text}</span>\n\t\t\t\t</a>\n\t\t\t`);\n\t\t});\n\n\t\treturn popupWrapper;\n\t}\n\n\tgetCardSettingsPopup()\n\t{\n\t\tif (!this.settingsPopup)\n\t\t{\n\t\t\tthis.settingsPopup = new Popup(\n\t\t\t\tthis.id,\n\t\t\t\tthis.getSettingsButton().getContainer(),\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.prepareCardSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn this.settingsPopup;\n\t}\n\n\tshowCardSettingsPopup()\n\t{\n\t\tconst okCallback = () => this.getCardSettingsPopup().show();\n\t\tconst variationGridInstance = Reflection.getClass('BX.Catalog.VariationGrid.Instance');\n\n\t\tif (variationGridInstance)\n\t\t{\n\t\t\tvariationGridInstance.askToLossGridData(okCallback);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tokCallback();\n\t\t}\n\t}\n\n\tprepareCardSettingsContent()\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.cardSettings.map(item => {\n\t\t\tcontent.append(this.getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\tgetSettingItem(item)\n\t{\n\t\tlet input = '';\n\t\tif (!item.disabledCheckbox)\n\t\t{\n\t\t\tinput = Tag.render`\n\t\t\t\t<input type=\"checkbox\">\n\t\t\t`;\n\n\t\t\tinput.checked = item.checked;\n\t\t\tinput.disabled = item.disabled ?? false;\n\t\t\tinput.dataset.settingId = item.id;\n\t\t}\n\n\t\tconst hintNode = (\n\t\t\tType.isStringFilled(item.hint)\n\t\t\t\t? Tag.render`<span class=\"catalog-entity-setting-hint\" data-hint=\"${item.hint}\"></span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title ${item.disabled ? 'catalog-entity-disabled-setting' : ''}\">${item.title}${hintNode}</span>\n\t\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</label>\n\t\t\t`;\n\n\t\tBX.UI.Hint.init(setting);\n\n\t\tif(item.id === 'SLIDER')\n\t\t{\n\t\t\tEvent.bind(setting, 'change', (event) =>\n\t\t\t{\n\t\t\t\tnew Slider().open(item.url, {})\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.reloadGrid();\n\t\t\t\t\tthis.getCardSettingsPopup().close();\n\t\t\t\t});\n\t\t\t})\n\t\t}\n\t\telse if(item.id === 'SEO')\n\t\t{\n\t\t\tEvent.bind(setting, 'click', (event) =>\n\t\t\t{\n\t\t\t\tBX.SidePanel.Instance.open(item.url, {\n\t\t\t\t\tcacheable: false,\n\t\t\t\t\tallowChangeHistory: false,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\t'ELEMENT_ID': this.entityId\n\t\t\t\t\t},\n\t\t\t\t\twidth: 1000\n\t\t\t\t});\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEvent.bind(setting, 'change', this.setProductCardSetting.bind(this));\n\t\t}\n\n\n\t\treturn setting;\n\t}\n\n\tsetProductCardSetting(event: BaseEvent)\n\t{\n\t\tconst settingItem = this.getCardSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\n\t\tif (settingItem.action === 'grid')\n\t\t{\n\t\t\tthis.requestGridSettings(settingItem, settingEnabled);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.requestCardSettings(settingItem, settingEnabled);\n\t\t}\n\t}\n\n\tonSliderMessage(event: BaseEvent)\n\t{\n\t\tconst [sliderEvent] = event.getCompatData();\n\n\t\tif (\n\t\t\tsliderEvent.getEventId() === 'Catalog.VariationCard::onCreate'\n\t\t\t|| sliderEvent.getEventId() === 'Catalog.VariationCard::onUpdate'\n\t\t)\n\t\t{\n\t\t\tthis.reloadVariationGrid();\n\t\t}\n\t}\n\n\treloadGrid()\n\t{\n\t\tdocument.location.reload();\n\t}\n\n\trequestGridSettings(setting, enabled)\n\t{\n\t\tif (!this.getVariationGrid())\n\t\t{\n\t\t\tnew Error('Cant find variation grid.');\n\t\t}\n\n\t\tconst headers = [];\n\t\tconst cells = this.getVariationGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\n\t\tBX.ajax.runComponentAction(\n\t\t\tthis.componentName,\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.componentSignedParams,\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tlet message = null;\n\t\t\tsetting.checked = enabled;\n\t\t\tthis.reloadVariationGrid();\n\t\t\tthis.postSliderMessage('onUpdate', {});\n\t\t\tthis.getCardSettingsPopup().close();\n\n\t\t\tif(setting.id === 'WAREHOUSE')\n\t\t\t{\n\t\t\t\tthis.reloadGrid()\n\t\t\t\tmessage = enabled ? Loc.getMessage('CATALOG_ENTITY_CARD_WAREHOUSE_ENABLED') : Loc.getMessage('CATALOG_ENTITY_CARD_WAREHOUSE_DISABLED');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmessage = enabled ? Loc.getMessage('CATALOG_ENTITY_CARD_SETTING_ENABLED') : Loc.getMessage('CATALOG_ENTITY_CARD_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title)\n\t\t\t}\n\n\t\t\tthis.showNotification(message, {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\trequestCardSettings(setting, enabled)\n\t{\n\t\tBX.ajax.runComponentAction(\n\t\t\tthis.componentName,\n\t\t\t'setCardSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.componentSignedParams,\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tsetting.checked = enabled;\n\n\t\t\tif (setting.id === 'CATALOG_PARAMETERS')\n\t\t\t{\n\t\t\t\tconst section = this.getEditorInstance().getControlByIdRecursive('catalog_parameters');\n\t\t\t\tif (section)\n\t\t\t\t{\n\t\t\t\t\tsection.refreshLayout();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.getCardSettingsPopup().close();\n\n\t\t\tlet message = enabled ? Loc.getMessage('CATALOG_ENTITY_CARD_SETTING_ENABLED') : Loc.getMessage('CATALOG_ENTITY_CARD_SETTING_DISABLED');\n\t\t\tthis.showNotification(message.replace('#NAME#', setting.title), {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\tupdateSettingsCheckboxState()\n\t{\n\t\tconst popupContainer = this.getCardSettingsPopup().getContentContainer();\n\n\t\tthis.cardSettings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns?.ITEMS))\n\t\t\t.forEach(item => {\n\n\t\t\t\tlet allColumnsExist = true;\n\t\t\t\titem.columns.ITEMS.forEach(columnName => {\n\t\t\t\t\tif (!this.getVariationGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}\n\nexport {EntityCard, BaseCard};"],"names":["IblockSectionField","id","settings","initialize","innerWrapper","options","_hasLayout","ensureWrapperCreated","classNames","adjustWrapper","isNeedToDisplay","_wrapper","appendChild","createTitleNode","getTitle","_mode","BX","UI","EntityEditorMode","edit","drawEditMode","drawViewMode","isContextMenuEnabled","createContextMenuButton","registerLayout","defaultInput","Tag","render","getName","ajax","runComponentAction","mode","data","iblockId","getIblockId","productId","getProductId","selectedSectionIds","getValue","then","renderFromResponse","bind","response","Error","errors","join","Runtime","html","callback","initEntitySelector","EventEmitter","subscribe","GLOBAL_TARGET","markAsChanged","node","isShow","style","display","event","emit","getEditor","getData","hasNoSections","Loc","getMessage","Dom","addClass","content","getSections","forEach","section","picture","Type","isStringFilled","PICTURE","Text","encode","push","NAME","_model","getField","sectionIds","length","includes","clean","result","EntityEditorModeSwitchType","common","button","EntityEditorField","NameCodeField","EntityEditorBoolean","superclass","apply","menuItems","isShownSymbolicCode","value","text","getSchemeShowCodeState","allowToGenerateCode","_editor","isNew","prop","get","getSchemeElement","_options","state","e","command","codeContainerElement","document","getElementById","nameCodeMarkerElement","codeTextElement","codeStateButtonElement","readOnly","className","removeClass","_innerWrapper","refreshLayout","setSchemeShowCodeState","_parent","processChildControlSchemeChange","view","title","values","_inputValue","isDragEnabled","append","createDragButton","_inputContainer","valueKey","createSingleInput","getViewInnerLayout","initializeDragDropAbilities","isEditable","clearError","hasValidators","executeValidators","isEmptyField","nameTextElement","util","trim","parentNode","isValid","isRequired","addError","EntityValidationError","create","field","showRequiredFieldError","_input","error","anchor","_errorContainer","innerHTML","htmlspecialchars","_hasError","name","inputWrapper","toLowerCase","inputContainer","input","getLineCount","Event","attr","chainState","label","textValue","codeValue","CODE","chainClass","EntityEditorMultiText","labelText","_changeHandler","translit","Hint","createNode","newValue","FieldsFactory","getCompatData","eventArgs","methods","factory","type","controlId","PROPERTY_PREFIX","PROPERTY_BLOCK_NAME","IblockSectionController","handleChange","isRequesting","clearServiceFields","onChangeHandler","lastDataHash","initialElements","deletedControls","deletedAvailableSchemes","newData","shift","newDataHash","JSON","stringify","clearTimeout","timeout","setTimeout","refreshLinkedProperties","_settings","ajaxData","COMPONENT_NAME","signedParameters","SIGNED_PARAMETERS","allCurrentProperties","getAllCurrentProperties","ENTITY_FIELDS","property","addProperty","layout","forceDisplay","newProperties","map","el","removeProperty","commitSchemeChanges","activeProperties","getAllControls","filter","indexOf","hiddenProperties","getAvailableSchemeElements","restoreDeletedProperty","restoreDeletedAvailableProperty","createProperty","control","getParent","addChild","enableSaving","registerActiveControl","unregisterActiveControl","schemeElement","addAvailableSchemeElement","propertyBlockScheme","getSchemeElementByName","EntitySchemeElement","_elements","createControl","getType","model","parent","propertyBlockControl","getControlById","getControlByIdRecursive","removeChild","removeAvailableSchemeElement","getAvailableSchemeElementByName","element","EntityEditorController","VariationGridController","markAsChangedHandler","checkEditorToolbar","onBeforeGridRequest","ajaxSuccessHandler","onBeforeIncludedAreaLoaded","onAfterIncludedAreaLoaded","onNothingChanged","subscribeToFormSubmit","isNumber","areaHeight","getVariationGridLoader","rollback","getGridControl","wrapper","getWrapper","querySelector","unsubscribeGridEvents","Main","gridManager","destroy","getGridId","isChanged","setGridControlCache","gridId","_loadedHtml","Reflection","getClass","gridComponent","getVariationGridComponent","popup","getGrid","getSettingsWindow","getPopup","unsubscribeAll","xhrData","url","getReloadUrl","_ajaxForm","onBeforeSubmitForm","_isChanged","getActiveControlCount","showToolPanel","hideToolPanel","_toolPanel","clearErrors","grid","getId","params","Uri","getQueryParams","key","Object","hasOwnProperty","call","setQueryParam","toString","sessid","bitrix_sessid","method","getSignedParameters","getConfigStringParam","getInstanceById","skuGridName","skuGridData","getRows","getEditSelectedValues","copyItemsMap","getParam","priceField","newName","replace","endsWith","isFile","fieldName","newFilesRegExp","RegExp","test","fileCounter","fileSetting","match","isNil","isPlainObject","offsetHeight","VariationLinkController","GoogleMapController","EmployeeController","UserController","IblockElementController","BindingToCrmElementController","FieldConfiguratorController","handleFieldAdd","handleFieldUpdate","fieldAddHandler","fieldUpdateHandler","fields","getFieldsForm","PROPERTY_FIELDS","additionalValues","ADDITIONAL_VALUES","entries","setField","EntityEditorSection","getMode","notifyIfNotDisplayed","showAlways","toggleOptionFlag","saveSchemeChanges","EntityEditorControl","currentField","_isRequired","mandatory","EntityEditorDatetime","EntityEditorMultiDatetime","schemeElementData","propertyData","enableTime","dateViewFormat","EntityEditorCustom","newType","multiple","EntityEditorText","EntityEditorList","EntityEditorNumber","EntityEditorMultiList","EntityEditorMultiNumber","index","getChildIndex","newControl","_schemeElement","form","FormData","formatted","MULTIPLE","IS_REQUIRED","IS_PUBLIC","isPublic","PROPERTY_TYPE","typeId","enumeration","enumItem","getFormFieldName","SORT","VALUE","ID","USER_TYPE","XML_ID","FILE_ID","file","LIST_TYPE","userType","item","sectionName","sectionSchemeElement","sectionControl","ProductServiceGridController","getProductServiceGridLoader","ControllersFactory","IblockDirectoryFieldItem","_fileInput","getString","_data","onFileLoaderChange","link","_labelInput","message","deleteButton","onDeleteButtonClick","getElementNode","_container","insertBefore","target","files","reader","FileReader","onload","src","fileChanged","readAsDataURL","classList","remove","fileValue","xmlId","isNotEmptyString","self","EntityEditorUserFieldListItem","IblockFieldConfigurator","_enumItems","getInputContainer","_typeId","_field","getEnumerationContainer","getOptionContainer","getErrorContainer","getButtonContainer","_optionWrapper","_isTimeEnabledCheckBox","getIsTimeEnabledCheckBox","_enableMandatoryControl","_isRequiredCheckBox","getIsRequiredCheckBox","isAllowedMultipleCheckBox","_isMultipleCheckBox","getMultipleCheckBox","_isPublic","getIsPublicCheckBox","_showAlwaysCheckBox","createOption","caption","helpUrl","helpCode","checked","getBoolean","checkOptionFlag","EntityEditorControlOptions","isAllowedShowAlwaysCheckBox","closest","isEnabledOfferTree","isMultiple","manager","getUserFieldManager","getDefaultFieldLabel","enumWrapper","_enumItemContainer","addButton","onEnumerationItemAddButtonClick","getItems","enumFields","createEnumerationItem","IMAGE","IMAGE_SRC","TEXT","lastItem","focus","initItemClickHandlers","unbindItemClickHandlers","bindLastItemClickHandler","unbindAll","bindOnce","onEnumerationItemClick","configurator","container","i","clearLayout","splice","arguments","hashes","enumData","prepareData","hash","hashCode","in_array","getRandom","checkBox","EntityEditorMultiMoney","_isLocked","_mandatoryConfigurator","acceptChanges","close","prepareSaveParams","mergeSettings","modes","htmlListName","htmlList","getObject","getModel","newHtml","SINGLE","htmlName","setInitFieldValue","getContentWrapper","props","setDataParam","onCustomEvent","labelSettings","containerSettings","alignItems","elements","getButton","prepareLayout","isCustomized","setSwitchCheckBox","setLabel","nextSibling","setEnabled","adjust","isTimeEnabled","EntityEditorFieldConfigurator","namespace","IblockFieldConfigurationManager","getSimpleFieldConfigurator","setVisible","_fieldConfigurator","editor","mandatoryConfigurator","EntityUserFieldType","string","isSectionEditEnabled","isReadOnly","creationPageUrl","SidePanel","Instance","open","getCreationPageUrl","allowChangeHistory","cacheable","items","legend","EntityConfigurationManager","GridFieldConfigurator","initItemFocusHandlers","unbindItemFocusHandlers","bindLastItemFocusHandler","onEnumerationItemFocus","GridFieldConfigurationManager","child","filtered","getTypeInfos","okCallback","openCreationPageSlider","variationGridInstance","askToLossGridData","width","LazyLoader","isObjectLike","serviceUrl","tabId","componentData","isRequestRunning","loaded","isLoaded","startRequest","dataType","onsuccess","onRequestSuccess","onfailure","onRequestFailure","Tab","menuContainer","active","isBoolean","enabled","onMenuClick","loader","isActive","showTab","hideTab","position","top","left","easing","duration","start","opacity","translateX","finish","transition","makeEaseOut","transitions","quart","step","transform","complete","cssText","window","animate","isEnabled","load","selectItem","preventDefault","Manager","isArray","findItemById","find","current","setActive","BaseCard","entityId","toInteger","containerId","initializeTabManager","checkFadeOverlay","TabManager","tabContainerId","tabMenuContainerId","tabs","overlay","right","EntityCard","cardSettings","hiddenFields","feedbackUrl","variationGridId","productStoreGridId","settingsButtonId","createDocumentButtonId","createDocumentButtonMenuPopupItems","componentName","componentSignedParams","variationGridComponentName","isSimpleProduct","isWithOrdersMode","isInventoryManagementUsed","registerFieldsFactory","registerControllersFactory","registerEvents","bindCardSettingsButton","bindCreateDocumentButtonMenu","onSliderMessage","onSectionLayout","onGridUpdatedHandler","settingItem","getCardSetting","settingsButton","getSettingsButton","getContainer","showCardSettingsPopup","ButtonManager","getByUniqid","getVariationGridId","updateSettingsCheckboxState","getProductStoreGridComponent","getProductStoreGridId","reloadGrid","onConfigurationManagerInit","removeFileHiddenInputs","onEditorInitHandler","onEditorAjaxSubmit","onEntityCreateHandler","onEntityUpdateHandler","onAttachFilesHandler","onFileEditorCloseHandler","onAfterVariationGridSave","reloadProductStoreGrid","getEditorInstance","uploader","isDomNode","fileInput","controlName","getAttribute","onApplyFlag","showNotification","autoHideDelay","requestAnimationFrame","EntityEditor","getDefault","changePageTitle","IS_SIMPLE_PRODUCT","status","postSliderMessage","action","postMessage","getEntityType","titleNode","innerText","updateBrowserTitle","querySelectorAll","deleteInput","configurationFieldManager","initializeIblockFieldConfigurationManager","initializeVariationPropertyConfigurationManager","initializeServicePropertyConfigurationManager","configurationManager","setCreationPageUrl","creationPropertyUrl","creationVariationPropertyUrl","GetWindowScrollPos","scrollTop","stack","getStackWithOffset","Notification","Center","notify","category","stackWithOffset","Stack","mergeEx","getStackDefaults","offsetY","openFeedbackPanelStatic","createDocumentButtonMenu","getCreateDocumentButtonMenu","showCreateDocumentPopup","createDocumentButton","getMenuButton","createDocumentPopup","Popup","autoHide","draggable","offsetLeft","offsetTop","angle","offset","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","getCreateDocumentMenuContent","getCreateDocumentPopup","show","popupWrapper","popupItemsContainer","settingsPopup","prepareCardSettingsContent","getCardSettingsPopup","getSettingItem","disabledCheckbox","disabled","dataset","settingId","hintNode","hint","setting","desc","init","Slider","setProductCardSetting","settingEnabled","requestGridSettings","requestCardSettings","sliderEvent","getEventId","reloadVariationGrid","location","reload","getVariationGrid","headers","cells","getHeadFirstChild","getCells","Array","from","header","selected","currentHeaders","popupContainer","getContentContainer","columns","ITEMS","allColumnsExist","columnName","getColumnHeaderCellByName","checkbox","Feedback","Form","forms"],"mappings":"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"}