this.BX=this.BX||{};this.BX.Catalog=this.BX.Catalog||{};(function(e,t,i,n,a,r,s){"use strict";var l=function(){function e(t,i){babelHelpers.classCallCheck(this,e);this.id=r.Type.isStringFilled(t)?t:r.Text.getRandom();this.settings=r.Type.isObjectLike(i)?i:{};this.container=this.settings.container;if(!this.container){throw"Error: Could not find container."}this.serviceUrl=this.settings.serviceUrl||"";if(!r.Type.isStringFilled(this.serviceUrl)){throw"Error. Could not find service url."}this.tabId=this.settings.tabId||"";if(!r.Type.isStringFilled(this.tabId)){throw"Error: Could not find tab id."}this.params=r.Type.isObjectLike(this.settings.componentData)?this.settings.componentData:{};this.isRequestRunning=false;this.loaded=false}babelHelpers.createClass(e,[{key:"isLoaded",value:function e(){return this.loaded}},{key:"load",value:function e(){if(!this.isLoaded()){this.startRequest(babelHelpers.objectSpread({},this.params,{TABID:this.tabId}))}}},{key:"startRequest",value:function e(t){if(this.isRequestRunning){return false}this.isRequestRunning=true;BX.ajax({url:this.serviceUrl,method:"POST",dataType:"html",data:{LOADERID:this.id,PARAMS:t},onsuccess:this.onRequestSuccess.bind(this),onfailure:this.onRequestFailure.bind(this)});return true}},{key:"onRequestSuccess",value:function e(t){this.isRequestRunning=false;this.container.innerHTML=t;this.loaded=true}},{key:"onRequestFailure",value:function e(){this.isRequestRunning=false;this.loaded=true}}]);return e}();var o=function(){function e(t,i){babelHelpers.classCallCheck(this,e);this.id=r.Type.isStringFilled(t)?t:r.Text.getRandom();this.settings=r.Type.isObjectLike(i)?i:{};this.data=r.Type.isObjectLike(this.settings.data)?this.settings.data:{};this.manager=i.manager||null;this.container=this.settings.container;this.menuContainer=this.settings.menuContainer;this.active=r.Type.isBoolean(this.data.active)?this.data.active:false;this.enabled=r.Type.isBoolean(this.data.enabled)?this.data.enabled:true;r.Event.bind(this.menuContainer.querySelector("a.catalog-entity-section-tab-link"),"click",this.onMenuClick.bind(this));this.loader=null;if(r.Type.isObjectLike(this.data.loader)){this.loader=new l(this.id,babelHelpers.objectSpread({},this.data.loader,{tabId:this.id,container:this.container}))}}babelHelpers.createClass(e,[{key:"isEnabled",value:function e(){return this.enabled}},{key:"isActive",value:function e(){return this.active}},{key:"setActive",value:function e(t){t=!!t;if(this.isActive()===t){return}this.active=t;if(this.isActive()){this.showTab()}else{this.hideTab()}}},{key:"showTab",value:function e(){var t=this;r.Dom.addClass(this.container,"catalog-entity-section-tab-content-show");r.Dom.removeClass(this.container,"catalog-entity-section-tab-content-hide");r.Dom.addClass(this.menuContainer,"catalog-entity-section-tab-current");this.container.style.display="";this.container.style.position="absolute";this.container.style.top=0;this.container.style.left=0;this.container.style.width="100%";new BX.easing({duration:350,start:{opacity:0,translateX:100},finish:{opacity:100,translateX:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function e(i){t.container.style.opacity=i.opacity/100;t.container.style.transform="translateX("+i.translateX+"%)"},complete:function e(){r.Dom.removeClass(t.container,"catalog-entity-section-tab-content-show");t.container.style.cssText="";r.Event.EventEmitter.emit(window,"onEntityDetailsTabShow",[t])}}).animate()}},{key:"hideTab",value:function e(){var t=this;r.Dom.addClass(this.container,"catalog-entity-section-tab-content-hide");r.Dom.removeClass(this.container,"catalog-entity-section-tab-content-show");r.Dom.removeClass(this.menuContainer,"catalog-entity-section-tab-current");new BX.easing({duration:350,start:{opacity:100},finish:{opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function e(i){t.container.style.opacity=i.opacity/100},complete:function e(){t.container.style.display="none";t.container.style.transform="translateX(100%)";t.container.style.opacity=0}}).animate()}},{key:"onMenuClick",value:function e(t){if(this.isEnabled()){if(this.loader&&!this.loader.isLoaded()){this.loader.load()}this.manager.selectItem(this)}t.preventDefault()}}]);return e}();var d=function(){function e(t,i){var n=this;babelHelpers.classCallCheck(this,e);this.id=r.Type.isStringFilled(t)?t:r.Text.getRandom();this.settings=r.Type.isObjectLike(i)?i:{};this.container=this.settings.container;this.menuContainer=this.settings.menuContainer;this.items=[];if(r.Type.isArray(this.settings.data)){this.settings.data.forEach(function(e){n.items.push(new o(e.id,{manager:n,data:e,container:n.container.querySelector('[data-tab-id="'+e.id+'"]'),menuContainer:n.menuContainer.querySelector('[data-tab-id="'+e.id+'"]')}))})}}babelHelpers.createClass(e,[{key:"findItemById",value:function e(t){return this.items.find(function(e){return e.id===t})||null}},{key:"selectItem",value:function e(t){this.items.forEach(function(e){return e.setActive(e===t)})}}]);return e}();var u,c,h,p,g,m;var f=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));n.initialize(e,i);n.innerWrapper=null;return n}babelHelpers.createClass(t,[{key:"getContentWrapper",value:function e(){return this.innerWrapper}},{key:"layout",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["catalog-entity-editor-content-block-field-iblock-section"]});this.adjustWrapper();if(this.isNeedToDisplay()){this._wrapper.appendChild(this.createTitleNode(this.getTitle()));if(this._mode===BX.UI.EntityEditorMode.edit){this.drawEditMode()}else{this.drawViewMode()}if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}}this.registerLayout(t);this._hasLayout=true}},{key:"drawEditMode",value:function e(){this.defaultInput=r.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['<input type="hidden" name="','[]" value="0">'])),this.getName());this._wrapper.appendChild(this.defaultInput);this.innerWrapper=r.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['<div class="ui-entity-editor-content-block"></div>'])));this._wrapper.appendChild(this.innerWrapper);r.ajax.runComponentAction("bitrix:catalog.productcard.iblocksectionfield","lazyLoad",{mode:"ajax",data:{iblockId:this.getIblockId(),productId:this.getProductId(),selectedSectionIds:this.getValue()}}).then(this.renderFromResponse.bind(this)).catch(function(e){throw new Error(e.errors.join("\n"))})}},{key:"renderFromResponse",value:function e(t){if(!this._wrapper){return}r.Runtime.html(this.innerWrapper,t.data.html,{callback:this.initEntitySelector.bind(this)})}},{key:"initEntitySelector",value:function e(){n.EventEmitter.subscribe(n.EventEmitter.GLOBAL_TARGET,"Item:onSelect",this.markAsChanged.bind(this));n.EventEmitter.subscribe(n.EventEmitter.GLOBAL_TARGET,"Item:onDeselect",this.markAsChanged.bind(this))}},{key:"changeDisplay",value:function e(t,i){if(!t){return}t.style.display=i?"":"none"}},{key:"markAsChanged",value:function e(i){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"markAsChanged",this).call(this);n.EventEmitter.emit(this.getEditor(),"IblockSectionField:onChange",[this].concat(babelHelpers.toConsumableArray(i.getData())))}},{key:"drawViewMode",value:function e(){if(this.hasNoSections()){this.innerWrapper=r.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-editor-content-block">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),r.Loc.getMessage("CATALOG_ENTITY_CARD_EMPTY_SECTION"));r.Dom.addClass(this._wrapper,"ui-entity-editor-content-block-click-empty")}else{var t=[];this.getSections().forEach(function(e){var i="";if(r.Type.isStringFilled(e.PICTURE)){i=r.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['<span class="ui-tile-selector-item-picture" style="background-image: url(\'',"');\"></span>"])),r.Text.encode(e.PICTURE))}t.push(r.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="ui-tile-selector-item ui-tile-selector-item-readonly-yes">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<span data-role="tile-item-name">',"</span>\n\t\t\t\t\t</span>\n\t\t\t\t"])),i,r.Text.encode(e.NAME)))});this.innerWrapper=r.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-editor-content-block">\n\t\t\t\t\t<span class="ui-tile-selector-selector-wrap readonly">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</div>"])),t)}this._wrapper.appendChild(this.innerWrapper)}},{key:"getSections",value:function e(){return this._model.getField("IBLOCK_SECTION_DATA",{})}},{key:"getIblockId",value:function e(){return this._model.getField("IBLOCK_ID",0)}},{key:"getProductId",value:function e(){return this._model.getField("ID",0)}},{key:"hasNoSections",value:function e(){var t=this.getValue();return t.length===0||t.length===1&&(t.includes("0")||t.includes(0))}},{key:"doClearLayout",value:function e(t){if(this.defaultInput){r.Dom.clean(this.defaultInput);this.defaultInput=null}if(this.innerWrapper){r.Dom.clean(this.innerWrapper);this.innerWrapper=null}this._hasLayout=false}},{key:"getModeSwitchType",value:function e(t){var i=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){i|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return i}}]);return t}(BX.UI.EntityEditorField);var b,y,E,v,_,C,I,T,k,S,B,D,L,A,H,U,X,P;function O(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var N=new WeakSet;var w=new WeakSet;var R=new WeakSet;var M=new WeakSet;var F=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));M.add(babelHelpers.assertThisInitialized(n));R.add(babelHelpers.assertThisInitialized(n));w.add(babelHelpers.assertThisInitialized(n));N.add(babelHelpers.assertThisInitialized(n));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"getValue",function(){return BX.UI.EntityEditorBoolean.superclass.getValue.apply(this)});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"hasContentToDisplay",function(){return true});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"doPrepareContextMenuItems",function(e){if(this.isShownSymbolicCode){e.push({value:"hide_symbolic_code",text:r.Loc.getMessage("CATALOG_ENTITY_CARD_HIDE_SYMBOLIC_CODE")})}else{e.push({value:"show_symbolic_code",text:r.Loc.getMessage("CATALOG_ENTITY_CARD_SHOW_SYMBOLIC_CODE")})}});n.initialize(e,i);n.isShownSymbolicCode=n.getSchemeShowCodeState()==="true";n.allowToGenerateCode=n._editor.isNew();return n}babelHelpers.createClass(t,[{key:"getSchemeShowCodeState",value:function e(){return BX.prop.get(this.getSchemeElement()._options,"showCode")}},{key:"setSchemeShowCodeState",value:function e(t){this.getSchemeElement()._options["showCode"]=t}},{key:"processContextMenuCommand",value:function e(i,n){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"processContextMenuCommand",this).call(this,i,n);var a=document.getElementById("code_container");var s=document.getElementById("name_code_marker");if(n==="hide_symbolic_code"){this.isShownSymbolicCode=false;this.allowToGenerateCode=this._editor.isNew();if(this._mode===BX.UI.EntityEditorMode.edit){var l=document.getElementById("code_text");var o=document.getElementById("code_state_button");l.readOnly=this.allowToGenerateCode;if(this.allowToGenerateCode){l.className="ui-ctl-element ui-ctl-element-symbol-code-input-disabled";o.className="ui-ctl-before ui-ctl-icon-chain"}else{l.className="ui-ctl-element";o.className="ui-ctl-before ui-ctl-icon-unchain"}a.className="name-code-container name-code-container-hidden";r.Dom.removeClass(this._innerWrapper,"ui-entity-editor-content-block--code");r.Dom.addClass(this._innerWrapper,"ui-entity-editor-content-block--no-code");s.style.display="inline"}else{this.refreshLayout()}this.setSchemeShowCodeState(false);this._parent.processChildControlSchemeChange(this)}else if(n==="show_symbolic_code"){this.isShownSymbolicCode=true;if(this._mode===BX.UI.EntityEditorMode.edit){a.className="name-code-container";r.Dom.removeClass(this._innerWrapper,"ui-entity-editor-content-block--no-code");r.Dom.addClass(this._innerWrapper,"ui-entity-editor-content-block--code");s.style.display="none"}else{this.refreshLayout()}this.setSchemeShowCodeState(true);this._parent.processChildControlSchemeChange(this)}}},{key:"createTitleMarker",value:function e(){if(this._mode===BX.UI.EntityEditorMode.view){return null}var t=this.isShownSymbolicCode?"none":"inline";if(this._mode===BX.UI.EntityEditorMode.edit){return r.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['<span id="name_code_marker" style="color: rgb(255, 0, 0); display: ',';">*</span>'])),t)}}},{key:"layout",value:function e(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-multitext"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}var i=this.getTitle();var n=this.getValue();this._inputValue=n;this._innerWrapper=null;if(this.isDragEnabled()){r.Dom.append(this.createDragButton(),this._wrapper)}r.Dom.append(this.createTitleNode(i),this._wrapper);if(this._mode===BX.UI.EntityEditorMode.edit){this._inputContainer=r.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(["<div></div>"])));for(var a in n){r.Dom.append(this.createSingleInput(n[a],a),this._inputContainer)}this._innerWrapper=r.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['<div class="ui-entity-editor-content-block">',"</div>"])),this._inputContainer);if(this.isShownSymbolicCode){r.Dom.addClass(this._innerWrapper,"ui-entity-editor-content-block--code")}else{r.Dom.addClass(this._innerWrapper,"ui-entity-editor-content-block--no-code")}}else{this._innerWrapper=r.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-editor-content-block">',"</div>\n\t\t\t"])),this.getViewInnerLayout())}r.Dom.append(this._innerWrapper,this._wrapper);if(this.isContextMenuEnabled()){r.Dom.append(this.createContextMenuButton(),this._wrapper)}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true}},{key:"validate",value:function e(t){if(this._mode!==BX.UI.EntityEditorMode.edit){throw"BX.UI.EntityEditorMultiText. Invalid validation context"}if(!this.isEditable()){return true}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var i=false;if(this._inputContainer){var n=document.getElementById("name_text");if(BX.util.trim(n.value)===""){i=true;r.Dom.addClass(n.parentNode,"ui-ctl-danger")}else{r.Dom.removeClass(n.parentNode,"ui-ctl-danger")}}var a=!this.isRequired()||!i;if(!a){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return a}},{key:"showError",value:function e(t,i){if(!this._errorContainer){this._errorContainer=r.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['<div class="ui-entity-editor-field-error-text"></div>'])))}this._errorContainer.innerHTML=BX.util.htmlspecialchars(t);if(this._wrapper){r.Dom.append(this._errorContainer,this._wrapper)}this._hasError=true}},{key:"createSingleInput",value:function e(t,i){var n=r.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','_container"></div>\n\t\t'])),i.toLowerCase());var a=r.Tag.render(I||(I=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox"></div>\n\t\t'])));var s;if(this.getLineCount()>1){s=r.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<textarea\n\t\t\t\t\tclass="ui-ctl-element ui-entity-editor-field-textarea"\n\t\t\t\t\tname="','"\n\t\t\t\t\tid="','"\n\t\t\t\t\trows="','">',"</textarea>\n\t\t\t"])),i,i.toLowerCase()+"_text",this.getLineCount(),BX.util.htmlspecialchars(t)||"")}else{s=r.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input\n\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\tname="','"\n\t\t\t\t\tid="','"\n\t\t\t\t\ttype="text"\n\t\t\t\t\tvalue="','"/>\n\t\t\t'])),i,i.toLowerCase()+"_text",BX.util.htmlspecialchars(t)||"")}r.Event.bind(s,"input",O(this,w,x).bind(this,i));if(i==="CODE"){if(!this.isShownSymbolicCode){r.Dom.addClass(n,"name-code-container-hidden")}if(this.allowToGenerateCode===true){r.Dom.addClass(s,"ui-ctl-element-symbol-code-input-disabled");r.Dom.attr(s,"readonly",this.allowToGenerateCode)}r.Dom.addClass(a,"ui-ctl-ext-before-icon");r.Dom.addClass(n,"name-code-container");var l=this.allowToGenerateCode?"chain":"unchain";var o=r.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<button name="','" class="ui-ctl-before ui-ctl-icon-','" id="code_state_button"></button>\n\t\t\t'])),i,l);r.Event.bind(o,"click",O(this,M,V).bind(this));r.Dom.append(o,a)}var d=O(this,N,G).call(this,i);r.Dom.append(d,n);r.Dom.append(s,a);r.Dom.append(a,n);return n}},{key:"getViewInnerLayout",value:function e(){var t=r.Tag.render(B||(B=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block-text"></div>\n\t\t'])));var i=this.getValue();if(!this.isShownSymbolicCode){r.Dom.append(r.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(["<p>","</p>"])),BX.util.htmlspecialchars(i.NAME)),t);return t}r.Dom.append(r.Tag.render(L||(L=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-symbol-code-label">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),r.Loc.getMessage("CATALOG_ENTITY_CARD_NAME")),t);r.Dom.append(r.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(["<p>","</p>"])),BX.util.htmlspecialchars(i.NAME)),t);r.Dom.addClass(t,"ui-entity-editor-symbol-code");var n=i.CODE===""?r.Loc.getMessage("UI_ENTITY_EDITOR_FIELD_EMPTY"):i.CODE;var a=this.allowToGenerateCode?"ui-entity-editor-symbol-code-value-chain":"ui-entity-editor-symbol-code-value-unchain";r.Dom.append(r.Tag.render(H||(H=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-symbol-code-box">\n\t\t\t\t<div class="ui-entity-editor-symbol-code-label">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-entity-editor-symbol-code-value ','">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),r.Loc.getMessage("CATALOG_ENTITY_CARD_SYMBOLIC_CODE"),a,BX.util.htmlspecialchars(n)),t);return t}}]);return t}(BX.UI.EntityEditorMultiText);var G=function e(t){var i=r.Tag.render(U||(U=babelHelpers.taggedTemplateLiteral(['<label class="ui-entity-editor-block-title"></label>'])));var n;if(t==="CODE"){n=r.Tag.render(X||(X=babelHelpers.taggedTemplateLiteral(["<span>","</span>"])),r.Loc.getMessage("CATALOG_ENTITY_CARD_SYMBOLIC_CODE"));r.Dom.append(n,i);r.Dom.append(O(this,R,Y).call(this),i)}else{n=r.Tag.render(P||(P=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t<span>\n\t\t\t\t\t",'\n\t\t\t\t\t<span style="color: rgb(255, 0, 0);">*</span>\n\t\t\t\t</span>\n\t\t\t'])),r.Loc.getMessage("CATALOG_ENTITY_CARD_NAME"));r.Dom.append(n,i)}return i};var x=function e(t){this._changeHandler();if(this.allowToGenerateCode&&t==="NAME"){var i=document.getElementById("code_text");var n=document.getElementById("name_text");i.value=BX.translit(n.value,null)}};var Y=function e(){return BX.UI.Hint.createNode(r.Loc.getMessage("CATALOG_ENTITY_CARD_SYMBOLIC_CODE_HINT"))};var V=function e(){var t=document.getElementById("code_text");var i=document.getElementById("name_text");var n=document.getElementById("code_state_button");this.allowToGenerateCode=!this.allowToGenerateCode;t.readOnly=this.allowToGenerateCode;if(this.allowToGenerateCode){t.className="ui-ctl-element ui-ctl-element-symbol-code-input-disabled";n.className="ui-ctl-before ui-ctl-icon-chain";t.value=BX.translit(i.value,null)}else{t.className="ui-ctl-element";n.className="ui-ctl-before ui-ctl-icon-unchain";var a=document.getElementById("name_text");var r=BX.translit(a.value,null);if(t.value!==r){this.markAsChanged()}t.value=r}};var q=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);n.EventEmitter.subscribe("BX.UI.EntityEditorControlFactory:onInitialize",function(e){var i=e.getCompatData(),n=babelHelpers.slicedToArray(i,2),a=n[1];a.methods["entityCard"]=t.factory.bind(t)})}babelHelpers.createClass(e,[{key:"factory",value:function e(t,i,n){if(t==="iblock_section"){return new f(i,n)}else if(t==="name-code"){return new F(i,n)}return null}}]);return e}();var W="PROPERTY_";var j="properties";var z=function(e){babelHelpers.inherits(t,e);function t(e){var i;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"onChangeHandler",i.handleChange.bind(babelHelpers.assertThisInitialized(i)));i.initialize(e,a);i.isRequesting=false;i.clearServiceFields();n.EventEmitter.subscribe(i._editor,"IblockSectionField:onChange",i.onChangeHandler);return i}babelHelpers.createClass(t,[{key:"clearServiceFields",value:function e(){this.lastDataHash=null;this.initialElements=null;this.deletedControls={};this.deletedAvailableSchemes={}}},{key:"handleChange",value:function e(t){var i=this;var n=t.getData();n.shift();var a=JSON.stringify(n);if(this.lastDataHash===null||this.lastDataHash!==a){this.lastDataHash=a;clearTimeout(this.timeout);this.timeout=setTimeout(function(){i.refreshLinkedProperties(n)},50)}}},{key:"refreshLinkedProperties",value:function e(t){var i=this;if(this.isRequesting){return}this.isRequesting=true;r.ajax.runComponentAction(this._editor._settings.ajaxData.COMPONENT_NAME,"refreshLinkedProperties",{mode:"class",signedParameters:this._editor._settings.ajaxData.SIGNED_PARAMETERS,data:{sectionIds:t}}).then(function(e){var t=i.getAllCurrentProperties();if(i.initialElements===null){i.initialElements=babelHelpers.toConsumableArray(t)}e.data.ENTITY_FIELDS.forEach(function(e){if(!t.includes(e.name)){i.addProperty(e,{layout:{forceDisplay:true},mode:BX.UI.EntityEditorMode.edit})}});var n=e.data.ENTITY_FIELDS.map(function(e){return e.name});t.forEach(function(e){if(!n.includes(e)){i.removeProperty(e)}});i._editor.commitSchemeChanges();i.isRequesting=false}).catch(function(e){i.isRequesting=false})}},{key:"getAllCurrentProperties",value:function e(){var t=this._editor.getAllControls().filter(function(e){return e.getName().indexOf(W)===0}).map(function(e){return e.getName()});var i=this._editor.getAvailableSchemeElements().filter(function(e){return e.getName().indexOf(W)===0}).map(function(e){return e.getName()});return[].concat(babelHelpers.toConsumableArray(t),babelHelpers.toConsumableArray(i))}},{key:"addProperty",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(t.name in this.deletedControls){this.restoreDeletedProperty(this.deletedControls[t.name],i)}else if(t.name in this.deletedAvailableSchemes){this.restoreDeletedAvailableProperty(this.deletedAvailableSchemes[t.name],i)}else{this.createProperty(t,i)}}},{key:"restoreDeletedProperty",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=i.mode||t._mode;t._mode=n;t.getParent().addChild(t,babelHelpers.objectSpread({},i,{enableSaving:false}));if(n===BX.UI.EntityEditorMode.edit){this._editor.registerActiveControl(t)}else if(n===BX.UI.EntityEditorMode.view){this._editor.unregisterActiveControl(t)}}},{key:"restoreDeletedAvailableProperty",value:function e(t){this._editor.addAvailableSchemeElement(t)}},{key:"createProperty",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=this._editor.getSchemeElementByName(j);var a=BX.UI.EntitySchemeElement.create(t);n._elements.push(a);var r=i.mode||BX.UI.EntityEditorMode.edit;var s=this._editor.createControl(a.getType(),a.getName(),{schemeElement:a,model:this._model,parent:this,mode:r});if(!s){return}var l=this._editor.getControlById(j);l.addChild(s,babelHelpers.objectSpread({},i,{enableSaving:false}));return s}},{key:"removeProperty",value:function e(t){var i=this._editor.getControlByIdRecursive(t);if(i){this.deletedControls[i.getName()]=i;i.getParent().removeChild(i,{enableSaving:false});this._editor.removeAvailableSchemeElement(i.getSchemeElement());this._editor.unregisterActiveControl(i)}else{var n=this._editor.getAvailableSchemeElementByName(t);if(n){this.deletedAvailableSchemes[n.getName()]=n;this._editor.removeAvailableSchemeElement(n)}}}},{key:"rollback",value:function e(){var i=this;babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"rollback",this).call(this);if(this.initialElements===null){return}var n=this.getAllCurrentProperties();n.forEach(function(e){if(!i.initialElements.includes(e)){i.removeProperty(e)}});this.initialElements.forEach(function(e){if(!n.includes(e)){i.addProperty({name:e},{layout:{forceDisplay:false},mode:BX.UI.EntityEditorMode.view})}});this._editor.commitSchemeChanges();this.clearServiceFields()}}]);return t}(BX.UI.EntityEditorController);var K=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"areaHeight",null);n.initialize(e,i);return n}babelHelpers.createClass(t,[{key:"doInitialize",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"doInitialize",this).call(this);n.EventEmitter.subscribe("Grid::thereEditedRows",this.markAsChangedHandler.bind(this));n.EventEmitter.subscribe("Grid::noEditedRows",this.checkEditorToolbar.bind(this));n.EventEmitter.subscribe("Grid::updated",this.checkEditorToolbar.bind(this));n.EventEmitter.subscribe("Grid::beforeRequest",this.onBeforeGridRequest.bind(this));n.EventEmitter.subscribe("onAjaxSuccess",this.ajaxSuccessHandler.bind(this));n.EventEmitter.subscribe("BX.UI.EntityEditorIncludedArea:onBeforeLoad",this.onBeforeIncludedAreaLoaded.bind(this));n.EventEmitter.subscribe("BX.UI.EntityEditorIncludedArea:onAfterLoad",this.onAfterIncludedAreaLoaded.bind(this));this.subscribeToFormSubmit()}},{key:"onBeforeIncludedAreaLoaded",value:function e(t){if(r.Type.isNumber(this.areaHeight)){r.Dom.style(this.getVariationGridLoader(),"height",this.areaHeight+"px")}}},{key:"onAfterIncludedAreaLoaded",value:function e(t){r.Dom.style(this.getVariationGridLoader(),"height","");this.areaHeight=null}},{key:"getVariationGridLoader",value:function e(){var t=this.getGridControl();if(t){var i=t.getWrapper();if(i){return i.querySelector(".ui-entity-editor-included-area-container-loader")}}return null}},{key:"rollback",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"rollback",this).call(this);this.checkEditorToolbar();this.unsubscribeGridEvents()}},{key:"onAfterSave",value:function e(){if(this.isChanged()||this._editor.isChanged()){this.setGridControlCache(null)}this.subscribeToFormSubmit();babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"onAfterSave",this).call(this)}},{key:"setGridControlCache",value:function e(t){var i=this.getGridControl();if(i){i._loadedHtml=t}}},{key:"onBeforeSubmit",value:function e(){this.unsubscribeGridEvents()}},{key:"getVariationGridComponent",value:function e(){return r.Reflection.getClass("BX.Catalog.VariationGrid.Instance")}},{key:"unsubscribeGridEvents",value:function e(){var t=this.getVariationGridComponent();if(t){t.unsubscribeCustomEvents()}n.EventEmitter.emit(this.getGrid().getSettingsWindow().getPopup(),"onDestroy");n.EventEmitter.unsubscribeAll("BX.Main.grid:paramsUpdated");this.getGrid().destroy()}},{key:"ajaxSuccessHandler",value:function e(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,2),a=n[1];if(a.url.indexOf(this.getReloadUrl())===0){this.setGridControlCache(null)}}},{key:"subscribeToFormSubmit",value:function e(){n.EventEmitter.subscribe(this._editor._ajaxForm,"onBeforeSubmit",this.onBeforeSubmitForm.bind(this))}},{key:"markAsChangedHandler",value:function e(){if(!this._editor.isNew()){this.markAsChanged()}}},{key:"checkEditorToolbar",value:function e(){this._isChanged=false;if(this._editor.getActiveControlCount()>0){this._editor.showToolPanel()}else{this._editor.hideToolPanel()}if(this._editor._toolPanel){this._editor._toolPanel.clearErrors()}}},{key:"getGridControl",value:function e(){return this._editor.getControlById("variation_grid")}},{key:"onBeforeGridRequest",value:function e(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,2),a=n[1];a.sessid=BX.bitrix_sessid();a.method="POST";a.url=this.getReloadUrl();a.data=babelHelpers.objectSpread({},a.data,{signedParameters:this.getSignedParameters()});this.unsubscribeGridEvents()}},{key:"getReloadUrl",value:function e(){return this.getConfigStringParam("reloadUrl","")}},{key:"getSignedParameters",value:function e(){return this.getConfigStringParam("signedParameters","")}},{key:"getGridId",value:function e(){return this.getConfigStringParam("gridId","")}},{key:"getGrid",value:function e(){if(!r.Reflection.getClass("BX.Main.gridManager.getInstanceById")){return null}return BX.Main.gridManager.getInstanceById(this.getGridId())}},{key:"onBeforeSubmitForm",value:function e(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,2),a=n[1];var s=this.getGrid();if(!s){return}var l=this.getGridId();var o=s.getRows().getEditSelectedValues();var d=s.getParam("COPY_ITEMS_MAP",{});for(var u in o){if(!o.hasOwnProperty(u)){continue}for(var c in o[u]){if(!o[u].hasOwnProperty(c)){continue}if(c.includes("SKU_GRID_CATALOG_GROUP")||c.includes("SKU_GRID_PURCHASING")){for(var h in o[u][c]){if(o[u][c].hasOwnProperty(h)){o[u][h]=o[u][c][h]}}}else if(c.includes("[EDIT_HTML]")){var p=c.replace("[EDIT_HTML]","");if(p.endsWith("_custom")){if("bxu_files[]"in o[u][c]){o[u][c].isFile=true;delete o[u][c]["bxu_files[]"]}if(o[u][c].isFile){for(var g in o[u][c]){if(o[u][c].hasOwnProperty(g)){var m=new RegExp(/([0-9A-Za-z_]+?(_n\d+)*)\[([A-Za-z_]+)\]/);if(m.test(g)){var f=void 0,b=void 0;var y=g.match(m);var E=babelHelpers.slicedToArray(y,4);f=E[1];b=E[3];if(f&&b){o[u][c][f]=o[u][c][f]||{};o[u][c][f][b]=o[u][c][g];delete o[u][c][g]}}}}}}o[u][p]=o[u][c];delete o[u][c]}}if(!r.Type.isNil(d[u])){o[u]["COPY_SKU_ID"]=d[u]}}if(!r.Type.isPlainObject(a.options)){a.options={}}if(!r.Type.isPlainObject(a.options.data)){a.options.data={}}a.options.data[l]=o;this.areaHeight=this.getGridControl().getWrapper().offsetHeight}}]);return t}(BX.UI.EntityEditorController);var Q=function(e){babelHelpers.inherits(t,e);function t(e,i){var a;babelHelpers.classCallCheck(this,t);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));a.initialize(e,i);n.EventEmitter.subscribe("onAddGoogleMapPoint",a.markAsChanged.bind(babelHelpers.assertThisInitialized(a)));return a}babelHelpers.createClass(t,[{key:"rollback",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"rollback",this).call(this);if(this._isChanged){this._isChanged=false}}}]);return t}(BX.UI.EntityEditorController);var Z=function(e){babelHelpers.inherits(t,e);function t(e,i){var a;babelHelpers.classCallCheck(this,t);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));a.initialize(e,i);n.EventEmitter.subscribe("onChangeEmployee",a.markAsChanged.bind(babelHelpers.assertThisInitialized(a)));return a}babelHelpers.createClass(t,[{key:"rollback",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"rollback",this).call(this);if(this._isChanged){this._isChanged=false}}}]);return t}(BX.UI.EntityEditorController);var J=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));n.initialize(e,i);return n}babelHelpers.createClass(t,[{key:"rollback",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"rollback",this).call(this);if(this._isChanged){this._isChanged=false}n.EventEmitter.unsubscribeAll("BX.Main.User.SelectorController::open")}},{key:"onBeforeSubmit",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"onBeforeSubmit",this).call(this);n.EventEmitter.unsubscribeAll("BX.Main.User.SelectorController::open")}}]);return t}(BX.UI.EntityEditorController);var $=function(e){babelHelpers.inherits(t,e);function t(e,i){var a;babelHelpers.classCallCheck(this,t);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"fieldAddHandler",a.handleFieldAdd.bind(babelHelpers.assertThisInitialized(a)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"fieldUpdateHandler",a.handleFieldUpdate.bind(babelHelpers.assertThisInitialized(a)));a.initialize(e,i);n.EventEmitter.subscribe(a._editor,"BX.UI.EntityEditor:onFieldCreate",a.fieldAddHandler);n.EventEmitter.subscribe(a._editor,"BX.UI.EntityEditor:onFieldModify",a.fieldUpdateHandler);return a}babelHelpers.createClass(t,[{key:"handleFieldAdd",value:function e(t){var i=this;var n=t.getCompatData(),a=babelHelpers.slicedToArray(n,2),s=a[0],l=a[1];var o=this.getFieldsForm(l);r.ajax.runComponentAction(this._editor._settings.ajaxData.COMPONENT_NAME,"addProperty",{mode:"class",signedParameters:this._editor._settings.ajaxData.SIGNED_PARAMETERS,data:o}).then(function(e){var t=e.data.PROPERTY_FIELDS;if(!t){return}var n=e.data.ADDITIONAL_VALUES;if(n){var a=i._editor._model;for(var r=0,o=Object.entries(n);r<o.length;r++){var d=babelHelpers.slicedToArray(o[r],2),u=d[0],c=d[1];a.setField(u,c)}}var h=BX.UI.EntityEditorMode.view;if(s instanceof BX.UI.EntityEditorSection){h=s.getMode()}var p=i.createProperty(t,s.getName(),{layout:{notifyIfNotDisplayed:true,forceDisplay:l.showAlways},mode:h});p.toggleOptionFlag(l.showAlways);i._editor.saveSchemeChanges();i.isRequesting=false}).catch(function(e){i.isRequesting=false})}},{key:"handleFieldUpdate",value:function e(t){var i=this;var n=t.getCompatData(),a=babelHelpers.slicedToArray(n,2),s=a[0],l=a[1];if(!(l.field instanceof BX.UI.EntityEditorControl)){return}var o=l.field;l.CODE=o.getId();var d=this.getFieldsForm(l);var u=o.getSchemeElement();u._isRequired=l.mandatory;r.ajax.runComponentAction(this._editor._settings.ajaxData.COMPONENT_NAME,"updateProperty",{mode:"class",signedParameters:this._editor._settings.ajaxData.SIGNED_PARAMETERS,data:d}).then(function(e){if(o instanceof BX.UI.EntityEditorDatetime||o instanceof BX.UI.EntityEditorMultiDatetime){var t=o.getSchemeElement().getData();t.enableTime=l.enableTime}var n=null;var a=null;if(l.multiple===true){if(o instanceof BX.UI.EntityEditorText){n="multitext"}else if(o instanceof BX.UI.EntityEditorList){n="multilist"}else if(o instanceof BX.UI.EntityEditorDatetime){n="multidatetime"}else if(o instanceof BX.UI.EntityEditorNumber){n="multinumber"}}else{if(o instanceof BX.UI.EntityEditorMultiList){n="list"}else if(o instanceof BX.UI.EntityEditorMultiDatetime){n="datetime"}else if(o instanceof BX.UI.EntityEditorMultiNumber){n="number"}else if(o instanceof BX.UI.EntityEditorMultiText){n="text"}}a=o.getSchemeElement();var r=e.data.PROPERTY_FIELDS;if((o instanceof BX.UI.EntityEditorList||o instanceof BX.UI.EntityEditorMultiList)&&r){a=BX.UI.EntitySchemeElement.create(r);n=r.type}if(n){var d=s.getChildIndex(o);var u=i._editor.createControl(n,l.CODE,{schemeElement:a,model:s._model,parent:s,mode:s.getMode()});s.addChild(u,{index:d,layout:{forceDisplay:true},enableSaving:false});s.removeChild(o,{enableSaving:false})}i.isRequesting=false}).catch(function(e){i.isRequesting=false})}},{key:"getFieldsForm",value:function e(t){var i=this;var n=new FormData;var a={NAME:t.label,MULTIPLE:t.multiple?"Y":"N",IS_REQUIRED:t.mandatory?"Y":"N",IS_PUBLIC:t.isPublic?"Y":"N",PROPERTY_TYPE:"S",CODE:t.CODE||""};switch(t.typeId){case"integer":case"double":a.PROPERTY_TYPE="N";break;case"list":case"multilist":a.PROPERTY_TYPE="L";t.enumeration.forEach(function(e,t){n.append(i.getFormFieldName("VALUES]["+t+"][SORT"),e.SORT);n.append(i.getFormFieldName("VALUES]["+t+"][VALUE"),e.VALUE);n.append(i.getFormFieldName("VALUES]["+t+"][ID"),e.ID)});break;case"directory":a.USER_TYPE="directory";t.enumeration.forEach(function(e,t){n.append(i.getFormFieldName("VALUES]["+t+"][SORT"),e.SORT);n.append(i.getFormFieldName("VALUES]["+t+"][VALUE"),e.VALUE.value);n.append(i.getFormFieldName("VALUES]["+t+"][XML_ID"),e.XML_ID);n.append(i.getFormFieldName("VALUES]["+t+"][FILE_ID"),e.FILE_ID);n.append("FILES["+e.SORT+"]",e.VALUE.file)});break;case"boolean":a.PROPERTY_TYPE="L";n.append(this.getFormFieldName("VALUES][0][VALUE"),"Y");a.LIST_TYPE="C";break;case"money":a.USER_TYPE="Money";break;case"address":a.USER_TYPE="map_google";break;case"datetime":case"multidatetime":a.USER_TYPE=t.enableTime===true?"DateTime":"Date";break;case"file":a.USER_TYPE="DiskFile";break}for(var r=0,s=Object.entries(a);r<s.length;r++){var l=babelHelpers.slicedToArray(s[r],2),o=l[0],d=l[1];n.append(this.getFormFieldName(o),d)}return n}},{key:"getFormFieldName",value:function e(t){return"fields["+t+"]"}},{key:"createProperty",value:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var a=this._editor.getSchemeElementByName(i);if(!a){return}var r=BX.UI.EntitySchemeElement.create(t);a._elements.push(r);var s=n.mode||BX.UI.EntityEditorMode.edit;var l=this._editor.createControl(r.getType(),r.getName(),{schemeElement:r,model:this._model,parent:this,mode:s});if(!l){return}var o=this._editor.getControlById(i);o.addChild(l,babelHelpers.objectSpread({},n,{enableSaving:false}));return l}}]);return t}(BX.UI.EntityEditorController);var ee=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);n.EventEmitter.subscribe("BX.UI.EntityEditorControllerFactory:onInitialize",function(e){var i=e.getCompatData(),n=babelHelpers.slicedToArray(i,2),a=n[1];a.methods["entityCard"]=t.factory.bind(t)})}babelHelpers.createClass(e,[{key:"factory",value:function e(t,i,n){if(t==="field_configurator"){return new $(i,n)}if(t==="iblock_section"){return new z(i,n)}if(t==="variation_grid"){return new K(i,n)}if(t==="google_map"){return new Q(i,n)}if(t==="employee"){return new Z(i,n)}if(t==="binding_to_crm_element"){return new J(i,n)}return null}}]);return e}();var te,ie,ne,ae,re;var se=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,a=new Array(n),r=0;r<n;r++){a[r]=arguments[r]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"fileChanged",false);return i}babelHelpers.createClass(t,[{key:"layout",value:function e(){if(this._hasLayout){return}this._wrapper=r.Tag.render(te||(te=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row"></div>\n\t\t\t'])));this._fileInput=r.Tag.render(ie||(ie=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input class="input-image-hidden" value="','" type="file" accept="image/*">\n\t\t\t'])),BX.prop.getString(this._data,"FILE_ID",""));r.Event.bind(this._fileInput,"change",this.onFileLoaderChange.bind(this));var t=BX.prop.getString(this._data,"IMAGE_SRC","");this._wrapper.appendChild(r.Tag.render(ne||(ne=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<label class="catalog-dictionary-item ','">\n\t\t\t\t<img src="','" alt="">\n\t\t\t\t',"\n\t\t\t</label>\n\t\t\t"])),t===""?"catalog-dictionary-item-empty":"",t,this._fileInput));var i=r.Text.encode(BX.prop.getString(this._data,"TEXT",""));this._labelInput=r.Tag.render(ae||(ae=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input \n\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\tvalue="','"\n\t\t\t\t\tplaceholder="','"\n\t\t\t\t>\n\t\t\t'])),i,BX.message("CATALOG_ENTITY_CARD_NEW_FIELD_ITEM_PLACEHOLDER"));this._wrapper.appendChild(this._labelInput);var n=r.Tag.render(re||(re=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-editor-content-remove-block"></div>\n\t\t\t'])));r.Event.bind(n,"click",this.onDeleteButtonClick.bind(this));this._wrapper.appendChild(n);var a=BX.prop.getElementNode(this._settings,"anchor");if(a){this._container.insertBefore(this._wrapper,a)}else{this._container.appendChild(this._wrapper)}this._hasLayout=true}},{key:"onFileLoaderChange",value:function e(t){var i=t.target;if(i.files&&i.files[0]){var n=new FileReader;n.onload=function(e){i.parentNode.querySelector("img").src=e.target.result};this.fileChanged=true;n.readAsDataURL(i.files[0]);i.parentNode.classList.remove("catalog-dictionary-item-empty")}}},{key:"isFileChanged",value:function e(){return this.fileChanged}},{key:"prepareData",value:function e(){var t=this._labelInput?BX.util.trim(this._labelInput.value):"";var i=this._fileInput&&this._fileInput.files&&this._fileInput.files[0]?this._fileInput.files[0]:{};var n={VALUE:{value:t,file:i},XML_ID:"",FILE_ID:""};var a=BX.prop.getString(this._data,"ID","");if(BX.type.isNotEmptyString(a)){n["XML_ID"]=a;n["FILE_ID"]=BX.prop.getString(this._data,"FILE_ID","")}return n}}],[{key:"create",value:function e(t,i){var n=new this;n.initialize(t,i);return n}}]);return t}(BX.UI.EntityEditorUserFieldListItem);var le,oe,de,ue,ce,he,pe,ge;var me=function(e){babelHelpers.inherits(t,e);babelHelpers.createClass(t,null,[{key:"create",value:function e(t,i){var n=new this;n.initialize(t,i);return n}}]);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));e._enumItems=[];return e}babelHelpers.createClass(t,[{key:"layoutInternal",value:function e(){this._wrapper.appendChild(this.getInputContainer());if(this._typeId==="list"||this._typeId==="multilist"||this._typeId==="directory"){this._wrapper.appendChild(r.Tag.render(le||(le=babelHelpers.taggedTemplateLiteral(['<hr class="ui-entity-editor-line">']))));this._wrapper.appendChild(this.getEnumerationContainer())}this._wrapper.appendChild(this.getOptionContainer());this._wrapper.appendChild(this.getErrorContainer());r.Dom.append(r.Tag.render(oe||(oe=babelHelpers.taggedTemplateLiteral(['<hr class="ui-entity-editor-line">']))),this._wrapper);this._wrapper.appendChild(this.getButtonContainer())}},{key:"getOptionContainer",value:function e(){var t=this._field===null;this._optionWrapper=r.Tag.render(de||(de=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block"></div>\n\t\t'])));if(this._typeId==="datetime"||this._typeId==="multidatetime"){this._isTimeEnabledCheckBox=this.getIsTimeEnabledCheckBox()}if(this._typeId!=="boolean"&&this._enableMandatoryControl){this._isRequiredCheckBox=this.getIsRequiredCheckBox()}if(this.isAllowedMultipleCheckBox()){this._isMultipleCheckBox=this.getMultipleCheckBox()}this._isPublic=this.getIsPublicCheckBox();this._showAlwaysCheckBox=this.createOption({caption:BX.message("UI_ENTITY_EDITOR_SHOW_ALWAYS"),helpUrl:"https://helpdesk.bitrix24.ru/open/7046149/",helpCode:"9627471"});this._showAlwaysCheckBox.checked=t?BX.prop.getBoolean(this._settings,"showAlways",true):this._field.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways);if(!this.isAllowedShowAlwaysCheckBox()){r.Dom.style(this._showAlwaysCheckBox.closest("div.ui-ctl-checkbox"),"display","none")}return this._optionWrapper}},{key:"isAllowedMultipleCheckBox",value:function e(){var t,i,n,a,r,s;var l=this===null||this===void 0?void 0:(t=this._field)===null||t===void 0?void 0:(i=t.getSchemeElement())===null||i===void 0?void 0:(n=i._settings)===null||n===void 0?void 0:n.isEnabledOfferTree;var o=this===null||this===void 0?void 0:(a=this._field)===null||a===void 0?void 0:(r=a.getSchemeElement())===null||r===void 0?void 0:(s=r._settings)===null||s===void 0?void 0:s.multiple;return!l||o}},{key:"isAllowedShowAlwaysCheckBox",value:function e(){return true}},{key:"getInputTitle",value:function e(){var t=this._editor.getUserFieldManager();return this._field?this._field.getTitle():t.getDefaultFieldLabel(this._typeId)}},{key:"getErrorContainer",value:function e(){this._errorContainer=r.Tag.render(ue||(ue=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block"></div>\n\t\t'])));return this._errorContainer}},{key:"getEnumerationContainer",value:function e(){var t=this;var i=r.Tag.render(ce||(ce=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block">\n\t\t\t\t<div class="ui-entity-editor-block-title">\n\t\t\t\t\t<span class="ui-entity-editor-block-title-text">',"</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),BX.message("UI_ENTITY_EDITOR_UF_ENUM_ITEMS"));this._enumItemContainer=r.Tag.render(he||(he=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-editor-content-block"></div>\n\t\t\t'])));r.Dom.append(this._enumItemContainer,i);var n=r.Tag.render(pe||(pe=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-card-content-add-field">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),BX.message("UI_ENTITY_EDITOR_ADD"));r.Event.bind(n,"click",this.onEnumerationItemAddButtonClick.bind(this));r.Dom.append(r.Tag.render(ge||(ge=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-editor-content-block-add-field">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),n),i);if(this._field){this._field.getItems().forEach(function(e){if(e.VALUE!==""){t.createEnumerationItem({VALUE:e.NAME,FILE_ID:e.IMAGE||null,IMAGE_SRC:e.IMAGE_SRC||"",TEXT:e.TEXT||"",ID:e.VALUE})}})}var a=this.createEnumerationItem();a.focus();this.initItemClickHandlers();return i}},{key:"onEnumerationItemAddButtonClick",value:function e(){this.unbindItemClickHandlers();this.createEnumerationItem().focus();this.bindLastItemClickHandler()}},{key:"onEnumerationItemClick",value:function e(){this.unbindItemClickHandlers();this.createEnumerationItem();this.bindLastItemClickHandler()}},{key:"initItemClickHandlers",value:function e(){this.unbindItemClickHandlers();this.bindLastItemClickHandler()}},{key:"unbindItemClickHandlers",value:function e(){this._enumItems.forEach(function(e){return r.Event.unbindAll(e._labelInput,"click")})}},{key:"bindLastItemClickHandler",value:function e(){var t=this._enumItems[this._enumItems.length-1];if(t){r.Event.bindOnce(t._labelInput,"click",this.onEnumerationItemClick.bind(this))}}},{key:"createEnumerationItem",value:function e(t){var i=null;if(this._typeId==="directory"){i=se.create("",{configurator:this,container:this._enumItemContainer,data:t})}else{i=BX.UI.EntityEditorUserFieldListItem.create("",{configurator:this,container:this._enumItemContainer,data:t})}this._enumItems.push(i);i.layout();return i}},{key:"removeEnumerationItem",value:function e(t){for(var i=0,n=this._enumItems.length;i<n;i++){if(this._enumItems[i]===t){this._enumItems[i].clearLayout();this._enumItems.splice(i,1);this.initItemClickHandlers();break}}}},{key:"prepareSaveParams",value:function e(i){var n=babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"prepareSaveParams",this).call(this,this,arguments);if(this._typeId==="list"||this._typeId==="multilist"){n["enumeration"]=[];var a=[];this._enumItems.forEach(function(e){if(!(e instanceof BX.UI.EntityEditorUserFieldListItem)){return}var t=e.prepareData();if(!t){return}var i=BX.util.hashCode(t["VALUE"]);if(BX.util.in_array(i,a)){return}a.push(i);t["SORT"]=(n["enumeration"].length+1)*100;n["enumeration"].push(t)})}if(this._typeId==="directory"){n["enumeration"]=[];this._enumItems.forEach(function(e){if(!(e instanceof se)){return}var t=e.prepareData();if(!t){return}t["SORT"]=(n["enumeration"].length+1)*100;n["enumeration"].push(t)})}else if(this._typeId==="datetime"||this._typeId==="multidatetime"){n["enableTime"]=this._isTimeEnabledCheckBox.checked}if(this._field){if(this._isMultipleCheckBox){n["multiple"]=this._isMultipleCheckBox.checked}}else{if(this._typeId==="boolean"){n["multiple"]=false}else if(this._isMultipleCheckBox){n["multiple"]=this._isMultipleCheckBox.checked}}if(this._isPublic){n["isPublic"]=this._isPublic.checked}return n}},{key:"getMultipleCheckBox",value:function e(){var t=this.createOption({caption:BX.message("UI_ENTITY_EDITOR_UF_MULTIPLE_FIELD")});if(this._field instanceof BX.UI.EntityEditorMultiText||this._field instanceof BX.UI.EntityEditorMultiNumber||this._field instanceof BX.UI.EntityEditorMultiList||this._field instanceof BX.UI.EntityEditorMultiDatetime||this._field instanceof BX.UI.EntityEditorCustom&&this._field.getSchemeElement()._settings.multiple){t.checked=true}return t}},{key:"onSaveButtonClick",value:function e(){if(this._isLocked){return}if(this._mandatoryConfigurator){if(this._mandatoryConfigurator.isChanged()){this._mandatoryConfigurator.acceptChanges()}this._mandatoryConfigurator.close()}var t=this.prepareSaveParams();if(this._field instanceof BX.UI.EntityEditorCustom){this._field.getSchemeElement().mergeSettings({multiple:t.multiple});var i=["edit","view"];for(var n=0;n<i.length;n++){var a=BX.prop.getString(this._field.getSchemeElement().getData(),i[n]+"List",null);var s=BX.prop.getObject(this._field.getModel().getData(),a,null);if(s!==null){var l=t.multiple?s.MULTIPLE:s.SINGLE;var o=BX.prop.getString(this._field.getSchemeElement().getData(),i[n],null);if(BX.prop.getString(this._field.getModel().getData(),o,null)!==null){this._field.getModel().setField(o,l);this._field.getModel().setInitFieldValue(o,l);if(i[n]==="view"){if(l===""){r.Dom.clean(this._field.getContentWrapper());this._field.getContentWrapper().appendChild(BX.create("div",{props:{className:"ui-entity-editor-content-block-text"},text:BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")}))}else{this._field.getContentWrapper().innerHTML=l}}}}}}BX.onCustomEvent(this,"onSave",[this,t])}},{key:"getIsRequiredCheckBox",value:function e(){var t;if(this._mandatoryConfigurator){t=this.createOption({caption:this._mandatoryConfigurator.getTitle()+":",labelSettings:{props:{className:"ui-entity-new-field-addiction-label"}},containerSettings:{style:{alignItems:"center"}},elements:this._mandatoryConfigurator.getButton().prepareLayout()});t.checked=this._field&&this._field.isRequired()||this._mandatoryConfigurator.isCustomized();this._mandatoryConfigurator.setSwitchCheckBox(t);this._mandatoryConfigurator.setLabel(t.nextSibling);this._mandatoryConfigurator.setEnabled(t.checked);this._mandatoryConfigurator.adjust()}else{t=this.createOption({caption:BX.message("UI_ENTITY_EDITOR_UF_REQUIRED_FIELD")});t.checked=this._field&&this._field.isRequired()}return t}},{key:"getIsTimeEnabledCheckBox",value:function e(){var t=this.createOption({caption:BX.message("UI_ENTITY_EDITOR_UF_ENABLE_TIME")});t.checked=this._field&&this._field.isTimeEnabled();return t}},{key:"getIsPublicCheckBox",value:function e(){var t=this.createOption({caption:BX.message("CATALOG_ENTITY_EDITOR_IS_PUBLIC_PROPERTY")});if(!this._field){t.checked=true}else{t.checked=this._field.getSchemeElement()&&BX.prop.get(this._field.getSchemeElement().getData(),"isPublic",true)}return t}}]);return t}(BX.UI.EntityEditorFieldConfigurator);r.Reflection.namespace("BX.Catalog").IblockFieldConfigurator=me;var fe=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"createFieldConfigurator",value:function e(t,i){if(!BX.type.isPlainObject(t)){throw"IblockFieldConfigurationManager: The 'params' argument must be object."}return this.getSimpleFieldConfigurator(t,i)}},{key:"getSimpleFieldConfigurator",value:function e(t,i){var n="";var a=BX.prop.get(t,"field",null);if(a){n=a.getType();a.setVisible(false);if(!BX.prop.get(a.getSchemeElement().getData(),"isProductProperty",false)){return this._fieldConfigurator=BX.UI.EntityEditorFieldConfigurator.create("",{editor:this._editor,schemeElement:null,model:i._model,mode:BX.UI.EntityEditorMode.edit,parent:i,typeId:n,field:a,mandatoryConfigurator:null})}else if(BX.prop.get(a.getSchemeElement().getData(),"userType",false)){n=BX.prop.getString(a.getSchemeElement().getData(),"userType")}}else{n=BX.prop.get(t,"typeId",BX.UI.EntityUserFieldType.string)}this._fieldConfigurator=me.create("",{editor:this._editor,schemeElement:null,model:i._model,mode:BX.UI.EntityEditorMode.edit,parent:i,typeId:n,field:a,mandatoryConfigurator:null});return this._fieldConfigurator}},{key:"isCreationEnabled",value:function e(){return true}},{key:"getCreationPageUrl",value:function e(t){return this.creationPageUrl}},{key:"openCreationPageUrl",value:function e(t){BX.SidePanel.Instance.open(this.getCreationPageUrl(t),{allowChangeHistory:false,cacheable:false})}},{key:"setCreationPageUrl",value:function e(t){return this.creationPageUrl=t}},{key:"getTypeInfos",value:function e(){var t=[];t.push({name:"string",title:BX.message("UI_ENTITY_EDITOR_UF_STRING_TITLE"),legend:BX.message("UI_ENTITY_EDITOR_UF_STRING_LEGEND")});t.push({name:"list",title:BX.message("UI_ENTITY_EDITOR_UF_ENUM_TITLE"),legend:BX.message("UI_ENTITY_EDITOR_UF_ENUM_LEGEND")});t.push({name:"datetime",title:BX.message("UI_ENTITY_EDITOR_UF_DATETIME_TITLE"),legend:BX.message("UI_ENTITY_EDITOR_UF_DATETIME_LEGEND")});t.push({name:"address",title:BX.message("UI_ENTITY_EDITOR_UF_ADDRESS_TITLE"),legend:BX.message("UI_ENTITY_EDITOR_UF_ADDRESS_LEGEND")});t.push({name:"money",title:BX.message("UI_ENTITY_EDITOR_UF_MONEY_TITLE"),legend:BX.message("UI_ENTITY_EDITOR_UF_MONEY_LEGEND")});t.push({name:"boolean",title:BX.message("UI_ENTITY_EDITOR_BOOLEAN_TITLE"),legend:BX.message("UI_ENTITY_EDITOR_UF_BOOLEAN_LEGEND")});t.push({name:"double",title:BX.message("UI_ENTITY_EDITOR_UF_DOUBLE_TITLE"),legend:BX.message("UI_ENTITY_EDITOR_UF_DOUBLE_LEGEND")});t.push({name:"directory",title:BX.message("CATALOG_ENTITY_CARD_DICTIONARY_TITLE"),legend:BX.message("CATALOG_ENTITY_CARD_DICTIONARY_LEGEND")});t.push({name:"custom",title:BX.message("UI_ENTITY_EDITOR_UF_CUSTOM_TITLE"),legend:BX.message("UI_ENTITY_EDITOR_UF_CUSTOM_LEGEND")});return t}}],[{key:"create",value:function e(t,i){var n=new this;n.initialize(t,i);return n}}]);return t}(BX.UI.EntityConfigurationManager);var be,ye,Ee,ve,_e;var Ce=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"appendEnumerationSettings",value:function e(){var t=this;if(this._typeId==="list"||this._typeId==="multilist"){r.Dom.append(r.Tag.render(be||(be=babelHelpers.taggedTemplateLiteral(['<hr class="ui-entity-editor-line">']))),this._wrapper);var i=r.Tag.render(ye||(ye=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-editor-content-block">\n\t\t\t\t\t<div class="ui-entity-editor-block-title">\n\t\t\t\t\t\t<span class="ui-entity-editor-block-title-text">',"</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),BX.message("UI_ENTITY_EDITOR_UF_ENUM_ITEMS"));r.Dom.append(i,this._wrapper);this._enumItemContainer=r.Tag.render(Ee||(Ee=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="ui-entity-editor-content-block"></div>\n\t\t\t\t'])));r.Dom.append(this._enumItemContainer,i);var n=r.Tag.render(ve||(ve=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="ui-entity-card-content-add-field">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t"])),BX.message("UI_ENTITY_EDITOR_ADD"));r.Event.bind(n,"click",this.onEnumerationItemAddButtonClick.bind(this));r.Dom.append(r.Tag.render(_e||(_e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="ui-entity-editor-content-block-add-field">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t"])),n),i);if(this._field){this._field.getItems().forEach(function(e){if(e.VALUE!==""){t.createEnumerationItem({VALUE:e.NAME,ID:e.VALUE})}})}this.createEnumerationItem();this.initItemFocusHandlers()}}},{key:"onEnumerationItemAddButtonClick",value:function e(){this.unbindItemFocusHandlers();this.createEnumerationItem().focus();this.bindLastItemFocusHandler()}},{key:"onEnumerationItemFocus",value:function e(){this.unbindItemFocusHandlers();this.createEnumerationItem();this.bindLastItemFocusHandler()}},{key:"initItemFocusHandlers",value:function e(){this.unbindItemFocusHandlers();this.bindLastItemFocusHandler()}},{key:"unbindItemFocusHandlers",value:function e(){this._enumItems.forEach(function(e){return r.Event.unbindAll(e._labelInput,"focus")})}},{key:"bindLastItemFocusHandler",value:function e(){var t=this._enumItems[this._enumItems.length-1];if(t){r.Event.bindOnce(t._labelInput,"focus",this.onEnumerationItemFocus.bind(this))}}},{key:"createEnumerationItem",value:function e(t){var i=BX.UI.EntityEditorUserFieldListItem.create("",{configurator:this,container:this._enumItemContainer,data:t});this._enumItems.push(i);i.layout();return i}},{key:"removeEnumerationItem",value:function e(t){for(var i=0,n=this._enumItems.length;i<n;i++){if(this._enumItems[i]===t){this._enumItems[i].clearLayout();this._enumItems.splice(i,1);this.initItemFocusHandlers();break}}}},{key:"prepareSaveParams",value:function e(i){var n=babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"prepareSaveParams",this).call(this,this,arguments);if(this._typeId==="list"||this._typeId==="multilist"){n["enumeration"]=[];var a=[];this._enumItems.forEach(function(e){if(!(e instanceof BX.UI.EntityEditorUserFieldListItem)){return}var t=e.prepareData();if(!t){return}var i=BX.util.hashCode(t["VALUE"]);if(BX.util.in_array(i,a)){return}a.push(i);t["SORT"]=(n["enumeration"].length+1)*100;n["enumeration"].push(t)})}else if(this._typeId==="datetime"||this._typeId==="multidatetime"){n["enableTime"]=this._isTimeEnabledCheckBox.checked}return n}},{key:"getMultipleCheckBox",value:function e(){var t=this.createOption({caption:BX.message("UI_ENTITY_EDITOR_UF_MULTIPLE_FIELD")});if(this._field instanceof BX.UI.EntityEditorMultiText||this._field instanceof BX.UI.EntityEditorMultiNumber||this._field instanceof BX.UI.EntityEditorMultiList||this._field instanceof BX.UI.EntityEditorMultiDatetime){t.checked=true}return t}},{key:"getIsRequiredCheckBox",value:function e(){var t=null;if(this._typeId!=="boolean"){if(this._enableMandatoryControl){if(this._mandatoryConfigurator){t=this.createOption({caption:this._mandatoryConfigurator.getTitle()+":",labelSettings:{props:{className:"ui-entity-new-field-addiction-label"}},containerSettings:{style:{alignItems:"center"}},elements:this._mandatoryConfigurator.getButton().prepareLayout()});t.checked=this._field&&this._field.isRequired()||this._mandatoryConfigurator.isCustomized();this._mandatoryConfigurator.setSwitchCheckBox(t);this._mandatoryConfigurator.setLabel(t.nextSibling);this._mandatoryConfigurator.setEnabled(t.checked);this._mandatoryConfigurator.adjust()}else{t=this.createOption({caption:BX.message("UI_ENTITY_EDITOR_UF_REQUIRED_FIELD")});t.checked=this._field&&this._field.isRequired()}}}return t}},{key:"getIsTimeEnabledCheckBox",value:function e(){var t=null;if(this._typeId==="datetime"||this._typeId==="multidatetime"){t=this.createOption({caption:BX.message("UI_ENTITY_EDITOR_UF_ENABLE_TIME")});t.checked=this._field&&this._field.isTimeEnabled()}return t}}],[{key:"create",value:function e(t,i){var n=new this;n.initialize(t,i);return n}}]);return t}(BX.UI.EntityEditorFieldConfigurator);var Ie=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"createFieldConfigurator",value:function e(t,i){if(!r.Type.isPlainObject(t)){throw"GridFieldConfigurationManager: The 'params' argument must be object."}return this.getSimpleFieldConfigurator(t,i)}},{key:"getSimpleFieldConfigurator",value:function e(t,i){var n="";var a=BX.prop.get(t,"field",null);if(a){n=a.getType();a.setVisible(false);if(!BX.prop.get(a.getSchemeElement().getData(),"isProductProperty",false)){return this._fieldConfigurator=BX.UI.EntityEditorFieldConfigurator.create("",{editor:this._editor,schemeElement:null,model:i._model,mode:BX.UI.EntityEditorMode.edit,parent:i,typeId:n,field:a,mandatoryConfigurator:null})}}else{n=BX.prop.get(t,"typeId",BX.UI.EntityUserFieldType.string)}this._fieldConfigurator=Ce.create("",{editor:this._editor,schemeElement:null,model:i._model,mode:BX.UI.EntityEditorMode.edit,parent:i,typeId:n,field:a,mandatoryConfigurator:null});return this._fieldConfigurator}},{key:"isSelectionEnabled",value:function e(){return false}},{key:"isCreationEnabled",value:function e(){return false}},{key:"hasExternalForm",value:function e(t){return true}},{key:"getCreationPageUrl",value:function e(t){var i=this.getTypeInfos().filter(function(e){return e.name===t});if(i.length>0){return this.creationPageUrl.replace("#PROPERTY_TYPE#",t)}}},{key:"openCreationPageUrl",value:function e(t){var i=this;var n=function e(){return i.openCreationPageSlider(i.getCreationPageUrl(t))};var a=r.Reflection.getClass("BX.Catalog.VariationGrid.Instance");if(a){a.askToLossGridData(n,null,{message:r.Loc.getMessage("CATALOG_ENTITY_CARD_UNSAVED_DATA_MESSAGE")})}else{n()}}},{key:"openCreationPageSlider",value:function e(t){if(r.Type.isStringFilled(t)){BX.SidePanel.Instance.open(t,{width:550,allowChangeHistory:false,cacheable:false})}}},{key:"setCreationPageUrl",value:function e(t){return this.creationPageUrl=t}},{key:"getTypeInfos",value:function e(){return[{name:"list",title:BX.message("CATALOG_ENTITY_CARD_LIST_TITLE"),legend:BX.message("CATALOG_ENTITY_CARD_LIST_LEGEND")},{name:"directory",title:BX.message("CATALOG_ENTITY_CARD_DICTIONARY_TITLE"),legend:BX.message("CATALOG_ENTITY_CARD_DICTIONARY_LEGEND")}]}}],[{key:"create",value:function e(t,i){var n=new this;n.initialize(t,i);return n}}]);return t}(BX.UI.EntityConfigurationManager);var Te,ke,Se,Be;var De=function(){function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"stackWithOffset",null);this.id=r.Type.isStringFilled(t)?t:r.Text.getRandom();this.settings=i;this.cardSettings=i.cardSettings||[];this.feedbackUrl=i.feedbackUrl||"";this.settingsButtonId=i.settingsButtonId;this.entityId=r.Text.toInteger(i.entityId)||0;this.container=document.getElementById(i.containerId);this.variationGridId=i.variationGridId;this.settingsButtonId=i.settingsButtonId;this.componentName=i.componentName||null;this.componentSignedParams=i.componentSignedParams||null;this.isSimpleProduct=i.isSimpleProduct||false;this.initializeTabManager();this.checkFadeOverlay();this.registerFieldsFactory();this.registerControllersFactory();this.registerEvents();this.bindCardSettingsButton();n.EventEmitter.subscribe("SidePanel.Slider:onMessage",this.onSliderMessage.bind(this));n.EventEmitter.subscribe("BX.UI.EntityEditorSection:onLayout",this.onSectionLayout.bind(this));n.EventEmitter.subscribe("Grid::updated",this.onGridUpdatedHandler.bind(this))}babelHelpers.createClass(e,[{key:"getEntityType",value:function e(){return"Entity"}},{key:"getCardSetting",value:function e(t){return this.cardSettings.filter(function(e){return e.id===t})[0]}},{key:"isCardSettingEnabled",value:function e(t){var i=this.getCardSetting(t);return i&&i.checked}},{key:"bindCardSettingsButton",value:function e(){var t=this.getSettingsButton();if(t){r.Event.bind(t.getContainer(),"click",this.showCardSettingsPopup.bind(this))}}},{key:"getSettingsButton",value:function e(){return BX.UI.ButtonManager.getByUniqid(this.settingsButtonId)}},{key:"initializeTabManager",value:function e(){return new d(this.id,{container:document.getElementById(this.settings.tabContainerId),menuContainer:document.getElementById(this.settings.tabMenuContainerId),data:this.settings.tabs||[]})}},{key:"checkFadeOverlay",value:function e(){if(this.entityId<=0){this.overlay=r.Tag.render(Te||(Te=babelHelpers.taggedTemplateLiteral(['<div class="catalog-entity-overlay"></div>'])));r.Dom.append(this.overlay,this.container);if(window===window.top){this.overlay.style.position="absolute";this.overlay.style.top=this.overlay.style.left=this.overlay.style.right="-15px"}}}},{key:"registerFieldsFactory",value:function e(){return new q}},{key:"onGridUpdatedHandler",value:function e(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,1),a=n[0];if(a&&a.getId()===this.getVariationGridId()){this.updateSettingsCheckboxState()}}},{key:"onSectionLayout",value:function e(){}},{key:"getVariationGridComponent",value:function e(){return r.Reflection.getClass("BX.Catalog.VariationGrid.Instance")}},{key:"reloadVariationGrid",value:function e(){var t=this.getVariationGridComponent();if(t){t.reloadGrid()}}},{key:"getVariationGridId",value:function e(){return this.variationGridId}},{key:"getVariationGrid",value:function e(){if(!r.Reflection.getClass("BX.Main.gridManager.getInstanceById")){return null}return BX.Main.gridManager.getInstanceById(this.getVariationGridId())}},{key:"registerControllersFactory",value:function e(){return new ee}},{key:"registerEvents",value:function e(){n.EventEmitter.subscribe("BX.UI.EntityConfigurationManager:onInitialize",this.onConfigurationManagerInit.bind(this));n.EventEmitter.subscribe("BX.UI.EntityEditor:onCancel",this.removeFileHiddenInputs.bind(this));n.EventEmitter.subscribe("BX.UI.EntityEditor:onInit",this.onEditorInitHandler.bind(this));n.EventEmitter.subscribe("BX.UI.EntityEditorAjax:onSubmit",this.onEditorAjaxSubmit.bind(this));n.EventEmitter.subscribe("onEntityCreate",this.onEntityCreateHandler.bind(this));n.EventEmitter.subscribe("onEntityUpdate",this.onEntityUpdateHandler.bind(this));n.EventEmitter.subscribe("onAttachFiles",this.onAttachFilesHandler.bind(this));n.EventEmitter.subscribe("BX.Main.Popup:onClose",this.onFileEditorCloseHandler.bind(this))}},{key:"onAttachFilesHandler",value:function e(t){var i=this.getEditorInstance();if(!i){return}var n=t.getCompatData(),a=babelHelpers.slicedToArray(n,3),s=a[2];if(s&&r.Type.isDomNode(s.fileInput)){var l=s.fileInput.closest("[data-cid]");if(r.Type.isDomNode(l)){var o=l.getAttribute("data-cid");var d=i.getControlByIdRecursive(o);if(d){d.markAsChanged()}}}}},{key:"onFileEditorCloseHandler",value:function e(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,1),a=n[0];if(a&&a.getId()==="popupFM"&&a.onApplyFlag){this.showNotification(r.Loc.getMessage("CATALOG_ENTITY_CARD_FILE_CLOSE_NOTIFICATION"),{autoHideDelay:5e3})}}},{key:"onEditorInitHandler",value:function e(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,2),a=n[0],r=n[1];if(a&&!r.entityId){var s=a.getControlByIdRecursive("NAME");if(s){requestAnimationFrame(function(){s.focus()})}}}},{key:"getEditorInstance",value:function e(){if(r.Reflection.getClass("BX.UI.EntityEditor")){return BX.UI.EntityEditor.getDefault()}return null}},{key:"onEditorAjaxSubmit",value:function e(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,2),a=n[0],s=n[1];var l=a["NAME-CODE"].NAME||"";this.changePageTitle(l);if(s.data){if(r.Type.isBoolean(s.data.IS_SIMPLE_PRODUCT)){this.isSimpleProduct=s.data.IS_SIMPLE_PRODUCT}}if(s.status==="success"){this.removeFileHiddenInputs()}}},{key:"onEntityCreateHandler",value:function e(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,1),a=n[0];this.postSliderMessage("onCreate",a)}},{key:"onEntityUpdateHandler",value:function e(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,1),a=n[0];this.postSliderMessage("onUpdate",a)}},{key:"postSliderMessage",value:function e(t,i){BX.SidePanel.Instance.postMessage(window,"Catalog.".concat(this.getEntityType(),"Card::").concat(t),i)}},{key:"changePageTitle",value:function e(t){var i=document.getElementById("pagetitle");if(r.Type.isDomNode(i)){i.innerText=t}document.title=t;if(BX.getClass("BX.SidePanel.Instance.updateBrowserTitle")){BX.SidePanel.Instance.updateBrowserTitle()}}},{key:"removeFileHiddenInputs",value:function e(){document.querySelectorAll('form>input[type="hidden"]').forEach(function(e){var t=e.getAttribute("name");var i=document.querySelector('form>input[name="'.concat(t,'_del"]'));if(i){r.Dom.remove(e);r.Dom.remove(i)}})}},{key:"onConfigurationManagerInit",value:function e(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,2),a=n[1];if(!a.type||a.type==="editor"){a.configurationFieldManager=this.initializeIblockFieldConfigurationManager(a)}if(a.id==="variation_grid"){a.configurationFieldManager=this.initializeVariationPropertyConfigurationManager(a)}}},{key:"initializeIblockFieldConfigurationManager",value:function e(t){var i=fe.create(this.id,t);i.setCreationPageUrl(this.settings.creationPropertyUrl);return i}},{key:"initializeVariationPropertyConfigurationManager",value:function e(t){var i=Ie.create(this.id,t);i.setCreationPageUrl(this.settings.creationVariationPropertyUrl);return i}},{key:"showNotification",value:function e(t,i){i=i||{};if(BX.GetWindowScrollPos().scrollTop<=10){i.stack=this.getStackWithOffset()}BX.UI.Notification.Center.notify({content:t,stack:i.stack||null,position:"top-right",width:"auto",category:i.category||null,autoHideDelay:i.autoHideDelay||3e3})}},{key:"getStackWithOffset",value:function e(){if(this.stackWithOffset===null){this.stackWithOffset=new BX.UI.Notification.Stack(BX.mergeEx({},BX.UI.Notification.Center.getStackDefaults(),{id:"top-right-with-offset",position:"top-right-with-offset",offsetY:74}))}return this.stackWithOffset}},{key:"openFeedbackPanel",value:function e(){if(!r.Reflection.getClass("BX.SidePanel.Instance")||!r.Type.isStringFilled(this.feedbackUrl)){return}BX.SidePanel.Instance.open(this.feedbackUrl,{cacheable:false,allowChangeHistory:false,width:580})}},{key:"getCardSettingsPopup",value:function e(){if(!this.settingsPopup){this.settingsPopup=new s.Popup(this.id,this.getSettingsButton().getContainer(),{autoHide:true,draggable:false,offsetLeft:0,offsetTop:0,angle:{position:"top",offset:43},noAllPaddings:true,bindOptions:{forceBindPosition:true},closeByEsc:true,content:this.prepareCardSettingsContent()})}return this.settingsPopup}},{key:"showCardSettingsPopup",value:function e(){var t=this;var i=function e(){return t.getCardSettingsPopup().show()};var n=r.Reflection.getClass("BX.Catalog.VariationGrid.Instance");if(n){n.askToLossGridData(i)}else{i()}}},{key:"prepareCardSettingsContent",value:function e(){var t=this;var i=r.Tag.render(ke||(ke=babelHelpers.taggedTemplateLiteral(["\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t"])));this.cardSettings.map(function(e){i.append(t.getSettingItem(e))});return i}},{key:"getSettingItem",value:function e(t){var i=r.Tag.render(Se||(Se=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input type="checkbox">\n\t\t'])));i.checked=t.checked;i.dataset.settingId=t.id;var n=r.Tag.render(Be||(Be=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<label class="ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100">\n\t\t\t\t\t<div class="ui-ctl-w10" style="text-align: center">','</div>\n\t\t\t\t\t<div class="ui-ctl-w75">\n\t\t\t\t\t\t<span class="ui-entity-editor-popup-create-field-item-title">','</span>\n\t\t\t\t\t\t<span class="ui-entity-editor-popup-create-field-item-desc">',"</span>\t\n\t\t\t\t\t</div>\n\t\t\t\t</label>\n\t\t\t"])),i,t.title,t.desc);r.Event.bind(n,"change",this.setProductCardSetting.bind(this));return n}},{key:"setProductCardSetting",value:function e(t){var i=this.getCardSetting(t.target.dataset.settingId);if(!i){return}var n=t.target.checked;if(i.action==="grid"){this.requestGridSettings(i,n)}else{this.requestCardSettings(i,n)}}},{key:"onSliderMessage",value:function e(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,1),a=n[0];if(a.getEventId()==="Catalog.VariationCard::onCreate"||a.getEventId()==="Catalog.VariationCard::onUpdate"){this.reloadVariationGrid()}}},{key:"requestGridSettings",value:function e(t,i){var n=this;if(!this.getVariationGrid());var a=[];var s=this.getVariationGrid().getRows().getHeadFirstChild().getCells();Array.from(s).forEach(function(e){if("name"in e.dataset){a.push(e.dataset.name)}});BX.ajax.runComponentAction(this.componentName,"setGridSetting",{mode:"class",data:{signedParameters:this.componentSignedParams,settingId:t.id,selected:i,currentHeaders:a}}).then(function(){t.checked=i;n.reloadVariationGrid();n.postSliderMessage("onUpdate",{});n.getCardSettingsPopup().close();var e=i?r.Loc.getMessage("CATALOG_ENTITY_CARD_SETTING_ENABLED"):r.Loc.getMessage("CATALOG_ENTITY_CARD_SETTING_DISABLED");n.showNotification(e.replace("#NAME#",t.title),{category:"popup-settings"})})}},{key:"requestCardSettings",value:function e(t,i){var n=this;BX.ajax.runComponentAction(this.componentName,"setCardSetting",{mode:"class",data:{signedParameters:this.componentSignedParams,settingId:t.id,selected:i}}).then(function(){t.checked=i;if(t.id==="CATALOG_PARAMETERS"){var e=n.getEditorInstance().getControlByIdRecursive("catalog_parameters");if(e){e.refreshLayout()}}n.getCardSettingsPopup().close();var a=i?r.Loc.getMessage("CATALOG_ENTITY_CARD_SETTING_ENABLED"):r.Loc.getMessage("CATALOG_ENTITY_CARD_SETTING_DISABLED");n.showNotification(a.replace("#NAME#",t.title),{category:"popup-settings"})})}},{key:"updateSettingsCheckboxState",value:function e(){var t=this;var i=this.getCardSettingsPopup().getContentContainer();this.cardSettings.filter(function(e){return e.action==="grid"&&r.Type.isArray(e.columns)}).forEach(function(e){var n=true;e.columns.forEach(function(e){if(!t.getVariationGrid().getColumnHeaderCellByName(e)){n=false}});var a=i.querySelector('input[data-setting-id="'+e.id+'"]');if(r.Type.isDomNode(a)){a.checked=n}})}}]);return e}();e.EntityCard=De})(this.BX.Catalog.EntityCard=this.BX.Catalog.EntityCard||{},BX,BX,BX.Event,BX,BX,BX.Main);
//# sourceMappingURL=entity-card.bundle.map.js