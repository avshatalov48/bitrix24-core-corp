{"version":3,"file":"iblock-product-list.bundle.js","sources":["../src/iblock-product-list-hints.js","../src/iblock-product-list.js"],"sourcesContent":["import { EventEmitter } from 'main.core.events';\nimport { Tag, Loc } from 'main.core';\n\nexport class IblockProductListHints\n{\n\t/**\n\t * @type {?BX.Main.grid}\n\t */\n\tgrid;\n\tvariations = new Map();\n\tvariationsEditData = new Map();\n\teditedVariations = new Map();\n\tmorePhotoChangedInputs = new Map();\n\tcanEditPrice;\n\n\tconstructor(options = {})\n\t{\n\t\tthis.gridId = options.gridId;\n\t\tthis.canEditPrice = options.canEditPrice === undefined ? true : options.canEditPrice === true;\n\n\t\tthis.#addAccessDeniedHintForCreateButton();\n\t\tthis.handleOnGridUpdatedHandler();\n\n\t\tEventEmitter.subscribe('Grid::updated', this.handleOnGridUpdatedHandler.bind(this));\n\t}\n\n\tgetGrid(): BX.Main.grid\n\t{\n\t\tif (!this.grid)\n\t\t{\n\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\n\t\treturn this.grid;\n\t}\n\n\thandleOnGridUpdatedHandler()\n\t{\n\t\tif (!this.canEditPrice)\n\t\t{\n\t\t\tthis.#addAccessDeniedHintForPriceColumns();\n\t\t}\n\t}\n\n\t#addAccessDeniedHintForPriceColumns(): void\n\t{\n\t\tthis.getGrid().getHeaders().forEach((header) => {\n\t\t\tconst cellsTitles = header.querySelectorAll(\n\t\t\t\t'.main-grid-cell-head[data-name^=\"CATALOG_GROUP_\"] .main-grid-head-title, .main-grid-cell-head[data-name^=\"PRICE_\"] .main-grid-head-title',\n\t\t\t);\n\t\t\tcellsTitles.forEach((title) => {\n\t\t\t\tconst lockIcon = Tag.render`\n\t\t\t\t\t<span class=\"ui-btn ui-btn-link ui-btn-icon-lock ui-btn-xs catalog-product-grid-lock-hint\"></span>\n\t\t\t\t`;\n\t\t\t\tlockIcon.dataset.hint = Loc.getMessage('CATALOG_IBLOCK_PRODUCT_LIST_PRICE_ACCESS_DENIED_HINT');\n\t\t\t\tlockIcon.dataset.hintNoIcon = true;\n\n\t\t\t\tBX.UI.Hint.createInstance({}).initNode(lockIcon);\n\n\t\t\t\ttitle.prepend(lockIcon);\n\t\t\t});\n\t\t});\n\t}\n\n\t#addAccessDeniedHintForCreateButton(): void\n\t{\n\t\tconst button = document.querySelector('#create_new_product_button_access_denied');\n\t\tif (button)\n\t\t{\n\t\t\tbutton.classList.add('ui-btn-icon-lock', 'ui-btn-disabled');\n\t\t\tbutton.dataset.hint = Loc.getMessage('CATALOG_IBLOCK_PRODUCT_LIST_CREATE_ACCESS_DENIED_HINT');\n\t\t\tbutton.dataset.hintNoIcon = true;\n\n\t\t\tBX.UI.Hint.createInstance({}).initNode(button);\n\t\t}\n\t}\n}\n","import type { BaseEvent } from 'main.core.events';\nimport { EventEmitter } from 'main.core.events';\nimport { Dom, Text, Type, Uri } from 'main.core';\nimport { IblockProductListHints } from './iblock-product-list-hints';\nimport './style.css';\n\nexport class IblockProductList\n{\n\t/**\n\t * @type {?BX.Main.grid}\n\t */\n\tgrid;\n\thints;\n\tvariations = new Map();\n\tvariationsEditData = new Map();\n\teditedVariations = new Map();\n\tmorePhotoChangedInputs = new Map();\n\n\tonSettingsWindowSaveHandler = this.handleOnSettingsWindowSave.bind(this);\n\tonChangeVariationHandler = this.handleOnChangeVariation.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonFilterApplyHandler = this.handleOnFilterApply.bind(this);\n\tonSaveImageHandler = this.handleOnSaveImage.bind(this);\n\n\tconstructor(options = {})\n\t{\n\t\tthis.gridId = options.gridId;\n\t\tthis.rowIdMask = options.rowIdMask ?? '#ID#';\n\t\tthis.variationFieldNames = options.variationFieldNames ?? [];\n\t\tthis.productVariationMap = options.productVariationMap ?? {};\n\t\tthis.createNewProductHref = options.createNewProductHref ?? '';\n\t\tthis.showCatalogWithOffers = options.showCatalogWithOffers ?? false;\n\n\t\tthis.addCustomClassToGrid();\n\t\tthis.cacheSelectedVariation();\n\n\t\tEventEmitter.subscribe('BX.Grid.SettingsWindow:save', this.onSettingsWindowSaveHandler);\n\t\tEventEmitter.subscribe('SkuProperty::onChange', this.onChangeVariationHandler);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApplyHandler);\n\t\tEventEmitter.subscribe('Catalog.ImageInput::save', this.onSaveImageHandler);\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', this.handlerOnSliderMessage.bind(this));\n\n\t\tthis.hints = new IblockProductListHints(options);\n\t}\n\n\taddCustomClassToGrid()\n\t{\n\t\tDom.addClass(this.getGrid().getContainer(), 'catalog-product-grid');\n\t}\n\n\tcacheSelectedVariation()\n\t{\n\t\tthis.getGrid().getRows().getBodyChild().forEach((row) => {\n\t\t\tconst rowId = row.getId();\n\t\t\tconst productId = this.getProductIdByRowId(rowId);\n\t\t\tconst variationId = this.getCurrentVariationIdByProduct(productId);\n\n\t\t\tif (variationId)\n\t\t\t{\n\t\t\t\tthis.variations.set(variationId, row.getNode().cloneNode(true));\n\t\t\t\tthis.variationsEditData.set(variationId, row.getEditData());\n\t\t\t}\n\t\t});\n\t}\n\n\tclearAllVariationCache()\n\t{\n\t\tthis.variations.clear();\n\t\tthis.variationsEditData.clear();\n\t\tthis.editedVariations.clear();\n\t\tthis.morePhotoChangedInputs.clear();\n\t}\n\n\tclearVariationCache(variationId)\n\t{\n\t\tthis.variations.delete(variationId);\n\t\tthis.variationsEditData.delete(variationId);\n\t\tthis.editedVariations.delete(variationId);\n\t}\n\n\t/**\n\t * @returns {?BX.Main.grid}\n\t */\n\tgetGrid()\n\t{\n\t\tif (!this.grid)\n\t\t{\n\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\n\t\treturn this.grid;\n\t}\n\n\thandleOnSettingsWindowSave(event: BaseEvent)\n\t{\n\t\tconst [settingsWindow] = event.getCompatData();\n\t\tconst selectedColumns = settingsWindow.getSelectedColumns();\n\t\tthis.showCatalogWithOffers = selectedColumns.includes('CATALOG_PRODUCT');\n\t}\n\n\thandleOnChangeVariation(event: BaseEvent)\n\t{\n\t\tconst [skuFields] = event.getData();\n\t\tconst productId = Text.toNumber(skuFields.PARENT_PRODUCT_ID);\n\t\tconst variationId = Text.toNumber(skuFields.ID);\n\n\t\tif (productId <= 0 || variationId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst productRow = this.getProductRow(productId);\n\n\t\tif (productRow.isEdit())\n\t\t{\n\t\t\tconst values = this.getEditedVariationValues(productRow);\n\t\t\tconst currentVariationId = this.getCurrentVariationIdByProduct(productId);\n\t\t\tthis.editedVariations.set(currentVariationId, values);\n\t\t}\n\n\t\tif (productRow.isEdit() && this.editedVariations.has(variationId))\n\t\t{\n\t\t\tconst editData = Object.assign(productRow.getEditData(), this.editedVariations.get(variationId));\n\t\t\tproductRow.setEditData(editData);\n\t\t\tproductRow.editCancel();\n\t\t\tproductRow.edit();\n\t\t\tthis.productVariationMap[productId] = variationId;\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getVariation(productId, variationId)\n\t\t\t.then((variationNode) => {\n\t\t\t\tthis.updateProductRow(productId, variationId, variationNode);\n\t\t\t\tthis.productVariationMap[productId] = variationId;\n\t\t\t});\n\t}\n\n\tgetEditedVariationValues(row: BX.Grid.Row)\n\t{\n\t\tconst currentEditorValues = row.getEditorValue();\n\t\tconst headRow = this.getHeadRow();\n\t\tconst values = {};\n\t\tlet morePhotoHtml = null;\n\t\t[...row.getCells()].forEach((cell, index) => {\n\t\t\tconst cellName = headRow.getCellNameByCellIndex(index);\n\t\t\tif (cellName !== 'MORE_PHOTO')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst editorContainer = row.getEditorContainer(cell);\n\t\t\tif (editorContainer)\n\t\t\t{\n\t\t\t\tconst imageBlock = editorContainer.querySelector('.catalog-image-input-wrapper');\n\t\t\t\tconst id = imageBlock.id;\n\t\t\t\tif (this.morePhotoChangedInputs.has(id))\n\t\t\t\t{\n\t\t\t\t\tmorePhotoHtml = this.morePhotoChangedInputs.get(id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tmorePhotoHtml = imageBlock.outerHTML;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tfor (const name in currentEditorValues)\n\t\t{\n\t\t\tif (!currentEditorValues.hasOwnProperty(name) || !this.variationFieldNames.includes(name))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (name === 'MORE_PHOTO' && !Type.isNil(morePhotoHtml))\n\t\t\t{\n\t\t\t\tvalues[name] = morePhotoHtml;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvalues[name] = currentEditorValues[name];\n\t\t\t}\n\t\t}\n\n\t\treturn values;\n\t}\n\n\tgetVariation(productId, variationId)\n\t{\n\t\tif (this.getProductRow(productId).isEdit() && this.editedVariations.has(variationId))\n\t\t{\n\t\t\treturn Promise.resolve(this.editedVariations.get(variationId));\n\t\t}\n\n\t\tif (this.variations.has(variationId))\n\t\t{\n\t\t\treturn Promise.resolve(this.variations.get(variationId));\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.loadVariation(productId, variationId, resolve);\n\t\t})\n\t\t\t.then((variation) => {\n\t\t\t\tif (Type.isDomNode(variation))\n\t\t\t\t{\n\t\t\t\t\tthis.variations.set(variationId, variation);\n\n\t\t\t\t\treturn variation;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t});\n\t}\n\n\tloadVariation(productId, variationId, resolve)\n\t{\n\t\tconst self = this;\n\t\tconst url = '';\n\t\tconst method = 'POST';\n\t\tconst data = { productId, variationId };\n\n\t\tthis.getProductRow(productId).stateLoad();\n\t\tthis.getGrid().getData().request(url, method, data, 'changeVariation', function() {\n\t\t\tEventEmitter.emit('Grid::updated', [self.getGrid()]);\n\t\t\tconst row = self.getProductRow(productId);\n\t\t\tif (row)\n\t\t\t{\n\t\t\t\trow.stateUnload();\n\t\t\t\tresolve(this.getRowById(row.getId()));\n\t\t\t}\n\t\t});\n\t}\n\n\tgetProductIdByRowId(rowId)\n\t{\n\t\tconst mask = new RegExp(this.rowIdMask.replace('#ID#', '([0-9]+)'));\n\t\tconst matches = rowId.match(mask);\n\n\t\treturn Type.isArray(matches) ? Text.toNumber(matches[1]) : 0;\n\t}\n\n\tgetRowIdByProductId(id)\n\t{\n\t\treturn this.rowIdMask.replace('#ID#', id);\n\t}\n\n\t/**\n\t * @param id\n\t * @returns {?BX.Grid.Row}\n\t */\n\tgetProductRow(id)\n\t{\n\t\tconst rowId = this.getRowIdByProductId(id);\n\n\t\treturn this.getGrid().getRows().getById(rowId);\n\t}\n\n\t/**\n\t * @returns {?BX.Grid.Row}\n\t */\n\tgetHeadRow()\n\t{\n\t\treturn this.getGrid().getRows().getHeadFirstChild();\n\t}\n\n\tupdateProductRow(productId, variationId, variationNode)\n\t{\n\t\tif (!productId || !Type.isDomNode(variationNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst headRow = this.getHeadRow();\n\t\tconst productRow = this.getProductRow(productId);\n\t\tconst fields = {};\n\n\t\t[...variationNode.cells].forEach((cell, index) => {\n\t\t\tconst cellName = headRow.getCellNameByCellIndex(index);\n\n\t\t\tif (this.variationFieldNames.includes(cellName))\n\t\t\t{\n\t\t\t\tconst columnCell = productRow.getCellByIndex(index);\n\t\t\t\tif (columnCell)\n\t\t\t\t{\n\t\t\t\t\tconst cellHtml = productRow.getContentContainer(cell).innerHTML;\n\t\t\t\t\tproductRow.getContentContainer(columnCell).innerHTML = cellHtml;\n\t\t\t\t\tfields[cellName] = cellHtml;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (this.variationsEditData.has(variationId))\n\t\t{\n\t\t\tproductRow.setEditData(this.variationsEditData.get(variationId));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tproductRow.resetEditData();\n\t\t\tthis.variationsEditData.set(variationId, productRow.getEditData());\n\t\t}\n\n\t\tif (productRow.isEdit())\n\t\t{\n\t\t\tproductRow.editCancel();\n\t\t\tproductRow.edit();\n\t\t}\n\t}\n\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [, gridData] = event.getData();\n\t\tconst submitData = BX.prop.get(gridData, 'data', {});\n\n\t\t// reload settings, columns or something else\n\t\tif (!submitData.productId && !submitData.FIELDS)\n\t\t{\n\t\t\tthis.clearAllVariationCache();\n\t\t}\n\n\t\tif (submitData.FIELDS)\n\t\t{\n\t\t\tthis.editedVariations.forEach((editFields, variationId) => {\n\t\t\t\tconst rowId = this.getRowIdByProductId(variationId);\n\t\t\t\tsubmitData.FIELDS[rowId] = submitData.FIELDS[rowId] || {};\n\t\t\t\tObject.keys(editFields).map((cellName) => {\n\t\t\t\t\tif (cellName.includes('CATALOG_GROUP_'))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst groupPriceId = cellName.replace('CATALOG_GROUP_', '');\n\t\t\t\t\t\tif (!Type.isNil(editFields[cellName].PRICE))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsubmitData.CATALOG_PRICE = submitData.CATALOG_PRICE || {};\n\t\t\t\t\t\t\tsubmitData.CATALOG_PRICE[variationId] = submitData.CATALOG_PRICE[variationId] || {};\n\t\t\t\t\t\t\tsubmitData.CATALOG_PRICE[variationId][groupPriceId] = editFields[cellName].PRICE.VALUE;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!Type.isNil(editFields[cellName].CURRENCY))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsubmitData.CATALOG_CURRENCY = submitData.CATALOG_CURRENCY || {};\n\t\t\t\t\t\t\tsubmitData.CATALOG_CURRENCY[variationId] = submitData.CATALOG_CURRENCY[variationId] || {};\n\t\t\t\t\t\t\tsubmitData.CATALOG_CURRENCY[variationId][groupPriceId] = editFields[cellName].CURRENCY.VALUE;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (cellName !== 'MORE_PHOTO' && cellName !== 'MORE_PHOTO_custom')\n\t\t\t\t\t{\n\t\t\t\t\t\tsubmitData.FIELDS[rowId][cellName] = editFields[cellName];\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.clearVariationCache(variationId);\n\t\t\t});\n\n\t\t\tfor (const rowId in submitData.FIELDS)\n\t\t\t{\n\t\t\t\tif (!submitData.FIELDS.hasOwnProperty(rowId))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst productId = this.getProductIdByRowId(rowId);\n\t\t\t\tconst variationId = this.getCurrentVariationIdByProduct(productId);\n\t\t\t\tconst newFilesRegExp = new RegExp(/(\\w+?(_n\\d+)*)\\[([A-Z_a-z]+)]/);\n\t\t\t\tconst rowFields = submitData.FIELDS[rowId];\n\t\t\t\tconst morePhotoValues = {};\n\t\t\t\tif (!Type.isNil(rowFields.MORE_PHOTO_custom))\n\t\t\t\t{\n\t\t\t\t\tfor (const key in rowFields.MORE_PHOTO_custom)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!rowFields.MORE_PHOTO_custom.hasOwnProperty(key))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst inputValue = rowFields.MORE_PHOTO_custom[key];\n\t\t\t\t\t\tif (!Type.isNil(inputValue))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (newFilesRegExp.test(inputValue.name))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet fileCounter; let\n\t\t\t\t\t\t\t\t\tfileSetting;\n\t\t\t\t\t\t\t\t[, fileCounter, , fileSetting] = inputValue.name.match(newFilesRegExp);\n\t\t\t\t\t\t\t\tif (fileCounter && fileSetting)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmorePhotoValues[fileCounter] = morePhotoValues[fileCounter] || {};\n\t\t\t\t\t\t\t\t\tmorePhotoValues[fileCounter][fileSetting] = inputValue.value;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmorePhotoValues[inputValue.name] = inputValue.value;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\trowFields.MORE_PHOTO = morePhotoValues;\n\t\t\t\tif (variationId && this.showCatalogWithOffers)\n\t\t\t\t{\n\t\t\t\t\tconst variationRowId = this.getRowIdByProductId(variationId);\n\t\t\t\t\t// clear old cache\n\t\t\t\t\tthis.clearVariationCache(variationId);\n\n\t\t\t\t\tsubmitData.FIELDS[variationRowId] = {};\n\n\t\t\t\t\tfor (const fieldName of this.variationFieldNames)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!rowFields.hasOwnProperty(fieldName))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsubmitData.FIELDS[variationRowId][fieldName] = rowFields[fieldName];\n\t\t\t\t\t\tdelete submitData.FIELDS[rowId][fieldName];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.morePhotoChangedInputs.clear();\n\t\t}\n\t}\n\n\tgetCurrentVariationIdByProduct(productId)\n\t{\n\t\treturn productId in this.productVariationMap ? Text.toNumber(this.productVariationMap[productId]) : null;\n\t}\n\n\thandleOnFilterApply(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst filterGridId = data[0];\n\t\tconst filter = data[2] instanceof BX.Main.Filter ? event.getData()[2] : null;\n\n\t\tif (filter && (filterGridId === this.gridId))\n\t\t{\n\t\t\tconst filterFields = this.getFilterFields(filter);\n\n\t\t\tlet sectionId = '0';\n\n\t\t\tif (Type.isArray(filterFields))\n\t\t\t{\n\t\t\t\tconst fieldSectionId = this.getFieldSectionId(filterFields);\n\n\t\t\t\tif (fieldSectionId)\n\t\t\t\t{\n\t\t\t\t\tconst value = fieldSectionId.VALUE;\n\n\t\t\t\t\tif (Type.isObject(value))\n\t\t\t\t\t{\n\t\t\t\t\t\tsectionId = value.VALUE;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setNewProductButtonHrefSectionId(sectionId);\n\t\t}\n\t}\n\n\thandleOnSaveImage(event: BaseEvent)\n\t{\n\t\tconst [id, inputId, response] = event.getData();\n\t\tthis.morePhotoChangedInputs.set(id, response.data.input);\n\t}\n\n\thandlerOnSliderMessage(event: BaseEvent)\n\t{\n\t\tconst [sliderEvent] = event.getCompatData();\n\n\t\tif (\n\t\t\tsliderEvent.getEventId() === 'Catalog.ProductCard::onCreate'\n\t\t\t|| sliderEvent.getEventId() === 'Catalog.ProductCard::onUpdate'\n\t\t\t// compatibility for admin forms\n\t\t\t|| sliderEvent.getEventId() === 'save'\n\t\t\t|| sliderEvent.getEventId() === 'apply'\n\t\t)\n\t\t{\n\t\t\tthis.getGrid().reload();\n\t\t}\n\t}\n\n\tgetFilterFields(filter: BX.Main.Filter)\n\t{\n\t\tconst presets = filter.getParam('PRESETS');\n\n\t\tlet tmpFilterPreset = null;\n\n\t\tif (Type.isArray(presets))\n\t\t{\n\t\t\ttmpFilterPreset = presets.find((preset) => {\n\t\t\t\treturn preset.ID === 'tmp_filter';\n\t\t\t});\n\t\t}\n\n\t\tif (tmpFilterPreset)\n\t\t{\n\t\t\treturn tmpFilterPreset.FIELDS || null;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetFieldSectionId(fields: Array)\n\t{\n\t\treturn fields.find((field) => {\n\t\t\treturn field.ID === 'field_SECTION_ID';\n\t\t});\n\t}\n\n\tsetNewProductButtonHrefSectionId(sectionId: String)\n\t{\n\t\tconst nodes = document.querySelectorAll('[data-grid-create-button]');\n\t\tif (nodes.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst buttonContainer = Array.prototype.find.call(nodes, (item) => item.dataset.gridCreateButton === this.gridId);\n\t\tif (Type.isDomNode(buttonContainer))\n\t\t{\n\t\t\tconst buttonObject = BX.UI.ButtonManager.getByUniqid(buttonContainer.dataset.btnUniqid);\n\t\t\tif (!buttonObject)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// main\n\t\t\tconst mainButton = buttonObject.getMainButton();\n\t\t\tif (mainButton && mainButton.getLink())\n\t\t\t{\n\t\t\t\tconst uri = new Uri(mainButton.getLink());\n\t\t\t\turi.setQueryParams({\n\t\t\t\t\tIBLOCK_SECTION_ID: sectionId,\n\t\t\t\t});\n\n\t\t\t\tmainButton.setLink(uri.toString());\n\t\t\t}\n\n\t\t\t// menu\n\t\t\tbuttonObject.getMenuWindow()?.getMenuItems()?.forEach((item) => {\n\t\t\t\tconst link = item.getLayout().item;\n\t\t\t\tif (link.tagName === 'A')\n\t\t\t\t{\n\t\t\t\t\tconst uri = new Uri(link.href);\n\t\t\t\t\turi.setQueryParams({\n\t\t\t\t\t\tIBLOCK_SECTION_ID: sectionId,\n\t\t\t\t\t});\n\n\t\t\t\t\tlink.href = uri.toString();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n"],"names":["IblockProductListHints","options","Map","gridId","canEditPrice","undefined","handleOnGridUpdatedHandler","EventEmitter","subscribe","bind","grid","BX","Main","gridManager","getInstanceById","getGrid","getHeaders","forEach","header","cellsTitles","querySelectorAll","title","lockIcon","Tag","render","dataset","hint","Loc","getMessage","hintNoIcon","UI","Hint","createInstance","initNode","prepend","button","document","querySelector","classList","add","IblockProductList","handleOnSettingsWindowSave","handleOnChangeVariation","handleOnBeforeGridRequest","handleOnFilterApply","handleOnSaveImage","rowIdMask","variationFieldNames","productVariationMap","createNewProductHref","showCatalogWithOffers","addCustomClassToGrid","cacheSelectedVariation","onSettingsWindowSaveHandler","onChangeVariationHandler","onBeforeGridRequestHandler","onFilterApplyHandler","onSaveImageHandler","handlerOnSliderMessage","hints","Dom","addClass","getContainer","getRows","getBodyChild","row","rowId","getId","productId","getProductIdByRowId","variationId","getCurrentVariationIdByProduct","variations","set","getNode","cloneNode","variationsEditData","getEditData","clear","editedVariations","morePhotoChangedInputs","event","getCompatData","settingsWindow","selectedColumns","getSelectedColumns","includes","getData","skuFields","Text","toNumber","PARENT_PRODUCT_ID","ID","productRow","getProductRow","isEdit","values","getEditedVariationValues","currentVariationId","has","editData","Object","assign","get","setEditData","editCancel","edit","getVariation","then","variationNode","updateProductRow","currentEditorValues","getEditorValue","headRow","getHeadRow","morePhotoHtml","getCells","cell","index","cellName","getCellNameByCellIndex","editorContainer","getEditorContainer","imageBlock","id","outerHTML","name","hasOwnProperty","Type","isNil","Promise","resolve","loadVariation","variation","isDomNode","self","url","method","data","stateLoad","request","emit","stateUnload","getRowById","mask","RegExp","replace","matches","match","isArray","getRowIdByProductId","getById","getHeadFirstChild","cells","columnCell","getCellByIndex","cellHtml","getContentContainer","innerHTML","resetEditData","gridData","submitData","prop","FIELDS","clearAllVariationCache","editFields","keys","map","groupPriceId","PRICE","CATALOG_PRICE","VALUE","CURRENCY","CATALOG_CURRENCY","clearVariationCache","newFilesRegExp","rowFields","morePhotoValues","MORE_PHOTO_custom","key","inputValue","test","fileCounter","fileSetting","value","MORE_PHOTO","variationRowId","fieldName","filterGridId","filter","Filter","filterFields","getFilterFields","sectionId","fieldSectionId","getFieldSectionId","isObject","setNewProductButtonHrefSectionId","inputId","response","input","sliderEvent","getEventId","reload","presets","getParam","tmpFilterPreset","find","preset","fields","field","nodes","length","buttonContainer","Array","prototype","call","item","gridCreateButton","buttonObject","ButtonManager","getByUniqid","btnUniqid","mainButton","getMainButton","getLink","uri","Uri","setQueryParams","IBLOCK_SECTION_ID","setLink","toString","getMenuWindow","getMenuItems","link","getLayout","tagName","href"],"mappings":"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"}