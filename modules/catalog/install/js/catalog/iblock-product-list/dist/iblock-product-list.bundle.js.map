{"version":3,"file":"iblock-product-list.bundle.js","sources":["../src/iblock-product-list-hints.js","../src/iblock-product-list.js"],"sourcesContent":["import {EventEmitter} from 'main.core.events';\nimport {Tag, Loc} from 'main.core';\n\nexport class IblockProductListHints\n{\n\t/**\n\t * @type {?BX.Main.grid}\n\t */\n\tgrid;\n\tvariations = new Map();\n\tvariationsEditData = new Map();\n\teditedVariations = new Map();\n\tmorePhotoChangedInputs = new Map();\n\tcanEditPrice;\n\n\tconstructor(options = {})\n\t{\n\t\tthis.gridId = options.gridId;\n\t\tthis.canEditPrice = options.canEditPrice !== undefined ? options.canEditPrice === true : true;\n\n\t\tthis.#addAccessDeniedHintForCreateButton();\n\t\tthis.handleOnGridUpdatedHandler();\n\n\t\tEventEmitter.subscribe('Grid::updated', this.handleOnGridUpdatedHandler.bind(this));\n\t}\n\n\tgetGrid()\n\t{\n\t\tif (!this.grid)\n\t\t{\n\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\n\t\treturn this.grid;\n\t}\n\n\thandleOnGridUpdatedHandler()\n\t{\n\t\tif (!this.canEditPrice)\n\t\t{\n\t\t\tthis.#addAccessDeniedHintForPriceColumns();\n\t\t}\n\t}\n\n\t#addAccessDeniedHintForPriceColumns(): void\n\t{\n\t\tthis.getGrid().getHeaders().forEach((header) => {\n\t\t\tconst cellsTitles = header.querySelectorAll('.main-grid-cell-head[data-name^=\"CATALOG_GROUP_\"] .main-grid-head-title');\n\t\t\tcellsTitles.forEach((title) => {\n\t\t\t\tconst lockIcon = Tag.render`\n\t\t\t\t<span class=\"ui-btn ui-btn-link ui-btn-icon-lock ui-btn-xs catalog-product-grid-lock-hint\"></span>\n\t\t\t\t`;\n\t\t\t\tlockIcon.dataset.hint = Loc.getMessage('CATALOG_IBLOCK_PRODUCT_LIST_PRICE_ACCESS_DENIED_HINT');\n\t\t\t\tlockIcon.dataset.hintNoIcon = true;\n\n\t\t\t\tBX.UI.Hint.initNode(lockIcon);\n\n\t\t\t\ttitle.prepend(lockIcon);\n\t\t\t});\n\t\t});\n\t}\n\n\t#addAccessDeniedHintForCreateButton(): void\n\t{\n\t\tconst button = document.querySelector('#create_new_product_button_access_denied');\n\t\tif (button)\n\t\t{\n\t\t\tbutton.classList.add('ui-btn-icon-lock', 'ui-btn-disabled');\n\t\t\tbutton.dataset.hint = Loc.getMessage('CATALOG_IBLOCK_PRODUCT_LIST_CREATE_ACCESS_DENIED_HINT');\n\t\t\tbutton.dataset.hintNoIcon = true;\n\n\t\t\tBX.UI.Hint.initNode(button);\n\t\t}\n\t}\n}\n","import type {BaseEvent} from 'main.core.events';\nimport {EventEmitter} from 'main.core.events';\nimport {Dom, Tag, Text, Type, Uri, Loc} from 'main.core';\nimport { IblockProductListHints } from './iblock-product-list-hints';\nimport './style.css';\n\nexport class IblockProductList\n{\n\t/**\n\t * @type {?BX.Main.grid}\n\t */\n\tgrid;\n\thints;\n\tvariations = new Map();\n\tvariationsEditData = new Map();\n\teditedVariations = new Map();\n\tmorePhotoChangedInputs = new Map();\n\n\tonSettingsWindowSaveHandler = this.handleOnSettingsWindowSave.bind(this);\n\tonChangeVariationHandler = this.handleOnChangeVariation.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonFilterApplyHandler = this.handleOnFilterApply.bind(this);\n\tonSaveImageHandler = this.handleOnSaveImage.bind(this);\n\n\tconstructor(options = {})\n\t{\n\t\tthis.gridId = options.gridId;\n\t\tthis.rowIdMask = options.rowIdMask || '#ID#';\n\t\tthis.variationFieldNames = options.variationFieldNames || [];\n\t\tthis.productVariationMap = options.productVariationMap || {};\n\t\tthis.createNewProductHref = options.createNewProductHref || '';\n\t\tthis.showCatalogWithOffers = options.showCatalogWithOffers || false;\n\n\t\tthis.addCustomClassToGrid();\n\t\tthis.cacheSelectedVariation();\n\n\t\tEventEmitter.subscribe('BX.Grid.SettingsWindow:save', this.onSettingsWindowSaveHandler);\n\t\tEventEmitter.subscribe('SkuProperty::onChange', this.onChangeVariationHandler);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApplyHandler);\n\t\tEventEmitter.subscribe('Catalog.ImageInput::save', this.onSaveImageHandler);\n\n\t\tthis.hints = new IblockProductListHints(options);\n\t}\n\n\taddCustomClassToGrid()\n\t{\n\t\tDom.addClass(this.getGrid().getContainer(), 'catalog-product-grid');\n\t}\n\n\tcacheSelectedVariation()\n\t{\n\t\tthis.getGrid().getRows().getBodyChild().forEach((row) => {\n\t\t\tlet rowId = row.getId();\n\t\t\tlet productId = this.getProductIdByRowId(rowId);\n\t\t\tlet variationId = this.getCurrentVariationIdByProduct(productId);\n\n\t\t\tif (variationId)\n\t\t\t{\n\t\t\t\tthis.variations.set(variationId, row.getNode().cloneNode(true));\n\t\t\t\tthis.variationsEditData.set(variationId, row.getEditData());\n\t\t\t}\n\t\t});\n\t}\n\n\tclearAllVariationCache()\n\t{\n\t\tthis.variations.clear();\n\t\tthis.variationsEditData.clear();\n\t\tthis.editedVariations.clear();\n\t\tthis.morePhotoChangedInputs.clear();\n\t}\n\n\tclearVariationCache(variationId)\n\t{\n\t\tthis.variations.delete(variationId);\n\t\tthis.variationsEditData.delete(variationId);\n\t\tthis.editedVariations.delete(variationId);\n\t}\n\n\t/**\n\t * @returns {?BX.Main.grid}\n\t */\n\tgetGrid()\n\t{\n\t\tif (!this.grid)\n\t\t{\n\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\n\t\treturn this.grid;\n\t}\n\n\thandleOnSettingsWindowSave(event: BaseEvent)\n\t{\n\t\tconst [settingsWindow] = event.getCompatData();\n\t\tconst selectedColumns = settingsWindow.getSelectedColumns();\n\t\tthis.showCatalogWithOffers = selectedColumns.indexOf('CATALOG_PRODUCT') !== -1;\n\t}\n\n\thandleOnChangeVariation(event: BaseEvent)\n\t{\n\t\tconst [skuFields] = event.getData();\n\t\tconst productId = Text.toNumber(skuFields.PARENT_PRODUCT_ID);\n\t\tconst variationId = Text.toNumber(skuFields.ID);\n\n\t\tif (productId <= 0 || variationId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst productRow = this.getProductRow(productId);\n\n\t\tif (productRow.isEdit())\n\t\t{\n\t\t\tconst values = this.getEditedVariationValues(productRow);\n\t\t\tconst currentVariationId = this.getCurrentVariationIdByProduct(productId);\n\t\t\tthis.editedVariations.set(currentVariationId, values);\n\t\t}\n\n\t\tif (productRow.isEdit() && this.editedVariations.has(variationId))\n\t\t{\n\t\t\tconst editData = Object.assign(productRow.getEditData(), this.editedVariations.get(variationId));\n\t\t\tproductRow.setEditData(editData);\n\t\t\tproductRow.editCancel();\n\t\t\tproductRow.edit();\n\t\t\tthis.productVariationMap[productId] = variationId;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getVariation(productId, variationId)\n\t\t\t.then((variationNode) => {\n\t\t\t\tthis.updateProductRow(productId, variationId, variationNode);\n\t\t\t\tthis.productVariationMap[productId] = variationId;\n\t\t\t});\n\t}\n\n\tgetEditedVariationValues(row: BX.Grid.Row)\n\t{\n\t\tconst currentEditorValues = row.getEditorValue();\n\t\tconst headRow = this.getHeadRow();\n\t\tconst values = {};\n\t\tlet morePhotoHtml = null;\n\t\t[...row.getCells()].forEach((cell, index) => {\n\t\t\tconst cellName = headRow.getCellNameByCellIndex(index);\n\t\t\tif (cellName !== 'MORE_PHOTO')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst editorContainer = row.getEditorContainer(cell);\n\t\t\tif (editorContainer)\n\t\t\t{\n\t\t\t\tconst imageBlock = editorContainer.querySelector('.catalog-image-input-wrapper');\n\t\t\t\tconst id = imageBlock.id;\n\t\t\t\tif (this.morePhotoChangedInputs.has(id))\n\t\t\t\t{\n\t\t\t\t\tmorePhotoHtml = this.morePhotoChangedInputs.get(id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tmorePhotoHtml = imageBlock.outerHTML;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tfor (let name in currentEditorValues)\n\t\t{\n\t\t\tif (!currentEditorValues.hasOwnProperty(name) || !this.variationFieldNames.includes(name))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (name === 'MORE_PHOTO' && !Type.isNil(morePhotoHtml))\n\t\t\t{\n\t\t\t\tvalues[name] = morePhotoHtml;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvalues[name] = currentEditorValues[name];\n\t\t\t}\n\t\t}\n\n\t\treturn values;\n\t}\n\n\tgetVariation(productId, variationId)\n\t{\n\t\tif (this.getProductRow(productId).isEdit() && this.editedVariations.has(variationId))\n\t\t{\n\t\t\treturn Promise.resolve(this.editedVariations.get(variationId))\n\t\t}\n\n\t\tif (this.variations.has(variationId))\n\t\t{\n\t\t\treturn Promise.resolve(this.variations.get(variationId))\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.loadVariation(productId, variationId, resolve);\n\t\t})\n\t\t\t.then((variation) => {\n\t\t\t\tif (Type.isDomNode(variation))\n\t\t\t\t{\n\t\t\t\t\tthis.variations.set(variationId, variation);\n\t\t\t\t\treturn variation;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t});\n\t}\n\n\tloadVariation(productId, variationId, resolve)\n\t{\n\t\tconst self = this;\n\t\tconst url = '';\n\t\tconst method = 'POST';\n\t\tconst data = {productId, variationId};\n\n\t\tthis.getProductRow(productId).stateLoad();\n\t\tthis.getGrid().getData().request(url, method, data, 'changeVariation', function() {\n\t\t\tconst row = self.getProductRow(productId);\n\t\t\tif (row)\n\t\t\t{\n\t\t\t\trow.stateUnload();\n\t\t\t\tresolve(this.getRowById(row.getId()));\n\t\t\t}\n\t\t});\n\t}\n\n\tgetProductIdByRowId(rowId)\n\t{\n\t\tconst mask = new RegExp(this.rowIdMask.replace('#ID#', '([0-9]+)'));\n\t\tconst matches = rowId.match(mask);\n\n\t\treturn Type.isArray(matches) ? Text.toNumber(matches[1]) : 0;\n\t}\n\n\tgetRowIdByProductId(id)\n\t{\n\t\treturn this.rowIdMask.replace('#ID#', id);\n\t}\n\n\t/**\n\t * @param id\n\t * @returns {?BX.Grid.Row}\n\t */\n\tgetProductRow(id)\n\t{\n\t\tconst rowId = this.getRowIdByProductId(id);\n\n\t\treturn this.getGrid().getRows().getById(rowId);\n\t}\n\n\t/**\n\t * @returns {?BX.Grid.Row}\n\t */\n\tgetHeadRow()\n\t{\n\t\treturn this.getGrid().getRows().getHeadFirstChild();\n\t}\n\n\tupdateProductRow(productId, variationId, variationNode)\n\t{\n\t\tif (!productId || !Type.isDomNode(variationNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst headRow = this.getHeadRow();\n\t\tconst productRow = this.getProductRow(productId);\n\t\tconst fields = {};\n\n\t\t[...variationNode.cells].forEach((cell, index) => {\n\t\t\tconst cellName = headRow.getCellNameByCellIndex(index);\n\n\t\t\tif (this.variationFieldNames.includes(cellName))\n\t\t\t{\n\t\t\t\tlet columnCell = productRow.getCellByIndex(index);\n\t\t\t\tif (columnCell)\n\t\t\t\t{\n\t\t\t\t\tlet cellHtml = productRow.getContentContainer(cell).innerHTML;\n\t\t\t\t\tproductRow.getContentContainer(columnCell).innerHTML = cellHtml;\n\t\t\t\t\tfields[cellName] = cellHtml;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (this.variationsEditData.has(variationId))\n\t\t{\n\t\t\tproductRow.setEditData(this.variationsEditData.get(variationId));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tproductRow.resetEditData();\n\t\t\tthis.variationsEditData.set(variationId, productRow.getEditData());\n\t\t}\n\n\t\tif (productRow.isEdit())\n\t\t{\n\t\t\tproductRow.editCancel();\n\t\t\tproductRow.edit();\n\t\t}\n\t}\n\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [, gridData] = event.getData();\n\t\tconst submitData = BX.prop.get(gridData, 'data', {});\n\n\t\t// reload settings, columns or something else\n\t\tif (!submitData.productId && !submitData.FIELDS)\n\t\t{\n\t\t\tthis.clearAllVariationCache();\n\t\t}\n\n\t\tif (submitData.FIELDS)\n\t\t{\n\t\t\tthis.editedVariations.forEach((editFields, variationId) => {\n\t\t\t\tconst rowId = this.getRowIdByProductId(variationId);\n\t\t\t\tsubmitData.FIELDS[rowId] = submitData.FIELDS[rowId] || {};\n\t\t\t\tObject.keys(editFields).map((cellName) => {\n\t\t\t\t\tif (cellName.indexOf('CATALOG_GROUP_') >= 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst groupPriceId = cellName.replace('CATALOG_GROUP_', '');\n\t\t\t\t\t\tif (!Type.isNil(editFields[cellName]['PRICE']))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsubmitData['CATALOG_PRICE'] = submitData['CATALOG_PRICE'] || {};\n\t\t\t\t\t\t\tsubmitData['CATALOG_PRICE'][variationId] = submitData['CATALOG_PRICE'][variationId] || {};\n\t\t\t\t\t\t\tsubmitData['CATALOG_PRICE'][variationId][groupPriceId] = editFields[cellName]['PRICE']['VALUE'];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!Type.isNil(editFields[cellName]['CURRENCY']))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsubmitData['CATALOG_CURRENCY'] = submitData['CATALOG_CURRENCY'] || {};\n\t\t\t\t\t\t\tsubmitData['CATALOG_CURRENCY'][variationId] = submitData['CATALOG_CURRENCY'][variationId] || {};\n\t\t\t\t\t\t\tsubmitData['CATALOG_CURRENCY'][variationId][groupPriceId] = editFields[cellName]['CURRENCY']['VALUE'];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (cellName !== 'MORE_PHOTO' && cellName !== 'MORE_PHOTO_custom')\n\t\t\t\t\t{\n\t\t\t\t\t\tsubmitData.FIELDS[rowId][cellName] = editFields[cellName];\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.clearVariationCache(variationId);\n\t\t\t});\n\n\t\t\tfor (let rowId in submitData.FIELDS)\n\t\t\t{\n\t\t\t\tif (!submitData.FIELDS.hasOwnProperty(rowId))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst productId = this.getProductIdByRowId(rowId);\n\t\t\t\tconst variationId = this.getCurrentVariationIdByProduct(productId);\n\t\t\t\tconst newFilesRegExp = new RegExp(/([0-9A-Za-z_]+?(_n\\d+)*)\\[([A-Za-z_]+)\\]/);\n\t\t\t\tconst rowFields = submitData.FIELDS[rowId];\n\t\t\t\tconst morePhotoValues = {};\n\t\t\t\tif (!Type.isNil(rowFields['MORE_PHOTO_custom']))\n\t\t\t\t{\n\t\t\t\t\tfor (let key in rowFields['MORE_PHOTO_custom'])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!rowFields['MORE_PHOTO_custom'].hasOwnProperty(key))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst inputValue = rowFields['MORE_PHOTO_custom'][key];\n\t\t\t\t\t\tif (newFilesRegExp.test(inputValue.name))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet fileCounter, fileSetting;\n\t\t\t\t\t\t\t[, fileCounter, , fileSetting] = inputValue.name.match(newFilesRegExp);\n\t\t\t\t\t\t\tif (fileCounter && fileSetting)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmorePhotoValues[fileCounter] = morePhotoValues[fileCounter] || {};\n\t\t\t\t\t\t\t\tmorePhotoValues[fileCounter][fileSetting] = inputValue.value;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmorePhotoValues[inputValue.name] = inputValue.value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\trowFields['MORE_PHOTO'] = morePhotoValues;\n\t\t\t\tif (variationId && this.showCatalogWithOffers)\n\t\t\t\t{\n\t\t\t\t\tconst variationRowId = this.getRowIdByProductId(variationId);\n\t\t\t\t\t// clear old cache\n\t\t\t\t\tthis.clearVariationCache(variationId);\n\n\t\t\t\t\tsubmitData.FIELDS[variationRowId] = {};\n\n\t\t\t\t\tfor (let fieldName of this.variationFieldNames)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!rowFields.hasOwnProperty(fieldName))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsubmitData.FIELDS[variationRowId][fieldName] = rowFields[fieldName];\n\t\t\t\t\t\tdelete submitData.FIELDS[rowId][fieldName];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.morePhotoChangedInputs.clear();\n\t\t}\n\t}\n\n\tgetCurrentVariationIdByProduct(productId)\n\t{\n\t\treturn productId in this.productVariationMap ? Text.toNumber(this.productVariationMap[productId]) : null;\n\t}\n\n\thandleOnFilterApply(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst filterGridId = data[0];\n\t\tconst filter = data[2] instanceof BX.Main.Filter ? event.getData()[2] : null;\n\n\t\tif (filter && (filterGridId === this.gridId))\n\t\t{\n\t\t\tconst filterFields = this.getFilterFields(filter);\n\n\t\t\tlet sectionId = '0';\n\n\t\t\tif (Type.isArray(filterFields))\n\t\t\t{\n\t\t\t\tconst fieldSectionId = this.getFieldSectionId(filterFields);\n\n\t\t\t\tif (fieldSectionId)\n\t\t\t\t{\n\t\t\t\t\tconst value = fieldSectionId['VALUE'];\n\n\t\t\t\t\tif (Type.isObject(value))\n\t\t\t\t\t{\n\t\t\t\t\t\tsectionId = value['VALUE'];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setNewProductButtonHrefSectionId(sectionId);\n\t\t}\n\t}\n\n\thandleOnSaveImage(event: BaseEvent)\n\t{\n\t\tconst [id, inputId, response] = event.getData();\n\t\tthis.morePhotoChangedInputs.set(id, response.data.input);\n\t}\n\n\tgetFilterFields(filter: BX.Main.Filter)\n\t{\n\t\tconst presets = filter.getParam('PRESETS');\n\n\t\tlet tmpFilterPreset = null;\n\n\t\tif (Type.isArray(presets))\n\t\t{\n\t\t\ttmpFilterPreset = presets.find((preset) => {\n\t\t\t\treturn preset['ID'] === 'tmp_filter';\n\t\t\t});\n\t\t}\n\n\t\tif (tmpFilterPreset)\n\t\t{\n\t\t\treturn tmpFilterPreset['FIELDS'] || null;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetFieldSectionId(fields: Array)\n\t{\n\t\treturn fields.find((field) => {\n\t\t\treturn field['ID'] === 'field_SECTION_ID'\n\t\t});\n\t}\n\n\tsetNewProductButtonHrefSectionId(sectionId: String)\n\t{\n\t\tconst uri = new Uri(this.createNewProductHref);\n\t\turi.setQueryParams({\n\t\t\tIBLOCK_SECTION_ID: sectionId,\n\t\t});\n\t\tconst button = document.getElementById('create_new_product_button_' + this.gridId);\n\n\t\tif (Type.isDomNode(button))\n\t\t{\n\t\t\tbutton.href = uri.getPath() + uri.getQuery();\n\t\t}\n\t}\n}\n"],"names":["IblockProductListHints","options","Map","gridId","canEditPrice","undefined","handleOnGridUpdatedHandler","EventEmitter","subscribe","bind","grid","BX","Main","gridManager","getInstanceById","getGrid","getHeaders","forEach","header","cellsTitles","querySelectorAll","title","lockIcon","Tag","render","dataset","hint","Loc","getMessage","hintNoIcon","UI","Hint","initNode","prepend","button","document","querySelector","classList","add","IblockProductList","handleOnSettingsWindowSave","handleOnChangeVariation","handleOnBeforeGridRequest","handleOnFilterApply","handleOnSaveImage","rowIdMask","variationFieldNames","productVariationMap","createNewProductHref","showCatalogWithOffers","addCustomClassToGrid","cacheSelectedVariation","onSettingsWindowSaveHandler","onChangeVariationHandler","onBeforeGridRequestHandler","onFilterApplyHandler","onSaveImageHandler","hints","Dom","addClass","getContainer","getRows","getBodyChild","row","rowId","getId","productId","getProductIdByRowId","variationId","getCurrentVariationIdByProduct","variations","set","getNode","cloneNode","variationsEditData","getEditData","clear","editedVariations","morePhotoChangedInputs","event","getCompatData","settingsWindow","selectedColumns","getSelectedColumns","indexOf","getData","skuFields","Text","toNumber","PARENT_PRODUCT_ID","ID","productRow","getProductRow","isEdit","values","getEditedVariationValues","currentVariationId","has","editData","Object","assign","get","setEditData","editCancel","edit","getVariation","then","variationNode","updateProductRow","currentEditorValues","getEditorValue","headRow","getHeadRow","morePhotoHtml","getCells","cell","index","cellName","getCellNameByCellIndex","editorContainer","getEditorContainer","imageBlock","id","outerHTML","name","hasOwnProperty","includes","Type","isNil","Promise","resolve","loadVariation","variation","isDomNode","self","url","method","data","stateLoad","request","stateUnload","getRowById","mask","RegExp","replace","matches","match","isArray","getRowIdByProductId","getById","getHeadFirstChild","cells","columnCell","getCellByIndex","cellHtml","getContentContainer","innerHTML","fields","resetEditData","gridData","submitData","prop","FIELDS","clearAllVariationCache","editFields","keys","map","groupPriceId","clearVariationCache","newFilesRegExp","rowFields","morePhotoValues","key","inputValue","test","fileCounter","fileSetting","value","variationRowId","fieldName","filterGridId","filter","Filter","filterFields","getFilterFields","sectionId","fieldSectionId","getFieldSectionId","isObject","setNewProductButtonHrefSectionId","inputId","response","input","presets","getParam","tmpFilterPreset","find","preset","field","uri","Uri","setQueryParams","IBLOCK_SECTION_ID","getElementById","href","getPath","getQuery"],"mappings":"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"}