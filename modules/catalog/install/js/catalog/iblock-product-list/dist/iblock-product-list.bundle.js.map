{"version":3,"file":"iblock-product-list.bundle.js","sources":["../src/iblock-product-list-hints.js","../src/iblock-product-list.js"],"sourcesContent":["import {EventEmitter} from 'main.core.events';\nimport {Tag, Loc} from 'main.core';\n\nexport class IblockProductListHints\n{\n\t/**\n\t * @type {?BX.Main.grid}\n\t */\n\tgrid;\n\tvariations = new Map();\n\tvariationsEditData = new Map();\n\teditedVariations = new Map();\n\tmorePhotoChangedInputs = new Map();\n\tcanEditPrice;\n\n\tconstructor(options = {})\n\t{\n\t\tthis.gridId = options.gridId;\n\t\tthis.canEditPrice = options.canEditPrice !== undefined ? options.canEditPrice === true : true;\n\n\t\tthis.#addAccessDeniedHintForCreateButton();\n\t\tthis.handleOnGridUpdatedHandler();\n\n\t\tEventEmitter.subscribe('Grid::updated', this.handleOnGridUpdatedHandler.bind(this));\n\t}\n\n\tgetGrid()\n\t{\n\t\tif (!this.grid)\n\t\t{\n\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\n\t\treturn this.grid;\n\t}\n\n\thandleOnGridUpdatedHandler()\n\t{\n\t\tif (!this.canEditPrice)\n\t\t{\n\t\t\tthis.#addAccessDeniedHintForPriceColumns();\n\t\t}\n\t}\n\n\t#addAccessDeniedHintForPriceColumns(): void\n\t{\n\t\tthis.getGrid().getHeaders().forEach((header) => {\n\t\t\tconst cellsTitles = header.querySelectorAll('.main-grid-cell-head[data-name^=\"CATALOG_GROUP_\"] .main-grid-head-title');\n\t\t\tcellsTitles.forEach((title) => {\n\t\t\t\tconst lockIcon = Tag.render`\n\t\t\t\t<span class=\"ui-btn ui-btn-link ui-btn-icon-lock ui-btn-xs catalog-product-grid-lock-hint\"></span>\n\t\t\t\t`;\n\t\t\t\tlockIcon.dataset.hint = Loc.getMessage('CATALOG_IBLOCK_PRODUCT_LIST_PRICE_ACCESS_DENIED_HINT');\n\t\t\t\tlockIcon.dataset.hintNoIcon = true;\n\n\t\t\t\tBX.UI.Hint.initNode(lockIcon);\n\n\t\t\t\ttitle.prepend(lockIcon);\n\t\t\t});\n\t\t});\n\t}\n\n\t#addAccessDeniedHintForCreateButton(): void\n\t{\n\t\tconst button = document.querySelector('#create_new_product_button_access_denied');\n\t\tif (button)\n\t\t{\n\t\t\tbutton.classList.add('ui-btn-icon-lock', 'ui-btn-disabled');\n\t\t\tbutton.dataset.hint = Loc.getMessage('CATALOG_IBLOCK_PRODUCT_LIST_CREATE_ACCESS_DENIED_HINT');\n\t\t\tbutton.dataset.hintNoIcon = true;\n\n\t\t\tBX.UI.Hint.initNode(button);\n\t\t}\n\t}\n}\n","import type {BaseEvent} from 'main.core.events';\nimport {EventEmitter} from 'main.core.events';\nimport {Dom, Tag, Text, Type, Uri, Loc} from 'main.core';\nimport { IblockProductListHints } from './iblock-product-list-hints';\nimport './style.css';\n\nexport class IblockProductList\n{\n\t/**\n\t * @type {?BX.Main.grid}\n\t */\n\tgrid;\n\thints;\n\tvariations = new Map();\n\tvariationsEditData = new Map();\n\teditedVariations = new Map();\n\tmorePhotoChangedInputs = new Map();\n\n\tonSettingsWindowSaveHandler = this.handleOnSettingsWindowSave.bind(this);\n\tonChangeVariationHandler = this.handleOnChangeVariation.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonFilterApplyHandler = this.handleOnFilterApply.bind(this);\n\tonSaveImageHandler = this.handleOnSaveImage.bind(this);\n\n\tconstructor(options = {})\n\t{\n\t\tthis.gridId = options.gridId;\n\t\tthis.rowIdMask = options.rowIdMask || '#ID#';\n\t\tthis.variationFieldNames = options.variationFieldNames || [];\n\t\tthis.productVariationMap = options.productVariationMap || {};\n\t\tthis.createNewProductHref = options.createNewProductHref || '';\n\t\tthis.showCatalogWithOffers = options.showCatalogWithOffers || false;\n\n\t\tthis.addCustomClassToGrid();\n\t\tthis.cacheSelectedVariation();\n\n\t\tEventEmitter.subscribe('BX.Grid.SettingsWindow:save', this.onSettingsWindowSaveHandler);\n\t\tEventEmitter.subscribe('SkuProperty::onChange', this.onChangeVariationHandler);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApplyHandler);\n\t\tEventEmitter.subscribe('Catalog.ImageInput::save', this.onSaveImageHandler);\n\n\t\tthis.hints = new IblockProductListHints(options);\n\t}\n\n\taddCustomClassToGrid()\n\t{\n\t\tDom.addClass(this.getGrid().getContainer(), 'catalog-product-grid');\n\t}\n\n\tcacheSelectedVariation()\n\t{\n\t\tthis.getGrid().getRows().getBodyChild().forEach((row) => {\n\t\t\tlet rowId = row.getId();\n\t\t\tlet productId = this.getProductIdByRowId(rowId);\n\t\t\tlet variationId = this.getCurrentVariationIdByProduct(productId);\n\n\t\t\tif (variationId)\n\t\t\t{\n\t\t\t\tthis.variations.set(variationId, row.getNode().cloneNode(true));\n\t\t\t\tthis.variationsEditData.set(variationId, row.getEditData());\n\t\t\t}\n\t\t});\n\t}\n\n\tclearAllVariationCache()\n\t{\n\t\tthis.variations.clear();\n\t\tthis.variationsEditData.clear();\n\t\tthis.editedVariations.clear();\n\t\tthis.morePhotoChangedInputs.clear();\n\t}\n\n\tclearVariationCache(variationId)\n\t{\n\t\tthis.variations.delete(variationId);\n\t\tthis.variationsEditData.delete(variationId);\n\t\tthis.editedVariations.delete(variationId);\n\t}\n\n\t/**\n\t * @returns {?BX.Main.grid}\n\t */\n\tgetGrid()\n\t{\n\t\tif (!this.grid)\n\t\t{\n\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\n\t\treturn this.grid;\n\t}\n\n\thandleOnSettingsWindowSave(event: BaseEvent)\n\t{\n\t\tconst [settingsWindow] = event.getCompatData();\n\t\tconst selectedColumns = settingsWindow.getSelectedColumns();\n\t\tthis.showCatalogWithOffers = selectedColumns.indexOf('CATALOG_PRODUCT') !== -1;\n\t}\n\n\thandleOnChangeVariation(event: BaseEvent)\n\t{\n\t\tconst [skuFields] = event.getData();\n\t\tconst productId = Text.toNumber(skuFields.PARENT_PRODUCT_ID);\n\t\tconst variationId = Text.toNumber(skuFields.ID);\n\n\t\tif (productId <= 0 || variationId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst productRow = this.getProductRow(productId);\n\n\t\tif (productRow.isEdit())\n\t\t{\n\t\t\tconst values = this.getEditedVariationValues(productRow);\n\t\t\tconst currentVariationId = this.getCurrentVariationIdByProduct(productId);\n\t\t\tthis.editedVariations.set(currentVariationId, values);\n\t\t}\n\n\t\tif (productRow.isEdit() && this.editedVariations.has(variationId))\n\t\t{\n\t\t\tconst editData = Object.assign(productRow.getEditData(), this.editedVariations.get(variationId));\n\t\t\tproductRow.setEditData(editData);\n\t\t\tproductRow.editCancel();\n\t\t\tproductRow.edit();\n\t\t\tthis.productVariationMap[productId] = variationId;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getVariation(productId, variationId)\n\t\t\t.then((variationNode) => {\n\t\t\t\tthis.updateProductRow(productId, variationId, variationNode);\n\t\t\t\tthis.productVariationMap[productId] = variationId;\n\t\t\t});\n\t}\n\n\tgetEditedVariationValues(row: BX.Grid.Row)\n\t{\n\t\tconst currentEditorValues = row.getEditorValue();\n\t\tconst headRow = this.getHeadRow();\n\t\tconst values = {};\n\t\tlet morePhotoHtml = null;\n\t\t[...row.getCells()].forEach((cell, index) => {\n\t\t\tconst cellName = headRow.getCellNameByCellIndex(index);\n\t\t\tif (cellName !== 'MORE_PHOTO')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst editorContainer = row.getEditorContainer(cell);\n\t\t\tif (editorContainer)\n\t\t\t{\n\t\t\t\tconst imageBlock = editorContainer.querySelector('.catalog-image-input-wrapper');\n\t\t\t\tconst id = imageBlock.id;\n\t\t\t\tif (this.morePhotoChangedInputs.has(id))\n\t\t\t\t{\n\t\t\t\t\tmorePhotoHtml = this.morePhotoChangedInputs.get(id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tmorePhotoHtml = imageBlock.outerHTML;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tfor (let name in currentEditorValues)\n\t\t{\n\t\t\tif (!currentEditorValues.hasOwnProperty(name) || !this.variationFieldNames.includes(name))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (name === 'MORE_PHOTO' && !Type.isNil(morePhotoHtml))\n\t\t\t{\n\t\t\t\tvalues[name] = morePhotoHtml;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvalues[name] = currentEditorValues[name];\n\t\t\t}\n\t\t}\n\n\t\treturn values;\n\t}\n\n\tgetVariation(productId, variationId)\n\t{\n\t\tif (this.getProductRow(productId).isEdit() && this.editedVariations.has(variationId))\n\t\t{\n\t\t\treturn Promise.resolve(this.editedVariations.get(variationId))\n\t\t}\n\n\t\tif (this.variations.has(variationId))\n\t\t{\n\t\t\treturn Promise.resolve(this.variations.get(variationId))\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.loadVariation(productId, variationId, resolve);\n\t\t})\n\t\t\t.then((variation) => {\n\t\t\t\tif (Type.isDomNode(variation))\n\t\t\t\t{\n\t\t\t\t\tthis.variations.set(variationId, variation);\n\t\t\t\t\treturn variation;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t});\n\t}\n\n\tloadVariation(productId, variationId, resolve)\n\t{\n\t\tconst self = this;\n\t\tconst url = '';\n\t\tconst method = 'POST';\n\t\tconst data = {productId, variationId};\n\n\t\tthis.getProductRow(productId).stateLoad();\n\t\tthis.getGrid().getData().request(url, method, data, 'changeVariation', function() {\n\t\t\tconst row = self.getProductRow(productId);\n\t\t\tif (row)\n\t\t\t{\n\t\t\t\trow.stateUnload();\n\t\t\t\tresolve(this.getRowById(row.getId()));\n\t\t\t}\n\t\t});\n\t}\n\n\tgetProductIdByRowId(rowId)\n\t{\n\t\tconst mask = new RegExp(this.rowIdMask.replace('#ID#', '([0-9]+)'));\n\t\tconst matches = rowId.match(mask);\n\n\t\treturn Type.isArray(matches) ? Text.toNumber(matches[1]) : 0;\n\t}\n\n\tgetRowIdByProductId(id)\n\t{\n\t\treturn this.rowIdMask.replace('#ID#', id);\n\t}\n\n\t/**\n\t * @param id\n\t * @returns {?BX.Grid.Row}\n\t */\n\tgetProductRow(id)\n\t{\n\t\tconst rowId = this.getRowIdByProductId(id);\n\n\t\treturn this.getGrid().getRows().getById(rowId);\n\t}\n\n\t/**\n\t * @returns {?BX.Grid.Row}\n\t */\n\tgetHeadRow()\n\t{\n\t\treturn this.getGrid().getRows().getHeadFirstChild();\n\t}\n\n\tupdateProductRow(productId, variationId, variationNode)\n\t{\n\t\tif (!productId || !Type.isDomNode(variationNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst headRow = this.getHeadRow();\n\t\tconst productRow = this.getProductRow(productId);\n\t\tconst fields = {};\n\n\t\t[...variationNode.cells].forEach((cell, index) => {\n\t\t\tconst cellName = headRow.getCellNameByCellIndex(index);\n\n\t\t\tif (this.variationFieldNames.includes(cellName))\n\t\t\t{\n\t\t\t\tlet columnCell = productRow.getCellByIndex(index);\n\t\t\t\tif (columnCell)\n\t\t\t\t{\n\t\t\t\t\tlet cellHtml = productRow.getContentContainer(cell).innerHTML;\n\t\t\t\t\tproductRow.getContentContainer(columnCell).innerHTML = cellHtml;\n\t\t\t\t\tfields[cellName] = cellHtml;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (this.variationsEditData.has(variationId))\n\t\t{\n\t\t\tproductRow.setEditData(this.variationsEditData.get(variationId));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tproductRow.resetEditData();\n\t\t\tthis.variationsEditData.set(variationId, productRow.getEditData());\n\t\t}\n\n\t\tif (productRow.isEdit())\n\t\t{\n\t\t\tproductRow.editCancel();\n\t\t\tproductRow.edit();\n\t\t}\n\t}\n\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [, gridData] = event.getData();\n\t\tconst submitData = BX.prop.get(gridData, 'data', {});\n\n\t\t// reload settings, columns or something else\n\t\tif (!submitData.productId && !submitData.FIELDS)\n\t\t{\n\t\t\tthis.clearAllVariationCache();\n\t\t}\n\n\t\tif (submitData.FIELDS)\n\t\t{\n\t\t\tthis.editedVariations.forEach((editFields, variationId) => {\n\t\t\t\tconst rowId = this.getRowIdByProductId(variationId);\n\t\t\t\tsubmitData.FIELDS[rowId] = submitData.FIELDS[rowId] || {};\n\t\t\t\tObject.keys(editFields).map((cellName) => {\n\t\t\t\t\tif (cellName.indexOf('CATALOG_GROUP_') >= 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst groupPriceId = cellName.replace('CATALOG_GROUP_', '');\n\t\t\t\t\t\tif (!Type.isNil(editFields[cellName]['PRICE']))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsubmitData['CATALOG_PRICE'] = submitData['CATALOG_PRICE'] || {};\n\t\t\t\t\t\t\tsubmitData['CATALOG_PRICE'][variationId] = submitData['CATALOG_PRICE'][variationId] || {};\n\t\t\t\t\t\t\tsubmitData['CATALOG_PRICE'][variationId][groupPriceId] = editFields[cellName]['PRICE']['VALUE'];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!Type.isNil(editFields[cellName]['CURRENCY']))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsubmitData['CATALOG_CURRENCY'] = submitData['CATALOG_CURRENCY'] || {};\n\t\t\t\t\t\t\tsubmitData['CATALOG_CURRENCY'][variationId] = submitData['CATALOG_CURRENCY'][variationId] || {};\n\t\t\t\t\t\t\tsubmitData['CATALOG_CURRENCY'][variationId][groupPriceId] = editFields[cellName]['CURRENCY']['VALUE'];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (cellName !== 'MORE_PHOTO' && cellName !== 'MORE_PHOTO_custom')\n\t\t\t\t\t{\n\t\t\t\t\t\tsubmitData.FIELDS[rowId][cellName] = editFields[cellName];\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.clearVariationCache(variationId);\n\t\t\t});\n\n\t\t\tfor (let rowId in submitData.FIELDS)\n\t\t\t{\n\t\t\t\tif (!submitData.FIELDS.hasOwnProperty(rowId))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst productId = this.getProductIdByRowId(rowId);\n\t\t\t\tconst variationId = this.getCurrentVariationIdByProduct(productId);\n\t\t\t\tconst newFilesRegExp = new RegExp(/([0-9A-Za-z_]+?(_n\\d+)*)\\[([A-Za-z_]+)\\]/);\n\t\t\t\tconst rowFields = submitData.FIELDS[rowId];\n\t\t\t\tconst morePhotoValues = {};\n\t\t\t\tif (!Type.isNil(rowFields['MORE_PHOTO_custom']))\n\t\t\t\t{\n\t\t\t\t\tfor (let key in rowFields['MORE_PHOTO_custom'])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!rowFields['MORE_PHOTO_custom'].hasOwnProperty(key))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst inputValue = rowFields['MORE_PHOTO_custom'][key];\n\t\t\t\t\t\tif (newFilesRegExp.test(inputValue.name))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet fileCounter, fileSetting;\n\t\t\t\t\t\t\t[, fileCounter, , fileSetting] = inputValue.name.match(newFilesRegExp);\n\t\t\t\t\t\t\tif (fileCounter && fileSetting)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmorePhotoValues[fileCounter] = morePhotoValues[fileCounter] || {};\n\t\t\t\t\t\t\t\tmorePhotoValues[fileCounter][fileSetting] = inputValue.value;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmorePhotoValues[inputValue.name] = inputValue.value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\trowFields['MORE_PHOTO'] = morePhotoValues;\n\t\t\t\tif (variationId && this.showCatalogWithOffers)\n\t\t\t\t{\n\t\t\t\t\tconst variationRowId = this.getRowIdByProductId(variationId);\n\t\t\t\t\t// clear old cache\n\t\t\t\t\tthis.clearVariationCache(variationId);\n\n\t\t\t\t\tsubmitData.FIELDS[variationRowId] = {};\n\n\t\t\t\t\tfor (let fieldName of this.variationFieldNames)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!rowFields.hasOwnProperty(fieldName))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsubmitData.FIELDS[variationRowId][fieldName] = rowFields[fieldName];\n\t\t\t\t\t\tdelete submitData.FIELDS[rowId][fieldName];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.morePhotoChangedInputs.clear();\n\t\t}\n\t}\n\n\tgetCurrentVariationIdByProduct(productId)\n\t{\n\t\treturn productId in this.productVariationMap ? Text.toNumber(this.productVariationMap[productId]) : null;\n\t}\n\n\thandleOnFilterApply(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst filterGridId = data[0];\n\t\tconst filter = data[2] instanceof BX.Main.Filter ? event.getData()[2] : null;\n\n\t\tif (filter && (filterGridId === this.gridId))\n\t\t{\n\t\t\tconst filterFields = this.getFilterFields(filter);\n\n\t\t\tlet sectionId = '0';\n\n\t\t\tif (Type.isArray(filterFields))\n\t\t\t{\n\t\t\t\tconst fieldSectionId = this.getFieldSectionId(filterFields);\n\n\t\t\t\tif (fieldSectionId)\n\t\t\t\t{\n\t\t\t\t\tconst value = fieldSectionId['VALUE'];\n\n\t\t\t\t\tif (Type.isObject(value))\n\t\t\t\t\t{\n\t\t\t\t\t\tsectionId = value['VALUE'];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setNewProductButtonHrefSectionId(sectionId);\n\t\t}\n\t}\n\n\thandleOnSaveImage(event: BaseEvent)\n\t{\n\t\tconst [id, inputId, response] = event.getData();\n\t\tthis.morePhotoChangedInputs.set(id, response.data.input);\n\t}\n\n\tgetFilterFields(filter: BX.Main.Filter)\n\t{\n\t\tconst presets = filter.getParam('PRESETS');\n\n\t\tlet tmpFilterPreset = null;\n\n\t\tif (Type.isArray(presets))\n\t\t{\n\t\t\ttmpFilterPreset = presets.find((preset) => {\n\t\t\t\treturn preset['ID'] === 'tmp_filter';\n\t\t\t});\n\t\t}\n\n\t\tif (tmpFilterPreset)\n\t\t{\n\t\t\treturn tmpFilterPreset['FIELDS'] || null;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetFieldSectionId(fields: Array)\n\t{\n\t\treturn fields.find((field) => {\n\t\t\treturn field['ID'] === 'field_SECTION_ID'\n\t\t});\n\t}\n\n\tsetNewProductButtonHrefSectionId(sectionId: String)\n\t{\n\t\tconst uri = new Uri(this.createNewProductHref);\n\t\turi.setQueryParams({\n\t\t\tIBLOCK_SECTION_ID: sectionId,\n\t\t});\n\t\tconst button = document.getElementById('create_new_product_button_' + this.gridId);\n\n\t\tif (Type.isDomNode(button))\n\t\t{\n\t\t\tbutton.href = uri.getPath() + uri.getQuery();\n\t\t}\n\t}\n}\n"],"names":["_addAccessDeniedHintForPriceColumns","WeakSet","_addAccessDeniedHintForCreateButton","IblockProductListHints","options","arguments","length","undefined","babelHelpers","classCallCheck","_classPrivateMethodInitSpec","defineProperty","Map","gridId","canEditPrice","_classPrivateMethodGet","_addAccessDeniedHintForCreateButton2","call","handleOnGridUpdatedHandler","EventEmitter","subscribe","bind","createClass","key","value","getGrid","grid","BX","Main","gridManager","getInstanceById","_addAccessDeniedHintForPriceColumns2","getHeaders","forEach","header","cellsTitles","querySelectorAll","title","lockIcon","Tag","render","_templateObject","taggedTemplateLiteral","dataset","hint","Loc","getMessage","hintNoIcon","UI","Hint","initNode","prepend","button","document","querySelector","classList","add","IblockProductList","handleOnSettingsWindowSave","handleOnChangeVariation","handleOnBeforeGridRequest","handleOnFilterApply","handleOnSaveImage","rowIdMask","variationFieldNames","productVariationMap","createNewProductHref","showCatalogWithOffers","addCustomClassToGrid","cacheSelectedVariation","onSettingsWindowSaveHandler","onChangeVariationHandler","onBeforeGridRequestHandler","onFilterApplyHandler","onSaveImageHandler","hints","Dom","addClass","getContainer","_this","getRows","getBodyChild","row","rowId","getId","productId","getProductIdByRowId","variationId","getCurrentVariationIdByProduct","variations","set","getNode","cloneNode","variationsEditData","getEditData","clearAllVariationCache","clear","editedVariations","morePhotoChangedInputs","clearVariationCache","event","_event$getCompatData","getCompatData","_event$getCompatData2","slicedToArray","settingsWindow","selectedColumns","getSelectedColumns","indexOf","_this2","_event$getData","getData","_event$getData2","skuFields","Text","toNumber","PARENT_PRODUCT_ID","ID","productRow","getProductRow","isEdit","values","getEditedVariationValues","currentVariationId","has","editData","Object","assign","get","setEditData","editCancel","edit","getVariation","then","variationNode","updateProductRow","_this3","currentEditorValues","getEditorValue","headRow","getHeadRow","morePhotoHtml","toConsumableArray","getCells","cell","index","cellName","getCellNameByCellIndex","editorContainer","getEditorContainer","imageBlock","id","outerHTML","name","hasOwnProperty","includes","Type","isNil","_this4","Promise","resolve","loadVariation","variation","isDomNode","self","url","method","data","stateLoad","request","stateUnload","getRowById","mask","RegExp","replace","matches","match","isArray","getRowIdByProductId","getById","getHeadFirstChild","_this5","cells","columnCell","getCellByIndex","cellHtml","getContentContainer","innerHTML","resetEditData","_this6","_event$getData3","_event$getData4","gridData","submitData","prop","FIELDS","editFields","keys","map","groupPriceId","newFilesRegExp","rowFields","morePhotoValues","inputValue","test","fileCounter","fileSetting","_inputValue$name$matc","_inputValue$name$matc2","variationRowId","_iterator","_createForOfIteratorHelper","_step","s","n","done","fieldName","err","e","f","filterGridId","filter","Filter","filterFields","getFilterFields","sectionId","fieldSectionId","getFieldSectionId","isObject","setNewProductButtonHrefSectionId","_event$getData5","_event$getData6","inputId","response","input","presets","getParam","tmpFilterPreset","find","preset","fields","field","uri","Uri","setQueryParams","IBLOCK_SECTION_ID","getElementById","href","getPath","getQuery"],"mappings":"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"}