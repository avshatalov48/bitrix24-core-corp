{"version":3,"file":"product.calculator.bundle.js","sources":["../src/js/discount-type.js","../src/js/field-storage.js","../src/js/strategy/tax-for-price-strategy.js","../src/js/product-calculator.js","../src/js/strategy/tax-for-sum-strategy.js"],"sourcesContent":["export type DiscountTypes = DiscountType.UNDEFINED | DiscountType.MONETARY | DiscountType.PERCENTAGE;\n\nexport class DiscountType\n{\n\tstatic UNDEFINED = 0;\n\tstatic MONETARY = 1;\n\tstatic PERCENTAGE = 2;\n}","import {Runtime, Type} from 'main.core';\nimport type {FieldScheme} from './field-scheme';\nimport type {DiscountTypes} from './discount-type';\nimport {DiscountType} from './discount-type';\nimport {ProductCalculator} from \"catalog.product-calculator\";\n\nconst initialFields = {\n\tQUANTITY: 1,\n\tPRICE: 0,\n\tPRICE_EXCLUSIVE: 0,\n\tPRICE_NETTO: 0,\n\tPRICE_BRUTTO: 0,\n\tCUSTOMIZED: 'N',\n\tDISCOUNT_TYPE_ID: DiscountType.UNDEFINED,\n\tDISCOUNT_RATE: 0,\n\tDISCOUNT_SUM: 0,\n\tDISCOUNT_ROW: 0,\n\tTAX_INCLUDED: 'N',\n\tTAX_RATE: 0,\n\tTAX_SUM: 0,\n\tSUM: 0\n};\n\nexport class FieldStorage\n{\n\tfields: FieldScheme;\n\n\tconstructor(fields: FieldScheme, calculator: ProductCalculator)\n\t{\n\t\tthis.fields = {...initialFields};\n\n\t\tif (Type.isPlainObject(fields))\n\t\t{\n\t\t\tthis.fields = {...this.fields, ...fields};\n\t\t}\n\n\t\tthis.calculator = calculator;\n\t}\n\n\t#getPricePrecision()\n\t{\n\t\treturn this.calculator.getPricePrecision();\n\t}\n\n\t#getCommonPrecision()\n\t{\n\t\treturn this.calculator.getCommonPrecision();\n\t}\n\n\t#getQuantityPrecision()\n\t{\n\t\treturn this.calculator.getQuantityPrecision();\n\t}\n\n\tgetFields()\n\t{\n\t\treturn Runtime.clone(this.fields);\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value): void\n\t{\n\t\tvalue = this.#validateValue(name, value);\n\t\tthis.fields[name] = value;\n\t}\n\n\t#validateValue(name: string, value): any\n\t{\n\t\tconst priceFields = [\n\t\t\t'PRICE',\n\t\t\t'PRICE_EXCLUSIVE',\n\t\t\t'PRICE_NETTO',\n\t\t\t'PRICE_BRUTTO',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'DISCOUNT_ROW',\n\t\t\t'TAX_SUM',\n\t\t\t'SUM'\n\t\t];\n\t\tif (name === 'DISCOUNT_TYPE_ID')\n\t\t{\n\t\t\tvalue =\n\t\t\t\t(value === DiscountType.PERCENTAGE || value === DiscountType.MONETARY)\n\t\t\t\t\t? value\n\t\t\t\t\t: DiscountType.UNDEFINED\n\t\t\t;\n\n\t\t}\n\t\telse if (name === 'QUANTITY')\n\t\t{\n\t\t\tvalue = FieldStorage.#round(value, this.#getQuantityPrecision());\n\t\t}\n\t\telse if (name === 'CUSTOMIZED' || name === 'TAX_INCLUDED' )\n\t\t{\n\t\t\tvalue = (value === 'Y') ? 'Y' : 'N';\n\t\t}\n\t\telse if (name === 'TAX_RATE' || name === 'DISCOUNT_RATE')\n\t\t{\n\t\t\tvalue = FieldStorage.#round(value, this.#getCommonPrecision());\n\t\t}\n\t\telse if (priceFields.includes(name))\n\t\t{\n\t\t\tvalue = FieldStorage.#round(value, this.#getPricePrecision());\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tstatic #round(value: number, precision = ProductCalculator.DEFAULT_PRECISION): number\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tgetPrice(): number\n\t{\n\t\treturn this.getField('PRICE', 0);\n\t}\n\n\tgetPriceExclusive(): number\n\t{\n\t\treturn this.getField('PRICE_EXCLUSIVE', 0);\n\t}\n\n\tgetPriceNetto(): number\n\t{\n\t\treturn this.getField('PRICE_NETTO', 0);\n\t}\n\n\tgetPriceBrutto(): number\n\t{\n\t\treturn this.getField('PRICE_BRUTTO', 0);\n\t}\n\n\tgetQuantity(): number\n\t{\n\t\treturn this.getField('QUANTITY', 1);\n\t}\n\n\tgetDiscountType(): DiscountTypes\n\t{\n\t\treturn this.getField('DISCOUNT_TYPE_ID', DiscountType.UNDEFINED);\n\t}\n\n\tisDiscountUndefined(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.UNDEFINED;\n\t}\n\n\tisDiscountPercentage(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.PERCENTAGE;\n\t}\n\n\tisDiscountMonetary(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.MONETARY;\n\t}\n\n\tisDiscountHandmade(): boolean\n\t{\n\t\treturn this.isDiscountPercentage() || this.isDiscountMonetary();\n\t}\n\n\tgetDiscountRate(): number\n\t{\n\t\treturn this.getField('DISCOUNT_RATE', 0);\n\t}\n\n\tgetDiscountSum(): number\n\t{\n\t\treturn this.getField('DISCOUNT_SUM', 0);\n\t}\n\n\tgetDiscountRow(): number\n\t{\n\t\treturn this.getField('DISCOUNT_ROW', 0);\n\t}\n\n\tisEmptyDiscount(): boolean\n\t{\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\treturn this.getDiscountRate() === 0;\n\t\t}\n\n\t\tif (this.isDiscountMonetary())\n\t\t{\n\t\t\treturn this.getDiscountSum() === 0;\n\t\t}\n\n\t\treturn this.isDiscountUndefined();\n\t}\n\n\tgetTaxIncluded(): 'Y' | 'N'\n\t{\n\t\treturn this.getField('TAX_INCLUDED', 'N');\n\t}\n\n\tisTaxIncluded(): boolean\n\t{\n\t\treturn this.getTaxIncluded() === 'Y';\n\t}\n\n\tgetTaxRate(): number\n\t{\n\t\treturn this.getField('TAX_RATE', 0);\n\t}\n\n\tgetTaxSum(): number\n\t{\n\t\treturn this.getField('TAX_SUM', 0);\n\t}\n\n\tgetSum(): number\n\t{\n\t\treturn this.getField('SUM', 0);\n\t}\n}","import type {DiscountTypes} from '../discount-type';\nimport {DiscountType} from '../discount-type';\nimport type {FieldScheme} from \"../field-scheme\";\nimport {FieldStorage} from '../field-storage';\nimport {ProductCalculator} from '../product-calculator';\n\nexport class TaxForPriceStrategy\n{\n\tcalculator: ProductCalculator = null;\n\n\tconstructor(productCalculator: ProductCalculator)\n\t{\n\t\tthis.calculator = productCalculator;\n\t}\n\n\tgetFieldStorage(): FieldStorage\n\t{\n\t\treturn new FieldStorage(this.calculator.getFields(), this.calculator);\n\t}\n\n\tgetPricePrecision()\n\t{\n\t\treturn this.calculator.getPricePrecision();\n\t}\n\n\tgetCommonPrecision()\n\t{\n\t\treturn this.calculator.getCommonPrecision();\n\t}\n\n\tgetQuantityPrecision()\n\t{\n\t\treturn this.calculator.getQuantityPrecision();\n\t}\n\n\tcalculateBasePrice(value: number): FieldScheme\n\t{\n\t\tif (value < 0)\n\t\t{\n\t\t\tthrow new Error('Price must be equal or greater than zero.')\n\t\t}\n\n\t\tconst fieldStorage = this.getFieldStorage();\n\n\t\tfieldStorage.setField('BASE_PRICE', value);\n\n\t\tif (fieldStorage.isTaxIncluded())\n\t\t{\n\t\t\tfieldStorage.setField('PRICE_BRUTTO', value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfieldStorage.setField('PRICE_NETTO', value);\n\t\t}\n\n\t\tthis.updatePrice(fieldStorage);\n\n\t\tthis.activateCustomized(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tcalculatePrice(value: number): FieldScheme\n\t{\n\t\tif (value < 0)\n\t\t{\n\t\t\tthrow new Error('Price must be equal or greater than zero.')\n\t\t}\n\n\t\tconst fieldStorage = this.getFieldStorage();\n\t\tif (value >= fieldStorage.getBasePrice())\n\t\t{\n\t\t\treturn this.calculateBasePrice(value);\n\t\t}\n\n\t\tthis.clearResultPrices(fieldStorage);\n\n\t\tif (fieldStorage.isTaxIncluded())\n\t\t{\n\t\t\treturn this.calculateRowSum(value * fieldStorage.getQuantity());\n\t\t}\n\n\t\tconst discount = fieldStorage.getBasePrice() - value;\n\t\tfieldStorage.setField('DISCOUNT_TYPE_ID', DiscountType.MONETARY);\n\t\treturn this.calculateDiscount(discount, fieldStorage);\n\t}\n\n\tcalculateQuantity(value: number): FieldScheme\n\t{\n\t\tif (value < 0)\n\t\t{\n\t\t\tthrow new Error('Quantity must be equal or greater than zero.')\n\t\t}\n\n\t\tconst fieldStorage = this.getFieldStorage();\n\t\tfieldStorage.setField('QUANTITY', value);\n\n\t\tthis.updateRowDiscount(fieldStorage);\n\t\tthis.updateTax(fieldStorage);\n\t\tthis.updateSum(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tcalculateDiscount(value: number, fieldStorage: FieldStorage = null): FieldScheme\n\t{\n\t\tif (!fieldStorage)\n\t\t{\n\t\t\tfieldStorage = this.getFieldStorage();\n\t\t}\n\n\t\tif (value === 0.0)\n\t\t{\n\t\t\tthis.clearResultPrices(fieldStorage);\n\t\t}\n\t\telse if (fieldStorage.isDiscountPercentage())\n\t\t{\n\t\t\tfieldStorage.setField('DISCOUNT_RATE', value);\n\n\t\t\tthis.updateResultPrices(fieldStorage);\n\n\t\t\tfieldStorage.setField(\n\t\t\t\t'DISCOUNT_SUM',\n\t\t\t\tfieldStorage.getPriceNetto() - fieldStorage.getPriceExclusive()\n\t\t\t);\n\t\t}\n\t\telse if (fieldStorage.isDiscountMonetary())\n\t\t{\n\t\t\tfieldStorage.setField('DISCOUNT_SUM', value);\n\n\t\t\tthis.updateResultPrices(fieldStorage);\n\n\t\t\tfieldStorage.setField(\n\t\t\t\t'DISCOUNT_RATE',\n\t\t\t\tthis.calculateDiscountRate(\n\t\t\t\t\tfieldStorage.getPriceNetto(),\n\t\t\t\t\tfieldStorage.getPriceExclusive()\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tthis.updateRowDiscount(fieldStorage);\n\t\tthis.updateTax(fieldStorage);\n\t\tthis.updateSum(fieldStorage);\n\n\t\tthis.activateCustomized(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tcalculateDiscountType(value: DiscountTypes): FieldScheme\n\t{\n\t\tconst fieldStorage = this.getFieldStorage();\n\n\t\tfieldStorage.setField('DISCOUNT_TYPE_ID', value);\n\n\t\tthis.updateResultPrices(fieldStorage);\n\t\tthis.updateDiscount(fieldStorage);\n\t\tthis.updateRowDiscount(fieldStorage);\n\t\tthis.updateTax(fieldStorage);\n\t\tthis.updateSum(fieldStorage);\n\n\t\tthis.activateCustomized(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tcalculateRowDiscount(value: number): FieldScheme\n\t{\n\t\tconst fieldStorage = this.getFieldStorage();\n\n\t\tfieldStorage.setField('DISCOUNT_ROW', value);\n\n\t\tif (value !== 0 && fieldStorage.getQuantity() === 0)\n\t\t{\n\t\t\tfieldStorage.setField('QUANTITY', 1);\n\t\t}\n\n\t\tfieldStorage.setField('DISCOUNT_TYPE_ID', DiscountType.MONETARY);\n\n\t\tif (value === 0 || fieldStorage.getQuantity() === 0)\n\t\t{\n\t\t\tfieldStorage.setField('DISCOUNT_SUM', 0);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfieldStorage.setField(\n\t\t\t\t'DISCOUNT_SUM',\n\t\t\t\tfieldStorage.getDiscountRow() / fieldStorage.getQuantity()\n\t\t\t);\n\t\t}\n\n\t\tthis.updateResultPrices(fieldStorage);\n\n\t\tthis.updateDiscount(fieldStorage);\n\t\tthis.updateRowDiscount(fieldStorage);\n\t\tthis.updateTax(fieldStorage);\n\t\tthis.updateSum(fieldStorage);\n\n\t\tthis.activateCustomized(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tcalculateTax(value: number): FieldScheme\n\t{\n\t\tconst fieldStorage = this.getFieldStorage();\n\t\tfieldStorage.setField('TAX_RATE', value);\n\n\t\tthis.updateBasePrices(fieldStorage);\n\t\tthis.updateResultPrices(fieldStorage);\n\n\t\tif (fieldStorage.isTaxIncluded())\n\t\t{\n\t\t\tthis.updateDiscount(fieldStorage);\n\t\t\tthis.updateRowDiscount(fieldStorage);\n\t\t}\n\n\t\tthis.updateTax(fieldStorage);\n\t\tthis.updateSum(fieldStorage);\n\n\t\tthis.activateCustomized(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tcalculateTaxIncluded(value: 'Y' | 'N'): FieldScheme\n\t{\n\t\tconst fieldStorage = this.getFieldStorage();\n\n\t\tif (fieldStorage.getTaxIncluded() !== value)\n\t\t{\n\t\t\tfieldStorage.setField('TAX_INCLUDED', value);\n\n\t\t\tif (fieldStorage.isTaxIncluded())\n\t\t\t{\n\t\t\t\tfieldStorage.setField('PRICE_BRUTTO', fieldStorage.getPriceNetto());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfieldStorage.setField('PRICE_NETTO', fieldStorage.getPriceBrutto());\n\t\t\t}\n\t\t}\n\n\t\tthis.updatePrice(fieldStorage);\n\n\t\tthis.activateCustomized(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tcalculateRowSum(value: number): FieldScheme\n\t{\n\t\tconst fieldStorage = this.getFieldStorage();\n\n\t\tfieldStorage.setField('SUM', value);\n\n\t\tif (fieldStorage.getQuantity() === 0)\n\t\t{\n\t\t\tfieldStorage.setField('QUANTITY', 1);\n\t\t}\n\n\t\tconst discountSum =\n\t\t\tfieldStorage.getPriceNetto()\n\t\t\t- (\n\t\t\t\tfieldStorage.getSum()\n\t\t\t\t/ (fieldStorage.getQuantity() * (1 + fieldStorage.getTaxRate() / 100))\n\t\t\t)\n\t\t;\n\n\t\tfieldStorage.setField('DISCOUNT_SUM', discountSum);\n\t\tfieldStorage.setField('DISCOUNT_TYPE_ID', DiscountType.MONETARY);\n\n\t\tif (fieldStorage.isEmptyDiscount())\n\t\t{\n\t\t\tthis.clearResultPrices(fieldStorage);\n\t\t}\n\t\telse if (fieldStorage.isDiscountHandmade())\n\t\t{\n\t\t\tthis.updateResultPrices(fieldStorage);\n\t\t}\n\n\t\tthis.updateDiscount(fieldStorage);\n\t\tthis.updateRowDiscount(fieldStorage);\n\t\tthis.updateTax(fieldStorage);\n\n\t\tthis.activateCustomized(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tupdatePrice(fieldStorage: FieldStorage): void\n\t{\n\t\tthis.updateBasePrices(fieldStorage);\n\n\t\tif (fieldStorage.isEmptyDiscount())\n\t\t{\n\t\t\tthis.clearResultPrices(fieldStorage);\n\t\t}\n\t\telse if (fieldStorage.isDiscountHandmade())\n\t\t{\n\t\t\tthis.updateResultPrices(fieldStorage);\n\t\t}\n\n\t\tthis.updateDiscount(fieldStorage);\n\t\tthis.updateRowDiscount(fieldStorage);\n\t\tthis.updateTax(fieldStorage);\n\t\tthis.updateSum(fieldStorage);\n\t}\n\n\tclearResultPrices(fieldStorage: FieldStorage)\n\t{\n\t\tfieldStorage.setField('PRICE_EXCLUSIVE', fieldStorage.getPriceNetto());\n\t\tfieldStorage.setField('PRICE', fieldStorage.getPriceBrutto());\n\n\t\tfieldStorage.setField('DISCOUNT_RATE', 0.0);\n\t\tfieldStorage.setField('DISCOUNT_SUM', 0.0);\n\t}\n\n\tcalculatePriceWithoutDiscount(price: number, discount: number, discountType: DiscountTypes)\n\t{\n\t\tlet result = 0.0;\n\n\t\tswitch (discountType)\n\t\t{\n\t\t\tcase DiscountType.PERCENTAGE:\n\t\t\t\tresult = price - (price * discount / 100);\n\t\t\t\tbreak;\n\n\t\t\tcase DiscountType.MONETARY:\n\t\t\t\tresult = price - discount;\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tupdateBasePrices(fieldStorage: FieldStorage): void\n\t{\n\t\tif (fieldStorage.isTaxIncluded())\n\t\t{\n\t\t\tfieldStorage.setField(\n\t\t\t\t'PRICE_NETTO',\n\t\t\t\tthis.calculatePriceWithoutTax(fieldStorage.getPriceBrutto(), fieldStorage.getTaxRate())\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfieldStorage.setField(\n\t\t\t\t'PRICE_BRUTTO',\n\t\t\t\tthis.calculatePriceWithTax(fieldStorage.getPriceNetto(), fieldStorage.getTaxRate())\n\t\t\t);\n\t\t}\n\t}\n\n\tupdateResultPrices(fieldStorage: FieldStorage): void\n\t{\n\t\t// price without tax\n\t\tlet exclusivePrice;\n\n\t\tif (fieldStorage.isDiscountPercentage())\n\t\t{\n\t\t\texclusivePrice = this.calculatePriceWithoutDiscount(\n\t\t\t\tfieldStorage.getPriceNetto(),\n\t\t\t\tfieldStorage.getDiscountRate(),\n\t\t\t\tDiscountType.PERCENTAGE\n\t\t\t);\n\t\t}\n\t\telse if (fieldStorage.isDiscountMonetary())\n\t\t{\n\t\t\texclusivePrice = this.calculatePriceWithoutDiscount(\n\t\t\t\tfieldStorage.getPriceNetto(),\n\t\t\t\tfieldStorage.getDiscountSum(),\n\t\t\t\tDiscountType.MONETARY\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\texclusivePrice = fieldStorage.getPriceExclusive();\n\t\t}\n\n\t\tfieldStorage.setField('PRICE_EXCLUSIVE', exclusivePrice);\n\t\tfieldStorage.setField(\n\t\t\t'PRICE',\n\t\t\tthis.calculatePriceWithTax(exclusivePrice, fieldStorage.getTaxRate())\n\t\t);\n\t}\n\n\tactivateCustomized(fieldStorage: FieldStorage): void\n\t{\n\t\tfieldStorage.setField('CUSTOMIZED', 'Y');\n\t}\n\n\tupdateDiscount(fieldStorage: FieldStorage): void\n\t{\n\t\tif (fieldStorage.isEmptyDiscount())\n\t\t{\n\t\t\tthis.clearResultPrices(fieldStorage);\n\t\t}\n\t\telse if (fieldStorage.isDiscountPercentage())\n\t\t{\n\t\t\tfieldStorage.setField(\n\t\t\t\t'DISCOUNT_SUM',\n\t\t\t\tfieldStorage.getPriceNetto() - fieldStorage.getPriceExclusive()\n\t\t\t);\n\t\t}\n\t\telse if (fieldStorage.isDiscountMonetary())\n\t\t{\n\t\t\tfieldStorage.setField(\n\t\t\t\t'DISCOUNT_RATE',\n\t\t\t\tthis.calculateDiscountRate(\n\t\t\t\t\tfieldStorage.getPriceNetto(),\n\t\t\t\t\tfieldStorage.getPriceNetto() - fieldStorage.getDiscountSum()\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}\n\n\tupdateRowDiscount(fieldStorage: FieldStorage): void\n\t{\n\t\tfieldStorage.setField(\n\t\t\t'DISCOUNT_ROW',\n\t\t\tfieldStorage.getDiscountSum() * fieldStorage.getQuantity()\n\t\t);\n\t}\n\n\tupdateTax(fieldStorage: FieldStorage): void\n\t{\n\t\tlet sum;\n\n\t\tif (fieldStorage.isTaxIncluded())\n\t\t{\n\t\t\tsum =\n\t\t\t\tfieldStorage.getPrice()\n\t\t\t\t* fieldStorage.getQuantity()\n\t\t\t\t* (1 - 1 / (1 + fieldStorage.getTaxRate() / 100))\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsum =\n\t\t\t\tfieldStorage.getPriceExclusive()\n\t\t\t\t* fieldStorage.getQuantity()\n\t\t\t\t* (fieldStorage.getTaxRate() / 100)\n\t\t\t;\n\t\t}\n\n\t\tfieldStorage.setField('TAX_SUM', sum);\n\t}\n\n\tupdateSum(fieldStorage: FieldStorage): void\n\t{\n\t\tlet sum;\n\n\t\tif (fieldStorage.isTaxIncluded())\n\t\t{\n\t\t\tsum = fieldStorage.getPrice() * fieldStorage.getQuantity();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsum = this.calculatePriceWithTax(\n\t\t\t\tfieldStorage.getPriceExclusive() * fieldStorage.getQuantity(),\n\t\t\t\tfieldStorage.getTaxRate()\n\t\t\t);\n\t\t}\n\n\t\tfieldStorage.setField('SUM', sum);\n\t}\n\n\tcalculateDiscountRate(originalPrice: number, price: number): number\n\t{\n\t\tif (originalPrice === 0.0)\n\t\t{\n\t\t\treturn 0.0;\n\t\t}\n\n\t\tif (price === 0.0)\n\t\t{\n\t\t\treturn originalPrice > 0 ? 100.0 : -100.0;\n\t\t}\n\n\t\treturn (originalPrice - price) / originalPrice * 100;\n\t}\n\n\tcalculatePriceWithoutTax(price: number, taxRate: number)\n\t{\n\t\t// Tax is not included in price\n\t\treturn price / (1 + (taxRate / 100));\n\t}\n\n\tcalculatePriceWithTax(price: number, taxRate: number): number\n\t{\n\t\t// Tax is included in price\n\t\treturn price + price * taxRate / 100;\n\t}\n}\n","import type {FieldScheme} from './field-scheme';\nimport type {DiscountTypes} from './discount-type';\nimport {TaxForPriceStrategy} from './strategy/tax-for-price-strategy';\n\nexport class ProductCalculator\n{\n\t#fields: FieldScheme = {};\n\t#strategy: TaxForPriceStrategy = {};\n\t#settings = {};\n\n\tstatic DEFAULT_PRECISION: number = 2;\n\n\tconstructor(fields: FieldScheme = {}, settings = {})\n\t{\n\t\tthis.setFields(fields);\n\t\tthis.setSettings(settings);\n\t\tthis.setCalculationStrategy(new TaxForPriceStrategy(this));\n\t}\n\n\tsetField(name, value): ProductCalculator\n\t{\n\t\tthis.#fields[name] = value;\n\n\t\treturn this;\n\t}\n\n\tsetCalculationStrategy(strategy: TaxForPriceStrategy = {}): ProductCalculator\n\t{\n\t\tthis.#strategy = strategy;\n\n\t\treturn this;\n\t}\n\n\tsetFields(fields: FieldScheme): ProductCalculator\n\t{\n\t\tfor (const name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetFields(): FieldScheme\n\t{\n\t\treturn {...this.#fields};\n\t}\n\n\tsetSettings(settings = {}): ProductCalculator\n\t{\n\t\tthis.#settings = {...settings};\n\n\t\treturn this;\n\t}\n\n\tgetSettings(): {}\n\t{\n\t\treturn {...this.#settings};\n\t}\n\n\t#getSetting(name, defaultValue)\n\t{\n\t\treturn this.#settings.hasOwnProperty(name) ? this.#settings[name] : defaultValue;\n\t}\n\n\tgetPricePrecision()\n\t{\n\t\treturn this.#getSetting('pricePrecision', ProductCalculator.DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision()\n\t{\n\t\treturn this.#getSetting('commonPrecision', ProductCalculator.DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision()\n\t{\n\t\treturn this.#getSetting('quantityPrecision', ProductCalculator.DEFAULT_PRECISION);\n\t}\n\n\tcalculateBasePrice(value: number): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateBasePrice(value);\n\t}\n\n\tcalculatePrice(value: number): FieldScheme\n\t{\n\t\treturn this.#strategy.calculatePrice(value);\n\t}\n\n\tcalculateQuantity(value: number): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateQuantity(value);\n\t}\n\n\tcalculateDiscount(value: number): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateDiscount(value);\n\t}\n\n\tcalculateDiscountType(value: DiscountTypes): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateDiscountType(value);\n\t}\n\n\tcalculateRowDiscount(value: number): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateRowDiscount(value);\n\t}\n\n\tcalculateTax(value: number): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateTax(value);\n\t}\n\n\tcalculateTaxIncluded(value: 'Y' | 'N'): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateTaxIncluded(value);\n\t}\n\n\tcalculateRowSum(value: number): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateRowSum(value);\n\t}\n}","import {TaxForPriceStrategy} from \"./tax-for-price-strategy\";\nimport {FieldStorage} from \"../field-storage\";\nimport {DiscountType} from \"../discount-type\";\n\nexport class TaxForSumStrategy extends TaxForPriceStrategy\n{\n\tcalculatePriceWithoutTax(price, taxRate)\n\t{\n\t\treturn price;\n\t}\n\n\tupdateResultPrices(fieldStorage: FieldStorage): void\n\t{\n\t\tlet exclusivePrice;\n\n\t\tif (fieldStorage.isDiscountPercentage())\n\t\t{\n\t\t\texclusivePrice = this.calculatePriceWithoutDiscount(\n\t\t\t\tfieldStorage.getPriceNetto(),\n\t\t\t\tfieldStorage.getDiscountRate(),\n\t\t\t\tDiscountType.PERCENTAGE\n\t\t\t);\n\t\t}\n\t\telse if (fieldStorage.isDiscountMonetary())\n\t\t{\n\t\t\texclusivePrice = this.calculatePriceWithoutDiscount(\n\t\t\t\tfieldStorage.getPriceNetto(),\n\t\t\t\tfieldStorage.getDiscountSum(),\n\t\t\t\tDiscountType.MONETARY\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\texclusivePrice = fieldStorage.getPriceExclusive();\n\t\t}\n\n\t\tfieldStorage.setField('PRICE_EXCLUSIVE', exclusivePrice);\n\t\t\n\t\tif (fieldStorage.isTaxIncluded())\n\t\t{\n\t\t\tfieldStorage.setField('PRICE', exclusivePrice);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfieldStorage.setField(\n\t\t\t\t'PRICE',\n\t\t\t\tthis.calculatePriceWithTax(exclusivePrice, fieldStorage.getTaxRate())\n\t\t\t);\n\t\t}\n\t}\n}"],"names":["DiscountType","initialFields","QUANTITY","PRICE","PRICE_EXCLUSIVE","PRICE_NETTO","PRICE_BRUTTO","CUSTOMIZED","DISCOUNT_TYPE_ID","UNDEFINED","DISCOUNT_RATE","DISCOUNT_SUM","DISCOUNT_ROW","TAX_INCLUDED","TAX_RATE","TAX_SUM","SUM","FieldStorage","fields","calculator","Type","isPlainObject","Runtime","clone","name","defaultValue","hasOwnProperty","value","getField","getDiscountType","PERCENTAGE","MONETARY","isDiscountPercentage","isDiscountMonetary","getDiscountRate","getDiscountSum","isDiscountUndefined","getTaxIncluded","precision","ProductCalculator","DEFAULT_PRECISION","factor","Math","pow","round","getPricePrecision","getCommonPrecision","getQuantityPrecision","priceFields","includes","TaxForPriceStrategy","productCalculator","getFields","Error","fieldStorage","getFieldStorage","setField","isTaxIncluded","updatePrice","activateCustomized","getBasePrice","calculateBasePrice","clearResultPrices","calculateRowSum","getQuantity","discount","calculateDiscount","updateRowDiscount","updateTax","updateSum","updateResultPrices","getPriceNetto","getPriceExclusive","calculateDiscountRate","updateDiscount","getDiscountRow","updateBasePrices","getPriceBrutto","discountSum","getSum","getTaxRate","isEmptyDiscount","isDiscountHandmade","price","discountType","result","calculatePriceWithoutTax","calculatePriceWithTax","exclusivePrice","calculatePriceWithoutDiscount","sum","getPrice","originalPrice","taxRate","settings","setFields","setSettings","setCalculationStrategy","strategy","calculatePrice","calculateQuantity","calculateDiscountType","calculateRowDiscount","calculateTax","calculateTaxIncluded","TaxForSumStrategy"],"mappings":"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"}