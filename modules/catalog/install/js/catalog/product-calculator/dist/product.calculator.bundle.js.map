{"version":3,"file":"product.calculator.bundle.js","sources":["../src/js/discount-type.js","../src/js/field-storage.js","../src/js/strategy/tax-for-price-strategy.js","../src/js/product-calculator.js","../src/js/strategy/tax-for-sum-strategy.js"],"sourcesContent":["export type DiscountTypes = DiscountType.UNDEFINED | DiscountType.MONETARY | DiscountType.PERCENTAGE;\n\nexport class DiscountType\n{\n\tstatic UNDEFINED = 0;\n\tstatic MONETARY = 1;\n\tstatic PERCENTAGE = 2;\n}","import {Runtime, Type} from 'main.core';\nimport type {FieldScheme} from './field-scheme';\nimport type {DiscountTypes} from './discount-type';\nimport {DiscountType} from './discount-type';\n\nconst initialFields = {\n\tQUANTITY: 1,\n\tPRICE: 0,\n\tPRICE_EXCLUSIVE: 0,\n\tPRICE_NETTO: 0,\n\tPRICE_BRUTTO: 0,\n\tCUSTOMIZED: 'N',\n\tDISCOUNT_TYPE_ID: DiscountType.UNDEFINED,\n\tDISCOUNT_RATE: 0,\n\tDISCOUNT_SUM: 0,\n\tDISCOUNT_ROW: 0,\n\tTAX_INCLUDED: 'N',\n\tTAX_RATE: 0,\n\tTAX_SUM: 0,\n\tSUM: 0\n};\n\nexport class FieldStorage\n{\n\tfields: FieldScheme;\n\n\tconstructor(fields: FieldScheme)\n\t{\n\t\tthis.fields = {...initialFields};\n\n\t\tif (Type.isPlainObject(fields))\n\t\t{\n\t\t\tthis.fields = {...this.fields, ...fields};\n\t\t}\n\t}\n\n\tgetFields()\n\t{\n\t\treturn Runtime.clone(this.fields);\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value): void\n\t{\n\t\tthis.fields[name] = value;\n\t}\n\n\tgetPrice(): number\n\t{\n\t\treturn this.getField('PRICE', 0);\n\t}\n\n\tgetPriceExclusive(): number\n\t{\n\t\treturn this.getField('PRICE_EXCLUSIVE', 0);\n\t}\n\n\tgetPriceNetto(): number\n\t{\n\t\treturn this.getField('PRICE_NETTO', 0);\n\t}\n\n\tgetPriceBrutto(): number\n\t{\n\t\treturn this.getField('PRICE_BRUTTO', 0);\n\t}\n\n\tgetQuantity(): number\n\t{\n\t\treturn this.getField('QUANTITY', 1);\n\t}\n\n\tgetDiscountType(): DiscountTypes\n\t{\n\t\treturn this.getField('DISCOUNT_TYPE_ID', DiscountType.UNDEFINED);\n\t}\n\n\tisDiscountUndefined(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.UNDEFINED;\n\t}\n\n\tisDiscountPercentage(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.PERCENTAGE;\n\t}\n\n\tisDiscountMonetary(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.MONETARY;\n\t}\n\n\tisDiscountHandmade(): boolean\n\t{\n\t\treturn this.isDiscountPercentage() || this.isDiscountMonetary();\n\t}\n\n\tgetDiscountRate(): number\n\t{\n\t\treturn this.getField('DISCOUNT_RATE', 0);\n\t}\n\n\tgetDiscountSum(): number\n\t{\n\t\treturn this.getField('DISCOUNT_SUM', 0);\n\t}\n\n\tgetDiscountRow(): number\n\t{\n\t\treturn this.getField('DISCOUNT_ROW', 0);\n\t}\n\n\tisEmptyDiscount(): boolean\n\t{\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\treturn this.getDiscountRate() === 0;\n\t\t}\n\n\t\tif (this.isDiscountMonetary())\n\t\t{\n\t\t\treturn this.getDiscountSum() === 0;\n\t\t}\n\n\t\treturn this.isDiscountUndefined();\n\t}\n\n\tgetTaxIncluded(): 'Y' | 'N'\n\t{\n\t\treturn this.getField('TAX_INCLUDED', 'N');\n\t}\n\n\tisTaxIncluded(): boolean\n\t{\n\t\treturn this.getTaxIncluded() === 'Y';\n\t}\n\n\tgetTaxRate(): number\n\t{\n\t\treturn this.getField('TAX_RATE', 0);\n\t}\n\n\tgetTaxSum(): number\n\t{\n\t\treturn this.getField('TAX_SUM', 0);\n\t}\n\n\tgetSum(): number\n\t{\n\t\treturn this.getField('SUM', 0);\n\t}\n}","import type {DiscountTypes} from '../discount-type';\nimport {DiscountType} from '../discount-type';\nimport type {FieldScheme} from \"../field-scheme\";\nimport {FieldStorage} from '../field-storage';\nimport {ProductCalculator} from '../product-calculator';\n\nexport class TaxForPriceStrategy\n{\n\tcalculator: ProductCalculator = null;\n\n\tconstructor(productCalculator: ProductCalculator)\n\t{\n\t\tthis.calculator = productCalculator;\n\t}\n\n\tgetFieldStorage(): FieldStorage\n\t{\n\t\treturn new FieldStorage(this.calculator.getFields());\n\t}\n\n\tgetPricePrecision()\n\t{\n\t\treturn this.calculator.getPricePrecision();\n\t}\n\n\tgetCommonPrecision()\n\t{\n\t\treturn this.calculator.getCommonPrecision();\n\t}\n\n\tgetQuantityPrecision()\n\t{\n\t\treturn this.calculator.getQuantityPrecision();\n\t}\n\n\tcalculatePrice(value: number): FieldScheme\n\t{\n\t\tif (value < 0)\n\t\t{\n\t\t\tthrow new Error('Price must be equal or greater than zero.')\n\t\t}\n\n\t\tvalue = this.roundPrice(value);\n\n\t\tconst fieldStorage = this.getFieldStorage();\n\n\t\tif (fieldStorage.isTaxIncluded())\n\t\t{\n\t\t\tfieldStorage.setField('PRICE_BRUTTO', value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfieldStorage.setField('PRICE_NETTO', value);\n\t\t}\n\n\t\tthis.updatePrice(fieldStorage);\n\n\t\tthis.activateCustomized(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tcalculateQuantity(value: number): FieldScheme\n\t{\n\t\tif (value < 0)\n\t\t{\n\t\t\tthrow new Error('Quantity must be equal or greater than zero.')\n\t\t}\n\n\t\tvalue = this.round(value, this.getQuantityPrecision());\n\n\t\tconst fieldStorage = this.getFieldStorage();\n\t\tfieldStorage.setField('QUANTITY', value);\n\n\t\tthis.updateRowDiscount(fieldStorage);\n\t\tthis.updateTax(fieldStorage);\n\t\tthis.updateSum(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tcalculateDiscount(value: number): FieldScheme\n\t{\n\t\tconst fieldStorage = this.getFieldStorage();\n\n\t\tif (value === 0.0)\n\t\t{\n\t\t\tthis.clearResultPrices(fieldStorage);\n\t\t}\n\t\telse if (fieldStorage.isDiscountPercentage())\n\t\t{\n\t\t\tfieldStorage.setField('DISCOUNT_RATE', value);\n\n\t\t\tthis.updateResultPrices(fieldStorage);\n\n\t\t\tfieldStorage.setField(\n\t\t\t\t'DISCOUNT_SUM',\n\t\t\t\tthis.roundPrice(fieldStorage.getPriceNetto() - fieldStorage.getPriceExclusive())\n\t\t\t);\n\t\t}\n\t\telse if (fieldStorage.isDiscountMonetary())\n\t\t{\n\t\t\tfieldStorage.setField('DISCOUNT_SUM', value);\n\n\t\t\tthis.updateResultPrices(fieldStorage);\n\n\t\t\tfieldStorage.setField(\n\t\t\t\t'DISCOUNT_RATE',\n\t\t\t\tthis.round(\n\t\t\t\t\tthis.calculateDiscountRate(\n\t\t\t\t\t\tfieldStorage.getPriceNetto(),\n\t\t\t\t\t\tfieldStorage.getPriceExclusive()\n\t\t\t\t\t),\n\t\t\t\t\tthis.getCommonPrecision()\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tthis.updateRowDiscount(fieldStorage);\n\t\tthis.updateTax(fieldStorage);\n\t\tthis.updateSum(fieldStorage);\n\n\t\tthis.activateCustomized(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tcalculateDiscountType(value: DiscountTypes): FieldScheme\n\t{\n\t\tconst fieldStorage = this.getFieldStorage();\n\n\t\tfieldStorage.setField('DISCOUNT_TYPE_ID', value);\n\n\t\tthis.updateResultPrices(fieldStorage);\n\t\tthis.updateDiscount(fieldStorage);\n\t\tthis.updateRowDiscount(fieldStorage);\n\t\tthis.updateTax(fieldStorage);\n\t\tthis.updateSum(fieldStorage);\n\n\t\tthis.activateCustomized(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tcalculateRowDiscount(value: number): FieldScheme\n\t{\n\t\tconst fieldStorage = this.getFieldStorage();\n\n\t\tfieldStorage.setField('DISCOUNT_ROW', value);\n\n\t\tif (value !== 0 && fieldStorage.getQuantity() === 0)\n\t\t{\n\t\t\tfieldStorage.setField('QUANTITY', 1);\n\t\t}\n\n\t\tfieldStorage.setField('DISCOUNT_TYPE_ID', DiscountType.MONETARY);\n\n\t\tif (value === 0 || fieldStorage.getQuantity() === 0)\n\t\t{\n\t\t\tfieldStorage.setField('DISCOUNT_SUM', 0);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfieldStorage.setField(\n\t\t\t\t'DISCOUNT_SUM',\n\t\t\t\tthis.roundPrice(fieldStorage.getDiscountRow() / fieldStorage.getQuantity())\n\t\t\t);\n\t\t}\n\n\t\tthis.updateResultPrices(fieldStorage);\n\n\t\tthis.updateDiscount(fieldStorage);\n\t\tthis.updateRowDiscount(fieldStorage);\n\t\tthis.updateTax(fieldStorage);\n\t\tthis.updateSum(fieldStorage);\n\n\t\tthis.activateCustomized(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tcalculateTax(value: number): FieldScheme\n\t{\n\t\tconst fieldStorage = this.getFieldStorage();\n\t\tfieldStorage.setField('TAX_RATE', value);\n\n\t\tthis.updateBasePrices(fieldStorage);\n\t\tthis.updateResultPrices(fieldStorage);\n\n\t\tif (fieldStorage.isTaxIncluded())\n\t\t{\n\t\t\tthis.updateDiscount(fieldStorage);\n\t\t\tthis.updateRowDiscount(fieldStorage);\n\t\t}\n\n\t\tthis.updateTax(fieldStorage);\n\t\tthis.updateSum(fieldStorage);\n\n\t\tthis.activateCustomized(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tcalculateTaxIncluded(value: 'Y' | 'N'): FieldScheme\n\t{\n\t\tconst fieldStorage = this.getFieldStorage();\n\n\t\tif (fieldStorage.getTaxIncluded() !== value)\n\t\t{\n\t\t\tfieldStorage.setField('TAX_INCLUDED', value);\n\n\t\t\tif (fieldStorage.isTaxIncluded())\n\t\t\t{\n\t\t\t\tfieldStorage.setField('PRICE_BRUTTO', fieldStorage.getPriceNetto());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfieldStorage.setField('PRICE_NETTO', fieldStorage.getPriceBrutto());\n\t\t\t}\n\t\t}\n\n\t\tthis.updatePrice(fieldStorage);\n\n\t\tthis.activateCustomized(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tcalculateRowSum(value: number): FieldScheme\n\t{\n\t\tconst fieldStorage = this.getFieldStorage();\n\n\t\tfieldStorage.setField('SUM', value);\n\n\t\tif (fieldStorage.getQuantity() === 0)\n\t\t{\n\t\t\tfieldStorage.setField('QUANTITY', 1);\n\t\t}\n\n\t\tconst discountSum = this.roundPrice(\n\t\t\tfieldStorage.getPriceNetto()\n\t\t\t- (\n\t\t\t\tfieldStorage.getSum()\n\t\t\t\t/ (fieldStorage.getQuantity() * (1 + fieldStorage.getTaxRate() / 100))\n\t\t\t)\n\t\t);\n\n\t\tfieldStorage.setField('DISCOUNT_SUM', discountSum);\n\t\tfieldStorage.setField('DISCOUNT_TYPE_ID', DiscountType.MONETARY);\n\n\t\tif (fieldStorage.isEmptyDiscount())\n\t\t{\n\t\t\tthis.clearResultPrices(fieldStorage);\n\t\t}\n\t\telse if (fieldStorage.isDiscountHandmade())\n\t\t{\n\t\t\tthis.updateResultPrices(fieldStorage);\n\t\t}\n\n\t\tthis.updateDiscount(fieldStorage);\n\t\tthis.updateRowDiscount(fieldStorage);\n\t\tthis.updateTax(fieldStorage);\n\n\t\tthis.activateCustomized(fieldStorage);\n\n\t\treturn fieldStorage.getFields();\n\t}\n\n\tupdatePrice(fieldStorage: FieldStorage): void\n\t{\n\t\tthis.updateBasePrices(fieldStorage);\n\n\t\tif (fieldStorage.isEmptyDiscount())\n\t\t{\n\t\t\tthis.clearResultPrices(fieldStorage);\n\t\t}\n\t\telse if (fieldStorage.isDiscountHandmade())\n\t\t{\n\t\t\tthis.updateResultPrices(fieldStorage);\n\t\t}\n\n\t\tthis.updateDiscount(fieldStorage);\n\t\tthis.updateRowDiscount(fieldStorage);\n\t\tthis.updateTax(fieldStorage);\n\t\tthis.updateSum(fieldStorage);\n\t}\n\n\tclearResultPrices(fieldStorage: FieldStorage)\n\t{\n\t\tfieldStorage.setField('PRICE_EXCLUSIVE', fieldStorage.getPriceNetto());\n\t\tfieldStorage.setField('PRICE', fieldStorage.getPriceBrutto());\n\n\t\tfieldStorage.setField('DISCOUNT_RATE', 0.0);\n\t\tfieldStorage.setField('DISCOUNT_SUM', 0.0);\n\t}\n\n\tcalculatePriceWithoutDiscount(price: number, discount: number, discountType: DiscountTypes)\n\t{\n\t\tlet result = 0.0;\n\n\t\tswitch (discountType)\n\t\t{\n\t\t\tcase DiscountType.PERCENTAGE:\n\t\t\t\tresult = price - (price * discount / 100);\n\t\t\t\tbreak;\n\n\t\t\tcase DiscountType.MONETARY:\n\t\t\t\tresult = price - discount;\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tupdateBasePrices(fieldStorage: FieldStorage): void\n\t{\n\t\tif (fieldStorage.isTaxIncluded())\n\t\t{\n\t\t\tfieldStorage.setField(\n\t\t\t\t'PRICE_NETTO',\n\t\t\t\tthis.roundPrice(\n\t\t\t\t\tthis.calculatePriceWithoutTax(fieldStorage.getPriceBrutto(), fieldStorage.getTaxRate())\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfieldStorage.setField(\n\t\t\t\t'PRICE_BRUTTO',\n\t\t\t\tthis.roundPrice(\n\t\t\t\t\tthis.calculatePriceWithTax(fieldStorage.getPriceNetto(), fieldStorage.getTaxRate())\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}\n\n\tupdateResultPrices(fieldStorage: FieldStorage): void\n\t{\n\t\t// price without tax\n\t\tlet exclusivePrice;\n\n\t\tif (fieldStorage.isDiscountPercentage())\n\t\t{\n\t\t\texclusivePrice = this.calculatePriceWithoutDiscount(\n\t\t\t\tfieldStorage.getPriceNetto(),\n\t\t\t\tfieldStorage.getDiscountRate(),\n\t\t\t\tDiscountType.PERCENTAGE\n\t\t\t);\n\t\t}\n\t\telse if (fieldStorage.isDiscountMonetary())\n\t\t{\n\t\t\texclusivePrice = this.calculatePriceWithoutDiscount(\n\t\t\t\tfieldStorage.getPriceNetto(),\n\t\t\t\tfieldStorage.getDiscountSum(),\n\t\t\t\tDiscountType.MONETARY\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\texclusivePrice = fieldStorage.getPriceExclusive();\n\t\t}\n\n\t\tfieldStorage.setField('PRICE_EXCLUSIVE', this.roundPrice(exclusivePrice));\n\t\tfieldStorage.setField(\n\t\t\t'PRICE',\n\t\t\tthis.roundPrice(this.calculatePriceWithTax(exclusivePrice, fieldStorage.getTaxRate()))\n\t\t);\n\t}\n\n\tactivateCustomized(fieldStorage: FieldStorage): void\n\t{\n\t\tfieldStorage.setField('CUSTOMIZED', 'Y');\n\t}\n\n\tupdateDiscount(fieldStorage: FieldStorage): void\n\t{\n\t\tif (fieldStorage.isEmptyDiscount())\n\t\t{\n\t\t\tthis.clearResultPrices(fieldStorage);\n\t\t}\n\t\telse if (fieldStorage.isDiscountPercentage())\n\t\t{\n\t\t\tfieldStorage.setField(\n\t\t\t\t'DISCOUNT_SUM',\n\t\t\t\tthis.round(fieldStorage.getPriceNetto() - fieldStorage.getPriceExclusive())\n\t\t\t);\n\t\t}\n\t\telse if (fieldStorage.isDiscountMonetary())\n\t\t{\n\t\t\tfieldStorage.setField(\n\t\t\t\t'DISCOUNT_RATE',\n\t\t\t\tthis.round(\n\t\t\t\t\tthis.calculateDiscountRate(\n\t\t\t\t\t\tfieldStorage.getPriceNetto(),\n\t\t\t\t\t\tfieldStorage.getPriceNetto() - fieldStorage.getDiscountSum()\n\t\t\t\t\t),\n\t\t\t\t\tthis.getCommonPrecision()\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}\n\n\tupdateRowDiscount(fieldStorage: FieldStorage): void\n\t{\n\t\tfieldStorage.setField(\n\t\t\t'DISCOUNT_ROW',\n\t\t\tthis.roundPrice(fieldStorage.getDiscountSum() * fieldStorage.getQuantity())\n\t\t);\n\t}\n\n\tupdateTax(fieldStorage: FieldStorage): void\n\t{\n\t\tlet sum;\n\n\t\tif (fieldStorage.isTaxIncluded())\n\t\t{\n\t\t\tsum =\n\t\t\t\tfieldStorage.getPrice()\n\t\t\t\t* fieldStorage.getQuantity()\n\t\t\t\t* (1 - 1 / (1 + fieldStorage.getTaxRate() / 100))\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsum =\n\t\t\t\tfieldStorage.getPriceExclusive()\n\t\t\t\t* fieldStorage.getQuantity()\n\t\t\t\t* (fieldStorage.getTaxRate() / 100)\n\t\t\t;\n\t\t}\n\n\t\tfieldStorage.setField('TAX_SUM', this.roundPrice(sum));\n\t}\n\n\tupdateSum(fieldStorage: FieldStorage): void\n\t{\n\t\tlet sum;\n\n\t\tif (fieldStorage.isTaxIncluded())\n\t\t{\n\t\t\tsum = fieldStorage.getPrice() * fieldStorage.getQuantity();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsum = this.calculatePriceWithTax(\n\t\t\t\tfieldStorage.getPriceExclusive() * fieldStorage.getQuantity(),\n\t\t\t\tfieldStorage.getTaxRate()\n\t\t\t);\n\t\t}\n\n\t\tfieldStorage.setField('SUM', this.roundPrice(sum));\n\t}\n\n\tcalculateDiscountRate(originalPrice: number, price: number): number\n\t{\n\t\tif (originalPrice === 0.0)\n\t\t{\n\t\t\treturn 0.0;\n\t\t}\n\n\t\tif (price === 0.0)\n\t\t{\n\t\t\treturn originalPrice > 0 ? 100.0 : -100.0;\n\t\t}\n\n\t\treturn (originalPrice - price) / originalPrice * 100;\n\t}\n\n\tcalculatePriceWithoutTax(price: number, taxRate: number)\n\t{\n\t\t// Tax is not included in price\n\t\treturn price / (1 + (taxRate / 100));\n\t}\n\n\tcalculatePriceWithTax(price: number, taxRate: number): number\n\t{\n\t\t// Tax is included in price\n\t\treturn price + price * taxRate / 100;\n\t}\n\n\tround(value: number, precision = ProductCalculator.DEFAULT_PRECISION): number\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\troundPrice(value: number): number\n\t{\n\t\treturn this.round(value, this.getPricePrecision());\n\t}\n}","import type {FieldScheme} from './field-scheme';\nimport type {DiscountTypes} from './discount-type';\nimport {TaxForPriceStrategy} from './strategy/tax-for-price-strategy';\n\nexport class ProductCalculator\n{\n\t#fields: FieldScheme = {};\n\t#strategy: TaxForPriceStrategy = {};\n\t#settings = {};\n\n\tstatic DEFAULT_PRECISION: number = 2;\n\n\tconstructor(fields: FieldScheme = {}, settings = {})\n\t{\n\t\tthis.setFields(fields);\n\t\tthis.setSettings(settings);\n\t\tthis.setCalculationStrategy(new TaxForPriceStrategy(this));\n\t}\n\n\tsetField(name, value): ProductCalculator\n\t{\n\t\tthis.#fields[name] = value;\n\n\t\treturn this;\n\t}\n\n\tsetCalculationStrategy(strategy: TaxForPriceStrategy = {}): ProductCalculator\n\t{\n\t\tthis.#strategy = strategy;\n\n\t\treturn this;\n\t}\n\n\tsetFields(fields: FieldScheme): ProductCalculator\n\t{\n\t\tfor (const name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetFields(): FieldScheme\n\t{\n\t\treturn {...this.#fields};\n\t}\n\n\tsetSettings(settings = {}): ProductCalculator\n\t{\n\t\tthis.#settings = {...settings};\n\n\t\treturn this;\n\t}\n\n\tgetSettings(): {}\n\t{\n\t\treturn {...this.#settings};\n\t}\n\n\t#getSetting(name, defaultValue)\n\t{\n\t\treturn this.#settings.hasOwnProperty(name) ? this.#settings[name] : defaultValue;\n\t}\n\n\tgetPricePrecision()\n\t{\n\t\treturn this.#getSetting('pricePrecision', ProductCalculator.DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision()\n\t{\n\t\treturn this.#getSetting('commonPrecision', ProductCalculator.DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision()\n\t{\n\t\treturn this.#getSetting('quantityPrecision', ProductCalculator.DEFAULT_PRECISION);\n\t}\n\n\tcalculatePrice(value: number): FieldScheme\n\t{\n\t\treturn this.#strategy.calculatePrice(value);\n\t}\n\n\tcalculateQuantity(value: number): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateQuantity(value);\n\t}\n\n\tcalculateDiscount(value: number): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateDiscount(value);\n\t}\n\n\tcalculateDiscountType(value: DiscountTypes): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateDiscountType(value);\n\t}\n\n\tcalculateRowDiscount(value: number): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateRowDiscount(value);\n\t}\n\n\tcalculateTax(value: number): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateTax(value);\n\t}\n\n\tcalculateTaxIncluded(value: 'Y' | 'N'): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateTaxIncluded(value);\n\t}\n\n\tcalculateRowSum(value: number): FieldScheme\n\t{\n\t\treturn this.#strategy.calculateRowSum(value);\n\t}\n}","import {TaxForPriceStrategy} from \"./tax-for-price-strategy\";\nimport {FieldStorage} from \"../field-storage\";\nimport {DiscountType} from \"../discount-type\";\n\nexport class TaxForSumStrategy extends TaxForPriceStrategy\n{\n\tcalculatePriceWithoutTax(price, taxRate)\n\t{\n\t\treturn price;\n\t}\n\n\tupdateResultPrices(fieldStorage: FieldStorage): void\n\t{\n\t\tlet exclusivePrice;\n\n\t\tif (fieldStorage.isDiscountPercentage())\n\t\t{\n\t\t\texclusivePrice = this.calculatePriceWithoutDiscount(\n\t\t\t\tfieldStorage.getPriceNetto(),\n\t\t\t\tfieldStorage.getDiscountRate(),\n\t\t\t\tDiscountType.PERCENTAGE\n\t\t\t);\n\t\t}\n\t\telse if (fieldStorage.isDiscountMonetary())\n\t\t{\n\t\t\texclusivePrice = this.calculatePriceWithoutDiscount(\n\t\t\t\tfieldStorage.getPriceNetto(),\n\t\t\t\tfieldStorage.getDiscountSum(),\n\t\t\t\tDiscountType.MONETARY\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\texclusivePrice = fieldStorage.getPriceExclusive();\n\t\t}\n\n\t\tfieldStorage.setField('PRICE_EXCLUSIVE', this.roundPrice(exclusivePrice));\n\t\t\n\t\tif (fieldStorage.isTaxIncluded())\n\t\t{\n\t\t\tfieldStorage.setField('PRICE', this.roundPrice(exclusivePrice));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfieldStorage.setField(\n\t\t\t\t'PRICE',\n\t\t\t\tthis.roundPrice(\n\t\t\t\t\tthis.calculatePriceWithTax(exclusivePrice, fieldStorage.getTaxRate())\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}\n}"],"names":["DiscountType","initialFields","QUANTITY","PRICE","PRICE_EXCLUSIVE","PRICE_NETTO","PRICE_BRUTTO","CUSTOMIZED","DISCOUNT_TYPE_ID","UNDEFINED","DISCOUNT_RATE","DISCOUNT_SUM","DISCOUNT_ROW","TAX_INCLUDED","TAX_RATE","TAX_SUM","SUM","FieldStorage","fields","Type","isPlainObject","Runtime","clone","name","defaultValue","hasOwnProperty","value","getField","getDiscountType","PERCENTAGE","MONETARY","isDiscountPercentage","isDiscountMonetary","getDiscountRate","getDiscountSum","isDiscountUndefined","getTaxIncluded","TaxForPriceStrategy","productCalculator","calculator","getFields","getPricePrecision","getCommonPrecision","getQuantityPrecision","Error","roundPrice","fieldStorage","getFieldStorage","isTaxIncluded","setField","updatePrice","activateCustomized","round","updateRowDiscount","updateTax","updateSum","clearResultPrices","updateResultPrices","getPriceNetto","getPriceExclusive","calculateDiscountRate","updateDiscount","getQuantity","getDiscountRow","updateBasePrices","getPriceBrutto","discountSum","getSum","getTaxRate","isEmptyDiscount","isDiscountHandmade","price","discount","discountType","result","calculatePriceWithoutTax","calculatePriceWithTax","exclusivePrice","calculatePriceWithoutDiscount","sum","getPrice","originalPrice","taxRate","precision","ProductCalculator","DEFAULT_PRECISION","factor","Math","pow","settings","setFields","setSettings","setCalculationStrategy","strategy","calculatePrice","calculateQuantity","calculateDiscount","calculateDiscountType","calculateRowDiscount","calculateTax","calculateTaxIncluded","calculateRowSum","TaxForSumStrategy"],"mappings":"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"}