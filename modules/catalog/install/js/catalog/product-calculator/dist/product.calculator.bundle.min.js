this.BX=this.BX||{};(function(e,t){"use strict";var i=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(i,"UNDEFINED",0);babelHelpers.defineProperty(i,"MONETARY",1);babelHelpers.defineProperty(i,"PERCENTAGE",2);var s={QUANTITY:1,PRICE:0,PRICE_EXCLUSIVE:0,PRICE_NETTO:0,PRICE_BRUTTO:0,CUSTOMIZED:"N",DISCOUNT_TYPE_ID:i.UNDEFINED,DISCOUNT_RATE:0,DISCOUNT_SUM:0,DISCOUNT_ROW:0,TAX_INCLUDED:"N",TAX_RATE:0,TAX_SUM:0,SUM:0};var u=function(){function e(i){babelHelpers.classCallCheck(this,e);this.fields=babelHelpers.objectSpread({},s);if(t.Type.isPlainObject(i)){this.fields=babelHelpers.objectSpread({},this.fields,i)}}babelHelpers.createClass(e,[{key:"getFields",value:function e(){return t.Runtime.clone(this.fields)}},{key:"getField",value:function e(t,i){return this.fields.hasOwnProperty(t)?this.fields[t]:i}},{key:"setField",value:function e(t,i){this.fields[t]=i}},{key:"getPrice",value:function e(){return this.getField("PRICE",0)}},{key:"getPriceExclusive",value:function e(){return this.getField("PRICE_EXCLUSIVE",0)}},{key:"getPriceNetto",value:function e(){return this.getField("PRICE_NETTO",0)}},{key:"getPriceBrutto",value:function e(){return this.getField("PRICE_BRUTTO",0)}},{key:"getQuantity",value:function e(){return this.getField("QUANTITY",1)}},{key:"getDiscountType",value:function e(){return this.getField("DISCOUNT_TYPE_ID",i.UNDEFINED)}},{key:"isDiscountUndefined",value:function e(){return this.getDiscountType()===i.UNDEFINED}},{key:"isDiscountPercentage",value:function e(){return this.getDiscountType()===i.PERCENTAGE}},{key:"isDiscountMonetary",value:function e(){return this.getDiscountType()===i.MONETARY}},{key:"isDiscountHandmade",value:function e(){return this.isDiscountPercentage()||this.isDiscountMonetary()}},{key:"getDiscountRate",value:function e(){return this.getField("DISCOUNT_RATE",0)}},{key:"getDiscountSum",value:function e(){return this.getField("DISCOUNT_SUM",0)}},{key:"getDiscountRow",value:function e(){return this.getField("DISCOUNT_ROW",0)}},{key:"isEmptyDiscount",value:function e(){if(this.isDiscountPercentage()){return this.getDiscountRate()===0}if(this.isDiscountMonetary()){return this.getDiscountSum()===0}return this.isDiscountUndefined()}},{key:"getTaxIncluded",value:function e(){return this.getField("TAX_INCLUDED","N")}},{key:"isTaxIncluded",value:function e(){return this.getTaxIncluded()==="Y"}},{key:"getTaxRate",value:function e(){return this.getField("TAX_RATE",0)}},{key:"getTaxSum",value:function e(){return this.getField("TAX_SUM",0)}},{key:"getSum",value:function e(){return this.getField("SUM",0)}}]);return e}();var a=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"calculator",null);this.calculator=t}babelHelpers.createClass(e,[{key:"getFieldStorage",value:function e(){return new u(this.calculator.getFields())}},{key:"getPricePrecision",value:function e(){return this.calculator.getPricePrecision()}},{key:"getCommonPrecision",value:function e(){return this.calculator.getCommonPrecision()}},{key:"getQuantityPrecision",value:function e(){return this.calculator.getQuantityPrecision()}},{key:"calculatePrice",value:function e(t){if(t<0){throw new Error("Price must be equal or greater than zero.")}t=this.roundPrice(t);var i=this.getFieldStorage();if(i.isTaxIncluded()){i.setField("PRICE_BRUTTO",t)}else{i.setField("PRICE_NETTO",t)}this.updatePrice(i);this.activateCustomized(i);return i.getFields()}},{key:"calculateQuantity",value:function e(t){if(t<0){throw new Error("Quantity must be equal or greater than zero.")}t=this.round(t,this.getQuantityPrecision());var i=this.getFieldStorage();i.setField("QUANTITY",t);this.updateRowDiscount(i);this.updateTax(i);this.updateSum(i);return i.getFields()}},{key:"calculateDiscount",value:function e(t){var i=this.getFieldStorage();if(t===0){this.clearResultPrices(i)}else if(i.isDiscountPercentage()){i.setField("DISCOUNT_RATE",t);this.updateResultPrices(i);i.setField("DISCOUNT_SUM",this.roundPrice(i.getPriceNetto()-i.getPriceExclusive()))}else if(i.isDiscountMonetary()){i.setField("DISCOUNT_SUM",t);this.updateResultPrices(i);i.setField("DISCOUNT_RATE",this.round(this.calculateDiscountRate(i.getPriceNetto(),i.getPriceExclusive()),this.getCommonPrecision()))}this.updateRowDiscount(i);this.updateTax(i);this.updateSum(i);this.activateCustomized(i);return i.getFields()}},{key:"calculateDiscountType",value:function e(t){var i=this.getFieldStorage();i.setField("DISCOUNT_TYPE_ID",t);this.updateResultPrices(i);this.updateDiscount(i);this.updateRowDiscount(i);this.updateTax(i);this.updateSum(i);this.activateCustomized(i);return i.getFields()}},{key:"calculateRowDiscount",value:function e(t){var s=this.getFieldStorage();s.setField("DISCOUNT_ROW",t);if(t!==0&&s.getQuantity()===0){s.setField("QUANTITY",1)}s.setField("DISCOUNT_TYPE_ID",i.MONETARY);if(t===0||s.getQuantity()===0){s.setField("DISCOUNT_SUM",0)}else{s.setField("DISCOUNT_SUM",this.roundPrice(s.getDiscountRow()/s.getQuantity()))}this.updateResultPrices(s);this.updateDiscount(s);this.updateRowDiscount(s);this.updateTax(s);this.updateSum(s);this.activateCustomized(s);return s.getFields()}},{key:"calculateTax",value:function e(t){var i=this.getFieldStorage();i.setField("TAX_RATE",t);this.updateBasePrices(i);this.updateResultPrices(i);if(i.isTaxIncluded()){this.updateDiscount(i);this.updateRowDiscount(i)}this.updateTax(i);this.updateSum(i);this.activateCustomized(i);return i.getFields()}},{key:"calculateTaxIncluded",value:function e(t){var i=this.getFieldStorage();if(i.getTaxIncluded()!==t){i.setField("TAX_INCLUDED",t);if(i.isTaxIncluded()){i.setField("PRICE_BRUTTO",i.getPriceNetto())}else{i.setField("PRICE_NETTO",i.getPriceBrutto())}}this.updatePrice(i);this.activateCustomized(i);return i.getFields()}},{key:"calculateRowSum",value:function e(t){var s=this.getFieldStorage();s.setField("SUM",t);if(s.getQuantity()===0){s.setField("QUANTITY",1)}var u=this.roundPrice(s.getPriceNetto()-s.getSum()/(s.getQuantity()*(1+s.getTaxRate()/100)));s.setField("DISCOUNT_SUM",u);s.setField("DISCOUNT_TYPE_ID",i.MONETARY);if(s.isEmptyDiscount()){this.clearResultPrices(s)}else if(s.isDiscountHandmade()){this.updateResultPrices(s)}this.updateDiscount(s);this.updateRowDiscount(s);this.updateTax(s);this.activateCustomized(s);return s.getFields()}},{key:"updatePrice",value:function e(t){this.updateBasePrices(t);if(t.isEmptyDiscount()){this.clearResultPrices(t)}else if(t.isDiscountHandmade()){this.updateResultPrices(t)}this.updateDiscount(t);this.updateRowDiscount(t);this.updateTax(t);this.updateSum(t)}},{key:"clearResultPrices",value:function e(t){t.setField("PRICE_EXCLUSIVE",t.getPriceNetto());t.setField("PRICE",t.getPriceBrutto());t.setField("DISCOUNT_RATE",0);t.setField("DISCOUNT_SUM",0)}},{key:"calculatePriceWithoutDiscount",value:function e(t,s,u){var a=0;switch(u){case i.PERCENTAGE:a=t-t*s/100;break;case i.MONETARY:a=t-s;break}return a}},{key:"updateBasePrices",value:function e(t){if(t.isTaxIncluded()){t.setField("PRICE_NETTO",this.roundPrice(this.calculatePriceWithoutTax(t.getPriceBrutto(),t.getTaxRate())))}else{t.setField("PRICE_BRUTTO",this.roundPrice(this.calculatePriceWithTax(t.getPriceNetto(),t.getTaxRate())))}}},{key:"updateResultPrices",value:function e(t){var s;if(t.isDiscountPercentage()){s=this.calculatePriceWithoutDiscount(t.getPriceNetto(),t.getDiscountRate(),i.PERCENTAGE)}else if(t.isDiscountMonetary()){s=this.calculatePriceWithoutDiscount(t.getPriceNetto(),t.getDiscountSum(),i.MONETARY)}else{s=t.getPriceExclusive()}t.setField("PRICE_EXCLUSIVE",this.roundPrice(s));t.setField("PRICE",this.roundPrice(this.calculatePriceWithTax(s,t.getTaxRate())))}},{key:"activateCustomized",value:function e(t){t.setField("CUSTOMIZED","Y")}},{key:"updateDiscount",value:function e(t){if(t.isEmptyDiscount()){this.clearResultPrices(t)}else if(t.isDiscountPercentage()){t.setField("DISCOUNT_SUM",this.round(t.getPriceNetto()-t.getPriceExclusive()))}else if(t.isDiscountMonetary()){t.setField("DISCOUNT_RATE",this.round(this.calculateDiscountRate(t.getPriceNetto(),t.getPriceNetto()-t.getDiscountSum()),this.getCommonPrecision()))}}},{key:"updateRowDiscount",value:function e(t){t.setField("DISCOUNT_ROW",this.roundPrice(t.getDiscountSum()*t.getQuantity()))}},{key:"updateTax",value:function e(t){var i;if(t.isTaxIncluded()){i=t.getPrice()*t.getQuantity()*(1-1/(1+t.getTaxRate()/100))}else{i=t.getPriceExclusive()*t.getQuantity()*(t.getTaxRate()/100)}t.setField("TAX_SUM",this.roundPrice(i))}},{key:"updateSum",value:function e(t){var i;if(t.isTaxIncluded()){i=t.getPrice()*t.getQuantity()}else{i=this.calculatePriceWithTax(t.getPriceExclusive()*t.getQuantity(),t.getTaxRate())}t.setField("SUM",this.roundPrice(i))}},{key:"calculateDiscountRate",value:function e(t,i){if(t===0){return 0}if(i===0){return t>0?100:-100}return(t-i)/t*100}},{key:"calculatePriceWithoutTax",value:function e(t,i){return t/(1+i/100)}},{key:"calculatePriceWithTax",value:function e(t,i){return t+t*i/100}},{key:"round",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:d.DEFAULT_PRECISION;var s=Math.pow(10,i);return Math.round(t*s)/s}},{key:"roundPrice",value:function e(t){return this.round(t,this.getPricePrecision())}}]);return e}();function l(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var r=new WeakMap;var n=new WeakMap;var c=new WeakMap;var o=new WeakSet;var d=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,e);o.add(this);r.set(this,{writable:true,value:{}});n.set(this,{writable:true,value:{}});c.set(this,{writable:true,value:{}});this.setFields(t);this.setSettings(i);this.setCalculationStrategy(new a(this))}babelHelpers.createClass(e,[{key:"setField",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,r)[t]=i;return this}},{key:"setCalculationStrategy",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classPrivateFieldSet(this,n,t);return this}},{key:"setFields",value:function e(t){for(var i in t){if(t.hasOwnProperty(i)){this.setField(i,t[i])}}return this}},{key:"getFields",value:function e(){return babelHelpers.objectSpread({},babelHelpers.classPrivateFieldGet(this,r))}},{key:"setSettings",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classPrivateFieldSet(this,c,babelHelpers.objectSpread({},t));return this}},{key:"getSettings",value:function e(){return babelHelpers.objectSpread({},babelHelpers.classPrivateFieldGet(this,c))}},{key:"getPricePrecision",value:function t(){return l(this,o,h).call(this,"pricePrecision",e.DEFAULT_PRECISION)}},{key:"getCommonPrecision",value:function t(){return l(this,o,h).call(this,"commonPrecision",e.DEFAULT_PRECISION)}},{key:"getQuantityPrecision",value:function t(){return l(this,o,h).call(this,"quantityPrecision",e.DEFAULT_PRECISION)}},{key:"calculatePrice",value:function e(t){return babelHelpers.classPrivateFieldGet(this,n).calculatePrice(t)}},{key:"calculateQuantity",value:function e(t){return babelHelpers.classPrivateFieldGet(this,n).calculateQuantity(t)}},{key:"calculateDiscount",value:function e(t){return babelHelpers.classPrivateFieldGet(this,n).calculateDiscount(t)}},{key:"calculateDiscountType",value:function e(t){return babelHelpers.classPrivateFieldGet(this,n).calculateDiscountType(t)}},{key:"calculateRowDiscount",value:function e(t){return babelHelpers.classPrivateFieldGet(this,n).calculateRowDiscount(t)}},{key:"calculateTax",value:function e(t){return babelHelpers.classPrivateFieldGet(this,n).calculateTax(t)}},{key:"calculateTaxIncluded",value:function e(t){return babelHelpers.classPrivateFieldGet(this,n).calculateTaxIncluded(t)}},{key:"calculateRowSum",value:function e(t){return babelHelpers.classPrivateFieldGet(this,n).calculateRowSum(t)}}]);return e}();babelHelpers.defineProperty(d,"DEFAULT_PRECISION",2);var h=function e(t,i){return babelHelpers.classPrivateFieldGet(this,c).hasOwnProperty(t)?babelHelpers.classPrivateFieldGet(this,c)[t]:i};var P=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"calculatePriceWithoutTax",value:function e(t,i){return t}},{key:"updateResultPrices",value:function e(t){var s;if(t.isDiscountPercentage()){s=this.calculatePriceWithoutDiscount(t.getPriceNetto(),t.getDiscountRate(),i.PERCENTAGE)}else if(t.isDiscountMonetary()){s=this.calculatePriceWithoutDiscount(t.getPriceNetto(),t.getDiscountSum(),i.MONETARY)}else{s=t.getPriceExclusive()}t.setField("PRICE_EXCLUSIVE",this.roundPrice(s));if(t.isTaxIncluded()){t.setField("PRICE",this.roundPrice(s))}else{t.setField("PRICE",this.roundPrice(this.calculatePriceWithTax(s,t.getTaxRate())))}}}]);return t}(a);e.DiscountType=i;e.ProductCalculator=d;e.TaxForSumStrategy=P;e.TaxForPriceStrategy=a})(this.BX.Catalog=this.BX.Catalog||{},BX);
//# sourceMappingURL=product.calculator.bundle.map.js