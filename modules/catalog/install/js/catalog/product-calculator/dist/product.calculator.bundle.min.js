this.BX=this.BX||{};(function(e,t,i){"use strict";var a=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(a,"UNDEFINED",0);babelHelpers.defineProperty(a,"MONETARY",1);babelHelpers.defineProperty(a,"PERCENTAGE",2);function s(e,t,i){if(e!==t){throw new TypeError("Private static access of wrong provenance")}return i}function u(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var l={QUANTITY:1,PRICE:0,PRICE_EXCLUSIVE:0,PRICE_NETTO:0,PRICE_BRUTTO:0,CUSTOMIZED:"N",DISCOUNT_TYPE_ID:a.UNDEFINED,DISCOUNT_RATE:0,DISCOUNT_SUM:0,DISCOUNT_ROW:0,TAX_INCLUDED:"N",TAX_RATE:0,TAX_SUM:0,SUM:0};var r=new WeakSet;var c=new WeakSet;var n=new WeakSet;var o=new WeakSet;var d=function(){function e(i,a){babelHelpers.classCallCheck(this,e);o.add(this);n.add(this);c.add(this);r.add(this);this.fields=babelHelpers.objectSpread({},l);if(t.Type.isPlainObject(i)){this.fields=babelHelpers.objectSpread({},this.fields,i)}this.calculator=a}babelHelpers.createClass(e,[{key:"getFields",value:function e(){return t.Runtime.clone(this.fields)}},{key:"getField",value:function e(t,i){return this.fields.hasOwnProperty(t)?this.fields[t]:i}},{key:"setField",value:function e(t,i){i=u(this,o,f).call(this,t,i);this.fields[t]=i}},{key:"getBasePrice",value:function e(){return this.getField("BASE_PRICE",0)}},{key:"getPrice",value:function e(){return this.getField("PRICE",0)}},{key:"getPriceExclusive",value:function e(){return this.getField("PRICE_EXCLUSIVE",0)}},{key:"getPriceNetto",value:function e(){return this.getField("PRICE_NETTO",0)}},{key:"getPriceBrutto",value:function e(){return this.getField("PRICE_BRUTTO",0)}},{key:"getQuantity",value:function e(){return this.getField("QUANTITY",1)}},{key:"getDiscountType",value:function e(){return this.getField("DISCOUNT_TYPE_ID",a.UNDEFINED)}},{key:"isDiscountUndefined",value:function e(){return this.getDiscountType()===a.UNDEFINED}},{key:"isDiscountPercentage",value:function e(){return this.getDiscountType()===a.PERCENTAGE}},{key:"isDiscountMonetary",value:function e(){return this.getDiscountType()===a.MONETARY}},{key:"isDiscountHandmade",value:function e(){return this.isDiscountPercentage()||this.isDiscountMonetary()}},{key:"getDiscountRate",value:function e(){return this.getField("DISCOUNT_RATE",0)}},{key:"getDiscountSum",value:function e(){return this.getField("DISCOUNT_SUM",0)}},{key:"getDiscountRow",value:function e(){return this.getField("DISCOUNT_ROW",0)}},{key:"isEmptyDiscount",value:function e(){if(this.isDiscountPercentage()){return this.getDiscountRate()===0}if(this.isDiscountMonetary()){return this.getDiscountSum()===0}return this.isDiscountUndefined()}},{key:"getTaxIncluded",value:function e(){return this.getField("TAX_INCLUDED","N")}},{key:"isTaxIncluded",value:function e(){return this.getTaxIncluded()==="Y"}},{key:"getTaxRate",value:function e(){return this.getField("TAX_RATE",0)}},{key:"getTaxSum",value:function e(){return this.getField("TAX_SUM",0)}},{key:"getSum",value:function e(){return this.getField("SUM",0)}}]);return e}();var h=function e(t){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:i.ProductCalculator.DEFAULT_PRECISION;var s=Math.pow(10,a);return Math.round(t*s)/s};var P=function e(){return this.calculator.getPricePrecision()};var T=function e(){return this.calculator.getCommonPrecision()};var g=function e(){return this.calculator.getQuantityPrecision()};var f=function e(t,i){var l=["PRICE","PRICE_EXCLUSIVE","PRICE_NETTO","PRICE_BRUTTO","DISCOUNT_SUM","DISCOUNT_ROW","TAX_SUM","SUM"];if(t==="DISCOUNT_TYPE_ID"){i=i===a.PERCENTAGE||i===a.MONETARY?i:a.UNDEFINED}else if(t==="QUANTITY"){i=s(d,d,h).call(d,i,u(this,n,g).call(this))}else if(t==="CUSTOMIZED"||t==="TAX_INCLUDED"){i=i==="Y"?"Y":"N"}else if(t==="TAX_RATE"||t==="DISCOUNT_RATE"){i=s(d,d,h).call(d,i,u(this,c,T).call(this))}else if(l.includes(t)){i=s(d,d,h).call(d,i,u(this,r,P).call(this))}return i};var v=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"calculator",null);this.calculator=t}babelHelpers.createClass(e,[{key:"getFieldStorage",value:function e(){return new d(this.calculator.getFields(),this.calculator)}},{key:"getPricePrecision",value:function e(){return this.calculator.getPricePrecision()}},{key:"getCommonPrecision",value:function e(){return this.calculator.getCommonPrecision()}},{key:"getQuantityPrecision",value:function e(){return this.calculator.getQuantityPrecision()}},{key:"calculateBasePrice",value:function e(t){if(t<0){throw new Error("Price must be equal or greater than zero.")}var i=this.getFieldStorage();i.setField("BASE_PRICE",t);if(i.isTaxIncluded()){i.setField("PRICE_BRUTTO",t)}else{i.setField("PRICE_NETTO",t)}this.updatePrice(i);this.activateCustomized(i);return i.getFields()}},{key:"calculatePrice",value:function e(t){if(t<0){throw new Error("Price must be equal or greater than zero.")}var i=this.getFieldStorage();if(t>=i.getBasePrice()){return this.calculateBasePrice(t)}this.clearResultPrices(i);if(i.isTaxIncluded()){return this.calculateRowSum(t*i.getQuantity())}var s=i.getBasePrice()-t;i.setField("DISCOUNT_TYPE_ID",a.MONETARY);return this.calculateDiscount(s,i)}},{key:"calculateQuantity",value:function e(t){if(t<0){throw new Error("Quantity must be equal or greater than zero.")}var i=this.getFieldStorage();i.setField("QUANTITY",t);this.updateRowDiscount(i);this.updateTax(i);this.updateSum(i);return i.getFields()}},{key:"calculateDiscount",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!i){i=this.getFieldStorage()}if(t===0){this.clearResultPrices(i)}else if(i.isDiscountPercentage()){i.setField("DISCOUNT_RATE",t);this.updateResultPrices(i);i.setField("DISCOUNT_SUM",i.getPriceNetto()-i.getPriceExclusive())}else if(i.isDiscountMonetary()){i.setField("DISCOUNT_SUM",t);this.updateResultPrices(i);i.setField("DISCOUNT_RATE",this.calculateDiscountRate(i.getPriceNetto(),i.getPriceExclusive()))}this.updateRowDiscount(i);this.updateTax(i);this.updateSum(i);this.activateCustomized(i);return i.getFields()}},{key:"calculateDiscountType",value:function e(t){var i=this.getFieldStorage();i.setField("DISCOUNT_TYPE_ID",t);this.updateResultPrices(i);this.updateDiscount(i);this.updateRowDiscount(i);this.updateTax(i);this.updateSum(i);this.activateCustomized(i);return i.getFields()}},{key:"calculateRowDiscount",value:function e(t){var i=this.getFieldStorage();i.setField("DISCOUNT_ROW",t);if(t!==0&&i.getQuantity()===0){i.setField("QUANTITY",1)}i.setField("DISCOUNT_TYPE_ID",a.MONETARY);if(t===0||i.getQuantity()===0){i.setField("DISCOUNT_SUM",0)}else{i.setField("DISCOUNT_SUM",i.getDiscountRow()/i.getQuantity())}this.updateResultPrices(i);this.updateDiscount(i);this.updateRowDiscount(i);this.updateTax(i);this.updateSum(i);this.activateCustomized(i);return i.getFields()}},{key:"calculateTax",value:function e(t){var i=this.getFieldStorage();i.setField("TAX_RATE",t);this.updateBasePrices(i);this.updateResultPrices(i);if(i.isTaxIncluded()){this.updateDiscount(i);this.updateRowDiscount(i)}this.updateTax(i);this.updateSum(i);this.activateCustomized(i);return i.getFields()}},{key:"calculateTaxIncluded",value:function e(t){var i=this.getFieldStorage();if(i.getTaxIncluded()!==t){i.setField("TAX_INCLUDED",t);if(i.isTaxIncluded()){i.setField("PRICE_BRUTTO",i.getPriceNetto())}else{i.setField("PRICE_NETTO",i.getPriceBrutto())}}this.updatePrice(i);this.activateCustomized(i);return i.getFields()}},{key:"calculateRowSum",value:function e(t){var i=this.getFieldStorage();i.setField("SUM",t);if(i.getQuantity()===0){i.setField("QUANTITY",1)}var s=i.getPriceNetto()-i.getSum()/(i.getQuantity()*(1+i.getTaxRate()/100));i.setField("DISCOUNT_SUM",s);i.setField("DISCOUNT_TYPE_ID",a.MONETARY);if(i.isEmptyDiscount()){this.clearResultPrices(i)}else if(i.isDiscountHandmade()){this.updateResultPrices(i)}this.updateDiscount(i);this.updateRowDiscount(i);this.updateTax(i);this.activateCustomized(i);return i.getFields()}},{key:"updatePrice",value:function e(t){this.updateBasePrices(t);if(t.isEmptyDiscount()){this.clearResultPrices(t)}else if(t.isDiscountHandmade()){this.updateResultPrices(t)}this.updateDiscount(t);this.updateRowDiscount(t);this.updateTax(t);this.updateSum(t)}},{key:"clearResultPrices",value:function e(t){t.setField("PRICE_EXCLUSIVE",t.getPriceNetto());t.setField("PRICE",t.getPriceBrutto());t.setField("DISCOUNT_RATE",0);t.setField("DISCOUNT_SUM",0)}},{key:"calculatePriceWithoutDiscount",value:function e(t,i,s){var u=0;switch(s){case a.PERCENTAGE:u=t-t*i/100;break;case a.MONETARY:u=t-i;break}return u}},{key:"updateBasePrices",value:function e(t){if(t.isTaxIncluded()){t.setField("PRICE_NETTO",this.calculatePriceWithoutTax(t.getPriceBrutto(),t.getTaxRate()))}else{t.setField("PRICE_BRUTTO",this.calculatePriceWithTax(t.getPriceNetto(),t.getTaxRate()))}}},{key:"updateResultPrices",value:function e(t){var i;if(t.isDiscountPercentage()){i=this.calculatePriceWithoutDiscount(t.getPriceNetto(),t.getDiscountRate(),a.PERCENTAGE)}else if(t.isDiscountMonetary()){i=this.calculatePriceWithoutDiscount(t.getPriceNetto(),t.getDiscountSum(),a.MONETARY)}else{i=t.getPriceExclusive()}t.setField("PRICE_EXCLUSIVE",i);t.setField("PRICE",this.calculatePriceWithTax(i,t.getTaxRate()))}},{key:"activateCustomized",value:function e(t){t.setField("CUSTOMIZED","Y")}},{key:"updateDiscount",value:function e(t){if(t.isEmptyDiscount()){this.clearResultPrices(t)}else if(t.isDiscountPercentage()){t.setField("DISCOUNT_SUM",t.getPriceNetto()-t.getPriceExclusive())}else if(t.isDiscountMonetary()){t.setField("DISCOUNT_RATE",this.calculateDiscountRate(t.getPriceNetto(),t.getPriceNetto()-t.getDiscountSum()))}}},{key:"updateRowDiscount",value:function e(t){t.setField("DISCOUNT_ROW",t.getDiscountSum()*t.getQuantity())}},{key:"updateTax",value:function e(t){var i;if(t.isTaxIncluded()){i=t.getPrice()*t.getQuantity()*(1-1/(1+t.getTaxRate()/100))}else{i=t.getPriceExclusive()*t.getQuantity()*(t.getTaxRate()/100)}t.setField("TAX_SUM",i)}},{key:"updateSum",value:function e(t){var i;if(t.isTaxIncluded()){i=t.getPrice()*t.getQuantity()}else{i=this.calculatePriceWithTax(t.getPriceExclusive()*t.getQuantity(),t.getTaxRate())}t.setField("SUM",i)}},{key:"calculateDiscountRate",value:function e(t,i){if(t===0){return 0}if(i===0){return t>0?100:-100}return(t-i)/t*100}},{key:"calculatePriceWithoutTax",value:function e(t,i){return t/(1+i/100)}},{key:"calculatePriceWithTax",value:function e(t,i){return t+t*i/100}}]);return e}();function E(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var D=new WeakMap;var y=new WeakMap;var p=new WeakMap;var R=new WeakSet;var C=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,e);R.add(this);D.set(this,{writable:true,value:{}});y.set(this,{writable:true,value:{}});p.set(this,{writable:true,value:{}});this.setFields(t);this.setSettings(i);this.setCalculationStrategy(new v(this))}babelHelpers.createClass(e,[{key:"setField",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,D)[t]=i;return this}},{key:"setCalculationStrategy",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classPrivateFieldSet(this,y,t);return this}},{key:"setFields",value:function e(t){for(var i in t){if(t.hasOwnProperty(i)){this.setField(i,t[i])}}return this}},{key:"getFields",value:function e(){return babelHelpers.objectSpread({},babelHelpers.classPrivateFieldGet(this,D))}},{key:"setSettings",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classPrivateFieldSet(this,p,babelHelpers.objectSpread({},t));return this}},{key:"getSettings",value:function e(){return babelHelpers.objectSpread({},babelHelpers.classPrivateFieldGet(this,p))}},{key:"getPricePrecision",value:function t(){return E(this,R,S).call(this,"pricePrecision",e.DEFAULT_PRECISION)}},{key:"getCommonPrecision",value:function t(){return E(this,R,S).call(this,"commonPrecision",e.DEFAULT_PRECISION)}},{key:"getQuantityPrecision",value:function t(){return E(this,R,S).call(this,"quantityPrecision",e.DEFAULT_PRECISION)}},{key:"calculateBasePrice",value:function e(t){return babelHelpers.classPrivateFieldGet(this,y).calculateBasePrice(t)}},{key:"calculatePrice",value:function e(t){return babelHelpers.classPrivateFieldGet(this,y).calculatePrice(t)}},{key:"calculateQuantity",value:function e(t){return babelHelpers.classPrivateFieldGet(this,y).calculateQuantity(t)}},{key:"calculateDiscount",value:function e(t){return babelHelpers.classPrivateFieldGet(this,y).calculateDiscount(t)}},{key:"calculateDiscountType",value:function e(t){return babelHelpers.classPrivateFieldGet(this,y).calculateDiscountType(t)}},{key:"calculateRowDiscount",value:function e(t){return babelHelpers.classPrivateFieldGet(this,y).calculateRowDiscount(t)}},{key:"calculateTax",value:function e(t){return babelHelpers.classPrivateFieldGet(this,y).calculateTax(t)}},{key:"calculateTaxIncluded",value:function e(t){return babelHelpers.classPrivateFieldGet(this,y).calculateTaxIncluded(t)}},{key:"calculateRowSum",value:function e(t){return babelHelpers.classPrivateFieldGet(this,y).calculateRowSum(t)}}]);return e}();babelHelpers.defineProperty(C,"DEFAULT_PRECISION",2);var S=function e(t,i){return babelHelpers.classPrivateFieldGet(this,p).hasOwnProperty(t)?babelHelpers.classPrivateFieldGet(this,p)[t]:i};var I=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"calculatePriceWithoutTax",value:function e(t,i){return t}},{key:"updateResultPrices",value:function e(t){var i;if(t.isDiscountPercentage()){i=this.calculatePriceWithoutDiscount(t.getPriceNetto(),t.getDiscountRate(),a.PERCENTAGE)}else if(t.isDiscountMonetary()){i=this.calculatePriceWithoutDiscount(t.getPriceNetto(),t.getDiscountSum(),a.MONETARY)}else{i=t.getPriceExclusive()}t.setField("PRICE_EXCLUSIVE",i);if(t.isTaxIncluded()){t.setField("PRICE",i)}else{t.setField("PRICE",this.calculatePriceWithTax(i,t.getTaxRate()))}}}]);return t}(v);e.DiscountType=a;e.ProductCalculator=C;e.TaxForSumStrategy=I;e.TaxForPriceStrategy=v})(this.BX.Catalog=this.BX.Catalog||{},BX,BX.Catalog);
//# sourceMappingURL=product.calculator.bundle.map.js