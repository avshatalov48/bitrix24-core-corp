{"version":3,"file":"product-model.bundle.js","sources":["../src/error-collection.js","../src/image-collection.js","../src/field-collection.js","../src/store-collection.js","../src/product-model.js"],"sourcesContent":["import {ProductModel} from \"catalog.product-model\";\n\nexport class ErrorCollection\n{\n\terrors: Map = new Map();\n\n\tconstructor(model: ProductModel = {})\n\t{\n\t\tthis.model = model;\n\t}\n\n\tgetErrors()\n\t{\n\t\treturn Object.fromEntries(this.errors);\n\t}\n\n\tsetError(code: string, text: string): ErrorCollection\n\t{\n\t\tthis.errors.set(code, {\n\t\t\tcode,\n\t\t\ttext\n\t\t});\n\t\tthis.model.onErrorCollectionChange();\n\n\t\treturn this;\n\t}\n\n\tremoveError(code: string): ErrorCollection\n\t{\n\t\tif (this.errors.has(code))\n\t\t{\n\t\t\tthis.errors.delete(code);\n\t\t}\n\t\tthis.model.onErrorCollectionChange();\n\n\t\treturn this;\n\t}\n\n\tclearErrors(): ErrorCollection\n\t{\n\t\tthis.errors.clear();\n\t\tthis.model.onErrorCollectionChange();\n\n\t\treturn this;\n\t}\n\n\thasErrors()\n\t{\n\t\treturn this.errors.size > 0;\n\t}\n}\n","import {Text, Type} from 'main.core';\nimport {ProductModel} from \"catalog.product-model\";\n\nexport class ImageCollection\n{\n\t#isEnabledSaving = false;\n\t#preview = '';\n\t#editInput = '';\n\n\tconstructor(model: ProductModel = {})\n\t{\n\t\tthis.model = model;\n\t}\n\n\tisEnableFileSaving(): boolean\n\t{\n\t\treturn this.#isEnabledSaving;\n\t}\n\n\tenableFileSaving(): void\n\t{\n\t\tthis.#isEnabledSaving = true;\n\t}\n\n\tgetMorePhotoValues(): {}\n\t{\n\t\treturn this.morePhoto;\n\t}\n\n\tsetMorePhotoValues(values): void\n\t{\n\t\tthis.morePhoto = Type.isPlainObject(values) ? values : {};\n\t}\n\n\tremoveMorePhotoItem(fileId): boolean\n\t{\n\t\tfor (const index in this.morePhoto)\n\t\t{\n\t\t\tlet value = this.morePhoto[index];\n\n\t\t\tif (!Type.isObject(value))\n\t\t\t{\n\t\t\t\tvalue = Text.toInteger(value);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t(Type.isNumber(value) && value === Text.toInteger(fileId))\n\t\t\t\t|| (Type.isObject(value) && value.fileId === fileId)\n\t\t\t)\n\t\t\t{\n\t\t\t\tdelete this.morePhoto[index];\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tsetPreview(html: string): ImageCollection\n\t{\n\t\tthis.#preview = Type.isStringFilled(html) ? html : '';\n\n\t\treturn this;\n\t}\n\n\tsetEditInput(html: string): ImageCollection\n\t{\n\t\tthis.#editInput = Type.isStringFilled(html) ? html : '';\n\n\t\treturn this;\n\t}\n\n\tgetPreview(): string\n\t{\n\t\treturn this.#preview || '';\n\t}\n\n\tgetEditInput(): string\n\t{\n\t\treturn this.#editInput || '';\n\t}\n\n\taddMorePhotoItem(fileId, value): void\n\t{\n\t\tthis.morePhoto[fileId] = value;\n\t}\n}\n","import {Type} from 'main.core';\nimport {ProductModel} from \"catalog.product-model\";\n\nexport class FieldCollection\n{\n\tchangedFields: Map = new Map();\n\tfields: Map = new Map();\n\n\tconstructor(model: ProductModel = {})\n\t{\n\t\tthis.model = model;\n\t}\n\n\tgetFields(): {}\n\t{\n\t\treturn Object.fromEntries(this.fields);\n\t}\n\n\tgetField(fieldName: string): any\n\t{\n\t\treturn this.fields.get(fieldName);\n\t}\n\n\tsetField(fieldName: string, value: any): FieldCollection\n\t{\n\t\tconst oldValue = this.fields.get(fieldName);\n\t\tthis.fields.set(fieldName, value);\n\t\tif (!this.changedFields.has(fieldName) && oldValue !== value)\n\t\t{\n\t\t\tthis.changedFields.set(fieldName, oldValue);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn (this.changedFields.size > 0);\n\t}\n\n\tclearChanged(savingFieldNames: [] = null): FieldCollection\n\t{\n\t\tif (Type.isNil(savingFieldNames))\n\t\t{\n\t\t\tthis.changedFields.clear();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsavingFieldNames.forEach((name) => {\n\t\t\t\tthis.removeFromChanged(name)\n\t\t\t});\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tremoveFromChanged(fieldName): FieldCollection\n\t{\n\t\tthis.changedFields.delete(fieldName);\n\n\t\treturn this;\n\t}\n\n\tgetChangedFields(): {}\n\t{\n\t\tconst changedFieldValues = {};\n\n\t\tthis.fields.forEach((value, key) => {\n\t\t\tif (this.changedFields.has(key))\n\t\t\t{\n\t\t\t\tchangedFieldValues[key] = value;\n\t\t\t}\n\t\t})\n\n\t\treturn {...changedFieldValues};\n\t}\n\n\tgetChangedValues(): {}\n\t{\n\t\tconst changedFieldValues = {};\n\n\t\tthis.changedFields.forEach((value, key) => {\n\t\t\tchangedFieldValues[key] = value;\n\t\t})\n\n\t\treturn {...changedFieldValues};\n\t}\n\n\tinitFields(fields): FieldCollection\n\t{\n\t\tthis.fields.clear();\n\t\tthis.clearChanged();\n\t\tif (Type.isObject(fields))\n\t\t{\n\t\t\tObject.keys(fields).forEach((key) => {\n\t\t\t\tthis.fields.set(key, fields[key])\n\t\t\t});\n\t\t}\n\n\t\treturn this;\n\t}\n}\n","import {ajax, Text, Type} from \"main.core\";\nimport {ProductModel} from \"catalog.product-model\";\n\nexport class StoreCollection\n{\n\t#map: Map = new Map();\n\n\tconstructor(model: ProductModel = {})\n\t{\n\t\tthis.model = model;\n\t}\n\n\tinit(map: {})\n\t{\n\t\tObject.keys(map).forEach((key) => {\n\t\t\tconst item = map[key];\n\t\t\tif (item['STORE_ID'] > 0)\n\t\t\t{\n\t\t\t\tthis.#map.set(\n\t\t\t\t\tText.toNumber(item['STORE_ID']),\n\t\t\t\t\t{\n\t\t\t\t\t\tAMOUNT: Text.toNumber(item['AMOUNT']),\n\t\t\t\t\t\tQUANTITY_RESERVED: Text.toNumber(item['QUANTITY_RESERVED']),\n\t\t\t\t\t\tSTORE_ID: Text.toNumber(item['STORE_ID']),\n\t\t\t\t\t\tSTORE_TITLE: Text.encode(item['STORE_TITLE']),\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t}\n\n\trefresh(): {}\n\t{\n\t\tthis.clear();\n\t\tif (this.model.getSkuId() > 0)\n\t\t{\n\t\t\tajax.runAction(\n\t\t\t\t'catalog.storeSelector.getProductStores',\n\t\t\t\t{\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tproductId: this.model.getSkuId(),\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tresponse.data.forEach((item) => {\n\t\t\t\t\t\tif (!Type.isNil(item['STORE_ID']))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#map.set(\n\t\t\t\t\t\t\t\tText.toNumber(item['STORE_ID']),\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tAMOUNT: Text.toNumber(item['AMOUNT']),\n\t\t\t\t\t\t\t\t\tQUANTITY_RESERVED: Text.toNumber(item['QUANTITY_RESERVED']),\n\t\t\t\t\t\t\t\t\tSTORE_ID: Text.toNumber(item['STORE_ID']),\n\t\t\t\t\t\t\t\t\tSTORE_TITLE: item['STORE_TITLE'],\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.model.onChangeStoreData();\n\t\t\t\t});\n\t\t}\n\t}\n\n\tgetStoreAmount(storeId): any\n\t{\n\t\treturn this.#map.get(Text.toNumber(storeId))?.AMOUNT || 0;\n\t}\n\n\tgetStoreReserved(storeId): any\n\t{\n\t\treturn this.#map.get(Text.toNumber(storeId))?.QUANTITY_RESERVED || 0;\n\t}\n\n\tgetStoreAvailableAmount(storeId): any\n\t{\n\t\treturn this.getStoreAmount(storeId) - this.getStoreReserved(storeId);\n\t}\n\n\tgetMaxFilledStore(): {}\n\t{\n\t\tlet result = {\n\t\t\t'STORE_ID': 0,\n\t\t\t'AMOUNT': 0,\n\t\t\t'STORE_TITLE': '',\n\t\t\t'QUANTITY_RESERVED': 0,\n\t\t};\n\t\tthis.#map.forEach((item) => {\n\t\t\tresult =\n\t\t\t\titem.AMOUNT > result.AMOUNT\n\t\t\t\t\t? item\n\t\t\t\t\t: result\n\t\t\t;\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tclear(): StoreCollection\n\t{\n\t\tthis.#map.clear();\n\n\t\treturn this;\n\t}\n}\n","import {ajax, Loc, Tag, Text, Type} from 'main.core';\nimport {EventEmitter} from \"main.core.events\";\nimport {ErrorCollection} from \"./error-collection\";\nimport {ImageCollection} from \"./image-collection\";\nimport {ProductOption} from \"./product-option\";\nimport {DiscountType, ProductCalculator, TaxForPriceStrategy} from \"catalog.product-calculator\";\nimport {FieldCollection} from \"./field-collection\";\nimport {StoreCollection} from \"./store-collection\";\n\nconst instances = new Map();\n\nexport class ProductModel\n{\n\t#fieldCollection = null;\n\t#errorCollection = null;\n\t#imageCollection = null;\n\t#storeCollection = null;\n\t#calculator = null;\n\t#offerId = null;\n\t#skuTree = null;\n\n\tstatic SAVE_NOTIFICATION_CATEGORY = 'MODEL_SAVE'\n\n\tstatic getById(id: string): ?ProductModel\n\t{\n\t\treturn instances.get(id) || null;\n\t}\n\n\tconstructor(options: ProductOption = {})\n\t{\n\t\tthis.options = options || {};\n\t\tthis.id = this.options.id || Text.getRandom();\n\n\t\tthis.#errorCollection = new ErrorCollection(this);\n\t\tthis.#imageCollection = new ImageCollection(this);\n\t\tthis.#fieldCollection = new FieldCollection(this);\n\t\tthis.#storeCollection = new StoreCollection(this);\n\n\t\tif (Type.isObject(options.fields))\n\t\t{\n\t\t\tthis.initFields(options.fields, false);\n\t\t}\n\n\t\tif (Type.isNil(options.storeMap))\n\t\t{\n\t\t\tthis.#storeCollection.refresh();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#storeCollection.init(options.storeMap);\n\t\t}\n\n\t\tif (Type.isObject(options.skuTree))\n\t\t{\n\t\t\tthis.setSkuTree(options.skuTree);\n\t\t}\n\n\t\tif (Type.isObject(options.imageInfo))\n\t\t{\n\t\t\t// this.getImageCollection().setMorePhotoValues(options.imageInfo.morePhoto);\n\t\t}\n\n\t\tthis.#calculator = new ProductCalculator(this.#getDefaultCalculationFields(), {\n\t\t\tcurrencyId: this.options.currency,\n\t\t\tpricePrecision: this.options.pricePrecision || 2,\n\t\t\tcommonPrecision: this.options.pricePrecision || 2,\n\t\t});\n\t\tthis.#calculator.setCalculationStrategy(new TaxForPriceStrategy(this.#calculator));\n\n\t\tinstances.set(this.id, this);\n\t}\n\n\t#getDefaultCalculationFields(): {}\n\t{\n\t\tconst defaultPrice = Text.toNumber(this.#fieldCollection.getField('PRICE'));\n\t\tconst basePrice = Type.isNumber(this.#fieldCollection.getField('BASE_PRICE'))\n\t\t\t? Text.toNumber(this.#fieldCollection.getField('BASE_PRICE'))\n\t\t\t: defaultPrice;\n\n\t\treturn {\n\t\t\t'QUANTITY': Text.toNumber(this.#fieldCollection.getField('QUANTITY')),\n\t\t\t'BASE_PRICE': basePrice,\n\t\t\t'PRICE': defaultPrice,\n\t\t\t'PRICE_NETTO': basePrice,\n\t\t\t'PRICE_BRUTTO': defaultPrice,\n\t\t\t'PRICE_EXCLUSIVE': this.#fieldCollection.getField('PRICE_EXCLUSIVE') || defaultPrice,\n\t\t\t'DISCOUNT_TYPE_ID': this.#fieldCollection.getField('DISCOUNT_TYPE_ID') || DiscountType.PERCENTAGE,\n\t\t\t'DISCOUNT_RATE': Text.toNumber(this.#fieldCollection.getField('DISCOUNT_RATE')),\n\t\t\t'DISCOUNT_SUM': Text.toNumber(this.#fieldCollection.getField('DISCOUNT_SUM')),\n\t\t\t'TAX_INCLUDED': this.#fieldCollection.getField('TAX_INCLUDED') || 'N',\n\t\t\t'TAX_RATE': Text.toNumber(this.#fieldCollection.getField('TAX_RATE')) || 0,\n\t\t\t'CUSTOMIZED': this.#fieldCollection.getField('CUSTOMIZED') || 'N',\n\t\t};\n\t}\n\n\tgetOption(name: string, defaultValue: any = null): any\n\t{\n\t\treturn this.options[name] || defaultValue\n\t}\n\n\tsetOption(name: string, value: any = null): this\n\t{\n\t\tthis.options[name] = value;\n\n\t\treturn this;\n\t}\n\n\tsetSkuTree(skuTree: {} = null): this\n\t{\n\t\tthis.#skuTree = skuTree;\n\n\t\treturn this;\n\t}\n\n\tclearSkuTree(): this\n\t{\n\t\tthis.#skuTree = null;\n\n\t\treturn this;\n\t}\n\n\tgetSkuTree(): ?{}\n\t{\n\t\treturn this.#skuTree;\n\t}\n\n\tgetCalculator(): ProductCalculator\n\t{\n\t\treturn this.#calculator;\n\t}\n\n\tgetErrorCollection(): ErrorCollection\n\t{\n\t\treturn this.#errorCollection;\n\t}\n\n\tgetImageCollection(): ImageCollection\n\t{\n\t\treturn this.#imageCollection;\n\t}\n\n\tgetFields(): {}\n\t{\n\t\treturn this.#fieldCollection.getFields();\n\t}\n\n\tgetStoreCollection(): StoreCollection\n\t{\n\t\treturn this.#storeCollection;\n\t}\n\n\tgetField(fieldName: string): any\n\t{\n\t\treturn this.#fieldCollection.getField(fieldName);\n\t}\n\n\tsetField(fieldName: string, value: any): ProductModel\n\t{\n\t\tthis.#fieldCollection.setField(fieldName, value);\n\n\t\tif (\n\t\t\t(\n\t\t\t\tfieldName === 'SKU_ID' || fieldName === 'PRODUCT_ID'\n\t\t\t)\n\t\t\t&& this.getSkuId() !== this.#offerId\n\t\t)\n\t\t{\n\t\t\tthis.#offerId = this.getSkuId();\n\t\t\tif (this.#offerId > 0)\n\t\t\t{\n\t\t\t\tthis.#storeCollection.refresh();\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetFields(fields): ProductModel\n\t{\n\t\tObject.keys(fields).forEach((key) => {\n\t\t\tthis.setField(key, fields[key]);\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tinitFields(fields: {}, refreshStoreInfo: boolean = true): ProductModel\n\t{\n\t\tthis.#fieldCollection.initFields(fields);\n\t\tthis.#offerId = this.getSkuId();\n\t\tif (refreshStoreInfo)\n\t\t{\n\t\t\tthis.#storeCollection.refresh();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tremoveField(fieldName): ProductModel\n\t{\n\t\tthis.#fieldCollection.removeField(fieldName);\n\n\t\treturn this;\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn this.#fieldCollection.isChanged();\n\t}\n\n\tisNew(): boolean\n\t{\n\t\treturn this.getOption('isNew', false);\n\t}\n\n\tgetSkuId(): ?number\n\t{\n\t\treturn this.getField('SKU_ID') || this.getProductId();\n\t}\n\n\tgetProductId(): ?number\n\t{\n\t\treturn this.getField('PRODUCT_ID') || null;\n\t}\n\n\tisCatalogExisted(): boolean\n\t{\n\t\treturn this.getSkuId() > 0;\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn this.getProductId() === null && !this.isSimple();\n\t}\n\n\tisSimple(): boolean\n\t{\n\t\treturn this.getOption('isSimpleModel', null);\n\t}\n\n\tgetIblockId(): boolean\n\t{\n\t\treturn this.getOption('iblockId', 0);\n\t}\n\n\tgetBasePriceId(): number\n\t{\n\t\treturn this.getOption('basePriceId', 0);\n\t}\n\n\tgetCurrency(): number\n\t{\n\t\treturn this.getOption('currency', null);\n\t}\n\n\tgetDetailPath(): string\n\t{\n\t\treturn this.getOption('detailPath', '');\n\t}\n\n\tsetDetailPath(value: string): void\n\t{\n\t\tthis.options['detailPath'] = value || '';\n\t}\n\n\tshowSaveNotifier(id: string, options: {})\n\t{\n\t\tif (!this.isCatalogExisted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst title = options.title || '';\n\t\tconst closeEventName = BX.UI.Notification.Event.getFullName('onClose');\n\t\tconst cancelEventName = BX.UI.Notification.Event.getFullName('onCancel');\n\n\t\tnew Promise((resolve) => {\n\t\t\tconst currentBalloon = BX.UI.Notification.Center.getBalloonByCategory(ProductModel.SAVE_NOTIFICATION_CATEGORY);\n\t\t\tif (currentBalloon && currentBalloon.getId() !== id)\n\t\t\t{\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tcurrentBalloon.close();\n\t\t\t\t\tsetTimeout(resolve, 400);\n\t\t\t\t}, 200);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(id);\n\t\t\t\tif (!notify)\n\t\t\t\t{\n\t\t\t\t\tconst notificationOptions = {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\tcategory: ProductModel.SAVE_NOTIFICATION_CATEGORY,\n\t\t\t\t\t\tautoHideDelay: 4000,\n\t\t\t\t\t\tcontent: Tag.render`<div>${title}</div>`,\n\n\t\t\t\t\t};\n\n\t\t\t\t\tif (options.disableCancel !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\tnotificationOptions.actions = [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: options.declineCancelTitle || Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_DECLINE_SAVE'),\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tclick: (event, balloon) => {\n\t\t\t\t\t\t\t\t\t\tBX.removeAllCustomEvents(notify, closeEventName);\n\t\t\t\t\t\t\t\t\t\tballoon.fireEvent('onCancel');\n\t\t\t\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\n\t\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t\t}\n\n\t\t\t\tBX.removeAllCustomEvents(notify, closeEventName);\n\t\t\t\tnotify.addEvent('onClose', () => {\n\t\t\t\t\tif (Type.isFunction(options?.events?.onSave))\n\t\t\t\t\t{\n\t\t\t\t\t\t(options.events.onSave)();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tBX.removeAllCustomEvents(notify, cancelEventName);\n\t\t\t\tnotify.addEvent('onCancel', () => {\n\t\t\t\t\tif (Type.isFunction(options?.events?.onCancel))\n\t\t\t\t\t{\n\t\t\t\t\t\t(options.events.onCancel)();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tnotify.show();\n\t\t\t});\n\t}\n\n\tstatic getLastActiveSaveNotification(): ?BX.UI.Notification.Balloon\n\t{\n\t\treturn BX.UI.Notification.Center.getBalloonByCategory(ProductModel.SAVE_NOTIFICATION_CATEGORY);\n\t}\n\n\tsave(savingFieldNames: []): ?Promise\n\t{\n\t\tif (!this.isSaveable())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet ajaxResult;\n\t\t\tif (this.isSimple())\n\t\t\t{\n\t\t\t\tajaxResult = this.#createProduct();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tajaxResult = this.#updateProduct(savingFieldNames);\n\t\t\t}\n\n\t\t\tajaxResult\n\t\t\t\t.then((event) => {\n\t\t\t\t\tthis.#fieldCollection.clearChanged(savingFieldNames);\n\t\t\t\t\tresolve(event);\n\t\t\t\t})\n\t\t\t\t.catch(reject)\n\t\t});\n\t}\n\n\tisSaveable()\n\t{\n\t\treturn this.getOption('isSaveable', true) && !this.isEmpty();\n\t}\n\n\tonErrorCollectionChange()\n\t{\n\t\tEventEmitter.emit(this,'onErrorsChange');\n\t}\n\n\tonChangeStoreData()\n\t{\n\t\tEventEmitter.emit(this,'onChangeStoreData');\n\t}\n\n\t#updateProduct(savingFieldNames: [])\n\t{\n\t\tif (this.getIblockId() <= 0 || !this.#fieldCollection.isChanged())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet savedFields = {};\n\t\tif (!Type.isArray(savingFieldNames) || savingFieldNames.length === 0)\n\t\t{\n\t\t\tsavedFields = this.#fieldCollection.getChangedFields();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst changedFields = this.#fieldCollection.getChangedFields();\n\t\t\tObject.keys(changedFields).forEach((key) => {\n\t\t\t\tif (savingFieldNames.includes(key))\n\t\t\t\t{\n\t\t\t\t\tif (key === 'PRICE' || key === 'BASE_PRICE')\n\t\t\t\t\t{\n\t\t\t\t\t\tsavedFields['PRICES'] = savedFields['PRICES'] || {};\n\t\t\t\t\t\tsavedFields['PRICES'][this.getBasePriceId()] = {\n\t\t\t\t\t\t\tPRICE: changedFields[key],\n\t\t\t\t\t\t\tCURRENCY: this.getCurrency(),\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tsavedFields[key] = changedFields[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn ajax.runAction(\n\t\t\t'catalog.productSelector.updateSku',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\tid: this.getSkuId(),\n\t\t\t\t\tupdateFields: savedFields,\n\t\t\t\t\toldFields: this.#fieldCollection.getChangedValues(),\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t#createProduct(): Promise\n\t{\n\t\tconst fields = {\n\t\t\tNAME: this.#fieldCollection.getField('NAME', ''),\n\t\t\tIBLOCK_ID: this.getIblockId()\n\t\t};\n\n\t\tconst price = this.#fieldCollection.getField('BASE_PRICE', null);\n\t\tif (!Type.isNil(price))\n\t\t{\n\t\t\tfields['PRICE'] = price;\n\t\t}\n\n\t\tconst barcode = this.#fieldCollection.getField('BARCODE', null);\n\t\tif (!Type.isNil(barcode))\n\t\t{\n\t\t\tfields['BARCODE'] = barcode;\n\t\t}\n\n\t\tfields['CURRENCY'] = this.getCurrency();\n\t\tconst currency = this.#fieldCollection.getField('CURRENCY', null);\n\t\tif (Type.isStringFilled(currency))\n\t\t{\n\t\t\tfields['CURRENCY'] = currency;\n\t\t}\n\n\t\treturn ajax.runAction(\n\t\t\t'catalog.productSelector.createProduct',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\tfields\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t}\n}\n"],"names":["ErrorCollection","model","Map","Object","fromEntries","errors","code","text","set","onErrorCollectionChange","has","clear","size","ImageCollection","morePhoto","values","Type","isPlainObject","fileId","index","value","isObject","Text","toInteger","isNumber","html","isStringFilled","FieldCollection","fields","fieldName","get","oldValue","changedFields","savingFieldNames","isNil","forEach","name","removeFromChanged","changedFieldValues","key","clearChanged","keys","StoreCollection","_classPrivateFieldInitSpec","map","item","toNumber","AMOUNT","QUANTITY_RESERVED","STORE_ID","STORE_TITLE","encode","getSkuId","ajax","runAction","json","productId","then","response","data","onChangeStoreData","storeId","getStoreAmount","getStoreReserved","result","instances","ProductModel","id","options","getRandom","initFields","storeMap","refresh","init","skuTree","setSkuTree","imageInfo","ProductCalculator","currencyId","currency","pricePrecision","commonPrecision","setCalculationStrategy","TaxForPriceStrategy","defaultValue","getFields","getField","setField","refreshStoreInfo","removeField","isChanged","getOption","getProductId","isSimple","isCatalogExisted","title","closeEventName","BX","UI","Notification","Event","getFullName","cancelEventName","Promise","resolve","currentBalloon","Center","getBalloonByCategory","SAVE_NOTIFICATION_CATEGORY","getId","setTimeout","close","notify","getBalloonById","notificationOptions","closeButton","category","autoHideDelay","content","Tag","render","disableCancel","actions","declineCancelTitle","Loc","getMessage","events","click","event","balloon","removeAllCustomEvents","fireEvent","addEvent","isFunction","onSave","onCancel","show","isSaveable","reject","ajaxResult","isEmpty","EventEmitter","emit","defaultPrice","basePrice","DiscountType","PERCENTAGE","getIblockId","savedFields","isArray","length","getChangedFields","includes","getBasePriceId","PRICE","CURRENCY","getCurrency","updateFields","oldFields","getChangedValues","NAME","IBLOCK_ID","price","barcode"],"mappings":"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"}