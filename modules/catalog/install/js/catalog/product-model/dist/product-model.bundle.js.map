{"version":3,"file":"product-model.bundle.js","sources":["../src/error-collection.js","../src/image-collection.js","../src/field-collection.js","../src/store-collection.js","../src/product-model.js"],"sourcesContent":["import {ProductModel} from \"catalog.product-model\";\n\nexport class ErrorCollection\n{\n\terrors: Map = new Map();\n\n\tconstructor(model: ProductModel = {})\n\t{\n\t\tthis.model = model;\n\t}\n\n\tgetErrors()\n\t{\n\t\treturn Object.fromEntries(this.errors);\n\t}\n\n\tsetError(code: string, text: string): ErrorCollection\n\t{\n\t\tthis.errors.set(code, {\n\t\t\tcode,\n\t\t\ttext\n\t\t});\n\t\tthis.model.onErrorCollectionChange();\n\n\t\treturn this;\n\t}\n\n\tremoveError(code: string): ErrorCollection\n\t{\n\t\tif (this.errors.has(code))\n\t\t{\n\t\t\tthis.errors.delete(code, text);\n\t\t}\n\t\tthis.model.onErrorCollectionChange();\n\n\t\treturn this;\n\t}\n\n\tclearErrors(): ErrorCollection\n\t{\n\t\tthis.errors.clear();\n\t\tthis.model.onErrorCollectionChange();\n\n\t\treturn this;\n\t}\n\n\thasErrors()\n\t{\n\t\treturn this.errors.size > 0;\n\t}\n}\n","import {Text, Type} from 'main.core';\nimport {ProductModel} from \"catalog.product-model\";\n\nexport class ImageCollection\n{\n\t#isEnabledSaving = false;\n\t#preview = '';\n\t#editInput = '';\n\n\tconstructor(model: ProductModel = {})\n\t{\n\t\tthis.model = model;\n\t}\n\n\tisEnableFileSaving(): boolean\n\t{\n\t\treturn this.#isEnabledSaving;\n\t}\n\n\tenableFileSaving(): void\n\t{\n\t\tthis.#isEnabledSaving = true;\n\t}\n\n\tgetMorePhotoValues(): {}\n\t{\n\t\treturn this.morePhoto;\n\t}\n\n\tsetMorePhotoValues(values): void\n\t{\n\t\tthis.morePhoto = Type.isPlainObject(values) ? values : {};\n\t}\n\n\tremoveMorePhotoItem(fileId): boolean\n\t{\n\t\tfor (const index in this.morePhoto)\n\t\t{\n\t\t\tlet value = this.morePhoto[index];\n\n\t\t\tif (!Type.isObject(value))\n\t\t\t{\n\t\t\t\tvalue = Text.toInteger(value);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t(Type.isNumber(value) && value === Text.toInteger(fileId))\n\t\t\t\t|| (Type.isObject(value) && value.fileId === fileId)\n\t\t\t)\n\t\t\t{\n\t\t\t\tdelete this.morePhoto[index];\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tsetPreview(html: string): ImageCollection\n\t{\n\t\tthis.#preview = Type.isStringFilled(html) ? html : '';\n\n\t\treturn this;\n\t}\n\n\tsetEditInput(html: string): ImageCollection\n\t{\n\t\tthis.#editInput = Type.isStringFilled(html) ? html : '';\n\n\t\treturn this;\n\t}\n\n\tgetPreview(): string\n\t{\n\t\treturn this.#preview || '';\n\t}\n\n\tgetEditInput(): string\n\t{\n\t\treturn this.#editInput || '';\n\t}\n\n\taddMorePhotoItem(fileId, value): void\n\t{\n\t\tthis.morePhoto[fileId] = value;\n\t}\n}\n","import {Type} from 'main.core';\nimport {ProductModel} from \"catalog.product-model\";\n\nexport class FieldCollection\n{\n\tchangedFields: Map = new Map();\n\tfields: Map = new Map();\n\n\tconstructor(model: ProductModel = {})\n\t{\n\t\tthis.model = model;\n\t}\n\n\tgetFields(): {}\n\t{\n\t\treturn Object.fromEntries(this.fields);\n\t}\n\n\tgetField(fieldName: string): any\n\t{\n\t\treturn this.fields.get(fieldName);\n\t}\n\n\tsetField(fieldName: string, value: any): FieldCollection\n\t{\n\t\tconst oldValue = this.fields.get(fieldName);\n\t\tthis.fields.set(fieldName, value);\n\t\tif (!this.changedFields.has(fieldName) && oldValue !== value)\n\t\t{\n\t\t\tthis.changedFields.set(fieldName, oldValue);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn (this.changedFields.size > 0);\n\t}\n\n\tclearChanged(savingFieldNames: [] = null): FieldCollection\n\t{\n\t\tif (Type.isNil(savingFieldNames))\n\t\t{\n\t\t\tthis.changedFields.clear();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsavingFieldNames.forEach((name) => {\n\t\t\t\tthis.removeFromChanged(name)\n\t\t\t});\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tremoveFromChanged(fieldName): FieldCollection\n\t{\n\t\tthis.changedFields.delete(fieldName);\n\n\t\treturn this;\n\t}\n\n\tgetChangedFields(): {}\n\t{\n\t\tconst changedFieldValues = {};\n\n\t\tthis.fields.forEach((value, key) => {\n\t\t\tif (this.changedFields.has(key))\n\t\t\t{\n\t\t\t\tchangedFieldValues[key] = value;\n\t\t\t}\n\t\t})\n\n\t\treturn {...changedFieldValues};\n\t}\n\n\tgetChangedValues(): {}\n\t{\n\t\tconst changedFieldValues = {};\n\n\t\tthis.changedFields.forEach((value, key) => {\n\t\t\tchangedFieldValues[key] = value;\n\t\t})\n\n\t\treturn {...changedFieldValues};\n\t}\n\n\tinitFields(fields): FieldCollection\n\t{\n\t\tthis.fields.clear();\n\t\tthis.clearChanged();\n\t\tif (Type.isObject(fields))\n\t\t{\n\t\t\tObject.keys(fields).forEach((key) => {\n\t\t\t\tthis.fields.set(key, fields[key])\n\t\t\t});\n\t\t}\n\n\t\treturn this;\n\t}\n}\n","import {ajax, Text, Type} from \"main.core\";\nimport {ProductModel} from \"catalog.product-model\";\n\nexport class StoreCollection\n{\n\t#map: Map = new Map();\n\n\tconstructor(model: ProductModel = {})\n\t{\n\t\tthis.model = model;\n\t}\n\n\tinit(map: {})\n\t{\n\t\tObject.keys(map).forEach((key) => {\n\t\t\tconst item = map[key];\n\t\t\tif (item['STORE_ID'] > 0)\n\t\t\t{\n\t\t\t\tthis.#map.set(\n\t\t\t\t\tText.toNumber(item['STORE_ID']),\n\t\t\t\t\t{\n\t\t\t\t\t\tAMOUNT: Text.toNumber(item['AMOUNT']),\n\t\t\t\t\t\tQUANTITY_RESERVED: Text.toNumber(item['QUANTITY_RESERVED']),\n\t\t\t\t\t\tSTORE_ID: Text.toNumber(item['STORE_ID']),\n\t\t\t\t\t\tSTORE_TITLE: Text.encode(item['STORE_TITLE']),\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t}\n\n\trefresh(): {}\n\t{\n\t\tthis.clear();\n\t\tif (this.model.getSkuId() > 0)\n\t\t{\n\t\t\tajax.runAction(\n\t\t\t\t'catalog.storeSelector.getProductStores',\n\t\t\t\t{\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tproductId: this.model.getSkuId(),\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tresponse.data.forEach((item) => {\n\t\t\t\t\t\tif (!Type.isNil(item['STORE_ID']))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#map.set(\n\t\t\t\t\t\t\t\tText.toNumber(item['STORE_ID']),\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tAMOUNT: Text.toNumber(item['AMOUNT']),\n\t\t\t\t\t\t\t\t\tQUANTITY_RESERVED: Text.toNumber(item['QUANTITY_RESERVED']),\n\t\t\t\t\t\t\t\t\tSTORE_ID: Text.toNumber(item['STORE_ID']),\n\t\t\t\t\t\t\t\t\tSTORE_TITLE: item['STORE_TITLE'],\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.model.onChangeStoreData();\n\t\t\t\t});\n\t\t}\n\t}\n\n\tgetStoreAmount(storeId): any\n\t{\n\t\treturn this.#map.get(Text.toNumber(storeId))?.AMOUNT || 0;\n\t}\n\n\tgetStoreReserved(storeId): any\n\t{\n\t\treturn this.#map.get(Text.toNumber(storeId))?.QUANTITY_RESERVED || 0;\n\t}\n\n\tgetStoreAvailableAmount(storeId): any\n\t{\n\t\treturn this.getStoreAmount(storeId) - this.getStoreReserved(storeId);\n\t}\n\n\tgetMaxFilledStore(): {}\n\t{\n\t\tlet result = {\n\t\t\t'STORE_ID': 0,\n\t\t\t'AMOUNT': 0,\n\t\t\t'STORE_TITLE': '',\n\t\t\t'QUANTITY_RESERVED': 0,\n\t\t};\n\t\tthis.#map.forEach((item) => {\n\t\t\tresult =\n\t\t\t\titem.AMOUNT > result.AMOUNT\n\t\t\t\t\t? item\n\t\t\t\t\t: result\n\t\t\t;\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tclear(): StoreCollection\n\t{\n\t\tthis.#map.clear();\n\n\t\treturn this;\n\t}\n}\n","import {ajax, Loc, Tag, Text, Type} from 'main.core';\nimport {EventEmitter} from \"main.core.events\";\nimport {ErrorCollection} from \"./error-collection\";\nimport {ImageCollection} from \"./image-collection\";\nimport {ProductOption} from \"./product-option\";\nimport {DiscountType, ProductCalculator, TaxForPriceStrategy} from \"catalog.product-calculator\";\nimport {FieldCollection} from \"./field-collection\";\nimport {StoreCollection} from \"./store-collection\";\n\nconst instances = new Map();\n\nexport class ProductModel\n{\n\t#fieldCollection = null;\n\t#errorCollection = null;\n\t#imageCollection = null;\n\t#storeCollection = null;\n\t#calculator = null;\n\t#offerId = null;\n\t#skuTree = null;\n\n\tstatic SAVE_NOTIFICATION_CATEGORY = 'MODEL_SAVE'\n\n\tstatic getById(id: string): ?ProductModel\n\t{\n\t\treturn instances.get(id) || null;\n\t}\n\n\tconstructor(options: ProductOption = {})\n\t{\n\t\tthis.options = options || {};\n\t\tthis.id = this.options.id || Text.getRandom();\n\n\t\tthis.#errorCollection = new ErrorCollection(this);\n\t\tthis.#imageCollection = new ImageCollection(this);\n\t\tthis.#fieldCollection = new FieldCollection(this);\n\t\tthis.#storeCollection = new StoreCollection(this);\n\n\t\tif (Type.isObject(options.fields))\n\t\t{\n\t\t\tthis.initFields(options.fields, false);\n\t\t}\n\n\t\tif (Type.isNil(options.storeMap))\n\t\t{\n\t\t\tthis.#storeCollection.refresh();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#storeCollection.init(options.storeMap);\n\t\t}\n\n\t\tif (Type.isObject(options.skuTree))\n\t\t{\n\t\t\tthis.setSkuTree(options.skuTree);\n\t\t}\n\n\t\tif (Type.isObject(options.imageInfo))\n\t\t{\n\t\t\t// this.getImageCollection().setMorePhotoValues(options.imageInfo.morePhoto);\n\t\t}\n\n\t\tthis.#calculator = new ProductCalculator(this.#getDefaultCalculationFields(), {\n\t\t\tcurrencyId: this.options.currency,\n\t\t\tpricePrecision: this.options.pricePrecision || 2,\n\t\t\tcommonPrecision: this.options.pricePrecision || 2,\n\t\t});\n\t\tthis.#calculator.setCalculationStrategy(new TaxForPriceStrategy(this.#calculator));\n\n\t\tinstances.set(this.id, this);\n\t}\n\n\t#getDefaultCalculationFields(): {}\n\t{\n\t\tconst defaultPrice = Text.toNumber(this.#fieldCollection.getField('PRICE'));\n\t\tconst basePrice = Type.isNumber(this.#fieldCollection.getField('BASE_PRICE'))\n\t\t\t? Text.toNumber(this.#fieldCollection.getField('BASE_PRICE'))\n\t\t\t: defaultPrice;\n\n\t\treturn {\n\t\t\t'QUANTITY': Text.toNumber(this.#fieldCollection.getField('QUANTITY')),\n\t\t\t'BASE_PRICE': basePrice,\n\t\t\t'PRICE': defaultPrice,\n\t\t\t'PRICE_NETTO': basePrice,\n\t\t\t'PRICE_BRUTTO': defaultPrice,\n\t\t\t'PRICE_EXCLUSIVE': this.#fieldCollection.getField('PRICE_EXCLUSIVE') || defaultPrice,\n\t\t\t'DISCOUNT_TYPE_ID': this.#fieldCollection.getField('DISCOUNT_TYPE_ID') || DiscountType.PERCENTAGE,\n\t\t\t'DISCOUNT_RATE': Text.toNumber(this.#fieldCollection.getField('DISCOUNT_RATE')),\n\t\t\t'DISCOUNT_SUM': Text.toNumber(this.#fieldCollection.getField('DISCOUNT_SUM')),\n\t\t\t'TAX_INCLUDED': this.#fieldCollection.getField('TAX_INCLUDED') || 'N',\n\t\t\t'TAX_RATE': Text.toNumber(this.#fieldCollection.getField('TAX_RATE')) || 0,\n\t\t\t'CUSTOMIZED': this.#fieldCollection.getField('CUSTOMIZED') || 'N',\n\t\t};\n\t}\n\n\tgetOption(name: string, defaultValue: any = null): any\n\t{\n\t\treturn this.options[name] || defaultValue\n\t}\n\n\tsetOption(name: string, value: any = null): this\n\t{\n\t\tthis.options[name] = value;\n\n\t\treturn this;\n\t}\n\n\tsetSkuTree(skuTree: {} = null): this\n\t{\n\t\tthis.#skuTree = skuTree;\n\n\t\treturn this;\n\t}\n\n\tclearSkuTree(): this\n\t{\n\t\tthis.#skuTree = null;\n\n\t\treturn this;\n\t}\n\n\tgetSkuTree(): ?{}\n\t{\n\t\treturn this.#skuTree;\n\t}\n\n\tgetCalculator(): ProductCalculator\n\t{\n\t\treturn this.#calculator;\n\t}\n\n\tgetErrorCollection(): ErrorCollection\n\t{\n\t\treturn this.#errorCollection;\n\t}\n\n\tgetImageCollection(): ImageCollection\n\t{\n\t\treturn this.#imageCollection;\n\t}\n\n\tgetFields(): {}\n\t{\n\t\treturn this.#fieldCollection.getFields();\n\t}\n\n\tgetStoreCollection(): StoreCollection\n\t{\n\t\treturn this.#storeCollection;\n\t}\n\n\tgetField(fieldName: string): any\n\t{\n\t\treturn this.#fieldCollection.getField(fieldName);\n\t}\n\n\tsetField(fieldName: string, value: any): ProductModel\n\t{\n\t\tthis.#fieldCollection.setField(fieldName, value);\n\n\t\tif (\n\t\t\t(\n\t\t\t\tfieldName === 'SKU_ID' || fieldName === 'PRODUCT_ID'\n\t\t\t)\n\t\t\t&& this.getSkuId() !== this.#offerId\n\t\t)\n\t\t{\n\t\t\tthis.#offerId = this.getSkuId();\n\t\t\tif (this.#offerId > 0)\n\t\t\t{\n\t\t\t\tthis.#storeCollection.refresh();\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetFields(fields): ProductModel\n\t{\n\t\tObject.keys(fields).forEach((key) => {\n\t\t\tthis.setField(key, fields[key]);\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tinitFields(fields: {}, refreshStoreInfo: boolean = true): ProductModel\n\t{\n\t\tthis.#fieldCollection.initFields(fields);\n\t\tthis.#offerId = this.getSkuId();\n\t\tif (refreshStoreInfo)\n\t\t{\n\t\t\tthis.#storeCollection.refresh();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tremoveField(fieldName): ProductModel\n\t{\n\t\tthis.#fieldCollection.removeField(fieldName);\n\n\t\treturn this;\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn this.#fieldCollection.isChanged();\n\t}\n\n\tisNew(): boolean\n\t{\n\t\treturn this.getOption('isNew', false);\n\t}\n\n\tgetSkuId(): ?number\n\t{\n\t\treturn this.getField('SKU_ID') || this.getProductId();\n\t}\n\n\tgetProductId(): ?number\n\t{\n\t\treturn this.getField('PRODUCT_ID') || null;\n\t}\n\n\tisCatalogExisted(): boolean\n\t{\n\t\treturn this.getSkuId() > 0;\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn this.getProductId() === null && !this.isSimple();\n\t}\n\n\tisSimple(): boolean\n\t{\n\t\treturn this.getOption('isSimpleModel', null);\n\t}\n\n\tgetIblockId(): boolean\n\t{\n\t\treturn this.getOption('iblockId', 0);\n\t}\n\n\tgetBasePriceId(): number\n\t{\n\t\treturn this.getOption('basePriceId', 0);\n\t}\n\n\tgetCurrency(): number\n\t{\n\t\treturn this.getOption('currency', null);\n\t}\n\n\tgetDetailPath(): string\n\t{\n\t\treturn this.getOption('detailPath', '');\n\t}\n\n\tsetDetailPath(value: string): void\n\t{\n\t\tthis.options['detailPath'] = value || '';\n\t}\n\n\tshowSaveNotifier(id: string, options: {})\n\t{\n\t\tif (!this.isCatalogExisted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst title = options.title || '';\n\t\tconst closeEventName = BX.UI.Notification.Event.getFullName('onClose');\n\t\tconst cancelEventName = BX.UI.Notification.Event.getFullName('onCancel');\n\n\t\tnew Promise((resolve) => {\n\t\t\tconst currentBalloon = BX.UI.Notification.Center.getBalloonByCategory(ProductModel.SAVE_NOTIFICATION_CATEGORY);\n\t\t\tif (currentBalloon && currentBalloon.getId() !== id)\n\t\t\t{\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tcurrentBalloon.close();\n\t\t\t\t\tsetTimeout(resolve, 400);\n\t\t\t\t}, 200);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(id);\n\t\t\t\tif (!notify)\n\t\t\t\t{\n\t\t\t\t\tconst notificationOptions = {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\tcategory: ProductModel.SAVE_NOTIFICATION_CATEGORY,\n\t\t\t\t\t\tautoHideDelay: 4000,\n\t\t\t\t\t\tcontent: Tag.render`<div>${title}</div>`,\n\n\t\t\t\t\t};\n\n\t\t\t\t\tif (options.disableCancel !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\tnotificationOptions.actions = [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: options.declineCancelTitle || Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_DECLINE_SAVE'),\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tclick: (event, balloon) => {\n\t\t\t\t\t\t\t\t\t\tBX.removeAllCustomEvents(notify, closeEventName);\n\t\t\t\t\t\t\t\t\t\tballoon.fireEvent('onCancel');\n\t\t\t\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\n\t\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t\t}\n\n\t\t\t\tBX.removeAllCustomEvents(notify, closeEventName);\n\t\t\t\tnotify.addEvent('onClose', () => {\n\t\t\t\t\tif (Type.isFunction(options?.events?.onSave))\n\t\t\t\t\t{\n\t\t\t\t\t\t(options.events.onSave)();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tBX.removeAllCustomEvents(notify, cancelEventName);\n\t\t\t\tnotify.addEvent('onCancel', () => {\n\t\t\t\t\tif (Type.isFunction(options?.events?.onCancel))\n\t\t\t\t\t{\n\t\t\t\t\t\t(options.events.onCancel)();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tnotify.show();\n\t\t\t});\n\t}\n\n\tstatic getLastActiveSaveNotification(): ?BX.UI.Notification.Balloon\n\t{\n\t\treturn BX.UI.Notification.Center.getBalloonByCategory(ProductModel.SAVE_NOTIFICATION_CATEGORY);\n\t}\n\n\tsave(savingFieldNames: []): ?Promise\n\t{\n\t\tif (!this.isSaveable())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet ajaxResult;\n\t\t\tif (this.isSimple())\n\t\t\t{\n\t\t\t\tajaxResult = this.#createProduct();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tajaxResult = this.#updateProduct(savingFieldNames);\n\t\t\t}\n\n\t\t\tajaxResult\n\t\t\t\t.then((event) => {\n\t\t\t\t\tthis.#fieldCollection.clearChanged(savingFieldNames);\n\t\t\t\t\tresolve(event);\n\t\t\t\t})\n\t\t\t\t.catch(reject)\n\t\t});\n\t}\n\n\tisSaveable()\n\t{\n\t\treturn this.getOption('isSaveable', true) && !this.isEmpty();\n\t}\n\n\tonErrorCollectionChange()\n\t{\n\t\tEventEmitter.emit(this,'onErrorsChange');\n\t}\n\n\tonChangeStoreData()\n\t{\n\t\tEventEmitter.emit(this,'onChangeStoreData');\n\t}\n\n\t#updateProduct(savingFieldNames: [])\n\t{\n\t\tif (this.getIblockId() <= 0 || !this.#fieldCollection.isChanged())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet savedFields = {};\n\t\tif (!Type.isArray(savingFieldNames) || savingFieldNames.length === 0)\n\t\t{\n\t\t\tsavedFields = this.#fieldCollection.getChangedFields();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst changedFields = this.#fieldCollection.getChangedFields();\n\t\t\tObject.keys(changedFields).forEach((key) => {\n\t\t\t\tif (savingFieldNames.includes(key))\n\t\t\t\t{\n\t\t\t\t\tif (key === 'PRICE' || key === 'BASE_PRICE')\n\t\t\t\t\t{\n\t\t\t\t\t\tsavedFields['PRICES'] = savedFields['PRICES'] || {};\n\t\t\t\t\t\tsavedFields['PRICES'][this.getBasePriceId()] = {\n\t\t\t\t\t\t\tPRICE: changedFields[key],\n\t\t\t\t\t\t\tCURRENCY: this.getCurrency(),\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tsavedFields[key] = changedFields[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn ajax.runAction(\n\t\t\t'catalog.productSelector.updateSku',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\tid: this.getSkuId(),\n\t\t\t\t\tupdateFields: savedFields,\n\t\t\t\t\toldFields: this.#fieldCollection.getChangedValues(),\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t#createProduct(): Promise\n\t{\n\t\tconst fields = {\n\t\t\tNAME: this.#fieldCollection.getField('NAME', ''),\n\t\t\tIBLOCK_ID: this.getIblockId()\n\t\t};\n\n\t\tconst price = this.#fieldCollection.getField('BASE_PRICE', null);\n\t\tif (!Type.isNil(price))\n\t\t{\n\t\t\tfields['PRICE'] = price;\n\t\t}\n\n\t\tconst barcode = this.#fieldCollection.getField('BARCODE', null);\n\t\tif (!Type.isNil(barcode))\n\t\t{\n\t\t\tfields['BARCODE'] = barcode;\n\t\t}\n\n\t\tfields['CURRENCY'] = this.getCurrency();\n\t\tconst currency = this.#fieldCollection.getField('CURRENCY', null);\n\t\tif (Type.isStringFilled(currency))\n\t\t{\n\t\t\tfields['CURRENCY'] = currency;\n\t\t}\n\n\t\treturn ajax.runAction(\n\t\t\t'catalog.productSelector.createProduct',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\tfields\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t}\n}\n"],"names":["ErrorCollection","model","Map","Object","fromEntries","errors","code","text","set","onErrorCollectionChange","has","delete","clear","size","ImageCollection","morePhoto","values","Type","isPlainObject","fileId","index","value","isObject","Text","toInteger","isNumber","html","isStringFilled","FieldCollection","fields","fieldName","get","oldValue","changedFields","savingFieldNames","isNil","forEach","name","removeFromChanged","changedFieldValues","key","clearChanged","keys","StoreCollection","map","item","toNumber","AMOUNT","QUANTITY_RESERVED","STORE_ID","STORE_TITLE","encode","getSkuId","ajax","runAction","json","productId","then","response","data","onChangeStoreData","storeId","getStoreAmount","getStoreReserved","result","instances","ProductModel","id","options","getRandom","initFields","storeMap","refresh","init","skuTree","setSkuTree","imageInfo","ProductCalculator","currencyId","currency","pricePrecision","commonPrecision","setCalculationStrategy","TaxForPriceStrategy","defaultValue","getFields","getField","setField","refreshStoreInfo","removeField","isChanged","getOption","getProductId","isSimple","isCatalogExisted","title","closeEventName","BX","UI","Notification","Event","getFullName","cancelEventName","Promise","resolve","currentBalloon","Center","getBalloonByCategory","SAVE_NOTIFICATION_CATEGORY","getId","setTimeout","close","notify","getBalloonById","notificationOptions","closeButton","category","autoHideDelay","content","Tag","render","disableCancel","actions","declineCancelTitle","Loc","getMessage","events","click","event","balloon","removeAllCustomEvents","fireEvent","addEvent","isFunction","onSave","onCancel","show","isSaveable","reject","ajaxResult","catch","isEmpty","EventEmitter","emit","defaultPrice","basePrice","DiscountType","PERCENTAGE","getIblockId","savedFields","isArray","length","getChangedFields","includes","getBasePriceId","PRICE","CURRENCY","getCurrency","updateFields","oldFields","getChangedValues","NAME","IBLOCK_ID","price","barcode"],"mappings":";;;;KAEaA,eAAb;CAIC,6BACA;CAAA,QADYC,KACZ,uEADkC,EAClC;CAAA;CAAA,gDAHc,IAAIC,GAAJ,EAGd;CACC,SAAKD,KAAL,GAAaA,KAAb;CACA;;CAPF;CAAA;CAAA,gCAUC;CACC,aAAOE,MAAM,CAACC,WAAP,CAAmB,KAAKC,MAAxB,CAAP;CACA;CAZF;CAAA;CAAA,6BAcUC,IAdV,EAcwBC,IAdxB,EAeC;CACC,WAAKF,MAAL,CAAYG,GAAZ,CAAgBF,IAAhB,EAAsB;CACrBA,QAAAA,IAAI,EAAJA,IADqB;CAErBC,QAAAA,IAAI,EAAJA;CAFqB,OAAtB;CAIA,WAAKN,KAAL,CAAWQ,uBAAX;CAEA,aAAO,IAAP;CACA;CAvBF;CAAA;CAAA,gCAyBaH,IAzBb,EA0BC;CACC,UAAI,KAAKD,MAAL,CAAYK,GAAZ,CAAgBJ,IAAhB,CAAJ,EACA;CACC,aAAKD,MAAL,CAAYM,MAAZ,CAAmBL,IAAnB,EAAyBC,IAAzB;CACA;;CACD,WAAKN,KAAL,CAAWQ,uBAAX;CAEA,aAAO,IAAP;CACA;CAlCF;CAAA;CAAA,kCAqCC;CACC,WAAKJ,MAAL,CAAYO,KAAZ;CACA,WAAKX,KAAL,CAAWQ,uBAAX;CAEA,aAAO,IAAP;CACA;CA1CF;CAAA;CAAA,gCA6CC;CACC,aAAO,KAAKJ,MAAL,CAAYQ,IAAZ,GAAmB,CAA1B;CACA;CA/CF;CAAA;CAAA;;;;;;;;;;;;ACCA,KAAaC,eAAb;CAMC,6BACA;CAAA,QADYb,KACZ,uEADkC,EAClC;CAAA;;CAAA;CAAA;CAAA,aALmB;CAKnB;;CAAA;CAAA;CAAA,aAJW;CAIX;;CAAA;CAAA;CAAA,aAHa;CAGb;;CACC,SAAKA,KAAL,GAAaA,KAAb;CACA;;CATF;CAAA;CAAA,yCAYC;CACC,+CAAO,IAAP;CACA;CAdF;CAAA;CAAA,uCAiBC;CACC,gEAAwB,IAAxB;CACA;CAnBF;CAAA;CAAA,yCAsBC;CACC,aAAO,KAAKc,SAAZ;CACA;CAxBF;CAAA;CAAA,uCA0BoBC,MA1BpB,EA2BC;CACC,WAAKD,SAAL,GAAiBE,cAAI,CAACC,aAAL,CAAmBF,MAAnB,IAA6BA,MAA7B,GAAsC,EAAvD;CACA;CA7BF;CAAA;CAAA,wCA+BqBG,MA/BrB,EAgCC;CACC,WAAK,IAAMC,KAAX,IAAoB,KAAKL,SAAzB,EACA;CACC,YAAIM,KAAK,GAAG,KAAKN,SAAL,CAAeK,KAAf,CAAZ;;CAEA,YAAI,CAACH,cAAI,CAACK,QAAL,CAAcD,KAAd,CAAL,EACA;CACCA,UAAAA,KAAK,GAAGE,cAAI,CAACC,SAAL,CAAeH,KAAf,CAAR;CACA;;CAED,YACEJ,cAAI,CAACQ,QAAL,CAAcJ,KAAd,KAAwBA,KAAK,KAAKE,cAAI,CAACC,SAAL,CAAeL,MAAf,CAAnC,IACIF,cAAI,CAACK,QAAL,CAAcD,KAAd,KAAwBA,KAAK,CAACF,MAAN,KAAiBA,MAF9C,EAIA;CACC,iBAAO,KAAKJ,SAAL,CAAeK,KAAf,CAAP;CACA,iBAAO,IAAP;CACA;CACD;;CAED,aAAO,KAAP;CACA;CArDF;CAAA;CAAA,+BAuDYM,IAvDZ,EAwDC;CACC,wDAAgBT,cAAI,CAACU,cAAL,CAAoBD,IAApB,IAA4BA,IAA5B,GAAmC,EAAnD;CAEA,aAAO,IAAP;CACA;CA5DF;CAAA;CAAA,iCA8DcA,IA9Dd,EA+DC;CACC,0DAAkBT,cAAI,CAACU,cAAL,CAAoBD,IAApB,IAA4BA,IAA5B,GAAmC,EAArD;CAEA,aAAO,IAAP;CACA;CAnEF;CAAA;CAAA,iCAsEC;CACC,aAAO,qDAAiB,EAAxB;CACA;CAxEF;CAAA;CAAA,mCA2EC;CACC,aAAO,uDAAmB,EAA1B;CACA;CA7EF;CAAA;CAAA,qCA+EkBP,MA/ElB,EA+E0BE,KA/E1B,EAgFC;CACC,WAAKN,SAAL,CAAeI,MAAf,IAAyBE,KAAzB;CACA;CAlFF;CAAA;CAAA;;KCAaO,eAAb;CAKC,6BACA;CAAA,QADY3B,KACZ,uEADkC,EAClC;CAAA;CAAA,uDAJqB,IAAIC,GAAJ,EAIrB;CAAA,gDAHc,IAAIA,GAAJ,EAGd;CACC,SAAKD,KAAL,GAAaA,KAAb;CACA;;CARF;CAAA;CAAA,gCAWC;CACC,aAAOE,MAAM,CAACC,WAAP,CAAmB,KAAKyB,MAAxB,CAAP;CACA;CAbF;CAAA;CAAA,6BAeUC,SAfV,EAgBC;CACC,aAAO,KAAKD,MAAL,CAAYE,GAAZ,CAAgBD,SAAhB,CAAP;CACA;CAlBF;CAAA;CAAA,6BAoBUA,SApBV,EAoB6BT,KApB7B,EAqBC;CACC,UAAMW,QAAQ,GAAG,KAAKH,MAAL,CAAYE,GAAZ,CAAgBD,SAAhB,CAAjB;CACA,WAAKD,MAAL,CAAYrB,GAAZ,CAAgBsB,SAAhB,EAA2BT,KAA3B;;CACA,UAAI,CAAC,KAAKY,aAAL,CAAmBvB,GAAnB,CAAuBoB,SAAvB,CAAD,IAAsCE,QAAQ,KAAKX,KAAvD,EACA;CACC,aAAKY,aAAL,CAAmBzB,GAAnB,CAAuBsB,SAAvB,EAAkCE,QAAlC;CACA;;CAED,aAAO,IAAP;CACA;CA9BF;CAAA;CAAA,gCAiCC;CACC,aAAQ,KAAKC,aAAL,CAAmBpB,IAAnB,GAA0B,CAAlC;CACA;CAnCF;CAAA;CAAA,mCAsCC;CAAA;;CAAA,UADaqB,gBACb,uEADoC,IACpC;;CACC,UAAIjB,cAAI,CAACkB,KAAL,CAAWD,gBAAX,CAAJ,EACA;CACC,aAAKD,aAAL,CAAmBrB,KAAnB;CACA,OAHD,MAKA;CACCsB,QAAAA,gBAAgB,CAACE,OAAjB,CAAyB,UAACC,IAAD,EAAU;CAClC,UAAA,KAAI,CAACC,iBAAL,CAAuBD,IAAvB;CACA,SAFD;CAGA;;CAED,aAAO,IAAP;CACA;CAnDF;CAAA;CAAA,sCAqDmBP,SArDnB,EAsDC;CACC,WAAKG,aAAL,CAAmBtB,MAAnB,CAA0BmB,SAA1B;CAEA,aAAO,IAAP;CACA;CA1DF;CAAA;CAAA,uCA6DC;CAAA;;CACC,UAAMS,kBAAkB,GAAG,EAA3B;CAEA,WAAKV,MAAL,CAAYO,OAAZ,CAAoB,UAACf,KAAD,EAAQmB,GAAR,EAAgB;CACnC,YAAI,MAAI,CAACP,aAAL,CAAmBvB,GAAnB,CAAuB8B,GAAvB,CAAJ,EACA;CACCD,UAAAA,kBAAkB,CAACC,GAAD,CAAlB,GAA0BnB,KAA1B;CACA;CACD,OALD;CAOA,2CAAWkB,kBAAX;CACA;CAxEF;CAAA;CAAA,uCA2EC;CACC,UAAMA,kBAAkB,GAAG,EAA3B;CAEA,WAAKN,aAAL,CAAmBG,OAAnB,CAA2B,UAACf,KAAD,EAAQmB,GAAR,EAAgB;CAC1CD,QAAAA,kBAAkB,CAACC,GAAD,CAAlB,GAA0BnB,KAA1B;CACA,OAFD;CAIA,2CAAWkB,kBAAX;CACA;CAnFF;CAAA;CAAA,+BAqFYV,MArFZ,EAsFC;CAAA;;CACC,WAAKA,MAAL,CAAYjB,KAAZ;CACA,WAAK6B,YAAL;;CACA,UAAIxB,cAAI,CAACK,QAAL,CAAcO,MAAd,CAAJ,EACA;CACC1B,QAAAA,MAAM,CAACuC,IAAP,CAAYb,MAAZ,EAAoBO,OAApB,CAA4B,UAACI,GAAD,EAAS;CACpC,UAAA,MAAI,CAACX,MAAL,CAAYrB,GAAZ,CAAgBgC,GAAhB,EAAqBX,MAAM,CAACW,GAAD,CAA3B;CACA,SAFD;CAGA;;CAED,aAAO,IAAP;CACA;CAjGF;CAAA;CAAA;;;;;;;;ACAA,KAAaG,eAAb;CAIC,6BACA;CAAA,QADY1C,KACZ,uEADkC,EAClC;CAAA;;CAAA;CAAA;CAAA,aAHY,IAAIC,GAAJ;CAGZ;;CACC,SAAKD,KAAL,GAAaA,KAAb;CACA;;CAPF;CAAA;CAAA,yBASM2C,GATN,EAUC;CAAA;;CACCzC,MAAAA,MAAM,CAACuC,IAAP,CAAYE,GAAZ,EAAiBR,OAAjB,CAAyB,UAACI,GAAD,EAAS;CACjC,YAAMK,IAAI,GAAGD,GAAG,CAACJ,GAAD,CAAhB;;CACA,YAAIK,IAAI,CAAC,UAAD,CAAJ,GAAmB,CAAvB,EACA;CACC,4CAAA,KAAI,OAAJ,CAAUrC,GAAV,CACCe,cAAI,CAACuB,QAAL,CAAcD,IAAI,CAAC,UAAD,CAAlB,CADD,EAEC;CACCE,YAAAA,MAAM,EAAExB,cAAI,CAACuB,QAAL,CAAcD,IAAI,CAAC,QAAD,CAAlB,CADT;CAECG,YAAAA,iBAAiB,EAAEzB,cAAI,CAACuB,QAAL,CAAcD,IAAI,CAAC,mBAAD,CAAlB,CAFpB;CAGCI,YAAAA,QAAQ,EAAE1B,cAAI,CAACuB,QAAL,CAAcD,IAAI,CAAC,UAAD,CAAlB,CAHX;CAICK,YAAAA,WAAW,EAAE3B,cAAI,CAAC4B,MAAL,CAAYN,IAAI,CAAC,aAAD,CAAhB;CAJd,WAFD;CASA;CACD,OAdD;CAeA;CA1BF;CAAA;CAAA,8BA6BC;CAAA;;CACC,WAAKjC,KAAL;;CACA,UAAI,KAAKX,KAAL,CAAWmD,QAAX,KAAwB,CAA5B,EACA;CACCC,QAAAA,cAAI,CAACC,SAAL,CACC,wCADD,EAEC;CACCC,UAAAA,IAAI,EAAE;CACLC,YAAAA,SAAS,EAAE,KAAKvD,KAAL,CAAWmD,QAAX;CADN;CADP,SAFD,EAQEK,IARF,CAQO,UAACC,QAAD,EAAc;CACnBA,UAAAA,QAAQ,CAACC,IAAT,CAAcvB,OAAd,CAAsB,UAACS,IAAD,EAAU;CAC/B,gBAAI,CAAC5B,cAAI,CAACkB,KAAL,CAAWU,IAAI,CAAC,UAAD,CAAf,CAAL,EACA;CACC,gDAAA,MAAI,OAAJ,CAAUrC,GAAV,CACCe,cAAI,CAACuB,QAAL,CAAcD,IAAI,CAAC,UAAD,CAAlB,CADD,EAEC;CACCE,gBAAAA,MAAM,EAAExB,cAAI,CAACuB,QAAL,CAAcD,IAAI,CAAC,QAAD,CAAlB,CADT;CAECG,gBAAAA,iBAAiB,EAAEzB,cAAI,CAACuB,QAAL,CAAcD,IAAI,CAAC,mBAAD,CAAlB,CAFpB;CAGCI,gBAAAA,QAAQ,EAAE1B,cAAI,CAACuB,QAAL,CAAcD,IAAI,CAAC,UAAD,CAAlB,CAHX;CAICK,gBAAAA,WAAW,EAAEL,IAAI,CAAC,aAAD;CAJlB,eAFD;CASA;CACD,WAbD;;CAeA,UAAA,MAAI,CAAC5C,KAAL,CAAW2D,iBAAX;CACA,SAzBF;CA0BA;CACD;CA5DF;CAAA;CAAA,mCA8DgBC,OA9DhB,EA+DC;CAAA;;CACC,aAAO,wEAAU9B,GAAV,CAAcR,cAAI,CAACuB,QAAL,CAAce,OAAd,CAAd,iFAAuCd,MAAvC,KAAiD,CAAxD;CACA;CAjEF;CAAA;CAAA,qCAmEkBc,OAnElB,EAoEC;CAAA;;CACC,aAAO,yEAAU9B,GAAV,CAAcR,cAAI,CAACuB,QAAL,CAAce,OAAd,CAAd,mFAAuCb,iBAAvC,KAA4D,CAAnE;CACA;CAtEF;CAAA;CAAA,4CAwEyBa,OAxEzB,EAyEC;CACC,aAAO,KAAKC,cAAL,CAAoBD,OAApB,IAA+B,KAAKE,gBAAL,CAAsBF,OAAtB,CAAtC;CACA;CA3EF;CAAA;CAAA,wCA8EC;CACC,UAAIG,MAAM,GAAG;CACZ,oBAAY,CADA;CAEZ,kBAAU,CAFE;CAGZ,uBAAe,EAHH;CAIZ,6BAAqB;CAJT,OAAb;CAMA,oDAAU5B,OAAV,CAAkB,UAACS,IAAD,EAAU;CAC3BmB,QAAAA,MAAM,GACLnB,IAAI,CAACE,MAAL,GAAciB,MAAM,CAACjB,MAArB,GACGF,IADH,GAEGmB,MAHJ;CAKA,OAND;CAQA,aAAOA,MAAP;CACA;CA9FF;CAAA;CAAA,4BAiGC;CACC,oDAAUpD,KAAV;CAEA,aAAO,IAAP;CACA;CArGF;CAAA;CAAA;;;;;;;;;;;CCMA,IAAMqD,SAAS,GAAG,IAAI/D,GAAJ,EAAlB;;;;;;;;;;;;;;;;;;;;;;AAEA,KAAagE,YAAb;CAAA;CAAA;CAAA,4BAYgBC,EAZhB,EAaC;CACC,aAAOF,SAAS,CAAClC,GAAV,CAAcoC,EAAd,KAAqB,IAA5B;CACA;CAfF;;CAiBC,0BACA;CAAA,QADYC,OACZ,uEADqC,EACrC;CAAA;;CAAA;;CAAA;;CAAA;;CAAA;CAAA;CAAA,aAhBmB;CAgBnB;;CAAA;CAAA;CAAA,aAfmB;CAenB;;CAAA;CAAA;CAAA,aAdmB;CAcnB;;CAAA;CAAA;CAAA,aAbmB;CAanB;;CAAA;CAAA;CAAA,aAZc;CAYd;;CAAA;CAAA;CAAA,aAXW;CAWX;;CAAA;CAAA;CAAA,aAVW;CAUX;;CACC,SAAKA,OAAL,GAAeA,OAAO,IAAI,EAA1B;CACA,SAAKD,EAAL,GAAU,KAAKC,OAAL,CAAaD,EAAb,IAAmB5C,cAAI,CAAC8C,SAAL,EAA7B;CAEA,8DAAwB,IAAIrE,eAAJ,CAAoB,IAApB,CAAxB;CACA,8DAAwB,IAAIc,eAAJ,CAAoB,IAApB,CAAxB;CACA,8DAAwB,IAAIc,eAAJ,CAAoB,IAApB,CAAxB;CACA,8DAAwB,IAAIe,eAAJ,CAAoB,IAApB,CAAxB;;CAEA,QAAI1B,cAAI,CAACK,QAAL,CAAc8C,OAAO,CAACvC,MAAtB,CAAJ,EACA;CACC,WAAKyC,UAAL,CAAgBF,OAAO,CAACvC,MAAxB,EAAgC,KAAhC;CACA;;CAED,QAAIZ,cAAI,CAACkB,KAAL,CAAWiC,OAAO,CAACG,QAAnB,CAAJ,EACA;CACC,gEAAsBC,OAAtB;CACA,KAHD,MAKA;CACC,gEAAsBC,IAAtB,CAA2BL,OAAO,CAACG,QAAnC;CACA;;CAED,QAAItD,cAAI,CAACK,QAAL,CAAc8C,OAAO,CAACM,OAAtB,CAAJ,EACA;CACC,WAAKC,UAAL,CAAgBP,OAAO,CAACM,OAAxB;CACA;;CAED,QAAIzD,cAAI,CAACK,QAAL,CAAc8C,OAAO,CAACQ,SAAtB,CAAJ,EACA;;CAIA,yDAAmB,IAAIC,2CAAJ,wBAAsB,IAAtB,oEAAsB,IAAtB,GAA2D;CAC7EC,MAAAA,UAAU,EAAE,KAAKV,OAAL,CAAaW,QADoD;CAE7EC,MAAAA,cAAc,EAAE,KAAKZ,OAAL,CAAaY,cAAb,IAA+B,CAF8B;CAG7EC,MAAAA,eAAe,EAAE,KAAKb,OAAL,CAAaY,cAAb,IAA+B;CAH6B,KAA3D,CAAnB;CAKA,yDAAiBE,sBAAjB,CAAwC,IAAIC,6CAAJ,mCAAwB,IAAxB,eAAxC;CAEAlB,IAAAA,SAAS,CAACzD,GAAV,CAAc,KAAK2D,EAAnB,EAAuB,IAAvB;CACA;;CA3DF;CAAA;CAAA,8BAoFW9B,IApFX,EAqFC;CAAA,UADwB+C,YACxB,uEAD4C,IAC5C;CACC,aAAO,KAAKhB,OAAL,CAAa/B,IAAb,KAAsB+C,YAA7B;CACA;CAvFF;CAAA;CAAA,8BAyFW/C,IAzFX,EA0FC;CAAA,UADwBhB,KACxB,uEADqC,IACrC;CACC,WAAK+C,OAAL,CAAa/B,IAAb,IAAqBhB,KAArB;CAEA,aAAO,IAAP;CACA;CA9FF;CAAA;CAAA,iCAiGC;CAAA,UADWqD,OACX,uEADyB,IACzB;CACC,wDAAgBA,OAAhB;CAEA,aAAO,IAAP;CACA;CArGF;CAAA;CAAA,mCAwGC;CACC,wDAAgB,IAAhB;CAEA,aAAO,IAAP;CACA;CA5GF;CAAA;CAAA,iCA+GC;CACC,+CAAO,IAAP;CACA;CAjHF;CAAA;CAAA,oCAoHC;CACC,+CAAO,IAAP;CACA;CAtHF;CAAA;CAAA,yCAyHC;CACC,+CAAO,IAAP;CACA;CA3HF;CAAA;CAAA,yCA8HC;CACC,+CAAO,IAAP;CACA;CAhIF;CAAA;CAAA,gCAmIC;CACC,aAAO,0DAAsBW,SAAtB,EAAP;CACA;CArIF;CAAA;CAAA,yCAwIC;CACC,+CAAO,IAAP;CACA;CA1IF;CAAA;CAAA,6BA4IUvD,SA5IV,EA6IC;CACC,aAAO,0DAAsBwD,QAAtB,CAA+BxD,SAA/B,CAAP;CACA;CA/IF;CAAA;CAAA,6BAiJUA,SAjJV,EAiJ6BT,KAjJ7B,EAkJC;CACC,gEAAsBkE,QAAtB,CAA+BzD,SAA/B,EAA0CT,KAA1C;;CAEA,UACC,CACCS,SAAS,KAAK,QAAd,IAA0BA,SAAS,KAAK,YADzC,KAGG,KAAKsB,QAAL,yCAAoB,IAApB,WAJJ,EAMA;CACC,0DAAgB,KAAKA,QAAL,EAAhB;;CACA,YAAI,oDAAgB,CAApB,EACA;CACC,oEAAsBoB,OAAtB;CACA;CACD;;CAED,aAAO,IAAP;CACA;CApKF;CAAA;CAAA,8BAsKW3C,MAtKX,EAuKC;CAAA;;CACC1B,MAAAA,MAAM,CAACuC,IAAP,CAAYb,MAAZ,EAAoBO,OAApB,CAA4B,UAACI,GAAD,EAAS;CACpC,QAAA,KAAI,CAAC+C,QAAL,CAAc/C,GAAd,EAAmBX,MAAM,CAACW,GAAD,CAAzB;CACA,OAFD;CAIA,aAAO,IAAP;CACA;CA7KF;CAAA;CAAA,+BA+KYX,MA/KZ,EAgLC;CAAA,UADuB2D,gBACvB,uEADmD,IACnD;CACC,gEAAsBlB,UAAtB,CAAiCzC,MAAjC;CACA,wDAAgB,KAAKuB,QAAL,EAAhB;;CACA,UAAIoC,gBAAJ,EACA;CACC,kEAAsBhB,OAAtB;CACA;;CAED,aAAO,IAAP;CACA;CAzLF;CAAA;CAAA,gCA2La1C,SA3Lb,EA4LC;CACC,gEAAsB2D,WAAtB,CAAkC3D,SAAlC;CAEA,aAAO,IAAP;CACA;CAhMF;CAAA;CAAA,gCAmMC;CACC,aAAO,0DAAsB4D,SAAtB,EAAP;CACA;CArMF;CAAA;CAAA,4BAwMC;CACC,aAAO,KAAKC,SAAL,CAAe,OAAf,EAAwB,KAAxB,CAAP;CACA;CA1MF;CAAA;CAAA,+BA6MC;CACC,aAAO,KAAKL,QAAL,CAAc,QAAd,KAA2B,KAAKM,YAAL,EAAlC;CACA;CA/MF;CAAA;CAAA,mCAkNC;CACC,aAAO,KAAKN,QAAL,CAAc,YAAd,KAA+B,IAAtC;CACA;CApNF;CAAA;CAAA,uCAuNC;CACC,aAAO,KAAKlC,QAAL,KAAkB,CAAzB;CACA;CAzNF;CAAA;CAAA,8BA4NC;CACC,aAAO,KAAKwC,YAAL,OAAwB,IAAxB,IAAgC,CAAC,KAAKC,QAAL,EAAxC;CACA;CA9NF;CAAA;CAAA,+BAiOC;CACC,aAAO,KAAKF,SAAL,CAAe,eAAf,EAAgC,IAAhC,CAAP;CACA;CAnOF;CAAA;CAAA,kCAsOC;CACC,aAAO,KAAKA,SAAL,CAAe,UAAf,EAA2B,CAA3B,CAAP;CACA;CAxOF;CAAA;CAAA,qCA2OC;CACC,aAAO,KAAKA,SAAL,CAAe,aAAf,EAA8B,CAA9B,CAAP;CACA;CA7OF;CAAA;CAAA,kCAgPC;CACC,aAAO,KAAKA,SAAL,CAAe,UAAf,EAA2B,IAA3B,CAAP;CACA;CAlPF;CAAA;CAAA,oCAqPC;CACC,aAAO,KAAKA,SAAL,CAAe,YAAf,EAA6B,EAA7B,CAAP;CACA;CAvPF;CAAA;CAAA,kCAyPetE,KAzPf,EA0PC;CACC,WAAK+C,OAAL,CAAa,YAAb,IAA6B/C,KAAK,IAAI,EAAtC;CACA;CA5PF;CAAA;CAAA,qCA8PkB8C,EA9PlB,EA8P8BC,OA9P9B,EA+PC;CACC,UAAI,CAAC,KAAK0B,gBAAL,EAAL,EACA;CACC;CACA;;CAED,UAAMC,KAAK,GAAG3B,OAAO,CAAC2B,KAAR,IAAiB,EAA/B;CACA,UAAMC,cAAc,GAAGC,EAAE,CAACC,EAAH,CAAMC,YAAN,CAAmBC,KAAnB,CAAyBC,WAAzB,CAAqC,SAArC,CAAvB;CACA,UAAMC,eAAe,GAAGL,EAAE,CAACC,EAAH,CAAMC,YAAN,CAAmBC,KAAnB,CAAyBC,WAAzB,CAAqC,UAArC,CAAxB;CAEA,UAAIE,OAAJ,CAAY,UAACC,OAAD,EAAa;CACxB,YAAMC,cAAc,GAAGR,EAAE,CAACC,EAAH,CAAMC,YAAN,CAAmBO,MAAnB,CAA0BC,oBAA1B,CAA+CzC,YAAY,CAAC0C,0BAA5D,CAAvB;;CACA,YAAIH,cAAc,IAAIA,cAAc,CAACI,KAAf,OAA2B1C,EAAjD,EACA;CACC2C,UAAAA,UAAU,CAAC,YAAM;CAChBL,YAAAA,cAAc,CAACM,KAAf;CACAD,YAAAA,UAAU,CAACN,OAAD,EAAU,GAAV,CAAV;CACA,WAHS,EAGP,GAHO,CAAV;CAIA,SAND,MAQA;CACCA,UAAAA,OAAO;CACP;CACD,OAbD,EAcE/C,IAdF,CAcO,YAAM;CACX,YAAIuD,MAAM,GAAGf,EAAE,CAACC,EAAH,CAAMC,YAAN,CAAmBO,MAAnB,CAA0BO,cAA1B,CAAyC9C,EAAzC,CAAb;;CACA,YAAI,CAAC6C,MAAL,EACA;CACC,cAAME,mBAAmB,GAAG;CAC3B/C,YAAAA,EAAE,EAAFA,EAD2B;CAE3BgD,YAAAA,WAAW,EAAE,IAFc;CAG3BC,YAAAA,QAAQ,EAAElD,YAAY,CAAC0C,0BAHI;CAI3BS,YAAAA,aAAa,EAAE,IAJY;CAK3BC,YAAAA,OAAO,EAAEC,aAAG,CAACC,MAAN,iGAAoBzB,KAApB;CALoB,WAA5B;;CASA,cAAI3B,OAAO,CAACqD,aAAR,KAA0B,IAA9B,EACA;CACCP,YAAAA,mBAAmB,CAACQ,OAApB,GAA8B,CAC7B;CACC3B,cAAAA,KAAK,EAAE3B,OAAO,CAACuD,kBAAR,IAA8BC,aAAG,CAACC,UAAJ,CAAe,wDAAf,CADtC;CAECC,cAAAA,MAAM,EAAE;CACPC,gBAAAA,KAAK,EAAE,eAACC,KAAD,EAAQC,OAAR,EAAoB;CAC1BhC,kBAAAA,EAAE,CAACiC,qBAAH,CAAyBlB,MAAzB,EAAiChB,cAAjC;CACAiC,kBAAAA,OAAO,CAACE,SAAR,CAAkB,UAAlB;CACAF,kBAAAA,OAAO,CAAClB,KAAR;CACA;CALM;CAFT,aAD6B,CAA9B;CAYA;;CAEDC,UAAAA,MAAM,GAAGf,EAAE,CAACC,EAAH,CAAMC,YAAN,CAAmBO,MAAnB,CAA0BM,MAA1B,CAAiCE,mBAAjC,CAAT;CACA;;CAEDjB,QAAAA,EAAE,CAACiC,qBAAH,CAAyBlB,MAAzB,EAAiChB,cAAjC;CACAgB,QAAAA,MAAM,CAACoB,QAAP,CAAgB,SAAhB,EAA2B,YAAM;CAAA;;CAChC,cAAInH,cAAI,CAACoH,UAAL,CAAgBjE,OAAhB,aAAgBA,OAAhB,0CAAgBA,OAAO,CAAE0D,MAAzB,oDAAgB,gBAAiBQ,MAAjC,CAAJ,EACA;CACElE,YAAAA,OAAO,CAAC0D,MAAR,CAAeQ,MAAhB;CACA;CACD,SALD;CAOArC,QAAAA,EAAE,CAACiC,qBAAH,CAAyBlB,MAAzB,EAAiCV,eAAjC;CACAU,QAAAA,MAAM,CAACoB,QAAP,CAAgB,UAAhB,EAA4B,YAAM;CAAA;;CACjC,cAAInH,cAAI,CAACoH,UAAL,CAAgBjE,OAAhB,aAAgBA,OAAhB,2CAAgBA,OAAO,CAAE0D,MAAzB,qDAAgB,iBAAiBS,QAAjC,CAAJ,EACA;CACEnE,YAAAA,OAAO,CAAC0D,MAAR,CAAeS,QAAhB;CACA;CACD,SALD;CAOAvB,QAAAA,MAAM,CAACwB,IAAP;CACA,OA/DF;CAgEA;CAzUF;CAAA;CAAA,yBAgVMtG,gBAhVN,EAiVC;CAAA;;CACC,UAAI,CAAC,KAAKuG,UAAL,EAAL,EACA;CACC;CACA;;CAED,aAAO,IAAIlC,OAAJ,CAAY,UAACC,OAAD,EAAUkC,MAAV,EAAqB;CACvC,YAAIC,UAAJ;;CACA,YAAI,MAAI,CAAC9C,QAAL,EAAJ,EACA;CACC8C,UAAAA,UAAU,0BAAG,MAAH,wCAAG,MAAH,CAAV;CACA,SAHD,MAKA;CACCA,UAAAA,UAAU,0BAAG,MAAH,wCAAG,MAAH,EAAuBzG,gBAAvB,CAAV;CACA;;CAEDyG,QAAAA,UAAU,CACRlF,IADF,CACO,UAACuE,KAAD,EAAW;CAChB,4CAAA,MAAI,mBAAJ,CAAsBvF,YAAtB,CAAmCP,gBAAnC;CACAsE,UAAAA,OAAO,CAACwB,KAAD,CAAP;CACA,SAJF,EAKEY,KALF,CAKQF,MALR;CAMA,OAjBM,CAAP;CAkBA;CAzWF;CAAA;CAAA,iCA4WC;CACC,aAAO,KAAK/C,SAAL,CAAe,YAAf,EAA6B,IAA7B,KAAsC,CAAC,KAAKkD,OAAL,EAA9C;CACA;CA9WF;CAAA;CAAA,8CAiXC;CACCC,MAAAA,6BAAY,CAACC,IAAb,CAAkB,IAAlB,EAAuB,gBAAvB;CACA;CAnXF;CAAA;CAAA,wCAsXC;CACCD,MAAAA,6BAAY,CAACC,IAAb,CAAkB,IAAlB,EAAuB,mBAAvB;CACA;CAxXF;CAAA;CAAA,oDA4UC;CACC,aAAO9C,EAAE,CAACC,EAAH,CAAMC,YAAN,CAAmBO,MAAnB,CAA0BC,oBAA1B,CAA+CzC,YAAY,CAAC0C,0BAA5D,CAAP;CACA;CA9UF;CAAA;CAAA;;0CA8DC;CACC,MAAMoC,YAAY,GAAGzH,cAAI,CAACuB,QAAL,CAAc,0DAAsBwC,QAAtB,CAA+B,OAA/B,CAAd,CAArB;CACA,MAAM2D,SAAS,GAAGhI,cAAI,CAACQ,QAAL,CAAc,0DAAsB6D,QAAtB,CAA+B,YAA/B,CAAd,IACf/D,cAAI,CAACuB,QAAL,CAAc,0DAAsBwC,QAAtB,CAA+B,YAA/B,CAAd,CADe,GAEf0D,YAFH;CAIA,SAAO;CACN,gBAAYzH,cAAI,CAACuB,QAAL,CAAc,0DAAsBwC,QAAtB,CAA+B,UAA/B,CAAd,CADN;CAEN,kBAAc2D,SAFR;CAGN,aAASD,YAHH;CAIN,mBAAeC,SAJT;CAKN,oBAAgBD,YALV;CAMN,uBAAmB,0DAAsB1D,QAAtB,CAA+B,iBAA/B,KAAqD0D,YANlE;CAON,wBAAoB,0DAAsB1D,QAAtB,CAA+B,kBAA/B,KAAsD4D,sCAAY,CAACC,UAPjF;CAQN,qBAAiB5H,cAAI,CAACuB,QAAL,CAAc,0DAAsBwC,QAAtB,CAA+B,eAA/B,CAAd,CARX;CASN,oBAAgB/D,cAAI,CAACuB,QAAL,CAAc,0DAAsBwC,QAAtB,CAA+B,cAA/B,CAAd,CATV;CAUN,oBAAgB,0DAAsBA,QAAtB,CAA+B,cAA/B,KAAkD,GAV5D;CAWN,gBAAY/D,cAAI,CAACuB,QAAL,CAAc,0DAAsBwC,QAAtB,CAA+B,UAA/B,CAAd,KAA6D,CAXnE;CAYN,kBAAc,0DAAsBA,QAAtB,CAA+B,YAA/B,KAAgD;CAZxD,GAAP;CAcA;;0BAwScpD,kBACf;CAAA;;CACC,MAAI,KAAKkH,WAAL,MAAsB,CAAtB,IAA2B,CAAC,0DAAsB1D,SAAtB,EAAhC,EACA;CACC;CACA;;CAED,MAAI2D,WAAW,GAAG,EAAlB;;CACA,MAAI,CAACpI,cAAI,CAACqI,OAAL,CAAapH,gBAAb,CAAD,IAAmCA,gBAAgB,CAACqH,MAAjB,KAA4B,CAAnE,EACA;CACCF,IAAAA,WAAW,GAAG,0DAAsBG,gBAAtB,EAAd;CACA,GAHD,MAKA;CACC,QAAMvH,aAAa,GAAG,0DAAsBuH,gBAAtB,EAAtB;CACArJ,IAAAA,MAAM,CAACuC,IAAP,CAAYT,aAAZ,EAA2BG,OAA3B,CAAmC,UAACI,GAAD,EAAS;CAC3C,UAAIN,gBAAgB,CAACuH,QAAjB,CAA0BjH,GAA1B,CAAJ,EACA;CACC,YAAIA,GAAG,KAAK,OAAR,IAAmBA,GAAG,KAAK,YAA/B,EACA;CACC6G,UAAAA,WAAW,CAAC,QAAD,CAAX,GAAwBA,WAAW,CAAC,QAAD,CAAX,IAAyB,EAAjD;CACAA,UAAAA,WAAW,CAAC,QAAD,CAAX,CAAsB,MAAI,CAACK,cAAL,EAAtB,IAA+C;CAC9CC,YAAAA,KAAK,EAAE1H,aAAa,CAACO,GAAD,CAD0B;CAE9CoH,YAAAA,QAAQ,EAAE,MAAI,CAACC,WAAL;CAFoC,WAA/C;CAIA,SAPD,MASA;CACCR,UAAAA,WAAW,CAAC7G,GAAD,CAAX,GAAmBP,aAAa,CAACO,GAAD,CAAhC;CACA;CACD;CACD,KAhBD;CAiBA;;CAED,SAAOa,cAAI,CAACC,SAAL,CACN,mCADM,EAEN;CACCC,IAAAA,IAAI,EAAE;CACLY,MAAAA,EAAE,EAAE,KAAKf,QAAL,EADC;CAEL0G,MAAAA,YAAY,EAAET,WAFT;CAGLU,MAAAA,SAAS,EAAE,0DAAsBC,gBAAtB;CAHN;CADP,GAFM,CAAP;CAUA;;4BAGD;CACC,MAAMnI,MAAM,GAAG;CACdoI,IAAAA,IAAI,EAAE,0DAAsB3E,QAAtB,CAA+B,MAA/B,EAAuC,EAAvC,CADQ;CAEd4E,IAAAA,SAAS,EAAE,KAAKd,WAAL;CAFG,GAAf;CAKA,MAAMe,KAAK,GAAG,0DAAsB7E,QAAtB,CAA+B,YAA/B,EAA6C,IAA7C,CAAd;;CACA,MAAI,CAACrE,cAAI,CAACkB,KAAL,CAAWgI,KAAX,CAAL,EACA;CACCtI,IAAAA,MAAM,CAAC,OAAD,CAAN,GAAkBsI,KAAlB;CACA;;CAED,MAAMC,OAAO,GAAG,0DAAsB9E,QAAtB,CAA+B,SAA/B,EAA0C,IAA1C,CAAhB;;CACA,MAAI,CAACrE,cAAI,CAACkB,KAAL,CAAWiI,OAAX,CAAL,EACA;CACCvI,IAAAA,MAAM,CAAC,SAAD,CAAN,GAAoBuI,OAApB;CACA;;CAEDvI,EAAAA,MAAM,CAAC,UAAD,CAAN,GAAqB,KAAKgI,WAAL,EAArB;CACA,MAAM9E,QAAQ,GAAG,0DAAsBO,QAAtB,CAA+B,UAA/B,EAA2C,IAA3C,CAAjB;;CACA,MAAIrE,cAAI,CAACU,cAAL,CAAoBoD,QAApB,CAAJ,EACA;CACClD,IAAAA,MAAM,CAAC,UAAD,CAAN,GAAqBkD,QAArB;CACA;;CAED,SAAO1B,cAAI,CAACC,SAAL,CACN,uCADM,EAEN;CACCC,IAAAA,IAAI,EAAE;CACL1B,MAAAA,MAAM,EAANA;CADK;CADP,GAFM,CAAP;CAQA;;6BA1cWqC,4CAUwB;;;;;;;;"}