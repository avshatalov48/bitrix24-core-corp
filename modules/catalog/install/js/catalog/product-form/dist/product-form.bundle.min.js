this.BX=this.BX||{};(function(t,e,i,o,n,s,a,r,c,l,u,d,p,h,f,m,g,b,T,v,I,E,O,C,P){"use strict";var R=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(R,"TOP","TOP");babelHelpers.defineProperty(R,"BOTTOM","BOTTOM");var y=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getName",value:function t(){return"productList"}},{key:"getState",value:function t(){return{currency:"",taxIncluded:"N",basket:[],total:{sum:0,discount:0,taxSum:0,result:0}}}},{key:"getActions",value:function t(){return{resetBasket:function t(e){var i=e.commit;i("clearBasket");i("addItem",{})},removeItem:function t(e,i){var o=e.dispatch,n=e.commit,s=e.state;n("deleteItem",i);if(s.basket.length===0){n("addItem",{})}else{s.basket.forEach(function(t,e){n("updateItem",{index:e,fields:{sort:e}})})}o("calculateTotal")},changeItem:function t(e,i){var o=e.dispatch,n=e.commit;n("updateItem",i);o("calculateTotal")},setCurrency:function t(e,i){var o=e.commit;var n=i||"";o("setCurrency",n)},addItem:function t(e,i){var o=e.dispatch,n=e.commit;var s=i.item||{fields:{}};n("addItem",{item:s,position:i.position||R.TOP});o("calculateTotal")},calculateTotal:function t(e){var i=e.commit,o=e.state;var n={sum:0,taxSum:0,discount:0,result:0};o.basket.forEach(function(t){var e=p.Text.toNumber(t.fields.basePrice||0);var i=p.Text.toNumber(t.fields.quantity||0);var o=p.Text.toNumber(t.fields.discount||0);var s=p.Text.toNumber(t.fields.taxSum||0);n.sum+=e*i;n.result+=p.Text.toNumber(t.sum);n.discount+=o*i;n.taxSum+=s*i});n.discount=n.discount>n.sum?n.sum:n.discount;i("setTotal",n)}}}},{key:"getGetters",value:function t(){return{getBasket:function t(e){return function(){return e.basket}},getBaseProduct:function t(){return function(){return e.getBaseProduct()}}}}},{key:"getMutations",value:function t(){return{addItem:function t(i,o){var n=e.getBaseProduct();n=Object.assign(n,o.item);if(o.position===R.BOTTOM){i.basket.push(n)}else{i.basket.unshift(n)}i.basket.forEach(function(t,e){t.fields.sort=e})},updateItem:function t(i,o){if(typeof i.basket[o.index]==="undefined"){u.Vue.set(i.basket,o.index,e.getBaseProduct())}i.basket[o.index]=Object.assign(i.basket[o.index],o.fields)},clearBasket:function t(e){e.basket=[]},deleteItem:function t(e,i){e.basket.splice(i.index,1);e.basket.forEach(function(t,e){t.fields.sort=e})},setErrors:function t(e,i){e.errors=i},clearErrors:function t(e){e.errors=[]},setCurrency:function t(e,i){e.currency=i},setTotal:function t(e,i){var o=i;if(p.Type.isStringFilled(e.currency)){for(var n in i){if(i.hasOwnProperty(n)){o[n]=C.CurrencyCore.currencyFormat(i[n],e.currency)}}}e.total=Object.assign(e.total,o)}}}}],[{key:"getBaseProduct",value:function t(){var e=p.Text.getRandom();return{offerId:null,selectorId:e,fields:{innerId:e,productId:null,skuId:null,code:null,module:null,sort:0,price:0,basePrice:0,priceExclusive:0,quantity:1,name:"",discount:0,discountRate:0,discountInfos:[],discountType:P.DiscountType.PERCENTAGE,tax:0,taxSum:0,taxIncluded:"N",measureCode:0,measureName:"",measureRatio:1,isCustomPrice:"N",additionalFields:[],properties:[],brands:[]},calculatedFields:[],showDiscount:"N",showTax:"N",skuTree:[],image:null,sum:0,discountSum:0,detailUrl:"",encodedFields:null,errors:[]}}}]);return e}(l.VuexBuilderModel);var _=Object.freeze({databaseConfig:{name:"catalog.product-form"},templateName:"bx-form",templatePanelButtons:"bx-panel-buttons",templatePanelCompilation:"bx-panel-compilation",templateRowName:"bx-form-row",templateFieldInlineSelector:"bx-field-inline-selector",templateFieldPrice:"bx-field-price",templateFieldQuantity:"bx-field-quantity",templateFieldDiscount:"bx-field-discount",templateFieldTax:"bx-field-tax",templateFieldBrand:"bx-field-brand",moduleId:"catalog"});var A=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(A,"PRODUCT_SELECTOR","product-selector");babelHelpers.defineProperty(A,"IMAGE_EDITOR","image-editor");babelHelpers.defineProperty(A,"QUANTITY","quantity");babelHelpers.defineProperty(A,"PRICE","price");babelHelpers.defineProperty(A,"RESULT","result");babelHelpers.defineProperty(A,"DISCOUNT","discount");babelHelpers.defineProperty(A,"TAX","tax");babelHelpers.defineProperty(A,"BRAND","brand");var k=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(k,"EMPTY_PRODUCT_SELECTOR",0);babelHelpers.defineProperty(k,"EMPTY_IMAGE",1);babelHelpers.defineProperty(k,"EMPTY_QUANTITY",2);babelHelpers.defineProperty(k,"EMPTY_PRICE",3);babelHelpers.defineProperty(k,"EMPTY_BRAND",4);var L=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(L,"REGULAR","REGULAR");babelHelpers.defineProperty(L,"READ_ONLY","READ_ONLY");babelHelpers.defineProperty(L,"COMPILATION","COMPILATION");u.Vue.component(_.templateFieldQuantity,{props:{measureCode:Number,measureRatio:Number,measureName:String,quantity:Number,editable:Boolean,hasError:Boolean,options:Object},created:function t(){this.onInputQuantityHandler=p.Runtime.debounce(this.onInputQuantity,500,this)},methods:{onInputQuantity:function t(e){if(!this.editable){return}e.target.value=e.target.value.replace(/[^.\d]/g,".");var i=parseFloat(e.target.value);var o=e.target.value.substr(-1);if(o==="."){return}this.changeQuantity(i)},calculateCorrectionFactor:function t(e,i){var o=e;var n=i;var s=1;while(!(Number.isInteger(o)&&Number.isInteger(n))){s*=10;o=e*s;n=i*s}return s},incrementValue:function t(){if(!this.editable){return}var e=this.calculateCorrectionFactor(this.quantity,this.measureRatio);var i=(this.quantity*e+this.measureRatio*e)/e;this.changeQuantity(i)},decrementValue:function t(){if(this.quantity>this.measureRatio&&this.editable){var e=this.calculateCorrectionFactor(this.quantity,this.measureRatio);var i=(this.quantity*e-this.measureRatio*e)/e;this.changeQuantity(i)}},changeQuantity:function t(e){this.$emit("changeQuantity",e)},showPopupMenu:function t(e){var i=this;if(!this.editable||!p.Type.isArray(this.options.measures)){return}var o=[];this.options.measures.forEach(function(t){o.push({text:t.SYMBOL,item:t,onclick:i.changeMeasure})});if(o.length>0){this.popupMenu=new d.Menu({bindElement:e,items:o});this.popupMenu.show()}},changeMeasure:function t(e,i){this.$emit("changeMeasure",{code:param.options.item.CODE,name:param.options.item.SYMBOL});if(this.popupMenu){this.popupMenu.close()}}},template:'\n\t\t<div class="catalog-pf-product-input-wrapper" v-bind:class="{ \'ui-ctl-danger\': hasError }">\n\t\t\t<input \t\n\t\t\t\ttype="text" class="catalog-pf-product-input"\n\t\t\t\tv-bind:class="{ \'catalog-pf-product-input--disabled\': !editable }"\n\t\t\t\t:value="quantity"\n\t\t\t\t@input="onInputQuantity"\n\t\t\t\t:disabled="!editable"\n\t\t\t>\n\t\t\t<div \n\t\t\t\tclass="catalog-pf-product-input-info catalog-pf-product-input-info--action" \n\t\t\t\t@click="showPopupMenu($event.target)"\n\t\t\t>\n\t\t\t\t<span>{{ measureName }}</span>\n\t\t\t</div>\n\t\t</div>\n\t'});u.Vue.component(_.templateFieldPrice,{props:{basePrice:Number,editable:Boolean,hasError:Boolean,options:Object},created:function t(){this.onInputPriceHandler=p.Runtime.debounce(this.onInputPrice,500,this)},methods:{onInputPrice:function t(e){if(!this.editable){return}e.target.value=e.target.value.replace(/[^.,\d]/g,"");if(e.target.value===""){e.target.value=0}var i=e.target.value.substr(-1);if(i===","){e.target.value=e.target.value.replace(",",".")}var o=parseFloat(e.target.value);if(o<0||i==="."||i===","){return}this.$emit("changePrice",o)}},computed:{localize:function t(){return u.Vue.getFilteredPhrases("CATALOG_")},currencySymbol:function t(){return this.options.currencySymbol||""}},template:'\n\t\t<div class="catalog-pf-product-input-wrapper" v-bind:class="{ \'ui-ctl-danger\': hasError }">\n\t\t\t<input \ttype="text" class="catalog-pf-product-input catalog-pf-product-input--align-right"\n\t\t\t\t\tv-bind:class="{ \'catalog-pf-product-input--disabled\': !editable }"\n\t\t\t\t\t:value="basePrice"\n\t\t\t\t\t@input="onInputPriceHandler"\n\t\t\t\t\t:disabled="!editable">\n\t\t\t<div class="catalog-pf-product-input-info" v-html="currencySymbol"></div>\n\t\t</div>\n\t'});u.Vue.component(_.templateFieldDiscount,{props:{editable:Boolean,options:Object,discount:Number,discountType:Number,discountRate:Number},created:function t(){this.onInputDiscount=p.Runtime.debounce(this.onChangeDiscount,500,this);this.currencySymbol=this.options.currencySymbol},methods:{onChangeType:function t(e,i){var o;if(!this.editable){return}var n=p.Text.toNumber(i===null||i===void 0?void 0:(o=i.options)===null||o===void 0?void 0:o.type)===P.DiscountType.MONETARY?P.DiscountType.MONETARY:P.DiscountType.PERCENTAGE;this.$emit("changeDiscountType",n);if(this.popupMenu){this.popupMenu.close()}},onChangeDiscount:function t(e){var i=p.Text.toNumber(e.target.value)||0;if(i===p.Text.toNumber(this.discount)||!this.editable){return}this.$emit("changeDiscount",i)},showPopupMenu:function t(e){if(!this.editable||!p.Type.isArray(this.options.allowedDiscountTypes)){return}var i=[];if(this.options.allowedDiscountTypes.includes(P.DiscountType.PERCENTAGE)){i.push({text:"%",onclick:this.onChangeType,type:P.DiscountType.PERCENTAGE})}if(this.options.allowedDiscountTypes.includes(P.DiscountType.MONETARY)){i.push({text:this.currencySymbol,onclick:this.onChangeType,type:P.DiscountType.MONETARY})}if(i.length>0){this.popupMenu=new d.Menu({bindElement:e,items:i});this.popupMenu.show()}}},computed:{getDiscountInputValue:function t(){if(p.Text.toNumber(this.discountType)===P.DiscountType.PERCENTAGE){return p.Text.toNumber(this.discountRate)}return p.Text.toNumber(this.discount)},getDiscountSymbol:function t(){return p.Text.toNumber(this.discountType)===P.DiscountType.PERCENTAGE?"%":this.currencySymbol}},template:'\n\t\t<div class="catalog-pf-product-input-wrapper catalog-pf-product-input-wrapper--left">\n\t\t\t<input class="catalog-pf-product-input catalog-pf-product-input--align-right catalog-pf-product-input--right"\n\t\t\t\t\tv-bind:class="{ \'catalog-pf-product-input--disabled\': !editable }"\n\t\t\t\t\tref="discountInput" \n\t\t\t\t\t:value="getDiscountInputValue"\n\t\t\t\t\t@input="onInputDiscount"\n\t\t\t\t\tplaceholder="0"\n\t\t\t\t\t:disabled="!editable">\n\t\t\t<div class="catalog-pf-product-input-info catalog-pf-product-input-info--action" \n\t\t\t\t@click="showPopupMenu">\n\t\t\t\t<span v-html="getDiscountSymbol"></span>\n\t\t\t</div>\n\t\t</div>\n\t'});u.Vue.component(_.templateFieldTax,{props:{taxId:Number,editable:Boolean,options:Object},data:function t(){return{taxValue:this.getTaxList()[this.taxId]||0}},methods:{onChangeValue:function t(e,i){var o,n;var s=p.Text.toNumber(i===null||i===void 0?void 0:(o=i.options)===null||o===void 0?void 0:o.item);if(s===p.Text.toNumber(this.taxValue)||!this.editable){return}this.$emit("changeTax",{taxValue:s,taxId:i===null||i===void 0?void 0:(n=i.options)===null||n===void 0?void 0:n.id});if(this.popupMenu){this.popupMenu.close()}},getTaxList:function t(){return p.Type.isArray(this.options.taxList)?this.options.taxList:[]},showPopupMenu:function t(e){var i=this;if(!this.editable||!p.Type.isArray(this.options.taxList)){return}var o=[];this.options.taxList.forEach(function(t,e){o.push({id:e,text:t+"%",item:t,onclick:i.onChangeValue})});if(o.length>0){this.popupMenu=new d.Menu({bindElement:e,items:o});this.popupMenu.show()}}},template:'\n\t\t<div class="catalog-pf-product-input-wrapper catalog-pf-product-input-wrapper--right" @click="showPopupMenu">\n\t\t\t<div class="catalog-pf-product-input">{{this.taxValue}}%</div>\n\t\t\t<div class="catalog-pf-product-input-info catalog-pf-product-input-info--dropdown"></div>\n\t\t</div>\n\t'});u.Vue.component(_.templateFieldInlineSelector,{props:{editable:Boolean,options:Object,basketItem:Object},data:function t(){return{currencySymbol:null,productSelector:null,imageControlId:null,selectorId:this.basketItem.selectorId}},created:function t(){O.EventEmitter.subscribe("BX.Catalog.ProductSelector:onChange",this.onProductChange.bind(this));O.EventEmitter.subscribe("BX.Catalog.ProductSelector:onClear",this.onProductClear.bind(this))},mounted:function t(){this.productSelector=new r.ProductSelector(this.selectorId,this.prepareSelectorParams());this.productSelector.renderTo(this.$refs.selectorWrapper)},methods:{prepareSelectorParams:function t(){var e={iblockId:this.options.iblockId,basePriceId:this.options.basePriceId,productId:this.getField("productId"),skuId:this.getField("skuId"),skuTree:this.getDefaultSkuTree(),fileInputId:"",morePhotoValues:[],fileInput:"",config:{DETAIL_PATH:this.basketItem.detailUrl||"",ENABLE_SEARCH:true,ENABLE_INPUT_DETAIL_LINK:true,ENABLE_IMAGE_CHANGE_SAVING:true,ENABLE_EMPTY_PRODUCT_ERROR:this.options.enableEmptyProductError||this.isRequiredField(A.PRODUCT_SELECTOR),ENABLE_EMPTY_IMAGES_ERROR:this.isRequiredField(A.IMAGE_EDITOR),ROW_ID:this.selectorId,ENABLE_SKU_SELECTION:this.editable,HIDE_UNSELECTED_ITEMS:this.options.hideUnselectedProperties,URL_BUILDER_CONTEXT:this.options.urlBuilderContext},mode:this.editable?r.ProductSelector.MODE_EDIT:r.ProductSelector.MODE_VIEW,isSimpleModel:this.getField("name","")!==""&&this.getField("productId")<=0&&this.getField("skuId")<=0,fields:{NAME:this.getField("name")||"",PRICE:this.getField("basePrice")||0,CURRENCY:this.options.currency}};var i=this.basketItem.image;if(p.Type.isObject(i)){e.fileView=i.preview;e.fileInput=i.input;e.fileInputId=i.id;e.morePhotoValues=i.values}return e},isRequiredField:function t(e){return p.Type.isArray(this.options.requiredFields)&&this.options.requiredFields.includes(e)},getDefaultSkuTree:function t(){var e=this.basketItem.skuTree||{};if(p.Type.isStringFilled(e)){e=JSON.parse(e)}return e},getField:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this.basketItem.fields[e]||i},onProductChange:function t(e){var i=e.getData();if(p.Type.isStringFilled(i.selectorId)&&i.selectorId===this.productSelector.getId()){var o=p.Text.toNumber(i.fields.PRICE);var n={BASE_PRICE:o,MODULE:"catalog",NAME:i.fields.NAME,ID:i.fields.ID,PRODUCT_ID:i.fields.PRODUCT_ID,SKU_ID:i.fields.SKU_ID,PROPERTIES:i.fields.PROPERTIES,URL_BUILDER_CONTEXT:this.options.urlBuilderContext,CUSTOMIZED:p.Type.isNil(i.fields.PRICE)?"Y":"N",MEASURE_CODE:i.fields.MEASURE_CODE,MEASURE_NAME:i.fields.MEASURE_NAME};this.$emit("onProductChange",n)}},onProductClear:function t(e){var i=e.getData();if(p.Type.isStringFilled(i.selectorId)&&i.selectorId===this.productSelector.getId()){this.$emit("onProductClear")}}},template:'\n\t\t<div class="catalog-pf-product-item-section" :id="selectorId" ref="selectorWrapper"></div>\n\t'});function N(){var t=babelHelpers.taggedTemplateLiteral(["",""]);N=function e(){return t};return t}function S(){var t=babelHelpers.taggedTemplateLiteral(["",""]);S=function e(){return t};return t}u.Vue.component(_.templateFieldBrand,{props:{brands:[Array,String],options:Object,editable:Boolean,hasError:Boolean,selectorId:String},data:function t(){return{cache:new p.Cache.MemoryCache}},created:function t(){this.selector=new c.TagSelector({id:this.selectorId,dialogOptions:{id:this.selectorId,context:"CATALOG_BRANDS",preselectedItems:this.getPreselectedBrands(),events:{"Item:onSelect":this.onBrandChange.bind(this),"Item:onDeselect":this.onBrandChange.bind(this),"Search:onItemCreateAsync":this.createBrand.bind(this)},searchTabOptions:{stub:true,stubOptions:{title:p.Tag.message(S(),"CATALOG_FORM_BRAND_SELECTOR_IS_EMPTY_TITLE"),subtitle:p.Tag.message(N(),"CATALOG_FORM_BRAND_SELECTOR_IS_EMPTY_SUBTITLE"),arrow:true}},searchOptions:{allowCreateItem:true},entities:[{id:"brand",options:{iblockId:this.options.iblockId},dynamicSearch:true,dynamicLoad:true}]}})},mounted:function t(){this.selector.renderTo(this.$refs.brandSelectorWrapper)},methods:{getPreselectedBrands:function t(){if(!p.Type.isArray(this.brands)||this.brands.length===0){return[]}return this.brands.map(function(t){return["brand",t]})},onBrandChange:function t(e){var i=e.getTarget().getSelectedItems();var o=[];if(p.Type.isArray(i)){i.forEach(function(t){o.push(t.getId())})}this.$emit("changeBrand",o)},createBrand:function t(e){var i=e.getData(),o=i.searchQuery;var n=this.options.iblockId;return new Promise(function(t,i){var s=e.getTarget();var a={name:o.getQuery(),iblockId:n};s.showLoader();p.ajax.runAction("catalog.productForm.createBrand",{data:{fields:a}}).then(function(e){s.hideLoader();var i=s.addItem({id:e.data.id,entityId:"brand",title:o.getQuery(),tabs:s.getRecentTab().getId()});if(i){i.select()}s.hide();t()}).catch(function(){return i()})})}},computed:{localize:function t(){return u.Vue.getFilteredPhrases("CATALOG_")}},template:'\n\t\t<div class="catalog-pf-product-control ui-ctl-w100" v-bind:class="{ \'ui-ctl-danger\': hasError }">\n\t\t\t<div class="catalog-pf-product-input-wrapper" ref="brandSelectorWrapper" :id="selectorId"></div>\n\t\t</div>\n\t'});var M=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(M,"REGULAR","REGULAR");babelHelpers.defineProperty(M,"FACEBOOK","FACEBOOK");u.Vue.component(_.templateRowName,{props:{basketItem:Object,basketItemIndex:Number,countItems:Number,options:Object,mode:String},data:function t(){return{currencySymbol:null,productSelector:null,imageControlId:null,selectorId:this.basketItem.selectorId,blocks:{productSelector:A.PRODUCT_SELECTOR,quantity:A.QUANTITY,price:A.PRICE,result:A.RESULT,discount:A.DISCOUNT,tax:A.TAX,brand:A.BRAND},errorCodes:{emptyProductSelector:k.EMPTY_PRODUCT_SELECTOR,emptyImage:k.EMPTY_IMAGE,emptyQuantity:k.EMPTY_QUANTITY,emptyPrice:k.EMPTY_PRICE,emptyBrand:k.EMPTY_BRAND}}},created:function t(){var e=this;var i=this.basketItem.fields;var o=p.Text.toNumber(i.price);var n=i.basePrice||o;var s={QUANTITY:p.Text.toNumber(i.quantity),BASE_PRICE:n,PRICE:o,PRICE_NETTO:n,PRICE_BRUTTO:o,PRICE_EXCLUSIVE:this.basketItem.fields.priceExclusive||o,DISCOUNT_TYPE_ID:p.Text.toNumber(i.discountType)||P.DiscountType.PERCENTAGE,DISCOUNT_RATE:p.Text.toNumber(i.discountRate),DISCOUNT_SUM:p.Text.toNumber(i.discount),TAX_INCLUDED:i.taxIncluded||this.options.taxIncluded,TAX_RATE:i.tax||0,CUSTOMIZED:i.isCustomPrice||"N"};var a=this.options.pricePrecision||2;this.calculator=new P.ProductCalculator(s,{currencyId:this.options.currency,pricePrecision:a,commonPrecision:a});this.calculator.setCalculationStrategy(new P.TaxForPriceStrategy(this.calculator));this.currencySymbol=this.options.currencySymbol;this.defaultMeasure={name:"",id:null};if(p.Type.isArray(this.options.measures)){this.options.measures.map(function(t){if(t["IS_DEFAULT"]==="Y"){e.defaultMeasure.name=t.SYMBOL;e.defaultMeasure.code=t.CODE;if(!i.measureName&&!i.measureCode){e.changeProduct({measureCode:e.defaultMeasure.code,measureName:e.defaultMeasure.name})}}})}this.onInputDiscount=p.Runtime.debounce(this.changeDiscount,500,this)},updated:function t(){if(p.Type.isObject(this.basketItem.calculatedFields)){var e=this.basketItem.calculatedFields;e["PRICES"]={};e["PRICES"][this.options.basePriceId]={PRICE:e.BASE_PRICE||e.PRICE,CURRENCY:this.options.currency};e["MEASURE_CODE"]=this.basketItem.fields.measureCode;O.EventEmitter.emit(this,"ProductList::onChangeFields",{rowId:this.selectorId,fields:e})}},methods:{getField:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this.basketItem.fields[e]||i},getCalculator:function t(){return this.calculator},setCalculatedFields:function t(e){var i={calculatedFields:e};var o=this.basketItem.fields;if(!p.Type.isNil(e.ID)){i.offerId=p.Text.toNumber(e.ID);o.productId=p.Text.toNumber(e.PRODUCT_ID);o.skuId=p.Text.toNumber(e.SKU_ID)}if(!p.Type.isNil(e.NAME)){o.name=e.NAME}if(!p.Type.isNil(e.MODULE)){o.module=e.MODULE}if(p.Text.toNumber(e.BASE_PRICE)>=0){o.basePrice=p.Text.toNumber(e.BASE_PRICE)}if(p.Text.toNumber(e.PRICE)>=0){o.price=p.Text.toNumber(e.PRICE);o.priceExclusive=p.Text.toNumber(e.PRICE_EXCLUSIVE)}if(p.Text.toNumber(e.PRICE_EXCLUSIVE)>=0&&e.TAX_INCLUDED==="Y"){o.priceExclusive=p.Text.toNumber(e.PRICE)}if(p.Text.toNumber(e.QUANTITY)>=0){o.quantity=p.Text.toNumber(e.QUANTITY)}if(!p.Type.isNil(e.DISCOUNT_RATE)){o.discountRate=p.Text.toNumber(e.DISCOUNT_RATE)}if(!p.Type.isNil(e.DISCOUNT_SUM)){o.discount=p.Text.toNumber(e.DISCOUNT_SUM)}if(!p.Type.isNil(e.DISCOUNT_TYPE_ID)){o.discountType=e.DISCOUNT_TYPE_ID}if(p.Text.toNumber(e.SUM)>=0){i.sum=p.Text.toNumber(e.SUM)}if(!p.Type.isNil(e.CUSTOMIZED)){o.isCustomPrice=e.CUSTOMIZED}if(!p.Type.isNil(e.MEASURE_CODE)){o.measureCode=e.MEASURE_CODE}if(!p.Type.isNil(e.MEASURE_NAME)){o.measureName=e.MEASURE_NAME}if(!p.Type.isNil(e.PROPERTIES)){o.properties=e.PROPERTIES}if(!p.Type.isNil(e.BRANDS)){o.brands=e.BRANDS}if(!p.Type.isNil(e.TAX_ID)){o.taxId=e.TAX_ID}this.changeRowData(i);this.changeProduct(o)},changeRowData:function t(e){this.$emit("changeRowData",{index:this.basketItemIndex,fields:e})},changeProduct:function t(e){e=Object.assign(this.basketItem.fields,e);this.$emit("changeProduct",{index:this.basketItemIndex,fields:e})},onProductChange:function t(e){e=Object.assign(this.getCalculator().calculatePrice(e.BASE_PRICE),e);this.getCalculator().setFields(e);this.setCalculatedFields(e)},onProductClear:function t(){var e=this.getCalculator().calculatePrice(0);e.BASE_PRICE=0;e.NAME="";e.ID=0;e.PRODUCT_ID=0;e.SKU_ID=0;e.MODULE="";this.getCalculator().setFields(e);this.setCalculatedFields(e)},toggleDiscount:function t(e){var i=this;if(this.isReadOnly){return}this.changeRowData({showDiscount:e});if(e==="Y"){setTimeout(function(){var t,e,o,n;return(t=i.$refs)===null||t===void 0?void 0:(e=t.discountWrapper)===null||e===void 0?void 0:(o=e.$refs)===null||o===void 0?void 0:(n=o.discountInput)===null||n===void 0?void 0:n.focus()})}},toggleTax:function t(e){this.changeRowData({showTax:e})},changeBrand:function t(e){var i=this.getCalculator().getFields();i.BRANDS=p.Type.isArray(e)?e:[];this.setCalculatedFields(i)},processFields:function t(e){this.setCalculatedFields(e);this.getCalculator().setFields(e)},changeQuantity:function t(e){this.processFields(this.getCalculator().calculateQuantity(e))},changeMeasure:function t(e){var i=this.basketItem.fields;i["measureCode"]=e.code;i["measureName"]=e.name;this.changeProduct(i)},changePrice:function t(e){var i=this.getCalculator().calculatePrice(e);i.BASE_PRICE=e;this.processFields(i)},changeDiscountType:function t(e){var i=p.Text.toNumber(e)===P.DiscountType.MONETARY?P.DiscountType.MONETARY:P.DiscountType.PERCENTAGE;this.processFields(this.getCalculator().calculateDiscountType(i))},changeDiscount:function t(e){this.processFields(this.getCalculator().calculateDiscount(e))},changeTax:function t(e){var i=this.getCalculator().calculateTax(e.taxValue);i.TAX_ID=e.taxId;this.processFields(i)},changeTaxIncluded:function t(e){if(e===this.basketItem.taxIncluded||!this.isEditableField(this.blocks.tax)){return}var i=this.getCalculator().calculateTaxIncluded(e);this.getCalculator().setFields(i);this.setCalculatedFields(i)},removeItem:function t(){this.$emit("removeItem",{index:this.basketItemIndex})},isRequiredField:function t(e){return p.Type.isArray(this.options.requiredFields)&&this.options.requiredFields.includes(e)},isVisibleBlock:function t(e){return p.Type.isArray(this.options.visibleBlocks)&&this.options.visibleBlocks.includes(e)},hasError:function t(e){if(this.basketItem.errors.length===0){return false}var i=this.basketItem.errors.filter(function(t){return t.code===e});return i.length>0},isEditableField:function t(e){var i;return(i=this.options)===null||i===void 0?void 0:i.editableFields.includes(e)}},watch:{taxIncluded:function t(e,i){if(e!==i){this.changeTaxIncluded(e)}}},computed:{localize:function t(){return u.Vue.getFilteredPhrases("CATALOG_FORM_")},showDiscount:function t(){return this.showDiscountBlock&&this.basketItem.showDiscount==="Y"},getBrandsSelectorId:function t(){return this.basketItem.selectorId+"_brands"},getPriceExclusive:function t(){return this.basketItem.fields.priceExclusive||this.basketItem.fields.price},showDiscountBlock:function t(){return this.options.showDiscountBlock==="Y"&&this.isVisibleBlock(this.blocks.discount)&&!this.isReadOnly},showTaxBlock:function t(){return this.options.showTaxBlock==="Y"&&this.getTaxList.length>0&&this.isVisibleBlock(this.blocks.tax)&&!this.isReadOnly},showRemoveIcon:function t(){if(this.isReadOnly){return false}if(this.countItems>1){return true}return this.basketItem.offerId!==null},showTaxSelector:function t(){return this.basketItem.showTax==="Y"},showBasePrice:function t(){return this.basketItem.fields.discount>0||p.Text.toNumber(this.basketItem.fields.price)!==p.Text.toNumber(this.basketItem.fields.basePrice)},getMeasureName:function t(){return this.basketItem.fields.measureName||this.defaultMeasure.name},getMeasureCode:function t(){return this.basketItem.fields.measureCode||this.defaultMeasure.code},getTaxList:function t(){return p.Type.isArray(this.options.taxList)?this.options.taxList:[]},taxIncluded:function t(){return this.basketItem.fields.taxIncluded},isTaxIncluded:function t(){return this.taxIncluded==="Y"},isReadOnly:function t(){return this.mode===L.READ_ONLY}},template:'\n\t\t<div class="catalog-pf-product-item" v-bind:class="{ \'catalog-pf-product-item--borderless\': !isReadOnly && basketItemIndex === 0 }">\n\t\t\t<div class="catalog-pf-product-item--remove" @click="removeItem" v-if="showRemoveIcon"></div>\n\t\t\t<div class="catalog-pf-product-item--num">\n\t\t\t\t<div class="catalog-pf-product-index">{{basketItemIndex + 1}}</div>\n\t\t\t</div>\n\t\t\t<div class="catalog-pf-product-item--left">\n\t\t\t\t<div v-if="isVisibleBlock(blocks.productSelector)">\n\t\t\t\t\t<div class="catalog-pf-product-item-section">\n\t\t\t\t\t\t<div class="catalog-pf-product-label">{{localize.CATALOG_FORM_NAME}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<'.concat(_.templateFieldInlineSelector,' \n\t\t\t\t\t\t:basketItem="basketItem" \n\t\t\t\t\t\t:options="options"\n\t\t\t\t\t\t:editable="isEditableField(blocks.productSelector)"\n\t\t\t\t\t\t@onProductChange="onProductChange" \n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="isVisibleBlock(blocks.brand)" class="catalog-pf-product-input-brand-wrapper">\n\t\t\t\t\t<div class="catalog-pf-product-item-section">\n\t\t\t\t\t\t<div class="catalog-pf-product-label">{{localize.CATALOG_FORM_BRAND_TITLE}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<').concat(_.templateFieldBrand,' \n\t\t\t\t\t\t:brands="basketItem.fields.brands"\n\t\t\t\t\t\t:selectorId="getBrandsSelectorId"\n\t\t\t\t\t\t:hasError="hasError(errorCodes.emptyBrand)"\n\t\t\t\t\t\t:options="options"\n\t\t\t\t\t\t:editable="isEditableField(blocks.brand)"\n\t\t\t\t\t\t@changeBrand="changeBrand" \n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t</div>\n\t\t\t<div class="catalog-pf-product-item--right">\n\t\t\t\t<div class="catalog-pf-product-item-section">\n\t\t\t\t\t<div v-if="isVisibleBlock(blocks.price)" class="catalog-pf-product-label" style="width: 94px">\n\t\t\t\t\t\t{{localize.CATALOG_FORM_PRICE}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="isVisibleBlock(blocks.quantity)" class="catalog-pf-product-label" style="width: 72px">\n\t\t\t\t\t\t{{localize.CATALOG_FORM_QUANTITY}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="isVisibleBlock(blocks.result)" class="catalog-pf-product-label" style="width: 94px">\n\t\t\t\t\t\t{{localize.CATALOG_FORM_RESULT}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="catalog-pf-product-item-section">\n\t\t\t\t\n\t\t\t\t\t<div v-if="isVisibleBlock(blocks.price)" class="catalog-pf-product-control" style="width: 94px">\n\t\t\t\t\t\t<').concat(_.templateFieldPrice,' \n\t\t\t\t\t\t\t:basePrice="basketItem.fields.basePrice"\n\t\t\t\t\t\t\t:options="options"\n\t\t\t\t\t\t\t:editable="isEditableField(blocks.price)"\n\t\t\t\t\t\t\t:hasError="hasError(errorCodes.emptyPrice)"\n\t\t\t\t\t\t\t@changePrice="changePrice"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div v-if="isVisibleBlock(blocks.quantity)" class="catalog-pf-product-control" style="width: 72px">\n\t\t\t\t\t\t<').concat(_.templateFieldQuantity,' \n\t\t\t\t\t\t\t:quantity="basketItem.fields.quantity"\n\t\t\t\t\t\t\t:measureCode="getMeasureCode"\n\t\t\t\t\t\t\t:measureRatio="basketItem.fields.measureRatio"\n\t\t\t\t\t\t\t:measureName="getMeasureName"\n\t\t\t\t\t\t\t:hasError="hasError(errorCodes.emptyQuantity)"\n\t\t\t\t\t\t\t:options="options"\n\t\t\t\t\t\t\t:editable="isEditableField(blocks.quantity)"\n\t\t\t\t\t\t\t@changeQuantity="changeQuantity" \n\t\t\t\t\t\t\t@changeMeasure="changeMeasure" \n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div v-if="isVisibleBlock(blocks.result)" class="catalog-pf-product-control" style="width: 94px">\n\t\t\t\t\t\t<div class="catalog-pf-product-input-wrapper">\n\t\t\t\t\t\t\t<input disabled type="text" class="catalog-pf-product-input catalog-pf-product-input--disabled catalog-pf-product-input--gray catalog-pf-product-input--align-right" :value="basketItem.sum">\n\t\t\t\t\t\t\t<div class="catalog-pf-product-input-info catalog-pf-product-input--disabled catalog-pf-product-input--gray" v-html="currencySymbol"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="hasError(errorCodes.emptyQuantity)" class="catalog-pf-product-item-section">\n\t\t\t\t\t<div class="catalog-product-error">{{localize.CATALOG_FORM_ERROR_EMPTY_QUANTITY}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="hasError(errorCodes.emptyPrice)" class="catalog-pf-product-item-section">\n\t\t\t\t\t<div class="catalog-product-error">{{localize.CATALOG_FORM_ERROR_EMPTY_PRICE}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="showDiscountBlock" class="catalog-pf-product-item-section">\n\t\t\t\t\t<div v-if="showDiscount" class="catalog-pf-product-link-toggler catalog-pf-product-link-toggler--hide" @click="toggleDiscount(\'N\')">{{localize.CATALOG_FORM_DISCOUNT_TITLE}}</div>\n\t\t\t\t\t<div v-else class="catalog-pf-product-link-toggler catalog-pf-product-link-toggler--show" @click="toggleDiscount(\'Y\')">{{localize.CATALOG_FORM_DISCOUNT_TITLE}}</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div v-if="showDiscount" class="catalog-pf-product-item-section">\n\t\t\t\t\t<').concat(_.templateFieldDiscount,' \n\t\t\t\t\t\t:discount="basketItem.fields.discount"\n\t\t\t\t\t\t:discountType="basketItem.fields.discountType"\n\t\t\t\t\t\t:discountRate="basketItem.fields.discountRate"\n\t\t\t\t\t\t:options="options"\n\t\t\t\t\t\t:editable="isEditableField(blocks.discount)"\n\t\t\t\t\t\tref="discountWrapper"\n\t\t\t\t\t\t@changeDiscount="changeDiscount" \n\t\t\t\t\t\t@changeDiscountType="changeDiscountType" \n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div v-if="showTaxBlock" class="catalog-pf-product-item-section catalog-pf-product-item-section--dashed">\n\t\t\t\t\t<div v-if="showTaxSelector" class="catalog-pf-product-link-toggler catalog-pf-product-link-toggler--hide" @click="toggleTax(\'N\')">{{localize.CATALOG_FORM_TAX_TITLE}}</div>\n\t\t\t\t\t<div v-else class="catalog-pf-product-link-toggler catalog-pf-product-link-toggler--show" @click="toggleTax(\'Y\')">{{localize.CATALOG_FORM_TAX_TITLE}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="showTaxSelector && showTaxBlock" class="catalog-pf-product-item-section">\n\t\t\t\t\t<').concat(_.templateFieldTax,' \n\t\t\t\t\t\t:taxId="basketItem.fields.taxId"\n\t\t\t\t\t\t:options="options"\n\t\t\t\t\t\t:editable="isEditableField(blocks.tax)"\n\t\t\t\t\t\t@changeProduct="changeProduct" \n\t\t\t\t\t/>\n\t\t\t\t</div>\t\t\t\t\n\t\t\t\t<div class="catalog-pf-product-item-section catalog-pf-product-item-section--dashed"></div>\n\t\t\t</div>\n\t\t</div>\n\t')});var B=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(B,"COMPILATION_FACEBOOK",13856526);babelHelpers.defineProperty(B,"COMMON_COMPILATION",13841876);function x(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="catalog-product-form-popup--container">\n\t\t\t\t\t<div class="catalog-product-form-popup--title">','</div>\n\t\t\t\t\t<div class="catalog-product-form-popup--loader-block catalog-product-form-popup--done"></div>\n\t\t\t\t\t<div class="catalog-product-form-popup--text">',"</div>\n\t\t\t\t</div>\n\t\t\t"]);x=function e(){return t};return t}function D(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="catalog-product-form-popup--container">\n\t\t\t\t\t<div class="catalog-product-form-popup--title">',"</div>\n\t\t\t\t\t",'\n\t\t\t\t\t<div class="catalog-product-form-popup--text">',"</div>\n\t\t\t\t</div>\n\t\t\t"]);D=function e(){return t};return t}function w(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="catalog-product-form-popup--loader-block"></div>\n\t\t\t']);w=function e(){return t};return t}function F(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<span>",'</span>\n\t\t\t\t\t\t\t\t\t\t<a href="/shop/stores/" target="_blank">\n\t\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t"]);F=function e(){return t};return t}function U(){var t=babelHelpers.taggedTemplateLiteral(["",""]);U=function e(){return t};return t}function G(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="catalog-pf-product-qr-popup">\n\t\t\t\t\t\t<div class="catalog-pf-product-qr-popup-content">\n\t\t\t\t\t\t\t<div class="catalog-pf-product-qr-popup-text">',"</div>\n\t\t\t\t\t\t\t",'\n\t\t\t\t\t\t\t<div class="catalog-pf-product-qr-popup-buttons">\n\t\t\t\t\t\t\t\t<a href="','" target="_blank" class="ui-btn ui-btn-light-border ui-btn-round">','</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="catalog-pf-product-qr-popup-bottom">\n\t\t\t\t\t\t\t<a href="','" target="_blank" class="catalog-pf-product-qr-popup--url">',"</a>\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t</div>\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t"]);G=function e(){return t};return t}function Y(){var t=babelHelpers.taggedTemplateLiteral(['<div class="catalog-pf-product-qr-popup-image"></div>']);Y=function e(){return t};return t}function H(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="catalog-pf-product-qr-popup-copy">',"</div>\n\t\t\t"]);H=function e(){return t};return t}function X(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t<p>","</p>\n\t\t\t\t<p>","</p>\n\t\t\t"]);X=function e(){return t};return t}function $(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="ui-btn ui-btn-primary">',"</a>\n\t\t"]);$=function e(){return t};return t}u.Vue.component(_.templatePanelCompilation,{props:{compilationOptions:Object,mode:String},created:function t(){O.EventEmitter.subscribe("BX.Catalog.ProductSelector:onChange",this.destroyPopup.bind(this));O.EventEmitter.subscribe("BX.Catalog.ProductSelector:onClear",this.destroyPopup.bind(this));this.newLabel=new f.Label({text:this.localize.CATALOG_FORM_COMPILATION_PRODUCT_NEW_LABEL,color:f.LabelColor.PRIMARY,fill:true});var e=p.Tag.render($(),this.localize.CATALOG_FORM_COMPILATION_INFO_BUTTON_MORE);p.Event.bind(e,"click",this.openHelpDesk);var i="";var o="";if(this.isFacebookForm()){i=this.localize.CATALOG_FORM_COMPILATION_INFO_MESSAGE_TITLE_FACEBOOK;o=p.Tag.render(X(),this.localize.CATALOG_FORM_COMPILATION_INFO_MESSAGE_BODY_FACEBOOK_FIRST_BLOCK,this.localize.CATALOG_FORM_COMPILATION_INFO_MESSAGE_BODY_FACEBOOK_SECOND_BLOCK)}else{i=this.localize.CATALOG_FORM_COMPILATION_INFO_MESSAGE_TITLE;o=this.localize.CATALOG_FORM_COMPILATION_INFO_MESSAGE_BODY_MARKETING}this.message=new m.MessageCard({id:"compilationInfo",header:i,description:o,angle:false,hidden:true,actionElements:[e]});O.EventEmitter.subscribe(this.message,"onClose",this.hideMessage)},mounted:function t(){this.$refs.label.appendChild(this.newLabel.render());this.$refs.message.appendChild(this.message.getLayout());if(!this.compilationOptions.hiddenInfoMessage){this.showMessage()}},data:function t(){return{compilationLink:null}},methods:{isFacebookForm:function t(){return this.compilationOptions.type===M.FACEBOOK},openHelpDesk:function t(){this.helpdeskCode=this.isFacebookForm()?B.COMPILATION_FACEBOOK:B.COMMON_COMPILATION;top.BX.Helper.show("redirect=detail&code="+this.helpdeskCode)},showPopup:function t(e){var i=this;if(this.compilationOptions.disabledSwitcher){return}if(this.isFacebookForm()){this.openHelpDesk();return}if(this.popup instanceof d.Popup){this.popup.setBindElement(this.$refs.qrLink);this.popup.show();return}var o=this.$store.getters["productList/getBasket"]();var n=o.map(function(t){var e;return t===null||t===void 0?void 0:(e=t.fields)===null||e===void 0?void 0:e.skuId});return new Promise(function(t,o){p.ajax.runAction("salescenter.api.store.getLinkToProductCollection",{json:{productIds:n}}).then(function(o){i.compilationLink=o.data.link;i.popup=new d.Popup({bindElement:e.target,content:i.getQRPopupContent(),width:375,closeIcon:{top:"5px",right:"5px"},padding:0,closeByEsc:true,autoHide:true,cacheable:true,animation:"fading-slide",angle:{offset:30}});i.popup.show();t()}).catch(function(){return o()})})},destroyPopup:function t(){if(this.popup instanceof d.Popup){this.popup.destroy();this.popup=null}},getQRPopupContent:function t(){var e=this;if(!this.compilationLink){return""}var i=p.Tag.render(H(),this.localize.CATALOG_FORM_COMPILATION_QR_COPY);p.Event.bind(i,"click",function(){BX.clipboard.copy(e.compilationLink);BX.UI.Notification.Center.notify({content:e.localize.CATALOG_FORM_COMPILATION_QR_COPY_NOTIFY_MESSAGE,autoHideDelay:2e3})});var o=p.Tag.render(Y());var n=p.Tag.render(G(),this.localize.CATALOG_FORM_COMPILATION_QR_POPUP_TITLE,o,this.compilationLink,this.localize.CATALOG_FORM_COMPILATION_QR_POPUP_INPUT_TITLE,this.compilationLink,this.compilationLink,i);new QRCode(o,{text:this.compilationLink,width:250,height:250});return n},setSetting:function t(e){var i=this;var o=e.target.checked?"Y":"N";if(!this.compilationOptions.hasStore){this.compilationOptions.disabledSwitcher=true;var n=new d.Popup({bindElement:e.target,className:"catalog-product-form-popup--creating-shop",content:this.getOnBeforeCreationStorePopupContent(),width:310,overlay:true,padding:17,animation:"fading-slide",angle:false});n.show();p.ajax.runAction("salescenter.api.store.getStoreInfo",{json:{}}).then(function(t){var e,s;if(p.Type.isStringFilled((e=t.data)===null||e===void 0?void 0:(s=e.deactivatedStore)===null||s===void 0?void 0:s.TITLE)){var a,r;var c=p.Loc.getMessage("CATALOG_FORM_COMPILATION_UNPUBLISHED_STORE",{"#STORE_TITLE#":p.Tag.safe(U(),(a=t.data)===null||a===void 0?void 0:(r=a.deactivatedStore)===null||r===void 0?void 0:r.TITLE)});BX.UI.Notification.Center.notify({content:p.Tag.render(F(),c,p.Loc.getMessage("CATALOG_FORM_COMPILATION_UNPUBLISHED_STORE_LINK"))})}n.setContent(i.getOnAfterCreationStorePopupContent());n.setClosingByEsc(true);n.setAutoHide(true);n.show();i.$root.$app.changeFormOption("isCompilationMode",o);i.compilationOptions.disabledSwitcher=i.compilationOptions.isLimitedStore;i.compilationOptions.hasStore=true})}else{this.$root.$app.changeFormOption("isCompilationMode",o)}},getOnBeforeCreationStorePopupContent:function t(){var e=p.Tag.render(w());var i=p.Tag.render(D(),p.Loc.getMessage("CATALOG_FORM_POPUP_BEFORE_MARKET_CREATING"),e,p.Loc.getMessage("CATALOG_FORM_POPUP_BEFORE_MARKET_CREATING_INFO"));var o=new h.Loader({color:"#2fc6f6",target:e,size:40});o.show();return i},getOnAfterCreationStorePopupContent:function t(){return p.Tag.render(x(),p.Loc.getMessage("CATALOG_FORM_POPUP_AFTER_MARKET_CREATING"),p.Loc.getMessage("CATALOG_FORM_POPUP_AFTER_MARKET_CREATING_INFO"))},onLabelClick:function t(){if(this.compilationOptions.isLimitedStore){BX.UI.InfoHelper.show("limit_sites_number")}},onClickHint:function t(e){e.preventDefault();e.stopImmediatePropagation();if(!this.message){return}if(this.message.isShown()){this.hideMessage()}else{this.showMessage()}},showMessage:function t(){if(this.message){p.Dom.addClass(this.$refs.hintIcon,"catalog-pf-product-panel-message-arrow-target");this.message.show()}},hideMessage:function t(){if(this.message){p.Dom.removeClass(this.$refs.hintIcon,"catalog-pf-product-panel-message-arrow-target")}this.message.hide();this.$root.$app.changeFormOption("hiddenCompilationInfoMessage","Y")}},computed:babelHelpers.objectSpread({localize:function t(){return u.Vue.getFilteredPhrases("CATALOG_")},showQrLink:function t(){return this.mode===L.COMPILATION}},l.Vuex.mapState({productList:function t(e){return e.productList}})),template:'\n\t\t<div>\n\t\t\t<div class="catalog-pf-product-panel-compilation">\n\t\t\t\t<div class="catalog-pf-product-panel-compilation-wrapper">\n\t\t\t\t\t<label class="ui-ctl ui-ctl-checkbox" @click="onLabelClick">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\ttype="checkbox" \n\t\t\t\t\t\t\t:disabled="compilationOptions.disabledSwitcher"\n\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\t@change="setSetting" \n\t\t\t\t\t\t\tdata-setting-id="isCompilationMode"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<div class="ui-ctl-label-text">{{localize.CATALOG_FORM_COMPILATION_PRODUCT_SWITCHER}}</div>\n\t\t\t\t\t\t<div ref="hintIcon">\n\t\t\t\t\t\t\t<div data-hint-init="vue" class="ui-hint" @click="onClickHint">\n\t\t\t\t\t\t\t\t<span class="ui-hint-icon"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div ref="label"></div>\n\t\t\t\t\t\t<div class="tariff-lock" v-if="compilationOptions.isLimitedStore"></div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div \t\t\t\t\n\t\t\t\t\tv-if="showQrLink"\n\t\t\t\t\tclass="catalog-pf-product-panel-compilation-link --icon-qr"\n\t\t\t\t\t@click="showPopup"\n\t\t\t\t\tref="qrLink"\n\t\t\t\t>\n\t\t\t\t\t{{localize.CATALOG_FORM_COMPILATION_QR_LINK}}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="catalog-pf-product-panel-compilation-message" ref="message"></div>\n\t\t</div>\n\t'});function V(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t\t<div class='catalog-pf-product-config-popup'></div>\n\t\t\t\t"]);V=function e(){return t};return t}function q(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<label class="ui-ctl ui-ctl-checkbox ui-ctl-w100">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl-label-text">',"</div>\n\t\t\t\t</label>\n\t\t\t"]);q=function e(){return t};return t}function Q(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<input type="checkbox"  class="ui-ctl-element">\n\t\t\t\t']);Q=function e(){return t};return t}u.Vue.component(_.templatePanelButtons,{props:{options:Object,mode:String},methods:{refreshBasket:function t(){this.$emit("refreshBasket")},changeBasketItem:function t(e){this.$emit("changeRowData",e)},addBasketItemForm:function t(){this.$emit("addItem")},getInternalIndexByProductId:function t(e){var i=this.$store.getters["productList/getBasket"]();return Object.keys(i).findIndex(function(t){return parseInt(i[t].skuId)===parseInt(e)})},handleAddItem:function t(e,i){var o=this;var n=4;if(p.Text.toNumber(i.type)===n){p.ajax.runAction("catalog.productSelector.getSelectedSku",{json:{variationId:e,options:{priceId:this.options.basePriceId,urlBuilder:this.options.urlBuilder,resetSku:true}}}).then(function(t){return o.processResponse(t)})}else{p.ajax.runAction("catalog.productSelector.getProduct",{json:{productId:e,options:{priceId:this.options.basePriceId,urlBuilder:this.options.urlBuilder}}}).then(function(t){return o.processResponse(t)})}},processResponse:function t(e){var i=this.getInternalIndexByProductId(e.data.skuId);if(i<0){var o=e.data;var n=p.Text.toNumber(o.fields.PRICE);o.fields=o.fields||{};var s=this.$store.getters["productList/getBaseProduct"]();s.fields=Object.assign(s.fields,{price:n,priceExclusive:n,basePrice:n,name:o.fields.NAME||"",productId:o.productId,skuId:o.skuId,offerId:o.skuId>0?o.skuId:o.productId,module:"catalog",isCustomPrice:p.Type.isNil(o.fields.PRICE)?"Y":"N",discountType:this.options.defaultDiscountType});delete o.fields;s=Object.assign(s,o);s.sum=n;this.$root.$app.addProduct(s)}},onUpdateBasketItem:function t(e,i){this.$store.dispatch("productList/changeRowData",{index:e,fields:i});this.$store.dispatch("productList/changeProduct",{index:e,fields:i.fields})},removeEmptyItems:function t(){var e=this;var i=this.$store.getters["productList/getBasket"]();i.forEach(function(t,o){if(i[o].name===""&&i[o].price<1e-10){e.$store.commit("productList/deleteItem",{index:o})}})},modifyBasketItem:function t(e){var i=parseInt(e.id);if(i>0){var o=this.getInternalIndexByProductId(i);if(o>=0){this.showDialogProductExists(e)}else{this.removeEmptyItems();this.handleAddItem(i,e)}}},showDialogProductExists:function t(e){var i=this;this.popup=new d.Popup(null,null,{events:{onPopupClose:function t(){i.popup.destroy()}},zIndex:4e3,autoHide:true,closeByEsc:true,closeIcon:true,titleBar:p.Loc.getMessage("CATALOG_FORM_BLOCK_PROD_EXIST_DLG_TITLE"),draggable:true,resizable:false,lightShadow:true,cacheable:false,overlay:true,content:p.Loc.getMessage("CATALOG_FORM_BLOCK_PROD_EXIST_DLG_TEXT").replace("#NAME#",e.name),buttons:this.getButtons(e)});this.popup.show()},getButtons:function t(e){var i=this;var o=[];var n=e;o.push(new BX.UI.SaveButton({text:p.Loc.getMessage("CATALOG_FORM_BLOCK_PROD_EXIST_DLG_OK"),onclick:function t(){var e=parseInt(n.id);var o=i.getInternalIndexByProductId(e);if(o>=0){var s=i.$store.getters["productList/getBasket"]()[o];s.fields.quantity++;s.calculatedFields.QUANTITY++;i.onUpdateBasketItem(o,s)}i.popup.destroy()}}));o.push(new BX.UI.CancelButton({text:p.Loc.getMessage("CATALOG_FORM_BLOCK_PROD_EXIST_DLG_NO"),onclick:function t(){i.popup.destroy()}}));return o},showDialogProductSearch:function t(){var e=this;var i="addBasketItemFromDialogProductSearch";window[i]=function(t){return e.modifyBasketItem(t)};var o=new BX.CDialog({content_url:"/bitrix/tools/sale/product_search_dialog.php?"+"&caller=order_edit"+"&func_name="+i+"&STORE_FROM_ID=0"+"&public_mode=Y",height:Math.max(500,window.innerHeight-400),width:Math.max(800,window.innerWidth-400),draggable:true,resizable:true,min_height:500,min_width:800,zIndex:3100});o.Show()},setSetting:function t(e){if(e.target.dataset.settingId==="taxIncludedOption"){var i=e.target.checked?"Y":"N";this.$root.$app.changeFormOption("taxIncluded",i)}else if(e.target.dataset.settingId==="showDiscountInputOption"){var o=e.target.checked?"Y":"N";this.$root.$app.changeFormOption("showDiscountBlock",o)}else if(e.target.dataset.settingId==="showTaxInputOption"){var n=e.target.checked?"Y":"N";this.$root.$app.changeFormOption("showTaxBlock",n)}},getSettingItem:function t(e){var i=p.Tag.render(Q());i.checked=e.checked;i.dataset.settingId=e.id;var o=p.Tag.render(q(),i,e.title);p.Event.bind(o,"change",this.setSetting.bind(this));return o},prepareSettingsContent:function t(){var e=this;var i=[{id:"showDiscountInputOption",checked:this.options.showDiscountBlock!=="N",title:this.localize.CATALOG_FORM_ADD_SHOW_DISCOUNTS_OPTION}];var o=p.Tag.render(V());i.forEach(function(t){o.append(e.getSettingItem(t))});return o},showConfigPopup:function t(e){if(!this.popupMenu){this.popupMenu=new d.Popup(null,e.target,{autoHide:true,draggable:false,offsetLeft:0,offsetTop:0,noAllPaddings:true,bindOptions:{forceBindPosition:true},closeByEsc:true,content:this.prepareSettingsContent()})}this.popupMenu.show()}},computed:babelHelpers.objectSpread({localize:function t(){return u.Vue.getFilteredPhrases("CATALOG_")},countItems:function t(){return this.order.basket.length}},l.Vuex.mapState({productList:function t(e){return e.productList}})),template:'\n\t\t<div>\n\t\t\t<div class="catalog-pf-product-add">\n\t\t\t\t<div class="catalog-pf-product-add-wrapper">\n\t\t\t\t\t<span class="catalog-pf-product-add-link" @click="addBasketItemForm">{{localize.CATALOG_FORM_ADD_PRODUCT}}</span>\n\t\t\t\t\t<span class="catalog-pf-product-add-link catalog-pf-product-add-link--gray" @click="showDialogProductSearch">{{localize.CATALOG_FORM_ADD_PRODUCT_FROM_CATALOG}}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="catalog-pf-product-configure-link" @click="showConfigPopup">{{localize.CATALOG_FORM_DISCOUNT_EDIT_PAGE_URL_TITLE}}</div>\n\t\t\t</div>\n\t\t</div>\n\t'});u.Vue.component(_.templateName,{props:{options:Object,mode:String},created:function t(){BX.ajax.runAction("catalog.productSelector.getFileInput",{json:{iblockId:this.options.iblockId}})},methods:{refreshBasket:function t(){this.$store.dispatch("productList/refreshBasket")},changeProduct:function t(e){this.$root.$app.changeProduct(e)},changeRowData:function t(e){delete e.fields.fields;this.$store.dispatch("productList/changeItem",e)},removeItem:function t(e){this.$root.$app.removeProduct(e)},addItem:function t(){this.$root.$app.addProduct()}},computed:babelHelpers.objectSpread({localize:function t(){return u.Vue.getFilteredPhrases("CATALOG_")},showTaxResult:function t(){return this.options.showTaxBlock!=="N"},showResults:function t(){return this.options.showResults!==false},showButtonsTop:function t(){return this.options.singleProductMode!==true&&this.mode!==L.READ_ONLY&&this.options.buttonsPosition!==R.BOTTOM},showButtonsBottom:function t(){return this.options.singleProductMode!==true&&this.mode!==L.READ_ONLY&&this.options.buttonsPosition===R.BOTTOM},showResultBlock:function t(){return this.showResults||this.enableAddButtons},countItems:function t(){return this.productList.basket.length},totalResultLabel:function t(){return this.options.hasOwnProperty("totalResultLabel")&&this.options.totalResultLabel?this.options.totalResultLabel:this.localize.CATALOG_FORM_TOTAL_RESULT}},l.Vuex.mapState({productList:function t(e){return e.productList}})),template:'\n\t<div class="catalog-product-form-container">\n\t\t<'.concat(_.templatePanelButtons,'\n\t\t\t:options="options" \n\t\t\t:mode="mode" \n\t\t\t@refreshBasket="refreshBasket" \n\t\t\t@addItem="addItem"\n\t\t\t@changeRowData="changeRowData"\n\t\t\t@changeProduct="changeProduct" \n\t\t\tv-if="showButtonsTop"\n\t\t/>\n\t\t<div v-for="(item, index) in productList.basket" :key="item.selectorId">\n\t\t\t<').concat(_.templateRowName,' \n\t\t\t\t:basketItem="item" \n\t\t\t\t:basketItemIndex="index"  \n\t\t\t\t:countItems="countItems"\n\t\t\t\t:options="options"\n\t\t\t\t:mode="mode"\n\t\t\t\t@changeProduct="changeProduct" \n\t\t\t\t@changeRowData="changeRowData" \n\t\t\t\t@removeItem="removeItem" \n\t\t\t\t@refreshBasket="refreshBasket" \n\t\t\t/>\n\t\t</div>\n\t\t<').concat(_.templatePanelButtons,'\n\t\t\t:options="options" \n\t\t\t:mode="mode"\n\t\t\t@refreshBasket="refreshBasket" \n\t\t\t@addItem="addItem"\n\t\t\t@changeRowData="changeRowData"\n\t\t\t@changeProduct="changeProduct" \n\t\t\tv-if="showButtonsBottom"\n\t\t/>\n\t\t<').concat(_.templatePanelCompilation,'  \n\t\t\tv-if="options.showCompilationModeSwitcher"\n\t\t\t:compilationOptions="options.compilationFormOption" \n\t\t\t:mode="mode" \n\t\t/>\n\t\t<div class="catalog-pf-result-line"></div>\n\t\t<div class="catalog-pf-result-wrapper" v-if="showResultBlock">\n\t\t\t<table class="catalog-pf-result" v-if="showResultBlock">\n\t\t\t\t<tr v-if="showResults">\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span class="catalog-pf-text">{{localize.CATALOG_FORM_PRODUCTS_PRICE}}:</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span v-html="productList.total.sum"\n\t\t\t\t\t\t\t:class="productList.total.result !== productList.total.sum ? \'catalog-pf-text catalog-pf-text--line-through\' : \'catalog-pf-text\'"\n\t\t\t\t\t\t></span>\n\t\t\t\t\t\t<span class="catalog-pf-symbol" v-html="options.currencySymbol"></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr v-if="showResults">\n\t\t\t\t\t<td class="catalog-pf-result-padding-bottom">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--discount">{{localize.CATALOG_FORM_TOTAL_DISCOUNT}}:</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class="catalog-pf-result-padding-bottom">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--discount" v-html="productList.total.discount"></span>\n\t\t\t\t\t\t<span class="catalog-pf-symbol" v-html="options.currencySymbol"></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr v-if="showResults && showTaxResult">\n\t\t\t\t\t<td class="catalog-pf-tax">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--tax">{{localize.CATALOG_FORM_TAX_TITLE}}:</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class="catalog-pf-tax">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--tax" v-html="productList.total.taxSum"></span>\n\t\t\t\t\t\t<span class="catalog-pf-symbol" v-html="options.currencySymbol"></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr v-if="showResults">\n\t\t\t\t\t<td class="catalog-pf-result-padding">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--total catalog-pf-text--border">{{totalResultLabel}}:</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class="catalog-pf-result-padding">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--total" v-html="productList.total.result"></span>\n\t\t\t\t\t\t<span class="catalog-pf-symbol catalog-pf-symbol--total" v-html="options.currencySymbol"></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>\n\t</div>\n')});function j(){var t=babelHelpers.taggedTemplateLiteral(['<div class=""></div>']);j=function e(){return t};return t}function z(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var K=new WeakSet;var W=new WeakSet;var Z=new WeakSet;var J=new WeakSet;var tt=function(){function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);J.add(this);Z.add(this);W.add(this);K.add(this);this.options=this.prepareOptions(i);this.defaultOptions=Object.assign({},this.options);this.editable=true;z(this,J,nt).call(this,L.REGULAR);this.wrapper=p.Tag.render(j());if(p.Text.toNumber(i.iblockId)<=0){return}t.initStore().then(function(t){return e.initTemplate(t)}).catch(function(e){return t.showError(e)})}babelHelpers.createClass(t,[{key:"prepareOptions",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=p.Extension.getSettings("catalog.product-form");var o={basket:[],measures:[],iblockId:null,basePriceId:i.get("basePriceId"),taxList:[],singleProductMode:false,showResults:true,showCompilationModeSwitcher:false,enableEmptyProductError:true,pricePrecision:2,currency:i.get("currency"),currencySymbol:i.get("currencySymbol"),taxIncluded:i.get("taxIncluded"),showDiscountBlock:i.get("showDiscountBlock"),showTaxBlock:i.get("showTaxBlock"),allowedDiscountTypes:[P.DiscountType.PERCENTAGE,P.DiscountType.MONETARY],visibleBlocks:[A.PRODUCT_SELECTOR,A.PRICE,A.QUANTITY,A.RESULT,A.DISCOUNT],requiredFields:[],editableFields:[],newItemPosition:R.TOP,buttonsPosition:R.TOP,urlBuilderContext:"SHOP",hideUnselectedProperties:false,compilationFormType:M.REGULAR,compilationFormOption:{}};if(e.visibleBlocks&&!p.Type.isArray(e.visibleBlocks)){delete e.visibleBlocks}if(e.requiredFields&&!p.Type.isArray(e.requiredFields)){delete e.requiredFields}e=babelHelpers.objectSpread({},o,e);e.showTaxBlock="N";if(i.get("isEnabledLanding")){e.compilationFormOption={type:e.compilationFormType,hasStore:i.get("hasLandingStore"),isLimitedStore:i.get("isLimitedLandingStore"),disabledSwitcher:i.get("isLimitedLandingStore"),hiddenInfoMessage:i.get("hiddenCompilationInfoMessage")}}else{e.showCompilationModeSwitcher=false}e.defaultDiscountType="";if(p.Type.isArray(e.allowedDiscountTypes)){if(e.allowedDiscountTypes.includes(P.DiscountType.PERCENTAGE)){e.defaultDiscountType=P.DiscountType.PERCENTAGE}else if(e.allowedDiscountTypes.includes(P.DiscountType.MONETARY)){e.defaultDiscountType=P.DiscountType.MONETARY}}return e}},{key:"layout",value:function t(){return this.wrapper}},{key:"initTemplate",value:function t(e){var i=this;return new Promise(function(t){var o=i;i.store=e.store;i.templateEngine=u.BitrixVue.createApp({el:i.wrapper,store:i.store,data:{options:i.options,mode:i.mode},created:function t(){this.$app=o},mounted:function e(){t()},template:"<".concat(_.templateName,' :options="options" :mode="mode"/>')});if(p.Type.isStringFilled(i.options.currency)){i.setData({currency:i.options.currency});C.CurrencyCore.loadCurrencyFormat(i.options.currency)}if(i.options.basket.length>0){i.setData({basket:i.options.basket},{newItemPosition:R.BOTTOM});if(p.Type.isObject(i.options.totals)){i.store.commit("productList/setTotal",i.options.totals)}else{i.store.dispatch("productList/calculateTotal")}}else{var n=i.store.getters["productList/getBaseProduct"]();n.fields.discountType=i.options.defaultDiscountType;i.addProduct(n)}})}},{key:"addProduct",value:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.store.dispatch("productList/addItem",{item:i,position:this.options.newItemPosition}).then(function(){z(e,K,et).call(e)})}},{key:"changeProduct",value:function t(e){var i=this;var o=e.fields;var n=z(this,W,it).call(this,o);o.errors=(n===null||n===void 0?void 0:n.errors)||[];this.store.dispatch("productList/changeItem",{index:e.index,fields:o}).then(function(){z(i,K,et).call(i)})}},{key:"removeProduct",value:function t(e){var i=this;this.store.dispatch("productList/removeItem",{index:e.index}).then(function(){z(i,K,et).call(i)})}},{key:"setData",value:function t(e){var i=this;var o=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(p.Type.isObject(e.basket)){var n=this.store.getters["productList/getBasket"]();e.basket.forEach(function(t){if(!p.Type.isObject(t)){return}var e=o.newItemPosition||i.options.newItemPosition;var s=t.selectorId;if(p.Type.isNil(s)){i.store.dispatch("productList/addItem",{item:t,position:e});return}var a=n.findIndex(function(t){return t.selectorId===s});if(a===-1){i.store.dispatch("productList/addItem",{item:t,position:e})}else{i.store.dispatch("productList/changeItem",{basketIndex:a,fields:t})}})}if(p.Type.isStringFilled(e.currency)){this.store.dispatch("productList/setCurrency",e.currency)}if(p.Type.isObject(e.total)){this.store.commit("productList/setTotal",{sum:e.total.sum,taxSum:e.total.taxSum,discount:e.total.discount,result:e.total.result})}if(p.Type.isObject(e.errors)){this.store.commit("productList/setErrors",e.errors)}}},{key:"changeFormOption",value:function t(e,i){var o=this;i=i==="Y"?"Y":"N";if(e==="isCompilationMode"){if(!this.options.showCompilationModeSwitcher){return}var n=i==="Y"?L.COMPILATION:L.REGULAR;z(this,Z,ot).call(this,n);return}this.options[e]=i;if(e!=="hiddenCompilationInfoMessage"){var s=this.store.getters["productList/getBasket"]();s.forEach(function(t,n){if(e==="showDiscountBlock"){t.showDiscountBlock=i}else if(e==="showTaxBlock"){t.showTaxBlock=i}else if(e==="taxIncluded"){t.fields.taxIncluded=i}o.store.dispatch("productList/changeItem",{index:n,fields:t})})}p.ajax.runAction("catalog.productForm.setConfig",{data:{configName:e,value:i}})}},{key:"getTotal",value:function t(){this.store.dispatch("productList/getTotal")}},{key:"setEditable",value:function t(e){this.editable=e;if(!e){z(this,J,nt).call(this,L.READ_ONLY)}else{z(this,J,nt).call(this,L.REGULAR)}}},{key:"hasErrors",value:function t(){if(!this.store){return false}var e=this.store.getters["productList/getBasket"]();var i=e.filter(function(t){return t.errors.length>0});return i.length>0}}],[{key:"initStore",value:function t(){var e=new l.VuexBuilder;return e.addModel(y.create()).build()}},{key:"showError",value:function t(e){console.error(e)}}]);return t}();var et=function t(){O.EventEmitter.emit(this,"ProductForm:onBasketChange",{basket:this.store.getters["productList/getBasket"]()})};var it=function t(e){var i={};if(this.options.requiredFields.length===0){return i}i.errors=[];this.options.requiredFields.forEach(function(t){switch(t){case A.PRICE:if(e.price<=0){i.errors.push({code:k.EMPTY_PRICE,message:p.Loc.getMessage("CATALOG_FORM_ERROR_EMPTY_PRICE")})}break;case A.QUANTITY:if(e.quantity<=0){i.errors.push({code:k.EMPTY_QUANTITY,message:p.Loc.getMessage("CATALOG_FORM_ERROR_EMPTY_QUANTITY")})}break;case A.BRAND:if(!p.Type.isArray(e.brands)||e.brands.length===0){i.errors.push({code:k.EMPTY_BRAND,message:p.Loc.getMessage("CATALOG_FORM_ERROR_EMPTY_BRAND")})}break}});return i};var ot=function t(e){var i=this;this.options.requiredFields=[];if(e===L.COMPILATION){var o=[A.PRODUCT_SELECTOR,A.PRICE,A.BRAND];this.options.requiredFields=this.options.visibleBlocks.filter(function(t){return o.includes(t)})}z(this,J,nt).call(this,e);var n=this.store.getters["productList/getBasket"]();n.forEach(function(t,e){return i.changeProduct({index:e,fields:t.fields})})};var nt=function t(e){this.mode=e;if(e===L.READ_ONLY){this.options.editableFields=[]}else if(e===L.COMPILATION){this.options.editableFields=[A.PRODUCT_SELECTOR,A.PRICE,A.BRAND];this.options.visibleBlocks=[A.PRODUCT_SELECTOR,A.PRICE];if(this.options.compilationFormType===M.FACEBOOK){this.options.visibleBlocks.push(A.BRAND)}this.options.showResults=false}else{e=L.REGULAR;this.options.visibleBlocks=this.defaultOptions.visibleBlocks;this.options.showResults=this.defaultOptions.showResults;var i=this.options.visibleBlocks.slice(0);if(i.includes(A.RESULT)){i.splice(i.indexOf(A.RESULT),1)}this.options.editableFields=i}if(this.templateEngine){this.templateEngine.mode=e}O.EventEmitter.emit(this,"ProductForm:onModeChange",{mode:e})};t.ProductForm=tt})(this.BX.Catalog=this.BX.Catalog||{},BX,BX.UI,BX,BX.UI,BX,BX.UI,BX.Catalog,BX.UI.EntitySelector,BX,BX,BX.Main,BX,BX,BX.UI,BX.UI,window,BX,BX,BX,BX,BX,BX.Event,BX.Currency,BX.Catalog);
//# sourceMappingURL=product-form.bundle.map.js