this.BX=this.BX||{};(function(t,e,i,s,o,a,n,r,c,u,l,d,p,h,f,m){"use strict";var g=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(g,"TOP","TOP");babelHelpers.defineProperty(g,"BOTTOM","BOTTOM");var I=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getName",value:function t(){return"productList"}},{key:"getState",value:function t(){return{currency:"",taxIncluded:"N",basket:[],total:{sum:0,discount:0,taxSum:0,result:0}}}},{key:"getActions",value:function t(){return{resetBasket:function t(e){var i=e.commit;i("clearBasket");i("addItem",{})},removeItem:function t(e,i){var s=e.dispatch,o=e.commit,a=e.state;o("deleteItem",i);if(a.basket.length===0){o("addItem",{})}else{a.basket.forEach(function(t,e){o("updateItem",{index:e,fields:{sort:e}})})}s("calculateTotal")},changeItem:function t(e,i){var s=e.dispatch,o=e.commit;o("updateItem",i);s("calculateTotal")},setCurrency:function t(e,i){var s=e.commit;var o=i||"";s("setCurrency",o)},addItem:function t(e,i){var s=e.dispatch,o=e.commit;var a=i.item||{fields:{}};o("addItem",{item:a,position:i.position||g.TOP});s("calculateTotal")},calculateTotal:function t(e){var i=e.commit,s=e.state;var o={sum:0,taxSum:0,discount:0,result:0};s.basket.forEach(function(t){var e=d.Text.toNumber(t.fields.basePrice||0);var i=d.Text.toNumber(t.fields.quantity||0);var s=d.Text.toNumber(t.fields.discount||0);var a=d.Text.toNumber(t.fields.taxSum||0);o.sum+=e*i;o.result+=d.Text.toNumber(t.sum);o.discount+=s*i;o.taxSum+=a*i});o.discount=o.discount>o.sum?o.sum:o.discount;i("setTotal",o)}}}},{key:"getGetters",value:function t(){return{getBasket:function t(e){return function(){return e.basket}},getBaseProduct:function t(){return function(){return e.getBaseProduct()}}}}},{key:"getMutations",value:function t(){return{addItem:function t(i,s){var o=e.getBaseProduct();o=Object.assign(o,s.item);if(s.position===g.BOTTOM){i.basket.push(o)}else{i.basket.unshift(o)}i.basket.forEach(function(t,e){t.fields.sort=e})},updateItem:function t(i,s){if(typeof i.basket[s.index]==="undefined"){p.Vue.set(i.basket,s.index,e.getBaseProduct())}i.basket[s.index]=Object.assign(i.basket[s.index],s.fields)},clearBasket:function t(e){e.basket=[]},deleteItem:function t(e,i){e.basket.splice(i.index,1);e.basket.forEach(function(t,e){t.fields.sort=e})},setErrors:function t(e,i){e.errors=i},clearErrors:function t(e){e.errors=[]},setCurrency:function t(e,i){e.currency=i},setTotal:function t(e,i){var s=i;if(d.Type.isStringFilled(e.currency)){for(var o in i){if(i.hasOwnProperty(o)){s[o]=f.CurrencyCore.currencyFormat(i[o],e.currency)}}}e.total=Object.assign(e.total,s)}}}}],[{key:"getBaseProduct",value:function t(){var e=d.Text.getRandom();return{offerId:null,selectorId:e,fields:{innerId:e,productId:null,skuId:null,code:null,module:null,sort:0,price:0,basePrice:0,priceExclusive:0,quantity:1,name:"",discount:0,discountRate:0,discountInfos:[],discountType:m.DiscountType.PERCENTAGE,tax:0,taxSum:0,taxIncluded:"N",measureCode:0,measureName:"",measureRatio:1,isCustomPrice:"N",additionalFields:[],properties:[]},calculatedFields:[],showDiscount:"N",showTax:"N",skuTree:[],image:null,sum:0,discountSum:0,detailUrl:"",encodedFields:null,errors:[]}}}]);return e}(u.VuexBuilderModel);var T=Object.freeze({databaseConfig:{name:"catalog.product-form"},templateName:"bx-product-form",templateProductAddName:"bx-product-add",templateProductRowName:"bx-product-form-row",moduleId:"catalog"});p.Vue.component(T.templateProductRowName,{props:["basketItem","basketItemIndex","countItems","options","editable"],data:function t(){return{currencySymbol:null,productSelector:null,imageControlId:null,selectorId:this.basketItem.selectorId}},created:function t(){var e=this;var i=this.basketItem.fields;var s=d.Text.toNumber(i.price);var o=this.basketItem.fields.basePrice||s;var a={QUANTITY:d.Text.toNumber(i.quantity),BASE_PRICE:o,PRICE:s,PRICE_NETTO:o,PRICE_BRUTTO:s,PRICE_EXCLUSIVE:this.basketItem.fields.priceExclusive||s,DISCOUNT_TYPE_ID:d.Text.toNumber(i.discountType)||m.DiscountType.PERCENTAGE,DISCOUNT_RATE:d.Text.toNumber(i.discountRate),DISCOUNT_SUM:d.Text.toNumber(i.discount),TAX_INCLUDED:i.taxIncluded||this.options.taxIncluded,TAX_RATE:i.tax||0,CUSTOMIZED:i.isCustomPrice||"N"};var n=this.options.pricePrecision||2;this.calculator=new m.ProductCalculator(a,{currencyId:this.options.currency,pricePrecision:n,commonPrecision:n});this.calculator.setCalculationStrategy(new m.TaxForPriceStrategy(this.calculator));this.currencySymbol=this.options.currencySymbol;this.defaultMeasure={name:"",id:null};if(d.Type.isArray(this.options.measures)){this.options.measures.map(function(t){if(t["IS_DEFAULT"]==="Y"){e.defaultMeasure.name=t.SYMBOL;e.defaultMeasure.code=t.CODE;if(!i.measureName&&!i.measureCode){e.changeProduct({measureCode:e.defaultMeasure.code,measureName:e.defaultMeasure.name})}}})}h.EventEmitter.subscribe("BX.Catalog.ProductSelector:onChange",this.onProductChange.bind(this));h.EventEmitter.subscribe("BX.Catalog.ProductSelector:onClear",this.onProductClear.bind(this));this.onInputPrice=d.Runtime.debounce(this.changePrice,500,this);this.onInputQuantity=d.Runtime.debounce(this.changeQuantity,500,this);this.onInputDiscount=d.Runtime.debounce(this.changeDiscount,500,this)},mounted:function t(){this.productSelector=new n.ProductSelector(this.selectorId,this.prepareSelectorParams());this.productSelector.renderTo(this.$refs.selectorWrapper)},updated:function t(){if(d.Type.isObject(this.basketItem.calculatedFields)){var e=this.basketItem.calculatedFields;e["PRICES"]={};e["PRICES"][this.options.basePriceId]={PRICE:e.BASE_PRICE||e.PRICE,CURRENCY:this.options.currency};e["MEASURE_CODE"]=this.basketItem.fields.measureCode;h.EventEmitter.emit(this,"ProductList::onChangeFields",{rowId:this.selectorId,fields:e})}},methods:{prepareSelectorParams:function t(){var e={iblockId:this.options.iblockId,basePriceId:this.options.basePriceId,productId:this.getField("productId"),skuId:this.getField("skuId"),skuTree:this.getDefaultSkuTree(),fileInputId:"",morePhotoValues:[],fileInput:"",imageValues:[],config:{DETAIL_PATH:this.basketItem.detailUrl||"",ENABLE_SEARCH:true,ENABLE_INPUT_DETAIL_LINK:true,ENABLE_IMAGE_CHANGE_SAVING:true,ENABLE_EMPTY_PRODUCT_ERROR:this.options.enableEmptyProductError,ROW_ID:this.selectorId,ENABLE_SKU_SELECTION:this.editable,HIDE_UNSELECTED_ITEMS:this.options.hideUnselectedProperties,URL_BUILDER_CONTEXT:this.options.urlBuilderContext},mode:this.editable?n.ProductSelector.MODE_EDIT:n.ProductSelector.MODE_VIEW,isSimpleModel:this.getField("name","")!==""&&this.getField("productId")<=0&&this.getField("skuId")<=0,fields:{NAME:this.getField("name")||"",PRICE:this.getField("basePrice")||0,CURRENCY:this.options.currency}};var i=this.basketItem.image;if(d.Type.isObject(i)){e.fileView=i.preview;e.fileInput=i.input;e.fileInputId=i.id;e.morePhotoValues=i.values}return e},getDefaultSkuTree:function t(){var e=this.basketItem.skuTree||{};if(d.Type.isStringFilled(e)){e=JSON.parse(e)}return e},getField:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this.basketItem.fields[e]||i},getCalculator:function t(){return this.calculator},setCalculatedFields:function t(e){var i={calculatedFields:e};var s=this.basketItem.fields;if(!d.Type.isNil(e.ID)){i.offerId=d.Text.toNumber(e.ID);s.productId=d.Text.toNumber(e.PRODUCT_ID);s.skuId=d.Text.toNumber(e.SKU_ID)}if(!d.Type.isNil(e.NAME)){s.name=e.NAME}if(!d.Type.isNil(e.MODULE)){s.module=e.MODULE}if(d.Text.toNumber(e.BASE_PRICE)>=0){s.basePrice=d.Text.toNumber(e.BASE_PRICE)}if(d.Text.toNumber(e.PRICE)>=0){s.price=d.Text.toNumber(e.PRICE);s.priceExclusive=d.Text.toNumber(e.PRICE_EXCLUSIVE)}if(d.Text.toNumber(e.PRICE_EXCLUSIVE)>=0&&e.TAX_INCLUDED==="Y"){s.priceExclusive=d.Text.toNumber(e.PRICE)}if(d.Text.toNumber(e.QUANTITY)>0){s.quantity=d.Text.toNumber(e.QUANTITY)}if(!d.Type.isNil(e.DISCOUNT_RATE)){s.discountRate=d.Text.toNumber(e.DISCOUNT_RATE)}if(!d.Type.isNil(e.DISCOUNT_SUM)){s.discount=d.Text.toNumber(e.DISCOUNT_SUM)}if(!d.Type.isNil(e.DISCOUNT_TYPE_ID)){s.discountType=e.DISCOUNT_TYPE_ID}if(d.Text.toNumber(e.SUM)>=0){i.sum=d.Text.toNumber(e.SUM)}if(!d.Type.isNil(e.CUSTOMIZED)){s.isCustomPrice=e.CUSTOMIZED}if(!d.Type.isNil(e.MEASURE_CODE)){s.measureCode=e.MEASURE_CODE}if(!d.Type.isNil(e.MEASURE_NAME)){s.measureName=e.MEASURE_NAME}if(!d.Type.isNil(e.PROPERTIES)){s.properties=e.PROPERTIES}this.changeRowData(i);this.changeProduct(s)},changeRowData:function t(e){this.$emit("changeRowData",{index:this.basketItemIndex,fields:e})},changeProduct:function t(e){e=Object.assign(this.basketItem.fields,e);this.$emit("changeProduct",{index:this.basketItemIndex,fields:e})},onProductChange:function t(e){var i=e.getData();if(d.Type.isStringFilled(i.selectorId)&&i.selectorId===this.productSelector.getId()){var s=d.Text.toNumber(i.fields.PRICE);var o={BASE_PRICE:s,MODULE:"catalog",NAME:i.fields.NAME,ID:i.fields.ID,PRODUCT_ID:i.fields.PRODUCT_ID,SKU_ID:i.fields.SKU_ID,PROPERTIES:i.fields.PROPERTIES,URL_BUILDER_CONTEXT:this.options.urlBuilderContext,CUSTOMIZED:d.Type.isNil(i.fields.PRICE)?"Y":"N",MEASURE_CODE:i.fields.MEASURE_CODE,MEASURE_NAME:i.fields.MEASURE_NAME};o=Object.assign(this.getCalculator().calculatePrice(s),o);this.getCalculator().setFields(o);this.setCalculatedFields(o)}},onProductClear:function t(e){var i=e.getData();if(d.Type.isStringFilled(i.selectorId)&&i.selectorId===this.productSelector.getId()){var s=this.getCalculator().calculatePrice(0);s.BASE_PRICE=0;s.NAME="";s.ID=0;s.PRODUCT_ID=0;s.SKU_ID=0;s.MODULE="";this.getCalculator().setFields(s);this.setCalculatedFields(s)}},toggleDiscount:function t(e){var i=this;if(!this.editable){return}this.changeRowData({showDiscount:e});e==="Y"?setTimeout(function(){return i.$refs.discountInput.focus()}):null},toggleTax:function t(e){this.changeRowData({showTax:e})},changeQuantity:function t(e){if(!this.editable){return}e.target.value=e.target.value.replace(/[^.\d]/g,".");var i=parseFloat(e.target.value);var s=e.target.value.substr(-1);if(!i||s==="."){return}var o=this.getCalculator().calculateQuantity(i);this.setCalculatedFields(o);this.getCalculator().setFields(o)},changePrice:function t(e){if(!this.editable){return}e.target.value=e.target.value.replace(/[^.,\d]/g,"");if(e.target.value===""){e.target.value=0}var i=e.target.value.substr(-1);if(i===","){e.target.value=e.target.value.replace(",",".")}var s=parseFloat(e.target.value);if(s<0||i==="."||i===","){return}var o=this.getCalculator().calculatePrice(s);o.BASE_PRICE=s;this.getCalculator().setFields(o);this.setCalculatedFields(o)},changeDiscountType:function t(e){if(!this.editable){return}var i=d.Text.toNumber(e)===m.DiscountType.MONETARY?m.DiscountType.MONETARY:m.DiscountType.PERCENTAGE;var s=this.getCalculator().calculateDiscountType(i);this.getCalculator().setFields(s);this.setCalculatedFields(s)},changeDiscount:function t(e){var i=d.Text.toNumber(e.target.value)||0;if(i===d.Text.toNumber(this.basketItem.discount)||!this.editable){return}var s=this.getCalculator().calculateDiscount(i);this.getCalculator().setFields(s);this.setCalculatedFields(s)},changeTax:function t(e){if(e===d.Text.toNumber(this.basketItem.tax)||!this.editable){return}var i=this.getCalculator().calculateTax(e);this.getCalculator().setFields(i);this.setCalculatedFields(i)},changeTaxIncluded:function t(e){if(e===this.basketItem.taxIncluded||!this.editable){return}var i=this.getCalculator().calculateTaxIncluded(e);this.getCalculator().setFields(i);this.setCalculatedFields(i)},removeItem:function t(){this.$emit("removeItem",{index:this.basketItemIndex})},openDiscountEditor:function t(e,i){if(!(window.top.BX.SidePanel&&window.top.BX.SidePanel.Instance)){return}window.top.BX.SidePanel.Instance.open(BX.util.add_url_param(i,{IFRAME:"Y",IFRAME_TYPE:"SIDE_SLIDER",publicSidePanel:"Y"}),{allowChangeHistory:false});e.preventDefault?e.preventDefault():e.returnValue=false},isEmptyProductName:function t(){return this.basketItem.name.length===0},calculateCorrectionFactor:function t(e,i){var s=e;var o=i;var a=1;while(!(Number.isInteger(s)&&Number.isInteger(o))){a*=10;s=e*a;o=i*a}return a},incrementQuantity:function t(){if(!this.editable){return}var e=this.calculateCorrectionFactor(this.basketItem.quantity,this.basketItem.measureRatio);var i=(this.basketItem.quantity*e+this.basketItem.measureRatio*e)/e;this.changeQuantity(i)},decrementQuantity:function t(){if(this.basketItem.quantity>this.basketItem.measureRatio&&this.editable){var e=this.calculateCorrectionFactor(this.basketItem.quantity,this.basketItem.measureRatio);var i=(this.basketItem.quantity*e-this.basketItem.measureRatio*e)/e;this.changeQuantity(i)}},showPopupMenu:function t(e,i,s){var o=this;if(!this.editable){return}var a=[];var n=function t(i,a){if(s==="tax"){o.changeTax(d.Text.toNumber(a.options.item))}else if(s==="measures"){var n=o.basketItem.fields;n["measureCode"]=a.options.item.CODE;n["measureName"]=a.options.item.SYMBOL;o.changeProduct(n)}else{e.innerHTML=i.target.innerHTML;if(s==="discount"){o.changeDiscountType(a.options.type)}}o.popupMenu.close()};if(s==="discount"){i=[];if(d.Type.isArray(this.options.allowedDiscountTypes)){if(this.options.allowedDiscountTypes.includes(m.DiscountType.PERCENTAGE)){i[m.DiscountType.PERCENTAGE]="%"}if(this.options.allowedDiscountTypes.includes(m.DiscountType.MONETARY)){i[m.DiscountType.MONETARY]=this.currencySymbol}}}if(i){for(var r in i){var c=i[r];if(s==="measures"){c=i[r].SYMBOL}else if(s==="tax"){c=c+"%"}a.push({text:c,item:i[r],onclick:n.bind({value:"settswguy"}),type:s==="discount"?r:null})}}if(a.length>0){this.popupMenu=new l.Menu({bindElement:e,items:a});this.popupMenu.show()}},showProductTooltip:function t(e){if(!this.productTooltip){this.productTooltip=new l.Popup({bindElement:e.target,maxWidth:400,darkMode:true,innerHTML:e.target.value,animation:"fading-slide"})}this.productTooltip.setContent(e.target.value);e.target.value.length>0?this.productTooltip.show():null},hideProductTooltip:function t(){this.productTooltip?this.productTooltip.close():null}},watch:{taxIncluded:function t(e,i){if(e!==i){this.changeTaxIncluded(e)}}},computed:{localize:function t(){return p.Vue.getFilteredPhrases("CATALOG_FORM_")},showDiscount:function t(){return this.showDiscountBlock&&this.basketItem.showDiscount==="Y"},getDiscountSymbol:function t(){return d.Text.toNumber(this.basketItem.fields.discountType)===m.DiscountType.PERCENTAGE?"%":this.currencySymbol},getDiscountInputValue:function t(){if(d.Text.toNumber(this.basketItem.fields.discountType)===m.DiscountType.PERCENTAGE){return d.Text.toNumber(this.basketItem.fields.discountRate)}return d.Text.toNumber(this.basketItem.fields.discount)},getPriceExclusive:function t(){return this.basketItem.fields.priceExclusive||this.basketItem.fields.price},showDiscountBlock:function t(){return this.options.showDiscountBlock==="Y"&&(this.editable||!this.editable&&this.basketItem.fields.discount>0)},showTaxBlock:function t(){return this.options.showTaxBlock==="Y"&&this.getTaxList.length>0&&(this.editable||!this.editable&&this.showBasePrice)},showRemoveIcon:function t(){if(!this.editable){return false}if(this.countItems>1){return true}return this.basketItem.offerId!==null},showTaxSelector:function t(){return this.basketItem.showTax==="Y"},showBasePrice:function t(){return this.basketItem.fields.discount>0||d.Text.toNumber(this.basketItem.fields.price)!==d.Text.toNumber(this.basketItem.fields.basePrice)},getMeasureName:function t(){return this.basketItem.fields.measureName||this.defaultMeasure.name},getMeasureCode:function t(){return this.basketItem.fields.measureCode||this.defaultMeasure.code},getTaxList:function t(){return d.Type.isArray(this.options.taxList)?this.options.taxList:[]},taxIncluded:function t(){return this.basketItem.fields.taxIncluded},isTaxIncluded:function t(){return this.taxIncluded==="Y"},isNotEnoughQuantity:function t(){return this.basketItem.errors.includes("SALE_BASKET_AVAILABLE_QUANTITY")},hasPriceError:function t(){return this.basketItem.errors.includes("SALE_BASKET_ITEM_WRONG_PRICE")}},template:'\n\t\t<div class="catalog-pf-product-item" v-bind:class="{ \'catalog-pf-product-item--borderless\': !editable && basketItemIndex === 0 }">\n\t\t\t<div class="catalog-pf-product-item--remove" @click="removeItem" v-if="showRemoveIcon"></div>\n\t\t\t<div class="catalog-pf-product-item--num">\n\t\t\t\t<div class="catalog-pf-product-index">{{basketItemIndex + 1}}</div>\n\t\t\t</div>\n\t\t\t<div class="catalog-pf-product-item--left">\n\t\t\t\t<div class="catalog-pf-product-item-section">\n\t\t\t\t\t<div class="catalog-pf-product-label">{{localize.CATALOG_FORM_NAME}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="catalog-pf-product-item-section" :id="selectorId" ref="selectorWrapper"></div>\n\t\t\t</div>\n\t\t\t<div class="catalog-pf-product-item--right">\n\t\t\t\t<div class="catalog-pf-product-item-section">\n\t\t\t\t\t<div class="catalog-pf-product-label" style="width: 94px">{{localize.CATALOG_FORM_PRICE}}</div>\n\t\t\t\t\t<div class="catalog-pf-product-label" style="width: 72px">{{localize.CATALOG_FORM_QUANTITY}}</div>\n\t\t\t\t\t<div class="catalog-pf-product-label" style="width: 94px">{{localize.CATALOG_FORM_RESULT}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="catalog-pf-product-item-section">\n\t\t\t\t\t<div class="catalog-pf-product-control" style="width: 94px">\n\t\t\t\t\t\t<div class="catalog-pf-product-input-wrapper">\n\t\t\t\t\t\t\t<input \ttype="text" class="catalog-pf-product-input catalog-pf-product-input--align-right"\n\t\t\t\t\t\t\t\t\tv-bind:class="{ \'catalog-pf-product-input--disabled\': !editable }"\n\t\t\t\t\t\t\t\t\t:value="basketItem.fields.basePrice"\n\t\t\t\t\t\t\t\t\t@input="onInputPrice"\n\t\t\t\t\t\t\t\t\t:disabled="!editable">\n\t\t\t\t\t\t\t<div class="catalog-pf-product-input-info" v-html="currencySymbol"></div>\n\t\t\t\t\t\t</div>\t\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="catalog-pf-product-control" style="width: 72px">\n\t\t\t\t\t\t<div class="catalog-pf-product-input-wrapper">\n\t\t\t\t\t\t\t<input \ttype="text" class="catalog-pf-product-input"\n\t\t\t\t\t\t\t\t\tv-bind:class="{ \'catalog-pf-product-input--disabled\': !editable }"\n\t\t\t\t\t\t\t\t\t:value="basketItem.fields.quantity"\n\t\t\t\t\t\t\t\t\t@input="onInputQuantity"\n\t\t\t\t\t\t\t\t\t:disabled="!editable">\n\t\t\t\t\t\t\t<div \tclass="catalog-pf-product-input-info catalog-pf-product-input-info--action" \n\t\t\t\t\t\t\t\t\t@click="showPopupMenu($event.target, options.measures, \'measures\')"><span>{{ getMeasureName }}</span></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="catalog-pf-product-control" style="width: 94px">\n\t\t\t\t\t\t<div class="catalog-pf-product-input-wrapper">\n\t\t\t\t\t\t\t<input disabled type="text" class="catalog-pf-product-input catalog-pf-product-input--disabled catalog-pf-product-input--gray catalog-pf-product-input--align-right" :value="basketItem.sum">\n\t\t\t\t\t\t\t<div class="catalog-pf-product-input-info catalog-pf-product-input--disabled catalog-pf-product-input--gray" v-html="currencySymbol"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="showDiscountBlock" class="catalog-pf-product-item-section">\n\t\t\t\t\t<div v-if="showDiscount" class="catalog-pf-product-link-toggler catalog-pf-product-link-toggler--hide" @click="toggleDiscount(\'N\')">{{localize.CATALOG_FORM_DISCOUNT_TITLE}}</div>\n\t\t\t\t\t<div v-else class="catalog-pf-product-link-toggler catalog-pf-product-link-toggler--show" @click="toggleDiscount(\'Y\')">{{localize.CATALOG_FORM_DISCOUNT_TITLE}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="showDiscount" class="catalog-pf-product-item-section">\n\t\t\t\t\t<div class="catalog-pf-product-input-wrapper catalog-pf-product-input-wrapper--left">\n\t\t\t\t\t\t<input class="catalog-pf-product-input catalog-pf-product-input--align-right catalog-pf-product-input--right"\n\t\t\t\t\t\t\t\tv-bind:class="{ \'catalog-pf-product-input--disabled\': !editable }"\n\t\t\t\t\t\t\t\tref="discountInput" \n\t\t\t\t\t\t\t\t:value="getDiscountInputValue"\n\t\t\t\t\t\t\t\t@input="onInputDiscount"\n\t\t\t\t\t\t\t\tplaceholder="0"\n\t\t\t\t\t\t\t\t:disabled="!editable">\n\t\t\t\t\t\t<div class="catalog-pf-product-input-info catalog-pf-product-input-info--action" \n\t\t\t\t\t\t\t@click="showPopupMenu($event.target, null, \'discount\')">\n\t\t\t\t\t\t\t<span v-html="getDiscountSymbol"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div v-if="showTaxBlock" class="catalog-pf-product-item-section catalog-pf-product-item-section--dashed">\n\t\t\t\t\t<div v-if="showTaxSelector" class="catalog-pf-product-link-toggler catalog-pf-product-link-toggler--hide" @click="toggleTax(\'N\')">{{localize.CATALOG_FORM_TAX_TITLE}}</div>\n\t\t\t\t\t<div v-else class="catalog-pf-product-link-toggler catalog-pf-product-link-toggler--show" @click="toggleTax(\'Y\')">{{localize.CATALOG_FORM_TAX_TITLE}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="showTaxSelector && showTaxBlock" class="catalog-pf-product-item-section">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="catalog-pf-product-input-wrapper catalog-pf-product-input-wrapper--right"\n\t\t\t\t\t\t@click="showPopupMenu($event.target, getTaxList, \'tax\')"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="catalog-pf-product-input">{{basketItem.fields.tax}}%</div>\n\t\t\t\t\t\t<div class="catalog-pf-product-input-info catalog-pf-product-input-info--dropdown"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="catalog-pf-product-item-section catalog-pf-product-item-section--dashed"></div>\n\t\t\t</div>\n\t\t</div>\n\t'});function b(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t\t<div class='catalog-pf-product-config-popup'></div>\n\t\t\t\t"]);b=function e(){return t};return t}function v(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<label class="ui-ctl ui-ctl-checkbox ui-ctl-w100">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl-label-text">',"</div>\n\t\t\t\t</label>\n\t\t\t"]);v=function e(){return t};return t}function E(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<input type="checkbox"  class="ui-ctl-element">\n\t\t\t\t']);E=function e(){return t};return t}p.Vue.component(T.templateProductAddName,{props:["options"],methods:{refreshBasket:function t(){this.$emit("refreshBasket")},changeBasketItem:function t(e){this.$emit("changeRowData",e)},addBasketItemForm:function t(){this.$emit("addItem")},getInternalIndexByProductId:function t(e){var i=this.$store.getters["productList/getBasket"]();return Object.keys(i).findIndex(function(t){return parseInt(i[t].skuId)===parseInt(e)})},handleAddItem:function t(e,i){var s=this;var o=4;if(d.Text.toNumber(i.type)===o){d.ajax.runAction("catalog.productSelector.getSelectedSku",{json:{variationId:e,options:{priceId:this.options.basePriceId,urlBuilder:this.options.urlBuilder,resetSku:true}}}).then(function(t){return s.processResponse(t)})}else{d.ajax.runAction("catalog.productSelector.getProduct",{json:{productId:e,options:{priceId:this.options.basePriceId,urlBuilder:this.options.urlBuilder}}}).then(function(t){return s.processResponse(t)})}},processResponse:function t(e){var i=this.getInternalIndexByProductId(e.data.skuId);if(i<0){var s=e.data;var o=d.Text.toNumber(s.fields.PRICE);s.fields=s.fields||{};var a=this.$store.getters["productList/getBaseProduct"]();a.fields=Object.assign(a.fields,{price:o,priceExclusive:o,basePrice:o,name:s.fields.NAME||"",productId:s.productId,skuId:s.skuId,offerId:s.skuId>0?s.skuId:s.productId,module:"catalog",isCustomPrice:d.Type.isNil(s.fields.PRICE)?"Y":"N",discountType:this.options.defaultDiscountType});delete s.fields;a=Object.assign(a,s);a.sum=o;this.$root.$app.addProduct(a)}},onUpdateBasketItem:function t(e,i){this.$store.dispatch("productList/changeRowData",{index:e,fields:i});this.$store.dispatch("productList/changeProduct",{index:e,fields:i.fields})},removeEmptyItems:function t(){var e=this;var i=this.$store.getters["productList/getBasket"]();i.forEach(function(t,s){if(i[s].name===""&&i[s].price<1e-10){e.$store.commit("productList/deleteItem",{index:s})}})},modifyBasketItem:function t(e){var i=parseInt(e.id);if(i>0){var s=this.getInternalIndexByProductId(i);if(s>=0){this.showDialogProductExists(e)}else{this.removeEmptyItems();this.handleAddItem(i,e)}}},showDialogProductExists:function t(e){var i=this;this.popup=new l.Popup(null,null,{events:{onPopupClose:function t(){i.popup.destroy()}},zIndex:4e3,autoHide:true,closeByEsc:true,closeIcon:true,titleBar:d.Loc.getMessage("CATALOG_FORM_BLOCK_PROD_EXIST_DLG_TITLE"),draggable:true,resizable:false,lightShadow:true,cacheable:false,overlay:true,content:d.Loc.getMessage("CATALOG_FORM_BLOCK_PROD_EXIST_DLG_TEXT").replace("#NAME#",e.name),buttons:this.getButtons(e)});this.popup.show()},getButtons:function t(e){var i=this;var s=[];var o=e;s.push(new BX.UI.SaveButton({text:d.Loc.getMessage("CATALOG_FORM_BLOCK_PROD_EXIST_DLG_OK"),onclick:function t(){var e=parseInt(o.id);var s=i.getInternalIndexByProductId(e);if(s>=0){var a=i.$store.getters["productList/getBasket"]()[s];a.fields.quantity++;a.calculatedFields.QUANTITY++;i.onUpdateBasketItem(s,a)}i.popup.destroy()}}));s.push(new BX.UI.CancelButton({text:d.Loc.getMessage("CATALOG_FORM_BLOCK_PROD_EXIST_DLG_NO"),onclick:function t(){i.popup.destroy()}}));return s},showDialogProductSearch:function t(){var e=this;var i="addBasketItemFromDialogProductSearch";window[i]=function(t){return e.modifyBasketItem(t)};var s=new BX.CDialog({content_url:"/bitrix/tools/sale/product_search_dialog.php?"+"&caller=order_edit"+"&func_name="+i+"&STORE_FROM_ID=0"+"&public_mode=Y",height:Math.max(500,window.innerHeight-400),width:Math.max(800,window.innerWidth-400),draggable:true,resizable:true,min_height:500,min_width:800,zIndex:3100});s.Show()},setSetting:function t(e){if(e.target.dataset.settingId==="taxIncludedOption"){var i=e.target.checked?"Y":"N";this.$root.$app.changeFormOption("taxIncluded",i)}else if(e.target.dataset.settingId==="showDiscountInputOption"){var s=e.target.checked?"Y":"N";this.$root.$app.changeFormOption("showDiscountBlock",s)}else if(e.target.dataset.settingId==="showTaxInputOption"){var o=e.target.checked?"Y":"N";this.$root.$app.changeFormOption("showTaxBlock",o)}},getSettingItem:function t(e){var i=d.Tag.render(E());i.checked=e.checked;i.dataset.settingId=e.id;var s=d.Tag.render(v(),i,e.title);d.Event.bind(s,"change",this.setSetting.bind(this));return s},prepareSettingsContent:function t(){var e=this;var i=[{id:"showDiscountInputOption",checked:this.options.showDiscountBlock!=="N",title:this.localize.CATALOG_FORM_ADD_SHOW_DISCOUNTS_OPTION}];var s=d.Tag.render(b());i.forEach(function(t){s.append(e.getSettingItem(t))});return s},showConfigPopup:function t(e){if(!this.popupMenu){this.popupMenu=new l.Popup(null,e.target,{autoHide:true,draggable:false,offsetLeft:0,offsetTop:0,noAllPaddings:true,bindOptions:{forceBindPosition:true},closeByEsc:true,content:this.prepareSettingsContent()})}this.popupMenu.show()}},computed:babelHelpers.objectSpread({localize:function t(){return p.Vue.getFilteredPhrases("CATALOG_")},countItems:function t(){return this.order.basket.length}},u.Vuex.mapState({productList:function t(e){return e.productList}})),template:'\n\t\t<div class="catalog-pf-product-add">\n\t\t\t<div class="catalog-pf-product-add-wrapper">\n\t\t\t\t<span class="catalog-pf-product-add-link" @click="addBasketItemForm">{{localize.CATALOG_FORM_ADD_PRODUCT}}</span>\n\t\t\t\t<span class="catalog-pf-product-add-link catalog-pf-product-add-link--gray" @click="showDialogProductSearch">{{localize.CATALOG_FORM_ADD_PRODUCT_FROM_CATALOG}}</span>\n\t\t\t</div>\n\t\t\t<div class="catalog-pf-product-configure-link" @click="showConfigPopup">{{localize.CATALOG_FORM_DISCOUNT_EDIT_PAGE_URL_TITLE}}</div>\n\t\t</div>\n\t'});p.Vue.component(T.templateName,{props:["options"],created:function t(){BX.ajax.runAction("catalog.productSelector.getFileInput",{json:{iblockId:this.options.iblockId}})},methods:{refreshBasket:function t(){this.$store.dispatch("productList/refreshBasket")},changeProduct:function t(e){this.$root.$app.changeProduct(e)},changeRowData:function t(e){delete e.fields.fields;this.$store.dispatch("productList/changeItem",e)},removeItem:function t(e){this.$root.$app.removeProduct(e)},addItem:function t(){this.$root.$app.addProduct()}},computed:babelHelpers.objectSpread({localize:function t(){return p.Vue.getFilteredPhrases("CATALOG_")},editable:function t(){return this.$root.$app.editable},showTaxResult:function t(){return this.options.showTaxBlock!=="N"},showResults:function t(){return this.options.showResults!==false},showButtonsTop:function t(){return this.options.singleProductMode!==true&&this.editable&&this.options.buttonsPosition!==g.BOTTOM},showButtonsBottom:function t(){return this.options.singleProductMode!==true&&this.editable&&this.options.buttonsPosition===g.BOTTOM},showResultBlock:function t(){return this.showResults||this.enableAddButtons},countItems:function t(){return this.productList.basket.length},totalResultLabel:function t(){return this.options.hasOwnProperty("totalResultLabel")&&this.options.totalResultLabel?this.options.totalResultLabel:this.localize.CATALOG_FORM_TOTAL_RESULT}},u.Vuex.mapState({productList:function t(e){return e.productList}})),template:'\n\t<div class="catalog-product-form-container">\n\t\t<'.concat(T.templateProductAddName,'\n\t\t\t:options="options" \n\t\t\t@refreshBasket="refreshBasket" \n\t\t\t@addItem="addItem"\n\t\t\t@changeRowData="changeRowData"\n\t\t\t@changeProduct="changeProduct" \n\t\t\tv-if="showButtonsTop"\n\t\t/>\n\t\t<div v-for="(item, index) in productList.basket" :key="item.selectorId">\n\t\t\t<').concat(T.templateProductRowName,' \n\t\t\t\t:basketItem="item" \n\t\t\t\t:basketItemIndex="index"  \n\t\t\t\t:countItems="countItems"\n\t\t\t\t:options="options"\n\t\t\t\t:editable="editable"\n\t\t\t\t@changeProduct="changeProduct" \n\t\t\t\t@changeRowData="changeRowData" \n\t\t\t\t@removeItem="removeItem" \n\t\t\t\t@refreshBasket="refreshBasket" \n\t\t\t/>\n\t\t</div>\n\t\t<').concat(T.templateProductAddName,'\n\t\t\t:options="options" \n\t\t\t@refreshBasket="refreshBasket" \n\t\t\t@addItem="addItem"\n\t\t\t@changeRowData="changeRowData"\n\t\t\t@changeProduct="changeProduct" \n\t\t\tv-if="showButtonsBottom"\n\t\t/>\n\t\t<div class="catalog-pf-result-line"></div>\n\t\t<div class="catalog-pf-result-wrapper" v-if="showResultBlock">\n\t\t\t<table class="catalog-pf-result" v-if="showResultBlock">\n\t\t\t\t<tr v-if="showResults">\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span class="catalog-pf-text">{{localize.CATALOG_FORM_PRODUCTS_PRICE}}:</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span v-html="productList.total.sum"\n\t\t\t\t\t\t\t:class="productList.total.result !== productList.total.sum ? \'catalog-pf-text catalog-pf-text--line-through\' : \'catalog-pf-text\'"\n\t\t\t\t\t\t></span>\n\t\t\t\t\t\t<span class="catalog-pf-symbol" v-html="options.currencySymbol"></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr v-if="showResults">\n\t\t\t\t\t<td class="catalog-pf-result-padding-bottom">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--discount">{{localize.CATALOG_FORM_TOTAL_DISCOUNT}}:</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class="catalog-pf-result-padding-bottom">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--discount" v-html="productList.total.discount"></span>\n\t\t\t\t\t\t<span class="catalog-pf-symbol" v-html="options.currencySymbol"></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr v-if="showResults && showTaxResult">\n\t\t\t\t\t<td class="catalog-pf-tax">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--tax">{{localize.CATALOG_FORM_TAX_TITLE}}:</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class="catalog-pf-tax">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--tax" v-html="productList.total.taxSum"></span>\n\t\t\t\t\t\t<span class="catalog-pf-symbol" v-html="options.currencySymbol"></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr v-if="showResults">\n\t\t\t\t\t<td class="catalog-pf-result-padding">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--total catalog-pf-text--border">{{totalResultLabel}}:</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class="catalog-pf-result-padding">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--total" v-html="productList.total.result"></span>\n\t\t\t\t\t\t<span class="catalog-pf-symbol catalog-pf-symbol--total" v-html="options.currencySymbol"></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>\n\t</div>\n')});function k(){var t=babelHelpers.taggedTemplateLiteral(['<div class=""></div>']);k=function e(){return t};return t}function y(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var P=new WeakSet;var x=function(){function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);P.add(this);this.options=this.prepareOptions(i);this.editable=true;this.wrapper=d.Tag.render(k());if(d.Text.toNumber(i.iblockId)<=0){return}t.initStore().then(function(t){return e.initTemplate(t)}).catch(function(e){return t.showError(e)})}babelHelpers.createClass(t,[{key:"prepareOptions",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=d.Extension.getSettings("catalog.product-form");var s={basket:[],measures:[],iblockId:null,basePriceId:i.get("basePriceId"),taxList:[],singleProductMode:false,showResults:true,enableEmptyProductError:true,pricePrecision:2,currency:i.get("currency"),currencySymbol:i.get("currencySymbol"),taxIncluded:i.get("taxIncluded"),showDiscountBlock:i.get("showDiscountBlock"),showTaxBlock:i.get("showTaxBlock"),allowedDiscountTypes:[m.DiscountType.PERCENTAGE,m.DiscountType.MONETARY],newItemPosition:g.TOP,buttonsPosition:g.TOP,urlBuilderContext:"SHOP",hideUnselectedProperties:false};e=babelHelpers.objectSpread({},s,e);e.showTaxBlock="N";e.defaultDiscountType="";if(d.Type.isArray(e.allowedDiscountTypes)){if(e.allowedDiscountTypes.includes(m.DiscountType.PERCENTAGE)){e.defaultDiscountType=m.DiscountType.PERCENTAGE}else if(e.allowedDiscountTypes.includes(m.DiscountType.MONETARY)){e.defaultDiscountType=m.DiscountType.MONETARY}}return e}},{key:"layout",value:function t(){return this.wrapper}},{key:"initTemplate",value:function t(e){var i=this;return new Promise(function(t){var s=i;i.store=e.store;i.templateEngine=p.Vue.create({el:i.wrapper,store:i.store,data:{options:i.options},created:function t(){this.$app=s},mounted:function e(){t()},template:"<".concat(T.templateName,' :options="options"/>')});if(d.Type.isStringFilled(i.options.currency)){i.setData({currency:i.options.currency});f.CurrencyCore.loadCurrencyFormat(i.options.currency)}if(i.options.basket.length>0){i.setData({basket:i.options.basket},{newItemPosition:g.BOTTOM});if(d.Type.isObject(i.options.totals)){i.store.commit("productList/setTotal",i.options.totals)}else{i.store.dispatch("productList/calculateTotal")}}else{var o=i.store.getters["productList/getBaseProduct"]();o.fields.discountType=i.options.defaultDiscountType;i.addProduct(o)}})}},{key:"addProduct",value:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.store.dispatch("productList/addItem",{item:i,position:this.options.newItemPosition}).then(function(){y(e,P,C).call(e)})}},{key:"changeProduct",value:function t(e){var i=this;this.store.dispatch("productList/changeItem",{index:e.index,fields:e.fields}).then(function(){y(i,P,C).call(i)})}},{key:"removeProduct",value:function t(e){var i=this;this.store.dispatch("productList/removeItem",{index:e.index}).then(function(){y(i,P,C).call(i)})}},{key:"setData",value:function t(e){var i=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(d.Type.isObject(e.basket)){var o=this.store.getters["productList/getBasket"]();e.basket.forEach(function(t){if(!d.Type.isObject(t)){return}var e=s.newItemPosition||i.options.newItemPosition;var a=t.selectorId;if(d.Type.isNil(a)){i.store.dispatch("productList/addItem",{item:t,position:e});return}var n=o.findIndex(function(t){return t.selectorId===a});if(n===-1){i.store.dispatch("productList/addItem",{item:t,position:e})}else{i.store.dispatch("productList/changeItem",{basketIndex:n,fields:t})}})}if(d.Type.isStringFilled(e.currency)){this.store.dispatch("productList/setCurrency",e.currency)}if(d.Type.isObject(e.total)){this.store.commit("productList/setTotal",{sum:e.total.sum,taxSum:e.total.taxSum,discount:e.total.discount,result:e.total.result})}if(d.Type.isObject(e.errors)){this.store.commit("productList/setErrors",e.errors)}}},{key:"changeFormOption",value:function t(e,i){var s=this;i=i==="Y"?"Y":"N";this.options[e]=i;var o=this.store.getters["productList/getBasket"]();o.forEach(function(t,o){if(e==="showDiscountBlock"){t.showDiscountBlock=i}else if(e==="showTaxBlock"){t.showTaxBlock=i}else if(e==="taxIncluded"){t.fields.taxIncluded=i}s.store.dispatch("productList/changeItem",{index:o,fields:t})});d.ajax.runAction("catalog.productForm.setConfig",{data:{configName:e,value:i}})}},{key:"getTotal",value:function t(){this.store.dispatch("productList/getTotal")}},{key:"setEditable",value:function t(e){this.editable=e}}],[{key:"initStore",value:function t(){var e=new u.VuexBuilder;return e.addModel(I.create()).useNamespace(true).build()}},{key:"showError",value:function t(e){console.error(e)}}]);return t}();var C=function t(){h.EventEmitter.emit(this,"ProductForm:onBasketChange",{basket:this.store.getters["productList/getBasket"]()})};t.ProductForm=x})(this.BX.Catalog=this.BX.Catalog||{},BX,BX,BX.UI,BX,BX.UI,BX.Catalog,BX,BX.UI,BX,BX.Main,BX,BX,BX.Event,BX.Currency,BX.Catalog);
//# sourceMappingURL=product-form.bundle.map.js