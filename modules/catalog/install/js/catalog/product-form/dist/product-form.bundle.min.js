this.BX=this.BX||{};(function(t,e,i,a,s,o,n,r,c,u,l,d,p,h,f,m){"use strict";var g=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getName",value:function t(){return"productList"}},{key:"getState",value:function t(){return{currency:"",taxIncluded:"N",basket:[],total:{sum:0,discount:0,taxSum:0,result:0}}}},{key:"getActions",value:function t(){return{resetBasket:function t(e){var i=e.commit;i("clearBasket");i("addItem")},removeItem:function t(e,i){var a=e.commit,s=e.state;a("deleteItem",i);if(s.basket.length===0){a("addItem")}else{s.basket.forEach(function(t,e){a("updateItem",{index:e,fields:{sort:e}})})}a("calculateTotal")},changeItem:function t(e,i){var a=e.commit;a("updateItem",i);a("calculateTotal")},setCurrency:function t(e,i){var a=e.commit;var s=i||"";a("setCurrency",s)},addItem:function t(e,i){var a=e.commit;var s=i.item||{fields:{}};a("addItem",{item:s,position:i.position||E.TOP});a("calculateTotal")}}}},{key:"getGetters",value:function t(){return{getBasket:function t(e){return function(){return e.basket}},getBaseProduct:function t(){return function(){return e.getBaseProduct()}}}}},{key:"getMutations",value:function t(){return{addItem:function t(i,a){var s=e.getBaseProduct();s=Object.assign(s,a.item);if(a.position===E.BOTTOM){i.basket.push(s)}else{i.basket.unshift(s)}i.basket.forEach(function(t,e){t.fields.sort=e})},updateItem:function t(i,a){if(typeof i.basket[a.index]==="undefined"){h.Vue.set(i.basket,a.index,e.getBaseProduct())}i.basket[a.index]=Object.assign(i.basket[a.index],a.fields)},clearBasket:function t(e){e.basket=[]},deleteItem:function t(e,i){e.basket.splice(i.index,1);e.basket.forEach(function(t,e){t.fields.sort=e})},setErrors:function t(e,i){e.errors=i},clearErrors:function t(e){e.errors=[]},setCurrency:function t(e,i){e.currency=i},calculateTotal:function t(e){var i={sum:0,taxSum:0,discount:0,result:0};e.basket.forEach(function(t,e){var a=p.Text.toNumber(t.fields.basePrice||0);var s=p.Text.toNumber(t.fields.quantity||0);var o=p.Text.toNumber(t.fields.discount||0);var n=p.Text.toNumber(t.fields.taxSum||0);i.sum+=a*s;i.result+=p.Text.toNumber(t.sum);i.discount+=o*s;i.taxSum+=n*s});i.discount=i.discount>i.sum?i.sum:i.discount;if(p.Type.isStringFilled(e.currency)){for(var a in i){e.total[a]=m.CurrencyCore.currencyFormat(i[a],e.currency)}}else{e.total=i}},setTotal:function t(e,i){e.total=Object.assign(e.total,i)}}}}],[{key:"getBaseProduct",value:function t(){var e=p.Text.getRandom();return{offerId:null,selectorId:e,fields:{innerId:e,productId:null,skuId:null,code:null,module:null,sort:0,price:0,basePrice:0,priceExclusive:0,quantity:1,name:"",discount:0,discountRate:0,discountInfos:[],discountType:u.DiscountType.PERCENTAGE,tax:0,taxSum:0,taxIncluded:"N",measureCode:0,measureName:"",measureRatio:1,isCustomPrice:"N"},calculatedFields:u.FieldScheme,showDiscount:"N",showTax:"N",skuTree:[],image:null,sum:0,discountSum:0,detailUrl:"",encodedFields:null,errors:[]}}}]);return e}(l.VuexBuilderModel);var I=Object.freeze({databaseConfig:{name:"catalog.product-form"},templateName:"bx-product-form",templateProductAddName:"bx-product-add",templateProductRowName:"bx-product-form-row",moduleId:"catalog"});h.Vue.component(I.templateProductRowName,{props:["basketItem","basketItemIndex","countItems","options","editable"],data:function t(){return{currencySymbol:null,productSelector:null,imageControlId:null,selectorId:this.basketItem.selectorId}},created:function t(){var e=this;var i=this.basketItem.fields;var a=p.Text.toNumber(i.price);var s=this.basketItem.fields.basePrice||a;var o={QUANTITY:p.Text.toNumber(i.quantity),BASE_PRICE:s,PRICE:a,PRICE_NETTO:s,PRICE_BRUTTO:a,PRICE_EXCLUSIVE:this.basketItem.fields.priceExclusive||a,DISCOUNT_TYPE_ID:p.Text.toNumber(i.discountType)||u.DiscountType.PERCENTAGE,DISCOUNT_RATE:p.Text.toNumber(i.discountRate),DISCOUNT_SUM:p.Text.toNumber(i.discount),TAX_INCLUDED:i.taxIncluded||this.options.taxIncluded,TAX_RATE:i.tax||0,CUSTOMIZED:i.isCustomPrice||"N"};var n=this.options.pricePrecision||2;this.calculator=new u.ProductCalculator(o,{currencyId:this.options.currencyId,pricePrecision:n,commonPrecision:n});this.calculator.setCalculationStrategy(new u.TaxForPriceStrategy(this.calculator));this.currencySymbol=this.options.currencySymbol;this.defaultMeasure={name:"",id:null};if(p.Type.isArray(this.options.measures)){this.options.measures.map(function(t){if(t["IS_DEFAULT"]==="Y"){e.defaultMeasure.name=t.SYMBOL;e.defaultMeasure.code=t.CODE;if(!i.measureName&&!i.measureCode){e.changeProduct({measureCode:e.defaultMeasure.code,measureName:e.defaultMeasure.name})}}})}f.EventEmitter.subscribe("BX.Catalog.ProductSelector:onChange",this.onProductChange.bind(this));f.EventEmitter.subscribe("BX.Catalog.ProductSelector:onClear",this.onProductClear.bind(this));this.onInputPrice=p.Runtime.debounce(this.changePrice,500,this);this.onInputQuantity=p.Runtime.debounce(this.changeQuantity,500,this);this.onInputDiscount=p.Runtime.debounce(this.changeDiscount,500,this)},mounted:function t(){this.productSelector=new n.ProductSelector(this.selectorId,this.prepareSelectorParams());if(!p.Type.isObject(this.basketItem.image)){this.initEmptyImageInputScripts()}},updated:function t(){if(p.Type.isObject(this.basketItem.calculatedFields)){var e=this.basketItem.calculatedFields;e["PRICES"]={};e["PRICES"][this.options.basePriceId]={PRICE:e.BASE_PRICE||e.PRICE,CURRENCY:this.options.currency};e["MEASURE_CODE"]=this.basketItem.fields.measureCode;f.EventEmitter.emit(this,"ProductList::onChangeFields",{rowId:this.selectorId,fields:e})}},methods:{prepareSelectorParams:function t(){var e={iblockId:this.options.iblockId,basePriceId:this.options.basePriceId,productId:this.getField("productId"),skuId:this.getField("skuId"),skuTree:this.getDefaultSkuTree(),fileInputId:"",morePhotoValues:[],fileInput:"<div class='ui-image-input-container ui-image-input-img--disabled'>"+"<div class='adm-fileinput-wrapper '>"+"<div class='adm-fileinput-area mode-pict adm-fileinput-drag-area'></div>"+"</div>"+"</div>",imageValues:[],config:{DETAIL_PATH:this.basketItem.detailUrl||"",ENABLE_SEARCH:true,ENABLE_INPUT_DETAIL_LINK:true,ENABLE_IMAGE_CHANGE_SAVING:true,ROW_ID:this.selectorId,ENABLE_SKU_SELECTION:this.editable,URL_BUILDER_CONTEXT:this.options.urlBuilderContext},mode:this.editable?n.ProductSelector.MODE_EDIT:n.ProductSelector.MODE_VIEW,fields:{NAME:this.getField("name")||""}};var i=this.basketItem.image;if(p.Type.isObject(i)){e.fileView=i.preview;e.fileInput=i.input;e.fileInputId=i.id;e.morePhotoValues=i.values}return e},getDefaultSkuTree:function t(){var e=this.basketItem.skuTree||{};if(p.Type.isStringFilled(e)){e=JSON.parse(e)}return e},getField:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this.basketItem.fields[e]||i},initEmptyImageInputScripts:function t(){var e=this;if(!this.productSelector){return}BX.ajax.runAction("catalog.productSelector.getEmptyInputImage",{json:{iblockId:this.options.iblockId}}).then(function(t){var i=t.data;e.productSelector.getFileInput().setId(i.id);e.productSelector.getFileInput().setInputHtml(i.input);e.productSelector.layoutImage()})},getCalculator:function t(){return this.calculator},setCalculatedFields:function t(e){var i={calculatedFields:e};var a=this.basketItem.fields;if(!p.Type.isNil(e.ID)){i.offerId=p.Text.toNumber(e.ID);a.productId=p.Text.toNumber(e.PRODUCT_ID);a.skuId=p.Text.toNumber(e.SKU_ID)}if(!p.Type.isNil(e.NAME)){a.name=e.NAME}if(!p.Type.isNil(e.MODULE)){a.module=e.MODULE}if(p.Text.toNumber(e.BASE_PRICE)>=0){a.basePrice=p.Text.toNumber(e.BASE_PRICE)}if(p.Text.toNumber(e.PRICE)>=0){a.price=p.Text.toNumber(e.PRICE);a.priceExclusive=p.Text.toNumber(e.PRICE_EXCLUSIVE)}if(p.Text.toNumber(e.PRICE_EXCLUSIVE)>=0&&e.TAX_INCLUDED==="Y"){a.priceExclusive=p.Text.toNumber(e.PRICE)}if(p.Text.toNumber(e.QUANTITY)>0){a.quantity=p.Text.toNumber(e.QUANTITY)}if(!p.Type.isNil(e.DISCOUNT_RATE)){a.discountRate=p.Text.toNumber(e.DISCOUNT_RATE)}if(!p.Type.isNil(e.DISCOUNT_SUM)){a.discount=p.Text.toNumber(e.DISCOUNT_SUM)}if(!p.Type.isNil(e.DISCOUNT_TYPE_ID)){a.discountType=e.DISCOUNT_TYPE_ID}if(p.Text.toNumber(e.SUM)>=0){i.sum=p.Text.toNumber(e.SUM)}if(!p.Type.isNil(e.CUSTOMIZED)){a.isCustomPrice=e.CUSTOMIZED}this.changeRowData(i);this.changeProduct(a)},changeRowData:function t(e){this.$emit("changeRowData",{index:this.basketItemIndex,fields:e})},changeProduct:function t(e){e=Object.assign(this.basketItem.fields,e);this.$emit("changeProduct",{index:this.basketItemIndex,fields:e})},onProductChange:function t(e){var i=e.getData();if(p.Type.isStringFilled(i.selectorId)&&i.selectorId===this.productSelector.getId()){var a=p.Text.toNumber(i.fields.PRICE);var s={BASE_PRICE:a,MODULE:"catalog",NAME:i.fields.NAME,ID:i.fields.ID,PRODUCT_ID:i.fields.PRODUCT_ID,SKU_ID:i.fields.SKU_ID};s=Object.assign(this.getCalculator().calculatePrice(a),s);this.getCalculator().setFields(s);this.setCalculatedFields(s)}},onProductClear:function t(e){var i=e.getData();if(p.Type.isStringFilled(i.selectorId)&&i.selectorId===this.productSelector.getId()){var a=this.getCalculator().calculatePrice(0);a.BASE_PRICE=0;a.NAME="";a.ID=0;a.PRODUCT_ID=0;a.SKU_ID=0;a.MODULE="";this.getCalculator().setFields(a);this.setCalculatedFields(a)}},toggleDiscount:function t(e){var i=this;if(!this.editable){return}this.changeRowData({showDiscount:e});e==="Y"?setTimeout(function(){return i.$refs.discountInput.focus()}):null},toggleTax:function t(e){this.changeRowData({showTax:e})},changeQuantity:function t(e){if(!this.editable){return}e.target.value=e.target.value.replace(/[^.\d]/g,".");var i=parseFloat(e.target.value);var a=e.target.value.substr(-1);if(!i||a==="."){return}var s=this.getCalculator().calculateQuantity(i);this.setCalculatedFields(s);this.getCalculator().setFields(s)},changePrice:function t(e){if(!this.editable){return}e.target.value=e.target.value.replace(/[^.,\d]/g,"");if(e.target.value===""){e.target.value=0}var i=e.target.value.substr(-1);if(i===","){e.target.value=e.target.value.replace(",",".")}var a=parseFloat(e.target.value);if(a<0||i==="."||i===","){return}var s=this.getCalculator().calculatePrice(a);s.BASE_PRICE=a;this.getCalculator().setFields(s);this.setCalculatedFields(s)},changeDiscountType:function t(e){if(!this.editable){return}var i=p.Text.toNumber(e)===u.DiscountType.MONETARY?u.DiscountType.MONETARY:u.DiscountType.PERCENTAGE;var a=this.getCalculator().calculateDiscountType(i);this.getCalculator().setFields(a);this.setCalculatedFields(a)},changeDiscount:function t(e){var i=p.Text.toNumber(e.target.value)||0;if(i===p.Text.toNumber(this.basketItem.discount)||!this.editable){return}var a=this.getCalculator().calculateDiscount(i);this.getCalculator().setFields(a);this.setCalculatedFields(a)},changeTax:function t(e){if(e===p.Text.toNumber(this.basketItem.tax)||!this.editable){return}var i=this.getCalculator().calculateTax(e);this.getCalculator().setFields(i);this.setCalculatedFields(i)},changeTaxIncluded:function t(e){if(e===this.basketItem.taxIncluded||!this.editable){return}var i=this.getCalculator().calculateTaxIncluded(e);this.getCalculator().setFields(i);this.setCalculatedFields(i)},removeItem:function t(){this.$emit("removeItem",{index:this.basketItemIndex})},openDiscountEditor:function t(e,i){if(!(window.top.BX.SidePanel&&window.top.BX.SidePanel.Instance)){return}window.top.BX.SidePanel.Instance.open(BX.util.add_url_param(i,{IFRAME:"Y",IFRAME_TYPE:"SIDE_SLIDER",publicSidePanel:"Y"}),{allowChangeHistory:false});e.preventDefault?e.preventDefault():e.returnValue=false},isEmptyProductName:function t(){return this.basketItem.name.length===0},calculateCorrectionFactor:function t(e,i){var a=e;var s=i;var o=1;while(!(Number.isInteger(a)&&Number.isInteger(s))){o*=10;a=e*o;s=i*o}return o},incrementQuantity:function t(){if(!this.editable){return}var e=this.calculateCorrectionFactor(this.basketItem.quantity,this.basketItem.measureRatio);var i=(this.basketItem.quantity*e+this.basketItem.measureRatio*e)/e;this.changeQuantity(i)},decrementQuantity:function t(){if(this.basketItem.quantity>this.basketItem.measureRatio&&this.editable){var e=this.calculateCorrectionFactor(this.basketItem.quantity,this.basketItem.measureRatio);var i=(this.basketItem.quantity*e-this.basketItem.measureRatio*e)/e;this.changeQuantity(i)}},showPopupMenu:function t(e,i,a){var s=this;if(!this.editable){return}var o=[];var n=function t(i,o){if(a==="tax"){s.changeTax(p.Text.toNumber(o.options.item))}else if(a==="measures"){var n=s.basketItem.fields;n["measureCode"]=o.options.item.CODE;n["measureName"]=o.options.item.SYMBOL;s.changeProduct(n)}else{e.innerHTML=i.target.innerHTML;if(a==="discount"){s.changeDiscountType(o.options.type)}}s.popupMenu.close()};if(a==="discount"){i=[];i[u.DiscountType.PERCENTAGE]="%";i[u.DiscountType.MONETARY]=this.currencySymbol}if(i){for(var r in i){var c=i[r];if(a==="measures"){c=i[r].SYMBOL}else if(a==="tax"){c=c+"%"}o.push({text:c,item:i[r],onclick:n.bind({value:"settswguy"}),type:a==="discount"?r:null})}}this.popupMenu=new d.Menu({bindElement:e,items:o});this.popupMenu.show()},showProductTooltip:function t(e){if(!this.productTooltip){this.productTooltip=new d.Popup({bindElement:e.target,maxWidth:400,darkMode:true,innerHTML:e.target.value,animation:"fading-slide"})}this.productTooltip.setContent(e.target.value);e.target.value.length>0?this.productTooltip.show():null},hideProductTooltip:function t(){this.productTooltip?this.productTooltip.close():null}},watch:{taxIncluded:function t(e,i){if(e!==i){this.changeTaxIncluded(e)}}},computed:{localize:function t(){return h.Vue.getFilteredPhrases("CATALOG_FORM_")},showDiscount:function t(){return this.showDiscountBlock&&this.basketItem.showDiscount==="Y"},getDiscountSymbol:function t(){return p.Text.toNumber(this.basketItem.fields.discountType)===u.DiscountType.PERCENTAGE?"%":this.currencySymbol},getDiscountInputValue:function t(){if(p.Text.toNumber(this.basketItem.fields.discountType)===u.DiscountType.PERCENTAGE){return p.Text.toNumber(this.basketItem.fields.discountRate)}return p.Text.toNumber(this.basketItem.fields.discount)},getPriceExclusive:function t(){return this.basketItem.fields.priceExclusive||this.basketItem.fields.price},showDiscountBlock:function t(){return this.options.showDiscountBlock==="Y"&&(this.editable||!this.editable&&this.basketItem.fields.discount>0)},showTaxBlock:function t(){return this.options.showTaxBlock==="Y"&&this.getTaxList.length>0&&(this.editable||!this.editable&&this.showBasePrice)},showTaxSelector:function t(){return this.basketItem.showTax==="Y"},showBasePrice:function t(){return this.basketItem.fields.discount>0||p.Text.toNumber(this.basketItem.fields.price)!==p.Text.toNumber(this.basketItem.fields.basePrice)},getMeasureName:function t(){return this.basketItem.fields.measureName||this.defaultMeasure.name},getMeasureCode:function t(){return this.basketItem.fields.measureCode||this.defaultMeasure.code},getTaxList:function t(){return p.Type.isArray(this.options.taxList)?this.options.taxList:[]},taxIncluded:function t(){return this.basketItem.fields.taxIncluded},isTaxIncluded:function t(){return this.taxIncluded==="Y"},isNotEnoughQuantity:function t(){return this.basketItem.errors.includes("SALE_BASKET_AVAILABLE_QUANTITY")},hasPriceError:function t(){return this.basketItem.errors.includes("SALE_BASKET_ITEM_WRONG_PRICE")}},template:'\n\t\t<div class="catalog-pf-product-item" v-bind:class="{ \'catalog-pf-product-item--borderless\': !editable && basketItemIndex === 0 }">\n\t\t\t<div class="catalog-pf-product-item--remove" @click="removeItem" v-if="countItems > 1 && editable"></div>\n\t\t\t<div class="catalog-pf-product-item--num">\n\t\t\t\t<div class="catalog-pf-product-index">{{basketItemIndex + 1}}</div>\n\t\t\t</div>\n\t\t\t<div class="catalog-pf-product-item--left">\n\t\t\t\t<div class="catalog-pf-product-item-section">\n\t\t\t\t\t<div class="catalog-pf-product-label">{{localize.CATALOG_FORM_NAME}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="catalog-pf-product-item-section" :id="selectorId"></div>\n\t\t\t</div>\n\t\t\t<div class="catalog-pf-product-item--right">\n\t\t\t\t<div class="catalog-pf-product-item-section">\n\t\t\t\t\t<div class="catalog-pf-product-label" style="width: 94px">{{localize.CATALOG_FORM_PRICE}}</div>\n\t\t\t\t\t<div class="catalog-pf-product-label" style="width: 72px">{{localize.CATALOG_FORM_QUANTITY}}</div>\n\t\t\t\t\t<div class="catalog-pf-product-label" style="width: 94px">{{localize.CATALOG_FORM_RESULT}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="catalog-pf-product-item-section">\n\t\t\t\t\t<div class="catalog-pf-product-control" style="width: 94px">\n\t\t\t\t\t\t<div class="catalog-pf-product-input-wrapper">\n\t\t\t\t\t\t\t<input \ttype="text" class="catalog-pf-product-input catalog-pf-product-input--align-right"\n\t\t\t\t\t\t\t\t\tv-bind:class="{ \'catalog-pf-product-input--disabled\': !editable }"\n\t\t\t\t\t\t\t\t\t:value="basketItem.fields.basePrice"\n\t\t\t\t\t\t\t\t\t@input="onInputPrice"\n\t\t\t\t\t\t\t\t\t:disabled="!editable">\n\t\t\t\t\t\t\t<div class="catalog-pf-product-input-info" v-html="currencySymbol"></div>\n\t\t\t\t\t\t</div>\t\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="catalog-pf-product-control" style="width: 72px">\n\t\t\t\t\t\t<div class="catalog-pf-product-input-wrapper">\n\t\t\t\t\t\t\t<input \ttype="text" class="catalog-pf-product-input"\n\t\t\t\t\t\t\t\t\tv-bind:class="{ \'catalog-pf-product-input--disabled\': !editable }"\n\t\t\t\t\t\t\t\t\t:value="basketItem.fields.quantity"\n\t\t\t\t\t\t\t\t\t@input="onInputQuantity"\n\t\t\t\t\t\t\t\t\t:disabled="!editable">\n\t\t\t\t\t\t\t<div \tclass="catalog-pf-product-input-info catalog-pf-product-input-info--action" \n\t\t\t\t\t\t\t\t\t@click="showPopupMenu($event.target, options.measures, \'measures\')"><span>{{ getMeasureName }}</span></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="catalog-pf-product-control" style="width: 94px">\n\t\t\t\t\t\t<div class="catalog-pf-product-input-wrapper">\n\t\t\t\t\t\t\t<input disabled type="text" class="catalog-pf-product-input catalog-pf-product-input--disabled catalog-pf-product-input--gray catalog-pf-product-input--align-right" :value="basketItem.sum">\n\t\t\t\t\t\t\t<div class="catalog-pf-product-input-info catalog-pf-product-input--disabled catalog-pf-product-input--gray" v-html="currencySymbol"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="showDiscountBlock" class="catalog-pf-product-item-section">\n\t\t\t\t\t<div v-if="showDiscount" class="catalog-pf-product-link-toggler catalog-pf-product-link-toggler--hide" @click="toggleDiscount(\'N\')">{{localize.CATALOG_FORM_DISCOUNT_TITLE}}</div>\n\t\t\t\t\t<div v-else class="catalog-pf-product-link-toggler catalog-pf-product-link-toggler--show" @click="toggleDiscount(\'Y\')">{{localize.CATALOG_FORM_DISCOUNT_TITLE}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="showDiscount" class="catalog-pf-product-item-section">\n\t\t\t\t\t<div class="catalog-pf-product-input-wrapper catalog-pf-product-input-wrapper--left">\n\t\t\t\t\t\t<input class="catalog-pf-product-input catalog-pf-product-input--align-right catalog-pf-product-input--right"\n\t\t\t\t\t\t\t\tv-bind:class="{ \'catalog-pf-product-input--disabled\': !editable }"\n\t\t\t\t\t\t\t\tref="discountInput" \n\t\t\t\t\t\t\t\t:value="getDiscountInputValue"\n\t\t\t\t\t\t\t\t@input="onInputDiscount"\n\t\t\t\t\t\t\t\tplaceholder="0"\n\t\t\t\t\t\t\t\t:disabled="!editable">\n\t\t\t\t\t\t<div class="catalog-pf-product-input-info catalog-pf-product-input-info--action" \n\t\t\t\t\t\t\t@click="showPopupMenu($event.target, null, \'discount\')">\n\t\t\t\t\t\t\t<span v-html="getDiscountSymbol"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div v-if="showTaxBlock" class="catalog-pf-product-item-section catalog-pf-product-item-section--dashed">\n\t\t\t\t\t<div v-if="showTaxSelector" class="catalog-pf-product-link-toggler catalog-pf-product-link-toggler--hide" @click="toggleTax(\'N\')">{{localize.CATALOG_FORM_TAX_TITLE}}</div>\n\t\t\t\t\t<div v-else class="catalog-pf-product-link-toggler catalog-pf-product-link-toggler--show" @click="toggleTax(\'Y\')">{{localize.CATALOG_FORM_TAX_TITLE}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="showTaxSelector && showTaxBlock" class="catalog-pf-product-item-section">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="catalog-pf-product-input-wrapper catalog-pf-product-input-wrapper--right"\n\t\t\t\t\t\t@click="showPopupMenu($event.target, getTaxList, \'tax\')"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="catalog-pf-product-input">{{basketItem.fields.tax}}%</div>\n\t\t\t\t\t\t<div class="catalog-pf-product-input-info catalog-pf-product-input-info--dropdown"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="catalog-pf-product-item-section catalog-pf-product-item-section--dashed"></div>\n\t\t\t</div>\n\t\t</div>\n\t'});function v(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t\t<div class='catalog-pf-product-config-popup'></div>\n\t\t\t\t"]);v=function e(){return t};return t}function b(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<label class="ui-ctl ui-ctl-checkbox ui-ctl-w100">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl-label-text">',"</div>\n\t\t\t\t</label>\n\t\t\t"]);b=function e(){return t};return t}function T(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<input type="checkbox"  class="ui-ctl-element">\n\t\t\t\t']);T=function e(){return t};return t}h.Vue.component(I.templateProductAddName,{props:["options"],methods:{refreshBasket:function t(){this.$emit("refreshBasket")},changeBasketItem:function t(e){this.$emit("changeRowData",e)},addBasketItemForm:function t(){this.$emit("addItem")},getInternalIndexByProductId:function t(e){var i=this.$store.getters["productList/getBasket"]();return Object.keys(i).findIndex(function(t){return parseInt(i[t].skuId)===parseInt(e)})},handleAddItem:function t(e,i){var a=this;var s=4;if(p.Text.toNumber(i.type)===s){p.ajax.runAction("catalog.productSelector.getSelectedSku",{json:{variationId:e,options:{priceId:this.options.basePriceId,urlBuilder:this.options.urlBuilder,resetSku:true}}}).then(function(t){return a.processResponse(t)})}else{p.ajax.runAction("catalog.productSelector.getProduct",{json:{productId:e,options:{priceId:this.options.basePriceId,urlBuilder:this.options.urlBuilder}}}).then(function(t){return a.processResponse(t)})}},processResponse:function t(e){var i=this.getInternalIndexByProductId(e.data.skuId);if(i<0){var a=e.data;var s=p.Text.toNumber(a.fields.PRICE);a.fields=a.fields||{};var o=this.$store.getters["productList/getBaseProduct"]();o.fields=Object.assign(o.fields,{price:s,priceExclusive:s,basePrice:s,name:a.fields.NAME||"",productId:a.productId,skuId:a.skuId,offerId:a.skuId>0?a.skuId:a.productId,module:"catalog"});delete a.fields;o=Object.assign(o,a);o.sum=s;this.$root.$app.addProduct(o)}},onUpdateBasketItem:function t(e,i){this.$store.dispatch("productList/changeRowData",{index:e,fields:i});this.$store.dispatch("productList/changeProduct",{index:e,fields:i.fields})},removeEmptyItems:function t(){var e=this;var i=this.$store.getters["productList/getBasket"]();i.forEach(function(t,a){if(i[a].name===""&&i[a].price<1e-10){e.$store.commit("productList/deleteItem",{index:a})}})},modifyBasketItem:function t(e){var i=parseInt(e.id);if(i>0){var a=this.getInternalIndexByProductId(i);if(a>=0){this.showDialogProductExists(e)}else{this.removeEmptyItems();this.handleAddItem(i,e)}}},showDialogProductExists:function t(e){var i=this;this.popup=new d.Popup(null,null,{events:{onPopupClose:function t(){i.popup.destroy()}},zIndex:4e3,autoHide:true,closeByEsc:true,closeIcon:true,titleBar:p.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_PROD_EXIST_DLG_TITLE"),draggable:true,resizable:false,lightShadow:true,cacheable:false,overlay:true,content:p.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_PROD_EXIST_DLG_TEXT").replace("#NAME#",e.name),buttons:this.getButtons(e)});this.popup.show()},getButtons:function t(e){var i=this;var a=[];var s=e;a.push(new BX.UI.SaveButton({text:p.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_PROD_EXIST_DLG_OK"),onclick:function t(){var e=parseInt(s.id);var a=i.getInternalIndexByProductId(e);if(a>=0){var o=i.$store.getters["productList/getBasket"]()[a];o.fields.quantity++;o.calculatedFields.QUANTITY++;i.onUpdateBasketItem(a,o)}i.popup.destroy()}}));a.push(new BX.UI.CancelButton({text:p.Loc.getMessage("SALESCENTER_PRODUCT_BLOCK_PROD_EXIST_DLG_NO"),onclick:function t(){i.popup.destroy()}}));return a},showDialogProductSearch:function t(){var e=this;var i="addBasketItemFromDialogProductSearch";window[i]=function(t){return e.modifyBasketItem(t)};var a=new BX.CDialog({content_url:"/bitrix/tools/sale/product_search_dialog.php?"+"&caller=order_edit"+"&func_name="+i+"&STORE_FROM_ID=0"+"&public_mode=Y",height:Math.max(500,window.innerHeight-400),width:Math.max(800,window.innerWidth-400),draggable:true,resizable:true,min_height:500,min_width:800,zIndex:3100});a.Show()},setSetting:function t(e){if(e.target.dataset.settingId==="taxIncludedOption"){var i=e.target.checked?"Y":"N";this.$root.$app.changeFormOption("taxIncluded",i)}else if(e.target.dataset.settingId==="showDiscountInputOption"){var a=e.target.checked?"Y":"N";this.$root.$app.changeFormOption("showDiscountBlock",a)}else if(e.target.dataset.settingId==="showTaxInputOption"){var s=e.target.checked?"Y":"N";this.$root.$app.changeFormOption("showTaxBlock",s)}},getSettingItem:function t(e){var i=p.Tag.render(T());i.checked=e.checked;i.dataset.settingId=e.id;var a=p.Tag.render(b(),i,e.title);p.Event.bind(a,"change",this.setSetting.bind(this));return a},prepareSettingsContent:function t(){var e=this;var i=[{id:"showDiscountInputOption",checked:this.options.showDiscountBlock!=="N",title:this.localize.CATALOG_FORM_ADD_SHOW_DISCOUNTS_OPTION}];var a=p.Tag.render(v());i.forEach(function(t){a.append(e.getSettingItem(t))});return a},showConfigPopup:function t(e){if(!this.popupMenu){this.popupMenu=new d.Popup(null,e.target,{autoHide:true,draggable:false,offsetLeft:0,offsetTop:0,noAllPaddings:true,bindOptions:{forceBindPosition:true},closeByEsc:true,content:this.prepareSettingsContent()})}this.popupMenu.show()}},computed:babelHelpers.objectSpread({localize:function t(){return h.Vue.getFilteredPhrases("CATALOG_")},countItems:function t(){return this.order.basket.length}},l.Vuex.mapState({productList:function t(e){return e.productList}})),template:'\n\t\t<div class="catalog-pf-product-add">\n\t\t\t<div class="catalog-pf-product-add-wrapper">\n\t\t\t\t<span class="catalog-pf-product-add-link" @click="addBasketItemForm">{{localize.CATALOG_FORM_ADD_PRODUCT}}</span>\n\t\t\t\t<span class="catalog-pf-product-add-link catalog-pf-product-add-link--gray" @click="showDialogProductSearch">{{localize.CATALOG_FORM_ADD_PRODUCT_FROM_CATALOG}}</span>\n\t\t\t</div>\n\t\t\t<div class="catalog-pf-product-configure-link" @click="showConfigPopup">{{localize.CATALOG_FORM_DISCOUNT_EDIT_PAGE_URL_TITLE}}</div>\n\t\t</div>\n\t'});h.Vue.component(I.templateName,{props:["options"],created:function t(){BX.ajax.runAction("catalog.productSelector.getFileInput",{json:{iblockId:this.options.iblockId}})},methods:{refreshBasket:function t(){this.$store.dispatch("productList/refreshBasket")},changeProduct:function t(e){this.$root.$app.changeProduct(e)},changeRowData:function t(e){delete e.fields.fields;this.$store.dispatch("productList/changeItem",e)},removeItem:function t(e){this.$root.$app.removeProduct(e)},addItem:function t(){this.$root.$app.addProduct()}},computed:babelHelpers.objectSpread({localize:function t(){return h.Vue.getFilteredPhrases("CATALOG_")},editable:function t(){return this.$root.$app.editable},showTaxResult:function t(){return this.options.showTaxBlock!=="N"},showResults:function t(){return this.options.showResults!==false},showButtonsTop:function t(){return this.options.singleProductMode!==true&&this.editable&&this.options.buttonsPosition!==E.BOTTOM},showButtonsBottom:function t(){return this.options.singleProductMode!==true&&this.editable&&this.options.buttonsPosition===E.BOTTOM},showResultBlock:function t(){return this.showResults||this.enableAddButtons},countItems:function t(){return this.productList.basket.length}},l.Vuex.mapState({productList:function t(e){return e.productList}})),template:'\n\t<div class="catalog-product-form-container">\n\t\t<'.concat(I.templateProductAddName,'\n\t\t\t:options="options" \n\t\t\t@refreshBasket="refreshBasket" \n\t\t\t@addItem="addItem"\n\t\t\t@changeRowData="changeRowData"\n\t\t\t@changeProduct="changeProduct" \n\t\t\tv-if="showButtonsTop"\n\t\t/>\n\t\t<div v-for="(item, index) in productList.basket" :key="item.selectorId">\n\t\t\t<').concat(I.templateProductRowName,' \n\t\t\t\t:basketItem="item" \n\t\t\t\t:basketItemIndex="index"  \n\t\t\t\t:countItems="countItems"\n\t\t\t\t:options="options"\n\t\t\t\t:editable="editable"\n\t\t\t\t@changeProduct="changeProduct" \n\t\t\t\t@changeRowData="changeRowData" \n\t\t\t\t@removeItem="removeItem" \n\t\t\t\t@refreshBasket="refreshBasket" \n\t\t\t/>\n\t\t</div>\n\t\t<').concat(I.templateProductAddName,'\n\t\t\t:options="options" \n\t\t\t@refreshBasket="refreshBasket" \n\t\t\t@addItem="addItem"\n\t\t\t@changeRowData="changeRowData"\n\t\t\t@changeProduct="changeProduct" \n\t\t\tv-if="showButtonsBottom"\n\t\t/>\n\t\t<div class="catalog-pf-result-line"></div>\n\t\t<div class="catalog-pf-result-wrapper" v-if="showResultBlock">\n\t\t\t<table class="catalog-pf-result" v-if="showResultBlock">\n\t\t\t\t<tr v-if="showResults">\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span class="catalog-pf-text">{{localize.CATALOG_FORM_PRODUCTS_PRICE}}:</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span v-html="productList.total.sum"\n\t\t\t\t\t\t\t:class="productList.total.result !== productList.total.sum ? \'catalog-pf-text catalog-pf-text--line-through\' : \'catalog-pf-text\'"\n\t\t\t\t\t\t></span>\n\t\t\t\t\t\t<span class="catalog-pf-symbol" v-html="options.currencySymbol"></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr v-if="showResults">\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--discount">{{localize.CATALOG_FORM_TOTAL_DISCOUNT}}:</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--discount" v-html="productList.total.discount"></span>\n\t\t\t\t\t\t<span class="catalog-pf-symbol" v-html="options.currencySymbol"></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr v-if="showResults && showTaxResult">\n\t\t\t\t\t<td class="catalog-pf-tax">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--tax">{{localize.CATALOG_FORM_TAX_TITLE}}:</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class="catalog-pf-tax">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--tax" v-html="productList.total.taxSum"></span>\n\t\t\t\t\t\t<span class="catalog-pf-symbol" v-html="options.currencySymbol"></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr v-if="showResults">\n\t\t\t\t\t<td class="catalog-pf-result-padding">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--total catalog-pf-text--border">{{localize.CATALOG_FORM_TOTAL_RESULT}}:</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class="catalog-pf-result-padding">\n\t\t\t\t\t\t<span class="catalog-pf-text catalog-pf-text--total" v-html="productList.total.result"></span>\n\t\t\t\t\t\t<span class="catalog-pf-symbol catalog-pf-symbol--total" v-html="options.currencySymbol"></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>\n\t</div>\n')});function k(){var t=babelHelpers.taggedTemplateLiteral(['<div class=""></div>']);k=function e(){return t};return t}function x(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var E=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(E,"TOP","TOP");babelHelpers.defineProperty(E,"BOTTOM","BOTTOM");var C=new WeakSet;var P=function(){function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{basket:[],measures:[],iblockId:null,basePriceId:null,taxList:[],currencySymbol:null,singleProductMode:false,showResults:false,currency:"",pricePrecision:2,taxIncluded:"N",showDiscountBlock:"Y",showTaxBlock:"Y",newItemPosition:E.TOP,buttonsPosition:E.TOP,urlBuilderContext:"SHOP"};babelHelpers.classCallCheck(this,t);C.add(this);i.taxIncluded=i.taxIncluded||"N";i.showTaxBlock="N";i.urlBuilderContext=i.urlBuilderContext||"SHOP";m.CurrencyCore.loadCurrencyFormat();this.options=i;this.editable=true;if(p.Type.isBoolean(i.isCatalogAvailable)){this.isCatalogAvailable=i.isCatalogAvailable}else{this.isCatalogAvailable=false}this.wrapper=p.Tag.render(k());if(p.Text.toNumber(i.iblockId)<=0){return}t.initStore().then(function(t){return e.initTemplate(t)}).catch(function(e){return t.showError(e)})}babelHelpers.createClass(t,[{key:"layout",value:function t(){return this.wrapper}},{key:"initTemplate",value:function t(e){var i=this;return new Promise(function(t){var a=i;i.store=e.store;i.templateEngine=h.Vue.create({el:i.wrapper,store:i.store,data:{options:i.options},created:function t(){this.$app=a},mounted:function e(){t()},template:"<".concat(I.templateName,' :options="options"/>')});i.setData({currency:i.options.currency});if(i.options.basket.length>0){i.setData({basket:i.options.basket});if(p.Type.isObject(i.options.totals)){i.store.commit("productList/setTotal",i.options.totals)}else{i.store.commit("productList/calculateTotal")}}else{i.addProduct()}})}},{key:"addProduct",value:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.store.dispatch("productList/addItem",{item:i,position:this.options.newItemPosition}).then(function(){x(e,C,y).call(e)})}},{key:"changeProduct",value:function t(e){var i=this;this.store.dispatch("productList/changeItem",{index:e.index,fields:e.fields}).then(function(){x(i,C,y).call(i)})}},{key:"removeProduct",value:function t(e){var i=this;this.store.dispatch("productList/removeItem",{index:e.index}).then(function(){x(i,C,y).call(i)})}},{key:"setData",value:function t(e){var i=this;if(p.Type.isObject(e.basket)){e.basket.forEach(function(t,e){if(p.Type.isObject(t)){e=t.innerId||e;i.store.dispatch("productList/changeItem",{index:e,fields:t})}})}if(p.Type.isStringFilled(e.currency)){this.store.dispatch("productList/setCurrency",e.currency)}if(p.Type.isObject(e.total)){this.store.commit("productList/setTotal",{sum:e.total.sum,taxSum:e.total.taxSum,discount:e.total.discount,result:e.total.result})}if(p.Type.isObject(e.errors)){this.store.commit("productList/setErrors",e.errors)}}},{key:"changeFormOption",value:function t(e,i){var a=this;i=i==="Y"?"Y":"N";this.options[e]=i;var s=this.store.getters["productList/getBasket"]();s.forEach(function(t,s){if(e==="showDiscountBlock"){t.showDiscountBlock=i}else if(e==="showTaxBlock"){t.showTaxBlock=i}else if(e==="taxIncluded"){t.fields.taxIncluded=i}a.store.dispatch("productList/changeItem",{index:s,fields:t})});p.ajax.runAction("catalog.productForm.setConfig",{data:{configName:e,value:i}})}},{key:"getTotal",value:function t(){this.store.dispatch("productList/getTotal")}},{key:"setEditable",value:function t(e){this.editable=e}}],[{key:"initStore",value:function t(){var e=new l.VuexBuilder;return e.addModel(g.create()).useNamespace(true).build()}},{key:"showError",value:function t(e){console.error(e)}}]);return t}();var y=function t(){f.EventEmitter.emit(this,"ProductForm:onBasketChange",{basket:this.store.getters["productList/getBasket"]()})};t.ProductFormElementPosition=E;t.ProductForm=P})(this.BX.Catalog=this.BX.Catalog||{},BX,BX,BX.UI,BX,BX.UI,BX.Catalog,BX,BX.UI,BX.Catalog,BX,BX.Main,BX,BX,BX.Event,BX.Currency);
//# sourceMappingURL=product-form.bundle.map.js