{"version":3,"file":"sku-tree.bundle.js","sources":["../src/sku-property.js","../src/sku-tree.js"],"sourcesContent":["import {Dom, Tag, Text, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {SkuTree} from 'catalog.sku-tree';\n\nexport default class SkuProperty\n{\n\tparent: ?SkuTree;\n\n\tskuSelectHandler = this.handleSkuSelect.bind(this);\n\n\tconstructor(options)\n\t{\n\t\tthis.parent = options.parent || null;\n\t\tif (!this.parent)\n\t\t{\n\t\t\tthrow new Error('Parent is not defined.');\n\t\t}\n\n\t\tthis.property = options.property || {};\n\t\tthis.offers = options.offers || [];\n\t\tthis.existingValues = options.existingValues || [];\n\t\tthis.nodeDescriptions = [];\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.property.ID;\n\t}\n\n\tgetSelectedSkuId()\n\t{\n\t\treturn this.parent.getSelectedSku().ID;\n\t}\n\n\thasSkuValues()\n\t{\n\t\treturn this.property.VALUES.length;\n\t}\n\n\trenderPictureSku(propertyValue, uniqueId)\n\t{\n\t\tconst propertyName = Type.isStringFilled(propertyValue.NAME) ? Text.encode(propertyValue.NAME) : '';\n\n\t\tlet nameNode = '';\n\t\tif (Type.isStringFilled(propertyName))\n\t\t{\n\t\t\tnameNode = Tag.render`<span class=\"ui-ctl-label-text\">${propertyName}</span>`;\n\t\t}\n\n\t\tlet style;\n\t\tif (propertyValue.PICT && propertyValue.PICT.SRC)\n\t\t{\n\t\t\tstyle = \"background-image: url('\" + propertyValue.PICT.SRC + \"');\";\n\t\t}\n\t\telse if (nameNode)\n\t\t{\n\t\t\tstyle = \"display: none;\";\n\t\t\tnameNode.style.paddingLeft = '0';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstyle = \"background: #fff url(data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2215%22%20height%3D%2215%22%3E%3Cpath%20fill%3D%22%23A8ADB4%22%20fill-rule%3D%22evenodd%22%20d%3D%22M1.765%200h11.47C14.21%200%2015%20.79%2015%201.765v11.47C15%2014.21%2014.21%2015%2013.235%2015H1.765C.79%2015%200%2014.21%200%2013.235V1.765C0%20.79.79%200%201.765%200zm0%2013.235h11.47v-.882l-3.058-3.53-1.53%201.765-3.824-4.412-3.058%203.53v3.53zm9.264-7.94a1.324%201.324%200%20100-2.648%201.324%201.324%200%20000%202.647z%22%20opacity%3D%22.761%22/%3E%3C/svg%3E) no-repeat center;\";\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<label \tclass=\"ui-ctl ui-ctl-radio-selector\"\n\t\t\t\t\tonclick=\"${this.skuSelectHandler}\"\n\t\t\t\t\ttitle=\"${propertyName}\"\n\t\t\t\t\tdata-property-id=\"${this.getId()}\"\n\t\t\t\t\tdata-property-value=\"${propertyValue.ID}\">\n\t\t\t\t<input type=\"radio\"\n\t\t\t\t\tdisabled=\"${!this.parent.isSelectable()}\"\n\t\t\t\t\tname=\"property-${this.getSelectedSkuId()}-${this.getId()}-${uniqueId}\"\n\t\t\t\t\tclass=\"ui-ctl-element\">\n\t\t\t\t<span class=\"ui-ctl-inner\">\n\t\t\t\t\t<span class=\"ui-ctl-label-img\" style=\"${style}\"></span>\n\t\t\t\t\t${nameNode}\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t`;\n\t}\n\n\trenderTextSku(propertyValue, uniqueId)\n\t{\n\t\tconst propertyName = Type.isStringFilled(propertyValue.NAME) ? Text.encode(propertyValue.NAME) : '-';\n\n\t\treturn Tag.render`\n\t\t\t<label \tclass=\"ui-ctl ui-ctl-radio-selector\"\n\t\t\t\t\tonclick=\"${this.skuSelectHandler}\"\n\t\t\t\t\ttitle=\"${propertyName}\"\n\t\t\t\t\tdata-property-id=\"${this.getId()}\"\n\t\t\t\t\tdata-property-value=\"${propertyValue.ID}\">\n\t\t\t\t<input type=\"radio\"\n\t\t\t\t\tdisabled=\"${!this.parent.isSelectable()}\"\n\t\t\t\t\tname=\"property-${this.getSelectedSkuId()}-${this.getId()}-${uniqueId}\"\n\t\t\t\t\tclass=\"ui-ctl-element\">\n\t\t\t\t<span class=\"ui-ctl-inner\">\n\t\t\t\t\t<span class=\"ui-ctl-label-text\">${propertyName}</span>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t`;\n\t}\n\n\tlayout()\n\t{\n\t\tif (!this.hasSkuValues())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.skuList = this.renderProperties();\n\t\tthis.toggleSkuPropertyValues();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"product-item-detail-info-container\">\n\t\t\t\t<div class=\"product-item-detail-info-container-title\">${Text.encode(this.property.NAME)}</div>\n\t\t\t\t<div class=\"product-item-scu-container\">\n\t\t\t\t\t${this.skuList}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderProperties()\n\t{\n\t\tconst skuList = Tag.render`<div class=\"product-item-scu-list ui-ctl-spacing-right\"></div>`;\n\n\t\tthis.property.VALUES.forEach((propertyValue) => {\n\t\t\tlet propertyValueId = propertyValue.ID;\n\t\t\tlet node;\n\t\t\tlet uniqueId = Text.getRandom();\n\n\t\t\tif (!propertyValueId || this.existingValues.includes(propertyValueId))\n\t\t\t{\n\t\t\t\tif (this.property.SHOW_MODE === 'PICT')\n\t\t\t\t{\n\t\t\t\t\tnode = this.renderPictureSku(propertyValue, uniqueId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnode = this.renderTextSku(propertyValue, uniqueId);\n\t\t\t\t}\n\n\t\t\t\tthis.nodeDescriptions.push({propertyValueId, node});\n\t\t\t\tskuList.appendChild(node);\n\t\t\t}\n\t\t});\n\n\t\treturn skuList;\n\t}\n\n\ttoggleSkuPropertyValues()\n\t{\n\t\tconst selectedSkuProperty = this.parent.getSelectedSkuProperty(this.getId());\n\t\tconst activeSkuProperties = this.parent.getActiveSkuProperties(this.getId());\n\n\t\tthis.nodeDescriptions.forEach((item) => {\n\t\t\tlet id = Text.toNumber(item.propertyValueId);\n\t\t\tlet input = item.node.querySelector('input[type=\"radio\"]');\n\n\t\t\tif (selectedSkuProperty === id)\n\t\t\t{\n\t\t\t\tinput.checked = true;\n\t\t\t\tDom.addClass(item.node, 'selected');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tinput.checked = false;\n\t\t\t\tDom.removeClass(item.node, 'selected');\n\t\t\t}\n\n\t\t\tif (activeSkuProperties.includes(id))\n\t\t\t{\n\t\t\t\tDom.style(item.node, {display: null});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.style(item.node, {display: 'none'});\n\t\t\t}\n\t\t});\n\t}\n\n\thandleSkuSelect(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tconst selectedSkuProperty = event.target.closest('[data-property-id]');\n\t\tif (!this.parent.isSelectable() || Dom.hasClass(selectedSkuProperty, 'selected'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst propertyId = Text.toNumber(selectedSkuProperty.getAttribute('data-property-id'));\n\t\tconst propertyValue = Text.toNumber(selectedSkuProperty.getAttribute('data-property-value'));\n\n\t\tthis.parent.setSelectedProperty(propertyId, propertyValue);\n\t\tthis.parent.toggleSkuProperties();\n\n\t\tEventEmitter.emit('SkuProperty::onChange', [this.parent.getSelectedSku(), this.property]);\n\t\tif (this.parent)\n\t\t{\n\t\t\tthis.parent.emit('SkuProperty::onChange', [this.parent.getSelectedSku(), this.property]);\n\t\t}\n\t}\n}","import {Tag, Type} from 'main.core';\nimport SkuProperty from './sku-property';\nimport './sku-tree.css';\nimport {EventEmitter} from 'main.core.events';\n\nexport class SkuTree extends EventEmitter\n{\n\tselectedValues = {};\n\n\tconstructor(options)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Catalog.SkuTree');\n\n\t\tthis.skuTree = options.skuTree || {};\n\t\tthis.selectable = (options.selectable !== false);\n\n\t\tif (this.hasSku())\n\t\t{\n\t\t\tthis.selectedValues = this.skuTree.SELECTED_VALUES || {...this.skuTree.OFFERS[0].TREE};\n\t\t}\n\t}\n\n\tisSelectable()\n\t{\n\t\treturn this.selectable;\n\t}\n\n\tgetSelectedValues()\n\t{\n\t\treturn this.selectedValues;\n\t}\n\n\tsetSelectedProperty(propertyId, propertyValue)\n\t{\n\t\tthis.selectedValues[propertyId] = propertyValue;\n\n\t\tconst remainingProperties = this.getRemainingProperties(propertyId);\n\t\tif (remainingProperties.length)\n\t\t{\n\t\t\tfor (let remainingPropertyId of remainingProperties)\n\t\t\t{\n\t\t\t\tlet filterProperties = this.getFilterProperties(remainingPropertyId);\n\t\t\t\tlet skuItems = this.filterSku(filterProperties);\n\n\t\t\t\tif (skuItems.length)\n\t\t\t\t{\n\t\t\t\t\tlet found = false;\n\t\t\t\t\tfor (let sku of skuItems)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (sku.TREE[remainingPropertyId] === this.selectedValues[remainingPropertyId])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!found)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selectedValues[remainingPropertyId] = skuItems[0].TREE[remainingPropertyId];\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetRemainingProperties(propertyId)\n\t{\n\t\tconst filter = [];\n\t\tlet found = false;\n\n\t\tfor (let prop of Object.values(this.skuTree.OFFERS_PROP))\n\t\t{\n\t\t\tif (prop.ID === propertyId)\n\t\t\t{\n\t\t\t\tfound = true;\n\t\t\t}\n\t\t\telse if (found)\n\t\t\t{\n\t\t\t\tfilter.push(prop.ID);\n\t\t\t}\n\t\t}\n\n\t\treturn filter;\n\t}\n\n\thasSku()\n\t{\n\t\treturn Type.isArrayFilled(this.skuTree.OFFERS);\n\t}\n\n\thasSkuProps()\n\t{\n\t\treturn Type.isPlainObject(this.skuTree.OFFERS_PROP) && Object.keys(this.skuTree.OFFERS_PROP).length;\n\t}\n\n\tgetSelectedSku()\n\t{\n\t\tif (!this.hasSku())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.skuTree.OFFERS.filter(item => {\n\t\t\treturn JSON.stringify(item.TREE) === JSON.stringify(this.selectedValues);\n\t\t})[0];\n\t}\n\n\tgetActiveSkuProperties(propertyId)\n\t{\n\t\tconst activeSkuProperties = [];\n\t\tconst filterProperties = this.getFilterProperties(propertyId);\n\n\t\tthis.filterSku(filterProperties)\n\t\t\t.forEach(item => {\n\t\t\t\tif (!activeSkuProperties.includes(item.TREE[propertyId]))\n\t\t\t\t{\n\t\t\t\t\tactiveSkuProperties.push(item.TREE[propertyId]);\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\treturn activeSkuProperties;\n\t}\n\n\tgetFilterProperties(propertyId)\n\t{\n\t\tconst filter = [];\n\n\t\tfor (let prop of Object.values(this.skuTree.OFFERS_PROP))\n\t\t{\n\t\t\tif (prop.ID === propertyId)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tfilter.push(prop.ID);\n\t\t}\n\n\t\treturn filter;\n\t}\n\n\tfilterSku(filter)\n\t{\n\t\tif (filter.length === 0)\n\t\t{\n\t\t\treturn this.skuTree.OFFERS;\n\t\t}\n\n\t\tconst selectedValues = this.getSelectedValues();\n\n\t\treturn this.skuTree.OFFERS.filter(sku => {\n\t\t\tfor (let prop of filter)\n\t\t\t{\n\t\t\t\tif (sku.TREE[prop] !== selectedValues[prop])\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tgetSelectedSkuProperty(propertyId)\n\t{\n\t\treturn this.getSelectedSku()['TREE'][propertyId];\n\t}\n\n\tlayout()\n\t{\n\t\tconst container = Tag.render`<div class=\"product-item-scu-wrapper\"></div>`;\n\n\t\tthis.skuProperties = [];\n\n\t\tif (this.hasSku() && this.hasSkuProps())\n\t\t{\n\t\t\tfor (let i in this.skuTree.OFFERS_PROP)\n\t\t\t{\n\t\t\t\tif (this.skuTree.OFFERS_PROP.hasOwnProperty(i))\n\t\t\t\t{\n\t\t\t\t\tlet skuProperty = new SkuProperty({\n\t\t\t\t\t\tparent: this,\n\t\t\t\t\t\tproperty: this.skuTree.OFFERS_PROP[i],\n\t\t\t\t\t\texistingValues: this.skuTree.EXISTING_VALUES[i],\n\t\t\t\t\t\toffers: this.skuTree.OFFERS\n\t\t\t\t\t});\n\t\t\t\t\tcontainer.appendChild(skuProperty.layout());\n\t\t\t\t\tthis.skuProperties.push(skuProperty);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn container;\n\t}\n\n\ttoggleSkuProperties()\n\t{\n\t\tthis.skuProperties.forEach(property => property.toggleSkuPropertyValues());\n\t}\n}"],"names":["SkuProperty","options","handleSkuSelect","bind","parent","Error","property","offers","existingValues","nodeDescriptions","ID","getSelectedSku","VALUES","length","propertyValue","uniqueId","propertyName","Type","isStringFilled","NAME","Text","encode","nameNode","Tag","render","style","PICT","SRC","paddingLeft","skuSelectHandler","getId","isSelectable","getSelectedSkuId","hasSkuValues","skuList","renderProperties","toggleSkuPropertyValues","forEach","propertyValueId","node","getRandom","includes","SHOW_MODE","renderPictureSku","renderTextSku","push","appendChild","selectedSkuProperty","getSelectedSkuProperty","activeSkuProperties","getActiveSkuProperties","item","id","toNumber","input","querySelector","checked","Dom","addClass","removeClass","display","event","stopPropagation","target","closest","hasClass","propertyId","getAttribute","setSelectedProperty","toggleSkuProperties","EventEmitter","emit","SkuTree","setEventNamespace","skuTree","selectable","hasSku","selectedValues","SELECTED_VALUES","OFFERS","TREE","remainingProperties","getRemainingProperties","remainingPropertyId","filterProperties","getFilterProperties","skuItems","filterSku","found","sku","filter","Object","values","OFFERS_PROP","prop","isArrayFilled","isPlainObject","keys","JSON","stringify","getSelectedValues","container","skuProperties","hasSkuProps","i","hasOwnProperty","skuProperty","EXISTING_VALUES","layout"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;KAIqBA;CAMpB,uBAAYC,OAAZ,EACA;CAAA;CAAA,0DAHmB,KAAKC,eAAL,CAAqBC,IAArB,CAA0B,IAA1B,CAGnB;CACC,SAAKC,MAAL,GAAcH,OAAO,CAACG,MAAR,IAAkB,IAAhC;;CACA,QAAI,CAAC,KAAKA,MAAV,EACA;CACC,YAAM,IAAIC,KAAJ,CAAU,wBAAV,CAAN;CACA;;CAED,SAAKC,QAAL,GAAgBL,OAAO,CAACK,QAAR,IAAoB,EAApC;CACA,SAAKC,MAAL,GAAcN,OAAO,CAACM,MAAR,IAAkB,EAAhC;CACA,SAAKC,cAAL,GAAsBP,OAAO,CAACO,cAAR,IAA0B,EAAhD;CACA,SAAKC,gBAAL,GAAwB,EAAxB;CACA;;;;6BAGD;CACC,aAAO,KAAKH,QAAL,CAAcI,EAArB;CACA;;;wCAGD;CACC,aAAO,KAAKN,MAAL,CAAYO,cAAZ,GAA6BD,EAApC;CACA;;;oCAGD;CACC,aAAO,KAAKJ,QAAL,CAAcM,MAAd,CAAqBC,MAA5B;CACA;;;sCAEgBC,eAAeC,UAChC;CACC,UAAMC,YAAY,GAAGC,cAAI,CAACC,cAAL,CAAoBJ,aAAa,CAACK,IAAlC,IAA0CC,cAAI,CAACC,MAAL,CAAYP,aAAa,CAACK,IAA1B,CAA1C,GAA4E,EAAjG;CAEA,UAAIG,QAAQ,GAAG,EAAf;;CACA,UAAIL,cAAI,CAACC,cAAL,CAAoBF,YAApB,CAAJ,EACA;CACCM,QAAAA,QAAQ,GAAGC,aAAG,CAACC,MAAP,oBAAgDR,YAAhD,CAAR;CACA;;CAED,UAAIS,KAAJ;;CACA,UAAIX,aAAa,CAACY,IAAd,IAAsBZ,aAAa,CAACY,IAAd,CAAmBC,GAA7C,EACA;CACCF,QAAAA,KAAK,GAAG,4BAA4BX,aAAa,CAACY,IAAd,CAAmBC,GAA/C,GAAqD,KAA7D;CACA,OAHD,MAIK,IAAIL,QAAJ,EACL;CACCG,QAAAA,KAAK,GAAG,gBAAR;CACAH,QAAAA,QAAQ,CAACG,KAAT,CAAeG,WAAf,GAA6B,GAA7B;CACA,OAJI,MAML;CACCH,QAAAA,KAAK,GAAG,4lBAAR;CACA;;CAED,aAAOF,aAAG,CAACC,MAAX,qBAEc,KAAKK,gBAFnB,EAGYb,YAHZ,EAIuB,KAAKc,KAAL,EAJvB,EAK0BhB,aAAa,CAACJ,EALxC,EAOe,CAAC,KAAKN,MAAL,CAAY2B,YAAZ,EAPhB,EAQoB,KAAKC,gBAAL,EARpB,EAQ+C,KAAKF,KAAL,EAR/C,EAQ+Df,QAR/D,EAW2CU,KAX3C,EAYKH,QAZL;CAgBA;;;mCAEaR,eAAeC,UAC7B;CACC,UAAMC,YAAY,GAAGC,cAAI,CAACC,cAAL,CAAoBJ,aAAa,CAACK,IAAlC,IAA0CC,cAAI,CAACC,MAAL,CAAYP,aAAa,CAACK,IAA1B,CAA1C,GAA4E,GAAjG;CAEA,aAAOI,aAAG,CAACC,MAAX,qBAEc,KAAKK,gBAFnB,EAGYb,YAHZ,EAIuB,KAAKc,KAAL,EAJvB,EAK0BhB,aAAa,CAACJ,EALxC,EAOe,CAAC,KAAKN,MAAL,CAAY2B,YAAZ,EAPhB,EAQoB,KAAKC,gBAAL,EARpB,EAQ+C,KAAKF,KAAL,EAR/C,EAQ+Df,QAR/D,EAWqCC,YAXrC;CAeA;;;8BAGD;CACC,UAAI,CAAC,KAAKiB,YAAL,EAAL,EACA;CACC;CACA;;CAED,WAAKC,OAAL,GAAe,KAAKC,gBAAL,EAAf;CACA,WAAKC,uBAAL;CAEA,aAAOb,aAAG,CAACC,MAAX,qBAE0DJ,cAAI,CAACC,MAAL,CAAY,KAAKf,QAAL,CAAca,IAA1B,CAF1D,EAIK,KAAKe,OAJV;CAQA;;;wCAGD;CAAA;;CACC,UAAMA,OAAO,GAAGX,aAAG,CAACC,MAAP,oBAAb;CAEA,WAAKlB,QAAL,CAAcM,MAAd,CAAqByB,OAArB,CAA6B,UAACvB,aAAD,EAAmB;CAC/C,YAAIwB,eAAe,GAAGxB,aAAa,CAACJ,EAApC;CACA,YAAI6B,IAAJ;CACA,YAAIxB,QAAQ,GAAGK,cAAI,CAACoB,SAAL,EAAf;;CAEA,YAAI,CAACF,eAAD,IAAoB,KAAI,CAAC9B,cAAL,CAAoBiC,QAApB,CAA6BH,eAA7B,CAAxB,EACA;CACC,cAAI,KAAI,CAAChC,QAAL,CAAcoC,SAAd,KAA4B,MAAhC,EACA;CACCH,YAAAA,IAAI,GAAG,KAAI,CAACI,gBAAL,CAAsB7B,aAAtB,EAAqCC,QAArC,CAAP;CACA,WAHD,MAKA;CACCwB,YAAAA,IAAI,GAAG,KAAI,CAACK,aAAL,CAAmB9B,aAAnB,EAAkCC,QAAlC,CAAP;CACA;;CAED,UAAA,KAAI,CAACN,gBAAL,CAAsBoC,IAAtB,CAA2B;CAACP,YAAAA,eAAe,EAAfA,eAAD;CAAkBC,YAAAA,IAAI,EAAJA;CAAlB,WAA3B;;CACAL,UAAAA,OAAO,CAACY,WAAR,CAAoBP,IAApB;CACA;CACD,OAnBD;CAqBA,aAAOL,OAAP;CACA;;;+CAGD;CACC,UAAMa,mBAAmB,GAAG,KAAK3C,MAAL,CAAY4C,sBAAZ,CAAmC,KAAKlB,KAAL,EAAnC,CAA5B;CACA,UAAMmB,mBAAmB,GAAG,KAAK7C,MAAL,CAAY8C,sBAAZ,CAAmC,KAAKpB,KAAL,EAAnC,CAA5B;CAEA,WAAKrB,gBAAL,CAAsB4B,OAAtB,CAA8B,UAACc,IAAD,EAAU;CACvC,YAAIC,EAAE,GAAGhC,cAAI,CAACiC,QAAL,CAAcF,IAAI,CAACb,eAAnB,CAAT;CACA,YAAIgB,KAAK,GAAGH,IAAI,CAACZ,IAAL,CAAUgB,aAAV,CAAwB,qBAAxB,CAAZ;;CAEA,YAAIR,mBAAmB,KAAKK,EAA5B,EACA;CACCE,UAAAA,KAAK,CAACE,OAAN,GAAgB,IAAhB;CACAC,UAAAA,aAAG,CAACC,QAAJ,CAAaP,IAAI,CAACZ,IAAlB,EAAwB,UAAxB;CACA,SAJD,MAMA;CACCe,UAAAA,KAAK,CAACE,OAAN,GAAgB,KAAhB;CACAC,UAAAA,aAAG,CAACE,WAAJ,CAAgBR,IAAI,CAACZ,IAArB,EAA2B,UAA3B;CACA;;CAED,YAAIU,mBAAmB,CAACR,QAApB,CAA6BW,EAA7B,CAAJ,EACA;CACCK,UAAAA,aAAG,CAAChC,KAAJ,CAAU0B,IAAI,CAACZ,IAAf,EAAqB;CAACqB,YAAAA,OAAO,EAAE;CAAV,WAArB;CACA,SAHD,MAKA;CACCH,UAAAA,aAAG,CAAChC,KAAJ,CAAU0B,IAAI,CAACZ,IAAf,EAAqB;CAACqB,YAAAA,OAAO,EAAE;CAAV,WAArB;CACA;CACD,OAvBD;CAwBA;;;qCAEeC,OAChB;CACCA,MAAAA,KAAK,CAACC,eAAN;CAEA,UAAMf,mBAAmB,GAAGc,KAAK,CAACE,MAAN,CAAaC,OAAb,CAAqB,oBAArB,CAA5B;;CACA,UAAI,CAAC,KAAK5D,MAAL,CAAY2B,YAAZ,EAAD,IAA+B0B,aAAG,CAACQ,QAAJ,CAAalB,mBAAb,EAAkC,UAAlC,CAAnC,EACA;CACC;CACA;;CAED,UAAMmB,UAAU,GAAG9C,cAAI,CAACiC,QAAL,CAAcN,mBAAmB,CAACoB,YAApB,CAAiC,kBAAjC,CAAd,CAAnB;CACA,UAAMrD,aAAa,GAAGM,cAAI,CAACiC,QAAL,CAAcN,mBAAmB,CAACoB,YAApB,CAAiC,qBAAjC,CAAd,CAAtB;CAEA,WAAK/D,MAAL,CAAYgE,mBAAZ,CAAgCF,UAAhC,EAA4CpD,aAA5C;CACA,WAAKV,MAAL,CAAYiE,mBAAZ;CAEAC,MAAAA,6BAAY,CAACC,IAAb,CAAkB,uBAAlB,EAA2C,CAAC,KAAKnE,MAAL,CAAYO,cAAZ,EAAD,EAA+B,KAAKL,QAApC,CAA3C;;CACA,UAAI,KAAKF,MAAT,EACA;CACC,aAAKA,MAAL,CAAYmE,IAAZ,CAAiB,uBAAjB,EAA0C,CAAC,KAAKnE,MAAL,CAAYO,cAAZ,EAAD,EAA+B,KAAKL,QAApC,CAA1C;CACA;CACD;;;;;;;;;;;;;;;;;;;;KCtMWkE,OAAb;CAAA;;CAIC,mBAAYvE,OAAZ,EACA;CAAA;;CAAA;CACC;CADD,6FAHiB,EAGjB;;CAEC,UAAKwE,iBAAL,CAAuB,oBAAvB;;CAEA,UAAKC,OAAL,GAAezE,OAAO,CAACyE,OAAR,IAAmB,EAAlC;CACA,UAAKC,UAAL,GAAmB1E,OAAO,CAAC0E,UAAR,KAAuB,KAA1C;;CAEA,QAAI,MAAKC,MAAL,EAAJ,EACA;CACC,YAAKC,cAAL,GAAsB,MAAKH,OAAL,CAAaI,eAAb,kCAAoC,MAAKJ,OAAL,CAAaK,MAAb,CAAoB,CAApB,EAAuBC,IAA3D,CAAtB;CACA;;CAVF;CAWC;;CAhBF;CAAA;CAAA,mCAmBC;CACC,aAAO,KAAKL,UAAZ;CACA;CArBF;CAAA;CAAA,wCAwBC;CACC,aAAO,KAAKE,cAAZ;CACA;CA1BF;CAAA;CAAA,wCA4BqBX,UA5BrB,EA4BiCpD,aA5BjC,EA6BC;CACC,WAAK+D,cAAL,CAAoBX,UAApB,IAAkCpD,aAAlC;CAEA,UAAMmE,mBAAmB,GAAG,KAAKC,sBAAL,CAA4BhB,UAA5B,CAA5B;;CACA,UAAIe,mBAAmB,CAACpE,MAAxB,EACA;CAAA,mDACiCoE,mBADjC;CAAA;;CAAA;CACC,8DACA;CAAA,gBADSE,mBACT;CACC,gBAAIC,gBAAgB,GAAG,KAAKC,mBAAL,CAAyBF,mBAAzB,CAAvB;CACA,gBAAIG,QAAQ,GAAG,KAAKC,SAAL,CAAeH,gBAAf,CAAf;;CAEA,gBAAIE,QAAQ,CAACzE,MAAb,EACA;CACC,kBAAI2E,KAAK,GAAG,KAAZ;;CADD,0DAEiBF,QAFjB;CAAA;;CAAA;CAEC,uEACA;CAAA,sBADSG,GACT;;CACC,sBAAIA,GAAG,CAACT,IAAJ,CAASG,mBAAT,MAAkC,KAAKN,cAAL,CAAoBM,mBAApB,CAAtC,EACA;CACCK,oBAAAA,KAAK,GAAG,IAAR;CACA;CACD;CARF;CAAA;CAAA;CAAA;CAAA;;CAUC,kBAAI,CAACA,KAAL,EACA;CACC,qBAAKX,cAAL,CAAoBM,mBAApB,IAA2CG,QAAQ,CAAC,CAAD,CAAR,CAAYN,IAAZ,CAAiBG,mBAAjB,CAA3C;CACA;CAED;CACD;CAvBF;CAAA;CAAA;CAAA;CAAA;CAwBC;CACD;CA3DF;CAAA;CAAA,2CA6DwBjB,UA7DxB,EA8DC;CACC,UAAMwB,MAAM,GAAG,EAAf;CACA,UAAIF,KAAK,GAAG,KAAZ;;CAEA,wCAAiBG,MAAM,CAACC,MAAP,CAAc,KAAKlB,OAAL,CAAamB,WAA3B,CAAjB,oCACA;CADK,YAAIC,IAAI,qBAAR;;CAEJ,YAAIA,IAAI,CAACpF,EAAL,KAAYwD,UAAhB,EACA;CACCsB,UAAAA,KAAK,GAAG,IAAR;CACA,SAHD,MAIK,IAAIA,KAAJ,EACL;CACCE,UAAAA,MAAM,CAAC7C,IAAP,CAAYiD,IAAI,CAACpF,EAAjB;CACA;CACD;;CAED,aAAOgF,MAAP;CACA;CA/EF;CAAA;CAAA,6BAkFC;CACC,aAAOzE,cAAI,CAAC8E,aAAL,CAAmB,KAAKrB,OAAL,CAAaK,MAAhC,CAAP;CACA;CApFF;CAAA;CAAA,kCAuFC;CACC,aAAO9D,cAAI,CAAC+E,aAAL,CAAmB,KAAKtB,OAAL,CAAamB,WAAhC,KAAgDF,MAAM,CAACM,IAAP,CAAY,KAAKvB,OAAL,CAAamB,WAAzB,EAAsChF,MAA7F;CACA;CAzFF;CAAA;CAAA,qCA4FC;CAAA;;CACC,UAAI,CAAC,KAAK+D,MAAL,EAAL,EACA;CACC,eAAO,IAAP;CACA;;CAED,aAAO,KAAKF,OAAL,CAAaK,MAAb,CAAoBW,MAApB,CAA2B,UAAAvC,IAAI,EAAI;CACzC,eAAO+C,IAAI,CAACC,SAAL,CAAehD,IAAI,CAAC6B,IAApB,MAA8BkB,IAAI,CAACC,SAAL,CAAe,MAAI,CAACtB,cAApB,CAArC;CACA,OAFM,EAEJ,CAFI,CAAP;CAGA;CArGF;CAAA;CAAA,2CAuGwBX,UAvGxB,EAwGC;CACC,UAAMjB,mBAAmB,GAAG,EAA5B;CACA,UAAMmC,gBAAgB,GAAG,KAAKC,mBAAL,CAAyBnB,UAAzB,CAAzB;CAEA,WAAKqB,SAAL,CAAeH,gBAAf,EACE/C,OADF,CACU,UAAAc,IAAI,EAAI;CAChB,YAAI,CAACF,mBAAmB,CAACR,QAApB,CAA6BU,IAAI,CAAC6B,IAAL,CAAUd,UAAV,CAA7B,CAAL,EACA;CACCjB,UAAAA,mBAAmB,CAACJ,IAApB,CAAyBM,IAAI,CAAC6B,IAAL,CAAUd,UAAV,CAAzB;CACA;CACD,OANF;CASA,aAAOjB,mBAAP;CACA;CAtHF;CAAA;CAAA,wCAwHqBiB,UAxHrB,EAyHC;CACC,UAAMwB,MAAM,GAAG,EAAf;;CAEA,0CAAiBC,MAAM,CAACC,MAAP,CAAc,KAAKlB,OAAL,CAAamB,WAA3B,CAAjB,uCACA;CADK,YAAIC,IAAI,uBAAR;;CAEJ,YAAIA,IAAI,CAACpF,EAAL,KAAYwD,UAAhB,EACA;CACC;CACA;;CAEDwB,QAAAA,MAAM,CAAC7C,IAAP,CAAYiD,IAAI,CAACpF,EAAjB;CACA;;CAED,aAAOgF,MAAP;CACA;CAvIF;CAAA;CAAA,8BAyIWA,MAzIX,EA0IC;CACC,UAAIA,MAAM,CAAC7E,MAAP,KAAkB,CAAtB,EACA;CACC,eAAO,KAAK6D,OAAL,CAAaK,MAApB;CACA;;CAED,UAAMF,cAAc,GAAG,KAAKuB,iBAAL,EAAvB;CAEA,aAAO,KAAK1B,OAAL,CAAaK,MAAb,CAAoBW,MAApB,CAA2B,UAAAD,GAAG,EAAI;CAAA,oDACvBC,MADuB;CAAA;;CAAA;CACxC,iEACA;CAAA,gBADSI,IACT;;CACC,gBAAIL,GAAG,CAACT,IAAJ,CAASc,IAAT,MAAmBjB,cAAc,CAACiB,IAAD,CAArC,EACA;CACC,qBAAO,KAAP;CACA;CACD;CAPuC;CAAA;CAAA;CAAA;CAAA;;CASxC,eAAO,IAAP;CACA,OAVM,CAAP;CAWA;CA7JF;CAAA;CAAA,2CA+JwB5B,UA/JxB,EAgKC;CACC,aAAO,KAAKvD,cAAL,GAAsB,MAAtB,EAA8BuD,UAA9B,CAAP;CACA;CAlKF;CAAA;CAAA,6BAqKC;CACC,UAAMmC,SAAS,GAAG9E,aAAG,CAACC,MAAP,qBAAf;CAEA,WAAK8E,aAAL,GAAqB,EAArB;;CAEA,UAAI,KAAK1B,MAAL,MAAiB,KAAK2B,WAAL,EAArB,EACA;CACC,aAAK,IAAIC,CAAT,IAAc,KAAK9B,OAAL,CAAamB,WAA3B,EACA;CACC,cAAI,KAAKnB,OAAL,CAAamB,WAAb,CAAyBY,cAAzB,CAAwCD,CAAxC,CAAJ,EACA;CACC,gBAAIE,WAAW,GAAG,IAAI1G,WAAJ,CAAgB;CACjCI,cAAAA,MAAM,EAAE,IADyB;CAEjCE,cAAAA,QAAQ,EAAE,KAAKoE,OAAL,CAAamB,WAAb,CAAyBW,CAAzB,CAFuB;CAGjChG,cAAAA,cAAc,EAAE,KAAKkE,OAAL,CAAaiC,eAAb,CAA6BH,CAA7B,CAHiB;CAIjCjG,cAAAA,MAAM,EAAE,KAAKmE,OAAL,CAAaK;CAJY,aAAhB,CAAlB;CAMAsB,YAAAA,SAAS,CAACvD,WAAV,CAAsB4D,WAAW,CAACE,MAAZ,EAAtB;CACA,iBAAKN,aAAL,CAAmBzD,IAAnB,CAAwB6D,WAAxB;CACA;CACD;CACD;;CAED,aAAOL,SAAP;CACA;CA7LF;CAAA;CAAA,0CAgMC;CACC,WAAKC,aAAL,CAAmBjE,OAAnB,CAA2B,UAAA/B,QAAQ;CAAA,eAAIA,QAAQ,CAAC8B,uBAAT,EAAJ;CAAA,OAAnC;CACA;CAlMF;CAAA;CAAA,EAA6BkC,6BAA7B;;;;;;;;"}