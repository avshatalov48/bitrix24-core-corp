this.BX=this.BX||{};this.BX.Catalog=this.BX.Catalog||{};(function(e,t,r,n){"use strict";function i(){var e=babelHelpers.taggedTemplateLiteral(['<div class="product-item-scu-list ui-ctl-spacing-right"></div>']);i=function t(){return e};return e}function a(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="product-item-detail-info-container">\n\t\t\t\t<div class="product-item-detail-info-container-title">','</div>\n\t\t\t\t<div class="product-item-scu-container">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);a=function t(){return e};return e}function s(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<label \tclass="ui-ctl ui-ctl-radio-selector"\n\t\t\t\t\tonclick="','"\n\t\t\t\t\ttitle="','"\n\t\t\t\t\tdata-property-id="','"\n\t\t\t\t\tdata-property-value="','">\n\t\t\t\t<input type="radio"\n\t\t\t\t\tdisabled="','"\n\t\t\t\t\tname="property-',"-","-",'"\n\t\t\t\t\tclass="ui-ctl-element">\n\t\t\t\t<span class="ui-ctl-inner">\n\t\t\t\t\t<span class="ui-ctl-label-text">',"</span>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t"]);s=function t(){return e};return e}function l(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<label \tclass="ui-ctl ui-ctl-radio-selector"\n\t\t\t\t\tonclick="','"\n\t\t\t\t\ttitle="','"\n\t\t\t\t\tdata-property-id="','"\n\t\t\t\t\tdata-property-value="','">\n\t\t\t\t<input type="radio"\n\t\t\t\t\tdisabled="','"\n\t\t\t\t\tname="property-',"-","-",'"\n\t\t\t\t\tclass="ui-ctl-element">\n\t\t\t\t<span class="ui-ctl-inner">\n\t\t\t\t\t<span class="ui-ctl-label-img" style="','"></span>\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t"]);l=function t(){return e};return e}function u(){var e=babelHelpers.taggedTemplateLiteral(['<span class="ui-ctl-label-text">',"</span>"]);u=function t(){return e};return e}var o=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"skuSelectHandler",this.handleSkuSelect.bind(this));this.parent=t.parent||null;if(!this.parent){throw new Error("Parent is not defined.")}this.property=t.property||{};this.offers=t.offers||[];this.existingValues=t.existingValues||[];this.nodeDescriptions=[]}babelHelpers.createClass(e,[{key:"getId",value:function e(){return this.property.ID}},{key:"getSelectedSkuId",value:function e(){return this.parent.getSelectedSku().ID}},{key:"hasSkuValues",value:function e(){return this.property.VALUES.length}},{key:"renderPictureSku",value:function e(r,n){var i=t.Type.isStringFilled(r.NAME)?t.Text.encode(r.NAME):"";var a="";if(t.Type.isStringFilled(i)){a=t.Tag.render(u(),i)}var s;if(r.PICT&&r.PICT.SRC){s="background-image: url('"+r.PICT.SRC+"');"}else if(a){s="display: none;";a.style.paddingLeft="0"}else{s="background: #fff url(data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2215%22%20height%3D%2215%22%3E%3Cpath%20fill%3D%22%23A8ADB4%22%20fill-rule%3D%22evenodd%22%20d%3D%22M1.765%200h11.47C14.21%200%2015%20.79%2015%201.765v11.47C15%2014.21%2014.21%2015%2013.235%2015H1.765C.79%2015%200%2014.21%200%2013.235V1.765C0%20.79.79%200%201.765%200zm0%2013.235h11.47v-.882l-3.058-3.53-1.53%201.765-3.824-4.412-3.058%203.53v3.53zm9.264-7.94a1.324%201.324%200%20100-2.648%201.324%201.324%200%20000%202.647z%22%20opacity%3D%22.761%22/%3E%3C/svg%3E) no-repeat center;"}return t.Tag.render(l(),this.skuSelectHandler,i,this.getId(),r.ID,!this.parent.isSelectable(),this.getSelectedSkuId(),this.getId(),n,s,a)}},{key:"renderTextSku",value:function e(r,n){var i=t.Type.isStringFilled(r.NAME)?t.Text.encode(r.NAME):"-";return t.Tag.render(s(),this.skuSelectHandler,i,this.getId(),r.ID,!this.parent.isSelectable(),this.getSelectedSkuId(),this.getId(),n,i)}},{key:"layout",value:function e(){if(!this.hasSkuValues()){return}this.skuList=this.renderProperties();this.toggleSkuPropertyValues();return t.Tag.render(a(),t.Text.encode(this.property.NAME),this.skuList)}},{key:"renderProperties",value:function e(){var r=this;var n=t.Tag.render(i());this.property.VALUES.forEach(function(e){var i=e.ID;var a;var s=t.Text.getRandom();if(!i||r.existingValues.includes(i)){if(r.property.SHOW_MODE==="PICT"){a=r.renderPictureSku(e,s)}else{a=r.renderTextSku(e,s)}r.nodeDescriptions.push({propertyValueId:i,node:a});n.appendChild(a)}});return n}},{key:"toggleSkuPropertyValues",value:function e(){var r=this.parent.getSelectedSkuProperty(this.getId());var n=this.parent.getActiveSkuProperties(this.getId());this.nodeDescriptions.forEach(function(e){var i=t.Text.toNumber(e.propertyValueId);var a=e.node.querySelector('input[type="radio"]');if(r===i){a.checked=true;t.Dom.addClass(e.node,"selected")}else{a.checked=false;t.Dom.removeClass(e.node,"selected")}if(n.includes(i)){t.Dom.style(e.node,{display:null})}else{t.Dom.style(e.node,{display:"none"})}})}},{key:"handleSkuSelect",value:function e(r){r.stopPropagation();var i=r.target.closest("[data-property-id]");if(!this.parent.isSelectable()||t.Dom.hasClass(i,"selected")){return}var a=t.Text.toNumber(i.getAttribute("data-property-id"));var s=t.Text.toNumber(i.getAttribute("data-property-value"));this.parent.setSelectedProperty(a,s);this.parent.toggleSkuProperties();n.EventEmitter.emit("SkuProperty::onChange",[this.parent.getSelectedSku(),this.property]);if(this.parent){this.parent.emit("SkuProperty::onChange",[this.parent.getSelectedSku(),this.property])}}}]);return e}();function c(){var e=babelHelpers.taggedTemplateLiteral(['<div class="product-item-scu-wrapper"></div>']);c=function t(){return e};return e}function p(e,t){var r;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=d(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var n=0;var i=function e(){};return{s:i,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,s=false,l;return{s:function t(){r=e[Symbol.iterator]()},n:function e(){var t=r.next();a=t.done;return t},e:function e(t){s=true;l=t},f:function e(){try{if(!a&&r.return!=null)r.return()}finally{if(s)throw l}}}}function d(e,t){if(!e)return;if(typeof e==="string")return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,t)}function f(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++){n[r]=e[r]}return n}var h=function(e){babelHelpers.inherits(r,e);function r(e){var t;babelHelpers.classCallCheck(this,r);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(r).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"selectedValues",{});t.setEventNamespace("BX.Catalog.SkuTree");t.skuTree=e.skuTree||{};t.selectable=e.selectable!==false;if(t.hasSku()){t.selectedValues=t.skuTree.SELECTED_VALUES||babelHelpers.objectSpread({},t.skuTree.OFFERS[0].TREE)}return t}babelHelpers.createClass(r,[{key:"isSelectable",value:function e(){return this.selectable}},{key:"getSelectedValues",value:function e(){return this.selectedValues}},{key:"setSelectedProperty",value:function e(t,r){this.selectedValues[t]=r;var n=this.getRemainingProperties(t);if(n.length){var i=p(n),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;var l=this.getFilterProperties(s);var u=this.filterSku(l);if(u.length){var o=false;var c=p(u),d;try{for(c.s();!(d=c.n()).done;){var f=d.value;if(f.TREE[s]===this.selectedValues[s]){o=true}}}catch(e){c.e(e)}finally{c.f()}if(!o){this.selectedValues[s]=u[0].TREE[s]}}}}catch(e){i.e(e)}finally{i.f()}}}},{key:"getRemainingProperties",value:function e(t){var r=[];var n=false;for(var i=0,a=Object.values(this.skuTree.OFFERS_PROP);i<a.length;i++){var s=a[i];if(s.ID===t){n=true}else if(n){r.push(s.ID)}}return r}},{key:"hasSku",value:function e(){return t.Type.isArrayFilled(this.skuTree.OFFERS)}},{key:"hasSkuProps",value:function e(){return t.Type.isPlainObject(this.skuTree.OFFERS_PROP)&&Object.keys(this.skuTree.OFFERS_PROP).length}},{key:"getSelectedSku",value:function e(){var t=this;if(!this.hasSku()){return null}return this.skuTree.OFFERS.filter(function(e){return JSON.stringify(e.TREE)===JSON.stringify(t.selectedValues)})[0]}},{key:"getActiveSkuProperties",value:function e(t){var r=[];var n=this.getFilterProperties(t);this.filterSku(n).forEach(function(e){if(!r.includes(e.TREE[t])){r.push(e.TREE[t])}});return r}},{key:"getFilterProperties",value:function e(t){var r=[];for(var n=0,i=Object.values(this.skuTree.OFFERS_PROP);n<i.length;n++){var a=i[n];if(a.ID===t){break}r.push(a.ID)}return r}},{key:"filterSku",value:function e(t){if(t.length===0){return this.skuTree.OFFERS}var r=this.getSelectedValues();return this.skuTree.OFFERS.filter(function(e){var n=p(t),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;if(e.TREE[a]!==r[a]){return false}}}catch(e){n.e(e)}finally{n.f()}return true})}},{key:"getSelectedSkuProperty",value:function e(t){return this.getSelectedSku()["TREE"][t]}},{key:"layout",value:function e(){var r=t.Tag.render(c());this.skuProperties=[];if(this.hasSku()&&this.hasSkuProps()){for(var n in this.skuTree.OFFERS_PROP){if(this.skuTree.OFFERS_PROP.hasOwnProperty(n)){var i=new o({parent:this,property:this.skuTree.OFFERS_PROP[n],existingValues:this.skuTree.EXISTING_VALUES[n],offers:this.skuTree.OFFERS});r.appendChild(i.layout());this.skuProperties.push(i)}}}return r}},{key:"toggleSkuProperties",value:function e(){this.skuProperties.forEach(function(e){return e.toggleSkuPropertyValues()})}}]);return r}(n.EventEmitter);e.SkuTree=h})(this.BX.Catalog.SkuTree=this.BX.Catalog.SkuTree||{},BX,BX.Catalog.SkuTree,BX.Event);
//# sourceMappingURL=sku-tree.bundle.map.js