this.BX=this.BX||{};this.BX.Catalog=this.BX.Catalog||{};(function(e,t,r,i,s){"use strict";var n,a,l,u,o,c,p,d;var f=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"skuSelectHandler",this.handleSkuSelect.bind(this));this.parent=t.parent||null;if(!this.parent){throw new Error("Parent is not defined.")}this.property=t.property||{};this.offers=t.offers||[];this.existingValues=t.existingValues||[];this.nodeDescriptions=[];this.hideUnselected=t.hideUnselected}babelHelpers.createClass(e,[{key:"getId",value:function e(){return this.property.ID}},{key:"getSelectedSkuId",value:function e(){return this.parent.getSelectedSkuId()}},{key:"hasSkuValues",value:function e(){return this.property.VALUES.length}},{key:"renderPictureSku",value:function e(t,i){var s=r.Type.isStringFilled(t.NAME)?r.Text.encode(t.NAME):"";var o="";if(r.Type.isStringFilled(s)){o=r.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['<span class="ui-ctl-label-text">',"</span>"])),s)}var c="";if(t.PICT&&t.PICT.SRC){var p="background-image: url('"+t.PICT.SRC+"');";c=r.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<span class="ui-ctl-label-img" style="','"></span>'])),p)}else if(o){o.style.paddingLeft="0"}else{o=r.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['<span class="ui-ctl-label-text">-</span>'])))}var d=this.parent.isShortView&&r.Type.isStringFilled(this.property.NAME)?r.Text.encode(this.property.NAME):s;return r.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<label \tclass="ui-ctl ui-ctl-radio-selector"\n\t\t\t\t\tonclick="','"\n\t\t\t\t\ttitle="','"\n\t\t\t\t\tdata-property-id="','"\n\t\t\t\t\tdata-property-value="','">\n\t\t\t\t<input type="radio"\n\t\t\t\t\tdisabled="','"\n\t\t\t\t\tname="property-',"-","-",'"\n\t\t\t\t\tclass="ui-ctl-element">\n\t\t\t\t<span class="ui-ctl-inner">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t"])),this.skuSelectHandler,d,this.getId(),t.ID,!this.parent.isSelectable(),this.getSelectedSkuId(),this.getId(),i,c,o)}},{key:"renderTextSku",value:function e(t,i){var s=r.Type.isStringFilled(t.NAME)?r.Text.encode(t.NAME):"-";var n=this.parent.isShortView&&r.Type.isStringFilled(this.property.NAME)?r.Text.encode(this.property.NAME):s;return r.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<label \tclass="ui-ctl ui-ctl-radio-selector"\n\t\t\t\t\tonclick="','"\n\t\t\t\t\ttitle="','"\n\t\t\t\t\tdata-property-id="','"\n\t\t\t\t\tdata-property-value="','">\n\t\t\t\t<input type="radio"\n\t\t\t\t\tdisabled="','"\n\t\t\t\t\tname="property-',"-","-",'"\n\t\t\t\t\tclass="ui-ctl-element">\n\t\t\t\t<span class="ui-ctl-inner">\n\t\t\t\t\t<span class="ui-ctl-label-text">',"</span>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t"])),this.skuSelectHandler,n,this.getId(),t.ID,!this.parent.isSelectable(),this.getSelectedSkuId(),this.getId(),i,s)}},{key:"layout",value:function e(){if(!this.hasSkuValues()){return}this.skuList=this.renderProperties();this.toggleSkuPropertyValues();var t=!this.parent.isShortView?r.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['<div class="product-item-detail-info-container-title">',"</div>"])),r.Text.encode(this.property.NAME)):"";return r.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="product-item-detail-info-container">\n\t\t\t\t','\n\t\t\t\t<div class="product-item-scu-container">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),t,this.skuList)}},{key:"renderProperties",value:function e(){var t=this;var i=r.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['<div class="product-item-scu-list ui-ctl-spacing-right"></div>'])));this.property.VALUES.forEach((function(e){var s=e.ID;var n;var a=r.Text.getRandom();if(!s||t.existingValues.includes(s)){if(t.property.SHOW_MODE==="PICT"){r.Dom.addClass(i,"product-item-scu-list--pick-color");n=t.renderPictureSku(e,a)}else{r.Dom.addClass(i,"product-item-scu-list--pick-size");n=t.renderTextSku(e,a)}t.nodeDescriptions.push({propertyValueId:s,node:n});i.appendChild(n)}}));return i}},{key:"toggleSkuPropertyValues",value:function e(){var t=this;var i=this.parent.getSelectedSkuProperty(this.getId());var s=this.parent.getActiveSkuProperties(this.getId());this.nodeDescriptions.forEach((function(e){var n=r.Text.toNumber(e.propertyValueId);var a=e.node.querySelector('input[type="radio"]');if(i===n){a.checked=true;r.Dom.addClass(e.node,"selected")}else{a.checked=false;r.Dom.removeClass(e.node,"selected")}if(t.hideUnselected&&i!==n||!s.includes(e.propertyValueId)){r.Dom.style(e.node,{display:"none"})}else{r.Dom.style(e.node,{display:null})}}))}},{key:"handleSkuSelect",value:function e(t){var i=this;t.stopPropagation();var n=t.target.closest("[data-property-id]");if(!this.parent.isSelectable()||r.Dom.hasClass(n,"selected")){return}var a=r.Text.toNumber(n.getAttribute("data-property-id"));var l=r.Text.toNumber(n.getAttribute("data-property-value"));this.parent.setSelectedProperty(a,l);this.parent.getSelectedSku().then((function(e){s.EventEmitter.emit("SkuProperty::onChange",[e,i.property]);if(i.parent){i.parent.emit("SkuProperty::onChange",[e,i.property])}}));this.parent.toggleSkuProperties()}}]);return e}();var h;function g(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=v(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var i=0;var s=function e(){};return{s:s,n:function t(){if(i>=e.length)return{done:true};return{done:false,value:e[i++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n=true,a=false,l;return{s:function t(){r=r.call(e)},n:function e(){var t=r.next();n=t.done;return t},e:function e(t){a=true;l=t},f:function e(){try{if(!n&&r["return"]!=null)r["return"]()}finally{if(a)throw l}}}}function v(e,t){if(!e)return;if(typeof e==="string")return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y(e,t)}function y(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,i=new Array(t);r<t;r++){i[r]=e[r]}return i}function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){babelHelpers.defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function S(e,t,r){T(e,t);return r}function T(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}var m=new Map;var I=new Map;var P=new Map;var E=function(e){babelHelpers.inherits(t,e);function t(e){var i;var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"selectedValues",{});s.setEventNamespace("BX.Catalog.SkuTree");s.id=r.Text.getRandom();s.skuTree=e.skuTree||{};s.productId=(i=s.skuTree)===null||i===void 0?void 0:i.PRODUCT_ID;s.skuTreeOffers=s.skuTree.OFFERS||[];if(!r.Type.isNil(e.skuTree.OFFERS_JSON)&&!r.Type.isArrayFilled(s.skuTreeOffers)){s.skuTreeOffers=JSON.parse(s.skuTree.OFFERS_JSON)}s.iblockId=s.skuTree.IBLOCK_ID||t.DEFAULT_IBLOCK_ID;if(!m.has(s.iblockId)){if(r.Type.isObject(s.skuTree.OFFERS_PROP)){m.set(s.iblockId,s.skuTree.OFFERS_PROP)}else{m.set(s.iblockId,{});var n=new Promise((function(e){r.ajax.runAction("catalog.skuTree.getIblockProperties",{json:{iblockId:s.iblockId}}).then((function(r){m.set(s.iblockId,r.data);e();P["delete"](S(t,t,O).call(t,s.iblockId))}))}));P.set(S(t,t,O).call(t,s.iblockId),n)}}s.selectable=e.selectable!==false;s.isShortView=e.isShortView===true;s.hideUnselected=e.hideUnselected===true;if(s.hasSku()){s.selectedValues=s.skuTree.SELECTED_VALUES||b({},s.skuTreeOffers[0].TREE)}s.existingValues=s.skuTree.EXISTING_VALUES||{};if(!r.Type.isNil(e.skuTree.EXISTING_VALUES_JSON)&&r.Type.isNil(e.skuTree.EXISTING_VALUES)){s.existingValues=JSON.parse(e.skuTree.EXISTING_VALUES_JSON)}for(var a in s.existingValues){if(s.existingValues[a].length===1&&s.existingValues[a][0]===0){delete s.existingValues[a]}}return s}babelHelpers.createClass(t,[{key:"getProperties",value:function e(){return m.get(this.iblockId)}},{key:"isSelectable",value:function e(){return this.selectable}},{key:"getSelectedValues",value:function e(){return this.selectedValues}},{key:"setSelectedProperty",value:function e(t,i){this.selectedValues[t]=r.Text.toNumber(i);var s=this.getRemainingProperties(t);if(s.length){var n=g(s),a;try{for(n.s();!(a=n.n()).done;){var l=a.value;var u=this.getFilterProperties(l);var o=this.filterSku(u);if(o.length){var c=false;var p=g(o),d;try{for(p.s();!(d=p.n()).done;){var f=d.value;if(f.TREE[l]===this.selectedValues[l]){c=true}}}catch(e){p.e(e)}finally{p.f()}if(!c){this.selectedValues[l]=o[0].TREE[l]}}}}catch(e){n.e(e)}finally{n.f()}}}},{key:"getRemainingProperties",value:function e(t){var r=[];var i=false;for(var s=0,n=Object.values(this.getProperties());s<n.length;s++){var a=n[s];if(a.ID===t){i=true}else if(i){r.push(a.ID)}}return r}},{key:"hasSku",value:function e(){return r.Type.isArrayFilled(this.skuTreeOffers)}},{key:"hasSkuProps",value:function e(){return Object.values(this.getProperties()).length>0}},{key:"getSelectedSkuId",value:function e(){var t=this;if(!this.hasSku()){return}var r=this.skuTreeOffers.filter((function(e){return JSON.stringify(e.TREE)===JSON.stringify(t.selectedValues)}))[0];return r===null||r===void 0?void 0:r.ID}},{key:"getSelectedSku",value:function e(){var i=this;return new Promise((function(e,s){var n=i.getSelectedSkuId();if(n<=0){s();return}if(I.has(n)){var a=I.get(n);e(a)}else{if(P.has(S(t,t,V).call(t,n))){P.get(S(t,t,V).call(t,n)).then((function(t){e(t)}))}else{var l=r.ajax.runAction("catalog.skuTree.getSku",{json:{skuId:n}}).then((function(r){var i=r.data;I.set(n,i);e(i);P["delete"](S(t,t,V).call(t,n),l)}));P.set(S(t,t,V).call(t,n),l)}}}))}},{key:"getActiveSkuProperties",value:function e(t){var r=[];var i=this.getFilterProperties(t);this.filterSku(i).forEach((function(e){if(!r.includes(e.TREE[t])){r.push(e.TREE[t])}}));return r}},{key:"getFilterProperties",value:function e(t){var r=[];for(var i=0,s=Object.values(this.getProperties());i<s.length;i++){var n=s[i];if(n.ID===t){break}r.push(n.ID)}return r}},{key:"filterSku",value:function e(t){if(t.length===0){return this.skuTreeOffers}var r=this.getSelectedValues();return this.skuTreeOffers.filter((function(e){var i=g(t),s;try{for(i.s();!(s=i.n()).done;){var n=s.value;if(e.TREE[n]!==r[n]){return false}}}catch(e){i.e(e)}finally{i.f()}return true}))}},{key:"getSelectedSkuProperty",value:function e(t){return r.Text.toNumber(this.selectedValues[t])}},{key:"layout",value:function e(){var i=this;var s=r.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['<div class="product-item-scu-wrapper" id="','"></div>'])),this.id);if(this.isShortView){r.Dom.addClass(s,"--short-format")}this.skuProperties=[];if(this.hasSku()){new Promise((function(e){if(P.has(S(t,t,O).call(t,i.iblockId))){P.get(S(t,t,O).call(t,i.iblockId)).then(e)}else{e()}})).then((function(){if(!i.hasSkuProps()){return}var e=i.getProperties();for(var t in e){if(e.hasOwnProperty(t)&&!r.Type.isNil(i.existingValues[t])){var n=new f({parent:i,property:e[t],existingValues:r.Type.isArray(i.existingValues[t])?i.existingValues[t]:Object.values(i.existingValues[t]),offers:i.skuTreeOffers,hideUnselected:i.hideUnselected});r.Dom.append(n.layout(),s);i.skuProperties.push(n)}}}))}return s}},{key:"toggleSkuProperties",value:function e(){this.skuProperties.forEach((function(e){return e.toggleSkuPropertyValues()}))}}]);return t}(s.EventEmitter);function O(e){return"IblockPropertiesRequest_"+e}function V(e){return"SkuFieldsRequest_"+e}babelHelpers.defineProperty(E,"DEFAULT_IBLOCK_ID",0);e.SkuTree=E})(this.BX.Catalog.SkuTree=this.BX.Catalog.SkuTree||{},BX,BX,BX.Catalog.SkuTree,BX.Event);
//# sourceMappingURL=sku-tree.bundle.map.js