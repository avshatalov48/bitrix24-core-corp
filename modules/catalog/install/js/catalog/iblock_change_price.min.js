BX.namespace("BX.Catalog.Admin");BX.Catalog.Admin.IblockChangePrice=function(){var e={selectEl:{},inputEl:{},checkboxEl:{},spanEl:{},radioEl:{},labelEl:{}};var l=null;var i={onePriceType:"",nullValue:"",equalPriceTypes:"",basePriceChange:"",destinationPriceEmpty:"",sourcePriceEmpty:""};var t="";return{init:function(a){e.selectEl.changing=BX("tableActionChangingSelect");e.selectEl.unit=BX("tableUnitsSelect");e.selectEl.priceTypeInitial=BX("tablePriceTypeIdSelect");e.selectEl.resultMask=BX("resultMaskSelect");e.selectEl.priceType=BX("initialPriceTypeSelect");e.spanEl.resultValue=BX("resultValueSpan");e.inputEl.example=BX("exampleSourceValueInput");e.inputEl.difference=BX("differenceValueInput");e.inputEl.valuePrice=BX("tableValueChangingPriceInput");e.labelEl.priceType=BX("initialPriceTypeLabel");e.labelEl.difference=BX("differenceValueLabel");e.labelEl.resultMask=BX("resultMaskLabel");e.radioEl.radioButtons=document.getElementsByName("formatResultRadio");e.checkboxEl.priceType=BX("initialPriceTypeCheckbox");e.checkboxEl.difference=BX("differenceValueCheckbox");e.checkboxEl.resultMask=BX("resultMaskCheckbox");l=a.tableReloadId||null;i=a.alertMessages||"";if(BX.type.isNotEmptyString(a.basePriceType))t=a.basePriceType;BX.bind(e.inputEl.valuePrice,"input",BX.delegate(function(e){this.inputDigitalMask(e.target)},this));BX.bind(e.inputEl.difference,"input",BX.delegate(function(e){this.reloadExample();this.inputDigitalMask(e.target)},this));BX.bind(e.inputEl.example,"input",BX.delegate(function(e){this.reloadExample();this.inputDigitalMask(e.target)},this));BX.bind(e.checkboxEl.difference,"change",BX.delegate(function(){this.reloadExample();this.showHideInitialElement(e.checkboxEl.difference,e.labelEl.difference,e.inputEl.difference)},this));BX.bind(e.checkboxEl.resultMask,"change",BX.delegate(function(){this.reloadExample();this.showHideInitialElement(e.checkboxEl.resultMask,e.labelEl.resultMask,e.selectEl.resultMask)},this));BX.bind(e.checkboxEl.priceType,"change",BX.delegate(function(l){if(e.selectEl.priceType.length===1){l.target.checked=false;window.alert(i.onePriceType);return false}this.showHideInitialElement(e.checkboxEl.priceType,e.labelEl.priceType,e.selectEl.priceType)},this));BX.bind(e.selectEl.resultMask,"change",BX.delegate(this.reloadExample,this));BX.bindDelegate(BX("chp_radioTable"),"change",{name:"formatResultRadio"},BX.proxy(this.reloadExample,this));BX.bind(e.radioEl,"change",BX.delegate(this.reloadExample,this));BX.bind(BX("savebtn"),"click",BX.delegate(function(){if(!this.checkPriceTypes())return;if(e.inputEl.valuePrice.value!==""||e.inputEl.valuePrice.value!=0){var t=document.querySelector('input[name="formatResultRadio"]:checked');var a=e.checkboxEl.difference.checked?e.inputEl.difference.value:0;var c=e.checkboxEl.priceType.checked?e.selectEl.priceType.options[e.selectEl.priceType.selectedIndex].value:0;var n=e.selectEl.changing.value==="add"?e.inputEl.valuePrice.value:-1*e.inputEl.valuePrice.value;if(BX(l)){[].slice.call(BX(l).children).forEach(function(l){if(l.tagName=="FORM"){l.appendChild(BX.create("div",{children:[BX.create("input",{props:{type:"hidden",name:"action",value:"change_price"}}),BX.create("input",{props:{type:"hidden",name:"chprice_value_changing_price",value:BX.util.htmlspecialchars(n)}}),BX.create("input",{props:{type:"hidden",name:"chprice_units",value:BX.util.htmlspecialchars(e.selectEl.unit.options[e.selectEl.unit.selectedIndex].value)}}),BX.create("input",{props:{type:"hidden",name:"chprice_id_price_type",value:BX.util.htmlspecialchars(e.selectEl.priceTypeInitial.options[e.selectEl.priceTypeInitial.selectedIndex].value)}}),BX.create("input",{props:{type:"hidden",name:"chprice_format_result",value:BX.util.htmlspecialchars(t.value)}}),BX.create("input",{props:{type:"hidden",name:"chprice_result_mask",value:BX.util.htmlspecialchars(e.selectEl.resultMask.options[e.selectEl.resultMask.selectedIndex].value)}}),BX.create("input",{props:{type:"hidden",name:"chprice_initial_price_type",value:BX.util.htmlspecialchars(c)}}),BX.create("input",{props:{type:"hidden",name:"chprice_difference_value",value:BX.util.htmlspecialchars(a)}})]}));BX.submit(l)}})}top.BX.WindowManager.Get().Close()}else{window.alert(i.nullValue)}},this));this.reloadExample();return this},showHideInitialElement:function(e,l,i){if(e.checked){l.classList.remove("inactive-element");i.disabled=false;i.classList.remove("inactive-element")}else{l.classList.add("inactive-element");i.disabled=true;i.classList.add("inactive-element")}},inputDigitalMask:function(e){e.value=e.value.replace(/[^\d,.]*/g,"").replace(/\,/g,".").replace(/([,.])[,.]+/g,"$1").replace(/^[^\d]*(\d+([.,]\d{0,5})?).*$/g,"$1")},reloadExample:function(){var l=0;var i=0;var t=0;var a=e.inputEl.example;var c=e.inputEl.difference;var n=e.checkboxEl.difference;var r=e.spanEl.resultValue;var s=e.selectEl.resultMask.options[e.selectEl.resultMask.selectedIndex].value;if(!isNaN(parseFloat(a.value))){i=parseFloat(a.value)}if(n.checked&&!isNaN(parseFloat(c.value))){l=parseFloat(c.value)}switch(document.querySelector('input[name="formatResultRadio"]:checked').value){case"ceil":t=Math.ceil(i*s)/s-l;if(t<0){t=0}r.innerHTML=t;break;case"floor":t=Math.floor(i*s)/s-l;if(t<0){t=0}r.innerHTML=t;break;case"round":t=Math.round(i*s)/s-l;if(t<0){t=0}r.innerHTML=t}},checkPriceTypes:function(){if(!BX.type.isElementNode(e.checkboxEl.priceType)||!BX.type.isElementNode(e.selectEl.priceType)||!BX.type.isElementNode(e.selectEl.priceTypeInitial))return true;if(e.selectEl.priceTypeInitial.value==="0"){window.alert(i.destinationPriceEmpty);return false}if(!e.checkboxEl.priceType.checked)return true;if(e.selectEl.priceType.value==="0"){window.alert(i.sourcePriceEmpty);return false}if(e.selectEl.priceTypeInitial.value!=="0"&&e.selectEl.priceType.value!=="0"){if(e.selectEl.priceTypeInitial.value===e.selectEl.priceType.value){window.alert(i.equalPriceTypes);return false}else if(e.selectEl.priceTypeInitial.length>1&&e.selectEl.priceTypeInitial.value===t){return window.confirm(i.basePriceChange)}}return true}}};