this.BX=this.BX||{};this.BX.Catalog=this.BX.Catalog||{};(function(t,e,i,n,r,a,o,s){"use strict";var l=function(t){babelHelpers.inherits(e,t);function e(t,n){var r;babelHelpers.classCallCheck(this,e);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"getCurrencyId",function(){return this._currencyId});r.initialize(t,n);r._setProductListHandler=r.handleSetProductList.bind(babelHelpers.assertThisInitialized(r));r._tabShowHandler=r.onTabShow.bind(babelHelpers.assertThisInitialized(r));r._editorControlChangeHandler=r.onEditorControlChange.bind(babelHelpers.assertThisInitialized(r));r._currencyId=r._model.getField("CURRENCY","");i.EventEmitter.subscribe(r._editor,"onControlChanged",r.onEditorControlChange.bind(babelHelpers.assertThisInitialized(r)));i.EventEmitter.subscribe("DocumentProductListController",r._setProductListHandler);i.EventEmitter.subscribe("onEntityDetailsTabShow",r._tabShowHandler);return r}babelHelpers.createClass(e,[{key:"handleSetProductList",value:function t(e){var n=e.getData()[0];this.setProductList(n);i.EventEmitter.unsubscribe("DocumentProductListController",this._setProductListHandler)}},{key:"reinitializeProductList",value:function t(){if(this.productList){this.productList.reloadGrid(false)}}},{key:"onTabShow",value:function t(e){var n=e.getData(),r=babelHelpers.slicedToArray(n,1),a=r[0];if(a.id==="tab_products"&&this.productList){this.productList.handleOnTabShow();i.EventEmitter.unsubscribe("onEntityDetailsTabShow",this._tabShowHandler);i.EventEmitter.emit("onDocumentProductListTabShow",this)}}},{key:"innerCancel",value:function t(){this.rollback();if(this.productList){this.productList.onInnerCancel()}this._currencyId=this._model.getField("CURRENCY");if(this.productList){this.productList.changeCurrencyId(this._currencyId)}this._isChanged=false}},{key:"setProductList",value:function t(e){if(this.productList===e){return}if(this.productList){this.productList.destroy()}this.productList=e;if(this.productList){this.productList.setController(this);this.productList.setForm(this._editor.getFormElement());if(this.productList.getCurrencyId()!==this.getCurrencyId()){this.productList.changeCurrencyId(this.getCurrencyId())}this._prevProductCount=this._curProductCount=this.productList.getProductCount()}}},{key:"onAfterSave",value:function t(){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onAfterSave",this).call(this);if(this.productList){this.productList.removeFormFields()}this._editor._toolPanel.showViewModeButtons()}},{key:"productChange",value:function t(){var e;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;n=(e=n)!==null&&e!==void 0?e:false;this.markAsChanged();if(n){this.disableSaveButton()}i.EventEmitter.emit("onDocumentProductChange",this.productList.getProductsFields())}},{key:"onBeforeSubmit",value:function t(){if(this.productList&&(this.isChanged()||this._editor.isNew())){this.productList.compileProductData()}}},{key:"enableSaveButton",value:function t(){var e;if((e=this._editor)!==null&&e!==void 0&&e._toolPanel){this._editor._toolPanel.enableSaveButton()}}},{key:"disableSaveButton",value:function t(){var e;if((e=this._editor)!==null&&e!==void 0&&e._toolPanel){this._editor._toolPanel.disableSaveButton()}}},{key:"onEditorControlChange",value:function t(e){var i=e.getData(),n=babelHelpers.slicedToArray(i,2),r=n[0],a=n[1];if(r instanceof BX.UI.EntityEditorMoney&&(a===null||a===void 0?void 0:a.fieldName)==="CURRENCY"){this._currencyId=a===null||a===void 0?void 0:a.fieldValue;if(this.productList&&this._currencyId){this.productList.changeCurrencyId(this._currencyId);this.markAsChanged()}}}},{key:"setTotal",value:function t(e){this._model.setField("FORMATTED_TOTAL",BX.Currency.currencyFormat(e.totalCost,this.getCurrencyId(),false));this._model.setField("FORMATTED_TOTAL_WITH_CURRENCY",BX.Currency.currencyFormat(e.totalCost,this.getCurrencyId(),true));this._model.setField("TOTAL",e.totalCost);this._editor.getControlById("TOTAL_WITH_CURRENCY").refreshLayout()}}]);return e}(BX.UI.EntityEditorController);var c=function(t){babelHelpers.inherits(e,t);function e(t,i){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));n.initialize(t,i);n._model.lockField("TOTAL");return n}babelHelpers.createClass(e,[{key:"onAfterSave",value:function t(){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onAfterSave",this).call(this);window.top.BX.onCustomEvent("DocumentCard:onDocumentCardSave");var i=BX.SidePanel.Instance.getOpenSliders();i.forEach(function(t){var e,i;if((e=t.getWindow())!==null&&e!==void 0&&(i=e.BX.Catalog)!==null&&i!==void 0&&i.DocumentGridManager){t.getWindow().BX.onCustomEvent("DocumentCard:onDocumentCardSave")}})}}]);return e}(BX.UI.EntityEditorController);var d=function(){function t(){var e=this;babelHelpers.classCallCheck(this,t);i.EventEmitter.subscribe("BX.UI.EntityEditorControllerFactory:onInitialize",function(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,2),r=n[1];r.methods["entityCard"]=e.factory.bind(e)})}babelHelpers.createClass(t,[{key:"factory",value:function t(e,i,n){if(e==="document_card"){return new c(i,n)}if(e==="product_list"){return new l(i,n)}return null}}]);return t}();var u=function(t){babelHelpers.inherits(e,t);function e(t,i){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));n.initialize(t,i);return n}babelHelpers.createClass(e,[{key:"isCaptionEditable",value:function t(){return true}},{key:"getCaption",value:function t(){var e=this.getField("TITLE");return BX.type.isString(e)?e:""}},{key:"setCaption",value:function t(e){this.setField("TITLE",e)}},{key:"prepareCaptionData",value:function t(e){e["TITLE"]=this.getField("TITLE","")}}]);return e}(BX.UI.EntityModel);var p=function(){function t(){var e=this;babelHelpers.classCallCheck(this,t);i.EventEmitter.subscribe("BX.UI.EntityEditorModelFactory:onInitialize",function(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,2),r=n[1];r.methods["store_document"]=e.factory.bind(e)})}babelHelpers.createClass(t,[{key:"factory",value:function t(e,i,n){if(e==="store_document"){return new u(i,n)}return null}}]);return t}();var h=function(t){babelHelpers.inherits(e,t);function e(t,i){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));n.initialize(t,i);n._loader=null;n._productsContainer=null;n._previousData=[];n._itemCount=0;n._totalCount=0;n._moreButton=null;n._moreButtonRow=null;n._totalsRow=null;n._moreButtonClickHandler=BX.delegate(n._onMoreButtonClick,babelHelpers.assertThisInitialized(n));n._visibleItemsLimit=5;return n}babelHelpers.createClass(e,[{key:"layout",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this._hasLayout){return}this.ensureWrapperCreated({});this.adjustWrapper();var i=this.getValue();if(!BX.type.isPlainObject(i)){return}var n=this.getTitle();var r=BX.prop.getArray(i,"items",[]);this._totalCount=BX.prop.getInteger(i,"count",0);this._itemCount=r.length;var a=this._itemCount;var o=this._visibleItemsLimit;var s=0;if(a>o){s=this._totalCount-o;a=o}if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}this._wrapper.appendChild(this.createTitleNode(n));this._productsContainer=BX.create("div",{props:{className:"catalog-entity-widget-content-block-products-list"}});for(var l=0;l<a;l++){this.addProductRow(r[l])}this._moreButton=null;if(s>0){this.addMoreButton(s)}this.addTotalRow(i["total"]);this._wrapper.appendChild(BX.create("div",{props:{className:"catalog-entity-widget-content-block-products"},children:[this._productsContainer]}));if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(e);this._hasLayout=true}},{key:"addMoreButton",value:function t(e){var i=BX.create("div",{props:{className:"catalog-entity-widget-content-block-products-item"}});this._moreButtonRow=i;this._productsContainer.appendChild(i);var n=BX.create("div",{props:{className:"catalog-entity-widget-content-block-products-item-name"}});i.appendChild(n);this._moreButton=BX.create("span",{attrs:{className:"catalog-entity-widget-content-block-products-show-more"},events:{click:this._moreButtonClickHandler},text:r.Loc.getMessage("DOCUMENT_PRODUCTS_NOT_SHOWN",{"#COUNT#":e.toString()})});n.appendChild(this._moreButton);i.appendChild(BX.create("div",{props:{className:"catalog-entity-widget-content-block-products-price"}}))}},{key:"addTotalRow",value:function t(e){var i=BX.create("div",{props:{className:"catalog-entity-widget-content-block-products-item"}});this._totalsRow=i;this._productsContainer.appendChild(i);var a=BX.create("div",{props:{className:"catalog-entity-widget-content-block-products-item-name"},html:r.Loc.getMessage("DOCUMENT_PRODUCTS_TOTAL")});i.appendChild(a);var o=BX.create("div",{props:{className:"catalog-entity-widget-content-block-products-price"},html:n.CurrencyCore.currencyFormat(e.amount,e.currency,true)});i.appendChild(o)}},{key:"addAddProductButton",value:function t(){var e=BX.create("a",{props:{href:"#"}});e.text=r.Loc.getMessage("DOCUMENT_PRODUCTS_ADD_PRODUCT");e.onclick=function(){i.EventEmitter.emit("BX.Catalog.EntityCard.TabManager:onOpenTab",{tabId:"tab_products"})};var n=BX.create("div",{props:{className:"catalog-entity-widget-content-block-products-add-products"},children:[e]});this._productsContainer.appendChild(n)}},{key:"_onMoreButtonClick",value:function t(e){i.EventEmitter.emit("BX.Catalog.EntityCard.TabManager:onOpenTab",{tabId:"tab_products"})}},{key:"doClearLayout",value:function t(){this._productsContainer=null;this._moreButton=null;this._moreButtonRow=null;this._totalsRow=null}},{key:"addProductRow",value:function t(e){var i=BX.create("div",{props:{className:"catalog-entity-widget-content-block-products-item"}});this._productsContainer.appendChild(i);var n=BX.create("div",{props:{className:"catalog-entity-widget-content-block-products-item-name"}});n.innerHTML=BX.util.htmlspecialchars(e["PRODUCT_NAME"]);i.appendChild(n);var r=BX.create("div",{props:{className:"catalog-entity-widget-content-block-products-price"}});i.appendChild(r);r.appendChild(BX.create("div",{attrs:{className:"catalog-entity-widget-content-block-products-price-value"},html:e["SUM"]}))}}]);return e}(BX.UI.EntityEditorField);var v,b,C,f;var y=function(t){babelHelpers.inherits(e,t);function e(t,i){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));n.initialize(t,i);n._input=null;n.innerWrapper=null;n.currentContractorName="";n.viewModeDisplay=null;return n}babelHelpers.createClass(e,[{key:"getContentWrapper",value:function t(){return this.innerWrapper}},{key:"layout",value:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this._hasLayout){return}this.ensureWrapperCreated({});this.adjustWrapper();var n=this.getTitle();if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}this._wrapper.appendChild(this.createTitleNode(n));var o=this.getName();var s=this.getValue();var l=this._schemeElement.getData();if(!this.currentContractorName){this.currentContractorName=this.getContractorNameFromModel()}this._input=r.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['<input name="','" type="hidden" value="','"/>'])),o,s);this._wrapper.appendChild(this._input);this.innerWrapper=r.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['<div class="ui-entity-editor-content-block"></div>'])));this._wrapper.appendChild(this.innerWrapper);if(this._mode===BX.UI.EntityEditorMode.edit){var c=[];if(s){c.push({id:s,entityId:"contractor",title:this.currentContractorName})}var d=new a.TagSelector({items:c,placeholder:r.Loc.getMessage("DOCUMENT_CONTRACTOR_FIELD_PLACEHOLDER"),textBoxWidth:"100%",multiple:false,dialogOptions:{context:"catalog_document_contractors",entities:[{id:"contractor",dynamicLoad:true,dynamicSearch:true}],searchOptions:{allowCreateItem:true,footerOptions:{label:r.Loc.getMessage("DOCUMENT_ADD_CONTRACTOR")}},events:{"Item:onSelect":function t(i){e._input.value=i.data.item.getId();if(e.viewModeDisplay){e.currentContractorName=i.data.item.getTitle();e.viewModeDisplay.innerHTML=BX.util.htmlspecialchars(e.currentContractorName)}e._changeHandler()},"Search:onItemCreateAsync":this.createContractor.bind(this)}}});d.renderTo(this.innerWrapper);if(BX.UI.EntityEditorModeOptions.check(this._modeOptions,BX.UI.EntityEditorModeOptions.individual)){d.getDialog().show()}}else{if(this.hasContentToDisplay()){this.viewModeDisplay=r.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['<div class="ui-entity-editor-content-block-text">',"</div>"])),BX.util.htmlspecialchars(this.currentContractorName))}else{this.viewModeDisplay=r.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['<div class="ui-entity-editor-content-block-text">',"</div>"])),r.Loc.getMessage("DOCUMENT_CONTRACTOR_NOT_FILLED"))}this.innerWrapper.appendChild(this.viewModeDisplay)}if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(i);this._hasLayout=true}},{key:"validate",value:function t(e){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.Catalog.DocumentCard.Contractor. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(e)}var i=!(this.isRequired()||this.isRequiredByAttribute())||BX.util.trim(this._input.value)!=="";if(!i){e.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return i}},{key:"hasValue",value:function t(){if(this.getValue()==="0"){return false}return babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"hasValue",this).call(this)}},{key:"getModeSwitchType",value:function t(e){var i=BX.UI.EntityEditorModeSwitchType.common;if(e===BX.UI.EntityEditorMode.edit){i|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return i}},{key:"createContractor",value:function t(e){var i=e.getData(),n=i.searchQuery;var a=n.getQuery();return new Promise(function(t,i){var o=e.getTarget();var s={companyName:a};o.showLoader();r.ajax.runAction("catalog.contractor.createContractor",{data:{fields:s}}).then(function(e){o.hideLoader();var i=o.addItem({id:e.data.id,entityId:"contractor",title:n.getQuery(),tabs:o.getRecentTab().getId()});if(i){i.select()}o.hide();t()}).catch(function(){o.hideLoader();BX.UI.Notification.Center.notify({content:r.Loc.getMessage("DOCUMENT_ADD_CONTRACTOR_ERROR")});o.hide();i()})})}},{key:"getContractorNameFromModel",value:function t(){return this._model.getSchemeField(this._schemeElement,"contractorName","")}},{key:"rollback",value:function t(){this.currentContractorName=this.getContractorNameFromModel()}}]);return e}(BX.UI.EntityEditorField);var m=function(){function t(){var e=this;babelHelpers.classCallCheck(this,t);i.EventEmitter.subscribe("BX.UI.EntityEditorControlFactory:onInitialize",function(t){var i=t.getCompatData(),n=babelHelpers.slicedToArray(i,2),r=n[1];r.methods["documentCard"]=e.factory.bind(e)})}babelHelpers.createClass(t,[{key:"factory",value:function t(e,i,n){if(e==="product_row_summary"){return new h(i,n)}if(e==="contractor"){return new y(i,n)}return null}}]);return t}();function g(t,e,i){B(t,e);_(i,"get");return E(t,i)}function E(t,e){if(e.get){return e.get.call(t)}return e.value}function T(t,e,i,n){B(t,e);_(i,"set");k(t,i,n);return n}function _(t,e){if(t===undefined){throw new TypeError("attempted to "+e+" private static field before its declaration")}}function B(t,e){if(t!==e){throw new TypeError("Private static access of wrong provenance")}}function k(t,e,i){if(e.set){e.set.call(t,i)}else{if(!e.writable){throw new TypeError("attempted to set read only private field")}e.value=i}}var w=function(t){babelHelpers.inherits(e,t);babelHelpers.createClass(e,null,[{key:"initializeEntityEditorFactories",value:function t(){e.registerFieldFactory();e.registerModelFactory();e.registerDocumentControllersFactory()}}]);function e(t,i){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t,i));n.documentType=i.documentType;n.isDocumentConducted=i.documentStatus==="Y";n.componentName=i.componentName;n.signedParameters=i.signedParameters;n.isConductLocked=i.isConductLocked;n.masterSliderUrl=i.masterSliderUrl;n.isFirstTime=i.isFirstTime;n.isTabAnalyticsSent=false;n.setSliderText();n.addCopyLinkPopup();n.subscribeToEvents();if(i.documentTypeSelector){n.initDocumentTypeSelector()}T(e,e,I,babelHelpers.assertThisInitialized(n));BX.UI.SidePanel.Wrapper.setParam("closeAfterSave",true);n.showNotificationOnClose=false;return n}babelHelpers.createClass(e,[{key:"initDocumentTypeSelector",value:function t(){var e=this.settings.documentTypeSelector;var i=this.settings.documentTypeSelectorTypes;if(!e||!i){return}var n=[];i.forEach(function(t){n.push({text:r.Loc.getMessage("DOC_TYPE_SHORT_"+t),onclick:function e(i){var n=BX.SidePanel.Instance.getTopSlider();if(n){n.url=BX.Uri.addParam(n.getUrl(),{DOCUMENT_TYPE:t});n.url=BX.Uri.removeParam(n.url,["firstTime"]);n.setFrameSrc()}}})});var a=o.MenuManager.create({id:"document-type-selector",bindElement:e,items:n});e.addEventListener("click",function(t){t.preventDefault();a.show()});if(this.isFirstTime){var l=new s.Guide({steps:[{target:e.querySelector(".catalog-document-type-selector-text"),title:r.Loc.getMessage("DOCUMENT_FIRST_TIME_HINT_TITLE"),text:r.Loc.getMessage("DOCUMENT_FIRST_TIME_HINT_TEXT"),link:"#",events:{onShow:function t(){document.querySelector(".ui-tour-popup-link").onclick=function(t){t.preventDefault();top.BX.Helper.show("redirect=detail&code=14566618")}},onClose:function t(){BX.userOptions.save("catalog","document-card","isDocumentTypeGuideOver",true)}}}],onEvents:true});l.showNextStep()}}},{key:"openMasterSlider",value:function t(){var e=this;BX.SidePanel.Instance.open(this.masterSliderUrl,{cacheable:false,data:{openGridOnDone:false},events:{onCloseComplete:function t(i){var n=i.getSlider();if(!n){return}if(n.getData().get("isInventoryManagementEnabled")){e.isConductLocked=false;var r=BX.SidePanel.Instance.getOpenSliders();r.forEach(function(t){var e,i;if((e=t.getWindow())!==null&&e!==void 0&&(i=e.BX.Catalog)!==null&&i!==void 0&&i.DocumentGridManager){t.allowChangeHistory=false;t.getWindow().location.reload()}})}}}})}},{key:"adjustToolPanel",value:function t(){return}},{key:"setViewModeButtons",value:function t(e){e._toolPanel.showViewModeButtons()}},{key:"setEditModeButtons",value:function t(e){e._toolPanel.showEditModeButtons()}},{key:"getEditorInstance",value:function t(){if(r.Reflection.getClass("BX.UI.EntityEditor")){return BX.UI.EntityEditor.getDefault()}return null}},{key:"subscribeToEvents",value:function t(){this.subscribeToUserSelectorEvent();this.subscribeToValidationFailedEvent();this.subscribeToOnSaveEvent();this.subscribeToTabOpenEvent();this.subscribeToDirectActionEvent();this.subscribeToEntityCreateEvent();this.subscribeToBeforeEntityRedirectEvent()}},{key:"subscribeToUserSelectorEvent",value:function t(){var e=this;i.EventEmitter.subscribe("BX.UI.EntityEditorUser:openSelector",function(t){var i=t.data[1];var n=new a.Dialog({targetNode:i.anchor,enableSearch:true,multiple:false,context:"CATALOG_DOCUMENT",entities:[{id:"user"},{id:"department"}],events:{"Item:onSelect":function t(a){var o=i.id;var s=a.data.item;var l={entityId:s.id,avatar:s.avatar,name:r.Text.encode(s.title.text)};if(e.entityId>0){var c={};c[o]=s.id;BX.ajax.runComponentAction(e.componentName,"save",{mode:"class",signedParameters:e.signedParameters,data:{fields:c}}).then(function(t){i.callback(n,l)})}else{i.callback(n,l)}}}});n.show()})}},{key:"subscribeToValidationFailedEvent",value:function t(){i.EventEmitter.subscribe("BX.UI.EntityEditor:onFailedValidation",function(t){i.EventEmitter.emit("BX.Catalog.EntityCard.TabManager:onOpenTab",{tabId:"main"})})}},{key:"subscribeToOnSaveEvent",value:function t(){var e=this;i.EventEmitter.subscribe("BX.UI.EntityEditor:onSave",function(t){var i;var n=t.data[0];var r=(i=t.data[1])===null||i===void 0?void 0:i.actionId;if(n&&n._ajaxForm){if(r==="SAVE_AND_CONDUCT"){if(e.isConductLocked){var a;t.data[1].cancel=true;(a=t.data[0]._toolPanel)===null||a===void 0?void 0:a.setLocked(false);e.openMasterSlider();return}}var o=n._ajaxForms[r];if(o){o.addUrlParams({documentType:e.documentType,isNewDocument:e.entityId<=0?"Y":"N"})}}})}},{key:"subscribeToTabOpenEvent",value:function t(){var e=this;i.EventEmitter.subscribe("BX.Catalog.EntityCard.TabManager:onSelectItem",function(t){var i=t.data.tabId;if(i==="tab_products"&&!e.isTabAnalyticsSent){e.sendAnalyticsData({tab:"products",isNewDocument:e.entityId<=0?"Y":"N",documentType:e.documentType});e.isTabAnalyticsSent=true}})}},{key:"subscribeToDirectActionEvent",value:function t(){var e=this;i.EventEmitter.subscribe("BX.UI.EntityEditor:onDirectAction",function(t){var i;if(((i=t.data[1])===null||i===void 0?void 0:i.actionId)==="CONDUCT"){if(e.isConductLocked){var n;t.data[1].cancel=true;(n=t.data[0]._toolPanel)===null||n===void 0?void 0:n.setLocked(false);e.openMasterSlider();return}t.data[0]._ajaxForms["CONDUCT"].addUrlParams({documentType:e.documentType})}})}},{key:"subscribeToEntityCreateEvent",value:function t(){i.EventEmitter.subscribe("onEntityCreate",function(t){var e;var i=t===null||t===void 0?void 0:(e=t.data[0])===null||e===void 0?void 0:e.sender;if(i){i._toolPanel.disableSaveButton();i.hideToolPanel()}})}},{key:"subscribeToBeforeEntityRedirectEvent",value:function t(){var e=this;i.EventEmitter.subscribe("beforeEntityRedirect",function(t){var i;var n=t===null||t===void 0?void 0:(i=t.data[0])===null||i===void 0?void 0:i.sender;if(n){var a;n._toolPanel.disableSaveButton();n.hideToolPanel();e.showNotificationOnClose=(t===null||t===void 0?void 0:(a=t.data[0])===null||a===void 0?void 0:a.showNotificationOnClose)==="Y";if(e.showNotificationOnClose){var o=t.data[0].redirectUrl;if(!o){return}o=BX.Uri.removeParam(o,"closeOnSave");window.top.BX.UI.Notification.Center.notify({content:r.Loc.getMessage("DOCUMENT_CONDUCT_SUCCESSFUL"),actions:[{title:r.Loc.getMessage("DOCUMENT_CONDUCT_SUCCESSFUL_VIEW"),href:o,events:{click:function t(e,i,n){i.close()}}}]})}}})}},{key:"sendAnalyticsData",value:function t(e){BX.ajax.runAction("catalog.analytics.sendAnalyticsLabel",{analyticsLabel:e})}},{key:"addCopyLinkPopup",value:function t(){var e=this;var i=document.getElementById(this.settings.copyLinkButtonId);if(!i){return}i.onclick=function(){e.copyDocumentLinkToClipboard()}}},{key:"copyDocumentLinkToClipboard",value:function t(){var e=BX.util.remove_url_param(window.location.href,["IFRAME","IFRAME_TYPE"]);if(!BX.clipboard.copy(e)){return}var i=new BX.PopupWindow("catalog_copy_document_url_to_clipboard",document.getElementById(this.settings.copyLinkButtonId),{content:r.Loc.getMessage("DOCUMENT_LINK_COPIED"),darkMode:true,autoHide:true,zIndex:1e3,angle:true,bindOptions:{position:"top"}});i.show();setTimeout(function(){i.close()},1500)}},{key:"setSliderText",value:function t(){var e=BX.SidePanel.Instance.getTopSlider();if(e){e.getLabel().setText(r.Loc.getMessage("SLIDER_LABEL_"+this.documentType))}}},{key:"disableSaveAndConductButton",value:function t(){if(!this.conductAndSaveButton){return}this.conductAndSaveButton.disabled=true;BX.addClass(this.conductAndSaveButton,"ui-btn-disabled")}},{key:"enableSaveAndConductButton",value:function t(){if(!this.conductAndSaveButton){return}this.conductAndSaveButton.disabled=false;BX.removeClass(this.conductAndSaveButton,"ui-btn-disabled")}}],[{key:"getInstance",value:function t(){return g(e,e,I)}},{key:"registerDocumentControllersFactory",value:function t(){T(e,e,S,new d)}},{key:"registerFieldFactory",value:function t(){T(e,e,L,new m)}},{key:"registerModelFactory",value:function t(){T(e,e,D,new p)}}]);return e}(e.BaseCard);var I={writable:true,value:void 0};var L={writable:true,value:void 0};var D={writable:true,value:void 0};var S={writable:true,value:void 0};t.DocumentCard=w;t.ProductListController=l})(this.BX.Catalog.DocumentCard=this.BX.Catalog.DocumentCard||{},BX.Catalog.EntityCard,BX.Event,BX.Currency,BX,BX.UI.EntitySelector,BX.Main,BX.UI.Tour);
//# sourceMappingURL=document-card.bundle.map.js