this.BX=this.BX||{};this.BX.Catalog=this.BX.Catalog||{};this.BX.Catalog.EntityEditor=this.BX.Catalog.EntityEditor||{};(function(t,e,i,r){"use strict";let a=t=>t,o,n,s,d;class l extends BX.UI.EntityEditorField{constructor(t,e){super();this.initialize(t,e);this._input=null;this.innerWrapper=null;this.currentContractorName="";this.viewModeDisplay=null}getContentWrapper(){return this.innerWrapper}layout(t={}){if(this._hasLayout){return}this.ensureWrapperCreated({});this.adjustWrapper();let r=this.getTitle();if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}this._wrapper.appendChild(this.createTitleNode(r));let l=this.getName();let c=this.getValue();let h=this._schemeElement.getData();if(!this.currentContractorName){this.currentContractorName=this.getContractorNameFromModel()}this._input=e.Tag.render(o||(o=a`<input name="${0}" type="hidden" value="${0}"/>`),l,c);this._wrapper.appendChild(this._input);this.innerWrapper=e.Tag.render(n||(n=a`<div class="ui-entity-editor-content-block"></div>`));this._wrapper.appendChild(this.innerWrapper);if(this._mode===BX.UI.EntityEditorMode.edit){let t=[];if(c){t.push({id:c,entityId:"contractor",title:this.currentContractorName})}let r=new i.TagSelector({items:t,placeholder:e.Loc.getMessage("ENTITY_CONTRACTOR_FIELD_PLACEHOLDER"),textBoxWidth:"100%",multiple:false,dialogOptions:{context:"catalog_document_contractors",entities:[{id:"contractor",dynamicLoad:true,dynamicSearch:true}],searchOptions:{allowCreateItem:true,footerOptions:{label:e.Loc.getMessage("ENTITY_ADD_CONTRACTOR")}},events:{"Item:onSelect":t=>{this._input.value=t.data.item.getId();if(this.viewModeDisplay){this.currentContractorName=t.data.item.getTitle();this.viewModeDisplay.innerHTML=BX.util.htmlspecialchars(this.currentContractorName)}this._changeHandler()},"Search:onItemCreateAsync":this.createContractor.bind(this),"Item:onDeselect":t=>{this._input.value="";this._changeHandler()}}}});r.renderTo(this.innerWrapper);if(BX.UI.EntityEditorModeOptions.check(this._modeOptions,BX.UI.EntityEditorModeOptions.individual)){r.getDialog().show()}}else{if(this.hasContentToDisplay()){this.viewModeDisplay=e.Tag.render(s||(s=a`<div class="ui-entity-editor-content-block-text">${0}</div>`),BX.util.htmlspecialchars(this.currentContractorName))}else{this.viewModeDisplay=e.Tag.render(d||(d=a`<div class="ui-entity-editor-content-block-text">${0}</div>`),e.Loc.getMessage("ENTITY_CONTRACTOR_NOT_FILLED"))}this.innerWrapper.appendChild(this.viewModeDisplay)}if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true}validate(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.Catalog.Entity-editor.Field.Contractor. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}let e=!(this.isRequired()||this.isRequiredByAttribute())||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e}hasValue(){if(this.getValue()==="0"){return false}return super.hasValue()}getModeSwitchType(t){let e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e}createContractor(t){let{searchQuery:i}=t.getData();let r=i.getQuery();return new Promise(((a,o)=>{const n=t.getTarget();const s={companyName:r};n.showLoader();e.ajax.runAction("catalog.contractor.createContractor",{data:{fields:s}}).then((t=>{n.hideLoader();const e=n.addItem({id:t.data.id,entityId:"contractor",title:i.getQuery(),tabs:n.getRecentTab().getId()});if(e){e.select()}n.hide();a()})).catch((()=>{n.hideLoader();BX.UI.Notification.Center.notify({content:e.Loc.getMessage("ENTITY_ADD_CONTRACTOR_ERROR")});n.hide();o()}))}))}getContractorNameFromModel(){return this._model.getSchemeField(this._schemeElement,"contractorName","")}rollback(){this.currentContractorName=this.getContractorNameFromModel()}static create(t,e){let i=new this(t,e);i.initialize(t,e);return i}}class c{constructor(t="BX.UI.EntityEditorControlFactory"){r.EventEmitter.subscribe(t+":onInitialize",(t=>{const[,e]=t.getCompatData();e.methods["contractor"]=this.factory.bind(this)}))}factory(t,e,i){if(t==="contractor"){return l.create(e,i)}return null}}t.ContractorField=l;t.ContractorFieldFactory=c})(this.BX.Catalog.EntityEditor.Field=this.BX.Catalog.EntityEditor.Field||{},BX,BX.UI.EntitySelector,BX.Event);
//# sourceMappingURL=contractor.bundle.map.js