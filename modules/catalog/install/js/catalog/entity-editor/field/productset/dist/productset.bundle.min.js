this.BX=this.BX||{};this.BX.Catalog=this.BX.Catalog||{};this.BX.Catalog.EntityEditor=this.BX.Catalog.EntityEditor||{};(function(t,e,i,s){"use strict";let l=t=>t,o,r,n;class a extends e.DefaultFooter{constructor(t,e){super(t,e);this.selectAllButton=i.Tag.render(o||(o=l`<div class="ui-selector-footer-link ui-selector-search-footer-label--hide">${0}</div>`),i.Loc.getMessage("ENTITY_EDITOR_PRODUCT_SET_ALL_SELECT_LABEL"));i.Event.bind(this.selectAllButton,"click",this.selectAll.bind(this));this.deselectAllButton=i.Tag.render(r||(r=l`<div class="ui-selector-footer-link ui-selector-search-footer-label--hide">${0}</div>`),i.Loc.getMessage("ENTITY_EDITOR_PRODUCT_SET_ALL_DESELECT_LABEL"));i.Event.bind(this.deselectAllButton,"click",this.deselectAll.bind(this));this.getDialog().subscribe("Item:onSelect",this.onItemStatusChange.bind(this));this.getDialog().subscribe("Item:onDeselect",this.onItemStatusChange.bind(this));this.getDialog().subscribe("onLoad",this.toggleSelectButtons.bind(this))}getContent(){return i.Tag.render(n||(n=l`
			<div class="ui-selector-search-footer-box">
				${0}
				${0}
			</div>
		`),this.selectAllButton,this.deselectAllButton)}toggleSelectButtons(){if(this.getAmountSelectedItems()===this.getAmountItems()){if(i.Dom.hasClass(this.deselectAllButton,"ui-selector-search-footer-label--hide")){i.Dom.addClass(this.selectAllButton,"ui-selector-search-footer-label--hide");i.Dom.removeClass(this.deselectAllButton,"ui-selector-search-footer-label--hide")}}else if(i.Dom.hasClass(this.selectAllButton,"ui-selector-search-footer-label--hide")){i.Dom.addClass(this.deselectAllButton,"ui-selector-search-footer-label--hide");i.Dom.removeClass(this.selectAllButton,"ui-selector-search-footer-label--hide")}}selectAll(){if(this.getAmountSelectedItems()===this.getAmountItems()){return}const t=this.getDialog().getActiveTab();if(t){let e=t.getRootNode().getChildren();if(e.items.length>0){e.forEach((t=>{t.getItem().select()}))}}else{this.getDialog().getItems().forEach((t=>{t.select()}))}}deselectAll(){this.getDialog().getSelectedItems().forEach((t=>{t.deselect()}))}onItemStatusChange(){this.toggleSelectButtons()}getAmountSelectedItems(){let t=0;const e=this.getDialog().getActiveTab();if(e){t=e.getRootNode().getChildren().items.filter((t=>t.item.isSelected())).length}else{t=this.getDialog().getSelectedItems().length}return t}getAmountItems(){let t=0;const e=this.getDialog().getActiveTab();if(e){t=e.getRootNode().getChildren().items.length}else{t=this.getDialog().getItems().length}return t}}const h=Object.freeze({TYPE:{PRODUCT:"PRODUCT"},ENTITY_ID:{PRODUCT_VARIATION:"agent-contractor-product-variation"}});let d=t=>t,c,g,u,p;class E extends BX.UI.EntityEditorField{constructor(t,e){super();this.initialize(t,e);this._input=null;this._inputWrapper=null;this.innerWrapper=null;this.entityList=null;this.tagSelector=null}getContentWrapper(){return this.innerWrapper}layout(t={}){if(this._hasLayout){return}this.ensureWrapperCreated({});this.adjustWrapper();let e=this.getTitle();if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}this._wrapper.appendChild(this.createTitleNode(e));let s=this.getName();let l=this.getValue();if(!this.entityList){this.entityList=this.getEntityListFromModel()}this._inputWrapper=i.Tag.render(c||(c=d`<div></div>`));this._wrapper.appendChild(this._inputWrapper);let o="";if(l.length>0){o=JSON.stringify(l)}this._input=i.Tag.render(g||(g=d`<input name="${0}" type="hidden" value=""/>`),s);this._input.value=o;this._wrapper.appendChild(this._input);this.innerWrapper=i.Tag.render(u||(u=d`<div class="ui-entity-editor-content-block"></div>`));this._wrapper.appendChild(this.innerWrapper);if(this._mode===BX.UI.EntityEditorMode.edit){this.getProductSelector(this.entityList);this.tagSelector.setReadonly(false);this.tagSelector.renderTo(this.innerWrapper);if(BX.UI.EntityEditorModeOptions.check(this._modeOptions,BX.UI.EntityEditorModeOptions.individual)){this.tagSelector.getDialog().show()}}else{if(this.hasContentToDisplay()){this.getProductSelector(this.entityList,true);this.tagSelector.setReadonly(true);this.tagSelector.renderTo(this.innerWrapper)}else{const t=i.Tag.render(p||(p=d`<div class="ui-entity-editor-content-block-text">${0}</div>`),i.Loc.getMessage("ENTITY_EDITOR_PRODUCT_SET_NOT_FILLED"));this.innerWrapper.appendChild(t)}}if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true}getProductSelector(t){const i=this.getIBlockIdFromModel();if(!this.tagSelector){this.tagSelector=new e.TagSelector({textBoxWidth:"100%",multiple:true,dialogOptions:{context:"catalog_document_productset",entities:[{id:h.ENTITY_ID.PRODUCT_VARIATION,options:{iblockId:i}}],searchOptions:{allowCreateItem:false},events:{"Item:onSelect":t=>{this.handleUserSelectorChanges(t);this._changeHandler()},"Item:onDeselect":t=>{this.handleUserSelectorChanges(t);this._changeHandler()}},footer:a}})}if(this.tagSelector.getDialog()&&t.length>0){const e=this.tagSelector.getDialog();t.forEach((t=>{e.addItem({id:t.PRODUCT_ID,title:t.PRODUCT_NAME,avatar:t.IMAGE,selected:true,entityId:h.ENTITY_ID.PRODUCT_VARIATION})}))}return this.tagSelector}handleUserSelectorChanges(t){this.entityList=[];const e=[];const i=t.getTarget().getSelectedItems();i.forEach((t=>{e.push({PRODUCT_ID:t.getId(),PRODUCT_TYPE:h.TYPE.PRODUCT});this.entityList.push({PRODUCT_ID:t.getId(),PRODUCT_TYPE:h.TYPE.PRODUCT,PRODUCT_NAME:t.getTitle()})}));this._input.value=JSON.stringify(e)}validate(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.Catalog.Entity-editor.Field.ProductSet. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}let e=!(this.isRequired()||this.isRequiredByAttribute())||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e}hasValue(){if(this.getValue().length===0){return false}return super.hasValue()}getModeSwitchType(t){let e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e}getIBlockIdFromModel(){return this._model.getSchemeField(this._schemeElement,"iblockId",0)}getEntityListFromModel(){return this._model.getSchemeField(this._schemeElement,"entityList",[])}rollback(){this.entityList=this.getEntityListFromModel()}static create(t,e){let i=new this(t,e);i.initialize(t,e);return i}}class T{constructor(t="BX.UI.EntityEditorControlFactory"){s.EventEmitter.subscribe(t+":onInitialize",(t=>{const[,e]=t.getCompatData();e.methods["productSet"]=this.factory.bind(this)}))}factory(t,e,i){if(t==="productSet"){return E.create(e,i)}return null}}t.ProductSetField=E;t.ProductSetFieldFactory=T;t.Footer=a})(this.BX.Catalog.EntityEditor.Field=this.BX.Catalog.EntityEditor.Field||{},BX.UI.EntitySelector,BX,BX.Event);
//# sourceMappingURL=productset.bundle.map.js