this.BX=this.BX||{};(function(e,t,a,i,n,l,r,o){"use strict";var s,c,u,d,h,g,p,I,b;var v=function(){function e(t){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"cache",new i.Cache.MemoryCache);this.id=t||i.Text.getRandom();this.selector=a.selector;if(!(this.selector instanceof l.StoreSelector)){throw new Error("Store selector instance not found.")}this.isEnabledDetailLink=a.isEnabledDetailLink;this.inputName=a.inputName||""}babelHelpers.createClass(e,[{key:"getId",value:function e(){return this.id}},{key:"toggleIcon",value:function e(t,a){if(i.Type.isDomNode(t)){i.Dom.style(t,"display",a)}}},{key:"getNameBlock",value:function e(){var t=this;return this.cache.remember("nameBlock",(function(){return i.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"])),t.getNameInput(),t.getHiddenNameInput())}))}},{key:"getNameInput",value:function e(){var t=this;return this.cache.remember("nameInput",(function(){return i.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input type="text"\n\t\t\t\t\tclass="ui-ctl-element ui-ctl-textbox"\n\t\t\t\t\tautocomplete="off"\n\t\t\t\t\tvalue="','"\n\t\t\t\t\tplaceholder="','"\n\t\t\t\t\ttitle="','"\n\t\t\t\t\tonchange="','"\n\t\t\t\t>\n\t\t\t'])),i.Text.encode(t.selector.getStoreTitle()),i.Text.encode(t.getPlaceholder()),i.Text.encode(t.selector.getStoreTitle()),t.handleNameInputHiddenChange.bind(t))}))}},{key:"getHiddenNameInput",value:function e(){var t=this;return this.cache.remember("hiddenNameInput",(function(){return i.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input\n\t\t\t\t \ttype="hidden"\n\t\t\t\t\tname="','"\n\t\t\t\t\tvalue="','"\n\t\t\t\t>\n\t\t\t'])),i.Text.encode(t.inputName),i.Text.encode(t.selector.getStoreTitle()))}))}},{key:"handleNameInputHiddenChange",value:function e(t){this.getHiddenNameInput().value=t.target.value}},{key:"getClearIcon",value:function e(){var t=this;return this.cache.remember("closeIcon",(function(){return i.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<button\n\t\t\t\t\tclass="ui-ctl-after ui-ctl-icon-clear"\n\t\t\t\t\tonclick="','"\n\t\t\t\t></button>\n\t\t\t'])),t.handleClearIconClick.bind(t))}))}},{key:"getArrowIcon",value:function e(){var t=this;return this.cache.remember("arrowIcon",(function(){return i.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a\n\t\t\t\t\thref="','"\n\t\t\t\t\ttarget="_blank"\n\t\t\t\t\tclass="ui-ctl-after ui-ctl-icon-forward"\n\t\t\t\t></button>\n\t\t\t'])),t.selector.getDetailPath())}))}},{key:"getSearchIcon",value:function e(){var t=this;return this.cache.remember("searchIcon",(function(){return i.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<button\n\t\t\t\t\tclass="ui-ctl-after ui-ctl-icon-search"\n\t\t\t\t\tonclick="','"\n\t\t\t\t></button>\n\t\t\t'])),t.handleSearchIconClick.bind(t))}))}},{key:"clearInputCache",value:function e(){this.cache["delete"]("dialog");this.cache["delete"]("nameBlock");this.cache["delete"]("nameInput");this.cache["delete"]("hiddenNameInput")}},{key:"clearDialogCache",value:function e(){this.cache["delete"]("dialog")}},{key:"layout",value:function e(){this.clearInputCache();var t=i.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon"></div>'])));t.appendChild(this.getSearchIcon());this.toggleIcon(this.getSearchIcon(),"none");t.appendChild(this.getClearIcon());this.toggleIcon(this.getClearIcon(),"none");if(this.showDetailLink()&&i.Type.isStringFilled(this.selector.getStoreTitle())){this.toggleIcon(this.getArrowIcon(),"block");t.appendChild(this.getArrowIcon())}else{this.toggleIcon(this.getSearchIcon(),"block")}i.Event.bind(this.getNameInput(),"click",this.handleNameInputClick.bind(this));i.Event.bind(this.getNameInput(),"input",this.handleNameInput.bind(this));i.Event.bind(this.getNameInput(),"blur",this.handleNameInputBlur.bind(this));i.Event.bind(this.getNameInput(),"keydown",this.handleNameInputKeyDown.bind(this));t.appendChild(this.getNameBlock());return t}},{key:"handleNameInputClick",value:function e(t){this.searchInDialog(t.target.value);this.handleIconsSwitchingOnNameInput(t)}},{key:"handleNameInput",value:function e(t){this.searchInDialog(t.target.value);this.handleIconsSwitchingOnNameInput(t)}},{key:"showDetailLink",value:function e(){return this.isEnabledDetailLink}},{key:"getDialog",value:function e(){var t=this;return this.cache.remember("dialog",(function(){var e={id:t.id+"_store",height:300,context:"catalog-store",targetNode:t.getNameInput(),enableSearch:false,multiple:false,dropdownMode:true,searchTabOptions:{stub:true,stubOptions:{title:i.Tag.message(I||(I=babelHelpers.taggedTemplateLiteral(["",""])),"CATALOG_STORE_SELECTOR_IS_EMPTY_TITLE"),subtitle:i.Tag.message(b||(b=babelHelpers.taggedTemplateLiteral(["",""])),"CATALOG_STORE_SELECTOR_IS_EMPTY_SUBTITLE"),arrow:true}},events:{"Item:onSelect":t.onStoreSelect.bind(t),onSearch:t.onSearch.bind(t),"Search:onItemCreateAsync":t.createStore.bind(t)},entities:[{id:"store",options:{productId:t.selector.getProductId()},searchFields:[{name:"subtitle",type:"string",system:true,searchable:false}],dynamicLoad:true,dynamicSearch:true}],searchOptions:{allowCreateItem:true}};return new n.Dialog(e)}))}},{key:"handleNameInputKeyDown",value:function e(t){var a=this.getDialog();if(t.key==="Enter"&&a.getActiveTab()===a.getSearchTab()){t.preventDefault();if(i.Browser.isMac()&&t.metaKey||t.ctrlKey){a.getSearchTab().getFooter().createItem()}}}},{key:"handleIconsSwitchingOnNameInput",value:function e(t){this.toggleIcon(this.getArrowIcon(),"none");if(i.Type.isStringFilled(t.target.value)){this.toggleIcon(this.getClearIcon(),"block");this.toggleIcon(this.getSearchIcon(),"none")}else{this.toggleIcon(this.getClearIcon(),"none");this.toggleIcon(this.getSearchIcon(),"block")}}},{key:"handleClearIconClick",value:function e(t){this.selector.onClear();t.stopPropagation();t.preventDefault()}},{key:"focusName",value:function e(){var t=this;requestAnimationFrame((function(){return t.getNameInput().focus()}))}},{key:"searchInDialog",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var a=this.getDialog();if(a){a.show();a.search(t)}}},{key:"handleShowSearchDialog",value:function e(t){this.searchInDialog(t.target.value)}},{key:"handleNameInputBlur",value:function e(t){var a=this;setTimeout((function(){a.toggleIcon(a.getClearIcon(),"none");if(a.showDetailLink()&&i.Type.isStringFilled(a.selector.getStoreTitle())){a.toggleIcon(a.getSearchIcon(),"none");a.toggleIcon(a.getArrowIcon(),"block")}else{a.toggleIcon(a.getArrowIcon(),"none");a.toggleIcon(a.getSearchIcon(),"block")}}),200)}},{key:"handleSearchIconClick",value:function e(t){this.searchInDialog();this.focusName();t.stopPropagation();t.preventDefault()}},{key:"onSearch",value:function e(t){var a=t.getData(),i=a.query;if(i===""||i===this.selector.getStoreTitle()){var n,l,r;(n=t.target)===null||n===void 0?void 0:(l=n.searchTab)===null||l===void 0?void 0:(r=l.getFooter())===null||r===void 0?void 0:r.hide()}else{var o,s,c;(o=t.target)===null||o===void 0?void 0:(s=o.searchTab)===null||s===void 0?void 0:(c=s.getFooter())===null||c===void 0?void 0:c.show()}}},{key:"onStoreSelect",value:function e(t){var a=t.getData().item;a.getDialog().getTargetNode().value=a.getTitle();if(this.selector){this.selector.onStoreSelect(a.getId(),a.getTitle())}this.toggleIcon(this.getSearchIcon(),"none");this.selector.clearLayout();this.selector.layout();this.cache["delete"]("dialog")}},{key:"createStore",value:function e(t){var a=t.getData(),n=a.searchQuery;var l=n.getQuery();return new Promise((function(e,a){if(!i.Type.isStringFilled(l)){a();return}var n=t.getTarget();n.showLoader();i.ajax.runAction("catalog.storeSelector.createStore",{json:{name:l}}).then((function(t){n.hideLoader();var a=i.Text.toInteger(t.data.id);var r=n.addItem({id:a,entityId:"store",title:l,tabs:n.getRecentTab().getId()});if(r){r.select()}n.hide();e()}))["catch"]((function(){return a()}))}))}},{key:"getPlaceholder",value:function e(){return i.Loc.getMessage("CATALOG_STORE_SELECTOR_BEFORE_SEARCH_TITLE")}}]);return e}();var f,m,T,y;function k(e,t,a){S(e,t);t.set(e,a)}function S(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var E=new Map;var C=new WeakMap;var w=function(e){babelHelpers.inherits(t,e);babelHelpers.createClass(t,null,[{key:"getById",value:function e(t){return E.get(t)||null}}]);function t(e){var a;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,t);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"mode",t.MODE_EDIT);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"productId",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"cache",new i.Cache.MemoryCache);k(babelHelpers.assertThisInitialized(a),C,{writable:true,value:new Map});a.setEventNamespace("BX.Catalog.StoreSelector");a.id=e||i.Text.getRandom();n.inputFieldTitle=n.inputFieldTitle||t.INPUT_FIELD_TITLE;n.inputFieldId=n.inputFieldId||t.INPUT_FIELD_ID;a.options=n||{};a.setMode(n.mode);if(n.model instanceof o.ProductModel&&n.model.getField(n.inputFieldId)>0){babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(a),C).set("id",n.model.getField(n.inputFieldId));var l=i.Type.isStringFilled(n.model.getField(n.inputFieldTitle))?n.model.getField(n.inputFieldTitle):"";a.setProductId(n.model.getSkuId());babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(a),C).set("title",l)}else{var r=i.Extension.getSettings("catalog.store-selector");babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(a),C).set("id",r.get("defaultStoreId"));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(a),C).set("title",r.get("defaultStoreName"))}a.searchInput=new v(a.id,{selector:babelHelpers.assertThisInitialized(a),inputName:a.options.inputFieldTitle});a.layout();E.set(a.id,babelHelpers.assertThisInitialized(a));return a}babelHelpers.createClass(t,[{key:"setMode",value:function e(a){if(!i.Type.isNil(a)){this.mode=a===t.MODE_VIEW?t.MODE_VIEW:t.MODE_EDIT}}},{key:"setProductId",value:function e(t){var a;t=i.Text.toNumber(t);if(t>0){this.productId=t}else{this.productId=null}(a=this.searchInput)===null||a===void 0?void 0:a.clearDialogCache()}},{key:"isViewMode",value:function e(){return this.mode===t.MODE_VIEW}},{key:"isSaveable",value:function e(){return!this.isViewMode()&&this.isSaveable()}},{key:"getId",value:function e(){return this.id}},{key:"getProductId",value:function e(){return this.productId}},{key:"getConfig",value:function e(t,a){return BX.prop.get(this.options.config,t,a)}},{key:"getDetailPath",value:function e(){return this.getConfig("detailPath","")}},{key:"getWrapper",value:function e(){if(!this.wrapper){this.wrapper=document.getElementById(this.id)}return this.wrapper}},{key:"renderTo",value:function e(t){this.clearLayout();this.wrapper=t;this.layout()}},{key:"layout",value:function e(){var t=this.getWrapper();if(!t){return}this.defineWrapperClass(t);var a=i.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['<div class="catalog-store-field-inner"></div>'])));t.appendChild(a);a.appendChild(this.layoutNameBlock())}},{key:"focusName",value:function e(){if(this.searchInput){this.searchInput.focusName()}return this}},{key:"onClear",value:function e(){this.clearState();this.clearLayout();this.layout();this.searchInput.searchInDialog();this.focusName();this.emit("onClear",{selectorId:this.getId(),rowId:this.getRowId()})}},{key:"clearState",value:function e(){babelHelpers.classPrivateFieldGet(this,C).clear()}},{key:"clearLayout",value:function e(){var t=this.getWrapper();if(t){t.innerHTML=""}}},{key:"unsubscribeEvents",value:function e(){}},{key:"defineWrapperClass",value:function e(t){if(this.isViewMode()){i.Dom.addClass(t,"catalog-store-view");i.Dom.removeClass(t,"catalog-store-edit")}else{i.Dom.addClass(t,"catalog-store-edit");i.Dom.removeClass(t,"catalog-store-view")}}},{key:"getViewHtml",value:function e(){var t=i.Text.encode(this.getStoreTitle());var a=i.Loc.getMessage("CATALOG_STORE_SELECTOR_VIEW_NAME_TITLE");if(this.getDetailPath()){return i.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a href="','" title="','">',"</a>\n\t\t\t"])),this.getDetailPath(),a,t)}return i.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['<span title="','">',"</span>"])),a,t)}},{key:"layoutNameBlock",value:function e(){var t=i.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['<div class="catalog-store-field-input"></div>'])));if(this.isViewMode()){t.appendChild(this.getViewHtml())}else{t.appendChild(this.searchInput.layout())}return t}},{key:"getStoreTitle",value:function e(){return babelHelpers.classPrivateFieldGet(this,C).get("title")||""}},{key:"getStoreId",value:function e(){return babelHelpers.classPrivateFieldGet(this,C).get("id")||""}},{key:"onStoreSelect",value:function e(t,a){if(a===""){a=i.Loc.getMessage("CATALOG_STORE_SELECTOR_EMPTY_STORE_TITLE")}babelHelpers.classPrivateFieldGet(this,C).set("id",t);babelHelpers.classPrivateFieldGet(this,C).set("title",a);this.clearLayout();this.layout();this.emit("onChange",{selectorId:this.id,rowId:this.getRowId(),fields:[{NAME:this.options.inputFieldId,VALUE:t},{NAME:this.options.inputFieldTitle,VALUE:a}]})}},{key:"getRowId",value:function e(){return this.getConfig("ROW_ID")}}]);return t}(a.EventEmitter);babelHelpers.defineProperty(w,"MODE_VIEW","view");babelHelpers.defineProperty(w,"MODE_EDIT","edit");babelHelpers.defineProperty(w,"INPUT_FIELD_TITLE","STORE_TITLE");babelHelpers.defineProperty(w,"INPUT_FIELD_ID","STORE_ID");e.StoreSelector=w})(this.BX.Catalog=this.BX.Catalog||{},BX,BX.Event,BX,BX.UI.EntitySelector,BX.Catalog,BX,BX.Catalog);
//# sourceMappingURL=store-selector.bundle.map.js