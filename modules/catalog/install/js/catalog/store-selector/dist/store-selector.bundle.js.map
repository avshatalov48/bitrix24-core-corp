{"version":3,"file":"store-selector.bundle.js","sources":["../src/store-search-input.js","../src/store-selector.js"],"sourcesContent":["import {ajax, Browser, Cache, Dom, Event, Loc, Tag, Text, Type} from 'main.core';\nimport {Dialog} from 'ui.entity-selector';\nimport './component.css';\nimport {StoreSelector} from 'catalog.store-selector';\nimport 'ui.notification';\n\nexport class StoreSearchInput\n{\n\tselector: StoreSelector;\n\tcache = new Cache.MemoryCache();\n\tinputName: String;\n\tisEnabledDetailLink: Boolean;\n\tallowCreateItem: Boolean;\n\tdisableByRights: Boolean;\n\tdisabledHint: ?String;\n\n\tconstructor(id, options = {})\n\t{\n\t\tthis.id = id || Text.getRandom();\n\t\tthis.selector = options.selector;\n\t\tif (!(this.selector instanceof StoreSelector))\n\t\t{\n\t\t\tthrow new Error('Store selector instance not found.');\n\t\t}\n\n\t\tthis.isEnabledDetailLink = options.isEnabledDetailLink;\n\t\tthis.inputName = options.inputName || '';\n\t\tthis.allowCreateItem = options.allowCreateItem !== undefined ? options.allowCreateItem : true;\n\t\tthis.disableByRights = options.disableByRights ?? false;\n\t\tthis.disabledHint = options.disabledHint ?? Loc.getMessage('CATALOG_STORE_SELECTOR_HAS_PERMISSION_VIEW_STORES_HINT');\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\ttoggleIcon(icon, value)\n\t{\n\t\tif (Type.isDomNode(icon))\n\t\t{\n\t\t\tDom.style(icon, 'display', value);\n\t\t}\n\t}\n\n\tgetNameBlock(): HTMLElement\n\t{\n\t\tif (this.disableByRights)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"ui-ctl ui-ctl-w100 ui-ctl-before-icon ui-ctl-after-icon ui-ctl-disabled\"\n\t\t\t\t\tdata-hint=\"${this.disabledHint}\"\n\t\t\t\t\tdata-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<div class=\"ui-ctl-before catalog-store-field-input-access-denied-lock\"></div>\n\t\t\t\t\t<div class=\"ui-ctl-after catalog-store-field-input-access-denied-hint\"></div>\n\t\t\t\t\t<div class=\"ui-ctl-element\">${Loc.getMessage('CATALOG_STORE_SELECTOR_HAS_PERMISSION_VIEW_STORES_TITLE')}</div>\n\t\t\t\t</div>\n\t\t\t`\n\t\t}\n\n\t\treturn this.cache.remember('nameBlock', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t${this.getNameInput()}\n\t\t\t\t\t${this.getHiddenNameInput()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetNameInput(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('nameInput', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input type=\"text\"\n\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox\"\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\tvalue=\"${Text.encode(this.selector.getStoreTitle())}\"\n\t\t\t\t\tplaceholder=\"${Text.encode(this.getPlaceholder())}\"\n\t\t\t\t\ttitle=\"${Text.encode(this.selector.getStoreTitle())}\"\n\t\t\t\t\tonchange=\"${this.handleNameInputHiddenChange.bind(this)}\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetHiddenNameInput(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('hiddenNameInput', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input\n\t\t\t\t \ttype=\"hidden\"\n\t\t\t\t\tname=\"${Text.encode(this.inputName)}\"\n\t\t\t\t\tvalue=\"${Text.encode(this.selector.getStoreTitle())}\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\thandleNameInputHiddenChange(event: UIEvent)\n\t{\n\t\tthis.getHiddenNameInput().value = event.target.value;\n\t}\n\n\tgetClearIcon(): HTMLElement\n\t{\n\t\treturn this.cache.remember('closeIcon', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-clear\"\n\t\t\t\t\tonclick=\"${this.handleClearIconClick.bind(this)}\"\n\t\t\t\t></button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetArrowIcon(): HTMLElement\n\t{\n\t\treturn this.cache.remember('arrowIcon', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"${this.selector.getDetailPath()}\"\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-forward\"\n\t\t\t\t></button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetSearchIcon(): HTMLElement\n\t{\n\t\treturn this.cache.remember('searchIcon', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-search\"\n\t\t\t\t\tonclick=\"${this.handleSearchIconClick.bind(this)}\"\n\t\t\t\t></button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tclearInputCache()\n\t{\n\t\tthis.cache.delete('dialog');\n\t\tthis.cache.delete('nameBlock');\n\t\tthis.cache.delete('nameInput');\n\t\tthis.cache.delete('hiddenNameInput');\n\t}\n\n\tclearDialogCache()\n\t{\n\t\tthis.cache.delete('dialog');\n\t}\n\n\tlayout(): HTMLElement\n\t{\n\t\tthis.clearInputCache();\n\t\tconst block = Tag.render`<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\"></div>`;\n\n\t\tDom.append(this.getSearchIcon(), block)\n\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\n\t\tDom.append(this.getClearIcon(), block)\n\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\n\t\tif (this.showDetailLink() && Type.isStringFilled(this.selector.getStoreTitle()))\n\t\t{\n\t\t\tthis.toggleIcon(this.getArrowIcon(), 'block');\n\t\t\tDom.append(this.getArrowIcon(), block)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.toggleIcon(this.getSearchIcon(), 'block');\n\t\t}\n\n\t\tEvent.bind(this.getNameInput(), 'click', this.handleNameInputClick.bind(this));\n\t\tEvent.bind(this.getNameInput(), 'input', this.handleNameInput.bind(this));\n\t\tEvent.bind(this.getNameInput(), 'blur', this.handleNameInputBlur.bind(this));\n\t\tEvent.bind(this.getNameInput(), 'keydown', this.handleNameInputKeyDown.bind(this));\n\n\t\tDom.append(this.getNameBlock(), block);\n\t\tBX.UI.Hint.init(block);\n\n\t\treturn block;\n\t}\n\n\thandleNameInputClick(event: UIEvent)\n\t{\n\t\tthis.searchInDialog(event.target.value);\n\t\tthis.handleIconsSwitchingOnNameInput(event);\n\t}\n\n\thandleNameInput(event: UIEvent)\n\t{\n\t\tthis.searchInDialog(event.target.value);\n\t\tthis.handleIconsSwitchingOnNameInput(event);\n\t}\n\n\tshowDetailLink(): string\n\t{\n\t\treturn this.isEnabledDetailLink;\n\t}\n\n\tgetDialog(): ?Dialog\n\t{\n\t\treturn this.cache.remember('dialog', () => {\n\t\t\tconst stubOptions = {\n\t\t\t\ttitle: Tag.message`${'CATALOG_STORE_SELECTOR_IS_EMPTY_TITLE'}`,\n\t\t\t};\n\t\t\tif (this.allowCreateItem)\n\t\t\t{\n\t\t\t\tstubOptions.subtitle = Tag.message`${'CATALOG_STORE_SELECTOR_IS_EMPTY_SUBTITLE'}`;\n\t\t\t\tstubOptions.arrow = true;\n\t\t\t}\n\n\t\t\tconst params = {\n\t\t\t\tid: this.id + '_store',\n\t\t\t\theight: 300,\n\t\t\t\tcontext: 'catalog-store',\n\t\t\t\ttargetNode: this.getNameInput(),\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tsearchTabOptions: {\n\t\t\t\t\tstubOptions,\n\t\t\t\t\tstub: true,\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.onStoreSelect.bind(this),\n\t\t\t\t\t'onSearch': this.onSearch.bind(this),\n\t\t\t\t\t'Search:onItemCreateAsync': this.createStore.bind(this),\n\t\t\t\t},\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'store',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tproductId: this.selector.getProductId(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearchFields: [\n\t\t\t\t\t\t\t{ name: 'subtitle', type: 'string', system: true, searchable: false },\n\t\t\t\t\t\t],\n\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tsearchOptions: {\n\t\t\t\t\tallowCreateItem: this.allowCreateItem\n\t\t\t\t},\n\t\t\t};\n\n\t\t\treturn new Dialog(params);\n\t\t});\n\t}\n\n\thandleNameInputKeyDown(event: KeyboardEvent): void\n\t{\n\t\tconst dialog = this.getDialog();\n\t\tif (event.key === 'Enter' && dialog.getActiveTab() === dialog.getSearchTab())\n\t\t{\n\t\t\t// prevent a form submit\n\t\t\tevent.preventDefault();\n\n\t\t\tif ((Browser.isMac() && event.metaKey) || event.ctrlKey)\n\t\t\t{\n\t\t\t\tdialog.getSearchTab().getFooter().createItem();\n\t\t\t}\n\t\t}\n\t}\n\n\thandleIconsSwitchingOnNameInput(event: UIEvent): void\n\t{\n\t\tthis.toggleIcon(this.getArrowIcon(), 'none');\n\n\t\tif (Type.isStringFilled(event.target.value))\n\t\t{\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'block');\n\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\t\tthis.toggleIcon(this.getSearchIcon(), 'block');\n\t\t}\n\t}\n\n\thandleClearIconClick(event: UIEvent)\n\t{\n\t\tthis.selector.onClear();\n\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t}\n\n\tfocusName()\n\t{\n\t\trequestAnimationFrame(() => this.getNameInput().focus());\n\t}\n\n\tsearchInDialog(searchQuery: string = '')\n\t{\n\t\tconst dialog = this.getDialog();\n\t\tif (dialog)\n\t\t{\n\t\t\tdialog.show();\n\t\t\tdialog.search(searchQuery);\n\t\t}\n\t}\n\n\thandleShowSearchDialog(event: UIEvent)\n\t{\n\t\tthis.searchInDialog(event.target.value);\n\t}\n\n\thandleNameInputBlur(event: UIEvent)\n\t{\n\t\t// timeout to toggle clear icon handler while cursor is inside of name input\n\t\tsetTimeout(() => {\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\n\t\t\tif (this.showDetailLink() && Type.isStringFilled(this.selector.getStoreTitle()))\n\t\t\t{\n\t\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'block');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'none');\n\t\t\t\tthis.toggleIcon(this.getSearchIcon(), 'block');\n\t\t\t}\n\t\t}, 200);\n\t}\n\n\thandleSearchIconClick(event: UIEvent)\n\t{\n\t\tthis.searchInDialog();\n\t\tthis.focusName();\n\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t}\n\n\tonSearch(event)\n\t{\n\t\tconst { query } = event.getData();\n\t\tif (query === '' || query === this.selector.getStoreTitle())\n\t\t{\n\t\t\tevent.target?.searchTab?.getFooter()?.hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tevent.target?.searchTab?.getFooter()?.show();\n\t\t}\n\t}\n\n\tonStoreSelect(event)\n\t{\n\t\tconst item = event.getData().item;\n\t\titem.getDialog().getTargetNode().value = item.getTitle();\n\n\t\tif (this.selector)\n\t\t{\n\t\t\tthis.selector.onStoreSelect(item.getId(), item.getTitle());\n\t\t}\n\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\tthis.selector.clearLayout();\n\t\tthis.selector.layout();\n\n\t\tthis.cache.delete('dialog');\n\t}\n\n\tcreateStore(event): Promise\n\t{\n\t\tconst {searchQuery} = event.getData();\n\t\tconst name = searchQuery.getQuery();\n\n\t\treturn new Promise(\n\t\t\t(resolve, reject) => {\n\t\t\t\tif (!Type.isStringFilled(name))\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst dialog: Dialog = event.getTarget();\n\t\t\t\tdialog.showLoader();\n\t\t\t\tajax.runAction(\n\t\t\t\t\t\t'catalog.storeSelector.createStore',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tjson: {name}\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tdialog.hideLoader();\n\t\t\t\t\t\tconst id = Text.toInteger(response.data.id);\n\t\t\t\t\t\tconst item = dialog.addItem({\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\tentityId: 'store',\n\t\t\t\t\t\t\ttitle: name,\n\t\t\t\t\t\t\ttabs: dialog.getRecentTab().getId(),\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (item)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem.select();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t\t.catch(response => {\n\t\t\t\t\t\tconsole.error(response);\n\t\t\t\t\t\treject();\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t});\n\t}\n\n\tgetPlaceholder(): string\n\t{\n\t\treturn Loc.getMessage('CATALOG_STORE_SELECTOR_BEFORE_SEARCH_TITLE');\n\t}\n\n\tdisable(hint: string|null): void\n\t{\n\t\tthis.disableByRights = true;\n\t\tif (hint)\n\t\t{\n\t\t\tthis.disabledHint = hint;\n\t\t}\n\t}\n}\n","import {Cache, Dom, Event, Extension, Loc, Tag, Text, Type} from 'main.core';\nimport 'ui.forms';\nimport 'ui.notification';\nimport {EventEmitter} from 'main.core.events';\nimport {StoreSearchInput} from \"./store-search-input\";\nimport './component.css';\nimport {ProductModel} from \"catalog.product-model\";\n\nconst instances = new Map();\n\nexport class StoreSelector extends EventEmitter\n{\n\tstatic MODE_VIEW = 'view';\n\tstatic MODE_EDIT = 'edit';\n\tstatic INPUT_FIELD_TITLE = 'STORE_TITLE';\n\tstatic INPUT_FIELD_ID = 'STORE_ID';\n\n\tmode: StoreSelector.MODE_EDIT | StoreSelector.MODE_VIEW = StoreSelector.MODE_EDIT;\n\tproductId: number = null;\n\tcache = new Cache.MemoryCache();\n\tsearchInput: ?StoreSearchInput;\n\n\t#storeInfo: Map = new Map();\n\t#model: ?ProductModel;\n\n\tstatic getById(id: string): ?StoreSelector\n\t{\n\t\treturn instances.get(id) || null;\n\t}\n\n\tconstructor(id, options = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Catalog.StoreSelector');\n\n\t\tthis.id = id || Text.getRandom();\n\t\toptions.inputFieldTitle = options.inputFieldTitle || StoreSelector.INPUT_FIELD_TITLE;\n\t\toptions.inputFieldId = options.inputFieldId || StoreSelector.INPUT_FIELD_ID;\n\t\tthis.options = options || {};\n\n\t\tthis.setMode(options.mode);\n\n\t\tconst settingsCollection = Extension.getSettings('catalog.store-selector');\n\n\t\tif (options.model instanceof ProductModel)\n\t\t{\n\t\t\tif (!options.model.isCatalogExisted())\n\t\t\t{\n\t\t\t\tthis.#storeInfo.set('id', settingsCollection.get('defaultStoreId'));\n\t\t\t\tthis.#storeInfo.set('title', settingsCollection.get('defaultStoreName'));\n\t\t\t}\n\t\t\telse if (options.model.getField(options.inputFieldId) > 0)\n\t\t\t{\n\t\t\t\tthis.#storeInfo.set('id', options.model.getField(options.inputFieldId));\n\t\t\t\tconst name =\n\t\t\t\t\tType.isStringFilled(options.model.getField(options.inputFieldTitle))\n\t\t\t\t\t\t? options.model.getField(options.inputFieldTitle)\n\t\t\t\t\t\t: ''\n\t\t\t\t;\n\n\t\t\t\tthis.setProductId(options.model.getSkuId());\n\t\t\t\tthis.#storeInfo.set('title', name);\n\t\t\t}\n\n\t\t\tthis.#model = options.model;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#storeInfo.set('id', settingsCollection.get('defaultStoreId'));\n\t\t\tthis.#storeInfo.set('title', settingsCollection.get('defaultStoreName'));\n\t\t}\n\n\t\tthis.searchInput = new StoreSearchInput(this.id, {\n\t\t\tselector: this,\n\t\t\tinputName: this.options.inputFieldTitle,\n\t\t\tallowCreateItem: this.options.allowCreateItem || settingsCollection.get('allowCreateItem'),\n\t\t\tdisableByRights: settingsCollection.get('disableByRights'),\n\t\t});\n\n\t\t// this.setDetailPath(this.getConfig('DETAIL_PATH'));\n\t\tthis.layout();\n\n\t\tinstances.set(this.id, this);\n\t}\n\n\tsetMode(mode: StoreSelector.MODE_VIEW | StoreSelector.MODE_EDIT): void\n\t{\n\t\tif (!Type.isNil(mode))\n\t\t{\n\t\t\tthis.mode = mode === StoreSelector.MODE_VIEW ? StoreSelector.MODE_VIEW : StoreSelector.MODE_EDIT;\n\t\t}\n\t}\n\n\tsetProductId(productId: number): void\n\t{\n\t\tproductId = Text.toNumber(productId);\n\t\tif (productId > 0)\n\t\t{\n\t\t\tthis.productId = productId;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.productId = null;\n\t\t}\n\n\t\tthis.searchInput?.clearDialogCache();\n\t}\n\n\tisViewMode(): boolean\n\t{\n\t\treturn this.mode === StoreSelector.MODE_VIEW;\n\t}\n\n\tisSaveable(): boolean\n\t{\n\t\treturn !this.isViewMode() && this.isSaveable();\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetProductId(): ?number\n\t{\n\t\treturn this.productId;\n\t}\n\n\tgetConfig(name, defaultValue)\n\t{\n\t\treturn BX.prop.get(this.options.config, name, defaultValue);\n\t}\n\n\tgetDetailPath(): string\n\t{\n\t\treturn this.getConfig('detailPath', '');\n\t}\n\n\tgetWrapper(): HTMLElement\n\t{\n\t\tif (!this.wrapper)\n\t\t{\n\t\t\tthis.wrapper = document.getElementById(this.id);\n\t\t}\n\n\t\treturn this.wrapper;\n\t}\n\n\trenderTo(node)\n\t{\n\t\tthis.clearLayout();\n\t\tthis.wrapper = node;\n\t\tthis.layout();\n\t}\n\n\tlayout()\n\t{\n\t\tconst wrapper = this.getWrapper();\n\t\tif (!wrapper)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.defineWrapperClass(wrapper);\n\t\tconst block = Tag.render`<div class=\"catalog-store-field-inner\"></div>`;\n\t\twrapper.appendChild(block);\n\t\tblock.appendChild(this.layoutNameBlock());\n\t}\n\n\tfocusName(): this\n\t{\n\t\tif (this.searchInput)\n\t\t{\n\t\t\tthis.searchInput.focusName();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tonClear()\n\t{\n\t\tthis.clearState();\n\t\tthis.clearLayout();\n\t\tthis.layout();\n\t\tthis.searchInput.searchInDialog();\n\t\tthis.focusName();\n\n\t\tthis.emit('onClear', {\n\t\t\tselectorId: this.getId(),\n\t\t\trowId: this.getRowId()\n\t\t});\n\t}\n\n\tclearState(): void\n\t{\n\t\tthis.#storeInfo.clear();\n\t}\n\n\tclearLayout(): void\n\t{\n\t\tconst wrapper = this.getWrapper();\n\t\tif (wrapper)\n\t\t{\n\t\t\twrapper.innerHTML = '';\n\t\t}\n\t}\n\n\tunsubscribeEvents()\n\t{\n\t}\n\n\tdefineWrapperClass(wrapper)\n\t{\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tDom.addClass(wrapper, 'catalog-store-view');\n\t\t\tDom.removeClass(wrapper, 'catalog-store-edit');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(wrapper, 'catalog-store-edit');\n\t\t\tDom.removeClass(wrapper, 'catalog-store-view');\n\t\t}\n\t}\n\n\tgetViewHtml(): HTMLElement\n\t{\n\t\tconst storeTitle = Text.encode(this.getStoreTitle());\n\t\tconst titlePlaceholder = Loc.getMessage('CATALOG_STORE_SELECTOR_VIEW_NAME_TITLE');\n\n\t\tif (this.getDetailPath())\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<a href=\"${this.getDetailPath()}\" title=\"${titlePlaceholder}\">${storeTitle}</a>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`<span title=\"${titlePlaceholder}\">${storeTitle}</span>`;\n\n\t}\n\n\tlayoutNameBlock(): HTMLElement\n\t{\n\t\tconst block = Tag.render`<div class=\"catalog-store-field-input\"></div>`;\n\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tblock.appendChild(this.getViewHtml());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tblock.appendChild(this.searchInput.layout());\n\t\t}\n\n\t\treturn block;\n\t}\n\n\tgetStoreTitle()\n\t{\n\t\treturn this.#storeInfo.get('title') || '';\n\t}\n\n\tgetStoreId()\n\t{\n\t\treturn this.#storeInfo.get('id') || '';\n\t}\n\n\tonStoreSelect(storeId, storeTitle)\n\t{\n\t\tif (storeTitle === '')\n\t\t{\n\t\t\tstoreTitle = Loc.getMessage('CATALOG_STORE_SELECTOR_EMPTY_STORE_TITLE');\n\t\t}\n\t\tthis.#storeInfo.set('id', storeId);\n\t\tthis.#storeInfo.set('title', storeTitle);\n\t\tthis.clearLayout();\n\t\tthis.layout();\n\n\t\tthis.emit('onChange', {\n\t\t\tselectorId: this.id,\n\t\t\trowId: this.getRowId(),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tNAME: this.options.inputFieldId,\n\t\t\t\t\tVALUE: storeId,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tNAME: this.options.inputFieldTitle,\n\t\t\t\t\tVALUE: storeTitle,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t}\n\n\tgetRowId(): string\n\t{\n\t\treturn this.getConfig('ROW_ID');\n\t}\n}\n"],"names":["StoreSearchInput","id","options","Cache","MemoryCache","Text","getRandom","selector","StoreSelector","Error","isEnabledDetailLink","inputName","allowCreateItem","undefined","disableByRights","disabledHint","Loc","getMessage","icon","value","Type","isDomNode","Dom","style","Tag","render","cache","remember","getNameInput","getHiddenNameInput","encode","getStoreTitle","getPlaceholder","handleNameInputHiddenChange","bind","event","target","handleClearIconClick","getDetailPath","handleSearchIconClick","clearInputCache","block","append","getSearchIcon","toggleIcon","getClearIcon","showDetailLink","isStringFilled","getArrowIcon","Event","handleNameInputClick","handleNameInput","handleNameInputBlur","handleNameInputKeyDown","getNameBlock","BX","UI","Hint","init","searchInDialog","handleIconsSwitchingOnNameInput","stubOptions","title","message","subtitle","arrow","params","height","context","targetNode","enableSearch","multiple","dropdownMode","searchTabOptions","stub","events","onStoreSelect","onSearch","createStore","entities","productId","getProductId","searchFields","name","type","system","searchable","dynamicLoad","dynamicSearch","searchOptions","Dialog","dialog","getDialog","key","getActiveTab","getSearchTab","preventDefault","Browser","isMac","metaKey","ctrlKey","getFooter","createItem","onClear","stopPropagation","requestAnimationFrame","focus","searchQuery","show","search","setTimeout","focusName","getData","query","searchTab","hide","item","getTargetNode","getTitle","getId","clearLayout","layout","getQuery","Promise","resolve","reject","getTarget","showLoader","ajax","runAction","json","then","response","hideLoader","toInteger","data","addItem","entityId","tabs","getRecentTab","select","console","error","hint","instances","Map","get","MODE_EDIT","setEventNamespace","inputFieldTitle","INPUT_FIELD_TITLE","inputFieldId","INPUT_FIELD_ID","setMode","mode","settingsCollection","Extension","getSettings","model","ProductModel","isCatalogExisted","set","getField","setProductId","getSkuId","searchInput","isNil","MODE_VIEW","toNumber","clearDialogCache","isViewMode","isSaveable","defaultValue","prop","config","getConfig","wrapper","document","getElementById","node","getWrapper","defineWrapperClass","appendChild","layoutNameBlock","clearState","emit","selectorId","rowId","getRowId","clear","innerHTML","addClass","removeClass","storeTitle","titlePlaceholder","getViewHtml","storeId","fields","NAME","VALUE","EventEmitter"],"mappings":"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"}