(function(e,i,t,a){"use strict";var s=function(){function e(a){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"onUploaderIsInitedHandler",this.handleOnUploaderIsInited.bind(this));babelHelpers.defineProperty(this,"values",new Map);this.id=a;this.wrapper=BX(a);this.productId=s.productId;this.skuId=s.skuId;this.iblockId=s.iblockId;this.saveable=s.saveable;this.inputId=s.inputId;if(i.Type.isObject(s.values)){for(var n in s.values){if(!s.values.hasOwnProperty(n)){continue}this.values.set(n,s.values[n])}}if(this.isSaveable()){t.EventEmitter.subscribe("onUploaderIsInited",this.onUploaderIsInitedHandler)}}babelHelpers.createClass(e,[{key:"isSaveable",value:function e(){return this.saveable===true}},{key:"handleOnUploaderIsInited",value:function e(a){var s=a.getCompatData(),n=babelHelpers.slicedToArray(s,2),l=n[0],r=n[1];if(i.Type.isStringFilled(this.inputId)&&this.inputId===l){this.uploaderFieldMap=new Map;t.EventEmitter.subscribe(r,"onFileIsDeleted",this.onFileDelete.bind(this));t.EventEmitter.subscribe(r,"onFileIsUploaded",this.onFileUpload.bind(this));t.EventEmitter.subscribe(r,"onQueueIsChanged",this.onQueueIsChanged.bind(this))}}},{key:"unsubscribeEvents",value:function e(){if(this.isSaveable()){t.EventEmitter.unsubscribe("onUploaderIsInited",this.onUploaderIsInitedHandler)}}},{key:"unsubscribeImageInputEvents",value:function e(){if(i.Reflection.getClass("BX.UI.ImageInput")){var t=BX.UI.ImageInput.getById(this.inputId);if(t){t.unsubscribeEvents()}}}},{key:"getId",value:function e(){return this.id}},{key:"setId",value:function e(i){this.id=i}},{key:"onFileDelete",value:function e(t){var a=t.getCompatData(),s=babelHelpers.slicedToArray(a,4),n=s[3];var l=n.input_name;if(i.Type.isNil(l)){return null}this.values.delete(l);if(this.isSaveable()){this.save()}}},{key:"onQueueIsChanged",value:function e(t){var a=t.getCompatData(),s=babelHelpers.slicedToArray(a,4),n=s[1],l=s[2],r=s[3];var u=r.file;if(n==="add"&&"input_name"in u&&i.Type.isNil(this.uploaderFieldMap.get(l))){this.uploaderFieldMap.set(l,u["input_name"])}}},{key:"onFileUpload",value:function e(t){var a=t.getCompatData(),s=babelHelpers.slicedToArray(a,3),n=s[0],l=s[2];if(!this.isSaveable()||!i.Type.isObject(l)||!("file"in l)||!("files"in l.file)||!("default"in l.file.files)){return}var r=l["file"]["files"]["default"];var u={fileId:n,data:{name:r.name,type:r.type,tmp_name:r.path,size:r.size,error:null}};var d=this.uploaderFieldMap.get(n)||n;this.values.set(d,u);if(this.isSaveable()){this.save()}}},{key:"save",value:function e(){var a=this;if(this.submitFileTimeOut){clearTimeout(this.submitFileTimeOut)}var s={};this.values.forEach(function(e,i){s[i]=e});var n=i.Text.getRandom(20);this.refreshImageSelectorId=n;this.submitFileTimeOut=setTimeout(function(){i.ajax.runAction("catalog.productSelector.saveMorePhoto",{json:{productId:a.productId,variationId:a.skuId,iblockId:a.iblockId,imageValues:s}}).then(function(e){if(!a.refreshImageSelectorId===n){return}i.Runtime.html(a.wrapper,e.data.input);t.EventEmitter.emit("Catalog.ImageInput::save",[a.id,a.inputId,e])})},500)}}]);return e}();i.Reflection.namespace("BX.Catalog").ImageInput=s})(this.window=this.window||{},BX,BX.Event,BX);
//# sourceMappingURL=script.map.js