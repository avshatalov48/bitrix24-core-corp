(function(e,t,r){"use strict";var a=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"_legendIsPrepared",false);babelHelpers.defineProperty(this,"_series",[]);babelHelpers.defineProperty(this,"_sumStoredColor","#42659B");babelHelpers.defineProperty(this,"_sumSoldColor","#6DA3E6");this._chartId=t.chartId;this._boardId=t.boardId;this._widgetId=t.widgetId;this._board=BX.VisualConstructor.BoardRepository.getBoard(this._boardId);this._widget=this._board.dashboard.getWidget(this._widgetId);this._storeInfoPopupTemplate=t.storeInfoPopupTemplate;this._storeInfoPopup=null;this._sliderUrl=t.chartData.sliderUrl;this._enablePopup=Boolean(t.chartData.enablePopup);this._currencySymbol=t.chartData.currencySymbol;this._chartCurrency=t.chartData.currency;this._isOneColumn=Boolean(t.chartData.isOneColumn);this.createChart(t.chartData);this.updateWidgetTitle();BX.addCustomEvent(this._widget,"Dashboard.Board.Widget:onAfterRender",this.updateWidgetTitle.bind(this))}babelHelpers.createClass(e,[{key:"createChart",value:function e(t){var a=this;window.am4core.useTheme(am4themes_animated);this._chart=am4core.create(this._chartId,am4charts.XYChart);this._chart.zoomOutButton.readerTitle=r.Loc.getMessage("STORE_STOCK_CHART_ZOOMOUT_TITLE");this._chart.data=[];this._chart.legend=new am4charts.Legend;this._chart.legend.position="bottom";this._chartLabel=t._chartLabel;this.createAxes();this.fillChartData(t.data);this.fillSeries();if(t.isOneColumn){this._categoryAxis.renderer.labels.template.html=t.chartLabel}this._chart.events.on("inited",(function(){a.onChartLoaded()}),this)}},{key:"createAxes",value:function e(){this._categoryAxis=this._chart.xAxes.push(new am4charts.CategoryAxis);this._categoryAxis.dataFields.category="ID";this._categoryAxis.renderer.grid.template.opacity=0;this._valueAxis=this._chart.yAxes.push(new am4charts.ValueAxis);this._valueAxis.min=0;this._valueAxis.renderer.grid.template.opacity=0;this._valueAxis.renderer.ticks.template.strokeOpacity=.5;this._valueAxis.renderer.ticks.template.length=10;this._valueAxis.renderer.line.strokeOpacity=.5;this._valueAxis.renderer.baseGrid.disabled=true;this._valueAxis.renderer.minGridDistance=40;this._valueAxis.calculateTotals=true;this._categoryAxis.renderer.labels.template.marginRight=40}},{key:"fillChartData",value:function e(t){this._chart.data=t.map((function(e,t){e["ID"]=t;return e}))}},{key:"fillSeries",value:function e(){var t=this;var a=this.createSeries("empty","empty");a.hiddenInLegend=true;a.maskBullets=false;var o=r.Loc.getMessage("STORE_STOCK_CHART_SUM_STORED_TITLE");var s=this.createSeries("SUM_STORED",o);s.fill=am4core.color(this._sumStoredColor);s.stroke=am4core.color("#FFFFFF");this._series.push(s);var i=r.Loc.getMessage("STORE_STOCK_CHART_SUM_SOLD_TITLE");var n=this.createSeries("SUM_SOLD",i);n.fill=am4core.color(this._sumSoldColor);n.stroke=am4core.color("#FFFFFF");this._series.push(n);s.events.on("inited",(function(e){t.onSeriesLoad(e.target,"SUM_STORED")}),this);n.events.on("inited",(function(e){t.onSeriesLoad(e.target,"SUM_SOLD")}),this)}},{key:"onSeriesLoad",value:function e(t,r){if(this._chart.legend.labels.values.length===this._series.length){this.prepareChartLegend()}if(this._enablePopup){this.bindPopupEvents(t,r)}}},{key:"bindPopupEvents",value:function e(t,r){for(var a=0;a<t.columns.length;a++){var o={columnObject:t.columns.getIndex(a),columnTypeId:r,storeData:this._chart.data[a]};BX.bind(o.columnObject.group.node,"mouseover",this.handleColumnMouseOver.bind(this,o));BX.bind(o.columnObject.group.node,"mouseout",this.handleColumnMouseOut.bind(this));if(this._sliderUrl){o.columnObject.group.node.style.cursor="pointer";BX.bind(o.columnObject.group.node,"click",this.openStoreStockChartGridSlider.bind(this))}}}},{key:"prepareChartLegend",value:function e(){if(this._legendIsPrepared){return}else{this._legendIsPrepared=true}var t=this._chart.legend.labels.values;var r=", "+this._currencySymbol;for(var a=0;a<t.length;a++){t[a].fill=am4core.color("#000000");t[a].html=t[a].currentText+r}}},{key:"handleColumnMouseOver",value:function e(t){this.openStoreInfoPopup(t)}},{key:"handleColumnMouseOut",value:function e(){if(this._storeInfoPopup!==null){this._storeInfoPopup.close()}}},{key:"openStoreStockChartGridSlider",value:function e(){BX.SidePanel.Instance.open(this._sliderUrl,{cacheable:false,allowChangeTitle:false,allowChangeHistory:false})}},{key:"openStoreInfoPopup",value:function e(t){if(this._storeInfoPopup!==null){this._storeInfoPopup.destroy()}var r={typeId:t.columnTypeId,storeData:t.storeData};this._storeInfoPopup=new BX.PopupWindow("widget-store-stock-info-popup",t.columnObject.group.node,{bindOptions:{position:"top"},offsetLeft:30,offsetTop:-1,noAllPaddings:true,autoHide:false,draggable:{restrict:false},cacheable:false,content:this.getFormedStoreInfoPopupContent(r)});this._storeInfoPopup.show()}},{key:"getFormedStoreInfoPopupContent",value:function e(t){var a={title:this._storeInfoPopupTemplate.querySelector("#chart-popup-template-title"),sum:this._storeInfoPopupTemplate.querySelector("#chart-popup-template-sum"),sumProc:this._storeInfoPopupTemplate.querySelector("#chart-popup-template-sum-proc")};switch(t.typeId){case"SUM_SOLD":a.title.innerText=r.Loc.getMessage("STORE_STOCK_CHART_POPUP_SOLD_TITLE");a.sum.innerHTML=this.sumCurrencyFormat(t.storeData["SUM_SOLD"]);a.sumProc.innerText=this.formatPercentValue(t.storeData["SUM_SOLD_PERCENT"]);this._storeInfoPopupTemplate.style.borderColor=this._sumSoldColor;break;case"SUM_STORED":a.title.innerText=r.Loc.getMessage("STORE_STOCK_CHART_POPUP_STORED_TITLE");a.sum.innerHTML=this.sumCurrencyFormat(t.storeData["SUM_STORED"]);a.sumProc.innerText=this.formatPercentValue(t.storeData["SUM_STORED_PERCENT"]);this._storeInfoPopupTemplate.style.borderColor=this._sumStoredColor;break}return this._storeInfoPopupTemplate}},{key:"sumCurrencyFormat",value:function e(t){t=parseFloat(t);return BX.Currency.currencyFormat(t,this._chartCurrency,true)}},{key:"formatPercentValue",value:function e(t){return parseFloat(t).toFixed(2)+"%"}},{key:"createSeries",value:function e(t,r){var a=this._chart.series.push(new am4charts.ColumnSeries);a.dataFields.valueY=t;a.dataFields.categoryX="ID";a.stacked=true;a.name=r;return a}},{key:"updateWidgetTitle",value:function e(){BX.clean(this._widget.layout.titleContainer);BX.adjust(this._widget.layout.titleContainer,{children:[BX.create("span",{text:this._widget.config.title}),this._hint=BX.UI.Hint.createNode(r.Loc.getMessage("STORE_STOCK_CHART_HINT_TITLE"))]});BX.bind(this._hint,"click",(function(){if(top.BX.Helper){top.BX.Helper.show("redirect=detail&code=15503856")}}))}},{key:"onChartLoaded",value:function e(){if(!this._isOneColumn){this.fillColumnsTitle()}else{this._categoryAxis.dataItemsByCategory.getKey("0").text=""}}},{key:"fillColumnsTitle",value:function e(){var t=this;this._chart.data.forEach((function(e){t._categoryAxis.dataItemsByCategory.getKey(e["ID"]).text=e["STORE_NAME"]}))}}]);return e}();r.Reflection.namespace("BX.Catalog.Report.StoreStock").StoreStockSaleChart=a})(this.window=this.window||{},BX,BX);
//# sourceMappingURL=script.map.js