{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Loc, Reflection } from 'main.core';\nimport { EntityCard } from 'catalog.entity-card';\nimport { type BaseEvent, EventEmitter } from 'main.core.events';\nimport { MessageBox } from 'ui.dialogs.messagebox';\n\nclass VariationCard extends EntityCard\n{\n\t#isQuantityTraceNoticeShown = false;\n\n\tconstructor(id, settings = {})\n\t{\n\t\tsuper(id, settings);\n\t\tEventEmitter.subscribe('BX.Grid.SettingsWindow:save', () => this.postSliderMessage('onUpdate', {}));\n\t}\n\n\tgetEntityType()\n\t{\n\t\treturn 'Variation';\n\t}\n\n\tonSectionLayout(event: BaseEvent)\n\t{\n\t\tconst [section, eventData] = event.getCompatData();\n\n\t\tif (eventData.id === 'catalog_parameters')\n\t\t{\n\t\t\teventData.visible = this.isCardSettingEnabled('CATALOG_PARAMETERS');\n\t\t}\n\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorList:onItemSelect', (event) => {\n\t\t\tconst isQuantityTraceRestricted = !(this.isWithOrdersMode && !this.isInventoryManagementUsed);\n\t\t\tif (this.#isQuantityTraceNoticeShown || !isQuantityTraceRestricted)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst field = event.getData()[1]?.field;\n\t\t\tif (!field)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (field.getId() !== 'QUANTITY_TRACE' || field._selectedValue !== 'N')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tMessageBox.alert(\n\t\t\t\tLoc.getMessage('CPVD_QUANTITY_TRACE_NOTICE'),\n\t\t\t\tLoc.getMessage('CPVD_QUANTITY_TRACE_NOTICE_TITLE'),\n\t\t\t\t(messageBox) => {\n\t\t\t\t\tthis.#isQuantityTraceNoticeShown = false;\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t},\n\t\t\t\tLoc.getMessage('CPVD_QUANTITY_TRACE_ACCEPT'),\n\t\t\t);\n\n\t\t\tthis.#isQuantityTraceNoticeShown = true;\n\t\t});\n\n\t\tEventEmitter.subscribe('onEntityUpdate', (event) => {\n\t\t\tconst editor = event.getData()[0]?.sender;\n\t\t\tif (!editor)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst quantityTraceValue = editor._model.getField('QUANTITY_TRACE', 'D');\n\t\t\tconst isQuantityTraceRestricted = !(this.isWithOrdersMode && !this.isInventoryManagementUsed);\n\t\t\tif (quantityTraceValue !== 'N' && isQuantityTraceRestricted)\n\t\t\t{\n\t\t\t\teditor.getControlById('QUANTITY_TRACE')?.setVisible(false);\n\t\t\t}\n\t\t});\n\n\t\tsection?.getChildren().forEach((field) => {\n\t\t\tif (this.hiddenFields.includes(field?.getId()))\n\t\t\t{\n\t\t\t\tfield.setVisible(false);\n\t\t\t}\n\t\t});\n\t}\n}\n\nReflection.namespace('BX.Catalog').VariationCard = VariationCard;\n"],"names":["VariationCard","id","settings","EventEmitter","subscribe","postSliderMessage","event","getCompatData","section","eventData","visible","isCardSettingEnabled","isQuantityTraceRestricted","isWithOrdersMode","isInventoryManagementUsed","field","getData","getId","_selectedValue","MessageBox","alert","Loc","getMessage","messageBox","close","editor","sender","quantityTraceValue","_model","getField","getControlById","setVisible","getChildren","forEach","hiddenFields","includes","EntityCard","Reflection","namespace"],"mappings":";;;;;;AAAA,CAGmD;CAAA,IAE7CA,aAAa;GAAA;GAIlB,uBAAYC,EAAE,EACd;KAAA;KAAA,IADgBC,QAAQ,uEAAG,EAAE;KAAA;KAE5B,2GAAMD,EAAE,EAAEC,QAAQ;KAAE;OAAA;OAAA,OAJS;;KAK7BC,6BAAY,CAACC,SAAS,CAAC,6BAA6B,EAAE;OAAA,OAAM,MAAKC,iBAAiB,CAAC,UAAU,EAAE,EAAE,CAAC;OAAC;KAAC;;GACpG;KAAA;KAAA,gCAGD;OACC,OAAO,WAAW;;;KAClB;KAAA,gCAEeC,KAAgB,EAChC;OAAA;OACC,2BAA6BA,KAAK,CAACC,aAAa,EAAE;SAAA;SAA3CC,OAAO;SAAEC,SAAS;OAEzB,IAAIA,SAAS,CAACR,EAAE,KAAK,oBAAoB,EACzC;SACCQ,SAAS,CAACC,OAAO,GAAG,IAAI,CAACC,oBAAoB,CAAC,oBAAoB,CAAC;;OAGpER,6BAAY,CAACC,SAAS,CAAC,qCAAqC,EAAE,UAACE,KAAK,EAAK;SAAA;SACxE,IAAMM,yBAAyB,GAAG,EAAE,MAAI,CAACC,gBAAgB,IAAI,CAAC,MAAI,CAACC,yBAAyB,CAAC;SAC7F,IAAI,wCAAI,kCAAgC,CAACF,yBAAyB,EAClE;WACC;;SAGD,IAAMG,KAAK,sBAAGT,KAAK,CAACU,OAAO,EAAE,CAAC,CAAC,CAAC,oDAAlB,gBAAoBD,KAAK;SACvC,IAAI,CAACA,KAAK,EACV;WACC;;SAGD,IAAIA,KAAK,CAACE,KAAK,EAAE,KAAK,gBAAgB,IAAIF,KAAK,CAACG,cAAc,KAAK,GAAG,EACtE;WACC;;SAGDC,gCAAU,CAACC,KAAK,CACfC,aAAG,CAACC,UAAU,CAAC,4BAA4B,CAAC,EAC5CD,aAAG,CAACC,UAAU,CAAC,kCAAkC,CAAC,EAClD,UAACC,UAAU,EAAK;WACf,wCAAI,+BAA+B,KAAK;WACxCA,UAAU,CAACC,KAAK,EAAE;UAClB,EACDH,aAAG,CAACC,UAAU,CAAC,4BAA4B,CAAC,CAC5C;SAED,wCAAI,+BAA+B,IAAI;QACvC,CAAC;OAEFnB,6BAAY,CAACC,SAAS,CAAC,gBAAgB,EAAE,UAACE,KAAK,EAAK;SAAA;SACnD,IAAMmB,MAAM,uBAAGnB,KAAK,CAACU,OAAO,EAAE,CAAC,CAAC,CAAC,qDAAlB,iBAAoBU,MAAM;SACzC,IAAI,CAACD,MAAM,EACX;WACC;;SAGD,IAAME,kBAAkB,GAAGF,MAAM,CAACG,MAAM,CAACC,QAAQ,CAAC,gBAAgB,EAAE,GAAG,CAAC;SACxE,IAAMjB,yBAAyB,GAAG,EAAE,MAAI,CAACC,gBAAgB,IAAI,CAAC,MAAI,CAACC,yBAAyB,CAAC;SAC7F,IAAIa,kBAAkB,KAAK,GAAG,IAAIf,yBAAyB,EAC3D;WAAA;WACC,yBAAAa,MAAM,CAACK,cAAc,CAAC,gBAAgB,CAAC,0DAAvC,sBAAyCC,UAAU,CAAC,KAAK,CAAC;;QAE3D,CAAC;OAEFvB,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEwB,WAAW,EAAE,CAACC,OAAO,CAAC,UAAClB,KAAK,EAAK;SACzC,IAAI,MAAI,CAACmB,YAAY,CAACC,QAAQ,CAACpB,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEE,KAAK,EAAE,CAAC,EAC9C;WACCF,KAAK,CAACgB,UAAU,CAAC,KAAK,CAAC;;QAExB,CAAC;;;GACF;CAAA,EA5E0BK,6BAAU;AA+EtCC,qBAAU,CAACC,SAAS,CAAC,YAAY,CAAC,CAACtC,aAAa,GAAGA,aAAa;;;;"}