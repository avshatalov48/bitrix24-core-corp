BX.namespace("BX.Catalog");BX.Catalog.ProductSearchDialog=function(){var e=function(e){this.callback=null;this.event=null;this.tableId=e.tableId;this.multiple=e.multiple;this.itemDataNamePrefix=e.itemDataNamePrefix;if(typeof e.event!=="undefined"){this.event=e.event}else if(typeof e.callback!=="undefined"){this.callback=e.callback}this.callerName=e.callerName;this.currentUri=e.currentUri;this.popup=BX.WindowManager.Get();this.iblockName=e.iblockName;this.searchTimer=null;this.ignoreFilter=true;var t=this,i=function(e){var n=!!BX(t.tableId+"_reload_container");if(n){if(!e.altKey&&!e.ctrlKey&&!e.metaKey&&document.activeElement.tagName!=="INPUT"&&document.activeElement.tagName!=="SELECT"&&document.activeElement.tagName!=="TEXTAREA"){if(e.keyCode>=48&&e.keyCode<=90||e.keyCode>=96&&e.keyCode<=105||e.keyCode==219||e.keyCode==221){BX(t.tableId+"_query").focus()}}}else if(document.removeEventListener)document.removeEventListener("keydown",i);else document.detachEvent("onkeydown",i)};if(document.addEventListener)document.addEventListener("keydown",i);else if(document.attachEvent)document.attachEvent("onkeydown",i)};e.prototype.getIblockId=function(){return BX(this.tableId+"_iblock").value};e.prototype.getForm=function(){return BX(this.tableId+"_form")};e.prototype.getGridForm=function(){return BX("form_"+this.tableId)};e.prototype.sendItems=function(e){if(BX.type.isNotEmptyString(this.event)){BX.onCustomEvent(this.event,[e])}else if(BX.type.isNotEmptyString(this.callback)){window[this.callback](e,this.getIblockId())}};e.prototype.getItemData=function(e){let t=BX(this.itemDataNamePrefix+e);const i=["id","type","name","full_quantity","measureRatio","measure","quantity","IBLOCK_ID"];if(!BX.type.isElementNode(t)){return null}let n={};i.forEach((function(e){let i="product"+e;if(i in t.dataset){n[e]=t.dataset[i]}}));if(BX.type.isNotEmptyObject(n)){if(typeof n.IBLOCK_ID==="undefined"){n.IBLOCK_ID=this.getIblockId()}let t=this.getItemCurrentQuantity(e);if(t!==null){n.quantity=t}return n}return null};e.prototype.getItemCurrentQuantity=function(e){let t=BX(this.tableId+"_qty_"+e);if(BX.type.isElementNode(t)){return t.value}return null};e.prototype.selectItem=function(e){let t=this.getItemData(e);if(t===null){return}if(this.multiple){this.sendItems([t])}else{this.sendItems(t)}};e.prototype.selectItemList=function(){if(!this.multiple){return}let e=[],t=this.getGridForm();if(BX.type.isElementNode(t)){let i=t.querySelectorAll('input[name="ID[]"]');i.forEach((function(t){if(t.checked){let i=this.getItemData(t.value);if(i!==null){e.push(i)}}}),this)}if(e.length>0){this.sendItems(e)}};e.prototype.fShowSku=function(e,t){let i,n,a=BX.hasClass(t,"is-expand");if(!BX.type.isArray(e)||e.length<1)return false;for(i=0;i<e.length;i++){n=BX(this.tableId+"_sku-"+e[i]);if(BX.type.isElementNode(n)){if(!a)BX.show(n.parentNode.parentNode);else BX.hide(n.parentNode.parentNode)}n=null}BX.toggleClass(t,"is-expand");return false};e.prototype.onSubmitForm=function(){window[this.tableId].GetAdminList(this.buildUrl());return false};e.prototype.onSearch=function(e,t){var i=BX(this.tableId+"_query_value"),n=i.value;if(n===e)return false;i.value=e;var a=this;if(this.searchTimer!=null)clearTimeout(this.searchTimer);this.searchTimer=setTimeout((function(){if(e.length===0||e.length>2){a.onSubmitForm()}BX(a.tableId+"_query_clear").style.display=e.length===0?"none":"inline";BX(a.tableId+"_query_clear_separator").style.display=e.length===0?"none":"inline-block";a.searchTimer=null}),t||300);return true};e.prototype.clearQuery=function(){var e=BX(this.tableId+"_query"),t=e.value;e.value="";if(t.length>2)this.onSearch("",10);return false};e.prototype.checkSubstring=function(){var e=BX(this.tableId+"_query_substring"),t=BX(this.tableId+"_query_substring_value");if(BX.type.isElementNode(e)&&BX.type.isElementNode(t)){t.value=e.checked?"Y":"N";return true}return false};e.prototype.search=function(){var e=BX(this.tableId+"_query_value"),t=BX(this.tableId+"_query");if(BX.type.isElementNode(e)&&BX.type.isElementNode(t)){e.value=t.value;this.onSubmitForm()}};e.prototype.onIblockChange=function(e,t){var i=this,n=this.buildUrl({action:"change_iblock",IBLOCK_ID:e,SECTION_ID:0});if(t)i.iblockName=t;BX.ajax.get(n,null,BX.proxy((function(e){BX(i.tableId+"_reload_container").innerHTML=e}),this));BX(this.tableId+"_section_label").style.display="none";return false};e.prototype.onSectionClick=function(e,t){BX(this.tableId+"_section_id").value=e;this.onSubmitForm();var i=BX.findChildren(BX(this.tableId+"_catalog_tree_wrap"),{className:"adm-submenu-item-active"},true);BX.removeClass(i[0],"adm-submenu-item-active");var n=BX(this.tableId+"_section_"+e);if(n){BX.addClass(n.parentNode,"adm-submenu-item-active");if(!BX.hasClass(n.parentNode,"adm-sub-submenu-open")){var a=BX.findChild(n,{className:"adm-submenu-item-arrow"});if(a)a.click()}}if(!t&&n){var l=BX.findChild(BX(this.tableId+"_section_"+e).parentNode,{className:"adm-submenu-item-name-link-text"},true);t=l.innerHTML}var o=BX(this.tableId+"_section_label");o.innerHTML=e!="0"?t+' <span class="adm-s-search-tag-del" onclick="return '+this.tableId+'_helper.onSectionClick(0)"></span>':"";o.style.display=e!="0"?"inline-block":"none";return false};e.prototype.toggleSection=function(e){var t=!BX.hasClass(e,"adm-sub-submenu-open");BX[t?"addClass":"removeClass"](e,"adm-sub-submenu-open");return t};e.prototype.toggleDynSection=function(e,t,i,n,a){var l=BX.findChild(t,{className:"adm-sub-submenu-block-children"});if(l.hasChildNodes()){this.toggleSection(t,i,n);return}var o=false;var r=BX.create("SPAN",{props:{className:"adm-submenu-loading adm-sub-submenu-block"},style:{marginLeft:parseInt(e)+"px"},text:BX.message("JS_CORE_LOADING")});setTimeout(BX.proxy((function(){if(!o){l.appendChild(r);this.toggleSection(t,i,n)}}),this),200);var s=this,u=this.currentUri+"?action=open_section&lang="+BX.message("LANGUAGE_ID")+"&section_id="+i+"&IBLOCK_ID="+s.getIblockId()+"&caller="+this.callerName+"&level="+n+"&active_id="+(a?a:0);BX.ajax.get(u,BX.proxy((function(e){o=true;e=BX.util.trim(e);if(e!=""){var a=r.parentNode?true:false;l.innerHTML=e;if(!a)this.toggleSection(t,i,n)}else{r.innerHTML=BX.message("JS_CORE_NO_DATA");if(!r.parentNode){l.appendChild(r);this.toggleSection(t,i,n)}}}),this))};e.prototype.openBranchByPath=function(e){var t=e.pop();for(var i=0;i<e.length;++i){var n=BX(this.tableId+"_section_"+e[i]);if(n){var a=parseInt(n.getAttribute("data-level"))+1,l=n.getAttribute("data-offset"),o=n.parentNode;if(BX.hasClass(o,"adm-sub-submenu-open"))continue;var r=BX.findChild(o,{className:"adm-sub-submenu-block-children"});if(r.hasChildNodes()){this.toggleSection(o,e[i],a)}else{this.toggleDynSection(l,o,e[i],a,t);break}}}};e.prototype.setBreadcrumbs=function(e){var t=this.iblockName,i=['<a class="adm-navchain-item adm-navchain-item-desktop" href="#" onclick="return '+this.tableId+'_helper.onSectionClick(0)">'+BX.util.htmlspecialchars(t)+"</a>"],n=[],a=BX(this.tableId+"_breadcrumbs");for(var l in e){if(e.hasOwnProperty(l)){n.push(e[l].ID);i.push('<a class="adm-navchain-item adm-navchain-item-desktop" href="#" onclick="return '+this.tableId+"_helper.onSectionClick("+e[l].ID+')">'+BX.util.htmlspecialchars(e[l].NAME)+"</a>");t=e[l].NAME}}if(this.popup!==null){this.popup.SetTitle(BX.util.htmlspecialcharsback(t))}if(BX.type.isDomNode(a)){a.innerHTML=i.join('<span class="adm-navchain-delimiter"></span>')}this.openBranchByPath(n)};e.prototype.setIgnoreFilter=function(e){this.ignoreFilter=!!e};e.prototype.buildUrl=function(e){let t=BX.ajax.prepareForm(this.getForm()),i=[],n,a=false;if(BX.type.isPlainObject(e)){a=BX.type.isNotEmptyString(e.action)&&e.action==="change_iblock"}for(n in t.data){if(t.data.hasOwnProperty(n)&&t.data[n]){if(this.ignoreFilter&&n.indexOf("filter_")===0)continue;if(a&&n==="mode"){continue}i.push(encodeURIComponent(n)+"="+encodeURIComponent(t.data[n]))}}if(BX.type.isPlainObject(e)){for(n in e){if(e.hasOwnProperty(n)&&e[n]){i.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]))}}}return this.currentUri+"?"+i.join("&",i)};return e}();
//# sourceMappingURL=script.map.js