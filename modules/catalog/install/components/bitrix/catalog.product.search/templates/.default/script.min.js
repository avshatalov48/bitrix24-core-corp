BX.namespace("BX.Catalog");BX.Catalog.ProductSearchDialog=function(){var e=function(e){this.callback=null;this.event=null;this.tableId=e.tableId;if(typeof e.event!=="undefined"){this.event=e.event}else if(typeof e.callback!=="undefined"){this.callback=e.callback}this.callerName=e.callerName;this.currentUri=e.currentUri;this.popup=e.popup;this.iblockName=e.iblockName;this.searchTimer=null;this.ignoreFilter=true;var t=this,i=function(e){var n=!!BX(t.tableId+"_reload_container");if(n){if(!e.altKey&&!e.ctrlKey&&!e.metaKey&&document.activeElement.tagName!=="INPUT"&&document.activeElement.tagName!=="SELECT"&&document.activeElement.tagName!=="TEXTAREA"){if(e.keyCode>=48&&e.keyCode<=90||e.keyCode>=96&&e.keyCode<=105||e.keyCode==219||e.keyCode==221){BX(t.tableId+"_query").focus()}}}else if(document.removeEventListener)document.removeEventListener("keydown",i);else document.detachEvent("onkeydown",i)};if(document.addEventListener)document.addEventListener("keydown",i);else if(document.attachEvent)document.attachEvent("onkeydown",i)};e.prototype.getIblockId=function(){return BX(this.tableId+"_iblock").value};e.prototype.getForm=function(){return BX(this.tableId+"_form")};e.prototype.SelEl=function(e,t){var i,n;if(BX.hasClass(t,"adm-list-table-row")){BX.addClass(t,"row-sku-selected")}else{n=BX.findParent(t,{className:"adm-list-table-row"});if(BX.type.isElementNode(n))BX.addClass(n,"row-sku-selected");n=null}if(typeof e["quantity"]==="undefined")e["quantity"]=1;i=BX(this.tableId+"_qty_"+e["id"]);if(!!i)e["quantity"]=i.value;if(!!this.event){if(typeof e.IBLOCK_ID==="undefined")e.IBLOCK_ID=this.getIblockId();BX.onCustomEvent(this.event,[e])}else if(!!this.callback){window[this.callback](e,this.getIblockId())}};e.prototype.fShowSku=function(e,t){var i,n,a=BX.hasClass(t,"is-expand");if(!BX.type.isArray(e)||e.length<1)return false;for(i=0;i<e.length;i++){n=BX(this.tableId+"_sku-"+e[i]);if(BX.type.isElementNode(n)){if(!a)BX.show(n.parentNode.parentNode);else BX.hide(n.parentNode.parentNode)}n=null}BX.toggleClass(t,"is-expand");return false};e.prototype.onSubmitForm=function(){var e=this.buildUrl();window[this.tableId].GetAdminList(e);return false};e.prototype.onSearch=function(e,t){var i=BX(this.tableId+"_query_value"),n=i.value;if(n===e)return false;i.value=e;var a=this;if(this.searchTimer!=null)clearTimeout(this.searchTimer);this.searchTimer=setTimeout(function(){if(e.length===0||e.length>2){a.onSubmitForm()}BX(a.tableId+"_query_clear").style.display=e.length===0?"none":"inline";BX(a.tableId+"_query_clear_separator").style.display=e.length===0?"none":"inline-block";a.searchTimer=null},t||300);return true};e.prototype.clearQuery=function(){var e=BX(this.tableId+"_query"),t=e.value;e.value="";if(t.length>2)this.onSearch("",10);return false};e.prototype.checkSubstring=function(){var e=BX(this.tableId+"_query_substring"),t=BX(this.tableId+"_query_substring_value");if(BX.type.isElementNode(e)&&BX.type.isElementNode(t)){t.value=e.checked?"Y":"N";return true}return false};e.prototype.search=function(){var e=BX(this.tableId+"_query_value"),t=BX(this.tableId+"_query");if(BX.type.isElementNode(e)&&BX.type.isElementNode(t)){e.value=t.value;this.onSubmitForm()}};e.prototype.onIblockChange=function(e,t){var i=this,n=this.buildUrl({action:"change_iblock",IBLOCK_ID:e,SECTION_ID:0});if(t)i.iblockName=t;BX.ajax.get(n,null,BX.proxy(function(e){BX(i.tableId+"_reload_container").innerHTML=e},this));BX(this.tableId+"_section_label").style.display="none";return false};e.prototype.onSectionClick=function(e,t){BX(this.tableId+"_section_id").value=e;this.onSubmitForm();var i=BX.findChildren(BX(this.tableId+"_catalog_tree_wrap"),{className:"adm-submenu-item-active"},true);BX.removeClass(i[0],"adm-submenu-item-active");var n=BX(this.tableId+"_section_"+e);if(n){BX.addClass(n.parentNode,"adm-submenu-item-active");if(!BX.hasClass(n.parentNode,"adm-sub-submenu-open")){var a=BX.findChild(n,{className:"adm-submenu-item-arrow"});if(a)a.click()}}if(!t&&n){var o=BX.findChild(BX(this.tableId+"_section_"+e).parentNode,{className:"adm-submenu-item-name-link-text"},true);t=o.innerHTML}var s=BX(this.tableId+"_section_label");s.innerHTML=e!="0"?t+' <span class="adm-s-search-tag-del" onclick="return '+this.tableId+'_helper.onSectionClick(0)"></span>':"";s.style.display=e!="0"?"inline-block":"none";return false};e.prototype.toggleSection=function(e){var t=!BX.hasClass(e,"adm-sub-submenu-open");BX[t?"addClass":"removeClass"](e,"adm-sub-submenu-open");return t};e.prototype.toggleDynSection=function(e,t,i,n,a){var o=BX.findChild(t,{className:"adm-sub-submenu-block-children"});if(o.hasChildNodes()){this.toggleSection(t,i,n);return}var s=false;var l=BX.create("SPAN",{props:{className:"adm-submenu-loading adm-sub-submenu-block"},style:{marginLeft:parseInt(e)+"px"},text:BX.message("JS_CORE_LOADING")});setTimeout(BX.proxy(function(){if(!s){o.appendChild(l);this.toggleSection(t,i,n)}},this),200);var r=this,c=this.currentUri+"?action=open_section&lang="+BX.message("LANGUAGE_ID")+"&section_id="+i+"&IBLOCK_ID="+r.getIblockId()+"&caller="+this.callerName+"&level="+n+"&active_id="+(a?a:0);BX.ajax.get(c,BX.proxy(function(e){s=true;e=BX.util.trim(e);if(e!=""){var a=l.parentNode?true:false;o.innerHTML=e;if(!a)this.toggleSection(t,i,n)}else{l.innerHTML=BX.message("JS_CORE_NO_DATA");if(!l.parentNode){o.appendChild(l);this.toggleSection(t,i,n)}}},this))};e.prototype.openBranchByPath=function(e){var t=e.pop();for(var i=0;i<e.length;++i){var n=BX(this.tableId+"_section_"+e[i]);if(n){var a=parseInt(n.getAttribute("data-level"))+1,o=n.getAttribute("data-offset"),s=n.parentNode;if(BX.hasClass(s,"adm-sub-submenu-open"))continue;var l=BX.findChild(s,{className:"adm-sub-submenu-block-children"});if(l.hasChildNodes()){this.toggleSection(s,e[i],a)}else{this.toggleDynSection(o,s,e[i],a,t);break}}}};e.prototype.setBreadcrumbs=function(e){var t=this.iblockName,i=['<a class="adm-navchain-item adm-navchain-item-desktop" href="#" onclick="return '+this.tableId+'_helper.onSectionClick(0)">'+BX.util.htmlspecialchars(t)+"</a>"],n=[],a=BX(this.tableId+"_breadcrumbs");for(var o in e){if(e.hasOwnProperty(o)){n.push(e[o].ID);i.push('<a class="adm-navchain-item adm-navchain-item-desktop" href="#" onclick="return '+this.tableId+"_helper.onSectionClick("+e[o].ID+')">'+BX.util.htmlspecialchars(e[o].NAME)+"</a>");t=e[o].NAME}}if(this.popup!==null){this.popup.SetTitle(BX.util.htmlspecialcharsback(t))}if(BX.type.isDomNode(a)){a.innerHTML=i.join('<span class="adm-navchain-delimiter"></span>')}this.openBranchByPath(n)};e.prototype.setIgnoreFilter=function(e){this.ignoreFilter=!!e};e.prototype.buildUrl=function(e){var t=BX.ajax.prepareForm(this.getForm()),i=[],n,a=false;if(BX.type.isPlainObject(e)){a=BX.type.isNotEmptyString(e.action)&&e.action==="change_iblock"}for(n in t.data){if(t.data.hasOwnProperty(n)&&t.data[n]){if(this.ignoreFilter&&n.indexOf("filter_")===0)continue;if(a&&n==="mode"){continue}i.push(encodeURIComponent(n)+"="+encodeURIComponent(t.data[n]))}}if(BX.type.isPlainObject(e)){for(n in e){if(e.hasOwnProperty(n)&&e[n]){i.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]))}}}return this.currentUri+"?"+i.join("&",i)};return e}();
//# sourceMappingURL=script.map.js