(function(t,e,i,a,n){"use strict";function r(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<label class="ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100">\n\t\t\t\t\t<div class="ui-ctl-w10" style="text-align: center">','</div>\n\t\t\t\t\t<div class="ui-ctl-w75">\n\t\t\t\t\t\t<span class="ui-entity-editor-popup-create-field-item-title">','</span>\n\t\t\t\t\t\t<span class="ui-entity-editor-popup-create-field-item-desc">',"</span>\t\n\t\t\t\t\t</div>\t\t\t\t\t\n\t\t\t\t</label>\n\t\t\t"]);r=function e(){return t};return t}function s(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input type="checkbox">\n\t\t']);s=function e(){return t};return t}function o(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t"]);o=function e(){return t};return t}var d=function(t){babelHelpers.inherits(a,t);function a(t){var e;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,a);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).call(this,t,i));e.variationGridId=i.variationGridId;e.settingsButtonId=i.settingsButtonId;e.bindCardSettingsButton();n.EventEmitter.subscribe("SidePanel.Slider:onMessage",e.onSliderMessage.bind(babelHelpers.assertThisInitialized(e)));n.EventEmitter.subscribe("Grid::updated",e.onGridUpdatedHandler.bind(babelHelpers.assertThisInitialized(e)));n.EventEmitter.subscribe("BX.UI.EntityEditorSection:onLayout",e.onSectionLayout.bind(babelHelpers.assertThisInitialized(e)));return e}babelHelpers.createClass(a,[{key:"getEntityType",value:function t(){return"Product"}},{key:"onSectionLayout",value:function t(e){var i=e.getCompatData(),a=babelHelpers.slicedToArray(i,2),n=a[1];if(n.id==="catalog_parameters"){n.visible=this.isSimpleProduct&&this.isCardSettingEnabled("CATALOG_PARAMETERS")}}},{key:"onEditorAjaxSubmit",value:function t(i){babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"onEditorAjaxSubmit",this).call(this,i);var n=i.getCompatData(),r=babelHelpers.slicedToArray(n,2),s=r[1];if(s.data){if(s.data.NOTIFY_ABOUT_NEW_VARIATION){this.showNotification(e.Loc.getMessage("CPD_NEW_VARIATION_ADDED"))}}}},{key:"onGridUpdatedHandler",value:function t(e){var i=e.getCompatData(),a=babelHelpers.slicedToArray(i,1),n=a[0];if(n&&n.getId()===this.getVariationGridId()){this.updateSettingsCheckboxState();if(n.getRows().getCountDisplayed()<=0){document.location.reload()}}}},{key:"updateSettingsCheckboxState",value:function t(){var i=this;var a=this.getCardSettingsPopup().getContentContainer();this.cardSettings.filter(function(t){return t.action==="grid"&&e.Type.isArray(t.columns)}).forEach(function(t){var n=true;t.columns.forEach(function(t){if(!i.getVariationGrid().getColumnHeaderCellByName(t)){n=false}});var r=a.querySelector('input[data-setting-id="'+t.id+'"]');if(e.Type.isDomNode(r)){r.checked=n}})}},{key:"getSettingsButton",value:function t(){return BX.UI.ButtonManager.getByUniqid(this.settingsButtonId)}},{key:"bindCardSettingsButton",value:function t(){var i=this.getSettingsButton();if(i){e.Event.bind(i.getContainer(),"click",this.showCardSettingsPopup.bind(this))}}},{key:"getCardSettingsPopup",value:function t(){if(!this.settingsPopup){this.settingsPopup=new i.Popup(this._id,this.getSettingsButton().getContainer(),{autoHide:true,draggable:false,offsetLeft:0,offsetTop:0,angle:{position:"top",offset:43},noAllPaddings:true,bindOptions:{forceBindPosition:true},closeByEsc:true,content:this.prepareCardSettingsContent()})}return this.settingsPopup}},{key:"showCardSettingsPopup",value:function t(){var i=this;var a=function t(){return i.getCardSettingsPopup().show()};var n=e.Reflection.getClass("BX.Catalog.VariationGrid.Instance");if(n){n.askToLossGridData(a)}else{a()}}},{key:"prepareCardSettingsContent",value:function t(){var i=this;var a=e.Tag.render(o());this.cardSettings.map(function(t){a.append(i.getSettingItem(t))});return a}},{key:"getSettingItem",value:function t(i){var a=e.Tag.render(s());a.checked=i.checked;a.dataset.settingId=i.id;var n=e.Tag.render(r(),a,i.title,i.desc);e.Event.bind(n,"change",this.setProductCardSetting.bind(this));return n}},{key:"setProductCardSetting",value:function t(e){var i=this.getCardSetting(e.target.dataset.settingId);if(!i){return}var a=e.target.checked;if(i.action==="grid"){this.requestGridSettings(i,a)}else{this.requestCardSettings(i,a)}}},{key:"requestGridSettings",value:function t(i,a){var n=this;if(!this.getVariationGrid());var r=[];var s=this.getVariationGrid().getRows().getHeadFirstChild().getCells();Array.from(s).forEach(function(t){if("name"in t.dataset){r.push(t.dataset.name)}});BX.ajax.runComponentAction(this.componentName,"setGridSetting",{mode:"class",data:{signedParameters:this.componentSignedParams,settingId:i.id,selected:a,currentHeaders:r}}).then(function(){i.checked=a;n.reloadVariationGrid();n.getCardSettingsPopup().close();var t=a?e.Loc.getMessage("CPD_SETTING_ENABLED"):e.Loc.getMessage("CPD_SETTING_DISABLED");n.showNotification(t.replace("#NAME#",i.title),{category:"popup-settings"})})}},{key:"requestCardSettings",value:function t(i,a){var n=this;BX.ajax.runComponentAction(this.componentName,"setCardSetting",{mode:"class",data:{signedParameters:this.componentSignedParams,settingId:i.id,selected:a}}).then(function(){i.checked=a;if(i.id==="CATALOG_PARAMETERS"){var t=n.getEditorInstance().getControlByIdRecursive("catalog_parameters");if(t){t.refreshLayout()}}n.getCardSettingsPopup().close();var r=a?e.Loc.getMessage("CPD_SETTING_ENABLED"):e.Loc.getMessage("CPD_SETTING_DISABLED");n.showNotification(r.replace("#NAME#",i.title),{category:"popup-settings"})})}},{key:"onSliderMessage",value:function t(e){var i=e.getCompatData(),a=babelHelpers.slicedToArray(i,1),n=a[0];if(n.getEventId()==="Catalog.VariationCard::onCreate"||n.getEventId()==="Catalog.VariationCard::onUpdate"){this.reloadVariationGrid()}}},{key:"getVariationGridComponent",value:function t(){return e.Reflection.getClass("BX.Catalog.VariationGrid.Instance")}},{key:"reloadVariationGrid",value:function t(){var e=this.getVariationGridComponent();if(e){e.reloadGrid()}}},{key:"getVariationGridId",value:function t(){return this.variationGridId}},{key:"getVariationGrid",value:function t(){if(!e.Reflection.getClass("BX.Main.gridManager.getInstanceById")){return null}return BX.Main.gridManager.getInstanceById(this.getVariationGridId())}}]);return a}(a.EntityCard);e.Reflection.namespace("BX.Catalog").ProductCard=d})(this.window=this.window||{},BX,BX.Main,BX.Catalog.EntityCard,BX.Event);
//# sourceMappingURL=script.map.js