{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {ajax, Loc, Reflection} from 'main.core';\nimport {EventEmitter} from 'main.core.events'\n\nclass SectionSelector\n{\n\tconstructor(settings = {})\n\t{\n\t\tthis.selectorId = settings.selectorId;\n\t\tthis.selectorHiddenId = settings.selectorHiddenId;\n\t\tthis.selectedItems = settings.selectedItems;\n\t\tthis.iblockId = settings.iblockId;\n\n\t\tthis.initSelector();\n\t}\n\n\tinitSelector()\n\t{\n\t\tif (!this.selector)\n\t\t{\n\t\t\tthis.selector = new BX.UI.EntitySelector.TagSelector({\n\t\t\t\tid: this.selectorId,\n\t\t\t\tmultiple: true,\n\t\t\t\tplaceholder: Loc.getMessage('CATALOG_IBLOCKSECTIONFIELD_PLACEHOLDER'),\n\t\t\t\ttextBoxWidth: '100%',\n\t\t\t\tdialogOptions: {\n\t\t\t\t\theight: 300,\n\t\t\t\t\tid: this.selectorId,\n\t\t\t\t\tcontext: 'catalog-sections',\n\t\t\t\t\tenableSearch: false,\n\t\t\t\t\tmultiple: false,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tselectedItems: this.selectedItems,\n\t\t\t\t\tsearchTabOptions: {\n\t\t\t\t\t\tstub: true,\n\t\t\t\t\t\tstubOptions: {\n\t\t\t\t\t\t\ttitle: Loc.getMessage('CATALOG_IBLOCKSECTIONFIELD_IS_EMPTY_TITLE'),\n\t\t\t\t\t\t\tsubtitle: Loc.getMessage('CATALOG_IBLOCKSECTIONFIELD_IS_EMPTY_SUBTITLE'),\n\t\t\t\t\t\t\tarrow: true\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tsearchOptions: {\n\t\t\t\t\t\tallowCreateItem: true\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'Item:onSelect': this.setSelectedInputs.bind(this, 'Item:onSelect'),\n\t\t\t\t\t\t'Item:onDeselect': this.setSelectedInputs.bind(this, 'Item:onDeselect'),\n\t\t\t\t\t\t'Search:onItemCreateAsync': this.addNewSection.bind(this)\n\t\t\t\t\t},\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'section',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\t'iblockId': this.iblockId\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t\t\tdynamicLoad: true\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.selector.renderTo(document.getElementById(this.selectorId));\n\t}\n\n\tsetSelectedInputs(eventName, event)\n\t{\n\t\tevent.target.hide();\n\n\t\tconst selectedSections = event.getData().item.getDialog().getSelectedItems();\n\t\tif (Array.isArray(selectedSections))\n\t\t{\n\t\t\tlet htmlInputs = '';\n\t\t\tconst selectedItemsId = [];\n\n\t\t\tselectedSections.forEach((section) => {\n\t\t\t\thtmlInputs += '<input type=\"hidden\" name=\"IBLOCK_SECTION[]\" value=\"' + section['id'] + '\" />';\n\t\t\t\tselectedItemsId.push(section['id']);\n\t\t\t});\n\n\t\t\tdocument.getElementById(this.selectorHiddenId).innerHTML = htmlInputs;\n\t\t\tEventEmitter.emit(eventName, selectedItemsId);\n\t\t}\n\t}\n\n\taddNewSection(event)\n\t{\n\t\treturn new Promise(function(resolve, reject) {\n\n\t\t\t/** @type  {BX.UI.EntitySelector.Item} */\n\t\t\tconst {searchQuery} = event.getData();\n\n\t\t\t/** @type  {BX.UI.EntitySelector.Dialog} */\n\t\t\tconst dialog = event.getTarget();\n\n\t\t\tajax.runComponentAction(\n\t\t\t\t'bitrix:catalog.productcard.iblocksectionfield',\n\t\t\t\t'addSection',\n\t\t\t\t{\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tiblockId: this.iblockId,\n\t\t\t\t\t\tname: searchQuery.getQuery()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then(response => {\n\t\t\t\tconst item = dialog.addItem({\n\t\t\t\t\tid: response.data.id,\n\t\t\t\t\tentityId: 'tag',\n\t\t\t\t\ttitle: searchQuery.getQuery(),\n\t\t\t\t\ttabs: dialog.getRecentTab().getId()\n\t\t\t\t});\n\n\t\t\t\tif (item)\n\t\t\t\t{\n\t\t\t\t\titem.select();\n\t\t\t\t}\n\t\t\t}).bind(this);\n\n\t\t\tresolve();\n\t\t}.bind(this));\n\t}\n}\n\nReflection.namespace('BX.Catalog').SectionSelector = SectionSelector;"],"names":["SectionSelector","settings","selectorId","selectorHiddenId","selectedItems","iblockId","initSelector","selector","BX","UI","EntitySelector","TagSelector","id","multiple","placeholder","Loc","getMessage","textBoxWidth","dialogOptions","height","context","enableSearch","dropdownMode","searchTabOptions","stub","stubOptions","title","subtitle","arrow","searchOptions","allowCreateItem","events","setSelectedInputs","bind","addNewSection","entities","options","dynamicSearch","dynamicLoad","renderTo","document","getElementById","eventName","event","target","hide","selectedSections","getData","item","getDialog","getSelectedItems","Array","isArray","htmlInputs","selectedItemsId","forEach","section","push","innerHTML","EventEmitter","emit","Promise","resolve","reject","searchQuery","dialog","getTarget","ajax","runComponentAction","mode","data","name","getQuery","then","response","addItem","entityId","tabs","getRecentTab","getId","select","Reflection","namespace"],"mappings":"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"}