BX.namespace("BX.Catalog.SetConstructor");BX.Catalog.SetConstructor=function(){var t=function(t){this.numSliderItems=t.numSliderItems||0;this.numSetItems=t.numSetItems||0;this.jsId=t.jsId||"";this.ajaxPath=t.ajaxPath||"";this.currency=t.currency||"";this.lid=t.lid||"";this.iblockId=t.iblockId||"";this.basketUrl=t.basketUrl||"";this.setIds=t.setIds||null;this.offersCartProps=t.offersCartProps||null;this.itemsRatio=t.itemsRatio||null;this.noFotoSrc=t.noFotoSrc||"";this.messages=t.messages;this.canBuy=t.canBuy;this.mainElementPrice=t.mainElementPrice||0;this.mainElementOldPrice=t.mainElementOldPrice||0;this.mainElementDiffPrice=t.mainElementDiffPrice||0;this.mainElementBasketQuantity=t.mainElementBasketQuantity||1;this.parentCont=BX(t.parentContId)||null;this.sliderParentCont=this.parentCont.querySelector("[data-role='slider-parent-container']");this.sliderItemsCont=this.parentCont.querySelector("[data-role='set-other-items']");this.setItemsCont=this.parentCont.querySelector("[data-role='set-items']");this.setPriceCont=this.parentCont.querySelector("[data-role='set-price']");this.setPriceDuplicateCont=this.parentCont.querySelector("[data-role='set-price-duplicate']");this.setOldPriceCont=this.parentCont.querySelector("[data-role='set-old-price']");this.setOldPriceRow=this.setOldPriceCont.parentNode.parentNode;this.setDiffPriceCont=this.parentCont.querySelector("[data-role='set-diff-price']");this.setDiffPriceRow=this.setDiffPriceCont.parentNode.parentNode;this.notAvailProduct=this.sliderItemsCont.querySelector("[data-not-avail='yes']");this.emptySetMessage=this.parentCont.querySelector("[data-set-message='empty-set']");BX.bindDelegate(this.setItemsCont,"click",{attribute:"data-role"},BX.proxy(this.deleteFromSet,this));BX.bindDelegate(this.sliderItemsCont,"click",{attribute:"data-role"},BX.proxy(this.addToSet,this));var e=this.parentCont.querySelector("[data-role='set-buy-btn']");if(this.canBuy){BX.show(e);BX.bind(e,"click",BX.proxy(this.addToBasket,this))}else{BX.hide(e)}this.generateSliderStyles()};t.prototype.generateSliderStyles=function(){var t=BX.create("style",{html:".catalog-set-constructor-slider-slide-"+this.jsId+"{width: "+this.numSliderItems*25+"%;}"+".catalog-set-constructor-slider-item-container-"+this.jsId+"{width: "+100/this.numSliderItems+"%;}"+"@media (max-width:767px){"+".catalog-set-constructor-slider-slide-"+this.jsId+"{width: "+this.numSliderItems*20*3+"%;}}",attrs:{id:"bx-set-const-style-"+this.jsId}});if(BX("bx-set-const-style-"+this.jsId)){BX.remove(BX("bx-set-const-style-"+this.jsId))}this.parentCont.appendChild(t)};t.prototype.deleteFromSet=function(){var t=BX.proxy_context,e,i,s,a,r,n,c,o,l,d,h,m,u,p,g;if(t&&t.hasAttribute("data-role")&&t.getAttribute("data-role")=="set-delete-btn"){e=t.parentNode.parentNode;i=e.getAttribute("data-id");s=e.getAttribute("data-name");a=e.getAttribute("data-url");r=e.getAttribute("data-img");n=e.getAttribute("data-print-price");c=e.getAttribute("data-price");o=e.getAttribute("data-print-old-price");l=e.getAttribute("data-old-price");d=e.getAttribute("data-diff-price");h=e.getAttribute("data-measure");m=e.getAttribute("data-quantity");g=BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item-container catalog-set-constructor-slider-item-container-"+this.jsId,"data-id":i,"data-img":r?r:"","data-url":a,"data-name":s,"data-print-price":n,"data-print-old-price":o,"data-price":c,"data-old-price":l,"data-diff-price":d,"data-measure":h,"data-quantity":m},children:[BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item"},children:[BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item-img"},children:[BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item-img-container"},children:[BX.create("img",{attrs:{src:r?r:this.noFotoSrc,className:"img-responsive"}})]})]}),BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item-title"},children:[BX.create("a",{attrs:{href:a},html:s})]}),BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item-price"},children:[BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item-price-new"},html:n+" * "+m+h}),BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item-price-old"},html:c!=l?o:""})]}),BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item-add-btn"},children:[BX.create("a",{attrs:{className:"btn btn-default btn-sm","data-role":"set-add-btn"},html:this.messages.ADD_BUTTON})]})]})]});if(!!this.notAvailProduct)this.sliderItemsCont.insertBefore(g,this.notAvailProduct);else this.sliderItemsCont.appendChild(g);this.numSliderItems++;this.numSetItems--;this.generateSliderStyles();BX.remove(e);for(u=0,p=this.setIds.length;u<p;u++){if(this.setIds[u]==i)this.setIds.splice(u,1)}this.recountPrice();if(this.numSetItems<=0&&!!this.emptySetMessage)BX.adjust(this.emptySetMessage,{style:{display:"inline-block"},html:this.messages.EMPTY_SET});if(this.numSliderItems>0&&this.sliderParentCont){this.sliderParentCont.style.display=""}}};t.prototype.addToSet=function(){var t=BX.proxy_context,e,i,s,a,r,n,c,o,l,d,h,m,u;if(!!t&&t.hasAttribute("data-role")&&t.getAttribute("data-role")=="set-add-btn"){e=t.parentNode.parentNode.parentNode;i=e.getAttribute("data-id");s=e.getAttribute("data-name");a=e.getAttribute("data-url");r=e.getAttribute("data-img");n=e.getAttribute("data-print-price");c=e.getAttribute("data-price");o=e.getAttribute("data-print-old-price");l=e.getAttribute("data-old-price");d=e.getAttribute("data-diff-price");h=e.getAttribute("data-measure");m=e.getAttribute("data-quantity");u=BX.create("tr",{attrs:{"data-id":i,"data-img":r?r:"","data-url":a,"data-name":s,"data-print-price":n,"data-print-old-price":o,"data-price":c,"data-old-price":l,"data-diff-price":d,"data-measure":h,"data-quantity":m},children:[BX.create("td",{attrs:{className:"catalog-set-constructor-items-list-table-cell-img"},children:[BX.create("img",{attrs:{src:r?r:this.noFotoSrc,className:"img-responsive"}})]}),BX.create("td",{attrs:{className:"catalog-set-constructor-items-list-table-cell-name"},children:[BX.create("a",{attrs:{href:a},html:s})]}),BX.create("td",{attrs:{className:"catalog-set-constructor-items-list-table-cell-price"},children:[BX.create("span",{attrs:{className:"catalog-set-constructor-product-new-price"},html:n+" * "+m+h}),BX.create("br"),BX.create("span",{attrs:{className:"catalog-set-constructor-product-old-price"},html:c!=l?o:""})]}),BX.create("td",{attrs:{className:"catalog-set-constructor-items-list-table-cell-del"},children:[BX.create("div",{attrs:{className:"catalog-set-constructor-items-list-table-cell-delete-btn","data-role":"set-delete-btn"}})]})]});this.setItemsCont.appendChild(u);this.numSliderItems--;this.numSetItems++;this.generateSliderStyles();BX.remove(e);this.setIds.push(i);this.recountPrice();if(this.numSetItems>0&&!!this.emptySetMessage)BX.adjust(this.emptySetMessage,{style:{display:"none"},html:""});if(this.numSliderItems<=0&&this.sliderParentCont){this.sliderParentCont.style.display="none"}}};t.prototype.recountPrice=function(){var t=this.mainElementPrice*this.mainElementBasketQuantity,e=this.mainElementOldPrice*this.mainElementBasketQuantity,i=this.mainElementDiffPrice*this.mainElementBasketQuantity,s=BX.findChildren(this.setItemsCont,{tagName:"tr"},true),a,r,n;if(s){for(a=0,r=s.length;a<r;a++){n=Number(s[a].getAttribute("data-quantity"))||1;t+=Number(s[a].getAttribute("data-price"))*n;e+=Number(s[a].getAttribute("data-old-price"))*n;i+=Number(s[a].getAttribute("data-diff-price"))*n}}this.setPriceCont.innerHTML=BX.Currency.currencyFormat(t,this.currency,true);this.setPriceDuplicateCont.innerHTML=BX.Currency.currencyFormat(t,this.currency,true);if(Math.floor(i*100)>0){this.setOldPriceCont.innerHTML=BX.Currency.currencyFormat(e,this.currency,true);this.setDiffPriceCont.innerHTML=BX.Currency.currencyFormat(i,this.currency,true);BX.style(this.setOldPriceRow,"display","table-row");BX.style(this.setDiffPriceRow,"display","table-row")}else{BX.style(this.setOldPriceRow,"display","none");BX.style(this.setDiffPriceRow,"display","none");this.setOldPriceCont.innerHTML="";this.setDiffPriceCont.innerHTML=""}};t.prototype.addToBasket=function(){var t=BX.proxy_context;BX.showWait(t.parentNode);BX.ajax.post(this.ajaxPath,{sessid:BX.bitrix_sessid(),action:"catalogSetAdd2Basket",set_ids:this.setIds,lid:this.lid,iblockId:this.iblockId,setOffersCartProps:this.offersCartProps,itemsRatio:this.itemsRatio},BX.proxy(function(t){BX.closeWait();document.location.href=this.basketUrl},this))};return t}();