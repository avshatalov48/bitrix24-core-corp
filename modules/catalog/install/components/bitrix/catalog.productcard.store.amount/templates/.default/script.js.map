{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Dom, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {EventEmitter, Event} from 'main.core.events'\nclass ProductStoreGridManager\n{\n\tgrid = null;\n\ttotalWrapper = null;\n\n\tconstructor(settings = {})\n\t{\n\t\tthis.gridId = settings.gridId;\n\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\tthis.signedParameters = settings.signedParameters;\n\t\tthis.totalWrapperId = settings.totalWrapperId || null;\n\t\tthis.inventoryManagementLink = settings.inventoryManagementLink || null;\n\n\t\tif (this.totalWrapperId)\n\t\t{\n\t\t\tthis.totalWrapper = BX(this.totalWrapperId);\n\t\t\tthis.refreshTotalWrapper();\n\t\t}\n\n\t\tthis.subscribeEvents();\n\t}\n\n\tsubscribeEvents()\n\t{\n\t\tthis.onGridUpdatedHandler = this.onGridUpdated.bind(this);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t}\n\n\tonGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.refreshTotalWrapper();\n\t}\n\n\tgetGridId()\n\t{\n\t\treturn this.gridId;\n\t}\n\n\treloadGrid()\n\t{\n\t\tif (this.grid)\n\t\t{\n\t\t\tthis.grid.reload();\n\t\t}\n\t}\n\n\tsetTotalData(totalData)\n\t{\n\t\tfor (var propertyId in totalData)\n\t\t{\n\t\t\tif (totalData.hasOwnProperty(propertyId))\n\t\t\t{\n\t\t\t\tthis.setTotalDataBySelector(`#${propertyId}`, totalData[propertyId]);\n\t\t\t}\n\t\t}\n\t}\n\n\tsetTotalDataBySelector(selector, data)\n\t{\n\t\tif (this.totalWrapper)\n\t\t{\n\t\t\tvar totalWrapperItem = this.totalWrapper.querySelector(selector);\n\n\t\t\tif (totalWrapperItem)\n\t\t\t{\n\t\t\t\ttotalWrapperItem.innerHTML = data;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\thideTotalData()\n\t{\n\t\tBX.hide(this.totalWrapper);\n\t}\n\n\tshowTotalData()\n\t{\n\t\tBX.show(this.totalWrapper);\n\t}\n\n\trefreshTotalWrapper()\n\t{\n\t\tif (this.totalWrapper)\n\t\t{\n\t\t\t//this.grid.tableFade();\n\t\t\tBX.ajax.runComponentAction(\n\t\t\t\t'bitrix:catalog.productcard.store.amount',\n\t\t\t\t'getStoreAmountTotal',\n\t\t\t\t{\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then(response => {\n\t\t\t\tconst amount = response.data.AMOUNT || '';\n\t\t\t\tconst quantity = response.data.QUANTITY || '';\n\t\t\t\tconst quantityReserved = response.data.QUANTITY_RESERVED || '';\n\t\t\t\tconst quantityCommon = response.data.QUANTITY_COMMON || '';\n\n\t\t\t\tif (amount || quantity || quantityCommon || quantityReserved)\n\t\t\t\t{\n\t\t\t\t\tvar totalData = {\n\t\t\t\t\t\t'total_amount': amount,\n\t\t\t\t\t\t'total_quantity': quantity,\n\t\t\t\t\t\t'total_quantity_common': quantityCommon,\n\t\t\t\t\t\t'total_quantity_reserved': quantityReserved,\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.setTotalData(totalData);\n\n\t\t\t\t\tif (BX.isNodeHidden(this.totalWrapper))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showTotalData();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.hideTotalData();\n\t\t\t\t}\n\t\t\t\t//this.grid.tableUnfade();\n\t\t\t});\n\t\t}\n\t}\n\n\topenInventoryManagementSlider()\n\t{\n\t\tif (this.inventoryManagementLink)\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(this.inventoryManagementLink,\n\t\t\t\t{\n\t\t\t\t\tcacheable: false,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\topenGridOnDone: false,\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonCloseComplete: function(event) {\n\t\t\t\t\t\t\tlet slider = event.getSlider();\n\t\t\t\t\t\t\tif (!slider)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (slider.getData().get('isInventoryManagementEnabled'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\twindow.top.location.reload();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n}\n\nReflection.namespace('BX.Catalog').ProductStoreGridManager = ProductStoreGridManager;"],"names":["ProductStoreGridManager","settings","gridId","grid","BX","Main","gridManager","getInstanceById","signedParameters","totalWrapperId","inventoryManagementLink","totalWrapper","refreshTotalWrapper","subscribeEvents","onGridUpdatedHandler","onGridUpdated","bind","EventEmitter","subscribe","event","getCompatData","eventArgs","getId","getGridId","reload","totalData","propertyId","hasOwnProperty","setTotalDataBySelector","selector","data","totalWrapperItem","querySelector","innerHTML","hide","show","ajax","runComponentAction","mode","then","response","amount","AMOUNT","quantity","QUANTITY","quantityReserved","QUANTITY_RESERVED","quantityCommon","QUANTITY_COMMON","setTotalData","isNodeHidden","showTotalData","hideTotalData","SidePanel","Instance","open","cacheable","openGridOnDone","events","onCloseComplete","slider","getSlider","getData","get","window","top","location","Reflection","namespace"],"mappings":"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"}