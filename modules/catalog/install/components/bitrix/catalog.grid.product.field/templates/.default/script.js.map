{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Dom, Reflection, Type} from \"main.core\";\nimport type {BaseEvent} from \"main.core.events\";\nimport {EventEmitter} from \"main.core.events\";\nimport {ProductSelector} from 'catalog.product-selector';\n\nclass ProductField\n{\n\tstatic EDIT_CLASS = 'catalog-grid-product-field-edit';\n\tstatic PRODUCT_MODE = 'product';\n\tstatic SKU_MODE = 'sku';\n\n\tconstructor(id, settings = {})\n\t{\n\t\tthis.selector = new ProductSelector(id, settings);\n\t\tthis.componentName = settings.componentName || '';\n\t\tthis.signedParameters = settings.signedParameters || '';\n\t\tthis.rowIdMask = settings.rowIdMask || '#ID#';\n\n\t\tEventEmitter.subscribe('Grid::thereEditedRows', this.onSelectEdit.bind(this));\n\t\tEventEmitter.subscribe('Grid::noEditedRows', this.onCancelEdit.bind(this));\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequest.bind(this));\n\t}\n\n\tgetSelector(): ProductSelector\n\t{\n\t\treturn this.selector;\n\t}\n\n\tonBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst wrapper = this.getSelector().getWrapper();\n\t\tif (!wrapper)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst [, gridData] = event.getData();\n\t\tconst submitData = BX.prop.get(gridData, 'data', {});\n\t\tif (!submitData.FIELDS)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet productId = this.getSelector().getModel().getProductId();\n\t\tproductId = this.rowIdMask.replace('#ID#', productId);\n\n\t\tsubmitData.FIELDS[productId] = submitData.FIELDS[productId] || {};\n\n\t\tconst imageInputContainer = wrapper.querySelector('.ui-image-input-container');\n\t\tif (imageInputContainer)\n\t\t{\n\t\t\tconst inputs = imageInputContainer.querySelectorAll('input');\n\t\t\tconst values = {};\n\t\t\tconst newFilesRegExp = new RegExp(/([0-9A-Za-z_]+?(_n\\d+)*)\\[([A-Za-z_]+)\\]/);\n\t\t\tfor (let inputItem of inputs)\n\t\t\t{\n\t\t\t\tif (newFilesRegExp.test(inputItem.name))\n\t\t\t\t{\n\t\t\t\t\tlet [, fileCounter, code, fileSetting] = inputItem.name.match(newFilesRegExp);\n\t\t\t\t\tif (fileCounter && fileSetting)\n\t\t\t\t\t{\n\t\t\t\t\t\tvalues[fileCounter] = values[fileCounter] || {};\n\t\t\t\t\t\tvalues[fileCounter][fileSetting] = inputItem.value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvalues[inputItem.name] = inputItem.value;\n\t\t\t\t}\n\t\t\t}\n\t\t\tsubmitData.FIELDS[productId] = submitData.FIELDS[productId] || {};\n\t\t\tif (Object.keys(values).length > 0)\n\t\t\t{\n\t\t\t\tsubmitData.FIELDS[productId]['MORE_PHOTO'] = values;\n\t\t\t}\n\t\t}\n\n\t\tconst productNameInput = wrapper.querySelector('input[name=\"NAME\"]');\n\t\tif (productNameInput)\n\t\t{\n\t\t\tsubmitData.FIELDS[productId]['NAME'] = productNameInput.value;\n\t\t}\n\t}\n\n\tonCancelEdit()\n\t{\n\t\tthis.getSelector().setMode(BX.Catalog.ProductSelector.MODE_VIEW);\n\t\tthis.getSelector().clearLayout();\n\t\tthis.getSelector().layout();\n\n\t\tconst grid = BX.Main.gridManager.getInstanceById(this.getSelector().getConfig('GRID_ID'));\n\t\tif (!grid)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst row = grid.getRows().getById(this.selector.getConfig('ROW_ID'));\n\t\tif (!row)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst cell = row.getCellById('CATALOG_PRODUCT');\n\t\tif (cell)\n\t\t{\n\t\t\tDom.removeClass(row.getContentContainer(cell), ProductField.EDIT_CLASS);\n\t\t}\n\t}\n\n\tonSelectEdit()\n\t{\n\t\tif (!this.getSelector().getConfig('GRID_ID', null))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst grid = BX.Main.gridManager.getInstanceById(this.getSelector().getConfig('GRID_ID'));\n\t\tif (!grid)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst row = grid.getRows().getById(this.selector.getConfig('ROW_ID'));\n\t\tif (row && row.isEdit())\n\t\t{\n\t\t\tthis.getSelector().setMode(BX.Catalog.ProductSelector.MODE_EDIT);\n\t\t\tthis.getSelector().clearLayout();\n\t\t\tthis.getSelector().layout();\n\n\t\t\tconst cell = row.getCellById('CATALOG_PRODUCT');\n\t\t\tif (cell)\n\t\t\t{\n\t\t\t\tDom.addClass(row.getContentContainer(cell), ProductField.EDIT_CLASS);\n\t\t\t}\n\t\t}\n\t}\n}\n\nReflection.namespace('BX.Catalog.Grid').ProductField = ProductField;"],"names":["ProductField","id","settings","selector","ProductSelector","componentName","signedParameters","rowIdMask","EventEmitter","subscribe","onSelectEdit","bind","onCancelEdit","onBeforeGridRequest","event","wrapper","getSelector","getWrapper","getData","gridData","submitData","BX","prop","get","FIELDS","productId","getModel","getProductId","replace","imageInputContainer","querySelector","inputs","querySelectorAll","values","newFilesRegExp","RegExp","inputItem","test","name","match","fileCounter","code","fileSetting","value","Object","keys","length","productNameInput","setMode","Catalog","MODE_VIEW","clearLayout","layout","grid","Main","gridManager","getInstanceById","getConfig","row","getRows","getById","cell","getCellById","Dom","removeClass","getContentContainer","EDIT_CLASS","isEdit","MODE_EDIT","addClass","Reflection","namespace"],"mappings":"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"}