this.BX=this.BX||{};this.BX.Catalog=this.BX.Catalog||{};this.BX.Catalog.Store=this.BX.Catalog.Store||{};(function(e,t,i,r,n,a,s,o,l,u,d,c){"use strict";s=s&&s.hasOwnProperty("default")?s["default"]:s;var h;var v=function(){function e(t){babelHelpers.classCallCheck(this,e);this.editor=t}babelHelpers.createClass(e,[{key:"load",value:function e(i,r){if(!this.hintPopup){this.hintPopup=new t.Popup("ui-hint-popup-"+this.editor.getId(),null,{darkMode:true,closeIcon:true,animation:"fading-slide"})}this.hintPopup.setBindElement(i);this.hintPopup.adjustPosition();this.hintPopup.setContent(l.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(["\n\t\t\t<div class='ui-hint-content'>","</div>\n\t\t"])),l.Text.encode(r)));return this.hintPopup}},{key:"show",value:function e(){if(this.hintPopup){this.hintPopup.show()}}},{key:"close",value:function e(){if(this.hintPopup){this.hintPopup.close()}}}]);return e}();function f(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function g(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?f(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):f(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function p(e,t,i){E(e,t);t.set(e,i)}function E(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var y=new WeakMap;var b=function(){function e(t){babelHelpers.classCallCheck(this,e);p(this,y,{writable:true,value:{basePrice:0,finalPrice:0,extra:null,extraType:e.EXTRA_TYPE_PERCENTAGE}});babelHelpers.classPrivateFieldSet(this,y,g(g({},babelHelpers.classPrivateFieldGet(this,y)),t))}babelHelpers.createClass(e,[{key:"getBasePrice",value:function e(){return babelHelpers.classPrivateFieldGet(this,y).basePrice}},{key:"getFinalPrice",value:function e(){return babelHelpers.classPrivateFieldGet(this,y).finalPrice}},{key:"getExtra",value:function e(){return babelHelpers.classPrivateFieldGet(this,y).extra}},{key:"getExtraType",value:function e(){return babelHelpers.classPrivateFieldGet(this,y).extraType}},{key:"calculateBasePrice",value:function t(i){babelHelpers.classPrivateFieldGet(this,y).basePrice=i;babelHelpers.classPrivateFieldGet(this,y).extra=l.Text.toNumber(babelHelpers.classPrivateFieldGet(this,y).extra);if(babelHelpers.classPrivateFieldGet(this,y).extraType===e.EXTRA_TYPE_MONETARY){babelHelpers.classPrivateFieldGet(this,y).finalPrice=babelHelpers.classPrivateFieldGet(this,y).basePrice+babelHelpers.classPrivateFieldGet(this,y).extra}else{babelHelpers.classPrivateFieldGet(this,y).finalPrice=babelHelpers.classPrivateFieldGet(this,y).basePrice*(1+babelHelpers.classPrivateFieldGet(this,y).extra/100)}return this}},{key:"calculateFinalPrice",value:function t(i){babelHelpers.classPrivateFieldGet(this,y).finalPrice=i;var r=l.Text.toNumber(babelHelpers.classPrivateFieldGet(this,y).basePrice);if(r<=0){babelHelpers.classPrivateFieldGet(this,y).extraType=e.EXTRA_TYPE_MONETARY}if(babelHelpers.classPrivateFieldGet(this,y).extraType===e.EXTRA_TYPE_MONETARY){babelHelpers.classPrivateFieldGet(this,y).extra=babelHelpers.classPrivateFieldGet(this,y).finalPrice-r}else{babelHelpers.classPrivateFieldGet(this,y).extra=(babelHelpers.classPrivateFieldGet(this,y).finalPrice/r-1)*100}return this}},{key:"calculateExtra",value:function e(t){babelHelpers.classPrivateFieldGet(this,y).extra=t;if(l.Type.isNil(t)){return this}return this.calculateBasePrice(babelHelpers.classPrivateFieldGet(this,y).basePrice)}},{key:"calculateExtraType",value:function t(i){if(i!==e.EXTRA_TYPE_MONETARY){i=e.EXTRA_TYPE_PERCENTAGE}babelHelpers.classPrivateFieldGet(this,y).extraType=i;return this.calculateFinalPrice(babelHelpers.classPrivateFieldGet(this,y).finalPrice)}}]);return e}();babelHelpers.defineProperty(b,"EXTRA_TYPE_PERCENTAGE",1);babelHelpers.defineProperty(b,"EXTRA_TYPE_MONETARY",2);var S;var m=function(){function e(t){babelHelpers.classCallCheck(this,e);this.text=t.text||l.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_TEXT");this.hint=t.hint;this.isReadOnly=t.isReadOnly===true}babelHelpers.createClass(e,[{key:"renderTo",value:function e(t){var i=this.isReadOnly?"ui-ctl-no-border catalog-document-product-list-access-denied-readonly":"ui-ctl-disabled catalog-document-product-list-access-denied";var r=l.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['\n\t\t<div\n\t\t\tclass="ui-ctl ui-ctl-w100 ui-ctl-before-icon ui-ctl-after-icon ','"\n\t\t\tdata-hint="','"\n\t\t\tdata-hint-no-icon\n\t\t>\n\t\t\t<div class="ui-ctl-before catalog-document-product-list-access-denied-lock"></div>\n\t\t\t<div class="ui-ctl-after catalog-document-product-list-access-denied-hint"></div>\n\t\t\t<div class="ui-ctl-element">',"</div>\n\t\t</div>\n\t\t"])),i,this.hint,this.text);t.innerHTML="";t.appendChild(r);BX.UI.Hint.createInstance({popupParameters:{angle:{offset:100}}}).init()}}]);return e}();var P,C,T;function I(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=A(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var r=0;var n=function e(){};return{s:n,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,s=false,o;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();a=t.done;return t},e:function e(t){s=true;o=t},f:function e(){try{if(!a&&i["return"]!=null)i["return"]()}finally{if(s)throw o}}}}function A(e,t){if(!e)return;if(typeof e==="string")return R(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return R(e,t)}function R(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,r=new Array(t);i<t;i++){r[i]=e[i]}return r}function _(e,t){F(e,t);t.add(e)}function F(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function k(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var O="EDIT";var w="SET";var N=new WeakSet;var D=new WeakSet;var H=new WeakSet;var B=new WeakSet;var M=new WeakSet;var U=new WeakSet;var L=new WeakSet;var G=new WeakSet;var x=new WeakSet;var V=new WeakSet;var W=new WeakSet;var X=new WeakSet;var q=new WeakSet;var j=new WeakSet;var Y=new WeakSet;var K=new WeakSet;var Q=new WeakSet;var z=new WeakSet;var $=new WeakSet;var Z=new WeakSet;var J=new WeakSet;var ee=new WeakSet;var te=new WeakSet;var ie=function(){function e(t,i,r,n){babelHelpers.classCallCheck(this,e);_(this,te);_(this,ee);_(this,J);_(this,Z);_(this,$);_(this,z);_(this,Q);_(this,K);_(this,Y);_(this,j);_(this,q);_(this,X);_(this,W);_(this,V);_(this,x);_(this,G);_(this,L);_(this,U);_(this,M);_(this,B);_(this,H);_(this,D);_(this,N);babelHelpers.defineProperty(this,"fields",{});babelHelpers.defineProperty(this,"storeSelectors",[]);babelHelpers.defineProperty(this,"externalActions",[]);babelHelpers.defineProperty(this,"cache",new l.Cache.MemoryCache);babelHelpers.defineProperty(this,"modeChanges",{EDIT:O,SET:w});babelHelpers.defineProperty(this,"validatingFields",new Map);this.setId(t);this.setSettings(r);this.setEditor(n);this.setModel(i,r);this.initFields(i);k(this,D,ne).call(this);k(this,H,ae).call(this);k(this,M,se).call(this,this.getSettingValue("storeHeaderMap",{}));k(this,N,re).call(this);k(this,J,Pe).call(this);requestAnimationFrame(this.initHandlers.bind(this))}babelHelpers.createClass(e,[{key:"getNode",value:function e(){var t=this;return this.cache.remember("node",(function(){var e=t.getField("ID",0);return t.getEditorContainer().querySelector('[data-id="'+e+'"]')}))}},{key:"getSelector",value:function e(){return this.mainSelector}},{key:"getBarcodeSelector",value:function e(){return this.barcodeSelector}},{key:"getId",value:function e(){return this.id}},{key:"setId",value:function e(t){this.id=t}},{key:"getSettings",value:function e(){return this.settings}},{key:"setSettings",value:function e(t){this.settings=l.Type.isPlainObject(t)?t:{}}},{key:"getSettingValue",value:function e(t,i){return this.settings.hasOwnProperty(t)?this.settings[t]:i}},{key:"setSettingValue",value:function e(t,i){this.settings[t]=i}},{key:"setEditor",value:function e(t){this.editor=t}},{key:"getEditor",value:function e(){return this.editor}},{key:"getEditorContainer",value:function e(){return this.getEditor().getContainer()}},{key:"getHintPopup",value:function e(){return this.getEditor().getHintPopup()}},{key:"initHandlers",value:function e(){var t=this.getEditor();this.getNode().querySelectorAll("input").forEach((function(e){l.Event.bind(e,"input",t.changeProductFieldHandler);l.Event.bind(e,"change",t.changeProductFieldHandler);l.Event.bind(e,"mousedown",(function(e){return e.stopPropagation()}));l.Event.bind(e,"blur",t.blurProductFieldHandler)}));this.getNode().querySelectorAll("select").forEach((function(e){l.Event.bind(e,"change",t.changeProductFieldHandler);l.Event.bind(e,"mousedown",(function(e){return e.stopPropagation()}))}))}},{key:"initHandlersForSelectors",value:function e(){var t=this;var i=this.getEditor();var r=["MAIN_INFO","BARCODE_INFO"];var n=this.getSettingValue("storeHeaderMap",{});r=[].concat(babelHelpers.toConsumableArray(r),babelHelpers.toConsumableArray(Object.keys(n)));r.forEach((function(e){t.getNode().querySelectorAll('[data-name="'+e+'"] input[type="text"]').forEach((function(e){l.Event.bind(e,"input",i.changeProductFieldHandler);l.Event.bind(e,"change",i.changeProductFieldHandler);l.Event.bind(e,"mousedown",(function(e){return e.stopPropagation()}))}))}))}},{key:"layoutBarcode",value:function e(){var t=this.getNode().querySelector('[data-name="BARCODE_INFO"]');if(this.barcodeSelector&&t){t.innerHTML="";if(k(this,$,Se).call(this)){this.barcodeSelector.renderTo(t)}}}},{key:"layoutStoreSelector",value:function e(t){var i=this;Object.keys(t).forEach((function(e){var t=i.getId()+"_"+e;i.storeSelectors.forEach((function(r){if(r.getId()===t){var n=i.getNode().querySelector('[data-name="'+e+'"]');if(n){n.innerHTML="";if(k(i,z,be).call(i)){r.renderTo(n)}}}}))}))}},{key:"setRowNumber",value:function e(t){this.getNode().querySelectorAll(".main-grid-row-number").forEach((function(e){e.textContent=t+"."}))}},{key:"getFields",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var i;if(!l.Type.isArrayFilled(t)){i=l.Runtime.clone(this.fields)}else{i={};var r=I(t),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;i[a]=this.getField(a)}}catch(e){r.e(e)}finally{r.f()}}var s=k(this,L,le).call(this);for(var o in s){if(Object.hasOwnProperty.call(s,o)&&Object.hasOwnProperty.call(i,o)){i[o]=s[o]}}return i}},{key:"initFields",value:function e(t){this.getModel().initFields(t,false);this.setFields(t)}},{key:"setFields",value:function e(t){for(var i in t){if(t.hasOwnProperty(i)){this.setField(i,t[i])}}}},{key:"getField",value:function e(t,i){if(t!=="REAL_VALUES"){var r=k(this,L,le).call(this);if(r&&Object.hasOwnProperty.call(r,t)){return r[t]}}return this.fields.hasOwnProperty(t)?this.fields[t]:i}},{key:"setField",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;this.fields[t]=i;if(r){this.getModel().setField(t,i)}}},{key:"getUiFieldId",value:function e(t){return this.getId()+"_"+t}},{key:"getBasePrice",value:function e(){return this.getField("BASE_PRICE",0)}},{key:"getAmount",value:function e(){return this.getField("AMOUNT",1)}},{key:"updateFieldByEvent",value:function e(t,i){var r=i.target;var n=r.type==="checkbox"?r.checked:r.value;var a=i.type==="input"||i.type==="change"?O:w;this.updateField(t,n,a)}},{key:"updateDropdownField",value:function e(t,i){this.updateField(t,i,O)}},{key:"updateField",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:w;this.resetExternalActions();this.updateFieldValue(t,i,r);this.executeExternalActions()}},{key:"updateFieldValue",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:w;switch(t){case"SKU_ID":this.changeProductId(i);break;case"BASE_PRICE":this.changeBasePrice(i,r);break;case"PURCHASING_PRICE":this.changePurchasingPrice(i,r);break;case"AMOUNT":this.changeAmount(i,r);break;case"MEASURE_CODE":this.changeMeasureCode(i,r);break;case"BARCODE":this.changeBarcode(i,r);break;case"STORE_FROM":case"STORE_TO":this.changeStore(i,t);break;case"STORE_FROM_TITLE":case"STORE_TO_TITLE":this.changeStoreName(i,t);break;case"NAME":case"MAIN_INFO":this.changeProductName(i,r);break;case"SORT":this.changeSort(i,r);break}}},{key:"updateFieldByName",value:function e(t,i){switch(t){case"TAX_INCLUDED":this.setTaxIncluded(i);break}}},{key:"changeProductId",value:function e(t){var i=this.parseInt(t);this.setProductId(i)}},{key:"handleCopyAction",value:function e(t,i){var r;(r=this.getEditor())===null||r===void 0?void 0:r.copyRow(this);var n=i.getMenuWindow();if(n){n.destroy()}}},{key:"handleDeleteAction",value:function e(t,i){var r;(r=this.getEditor())===null||r===void 0?void 0:r.deleteRow(this);var n=i.getMenuWindow();if(n){n.destroy()}this.unsubscribeEvents();k(this,x,de).call(this)}},{key:"unsubscribeEvents",value:function e(){this.getBarcodeSelector().unsubscribeEvents()}},{key:"handleSelectExtraPriceType",value:function e(t,i){this.changeExtraType(i.type,O);var r=i.getMenuWindow();if(r){r.destroy()}}},{key:"changeExtraType",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;var r="%";if(t===b.EXTRA_TYPE_MONETARY){r=this.getEditor().getCurrencyText()}else{t=b.EXTRA_TYPE_PERCENTAGE}if(t===this.getField("BASE_PRICE_EXTRA_RATE")){return}if(i===O){var n=k(this,G,ue).call(this).calculateExtraType(t);this.changeExtra(n.getExtra());this.changeBasePrice(n.getFinalPrice())}var a=this.getNode().querySelector('[data-name="BASE_PRICE_EXTRA_RATE"]');if(l.Type.isDomNode(a)){a.innerHTML=r}this.setField("BASE_PRICE_EXTRA_RATE",t)}},{key:"changeExtra",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;var r=l.Type.isNil(t)||t===""?null:this.parseFloat(t,this.getPricePrecision());this.setField("BASE_PRICE_EXTRA",r);if(r===null){return}if(i===O){var n=k(this,G,ue).call(this).calculateExtra(r);this.changeBasePrice(n.getFinalPrice())}else{var a=this.getNode().querySelector('[data-name="BASE_PRICE_EXTRA"]');if(l.Type.isDomNode(a)){a.value=r}}}},{key:"changeBasePrice",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;var r=this.parseFloat(t,this.getPricePrecision());this.setBasePrice(r,i)}},{key:"changePurchasingPrice",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;if(k(this,ee,Ce).call(this)){return}var r=this.parseFloat(t,this.getPricePrecision());this.setPurchasingPrice(r,i)}},{key:"changeAmount",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;var r=this.parseFloat(t,this.getQuantityPrecision());this.setAmount(r,i)}},{key:"changeMeasureCode",value:function e(t){var i=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;this.getEditor().getMeasures().filter((function(e){return e.CODE===t})).forEach((function(e){return i.setMeasure(e,r)}))}},{key:"changeBarcode",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;var r=t.toString();var n=this.getField("BARCODE")!==r;if(n&&i===w){this.setField("BARCODE",r);this.setField("DOC_BARCODE",r);this.addActionProductChange()}else if(i===O){this.setField("DOC_BARCODE",r);this.addActionProductChange()}}},{key:"changeStore",value:function e(t,i){var r=l.Text.toNumber(t);var n=this.getField(i)!==r;if(n){this.setField(i,r);this.setStoreAmount(t,i);this.layoutStoreSelector(this.getSettingValue("storeHeaderMap",{}));this.addActionProductChange()}}},{key:"changeStoreName",value:function e(t,i){var r=t.toString();this.setField(i,r);this.addActionProductChange()}},{key:"changeProductName",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;var r=t.toString();var n=this.getField("NAME")!==r;if(n&&i===w){this.setField("NAME",r);this.addActionProductChange()}}},{key:"changeSort",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;var r=this.parseInt(t);if(i===w){this.setField("SORT",r)}var n=this.getField("SORT")!==r;if(n){this.addActionProductChange()}}},{key:"refreshFieldsLayout",value:function e(){var t,i,r;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];for(var a in this.fields){if(this.fields.hasOwnProperty(a)&&!n.includes(a)){this.updateUiField(a,this.fields[a])}}this.updateUiMeasure(this.getField("MEASURE_CODE"),this.getField("MEASURE_NAME"));(t=this.getSelector())===null||t===void 0?void 0:t.reloadFileInput();(i=this.getSelector())===null||i===void 0?void 0:i.layout();(r=this.getBarcodeSelector())===null||r===void 0?void 0:r.layout();this.updateUiStoreValues()}},{key:"setModel",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var r="catalog_document_grid_"+this.getId();if(r){var n=o.ProductModel.getById(r);if(n){this.model=n}}if(!(this.model instanceof o.ProductModel)){this.model=new o.ProductModel({id:r,currency:this.getEditor().getCurrencyId(),iblockId:t["IBLOCK_ID"],basePriceId:t["BASE_PRICE_ID"],skuTree:l.Type.isStringFilled(t["SKU_TREE"])?JSON.parse(t["SKU_TREE"]):null,storeMap:t["STORE_AMOUNT_MAP"],fields:t});if(l.Type.isObject(t["IMAGE_INFO"])){this.model.getImageCollection().setPreview(t["IMAGE_INFO"]["preview"]);this.model.getImageCollection().setEditInput(t["IMAGE_INFO"]["input"]);this.model.getImageCollection().setMorePhotoValues(t["IMAGE_INFO"]["values"])}if(!l.Type.isNil(t["DETAIL_URL"])){this.model.setDetailPath(t["DETAIL_URL"])}}i.EventEmitter.subscribe(this.model,"onErrorsChange",l.Runtime.debounce(k(this,x,de),500,this));i.EventEmitter.subscribe(this.model,"onChangeStoreData",this.updateUiStoreValues.bind(this))}},{key:"getModel",value:function e(){return this.model}},{key:"setProductId",value:function e(t){var i=this.getField("PRODUCT_ID")!==t;if(i){this.setField("PRODUCT_ID",t);this.setField("SKU_ID",t);this.updateUiStoreValues();this.addActionProductChange();this.addActionUpdateTotal();k(this,te,Te).call(this)}}},{key:"setBasePrice",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;t=Math.max(t,0);if(i===w){this.updateUiField("BASE_PRICE",t.toFixed(this.getPricePrecision()))}this.setField("BASE_PRICE",t);this.addActionProductChange();this.addActionUpdateTotal();this.updateRowTotalPrice()}},{key:"updateRowTotalPrice",value:function e(){var t=this.getEditor().getSettingValue("totalCalculationSumField","PURCHASING_PRICE");var i=this.getAmount()*this.getField(t,0);i=Math.max(i,0);this.setField("TOTAL_PRICE",i);this.updateUiField("TOTAL_PRICE",i.toFixed(this.getPricePrecision()))}},{key:"updateProductStoreValues",value:function e(){var t=this;this.storeSelectors.forEach((function(e){e.setProductId(t.getModel().getSkuId())}))}},{key:"updateUiStoreValues",value:function e(){var t=this;var i=this.getSettingValue("storeHeaderMap",{});Object.keys(i).forEach((function(e){var r=i[e];var n=t.getField(r);if(r==="STORE_FROM"){var s=t.model.getStoreCollection().getStoreAmount(n);if(s<=0){var o=t.model.getStoreCollection().getMaxFilledStore();var l=a.StoreSelector.getById(t.getId()+"_"+e);if(o.AMOUNT>s&&l){l.onStoreSelect(o.STORE_ID,o.STORE_TITLE);n=o.STORE_ID}}}t.setStoreAmount(n,r)}));this.layoutStoreSelector(this.getSettingValue("storeHeaderMap",{}))}},{key:"setStoreAmount",value:function e(t,i){var r=this;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:w;if(!this.model.getStoreCollection().isInited()){return}if(n===w){var a;var s={_AMOUNT:function e(){return r.model.getStoreCollection().getStoreAmount(t)},_RESERVED:function e(){return r.model.getStoreCollection().getStoreReserved(t)},_AVAILABLE_AMOUNT:function e(){return r.model.getStoreCollection().getStoreAvailableAmount(t)}};for(var o in s){if(Object.hasOwnProperty.call(s,o)){var u=k(this,Q,ye).call(this,i+o);if(u){u.innerHTML="";if(k(this,z,be).call(this)){a=s[o]()||0;var d=a+" "+l.Text.encode(this.getField("MEASURE_NAME"));var c=d;if(o==="_AVAILABLE_AMOUNT"){c=a>0?d:'<span class="text--danger">'.concat(d,"</span>")}u.innerHTML=c}}}}}}},{key:"setPurchasingPrice",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;if(k(this,ee,Ce).call(this)){return}t=Math.max(t,0);if(i===w){this.updateUiField("PURCHASING_PRICE",t.toFixed(this.getPricePrecision()))}this.setField("PURCHASING_PRICE",t);this.addActionProductChange();this.addActionUpdateTotal();this.updateRowTotalPrice()}},{key:"setAmount",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;if(i===w){this.updateUiInputField("AMOUNT",t)}var r=this.getField("AMOUNT")!==t;if(r){this.setField("AMOUNT",t);this.addActionProductChange();this.addActionUpdateTotal();this.updateRowTotalPrice()}}},{key:"setMeasure",value:function e(t){var i=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:w;if(this.model.isEmpty()){this.setField("MEASURE_CODE",t.CODE);this.setField("MEASURE_NAME",t.SYMBOL);this.updateUiMeasure(t.CODE,t.SYMBOL);return}if(r===O){this.getModel().showSaveNotifier("measureChanger_"+this.getId(),{title:l.Loc.getMessage("CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY"),declineCancelTitle:l.Loc.getMessage("CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_DECLINE_SAVE"),events:{onSave:function e(){i.setField("MEASURE_CODE",t.CODE);i.setField("MEASURE_NAME",t.SYMBOL);i.updateUiMeasure(i.getField("MEASURE_CODE"),i.getField("MEASURE_NAME"));i.getModel().save(["MEASURE_CODE","MEASURE_NAME"])},onCancel:function e(){i.updateUiMeasure(i.getField("MEASURE_CODE"),i.getField("MEASURE_NAME"))}}})}else{this.updateUiMeasure(t.CODE,t.SYMBOL)}this.addActionProductChange()}},{key:"getInputByFieldName",value:function e(t){var i=this.getUiFieldId(t);var r=document.getElementById(i);if(!l.Type.isElementNode(r)){r=this.getNode().querySelector('[name="'+i+'"]')}return r}},{key:"getInputWrapperByFieldName",value:function e(t){var i=this.getInputByFieldName(t);if(l.Type.isElementNode(i)){return l.Type.isElementNode(i.parentNode)?i.parentNode:i}return undefined}},{key:"updateUiInputField",value:function e(t,i){var r=this.getInputByFieldName(t);if(l.Type.isElementNode(r)){r.value=i}}},{key:"updateUiCheckboxField",value:function e(t,i){var r=this.getInputByFieldName(t);if(l.Type.isElementNode(r)){r.checked=i==="Y"}}},{key:"getMoneyFieldDropdownApi",value:function e(t){if(!l.Reflection.getClass("BX.Main.dropdownManager")){return null}return BX.Main.dropdownManager.getById(this.getId()+"_"+t+"_control")}},{key:"updateMoneyFieldUiWithDropdownApi",value:function e(t,i){if(t.getValue()===i){return}if(t.menu){t.menu.destroy()}var r=t.menu.itemsContainer.querySelector('[data-value="'+i+'"]');var n=r&&t.getMenuItem(r);if(n){t.refresh(n);t.selectItem(n)}}},{key:"updateUiMoneyField",value:function e(t,i,r){var n=this.getInputByFieldName(t);if(!l.Type.isElementNode(n)){return}n.dataset.value=i;var a=n.querySelector("span.main-dropdown-inner");if(!l.Type.isElementNode(a)){return}a.innerHTML=r}},{key:"updateUiMeasure",value:function e(t,i){this.updateUiMoneyField("MEASURE_CODE",t,l.Text.encode(i));this.updateUiStoreValues()}},{key:"updateUiHtmlField",value:function e(t,i){var r=this.getNode().querySelector('[data-name="'+t+'"]');if(l.Type.isElementNode(r)){r.innerHTML=i}}},{key:"updateUiCurrencyFields",value:function e(){var t=this;var i=this.getEditor().getCurrencyText();var r=""+this.getEditor().getCurrencyId();var n=["BASE_PRICE_CURRENCY","PURCHASING_PRICE_CURRENCY"];n.forEach((function(e){var n=[];n.push({NAME:i,VALUE:r});l.Dom.attr(t.getInputByFieldName(e),"data-items",n);t.updateUiMoneyField(e,r,i)}))}},{key:"updateUiField",value:function e(t,i){var n=this.getUiFieldName(t);if(!n){return}var a=this.getUiFieldType(t);if(!a){return}switch(a){case"input":this.updateUiInputField(n,i);break;case"money":i=BX.util.number_format(i,this.getPricePrecision(),".","");this.updateUiInputField(n,i);break;case"money_html":i=r.CurrencyCore.currencyFormat(i,this.getEditor().getCurrencyId(),true);this.updateUiHtmlField(n,i);break}}},{key:"getUiFieldName",value:function e(t){var i=null;switch(t){case"AMOUNT":case"MEASURE_CODE":case"BASE_PRICE":case"PURCHASING_PRICE":case"TOTAL_PRICE":i=t;break}return i}},{key:"getUiFieldType",value:function e(t){var i=["BASE_PRICE","PURCHASING_PRICE","TOTAL_PRICE"];if(i.includes(t)){var r,n;var a=(r=this.getEditor())===null||r===void 0?void 0:r.getColumnInfo(t);if((a===null||a===void 0?void 0:(n=a.editable)===null||n===void 0?void 0:n.TYPE)==="MONEY"){return"money"}return"money_html"}else if(t==="AMOUNT"){return"input"}return null}},{key:"parseInt",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.getEditor().parseInt(t,i)}},{key:"parseFloat",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;return this.getEditor().parseFloat(t,i,r)}},{key:"getPricePrecision",value:function e(){return this.getEditor().getPricePrecision()}},{key:"getQuantityPrecision",value:function e(){return this.getEditor().getQuantityPrecision()}},{key:"getCommonPrecision",value:function e(){return this.getEditor().getCommonPrecision()}},{key:"resetExternalActions",value:function e(){this.externalActions.length=0}},{key:"addExternalAction",value:function e(t){this.externalActions.push(t)}},{key:"addActionProductChange",value:function e(){this.addExternalAction({type:this.getEditor().actions.productChange,id:this.getId()})}},{key:"addActionUpdateTotal",value:function e(){this.addExternalAction({type:this.getEditor().actions.updateTotal})}},{key:"executeExternalActions",value:function e(){if(this.externalActions.length===0){return}this.getEditor().executeActions(this.externalActions);this.resetExternalActions()}},{key:"isEmptyRow",value:function e(){return!l.Type.isStringFilled(this.getField("NAME","").trim())&&this.model.isEmpty()&&this.getBasePrice()<=0}},{key:"validate",value:function e(){var t=[];if(!k(this,K,Ee).call(this,this.getAmount())){k(this,Y,pe).call(this,"AMOUNT",k(this,K,Ee));t.push(l.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_INVALID_AMOUNT_2"))}return t}}]);return e}();function re(){var e=this;if(this.getEditor().isReadOnly()||this.getField("EDITABLE")===false){return}var i=this.getNode().querySelector(".main-grid-cell-action .main-grid-cell-content");if(l.Type.isDomNode(i)){var r=l.Tag.render(P||(P=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a\n\t\t\t\t\thref="#"\n\t\t\t\t\tclass="main-grid-row-action-button"\n\t\t\t\t></a>\n\t\t\t'])));l.Event.bind(r,"click",(function(i){var n=[{text:l.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_COPY_ACTION"),onclick:e.handleCopyAction.bind(e)},{text:l.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_DELETE_ACTION"),onclick:e.handleDeleteAction.bind(e)}];t.PopupMenu.show({id:e.getId()+"_actions_popup",bindElement:r,items:n});i.preventDefault();i.stopPropagation()}));l.Dom.append(r,i)}}function ne(){var e={iblockId:this.model.getIblockId(),basePriceId:this.model.getBasePriceId(),currency:this.model.getCurrency(),model:this.model,config:{ENABLE_SEARCH:true,IS_ALLOWED_CREATION_PRODUCT:this.getSettingValue("isAllowedCreationProduct",true),ENABLE_IMAGE_INPUT:true,ROLLBACK_INPUT_AFTER_CANCEL:true,ENABLE_INPUT_DETAIL_LINK:true,ROW_ID:this.getId(),ENABLE_SKU_SELECTION:true,ENABLE_EMPTY_PRODUCT_ERROR:true,RESTRICTED_PRODUCT_TYPES:this.getEditor().getRestrictedProductTypes(),URL_BUILDER_CONTEXT:this.editor.getSettingValue("productUrlBuilderContext")},mode:n.ProductSelector.MODE_EDIT};this.mainSelector=new n.ProductSelector("catalog_document_grid_"+this.getId(),e);var t=this.getNode().querySelector('[data-name="MAIN_INFO"]');if(t){var r=t.querySelector(".main-grid-row-number");if(!l.Type.isDomNode(r)){t.appendChild(l.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['<div class="main-grid-row-number"></div>']))))}var a=t.querySelector(".main-grid-row-product-selector");if(!l.Type.isDomNode(a)){a=l.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['<div class="main-grid-row-product-selector"></div>'])));t.appendChild(a)}this.mainSelector.renderTo(a)}i.EventEmitter.subscribe(this.mainSelector,"onBeforeCreate",k(this,V,ce).bind(this))}function ae(){var e={iblockId:this.model.getIblockId(),basePriceId:this.model.getBasePriceId(),currency:this.model.getCurrency(),model:this.model,inputFieldName:"BARCODE",type:n.ProductSelector.INPUT_FIELD_BARCODE,config:{ENABLE_SEARCH:true,IS_ALLOWED_CREATION_PRODUCT:this.getSettingValue("isAllowedCreationProduct",true),ENABLE_INFO_SPOTLIGHT:this.editor.getSettingValue("showBarcodeSpotlightInfo",true),ENABLE_BARCODE_QR_AUTH:this.editor.getSettingValue("showBarcodeQrAuth",true),IS_INSTALLED_MOBILE_APP:this.editor.getSettingValue("isInstalledMobileApp",null),ENABLE_IMAGE_INPUT:false,ROLLBACK_INPUT_AFTER_CANCEL:true,ENABLE_INPUT_DETAIL_LINK:false,ROW_ID:this.getId(),ENABLE_SKU_SELECTION:false,ENABLE_SKU_TREE:false,ENABLE_EMPTY_PRODUCT_ERROR:false,RESTRICTED_PRODUCT_TYPES:this.getEditor().getRestrictedProductTypes()},mode:n.ProductSelector.MODE_EDIT,scannerToken:this.getEditor().scannerToken};this.barcodeSelector=new n.ProductSelector("catalog_document_grid_"+this.getId()+"_barcode",e);i.EventEmitter.subscribe(this.barcodeSelector,"onBeforeCreate",k(this,V,ce).bind(this));i.EventEmitter.subscribe(this.barcodeSelector,"onSpotlightClose",k(this,W,he).bind(this));i.EventEmitter.subscribe(this.barcodeSelector,"onBarcodeQrClose",k(this,X,ve).bind(this));i.EventEmitter.subscribe(this.barcodeSelector,"onBarcodeScannerInstallChecked",k(this,q,fe).bind(this));i.EventEmitter.subscribe(this.barcodeSelector,"onBarcodeChange",k(this,j,ge).bind(this));this.layoutBarcode()}function se(e){var t=this;Object.keys(e).forEach((function(r){var n={inputFieldId:e[r],inputFieldTitle:e[r]+"_TITLE",isDisabledEmpty:true,config:{ENABLE_SEARCH:true,ENABLE_INPUT_DETAIL_LINK:false,ROW_ID:t.getId()},mode:a.StoreSelector.MODE_EDIT,model:t.model};var s=new a.StoreSelector(t.getId()+"_"+r,n);i.EventEmitter.subscribe(s,"onChange",l.Runtime.debounce(k(t,U,oe).bind(t),500,t));i.EventEmitter.subscribe(s,"onClear",l.Runtime.debounce(k(t,U,oe).bind(t),500,t));t.storeSelectors.push(s)}));this.layoutStoreSelector(e)}function oe(e){var t=this;var i=e.getData();i.fields.forEach((function(e){t.updateField(e.NAME,e.VALUE)}))}function le(){if(!!this.realValues){return this.realValues}try{var e=this.getField("REAL_VALUES");if(e){var t=JSON.parse(atob(e));if(l.Type.isPlainObject(t)){this.realValues=t}}}catch(e){console.error("Cannot parse REAL_VALUE: "+e.getMessage())}return this.realValues}function ue(){var e=l.Type.isNumber(this.getModel().getField("BASE_PRICE_EXTRA"))?this.getModel().getField("BASE_PRICE_EXTRA"):null;return new b({basePrice:l.Text.toNumber(this.getModel().getField("PURCHASING_PRICE")),finalPrice:l.Text.toNumber(this.getModel().getField("BASE_PRICE")),extra:e,extraType:l.Text.toNumber(this.getModel().getField("BASE_PRICE_EXTRA_RATE"))})}function de(){var e=this.getModel().getErrorCollection().getErrors();for(var t in e){if(t===n.ProductSelector.ErrorCodes.NOT_SELECTED_PRODUCT||t===a.StoreSelector.ErrorCodes.NOT_SELECTED_STORE){this.getSelector().layoutErrors()}}this.getEditor().handleProductErrorsChange()}function ce(e){var t=e.getData(),i=t.model;i.setField("BARCODE",this.barcodeSelector.getNameInputFilledValue());i.setField("NAME",this.mainSelector.getNameInputFilledValue())}function he(e){this.editor.closeBarcodeSpotlights()}function ve(e){this.editor.closeBarcodeQrAuths()}function fe(e){this.editor.enableSendBarcodeMobilePush()}function ge(e){var t=e.getData(),i=t.value;this.changeBarcode(i,O)}function pe(e,t){var i=this;var r=this.getInputByFieldName(e);var n=this.getInputWrapperByFieldName(e);if(t(r.valueAsNumber)||this.validatingFields.get(e)){return}this.validatingFields.set(e,true);n.classList.add("main-grid-editor-cell-danger");var a=function a(s){if(Boolean(t(s.target.valueAsNumber))){i.validatingFields.set(e,false);l.Event.unbind(r,"blur",a);n.classList.remove("main-grid-editor-cell-danger")}};l.Event.bind(r,"blur",a)}function Ee(e){return e>0}function ye(e){return this.getNode().querySelector('[data-name="'.concat(e,'"]'))}function be(){return!this.getModel().isService()}function Se(){return!this.getModel().isService()}function me(){return this.getField("ACCESS_DENIED")===true}function Pe(){var e=this;if(!k(this,Z,me).call(this)){k(this,te,Te).call(this);return}var t=this.getEditor().getSettingValue("hiddenFields");var i=this.getEditor().getGridColumnIndexes();t.forEach((function(t){var r=i[t];if(r===undefined){return}var n=e.getNode().querySelector(".main-grid-cell:nth-child(".concat(r+1,") .main-grid-cell-content"));if(l.Type.isElementNode(n)){n.innerHTML=""}}));var r=i["AMOUNT"];if(r){var n=this.getNode().querySelector(".main-grid-cell:nth-child(".concat(r+1,") .main-grid-cell-content"));if(n){var a=new m({hint:l.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_STORE_HINT"),isReadOnly:this.getEditor().isReadOnly()});a.renderTo(n)}}}function Ce(){return this.getField("ACCESS_DENIED_TO_PURCHASING_PRICE")===true}function Te(){if(!k(this,ee,Ce).call(this)){return}var e=this.getEditor().getGridColumnIndexes();var t=e["PURCHASING_PRICE"];if(t){var i=this.getNode().querySelector(".main-grid-cell:nth-child(".concat(t+1,")"));if(i){var r=i.querySelector(".main-grid-editor-container");if(r){r.remove()}var n=i.querySelector(".main-grid-cell-content");if(n){var a=new m({hint:l.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_PURCHASING_PRICE_HINT"),isReadOnly:this.getEditor().isReadOnly()});a.renderTo(n);n.style.display="block"}}}}var Ie=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"_settings",{});this._settings=t?t:{};this.eventHandlers={}}babelHelpers.createClass(e,[{key:"registerEventHandler",value:function e(t,i){if(!this.eventHandlers[t])this.eventHandlers[t]=[];this.eventHandlers[t].push(i);BX.addCustomEvent(this,t,i)}},{key:"fireEvent",value:function e(t,i){BX.onCustomEvent(this,t,i)}},{key:"unregisterEventHandlers",value:function e(t){if(this.eventHandlers[t]){for(var i=0;i<this.eventHandlers[t].length;i++){BX.removeCustomEvent(this,t,this.eventHandlers[t][i])}delete this.eventHandlers[t]}}}]);return e}();var Ae,Re,_e,Fe;function ke(e,t){we(e,t);t.add(e)}function Oe(e,t,i){we(e,t);t.set(e,i)}function we(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Ne(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var De=new WeakMap;var He=new WeakMap;var Be=new WeakMap;var Me=new WeakMap;var Ue=new WeakSet;var Le=new WeakSet;var Ge=new WeakSet;var xe=new WeakSet;var Ve=new WeakSet;var We=new WeakSet;var Xe=function(){function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var r=arguments.length>2?arguments[2]:undefined;babelHelpers.classCallCheck(this,e);ke(this,We);ke(this,Ve);ke(this,xe);ke(this,Ge);ke(this,Le);ke(this,Ue);Oe(this,De,{writable:true,value:void 0});Oe(this,He,{writable:true,value:void 0});Oe(this,Be,{writable:true,value:void 0});Oe(this,Me,{writable:true,value:new l.Cache.MemoryCache});babelHelpers.classPrivateFieldSet(this,De,t);babelHelpers.classPrivateFieldSet(this,He,i);babelHelpers.classPrivateFieldSet(this,Be,r)}babelHelpers.createClass(e,[{key:"show",value:function e(){this.getPopup().show()}},{key:"getPopup",value:function e(){var i=this;return babelHelpers.classPrivateFieldGet(this,Me).remember("settings-popup",(function(){return new t.Popup(babelHelpers.classPrivateFieldGet(i,Be).getId()+"_"+Math.random()*100,babelHelpers.classPrivateFieldGet(i,De),{autoHide:true,draggable:false,offsetLeft:0,offsetTop:0,angle:{position:"top",offset:43},noAllPaddings:true,bindOptions:{forceBindPosition:true},closeByEsc:true,content:Ne(i,Le,je).call(i)})}))}},{key:"updateCheckboxState",value:function e(){var t=this;var i=this.getPopup().getContentContainer();babelHelpers.classPrivateFieldGet(this,He).filter((function(e){return e.action==="grid"&&l.Type.isArray(e.columns)})).forEach((function(e){var r=true;e.columns.forEach((function(e){if(!babelHelpers.classPrivateFieldGet(t,Be).getGrid().getColumnHeaderCellByName(e)){r=false}}));var n=i.querySelector('input[data-setting-id="'+e.id+'"]');if(l.Type.isDomNode(n)){n.checked=r}}))}}]);return e}();function qe(e){return babelHelpers.classPrivateFieldGet(this,He).filter((function(t){return t.id===e}))[0]}function je(){var e=this;var t=l.Tag.render(Ae||(Ae=babelHelpers.taggedTemplateLiteral(["\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t"])));babelHelpers.classPrivateFieldGet(this,He).forEach((function(i){t.append(Ne(e,Ge,Ye).call(e,i))}));return t}function Ye(e){var t=l.Tag.render(Re||(Re=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input type="checkbox">\n\t\t'])));t.checked=e.checked;t.dataset.settingId=e.id;var i=l.Type.isStringFilled(e.desc)?l.Tag.render(_e||(_e=babelHelpers.taggedTemplateLiteral(['<span class="ui-entity-editor-popup-create-field-item-desc">',"</span>"])),e.desc):"";var r=l.Tag.render(Fe||(Fe=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<label class="ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100">\n\t\t\t\t<div class="ui-ctl-w10" style="text-align: center">','</div>\n\t\t\t\t<div class="ui-ctl-w75">\n\t\t\t\t\t<span class="ui-entity-editor-popup-create-field-item-title">',"</span>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t"])),t,e.title,i);l.Event.bind(r,"change",Ne(this,xe,Ke).bind(this));return r}function Ke(e){var t=Ne(this,Ue,qe).call(this,e.target.dataset.settingId);if(!t){return}var i=e.target.checked;Ne(this,Ve,Qe).call(this,t,i)}function Qe(e,t){var i=this;var r=[];var n=babelHelpers.classPrivateFieldGet(this,Be).getGrid().getRows().getHeadFirstChild().getCells();Array.from(n).forEach((function(e){if("name"in e.dataset){r.push(e.dataset.name)}}));l.ajax.runComponentAction(babelHelpers.classPrivateFieldGet(this,Be).getComponentName(),"setGridSetting",{mode:"class",data:{signedParameters:babelHelpers.classPrivateFieldGet(this,Be).getSignedParameters(),settingId:e.id,selected:t,currentHeaders:r}}).then((function(){e.checked=t;if(e.id==="ADD_NEW_ROW_TOP"){var r=t?"top":"bottom";babelHelpers.classPrivateFieldGet(i,Be).setSettingValue("newRowPosition",r);var n=babelHelpers.classPrivateFieldGet(i,Be).changeActivePanelButtons(r);var a=n.querySelector('[data-role="product-list-settings-button"]');i.getPopup().setBindElement(a)}else{babelHelpers.classPrivateFieldGet(i,Be).reloadGrid()}i.getPopup().close();var s=t?l.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_ENABLED"):l.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_DISABLED");Ne(i,We,ze).call(i,s.replace("#NAME#",e.title),{category:"popup-settings"})}))}function ze(e,t){t=t||{};BX.UI.Notification.Center.notify({content:e,stack:t.stack||null,position:"top-right",width:"auto",category:t.category||null,autoHideDelay:t.autoHideDelay||3e3})}function $e(e,t){Je(e,t);t.add(e)}function Ze(e,t,i){Je(e,t);t.set(e,i)}function Je(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function et(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var tt=new WeakMap;var it=new WeakMap;var rt=new WeakSet;var nt=new WeakSet;var at=new WeakSet;var st=new WeakSet;var ot=new WeakSet;var lt=new WeakSet;var ut=function(){function e(t,i){babelHelpers.classCallCheck(this,e);$e(this,lt);$e(this,ot);$e(this,st);$e(this,at);$e(this,nt);$e(this,rt);babelHelpers.defineProperty(this,"fieldHintIsBusy",false);babelHelpers.defineProperty(this,"activeHintGuide",null);Ze(this,tt,{writable:true,value:void 0});Ze(this,it,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,it,t);babelHelpers.classPrivateFieldSet(this,tt,i)}babelHelpers.createClass(e,[{key:"processFieldTour",value:function e(t,i,r){var n=this;var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];if(this.fieldHintIsBusy){return}this.fieldHintIsBusy=true;i.events={onClose:function e(){r();n.fieldHintIsBusy=false;n.activeHintGuide=null}};if(et(this,at,ht).call(this,t)){var s=et(this,lt,gt).call(this,t,i);et(this,ot,ft).call(this,(function(){s.close()}))}else{var o=babelHelpers.classPrivateFieldGet(this,tt).call(this).getContainer();var l=o.querySelector(".main-grid-ear-left");var u=o.querySelector(".main-grid-ear-right");var d=t.getClientRects()[0].x;var c=o.getClientRects()[0].x;var h=null;if(d>c){h=et(this,st,vt).call(this,u)}else{h=et(this,st,vt).call(this,l)}et(this,rt,dt).call(this,t,(function(){h.close();var e=et(n,lt,gt).call(n,t,i);et(n,ot,ft).call(n,(function(){e.close()}))}),[],a)}}},{key:"getActiveHint",value:function e(){if(!this.fieldHintIsBusy){return null}else if(this.activeHintGuide instanceof d.Guide){return this.activeHintGuide}return null}}]);return e}();function dt(e,t){var i,r=this;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var s=(i=et(this,nt,ct)).call.apply(i,[this,e].concat(babelHelpers.toConsumableArray(a)));var o=function e(i){var a;if((a=et(r,at,ht)).call.apply(a,[r].concat(babelHelpers.toConsumableArray(s)))){l.Event.unbind(babelHelpers.classPrivateFieldGet(r,tt).call(r).getScrollContainer(),"scroll",e);l.Event.unbind(window,"resize",e);t.apply(void 0,babelHelpers.toConsumableArray(n))}};l.Event.bind(babelHelpers.classPrivateFieldGet(this,tt).call(this).getScrollContainer(),"scroll",o);l.Event.bind(window,"resize",o)}function ct(e){var t,i;var r=[];for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++){a[s-1]=arguments[s]}for(var o=0,l=a;o<l.length;o++){var u=l[o];r.push({node:u,nodeRect:u.getClientRects()[0]})}var d={node:e,nodeRect:e.getClientRects()[0]};r.push(d);r.sort((function(e,t){var i=e.nodeRect.x;var r=t.nodeRect.x;if(i<r){return-1}else if(i>r){return 1}else{return 0}}));var c=(t=babelHelpers.classPrivateFieldGet(this,tt).call(this))===null||t===void 0?void 0:(i=t.getContainer().getClientRects())===null||i===void 0?void 0:i[0];function h(e,t){return Math.abs(e-t)<c.width}while(r.length>1&&!h(r[0].nodeRect.x,r[r.length-1].nodeRect.x)){var v=r[0];var f=r[r.length-1];if(v===d){r.pop()}else if(f===d){r.shift()}else{var g=d.nodeRect.x-v.nodeRect.x;var p=f.nodeRect.x-d.nodeRect.x;if(g>=p){r.shift()}else{r.pop()}}}return r.map((function(e){return e.node}))}function ht(){var e,t;var i=(e=babelHelpers.classPrivateFieldGet(this,tt).call(this))===null||e===void 0?void 0:(t=e.getContainer().getClientRects())===null||t===void 0?void 0:t[0];if(i===undefined){return false}var r=i.x;var n=i.x+i.width;for(var a=arguments.length,s=new Array(a),o=0;o<a;o++){s[o]=arguments[o]}for(var l=0,u=s;l<u.length;l++){var d;var c=u[l];var h=(d=c.getClientRects())===null||d===void 0?void 0:d[0];if(h===undefined){return false}var v=h.x;var f=h.x+h.width;if(v<r||f>n){return false}}return true}function vt(e){var t=new BX.SpotLight({id:"arrow_spotlight",targetElement:e,autoSave:true,targetVertex:"middle-center",zIndex:200});t.show();t.container.style.pointerEvents="none";return t}function ft(e){var t=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var r=babelHelpers.classPrivateFieldGet(this,tt).call(this).getContainer();var n=r.querySelector(".main-grid-ear-left");var a=r.querySelector(".main-grid-ear-right");r.style.pointerEvents="none";n.style.pointerEvents="none";a.style.pointerEvents="none";var s=function s(o){r.style.pointerEvents="auto";n.style.pointerEvents="auto";a.style.pointerEvents="auto";l.Event.unbind(babelHelpers.classPrivateFieldGet(t,it),"click",s);e.apply(void 0,babelHelpers.toConsumableArray(i))};setTimeout((function(){l.Event.bind(babelHelpers.classPrivateFieldGet(t,it),"click",s)}),500)}function gt(e,t){var i=new d.Guide({steps:[Object.assign({target:e},t)],onEvents:true});this.activeHintGuide=i;i.showNextStep();return i}function pt(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function Et(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?pt(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):pt(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function yt(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=bt(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var r=0;var n=function e(){};return{s:n,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,s=false,o;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();a=t.done;return t},e:function e(t){s=true;o=t},f:function e(){try{if(!a&&i["return"]!=null)i["return"]()}finally{if(s)throw o}}}}function bt(e,t){if(!e)return;if(typeof e==="string")return St(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return St(e,t)}function St(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,r=new Array(t);i<t;i++){r[i]=e[i]}return r}function mt(e,t){Ct(e,t);t.add(e)}function Pt(e,t,i){Ct(e,t);t.set(e,i)}function Ct(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Tt(e,t,i){It(e,t);return i}function It(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function At(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Rt="template_0";var _t=2;var Ft=function e(t){if(!l.Type.isPlainObject(t)){return false}for(var i in t){return false}return true};var kt=new WeakMap;var Ot=new WeakSet;var wt=new WeakSet;var Nt=new WeakSet;var Dt=function(){function e(t){babelHelpers.classCallCheck(this,e);mt(this,Nt);mt(this,wt);mt(this,Ot);babelHelpers.defineProperty(this,"products",[]);babelHelpers.defineProperty(this,"productsWasInitiated",false);babelHelpers.defineProperty(this,"cache",new l.Cache.MemoryCache);Pt(this,kt,{writable:true,value:void 0});babelHelpers.defineProperty(this,"actions",{productChange:"productChange",productListChanged:"productListChanged",updateListField:"listField",updateTotal:"total"});babelHelpers.defineProperty(this,"updateFieldForList",null);babelHelpers.defineProperty(this,"productRowAddHandler",this.handleProductRowAdd.bind(this));babelHelpers.defineProperty(this,"productRowCreateHandler",this.handleProductRowCreate.bind(this));babelHelpers.defineProperty(this,"showBarcodeSettingsPopupHandler",this.handleShowBarcodeSettingsPopup.bind(this));babelHelpers.defineProperty(this,"showSettingsPopupHandler",this.handleShowSettingsPopup.bind(this));babelHelpers.defineProperty(this,"onSaveHandler",this.handleOnSave.bind(this));babelHelpers.defineProperty(this,"onEditorSubmit",this.handleEditorSubmit.bind(this));babelHelpers.defineProperty(this,"onFocusToProductList",this.handleProductListFocus.bind(this));babelHelpers.defineProperty(this,"onBeforeGridRequestHandler",this.handleOnBeforeGridRequest.bind(this));babelHelpers.defineProperty(this,"onGridUpdatedHandler",this.handleOnGridUpdated.bind(this));babelHelpers.defineProperty(this,"onGridRowMovedHandler",this.handleOnGridRowMoved.bind(this));babelHelpers.defineProperty(this,"onBeforeProductChangeHandler",this.handleOnBeforeProductChange.bind(this));babelHelpers.defineProperty(this,"onProductChangeHandler",this.handleOnProductChange.bind(this));babelHelpers.defineProperty(this,"onProductClearHandler",this.handleOnProductClear.bind(this));babelHelpers.defineProperty(this,"dropdownChangeHandler",this.handleDropdownChange.bind(this));babelHelpers.defineProperty(this,"onScanEmitHandler",this.handleMobileScanEvent.bind(this));babelHelpers.defineProperty(this,"changeProductFieldHandler",this.handleFieldChange.bind(this));babelHelpers.defineProperty(this,"blurProductFieldHandler",this.handleFieldBlur.bind(this));babelHelpers.defineProperty(this,"updateTotalDataDelayedHandler",l.Runtime.debounce(this.updateTotalDataDelayed,100,this));this.setId(t)}babelHelpers.createClass(e,[{key:"init",value:function e(){var t;var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.setSettings(r);this.scannerToken=(t=this.scannerToken)!==null&&t!==void 0?t:l.Text.getRandom(16);if(this.canEdit()){this.addFirstRowIfEmpty();this.enableEdit()}this.initForm();this.initProducts();this.initGridData();this.paintColumns();babelHelpers.classPrivateFieldSet(this,kt,new ut(this.getContainer(),this.getGrid.bind(this)));i.EventEmitter.emit("DocumentProductListController",[this]);At(this,Ot,Ht).call(this);this.subscribeDomEvents();this.subscribeCustomEvents();this.getContainer().querySelectorAll(".catalog-document-product-list-add-block").forEach((function(e){BX.UI.Hint.init(e)}))}},{key:"subscribeDomEvents",value:function e(){var t=this;var i=this.getContainer();if(l.Type.isElementNode(i)){i.querySelectorAll('[data-role="product-list-add-button"]').forEach((function(e){l.Event.bind(e,"click",t.productRowAddHandler)}));if(this.getSettingValue("enabledCreateProductButton",true)){i.querySelectorAll('[data-role="product-list-create-button"]').forEach((function(e){l.Event.bind(e,"click",t.productRowCreateHandler)}))}i.querySelectorAll('[data-role="product-list-settings-button"]').forEach((function(e){l.Event.bind(e,"click",t.showSettingsPopupHandler)}));i.querySelectorAll('[data-role="product-list-barcode-settings-button"]').forEach((function(e){l.Event.bind(e,"click",t.showBarcodeSettingsPopupHandler)}))}}},{key:"unsubscribeDomEvents",value:function e(){var t=this;var i=this.getContainer();if(l.Type.isElementNode(i)){i.querySelectorAll('[data-role="product-list-select-button"]').forEach((function(e){l.Event.unbind(e,"click",t.productSelectionPopupHandler)}));i.querySelectorAll('[data-role="product-list-add-button"]').forEach((function(e){l.Event.unbind(e,"click",t.productRowCreateHandler)}));i.querySelectorAll('[data-role="product-list-barcode-settings-button"]').forEach((function(e){l.Event.unbind(e,"click",t.productRowAddHandler)}));i.querySelectorAll('[data-role="product-list-settings-button"]').forEach((function(e){l.Event.unbind(e,"click",t.showSettingsPopupHandler)}))}}},{key:"subscribeCustomEvents",value:function e(){i.EventEmitter.subscribe("BX.UI.EntityEditor:onSave",this.onSaveHandler);i.EventEmitter.subscribe("BX.UI.EntityEditorAjax:onSubmit",this.onEditorSubmit);i.EventEmitter.subscribe("onFocusToProductList",this.onFocusToProductList);i.EventEmitter.subscribe("Grid::beforeRequest",this.onBeforeGridRequestHandler);i.EventEmitter.subscribe("Grid::updated",this.onGridUpdatedHandler);i.EventEmitter.subscribe("Grid::rowMoved",this.onGridRowMovedHandler);i.EventEmitter.subscribe("BX.Catalog.ProductSelector:onBeforeChange",this.onBeforeProductChangeHandler);i.EventEmitter.subscribe("BX.Catalog.ProductSelector:onChange",this.onProductChangeHandler);i.EventEmitter.subscribe("BX.Catalog.ProductSelector:onClear",this.onProductClearHandler);i.EventEmitter.subscribe("Dropdown::change",this.dropdownChangeHandler);i.EventEmitter.subscribe("BarcodeScanner::onScanEmit",this.onScanEmitHandler)}},{key:"unsubscribeCustomEvents",value:function e(){i.EventEmitter.unsubscribe("BX.UI.EntityEditor:onSave",this.onSaveHandler);i.EventEmitter.unsubscribe("BX.UI.EntityEditorAjax:onSubmit",this.onEditorSubmit);i.EventEmitter.unsubscribe("onFocusToProductList",this.onFocusToProductList);i.EventEmitter.unsubscribe("Grid::beforeRequest",this.onBeforeGridRequestHandler);i.EventEmitter.unsubscribe("Grid::updated",this.onGridUpdatedHandler);i.EventEmitter.unsubscribe("Grid::rowMoved",this.onGridRowMovedHandler);i.EventEmitter.unsubscribe("BX.Catalog.ProductSelector:onBeforeChange",this.onBeforeProductChangeHandler);i.EventEmitter.unsubscribe("BX.Catalog.ProductSelector:onChange",this.onProductChangeHandler);i.EventEmitter.unsubscribe("BX.Catalog.ProductSelector:onClear",this.onProductClearHandler);i.EventEmitter.unsubscribe("Dropdown::change",this.dropdownChangeHandler);i.EventEmitter.unsubscribe("BarcodeScanner::onScanEmit",this.onScanEmitHandler)}},{key:"handleMobileScanEvent",value:function e(t){var i,r;var n=t.getData();if(this.scannerToken!==n.id||!l.Type.isStringFilled(n.barcode)){return}var a=yt(this.products),s;try{for(a.s();!(s=a.n()).done;){var o,u;var d=s.value;if(((o=d.getBarcodeSelector())===null||o===void 0?void 0:(u=o.searchInput)===null||u===void 0?void 0:u.getNameInput())===document.activeElement){var c;(c=d.getBarcodeSelector().searchInput)===null||c===void 0?void 0:c.applyScannerData(n.barcode);return}}}catch(e){a.e(e)}finally{a.f()}var h=yt(this.products),v;try{for(h.s();!(v=h.n()).done;){var f,g,p,E;var y=v.value;if(((f=y.getBarcodeSelector())===null||f===void 0?void 0:(g=f.searchInput)===null||g===void 0?void 0:g.getNameInput().value)===""&&((p=y.getSelector())===null||p===void 0?void 0:(E=p.searchInput)===null||E===void 0?void 0:E.getNameInput().value)===""){var b;(b=y.getBarcodeSelector().searchInput)===null||b===void 0?void 0:b.applyScannerData(n.barcode);return}}}catch(e){h.e(e)}finally{h.f()}var S=this.addProductRow();(i=this.getProductById(S))===null||i===void 0?void 0:(r=i.getBarcodeSelector().searchInput)===null||r===void 0?void 0:r.applyScannerData(n.barcode)}},{key:"selectProductInRow",value:function e(t,i){var r=this;if(!l.Type.isStringFilled(t)||l.Text.toNumber(i)<=0){return}requestAnimationFrame((function(){var e;(e=r.getProductSelector(t))===null||e===void 0?void 0:e.onProductSelect(i)}))}},{key:"handleOnSave",value:function e(t){var i=o.ProductModel.getLastActiveSaveNotification();if(i){i.close()}var r=[];this.products.forEach((function(e){var t={fields:Et({},e.fields),rowId:e.fields.ROW_ID};r.push(t)}));this.setSettingValue("items",r)}},{key:"handleEditorSubmit",value:function e(t){}},{key:"handleProductListFocus",value:function e(t){if(this.isReadOnly()){return}var i=false;var r=yt(this.products),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.isEmptyRow()){i=true;this.focusProductSelector(a.fields["ROW_ID"]);break}}}catch(e){r.e(e)}finally{r.f()}if(!i){this.handleProductRowAdd()}}},{key:"onInnerCancel",value:function e(){this.reloadGrid(false)}},{key:"changeActivePanelButtons",value:function e(t){var i=this.getContainer();var r=i.querySelector(".catalog-document-product-list-add-block-"+t);if(l.Type.isDomNode(r)){l.Dom.removeClass(r,"catalog-document-product-list-add-block-hidden");l.Dom.addClass(r,"catalog-document-product-list-add-block-active")}var n=t==="top"?"bottom":"top";var a=i.querySelector(".catalog-document-product-list-add-block-"+n);if(l.Type.isDomNode(a)){l.Dom.addClass(a,"catalog-document-product-list-add-block-hidden");l.Dom.removeClass(a,"catalog-document-product-list-add-block-active")}return r}},{key:"reloadGrid",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(r===null){r=!i}this.getGrid().reloadTable("POST",{useProductsFromRequest:i},(function(){return t.actionUpdateTotalData({isInternalChanging:r})}))}},{key:"handleOnBeforeGridRequest",value:function t(r){var n=this;var a=r.getCompatData(),s=babelHelpers.slicedToArray(a,2),o=s[0],l=s[1];if(!o||!o.parent||o.parent.getId()!==this.getGridId()){return}var u=!("useProductsFromRequest"in l.data);var d=u?true:l.data.useProductsFromRequest;l.url=this.getReloadUrl();l.method="POST";l.sessid=BX.bitrix_sessid();l.data=Et(Et({},l.data),{},{useProductsFromRequest:d,signedParameters:this.getSignedParameters(),products:d?this.getProductsFields(Tt(e,e,Mt).call(e)):null});var c=false;if(l.data["action_button_"+l.gridId]==="delete"){c=true}this.clearEditor();if(u){i.EventEmitter.subscribeOnce("Grid::updated",(function(e){var t=e.getCompatData(),i=babelHelpers.slicedToArray(t,1),r=i[0];if(!r||r.getId()!==n.getGridId()){return}n.actionUpdateTotalData({isInternalChanging:false});if(c){n.executeActions([{type:n.actions.productListChanged}])}}))}}},{key:"handleOnGridUpdated",value:function e(t){var i=t.getCompatData(),r=babelHelpers.slicedToArray(i,1),n=r[0];if(!n||n.getId()!==this.getGridId()){return}this.getSettingsPopup().updateCheckboxState()}},{key:"handleOnGridRowMoved",value:function e(t){var i=t.getCompatData(),r=babelHelpers.slicedToArray(i,3),n=r[0],a=r[2];if(!a||a.getId()!==this.getGridId()){return}var s=this.resortProductsByIds(n);if(s){this.refreshSortFields();this.numerateRows();this.executeActions([{type:this.actions.productListChanged}])}}},{key:"initPageEventsManager",value:function e(){var t=this.getSettingValue("componentId");this.pageEventsManager=new Ie({id:t})}},{key:"getPageEventsManager",value:function e(){if(!this.pageEventsManager){this.initPageEventsManager()}return this.pageEventsManager}},{key:"canEdit",value:function e(){return this.getSettingValue("allowEdit",false)===true}},{key:"enableEdit",value:function e(){var t=this.getGrid().getRows().getRows();t.forEach((function(e){if(!e.isHeadChild()&&!e.isTemplate()&&!Ft(e.getEditData())){e.edit()}}))}},{key:"addFirstRowIfEmpty",value:function e(){var t=this;if(this.getGrid().getRows().getCountDisplayed()===0){requestAnimationFrame((function(){return t.addProductRow()}))}}},{key:"clearEditor",value:function e(){this.unsubscribeProductsEvents();this.products=[];this.productsWasInitiated=false;this.destroySettingsPopup();this.unsubscribeDomEvents();this.unsubscribeCustomEvents();l.Event.unbindAll(this.container)}},{key:"wasProductsInitiated",value:function e(){return this.productsWasInitiated}},{key:"unsubscribeProductsEvents",value:function e(){this.products.forEach((function(e){var t=e.getSelector();if(t){t.unsubscribeEvents()}var i=e.getBarcodeSelector();if(i){i.unsubscribeEvents()}}))}},{key:"destroy",value:function e(){this.setForm(null);this.clearController();this.clearEditor()}},{key:"setController",value:function e(t){if(this.controller===t){return}if(this.controller){this.controller.clearProductList()}this.controller=t}},{key:"clearController",value:function e(){this.controller=null}},{key:"getId",value:function e(){return this.id}},{key:"setId",value:function e(t){this.id=t}},{key:"getSettings",value:function e(){return this.settings}},{key:"setSettings",value:function e(t){this.settings=t?t:{}}},{key:"getSettingValue",value:function e(t,i){return this.settings.hasOwnProperty(t)?this.settings[t]:i}},{key:"setSettingValue",value:function e(t,i){this.settings[t]=i}},{key:"getComponentName",value:function e(){return this.getSettingValue("componentName","")}},{key:"getReloadUrl",value:function e(){return this.getSettingValue("reloadUrl","")}},{key:"getSignedParameters",value:function e(){return this.getSettingValue("signedParameters","")}},{key:"getContainerId",value:function e(){return this.getSettingValue("containerId","")}},{key:"getGridId",value:function e(){return this.getSettingValue("gridId","")}},{key:"getLanguageId",value:function e(){return this.getSettingValue("languageId","")}},{key:"getSiteId",value:function e(){return this.getSettingValue("siteId","")}},{key:"getCatalogId",value:function e(){return this.getSettingValue("catalogId",0)}},{key:"isReadOnly",value:function e(){return this.getSettingValue("readOnly",true)}},{key:"setReadOnly",value:function e(t){this.setSettingValue("readOnly",t)}},{key:"getCurrencyId",value:function e(){return this.getSettingValue("currencyId","")}},{key:"setCurrencyId",value:function e(t){this.setSettingValue("currencyId",t);return r.CurrencyCore.loadCurrencyFormat(t)}},{key:"isSalesOrdersDocument",value:function e(){var t=["REALIZATION","W"];return t.includes(this.settings.documentType)}},{key:"changeCurrencyId",value:function e(t){var i=this;var r=this.getCurrencyId();if(r===t){return}this.setCurrencyId(t).then((function(){var e=[];i.products.forEach((function(i){i.getModel().setOption("currency",t);e.push({fields:i.getFields(),id:i.getId()})}));if(e.length>0){l.ajax.runComponentAction(i.getComponentName(),"calculateProductPrices",{mode:"class",signedParameters:i.getSignedParameters(),data:{products:e,currencyId:t,oldCurrencyId:r}}).then(i.onCalculatePricesResponse.bind(i))}var n=i.getGridEditData();var a=n[Rt];a["CURRENCY"]=i.getCurrencyId();var s=["BASE_PRICE","PURCHASING_PRICE"];s.forEach((function(e){if(a[e]&&a[e]["CURRENCY"]){a[e]["CURRENCY"]["VALUE"]=i.getCurrencyId()}}));i.setGridEditData(n)}))}},{key:"onCalculatePricesResponse",value:function e(t){var i=t.data;this.products.forEach((function(e){if(l.Type.isObject(i[e.getId()])){e.updateField("BASE_PRICE",i[e.getId()]["BASE_PRICE"]);e.updateField("PURCHASING_PRICE",i[e.getId()]["PURCHASING_PRICE"]);e.updateUiCurrencyFields()}}));this.updateTotalDataDelayed();this.updateTotalUiCurrency()}},{key:"updateTotalUiCurrency",value:function e(){var t=this;var i=BX(this.getSettingValue("totalBlockContainerId",null));if(l.Type.isElementNode(i)){var n=["totalCost"];i.querySelectorAll(".catalog-document-product-list-result-grid-total").forEach((function(e){var i=yt(n),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;var o=e.querySelector('[data-total="'+s+'"]');if(o){e.innerHTML=r.CurrencyCore.getPriceControl(o,t.getCurrencyId())}}}catch(e){i.e(e)}finally{i.f()}}))}}},{key:"getCurrencyText",value:function e(){var t=this.getCurrencyId();if(!l.Type.isStringFilled(t)){return""}var i=r.CurrencyCore.getCurrencyFormat(t);return i&&i.FORMAT_STRING.replace(/(^|[^&])#/,"$1").trim()||""}},{key:"getDataFieldName",value:function e(){return this.getSettingValue("dataFieldName","")}},{key:"getDataSettingsFieldName",value:function e(){var t=this.getDataFieldName();return l.Type.isStringFilled(t)?t+"_SETTINGS":""}},{key:"getPricePrecision",value:function e(){return this.getSettingValue("pricePrecision",_t)}},{key:"getQuantityPrecision",value:function e(){return this.getSettingValue("quantityPrecision",_t)}},{key:"getCommonPrecision",value:function e(){return this.getSettingValue("commonPrecision",_t)}},{key:"getMeasures",value:function e(){return this.getSettingValue("measures",[])}},{key:"getDefaultMeasure",value:function e(){return this.getSettingValue("defaultMeasure",{})}},{key:"getRowIdPrefix",value:function e(){return this.getSettingValue("rowIdPrefix","catalog_entity_product_list_")}},{key:"parseInt",value:function(e){function t(t){return e.apply(this,arguments)}t.toString=function(){return e.toString()};return t}((function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i;var r=l.Type.isNumber(e);var n=l.Type.isStringFilled(e);if(!r&&!n){return t}if(n){e=e.replace(/^\s+|\s+$/g,"");var a=e.indexOf("-")===0;i=parseInt(e.replace(/[^\d]/g,""),10);if(isNaN(i)){i=t}else{if(a){i=-i}}}else{i=parseInt(e,10);if(isNaN(i)){i=t}}return i}))},{key:"parseFloat",value:function(e){function t(t){return e.apply(this,arguments)}t.toString=function(){return e.toString()};return t}((function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_t;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var r;var n=l.Type.isNumber(e);var a=l.Type.isStringFilled(e);if(!n&&!a){return i}if(a){e=e.replace(/^\s+|\s+$/g,"");var s=e.indexOf(".");var o=e.indexOf(",");var u=e.indexOf("-")===0;if(s<0&&o>=0){var d=e.substr(0,o);var c=e.length-o-1;if(c>0){d+="."+e.substr(o+1,c)}e=d}e=e.replace(/[^\d.]+/g,"");r=parseFloat(e);if(isNaN(r)){r=i}if(u){r=-r}}else{r=parseFloat(e)}if(t>=0){r=this.round(r,t)}return r}))},{key:"round",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_t;var r=Math.pow(10,i);return Math.round(t*r)/r}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",(function(){return document.getElementById(t.getContainerId())}))}},{key:"initForm",value:function e(){var t=this.getSettingValue("formId","");var i=l.Type.isStringFilled(t)?BX("form_"+t):null;if(l.Type.isElementNode(i)){this.setForm(i)}}},{key:"isExistForm",value:function e(){return l.Type.isElementNode(this.getForm())}},{key:"getForm",value:function e(){return this.form}},{key:"setForm",value:function e(t){this.form=t}},{key:"initFormFields",value:function e(){var t=this.getForm();if(l.Type.isElementNode(t)){var i=this.getDataField();if(!l.Type.isElementNode(i)){this.initDataField()}var r=this.getDataSettingsField();if(!l.Type.isElementNode(r)){this.initDataSettingsField()}}}},{key:"initFormField",value:function e(t){var i=this.getForm();if(l.Type.isElementNode(i)&&l.Type.isStringFilled(t)){i.appendChild(l.Dom.create("input",{attrs:{type:"hidden",name:t}}))}}},{key:"removeFormFields",value:function e(){var t=this.getDataField();if(l.Type.isElementNode(t)){l.Dom.remove(t)}var i=this.getDataSettingsField();if(l.Type.isElementNode(i)){l.Dom.remove(i)}}},{key:"initDataField",value:function e(){this.initFormField(this.getDataFieldName())}},{key:"initDataSettingsField",value:function e(){this.initFormField(this.getDataSettingsFieldName())}},{key:"getFormField",value:function e(t){var i=this.getForm();if(l.Type.isElementNode(i)&&l.Type.isStringFilled(t)){return i.querySelector('input[name="'+t+'"]')}return null}},{key:"getDataField",value:function e(){return this.getFormField(this.getDataFieldName())}},{key:"getDataSettingsField",value:function e(){return this.getFormField(this.getDataSettingsFieldName())}},{key:"getProductCount",value:function e(){return this.products.filter((function(e){return!e.isEmptyRow()})).length}},{key:"initProducts",value:function e(){var t=this.getSettingValue("items",[]);var i=yt(t),r;try{for(i.s();!(r=i.n()).done;){var n=r.value;var a=Et({},n.fields);this.products.push(new ie(n.rowId,a,this.getSettingValue("rowSettings",{}),this))}}catch(e){i.e(e)}finally{i.f()}this.numerateRows();this.productsWasInitiated=true;this.updateTotalDataDelayed()}},{key:"numerateRows",value:function e(){this.products.forEach((function(e,t){e.setRowNumber(t+1)}))}},{key:"getGrid",value:function e(){var t=this;return this.cache.remember("grid",(function(){var e=t.getGridId();if(!l.Reflection.getClass("BX.Main.gridManager.getInstanceById")){throw Error("Cannot find grid with '".concat(e,"' id."))}return BX.Main.gridManager.getInstanceById(e)}))}},{key:"getGridColumnIndexes",value:function e(){var t=this;return this.cache.remember("getGridColumnIndexes",(function(){var e={};var i=t.getGrid().getHead().querySelectorAll(".main-grid-cell-head");for(var r=0;r<i.length;r++){var n=i[r];var a=n.dataset.name;if(a){e[a]=r}}return e}))}},{key:"initGridData",value:function e(){var t=this.getSettingValue("templateGridEditData",null);if(t){this.setGridEditData(t)}}},{key:"paintColumns",value:function e(){var t=this.getSettingValue("paintedColumns",null);var i=this.getGrid();if(i&&l.Type.isArray(t)){t.forEach((function(e){var t=i.getRows().getRows();t.forEach((function(t){var i=t.getCellById(e);if(i){l.Dom.addClass(i,"main-grid-cell-light-blue-background")}}))}))}}},{key:"getGridEditData",value:function e(){return this.getGrid().arParams.EDITABLE_DATA}},{key:"getColumnInfo",value:function e(t){var i,r;return((i=this.getGrid())===null||i===void 0?void 0:(r=i.arParams)===null||r===void 0?void 0:r.COLUMNS_ALL[t])||{}}},{key:"setGridEditData",value:function e(t){this.getGrid().arParams.EDITABLE_DATA=t}},{key:"setOriginalTemplateEditData",value:function e(t){this.getGrid().arParams.EDITABLE_DATA[Rt]=t}},{key:"handleProductErrorsChange",value:function e(){if(At(this,wt,Bt).call(this)){this.controller.disableSaveButton()}else{this.controller.enableSaveButton()}}},{key:"handleFieldChange",value:function e(t){var i=t.target.closest("tr");if(i&&i.hasAttribute("data-id")){var r=this.getProductById(i.getAttribute("data-id"));if(r){var n=t.target.getAttribute("data-name");if(!l.Type.isStringFilled(n)){var a=t.target.closest("td");n=this.getFieldCodeByGridCell(i,a)}if(n){r.updateFieldByEvent(n,t)}}}}},{key:"handleFieldBlur",value:function e(t){var i=t.target.closest("tr");var r=t.target.value;var n=t.target.getAttribute("data-name");if(!l.Type.isStringFilled(n)){var a=t.target.closest("td");n=this.getFieldCodeByGridCell(i,a)}if(this.isSalesOrdersDocument()&&n==="AMOUNT"&&r<=0){t.target.value=1;this.handleFieldChange(t);BX.UI.Notification.Center.notify({width:"auto",content:l.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_INVALID_AMOUNT_REALIZATION")})}}},{key:"handleDropdownChange",value:function e(t){var i=t.getData(),r=babelHelpers.slicedToArray(i,5),n=r[0],a=r[4];var s=new RegExp(this.getRowIdPrefix()+"([A-Za-z0-9]+)_(\\w+)_control","i");var o=n.match(s);if(o){var l=babelHelpers.slicedToArray(o,3),u=l[1],d=l[2];var c=this.getProductById(u);if(c){c.updateDropdownField(d,a)}}}},{key:"getProductById",value:function e(t){var i=this.getRowIdPrefix()+t;return this.getProductByRowId(i)}},{key:"getProductByRowId",value:function e(t){return this.products.find((function(e){return e.getId()===t}))}},{key:"getFieldCodeByGridCell",value:function e(t,i){if(!l.Type.isDomNode(t)||!l.Type.isDomNode(i)){return null}var r=this.getGrid();if(r){var n=r.getRows().getHeadFirstChild();var a=babelHelpers.toConsumableArray(t.cells).indexOf(i);return n.getCellNameByCellIndex(a)}return null}},{key:"addProductRow",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var i=this.createGridProductRow();var r=i.getId();if(t){var n;var a=(n=this.getGrid().getRows().getById(t.getField("ID")))===null||n===void 0?void 0:n.getNode();if(a){a.parentNode.insertBefore(i.getNode(),a.nextSibling)}}this.initializeNewProductRow(r,t);this.getGrid().bindOnRowEvents();return r}},{key:"handleProductRowAdd",value:function e(){var t=this.addProductRow();this.focusProductSelector(t)}},{key:"handleProductRowCreate",value:function e(){}},{key:"handleShowBarcodeSettingsPopup",value:function e(){this.getSettingsPopup().show()}},{key:"handleShowSettingsPopup",value:function e(){this.getSettingsPopup().show()}},{key:"destroySettingsPopup",value:function e(){if(this.cache.has("settings-popup")){this.cache.get("settings-popup").getPopup().destroy();this.cache["delete"]("settings-popup")}}},{key:"getSettingsPopup",value:function e(){var t=this;return this.cache.remember("settings-popup",(function(){return new Xe(t.getContainer().querySelector('.catalog-document-product-list-add-block-active [data-role="product-list-settings-button"]'),t.getSettingValue("popupSettings",[]),t)}))}},{key:"getHintPopup",value:function e(){var t=this;return this.cache.remember("hint-popup",(function(){return new v(t)}))}},{key:"createGridProductRow",value:function e(){var t=l.Text.getRandom();var r=this.redefineTemplateEditData(t);var n=this.getGrid();var a;if(this.getSettingValue("newRowPosition")==="bottom"){a=n.appendRowEditor()}else{a=n.prependRowEditor()}var s=a.getNode();if(l.Type.isDomNode(s)){s.setAttribute("data-id",t);a.makeCountable()}if(r){this.setOriginalTemplateEditData(r)}i.EventEmitter.emit("Grid::thereEditedRows",[]);n.adjustRows();n.updateCounterDisplayed();n.updateCounterSelected();return a}},{key:"handleDeleteRow",value:function e(t,i){i.preventDefault();var r=this.getProductByRowId(t);if(r){this.deleteRow(t)}}},{key:"redefineTemplateEditData",value:function e(t){var i=this.getGridEditData();var r=i[Rt];var n=this.prepareCustomEditData(r,t);this.setOriginalTemplateEditData(Et(Et({},r),n));return r}},{key:"prepareCustomEditData",value:function e(t,i){var r={};var n=this.getSettingValue("templateIdMask","");for(var a in t){if(t.hasOwnProperty(a)){if(l.Type.isStringFilled(t[a])&&t[a].indexOf(n)>=0){r[a]=t[a].replace(new RegExp(n,"g"),i)}else if(l.Type.isPlainObject(t[a])){r[a]=this.prepareCustomEditData(t[a],i)}else{r[a]=t[a]}}}return r}},{key:"initializeNewProductRow",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var r={};if(i!==null){r=Object.assign(r,i===null||i===void 0?void 0:i.getFields())}else{r=Et(Et({},this.getSettingValue("templateItemFields",{})),{CURRENCY:this.getCurrencyId()})}if(l.Type.isNil(i)&&this.products.length>0){var n=this.getSettingValue("newRowPosition")==="bottom"?this.products[this.products.length-1]:this.products[0];var a=this.getSettingValue("stores",{});var s=n.getSettingValue("storeHeaderMap",{});Object.values(s).forEach((function(e){var t=n.getField(e);if(l.Type.isNil(a[t])){return}r[e]=n.getField(e);var i=e+"_TITLE";r[i]=n.getField(i)}))}var o=this.getRowIdPrefix()+t;r.ID=t;r.ROW_ID=t;if(l.Type.isObject(r.IMAGE_INFO)){delete r.IMAGE_INFO.input}var u=new ie(o,r,this.getSettingValue("rowSettings",{}),this);if(i instanceof ie){this.products.splice(1+this.products.indexOf(i),0,u);u.refreshFieldsLayout()}else if(this.getSettingValue("newRowPosition")==="bottom"){this.products.push(u)}else{this.products.unshift(u)}this.refreshSortFields();this.numerateRows();u.updateUiCurrencyFields();this.updateTotalUiCurrency();return u}},{key:"getProductSelector",value:function e(t){return this.getProductById(t).getSelector()}},{key:"focusProductSelector",value:function e(t){var i=this;requestAnimationFrame((function(){var e;(e=i.getProductSelector(t))===null||e===void 0?void 0:e.searchInDialog().focusName()}))}},{key:"handleOnBeforeProductChange",value:function e(t){var i=t.getData();var r=this.getProductByRowId(i.rowId);if(r){this.getGrid().tableFade();r.resetExternalActions()}}},{key:"handleOnProductChange",value:function e(t){var i=t.getData();var r=this.getProductByRowId(i.rowId);if(r&&i.fields){var n,a;delete i.fields.ID;r.setFields(i.fields);Object.keys(i.fields).forEach((function(e){r.updateFieldValue(e,i.fields[e])}));r.setField("IS_NEW",i.isNew?"Y":"N");(n=r.getSelector())===null||n===void 0?void 0:n.layout();(a=r.getBarcodeSelector())===null||a===void 0?void 0:a.layout();r.updateProductStoreValues();r.initHandlersForSelectors();r.layoutStoreSelector(r.getSettingValue("storeHeaderMap",{}));r.layoutBarcode();r.executeExternalActions();if(this.isSalesOrdersDocument()){r.changeAmount(r.getAmount()>0?r.getAmount():1)}this.getGrid().tableUnfade()}else{this.getGrid().tableUnfade()}}},{key:"handleOnProductClear",value:function e(t){var i=t.getData(),r=i.selectorId,n=i.rowId;var a=this.getProductByRowId(n);if(a&&a.getSelector().getId()===r){var s;a.initHandlersForSelectors();a.setMeasure(this.getDefaultMeasure());a.changePurchasingPrice(0);a.changeBasePrice(0);a.changeAmount(0);a.updateUiStoreValues();a.updateProductStoreValues();a.changeBarcode("");(s=a.getBarcodeSelector())===null||s===void 0?void 0:s.setConfig("ENABLE_SEARCH",true).layout();a.executeExternalActions()}}},{key:"compileProductData",value:function e(){if(!this.isExistForm()){return}this.initFormFields();var t=this.getDataField();var i=this.getDataSettingsField();this.cleanProductRows();if(l.Type.isElementNode(t)&&l.Type.isElementNode(i)){t.value=this.prepareProductDataValue()}}},{key:"prepareProductDataValue",value:function t(){var i="";if(this.getProductCount()){var r=[];this.products.forEach((function(t){var i=t.getFields(Tt(e,e,Mt).call(e));if(!/^[0-9]+$/.test(i["ID"])){i["ID"]=0}i["CUSTOMIZED"]="Y";r.push(i)}));i=JSON.stringify(r)}return i}},{key:"executeActions",value:function e(t){if(!l.Type.isArrayFilled(t)){return}var i=yt(t),r;try{for(i.s();!(r=i.n()).done;){var n=r.value;if(!l.Type.isPlainObject(n)||!l.Type.isStringFilled(n.type)){continue}switch(n.type){case this.actions.productChange:this.actionSendProductChange(n);break;case this.actions.productListChanged:this.actionSendProductListChanged();break;case this.actions.updateTotal:this.actionUpdateTotalData();break}}}catch(e){i.e(e)}finally{i.f()}}},{key:"actionSendProductChange",value:function e(t){if(!l.Type.isStringFilled(t.id)){return}var i=this.getProductByRowId(t.id);if(!i){return}if(this.controller){this.controller.productChange()}}},{key:"actionSendProductListChanged",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.controller){this.controller.productChange(t)}}},{key:"actionUpdateListField",value:function e(t){if(!l.Type.isStringFilled(t.field)||!("value"in t)){return}this.updateFieldForList=t.field;var i=yt(this.products),r;try{for(i.s();!(r=i.n()).done;){var n=r.value;n.updateFieldByName(t.field,t.value)}}catch(e){i.e(e)}finally{i.f()}this.updateFieldForList=null}},{key:"actionUpdateTotalData",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.updateTotalDataDelayedHandler(t)}},{key:"updateTotalDataDelayed",value:function e(){var t=0;var i=this.getSettingValue("totalCalculationSumField","PURCHASING_PRICE");this.products.forEach((function(e){return t+=l.Text.toNumber(e.getField(i))*l.Text.toNumber(e.getField("AMOUNT"))}));this.setTotalData({totalCost:t})}},{key:"getProductsFields",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var i=[];var r=yt(this.products),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;i.push(a.getFields(t))}}catch(e){r.e(e)}finally{r.f()}return i}},{key:"setTotalData",value:function e(t){var i;var n=BX(this.getSettingValue("totalBlockContainerId",null));if(l.Type.isElementNode(n)){var a=this.getCurrencyId();var s=["totalCost"];for(var o=0,u=s;o<u.length;o++){var d=u[o];var c=n.querySelector('[data-total="'+d+'"]');if(l.Type.isElementNode(c)&&d in t){c.innerHTML=r.CurrencyCore.currencyFormat(t[d],a,false)}}}(i=this.controller)===null||i===void 0?void 0:i.setTotal(t)}},{key:"ajaxResultCommonCheck",value:function e(t){if(!l.Type.isPlainObject(t)){return false}if(!l.Type.isStringFilled(t.status)){return false}if(t.status!=="success"){return false}if(!l.Type.isPlainObject(t.data)){return false}if(!l.Type.isStringFilled(t.data.action)){return false}if(!("result"in t.data)){return false}return true}},{key:"deleteRow",value:function e(t){var r=this.getGrid().getRows().getById(t.getField("ID"));if(r){l.Dom.remove(r.getNode());this.getGrid().getRows().reset()}var n=this.products.indexOf(t);if(n>-1){this.products.splice(n,1);this.refreshSortFields();this.numerateRows()}i.EventEmitter.emit("Grid::thereEditedRows",[]);this.addFirstRowIfEmpty();this.executeActions([{type:this.actions.productListChanged},{type:this.actions.updateTotal}])}},{key:"copyRow",value:function e(t){this.addProductRow(t);this.refreshSortFields();this.numerateRows();i.EventEmitter.emit("Grid::thereEditedRows",[]);this.executeActions([{type:this.actions.productListChanged},{type:this.actions.updateTotal}])}},{key:"cleanProductRows",value:function e(){var t=this;this.products.filter((function(e){return e.isEmptyRow()})).forEach((function(e){return t.deleteRow(e)}))}},{key:"resortProductsByIds",value:function e(t){var i=false;if(l.Type.isArrayFilled(t)){this.products.sort((function(e,r){if(t.indexOf(e.getField("ID"))>t.indexOf(r.getField("ID"))){return 1}i=true;return-1}))}return i}},{key:"refreshSortFields",value:function e(){this.products.forEach((function(e,t){return e.setField("SORT",(t+1)*10,false)}))}},{key:"handleOnTabShow",value:function e(){i.EventEmitter.emit("onDemandRecalculateWrapper",[this])}},{key:"closeBarcodeSpotlights",value:function e(){this.products.forEach((function(e){var t;(t=e.getBarcodeSelector())===null||t===void 0?void 0:t.removeSpotlight()}));this.setSettingValue("showBarcodeSpotlightInfo",false)}},{key:"closeBarcodeQrAuths",value:function e(){this.products.forEach((function(e){var t;(t=e.getBarcodeSelector())===null||t===void 0?void 0:t.removeQrAuth()}));this.setSettingValue("showBarcodeQrAuth",false)}},{key:"enableSendBarcodeMobilePush",value:function e(){this.products.forEach((function(e){var t;(t=e.getBarcodeSelector())===null||t===void 0?void 0:t.setConfig("IS_INSTALLED_MOBILE_APP",true)}));this.setSettingValue("isInstalledMobileApp",true)}},{key:"validate",value:function e(){if(this.getProductCount()===0){return[l.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_IS_EMPTY")]}var t=[];this.products.forEach((function(e){t=t.concat(e.validate())}));return t}},{key:"showFieldTourHint",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"";if(this.products.length>0){var s=this.products[0].getNode();if(this.getProductByRowId(a)){s=this.getProductByRowId(a).getNode()}var o=[];var l=yt(n),u;try{for(l.s();!(u=l.n()).done;){var d=u.value;var c=s.querySelector('[data-name="'.concat(d,'"]'));if(c!==null){o.push(c)}}}catch(e){l.e(e)}finally{l.f()}var h=s.querySelector('[data-name="'.concat(t,'"]'));if(h!==null){babelHelpers.classPrivateFieldGet(this,kt).processFieldTour(h,i,r,o)}}}},{key:"getActiveHint",value:function e(){return babelHelpers.classPrivateFieldGet(this,kt).getActiveHint()}},{key:"getRestrictedProductTypes",value:function e(){return this.getSettingValue("restrictedProductTypes",[])}},{key:"processApplyActionButtonClick",value:function e(t){if(t==="STORE_FROM_INFO"||t==="STORE_TO_INFO"){At(this,Nt,Ut).call(this,t)}}}]);return e}();function Ht(){this.getGrid()._clickOnRowActionsButton=function(){}}function Bt(){return this.products.filter((function(e){return e.getModel().getErrorCollection().hasErrors()})).length>0}function Mt(){return["ID","SKU_ID","AMOUNT","PURCHASING_PRICE","BASE_PRICE","BASE_PRICE_EXTRA","BASE_PRICE_EXTRA_RATE","DOC_BARCODE","BARCODE","STORE_TO","STORE_FROM","BASE_PRICE_ID","BASKET_ID","DOC_ID","ELEMENT_ID","IBLOCK_ID","MEASURE_CODE","MEASURE_NAME","NAME","OFFERS_IBLOCK_ID","PARENT_PRODUCT_ID","PRODUCT_ID","ROW_ID","STORE_FROM_AMOUNT","STORE_FROM_AVAILABLE_AMOUNT","STORE_FROM_RESERVED","STORE_FROM_TITLE","STORE_TO_AMOUNT","STORE_TO_AVAILABLE_AMOUNT","STORE_TO_RESERVED","STORE_TO_TITLE","TOTAL_PRICE","TYPE"]}function Ut(e){var t,i=this;var r=(t=this.getGrid())===null||t===void 0?void 0:t.getActionsPanel();var n=r===null||r===void 0?void 0:r.getValues();var s=n[e];if(!n||l.Type.isUndefined(s)){return}var o=this.getGrid().getRows().getSelected();if(o.length===0){return}var u=this.getSettingValue("stores",{});var d=u[s];if(!l.Type.isNil(d)){var h=(d===null||d===void 0?void 0:d.TITLE)||"";o.forEach((function(t){var r=i.products.find((function(e){return e.getField("ID")===t.getId()}));if(r){var n=a.StoreSelector.getById(r.getId()+"_"+e);if(n){n.onStoreSelect(s,h)}}}));var v="M";var f=this.settings.documentType!==v?"CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_STORE_CHANGED_HINT":"CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_"+e+"_CHANGED_HINT";c.UI.Notification.Center.notify({content:l.Loc.getMessage(f,{"#STORE_NAME#":l.Text.encode(h)}),autoHide:true,autoHideDelay:4e3})}var g=r.getDropdowns().find((function(e){return e.id==="actionListId_control"}));if(g){r.removeItemsRelativeCurrent(g.parentNode);l.Dom.attr(g,"data-value",null);var p=g.querySelector(".main-dropdown-inner");if(p){p.innerText=l.Loc.getMessage("CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_DEFAULT")}}}e.Editor=Dt;e.PageEventsManager=Ie})(this.BX.Catalog.Store.ProductList=this.BX.Catalog.Store.ProductList||{},BX.Main,BX.Event,BX.Currency,BX.Catalog,BX.Catalog,BX.Catalog.DocumentCard,BX.Catalog,BX,BX,BX.UI.Tour,BX);
//# sourceMappingURL=script.map.js