{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/price.calculator.js","src/js/access.denied.input.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/field.hint.manager.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}","import {Type, Text} from \"main.core\";\n\ntype PriceCalculatorFields = {\n\tbasePrice: number,\n\tfinalPrice: number,\n\textra: number | null,\n\textraType: PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n}\n\nexport class PriceCalculator\n{\n\tstatic EXTRA_TYPE_PERCENTAGE = 1;\n\tstatic EXTRA_TYPE_MONETARY = 2;\n\n\t#fields: PriceCalculatorFields = {\n\t\tbasePrice: 0,\n\t\tfinalPrice: 0,\n\t\textra: null,\n\t\textraType: PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n\t};\n\n\n\tconstructor(fields: PriceCalculatorFields): void\n\t{\n\t\tthis.#fields = {...this.#fields, ...fields};\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.#fields.basePrice;\n\t}\n\n\tgetFinalPrice(): number\n\t{\n\t\treturn this.#fields.finalPrice;\n\t}\n\n\tgetExtra(): number | null\n\t{\n\t\treturn this.#fields.extra;\n\t}\n\n\tgetExtraType(): PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE\n\t{\n\t\treturn this.#fields.extraType;\n\t}\n\n\tcalculateBasePrice(basePrice: number): PriceCalculator\n\t{\n\t\tthis.#fields.basePrice = basePrice;\n\t\tthis.#fields.extra = Text.toNumber(this.#fields.extra);\n\n\t\tif (this.#fields.extraType === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\tthis.#fields.finalPrice = this.#fields.basePrice + this.#fields.extra;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#fields.finalPrice = this.#fields.basePrice * (1 + this.#fields.extra / 100);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcalculateFinalPrice(finalPrice: number): PriceCalculator\n\t{\n\t\tthis.#fields.finalPrice = finalPrice;\n\t\tconst basePrice = Text.toNumber(this.#fields.basePrice);\n\n\t\tif (basePrice <= 0)\n\t\t{\n\t\t\tthis.#fields.extraType = PriceCalculator.EXTRA_TYPE_MONETARY;\n\t\t}\n\n\t\tif (this.#fields.extraType === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\tthis.#fields.extra = this.#fields.finalPrice - basePrice;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#fields.extra = (this.#fields.finalPrice / basePrice - 1) * 100;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcalculateExtra(extra: number): PriceCalculator\n\t{\n\t\tthis.#fields.extra = extra;\n\t\tif (Type.isNil(extra))\n\t\t{\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.calculateBasePrice(this.#fields.basePrice);\n\t}\n\n\tcalculateExtraType(extraType: PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE): PriceCalculator\n\t{\n\t\tif (extraType !== PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\textraType = PriceCalculator.EXTRA_TYPE_PERCENTAGE;\n\t\t}\n\n\t\tthis.#fields.extraType = extraType;\n\n\t\treturn this.calculateFinalPrice(this.#fields.finalPrice);\n\t}\n}","import {Tag, Loc} from 'main.core';\n\nexport class AccessDeniedInput\n{\n\thint: string;\n\ttext: string;\n\tisReadOnly: boolean;\n\n\tconstructor(options)\n\t{\n\t\tthis.text = options.text || Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_TEXT');\n\t\tthis.hint = options.hint;\n\t\tthis.isReadOnly = options.isReadOnly === true;\n\t}\n\n\trenderTo(node: Element): void\n\t{\n\t\tconst className =\n\t\t\tthis.isReadOnly\n\t\t\t\t? 'ui-ctl-no-border catalog-document-product-list-access-denied-readonly'\n\t\t\t\t: 'ui-ctl-disabled catalog-document-product-list-access-denied'\n\t\t;\n\t\tconst block = Tag.render`\n\t\t<div\n\t\t\tclass=\"ui-ctl ui-ctl-w100 ui-ctl-before-icon ui-ctl-after-icon ${className}\"\n\t\t\tdata-hint=\"${this.hint}\"\n\t\t\tdata-hint-no-icon\n\t\t>\n\t\t\t<div class=\"ui-ctl-before catalog-document-product-list-access-denied-lock\"></div>\n\t\t\t<div class=\"ui-ctl-after catalog-document-product-list-access-denied-hint\"></div>\n\t\t\t<div class=\"ui-ctl-element\">${this.text}</div>\n\t\t</div>\n\t\t`;\n\n\t\tnode.innerHTML = '';\n\t\tnode.appendChild(block);\n\n\t\tBX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\tangle: {\n\t\t\t\t\toffset: 100,\n\t\t\t\t},\n\t\t\t},\n\t\t}).init();\n\t}\n}\n","import {Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {Editor} from './product.list.editor';\nimport {CurrencyCore} from 'currency.currency-core';\nimport 'ui.hint';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\nimport {ProductSelector} from \"catalog.product-selector\";\nimport {StoreSelector} from \"catalog.store-selector\";\nimport {PopupMenu} from \"main.popup\";\nimport {PriceCalculator} from \"./price.calculator\";\nimport {AccessDeniedInput} from './access.denied.input';\n\ntype Action = {\n\ttype: string,\n\tfield?: string,\n\tvalue?: string,\n};\n\ntype Settings = {}\n\nconst MODE_EDIT = 'EDIT';\nconst MODE_SET = 'SET';\n\nexport class Row\n{\n\tid: ?string;\n\tsettings: Object;\n\teditor: ?Editor\n\tmodel: ?ProductModel\n\tfields: Object = {};\n\tmainSelector: ?ProductSelector;\n\tbarcodeSelector: ?ProductSelector;\n\tstoreSelectors: Array<StoreSelector> = [];\n\texternalActions: Array<Action> = [];\n\tcache = new Cache.MemoryCache();\n\tmodeChanges = {\n\t\tEDIT: MODE_EDIT,\n\t\tSET: MODE_SET,\n\t};\n\tvalidatingFields: Map<string, boolean> = new Map();\n\trealValues: ?Array;\n\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\n\t{\n\t\tthis.setId(id);\n\t\tthis.setSettings(settings);\n\t\tthis.setEditor(editor);\n\t\tthis.setModel(fields, settings);\n\t\tthis.initFields(fields);\n\t\tthis.#initSelector();\n\t\tthis.#initBarcode();\n\t\t// this.#initPriceExtra();\n\t\tthis.#initStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t\tthis.#initActions();\n\t\tthis.#hideFields();\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('node', () => {\n\t\t\tconst rowId = this.getField('ID', 0);\n\n\t\t\treturn this.getEditorContainer().querySelector('[data-id=\"' + rowId + '\"]');\n\t\t});\n\t}\n\n\tgetSelector(): ?ProductSelector\n\t{\n\t\treturn this.mainSelector;\n\t}\n\n\tgetBarcodeSelector(): ?ProductSelector\n\t{\n\t\treturn this.barcodeSelector;\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id: string): void\n\t{\n\t\tthis.id = id;\n\t}\n\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings: Settings): void\n\t{\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\n\t}\n\n\tgetSettingValue(name, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value): void\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tsetEditor(editor: Editor): void\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tgetEditor(): Editor\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorContainer(): HTMLElement\n\t{\n\t\treturn this.getEditor().getContainer();\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.getEditor().getHintPopup();\n\t}\n\n\tinitHandlers()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for text fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\tEvent.bind(node, 'blur', editor.blurProductFieldHandler)\n\t\t});\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for select fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t}\n\n\tinitHandlersForSelectors()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tlet selectorNames = ['MAIN_INFO', 'BARCODE_INFO'];\n\t\tconst storeFields = this.getSettingValue('storeHeaderMap', {});\n\t\tselectorNames = [...selectorNames, ...Object.keys(storeFields)];\n\n\t\tselectorNames.forEach((name) => {\n\t\t\tthis.getNode().querySelectorAll('[data-name=\"'+ name +'\"] input[type=\"text\"]').forEach(node => {\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t\t// disable drag-n-drop events for select fields\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\t});\n\t\t});\n\t}\n\n\t#initActions()\n\t{\n\t\tif (this.getEditor().isReadOnly() || this.getField('EDITABLE') === false)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tif (Type.isDomNode(actionCellContentContainer))\n\t\t{\n\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"#\"\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\n\t\t\t\t></a>\n\t\t\t`;\n\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\n\t\t\t\tconst menuItems = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_COPY_ACTION'),\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_DELETE_ACTION'),\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tPopupMenu.show({\n\t\t\t\t\tid: this.getId() + '_actions_popup',\n\t\t\t\t\tbindElement: actionsButton,\n\t\t\t\t\titems: menuItems\n\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\t#initSelector()\n\t{\n\t\tconst selectorOptions = {\n\t\t\tiblockId: this.model.getIblockId(),\n\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\tcurrency: this.model.getCurrency(),\n\t\t\tmodel: this.model,\n\t\t\tconfig: {\n\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: this.getSettingValue('isAllowedCreationProduct', true),\n\t\t\t\tENABLE_IMAGE_INPUT: true,\n\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\n\t\t\t\tROW_ID: this.getId(),\n\t\t\t\tENABLE_SKU_SELECTION: true,\n\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: true,\n\t\t\t\tRESTRICTED_PRODUCT_TYPES: this.getEditor().getRestrictedProductTypes(),\n\t\t\t\tURL_BUILDER_CONTEXT: this.editor.getSettingValue('productUrlBuilderContext'),\n\t\t\t},\n\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t};\n\n\t\tthis.mainSelector = new ProductSelector('catalog_document_grid_' + this.getId(), selectorOptions);\n\t\tconst mainInfoNode = this.getNode().querySelector('[data-name=\"MAIN_INFO\"]');\n\t\tif (mainInfoNode)\n\t\t{\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\n\t\t\tif (!Type.isDomNode(numberSelector))\n\t\t\t{\n\t\t\t\tmainInfoNode.appendChild(Tag.render`<div class=\"main-grid-row-number\"></div>`);\n\t\t\t}\n\n\t\t\tlet selectorWrapper =  mainInfoNode.querySelector('.main-grid-row-product-selector');\n\t\t\tif (!Type.isDomNode(selectorWrapper))\n\t\t\t{\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`\n\t\t\t\tmainInfoNode.appendChild(selectorWrapper)\n\t\t\t}\n\t\t\tthis.mainSelector.renderTo(selectorWrapper);\n\t\t}\n\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.mainSelector,\n\t\t\t'onBeforeCreate',\n\t\t\tthis.#handleBeforeCreateProduct.bind(this)\n\t\t);\n\t}\n\n\t#initBarcode()\n\t{\n\t\tconst selectorOptions = {\n\t\t\tiblockId: this.model.getIblockId(),\n\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\tcurrency: this.model.getCurrency(),\n\t\t\tmodel: this.model,\n\t\t\tinputFieldName: 'BARCODE',\n\t\t\ttype: ProductSelector.INPUT_FIELD_BARCODE,\n\t\t\tconfig: {\n\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: this.getSettingValue('isAllowedCreationProduct', true),\n\t\t\t\tENABLE_INFO_SPOTLIGHT: this.editor.getSettingValue('showBarcodeSpotlightInfo', true),\n\t\t\t\tENABLE_BARCODE_QR_AUTH: this.editor.getSettingValue('showBarcodeQrAuth', true),\n\t\t\t\tIS_INSTALLED_MOBILE_APP: this.editor.getSettingValue('isInstalledMobileApp', null),\n\t\t\t\tENABLE_IMAGE_INPUT: false,\n\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\tROW_ID: this.getId(),\n\t\t\t\tENABLE_SKU_SELECTION: false,\n\t\t\t\tENABLE_SKU_TREE: false,\n\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: false,\n\t\t\t\tRESTRICTED_PRODUCT_TYPES: this.getEditor().getRestrictedProductTypes(),\n\t\t\t},\n\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t\tscannerToken: this.getEditor().scannerToken,\n\t\t};\n\n\t\tthis.barcodeSelector = new ProductSelector('catalog_document_grid_' + this.getId() + '_barcode', selectorOptions);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBeforeCreate',\n\t\t\tthis.#handleBeforeCreateProduct.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onSpotlightClose',\n\t\t\tthis.#handleSpotlightClose.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeQrClose',\n\t\t\tthis.#handleBarcodeQrClose.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeScannerInstallChecked',\n\t\t\tthis.#handleBarcodeScannerInstallCheck.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeChange',\n\t\t\tthis.#handleBarcodeChange.bind(this)\n\t\t);\n\n\t\tthis.layoutBarcode();\n\t}\n\n\tlayoutBarcode(): void\n\t{\n\t\tconst barcodeWrapper = this.getNode().querySelector('[data-name=\"BARCODE_INFO\"]');\n\t\tif (this.barcodeSelector && barcodeWrapper)\n\t\t{\n\t\t\tbarcodeWrapper.innerHTML = '';\n\n\t\t\tif (this.#needBarcode())\n\t\t\t{\n\t\t\t\tthis.barcodeSelector.renderTo(barcodeWrapper);\n\t\t\t}\n\t\t}\n\t}\n\n\t#initPriceExtra()\n\t{\n\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE\"]');\n\t\tif (!Type.isDomNode(node))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldExtraNode = node.querySelector('.catalog-store-extra-price');\n\t\tif (Type.isDomNode(oldExtraNode))\n\t\t{\n\t\t\toldExtraNode.parentNode.removeChild(oldExtraNode);\n\t\t}\n\n\t\tconst extraValue = this.getField('BASE_PRICE_EXTRA') ?? '';\n\t\tconst inputValue = Tag.render`\n\t\t\t<div>\n\t\t\t\t<input\n\t\t\t\t\tplaceholder=\"-\"\n\t\t\t\t\tclass=\"catalog-store-extra-price\"\n\t\t\t\t\tdata-name=\"BASE_PRICE_EXTRA\"\n\t\t\t\t\tvalue=\"${extraValue}\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst extraMeasureValue =\n\t\t\tthis.getField('BASE_PRICE_EXTRA_RATE') === PriceCalculator.EXTRA_TYPE_MONETARY\n\t\t\t\t? this.getEditor().getCurrencyText()\n\t\t\t\t: '%'\n\t\t;\n\n\t\tconst measureValue = Tag.render`\n\t\t\t<div class=\"main-grid-editor main-grid-editor-money-currency\">\n\t\t\t\t<span class=\"main-dropdown-inner\" data-name=\"BASE_PRICE_EXTRA_RATE\">${extraMeasureValue}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(measureValue, 'click', () => {\n\t\t\tconst menuItems = [\n\t\t\t\t{\n\t\t\t\t\ttext: '%',\n\t\t\t\t\tonclick: this.handleSelectExtraPriceType.bind(this),\n\t\t\t\t\ttype: PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: this.getEditor().getCurrencyText(),\n\t\t\t\t\tonclick: this.handleSelectExtraPriceType.bind(this),\n\t\t\t\t\ttype: PriceCalculator.EXTRA_TYPE_MONETARY,\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tPopupMenu.show({\n\t\t\t\tid: this.getId() + '_extra_type_popup',\n\t\t\t\tbindElement: measureValue,\n\t\t\t\titems: menuItems\n\t\t\t});\n\t\t});\n\n\t\tconst extraNode = Tag.render`\n\t\t\t<div class=\"main-grid-editor catalog-store-extra-price\">\n\t\t\t\t${inputValue}\n\t\t\t\t${measureValue}\n\t\t\t</div>\n\t\t`;\n\n\t\tnode.appendChild(extraNode);\n\t}\n\n\t#initStoreSelector(fieldNames: {})\n\t{\n\t\tObject.keys(fieldNames).forEach( rowName => {\n\t\t\tconst selectorOptions = {\n\t\t\t\tinputFieldId: fieldNames[rowName],\n\t\t\t\tinputFieldTitle: fieldNames[rowName] + '_TITLE',\n\t\t\t\tisDisabledEmpty: true,\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t},\n\t\t\t\tmode: StoreSelector.MODE_EDIT,\n\t\t\t\tmodel: this.model,\n\t\t\t};\n\n\t\t\tconst storeSelector = new StoreSelector(this.getId() + '_' + rowName, selectorOptions);\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tstoreSelector,\n\t\t\t\t'onChange',\n\t\t\t\tRuntime.debounce(this.#onStoreFieldChange.bind(this), 500, this)\n\t\t\t);\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tstoreSelector,\n\t\t\t\t'onClear',\n\t\t\t\tRuntime.debounce(this.#onStoreFieldChange.bind(this), 500, this)\n\t\t\t);\n\n\t\t\tthis.storeSelectors.push(storeSelector);\n\t\t});\n\n\t\tthis.layoutStoreSelector(fieldNames);\n\t}\n\n\tlayoutStoreSelector(fieldNames: {})\n\t{\n\t\tObject.keys(fieldNames).forEach(rowName => {\n\t\t\tconst selectorId = this.getId() + '_' + rowName;\n\n\t\t\tthis.storeSelectors.forEach((selector) => {\n\t\t\t\tif (selector.getId() === selectorId)\n\t\t\t\t{\n\t\t\t\t\tconst storeWrapper = this.getNode().querySelector('[data-name=\"' + rowName + '\"]');\n\t\t\t\t\tif (storeWrapper)\n\t\t\t\t\t{\n\t\t\t\t\t\tstoreWrapper.innerHTML = '';\n\n\t\t\t\t\t\tif (this.#needInventory())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tselector.renderTo(storeWrapper);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t#onStoreFieldChange(event)\n\t{\n\t\tconst data = event.getData();\n\t\tdata.fields.forEach((item) => {\n\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t});\n\t}\n\n\tsetRowNumber(number)\n\t{\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach(node => {\n\t\t\tnode.textContent = number + '.';\n\t\t});\n\t}\n\n\tgetFields(fields: Array = [])\n\t{\n\t\tlet result;\n\n\t\tif (!Type.isArrayFilled(fields))\n\t\t{\n\t\t\tresult = Runtime.clone(this.fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\n\t\t\tfor (let fieldName of fields)\n\t\t\t{\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\n\t\t\t}\n\t\t}\n\n\t\t// merge with real values\n\t\tconst realValues = this.#getRealValues();\n\t\tfor (const fieldName in realValues)\n\t\t{\n\t\t\tif (\n\t\t\t\tObject.hasOwnProperty.call(realValues, fieldName)\n\t\t\t\t&& Object.hasOwnProperty.call(result, fieldName)\n\t\t\t)\n\t\t\t{\n\t\t\t\tresult[fieldName] = realValues[fieldName];\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Get real values field.\n\t *\n\t * Stores the real values of rows that are hidden due to lack of user access.\n\t *\n\t * @returns\n\t */\n\t#getRealValues()\n\t{\n\t\tif (!!this.realValues)\n\t\t{\n\t\t\treturn this.realValues\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst value = this.getField('REAL_VALUES');\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\tconst parsedValue = JSON.parse(atob(value));\n\t\t\t\tif (Type.isPlainObject(parsedValue))\n\t\t\t\t{\n\t\t\t\t\tthis.realValues = parsedValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error('Cannot parse REAL_VALUE: ' + e.getMessage());\n\t\t}\n\n\t\treturn this.realValues;\n\t}\n\n\tinitFields(fields: Object): void\n\t{\n\t\tthis.getModel().initFields(fields, false);\n\t\tthis.setFields(fields);\n\t}\n\n\tsetFields(fields: Object): void\n\t{\n\t\tfor (let name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\tif (name !== 'REAL_VALUES')\n\t\t{\n\t\t\tconst realValues = this.#getRealValues();\n\t\t\tif (realValues && Object.hasOwnProperty.call(realValues, name))\n\t\t\t{\n\t\t\t\treturn realValues[name];\n\t\t\t}\n\t\t}\n\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value, changeModel: boolean = true): void\n\t{\n\t\tthis.fields[name] = value;\n\n\t\tif (changeModel)\n\t\t{\n\t\t\tthis.getModel().setField(name, value);\n\t\t}\n\t}\n\n\tgetUiFieldId(field): string\n\t{\n\t\treturn this.getId() + '_' + field;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tgetAmount(): number\n\t{\n\t\treturn this.getField('AMOUNT', 1);\n\t}\n\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\n\t{\n\t\tconst target = event.target;\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\tconst mode = (event.type === 'input' || event.type === 'change') ? MODE_EDIT : MODE_SET;\n\n\t\tthis.updateField(fieldCode, value, mode);\n\t}\n\n\tupdateDropdownField(fieldCode: string, value: any): void\n\t{\n\t\tthis.updateField(fieldCode, value, MODE_EDIT);\n\t}\n\n\tupdateField(fieldCode: string, value: any, mode = MODE_SET): void\n\t{\n\t\tthis.resetExternalActions();\n\t\tthis.updateFieldValue(fieldCode, value, mode);\n\t\tthis.executeExternalActions();\n\t}\n\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'SKU_ID':\n\t\t\t\tthis.changeProductId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tthis.changeBasePrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\t// case 'BASE_PRICE_EXTRA':\n\t\t\t// \tthis.changeExtra(value, mode);\n\t\t\t// \tbreak;\n\n\t\t\tcase 'PURCHASING_PRICE':\n\t\t\t\tthis.changePurchasingPrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'AMOUNT':\n\t\t\t\tthis.changeAmount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'MEASURE_CODE':\n\t\t\t\tthis.changeMeasureCode(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'BARCODE':\n\t\t\t\tthis.changeBarcode(value, mode);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_FROM':\n\t\t\tcase 'STORE_TO':\n\t\t\t\tthis.changeStore(value, code);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_FROM_TITLE':\n\t\t\tcase 'STORE_TO_TITLE':\n\t\t\t\tthis.changeStoreName(value, code);\n\t\t\t\tbreak;\n\t\t\tcase 'NAME':\n\t\t\tcase 'MAIN_INFO':\n\t\t\t\tthis.changeProductName(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SORT':\n\t\t\t\tthis.changeSort(value, mode);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateFieldByName(field, value)\n\t{\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.setTaxIncluded(value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tchangeProductId(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tthis.setProductId(preparedValue);\n\t}\n\n\thandleCopyAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.copyRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\thandleDeleteAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.deleteRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t\tthis.unsubscribeEvents();\n\n\t\tthis.#handleProductErrorsChange();\n\t}\n\n\tunsubscribeEvents()\n\t{\n\t\tthis.getBarcodeSelector().unsubscribeEvents();\n\t}\n\n\thandleSelectExtraPriceType(event, menuItem)\n\t{\n\t\tthis.changeExtraType(menuItem.type, MODE_EDIT);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\t#getCalculator()\n\t{\n\t\tconst extra =\n\t\t\tType.isNumber(this.getModel().getField('BASE_PRICE_EXTRA'))\n\t\t\t\t? this.getModel().getField('BASE_PRICE_EXTRA')\n\t\t\t\t: null\n\t\t;\n\n\t\treturn new PriceCalculator({\n\t\t\tbasePrice: Text.toNumber(this.getModel().getField('PURCHASING_PRICE')),\n\t\t\tfinalPrice: Text.toNumber(this.getModel().getField('BASE_PRICE')),\n\t\t\textra,\n\t\t\textraType: Text.toNumber(this.getModel().getField('BASE_PRICE_EXTRA_RATE')),\n\t\t});\n\t}\n\n\tchangeExtraType(value, mode = MODE_SET)\n\t{\n\t\tlet text = '%';\n\t\tif (value === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\ttext = this.getEditor().getCurrencyText();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvalue = PriceCalculator.EXTRA_TYPE_PERCENTAGE;\n\t\t}\n\n\t\tif (value === this.getField('BASE_PRICE_EXTRA_RATE'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst calculator =\n\t\t\t\tthis.#getCalculator()\n\t\t\t\t\t.calculateExtraType(value)\n\t\t\t;\n\n\t\t\tthis.changeExtra(calculator.getExtra());\n\t\t\tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t}\n\n\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE_EXTRA_RATE\"]');\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tnode.innerHTML = text;\n\t\t}\n\n\t\tthis.setField('BASE_PRICE_EXTRA_RATE', value);\n\t}\n\n\tchangeExtra(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = (Type.isNil(value) || value === '') ? null : this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setField('BASE_PRICE_EXTRA', preparedValue);\n\n\t\tif (preparedValue === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst calculator =\n\t\t\t\tthis.#getCalculator()\n\t\t\t\t\t.calculateExtra(preparedValue)\n\t\t\t;\n\n\t\t\tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE_EXTRA\"]');\n\t\t\tif (Type.isDomNode(node))\n\t\t\t{\n\t\t\t\tnode.value = preparedValue;\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeBasePrice(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setBasePrice(preparedValue, mode);\n\n\t\t// if (mode === MODE_EDIT)\n\t\t// {\n\t\t// \tconst calculator =\n\t\t// \t\tthis.#getCalculator()\n\t\t// \t\t\t.calculateFinalPrice(preparedValue)\n\t\t// \t;\n\t\t//\n\t\t// \tthis.changeExtra(calculator.getExtra());\n\t\t// \tthis.changeExtraType(calculator.getExtraType());\n\t\t// }\n\t}\n\n\tchangePurchasingPrice(value, mode = MODE_SET)\n\t{\n\t\tif (this.#isPurchasingPriceAccessDenied())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setPurchasingPrice(preparedValue, mode);\n\n\t\t// const currentExtra = this.getField('BASE_PRICE_EXTRA');\n\t\t// if (mode === MODE_EDIT && !Type.isNil(currentExtra) && currentExtra !== '')\n\t\t// {\n\t\t// \tconst calculator =\n\t\t// \t\tthis.#getCalculator()\n\t\t// \t\t\t.calculateBasePrice(preparedValue)\n\t\t// \t;\n\t\t//\n\t\t// \tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t// }\n\t}\n\n\tchangeAmount(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\n\t\tthis.setAmount(preparedValue, mode);\n\t}\n\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\n\t{\n\t\tthis\n\t\t\t.getEditor()\n\t\t\t.getMeasures()\n\t\t\t.filter((item) => item.CODE === value)\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\n\t\t;\n\t}\n\n\tchangeBarcode(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('BARCODE') !== preparedValue;\n\n\t\tif (isChangedValue && mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('BARCODE', preparedValue);\n\t\t\tthis.setField('DOC_BARCODE', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t\telse if (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.setField('DOC_BARCODE', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStore(value: number, code: string)\n\t{\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tconst isChangedValue = this.getField(code) !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField(code, preparedValue);\n\t\t\tthis.setStoreAmount(value, code);\n\t\t\tthis.layoutStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStoreName(value: number, code: string)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tthis.setField(code, preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeProductName(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('NAME') !== preparedValue;\n\n\t\tif (isChangedValue && mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('NAME', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeSort(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('SORT', preparedValue);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\n\t{\n\t\tfor (let field in this.fields)\n\t\t{\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\n\t\t\t{\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\n\t\t\t}\n\t\t}\n\t\tthis.updateUiMeasure(\n\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\tthis.getField('MEASURE_NAME')\n\t\t)\n\t\tthis.getSelector()?.reloadFileInput();\n\t\tthis.getSelector()?.layout();\n\t\tthis.getBarcodeSelector()?.layout();\n\t\tthis.updateUiStoreValues();\n\t}\n\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\n\t{\n\t\tconst selectorId = 'catalog_document_grid_' + this.getId();\n\t\tif (selectorId)\n\t\t{\n\t\t\tconst model = ProductModel.getById(selectorId);\n\t\t\tif (model)\n\t\t\t{\n\t\t\t\tthis.model = model;\n\t\t\t}\n\t\t}\n\n\t\tif (!(this.model instanceof ProductModel))\n\t\t{\n\t\t\tthis.model = new ProductModel({\n\t\t\t\tid: selectorId,\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\n\t\t\t\tiblockId: fields['IBLOCK_ID'],\n\t\t\t\tbasePriceId: fields['BASE_PRICE_ID'],\n\t\t\t\tskuTree: Type.isStringFilled(fields['SKU_TREE']) ? JSON.parse(fields['SKU_TREE']) : null,\n\t\t\t\tstoreMap: fields['STORE_AMOUNT_MAP'],\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tif (Type.isObject(fields['IMAGE_INFO']))\n\t\t\t{\n\t\t\t\tthis.model.getImageCollection().setPreview(fields['IMAGE_INFO']['preview']);\n\t\t\t\tthis.model.getImageCollection().setEditInput(fields['IMAGE_INFO']['input']);\n\t\t\t\tthis.model.getImageCollection().setMorePhotoValues(fields['IMAGE_INFO']['values']);\n\t\t\t}\n\n\t\t\tif (!Type.isNil(fields['DETAIL_URL']))\n\t\t\t{\n\t\t\t\tthis.model.setDetailPath(fields['DETAIL_URL']);\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tRuntime.debounce(this.#handleProductErrorsChange, 500, this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.updateUiStoreValues.bind(this)\n\t\t);\n\t}\n\n\tgetModel(): ?ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\t#handleProductErrorsChange()\n\t{\n\t\tconst errors = this.getModel().getErrorCollection().getErrors();\n\t\tfor (const code in errors)\n\t\t{\n\t\t\tif (code === ProductSelector.ErrorCodes.NOT_SELECTED_PRODUCT || code === StoreSelector.ErrorCodes.NOT_SELECTED_STORE)\n\t\t\t{\n\t\t\t\tthis.getSelector().layoutErrors();\n\t\t\t}\n\t\t}\n\n\t\tthis.getEditor().handleProductErrorsChange();\n\t}\n\n\t#handleBeforeCreateProduct(event: BaseEvent)\n\t{\n\t\tconst {model} = event.getData();\n\t\tmodel.setField('BARCODE', this.barcodeSelector.getNameInputFilledValue());\n\t\tmodel.setField('NAME', this.mainSelector.getNameInputFilledValue());\n\t}\n\n\t#handleSpotlightClose(event: BaseEvent): void\n\t{\n\t\tthis.editor.closeBarcodeSpotlights();\n\t}\n\n\t#handleBarcodeQrClose(event: BaseEvent): void\n\t{\n\t\tthis.editor.closeBarcodeQrAuths();\n\t}\n\n\t#handleBarcodeScannerInstallCheck(event: BaseEvent): void\n\t{\n\t\tthis.editor.enableSendBarcodeMobilePush();\n\t}\n\n\t#handleBarcodeChange(event: BaseEvent): void\n\t{\n\t\tconst {value} = event.getData();\n\t\tthis.changeBarcode(value, MODE_EDIT);\n\t}\n\n\tsetProductId(value)\n\t{\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_ID', value);\n\t\t\tthis.setField('SKU_ID', value);\n\n\t\t\tthis.updateUiStoreValues();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tthis.#hidePurchasingPrice();\n\t\t}\n\t}\n\n\tsetBasePrice(value, mode = MODE_SET)\n\t{\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiField('BASE_PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\t\tthis.setField('BASE_PRICE', value);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\n\t\tthis.updateRowTotalPrice();\n\t}\n\n\tupdateRowTotalPrice()\n\t{\n\t\tconst field = this.getEditor().getSettingValue('totalCalculationSumField', 'PURCHASING_PRICE');\n\t\tlet value = this.getAmount() * this.getField(field, 0);\n\t\tvalue = Math.max(value, 0);\n\n\t\tthis.setField('TOTAL_PRICE', value);\n\t\tthis.updateUiField('TOTAL_PRICE', value.toFixed(this.getPricePrecision()));\n\t}\n\n\tupdateProductStoreValues()\n\t{\n\t\tthis.storeSelectors.forEach((selector) => {\n\t\t\tselector.setProductId(this.getModel().getSkuId());\n\t\t});\n\t}\n\n\tupdateUiStoreValues()\n\t{\n\t\tconst storeHeaderMap = this.getSettingValue('storeHeaderMap', {});\n\t\tObject.keys(storeHeaderMap).forEach((key) => {\n\t\t\tconst fieldName = storeHeaderMap[key];\n\t\t\tlet value = this.getField(fieldName);\n\t\t\tif (fieldName === 'STORE_FROM')\n\t\t\t{\n\t\t\t\tconst currentAmount = this.model.getStoreCollection().getStoreAmount(value);\n\t\t\t\tif (currentAmount <= 0)\n\t\t\t\t{\n\t\t\t\t\tconst maxStore = this.model.getStoreCollection().getMaxFilledStore();\n\t\t\t\t\tconst storeSelector = StoreSelector.getById(this.getId() + '_' + key);\n\t\t\t\t\tif (maxStore.AMOUNT > currentAmount && storeSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tstoreSelector.onStoreSelect(maxStore.STORE_ID, maxStore.STORE_TITLE);\n\t\t\t\t\t\tvalue = maxStore.STORE_ID;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setStoreAmount(value, fieldName)\n\t\t})\n\n\t\tthis.layoutStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t}\n\n\tsetStoreAmount(value, fieldName, mode = MODE_SET)\n\t{\n\t\tif (!this.model.getStoreCollection().isInited())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// price can't be less than zero\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tlet amount;\n\n\t\t\tconst amounts = {\n\t\t\t\t'_AMOUNT': () => this.model.getStoreCollection().getStoreAmount(value),\n\t\t\t\t'_RESERVED': () => this.model.getStoreCollection().getStoreReserved(value),\n\t\t\t\t'_AVAILABLE_AMOUNT': () => this.model.getStoreCollection().getStoreAvailableAmount(value),\n\t\t\t};\n\t\t\tfor (const postfix in amounts) {\n\t\t\t\tif (Object.hasOwnProperty.call(amounts, postfix)) {\n\t\t\t\t\tconst wrapper = this.#getNodeChildByDataName(fieldName + postfix);\n\t\t\t\t\tif (wrapper)\n\t\t\t\t\t{\n\t\t\t\t\t\twrapper.innerHTML = '';\n\n\t\t\t\t\t\tif (this.#needInventory())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tamount = amounts[postfix]() || 0;\n\n\t\t\t\t\t\t\tconst amountWithMeasure = amount + ' ' + Text.encode(this.getField('MEASURE_NAME'));\n\t\t\t\t\t\t\tlet htmlAmount = amountWithMeasure;\n\n\t\t\t\t\t\t\tif (postfix === '_AVAILABLE_AMOUNT')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\thtmlAmount =\n\t\t\t\t\t\t\t\t\tamount > 0\n\t\t\t\t\t\t\t\t\t\t? amountWithMeasure\n\t\t\t\t\t\t\t\t\t\t: `<span class=\"text--danger\">${amountWithMeasure}</span>`\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\twrapper.innerHTML = htmlAmount;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsetPurchasingPrice(value, mode = MODE_SET)\n\t{\n\t\tif (this.#isPurchasingPriceAccessDenied())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiField('PURCHASING_PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\t\tthis.setField('PURCHASING_PRICE', value);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\n\t\tthis.updateRowTotalPrice();\n\t}\n\n\tsetAmount(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('AMOUNT', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('AMOUNT') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('AMOUNT', value);\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tthis.updateRowTotalPrice();\n\t\t}\n\t}\n\n\tsetMeasure(measure, mode = MODE_SET)\n\t{\n\t\tif (this.model.isEmpty())\n\t\t{\n\t\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\t\t\tthis.updateUiMeasure(measure.CODE,\tmeasure.SYMBOL);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.getModel().showSaveNotifier(\n\t\t\t\t'measureChanger_' + this.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\n\t\t\t\t\tdeclineCancelTitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_DECLINE_SAVE'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\t\t\t\t\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\t\t\t\t\t\t\tthis.updateUiMeasure(\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_NAME')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\t\tthis.updateUiMeasure(\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_NAME')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateUiMeasure(measure.CODE,\tmeasure.SYMBOL);\n\t\t}\n\n\t\tthis.addActionProductChange();\n\t}\n\n\t// controls\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst fieldId = this.getUiFieldId(fieldName);\n\t\tlet item = document.getElementById(fieldId);\n\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\titem = this.getNode().querySelector('[name=\"' + fieldId + '\"]');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tgetInputWrapperByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst inputBlock = this.getInputByFieldName(fieldName);\n\n\t\tif (Type.isElementNode(inputBlock))\n\t\t{\n\t\t\treturn Type.isElementNode(inputBlock.parentNode) ? inputBlock.parentNode : inputBlock;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tupdateUiInputField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.value = value;\n\t\t}\n\t}\n\n\tupdateUiCheckboxField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.checked = value === 'Y';\n\t\t}\n\t}\n\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\n\t{\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.dropdownManager.getById(this.getId() + '_' + name + '_control');\n\t}\n\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\n\t{\n\t\tif (dropdown.getValue() === value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (dropdown.menu)\n\t\t{\n\t\t\tdropdown.menu.destroy();\n\t\t}\n\n\t\tconst item = dropdown.menu.itemsContainer.querySelector('[data-value=\"' + value + '\"]');\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\n\t\tif (menuItem)\n\t\t{\n\t\t\tdropdown.refresh(menuItem);\n\t\t\tdropdown.selectItem(menuItem);\n\t\t}\n\t}\n\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.dataset.value = value;\n\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\n\t\tif (!Type.isElementNode(span))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tspan.innerHTML = text;\n\t}\n\n\tupdateUiMeasure(code, name)\n\t{\n\t\tthis.updateUiMoneyField(\n\t\t\t'MEASURE_CODE',\n\t\t\tcode,\n\t\t\tText.encode(name)\n\t\t);\n\n\t\tthis.updateUiStoreValues();\n\t}\n\n\tupdateUiHtmlField(name, html)\n\t{\n\t\tconst item = this.getNode().querySelector('[data-name=\"' + name + '\"]');;\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.innerHTML = html;\n\t\t}\n\t}\n\n\tupdateUiCurrencyFields()\n\t{\n\t\tconst currencyText = this.getEditor().getCurrencyText();\n\t\tconst currencyId = '' + this.getEditor().getCurrencyId();\n\n\t\tconst currencyFieldNames = ['BASE_PRICE_CURRENCY', 'PURCHASING_PRICE_CURRENCY'];\n\t\tcurrencyFieldNames.forEach((name) => {\n\t\t\tconst dropdownValues = [];\n\t\t\tdropdownValues.push({\n\t\t\t\tNAME: currencyText,\n\t\t\t\tVALUE: currencyId,\n\t\t\t});\n\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\n\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\n\t\t});\n\t}\n\n\tupdateUiField(field, value): void\n\t{\n\t\tconst uiName = this.getUiFieldName(field);\n\t\tif (!uiName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst uiType = this.getUiFieldType(field);\n\t\tif (!uiType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (uiType)\n\t\t{\n\t\t\tcase 'input':\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money':\n\t\t\t\tvalue = BX.util.number_format(value, this.getPricePrecision(), \".\", \"\");\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money_html':\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetUiFieldName(field)\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'AMOUNT':\n\t\t\tcase 'MEASURE_CODE':\n\t\t\tcase 'BASE_PRICE':\n\t\t\tcase 'PURCHASING_PRICE':\n\t\t\tcase 'TOTAL_PRICE':\n\t\t\t\tresult = field;\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetUiFieldType(field)\n\t{\n\t\tconst moneyFields = ['BASE_PRICE', 'PURCHASING_PRICE', 'TOTAL_PRICE'];\n\t\tif (moneyFields.includes(field))\n\t\t{\n\t\t\tconst column = this.getEditor()?.getColumnInfo(field);\n\t\t\tif (column?.editable?.TYPE === 'MONEY')\n\t\t\t{\n\t\t\t\treturn  'money';\n\t\t\t}\n\n\t\t\treturn  'money_html';\n\t\t}\n\t\telse if (field === 'AMOUNT')\n\t\t{\n\t\t\treturn  'input';\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// proxy\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\treturn this.getEditor().parseInt(value, defaultValue);\n\t}\n\n\tparseFloat(value: number | string, precision: number, defaultValue = 0)\n\t{\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\n\t}\n\n\tgetPricePrecision()\n\t{\n\t\treturn this.getEditor().getPricePrecision();\n\t}\n\n\tgetQuantityPrecision()\n\t{\n\t\treturn this.getEditor().getQuantityPrecision();\n\t}\n\n\tgetCommonPrecision()\n\t{\n\t\treturn this.getEditor().getCommonPrecision();\n\t}\n\n\tresetExternalActions()\n\t{\n\t\tthis.externalActions.length = 0;\n\t}\n\n\taddExternalAction(action: Action)\n\t{\n\t\tthis.externalActions.push(action);\n\t}\n\n\taddActionProductChange()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.productChange,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionUpdateTotal()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateTotal\n\t\t});\n\t}\n\n\texecuteExternalActions()\n\t{\n\t\tif (this.externalActions.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getEditor().executeActions(this.externalActions);\n\t\tthis.resetExternalActions();\n\t}\n\n\tisEmptyRow()\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('NAME', '').trim())\n\t\t\t&& this.model.isEmpty()\n\t\t\t&& this.getBasePrice() <= 0\n\t\t)\n\t}\n\n\tvalidate(): Array\n\t{\n\t\tconst errorsList = [];\n\n\t\tif (!this.#isProductCountCorrect(this.getAmount()))\n\t\t{\n\t\t\tthis.#subscribeFieldToValidator('AMOUNT', this.#isProductCountCorrect);\n\t\t\terrorsList.push(Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_INVALID_AMOUNT_2'));\n\t\t}\n\n\t\treturn errorsList;\n\t}\n\n\t#subscribeFieldToValidator(fieldName: string, validatorCallback: Function): void\n\t{\n\t\tconst fieldInput = this.getInputByFieldName(fieldName);\n\t\tconst fieldWrapper = this.getInputWrapperByFieldName(fieldName);\n\n\t\tif (validatorCallback(fieldInput.valueAsNumber) || this.validatingFields.get(fieldName))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.validatingFields.set(fieldName, true);\n\n\t\tfieldWrapper.classList.add('main-grid-editor-cell-danger');\n\n\t\tconst validator = (eventObject) => {\n\t\t\tif (Boolean(validatorCallback(eventObject.target.valueAsNumber)))\n\t\t\t{\n\t\t\t\tthis.validatingFields.set(fieldName, false);\n\t\t\t\tEvent.unbind(fieldInput, 'blur', validator);\n\t\t\t\tfieldWrapper.classList.remove('main-grid-editor-cell-danger');\n\t\t\t}\n\t\t};\n\n\t\tEvent.bind(fieldInput, 'blur', validator);\n\t}\n\n\t#isProductCountCorrect(amountValue): boolean\n\t{\n\t\treturn amountValue > 0;\n\t}\n\n\t#getNodeChildByDataName(name: String): HTMLElement\n\t{\n\t\treturn this.getNode().querySelector(`[data-name=\"${name}\"]`);\n\t}\n\n\t#needInventory(): boolean\n\t{\n\t\treturn !this.getModel().isService();\n\t}\n\n\t#needBarcode(): boolean\n\t{\n\t\treturn !this.getModel().isService();\n\t}\n\n\t#isRowAccessDenied()\n\t{\n\t\treturn this.getField('ACCESS_DENIED') === true;\n\t}\n\n\t#hideFields()\n\t{\n\t\tif (!this.#isRowAccessDenied())\n\t\t{\n\t\t\tthis.#hidePurchasingPrice();\n\t\t\treturn;\n\t\t}\n\n\t\tconst hiddenFields = this.getEditor().getSettingValue('hiddenFields');\n\t\tconst columnIndexes = this.getEditor().getGridColumnIndexes();\n\n\t\thiddenFields.forEach((fieldName) => {\n\t\t\tconst columnIndex = columnIndexes[fieldName];\n\t\t\tif (columnIndex === undefined)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = this.getNode().querySelector(`.main-grid-cell:nth-child(${columnIndex+1}) .main-grid-cell-content`);\n\t\t\tif (Type.isElementNode(item))\n\t\t\t{\n\t\t\t\titem.innerHTML = '';\n\t\t\t}\n\t\t});\n\n\t\tconst fieldWithHintIndex = columnIndexes['AMOUNT'];\n\t\tif (fieldWithHintIndex)\n\t\t{\n\t\t\tconst fieldWithHintNode = this.getNode().querySelector(`.main-grid-cell:nth-child(${fieldWithHintIndex+1}) .main-grid-cell-content`);\n\t\t\tif (fieldWithHintNode)\n\t\t\t{\n\t\t\t\tconst input = new AccessDeniedInput({\n\t\t\t\t\thint: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_STORE_HINT'),\n\t\t\t\t\tisReadOnly: this.getEditor().isReadOnly(),\n\t\t\t\t});\n\t\t\t\tinput.renderTo(fieldWithHintNode);\n\t\t\t}\n\t\t}\n\t}\n\n\t#isPurchasingPriceAccessDenied()\n\t{\n\t\treturn this.getField('ACCESS_DENIED_TO_PURCHASING_PRICE') === true;\n\t}\n\n\t#hidePurchasingPrice()\n\t{\n\t\tif (!this.#isPurchasingPriceAccessDenied())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst columnIndexes = this.getEditor().getGridColumnIndexes();\n\t\tconst fieldWithHintIndex = columnIndexes['PURCHASING_PRICE'];\n\t\tif (fieldWithHintIndex)\n\t\t{\n\t\t\tconst fieldWithHintNode = this.getNode().querySelector(`.main-grid-cell:nth-child(${fieldWithHintIndex+1})`);\n\t\t\tif (fieldWithHintNode)\n\t\t\t{\n\t\t\t\tconst priceNode = fieldWithHintNode.querySelector('.main-grid-editor-container');\n\t\t\t\tif (priceNode)\n\t\t\t\t{\n\t\t\t\t\tpriceNode.remove();\n\t\t\t\t}\n\n\t\t\t\tconst contentNode = fieldWithHintNode.querySelector('.main-grid-cell-content');\n\t\t\t\tif (contentNode)\n\t\t\t\t{\n\t\t\t\t\tconst input = new AccessDeniedInput({\n\t\t\t\t\t\thint: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_PURCHASING_PRICE_HINT'),\n\t\t\t\t\t\tisReadOnly: this.getEditor().isReadOnly(),\n\t\t\t\t\t});\n\t\t\t\t\tinput.renderTo(contentNode);\n\t\t\t\t\tcontentNode.style.display = 'block';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import {Popup} from 'main.popup';\nimport {ajax, Cache, Event, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {Editor} from './product.list.editor';\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\t#getSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title\">${item.title}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.#getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.#requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\t#requestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tconst message = enabled\n\t\t\t\t? Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_ENABLED')\n\t\t\t\t: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_DISABLED');\n\n\t\t\tthis.#showNotification(message.replace('#NAME#', setting.title), {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}","// @flow\n\nimport {Event} from 'main.core';\nimport {Guide} from 'ui.tour';\nimport 'spotlight';\n\nexport class FieldHintManager\n{\n\tfieldHintIsBusy: boolean = false;\n\tactiveHintGuide: Guide|null = null;\n\n\t#gridGetter: Function;\n\t#contentContainer: HTMLElement;\n\n\tconstructor(contentContainer: HTMLElement, gridGetter: Function)\n\t{\n\t\tthis.#contentContainer = contentContainer;\n\t\tthis.#gridGetter = gridGetter;\n\t}\n\n\tprocessFieldTour(fieldNode: HTMLElement, tourData: Object, endTourHandler: Function, addictedFieldNodes: Array<HTMLElement> = []): void\n\t{\n\t\tif (this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fieldHintIsBusy = true;\n\t\t// When click action in progress tour will be closed -> 'onClose' tour method will be executed\n\t\ttourData.events = {\n\t\t\tonClose: () => {\n\t\t\t\tendTourHandler();\n\t\t\t\tthis.fieldHintIsBusy = false;\n\t\t\t\tthis.activeHintGuide = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#fieldNodeIsInGridVision(fieldNode))\n\t\t{\n\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\ttourObject.close();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\t\tconst fieldPos = fieldNode.getClientRects()[0].x;\n\t\t\tconst gridPos = gridContainer.getClientRects()[0].x;\n\n\t\t\tlet spotlight = null;\n\t\t\tif (fieldPos > gridPos) {\n\t\t\t\tspotlight = this.#bindSpotlightToNode(rightArrow);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tspotlight = this.#bindSpotlightToNode(leftArrow);\n\t\t\t}\n\n\t\t\tthis.#bindGridNodeVisionChange(fieldNode, () => {\n\t\t\t\tspotlight.close();\n\t\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\t\ttourObject.close();\n\t\t\t\t})\n\t\t\t}, [], addictedFieldNodes);\n\t\t}\n\t}\n\n\t#bindGridNodeVisionChange(observedNode: HTMLElement, onSuccessVisionCallback: Function, callbackParams: Array = [], addictedNodes: Array<HTMLElement> = [])\n\t{\n\t\tconst observedNodes = this.#getPossibleToValidateFieldNodes(observedNode, ...addictedNodes);\n\t\tconst observer = (event: Event) => {\n\t\t\tif (this.#fieldNodeIsInGridVision(...observedNodes))\n\t\t\t{\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t\t\t'scroll',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\t\t\t\tEvent.unbind(\n\t\t\t\t\twindow,\n\t\t\t\t\t'resize',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\n\t\t\t\tonSuccessVisionCallback(...callbackParams);\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(\n\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t'scroll',\n\t\t\tobserver\n\t\t);\n\t\tEvent.bind(\n\t\t\twindow,\n\t\t\t'resize',\n\t\t\tobserver\n\t\t);\n\t}\n\n\t#getPossibleToValidateFieldNodes(mainNode: HTMLElement, ...addictedNodes: Array<HTMLElement>): Array<HTMLElement>\n\t{\n\t\tconst nodesTuple = [];\n\t\tfor (const addictedNode: HTMLElement of addictedNodes)\n\t\t{\n\t\t\tnodesTuple.push({\n\t\t\t\tnode: addictedNode,\n\t\t\t\tnodeRect: addictedNode.getClientRects()[0],\n\t\t\t});\n\t\t}\n\n\t\tconst mainNodeTupleEl = {\n\t\t\tnode: mainNode,\n\t\t\tnodeRect: mainNode.getClientRects()[0],\n\t\t};\n\t\tnodesTuple.push(mainNodeTupleEl);\n\n\t\tnodesTuple.sort((firstEl, secondEl) => {\n\t\t\tconst {x: firstX} = firstEl.nodeRect;\n\t\t\tconst {x: secondX} = secondEl.nodeRect;\n\n\t\t\tif (firstX < secondX)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\telse if (firstX > secondX)\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t});\n\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\t\tfunction widthIsValid(leftPos: number, rightPos: number)\n\t\t{\n\t\t\treturn Math.abs(leftPos - rightPos) < gridRect.width;\n\t\t}\n\n\t\twhile (nodesTuple.length > 1 && !widthIsValid(nodesTuple[0].nodeRect.x,nodesTuple[nodesTuple.length-1].nodeRect.x))\n\t\t{\n\t\t\tconst firstEl = nodesTuple[0];\n\t\t\tconst lastEl = nodesTuple[nodesTuple.length-1];\n\t\t\tif (firstEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.pop();\n\t\t\t}\n\t\t\telse if (lastEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.shift();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst firstElDistance = mainNodeTupleEl.nodeRect.x - firstEl.nodeRect.x;\n\t\t\t\tconst lastElDistance = lastEl.nodeRect.x - mainNodeTupleEl.nodeRect.x;\n\t\t\t\tif (firstElDistance >= lastElDistance)\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.shift();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.pop();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn nodesTuple.map((el) => el.node);\n\t}\n\n\t#fieldNodeIsInGridVision(...fieldNodes: Array<HTMLElement>) {\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\n\t\tif (gridRect === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst gridLeftEdge = gridRect.x;\n\t\tconst gridRightEdge = gridRect.x + gridRect.width;\n\n\t\tfor (const fieldNode: HTMLElement of fieldNodes)\n\t\t{\n\t\t\tconst fieldRect = fieldNode.getClientRects()?.[0];\n\t\t\tif (fieldRect === undefined)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst fieldLeftEdge = fieldRect.x;\n\t\t\tconst fieldRightEdge = fieldRect.x + fieldRect.width;\n\n\t\t\tif (fieldLeftEdge < gridLeftEdge || fieldRightEdge > gridRightEdge)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#bindSpotlightToNode(targetNode: HTMLElement)\n\t{\n\t\tconst spotlight = new BX.SpotLight(\n\t\t\t{\n\t\t\t\tid: 'arrow_spotlight',\n\t\t\t\ttargetElement: targetNode,\n\t\t\t\tautoSave: true,\n\t\t\t\ttargetVertex: \"middle-center\",\n\t\t\t\tzIndex: 200,\n\t\t\t}\n\t\t);\n\t\tspotlight.show();\n\t\tspotlight.container.style.pointerEvents = \"none\";\n\n\t\treturn spotlight;\n\t}\n\n\t#freezeGridContainer(onCloseCallback: Function, callbackParams: Array = [])\n\t{\n\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\tgridContainer.style.pointerEvents = \"none\";\n\t\tleftArrow.style.pointerEvents = \"none\";\n\t\trightArrow.style.pointerEvents = \"none\";\n\n\t\tconst clickObserver = (event) => {\n\t\t\tgridContainer.style.pointerEvents = \"auto\";\n\t\t\tleftArrow.style.pointerEvents = \"auto\";\n\t\t\trightArrow.style.pointerEvents = \"auto\";\n\t\t\tEvent.unbind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\n\t\t\tonCloseCallback(...callbackParams);\n\t\t}\n\t\tsetTimeout(() => {\n\t\t\tEvent.bind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\t\t}, 500);\n\t}\n\n\t#tieTourToNode(tourTarget: HTMLElement, tourData: Object): Guide\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\tObject.assign({target: tourTarget}, tourData),\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t\tthis.activeHintGuide = guide;\n\n\t\tguide.showNextStep();\n\t\treturn guide;\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\tif (!this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\telse if (this.activeHintGuide instanceof Guide)\n\t\t{\n\t\t\treturn this.activeHintGuide;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import {ajax, Cache, Dom, Event, Reflection, Runtime, Text, Type, Loc} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Row} from './product.list.row';\nimport {PageEventsManager} from './page.events.manager';\nimport SettingsPopup from './settings.button';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {ProductSelector} from 'catalog.product-selector';\nimport {StoreSelector} from \"catalog.store-selector\";\nimport HintPopup from './hint.popup';\nimport ProductListController from \"catalog.document-card\";\nimport {ProductModel} from \"catalog.product-model\";\nimport {FieldHintManager} from \"./field.hint.manager\";\nimport {Guide} from \"ui.tour\";\nimport {UI} from 'ui.notification';\nimport \"ui.hint\";\n\nconst GRID_TEMPLATE_ROW = 'template_0';\nconst DEFAULT_PRECISION: number = 2;\n\nconst isEmptyObject = function(obj): boolean\n{\n\tif (!Type.isPlainObject(obj))\n\t{\n\t\treturn false;\n\t}\n\n\tfor (const key in obj)\n\t{\n\t\treturn false;\n\t}\n\n\treturn true;\n};\n\nexport class Editor\n{\n\tid: ?string;\n\tsettings: Object;\n\tcontroller: ?ProductListController;\n\tcontainer: ?HTMLElement;\n\tform: ?HTMLElement\n\tproducts: Row[] = [];\n\tproductsWasInitiated = false;\n\tpageEventsManager: PageEventsManager;\n\tcache = new Cache.MemoryCache();\n\n\t#fieldHintManager: FieldHintManager;\n\n\tactions = {\n\t\tproductChange: 'productChange',\n\t\tproductListChanged: 'productListChanged',\n\t\tupdateListField: 'listField',\n\t\tupdateTotal: 'total'\n\t};\n\n\tupdateFieldForList = null;\n\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\n\tproductRowCreateHandler = this.handleProductRowCreate.bind(this);\n\tshowBarcodeSettingsPopupHandler = this.handleShowBarcodeSettingsPopup.bind(this);\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\n\n\tonSaveHandler = this.handleOnSave.bind(this);\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\n\tonFocusToProductList = this.handleProductListFocus.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\n\tonScanEmitHandler = this.handleMobileScanEvent.bind(this);\n\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\n\tblurProductFieldHandler = this.handleFieldBlur.bind(this);\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 100, this);\n\n\tconstructor(id)\n\t{\n\t\tthis.setId(id);\n\t}\n\n\tinit(config = {})\n\t{\n\t\tthis.setSettings(config);\n\n\t\tthis.scannerToken = this.scannerToken ?? Text.getRandom(16);\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.enableEdit();\n\t\t}\n\n\t\tthis.initForm();\n\t\tthis.initProducts();\n\t\tthis.initGridData();\n\t\tthis.paintColumns();\n\n\t\tthis.#fieldHintManager = new FieldHintManager(this.getContainer(), this.getGrid.bind(this));\n\n\t\tEventEmitter.emit( 'DocumentProductListController', [this]);\n\n\t\tthis.#initSupportCustomRowActions();\n\t\tthis.subscribeDomEvents();\n\t\tthis.subscribeCustomEvents();\n\n\t\tthis\n\t\t\t.getContainer()\n\t\t\t.querySelectorAll('.catalog-document-product-list-add-block')\n\t\t\t.forEach((buttonBlock) => {\n\t\t\t\tBX.UI.Hint.init(buttonBlock);\n\t\t\t})\n\t\t;\n\n\t}\n\n\tsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tif (this.getSettingValue('enabledCreateProductButton', true))\n\t\t\t{\n\t\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-create-button\"]').forEach((addButton) => {\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\taddButton,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.productRowCreateHandler\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-barcode-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showBarcodeSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((createButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tcreateButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowCreateHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-barcode-settings-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.subscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tEventEmitter.subscribe('BarcodeScanner::onScanEmit', this.onScanEmitHandler);\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.unsubscribe('BX.UI.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.unsubscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.unsubscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tEventEmitter.unsubscribe('BarcodeScanner::onScanEmit', this.onScanEmitHandler);\n\t}\n\n\thandleMobileScanEvent(event: BaseEvent): void\n\t{\n\t\tconst params = event.getData();\n\t\tif (this.scannerToken !== params.id || !Type.isStringFilled(params.barcode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (product.getBarcodeSelector()?.searchInput?.getNameInput() === document.activeElement)\n\t\t\t{\n\t\t\t\tproduct.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (\n\t\t\t\tproduct.getBarcodeSelector()?.searchInput?.getNameInput().value === ''\n\t\t\t\t&& product.getSelector()?.searchInput?.getNameInput().value === ''\n\t\t\t)\n\t\t\t{\n\t\t\t\tproduct.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst newRowId = this.addProductRow();\n\t\tthis.getProductById(newRowId)?.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\t}\n\n\t#initSupportCustomRowActions()\n\t{\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\n\t}\n\n\tselectProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(id)\n\t\t\t\t?.onProductSelect(productId)\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnSave(event: BaseEvent)\n\t{\n\t\tconst notification = ProductModel.getLastActiveSaveNotification();\n\t\tif (notification)\n\t\t{\n\t\t\tnotification.close();\n\t\t}\n\n\t\tconst items = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\tconst item = {\n\t\t\t\tfields: {...product.fields},\n\t\t\t\trowId: product.fields.ROW_ID\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\n\t\tthis.setSettingValue('items', items);\n\t}\n\n\thandleEditorSubmit(event: BaseEvent)\n\t{\n\t}\n\n\thandleProductListFocus(event: BaseEvent)\n\t{\n\t\tif (this.isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet listHaveEmptyRows = false;\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (product.isEmptyRow())\n\t\t\t{\n\t\t\t\tlistHaveEmptyRows = true;\n\t\t\t\tthis.focusProductSelector(product.fields['ROW_ID']);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!listHaveEmptyRows)\n\t\t{\n\t\t\tthis.handleProductRowAdd();\n\t\t}\n\t}\n\n\tonInnerCancel()\n\t{\n\t\tthis.reloadGrid(false);\n\t}\n\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tconst activePanel = container.querySelector('.catalog-document-product-list-add-block-' + panelCode);\n\t\tif (Type.isDomNode(activePanel))\n\t\t{\n\t\t\tDom.removeClass(activePanel, 'catalog-document-product-list-add-block-hidden');\n\t\t\tDom.addClass(activePanel, 'catalog-document-product-list-add-block-active');\n\t\t}\n\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\n\t\tconst removePanel = container.querySelector('.catalog-document-product-list-add-block-' + hiddenPanelCode);\n\t\tif (Type.isDomNode(removePanel))\n\t\t{\n\t\t\tDom.addClass(removePanel, 'catalog-document-product-list-add-block-hidden');\n\t\t\tDom.removeClass(removePanel, 'catalog-document-product-list-add-block-active');\n\t\t}\n\n\t\treturn activePanel;\n\t}\n\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\n\t{\n\t\tif (isInternalChanging === null)\n\t\t{\n\t\t\tisInternalChanging = !useProductsFromRequest;\n\t\t}\n\n\t\tthis.getGrid().reloadTable(\n\t\t\t'POST',\n\t\t\t{useProductsFromRequest},\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging})\n\t\t);\n\t}\n\n\t/*\n\t\tkeep in mind different actions for this handler:\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t */\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\n\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tuseProductsFromRequest,\n\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields(Editor.#getAjaxFields()) : null,\n\t\t};\n\n\t\tlet isDeletingRequest = false;\n\t\tif (eventArgs.data['action_button_' + eventArgs.gridId] === 'delete')\n\t\t{\n\t\t\tisDeletingRequest = true;\n\t\t}\n\n\t\tthis.clearEditor();\n\n\t\tif (isNativeAction)\n\t\t{\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', (event) => {\n\t\t\t\tconst [grid] = event.getCompatData();\n\n\t\t\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.actionUpdateTotalData({isInternalChanging: false});\n\t\t\t\tif (isDeletingRequest)\n\t\t\t\t{\n\t\t\t\t\tthis.executeActions([\n\t\t\t\t\t\t{type: this.actions.productListChanged},\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\thandleOnGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSettingsPopup().updateCheckboxState();\n\t}\n\n\thandleOnGridRowMoved(event: BaseEvent)\n\t{\n\t\tconst [ids, , grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.resortProductsByIds(ids);\n\t\tif (changed)\n\t\t{\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\n\t\t}\n\t}\n\n\tinitPageEventsManager(): void\n\t{\n\t\tconst componentId = this.getSettingValue('componentId');\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\n\t}\n\n\tgetPageEventsManager(): PageEventsManager\n\t{\n\t\tif (!this.pageEventsManager)\n\t\t{\n\t\t\tthis.initPageEventsManager();\n\t\t}\n\n\t\treturn this.pageEventsManager;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.getSettingValue('allowEdit', false) === true;\n\t}\n\n\tenableEdit()\n\t{\n\t\t// Cannot use editSelected because checkboxes have been removed\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((current) => {\n\t\t\tif (\n\t\t\t\t!current.isHeadChild()\n\t\t\t\t&& !current.isTemplate()\n\t\t\t\t&& !isEmptyObject(current.getEditData())\n\t\t\t)\n\t\t\t{\n\t\t\t\tcurrent.edit();\n\t\t\t}\n\t\t});\n\t}\n\n\taddFirstRowIfEmpty(): void\n\t{\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\trequestAnimationFrame(() => this.addProductRow());\n\t\t}\n\t}\n\n\tclearEditor()\n\t{\n\t\tthis.unsubscribeProductsEvents();\n\n\t\tthis.products = [];\n\t\tthis.productsWasInitiated = false;\n\n\t\tthis.destroySettingsPopup();\n\t\tthis.unsubscribeDomEvents();\n\t\tthis.unsubscribeCustomEvents();\n\n\t\tEvent.unbindAll(this.container);\n\t}\n\n\twasProductsInitiated()\n\t{\n\t\treturn this.productsWasInitiated;\n\t}\n\n\tunsubscribeProductsEvents()\n\t{\n\t\tthis.products.forEach((current) => {\n\t\t\tconst productSelector = current.getSelector();\n\t\t\tif (productSelector)\n\t\t\t{\n\t\t\t\tproductSelector.unsubscribeEvents();\n\t\t\t}\n\t\t\tconst barcodeSelector = current.getBarcodeSelector();\n\t\t\tif (barcodeSelector)\n\t\t\t{\n\t\t\t\tbarcodeSelector.unsubscribeEvents();\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.setForm(null);\n\t\tthis.clearController();\n\t\tthis.clearEditor();\n\t}\n\n\tsetController(controller)\n\t{\n\t\tif (this.controller === controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.clearProductList();\n\t\t}\n\t\tthis.controller = controller;\n\t}\n\n\tclearController()\n\t{\n\t\tthis.controller = null;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\t/* settings tools */\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings)\n\t{\n\t\tthis.settings = settings ? settings : {};\n\t}\n\n\tgetSettingValue(name: string, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value)\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tgetComponentName()\n\t{\n\t\treturn this.getSettingValue('componentName', '');\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getSettingValue('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getSettingValue('signedParameters', '');\n\t}\n\n\tgetContainerId()\n\t{\n\t\treturn this.getSettingValue('containerId', '');\n\t}\n\n\tgetGridId(): string\n\t{\n\t\treturn this.getSettingValue('gridId', '');\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.getSettingValue('languageId', '');\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.getSettingValue('siteId', '');\n\t}\n\n\tgetCatalogId()\n\t{\n\t\treturn this.getSettingValue('catalogId', 0);\n\t}\n\n\tisReadOnly()\n\t{\n\t\treturn this.getSettingValue('readOnly', true);\n\t}\n\n\tsetReadOnly(readOnly)\n\t{\n\t\tthis.setSettingValue('readOnly', readOnly);\n\t}\n\n\tgetCurrencyId(): string\n\t{\n\t\treturn this.getSettingValue('currencyId', '');\n\t}\n\n\tsetCurrencyId(currencyId): Promise\n\t{\n\t\tthis.setSettingValue('currencyId', currencyId);\n\t\treturn CurrencyCore.loadCurrencyFormat(currencyId);\n\t}\n\n\tisSalesOrdersDocument(): boolean\n\t{\n\t\tconst salesOrdersDocumentTypeCodes = ['REALIZATION', 'W'];\n\n\t\treturn salesOrdersDocumentTypeCodes.includes(this.settings.documentType);\n\t}\n\t\n\tchangeCurrencyId(currencyId): void\n\t{\n\t\tconst oldCurrencyId = this.getCurrencyId();\n\t\tif (oldCurrencyId === currencyId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis\n\t\t\t.setCurrencyId(currencyId)\n\t\t\t.then(() => {\n\t\t\t\tconst products = [];\n\t\t\t\tthis.products.forEach((product) => {\n\t\t\t\t\tproduct.getModel().setOption('currency', currencyId);\n\t\t\t\t\tproducts.push({\n\t\t\t\t\t\tfields: product.getFields(),\n\t\t\t\t\t\tid: product.getId()\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tif (products.length > 0)\n\t\t\t\t{\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tthis.getComponentName(),\n\t\t\t\t\t\t'calculateProductPrices',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tproducts,\n\t\t\t\t\t\t\t\tcurrencyId,\n\t\t\t\t\t\t\t\toldCurrencyId,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t\t\t.then(this.onCalculatePricesResponse.bind(this));\n\t\t\t\t}\n\n\t\t\t\tconst editData = this.getGridEditData();\n\t\t\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\n\n\t\t\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\n\t\t\t\tconst templateFieldNames = ['BASE_PRICE', 'PURCHASING_PRICE'];\n\n\t\t\t\ttemplateFieldNames.forEach((field) => {\n\t\t\t\t\tif (templateRow[field] && templateRow[field]['CURRENCY'])\n\t\t\t\t\t{\n\t\t\t\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.setGridEditData(editData);\n\t\t\t});\n\t}\n\n\tonCalculatePricesResponse(response)\n\t{\n\t\tconst products = response.data;\n\t\tthis.products.forEach((product) => {\n\t\t\tif (Type.isObject(products[product.getId()]))\n\t\t\t{\n\t\t\t\tproduct.updateField('BASE_PRICE', products[product.getId()]['BASE_PRICE']);\n\t\t\t\tproduct.updateField('PURCHASING_PRICE', products[product.getId()]['PURCHASING_PRICE']);\n\t\t\t\tproduct.updateUiCurrencyFields();\n\t\t\t}\n\t\t});\n\n\t\tthis.updateTotalDataDelayed();\n\t\tthis.updateTotalUiCurrency();\n\t}\n\n\tupdateTotalUiCurrency()\n\t{\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(totalBlock))\n\t\t{\n\t\t\tconst totalsList = ['totalCost'];\n\t\t\ttotalBlock.querySelectorAll('.catalog-document-product-list-result-grid-total').forEach((row) => {\n\t\t\t\tfor (const totalId of totalsList)\n\t\t\t\t{\n\t\t\t\t\tconst valueElement = row.querySelector('[data-total=\"' + totalId + '\"]');\n\t\t\t\t\tif (valueElement)\n\t\t\t\t\t{\n\t\t\t\t\t\trow.innerHTML = CurrencyCore.getPriceControl(valueElement, this.getCurrencyId());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetCurrencyText(): string\n\t{\n\t\tconst currencyId = this.getCurrencyId();\n\t\tif (!Type.isStringFilled(currencyId))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || '';\n\t}\n\n\tgetDataFieldName()\n\t{\n\t\treturn this.getSettingValue('dataFieldName', '');\n\t}\n\n\tgetDataSettingsFieldName()\n\t{\n\t\tconst field = this.getDataFieldName();\n\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetMeasures(): []\n\t{\n\t\treturn this.getSettingValue('measures', []);\n\t}\n\n\tgetDefaultMeasure()\n\t{\n\t\treturn this.getSettingValue('defaultMeasure', {});\n\t}\n\n\tgetRowIdPrefix()\n\t{\n\t\treturn this.getSettingValue('rowIdPrefix', 'catalog_entity_product_list_');\n\t}\n\n\t/* settings tools finish */\n\n\t/* calculate tools */\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isNegative)\n\t\t\t\t{\n\t\t\t\t\tresult = -result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseInt(value, 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\n\t\t\tconst dot = value.indexOf('.');\n\t\t\tconst comma = value.indexOf(',');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\n\t\t\tif (dot < 0 && comma >= 0)\n\t\t\t{\n\t\t\t\tlet s1 = value.substr(0, comma);\n\t\t\t\tconst decimalLength = value.length - comma - 1;\n\n\t\t\t\tif (decimalLength > 0)\n\t\t\t\t{\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\n\t\t\t\t}\n\n\t\t\t\tvalue = s1;\n\t\t\t}\n\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\n\t\t\tresult = parseFloat(value);\n\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\tif (isNegative)\n\t\t\t{\n\t\t\t\tresult = -result;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseFloat(value);\n\t\t}\n\n\t\tif (precision >= 0)\n\t\t{\n\t\t\tresult = this.round(result, precision);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tround(value: number, precision: number = DEFAULT_PRECISION)\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\t/* calculate tools finish */\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.getElementById(this.getContainerId());\n\t\t});\n\t}\n\n\tinitForm()\n\t{\n\t\tconst formId = this.getSettingValue('formId', '');\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\n\n\t\tif (Type.isElementNode(form))\n\t\t{\n\t\t\tthis.setForm(form);\n\t\t}\n\t}\n\n\tisExistForm()\n\t{\n\t\treturn Type.isElementNode(this.getForm());\n\t}\n\n\tgetForm()\n\t{\n\t\treturn this.form;\n\t}\n\n\tsetForm(form)\n\t{\n\t\tthis.form = form;\n\t}\n\n\tinitFormFields()\n\t{\n\t\tconst container = this.getForm();\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tconst field = this.getDataField();\n\t\t\tif (!Type.isElementNode(field))\n\t\t\t{\n\t\t\t\tthis.initDataField();\n\t\t\t}\n\n\t\t\tconst settingsField = this.getDataSettingsField();\n\t\t\tif (!Type.isElementNode(settingsField))\n\t\t\t{\n\t\t\t\tthis.initDataSettingsField();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\tcontainer.appendChild(Dom.create(\n\t\t\t\t'input',\n\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\n\t\t\t));\n\t\t}\n\t}\n\n\tremoveFormFields()\n\t{\n\t\tconst field = this.getDataField();\n\t\tif (Type.isElementNode(field))\n\t\t{\n\t\t\tDom.remove(field);\n\t\t}\n\n\t\tconst settingsField = this.getDataSettingsField();\n\t\tif (Type.isElementNode(settingsField))\n\t\t{\n\t\t\tDom.remove(settingsField);\n\t\t}\n\t}\n\n\tinitDataField()\n\t{\n\t\tthis.initFormField(this.getDataFieldName());\n\t}\n\n\tinitDataSettingsField()\n\t{\n\t\tthis.initFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetDataField()\n\t{\n\t\treturn this.getFormField(this.getDataFieldName());\n\t}\n\n\tgetDataSettingsField()\n\t{\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetProductCount()\n\t{\n\t\treturn this.products\n\t\t\t.filter(item => !item.isEmptyRow())\n\t\t\t.length\n\t\t;\n\t}\n\n\tinitProducts()\n\t{\n\t\tconst list = this.getSettingValue('items', []);\n\n\t\tfor (let item of list)\n\t\t{\n\t\t\tconst fields = {...item.fields};\n\t\t\tthis.products.push(new Row(item.rowId, fields, this.getSettingValue('rowSettings', {}), this));\n\t\t}\n\n\t\tthis.numerateRows();\n\t\tthis.productsWasInitiated = true;\n\n\t\tthis.updateTotalDataDelayed();\n\t}\n\n\tnumerateRows()\n\t{\n\t\tthis.products.forEach((product, index) => {\n\t\t\tproduct.setRowNumber(index + 1);\n\t\t})\n\t}\n\n\tgetGrid(): ?BX.Main.Grid\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\tconst gridId = this.getGridId();\n\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\n\t\t\t}\n\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\n\t\t});\n\t}\n\n\tgetGridColumnIndexes()\n\t{\n\t\treturn this.cache.remember('getGridColumnIndexes', () => {\n\t\t\tlet result = {};\n\n\t\t\tconst columns = this.getGrid().getHead().querySelectorAll('.main-grid-cell-head');\n\t\t\tfor (let i = 0; i < columns.length; i++) {\n\t\t\t\tconst node = columns[i];\n\t\t\t\tconst columnName = node.dataset.name;\n\n\t\t\t\tif (columnName)\n\t\t\t\t{\n\t\t\t\t\tresult[columnName] = i;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t});\n\t}\n\n\tinitGridData()\n\t{\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\t}\n\n\tpaintColumns()\n\t{\n\t\tconst paintedColumns = this.getSettingValue('paintedColumns', null);\n\t\tconst grid = this.getGrid();\n\t\tif (grid && Type.isArray(paintedColumns))\n\t\t{\n\t\t\tpaintedColumns.forEach((columnName) => {\n\t\t\t\tconst rows = grid.getRows().getRows();\n\t\t\t\trows.forEach((current) => {\n\t\t\t\t\tconst cell = current.getCellById(columnName);\n\t\t\t\t\tif (cell)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(cell, 'main-grid-cell-light-blue-background');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\tgetColumnInfo(code: string)\n\t{\n\t\treturn this.getGrid()?.arParams?.COLUMNS_ALL[code] || {};\n\t}\n\n\tsetGridEditData(data: {})\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\thandleProductErrorsChange()\n\t{\n\t\tif (this.#childrenHasErrors())\n\t\t{\n\t\t\tthis.controller.disableSaveButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.controller.enableSaveButton();\n\t\t}\n\t}\n\n\t#childrenHasErrors()\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\n\t\t\t.length > 0\n\t\t\t;\n\t}\n\n\thandleFieldChange(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tif (row && row.hasAttribute('data-id'))\n\t\t{\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tlet fieldCode = event.target.getAttribute('data-name');\n\t\t\t\tif (!Type.isStringFilled(fieldCode))\n\t\t\t\t{\n\t\t\t\t\tconst cell = event.target.closest('td');\n\t\t\t\t\tfieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t\t\t}\n\n\t\t\t\tif (fieldCode)\n\t\t\t\t{\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleFieldBlur(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tconst value = event.target.value;\n\t\tlet fieldCode = event.target.getAttribute('data-name');\n\t\tif (!Type.isStringFilled(fieldCode))\n\t\t{\n\t\t\tconst cell = event.target.closest('td');\n\t\t\tfieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t}\n\n\t\tif (this.isSalesOrdersDocument() && fieldCode === 'AMOUNT' && value <= 0)\n\t\t{\n\t\t\tevent.target.value = 1;\n\t\t\tthis.handleFieldChange(event);\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\twidth: 'auto',\n\t\t\t\tcontent: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_INVALID_AMOUNT_REALIZATION'),\n\t\t\t});\n\t\t}\n\t}\n\n\thandleDropdownChange(event: BaseEvent)\n\t{\n\t\tconst [dropdownId, , , , value] = event.getData();\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\n\t\tconst matches = dropdownId.match(regExp);\n\t\tif (matches)\n\t\t{\n\t\t\tconst [, rowId, fieldCode] = matches;\n\t\t\tconst product = this.getProductById(rowId);\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tproduct.updateDropdownField(fieldCode, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProductById(id: string): ?Row\n\t{\n\t\tconst rowId = this.getRowIdPrefix() + id;\n\n\t\treturn this.getProductByRowId(rowId);\n\t}\n\n\tgetProductByRowId(rowId: string): ?Row\n\t{\n\t\treturn this.products.find((row: Row) => {\n\t\t\treturn row.getId() === rowId;\n\t\t});\n\t}\n\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\n\t{\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\n\t\t\tconst index = [...row.cells].indexOf(cell);\n\n\t\t\treturn headRow.getCellNameByCellIndex(index);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddProductRow(anchorProduct: Row = null): string\n\t{\n\t\tconst row = this.createGridProductRow();\n\t\tconst newId = row.getId();\n\n\t\tif (anchorProduct)\n\t\t{\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\n\t\t\tif (anchorRowNode)\n\t\t\t{\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\n\t\t\t}\n\t\t}\n\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\n\t\tthis.getGrid().bindOnRowEvents();\n\t\treturn newId;\n\t}\n\n\thandleProductRowAdd(): void\n\t{\n\t\tconst id = this.addProductRow();\n\t\tthis.focusProductSelector(id);\n\t}\n\n\thandleProductRowCreate(): void\n\t{\n\t}\n\n\thandleShowBarcodeSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\thandleShowSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\tdestroySettingsPopup()\n\t{\n\t\tif (this.cache.has('settings-popup'))\n\t\t{\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\n\t\t\tthis.cache.delete('settings-popup');\n\t\t}\n\t}\n\n\tgetSettingsPopup()\n\t{\n\t\treturn this.cache.remember('settings-popup', () => {\n\t\t\treturn new SettingsPopup(\n\t\t\t\tthis.getContainer().querySelector('.catalog-document-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\n\t\t\t\tthis.getSettingValue('popupSettings', []),\n\t\t\t\tthis\n\t\t\t);\n\t\t});\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.cache.remember('hint-popup', () => {\n\t\t\treturn new HintPopup(this);\n\t\t});\n\t}\n\n\tcreateGridProductRow(): BX.Grid.Row\n\t{\n\t\tconst newId = Text.getRandom();\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\n\n\t\tconst grid = this.getGrid();\n\t\tlet newRow;\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tnewRow = grid.appendRowEditor();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewRow = grid.prependRowEditor();\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tnewNode.setAttribute('data-id', newId);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\n\t\treturn newRow;\n\t}\n\n\thandleDeleteRow(rowId, event: BaseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tconst row = this.getProductByRowId(rowId);\n\t\tif (row)\n\t\t{\n\t\t\tthis.deleteRow(rowId);\n\t\t}\n\t}\n\n\tredefineTemplateEditData(newId: string)\n\t{\n\t\tconst data = this.getGridEditData();\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\n\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\n\n\t\treturn originalTemplateData;\n\t}\n\n\tprepareCustomEditData(originalEditData, newId)\n\t{\n\t\tconst customEditData = {};\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\n\t\t\t\t\t\tnewId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\n\t{\n\t\tlet fields = {};\n\t\tif (anchorProduct !== null)\n\t\t{\n\t\t\tfields = Object.assign(fields, anchorProduct?.getFields());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfields = {\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\n\t\t\t\t...{\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (Type.isNil(anchorProduct) && this.products.length > 0)\n\t\t{\n\t\t\tconst previousRow =\n\t\t\t\tthis.getSettingValue('newRowPosition') === 'bottom'\n\t\t\t\t\t? this.products[this.products.length - 1]\n\t\t\t\t\t: this.products[0]\n\t\t\t;\n\t\t\tconst stores = this.getSettingValue('stores', {});\n\t\t\tconst storeFields = previousRow.getSettingValue('storeHeaderMap', {});\n\t\t\tObject.values(storeFields).forEach((field) => {\n\t\t\t\tconst previousStoreValue = previousRow.getField(field);\n\t\t\t\tif (Type.isNil(stores[previousStoreValue]))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfields[field] = previousRow.getField(field);\n\t\t\t\tconst titleName = field + '_TITLE';\n\t\t\t\tfields[titleName] = previousRow.getField(titleName);\n\t\t\t});\n\t\t}\n\n\t\tconst rowId = this.getRowIdPrefix() + newId;\n\t\tfields.ID = newId;\n\t\tfields.ROW_ID = newId;\n\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t{\n\t\t\tdelete(fields.IMAGE_INFO.input);\n\t\t}\n\t\tconst product = new Row(\n\t\t\trowId,\n\t\t\tfields,\n\t\t\tthis.getSettingValue('rowSettings', {}),\n\t\t\tthis\n\t\t);\n\n\t\tif (anchorProduct instanceof Row)\n\t\t{\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\n\n\t\t\tproduct.refreshFieldsLayout();\n\t\t}\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tthis.products.push(product);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.products.unshift(product);\n\t\t}\n\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tproduct.updateUiCurrencyFields();\n\t\tthis.updateTotalUiCurrency();\n\n\t\treturn product;\n\t}\n\n\tgetProductSelector(newId: string): ?ProductSelector\n\t{\n\t\treturn this.getProductById(newId).getSelector();\n\t}\n\n\tfocusProductSelector(newId: string): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(newId)\n\t\t\t\t?.searchInDialog()\n\t\t\t\t.focusName()\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnBeforeProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst product = this.getProductByRowId(data.rowId);\n\t\tif (product)\n\t\t{\n\t\t\tthis.getGrid().tableFade();\n\t\t\tproduct.resetExternalActions();\n\t\t}\n\t}\n\n\thandleOnProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tconst productRow = this.getProductByRowId(data.rowId);\n\t\tif (productRow && data.fields)\n\t\t{\n\t\t\tdelete data.fields.ID;\n\t\t\tproductRow.setFields(data.fields);\n\t\t\tObject.keys(data.fields).forEach((key) => {\n\t\t\t\tproductRow.updateFieldValue(key, data.fields[key]);\n\t\t\t});\n\n\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\n\t\t\tproductRow.getSelector()?.layout();\n\t\t\tproductRow.getBarcodeSelector()?.layout();\n\t\t\tproductRow.updateProductStoreValues();\n\n\t\t\tproductRow.initHandlersForSelectors();\n\t\t\tproductRow.layoutStoreSelector(productRow.getSettingValue('storeHeaderMap', {}));\n\t\t\tproductRow.layoutBarcode();\n\t\t\tproductRow.executeExternalActions();\n\n\t\t\tif (this.isSalesOrdersDocument())\n\t\t\t{\n\t\t\t\tproductRow.changeAmount(productRow.getAmount() > 0 ? productRow.getAmount() : 1);\n\t\t\t}\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t}\n\n\thandleOnProductClear(event: BaseEvent)\n\t{\n\t\tconst {selectorId, rowId} = event.getData();\n\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tif (product && product.getSelector().getId() === selectorId)\n\t\t{\n\t\t\tproduct.initHandlersForSelectors();\n\t\t\tproduct.setMeasure(this.getDefaultMeasure());\n\t\t\tproduct.changePurchasingPrice(0);\n\t\t\tproduct.changeBasePrice(0);\n\t\t\tproduct.changeAmount(0);\n\t\t\tproduct.updateUiStoreValues();\n\t\t\tproduct.updateProductStoreValues();\n\t\t\tproduct.changeBarcode('');\n\t\t\tproduct\n\t\t\t\t.getBarcodeSelector()\n\t\t\t\t?.setConfig('ENABLE_SEARCH', true)\n\t\t\t\t.layout()\n\t\t\t;\n\t\t\tproduct.executeExternalActions();\n\t\t}\n\t}\n\n\tcompileProductData(): void\n\t{\n\t\tif (!this.isExistForm())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.initFormFields();\n\n\t\tconst field = this.getDataField();\n\t\tconst settingsField = this.getDataSettingsField();\n\n\t\tthis.cleanProductRows();\n\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\n\t\t{\n\t\t\tfield.value = this.prepareProductDataValue();\n\t\t}\n\t}\n\n\tprepareProductDataValue(): string\n\t{\n\t\tlet productDataValue = '';\n\n\t\tif (this.getProductCount())\n\t\t{\n\t\t\tconst productData = [];\n\n\t\t\tthis.products.forEach((item) => {\n\t\t\t\tconst itemFields = item.getFields(Editor.#getAjaxFields());\n\n\t\t\t\tif (!/^[0-9]+$/.test(itemFields['ID']))\n\t\t\t\t{\n\t\t\t\t\titemFields['ID'] = 0;\n\t\t\t\t}\n\n\t\t\t\titemFields['CUSTOMIZED'] = 'Y';\n\n\t\t\t\tproductData.push(itemFields);\n\t\t\t});\n\n\t\t\tproductDataValue = JSON.stringify(productData);\n\t\t}\n\n\t\treturn productDataValue;\n\t}\n\n\tstatic #getAjaxFields(): []\n\t{\n\t\treturn [\n\t\t\t'ID',\n\t\t\t'SKU_ID',\n\t\t\t'AMOUNT',\n\t\t\t'PURCHASING_PRICE',\n\t\t\t'BASE_PRICE',\n\t\t\t'BASE_PRICE_EXTRA',\n\t\t\t'BASE_PRICE_EXTRA_RATE',\n\t\t\t'DOC_BARCODE',\n\t\t\t'BARCODE',\n\t\t\t'STORE_TO',\n\t\t\t'STORE_FROM',\n\t\t\t'BASE_PRICE_ID',\n\t\t\t'BASKET_ID',\n\t\t\t'DOC_ID',\n\t\t\t'ELEMENT_ID',\n\t\t\t'IBLOCK_ID',\n\t\t\t'MEASURE_CODE',\n\t\t\t'MEASURE_NAME',\n\t\t\t'NAME',\n\t\t\t'OFFERS_IBLOCK_ID',\n\t\t\t'PARENT_PRODUCT_ID',\n\t\t\t'PRODUCT_ID',\n\t\t\t'ROW_ID',\n\t\t\t'STORE_FROM_AMOUNT',\n\t\t\t'STORE_FROM_AVAILABLE_AMOUNT',\n\t\t\t'STORE_FROM_RESERVED',\n\t\t\t'STORE_FROM_TITLE',\n\t\t\t'STORE_TO_AMOUNT',\n\t\t\t'STORE_TO_AVAILABLE_AMOUNT',\n\t\t\t'STORE_TO_RESERVED',\n\t\t\t'STORE_TO_TITLE',\n\t\t\t'TOTAL_PRICE',\n\t\t\t'TYPE',\n\t\t];\n\t}\n\n\t/* actions */\n\texecuteActions(actions)\n\t{\n\t\tif (!Type.isArrayFilled(actions))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let item of actions)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(item)\n\t\t\t\t|| !Type.isStringFilled(item.type)\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (item.type)\n\t\t\t{\n\t\t\t\tcase this.actions.productChange:\n\t\t\t\t\tthis.actionSendProductChange(item);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.productListChanged:\n\t\t\t\t\tthis.actionSendProductListChanged();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateTotal:\n\t\t\t\t\tthis.actionUpdateTotalData();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tactionSendProductChange(item)\n\t{\n\t\tif (!Type.isStringFilled(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.getProductByRowId(item.id);\n\t\tif (!product)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// EventEmitter.emit(this, 'ProductList::onChangeFields', {\n\t\t// \trowId: item.id,\n\t\t// \tproductId: product.getField('PRODUCT_ID'),\n\t\t// \tfields: this.getProductByRowId(item.id).getCatalogFields()\n\t\t// });\n\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange();\n\t\t}\n\t}\n\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t}\n\t}\n\n\tactionUpdateListField(item)\n\t{\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateFieldForList = item.field;\n\n\t\tfor (let row of this.products)\n\t\t{\n\t\t\trow.updateFieldByName(item.field, item.value);\n\t\t}\n\n\t\tthis.updateFieldForList = null;\n\t}\n\n\tactionUpdateTotalData(options = {})\n\t{\n\t\tthis.updateTotalDataDelayedHandler(options);\n\t}\n\n\t/* actions finish */\n\n\tupdateTotalDataDelayed(options = {})\n\t{\n\t\tlet totalCost = 0;\n\t\tconst field = this.getSettingValue('totalCalculationSumField', 'PURCHASING_PRICE');\n\t\tthis.products.forEach(item => totalCost += Text.toNumber(item.getField(field)) * Text.toNumber(item.getField('AMOUNT')));\n\t\tthis.setTotalData({totalCost});\n\t}\n\n\tgetProductsFields(fields: Array = [])\n\t{\n\t\tconst productFields = [];\n\n\t\tfor (let item of this.products)\n\t\t{\n\t\t\tproductFields.push(item.getFields(fields));\n\t\t}\n\n\t\treturn productFields;\n\t}\n\n\tsetTotalData(data)\n\t{\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\tconst currencyId = this.getCurrencyId();\n\t\t\tconst list = ['totalCost'];\n\n\t\t\tfor (const id of list)\n\t\t\t{\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\n\t\t\t\t{\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.controller?.setTotal(data);\n\t}\n\n\t/* action tools finish */\n\n\t/* ajax tools */\n\t// ajaxRequest(action, data)\n\t// {\n\t// \tif (!Type.isPlainObject(data.options))\n\t// \t{\n\t// \t\tdata.options = {};\n\t// \t}\n\t// \tdata.options.ACTION = action;\n\t// \tajax.runComponentAction(\n\t// \t\tthis.getComponentName(),\n\t// \t\taction,\n\t// \t\t{\n\t// \t\t\tmode: 'class',\n\t// \t\t\tsignedParameters: this.getSignedParameters(),\n\t// \t\t\tdata: data\n\t// \t\t}\n\t// \t).then(\n\t// \t\t(response) => this.ajaxResultSuccess(response, data.options),\n\t// \t\t(response) => this.ajaxResultFailure(response)\n\t// \t);\n\t// }\n\t//\n\t// ajaxResultSuccess(response, requestOptions)\n\t// {\n\t// \tif (!this.ajaxResultCommonCheck(response))\n\t// \t{\n\t// \t\treturn;\n\t// \t}\n\t//\n\t// \tswitch (response.data.action)\n\t// \t{\n\t// \t\tcase 'calculateTotalData':\n\t// \t\t\t// if (Type.isPlainObject(response.data.result))\n\t// \t\t\t// {\n\t// \t\t\t// \tthis.setTotalData(response.data.result, requestOptions);\n\t// \t\t\t// }\n\t//\n\t// \t\t\tbreak;\n\t// \t\tcase 'calculateProductPrices':\n\t// \t\t\tif (Type.isPlainObject(response.data.result))\n\t// \t\t\t{\n\t// \t\t\t\tthis.onCalculatePricesResponse(response.data.result);\n\t// \t\t\t}\n\t//\n\t// \t\t\tbreak;\n\t// \t}\n\t// }\n\n\t// ajaxResultFailure(response)\n\t// {\n\t//\n\t// }\n\n\tajaxResultCommonCheck(responce)\n\t{\n\t\tif (!Type.isPlainObject(responce))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (responce.status !== 'success')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.data.action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection RedundantIfStatementJS\n\t\tif (!('result' in responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tdeleteRow(row: Row): void\n\t{\n\t\tconst gridRow = this.getGrid().getRows().getById(row.getField('ID'));\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t}\n\n\t\tconst index = this.products.indexOf(row);\n\t\tif (index > -1)\n\t\t{\n\t\t\tthis.products.splice(index, 1);\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.addFirstRowIfEmpty();\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcopyRow(row: Row): void\n\t{\n\t\tthis.addProductRow(row)\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcleanProductRows(): void\n\t{\n\t\tthis.products\n\t\t\t.filter(item => item.isEmptyRow())\n\t\t\t.forEach((row) => this.deleteRow(row))\n\t\t;\n\t}\n\n\tresortProductsByIds(ids: Array): boolean\n\t{\n\t\tlet changed = false;\n\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tthis.products.sort((a, b) => {\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tchanged = true;\n\n\t\t\t\treturn -1;\n\t\t\t});\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\trefreshSortFields(): void\n\t{\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10, false));\n\t}\n\n\thandleOnTabShow(): void\n\t{\n\t\tEventEmitter.emit('onDemandRecalculateWrapper', [this]);\n\t}\n\n\tcloseBarcodeSpotlights(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.removeSpotlight();\n\t\t})\n\n\t\tthis.setSettingValue('showBarcodeSpotlightInfo',false);\n\t}\n\n\tcloseBarcodeQrAuths(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.removeQrAuth();\n\t\t})\n\n\t\tthis.setSettingValue('showBarcodeQrAuth',false);\n\t}\n\n\tenableSendBarcodeMobilePush(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.setConfig('IS_INSTALLED_MOBILE_APP', true);\n\t\t})\n\n\t\tthis.setSettingValue('isInstalledMobileApp', true);\n\t}\n\n\tvalidate(): Array\n\t{\n\t\tif (this.getProductCount() === 0)\n\t\t{\n\t\t\treturn [Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_IS_EMPTY')];\n\t\t}\n\n\t\tlet errorsArray = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\terrorsArray = errorsArray.concat(product.validate());\n\t\t});\n\n\t\treturn errorsArray;\n\t}\n\n\tshowFieldTourHint(fieldName: string, tourData: Object, endTourHandler: Function, addictedFields: Array<string> = [], rowId: string = ''): void\n\t{\n\t\tif (this.products.length > 0)\n\t\t{\n\t\t\tlet productNode = this.products[0].getNode();\n\t\t\tif (this.getProductByRowId(rowId))\n\t\t\t{\n\t\t\t\tproductNode = this.getProductByRowId(rowId).getNode();\n\t\t\t}\n\n\t\t\tconst addictedNodes = [];\n\t\t\tfor (const fieldName of addictedFields)\n\t\t\t{\n\t\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\t\t\t\tif (fieldNode !== null)\n\t\t\t\t{\n\t\t\t\t\taddictedNodes.push(fieldNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\n\t\t\tif (fieldNode !== null)\n\t\t\t{\n\t\t\t\tthis.#fieldHintManager.processFieldTour(fieldNode, tourData, endTourHandler, addictedNodes);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\treturn this.#fieldHintManager.getActiveHint();\n\t}\n\n\tgetRestrictedProductTypes(): Array\n\t{\n\t\treturn this.getSettingValue('restrictedProductTypes', []);\n\t}\n\n\tprocessApplyActionButtonClick(actionId: string): void\n\t{\n\t\tif (actionId === 'STORE_FROM_INFO' || actionId === 'STORE_TO_INFO')\n\t\t{\n\t\t\tthis.#processSetStoryAction(actionId);\n\t\t}\n\t}\n\n\t#processSetStoryAction(actionId)\n\t{\n\t\tconst actionPanel = this.getGrid()?.getActionsPanel();\n\t\tconst actionValues = actionPanel?.getValues();\n\t\tconst actionStoreId = actionValues[actionId];\n\t\tif (!actionValues || Type.isUndefined(actionStoreId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst selectedRows  = this.getGrid().getRows().getSelected();\n\t\tif (selectedRows.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst stores = this.getSettingValue('stores', {});\n\t\tconst actionStore = stores[actionStoreId];\n\t\tif (!Type.isNil(actionStore))\n\t\t{\n\t\t\tconst actionStoreName = actionStore?.TITLE || '';\n\n\t\t\tselectedRows.forEach((row) => {\n\t\t\t\tconst selectedItem = this.products.find(product => product.getField('ID') === row.getId());\n\t\t\t\tif (selectedItem)\n\t\t\t\t{\n\t\t\t\t\tconst storeSelector = StoreSelector.getById(selectedItem.getId() + '_' + actionId);\n\t\t\t\t\tif (storeSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tstoreSelector.onStoreSelect(actionStoreId, actionStoreName);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst documentTypeMoving = 'M';\n\t\t\tconst messageId =\n\t\t\t\tthis.settings.documentType !== documentTypeMoving\n\t\t\t\t\t? 'CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_STORE_CHANGED_HINT'\n\t\t\t\t\t: 'CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_' + actionId + '_CHANGED_HINT'\n\t\t\t;\n\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage(messageId, {'#STORE_NAME#': Text.encode(actionStoreName)}),\n\t\t\t\tautoHide: true,\n\t\t\t\tautoHideDelay: 4000,\n\t\t\t});\n\t\t}\n\n\t\tconst dropdown = actionPanel.getDropdowns().find(dropdown => dropdown.id === 'actionListId_control');\n\t\tif (dropdown)\n\t\t{\n\t\t\tactionPanel.removeItemsRelativeCurrent(dropdown.parentNode);\n\t\t\tDom.attr(dropdown, 'data-value', null);\n\t\t\tconst innerWrapper = dropdown.querySelector('.main-dropdown-inner');\n\t\t\tif (innerWrapper)\n\t\t\t{\n\t\t\t\tinnerWrapper.innerText = Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_DEFAULT');\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["HintPopup","editor","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","setBindElement","adjustPosition","setContent","Tag","render","Text","encode","show","close","PriceCalculator","fields","basePrice","finalPrice","extra","extraType","EXTRA_TYPE_PERCENTAGE","toNumber","EXTRA_TYPE_MONETARY","Type","isNil","calculateBasePrice","calculateFinalPrice","AccessDeniedInput","options","Loc","getMessage","hint","isReadOnly","className","block","innerHTML","appendChild","BX","UI","Hint","createInstance","popupParameters","angle","offset","init","MODE_EDIT","MODE_SET","Row","id","settings","Cache","MemoryCache","EDIT","SET","Map","setId","setSettings","setEditor","setModel","initFields","getSettingValue","requestAnimationFrame","initHandlers","bind","cache","remember","rowId","getField","getEditorContainer","querySelector","mainSelector","barcodeSelector","isPlainObject","name","defaultValue","hasOwnProperty","value","getEditor","getContainer","getHintPopup","getNode","querySelectorAll","forEach","Event","changeProductFieldHandler","event","stopPropagation","blurProductFieldHandler","selectorNames","storeFields","Object","keys","barcodeWrapper","renderTo","fieldNames","rowName","selectorId","storeSelectors","selector","storeWrapper","number","textContent","result","isArrayFilled","Runtime","clone","fieldName","realValues","call","getModel","setFields","setField","changeModel","field","fieldCode","target","type","checked","mode","updateField","resetExternalActions","updateFieldValue","executeExternalActions","code","changeProductId","changeBasePrice","changePurchasingPrice","changeAmount","changeMeasureCode","changeBarcode","changeStore","changeStoreName","changeProductName","changeSort","setTaxIncluded","preparedValue","parseInt","setProductId","menuItem","copyRow","menu","getMenuWindow","destroy","deleteRow","unsubscribeEvents","getBarcodeSelector","changeExtraType","getCurrencyText","calculator","calculateExtraType","changeExtra","getExtra","getFinalPrice","isDomNode","parseFloat","getPricePrecision","calculateExtra","setBasePrice","setPurchasingPrice","getQuantityPrecision","setAmount","getMeasures","filter","item","CODE","setMeasure","toString","isChangedValue","addActionProductChange","setStoreAmount","layoutStoreSelector","exceptFields","includes","updateUiField","updateUiMeasure","getSelector","reloadFileInput","layout","updateUiStoreValues","model","ProductModel","getById","currency","getCurrencyId","iblockId","basePriceId","skuTree","isStringFilled","JSON","parse","storeMap","isObject","getImageCollection","setPreview","setEditInput","setMorePhotoValues","setDetailPath","EventEmitter","subscribe","debounce","addActionUpdateTotal","Math","max","toFixed","updateRowTotalPrice","getAmount","getSkuId","storeHeaderMap","key","currentAmount","getStoreCollection","getStoreAmount","maxStore","getMaxFilledStore","storeSelector","StoreSelector","AMOUNT","onStoreSelect","STORE_ID","STORE_TITLE","isInited","amount","amounts","getStoreReserved","getStoreAvailableAmount","postfix","wrapper","amountWithMeasure","htmlAmount","updateUiInputField","measure","isEmpty","SYMBOL","showSaveNotifier","title","declineCancelTitle","events","onSave","save","onCancel","fieldId","getUiFieldId","document","getElementById","isElementNode","inputBlock","getInputByFieldName","parentNode","undefined","Reflection","getClass","Main","dropdownManager","dropdown","getValue","itemsContainer","getMenuItem","refresh","selectItem","dataset","span","updateUiMoneyField","html","currencyText","currencyId","currencyFieldNames","dropdownValues","push","NAME","VALUE","Dom","attr","uiName","getUiFieldName","uiType","getUiFieldType","util","number_format","CurrencyCore","currencyFormat","updateUiHtmlField","moneyFields","column","getColumnInfo","editable","TYPE","precision","getCommonPrecision","externalActions","length","action","addExternalAction","actions","productChange","updateTotal","executeActions","trim","getBasePrice","errorsList","actionCellContentContainer","actionsButton","menuItems","onclick","handleCopyAction","handleDeleteAction","PopupMenu","bindElement","items","preventDefault","append","selectorOptions","getIblockId","getBasePriceId","getCurrency","config","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","ENABLE_EMPTY_PRODUCT_ERROR","RESTRICTED_PRODUCT_TYPES","getRestrictedProductTypes","URL_BUILDER_CONTEXT","ProductSelector","mainInfoNode","numberSelector","selectorWrapper","inputFieldName","INPUT_FIELD_BARCODE","ENABLE_INFO_SPOTLIGHT","ENABLE_BARCODE_QR_AUTH","IS_INSTALLED_MOBILE_APP","ENABLE_SKU_TREE","scannerToken","layoutBarcode","inputFieldId","inputFieldTitle","isDisabledEmpty","data","getData","parsedValue","atob","e","console","error","isNumber","errors","getErrorCollection","getErrors","ErrorCodes","NOT_SELECTED_PRODUCT","NOT_SELECTED_STORE","layoutErrors","handleProductErrorsChange","getNameInputFilledValue","closeBarcodeSpotlights","closeBarcodeQrAuths","enableSendBarcodeMobilePush","validatorCallback","fieldInput","fieldWrapper","getInputWrapperByFieldName","valueAsNumber","validatingFields","get","set","classList","add","validator","eventObject","Boolean","unbind","remove","amountValue","isService","hiddenFields","columnIndexes","getGridColumnIndexes","columnIndex","fieldWithHintIndex","fieldWithHintNode","input","priceNode","contentNode","style","display","PageEventsManager","_settings","eventHandlers","eventName","eventHandler","addCustomEvent","eventParams","onCustomEvent","i","removeCustomEvent","SettingsPopup","getPopup","random","autoHide","draggable","offsetLeft","offsetTop","position","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","content","popupContainer","getContentContainer","isArray","columns","allColumnsExist","columnName","getGrid","getColumnHeaderCellByName","checkbox","settingId","descriptionNode","desc","setting","_classPrivateMethodGet","settingItem","settingEnabled","enabled","headers","cells","getRows","getHeadFirstChild","getCells","Array","from","header","ajax","runComponentAction","getComponentName","signedParameters","getSignedParameters","selected","currentHeaders","then","panel","setSettingValue","activePanel","changeActivePanelButtons","settingButton","reloadGrid","message","replace","category","Notification","Center","notify","stack","width","autoHideDelay","FieldHintManager","contentContainer","gridGetter","fieldNode","tourData","endTourHandler","addictedFieldNodes","fieldHintIsBusy","onClose","activeHintGuide","tourObject","gridContainer","leftArrow","rightArrow","fieldPos","getClientRects","x","gridPos","spotlight","Guide","observedNode","onSuccessVisionCallback","callbackParams","addictedNodes","observedNodes","observer","getScrollContainer","window","mainNode","nodesTuple","addictedNode","nodeRect","mainNodeTupleEl","sort","firstEl","secondEl","firstX","secondX","gridRect","widthIsValid","leftPos","rightPos","abs","lastEl","pop","shift","firstElDistance","lastElDistance","map","el","gridLeftEdge","gridRightEdge","fieldNodes","fieldRect","fieldLeftEdge","fieldRightEdge","targetNode","SpotLight","targetElement","autoSave","targetVertex","zIndex","container","pointerEvents","onCloseCallback","clickObserver","setTimeout","tourTarget","guide","steps","assign","onEvents","showNextStep","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","isEmptyObject","obj","Editor","productListChanged","updateListField","handleProductRowAdd","handleProductRowCreate","handleShowBarcodeSettingsPopup","handleShowSettingsPopup","handleOnSave","handleEditorSubmit","handleProductListFocus","handleOnBeforeGridRequest","handleOnGridUpdated","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnProductClear","handleDropdownChange","handleMobileScanEvent","handleFieldChange","handleFieldBlur","updateTotalDataDelayed","getRandom","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","paintColumns","emit","subscribeDomEvents","subscribeCustomEvents","buttonBlock","addButton","productRowAddHandler","productRowCreateHandler","configButton","showSettingsPopupHandler","showBarcodeSettingsPopupHandler","selectButton","productSelectionPopupHandler","createButton","onSaveHandler","onEditorSubmit","onFocusToProductList","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onProductClearHandler","dropdownChangeHandler","onScanEmitHandler","unsubscribe","params","barcode","products","product","searchInput","getNameInput","activeElement","applyScannerData","newRowId","addProductRow","getProductById","productId","getProductSelector","onProductSelect","notification","getLastActiveSaveNotification","listHaveEmptyRows","isEmptyRow","focusProductSelector","panelCode","removeClass","addClass","hiddenPanelCode","removePanel","useProductsFromRequest","isInternalChanging","reloadTable","actionUpdateTotalData","getCompatData","grid","eventArgs","parent","getGridId","isNativeAction","url","getReloadUrl","method","sessid","bitrix_sessid","getProductsFields","isDeletingRequest","gridId","clearEditor","subscribeOnce","getSettingsPopup","updateCheckboxState","ids","changed","resortProductsByIds","refreshSortFields","numerateRows","componentId","pageEventsManager","initPageEventsManager","rows","current","isHeadChild","isTemplate","getEditData","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","unsubscribeDomEvents","unsubscribeCustomEvents","unbindAll","productSelector","setForm","clearController","controller","clearProductList","readOnly","loadCurrencyFormat","salesOrdersDocumentTypeCodes","documentType","oldCurrencyId","setCurrencyId","setOption","getFields","onCalculatePricesResponse","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","response","updateUiCurrencyFields","updateTotalUiCurrency","totalBlock","totalsList","row","totalId","valueElement","getPriceControl","format","getCurrencyFormat","FORMAT_STRING","getDataFieldName","isNumberValue","isStringValue","isNegative","indexOf","isNaN","dot","comma","s1","substr","decimalLength","round","factor","pow","getContainerId","formId","form","getForm","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","create","attrs","initFormField","getDataSettingsFieldName","getFormField","list","index","setRowNumber","Error","gridManager","getInstanceById","getHead","gridEditData","paintedColumns","cell","getCellById","arParams","EDITABLE_DATA","COLUMNS_ALL","disableSaveButton","enableSaveButton","closest","hasAttribute","getAttribute","getFieldCodeByGridCell","updateFieldByEvent","isSalesOrdersDocument","dropdownId","regExp","RegExp","getRowIdPrefix","matches","match","updateDropdownField","getProductByRowId","find","headRow","getCellNameByCellIndex","anchorProduct","createGridProductRow","newId","anchorRowNode","insertBefore","nextSibling","initializeNewProductRow","bindOnRowEvents","has","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","setAttribute","makeCountable","setOriginalTemplateEditData","adjustRows","updateCounterDisplayed","updateCounterSelected","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","CURRENCY","previousRow","stores","values","previousStoreValue","titleName","ID","IMAGE_INFO","splice","refreshFieldsLayout","unshift","searchInDialog","focusName","tableFade","productRow","isNew","updateProductStoreValues","initHandlersForSelectors","tableUnfade","getDefaultMeasure","setConfig","isExistForm","initFormFields","cleanProductRows","prepareProductDataValue","productDataValue","getProductCount","productData","itemFields","test","stringify","actionSendProductChange","actionSendProductListChanged","updateFieldForList","updateFieldByName","updateTotalDataDelayedHandler","totalCost","setTotalData","productFields","setTotal","responce","status","gridRow","reset","a","b","removeSpotlight","removeQrAuth","errorsArray","concat","validate","addictedFields","productNode","processFieldTour","getActiveHint","actionId","_clickOnRowActionsButton","hasErrors","actionPanel","getActionsPanel","actionValues","getValues","actionStoreId","isUndefined","selectedRows","getSelected","actionStore","actionStoreName","TITLE","selectedItem","documentTypeMoving","messageId","getDropdowns","removeItemsRelativeCurrent","innerWrapper","innerText"],"mappings":"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"}