{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/price.calculator.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}","import {Type, Text} from \"main.core\";\n\ntype PriceCalculatorFields = {\n\tbasePrice: number,\n\tfinalPrice: number,\n\textra: number | null,\n\textraType: PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n}\n\nexport class PriceCalculator\n{\n\tstatic EXTRA_TYPE_PERCENTAGE = 1;\n\tstatic EXTRA_TYPE_MONETARY = 2;\n\n\t#fields: PriceCalculatorFields = {\n\t\tbasePrice: 0,\n\t\tfinalPrice: 0,\n\t\textra: null,\n\t\textraType: PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n\t};\n\n\n\tconstructor(fields: PriceCalculatorFields): void\n\t{\n\t\tthis.#fields = {...this.#fields, ...fields};\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.#fields.basePrice;\n\t}\n\n\tgetFinalPrice(): number\n\t{\n\t\treturn this.#fields.finalPrice;\n\t}\n\n\tgetExtra(): number | null\n\t{\n\t\treturn this.#fields.extra;\n\t}\n\n\tgetExtraType(): PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE\n\t{\n\t\treturn this.#fields.extraType;\n\t}\n\n\tcalculateBasePrice(basePrice: number): PriceCalculator\n\t{\n\t\tthis.#fields.basePrice = basePrice;\n\t\tthis.#fields.extra = Text.toNumber(this.#fields.extra);\n\n\t\tif (this.#fields.extraType === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\tthis.#fields.finalPrice = this.#fields.basePrice + this.#fields.extra;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#fields.finalPrice = this.#fields.basePrice * (1 + this.#fields.extra / 100);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcalculateFinalPrice(finalPrice: number): PriceCalculator\n\t{\n\t\tthis.#fields.finalPrice = finalPrice;\n\t\tconst basePrice = Text.toNumber(this.#fields.basePrice);\n\n\t\tif (basePrice <= 0)\n\t\t{\n\t\t\tthis.#fields.extraType = PriceCalculator.EXTRA_TYPE_MONETARY;\n\t\t}\n\n\t\tif (this.#fields.extraType === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\tthis.#fields.extra = this.#fields.finalPrice - basePrice;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#fields.extra = (this.#fields.finalPrice / basePrice - 1) * 100;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcalculateExtra(extra: number): PriceCalculator\n\t{\n\t\tthis.#fields.extra = extra;\n\t\tif (Type.isNil(extra))\n\t\t{\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.calculateBasePrice(this.#fields.basePrice);\n\t}\n\n\tcalculateExtraType(extraType: PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE): PriceCalculator\n\t{\n\t\tif (extraType !== PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\textraType = PriceCalculator.EXTRA_TYPE_PERCENTAGE;\n\t\t}\n\n\t\tthis.#fields.extraType = extraType;\n\n\t\treturn this.calculateFinalPrice(this.#fields.finalPrice);\n\t}\n}","import {Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {Editor} from './product.list.editor';\nimport {CurrencyCore} from 'currency.currency-core';\nimport 'ui.hint';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\nimport {ProductSelector} from \"catalog.product-selector\";\nimport {StoreSelector} from \"catalog.store-selector\";\nimport {PopupMenu} from \"main.popup\";\nimport {PriceCalculator} from \"./price.calculator\";\n\ntype Action = {\n\ttype: string,\n\tfield?: string,\n\tvalue?: string,\n};\n\ntype Settings = {}\n\nconst MODE_EDIT = 'EDIT';\nconst MODE_SET = 'SET';\nconst PRODUCT_TYPE_SET = 2;\n\nexport class Row\n{\n\tid: ?string;\n\tsettings: Object;\n\teditor: ?Editor\n\tmodel: ?ProductModel\n\tfields: Object = {};\n\tmainSelector: ?ProductSelector;\n\tbarcodeSelector: ?ProductSelector;\n\tstoreSelectors: Array<StoreSelector> = [];\n\texternalActions: Array<Action> = [];\n\tcache = new Cache.MemoryCache();\n\tmodeChanges = {\n\t\tEDIT: MODE_EDIT,\n\t\tSET: MODE_SET,\n\t};\n\tvalidatingFields: Map<string, boolean> = new Map();\n\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\n\t{\n\t\tthis.setId(id);\n\t\tthis.setSettings(settings);\n\t\tthis.setEditor(editor);\n\t\tthis.setModel(fields, settings);\n\t\tthis.initFields(fields);\n\t\tthis.#initSelector();\n\t\tthis.#initBarcode();\n\t\t// this.#initPriceExtra();\n\t\tthis.#initStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t\tthis.#initActions();\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('node', () => {\n\t\t\tconst rowId = this.getField('ID', 0);\n\n\t\t\treturn this.getEditorContainer().querySelector('[data-id=\"' + rowId + '\"]');\n\t\t});\n\t}\n\n\tgetSelector(): ?ProductSelector\n\t{\n\t\treturn this.mainSelector;\n\t}\n\n\tgetBarcodeSelector(): ?ProductSelector\n\t{\n\t\treturn this.barcodeSelector;\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id: string): void\n\t{\n\t\tthis.id = id;\n\t}\n\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings: Settings): void\n\t{\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\n\t}\n\n\tgetSettingValue(name, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value): void\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tsetEditor(editor: Editor): void\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tgetEditor(): Editor\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorContainer(): HTMLElement\n\t{\n\t\treturn this.getEditor().getContainer();\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.getEditor().getHintPopup();\n\t}\n\n\tinitHandlers()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for text fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for select fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t}\n\n\tinitHandlersForSelectors()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tlet selectorNames = ['MAIN_INFO', 'BARCODE_INFO'];\n\t\tconst storeFields = this.getSettingValue('storeHeaderMap', {});\n\t\tselectorNames = [...selectorNames, ...Object.keys(storeFields)];\n\n\t\tselectorNames.forEach((name) => {\n\t\t\tthis.getNode().querySelectorAll('[data-name=\"'+ name +'\"] input[type=\"text\"]').forEach(node => {\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t\t// disable drag-n-drop events for select fields\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\t});\n\t\t});\n\t}\n\n\t#initActions()\n\t{\n\t\tif (this.getEditor().isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tif (Type.isDomNode(actionCellContentContainer))\n\t\t{\n\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"#\"\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\n\t\t\t\t></a>\n\t\t\t`;\n\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\n\t\t\t\tconst menuItems = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_COPY_ACTION'),\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_DELETE_ACTION'),\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tPopupMenu.show({\n\t\t\t\t\tid: this.getId() + '_actions_popup',\n\t\t\t\t\tbindElement: actionsButton,\n\t\t\t\t\titems: menuItems\n\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\t#initSelector()\n\t{\n\t\tconst selectorOptions = {\n\t\t\tiblockId: this.model.getIblockId(),\n\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\tcurrency: this.model.getCurrency(),\n\t\t\tmodel: this.model,\n\t\t\tconfig: {\n\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: this.getSettingValue('isAllowedCreationProduct', true),\n\t\t\t\tENABLE_IMAGE_INPUT: true,\n\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\n\t\t\t\tROW_ID: this.getId(),\n\t\t\t\tENABLE_SKU_SELECTION: true,\n\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: true,\n\t\t\t\tRESTRICTED_PRODUCT_TYPES: [PRODUCT_TYPE_SET],\n\t\t\t},\n\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t};\n\n\t\tthis.mainSelector = new ProductSelector('catalog_document_grid_' + this.getId(), selectorOptions);\n\t\tconst mainInfoNode = this.getNode().querySelector('[data-name=\"MAIN_INFO\"]');\n\t\tif (mainInfoNode)\n\t\t{\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\n\t\t\tif (!Type.isDomNode(numberSelector))\n\t\t\t{\n\t\t\t\tmainInfoNode.appendChild(Tag.render`<div class=\"main-grid-row-number\"></div>`);\n\t\t\t}\n\n\t\t\tlet selectorWrapper =  mainInfoNode.querySelector('.main-grid-row-product-selector');\n\t\t\tif (!Type.isDomNode(selectorWrapper))\n\t\t\t{\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`\n\t\t\t\tmainInfoNode.appendChild(selectorWrapper)\n\t\t\t}\n\t\t\tthis.mainSelector.renderTo(selectorWrapper);\n\t\t}\n\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.mainSelector,\n\t\t\t'onBeforeCreate',\n\t\t\tthis.#handleBeforeCreateProduct.bind(this)\n\t\t);\n\t}\n\n\t#initBarcode()\n\t{\n\t\tconst selectorOptions = {\n\t\t\tiblockId: this.model.getIblockId(),\n\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\tcurrency: this.model.getCurrency(),\n\t\t\tmodel: this.model,\n\t\t\tinputFieldName: 'BARCODE',\n\t\t\ttype: ProductSelector.INPUT_FIELD_BARCODE,\n\t\t\tconfig: {\n\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: this.getSettingValue('isAllowedCreationProduct', true),\n\t\t\t\tENABLE_INFO_SPOTLIGHT: this.editor.getSettingValue('showBarcodeSpotlightInfo',true),\n\t\t\t\tENABLE_BARCODE_QR_AUTH: this.editor.getSettingValue('showBarcodeQrAuth',true),\n\t\t\t\tENABLE_IMAGE_INPUT: false,\n\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\tROW_ID: this.getId(),\n\t\t\t\tENABLE_SKU_SELECTION: false,\n\t\t\t\tENABLE_SKU_TREE: false,\n\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: false,\n\t\t\t\tRESTRICTED_PRODUCT_TYPES: [PRODUCT_TYPE_SET],\n\t\t\t},\n\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t\tscannerToken: this.getEditor().scannerToken,\n\t\t};\n\n\t\tthis.barcodeSelector = new ProductSelector('catalog_document_grid_' + this.getId() + '_barcode', selectorOptions);\n\t\tconst barcodeWrapper = this.getNode().querySelector('[data-name=\"BARCODE_INFO\"]');\n\t\tif (barcodeWrapper)\n\t\t{\n\t\t\tthis.barcodeSelector.renderTo(barcodeWrapper);\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBeforeCreate',\n\t\t\tthis.#handleBeforeCreateProduct.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onSpotlightClose',\n\t\t\tthis.#handleSpotlightClose.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeQrClose',\n\t\t\tthis.#handleBarcodeQrClose.bind(this)\n\t\t);\n\t}\n\n\t#initPriceExtra()\n\t{\n\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE\"]');\n\t\tif (!Type.isDomNode(node))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldExtraNode = node.querySelector('.catalog-store-extra-price');\n\t\tif (Type.isDomNode(oldExtraNode))\n\t\t{\n\t\t\toldExtraNode.parentNode.removeChild(oldExtraNode);\n\t\t}\n\n\t\tconst extraValue = this.getField('BASE_PRICE_EXTRA') ?? '';\n\t\tconst inputValue = Tag.render`\n\t\t\t<div>\n\t\t\t\t<input\n\t\t\t\t\tplaceholder=\"-\"\n\t\t\t\t\tclass=\"catalog-store-extra-price\"\n\t\t\t\t\tdata-name=\"BASE_PRICE_EXTRA\"\n\t\t\t\t\tvalue=\"${extraValue}\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst extraMeasureValue =\n\t\t\tthis.getField('BASE_PRICE_EXTRA_RATE') === PriceCalculator.EXTRA_TYPE_MONETARY\n\t\t\t\t? this.getEditor().getCurrencyText()\n\t\t\t\t: '%'\n\t\t;\n\n\t\tconst measureValue = Tag.render`\n\t\t\t<div class=\"main-grid-editor main-grid-editor-money-currency\">\n\t\t\t\t<span class=\"main-dropdown-inner\" data-name=\"BASE_PRICE_EXTRA_RATE\">${extraMeasureValue}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(measureValue, 'click', () => {\n\t\t\tconst menuItems = [\n\t\t\t\t{\n\t\t\t\t\ttext: '%',\n\t\t\t\t\tonclick: this.handleSelectExtraPriceType.bind(this),\n\t\t\t\t\ttype: PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: this.getEditor().getCurrencyText(),\n\t\t\t\t\tonclick: this.handleSelectExtraPriceType.bind(this),\n\t\t\t\t\ttype: PriceCalculator.EXTRA_TYPE_MONETARY,\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tPopupMenu.show({\n\t\t\t\tid: this.getId() + '_extra_type_popup',\n\t\t\t\tbindElement: measureValue,\n\t\t\t\titems: menuItems\n\t\t\t});\n\t\t});\n\n\t\tconst extraNode = Tag.render`\n\t\t\t<div class=\"main-grid-editor catalog-store-extra-price\">\n\t\t\t\t${inputValue}\n\t\t\t\t${measureValue}\n\t\t\t</div>\n\t\t`;\n\n\t\tnode.appendChild(extraNode);\n\t}\n\n\t#initStoreSelector(fieldNames: {})\n\t{\n\t\tObject.keys(fieldNames)\n\t\t\t.forEach( rowName => {\n\t\t\t\tconst selectorOptions = {\n\t\t\t\t\tinputFieldId: fieldNames[rowName],\n\t\t\t\t\tinputFieldTitle: fieldNames[rowName] + '_TITLE',\n\t\t\t\t\tconfig: {\n\t\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t\t},\n\t\t\t\t\tmode: StoreSelector.MODE_EDIT,\n\t\t\t\t\tmodel: this.model,\n\t\t\t\t};\n\n\t\t\t\tconst storeSelector = new StoreSelector(this.getId() + '_' + rowName, selectorOptions);\n\t\t\t\tconst storeWrapper = this.getNode().querySelector('[data-name=\"' + rowName + '\"]');\n\t\t\t\tif (storeSelector)\n\t\t\t\t{\n\t\t\t\t\tstoreSelector.renderTo(storeWrapper);\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.subscribe(\n\t\t\t\t\tstoreSelector,\n\t\t\t\t\t'onChange',\n\t\t\t\t\tRuntime.debounce(this.#onStoreFieldChange.bind(this), 500, this)\n\t\t\t\t);\n\n\t\t\t\tthis.storeSelectors.push(storeSelector);\n\t\t\t});\n\t}\n\n\t#onStoreFieldChange(event)\n\t{\n\t\tconst data = event.getData();\n\t\tdata.fields.forEach((item) => {\n\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t});\n\t}\n\n\tsetRowNumber(number)\n\t{\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach(node => {\n\t\t\tnode.textContent = number + '.';\n\t\t});\n\t}\n\n\tgetFields(fields: Array = [])\n\t{\n\t\tlet result;\n\n\t\tif (!Type.isArrayFilled(fields))\n\t\t{\n\t\t\tresult = Runtime.clone(this.fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\n\t\t\tfor (let fieldName of fields)\n\t\t\t{\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinitFields(fields: Object): void\n\t{\n\t\tthis.getModel().initFields(fields, false);\n\t\tthis.setFields(fields);\n\t}\n\n\tsetFields(fields: Object): void\n\t{\n\t\tfor (let name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value, changeModel: boolean = true): void\n\t{\n\t\tthis.fields[name] = value;\n\n\t\tif (changeModel)\n\t\t{\n\t\t\tthis.getModel().setField(name, value);\n\t\t}\n\t}\n\n\tgetUiFieldId(field): string\n\t{\n\t\treturn this.getId() + '_' + field;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tgetAmount(): number\n\t{\n\t\treturn this.getField('AMOUNT', 1);\n\t}\n\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\n\t{\n\t\tconst target = event.target;\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\tconst mode = (event.type === 'input' || event.type === 'change') ? MODE_EDIT : MODE_SET;\n\n\t\tthis.updateField(fieldCode, value, mode);\n\t}\n\n\tupdateDropdownField(fieldCode: string, value: any): void\n\t{\n\t\tthis.updateField(fieldCode, value, MODE_EDIT);\n\t}\n\n\tupdateField(fieldCode: string, value: any, mode = MODE_SET): void\n\t{\n\t\tthis.resetExternalActions();\n\t\tthis.updateFieldValue(fieldCode, value, mode);\n\t\tthis.executeExternalActions();\n\t}\n\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'SKU_ID':\n\t\t\t\tthis.changeProductId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tthis.changeBasePrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\t// case 'BASE_PRICE_EXTRA':\n\t\t\t// \tthis.changeExtra(value, mode);\n\t\t\t// \tbreak;\n\n\t\t\tcase 'PURCHASING_PRICE':\n\t\t\t\tthis.changePurchasingPrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'AMOUNT':\n\t\t\t\tthis.changeAmount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'MEASURE_CODE':\n\t\t\t\tthis.changeMeasureCode(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'BARCODE':\n\t\t\t\tthis.changeBarcode(value, mode);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_FROM':\n\t\t\tcase 'STORE_TO':\n\t\t\t\tthis.changeStore(value, code);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_FROM_TITLE':\n\t\t\tcase 'STORE_TO_TITLE':\n\t\t\t\tthis.changeStoreName(value, code);\n\t\t\t\tbreak;\n\t\t\tcase 'NAME':\n\t\t\tcase 'MAIN_INFO':\n\t\t\t\tthis.changeProductName(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SORT':\n\t\t\t\tthis.changeSort(value, mode);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateFieldByName(field, value)\n\t{\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.setTaxIncluded(value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tchangeProductId(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tthis.setProductId(preparedValue);\n\t}\n\n\thandleCopyAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.copyRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\thandleDeleteAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.deleteRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t\tthis.unsubscribeEvents();\n\n\t\tthis.#handleProductErrorsChange();\n\t}\n\n\tunsubscribeEvents()\n\t{\n\t\tthis.getBarcodeSelector().unsubscribeEvents();\n\t}\n\n\thandleSelectExtraPriceType(event, menuItem)\n\t{\n\t\tthis.changeExtraType(menuItem.type, MODE_EDIT);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\t#getCalculator()\n\t{\n\t\tconst extra =\n\t\t\tType.isNumber(this.getModel().getField('BASE_PRICE_EXTRA'))\n\t\t\t\t? this.getModel().getField('BASE_PRICE_EXTRA')\n\t\t\t\t: null\n\t\t;\n\n\t\treturn new PriceCalculator({\n\t\t\tbasePrice: Text.toNumber(this.getModel().getField('PURCHASING_PRICE')),\n\t\t\tfinalPrice: Text.toNumber(this.getModel().getField('BASE_PRICE')),\n\t\t\textra,\n\t\t\textraType: Text.toNumber(this.getModel().getField('BASE_PRICE_EXTRA_RATE')),\n\t\t});\n\t}\n\n\tchangeExtraType(value, mode = MODE_SET)\n\t{\n\t\tlet text = '%';\n\t\tif (value === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\ttext = this.getEditor().getCurrencyText();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvalue = PriceCalculator.EXTRA_TYPE_PERCENTAGE;\n\t\t}\n\n\t\tif (value === this.getField('BASE_PRICE_EXTRA_RATE'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst calculator =\n\t\t\t\tthis.#getCalculator()\n\t\t\t\t\t.calculateExtraType(value)\n\t\t\t;\n\n\t\t\tthis.changeExtra(calculator.getExtra());\n\t\t\tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t}\n\n\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE_EXTRA_RATE\"]');\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tnode.innerHTML = text;\n\t\t}\n\n\t\tthis.setField('BASE_PRICE_EXTRA_RATE', value);\n\t}\n\n\tchangeExtra(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = (Type.isNil(value) || value === '') ? null : this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setField('BASE_PRICE_EXTRA', preparedValue);\n\n\t\tif (preparedValue === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst calculator =\n\t\t\t\tthis.#getCalculator()\n\t\t\t\t\t.calculateExtra(preparedValue)\n\t\t\t;\n\n\t\t\tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE_EXTRA\"]');\n\t\t\tif (Type.isDomNode(node))\n\t\t\t{\n\t\t\t\tnode.value = preparedValue;\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeBasePrice(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setBasePrice(preparedValue, mode);\n\n\t\t// if (mode === MODE_EDIT)\n\t\t// {\n\t\t// \tconst calculator =\n\t\t// \t\tthis.#getCalculator()\n\t\t// \t\t\t.calculateFinalPrice(preparedValue)\n\t\t// \t;\n\t\t//\n\t\t// \tthis.changeExtra(calculator.getExtra());\n\t\t// \tthis.changeExtraType(calculator.getExtraType());\n\t\t// }\n\t}\n\n\tchangePurchasingPrice(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setPurchasingPrice(preparedValue, mode);\n\n\t\t// const currentExtra = this.getField('BASE_PRICE_EXTRA');\n\t\t// if (mode === MODE_EDIT && !Type.isNil(currentExtra) && currentExtra !== '')\n\t\t// {\n\t\t// \tconst calculator =\n\t\t// \t\tthis.#getCalculator()\n\t\t// \t\t\t.calculateBasePrice(preparedValue)\n\t\t// \t;\n\t\t//\n\t\t// \tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t// }\n\t}\n\n\tchangeAmount(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\n\t\tthis.setAmount(preparedValue, mode);\n\t}\n\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\n\t{\n\t\tthis\n\t\t\t.getEditor()\n\t\t\t.getMeasures()\n\t\t\t.filter((item) => item.CODE === value)\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\n\t\t;\n\t}\n\n\tchangeBarcode(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('BARCODE') !== preparedValue;\n\n\t\tif (isChangedValue && mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('BARCODE', preparedValue);\n\t\t\tthis.setField('DOC_BARCODE', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t\telse if (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.setField('DOC_BARCODE', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStore(value: number, code: string)\n\t{\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tconst isChangedValue = this.getField(code) !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField(code, preparedValue);\n\t\t\tthis.setStoreAmount(value, code);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStoreName(value: number, code: string)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tthis.setField(code, preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeProductName(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('NAME') !== preparedValue;\n\n\t\tif (isChangedValue && mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('NAME', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeSort(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('SORT', preparedValue);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\n\t{\n\t\tfor (let field in this.fields)\n\t\t{\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\n\t\t\t{\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\n\t\t\t}\n\t\t}\n\t\tthis.updateUiMeasure(\n\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\tthis.getField('MEASURE_NAME')\n\t\t)\n\t\tthis.getSelector()?.reloadFileInput();\n\t\tthis.getSelector()?.layout();\n\t\tthis.getBarcodeSelector()?.layout();\n\t\tthis.updateUiStoreValues();\n\t}\n\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\n\t{\n\t\tconst selectorId = 'catalog_document_grid_' + this.getId();\n\t\tif (selectorId)\n\t\t{\n\t\t\tconst model = ProductModel.getById(selectorId);\n\t\t\tif (model)\n\t\t\t{\n\t\t\t\tthis.model = model;\n\t\t\t}\n\t\t}\n\n\t\tif (!(this.model instanceof ProductModel))\n\t\t{\n\t\t\tthis.model = new ProductModel({\n\t\t\t\tid: selectorId,\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\n\t\t\t\tiblockId: fields['IBLOCK_ID'],\n\t\t\t\tbasePriceId: fields['BASE_PRICE_ID'],\n\t\t\t\tskuTree: Type.isStringFilled(fields['SKU_TREE']) ? JSON.parse(fields['SKU_TREE']) : null,\n\t\t\t\tstoreMap: fields['STORE_AMOUNT_MAP'],\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tif (Type.isObject(fields['IMAGE_INFO']))\n\t\t\t{\n\t\t\t\tthis.model.getImageCollection().setPreview(fields['IMAGE_INFO']['preview']);\n\t\t\t\tthis.model.getImageCollection().setEditInput(fields['IMAGE_INFO']['input']);\n\t\t\t\tthis.model.getImageCollection().setMorePhotoValues(fields['IMAGE_INFO']['values']);\n\t\t\t}\n\n\t\t\tif (!Type.isNil(fields['DETAIL_URL']))\n\t\t\t{\n\t\t\t\tthis.model.setDetailPath(fields['DETAIL_URL']);\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tRuntime.debounce(this.#handleProductErrorsChange, 500, this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.updateUiStoreValues.bind(this)\n\t\t);\n\t}\n\n\tgetModel(): ?ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\t#handleProductErrorsChange()\n\t{\n\t\tconst errors = this.getModel().getErrorCollection().getErrors();\n\t\tfor (const code in errors)\n\t\t{\n\t\t\tif (code === ProductSelector.ErrorCodes.NOT_SELECTED_PRODUCT)\n\t\t\t{\n\t\t\t\tthis.getSelector().layoutErrors();\n\t\t\t}\n\t\t}\n\n\t\tthis.getEditor().handleProductErrorsChange();\n\t}\n\n\t#handleBeforeCreateProduct(event: BaseEvent)\n\t{\n\t\tconst {model} = event.getData();\n\t\tmodel.setField('BARCODE', this.barcodeSelector.getNameInputFilledValue());\n\t\tmodel.setField('NAME', this.mainSelector.getNameInputFilledValue());\n\t}\n\n\t#handleSpotlightClose(event: BaseEvent): void\n\t{\n\t\tthis.editor.closeBarcodeSpotlights();\n\t}\n\n\t#handleBarcodeQrClose(event: BaseEvent): void\n\t{\n\t\tthis.editor.closeBarcodeQrAuths();\n\t}\n\n\tsetProductId(value)\n\t{\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_ID', value);\n\t\t\tthis.setField('SKU_ID', value);\n\n\t\t\tthis.updateUiStoreValues();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetBasePrice(value, mode = MODE_SET)\n\t{\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiField('BASE_PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\t\tthis.setField('BASE_PRICE', value);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\t}\n\n\tupdateProductStoreValues()\n\t{\n\t\tthis.storeSelectors.forEach((selector) => {\n\t\t\tselector.setProductId(this.getModel().getSkuId());\n\t\t});\n\t}\n\n\tupdateUiStoreValues()\n\t{\n\t\tconst storeHeaderMap = this.getSettingValue('storeHeaderMap', {});\n\t\tObject.keys(storeHeaderMap).forEach((key) => {\n\t\t\tconst fieldName = storeHeaderMap[key];\n\t\t\tlet value = this.getField(fieldName);\n\t\t\tif (fieldName === 'STORE_FROM')\n\t\t\t{\n\t\t\t\tconst currentAmount = this.model.getStoreCollection().getStoreAmount(value);\n\t\t\t\tif (currentAmount <= 0)\n\t\t\t\t{\n\t\t\t\t\tconst maxStore = this.model.getStoreCollection().getMaxFilledStore();\n\t\t\t\t\tconst storeSelector = StoreSelector.getById(this.getId() + '_' + key);\n\t\t\t\t\tif (maxStore.AMOUNT > currentAmount && storeSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tstoreSelector.onStoreSelect(maxStore.STORE_ID, maxStore.STORE_TITLE);\n\t\t\t\t\t\tvalue = maxStore.STORE_ID;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setStoreAmount(value, fieldName)\n\t\t});\n\t}\n\n\tsetStoreAmount(value, fieldName, mode = MODE_SET)\n\t{\n\t\t// price can't be less than zero\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tlet amount;\n\n\t\t\tconst amounts = {\n\t\t\t\t'_AMOUNT': () => this.model.getStoreCollection().getStoreAmount(value),\n\t\t\t\t'_RESERVED': () => this.model.getStoreCollection().getStoreReserved(value),\n\t\t\t\t'_AVAILABLE_AMOUNT': () => this.model.getStoreCollection().getStoreAvailableAmount(value),\n\t\t\t};\n\t\t\tfor (const postfix in amounts) {\n\t\t\t\tif (Object.hasOwnProperty.call(amounts, postfix)) {\n\t\t\t\t\tconst wrapper = this.getNode().querySelector('[data-name=' + fieldName + postfix + ']');\n\t\t\t\t\tif (wrapper)\n\t\t\t\t\t{\n\t\t\t\t\t\tamount = amounts[postfix]() || 0;\n\t\t\t\t\t\twrapper.innerHTML = amount + ' ' + Text.encode(this.getField('MEASURE_NAME'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsetPurchasingPrice(value, mode = MODE_SET)\n\t{\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiField('PURCHASING_PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\t\tthis.setField('PURCHASING_PRICE', value);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\t}\n\n\tsetAmount(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('AMOUNT', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('AMOUNT') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('AMOUNT', value);\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetMeasure(measure, mode = MODE_SET)\n\t{\n\t\tif (this.model.isEmpty())\n\t\t{\n\t\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\t\t\tthis.updateUiMeasure(measure.CODE,\tmeasure.SYMBOL);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.getModel().showSaveNotifier(\n\t\t\t\t'measureChanger_' + this.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\n\t\t\t\t\tdeclineCancelTitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_DECLINE_SAVE'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\t\t\t\t\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\t\t\t\t\t\t\tthis.updateUiMeasure(\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_NAME')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\t\tthis.updateUiMeasure(\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_NAME')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateUiMeasure(measure.CODE,\tmeasure.SYMBOL);\n\t\t}\n\n\t\tthis.addActionProductChange();\n\t}\n\n\t// controls\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst fieldId = this.getUiFieldId(fieldName);\n\t\tlet item = document.getElementById(fieldId);\n\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\titem = this.getNode().querySelector('[name=\"' + fieldId + '\"]');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tgetInputWrapperByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst inputBlock = this.getInputByFieldName(fieldName);\n\n\t\tif (Type.isElementNode(inputBlock))\n\t\t{\n\t\t\treturn Type.isElementNode(inputBlock.parentNode) ? inputBlock.parentNode : inputBlock;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tupdateUiInputField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.value = value;\n\t\t}\n\t}\n\n\tupdateUiCheckboxField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.checked = value === 'Y';\n\t\t}\n\t}\n\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\n\t{\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.dropdownManager.getById(this.getId() + '_' + name + '_control');\n\t}\n\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\n\t{\n\t\tif (dropdown.getValue() === value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (dropdown.menu)\n\t\t{\n\t\t\tdropdown.menu.destroy();\n\t\t}\n\n\t\tconst item = dropdown.menu.itemsContainer.querySelector('[data-value=\"' + value + '\"]');\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\n\t\tif (menuItem)\n\t\t{\n\t\t\tdropdown.refresh(menuItem);\n\t\t\tdropdown.selectItem(menuItem);\n\t\t}\n\t}\n\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.dataset.value = value;\n\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\n\t\tif (!Type.isElementNode(span))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tspan.innerHTML = text;\n\t}\n\n\tupdateUiMeasure(code, name)\n\t{\n\t\tthis.updateUiMoneyField(\n\t\t\t'MEASURE_CODE',\n\t\t\tcode,\n\t\t\tText.encode(name)\n\t\t);\n\n\t\tthis.updateUiStoreValues();\n\t}\n\n\tupdateUiHtmlField(name, html)\n\t{\n\t\tconst item = this.getNode().querySelector('[data-name=\"' + name + '\"]');;\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.innerHTML = html;\n\t\t}\n\t}\n\n\tupdateUiCurrencyFields()\n\t{\n\t\tconst currencyText = this.getEditor().getCurrencyText();\n\t\tconst currencyId = '' + this.getEditor().getCurrencyId();\n\n\t\tconst currencyFieldNames = ['BASE_PRICE_CURRENCY', 'PURCHASING_PRICE_CURRENCY'];\n\t\tcurrencyFieldNames.forEach((name) => {\n\t\t\tconst dropdownValues = [];\n\t\t\tdropdownValues.push({\n\t\t\t\tNAME: currencyText,\n\t\t\t\tVALUE: currencyId,\n\t\t\t});\n\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\n\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\n\t\t});\n\t}\n\n\tupdateUiField(field, value): void\n\t{\n\t\tconst uiName = this.getUiFieldName(field);\n\t\tif (!uiName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst uiType = this.getUiFieldType(field);\n\t\tif (!uiType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (uiType)\n\t\t{\n\t\t\tcase 'input':\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money':\n\t\t\t\tvalue = BX.util.number_format(value, this.getPricePrecision(), \".\", \"\");\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money_html':\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetUiFieldName(field)\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'AMOUNT':\n\t\t\tcase 'MEASURE_CODE':\n\t\t\tcase 'BASE_PRICE':\n\t\t\tcase 'PURCHASING_PRICE':\n\t\t\t\tresult = field;\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetUiFieldType(field)\n\t{\n\t\tif (field === 'BASE_PRICE' || field === 'PURCHASING_PRICE')\n\t\t{\n\t\t\tconst column = this.getEditor()?.getColumnInfo(field);\n\t\t\tif (column?.editable?.TYPE === 'MONEY')\n\t\t\t{\n\t\t\t\treturn  'money';\n\t\t\t}\n\n\t\t\treturn  'money_html';\n\t\t}\n\t\telse if (field === 'AMOUNT')\n\t\t{\n\t\t\treturn  'input';\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// proxy\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\treturn this.getEditor().parseInt(value, defaultValue);\n\t}\n\n\tparseFloat(value: number | string, precision: number, defaultValue = 0)\n\t{\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\n\t}\n\n\tgetPricePrecision()\n\t{\n\t\treturn this.getEditor().getPricePrecision();\n\t}\n\n\tgetQuantityPrecision()\n\t{\n\t\treturn this.getEditor().getQuantityPrecision();\n\t}\n\n\tgetCommonPrecision()\n\t{\n\t\treturn this.getEditor().getCommonPrecision();\n\t}\n\n\tresetExternalActions()\n\t{\n\t\tthis.externalActions.length = 0;\n\t}\n\n\taddExternalAction(action: Action)\n\t{\n\t\tthis.externalActions.push(action);\n\t}\n\n\taddActionProductChange()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.productChange,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionUpdateTotal()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateTotal\n\t\t});\n\t}\n\n\texecuteExternalActions()\n\t{\n\t\tif (this.externalActions.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getEditor().executeActions(this.externalActions);\n\t\tthis.resetExternalActions();\n\t}\n\n\tisEmptyRow()\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('NAME', '').trim())\n\t\t\t&& this.model.isEmpty()\n\t\t\t&& this.getBasePrice() <= 0\n\t\t)\n\t}\n\n\tvalidate(): Array\n\t{\n\t\tconst errorsList = [];\n\n\t\tif (!this.#isProductCountCorrect(this.getAmount()))\n\t\t{\n\t\t\tthis.#subscribeFieldToValidator('AMOUNT', this.#isProductCountCorrect);\n\t\t\terrorsList.push(Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_INVALID_AMOUNT'));\n\t\t}\n\n\t\treturn errorsList;\n\t}\n\n\t#subscribeFieldToValidator(fieldName: string, validatorCallback: Function): void\n\t{\n\t\tconst fieldInput = this.getInputByFieldName(fieldName);\n\t\tconst fieldWrapper = this.getInputWrapperByFieldName(fieldName);\n\n\t\tif (validatorCallback(fieldInput.valueAsNumber) || this.validatingFields.get(fieldName))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.validatingFields.set(fieldName, true);\n\n\t\tfieldWrapper.classList.add('main-grid-editor-cell-danger');\n\n\t\tconst validator = (eventObject) => {\n\t\t\tif (Boolean(validatorCallback(eventObject.target.valueAsNumber)))\n\t\t\t{\n\t\t\t\tthis.validatingFields.set(fieldName, false);\n\t\t\t\tEvent.unbind(fieldInput, 'blur', validator);\n\t\t\t\tfieldWrapper.classList.remove('main-grid-editor-cell-danger');\n\t\t\t}\n\t\t};\n\n\t\tEvent.bind(fieldInput, 'blur', validator);\n\t}\n\n\t#isProductCountCorrect(amountValue): boolean\n\t{\n\t\treturn amountValue > 0;\n\t}\n}\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import {Popup} from 'main.popup';\nimport {ajax, Cache, Event, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {Editor} from './product.list.editor';\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\t#getSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title\">${item.title}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.#getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.#requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\t#requestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tconst message = enabled\n\t\t\t\t? Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_ENABLED')\n\t\t\t\t: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_DISABLED');\n\n\t\t\tthis.#showNotification(message.replace('#NAME#', setting.title), {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}","import {ajax, Cache, Dom, Event, Reflection, Runtime, Text, Type, Loc} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Row} from './product.list.row';\nimport {PageEventsManager} from './page.events.manager';\nimport SettingsPopup from './settings.button';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {ProductSelector} from 'catalog.product-selector';\nimport HintPopup from './hint.popup';\nimport ProductListController from \"catalog.document-card\";\nimport {ProductModel} from \"catalog.product-model\";\n\nconst GRID_TEMPLATE_ROW = 'template_0';\nconst DEFAULT_PRECISION: number = 2;\n\nexport class Editor\n{\n\tid: ?string;\n\tsettings: Object;\n\tcontroller: ?ProductListController;\n\tcontainer: ?HTMLElement;\n\tform: ?HTMLElement\n\tproducts: Row[] = [];\n\tproductsWasInitiated = false;\n\tpageEventsManager: PageEventsManager;\n\tcache = new Cache.MemoryCache();\n\n\tactions = {\n\t\tproductChange: 'productChange',\n\t\tproductListChanged: 'productListChanged',\n\t\tupdateListField: 'listField',\n\t\tupdateTotal: 'total'\n\t};\n\n\tupdateFieldForList = null;\n\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\n\tproductRowCreateHandler = this.handleProductRowCreate.bind(this);\n\tshowBarcodeSettingsPopupHandler = this.handleShowBarcodeSettingsPopup.bind(this);\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\n\n\tonSaveHandler = this.handleOnSave.bind(this);\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\n\tonScanEmitHandler = this.handleMobileScanEvent.bind(this);\n\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 100, this);\n\n\tconstructor(id)\n\t{\n\t\tthis.setId(id);\n\t}\n\n\tinit(config = {})\n\t{\n\t\tthis.setSettings(config);\n\n\t\tthis.scannerToken = this.scannerToken ?? Text.getRandom(16);\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.enableEdit();\n\t\t}\n\n\t\tthis.initForm();\n\t\tthis.initProducts();\n\t\tthis.initGridData();\n\t\tthis.paintColumns();\n\n\t\tEventEmitter.emit( 'DocumentProductListController', [this]);\n\n\t\tthis.#initSupportCustomRowActions();\n\t\tthis.subscribeDomEvents();\n\t\tthis.subscribeCustomEvents();\n\t}\n\n\tsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-create-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowCreateHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-barcode-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showBarcodeSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((createButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tcreateButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowCreateHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-barcode-settings-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tEventEmitter.subscribe('BarcodeScanner::onScanEmit', this.onScanEmitHandler);\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.unsubscribe('BX.UI.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.unsubscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tEventEmitter.unsubscribe('BarcodeScanner::onScanEmit', this.onScanEmitHandler);\n\t}\n\n\thandleMobileScanEvent(event: BaseEvent): void\n\t{\n\t\tconst params = event.getData();\n\t\tif (this.scannerToken !== params.id || !Type.isStringFilled(params.barcode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let product of this.products)\n\t\t{\n\t\t\tif (product.getBarcodeSelector()?.searchInput?.getNameInput() === document.activeElement)\n\t\t\t{\n\t\t\t\tproduct.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tfor (let product of this.products)\n\t\t{\n\t\t\tif (\n\t\t\t\tproduct.getBarcodeSelector()?.searchInput?.getNameInput().value === ''\n\t\t\t\t&& product.getSelector()?.searchInput?.getNameInput().value === ''\n\t\t\t)\n\t\t\t{\n\t\t\t\tproduct.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst newRowId = this.addProductRow();\n\t\tthis.getProductById(newRowId)?.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\t}\n\n\t#initSupportCustomRowActions()\n\t{\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\n\t}\n\n\tselectProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(id)\n\t\t\t\t?.onProductSelect(productId)\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnSave(event: BaseEvent)\n\t{\n\t\tconst notification = ProductModel.getLastActiveSaveNotification();\n\t\tif (notification)\n\t\t{\n\t\t\tnotification.close();\n\t\t}\n\n\t\tconst items = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\tconst item = {\n\t\t\t\tfields: {...product.fields},\n\t\t\t\trowId: product.fields.ROW_ID\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\n\t\tthis.setSettingValue('items', items);\n\t}\n\n\thandleEditorSubmit(event: BaseEvent)\n\t{\n\t}\n\n\tonInnerCancel()\n\t{\n\t\tthis.reloadGrid(false);\n\t}\n\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tconst activePanel = container.querySelector('.catalog-document-product-list-add-block-' + panelCode);\n\t\tif (Type.isDomNode(activePanel))\n\t\t{\n\t\t\tDom.removeClass(activePanel, 'catalog-document-product-list-add-block-hidden');\n\t\t\tDom.addClass(activePanel, 'catalog-document-product-list-add-block-active');\n\t\t}\n\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\n\t\tconst removePanel = container.querySelector('.catalog-document-product-list-add-block-' + hiddenPanelCode);\n\t\tif (Type.isDomNode(removePanel))\n\t\t{\n\t\t\tDom.addClass(removePanel, 'catalog-document-product-list-add-block-hidden');\n\t\t\tDom.removeClass(removePanel, 'catalog-document-product-list-add-block-active');\n\t\t}\n\n\t\treturn activePanel;\n\t}\n\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\n\t{\n\t\tif (isInternalChanging === null)\n\t\t{\n\t\t\tisInternalChanging = !useProductsFromRequest;\n\t\t}\n\n\t\tthis.getGrid().reloadTable(\n\t\t\t'POST',\n\t\t\t{useProductsFromRequest},\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging})\n\t\t);\n\t}\n\n\t/*\n\t\tkeep in mind different actions for this handler:\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t */\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\n\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tuseProductsFromRequest,\n\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields() : null,\n\t\t};\n\n\t\tlet isDeletingRequest = false;\n\t\tif (eventArgs.data['action_button_' + eventArgs.gridId] === 'delete')\n\t\t{\n\t\t\tisDeletingRequest = true;\n\t\t}\n\n\t\tthis.clearEditor();\n\n\t\tif (isNativeAction)\n\t\t{\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', (event) => {\n\t\t\t\tconst [grid] = event.getCompatData();\n\n\t\t\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.actionUpdateTotalData({isInternalChanging: false});\n\t\t\t\tif (isDeletingRequest)\n\t\t\t\t{\n\t\t\t\t\tthis.executeActions([\n\t\t\t\t\t\t{type: this.actions.productListChanged},\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\thandleOnGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSettingsPopup().updateCheckboxState();\n\t}\n\n\thandleOnGridRowMoved(event: BaseEvent)\n\t{\n\t\tconst [ids, , grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.resortProductsByIds(ids);\n\t\tif (changed)\n\t\t{\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\n\t\t}\n\t}\n\n\tinitPageEventsManager(): void\n\t{\n\t\tconst componentId = this.getSettingValue('componentId');\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\n\t}\n\n\tgetPageEventsManager(): PageEventsManager\n\t{\n\t\tif (!this.pageEventsManager)\n\t\t{\n\t\t\tthis.initPageEventsManager();\n\t\t}\n\n\t\treturn this.pageEventsManager;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.getSettingValue('allowEdit', false) === true;\n\t}\n\n\tenableEdit()\n\t{\n\t\t// Cannot use editSelected because checkboxes have been removed\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((current) => {\n\t\t\tif (!current.isHeadChild() && !current.isTemplate())\n\t\t\t{\n\t\t\t\tcurrent.edit();\n\t\t\t}\n\t\t});\n\t}\n\n\taddFirstRowIfEmpty(): void\n\t{\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\trequestAnimationFrame(() => this.addProductRow());\n\t\t}\n\t}\n\n\tclearEditor()\n\t{\n\t\tthis.unsubscribeProductsEvents();\n\n\t\tthis.products = [];\n\t\tthis.productsWasInitiated = false;\n\n\t\tthis.destroySettingsPopup();\n\t\tthis.unsubscribeDomEvents();\n\t\tthis.unsubscribeCustomEvents();\n\n\t\tEvent.unbindAll(this.container);\n\t}\n\n\twasProductsInitiated()\n\t{\n\t\treturn this.productsWasInitiated;\n\t}\n\n\tunsubscribeProductsEvents()\n\t{\n\t\tthis.products.forEach((current) => {\n\t\t\tconst productSelector = current.getSelector();\n\t\t\tif (productSelector)\n\t\t\t{\n\t\t\t\tproductSelector.unsubscribeEvents();\n\t\t\t}\n\t\t\tconst barcodeSelector = current.getBarcodeSelector();\n\t\t\tif (barcodeSelector)\n\t\t\t{\n\t\t\t\tbarcodeSelector.unsubscribeEvents();\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.setForm(null);\n\t\tthis.clearController();\n\t\tthis.clearEditor();\n\t}\n\n\tsetController(controller)\n\t{\n\t\tif (this.controller === controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.clearProductList();\n\t\t}\n\t\tthis.controller = controller;\n\t}\n\n\tclearController()\n\t{\n\t\tthis.controller = null;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\t/* settings tools */\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings)\n\t{\n\t\tthis.settings = settings ? settings : {};\n\t}\n\n\tgetSettingValue(name: string, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value)\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tgetComponentName()\n\t{\n\t\treturn this.getSettingValue('componentName', '');\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getSettingValue('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getSettingValue('signedParameters', '');\n\t}\n\n\tgetContainerId()\n\t{\n\t\treturn this.getSettingValue('containerId', '');\n\t}\n\n\tgetGridId(): string\n\t{\n\t\treturn this.getSettingValue('gridId', '');\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.getSettingValue('languageId', '');\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.getSettingValue('siteId', '');\n\t}\n\n\tgetCatalogId()\n\t{\n\t\treturn this.getSettingValue('catalogId', 0);\n\t}\n\n\tisReadOnly()\n\t{\n\t\treturn this.getSettingValue('readOnly', true);\n\t}\n\n\tsetReadOnly(readOnly)\n\t{\n\t\tthis.setSettingValue('readOnly', readOnly);\n\t}\n\n\tgetCurrencyId(): string\n\t{\n\t\treturn this.getSettingValue('currencyId', '');\n\t}\n\n\tsetCurrencyId(currencyId): Promise\n\t{\n\t\tthis.setSettingValue('currencyId', currencyId);\n\t\treturn CurrencyCore.loadCurrencyFormat(currencyId);\n\t}\n\n\tchangeCurrencyId(currencyId): void\n\t{\n\t\tconst oldCurrencyId = this.getCurrencyId();\n\t\tif (oldCurrencyId === currencyId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis\n\t\t\t.setCurrencyId(currencyId)\n\t\t\t.then(() => {\n\t\t\t\tconst products = [];\n\t\t\t\tthis.products.forEach((product) => {\n\t\t\t\t\tproduct.getModel().setOption('currency', currencyId);\n\t\t\t\t\tproducts.push({\n\t\t\t\t\t\tfields: product.getFields(),\n\t\t\t\t\t\tid: product.getId()\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tif (products.length > 0)\n\t\t\t\t{\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tthis.getComponentName(),\n\t\t\t\t\t\t'calculateProductPrices',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tproducts,\n\t\t\t\t\t\t\t\tcurrencyId,\n\t\t\t\t\t\t\t\toldCurrencyId,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t\t\t.then(this.onCalculatePricesResponse.bind(this));\n\t\t\t\t}\n\n\t\t\t\tconst editData = this.getGridEditData();\n\t\t\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\n\n\t\t\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\n\t\t\t\tconst templateFieldNames = ['BASE_PRICE', 'PURCHASING_PRICE'];\n\n\t\t\t\ttemplateFieldNames.forEach((field) => {\n\t\t\t\t\tif (templateRow[field] && templateRow[field]['CURRENCY'])\n\t\t\t\t\t{\n\t\t\t\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.setGridEditData(editData);\n\t\t\t});\n\t}\n\n\tonCalculatePricesResponse(response)\n\t{\n\t\tconst products = response.data;\n\t\tthis.products.forEach((product) => {\n\t\t\tif (Type.isObject(products[product.getId()]))\n\t\t\t{\n\t\t\t\tproduct.updateField('BASE_PRICE', products[product.getId()]['BASE_PRICE']);\n\t\t\t\tproduct.updateField('PURCHASING_PRICE', products[product.getId()]['PURCHASING_PRICE']);\n\t\t\t\tproduct.updateUiCurrencyFields();\n\t\t\t}\n\t\t});\n\n\t\tthis.updateTotalDataDelayed();\n\t\tthis.updateTotalUiCurrency();\n\t}\n\n\tupdateTotalUiCurrency()\n\t{\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(totalBlock))\n\t\t{\n\t\t\ttotalBlock.querySelectorAll('[data-role=\"currency-wrapper\"]').forEach((row) => {\n\t\t\t\trow.innerHTML = this.getCurrencyText();\n\t\t\t});\n\t\t}\n\t}\n\n\tgetCurrencyText(): string\n\t{\n\t\tconst currencyId = this.getCurrencyId();\n\t\tif (!Type.isStringFilled(currencyId))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || '';\n\t}\n\n\tgetDataFieldName()\n\t{\n\t\treturn this.getSettingValue('dataFieldName', '');\n\t}\n\n\tgetDataSettingsFieldName()\n\t{\n\t\tconst field = this.getDataFieldName();\n\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetMeasures(): []\n\t{\n\t\treturn this.getSettingValue('measures', []);\n\t}\n\n\tgetDefaultMeasure()\n\t{\n\t\treturn this.getSettingValue('defaultMeasure', {});\n\t}\n\n\tgetRowIdPrefix()\n\t{\n\t\treturn this.getSettingValue('rowIdPrefix', 'catalog_entity_product_list_');\n\t}\n\n\t/* settings tools finish */\n\n\t/* calculate tools */\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isNegative)\n\t\t\t\t{\n\t\t\t\t\tresult = -result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseInt(value, 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\n\t\t\tconst dot = value.indexOf('.');\n\t\t\tconst comma = value.indexOf(',');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\n\t\t\tif (dot < 0 && comma >= 0)\n\t\t\t{\n\t\t\t\tlet s1 = value.substr(0, comma);\n\t\t\t\tconst decimalLength = value.length - comma - 1;\n\n\t\t\t\tif (decimalLength > 0)\n\t\t\t\t{\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\n\t\t\t\t}\n\n\t\t\t\tvalue = s1;\n\t\t\t}\n\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\n\t\t\tresult = parseFloat(value);\n\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\tif (isNegative)\n\t\t\t{\n\t\t\t\tresult = -result;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseFloat(value);\n\t\t}\n\n\t\tif (precision >= 0)\n\t\t{\n\t\t\tresult = this.round(result, precision);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tround(value: number, precision: number = DEFAULT_PRECISION)\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\t/* calculate tools finish */\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.getElementById(this.getContainerId());\n\t\t});\n\t}\n\n\tinitForm()\n\t{\n\t\tconst formId = this.getSettingValue('formId', '');\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\n\n\t\tif (Type.isElementNode(form))\n\t\t{\n\t\t\tthis.setForm(form);\n\t\t}\n\t}\n\n\tisExistForm()\n\t{\n\t\treturn Type.isElementNode(this.getForm());\n\t}\n\n\tgetForm()\n\t{\n\t\treturn this.form;\n\t}\n\n\tsetForm(form)\n\t{\n\t\tthis.form = form;\n\t}\n\n\tinitFormFields()\n\t{\n\t\tconst container = this.getForm();\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tconst field = this.getDataField();\n\t\t\tif (!Type.isElementNode(field))\n\t\t\t{\n\t\t\t\tthis.initDataField();\n\t\t\t}\n\n\t\t\tconst settingsField = this.getDataSettingsField();\n\t\t\tif (!Type.isElementNode(settingsField))\n\t\t\t{\n\t\t\t\tthis.initDataSettingsField();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\tcontainer.appendChild(Dom.create(\n\t\t\t\t'input',\n\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\n\t\t\t));\n\t\t}\n\t}\n\n\tremoveFormFields()\n\t{\n\t\tconst field = this.getDataField();\n\t\tif (Type.isElementNode(field))\n\t\t{\n\t\t\tDom.remove(field);\n\t\t}\n\n\t\tconst settingsField = this.getDataSettingsField();\n\t\tif (Type.isElementNode(settingsField))\n\t\t{\n\t\t\tDom.remove(settingsField);\n\t\t}\n\t}\n\n\tinitDataField()\n\t{\n\t\tthis.initFormField(this.getDataFieldName());\n\t}\n\n\tinitDataSettingsField()\n\t{\n\t\tthis.initFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetDataField()\n\t{\n\t\treturn this.getFormField(this.getDataFieldName());\n\t}\n\n\tgetDataSettingsField()\n\t{\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetProductCount()\n\t{\n\t\treturn this.products\n\t\t\t.filter(item => !item.isEmptyRow())\n\t\t\t.length\n\t\t;\n\t}\n\n\tinitProducts()\n\t{\n\t\tconst list = this.getSettingValue('items', []);\n\n\t\tfor (let item of list)\n\t\t{\n\t\t\tconst fields = {...item.fields};\n\t\t\tthis.products.push(new Row(item.rowId, fields, this.getSettingValue('rowSettings', {}), this));\n\t\t}\n\n\t\tthis.numerateRows();\n\t\tthis.productsWasInitiated = true;\n\n\t\tthis.updateTotalDataDelayed();\n\t}\n\n\tnumerateRows()\n\t{\n\t\tthis.products.forEach((product, index) => {\n\t\t\tproduct.setRowNumber(index + 1);\n\t\t})\n\t}\n\n\tgetGrid(): ?BX.Main.Grid\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\tconst gridId = this.getGridId();\n\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\n\t\t\t}\n\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\n\t\t});\n\t}\n\n\tinitGridData()\n\t{\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\t}\n\n\tpaintColumns()\n\t{\n\t\tconst paintedColumns = this.getSettingValue('paintedColumns', null);\n\t\tconst grid = this.getGrid();\n\t\tif (grid && Type.isArray(paintedColumns))\n\t\t{\n\t\t\tpaintedColumns.forEach((columnName) => {\n\t\t\t\tconst rows = grid.getRows().getRows();\n\t\t\t\trows.forEach((current) => {\n\t\t\t\t\tconst cell = current.getCellById(columnName);\n\t\t\t\t\tif (cell)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(cell, 'main-grid-cell-light-blue-background');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\tgetColumnInfo(code: string)\n\t{\n\t\treturn this.getGrid()?.arParams?.COLUMNS_ALL[code] || {};\n\t}\n\n\tsetGridEditData(data: {})\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\thandleProductErrorsChange()\n\t{\n\t\tif (this.#childrenHasErrors())\n\t\t{\n\t\t\tthis.controller.disableSaveButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.controller.enableSaveButton();\n\t\t}\n\t}\n\n\t#childrenHasErrors()\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\n\t\t\t.length > 0\n\t\t\t;\n\t}\n\n\thandleFieldChange(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tif (row && row.hasAttribute('data-id'))\n\t\t{\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tlet fieldCode = event.target.getAttribute('data-name');\n\t\t\t\tif (!Type.isStringFilled(fieldCode))\n\t\t\t\t{\n\t\t\t\t\tconst cell = event.target.closest('td');\n\t\t\t\t\tfieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t\t\t}\n\n\t\t\t\tif (fieldCode)\n\t\t\t\t{\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleDropdownChange(event: BaseEvent)\n\t{\n\t\tconst [dropdownId, , , , value] = event.getData();\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\n\t\tconst matches = dropdownId.match(regExp);\n\t\tif (matches)\n\t\t{\n\t\t\tconst [, rowId, fieldCode] = matches;\n\t\t\tconst product = this.getProductById(rowId);\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tproduct.updateDropdownField(fieldCode, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProductById(id: string): ?Row\n\t{\n\t\tconst rowId = this.getRowIdPrefix() + id;\n\n\t\treturn this.getProductByRowId(rowId);\n\t}\n\n\tgetProductByRowId(rowId: string): ?Row\n\t{\n\t\treturn this.products.find((row: Row) => {\n\t\t\treturn row.getId() === rowId;\n\t\t});\n\t}\n\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\n\t{\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\n\t\t\tconst index = [...row.cells].indexOf(cell);\n\n\t\t\treturn headRow.getCellNameByCellIndex(index);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddProductRow(anchorProduct: Row = null): string\n\t{\n\t\tconst row = this.createGridProductRow();\n\t\tconst newId = row.getId();\n\n\t\tif (anchorProduct)\n\t\t{\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\n\t\t\tif (anchorRowNode)\n\t\t\t{\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\n\t\t\t}\n\t\t}\n\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\n\t\tthis.getGrid().bindOnRowEvents();\n\t\treturn newId;\n\t}\n\n\thandleProductRowAdd(): void\n\t{\n\t\tconst id = this.addProductRow();\n\t\tthis.focusProductSelector(id);\n\t}\n\n\thandleProductRowCreate(): void\n\t{\n\t}\n\n\thandleShowBarcodeSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\thandleShowSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\tdestroySettingsPopup()\n\t{\n\t\tif (this.cache.has('settings-popup'))\n\t\t{\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\n\t\t\tthis.cache.delete('settings-popup');\n\t\t}\n\t}\n\n\tgetSettingsPopup()\n\t{\n\t\treturn this.cache.remember('settings-popup', () => {\n\t\t\treturn new SettingsPopup(\n\t\t\t\tthis.getContainer().querySelector('.catalog-document-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\n\t\t\t\tthis.getSettingValue('popupSettings', []),\n\t\t\t\tthis\n\t\t\t);\n\t\t});\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.cache.remember('hint-popup', () => {\n\t\t\treturn new HintPopup(this);\n\t\t});\n\t}\n\n\tcreateGridProductRow(): BX.Grid.Row\n\t{\n\t\tconst newId = Text.getRandom();\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\n\n\t\tconst grid = this.getGrid();\n\t\tlet newRow;\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tnewRow = grid.appendRowEditor();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewRow = grid.prependRowEditor();\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tnewNode.setAttribute('data-id', newId);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\n\t\treturn newRow;\n\t}\n\n\thandleDeleteRow(rowId, event: BaseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tconst row = this.getProductByRowId(rowId);\n\t\tif (row)\n\t\t{\n\t\t\tthis.deleteRow(rowId);\n\t\t}\n\t}\n\n\tredefineTemplateEditData(newId: string)\n\t{\n\t\tconst data = this.getGridEditData();\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\n\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\n\n\t\treturn originalTemplateData;\n\t}\n\n\tprepareCustomEditData(originalEditData, newId)\n\t{\n\t\tconst customEditData = {};\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\n\t\t\t\t\t\tnewId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\n\t{\n\t\tlet fields = {};\n\t\tif (anchorProduct !== null)\n\t\t{\n\t\t\tfields = Object.assign(fields, anchorProduct?.getFields());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfields = {\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\n\t\t\t\t...{\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tconst rowId = this.getRowIdPrefix() + newId;\n\t\tfields.ID = newId;\n\t\tfields.ROW_ID = newId;\n\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t{\n\t\t\tdelete(fields.IMAGE_INFO.input);\n\t\t}\n\t\tconst product = new Row(\n\t\t\trowId,\n\t\t\tfields,\n\t\t\tthis.getSettingValue('rowSettings', {}),\n\t\t\tthis\n\t\t);\n\n\t\tif (anchorProduct instanceof Row)\n\t\t{\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\n\n\t\t\tproduct.refreshFieldsLayout();\n\t\t}\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tthis.products.push(product);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.products.unshift(product);\n\t\t}\n\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tproduct.updateUiCurrencyFields();\n\t\tthis.updateTotalUiCurrency();\n\n\t\treturn product;\n\t}\n\n\tgetProductSelector(newId: string): ?ProductSelector\n\t{\n\t\treturn this.getProductById(newId).getSelector();\n\t}\n\n\tfocusProductSelector(newId: string): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(newId)\n\t\t\t\t?.searchInDialog()\n\t\t\t\t.focusName()\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnBeforeProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst product = this.getProductByRowId(data.rowId);\n\t\tif (product)\n\t\t{\n\t\t\tthis.getGrid().tableFade();\n\t\t\tproduct.resetExternalActions();\n\t\t}\n\t}\n\n\thandleOnProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tconst productRow = this.getProductByRowId(data.rowId);\n\t\tif (productRow && data.fields)\n\t\t{\n\t\t\tdelete data.fields.ID;\n\t\t\tproductRow.setFields(data.fields);\n\t\t\tObject.keys(data.fields).forEach((key) => {\n\t\t\t\tproductRow.updateFieldValue(key, data.fields[key]);\n\t\t\t});\n\n\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\n\t\t\tproductRow.getSelector()?.layout();\n\t\t\tproductRow.getBarcodeSelector()?.layout();\n\t\t\tproductRow.updateProductStoreValues();\n\n\t\t\tproductRow.initHandlersForSelectors();\n\t\t\tproductRow.executeExternalActions();\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t}\n\n\thandleOnProductClear(event: BaseEvent)\n\t{\n\t\tconst {selectorId, rowId} = event.getData();\n\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tif (product && product.getSelector().getId() === selectorId)\n\t\t{\n\t\t\tproduct.initHandlersForSelectors();\n\t\t\tproduct.setMeasure(this.getDefaultMeasure());\n\t\t\tproduct.changePurchasingPrice(0);\n\t\t\tproduct.changeBasePrice(0);\n\t\t\tproduct.changeAmount(0);\n\t\t\tproduct.updateUiStoreValues();\n\t\t\tproduct.updateProductStoreValues();\n\t\t\tproduct.changeBarcode('');\n\t\t\tproduct\n\t\t\t\t.getBarcodeSelector()\n\t\t\t\t?.setConfig('ENABLE_SEARCH', true)\n\t\t\t\t.layout()\n\t\t\t;\n\t\t\tproduct.executeExternalActions();\n\t\t}\n\t}\n\n\tcompileProductData(): void\n\t{\n\t\tif (!this.isExistForm())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.initFormFields();\n\n\t\tconst field = this.getDataField();\n\t\tconst settingsField = this.getDataSettingsField();\n\n\t\tthis.cleanProductRows();\n\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\n\t\t{\n\t\t\tfield.value = this.prepareProductDataValue();\n\t\t}\n\t}\n\n\tprepareProductDataValue(): string\n\t{\n\t\tlet productDataValue = '';\n\n\t\tif (this.getProductCount())\n\t\t{\n\t\t\tconst productData = [];\n\n\t\t\tthis.products.forEach((item) => {\n\t\t\t\tconst itemFields = item.getFields();\n\n\t\t\t\tif (!/^[0-9]+$/.test(itemFields['ID']))\n\t\t\t\t{\n\t\t\t\t\titemFields['ID'] = 0;\n\t\t\t\t}\n\n\t\t\t\titemFields['CUSTOMIZED'] = 'Y';\n\n\t\t\t\tproductData.push(itemFields);\n\t\t\t});\n\n\t\t\tproductDataValue = JSON.stringify(productData);\n\t\t}\n\n\t\treturn productDataValue;\n\t}\n\n\t/* actions */\n\texecuteActions(actions)\n\t{\n\t\tif (!Type.isArrayFilled(actions))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let item of actions)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(item)\n\t\t\t\t|| !Type.isStringFilled(item.type)\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (item.type)\n\t\t\t{\n\t\t\t\tcase this.actions.productChange:\n\t\t\t\t\tthis.actionSendProductChange(item);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.productListChanged:\n\t\t\t\t\tthis.actionSendProductListChanged();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateTotal:\n\t\t\t\t\tthis.actionUpdateTotalData();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tactionSendProductChange(item)\n\t{\n\t\tif (!Type.isStringFilled(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.getProductByRowId(item.id);\n\t\tif (!product)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// EventEmitter.emit(this, 'ProductList::onChangeFields', {\n\t\t// \trowId: item.id,\n\t\t// \tproductId: product.getField('PRODUCT_ID'),\n\t\t// \tfields: this.getProductByRowId(item.id).getCatalogFields()\n\t\t// });\n\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange();\n\t\t}\n\t}\n\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t}\n\t}\n\n\tactionUpdateListField(item)\n\t{\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateFieldForList = item.field;\n\n\t\tfor (let row of this.products)\n\t\t{\n\t\t\trow.updateFieldByName(item.field, item.value);\n\t\t}\n\n\t\tthis.updateFieldForList = null;\n\t}\n\n\tactionUpdateTotalData(options = {})\n\t{\n\t\tthis.updateTotalDataDelayedHandler(options);\n\t}\n\n\t/* actions finish */\n\n\tupdateTotalDataDelayed(options = {})\n\t{\n\t\tlet totalCost = 0;\n\t\tconst field = this.getSettingValue('totalCalculationSumField', 'PURCHASING_PRICE');\n\t\tthis.products.forEach(item => totalCost += Text.toNumber(item.getField(field)) * Text.toNumber(item.getField('AMOUNT')));\n\t\tthis.setTotalData({totalCost});\n\t}\n\n\tgetProductsFields(fields: Array = [])\n\t{\n\t\tconst productFields = [];\n\n\t\tfor (let item of this.products)\n\t\t{\n\t\t\tproductFields.push(item.getFields(fields));\n\t\t}\n\n\t\treturn productFields;\n\t}\n\n\tsetTotalData(data)\n\t{\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\tconst currencyId = this.getCurrencyId();\n\t\t\tconst list = ['totalCost'];\n\n\t\t\tfor (const id of list)\n\t\t\t{\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\n\t\t\t\t{\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.controller?.setTotal(data);\n\t}\n\n\t/* action tools finish */\n\n\t/* ajax tools */\n\t// ajaxRequest(action, data)\n\t// {\n\t// \tif (!Type.isPlainObject(data.options))\n\t// \t{\n\t// \t\tdata.options = {};\n\t// \t}\n\t// \tdata.options.ACTION = action;\n\t// \tajax.runComponentAction(\n\t// \t\tthis.getComponentName(),\n\t// \t\taction,\n\t// \t\t{\n\t// \t\t\tmode: 'class',\n\t// \t\t\tsignedParameters: this.getSignedParameters(),\n\t// \t\t\tdata: data\n\t// \t\t}\n\t// \t).then(\n\t// \t\t(response) => this.ajaxResultSuccess(response, data.options),\n\t// \t\t(response) => this.ajaxResultFailure(response)\n\t// \t);\n\t// }\n\t//\n\t// ajaxResultSuccess(response, requestOptions)\n\t// {\n\t// \tif (!this.ajaxResultCommonCheck(response))\n\t// \t{\n\t// \t\treturn;\n\t// \t}\n\t//\n\t// \tswitch (response.data.action)\n\t// \t{\n\t// \t\tcase 'calculateTotalData':\n\t// \t\t\t// if (Type.isPlainObject(response.data.result))\n\t// \t\t\t// {\n\t// \t\t\t// \tthis.setTotalData(response.data.result, requestOptions);\n\t// \t\t\t// }\n\t//\n\t// \t\t\tbreak;\n\t// \t\tcase 'calculateProductPrices':\n\t// \t\t\tif (Type.isPlainObject(response.data.result))\n\t// \t\t\t{\n\t// \t\t\t\tthis.onCalculatePricesResponse(response.data.result);\n\t// \t\t\t}\n\t//\n\t// \t\t\tbreak;\n\t// \t}\n\t// }\n\n\t// ajaxResultFailure(response)\n\t// {\n\t//\n\t// }\n\n\tajaxResultCommonCheck(responce)\n\t{\n\t\tif (!Type.isPlainObject(responce))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (responce.status !== 'success')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.data.action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection RedundantIfStatementJS\n\t\tif (!('result' in responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tdeleteRow(row: Row): void\n\t{\n\t\tconst gridRow = this.getGrid().getRows().getById(row.getField('ID'));\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t}\n\n\t\tconst index = this.products.indexOf(row);\n\t\tif (index > -1)\n\t\t{\n\t\t\tthis.products.splice(index, 1);\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.addFirstRowIfEmpty();\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcopyRow(row: Row): void\n\t{\n\t\tthis.addProductRow(row)\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcleanProductRows(): void\n\t{\n\t\tthis.products\n\t\t\t.filter(item => item.isEmptyRow())\n\t\t\t.forEach((row) => this.deleteRow(row))\n\t\t;\n\t}\n\n\tresortProductsByIds(ids: Array): boolean\n\t{\n\t\tlet changed = false;\n\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tthis.products.sort((a, b) => {\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tchanged = true;\n\n\t\t\t\treturn -1;\n\t\t\t});\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\trefreshSortFields(): void\n\t{\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10, false));\n\t}\n\n\thandleOnTabShow(): void\n\t{\n\t\tEventEmitter.emit('onDemandRecalculateWrapper');\n\t}\n\n\tcloseBarcodeSpotlights(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.removeSpotlight();\n\t\t})\n\n\t\tthis.setSettingValue('showBarcodeSpotlightInfo',false);\n\t}\n\n\tcloseBarcodeQrAuths(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.removeQrAuth();\n\t\t})\n\n\t\tthis.setSettingValue('showBarcodeQrAuth',false);\n\t}\n\n\tvalidate(): Array\n\t{\n\t\tif (this.getProductCount() === 0)\n\t\t{\n\t\t\treturn [Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_IS_EMPTY')];\n\t\t}\n\n\t\tlet errorsArray = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\terrorsArray = errorsArray.concat(product.validate());\n\t\t});\n\n\t\treturn errorsArray;\n\t}\n}\n"],"names":["HintPopup","editor","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","setBindElement","adjustPosition","setContent","Tag","render","Text","encode","show","close","PriceCalculator","fields","basePrice","finalPrice","extra","extraType","EXTRA_TYPE_PERCENTAGE","toNumber","EXTRA_TYPE_MONETARY","Type","isNil","calculateBasePrice","calculateFinalPrice","MODE_EDIT","MODE_SET","PRODUCT_TYPE_SET","Row","id","settings","Cache","MemoryCache","EDIT","SET","Map","setId","setSettings","setEditor","setModel","initFields","getSettingValue","requestAnimationFrame","initHandlers","bind","cache","remember","rowId","getField","getEditorContainer","querySelector","mainSelector","barcodeSelector","isPlainObject","name","defaultValue","hasOwnProperty","value","getEditor","getContainer","getHintPopup","getNode","querySelectorAll","forEach","Event","changeProductFieldHandler","event","stopPropagation","selectorNames","storeFields","Object","keys","number","textContent","result","isArrayFilled","Runtime","clone","fieldName","getModel","setFields","setField","changeModel","field","fieldCode","target","type","checked","mode","updateField","resetExternalActions","updateFieldValue","executeExternalActions","code","changeProductId","changeBasePrice","changePurchasingPrice","changeAmount","changeMeasureCode","changeBarcode","changeStore","changeStoreName","changeProductName","changeSort","setTaxIncluded","preparedValue","parseInt","setProductId","menuItem","copyRow","menu","getMenuWindow","destroy","deleteRow","unsubscribeEvents","getBarcodeSelector","changeExtraType","getCurrencyText","calculator","calculateExtraType","changeExtra","getExtra","getFinalPrice","isDomNode","innerHTML","parseFloat","getPricePrecision","calculateExtra","setBasePrice","setPurchasingPrice","getQuantityPrecision","setAmount","getMeasures","filter","item","CODE","setMeasure","toString","isChangedValue","addActionProductChange","setStoreAmount","exceptFields","includes","updateUiField","updateUiMeasure","getSelector","reloadFileInput","layout","updateUiStoreValues","selectorId","model","ProductModel","getById","currency","getCurrencyId","iblockId","basePriceId","skuTree","isStringFilled","JSON","parse","storeMap","isObject","getImageCollection","setPreview","setEditInput","setMorePhotoValues","setDetailPath","EventEmitter","subscribe","debounce","addActionUpdateTotal","Math","max","toFixed","storeSelectors","selector","getSkuId","storeHeaderMap","key","currentAmount","getStoreCollection","getStoreAmount","maxStore","getMaxFilledStore","storeSelector","StoreSelector","AMOUNT","onStoreSelect","STORE_ID","STORE_TITLE","amount","amounts","getStoreReserved","getStoreAvailableAmount","postfix","call","wrapper","updateUiInputField","measure","isEmpty","SYMBOL","showSaveNotifier","title","Loc","getMessage","declineCancelTitle","events","onSave","save","onCancel","fieldId","getUiFieldId","document","getElementById","isElementNode","inputBlock","getInputByFieldName","parentNode","undefined","Reflection","getClass","BX","Main","dropdownManager","dropdown","getValue","itemsContainer","getMenuItem","refresh","selectItem","dataset","span","updateUiMoneyField","html","currencyText","currencyId","currencyFieldNames","dropdownValues","push","NAME","VALUE","Dom","attr","uiName","getUiFieldName","uiType","getUiFieldType","util","number_format","CurrencyCore","currencyFormat","updateUiHtmlField","column","getColumnInfo","editable","TYPE","precision","getCommonPrecision","externalActions","length","action","addExternalAction","actions","productChange","updateTotal","executeActions","trim","getBasePrice","errorsList","getAmount","isReadOnly","actionCellContentContainer","actionsButton","menuItems","onclick","handleCopyAction","handleDeleteAction","PopupMenu","bindElement","items","preventDefault","append","selectorOptions","getIblockId","getBasePriceId","getCurrency","config","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","ENABLE_EMPTY_PRODUCT_ERROR","RESTRICTED_PRODUCT_TYPES","ProductSelector","mainInfoNode","numberSelector","appendChild","selectorWrapper","renderTo","inputFieldName","INPUT_FIELD_BARCODE","ENABLE_INFO_SPOTLIGHT","ENABLE_BARCODE_QR_AUTH","ENABLE_SKU_TREE","scannerToken","barcodeWrapper","fieldNames","rowName","inputFieldId","inputFieldTitle","storeWrapper","data","getData","isNumber","errors","getErrorCollection","getErrors","ErrorCodes","NOT_SELECTED_PRODUCT","layoutErrors","handleProductErrorsChange","getNameInputFilledValue","closeBarcodeSpotlights","closeBarcodeQrAuths","validatorCallback","fieldInput","fieldWrapper","getInputWrapperByFieldName","valueAsNumber","validatingFields","get","set","classList","add","validator","eventObject","Boolean","unbind","remove","amountValue","PageEventsManager","_settings","eventHandlers","eventName","eventHandler","addCustomEvent","eventParams","onCustomEvent","i","removeCustomEvent","SettingsPopup","getPopup","random","autoHide","draggable","offsetLeft","offsetTop","angle","position","offset","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","content","popupContainer","getContentContainer","isArray","columns","allColumnsExist","columnName","getGrid","getColumnHeaderCellByName","checkbox","input","settingId","descriptionNode","desc","setting","_classPrivateMethodGet","settingItem","settingEnabled","enabled","headers","cells","getRows","getHeadFirstChild","getCells","Array","from","header","ajax","runComponentAction","getComponentName","signedParameters","getSignedParameters","selected","currentHeaders","then","panel","setSettingValue","activePanel","changeActivePanelButtons","settingButton","reloadGrid","message","replace","category","options","UI","Notification","Center","notify","stack","width","autoHideDelay","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","Editor","productListChanged","updateListField","handleProductRowAdd","handleProductRowCreate","handleShowBarcodeSettingsPopup","handleShowSettingsPopup","handleOnSave","handleEditorSubmit","handleOnBeforeGridRequest","handleOnGridUpdated","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnProductClear","handleDropdownChange","handleMobileScanEvent","handleFieldChange","updateTotalDataDelayed","getRandom","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","paintColumns","emit","subscribeDomEvents","subscribeCustomEvents","container","addButton","productRowAddHandler","productRowCreateHandler","configButton","showSettingsPopupHandler","showBarcodeSettingsPopupHandler","selectButton","productSelectionPopupHandler","createButton","onSaveHandler","onEditorSubmit","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onProductClearHandler","dropdownChangeHandler","onScanEmitHandler","unsubscribe","params","barcode","products","product","searchInput","getNameInput","activeElement","applyScannerData","newRowId","addProductRow","getProductById","productId","getProductSelector","onProductSelect","notification","getLastActiveSaveNotification","panelCode","removeClass","addClass","hiddenPanelCode","removePanel","useProductsFromRequest","isInternalChanging","reloadTable","actionUpdateTotalData","getCompatData","grid","eventArgs","parent","getGridId","isNativeAction","url","getReloadUrl","method","sessid","bitrix_sessid","getProductsFields","isDeletingRequest","gridId","clearEditor","subscribeOnce","getSettingsPopup","updateCheckboxState","ids","changed","resortProductsByIds","refreshSortFields","numerateRows","componentId","pageEventsManager","initPageEventsManager","rows","current","isHeadChild","isTemplate","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","unsubscribeDomEvents","unsubscribeCustomEvents","unbindAll","productSelector","setForm","clearController","controller","clearProductList","readOnly","loadCurrencyFormat","oldCurrencyId","setCurrencyId","setOption","getFields","onCalculatePricesResponse","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","response","updateUiCurrencyFields","updateTotalUiCurrency","totalBlock","row","format","getCurrencyFormat","FORMAT_STRING","getDataFieldName","isNumberValue","isStringValue","isNegative","indexOf","isNaN","dot","comma","s1","substr","decimalLength","round","factor","pow","getContainerId","formId","form","getForm","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","create","attrs","initFormField","getDataSettingsFieldName","getFormField","isEmptyRow","list","index","setRowNumber","Error","gridManager","getInstanceById","gridEditData","paintedColumns","cell","getCellById","arParams","EDITABLE_DATA","COLUMNS_ALL","disableSaveButton","enableSaveButton","closest","hasAttribute","getAttribute","getFieldCodeByGridCell","updateFieldByEvent","dropdownId","regExp","RegExp","getRowIdPrefix","matches","match","updateDropdownField","getProductByRowId","find","headRow","getCellNameByCellIndex","anchorProduct","createGridProductRow","newId","anchorRowNode","insertBefore","nextSibling","initializeNewProductRow","bindOnRowEvents","focusProductSelector","has","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","setAttribute","makeCountable","setOriginalTemplateEditData","adjustRows","updateCounterDisplayed","updateCounterSelected","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","assign","CURRENCY","ID","IMAGE_INFO","splice","refreshFieldsLayout","unshift","searchInDialog","focusName","tableFade","productRow","isNew","updateProductStoreValues","initHandlersForSelectors","tableUnfade","getDefaultMeasure","setConfig","isExistForm","initFormFields","cleanProductRows","prepareProductDataValue","productDataValue","getProductCount","productData","itemFields","test","stringify","actionSendProductChange","actionSendProductListChanged","updateFieldForList","updateFieldByName","updateTotalDataDelayedHandler","totalCost","setTotalData","productFields","setTotal","responce","status","gridRow","reset","sort","a","b","removeSpotlight","removeQrAuth","errorsArray","concat","validate","_clickOnRowActionsButton","hasErrors"],"mappings":"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"}