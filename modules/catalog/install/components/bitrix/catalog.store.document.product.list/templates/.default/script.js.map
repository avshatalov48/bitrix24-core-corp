{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/price.calculator.js","src/js/access.denied.input.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/field.hint.manager.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}","import {Type, Text} from \"main.core\";\n\ntype PriceCalculatorFields = {\n\tbasePrice: number,\n\tfinalPrice: number,\n\textra: number | null,\n\textraType: PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n}\n\nexport class PriceCalculator\n{\n\tstatic EXTRA_TYPE_PERCENTAGE = 1;\n\tstatic EXTRA_TYPE_MONETARY = 2;\n\n\t#fields: PriceCalculatorFields = {\n\t\tbasePrice: 0,\n\t\tfinalPrice: 0,\n\t\textra: null,\n\t\textraType: PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n\t};\n\n\n\tconstructor(fields: PriceCalculatorFields): void\n\t{\n\t\tthis.#fields = {...this.#fields, ...fields};\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.#fields.basePrice;\n\t}\n\n\tgetFinalPrice(): number\n\t{\n\t\treturn this.#fields.finalPrice;\n\t}\n\n\tgetExtra(): number | null\n\t{\n\t\treturn this.#fields.extra;\n\t}\n\n\tgetExtraType(): PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE\n\t{\n\t\treturn this.#fields.extraType;\n\t}\n\n\tcalculateBasePrice(basePrice: number): PriceCalculator\n\t{\n\t\tthis.#fields.basePrice = basePrice;\n\t\tthis.#fields.extra = Text.toNumber(this.#fields.extra);\n\n\t\tif (this.#fields.extraType === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\tthis.#fields.finalPrice = this.#fields.basePrice + this.#fields.extra;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#fields.finalPrice = this.#fields.basePrice * (1 + this.#fields.extra / 100);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcalculateFinalPrice(finalPrice: number): PriceCalculator\n\t{\n\t\tthis.#fields.finalPrice = finalPrice;\n\t\tconst basePrice = Text.toNumber(this.#fields.basePrice);\n\n\t\tif (basePrice <= 0)\n\t\t{\n\t\t\tthis.#fields.extraType = PriceCalculator.EXTRA_TYPE_MONETARY;\n\t\t}\n\n\t\tif (this.#fields.extraType === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\tthis.#fields.extra = this.#fields.finalPrice - basePrice;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#fields.extra = (this.#fields.finalPrice / basePrice - 1) * 100;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcalculateExtra(extra: number): PriceCalculator\n\t{\n\t\tthis.#fields.extra = extra;\n\t\tif (Type.isNil(extra))\n\t\t{\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.calculateBasePrice(this.#fields.basePrice);\n\t}\n\n\tcalculateExtraType(extraType: PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE): PriceCalculator\n\t{\n\t\tif (extraType !== PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\textraType = PriceCalculator.EXTRA_TYPE_PERCENTAGE;\n\t\t}\n\n\t\tthis.#fields.extraType = extraType;\n\n\t\treturn this.calculateFinalPrice(this.#fields.finalPrice);\n\t}\n}","import {Tag, Loc} from 'main.core';\n\nexport class AccessDeniedInput\n{\n\thint: string;\n\ttext: string;\n\tisReadOnly: boolean;\n\n\tconstructor(options)\n\t{\n\t\tthis.text = options.text || Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_TEXT');\n\t\tthis.hint = options.hint;\n\t\tthis.isReadOnly = options.isReadOnly === true;\n\t}\n\n\trenderTo(node: Element): void\n\t{\n\t\tconst className =\n\t\t\tthis.isReadOnly\n\t\t\t\t? 'ui-ctl-no-border catalog-document-product-list-access-denied-readonly'\n\t\t\t\t: 'ui-ctl-disabled catalog-document-product-list-access-denied'\n\t\t;\n\t\tconst block = Tag.render`\n\t\t<div\n\t\t\tclass=\"ui-ctl ui-ctl-w100 ui-ctl-before-icon ui-ctl-after-icon ${className}\"\n\t\t\tdata-hint=\"${this.hint}\"\n\t\t\tdata-hint-no-icon\n\t\t>\n\t\t\t<div class=\"ui-ctl-before catalog-document-product-list-access-denied-lock\"></div>\n\t\t\t<div class=\"ui-ctl-after catalog-document-product-list-access-denied-hint\"></div>\n\t\t\t<div class=\"ui-ctl-element\">${this.text}</div>\n\t\t</div>\n\t\t`;\n\n\t\tnode.innerHTML = '';\n\t\tnode.appendChild(block);\n\n\t\tBX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\tangle: {\n\t\t\t\t\toffset: 100,\n\t\t\t\t},\n\t\t\t},\n\t\t}).init();\n\t}\n}\n","import {Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {Editor} from './product.list.editor';\nimport {CurrencyCore} from 'currency.currency-core';\nimport 'ui.hint';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\nimport {ProductSelector} from \"catalog.product-selector\";\nimport {StoreSelector} from \"catalog.store-selector\";\nimport {PopupMenu} from \"main.popup\";\nimport {PriceCalculator} from \"./price.calculator\";\nimport {AccessDeniedInput} from './access.denied.input';\n\ntype Action = {\n\ttype: string,\n\tfield?: string,\n\tvalue?: string,\n};\n\ntype Settings = {}\n\nconst MODE_EDIT = 'EDIT';\nconst MODE_SET = 'SET';\n\nexport class Row\n{\n\tid: ?string;\n\tsettings: Object;\n\teditor: ?Editor\n\tmodel: ?ProductModel\n\tfields: Object = {};\n\tmainSelector: ?ProductSelector;\n\tbarcodeSelector: ?ProductSelector;\n\tstoreSelectors: Array<StoreSelector> = [];\n\texternalActions: Array<Action> = [];\n\tcache = new Cache.MemoryCache();\n\tmodeChanges = {\n\t\tEDIT: MODE_EDIT,\n\t\tSET: MODE_SET,\n\t};\n\tvalidatingFields: Map<string, boolean> = new Map();\n\trealValues: ?Array;\n\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\n\t{\n\t\tthis.setId(id);\n\t\tthis.setSettings(settings);\n\t\tthis.setEditor(editor);\n\t\tthis.setModel(fields, settings);\n\t\tthis.initFields(fields);\n\t\tthis.#initSelector();\n\t\tthis.#initBarcode();\n\t\t// this.#initPriceExtra();\n\t\tthis.#initStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t\tthis.#initActions();\n\t\tthis.#hideFields();\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('node', () => {\n\t\t\tconst rowId = this.getField('ID', 0);\n\n\t\t\treturn this.getEditorContainer().querySelector('[data-id=\"' + rowId + '\"]');\n\t\t});\n\t}\n\n\tgetSelector(): ?ProductSelector\n\t{\n\t\treturn this.mainSelector;\n\t}\n\n\tgetBarcodeSelector(): ?ProductSelector\n\t{\n\t\treturn this.barcodeSelector;\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id: string): void\n\t{\n\t\tthis.id = id;\n\t}\n\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings: Settings): void\n\t{\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\n\t}\n\n\tgetSettingValue(name, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value): void\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tsetEditor(editor: Editor): void\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tgetEditor(): Editor\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorContainer(): HTMLElement\n\t{\n\t\treturn this.getEditor().getContainer();\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.getEditor().getHintPopup();\n\t}\n\n\tinitHandlers()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for text fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for select fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t}\n\n\tinitHandlersForSelectors()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tlet selectorNames = ['MAIN_INFO', 'BARCODE_INFO'];\n\t\tconst storeFields = this.getSettingValue('storeHeaderMap', {});\n\t\tselectorNames = [...selectorNames, ...Object.keys(storeFields)];\n\n\t\tselectorNames.forEach((name) => {\n\t\t\tthis.getNode().querySelectorAll('[data-name=\"'+ name +'\"] input[type=\"text\"]').forEach(node => {\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t\t// disable drag-n-drop events for select fields\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\t});\n\t\t});\n\t}\n\n\t#initActions()\n\t{\n\t\tif (this.getEditor().isReadOnly() || this.getField('EDITABLE') === false)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tif (Type.isDomNode(actionCellContentContainer))\n\t\t{\n\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"#\"\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\n\t\t\t\t></a>\n\t\t\t`;\n\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\n\t\t\t\tconst menuItems = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_COPY_ACTION'),\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_DELETE_ACTION'),\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tPopupMenu.show({\n\t\t\t\t\tid: this.getId() + '_actions_popup',\n\t\t\t\t\tbindElement: actionsButton,\n\t\t\t\t\titems: menuItems\n\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\t#initSelector()\n\t{\n\t\tconst selectorOptions = {\n\t\t\tiblockId: this.model.getIblockId(),\n\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\tcurrency: this.model.getCurrency(),\n\t\t\tmodel: this.model,\n\t\t\tconfig: {\n\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: this.getSettingValue('isAllowedCreationProduct', true),\n\t\t\t\tENABLE_IMAGE_INPUT: true,\n\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\n\t\t\t\tROW_ID: this.getId(),\n\t\t\t\tENABLE_SKU_SELECTION: true,\n\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: true,\n\t\t\t\tRESTRICTED_PRODUCT_TYPES: this.getEditor().getRestrictedProductTypes(),\n\t\t\t\tURL_BUILDER_CONTEXT: this.editor.getSettingValue('productUrlBuilderContext'),\n\t\t\t},\n\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t};\n\n\t\tthis.mainSelector = new ProductSelector('catalog_document_grid_' + this.getId(), selectorOptions);\n\t\tconst mainInfoNode = this.getNode().querySelector('[data-name=\"MAIN_INFO\"]');\n\t\tif (mainInfoNode)\n\t\t{\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\n\t\t\tif (!Type.isDomNode(numberSelector))\n\t\t\t{\n\t\t\t\tmainInfoNode.appendChild(Tag.render`<div class=\"main-grid-row-number\"></div>`);\n\t\t\t}\n\n\t\t\tlet selectorWrapper =  mainInfoNode.querySelector('.main-grid-row-product-selector');\n\t\t\tif (!Type.isDomNode(selectorWrapper))\n\t\t\t{\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`\n\t\t\t\tmainInfoNode.appendChild(selectorWrapper)\n\t\t\t}\n\t\t\tthis.mainSelector.renderTo(selectorWrapper);\n\t\t}\n\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.mainSelector,\n\t\t\t'onBeforeCreate',\n\t\t\tthis.#handleBeforeCreateProduct.bind(this)\n\t\t);\n\t}\n\n\t#initBarcode()\n\t{\n\t\tconst selectorOptions = {\n\t\t\tiblockId: this.model.getIblockId(),\n\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\tcurrency: this.model.getCurrency(),\n\t\t\tmodel: this.model,\n\t\t\tinputFieldName: 'BARCODE',\n\t\t\ttype: ProductSelector.INPUT_FIELD_BARCODE,\n\t\t\tconfig: {\n\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: this.getSettingValue('isAllowedCreationProduct', true),\n\t\t\t\tENABLE_INFO_SPOTLIGHT: this.editor.getSettingValue('showBarcodeSpotlightInfo', true),\n\t\t\t\tENABLE_BARCODE_QR_AUTH: this.editor.getSettingValue('showBarcodeQrAuth', true),\n\t\t\t\tIS_INSTALLED_MOBILE_APP: this.editor.getSettingValue('isInstalledMobileApp', null),\n\t\t\t\tENABLE_IMAGE_INPUT: false,\n\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\tROW_ID: this.getId(),\n\t\t\t\tENABLE_SKU_SELECTION: false,\n\t\t\t\tENABLE_SKU_TREE: false,\n\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: false,\n\t\t\t\tRESTRICTED_PRODUCT_TYPES: this.getEditor().getRestrictedProductTypes(),\n\t\t\t},\n\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t\tscannerToken: this.getEditor().scannerToken,\n\t\t};\n\n\t\tthis.barcodeSelector = new ProductSelector('catalog_document_grid_' + this.getId() + '_barcode', selectorOptions);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBeforeCreate',\n\t\t\tthis.#handleBeforeCreateProduct.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onSpotlightClose',\n\t\t\tthis.#handleSpotlightClose.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeQrClose',\n\t\t\tthis.#handleBarcodeQrClose.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeScannerInstallChecked',\n\t\t\tthis.#handleBarcodeScannerInstallCheck.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeChange',\n\t\t\tthis.#handleBarcodeChange.bind(this)\n\t\t);\n\n\t\tthis.layoutBarcode();\n\t}\n\n\tlayoutBarcode(): void\n\t{\n\t\tconst barcodeWrapper = this.getNode().querySelector('[data-name=\"BARCODE_INFO\"]');\n\t\tif (this.barcodeSelector && barcodeWrapper)\n\t\t{\n\t\t\tbarcodeWrapper.innerHTML = '';\n\n\t\t\tif (this.#needBarcode())\n\t\t\t{\n\t\t\t\tthis.barcodeSelector.renderTo(barcodeWrapper);\n\t\t\t}\n\t\t}\n\t}\n\n\t#initPriceExtra()\n\t{\n\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE\"]');\n\t\tif (!Type.isDomNode(node))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldExtraNode = node.querySelector('.catalog-store-extra-price');\n\t\tif (Type.isDomNode(oldExtraNode))\n\t\t{\n\t\t\toldExtraNode.parentNode.removeChild(oldExtraNode);\n\t\t}\n\n\t\tconst extraValue = this.getField('BASE_PRICE_EXTRA') ?? '';\n\t\tconst inputValue = Tag.render`\n\t\t\t<div>\n\t\t\t\t<input\n\t\t\t\t\tplaceholder=\"-\"\n\t\t\t\t\tclass=\"catalog-store-extra-price\"\n\t\t\t\t\tdata-name=\"BASE_PRICE_EXTRA\"\n\t\t\t\t\tvalue=\"${extraValue}\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst extraMeasureValue =\n\t\t\tthis.getField('BASE_PRICE_EXTRA_RATE') === PriceCalculator.EXTRA_TYPE_MONETARY\n\t\t\t\t? this.getEditor().getCurrencyText()\n\t\t\t\t: '%'\n\t\t;\n\n\t\tconst measureValue = Tag.render`\n\t\t\t<div class=\"main-grid-editor main-grid-editor-money-currency\">\n\t\t\t\t<span class=\"main-dropdown-inner\" data-name=\"BASE_PRICE_EXTRA_RATE\">${extraMeasureValue}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(measureValue, 'click', () => {\n\t\t\tconst menuItems = [\n\t\t\t\t{\n\t\t\t\t\ttext: '%',\n\t\t\t\t\tonclick: this.handleSelectExtraPriceType.bind(this),\n\t\t\t\t\ttype: PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: this.getEditor().getCurrencyText(),\n\t\t\t\t\tonclick: this.handleSelectExtraPriceType.bind(this),\n\t\t\t\t\ttype: PriceCalculator.EXTRA_TYPE_MONETARY,\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tPopupMenu.show({\n\t\t\t\tid: this.getId() + '_extra_type_popup',\n\t\t\t\tbindElement: measureValue,\n\t\t\t\titems: menuItems\n\t\t\t});\n\t\t});\n\n\t\tconst extraNode = Tag.render`\n\t\t\t<div class=\"main-grid-editor catalog-store-extra-price\">\n\t\t\t\t${inputValue}\n\t\t\t\t${measureValue}\n\t\t\t</div>\n\t\t`;\n\n\t\tnode.appendChild(extraNode);\n\t}\n\n\t#initStoreSelector(fieldNames: {})\n\t{\n\t\tObject.keys(fieldNames).forEach( rowName => {\n\t\t\tconst selectorOptions = {\n\t\t\t\tinputFieldId: fieldNames[rowName],\n\t\t\t\tinputFieldTitle: fieldNames[rowName] + '_TITLE',\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t},\n\t\t\t\tmode: StoreSelector.MODE_EDIT,\n\t\t\t\tmodel: this.model,\n\t\t\t};\n\n\t\t\tconst storeSelector = new StoreSelector(this.getId() + '_' + rowName, selectorOptions);\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tstoreSelector,\n\t\t\t\t'onChange',\n\t\t\t\tRuntime.debounce(this.#onStoreFieldChange.bind(this), 500, this)\n\t\t\t);\n\n\t\t\tthis.storeSelectors.push(storeSelector);\n\t\t});\n\n\t\tthis.layoutStoreSelector(fieldNames);\n\t}\n\n\tlayoutStoreSelector(fieldNames: {})\n\t{\n\t\tObject.keys(fieldNames).forEach(rowName => {\n\t\t\tconst selectorId = this.getId() + '_' + rowName;\n\n\t\t\tthis.storeSelectors.forEach((selector) => {\n\t\t\t\tif (selector.getId() === selectorId)\n\t\t\t\t{\n\t\t\t\t\tconst storeWrapper = this.getNode().querySelector('[data-name=\"' + rowName + '\"]');\n\t\t\t\t\tif (storeWrapper)\n\t\t\t\t\t{\n\t\t\t\t\t\tstoreWrapper.innerHTML = '';\n\n\t\t\t\t\t\tif (this.#needInventory())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tselector.renderTo(storeWrapper);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t#onStoreFieldChange(event)\n\t{\n\t\tconst data = event.getData();\n\t\tdata.fields.forEach((item) => {\n\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t});\n\t}\n\n\tsetRowNumber(number)\n\t{\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach(node => {\n\t\t\tnode.textContent = number + '.';\n\t\t});\n\t}\n\n\tgetFields(fields: Array = [])\n\t{\n\t\tlet result;\n\n\t\tif (!Type.isArrayFilled(fields))\n\t\t{\n\t\t\tresult = Runtime.clone(this.fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\n\t\t\tfor (let fieldName of fields)\n\t\t\t{\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\n\t\t\t}\n\t\t}\n\n\t\t// merge with real values\n\t\tconst realValues = this.#getRealValues();\n\t\tfor (const fieldName in realValues)\n\t\t{\n\t\t\tif (\n\t\t\t\tObject.hasOwnProperty.call(realValues, fieldName)\n\t\t\t\t&& Object.hasOwnProperty.call(result, fieldName)\n\t\t\t)\n\t\t\t{\n\t\t\t\tresult[fieldName] = realValues[fieldName];\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Get real values field.\n\t *\n\t * Stores the real values of rows that are hidden due to lack of user access.\n\t *\n\t * @returns\n\t */\n\t#getRealValues()\n\t{\n\t\tif (!!this.realValues)\n\t\t{\n\t\t\treturn this.realValues\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst value = this.getField('REAL_VALUES');\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\tconst parsedValue = JSON.parse(atob(value));\n\t\t\t\tif (Type.isPlainObject(parsedValue))\n\t\t\t\t{\n\t\t\t\t\tthis.realValues = parsedValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error('Cannot parse REAL_VALUE: ' + e.getMessage());\n\t\t}\n\n\t\treturn this.realValues;\n\t}\n\n\tinitFields(fields: Object): void\n\t{\n\t\tthis.getModel().initFields(fields, false);\n\t\tthis.setFields(fields);\n\t}\n\n\tsetFields(fields: Object): void\n\t{\n\t\tfor (let name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\tif (name !== 'REAL_VALUES')\n\t\t{\n\t\t\tconst realValues = this.#getRealValues();\n\t\t\tif (realValues && Object.hasOwnProperty.call(realValues, name))\n\t\t\t{\n\t\t\t\treturn realValues[name];\n\t\t\t}\n\t\t}\n\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value, changeModel: boolean = true): void\n\t{\n\t\tthis.fields[name] = value;\n\n\t\tif (changeModel)\n\t\t{\n\t\t\tthis.getModel().setField(name, value);\n\t\t}\n\t}\n\n\tgetUiFieldId(field): string\n\t{\n\t\treturn this.getId() + '_' + field;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tgetAmount(): number\n\t{\n\t\treturn this.getField('AMOUNT', 1);\n\t}\n\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\n\t{\n\t\tconst target = event.target;\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\tconst mode = (event.type === 'input' || event.type === 'change') ? MODE_EDIT : MODE_SET;\n\n\t\tthis.updateField(fieldCode, value, mode);\n\t}\n\n\tupdateDropdownField(fieldCode: string, value: any): void\n\t{\n\t\tthis.updateField(fieldCode, value, MODE_EDIT);\n\t}\n\n\tupdateField(fieldCode: string, value: any, mode = MODE_SET): void\n\t{\n\t\tthis.resetExternalActions();\n\t\tthis.updateFieldValue(fieldCode, value, mode);\n\t\tthis.executeExternalActions();\n\t}\n\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'SKU_ID':\n\t\t\t\tthis.changeProductId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tthis.changeBasePrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\t// case 'BASE_PRICE_EXTRA':\n\t\t\t// \tthis.changeExtra(value, mode);\n\t\t\t// \tbreak;\n\n\t\t\tcase 'PURCHASING_PRICE':\n\t\t\t\tthis.changePurchasingPrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'AMOUNT':\n\t\t\t\tthis.changeAmount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'MEASURE_CODE':\n\t\t\t\tthis.changeMeasureCode(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'BARCODE':\n\t\t\t\tthis.changeBarcode(value, mode);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_FROM':\n\t\t\tcase 'STORE_TO':\n\t\t\t\tthis.changeStore(value, code);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_FROM_TITLE':\n\t\t\tcase 'STORE_TO_TITLE':\n\t\t\t\tthis.changeStoreName(value, code);\n\t\t\t\tbreak;\n\t\t\tcase 'NAME':\n\t\t\tcase 'MAIN_INFO':\n\t\t\t\tthis.changeProductName(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SORT':\n\t\t\t\tthis.changeSort(value, mode);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateFieldByName(field, value)\n\t{\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.setTaxIncluded(value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tchangeProductId(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tthis.setProductId(preparedValue);\n\t}\n\n\thandleCopyAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.copyRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\thandleDeleteAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.deleteRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t\tthis.unsubscribeEvents();\n\n\t\tthis.#handleProductErrorsChange();\n\t}\n\n\tunsubscribeEvents()\n\t{\n\t\tthis.getBarcodeSelector().unsubscribeEvents();\n\t}\n\n\thandleSelectExtraPriceType(event, menuItem)\n\t{\n\t\tthis.changeExtraType(menuItem.type, MODE_EDIT);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\t#getCalculator()\n\t{\n\t\tconst extra =\n\t\t\tType.isNumber(this.getModel().getField('BASE_PRICE_EXTRA'))\n\t\t\t\t? this.getModel().getField('BASE_PRICE_EXTRA')\n\t\t\t\t: null\n\t\t;\n\n\t\treturn new PriceCalculator({\n\t\t\tbasePrice: Text.toNumber(this.getModel().getField('PURCHASING_PRICE')),\n\t\t\tfinalPrice: Text.toNumber(this.getModel().getField('BASE_PRICE')),\n\t\t\textra,\n\t\t\textraType: Text.toNumber(this.getModel().getField('BASE_PRICE_EXTRA_RATE')),\n\t\t});\n\t}\n\n\tchangeExtraType(value, mode = MODE_SET)\n\t{\n\t\tlet text = '%';\n\t\tif (value === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\ttext = this.getEditor().getCurrencyText();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvalue = PriceCalculator.EXTRA_TYPE_PERCENTAGE;\n\t\t}\n\n\t\tif (value === this.getField('BASE_PRICE_EXTRA_RATE'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst calculator =\n\t\t\t\tthis.#getCalculator()\n\t\t\t\t\t.calculateExtraType(value)\n\t\t\t;\n\n\t\t\tthis.changeExtra(calculator.getExtra());\n\t\t\tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t}\n\n\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE_EXTRA_RATE\"]');\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tnode.innerHTML = text;\n\t\t}\n\n\t\tthis.setField('BASE_PRICE_EXTRA_RATE', value);\n\t}\n\n\tchangeExtra(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = (Type.isNil(value) || value === '') ? null : this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setField('BASE_PRICE_EXTRA', preparedValue);\n\n\t\tif (preparedValue === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst calculator =\n\t\t\t\tthis.#getCalculator()\n\t\t\t\t\t.calculateExtra(preparedValue)\n\t\t\t;\n\n\t\t\tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE_EXTRA\"]');\n\t\t\tif (Type.isDomNode(node))\n\t\t\t{\n\t\t\t\tnode.value = preparedValue;\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeBasePrice(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setBasePrice(preparedValue, mode);\n\n\t\t// if (mode === MODE_EDIT)\n\t\t// {\n\t\t// \tconst calculator =\n\t\t// \t\tthis.#getCalculator()\n\t\t// \t\t\t.calculateFinalPrice(preparedValue)\n\t\t// \t;\n\t\t//\n\t\t// \tthis.changeExtra(calculator.getExtra());\n\t\t// \tthis.changeExtraType(calculator.getExtraType());\n\t\t// }\n\t}\n\n\tchangePurchasingPrice(value, mode = MODE_SET)\n\t{\n\t\tif (this.#isPurchasingPriceAccessDenied())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setPurchasingPrice(preparedValue, mode);\n\n\t\t// const currentExtra = this.getField('BASE_PRICE_EXTRA');\n\t\t// if (mode === MODE_EDIT && !Type.isNil(currentExtra) && currentExtra !== '')\n\t\t// {\n\t\t// \tconst calculator =\n\t\t// \t\tthis.#getCalculator()\n\t\t// \t\t\t.calculateBasePrice(preparedValue)\n\t\t// \t;\n\t\t//\n\t\t// \tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t// }\n\t}\n\n\tchangeAmount(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\n\t\tthis.setAmount(preparedValue, mode);\n\t}\n\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\n\t{\n\t\tthis\n\t\t\t.getEditor()\n\t\t\t.getMeasures()\n\t\t\t.filter((item) => item.CODE === value)\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\n\t\t;\n\t}\n\n\tchangeBarcode(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('BARCODE') !== preparedValue;\n\n\t\tif (isChangedValue && mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('BARCODE', preparedValue);\n\t\t\tthis.setField('DOC_BARCODE', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t\telse if (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.setField('DOC_BARCODE', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStore(value: number, code: string)\n\t{\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tconst isChangedValue = this.getField(code) !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField(code, preparedValue);\n\t\t\tthis.setStoreAmount(value, code);\n\t\t\tthis.layoutStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStoreName(value: number, code: string)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tthis.setField(code, preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeProductName(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('NAME') !== preparedValue;\n\n\t\tif (isChangedValue && mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('NAME', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeSort(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('SORT', preparedValue);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\n\t{\n\t\tfor (let field in this.fields)\n\t\t{\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\n\t\t\t{\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\n\t\t\t}\n\t\t}\n\t\tthis.updateUiMeasure(\n\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\tthis.getField('MEASURE_NAME')\n\t\t)\n\t\tthis.getSelector()?.reloadFileInput();\n\t\tthis.getSelector()?.layout();\n\t\tthis.getBarcodeSelector()?.layout();\n\t\tthis.updateUiStoreValues();\n\t}\n\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\n\t{\n\t\tconst selectorId = 'catalog_document_grid_' + this.getId();\n\t\tif (selectorId)\n\t\t{\n\t\t\tconst model = ProductModel.getById(selectorId);\n\t\t\tif (model)\n\t\t\t{\n\t\t\t\tthis.model = model;\n\t\t\t}\n\t\t}\n\n\t\tif (!(this.model instanceof ProductModel))\n\t\t{\n\t\t\tthis.model = new ProductModel({\n\t\t\t\tid: selectorId,\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\n\t\t\t\tiblockId: fields['IBLOCK_ID'],\n\t\t\t\tbasePriceId: fields['BASE_PRICE_ID'],\n\t\t\t\tskuTree: Type.isStringFilled(fields['SKU_TREE']) ? JSON.parse(fields['SKU_TREE']) : null,\n\t\t\t\tstoreMap: fields['STORE_AMOUNT_MAP'],\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tif (Type.isObject(fields['IMAGE_INFO']))\n\t\t\t{\n\t\t\t\tthis.model.getImageCollection().setPreview(fields['IMAGE_INFO']['preview']);\n\t\t\t\tthis.model.getImageCollection().setEditInput(fields['IMAGE_INFO']['input']);\n\t\t\t\tthis.model.getImageCollection().setMorePhotoValues(fields['IMAGE_INFO']['values']);\n\t\t\t}\n\n\t\t\tif (!Type.isNil(fields['DETAIL_URL']))\n\t\t\t{\n\t\t\t\tthis.model.setDetailPath(fields['DETAIL_URL']);\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tRuntime.debounce(this.#handleProductErrorsChange, 500, this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.updateUiStoreValues.bind(this)\n\t\t);\n\t}\n\n\tgetModel(): ?ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\t#handleProductErrorsChange()\n\t{\n\t\tconst errors = this.getModel().getErrorCollection().getErrors();\n\t\tfor (const code in errors)\n\t\t{\n\t\t\tif (code === ProductSelector.ErrorCodes.NOT_SELECTED_PRODUCT)\n\t\t\t{\n\t\t\t\tthis.getSelector().layoutErrors();\n\t\t\t}\n\t\t}\n\n\t\tthis.getEditor().handleProductErrorsChange();\n\t}\n\n\t#handleBeforeCreateProduct(event: BaseEvent)\n\t{\n\t\tconst {model} = event.getData();\n\t\tmodel.setField('BARCODE', this.barcodeSelector.getNameInputFilledValue());\n\t\tmodel.setField('NAME', this.mainSelector.getNameInputFilledValue());\n\t}\n\n\t#handleSpotlightClose(event: BaseEvent): void\n\t{\n\t\tthis.editor.closeBarcodeSpotlights();\n\t}\n\n\t#handleBarcodeQrClose(event: BaseEvent): void\n\t{\n\t\tthis.editor.closeBarcodeQrAuths();\n\t}\n\n\t#handleBarcodeScannerInstallCheck(event: BaseEvent): void\n\t{\n\t\tthis.editor.enableSendBarcodeMobilePush();\n\t}\n\t\n\t#handleBarcodeChange(event: BaseEvent): void\n\t{\n\t\tconst {value} = event.getData();\n\t\tthis.changeBarcode(value, MODE_EDIT);\n\t}\n\n\tsetProductId(value)\n\t{\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_ID', value);\n\t\t\tthis.setField('SKU_ID', value);\n\n\t\t\tthis.updateUiStoreValues();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tthis.#hidePurchasingPrice();\n\t\t}\n\t}\n\n\tsetBasePrice(value, mode = MODE_SET)\n\t{\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiField('BASE_PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\t\tthis.setField('BASE_PRICE', value);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\n\t\tthis.updateRowTotalPrice();\n\t}\n\n\tupdateRowTotalPrice()\n\t{\n\t\tconst field = this.getEditor().getSettingValue('totalCalculationSumField', 'PURCHASING_PRICE');\n\t\tlet value = this.getAmount() * this.getField(field, 0);\n\t\tvalue = Math.max(value, 0);\n\n\t\tthis.setField('TOTAL_PRICE', value);\n\t\tthis.updateUiField('TOTAL_PRICE', value.toFixed(this.getPricePrecision()));\n\t}\n\n\tupdateProductStoreValues()\n\t{\n\t\tthis.storeSelectors.forEach((selector) => {\n\t\t\tselector.setProductId(this.getModel().getSkuId());\n\t\t});\n\t}\n\n\tupdateUiStoreValues()\n\t{\n\t\tconst storeHeaderMap = this.getSettingValue('storeHeaderMap', {});\n\t\tObject.keys(storeHeaderMap).forEach((key) => {\n\t\t\tconst fieldName = storeHeaderMap[key];\n\t\t\tlet value = this.getField(fieldName);\n\t\t\tif (fieldName === 'STORE_FROM')\n\t\t\t{\n\t\t\t\tconst currentAmount = this.model.getStoreCollection().getStoreAmount(value);\n\t\t\t\tif (currentAmount <= 0)\n\t\t\t\t{\n\t\t\t\t\tconst maxStore = this.model.getStoreCollection().getMaxFilledStore();\n\t\t\t\t\tconst storeSelector = StoreSelector.getById(this.getId() + '_' + key);\n\t\t\t\t\tif (maxStore.AMOUNT > currentAmount && storeSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tstoreSelector.onStoreSelect(maxStore.STORE_ID, maxStore.STORE_TITLE);\n\t\t\t\t\t\tvalue = maxStore.STORE_ID;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setStoreAmount(value, fieldName)\n\t\t})\n\n\t\tthis.layoutStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t}\n\n\tsetStoreAmount(value, fieldName, mode = MODE_SET)\n\t{\n\t\t// price can't be less than zero\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tlet amount;\n\n\t\t\tconst amounts = {\n\t\t\t\t'_AMOUNT': () => this.model.getStoreCollection().getStoreAmount(value),\n\t\t\t\t'_RESERVED': () => this.model.getStoreCollection().getStoreReserved(value),\n\t\t\t\t'_AVAILABLE_AMOUNT': () => this.model.getStoreCollection().getStoreAvailableAmount(value),\n\t\t\t};\n\t\t\tfor (const postfix in amounts) {\n\t\t\t\tif (Object.hasOwnProperty.call(amounts, postfix)) {\n\t\t\t\t\tconst wrapper = this.#getNodeChildByDataName(fieldName + postfix);\n\t\t\t\t\tif (wrapper)\n\t\t\t\t\t{\n\t\t\t\t\t\twrapper.innerHTML = '';\n\n\t\t\t\t\t\tif (this.#needInventory())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tamount = amounts[postfix]() || 0;\n\t\t\t\t\t\t\twrapper.innerHTML = amount + ' ' + Text.encode(this.getField('MEASURE_NAME'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsetPurchasingPrice(value, mode = MODE_SET)\n\t{\n\t\tif (this.#isPurchasingPriceAccessDenied())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiField('PURCHASING_PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\t\tthis.setField('PURCHASING_PRICE', value);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\n\t\tthis.updateRowTotalPrice();\n\t}\n\n\tsetAmount(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('AMOUNT', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('AMOUNT') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('AMOUNT', value);\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tthis.updateRowTotalPrice();\n\t\t}\n\t}\n\n\tsetMeasure(measure, mode = MODE_SET)\n\t{\n\t\tif (this.model.isEmpty())\n\t\t{\n\t\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\t\t\tthis.updateUiMeasure(measure.CODE,\tmeasure.SYMBOL);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.getModel().showSaveNotifier(\n\t\t\t\t'measureChanger_' + this.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\n\t\t\t\t\tdeclineCancelTitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_DECLINE_SAVE'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\t\t\t\t\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\t\t\t\t\t\t\tthis.updateUiMeasure(\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_NAME')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\t\tthis.updateUiMeasure(\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_NAME')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateUiMeasure(measure.CODE,\tmeasure.SYMBOL);\n\t\t}\n\n\t\tthis.addActionProductChange();\n\t}\n\n\t// controls\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst fieldId = this.getUiFieldId(fieldName);\n\t\tlet item = document.getElementById(fieldId);\n\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\titem = this.getNode().querySelector('[name=\"' + fieldId + '\"]');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tgetInputWrapperByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst inputBlock = this.getInputByFieldName(fieldName);\n\n\t\tif (Type.isElementNode(inputBlock))\n\t\t{\n\t\t\treturn Type.isElementNode(inputBlock.parentNode) ? inputBlock.parentNode : inputBlock;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tupdateUiInputField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.value = value;\n\t\t}\n\t}\n\n\tupdateUiCheckboxField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.checked = value === 'Y';\n\t\t}\n\t}\n\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\n\t{\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.dropdownManager.getById(this.getId() + '_' + name + '_control');\n\t}\n\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\n\t{\n\t\tif (dropdown.getValue() === value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (dropdown.menu)\n\t\t{\n\t\t\tdropdown.menu.destroy();\n\t\t}\n\n\t\tconst item = dropdown.menu.itemsContainer.querySelector('[data-value=\"' + value + '\"]');\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\n\t\tif (menuItem)\n\t\t{\n\t\t\tdropdown.refresh(menuItem);\n\t\t\tdropdown.selectItem(menuItem);\n\t\t}\n\t}\n\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.dataset.value = value;\n\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\n\t\tif (!Type.isElementNode(span))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tspan.innerHTML = text;\n\t}\n\n\tupdateUiMeasure(code, name)\n\t{\n\t\tthis.updateUiMoneyField(\n\t\t\t'MEASURE_CODE',\n\t\t\tcode,\n\t\t\tText.encode(name)\n\t\t);\n\n\t\tthis.updateUiStoreValues();\n\t}\n\n\tupdateUiHtmlField(name, html)\n\t{\n\t\tconst item = this.getNode().querySelector('[data-name=\"' + name + '\"]');;\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.innerHTML = html;\n\t\t}\n\t}\n\n\tupdateUiCurrencyFields()\n\t{\n\t\tconst currencyText = this.getEditor().getCurrencyText();\n\t\tconst currencyId = '' + this.getEditor().getCurrencyId();\n\n\t\tconst currencyFieldNames = ['BASE_PRICE_CURRENCY', 'PURCHASING_PRICE_CURRENCY'];\n\t\tcurrencyFieldNames.forEach((name) => {\n\t\t\tconst dropdownValues = [];\n\t\t\tdropdownValues.push({\n\t\t\t\tNAME: currencyText,\n\t\t\t\tVALUE: currencyId,\n\t\t\t});\n\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\n\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\n\t\t});\n\t}\n\n\tupdateUiField(field, value): void\n\t{\n\t\tconst uiName = this.getUiFieldName(field);\n\t\tif (!uiName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst uiType = this.getUiFieldType(field);\n\t\tif (!uiType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (uiType)\n\t\t{\n\t\t\tcase 'input':\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money':\n\t\t\t\tvalue = BX.util.number_format(value, this.getPricePrecision(), \".\", \"\");\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money_html':\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetUiFieldName(field)\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'AMOUNT':\n\t\t\tcase 'MEASURE_CODE':\n\t\t\tcase 'BASE_PRICE':\n\t\t\tcase 'PURCHASING_PRICE':\n\t\t\tcase 'TOTAL_PRICE':\n\t\t\t\tresult = field;\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetUiFieldType(field)\n\t{\n\t\tconst moneyFields = ['BASE_PRICE', 'PURCHASING_PRICE', 'TOTAL_PRICE'];\n\t\tif (moneyFields.includes(field))\n\t\t{\n\t\t\tconst column = this.getEditor()?.getColumnInfo(field);\n\t\t\tif (column?.editable?.TYPE === 'MONEY')\n\t\t\t{\n\t\t\t\treturn  'money';\n\t\t\t}\n\n\t\t\treturn  'money_html';\n\t\t}\n\t\telse if (field === 'AMOUNT')\n\t\t{\n\t\t\treturn  'input';\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// proxy\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\treturn this.getEditor().parseInt(value, defaultValue);\n\t}\n\n\tparseFloat(value: number | string, precision: number, defaultValue = 0)\n\t{\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\n\t}\n\n\tgetPricePrecision()\n\t{\n\t\treturn this.getEditor().getPricePrecision();\n\t}\n\n\tgetQuantityPrecision()\n\t{\n\t\treturn this.getEditor().getQuantityPrecision();\n\t}\n\n\tgetCommonPrecision()\n\t{\n\t\treturn this.getEditor().getCommonPrecision();\n\t}\n\n\tresetExternalActions()\n\t{\n\t\tthis.externalActions.length = 0;\n\t}\n\n\taddExternalAction(action: Action)\n\t{\n\t\tthis.externalActions.push(action);\n\t}\n\n\taddActionProductChange()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.productChange,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionUpdateTotal()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateTotal\n\t\t});\n\t}\n\n\texecuteExternalActions()\n\t{\n\t\tif (this.externalActions.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getEditor().executeActions(this.externalActions);\n\t\tthis.resetExternalActions();\n\t}\n\n\tisEmptyRow()\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('NAME', '').trim())\n\t\t\t&& this.model.isEmpty()\n\t\t\t&& this.getBasePrice() <= 0\n\t\t)\n\t}\n\n\tvalidate(): Array\n\t{\n\t\tconst errorsList = [];\n\n\t\tif (!this.#isProductCountCorrect(this.getAmount()))\n\t\t{\n\t\t\tthis.#subscribeFieldToValidator('AMOUNT', this.#isProductCountCorrect);\n\t\t\terrorsList.push(Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_INVALID_AMOUNT_2'));\n\t\t}\n\n\t\treturn errorsList;\n\t}\n\n\t#subscribeFieldToValidator(fieldName: string, validatorCallback: Function): void\n\t{\n\t\tconst fieldInput = this.getInputByFieldName(fieldName);\n\t\tconst fieldWrapper = this.getInputWrapperByFieldName(fieldName);\n\n\t\tif (validatorCallback(fieldInput.valueAsNumber) || this.validatingFields.get(fieldName))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.validatingFields.set(fieldName, true);\n\n\t\tfieldWrapper.classList.add('main-grid-editor-cell-danger');\n\n\t\tconst validator = (eventObject) => {\n\t\t\tif (Boolean(validatorCallback(eventObject.target.valueAsNumber)))\n\t\t\t{\n\t\t\t\tthis.validatingFields.set(fieldName, false);\n\t\t\t\tEvent.unbind(fieldInput, 'blur', validator);\n\t\t\t\tfieldWrapper.classList.remove('main-grid-editor-cell-danger');\n\t\t\t}\n\t\t};\n\n\t\tEvent.bind(fieldInput, 'blur', validator);\n\t}\n\n\t#isProductCountCorrect(amountValue): boolean\n\t{\n\t\treturn amountValue > 0;\n\t}\n\n\t#getNodeChildByDataName(name: String): HTMLElement\n\t{\n\t\treturn this.getNode().querySelector(`[data-name=\"${name}\"]`);\n\t}\n\n\t#needInventory(): boolean\n\t{\n\t\treturn !this.getModel().isService();\n\t}\n\n\t#needBarcode(): boolean\n\t{\n\t\treturn !this.getModel().isService();\n\t}\n\n\t#isRowAccessDenied()\n\t{\n\t\treturn this.getField('ACCESS_DENIED') === true;\n\t}\n\n\t#hideFields()\n\t{\n\t\tif (!this.#isRowAccessDenied())\n\t\t{\n\t\t\tthis.#hidePurchasingPrice();\n\t\t\treturn;\n\t\t}\n\n\t\tconst hiddenFields = this.getEditor().getSettingValue('hiddenFields');\n\t\tconst columnIndexes = this.getEditor().getGridColumnIndexes();\n\n\t\thiddenFields.forEach((fieldName) => {\n\t\t\tconst columnIndex = columnIndexes[fieldName];\n\t\t\tif (columnIndex === undefined)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = this.getNode().querySelector(`.main-grid-cell:nth-child(${columnIndex+1}) .main-grid-cell-content`);\n\t\t\tif (Type.isElementNode(item))\n\t\t\t{\n\t\t\t\titem.innerHTML = '';\n\t\t\t}\n\t\t});\n\n\t\tconst fieldWithHintIndex = columnIndexes['AMOUNT'];\n\t\tif (fieldWithHintIndex)\n\t\t{\n\t\t\tconst fieldWithHintNode = this.getNode().querySelector(`.main-grid-cell:nth-child(${fieldWithHintIndex+1}) .main-grid-cell-content`);\n\t\t\tif (fieldWithHintNode)\n\t\t\t{\n\t\t\t\tconst input = new AccessDeniedInput({\n\t\t\t\t\thint: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_STORE_HINT'),\n\t\t\t\t\tisReadOnly: this.getEditor().isReadOnly(),\n\t\t\t\t});\n\t\t\t\tinput.renderTo(fieldWithHintNode);\n\t\t\t}\n\t\t}\n\t}\n\n\t#isPurchasingPriceAccessDenied()\n\t{\n\t\treturn this.getField('ACCESS_DENIED_TO_PURCHASING_PRICE') === true;\n\t}\n\n\t#hidePurchasingPrice()\n\t{\n\t\tif (!this.#isPurchasingPriceAccessDenied())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst columnIndexes = this.getEditor().getGridColumnIndexes();\n\t\tconst fieldWithHintIndex = columnIndexes['PURCHASING_PRICE'];\n\t\tif (fieldWithHintIndex)\n\t\t{\n\t\t\tconst fieldWithHintNode = this.getNode().querySelector(`.main-grid-cell:nth-child(${fieldWithHintIndex+1})`);\n\t\t\tif (fieldWithHintNode)\n\t\t\t{\n\t\t\t\tconst priceNode = fieldWithHintNode.querySelector('.main-grid-editor-container');\n\t\t\t\tif (priceNode)\n\t\t\t\t{\n\t\t\t\t\tpriceNode.remove();\n\t\t\t\t}\n\n\t\t\t\tconst contentNode = fieldWithHintNode.querySelector('.main-grid-cell-content');\n\t\t\t\tif (contentNode)\n\t\t\t\t{\n\t\t\t\t\tconst input = new AccessDeniedInput({\n\t\t\t\t\t\thint: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_PURCHASING_PRICE_HINT'),\n\t\t\t\t\t\tisReadOnly: this.getEditor().isReadOnly(),\n\t\t\t\t\t});\n\t\t\t\t\tinput.renderTo(contentNode);\n\t\t\t\t\tcontentNode.style.display = 'block';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import {Popup} from 'main.popup';\nimport {ajax, Cache, Event, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {Editor} from './product.list.editor';\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\t#getSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title\">${item.title}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.#getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.#requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\t#requestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tconst message = enabled\n\t\t\t\t? Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_ENABLED')\n\t\t\t\t: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_DISABLED');\n\n\t\t\tthis.#showNotification(message.replace('#NAME#', setting.title), {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}","// @flow\n\nimport {Event} from 'main.core';\nimport {Guide} from 'ui.tour';\nimport 'spotlight';\n\nexport class FieldHintManager\n{\n\tfieldHintIsBusy: boolean = false;\n\tactiveHintGuide: Guide|null = null;\n\n\t#gridGetter: Function;\n\t#contentContainer: HTMLElement;\n\n\tconstructor(contentContainer: HTMLElement, gridGetter: Function)\n\t{\n\t\tthis.#contentContainer = contentContainer;\n\t\tthis.#gridGetter = gridGetter;\n\t}\n\n\tprocessFieldTour(fieldNode: HTMLElement, tourData: Object, endTourHandler: Function, addictedFieldNodes: Array<HTMLElement> = []): void\n\t{\n\t\tif (this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fieldHintIsBusy = true;\n\t\t// When click action in progress tour will be closed -> 'onClose' tour method will be executed\n\t\ttourData.events = {\n\t\t\tonClose: () => {\n\t\t\t\tendTourHandler();\n\t\t\t\tthis.fieldHintIsBusy = false;\n\t\t\t\tthis.activeHintGuide = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#fieldNodeIsInGridVision(fieldNode))\n\t\t{\n\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\ttourObject.close();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\t\tconst fieldPos = fieldNode.getClientRects()[0].x;\n\t\t\tconst gridPos = gridContainer.getClientRects()[0].x;\n\n\t\t\tlet spotlight = null;\n\t\t\tif (fieldPos > gridPos) {\n\t\t\t\tspotlight = this.#bindSpotlightToNode(rightArrow);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tspotlight = this.#bindSpotlightToNode(leftArrow);\n\t\t\t}\n\n\t\t\tthis.#bindGridNodeVisionChange(fieldNode, () => {\n\t\t\t\tspotlight.close();\n\t\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\t\ttourObject.close();\n\t\t\t\t})\n\t\t\t}, [], addictedFieldNodes);\n\t\t}\n\t}\n\n\t#bindGridNodeVisionChange(observedNode: HTMLElement, onSuccessVisionCallback: Function, callbackParams: Array = [], addictedNodes: Array<HTMLElement> = [])\n\t{\n\t\tconst observedNodes = this.#getPossibleToValidateFieldNodes(observedNode, ...addictedNodes);\n\t\tconst observer = (event: Event) => {\n\t\t\tif (this.#fieldNodeIsInGridVision(...observedNodes))\n\t\t\t{\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t\t\t'scroll',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\t\t\t\tEvent.unbind(\n\t\t\t\t\twindow,\n\t\t\t\t\t'resize',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\n\t\t\t\tonSuccessVisionCallback(...callbackParams);\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(\n\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t'scroll',\n\t\t\tobserver\n\t\t);\n\t\tEvent.bind(\n\t\t\twindow,\n\t\t\t'resize',\n\t\t\tobserver\n\t\t);\n\t}\n\n\t#getPossibleToValidateFieldNodes(mainNode: HTMLElement, ...addictedNodes: Array<HTMLElement>): Array<HTMLElement>\n\t{\n\t\tconst nodesTuple = [];\n\t\tfor (const addictedNode: HTMLElement of addictedNodes)\n\t\t{\n\t\t\tnodesTuple.push({\n\t\t\t\tnode: addictedNode,\n\t\t\t\tnodeRect: addictedNode.getClientRects()[0],\n\t\t\t});\n\t\t}\n\n\t\tconst mainNodeTupleEl = {\n\t\t\tnode: mainNode,\n\t\t\tnodeRect: mainNode.getClientRects()[0],\n\t\t};\n\t\tnodesTuple.push(mainNodeTupleEl);\n\n\t\tnodesTuple.sort((firstEl, secondEl) => {\n\t\t\tconst {x: firstX} = firstEl.nodeRect;\n\t\t\tconst {x: secondX} = secondEl.nodeRect;\n\n\t\t\tif (firstX < secondX)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\telse if (firstX > secondX)\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t});\n\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\t\tfunction widthIsValid(leftPos: number, rightPos: number)\n\t\t{\n\t\t\treturn Math.abs(leftPos - rightPos) < gridRect.width;\n\t\t}\n\n\t\twhile (nodesTuple.length > 1 && !widthIsValid(nodesTuple[0].nodeRect.x,nodesTuple[nodesTuple.length-1].nodeRect.x))\n\t\t{\n\t\t\tconst firstEl = nodesTuple[0];\n\t\t\tconst lastEl = nodesTuple[nodesTuple.length-1];\n\t\t\tif (firstEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.pop();\n\t\t\t}\n\t\t\telse if (lastEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.shift();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst firstElDistance = mainNodeTupleEl.nodeRect.x - firstEl.nodeRect.x;\n\t\t\t\tconst lastElDistance = lastEl.nodeRect.x - mainNodeTupleEl.nodeRect.x;\n\t\t\t\tif (firstElDistance >= lastElDistance)\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.shift();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.pop();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn nodesTuple.map((el) => el.node);\n\t}\n\n\t#fieldNodeIsInGridVision(...fieldNodes: Array<HTMLElement>) {\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\n\t\tif (gridRect === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst gridLeftEdge = gridRect.x;\n\t\tconst gridRightEdge = gridRect.x + gridRect.width;\n\n\t\tfor (const fieldNode: HTMLElement of fieldNodes)\n\t\t{\n\t\t\tconst fieldRect = fieldNode.getClientRects()?.[0];\n\t\t\tif (fieldRect === undefined)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst fieldLeftEdge = fieldRect.x;\n\t\t\tconst fieldRightEdge = fieldRect.x + fieldRect.width;\n\n\t\t\tif (fieldLeftEdge < gridLeftEdge || fieldRightEdge > gridRightEdge)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#bindSpotlightToNode(targetNode: HTMLElement)\n\t{\n\t\tconst spotlight = new BX.SpotLight(\n\t\t\t{\n\t\t\t\tid: 'arrow_spotlight',\n\t\t\t\ttargetElement: targetNode,\n\t\t\t\tautoSave: true,\n\t\t\t\ttargetVertex: \"middle-center\",\n\t\t\t\tzIndex: 200,\n\t\t\t}\n\t\t);\n\t\tspotlight.show();\n\t\tspotlight.container.style.pointerEvents = \"none\";\n\n\t\treturn spotlight;\n\t}\n\n\t#freezeGridContainer(onCloseCallback: Function, callbackParams: Array = [])\n\t{\n\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\tgridContainer.style.pointerEvents = \"none\";\n\t\tleftArrow.style.pointerEvents = \"none\";\n\t\trightArrow.style.pointerEvents = \"none\";\n\n\t\tconst clickObserver = (event) => {\n\t\t\tgridContainer.style.pointerEvents = \"auto\";\n\t\t\tleftArrow.style.pointerEvents = \"auto\";\n\t\t\trightArrow.style.pointerEvents = \"auto\";\n\t\t\tEvent.unbind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\n\t\t\tonCloseCallback(...callbackParams);\n\t\t}\n\t\tsetTimeout(() => {\n\t\t\tEvent.bind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\t\t}, 500);\n\t}\n\n\t#tieTourToNode(tourTarget: HTMLElement, tourData: Object): Guide\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\tObject.assign({target: tourTarget}, tourData),\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t\tthis.activeHintGuide = guide;\n\n\t\tguide.showNextStep();\n\t\treturn guide;\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\tif (!this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\telse if (this.activeHintGuide instanceof Guide)\n\t\t{\n\t\t\treturn this.activeHintGuide;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import {ajax, Cache, Dom, Event, Reflection, Runtime, Text, Type, Loc} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Row} from './product.list.row';\nimport {PageEventsManager} from './page.events.manager';\nimport SettingsPopup from './settings.button';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {ProductSelector} from 'catalog.product-selector';\nimport HintPopup from './hint.popup';\nimport ProductListController from \"catalog.document-card\";\nimport {ProductModel} from \"catalog.product-model\";\nimport {FieldHintManager} from \"./field.hint.manager\";\nimport {Guide} from \"ui.tour\";\nimport \"ui.hint\";\n\nconst GRID_TEMPLATE_ROW = 'template_0';\nconst DEFAULT_PRECISION: number = 2;\n\nconst isEmptyObject = function(obj): boolean\n{\n\tif (!Type.isPlainObject(obj))\n\t{\n\t\treturn false;\n\t}\n\n\tfor (const key in obj)\n\t{\n\t\treturn false;\n\t}\n\n\treturn true;\n};\n\nexport class Editor\n{\n\tid: ?string;\n\tsettings: Object;\n\tcontroller: ?ProductListController;\n\tcontainer: ?HTMLElement;\n\tform: ?HTMLElement\n\tproducts: Row[] = [];\n\tproductsWasInitiated = false;\n\tpageEventsManager: PageEventsManager;\n\tcache = new Cache.MemoryCache();\n\n\t#fieldHintManager: FieldHintManager;\n\n\tactions = {\n\t\tproductChange: 'productChange',\n\t\tproductListChanged: 'productListChanged',\n\t\tupdateListField: 'listField',\n\t\tupdateTotal: 'total'\n\t};\n\n\tupdateFieldForList = null;\n\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\n\tproductRowCreateHandler = this.handleProductRowCreate.bind(this);\n\tshowBarcodeSettingsPopupHandler = this.handleShowBarcodeSettingsPopup.bind(this);\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\n\n\tonSaveHandler = this.handleOnSave.bind(this);\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\n\tonFocusToProductList = this.handleProductListFocus.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\n\tonScanEmitHandler = this.handleMobileScanEvent.bind(this);\n\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 100, this);\n\n\tconstructor(id)\n\t{\n\t\tthis.setId(id);\n\t}\n\n\tinit(config = {})\n\t{\n\t\tthis.setSettings(config);\n\n\t\tthis.scannerToken = this.scannerToken ?? Text.getRandom(16);\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.enableEdit();\n\t\t}\n\n\t\tthis.initForm();\n\t\tthis.initProducts();\n\t\tthis.initGridData();\n\t\tthis.paintColumns();\n\n\t\tthis.#fieldHintManager = new FieldHintManager(this.getContainer(), this.getGrid.bind(this));\n\n\t\tEventEmitter.emit( 'DocumentProductListController', [this]);\n\n\t\tthis.#initSupportCustomRowActions();\n\t\tthis.subscribeDomEvents();\n\t\tthis.subscribeCustomEvents();\n\n\t\tthis\n\t\t\t.getContainer()\n\t\t\t.querySelectorAll('.catalog-document-product-list-add-block')\n\t\t\t.forEach((buttonBlock) => {\n\t\t\t\tBX.UI.Hint.init(buttonBlock);\n\t\t\t})\n\t\t;\n\n\t}\n\n\tsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tif (this.getSettingValue('enabledCreateProductButton', true))\n\t\t\t{\n\t\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-create-button\"]').forEach((addButton) => {\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\taddButton,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.productRowCreateHandler\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-barcode-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showBarcodeSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((createButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tcreateButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowCreateHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-barcode-settings-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.subscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tEventEmitter.subscribe('BarcodeScanner::onScanEmit', this.onScanEmitHandler);\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.unsubscribe('BX.UI.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.unsubscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.unsubscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tEventEmitter.unsubscribe('BarcodeScanner::onScanEmit', this.onScanEmitHandler);\n\t}\n\n\thandleMobileScanEvent(event: BaseEvent): void\n\t{\n\t\tconst params = event.getData();\n\t\tif (this.scannerToken !== params.id || !Type.isStringFilled(params.barcode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (product.getBarcodeSelector()?.searchInput?.getNameInput() === document.activeElement)\n\t\t\t{\n\t\t\t\tproduct.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (\n\t\t\t\tproduct.getBarcodeSelector()?.searchInput?.getNameInput().value === ''\n\t\t\t\t&& product.getSelector()?.searchInput?.getNameInput().value === ''\n\t\t\t)\n\t\t\t{\n\t\t\t\tproduct.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst newRowId = this.addProductRow();\n\t\tthis.getProductById(newRowId)?.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\t}\n\n\t#initSupportCustomRowActions()\n\t{\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\n\t}\n\n\tselectProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(id)\n\t\t\t\t?.onProductSelect(productId)\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnSave(event: BaseEvent)\n\t{\n\t\tconst notification = ProductModel.getLastActiveSaveNotification();\n\t\tif (notification)\n\t\t{\n\t\t\tnotification.close();\n\t\t}\n\n\t\tconst items = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\tconst item = {\n\t\t\t\tfields: {...product.fields},\n\t\t\t\trowId: product.fields.ROW_ID\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\n\t\tthis.setSettingValue('items', items);\n\t}\n\n\thandleEditorSubmit(event: BaseEvent)\n\t{\n\t}\n\n\thandleProductListFocus(event: BaseEvent)\n\t{\n\t\tif (this.isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet listHaveEmptyRows = false;\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (product.isEmptyRow())\n\t\t\t{\n\t\t\t\tlistHaveEmptyRows = true;\n\t\t\t\tthis.focusProductSelector(product.fields['ROW_ID']);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!listHaveEmptyRows)\n\t\t{\n\t\t\tthis.handleProductRowAdd();\n\t\t}\n\t}\n\n\tonInnerCancel()\n\t{\n\t\tthis.reloadGrid(false);\n\t}\n\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tconst activePanel = container.querySelector('.catalog-document-product-list-add-block-' + panelCode);\n\t\tif (Type.isDomNode(activePanel))\n\t\t{\n\t\t\tDom.removeClass(activePanel, 'catalog-document-product-list-add-block-hidden');\n\t\t\tDom.addClass(activePanel, 'catalog-document-product-list-add-block-active');\n\t\t}\n\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\n\t\tconst removePanel = container.querySelector('.catalog-document-product-list-add-block-' + hiddenPanelCode);\n\t\tif (Type.isDomNode(removePanel))\n\t\t{\n\t\t\tDom.addClass(removePanel, 'catalog-document-product-list-add-block-hidden');\n\t\t\tDom.removeClass(removePanel, 'catalog-document-product-list-add-block-active');\n\t\t}\n\n\t\treturn activePanel;\n\t}\n\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\n\t{\n\t\tif (isInternalChanging === null)\n\t\t{\n\t\t\tisInternalChanging = !useProductsFromRequest;\n\t\t}\n\n\t\tthis.getGrid().reloadTable(\n\t\t\t'POST',\n\t\t\t{useProductsFromRequest},\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging})\n\t\t);\n\t}\n\n\t/*\n\t\tkeep in mind different actions for this handler:\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t */\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\n\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tuseProductsFromRequest,\n\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields(Editor.#getAjaxFields()) : null,\n\t\t};\n\n\t\tlet isDeletingRequest = false;\n\t\tif (eventArgs.data['action_button_' + eventArgs.gridId] === 'delete')\n\t\t{\n\t\t\tisDeletingRequest = true;\n\t\t}\n\n\t\tthis.clearEditor();\n\n\t\tif (isNativeAction)\n\t\t{\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', (event) => {\n\t\t\t\tconst [grid] = event.getCompatData();\n\n\t\t\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.actionUpdateTotalData({isInternalChanging: false});\n\t\t\t\tif (isDeletingRequest)\n\t\t\t\t{\n\t\t\t\t\tthis.executeActions([\n\t\t\t\t\t\t{type: this.actions.productListChanged},\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\thandleOnGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSettingsPopup().updateCheckboxState();\n\t}\n\n\thandleOnGridRowMoved(event: BaseEvent)\n\t{\n\t\tconst [ids, , grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.resortProductsByIds(ids);\n\t\tif (changed)\n\t\t{\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\n\t\t}\n\t}\n\n\tinitPageEventsManager(): void\n\t{\n\t\tconst componentId = this.getSettingValue('componentId');\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\n\t}\n\n\tgetPageEventsManager(): PageEventsManager\n\t{\n\t\tif (!this.pageEventsManager)\n\t\t{\n\t\t\tthis.initPageEventsManager();\n\t\t}\n\n\t\treturn this.pageEventsManager;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.getSettingValue('allowEdit', false) === true;\n\t}\n\n\tenableEdit()\n\t{\n\t\t// Cannot use editSelected because checkboxes have been removed\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((current) => {\n\t\t\tif (\n\t\t\t\t!current.isHeadChild()\n\t\t\t\t&& !current.isTemplate()\n\t\t\t\t&& !isEmptyObject(current.getEditData())\n\t\t\t)\n\t\t\t{\n\t\t\t\tcurrent.edit();\n\t\t\t}\n\t\t});\n\t}\n\n\taddFirstRowIfEmpty(): void\n\t{\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\trequestAnimationFrame(() => this.addProductRow());\n\t\t}\n\t}\n\n\tclearEditor()\n\t{\n\t\tthis.unsubscribeProductsEvents();\n\n\t\tthis.products = [];\n\t\tthis.productsWasInitiated = false;\n\n\t\tthis.destroySettingsPopup();\n\t\tthis.unsubscribeDomEvents();\n\t\tthis.unsubscribeCustomEvents();\n\n\t\tEvent.unbindAll(this.container);\n\t}\n\n\twasProductsInitiated()\n\t{\n\t\treturn this.productsWasInitiated;\n\t}\n\n\tunsubscribeProductsEvents()\n\t{\n\t\tthis.products.forEach((current) => {\n\t\t\tconst productSelector = current.getSelector();\n\t\t\tif (productSelector)\n\t\t\t{\n\t\t\t\tproductSelector.unsubscribeEvents();\n\t\t\t}\n\t\t\tconst barcodeSelector = current.getBarcodeSelector();\n\t\t\tif (barcodeSelector)\n\t\t\t{\n\t\t\t\tbarcodeSelector.unsubscribeEvents();\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.setForm(null);\n\t\tthis.clearController();\n\t\tthis.clearEditor();\n\t}\n\n\tsetController(controller)\n\t{\n\t\tif (this.controller === controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.clearProductList();\n\t\t}\n\t\tthis.controller = controller;\n\t}\n\n\tclearController()\n\t{\n\t\tthis.controller = null;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\t/* settings tools */\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings)\n\t{\n\t\tthis.settings = settings ? settings : {};\n\t}\n\n\tgetSettingValue(name: string, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value)\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tgetComponentName()\n\t{\n\t\treturn this.getSettingValue('componentName', '');\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getSettingValue('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getSettingValue('signedParameters', '');\n\t}\n\n\tgetContainerId()\n\t{\n\t\treturn this.getSettingValue('containerId', '');\n\t}\n\n\tgetGridId(): string\n\t{\n\t\treturn this.getSettingValue('gridId', '');\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.getSettingValue('languageId', '');\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.getSettingValue('siteId', '');\n\t}\n\n\tgetCatalogId()\n\t{\n\t\treturn this.getSettingValue('catalogId', 0);\n\t}\n\n\tisReadOnly()\n\t{\n\t\treturn this.getSettingValue('readOnly', true);\n\t}\n\n\tsetReadOnly(readOnly)\n\t{\n\t\tthis.setSettingValue('readOnly', readOnly);\n\t}\n\n\tgetCurrencyId(): string\n\t{\n\t\treturn this.getSettingValue('currencyId', '');\n\t}\n\n\tsetCurrencyId(currencyId): Promise\n\t{\n\t\tthis.setSettingValue('currencyId', currencyId);\n\t\treturn CurrencyCore.loadCurrencyFormat(currencyId);\n\t}\n\n\tchangeCurrencyId(currencyId): void\n\t{\n\t\tconst oldCurrencyId = this.getCurrencyId();\n\t\tif (oldCurrencyId === currencyId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis\n\t\t\t.setCurrencyId(currencyId)\n\t\t\t.then(() => {\n\t\t\t\tconst products = [];\n\t\t\t\tthis.products.forEach((product) => {\n\t\t\t\t\tproduct.getModel().setOption('currency', currencyId);\n\t\t\t\t\tproducts.push({\n\t\t\t\t\t\tfields: product.getFields(),\n\t\t\t\t\t\tid: product.getId()\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tif (products.length > 0)\n\t\t\t\t{\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tthis.getComponentName(),\n\t\t\t\t\t\t'calculateProductPrices',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tproducts,\n\t\t\t\t\t\t\t\tcurrencyId,\n\t\t\t\t\t\t\t\toldCurrencyId,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t\t\t.then(this.onCalculatePricesResponse.bind(this));\n\t\t\t\t}\n\n\t\t\t\tconst editData = this.getGridEditData();\n\t\t\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\n\n\t\t\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\n\t\t\t\tconst templateFieldNames = ['BASE_PRICE', 'PURCHASING_PRICE'];\n\n\t\t\t\ttemplateFieldNames.forEach((field) => {\n\t\t\t\t\tif (templateRow[field] && templateRow[field]['CURRENCY'])\n\t\t\t\t\t{\n\t\t\t\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.setGridEditData(editData);\n\t\t\t});\n\t}\n\n\tonCalculatePricesResponse(response)\n\t{\n\t\tconst products = response.data;\n\t\tthis.products.forEach((product) => {\n\t\t\tif (Type.isObject(products[product.getId()]))\n\t\t\t{\n\t\t\t\tproduct.updateField('BASE_PRICE', products[product.getId()]['BASE_PRICE']);\n\t\t\t\tproduct.updateField('PURCHASING_PRICE', products[product.getId()]['PURCHASING_PRICE']);\n\t\t\t\tproduct.updateUiCurrencyFields();\n\t\t\t}\n\t\t});\n\n\t\tthis.updateTotalDataDelayed();\n\t\tthis.updateTotalUiCurrency();\n\t}\n\n\tupdateTotalUiCurrency()\n\t{\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(totalBlock))\n\t\t{\n\t\t\ttotalBlock.querySelectorAll('[data-role=\"currency-wrapper\"]').forEach((row) => {\n\t\t\t\trow.innerHTML = this.getCurrencyText();\n\t\t\t});\n\t\t}\n\t}\n\n\tgetCurrencyText(): string\n\t{\n\t\tconst currencyId = this.getCurrencyId();\n\t\tif (!Type.isStringFilled(currencyId))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || '';\n\t}\n\n\tgetDataFieldName()\n\t{\n\t\treturn this.getSettingValue('dataFieldName', '');\n\t}\n\n\tgetDataSettingsFieldName()\n\t{\n\t\tconst field = this.getDataFieldName();\n\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetMeasures(): []\n\t{\n\t\treturn this.getSettingValue('measures', []);\n\t}\n\n\tgetDefaultMeasure()\n\t{\n\t\treturn this.getSettingValue('defaultMeasure', {});\n\t}\n\n\tgetRowIdPrefix()\n\t{\n\t\treturn this.getSettingValue('rowIdPrefix', 'catalog_entity_product_list_');\n\t}\n\n\t/* settings tools finish */\n\n\t/* calculate tools */\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isNegative)\n\t\t\t\t{\n\t\t\t\t\tresult = -result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseInt(value, 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\n\t\t\tconst dot = value.indexOf('.');\n\t\t\tconst comma = value.indexOf(',');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\n\t\t\tif (dot < 0 && comma >= 0)\n\t\t\t{\n\t\t\t\tlet s1 = value.substr(0, comma);\n\t\t\t\tconst decimalLength = value.length - comma - 1;\n\n\t\t\t\tif (decimalLength > 0)\n\t\t\t\t{\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\n\t\t\t\t}\n\n\t\t\t\tvalue = s1;\n\t\t\t}\n\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\n\t\t\tresult = parseFloat(value);\n\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\tif (isNegative)\n\t\t\t{\n\t\t\t\tresult = -result;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseFloat(value);\n\t\t}\n\n\t\tif (precision >= 0)\n\t\t{\n\t\t\tresult = this.round(result, precision);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tround(value: number, precision: number = DEFAULT_PRECISION)\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\t/* calculate tools finish */\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.getElementById(this.getContainerId());\n\t\t});\n\t}\n\n\tinitForm()\n\t{\n\t\tconst formId = this.getSettingValue('formId', '');\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\n\n\t\tif (Type.isElementNode(form))\n\t\t{\n\t\t\tthis.setForm(form);\n\t\t}\n\t}\n\n\tisExistForm()\n\t{\n\t\treturn Type.isElementNode(this.getForm());\n\t}\n\n\tgetForm()\n\t{\n\t\treturn this.form;\n\t}\n\n\tsetForm(form)\n\t{\n\t\tthis.form = form;\n\t}\n\n\tinitFormFields()\n\t{\n\t\tconst container = this.getForm();\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tconst field = this.getDataField();\n\t\t\tif (!Type.isElementNode(field))\n\t\t\t{\n\t\t\t\tthis.initDataField();\n\t\t\t}\n\n\t\t\tconst settingsField = this.getDataSettingsField();\n\t\t\tif (!Type.isElementNode(settingsField))\n\t\t\t{\n\t\t\t\tthis.initDataSettingsField();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\tcontainer.appendChild(Dom.create(\n\t\t\t\t'input',\n\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\n\t\t\t));\n\t\t}\n\t}\n\n\tremoveFormFields()\n\t{\n\t\tconst field = this.getDataField();\n\t\tif (Type.isElementNode(field))\n\t\t{\n\t\t\tDom.remove(field);\n\t\t}\n\n\t\tconst settingsField = this.getDataSettingsField();\n\t\tif (Type.isElementNode(settingsField))\n\t\t{\n\t\t\tDom.remove(settingsField);\n\t\t}\n\t}\n\n\tinitDataField()\n\t{\n\t\tthis.initFormField(this.getDataFieldName());\n\t}\n\n\tinitDataSettingsField()\n\t{\n\t\tthis.initFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetDataField()\n\t{\n\t\treturn this.getFormField(this.getDataFieldName());\n\t}\n\n\tgetDataSettingsField()\n\t{\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetProductCount()\n\t{\n\t\treturn this.products\n\t\t\t.filter(item => !item.isEmptyRow())\n\t\t\t.length\n\t\t;\n\t}\n\n\tinitProducts()\n\t{\n\t\tconst list = this.getSettingValue('items', []);\n\n\t\tfor (let item of list)\n\t\t{\n\t\t\tconst fields = {...item.fields};\n\t\t\tthis.products.push(new Row(item.rowId, fields, this.getSettingValue('rowSettings', {}), this));\n\t\t}\n\n\t\tthis.numerateRows();\n\t\tthis.productsWasInitiated = true;\n\n\t\tthis.updateTotalDataDelayed();\n\t}\n\n\tnumerateRows()\n\t{\n\t\tthis.products.forEach((product, index) => {\n\t\t\tproduct.setRowNumber(index + 1);\n\t\t})\n\t}\n\n\tgetGrid(): ?BX.Main.Grid\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\tconst gridId = this.getGridId();\n\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\n\t\t\t}\n\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\n\t\t});\n\t}\n\n\tgetGridColumnIndexes()\n\t{\n\t\treturn this.cache.remember('getGridColumnIndexes', () => {\n\t\t\tlet result = {};\n\n\t\t\tconst columns = this.getGrid().getHead().querySelectorAll('.main-grid-cell-head');\n\t\t\tfor (let i = 0; i < columns.length; i++) {\n\t\t\t\tconst node = columns[i];\n\t\t\t\tconst columnName = node.dataset.name;\n\n\t\t\t\tif (columnName)\n\t\t\t\t{\n\t\t\t\t\tresult[columnName] = i;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t});\n\t}\n\n\tinitGridData()\n\t{\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\t}\n\n\tpaintColumns()\n\t{\n\t\tconst paintedColumns = this.getSettingValue('paintedColumns', null);\n\t\tconst grid = this.getGrid();\n\t\tif (grid && Type.isArray(paintedColumns))\n\t\t{\n\t\t\tpaintedColumns.forEach((columnName) => {\n\t\t\t\tconst rows = grid.getRows().getRows();\n\t\t\t\trows.forEach((current) => {\n\t\t\t\t\tconst cell = current.getCellById(columnName);\n\t\t\t\t\tif (cell)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(cell, 'main-grid-cell-light-blue-background');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\tgetColumnInfo(code: string)\n\t{\n\t\treturn this.getGrid()?.arParams?.COLUMNS_ALL[code] || {};\n\t}\n\n\tsetGridEditData(data: {})\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\thandleProductErrorsChange()\n\t{\n\t\tif (this.#childrenHasErrors())\n\t\t{\n\t\t\tthis.controller.disableSaveButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.controller.enableSaveButton();\n\t\t}\n\t}\n\n\t#childrenHasErrors()\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\n\t\t\t.length > 0\n\t\t\t;\n\t}\n\n\thandleFieldChange(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tif (row && row.hasAttribute('data-id'))\n\t\t{\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tlet fieldCode = event.target.getAttribute('data-name');\n\t\t\t\tif (!Type.isStringFilled(fieldCode))\n\t\t\t\t{\n\t\t\t\t\tconst cell = event.target.closest('td');\n\t\t\t\t\tfieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t\t\t}\n\n\t\t\t\tif (fieldCode)\n\t\t\t\t{\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleDropdownChange(event: BaseEvent)\n\t{\n\t\tconst [dropdownId, , , , value] = event.getData();\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\n\t\tconst matches = dropdownId.match(regExp);\n\t\tif (matches)\n\t\t{\n\t\t\tconst [, rowId, fieldCode] = matches;\n\t\t\tconst product = this.getProductById(rowId);\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tproduct.updateDropdownField(fieldCode, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProductById(id: string): ?Row\n\t{\n\t\tconst rowId = this.getRowIdPrefix() + id;\n\n\t\treturn this.getProductByRowId(rowId);\n\t}\n\n\tgetProductByRowId(rowId: string): ?Row\n\t{\n\t\treturn this.products.find((row: Row) => {\n\t\t\treturn row.getId() === rowId;\n\t\t});\n\t}\n\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\n\t{\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\n\t\t\tconst index = [...row.cells].indexOf(cell);\n\n\t\t\treturn headRow.getCellNameByCellIndex(index);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddProductRow(anchorProduct: Row = null): string\n\t{\n\t\tconst row = this.createGridProductRow();\n\t\tconst newId = row.getId();\n\n\t\tif (anchorProduct)\n\t\t{\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\n\t\t\tif (anchorRowNode)\n\t\t\t{\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\n\t\t\t}\n\t\t}\n\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\n\t\tthis.getGrid().bindOnRowEvents();\n\t\treturn newId;\n\t}\n\n\thandleProductRowAdd(): void\n\t{\n\t\tconst id = this.addProductRow();\n\t\tthis.focusProductSelector(id);\n\t}\n\n\thandleProductRowCreate(): void\n\t{\n\t}\n\n\thandleShowBarcodeSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\thandleShowSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\tdestroySettingsPopup()\n\t{\n\t\tif (this.cache.has('settings-popup'))\n\t\t{\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\n\t\t\tthis.cache.delete('settings-popup');\n\t\t}\n\t}\n\n\tgetSettingsPopup()\n\t{\n\t\treturn this.cache.remember('settings-popup', () => {\n\t\t\treturn new SettingsPopup(\n\t\t\t\tthis.getContainer().querySelector('.catalog-document-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\n\t\t\t\tthis.getSettingValue('popupSettings', []),\n\t\t\t\tthis\n\t\t\t);\n\t\t});\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.cache.remember('hint-popup', () => {\n\t\t\treturn new HintPopup(this);\n\t\t});\n\t}\n\n\tcreateGridProductRow(): BX.Grid.Row\n\t{\n\t\tconst newId = Text.getRandom();\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\n\n\t\tconst grid = this.getGrid();\n\t\tlet newRow;\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tnewRow = grid.appendRowEditor();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewRow = grid.prependRowEditor();\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tnewNode.setAttribute('data-id', newId);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\n\t\treturn newRow;\n\t}\n\n\thandleDeleteRow(rowId, event: BaseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tconst row = this.getProductByRowId(rowId);\n\t\tif (row)\n\t\t{\n\t\t\tthis.deleteRow(rowId);\n\t\t}\n\t}\n\n\tredefineTemplateEditData(newId: string)\n\t{\n\t\tconst data = this.getGridEditData();\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\n\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\n\n\t\treturn originalTemplateData;\n\t}\n\n\tprepareCustomEditData(originalEditData, newId)\n\t{\n\t\tconst customEditData = {};\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\n\t\t\t\t\t\tnewId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\n\t{\n\t\tlet fields = {};\n\t\tif (anchorProduct !== null)\n\t\t{\n\t\t\tfields = Object.assign(fields, anchorProduct?.getFields());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfields = {\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\n\t\t\t\t...{\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tconst rowId = this.getRowIdPrefix() + newId;\n\t\tfields.ID = newId;\n\t\tfields.ROW_ID = newId;\n\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t{\n\t\t\tdelete(fields.IMAGE_INFO.input);\n\t\t}\n\t\tconst product = new Row(\n\t\t\trowId,\n\t\t\tfields,\n\t\t\tthis.getSettingValue('rowSettings', {}),\n\t\t\tthis\n\t\t);\n\n\t\tif (anchorProduct instanceof Row)\n\t\t{\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\n\n\t\t\tproduct.refreshFieldsLayout();\n\t\t}\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tthis.products.push(product);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.products.unshift(product);\n\t\t}\n\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tproduct.updateUiCurrencyFields();\n\t\tthis.updateTotalUiCurrency();\n\n\t\treturn product;\n\t}\n\n\tgetProductSelector(newId: string): ?ProductSelector\n\t{\n\t\treturn this.getProductById(newId).getSelector();\n\t}\n\n\tfocusProductSelector(newId: string): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(newId)\n\t\t\t\t?.searchInDialog()\n\t\t\t\t.focusName()\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnBeforeProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst product = this.getProductByRowId(data.rowId);\n\t\tif (product)\n\t\t{\n\t\t\tthis.getGrid().tableFade();\n\t\t\tproduct.resetExternalActions();\n\t\t}\n\t}\n\n\thandleOnProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tconst productRow = this.getProductByRowId(data.rowId);\n\t\tif (productRow && data.fields)\n\t\t{\n\t\t\tdelete data.fields.ID;\n\t\t\tproductRow.setFields(data.fields);\n\t\t\tObject.keys(data.fields).forEach((key) => {\n\t\t\t\tproductRow.updateFieldValue(key, data.fields[key]);\n\t\t\t});\n\n\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\n\t\t\tproductRow.getSelector()?.layout();\n\t\t\tproductRow.getBarcodeSelector()?.layout();\n\t\t\tproductRow.updateProductStoreValues();\n\n\t\t\tproductRow.initHandlersForSelectors();\n\t\t\tproductRow.layoutStoreSelector(productRow.getSettingValue('storeHeaderMap', {}));\n\t\t\tproductRow.layoutBarcode();\n\t\t\tproductRow.executeExternalActions();\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t}\n\n\thandleOnProductClear(event: BaseEvent)\n\t{\n\t\tconst {selectorId, rowId} = event.getData();\n\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tif (product && product.getSelector().getId() === selectorId)\n\t\t{\n\t\t\tproduct.initHandlersForSelectors();\n\t\t\tproduct.setMeasure(this.getDefaultMeasure());\n\t\t\tproduct.changePurchasingPrice(0);\n\t\t\tproduct.changeBasePrice(0);\n\t\t\tproduct.changeAmount(0);\n\t\t\tproduct.updateUiStoreValues();\n\t\t\tproduct.updateProductStoreValues();\n\t\t\tproduct.changeBarcode('');\n\t\t\tproduct\n\t\t\t\t.getBarcodeSelector()\n\t\t\t\t?.setConfig('ENABLE_SEARCH', true)\n\t\t\t\t.layout()\n\t\t\t;\n\t\t\tproduct.executeExternalActions();\n\t\t}\n\t}\n\n\tcompileProductData(): void\n\t{\n\t\tif (!this.isExistForm())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.initFormFields();\n\n\t\tconst field = this.getDataField();\n\t\tconst settingsField = this.getDataSettingsField();\n\n\t\tthis.cleanProductRows();\n\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\n\t\t{\n\t\t\tfield.value = this.prepareProductDataValue();\n\t\t}\n\t}\n\n\tprepareProductDataValue(): string\n\t{\n\t\tlet productDataValue = '';\n\n\t\tif (this.getProductCount())\n\t\t{\n\t\t\tconst productData = [];\n\n\t\t\tthis.products.forEach((item) => {\n\t\t\t\tconst itemFields = item.getFields(Editor.#getAjaxFields());\n\n\t\t\t\tif (!/^[0-9]+$/.test(itemFields['ID']))\n\t\t\t\t{\n\t\t\t\t\titemFields['ID'] = 0;\n\t\t\t\t}\n\n\t\t\t\titemFields['CUSTOMIZED'] = 'Y';\n\n\t\t\t\tproductData.push(itemFields);\n\t\t\t});\n\n\t\t\tproductDataValue = JSON.stringify(productData);\n\t\t}\n\n\t\treturn productDataValue;\n\t}\n\n\tstatic #getAjaxFields(): []\n\t{\n\t\treturn [\n\t\t\t'ID',\n\t\t\t'SKU_ID',\n\t\t\t'AMOUNT',\n\t\t\t'PURCHASING_PRICE',\n\t\t\t'BASE_PRICE',\n\t\t\t'BASE_PRICE_EXTRA',\n\t\t\t'BASE_PRICE_EXTRA_RATE',\n\t\t\t'DOC_BARCODE',\n\t\t\t'BARCODE',\n\t\t\t'STORE_TO',\n\t\t\t'STORE_FROM',\n\t\t\t'BASE_PRICE_ID',\n\t\t\t'BASKET_ID',\n\t\t\t'DOC_ID',\n\t\t\t'ELEMENT_ID',\n\t\t\t'IBLOCK_ID',\n\t\t\t'MEASURE_CODE',\n\t\t\t'MEASURE_NAME',\n\t\t\t'NAME',\n\t\t\t'OFFERS_IBLOCK_ID',\n\t\t\t'PARENT_PRODUCT_ID',\n\t\t\t'PRODUCT_ID',\n\t\t\t'ROW_ID',\n\t\t\t'STORE_FROM_AMOUNT',\n\t\t\t'STORE_FROM_AVAILABLE_AMOUNT',\n\t\t\t'STORE_FROM_RESERVED',\n\t\t\t'STORE_FROM_TITLE',\n\t\t\t'STORE_TO_AMOUNT',\n\t\t\t'STORE_TO_AVAILABLE_AMOUNT',\n\t\t\t'STORE_TO_RESERVED',\n\t\t\t'STORE_TO_TITLE',\n\t\t\t'TOTAL_PRICE',\n\t\t\t'TYPE',\n\t\t];\n\t}\n\n\t/* actions */\n\texecuteActions(actions)\n\t{\n\t\tif (!Type.isArrayFilled(actions))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let item of actions)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(item)\n\t\t\t\t|| !Type.isStringFilled(item.type)\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (item.type)\n\t\t\t{\n\t\t\t\tcase this.actions.productChange:\n\t\t\t\t\tthis.actionSendProductChange(item);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.productListChanged:\n\t\t\t\t\tthis.actionSendProductListChanged();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateTotal:\n\t\t\t\t\tthis.actionUpdateTotalData();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tactionSendProductChange(item)\n\t{\n\t\tif (!Type.isStringFilled(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.getProductByRowId(item.id);\n\t\tif (!product)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// EventEmitter.emit(this, 'ProductList::onChangeFields', {\n\t\t// \trowId: item.id,\n\t\t// \tproductId: product.getField('PRODUCT_ID'),\n\t\t// \tfields: this.getProductByRowId(item.id).getCatalogFields()\n\t\t// });\n\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange();\n\t\t}\n\t}\n\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t}\n\t}\n\n\tactionUpdateListField(item)\n\t{\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateFieldForList = item.field;\n\n\t\tfor (let row of this.products)\n\t\t{\n\t\t\trow.updateFieldByName(item.field, item.value);\n\t\t}\n\n\t\tthis.updateFieldForList = null;\n\t}\n\n\tactionUpdateTotalData(options = {})\n\t{\n\t\tthis.updateTotalDataDelayedHandler(options);\n\t}\n\n\t/* actions finish */\n\n\tupdateTotalDataDelayed(options = {})\n\t{\n\t\tlet totalCost = 0;\n\t\tconst field = this.getSettingValue('totalCalculationSumField', 'PURCHASING_PRICE');\n\t\tthis.products.forEach(item => totalCost += Text.toNumber(item.getField(field)) * Text.toNumber(item.getField('AMOUNT')));\n\t\tthis.setTotalData({totalCost});\n\t}\n\n\tgetProductsFields(fields: Array = [])\n\t{\n\t\tconst productFields = [];\n\n\t\tfor (let item of this.products)\n\t\t{\n\t\t\tproductFields.push(item.getFields(fields));\n\t\t}\n\n\t\treturn productFields;\n\t}\n\n\tsetTotalData(data)\n\t{\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\tconst currencyId = this.getCurrencyId();\n\t\t\tconst list = ['totalCost'];\n\n\t\t\tfor (const id of list)\n\t\t\t{\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\n\t\t\t\t{\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.controller?.setTotal(data);\n\t}\n\n\t/* action tools finish */\n\n\t/* ajax tools */\n\t// ajaxRequest(action, data)\n\t// {\n\t// \tif (!Type.isPlainObject(data.options))\n\t// \t{\n\t// \t\tdata.options = {};\n\t// \t}\n\t// \tdata.options.ACTION = action;\n\t// \tajax.runComponentAction(\n\t// \t\tthis.getComponentName(),\n\t// \t\taction,\n\t// \t\t{\n\t// \t\t\tmode: 'class',\n\t// \t\t\tsignedParameters: this.getSignedParameters(),\n\t// \t\t\tdata: data\n\t// \t\t}\n\t// \t).then(\n\t// \t\t(response) => this.ajaxResultSuccess(response, data.options),\n\t// \t\t(response) => this.ajaxResultFailure(response)\n\t// \t);\n\t// }\n\t//\n\t// ajaxResultSuccess(response, requestOptions)\n\t// {\n\t// \tif (!this.ajaxResultCommonCheck(response))\n\t// \t{\n\t// \t\treturn;\n\t// \t}\n\t//\n\t// \tswitch (response.data.action)\n\t// \t{\n\t// \t\tcase 'calculateTotalData':\n\t// \t\t\t// if (Type.isPlainObject(response.data.result))\n\t// \t\t\t// {\n\t// \t\t\t// \tthis.setTotalData(response.data.result, requestOptions);\n\t// \t\t\t// }\n\t//\n\t// \t\t\tbreak;\n\t// \t\tcase 'calculateProductPrices':\n\t// \t\t\tif (Type.isPlainObject(response.data.result))\n\t// \t\t\t{\n\t// \t\t\t\tthis.onCalculatePricesResponse(response.data.result);\n\t// \t\t\t}\n\t//\n\t// \t\t\tbreak;\n\t// \t}\n\t// }\n\n\t// ajaxResultFailure(response)\n\t// {\n\t//\n\t// }\n\n\tajaxResultCommonCheck(responce)\n\t{\n\t\tif (!Type.isPlainObject(responce))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (responce.status !== 'success')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.data.action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection RedundantIfStatementJS\n\t\tif (!('result' in responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tdeleteRow(row: Row): void\n\t{\n\t\tconst gridRow = this.getGrid().getRows().getById(row.getField('ID'));\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t}\n\n\t\tconst index = this.products.indexOf(row);\n\t\tif (index > -1)\n\t\t{\n\t\t\tthis.products.splice(index, 1);\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.addFirstRowIfEmpty();\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcopyRow(row: Row): void\n\t{\n\t\tthis.addProductRow(row)\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcleanProductRows(): void\n\t{\n\t\tthis.products\n\t\t\t.filter(item => item.isEmptyRow())\n\t\t\t.forEach((row) => this.deleteRow(row))\n\t\t;\n\t}\n\n\tresortProductsByIds(ids: Array): boolean\n\t{\n\t\tlet changed = false;\n\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tthis.products.sort((a, b) => {\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tchanged = true;\n\n\t\t\t\treturn -1;\n\t\t\t});\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\trefreshSortFields(): void\n\t{\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10, false));\n\t}\n\n\thandleOnTabShow(): void\n\t{\n\t\tEventEmitter.emit('onDemandRecalculateWrapper', [this]);\n\t}\n\n\tcloseBarcodeSpotlights(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.removeSpotlight();\n\t\t})\n\n\t\tthis.setSettingValue('showBarcodeSpotlightInfo',false);\n\t}\n\n\tcloseBarcodeQrAuths(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.removeQrAuth();\n\t\t})\n\n\t\tthis.setSettingValue('showBarcodeQrAuth',false);\n\t}\n\n\tenableSendBarcodeMobilePush(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.setConfig('IS_INSTALLED_MOBILE_APP', true);\n\t\t})\n\n\t\tthis.setSettingValue('isInstalledMobileApp', true);\n\t}\n\n\tvalidate(): Array\n\t{\n\t\tif (this.getProductCount() === 0)\n\t\t{\n\t\t\treturn [Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_IS_EMPTY')];\n\t\t}\n\n\t\tlet errorsArray = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\terrorsArray = errorsArray.concat(product.validate());\n\t\t});\n\n\t\treturn errorsArray;\n\t}\n\n\tshowFieldTourHint(fieldName: string, tourData: Object, endTourHandler: Function, addictedFields: Array<string> = [], rowId: string = ''): void\n\t{\n\t\tif (this.products.length > 0)\n\t\t{\n\t\t\tlet productNode = this.products[0].getNode();\n\t\t\tif (this.getProductByRowId(rowId))\n\t\t\t{\n\t\t\t\tproductNode = this.getProductByRowId(rowId).getNode();\n\t\t\t}\n\n\t\t\tconst addictedNodes = [];\n\t\t\tfor (const fieldName of addictedFields)\n\t\t\t{\n\t\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\t\t\t\tif (fieldNode !== null)\n\t\t\t\t{\n\t\t\t\t\taddictedNodes.push(fieldNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\n\t\t\tif (fieldNode !== null)\n\t\t\t{\n\t\t\t\tthis.#fieldHintManager.processFieldTour(fieldNode, tourData, endTourHandler, addictedNodes);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\treturn this.#fieldHintManager.getActiveHint();\n\t}\n\n\tgetRestrictedProductTypes(): Array\n\t{\n\t\treturn this.getSettingValue('restrictedProductTypes', []);\n\t}\n}\n"],"names":["HintPopup","editor","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","setBindElement","adjustPosition","setContent","Tag","render","Text","encode","show","close","PriceCalculator","fields","basePrice","finalPrice","extra","extraType","EXTRA_TYPE_PERCENTAGE","toNumber","EXTRA_TYPE_MONETARY","Type","isNil","calculateBasePrice","calculateFinalPrice","AccessDeniedInput","options","Loc","getMessage","hint","isReadOnly","className","block","innerHTML","appendChild","BX","UI","Hint","createInstance","popupParameters","angle","offset","init","MODE_EDIT","MODE_SET","Row","id","settings","Cache","MemoryCache","EDIT","SET","Map","setId","setSettings","setEditor","setModel","initFields","getSettingValue","requestAnimationFrame","initHandlers","bind","cache","remember","rowId","getField","getEditorContainer","querySelector","mainSelector","barcodeSelector","isPlainObject","name","defaultValue","hasOwnProperty","value","getEditor","getContainer","getHintPopup","getNode","querySelectorAll","forEach","Event","changeProductFieldHandler","event","stopPropagation","selectorNames","storeFields","Object","keys","barcodeWrapper","renderTo","fieldNames","rowName","selectorId","storeSelectors","selector","storeWrapper","number","textContent","result","isArrayFilled","Runtime","clone","fieldName","realValues","call","getModel","setFields","setField","changeModel","field","fieldCode","target","type","checked","mode","updateField","resetExternalActions","updateFieldValue","executeExternalActions","code","changeProductId","changeBasePrice","changePurchasingPrice","changeAmount","changeMeasureCode","changeBarcode","changeStore","changeStoreName","changeProductName","changeSort","setTaxIncluded","preparedValue","parseInt","setProductId","menuItem","copyRow","menu","getMenuWindow","destroy","deleteRow","unsubscribeEvents","getBarcodeSelector","changeExtraType","getCurrencyText","calculator","calculateExtraType","changeExtra","getExtra","getFinalPrice","isDomNode","parseFloat","getPricePrecision","calculateExtra","setBasePrice","setPurchasingPrice","getQuantityPrecision","setAmount","getMeasures","filter","item","CODE","setMeasure","toString","isChangedValue","addActionProductChange","setStoreAmount","layoutStoreSelector","exceptFields","includes","updateUiField","updateUiMeasure","getSelector","reloadFileInput","layout","updateUiStoreValues","model","ProductModel","getById","currency","getCurrencyId","iblockId","basePriceId","skuTree","isStringFilled","JSON","parse","storeMap","isObject","getImageCollection","setPreview","setEditInput","setMorePhotoValues","setDetailPath","EventEmitter","subscribe","debounce","addActionUpdateTotal","Math","max","toFixed","updateRowTotalPrice","getAmount","getSkuId","storeHeaderMap","key","currentAmount","getStoreCollection","getStoreAmount","maxStore","getMaxFilledStore","storeSelector","StoreSelector","AMOUNT","onStoreSelect","STORE_ID","STORE_TITLE","amount","amounts","getStoreReserved","getStoreAvailableAmount","postfix","wrapper","updateUiInputField","measure","isEmpty","SYMBOL","showSaveNotifier","title","declineCancelTitle","events","onSave","save","onCancel","fieldId","getUiFieldId","document","getElementById","isElementNode","inputBlock","getInputByFieldName","parentNode","undefined","Reflection","getClass","Main","dropdownManager","dropdown","getValue","itemsContainer","getMenuItem","refresh","selectItem","dataset","span","updateUiMoneyField","html","currencyText","currencyId","currencyFieldNames","dropdownValues","push","NAME","VALUE","Dom","attr","uiName","getUiFieldName","uiType","getUiFieldType","util","number_format","CurrencyCore","currencyFormat","updateUiHtmlField","moneyFields","column","getColumnInfo","editable","TYPE","precision","getCommonPrecision","externalActions","length","action","addExternalAction","actions","productChange","updateTotal","executeActions","trim","getBasePrice","errorsList","actionCellContentContainer","actionsButton","menuItems","onclick","handleCopyAction","handleDeleteAction","PopupMenu","bindElement","items","preventDefault","append","selectorOptions","getIblockId","getBasePriceId","getCurrency","config","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","ENABLE_EMPTY_PRODUCT_ERROR","RESTRICTED_PRODUCT_TYPES","getRestrictedProductTypes","URL_BUILDER_CONTEXT","ProductSelector","mainInfoNode","numberSelector","selectorWrapper","inputFieldName","INPUT_FIELD_BARCODE","ENABLE_INFO_SPOTLIGHT","ENABLE_BARCODE_QR_AUTH","IS_INSTALLED_MOBILE_APP","ENABLE_SKU_TREE","scannerToken","layoutBarcode","inputFieldId","inputFieldTitle","data","getData","parsedValue","atob","e","console","error","isNumber","errors","getErrorCollection","getErrors","ErrorCodes","NOT_SELECTED_PRODUCT","layoutErrors","handleProductErrorsChange","getNameInputFilledValue","closeBarcodeSpotlights","closeBarcodeQrAuths","enableSendBarcodeMobilePush","validatorCallback","fieldInput","fieldWrapper","getInputWrapperByFieldName","valueAsNumber","validatingFields","get","set","classList","add","validator","eventObject","Boolean","unbind","remove","amountValue","isService","hiddenFields","columnIndexes","getGridColumnIndexes","columnIndex","fieldWithHintIndex","fieldWithHintNode","input","priceNode","contentNode","style","display","PageEventsManager","_settings","eventHandlers","eventName","eventHandler","addCustomEvent","eventParams","onCustomEvent","i","removeCustomEvent","SettingsPopup","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","getPopup","random","autoHide","draggable","offsetLeft","offsetTop","position","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","content","popupContainer","getContentContainer","isArray","columns","allColumnsExist","columnName","getGrid","getColumnHeaderCellByName","checkbox","settingId","descriptionNode","desc","setting","_classPrivateMethodGet","settingItem","settingEnabled","enabled","headers","cells","getRows","getHeadFirstChild","getCells","Array","from","header","ajax","runComponentAction","getComponentName","signedParameters","getSignedParameters","selected","currentHeaders","then","panel","setSettingValue","activePanel","changeActivePanelButtons","settingButton","reloadGrid","message","replace","category","Notification","Center","notify","stack","width","autoHideDelay","FieldHintManager","contentContainer","gridGetter","fieldNode","tourData","endTourHandler","addictedFieldNodes","fieldHintIsBusy","onClose","activeHintGuide","tourObject","gridContainer","leftArrow","rightArrow","fieldPos","getClientRects","x","gridPos","spotlight","Guide","observedNode","onSuccessVisionCallback","callbackParams","addictedNodes","observedNodes","observer","getScrollContainer","window","mainNode","nodesTuple","addictedNode","nodeRect","mainNodeTupleEl","sort","firstEl","secondEl","firstX","secondX","gridRect","widthIsValid","leftPos","rightPos","abs","lastEl","pop","shift","firstElDistance","lastElDistance","map","el","gridLeftEdge","gridRightEdge","fieldNodes","fieldRect","fieldLeftEdge","fieldRightEdge","targetNode","SpotLight","targetElement","autoSave","targetVertex","zIndex","container","pointerEvents","onCloseCallback","clickObserver","setTimeout","tourTarget","guide","steps","assign","onEvents","showNextStep","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","isEmptyObject","obj","Editor","productListChanged","updateListField","handleProductRowAdd","handleProductRowCreate","handleShowBarcodeSettingsPopup","handleShowSettingsPopup","handleOnSave","handleEditorSubmit","handleProductListFocus","handleOnBeforeGridRequest","handleOnGridUpdated","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnProductClear","handleDropdownChange","handleMobileScanEvent","handleFieldChange","updateTotalDataDelayed","getRandom","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","paintColumns","emit","subscribeDomEvents","subscribeCustomEvents","buttonBlock","addButton","productRowAddHandler","productRowCreateHandler","configButton","showSettingsPopupHandler","showBarcodeSettingsPopupHandler","selectButton","productSelectionPopupHandler","createButton","onSaveHandler","onEditorSubmit","onFocusToProductList","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onProductClearHandler","dropdownChangeHandler","onScanEmitHandler","unsubscribe","params","barcode","products","product","searchInput","getNameInput","activeElement","applyScannerData","newRowId","addProductRow","getProductById","productId","getProductSelector","onProductSelect","notification","getLastActiveSaveNotification","listHaveEmptyRows","isEmptyRow","focusProductSelector","panelCode","removeClass","addClass","hiddenPanelCode","removePanel","useProductsFromRequest","isInternalChanging","reloadTable","actionUpdateTotalData","getCompatData","grid","eventArgs","parent","getGridId","isNativeAction","url","getReloadUrl","method","sessid","bitrix_sessid","getProductsFields","isDeletingRequest","gridId","clearEditor","subscribeOnce","getSettingsPopup","updateCheckboxState","ids","changed","resortProductsByIds","refreshSortFields","numerateRows","componentId","pageEventsManager","initPageEventsManager","rows","current","isHeadChild","isTemplate","getEditData","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","unsubscribeDomEvents","unsubscribeCustomEvents","unbindAll","productSelector","setForm","clearController","controller","clearProductList","readOnly","loadCurrencyFormat","oldCurrencyId","setCurrencyId","setOption","getFields","onCalculatePricesResponse","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","response","updateUiCurrencyFields","updateTotalUiCurrency","totalBlock","row","format","getCurrencyFormat","FORMAT_STRING","getDataFieldName","isNumberValue","isStringValue","isNegative","indexOf","isNaN","dot","comma","s1","substr","decimalLength","round","factor","pow","getContainerId","formId","form","getForm","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","create","attrs","initFormField","getDataSettingsFieldName","getFormField","list","index","setRowNumber","Error","gridManager","getInstanceById","getHead","gridEditData","paintedColumns","cell","getCellById","arParams","EDITABLE_DATA","COLUMNS_ALL","disableSaveButton","enableSaveButton","closest","hasAttribute","getAttribute","getFieldCodeByGridCell","updateFieldByEvent","dropdownId","regExp","RegExp","getRowIdPrefix","matches","match","updateDropdownField","getProductByRowId","find","headRow","getCellNameByCellIndex","anchorProduct","createGridProductRow","newId","anchorRowNode","insertBefore","nextSibling","initializeNewProductRow","bindOnRowEvents","has","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","setAttribute","makeCountable","setOriginalTemplateEditData","adjustRows","updateCounterDisplayed","updateCounterSelected","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","CURRENCY","ID","IMAGE_INFO","splice","refreshFieldsLayout","unshift","searchInDialog","focusName","tableFade","productRow","isNew","updateProductStoreValues","initHandlersForSelectors","tableUnfade","getDefaultMeasure","setConfig","isExistForm","initFormFields","cleanProductRows","prepareProductDataValue","productDataValue","getProductCount","productData","itemFields","test","stringify","actionSendProductChange","actionSendProductListChanged","updateFieldForList","updateFieldByName","updateTotalDataDelayedHandler","totalCost","setTotalData","productFields","setTotal","responce","status","gridRow","reset","a","b","removeSpotlight","removeQrAuth","errorsArray","concat","validate","addictedFields","productNode","processFieldTour","getActiveHint","_clickOnRowActionsButton","hasErrors"],"mappings":"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"}