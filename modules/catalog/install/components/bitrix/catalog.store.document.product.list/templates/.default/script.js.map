{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/price.calculator.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}","import {Type, Text} from \"main.core\";\n\ntype PriceCalculatorFields = {\n\tbasePrice: number,\n\tfinalPrice: number,\n\textra: number | null,\n\textraType: PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n}\n\nexport class PriceCalculator\n{\n\tstatic EXTRA_TYPE_PERCENTAGE = 1;\n\tstatic EXTRA_TYPE_MONETARY = 2;\n\n\t#fields: PriceCalculatorFields = {\n\t\tbasePrice: 0,\n\t\tfinalPrice: 0,\n\t\textra: null,\n\t\textraType: PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n\t};\n\n\n\tconstructor(fields: PriceCalculatorFields): void\n\t{\n\t\tthis.#fields = {...this.#fields, ...fields};\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.#fields.basePrice;\n\t}\n\n\tgetFinalPrice(): number\n\t{\n\t\treturn this.#fields.finalPrice;\n\t}\n\n\tgetExtra(): number | null\n\t{\n\t\treturn this.#fields.extra;\n\t}\n\n\tgetExtraType(): PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE\n\t{\n\t\treturn this.#fields.extraType;\n\t}\n\n\tcalculateBasePrice(basePrice: number): PriceCalculator\n\t{\n\t\tthis.#fields.basePrice = basePrice;\n\t\tthis.#fields.extra = Text.toNumber(this.#fields.extra);\n\n\t\tif (this.#fields.extraType === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\tthis.#fields.finalPrice = this.#fields.basePrice + this.#fields.extra;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#fields.finalPrice = this.#fields.basePrice * (1 + this.#fields.extra / 100);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcalculateFinalPrice(finalPrice: number): PriceCalculator\n\t{\n\t\tthis.#fields.finalPrice = finalPrice;\n\t\tconst basePrice = Text.toNumber(this.#fields.basePrice);\n\n\t\tif (basePrice <= 0)\n\t\t{\n\t\t\tthis.#fields.extraType = PriceCalculator.EXTRA_TYPE_MONETARY;\n\t\t}\n\n\t\tif (this.#fields.extraType === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\tthis.#fields.extra = this.#fields.finalPrice - basePrice;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#fields.extra = (this.#fields.finalPrice / basePrice - 1) * 100;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcalculateExtra(extra: number): PriceCalculator\n\t{\n\t\tthis.#fields.extra = extra;\n\t\tif (Type.isNil(extra))\n\t\t{\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.calculateBasePrice(this.#fields.basePrice);\n\t}\n\n\tcalculateExtraType(extraType: PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE): PriceCalculator\n\t{\n\t\tif (extraType !== PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\textraType = PriceCalculator.EXTRA_TYPE_PERCENTAGE;\n\t\t}\n\n\t\tthis.#fields.extraType = extraType;\n\n\t\treturn this.calculateFinalPrice(this.#fields.finalPrice);\n\t}\n}","import {Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {Editor} from './product.list.editor';\nimport {CurrencyCore} from 'currency.currency-core';\nimport 'ui.hint';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {EventEmitter, BaseEvent} from \"main.core.events\";\nimport {ProductSelector} from \"catalog.product-selector\";\nimport {StoreSelector} from \"catalog.store-selector\";\nimport {PopupMenu} from \"main.popup\";\nimport {PriceCalculator} from \"./price.calculator\";\n\ntype Action = {\n\ttype: string,\n\tfield?: string,\n\tvalue?: string,\n};\n\ntype Settings = {}\n\nconst MODE_EDIT = 'EDIT';\nconst MODE_SET = 'SET';\nconst PRODUCT_TYPE_SET = 2;\n\nexport class Row\n{\n\tid: ?string;\n\tsettings: Object;\n\teditor: ?Editor\n\tmodel: ?ProductModel\n\tfields: Object = {};\n\tmainSelector: ?ProductSelector;\n\tbarcodeSelector: ?ProductSelector;\n\tstoreSelectors: Array<StoreSelector> = [];\n\texternalActions: Array<Action> = [];\n\tcache = new Cache.MemoryCache();\n\tmodeChanges = {\n\t\tEDIT: MODE_EDIT,\n\t\tSET: MODE_SET,\n\t};\n\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\n\t{\n\t\tthis.setId(id);\n\t\tthis.setSettings(settings);\n\t\tthis.setEditor(editor);\n\t\tthis.setModel(fields, settings);\n\t\tthis.initFields(fields);\n\t\tthis.#initSelector();\n\t\tthis.#initBarcode();\n\t\t// this.#initPriceExtra();\n\t\tthis.#initStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t\tthis.#initActions();\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('node', () => {\n\t\t\tconst rowId = this.getField('ID', 0);\n\n\t\t\treturn this.getEditorContainer().querySelector('[data-id=\"' + rowId + '\"]');\n\t\t});\n\t}\n\n\tgetSelector(): ?ProductSelector\n\t{\n\t\treturn this.mainSelector;\n\t}\n\n\tgetBarcodeSelector(): ?ProductSelector\n\t{\n\t\treturn this.barcodeSelector;\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id: string): void\n\t{\n\t\tthis.id = id;\n\t}\n\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings: Settings): void\n\t{\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\n\t}\n\n\tgetSettingValue(name, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value): void\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tsetEditor(editor: Editor): void\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tgetEditor(): Editor\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorContainer(): HTMLElement\n\t{\n\t\treturn this.getEditor().getContainer();\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.getEditor().getHintPopup();\n\t}\n\n\tinitHandlers()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for text fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for select fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t}\n\n\tinitHandlersForSelectors()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tlet selectorNames = ['MAIN_INFO', 'BARCODE_INFO'];\n\t\tconst storeFields = this.getSettingValue('storeHeaderMap', {});\n\t\tselectorNames = [...selectorNames, ...Object.keys(storeFields)];\n\n\t\tselectorNames.forEach((name) => {\n\t\t\tthis.getNode().querySelectorAll('[data-name=\"'+ name +'\"] input[type=\"text\"]').forEach(node => {\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t\t// disable drag-n-drop events for select fields\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\t});\n\t\t});\n\t}\n\n\t#initActions()\n\t{\n\t\tif (this.getEditor().isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tif (Type.isDomNode(actionCellContentContainer))\n\t\t{\n\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"#\"\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\n\t\t\t\t></a>\n\t\t\t`;\n\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\n\t\t\t\tconst menuItems = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_COPY_ACTION'),\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_DELETE_ACTION'),\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tPopupMenu.show({\n\t\t\t\t\tid: this.getId() + '_actions_popup',\n\t\t\t\t\tbindElement: actionsButton,\n\t\t\t\t\titems: menuItems\n\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\t#initSelector()\n\t{\n\t\tconst selectorOptions = {\n\t\t\tiblockId: this.model.getIblockId(),\n\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\tcurrency: this.model.getCurrency(),\n\t\t\tmodel: this.model,\n\t\t\tconfig: {\n\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: this.getSettingValue('isAllowedCreationProduct', true),\n\t\t\t\tENABLE_IMAGE_INPUT: true,\n\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\n\t\t\t\tROW_ID: this.getId(),\n\t\t\t\tENABLE_SKU_SELECTION: true,\n\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: true,\n\t\t\t\tRESTRICTED_PRODUCT_TYPES: [PRODUCT_TYPE_SET],\n\t\t\t},\n\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t};\n\n\t\tthis.mainSelector = new ProductSelector('catalog_document_grid_' + this.getId(), selectorOptions);\n\t\tconst mainInfoNode = this.getNode().querySelector('[data-name=\"MAIN_INFO\"]');\n\t\tif (mainInfoNode)\n\t\t{\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\n\t\t\tif (!Type.isDomNode(numberSelector))\n\t\t\t{\n\t\t\t\tmainInfoNode.appendChild(Tag.render`<div class=\"main-grid-row-number\"></div>`);\n\t\t\t}\n\n\t\t\tlet selectorWrapper =  mainInfoNode.querySelector('.main-grid-row-product-selector');\n\t\t\tif (!Type.isDomNode(selectorWrapper))\n\t\t\t{\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`\n\t\t\t\tmainInfoNode.appendChild(selectorWrapper)\n\t\t\t}\n\t\t\tthis.mainSelector.renderTo(selectorWrapper);\n\t\t}\n\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.mainSelector,\n\t\t\t'onBeforeCreate',\n\t\t\tthis.#handleBeforeCreateProduct.bind(this)\n\t\t);\n\t}\n\n\t#initBarcode()\n\t{\n\t\tconst selectorOptions = {\n\t\t\tiblockId: this.model.getIblockId(),\n\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\tcurrency: this.model.getCurrency(),\n\t\t\tmodel: this.model,\n\t\t\tinputFieldName: 'BARCODE',\n\t\t\ttype: ProductSelector.INPUT_FIELD_BARCODE,\n\t\t\tconfig: {\n\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: this.getSettingValue('isAllowedCreationProduct', true),\n\t\t\t\tENABLE_INFO_SPOTLIGHT: this.editor.getSettingValue('showBarcodeSpotlightInfo',true),\n\t\t\t\tENABLE_BARCODE_QR_AUTH: this.editor.getSettingValue('showBarcodeQrAuth',true),\n\t\t\t\tENABLE_IMAGE_INPUT: false,\n\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\tROW_ID: this.getId(),\n\t\t\t\tENABLE_SKU_SELECTION: false,\n\t\t\t\tENABLE_SKU_TREE: false,\n\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: false,\n\t\t\t\tRESTRICTED_PRODUCT_TYPES: [PRODUCT_TYPE_SET],\n\t\t\t},\n\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t\tscannerToken: this.getEditor().scannerToken,\n\t\t};\n\n\t\tthis.barcodeSelector = new ProductSelector('catalog_document_grid_' + this.getId() + '_barcode', selectorOptions);\n\t\tconst barcodeWrapper = this.getNode().querySelector('[data-name=\"BARCODE_INFO\"]');\n\t\tif (barcodeWrapper)\n\t\t{\n\t\t\tthis.barcodeSelector.renderTo(barcodeWrapper);\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBeforeCreate',\n\t\t\tthis.#handleBeforeCreateProduct.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onSpotlightClose',\n\t\t\tthis.#handleSpotlightClose.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeQrClose',\n\t\t\tthis.#handleBarcodeQrClose.bind(this)\n\t\t);\n\t}\n\n\t#initPriceExtra()\n\t{\n\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE\"]');\n\t\tif (!Type.isDomNode(node))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldExtraNode = node.querySelector('.catalog-store-extra-price');\n\t\tif (Type.isDomNode(oldExtraNode))\n\t\t{\n\t\t\toldExtraNode.parentNode.removeChild(oldExtraNode);\n\t\t}\n\n\t\tconst extraValue = this.getField('BASE_PRICE_EXTRA') ?? '';\n\t\tconst inputValue = Tag.render`\n\t\t\t<div>\n\t\t\t\t<input\n\t\t\t\t\tplaceholder=\"-\"\n\t\t\t\t\tclass=\"catalog-store-extra-price\"\n\t\t\t\t\tdata-name=\"BASE_PRICE_EXTRA\"\n\t\t\t\t\tvalue=\"${extraValue}\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst extraMeasureValue =\n\t\t\tthis.getField('BASE_PRICE_EXTRA_RATE') === PriceCalculator.EXTRA_TYPE_MONETARY\n\t\t\t\t? this.getEditor().getCurrencyText()\n\t\t\t\t: '%'\n\t\t;\n\n\t\tconst measureValue = Tag.render`\n\t\t\t<div class=\"main-grid-editor main-grid-editor-money-currency\">\n\t\t\t\t<span class=\"main-dropdown-inner\" data-name=\"BASE_PRICE_EXTRA_RATE\">${extraMeasureValue}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(measureValue, 'click', () => {\n\t\t\tconst menuItems = [\n\t\t\t\t{\n\t\t\t\t\ttext: '%',\n\t\t\t\t\tonclick: this.handleSelectExtraPriceType.bind(this),\n\t\t\t\t\ttype: PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: this.getEditor().getCurrencyText(),\n\t\t\t\t\tonclick: this.handleSelectExtraPriceType.bind(this),\n\t\t\t\t\ttype: PriceCalculator.EXTRA_TYPE_MONETARY,\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tPopupMenu.show({\n\t\t\t\tid: this.getId() + '_extra_type_popup',\n\t\t\t\tbindElement: measureValue,\n\t\t\t\titems: menuItems\n\t\t\t});\n\t\t});\n\n\t\tconst extraNode = Tag.render`\n\t\t\t<div class=\"main-grid-editor catalog-store-extra-price\">\n\t\t\t\t${inputValue}\n\t\t\t\t${measureValue}\n\t\t\t</div>\n\t\t`;\n\n\t\tnode.appendChild(extraNode);\n\t}\n\n\t#initStoreSelector(fieldNames: {})\n\t{\n\t\tObject.keys(fieldNames)\n\t\t\t.forEach( rowName => {\n\t\t\t\tconst selectorOptions = {\n\t\t\t\t\tinputFieldId: fieldNames[rowName],\n\t\t\t\t\tinputFieldTitle: fieldNames[rowName] + '_TITLE',\n\t\t\t\t\tconfig: {\n\t\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t\t},\n\t\t\t\t\tmode: StoreSelector.MODE_EDIT,\n\t\t\t\t\tmodel: this.model,\n\t\t\t\t};\n\n\t\t\t\tconst storeSelector = new StoreSelector(this.getId() + '_' + rowName, selectorOptions);\n\t\t\t\tconst storeWrapper = this.getNode().querySelector('[data-name=\"' + rowName + '\"]');\n\t\t\t\tif (storeSelector)\n\t\t\t\t{\n\t\t\t\t\tstoreSelector.renderTo(storeWrapper);\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.subscribe(\n\t\t\t\t\tstoreSelector,\n\t\t\t\t\t'onChange',\n\t\t\t\t\tRuntime.debounce(this.#onStoreFieldChange.bind(this), 500, this)\n\t\t\t\t);\n\n\t\t\t\tthis.storeSelectors.push(storeSelector);\n\t\t\t});\n\t}\n\n\t#onStoreFieldChange(event)\n\t{\n\t\tconst data = event.getData();\n\t\tdata.fields.forEach((item) => {\n\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t});\n\t}\n\n\tsetRowNumber(number)\n\t{\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach(node => {\n\t\t\tnode.textContent = number + '.';\n\t\t});\n\t}\n\n\tgetFields(fields: Array = [])\n\t{\n\t\tlet result;\n\n\t\tif (!Type.isArrayFilled(fields))\n\t\t{\n\t\t\tresult = Runtime.clone(this.fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\n\t\t\tfor (let fieldName of fields)\n\t\t\t{\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinitFields(fields: Object): void\n\t{\n\t\tthis.getModel().initFields(fields, false);\n\t\tthis.setFields(fields);\n\t}\n\n\tsetFields(fields: Object): void\n\t{\n\t\tfor (let name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value, changeModel: boolean = true): void\n\t{\n\t\tthis.fields[name] = value;\n\n\t\tif (changeModel)\n\t\t{\n\t\t\tthis.getModel().setField(name, value);\n\t\t}\n\t}\n\n\tgetUiFieldId(field): string\n\t{\n\t\treturn this.getId() + '_' + field;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tgetAmount(): number\n\t{\n\t\treturn this.getField('AMOUNT', 1);\n\t}\n\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\n\t{\n\t\tconst target = event.target;\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\tconst mode = (event.type === 'input' || event.type === 'change') ? MODE_EDIT : MODE_SET;\n\n\t\tthis.updateField(fieldCode, value, mode);\n\t}\n\n\tupdateDropdownField(fieldCode: string, value: any): void\n\t{\n\t\tthis.updateField(fieldCode, value, MODE_EDIT);\n\t}\n\n\tupdateField(fieldCode: string, value: any, mode = MODE_SET): void\n\t{\n\t\tthis.resetExternalActions();\n\t\tthis.updateFieldValue(fieldCode, value, mode);\n\t\tthis.executeExternalActions();\n\t}\n\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'SKU_ID':\n\t\t\t\tthis.changeProductId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tthis.changeBasePrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\t// case 'BASE_PRICE_EXTRA':\n\t\t\t// \tthis.changeExtra(value, mode);\n\t\t\t// \tbreak;\n\n\t\t\tcase 'PURCHASING_PRICE':\n\t\t\t\tthis.changePurchasingPrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'AMOUNT':\n\t\t\t\tthis.changeAmount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'MEASURE_CODE':\n\t\t\t\tthis.changeMeasureCode(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'BARCODE':\n\t\t\t\tthis.changeBarcode(value, mode);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_FROM':\n\t\t\tcase 'STORE_TO':\n\t\t\t\tthis.changeStore(value, code);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_FROM_TITLE':\n\t\t\tcase 'STORE_TO_TITLE':\n\t\t\t\tthis.changeStoreName(value, code);\n\t\t\t\tbreak;\n\t\t\tcase 'NAME':\n\t\t\tcase 'MAIN_INFO':\n\t\t\t\tthis.changeProductName(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SORT':\n\t\t\t\tthis.changeSort(value, mode);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateFieldByName(field, value)\n\t{\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.setTaxIncluded(value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tchangeProductId(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tthis.setProductId(preparedValue);\n\t}\n\n\thandleCopyAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.copyRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\thandleDeleteAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.deleteRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t\tthis.unsubscribeEvents();\n\n\t\tthis.#handleProductErrorsChange();\n\t}\n\n\tunsubscribeEvents()\n\t{\n\t\tthis.getBarcodeSelector().unsubscribeEvents();\n\t}\n\n\thandleSelectExtraPriceType(event, menuItem)\n\t{\n\t\tthis.changeExtraType(menuItem.type, MODE_EDIT);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\t#getCalculator()\n\t{\n\t\tconst extra =\n\t\t\tType.isNumber(this.getModel().getField('BASE_PRICE_EXTRA'))\n\t\t\t\t? this.getModel().getField('BASE_PRICE_EXTRA')\n\t\t\t\t: null\n\t\t;\n\n\t\treturn new PriceCalculator({\n\t\t\tbasePrice: Text.toNumber(this.getModel().getField('PURCHASING_PRICE')),\n\t\t\tfinalPrice: Text.toNumber(this.getModel().getField('BASE_PRICE')),\n\t\t\textra,\n\t\t\textraType: Text.toNumber(this.getModel().getField('BASE_PRICE_EXTRA_RATE')),\n\t\t});\n\t}\n\n\tchangeExtraType(value, mode = MODE_SET)\n\t{\n\t\tlet text = '%';\n\t\tif (value === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\ttext = this.getEditor().getCurrencyText();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvalue = PriceCalculator.EXTRA_TYPE_PERCENTAGE;\n\t\t}\n\n\t\tif (value === this.getField('BASE_PRICE_EXTRA_RATE'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst calculator =\n\t\t\t\tthis.#getCalculator()\n\t\t\t\t\t.calculateExtraType(value)\n\t\t\t;\n\n\t\t\tthis.changeExtra(calculator.getExtra());\n\t\t\tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t}\n\n\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE_EXTRA_RATE\"]');\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tnode.innerHTML = text;\n\t\t}\n\n\t\tthis.setField('BASE_PRICE_EXTRA_RATE', value);\n\t}\n\n\tchangeExtra(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = (Type.isNil(value) || value === '') ? null : this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setField('BASE_PRICE_EXTRA', preparedValue);\n\n\t\tif (preparedValue === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst calculator =\n\t\t\t\tthis.#getCalculator()\n\t\t\t\t\t.calculateExtra(preparedValue)\n\t\t\t;\n\n\t\t\tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE_EXTRA\"]');\n\t\t\tif (Type.isDomNode(node))\n\t\t\t{\n\t\t\t\tnode.value = preparedValue;\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeBasePrice(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setBasePrice(preparedValue, mode);\n\n\t\t// if (mode === MODE_EDIT)\n\t\t// {\n\t\t// \tconst calculator =\n\t\t// \t\tthis.#getCalculator()\n\t\t// \t\t\t.calculateFinalPrice(preparedValue)\n\t\t// \t;\n\t\t//\n\t\t// \tthis.changeExtra(calculator.getExtra());\n\t\t// \tthis.changeExtraType(calculator.getExtraType());\n\t\t// }\n\t}\n\n\tchangePurchasingPrice(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setPurchasingPrice(preparedValue, mode);\n\n\t\t// const currentExtra = this.getField('BASE_PRICE_EXTRA');\n\t\t// if (mode === MODE_EDIT && !Type.isNil(currentExtra) && currentExtra !== '')\n\t\t// {\n\t\t// \tconst calculator =\n\t\t// \t\tthis.#getCalculator()\n\t\t// \t\t\t.calculateBasePrice(preparedValue)\n\t\t// \t;\n\t\t//\n\t\t// \tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t// }\n\t}\n\n\tchangeAmount(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\n\t\tthis.setAmount(preparedValue, mode);\n\t}\n\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\n\t{\n\t\tthis\n\t\t\t.getEditor()\n\t\t\t.getMeasures()\n\t\t\t.filter((item) => item.CODE === value)\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\n\t\t;\n\t}\n\n\tchangeBarcode(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('BARCODE') !== preparedValue;\n\n\t\tif (isChangedValue && mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('BARCODE', preparedValue);\n\t\t\tthis.setField('DOC_BARCODE', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t\telse if (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.setField('DOC_BARCODE', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStore(value: number, code: string)\n\t{\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tconst isChangedValue = this.getField(code) !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField(code, preparedValue);\n\t\t\tthis.setStoreAmount(value, code);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStoreName(value: number, code: string)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tthis.setField(code, preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeProductName(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('NAME') !== preparedValue;\n\n\t\tif (isChangedValue && mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('NAME', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeSort(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('SORT', preparedValue);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\n\t{\n\t\tfor (let field in this.fields)\n\t\t{\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\n\t\t\t{\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\n\t\t\t}\n\t\t}\n\t\tthis.updateUiMeasure(\n\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\tthis.getField('MEASURE_NAME')\n\t\t)\n\t\tthis.getSelector()?.reloadFileInput();\n\t\tthis.getSelector()?.layout();\n\t\tthis.getBarcodeSelector()?.layout();\n\t\tthis.updateUiStoreValues();\n\t}\n\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\n\t{\n\t\tconst selectorId = 'catalog_document_grid_' + this.getId();\n\t\tif (selectorId)\n\t\t{\n\t\t\tconst model = ProductModel.getById(selectorId);\n\t\t\tif (model)\n\t\t\t{\n\t\t\t\tthis.model = model;\n\t\t\t}\n\t\t}\n\n\t\tif (!(this.model instanceof ProductModel))\n\t\t{\n\t\t\tthis.model = new ProductModel({\n\t\t\t\tid: selectorId,\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\n\t\t\t\tiblockId: fields['IBLOCK_ID'],\n\t\t\t\tbasePriceId: fields['BASE_PRICE_ID'],\n\t\t\t\tskuTree: Type.isStringFilled(fields['SKU_TREE']) ? JSON.parse(fields['SKU_TREE']) : null,\n\t\t\t\tstoreMap: fields['STORE_AMOUNT_MAP'],\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tif (Type.isObject(fields['IMAGE_INFO']))\n\t\t\t{\n\t\t\t\tthis.model.getImageCollection().setPreview(fields['IMAGE_INFO']['preview']);\n\t\t\t\tthis.model.getImageCollection().setEditInput(fields['IMAGE_INFO']['input']);\n\t\t\t\tthis.model.getImageCollection().setMorePhotoValues(fields['IMAGE_INFO']['values']);\n\t\t\t}\n\n\t\t\tif (!Type.isNil(fields['DETAIL_URL']))\n\t\t\t{\n\t\t\t\tthis.model.setDetailPath(fields['DETAIL_URL']);\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tRuntime.debounce(this.#handleProductErrorsChange, 500, this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.updateUiStoreValues.bind(this)\n\t\t);\n\t}\n\n\tgetModel(): ?ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\t#handleProductErrorsChange()\n\t{\n\t\tconst errors = this.getModel().getErrorCollection().getErrors();\n\t\tfor (const code in errors)\n\t\t{\n\t\t\tif (code === ProductSelector.ErrorCodes.NOT_SELECTED_PRODUCT)\n\t\t\t{\n\t\t\t\tthis.getSelector().layoutErrors();\n\t\t\t}\n\t\t}\n\n\t\tthis.getEditor().handleProductErrorsChange();\n\t}\n\n\t#handleBeforeCreateProduct(event: BaseEvent)\n\t{\n\t\tconst {model} = event.getData();\n\t\tmodel.setField('BARCODE', this.barcodeSelector.getNameInputFilledValue());\n\t\tmodel.setField('NAME', this.mainSelector.getNameInputFilledValue());\n\t}\n\n\t#handleSpotlightClose(event: BaseEvent): void\n\t{\n\t\tthis.editor.closeBarcodeSpotlights();\n\t}\n\n\t#handleBarcodeQrClose(event: BaseEvent): void\n\t{\n\t\tthis.editor.closeBarcodeQrAuths();\n\t}\n\n\tsetProductId(value)\n\t{\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_ID', value);\n\t\t\tthis.setField('SKU_ID', value);\n\n\t\t\tthis.updateUiStoreValues();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetBasePrice(value, mode = MODE_SET)\n\t{\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiField('BASE_PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\t\tthis.setField('BASE_PRICE', value);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\t}\n\n\tupdateProductStoreValues()\n\t{\n\t\tthis.storeSelectors.forEach((selector) => {\n\t\t\tselector.setProductId(this.getModel().getSkuId());\n\t\t});\n\t}\n\n\tupdateUiStoreValues()\n\t{\n\t\tconst storeHeaderMap = this.getSettingValue('storeHeaderMap', {});\n\t\tObject.keys(storeHeaderMap).forEach((key) => {\n\t\t\tconst fieldName = storeHeaderMap[key];\n\t\t\tlet value = this.getField(fieldName);\n\t\t\tif (fieldName === 'STORE_FROM')\n\t\t\t{\n\t\t\t\tconst currentAmount = this.model.getStoreCollection().getStoreAmount(value);\n\t\t\t\tif (currentAmount <= 0)\n\t\t\t\t{\n\t\t\t\t\tconst maxStore = this.model.getStoreCollection().getMaxFilledStore();\n\t\t\t\t\tconst storeSelector = StoreSelector.getById(this.getId() + '_' + key);\n\t\t\t\t\tif (maxStore.AMOUNT > currentAmount && storeSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tstoreSelector.onStoreSelect(maxStore.STORE_ID, maxStore.STORE_TITLE);\n\t\t\t\t\t\tvalue = maxStore.STORE_ID;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setStoreAmount(value, fieldName)\n\t\t});\n\t}\n\n\tsetStoreAmount(value, fieldName, mode = MODE_SET)\n\t{\n\t\t// price can't be less than zero\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tconst wrapper = this.getNode().querySelector('[data-name=' + fieldName + '_AMOUNT]');\n\t\t\tif (wrapper)\n\t\t\t{\n\t\t\t\tconst amount = this.model.getStoreCollection().getStoreAmount(value) || 0;\n\t\t\t\twrapper.innerHTML = amount + ' ' + Text.encode(this.getField('MEASURE_NAME'));\n\t\t\t}\n\t\t}\n\t}\n\n\tsetPurchasingPrice(value, mode = MODE_SET)\n\t{\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiField('PURCHASING_PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\t\tthis.setField('PURCHASING_PRICE', value);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\t}\n\n\tsetAmount(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('AMOUNT', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('AMOUNT') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('AMOUNT', value);\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetMeasure(measure, mode = MODE_SET)\n\t{\n\t\tif (this.model.isEmpty())\n\t\t{\n\t\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\t\t\tthis.updateUiMeasure(measure.CODE,\tmeasure.SYMBOL);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.getModel().showSaveNotifier(\n\t\t\t\t'measureChanger_' + this.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\n\t\t\t\t\tdeclineCancelTitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_DECLINE_SAVE'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\t\t\t\t\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\t\t\t\t\t\t\tthis.updateUiMeasure(\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_NAME')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\t\tthis.updateUiMeasure(\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_NAME')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateUiMeasure(measure.CODE,\tmeasure.SYMBOL);\n\t\t}\n\n\t\tthis.addActionProductChange();\n\t}\n\n\t// controls\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst fieldId = this.getUiFieldId(fieldName);\n\t\tlet item = document.getElementById(fieldId);\n\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\titem = this.getNode().querySelector('[name=\"' + fieldId + '\"]');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tupdateUiInputField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.value = value;\n\t\t}\n\t}\n\n\tupdateUiCheckboxField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.checked = value === 'Y';\n\t\t}\n\t}\n\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\n\t{\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.dropdownManager.getById(this.getId() + '_' + name + '_control');\n\t}\n\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\n\t{\n\t\tif (dropdown.getValue() === value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (dropdown.menu)\n\t\t{\n\t\t\tdropdown.menu.destroy();\n\t\t}\n\n\t\tconst item = dropdown.menu.itemsContainer.querySelector('[data-value=\"' + value + '\"]');\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\n\t\tif (menuItem)\n\t\t{\n\t\t\tdropdown.refresh(menuItem);\n\t\t\tdropdown.selectItem(menuItem);\n\t\t}\n\t}\n\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.dataset.value = value;\n\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\n\t\tif (!Type.isElementNode(span))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tspan.innerHTML = text;\n\t}\n\n\tupdateUiMeasure(code, name)\n\t{\n\t\tthis.updateUiMoneyField(\n\t\t\t'MEASURE_CODE',\n\t\t\tcode,\n\t\t\tText.encode(name)\n\t\t);\n\n\t\tthis.updateUiStoreValues();\n\t}\n\n\tupdateUiHtmlField(name, html)\n\t{\n\t\tconst item = this.getNode().querySelector('[data-name=\"' + name + '\"]');;\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.innerHTML = html;\n\t\t}\n\t}\n\n\tupdateUiCurrencyFields()\n\t{\n\t\tconst currencyText = this.getEditor().getCurrencyText();\n\t\tconst currencyId = '' + this.getEditor().getCurrencyId();\n\n\t\tconst currencyFieldNames = ['BASE_PRICE_CURRENCY', 'PURCHASING_PRICE_CURRENCY'];\n\t\tcurrencyFieldNames.forEach((name) => {\n\t\t\tconst dropdownValues = [];\n\t\t\tdropdownValues.push({\n\t\t\t\tNAME: currencyText,\n\t\t\t\tVALUE: currencyId,\n\t\t\t});\n\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\n\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\n\t\t});\n\t}\n\n\tupdateUiField(field, value): void\n\t{\n\t\tconst uiName = this.getUiFieldName(field);\n\t\tif (!uiName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst uiType = this.getUiFieldType(field);\n\t\tif (!uiType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (uiType)\n\t\t{\n\t\t\tcase 'input':\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money':\n\t\t\t\tvalue = BX.util.number_format(value, this.getPricePrecision(), \".\", \"\");\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money_html':\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetUiFieldName(field)\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'AMOUNT':\n\t\t\tcase 'MEASURE_CODE':\n\t\t\tcase 'BASE_PRICE':\n\t\t\tcase 'PURCHASING_PRICE':\n\t\t\t\tresult = field;\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetUiFieldType(field)\n\t{\n\t\tif (field === 'BASE_PRICE' || field === 'PURCHASING_PRICE')\n\t\t{\n\t\t\tconst column = this.getEditor()?.getColumnInfo(field);\n\t\t\tif (column?.editable?.TYPE === 'MONEY')\n\t\t\t{\n\t\t\t\treturn  'money';\n\t\t\t}\n\n\t\t\treturn  'money_html';\n\t\t}\n\t\telse if (field === 'AMOUNT')\n\t\t{\n\t\t\treturn  'input';\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// proxy\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\treturn this.getEditor().parseInt(value, defaultValue);\n\t}\n\n\tparseFloat(value: number | string, precision: number, defaultValue = 0)\n\t{\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\n\t}\n\n\tgetPricePrecision()\n\t{\n\t\treturn this.getEditor().getPricePrecision();\n\t}\n\n\tgetQuantityPrecision()\n\t{\n\t\treturn this.getEditor().getQuantityPrecision();\n\t}\n\n\tgetCommonPrecision()\n\t{\n\t\treturn this.getEditor().getCommonPrecision();\n\t}\n\n\tresetExternalActions()\n\t{\n\t\tthis.externalActions.length = 0;\n\t}\n\n\taddExternalAction(action: Action)\n\t{\n\t\tthis.externalActions.push(action);\n\t}\n\n\taddActionProductChange()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.productChange,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionUpdateTotal()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateTotal\n\t\t});\n\t}\n\n\texecuteExternalActions()\n\t{\n\t\tif (this.externalActions.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getEditor().executeActions(this.externalActions);\n\t\tthis.resetExternalActions();\n\t}\n\n\tisEmptyRow()\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('NAME', '').trim())\n\t\t\t&& this.model.isEmpty()\n\t\t\t&& this.getBasePrice() <= 0\n\t\t)\n\t}\n}\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import {Popup} from 'main.popup';\nimport {ajax, Cache, Event, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {Editor} from './product.list.editor';\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\t#getSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title\">${item.title}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.#getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.#requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\t#requestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tconst message = enabled\n\t\t\t\t? Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_ENABLED')\n\t\t\t\t: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_DISABLED');\n\n\t\t\tthis.#showNotification(message.replace('#NAME#', setting.title), {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}","import {ajax, Cache, Dom, Event, Reflection, Runtime, Text, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Row} from './product.list.row';\nimport {PageEventsManager} from './page.events.manager';\nimport SettingsPopup from './settings.button';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {ProductSelector} from 'catalog.product-selector';\nimport HintPopup from './hint.popup';\nimport ProductListController from \"catalog.document-card\";\nimport {ProductModel} from \"catalog.product-model\";\n\nconst GRID_TEMPLATE_ROW = 'template_0';\nconst DEFAULT_PRECISION: number = 2;\n\nexport class Editor\n{\n\tid: ?string;\n\tsettings: Object;\n\tcontroller: ?ProductListController;\n\tcontainer: ?HTMLElement;\n\tform: ?HTMLElement\n\tproducts: Row[] = [];\n\tproductsWasInitiated = false;\n\tpageEventsManager: PageEventsManager;\n\tcache = new Cache.MemoryCache();\n\n\tactions = {\n\t\tproductChange: 'productChange',\n\t\tproductListChanged: 'productListChanged',\n\t\tupdateListField: 'listField',\n\t\tupdateTotal: 'total'\n\t};\n\n\tupdateFieldForList = null;\n\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\n\tproductRowCreateHandler = this.handleProductRowCreate.bind(this);\n\tshowBarcodeSettingsPopupHandler = this.handleShowBarcodeSettingsPopup.bind(this);\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\n\n\tonSaveHandler = this.handleOnSave.bind(this);\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\n\tonScanEmitHandler = this.handleMobileScanEvent.bind(this);\n\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 100, this);\n\n\tconstructor(id)\n\t{\n\t\tthis.setId(id);\n\t}\n\n\tinit(config = {})\n\t{\n\t\tthis.setSettings(config);\n\n\t\tthis.scannerToken = this.scannerToken ?? Text.getRandom(16);\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.enableEdit();\n\t\t}\n\n\t\tthis.initForm();\n\t\tthis.initProducts();\n\t\tthis.initGridData();\n\t\tthis.paintColumns();\n\n\t\tEventEmitter.emit( 'DocumentProductListController', [this]);\n\n\t\tthis.#initSupportCustomRowActions();\n\t\tthis.subscribeDomEvents();\n\t\tthis.subscribeCustomEvents();\n\t}\n\n\tsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-create-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowCreateHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-barcode-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showBarcodeSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((createButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tcreateButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowCreateHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-barcode-settings-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tEventEmitter.subscribe('BarcodeScanner::onScanEmit', this.onScanEmitHandler);\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.unsubscribe('BX.UI.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.unsubscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tEventEmitter.unsubscribe('BarcodeScanner::onScanEmit', this.onScanEmitHandler);\n\t}\n\n\thandleMobileScanEvent(event: BaseEvent): void\n\t{\n\t\tconst params = event.getData();\n\t\tif (this.scannerToken !== params.id || !Type.isStringFilled(params.barcode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let product of this.products)\n\t\t{\n\t\t\tif (product.getBarcodeSelector()?.searchInput?.getNameInput() === document.activeElement)\n\t\t\t{\n\t\t\t\tproduct.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tfor (let product of this.products)\n\t\t{\n\t\t\tif (\n\t\t\t\tproduct.getBarcodeSelector()?.searchInput?.getNameInput().value === ''\n\t\t\t\t&& product.getSelector()?.searchInput?.getNameInput().value === ''\n\t\t\t)\n\t\t\t{\n\t\t\t\tproduct.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst newRowId = this.addProductRow();\n\t\tthis.getProductById(newRowId)?.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\t}\n\n\t#initSupportCustomRowActions()\n\t{\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\n\t}\n\n\tselectProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(id)\n\t\t\t\t?.onProductSelect(productId)\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnSave(event: BaseEvent)\n\t{\n\t\tconst notification = ProductModel.getLastActiveSaveNotification();\n\t\tif (notification)\n\t\t{\n\t\t\tnotification.close();\n\t\t}\n\n\t\tconst items = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\tconst item = {\n\t\t\t\tfields: {...product.fields},\n\t\t\t\trowId: product.fields.ROW_ID\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\n\t\tthis.setSettingValue('items', items);\n\t}\n\n\thandleEditorSubmit(event: BaseEvent)\n\t{\n\t}\n\n\tonInnerCancel()\n\t{\n\t\tthis.reloadGrid(false);\n\t}\n\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tconst activePanel = container.querySelector('.catalog-document-product-list-add-block-' + panelCode);\n\t\tif (Type.isDomNode(activePanel))\n\t\t{\n\t\t\tDom.removeClass(activePanel, 'catalog-document-product-list-add-block-hidden');\n\t\t\tDom.addClass(activePanel, 'catalog-document-product-list-add-block-active');\n\t\t}\n\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\n\t\tconst removePanel = container.querySelector('.catalog-document-product-list-add-block-' + hiddenPanelCode);\n\t\tif (Type.isDomNode(removePanel))\n\t\t{\n\t\t\tDom.addClass(removePanel, 'catalog-document-product-list-add-block-hidden');\n\t\t\tDom.removeClass(removePanel, 'catalog-document-product-list-add-block-active');\n\t\t}\n\n\t\treturn activePanel;\n\t}\n\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\n\t{\n\t\tif (isInternalChanging === null)\n\t\t{\n\t\t\tisInternalChanging = !useProductsFromRequest;\n\t\t}\n\n\t\tthis.getGrid().reloadTable(\n\t\t\t'POST',\n\t\t\t{useProductsFromRequest},\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging})\n\t\t);\n\t}\n\n\t/*\n\t\tkeep in mind different actions for this handler:\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t */\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\n\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields() : null,\n\t\t};\n\n\t\tlet isDeletingRequest = false;\n\t\tif (eventArgs.data['action_button_' + eventArgs.gridId] === 'delete')\n\t\t{\n\t\t\tisDeletingRequest = true;\n\t\t}\n\n\t\tthis.clearEditor();\n\n\t\tif (isNativeAction)\n\t\t{\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', (event) => {\n\t\t\t\tconst [grid] = event.getCompatData();\n\n\t\t\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.actionUpdateTotalData({isInternalChanging: false});\n\t\t\t\tif (isDeletingRequest)\n\t\t\t\t{\n\t\t\t\t\tthis.executeActions([\n\t\t\t\t\t\t{type: this.actions.productListChanged},\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\thandleOnGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSettingsPopup().updateCheckboxState();\n\t}\n\n\thandleOnGridRowMoved(event: BaseEvent)\n\t{\n\t\tconst [ids, , grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.resortProductsByIds(ids);\n\t\tif (changed)\n\t\t{\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\n\t\t}\n\t}\n\n\tinitPageEventsManager(): void\n\t{\n\t\tconst componentId = this.getSettingValue('componentId');\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\n\t}\n\n\tgetPageEventsManager(): PageEventsManager\n\t{\n\t\tif (!this.pageEventsManager)\n\t\t{\n\t\t\tthis.initPageEventsManager();\n\t\t}\n\n\t\treturn this.pageEventsManager;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.getSettingValue('allowEdit', false) === true;\n\t}\n\n\tenableEdit()\n\t{\n\t\t// Cannot use editSelected because checkboxes have been removed\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((current) => {\n\t\t\tif (!current.isHeadChild() && !current.isTemplate())\n\t\t\t{\n\t\t\t\tcurrent.edit();\n\t\t\t}\n\t\t});\n\t}\n\n\taddFirstRowIfEmpty(): void\n\t{\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\trequestAnimationFrame(() => this.addProductRow());\n\t\t}\n\t}\n\n\tclearEditor()\n\t{\n\t\tthis.unsubscribeProductsEvents();\n\n\t\tthis.products = [];\n\t\tthis.productsWasInitiated = false;\n\n\t\tthis.destroySettingsPopup();\n\t\tthis.unsubscribeDomEvents();\n\t\tthis.unsubscribeCustomEvents();\n\n\t\tEvent.unbindAll(this.container);\n\t}\n\n\twasProductsInitiated()\n\t{\n\t\treturn this.productsWasInitiated;\n\t}\n\n\tunsubscribeProductsEvents()\n\t{\n\t\tthis.products.forEach((current) => {\n\t\t\tconst productSelector = current.getSelector();\n\t\t\tif (productSelector)\n\t\t\t{\n\t\t\t\tproductSelector.unsubscribeEvents();\n\t\t\t}\n\t\t\tconst barcodeSelector = current.getBarcodeSelector();\n\t\t\tif (barcodeSelector)\n\t\t\t{\n\t\t\t\tbarcodeSelector.unsubscribeEvents();\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.setForm(null);\n\t\tthis.clearController();\n\t\tthis.clearEditor();\n\t}\n\n\tsetController(controller)\n\t{\n\t\tif (this.controller === controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.clearProductList();\n\t\t}\n\t\tthis.controller = controller;\n\t}\n\n\tclearController()\n\t{\n\t\tthis.controller = null;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\t/* settings tools */\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings)\n\t{\n\t\tthis.settings = settings ? settings : {};\n\t}\n\n\tgetSettingValue(name: string, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value)\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tgetComponentName()\n\t{\n\t\treturn this.getSettingValue('componentName', '');\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getSettingValue('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getSettingValue('signedParameters', '');\n\t}\n\n\tgetContainerId()\n\t{\n\t\treturn this.getSettingValue('containerId', '');\n\t}\n\n\tgetGridId(): string\n\t{\n\t\treturn this.getSettingValue('gridId', '');\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.getSettingValue('languageId', '');\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.getSettingValue('siteId', '');\n\t}\n\n\tgetCatalogId()\n\t{\n\t\treturn this.getSettingValue('catalogId', 0);\n\t}\n\n\tisReadOnly()\n\t{\n\t\treturn this.getSettingValue('readOnly', true);\n\t}\n\n\tsetReadOnly(readOnly)\n\t{\n\t\tthis.setSettingValue('readOnly', readOnly);\n\t}\n\n\tgetCurrencyId(): string\n\t{\n\t\treturn this.getSettingValue('currencyId', '');\n\t}\n\n\tsetCurrencyId(currencyId): Promise\n\t{\n\t\tthis.setSettingValue('currencyId', currencyId);\n\t\treturn CurrencyCore.loadCurrencyFormat(currencyId);\n\t}\n\n\tchangeCurrencyId(currencyId): void\n\t{\n\t\tconst oldCurrencyId = this.getCurrencyId();\n\t\tif (oldCurrencyId === currencyId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis\n\t\t\t.setCurrencyId(currencyId)\n\t\t\t.then(() => {\n\t\t\t\tconst products = [];\n\t\t\t\tthis.products.forEach((product) => {\n\t\t\t\t\tproduct.getModel().setOption('currency', currencyId);\n\t\t\t\t\tproducts.push({\n\t\t\t\t\t\tfields: product.getFields(),\n\t\t\t\t\t\tid: product.getId()\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tif (products.length > 0)\n\t\t\t\t{\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tthis.getComponentName(),\n\t\t\t\t\t\t'calculateProductPrices',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tproducts,\n\t\t\t\t\t\t\t\tcurrencyId,\n\t\t\t\t\t\t\t\toldCurrencyId,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t\t\t.then(this.onCalculatePricesResponse.bind(this));\n\t\t\t\t}\n\n\t\t\t\tconst editData = this.getGridEditData();\n\t\t\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\n\n\t\t\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\n\t\t\t\tconst templateFieldNames = ['BASE_PRICE', 'PURCHASING_PRICE'];\n\n\t\t\t\ttemplateFieldNames.forEach((field) => {\n\t\t\t\t\tif (templateRow[field] && templateRow[field]['CURRENCY'])\n\t\t\t\t\t{\n\t\t\t\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.setGridEditData(editData);\n\t\t\t});\n\t}\n\n\tonCalculatePricesResponse(response)\n\t{\n\t\tconst products = response.data;\n\t\tthis.products.forEach((product) => {\n\t\t\tif (Type.isObject(products[product.getId()]))\n\t\t\t{\n\t\t\t\tproduct.updateField('BASE_PRICE', products[product.getId()]['BASE_PRICE']);\n\t\t\t\tproduct.updateField('PURCHASING_PRICE', products[product.getId()]['PURCHASING_PRICE']);\n\t\t\t\tproduct.updateUiCurrencyFields();\n\t\t\t}\n\t\t});\n\n\t\tthis.updateTotalDataDelayed();\n\t\tthis.updateTotalUiCurrency();\n\t}\n\n\tupdateTotalUiCurrency()\n\t{\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(totalBlock))\n\t\t{\n\t\t\ttotalBlock.querySelectorAll('[data-role=\"currency-wrapper\"]').forEach((row) => {\n\t\t\t\trow.innerHTML = this.getCurrencyText();\n\t\t\t});\n\t\t}\n\t}\n\n\tgetCurrencyText(): string\n\t{\n\t\tconst currencyId = this.getCurrencyId();\n\t\tif (!Type.isStringFilled(currencyId))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || '';\n\t}\n\n\tgetDataFieldName()\n\t{\n\t\treturn this.getSettingValue('dataFieldName', '');\n\t}\n\n\tgetDataSettingsFieldName()\n\t{\n\t\tconst field = this.getDataFieldName();\n\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetMeasures(): []\n\t{\n\t\treturn this.getSettingValue('measures', []);\n\t}\n\n\tgetDefaultMeasure()\n\t{\n\t\treturn this.getSettingValue('defaultMeasure', {});\n\t}\n\n\tgetRowIdPrefix()\n\t{\n\t\treturn this.getSettingValue('rowIdPrefix', 'catalog_entity_product_list_');\n\t}\n\n\t/* settings tools finish */\n\n\t/* calculate tools */\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isNegative)\n\t\t\t\t{\n\t\t\t\t\tresult = -result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseInt(value, 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\n\t\t\tconst dot = value.indexOf('.');\n\t\t\tconst comma = value.indexOf(',');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\n\t\t\tif (dot < 0 && comma >= 0)\n\t\t\t{\n\t\t\t\tlet s1 = value.substr(0, comma);\n\t\t\t\tconst decimalLength = value.length - comma - 1;\n\n\t\t\t\tif (decimalLength > 0)\n\t\t\t\t{\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\n\t\t\t\t}\n\n\t\t\t\tvalue = s1;\n\t\t\t}\n\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\n\t\t\tresult = parseFloat(value);\n\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\tif (isNegative)\n\t\t\t{\n\t\t\t\tresult = -result;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseFloat(value);\n\t\t}\n\n\t\tif (precision >= 0)\n\t\t{\n\t\t\tresult = this.round(result, precision);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tround(value: number, precision: number = DEFAULT_PRECISION)\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\t/* calculate tools finish */\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.getElementById(this.getContainerId());\n\t\t});\n\t}\n\n\tinitForm()\n\t{\n\t\tconst formId = this.getSettingValue('formId', '');\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\n\n\t\tif (Type.isElementNode(form))\n\t\t{\n\t\t\tthis.setForm(form);\n\t\t}\n\t}\n\n\tisExistForm()\n\t{\n\t\treturn Type.isElementNode(this.getForm());\n\t}\n\n\tgetForm()\n\t{\n\t\treturn this.form;\n\t}\n\n\tsetForm(form)\n\t{\n\t\tthis.form = form;\n\t}\n\n\tinitFormFields()\n\t{\n\t\tconst container = this.getForm();\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tconst field = this.getDataField();\n\t\t\tif (!Type.isElementNode(field))\n\t\t\t{\n\t\t\t\tthis.initDataField();\n\t\t\t}\n\n\t\t\tconst settingsField = this.getDataSettingsField();\n\t\t\tif (!Type.isElementNode(settingsField))\n\t\t\t{\n\t\t\t\tthis.initDataSettingsField();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\tcontainer.appendChild(Dom.create(\n\t\t\t\t'input',\n\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\n\t\t\t));\n\t\t}\n\t}\n\n\tremoveFormFields()\n\t{\n\t\tconst field = this.getDataField();\n\t\tif (Type.isElementNode(field))\n\t\t{\n\t\t\tDom.remove(field);\n\t\t}\n\n\t\tconst settingsField = this.getDataSettingsField();\n\t\tif (Type.isElementNode(settingsField))\n\t\t{\n\t\t\tDom.remove(settingsField);\n\t\t}\n\t}\n\n\tinitDataField()\n\t{\n\t\tthis.initFormField(this.getDataFieldName());\n\t}\n\n\tinitDataSettingsField()\n\t{\n\t\tthis.initFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetDataField()\n\t{\n\t\treturn this.getFormField(this.getDataFieldName());\n\t}\n\n\tgetDataSettingsField()\n\t{\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetProductCount()\n\t{\n\t\treturn this.products\n\t\t\t.filter(item => !item.isEmptyRow())\n\t\t\t.length\n\t\t;\n\t}\n\n\tinitProducts()\n\t{\n\t\tconst list = this.getSettingValue('items', []);\n\n\t\tfor (let item of list)\n\t\t{\n\t\t\tconst fields = {...item.fields};\n\t\t\tthis.products.push(new Row(item.rowId, fields, this.getSettingValue('rowSettings', {}), this));\n\t\t}\n\n\t\tthis.numerateRows();\n\t\tthis.productsWasInitiated = true;\n\n\t\tthis.updateTotalDataDelayed();\n\t}\n\n\tnumerateRows()\n\t{\n\t\tthis.products.forEach((product, index) => {\n\t\t\tproduct.setRowNumber(index + 1);\n\t\t})\n\t}\n\n\tgetGrid(): ?BX.Main.Grid\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\tconst gridId = this.getGridId();\n\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\n\t\t\t}\n\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\n\t\t});\n\t}\n\n\tinitGridData()\n\t{\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\t}\n\n\tpaintColumns()\n\t{\n\t\tconst paintedColumns = this.getSettingValue('paintedColumns', null);\n\t\tconst grid = this.getGrid();\n\t\tif (grid && Type.isArray(paintedColumns))\n\t\t{\n\t\t\tpaintedColumns.forEach((columnName) => {\n\t\t\t\tconst rows = grid.getRows().getRows();\n\t\t\t\trows.forEach((current) => {\n\t\t\t\t\tconst cell = current.getCellById(columnName);\n\t\t\t\t\tif (cell)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(cell, 'main-grid-cell-light-blue-background');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\tgetColumnInfo(code: string)\n\t{\n\t\treturn this.getGrid()?.arParams?.COLUMNS_ALL[code] || {};\n\t}\n\n\tsetGridEditData(data: {})\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\thandleProductErrorsChange()\n\t{\n\t\tif (this.#childrenHasErrors())\n\t\t{\n\t\t\tthis.controller.disableSaveButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.controller.enableSaveButton();\n\t\t}\n\t}\n\n\t#childrenHasErrors()\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\n\t\t\t.length > 0\n\t\t\t;\n\t}\n\n\thandleFieldChange(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tif (row && row.hasAttribute('data-id'))\n\t\t{\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tlet fieldCode = event.target.getAttribute('data-name');\n\t\t\t\tif (!Type.isStringFilled(fieldCode))\n\t\t\t\t{\n\t\t\t\t\tconst cell = event.target.closest('td');\n\t\t\t\t\tfieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t\t\t}\n\n\t\t\t\tif (fieldCode)\n\t\t\t\t{\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleDropdownChange(event: BaseEvent)\n\t{\n\t\tconst [dropdownId, , , , value] = event.getData();\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\n\t\tconst matches = dropdownId.match(regExp);\n\t\tif (matches)\n\t\t{\n\t\t\tconst [, rowId, fieldCode] = matches;\n\t\t\tconst product = this.getProductById(rowId);\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tproduct.updateDropdownField(fieldCode, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProductById(id: string): ?Row\n\t{\n\t\tconst rowId = this.getRowIdPrefix() + id;\n\n\t\treturn this.getProductByRowId(rowId);\n\t}\n\n\tgetProductByRowId(rowId: string): ?Row\n\t{\n\t\treturn this.products.find((row: Row) => {\n\t\t\treturn row.getId() === rowId;\n\t\t});\n\t}\n\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\n\t{\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\n\t\t\tconst index = [...row.cells].indexOf(cell);\n\n\t\t\treturn headRow.getCellNameByCellIndex(index);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddProductRow(anchorProduct: Row = null): string\n\t{\n\t\tconst row = this.createGridProductRow();\n\t\tconst newId = row.getId();\n\n\t\tif (anchorProduct)\n\t\t{\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\n\t\t\tif (anchorRowNode)\n\t\t\t{\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\n\t\t\t}\n\t\t}\n\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\n\t\tthis.getGrid().bindOnRowEvents();\n\t\treturn newId;\n\t}\n\n\thandleProductRowAdd(): void\n\t{\n\t\tconst id = this.addProductRow();\n\t\tthis.focusProductSelector(id);\n\t}\n\n\thandleProductRowCreate(): void\n\t{\n\t}\n\n\thandleShowBarcodeSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\thandleShowSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\tdestroySettingsPopup()\n\t{\n\t\tif (this.cache.has('settings-popup'))\n\t\t{\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\n\t\t\tthis.cache.delete('settings-popup');\n\t\t}\n\t}\n\n\tgetSettingsPopup()\n\t{\n\t\treturn this.cache.remember('settings-popup', () => {\n\t\t\treturn new SettingsPopup(\n\t\t\t\tthis.getContainer().querySelector('.catalog-document-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\n\t\t\t\tthis.getSettingValue('popupSettings', []),\n\t\t\t\tthis\n\t\t\t);\n\t\t});\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.cache.remember('hint-popup', () => {\n\t\t\treturn new HintPopup(this);\n\t\t});\n\t}\n\n\tcreateGridProductRow(): BX.Grid.Row\n\t{\n\t\tconst newId = Text.getRandom();\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\n\n\t\tconst grid = this.getGrid();\n\t\tlet newRow;\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tnewRow = grid.appendRowEditor();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewRow = grid.prependRowEditor();\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tnewNode.setAttribute('data-id', newId);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\n\t\treturn newRow;\n\t}\n\n\thandleDeleteRow(rowId, event: BaseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tconst row = this.getProductByRowId(rowId);\n\t\tif (row)\n\t\t{\n\t\t\tthis.deleteRow(rowId);\n\t\t}\n\t}\n\n\tredefineTemplateEditData(newId: string)\n\t{\n\t\tconst data = this.getGridEditData();\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\n\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\n\n\t\treturn originalTemplateData;\n\t}\n\n\tprepareCustomEditData(originalEditData, newId)\n\t{\n\t\tconst customEditData = {};\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\n\t\t\t\t\t\tnewId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\n\t{\n\t\tlet fields = {};\n\t\tif (anchorProduct !== null)\n\t\t{\n\t\t\tfields = Object.assign(fields, anchorProduct?.getFields());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfields = {\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\n\t\t\t\t...{\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tconst rowId = this.getRowIdPrefix() + newId;\n\t\tfields.ID = newId;\n\t\tfields.ROW_ID = newId;\n\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t{\n\t\t\tdelete(fields.IMAGE_INFO.input);\n\t\t}\n\t\tconst product = new Row(\n\t\t\trowId,\n\t\t\tfields,\n\t\t\tthis.getSettingValue('rowSettings', {}),\n\t\t\tthis\n\t\t);\n\n\t\tif (anchorProduct instanceof Row)\n\t\t{\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\n\n\t\t\tproduct.refreshFieldsLayout();\n\t\t}\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tthis.products.push(product);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.products.unshift(product);\n\t\t}\n\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tproduct.updateUiCurrencyFields();\n\t\tthis.updateTotalUiCurrency();\n\n\t\treturn product;\n\t}\n\n\tgetProductSelector(newId: string): ?ProductSelector\n\t{\n\t\treturn this.getProductById(newId).getSelector();\n\t}\n\n\tfocusProductSelector(newId: string): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(newId)\n\t\t\t\t?.searchInDialog()\n\t\t\t\t.focusName()\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnBeforeProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst product = this.getProductByRowId(data.rowId);\n\t\tif (product)\n\t\t{\n\t\t\tthis.getGrid().tableFade();\n\t\t\tproduct.resetExternalActions();\n\t\t}\n\t}\n\n\thandleOnProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tconst productRow = this.getProductByRowId(data.rowId);\n\t\tif (productRow && data.fields)\n\t\t{\n\t\t\tdelete data.fields.ID;\n\t\t\tproductRow.setFields(data.fields);\n\t\t\tObject.keys(data.fields).forEach((key) => {\n\t\t\t\tproductRow.updateFieldValue(key, data.fields[key]);\n\t\t\t});\n\n\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\n\t\t\tproductRow.getSelector()?.layout();\n\t\t\tproductRow.getBarcodeSelector()?.layout();\n\t\t\tproductRow.updateProductStoreValues();\n\n\t\t\tproductRow.initHandlersForSelectors();\n\t\t\tproductRow.executeExternalActions();\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t}\n\n\thandleOnProductClear(event: BaseEvent)\n\t{\n\t\tconst {selectorId, rowId} = event.getData();\n\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tif (product && product.getSelector().getId() === selectorId)\n\t\t{\n\t\t\tproduct.initHandlersForSelectors();\n\t\t\tproduct.setMeasure(this.getDefaultMeasure());\n\t\t\tproduct.changePurchasingPrice(0);\n\t\t\tproduct.changeBasePrice(0);\n\t\t\tproduct.changeAmount(0);\n\t\t\tproduct.updateUiStoreValues();\n\t\t\tproduct.updateProductStoreValues();\n\t\t\tproduct.changeBarcode('');\n\t\t\tproduct\n\t\t\t\t.getBarcodeSelector()\n\t\t\t\t?.setConfig('ENABLE_SEARCH', true)\n\t\t\t\t.layout()\n\t\t\t;\n\t\t\tproduct.executeExternalActions();\n\t\t}\n\t}\n\n\tcompileProductData(): void\n\t{\n\t\tif (!this.isExistForm())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.initFormFields();\n\n\t\tconst field = this.getDataField();\n\t\tconst settingsField = this.getDataSettingsField();\n\n\t\tthis.cleanProductRows();\n\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\n\t\t{\n\t\t\tfield.value = this.prepareProductDataValue();\n\t\t}\n\t}\n\n\tprepareProductDataValue(): string\n\t{\n\t\tlet productDataValue = '';\n\n\t\tif (this.getProductCount())\n\t\t{\n\t\t\tconst productData = [];\n\n\t\t\tthis.products.forEach((item) => {\n\t\t\t\tconst itemFields = item.getFields();\n\n\t\t\t\tif (!/^[0-9]+$/.test(itemFields['ID']))\n\t\t\t\t{\n\t\t\t\t\titemFields['ID'] = 0;\n\t\t\t\t}\n\n\t\t\t\titemFields['CUSTOMIZED'] = 'Y';\n\n\t\t\t\tproductData.push(itemFields);\n\t\t\t});\n\n\t\t\tproductDataValue = JSON.stringify(productData);\n\t\t}\n\n\t\treturn productDataValue;\n\t}\n\n\t/* actions */\n\texecuteActions(actions)\n\t{\n\t\tif (!Type.isArrayFilled(actions))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let item of actions)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(item)\n\t\t\t\t|| !Type.isStringFilled(item.type)\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (item.type)\n\t\t\t{\n\t\t\t\tcase this.actions.productChange:\n\t\t\t\t\tthis.actionSendProductChange(item);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.productListChanged:\n\t\t\t\t\tthis.actionSendProductListChanged();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateTotal:\n\t\t\t\t\tthis.actionUpdateTotalData();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tactionSendProductChange(item)\n\t{\n\t\tif (!Type.isStringFilled(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.getProductByRowId(item.id);\n\t\tif (!product)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// EventEmitter.emit(this, 'ProductList::onChangeFields', {\n\t\t// \trowId: item.id,\n\t\t// \tproductId: product.getField('PRODUCT_ID'),\n\t\t// \tfields: this.getProductByRowId(item.id).getCatalogFields()\n\t\t// });\n\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange();\n\t\t}\n\t}\n\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t}\n\t}\n\n\tactionUpdateListField(item)\n\t{\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateFieldForList = item.field;\n\n\t\tfor (let row of this.products)\n\t\t{\n\t\t\trow.updateFieldByName(item.field, item.value);\n\t\t}\n\n\t\tthis.updateFieldForList = null;\n\t}\n\n\tactionUpdateTotalData(options = {})\n\t{\n\t\tthis.updateTotalDataDelayedHandler(options);\n\t}\n\n\t/* actions finish */\n\n\tupdateTotalDataDelayed(options = {})\n\t{\n\t\tlet totalCost = 0;\n\t\tconst field = this.getSettingValue('totalCalculationSumField', 'PURCHASING_PRICE');\n\t\tthis.products.forEach(item => totalCost += Text.toNumber(item.getField(field)) * Text.toNumber(item.getField('AMOUNT')));\n\t\tthis.setTotalData({totalCost});\n\t}\n\n\tgetProductsFields(fields: Array = [])\n\t{\n\t\tconst productFields = [];\n\n\t\tfor (let item of this.products)\n\t\t{\n\t\t\tproductFields.push(item.getFields(fields));\n\t\t}\n\n\t\treturn productFields;\n\t}\n\n\tsetTotalData(data)\n\t{\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\tconst currencyId = this.getCurrencyId();\n\t\t\tconst list = ['totalCost'];\n\n\t\t\tfor (const id of list)\n\t\t\t{\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\n\t\t\t\t{\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.controller?.setTotal(data);\n\t}\n\n\t/* action tools finish */\n\n\t/* ajax tools */\n\t// ajaxRequest(action, data)\n\t// {\n\t// \tif (!Type.isPlainObject(data.options))\n\t// \t{\n\t// \t\tdata.options = {};\n\t// \t}\n\t// \tdata.options.ACTION = action;\n\t// \tajax.runComponentAction(\n\t// \t\tthis.getComponentName(),\n\t// \t\taction,\n\t// \t\t{\n\t// \t\t\tmode: 'class',\n\t// \t\t\tsignedParameters: this.getSignedParameters(),\n\t// \t\t\tdata: data\n\t// \t\t}\n\t// \t).then(\n\t// \t\t(response) => this.ajaxResultSuccess(response, data.options),\n\t// \t\t(response) => this.ajaxResultFailure(response)\n\t// \t);\n\t// }\n\t//\n\t// ajaxResultSuccess(response, requestOptions)\n\t// {\n\t// \tif (!this.ajaxResultCommonCheck(response))\n\t// \t{\n\t// \t\treturn;\n\t// \t}\n\t//\n\t// \tswitch (response.data.action)\n\t// \t{\n\t// \t\tcase 'calculateTotalData':\n\t// \t\t\t// if (Type.isPlainObject(response.data.result))\n\t// \t\t\t// {\n\t// \t\t\t// \tthis.setTotalData(response.data.result, requestOptions);\n\t// \t\t\t// }\n\t//\n\t// \t\t\tbreak;\n\t// \t\tcase 'calculateProductPrices':\n\t// \t\t\tif (Type.isPlainObject(response.data.result))\n\t// \t\t\t{\n\t// \t\t\t\tthis.onCalculatePricesResponse(response.data.result);\n\t// \t\t\t}\n\t//\n\t// \t\t\tbreak;\n\t// \t}\n\t// }\n\n\t// ajaxResultFailure(response)\n\t// {\n\t//\n\t// }\n\n\tajaxResultCommonCheck(responce)\n\t{\n\t\tif (!Type.isPlainObject(responce))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (responce.status !== 'success')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.data.action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection RedundantIfStatementJS\n\t\tif (!('result' in responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tdeleteRow(row: Row): void\n\t{\n\t\tconst gridRow = this.getGrid().getRows().getById(row.getField('ID'));\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t}\n\n\t\tconst index = this.products.indexOf(row);\n\t\tif (index > -1)\n\t\t{\n\t\t\tthis.products.splice(index, 1);\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.addFirstRowIfEmpty();\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcopyRow(row: Row): void\n\t{\n\t\tthis.addProductRow(row)\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcleanProductRows(): void\n\t{\n\t\tthis.products\n\t\t\t.filter(item => item.isEmptyRow())\n\t\t\t.forEach((row) => this.deleteRow(row))\n\t\t;\n\t}\n\n\tresortProductsByIds(ids: Array): boolean\n\t{\n\t\tlet changed = false;\n\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tthis.products.sort((a, b) => {\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tchanged = true;\n\n\t\t\t\treturn -1;\n\t\t\t});\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\trefreshSortFields(): void\n\t{\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10, false));\n\t}\n\n\thandleOnTabShow(): void\n\t{\n\t\tEventEmitter.emit('onDemandRecalculateWrapper');\n\t}\n\n\tcloseBarcodeSpotlights(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.removeSpotlight();\n\t\t})\n\n\t\tthis.setSettingValue('showBarcodeSpotlightInfo',false);\n\t}\n\n\tcloseBarcodeQrAuths(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.removeQrAuth();\n\t\t})\n\n\t\tthis.setSettingValue('showBarcodeQrAuth',false);\n\t}\n}\n"],"names":["HintPopup","editor","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","setBindElement","adjustPosition","setContent","Tag","render","Text","encode","show","close","PriceCalculator","fields","basePrice","finalPrice","extra","extraType","EXTRA_TYPE_PERCENTAGE","toNumber","EXTRA_TYPE_MONETARY","Type","isNil","calculateBasePrice","calculateFinalPrice","MODE_EDIT","MODE_SET","PRODUCT_TYPE_SET","Row","id","settings","Cache","MemoryCache","EDIT","SET","setId","setSettings","setEditor","setModel","initFields","getSettingValue","requestAnimationFrame","initHandlers","bind","cache","remember","rowId","getField","getEditorContainer","querySelector","mainSelector","barcodeSelector","isPlainObject","name","defaultValue","hasOwnProperty","value","getEditor","getContainer","getHintPopup","getNode","querySelectorAll","forEach","Event","changeProductFieldHandler","event","stopPropagation","selectorNames","storeFields","Object","keys","number","textContent","result","isArrayFilled","Runtime","clone","fieldName","getModel","setFields","setField","changeModel","field","fieldCode","target","type","checked","mode","updateField","resetExternalActions","updateFieldValue","executeExternalActions","code","changeProductId","changeBasePrice","changePurchasingPrice","changeAmount","changeMeasureCode","changeBarcode","changeStore","changeStoreName","changeProductName","changeSort","setTaxIncluded","preparedValue","parseInt","setProductId","menuItem","copyRow","menu","getMenuWindow","destroy","deleteRow","unsubscribeEvents","getBarcodeSelector","changeExtraType","getCurrencyText","calculator","calculateExtraType","changeExtra","getExtra","getFinalPrice","isDomNode","innerHTML","parseFloat","getPricePrecision","calculateExtra","setBasePrice","setPurchasingPrice","getQuantityPrecision","setAmount","getMeasures","filter","item","CODE","setMeasure","toString","isChangedValue","addActionProductChange","setStoreAmount","exceptFields","includes","updateUiField","updateUiMeasure","getSelector","reloadFileInput","layout","updateUiStoreValues","selectorId","model","ProductModel","getById","currency","getCurrencyId","iblockId","basePriceId","skuTree","isStringFilled","JSON","parse","storeMap","isObject","getImageCollection","setPreview","setEditInput","setMorePhotoValues","setDetailPath","EventEmitter","subscribe","debounce","addActionUpdateTotal","Math","max","toFixed","storeSelectors","selector","getSkuId","storeHeaderMap","key","currentAmount","getStoreCollection","getStoreAmount","maxStore","getMaxFilledStore","storeSelector","StoreSelector","AMOUNT","onStoreSelect","STORE_ID","STORE_TITLE","wrapper","amount","updateUiInputField","measure","isEmpty","SYMBOL","showSaveNotifier","title","Loc","getMessage","declineCancelTitle","events","onSave","save","onCancel","fieldId","getUiFieldId","document","getElementById","isElementNode","getInputByFieldName","Reflection","getClass","BX","Main","dropdownManager","dropdown","getValue","itemsContainer","getMenuItem","refresh","selectItem","dataset","span","updateUiMoneyField","html","currencyText","currencyId","currencyFieldNames","dropdownValues","push","NAME","VALUE","Dom","attr","uiName","getUiFieldName","uiType","getUiFieldType","util","number_format","CurrencyCore","currencyFormat","updateUiHtmlField","column","getColumnInfo","editable","TYPE","precision","getCommonPrecision","externalActions","length","action","addExternalAction","actions","productChange","updateTotal","executeActions","trim","getBasePrice","isReadOnly","actionCellContentContainer","actionsButton","menuItems","onclick","handleCopyAction","handleDeleteAction","PopupMenu","bindElement","items","preventDefault","append","selectorOptions","getIblockId","getBasePriceId","getCurrency","config","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","ENABLE_EMPTY_PRODUCT_ERROR","RESTRICTED_PRODUCT_TYPES","ProductSelector","mainInfoNode","numberSelector","appendChild","selectorWrapper","renderTo","inputFieldName","INPUT_FIELD_BARCODE","ENABLE_INFO_SPOTLIGHT","ENABLE_BARCODE_QR_AUTH","ENABLE_SKU_TREE","scannerToken","barcodeWrapper","fieldNames","rowName","inputFieldId","inputFieldTitle","storeWrapper","data","getData","isNumber","errors","getErrorCollection","getErrors","ErrorCodes","NOT_SELECTED_PRODUCT","layoutErrors","handleProductErrorsChange","getNameInputFilledValue","closeBarcodeSpotlights","closeBarcodeQrAuths","PageEventsManager","_settings","eventHandlers","eventName","eventHandler","addCustomEvent","eventParams","onCustomEvent","i","removeCustomEvent","SettingsPopup","getPopup","random","autoHide","draggable","offsetLeft","offsetTop","angle","position","offset","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","content","popupContainer","getContentContainer","isArray","columns","allColumnsExist","columnName","getGrid","getColumnHeaderCellByName","checkbox","input","settingId","descriptionNode","desc","setting","_classPrivateMethodGet","settingItem","settingEnabled","enabled","headers","cells","getRows","getHeadFirstChild","getCells","Array","from","header","ajax","runComponentAction","getComponentName","signedParameters","getSignedParameters","selected","currentHeaders","then","panel","setSettingValue","activePanel","changeActivePanelButtons","settingButton","reloadGrid","message","replace","category","options","UI","Notification","Center","notify","stack","width","autoHideDelay","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","Editor","productListChanged","updateListField","handleProductRowAdd","handleProductRowCreate","handleShowBarcodeSettingsPopup","handleShowSettingsPopup","handleOnSave","handleEditorSubmit","handleOnBeforeGridRequest","handleOnGridUpdated","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnProductClear","handleDropdownChange","handleMobileScanEvent","handleFieldChange","updateTotalDataDelayed","getRandom","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","paintColumns","emit","subscribeDomEvents","subscribeCustomEvents","container","addButton","productRowAddHandler","productRowCreateHandler","configButton","showSettingsPopupHandler","showBarcodeSettingsPopupHandler","selectButton","unbind","productSelectionPopupHandler","createButton","onSaveHandler","onEditorSubmit","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onProductClearHandler","dropdownChangeHandler","onScanEmitHandler","unsubscribe","params","barcode","products","product","searchInput","getNameInput","activeElement","applyScannerData","newRowId","addProductRow","getProductById","productId","getProductSelector","onProductSelect","notification","getLastActiveSaveNotification","panelCode","removeClass","addClass","hiddenPanelCode","removePanel","useProductsFromRequest","isInternalChanging","reloadTable","actionUpdateTotalData","getCompatData","grid","eventArgs","parent","getGridId","isNativeAction","url","getReloadUrl","method","sessid","bitrix_sessid","getProductsFields","isDeletingRequest","gridId","clearEditor","subscribeOnce","getSettingsPopup","updateCheckboxState","ids","changed","resortProductsByIds","refreshSortFields","numerateRows","componentId","pageEventsManager","initPageEventsManager","rows","current","isHeadChild","isTemplate","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","unsubscribeDomEvents","unsubscribeCustomEvents","unbindAll","productSelector","setForm","clearController","controller","clearProductList","readOnly","loadCurrencyFormat","oldCurrencyId","setCurrencyId","setOption","getFields","onCalculatePricesResponse","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","response","updateUiCurrencyFields","updateTotalUiCurrency","totalBlock","row","format","getCurrencyFormat","FORMAT_STRING","getDataFieldName","isNumberValue","isStringValue","isNegative","indexOf","isNaN","dot","comma","s1","substr","decimalLength","round","factor","pow","getContainerId","formId","form","getForm","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","create","attrs","remove","initFormField","getDataSettingsFieldName","getFormField","isEmptyRow","list","index","setRowNumber","Error","gridManager","getInstanceById","gridEditData","paintedColumns","cell","getCellById","arParams","EDITABLE_DATA","COLUMNS_ALL","disableSaveButton","enableSaveButton","closest","hasAttribute","getAttribute","getFieldCodeByGridCell","updateFieldByEvent","dropdownId","regExp","RegExp","getRowIdPrefix","matches","match","updateDropdownField","getProductByRowId","find","headRow","getCellNameByCellIndex","anchorProduct","createGridProductRow","newId","anchorRowNode","parentNode","insertBefore","nextSibling","initializeNewProductRow","bindOnRowEvents","focusProductSelector","has","get","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","setAttribute","makeCountable","setOriginalTemplateEditData","adjustRows","updateCounterDisplayed","updateCounterSelected","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","assign","CURRENCY","ID","IMAGE_INFO","splice","refreshFieldsLayout","unshift","searchInDialog","focusName","tableFade","productRow","isNew","updateProductStoreValues","initHandlersForSelectors","tableUnfade","getDefaultMeasure","setConfig","isExistForm","initFormFields","cleanProductRows","prepareProductDataValue","productDataValue","getProductCount","productData","itemFields","test","stringify","actionSendProductChange","actionSendProductListChanged","updateFieldForList","updateFieldByName","updateTotalDataDelayedHandler","totalCost","setTotalData","productFields","setTotal","responce","status","gridRow","reset","sort","a","b","removeSpotlight","removeQrAuth","_clickOnRowActionsButton","hasErrors"],"mappings":"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"}