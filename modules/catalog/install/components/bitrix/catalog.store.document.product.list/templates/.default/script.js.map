{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/price.calculator.js","src/js/access.denied.input.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/field.hint.manager.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}","import {Type, Text} from \"main.core\";\n\ntype PriceCalculatorFields = {\n\tbasePrice: number,\n\tfinalPrice: number,\n\textra: number | null,\n\textraType: PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n}\n\nexport class PriceCalculator\n{\n\tstatic EXTRA_TYPE_PERCENTAGE = 1;\n\tstatic EXTRA_TYPE_MONETARY = 2;\n\n\t#fields: PriceCalculatorFields = {\n\t\tbasePrice: 0,\n\t\tfinalPrice: 0,\n\t\textra: null,\n\t\textraType: PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n\t};\n\n\n\tconstructor(fields: PriceCalculatorFields): void\n\t{\n\t\tthis.#fields = {...this.#fields, ...fields};\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.#fields.basePrice;\n\t}\n\n\tgetFinalPrice(): number\n\t{\n\t\treturn this.#fields.finalPrice;\n\t}\n\n\tgetExtra(): number | null\n\t{\n\t\treturn this.#fields.extra;\n\t}\n\n\tgetExtraType(): PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE\n\t{\n\t\treturn this.#fields.extraType;\n\t}\n\n\tcalculateBasePrice(basePrice: number): PriceCalculator\n\t{\n\t\tthis.#fields.basePrice = basePrice;\n\t\tthis.#fields.extra = Text.toNumber(this.#fields.extra);\n\n\t\tif (this.#fields.extraType === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\tthis.#fields.finalPrice = this.#fields.basePrice + this.#fields.extra;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#fields.finalPrice = this.#fields.basePrice * (1 + this.#fields.extra / 100);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcalculateFinalPrice(finalPrice: number): PriceCalculator\n\t{\n\t\tthis.#fields.finalPrice = finalPrice;\n\t\tconst basePrice = Text.toNumber(this.#fields.basePrice);\n\n\t\tif (basePrice <= 0)\n\t\t{\n\t\t\tthis.#fields.extraType = PriceCalculator.EXTRA_TYPE_MONETARY;\n\t\t}\n\n\t\tif (this.#fields.extraType === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\tthis.#fields.extra = this.#fields.finalPrice - basePrice;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#fields.extra = (this.#fields.finalPrice / basePrice - 1) * 100;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcalculateExtra(extra: number): PriceCalculator\n\t{\n\t\tthis.#fields.extra = extra;\n\t\tif (Type.isNil(extra))\n\t\t{\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.calculateBasePrice(this.#fields.basePrice);\n\t}\n\n\tcalculateExtraType(extraType: PriceCalculator.EXTRA_TYPE_MONETARY | PriceCalculator.EXTRA_TYPE_PERCENTAGE): PriceCalculator\n\t{\n\t\tif (extraType !== PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\textraType = PriceCalculator.EXTRA_TYPE_PERCENTAGE;\n\t\t}\n\n\t\tthis.#fields.extraType = extraType;\n\n\t\treturn this.calculateFinalPrice(this.#fields.finalPrice);\n\t}\n}","import {Tag, Loc} from 'main.core';\n\nexport class AccessDeniedInput\n{\n\thint: string;\n\ttext: string;\n\tisReadOnly: boolean;\n\n\tconstructor(options)\n\t{\n\t\tthis.text = options.text || Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_TEXT');\n\t\tthis.hint = options.hint;\n\t\tthis.isReadOnly = options.isReadOnly === true;\n\t}\n\n\trenderTo(node: Element): void\n\t{\n\t\tconst className =\n\t\t\tthis.isReadOnly\n\t\t\t\t? 'ui-ctl-no-border catalog-document-product-list-access-denied-readonly'\n\t\t\t\t: 'ui-ctl-disabled catalog-document-product-list-access-denied'\n\t\t;\n\t\tconst block = Tag.render`\n\t\t<div\n\t\t\tclass=\"ui-ctl ui-ctl-w100 ui-ctl-before-icon ui-ctl-after-icon ${className}\"\n\t\t\tdata-hint=\"${this.hint}\"\n\t\t\tdata-hint-no-icon\n\t\t>\n\t\t\t<div class=\"ui-ctl-before catalog-document-product-list-access-denied-lock\"></div>\n\t\t\t<div class=\"ui-ctl-after catalog-document-product-list-access-denied-hint\"></div>\n\t\t\t<div class=\"ui-ctl-element\">${this.text}</div>\n\t\t</div>\n\t\t`;\n\n\t\tnode.innerHTML = '';\n\t\tnode.appendChild(block);\n\n\t\tBX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\tangle: {\n\t\t\t\t\toffset: 100,\n\t\t\t\t},\n\t\t\t},\n\t\t}).init();\n\t}\n}\n","import {Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {Editor} from './product.list.editor';\nimport {CurrencyCore} from 'currency.currency-core';\nimport 'ui.hint';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\nimport {ProductSelector} from \"catalog.product-selector\";\nimport {StoreSelector} from \"catalog.store-selector\";\nimport {PopupMenu} from \"main.popup\";\nimport {PriceCalculator} from \"./price.calculator\";\nimport {AccessDeniedInput} from './access.denied.input';\n\ntype Action = {\n\ttype: string,\n\tfield?: string,\n\tvalue?: string,\n};\n\ntype Settings = {}\n\nconst MODE_EDIT = 'EDIT';\nconst MODE_SET = 'SET';\n\nexport class Row\n{\n\tid: ?string;\n\tsettings: Object;\n\teditor: ?Editor\n\tmodel: ?ProductModel\n\tfields: Object = {};\n\tmainSelector: ?ProductSelector;\n\tbarcodeSelector: ?ProductSelector;\n\tstoreSelectors: Array<StoreSelector> = [];\n\texternalActions: Array<Action> = [];\n\tcache = new Cache.MemoryCache();\n\tmodeChanges = {\n\t\tEDIT: MODE_EDIT,\n\t\tSET: MODE_SET,\n\t};\n\tvalidatingFields: Map<string, boolean> = new Map();\n\trealValues: ?Array;\n\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\n\t{\n\t\tthis.setId(id);\n\t\tthis.setSettings(settings);\n\t\tthis.setEditor(editor);\n\t\tthis.setModel(fields, settings);\n\t\tthis.initFields(fields);\n\t\tthis.#initSelector();\n\t\tthis.#initBarcode();\n\t\tthis.#initSimpleFields();\n\t\t// this.#initPriceExtra();\n\t\tthis.#initStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t\tthis.#initActions();\n\t\tthis.#hideFields();\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('node', () => {\n\t\t\tconst rowId = this.getField('ID', 0);\n\n\t\t\treturn this.getEditorContainer().querySelector('[data-id=\"' + rowId + '\"]');\n\t\t});\n\t}\n\n\tgetSelector(): ?ProductSelector\n\t{\n\t\treturn this.mainSelector;\n\t}\n\n\tgetBarcodeSelector(): ?ProductSelector\n\t{\n\t\treturn this.barcodeSelector;\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id: string): void\n\t{\n\t\tthis.id = id;\n\t}\n\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings: Settings): void\n\t{\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\n\t}\n\n\tgetSettingValue(name, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value): void\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tsetEditor(editor: Editor): void\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tgetEditor(): Editor\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorContainer(): HTMLElement\n\t{\n\t\treturn this.getEditor().getContainer();\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.getEditor().getHintPopup();\n\t}\n\n\tinitHandlers()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for text fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\tEvent.bind(node, 'blur', editor.blurProductFieldHandler)\n\t\t});\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for select fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t}\n\n\tinitHandlersForSelectors()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tlet selectorNames = ['MAIN_INFO', 'BARCODE_INFO'];\n\t\tconst storeFields = this.getSettingValue('storeHeaderMap', {});\n\t\tselectorNames = [...selectorNames, ...Object.keys(storeFields)];\n\n\t\tselectorNames.forEach((name) => {\n\t\t\tthis.getNode().querySelectorAll('[data-name=\"'+ name +'\"] input[type=\"text\"]').forEach(node => {\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t\t// disable drag-n-drop events for select fields\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\t});\n\t\t});\n\t}\n\n\t#initActions()\n\t{\n\t\tif (this.getEditor().isReadOnly() || this.getField('EDITABLE') === false)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tif (Type.isDomNode(actionCellContentContainer))\n\t\t{\n\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"#\"\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\n\t\t\t\t></a>\n\t\t\t`;\n\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\n\t\t\t\tconst menuItems = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_COPY_ACTION'),\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_DELETE_ACTION'),\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tPopupMenu.show({\n\t\t\t\t\tid: this.getId() + '_actions_popup',\n\t\t\t\t\tbindElement: actionsButton,\n\t\t\t\t\titems: menuItems\n\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\t#initSelector()\n\t{\n\t\tconst selectorOptions = {\n\t\t\tiblockId: this.model.getIblockId(),\n\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\tcurrency: this.model.getCurrency(),\n\t\t\tmodel: this.model,\n\t\t\tconfig: {\n\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: this.getSettingValue('isAllowedCreationProduct', true),\n\t\t\t\tENABLE_IMAGE_INPUT: true,\n\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\n\t\t\t\tROW_ID: this.getId(),\n\t\t\t\tENABLE_SKU_SELECTION: true,\n\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: true,\n\t\t\t\tRESTRICTED_PRODUCT_TYPES: this.getEditor().getRestrictedProductTypes(),\n\t\t\t\tURL_BUILDER_CONTEXT: this.editor.getSettingValue('productUrlBuilderContext'),\n\t\t\t},\n\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t};\n\n\t\tthis.mainSelector = new ProductSelector('catalog_document_grid_' + this.getId(), selectorOptions);\n\t\tconst mainInfoNode = this.getNode().querySelector('[data-name=\"MAIN_INFO\"]');\n\t\tif (mainInfoNode)\n\t\t{\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\n\t\t\tif (!Type.isDomNode(numberSelector))\n\t\t\t{\n\t\t\t\tmainInfoNode.appendChild(Tag.render`<div class=\"main-grid-row-number\"></div>`);\n\t\t\t}\n\n\t\t\tlet selectorWrapper =  mainInfoNode.querySelector('.main-grid-row-product-selector');\n\t\t\tif (!Type.isDomNode(selectorWrapper))\n\t\t\t{\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`\n\t\t\t\tmainInfoNode.appendChild(selectorWrapper)\n\t\t\t}\n\t\t\tthis.mainSelector.renderTo(selectorWrapper);\n\t\t}\n\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.mainSelector,\n\t\t\t'onBeforeCreate',\n\t\t\tthis.#handleBeforeCreateProduct.bind(this)\n\t\t);\n\t}\n\n\t#initSimpleFields()\n\t{\n\t\tconst fields = [\n\t\t\t'COMMENT',\n\t\t];\n\n\t\tfor (const name of fields)\n\t\t{\n\t\t\tconst input = this.getNode().querySelector(`[name=\"${name}\"]`);\n\t\t\tif (input)\n\t\t\t{\n\t\t\t\tconst value = this.getField(name);\n\t\t\t\tinput.value = Type.isNil(value) ? '' : value;\n\t\t\t}\n\t\t}\n\t}\n\n\t#initBarcode()\n\t{\n\t\tconst selectorOptions = {\n\t\t\tiblockId: this.model.getIblockId(),\n\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\tcurrency: this.model.getCurrency(),\n\t\t\tmodel: this.model,\n\t\t\tinputFieldName: 'BARCODE',\n\t\t\ttype: ProductSelector.INPUT_FIELD_BARCODE,\n\t\t\tconfig: {\n\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: this.getSettingValue('isAllowedCreationProduct', true),\n\t\t\t\tENABLE_INFO_SPOTLIGHT: this.editor.getSettingValue('showBarcodeSpotlightInfo', true),\n\t\t\t\tENABLE_BARCODE_QR_AUTH: this.editor.getSettingValue('showBarcodeQrAuth', true),\n\t\t\t\tIS_INSTALLED_MOBILE_APP: this.editor.getSettingValue('isInstalledMobileApp', null),\n\t\t\t\tENABLE_IMAGE_INPUT: false,\n\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\tROW_ID: this.getId(),\n\t\t\t\tENABLE_SKU_SELECTION: false,\n\t\t\t\tENABLE_SKU_TREE: false,\n\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: false,\n\t\t\t\tRESTRICTED_PRODUCT_TYPES: this.getEditor().getRestrictedProductTypes(),\n\t\t\t},\n\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t\tscannerToken: this.getEditor().scannerToken,\n\t\t};\n\n\t\tthis.barcodeSelector = new ProductSelector('catalog_document_grid_' + this.getId() + '_barcode', selectorOptions);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBeforeCreate',\n\t\t\tthis.#handleBeforeCreateProduct.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onSpotlightClose',\n\t\t\tthis.#handleSpotlightClose.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeQrClose',\n\t\t\tthis.#handleBarcodeQrClose.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeScannerInstallChecked',\n\t\t\tthis.#handleBarcodeScannerInstallCheck.bind(this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.barcodeSelector,\n\t\t\t'onBarcodeChange',\n\t\t\tthis.#handleBarcodeChange.bind(this)\n\t\t);\n\n\t\tthis.layoutBarcode();\n\t}\n\n\tlayoutBarcode(): void\n\t{\n\t\tconst barcodeWrapper = this.getNode().querySelector('[data-name=\"BARCODE_INFO\"]');\n\t\tif (this.barcodeSelector && barcodeWrapper)\n\t\t{\n\t\t\tbarcodeWrapper.innerHTML = '';\n\n\t\t\tif (this.#needBarcode())\n\t\t\t{\n\t\t\t\tthis.barcodeSelector.renderTo(barcodeWrapper);\n\t\t\t}\n\t\t}\n\t}\n\n\t#initPriceExtra()\n\t{\n\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE\"]');\n\t\tif (!Type.isDomNode(node))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldExtraNode = node.querySelector('.catalog-store-extra-price');\n\t\tif (Type.isDomNode(oldExtraNode))\n\t\t{\n\t\t\toldExtraNode.parentNode.removeChild(oldExtraNode);\n\t\t}\n\n\t\tconst extraValue = this.getField('BASE_PRICE_EXTRA') ?? '';\n\t\tconst inputValue = Tag.render`\n\t\t\t<div>\n\t\t\t\t<input\n\t\t\t\t\tplaceholder=\"-\"\n\t\t\t\t\tclass=\"catalog-store-extra-price\"\n\t\t\t\t\tdata-name=\"BASE_PRICE_EXTRA\"\n\t\t\t\t\tvalue=\"${extraValue}\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst extraMeasureValue =\n\t\t\tthis.getField('BASE_PRICE_EXTRA_RATE') === PriceCalculator.EXTRA_TYPE_MONETARY\n\t\t\t\t? this.getEditor().getCurrencyText()\n\t\t\t\t: '%'\n\t\t;\n\n\t\tconst measureValue = Tag.render`\n\t\t\t<div class=\"main-grid-editor main-grid-editor-money-currency\">\n\t\t\t\t<span class=\"main-dropdown-inner\" data-name=\"BASE_PRICE_EXTRA_RATE\">${extraMeasureValue}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(measureValue, 'click', () => {\n\t\t\tconst menuItems = [\n\t\t\t\t{\n\t\t\t\t\ttext: '%',\n\t\t\t\t\tonclick: this.handleSelectExtraPriceType.bind(this),\n\t\t\t\t\ttype: PriceCalculator.EXTRA_TYPE_PERCENTAGE,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: this.getEditor().getCurrencyText(),\n\t\t\t\t\tonclick: this.handleSelectExtraPriceType.bind(this),\n\t\t\t\t\ttype: PriceCalculator.EXTRA_TYPE_MONETARY,\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tPopupMenu.show({\n\t\t\t\tid: this.getId() + '_extra_type_popup',\n\t\t\t\tbindElement: measureValue,\n\t\t\t\titems: menuItems\n\t\t\t});\n\t\t});\n\n\t\tconst extraNode = Tag.render`\n\t\t\t<div class=\"main-grid-editor catalog-store-extra-price\">\n\t\t\t\t${inputValue}\n\t\t\t\t${measureValue}\n\t\t\t</div>\n\t\t`;\n\n\t\tnode.appendChild(extraNode);\n\t}\n\n\t#initStoreSelector(fieldNames: {})\n\t{\n\t\tObject.keys(fieldNames).forEach( rowName => {\n\t\t\tconst selectorOptions = {\n\t\t\t\tinputFieldId: fieldNames[rowName],\n\t\t\t\tinputFieldTitle: fieldNames[rowName] + '_TITLE',\n\t\t\t\tisDisabledEmpty: true,\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t},\n\t\t\t\tmode: StoreSelector.MODE_EDIT,\n\t\t\t\tmodel: this.model,\n\t\t\t};\n\n\t\t\tconst storeSelector = new StoreSelector(this.getId() + '_' + rowName, selectorOptions);\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tstoreSelector,\n\t\t\t\t'onChange',\n\t\t\t\tRuntime.debounce(this.#onStoreFieldChange.bind(this), 500, this)\n\t\t\t);\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tstoreSelector,\n\t\t\t\t'onClear',\n\t\t\t\tRuntime.debounce(this.#onStoreFieldChange.bind(this), 500, this)\n\t\t\t);\n\n\t\t\tthis.storeSelectors.push(storeSelector);\n\t\t});\n\n\t\tthis.layoutStoreSelector(fieldNames);\n\t}\n\n\tlayoutStoreSelector(fieldNames: {})\n\t{\n\t\tObject.keys(fieldNames).forEach(rowName => {\n\t\t\tconst selectorId = this.getId() + '_' + rowName;\n\n\t\t\tthis.storeSelectors.forEach((selector) => {\n\t\t\t\tif (selector.getId() === selectorId)\n\t\t\t\t{\n\t\t\t\t\tconst storeWrapper = this.getNode().querySelector('[data-name=\"' + rowName + '\"]');\n\t\t\t\t\tif (storeWrapper)\n\t\t\t\t\t{\n\t\t\t\t\t\tstoreWrapper.innerHTML = '';\n\n\t\t\t\t\t\tif (this.#needInventory())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tselector.renderTo(storeWrapper);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t#onStoreFieldChange(event)\n\t{\n\t\tconst data = event.getData();\n\t\tdata.fields.forEach((item) => {\n\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t});\n\t}\n\n\tsetRowNumber(number)\n\t{\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach(node => {\n\t\t\tnode.textContent = number + '.';\n\t\t});\n\t}\n\n\tgetFields(fields: Array = [])\n\t{\n\t\tlet result;\n\n\t\tif (!Type.isArrayFilled(fields))\n\t\t{\n\t\t\tresult = Runtime.clone(this.fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\n\t\t\tfor (let fieldName of fields)\n\t\t\t{\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\n\t\t\t}\n\t\t}\n\n\t\t// merge with real values\n\t\tconst realValues = this.#getRealValues();\n\t\tfor (const fieldName in realValues)\n\t\t{\n\t\t\tif (\n\t\t\t\tObject.hasOwnProperty.call(realValues, fieldName)\n\t\t\t\t&& Object.hasOwnProperty.call(result, fieldName)\n\t\t\t)\n\t\t\t{\n\t\t\t\tresult[fieldName] = realValues[fieldName];\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Get real values field.\n\t *\n\t * Stores the real values of rows that are hidden due to lack of user access.\n\t *\n\t * @returns\n\t */\n\t#getRealValues()\n\t{\n\t\tif (!!this.realValues)\n\t\t{\n\t\t\treturn this.realValues\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst value = this.getField('REAL_VALUES');\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\tconst parsedValue = JSON.parse(atob(value));\n\t\t\t\tif (Type.isPlainObject(parsedValue))\n\t\t\t\t{\n\t\t\t\t\tthis.realValues = parsedValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error('Cannot parse REAL_VALUE: ' + e.getMessage());\n\t\t}\n\n\t\treturn this.realValues;\n\t}\n\n\tinitFields(fields: Object): void\n\t{\n\t\tthis.getModel().initFields(fields, false);\n\t\tthis.setFields(fields);\n\t}\n\n\tsetFields(fields: Object): void\n\t{\n\t\tfor (let name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\tif (name !== 'REAL_VALUES')\n\t\t{\n\t\t\tconst realValues = this.#getRealValues();\n\t\t\tif (realValues && Object.hasOwnProperty.call(realValues, name))\n\t\t\t{\n\t\t\t\treturn realValues[name];\n\t\t\t}\n\t\t}\n\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value, changeModel: boolean = true): void\n\t{\n\t\tthis.fields[name] = value;\n\n\t\tif (changeModel)\n\t\t{\n\t\t\tthis.getModel().setField(name, value);\n\t\t}\n\t}\n\n\tgetUiFieldId(field): string\n\t{\n\t\treturn this.getId() + '_' + field;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tgetAmount(): number\n\t{\n\t\treturn this.getField('AMOUNT', 1);\n\t}\n\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\n\t{\n\t\tconst target = event.target;\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\tconst mode = (event.type === 'input' || event.type === 'change') ? MODE_EDIT : MODE_SET;\n\n\t\tthis.updateField(fieldCode, value, mode);\n\t}\n\n\tupdateDropdownField(fieldCode: string, value: any): void\n\t{\n\t\tthis.updateField(fieldCode, value, MODE_EDIT);\n\t}\n\n\tupdateField(fieldCode: string, value: any, mode = MODE_SET): void\n\t{\n\t\tthis.resetExternalActions();\n\t\tthis.updateFieldValue(fieldCode, value, mode);\n\t\tthis.executeExternalActions();\n\t}\n\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'SKU_ID':\n\t\t\t\tthis.changeProductId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tthis.changeBasePrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\t// case 'BASE_PRICE_EXTRA':\n\t\t\t// \tthis.changeExtra(value, mode);\n\t\t\t// \tbreak;\n\n\t\t\tcase 'PURCHASING_PRICE':\n\t\t\t\tthis.changePurchasingPrice(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'AMOUNT':\n\t\t\t\tthis.changeAmount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'MEASURE_CODE':\n\t\t\t\tthis.changeMeasureCode(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'BARCODE':\n\t\t\t\tthis.changeBarcode(value, mode);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_FROM':\n\t\t\tcase 'STORE_TO':\n\t\t\t\tthis.changeStore(value, code);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_FROM_TITLE':\n\t\t\tcase 'STORE_TO_TITLE':\n\t\t\t\tthis.changeStoreName(value, code);\n\t\t\t\tbreak;\n\t\t\tcase 'NAME':\n\t\t\tcase 'MAIN_INFO':\n\t\t\t\tthis.changeProductName(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SORT':\n\t\t\t\tthis.changeSort(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'COMMENT':\n\t\t\t\tthis.changeComment(value, mode);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateFieldByName(field, value)\n\t{\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.setTaxIncluded(value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tchangeProductId(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tthis.setProductId(preparedValue);\n\t}\n\n\thandleCopyAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.copyRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\thandleDeleteAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.deleteRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t\tthis.unsubscribeEvents();\n\n\t\tthis.#handleProductErrorsChange();\n\t}\n\n\tunsubscribeEvents()\n\t{\n\t\tthis.getBarcodeSelector().unsubscribeEvents();\n\t}\n\n\thandleSelectExtraPriceType(event, menuItem)\n\t{\n\t\tthis.changeExtraType(menuItem.type, MODE_EDIT);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\t#getCalculator()\n\t{\n\t\tconst extra =\n\t\t\tType.isNumber(this.getModel().getField('BASE_PRICE_EXTRA'))\n\t\t\t\t? this.getModel().getField('BASE_PRICE_EXTRA')\n\t\t\t\t: null\n\t\t;\n\n\t\treturn new PriceCalculator({\n\t\t\tbasePrice: Text.toNumber(this.getModel().getField('PURCHASING_PRICE')),\n\t\t\tfinalPrice: Text.toNumber(this.getModel().getField('BASE_PRICE')),\n\t\t\textra,\n\t\t\textraType: Text.toNumber(this.getModel().getField('BASE_PRICE_EXTRA_RATE')),\n\t\t});\n\t}\n\n\tchangeExtraType(value, mode = MODE_SET)\n\t{\n\t\tlet text = '%';\n\t\tif (value === PriceCalculator.EXTRA_TYPE_MONETARY)\n\t\t{\n\t\t\ttext = this.getEditor().getCurrencyText();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvalue = PriceCalculator.EXTRA_TYPE_PERCENTAGE;\n\t\t}\n\n\t\tif (value === this.getField('BASE_PRICE_EXTRA_RATE'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst calculator =\n\t\t\t\tthis.#getCalculator()\n\t\t\t\t\t.calculateExtraType(value)\n\t\t\t;\n\n\t\t\tthis.changeExtra(calculator.getExtra());\n\t\t\tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t}\n\n\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE_EXTRA_RATE\"]');\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tnode.innerHTML = text;\n\t\t}\n\n\t\tthis.setField('BASE_PRICE_EXTRA_RATE', value);\n\t}\n\n\tchangeExtra(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = (Type.isNil(value) || value === '') ? null : this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setField('BASE_PRICE_EXTRA', preparedValue);\n\n\t\tif (preparedValue === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tconst calculator =\n\t\t\t\tthis.#getCalculator()\n\t\t\t\t\t.calculateExtra(preparedValue)\n\t\t\t;\n\n\t\t\tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst node = this.getNode().querySelector('[data-name=\"BASE_PRICE_EXTRA\"]');\n\t\t\tif (Type.isDomNode(node))\n\t\t\t{\n\t\t\t\tnode.value = preparedValue;\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeBasePrice(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setBasePrice(preparedValue, mode);\n\n\t\t// if (mode === MODE_EDIT)\n\t\t// {\n\t\t// \tconst calculator =\n\t\t// \t\tthis.#getCalculator()\n\t\t// \t\t\t.calculateFinalPrice(preparedValue)\n\t\t// \t;\n\t\t//\n\t\t// \tthis.changeExtra(calculator.getExtra());\n\t\t// \tthis.changeExtraType(calculator.getExtraType());\n\t\t// }\n\t}\n\n\tchangePurchasingPrice(value, mode = MODE_SET)\n\t{\n\t\tif (this.#isPurchasingPriceAccessDenied())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\t\tthis.setPurchasingPrice(preparedValue, mode);\n\n\t\t// const currentExtra = this.getField('BASE_PRICE_EXTRA');\n\t\t// if (mode === MODE_EDIT && !Type.isNil(currentExtra) && currentExtra !== '')\n\t\t// {\n\t\t// \tconst calculator =\n\t\t// \t\tthis.#getCalculator()\n\t\t// \t\t\t.calculateBasePrice(preparedValue)\n\t\t// \t;\n\t\t//\n\t\t// \tthis.changeBasePrice(calculator.getFinalPrice());\n\t\t// }\n\t}\n\n\tchangeAmount(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\n\t\tthis.setAmount(preparedValue, mode);\n\t}\n\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\n\t{\n\t\tthis\n\t\t\t.getEditor()\n\t\t\t.getMeasures()\n\t\t\t.filter((item) => item.CODE === value)\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\n\t\t;\n\t}\n\n\tchangeBarcode(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('BARCODE') !== preparedValue;\n\n\t\tif (isChangedValue && mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('BARCODE', preparedValue);\n\t\t\tthis.setField('DOC_BARCODE', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t\telse if (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.setField('DOC_BARCODE', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStore(value: number, code: string)\n\t{\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tconst isChangedValue = this.getField(code) !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField(code, preparedValue);\n\t\t\tthis.setStoreAmount(value, code);\n\t\t\tthis.layoutStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStoreName(value: number, code: string)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tthis.setField(code, preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeProductName(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('NAME') !== preparedValue;\n\n\t\tif (isChangedValue && mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('NAME', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeSort(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('SORT', preparedValue);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeComment(value)\n\t{\n\t\tconst preparedValue = Type.isNil(value) ? '' : value.toString().trim();\n\t\tif (preparedValue !== this.getField('COMMENT'))\n\t\t{\n\t\t\tthis.setField('COMMENT', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\n\t{\n\t\tfor (let field in this.fields)\n\t\t{\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\n\t\t\t{\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\n\t\t\t}\n\t\t}\n\t\tthis.updateUiMeasure(\n\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\tthis.getField('MEASURE_NAME')\n\t\t)\n\t\tthis.getSelector()?.reloadFileInput();\n\t\tthis.getSelector()?.layout();\n\t\tthis.getBarcodeSelector()?.layout();\n\t\tthis.updateUiStoreValues();\n\t}\n\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\n\t{\n\t\tconst selectorId = 'catalog_document_grid_' + this.getId();\n\t\tif (selectorId)\n\t\t{\n\t\t\tconst model = ProductModel.getById(selectorId);\n\t\t\tif (model)\n\t\t\t{\n\t\t\t\tthis.model = model;\n\t\t\t}\n\t\t}\n\n\t\tif (!(this.model instanceof ProductModel))\n\t\t{\n\t\t\tthis.model = new ProductModel({\n\t\t\t\tid: selectorId,\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\n\t\t\t\tiblockId: fields['IBLOCK_ID'],\n\t\t\t\tbasePriceId: fields['BASE_PRICE_ID'],\n\t\t\t\tskuTree: Type.isStringFilled(fields['SKU_TREE']) ? JSON.parse(fields['SKU_TREE']) : null,\n\t\t\t\tstoreMap: fields['STORE_AMOUNT_MAP'],\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tif (Type.isObject(fields['IMAGE_INFO']))\n\t\t\t{\n\t\t\t\tthis.model.getImageCollection().setPreview(fields['IMAGE_INFO']['preview']);\n\t\t\t\tthis.model.getImageCollection().setEditInput(fields['IMAGE_INFO']['input']);\n\t\t\t\tthis.model.getImageCollection().setMorePhotoValues(fields['IMAGE_INFO']['values']);\n\t\t\t}\n\n\t\t\tif (!Type.isNil(fields['DETAIL_URL']))\n\t\t\t{\n\t\t\t\tthis.model.setDetailPath(fields['DETAIL_URL']);\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tRuntime.debounce(this.#handleProductErrorsChange, 500, this)\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.updateUiStoreValues.bind(this)\n\t\t);\n\t}\n\n\tgetModel(): ?ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\t#handleProductErrorsChange()\n\t{\n\t\tconst errors = this.getModel().getErrorCollection().getErrors();\n\t\tfor (const code in errors)\n\t\t{\n\t\t\tif (code === ProductSelector.ErrorCodes.NOT_SELECTED_PRODUCT || code === StoreSelector.ErrorCodes.NOT_SELECTED_STORE)\n\t\t\t{\n\t\t\t\tthis.getSelector().layoutErrors();\n\t\t\t}\n\t\t}\n\n\t\tthis.getEditor().handleProductErrorsChange();\n\t}\n\n\t#handleBeforeCreateProduct(event: BaseEvent)\n\t{\n\t\tconst {model} = event.getData();\n\t\tmodel.setField('BARCODE', this.barcodeSelector.getNameInputFilledValue());\n\t\tmodel.setField('NAME', this.mainSelector.getNameInputFilledValue());\n\t}\n\n\t#handleSpotlightClose(event: BaseEvent): void\n\t{\n\t\tthis.editor.closeBarcodeSpotlights();\n\t}\n\n\t#handleBarcodeQrClose(event: BaseEvent): void\n\t{\n\t\tthis.editor.closeBarcodeQrAuths();\n\t}\n\n\t#handleBarcodeScannerInstallCheck(event: BaseEvent): void\n\t{\n\t\tthis.editor.enableSendBarcodeMobilePush();\n\t}\n\n\t#handleBarcodeChange(event: BaseEvent): void\n\t{\n\t\tconst {value} = event.getData();\n\t\tthis.changeBarcode(value, MODE_EDIT);\n\t}\n\n\tsetProductId(value)\n\t{\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_ID', value);\n\t\t\tthis.setField('SKU_ID', value);\n\n\t\t\tthis.updateUiStoreValues();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tthis.#hidePurchasingPrice();\n\t\t}\n\t}\n\n\tsetBasePrice(value, mode = MODE_SET)\n\t{\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiField('BASE_PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\t\tthis.setField('BASE_PRICE', value);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\n\t\tthis.updateRowTotalPrice();\n\t}\n\n\tupdateRowTotalPrice()\n\t{\n\t\tconst field = this.getEditor().getSettingValue('totalCalculationSumField', 'PURCHASING_PRICE');\n\t\tlet value = this.getAmount() * this.getField(field, 0);\n\t\tvalue = Math.max(value, 0);\n\n\t\tthis.setField('TOTAL_PRICE', value);\n\t\tthis.updateUiField('TOTAL_PRICE', value.toFixed(this.getPricePrecision()));\n\t}\n\n\tupdateProductStoreValues()\n\t{\n\t\tthis.storeSelectors.forEach((selector) => {\n\t\t\tselector.setProductId(this.getModel().getSkuId());\n\t\t});\n\t}\n\n\tupdateUiStoreValues()\n\t{\n\t\tconst storeHeaderMap = this.getSettingValue('storeHeaderMap', {});\n\t\tObject.keys(storeHeaderMap).forEach((key) => {\n\t\t\tconst fieldName = storeHeaderMap[key];\n\t\t\tlet value = this.getField(fieldName);\n\t\t\tif (fieldName === 'STORE_FROM')\n\t\t\t{\n\t\t\t\tconst currentAmount = this.model.getStoreCollection().getStoreAmount(value);\n\t\t\t\tif (currentAmount <= 0)\n\t\t\t\t{\n\t\t\t\t\tconst maxStore = this.model.getStoreCollection().getMaxFilledStore();\n\t\t\t\t\tconst storeSelector = StoreSelector.getById(this.getId() + '_' + key);\n\t\t\t\t\tif (maxStore.AMOUNT > currentAmount && storeSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tstoreSelector.onStoreSelect(maxStore.STORE_ID, maxStore.STORE_TITLE);\n\t\t\t\t\t\tvalue = maxStore.STORE_ID;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setStoreAmount(value, fieldName)\n\t\t})\n\n\t\tthis.layoutStoreSelector(this.getSettingValue('storeHeaderMap', {}));\n\t}\n\n\tsetStoreAmount(value, fieldName, mode = MODE_SET)\n\t{\n\t\tif (!this.model.getStoreCollection().isInited())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// price can't be less than zero\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tlet amount;\n\n\t\t\tconst amounts = {\n\t\t\t\t'_AMOUNT': () => this.model.getStoreCollection().getStoreAmount(value),\n\t\t\t\t'_RESERVED': () => this.model.getStoreCollection().getStoreReserved(value),\n\t\t\t\t'_AVAILABLE_AMOUNT': () => this.model.getStoreCollection().getStoreAvailableAmount(value),\n\t\t\t};\n\t\t\tfor (const postfix in amounts) {\n\t\t\t\tif (Object.hasOwnProperty.call(amounts, postfix)) {\n\t\t\t\t\tconst wrapper = this.#getNodeChildByDataName(fieldName + postfix);\n\t\t\t\t\tif (wrapper)\n\t\t\t\t\t{\n\t\t\t\t\t\twrapper.innerHTML = '';\n\n\t\t\t\t\t\tif (this.#needInventory())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tamount = amounts[postfix]() || 0;\n\n\t\t\t\t\t\t\tconst amountWithMeasure = amount + ' ' + Text.encode(this.getField('MEASURE_NAME'));\n\t\t\t\t\t\t\tlet htmlAmount = amountWithMeasure;\n\n\t\t\t\t\t\t\tif (postfix === '_AVAILABLE_AMOUNT')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\thtmlAmount =\n\t\t\t\t\t\t\t\t\tamount > 0\n\t\t\t\t\t\t\t\t\t\t? amountWithMeasure\n\t\t\t\t\t\t\t\t\t\t: `<span class=\"text--danger\">${amountWithMeasure}</span>`\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\twrapper.innerHTML = htmlAmount;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsetPurchasingPrice(value, mode = MODE_SET)\n\t{\n\t\tif (this.#isPurchasingPriceAccessDenied())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiField('PURCHASING_PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\t\tthis.setField('PURCHASING_PRICE', value);\n\t\tthis.addActionProductChange();\n\t\tthis.addActionUpdateTotal();\n\n\t\tthis.updateRowTotalPrice();\n\t}\n\n\tsetAmount(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('AMOUNT', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('AMOUNT') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('AMOUNT', value);\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tthis.updateRowTotalPrice();\n\t\t}\n\t}\n\n\tsetMeasure(measure, mode = MODE_SET)\n\t{\n\t\tif (this.model.isEmpty())\n\t\t{\n\t\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\t\t\tthis.updateUiMeasure(measure.CODE,\tmeasure.SYMBOL);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.getModel().showSaveNotifier(\n\t\t\t\t'measureChanger_' + this.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\n\t\t\t\t\tdeclineCancelTitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_DECLINE_SAVE'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\t\t\t\t\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\t\t\t\t\t\t\tthis.updateUiMeasure(\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_NAME')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\t\tthis.updateUiMeasure(\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_CODE'),\n\t\t\t\t\t\t\t\tthis.getField('MEASURE_NAME')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateUiMeasure(measure.CODE,\tmeasure.SYMBOL);\n\t\t}\n\n\t\tthis.addActionProductChange();\n\t}\n\n\t// controls\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst fieldId = this.getUiFieldId(fieldName);\n\t\tlet item = document.getElementById(fieldId);\n\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\titem = this.getNode().querySelector('[name=\"' + fieldId + '\"]');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tgetInputWrapperByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst inputBlock = this.getInputByFieldName(fieldName);\n\n\t\tif (Type.isElementNode(inputBlock))\n\t\t{\n\t\t\treturn Type.isElementNode(inputBlock.parentNode) ? inputBlock.parentNode : inputBlock;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tupdateUiInputField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.value = value;\n\t\t}\n\t}\n\n\tupdateUiCheckboxField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.checked = value === 'Y';\n\t\t}\n\t}\n\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\n\t{\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.dropdownManager.getById(this.getId() + '_' + name + '_control');\n\t}\n\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\n\t{\n\t\tif (dropdown.getValue() === value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (dropdown.menu)\n\t\t{\n\t\t\tdropdown.menu.destroy();\n\t\t}\n\n\t\tconst item = dropdown.menu.itemsContainer.querySelector('[data-value=\"' + value + '\"]');\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\n\t\tif (menuItem)\n\t\t{\n\t\t\tdropdown.refresh(menuItem);\n\t\t\tdropdown.selectItem(menuItem);\n\t\t}\n\t}\n\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.dataset.value = value;\n\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\n\t\tif (!Type.isElementNode(span))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tspan.innerHTML = text;\n\t}\n\n\tupdateUiMeasure(code, name)\n\t{\n\t\tthis.updateUiMoneyField(\n\t\t\t'MEASURE_CODE',\n\t\t\tcode,\n\t\t\tText.encode(name)\n\t\t);\n\n\t\tthis.updateUiStoreValues();\n\t}\n\n\tupdateUiHtmlField(name, html)\n\t{\n\t\tconst item = this.getNode().querySelector('[data-name=\"' + name + '\"]');;\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.innerHTML = html;\n\t\t}\n\t}\n\n\tupdateUiCurrencyFields()\n\t{\n\t\tconst currencyText = this.getEditor().getCurrencyText();\n\t\tconst currencyId = '' + this.getEditor().getCurrencyId();\n\n\t\tconst currencyFieldNames = ['BASE_PRICE_CURRENCY', 'PURCHASING_PRICE_CURRENCY'];\n\t\tcurrencyFieldNames.forEach((name) => {\n\t\t\tconst dropdownValues = [];\n\t\t\tdropdownValues.push({\n\t\t\t\tNAME: currencyText,\n\t\t\t\tVALUE: currencyId,\n\t\t\t});\n\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\n\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\n\t\t});\n\t}\n\n\tupdateUiField(field, value): void\n\t{\n\t\tconst uiName = this.getUiFieldName(field);\n\t\tif (!uiName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst uiType = this.getUiFieldType(field);\n\t\tif (!uiType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (uiType)\n\t\t{\n\t\t\tcase 'input':\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money':\n\t\t\t\tvalue = BX.util.number_format(value, this.getPricePrecision(), \".\", \"\");\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money_html':\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetUiFieldName(field)\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'AMOUNT':\n\t\t\tcase 'MEASURE_CODE':\n\t\t\tcase 'BASE_PRICE':\n\t\t\tcase 'PURCHASING_PRICE':\n\t\t\tcase 'TOTAL_PRICE':\n\t\t\t\tresult = field;\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetUiFieldType(field)\n\t{\n\t\tconst moneyFields = ['BASE_PRICE', 'PURCHASING_PRICE', 'TOTAL_PRICE'];\n\t\tif (moneyFields.includes(field))\n\t\t{\n\t\t\tconst column = this.getEditor()?.getColumnInfo(field);\n\t\t\tif (column?.editable?.TYPE === 'MONEY')\n\t\t\t{\n\t\t\t\treturn  'money';\n\t\t\t}\n\n\t\t\treturn  'money_html';\n\t\t}\n\t\telse if (field === 'AMOUNT')\n\t\t{\n\t\t\treturn  'input';\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// proxy\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\treturn this.getEditor().parseInt(value, defaultValue);\n\t}\n\n\tparseFloat(value: number | string, precision: number, defaultValue = 0)\n\t{\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\n\t}\n\n\tgetPricePrecision()\n\t{\n\t\treturn this.getEditor().getPricePrecision();\n\t}\n\n\tgetQuantityPrecision()\n\t{\n\t\treturn this.getEditor().getQuantityPrecision();\n\t}\n\n\tgetCommonPrecision()\n\t{\n\t\treturn this.getEditor().getCommonPrecision();\n\t}\n\n\tresetExternalActions()\n\t{\n\t\tthis.externalActions.length = 0;\n\t}\n\n\taddExternalAction(action: Action)\n\t{\n\t\tthis.externalActions.push(action);\n\t}\n\n\taddActionProductChange()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.productChange,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionUpdateTotal()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateTotal\n\t\t});\n\t}\n\n\texecuteExternalActions()\n\t{\n\t\tif (this.externalActions.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getEditor().executeActions(this.externalActions);\n\t\tthis.resetExternalActions();\n\t}\n\n\tisEmptyRow()\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('NAME', '').trim())\n\t\t\t&& this.model.isEmpty()\n\t\t\t&& this.getBasePrice() <= 0\n\t\t)\n\t}\n\n\tvalidate(): Array\n\t{\n\t\tconst errorsList = [];\n\n\t\tif (!this.#isProductCountCorrect(this.getAmount()))\n\t\t{\n\t\t\tthis.#subscribeFieldToValidator('AMOUNT', this.#isProductCountCorrect);\n\t\t\terrorsList.push(Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_INVALID_AMOUNT_2'));\n\t\t}\n\n\t\treturn errorsList;\n\t}\n\n\t#subscribeFieldToValidator(fieldName: string, validatorCallback: Function): void\n\t{\n\t\tconst fieldInput = this.getInputByFieldName(fieldName);\n\t\tconst fieldWrapper = this.getInputWrapperByFieldName(fieldName);\n\n\t\tif (validatorCallback(fieldInput.valueAsNumber) || this.validatingFields.get(fieldName))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.validatingFields.set(fieldName, true);\n\n\t\tfieldWrapper.classList.add('main-grid-editor-cell-danger');\n\n\t\tconst validator = (eventObject) => {\n\t\t\tif (Boolean(validatorCallback(eventObject.target.valueAsNumber)))\n\t\t\t{\n\t\t\t\tthis.validatingFields.set(fieldName, false);\n\t\t\t\tEvent.unbind(fieldInput, 'blur', validator);\n\t\t\t\tfieldWrapper.classList.remove('main-grid-editor-cell-danger');\n\t\t\t}\n\t\t};\n\n\t\tEvent.bind(fieldInput, 'blur', validator);\n\t}\n\n\t#isProductCountCorrect(amountValue): boolean\n\t{\n\t\treturn amountValue > 0;\n\t}\n\n\t#getNodeChildByDataName(name: String): HTMLElement\n\t{\n\t\treturn this.getNode().querySelector(`[data-name=\"${name}\"]`);\n\t}\n\n\t#needInventory(): boolean\n\t{\n\t\treturn !this.getModel().isService();\n\t}\n\n\t#needBarcode(): boolean\n\t{\n\t\treturn !this.getModel().isService();\n\t}\n\n\t#isRowAccessDenied()\n\t{\n\t\treturn this.getField('ACCESS_DENIED') === true;\n\t}\n\n\t#hideFields()\n\t{\n\t\tif (!this.#isRowAccessDenied())\n\t\t{\n\t\t\tthis.#hidePurchasingPrice();\n\t\t\treturn;\n\t\t}\n\n\t\tconst hiddenFields = this.getEditor().getSettingValue('hiddenFields');\n\t\tconst columnIndexes = this.getEditor().getGridColumnIndexes();\n\n\t\thiddenFields.forEach((fieldName) => {\n\t\t\tconst columnIndex = columnIndexes[fieldName];\n\t\t\tif (columnIndex === undefined)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = this.getNode().querySelector(`.main-grid-cell:nth-child(${columnIndex+1}) .main-grid-cell-content`);\n\t\t\tif (Type.isElementNode(item))\n\t\t\t{\n\t\t\t\titem.innerHTML = '';\n\t\t\t}\n\t\t});\n\n\t\tconst fieldWithHintIndex = columnIndexes['AMOUNT'];\n\t\tif (fieldWithHintIndex)\n\t\t{\n\t\t\tconst fieldWithHintNode = this.getNode().querySelector(`.main-grid-cell:nth-child(${fieldWithHintIndex+1}) .main-grid-cell-content`);\n\t\t\tif (fieldWithHintNode)\n\t\t\t{\n\t\t\t\tconst input = new AccessDeniedInput({\n\t\t\t\t\thint: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_STORE_HINT'),\n\t\t\t\t\tisReadOnly: this.getEditor().isReadOnly(),\n\t\t\t\t});\n\t\t\t\tinput.renderTo(fieldWithHintNode);\n\t\t\t}\n\t\t}\n\t}\n\n\t#isPurchasingPriceAccessDenied()\n\t{\n\t\treturn this.getField('ACCESS_DENIED_TO_PURCHASING_PRICE') === true;\n\t}\n\n\t#hidePurchasingPrice()\n\t{\n\t\tif (!this.#isPurchasingPriceAccessDenied())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst columnIndexes = this.getEditor().getGridColumnIndexes();\n\t\tconst fieldWithHintIndex = columnIndexes['PURCHASING_PRICE'];\n\t\tif (fieldWithHintIndex)\n\t\t{\n\t\t\tconst fieldWithHintNode = this.getNode().querySelector(`.main-grid-cell:nth-child(${fieldWithHintIndex+1})`);\n\t\t\tif (fieldWithHintNode)\n\t\t\t{\n\t\t\t\tconst priceNode = fieldWithHintNode.querySelector('.main-grid-editor-container');\n\t\t\t\tif (priceNode)\n\t\t\t\t{\n\t\t\t\t\tpriceNode.remove();\n\t\t\t\t}\n\n\t\t\t\tconst contentNode = fieldWithHintNode.querySelector('.main-grid-cell-content');\n\t\t\t\tif (contentNode)\n\t\t\t\t{\n\t\t\t\t\tconst input = new AccessDeniedInput({\n\t\t\t\t\t\thint: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACCESS_DENIED_PURCHASING_PRICE_HINT'),\n\t\t\t\t\t\tisReadOnly: this.getEditor().isReadOnly(),\n\t\t\t\t\t});\n\t\t\t\t\tinput.renderTo(contentNode);\n\t\t\t\t\tcontentNode.style.display = 'block';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import {Popup} from 'main.popup';\nimport {ajax, Cache, Event, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {Editor} from './product.list.editor';\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\t#getSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title\">${item.title}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.#getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.#requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\t#requestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tconst message = enabled\n\t\t\t\t? Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_ENABLED')\n\t\t\t\t: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_SETTING_DISABLED');\n\n\t\t\tthis.#showNotification(message.replace('#NAME#', setting.title), {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}","// @flow\n\nimport {Event} from 'main.core';\nimport {Guide} from 'ui.tour';\nimport 'spotlight';\n\nexport class FieldHintManager\n{\n\tfieldHintIsBusy: boolean = false;\n\tactiveHintGuide: Guide|null = null;\n\n\t#gridGetter: Function;\n\t#contentContainer: HTMLElement;\n\n\tconstructor(contentContainer: HTMLElement, gridGetter: Function)\n\t{\n\t\tthis.#contentContainer = contentContainer;\n\t\tthis.#gridGetter = gridGetter;\n\t}\n\n\tprocessFieldTour(fieldNode: HTMLElement, tourData: Object, endTourHandler: Function, addictedFieldNodes: Array<HTMLElement> = []): void\n\t{\n\t\tif (this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fieldHintIsBusy = true;\n\t\t// When click action in progress tour will be closed -> 'onClose' tour method will be executed\n\t\ttourData.events = {\n\t\t\tonClose: () => {\n\t\t\t\tendTourHandler();\n\t\t\t\tthis.fieldHintIsBusy = false;\n\t\t\t\tthis.activeHintGuide = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#fieldNodeIsInGridVision(fieldNode))\n\t\t{\n\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\ttourObject.close();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\t\tconst fieldPos = fieldNode.getClientRects()[0].x;\n\t\t\tconst gridPos = gridContainer.getClientRects()[0].x;\n\n\t\t\tlet spotlight = null;\n\t\t\tif (fieldPos > gridPos) {\n\t\t\t\tspotlight = this.#bindSpotlightToNode(rightArrow);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tspotlight = this.#bindSpotlightToNode(leftArrow);\n\t\t\t}\n\n\t\t\tthis.#bindGridNodeVisionChange(fieldNode, () => {\n\t\t\t\tspotlight.close();\n\t\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\t\ttourObject.close();\n\t\t\t\t})\n\t\t\t}, [], addictedFieldNodes);\n\t\t}\n\t}\n\n\t#bindGridNodeVisionChange(observedNode: HTMLElement, onSuccessVisionCallback: Function, callbackParams: Array = [], addictedNodes: Array<HTMLElement> = [])\n\t{\n\t\tconst observedNodes = this.#getPossibleToValidateFieldNodes(observedNode, ...addictedNodes);\n\t\tconst observer = (event: Event) => {\n\t\t\tif (this.#fieldNodeIsInGridVision(...observedNodes))\n\t\t\t{\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t\t\t'scroll',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\t\t\t\tEvent.unbind(\n\t\t\t\t\twindow,\n\t\t\t\t\t'resize',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\n\t\t\t\tonSuccessVisionCallback(...callbackParams);\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(\n\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t'scroll',\n\t\t\tobserver\n\t\t);\n\t\tEvent.bind(\n\t\t\twindow,\n\t\t\t'resize',\n\t\t\tobserver\n\t\t);\n\t}\n\n\t#getPossibleToValidateFieldNodes(mainNode: HTMLElement, ...addictedNodes: Array<HTMLElement>): Array<HTMLElement>\n\t{\n\t\tconst nodesTuple = [];\n\t\tfor (const addictedNode: HTMLElement of addictedNodes)\n\t\t{\n\t\t\tnodesTuple.push({\n\t\t\t\tnode: addictedNode,\n\t\t\t\tnodeRect: addictedNode.getClientRects()[0],\n\t\t\t});\n\t\t}\n\n\t\tconst mainNodeTupleEl = {\n\t\t\tnode: mainNode,\n\t\t\tnodeRect: mainNode.getClientRects()[0],\n\t\t};\n\t\tnodesTuple.push(mainNodeTupleEl);\n\n\t\tnodesTuple.sort((firstEl, secondEl) => {\n\t\t\tconst {x: firstX} = firstEl.nodeRect;\n\t\t\tconst {x: secondX} = secondEl.nodeRect;\n\n\t\t\tif (firstX < secondX)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\telse if (firstX > secondX)\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t});\n\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\t\tfunction widthIsValid(leftPos: number, rightPos: number)\n\t\t{\n\t\t\treturn Math.abs(leftPos - rightPos) < gridRect.width;\n\t\t}\n\n\t\twhile (nodesTuple.length > 1 && !widthIsValid(nodesTuple[0].nodeRect.x,nodesTuple[nodesTuple.length-1].nodeRect.x))\n\t\t{\n\t\t\tconst firstEl = nodesTuple[0];\n\t\t\tconst lastEl = nodesTuple[nodesTuple.length-1];\n\t\t\tif (firstEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.pop();\n\t\t\t}\n\t\t\telse if (lastEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.shift();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst firstElDistance = mainNodeTupleEl.nodeRect.x - firstEl.nodeRect.x;\n\t\t\t\tconst lastElDistance = lastEl.nodeRect.x - mainNodeTupleEl.nodeRect.x;\n\t\t\t\tif (firstElDistance >= lastElDistance)\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.shift();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.pop();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn nodesTuple.map((el) => el.node);\n\t}\n\n\t#fieldNodeIsInGridVision(...fieldNodes: Array<HTMLElement>) {\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\n\t\tif (gridRect === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst gridLeftEdge = gridRect.x;\n\t\tconst gridRightEdge = gridRect.x + gridRect.width;\n\n\t\tfor (const fieldNode: HTMLElement of fieldNodes)\n\t\t{\n\t\t\tconst fieldRect = fieldNode.getClientRects()?.[0];\n\t\t\tif (fieldRect === undefined)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst fieldLeftEdge = fieldRect.x;\n\t\t\tconst fieldRightEdge = fieldRect.x + fieldRect.width;\n\n\t\t\tif (fieldLeftEdge < gridLeftEdge || fieldRightEdge > gridRightEdge)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#bindSpotlightToNode(targetNode: HTMLElement)\n\t{\n\t\tconst spotlight = new BX.SpotLight(\n\t\t\t{\n\t\t\t\tid: 'arrow_spotlight',\n\t\t\t\ttargetElement: targetNode,\n\t\t\t\tautoSave: true,\n\t\t\t\ttargetVertex: \"middle-center\",\n\t\t\t\tzIndex: 200,\n\t\t\t}\n\t\t);\n\t\tspotlight.show();\n\t\tspotlight.container.style.pointerEvents = \"none\";\n\n\t\treturn spotlight;\n\t}\n\n\t#freezeGridContainer(onCloseCallback: Function, callbackParams: Array = [])\n\t{\n\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\tgridContainer.style.pointerEvents = \"none\";\n\t\tleftArrow.style.pointerEvents = \"none\";\n\t\trightArrow.style.pointerEvents = \"none\";\n\n\t\tconst clickObserver = (event) => {\n\t\t\tgridContainer.style.pointerEvents = \"auto\";\n\t\t\tleftArrow.style.pointerEvents = \"auto\";\n\t\t\trightArrow.style.pointerEvents = \"auto\";\n\t\t\tEvent.unbind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\n\t\t\tonCloseCallback(...callbackParams);\n\t\t}\n\t\tsetTimeout(() => {\n\t\t\tEvent.bind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\t\t}, 500);\n\t}\n\n\t#tieTourToNode(tourTarget: HTMLElement, tourData: Object): Guide\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\tObject.assign({target: tourTarget}, tourData),\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t\tthis.activeHintGuide = guide;\n\n\t\tguide.showNextStep();\n\t\treturn guide;\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\tif (!this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\telse if (this.activeHintGuide instanceof Guide)\n\t\t{\n\t\t\treturn this.activeHintGuide;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import {ajax, Cache, Dom, Event, Reflection, Runtime, Text, Type, Loc} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Row} from './product.list.row';\nimport {PageEventsManager} from './page.events.manager';\nimport SettingsPopup from './settings.button';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {ProductSelector} from 'catalog.product-selector';\nimport {StoreSelector} from \"catalog.store-selector\";\nimport HintPopup from './hint.popup';\nimport ProductListController from \"catalog.document-card\";\nimport {ProductModel} from \"catalog.product-model\";\nimport {FieldHintManager} from \"./field.hint.manager\";\nimport {Guide} from \"ui.tour\";\nimport {UI} from 'ui.notification';\nimport \"ui.hint\";\n\nconst GRID_TEMPLATE_ROW = 'template_0';\nconst DEFAULT_PRECISION: number = 2;\n\nconst isEmptyObject = function(obj): boolean\n{\n\tif (!Type.isPlainObject(obj))\n\t{\n\t\treturn false;\n\t}\n\n\tfor (const key in obj)\n\t{\n\t\treturn false;\n\t}\n\n\treturn true;\n};\n\nexport class Editor\n{\n\tid: ?string;\n\tsettings: Object;\n\tcontroller: ?ProductListController;\n\tcontainer: ?HTMLElement;\n\tform: ?HTMLElement\n\tproducts: Row[] = [];\n\tproductsWasInitiated = false;\n\tpageEventsManager: PageEventsManager;\n\tcache = new Cache.MemoryCache();\n\n\t#fieldHintManager: FieldHintManager;\n\n\tactions = {\n\t\tproductChange: 'productChange',\n\t\tproductListChanged: 'productListChanged',\n\t\tupdateListField: 'listField',\n\t\tupdateTotal: 'total'\n\t};\n\n\tupdateFieldForList = null;\n\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\n\tproductRowCreateHandler = this.handleProductRowCreate.bind(this);\n\tshowBarcodeSettingsPopupHandler = this.handleShowBarcodeSettingsPopup.bind(this);\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\n\n\tonSaveHandler = this.handleOnSave.bind(this);\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\n\tonFocusToProductList = this.handleProductListFocus.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\n\tonScanEmitHandler = this.handleMobileScanEvent.bind(this);\n\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\n\tblurProductFieldHandler = this.handleFieldBlur.bind(this);\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 100, this);\n\n\tconstructor(id)\n\t{\n\t\tthis.setId(id);\n\t}\n\n\tinit(config = {})\n\t{\n\t\tthis.setSettings(config);\n\n\t\tthis.scannerToken = this.scannerToken ?? Text.getRandom(16);\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.enableEdit();\n\t\t}\n\n\t\tthis.initForm();\n\t\tthis.initProducts();\n\t\tthis.initGridData();\n\t\tthis.paintColumns();\n\n\t\tthis.#fieldHintManager = new FieldHintManager(this.getContainer(), this.getGrid.bind(this));\n\n\t\tEventEmitter.emit( 'DocumentProductListController', [this]);\n\n\t\tthis.#initSupportCustomRowActions();\n\t\tthis.subscribeDomEvents();\n\t\tthis.subscribeCustomEvents();\n\n\t\tthis\n\t\t\t.getContainer()\n\t\t\t.querySelectorAll('.catalog-document-product-list-add-block')\n\t\t\t.forEach((buttonBlock) => {\n\t\t\t\tBX.UI.Hint.init(buttonBlock);\n\t\t\t})\n\t\t;\n\n\t}\n\n\tsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tif (this.getSettingValue('enabledCreateProductButton', true))\n\t\t\t{\n\t\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-create-button\"]').forEach((addButton) => {\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\taddButton,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.productRowCreateHandler\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-barcode-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showBarcodeSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((createButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tcreateButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowCreateHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-barcode-settings-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.subscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tEventEmitter.subscribe('BarcodeScanner::onScanEmit', this.onScanEmitHandler);\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.unsubscribe('BX.UI.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.unsubscribe('BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.unsubscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tEventEmitter.unsubscribe('BarcodeScanner::onScanEmit', this.onScanEmitHandler);\n\t}\n\n\thandleMobileScanEvent(event: BaseEvent): void\n\t{\n\t\tconst params = event.getData();\n\t\tif (this.scannerToken !== params.id || !Type.isStringFilled(params.barcode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (product.getBarcodeSelector()?.searchInput?.getNameInput() === document.activeElement)\n\t\t\t{\n\t\t\t\tproduct.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (\n\t\t\t\tproduct.getBarcodeSelector()?.searchInput?.getNameInput().value === ''\n\t\t\t\t&& product.getSelector()?.searchInput?.getNameInput().value === ''\n\t\t\t)\n\t\t\t{\n\t\t\t\tproduct.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst newRowId = this.addProductRow();\n\t\tthis.getProductById(newRowId)?.getBarcodeSelector().searchInput?.applyScannerData(params.barcode);\n\t}\n\n\t#initSupportCustomRowActions()\n\t{\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\n\t}\n\n\tselectProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(id)\n\t\t\t\t?.onProductSelect(productId)\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnSave(event: BaseEvent)\n\t{\n\t\tconst notification = ProductModel.getLastActiveSaveNotification();\n\t\tif (notification)\n\t\t{\n\t\t\tnotification.close();\n\t\t}\n\n\t\tconst items = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\tconst item = {\n\t\t\t\tfields: {...product.fields},\n\t\t\t\trowId: product.fields.ROW_ID\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\n\t\tthis.setSettingValue('items', items);\n\t}\n\n\thandleEditorSubmit(event: BaseEvent)\n\t{\n\t}\n\n\thandleProductListFocus(event: BaseEvent)\n\t{\n\t\tif (this.isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet listHaveEmptyRows = false;\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (product.isEmptyRow())\n\t\t\t{\n\t\t\t\tlistHaveEmptyRows = true;\n\t\t\t\tthis.focusProductSelector(product.fields['ROW_ID']);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!listHaveEmptyRows)\n\t\t{\n\t\t\tthis.handleProductRowAdd();\n\t\t}\n\t}\n\n\tonInnerCancel()\n\t{\n\t\tthis.reloadGrid(false);\n\t}\n\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tconst activePanel = container.querySelector('.catalog-document-product-list-add-block-' + panelCode);\n\t\tif (Type.isDomNode(activePanel))\n\t\t{\n\t\t\tDom.removeClass(activePanel, 'catalog-document-product-list-add-block-hidden');\n\t\t\tDom.addClass(activePanel, 'catalog-document-product-list-add-block-active');\n\t\t}\n\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\n\t\tconst removePanel = container.querySelector('.catalog-document-product-list-add-block-' + hiddenPanelCode);\n\t\tif (Type.isDomNode(removePanel))\n\t\t{\n\t\t\tDom.addClass(removePanel, 'catalog-document-product-list-add-block-hidden');\n\t\t\tDom.removeClass(removePanel, 'catalog-document-product-list-add-block-active');\n\t\t}\n\n\t\treturn activePanel;\n\t}\n\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\n\t{\n\t\tif (isInternalChanging === null)\n\t\t{\n\t\t\tisInternalChanging = !useProductsFromRequest;\n\t\t}\n\n\t\tthis.getGrid().reloadTable(\n\t\t\t'POST',\n\t\t\t{useProductsFromRequest},\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging})\n\t\t);\n\t}\n\n\t/*\n\t\tkeep in mind different actions for this handler:\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t */\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\n\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tuseProductsFromRequest,\n\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields(Editor.#getAjaxFields()) : null,\n\t\t};\n\n\t\tlet isDeletingRequest = false;\n\t\tif (eventArgs.data['action_button_' + eventArgs.gridId] === 'delete')\n\t\t{\n\t\t\tisDeletingRequest = true;\n\t\t}\n\n\t\tthis.clearEditor();\n\n\t\tif (isNativeAction)\n\t\t{\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', (event) => {\n\t\t\t\tconst [grid] = event.getCompatData();\n\n\t\t\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.actionUpdateTotalData({isInternalChanging: false});\n\t\t\t\tif (isDeletingRequest)\n\t\t\t\t{\n\t\t\t\t\tthis.executeActions([\n\t\t\t\t\t\t{type: this.actions.productListChanged},\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\thandleOnGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSettingsPopup().updateCheckboxState();\n\t}\n\n\thandleOnGridRowMoved(event: BaseEvent)\n\t{\n\t\tconst [ids, , grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.resortProductsByIds(ids);\n\t\tif (changed)\n\t\t{\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\n\t\t}\n\t}\n\n\tinitPageEventsManager(): void\n\t{\n\t\tconst componentId = this.getSettingValue('componentId');\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\n\t}\n\n\tgetPageEventsManager(): PageEventsManager\n\t{\n\t\tif (!this.pageEventsManager)\n\t\t{\n\t\t\tthis.initPageEventsManager();\n\t\t}\n\n\t\treturn this.pageEventsManager;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.getSettingValue('allowEdit', false) === true;\n\t}\n\n\tenableEdit()\n\t{\n\t\t// Cannot use editSelected because checkboxes have been removed\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((current) => {\n\t\t\tif (\n\t\t\t\t!current.isHeadChild()\n\t\t\t\t&& !current.isTemplate()\n\t\t\t\t&& !isEmptyObject(current.getEditData())\n\t\t\t)\n\t\t\t{\n\t\t\t\tcurrent.edit();\n\t\t\t}\n\t\t});\n\t}\n\n\taddFirstRowIfEmpty(): void\n\t{\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\trequestAnimationFrame(() => this.addProductRow());\n\t\t}\n\t}\n\n\tclearEditor()\n\t{\n\t\tthis.unsubscribeProductsEvents();\n\n\t\tthis.products = [];\n\t\tthis.productsWasInitiated = false;\n\n\t\tthis.destroySettingsPopup();\n\t\tthis.unsubscribeDomEvents();\n\t\tthis.unsubscribeCustomEvents();\n\n\t\tEvent.unbindAll(this.container);\n\t}\n\n\twasProductsInitiated()\n\t{\n\t\treturn this.productsWasInitiated;\n\t}\n\n\tunsubscribeProductsEvents()\n\t{\n\t\tthis.products.forEach((current) => {\n\t\t\tconst productSelector = current.getSelector();\n\t\t\tif (productSelector)\n\t\t\t{\n\t\t\t\tproductSelector.unsubscribeEvents();\n\t\t\t}\n\t\t\tconst barcodeSelector = current.getBarcodeSelector();\n\t\t\tif (barcodeSelector)\n\t\t\t{\n\t\t\t\tbarcodeSelector.unsubscribeEvents();\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.setForm(null);\n\t\tthis.clearController();\n\t\tthis.clearEditor();\n\t}\n\n\tsetController(controller)\n\t{\n\t\tif (this.controller === controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.clearProductList();\n\t\t}\n\t\tthis.controller = controller;\n\t}\n\n\tclearController()\n\t{\n\t\tthis.controller = null;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\t/* settings tools */\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings)\n\t{\n\t\tthis.settings = settings ? settings : {};\n\t}\n\n\tgetSettingValue(name: string, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value)\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tgetComponentName()\n\t{\n\t\treturn this.getSettingValue('componentName', '');\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getSettingValue('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getSettingValue('signedParameters', '');\n\t}\n\n\tgetContainerId()\n\t{\n\t\treturn this.getSettingValue('containerId', '');\n\t}\n\n\tgetGridId(): string\n\t{\n\t\treturn this.getSettingValue('gridId', '');\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.getSettingValue('languageId', '');\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.getSettingValue('siteId', '');\n\t}\n\n\tgetCatalogId()\n\t{\n\t\treturn this.getSettingValue('catalogId', 0);\n\t}\n\n\tisReadOnly()\n\t{\n\t\treturn this.getSettingValue('readOnly', true);\n\t}\n\n\tsetReadOnly(readOnly)\n\t{\n\t\tthis.setSettingValue('readOnly', readOnly);\n\t}\n\n\tgetCurrencyId(): string\n\t{\n\t\treturn this.getSettingValue('currencyId', '');\n\t}\n\n\tsetCurrencyId(currencyId): Promise\n\t{\n\t\tthis.setSettingValue('currencyId', currencyId);\n\t\treturn CurrencyCore.loadCurrencyFormat(currencyId);\n\t}\n\n\tisSalesOrdersDocument(): boolean\n\t{\n\t\tconst salesOrdersDocumentTypeCodes = ['REALIZATION', 'W'];\n\n\t\treturn salesOrdersDocumentTypeCodes.includes(this.settings.documentType);\n\t}\n\n\tchangeCurrencyId(currencyId): void\n\t{\n\t\tconst oldCurrencyId = this.getCurrencyId();\n\t\tif (oldCurrencyId === currencyId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis\n\t\t\t.setCurrencyId(currencyId)\n\t\t\t.then(() => {\n\t\t\t\tconst products = [];\n\t\t\t\tthis.products.forEach((product) => {\n\t\t\t\t\tproduct.getModel().setOption('currency', currencyId);\n\t\t\t\t\tproducts.push({\n\t\t\t\t\t\tfields: product.getFields(),\n\t\t\t\t\t\tid: product.getId()\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tif (products.length > 0)\n\t\t\t\t{\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tthis.getComponentName(),\n\t\t\t\t\t\t'calculateProductPrices',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tproducts,\n\t\t\t\t\t\t\t\tcurrencyId,\n\t\t\t\t\t\t\t\toldCurrencyId,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t\t\t.then(this.onCalculatePricesResponse.bind(this));\n\t\t\t\t}\n\n\t\t\t\tconst editData = this.getGridEditData();\n\t\t\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\n\n\t\t\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\n\t\t\t\tconst templateFieldNames = ['BASE_PRICE', 'PURCHASING_PRICE'];\n\n\t\t\t\ttemplateFieldNames.forEach((field) => {\n\t\t\t\t\tif (templateRow[field] && templateRow[field]['CURRENCY'])\n\t\t\t\t\t{\n\t\t\t\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.setGridEditData(editData);\n\t\t\t});\n\t}\n\n\tonCalculatePricesResponse(response)\n\t{\n\t\tconst products = response.data;\n\t\tthis.products.forEach((product) => {\n\t\t\tif (Type.isObject(products[product.getId()]))\n\t\t\t{\n\t\t\t\tproduct.updateField('BASE_PRICE', products[product.getId()]['BASE_PRICE']);\n\t\t\t\tproduct.updateField('PURCHASING_PRICE', products[product.getId()]['PURCHASING_PRICE']);\n\t\t\t\tproduct.updateUiCurrencyFields();\n\t\t\t}\n\t\t});\n\n\t\tthis.updateTotalDataDelayed();\n\t\tthis.updateTotalUiCurrency();\n\t}\n\n\tupdateTotalUiCurrency()\n\t{\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(totalBlock))\n\t\t{\n\t\t\tconst totalsList = ['totalCost'];\n\t\t\ttotalBlock.querySelectorAll('.catalog-document-product-list-result-grid-total').forEach((row) => {\n\t\t\t\tfor (const totalId of totalsList)\n\t\t\t\t{\n\t\t\t\t\tconst valueElement = row.querySelector('[data-total=\"' + totalId + '\"]');\n\t\t\t\t\tif (valueElement)\n\t\t\t\t\t{\n\t\t\t\t\t\trow.innerHTML = CurrencyCore.getPriceControl(valueElement, this.getCurrencyId());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetCurrencyText(): string\n\t{\n\t\tconst currencyId = this.getCurrencyId();\n\t\tif (!Type.isStringFilled(currencyId))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || '';\n\t}\n\n\tgetDataFieldName()\n\t{\n\t\treturn this.getSettingValue('dataFieldName', '');\n\t}\n\n\tgetDataSettingsFieldName()\n\t{\n\t\tconst field = this.getDataFieldName();\n\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetMeasures(): []\n\t{\n\t\treturn this.getSettingValue('measures', []);\n\t}\n\n\tgetDefaultMeasure()\n\t{\n\t\treturn this.getSettingValue('defaultMeasure', {});\n\t}\n\n\tgetRowIdPrefix()\n\t{\n\t\treturn this.getSettingValue('rowIdPrefix', 'catalog_entity_product_list_');\n\t}\n\n\t/* settings tools finish */\n\n\t/* calculate tools */\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isNegative)\n\t\t\t\t{\n\t\t\t\t\tresult = -result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseInt(value, 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\n\t\t\tconst dot = value.indexOf('.');\n\t\t\tconst comma = value.indexOf(',');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\n\t\t\tif (dot < 0 && comma >= 0)\n\t\t\t{\n\t\t\t\tlet s1 = value.substr(0, comma);\n\t\t\t\tconst decimalLength = value.length - comma - 1;\n\n\t\t\t\tif (decimalLength > 0)\n\t\t\t\t{\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\n\t\t\t\t}\n\n\t\t\t\tvalue = s1;\n\t\t\t}\n\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\n\t\t\tresult = parseFloat(value);\n\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\tif (isNegative)\n\t\t\t{\n\t\t\t\tresult = -result;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseFloat(value);\n\t\t}\n\n\t\tif (precision >= 0)\n\t\t{\n\t\t\tresult = this.round(result, precision);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tround(value: number, precision: number = DEFAULT_PRECISION)\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\t/* calculate tools finish */\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.getElementById(this.getContainerId());\n\t\t});\n\t}\n\n\tinitForm()\n\t{\n\t\tconst formId = this.getSettingValue('formId', '');\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\n\n\t\tif (Type.isElementNode(form))\n\t\t{\n\t\t\tthis.setForm(form);\n\t\t}\n\t}\n\n\tisExistForm()\n\t{\n\t\treturn Type.isElementNode(this.getForm());\n\t}\n\n\tgetForm()\n\t{\n\t\treturn this.form;\n\t}\n\n\tsetForm(form)\n\t{\n\t\tthis.form = form;\n\t}\n\n\tinitFormFields()\n\t{\n\t\tconst container = this.getForm();\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tconst field = this.getDataField();\n\t\t\tif (!Type.isElementNode(field))\n\t\t\t{\n\t\t\t\tthis.initDataField();\n\t\t\t}\n\n\t\t\tconst settingsField = this.getDataSettingsField();\n\t\t\tif (!Type.isElementNode(settingsField))\n\t\t\t{\n\t\t\t\tthis.initDataSettingsField();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\tcontainer.appendChild(Dom.create(\n\t\t\t\t'input',\n\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\n\t\t\t));\n\t\t}\n\t}\n\n\tremoveFormFields()\n\t{\n\t\tconst field = this.getDataField();\n\t\tif (Type.isElementNode(field))\n\t\t{\n\t\t\tDom.remove(field);\n\t\t}\n\n\t\tconst settingsField = this.getDataSettingsField();\n\t\tif (Type.isElementNode(settingsField))\n\t\t{\n\t\t\tDom.remove(settingsField);\n\t\t}\n\t}\n\n\tinitDataField()\n\t{\n\t\tthis.initFormField(this.getDataFieldName());\n\t}\n\n\tinitDataSettingsField()\n\t{\n\t\tthis.initFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetDataField()\n\t{\n\t\treturn this.getFormField(this.getDataFieldName());\n\t}\n\n\tgetDataSettingsField()\n\t{\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetProductCount()\n\t{\n\t\treturn this.products\n\t\t\t.filter(item => !item.isEmptyRow())\n\t\t\t.length\n\t\t;\n\t}\n\n\tinitProducts()\n\t{\n\t\tconst list = this.getSettingValue('items', []);\n\n\t\tfor (let item of list)\n\t\t{\n\t\t\tconst fields = {...item.fields};\n\t\t\tthis.products.push(new Row(item.rowId, fields, this.getSettingValue('rowSettings', {}), this));\n\t\t}\n\n\t\tthis.numerateRows();\n\t\tthis.productsWasInitiated = true;\n\n\t\tthis.updateTotalDataDelayed();\n\t}\n\n\tnumerateRows()\n\t{\n\t\tthis.products.forEach((product, index) => {\n\t\t\tproduct.setRowNumber(index + 1);\n\t\t})\n\t}\n\n\tgetGrid(): ?BX.Main.Grid\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\tconst gridId = this.getGridId();\n\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\n\t\t\t}\n\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\n\t\t});\n\t}\n\n\tgetGridColumnIndexes()\n\t{\n\t\treturn this.cache.remember('getGridColumnIndexes', () => {\n\t\t\tlet result = {};\n\n\t\t\tconst columns = this.getGrid().getHead().querySelectorAll('.main-grid-cell-head');\n\t\t\tfor (let i = 0; i < columns.length; i++) {\n\t\t\t\tconst node = columns[i];\n\t\t\t\tconst columnName = node.dataset.name;\n\n\t\t\t\tif (columnName)\n\t\t\t\t{\n\t\t\t\t\tresult[columnName] = i;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t});\n\t}\n\n\tinitGridData()\n\t{\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\t}\n\n\tpaintColumns()\n\t{\n\t\tconst paintedColumns = this.getSettingValue('paintedColumns', null);\n\t\tconst grid = this.getGrid();\n\t\tif (grid && Type.isArray(paintedColumns))\n\t\t{\n\t\t\tpaintedColumns.forEach((columnName) => {\n\t\t\t\tconst rows = grid.getRows().getRows();\n\t\t\t\trows.forEach((current) => {\n\t\t\t\t\tconst cell = current.getCellById(columnName);\n\t\t\t\t\tif (cell)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(cell, 'main-grid-cell-light-blue-background');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\tgetColumnInfo(code: string)\n\t{\n\t\treturn this.getGrid()?.arParams?.COLUMNS_ALL[code] || {};\n\t}\n\n\tsetGridEditData(data: {})\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\thandleProductErrorsChange()\n\t{\n\t\tif (this.#childrenHasErrors())\n\t\t{\n\t\t\tthis.controller.disableSaveButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.controller.enableSaveButton();\n\t\t}\n\t}\n\n\t#childrenHasErrors()\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\n\t\t\t.length > 0\n\t\t\t;\n\t}\n\n\thandleFieldChange(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tif (row && row.hasAttribute('data-id'))\n\t\t{\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tlet fieldCode = event.target.getAttribute('data-name');\n\t\t\t\tif (!Type.isStringFilled(fieldCode))\n\t\t\t\t{\n\t\t\t\t\tconst cell = event.target.closest('td');\n\t\t\t\t\tfieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t\t\t}\n\n\t\t\t\tif (fieldCode)\n\t\t\t\t{\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleFieldBlur(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tconst value = event.target.value;\n\t\tlet fieldCode = event.target.getAttribute('data-name');\n\t\tif (!Type.isStringFilled(fieldCode))\n\t\t{\n\t\t\tconst cell = event.target.closest('td');\n\t\t\tfieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t}\n\n\t\tif (this.isSalesOrdersDocument() && fieldCode === 'AMOUNT' && value <= 0)\n\t\t{\n\t\t\tevent.target.value = 1;\n\t\t\tthis.handleFieldChange(event);\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\twidth: 'auto',\n\t\t\t\tcontent: Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_INVALID_AMOUNT_REALIZATION'),\n\t\t\t});\n\t\t}\n\t}\n\n\thandleDropdownChange(event: BaseEvent)\n\t{\n\t\tconst [dropdownId, , , , value] = event.getData();\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\n\t\tconst matches = dropdownId.match(regExp);\n\t\tif (matches)\n\t\t{\n\t\t\tconst [, rowId, fieldCode] = matches;\n\t\t\tconst product = this.getProductById(rowId);\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tproduct.updateDropdownField(fieldCode, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProductById(id: string): ?Row\n\t{\n\t\tconst rowId = this.getRowIdPrefix() + id;\n\n\t\treturn this.getProductByRowId(rowId);\n\t}\n\n\tgetProductByRowId(rowId: string): ?Row\n\t{\n\t\treturn this.products.find((row: Row) => {\n\t\t\treturn row.getId() === rowId;\n\t\t});\n\t}\n\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\n\t{\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\n\t\t\tconst index = [...row.cells].indexOf(cell);\n\n\t\t\treturn headRow.getCellNameByCellIndex(index);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddProductRow(anchorProduct: Row = null): string\n\t{\n\t\tconst row = this.createGridProductRow();\n\t\tconst newId = row.getId();\n\n\t\tif (anchorProduct)\n\t\t{\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\n\t\t\tif (anchorRowNode)\n\t\t\t{\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\n\t\t\t}\n\t\t}\n\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\n\t\tthis.getGrid().bindOnRowEvents();\n\t\treturn newId;\n\t}\n\n\thandleProductRowAdd(): void\n\t{\n\t\tconst id = this.addProductRow();\n\t\tthis.focusProductSelector(id);\n\t}\n\n\thandleProductRowCreate(): void\n\t{\n\t}\n\n\thandleShowBarcodeSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\thandleShowSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\tdestroySettingsPopup()\n\t{\n\t\tif (this.cache.has('settings-popup'))\n\t\t{\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\n\t\t\tthis.cache.delete('settings-popup');\n\t\t}\n\t}\n\n\tgetSettingsPopup()\n\t{\n\t\treturn this.cache.remember('settings-popup', () => {\n\t\t\treturn new SettingsPopup(\n\t\t\t\tthis.getContainer().querySelector('.catalog-document-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\n\t\t\t\tthis.getSettingValue('popupSettings', []),\n\t\t\t\tthis\n\t\t\t);\n\t\t});\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.cache.remember('hint-popup', () => {\n\t\t\treturn new HintPopup(this);\n\t\t});\n\t}\n\n\tcreateGridProductRow(): BX.Grid.Row\n\t{\n\t\tconst newId = Text.getRandom();\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\n\n\t\tconst grid = this.getGrid();\n\t\tlet newRow;\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tnewRow = grid.appendRowEditor();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewRow = grid.prependRowEditor();\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tnewNode.setAttribute('data-id', newId);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\n\t\treturn newRow;\n\t}\n\n\thandleDeleteRow(rowId, event: BaseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tconst row = this.getProductByRowId(rowId);\n\t\tif (row)\n\t\t{\n\t\t\tthis.deleteRow(rowId);\n\t\t}\n\t}\n\n\tredefineTemplateEditData(newId: string)\n\t{\n\t\tconst data = this.getGridEditData();\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\n\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\n\n\t\treturn originalTemplateData;\n\t}\n\n\tprepareCustomEditData(originalEditData, newId)\n\t{\n\t\tconst customEditData = {};\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\n\t\t\t\t\t\tnewId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\n\t{\n\t\tlet fields = {};\n\t\tif (anchorProduct !== null)\n\t\t{\n\t\t\tfields = Object.assign(fields, anchorProduct?.getFields());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfields = {\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\n\t\t\t\t...{\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (Type.isNil(anchorProduct) && this.products.length > 0)\n\t\t{\n\t\t\tconst previousRow =\n\t\t\t\tthis.getSettingValue('newRowPosition') === 'bottom'\n\t\t\t\t\t? this.products[this.products.length - 1]\n\t\t\t\t\t: this.products[0]\n\t\t\t;\n\t\t\tconst stores = this.getSettingValue('stores', {});\n\t\t\tconst storeFields = previousRow.getSettingValue('storeHeaderMap', {});\n\t\t\tObject.values(storeFields).forEach((field) => {\n\t\t\t\tconst previousStoreValue = previousRow.getField(field);\n\t\t\t\tif (Type.isNil(stores[previousStoreValue]))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfields[field] = previousRow.getField(field);\n\t\t\t\tconst titleName = field + '_TITLE';\n\t\t\t\tfields[titleName] = previousRow.getField(titleName);\n\t\t\t});\n\t\t}\n\n\t\tconst rowId = this.getRowIdPrefix() + newId;\n\t\tfields.ID = newId;\n\t\tfields.ROW_ID = newId;\n\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t{\n\t\t\tdelete(fields.IMAGE_INFO.input);\n\t\t}\n\t\tconst product = new Row(\n\t\t\trowId,\n\t\t\tfields,\n\t\t\tthis.getSettingValue('rowSettings', {}),\n\t\t\tthis\n\t\t);\n\n\t\tif (anchorProduct instanceof Row)\n\t\t{\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\n\n\t\t\tproduct.refreshFieldsLayout();\n\t\t}\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tthis.products.push(product);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.products.unshift(product);\n\t\t}\n\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tproduct.updateUiCurrencyFields();\n\t\tthis.updateTotalUiCurrency();\n\n\t\treturn product;\n\t}\n\n\tgetProductSelector(newId: string): ?ProductSelector\n\t{\n\t\treturn this.getProductById(newId).getSelector();\n\t}\n\n\tfocusProductSelector(newId: string): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(newId)\n\t\t\t\t?.searchInDialog()\n\t\t\t\t.focusName()\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnBeforeProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst product = this.getProductByRowId(data.rowId);\n\t\tif (product)\n\t\t{\n\t\t\tthis.getGrid().tableFade();\n\t\t\tproduct.resetExternalActions();\n\t\t}\n\t}\n\n\thandleOnProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tconst productRow = this.getProductByRowId(data.rowId);\n\t\tif (productRow && data.fields)\n\t\t{\n\t\t\tdelete data.fields.ID;\n\t\t\tproductRow.setFields(data.fields);\n\t\t\tObject.keys(data.fields).forEach((key) => {\n\t\t\t\tproductRow.updateFieldValue(key, data.fields[key]);\n\t\t\t});\n\n\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\n\t\t\tproductRow.getSelector()?.layout();\n\t\t\tproductRow.getBarcodeSelector()?.layout();\n\t\t\tproductRow.updateProductStoreValues();\n\n\t\t\tproductRow.initHandlersForSelectors();\n\t\t\tproductRow.layoutStoreSelector(productRow.getSettingValue('storeHeaderMap', {}));\n\t\t\tproductRow.layoutBarcode();\n\t\t\tproductRow.executeExternalActions();\n\n\t\t\tif (this.isSalesOrdersDocument())\n\t\t\t{\n\t\t\t\tproductRow.changeAmount(productRow.getAmount() > 0 ? productRow.getAmount() : 1);\n\t\t\t}\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t}\n\n\thandleOnProductClear(event: BaseEvent)\n\t{\n\t\tconst {selectorId, rowId} = event.getData();\n\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tif (product && product.getSelector().getId() === selectorId)\n\t\t{\n\t\t\tproduct.initHandlersForSelectors();\n\t\t\tproduct.setMeasure(this.getDefaultMeasure());\n\t\t\tproduct.changePurchasingPrice(0);\n\t\t\tproduct.changeBasePrice(0);\n\t\t\tproduct.changeAmount(0);\n\t\t\tproduct.updateUiStoreValues();\n\t\t\tproduct.updateProductStoreValues();\n\t\t\tproduct.changeBarcode('');\n\t\t\tproduct\n\t\t\t\t.getBarcodeSelector()\n\t\t\t\t?.setConfig('ENABLE_SEARCH', true)\n\t\t\t\t.layout()\n\t\t\t;\n\t\t\tproduct.executeExternalActions();\n\t\t}\n\t}\n\n\tcompileProductData(): void\n\t{\n\t\tif (!this.isExistForm())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.initFormFields();\n\n\t\tconst field = this.getDataField();\n\t\tconst settingsField = this.getDataSettingsField();\n\n\t\tthis.cleanProductRows();\n\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\n\t\t{\n\t\t\tfield.value = this.prepareProductDataValue();\n\t\t}\n\t}\n\n\tprepareProductDataValue(): string\n\t{\n\t\tlet productDataValue = '';\n\n\t\tif (this.getProductCount())\n\t\t{\n\t\t\tconst productData = [];\n\n\t\t\tthis.products.forEach((item) => {\n\t\t\t\tconst itemFields = item.getFields(Editor.#getAjaxFields());\n\n\t\t\t\tif (!/^[0-9]+$/.test(itemFields['ID']))\n\t\t\t\t{\n\t\t\t\t\titemFields['ID'] = 0;\n\t\t\t\t}\n\n\t\t\t\titemFields['CUSTOMIZED'] = 'Y';\n\n\t\t\t\tproductData.push(itemFields);\n\t\t\t});\n\n\t\t\tproductDataValue = JSON.stringify(productData);\n\t\t}\n\n\t\treturn productDataValue;\n\t}\n\n\tstatic #getAjaxFields(): []\n\t{\n\t\treturn [\n\t\t\t'ID',\n\t\t\t'SKU_ID',\n\t\t\t'AMOUNT',\n\t\t\t'PURCHASING_PRICE',\n\t\t\t'BASE_PRICE',\n\t\t\t'BASE_PRICE_EXTRA',\n\t\t\t'BASE_PRICE_EXTRA_RATE',\n\t\t\t'COMMENT',\n\t\t\t'DOC_BARCODE',\n\t\t\t'BARCODE',\n\t\t\t'STORE_TO',\n\t\t\t'STORE_FROM',\n\t\t\t'BASE_PRICE_ID',\n\t\t\t'BASKET_ID',\n\t\t\t'DOC_ID',\n\t\t\t'ELEMENT_ID',\n\t\t\t'IBLOCK_ID',\n\t\t\t'MEASURE_CODE',\n\t\t\t'MEASURE_NAME',\n\t\t\t'NAME',\n\t\t\t'OFFERS_IBLOCK_ID',\n\t\t\t'PARENT_PRODUCT_ID',\n\t\t\t'PRODUCT_ID',\n\t\t\t'ROW_ID',\n\t\t\t'STORE_FROM_AMOUNT',\n\t\t\t'STORE_FROM_AVAILABLE_AMOUNT',\n\t\t\t'STORE_FROM_RESERVED',\n\t\t\t'STORE_FROM_TITLE',\n\t\t\t'STORE_TO_AMOUNT',\n\t\t\t'STORE_TO_AVAILABLE_AMOUNT',\n\t\t\t'STORE_TO_RESERVED',\n\t\t\t'STORE_TO_TITLE',\n\t\t\t'TOTAL_PRICE',\n\t\t\t'TYPE',\n\t\t];\n\t}\n\n\t/* actions */\n\texecuteActions(actions)\n\t{\n\t\tif (!Type.isArrayFilled(actions))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let item of actions)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(item)\n\t\t\t\t|| !Type.isStringFilled(item.type)\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (item.type)\n\t\t\t{\n\t\t\t\tcase this.actions.productChange:\n\t\t\t\t\tthis.actionSendProductChange(item);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.productListChanged:\n\t\t\t\t\tthis.actionSendProductListChanged();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateTotal:\n\t\t\t\t\tthis.actionUpdateTotalData();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tactionSendProductChange(item)\n\t{\n\t\tif (!Type.isStringFilled(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.getProductByRowId(item.id);\n\t\tif (!product)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// EventEmitter.emit(this, 'ProductList::onChangeFields', {\n\t\t// \trowId: item.id,\n\t\t// \tproductId: product.getField('PRODUCT_ID'),\n\t\t// \tfields: this.getProductByRowId(item.id).getCatalogFields()\n\t\t// });\n\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange();\n\t\t}\n\t}\n\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t}\n\t}\n\n\tactionUpdateListField(item)\n\t{\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateFieldForList = item.field;\n\n\t\tfor (let row of this.products)\n\t\t{\n\t\t\trow.updateFieldByName(item.field, item.value);\n\t\t}\n\n\t\tthis.updateFieldForList = null;\n\t}\n\n\tactionUpdateTotalData(options = {})\n\t{\n\t\tthis.updateTotalDataDelayedHandler(options);\n\t}\n\n\t/* actions finish */\n\n\tupdateTotalDataDelayed(options = {})\n\t{\n\t\tlet totalCost = 0;\n\t\tconst field = this.getSettingValue('totalCalculationSumField', 'PURCHASING_PRICE');\n\t\tthis.products.forEach(item => totalCost += Text.toNumber(item.getField(field)) * Text.toNumber(item.getField('AMOUNT')));\n\t\tthis.setTotalData({totalCost});\n\t}\n\n\tgetProductsFields(fields: Array = [])\n\t{\n\t\tconst productFields = [];\n\n\t\tfor (let item of this.products)\n\t\t{\n\t\t\tproductFields.push(item.getFields(fields));\n\t\t}\n\n\t\treturn productFields;\n\t}\n\n\tsetTotalData(data)\n\t{\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\tconst currencyId = this.getCurrencyId();\n\t\t\tconst list = ['totalCost'];\n\n\t\t\tfor (const id of list)\n\t\t\t{\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\n\t\t\t\t{\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.controller?.setTotal(data);\n\t}\n\n\t/* action tools finish */\n\n\t/* ajax tools */\n\t// ajaxRequest(action, data)\n\t// {\n\t// \tif (!Type.isPlainObject(data.options))\n\t// \t{\n\t// \t\tdata.options = {};\n\t// \t}\n\t// \tdata.options.ACTION = action;\n\t// \tajax.runComponentAction(\n\t// \t\tthis.getComponentName(),\n\t// \t\taction,\n\t// \t\t{\n\t// \t\t\tmode: 'class',\n\t// \t\t\tsignedParameters: this.getSignedParameters(),\n\t// \t\t\tdata: data\n\t// \t\t}\n\t// \t).then(\n\t// \t\t(response) => this.ajaxResultSuccess(response, data.options),\n\t// \t\t(response) => this.ajaxResultFailure(response)\n\t// \t);\n\t// }\n\t//\n\t// ajaxResultSuccess(response, requestOptions)\n\t// {\n\t// \tif (!this.ajaxResultCommonCheck(response))\n\t// \t{\n\t// \t\treturn;\n\t// \t}\n\t//\n\t// \tswitch (response.data.action)\n\t// \t{\n\t// \t\tcase 'calculateTotalData':\n\t// \t\t\t// if (Type.isPlainObject(response.data.result))\n\t// \t\t\t// {\n\t// \t\t\t// \tthis.setTotalData(response.data.result, requestOptions);\n\t// \t\t\t// }\n\t//\n\t// \t\t\tbreak;\n\t// \t\tcase 'calculateProductPrices':\n\t// \t\t\tif (Type.isPlainObject(response.data.result))\n\t// \t\t\t{\n\t// \t\t\t\tthis.onCalculatePricesResponse(response.data.result);\n\t// \t\t\t}\n\t//\n\t// \t\t\tbreak;\n\t// \t}\n\t// }\n\n\t// ajaxResultFailure(response)\n\t// {\n\t//\n\t// }\n\n\tajaxResultCommonCheck(responce)\n\t{\n\t\tif (!Type.isPlainObject(responce))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (responce.status !== 'success')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.data.action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection RedundantIfStatementJS\n\t\tif (!('result' in responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tdeleteRow(row: Row): void\n\t{\n\t\tconst gridRow = this.getGrid().getRows().getById(row.getField('ID'));\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t}\n\n\t\tconst index = this.products.indexOf(row);\n\t\tif (index > -1)\n\t\t{\n\t\t\tthis.products.splice(index, 1);\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.addFirstRowIfEmpty();\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcopyRow(row: Row): void\n\t{\n\t\tthis.addProductRow(row)\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcleanProductRows(): void\n\t{\n\t\tthis.products\n\t\t\t.filter(item => item.isEmptyRow())\n\t\t\t.forEach((row) => this.deleteRow(row))\n\t\t;\n\t}\n\n\tresortProductsByIds(ids: Array): boolean\n\t{\n\t\tlet changed = false;\n\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tthis.products.sort((a, b) => {\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tchanged = true;\n\n\t\t\t\treturn -1;\n\t\t\t});\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\trefreshSortFields(): void\n\t{\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10, false));\n\t}\n\n\thandleOnTabShow(): void\n\t{\n\t\tEventEmitter.emit('onDemandRecalculateWrapper', [this]);\n\t}\n\n\tcloseBarcodeSpotlights(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.removeSpotlight();\n\t\t})\n\n\t\tthis.setSettingValue('showBarcodeSpotlightInfo',false);\n\t}\n\n\tcloseBarcodeQrAuths(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.removeQrAuth();\n\t\t})\n\n\t\tthis.setSettingValue('showBarcodeQrAuth',false);\n\t}\n\n\tenableSendBarcodeMobilePush(): void\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tproduct.getBarcodeSelector()?.setConfig('IS_INSTALLED_MOBILE_APP', true);\n\t\t})\n\n\t\tthis.setSettingValue('isInstalledMobileApp', true);\n\t}\n\n\tvalidate(): Array\n\t{\n\t\tif (this.getProductCount() === 0)\n\t\t{\n\t\t\treturn [Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_IS_EMPTY')];\n\t\t}\n\n\t\tlet errorsArray = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\terrorsArray = errorsArray.concat(product.validate());\n\t\t});\n\n\t\treturn errorsArray;\n\t}\n\n\tshowFieldTourHint(fieldName: string, tourData: Object, endTourHandler: Function, addictedFields: Array<string> = [], rowId: string = ''): void\n\t{\n\t\tif (this.products.length > 0)\n\t\t{\n\t\t\tlet productNode = this.products[0].getNode();\n\t\t\tif (this.getProductByRowId(rowId))\n\t\t\t{\n\t\t\t\tproductNode = this.getProductByRowId(rowId).getNode();\n\t\t\t}\n\n\t\t\tconst addictedNodes = [];\n\t\t\tfor (const fieldName of addictedFields)\n\t\t\t{\n\t\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\t\t\t\tif (fieldNode !== null)\n\t\t\t\t{\n\t\t\t\t\taddictedNodes.push(fieldNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\n\t\t\tif (fieldNode !== null)\n\t\t\t{\n\t\t\t\tthis.#fieldHintManager.processFieldTour(fieldNode, tourData, endTourHandler, addictedNodes);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\treturn this.#fieldHintManager.getActiveHint();\n\t}\n\n\tgetRestrictedProductTypes(): Array\n\t{\n\t\treturn this.getSettingValue('restrictedProductTypes', []);\n\t}\n\n\tprocessApplyActionButtonClick(actionId: string): void\n\t{\n\t\tif (actionId === 'STORE_FROM_INFO' || actionId === 'STORE_TO_INFO')\n\t\t{\n\t\t\tthis.#processSetStoryAction(actionId);\n\t\t}\n\t}\n\n\t#processSetStoryAction(actionId)\n\t{\n\t\tconst actionPanel = this.getGrid()?.getActionsPanel();\n\t\tconst actionValues = actionPanel?.getValues();\n\t\tconst actionStoreId = actionValues[actionId];\n\t\tif (!actionValues || Type.isUndefined(actionStoreId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst selectedRows  = this.getGrid().getRows().getSelected();\n\t\tif (selectedRows.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst stores = this.getSettingValue('stores', {});\n\t\tconst actionStore = stores[actionStoreId];\n\t\tif (!Type.isNil(actionStore))\n\t\t{\n\t\t\tconst actionStoreName = actionStore?.TITLE || '';\n\n\t\t\tselectedRows.forEach((row) => {\n\t\t\t\tconst selectedItem = this.products.find(product => product.getField('ID') === row.getId());\n\t\t\t\tif (selectedItem)\n\t\t\t\t{\n\t\t\t\t\tconst storeSelector = StoreSelector.getById(selectedItem.getId() + '_' + actionId);\n\t\t\t\t\tif (storeSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tstoreSelector.onStoreSelect(actionStoreId, actionStoreName);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst documentTypeMoving = 'M';\n\t\t\tconst messageId =\n\t\t\t\tthis.settings.documentType !== documentTypeMoving\n\t\t\t\t\t? 'CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_STORE_CHANGED_HINT'\n\t\t\t\t\t: 'CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_' + actionId + '_CHANGED_HINT'\n\t\t\t;\n\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage(messageId, {'#STORE_NAME#': Text.encode(actionStoreName)}),\n\t\t\t\tautoHide: true,\n\t\t\t\tautoHideDelay: 4000,\n\t\t\t});\n\t\t}\n\n\t\tconst dropdown = actionPanel.getDropdowns().find(dropdown => dropdown.id === 'actionListId_control');\n\t\tif (dropdown)\n\t\t{\n\t\t\tactionPanel.removeItemsRelativeCurrent(dropdown.parentNode);\n\t\t\tDom.attr(dropdown, 'data-value', null);\n\t\t\tconst innerWrapper = dropdown.querySelector('.main-dropdown-inner');\n\t\t\tif (innerWrapper)\n\t\t\t{\n\t\t\t\tinnerWrapper.innerText = Loc.getMessage('CATALOG_DOCUMENT_PRODUCT_LIST_ACTION_DEFAULT');\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["HintPopup","editor","babelHelpers","classCallCheck","createClass","key","value","load","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","setBindElement","adjustPosition","setContent","Tag","render","_templateObject","taggedTemplateLiteral","Text","encode","show","close","_fields","WeakMap","PriceCalculator","fields","_classPrivateFieldInitSpec","writable","basePrice","finalPrice","extra","extraType","EXTRA_TYPE_PERCENTAGE","classPrivateFieldSet","_objectSpread","classPrivateFieldGet","getBasePrice","getFinalPrice","getExtra","getExtraType","calculateBasePrice","toNumber","EXTRA_TYPE_MONETARY","calculateFinalPrice","calculateExtra","Type","isNil","calculateExtraType","defineProperty","AccessDeniedInput","options","Loc","getMessage","hint","isReadOnly","renderTo","className","block","innerHTML","appendChild","BX","UI","Hint","createInstance","popupParameters","angle","offset","init","MODE_EDIT","MODE_SET","_initActions","WeakSet","_initSelector","_initSimpleFields","_initBarcode","_initPriceExtra","_initStoreSelector","_onStoreFieldChange","_getRealValues","_getCalculator","_handleProductErrorsChange","_handleBeforeCreateProduct","_handleSpotlightClose","_handleBarcodeQrClose","_handleBarcodeScannerInstallCheck","_handleBarcodeChange","_subscribeFieldToValidator","_isProductCountCorrect","_getNodeChildByDataName","_needInventory","_needBarcode","_isRowAccessDenied","_hideFields","_isPurchasingPriceAccessDenied","_hidePurchasingPrice","Row","id","settings","_classPrivateMethodInitSpec","Cache","MemoryCache","EDIT","SET","Map","setId","setSettings","setEditor","setModel","initFields","_classPrivateMethodGet","_initSelector2","call","_initBarcode2","_initSimpleFields2","_initStoreSelector2","getSettingValue","_initActions2","_hideFields2","requestAnimationFrame","initHandlers","bind","getNode","_this","cache","remember","rowId","getField","getEditorContainer","querySelector","getSelector","mainSelector","getBarcodeSelector","barcodeSelector","getSettings","isPlainObject","name","defaultValue","hasOwnProperty","setSettingValue","getEditor","getContainer","getHintPopup","querySelectorAll","forEach","Event","changeProductFieldHandler","event","stopPropagation","blurProductFieldHandler","initHandlersForSelectors","_this2","selectorNames","storeFields","concat","toConsumableArray","Object","keys","layoutBarcode","barcodeWrapper","_needBarcode2","layoutStoreSelector","fieldNames","_this3","rowName","selectorId","storeSelectors","selector","storeWrapper","_needInventory2","setRowNumber","number","textContent","getFields","arguments","length","undefined","result","isArrayFilled","Runtime","clone","_iterator","_createForOfIteratorHelper","_step","s","n","done","fieldName","err","e","f","realValues","_getRealValues2","getModel","setFields","setField","changeModel","getUiFieldId","field","getAmount","updateFieldByEvent","fieldCode","target","type","checked","mode","updateField","updateDropdownField","resetExternalActions","updateFieldValue","executeExternalActions","code","changeProductId","changeBasePrice","changePurchasingPrice","changeAmount","changeMeasureCode","changeBarcode","changeStore","changeStoreName","changeProductName","changeSort","changeComment","updateFieldByName","setTaxIncluded","preparedValue","parseInt","setProductId","handleCopyAction","menuItem","_this$getEditor","copyRow","menu","getMenuWindow","destroy","handleDeleteAction","_this$getEditor2","deleteRow","unsubscribeEvents","_handleProductErrorsChange2","handleSelectExtraPriceType","changeExtraType","getCurrencyText","calculator","_getCalculator2","changeExtra","isDomNode","parseFloat","getPricePrecision","setBasePrice","_isPurchasingPriceAccessDenied2","setPurchasingPrice","getQuantityPrecision","setAmount","_this4","getMeasures","filter","item","CODE","setMeasure","toString","isChangedValue","addActionProductChange","setStoreAmount","trim","refreshFieldsLayout","_this$getSelector","_this$getSelector2","_this$getBarcodeSelec","exceptFields","includes","updateUiField","updateUiMeasure","reloadFileInput","layout","updateUiStoreValues","model","ProductModel","getById","currency","getCurrencyId","iblockId","basePriceId","skuTree","isStringFilled","JSON","parse","storeMap","isObject","getImageCollection","setPreview","setEditInput","setMorePhotoValues","setDetailPath","EventEmitter","subscribe","debounce","addActionUpdateTotal","_hidePurchasingPrice2","Math","max","toFixed","updateRowTotalPrice","updateProductStoreValues","_this5","getSkuId","_this6","storeHeaderMap","currentAmount","getStoreCollection","getStoreAmount","maxStore","getMaxFilledStore","storeSelector","StoreSelector","AMOUNT","onStoreSelect","STORE_ID","STORE_TITLE","_this7","isInited","amount","amounts","_AMOUNT","_RESERVED","getStoreReserved","_AVAILABLE_AMOUNT","getStoreAvailableAmount","postfix","wrapper","_getNodeChildByDataName2","amountWithMeasure","htmlAmount","updateUiInputField","measure","_this8","isEmpty","SYMBOL","showSaveNotifier","title","declineCancelTitle","events","onSave","save","onCancel","getInputByFieldName","fieldId","document","getElementById","isElementNode","getInputWrapperByFieldName","inputBlock","parentNode","updateUiCheckboxField","getMoneyFieldDropdownApi","Reflection","getClass","Main","dropdownManager","updateMoneyFieldUiWithDropdownApi","dropdown","getValue","itemsContainer","getMenuItem","refresh","selectItem","updateUiMoneyField","dataset","span","updateUiHtmlField","html","updateUiCurrencyFields","_this9","currencyText","currencyId","currencyFieldNames","dropdownValues","push","NAME","VALUE","Dom","attr","uiName","getUiFieldName","uiType","getUiFieldType","util","number_format","CurrencyCore","currencyFormat","moneyFields","_this$getEditor3","_column$editable","column","getColumnInfo","editable","TYPE","precision","getCommonPrecision","externalActions","addExternalAction","action","actions","productChange","updateTotal","executeActions","isEmptyRow","validate","errorsList","_isProductCountCorrect2","_subscribeFieldToValidator2","_this10","actionCellContentContainer","actionsButton","menuItems","onclick","PopupMenu","bindElement","items","preventDefault","append","selectorOptions","getIblockId","getBasePriceId","getCurrency","config","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","ENABLE_EMPTY_PRODUCT_ERROR","RESTRICTED_PRODUCT_TYPES","getRestrictedProductTypes","URL_BUILDER_CONTEXT","ProductSelector","mainInfoNode","numberSelector","_templateObject2","selectorWrapper","_templateObject3","_handleBeforeCreateProduct2","_i","_fields2","input","inputFieldName","INPUT_FIELD_BARCODE","ENABLE_INFO_SPOTLIGHT","ENABLE_BARCODE_QR_AUTH","IS_INSTALLED_MOBILE_APP","ENABLE_SKU_TREE","scannerToken","_handleSpotlightClose2","_handleBarcodeQrClose2","_handleBarcodeScannerInstallCheck2","_handleBarcodeChange2","_this12","inputFieldId","inputFieldTitle","isDisabledEmpty","_onStoreFieldChange2","_this13","data","getData","parsedValue","atob","console","error","isNumber","errors","getErrorCollection","getErrors","ErrorCodes","NOT_SELECTED_PRODUCT","NOT_SELECTED_STORE","layoutErrors","handleProductErrorsChange","_event$getData","getNameInputFilledValue","closeBarcodeSpotlights","closeBarcodeQrAuths","enableSendBarcodeMobilePush","_event$getData2","validatorCallback","_this14","fieldInput","fieldWrapper","valueAsNumber","validatingFields","get","set","classList","add","validator","eventObject","Boolean","unbind","remove","amountValue","isService","_isRowAccessDenied2","_this15","hiddenFields","columnIndexes","getGridColumnIndexes","columnIndex","fieldWithHintIndex","fieldWithHintNode","priceNode","contentNode","style","display","PageEventsManager","_settings","eventHandlers","registerEventHandler","eventName","eventHandler","addCustomEvent","fireEvent","eventParams","onCustomEvent","unregisterEventHandlers","i","removeCustomEvent","_target","_editor","_cache","_getSetting","_prepareSettingsContent","_getSettingItem","_setSetting","_requestGridSettings","_showNotification","SettingsPopup","getPopup","random","autoHide","draggable","offsetLeft","offsetTop","position","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","content","_prepareSettingsContent2","updateCheckboxState","popupContainer","getContentContainer","isArray","columns","allColumnsExist","columnName","getGrid","getColumnHeaderCellByName","checkbox","_getSetting2","_getSettingItem2","settingId","descriptionNode","desc","setting","_templateObject4","_setSetting2","settingItem","settingEnabled","_requestGridSettings2","enabled","headers","cells","getRows","getHeadFirstChild","getCells","Array","from","header","ajax","runComponentAction","getComponentName","signedParameters","getSignedParameters","selected","currentHeaders","then","panel","activePanel","changeActivePanelButtons","settingButton","reloadGrid","message","_showNotification2","replace","category","Notification","Center","notify","stack","width","autoHideDelay","_gridGetter","_contentContainer","_bindGridNodeVisionChange","_getPossibleToValidateFieldNodes","_fieldNodeIsInGridVision","_bindSpotlightToNode","_freezeGridContainer","_tieTourToNode","FieldHintManager","contentContainer","gridGetter","processFieldTour","fieldNode","tourData","endTourHandler","addictedFieldNodes","fieldHintIsBusy","onClose","activeHintGuide","_fieldNodeIsInGridVision2","tourObject","_tieTourToNode2","_freezeGridContainer2","gridContainer","leftArrow","rightArrow","fieldPos","getClientRects","x","gridPos","spotlight","_bindSpotlightToNode2","_bindGridNodeVisionChange2","getActiveHint","Guide","observedNode","onSuccessVisionCallback","_classPrivateMethodGe","callbackParams","addictedNodes","observedNodes","_getPossibleToValidateFieldNodes2","apply","observer","_classPrivateMethodGe2","getScrollContainer","window","mainNode","_babelHelpers$classPr","_babelHelpers$classPr2","nodesTuple","_len","_key","_addictedNodes","addictedNode","nodeRect","mainNodeTupleEl","sort","firstEl","secondEl","firstX","secondX","gridRect","widthIsValid","leftPos","rightPos","abs","lastEl","pop","shift","firstElDistance","lastElDistance","map","el","_babelHelpers$classPr3","_babelHelpers$classPr4","gridLeftEdge","gridRightEdge","_len2","fieldNodes","_key2","_i2","_fieldNodes","_fieldNode$getClientR","fieldRect","fieldLeftEdge","fieldRightEdge","targetNode","SpotLight","targetElement","autoSave","targetVertex","zIndex","container","pointerEvents","onCloseCallback","clickObserver","setTimeout","tourTarget","guide","steps","assign","onEvents","showNextStep","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","isEmptyObject","obj","_fieldHintManager","_initSupportCustomRowActions","_childrenHasErrors","_processSetStoryAction","Editor","productListChanged","updateListField","handleProductRowAdd","handleProductRowCreate","handleShowBarcodeSettingsPopup","handleShowSettingsPopup","handleOnSave","handleEditorSubmit","handleProductListFocus","handleOnBeforeGridRequest","handleOnGridUpdated","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnProductClear","handleDropdownChange","handleMobileScanEvent","handleFieldChange","handleFieldBlur","updateTotalDataDelayed","_this$scannerToken","getRandom","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","paintColumns","emit","_initSupportCustomRowActions2","subscribeDomEvents","subscribeCustomEvents","buttonBlock","addButton","productRowAddHandler","productRowCreateHandler","configButton","showSettingsPopupHandler","showBarcodeSettingsPopupHandler","unsubscribeDomEvents","selectButton","productSelectionPopupHandler","createButton","onSaveHandler","onEditorSubmit","onFocusToProductList","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onProductClearHandler","dropdownChangeHandler","onScanEmitHandler","unsubscribeCustomEvents","unsubscribe","_this$getProductById","_this$getProductById$","params","barcode","products","_product$getBarcodeSe","_product$getBarcodeSe2","product","searchInput","getNameInput","activeElement","_product$getBarcodeSe3","applyScannerData","_iterator2","_step2","_product$getBarcodeSe4","_product$getBarcodeSe5","_product$getSelector","_product$getSelector$","_product$getBarcodeSe6","newRowId","addProductRow","getProductById","selectProductInRow","productId","_this3$getProductSele","getProductSelector","onProductSelect","notification","getLastActiveSaveNotification","listHaveEmptyRows","_iterator3","_step3","focusProductSelector","onInnerCancel","panelCode","removeClass","addClass","hiddenPanelCode","removePanel","useProductsFromRequest","isInternalChanging","reloadTable","actionUpdateTotalData","_event$getCompatData","getCompatData","_event$getCompatData2","slicedToArray","grid","eventArgs","parent","getGridId","isNativeAction","url","getReloadUrl","method","sessid","bitrix_sessid","getProductsFields","_classStaticPrivateMethodGet","_getAjaxFields","isDeletingRequest","gridId","clearEditor","subscribeOnce","_event$getCompatData3","_event$getCompatData4","_event$getCompatData5","_event$getCompatData6","getSettingsPopup","_event$getCompatData7","_event$getCompatData8","ids","changed","resortProductsByIds","refreshSortFields","numerateRows","initPageEventsManager","componentId","pageEventsManager","getPageEventsManager","rows","current","isHeadChild","isTemplate","getEditData","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","unbindAll","wasProductsInitiated","productSelector","setForm","clearController","setController","controller","clearProductList","getContainerId","getLanguageId","getSiteId","getCatalogId","setReadOnly","readOnly","setCurrencyId","loadCurrencyFormat","isSalesOrdersDocument","salesOrdersDocumentTypeCodes","documentType","changeCurrencyId","oldCurrencyId","setOption","onCalculatePricesResponse","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","response","updateTotalUiCurrency","totalBlock","totalsList","row","_totalsList","totalId","valueElement","getPriceControl","format","getCurrencyFormat","FORMAT_STRING","getDataFieldName","getDataSettingsFieldName","getDefaultMeasure","getRowIdPrefix","_parseInt","_x","isNumberValue","isStringValue","isNegative","indexOf","isNaN","_parseFloat","_x2","dot","comma","s1","substr","decimalLength","round","factor","pow","formId","form","isExistForm","getForm","initFormFields","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","initFormField","create","attrs","removeFormFields","getFormField","getProductCount","list","_iterator4","_step4","index","Error","gridManager","getInstanceById","_this11","getHead","gridEditData","paintedColumns","cell","getCellById","arParams","EDITABLE_DATA","_this$getGrid","_this$getGrid$arParam","COLUMNS_ALL","setOriginalTemplateEditData","_childrenHasErrors2","disableSaveButton","enableSaveButton","closest","hasAttribute","getAttribute","getFieldCodeByGridCell","dropdownId","regExp","RegExp","matches","match","_matches","getProductByRowId","find","headRow","getCellNameByCellIndex","anchorProduct","createGridProductRow","newId","_this$getGrid$getRows","anchorRowNode","insertBefore","nextSibling","initializeNewProductRow","bindOnRowEvents","has","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","setAttribute","makeCountable","adjustRows","updateCounterDisplayed","updateCounterSelected","handleDeleteRow","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","CURRENCY","previousRow","stores","values","previousStoreValue","titleName","ID","IMAGE_INFO","splice","unshift","_this14$getProductSel","searchInDialog","focusName","tableFade","productRow","_productRow$getSelect","_productRow$getBarcod","isNew","tableUnfade","_event$getData3","_product$getBarcodeSe7","setConfig","compileProductData","cleanProductRows","prepareProductDataValue","productDataValue","productData","itemFields","test","stringify","_iterator5","_step5","actionSendProductChange","actionSendProductListChanged","actionUpdateListField","updateFieldForList","_iterator6","_step6","updateTotalDataDelayedHandler","totalCost","setTotalData","productFields","_iterator7","_step7","_this$controller","_list","setTotal","ajaxResultCommonCheck","responce","status","gridRow","reset","a","b","handleOnTabShow","_product$getBarcodeSe8","removeSpotlight","_product$getBarcodeSe9","removeQrAuth","_product$getBarcodeSe10","errorsArray","showFieldTourHint","addictedFields","productNode","_iterator8","_step8","processApplyActionButtonClick","actionId","_processSetStoryAction2","_clickOnRowActionsButton","hasErrors","_this$getGrid2","_this16","actionPanel","getActionsPanel","actionValues","getValues","actionStoreId","isUndefined","selectedRows","getSelected","actionStore","actionStoreName","TITLE","selectedItem","documentTypeMoving","messageId","getDropdowns","removeItemsRelativeCurrent","innerWrapper","innerText"],"mappings":"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"}