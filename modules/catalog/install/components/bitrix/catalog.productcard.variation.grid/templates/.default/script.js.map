{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {typeof BaseEvent, EventEmitter} from 'main.core.events';\nimport {MenuManager, PopupManager} from 'main.popup';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\n\nconst GRID_TEMPLATE_ROW = 'template_0';\n\nclass VariationGrid\n{\n\tgrid = null;\n\tisNew = false;\n\tpropertiesWithMenu = []\n\n\tconstructor(settings = {})\n\t{\n\t\tthis.createPropertyId = settings.createPropertyId;\n\t\tthis.createPropertyHintId = settings.createPropertyHintId;\n\t\tthis.gridId = settings.gridId;\n\t\tthis.isNew = settings.isNew;\n\t\tthis.hiddenProperties = settings.hiddenProperties;\n\t\tthis.modifyPropertyLink = settings.modifyPropertyLink;\n\t\tthis.gridEditData = settings.gridEditData;\n\t\tthis.canHaveSku = settings.canHaveSku || false;\n\n\t\tconst isGridReload = settings.isGridReload || false;\n\t\tif (!isGridReload)\n\t\t{\n\t\t\tthis.addCustomClassToGrid();\n\t\t\tthis.bindCreateNewVariation();\n\t\t\tthis.bindCreateSkuProperty();\n\t\t\tthis.clearGridSettingsPopupStuff();\n\t\t}\n\n\t\tconst gridEditData = settings.gridEditData || null;\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\n\t\tif (this.isNew)\n\t\t{\n\t\t\tthis.enableEdit();\n\t\t\tthis.prepareNewNodes();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.bindInlineEdit();\n\t\t}\n\n\t\tEvent.bind(this.getGrid().getScrollContainer(), 'scroll', Runtime.throttle(this.onScrollHandler.bind(this), 50));\n\t\tEvent.bind(this.getGridSettingsButton(), 'click', this.showGridSettingsWindowHandler.bind(this));\n\n\t\tthis.subscribeCustomEvents();\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tthis.onSubmitEntityEditorAjaxHandler = this.onSubmitEntityEditorAjax.bind(this);\n\t\tEventEmitter.subscribeOnce('BX.UI.EntityEditorAjax:onSubmit', this.onSubmitEntityEditorAjaxHandler);\n\n\t\tthis.onGridUpdatedHandler = this.onGridUpdated.bind(this);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\n\t\tthis.onPropertySaveHandler = this.onPropertySave.bind(this);\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', this.onPropertySaveHandler);\n\n\t\tthis.onAllRowsSelectHandler = this.enableEdit.bind(this)\n\t\tEventEmitter.subscribe('Grid::allRowsSelected', this.onAllRowsSelectHandler);\n\n\t\tthis.showPropertySettingsSliderHandler = this.showPropertySettingsSlider.bind(this);\n\t\tEventEmitter.subscribe('VariationGrid::propertyModify', this.showPropertySettingsSliderHandler);\n\n\t\tthis.onPrepareDropDownItemsHandler = this.onPrepareDropDownItems.bind(this);\n\t\tEventEmitter.subscribe('Dropdown::onPrepareItems', this.onPrepareDropDownItemsHandler);\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tif (this.onPropertySaveHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('SidePanel.Slider:onMessage', this.onPropertySaveHandler);\n\t\t\tthis.onPropertySaveHandler = null;\n\t\t}\n\n\t\tif (this.showPropertySettingsSliderHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('VariationGrid::propertyModify', this.showPropertySettingsSliderHandler);\n\t\t\tthis.showPropertySettingsSliderHandler = null;\n\t\t}\n\n\t\tif (this.onPrepareDropDownItemsHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('Dropdown::onPrepareItems', this.onPrepareDropDownItemsHandler);\n\t\t\tthis.onPrepareDropDownItemsHandler = null;\n\t\t}\n\n\t\tif (this.onAllRowsSelectHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('Grid::allRowsSelected', this.onAllRowsSelectHandler);\n\t\t\tthis.onAllRowsSelectHandler = null;\n\t\t}\n\t}\n\n\tgetGridSettingsButton()\n\t{\n\t\treturn this.getGrid().getContainer().querySelector('.' + this.getGrid().settings.get('classSettingsButton'))\n\t}\n\n\tshowGridSettingsWindowHandler(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tthis.askToLossGridData(() => {\n\t\t\tthis.getGrid().getSettingsWindow()._onSettingsButtonClick();\n\t\t});\n\t}\n\n\tonScrollHandler(event)\n\t{\n\t\tconst popup = PopupManager.getCurrentPopup();\n\t\tif (popup)\n\t\t{\n\t\t\tpopup.close();\n\t\t}\n\n\t\tthis.propertiesWithMenu.forEach(propertyId => {\n\t\t\tlet menu = MenuManager.getMenuById(propertyId + '_menu');\n\t\t\tif (menu)\n\t\t\t{\n\t\t\t\tmenu.close();\n\t\t\t}\n\t\t})\n\t}\n\n\tonSubmitEntityEditorAjax(event)\n\t{\n\t\tEventEmitter.emit(this.getGrid().getSettingsWindow().getPopup(), 'onDestroy');\n\t}\n\n\tonPrepareDropDownItems(event)\n\t{\n\t\tconst [controlId, menuId, items] = event.getData();\n\t\tif (!Type.isStringFilled(controlId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.propertiesWithMenu.push(controlId);\n\n\t\tif (controlId.indexOf('SKU_GRID_PROPERTY_') === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isArray(items))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionList = items.filter((item) => {\n\t\t\treturn (item.action === 'create-new');\n\t\t});\n\n\t\tif (actionList.length > 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst propertyId = controlId.replace('SKU_GRID_PROPERTY_', '').replace('_control', '');\n\n\t\titems.push({\n\t\t\t'action': 'create-new',\n\t\t\t'text': `\n\t\t\t\t<li data-role=\"createItem\" class=\"catalog-productcard-popup-select-item catalog-productcard-popup-select-item-new\">\n\t\t\t\t\t<label class=\"catalog-productcard-popup-select-label main-dropdown-item\" data-pseudo=\"true\">\n\t\t\t\t\t\t<span class=\"catalog-productcard-popup-select-add\"></span>\n\t\t\t\t\t\t<span class=\"catalog-productcard-popup-select-text\">\n\t\t\t\t\t\t\t${Loc.getMessage('C_PVG_ADD_NEW_PROPERTY_VALUE_BUTTON')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</label>\n\t\t\t\t</li>`,\n\t\t\t'onclick': () => BX.Catalog.VariationGrid.firePropertyModification(propertyId, menuId)\n\t\t});\n\n\t\trequestAnimationFrame(function() {\n\t\t\tconst popup = document.getElementById('menu-popup-' + menuId);\n\t\t\tDom.addClass(popup, 'catalog-productcard-popup-list');\n\t\t});\n\t}\n\n\tclearGridSettingsPopupStuff()\n\t{\n\t\tDom.remove(document.getElementById(this.gridId + '-grid-settings-window'));\n\t}\n\n\tbindCreateNewVariation()\n\t{\n\t\tif (!this.canHaveSku)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst addRowButton = document.querySelector('[data-role=\"catalog-productcard-variation-add-row\"]');\n\n\t\tif (Type.isDomNode(addRowButton))\n\t\t{\n\t\t\tEvent.bind(addRowButton, 'click', this.addRowToGrid.bind(this));\n\t\t}\n\t}\n\n\taddCustomClassToGrid()\n\t{\n\t\tDom.addClass(this.getGrid().getContainer(), 'catalog-product-variation-grid');\n\t}\n\n\t/**\n\t * @returns {BX.Main.grid|null}\n\t */\n\tgetGrid()\n\t{\n\t\tif (this.grid === null)\n\t\t{\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${this.gridId}' id.`)\n\t\t\t}\n\n\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\n\t\treturn this.grid;\n\t}\n\n\tenableEdit()\n\t{\n\t\tthis.getGrid().getRows().selectAll();\n\t\tthis.getGrid().editSelected();\n\t}\n\n\tprepareNewNodes()\n\t{\n\t\tthis.getGrid().getRows().getBodyChild().map(row => {\n\t\t\tconst newNode = row.getNode();\n\t\t\tthis.markNodeAsNew(newNode)\n\t\t\tthis.addSkuListCreationItem(newNode);\n\t\t\tthis.modifyCustomSkuProperties(newNode);\n\t\t});\n\t}\n\n\tmarkNodeAsNew(node)\n\t{\n\t\tDom.addClass(node, 'main-grid-row-new');\n\t}\n\n\tbindInlineEdit()\n\t{\n\t\tthis.getGrid().getRows().getBodyChild().forEach(\n\t\t\titem => Event.bind(item.node, 'click', event => this.toggleInlineEdit(item, event))\n\t\t);\n\t}\n\n\t/**\n\t * @returns {BX.UI.EntityEditor|null}\n\t */\n\tgetEditorInstance()\n\t{\n\t\tif (Reflection.getClass('BX.UI.EntityEditor'))\n\t\t{\n\t\t\treturn BX.UI.EntityEditor.getDefault();\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tbindCreateSkuProperty()\n\t{\n\t\tif (!this.canHaveSku)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst createPropertyNode = document.getElementById(this.createPropertyId);\n\t\tconst control = this.getEditorInstance().getControlByIdRecursive('variation_grid');\n\n\t\tif (Type.isDomNode(createPropertyNode) && control)\n\t\t{\n\t\t\tcontrol._createChildButton = createPropertyNode;\n\t\t\tEvent.bind(createPropertyNode, 'click', control.onCreateFieldBtnClick.bind(control));\n\t\t}\n\n\t\tconst createPropertyHintNode = document.getElementById(this.createPropertyHintId);\n\t\tEvent.bind(createPropertyHintNode, 'click', this.showHelp.bind(this));\n\t}\n\n\tshowHelp(event)\n\t{\n\t\tif (Reflection.getClass('top.BX.Helper'))\n\t\t{\n\t\t\ttop.BX.Helper.show('redirect=detail&code=11657102');\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\t// ToDo auto focus on input under event.point?\n\ttoggleInlineEdit(item: BX.Grid.Row, event)\n\t{\n\t\tlet changed = false;\n\n\t\tif (item.isEdit())\n\t\t{\n\t\t\tif (this.hasClickedOnCheckboxArea(item, event.target))\n\t\t\t{\n\t\t\t\tchanged = true;\n\t\t\t\tthis.deactivateInlineEdit(item);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (event.target.nodeName !== 'A')\n\t\t\t{\n\t\t\t\tchanged = true;\n\t\t\t\tthis.activateInlineEdit(item);\n\t\t\t}\n\t\t}\n\n\t\tif (changed)\n\t\t{\n\t\t\tif (this.getGrid().getRows().isSelected())\n\t\t\t{\n\t\t\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tEventEmitter.emit('Grid::noEditedRows', []);\n\t\t\t}\n\n\t\t\tthis.getGrid().adjustRows();\n\t\t\tthis.getGrid().updateCounterSelected();\n\t\t\tthis.getGrid().updateCounterDisplayed();\n\t\t\tthis.getGrid().adjustCheckAllCheckboxes();\n\t\t}\n\t}\n\n\thasClickedOnCheckboxArea(item: BX.Grid.Row, target)\n\t{\n\t\tif (!Type.isDomNode(target))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst cells = item.getCells();\n\n\t\tfor (let i in cells)\n\t\t{\n\t\t\tif (\n\t\t\t\tcells.hasOwnProperty(i)\n\t\t\t\t&& cells[i].contains(item.getCheckbox())\n\t\t\t\t&& (cells[i] === target || cells[i].contains(target))\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tactivateInlineEdit(item: BX.Grid.Row)\n\t{\n\t\titem.select();\n\t\titem.edit();\n\n\t\tthis.addSkuListCreationItem(item.getNode());\n\t}\n\n\tdeactivateInlineEdit(item: BX.Grid.Row)\n\t{\n\t\titem.editCancel();\n\t\titem.unselect();\n\n\t\t// disable multi-selection(and self re-selection) while disabling editing\n\t\tthis.getGrid().clickPrevent = true;\n\t\tsetTimeout(() => {\n\t\t\tthis.getGrid().clickPrevent = false;\n\t\t}, 100);\n\t}\n\n\tmodifyCustomSkuProperties(node)\n\t{\n\t\tconst postfix = '_' + node.getAttribute('data-id');\n\n\t\tnode.querySelectorAll('input[type=\"radio\"]').forEach(input => {\n\t\t\tinput.id += postfix;\n\t\t\tinput.setAttribute('name', input.getAttribute('name') + postfix);\n\t\t});\n\n\t\tnode.querySelectorAll('label[data-role]').forEach(label => {\n\t\t\tlabel.setAttribute('for', label.getAttribute('for') + postfix);\n\t\t});\n\t}\n\n\taddSkuListCreationItem(node)\n\t{\n\t\tnode.querySelectorAll('[data-role=\"dropdownContent\"] ul').forEach((listNode) => {\n\t\t\tif (!listNode.querySelector('[data-role=\"createItem\"]'))\n\t\t\t{\n\t\t\t\tconst propertyId = listNode.getAttribute('data-propertyId');\n\t\t\t\tconst createItem = Tag.render`\n\t\t\t\t\t<li data-role=\"createItem\"\n\t\t\t\t\t\t class=\"catalog-productcard-popup-select-item catalog-productcard-popup-select-item-new\"\n\t\t\t\t\t\t onclick=\"BX.Catalog.VariationGrid.firePropertyModification(${propertyId})\">\n\t\t\t\t\t\t<label class=\"catalog-productcard-popup-select-label\">\n\t\t\t\t\t\t\t<span class=\"catalog-productcard-popup-select-add\"></span>\n\t\t\t\t\t\t\t<span class=\"catalog-productcard-popup-select-text\">\n\t\t\t\t\t\t\t\t${BX.message('C_PVG_ADD_NEW_PROPERTY_VALUE_BUTTON')}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</li>`;\n\t\t\t\tlistNode.appendChild(createItem);\n\t\t\t}\n\t\t});\n\t}\n\n\taddRowToGrid()\n\t{\n\t\tconst originalTemplate = this.redefineTemplateEditData();\n\n\t\tconst grid = this.getGrid();\n\t\tconst newRow = grid.prependRowEditor();\n\n\t\tconst checkbox = newRow.getCheckbox();\n\t\tif (Type.isDomNode(checkbox))\n\t\t{\n\t\t\tcheckbox.setAttribute('disabled', 'disabled');\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\t\tgrid.getRows().reset();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tconst newRowDataId = Text.getRandom();\n\t\t\tthis.gridEditData[newRowDataId] = {...this.gridEditData['template_0']};\n\t\t\tnewNode.setAttribute('data-id', newRowDataId);\n\t\t\tthis.markNodeAsNew(newNode);\n\t\t\tthis.modifyCustomSkuProperties(newNode);\n\t\t\tthis.addSkuListCreationItem(newNode);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\t}\n\n\tremoveRowFromGrid(skuId)\n\t{\n\t\tthis.getGrid().removeRow(skuId);\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\t// rewrite edit data because of grid component cuts necessary fields (VIEW_HTML/EDIT_HTML)\n\tsetGridEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\tredefineTemplateEditData()\n\t{\n\t\tlet newRowData = this.getEditDataFromSelectedValues();\n\n\t\tif (!newRowData)\n\t\t{\n\t\t\tnewRowData = this.getEditDataFromNotSelectedValues();\n\t\t}\n\n\t\tif (newRowData)\n\t\t{\n\t\t\tnewRowData = {...newRowData};\n\t\t\tthis.prepareNewRowData(newRowData);\n\n\t\t\tconst data = this.getGridEditData();\n\t\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData);\n\n\t\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...newRowData, ...customEditData})\n\n\t\t\treturn originalTemplateData;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetEditDataFromSelectedValues()\n\t{\n\t\tconst rowNodes = this.getGrid().getRows().getSelected();\n\n\t\treturn rowNodes.length ? rowNodes[0].editGetValues() : null;\n\t}\n\n\tgetEditDataFromNotSelectedValues()\n\t{\n\t\tconst values = this.getGrid().arParams.EDITABLE_DATA;\n\t\tconst id = Object.keys(values)\n\t\t\t.reverse()\n\t\t\t.find(index => index !== GRID_TEMPLATE_ROW && Type.isPlainObject(values[index]))\n\t\t;\n\n\t\treturn id ? values[id] : null;\n\t}\n\n\tprepareNewRowData(newRowData)\n\t{\n\t\tfor (let i in newRowData)\n\t\t{\n\t\t\tif (newRowData.hasOwnProperty(i) && (i.includes('[VIEW_HTML]') || i.includes('[EDIT_HTML]')))\n\t\t\t{\n\t\t\t\tdelete newRowData[i]\n\t\t\t}\n\t\t}\n\t}\n\n\tprepareCustomEditData(originalEditData)\n\t{\n\t\tconst customEditData = {};\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i) && i.includes('[EDIT_HTML]'))\n\t\t\t{\n\t\t\t\t// modify file input instance ids (due to collisions with default id)\n\t\t\t\tif (originalEditData[i].indexOf('new BX.UI.ImageInput') >= 0)\n\t\t\t\t{\n\t\t\t\t\tconst filePrefix = 'bx_file_' + i.replace('[EDIT_HTML]', '').toLowerCase() + '_';\n\t\t\t\t\tconst matches = originalEditData[i].match(new RegExp('\\'(' + filePrefix + '[A-Za-z0-9_]+)\\''));\n\n\t\t\t\t\tif (matches[1])\n\t\t\t\t\t{\n\t\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\t\tnew RegExp(matches[1], 'g'),\n\t\t\t\t\t\t\tfilePrefix + this.getRandomInt()\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tgetRandomInt(max = 100000)\n\t{\n\t\treturn Math.floor(Math.random() * Math.floor(max));\n\t}\n\n\tgetHeaderNames()\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\n\t\treturn headers;\n\t}\n\n\taddPropertyToGridHeader(item)\n\t{\n\t\tBX.ajax.runComponentAction(\n\t\t\t'bitrix:catalog.productcard.variation.grid',\n\t\t\t'addPropertyHeader',\n\t\t\t{\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: {\n\t\t\t\t\tgridId: this.getGrid().getId(),\n\t\t\t\t\tpropertyCode: item.id,\n\t\t\t\t\tanchor: item.anchor || null,\n\t\t\t\t\tcurrentHeaders: this.getHeaderNames()\n\t\t\t\t}\n\t\t\t}\n\t\t).then((response) => {\n\t\t\tthis.reloadGrid();\n\t\t});\n\t}\n\n\treloadGrid()\n\t{\n\t\tthis.getGrid().reload();\n\t}\n\n\tonGridUpdated(event: BaseEvent)\n\t{\n\t\tthis.getGrid().getSettingsWindow().getItems().forEach((column) => {\n\t\t\tif(this.getHeaderNames().indexOf(column.node.dataset.name) !== -1)\n\t\t\t{\n\t\t\t\tcolumn.state.selected = true;\n\t\t\t\tcolumn.checkbox.checked = true;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tcolumn.state.selected = false;\n\t\t\t\tcolumn.checkbox.checked = false;\n\t\t\t}\n\t\t});\n\t}\n\n\tonPropertySave(event: BaseEvent)\n\t{\n\t\tconst [sliderEvent] = event.getCompatData();\n\n\t\tif (sliderEvent.getEventId() === 'PropertyCreationForm:onAdd')\n\t\t{\n\t\t\tconst eventArgs = sliderEvent.getData();\n\n\t\t\tthis.addPropertyToGridHeader({\n\t\t\t\tid: eventArgs.fields.CODE\n\t\t\t});\n\t\t}\n\n\t\tif (sliderEvent.getEventId() === 'PropertyCreationForm:onModify')\n\t\t{\n\t\t\tthis.reloadGrid();\n\t\t}\n\t}\n\n\tshowPropertySettingsSlider(event: BaseEvent)\n\t{\n\t\tconst [propertyId] = event.getData();\n\t\tconst link = this.modifyPropertyLink.replace('#PROPERTY_ID#', propertyId);\n\n\t\tthis.askToLossGridData(() => {\n\t\t\tBX.SidePanel.Instance.open(link, {\n\t\t\t\twidth: 550,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tcacheable: false\n\t\t\t});\n\t\t});\n\t}\n\n\taskToLossGridData(okCallback?, cancelCallback?, options?: {})\n\t{\n\t\tif (this.isGridInEditMode())\n\t\t{\n\t\t\tconst defaultOptions = {\n\t\t\t\ttitle: Loc.getMessage('C_PVG_UNSAVED_DATA_TITLE'),\n\t\t\t\tmessage: Loc.getMessage('C_PVG_UNSAVED_DATA_MESSAGE'),\n\t\t\t\tmodal: true,\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: Loc.getMessage('C_PVG_UNSAVED_DATA_CONTINUE'),\n\t\t\t\tonOk: messageBox => {\n\t\t\t\t\tokCallback && okCallback();\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t},\n\t\t\t\tonCancel: messageBox => {\n\t\t\t\t\tcancelCallback && cancelCallback();\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tMessageBox.show({...defaultOptions, ...options});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tokCallback && okCallback();\n\t\t}\n\t}\n\n\tisGridInEditMode()\n\t{\n\t\treturn this.getGrid()\n\t\t\t.getRows()\n\t\t\t.getBodyChild()\n\t\t\t.filter(row => row.isShown() && row.isEdit())\n\t\t\t.length > 0;\n\t}\n\n\tstatic firePropertyModification(propertyId, menuId)\n\t{\n\t\tif (menuId)\n\t\t{\n\t\t\tconst menu = MenuManager.getMenuById(menuId);\n\t\t\tif (menu)\n\t\t\t{\n\t\t\t\tmenu.close();\n\t\t\t\tmenu.destroy();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst popup = PopupManager.getCurrentPopup();\n\t\t\tif (popup)\n\t\t\t{\n\t\t\t\tpopup.close();\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.emit('VariationGrid::propertyModify', [propertyId]);\n\t}\n}\n\nReflection.namespace('BX.Catalog').VariationGrid = VariationGrid;"],"names":["GRID_TEMPLATE_ROW","VariationGrid","settings","createPropertyId","createPropertyHintId","gridId","isNew","hiddenProperties","modifyPropertyLink","gridEditData","canHaveSku","isGridReload","addCustomClassToGrid","bindCreateNewVariation","bindCreateSkuProperty","clearGridSettingsPopupStuff","setGridEditData","enableEdit","prepareNewNodes","bindInlineEdit","Event","bind","getGrid","getScrollContainer","Runtime","throttle","onScrollHandler","getGridSettingsButton","showGridSettingsWindowHandler","subscribeCustomEvents","onSubmitEntityEditorAjaxHandler","onSubmitEntityEditorAjax","EventEmitter","subscribeOnce","onGridUpdatedHandler","onGridUpdated","subscribe","onPropertySaveHandler","onPropertySave","onAllRowsSelectHandler","showPropertySettingsSliderHandler","showPropertySettingsSlider","onPrepareDropDownItemsHandler","onPrepareDropDownItems","unsubscribe","getContainer","querySelector","get","event","preventDefault","stopPropagation","askToLossGridData","getSettingsWindow","_onSettingsButtonClick","popup","PopupManager","getCurrentPopup","close","propertiesWithMenu","forEach","propertyId","menu","MenuManager","getMenuById","emit","getPopup","getData","controlId","menuId","items","Type","isStringFilled","push","indexOf","isArray","actionList","filter","item","action","length","replace","Loc","getMessage","BX","Catalog","firePropertyModification","requestAnimationFrame","document","getElementById","Dom","addClass","remove","addRowButton","isDomNode","addRowToGrid","grid","Reflection","getClass","Error","Main","gridManager","getInstanceById","getRows","selectAll","editSelected","getBodyChild","map","row","newNode","getNode","markNodeAsNew","addSkuListCreationItem","modifyCustomSkuProperties","node","toggleInlineEdit","UI","EntityEditor","getDefault","createPropertyNode","control","getEditorInstance","getControlByIdRecursive","_createChildButton","onCreateFieldBtnClick","createPropertyHintNode","showHelp","top","Helper","show","changed","isEdit","hasClickedOnCheckboxArea","target","deactivateInlineEdit","nodeName","activateInlineEdit","isSelected","adjustRows","updateCounterSelected","updateCounterDisplayed","adjustCheckAllCheckboxes","cells","getCells","i","hasOwnProperty","contains","getCheckbox","select","edit","editCancel","unselect","clickPrevent","setTimeout","postfix","getAttribute","querySelectorAll","input","id","setAttribute","label","listNode","createItem","Tag","render","message","appendChild","originalTemplate","redefineTemplateEditData","newRow","prependRowEditor","checkbox","reset","newRowDataId","Text","getRandom","makeCountable","setOriginalTemplateEditData","skuId","removeRow","arParams","EDITABLE_DATA","data","newRowData","getEditDataFromSelectedValues","getEditDataFromNotSelectedValues","prepareNewRowData","getGridEditData","originalTemplateData","customEditData","prepareCustomEditData","rowNodes","getSelected","editGetValues","values","Object","keys","reverse","find","index","isPlainObject","includes","originalEditData","filePrefix","toLowerCase","matches","match","RegExp","getRandomInt","max","Math","floor","random","headers","getHeadFirstChild","Array","from","header","dataset","name","ajax","runComponentAction","mode","getId","propertyCode","anchor","currentHeaders","getHeaderNames","then","response","reloadGrid","reload","getItems","column","state","selected","checked","getCompatData","sliderEvent","getEventId","eventArgs","addPropertyToGridHeader","fields","CODE","link","SidePanel","Instance","open","width","allowChangeHistory","cacheable","okCallback","cancelCallback","options","isGridInEditMode","defaultOptions","title","modal","buttons","MessageBoxButtons","OK_CANCEL","okCaption","onOk","messageBox","onCancel","MessageBox","isShown","destroy","namespace"],"mappings":";;;;;;;;;;;;CAKA,IAAMA,iBAAiB,GAAG,YAA1B;;KAEMC;CAML,2BACA;CAAA,QADYC,QACZ,uEADuB,EACvB;CAAA;CAAA,8CALO,IAKP;CAAA,+CAJQ,KAIR;CAAA,4DAHqB,EAGrB;CACC,SAAKC,gBAAL,GAAwBD,QAAQ,CAACC,gBAAjC;CACA,SAAKC,oBAAL,GAA4BF,QAAQ,CAACE,oBAArC;CACA,SAAKC,MAAL,GAAcH,QAAQ,CAACG,MAAvB;CACA,SAAKC,KAAL,GAAaJ,QAAQ,CAACI,KAAtB;CACA,SAAKC,gBAAL,GAAwBL,QAAQ,CAACK,gBAAjC;CACA,SAAKC,kBAAL,GAA0BN,QAAQ,CAACM,kBAAnC;CACA,SAAKC,YAAL,GAAoBP,QAAQ,CAACO,YAA7B;CACA,SAAKC,UAAL,GAAkBR,QAAQ,CAACQ,UAAT,IAAuB,KAAzC;CAEA,QAAMC,YAAY,GAAGT,QAAQ,CAACS,YAAT,IAAyB,KAA9C;;CACA,QAAI,CAACA,YAAL,EACA;CACC,WAAKC,oBAAL;CACA,WAAKC,sBAAL;CACA,WAAKC,qBAAL;CACA,WAAKC,2BAAL;CACA;;CAED,QAAMN,YAAY,GAAGP,QAAQ,CAACO,YAAT,IAAyB,IAA9C;;CACA,QAAIA,YAAJ,EACA;CACC,WAAKO,eAAL,CAAqBP,YAArB;CACA;;CAED,QAAI,KAAKH,KAAT,EACA;CACC,WAAKW,UAAL;CACA,WAAKC,eAAL;CACA,KAJD,MAMA;CACC,WAAKC,cAAL;CACA;;CAEDC,IAAAA,eAAK,CAACC,IAAN,CAAW,KAAKC,OAAL,GAAeC,kBAAf,EAAX,EAAgD,QAAhD,EAA0DC,iBAAO,CAACC,QAAR,CAAiB,KAAKC,eAAL,CAAqBL,IAArB,CAA0B,IAA1B,CAAjB,EAAkD,EAAlD,CAA1D;CACAD,IAAAA,eAAK,CAACC,IAAN,CAAW,KAAKM,qBAAL,EAAX,EAAyC,OAAzC,EAAkD,KAAKC,6BAAL,CAAmCP,IAAnC,CAAwC,IAAxC,CAAlD;CAEA,SAAKQ,qBAAL;CACA;;;;6CAGD;CACC,WAAKC,+BAAL,GAAuC,KAAKC,wBAAL,CAA8BV,IAA9B,CAAmC,IAAnC,CAAvC;CACAW,MAAAA,6BAAY,CAACC,aAAb,CAA2B,iCAA3B,EAA8D,KAAKH,+BAAnE;CAEA,WAAKI,oBAAL,GAA4B,KAAKC,aAAL,CAAmBd,IAAnB,CAAwB,IAAxB,CAA5B;CACAW,MAAAA,6BAAY,CAACI,SAAb,CAAuB,eAAvB,EAAwC,KAAKF,oBAA7C;CAEA,WAAKG,qBAAL,GAA6B,KAAKC,cAAL,CAAoBjB,IAApB,CAAyB,IAAzB,CAA7B;CACAW,MAAAA,6BAAY,CAACI,SAAb,CAAuB,4BAAvB,EAAqD,KAAKC,qBAA1D;CAEA,WAAKE,sBAAL,GAA8B,KAAKtB,UAAL,CAAgBI,IAAhB,CAAqB,IAArB,CAA9B;CACAW,MAAAA,6BAAY,CAACI,SAAb,CAAuB,uBAAvB,EAAgD,KAAKG,sBAArD;CAEA,WAAKC,iCAAL,GAAyC,KAAKC,0BAAL,CAAgCpB,IAAhC,CAAqC,IAArC,CAAzC;CACAW,MAAAA,6BAAY,CAACI,SAAb,CAAuB,+BAAvB,EAAwD,KAAKI,iCAA7D;CAEA,WAAKE,6BAAL,GAAqC,KAAKC,sBAAL,CAA4BtB,IAA5B,CAAiC,IAAjC,CAArC;CACAW,MAAAA,6BAAY,CAACI,SAAb,CAAuB,0BAAvB,EAAmD,KAAKM,6BAAxD;CACA;;;+CAGD;CACC,UAAI,KAAKL,qBAAT,EACA;CACCL,QAAAA,6BAAY,CAACY,WAAb,CAAyB,4BAAzB,EAAuD,KAAKP,qBAA5D;CACA,aAAKA,qBAAL,GAA6B,IAA7B;CACA;;CAED,UAAI,KAAKG,iCAAT,EACA;CACCR,QAAAA,6BAAY,CAACY,WAAb,CAAyB,+BAAzB,EAA0D,KAAKJ,iCAA/D;CACA,aAAKA,iCAAL,GAAyC,IAAzC;CACA;;CAED,UAAI,KAAKE,6BAAT,EACA;CACCV,QAAAA,6BAAY,CAACY,WAAb,CAAyB,0BAAzB,EAAqD,KAAKF,6BAA1D;CACA,aAAKA,6BAAL,GAAqC,IAArC;CACA;;CAED,UAAI,KAAKH,sBAAT,EACA;CACCP,QAAAA,6BAAY,CAACY,WAAb,CAAyB,uBAAzB,EAAkD,KAAKL,sBAAvD;CACA,aAAKA,sBAAL,GAA8B,IAA9B;CACA;CACD;;;6CAGD;CACC,aAAO,KAAKjB,OAAL,GAAeuB,YAAf,GAA8BC,aAA9B,CAA4C,MAAM,KAAKxB,OAAL,GAAepB,QAAf,CAAwB6C,GAAxB,CAA4B,qBAA5B,CAAlD,CAAP;CACA;;;mDAE6BC,OAC9B;CAAA;;CACCA,MAAAA,KAAK,CAACC,cAAN;CACAD,MAAAA,KAAK,CAACE,eAAN;CAEA,WAAKC,iBAAL,CAAuB,YAAM;CAC5B,QAAA,KAAI,CAAC7B,OAAL,GAAe8B,iBAAf,GAAmCC,sBAAnC;CACA,OAFD;CAGA;;;qCAEeL,OAChB;CACC,UAAMM,KAAK,GAAGC,uBAAY,CAACC,eAAb,EAAd;;CACA,UAAIF,KAAJ,EACA;CACCA,QAAAA,KAAK,CAACG,KAAN;CACA;;CAED,WAAKC,kBAAL,CAAwBC,OAAxB,CAAgC,UAAAC,UAAU,EAAI;CAC7C,YAAIC,IAAI,GAAGC,sBAAW,CAACC,WAAZ,CAAwBH,UAAU,GAAG,OAArC,CAAX;;CACA,YAAIC,IAAJ,EACA;CACCA,UAAAA,IAAI,CAACJ,KAAL;CACA;CACD,OAND;CAOA;;;8CAEwBT,OACzB;CACChB,MAAAA,6BAAY,CAACgC,IAAb,CAAkB,KAAK1C,OAAL,GAAe8B,iBAAf,GAAmCa,QAAnC,EAAlB,EAAiE,WAAjE;CACA;;;4CAEsBjB,OACvB;CAAA,2BACoCA,KAAK,CAACkB,OAAN,EADpC;CAAA;CAAA,UACQC,SADR;CAAA,UACmBC,MADnB;CAAA,UAC2BC,KAD3B;;CAEC,UAAI,CAACC,cAAI,CAACC,cAAL,CAAoBJ,SAApB,CAAL,EACA;CACC;CACA;;CAED,WAAKT,kBAAL,CAAwBc,IAAxB,CAA6BL,SAA7B;;CAEA,UAAIA,SAAS,CAACM,OAAV,CAAkB,oBAAlB,MAA4C,CAAC,CAAjD,EACA;CACC;CACA;;CAED,UAAI,CAACH,cAAI,CAACI,OAAL,CAAaL,KAAb,CAAL,EACA;CACC;CACA;;CAED,UAAMM,UAAU,GAAGN,KAAK,CAACO,MAAN,CAAa,UAACC,IAAD,EAAU;CACzC,eAAQA,IAAI,CAACC,MAAL,KAAgB,YAAxB;CACA,OAFkB,CAAnB;;CAIA,UAAIH,UAAU,CAACI,MAAX,GAAoB,CAAxB,EACA;CACC;CACA;;CAED,UAAMnB,UAAU,GAAGO,SAAS,CAACa,OAAV,CAAkB,oBAAlB,EAAwC,EAAxC,EAA4CA,OAA5C,CAAoD,UAApD,EAAgE,EAAhE,CAAnB;CAEAX,MAAAA,KAAK,CAACG,IAAN,CAAW;CACV,kBAAU,YADA;CAEV,qaAKMS,aAAG,CAACC,UAAJ,CAAe,qCAAf,CALN,6DAFU;CAWV,mBAAW;CAAA,iBAAMC,EAAE,CAACC,OAAH,CAAWnF,aAAX,CAAyBoF,wBAAzB,CAAkDzB,UAAlD,EAA8DQ,MAA9D,CAAN;CAAA;CAXD,OAAX;CAcAkB,MAAAA,qBAAqB,CAAC,YAAW;CAChC,YAAMhC,KAAK,GAAGiC,QAAQ,CAACC,cAAT,CAAwB,gBAAgBpB,MAAxC,CAAd;CACAqB,QAAAA,aAAG,CAACC,QAAJ,CAAapC,KAAb,EAAoB,gCAApB;CACA,OAHoB,CAArB;CAIA;;;mDAGD;CACCmC,MAAAA,aAAG,CAACE,MAAJ,CAAWJ,QAAQ,CAACC,cAAT,CAAwB,KAAKnF,MAAL,GAAc,uBAAtC,CAAX;CACA;;;8CAGD;CACC,UAAI,CAAC,KAAKK,UAAV,EACA;CACC;CACA;;CAED,UAAMkF,YAAY,GAAGL,QAAQ,CAACzC,aAAT,CAAuB,qDAAvB,CAArB;;CAEA,UAAIwB,cAAI,CAACuB,SAAL,CAAeD,YAAf,CAAJ,EACA;CACCxE,QAAAA,eAAK,CAACC,IAAN,CAAWuE,YAAX,EAAyB,OAAzB,EAAkC,KAAKE,YAAL,CAAkBzE,IAAlB,CAAuB,IAAvB,CAAlC;CACA;CACD;;;4CAGD;CACCoE,MAAAA,aAAG,CAACC,QAAJ,CAAa,KAAKpE,OAAL,GAAeuB,YAAf,EAAb,EAA4C,gCAA5C;CACA;CAED;CACD;CACA;;;;+BAEC;CACC,UAAI,KAAKkD,IAAL,KAAc,IAAlB,EACA;CACC,YAAI,CAACC,oBAAU,CAACC,QAAX,CAAoB,qCAApB,CAAL,EACA;CACC,gBAAMC,KAAK,kCAA2B,KAAK7F,MAAhC,WAAX;CACA;;CAED,aAAK0F,IAAL,GAAYZ,EAAE,CAACgB,IAAH,CAAQC,WAAR,CAAoBC,eAApB,CAAoC,KAAKhG,MAAzC,CAAZ;CACA;;CAED,aAAO,KAAK0F,IAAZ;CACA;;;kCAGD;CACC,WAAKzE,OAAL,GAAegF,OAAf,GAAyBC,SAAzB;CACA,WAAKjF,OAAL,GAAekF,YAAf;CACA;;;uCAGD;CAAA;;CACC,WAAKlF,OAAL,GAAegF,OAAf,GAAyBG,YAAzB,GAAwCC,GAAxC,CAA4C,UAAAC,GAAG,EAAI;CAClD,YAAMC,OAAO,GAAGD,GAAG,CAACE,OAAJ,EAAhB;;CACA,QAAA,MAAI,CAACC,aAAL,CAAmBF,OAAnB;;CACA,QAAA,MAAI,CAACG,sBAAL,CAA4BH,OAA5B;;CACA,QAAA,MAAI,CAACI,yBAAL,CAA+BJ,OAA/B;CACA,OALD;CAMA;;;mCAEaK,MACd;CACCxB,MAAAA,aAAG,CAACC,QAAJ,CAAauB,IAAb,EAAmB,mBAAnB;CACA;;;sCAGD;CAAA;;CACC,WAAK3F,OAAL,GAAegF,OAAf,GAAyBG,YAAzB,GAAwC9C,OAAxC,CACC,UAAAkB,IAAI;CAAA,eAAIzD,eAAK,CAACC,IAAN,CAAWwD,IAAI,CAACoC,IAAhB,EAAsB,OAAtB,EAA+B,UAAAjE,KAAK;CAAA,iBAAI,MAAI,CAACkE,gBAAL,CAAsBrC,IAAtB,EAA4B7B,KAA5B,CAAJ;CAAA,SAApC,CAAJ;CAAA,OADL;CAGA;CAED;CACD;CACA;;;;yCAEC;CACC,UAAIgD,oBAAU,CAACC,QAAX,CAAoB,oBAApB,CAAJ,EACA;CACC,eAAOd,EAAE,CAACgC,EAAH,CAAMC,YAAN,CAAmBC,UAAnB,EAAP;CACA;;CAED,aAAO,IAAP;CACA;;;6CAGD;CACC,UAAI,CAAC,KAAK3G,UAAV,EACA;CACC;CACA;;CAED,UAAM4G,kBAAkB,GAAG/B,QAAQ,CAACC,cAAT,CAAwB,KAAKrF,gBAA7B,CAA3B;CACA,UAAMoH,OAAO,GAAG,KAAKC,iBAAL,GAAyBC,uBAAzB,CAAiD,gBAAjD,CAAhB;;CAEA,UAAInD,cAAI,CAACuB,SAAL,CAAeyB,kBAAf,KAAsCC,OAA1C,EACA;CACCA,QAAAA,OAAO,CAACG,kBAAR,GAA6BJ,kBAA7B;CACAlG,QAAAA,eAAK,CAACC,IAAN,CAAWiG,kBAAX,EAA+B,OAA/B,EAAwCC,OAAO,CAACI,qBAAR,CAA8BtG,IAA9B,CAAmCkG,OAAnC,CAAxC;CACA;;CAED,UAAMK,sBAAsB,GAAGrC,QAAQ,CAACC,cAAT,CAAwB,KAAKpF,oBAA7B,CAA/B;CACAgB,MAAAA,eAAK,CAACC,IAAN,CAAWuG,sBAAX,EAAmC,OAAnC,EAA4C,KAAKC,QAAL,CAAcxG,IAAd,CAAmB,IAAnB,CAA5C;CACA;;;8BAEQ2B,OACT;CACC,UAAIgD,oBAAU,CAACC,QAAX,CAAoB,eAApB,CAAJ,EACA;CACC6B,QAAAA,GAAG,CAAC3C,EAAJ,CAAO4C,MAAP,CAAcC,IAAd,CAAmB,+BAAnB;CACAhF,QAAAA,KAAK,CAACC,cAAN;CACA;CACD;;;;sCAGgB4B,MAAmB7B,OACpC;CACC,UAAIiF,OAAO,GAAG,KAAd;;CAEA,UAAIpD,IAAI,CAACqD,MAAL,EAAJ,EACA;CACC,YAAI,KAAKC,wBAAL,CAA8BtD,IAA9B,EAAoC7B,KAAK,CAACoF,MAA1C,CAAJ,EACA;CACCH,UAAAA,OAAO,GAAG,IAAV;CACA,eAAKI,oBAAL,CAA0BxD,IAA1B;CACA;CACD,OAPD,MASA;CACC,YAAI7B,KAAK,CAACoF,MAAN,CAAaE,QAAb,KAA0B,GAA9B,EACA;CACCL,UAAAA,OAAO,GAAG,IAAV;CACA,eAAKM,kBAAL,CAAwB1D,IAAxB;CACA;CACD;;CAED,UAAIoD,OAAJ,EACA;CACC,YAAI,KAAK3G,OAAL,GAAegF,OAAf,GAAyBkC,UAAzB,EAAJ,EACA;CACCxG,UAAAA,6BAAY,CAACgC,IAAb,CAAkB,uBAAlB,EAA2C,EAA3C;CACA,SAHD,MAKA;CACChC,UAAAA,6BAAY,CAACgC,IAAb,CAAkB,oBAAlB,EAAwC,EAAxC;CACA;;CAED,aAAK1C,OAAL,GAAemH,UAAf;CACA,aAAKnH,OAAL,GAAeoH,qBAAf;CACA,aAAKpH,OAAL,GAAeqH,sBAAf;CACA,aAAKrH,OAAL,GAAesH,wBAAf;CACA;CACD;;;8CAEwB/D,MAAmBuD,QAC5C;CACC,UAAI,CAAC9D,cAAI,CAACuB,SAAL,CAAeuC,MAAf,CAAL,EACA;CACC;CACA;;CAED,UAAMS,KAAK,GAAGhE,IAAI,CAACiE,QAAL,EAAd;;CAEA,WAAK,IAAIC,CAAT,IAAcF,KAAd,EACA;CACC,YACCA,KAAK,CAACG,cAAN,CAAqBD,CAArB,KACGF,KAAK,CAACE,CAAD,CAAL,CAASE,QAAT,CAAkBpE,IAAI,CAACqE,WAAL,EAAlB,CADH,KAEIL,KAAK,CAACE,CAAD,CAAL,KAAaX,MAAb,IAAuBS,KAAK,CAACE,CAAD,CAAL,CAASE,QAAT,CAAkBb,MAAlB,CAF3B,CADD,EAKA;CACC,iBAAO,IAAP;CACA;CACD;;CAED,aAAO,KAAP;CACA;;;wCAEkBvD,MACnB;CACCA,MAAAA,IAAI,CAACsE,MAAL;CACAtE,MAAAA,IAAI,CAACuE,IAAL;CAEA,WAAKrC,sBAAL,CAA4BlC,IAAI,CAACgC,OAAL,EAA5B;CACA;;;0CAEoBhC,MACrB;CAAA;;CACCA,MAAAA,IAAI,CAACwE,UAAL;CACAxE,MAAAA,IAAI,CAACyE,QAAL,GAFD;;CAKC,WAAKhI,OAAL,GAAeiI,YAAf,GAA8B,IAA9B;CACAC,MAAAA,UAAU,CAAC,YAAM;CAChB,QAAA,MAAI,CAAClI,OAAL,GAAeiI,YAAf,GAA8B,KAA9B;CACA,OAFS,EAEP,GAFO,CAAV;CAGA;;;+CAEyBtC,MAC1B;CACC,UAAMwC,OAAO,GAAG,MAAMxC,IAAI,CAACyC,YAAL,CAAkB,SAAlB,CAAtB;CAEAzC,MAAAA,IAAI,CAAC0C,gBAAL,CAAsB,qBAAtB,EAA6ChG,OAA7C,CAAqD,UAAAiG,KAAK,EAAI;CAC7DA,QAAAA,KAAK,CAACC,EAAN,IAAYJ,OAAZ;CACAG,QAAAA,KAAK,CAACE,YAAN,CAAmB,MAAnB,EAA2BF,KAAK,CAACF,YAAN,CAAmB,MAAnB,IAA6BD,OAAxD;CACA,OAHD;CAKAxC,MAAAA,IAAI,CAAC0C,gBAAL,CAAsB,kBAAtB,EAA0ChG,OAA1C,CAAkD,UAAAoG,KAAK,EAAI;CAC1DA,QAAAA,KAAK,CAACD,YAAN,CAAmB,KAAnB,EAA0BC,KAAK,CAACL,YAAN,CAAmB,KAAnB,IAA4BD,OAAtD;CACA,OAFD;CAGA;;;4CAEsBxC,MACvB;CACCA,MAAAA,IAAI,CAAC0C,gBAAL,CAAsB,kCAAtB,EAA0DhG,OAA1D,CAAkE,UAACqG,QAAD,EAAc;CAC/E,YAAI,CAACA,QAAQ,CAAClH,aAAT,CAAuB,0BAAvB,CAAL,EACA;CACC,cAAMc,UAAU,GAAGoG,QAAQ,CAACN,YAAT,CAAsB,iBAAtB,CAAnB;CACA,cAAMO,UAAU,GAAGC,aAAG,CAACC,MAAP,oBAGgDvG,UAHhD,EAOVuB,EAAE,CAACiF,OAAH,CAAW,qCAAX,CAPU,CAAhB;CAWAJ,UAAAA,QAAQ,CAACK,WAAT,CAAqBJ,UAArB;CACA;CACD,OAjBD;CAkBA;;;oCAGD;CACC,UAAMK,gBAAgB,GAAG,KAAKC,wBAAL,EAAzB;CAEA,UAAMxE,IAAI,GAAG,KAAKzE,OAAL,EAAb;CACA,UAAMkJ,MAAM,GAAGzE,IAAI,CAAC0E,gBAAL,EAAf;CAEA,UAAMC,QAAQ,GAAGF,MAAM,CAACtB,WAAP,EAAjB;;CACA,UAAI5E,cAAI,CAACuB,SAAL,CAAe6E,QAAf,CAAJ,EACA;CACCA,QAAAA,QAAQ,CAACZ,YAAT,CAAsB,UAAtB,EAAkC,UAAlC;CACA;;CAED,UAAMlD,OAAO,GAAG4D,MAAM,CAAC3D,OAAP,EAAhB;CACAd,MAAAA,IAAI,CAACO,OAAL,GAAeqE,KAAf;;CAEA,UAAIrG,cAAI,CAACuB,SAAL,CAAee,OAAf,CAAJ,EACA;CACC,YAAMgE,YAAY,GAAGC,cAAI,CAACC,SAAL,EAArB;CACA,aAAKrK,YAAL,CAAkBmK,YAAlB,kCAAsC,KAAKnK,YAAL,CAAkB,YAAlB,CAAtC;CACAmG,QAAAA,OAAO,CAACkD,YAAR,CAAqB,SAArB,EAAgCc,YAAhC;CACA,aAAK9D,aAAL,CAAmBF,OAAnB;CACA,aAAKI,yBAAL,CAA+BJ,OAA/B;CACA,aAAKG,sBAAL,CAA4BH,OAA5B;CACA4D,QAAAA,MAAM,CAACO,aAAP;CACA;;CAED,UAAIT,gBAAJ,EACA;CACC,aAAKU,2BAAL,CAAiCV,gBAAjC;CACA;;CAEDtI,MAAAA,6BAAY,CAACgC,IAAb,CAAkB,uBAAlB,EAA2C,EAA3C;CAEA+B,MAAAA,IAAI,CAAC0C,UAAL;CACA1C,MAAAA,IAAI,CAAC4C,sBAAL;CACA5C,MAAAA,IAAI,CAAC2C,qBAAL;CACA;;;uCAEiBuC,OAClB;CACC,WAAK3J,OAAL,GAAe4J,SAAf,CAAyBD,KAAzB;CACA;;;uCAGD;CACC,aAAO,KAAK3J,OAAL,GAAe6J,QAAf,CAAwBC,aAA/B;CACA;;;;qCAGeC,MAChB;CACC,WAAK/J,OAAL,GAAe6J,QAAf,CAAwBC,aAAxB,GAAwCC,IAAxC;CACA;;;iDAE2BA,MAC5B;CACC,WAAK/J,OAAL,GAAe6J,QAAf,CAAwBC,aAAxB,CAAsCpL,iBAAtC,IAA2DqL,IAA3D;CACA;;;gDAGD;CACC,UAAIC,UAAU,GAAG,KAAKC,6BAAL,EAAjB;;CAEA,UAAI,CAACD,UAAL,EACA;CACCA,QAAAA,UAAU,GAAG,KAAKE,gCAAL,EAAb;CACA;;CAED,UAAIF,UAAJ,EACA;CACCA,QAAAA,UAAU,iCAAOA,UAAP,CAAV;CACA,aAAKG,iBAAL,CAAuBH,UAAvB;CAEA,YAAMD,IAAI,GAAG,KAAKK,eAAL,EAAb;CACA,YAAMC,oBAAoB,GAAGN,IAAI,CAACrL,iBAAD,CAAjC;CACA,YAAM4L,cAAc,GAAG,KAAKC,qBAAL,CAA2BF,oBAA3B,CAAvB;CAEA,aAAKX,2BAAL,+BAAqCW,oBAArC,EAA8DL,UAA9D,EAA6EM,cAA7E;CAEA,eAAOD,oBAAP;CACA;;CAED,aAAO,IAAP;CACA;;;qDAGD;CACC,UAAMG,QAAQ,GAAG,KAAKxK,OAAL,GAAegF,OAAf,GAAyByF,WAAzB,EAAjB;CAEA,aAAOD,QAAQ,CAAC/G,MAAT,GAAkB+G,QAAQ,CAAC,CAAD,CAAR,CAAYE,aAAZ,EAAlB,GAAgD,IAAvD;CACA;;;wDAGD;CACC,UAAMC,MAAM,GAAG,KAAK3K,OAAL,GAAe6J,QAAf,CAAwBC,aAAvC;CACA,UAAMvB,EAAE,GAAGqC,MAAM,CAACC,IAAP,CAAYF,MAAZ,EACTG,OADS,GAETC,IAFS,CAEJ,UAAAC,KAAK;CAAA,eAAIA,KAAK,KAAKtM,iBAAV,IAA+BsE,cAAI,CAACiI,aAAL,CAAmBN,MAAM,CAACK,KAAD,CAAzB,CAAnC;CAAA,OAFD,CAAX;CAKA,aAAOzC,EAAE,GAAGoC,MAAM,CAACpC,EAAD,CAAT,GAAgB,IAAzB;CACA;;;uCAEiByB,YAClB;CACC,WAAK,IAAIvC,CAAT,IAAcuC,UAAd,EACA;CACC,YAAIA,UAAU,CAACtC,cAAX,CAA0BD,CAA1B,MAAiCA,CAAC,CAACyD,QAAF,CAAW,aAAX,KAA6BzD,CAAC,CAACyD,QAAF,CAAW,aAAX,CAA9D,CAAJ,EACA;CACC,iBAAOlB,UAAU,CAACvC,CAAD,CAAjB;CACA;CACD;CACD;;;2CAEqB0D,kBACtB;CACC,UAAMb,cAAc,GAAG,EAAvB;;CAEA,WAAK,IAAI7C,CAAT,IAAc0D,gBAAd,EACA;CACC,YAAIA,gBAAgB,CAACzD,cAAjB,CAAgCD,CAAhC,KAAsCA,CAAC,CAACyD,QAAF,CAAW,aAAX,CAA1C,EACA;CACC;CACA,cAAIC,gBAAgB,CAAC1D,CAAD,CAAhB,CAAoBtE,OAApB,CAA4B,sBAA5B,KAAuD,CAA3D,EACA;CACC,gBAAMiI,UAAU,GAAG,aAAa3D,CAAC,CAAC/D,OAAF,CAAU,aAAV,EAAyB,EAAzB,EAA6B2H,WAA7B,EAAb,GAA0D,GAA7E;CACA,gBAAMC,OAAO,GAAGH,gBAAgB,CAAC1D,CAAD,CAAhB,CAAoB8D,KAApB,CAA0B,IAAIC,MAAJ,CAAW,QAAQJ,UAAR,GAAqB,kBAAhC,CAA1B,CAAhB;;CAEA,gBAAIE,OAAO,CAAC,CAAD,CAAX,EACA;CACChB,cAAAA,cAAc,CAAC7C,CAAD,CAAd,GAAoB0D,gBAAgB,CAAC1D,CAAD,CAAhB,CAAoB/D,OAApB,CACnB,IAAI8H,MAAJ,CAAWF,OAAO,CAAC,CAAD,CAAlB,EAAuB,GAAvB,CADmB,EAEnBF,UAAU,GAAG,KAAKK,YAAL,EAFM,CAApB;CAIA;CACD;CACD;CACD;;CAED,aAAOnB,cAAP;CACA;;;oCAGD;CAAA,UADaoB,GACb,uEADmB,MACnB;CACC,aAAOC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgBF,IAAI,CAACC,KAAL,CAAWF,GAAX,CAA3B,CAAP;CACA;;;sCAGD;CACC,UAAMI,OAAO,GAAG,EAAhB;CACA,UAAMvE,KAAK,GAAG,KAAKvH,OAAL,GAAegF,OAAf,GAAyB+G,iBAAzB,GAA6CvE,QAA7C,EAAd;CAEAwE,MAAAA,KAAK,CAACC,IAAN,CAAW1E,KAAX,EAAkBlF,OAAlB,CAA0B,UAAC6J,MAAD,EAAY;CACrC,YAAI,UAAUA,MAAM,CAACC,OAArB,EACA;CACCL,UAAAA,OAAO,CAAC5I,IAAR,CAAagJ,MAAM,CAACC,OAAP,CAAeC,IAA5B;CACA;CACD,OALD;CAOA,aAAON,OAAP;CACA;;;6CAEuBvI,MACxB;CAAA;;CACCM,MAAAA,EAAE,CAACwI,IAAH,CAAQC,kBAAR,CACC,2CADD,EAEC,mBAFD,EAGC;CACCC,QAAAA,IAAI,EAAE,MADP;CAECxC,QAAAA,IAAI,EAAE;CACLhL,UAAAA,MAAM,EAAE,KAAKiB,OAAL,GAAewM,KAAf,EADH;CAELC,UAAAA,YAAY,EAAElJ,IAAI,CAACgF,EAFd;CAGLmE,UAAAA,MAAM,EAAEnJ,IAAI,CAACmJ,MAAL,IAAe,IAHlB;CAILC,UAAAA,cAAc,EAAE,KAAKC,cAAL;CAJX;CAFP,OAHD,EAYEC,IAZF,CAYO,UAACC,QAAD,EAAc;CACpB,QAAA,MAAI,CAACC,UAAL;CACA,OAdD;CAeA;;;kCAGD;CACC,WAAK/M,OAAL,GAAegN,MAAf;CACA;;;mCAEatL,OACd;CAAA;;CACC,WAAK1B,OAAL,GAAe8B,iBAAf,GAAmCmL,QAAnC,GAA8C5K,OAA9C,CAAsD,UAAC6K,MAAD,EAAY;CACjE,YAAG,MAAI,CAACN,cAAL,GAAsBzJ,OAAtB,CAA8B+J,MAAM,CAACvH,IAAP,CAAYwG,OAAZ,CAAoBC,IAAlD,MAA4D,CAAC,CAAhE,EACA;CACCc,UAAAA,MAAM,CAACC,KAAP,CAAaC,QAAb,GAAwB,IAAxB;CACAF,UAAAA,MAAM,CAAC9D,QAAP,CAAgBiE,OAAhB,GAA0B,IAA1B;CACA,SAJD,MAKI;CACHH,UAAAA,MAAM,CAACC,KAAP,CAAaC,QAAb,GAAwB,KAAxB;CACAF,UAAAA,MAAM,CAAC9D,QAAP,CAAgBiE,OAAhB,GAA0B,KAA1B;CACA;CACD,OAVD;CAWA;;;oCAEc3L,OACf;CAAA,iCACuBA,KAAK,CAAC4L,aAAN,EADvB;CAAA;CAAA,UACQC,WADR;;CAGC,UAAIA,WAAW,CAACC,UAAZ,OAA6B,4BAAjC,EACA;CACC,YAAMC,SAAS,GAAGF,WAAW,CAAC3K,OAAZ,EAAlB;CAEA,aAAK8K,uBAAL,CAA6B;CAC5BnF,UAAAA,EAAE,EAAEkF,SAAS,CAACE,MAAV,CAAiBC;CADO,SAA7B;CAGA;;CAED,UAAIL,WAAW,CAACC,UAAZ,OAA6B,+BAAjC,EACA;CACC,aAAKT,UAAL;CACA;CACD;;;gDAE0BrL,OAC3B;CAAA,4BACsBA,KAAK,CAACkB,OAAN,EADtB;CAAA;CAAA,UACQN,UADR;;CAEC,UAAMuL,IAAI,GAAG,KAAK3O,kBAAL,CAAwBwE,OAAxB,CAAgC,eAAhC,EAAiDpB,UAAjD,CAAb;CAEA,WAAKT,iBAAL,CAAuB,YAAM;CAC5BgC,QAAAA,EAAE,CAACiK,SAAH,CAAaC,QAAb,CAAsBC,IAAtB,CAA2BH,IAA3B,EAAiC;CAChCI,UAAAA,KAAK,EAAE,GADyB;CAEhCC,UAAAA,kBAAkB,EAAE,KAFY;CAGhCC,UAAAA,SAAS,EAAE;CAHqB,SAAjC;CAKA,OAND;CAOA;;;uCAEiBC,YAAaC,gBAAiBC,SAChD;CACC,UAAI,KAAKC,gBAAL,EAAJ,EACA;CACC,YAAMC,cAAc,GAAG;CACtBC,UAAAA,KAAK,EAAE9K,aAAG,CAACC,UAAJ,CAAe,0BAAf,CADe;CAEtBkF,UAAAA,OAAO,EAAEnF,aAAG,CAACC,UAAJ,CAAe,4BAAf,CAFa;CAGtB8K,UAAAA,KAAK,EAAE,IAHe;CAItBC,UAAAA,OAAO,EAAEC,uCAAiB,CAACC,SAJL;CAKtBC,UAAAA,SAAS,EAAEnL,aAAG,CAACC,UAAJ,CAAe,6BAAf,CALW;CAMtBmL,UAAAA,IAAI,EAAE,cAAAC,UAAU,EAAI;CACnBZ,YAAAA,UAAU,IAAIA,UAAU,EAAxB;CACAY,YAAAA,UAAU,CAAC7M,KAAX;CACA,WATqB;CAUtB8M,UAAAA,QAAQ,EAAE,kBAAAD,UAAU,EAAI;CACvBX,YAAAA,cAAc,IAAIA,cAAc,EAAhC;CACAW,YAAAA,UAAU,CAAC7M,KAAX;CACA;CAbqB,SAAvB;CAgBA+M,QAAAA,gCAAU,CAACxI,IAAX,+BAAoB8H,cAApB,EAAuCF,OAAvC;CACA,OAnBD,MAqBA;CACCF,QAAAA,UAAU,IAAIA,UAAU,EAAxB;CACA;CACD;;;wCAGD;CACC,aAAO,KAAKpO,OAAL,GACLgF,OADK,GAELG,YAFK,GAGL7B,MAHK,CAGE,UAAA+B,GAAG;CAAA,eAAIA,GAAG,CAAC8J,OAAJ,MAAiB9J,GAAG,CAACuB,MAAJ,EAArB;CAAA,OAHL,EAILnD,MAJK,GAII,CAJX;CAKA;;;8CAE+BnB,YAAYQ,QAC5C;CACC,UAAIA,MAAJ,EACA;CACC,YAAMP,IAAI,GAAGC,sBAAW,CAACC,WAAZ,CAAwBK,MAAxB,CAAb;;CACA,YAAIP,IAAJ,EACA;CACCA,UAAAA,IAAI,CAACJ,KAAL;CACAI,UAAAA,IAAI,CAAC6M,OAAL;CACA;CACD,OARD,MAUA;CACC,YAAMpN,KAAK,GAAGC,uBAAY,CAACC,eAAb,EAAd;;CACA,YAAIF,KAAJ,EACA;CACCA,UAAAA,KAAK,CAACG,KAAN;CACA;CACD;;CAEDzB,MAAAA,6BAAY,CAACgC,IAAb,CAAkB,+BAAlB,EAAmD,CAACJ,UAAD,CAAnD;CACA;;;;;AAGFoC,qBAAU,CAAC2K,SAAX,CAAqB,YAArB,EAAmC1Q,aAAnC,GAAmDA,aAAnD;;;;"}