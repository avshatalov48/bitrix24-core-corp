{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type, Uri } from 'main.core';\nimport { typeof BaseEvent, EventEmitter } from 'main.core.events';\nimport { MenuManager, Popup, PopupManager } from 'main.popup';\nimport { TagSelector } from 'ui.entity-selector';\nimport 'ui.buttons';\nimport 'ui.hint';\n\nconst GRID_TEMPLATE_ROW = 'template_0';\n\nclass VariationGrid\n{\n\tgrid = null;\n\tisNew = false;\n\tpropertiesWithMenu = [];\n\n\tconstructor(settings = {})\n\t{\n\t\tthis.createPropertyId = settings.createPropertyId;\n\t\tthis.createPropertyHintId = settings.createPropertyHintId;\n\t\tthis.gridId = settings.gridId;\n\t\tthis.isNew = settings.isNew;\n\t\tthis.isReadOnly = settings.isReadOnly;\n\t\tthis.isSimple = settings.isSimple;\n\t\tthis.hiddenProperties = settings.hiddenProperties;\n\t\tthis.modifyPropertyLink = settings.modifyPropertyLink;\n\t\tthis.productCopyLink = settings.productCopyLink;\n\t\tthis.gridEditData = settings.gridEditData;\n\t\tthis.canHaveSku = settings.canHaveSku || false;\n\t\tthis.storeAmount = settings.storeAmount;\n\t\tthis.isShowedStoreReserve = settings.isShowedStoreReserve;\n\t\tthis.reservedDealsSliderLink = settings.reservedDealsSliderLink;\n\n\t\tif (settings.copyItemsMap)\n\t\t{\n\t\t\tthis.getGrid().arParams.COPY_ITEMS_MAP = settings.copyItemsMap;\n\t\t}\n\n\t\tif (settings.supportedAjaxFields)\n\t\t{\n\t\t\tthis.getGrid().arParams.SUPPORTED_AJAX_FIELDS = settings.supportedAjaxFields;\n\t\t}\n\n\t\tif (!this.isNew)\n\t\t{\n\t\t\tthis.bindPopupInitToQuantityNodes();\n\t\t\tthis.bindSliderToReservedQuantityNodes();\n\t\t}\n\n\t\tif (this.isReadOnly)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isGridReload = settings.isGridReload || false;\n\t\tif (!isGridReload)\n\t\t{\n\t\t\tthis.addCustomClassToGrid();\n\t\t\tthis.bindCreateNewVariation();\n\t\t\tthis.bindCreateSkuProperty();\n\t\t\tthis.clearGridSettingsPopupStuff();\n\t\t}\n\n\t\tconst gridEditData = settings.gridEditData || null;\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\n\t\tif (this.isNew)\n\t\t{\n\t\t\tthis.enableEdit();\n\t\t\tthis.prepareNewNodes();\n\t\t\tthis.getGrid().updateCounterSelected();\n\t\t\tthis.getGrid().disableCheckAllCheckboxes();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.bindInlineEdit();\n\t\t}\n\n\t\tEvent.bind(this.getGrid().getScrollContainer(), 'scroll', Runtime.throttle(this.onScrollHandler.bind(this), 50));\n\n\t\tthis.modifyHeaders();\n\t\tthis.subscribeCustomEvents();\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tthis.onGridUpdatedHandler = this.onGridUpdated.bind(this);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\n\t\tthis.onPropertySaveHandler = this.onPropertySave.bind(this);\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', this.onPropertySaveHandler);\n\n\t\tthis.onAllRowsSelectHandler = this.enableEdit.bind(this);\n\t\tEventEmitter.subscribe('Grid::allRowsSelected', this.onAllRowsSelectHandler);\n\n\t\tthis.onAllRowsUnselectHandler = this.disableEdit.bind(this);\n\t\tEventEmitter.subscribe('Grid::allRowsUnselected', this.onAllRowsUnselectHandler);\n\n\t\tthis.showPropertySettingsSliderHandler = this.showPropertySettingsSlider.bind(this);\n\t\tEventEmitter.subscribe('VariationGrid::propertyModify', this.showPropertySettingsSliderHandler);\n\n\t\tthis.onPrepareDropDownItemsHandler = this.onPrepareDropDownItems.bind(this);\n\t\tEventEmitter.subscribe('Dropdown::onPrepareItems', this.onPrepareDropDownItemsHandler);\n\n\t\tthis.onCreatePopupHandler = this.onCreatePopup.bind(this);\n\t\tEventEmitter.subscribe('UiSelect::onCreatePopup', this.onCreatePopupHandler);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.unsubscribeCustomEvents();\n\t\tthis.destroyStoreAmountPopups();\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tif (this.onGridUpdatedHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\t\tthis.onGridUpdatedHandler = null;\n\t\t}\n\n\t\tif (this.onPropertySaveHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('SidePanel.Slider:onMessage', this.onPropertySaveHandler);\n\t\t\tthis.onPropertySaveHandler = null;\n\t\t}\n\n\t\tif (this.showPropertySettingsSliderHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('VariationGrid::propertyModify', this.showPropertySettingsSliderHandler);\n\t\t\tthis.showPropertySettingsSliderHandler = null;\n\t\t}\n\n\t\tif (this.onPrepareDropDownItemsHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('Dropdown::onPrepareItems', this.onPrepareDropDownItemsHandler);\n\t\t\tthis.onPrepareDropDownItemsHandler = null;\n\t\t}\n\n\t\tif (this.onAllRowsSelectHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('Grid::allRowsSelected', this.onAllRowsSelectHandler);\n\t\t\tthis.onAllRowsSelectHandler = null;\n\t\t}\n\n\t\tif (this.onAllRowsUnselectHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('Grid::allRowsUnselected', this.onAllRowsUnselectHandler);\n\t\t\tthis.onAllRowsUnselectHandler = null;\n\t\t}\n\n\t\tif (this.onCreatePopupHandler)\n\t\t{\n\t\t\tEventEmitter.unsubscribe('UiSelect::onCreatePopup', this.onCreatePopupHandler);\n\t\t\tthis.onCreatePopupHandler = null;\n\t\t}\n\t}\n\n\tmodifyHeaders()\n\t{\n\t\tconst headers = this.getGrid().getParam('COLUMNS_ALL');\n\t\tfor (const headerName in headers)\n\t\t{\n\t\t\tconst header = headers[headerName];\n\n\t\t\tif (!header.locked && !Type.isStringFilled(header.headerHint))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst headerCell = this.getGrid().getColumnHeaderCellByName(header.id);\n\t\t\tconst headerTitle = headerCell?.querySelector('.main-grid-head-title');\n\t\t\tif (!headerTitle)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (header.locked)\n\t\t\t{\n\t\t\t\tconst lock = Tag.render`<span class='ui-btn ui-btn-link ui-btn-icon-lock'></span>`;\n\t\t\t\tDom.addClass(headerTitle.parentNode, 'main-grid-cell-head-container--locked');\n\t\t\t\tDom.prepend(lock, headerTitle);\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(header.headerHint))\n\t\t\t{\n\t\t\t\tDom.attr(headerTitle, 'data-hint-no-icon', 'true');\n\t\t\t\tDom.attr(headerTitle, 'data-hint', header.headerHint);\n\t\t\t\tBX.UI.Hint.init(headerCell);\n\t\t\t}\n\t\t}\n\t}\n\n\tonScrollHandler(event)\n\t{\n\t\tconst popup = PopupManager.getCurrentPopup();\n\t\tif (popup)\n\t\t{\n\t\t\tpopup.close();\n\t\t}\n\n\t\tthis.propertiesWithMenu.forEach(propertyId => {\n\t\t\tconst menu = MenuManager.getMenuById(`${propertyId}_menu`);\n\t\t\tif (menu)\n\t\t\t{\n\t\t\t\tmenu.close();\n\t\t\t}\n\t\t});\n\t}\n\n\tonPrepareDropDownItems(event)\n\t{\n\t\tconst [controlId, menuId, items] = event.getData();\n\t\tif (!Type.isStringFilled(controlId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.propertiesWithMenu.push(controlId);\n\n\t\tif (controlId.indexOf('SKU_GRID_PROPERTY_') === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isArray(items))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionList = items.filter((item) => {\n\t\t\treturn (item.action === 'create-new');\n\t\t});\n\n\t\tif (actionList.length > 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst propertyId = controlId.replace('SKU_GRID_PROPERTY_', '').replace('_control', '');\n\n\t\titems.push({\n\t\t\taction: 'create-new',\n\t\t\thtml: `\n\t\t\t\t<li data-role=\"createItem\" class=\"catalog-productcard-popup-select-item catalog-productcard-popup-select-item-new\">\n\t\t\t\t\t<label class=\"catalog-productcard-popup-select-label main-dropdown-item\" data-pseudo=\"true\">\n\t\t\t\t\t\t<span class=\"catalog-productcard-popup-select-add\"></span>\n\t\t\t\t\t\t<span class=\"catalog-productcard-popup-select-text\">\n\t\t\t\t\t\t\t${Loc.getMessage('C_PVG_ADD_NEW_PROPERTY_VALUE_BUTTON')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</label>\n\t\t\t\t</li>`,\n\t\t\tonclick: () => BX.Catalog.VariationGrid.firePropertyModification(propertyId, menuId),\n\t\t});\n\n\t\trequestAnimationFrame(function() {\n\t\t\tconst popup = document.getElementById(`menu-popup-${menuId}`);\n\t\t\tDom.addClass(popup, 'catalog-productcard-popup-list');\n\t\t});\n\t}\n\n\tonCreatePopup(event)\n\t{\n\t\tconst [popup] = event.getData();\n\t\tconst bindElementId = popup?.bindElement?.id;\n\n\t\tif (!Type.isStringFilled(bindElementId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (bindElementId.indexOf('SKU_GRID_PROPERTY_') === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst propertyId = bindElementId.replace('SKU_GRID_PROPERTY_', '').replace('_control', '');\n\n\t\tconst addButton = Tag.render`\n\t\t\t<div class=\"catalog-productcard-popup-select-item catalog-productcard-popup-multi-select-item-new\">\n\t\t\t\t<label\n\t\t\t\t\tclass=\"catalog-productcard-popup-select-label main-dropdown-item\">\n\t\t\t\t\t<span class=\"catalog-productcard-popup-select-add\"></span>\n\t\t\t\t\t<span class=\"catalog-productcard-popup-select-text\">\n\t\t\t\t\t\t${Loc.getMessage('C_PVG_ADD_NEW_PROPERTY_VALUE_BUTTON')}\n\t\t\t\t\t</span>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t`;\n\t\tEvent.bind(addButton, 'mousedown', BX.Catalog.VariationGrid.firePropertyModification.bind(this, propertyId));\n\n\t\tpopup.contentContainer.appendChild(addButton);\n\t}\n\n\tclearGridSettingsPopupStuff()\n\t{\n\t\tDom.remove(document.getElementById(`${this.gridId}-grid-settings-window`));\n\t}\n\n\tbindCreateNewVariation()\n\t{\n\t\tif (!this.canHaveSku)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst addRowButton = document.querySelector('[data-role=\"catalog-productcard-variation-add-row\"]');\n\n\t\tif (!Type.isDomNode(addRowButton))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isSimple)\n\t\t{\n\t\t\tEvent.bind(addRowButton, 'click', this.openSimpleProductRestrictionPopup.bind(this));\n\n\t\t\treturn;\n\t\t}\n\n\t\tEvent.bind(addRowButton, 'click', this.addRowToGrid.bind(this));\n\t}\n\n\taddCustomClassToGrid()\n\t{\n\t\tDom.addClass(this.getGrid().getContainer(), 'catalog-product-variation-grid');\n\t}\n\n\t/**\n\t * @returns {BX.Main.grid|null}\n\t */\n\tgetGrid()\n\t{\n\t\tif (this.grid === null)\n\t\t{\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow new Error(`Cannot find grid with '${this.gridId}' id.`)\n\t\t\t}\n\n\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\n\t\treturn this.grid;\n\t}\n\n\tbindPopupInitToQuantityNodes()\n\t{\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((row) => {\n\t\t\tif (row.isBodyChild() && !row.isTemplate())\n\t\t\t{\n\t\t\t\tconst quantityNode = row.getNode().querySelector(\n\t\t\t\t\t'.main-grid-cell-content-catalog-quantity-inventory-management'\n\t\t\t\t);\n\t\t\t\tif (Type.isDomNode(quantityNode))\n\t\t\t\t{\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\tquantityNode,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.openStoreAmountPopup.bind(this, row.getId(), quantityNode),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tbindSliderToReservedQuantityNodes()\n\t{\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((row) => {\n\t\t\tif (row.isBodyChild() && !row.isTemplate())\n\t\t\t{\n\t\t\t\tconst reservedQuantityNode = row.getNode().querySelector(\n\t\t\t\t\t'.main-grid-cell-content-catalog-reserved-quantity'\n\t\t\t\t);\n\t\t\t\tif (Type.isDomNode(reservedQuantityNode))\n\t\t\t\t{\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\treservedQuantityNode,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.openDealsWithReservedProductSlider.bind(this, row.getId()),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic #getSimpleProductRestrictionContent()\n\t{\n\t\tconst text = Loc.getMessage(\n\t\t\t'C_PVG_SIMPLE_PRODUCT_POPUP_TEXT_MSGVER_1',\n\t\t\t{\n\t\t\t\t'#COPY_BUTTON_NAME#': `<b>${Loc.getMessage('C_PVG_SIMPLE_PRODUCT_POPUP_BUTTON_COPY')}</b>`,\n\t\t\t\t'#LINK_INFO#': `<a href=\"\">${Loc.getMessage('C_PVG_SIMPLE_PRODUCT_POPUP_DOC_LINK_INFO')}</a>`,\n\t\t\t},\n\t\t);\n\n\t\tconst content = Tag.render`<span>${text}</span>`;\n\t\tEvent.bind(content.querySelector('a'), 'click', (event) => {\n\t\t\ttop.BX.Helper.show('redirect=detail&code=16172654');\n\t\t\tevent.preventDefault();\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"catalog-simple-popup-wrapper\">\n\t\t\t\t<h3>${Loc.getMessage('C_PVG_SIMPLE_PRODUCT_POPUP_TITLE_MSGVER_1')}</h3>\n\t\t\t\t<div class=\"catalog-simple-popup-label-text\">${content}</div>\n\t\t\t\t<div class=\"catalog-simple-popup-link-block\">\n\t\t\t\t\t<a class=\"ui-link ui-link-primary \" target=\"_blank\" href=\"\">\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\topenSimpleProductRestrictionPopup(event: Event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tconst id = 'simple-product-restriction';\n\t\tlet popup = PopupManager.getPopupById(id);\n\n\t\tif (!popup)\n\t\t{\n\t\t\tpopup = new Popup(\n\t\t\t\t{\n\t\t\t\t\tid,\n\t\t\t\t\twidth: 400,\n\t\t\t\t\tzIndexOptions: 4000,\n\t\t\t\t\tautoHide: false,\n\t\t\t\t\tdraggable: true,\n\t\t\t\t\toverlay: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tclassName: 'bxc-popup-window',\n\t\t\t\t\tcontent: VariationGrid.#getSimpleProductRestrictionContent(),\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('C_PVG_SIMPLE_PRODUCT_POPUP_BUTTON_COPY'),\n\t\t\t\t\t\t\tcolor: BX.UI.Button.Color.PRIMARY,\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tBX.SidePanel.Instance.open(this.productCopyLink);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('C_PVG_SIMPLE_PRODUCT_POPUP_BUTTON_CLOSE'),\n\t\t\t\t\t\t\tcolor: BX.UI.Button.Color.LINK,\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tpopup.show();\n\t}\n\n\topenStoreAmountPopup(rowId, quantityNode)\n\t{\n\t\tconst popupId = `${rowId}-store-amount`;\n\t\tlet popup = PopupManager.getPopupById(popupId);\n\n\t\tif (!popup)\n\t\t{\n\t\t\tpopup = new Popup(\n\t\t\t\tpopupId,\n\t\t\t\tquantityNode,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: -218,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: { position: 'top', offset: 250 },\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: { forceBindPosition: true },\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.getStoreAmountPopupContent(rowId),\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tpopup.show();\n\t}\n\n\topenDealsWithReservedProductSlider(rowId, storeId = 0)\n\t{\n\t\tif (!this.reservedDealsSliderLink)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst sliderLink = new Uri(this.reservedDealsSliderLink);\n\t\tsliderLink.setQueryParam('productId', rowId);\n\t\tif (storeId > 0)\n\t\t{\n\t\t\tsliderLink.setQueryParam('storeId', storeId);\n\t\t}\n\t\tBX.SidePanel.Instance.open(sliderLink.toString(), {\n\t\t\tallowChangeHistory: false,\n\t\t\tcacheable: false,\n\t\t});\n\t}\n\n\tgetStoreAmountPopupContent(rowId)\n\t{\n\t\tconst skuStoreAmountData = this.storeAmount[rowId];\n\t\tconst currentSkusCount = skuStoreAmountData?.storesCount || 0;\n\t\tif (!Type.isObject(skuStoreAmountData) || currentSkusCount <= 0)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"store-amount-popup-container\">\n\t\t\t\t\t<p class=\"store-amount-popup-not-found-message\">${Loc.getMessage('C_PVG_STORE_AMOUNT_POPUP_EMPTY')}</p>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst stores = skuStoreAmountData.stores;\n\t\tconst linkToDetails = skuStoreAmountData?.linkToDetails;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"store-amount-popup-container\">\n\t\t\t\t${this.getStoreAmountTable(stores, rowId)}\n\t\t\t\t${linkToDetails ? this.getOpenStoreAmountDetailsSliderLabel(linkToDetails, currentSkusCount) : ''}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStoreAmountTable(stores, rowId)\n\t{\n\t\tconst table = Tag.render`<table class=\"main-grid-table\"></table>`;\n\t\tconst tableHead = table.createTHead();\n\t\ttableHead.className = 'main-grid-header';\n\t\tconst tableHeadRow = tableHead.insertRow();\n\t\ttableHeadRow.className = 'main-grid-row-head';\n\n\t\tthis.addCellToTable(\n\t\t\ttableHeadRow,\n\t\t\tLoc.getMessage('C_PVG_STORE_AMOUNT_POPUP_STORE'),\n\t\t\ttrue,\n\t\t\t'left',\n\t\t);\n\t\tthis.addCellToTable(tableHeadRow, Loc.getMessage('C_PVG_STORE_AMOUNT_POPUP_QUANTITY_COMMON1_MSGVER_1'), true);\n\t\tif (this.isShowedStoreReserve)\n\t\t{\n\t\t\tthis.addCellToTable(tableHeadRow, Loc.getMessage('C_PVG_STORE_AMOUNT_POPUP_QUANTITY_RESERVED'), true);\n\t\t\tthis.addCellToTable(tableHeadRow, Loc.getMessage('C_PVG_STORE_AMOUNT_POPUP_QUANTITY_AVAILABLE'), true);\n\t\t}\n\n\t\tconst tableBody = table.createTBody();\n\t\tstores.forEach((store) => {\n\t\t\tconst tableRow = tableBody.insertRow();\n\t\t\ttableRow.className = 'main-grid-row main-grid-row-body';\n\t\t\tthis.addCellToTable(tableRow, store.title, false, 'left');\n\t\t\tthis.addCellToTable(tableRow, store.quantityCommon, false);\n\t\t\tif (this.isShowedStoreReserve)\n\t\t\t{\n\t\t\t\tconst quantityReservedNode = Tag.render`<a class=\"main-grid-cell-content-catalog-reserved-quantity\">${store.quantityReserved}</a>`;\n\t\t\t\tEvent.bind(\n\t\t\t\t\tquantityReservedNode,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.openDealsWithReservedProductSlider.bind(this, rowId, store.storeId),\n\t\t\t\t);\n\t\t\t\tthis.addCellToTable(tableRow, quantityReservedNode, false);\n\t\t\t\tconst quantityAvailable = parseInt(store.quantityAvailable, 10);\n\t\t\t\tconst viewQuantityAvailable =\n\t\t\t\t\tquantityAvailable <= 0\n\t\t\t\t\t\t? `<span class=\"text--danger\">${quantityAvailable}</span>`\n\t\t\t\t\t\t: quantityAvailable\n\t\t\t\t;\n\t\t\t\tthis.addCellToTable(tableRow, viewQuantityAvailable, false);\n\t\t\t}\n\t\t});\n\n\t\treturn table;\n\t}\n\n\taddCellToTable(row, textContent, isHead, horizontalPosition = 'right')\n\t{\n\t\tconst cellClassName =\n\t\t\tisHead\n\t\t\t\t? 'main-grid-cell-head main-grid-col-no-sortable main-grid-cell-'\n\t\t\t\t: 'main-grid-cell main-grid-cell-'\n\t\t;\n\t\tconst innerClassName =\n\t\t\tisHead\n\t\t\t\t? 'main-grid-cell-head-container'\n\t\t\t\t: 'main-grid-cell-content'\n\t\t;\n\t\tconst cell = row.insertCell();\n\t\tcell.className = cellClassName + horizontalPosition;\n\t\tcell.appendChild(Tag.render`\n\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t<span class=\"${innerClassName}\">\n\t\t\t\t\t${textContent}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\tgetOpenStoreAmountDetailsSliderLabel(linkToDetails, currentSkusCount)\n\t{\n\t\tconst openSliderLabel = Tag.render`\n\t\t\t<span class=\"ui-link ui-link-secondary ui-link-dashed ui-link-open-store-amount-slider\">\n\t\t\t\t${Loc.getMessage(\n\t\t\t'C_PVG_STORE_AMOUNT_POPUP_OPEN_SLIDER_BUTTON',\n\t\t\t{ '#STORE_COUNT#': currentSkusCount }\n\t\t)}\n\t\t\t</span>\n\t\t`;\n\t\tEvent.bind(openSliderLabel, 'click', this.openStoreAmountSlider.bind(this, linkToDetails));\n\n\t\treturn openSliderLabel;\n\t}\n\n\topenStoreAmountSlider(linkToDetails)\n\t{\n\t\tBX.SidePanel.Instance.open(linkToDetails, {\n\t\t\twidth: 700,\n\t\t\tallowChangeHistory: false,\n\t\t\tcacheable: false,\n\t\t});\n\t}\n\n\tdestroyStoreAmountPopups()\n\t{\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((row) => {\n\t\t\tif (row.isBodyChild() && !row.isTemplate())\n\t\t\t{\n\t\t\t\tconst popupId = `${row.getId()}-store-amount`;\n\t\t\t\tconst popup = PopupManager.getPopupById(popupId);\n\t\t\t\tpopup?.destroy?.();\n\t\t\t}\n\t\t});\n\t}\n\n\temitEditedRowsEvent()\n\t{\n\t\tif (this.getGrid().getRows().isSelected())\n\t\t{\n\t\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEventEmitter.emit('Grid::noEditedRows', []);\n\t\t}\n\t}\n\n\tdisableEdit()\n\t{\n\t\tif (this.isNew)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getGrid().getRows().getRows().forEach((current) => {\n\t\t\tif (!Dom.hasClass(current.getNode(), 'main-grid-row-new'))\n\t\t\t{\n\t\t\t\tcurrent.editCancel();\n\t\t\t\tcurrent.unselect();\n\t\t\t}\n\t\t});\n\n\t\tthis.emitEditedRowsEvent();\n\t}\n\n\tenableEdit()\n\t{\n\t\tif (this.isReadOnly)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getGrid().getRows().selectAll();\n\t\tthis.getGrid().getRows().editSelected();\n\t\tthis.getGrid()\n\t\t\t.getRows()\n\t\t\t.getRows()\n\t\t\t.forEach(item => this.enableBarcodeEditor(item))\n\t\t;\n\t}\n\n\tprepareNewNodes()\n\t{\n\t\tthis.getGrid().getRows().getBodyChild().map(row => {\n\t\t\tconst newNode = row.getNode();\n\t\t\tthis.markNodeAsNew(newNode)\n\t\t\tthis.addSkuListCreationItem(newNode);\n\t\t\tthis.modifyCustomSkuProperties(newNode);\n\t\t\tthis.disableCheckbox(row);\n\t\t});\n\t}\n\n\tdisableCheckbox(row)\n\t{\n\t\tconst checkbox = row.getCheckbox();\n\t\tif (Type.isDomNode(checkbox))\n\t\t{\n\t\t\tcheckbox.setAttribute('disabled', 'disabled');\n\t\t}\n\t}\n\n\tmarkNodeAsNew(node)\n\t{\n\t\tDom.addClass(node, 'main-grid-row-new');\n\t}\n\n\tbindInlineEdit()\n\t{\n\t\tthis.getGrid().getRows().getBodyChild().forEach(\n\t\t\titem => Event.bind(item.node, 'click', event => this.toggleInlineEdit(item, event))\n\t\t);\n\t}\n\n\t/**\n\t * @returns {BX.UI.EntityEditor|null}\n\t */\n\tgetEditorInstance()\n\t{\n\t\tif (Reflection.getClass('BX.UI.EntityEditor'))\n\t\t{\n\t\t\treturn BX.UI.EntityEditor.getDefault();\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tbindCreateSkuProperty()\n\t{\n\t\tif (!this.canHaveSku)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst createPropertyNode = document.getElementById(this.createPropertyId);\n\t\tconst control = this.getEditorInstance().getControlByIdRecursive('variation_grid');\n\n\t\tif (Type.isDomNode(createPropertyNode) && control)\n\t\t{\n\t\t\tcontrol._createChildButton = createPropertyNode;\n\t\t\tEvent.bind(createPropertyNode, 'click', control.onCreateFieldBtnClick.bind(control));\n\t\t}\n\n\t\tconst createPropertyHintNode = document.getElementById(this.createPropertyHintId);\n\t\tEvent.bind(createPropertyHintNode, 'click', this.showHelp.bind(this));\n\t}\n\n\tshowHelp(event)\n\t{\n\t\tif (Reflection.getClass('top.BX.Helper'))\n\t\t{\n\t\t\ttop.BX.Helper.show('redirect=detail&code=11657102');\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\t// ToDo auto focus on input under event.point?\n\ttoggleInlineEdit(item: BX.Grid.Row, event)\n\t{\n\t\tlet changed = false;\n\n\t\tif (item.isEdit())\n\t\t{\n\t\t\tif (this.hasClickedOnCheckboxArea(item, event.target))\n\t\t\t{\n\t\t\t\tchanged = true;\n\t\t\t\tthis.deactivateInlineEdit(item);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (event.target.nodeName !== 'A')\n\t\t\t{\n\t\t\t\tchanged = true;\n\t\t\t\tthis.activateInlineEdit(item);\n\t\t\t}\n\n\t\t\tif (this.isSimple)\n\t\t\t{\n\t\t\t\titem.getNode()\n\t\t\t\t\t?.querySelectorAll('.main-grid-editor.main-dropdown.main-grid-editor-dropdown')\n\t\t\t\t\t.forEach((item) => {\n\t\t\t\t\t\tconst id = item.id;\n\t\t\t\t\t\tif (Type.isNil(id) || id.indexOf('SKU_GRID_PROPERTY_') === -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tEvent.unbindAll(item);\n\t\t\t\t\t\tEvent.bind(item, 'click', this.openSimpleProductRestrictionPopup.bind(this));\n\t\t\t\t\t})\n\t\t\t\t;\n\n\t\t\t\titem.getNode()\n\t\t\t\t\t?.querySelectorAll('.catalog-productcard-select-container .catalog-productcard-select-block')\n\t\t\t\t\t.forEach((item) => {\n\t\t\t\t\t\titem.onclick = null;\n\t\t\t\t\t\tEvent.unbindAll(item);\n\t\t\t\t\t\tEvent.bind(item, 'click', this.openSimpleProductRestrictionPopup.bind(this));\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t}\n\t\t}\n\n\t\tif (changed)\n\t\t{\n\t\t\tthis.emitEditedRowsEvent();\n\n\t\t\tthis.getGrid().adjustRows();\n\t\t\tthis.getGrid().updateCounterSelected();\n\t\t\tthis.getGrid().updateCounterDisplayed();\n\t\t\tthis.getGrid().adjustCheckAllCheckboxes();\n\t\t}\n\t}\n\n\thasClickedOnCheckboxArea(item: BX.Grid.Row, target)\n\t{\n\t\tif (!Type.isDomNode(target))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst cells = item.getCells();\n\n\t\tfor (let i in cells)\n\t\t{\n\t\t\tif (\n\t\t\t\tcells.hasOwnProperty(i)\n\t\t\t\t&& cells[i].contains(item.getCheckbox())\n\t\t\t\t&& (cells[i] === target || cells[i].contains(target))\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tactivateInlineEdit(item: BX.Grid.Row)\n\t{\n\t\titem.select();\n\t\titem.edit();\n\t\tthis.enableBarcodeEditor(item);\n\n\t\tthis.addSkuListCreationItem(item.getNode());\n\t}\n\n\tdeactivateInlineEdit(item: BX.Grid.Row)\n\t{\n\t\titem.editCancel();\n\t\titem.unselect();\n\n\t\t// disable multi-selection(and self re-selection) while disabling editing\n\t\tthis.getGrid().clickPrevent = true;\n\t\tsetTimeout(() => {\n\t\t\tthis.getGrid().clickPrevent = false;\n\t\t}, 100);\n\t}\n\n\tenableBarcodeEditor(item: BX.Grid.Row)\n\t{\n\t\tconst barcodeNode =\n\t\t\titem.getCellById('SKU_GRID_BARCODE')\n\t\t\t\t?.querySelector('[data-role=\"barcode-selector\"]')\n\t\t;\n\n\t\tif (barcodeNode)\n\t\t{\n\t\t\tbarcodeNode.innerHTML = '';\n\t\t\tconst inputWrapper = Tag.render`<div style=\"display: none\"></div>`;\n\t\t\tDom.append(inputWrapper, barcodeNode);\n\t\t\tconst barcodes = item.editData?.SKU_GRID_BARCODE_VALUES;\n\n\t\t\tconst items = [];\n\t\t\tif (Type.isArray(barcodes))\n\t\t\t{\n\t\t\t\tbarcodes.forEach((barcode) => {\n\t\t\t\t\tconst id = Text.toNumber(barcode.ID);\n\t\t\t\t\tconst title = barcode.BARCODE;\n\n\t\t\t\t\titems.push({\n\t\t\t\t\t\tentityId: 'productBarcode',\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttitle,\n\t\t\t\t\t});\n\n\t\t\t\t\tconst input = Tag.render`<input type=\"hidden\">`;\n\t\t\t\t\tinput.name = id;\n\t\t\t\t\tinput.value = title;\n\t\t\t\t\tinputWrapper.appendChild(input);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst createBarcode = (event: BaseEvent) => {\n\t\t\t\tif (blurThrottle)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(blurThrottle);\n\t\t\t\t}\n\n\t\t\t\tconst selector = event.getTarget();\n\t\t\t\tconst value = selector.getTextBoxValue();\n\n\t\t\t\tvalue.split(' ').forEach((title) => {\n\t\t\t\t\tif (!Type.isStringFilled(title))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst id = Text.getRandom();\n\t\t\t\t\tselector.addTag({\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttitle,\n\t\t\t\t\t\tentityId: 'productBarcode',\n\t\t\t\t\t});\n\n\t\t\t\t\tconst input = Tag.render`<input type=\"hidden\">`;\n\t\t\t\t\tinput.name = id;\n\t\t\t\t\tinput.value = title;\n\t\t\t\t\tinputWrapper.appendChild(input);\n\t\t\t\t});\n\n\t\t\t\thideBarcodeInput();\n\t\t\t};\n\n\t\t\tlet blurThrottle = null;\n\t\t\tconst hideBarcodeInput = () => {\n\t\t\t\ttagSelector.hideCreateButton();\n\t\t\t\ttagSelector.clearTextBox();\n\t\t\t\ttagSelector.showAddButton();\n\t\t\t\ttagSelector.hideTextBox();\n\t\t\t};\n\n\t\t\tconst tagSelector = new TagSelector({\n\t\t\t\tplaceholder: Loc.getMessage('C_PVG_STORE_CREATE_BARCODE_PLACEHOLDER'),\n\t\t\t\taddButtonCaption: Loc.getMessage('C_PVG_STORE_ADD_NEW_BARCODE'),\n\t\t\t\taddButtonCaptionMore: Loc.getMessage('C_PVG_STORE_ADD_ONE_MORE_BARCODE'),\n\t\t\t\titems,\n\t\t\t\tevents: {\n\t\t\t\t\tonAddButtonClick: (event: BaseEvent) => {\n\t\t\t\t\t\tconst selector = event.getTarget();\n\t\t\t\t\t\tselector.showCreateButton();\n\t\t\t\t\t},\n\t\t\t\t\tonBeforeTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\tconst data = event.getData();\n\t\t\t\t\t\tconst barcodeId = data.tag?.id;\n\t\t\t\t\t\tif (!Type.isNil(barcodeId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst name = 'input[name=\"' + barcodeId + '\"]';\n\t\t\t\t\t\t\tconst input = inputWrapper.querySelector(name);\n\t\t\t\t\t\t\tif (input)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tinput.parentNode.removeChild(input);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonCreateButtonClick: createBarcode,\n\t\t\t\t\tonEnter: createBarcode,\n\t\t\t\t\tonMetaEnter: createBarcode,\n\t\t\t\t\tonBlur: () => {\n\t\t\t\t\t\tblurThrottle = setTimeout(hideBarcodeInput, 300);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\ttagSelector.renderTo(barcodeNode);\n\t\t}\n\t}\n\n\tmodifyCustomSkuProperties(node)\n\t{\n\t\tconst postfix = '_' + node.getAttribute('data-id');\n\n\t\tnode.querySelectorAll('input[type=\"radio\"]').forEach(input => {\n\t\t\tinput.id += postfix;\n\t\t\tinput.setAttribute('name', input.getAttribute('name') + postfix);\n\t\t});\n\n\t\tnode.querySelectorAll('label[data-role]').forEach(label => {\n\t\t\tlabel.setAttribute('for', label.getAttribute('for') + postfix);\n\t\t});\n\t}\n\n\taddSkuListCreationItem(node)\n\t{\n\t\tnode.querySelectorAll('[data-role=\"dropdownContent\"] ul').forEach((listNode) => {\n\t\t\tif (!listNode.querySelector('[data-role=\"createItem\"]'))\n\t\t\t{\n\t\t\t\tconst propertyId = listNode.getAttribute('data-propertyId');\n\t\t\t\tconst createItem = Tag.render`\n\t\t\t\t\t<li data-role=\"createItem\"\n\t\t\t\t\t\t class=\"catalog-productcard-popup-select-item catalog-productcard-popup-select-item-new\"\n\t\t\t\t\t\t onclick=\"BX.Catalog.VariationGrid.firePropertyModification(${propertyId})\">\n\t\t\t\t\t\t<label class=\"catalog-productcard-popup-select-label\">\n\t\t\t\t\t\t\t<span class=\"catalog-productcard-popup-select-add\"></span>\n\t\t\t\t\t\t\t<span class=\"catalog-productcard-popup-select-text\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('C_PVG_ADD_NEW_PROPERTY_VALUE_BUTTON')}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</li>`;\n\t\t\t\tlistNode.appendChild(createItem);\n\t\t\t}\n\t\t});\n\t}\n\n\taddRowToGrid()\n\t{\n\t\tconst originalTemplate = this.redefineTemplateEditData();\n\n\t\tconst grid = this.getGrid();\n\t\tconst newRow = grid.prependRowEditor();\n\n\t\tthis.disableCheckbox(newRow);\n\n\t\tconst newNode = newRow.getNode();\n\t\tgrid.getRows().reset();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tconst newRowDataId = Text.getRandom();\n\t\t\tthis.gridEditData[newRowDataId] = {...this.gridEditData['template_0']};\n\t\t\tnewNode.setAttribute('data-id', newRowDataId);\n\t\t\tthis.markNodeAsNew(newNode);\n\t\t\tthis.modifyCustomSkuProperties(newNode);\n\t\t\tthis.addSkuListCreationItem(newNode);\n\t\t\tthis.setDeleteButton(newNode);\n\t\t\tthis.enableBarcodeEditor(newRow);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\t\tthis.updateCounterTotal();\n\t}\n\n\tupdateCounterTotal()\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst counterTotalTextContainer = grid.getCounterTotal().querySelector('.main-grid-panel-content-text');\n\t\tcounterTotalTextContainer.textContent = grid.getRows().getCountDisplayed();\n\t}\n\n\tsetDeleteButton(row)\n\t{\n\t\tconst actionCellContentContainer = row.querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tconst rowId = row?.dataset?.id;\n\n\t\tif (rowId)\n\t\t{\n\t\t\tconst deleteButton = Tag.render`\n\t\t\t\t<span\n\t\t\t\t\tclass=\"main-grid-delete-button\"\n\t\t\t\t\tonclick=\"${this.removeNewRowFromGrid.bind(this, rowId)}\"\n\t\t\t\t></span>\n\t\t\t`;\n\n\t\t\tDom.append(deleteButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\tremoveNewRowFromGrid(rowId)\n\t{\n\t\tif (!Type.isStringFilled(rowId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst gridRow = this.getGrid().getRows().getById(rowId);\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t\tthis.getGrid().updateCounterDisplayed();\n\t\t\tthis.getGrid().updateCounterSelected();\n\t\t\tthis.updateCounterTotal();\n\n\t\t\tthis.emitEditedRowsEvent();\n\t\t}\n\t}\n\n\tremoveRowFromGrid(skuId)\n\t{\n\t\tconst data = {\n\t\t\t'id': skuId,\n\t\t\t'action': 'deleteRow'\n\t\t}\n\t\tthis.getGrid().reloadTable('POST', data);\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\t// rewrite edit data because of grid component cuts necessary fields (VIEW_HTML/EDIT_HTML)\n\tsetGridEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\tredefineTemplateEditData()\n\t{\n\t\tlet newRowData = this.getEditDataFromSelectedValues();\n\n\t\tif (!newRowData)\n\t\t{\n\t\t\tnewRowData = this.getEditDataFromNotSelectedValues();\n\t\t}\n\n\t\tif (newRowData)\n\t\t{\n\t\t\tnewRowData = {...newRowData};\n\t\t\tthis.prepareNewRowData(newRowData);\n\n\t\t\tconst data = this.getGridEditData();\n\t\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData);\n\n\t\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...newRowData, ...customEditData})\n\n\t\t\treturn originalTemplateData;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetEditDataFromSelectedValues()\n\t{\n\t\tconst rowNodes = this.getGrid().getRows().getSelected();\n\n\t\treturn rowNodes.length ? rowNodes[0].editGetValues() : null;\n\t}\n\n\tgetEditDataFromNotSelectedValues()\n\t{\n\t\tconst values = this.getGrid().arParams.EDITABLE_DATA;\n\t\tconst id = Object.keys(values)\n\t\t\t.reverse()\n\t\t\t.find(index => index !== GRID_TEMPLATE_ROW && Type.isPlainObject(values[index]))\n\t\t;\n\n\t\treturn id ? values[id] : null;\n\t}\n\n\tprepareNewRowData(newRowData)\n\t{\n\t\tfor (let i in newRowData)\n\t\t{\n\t\t\tif (\n\t\t\t\tnewRowData.hasOwnProperty(i)\n\t\t\t\t&& (i.includes('[VIEW_HTML]') || i.includes('[EDIT_HTML]') || i.includes('XML_ID'))\n\t\t\t)\n\t\t\t{\n\t\t\t\tdelete newRowData[i]\n\t\t\t}\n\t\t}\n\t\tnewRowData['SKU_GRID_BARCODE'] = '<div data-role=\"barcode-selector\"></div>';\n\t}\n\n\tprepareCustomEditData(originalEditData)\n\t{\n\t\tconst customEditData = {};\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i) && i.includes('[EDIT_HTML]'))\n\t\t\t{\n\t\t\t\t// modify file input instance ids (due to collisions with default id)\n\t\t\t\tif (originalEditData[i].indexOf('new BX.UI.ImageInput') >= 0)\n\t\t\t\t{\n\t\t\t\t\tconst filePrefix = 'bx_file_' + i.replace('[EDIT_HTML]', '').toLowerCase() + '_';\n\t\t\t\t\tconst matches = originalEditData[i].match(new RegExp('\\'(' + filePrefix + '[A-Za-z0-9_]+)\\''));\n\n\t\t\t\t\tif (matches[1])\n\t\t\t\t\t{\n\t\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\t\tnew RegExp(matches[1], 'g'),\n\t\t\t\t\t\t\tfilePrefix + this.getRandomInt()\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tgetRandomInt(max = 100000)\n\t{\n\t\treturn Math.floor(Math.random() * Math.floor(max));\n\t}\n\n\tgetHeaderNames()\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\n\t\treturn headers;\n\t}\n\n\taddPropertyToGridHeader(item)\n\t{\n\t\tBX.ajax.runComponentAction(\n\t\t\t'bitrix:catalog.productcard.variation.grid',\n\t\t\t'addPropertyHeader',\n\t\t\t{\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: {\n\t\t\t\t\tgridId: this.getGrid().getId(),\n\t\t\t\t\tpropertyCode: item.id,\n\t\t\t\t\tanchor: item.anchor || null,\n\t\t\t\t\tcurrentHeaders: this.getHeaderNames()\n\t\t\t\t}\n\t\t\t}\n\t\t).then((response) => {\n\t\t\tthis.reloadGrid();\n\t\t});\n\t}\n\n\treloadGrid()\n\t{\n\t\tthis.getGrid().reload();\n\t}\n\n\tonGridUpdated(event: BaseEvent)\n\t{\n\t\tthis.getGrid().getSettingsWindow().getItems().forEach((column) => {\n\t\t\tif(this.getHeaderNames().indexOf(column.node.dataset.name) !== -1)\n\t\t\t{\n\t\t\t\tcolumn.state.selected = true;\n\t\t\t\tcolumn.checkbox.checked = true;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tcolumn.state.selected = false;\n\t\t\t\tcolumn.checkbox.checked = false;\n\t\t\t}\n\t\t});\n\t}\n\n\tonPropertySave(event: BaseEvent)\n\t{\n\t\tconst [sliderEvent] = event.getCompatData();\n\n\t\tif (sliderEvent.getEventId() === 'PropertyCreationForm:onAdd')\n\t\t{\n\t\t\tconst eventArgs = sliderEvent.getData();\n\n\t\t\tthis.addPropertyToGridHeader({\n\t\t\t\tid: eventArgs.fields.CODE\n\t\t\t});\n\t\t}\n\n\t\tif (sliderEvent.getEventId() === 'PropertyCreationForm:onModify')\n\t\t{\n\t\t\tthis.reloadGrid();\n\t\t}\n\t}\n\n\tshowPropertySettingsSlider(event: BaseEvent)\n\t{\n\t\tconst [propertyId] = event.getData();\n\t\tconst link = this.modifyPropertyLink.replace('#PROPERTY_ID#', propertyId);\n\n\t\tBX.SidePanel.Instance.open(link, {\n\t\t\twidth: 550,\n\t\t\tallowChangeHistory: false,\n\t\t\tcacheable: false\n\t\t});\n\t}\n\n\tisGridInEditMode()\n\t{\n\t\treturn this.getGrid()\n\t\t\t.getRows()\n\t\t\t.getBodyChild()\n\t\t\t.filter(row => row.isShown() && row.isEdit())\n\t\t\t.length > 0;\n\t}\n\n\tstatic firePropertyModification(propertyId, menuId)\n\t{\n\t\tif (menuId)\n\t\t{\n\t\t\tconst menu = MenuManager.getMenuById(menuId);\n\t\t\tif (menu)\n\t\t\t{\n\t\t\t\tmenu.close();\n\t\t\t\tmenu.destroy();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst popup = PopupManager.getCurrentPopup();\n\t\t\tif (popup)\n\t\t\t{\n\t\t\t\tpopup.close();\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.emit('VariationGrid::propertyModify', [propertyId]);\n\t}\n}\n\nReflection.namespace('BX.Catalog').VariationGrid = VariationGrid;\n"],"names":["GRID_TEMPLATE_ROW","VariationGrid","settings","createPropertyId","createPropertyHintId","gridId","isNew","isReadOnly","isSimple","hiddenProperties","modifyPropertyLink","productCopyLink","gridEditData","canHaveSku","storeAmount","isShowedStoreReserve","reservedDealsSliderLink","copyItemsMap","getGrid","arParams","COPY_ITEMS_MAP","supportedAjaxFields","SUPPORTED_AJAX_FIELDS","bindPopupInitToQuantityNodes","bindSliderToReservedQuantityNodes","isGridReload","addCustomClassToGrid","bindCreateNewVariation","bindCreateSkuProperty","clearGridSettingsPopupStuff","setGridEditData","enableEdit","prepareNewNodes","updateCounterSelected","disableCheckAllCheckboxes","bindInlineEdit","Event","bind","getScrollContainer","Runtime","throttle","onScrollHandler","modifyHeaders","subscribeCustomEvents","onGridUpdatedHandler","onGridUpdated","EventEmitter","subscribe","onPropertySaveHandler","onPropertySave","onAllRowsSelectHandler","onAllRowsUnselectHandler","disableEdit","showPropertySettingsSliderHandler","showPropertySettingsSlider","onPrepareDropDownItemsHandler","onPrepareDropDownItems","onCreatePopupHandler","onCreatePopup","unsubscribeCustomEvents","destroyStoreAmountPopups","unsubscribe","headers","getParam","headerName","header","locked","Type","isStringFilled","headerHint","headerCell","getColumnHeaderCellByName","id","headerTitle","querySelector","lock","Tag","render","Dom","addClass","parentNode","prepend","attr","BX","UI","Hint","init","event","popup","PopupManager","getCurrentPopup","close","propertiesWithMenu","forEach","propertyId","menu","MenuManager","getMenuById","getData","controlId","menuId","items","push","indexOf","isArray","actionList","filter","item","action","length","replace","html","Loc","getMessage","onclick","Catalog","firePropertyModification","requestAnimationFrame","document","getElementById","bindElementId","bindElement","addButton","contentContainer","appendChild","remove","addRowButton","isDomNode","openSimpleProductRestrictionPopup","addRowToGrid","getContainer","grid","Reflection","getClass","Error","Main","gridManager","getInstanceById","rows","getRows","row","isBodyChild","isTemplate","quantityNode","getNode","openStoreAmountPopup","getId","reservedQuantityNode","openDealsWithReservedProductSlider","preventDefault","stopPropagation","getPopupById","Popup","width","zIndexOptions","autoHide","draggable","overlay","closeIcon","className","content","buttons","Button","text","color","Color","PRIMARY","SidePanel","Instance","open","LINK","show","rowId","popupId","offsetLeft","offsetTop","angle","position","offset","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","getStoreAmountPopupContent","storeId","sliderLink","Uri","setQueryParam","toString","allowChangeHistory","cacheable","skuStoreAmountData","currentSkusCount","storesCount","isObject","stores","linkToDetails","getStoreAmountTable","getOpenStoreAmountDetailsSliderLabel","table","tableHead","createTHead","tableHeadRow","insertRow","addCellToTable","tableBody","createTBody","store","tableRow","title","quantityCommon","quantityReservedNode","quantityReserved","quantityAvailable","parseInt","viewQuantityAvailable","textContent","isHead","horizontalPosition","cellClassName","innerClassName","cell","insertCell","openSliderLabel","openStoreAmountSlider","destroy","isSelected","emit","current","hasClass","editCancel","unselect","emitEditedRowsEvent","selectAll","editSelected","enableBarcodeEditor","getBodyChild","map","newNode","markNodeAsNew","addSkuListCreationItem","modifyCustomSkuProperties","disableCheckbox","checkbox","getCheckbox","setAttribute","node","toggleInlineEdit","EntityEditor","getDefault","createPropertyNode","control","getEditorInstance","getControlByIdRecursive","_createChildButton","onCreateFieldBtnClick","createPropertyHintNode","showHelp","top","Helper","changed","isEdit","hasClickedOnCheckboxArea","target","deactivateInlineEdit","nodeName","activateInlineEdit","querySelectorAll","isNil","unbindAll","adjustRows","updateCounterDisplayed","adjustCheckAllCheckboxes","cells","getCells","i","hasOwnProperty","contains","select","edit","clickPrevent","setTimeout","barcodeNode","getCellById","innerHTML","inputWrapper","append","barcodes","editData","SKU_GRID_BARCODE_VALUES","barcode","Text","toNumber","ID","BARCODE","entityId","input","name","value","createBarcode","blurThrottle","clearTimeout","selector","getTarget","getTextBoxValue","split","getRandom","addTag","hideBarcodeInput","tagSelector","hideCreateButton","clearTextBox","showAddButton","hideTextBox","TagSelector","placeholder","addButtonCaption","addButtonCaptionMore","events","onAddButtonClick","showCreateButton","onBeforeTagRemove","data","barcodeId","tag","removeChild","onCreateButtonClick","onEnter","onMetaEnter","onBlur","renderTo","postfix","getAttribute","label","listNode","createItem","originalTemplate","redefineTemplateEditData","newRow","prependRowEditor","reset","newRowDataId","setDeleteButton","makeCountable","setOriginalTemplateEditData","updateCounterTotal","counterTotalTextContainer","getCounterTotal","getCountDisplayed","actionCellContentContainer","dataset","deleteButton","removeNewRowFromGrid","gridRow","getById","skuId","reloadTable","EDITABLE_DATA","newRowData","getEditDataFromSelectedValues","getEditDataFromNotSelectedValues","prepareNewRowData","getGridEditData","originalTemplateData","customEditData","prepareCustomEditData","rowNodes","getSelected","editGetValues","values","Object","keys","reverse","find","index","isPlainObject","includes","originalEditData","filePrefix","toLowerCase","matches","match","RegExp","getRandomInt","max","Math","floor","random","getHeadFirstChild","Array","from","ajax","runComponentAction","mode","propertyCode","anchor","currentHeaders","getHeaderNames","then","response","reloadGrid","reload","getSettingsWindow","getItems","column","state","selected","checked","getCompatData","sliderEvent","getEventId","eventArgs","addPropertyToGridHeader","fields","CODE","link","isShown","namespace"],"mappings":"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"}