(function(e,t,i,a,r,n){"use strict";var o,d,s,l,u,c,p,g,h,v,f;var m="template_0";var E=function(){function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"grid",null);babelHelpers.defineProperty(this,"isNew",false);babelHelpers.defineProperty(this,"propertiesWithMenu",[]);this.createPropertyId=i.createPropertyId;this.createPropertyHintId=i.createPropertyHintId;this.gridId=i.gridId;this.isNew=i.isNew;this.hiddenProperties=i.hiddenProperties;this.modifyPropertyLink=i.modifyPropertyLink;this.gridEditData=i.gridEditData;this.canHaveSku=i.canHaveSku||false;this.storeAmount=i.storeAmount;this.isShowedStoreReserve=i.isShowedStoreReserve;if(i.copyItemsMap){this.getGrid().arParams.COPY_ITEMS_MAP=i.copyItemsMap}var a=i.isGridReload||false;if(!a){this.addCustomClassToGrid();this.bindCreateNewVariation();this.bindCreateSkuProperty();this.clearGridSettingsPopupStuff()}var r=i.gridEditData||null;if(r){this.setGridEditData(r)}if(this.isNew){this.enableEdit();this.prepareNewNodes();this.getGrid().updateCounterSelected();this.getGrid().disableCheckAllCheckboxes()}else{this.bindInlineEdit();this.bindPopupInitToQuantityNodes()}t.Event.bind(this.getGrid().getScrollContainer(),"scroll",t.Runtime.throttle(this.onScrollHandler.bind(this),50));t.Event.bind(this.getGridSettingsButton(),"click",this.showGridSettingsWindowHandler.bind(this));this.subscribeCustomEvents()}babelHelpers.createClass(e,[{key:"subscribeCustomEvents",value:function e(){this.onGridUpdatedHandler=this.onGridUpdated.bind(this);i.EventEmitter.subscribe("Grid::updated",this.onGridUpdatedHandler);this.onPropertySaveHandler=this.onPropertySave.bind(this);i.EventEmitter.subscribe("SidePanel.Slider:onMessage",this.onPropertySaveHandler);this.onAllRowsSelectHandler=this.enableEdit.bind(this);i.EventEmitter.subscribe("Grid::allRowsSelected",this.onAllRowsSelectHandler);this.onAllRowsUnselectHandler=this.disableEdit.bind(this);i.EventEmitter.subscribe("Grid::allRowsUnselected",this.onAllRowsUnselectHandler);this.showPropertySettingsSliderHandler=this.showPropertySettingsSlider.bind(this);i.EventEmitter.subscribe("VariationGrid::propertyModify",this.showPropertySettingsSliderHandler);this.onPrepareDropDownItemsHandler=this.onPrepareDropDownItems.bind(this);i.EventEmitter.subscribe("Dropdown::onPrepareItems",this.onPrepareDropDownItemsHandler);this.onCreatePopupHandler=this.onCreatePopup.bind(this);i.EventEmitter.subscribe("UiSelect::onCreatePopup",this.onCreatePopupHandler)}},{key:"destroy",value:function e(){this.unsubscribeCustomEvents();this.destroyStoreAmountPopups()}},{key:"unsubscribeCustomEvents",value:function e(){if(this.onGridUpdatedHandler){i.EventEmitter.unsubscribe("Grid::updated",this.onGridUpdatedHandler);this.onGridUpdatedHandler=null}if(this.onPropertySaveHandler){i.EventEmitter.unsubscribe("SidePanel.Slider:onMessage",this.onPropertySaveHandler);this.onPropertySaveHandler=null}if(this.showPropertySettingsSliderHandler){i.EventEmitter.unsubscribe("VariationGrid::propertyModify",this.showPropertySettingsSliderHandler);this.showPropertySettingsSliderHandler=null}if(this.onPrepareDropDownItemsHandler){i.EventEmitter.unsubscribe("Dropdown::onPrepareItems",this.onPrepareDropDownItemsHandler);this.onPrepareDropDownItemsHandler=null}if(this.onAllRowsSelectHandler){i.EventEmitter.unsubscribe("Grid::allRowsSelected",this.onAllRowsSelectHandler);this.onAllRowsSelectHandler=null}if(this.onAllRowsUnselectHandler){i.EventEmitter.unsubscribe("Grid::allRowsUnselected",this.onAllRowsUnselectHandler);this.onAllRowsUnselectHandler=null}if(this.onCreatePopupHandler){i.EventEmitter.unsubscribe("UiSelect::onCreatePopup",this.onCreatePopupHandler);this.onCreatePopupHandler=null}}},{key:"getGridSettingsButton",value:function e(){return this.getGrid().getContainer().querySelector("."+this.getGrid().settings.get("classSettingsButton"))}},{key:"showGridSettingsWindowHandler",value:function e(t){var i=this;t.preventDefault();t.stopPropagation();this.askToLossGridData(function(){i.getGrid().getSettingsWindow()._onSettingsButtonClick()})}},{key:"onScrollHandler",value:function e(t){var i=a.PopupManager.getCurrentPopup();if(i){i.close()}this.propertiesWithMenu.forEach(function(e){var t=a.MenuManager.getMenuById(e+"_menu");if(t){t.close()}})}},{key:"onPrepareDropDownItems",value:function e(i){var a=i.getData(),r=babelHelpers.slicedToArray(a,3),n=r[0],o=r[1],d=r[2];if(!t.Type.isStringFilled(n)){return}this.propertiesWithMenu.push(n);if(n.indexOf("SKU_GRID_PROPERTY_")===-1){return}if(!t.Type.isArray(d)){return}var s=d.filter(function(e){return e.action==="create-new"});if(s.length>0){return}var l=n.replace("SKU_GRID_PROPERTY_","").replace("_control","");d.push({action:"create-new",html:'\n\t\t\t\t<li data-role="createItem" class="catalog-productcard-popup-select-item catalog-productcard-popup-select-item-new">\n\t\t\t\t\t<label class="catalog-productcard-popup-select-label main-dropdown-item" data-pseudo="true">\n\t\t\t\t\t\t<span class="catalog-productcard-popup-select-add"></span>\n\t\t\t\t\t\t<span class="catalog-productcard-popup-select-text">\n\t\t\t\t\t\t\t'.concat(t.Loc.getMessage("C_PVG_ADD_NEW_PROPERTY_VALUE_BUTTON"),"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</label>\n\t\t\t\t</li>"),onclick:function e(){return BX.Catalog.VariationGrid.firePropertyModification(l,o)}});requestAnimationFrame(function(){var e=document.getElementById("menu-popup-"+o);t.Dom.addClass(e,"catalog-productcard-popup-list")})}},{key:"onCreatePopup",value:function e(i){var a;var r=i.getData(),n=babelHelpers.slicedToArray(r,1),d=n[0];var s=d===null||d===void 0?void 0:(a=d.bindElement)===null||a===void 0?void 0:a.id;if(!t.Type.isStringFilled(s)){return}if(s.indexOf("SKU_GRID_PROPERTY_")===-1){return}var l=s.replace("SKU_GRID_PROPERTY_","").replace("_control","");var u=t.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="catalog-productcard-popup-select-item catalog-productcard-popup-multi-select-item-new">\n\t\t\t\t<label \n\t\t\t\t\tclass="catalog-productcard-popup-select-label main-dropdown-item">\n\t\t\t\t\t<span class="catalog-productcard-popup-select-add"></span>\n\t\t\t\t\t<span class="catalog-productcard-popup-select-text">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t"])),t.Loc.getMessage("C_PVG_ADD_NEW_PROPERTY_VALUE_BUTTON"));t.Event.bind(u,"mousedown",BX.Catalog.VariationGrid.firePropertyModification.bind(this,l));d.contentContainer.appendChild(u)}},{key:"clearGridSettingsPopupStuff",value:function e(){t.Dom.remove(document.getElementById(this.gridId+"-grid-settings-window"))}},{key:"bindCreateNewVariation",value:function e(){if(!this.canHaveSku){return}var i=document.querySelector('[data-role="catalog-productcard-variation-add-row"]');if(t.Type.isDomNode(i)){t.Event.bind(i,"click",this.addRowToGrid.bind(this))}}},{key:"addCustomClassToGrid",value:function e(){t.Dom.addClass(this.getGrid().getContainer(),"catalog-product-variation-grid")}},{key:"getGrid",value:function e(){if(this.grid===null){if(!t.Reflection.getClass("BX.Main.gridManager.getInstanceById")){throw Error("Cannot find grid with '".concat(this.gridId,"' id."))}this.grid=BX.Main.gridManager.getInstanceById(this.gridId)}return this.grid}},{key:"bindPopupInitToQuantityNodes",value:function e(){var i=this;var a=this.getGrid().getRows().getRows();a.forEach(function(e){if(e.isBodyChild()&&!e.isTemplate()){var a=e.getNode().querySelector(".main-grid-cell-content-catalog-quantity-inventory-management");if(t.Type.isDomNode(a)){t.Event.bind(a,"click",i.openStoreAmountPopup.bind(i,e.getId(),a))}}})}},{key:"openStoreAmountPopup",value:function e(t,i){var r=t+"-store-amount";var n=a.PopupManager.getPopupById(r);if(!n){n=new a.Popup(r,i,{autoHide:true,draggable:false,offsetLeft:-218,offsetTop:0,angle:{position:"top",offset:250},noAllPaddings:true,bindOptions:{forceBindPosition:true},closeByEsc:true,content:this.getStoreAmountPopupContent(t)})}n.show()}},{key:"getStoreAmountPopupContent",value:function e(i){var a=this.storeAmount[i];var r=a.storesCount;if(!t.Type.isObject(a)||r<=0){return t.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="store-amount-popup-container">\n\t\t\t\t\t<p class="store-amount-popup-not-found-message">',"</p>\n\t\t\t\t</div>\n\t\t\t"])),t.Loc.getMessage("C_PVG_STORE_AMOUNT_POPUP_EMPTY"))}var n=a.stores;var o=a.linkToDetails;return t.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="store-amount-popup-container">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this.getStoreAmountTable(n),o?this.getOpenStoreAmountDetailsSliderLabel(o,r):"")}},{key:"getStoreAmountTable",value:function e(i){var a=this;var r=t.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['<table class="main-grid-table"></table>'])));var n=r.createTHead();n.className="main-grid-header";var o=n.insertRow();o.className="main-grid-row-head";this.addCellToTable(o,t.Loc.getMessage("C_PVG_STORE_AMOUNT_POPUP_STORE"),true,"left");if(this.isShowedStoreReserve){this.addCellToTable(o,t.Loc.getMessage("C_PVG_STORE_AMOUNT_POPUP_AMOUNT"),true);this.addCellToTable(o,t.Loc.getMessage("C_PVG_STORE_AMOUNT_POPUP_QUANTITY_RESERVED"),true)}this.addCellToTable(o,t.Loc.getMessage("C_PVG_STORE_AMOUNT_POPUP_QUANTITY_COMMON"),true);var d=r.createTBody();i.forEach(function(e){var t=d.insertRow();t.className="main-grid-row main-grid-row-body";a.addCellToTable(t,e.title,false,"left");if(a.isShowedStoreReserve){a.addCellToTable(t,e.quantityAvailable,false);a.addCellToTable(t,e.quantityReserved,false)}a.addCellToTable(t,e.quantityCommon,false)});return r}},{key:"addCellToTable",value:function e(i,a,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"right";var o=r?"main-grid-cell-head main-grid-col-no-sortable main-grid-cell-":"main-grid-cell main-grid-cell-";var d=r?"main-grid-cell-head-container":"main-grid-cell-content";var s=i.insertCell();s.className=o+n;s.appendChild(t.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="main-grid-cell-inner">\n\t\t\t\t<span class="','">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t"])),d,a))}},{key:"getOpenStoreAmountDetailsSliderLabel",value:function e(i,a){var r=t.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="ui-link ui-link-secondary ui-link-dashed ui-link-open-store-amount-slider">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),t.Loc.getMessage("C_PVG_STORE_AMOUNT_POPUP_OPEN_SLIDER_BUTTON",{"#STORE_COUNT#":a}));t.Event.bind(r,"click",this.openStoreAmountSlider.bind(this,i));return r}},{key:"openStoreAmountSlider",value:function e(t){BX.SidePanel.Instance.open(t,{width:700,allowChangeHistory:false,cacheable:false})}},{key:"destroyStoreAmountPopups",value:function e(){var t=this.getGrid().getRows().getRows();t.forEach(function(e){if(e.isBodyChild()&&!e.isTemplate()){var t;var i=e.getId()+"-store-amount";var r=a.PopupManager.getPopupById(i);r===null||r===void 0?void 0:(t=r.destroy)===null||t===void 0?void 0:t.call(r)}})}},{key:"emitEditedRowsEvent",value:function e(){if(this.getGrid().getRows().isSelected()){i.EventEmitter.emit("Grid::thereEditedRows",[])}else{i.EventEmitter.emit("Grid::noEditedRows",[])}}},{key:"disableEdit",value:function e(){if(this.isNew){return}this.getGrid().getRows().getRows().forEach(function(e){if(!t.Dom.hasClass(e.getNode(),"main-grid-row-new")){e.editCancel();e.unselect()}});this.emitEditedRowsEvent()}},{key:"enableEdit",value:function e(){var t=this;this.getGrid().getRows().selectAll();this.getGrid().getRows().editSelected();this.getGrid().getRows().getRows().forEach(function(e){return t.enableBarcodeEditor(e)})}},{key:"prepareNewNodes",value:function e(){var t=this;this.getGrid().getRows().getBodyChild().map(function(e){var i=e.getNode();t.markNodeAsNew(i);t.addSkuListCreationItem(i);t.modifyCustomSkuProperties(i);t.disableCheckbox(e)})}},{key:"disableCheckbox",value:function e(i){var a=i.getCheckbox();if(t.Type.isDomNode(a)){a.setAttribute("disabled","disabled")}}},{key:"markNodeAsNew",value:function e(i){t.Dom.addClass(i,"main-grid-row-new")}},{key:"bindInlineEdit",value:function e(){var i=this;this.getGrid().getRows().getBodyChild().forEach(function(e){return t.Event.bind(e.node,"click",function(t){return i.toggleInlineEdit(e,t)})})}},{key:"getEditorInstance",value:function e(){if(t.Reflection.getClass("BX.UI.EntityEditor")){return BX.UI.EntityEditor.getDefault()}return null}},{key:"bindCreateSkuProperty",value:function e(){if(!this.canHaveSku){return}var i=document.getElementById(this.createPropertyId);var a=this.getEditorInstance().getControlByIdRecursive("variation_grid");if(t.Type.isDomNode(i)&&a){a._createChildButton=i;t.Event.bind(i,"click",a.onCreateFieldBtnClick.bind(a))}var r=document.getElementById(this.createPropertyHintId);t.Event.bind(r,"click",this.showHelp.bind(this))}},{key:"showHelp",value:function e(i){if(t.Reflection.getClass("top.BX.Helper")){top.BX.Helper.show("redirect=detail&code=11657102");i.preventDefault()}}},{key:"toggleInlineEdit",value:function e(t,i){var a=false;if(t.isEdit()){if(this.hasClickedOnCheckboxArea(t,i.target)){a=true;this.deactivateInlineEdit(t)}}else{if(i.target.nodeName!=="A"){a=true;this.activateInlineEdit(t)}}if(a){this.emitEditedRowsEvent();this.getGrid().adjustRows();this.getGrid().updateCounterSelected();this.getGrid().updateCounterDisplayed();this.getGrid().adjustCheckAllCheckboxes()}}},{key:"hasClickedOnCheckboxArea",value:function e(i,a){if(!t.Type.isDomNode(a)){return}var r=i.getCells();for(var n in r){if(r.hasOwnProperty(n)&&r[n].contains(i.getCheckbox())&&(r[n]===a||r[n].contains(a))){return true}}return false}},{key:"activateInlineEdit",value:function e(t){t.select();t.edit();this.enableBarcodeEditor(t);this.addSkuListCreationItem(t.getNode())}},{key:"deactivateInlineEdit",value:function e(t){var i=this;t.editCancel();t.unselect();this.getGrid().clickPrevent=true;setTimeout(function(){i.getGrid().clickPrevent=false},100)}},{key:"enableBarcodeEditor",value:function e(i){var a;var r=(a=i.getCellById("SKU_GRID_BARCODE"))===null||a===void 0?void 0:a.querySelector('[data-role="barcode-selector"]');if(r){var o;var d=t.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['<div style="display: none"></div>'])));r.appendChild(d);var s=(o=i.editData)===null||o===void 0?void 0:o.SKU_GRID_BARCODE_VALUES;var l=[];if(t.Type.isArray(s)){s.forEach(function(e){var i=t.Text.toNumber(e.ID);var a=e.BARCODE;l.push({entityId:"productBarcode",id:i,title:a});var r=t.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['<input type="hidden">'])));r.name=i;r.value=a;d.appendChild(r)})}var u=function e(i){if(c){clearTimeout(c)}var a=i.getTarget();var r=a.getTextBoxValue();r.split(" ").forEach(function(e){if(!t.Type.isStringFilled(e)){return}var i=t.Text.getRandom();a.addTag({id:i,title:e,entityId:"productBarcode"});var r=t.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['<input type="hidden">'])));r.name=i;r.value=e;d.appendChild(r)});v()};var c=null;var v=function e(){f.hideCreateButton();f.clearTextBox();f.showAddButton();f.hideTextBox()};var f=new n.TagSelector({placeholder:t.Loc.getMessage("C_PVG_STORE_CREATE_BARCODE_PLACEHOLDER"),addButtonCaption:t.Loc.getMessage("C_PVG_STORE_ADD_NEW_BARCODE"),addButtonCaptionMore:t.Loc.getMessage("C_PVG_STORE_ADD_ONE_MORE_BARCODE"),items:l,events:{onAddButtonClick:function e(t){var i=t.getTarget();i.showCreateButton()},onBeforeTagRemove:function e(i){var a;var r=i.getData();var n=(a=r.tag)===null||a===void 0?void 0:a.id;if(!t.Type.isNil(n)){var o='input[name="'+n+'"]';var s=d.querySelector(o);if(s){s.parentNode.removeChild(s)}}},onCreateButtonClick:u,onEnter:u,onMetaEnter:u,onBlur:function e(){c=setTimeout(v,300)}}});f.renderTo(r)}}},{key:"modifyCustomSkuProperties",value:function e(t){var i="_"+t.getAttribute("data-id");t.querySelectorAll('input[type="radio"]').forEach(function(e){e.id+=i;e.setAttribute("name",e.getAttribute("name")+i)});t.querySelectorAll("label[data-role]").forEach(function(e){e.setAttribute("for",e.getAttribute("for")+i)})}},{key:"addSkuListCreationItem",value:function e(i){i.querySelectorAll('[data-role="dropdownContent"] ul').forEach(function(e){if(!e.querySelector('[data-role="createItem"]')){var i=e.getAttribute("data-propertyId");var a=t.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<li data-role="createItem"\n\t\t\t\t\t\t class="catalog-productcard-popup-select-item catalog-productcard-popup-select-item-new"\n\t\t\t\t\t\t onclick="BX.Catalog.VariationGrid.firePropertyModification(',')">\n\t\t\t\t\t\t<label class="catalog-productcard-popup-select-label">\n\t\t\t\t\t\t\t<span class="catalog-productcard-popup-select-add"></span>\n\t\t\t\t\t\t\t<span class="catalog-productcard-popup-select-text">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</li>"])),i,t.Loc.getMessage("C_PVG_ADD_NEW_PROPERTY_VALUE_BUTTON"));e.appendChild(a)}})}},{key:"addRowToGrid",value:function e(){var a=this.redefineTemplateEditData();var r=this.getGrid();var n=r.prependRowEditor();this.disableCheckbox(n);var o=n.getNode();r.getRows().reset();if(t.Type.isDomNode(o)){var d=t.Text.getRandom();this.gridEditData[d]=babelHelpers.objectSpread({},this.gridEditData["template_0"]);o.setAttribute("data-id",d);this.markNodeAsNew(o);this.modifyCustomSkuProperties(o);this.addSkuListCreationItem(o);this.setDeleteButton(o);n.makeCountable()}if(a){this.setOriginalTemplateEditData(a)}i.EventEmitter.emit("Grid::thereEditedRows",[]);r.adjustRows();r.updateCounterDisplayed();r.updateCounterSelected();this.updateCounterTotal()}},{key:"updateCounterTotal",value:function e(){var t=this.getGrid();var i=t.getCounterTotal().querySelector(".main-grid-panel-content-text");i.textContent=t.getRows().getCountDisplayed()}},{key:"setDeleteButton",value:function e(i){var a;var r=i.querySelector(".main-grid-cell-action .main-grid-cell-content");var n=i===null||i===void 0?void 0:(a=i.dataset)===null||a===void 0?void 0:a.id;if(n){var o=t.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span \n\t\t\t\t\tclass="main-grid-delete-button" \n\t\t\t\t\tonclick="','"\n\t\t\t\t></span>\n\t\t\t'])),this.removeNewRowFromGrid.bind(this,n));t.Dom.append(o,r)}}},{key:"removeNewRowFromGrid",value:function e(i){if(!t.Type.isStringFilled(i)){return}var a=this.getGrid().getRows().getById(i);if(a){t.Dom.remove(a.getNode());this.getGrid().getRows().reset();this.getGrid().updateCounterDisplayed();this.getGrid().updateCounterSelected();this.updateCounterTotal();this.emitEditedRowsEvent()}}},{key:"removeRowFromGrid",value:function e(t){var i={id:t,action:"deleteRow"};this.getGrid().reloadTable("POST",i)}},{key:"getGridEditData",value:function e(){return this.getGrid().arParams.EDITABLE_DATA}},{key:"setGridEditData",value:function e(t){this.getGrid().arParams.EDITABLE_DATA=t}},{key:"setOriginalTemplateEditData",value:function e(t){this.getGrid().arParams.EDITABLE_DATA[m]=t}},{key:"redefineTemplateEditData",value:function e(){var t=this.getEditDataFromSelectedValues();if(!t){t=this.getEditDataFromNotSelectedValues()}if(t){t=babelHelpers.objectSpread({},t);this.prepareNewRowData(t);var i=this.getGridEditData();var a=i[m];var r=this.prepareCustomEditData(a);this.setOriginalTemplateEditData(babelHelpers.objectSpread({},a,t,r));return a}return null}},{key:"getEditDataFromSelectedValues",value:function e(){var t=this.getGrid().getRows().getSelected();return t.length?t[0].editGetValues():null}},{key:"getEditDataFromNotSelectedValues",value:function e(){var i=this.getGrid().arParams.EDITABLE_DATA;var a=Object.keys(i).reverse().find(function(e){return e!==m&&t.Type.isPlainObject(i[e])});return a?i[a]:null}},{key:"prepareNewRowData",value:function e(t){for(var i in t){if(t.hasOwnProperty(i)&&(i.includes("[VIEW_HTML]")||i.includes("[EDIT_HTML]"))){delete t[i]}}}},{key:"prepareCustomEditData",value:function e(t){var i={};for(var a in t){if(t.hasOwnProperty(a)&&a.includes("[EDIT_HTML]")){if(t[a].indexOf("new BX.UI.ImageInput")>=0){var r="bx_file_"+a.replace("[EDIT_HTML]","").toLowerCase()+"_";var n=t[a].match(new RegExp("'("+r+"[A-Za-z0-9_]+)'"));if(n[1]){i[a]=t[a].replace(new RegExp(n[1],"g"),r+this.getRandomInt())}}}}return i}},{key:"getRandomInt",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1e5;return Math.floor(Math.random()*Math.floor(t))}},{key:"getHeaderNames",value:function e(){var t=[];var i=this.getGrid().getRows().getHeadFirstChild().getCells();Array.from(i).forEach(function(e){if("name"in e.dataset){t.push(e.dataset.name)}});return t}},{key:"addPropertyToGridHeader",value:function e(t){var i=this;BX.ajax.runComponentAction("bitrix:catalog.productcard.variation.grid","addPropertyHeader",{mode:"ajax",data:{gridId:this.getGrid().getId(),propertyCode:t.id,anchor:t.anchor||null,currentHeaders:this.getHeaderNames()}}).then(function(e){i.reloadGrid()})}},{key:"reloadGrid",value:function e(){this.getGrid().reload()}},{key:"onGridUpdated",value:function e(t){var i=this;this.getGrid().getSettingsWindow().getItems().forEach(function(e){if(i.getHeaderNames().indexOf(e.node.dataset.name)!==-1){e.state.selected=true;e.checkbox.checked=true}else{e.state.selected=false;e.checkbox.checked=false}})}},{key:"onPropertySave",value:function e(t){var i=t.getCompatData(),a=babelHelpers.slicedToArray(i,1),r=a[0];if(r.getEventId()==="PropertyCreationForm:onAdd"){var n=r.getData();this.addPropertyToGridHeader({id:n.fields.CODE})}if(r.getEventId()==="PropertyCreationForm:onModify"){this.reloadGrid()}}},{key:"showPropertySettingsSlider",value:function e(t){var i=t.getData(),a=babelHelpers.slicedToArray(i,1),r=a[0];var n=this.modifyPropertyLink.replace("#PROPERTY_ID#",r);this.askToLossGridData(function(){BX.SidePanel.Instance.open(n,{width:550,allowChangeHistory:false,cacheable:false})})}},{key:"askToLossGridData",value:function e(i,a,n){if(this.isGridInEditMode()){var o={title:t.Loc.getMessage("C_PVG_UNSAVED_DATA_TITLE"),message:t.Loc.getMessage("C_PVG_UNSAVED_DATA_MESSAGE"),modal:true,buttons:r.MessageBoxButtons.OK_CANCEL,okCaption:t.Loc.getMessage("C_PVG_UNSAVED_DATA_CONTINUE"),onOk:function e(t){i&&i();t.close()},onCancel:function e(t){a&&a();t.close()}};r.MessageBox.show(babelHelpers.objectSpread({},o,n))}else{i&&i()}}},{key:"isGridInEditMode",value:function e(){return this.getGrid().getRows().getBodyChild().filter(function(e){return e.isShown()&&e.isEdit()}).length>0}}],[{key:"firePropertyModification",value:function e(t,r){if(r){var n=a.MenuManager.getMenuById(r);if(n){n.close();n.destroy()}}else{var o=a.PopupManager.getCurrentPopup();if(o){o.close()}}i.EventEmitter.emit("VariationGrid::propertyModify",[t])}}]);return e}();t.Reflection.namespace("BX.Catalog").VariationGrid=E})(this.window=this.window||{},BX,BX.Event,BX.Main,BX.UI.Dialogs,BX.UI.EntitySelector);
//# sourceMappingURL=script.map.js