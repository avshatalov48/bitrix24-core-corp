(function(t){BX.namespace("BX.Sender.UI.Mailbox");if(BX.Sender.UI.Mailbox.Selector){return}var e=BX.Sender.Helper;function i(t){}i.prototype.init=function(t){this.mess=t.mess;this.list=t.list;this.context=BX(t.containerId);this.input=e.getNode("mailbox-input",this.context);this.mailbox=e.getNode("mailbox",this.context);BX.bind(this.mailbox,"click",this.showMenu.bind(this))};i.prototype.onClick=function(t){this.input.value=t.sender;this.mailbox.textContent=t.sender;this.popupMenu.close()};i.prototype.showAdd=function(){BXMainMailConfirm.showForm(this.onAdd.bind(this));this.popupMenu.close()};i.prototype.onAdd=function(t,e){if(!e){return}t.sender=e;t.id=BX.util.hashCode(t.sender);this.list.push(t);this.popupMenu.addMenuItem(this.getMenuItem(t),"new")};i.prototype.getMenuItem=function(t){return{id:t.id,text:BX.util.htmlspecialchars(t.sender),onclick:this.onClick.bind(this,t)}};i.prototype.showMenu=function(){if(this.popupMenu){this.popupMenu.show();return}var t=this.list.map(this.getMenuItem,this);t.push({delimiter:true});t.push({id:"new",text:this.mess.addAddress,onclick:this.showAdd.bind(this)});this.popupMenu=BX.PopupMenu.create("sender-ui-mailbox-selector",this.mailbox,t,{autoHide:true,autoClose:true});this.popupMenu.show()};BX.Sender.UI.Mailbox.Selector=new i})(window);