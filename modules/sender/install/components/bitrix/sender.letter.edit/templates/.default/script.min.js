(function(e){BX.namespace("BX.Sender");if(BX.Sender.Letter){return}var t=BX.Sender.Page;var i=BX.Sender.Helper;function s(){this.context=null}s.prototype.init=function(e){this.context=BX(e.containerId);this.actionUri=e.actionUri;this.isFrame=e.isFrame||false;this.prettyDateFormat=e.prettyDateFormat;this.isSaved=e.isSaved||false;this.isOutside=e.isOutside||false;this.mess=e.mess;this.letterTile=e.letterTile||{};this.hasBottomTextareaPanel=e.hasBottomTextareaPanel;this.AITextContextId=e.AITextContextId;this.isAITextAvailable=e.isAITextAvailable==="Y";this.templateChangeButton=BX("SENDER_LETTER_BUTTON_CHANGE");this.selectorNode=i.getNode("template-selector",this.context);this.editorNode=i.getNode("letter-editor",this.context);this.titleNode=i.getNode("letter-title",this.context);this.buttonsNode=i.getNode("letter-buttons",this.context);this.templateNameNode=i.getNode("template-name",this.editorNode);this.templateTypeNode=i.getNode("template-type",this.editorNode);this.templateIdNode=i.getNode("template-id",this.editorNode);this.consentPreviewNodes=i.getNodes("consent-preview",this.editorNode);if(BX.Sender.Template&&BX.Sender.Template.Selector){var s=BX.Sender.Template.Selector;BX.addCustomEvent(s,s.events.templateSelect,this.onTemplateSelect.bind(this));BX.addCustomEvent(s,s.events.selectorClose,this.closeTemplateSelector.bind(this))}if(this.templateChangeButton){BX.bind(this.templateChangeButton,"click",this.showTemplateSelector.bind(this))}if(this.consentPreviewNodes){this.consentPreviewNodes.forEach(function(e){BX.bind(e,"click",this.showConsentPreview.bind(this))}.bind(this))}if(this.isFrame){i.titleEditor.init({dataNode:this.titleNode,disabled:e.isTemplateShowed,defaultTitle:this.getPatternTitle(this.mess.name)});BX.addCustomEvent("SidePanel.Slider:onClose",this.onPopupClose.bind(this))}t.initButtons();if(this.isFrame&&this.isSaved){top.BX.onCustomEvent(top,"sender-letter-edit-change",[this.letterTile]);BX.Sender.Page.slider.close();if(this.isOutside){BX.UI.Notification.Center.notify({content:this.mess.outsideSaveSuccess,autoHideDelay:5e3})}}if(this.isMSBrowser()){this.context.classList.add("bx-sender-letter-ms-ie")}if(this.hasBottomTextareaPanel){this.createBottomTextareaPanel()}};s.prototype.createBottomTextareaPanel=function(){this.configurationMessageInput=document.getElementById("CONFIGURATION_COMMENT");if(this.configurationMessageInput){const e=BX.create("div",{props:{className:"sender-letter-textarea-bottom-panel"},children:[BX.create("span",{attrs:{"data-bx-sms-panel-tools-button":"ai-text",class:"sender-letter-text-editor-panel-tools-item sender-letter-text-editor-panel-tools-ai-text"}})]});this.configurationMessageInput.classList.add("sender-letter-text-editor-configuration-message-with-panel");const t=this.configurationMessageInput.parentNode;t.classList.add("sender-letter-text-editor-message-wrap");t.appendChild(e);this.initPanelToolsButtons()}};s.prototype.initPanelToolsButtons=function(){if(this.isAITextAvailable){const e=this.context.querySelector('[data-bx-sms-panel-tools-button="ai-text"]');e.addEventListener("click",(()=>{const e=new BX.AI.Picker({moduleId:"sender",contextId:this.AITextContextId,analyticLabel:"sender_letter_ai_text",history:true,onSelect:e=>{const t=e.data;this.configurationMessageInput.value=this.configurationMessageInput.value+t},onTariffRestriction:()=>{}});e.setLangSpace(BX.AI.Picker.LangSpace.text);e.text()}))}};s.prototype.onPopupClose=function(e){var t=e.getSlider();var i=this;if(!this.isSaved){self.popupWindow=BX.PopupWindowManager.create("sender-letter-on-slider-close",null,{content:this.mess.applyClose,titleBar:this.mess.applyCloseTitle,width:400,height:200,padding:10,closeByEsc:true,contentColor:"white",angle:false,buttons:[new BX.PopupWindowButton({text:this.mess.applyYes,className:"popup-window-button-accept",events:{click:function(){BX.removeCustomEvent("SidePanel.Slider::onClose",i.onPopupClose);e.allowAction();t.close();setTimeout((function(){t.destroy()}),500)}}}),new BX.PopupWindowButton({text:this.mess.applyCancel,className:"popup-window-button-cancel",events:{click:function(){this.popupWindow.close()}}})]}).show();if(typeof t.data.close==="undefined"||t.data.close===false){e.denyAction()}}};s.prototype.isMSBrowser=function(){return e.navigator.userAgent.match(/(Trident\/|MSIE|Edge\/)/)!==null};s.prototype.getPatternTitle=function(e){return i.replace(this.mess.patternTitle,{name:e,date:BX.date.format(this.prettyDateFormat)})};s.prototype.onTemplateSelect=function(t){if(this.templateNameNode){this.templateNameNode.textContent=t.name}if(this.templateTypeNode){this.templateTypeNode.value=t.type}if(this.templateIdNode){this.templateIdNode.value=t.code}if(t.dispatch){i.getNodes("dispatch",this.context).forEach((function(e){var i=e.getAttribute("data-code");if(t.dispatch[i]){e.value=t.dispatch[i]}}))}this.titleNode.value=this.getPatternTitle(t.name);BX.fireEvent(this.titleNode,"change");this.closeTemplateSelector();e.scrollTo(0,0)};s.prototype.closeTemplateSelector=function(){this.changeDisplayingTemplateSelector(false)};s.prototype.showTemplateSelector=function(){this.changeDisplayingTemplateSelector(true)};s.prototype.showConsentPreview=function(e){e.preventDefault();var t=e.target;var i=document.getElementsByName(t.dataset.bxInputName)[0];var s=i.value;BX.Sender.ConsentPreview.open(s)};s.prototype.changeDisplayingTemplateSelector=function(e){var t="bx-sender-letter-show";var s="bx-sender-letter-hide";i.changeClass(this.selectorNode,t,e);i.changeClass(this.selectorNode,s,!e);i.changeClass(this.editorNode,t,!e);i.changeClass(this.editorNode,s,e);i.changeDisplay(this.templateChangeButton,!e);i.changeDisplay(this.buttonsNode,!e);e?i.titleEditor.disable():i.titleEditor.enable()};s.prototype.applyChanges=function(){var e=this.context.getElementsByTagName("form");if(e&&e[0]){e[0].appendChild(BX.create("input",{attrs:{type:"hidden",name:"apply",value:"Y"}}))}};BX.Sender.Letter=new s})(window);
//# sourceMappingURL=script.map.js