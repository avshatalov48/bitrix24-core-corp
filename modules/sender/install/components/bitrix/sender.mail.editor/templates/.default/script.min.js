(function(e){BX.namespace("BX.Sender.Mail");if(BX.Sender.Mail.Editor){return}var t={changeDisplay:function(e,t){if(!e){return}e.style.display=t?"":"none"}};function i(){}i.prototype.init=function(e){this.id=e.id;this.input=BX(e.inputId);this.placeHolders=e.placeHolders;this.mess=e.mess;this.context=BX(e.containerId);this.blockNode=this.context.querySelector("[data-bx-editor-block]");this.plainNode=this.context.querySelector("[data-bx-editor-plain]");this.inputNode=this.plainNode.querySelector("[data-bx-input]");BX.addCustomEvent("OnEditorInitedBefore",this.onEditorInitedBefore.bind(this));BX.addCustomEvent("OnEditorInitedAfter",this.onEditorInitedAfter.bind(this));if(BX.Sender.Template&&BX.Sender.Template.Selector){var t=BX.Sender.Template.Selector;BX.addCustomEvent(t,t.events.templateSelect,this.onTemplateSelect.bind(this))}};i.prototype.onTemplateSelect=function(e){var t=e.messageFields.some(function(e){return e.code==="MESSAGE"&&e.onDemand});if(t){var i=BX.Sender.Template.Selector.getTemplateRequestingUri(e);this.setTemplateUri(i)}else{e.messageFields.forEach(function(e){if(e.code!=="MESSAGE"){return}this.setContent(e.value)},this)}};i.prototype.isTargetEditor=function(e){if(!e){return false}return e.id.indexOf("BX_BLOCK_EDITOR_CONTENT")===0};i.prototype.onEditorInitedAfter=function(e){if(!this.isTargetEditor(e)){return}e.components.SetComponentIcludeMethod("EventMessageThemeCompiler::includeComponent")};i.prototype.onEditorInitedBefore=function(t){if(!this.isTargetEditor(t)){return}BX.extend(o,e.BXHtmlEditor.DropDownList);e.BXHtmlEditor.Controls["placeholder_selector"]=o;BX.addCustomEvent(t,"PlaceHolderSelectorListCreate",this.onPlaceHolderSelectorListCreate.bind(this));BX.addCustomEvent(t,"GetControlsMap",this.onGetControlsMap.bind(this))};i.prototype.onGetControlsMap=function(e){e.push({id:"placeholder_selector",compact:true,hidden:false,sort:1,checkWidth:false,offsetWidth:32})};i.prototype.onPlaceHolderSelectorListCreate=function(e){e.placeHolders=this.placeHolders};i.prototype.isSupportedTemplateUri=function(){return true};i.prototype.setTemplateUri=function(e){if(this.input.value&&!this.isShowedBlock()&&!this.confirmTemplateChange()){return}BX.BlockEditorManager.get(this.id).load(e);this.switchView(true)};i.prototype.isShowedBlock=function(){return this.blockNode.style.display!=="none"};i.prototype.confirmTemplateChange=function(){return confirm(this.mess.changeTemplate)};i.prototype.switchView=function(e){t.changeDisplay(this.blockNode,e);t.changeDisplay(this.plainNode,!e)};i.prototype.setContent=function(e){if(this.isShowedBlock()&&!this.confirmTemplateChange()){return}this.inputNode.value=e;this.switchView(false)};function o(e,t){var i=BX.Sender.Mail.Editor.mess.placeHolderTitle;o.superclass.constructor.apply(this,arguments);this.id="placeholder_selector";this.title=i;this.action="insertHTML";this.zIndex=3008;this.placeHolders=[];e.On("PlaceHolderSelectorListCreate",[this]);this.disabledForTextarea=false;this.arValues=[];for(var n in this.placeHolders){var r=this.placeHolders[n];r.value="#"+r.CODE+"#";this.arValues.push({id:r.CODE,name:r.NAME,topName:i,title:r.value+" - "+r.DESC,className:"",style:"",action:"insertHTML",value:r.value})}this.Create();this.pCont.innerHTML=i;if(t){t.appendChild(this.GetCont())}}setTimeout(function(){if(e.BXHtmlEditor){BX.extend(o,e.BXHtmlEditor.DropDownList);e.BXHtmlEditor.Controls["placeholder_selector"]=o}},300);BX.Sender.Mail.Editor=new i;if(BX.Sender.Message.Editor.setAdaptedInstance){BX.Sender.Message.Editor.setAdaptedInstance(BX.Sender.Mail.Editor)}})(window);