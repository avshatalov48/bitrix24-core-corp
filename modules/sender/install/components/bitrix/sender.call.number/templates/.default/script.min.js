(function(){BX.namespace("BX.Sender.Call");if(BX.Sender.Call.Number){return}var e=BX.Sender.Helper;function t(){}t.prototype.init=function(t){this.context=BX(t.containerId);this.providerSelectorNode=e.getNode("provider-selector",this.context);this.numberSelectorNode=e.getNode("number-selector",this.context);this.numberSelectorBlockNode=e.getNode("number-selector-block",this.context);this.selectedProvider=false;this.inputNode=e.getNode("number-input",this.context);this.list=t.list;var o=this.list.map(function(e){return{id:e.id,text:e.name,onclick:this.onProviderSelect.bind(this,e)}},this);if(t.hasRest){o.push({delimiter:true},{text:t.mess.marketplaceSendersList,href:"/marketplace/category/voximplant_infocalls/",target:"_blank"})}if(this.list.length>0){BX.bind(this.providerSelectorNode,"click",this.showMenu.bind(this,this.providerSelectorNode,o,"main"));BX.bind(this.numberSelectorNode,"click",this.showNumbersMenu.bind(this));var i=this.inputNode.value;var r=false;var s=false;if(i){for(var n=0;n<this.list.length;n++){var u=this.list[n];if(u.numbers&&u.numbers.length){for(var d=0;d<u.numbers.length;d++){if(i.toString()===u.numbers[d].id.toString()){r=u;s=u.numbers[d];break}}}else if(i.toString()===u.id.toString()){r=u}if(r)break}}if(r){this.setProvider(r,s)}else{this.setProvider(this.list[0],false)}}else{var u={id:"",name:this.providerSelectorNode.getAttribute("data-setup-name")};this.setProvider(u,false);var l=this.providerSelectorNode.getAttribute("data-setup-uri");BX.bind(this.providerSelectorNode,"click",function(){top.location.href=l})}};t.prototype.setProvider=function(e,t){if(this.selectedProvider.id==e.id){return}this.selectedProvider=e;this.providerSelectorNode.textContent=e.name;this.inputNode.value=e.hasOwnProperty("id")?e.id:"";if(e.numbers&&e.numbers.length){this.showNumbersSelector(e,t)}else{this.hideNumbersSelector()}};t.prototype.setNumber=function(e){this.numberSelectorNode.textContent=e.name;this.inputNode.value=e.id};t.prototype.onProviderSelect=function(e,t){this.setProvider(e,false);this.closeMenu()};t.prototype.showNumbersSelector=function(e,t){BX.show(this.numberSelectorBlockNode);this.setNumber(t?t:e.numbers[0])};t.prototype.hideNumbersSelector=function(){BX.hide(this.numberSelectorBlockNode)};t.prototype.showNumbersMenu=function(){if(!this.selectedProvider||!this.selectedProvider.numbers||!this.selectedProvider.numbers.length)return;var e=this.selectedProvider.numbers.map(function(e){return{id:e.id,text:e.name,onclick:this.onNumberSelect.bind(this,e)}},this);this.destroyMenu("numbers");this.showMenu(this.numberSelectorNode,e,"numbers")};t.prototype.onNumberSelect=function(e,t){this.setNumber(e);this.closeMenu()};t.prototype.showMenu=function(e,t,o){this.popup=this.createMenu("sender-call-number-"+o,e,t,{offsetLeft:10});this.popup.popupWindow.show()};t.prototype.createMenu=function(e,t,o,i){i=i||{};return BX.PopupMenu.create(e,t,o,{autoHide:true,offsetLeft:i.offsetLeft?i.offsetLeft:-21,offsetTop:i.offsetTop?i.offsetTop:-3,angle:{position:"top",offset:42}})};t.prototype.closeMenu=function(){if(this.popup&&this.popup.popupWindow){this.popup.popupWindow.close()}};t.prototype.destroyMenu=function(e){BX.PopupMenu.destroy("sender-call-number-"+e)};BX.Sender.Call.Number=new t})(window);
//# sourceMappingURL=script.map.js