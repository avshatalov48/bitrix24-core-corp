(function(){BX.namespace("BX.Sender");if(BX.Sender.ContactImport){return}var t=BX.Sender.Helper;var i=BX.Sender.Page;function e(){}e.prototype.init=function(e){this.context=BX(e.containerId);this.listId=e.listId||null;this.listData=null;this.blacklist=e.blacklist||false;this.limit=e.limit||500;this.pathToList=e.pathToList;this.actionUri=e.actionUri;this.textarea=t.getNode("text-list",this.context);this.button=t.getNode("panel-button-save",this.context);this.process=t.getNode("process",this.context);this.loader=t.getNode("loader",this.context);this.indicator=t.getNode("indicator",this.context);i.initButtons();this.ajaxAction=new BX.AjaxAction(this.actionUri);if(this.button){BX.bind(this.button,"click",this.run.bind(this))}};e.prototype.exit=function(){if(i.slider.isInSlider()){if(this.listData){top.BX.onCustomEvent(top,"BX.Sender.ContactImport::loaded",[this.listData])}i.slider.close()}else{window.location.href=this.pathToList}};e.prototype.run=function(){var i=this.loader;i.style.display="";setTimeout(function(){i.style.opacity=1},50);this.updateProcess();var e=this.getTextPortion();if(e.length===0){setTimeout(this.exit.bind(this),500);return}var s=t.getNode("set-id",this.context);var n=t.getNode("set-name",this.context);var a=this;this.ajaxAction.request({action:"importList",onsuccess:function(t){var i=t.data||{};a.listId=i.ID;a.listData=i;a.run()},data:{list:e,listId:this.listId?this.listId:s?s.value:"",listName:n?n.value:""},urlParams:{blacklist:this.blacklist?"Y":"N"}})};e.prototype.updateProcess=function(){if(!this.initialValue){this.initialValue=this.getTextLength()}var t=100;if(this.initialValue){t=(this.initialValue-this.getTextLength())/this.initialValue;t=Math.round(t*100)}this.process.textContent=t;this.indicator.style.width=t+"%"};e.prototype.getTextLength=function(){var t=this.textarea.value.match(/\n/g);return t?t.length:0};e.prototype.getTextPortion=function(){var t=[];var i=/\n/g;var e=this.textarea.value.trim();var s=i.lastIndex;do{var n=i.exec(e);var a=n?i.lastIndex:e.length;var o=e.substring(s,a).trim();s=a;if(o.length===0||o.length>255){if(!n){break}continue}t.push(o);if(t.length>=this.limit){break}}while(n);this.textarea.value=!o?"":this.textarea.value.trim().substring(a);return t};BX.Sender.ContactImport=new e})(window);