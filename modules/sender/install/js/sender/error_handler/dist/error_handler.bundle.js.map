{"version":3,"file":"error_handler.bundle.js","sources":["../src/error_handler.js"],"sourcesContent":["import {Loc, Tag, Type, Runtime} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport \"./error_handler.css\";\n\nexport class ErrorHandler\n{\n\tconstructor()\n\t{\n\t}\n\n\tonError(errorCode, data, callbackSuccess, callbackFailure)\n\t{\n\t\tlet handlers = this.getHandlers(callbackSuccess, callbackFailure);\n\t\tif (handlers.hasOwnProperty(errorCode) && Type.isFunction(handlers[errorCode]))\n\t\t{\n\t\t\thandlers[errorCode].apply(this, [data]);\n\t\t}\n\t}\n\n\tgetHandlers(callbackSuccess, callbackFailure, extraData)\n\t{\n\t\treturn {\n\t\t\t'WRONG_EMAIL_FROM': this.getWrongEmailFromHandler.bind(this, callbackSuccess, callbackFailure, extraData),\n\t\t\t'FEATURE_NOT_AVAILABLE': this.getFeatureUnavailableHandler.bind(this, callbackSuccess, callbackFailure, extraData),\n\t\t\t'NEED_ACCEPT_AGREEMENT': this.needAcceptAgreementHandler.bind(this, callbackSuccess, callbackFailure, extraData),\n\t\t};\n\t}\n\n\tgetWrongEmailFromHandler(callbackSuccess, callbackFailure, extraData, data) {\n\t\tif (extraData) {\n\t\t\tObject.assign(data, extraData);\n\t\t}\n\t\tthis.oncloseCalbackActive = true;\n\t\tif (!this.wrongEmailFromPopup)\n\t\t{\n\t\t\tthis.wrongEmailFromPopup = BX.PopupWindowManager.create(\n\t\t\t\t{\n\t\t\t\t\tid: 'sender_user_error_wrongEmailFrom',\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tlightShadow: true,\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\toverlay: {backgroundColor: 'black', opacity: 500},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonPopupClose: () => {\n\t\t\t\t\t\t\tif (this.oncloseCalbackActive && Type.isFunction(callbackFailure)) {\n\t\t\t\t\t\t\t\tcallbackFailure(data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\tthis.wrongEmailFromPopup.setContent(Tag.render`<div class=\"sender-user-error-handler-text\">\n\t\t\t${Loc.getMessage('SENDER_ERROR_HANDLER_WRONG_FROM_EMAIL_TITLE')}\n\t\t\t<br>\n\t\t\t${Loc.getMessage('SENDER_ERROR_HANDLER_WRONG_FROM_EMAIL_MESSAGE')}\n\t\t\t</div>`);\n\t\tthis.wrongEmailFromPopup.setButtons([\n\t\t\tnew BX.UI.Button({\n\t\t\t\ttext : Loc.getMessage('SENDER_ERROR_HANDLER_WRONG_FROM_EMAIL_EDIT_EMAIL'),\n\t\t\t\tcolor: BX.UI.Button.Color.SUCCESS,\n\t\t\t\tonclick: () => {\n\t\t\t\t\tlocation.href = data.editUrl;\n\t\t\t\t\tthis.oncloseCalbackActive = false;\n\t\t\t\t\tthis.wrongEmailFromPopup.close();\n\t\t\t\t}\n\t\t\t}),\n\t\t\tnew BX.UI.Button({\n\t\t\t\ttext : Loc.getMessage('SENDER_ERROR_HANDLER_WRONG_FROM_EMAIL_CANCEL'),\n\t\t\t\tcolor: BX.UI.Button.Color.LINK,\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis.wrongEmailFromPopup.close();\n\t\t\t\t}\n\t\t\t}),\n\t\t]);\n\t\tthis.wrongEmailFromPopup.show();\n\t}\n\n\tgetFeatureUnavailableHandler(callbackSuccess, callbackFailure, extraData, data) {\n\t\tif (extraData) {\n\t\t\tObject.assign(data, extraData);\n\t\t}\n\t\tif (BX.Sender.B24License)\n\t\t{\n\t\t\tBX.Sender.B24License.showPopup('Ad');\n\t\t}\n\t\tcallbackFailure(data);\n\t}\n\n\tneedAcceptAgreementHandler(callbackSuccess, callbackFailure, extraData, data) {\n\t\tif (extraData) {\n\t\t\tObject.assign(data, extraData);\n\t\t}\n\t\tRuntime.loadExtension('sender_agreement').then(() => {\n\t\t\tEventEmitter.subscribe('BX.Sender.Agreement:onAccept', () => {\n\t\t\t\tcallbackSuccess();\n\t\t\t});\n\t\t\tBX.Sender.Agreement.isAccepted = false;\n\t\t\tBX.Sender.Agreement.showPopup();\n\t\t});\n\t}\n}"],"names":["ErrorHandler","errorCode","data","callbackSuccess","callbackFailure","handlers","getHandlers","hasOwnProperty","Type","isFunction","apply","extraData","getWrongEmailFromHandler","bind","getFeatureUnavailableHandler","needAcceptAgreementHandler","Object","assign","oncloseCalbackActive","wrongEmailFromPopup","BX","PopupWindowManager","create","id","autoHide","lightShadow","closeByEsc","overlay","backgroundColor","opacity","events","onPopupClose","setContent","Tag","render","Loc","getMessage","setButtons","UI","Button","text","color","Color","SUCCESS","onclick","location","href","editUrl","close","LINK","show","Sender","B24License","showPopup","Runtime","loadExtension","then","EventEmitter","subscribe","Agreement","isAccepted"],"mappings":"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"}