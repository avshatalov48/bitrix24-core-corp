this.BX=this.BX||{};(function(e,t){"use strict";var i={value:"data-value",name:"data-name",disabled:"data-disabled",class:"class",type:"type"};var s=function(){function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};babelHelpers.classCallCheck(this,e);this._node=t instanceof HTMLElement?t:document.createElement(t);this._config={i18n:s};this._setAttributes(i);if(i.textContent){this._setTextContent(i.textContent)}return this}babelHelpers.createClass(e,[{key:"get",value:function e(){return this._node}},{key:"append",value:function e(t){this._node.appendChild(t);return this}},{key:"addClass",value:function e(t){this._node.classList.add(t);return this}},{key:"removeClass",value:function e(t){this._node.classList.remove(t);return this}},{key:"toggleClass",value:function e(t){this._node.classList.toggle(t);return this}},{key:"addEventListener",value:function e(t,i){this._node.addEventListener(t,i);return this}},{key:"removeEventListener",value:function e(t,i){this._node.removeEventListener(t,i);return this}},{key:"setText",value:function e(t){this._setTextContent(t);return this}},{key:"getHeight",value:function e(){return window.getComputedStyle(this._node).height}},{key:"getWidth",value:function e(){return window.getComputedStyle(this._node).width}},{key:"setTop",value:function e(t){this._node.style.top="".concat(t,"px");return this}},{key:"focus",value:function e(){this._node.focus();return this}},{key:"_setTextContent",value:function e(t){this._node.textContent=t}},{key:"_setAttributes",value:function e(t){for(var s in t){if(i[s]&&t[s]){this._setAttribute(i[s],t[s])}}}},{key:"_setAttribute",value:function e(t,i){this._node.setAttribute(t,i)}},{key:"_getAttribute",value:function e(t){this._node.getAttribute(t)}}]);return e}();var a={select:"main-ui-control",dropdownShown:"autocomplete-select--opened",multiselect:"main-ui-multi-select",label:"main-ui-square-container",placeholder:"autocomplete-placeholder",dropdown:"popup-select-content",option:"main-ui-select-inner-item",remove:"main-ui-item-icon main-ui-square-delete",optionDisabled:"autocomplete-option--disabled",autocompleteInput:"main-ui-control main-ui-control-string",selectedLabel:"main-ui-square",selectedOption:"autocomplete-option--selected",placeholderHidden:"autocomplete-placeholder--hidden",optionHidden:"autocomplete-option--hidden"};var l=function(){function e(t,i){babelHelpers.classCallCheck(this,e);this._config=babelHelpers.objectSpread({},i,{classNames:babelHelpers.objectSpread({},a,i.classNames),disabledOptions:[]});this._state={opened:false};this._icons=[];this._holderElement=t;this._boundHandleClick=this._handleClick.bind(this);this._boundUnselectOption=this._unselectOption.bind(this);this._boundSortOptions=this._sortOptions.bind(this);this._body=new s(document.body);this._create(t);if(!this._config.value){return}this._setValue()}babelHelpers.createClass(e,[{key:"setOptions",value:function e(t){this._config.options=t;this._options=this._generateOptions()}},{key:"value",value:function e(){return this._config.value}},{key:"removeAutocompleteNode",value:function e(){BX.remove(this._autocomplete.get());this._options.map(function(e){BX.remove(e.get())})}},{key:"reset",value:function e(){this._config.value=this._config.multiple?[]:null;this._setValue()}},{key:"_create",value:function e(i){var a=typeof i==="string"?document.querySelector(i):i;this._parent=new s(a);var l=a.querySelectorAll("div[data-name=".concat(a.dataset.name,"]"))[0];var r=l.cloneNode(true);a.removeChild(l);this._select=new s(r);this._label=new s("span",{class:this._config.classNames.label});this._optionsWrapper=new s("div",{class:this._config.classNames.dropdown});if(this._config.multiple){this._select.addClass(this._config.classNames.multiselect)}this._options=this._generateOptions();this._select.addEventListener("click",this._boundHandleClick);this._select.append(this._label.get());var n=this._parent.get().parentNode.querySelectorAll("div.main-ui-control-value-delete");if(n.length>0){BX.bind(n[0],"click",this.reset.bind(this));this._select.append(n[0])}this._parent.append(this._select.get());this._placeholder=new s("div",{class:this._config.classNames.placeholder,textContent:this._config.placeholder});this._select.append(this._placeholder.get());this._popup=new t.Popup({id:"autocomplete"+Math.random(),bindElement:i,zIndex:3e3,width:515,maxHeight:300});this._popup.setContent(this._optionsWrapper.get())}},{key:"_generateOptions",value:function e(){var t=this;if(this._config.autocomplete&&!this._autocomplete){this._autocomplete=new s("input",{class:this._config.classNames.autocompleteInput,name:"autocomplete-".concat(this._parent.get().dataset.name),type:"text"});this._autocomplete.addEventListener("input",this._boundSortOptions);this._optionsWrapper.append(this._autocomplete.get())}return this._config.options.map(function(e){var i=document.querySelectorAll("div.".concat(t._config.classNames.option,'[data-value="').concat(e.id,'"]'));if(i.length>0){return new s(i[0])}var a=new s("div",{class:"".concat(t._config.classNames.option).concat(e.disabled?" "+t._config.classNames.optionDisabled:""),value:e.id,textContent:e.name,disabled:e.disabled});if(e.disabled){t._config.disabledOptions.push(String(e.id))}t._optionsWrapper.append(a.get());return a})}},{key:"_handleClick",value:function e(t){t.stopPropagation();if(t.target.className===this._config.classNames.autocompleteInput){return}if(this._state.opened){var i=this._options.find(function(e){if(e){return e.get()===t.target}});if(i!==undefined){this._setValue(i.get().getAttribute("data-value"),true)}this._popup.close();this._select.removeClass(this._config.classNames.dropdownShown);this._body.removeEventListener("click",this._boundHandleClick);this._select.addEventListener("click",this._boundHandleClick);this._state.opened=false;return}if(t.target.className===this._config.icon){return}this._popup.show();this._select.addClass(this._config.classNames.dropdownShown);this._body.addEventListener("click",this._boundHandleClick);this._select.removeEventListener("click",this._boundHandleClick);this._state.opened=true;if(this._autocomplete){this._autocomplete.focus()}}},{key:"_prepareDataValue",value:function e(){var t=this;var i=[];this._config.options.forEach(function(e){t._config.value.forEach(function(t){if(e.id.toString()===t){i.push({NAME:e.name,VALUE:e.id.toString()})}})});this._parent.get().dataset.value=JSON.stringify(i);this._select.get().dataset.value=JSON.stringify(i);return i}},{key:"_setValue",value:function e(t,i,s){var a=this;if(this._config.disabledOptions.indexOf(t)>-1){return}if(t&&!s){this._config.value=this._config.multiple?[].concat(babelHelpers.toConsumableArray(this._config.value||[]),[t]):t}if(t&&s){this._config.value=t}this._options.forEach(function(e){e.removeClass(a._config.classNames.selectedOption)});this._placeholder.removeClass(this._config.classNames.placeholderHidden);if(this._config.multiple){var l=this._config.value.map(function(e){var t=a._config.options.find(function(t){if(t){return t.id.toString()===e}});if(!t){return false}var i=a._options.find(function(e){if(e){return e.get().getAttribute("data-value")===t.id.toString()}});i.addClass(a._config.classNames.selectedOption);return t});if(l.length){this._placeholder.addClass(this._config.classNames.placeholderHidden)}this._selectOptions(l,i);this._prepareDataValue();return}var r=this._config.value?this._config.options.find(function(e){if(e){e.id.toString()===a._config.value}}):this._config.options[0];var n=this._options.find(function(e){if(e){e.get().getAttribute("data-value")===r.id.toString()}});this._prepareDataValue();if(!this._config.value){this._label.setText("");return}n.addClass(this._config.classNames.selectedOption);this._placeholder.addClass(this._config.classNames.placeholderHidden);this._selectOption(r,i)}},{key:"_selectOption",value:function e(t,i){this._selectedOption=t;this._label.setText(t.name);if(this._config.onChange&&i){this._config.onChange(t.id,this._prepareDataValue())}}},{key:"_selectOptions",value:function e(t,i){var a=this;this._label.setText("");this._icons=t.map(function(e){if(e){var t=new s("span",{class:a._config.classNames.selectedLabel,textContent:e.name});var i=new s("span",{class:"".concat(a._config.classNames.remove),value:e.id});i.addEventListener("click",a._boundUnselectOption);t.append(i.get());a._label.append(t.get());return i.get()}});if(i){this._optionsWrapper.setTop(Number(this._select.getHeight().split("px")[0])+5)}if(this._config.onChange&&i){this._config.onChange(this._config.value,this._prepareDataValue())}}},{key:"_unselectOption",value:function e(t){var i=babelHelpers.toConsumableArray(this._config.value);var s=i.indexOf(t.target.getAttribute("data-value"));if(s!==-1){i.splice(s,1)}this._setValue(i,true,true)}},{key:"_sortOptions",value:function e(t){var i=this;this._options.forEach(function(e){if(!e.get().textContent.toLowerCase().startsWith(t.target.value.toLowerCase())){e.addClass(i._config.classNames.optionHidden);return}e.removeClass(i._config.classNames.optionHidden)})}}]);return e}();var r=new WeakMap;var n=new WeakMap;var o=new WeakMap;var d=new WeakMap;var c=new WeakMap;var u=new WeakMap;var h=new WeakMap;var p=new WeakMap;var v=new WeakMap;var b=new WeakMap;var _=new WeakMap;var f=new WeakMap;var g=new WeakMap;var m=new WeakMap;var P=new WeakMap;var H=new WeakMap;var F=new WeakMap;var y=new WeakMap;var N=new WeakMap;var k=new WeakMap;var G=new WeakMap;var w=new WeakMap;var S=new WeakMap;var C=new WeakMap;var E=new WeakMap;var I=new WeakMap;var T=new WeakMap;var O=new WeakMap;var B=new WeakMap;var A=new WeakMap;var W=new WeakMap;var L=new WeakMap;var M=function(){function e(){babelHelpers.classCallCheck(this,e);r.set(this,{writable:true,value:BX.Sender.Page});n.set(this,{writable:true,value:BX.Sender.Helper});o.set(this,{writable:true,value:void 0});d.set(this,{writable:true,value:void 0});c.set(this,{writable:true,value:void 0});u.set(this,{writable:true,value:void 0});h.set(this,{writable:true,value:void 0});p.set(this,{writable:true,value:void 0});v.set(this,{writable:true,value:void 0});b.set(this,{writable:true,value:void 0});_.set(this,{writable:true,value:void 0});f.set(this,{writable:true,value:void 0});g.set(this,{writable:true,value:void 0});m.set(this,{writable:true,value:void 0});P.set(this,{writable:true,value:void 0});H.set(this,{writable:true,value:void 0});F.set(this,{writable:true,value:void 0});y.set(this,{writable:true,value:void 0});N.set(this,{writable:true,value:void 0});k.set(this,{writable:true,value:void 0});G.set(this,{writable:true,value:void 0});w.set(this,{writable:true,value:void 0});S.set(this,{writable:true,value:void 0});C.set(this,{writable:true,value:null});E.set(this,{writable:true,value:void 0});I.set(this,{writable:true,value:void 0});T.set(this,{writable:true,value:void 0});O.set(this,{writable:true,value:void 0});B.set(this,{writable:true,value:void 0});A.set(this,{writable:true,value:void 0});W.set(this,{writable:true,value:"REGION_BY_IP"});L.set(this,{writable:true,value:"REGION_BY_PHONE"})}babelHelpers.createClass(e,[{key:"bindEvents",value:function e(){this._expireInNode.addEventListener("change",this.validateRequiredFields.bind(this));if(BX.Sender.Template&&BX.Sender.Template.Selector){var t=BX.Sender.Template.Selector;BX.addCustomEvent(t,t.events.templateSelect,this.onTemplateSelect.bind(this));BX.addCustomEvent(t,t.events.selectorClose,this.closeTemplateSelector.bind(this))}if(this._saveBtn){BX.bind(this._saveBtn,"click",this.applyChanges.bind(this))}if(babelHelpers.classPrivateFieldGet(this,E)){BX.bind(babelHelpers.classPrivateFieldGet(this,E),"click",this.showTemplateSelector.bind(this))}if(babelHelpers.classPrivateFieldGet(this,h)){top.BX.onCustomEvent(top,"sender-letter-edit-change",[this.letterTile]);babelHelpers.classPrivateFieldGet(this,r).slider.close();if(babelHelpers.classPrivateFieldGet(this,v)){BX.UI.Notification.Center.notify({content:babelHelpers.classPrivateFieldGet(this,b).outsideSaveSuccess,autoHideDelay:5e3})}}this.initWidget();var i=this.getFilter();i.getAddPresetButton().style.display="none";i.getPreset().getPresets().forEach(function(e){e.style.display="none"});BX.bind(i.getResetButton(),"click",this.reInitAddressWidget.bind(this));var s=document.querySelector(".main-ui-delete");BX.bind(s,"click",this.reInitAddressWidget.bind(this))}},{key:"initialize",value:function e(t){babelHelpers.classPrivateFieldSet(this,o,BX(t.containerId));babelHelpers.classPrivateFieldSet(this,N,[]);babelHelpers.classPrivateFieldGet(this,N)[babelHelpers.classPrivateFieldGet(this,W)]={region:[]};babelHelpers.classPrivateFieldGet(this,N)[babelHelpers.classPrivateFieldGet(this,L)]={region:[]};babelHelpers.classPrivateFieldSet(this,k,"toloka-filter-connector");babelHelpers.classPrivateFieldSet(this,y,document.getElementById("".concat(babelHelpers.classPrivateFieldGet(this,k),"_search_container")));babelHelpers.classPrivateFieldSet(this,G,this.getFilter());babelHelpers.classPrivateFieldSet(this,E,BX("SENDER_TOLOKA_BUTTON_CHANGE"));babelHelpers.classPrivateFieldGet(this,n).changeDisplay(babelHelpers.classPrivateFieldGet(this,E),false);babelHelpers.classPrivateFieldSet(this,d,t.actionUri);babelHelpers.classPrivateFieldSet(this,S,new BX.AjaxAction(babelHelpers.classPrivateFieldGet(this,d)));babelHelpers.classPrivateFieldSet(this,c,t.isFrame||false);babelHelpers.classPrivateFieldSet(this,u,t.prettyDateFormat);babelHelpers.classPrivateFieldSet(this,h,t.isSaved||false);babelHelpers.classPrivateFieldSet(this,p,t.isRegistered||false);babelHelpers.classPrivateFieldSet(this,v,t.isOutside||false);babelHelpers.classPrivateFieldSet(this,w,t.isAvailable||true);babelHelpers.classPrivateFieldSet(this,b,t.mess);babelHelpers.classPrivateFieldSet(this,_,t.letterTile||{});babelHelpers.classPrivateFieldSet(this,A,[]);babelHelpers.classPrivateFieldSet(this,C,this.objectKeysToLowerCase(JSON.parse(t.preset)));this.optionData=[];this.prepareNodes();this.buildDispatchNodes();this._filterNode=[];this._regionInput=[];this._autocomplete=[];this.bindEvents();babelHelpers.classPrivateFieldGet(this,n).titleEditor.init({dataNode:babelHelpers.classPrivateFieldGet(this,m),disabled:false,defaultTitle:this.getPatternTitle(babelHelpers.classPrivateFieldGet(this,b).name)});babelHelpers.classPrivateFieldGet(this,r).initButtons();if(this.isMSBrowser()){babelHelpers.classPrivateFieldGet(this,o).classList.add("bx-sender-letter-ms-ie")}if(!babelHelpers.classPrivateFieldGet(this,p)){babelHelpers.classPrivateFieldGet(this,P).style="";babelHelpers.classPrivateFieldGet(this,H).style="display:none;"}}},{key:"prepareNodes",value:function e(){babelHelpers.classPrivateFieldSet(this,f,babelHelpers.classPrivateFieldGet(this,n).getNode("template-selector",babelHelpers.classPrivateFieldGet(this,o)));babelHelpers.classPrivateFieldSet(this,g,babelHelpers.classPrivateFieldGet(this,n).getNode("editor",babelHelpers.classPrivateFieldGet(this,o)));babelHelpers.classPrivateFieldSet(this,m,babelHelpers.classPrivateFieldGet(this,n).getNode("title",babelHelpers.classPrivateFieldGet(this,o)));babelHelpers.classPrivateFieldSet(this,P,babelHelpers.classPrivateFieldGet(this,n).getNode("login",babelHelpers.classPrivateFieldGet(this,o)));babelHelpers.classPrivateFieldSet(this,H,babelHelpers.classPrivateFieldGet(this,n).getNode("sender-toloka-form",babelHelpers.classPrivateFieldGet(this,o)));babelHelpers.classPrivateFieldSet(this,F,babelHelpers.classPrivateFieldGet(this,n).getNode("toloka-oauth-code",babelHelpers.classPrivateFieldGet(this,o)));babelHelpers.classPrivateFieldSet(this,I,babelHelpers.classPrivateFieldGet(this,n).getNode("letter-buttons",babelHelpers.classPrivateFieldGet(this,o)));babelHelpers.classPrivateFieldSet(this,T,babelHelpers.classPrivateFieldGet(this,n).getNode("template-name",babelHelpers.classPrivateFieldGet(this,g)));babelHelpers.classPrivateFieldSet(this,O,babelHelpers.classPrivateFieldGet(this,n).getNode("template-type",babelHelpers.classPrivateFieldGet(this,g)));babelHelpers.classPrivateFieldSet(this,B,babelHelpers.classPrivateFieldGet(this,n).getNode("template-id",babelHelpers.classPrivateFieldGet(this,g)));this._projectNode=document.getElementById("CONFIGURATION_PROJECT_ID");this._poolNode=document.getElementById("CONFIGURATION_POOL_ID");this._taskSuiteNode=document.getElementById("CONFIGURATION_TASK_SUITE_ID");this._descriptionNode=document.getElementById("CONFIGURATION_DESCRIPTION");this._instructionNode=document.getElementById("CONFIGURATION_INSTRUCTION");this._tasksNode=document.getElementById("CONFIGURATION_TASKS");this._overlapNode=document.getElementById("CONFIGURATION_OVERLAP");this._adultContentNode=document.getElementById("CONFIGURATION_ADULT_CONTENT");this._priceNode=document.getElementById("CONFIGURATION_PRICE");this._expireInNode=document.getElementById("CONFIGURATION_EXPIRE_IN");this._saveBtn=document.getElementById("ui-button-panel-save");this._projectNode.parentNode.parentNode.style="display:none";this._poolNode.parentNode.parentNode.style="display:none";this._taskSuiteNode.parentNode.parentNode.style="display:none"}},{key:"reInitAddressWidget",value:function e(){if(this._filterNode[babelHelpers.classPrivateFieldGet(this,W)]&&this._autocomplete[babelHelpers.classPrivateFieldGet(this,W)]){this._autocomplete[babelHelpers.classPrivateFieldGet(this,W)].removeAutocompleteNode();this._autocomplete[babelHelpers.classPrivateFieldGet(this,W)]=null}if(this._filterNode[babelHelpers.classPrivateFieldGet(this,L)]&&this._autocomplete[babelHelpers.classPrivateFieldGet(this,L)]){this._autocomplete[babelHelpers.classPrivateFieldGet(this,L)].removeAutocompleteNode();this._autocomplete[babelHelpers.classPrivateFieldGet(this,L)]=null}this.initWidget()}},{key:"initWidget",value:function e(){if(babelHelpers.classPrivateFieldGet(this,y)){BX.bind(babelHelpers.classPrivateFieldGet(this,y),"click",this.initAddressWidget.bind(this,babelHelpers.classPrivateFieldGet(this,W)));BX.bind(babelHelpers.classPrivateFieldGet(this,y),"click",this.initAddressWidget.bind(this,babelHelpers.classPrivateFieldGet(this,L)));BX.bind(this.getFilter().getPopup().popupContainer,"click",this.initAddressWidget.bind(this,babelHelpers.classPrivateFieldGet(this,W)));BX.bind(this.getFilter().getPopup().popupContainer,"click",this.initAddressWidget.bind(this,babelHelpers.classPrivateFieldGet(this,L)))}}},{key:"initAddressWidget",value:function e(t,i){var s=this;if(i.target&&this.getFilter().getSearch().isSquareRemoveButton(i.target)){this.reInitAddressWidget()}this._filterNode[t]=document.querySelectorAll(".main-ui-filter-field-container-list > div[data-name=".concat(t,"]"))[0];if(!this._filterNode[t]){if(this._autocomplete[t]){this._autocomplete[t].removeAutocompleteNode();this._autocomplete[babelHelpers.classPrivateFieldGet(this,W)]=null}return}if(this._autocomplete[t]){return}var a=this;this.optionData[t]=this.optionData[t]||[];this._autocomplete[t]=new l(this._filterNode[t],{options:this.optionData[t],multiple:true,autocomplete:true,onChange:function e(i,l){babelHelpers.classPrivateFieldGet(a,N)[t]=i;babelHelpers.classPrivateFieldGet(s,G).getFieldByName(t).ITEMS=l;babelHelpers.classPrivateFieldGet(s,G).getFieldByName(t).VALUE=l}});this._regionInput[t]=document.querySelectorAll("input[data-name=autocomplete-".concat(t,"]"))[0];BX.bind(this._regionInput[t],"keyup",this.getLocationList.bind(this,t))}},{key:"register",value:function e(){var t=this;babelHelpers.classPrivateFieldGet(this,S).request({action:"registerOAuth",onsuccess:function e(i){babelHelpers.classPrivateFieldGet(t,P).style="display:none;";babelHelpers.classPrivateFieldGet(t,H).style=""},data:{access_code:babelHelpers.classPrivateFieldGet(this,F).value}})}},{key:"isMSBrowser",value:function e(){return window.navigator.userAgent.match(/(Trident\/|MSIE|Edge\/)/)!==null}},{key:"getPatternTitle",value:function e(t){return babelHelpers.classPrivateFieldGet(this,n).replace(babelHelpers.classPrivateFieldGet(this,b).patternTitle,{name:t,date:BX.date.format(babelHelpers.classPrivateFieldGet(this,u))})}},{key:"onTemplateSelect",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,T)){babelHelpers.classPrivateFieldGet(this,T).textContent=t.name}if(babelHelpers.classPrivateFieldGet(this,O)){babelHelpers.classPrivateFieldGet(this,O).value=t.type}if(babelHelpers.classPrivateFieldGet(this,B)){babelHelpers.classPrivateFieldGet(this,B).value=t.code}babelHelpers.classPrivateFieldSet(this,C,t.messageFields);this.buildDispatchNodes();babelHelpers.classPrivateFieldGet(this,m).value=this.getPatternTitle(t.name);BX.fireEvent(babelHelpers.classPrivateFieldGet(this,m),"change");this.closeTemplateSelector();window.scrollTo(0,0)}},{key:"buildDispatchNodes",value:function e(){var t=this;babelHelpers.classPrivateFieldGet(this,n).getNodes("dispatch",babelHelpers.classPrivateFieldGet(this,o)).forEach(function(e){var i=e.getAttribute("data-code");for(var s in babelHelpers.classPrivateFieldGet(t,C)){if(!babelHelpers.classPrivateFieldGet(t,C).hasOwnProperty(s)){continue}var a=babelHelpers.classPrivateFieldGet(t,C)[s];if(a.code===i&&e.innerHTML.length===0){e.innerHTML=a.value}babelHelpers.classPrivateFieldGet(t,A)[a.code]=a.value}})}},{key:"closeTemplateSelector",value:function e(){this.changeDisplayingTemplateSelector(false)}},{key:"showTemplateSelector",value:function e(){this.changeDisplayingTemplateSelector(true)}},{key:"changeDisplayingTemplateSelector",value:function e(t){var i="bx-sender-letter-show";var s="bx-sender-letter-hide";babelHelpers.classPrivateFieldGet(this,n).changeClass(babelHelpers.classPrivateFieldGet(this,f),i,t);babelHelpers.classPrivateFieldGet(this,n).changeClass(babelHelpers.classPrivateFieldGet(this,f),s,!t);babelHelpers.classPrivateFieldGet(this,n).changeClass(babelHelpers.classPrivateFieldGet(this,g),i,!t);babelHelpers.classPrivateFieldGet(this,n).changeClass(babelHelpers.classPrivateFieldGet(this,g),s,t);babelHelpers.classPrivateFieldGet(this,n).changeDisplay(babelHelpers.classPrivateFieldGet(this,E),!t);babelHelpers.classPrivateFieldGet(this,n).changeDisplay(babelHelpers.classPrivateFieldGet(this,I),!t);t?babelHelpers.classPrivateFieldGet(this,n).titleEditor.disable():babelHelpers.classPrivateFieldGet(this,n).titleEditor.enable()}},{key:"objectKeysToLowerCase",value:function e(t){var i=this;if(t===null){return t}return Object.keys(t).reduce(function(e,s){var a=t[s];e[s.toLowerCase()]=babelHelpers.typeof(a)==="object"?i.objectKeysToLowerCase(a):a;return e},{})}},{key:"getLocationList",value:function e(t){var i=this;if(this._regionInput[t].value.length<3){return}this.usedWords=this.usedWords||[];var s=this._regionInput[t].value;if(this.usedWords.includes(s)){return}this.usedWords.push(s);var a=this;babelHelpers.classPrivateFieldGet(this,S).request({action:"getGeoList",data:{name:s},onsuccess:function e(s){if(!i.optionData[t]){i.optionData[t]=[]}for(var l in s){var r=s[l];if(babelHelpers.typeof(r)==="object"&&"id"in r){i.optionData[t].push(r)}}if(a._autocomplete[t]){i.optionData[t]=i.optionData[t].reduce(function(e,t){var i=e.find(function(e){return e.id===t.id});if(!i){return e.concat([t])}else{return e}},[]);a._autocomplete[t].setOptions(i.optionData[t])}}})}},{key:"validateRequiredFields",value:function e(){var t=this;var i=true;[this._expireInNode,this._priceNode,this._tasksNode].every(function(e){if(!t.validateField(e)){i=false;return false}});if(!i){this.removeLoader()}return i}},{key:"removeLoader",value:function e(){this._saveBtn.classList.remove("ui-btn-wait")}},{key:"validateField",value:function e(i){if(!this._validatorPopup){this._validatorPopup=new t.Popup({id:"sender-toloka-validator",content:"".concat(babelHelpers.classPrivateFieldGet(this,b).required)})}if(!i.value){this._validatorPopup.setBindElement(i);this._validatorPopup.show();i.classList.add("bx-sender-form-control-danger");i.scrollIntoView();return false}this._validatorPopup.close();i.classList.remove("bx-sender-form-control-danger");return true}},{key:"createProject",value:function e(){var t=this;if(!this.validateRequiredFields()){return}var i=Object.keys(babelHelpers.classPrivateFieldGet(this,A)["INPUT_VALUE"])[0];var s=Object.keys(babelHelpers.classPrivateFieldGet(this,A)["OUTPUT_VALUE"])[0];babelHelpers.classPrivateFieldGet(this,S).request({action:"createProject",data:{id:this._projectNode.value,name:babelHelpers.classPrivateFieldGet(this,m).value,description:this._descriptionNode.value,instruction:this._instructionNode.value,input_type:babelHelpers.classPrivateFieldGet(this,A)["INPUT_VALUE"][i],input_identificator:i,output_type:babelHelpers.classPrivateFieldGet(this,A)["OUTPUT_VALUE"][s],output_identificator:s,markup:babelHelpers.classPrivateFieldGet(this,A)["PRESET"].template,script:babelHelpers.classPrivateFieldGet(this,A)["PRESET"].js,styles:babelHelpers.classPrivateFieldGet(this,A)["PRESET"].css},onsuccess:function e(i){t._projectNode.value=i.id;t.createPool(i.id)},onfailure:function e(i){t.removeLoader()}})}},{key:"createPool",value:function e(t){var i=this;var s=Object.keys(babelHelpers.classPrivateFieldGet(this,A)["INPUT_VALUE"])[0];babelHelpers.classPrivateFieldGet(this,S).request({action:"createPool",data:{id:this._poolNode.value,task_suite_id:this._taskSuiteNode.value,project_id:t,private_name:babelHelpers.classPrivateFieldGet(this,m).value,public_description:this._descriptionNode.value,may_contain_adult_content:this._adultContentNode.checked,reward_per_assignment:this._priceNode.value,will_expire:this._expireInNode.value,overlap:this._overlapNode.value,tasks:this._tasksNode.value,identificator:s,filter:babelHelpers.classPrivateFieldGet(this,N)},onsuccess:function e(t){i._poolNode.value=t.pool_id;i._taskSuiteNode.value=t.id;var s=babelHelpers.classPrivateFieldGet(i,o).getElementsByTagName("form");if(s&&s[0]){s[0].appendChild(BX.create("input",{attrs:{type:"hidden",name:"apply",value:"Y"}}));s[0].submit()}},onfailure:function e(t){i.removeLoader()}})}},{key:"applyChanges",value:function e(t){if(!babelHelpers.classPrivateFieldGet(this,w)){BX.UI.InfoHelper.show("limit_crm_marketing_toloka");return}this.createProject()}},{key:"getFilter",value:function e(){var t=BX.Main.filterManager.getById(babelHelpers.classPrivateFieldGet(this,k));if(!t||!(t instanceof BX.Main.Filter)){return null}return t}}],[{key:"create",value:function t(i){var s=new e;s.initialize(i);return s}}]);return e}();e.Toloka=M})(this.BX.Sender=this.BX.Sender||{},BX.Main);
//# sourceMappingURL=toloka.bundle.map.js