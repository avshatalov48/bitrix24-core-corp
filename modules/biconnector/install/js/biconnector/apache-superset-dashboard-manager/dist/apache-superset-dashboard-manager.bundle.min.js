this.BX=this.BX||{},function(e,t,n,a,o,r,i){"use strict";var d;function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,d=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){d=!0,r=e},f:function(){try{i||null==n.return||n.return()}finally{if(d)throw r}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var u=function(){function e(){babelHelpers.classCallCheck(this,e),this.subscribeOnEvents()}return babelHelpers.createClass(e,[{key:"subscribeOnEvents",value:function(){BX.PULL&&BX.PULL.extendWatch("superset_dashboard",!0),o.EventEmitter.subscribe("onPullEvent-biconnector",(function(e){var t=babelHelpers.slicedToArray(e.data,2),n=t[0],a=t[1];if("onDashboardStatusUpdated"===n&&a){var r=null==a?void 0:a.dashboardList;r&&o.EventEmitter.emit("BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate",{dashboardList:r})}}))}},{key:"processEditDashboard",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};"CUSTOM"===e.type?this.processLoginDashboard(e,t,n,a):this.processCopyDashboard(e,t,n,a)}},{key:"processCopyDashboard",value:function(e){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},u="SYSTEM"===e.type?t.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_COPY_SYSTEM_DASHBOARD_ATTENTION"):t.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_COPY_MARKET_DASHBOARD_ATTENTION"),l=t.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="dashboard-login-popup-copy-attention">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),u),b="popup_copy",h=new a.Button({text:t.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_CONTINUE_BTN"),color:a.Button.Color.PRIMARY,onclick:function(){h.setWaiting(!0),r.duplicateDashboard(e.id).then((function(e){s(b);var n=e.data.dashboard;return n?r.getDashboardEmbeddedData(n.id):(BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(t.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_COPY_ERROR"))}),null)})).then((function(e){o.EventEmitter.emit("BIConnector.DashboardManager:onCopyDashboard",{dashboard:e.data.dashboard});var t={id:e.data.dashboard.id,editLink:e.data.dashboard.editUrl,type:e.data.dashboard.type};r.processLoginDashboard(t,(function(){i(),p.close(),o.EventEmitter.emit("BIConnector.DashboardManager:onEmbeddedDataLoaded")}),s,c)})).catch((function(e){var n;c(b),e.errors&&t.Type.isStringFilled(null===(n=e.errors[0])||void 0===n?void 0:n.message)&&BX.UI.Notification.Center.notify({content:t.Text.encode(e.errors[0].message)})}))}}),p=new n.Popup({content:l,overlay:!0,width:620,className:"dashboard-login-popup",closeIcon:!0,closeByEsc:!0,disableScroll:!0,titleBar:t.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_TITLE"),buttons:[h,new a.Button({text:t.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_CANCEL_BTN"),color:a.Button.Color.LIGHT,onclick:function(){p.close()}})],events:{onClose:function(){i("popup_copy")}}});p.show()}},{key:"processLoginDashboard",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},o="popup_login";this.getEditUrl(e).then((function(e){n(o),e&&window.open(e,"_blank").focus()})).catch((function(){a(o),window.open(e.editLink,"_blank").focus()})).finally((function(){t()}))}},{key:"duplicateDashboard",value:function(e){return t.ajax.runAction("biconnector.dashboard.copy",{data:{id:e}})}},{key:"getDashboardUrlParameters",value:function(e){return t.ajax.runAction("biconnector.dashboard.getDashboardUrlParameters",{data:{id:e}})}},{key:"exportDashboard",value:function(e,t){return new i.DashboardExportMaster({dashboardId:e,openedFrom:t}).showPopup()}},{key:"deleteDashboard",value:function(e){return t.ajax.runAction("biconnector.dashboard.delete",{data:{id:e}})}},{key:"renameDashboard",value:function(e,n){return t.ajax.runAction("biconnector.dashboard.rename",{data:{id:e,title:n}})}},{key:"restartDashboardImport",value:function(e){return t.ajax.runAction("biconnector.dashboard.restartImport",{data:{id:e}}).then((function(e){var t,n=null==e||null===(t=e.data)||void 0===t?void 0:t.restartedDashboardIds;if(n){var a,r=[],i=s(n);try{for(i.s();!(a=i.n()).done;){var d=a.value;r.push({id:Number(d),status:"L"})}}catch(e){i.e(e)}finally{i.f()}o.EventEmitter.emit(window,"BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate",{dashboardList:r})}}))}},{key:"setDashboardTags",value:function(e,n){return t.ajax.runAction("biconnector.dashboard.setDashboardTags",{data:{id:e,tags:n}})}},{key:"addTag",value:function(e){return t.ajax.runAction("biconnector.dashboardTag.add",{data:{title:e}})}},{key:"openCreationSlider",value:function(){var e=new t.Uri("/bitrix/components/bitrix/biconnector.apachesuperset.dashboard.create/slider.php");BX.SidePanel.Instance.open(e.toString(),{width:790,allowChangeHistory:!1,cacheable:!1})}},{key:"getEditUrl",value:function(e){return new Promise((function(n,a){t.ajax.runAction("biconnector.dashboard.getEditUrl",{data:{id:e.id,editUrl:e.editLink}}).then((function(e){var t=e.data;t&&n(t)})).catch((function(e){a(e)}))}))}},{key:"addToTopMenu",value:function(e){return t.ajax.runAction("biconnector.dashboard.addToTopMenu",{data:{dashboardId:e}})}},{key:"deleteFromTopMenu",value:function(e){return t.ajax.runAction("biconnector.dashboard.deleteFromTopMenu",{data:{dashboardId:e}})}},{key:"pin",value:function(e){return t.ajax.runAction("biconnector.dashboard.pin",{data:{dashboardId:e}})}},{key:"unpin",value:function(e){return t.ajax.runAction("biconnector.dashboard.unpin",{data:{dashboardId:e}})}},{key:"getDashboardEmbeddedData",value:function(e){return BX.ajax.runAction("biconnector.dashboard.getDashboardEmbeddedData",{data:{id:e}})}},{key:"toggleDraft",value:function(e,t){return BX.ajax.runAction("biconnector.dashboard.toggleDraft",{data:{id:e,publish:t?1:0}})}}],[{key:"openSettingsSlider",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=null===e?"/bitrix/components/bitrix/biconnector.apachesuperset.setting/slider.php":"/bitrix/components/bitrix/biconnector.apachesuperset.dashboard.setting/slider.php",a=new t.Uri(n);null!==e&&a.setQueryParam("DASHBOARD_ID",t.Text.toNumber(e)),BX.SidePanel.Instance.open(a.toString(),{width:790,allowChangeHistory:!1,cacheable:!1})}},{key:"openDatasetListSlider",value:function(){BX.SidePanel.Instance.open("/bi/dataset",{cacheable:!1,allowChangeHistory:!0,allowChangeTitle:!0})}}]),e}();babelHelpers.defineProperty(u,"DASHBOARD_STATUS_LOAD","L"),babelHelpers.defineProperty(u,"DASHBOARD_STATUS_READY","R"),babelHelpers.defineProperty(u,"DASHBOARD_STATUS_FAILED","F"),babelHelpers.defineProperty(u,"DASHBOARD_STATUS_DRAFT","D"),babelHelpers.defineProperty(u,"DASHBOARD_STATUS_COMPUTED_NOT_LOAD","NL"),e.DashboardManager=u}(this.BX.BIConnector=this.BX.BIConnector||{},BX,BX.Main,BX.UI,BX.Event,BX,BX.BIConnector);
//# sourceMappingURL=apache-superset-dashboard-manager.bundle.map.js