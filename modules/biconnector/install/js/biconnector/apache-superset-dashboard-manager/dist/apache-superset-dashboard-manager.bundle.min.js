this.BX=this.BX||{},function(t,e,n,o,a){"use strict";var r,i,s;function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d,u=function(t){function e(t){var o;babelHelpers.classCallCheck(this,e);var r={content:e.getPopupContent(t.login,t.password,t.sourceDashboard),overlay:!0,width:620,className:"dashboard-login-popup",closeIcon:!0,closeByEsc:!0,contentBackground:"transparent",titleBar:n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_TITLE"),events:{onClose:function(){t.onClose&&t.onClose()}},disableScroll:!0,buttons:[new a.Button({text:n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_AUTH_BTN"),color:a.Button.Color.PRIMARY,onclick:function(){t.onOpen&&t.onOpen(),window.open(t.link,"_blank")}}),new a.Button({text:n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_CANCEL_BTN"),color:a.Button.Color.LIGHT,onclick:function(){o.close()}})]};return o=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,c(c({},r),t.additionalParams)))}return babelHelpers.inherits(e,t),babelHelpers.createClass(e,null,[{key:"getPopupContent",value:function(t,e){var o=n.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['<span \n\t\t\tclass="ui-icon-set --paste" \n\t\t\tid="dashboard-copy-login-btn"\n\t\t\tstyle="--ui-icon-set__icon-size: 21px; --ui-icon-set__icon-color: var(--ui-color-palette-gray-60)"\n\t\t\t></span>']))),a=n.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['<span \n\t\t\tclass="ui-icon-set --paste" \n\t\t\tid="dashboard-copy-passwd-btn"\n\t\t\tstyle="--ui-icon-set__icon-size: 21px; --ui-icon-set__icon-color: var(--ui-color-palette-gray-60)"\n\t\t\t></span>'])));return BX.clipboard.bindCopyClick(o,{text:t}),BX.clipboard.bindCopyClick(a,{text:e}),n.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div>\n\t\t\t\t<div class="dashboard-login-popup-info">\n\t\t\t\t\t<div class="dashboard-login-popup-info-desc">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="dashboard-login-popup-info-title">\n\t\t\t\t\t\t<svg class="dashboard-login-popup-info-icon" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M8.9849 0.00012207C13.9469 0.00012207 17.9695 4.02242 17.9695 8.98498C17.9695 13.9468 13.9469 17.9694 8.9849 17.9694C4.02266 17.9694 0 13.9468 0 8.98498C0 4.02242 4.02266 0.00012207 8.9849 0.00012207ZM10.2118 4.08379C10.2118 4.8272 9.60328 5.42985 8.85267 5.42985C8.10205 5.42985 7.49356 4.8272 7.49356 4.08379C7.49356 3.34039 8.10205 2.73774 8.85267 2.73774C9.60328 2.73774 10.2118 3.34039 10.2118 4.08379ZM6.15315 6.68282H9.32948V6.68509H10.2063V12.6612H11.5615V13.853L10.2063 13.853H7.74132L6.15315 13.853V12.6612H7.74132V7.89359H6.15315V6.68282Z" fill="#559BE6"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="dashboard-login-popup-info-data">\n\t\t\t\t\t\t<div class="dashboard-login-popup-info-data-row">\n\t\t\t\t\t\t\t<span class="dashboard-login-popup-info-data-row-title">',':</span> \n\t\t\t\t\t\t\t<span class="dashboard-login-popup-info-data-row-val">',"</span>\n\t\t\t\t\t\t\t",'\n\t\t\t\t\t\t </div>\n\t\t\t\t\t\t<div class="dashboard-login-popup-info-data-row">\n\t\t\t\t\t\t\t<span class="dashboard-login-popup-info-data-row-title">',':</span> \n\t\t\t\t\t\t\t<span class="dashboard-login-popup-info-data-row-val">',"</span>\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_DESCRIPTION"),n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_DATA_TITLE"),n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_DATA_LOGIN"),t,BX.util.htmlspecialchars(o),n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_DATA_PASSWORD"),e,BX.util.htmlspecialchars(a))}}]),e}(o.Popup);function p(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,r=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw r}}}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var h=function(){function t(){babelHelpers.classCallCheck(this,t),babelHelpers.defineProperty(this,"userCredentials",null),this.subscribeOnEvents()}return babelHelpers.createClass(t,[{key:"subscribeOnEvents",value:function(){BX.PULL&&BX.PULL.extendWatch("superset_dashboard",!0),e.EventEmitter.subscribe("onPullEvent-biconnector",(function(t){var n=babelHelpers.slicedToArray(t.data,2),o=n[0],a=n[1];if("onDashboardStatusUpdated"===o&&a){var r=null==a?void 0:a.dashboardList;r&&e.EventEmitter.emit("BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate",{dashboardList:r})}}))}},{key:"processEditDashboard",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};"CUSTOM"===t.type?this.processLoginDashboard(t,e,n,o):this.processCopyDashboard(t,e,n,o)}},{key:"processCopyDashboard",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},l="SYSTEM"===t.type?n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_COPY_SYSTEM_DASHBOARD_ATTENTION"):n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_COPY_MARKET_DASHBOARD_ATTENTION"),c=n.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="dashboard-login-popup-copy-attention">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),l),u="popup_copy",p=new a.Button({text:n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_CONTINUE_BTN"),color:a.Button.Color.PRIMARY,onclick:function(){p.setWaiting(!0),e.duplicateDashboard(t.id).then((function(t){i(u);var e=t.data.dashboard;e?window.open(e.detail_url,"_top"):BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_COPY_ERROR"))})})).catch((function(t){var e;s(u),t.errors&&n.Type.isStringFilled(null===(e=t.errors[0])||void 0===e?void 0:e.message)&&BX.UI.Notification.Center.notify({content:n.Text.encode(t.errors[0].message)})}))}}),b=new o.Popup({content:c,overlay:!0,width:620,className:"dashboard-login-popup",closeIcon:!0,closeByEsc:!0,disableScroll:!0,titleBar:n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_TITLE"),buttons:[p,new a.Button({text:n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_CANCEL_BTN"),color:a.Button.Color.LIGHT,onclick:function(){b.close()}})],events:{onClose:function(){r("popup_copy")}}});b.show()}},{key:"processLoginDashboard",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i="popup_login";this.getUserCredentials().then((function(n){e.EventEmitter.emit("BiConnector:DashboardManager.onUserCredentialsLoaded");var r={login:n.login,password:n.password,link:t.editLink,onOpen:function(){a(i)},onClose:function(){o(i)}};t.sourceDashboardInfo&&(r.sourceDashboard=t.sourceDashboardInfo),new u(r).show()})).catch((function(){r(i),BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_GET_CREDENTIALS_ERROR"))})}))}},{key:"duplicateDashboard",value:function(t){return n.ajax.runAction("biconnector.dashboard.copy",{data:{id:t}})}},{key:"exportDashboard",value:function(t,e,o){return n.ajax.runAction("biconnector.dashboard.export",{data:{id:t}}).then((function(t){var o=t.data.filePath;o&&window.open(o,"_self"),n.Type.isFunction(e)&&e()})).catch((function(t){BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(t.errors[0].message)}),n.Type.isFunction(o)&&o()}))}},{key:"getUserCredentials",value:function(){var t=this;return null!==this.userCredentials?new Promise((function(e){e(t.userCredentials)})):new Promise((function(e,o){n.ajax.runAction("biconnector.supersetUser.get").then((function(n){var a=n.data;a.user?(t.userCredentials=a.user,e(a.user)):o(new Error("Request login data sends invalid response format"))})).catch((function(t){o(t)}))}))}},{key:"deleteDashboard",value:function(t){return n.ajax.runAction("biconnector.dashboard.delete",{data:{id:t}})}},{key:"restartDashboardImport",value:function(t){return n.ajax.runAction("biconnector.dashboard.restartImport",{data:{id:t}}).then((function(t){var n,o=null==t||null===(n=t.data)||void 0===n?void 0:n.restartedDashboardIds;if(o){var a,r=[],i=p(o);try{for(i.s();!(a=i.n()).done;){var s=a.value;r.push({id:Number(s),status:"L"})}}catch(t){i.e(t)}finally{i.f()}e.EventEmitter.emit(window,"BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate",{dashboardList:r})}}))}},{key:"createEmptyDashboard",value:function(){return n.ajax.runAction("biconnector.dashboard.createEmptyDashboard",{data:{}})}}],[{key:"openSettingPeriodSlider",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=null===t?"/bitrix/components/bitrix/biconnector.apachesuperset.setting/slider.php":"/bitrix/components/bitrix/biconnector.apachesuperset.dashboard.setting/slider.php",o=new n.Uri(e);null!==t&&o.setQueryParam("DASHBOARD_ID",n.Text.toNumber(t)),BX.SidePanel.Instance.open(o.toString(),{width:790,allowChangeHistory:!1,cacheable:!1})}}]),t}();babelHelpers.defineProperty(h,"DASHBOARD_STATUS_LOAD","L"),babelHelpers.defineProperty(h,"DASHBOARD_STATUS_READY","R"),babelHelpers.defineProperty(h,"DASHBOARD_STATUS_FAILED","F"),t.DashboardManager=h}(this.BX.BIConnector=this.BX.BIConnector||{},BX.Event,BX,BX.Main,BX.UI);
//# sourceMappingURL=apache-superset-dashboard-manager.bundle.map.js