this.BX=this.BX||{},function(t,e,n,o,r){"use strict";var a;function i(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var s=function(){function t(){babelHelpers.classCallCheck(this,t),this.subscribeOnEvents()}return babelHelpers.createClass(t,[{key:"subscribeOnEvents",value:function(){BX.PULL&&BX.PULL.extendWatch("superset_dashboard",!0),r.EventEmitter.subscribe("onPullEvent-biconnector",(function(t){var e=babelHelpers.slicedToArray(t.data,2),n=e[0],o=e[1];if("onDashboardStatusUpdated"===n&&o){var a=null==o?void 0:o.dashboardList;a&&r.EventEmitter.emit("BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate",{dashboardList:a})}}))}},{key:"processEditDashboard",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};"CUSTOM"===t.type?this.processLoginDashboard(t,e,n,o):this.processCopyDashboard(t,e,n,o)}},{key:"processCopyDashboard",value:function(t){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},u="SYSTEM"===t.type?e.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_COPY_SYSTEM_DASHBOARD_ATTENTION"):e.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_COPY_MARKET_DASHBOARD_ATTENTION"),l=e.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="dashboard-login-popup-copy-attention">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),u),d="popup_copy",h=new o.Button({text:e.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_CONTINUE_BTN"),color:o.Button.Color.PRIMARY,onclick:function(){h.setWaiting(!0),r.duplicateDashboard(t.id).then((function(t){c(d);var n=t.data.dashboard;n?window.open(n.detail_url,"_top"):BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(e.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_COPY_ERROR"))})})).catch((function(t){var n;s(d),t.errors&&e.Type.isStringFilled(null===(n=t.errors[0])||void 0===n?void 0:n.message)&&BX.UI.Notification.Center.notify({content:e.Text.encode(t.errors[0].message)})}))}}),p=new n.Popup({content:l,overlay:!0,width:620,className:"dashboard-login-popup",closeIcon:!0,closeByEsc:!0,disableScroll:!0,titleBar:e.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_TITLE"),buttons:[h,new o.Button({text:e.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_CANCEL_BTN"),color:o.Button.Color.LIGHT,onclick:function(){p.close()}})],events:{onClose:function(){i("popup_copy")}}});p.show()}},{key:"processLoginDashboard",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},r="popup_login";this.getEditUrl(t).then((function(t){n(r),t&&window.open(t,"_blank").focus()})).catch((function(){o(r),window.open(t.editLink,"_blank").focus()})).finally((function(){e()}))}},{key:"duplicateDashboard",value:function(t){return e.ajax.runAction("biconnector.dashboard.copy",{data:{id:t}})}},{key:"exportDashboard",value:function(t,n,o){return e.ajax.runAction("biconnector.dashboard.export",{data:{id:t}}).then((function(t){var o=t.data.filePath;o&&window.open(o,"_self"),e.Type.isFunction(n)&&n()})).catch((function(t){BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(t.errors[0].message)}),e.Type.isFunction(o)&&o()}))}},{key:"deleteDashboard",value:function(t){return e.ajax.runAction("biconnector.dashboard.delete",{data:{id:t}})}},{key:"renameDashboard",value:function(t,n){return e.ajax.runAction("biconnector.dashboard.rename",{data:{id:t,title:n}})}},{key:"restartDashboardImport",value:function(t){return e.ajax.runAction("biconnector.dashboard.restartImport",{data:{id:t}}).then((function(t){var e,n=null==t||null===(e=t.data)||void 0===e?void 0:e.restartedDashboardIds;if(n){var o,a=[],c=i(n);try{for(c.s();!(o=c.n()).done;){var s=o.value;a.push({id:Number(s),status:"L"})}}catch(t){c.e(t)}finally{c.f()}r.EventEmitter.emit(window,"BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate",{dashboardList:a})}}))}},{key:"createEmptyDashboard",value:function(){return e.ajax.runAction("biconnector.dashboard.createEmptyDashboard",{data:{}})}},{key:"getEditUrl",value:function(t){return new Promise((function(n,o){e.ajax.runAction("biconnector.dashboard.getEditUrl",{data:{editUrl:t.editLink}}).then((function(t){var e=t.data;e&&n(e)})).catch((function(t){o(t)}))}))}}],[{key:"openSettingPeriodSlider",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=null===t?"/bitrix/components/bitrix/biconnector.apachesuperset.setting/slider.php":"/bitrix/components/bitrix/biconnector.apachesuperset.dashboard.setting/slider.php",o=new e.Uri(n);null!==t&&o.setQueryParam("DASHBOARD_ID",e.Text.toNumber(t)),BX.SidePanel.Instance.open(o.toString(),{width:790,allowChangeHistory:!1,cacheable:!1})}}]),t}();babelHelpers.defineProperty(s,"DASHBOARD_STATUS_LOAD","L"),babelHelpers.defineProperty(s,"DASHBOARD_STATUS_READY","R"),babelHelpers.defineProperty(s,"DASHBOARD_STATUS_FAILED","F"),t.DashboardManager=s}(this.BX.BIConnector=this.BX.BIConnector||{},BX,BX.Main,BX.UI,BX.Event);
//# sourceMappingURL=apache-superset-dashboard-manager.bundle.map.js