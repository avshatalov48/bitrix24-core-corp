{"version":3,"file":"settings-date-filter.bundle.js","sources":["../src/field.js","../src/field-factory.js"],"sourcesContent":["import { Text, Tag, Dom, Event, Type } from 'main.core';\n\nexport class SettingsDateFilterField extends BX.UI.EntityEditorList\n{\n\tstatic RANGE_VALUE = 'range';\n\n\tconstructor(id, settings)\n\t{\n\t\tsuper();\n\t\tthis.dateSelectorBlock = null;\n\t\tthis.toInput = null;\n\t\tthis.startInput = null;\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new this(id, settings);\n\t\tself.initialize(id, settings);\n\n\t\treturn self;\n\t}\n\n\tstatic layout(options = {})\n\t{\n\t\tsuper.layout();\n\t}\n\n\tcreateTitleNode(): HTMLElement\n\t{\n\t\treturn Tag.render`<span></span>`;\n\t}\n\n\tlayout(options: {})\n\t{\n\t\tsuper.layout(options);\n\n\t\tthis.layoutRangeField(this.getValue() === SettingsDateFilterField.RANGE_VALUE);\n\t}\n\n\tonItemSelect(e, item)\n\t{\n\t\tthis.layoutRangeField(item.value === SettingsDateFilterField.RANGE_VALUE);\n\n\t\tsuper.onItemSelect(e, item);\n\t}\n\n\tlayoutRangeField($isRangeSelected: boolean)\n\t{\n\t\tif ($isRangeSelected)\n\t\t{\n\t\t\tDom.removeClass(this._selectContainer, 'ui-ctl-w100');\n\t\t\tDom.addClass(this._innerWrapper, 'ui-entity-editor-content-block__range');\n\t\t\tDom.addClass(this._selectContainer, 'ui-ctl-date-range');\n\t\t\tthis.dateSelectorBlock = Tag.render`<div class=\"ui-ctl-dropdown-range-group\"></div>`;\n\t\t\tconst dateStartValue = Text.encode(this.getModel().getField(this.getDateStartFieldName()));\n\t\t\tthis.startInput = Tag.render`<input class=\"ui-ctl-element\" type=\"text\" value=\"${dateStartValue}\" name=\"${this.getDateStartFieldName()}\">`;\n\t\t\tEvent.bind(this.startInput, 'click', () => {\n\t\t\t\tSettingsDateFilterField.showCalendar(this.startInput);\n\t\t\t});\n\t\t\tEvent.bind(this.startInput, 'change', () => {\n\t\t\t\tthis.markAsChanged();\n\t\t\t});\n\t\t\tEvent.bind(this.startInput, 'input', () => {\n\t\t\t\tthis.markAsChanged();\n\t\t\t});\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-before-icon ui-ctl-datetime\">\n\t\t\t\t\t\t<div class=\"ui-ctl-before ui-ctl-icon-calendar\"></div>\n\t\t\t\t\t\t${this.startInput}\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\tthis.dateSelectorBlock,\n\t\t\t);\n\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"ui-ctl-dropdown-range-line\">\n\t\t\t\t\t\t<span class=\"ui-ctl-dropdown-range-line-item\"></span>\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\tthis.dateSelectorBlock,\n\t\t\t);\n\t\t\tconst dateEndValue = Text.encode(this.getModel().getField(this.getDateEndFieldName()));\n\t\t\tthis.endInput = Tag.render`<input class=\"ui-ctl-element\" type=\"text\" value=\"${dateEndValue}\" name=\"${this.getDateEndFieldName()}\">`;\n\t\t\tEvent.bind(this.endInput, 'click', () => {\n\t\t\t\tSettingsDateFilterField.showCalendar(this.endInput);\n\t\t\t});\n\t\t\tEvent.bind(this.endInput, 'change', () => {\n\t\t\t\tthis.markAsChanged();\n\t\t\t});\n\t\t\tEvent.bind(this.endInput, 'input', () => {\n\t\t\t\tthis.markAsChanged();\n\t\t\t});\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-before-icon ui-ctl-datetime\">\n\t\t\t\t\t\t<div class=\"ui-ctl-before ui-ctl-icon-calendar\"></div>\n\t\t\t\t\t\t${this.endInput}\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\tthis.dateSelectorBlock,\n\t\t\t);\n\n\t\t\tDom.append(this.dateSelectorBlock, this._innerWrapper);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.dateSelectorBlock !== null)\n\t\t\t{\n\t\t\t\tDom.remove(this.dateSelectorBlock);\n\t\t\t\tthis.dateSelectorBlock = null;\n\t\t\t\tthis.startInput = null;\n\t\t\t\tthis.endInput = null;\n\t\t\t}\n\t\t\tDom.addClass(this._selectContainer, 'ui-ctl-w100');\n\t\t\tDom.removeClass(this._innerWrapper, 'ui-entity-editor-content-block__range');\n\t\t\tDom.removeClass(this._selectContainer, 'ui-ctl-date-range');\n\t\t}\n\t}\n\n\tgetDateStartFieldName(): string\n\t{\n\t\treturn this._schemeElement.getData().dateStartFieldName ?? 'DATE_FILTER_START';\n\t}\n\n\tgetDateEndFieldName(): string\n\t{\n\t\treturn this._schemeElement.getData().dateEndFieldName ?? 'DATE_FILTER_END';\n\t}\n\n\tsave()\n\t{\n\t\tsuper.save();\n\t\tthis._model.setField(this.getDateStartFieldName(), null);\n\t\tthis._model.setField(this.getDateEndFieldName(), null);\n\t\tif (Type.isDomNode(this.endInput))\n\t\t{\n\t\t\tthis._model.setField(this.getDateEndFieldName(), this.endInput.value);\n\t\t}\n\n\t\tif (Type.isDomNode(this.startInput))\n\t\t{\n\t\t\tthis._model.setField(this.getDateStartFieldName(), this.startInput.value);\n\t\t}\n\t}\n\n\tstatic showCalendar(input: HTMLElement)\n\t{\n\t\tBX.calendar({ node: input, field: input, bTime: false, bSetFocus: false });\n\t}\n}\n","import {EventEmitter} from \"main.core.events\";\nimport type {BaseEvent} from \"main.core.events\";\nimport {SettingsDateFilterField} from \"./field\";\n\nexport class SettingsDateFilterFieldFactory\n{\n\tconstructor(entityEditorControlFactory = 'BX.UI.EntityEditorControlFactory')\n\t{\n\t\tEventEmitter.subscribe(entityEditorControlFactory + ':onInitialize', (event: BaseEvent) => {\n\t\t\tconst [, eventArgs] = event.getCompatData();\n\t\t\teventArgs.methods['dashboardSettings'] = this.factory.bind(this);\n\t\t});\n\t}\n\n\tfactory(type, controlId, settings)\n\t{\n\t\tif (type === 'timePeriod')\n\t\t{\n\t\t\treturn SettingsDateFilterField.create(controlId, settings);\n\t\t}\n\n\t\treturn null;\n\t}\n}\n"],"names":["SettingsDateFilterField","BX","UI","EntityEditorList","constructor","id","settings","dateSelectorBlock","toInput","startInput","create","self","initialize","layout","options","createTitleNode","Tag","render","layoutRangeField","getValue","RANGE_VALUE","onItemSelect","e","item","value","$isRangeSelected","Dom","removeClass","_selectContainer","addClass","_innerWrapper","dateStartValue","Text","encode","getModel","getField","getDateStartFieldName","Event","bind","showCalendar","markAsChanged","append","dateEndValue","getDateEndFieldName","endInput","remove","_schemeElement","getData","dateStartFieldName","dateEndFieldName","save","_model","setField","Type","isDomNode","input","calendar","node","field","bTime","bSetFocus","SettingsDateFilterFieldFactory","entityEditorControlFactory","EventEmitter","subscribe","event","eventArgs","getCompatData","methods","factory","type","controlId"],"mappings":"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"}