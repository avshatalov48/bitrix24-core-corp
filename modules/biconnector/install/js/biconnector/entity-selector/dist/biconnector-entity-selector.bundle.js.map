{"version":3,"file":"biconnector-entity-selector.bundle.js","sources":["../src/tag-footer.js"],"sourcesContent":["import { DefaultFooter } from 'ui.entity-selector';\nimport { Loc, Tag, Event, Uri } from 'main.core';\n\nexport default class TagFooter extends DefaultFooter\n{\n\tgetContent(): HTMLElement | HTMLElement[] | string | null\n\t{\n\t\treturn this.cache.remember('tag-footer-content', () => {\n\t\t\tconst createButton = Tag.render`\n\t\t\t\t<a class=\"ui-selector-footer-link ui-selector-footer-link-add\"  \n\t\t\t\t\tid=\"tags-widget-custom-footer-add-new\" hidden>\n\t\t\t\t\t\t${Loc.getMessage('BICONNECTOR_ENTITY_SELECTOR_TAG_FOOTER_CREATE')}\n\t\t\t\t</a>\n\t\t\t`;\n\n\t\t\tEvent.bind(createButton, 'click', () => this.createItem());\n\n\t\t\tconst openTagListButton = Tag.render`\n\t\t\t\t<a class=\"ui-selector-footer-link\">\n\t\t\t\t\t${Loc.getMessage('BICONNECTOR_ENTITY_SELECTOR_TAG_FOOTER_GET_TAG_SLIDER')}\n\t\t\t\t</a>\n\t\t\t`;\n\n\t\t\tEvent.bind(\n\t\t\t\topenTagListButton,\n\t\t\t\t'click',\n\t\t\t\t() => {\n\t\t\t\t\tconst sliderLink = new Uri(\n\t\t\t\t\t\t'/bitrix/components/bitrix/biconnector.apachesuperset.dashboard.tag.list/slider.php',\n\t\t\t\t\t);\n\n\t\t\t\t\ttop.BX.SidePanel.Instance.open(\n\t\t\t\t\t\tsliderLink.toString(),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twidth: 970,\n\t\t\t\t\t\t\tallowChangeHistory: false,\n\t\t\t\t\t\t\tcacheable: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t);\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"tags-widget-custom-footer\">\n\t\t\t\t\t${createButton}\n\t\t\t\t\t<span class=\"ui-selector-footer-conjunction\" \n\t\t\t\t\t\tid=\"tags-widget-custom-footer-conjunction\" hidden>\n\t\t\t\t\t\t\t${Loc.getMessage('BICONNECTOR_ENTITY_SELECTOR_TAG_FOOTER_OR')}\n\t\t\t\t\t</span>\n\t\t\t\t\t${openTagListButton}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tcreateItem(): void\n\t{\n\t\tif (!this.canCreateTag())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst tagSelector = this.getDialog().getTagSelector();\n\t\tif (tagSelector && tagSelector.isLocked())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst finalize = () => {\n\t\t\tif (this.getDialog().getTagSelector())\n\t\t\t{\n\t\t\t\tthis.getDialog().getTagSelector().unlock();\n\t\t\t\tthis.getDialog().focusSearch();\n\t\t\t}\n\t\t};\n\n\t\tif (tagSelector)\n\t\t{\n\t\t\ttagSelector.lock();\n\t\t}\n\n\t\tthis.getDialog()\n\t\t\t.emitAsync('Search:onItemCreateAsync', {\n\t\t\t\tsearchQuery: this.getDialog().getSearchTab().getLastSearchQuery(),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.getDialog().getSearchTab().clearResults();\n\t\t\t\tthis.getDialog().clearSearch();\n\t\t\t\tif (this.getDialog().getActiveTab() === this.getTab())\n\t\t\t\t{\n\t\t\t\t\tthis.getDialog().selectFirstTab();\n\t\t\t\t}\n\n\t\t\t\tfinalize();\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tfinalize();\n\t\t\t})\n\t\t;\n\t}\n\n\tcanCreateTag(): boolean\n\t{\n\t\treturn this.options?.canCreateTag ?? false;\n\t}\n}\n"],"names":["TagFooter","cache","remember","createButton","Tag","render","Loc","getMessage","Event","bind","createItem","openTagListButton","sliderLink","Uri","top","BX","SidePanel","Instance","open","toString","width","allowChangeHistory","cacheable","canCreateTag","tagSelector","getDialog","getTagSelector","isLocked","finalize","unlock","focusSearch","lock","emitAsync","searchQuery","getSearchTab","getLastSearchQuery","then","clearResults","clearSearch","getActiveTab","getTab","selectFirstTab","options","DefaultFooter"],"mappings":";;;;;;;AAAA,KAGqBA,SAAS;GAAA;GAAA;KAAA;KAAA;;GAAA;KAAA;KAAA,6BAG7B;OAAA;OACC,OAAO,IAAI,CAACC,KAAK,CAACC,QAAQ,CAAC,oBAAoB,EAAE,YAAM;SACtD,IAAMC,YAAY,GAAGC,aAAG,CAACC,MAAM,kQAG1BC,aAAG,CAACC,UAAU,CAAC,+CAA+C,CAAC,CAEnE;SAEDC,eAAK,CAACC,IAAI,CAACN,YAAY,EAAE,OAAO,EAAE;WAAA,OAAM,KAAI,CAACO,UAAU,EAAE;WAAC;SAE1D,IAAMC,iBAAiB,GAAGP,aAAG,CAACC,MAAM,yKAEhCC,aAAG,CAACC,UAAU,CAAC,uDAAuD,CAAC,CAE1E;SAEDC,eAAK,CAACC,IAAI,CACTE,iBAAiB,EACjB,OAAO,EACP,YAAM;WACL,IAAMC,UAAU,GAAG,IAAIC,aAAG,CACzB,oFAAoF,CACpF;WAEDC,GAAG,CAACC,EAAE,CAACC,SAAS,CAACC,QAAQ,CAACC,IAAI,CAC7BN,UAAU,CAACO,QAAQ,EAAE,EACrB;aACCC,KAAK,EAAE,GAAG;aACVC,kBAAkB,EAAE,KAAK;aACzBC,SAAS,EAAE;YACX,CACD;UACD,CACD;SAED,OAAOlB,aAAG,CAACC,MAAM,mWAEbF,YAAY,EAGVG,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC,EAE7DI,iBAAiB;QAGrB,CAAC;;;KACF;KAAA,6BAGD;OAAA;OACC,IAAI,CAAC,IAAI,CAACY,YAAY,EAAE,EACxB;SACC;;OAGD,IAAMC,WAAW,GAAG,IAAI,CAACC,SAAS,EAAE,CAACC,cAAc,EAAE;OACrD,IAAIF,WAAW,IAAIA,WAAW,CAACG,QAAQ,EAAE,EACzC;SACC;;OAGD,IAAMC,QAAQ,GAAG,SAAXA,QAAQ,GAAS;SACtB,IAAI,MAAI,CAACH,SAAS,EAAE,CAACC,cAAc,EAAE,EACrC;WACC,MAAI,CAACD,SAAS,EAAE,CAACC,cAAc,EAAE,CAACG,MAAM,EAAE;WAC1C,MAAI,CAACJ,SAAS,EAAE,CAACK,WAAW,EAAE;;QAE/B;OAED,IAAIN,WAAW,EACf;SACCA,WAAW,CAACO,IAAI,EAAE;;OAGnB,IAAI,CAACN,SAAS,EAAE,CACdO,SAAS,CAAC,0BAA0B,EAAE;SACtCC,WAAW,EAAE,IAAI,CAACR,SAAS,EAAE,CAACS,YAAY,EAAE,CAACC,kBAAkB;QAC/D,CAAC,CACDC,IAAI,CAAC,YAAM;SACX,MAAI,CAACX,SAAS,EAAE,CAACS,YAAY,EAAE,CAACG,YAAY,EAAE;SAC9C,MAAI,CAACZ,SAAS,EAAE,CAACa,WAAW,EAAE;SAC9B,IAAI,MAAI,CAACb,SAAS,EAAE,CAACc,YAAY,EAAE,KAAK,MAAI,CAACC,MAAM,EAAE,EACrD;WACC,MAAI,CAACf,SAAS,EAAE,CAACgB,cAAc,EAAE;;SAGlCb,QAAQ,EAAE;QACV,CAAC,SACI,CAAC,YAAM;SACZA,QAAQ,EAAE;QACV,CAAC;;;KAEH;KAAA,+BAGD;OAAA;OACC,iDAAO,IAAI,CAACc,OAAO,kDAAZ,cAAcnB,YAAY,yEAAI,KAAK;;;GAC1C;CAAA,EArGqCoB,+BAAa;;;;;;;;"}