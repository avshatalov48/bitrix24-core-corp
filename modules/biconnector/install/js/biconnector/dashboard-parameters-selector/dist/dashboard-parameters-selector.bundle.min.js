this.BX=this.BX||{},function(e,t,a,s,i,l,r){"use strict";var n,o,c,d;function p(e,t){u(e,t),t.add(e)}function b(e,t,a){u(e,t),t.set(e,a)}function u(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function v(e,t,a){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return a}var h=new WeakMap,m=new WeakMap,g=new WeakMap,S=new WeakMap,P=new WeakMap,f=new WeakMap,A=new WeakMap,T=new WeakSet,H=new WeakSet,_=new WeakSet,E=new WeakSet,I=new WeakSet,D=new WeakSet,w=new WeakSet,B=new WeakSet,R=new WeakSet,M=new WeakSet,O=new WeakSet,F=new WeakSet,C=function(){function e(t){babelHelpers.classCallCheck(this,e),p(this,F),p(this,O),p(this,M),p(this,R),p(this,B),p(this,w),p(this,D),p(this,I),p(this,E),p(this,_),p(this,H),p(this,T),b(this,h,{writable:!0,value:void 0}),b(this,m,{writable:!0,value:void 0}),b(this,g,{writable:!0,value:void 0}),b(this,S,{writable:!0,value:void 0}),b(this,P,{writable:!0,value:void 0}),b(this,f,{writable:!0,value:void 0}),b(this,A,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldSet(this,h,t.scopes),babelHelpers.classPrivateFieldSet(this,m,new Set(t.scopes)),babelHelpers.classPrivateFieldSet(this,g,t.params),babelHelpers.classPrivateFieldSet(this,S,new Set(t.params)),babelHelpers.classPrivateFieldSet(this,P,t.scopeParamsMap),a.EventEmitter.subscribe("BIConnector.DashboardParamsSelector:onLoadScope",v(this,H,G).bind(this))}return babelHelpers.createClass(e,[{key:"getValues",value:function(){return{scopes:babelHelpers.classPrivateFieldGet(this,h),params:babelHelpers.classPrivateFieldGet(this,g)}}},{key:"getLayout",value:function(){babelHelpers.classPrivateFieldSet(this,f,v(this,T,L).call(this));var e=t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_HINT",{"[link]":'<a class="ui-link" onclick="top.BX.Helper.show(`redirect=detail&code=22658454`)">',"[/link]":"</a>"}),a=t.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="dashboard-params-container">\n\t\t\t\t<div class="dashboard-params-title-container">\n\t\t\t\t\t<div class="dashboard-params-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<span data-hint="','"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="dashboard-params-scope-selector"></div>\n\t\t\t\t<div class="dashboard-params-title-container">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class="dashboard-params-title">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t<span data-hint-html data-hint-interactivity data-hint='",'\'></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="dashboard-params-list-link">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="dashboard-params-params-selector"></div>\n\t\t\t</div>\n\t\t'])),t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_SCOPE"),t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_SCOPE_HINT"),t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS"),e,t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_LIST"));return BX.UI.Hint.init(a),babelHelpers.classPrivateFieldGet(this,f).renderTo(a.querySelector(".dashboard-params-scope-selector")),new s.TagSelector({locked:!0}).renderTo(a.querySelector(".dashboard-params-params-selector")),t.Event.bind(a.querySelector(".dashboard-params-list-link"),"click",v(this,F,V).bind(this)),a}}]),e}();function L(){var e=this,i=[],l=!1;babelHelpers.classPrivateFieldGet(this,h).forEach((function(e){e.startsWith("automated_solution_")&&(l=!0),i.push(["biconnector-superset-scope",e])}));var r=new s.TagSelector({multiple:!0,dialogOptions:{id:"biconnector-superset-scope",context:"biconnector-superset-scope",enableSearch:!1,dropdownMode:!0,showAvatars:!1,compactView:!0,dynamicLoad:!0,preload:!0,width:383,height:419,entities:[{id:"biconnector-superset-scope",dynamicLoad:!0,options:{}}],preselectedItems:i,events:{onLoad:function(e){if(l){var t,s,i,r,n=null===(s=(null===(t=e.getTarget())||void 0===t?void 0:t.getItems()).find((function(e){return"automated_solution"===e.getId()})).getNodes())||void 0===s||null===(i=s.values())||void 0===i||null===(r=i.next())||void 0===r?void 0:r.value;null==n||n.setOpen(!0)}a.EventEmitter.emit("BIConnector.DashboardParamsSelector:onLoadScope")},"Item:onSelect":function(t){var a=t.getData().item,s=v(e,E,y).call(e,a.getId());s.paramsToDelete.size>0||s.paramsNotToSave.size>0?v(e,I,W).call(e,s,a).show():v(e,D,N).call(e,s)}}},events:{onBeforeTagAdd:function(t){var a=t.getData().tag;babelHelpers.classPrivateFieldGet(e,h).add(a.getId()),v(e,O,Y).call(e)},onBeforeTagRemove:function(t){var a=t.getData().tag;babelHelpers.classPrivateFieldGet(e,h).delete(a.getId()),v(e,O,Y).call(e)},onAfterTagRemove:function(t){v(e,w,U).call(e)}}});return t.Dom.addClass(r.getDialog().getContainer(),"biconnector-settings-scope-selector"),r}function G(){babelHelpers.classPrivateFieldSet(this,A,v(this,_,k).call(this)),t.Dom.clean(document.querySelector(".dashboard-params-params-selector")),babelHelpers.classPrivateFieldGet(this,A).renderTo(document.querySelector(".dashboard-params-params-selector"))}function k(){var e=this,a=[],l=v(this,B,x).call(this,babelHelpers.classPrivateFieldGet(this,h));babelHelpers.classPrivateFieldGet(this,h).forEach((function(t){var s;(null!==(s=babelHelpers.classPrivateFieldGet(e,P)[t])&&void 0!==s?s:[]).forEach((function(t){var s=v(e,M,z).call(e,t.code),i=l.has(t.code);a.push({id:t.code,entityId:"biconnector-superset-params",title:s.title,supertitle:s.supertitle,tabs:"params",customData:{isAvailable:i},textColor:i?"#535C69":"#B0B6BB"})}))})),babelHelpers.classPrivateFieldGet(this,P).global.forEach((function(t){var s=v(e,M,z).call(e,t.code);a.push({id:t.code,entityId:"biconnector-superset-params",title:s.title,supertitle:s.supertitle,tabs:"params"})}));var r=[],n=[];return babelHelpers.classPrivateFieldGet(this,g).forEach((function(t){r.push(["biconnector-superset-params",t.code]);var a=v(e,M,z).call(e,t);n.push({id:t,entityId:"biconnector-superset-params",title:a.title,supertitle:a.supertitle})})),new s.TagSelector({id:"biconnector-superset-params",multiple:!0,items:n,dialogOptions:{id:"biconnector-superset-params",context:"biconnector-superset-params",enableSearch:!1,dropdownMode:!0,showAvatars:!1,compactView:!1,dynamicLoad:!0,items:a,preselectedItems:r,width:383,height:419,entities:[{id:"biconnector-superset-params"}],tabs:[{id:"params",title:"params"}],events:{"Item:onBeforeSelect":function(e){!1===e.getData().item.getCustomData().get("isAvailable")&&(i.UI.Notification.Center.notify({content:t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_UNAVAILABLE")}),e.preventDefault())}}},events:{onBeforeTagAdd:function(t){var a=t.getData().tag;babelHelpers.classPrivateFieldGet(e,g).add(a.getId()),v(e,O,Y).call(e)},onBeforeTagRemove:function(t){var a=t.getData().tag;babelHelpers.classPrivateFieldGet(e,g).delete(a.getId()),v(e,O,Y).call(e)}}})}function y(e){var t,a,s,i=this,l=new Set;if((null!==(t=babelHelpers.classPrivateFieldGet(this,P)[e])&&void 0!==t?t:[]).forEach((function(e){return l.add(e.code)})),0===babelHelpers.classPrivateFieldGet(this,h).size)return{paramsToDelete:new Set,paramsToSave:l,paramsNotToSave:new Set,intersection:new Set};var r=babelHelpers.classPrivateFieldGet(this,h).values().next().value,n=new Set(null!==(a=(null!==(s=babelHelpers.classPrivateFieldGet(this,P)[r])&&void 0!==s?s:[]).map((function(e){return e.code})))&&void 0!==a?a:[]);babelHelpers.classPrivateFieldGet(this,h).forEach((function(e){var t,a,s=new Set(null!==(t=(null!==(a=babelHelpers.classPrivateFieldGet(i,P)[e])&&void 0!==a?a:[]).map((function(e){return e.code})))&&void 0!==t?t:[]);n=n.intersection(s)}));var o=n.intersection(l),c=babelHelpers.classPrivateFieldGet(this,g),d=v(this,R,X).call(this);return{paramsToDelete:c.difference(o).difference(d),paramsToSave:o.difference(c).union(l.intersection(d)),paramsNotToSave:l.difference(o).difference(d),intersection:o}}function W(e,a){var s=this,i=null;if(e.paramsToDelete.size>0){var n=[];e.paramsToDelete.forEach((function(e){return n.push(v(s,M,z).call(s,e).title)})),i=t.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t<li>\n\t\t\t\t\t","\n\t\t\t\t</li>\n\t\t\t"])),t.Loc.getMessagePlural("DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_PARAMS_TO_DELETE",n.length,{"#PARAMS_TO_DELETE#":n.join(", ")}))}var p=null;if(e.paramsNotToSave.size>0){var b=[];e.paramsNotToSave.forEach((function(e){return b.push(v(s,M,z).call(s,e).title)})),p=t.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t<li>\n\t\t\t\t\t","\n\t\t\t\t</li>\n\t\t\t"])),t.Loc.getMessagePlural("DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_PARAMS_NOT_TO_SAVE",b.length,{"#PARAMS_NOT_TO_SAVE#":b.join(", ")}))}var u=t.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="compatibility-params">\n\t\t\t\t<div class="compatibility-params-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="compatibility-params-content">\n\t\t\t\t\t',"\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_TITLE"),t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_CONTENT"),i,p),h=new r.Popup({width:330,padding:14,overlay:!0,cacheable:!1,content:u,buttons:[new l.Button({text:t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_BUTTON_CANCEL"),color:l.Button.Color.PRIMARY,onclick:function(){a.deselect(),h.close()}}),new l.Button({text:t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_BUTTON_CONFIRM"),color:l.Button.Color.LIGHT_BORDER,onclick:function(){h.close(),a.select(!0),v(s,D,N).call(s,e)}})]});return h}function N(e){var t=this,a=babelHelpers.classPrivateFieldGet(this,A).getDialog().getItems(),s=v(this,B,x).call(this,babelHelpers.classPrivateFieldGet(this,h));a.forEach((function(t){!e.paramsToDelete.has(t.getId())&&s.has(t.getId())||(t.deselect(),t.setTextColor("#B0B6BB"),t.customData.set("isAvailable",!1))})),e.paramsToSave.values().forEach((function(e){var a=babelHelpers.classPrivateFieldGet(t,A).getDialog().getItem(["biconnector-superset-params",e]);if(a)a.customData.set("isAvailable",!0),a.setTextColor("#535C69"),a.select(!0);else{var s=v(t,M,z).call(t,e);babelHelpers.classPrivateFieldGet(t,A).getDialog().addItem({id:e,title:s.title,entityId:"biconnector-superset-params",supertitle:s.supertitle,tabs:"params",selected:!0})}})),e.paramsNotToSave.values().forEach((function(e){var a=v(t,M,z).call(t,e);babelHelpers.classPrivateFieldGet(t,A).getDialog().addItem({id:e,title:a.title,entityId:"biconnector-superset-params",supertitle:a.supertitle,tabs:"params",textColor:"#B0B6BB",customData:{isAvailable:!1}})}))}function U(){var e=this,t=v(this,B,x).call(this,babelHelpers.classPrivateFieldGet(this,h));t.values().forEach((function(t){var a=babelHelpers.classPrivateFieldGet(e,A).getDialog().getItem(["biconnector-superset-params",t]);if(a)a.customData.set("isAvailable",!0),a.setTextColor("#535C69");else{var s=v(e,M,z).call(e,t);babelHelpers.classPrivateFieldGet(e,A).getDialog().addItem({id:t,title:s.title,entityId:"biconnector-superset-params",supertitle:s.supertitle,tabs:"params"})}})),babelHelpers.classPrivateFieldGet(this,A).getDialog().getItems().forEach((function(a){t.has(a.getId())||(a.deselect(),babelHelpers.classPrivateFieldGet(e,A).getDialog().removeItem(a))}))}function x(e){var t=this,a=v(this,R,X).call(this);if(0===e.size)return a;var s=null;return e.forEach((function(e){var a,i;null===s?s=new Set((null!==(a=babelHelpers.classPrivateFieldGet(t,P)[e])&&void 0!==a?a:[]).map((function(e){return e.code}))):s=s.intersection(new Set((null!==(i=babelHelpers.classPrivateFieldGet(t,P)[e])&&void 0!==i?i:[]).map((function(e){return e.code}))))})),a.values().forEach((function(e){return s.add(e)})),s}function X(){var e,t=[];return(null!==(e=babelHelpers.classPrivateFieldGet(this,P).global)&&void 0!==e?e:[]).forEach((function(e){return t.push(e.code)})),new Set(t)}function z(e){var a=this,s=e,i=new Set;babelHelpers.classPrivateFieldGet(this,P).global.forEach((function(t){e===t.code&&(s=t.title,i.add("global"))})),Object.keys(babelHelpers.classPrivateFieldGet(this,P)).forEach((function(t){var l;(null!==(l=babelHelpers.classPrivateFieldGet(a,P)[t])&&void 0!==l?l:[]).forEach((function(a){e===a.code&&(s=a.title,i.has("global")||i.add(t))}))}));var l=[];return babelHelpers.classPrivateFieldGet(this,f).getDialog().getItems().forEach((function(e){i.has(e.getId())&&l.push(e.getTitle())})),i.has("global")&&l.push(t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_GLOBAL")),{title:s,supertitle:l.join(", ")}}function Y(){var e=this,t=babelHelpers.classPrivateFieldGet(this,h).size!==babelHelpers.classPrivateFieldGet(this,m).size||babelHelpers.toConsumableArray(babelHelpers.classPrivateFieldGet(this,h)).some((function(t){return!babelHelpers.classPrivateFieldGet(e,m).has(t)})),s=babelHelpers.classPrivateFieldGet(this,g).size!==babelHelpers.classPrivateFieldGet(this,S).size||babelHelpers.toConsumableArray(babelHelpers.classPrivateFieldGet(this,g)).some((function(t){return!babelHelpers.classPrivateFieldGet(e,S).has(t)})),i=t||s;a.EventEmitter.emit("BIConnector.DashboardParamsSelector:onChange",{isChanged:i})}function V(){var e=new t.Uri("/bitrix/components/bitrix/biconnector.apachesuperset.dashboard.url.parameter.list/slider.php");BX.SidePanel.Instance.open(e.toString(),{width:600,allowChangeHistory:!1})}e.DashboardParametersSelector=C}(this.BX.BIConnector=this.BX.BIConnector||{},BX,BX.Event,BX.UI.EntitySelector,BX,BX.UI,BX.Main);
//# sourceMappingURL=dashboard-parameters-selector.bundle.map.js