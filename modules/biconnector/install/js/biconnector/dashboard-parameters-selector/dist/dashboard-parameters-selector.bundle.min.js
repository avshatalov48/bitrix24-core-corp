this.BX=this.BX||{},function(e,t,a,s,l,i,r){"use strict";var n,o,c,d;function p(e,t){u(e,t),t.add(e)}function b(e,t,a){u(e,t),t.set(e,a)}function u(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function h(e,t,a){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return a}var v=new WeakMap,m=new WeakMap,S=new WeakMap,g=new WeakMap,P=new WeakMap,A=new WeakMap,f=new WeakMap,T=new WeakSet,H=new WeakSet,_=new WeakSet,E=new WeakSet,w=new WeakSet,I=new WeakSet,D=new WeakSet,B=new WeakSet,R=new WeakSet,M=new WeakSet,C=new WeakSet,O=new WeakSet,F=new WeakSet,L=new WeakSet,G=new WeakSet,k=function(){function e(t){babelHelpers.classCallCheck(this,e),p(this,G),p(this,L),p(this,F),p(this,O),p(this,C),p(this,M),p(this,R),p(this,B),p(this,D),p(this,I),p(this,w),p(this,E),p(this,_),p(this,H),p(this,T),b(this,v,{writable:!0,value:void 0}),b(this,m,{writable:!0,value:void 0}),b(this,S,{writable:!0,value:void 0}),b(this,g,{writable:!0,value:void 0}),b(this,P,{writable:!0,value:void 0}),b(this,A,{writable:!0,value:void 0}),b(this,f,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldSet(this,v,t.scopes),babelHelpers.classPrivateFieldSet(this,m,new Set(t.scopes)),babelHelpers.classPrivateFieldSet(this,S,t.params),babelHelpers.classPrivateFieldSet(this,g,new Set(t.params)),babelHelpers.classPrivateFieldSet(this,P,t.scopeParamsMap),a.EventEmitter.subscribe("BIConnector.DashboardParamsSelector:onLoadScope",h(this,H,W).bind(this))}return babelHelpers.createClass(e,[{key:"getValues",value:function(){return{scopes:babelHelpers.classPrivateFieldGet(this,v),params:babelHelpers.classPrivateFieldGet(this,S)}}},{key:"getLayout",value:function(){babelHelpers.classPrivateFieldSet(this,A,h(this,T,y).call(this));var e=t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_HINT",{"[link]":'<a class="ui-link" onclick="top.BX.Helper.show(`redirect=detail&code=22658454`)">',"[/link]":"</a>"}),a=t.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="dashboard-params-container">\n\t\t\t\t<div class="dashboard-params-title-container">\n\t\t\t\t\t<div class="dashboard-params-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<span data-hint="','"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="dashboard-params-scope-selector"></div>\n\t\t\t\t<div class="dashboard-params-title-container">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class="dashboard-params-title">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t<span data-hint-html data-hint-interactivity data-hint='",'\'></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="dashboard-params-list-link">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="dashboard-params-params-selector"></div>\n\t\t\t</div>\n\t\t'])),t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_SCOPE"),t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_SCOPE_HINT"),t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS"),e,t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_LIST"));return BX.UI.Hint.init(a),babelHelpers.classPrivateFieldGet(this,A).renderTo(a.querySelector(".dashboard-params-scope-selector")),new s.TagSelector({locked:!0}).renderTo(a.querySelector(".dashboard-params-params-selector")),t.Event.bind(a.querySelector(".dashboard-params-list-link"),"click",h(this,O,J).bind(this)),a}}]),e}();function y(){var e=this,l=[],i=!1;babelHelpers.classPrivateFieldGet(this,v).forEach((function(e){e.startsWith("automated_solution_")&&(i=!0),l.push(["biconnector-superset-scope",e])}));var r=new s.TagSelector({multiple:!0,dialogOptions:{id:"biconnector-superset-scope",context:"biconnector-superset-scope",enableSearch:!1,dropdownMode:!0,showAvatars:!1,compactView:!0,dynamicLoad:!0,preload:!0,width:383,height:419,entities:[{id:"biconnector-superset-scope",dynamicLoad:!0,options:{}}],preselectedItems:l,events:{onLoad:function(e){if(i){var t,s,l,r,n=null===(s=(null===(t=e.getTarget())||void 0===t?void 0:t.getItems()).find((function(e){return"automated_solution"===e.getId()})).getNodes())||void 0===s||null===(l=s.values())||void 0===l||null===(r=l.next())||void 0===r?void 0:r.value;null==n||n.setOpen(!0)}a.EventEmitter.emit("BIConnector.DashboardParamsSelector:onLoadScope")},"Item:onSelect":function(t){var a=t.getData().item,s=h(e,E,U).call(e,a.getId());s.paramsToDelete.size>0||s.paramsNotToSave.size>0?h(e,w,x).call(e,s,a).show():h(e,I,X).call(e,s)}}},events:{onBeforeTagAdd:function(t){var a=t.getData().tag;babelHelpers.classPrivateFieldGet(e,v).add(a.getId()),h(e,C,q).call(e)},onBeforeTagRemove:function(t){var a=t.getData().tag;babelHelpers.classPrivateFieldGet(e,v).delete(a.getId()),h(e,C,q).call(e)},onAfterTagRemove:function(){h(e,D,z).call(e)}}});return t.Dom.addClass(r.getDialog().getContainer(),"biconnector-settings-scope-selector"),r}function W(){babelHelpers.classPrivateFieldSet(this,f,h(this,_,N).call(this)),t.Dom.clean(document.querySelector(".dashboard-params-params-selector")),babelHelpers.classPrivateFieldGet(this,f).renderTo(document.querySelector(".dashboard-params-params-selector"))}function N(){var e=this,a=[],i=h(this,B,Y).call(this,babelHelpers.classPrivateFieldGet(this,v));babelHelpers.classPrivateFieldGet(this,v).forEach((function(t){var s;(null!==(s=babelHelpers.classPrivateFieldGet(e,P)[t])&&void 0!==s?s:[]).forEach((function(t){var s=h(e,M,j).call(e,t.code),l=i.has(t.code);a.push({id:t.code,entityId:"biconnector-superset-params",title:s.title,supertitle:s.supertitle,tabs:"params",customData:{isAvailable:l},textColor:l?"#535C69":"#B0B6BB"})}))})),babelHelpers.classPrivateFieldGet(this,P).global.forEach((function(t){var s=h(e,M,j).call(e,t.code);a.push({id:t.code,entityId:"biconnector-superset-params",title:s.title,supertitle:s.supertitle,tabs:"params"})}));var r=[],n=[];return babelHelpers.classPrivateFieldGet(this,S).forEach((function(t){r.push(["biconnector-superset-params",t.code]);var a=h(e,M,j).call(e,t);n.push({id:t,entityId:"biconnector-superset-params",title:a.title,supertitle:a.supertitle})})),new s.TagSelector({id:"biconnector-superset-params",multiple:!0,items:n,dialogOptions:{id:"biconnector-superset-params",context:"biconnector-superset-params",enableSearch:!1,dropdownMode:!0,showAvatars:!1,compactView:!1,dynamicLoad:!0,items:a,preselectedItems:r,width:383,height:419,entities:[{id:"biconnector-superset-params"}],tabs:[{id:"params",title:"params"}],events:{"Item:onBeforeSelect":function(e){!1===e.getData().item.getCustomData().get("isAvailable")&&(l.UI.Notification.Center.notify({content:t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_UNAVAILABLE")}),e.preventDefault())}}},events:{onBeforeTagAdd:function(t){var a=t.getData().tag;babelHelpers.classPrivateFieldGet(e,S).add(a.getId()),h(e,C,q).call(e)},onBeforeTagRemove:function(t){var a=t.getData().tag;babelHelpers.classPrivateFieldGet(e,S).delete(a.getId()),h(e,C,q).call(e)}}})}function U(e){var t,a,s,l=this,i=new Set;if((null!==(t=babelHelpers.classPrivateFieldGet(this,P)[e])&&void 0!==t?t:[]).forEach((function(e){return i.add(e.code)})),0===babelHelpers.classPrivateFieldGet(this,v).size)return{paramsToDelete:new Set,paramsToSave:i,paramsNotToSave:new Set,intersection:new Set};var r=babelHelpers.classPrivateFieldGet(this,v).values().next().value,n=new Set(null!==(a=(null!==(s=babelHelpers.classPrivateFieldGet(this,P)[r])&&void 0!==s?s:[]).map((function(e){return e.code})))&&void 0!==a?a:[]);babelHelpers.classPrivateFieldGet(this,v).forEach((function(e){var t,a,s=new Set(null!==(t=(null!==(a=babelHelpers.classPrivateFieldGet(l,P)[e])&&void 0!==a?a:[]).map((function(e){return e.code})))&&void 0!==t?t:[]);n=h(l,F,K).call(l,n,s)}));var o=h(this,F,K).call(this,n,i),c=babelHelpers.classPrivateFieldGet(this,S),d=h(this,R,V).call(this);return{paramsToDelete:h(this,L,Q).call(this,c,o,d),paramsToSave:h(this,G,Z).call(this,h(this,L,Q).call(this,o,c),h(this,F,K).call(this,i,d)),paramsNotToSave:h(this,L,Q).call(this,i,o,d),intersection:o}}function x(e,a){var s=this,l=null;if(e.paramsToDelete.size>0){var n=[];e.paramsToDelete.forEach((function(e){return n.push(h(s,M,j).call(s,e).title)})),l=t.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t<li>\n\t\t\t\t\t","\n\t\t\t\t</li>\n\t\t\t"])),t.Loc.getMessagePlural("DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_PARAMS_TO_DELETE",n.length,{"#PARAMS_TO_DELETE#":n.join(", ")}))}var p=null;if(e.paramsNotToSave.size>0){var b=[];e.paramsNotToSave.forEach((function(e){return b.push(h(s,M,j).call(s,e).title)})),p=t.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t<li>\n\t\t\t\t\t","\n\t\t\t\t</li>\n\t\t\t"])),t.Loc.getMessagePlural("DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_PARAMS_NOT_TO_SAVE",b.length,{"#PARAMS_NOT_TO_SAVE#":b.join(", ")}))}var u=t.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="compatibility-params">\n\t\t\t\t<div class="compatibility-params-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="compatibility-params-content">\n\t\t\t\t\t',"\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_TITLE"),t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_CONTENT"),l,p),v=new r.Popup({width:330,padding:14,overlay:!0,cacheable:!1,content:u,buttons:[new i.Button({text:t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_BUTTON_CANCEL"),color:i.Button.Color.PRIMARY,onclick:function(){a.deselect(),v.close()}}),new i.Button({text:t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_BUTTON_CONFIRM"),color:i.Button.Color.LIGHT_BORDER,onclick:function(){v.close(),a.select(!0),h(s,I,X).call(s,e)}})]});return v}function X(e){var t=this,a=babelHelpers.classPrivateFieldGet(this,f).getDialog().getItems(),s=h(this,B,Y).call(this,babelHelpers.classPrivateFieldGet(this,v));a.forEach((function(t){!e.paramsToDelete.has(t.getId())&&s.has(t.getId())||(t.deselect(),t.setTextColor("#B0B6BB"),t.customData.set("isAvailable",!1))})),babelHelpers.toConsumableArray(e.paramsToSave.values()).forEach((function(e){var a=babelHelpers.classPrivateFieldGet(t,f).getDialog().getItem(["biconnector-superset-params",e]);if(a)a.customData.set("isAvailable",!0),a.setTextColor("#535C69"),a.select(!0);else{var s=h(t,M,j).call(t,e);babelHelpers.classPrivateFieldGet(t,f).getDialog().addItem({id:e,title:s.title,entityId:"biconnector-superset-params",supertitle:s.supertitle,tabs:"params",selected:!0})}})),babelHelpers.toConsumableArray(e.paramsNotToSave.values()).forEach((function(e){var a=h(t,M,j).call(t,e);babelHelpers.classPrivateFieldGet(t,f).getDialog().addItem({id:e,title:a.title,entityId:"biconnector-superset-params",supertitle:a.supertitle,tabs:"params",textColor:"#B0B6BB",customData:{isAvailable:!1}})}))}function z(){var e=this,t=h(this,B,Y).call(this,babelHelpers.classPrivateFieldGet(this,v));babelHelpers.toConsumableArray(t.values()).forEach((function(t){var a=babelHelpers.classPrivateFieldGet(e,f).getDialog().getItem(["biconnector-superset-params",t]);if(a)a.customData.set("isAvailable",!0),a.setTextColor("#535C69");else{var s=h(e,M,j).call(e,t);babelHelpers.classPrivateFieldGet(e,f).getDialog().addItem({id:t,title:s.title,entityId:"biconnector-superset-params",supertitle:s.supertitle,tabs:"params"})}})),babelHelpers.classPrivateFieldGet(this,f).getDialog().getItems().forEach((function(a){t.has(a.getId())||(a.deselect(),babelHelpers.classPrivateFieldGet(e,f).getDialog().removeItem(a))}))}function Y(e){var t=this,a=h(this,R,V).call(this);if(0===e.size)return a;var s=null;return e.forEach((function(e){var a,l;null===s?s=new Set((null!==(a=babelHelpers.classPrivateFieldGet(t,P)[e])&&void 0!==a?a:[]).map((function(e){return e.code}))):s=h(t,F,K).call(t,s,new Set((null!==(l=babelHelpers.classPrivateFieldGet(t,P)[e])&&void 0!==l?l:[]).map((function(e){return e.code}))))})),babelHelpers.toConsumableArray(a.values()).forEach((function(e){return s.add(e)})),s}function V(){var e,t=[];return(null!==(e=babelHelpers.classPrivateFieldGet(this,P).global)&&void 0!==e?e:[]).forEach((function(e){return t.push(e.code)})),new Set(t)}function j(e){var a=this,s=e,l=new Set;babelHelpers.classPrivateFieldGet(this,P).global.forEach((function(t){e===t.code&&(s=t.title,l.add("global"))})),Object.keys(babelHelpers.classPrivateFieldGet(this,P)).forEach((function(t){var i;(null!==(i=babelHelpers.classPrivateFieldGet(a,P)[t])&&void 0!==i?i:[]).forEach((function(a){e===a.code&&(s=a.title,l.has("global")||l.add(t))}))}));var i=[];return babelHelpers.classPrivateFieldGet(this,A).getDialog().getItems().forEach((function(e){l.has(e.getId())&&i.push(e.getTitle())})),l.has("global")&&i.push(t.Loc.getMessage("DASHBOARD_PARAMS_SELECTOR_PARAMS_GLOBAL")),{title:s,supertitle:i.join(", ")}}function q(){var e=this,t=babelHelpers.classPrivateFieldGet(this,v).size!==babelHelpers.classPrivateFieldGet(this,m).size||babelHelpers.toConsumableArray(babelHelpers.classPrivateFieldGet(this,v)).some((function(t){return!babelHelpers.classPrivateFieldGet(e,m).has(t)})),s=babelHelpers.classPrivateFieldGet(this,S).size!==babelHelpers.classPrivateFieldGet(this,g).size||babelHelpers.toConsumableArray(babelHelpers.classPrivateFieldGet(this,S)).some((function(t){return!babelHelpers.classPrivateFieldGet(e,g).has(t)})),l=t||s;a.EventEmitter.emit("BIConnector.DashboardParamsSelector:onChange",{isChanged:l})}function J(){var e=new t.Uri("/bitrix/components/bitrix/biconnector.apachesuperset.dashboard.url.parameter.list/slider.php");BX.SidePanel.Instance.open(e.toString(),{width:600,allowChangeHistory:!1})}function K(e,t){var a=new Set;return e.forEach((function(e){t.has(e)&&a.add(e)})),a}function Q(e,t,a){var s=new Set;return e.forEach((function(e){t.has(e)||(a?a&&!a.has(e)&&s.add(e):s.add(e))})),s}function Z(e,t){var a=new Set;return e.forEach((function(e){a.add(e)})),t.forEach((function(e){a.add(e)})),a}e.DashboardParametersSelector=k}(this.BX.BIConnector=this.BX.BIConnector||{},BX,BX.Event,BX.UI.EntitySelector,BX,BX.UI,BX.Main);
//# sourceMappingURL=dashboard-parameters-selector.bundle.map.js