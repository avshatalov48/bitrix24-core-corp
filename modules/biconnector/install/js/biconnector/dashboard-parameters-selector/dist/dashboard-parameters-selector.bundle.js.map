{"version":3,"file":"dashboard-parameters-selector.bundle.js","sources":["../src/dashboard-parameters-selector.js"],"sourcesContent":["/* eslint-disable operator-linebreak */\nimport { Dom, Event, Loc, Tag, Uri } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { TagSelector, Item } from 'ui.entity-selector';\nimport { UI } from 'ui.notification';\nimport { Button } from 'ui.buttons';\nimport { Popup } from 'main.popup';\nimport type { Parameter, CheckCompatibilityResult } from './types';\nimport './css/main.css';\n\nexport class DashboardParametersSelector\n{\n\t#scopes: Set<string>;\n\t#initialScopes: Set<string>;\n\t#params: Set<string>;\n\t#initialParams: Set<string>;\n\t#scopeParamsMap: {[scopeCode: string]: Array<Parameter>};\n\t#scopeSelector: TagSelector;\n\t#paramsSelector: TagSelector;\n\n\tconstructor(params)\n\t{\n\t\tthis.#scopes = params.scopes;\n\t\tthis.#initialScopes = new Set(params.scopes);\n\t\tthis.#params = params.params;\n\t\tthis.#initialParams = new Set(params.params);\n\t\tthis.#scopeParamsMap = params.scopeParamsMap;\n\n\t\tEventEmitter.subscribe('BIConnector.DashboardParamsSelector:onLoadScope', this.#onLoadScope.bind(this));\n\t}\n\n\tgetValues(): {scopes: Set<string>, params: Set<string>}\n\t{\n\t\treturn {\n\t\t\tscopes: this.#scopes,\n\t\t\tparams: this.#params,\n\t\t};\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\tthis.#scopeSelector = this.#getScopeSelector();\n\n\t\tconst paramsHintText = Loc.getMessage(\n\t\t\t'DASHBOARD_PARAMS_SELECTOR_PARAMS_HINT',\n\t\t\t{\n\t\t\t\t'[link]': '<a class=\"ui-link\" onclick=\"top.BX.Helper.show(`redirect=detail&code=22658454`)\">',\n\t\t\t\t'[/link]': '</a>',\n\t\t\t},\n\t\t);\n\n\t\tconst container = Tag.render`\n\t\t\t<div class=\"dashboard-params-container\">\n\t\t\t\t<div class=\"dashboard-params-title-container\">\n\t\t\t\t\t<div class=\"dashboard-params-title\">\n\t\t\t\t\t\t${Loc.getMessage('DASHBOARD_PARAMS_SELECTOR_SCOPE')}\n\t\t\t\t\t\t<span data-hint=\"${Loc.getMessage('DASHBOARD_PARAMS_SELECTOR_SCOPE_HINT')}\"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"dashboard-params-scope-selector\"></div>\n\t\t\t\t<div class=\"dashboard-params-title-container\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class=\"dashboard-params-title\">\n\t\t\t\t\t\t\t${Loc.getMessage('DASHBOARD_PARAMS_SELECTOR_PARAMS')}\n\t\t\t\t\t\t\t<span data-hint-html data-hint-interactivity data-hint='${paramsHintText}'></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"dashboard-params-list-link\">\n\t\t\t\t\t\t${Loc.getMessage('DASHBOARD_PARAMS_SELECTOR_PARAMS_LIST')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"dashboard-params-params-selector\"></div>\n\t\t\t</div>\n\t\t`;\n\t\tBX.UI.Hint.init(container);\n\n\t\tthis.#scopeSelector.renderTo(container.querySelector('.dashboard-params-scope-selector'));\n\n\t\t// Params selector will be loaded in onLoadScope event handler.\n\t\tconst stubParamsSelector = new TagSelector({\n\t\t\tlocked: true,\n\t\t});\n\t\tstubParamsSelector.renderTo(container.querySelector('.dashboard-params-params-selector'));\n\n\t\tEvent.bind(container.querySelector('.dashboard-params-list-link'), 'click', this.#openParamListSlider.bind(this));\n\n\t\treturn container;\n\t}\n\n\t#getScopeSelector(): TagSelector\n\t{\n\t\tconst preselectedItems = [];\n\t\tlet hasSelectedAutomatedSolutions = false;\n\t\tthis.#scopes.forEach((scope) => {\n\t\t\tif (scope.startsWith('automated_solution_'))\n\t\t\t{\n\t\t\t\thasSelectedAutomatedSolutions = true;\n\t\t\t}\n\t\t\tpreselectedItems.push(['biconnector-superset-scope', scope]);\n\t\t});\n\n\t\tconst selector = new TagSelector({\n\t\t\tmultiple: true,\n\t\t\tdialogOptions: {\n\t\t\t\tid: 'biconnector-superset-scope',\n\t\t\t\tcontext: 'biconnector-superset-scope',\n\t\t\t\tenableSearch: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tshowAvatars: false,\n\t\t\t\tcompactView: true,\n\t\t\t\tdynamicLoad: true,\n\t\t\t\tpreload: true,\n\t\t\t\twidth: 383,\n\t\t\t\theight: 419,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'biconnector-superset-scope',\n\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\toptions: {},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tpreselectedItems,\n\t\t\t\tevents: {\n\t\t\t\t\tonLoad: (event) => {\n\t\t\t\t\t\tif (hasSelectedAutomatedSolutions)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst items = event.getTarget()?.getItems();\n\t\t\t\t\t\t\tconst automatedSolutionItem = items.find((item) => item.getId() === 'automated_solution');\n\t\t\t\t\t\t\tconst itemNode = automatedSolutionItem.getNodes()?.values()?.next()?.value;\n\t\t\t\t\t\t\titemNode?.setOpen(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tEventEmitter.emit('BIConnector.DashboardParamsSelector:onLoadScope');\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onSelect': (event: BaseEvent) => {\n\t\t\t\t\t\tconst item: Item = event.getData().item;\n\t\t\t\t\t\tconst compatibilityResult = this.#checkParamsCompatibility(item.getId());\n\t\t\t\t\t\tif (compatibilityResult.paramsToDelete.size > 0 || compatibilityResult.paramsNotToSave.size > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst popup = this.#getCompatibilityPopup(compatibilityResult, item);\n\t\t\t\t\t\t\tpopup.show();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#onScopeAdd(compatibilityResult);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonBeforeTagAdd: (event) => {\n\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\tthis.#scopes.add(tag.getId());\n\t\t\t\t\tthis.#onChange();\n\t\t\t\t},\n\t\t\t\tonBeforeTagRemove: (event) => {\n\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\tthis.#scopes.delete(tag.getId());\n\t\t\t\t\tthis.#onChange();\n\t\t\t\t},\n\t\t\t\tonAfterTagRemove: (event) => {\n\t\t\t\t\tthis.#onScopeRemove();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t\tDom.addClass(selector.getDialog().getContainer(), 'biconnector-settings-scope-selector');\n\n\t\treturn selector;\n\t}\n\n\t#onLoadScope(): void\n\t{\n\t\tthis.#paramsSelector = this.#getParamsSelector();\n\t\tDom.clean(document.querySelector('.dashboard-params-params-selector'));\n\t\tthis.#paramsSelector.renderTo(document.querySelector('.dashboard-params-params-selector'));\n\t}\n\n\t#getParamsSelector(): TagSelector\n\t{\n\t\tconst items = [];\n\t\tconst availableParams = this.#getAvailableParamsByScope(this.#scopes);\n\t\tthis.#scopes.forEach((scope) => {\n\t\t\tconst scopeParams = this.#scopeParamsMap[scope] ?? [];\n\t\t\tscopeParams.forEach((param: Parameter) => {\n\t\t\t\tconst itemTitle = this.#getItemTitle(param.code);\n\t\t\t\tconst isAvailable = availableParams.has(param.code);\n\t\t\t\titems.push({\n\t\t\t\t\tid: param.code,\n\t\t\t\t\tentityId: 'biconnector-superset-params',\n\t\t\t\t\ttitle: itemTitle.title,\n\t\t\t\t\tsupertitle: itemTitle.supertitle,\n\t\t\t\t\ttabs: 'params',\n\t\t\t\t\tcustomData: {\n\t\t\t\t\t\tisAvailable,\n\t\t\t\t\t},\n\t\t\t\t\ttextColor: isAvailable ? '#535C69' : '#B0B6BB',\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tthis.#scopeParamsMap.global.forEach((param) => {\n\t\t\tconst itemTitle = this.#getItemTitle(param.code);\n\t\t\titems.push({\n\t\t\t\tid: param.code,\n\t\t\t\tentityId: 'biconnector-superset-params',\n\t\t\t\ttitle: itemTitle.title,\n\t\t\t\tsupertitle: itemTitle.supertitle,\n\t\t\t\ttabs: 'params',\n\t\t\t});\n\t\t});\n\n\t\tconst preselectedItems = [];\n\t\tconst tagItems = [];\n\t\tthis.#params.forEach((param) => {\n\t\t\tpreselectedItems.push(['biconnector-superset-params', param.code]);\n\t\t\tconst itemTitle = this.#getItemTitle(param);\n\t\t\ttagItems.push({\n\t\t\t\tid: param,\n\t\t\t\tentityId: 'biconnector-superset-params',\n\t\t\t\ttitle: itemTitle.title,\n\t\t\t\tsupertitle: itemTitle.supertitle,\n\t\t\t});\n\t\t});\n\n\t\treturn new TagSelector({\n\t\t\tid: 'biconnector-superset-params',\n\t\t\tmultiple: true,\n\t\t\titems: tagItems,\n\t\t\tdialogOptions: {\n\t\t\t\tid: 'biconnector-superset-params',\n\t\t\t\tcontext: 'biconnector-superset-params',\n\t\t\t\tenableSearch: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tshowAvatars: false,\n\t\t\t\tcompactView: false,\n\t\t\t\tdynamicLoad: true,\n\t\t\t\titems,\n\t\t\t\tpreselectedItems,\n\t\t\t\twidth: 383,\n\t\t\t\theight: 419,\n\t\t\t\tentities: [{\n\t\t\t\t\tid: 'biconnector-superset-params',\n\t\t\t\t}],\n\t\t\t\ttabs: [{\n\t\t\t\t\tid: 'params',\n\t\t\t\t\ttitle: 'params',\n\t\t\t\t}],\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onBeforeSelect': (event: BaseEvent) => {\n\t\t\t\t\t\tconst item: Item = event.getData().item;\n\t\t\t\t\t\tif (item.getCustomData().get('isAvailable') === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('DASHBOARD_PARAMS_SELECTOR_PARAMS_UNAVAILABLE'),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonBeforeTagAdd: (event) => {\n\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\tthis.#params.add(tag.getId());\n\t\t\t\t\tthis.#onChange();\n\t\t\t\t},\n\t\t\t\tonBeforeTagRemove: (event) => {\n\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\tthis.#params.delete(tag.getId());\n\t\t\t\t\tthis.#onChange();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#checkParamsCompatibility(addedScope: string): CheckCompatibilityResult\n\t{\n\t\tconst newParamCodes = new Set();\n\t\tconst newParams = this.#scopeParamsMap[addedScope] ?? [];\n\t\tnewParams.forEach((param: Parameter) => newParamCodes.add(param.code));\n\n\t\tif (this.#scopes.size === 0)\n\t\t{\n\t\t\treturn {\n\t\t\t\tparamsToDelete: new Set(),\n\t\t\t\tparamsToSave: newParamCodes,\n\t\t\t\tparamsNotToSave: new Set(),\n\t\t\t\tintersection: new Set(),\n\t\t\t};\n\t\t}\n\n\t\t// Intersection of previously selected scopes\n\t\tconst firstScope = this.#scopes.values().next().value;\n\t\tlet availableParamsWithOldScopes = new Set(\n\t\t\t(this.#scopeParamsMap[firstScope] ?? []).map((item: Parameter) => item.code) ?? [],\n\t\t);\n\t\tthis.#scopes.forEach((scope) => {\n\t\t\tconst scopeParams = new Set(\n\t\t\t\t(this.#scopeParamsMap[scope] ?? []).map((item: Parameter) => item.code) ?? [],\n\t\t\t);\n\t\t\tavailableParamsWithOldScopes = availableParamsWithOldScopes.intersection(scopeParams);\n\t\t});\n\n\t\tconst intersection = availableParamsWithOldScopes.intersection(newParamCodes);\n\t\tconst currentParamCodes = this.#params;\n\t\tconst globalParams = this.#getGlobalParamsCodes();\n\n\t\t// Don't delete and save global params even if they are not in the intersection.\n\t\tconst paramsToDelete = currentParamCodes.difference(intersection).difference(globalParams);\n\t\tconst paramsToSave = intersection.difference(currentParamCodes).union(newParamCodes.intersection(globalParams));\n\t\tconst paramsNotToSave = newParamCodes.difference(intersection).difference(globalParams);\n\n\t\treturn {\n\t\t\tparamsToDelete,\n\t\t\tparamsToSave,\n\t\t\tparamsNotToSave,\n\t\t\tintersection,\n\t\t};\n\t}\n\n\t#getCompatibilityPopup(compatibilityResult: CheckCompatibilityResult, selectedScope: Item): Popup\n\t{\n\t\tlet paramsToDeleteText = null;\n\t\tif (compatibilityResult.paramsToDelete.size > 0)\n\t\t{\n\t\t\tconst paramsToDeleteNames = [];\n\t\t\tcompatibilityResult.paramsToDelete.forEach((param) => paramsToDeleteNames.push(this.#getItemTitle(param).title));\n\n\t\t\tparamsToDeleteText = Tag.render`\n\t\t\t\t<li>\n\t\t\t\t\t${Loc.getMessagePlural(\n\t\t\t\t\t\t'DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_PARAMS_TO_DELETE',\n\t\t\t\t\t\tparamsToDeleteNames.length,\n\t\t\t\t\t\t{ '#PARAMS_TO_DELETE#': paramsToDeleteNames.join(', ') },\n\t\t\t\t\t)}\n\t\t\t\t</li>\n\t\t\t`;\n\t\t}\n\n\t\tlet paramsNotToSaveText = null;\n\t\tif (compatibilityResult.paramsNotToSave.size > 0)\n\t\t{\n\t\t\tconst paramsNotToSaveNames = [];\n\t\t\tcompatibilityResult.paramsNotToSave.forEach((param) => paramsNotToSaveNames.push(this.#getItemTitle(param).title));\n\t\t\tparamsNotToSaveText = Tag.render`\n\t\t\t\t<li>\n\t\t\t\t\t${Loc.getMessagePlural(\n\t\t\t\t\t\t'DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_PARAMS_NOT_TO_SAVE',\n\t\t\t\t\t\tparamsNotToSaveNames.length,\n\t\t\t\t\t\t{ '#PARAMS_NOT_TO_SAVE#': paramsNotToSaveNames.join(', ') },\n\t\t\t\t\t)}\n\t\t\t\t</li>\n\t\t\t`;\n\t\t}\n\n\t\tconst content = Tag.render`\n\t\t\t<div class=\"compatibility-params\">\n\t\t\t\t<div class=\"compatibility-params-title\">\n\t\t\t\t\t${Loc.getMessage('DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_TITLE')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"compatibility-params-content\">\n\t\t\t\t\t${Loc.getMessage('DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_CONTENT')}\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t${paramsToDeleteText}\n\t\t\t\t\t\t${paramsNotToSaveText}\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst popup = new Popup({\n\t\t\twidth: 330,\n\t\t\tpadding: 14,\n\t\t\toverlay: true,\n\t\t\tcacheable: false,\n\t\t\tcontent,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_BUTTON_CANCEL'),\n\t\t\t\t\tcolor: Button.Color.PRIMARY,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tselectedScope.deselect();\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('DASHBOARD_PARAMS_SELECTOR_PARAMS_COMPATIBILITY_POPUP_BUTTON_CONFIRM'),\n\t\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\tselectedScope.select(true);\n\t\t\t\t\t\tthis.#onScopeAdd(compatibilityResult);\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\treturn popup;\n\t}\n\n\t#onScopeAdd(compatibilityResult: CheckCompatibilityResult): void\n\t{\n\t\tconst dialogItems = this.#paramsSelector.getDialog().getItems();\n\t\tconst availableParams = this.#getAvailableParamsByScope(this.#scopes);\n\n\t\tdialogItems.forEach((item: Item) => {\n\t\t\tif (\n\t\t\t\tcompatibilityResult.paramsToDelete.has(item.getId())\n\t\t\t\t|| !availableParams.has(item.getId())\n\t\t\t)\n\t\t\t{\n\t\t\t\titem.deselect();\n\t\t\t\titem.setTextColor('#B0B6BB');\n\t\t\t\titem.customData.set('isAvailable', false);\n\t\t\t}\n\t\t});\n\n\t\tcompatibilityResult.paramsToSave.values().forEach((param) => {\n\t\t\tconst item = this.#paramsSelector.getDialog().getItem(['biconnector-superset-params', param]);\n\t\t\tif (item)\n\t\t\t{\n\t\t\t\titem.customData.set('isAvailable', true);\n\t\t\t\titem.setTextColor('#535C69');\n\t\t\t\titem.select(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst itemText = this.#getItemTitle(param);\n\t\t\t\tthis.#paramsSelector.getDialog().addItem({\n\t\t\t\t\tid: param,\n\t\t\t\t\ttitle: itemText.title,\n\t\t\t\t\tentityId: 'biconnector-superset-params',\n\t\t\t\t\tsupertitle: itemText.supertitle,\n\t\t\t\t\ttabs: 'params',\n\t\t\t\t\tselected: true,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tcompatibilityResult.paramsNotToSave.values().forEach((param) => {\n\t\t\tconst itemText = this.#getItemTitle(param);\n\t\t\tthis.#paramsSelector.getDialog().addItem({\n\t\t\t\tid: param,\n\t\t\t\ttitle: itemText.title,\n\t\t\t\tentityId: 'biconnector-superset-params',\n\t\t\t\tsupertitle: itemText.supertitle,\n\t\t\t\ttabs: 'params',\n\t\t\t\ttextColor: '#B0B6BB',\n\t\t\t\tcustomData: {\n\t\t\t\t\tisAvailable: false,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#onScopeRemove()\n\t{\n\t\tconst availableParams = this.#getAvailableParamsByScope(this.#scopes);\n\n\t\tavailableParams.values().forEach((param) => {\n\t\t\tconst item = this.#paramsSelector.getDialog().getItem(['biconnector-superset-params', param]);\n\t\t\tif (item)\n\t\t\t{\n\t\t\t\titem.customData.set('isAvailable', true);\n\t\t\t\titem.setTextColor('#535C69');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst itemText = this.#getItemTitle(param);\n\t\t\t\tthis.#paramsSelector.getDialog().addItem({\n\t\t\t\t\tid: param,\n\t\t\t\t\ttitle: itemText.title,\n\t\t\t\t\tentityId: 'biconnector-superset-params',\n\t\t\t\t\tsupertitle: itemText.supertitle,\n\t\t\t\t\ttabs: 'params',\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tconst dialogItems = this.#paramsSelector.getDialog().getItems();\n\t\tdialogItems.forEach((item: Item) => {\n\t\t\tif (!availableParams.has(item.getId()))\n\t\t\t{\n\t\t\t\titem.deselect();\n\t\t\t\tthis.#paramsSelector.getDialog().removeItem(item);\n\t\t\t}\n\t\t});\n\t}\n\n\t#getAvailableParamsByScope(scopes: Set): Set\n\t{\n\t\tconst globalParamsCodes = this.#getGlobalParamsCodes();\n\t\tif (scopes.size === 0)\n\t\t{\n\t\t\treturn globalParamsCodes;\n\t\t}\n\n\t\tlet availableParams: ?Set = null;\n\t\tscopes.forEach((scope) => {\n\t\t\tif (availableParams === null)\n\t\t\t{\n\t\t\t\tavailableParams = new Set((this.#scopeParamsMap[scope] ?? []).map((item) => item.code));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tavailableParams = availableParams.intersection(new Set((this.#scopeParamsMap[scope] ?? []).map((item) => item.code)));\n\t\t\t}\n\t\t});\n\n\t\tglobalParamsCodes.values().forEach((globalParam) => availableParams.add(globalParam));\n\n\t\treturn availableParams;\n\t}\n\n\t#getGlobalParamsCodes(): Set<string>\n\t{\n\t\tconst result = [];\n\t\tconst globalParams = this.#scopeParamsMap.global ?? [];\n\t\tglobalParams.forEach((param: Parameter) => result.push(param.code));\n\n\t\treturn new Set(result);\n\t}\n\n\t#getItemTitle(paramCode: string): {title: string, supertitle: string}\n\t{\n\t\tlet paramTitle = paramCode;\n\t\tconst paramScopes = new Set();\n\n\t\tthis.#scopeParamsMap.global.forEach((mapParam) => {\n\t\t\tif (paramCode === mapParam.code)\n\t\t\t{\n\t\t\t\tparamTitle = mapParam.title;\n\t\t\t\tparamScopes.add('global');\n\t\t\t}\n\t\t});\n\n\t\tObject.keys(this.#scopeParamsMap).forEach((scope) => {\n\t\t\t(this.#scopeParamsMap[scope] ?? []).forEach((mapParam) => {\n\t\t\t\tif (paramCode === mapParam.code)\n\t\t\t\t{\n\t\t\t\t\tparamTitle = mapParam.title;\n\t\t\t\t\tif (!paramScopes.has('global'))\n\t\t\t\t\t{\n\t\t\t\t\t\tparamScopes.add(scope);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tconst scopeNames = [];\n\t\tthis.#scopeSelector.getDialog().getItems().forEach((scopeItem) => {\n\t\t\tif (paramScopes.has(scopeItem.getId()))\n\t\t\t{\n\t\t\t\tscopeNames.push(scopeItem.getTitle());\n\t\t\t}\n\t\t});\n\n\t\tif (paramScopes.has('global'))\n\t\t{\n\t\t\tscopeNames.push(Loc.getMessage('DASHBOARD_PARAMS_SELECTOR_PARAMS_GLOBAL'));\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: paramTitle,\n\t\t\tsupertitle: scopeNames.join(', '),\n\t\t};\n\t}\n\n\t#onChange()\n\t{\n\t\tconst isScopeChanged =\n\t\t\tthis.#scopes.size !== this.#initialScopes.size\n\t\t\t|| [...this.#scopes].some((scope) => !this.#initialScopes.has(scope))\n\t\t;\n\n\t\tconst isParamsChanged =\n\t\t\tthis.#params.size !== this.#initialParams.size\n\t\t\t|| [...this.#params].some((param) => !this.#initialParams.has(param))\n\t\t;\n\n\t\tconst isChanged = isScopeChanged || isParamsChanged;\n\n\t\tEventEmitter.emit('BIConnector.DashboardParamsSelector:onChange', { isChanged });\n\t}\n\n\t#openParamListSlider()\n\t{\n\t\tconst componentLink = '/bitrix/components/bitrix/biconnector.apachesuperset.dashboard.url.parameter.list/slider.php';\n\t\tconst sliderLink = new Uri(componentLink);\n\n\t\tBX.SidePanel.Instance.open(\n\t\t\tsliderLink.toString(),\n\t\t\t{\n\t\t\t\twidth: 600,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t},\n\t\t);\n\t}\n}\n"],"names":["DashboardParametersSelector","params","babelHelpers","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","writable","value","scopes","Set","scopeParamsMap","EventEmitter","subscribe","_classPrivateMethodGet","bind","this","key","paramsHintText","Loc","getMessage","[link]","[/link]","container","Tag","render","BX","UI","Hint","init","renderTo","querySelector","TagSelector","locked","Event","preselectedItems","hasSelectedAutomatedSolutions","forEach","scope","startsWith","push","selector","multiple","dialogOptions","id","context","enableSearch","dropdownMode","showAvatars","compactView","dynamicLoad","preload","width","height","entities","options","events","onLoad","event","itemNode","getTarget","_event$getTarget","getItems","find","item","getId","getNodes","_automatedSolutionIte","values","_automatedSolutionIte2","next","_automatedSolutionIte3","setOpen","emit","Item:onSelect","getData","compatibilityResult","_this","paramsToDelete","size","paramsNotToSave","show","onBeforeTagAdd","tag","add","onBeforeTagRemove","onAfterTagRemove","Dom","addClass","getDialog","getContainer","clean","document","items","availableParams","param","itemTitle","_this2","code","isAvailable","has","entityId","title","supertitle","tabs","customData","textColor","global","tagItems","Item:onBeforeSelect","getCustomData","get","Notification","Center","notify","content","preventDefault","addedScope","_map","_babelHelpers$classPr3","_this3","newParamCodes","paramsToSave","intersection","firstScope","availableParamsWithOldScopes","map","scopeParams","currentParamCodes","globalParams","difference","union","selectedScope","paramsToDeleteText","paramsToDeleteNames","_this4","getMessagePlural","length","#PARAMS_TO_DELETE#","join","paramsNotToSaveText","paramsNotToSaveNames","#PARAMS_NOT_TO_SAVE#","popup","Popup","padding","overlay","cacheable","buttons","Button","text","color","Color","PRIMARY","onclick","deselect","close","LIGHT_BORDER","select","dialogItems","setTextColor","set","getItem","itemText","_this5","addItem","selected","_this6","removeItem","globalParamsCodes","globalParam","result","paramCode","paramTitle","paramScopes","mapParam","Object","keys","scopeNames","scopeItem","getTitle","isScopeChanged","some","isParamsChanged","isChanged","sliderLink","Uri","SidePanel","Instance","open","toString","allowChangeHistory"],"mappings":"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"}