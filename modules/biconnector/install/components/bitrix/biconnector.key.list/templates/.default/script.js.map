{"version":3,"file":"script.js","sources":["src/grid.js"],"sourcesContent":["import {Loc, ajax} from 'main.core';\nimport {PopupWindowManager} from 'main.popup';\nimport {Guide} from 'ui.tour';\n\ntype KeyGridOptions = {\n\tbindElement: HTMLElement,\n\tarticle: string,\n}\n\nexport class KeysGrid\n{\n\tstatic gridId: string = 'biconnector_key_list';\n\tstatic componentName = 'bitrix:biconnector.key.list';\n\t#options: KeyGridOptions;\n\t#spotLight: ?BX.SpotLight;\n\t#guide: ?Guide;\n\n\tconstructor(options: KeyGridOptions)\n\t{\n\t\tthis.#options = options;\n\t}\n\n\tstatic deleteRow(id: number): void\n\t{\n\t\tconst grid = BX.Main.gridManager.getInstanceById(KeysGrid.gridId);\n\t\tgrid.confirmDialog({\n\t\t\tCONFIRM: true,\n\t\t\tCONFIRM_MESSAGE: Loc.getMessage('CC_BBKL_ACTION_MENU_DELETE_CONF'),\n\t\t}, () => {\n\t\t\tajax.runComponentAction(KeysGrid.componentName, 'deleteRow', {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tid: id,\n\t\t\t\t}\n\t\t\t}).then(() => {\n\t\t\t\tgrid.removeRow(id);\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic activateKey(id: number, switcher: BX.UI.Switcher): void\n\t{\n\t\tajax.runComponentAction(KeysGrid.componentName, 'activateKey', {\n\t\t\tmode: 'class',\n\t\t\tdata: {\n\t\t\t\tid: id,\n\t\t\t}\n\t\t}).then((response) => {\n\t\t\tif (response.data === false)\n\t\t\t{\n\t\t\t\tswitcher.check(false, false);\n\t\t\t\tthis.#showNotifyKeySwitcherError(false);\n\t\t\t}\n\t\t}).catch(() => {\n\t\t\tswitcher.check(false, false);\n\t\t\tthis.#showNotifyKeySwitcherError(false);\n\t\t});\n\t}\n\n\tstatic deactivateKey(id: number, switcher: BX.UI.Switcher): void\n\t{\n\t\tajax.runComponentAction('bitrix:biconnector.key.list', 'deactivateKey', {\n\t\t\tmode: 'class',\n\t\t\tdata: {\n\t\t\t\tid: id,\n\t\t\t}\n\t\t}).then((response) => {\n\t\t\tif (response.data === false)\n\t\t\t{\n\t\t\t\tswitcher.check(true, false);\n\t\t\t\tthis.#showNotifyKeySwitcherError();\n\t\t\t}\n\t\t}).catch(() => {\n\t\t\tswitcher.check(true, false);\n\t\t\tthis.#showNotifyKeySwitcherError();\n\t\t});\n\t}\n\n\tstatic copyKey(elementWrapper: HTMLElement): void\n\t{\n\t\tconst access_key = elementWrapper.querySelector('[data-key-id]');\n\t\tconst textarea = document.createElement('textarea');\n\t\ttextarea.value = access_key.value;\n\t\ttextarea.setAttribute('readonly', '');\n\t\ttextarea.style.position = 'absolute';\n\t\ttextarea.style.left = '-9999px';\n\t\tdocument.body.appendChild(textarea);\n\t\ttextarea.select();\n\n\t\ttry {\n\t\t\tdocument.execCommand('copy');\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('CC_BBKL_KEY_COPIED'),\n\t\t\t\tautoHideDelay: 2000,\n\t\t\t});\n\t\t}\n\t\tcatch(error)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('CC_BBKL_KEY_COPY_ERROR'),\n\t\t\t\tautoHideDelay: 2000,\n\t\t\t});\n\t\t}\n\n\t\ttextarea.remove();\n\n\t\treturn false;\n\t}\n\n\tstatic #showNotifyKeySwitcherError(): void\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('CC_BBKL_ACTIVATE_KEY_ERROR'),\n\t\t\tautoHideDelay: 2000,\n\t\t});\n\t}\n\n\tshowOnboarding(): void\n\t{\n\t\tif (!(PopupWindowManager && PopupWindowManager.isAnyPopupShown()))\n\t\t{\n\t\t\tthis.#getSpotlight().show();\n\t\t\tthis.#getGuide().start();\n\t\t\tthis.#getSpotlight().getTargetContainer().addEventListener('mouseover', () => {\n\t\t\t\tthis.#getSpotlight().close();\n\t\t\t});\n\t\t}\n\t}\n\n\t#getSpotlight(): BX.SpotLight\n\t{\n\t\tif (this.#spotLight)\n\t\t{\n\t\t\treturn this.#spotLight;\n\t\t}\n\n\t\tthis.#spotLight = new BX.SpotLight({\n\t\t\ttargetElement: this.#options.bindElement,\n\t\t\ttargetVertex: 'middle-center',\n\t\t\tid: KeysGrid.gridId,\n\t\t\tlightMode: true,\n\t\t});\n\n\t\treturn this.#spotLight;\n\t}\n\n\t#getGuide(): Guide\n\t{\n\t\tif (this.#guide)\n\t\t{\n\t\t\treturn this.#guide;\n\t\t}\n\n\t\tthis.#guide = new Guide({\n\t\t\tsimpleMode: true,\n\t\t\tonEvents: true,\n\t\t\toverlay: false,\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.#options.bindElement,\n\t\t\t\t\ttitle: Loc.getMessage('CC_BBKL_KEY_ONBOARDING_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('CC_BBKL_KEY_ONBOARDING_DESCRIPTION'),\n\t\t\t\t\tbuttons: null,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\tthis.#getSpotlight().close();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonShow: () => {\n\t\t\t\t\t\t\tajax.runComponentAction(KeysGrid.componentName, 'markShowOnboarding', {\n\t\t\t\t\t\t\t\tmode: 'class'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tarticle: this.#options.article,\n\t\t\t\t},\n\t\t\t],\n\t\t\tautoHide: true,\n\t\t});\n\t\tthis.#guide.getPopup().setWidth(360);\n\t\tthis.#guide.getPopup().setAngle({\n\t\t\toffset: this.#options.bindElement.offsetWidth / 2,\n\t\t});\n\t\tthis.#guide.getPopup().setAutoHide(true);\n\n\t\treturn this.#guide;\n\t}\n}"],"names":["KeysGrid","options","PopupWindowManager","isAnyPopupShown","show","start","getTargetContainer","addEventListener","close","id","grid","BX","Main","gridManager","getInstanceById","gridId","confirmDialog","CONFIRM","CONFIRM_MESSAGE","Loc","getMessage","ajax","runComponentAction","componentName","mode","data","then","removeRow","switcher","response","check","elementWrapper","access_key","querySelector","textarea","document","createElement","value","setAttribute","style","position","left","body","appendChild","select","execCommand","UI","Notification","Center","notify","content","autoHideDelay","error","remove","SpotLight","targetElement","bindElement","targetVertex","lightMode","Guide","simpleMode","onEvents","overlay","steps","target","title","text","buttons","events","onClose","onShow","article","autoHide","getPopup","setWidth","setAngle","offset","offsetWidth","setAutoHide"],"mappings":"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"}