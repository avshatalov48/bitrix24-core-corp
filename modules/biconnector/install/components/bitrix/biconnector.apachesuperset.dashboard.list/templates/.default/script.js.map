{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Loc, Type, Tag, Reflection, Dom, Text, Event } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\nimport { DashboardManager } from 'biconnector.apache-superset-dashboard-manager';\nimport { EventEmitter } from 'main.core.events';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { ApacheSupersetAnalytics } from 'biconnector.apache-superset-analytics';\nimport type { DashboardAnalyticInfo } from 'biconnector.apache-superset-analytics';\n\ntype Props = {\n\tgridId: ?string,\n};\n\ntype LoginPopupParams = {\n\tdashboardId: number,\n\ttype: string,\n\teditUrl: string,\n\tappId: string,\n};\n\nclass SupersetDashboardGridManager\n{\n\t#dashboardManager: DashboardManager = null;\n\t#grid: BX.Main.grid;\n\n\tconstructor(props: Props)\n\t{\n\t\tthis.#dashboardManager = new DashboardManager();\n\n\t\tthis.#grid = BX.Main.gridManager.getById(props.gridId)?.instance;\n\t\tthis.#subscribeToEvents();\n\t}\n\n\t#subscribeToEvents()\n\t{\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', (event) => {\n\t\t\tconst [sliderEvent] = event.getCompatData();\n\n\t\t\tif (sliderEvent.getEventId() === 'BIConnector.Superset.DashboardDetail:onDashboardBatchStatusUpdate')\n\t\t\t{\n\t\t\t\tconst eventArgs = sliderEvent.getData();\n\t\t\t\tif (eventArgs.dashboardList)\n\t\t\t\t{\n\t\t\t\t\tthis.onUpdatedDashboardBatchStatus(eventArgs.dashboardList);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate', (event) => {\n\t\t\tconst data = event.getData();\n\t\t\tif (!data.dashboardList)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst dashboardList = data.dashboardList;\n\t\t\tthis.onUpdatedDashboardBatchStatus(dashboardList);\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Rest.Configuration.Install:onFinish', () => {\n\t\t\tthis.#grid.reload();\n\t\t});\n\t}\n\n\tonUpdatedDashboardBatchStatus(dashboardList: Array)\n\t{\n\t\tfor (const dashboard of dashboardList)\n\t\t{\n\t\t\tthis.updateDashboardStatus(dashboard.id, dashboard.status);\n\t\t}\n\t}\n\n\tgetGrid(): BX.Main.grid\n\t{\n\t\treturn this.#grid;\n\t}\n\n\t/**\n\t * @param params LoginPopupParams\n\t * @param openedFrom\n\t */\n\tshowLoginPopup(params: LoginPopupParams, openedFrom: string = 'unknown')\n\t{\n\t\tconst grid = this.getGrid();\n\t\tif (params.type === 'CUSTOM')\n\t\t{\n\t\t\tgrid.tableFade();\n\t\t}\n\n\t\tthis.#dashboardManager.processEditDashboard(\n\t\t\t{\n\t\t\t\tid: params.dashboardId,\n\t\t\t\ttype: params.type,\n\t\t\t\teditLink: params.editUrl,\n\t\t\t},\n\t\t\t() => {\n\t\t\t\tgrid.tableUnfade();\n\t\t\t},\n\t\t\t(popupType) => {\n\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_edit', {\n\t\t\t\t\tc_sub_section: popupType,\n\t\t\t\t\tc_element: openedFrom,\n\t\t\t\t\ttype: params.type.toLowerCase(),\n\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(params.appId),\n\t\t\t\t\tp2: params.dashboardId,\n\t\t\t\t\tstatus: 'success',\n\t\t\t\t});\n\t\t\t},\n\t\t\t(popupType) => {\n\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_edit', {\n\t\t\t\t\tc_sub_section: popupType,\n\t\t\t\t\tc_element: openedFrom,\n\t\t\t\t\ttype: params.type.toLowerCase(),\n\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(params.appId),\n\t\t\t\t\tp2: params.dashboardId,\n\t\t\t\t\tstatus: 'error',\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\t}\n\n\trestartDashboardLoad(dashboardId: number): void\n\t{\n\t\tconst row = this.#grid.getRows().getById(dashboardId);\n\t\tif (row)\n\t\t{\n\t\t\tconst btn = row.node.querySelector('#restart-dashboard-load-btn');\n\t\t\tif (Type.isDomNode(btn))\n\t\t\t{\n\t\t\t\tconst isDisabled = btn.getAttribute('disabled');\n\t\t\t\tif (isDisabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tbtn.setAttribute('disabled', 'true');\n\t\t\t\tDom.addClass(btn, 'dashboard-status-label-error-btn__loading');\n\t\t\t}\n\t\t}\n\n\t\tthis.#dashboardManager.restartDashboardImport(dashboardId).then(\n\t\t\t(response) => {\n\t\t\t\tconst dashboardIds = response?.data?.restartedDashboardIds;\n\t\t\t\tif (!dashboardIds)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfor (const restartedDashboardId of dashboardIds)\n\t\t\t\t{\n\t\t\t\t\tthis.updateDashboardStatus(restartedDashboardId, 'L');\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tsetDashboardStatusReady(dashboardId: number): void\n\t{\n\t\tconst row = this.#grid.getRows().getById(dashboardId);\n\t\tif (row)\n\t\t{\n\t\t\tconst label = row.node.getElementsByClassName('dashboard-status-label')[0];\n\t\t\tDom.addClass(label, 'ui-label-success');\n\t\t\tDom.removeClass(label, 'ui-label-primary');\n\t\t\tlabel.querySelector('span').innerText = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_READY');\n\t\t}\n\t}\n\n\tupdateDashboardStatus(dashboardId: number, status: string): void\n\t{\n\t\tconst row = this.#grid.getRows().getById(dashboardId);\n\t\tif (row)\n\t\t{\n\t\t\tconst labelWrapper = row.node.querySelector('.dashboard-status-label-wrapper');\n\t\t\tconst label = labelWrapper.querySelector('.dashboard-status-label');\n\t\t\tconst reloadBtn = labelWrapper.querySelector('#restart-dashboard-load-btn');\n\n\t\t\tswitch (status) {\n\t\t\t\tcase DashboardManager.DASHBOARD_STATUS_READY:\n\t\t\t\t\tif (reloadBtn)\n\t\t\t\t\t{\n\t\t\t\t\t\treloadBtn.remove();\n\t\t\t\t\t}\n\t\t\t\t\tDom.addClass(label, 'ui-label-success');\n\t\t\t\t\tDom.removeClass(label, 'ui-label-primary');\n\t\t\t\t\tDom.removeClass(label, 'ui-label-danger');\n\t\t\t\t\tlabel.querySelector('span').innerText = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_READY');\n\t\t\t\t\tbreak;\n\t\t\t\tcase DashboardManager.DASHBOARD_STATUS_LOAD:\n\t\t\t\t\tif (reloadBtn)\n\t\t\t\t\t{\n\t\t\t\t\t\treloadBtn.remove();\n\t\t\t\t\t}\n\t\t\t\t\tDom.addClass(label, 'ui-label-primary');\n\t\t\t\t\tDom.removeClass(label, 'ui-label-success');\n\t\t\t\t\tDom.removeClass(label, 'ui-label-danger');\n\t\t\t\t\tlabel.querySelector('span').innerText = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_LOAD');\n\t\t\t\t\tbreak;\n\t\t\t\tcase DashboardManager.DASHBOARD_STATUS_FAILED:\n\t\t\t\t\tif (!reloadBtn)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst createdReloadBtn = this.createReloadBtn(dashboardId);\n\t\t\t\t\t\tDom.append(createdReloadBtn, labelWrapper);\n\t\t\t\t\t}\n\t\t\t\t\tDom.addClass(label, 'ui-label-danger');\n\t\t\t\t\tDom.removeClass(label, 'ui-label-success');\n\t\t\t\t\tDom.removeClass(label, 'ui-label-primary');\n\t\t\t\t\tlabel.querySelector('span').innerText = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_FAILED');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tcreateReloadBtn(dashboardId: number): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div id=\"restart-dashboard-load-btn\" onclick=\"BX.BIConnector.SupersetDashboardGridManager.Instance.restartDashboardLoad(${dashboardId})\" class=\"dashboard-status-label-error-btn\">\n\t\t\t\t<div class=\"ui-icon-set --refresh-5 dashboard-status-label-error-icon\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tduplicateDashboard(dashboardId: number, analyticInfo: DashboardAnalyticInfo = null): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tgrid.tableFade();\n\n\t\treturn this.#dashboardManager.duplicateDashboard(dashboardId)\n\t\t\t.then((response) => {\n\t\t\t\tconst gridRealtime: BX.Grid.Realtime = grid.getRealtime();\n\t\t\t\tconst newDashboard = response.data.dashboard;\n\n\t\t\t\tgridRealtime.addRow({\n\t\t\t\t\tid: newDashboard.id,\n\t\t\t\t\tprepend: true,\n\t\t\t\t\tcolumns: newDashboard.columns,\n\t\t\t\t\tactions: newDashboard.actions,\n\t\t\t\t});\n\n\t\t\t\tconst editableData = grid.getParam('EDITABLE_DATA');\n\t\t\t\tif (BX.type.isPlainObject(editableData))\n\t\t\t\t{\n\t\t\t\t\teditableData[newDashboard.id] = { TITLE: newDashboard.title };\n\t\t\t\t}\n\n\t\t\t\tgrid.tableUnfade();\n\t\t\t\tconst counterTotalTextContainer = grid.getCounterTotal().querySelector('.main-grid-panel-content-text');\n\t\t\t\tcounterTotalTextContainer.textContent++;\n\n\t\t\t\tBX.UI.Hint.init(BX('biconnector-dashboard-grid'));\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_COPY_NOTIFICATION_ADDED'),\n\t\t\t\t});\n\n\t\t\t\tif (analyticInfo !== null)\n\t\t\t\t{\n\t\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_copy', {\n\t\t\t\t\t\ttype: analyticInfo.type,\n\t\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(analyticInfo.appId),\n\t\t\t\t\t\tp2: dashboardId,\n\t\t\t\t\t\tstatus: 'success',\n\t\t\t\t\t\tc_element: analyticInfo.from,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tgrid.tableUnfade();\n\t\t\t\tif (response.errors)\n\t\t\t\t{\n\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t}\n\n\t\t\t\tif (analyticInfo !== null)\n\t\t\t\t{\n\t\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_copy', {\n\t\t\t\t\t\ttype: analyticInfo.type,\n\t\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(analyticInfo.appId),\n\t\t\t\t\t\tp2: dashboardId,\n\t\t\t\t\t\tstatus: 'error',\n\t\t\t\t\t\tc_element: analyticInfo.from,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t#notifyErrors(errors: Array): void\n\t{\n\t\tif (errors[0] && errors[0].message)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(errors[0].message),\n\t\t\t});\n\t\t}\n\t}\n\n\texportDashboard(dashboardId: number, analyticInfo: DashboardAnalyticInfo = null): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tgrid.tableFade();\n\n\t\treturn this.#dashboardManager.exportDashboard(\n\t\t\tdashboardId,\n\t\t\t() => {\n\t\t\t\tgrid.tableUnfade();\n\t\t\t\tif (analyticInfo !== null)\n\t\t\t\t{\n\t\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_export', {\n\t\t\t\t\t\ttype: analyticInfo.type,\n\t\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(analyticInfo.appId),\n\t\t\t\t\t\tp2: dashboardId,\n\t\t\t\t\t\tstatus: 'success',\n\t\t\t\t\t\tc_element: analyticInfo.from,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t() => {\n\t\t\t\tgrid.tableUnfade();\n\t\t\t\tif (analyticInfo !== null)\n\t\t\t\t{\n\t\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_export', {\n\t\t\t\t\t\ttype: analyticInfo.type,\n\t\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(analyticInfo.appId),\n\t\t\t\t\t\tp2: dashboardId,\n\t\t\t\t\t\tstatus: 'error',\n\t\t\t\t\t\tc_element: analyticInfo.from,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tdeleteDashboard(dashboardId: number): void\n\t{\n\t\tMessageBox.confirm(\n\t\t\tLoc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_TITLE'),\n\t\t\t(messageBox, button) => {\n\t\t\t\tbutton.setWaiting();\n\t\t\t\tthis.#dashboardManager.deleteDashboard(dashboardId)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tthis.getGrid().reload();\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\tif (response.errors)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t},\n\t\t\tLoc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_CAPTION_YES'),\n\t\t\t(messageBox) => messageBox.close(),\n\t\t\tLoc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_CAPTION_NO'),\n\t\t);\n\t}\n\n\tcreateEmptyDashboard()\n\t{\n\t\tBX.BIConnector.ApacheSupersetAnalytics.sendAnalytics('new', 'report_new', {\n\t\t\ttype: 'custom',\n\t\t\tc_element: 'new_button',\n\t\t});\n\n\t\tconst grid = this.getGrid();\n\t\tgrid.tableFade();\n\t\tthis.#dashboardManager.createEmptyDashboard()\n\t\t\t.then((response) => {\n\t\t\t\tgrid.tableUnfade();\n\t\t\t\tconst gridRealtime: BX.Grid.Realtime = grid.getRealtime();\n\t\t\t\tconst newDashboard = response.data.dashboard;\n\t\t\t\tgridRealtime.addRow({\n\t\t\t\t\tid: newDashboard.id,\n\t\t\t\t\tprepend: true,\n\t\t\t\t\tcolumns: newDashboard.columns,\n\t\t\t\t\tactions: newDashboard.actions,\n\t\t\t\t});\n\n\t\t\t\tconst editableData = grid.getParam('EDITABLE_DATA');\n\t\t\t\tif (BX.type.isPlainObject(editableData))\n\t\t\t\t{\n\t\t\t\t\teditableData[newDashboard.id] = { TITLE: newDashboard.title };\n\t\t\t\t}\n\n\t\t\t\tgrid.tableUnfade();\n\t\t\t\tconst counterTotalTextContainer = grid.getCounterTotal().querySelector('.main-grid-panel-content-text');\n\t\t\t\tcounterTotalTextContainer.textContent++;\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tgrid.tableUnfade();\n\n\t\t\t\tif (response.errors)\n\t\t\t\t{\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_CREATE_EMPTY_NOTIFICATION_ERROR'),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t#buildDashboardTitleEditor(\n\t\tid: number,\n\t\ttitle: string,\n\t\tonCancel: () => void,\n\t\tonSave: (innerTitle: string) => void,\n\t): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input class=\"main-grid-editor main-grid-editor-text\" type=\"text\">\n\t\t`;\n\t\tinput.value = title;\n\n\t\tconst saveInputValue = () => {\n\t\t\tconst value = input.value;\n\t\t\tDom.removeClass(input, 'dashboard-title-input-danger');\n\t\t\tif (value.trim() === '')\n\t\t\t{\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_CHANGE_TITLE_ERROR_EMPTY'),\n\t\t\t\t});\n\n\t\t\t\tDom.addClass(input, 'dashboard-title-input-danger');\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tDom.style(buttons, 'display', 'none');\n\t\t\tDom.attr(input, 'disabled', true);\n\t\t\tonSave(input.value);\n\t\t};\n\n\t\tEvent.bind(input, 'keydown', (event) => {\n\t\t\tif (event.keyCode === 13)\n\t\t\t{\n\t\t\t\tsaveInputValue();\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t\telse if (event.keyCode === 27)\n\t\t\t{\n\t\t\t\tonCancel();\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t});\n\n\t\tconst applyButton = Tag.render`\n\t\t\t<a>\n\t\t\t\t<i\n\t\t\t\t\tclass=\"ui-icon-set --check\"\n\t\t\t\t\tstyle=\"--ui-icon-set__icon-size: 21px; --ui-icon-set__icon-color: var(--ui-color-palette-gray-40);\"\n\t\t\t\t></i>\n\t\t\t</a>\n\t\t`;\n\n\t\tconst cancelButton = Tag.render`\n\t\t\t<a>\n\t\t\t\t<i\n\t\t\t\t\tclass=\"ui-icon-set --cross-60\"\n\t\t\t\t\tstyle=\"--ui-icon-set__icon-size: 21px; --ui-icon-set__icon-color: var(--ui-color-palette-gray-40);\"\n\t\t\t\t></i>\n\t\t\t</a>\n\t\t`;\n\n\t\tconst buttons = Tag.render`\n\t\t\t<div class=\"dashboard-title-wrapper__buttons\">\n\t\t\t\t${applyButton}\n\t\t\t\t${cancelButton}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(cancelButton, 'click', () => {\n\t\t\tonCancel();\n\t\t});\n\n\t\tEvent.bind(applyButton, 'click', saveInputValue);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"dashboard-title-wrapper__item dashboard-title-edit\">\n\t\t\t\t${input}\n\t\t\t\t<div class=\"dashboard-title-wrapper__buttons-wrapper\">\n\t\t\t\t\t${buttons}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getTitlePreview(dashboardId: number): ?HTMLElement\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst row = grid.getRows().getById(dashboardId);\n\t\tif (!row)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst wrapper = row.getCellById('TITLE')?.querySelector('.dashboard-title-wrapper');\n\t\tif (!wrapper)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst previewSection = wrapper.querySelector('.dashboard-title-preview');\n\t\tif (previewSection)\n\t\t{\n\t\t\treturn previewSection;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenameDashboard(dashboardId: number): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst row = grid.getRows().getById(dashboardId);\n\t\tif (!row)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst rowNode = row.getNode();\n\t\tDom.removeClass(rowNode, 'dashboard-title-edited');\n\n\t\tconst wrapper = row.getCellById('TITLE')?.querySelector('.dashboard-title-wrapper');\n\t\tif (!wrapper)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst editor = this.#buildDashboardTitleEditor(\n\t\t\tdashboardId,\n\t\t\trow.getEditData().TITLE,\n\t\t\t() => {\n\t\t\t\tthis.cancelRenameDashboard(dashboardId);\n\t\t\t},\n\t\t\t(innerTitle) => {\n\t\t\t\tconst oldTitle = this.#getTitlePreview(dashboardId).querySelector('a').innerText;\n\t\t\t\tthis.#getTitlePreview(dashboardId).querySelector('a').innerText = innerTitle;\n\n\t\t\t\tconst rowEditData = row.getEditData();\n\t\t\t\trowEditData.TITLE = innerTitle;\n\t\t\t\tconst editableData = grid.getParam('EDITABLE_DATA');\n\t\t\t\tif (BX.type.isPlainObject(editableData))\n\t\t\t\t{\n\t\t\t\t\teditableData[row.getId()] = rowEditData;\n\t\t\t\t}\n\n\t\t\t\tDom.addClass(rowNode, 'dashboard-title-edited');\n\t\t\t\tconst msg = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_CHANGE_TITLE_SUCCESS', {\n\t\t\t\t\t'#NEW_TITLE#': Text.encode(innerTitle),\n\t\t\t\t});\n\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: msg,\n\t\t\t\t});\n\n\t\t\t\tthis.cancelRenameDashboard(dashboardId);\n\t\t\t\tthis.#setDateModifyNow(dashboardId);\n\n\t\t\t\tthis.#dashboardManager.renameDashboard(dashboardId, innerTitle)\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tif (response.errors)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.#getTitlePreview(dashboardId).querySelector('a').innerText = oldTitle;\n\t\t\t\t\t\trowEditData.TITLE = oldTitle;\n\t\t\t\t\t});\n\t\t\t},\n\t\t);\n\n\t\tconst preview = wrapper.querySelector('.dashboard-title-preview');\n\t\tif (preview)\n\t\t{\n\t\t\tDom.style(preview, 'display', 'none');\n\t\t}\n\t\tDom.append(editor, wrapper);\n\n\t\tconst editBtn = row.getCellById('EDIT_URL')?.querySelector('a');\n\n\t\tconst actionsClickHandler = () => {\n\t\t\tEvent.unbind(row.getActionsButton(), 'click', actionsClickHandler);\n\t\t\tif (editBtn)\n\t\t\t{\n\t\t\t\tEvent.unbind(editBtn, 'click', actionsClickHandler);\n\t\t\t}\n\t\t\tthis.cancelRenameDashboard(dashboardId);\n\t\t};\n\t\tEvent.bind(row.getActionsButton(), 'click', actionsClickHandler);\n\t\tif (editBtn)\n\t\t{\n\t\t\tEvent.bind(editBtn, 'click', actionsClickHandler);\n\t\t}\n\t}\n\n\tcancelRenameDashboard(dashboardId): void\n\t{\n\t\tconst row = this.getGrid().getRows().getById(dashboardId);\n\t\tif (!row)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst editSection = row.getCellById('TITLE')?.querySelector('.dashboard-title-edit');\n\t\tconst previewSection = row.getCellById('TITLE')?.querySelector('.dashboard-title-preview');\n\n\t\tif (editSection)\n\t\t{\n\t\t\tDom.remove(editSection);\n\t\t}\n\n\t\tif (previewSection)\n\t\t{\n\t\t\tDom.style(previewSection, 'display', 'flex');\n\t\t}\n\t}\n\n\t#setDateModifyNow(dashboardId: number)\n\t{\n\t\tconst dateModifyCell = this.#grid.getRows().getById(dashboardId)?.getCellById('DATE_MODIFY');\n\t\tif (!dateModifyCell)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst cellContent = dateModifyCell.querySelector('.main-grid-cell-content span');\n\n\t\tconst date = DateTimeFormat.format(\n\t\t\tDateTimeFormat.getFormat('FORMAT_DATETIME'),\n\t\t\tMath.floor(Date.now() / 1000),\n\t\t);\n\t\tconst readableDate = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DATE_MODIFY_NOW');\n\t\tconst newCellContent = Tag.render`\n\t\t\t<span data-hint=\"${date}\" data-hint-no-icon data-hint-interactivity>${readableDate}</span>\n\t\t`;\n\n\t\tDom.replace(cellContent, newCellContent);\n\t\tBX.UI.Hint.init(dateModifyCell);\n\t}\n}\n\nReflection.namespace('BX.BIConnector').SupersetDashboardGridManager = SupersetDashboardGridManager;\n"],"names":["SupersetDashboardGridManager","props","DashboardManager","BX","Main","gridManager","getById","gridId","instance","dashboardList","dashboard","updateDashboardStatus","id","status","params","openedFrom","grid","getGrid","type","tableFade","processEditDashboard","dashboardId","editLink","editUrl","tableUnfade","popupType","ApacheSupersetAnalytics","sendAnalytics","c_sub_section","c_element","toLowerCase","p1","buildAppIdForAnalyticRequest","appId","p2","row","getRows","btn","node","querySelector","Type","isDomNode","isDisabled","getAttribute","setAttribute","Dom","addClass","restartDashboardImport","then","response","dashboardIds","data","restartedDashboardIds","restartedDashboardId","label","getElementsByClassName","removeClass","innerText","Loc","getMessage","labelWrapper","reloadBtn","DASHBOARD_STATUS_READY","remove","DASHBOARD_STATUS_LOAD","DASHBOARD_STATUS_FAILED","createdReloadBtn","createReloadBtn","append","Tag","render","analyticInfo","duplicateDashboard","gridRealtime","getRealtime","newDashboard","addRow","prepend","columns","actions","editableData","getParam","isPlainObject","TITLE","title","counterTotalTextContainer","getCounterTotal","textContent","UI","Hint","init","Notification","Center","notify","content","from","errors","exportDashboard","MessageBox","confirm","messageBox","button","setWaiting","deleteDashboard","reload","close","BIConnector","createEmptyDashboard","rowNode","getNode","wrapper","getCellById","editor","getEditData","cancelRenameDashboard","innerTitle","oldTitle","rowEditData","getId","msg","Text","encode","renameDashboard","preview","style","editBtn","actionsClickHandler","Event","unbind","getActionsButton","bind","editSection","previewSection","EventEmitter","subscribe","event","getCompatData","sliderEvent","getEventId","eventArgs","getData","onUpdatedDashboardBatchStatus","message","onCancel","onSave","input","value","saveInputValue","trim","buttons","attr","keyCode","preventDefault","applyButton","cancelButton","dateModifyCell","cellContent","date","DateTimeFormat","format","getFormat","Math","floor","Date","now","readableDate","newCellContent","replace","Reflection","namespace"],"mappings":"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"}