(function(e,t,a,r,n,i,s){"use strict";var o,l,d,c,u,p,b;function v(e,t){var a=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=f(e))||t&&e&&typeof e.length==="number"){if(a)e=a;var r=0;var n=function e(){};return{s:n,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=true,s=false,o;return{s:function t(){a=a.call(e)},n:function e(){var t=a.next();i=t.done;return t},e:function e(t){s=true;o=t},f:function e(){try{if(!i&&a["return"]!=null)a["return"]()}finally{if(s)throw o}}}}function f(e,t){if(!e)return;if(typeof e==="string")return h(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor)a=e.constructor.name;if(a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return h(e,t)}function h(e,t){if(t==null||t>e.length)t=e.length;for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function y(e,t){g(e,t);t.add(e)}function D(e,t,a){g(e,t);t.set(e,a)}function g(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function A(e,t,a){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return a}var T=new WeakMap;var _=new WeakMap;var S=new WeakSet;var m=new WeakSet;var E=new WeakSet;var I=new WeakSet;var R=new WeakSet;var C=function(){function e(t){var a;babelHelpers.classCallCheck(this,e);y(this,R);y(this,I);y(this,E);y(this,m);y(this,S);D(this,T,{writable:true,value:null});D(this,_,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,T,new r.DashboardManager);babelHelpers.classPrivateFieldSet(this,_,(a=BX.Main.gridManager.getById(t.gridId))===null||a===void 0?void 0:a.instance);A(this,S,B).call(this)}babelHelpers.createClass(e,[{key:"onUpdatedDashboardBatchStatus",value:function e(t){var a=v(t),r;try{for(a.s();!(r=a.n()).done;){var n=r.value;this.updateDashboardStatus(n.id,n.status)}}catch(e){a.e(e)}finally{a.f()}}},{key:"getGrid",value:function e(){return babelHelpers.classPrivateFieldGet(this,_)}},{key:"showLoginPopup",value:function e(t){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"unknown";var r=this.getGrid();if(t.type==="CUSTOM"){r.tableFade()}babelHelpers.classPrivateFieldGet(this,T).processEditDashboard({id:t.dashboardId,type:t.type,editLink:t.editUrl},(function(){r.tableUnfade()}),(function(e){s.ApacheSupersetAnalytics.sendAnalytics("edit","report_edit",{c_sub_section:e,c_element:a,type:t.type.toLowerCase(),p1:s.ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(t.appId),p2:t.dashboardId,status:"success"})}),(function(e){s.ApacheSupersetAnalytics.sendAnalytics("edit","report_edit",{c_sub_section:e,c_element:a,type:t.type.toLowerCase(),p1:s.ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(t.appId),p2:t.dashboardId,status:"error"})}))}},{key:"restartDashboardLoad",value:function e(a){var r=this;var n=babelHelpers.classPrivateFieldGet(this,_).getRows().getById(a);if(n){var i=n.node.querySelector("#restart-dashboard-load-btn");if(t.Type.isDomNode(i)){var s=i.getAttribute("disabled");if(s){return}i.setAttribute("disabled","true");t.Dom.addClass(i,"dashboard-status-label-error-btn__loading")}}babelHelpers.classPrivateFieldGet(this,T).restartDashboardImport(a).then((function(e){var t;var a=e===null||e===void 0?void 0:(t=e.data)===null||t===void 0?void 0:t.restartedDashboardIds;if(!a){return}var n=v(a),i;try{for(n.s();!(i=n.n()).done;){var s=i.value;r.updateDashboardStatus(s,"L")}}catch(e){n.e(e)}finally{n.f()}}))}},{key:"setDashboardStatusReady",value:function e(a){var r=babelHelpers.classPrivateFieldGet(this,_).getRows().getById(a);if(r){var n=r.node.getElementsByClassName("dashboard-status-label")[0];t.Dom.addClass(n,"ui-label-success");t.Dom.removeClass(n,"ui-label-primary");n.querySelector("span").innerText=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_READY")}}},{key:"updateDashboardStatus",value:function e(a,n){var i=babelHelpers.classPrivateFieldGet(this,_).getRows().getById(a);if(i){var s=i.node.querySelector(".dashboard-status-label-wrapper");var o=s.querySelector(".dashboard-status-label");var l=s.querySelector("#restart-dashboard-load-btn");switch(n){case r.DashboardManager.DASHBOARD_STATUS_READY:if(l){l.remove()}t.Dom.addClass(o,"ui-label-success");t.Dom.removeClass(o,"ui-label-primary");t.Dom.removeClass(o,"ui-label-danger");o.querySelector("span").innerText=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_READY");break;case r.DashboardManager.DASHBOARD_STATUS_LOAD:if(l){l.remove()}t.Dom.addClass(o,"ui-label-primary");t.Dom.removeClass(o,"ui-label-success");t.Dom.removeClass(o,"ui-label-danger");o.querySelector("span").innerText=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_LOAD");break;case r.DashboardManager.DASHBOARD_STATUS_FAILED:if(!l){var d=this.createReloadBtn(a);t.Dom.append(d,s)}t.Dom.addClass(o,"ui-label-danger");t.Dom.removeClass(o,"ui-label-success");t.Dom.removeClass(o,"ui-label-primary");o.querySelector("span").innerText=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_FAILED");break}}}},{key:"createReloadBtn",value:function e(a){return t.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="restart-dashboard-load-btn" onclick="BX.BIConnector.SupersetDashboardGridManager.Instance.restartDashboardLoad(',')" class="dashboard-status-label-error-btn">\n\t\t\t\t<div class="ui-icon-set --refresh-5 dashboard-status-label-error-icon"></div>\n\t\t\t</div>\n\t\t'])),a)}},{key:"duplicateDashboard",value:function e(a){var r=this;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var i=this.getGrid();i.tableFade();return babelHelpers.classPrivateFieldGet(this,T).duplicateDashboard(a).then((function(e){var r=i.getRealtime();var o=e.data.dashboard;r.addRow({id:o.id,prepend:true,columns:o.columns,actions:o.actions});var l=i.getParam("EDITABLE_DATA");if(BX.type.isPlainObject(l)){l[o.id]={TITLE:o.title}}i.tableUnfade();var d=i.getCounterTotal().querySelector(".main-grid-panel-content-text");d.textContent++;BX.UI.Hint.init(BX("biconnector-dashboard-grid"));BX.UI.Notification.Center.notify({content:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_COPY_NOTIFICATION_ADDED")});if(n!==null){s.ApacheSupersetAnalytics.sendAnalytics("edit","report_copy",{type:n.type,p1:s.ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(n.appId),p2:a,status:"success",c_element:n.from})}}))["catch"]((function(e){i.tableUnfade();if(e.errors){A(r,m,O).call(r,e.errors)}if(n!==null){s.ApacheSupersetAnalytics.sendAnalytics("edit","report_copy",{type:n.type,p1:s.ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(n.appId),p2:a,status:"error",c_element:n.from})}}))}},{key:"exportDashboard",value:function e(t){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var r=this.getGrid();r.tableFade();return babelHelpers.classPrivateFieldGet(this,T).exportDashboard(t,(function(){r.tableUnfade();if(a!==null){s.ApacheSupersetAnalytics.sendAnalytics("edit","report_export",{type:a.type,p1:s.ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(a.appId),p2:t,status:"success",c_element:a.from})}}),(function(){r.tableUnfade();if(a!==null){s.ApacheSupersetAnalytics.sendAnalytics("edit","report_export",{type:a.type,p1:s.ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(a.appId),p2:t,status:"error",c_element:a.from})}}))}},{key:"deleteDashboard",value:function e(a){var r=this;i.MessageBox.confirm(t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_TITLE"),(function(e,t){t.setWaiting();babelHelpers.classPrivateFieldGet(r,T).deleteDashboard(a).then((function(){r.getGrid().reload();e.close()}))["catch"]((function(t){e.close();if(t.errors){A(r,m,O).call(r,t.errors)}}))}),t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_CAPTION_YES"),(function(e){return e.close()}),t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_CAPTION_NO"))}},{key:"createEmptyDashboard",value:function e(){BX.BIConnector.ApacheSupersetAnalytics.sendAnalytics("new","report_new",{type:"custom",c_element:"new_button"});var a=this.getGrid();a.tableFade();babelHelpers.classPrivateFieldGet(this,T).createEmptyDashboard().then((function(e){a.tableUnfade();var t=a.getRealtime();var r=e.data.dashboard;t.addRow({id:r.id,prepend:true,columns:r.columns,actions:r.actions});var n=a.getParam("EDITABLE_DATA");if(BX.type.isPlainObject(n)){n[r.id]={TITLE:r.title}}a.tableUnfade();var i=a.getCounterTotal().querySelector(".main-grid-panel-content-text");i.textContent++}))["catch"]((function(e){a.tableUnfade();if(e.errors){BX.UI.Notification.Center.notify({content:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_CREATE_EMPTY_NOTIFICATION_ERROR")})}}))}},{key:"renameDashboard",value:function e(a){var r,n=this,i;var s=this.getGrid();var o=s.getRows().getById(a);if(!o){return}var l=o.getNode();t.Dom.removeClass(l,"dashboard-title-edited");var d=(r=o.getCellById("TITLE"))===null||r===void 0?void 0:r.querySelector(".dashboard-title-wrapper");if(!d){return}var c=A(this,E,L).call(this,a,o.getEditData().TITLE,(function(){n.cancelRenameDashboard(a)}),(function(e){var r=A(n,I,w).call(n,a).querySelector("a").innerText;A(n,I,w).call(n,a).querySelector("a").innerText=e;var i=o.getEditData();i.TITLE=e;var d=s.getParam("EDITABLE_DATA");if(BX.type.isPlainObject(d)){d[o.getId()]=i}t.Dom.addClass(l,"dashboard-title-edited");var c=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_CHANGE_TITLE_SUCCESS",{"#NEW_TITLE#":t.Text.encode(e)});BX.UI.Notification.Center.notify({content:c});n.cancelRenameDashboard(a);A(n,R,P).call(n,a);babelHelpers.classPrivateFieldGet(n,T).renameDashboard(a,e)["catch"]((function(e){if(e.errors){A(n,m,O).call(n,e.errors)}A(n,I,w).call(n,a).querySelector("a").innerText=r;i.TITLE=r}))}));var u=d.querySelector(".dashboard-title-preview");if(u){t.Dom.style(u,"display","none")}t.Dom.append(c,d);var p=(i=o.getCellById("EDIT_URL"))===null||i===void 0?void 0:i.querySelector("a");var b=function e(){t.Event.unbind(o.getActionsButton(),"click",e);if(p){t.Event.unbind(p,"click",e)}n.cancelRenameDashboard(a)};t.Event.bind(o.getActionsButton(),"click",b);if(p){t.Event.bind(p,"click",b)}}},{key:"cancelRenameDashboard",value:function e(a){var r,n;var i=this.getGrid().getRows().getById(a);if(!i){return}var s=(r=i.getCellById("TITLE"))===null||r===void 0?void 0:r.querySelector(".dashboard-title-edit");var o=(n=i.getCellById("TITLE"))===null||n===void 0?void 0:n.querySelector(".dashboard-title-preview");if(s){t.Dom.remove(s)}if(o){t.Dom.style(o,"display","flex")}}}]);return e}();function B(){var e=this;n.EventEmitter.subscribe("SidePanel.Slider:onMessage",(function(t){var a=t.getCompatData(),r=babelHelpers.slicedToArray(a,1),n=r[0];if(n.getEventId()==="BIConnector.Superset.DashboardDetail:onDashboardBatchStatusUpdate"){var i=n.getData();if(i.dashboardList){e.onUpdatedDashboardBatchStatus(i.dashboardList)}}}));n.EventEmitter.subscribe("BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate",(function(t){var a=t.getData();if(!a.dashboardList){return}var r=a.dashboardList;e.onUpdatedDashboardBatchStatus(r)}));n.EventEmitter.subscribe("BX.Rest.Configuration.Install:onFinish",(function(){babelHelpers.classPrivateFieldGet(e,_).reload()}))}function O(e){if(e[0]&&e[0].message){BX.UI.Notification.Center.notify({content:t.Text.encode(e[0].message)})}}function L(e,a,r,n){var i=t.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input class="main-grid-editor main-grid-editor-text" type="text">\n\t\t'])));i.value=a;var s=function e(){var a=i.value;t.Dom.removeClass(i,"dashboard-title-input-danger");if(a.trim()===""){BX.UI.Notification.Center.notify({content:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_CHANGE_TITLE_ERROR_EMPTY")});t.Dom.addClass(i,"dashboard-title-input-danger");return}t.Dom.style(v,"display","none");t.Dom.attr(i,"disabled",true);n(i.value)};t.Event.bind(i,"keydown",(function(e){if(e.keyCode===13){s();e.preventDefault()}else if(e.keyCode===27){r();e.preventDefault()}}));var o=t.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a>\n\t\t\t\t<i\n\t\t\t\t\tclass="ui-icon-set --check"\n\t\t\t\t\tstyle="--ui-icon-set__icon-size: 21px; --ui-icon-set__icon-color: var(--ui-color-palette-gray-40);"\n\t\t\t\t></i>\n\t\t\t</a>\n\t\t'])));var b=t.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a>\n\t\t\t\t<i\n\t\t\t\t\tclass="ui-icon-set --cross-60"\n\t\t\t\t\tstyle="--ui-icon-set__icon-size: 21px; --ui-icon-set__icon-color: var(--ui-color-palette-gray-40);"\n\t\t\t\t></i>\n\t\t\t</a>\n\t\t'])));var v=t.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="dashboard-title-wrapper__buttons">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),o,b);t.Event.bind(b,"click",(function(){r()}));t.Event.bind(o,"click",s);return t.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="dashboard-title-wrapper__item dashboard-title-edit">\n\t\t\t\t','\n\t\t\t\t<div class="dashboard-title-wrapper__buttons-wrapper">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),i,v)}function w(e){var t;var a=this.getGrid();var r=a.getRows().getById(e);if(!r){return null}var n=(t=r.getCellById("TITLE"))===null||t===void 0?void 0:t.querySelector(".dashboard-title-wrapper");if(!n){return null}var i=n.querySelector(".dashboard-title-preview");if(i){return i}return null}function P(e){var r;var n=(r=babelHelpers.classPrivateFieldGet(this,_).getRows().getById(e))===null||r===void 0?void 0:r.getCellById("DATE_MODIFY");if(!n){return}var i=n.querySelector(".main-grid-cell-content span");var s=a.DateTimeFormat.format(a.DateTimeFormat.getFormat("FORMAT_DATETIME"),Math.floor(Date.now()/1e3));var o=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DATE_MODIFY_NOW");var l=t.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span data-hint="','" data-hint-no-icon data-hint-interactivity>',"</span>\n\t\t"])),s,o);t.Dom.replace(i,l);BX.UI.Hint.init(n)}t.Reflection.namespace("BX.BIConnector").SupersetDashboardGridManager=C})(this.window=this.window||{},BX,BX.Main,BX.BIConnector,BX.Event,BX.UI.Dialogs,BX.BIConnector);
//# sourceMappingURL=script.map.js