this.BX=this.BX||{};(function(e,t){"use strict";var s=babelHelpers.classPrivateFieldLooseKey("loadGis");var o=babelHelpers.classPrivateFieldLooseKey("loadScript");var i=babelHelpers.classPrivateFieldLooseKey("createPicker");var a=babelHelpers.classPrivateFieldLooseKey("showPicker");var r=babelHelpers.classPrivateFieldLooseKey("pickerCallback");var l=babelHelpers.classPrivateFieldLooseKey("convertItem");var c=babelHelpers.classPrivateFieldLooseKey("formatDate");var n=babelHelpers.classPrivateFieldLooseKey("verifyGoogleOAuthToken");class d{constructor(e,d,g,k,P){Object.defineProperty(this,n,{value:y});Object.defineProperty(this,c,{value:w});Object.defineProperty(this,l,{value:v});Object.defineProperty(this,r,{value:u});Object.defineProperty(this,i,{value:b});Object.defineProperty(this,o,{value:h});Object.defineProperty(this,s,{value:p});this.scopes=t.Extension.getSettings("disk.google-drive-picker").get("scopes");this.provider="gdrive";Object.defineProperty(this,a,{writable:true,value:()=>{if(this.oauthToken){const e=window.google.picker.ViewId.DOCS;const s=new window.google.picker.DocsView(e).setParent("root").setMode(window.google.picker.DocsViewMode.LIST).setIncludeFolders(true);const o=(new window.google.picker.PickerBuilder).enableFeature(window.google.picker.Feature.NAV_HIDDEN).setLocale(t.Loc.getMessage("LANGUAGE_ID")).addView(s).setOAuthToken(this.oauthToken).setDeveloperKey(this.apiKey).setAppId(this.appId).setCallback((e=>babelHelpers.classPrivateFieldLooseBase(this,r)[r](e))).enableFeature(window.google.picker.Feature.MULTISELECT_ENABLED).build();o.setVisible(true)}}});this.clientId=e;this.appId=d;this.apiKey=g;this.saveCallback=P;this.oauthToken=k}async loadAndShowPicker(){if(!this.oauthToken){return}try{await babelHelpers.classPrivateFieldLooseBase(this,s)[s]();await babelHelpers.classPrivateFieldLooseBase(this,n)[n](this.oauthToken);babelHelpers.classPrivateFieldLooseBase(this,i)[i]()}catch(e){throw new Error(`Error: ${e}`)}}}async function p(){const e=["https://apis.google.com/js/api.js","https://accounts.google.com/gsi/client"];await Promise.all(e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,o)[o](e))))}function h(e){return new Promise(((s,o)=>{const i=document.createElement("script");i.src=e;i.onload=()=>s(e);i.onerror=()=>o(new Error(`Failed to load script ${e}`));t.Dom.append(i,document.head)}))}function b(){window.gapi.load("client:auth2:picker",babelHelpers.classPrivateFieldLooseBase(this,a)[a])}function u(e){if(e.action===window.google.picker.Action.PICKED){const t=e.docs.map((e=>babelHelpers.classPrivateFieldLooseBase(this,l)[l](e)));this.saveCallback.saveButton(this.provider,"/",t)}switch(e.action){case"loaded":document.body.style.setProperty("overflow","hidden");break;case"cancel":case"picked":document.body.style.removeProperty("overflow");break}}function v(e){const t=new Date(e.lastEditedUtc);return{id:e.id,name:e.name,type:"file",size:e.sizeBytes,sizeInt:e.sizeBytes,modifyBy:"",modifyDate:babelHelpers.classPrivateFieldLooseBase(this,c)[c](t),modifyDateInt:t.getTime(),provider:this.provider}}function w(e){return`${e.getDay()}.${e.getMonth()}.${e.getFullYear()}`}async function y(e){try{const t=`https://oauth2.googleapis.com/tokeninfo?access_token=${e}`;const s=await fetch(t);if(!s.ok){new Error(`Error verifying token: ${s.statusText}`)}return await s.json()}catch(e){throw new Error(`Error verifying token: ${e.message}`)}}e.GoogleDrivePicker=d})(this.BX.Disk=this.BX.Disk||{},BX);
//# sourceMappingURL=google-drive-picker.bundle.map.js