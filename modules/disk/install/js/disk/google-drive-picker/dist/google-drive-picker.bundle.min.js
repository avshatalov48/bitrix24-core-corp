this.BX=this.BX||{};(function(e,t){"use strict";function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */r=function t(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function e(t,r,n){return t[r]=n}}function l(e,t,r,n){var i=t&&t.prototype instanceof p?t:p,a=Object.create(i.prototype),c=new T(n||[]);return o(a,"_invoke",{value:x(e,r,c)}),a}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var f={};function p(){}function d(){}function v(){}var y={};s(y,a,(function(){return this}));var g=Object.getPrototypeOf,w=g&&g(g(D([])));w&&w!==t&&n.call(w,a)&&(y=w);var m=v.prototype=p.prototype=Object.create(y);function k(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function r(o,i,a,c){var u=h(e[o],e,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==babelHelpers["typeof"](l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,c)}),(function(e){r("throw",e,a,c)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return r("throw",e,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function e(n,o){function a(){return new t((function(e,t){r(n,o,e,t)}))}return i=i?i.then(a,a):a()}})}function x(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return O()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=E(a,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=h(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(undefined===n)return t.delegate=null,"throw"===r&&e.iterator["return"]&&(t.method="return",t.arg=undefined,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,f;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function D(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=undefined,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:undefined,done:!0}}return d.prototype=v,o(m,"constructor",{value:v,configurable:!0}),o(v,"constructor",{value:d,configurable:!0}),d.displayName=s(v,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,s(e,u,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},k(b.prototype),s(b.prototype,c,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(m),s(m,u,"Generator"),s(m,a,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=D,T.prototype={constructor:T,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var r=this;function o(e,n){return c.type="throw",c.arg=t,r.next=e,n&&(r.method="next",r.arg=undefined),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function e(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=r&&r<=a.finallyLoc&&(a=null);var c=a?a.completion:{};return c.type=t,c.arg=r,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(c)},complete:function e(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),f},finish:function e(t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),f}},catch:function e(t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc===t){var o=n.completion;if("throw"===o.type){var i=o.arg;P(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function e(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=undefined),f}},e}var n=function(){function e(r,n,o,i,a){var c=this;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"scopes",t.Extension.getSettings("disk.google-drive-picker").get("scopes"));babelHelpers.defineProperty(this,"provider","gdrive");babelHelpers.defineProperty(this,"showPicker",(function(){if(c.oauthToken){var e=window.google.picker.ViewId.DOCS;var r=new window.google.picker.DocsView(e).setParent("root").setMode(window.google.picker.DocsViewMode.LIST).setIncludeFolders(true);var n=(new window.google.picker.PickerBuilder).enableFeature(window.google.picker.Feature.NAV_HIDDEN).setLocale(t.Loc.getMessage("LANGUAGE_ID")).addView(r).setOAuthToken(c.oauthToken).setDeveloperKey(c.apiKey).setAppId(c.appId).setCallback((function(e){return c.pickerCallback(e)})).enableFeature(window.google.picker.Feature.MULTISELECT_ENABLED).build();n.setVisible(true)}}));this.clientId=r;this.appId=n;this.apiKey=o;this.saveCallback=a;this.oauthToken=i}babelHelpers.createClass(e,[{key:"loadAndOpenPicker",value:function(){var e=babelHelpers.asyncToGenerator(r().mark((function e(){return r().wrap((function e(t){while(1)switch(t.prev=t.next){case 0:if(this.oauthToken){t.next=2;break}return t.abrupt("return");case 2:t.prev=2;t.next=5;return this.loadGis();case 5:t.next=7;return this.verifyGoogleOAuthToken(this.oauthToken);case 7:this.createPicker();t.next=13;break;case 10:t.prev=10;t.t0=t["catch"](2);throw new Error("Error: ".concat(t.t0));case 13:case"end":return t.stop()}}),e,this,[[2,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadGis",value:function(){var e=babelHelpers.asyncToGenerator(r().mark((function e(){var t=this;var n;return r().wrap((function e(r){while(1)switch(r.prev=r.next){case 0:n=["https://apis.google.com/js/api.js","https://accounts.google.com/gsi/client"];r.next=3;return Promise.all(n.map((function(e){return t.loadScript(e)})));case 3:case"end":return r.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadScript",value:function e(r){return new Promise((function(e,n){var o=document.createElement("script");o.src=r;o.onload=function(){return e(r)};o.onerror=function(){return n(new Error("Failed to load script ".concat(r)))};t.Dom.append(o,document.head)}))}},{key:"createPicker",value:function e(){window.gapi.load("client:auth2:picker",this.showPicker)}},{key:"pickerCallback",value:function e(t){var r=this;if(t.action===window.google.picker.Action.PICKED){var n=t.docs.map((function(e){return r.convertItem(e)}));this.saveCallback.saveButton(this.provider,"/",n)}}},{key:"convertItem",value:function e(t){var r=new Date(t.lastEditedUtc);return{id:t.id,name:t.name,type:"file",size:t.sizeBytes,sizeInt:t.sizeBytes,modifyBy:"",modifyDate:this.formatDate(r),modifyDateInt:r.getTime(),provider:this.provider}}},{key:"formatDate",value:function e(t){return"".concat(t.getDay(),".").concat(t.getMonth(),".").concat(t.getFullYear())}},{key:"verifyGoogleOAuthToken",value:function(){var e=babelHelpers.asyncToGenerator(r().mark((function e(t){var n,o;return r().wrap((function e(r){while(1)switch(r.prev=r.next){case 0:r.prev=0;n="https://oauth2.googleapis.com/tokeninfo?access_token=".concat(t);r.next=4;return fetch(n);case 4:o=r.sent;if(o.ok){r.next=7;break}throw new Error("Error verifying token: ".concat(o.statusText));case 7:r.next=9;return o.json();case 9:return r.abrupt("return",r.sent);case 12:r.prev=12;r.t0=r["catch"](0);throw new Error("Error verifying token: ".concat(r.t0.message));case 15:case"end":return r.stop()}}),e,null,[[0,12]])})));function t(t){return e.apply(this,arguments)}return t}()}]);return e}();e.GoogleDrivePicker=n})(this.BX.Disk=this.BX.Disk||{},BX);
//# sourceMappingURL=google-drive-picker.bundle.map.js