{"version":3,"file":"disk.onlyoffice-im-integration.bundle.js","sources":["../src/create-document.js"],"sourcesContent":["import {CreateDocumentOptions, CreateIframeDocumentOptions, IframeDocumentOptions} from \"./types\";\nimport {ajax as Ajax, Extension, Reflection, Runtime} from \"main.core\";\n\nexport default class CreateDocument\n{\n\toptions: CreateDocumentOptions;\n\n\tconstructor(options: CreateDocumentOptions)\n\t{\n\t\tthis.options = options;\n\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents()\n\t{\n\t\twindow.addEventListener(\"message\", (event: MessageEvent) => {\n\t\t\tif (event.data.type === 'selectedTemplate')\n\t\t\t{\n\t\t\t\tthis.options.delegate.setMaxWidth(961);\n\t\t\t\tthis.options.delegate.onDocumentCreated();\n\t\t\t}\n\t\t});\n\t}\n\n\tgetIframeUrlForCreate(options: CreateIframeDocumentOptions): Promise\n\t{\n\t\tthis.options.delegate.setMaxWidth(961);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst url = BX.util.add_url_param('/bitrix/services/main/ajax.php', {\n\t\t\t\taction: 'disk.api.integration.messengerCall.createDocumentInCall' ,\n\t\t\t\ttypeFile: options.typeFile,\n\t\t\t\tcallId: this.options.call.id,\n\t\t\t\tdialogId: this.options.dialog.id,\n\t\t\t});\n\n\t\t\tresolve(url);\n\t\t});\n\n\t}\n\n\tgetIframeUrl(options: IframeDocumentOptions): Promise\n\t{\n\t\tthis.options.delegate.setMaxWidth(961);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\toptions.viewerItem.enableEditInsteadPreview();\n\n\t\t\tconst queryParameters = options.viewerItem.getSliderQueryParameters();\n\t\t\tconst url = BX.util.add_url_param('/bitrix/services/main/ajax.php', queryParameters);\n\n\t\t\tresolve(url);\n\t\t});\n\n\t}\n\n\tgetIframeUrlForTemplates(): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('disk.api.integration.messengerCall.selectTemplateOrOpenExisting', {\n\t\t\t\tdata: {\n\t\t\t\t\tcallId: this.options.call.id,\n\t\t\t\t\tdialogId: this.options.dialog.id,\n\t\t\t\t}\n\t\t\t}).then((response) => {\n\t\t\t\tif (response.data.document && response.data.document.urlToEdit)\n\t\t\t\t{\n\t\t\t\t\tthis.options.delegate.setMaxWidth(961);\n\t\t\t\t\tresolve(response.data.document.urlToEdit);\n\t\t\t\t}\n\t\t\t\telse if (response.data.template && response.data.template.urlToSelect)\n\t\t\t\t{\n\t\t\t\t\tthis.options.delegate.setMaxWidth(328);\n\t\t\t\t\tresolve(response.data.template.urlToSelect);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tlistResumesInChat(chatId: number): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('disk.api.integration.messengerCall.listResumesInChat', {\n\t\t\t\tdata: {\n\t\t\t\t\tchatId: chatId,\n\t\t\t\t}\n\t\t\t}).then((response) => {\n\t\t\t\tif (response.data)\n\t\t\t\t{\n\t\t\t\t\tresolve(response.data.resumes);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t}).catch(() => {\n\t\t\t\treject();\n\t\t\t});\n\t\t});\n\t}\n\n\tonCloseIframe(iframe: HTMLIFrameElement): boolean\n\t{\n\t\tiframe.contentWindow.postMessage('closeIframe', '*');\n\n\t\treturn true;\n\t}\n};"],"names":["CreateDocument","options","bindEvents","window","addEventListener","event","data","type","delegate","setMaxWidth","onDocumentCreated","Promise","resolve","reject","url","BX","util","add_url_param","action","typeFile","callId","call","id","dialogId","dialog","viewerItem","enableEditInsteadPreview","queryParameters","getSliderQueryParameters","Ajax","runAction","then","response","document","urlToEdit","template","urlToSelect","chatId","resumes","iframe","contentWindow","postMessage"],"mappings":"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"}