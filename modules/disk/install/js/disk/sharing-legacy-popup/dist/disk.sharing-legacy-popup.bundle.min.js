this.BX=this.BX||{};this.BX.Disk=this.BX.Disk||{};(function(e,t,i){"use strict";var n=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"userBoxNode",null);babelHelpers.defineProperty(this,"isChangedRights",false);babelHelpers.defineProperty(this,"storageNewRights",{});babelHelpers.defineProperty(this,"originalRights",{});babelHelpers.defineProperty(this,"detachedRights",{});babelHelpers.defineProperty(this,"moduleTasks",{});babelHelpers.defineProperty(this,"entityToNewShared",{});babelHelpers.defineProperty(this,"loadedReadOnlyEntityToNewShared",{});babelHelpers.defineProperty(this,"entityToNewSharedMaxTaskName","");babelHelpers.defineProperty(this,"ajaxUrl","/bitrix/components/bitrix/disk.folder.list/ajax.php");babelHelpers.defineProperty(this,"destFormName","folder-list-destFormName")}babelHelpers.createClass(e,[{key:"showSharingDetailWithChangeRights",value:function e(n){var a=this;this.entityToNewShared={};this.loadedReadOnlyEntityToNewShared={};n=n||{};var o=n.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSharingDetailChangeRights"),{id:"folder_list_sharing_detail_object_"+o,responseType:"json",postData:{objectId:o},afterSuccessLoad:function e(s){if(s.status!=="success"){s.errors=s.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:s.errors.pop().message})}var d={name:s.owner.name,avatar:s.owner.avatar,link:s.owner.link};BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("JS_DISK_SHARING_LEGACY_POPUP_TITLE_MODAL_3"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:function e(){BX.addCustomEvent("onChangeRightOfSharing",a.onChangeRightOfSharing.bind(a));for(var t in s.members){if(!s.members.hasOwnProperty(t)){continue}a.entityToNewShared[s.members[t].entityId]={item:{id:s.members[t].entityId,name:s.members[t].name,avatar:s.members[t].avatar},type:s.members[t].type,right:s.members[t].right}}BX.SocNetLogDestination.init({name:a.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:a.onSelectDestination.bind(a),unSelect:a.onUnSelectDestination.bind(a),openDialog:a.onOpenDialogDestination.bind(a),closeDialog:a.onCloseDialogDestination.bind(a),openSearch:a.onOpenSearchDestination.bind(a),closeSearch:a.onCloseSearchDestination.bind(a)},items:s.destination.items,itemsLast:s.destination.itemsLast,itemsSelected:s.destination.itemsSelected});var i=a.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",(function(e){BX.SocNetLogDestination.openDialog(i);BX.PreventDefault(e)}));BX.bind(BX("feed-add-post-destination-input"),"keyup",a.onKeyUpDestination.bind(a));BX.bind(BX("feed-add-post-destination-input"),"keydown",a.onKeyDownDestination.bind(a))},onPopupClose:function e(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRightOfSharing",a.onChangeRightOfSharing.bind(a))}},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_OWNER")+"</td>"+"</tr>"}),BX.create("tr",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-col1" style="border-bottom: none;"><a class="bx-disk-filepage-used-people-link" href="'+d.link+'"><span class="bx-disk-filepage-used-people-avatar" style="background-image: url(\''+encodeURI(d.avatar)+"');\"></span>"+t.Text.encode(d.name)+"</a></td>"+"</tr>"})]}),BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:function e(){}}})]})]})],buttons:[new i.SaveButton({events:{click:function e(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(a.ajaxUrl,"action","changeSharingAndRights"),data:{objectId:o,entityToNewShared:a.entityToNewShared},onsuccess:function e(t){if(!t){return}t.message=BX.message("JS_DISK_SHARING_LEGACY_POPUP_OK_FILE_SHARE_MODIFIED").replace("#FILE#",n.object.name);BX.Disk.showModalWithStatusAction(t)}});BX.PopupWindowManager.getCurrentPopup().close()}}}),new BX.UI.CloseButton({events:{click:function e(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})}})}},{key:"showSharingDetailWithSharing",value:function e(n){var a=this;this.entityToNewShared={};this.loadedReadOnlyEntityToNewShared={};n=n||{};var o=n.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSharingDetailAppendSharing"),{id:"folder_list_sharing_detail_object_"+o,responseType:"json",postData:{objectId:o},afterSuccessLoad:function e(n){if(n.status!=="success"){n.errors=n.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:n.errors.pop().message})}var s={name:n.owner.name,avatar:n.owner.avatar,link:n.owner.link};a.entityToNewSharedMaxTaskName=n.owner.maxTaskName;BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("JS_DISK_SHARING_LEGACY_POPUP_TITLE_MODAL_3"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:function e(){BX.addCustomEvent("onChangeRightOfSharing",a.onChangeRightOfSharing.bind(a));for(var t in n.members){if(!n.members.hasOwnProperty(t)){continue}a.entityToNewShared[n.members[t].entityId]={item:{id:n.members[t].entityId,name:n.members[t].name,avatar:n.members[t].avatar},type:n.members[t].type,right:n.members[t].right}}a.loadedReadOnlyEntityToNewShared=BX.clone(a.entityToNewShared,true);BX.SocNetLogDestination.init({name:a.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:a.onSelectDestination.bind(a),unSelect:a.onUnSelectDestination.bind(a),openDialog:a.onOpenDialogDestination.bind(a),closeDialog:a.onCloseDialogDestination.bind(a),openSearch:a.onOpenSearchDestination.bind(a),closeSearch:a.onCloseSearchDestination.bind(a)},items:n.destination.items,itemsLast:n.destination.itemsLast,itemsSelected:n.destination.itemsSelected});var i=a.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",(function(e){BX.SocNetLogDestination.openDialog(i);BX.PreventDefault(e)}));BX.bind(BX("feed-add-post-destination-input"),"keyup",a.onKeyUpDestination.bind(a));BX.bind(BX("feed-add-post-destination-input"),"keydown",a.onKeyDownDestination.bind(a))},onPopupClose:function e(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRightOfSharing",a.onChangeRightOfSharing.bind(a))}},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_OWNER")+"</td>"+"</tr>"}),BX.create("tr",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-col1" style="border-bottom: none;"><a class="bx-disk-filepage-used-people-link" href="'+s.link+'"><span class="bx-disk-filepage-used-people-avatar" style="background-image: url(\''+encodeURI(s.avatar)+"');\"></span>"+t.Text.encode(s.name)+"</a></td>"+"</tr>"})]}),BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:function e(){}}})]})]})],buttons:[new i.SaveButton({events:{click:function e(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(a.ajaxUrl,"action","appendSharing"),data:{objectId:o,entityToNewShared:a.entityToNewShared},onsuccess:function e(t){if(!t){return}BX.Disk.showModalWithStatusAction(t)}});BX.PopupWindowManager.getCurrentPopup().close()}}}),new BX.UI.CloseButton({events:{click:function e(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})}})}},{key:"showSharingDetailWithoutEdit",value:function e(t){t=t||{};BX.Disk.showSharingDetailWithoutEdit({ajaxUrl:"/bitrix/components/bitrix/disk.folder.list/ajax.php",object:t.object})}},{key:"onSelectDestination",value:function e(t,i,n){this.entityToNewShared[t.id]=this.entityToNewShared[t.id]||{};BX.Disk.appendNewShared({maxTaskName:this.entityToNewSharedMaxTaskName,readOnly:!!this.loadedReadOnlyEntityToNewShared[t.id],destFormName:this.destFormName,item:t,type:i,right:this.entityToNewShared[t.id].right||"disk_access_edit"});this.entityToNewShared[t.id]={item:t,type:i,right:this.entityToNewShared[t.id].right||"disk_access_edit"}}},{key:"onUnSelectDestination",value:function e(t,i,n){var a=t.id;if(!!this.loadedReadOnlyEntityToNewShared[a]){return false}delete this.entityToNewShared[a];var o=BX.findChild(BX("bx-disk-popup-shared-people-list"),{attribute:{"data-dest-id":""+a+""}},true);if(o){BX.remove(o)}}},{key:"onChangeRightOfSharing",value:function e(t,i){if(this.entityToNewShared[t]){this.entityToNewShared[t].right=i}}},{key:"onOpenDialogDestination",value:function e(){BX.style(BX("feed-add-post-destination-input-box"),"display","inline-block");BX.style(BX("bx-destination-tag"),"display","none");BX.focus(BX("feed-add-post-destination-input"));if(BX.SocNetLogDestination.popupWindow){BX.SocNetLogDestination.popupWindow.adjustPosition({forceTop:true})}}},{key:"onCloseDialogDestination",value:function e(){var t=BX("feed-add-post-destination-input");if(!BX.SocNetLogDestination.isOpenSearch()&&t&&t.value.length<=0){BX.style(BX("feed-add-post-destination-input-box"),"display","none");BX.style(BX("bx-destination-tag"),"display","inline-block")}}},{key:"onOpenSearchDestination",value:function e(){if(BX.SocNetLogDestination.popupSearchWindow){BX.SocNetLogDestination.popupSearchWindow.adjustPosition({forceTop:true})}}},{key:"onCloseSearchDestination",value:function e(){var t=BX("feed-add-post-destination-input");if(!BX.SocNetLogDestination.isOpenSearch()&&t&&t.value.length>0){BX.style(BX("feed-add-post-destination-input-box"),"display","none");BX.style(BX("bx-destination-tag"),"display","inline-block");BX("feed-add-post-destination-input").value=""}}},{key:"onKeyDownDestination",value:function e(t){var i=this.destFormName;if(t.keyCode==8&&BX("feed-add-post-destination-input").value.length<=0){BX.SocNetLogDestination.sendEvent=false;BX.SocNetLogDestination.deleteLastItem(i)}return true}},{key:"onKeyUpDestination",value:function e(t){var i=this.destFormName;if(t.keyCode==16||t.keyCode==17||t.keyCode==18||t.keyCode==20||t.keyCode==244||t.keyCode==224||t.keyCode==91){return false}if(t.keyCode==13){BX.SocNetLogDestination.selectFirstSearchItem(i);return BX.PreventDefault(t)}if(t.keyCode==27){BX("feed-add-post-destination-input").value=""}else{BX.SocNetLogDestination.search(BX("feed-add-post-destination-input").value,true,i)}if(BX.SocNetLogDestination.sendEvent&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}if(t.keyCode==8){BX.SocNetLogDestination.sendEvent=true}return BX.PreventDefault(t)}}]);return e}();var a=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(a,"WITHOUT_EDIT","without-edit");babelHelpers.defineProperty(a,"WITH_CHANGE_RIGHTS","with-change-rights");babelHelpers.defineProperty(a,"WITH_SHARING","with-sharing");e.LegacyPopup=n;e.SharingControlType=a})(this.BX.Disk.Sharing=this.BX.Disk.Sharing||{},BX,BX.UI);
//# sourceMappingURL=disk.sharing-legacy-popup.bundle.map.js