this.BX=this.BX||{};(function(e,t,i,n,r,s){"use strict";var a;function o(e,t){if(!a){a=new IntersectionObserver(function(e){e.forEach(function(e){if(e.isIntersecting){a.unobserve(e.target);var t=e.target.observedCallback;delete e.target.observedCallback;setTimeout(t)}})},{threshold:0})}e.observedCallback=t;a.observe(e)}var u=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,"disk.users"));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"busy",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"finished",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"pageNumber",1);if(e instanceof Function){i.finished=false;i.callback=e}return i}babelHelpers.createClass(t,[{key:"isFinished",value:function e(){return this.finished===true}},{key:"getNext",value:function e(){var t=this;if(this.busy===true||this.finished===true){return false}this.busy=true;this.callback(++this.pageNumber).then(function(e){var i=e.data,n=i.data,r=i.getPageCount,s=i.getCurrentPage,a=e.errors;t.emit("onGetPage",{data:n,getPageCount:r,getCurrentPage:s});if(s>=r){t.finished=true;t.emit("onEndPage",{getPageCount:r,getCurrentPage:s})}t.busy=false},function(){t.emit("onError");t.busy=false})}}]);return t}(r.EventEmitter);function l(){var e=babelHelpers.taggedTemplateLiteral(['<div class="disk-active-user-popup-content disk-active-user-popup--grid">\n\t\t\t\t','\n\t\t\t\t<div class="disk-active-user-popup-box">\n\t\t\t\t\t<div class="disk-active-user-popup-inner">\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>"]);l=function t(){return e};return e}function c(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-active-user-value" style="display: none;"></div>']);c=function t(){return e};return e}function p(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="disk-active-user-list"></div>']);p=function t(){return e};return e}function d(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-active-user-box ','" ',' onclick="','">\n\t\t\t<div class="disk-active-user">\n\t\t\t\t<div class="disk-active-user-inner">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>"]);d=function t(){return e};return e}function h(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-icon ui-icon-common-user disk-active-user-popup-icon">\n\t\t\t\t<i ','>\n\t\t\t\t</i>\n\t\t\t</div>\n\t\t\t<div class="disk-active-user-popup-name">',"</div>\n\t\t"]);h=function t(){return e};return e}function v(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="disk-active-user-popup-item">\n\t\t\t\t</div>>\n\t\t\t']);v=function t(){return e};return e}function g(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a href="','" class="disk-active-user-popup-item">\n\t\t\t\t</a>>\n\t\t\t']);g=function t(){return e};return e}function f(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-icon ui-icon-common-user disk-active-user-list-item" title="','">\n\t\t\t\t\t<i ',">\n\t\t\t\t\t</i>\n\t\t\t\t</div>\n\t\t\t"]);f=function t(){return e};return e}var b=[];var m=function(){babelHelpers.createClass(e,null,[{key:"get",value:function e(t){return b[t>0?t:0]}}]);function e(i,n,r){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"cache",new t.Cache.MemoryCache);babelHelpers.defineProperty(this,"maxCount",3);babelHelpers.defineProperty(this,"title",null);babelHelpers.defineProperty(this,"items",new Map);babelHelpers.defineProperty(this,"options",{});this.options=r||{};i.forEach(this.addItem.bind(this));this.renderFirst();this.pagination=new u(n);this.pagination.subscribe("onGetPage",this.onGetPage.bind(this));this.pagination.subscribe("onEndPage",this.onEndPage.bind(this));b.push(this)}babelHelpers.createClass(e,[{key:"addItem",value:function e(t){t.id=t.id||t.entityId;this.items.set(t.id,t);return t}},{key:"renderFirst",value:function e(){var t=0;var i=this.items.keys();var n;var r=this.getUserListContainer();while(t<this.maxCount&&(n=i.next().value)){var s=this.getUserContainer(this.items.get(n));if(!r.contains(s)){r.appendChild(s)}t++}if(this.items.size>this.maxCount){this.getMoreButton().innerHTML=this.items.size-this.maxCount;this.getMoreButton().style.display="flex";this.getContainer().style.cursor="pointer"}else{this.getMoreButton().style.display="none";this.getContainer().style.cursor=""}if(this.items.size<=0){this.getContainer().style.display="none"}else if(this.getContainer().style.display==="none"){this.getContainer().style.display="flex"}}},{key:"getUserContainer",value:function e(i){return this.cache.remember("userContainer"+i["id"],function(){return t.Tag.render(f(),t.Text.encode(i["name"]),i["avatar"]?"style=\"background: url('".concat(t.Text.encode(i["avatar"]),"') no-repeat center; background-size: cover;\" "):"")})}},{key:"renderPopupUser",value:function e(i){var n;var r;if(i.url){r=t.Tag.render(g(),i["url"])}else{r=t.Tag.render(v())}var s=t.Tag.render(h(),i["avatar"]?"style=\"background: url('".concat(t.Text.encode(i["avatar"]),"') no-repeat center; background-size: cover;\" "):"",t.Text.encode(i["name"]));(n=r).append.apply(n,babelHelpers.toConsumableArray(s));return r}},{key:"getContainer",value:function e(){var i=this;var n=this.options.placeInGrid||false;return this.cache.remember("mainContainer",function(){var e=i.items.size<=0?' style="display: none;" ':"";var r=n?"disk-active-user--grid":"";return t.Tag.render(d(),r,e,i.showPopupUsers.bind(i),i.getUserListContainer(),i.getMoreButton())})}},{key:"getUserListContainer",value:function e(){return this.cache.remember("users",function(){return t.Tag.render(p())})}},{key:"getMoreButton",value:function e(){return this.cache.remember("more",function(){return t.Tag.render(c())})}},{key:"showPopupUsers",value:function e(){var t=this;this.getPopup().show();this.items.forEach(function(e){t.getPopupUsersContainer().appendChild(t.renderPopupUser(e))})}},{key:"getPopup",value:function e(){if(this.popup){return this.popup}this.popup=new i.Popup({className:"disk-active-user-popup",content:t.Tag.render(l(),this.title?'<div class="disk-active-user-popup-title">'.concat(this.title,"</div>"):"",this.getPopupUsersContainer(),this.getPopupUsersEndBlock()),bindElement:this.getContainer(),closeByEsc:true,autoHide:true});this.popup.subscribeOnce("onAfterClose",function(){delete this.popup;this.cache.delete("popupUsers");this.cache.delete("popupUsersEndBlock")}.bind(this));return this.popup}},{key:"getPopupUsersContainer",value:function e(){return this.cache.remember("popupUsers",function(){return document.createElement("div")})}},{key:"getPopupUsersEndBlock",value:function e(){var i=this;return this.cache.remember("popupUsersEndBlock",function(){var e=document.createElement("div");if(i.pagination.isFinished()){return e}var n=i.getNextPage.bind(i);e.className="disk-active-user-popup-box-pagination-loader";e.innerHTML=t.Loc.getMessage("JS_DISK_USERS_PAGINATION");e.addEventListener("click",n);o(e,n);return e})}},{key:"getNextPage",value:function e(){this.loader=this.loader||new s.Loader({target:this.getPopupUsersEndBlock(),size:20});this.loader.show();this.pagination.getNext()}},{key:"onGetPage",value:function e(i){var n=this;var r=i.data;if(t.Type.isArray(r)){r.forEach(function(e){var t=n.addItem(e);n.getPopupUsersContainer().appendChild(n.renderPopupUser(t))})}}},{key:"onEndPage",value:function e(){if(this.loader){this.loader.hide()}this.getPopupUsersEndBlock().style.display="none"}},{key:"addUser",value:function e(t){this.addItem(t);this.renderFirst()}},{key:"hasUser",value:function e(t){return this.items.has(t)}},{key:"getUser",value:function e(t){return this.items.get(t)}},{key:"forEach",value:function e(t){this.items.forEach(t)}},{key:"deleteUser",value:function e(t){if(!this.hasUser(t)){return}var i=this.items.get(t);this.items.delete(t);if(this.cache.has("userContainer"+i["id"])){var n=this.getUserListContainer();var r=this.cache.get("userContainer"+t);this.cache.delete("userContainer"+t);if(n.contains(r)){n.removeChild(r)}}this.renderFirst()}}]);return e}();e.Users=m})(this.BX.Disk=this.BX.Disk||{},BX,BX.Main,BX,BX.Event,BX);
//# sourceMappingURL=users.bundle.map.js