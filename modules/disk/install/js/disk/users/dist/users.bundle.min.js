this.BX=this.BX||{};(function(e,t,i,s,n,r,a){"use strict";var o;function l(e,t){if(!o){o=new IntersectionObserver((function(e){e.forEach((function(e){if(e.isIntersecting){o.unobserve(e.target);var t=e.target.observedCallback;delete e.target.observedCallback;setTimeout(t)}}))}),{threshold:0})}e.observedCallback=t;o.observe(e)}var u=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,"disk.users"));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"busy",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"finished",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"pageNumber",1);if(e instanceof Function){i.finished=false;i.callback=e}return i}babelHelpers.createClass(t,[{key:"isFinished",value:function e(){return this.finished===true}},{key:"getNext",value:function e(){var t=this;if(this.busy===true||this.finished===true){return false}this.busy=true;this.callback(++this.pageNumber).then((function(e){var i=e.data,s=i.data,n=i.getPageCount,r=i.getCurrentPage,a=e.errors;t.emit("onGetPage",{data:s,getPageCount:n,getCurrentPage:r});if(r>=n){t.finished=true;t.emit("onEndPage",{getPageCount:n,getCurrentPage:r})}t.busy=false}),(function(){t.emit("onError");t.busy=false}))}}]);return t}(r.EventEmitter);var c,d,p,h,v,g,b,f;var m=[];var y=function(){babelHelpers.createClass(e,null,[{key:"get",value:function e(t){return m[t>0?t:0]}}]);function e(t,s,n){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"cache",new i.Cache.MemoryCache);babelHelpers.defineProperty(this,"maxCount",3);babelHelpers.defineProperty(this,"title",null);babelHelpers.defineProperty(this,"items",new Map);babelHelpers.defineProperty(this,"options",{});this.options=n||{};t.forEach(this.addItem.bind(this));this.renderFirst();this.pagination=new u(s);this.pagination.subscribe("onGetPage",this.onGetPage.bind(this));this.pagination.subscribe("onEndPage",this.onEndPage.bind(this));m.push(this)}babelHelpers.createClass(e,[{key:"addItem",value:function e(t){t.id=t.id||t.entityId;this.items.set(t.id,t);return t}},{key:"renderFirst",value:function e(){var t=0;var i=this.items.keys();var s;var n=this.getUserListContainer();while(t<this.maxCount&&(s=i.next().value)){var r=this.getUserContainer(this.items.get(s));if(!n.contains(r)){n.appendChild(r)}t++}if(this.items.size>this.maxCount){this.getMoreButton().innerHTML=this.items.size-this.maxCount;this.getMoreButton().style.display="flex";this.getContainer().style.cursor="pointer"}else{this.getMoreButton().style.display="none";this.getContainer().style.cursor=""}if(this.items.size<=0){this.getContainer().style.display="none"}else if(this.getContainer().style.display==="none"){this.getContainer().style.display="flex"}}},{key:"getUserContainer",value:function e(t){return this.cache.remember("userContainer"+t["id"],(function(){return i.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-icon ui-icon-common-user disk-active-user-list-item" title="','">\n\t\t\t\t\t<i ',">\n\t\t\t\t\t</i>\n\t\t\t\t</div>\n\t\t\t"])),i.Text.encode(t["name"]),t["avatar"]?"style=\"background: url('".concat(encodeURI(i.Text.encode(t["avatar"])),"') no-repeat center; background-size: cover;\" "):"")}))}},{key:"renderPopupUser",value:function e(t){var s;var n;if(t.url){n=i.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a href="','" class="disk-active-user-popup-item">\n\t\t\t\t</a>>\n\t\t\t'])),t["url"])}else{n=i.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="disk-active-user-popup-item">\n\t\t\t\t</div>>\n\t\t\t'])))}var r=i.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-icon ui-icon-common-user disk-active-user-popup-icon">\n\t\t\t\t<i ','>\n\t\t\t\t</i>\n\t\t\t</div>\n\t\t\t<div class="disk-active-user-popup-name">',"</div>\n\t\t"])),t["avatar"]?"style=\"background: url('".concat(encodeURI(i.Text.encode(t["avatar"])),"') no-repeat center; background-size: cover;\" "):"",i.Text.encode(t["name"]));(s=n).append.apply(s,babelHelpers.toConsumableArray(r));return n}},{key:"getContainer",value:function e(){var t=this;var s=this.options.placeInGrid||false;return this.cache.remember("mainContainer",(function(){var e=t.items.size<=0?' style="display: none;" ':"";var n=s?"disk-active-user--grid":"";return i.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-active-user-box ','" ',' onclick="','">\n\t\t\t<div class="disk-active-user">\n\t\t\t\t<div class="disk-active-user-inner">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>"])),n,e,t.showPopupUsers.bind(t),t.getUserListContainer(),t.getMoreButton())}))}},{key:"getUserListContainer",value:function e(){return this.cache.remember("users",(function(){return i.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="disk-active-user-list"></div>'])))}))}},{key:"getMoreButton",value:function e(){return this.cache.remember("more",(function(){return i.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-active-user-value" style="display: none;"></div>'])))}))}},{key:"showPopupUsers",value:function e(){var t=this;this.getPopup().show();this.items.forEach((function(e){t.getPopupUsersContainer().appendChild(t.renderPopupUser(e))}))}},{key:"getPopup",value:function e(){if(this.popup){return this.popup}this.popup=new s.Popup({className:"disk-active-user-popup",content:i.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['<div class="disk-active-user-popup-content disk-active-user-popup--grid">\n\t\t\t\t','\n\t\t\t\t<div class="disk-active-user-popup-box">\n\t\t\t\t\t<div class="disk-active-user-popup-inner">\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>"])),this.title?'<div class="disk-active-user-popup-title">'.concat(this.title,"</div>"):"",this.getPopupUsersContainer(),this.getPopupUsersEndBlock()),bindElement:this.getContainer(),closeByEsc:true,autoHide:true});this.popup.subscribeOnce("onAfterClose",function(){delete this.popup;this.cache["delete"]("popupUsers");this.cache["delete"]("popupUsersEndBlock")}.bind(this));return this.popup}},{key:"getPopupUsersContainer",value:function e(){return this.cache.remember("popupUsers",(function(){return document.createElement("div")}))}},{key:"getPopupUsersEndBlock",value:function e(){var t=this;return this.cache.remember("popupUsersEndBlock",(function(){var e=document.createElement("div");if(t.pagination.isFinished()){return e}var s=t.getNextPage.bind(t);e.className="disk-active-user-popup-box-pagination-loader";e.innerHTML=i.Loc.getMessage("JS_DISK_USERS_PAGINATION");e.addEventListener("click",s);l(e,s);return e}))}},{key:"getNextPage",value:function e(){this.loader=this.loader||new a.Loader({target:this.getPopupUsersEndBlock(),size:20});this.loader.show();this.pagination.getNext()}},{key:"onGetPage",value:function e(t){var s=this;var n=t.data;if(i.Type.isArray(n)){n.forEach((function(e){var t=s.addItem(e);s.getPopupUsersContainer().appendChild(s.renderPopupUser(t))}))}}},{key:"onEndPage",value:function e(){if(this.loader){this.loader.hide()}this.getPopupUsersEndBlock().style.display="none"}},{key:"addUser",value:function e(t){this.addItem(t);this.renderFirst()}},{key:"hasUser",value:function e(t){return this.items.has(t)}},{key:"getUser",value:function e(t){return this.items.get(t)}},{key:"forEach",value:function e(t){this.items.forEach(t)}},{key:"deleteUser",value:function e(t){if(!this.hasUser(t)){return}var i=this.items.get(t);this.items["delete"](t);if(this.cache.has("userContainer"+i["id"])){var s=this.getUserListContainer();var n=this.cache.get("userContainer"+t);this.cache["delete"]("userContainer"+t);if(s.contains(n)){s.removeChild(n)}}this.renderFirst()}}]);return e}();e.Users=y})(this.BX.Disk=this.BX.Disk||{},BX,BX,BX.Main,BX,BX.Event,BX);
//# sourceMappingURL=users.bundle.map.js