this.BX=this.BX||{};this.BX.Disk=this.BX.Disk||{};(function(t,e,n,r,i){"use strict";var a,o;function s(t,e){var n=typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=l(t))||e&&t&&typeof t.length==="number"){if(n)t=n;var r=0;var i=function t(){};return{s:i,n:function e(){if(r>=t.length)return{done:true};return{done:false,value:t[r++]}},e:function t(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,o=false,s;return{s:function e(){n=n.call(t)},n:function t(){var e=n.next();a=e.done;return e},e:function t(e){o=true;s=e},f:function t(){try{if(!a&&n["return"]!=null)n["return"]()}finally{if(o)throw s}}}}function l(t,e){if(!t)return;if(typeof t==="string")return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}function c(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,r=new Array(e);n<e;n++){r[n]=t[n]}return r}function u(t,e){f(t,e);e.add(t)}function f(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function d(t,e,n){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return n}var h="en";var v=new WeakSet;var g=new WeakSet;var p=new WeakSet;var _=new WeakSet;var E=new WeakSet;var m=function(){function t(e){babelHelpers.classCallCheck(this,t);u(this,E);u(this,_);u(this,p);u(this,g);u(this,v);babelHelpers.defineProperty(this,"popupContainerId","content-register-modal");this.options=e;this.bindEvents()}babelHelpers.createClass(t,[{key:"bindEvents",value:function t(){}},{key:"start",value:function t(){var i=r.ajax.runAction("disk.api.integration.b24documents.listAllowedServers").then((function(t){return t.data.servers}));var s=r.Loc.getMessage("JS_B24_DOCUMENTS_CLIENT_REGISTRATION_WARNING",{"#NAME#":d(this,p,I).call(this)});var l=r.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-form" id="','" style="padding-top: 20px">\n\t\t\t\t<div class="ui-form-row" style="display: none">\n\t\t\t\t\t<div class="ui-alert ui-alert-danger">\n\t\t\t\t\t\t<span class="ui-alert-message"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t<select class="ui-ctl-element"></select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">',"</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),this.popupContainerId,r.Loc.getMessage("JS_B24_DOCUMENTS_CLIENT_REGISTRATION_SELECT_SERVER_LABEL"),s);var c=new e.Popup({overlay:true,height:280,width:350,content:l,closeIcon:true,events:{onAfterClose:function t(){return c.destroy()}},buttons:[new n.SaveButton({text:r.Loc.getMessage("JS_B24_DOCUMENTS_CLIENT_REGISTRATION_BUTTON"),onclick:this.handleClickRegister.bind(this)})]});c.show();i.then((function(t){var e=l.querySelector("select");t.forEach((function(t){var n=t.region?" (".concat(t.region,")"):"";e.add(r.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['<option value="','">',"","</option>"])),t.proxy,t.proxy,n))}))}))}},{key:"handleClickRegister",value:function t(e,n){var i=this;e.setDisabled();var a=new BX.Loader({target:e.getContainer(),size:45});a.show();r.ajax.runAction("disk.api.integration.b24documents.registerCloudClient",{data:{serviceUrl:d(this,v,y).call(this),languageId:d(this,g,S).call(this)}}).then((function(){document.location.reload()}))["catch"]((function(t){console.warn("Registration error",t);a.hide();d(i,_,T).call(i,d(i,E,N).call(i,t.errors||[]))}))}}]);return t}();function y(){var t=document.querySelector("#".concat(this.popupContainerId," select"));if(!t){return""}return t.value}function S(){return r.Loc.hasMessage("LANGUAGE_ID")?r.Loc.getMessage("LANGUAGE_ID"):h}function I(){return r.Extension.getSettings("disk.b24-documents-client-registration").get("serviceName")}function T(t){var e=document.querySelectorAll("#".concat(this.popupContainerId," .ui-form-row"));e.forEach((function(t){t.style.display="none"}));e[0].style.display="";e[0].querySelector(".ui-alert-message").textContent=t}function N(t){var e=s(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;if(i.code==="tariff_restriction"){return r.Loc.getMessage("JS_B24_DOCUMENTS_CLIENT_REGISTRATION_ERROR_AFTER_REG",{"#NAME#":d(this,p,I).call(this)})}if(i.code==="should_show_in_ui"){return i.message}if(i.code==="domain_verification"){return r.Loc.getMessage("JS_B24_DOCUMENTS_CLIENT_REGISTRATION_ERROR_DOMAIN_VERIFICATION",{"#NAME#":d(this,p,I).call(this),"#DOMAIN#":i.customData.domain})}}}catch(t){e.e(t)}finally{e.f()}return r.Loc.getMessage("JS_B24_DOCUMENTS_CLIENT_REGISTRATION_ERROR_COMMON")}function b(t,e){var n=typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=C(t))||e&&t&&typeof t.length==="number"){if(n)t=n;var r=0;var i=function t(){};return{s:i,n:function e(){if(r>=t.length)return{done:true};return{done:false,value:t[r++]}},e:function t(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,o=false,s;return{s:function e(){n=n.call(t)},n:function t(){var e=n.next();a=e.done;return e},e:function t(e){o=true;s=e},f:function t(){try{if(!a&&n["return"]!=null)n["return"]()}finally{if(o)throw s}}}}function C(t,e){if(!t)return;if(typeof t==="string")return A(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(t,e)}function A(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,r=new Array(e);n<e;n++){r[n]=t[n]}return r}function w(t,e){R(t,e);e.add(t)}function R(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function M(t,e,n){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return n}var O="en";var L=new WeakSet;var B=new WeakSet;var k=new WeakSet;var U=function(){function t(e){babelHelpers.classCallCheck(this,t);w(this,k);w(this,B);w(this,L);babelHelpers.defineProperty(this,"popupContainerId","content-register-modal");this.options=e;this.bindEvents()}babelHelpers.createClass(t,[{key:"bindEvents",value:function t(){}},{key:"start",value:function t(){var e=this;this.messageBox=i.MessageBox.create({title:r.Loc.getMessage("JS_B24_DOCUMENTS_CLIENT_UNREGISTRATION_TITLE",{"#NAME#":M(this,B,G).call(this)}),message:r.Loc.getMessage("JS_B24_DOCUMENTS_CLIENT_UNREGISTRATION_MSG",{"#NAME#":M(this,B,G).call(this)}),buttons:BX.UI.Dialogs.MessageBoxButtons.OK_CANCEL,okCaption:r.Loc.getMessage("JS_B24_DOCUMENTS_CLIENT_UNREGISTRATION_UNREGISTER_BTN"),onOk:function t(){console.log(e);e.handleClickUnregister()}});this.messageBox.show()}},{key:"handleClickUnregister",value:function t(){var e=this;r.ajax.runAction("disk.api.integration.b24documents.unregisterCloudClient",{data:{languageId:M(this,L,D).call(this)}}).then((function(){document.location.reload()}))["catch"]((function(t){console.warn("Unregistration error",t);e.messageBox.setMessage(M(e,k,x).call(e,t.errors||[]))}))}}]);return t}();function D(){return r.Loc.hasMessage("LANGUAGE_ID")?r.Loc.getMessage("LANGUAGE_ID"):O}function G(){return r.Extension.getSettings("disk.b24-documents-client-registration").get("serviceName")}function x(t){var e=b(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;if(i.code==="should_show_in_ui"){return i.message}}}catch(t){e.e(t)}finally{e.f()}return r.Loc.getMessage("JS_B24_DOCUMENTS_CLIENT_UNREGISTRATION_ERROR_COMMON")}t.ClientRegistration=m;t.ClientUnRegistration=U})(this.BX.Disk.B24Documents=this.BX.Disk.B24Documents||{},BX.Main,BX.UI,BX,BX.UI.Dialogs);
//# sourceMappingURL=disk.b24-documents-client-registration.bundle.map.js