{"version":3,"file":"disk-rich-text-area.bundle.js","sources":["../src/disk-rich-text-area-component.js"],"sourcesContent":["import { Extension, Type } from 'main.core';\n\nimport {\n\tRichTextAreaComponent,\n\tFileButton,\n\tCreateDocumentButton,\n\ttype RichTextArea,\n\ttype RichTextAreaWidgetOptions,\n} from 'ui.rich-text-area';\n\nimport {\n\tUserFieldWidgetComponent,\n\ttype UserFieldWidgetOptions,\n\ttype UserFieldControl,\n} from 'disk.uploader.user-field-widget';\n\nimport { TextEditor, type TextEditorOptions } from 'ui.text-editor';\nimport { Uploader, type UploaderOptions } from 'ui.uploader.core';\n\nimport type { BaseEvent } from 'main.core.events';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\n\n\n/**\n * @memberof BX.UI.RichTextArea\n */\nexport const DiskRichTextAreaComponent: BitrixVueComponentProps = {\n\tname: 'DiskRichTextAreaComponent',\n\tcomponents: {\n\t\tRichTextAreaComponent,\n\t\tUserFieldWidgetComponent,\n\t\tFileButton,\n\t\tCreateDocumentButton,\n\t},\n\tprops: {\n\t\teditorOptions: {\n\t\t\ttype: Object,\n\t\t},\n\t\teditorInstance: {\n\t\t\ttype: TextEditor,\n\t\t},\n\t\tuploaderOptions: {\n\t\t\ttype: Object,\n\t\t},\n\t\tuploaderInstance: {\n\t\t\ttype: Uploader,\n\t\t},\n\t\twidgetOptions: {\n\t\t\ttype: Object,\n\t\t\tdefault: {},\n\t\t},\n\t\tfiles: {\n\t\t\ttype: Array,\n\t\t\tdefault: [],\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tfileCount: 0,\n\t\t\tpanelVisibility: 'hidden',\n\t\t};\n\t},\n\tmethods: {\n\t\tgetUploaderOptions(): UploaderOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\timagePreviewHeight: 1200, // double size (see DiskUploaderController)\n\t\t\t\timagePreviewWidth: 1200,\n\t\t\t\timagePreviewQuality: 0.85,\n\t\t\t\ttreatOversizeImageAsFile: true,\n\t\t\t\tignoreUnknownImageTypes: true,\n\t\t\t\tcontroller: 'disk.uf.integration.diskUploaderController',\n\t\t\t\tmultiple: true,\n\t\t\t\tmaxFileSize: null,\n\t\t\t\t...(Type.isPlainObject(this.uploaderOptions) ? this.uploaderOptions : {}),\n\t\t\t};\n\t\t},\n\t\tgetUploaderInstance(): Uploader\n\t\t{\n\t\t\treturn this.uploaderInstance;\n\t\t},\n\t\tgetEditorOptions(): TextEditorOptions\n\t\t{\n\t\t\tconst editorOptions: TextEditorOptions = (\n\t\t\t\tType.isPlainObject(this.editorOptions) ? { ...this.editorOptions } : {}\n\t\t\t);\n\n\t\t\teditorOptions.file = editorOptions.file || {};\n\t\t\teditorOptions.file.mode = 'disk';\n\n\t\t\treturn editorOptions;\n\t\t},\n\t\tgetEditorInstance(): TextEditor\n\t\t{\n\t\t\treturn this.editorInstance;\n\t\t},\n\t\tgetRichTextAreaWidgetOptions(): RichTextAreaWidgetOptions\n\t\t{\n\t\t\tconst richTextOptions: RichTextAreaWidgetOptions = this.widgetOptions.richTextOptions || {};\n\n\t\t\treturn {\n\t\t\t\t...richTextOptions,\n\t\t\t\tevents: [{\n\t\t\t\t\t'Item:onAdd': (event: BaseEvent<{ fileCount: number }>): void => {\n\t\t\t\t\t\tthis.fileCount = event.getData().fileCount;\n\t\t\t\t\t\tthis.panelVisibility = 'uploader';\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onRemove': (event: BaseEvent<{ fileCount: number }>): void => {\n\t\t\t\t\t\tthis.fileCount = event.getData().fileCount;\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onInsertChange': (event: BaseEvent<{ hasInsertedItems: boolean }>): void => {\n\t\t\t\t\t\tif (this.getUserFieldControl().getPhotoTemplateMode() === 'auto')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.getUserFieldControl().setPhotoTemplate(\n\t\t\t\t\t\t\t\tevent.getData().hasInsertedItems ? 'gallery' : 'grid',\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}, richTextOptions.events],\n\t\t\t};\n\t\t},\n\t\tgetRichTextArea(): RichTextArea\n\t\t{\n\t\t\treturn this.$refs.richTextArea.getRichTextArea();\n\t\t},\n\t\tgetEditor(): TextEditor\n\t\t{\n\t\t\treturn this.$refs.richTextArea.getEditor();\n\t\t},\n\t\tgetUploader(): Uploader\n\t\t{\n\t\t\treturn this.$refs.richTextArea.getUploader();\n\t\t},\n\t\tgetUserFieldControl(): UserFieldControl\n\t\t{\n\t\t\treturn this.$refs.userFieldWidget.getUserFieldControl();\n\t\t},\n\t\thandleFileClick()\n\t\t{\n\t\t\tif (this.panelVisibility === 'uploader')\n\t\t\t{\n\t\t\t\tthis.panelVisibility = 'hidden';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.panelVisibility = 'uploader';\n\t\t\t}\n\t\t},\n\t\thandleCreateDocumentClick()\n\t\t{\n\t\t\tif (this.panelVisibility === 'documents')\n\t\t\t{\n\t\t\t\tthis.panelVisibility = 'hidden';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.panelVisibility = 'documents';\n\t\t\t}\n\t\t},\n\t},\n\tcomputed: {\n\t\tuserFieldWidgetOptions(): UserFieldWidgetOptions\n\t\t{\n\t\t\tconst options: UserFieldWidgetOptions = {\n\t\t\t\tinsertIntoText: true,\n\t\t\t\t...this.widgetOptions,\n\t\t\t};\n\n\t\t\toptions.tileWidgetOptions = options.tileWidgetOptions || {};\n\t\t\toptions.tileWidgetOptions.enableDropzone = false;\n\n\t\t\tif (options.insertIntoText)\n\t\t\t{\n\t\t\t\toptions.tileWidgetOptions.events = options.tileWidgetOptions.events || {};\n\t\t\t\toptions.tileWidgetOptions.events.onInsertIntoText = (event: BaseEvent) => {\n\t\t\t\t\tthis.getRichTextArea().insertFile(event.getData().item);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Just in case\n\t\t\tdelete options.files; // use 'files' prop\n\t\t\tdelete options.eventObject;\n\t\t\tdelete options.mainPostFormId;\n\n\t\t\treturn options;\n\t\t},\n\t\tcanCreateDocuments(): boolean\n\t\t{\n\t\t\tconst settings = Extension.getSettings('disk.uploader.user-field-widget');\n\t\t\tconst canCreateDocuments = settings.get('canCreateDocuments', false);\n\n\t\t\treturn canCreateDocuments && this.widgetOptions.canCreateDocuments !== false;\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<RichTextAreaComponent\n\t\t\t:editor-options=\"getEditorOptions()\"\n\t\t\t:editor-instance=\"getEditorInstance()\"\n\t\t\t:uploader-options=\"getUploaderOptions()\"\n\t\t\t:uploader-instance=\"getUploaderInstance()\"\n\t\t\t:widget-options=\"getRichTextAreaWidgetOptions()\"\n\t\t\t:files=\"files\"\n\t\t\tref=\"richTextArea\"\n\t\t>\n\t\t\t<template #uploader=\"{ adapter }\">\n\t\t\t\t<UserFieldWidgetComponent\n\t\t\t\t\t:widgetOptions=\"userFieldWidgetOptions\"\n\t\t\t\t\t:uploader-adapter=\"adapter\"\n\t\t\t\t\t:visibility=\"panelVisibility\"\n\t\t\t\t\tref=\"userFieldWidget\"\n\t\t\t\t/>\n\t\t\t</template>\n\n\t\t\t<template #after-buttons v-if=\"$slots['after-buttons']\">\n\t\t\t\t<slot name=\"after-buttons\"></slot>\n\t\t\t</template>\n\t\t\t<template #file-button>\n\t\t\t\t<FileButton\n\t\t\t\t\t:selected=\"this.panelVisibility === 'uploader'\"\n\t\t\t\t\t:counter=\"fileCount\"\n\t\t\t\t\t@click=\"handleFileClick\" />\n\t\t\t\t<CreateDocumentButton\n\t\t\t\t\tv-if=\"canCreateDocuments\"\n\t\t\t\t\t:selected=\"this.panelVisibility === 'documents'\"\n\t\t\t\t\t@click=\"handleCreateDocumentClick\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template #before-buttons v-if=\"$slots['before-buttons']\">\n\t\t\t\t<slot name=\"before-buttons\"></slot>\n\t\t\t</template>\n\t\t</RichTextAreaComponent>\n\t`,\n};\n"],"names":["DiskRichTextAreaComponent","name","components","RichTextAreaComponent","UserFieldWidgetComponent","FileButton","CreateDocumentButton","props","editorOptions","type","Object","editorInstance","TextEditor","uploaderOptions","uploaderInstance","Uploader","widgetOptions","default","files","Array","data","fileCount","panelVisibility","methods","getUploaderOptions","imagePreviewHeight","imagePreviewWidth","imagePreviewQuality","treatOversizeImageAsFile","ignoreUnknownImageTypes","controller","multiple","maxFileSize","Type","isPlainObject","getUploaderInstance","getEditorOptions","file","mode","getEditorInstance","getRichTextAreaWidgetOptions","richTextOptions","events","event","getData","getUserFieldControl","getPhotoTemplateMode","setPhotoTemplate","hasInsertedItems","getRichTextArea","$refs","richTextArea","getEditor","getUploader","userFieldWidget","handleFileClick","handleCreateDocumentClick","computed","userFieldWidgetOptions","options","insertIntoText","tileWidgetOptions","enableDropzone","onInsertIntoText","insertFile","item","eventObject","mainPostFormId","canCreateDocuments","settings","Extension","getSettings","get","template"],"mappings":"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"}