(function(){BX.namespace("BX.Disk");if(BX.getClass("BX.Disk.Player")){return}BX.Disk.Player=function(r){this.isReady=false;if(BX.getClass("BX.Fileman.Player")&&BX.is_subclass_of(r,BX.Fileman.Player)){this.player=r;this.container=BX(r.id).parentNode;this.isReady=true;this.player.isDiskErrorShown=this.player.isDiskErrorShown||false;this.player.isDiskStatusChecked=this.player.isDiskStatusChecked||false}};BX.Disk.Player.adjustWidth=function(r,e,s,i,a){if(!BX.type.isDomNode(r)){return false}if(!e||!s||!i||!a){return false}if(a<s&&i<e){BX.width(r,i);return true}else{var t=e/s;var l=i/a;var n=1;if(t>l){n=s/a}else{n=e/i}BX.width(r,Math.floor(i*n))}return true};BX.Disk.Player.prototype.onAfterInit=function(){if(this.player.vjsPlayer.error()){this.onError()}else if(this.player.vjsPlayer.videoWidth()>0&&this.player.vjsPlayer.videoHeight()>0){this.adjust()}else{this.player.vjsPlayer.one("loadedmetadata",BX.proxy(this.adjust,this))}};BX.Disk.Player.prototype.adjust=function(){if(!this.container){return}if(!this.player.vjsPlayer){return}if(BX.hasClass(this.container,"player-adjust")){BX.addClass(this.container,"player-adjusting");if(BX.Disk.Player.adjustWidth(this.container,this.player.width,this.player.height,this.player.vjsPlayer.videoWidth(),this.player.vjsPlayer.videoHeight())){this.player.vjsPlayer.fluid(true)}}BX.addClass(this.container,"player-loaded")};BX.Disk.Player.prototype.onError=function(){if(this.container.getAttribute("data-bx-transform-info-url")){if(this.player.isDiskStatusChecked){return}this.player.isDiskStatusChecked=true;var r=this.container.getAttribute("data-bx-transform-info-url");BX.ajax({method:"GET",dataType:"json",url:r,onsuccess:BX.proxy(function(r){BX.addClass(this.container,"player-loaded");if(r.status&&r.status=="success"&&r.html){var e=BX.processHTML(r.html);this.container.innerHTML=e.HTML;if(e.SCRIPT){BX.ajax.processScripts(e.SCRIPT)}}else{this.showError()}},this),onfailure:BX.proxy(this.showError,this)})}else{this.showError()}};BX.Disk.Player.prototype.showError=function(){if(this.player.isDiskErrorShown){return}this.player.isDiskErrorShown=true;BX.addClass(this.container,"player-loaded");var r=BX.create("div",{props:{className:"disk-player-error-container"},style:{width:this.player.width+"px",height:this.player.height+"px"},children:[BX.create("div",{props:{className:"disk-player-error-icon"},html:""}),BX.create("div",{props:{className:"disk-player-error-message"},html:BX.message("DISK_JS_PLAYER_ERROR_MESSAGE")})]});var e=BX.findChildByClassName(r,"disk-player-download");if(e){var s="";if(BX.type.isArray(this.player.params.sources)){s=this.player.params.sources.slice(-1).pop().src}else if(BX.type.isPlainObject(this.player.params.sources)){s=this.player.params.sources.src}if(s){BX.adjust(e,{events:{click:function(){location.href=s}}})}}if(this.container){BX.hide(BX(this.player.id));BX.append(r,this.container)}else{BX.adjust(BX(this.player.id),{children:[r]})}};BX.ready(function(){BX.addCustomEvent("PlayerManager.Player:onAfterInit",function(r){if(r.skin!=="vjs-disk_player-skin"){return}var e=new BX.Disk.Player(r);if(e.isReady){e.onAfterInit()}});BX.addCustomEvent("PlayerManager.Player:onError",function(r){if(r.skin!=="vjs-disk_player-skin"){return}var e=new BX.Disk.Player(r);if(e.isReady){e.onError()}})})})(window);
//# sourceMappingURL=disk_player.map.js