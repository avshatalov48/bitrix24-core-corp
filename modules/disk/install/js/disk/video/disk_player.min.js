(function(){BX.namespace("BX.Disk");if(BX.getClass("BX.Disk.Player")){return}BX.Disk.Player=function(e){this.isReady=false;if(BX.getClass("BX.Fileman.Player")&&BX.is_subclass_of(e,BX.Fileman.Player)){this.player=e;this.container=BX(e.id).parentNode;this.isReady=true;this.player.isDiskErrorShown=this.player.isDiskErrorShown||false;this.player.isDiskStatusChecked=this.player.isDiskStatusChecked||false}};BX.Disk.Player.adjustWidth=function(e,r,s,i,t){if(!BX.type.isDomNode(e)){return false}if(!r||!s||!i||!t){return false}if(t<s&&i<r){BX.width(e,i);return true}else{var a=r/s;var n=i/t;var o=1;if(a>n){o=s/t}else{o=r/i}BX.width(e,Math.floor(i*o))}return true};BX.Disk.Player.prototype.onAfterInit=function(){if(this.player.vjsPlayer.error()){this.onError()}else if(this.player.vjsPlayer.videoWidth()>0&&this.player.vjsPlayer.videoHeight()>0){this.adjust()}else{this.player.vjsPlayer.one("loadedmetadata",BX.proxy(this.adjust,this))}};BX.Disk.Player.prototype.adjust=function(){if(!this.container){return}if(!this.player.vjsPlayer){return}if(BX.hasClass(this.container,"player-adjust")){if(BX.Disk.Player.adjustWidth(this.container,this.player.width,this.player.height,this.player.vjsPlayer.videoWidth(),this.player.vjsPlayer.videoHeight())){this.player.vjsPlayer.fluid(true)}}BX.addClass(this.container,"player-loaded");BX.style(this.container,"background-image","none")};BX.Disk.Player.prototype.onError=function(){if(this.container.getAttribute("data-bx-transform-info-url")){if(this.player.isDiskStatusChecked){return}this.player.isDiskStatusChecked=true;var e=this.container.getAttribute("data-bx-transform-info-url");BX.ajax({method:"GET",dataType:"json",url:e,onsuccess:BX.proxy(function(e){BX.addClass(this.container,"player-loaded");BX.style(this.container,"background-image","none");if(e.status&&e.status=="success"&&e.html){var r=BX.processHTML(e.html);this.container.innerHTML=r.HTML;if(r.SCRIPT){BX.ajax.processScripts(r.SCRIPT)}}else{this.showError()}},this),onfailure:BX.proxy(this.showError,this)})}else{this.showError()}};BX.Disk.Player.prototype.showError=function(){if(this.player.isDiskErrorShown){return}this.player.isDiskErrorShown=true;BX.addClass(this.container,"player-loaded");BX.style(this.container,"background-image","none");var e=BX.create("div",{props:{className:"disk-player-error-container"},style:{width:this.player.width+"px",height:this.player.height+"px"},children:[BX.create("div",{props:{className:"disk-player-error-icon"},html:""}),BX.create("div",{props:{className:"disk-player-error-message"},html:BX.message("DISK_JS_PLAYER_ERROR_MESSAGE")})]});var r=BX.findChildByClassName(e,"disk-player-download");if(r){var s="";if(BX.type.isArray(this.player.params.sources)){s=this.player.params.sources.slice(-1).pop().src}else if(BX.type.isPlainObject(this.player.params.sources)){s=this.player.params.sources.src}if(s){BX.adjust(r,{events:{click:function(){location.href=s}}})}}if(this.container){BX.hide(BX(this.player.id));BX.append(e,this.container)}else{BX.adjust(BX(this.player.id),{children:[e]})}};BX.ready(function(){BX.addCustomEvent("PlayerManager.Player:onAfterInit",function(e){if(e.skin!=="vjs-disk_player-skin"){return}var r=new BX.Disk.Player(e);if(r.isReady){r.onAfterInit()}});BX.addCustomEvent("PlayerManager.Player:onError",function(e){if(e.skin!=="vjs-disk_player-skin"){return}var r=new BX.Disk.Player(e);if(r.isReady){r.onError()}})})})(window);