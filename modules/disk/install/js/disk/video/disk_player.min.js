(function(){BX.namespace("BX.Disk");if(BX.getClass("BX.Disk.Player")){return}BX.Disk.Player=function(e){this.isReady=false;if(BX.getClass("BX.Fileman.Player")&&BX.is_subclass_of(e,BX.Fileman.Player)){this.player=e;this.container=BX(e.id).parentNode;this.isReady=true;this.player.isDiskErrorShown=this.player.isDiskErrorShown||false;this.player.isDiskStatusChecked=this.player.isDiskStatusChecked||false}};BX.Disk.Player.prototype.adjustWidth=function(e,s,r,t,i){if(!BX.type.isDomNode(e)){return false}if(!s||!r||!t||!i){return false}let a=Math.max(t,400);let l=Math.max(i,130);if(i>r||t>s){const e=s/r;const o=t/i;let n=1;if(e>o){n=r/i}else{n=s/t}a=Math.max(t*n,400);l=Math.max(i*n,130)}this.player.vjsPlayer.fluid(false);BX.Dom.style(e,"width",`${a}px`);BX.Dom.style(e,"height",`${l}px`);this.player.vjsPlayer.width("");this.player.vjsPlayer.height("");BX.Dom.style(this.player.vjsPlayer.el(),"width","100%");BX.Dom.style(this.player.vjsPlayer.el(),"min-width","300px");BX.Dom.style(this.player.vjsPlayer.el(),"aspect-ratio",`${a} / ${l}`);BX.Dom.style(this.player.vjsPlayer.el(),"height","auto");return true};BX.Disk.Player.prototype.onAfterInit=function(){if(this.player.vjsPlayer.error()){this.onError()}else if(this.player.vjsPlayer.videoWidth()>0&&this.player.vjsPlayer.videoHeight()>0){this.adjust()}else{this.player.vjsPlayer.one("loadedmetadata",BX.proxy(this.adjust,this))}};BX.Disk.Player.prototype.adjust=function(){if(!this.container){return}if(!this.player.vjsPlayer){return}BX.addClass(this.container,"player-adjusting");this.adjustWidth(this.container,this.player.width,this.player.height,this.player.vjsPlayer.videoWidth(),this.player.vjsPlayer.videoHeight());BX.addClass(this.container,"player-loaded")};BX.Disk.Player.prototype.onError=function(){if(this.container.getAttribute("data-bx-transform-info-url")){if(this.player.isDiskStatusChecked){return}this.player.isDiskStatusChecked=true;var e=this.container.getAttribute("data-bx-transform-info-url");BX.ajax({method:"GET",dataType:"json",url:e,onsuccess:BX.proxy((function(e){BX.addClass(this.container,"player-loaded");if(e.status&&e.status=="success"&&e.html){var s=BX.processHTML(e.html);this.container.innerHTML=s.HTML;if(s.SCRIPT){BX.ajax.processScripts(s.SCRIPT)}}else{this.showError()}}),this),onfailure:BX.proxy(this.showError,this)})}else{this.showError()}};BX.Disk.Player.prototype.showError=function(){if(this.player.isDiskErrorShown){return}this.player.isDiskErrorShown=true;BX.addClass(this.container,"player-loaded");var e=BX.create("div",{props:{className:"disk-player-error-container"},style:{width:this.player.width+"px",height:this.player.height+"px"},children:[BX.create("div",{props:{className:"disk-player-error-icon"},html:""}),BX.create("div",{props:{className:"disk-player-error-message"},html:BX.message("DISK_JS_PLAYER_ERROR_MESSAGE")})]});var s=BX.findChildByClassName(e,"disk-player-download");if(s){var r="";if(BX.type.isArray(this.player.params.sources)){r=this.player.params.sources.slice(-1).pop().src}else if(BX.type.isPlainObject(this.player.params.sources)){r=this.player.params.sources.src}if(r){BX.adjust(s,{events:{click:function(){location.href=r}}})}}if(this.container){BX.hide(BX(this.player.id));BX.append(e,this.container)}else{BX.adjust(BX(this.player.id),{children:[e]})}};BX.ready((function(){BX.addCustomEvent("PlayerManager.Player:onAfterInit",(function(e){if(e.skin!=="vjs-disk_player-skin"){return}var s=new BX.Disk.Player(e);if(s.isReady){s.onAfterInit()}}));BX.addCustomEvent("PlayerManager.Player:onError",(function(e){if(e.skin!=="vjs-disk_player-skin"){return}var s=new BX.Disk.Player(e);if(s.isReady){s.onError()}}))}))})(window);
//# sourceMappingURL=disk_player.map.js