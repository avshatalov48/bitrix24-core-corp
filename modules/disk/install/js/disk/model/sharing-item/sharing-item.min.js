(function(){"use strict";BX.namespace("BX.Disk.Model");BX.Disk.Model.SharingItem=function(e){BX.Disk.Model.Item.apply(this,arguments);this.templateId=this.templateId||"sharing-item"};BX.Disk.Model.SharingItem.prototype={__proto__:BX.Disk.Model.Item.prototype,constructor:BX.Disk.Model.SharingItem,bindEvents:function(){var e=this.getContainer();var t=this.getEntity(e,"sharing-item-delete");if(t){BX.bind(t,"click",this.handleDeleteSharing.bind(this))}var a=this.getEntity(e,"sharing-item-change-right");if(a){BX.bind(a,"click",this.handleChangeRight.bind(this))}BX.addCustomEvent("Disk.FileView:onUnSelectSelectorItem",this.removeOnUnSelect.bind(this))},removeOnUnSelect:function(e){if(e.item.id===this.state.entity.id){this.remove();this.deleteSharing()}},deleteSharing:function(){if(this.state.sharing.id){BX.ajax.runAction("disk.api.sharing.delete",{data:{sharingId:this.state.sharing.id}}).then(function(e){if(BX.UI.SelectorManager){var t=BX.UI.SelectorManager.instances["disk-file-add-sharing"];if(t){t.getRenderInstance().deleteItem({entityType:this.state.entity.type,itemId:this.state.entity.id})}}else{BX.SocNetLogDestination.deleteItem(this.state.entity.id,this.state.entity.type,"disk-file-add-sharing")}}.bind(this))}},handleDeleteSharing:function(e){this.remove();this.deleteSharing()},changeRight:function(e,t){t.getMenuWindow().close();this.state.sharing.taskName=t.taskName;this.state.sharing.name=BX.Disk.getRightLabelByTaskName(t.taskName);this.render();this.save()},handleChangeRight:function(t){var a=BX.getEventTarget(t);var s="menu-rights"+this.state.id;var i=this.changeRight.bind(this);BX.PopupMenu.show(s,BX(a),[e(this.state.sharing.maxTaskName,"disk_access_read")>=0?{text:BX.message("DISK_JS_SHARING_LABEL_RIGHT_READ"),className:"disk-detail-user-access",taskName:"disk_access_read",onclick:i}:null,e(this.state.sharing.maxTaskName,"disk_access_add")>=0?{text:BX.message("DISK_JS_SHARING_LABEL_RIGHT_ADD"),className:"disk-detail-user-access",taskName:"disk_access_add",onclick:i}:null,e(this.state.sharing.maxTaskName,"disk_access_edit")>=0?{text:BX.message("DISK_JS_SHARING_LABEL_RIGHT_EDIT"),className:"disk-detail-user-access",taskName:"disk_access_edit",onclick:i}:null,e(this.state.sharing.maxTaskName,"disk_access_full")>=0?{text:BX.message("DISK_JS_SHARING_LABEL_RIGHT_FULL"),className:"disk-detail-user-access",taskName:"disk_access_full",onclick:i}:null],{angle:true,autoHide:true,className:"disk-detail-user-access-popup",offsetLeft:20,overlay:{opacity:.01},zIndex:BX.getClass("BX.SidePanel.Instance")&&BX.SidePanel.Instance.isOpen()?BX.SidePanel.Instance.getTopSlider().getZindex():null,events:{onPopupClose:function(){BX.PopupMenu.destroy(s)}}})},save:function(){BX.ajax.runAction("disk.api.sharing.changeTaskName",{data:{sharingId:this.state.sharing.id,newTaskName:this.state.sharing.taskName}}).then(function(e){})}};BX.Disk.Model.DraftSharingItem=function(e){BX.Disk.Model.SharingItem.apply(this,arguments);if(!this.state.sharing){this.state.sharing={canDelete:true,canChange:true,name:BX.Disk.getRightLabelByTaskName("disk_access_read"),taskName:"disk_access_read",maxTaskName:"disk_access_full"}}};BX.Disk.Model.DraftSharingItem.prototype={__proto__:BX.Disk.Model.Item.prototype,constructor:BX.Disk.Model.DraftSharingItem,getAdditionalContainerClasses:function(){return["disk-item-container-disabled"]},save:function(){BX.ajax.runAction("disk.api.file.addSharing",{data:{fileId:this.state.object.id,entity:this.state.entity.id,taskName:this.state.sharing.taskName}}).then(function(e){if(e.data&&e.data.sharing.id){this.state.sharing.id=e.data.sharing.id;this.replaceByRealItem();var t=BX.SidePanel.Instance.getSliderByWindow(window);if(t){BX.SidePanel.Instance.postMessageAll(window,"Disk.File:onAddSharing",{objectId:this.state.object.id})}}}.bind(this))},replaceByRealItem:function(){var e=new BX.Disk.Model.SharingItem({state:this.state});e.render();this.getContainer().parentNode.replaceChild(e.getContainer(),this.getContainer());this.remove()}};function e(e,t){var a;var s;switch(e){case"disk_access_read":a=2;break;case"disk_access_add":a=3;break;case"disk_access_edit":a=4;break;case"disk_access_full":a=5;break;default:return 0}switch(t){case"disk_access_read":s=2;break;case"disk_access_add":s=3;break;case"disk_access_edit":s=4;break;case"disk_access_full":s=5;break;default:return 0}if(a==s){return 0}return a>s?1:-1}})();
//# sourceMappingURL=sharing-item.map.js