BX.namespace("BX.Disk.Desktop.Settings");BX.Disk.Desktop.Settings=function(){var e=null;var s=null;var i=function(i){i=i||{};e=i.bxim;s=i.diskEnabled;this.setEvents()};i.prototype.setEvents=function(){};i.prototype.getFolderList=function(e){var s=BXFileStorage.GetFolderList();var i=[];for(var t=0,l=s.length;t<l;t++){var n=s[t];var o=n[0];var a=!!n[1];var r=!!n[2];if(o.lastIndexOf("/")>1)continue;if(e==="all"){i.push({path:o,isSymlink:a,isSynced:r})}else if(e==="own"&&!a){i.push({path:o,isSymlink:a,isSynced:r})}else if(e==="shared"&&a){i.push({path:o,isSymlink:a,isSynced:r})}}BX.util.objectSort(s,"path","asc");return i};i.prototype.buildFolderNotice=function(e){if(e==="own"){return'<div id="bx-disk-sync-folder-'+e+'" class="bx-im-notice">'+BX.message("DISK_DESKTOP_JS_SETTINGS_SYNC_EMPTY_OWN_FOLDER_NOTICE")+"</div>"}if(e==="shared"){return'<div id="bx-disk-sync-folder-'+e+'" class="bx-im-notice" style="display:none">'+BX.message("DISK_DESKTOP_JS_SETTINGS_SYNC_EMPTY_SHARED_FOLDER_NOTICE")+"</div>"}};i.prototype.buildFolderList=function(e,s){if(e.length<=0){return this.buildFolderNotice(s)}var i=!this.isEnabledSyncCustomFoldersByType(s);var t='<ul id="bx-disk-sync-folder-'+s+'" class="bx-im-disk-list-block" '+(s=="shared"?'style="display:none"':"")+">"+'<li class="bx-im-disk-list-item">'+'<input onclick="BitrixDiskSettings.onClickSyncAllFolder(this);" name="sync-all-'+s+'" data-save=1 type="checkbox" '+(i?'checked="checked"':"")+' class="bx-im-disk-checkbox sync-all-folder" id="bx-disk-sync-all-folder'+s+'"><label class="bx-im-disk-label" for="bx-disk-sync-all-folder'+s+'">'+BX.message("DISK_DESKTOP_JS_SETTINGS_SYNC_ALL")+"</label>"+"</li>";for(var l=0,n=e.length;l<n;l++){var o=e[l];var a=o.path.split("/").pop();t+='<li class="bx-im-disk-list-item">'+'<input onclick="BitrixDiskSettings.onClickSyncFolder(this);" name="sync-'+a+'" data-save=1 type="checkbox" '+(o.isSynced?'checked="checked"':"")+' class="bx-im-disk-checkbox" id="f-'+a+'"><label class="bx-im-disk-label" for="f-'+a+'">'+a+"</label>"+"</li>"}t+="</ul>";return t};i.prototype.fillFolderList=function(){var e=this.buildFolderList(this.getFolderList("own"),"own");var s=this.buildFolderList(this.getFolderList("shared"),"shared");if(BX("bx-im-disk-folders-setting-block-wrap")){BX("bx-im-disk-folders-setting-block-wrap").innerHTML='<div class="bx-im-disk-btn-wrap">'+'<span id="bx-disk-header-sync-folder-own" onclick="BitrixDiskSettings.onClickTab(\'own\', \'shared\');" class="bx-im-disk-btn bx-im-disk-btn-active"><span class="bx-disk-tab-btn-text">'+BX.message("DISK_DESKTOP_JS_SETTINGS_SYNC_TAB_OWNER")+'</span></span><span id="bx-disk-header-sync-folder-shared"  onclick="BitrixDiskSettings.onClickTab(\'shared\', \'own\');" class="bx-im-disk-btn"><span class="bx-disk-tab-btn-text">'+BX.message("DISK_DESKTOP_JS_SETTINGS_SYNC_TAB_SHARED")+"</span></span>"+"</div>"+e+s+'<div id="bx-disk-settings-shared-folder-notice" class="bx-im-notice" style="display: none">'+BX.message("DISK_DESKTOP_JS_SETTINGS_SYNC_FOLDER_NOTICE")+"</div>"}};i.prototype.prepareSettingsView=function(){e.settingsView.disk={title:BX.message("DISK_DESKTOP_JS_SETTINGS_TITLE"),settings:[{title:BX.message("DISK_DESKTOP_JS_SETTINGS_LABEL_ENABLE"),type:"checkbox",name:"diskEnabled",checked:s,callback:function(){}},{title:BX.message("DISK_DESKTOP_JS_SETTINGS_LABEL_FILE_CLICK_ACTION"),type:"select",value:this.getFileClickActionName(),name:"fileClickAction",items:[{title:BX.message("DISK_DESKTOP_JS_SETTINGS_LABEL_FILE_CLICK_ACTION_OPEN_FOLDER"),value:"openFolder"},{title:BX.message("DISK_DESKTOP_JS_SETTINGS_LABEL_FILE_CLICK_ACTION_OPEN_FILE"),value:"openFile"}],callback:function(){}}]};if(s&&BX.desktop.enableInVersion(42)){e.settingsView.disk.settings.push({title:BX.message("DISK_DESKTOP_JS_SETTINGS_SYNC_MAKE_CHOICE"),type:"checkbox",name:"diskCustomFolders",callback:function(){if(this.checked){BX.show(BX("bx-im-disk-folders-setting-block-wrap","block"));BX.desktop.resize()}else{BX.hide(BX("bx-im-disk-folders-setting-block-wrap"));BX.desktop.resize()}},checked:this.isEnabledSyncCustomFolders()},{type:"space"},{title:"Settings",type:"html",name:"custom_folders",value:'<div id="bx-im-disk-folders-setting-block-wrap" class="bx-im-disk-setting-block-wrap" '+(this.isEnabledSyncCustomFolders()?"":'style="display: none"')+">"+"</div>",callback:function(){}})}};i.prototype.onClickSyncAllFolder=function(e){var s=BX.findParent(e,{tagName:"ul"},4);if(!s)return false;var i=BX.findChildren(s,{tagName:"input",className:"bx-im-disk-checkbox"},true);for(var t in i){if(!i.hasOwnProperty(t))continue;i[t].checked=e.checked}return false};i.prototype.onClickSyncFolder=function(e){if(e.checked)return false;var s=BX.findParent(e,{tagName:"ul"},4);if(!s)return false;var i=BX.findChild(s,{tagName:"input",className:"bx-im-disk-checkbox sync-all-folder"},true);if(!i)return false;i.checked=false};i.prototype.onClickTab=function(e,s){var i=BX("bx-disk-header-sync-folder-"+e);var t=BX("bx-disk-header-sync-folder-"+s);if(BX.hasClass(i,"bx-im-disk-btn-active"))return false;BX.removeClass(t,"bx-im-disk-btn-active");BX.addClass(i,"bx-im-disk-btn-active");BX.hide(BX("bx-disk-sync-folder-"+s));BX.show(BX("bx-disk-sync-folder-"+e),"block");if(e==="shared")BX.show(BX("bx-disk-settings-shared-folder-notice"),"block");else BX.hide(BX("bx-disk-settings-shared-folder-notice"));BX.desktop.resize();return false};i.prototype.saveSettings=function(e){e=e||{};if(e.fileClickAction){this.setFileClickActionName(e.fileClickAction)}this.storeSyncCustomFolders(e.diskCustomFolders);if(!e.diskCustomFolders){this.subscribeByTypeRootFolders("all")}else{if(e["sync-all-own"]){this.subscribeByTypeRootFolders("own")}if(e["sync-all-shared"]){this.subscribeByTypeRootFolders("shared")}if(!e["sync-all-own"]||!e["sync-all-shared"]){for(var s in e){if(!e.hasOwnProperty(s))continue;if(s.indexOf("sync-")===0&&s.indexOf("sync-all-")===-1){if(!e[s]){console.debug("UnsubscribeFolder","/"+s.substr(5));BXFileStorage.UnsubscribeFolder("/"+s.substr(5))}else{console.debug("subscribeFolder","/"+s.substr(5));BXFileStorage.SubscribeFolder("/"+s.substr(5))}}}}}};i.prototype.subscribeByTypeRootFolders=function(e){var s=this.getFolderList(e);for(var i=0,t=s.length;i<t;i++){var l=s[i];BXFileStorage.SubscribeFolder(l.path)}};i.prototype.getFileClickActionName=function(){var s=e.getLocalConfig("fileClickAction",{name:"openFolder"});return s.name};i.prototype.setFileClickActionName=function(s){e.setLocalConfig("ww",s);switch(s){case"openFolder":case"openFile":break;default:s="openFolder"}e.setLocalConfig("fileClickAction",{name:s})};i.prototype.isEnabledSyncCustomFoldersByType=function(e){var s=this.getFolderList(e);for(var i=0,t=s.length;i<t;i++){if(!s[i].isSynced)return true}return false};i.prototype.isEnabledSyncCustomFolders=function(){var s=e.getLocalConfig("diskCustomFolders",{enabled:false});return s.enabled};i.prototype.storeSyncCustomFolders=function(s){e.setLocalConfig("diskCustomFolders",{enabled:!!s})};return i}();