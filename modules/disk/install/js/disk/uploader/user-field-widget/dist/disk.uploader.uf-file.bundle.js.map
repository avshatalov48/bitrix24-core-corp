{"version":3,"file":"disk.uploader.uf-file.bundle.js","sources":["../src/integration/html-parser.js","../src/integration/main-post-form.js","../src/user-field-control.js","../src/helpers/load-disk-file-dialog.js","../src/item-menu.js","../src/settings-menu.js","../src/helpers/open-disk-file-dialog.js","../src/helpers/cloud-load-controller.js","../src/helpers/cloud-upload-controller.js","../src/helpers/open-cloud-file-dialog.js","../src/components/loader.js","../src/components/control-panel.js","../src/components/document-panel.js","../src/user-field-widget-component.js","../src/user-field-widget.js"],"sourcesContent":["import { Text, Runtime } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { UploaderFile } from 'ui.uploader.core';\n\nimport type { TileWidgetItem } from 'ui.uploader.tile-widget';\nimport type MainPostForm from './main-post-form';\n\nexport default class HtmlParser\n{\n\t#form: MainPostForm = null;\n\t#parserId = 'diskfile0';\n\t#tag: string = '[DISK FILE ID=#id#]';\n\t#regexp: RegExp = /\\[(?:DOCUMENT ID|DISK FILE ID)=(n?[0-9]+)\\]/ig;\n\tsyncHighlightsDebounced: Function = null;\n\n\tconstructor(form: MainPostForm)\n\t{\n\t\tthis.#form = form;\n\n\t\tthis.syncHighlightsDebounced = Runtime.debounce(this.syncHighlights, 500, this);\n\n\t\t// BBCode Parser Registration ([DISK FILE ID=190])\n\t\tEventEmitter.emit(this.#form.getEventObject(), 'OnParserRegister', this.getParser());\n\t}\n\n\tgetParser(): Object<string, any>\n\t{\n\t\treturn {\n\t\t\tid: this.#parserId,\n\t\t\tinit: this.#init.bind(this),\n\t\t\tparse: this.#parse.bind(this),\n\t\t\tunparse: this.#unparse.bind(this),\n\t\t};\n\t}\n\n\t/**\n\t *\n\t * @returns {Window.BXEditor}\n\t */\n\tgetHtmlEditor()\n\t{\n\t\treturn this.#form.getHtmlEditor();\n\t}\n\n\tinsertFile(file: UploaderFile): void\n\t{\n\t\tconst bbDelimiter: string = file.isImage() ? '\\n' : ' ';\n\t\tconst htmlDelimiter: string = file.isImage() ? '<br>' : '&nbsp;';\n\n\t\tEventEmitter.emit(this.getHtmlEditor(), 'OnInsertContent', [\n\t\t\tbbDelimiter + this.createItemBBCode(file) + bbDelimiter,\n\t\t\thtmlDelimiter + this.createItemHtml(file) + htmlDelimiter,\n\t\t]);\n\n\t\tthis.syncHighlights();\n\t}\n\n\tremoveFile(item: TileWidgetItem): void\n\t{\n\t\tif (this.getHtmlEditor().GetViewMode() === 'wysiwyg')\n\t\t{\n\t\t\tconst doc = this.getHtmlEditor().GetIframeDoc();\n\t\t\tObject.keys(this.getHtmlEditor().bxTags).forEach((tagId: string) => {\n\t\t\t\tconst tag = this.getHtmlEditor().bxTags[tagId];\n\t\t\t\tif (tag.tag === this.#parserId && tag.serverFileId === item.serverFileId)\n\t\t\t\t{\n\t\t\t\t\tconst node = doc.getElementById(tagId);\n\t\t\t\t\tif (node)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.getHtmlEditor().SaveContent();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst content = this.getHtmlEditor().GetContent().replace(\n\t\t\t\tthis.#regexp,\n\t\t\t\t(str, foundId): string => {\n\t\t\t\t\tconst { objectId, attachedId } = this.#getIds(foundId);\n\t\t\t\t\tconst items: TileWidgetItem[] = this.#form.getUserFieldControl().getItems();\n\t\t\t\t\tconst item: TileWidgetItem = items.find((item: TileWidgetItem) => {\n\t\t\t\t\t\treturn item.serverFileId === attachedId || item.customData.objectId === objectId;\n\t\t\t\t\t});\n\n\t\t\t\t\treturn item ? '' : str;\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tthis.getHtmlEditor().SetContent(content);\n\t\t\tthis.getHtmlEditor().Focus();\n\t\t}\n\n\t\tthis.syncHighlights();\n\t}\n\n\tselectItem(file: UploaderFile): void\n\t{\n\t\tfile.setCustomData('tileSelected', true);\n\t}\n\n\tdeselectItem(file: UploaderFile): void\n\t{\n\t\tfile.setCustomData('tileSelected', false);\n\t}\n\n\tsyncHighlights(): void\n\t{\n\t\tconst doc = this.getHtmlEditor().GetIframeDoc();\n\t\tconst inserted: Set<number | string> = new Set();\n\t\tObject.keys(this.getHtmlEditor().bxTags).forEach((tagId: string): void => {\n\t\t\tconst tag = this.getHtmlEditor().bxTags[tagId];\n\t\t\tif (tag.tag === this.#parserId && doc.getElementById(tagId))\n\t\t\t{\n\t\t\t\tinserted.add(tag.serverFileId);\n\t\t\t}\n\t\t});\n\n\t\tlet hasInsertedItems = false;\n\n\t\tconst files: UploaderFile[] = this.#form.getUserFieldControl().getFiles();\n\t\tfiles.forEach((file: UploaderFile): void => {\n\t\t\tif (inserted.has(file.getServerFileId()))\n\t\t\t{\n\t\t\t\thasInsertedItems = true;\n\t\t\t\tthis.selectItem(file);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.deselectItem(file);\n\t\t\t}\n\t\t});\n\n\t\tif (this.#form.getUserFieldControl().getPhotoTemplateMode() === 'auto')\n\t\t{\n\t\t\tthis.#form.getUserFieldControl().setPhotoTemplate(hasInsertedItems ? 'gallery' : 'grid');\n\t\t}\n\t}\n\n\tcreateItemHtml(file: UploaderFile, id: string): string\n\t{\n\t\tconst tagId = this.getHtmlEditor().SetBxTag(false, {\n\t\t\ttag: this.#parserId,\n\t\t\tserverFileId: file.getServerFileId(),\n\t\t\thideContextMenu: true,\n\t\t\tfileId: file.getServerFileId(),\n\t\t});\n\n\t\tif (file.isImage())\n\t\t{\n\t\t\tconst imageSrc = this.getHtmlEditor().bbCode ? file.getPreviewUrl() : file.getServerPreviewUrl();\n\t\t\tconst previewWidth = this.getHtmlEditor().bbCode ? file.getPreviewWidth() : file.getServerPreviewWidth();\n\t\t\tconst previewHeight = this.getHtmlEditor().bbCode ? file.getPreviewHeight() : file.getServerPreviewHeight();\n\n\t\t\tconst renderWidth = 600; // half size of imagePreviewWidth\n\t\t\tconst renderHeight = 600; // half size of imagePreviewHeight\n\t\t\tconst ratioWidth: number = renderWidth / previewWidth;\n\t\t\tconst ratioHeight: number = renderHeight / previewHeight;\n\t\t\tconst ratio: number = Math.min(ratioWidth, ratioHeight);\n\n\t\t\tconst useOriginalSize = ratio > 1; // image is too small\n\t\t\tconst width = useOriginalSize ? previewWidth : previewWidth * ratio;\n\t\t\tconst height = useOriginalSize ? previewHeight : previewHeight * ratio;\n\n\t\t\treturn `<img style=\"max-width: 90%;\" width=\"${width}\" height=\"${height}\" data-bx-file-id=\"${Text.encode(file.getServerFileId())}\" id=\"${tagId}\" src=\"${imageSrc}\" title=\"${Text.encode(file.getName())}\" data-bx-paste-check=\"Y\" />`;\n\t\t}\n\t\telse if (file.getCustomData('fileType') === 'player')\n\t\t{\n\t\t\treturn `<img contenteditable=\"false\" class=\"bxhtmled-player-surrogate\" data-bx-file-id=\"${Text.encode(file.getServerFileId())}\" id=\"${tagId}\" src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-bx-paste-check=\"Y\" />`;\n\t\t}\n\n\t\treturn `<span contenteditable=\"false\" data-bx-file-id=\"${Text.encode(file.getServerFileId())}\" id=\"${tagId}\" style=\"color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;\">${Text.encode(file.getName())}</span>`;\n\t}\n\n\tcreateItemBBCode(file: UploaderFile): string\n\t{\n\t\treturn this.#tag.replace('#id#', file.getServerFileId());\n\t}\n\n\t#init(htmlEditor): void\n\t{\n\t\t// stub\n\t}\n\n\t#parse(content): string\n\t{\n\t\tif (!this.#regexp.test(content))\n\t\t{\n\t\t\treturn content;\n\t\t}\n\n\t\tthis.syncHighlightsDebounced();\n\n\t\treturn content.replace(\n\t\t\tthis.#regexp,\n\t\t\t(str, id): string => {\n\t\t\t\tconst { objectId, attachedId } = this.#getIds(id);\n\n\t\t\t\tconst files: UploaderFile[] = this.#form.getUserFieldControl().getFiles();\n\t\t\t\tconst insertedFile: UploaderFile = files.find((file: UploaderFile) => {\n\t\t\t\t\treturn file.getServerFileId() === attachedId || file.getCustomData('objectId') === objectId;\n\t\t\t\t});\n\n\t\t\t\tif (insertedFile)\n\t\t\t\t{\n\t\t\t\t\tthis.selectItem(insertedFile);\n\n\t\t\t\t\treturn this.createItemHtml(insertedFile, id);\n\t\t\t\t}\n\n\t\t\t\treturn str;\n\t\t\t},\n\t\t);\n\t}\n\n\t#unparse(bxTag): string\n\t{\n\t\tconst { serverFileId } = bxTag;\n\n\t\tconst files: UploaderFile[] = this.#form.getUserFieldControl().getFiles();\n\t\tconst uploaderFile: UploaderFile = files.find((file: UploaderFile): boolean => {\n\t\t\treturn file.getServerFileId() === serverFileId;\n\t\t});\n\n\t\tif (uploaderFile)\n\t\t{\n\t\t\treturn this.createItemBBCode(uploaderFile);\n\t\t}\n\n\t\treturn '';\n\t}\n\n\t#getIds(id: string): { objectId: ?number, attachedId: ?number}\n\t{\n\t\tlet objectId: ?number = null;\n\t\tlet attachedId: ?number = null;\n\t\tif (id[0] === 'n')\n\t\t{\n\t\t\tobjectId = Text.toInteger(id.replace('n', ''));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tattachedId = Text.toInteger(id);\n\t\t}\n\n\t\treturn { objectId, attachedId };\n\t}\n}\n","import { Type, Event, Reflection, Loc, Tag } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { FileEvent, UploaderFile, UploaderError, getFilesFromDataTransfer, isFilePasted } from 'ui.uploader.core';\n\nimport HtmlParser from './html-parser';\n\nimport type { TileWidgetItem } from 'ui.uploader.tile-widget';\nimport type { VueUploaderAdapter } from 'ui.uploader.vue';\nimport type UserFieldControl from '../user-field-control';\n\nexport default class MainPostForm extends EventEmitter\n{\n\t#userFieldControl: UserFieldControl = null;\n\t#createDocumentButton: HTMLElement = null;\n\t#eventObject: HTMLElement = null;\n\t#htmlParser: HtmlParser = null;\n\t#htmlEditor = null;\n\t#inited = false;\n\n\tconstructor(userFieldControl: UserFieldControl, options: Object<string, any>)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Disk.Uploader.Integration');\n\n\t\tthis.#userFieldControl = userFieldControl;\n\t\tthis.#eventObject = options.eventObject;\n\n\t\tthis.#bindEventObject();\n\n\t\tthis.subscribeFromOptions(options.events);\n\n\t\tthis.subscribeOnce('onReady', (): void => {\n\t\t\tif (this.#userFieldControl.canCreateDocuments())\n\t\t\t{\n\t\t\t\tthis.#addCreateDocumentButton();\n\t\t\t}\n\t\t});\n\n\t\tthis.#userFieldControl.subscribe('onUploaderPanelToggle', this.#handleUploaderPanelToggle.bind(this));\n\t\tthis.#userFieldControl.subscribe('onDocumentPanelToggle', this.#handleDocumentPanelToggle.bind(this));\n\n\t\tEvent.ready(this.#handleDocumentReady.bind(this));\n\t}\n\n\tgetUserFieldControl(): UserFieldControl\n\t{\n\t\treturn this.#userFieldControl;\n\t}\n\n\tgetParser(): HtmlParser\n\t{\n\t\treturn this.#htmlParser;\n\t}\n\n\t/**\n\t *\n\t * @returns {BXEditor}\n\t */\n\tgetHtmlEditor()\n\t{\n\t\treturn this.#htmlEditor;\n\t}\n\n\tgetEventObject(): HTMLElement\n\t{\n\t\treturn this.#eventObject;\n\t}\n\n\tselectFileButton(): void\n\t{\n\t\tconst event: BaseEvent = new BaseEvent({\n\t\t\tdata: 'show',\n\t\t\t// needs to determine our own event (main.post.form emits onShowControllers as well)\n\t\t\tcompatData: ['user-field-widget'],\n\t\t});\n\n\t\tEventEmitter.emit(this.#eventObject, 'onShowControllers', event);\n\t}\n\n\tdeselectFileButton(): void\n\t{\n\t\tconst event: BaseEvent = new BaseEvent({\n\t\t\tdata: 'hide',\n\t\t\t// needs to determine our own event (main.post.form emits onShowControllers as well)\n\t\t\tcompatData: ['user-field-widget'],\n\t\t});\n\n\t\tEventEmitter.emit(this.#eventObject, 'onShowControllers', event);\n\t}\n\n\tselectCreateDocumentButton(): void\n\t{\n\t\tif (this.#createDocumentButton)\n\t\t{\n\t\t\tconst container: HTMLElement = this.#createDocumentButton.closest('[data-id=\"disk-document\"]');\n\t\t\tif (container)\n\t\t\t{\n\t\t\t\tcontainer.setAttribute('data-bx-button-status', 'active');\n\t\t\t}\n\t\t}\n\t}\n\n\tdeselectCreateDocumentButton(): void\n\t{\n\t\tif (this.#createDocumentButton)\n\t\t{\n\t\t\tconst container: HTMLElement = this.#createDocumentButton.closest('[data-id=\"disk-document\"]');\n\t\t\tif (container)\n\t\t\t{\n\t\t\t\tcontainer.removeAttribute('data-bx-button-status');\n\t\t\t}\n\t\t}\n\t}\n\n\t#handleDocumentReady(): void\n\t{\n\t\tconst postForm = this.#getPostForm();\n\t\tif (postForm === null)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst postForm = this.#getPostForm();\n\t\t\t\tif (postForm)\n\t\t\t\t{\n\t\t\t\t\tthis.#handlePostFormReady(postForm);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.error('Disk User Field: Post Form Not Found.');\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#handlePostFormReady(postForm);\n\t\t}\n\t}\n\n\t#handlePostFormReady(postForm: PostForm)\n\t{\n\t\tif (postForm.isReady)\n\t\t{\n\t\t\tthis.#init(postForm);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEventEmitter.subscribe(postForm, 'OnEditorIsLoaded', (): void => {\n\t\t\t\tthis.#init(postForm);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @param {PostForm} postForm\n\t */\n\t#init(postForm)\n\t{\n\t\tthis.#bindAdapterEvents();\n\n\t\tthis.#htmlEditor = postForm.getEditor();\n\t\tthis.#htmlParser = new HtmlParser(this);\n\n\t\tEventEmitter.subscribe(this.#htmlEditor, 'OnContentChanged', (event: BaseEvent) => {\n\t\t\tthis.#htmlParser.syncHighlightsDebounced();\n\t\t});\n\n\t\tEventEmitter.subscribe(this.#htmlEditor, 'BXEditor:onBeforePasteAsync', (event: BaseEvent) => {\n\t\t\treturn new Promise((resolve, reject): void => {\n\t\t\t\tconst clipboardEvent: ClipboardEvent = event.getData().clipboardEvent;\n\t\t\t\tconst clipboardData: DataTransfer = clipboardEvent.clipboardData;\n\n\t\t\t\tclipboardEvent.stopImmediatePropagation(); // Skip HTML Editor InitClipboardHandler\n\t\t\t\tif (!clipboardData || !isFilePasted(clipboardData))\n\t\t\t\t{\n\t\t\t\t\tresolve();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tclipboardEvent.preventDefault(); // Prevent Browser behavior\n\t\t\t\tevent.preventDefault(); // Prevent invoking HTMLEditor Paste Handler (OnPasteHandler)\n\n\t\t\t\tgetFilesFromDataTransfer(clipboardData)\n\t\t\t\t\t.then((files: File[]): void => {\n\t\t\t\t\t\tfiles.forEach((file: File): void => {\n\t\t\t\t\t\t\tthis.getUserFieldControl().getUploader().addFile(file, {\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t[FileEvent.LOAD_ERROR]: () => {},\n\t\t\t\t\t\t\t\t\t[FileEvent.UPLOAD_ERROR]: () => {},\n\t\t\t\t\t\t\t\t\t[FileEvent.LOAD_COMPLETE]: (event: BaseEvent): void => {\n\t\t\t\t\t\t\t\t\t\t// const file: UploaderFile = event.getTarget();\n\t\t\t\t\t\t\t\t\t\t// const item: TileWidgetItem = this.getUserFieldControl().getItem(file.getId());\n\t\t\t\t\t\t\t\t\t\t// We could try insert a file/image stub.\n\t\t\t\t\t\t\t\t\t\t// if (item)\n\t\t\t\t\t\t\t\t\t\t// {\n\t\t\t\t\t\t\t\t\t\t// \tthis.getUserFieldControl().show();\n\t\t\t\t\t\t\t\t\t\t// \tthis.getParser().insertFile(item);\n\t\t\t\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t[FileEvent.UPLOAD_COMPLETE]: (event: BaseEvent): void => {\n\t\t\t\t\t\t\t\t\t\tconst uploadedFile: UploaderFile = event.getTarget();\n\t\t\t\t\t\t\t\t\t\tthis.getUserFieldControl().showUploaderPanel();\n\t\t\t\t\t\t\t\t\t\tthis.getParser().insertFile(uploadedFile);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((): void => {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t});\n\t\t});\n\n\t\tthis.emit('onReady');\n\n\t\tthis.#inited = true;\n\t}\n\n\t#getPostForm()\n\t{\n\t\tconst PostForm: Class = Reflection.getClass('BX.Main.PostForm');\n\t\tif (!PostForm)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet result = null;\n\t\tPostForm.repo.forEach((editor) => {\n\t\t\tif (editor.getEventObject() === this.getEventObject())\n\t\t\t{\n\t\t\t\tresult = editor;\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t#bindEventObject(): void\n\t{\n\t\t// Show / Hide files control panel\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onShowControllers', (event: BaseEvent): void => {\n\t\t\tif (Type.isArrayFilled(event.getCompatData()) && event.getCompatData()[0] === 'user-field-widget')\n\t\t\t{\n\t\t\t\t// Skip our own event (main.post.form emits onShowControllers as well).\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst status = Type.isArray(event.getData()) ? event.getData().shift() : event.getData();\n\t\t\tif (status === 'show')\n\t\t\t{\n\t\t\t\tthis.getUserFieldControl().showUploaderPanel();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getUserFieldControl().hide();\n\t\t\t}\n\t\t});\n\n\t\t// Inline a post/comment editing\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onReinitializeBeforeAsync', (event: BaseEvent): Promise => {\n\t\t\treturn new Promise((resolve): void => {\n\t\t\t\tif (this.#inited)\n\t\t\t\t{\n\t\t\t\t\tthis.#handleReinitializeBefore(event).then(() => resolve());\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.subscribeOnce('onReady', (): void => {\n\t\t\t\t\t\tthis.#handleReinitializeBefore(event).then(() => resolve());\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// Some components get attachments from main.post.form via arFiles and controllers properties.\n\t\t// See main.post.form/templates/.default/src/editor.js:778\n\t\t// See timeline/src/commenteditor.js:320\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onCollectControllers', (event: BaseEvent): void => {\n\t\t\tconst data = event.getData();\n\n\t\t\tconst fieldName: string = this.getUserFieldControl().getUploader().getHiddenFieldName();\n\t\t\tconst ids = this.getUserFieldControl().getItems().map((item: TileWidgetItem): number | string => {\n\t\t\t\treturn item.serverFileId;\n\t\t\t});\n\n\t\t\tdata[fieldName] = {\n\t\t\t\tstorage: 'disk',\n\t\t\t\ttag: '[DISK FILE ID=#id#]',\n\t\t\t\tvalues: ids,\n\t\t\t\thandler: {\n\t\t\t\t\tselectFile: (tab, path, selected): void => {\n\t\t\t\t\t\tObject.values(selected).forEach((item): void => {\n\t\t\t\t\t\t\tthis.getUserFieldControl().getUploader().addFile(item);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tremoveFiles: (files): void => {\n\t\t\t\t\t\tif (files !== undefined && Array.isArray(files))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst uploader = this.getUserFieldControl().getUploader();\n\t\t\t\t\t\t\tconst uploadFiles = uploader.getFiles();\n\t\t\t\t\t\t\tlet filteredFiles = files.map(item => uploadFiles.find(uploadFile => uploadFile.getServerFileId() === item).getId());\n\n\t\t\t\t\t\t\tfilteredFiles.forEach(file => {\n\t\t\t\t\t\t\t\tuploader.removeFile(file);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\n\t\t// Video records\n\t\tEventEmitter.subscribe(this.getEventObject(), 'OnVideoHasCaught', (event: BaseEvent): void => {\n\t\t\tevent.stopImmediatePropagation();\n\t\t\tthis.getUserFieldControl().getUploader().addFile(event.getData(), {\n\t\t\t\tevents: {\n\t\t\t\t\t[FileEvent.UPLOAD_COMPLETE]: (event: BaseEvent): void => {\n\t\t\t\t\t\tconst file: UploaderFile = event.getTarget();\n\t\t\t\t\t\tthis.getUserFieldControl().showUploaderPanel();\n\t\t\t\t\t\tthis.getParser().insertFile(file);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\t// An old approach (see BXEditor:onBeforePasteAsync) to process images from clipboard. Just in case.\n\t\tEventEmitter.subscribe(this.getEventObject(), 'OnImageHasCaught', (event: BaseEvent): void => {\n\t\t\tevent.stopImmediatePropagation();\n\n\t\t\treturn new Promise((resolve, reject): void => {\n\t\t\t\tthis.getUserFieldControl().getUploader().addFile(event.getData(), {\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t[FileEvent.LOAD_ERROR]: (event: BaseEvent): void => {\n\t\t\t\t\t\t\tconst error: UploaderError = event.getData().error;\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[FileEvent.UPLOAD_ERROR]: () => (event: BaseEvent): void => {\n\t\t\t\t\t\t\tconst error: UploaderError = event.getData().error;\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[FileEvent.UPLOAD_COMPLETE]: (event: BaseEvent): void => {\n\t\t\t\t\t\t\tconst file: UploaderFile = event.getTarget();\n\t\t\t\t\t\t\tconst item: TileWidgetItem = this.getUserFieldControl().getItem(file.getId());\n\t\t\t\t\t\t\tif (item)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.getParser().syncHighlights();\n\n\t\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\t\tsrc: file.getPreviewUrl(),\n\t\t\t\t\t\t\t\t\t\twidth: file.getPreviewWidth(),\n\t\t\t\t\t\t\t\t\t\theight: file.getPreviewHeight(),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\thtml: this.getParser().createItemHtml(file),\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treject(new UploaderError('WRONG_FILE_SOURCE'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t// Files from Drag&Drop\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onFilesHaveCaught', (event: BaseEvent): void => {\n\t\t\t// Skip this because an event doesn't have all Drag&Drop data\n\t\t\tevent.stopImmediatePropagation();\n\t\t});\n\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onFilesHaveDropped', (event: BaseEvent): void => {\n\t\t\tevent.stopImmediatePropagation();\n\n\t\t\tconst dragEvent: DragEvent = event.getData().event;\n\n\t\t\tgetFilesFromDataTransfer(dragEvent.dataTransfer)\n\t\t\t\t.then((files: File[]): void => {\n\t\t\t\t\tthis.getUserFieldControl().getUploader().addFiles(files);\n\t\t\t\t})\n\t\t\t\t.catch(() => {})\n\t\t\t;\n\t\t});\n\t}\n\n\t#bindAdapterEvents(): void\n\t{\n\t\t// Button counter: File -> File (1) -> File (2)\n\t\tconst adapter: VueUploaderAdapter = this.getUserFieldControl().getAdapter();\n\t\tadapter.subscribe('Item:onAdd', (): void => {\n\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowControllers:File:Increment');\n\t\t});\n\n\t\tadapter.subscribe('Item:onRemove', (event: BaseEvent<{ item: TileWidgetItem }>): void => {\n\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowControllers:File:Decrement');\n\t\t\tconst item: TileWidgetItem = event.getData().item;\n\n\t\t\tif (this.getParser())\n\t\t\t{\n\t\t\t\tthis.getParser().removeFile(item);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * This method invokes for inline entity editing\n\t * @param event\n\t */\n\t#handleReinitializeBefore(event: BaseEvent): Promise\n\t{\n\t\tthis.getUserFieldControl().clear();\n\n\t\tconst [, userFields] = event.getData();\n\t\tconst fieldName: string = this.getUserFieldControl().getUploader().getHiddenFieldName();\n\t\tconst userField = (\n\t\t\tuserFields && userFields[fieldName] && userFields[fieldName]['USER_TYPE_ID'] === 'disk_file'\n\t\t\t\t? userFields[fieldName]\n\t\t\t\t: null\n\t\t);\n\n\t\tif (userField !== null)\n\t\t{\n\t\t\t// existing entity\n\t\t\tif (\n\t\t\t\tType.isPlainObject(userField['CUSTOM_DATA'])\n\t\t\t\t&& Type.isStringFilled(userField['CUSTOM_DATA']['PHOTO_TEMPLATE'])\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.getUserFieldControl().setPhotoTemplateMode('manual');\n\t\t\t\tthis.getUserFieldControl().setPhotoTemplate(userField['CUSTOM_DATA']['PHOTO_TEMPLATE']);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getUserFieldControl().setPhotoTemplateMode('auto');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// new entity\n\t\t\tthis.getUserFieldControl().setPhotoTemplateMode('auto');\n\t\t\tthis.getUserFieldControl().setPhotoTemplate('grid');\n\t\t}\n\n\t\tif (userField === null)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\t// nextTick needs to unmount a TileList component after clear().\n\t\t// Component unmounting resets an auto collapse.\n\t\tif (Type.isArray(userField['FILES']))\n\t\t{\n\t\t\treturn this.#userFieldControl.nextTick().then(() => {\n\t\t\t\tuserField['FILES'].forEach(file => {\n\t\t\t\t\tif (!this.getUserFieldControl().getUploader().getFile(file.serverFileId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getUserFieldControl().getUploader().addFile(file);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (this.getUserFieldControl().getUploader().getFiles().length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.#userFieldControl.enableAutoCollapse();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (Type.isArrayFilled(userField['VALUE']))\n\t\t{\n\t\t\treturn this.#userFieldControl.nextTick().then((): Promise => {\n\t\t\t\treturn new Promise((resolve): void => {\n\t\t\t\t\tlet fileIds: number[] = userField['VALUE'];\n\t\t\t\t\tfileIds = fileIds.filter((id: number) => !this.getUserFieldControl().getUploader().getFile(id));\n\n\t\t\t\t\tlet loaded = 0;\n\t\t\t\t\tlet addedFiles: UploaderFile[] = [];\n\t\t\t\t\tconst onLoad = () => {\n\t\t\t\t\t\tloaded++;\n\t\t\t\t\t\tif (loaded === addedFiles.length)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tconst events = {\n\t\t\t\t\t\t[FileEvent.LOAD_COMPLETE]: onLoad,\n\t\t\t\t\t\t[FileEvent.LOAD_ERROR]: onLoad,\n\t\t\t\t\t};\n\n\t\t\t\t\tconst fileOptions = fileIds.map((id: number) => [id, { events }]);\n\t\t\t\t\tif (fileOptions.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\taddedFiles = this.getUserFieldControl().getUploader().addFiles(fileOptions);\n\t\t\t\t\t\tif (addedFiles.length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#userFieldControl.enableAutoCollapse();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\t#addCreateDocumentButton(): void\n\t{\n\t\tthis.#createDocumentButton = Tag.render`\n\t\t\t<div onclick=\"${this.#handleButtonClick.bind(this)}\">\n\t\t\t\t<i></i>\n\t\t\t\t${Loc.getMessage('DISK_UF_WIDGET_CREATE_DOCUMENT')}\n\t\t\t</div>\n\t\t`;\n\n\t\tEventEmitter.emit(\n\t\t\tthis.getEventObject(),\n\t\t\t'OnAddButton',\n\t\t\t[{ BODY: this.#createDocumentButton, ID: 'disk-document' }, 'file'],\n\t\t);\n\t}\n\n\t#handleButtonClick(): void\n\t{\n\t\tconst container: HTMLElement = this.#createDocumentButton.closest('[data-id=\"disk-document\"]');\n\t\tif (container && container.hasAttribute('data-bx-button-status'))\n\t\t{\n\t\t\tthis.getUserFieldControl().hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getUserFieldControl().showDocumentPanel();\n\t\t}\n\t}\n\n\tinsertIntoText(item: TileWidgetItem): void\n\t{\n\t\tconst file: UploaderFile = this.#userFieldControl.getFile(item.id);\n\t\tthis.#htmlParser.insertFile(file);\n\t}\n\n\t#handleUploaderPanelToggle(event: BaseEvent): void\n\t{\n\t\tconst isOpen: boolean = event.getData().isOpen;\n\t\tif (isOpen)\n\t\t{\n\t\t\tthis.selectFileButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.deselectFileButton();\n\t\t}\n\t}\n\n\t#handleDocumentPanelToggle(event: BaseEvent): void\n\t{\n\t\tconst isOpen: boolean = event.getData().isOpen;\n\t\tif (isOpen)\n\t\t{\n\t\t\tthis.selectCreateDocumentButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.deselectCreateDocumentButton();\n\t\t}\n\t}\n}\n","import { Type, Dom, Tag, Extension, Text } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { UploaderFile, Uploader } from 'ui.uploader.core';\n\nimport MainPostForm from './integration/main-post-form';\n\nimport type { TileWidgetItem } from 'ui.uploader.tile-widget';\nimport type { VueUploaderAdapter } from 'ui.uploader.vue';\nimport type { UserFieldWidgetOptions } from './user-field-widget-options';\n\nconst instances: Map<string, UserFieldControl> = new Map();\n\nexport default class UserFieldControl extends EventEmitter\n{\n\t#id: ?string = null;\n\t#adapter: VueUploaderAdapter = null;\n\t#mainPostForm: MainPostForm = null;\n\n\t#allowDocumentFieldName: string = null;\n\n\t#photoTemplateFieldName: string = null;\n\t#photoTemplateInput: HTMLInputElement = null;\n\t#photoTemplateMode: 'auto' | 'manual' = 'auto';\n\n\t#widgetComponent = null;\n\n\tconstructor(widgetComponent)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Disk.Uploader.Integration');\n\n\t\tthis.#widgetComponent = widgetComponent;\n\t\tthis.#adapter = widgetComponent.adapter;\n\n\t\tconst options: UserFieldWidgetOptions = (\n\t\t\tType.isPlainObject(widgetComponent.widgetOptions) ? widgetComponent.widgetOptions : {}\n\t\t);\n\n\t\tthis.#photoTemplateFieldName = (\n\t\t\tType.isStringFilled(options.photoTemplateFieldName) ? options.photoTemplateFieldName : null\n\t\t);\n\n\t\tthis.#allowDocumentFieldName = (\n\t\t\tType.isStringFilled(options.allowDocumentFieldName) ? options.allowDocumentFieldName : null\n\t\t);\n\n\t\tthis.#adapter.subscribe('Item:onAdd', (event: BaseEvent<{ item: TileWidgetItem }>): void => {\n\t\t\tconst item: TileWidgetItem = event.getData().item;\n\n\t\t\tthis.emit('Item:onAdd', { item });\n\t\t});\n\n\t\tthis.#adapter.subscribe('Item:onComplete', (event: BaseEvent<{ item: TileWidgetItem }>): void => {\n\t\t\tconst item: TileWidgetItem = event.getData().item;\n\t\t\tthis.setDocumentEdit(item);\n\n\t\t\tthis.emit('Item:onComplete', { item });\n\t\t});\n\n\t\tthis.#adapter.subscribe('Item:onRemove', (event: BaseEvent<{ item: TileWidgetItem }>): void => {\n\t\t\tconst item: TileWidgetItem = event.getData().item;\n\t\t\tthis.removeAllowDocumentEditInput(item);\n\n\t\t\tthis.emit('Item:onRemove', { item });\n\t\t});\n\n\t\tif (options.disableLocalEdit)\n\t\t{\n\t\t\t// it would be better to load disk.document on demand\n\t\t\tBX.Disk.Document.Local.Instance.disable();\n\t\t}\n\n\t\tif (this.#photoTemplateFieldName !== null && this.getUploader().getHiddenFieldsContainer() !== null)\n\t\t{\n\t\t\tthis.#photoTemplateInput = Tag.render`\n\t\t\t\t<input \n\t\t\t\t\tname=\"${this.#photoTemplateFieldName}\" \n\t\t\t\t\tvalue=\"${Type.isStringFilled(options.photoTemplate) ? options.photoTemplate : 'grid'}\"\n\t\t\t\t\ttype=\"hidden\" \n\t\t\t\t/>\n\t\t\t`;\n\n\t\t\tthis.setPhotoTemplateMode(options.photoTemplateMode);\n\n\t\t\tDom.append(this.#photoTemplateInput, this.getUploader().getHiddenFieldsContainer());\n\t\t}\n\n\t\tif (\n\t\t\tthis.getUploader().getHiddenFieldsContainer() === null\n\t\t\t&& (this.#photoTemplateFieldName !== null || this.#allowDocumentFieldName !== null)\n\t\t)\n\t\t{\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn(\n\t\t\t\t'DiskUserField: to use \"photoTemplateFieldName\" or \"allowDocumentFieldName\" options '\n\t\t\t\t+ 'you have to set \"hiddenFieldsContainer\" in the uploader options.',\n\t\t\t);\n\t\t}\n\n\t\tthis.subscribeFromOptions(options.events);\n\n\t\tconst eventObject: ?HTMLElement = Type.isElementNode(options.eventObject) ? options.eventObject : null;\n\t\tif (eventObject)\n\t\t{\n\t\t\tthis.#mainPostForm = new MainPostForm(\n\t\t\t\tthis,\n\t\t\t\t{\n\t\t\t\t\teventObject,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonReady: (): void => {\n\t\t\t\t\t\t\tthis.getUploader().addFiles(options.files);\n\t\t\t\t\t\t\tif (this.getUploader().getFiles().length > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.showUploaderPanel();\n\t\t\t\t\t\t\t\tthis.enableAutoCollapse();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getUploader().addFiles(options.files);\n\t\t}\n\n\t\tthis.#id = (\n\t\t\tType.isStringFilled(options.mainPostFormId)\n\t\t\t\t? options.mainPostFormId\n\t\t\t\t: `user-field-control-${Text.getRandom().toLowerCase()}`\n\t\t);\n\n\t\tinstances.set(this.#id, this);\n\t}\n\n\tstatic getById(id: string): ?UserFieldControl\n\t{\n\t\treturn instances.get(id) || null;\n\t}\n\n\tstatic getInstances(): UserFieldControl[]\n\t{\n\t\treturn [...instances.values()];\n\t}\n\n\tcanCreateDocuments(): boolean\n\t{\n\t\tconst settings = Extension.getSettings('disk.uploader.user-field-widget');\n\t\tconst canCreateDocuments = settings.get('canCreateDocuments', false);\n\n\t\treturn canCreateDocuments && this.#widgetComponent.widgetOptions.canCreateDocuments !== false;\n\t}\n\n\tgetAdapter(): VueUploaderAdapter\n\t{\n\t\treturn this.#adapter;\n\t}\n\n\tgetMainPostForm(): ?MainPostForm\n\t{\n\t\treturn this.#mainPostForm;\n\t}\n\n\tgetItems(): TileWidgetItem[]\n\t{\n\t\treturn this.#adapter.getItems();\n\t}\n\n\tgetItem(id): ?TileWidgetItem\n\t{\n\t\treturn this.#adapter.getItem(id);\n\t}\n\n\tgetFiles(): UploaderFile[]\n\t{\n\t\treturn this.#adapter.getUploader().getFiles();\n\t}\n\n\tgetFile(id: string): ?UploaderFile\n\t{\n\t\treturn this.#adapter.getUploader().getFile(id);\n\t}\n\n\tgetUploader(): Uploader\n\t{\n\t\treturn this.#adapter.getUploader();\n\t}\n\n\tnextTick(): Promise\n\t{\n\t\treturn this.#widgetComponent.$nextTick();\n\t}\n\n\thide(): void\n\t{\n\t\tthis.#widgetComponent.priorityVisibility = 'hidden';\n\t\tthis.emit('onUploaderPanelToggle', { isOpen: false });\n\t\tthis.emit('onDocumentPanelToggle', { isOpen: false });\n\t}\n\n\tshowUploaderPanel(): void\n\t{\n\t\tthis.#widgetComponent.priorityVisibility = 'uploader';\n\t\tthis.emit('onUploaderPanelToggle', { isOpen: true });\n\t\tthis.emit('onDocumentPanelToggle', { isOpen: false });\n\t}\n\n\tshowDocumentPanel(): void\n\t{\n\t\tif (!this.canCreateDocuments())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#widgetComponent.priorityVisibility = 'documents';\n\t\tthis.emit('onUploaderPanelToggle', { isOpen: false });\n\t\tthis.emit('onDocumentPanelToggle', { isOpen: true });\n\t}\n\n\tclear(): void\n\t{\n\t\tthis.getUploader().removeFiles({ removeFromServer: false });\n\t}\n\n\tenableAutoCollapse(): void\n\t{\n\t\tthis.#widgetComponent.enableAutoCollapse();\n\t}\n\n\tcanAllowDocumentEdit(): boolean\n\t{\n\t\treturn this.#allowDocumentFieldName !== null && this.getUploader().getHiddenFieldsContainer() !== null;\n\t}\n\n\tcanItemAllowEdit(item: TileWidgetItem): boolean\n\t{\n\t\treturn (\n\t\t\tthis.canAllowDocumentEdit()\n\t\t\t&& item.customData.isEditable === true\n\t\t\t&& item.customData.canUpdate === true\n\t\t);\n\t}\n\n\tgetAllowDocumentEditInput(item: TileWidgetItem): ?HTMLInputElement\n\t{\n\t\tconst selector = `input[name='${this.#allowDocumentFieldName}[${item.serverFileId}]']`;\n\n\t\tif (this.getUploader().getHiddenFieldsContainer() !== null)\n\t\t{\n\t\t\treturn this.getUploader().getHiddenFieldsContainer().querySelector(selector);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tremoveAllowDocumentEditInput(item: TileWidgetItem): void\n\t{\n\t\tconst input: HTMLInputElement = this.getAllowDocumentEditInput(item);\n\t\tif (input !== null)\n\t\t{\n\t\t\tDom.remove(input);\n\t\t}\n\t}\n\n\tsetDocumentEdit(item: TileWidgetItem, allowEdit: ?boolean = null): void\n\t{\n\t\tif (!this.canItemAllowEdit(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet input: HTMLInputElement = this.getAllowDocumentEditInput(item);\n\t\tif (input === null)\n\t\t{\n\t\t\tinput = Tag.render`<input name=\"${this.#allowDocumentFieldName}[${item.serverFileId}]\" type=\"hidden\" />`;\n\t\t\tDom.append(input, this.getUploader().getHiddenFieldsContainer());\n\t\t}\n\n\t\tallowEdit = allowEdit === null ? item.customData.allowEdit === true : allowEdit;\n\t\tinput.value = allowEdit ? 1 : 0;\n\n\t\tconst file: UploaderFile = this.getFile(item.id);\n\t\tfile.setCustomData('allowEdit', allowEdit);\n\t}\n\n\tcanChangePhotoTemplate(): boolean\n\t{\n\t\treturn this.#photoTemplateInput !== null;\n\t}\n\n\tsetPhotoTemplate(name: string): void\n\t{\n\t\tif (Type.isStringFilled(name) && this.#photoTemplateInput !== null)\n\t\t{\n\t\t\tthis.#photoTemplateInput.value = name;\n\t\t}\n\t}\n\n\tgetPhotoTemplate(): string\n\t{\n\t\treturn this.#photoTemplateInput !== null ? this.#photoTemplateInput.value : '';\n\t}\n\n\tsetPhotoTemplateMode(mode: 'auto' | 'manual'): void\n\t{\n\t\tif (mode === 'auto' || mode === 'manual')\n\t\t{\n\t\t\tthis.#photoTemplateMode = mode;\n\t\t}\n\t}\n\n\tgetPhotoTemplateMode(): 'auto' | 'manual'\n\t{\n\t\treturn this.#photoTemplateMode;\n\t}\n\n\tgetDocumentServices(): Object<string, Array<{ name: string, code: string }>>\n\t{\n\t\tconst settings = Extension.getSettings('disk.uploader.user-field-widget');\n\t\tconst documentHandlers = settings.get('documentHandlers', {});\n\t\tif (Type.isPlainObject(documentHandlers))\n\t\t{\n\t\t\treturn documentHandlers;\n\t\t}\n\n\t\treturn {};\n\t}\n\n\tgetCurrentDocumentService(): { name: string, code: string } | null\n\t{\n\t\tlet currentServiceCode = BX.Disk.getDocumentService();\n\t\tif (!currentServiceCode && BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\tcurrentServiceCode = 'onlyoffice';\n\t\t}\n\t\telse if (!currentServiceCode)\n\t\t{\n\t\t\tcurrentServiceCode = 'l';\n\t\t}\n\n\t\treturn this.getDocumentServices()[currentServiceCode] || null;\n\t}\n\n\tgetImportServices(): Object<string, Array<{ name: string, code: string }>>\n\t{\n\t\tconst settings = Extension.getSettings('disk.uploader.user-field-widget');\n\t\tconst importHandlers = settings.get('importHandlers', {});\n\t\tif (Type.isPlainObject(importHandlers))\n\t\t{\n\t\t\treturn importHandlers;\n\t\t}\n\n\t\treturn {};\n\t}\n\n\tcanUseImportService(): boolean\n\t{\n\t\tconst settings = Extension.getSettings('disk.uploader.user-field-widget');\n\n\t\treturn settings.get('canUseImport', true);\n\t}\n\n\tgetImportFeatureId(): string\n\t{\n\t\tconst settings = Extension.getSettings('disk.uploader.user-field-widget');\n\n\t\treturn settings.get('importFeatureId', '');\n\t}\n\n\tisBoardsEnabled(): boolean\n\t{\n\t\tconst settings = Extension.getSettings('disk.uploader.user-field-widget');\n\n\t\treturn settings.get('isBoardsEnabled', '');\n\t}\n}\n","import { ajax as Ajax, Loc, Runtime, Uri } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nexport const loadDiskFileDialog = (dialogName, params: Object<string, string> = {}): Promise => {\n\treturn new Promise((resolve): void => {\n\t\tRuntime.loadExtension('disk.legacy.file-dialog').then(() => {\n\t\t\tconst handleInit = (event: BaseEvent): void => {\n\t\t\t\tconst [name] = event.getData();\n\t\t\t\tif (dialogName === name)\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'inited', handleInit);\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'inited', handleInit);\n\n\t\t\t// Invokes BX.DiskFileDialog.init\n\t\t\tAjax.get(getDialogInitUrl(dialogName, params));\n\t\t});\n\t});\n};\n\nconst getDialogInitUrl = (dialogName, params: Object<string, string> = {}): string => {\n\tconst url = `/bitrix/tools/disk/uf.php?action=openDialog&SITE_ID=${\n\t\tLoc.getMessage('SITE_ID')}&dialog2=Y&ACTION=SELECT&MULTI=Y&dialogName=${dialogName}`\n\t;\n\n\treturn Uri.addParam(url, params);\n};\n","import { Loc, Text, Type, Tag, Runtime, ajax as Ajax } from 'main.core';\n\nimport { UploaderFile, getFilenameWithoutExtension, getFileExtension } from 'ui.uploader.core';\nimport { loadDiskFileDialog } from './helpers/load-disk-file-dialog';\n\nimport type { TileWidgetItem } from 'ui.uploader.tile-widget';\nimport type { Menu, MenuItem } from 'main.popup';\nimport type { BaseEvent } from 'main.core.events';\nimport { Button, ButtonSize, ButtonColor } from 'ui.buttons';\nimport type UserFieldControl from './user-field-control';\n\nimport './css/item-rename-form.css';\n\nexport default class ItemMenu\n{\n\t#userFieldControl: UserFieldControl = null;\n\t#item: TileWidgetItem = null;\n\t#menu: Menu = null;\n\t#folderDialogId: string = null;\n\n\tconstructor(userFieldControl: UserFieldControl, item: TileWidgetItem, menu: Menu)\n\t{\n\t\tthis.#userFieldControl = userFieldControl;\n\t\tthis.#item = item;\n\t\tthis.#menu = menu;\n\t\tthis.#folderDialogId = `folder-dialog-${Text.getRandom(5)}`;\n\t}\n\n\tbuild(): void\n\t{\n\t\tthis.#menu.getPopupWindow().setMaxWidth(500);\n\n\t\tif (this.#userFieldControl.canItemAllowEdit(this.#item))\n\t\t{\n\t\t\tthis.#menu.addMenuItem({ delimiter: true });\n\t\t\tthis.#menu.addMenuItem({\n\t\t\t\tid: 'allow-edit',\n\t\t\t\tclassName: this.#item.customData.allowEdit === true ? 'disk-user-field-item-checked' : '',\n\t\t\t\ttext: Loc.getMessage('DISK_UF_WIDGET_ALLOW_DOCUMENT_EDIT'),\n\t\t\t\tonclick: (event, menuItem: MenuItem): void => {\n\t\t\t\t\tif (this.#item.customData.allowEdit === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#userFieldControl.setDocumentEdit(this.#item, false);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#userFieldControl.setDocumentEdit(this.#item, true);\n\t\t\t\t\t}\n\n\t\t\t\t\tmenuItem.getMenuWindow().close();\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (this.#item.customData.canRename)\n\t\t{\n\t\t\tthis.#menu.addMenuItem({ delimiter: true });\n\n\t\t\tthis.#menu.addMenuItem({\n\t\t\t\tid: 'rename',\n\t\t\t\ttext: Loc.getMessage('DISK_UF_WIDGET_RENAME_FILE_MENU_TITLE'),\n\t\t\t\tevents: {\n\t\t\t\t\t'SubMenu:onShow': (event: BaseEvent): void => {\n\t\t\t\t\t\tconst renameItem: MenuItem = event.getTarget();\n\t\t\t\t\t\tthis.#showRenameMenu(renameItem);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\titems: [{\n\t\t\t\t\tid: 'rename-textarea',\n\t\t\t\t\thtml: '<div class=\"disk-user-field-rename-loading\"></div>',\n\t\t\t\t\tclassName: 'disk-user-field-rename-menu-item',\n\t\t\t\t}],\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#item.customData.storage))\n\t\t{\n\t\t\tthis.#menu.addMenuItem({\n\t\t\t\tdelimiter: true,\n\t\t\t\t// text: Loc.getMessage('DISK_UF_WIDGET_SAVED_IN_DISK_FOLDER'),\n\t\t\t});\n\n\t\t\tif (this.#item.customData.canMove)\n\t\t\t{\n\t\t\t\tthis.#menu.addMenuItem({\n\t\t\t\t\tid: 'storage',\n\t\t\t\t\ttext: `${this.#item.customData.storage}&mldr;`,\n\t\t\t\t\tonclick: (): void => {\n\t\t\t\t\t\tthis.openFolderDialog();\n\t\t\t\t\t\tthis.#menu.close();\n\t\t\t\t\t},\n\t\t\t\t\tdisabled: this.#item.customData.tileSelected === true,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#menu.addMenuItem({\n\t\t\t\t\tid: 'storage',\n\t\t\t\t\ttext: this.#item.customData.storage,\n\t\t\t\t\tdisabled: true,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\trename(newName: string): Promise\n\t{\n\t\treturn new Promise((resolve, reject): void => {\n\t\t\tAjax.runAction('disk.api.commonActions.rename', {\n\t\t\t\tdata: {\n\t\t\t\t\tobjectId: this.#item.customData.objectId,\n\t\t\t\t\tnewName,\n\t\t\t\t\tautoCorrect: true,\n\t\t\t\t\tgenerateUniqueName: true,\n\t\t\t\t},\n\t\t\t})\n\t\t\t\t.then((response): void => {\n\t\t\t\t\tif (response?.status === 'success' && response?.data?.object?.name !== this.#item.name)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst file: UploaderFile = this.#userFieldControl.getFile(this.#item.id);\n\t\t\t\t\t\tconst name = response.data.object.name;\n\t\t\t\t\t\tfile.setName(name);\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch((response): void => {\n\t\t\t\t\tBX.Disk.showModalWithStatusAction(response);\n\t\t\t\t\treject();\n\t\t\t\t});\n\t\t});\n\t}\n\n\t#showRenameMenu(renameItem: MenuItem): void\n\t{\n\t\tRuntime.loadExtension('ui.buttons').then((exports): void => {\n\t\t\tconst Button: Class<Button> = exports.Button;\n\t\t\tconst ButtonSize: Class<ButtonSize> = exports.ButtonSize;\n\t\t\tconst ButtonColor: Class<ButtonColor> = exports.ButtonColor;\n\t\t\tconst CancelButton: Class<CancelButton> = exports.CancelButton;\n\n\t\t\tconst handleKeydown = (event: KeyboardEvent): void => {\n\t\t\t\tif (event.code === 'Enter')\n\t\t\t\t{\n\t\t\t\t\thandleRenameClick();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst nameWithoutExtension = getFilenameWithoutExtension(this.#item.name);\n\t\t\tconst handleRenameClick = (): void => {\n\t\t\t\tconst textareaValue: string = textarea.value.trim();\n\t\t\t\tif (!Type.isStringFilled(textareaValue) || textareaValue === nameWithoutExtension)\n\t\t\t\t{\n\t\t\t\t\trenameItem.getMenuWindow().close();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\trenameBtn.setWaiting(true);\n\t\t\t\tconst newFilename = `${textareaValue}.${getFileExtension(this.#item.name)}`;\n\t\t\t\tthis.rename(newFilename)\n\t\t\t\t\t.then((): void => {\n\t\t\t\t\t\trenameBtn.setWaiting(false);\n\t\t\t\t\t\trenameItem.getMenuWindow().close();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((): void => {\n\t\t\t\t\t\trenameBtn.setWaiting(false);\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t};\n\t\t\tconst textarea: HTMLTextAreaElement = Tag.render`\n\t\t\t\t<textarea \n\t\t\t\t\tclass=\"disk-user-field-rename-textarea\" \n\t\t\t\t\tonkeydown=\"${handleKeydown}\"\n\t\t\t\t>${Text.encode(nameWithoutExtension)}</textarea>\n\t\t\t`;\n\n\t\t\tconst renameBtn: Button = new Button({\n\t\t\t\ttext: Loc.getMessage('DISK_UF_WIDGET_RENAME_FILE_BUTTON_TITLE'),\n\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\tonclick: handleRenameClick,\n\t\t\t});\n\n\t\t\tconst cancelBtn: CancelButton = new CancelButton({\n\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\tonclick: (): void => {\n\t\t\t\t\trenameItem.getMenuWindow().close();\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst submenu: Menu = renameItem.getSubMenu();\n\t\t\tconst textareaItem: MenuItem = submenu.getMenuItem('rename-textarea');\n\n\t\t\ttextareaItem.setText(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"disk-user-field-rename-form\">\n\t\t\t\t\t\t${textarea}\n\t\t\t\t\t\t<div class=\"disk-user-field-rename-buttons\">${[renameBtn.render(), cancelBtn.render()]}</div>\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\trenameItem.showSubMenu();\n\t\t});\n\t}\n\n\topenFolderDialog(): void\n\t{\n\t\tloadDiskFileDialog(this.#folderDialogId, { wish: 'fakemove' }).then((): void => {\n\t\t\tBX.DiskFileDialog.obCallback[this.#folderDialogId] = {\n\t\t\t\tsaveButton: (tab, path, selectedItems, folderByPath): void => {\n\t\t\t\t\tconst selectedItem = Object.values(selectedItems)[0] || folderByPath;\n\t\t\t\t\tif (!selectedItem)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst folderId = selectedItem.id === 'root' ? tab.rootObjectId : selectedItem.id;\n\n\t\t\t\t\tAjax.runAction('disk.api.commonActions.move', {\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tobjectId: this.#item.customData.objectId,\n\t\t\t\t\t\t\ttoFolderId: folderId,\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t\t.then((response): void => {\n\t\t\t\t\t\t\tif (response?.status === 'success')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst file: UploaderFile = this.#userFieldControl.getFile(this.#item.id);\n\t\t\t\t\t\t\t\tconst name = response.data.object.name;\n\t\t\t\t\t\t\t\tconst id = response.data.object.id;\n\n\t\t\t\t\t\t\t\tfile.setServerFileId(`n${id}`);\n\t\t\t\t\t\t\t\tfile.setName(name);\n\n\t\t\t\t\t\t\t\tif (selectedItem.id === 'root')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfile.setCustomData('storage', `${tab.name} / `);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfile.setCustomData('storage', `${tab.name} / ${selectedItem.name}`);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((response): void => {\n\t\t\t\t\t\t\tBX.Disk.showModalWithStatusAction(response);\n\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tif (BX.DiskFileDialog.popupWindow === null)\n\t\t\t{\n\t\t\t\tBX.DiskFileDialog.openDialog(this.#folderDialogId);\n\t\t\t}\n\t\t})\n\t\t\t.catch(() => {\n\t\t\t\t// just ignore\n\t\t\t});\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Menu, MenuItem } from 'main.popup';\n\nimport type UserFieldControl from './user-field-control';\n\nexport default class SettingsMenu\n{\n\t#userFieldControl: UserFieldControl = null;\n\t#menu: Menu = null;\n\n\tconstructor(userFieldControl: UserFieldControl)\n\t{\n\t\tthis.#userFieldControl = userFieldControl;\n\t}\n\n\tgetMenu(button): Menu\n\t{\n\t\tif (this.#menu !== null)\n\t\t{\n\t\t\treturn this.#menu;\n\t\t}\n\n\t\tthis.#menu = new Menu({\n\t\t\tbindElement: button.getContainer(),\n\t\t\tclassName: 'disk-user-field-settings-popup',\n\t\t\tangle: true,\n\t\t\tautoHide: true,\n\t\t\toffsetLeft: 16,\n\t\t\tcacheable: false,\n\t\t\titems: this.#getItems(),\n\t\t\tevents: {\n\t\t\t\tonShow: (): void => {\n\t\t\t\t\tbutton.select();\n\t\t\t\t},\n\t\t\t\tonDestroy: (): void => {\n\t\t\t\t\tbutton.deselect();\n\t\t\t\t\tthis.#menu = null;\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\treturn this.#menu;\n\t}\n\n\t#getItems(): Array\n\t{\n\t\tif (!this.#userFieldControl.canChangePhotoTemplate())\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\treturn [{\n\t\t\tclassName: this.#userFieldControl.getPhotoTemplate() === 'grid' ? 'disk-user-field-item-checked' : '',\n\t\t\ttext: Loc.getMessage('DISK_UF_WIDGET_ALLOW_PHOTO_COLLAGE'),\n\t\t\tonclick: (event, menuItem: MenuItem): void => {\n\t\t\t\tthis.#userFieldControl.setPhotoTemplateMode('manual');\n\t\t\t\tif (this.#userFieldControl.getPhotoTemplate() === 'grid')\n\t\t\t\t{\n\t\t\t\t\tthis.#userFieldControl.setPhotoTemplate('gallery');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#userFieldControl.setPhotoTemplate('grid');\n\t\t\t\t}\n\n\t\t\t\tmenuItem.getMenuWindow().close();\n\t\t\t},\n\t\t}];\n\t}\n\n\tshow(button): void\n\t{\n\t\tthis.getMenu(button).show();\n\t}\n\n\ttoggle(button): void\n\t{\n\t\tif (this.#menu !== null && this.#menu.getPopupWindow().isShown())\n\t\t{\n\t\t\tthis.#menu.close();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.show(button);\n\t\t}\n\t}\n\n\thide(): void\n\t{\n\t\tif (this.#menu !== null)\n\t\t{\n\t\t\tthis.#menu.close();\n\t\t}\n\t}\n\n\thasItems(): boolean\n\t{\n\t\treturn this.#getItems().length > 0;\n\t}\n}\n","import { Text, Type } from 'main.core';\nimport { Uploader } from 'ui.uploader.core';\n\nimport { loadDiskFileDialog } from './load-disk-file-dialog';\n\nconst loadingDialogs: Set<string> = new Set();\n\nexport const openDiskFileDialog = (options): void => {\n\n\toptions = Type.isPlainObject(options) ? options : {};\n\tconst dialogId: string = Type.isStringFilled(options.dialogId) ? options.dialogId : `file-dialog-${Text.getRandom(5)}`;\n\tconst onLoad: ?Function = Type.isFunction(options.onLoad) ? options.onLoad : null;\n\tconst onSelect: ?Function = Type.isFunction(options.onSelect) ? options.onSelect : null;\n\tconst onClose: ?Function = Type.isFunction(options.onClose) ? options.onClose : null;\n\tconst uploader: ?Uploader = options.uploader instanceof Uploader ? options.uploader : null;\n\n\tif (loadingDialogs.has(dialogId))\n\t{\n\t\treturn;\n\t}\n\n\tloadingDialogs.add(dialogId);\n\n\tloadDiskFileDialog(dialogId).then((): void => {\n\t\tloadingDialogs.delete(dialogId);\n\t\tif (onLoad !== null)\n\t\t{\n\t\t\tonLoad();\n\t\t}\n\n\t\tBX.DiskFileDialog.obCallback[dialogId] = {\n\t\t\tsaveButton: (tab, path, selectedItems): void => {\n\t\t\t\tObject.values(selectedItems).forEach(item => {\n\t\t\t\t\tif (uploader !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tuploader.addFile(item.id, { name: item.name, preload: true });\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (onSelect !== null)\n\t\t\t\t{\n\t\t\t\t\tonSelect(tab, path, selectedItems);\n\t\t\t\t}\n\t\t\t},\n\t\t\tpopupDestroy: (): void => {\n\t\t\t\tloadingDialogs.delete(dialogId);\n\t\t\t\tif (onClose !== null)\n\t\t\t\t{\n\t\t\t\t\tonClose();\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\n\t\tif (BX.DiskFileDialog.popupWindow === null)\n\t\t{\n\t\t\tBX.DiskFileDialog.openDialog(dialogId);\n\t\t}\n\t});\n};","import { UploaderFile, AbstractLoadController, Server } from 'ui.uploader.core';\n\nexport default class CloudLoadController extends AbstractLoadController\n{\n\tconstructor(server: Server, options = {})\n\t{\n\t\tsuper(server, options);\n\t}\n\n\tload(file: UploaderFile): void\n\t{\n\t\tthis.emit('onProgress', { progress: 100 });\n\t\tthis.emit('onLoad');\n\t}\n\n\tabort(): void\n\t{\n\n\t}\n}","import { UploaderFile, AbstractUploadController, UploaderError, Server } from 'ui.uploader.core';\n\nexport default class CloudUploadController extends AbstractUploadController\n{\n\t#fileId: string = null;\n\t#serviceId: string = null;\n\n\tconstructor(server: Server, options = {})\n\t{\n\t\tsuper(server, options);\n\n\t\tthis.#fileId = options.fileId;\n\t\tthis.#serviceId = options.serviceId;\n\t}\n\n\tupload(file: UploaderFile): void\n\t{\n\t\tBX.Disk.ExternalLoader.startLoad({\n\t\t\tfile: {\n\t\t\t\tid: this.#fileId,\n\t\t\t\tservice: this.#serviceId,\n\t\t\t},\n\t\t\tonFinish: (newData): void => {\n\t\t\t\tthis.emit('onUpload', { fileInfo: newData.fileInfo});\n\t\t\t},\n\t\t\tonProgress: (progress): void => {\n\t\t\t\tthis.emit('onProgress', { progress: progress });\n\t\t\t},\n\t\t\tonError: (errors): void => {\n\t\t\t\tthis.emit('onError', { error: UploaderError.createFromAjaxErrors(errors) });\n\t\t\t},\n\t\t});\n\t}\n\n\tabort(): void\n\t{\n\n\t}\n}","import { Runtime, Text, Type, ajax, Event } from 'main.core';\nimport { Uploader } from 'ui.uploader.core';\n\nimport { loadDiskFileDialog } from './load-disk-file-dialog';\nimport CloudLoadController from './cloud-load-controller';\nimport CloudUploadController from './cloud-upload-controller';\n\nconst loadingDialogs: Set<string> = new Set();\n\nexport const openCloudFileDialog = (options): void => {\n\toptions = Type.isPlainObject(options) ? options : {};\n\tconst dialogId: string = Type.isStringFilled(options.dialogId) ? options.dialogId : `cloud-dialog-${Text.getRandom(5)}`;\n\tconst serviceId: string = Type.isStringFilled(options.serviceId) ? options.serviceId : 'gdrive';\n\tconst onLoad: ?Function = Type.isFunction(options.onLoad) ? options.onLoad : null;\n\tconst onSelect: ?Function = Type.isFunction(options.onSelect) ? options.onSelect : null;\n\tconst onClose: ?Function = Type.isFunction(options.onClose) ? options.onClose : null;\n\tconst uploader: ?Uploader = options.uploader instanceof Uploader ? options.uploader : null;\n\n\tif (loadingDialogs.has(dialogId))\n\t{\n\t\treturn;\n\t}\n\n\tloadingDialogs.add(dialogId);\n\n\tloadDiskFileDialog(dialogId, { service: serviceId, cloudImport: 1 }).then((): void => {\n\t\tloadingDialogs.delete(dialogId);\n\t\tif (onLoad !== null)\n\t\t{\n\t\t\tonLoad();\n\t\t}\n\n\t\tBX.DiskFileDialog.obCallback[dialogId] = {\n\t\t\tsaveButton: (tab, path, selectedItems): void => {\n\t\t\t\tRuntime.loadExtension('disk.legacy.external-loader').then((): void => {\n\t\t\t\t\tObject.values(selectedItems).forEach((item) => {\n\t\t\t\t\t\tif (item.type === 'file' && uploader !== null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuploader.addFile({\n\t\t\t\t\t\t\t\tid: item.id,\n\t\t\t\t\t\t\t\tserverFileId: item.id,\n\t\t\t\t\t\t\t\tname: item.name,\n\t\t\t\t\t\t\t\tsize: Text.toNumber(item.sizeInt),\n\t\t\t\t\t\t\t\tloadController: new CloudLoadController(\n\t\t\t\t\t\t\t\t\tuploader.getServer(),\n\t\t\t\t\t\t\t\t\t{ fileId: item.id, serviceId: item.provider },\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tuploadController: new CloudUploadController(\n\t\t\t\t\t\t\t\t\tuploader.getServer(),\n\t\t\t\t\t\t\t\t\t{ fileId: item.id, serviceId: item.provider },\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (onSelect !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tonSelect(tab, path, selectedItems);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tpopupDestroy: (): void => {\n\t\t\t\tloadingDialogs.delete(dialogId);\n\t\t\t\tif (onClose !== null)\n\t\t\t\t{\n\t\t\t\t\tonClose();\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\n\t\tif (serviceId === 'gdrive')\n\t\t{\n\t\t\tajax({\n\t\t\t\turl: '/bitrix/tools/disk/uf.php?action=getGoogleAppData',\n\t\t\t\tdataType: 'json',\n\t\t\t\tonsuccess(data)\n\t\t\t\t{\n\t\t\t\t\tif (data.authUrl)\n\t\t\t\t\t{\n\t\t\t\t\t\topenAuthPopup(data.authUrl, options);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tinitGooglePicker(data, dialogId).then((picker) => {\n\t\t\t\t\t\tpicker.loadAndShowPicker();\n\t\t\t\t\t}).catch((error) => {\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonfailure(data)\n\t\t\t\t{\n\t\t\t\t\tBX.DiskFileDialog.sendRequest = false;\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (BX.DiskFileDialog.popupWindow === null)\n\t\t{\n\t\t\tBX.DiskFileDialog.openDialog(dialogId);\n\t\t}\n\t});\n};\n\nconst openAuthPopup = function(authUrl: string, dialogOptions: any): void {\n\tBX.util.popup(authUrl, 1030, 700);\n\tEvent.bind(window, 'hashchange', () => {\n\t\tconst matches = document.location.hash.match(/external-auth-(\\w+)/);\n\t\tif (!matches)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tBX.DiskFileDialog.sendRequest = false;\n\t\topenCloudFileDialog(dialogOptions);\n\t});\n};\n\nconst initGooglePicker = async function(data: any, dialogId: string): Promise {\n\treturn Runtime.loadExtension('disk.google-drive-picker').then(({ GoogleDrivePicker }) => {\n\t\treturn new GoogleDrivePicker(\n\t\t\tdata.clientId,\n\t\t\tdata.appId,\n\t\t\tdata.apiKey,\n\t\t\tdata.accessToken,\n\t\t\tBX.DiskFileDialog.obCallback[dialogId],\n\t\t);\n\t});\n};\n","import { Runtime } from 'main.core';\n\nimport type { BitrixVueComponentProps } from 'ui.vue3';\n\nexport const Loader: BitrixVueComponentProps = {\n\tname: 'Loader',\n\tprops: {\n\t\tsize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 70,\n\t\t},\n\t\tcolor: {\n\t\t\ttype: String,\n\t\t\tdefault: '#2fc6f6',\n\t\t},\n\t\toffset: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t\tmode: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.loader = null;\n\t},\n\tmounted(): void\n\t{\n\t\tRuntime.loadExtension('main.loader').then((exports): void => {\n\t\t\tconst { Loader } = exports;\n\t\t\tthis.loader = new Loader({\n\t\t\t\ttarget: this.$refs.container,\n\t\t\t\tsize: this.size,\n\t\t\t\tcolor: this.color,\n\t\t\t\toffset: this.offset,\n\t\t\t\tmode: this.mode,\n\t\t\t});\n\n\t\t\tthis.loader.show();\n\t\t});\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (this.loader)\n\t\t{\n\t\t\tthis.loader.destroy();\n\t\t\tthis.loader = null;\n\t\t}\n\t},\n\ttemplate: '<span ref=\"container\"></span>',\n};\n","import { Text } from 'main.core';\n\nimport { openDiskFileDialog } from '../helpers/open-disk-file-dialog';\nimport { openCloudFileDialog } from '../helpers/open-cloud-file-dialog';\n\nimport { Loader } from './loader';\nimport { FeaturePromotersRegistry } from 'ui.info-helper';\n\nimport './css/control-panel.css';\n\nexport const ControlPanel = {\n\tname: 'ControlPanel',\n\tinject: ['userFieldControl', 'uploader', 'getMessage'],\n\tcomponents: {\n\t\tLoader,\n\t},\n\tdata: () => ({\n\t\tshowDialogLoader: false,\n\t\tshowCloudDialogLoader: false,\n\t\tcurrentServiceId: null,\n\t}),\n\tcreated(): void\n\t{\n\t\tthis.fileDialogId = `file-dialog-${Text.getRandom(5)}`;\n\t\tthis.cloudDialogId = `cloud-dialog-${Text.getRandom(5)}`;\n\t\tthis.importServices = this.userFieldControl.getImportServices();\n\t\tthis.canUseImportService = this.userFieldControl.canUseImportService();\n\t\tthis.importFeatureId = this.userFieldControl.getImportFeatureId();\n\t},\n\tmounted(): void\n\t{\n\t\tthis.uploader.assignBrowse(this.$refs.upload);\n\t},\n\tmethods: {\n\t\topenDiskFileDialog(): void\n\t\t{\n\t\t\tif (this.showDialogLoader)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showDialogLoader = true;\n\n\t\t\topenDiskFileDialog({\n\t\t\t\tdialogId: this.fileDialogId,\n\t\t\t\tuploader: this.uploader,\n\t\t\t\tonLoad: (): void => {\n\t\t\t\t\tthis.showDialogLoader = false;\n\t\t\t\t},\n\t\t\t\tonClose: (): void => {\n\t\t\t\t\tthis.showDialogLoader = false;\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\n\t\topenCloudFileDialog(serviceId)\n\t\t{\n\t\t\tif (!this.canUseImportService)\n\t\t\t{\n\t\t\t\tFeaturePromotersRegistry.getPromoter({ featureId: this.importFeatureId }).show();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.showCloudDialogLoader)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentServiceId = serviceId;\n\t\t\tthis.showCloudDialogLoader = true;\n\n\t\t\tconst finalize = (): void => {\n\t\t\t\tthis.showCloudDialogLoader = false;\n\t\t\t\tthis.currentServiceId = null;\n\t\t\t};\n\n\t\t\topenCloudFileDialog({\n\t\t\t\tdialogId: this.cloudDialogId,\n\t\t\t\tuploader: this.uploader,\n\t\t\t\tserviceId,\n\t\t\t\tonLoad: finalize,\n\t\t\t\tonClose: finalize,\n\t\t\t});\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"disk-user-field-panel\">\n\t\t\t<div class=\"disk-user-field-panel-file-wrap\">\n\t\t\t\t<div class=\"disk-user-field-panel-card-box disk-user-field-panel-card-file\" ref=\"upload\">\n\t\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card-icon--upload\">\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-content\">\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ getMessage('DISK_UF_WIDGET_UPLOAD_FILES') }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"disk-user-field-panel-card-box disk-user-field-panel-card-file\" @click=\"openDiskFileDialog\">\n\t\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card-icon--b24\">\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-content\">\n\t\t\t\t\t\t\t<Loader v-if=\"showDialogLoader\" :offset=\"{ top: '-7px' }\" />\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ getMessage('DISK_UF_WIDGET_MY_DRIVE') }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"disk-user-field-panel-card-divider\"></div>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"disk-user-field-panel-card-box disk-user-field-panel-card-file\"\n\t\t\t\t\tv-if=\"importServices['gdrive']\"\n\t\t\t\t\t@click=\"openCloudFileDialog('gdrive')\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card-icon--google-docs\">\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-content\">\n\t\t\t\t\t\t\t<Loader v-if=\"showCloudDialogLoader && currentServiceId === 'gdrive'\" :offset=\"{ top: '-7px' }\" />\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ importServices['gdrive']['name'] }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"disk-user-field-panel-card-box disk-user-field-panel-card-file\"\n\t\t\t\t\tv-if=\"importServices['office365']\"\n\t\t\t\t\t@click=\"openCloudFileDialog('office365')\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card-icon--office365\">\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-content\">\n\t\t\t\t\t\t\t<Loader v-if=\"showCloudDialogLoader && currentServiceId === 'office365'\" :offset=\"{ top: '-7px' }\" />\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ importServices['office365']['name'] }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"disk-user-field-panel-card-box disk-user-field-panel-card-file\"\n\t\t\t\t\tv-if=\"importServices['dropbox']\"\n\t\t\t\t\t@click=\"openCloudFileDialog('dropbox')\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card-icon--dropbox\">\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-content\">\n\t\t\t\t\t\t\t<Loader v-if=\"showCloudDialogLoader && currentServiceId === 'dropbox'\" :offset=\"{ top: '-7px' }\" />\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ importServices['dropbox']['name'] }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc, Tag, Dom } from 'main.core';\nimport { Menu, MenuItem } from 'main.popup';\n\nimport type { BitrixVueComponentProps } from 'ui.vue3';\n\nimport './css/document-panel.css';\n\nexport const DocumentPanel: BitrixVueComponentProps = {\n\tname: 'DocumentPanel',\n\tinject: ['uploader', 'userFieldControl', 'getMessage'],\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\tdefault: {},\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisBoardsEnabled: this.userFieldControl.isBoardsEnabled(),\n\t\t};\n\t},\n\tcreated(): void\n\t{\n\t\tthis.menu = null;\n\t\tthis.currentServiceNode = null;\n\t},\n\tmounted(): void\n\t{\n\t\tconst labelText: string = Loc.getMessage('DISK_UF_WIDGET_EDIT_SERVICE_LABEL') || '';\n\t\tconst macros = '#NAME#';\n\t\tconst position: number = labelText.indexOf(macros);\n\t\tif (position !== -1)\n\t\t{\n\t\t\tconst preText: string = labelText.substring(0, position);\n\t\t\tconst postText: string = labelText.substring(position + macros.length);\n\n\t\t\tthis.currentServiceNode = Tag.render`\n\t\t\t\t<span class=\"disk-user-field-document-current-service\">${\n\t\t\t\t\tthis.userFieldControl.getCurrentDocumentService()?.name\n\t\t\t\t}</span>\n\t\t\t`;\n\n\t\t\tconst label = Tag.render`\n\t\t\t\t<span>\n\t\t\t\t\t<span>${preText}</span>\n\t\t\t\t\t${this.currentServiceNode}\n\t\t\t\t\t<span>${postText}</span>\n\t\t\t\t</span>\n\t\t\t`;\n\n\t\t\tDom.append(label, this.$refs['document-services']);\n\t\t}\n\t},\n\tmethods: {\n\t\tcreateDocument(documentType: string): void\n\t\t{\n\t\t\t// TODO: load disk and disk.document extensions on demand\n\t\t\tif (!BX.Disk.getDocumentService() && BX.Disk.isAvailableOnlyOffice())\n\t\t\t{\n\t\t\t\tBX.Disk.saveDocumentService('onlyoffice');\n\t\t\t}\n\t\t\telse if (!BX.Disk.getDocumentService())\n\t\t\t{\n\t\t\t\tBX.Disk.saveDocumentService('l');\n\t\t\t}\n\n\t\t\tlet newTab = null;\n\t\t\tif (documentType === 'board')\n\t\t\t{\n\t\t\t\tnewTab = window.open('', '_blank');\n\t\t\t}\n\n\t\t\tif (BX.Disk.Document.Local.Instance.isSetWorkWithLocalBDisk() || documentType === 'board')\n\t\t\t{\n\t\t\t\tBX.Disk.Document.Local.Instance.createFile({ type: documentType }).then((response): void => {\n\t\t\t\t\tif (response.status === 'success')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.uploader.addFile(\n\t\t\t\t\t\t\t`n${response.object.id}`,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: response.object.name,\n\t\t\t\t\t\t\t\tpreload: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tthis.userFieldControl.showUploaderPanel();\n\n\t\t\t\t\t\tif (newTab !== null && response.openUrl)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnewTab.location.href = response.openUrl;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst createProcess = new BX.Disk.Document.CreateProcess({\n\t\t\t\t\ttypeFile: documentType,\n\t\t\t\t\tserviceCode: BX.Disk.getDocumentService(),\n\t\t\t\t\tonAfterSave: (response, fileData): void => {\n\t\t\t\t\t\tif (response.status !== 'success')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (response.object)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.uploader.addFile(\n\t\t\t\t\t\t\t\t`n${response.object.id}`,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: response.object.name,\n\t\t\t\t\t\t\t\t\tsize: response.object.size,\n\t\t\t\t\t\t\t\t\tpreload: true,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tthis.userFieldControl.showUploaderPanel();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tcreateProcess.start();\n\t\t\t}\n\t\t},\n\n\t\topenMenu(): void\n\t\t{\n\t\t\tif (this.menu !== null)\n\t\t\t{\n\t\t\t\tthis.menu.destroy();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.menu = new Menu({\n\t\t\t\tbindElement: this.currentServiceNode,\n\t\t\t\tclassName: 'disk-user-field-settings-popup',\n\t\t\t\tangle: true,\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetTop: 5,\n\t\t\t\tcacheable: false,\n\t\t\t\titems: this.getMenuItems(),\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: (): void => {\n\t\t\t\t\t\tthis.menu = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.menu.show();\n\t\t},\n\n\t\tgetMenuItems(): Array\n\t\t{\n\t\t\tconst items = [];\n\t\t\tconst currentServiceCode = this.userFieldControl.getCurrentDocumentService()?.code;\n\t\t\tconst services: Array<{ name: string, code: string }> = Object.values(\n\t\t\t\tthis.userFieldControl.getDocumentServices(),\n\t\t\t);\n\n\t\t\tservices.forEach((service: { name: string, code: string }): void => {\n\t\t\t\titems.push({\n\t\t\t\t\ttext: service.name,\n\t\t\t\t\tclassName: currentServiceCode === service.code ? 'disk-user-field-item-checked' : 'disk-user-field-item-stub',\n\t\t\t\t\tonclick: (event, item: MenuItem): void => {\n\t\t\t\t\t\tBX.Disk.saveDocumentService(service.code);\n\t\t\t\t\t\tthis.currentServiceNode.textContent = service.name;\n\t\t\t\t\t\tthis.menu.close();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn items;\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"disk-user-field-panel\">\n\t\t\t<div class=\"disk-user-field-panel-doc-wrap\">\n\t\t\t\t<div class=\"disk-user-field-panel-card-box\" @click=\"createDocument('docx')\">\n\t\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card--doc\">\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ getMessage('DISK_UF_WIDGET_CREATE_DOCX') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"disk-user-field-panel-card-box\" @click=\"createDocument('xlsx')\">\n\t\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card--xls\">\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ getMessage('DISK_UF_WIDGET_CREATE_XLSX') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"disk-user-field-panel-card-box\" @click=\"createDocument('pptx')\">\n\t\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card--ppt\">\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ getMessage('DISK_UF_WIDGET_CREATE_PPTX') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"disk-user-field-panel-card-box\" @click=\"createDocument('board')\" v-if=\"isBoardsEnabled\">\n\t\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card--board\">\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ getMessage('DISK_UF_WIDGET_CREATE_BOARD') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"disk-user-field-create-document-by-service\" @click=\"openMenu\" ref=\"document-services\"></div>\n\t\t</div>\n\t`,\n};\n","import { Type, Loc } from 'main.core';\nimport type { BaseEvent } from 'main.core.events';\nimport { VueUploaderComponent } from 'ui.uploader.vue';\nimport { TileWidgetComponent, TileWidgetSlot, TileWidgetOptions, TileWidgetItem } from 'ui.uploader.tile-widget';\n\nimport UserFieldWidget from './user-field-widget';\nimport UserFieldControl from './user-field-control';\nimport ItemMenu from './item-menu';\nimport SettingsMenu from './settings-menu';\n\nimport { ControlPanel } from './components/control-panel';\nimport { DocumentPanel } from './components/document-panel';\n\nimport './css/user-field-widget-component.css';\n\nimport type { UploaderOptions } from 'ui.uploader.core';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport type { Menu } from 'main.popup';\nimport { UserFieldWidgetOptions } from './user-field-widget-options';\n\n/**\n * @memberof BX.Disk.Uploader\n */\nexport const UserFieldWidgetComponent: BitrixVueComponentProps = {\n\tname: 'UserFieldWidget',\n\textends: VueUploaderComponent,\n\tcomponents: {\n\t\tTileWidgetComponent,\n\t\tDocumentPanel,\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tcustomUploaderOptions: UserFieldWidget.getDefaultUploaderOptions(),\n\t\t};\n\t},\n\tprops: {\n\t\tvisibility: {\n\t\t\ttype: String,\n\t\t\tdefault(rawProps): string {\n\t\t\t\tconst mainPostFormContext = Type.isElementNode(rawProps.widgetOptions.eventObject);\n\n\t\t\t\treturn mainPostFormContext ? 'hidden' : 'both';\n\t\t\t},\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tdocumentsCollapsed: this.visibility === 'both',\n\t\t\tpriorityVisibility: null,\n\t\t};\n\t},\n\tprovide(): Object<string, any>\n\t{\n\t\treturn {\n\t\t\tuserFieldControl: this.userFieldControl,\n\t\t\tpostForm: this.userFieldControl.getMainPostForm(),\n\t\t\tgetMessage: this.getMessage,\n\t\t};\n\t},\n\tbeforeCreate(): void\n\t{\n\t\tthis.userFieldControl = new UserFieldControl(this);\n\t},\n\tmethods: {\n\t\tgetMessage(code: string, replacements?: Object<string, string>): ?string\n\t\t{\n\t\t\treturn Loc.getMessage(code, replacements);\n\t\t},\n\n\t\tenableAutoCollapse(): void\n\t\t{\n\t\t\tthis.$refs.tileWidget.enableAutoCollapse();\n\t\t},\n\n\t\tgetUploaderOptions(): UploaderOptions\n\t\t{\n\t\t\treturn UserFieldWidget.prepareUploaderOptions(this.uploaderOptions);\n\t\t},\n\t\tgetUserFieldControl(): UserFieldControl\n\t\t{\n\t\t\treturn this.userFieldControl;\n\t\t},\n\t},\n\tcomputed: {\n\t\ttileWidgetOptions(): TileWidgetOptions {\n\t\t\tconst widgetOptions: UserFieldWidgetOptions = this.widgetOptions;\n\t\t\tconst tileWidgetOptions: TileWidgetOptions = (\n\t\t\t\tType.isPlainObject(widgetOptions.tileWidgetOptions)\n\t\t\t\t\t? { ...widgetOptions.tileWidgetOptions }\n\t\t\t\t\t: {}\n\t\t\t);\n\n\t\t\ttileWidgetOptions.slots = Type.isPlainObject(tileWidgetOptions.slots) ? tileWidgetOptions.slots : {};\n\t\t\ttileWidgetOptions.slots[TileWidgetSlot.AFTER_TILE_LIST] = ControlPanel;\n\t\t\ttileWidgetOptions.insertIntoText = (\n\t\t\t\tType.isBoolean(widgetOptions.insertIntoText)\n\t\t\t\t\t? widgetOptions.insertIntoText\n\t\t\t\t\t: this.userFieldControl.getMainPostForm() !== null\n\t\t\t);\n\n\t\t\ttileWidgetOptions.showItemMenuButton = true;\n\n\t\t\ttileWidgetOptions.events = tileWidgetOptions.events || {};\n\t\t\ttileWidgetOptions.events['TileItem:onMenuCreate'] = (event: BaseEvent): void => {\n\t\t\t\tconst { item, menu }: { item: TileWidgetItem, menu: Menu } = event.getData();\n\t\t\t\tconst itemMenu: ItemMenu = new ItemMenu(this.userFieldControl, item, menu);\n\t\t\t\titemMenu.build();\n\t\t\t};\n\n\t\t\tif (this.userFieldControl.getMainPostForm() !== null)\n\t\t\t{\n\t\t\t\ttileWidgetOptions.events.onInsertIntoText = (event: BaseEvent): void => {\n\t\t\t\t\tconst { item }: { item: TileWidgetItem } = event.getData();\n\t\t\t\t\tthis.userFieldControl.getMainPostForm().insertIntoText(item);\n\t\t\t\t};\n\n\t\t\t\ttileWidgetOptions.enableDropzone = false;\n\t\t\t}\n\n\t\t\tconst settingsMenu: SettingsMenu = new SettingsMenu(this.userFieldControl);\n\t\t\tif (settingsMenu.hasItems())\n\t\t\t{\n\t\t\t\ttileWidgetOptions.showSettingsButton = true;\n\t\t\t\ttileWidgetOptions.events['SettingsButton:onClick'] = (event: BaseEvent): void => {\n\t\t\t\t\tconst { button } = event.getData();\n\t\t\t\t\tsettingsMenu.toggle(button);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn tileWidgetOptions;\n\t\t},\n\t\tshouldShowCreateDocumentLink(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.userFieldControl.canCreateDocuments()\n\t\t\t\t&& this.documentsCollapsed\n\t\t\t\t&& this.finalVisibility === 'both'\n\t\t\t);\n\t\t},\n\t\tshouldShowDocuments(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.userFieldControl.canCreateDocuments()\n\t\t\t\t&& (\n\t\t\t\t\tthis.finalVisibility === 'documents'\n\t\t\t\t\t|| (this.finalVisibility === 'both' && !this.documentsCollapsed)\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\tfinalVisibility(): string\n\t\t{\n\t\t\tif (this.priorityVisibility !== null)\n\t\t\t{\n\t\t\t\treturn this.priorityVisibility;\n\t\t\t}\n\n\t\t\treturn this.visibility;\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"disk-user-field-control\" \n\t\t\t:class=\"[{ '--has-files': this.items.length > 0 }]\"\n\t\t\t:style=\"{ display: finalVisibility === 'hidden' ? 'none' : 'block' }\"\n\t\t\tref=\"container\"\n\t\t>\n\t\t\t<div \n\t\t\t\tclass=\"disk-user-field-uploader-panel\"\n\t\t\t\t:class=\"[{ '--hidden': finalVisibility !== 'uploader' && finalVisibility !== 'both' }]\"\n\t\t\t\tref=\"uploader-container\"\n\t\t\t>\n\t\t\t\t<TileWidgetComponent\n\t\t\t\t\t:widgetOptions=\"tileWidgetOptions\" \n\t\t\t\t\t:uploader-adapter=\"adapter\"\n\t\t\t\t\tref=\"tileWidget\"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div \n\t\t\t\tclass=\"disk-user-field-create-document\"\n\t\t\t\tv-if=\"shouldShowCreateDocumentLink\"\n\t\t\t\t@click=\"documentsCollapsed = false\"\n\t\t\t>{{ getMessage('DISK_UF_WIDGET_CREATE_DOCUMENT') }}</div>\n\n\t\t\t<div \n\t\t\t\tclass=\"disk-user-field-document-panel\"\n\t\t\t\t:class=\"{ '--single': finalVisibility !== 'both' }\"\n\t\t\t\tref=\"document-container\"\n\t\t\t\tv-if=\"shouldShowDocuments\"\n\t\t\t>\n\t\t\t\t<DocumentPanel />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { VueUploaderWidget } from 'ui.uploader.vue';\n\nimport { UserFieldWidgetComponent } from './user-field-widget-component';\n\nimport type { UploaderOptions } from 'ui.uploader.core';\nimport type { UserFieldWidgetOptions } from './user-field-widget-options';\n\n/**\n * @memberof BX.Disk.Uploader\n */\nexport default class UserFieldWidget extends VueUploaderWidget\n{\n\tconstructor(uploaderOptions: UploaderOptions, options: UserFieldWidgetOptions)\n\t{\n\t\tconst widgetOptions: UserFieldWidgetOptions = Type.isPlainObject(options) ? { ...options } : {};\n\t\tsuper(UserFieldWidget.prepareUploaderOptions(uploaderOptions), widgetOptions);\n\t}\n\n\tdefineComponent(): ?Function\n\t{\n\t\treturn UserFieldWidgetComponent;\n\t}\n\n\tstatic prepareUploaderOptions(uploaderOptions: UploaderOptions): UploaderOptions\n\t{\n\t\treturn {\n\t\t\t...UserFieldWidget.getDefaultUploaderOptions(),\n\t\t\t...(Type.isPlainObject(uploaderOptions) ? uploaderOptions : {}),\n\t\t};\n\t}\n\n\tstatic getDefaultUploaderOptions(): UploaderOptions\n\t{\n\t\treturn {\n\t\t\tcontroller: 'disk.uf.integration.diskUploaderController',\n\t\t\tmultiple: true,\n\t\t\tmaxFileSize: null,\n\t\t};\n\t}\n}\n"],"names":["HtmlParser","constructor","form","syncHighlightsDebounced","Runtime","debounce","syncHighlights","EventEmitter","emit","getEventObject","getParser","id","init","bind","parse","unparse","getHtmlEditor","insertFile","file","bbDelimiter","isImage","htmlDelimiter","createItemBBCode","createItemHtml","removeFile","item","GetViewMode","doc","GetIframeDoc","Object","keys","bxTags","forEach","tagId","tag","serverFileId","node","getElementById","parentNode","removeChild","SaveContent","content","GetContent","replace","str","foundId","objectId","attachedId","items","getUserFieldControl","getItems","find","customData","SetContent","Focus","selectItem","setCustomData","deselectItem","inserted","Set","add","hasInsertedItems","files","getFiles","has","getServerFileId","getPhotoTemplateMode","setPhotoTemplate","SetBxTag","hideContextMenu","fileId","imageSrc","bbCode","getPreviewUrl","getServerPreviewUrl","previewWidth","getPreviewWidth","getServerPreviewWidth","previewHeight","getPreviewHeight","getServerPreviewHeight","renderWidth","renderHeight","ratioWidth","ratioHeight","ratio","Math","min","useOriginalSize","width","height","Text","encode","getName","getCustomData","htmlEditor","test","insertedFile","bxTag","uploaderFile","toInteger","MainPostForm","userFieldControl","options","setEventNamespace","eventObject","subscribeFromOptions","events","subscribeOnce","canCreateDocuments","subscribe","Event","ready","selectFileButton","event","BaseEvent","data","compatData","deselectFileButton","selectCreateDocumentButton","container","closest","setAttribute","deselectCreateDocumentButton","removeAttribute","insertIntoText","getFile","postForm","setTimeout","console","error","isReady","getEditor","Promise","resolve","reject","clipboardEvent","getData","clipboardData","stopImmediatePropagation","isFilePasted","preventDefault","getFilesFromDataTransfer","then","getUploader","addFile","FileEvent","LOAD_ERROR","UPLOAD_ERROR","LOAD_COMPLETE","UPLOAD_COMPLETE","uploadedFile","getTarget","showUploaderPanel","catch","PostForm","Reflection","getClass","result","repo","editor","Type","isArrayFilled","getCompatData","status","isArray","shift","hide","fieldName","getHiddenFieldName","ids","map","storage","values","handler","selectFile","tab","path","selected","removeFiles","undefined","Array","uploader","uploadFiles","filteredFiles","uploadFile","getId","getItem","image","src","html","UploaderError","dragEvent","dataTransfer","addFiles","adapter","getAdapter","clear","userFields","userField","isPlainObject","isStringFilled","setPhotoTemplateMode","nextTick","length","enableAutoCollapse","fileIds","filter","loaded","addedFiles","onLoad","fileOptions","Tag","render","Loc","getMessage","BODY","ID","hasAttribute","showDocumentPanel","isOpen","instances","Map","UserFieldControl","widgetComponent","widgetOptions","photoTemplateFieldName","allowDocumentFieldName","setDocumentEdit","removeAllowDocumentEditInput","disableLocalEdit","BX","Disk","Document","Local","Instance","disable","getHiddenFieldsContainer","photoTemplate","photoTemplateMode","Dom","append","warn","isElementNode","onReady","mainPostFormId","getRandom","toLowerCase","set","getById","get","getInstances","settings","Extension","getSettings","getMainPostForm","$nextTick","priorityVisibility","removeFromServer","canAllowDocumentEdit","canItemAllowEdit","isEditable","canUpdate","getAllowDocumentEditInput","selector","querySelector","input","remove","allowEdit","value","canChangePhotoTemplate","name","getPhotoTemplate","mode","getDocumentServices","documentHandlers","getCurrentDocumentService","currentServiceCode","getDocumentService","isAvailableOnlyOffice","getImportServices","importHandlers","canUseImportService","getImportFeatureId","isBoardsEnabled","loadDiskFileDialog","dialogName","params","loadExtension","handleInit","unsubscribe","DiskFileDialog","Ajax","getDialogInitUrl","url","Uri","addParam","ItemMenu","menu","build","getPopupWindow","setMaxWidth","addMenuItem","delimiter","className","text","onclick","menuItem","getMenuWindow","close","canRename","renameItem","canMove","openFolderDialog","disabled","tileSelected","rename","newName","runAction","autoCorrect","generateUniqueName","response","object","setName","showModalWithStatusAction","wish","obCallback","saveButton","selectedItems","folderByPath","selectedItem","folderId","rootObjectId","toFolderId","setServerFileId","popupWindow","openDialog","exports","Button","ButtonSize","ButtonColor","CancelButton","handleKeydown","code","handleRenameClick","nameWithoutExtension","getFilenameWithoutExtension","textareaValue","textarea","trim","renameBtn","setWaiting","newFilename","getFileExtension","color","PRIMARY","size","SMALL","cancelBtn","submenu","getSubMenu","textareaItem","getMenuItem","setText","showSubMenu","SettingsMenu","getMenu","button","Menu","bindElement","getContainer","angle","autoHide","offsetLeft","cacheable","onShow","select","onDestroy","deselect","show","toggle","isShown","hasItems","loadingDialogs","openDiskFileDialog","dialogId","isFunction","onSelect","onClose","Uploader","delete","preload","popupDestroy","CloudLoadController","AbstractLoadController","server","load","progress","abort","CloudUploadController","AbstractUploadController","serviceId","upload","ExternalLoader","startLoad","service","onFinish","newData","fileInfo","onProgress","onError","errors","createFromAjaxErrors","openCloudFileDialog","cloudImport","type","toNumber","sizeInt","loadController","getServer","provider","uploadController","ajax","dataType","onsuccess","authUrl","openAuthPopup","initGooglePicker","picker","loadAndShowPicker","onfailure","sendRequest","dialogOptions","util","popup","window","matches","document","location","hash","match","GoogleDrivePicker","clientId","appId","apiKey","accessToken","Loader","props","Number","default","String","offset","created","loader","mounted","target","$refs","beforeUnmount","destroy","template","ControlPanel","inject","components","showDialogLoader","showCloudDialogLoader","currentServiceId","fileDialogId","cloudDialogId","importServices","importFeatureId","assignBrowse","methods","FeaturePromotersRegistry","getPromoter","featureId","finalize","DocumentPanel","currentServiceNode","labelText","macros","position","indexOf","preText","substring","postText","label","createDocument","documentType","saveDocumentService","newTab","open","isSetWorkWithLocalBDisk","createFile","openUrl","href","createProcess","CreateProcess","typeFile","serviceCode","onAfterSave","fileData","start","openMenu","offsetTop","getMenuItems","services","push","textContent","UserFieldWidgetComponent","extends","VueUploaderComponent","TileWidgetComponent","setup","customUploaderOptions","UserFieldWidget","getDefaultUploaderOptions","visibility","rawProps","mainPostFormContext","documentsCollapsed","provide","beforeCreate","replacements","tileWidget","getUploaderOptions","prepareUploaderOptions","uploaderOptions","computed","tileWidgetOptions","slots","TileWidgetSlot","AFTER_TILE_LIST","isBoolean","showItemMenuButton","itemMenu","onInsertIntoText","enableDropzone","settingsMenu","showSettingsButton","shouldShowCreateDocumentLink","finalVisibility","shouldShowDocuments","VueUploaderWidget","defineComponent","controller","multiple","maxFileSize"],"mappings":";;;;;;CAEgD;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAKhD,CAAe,MAAMA,UAAU,CAC/B;GAOCC,WAAW,CAACC,IAAkB,EAC9B;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OAPsB;;KAAI;OAAA;OAAA,OACd;;KAAW;OAAA;OAAA,OACR;;KAAqB;OAAA;OAAA,OAClB;;KAA+C,KACjEC,uBAAuB,GAAa,IAAI;KAIvC,4CAAI,kBAASD,IAAI;KAEjB,IAAI,CAACC,uBAAuB,GAAGC,iBAAO,CAACC,QAAQ,CAAC,IAAI,CAACC,cAAc,EAAE,GAAG,EAAE,IAAI,CAAC;;;KAG/EC,6BAAY,CAACC,IAAI,CAAC,4CAAI,gBAAOC,cAAc,EAAE,EAAE,kBAAkB,EAAE,IAAI,CAACC,SAAS,EAAE,CAAC;;GAGrFA,SAAS,GACT;KACC,OAAO;OACNC,EAAE,0CAAE,IAAI,uBAAU;OAClBC,IAAI,EAAE,4CAAI,gBAAOC,IAAI,CAAC,IAAI,CAAC;OAC3BC,KAAK,EAAE,4CAAI,kBAAQD,IAAI,CAAC,IAAI,CAAC;OAC7BE,OAAO,EAAE,4CAAI,sBAAUF,IAAI,CAAC,IAAI;MAChC;;;;CAIH;CACA;CACA;GACCG,aAAa,GACb;KACC,OAAO,4CAAI,gBAAOA,aAAa,EAAE;;GAGlCC,UAAU,CAACC,IAAkB,EAC7B;KACC,MAAMC,WAAmB,GAAGD,IAAI,CAACE,OAAO,EAAE,GAAG,IAAI,GAAG,GAAG;KACvD,MAAMC,aAAqB,GAAGH,IAAI,CAACE,OAAO,EAAE,GAAG,MAAM,GAAG,QAAQ;KAEhEb,6BAAY,CAACC,IAAI,CAAC,IAAI,CAACQ,aAAa,EAAE,EAAE,iBAAiB,EAAE,CAC1DG,WAAW,GAAG,IAAI,CAACG,gBAAgB,CAACJ,IAAI,CAAC,GAAGC,WAAW,EACvDE,aAAa,GAAG,IAAI,CAACE,cAAc,CAACL,IAAI,CAAC,GAAGG,aAAa,CACzD,CAAC;KAEF,IAAI,CAACf,cAAc,EAAE;;GAGtBkB,UAAU,CAACC,IAAoB,EAC/B;KACC,IAAI,IAAI,CAACT,aAAa,EAAE,CAACU,WAAW,EAAE,KAAK,SAAS,EACpD;OACC,MAAMC,GAAG,GAAG,IAAI,CAACX,aAAa,EAAE,CAACY,YAAY,EAAE;OAC/CC,MAAM,CAACC,IAAI,CAAC,IAAI,CAACd,aAAa,EAAE,CAACe,MAAM,CAAC,CAACC,OAAO,CAAEC,KAAa,IAAK;SACnE,MAAMC,GAAG,GAAG,IAAI,CAAClB,aAAa,EAAE,CAACe,MAAM,CAACE,KAAK,CAAC;SAC9C,IAAIC,GAAG,CAACA,GAAG,6CAAK,IAAI,uBAAU,IAAIA,GAAG,CAACC,YAAY,KAAKV,IAAI,CAACU,YAAY,EACxE;WACC,MAAMC,IAAI,GAAGT,GAAG,CAACU,cAAc,CAACJ,KAAK,CAAC;WACtC,IAAIG,IAAI,EACR;aACCA,IAAI,CAACE,UAAU,CAACC,WAAW,CAACH,IAAI,CAAC;;;QAGnC,CAAC;OAEF,IAAI,CAACpB,aAAa,EAAE,CAACwB,WAAW,EAAE;MAClC,MAED;OACC,MAAMC,OAAO,GAAG,IAAI,CAACzB,aAAa,EAAE,CAAC0B,UAAU,EAAE,CAACC,OAAO,yCACxD,IAAI,qBACJ,CAACC,GAAG,EAAEC,OAAO,KAAa;SACzB,MAAM;WAAEC,QAAQ;WAAEC;UAAY,2CAAG,IAAI,oBAASF,OAAO,CAAC;SACtD,MAAMG,KAAuB,GAAG,4CAAI,gBAAOC,mBAAmB,EAAE,CAACC,QAAQ,EAAE;SAC3E,MAAMzB,IAAoB,GAAGuB,KAAK,CAACG,IAAI,CAAE1B,IAAoB,IAAK;WACjE,OAAOA,IAAI,CAACU,YAAY,KAAKY,UAAU,IAAItB,IAAI,CAAC2B,UAAU,CAACN,QAAQ,KAAKA,QAAQ;UAChF,CAAC;SAEF,OAAOrB,IAAI,GAAG,EAAE,GAAGmB,GAAG;QACtB,CACD;OAED,IAAI,CAAC5B,aAAa,EAAE,CAACqC,UAAU,CAACZ,OAAO,CAAC;OACxC,IAAI,CAACzB,aAAa,EAAE,CAACsC,KAAK,EAAE;;KAG7B,IAAI,CAAChD,cAAc,EAAE;;GAGtBiD,UAAU,CAACrC,IAAkB,EAC7B;KACCA,IAAI,CAACsC,aAAa,CAAC,cAAc,EAAE,IAAI,CAAC;;GAGzCC,YAAY,CAACvC,IAAkB,EAC/B;KACCA,IAAI,CAACsC,aAAa,CAAC,cAAc,EAAE,KAAK,CAAC;;GAG1ClD,cAAc,GACd;KACC,MAAMqB,GAAG,GAAG,IAAI,CAACX,aAAa,EAAE,CAACY,YAAY,EAAE;KAC/C,MAAM8B,QAA8B,GAAG,IAAIC,GAAG,EAAE;KAChD9B,MAAM,CAACC,IAAI,CAAC,IAAI,CAACd,aAAa,EAAE,CAACe,MAAM,CAAC,CAACC,OAAO,CAAEC,KAAa,IAAW;OACzE,MAAMC,GAAG,GAAG,IAAI,CAAClB,aAAa,EAAE,CAACe,MAAM,CAACE,KAAK,CAAC;OAC9C,IAAIC,GAAG,CAACA,GAAG,6CAAK,IAAI,uBAAU,IAAIP,GAAG,CAACU,cAAc,CAACJ,KAAK,CAAC,EAC3D;SACCyB,QAAQ,CAACE,GAAG,CAAC1B,GAAG,CAACC,YAAY,CAAC;;MAE/B,CAAC;KAEF,IAAI0B,gBAAgB,GAAG,KAAK;KAE5B,MAAMC,KAAqB,GAAG,4CAAI,gBAAOb,mBAAmB,EAAE,CAACc,QAAQ,EAAE;KACzED,KAAK,CAAC9B,OAAO,CAAEd,IAAkB,IAAW;OAC3C,IAAIwC,QAAQ,CAACM,GAAG,CAAC9C,IAAI,CAAC+C,eAAe,EAAE,CAAC,EACxC;SACCJ,gBAAgB,GAAG,IAAI;SACvB,IAAI,CAACN,UAAU,CAACrC,IAAI,CAAC;QACrB,MAED;SACC,IAAI,CAACuC,YAAY,CAACvC,IAAI,CAAC;;MAExB,CAAC;KAEF,IAAI,4CAAI,gBAAO+B,mBAAmB,EAAE,CAACiB,oBAAoB,EAAE,KAAK,MAAM,EACtE;OACC,4CAAI,gBAAOjB,mBAAmB,EAAE,CAACkB,gBAAgB,CAACN,gBAAgB,GAAG,SAAS,GAAG,MAAM,CAAC;;;GAI1FtC,cAAc,CAACL,IAAkB,EAAEP,EAAU,EAC7C;KACC,MAAMsB,KAAK,GAAG,IAAI,CAACjB,aAAa,EAAE,CAACoD,QAAQ,CAAC,KAAK,EAAE;OAClDlC,GAAG,0CAAE,IAAI,uBAAU;OACnBC,YAAY,EAAEjB,IAAI,CAAC+C,eAAe,EAAE;OACpCI,eAAe,EAAE,IAAI;OACrBC,MAAM,EAAEpD,IAAI,CAAC+C,eAAe;MAC5B,CAAC;KAEF,IAAI/C,IAAI,CAACE,OAAO,EAAE,EAClB;OACC,MAAMmD,QAAQ,GAAG,IAAI,CAACvD,aAAa,EAAE,CAACwD,MAAM,GAAGtD,IAAI,CAACuD,aAAa,EAAE,GAAGvD,IAAI,CAACwD,mBAAmB,EAAE;OAChG,MAAMC,YAAY,GAAG,IAAI,CAAC3D,aAAa,EAAE,CAACwD,MAAM,GAAGtD,IAAI,CAAC0D,eAAe,EAAE,GAAG1D,IAAI,CAAC2D,qBAAqB,EAAE;OACxG,MAAMC,aAAa,GAAG,IAAI,CAAC9D,aAAa,EAAE,CAACwD,MAAM,GAAGtD,IAAI,CAAC6D,gBAAgB,EAAE,GAAG7D,IAAI,CAAC8D,sBAAsB,EAAE;OAE3G,MAAMC,WAAW,GAAG,GAAG,CAAC;OACxB,MAAMC,YAAY,GAAG,GAAG,CAAC;OACzB,MAAMC,UAAkB,GAAGF,WAAW,GAAGN,YAAY;OACrD,MAAMS,WAAmB,GAAGF,YAAY,GAAGJ,aAAa;OACxD,MAAMO,KAAa,GAAGC,IAAI,CAACC,GAAG,CAACJ,UAAU,EAAEC,WAAW,CAAC;OAEvD,MAAMI,eAAe,GAAGH,KAAK,GAAG,CAAC,CAAC;OAClC,MAAMI,KAAK,GAAGD,eAAe,GAAGb,YAAY,GAAGA,YAAY,GAAGU,KAAK;OACnE,MAAMK,MAAM,GAAGF,eAAe,GAAGV,aAAa,GAAGA,aAAa,GAAGO,KAAK;OAEtE,OAAQ,uCAAsCI,KAAM,aAAYC,MAAO,sBAAqBC,cAAI,CAACC,MAAM,CAAC1E,IAAI,CAAC+C,eAAe,EAAE,CAAE,SAAQhC,KAAM,UAASsC,QAAS,YAAWoB,cAAI,CAACC,MAAM,CAAC1E,IAAI,CAAC2E,OAAO,EAAE,CAAE,8BAA6B;MACpO,MACI,IAAI3E,IAAI,CAAC4E,aAAa,CAAC,UAAU,CAAC,KAAK,QAAQ,EACpD;OACC,OAAQ,mFAAkFH,cAAI,CAACC,MAAM,CAAC1E,IAAI,CAAC+C,eAAe,EAAE,CAAE,SAAQhC,KAAM,mHAAkH;;KAG/P,OAAQ,kDAAiD0D,cAAI,CAACC,MAAM,CAAC1E,IAAI,CAAC+C,eAAe,EAAE,CAAE,SAAQhC,KAAM,8EAA6E0D,cAAI,CAACC,MAAM,CAAC1E,IAAI,CAAC2E,OAAO,EAAE,CAAE,SAAQ;;GAG7NvE,gBAAgB,CAACJ,IAAkB,EACnC;KACC,OAAO,4CAAI,cAAMyB,OAAO,CAAC,MAAM,EAAEzB,IAAI,CAAC+C,eAAe,EAAE,CAAC;;CAuE1D;CAAC,gBApEM8B,UAAU,EAChB;;CACC;CACA,iBAEMtD,OAAO,EACd;GACC,IAAI,CAAC,4CAAI,oBAASuD,IAAI,CAACvD,OAAO,CAAC,EAC/B;KACC,OAAOA,OAAO;;GAGf,IAAI,CAACtC,uBAAuB,EAAE;GAE9B,OAAOsC,OAAO,CAACE,OAAO,yCACrB,IAAI,qBACJ,CAACC,GAAG,EAAEjC,EAAE,KAAa;KACpB,MAAM;OAAEmC,QAAQ;OAAEC;MAAY,2CAAG,IAAI,oBAASpC,EAAE,CAAC;KAEjD,MAAMmD,KAAqB,GAAG,4CAAI,gBAAOb,mBAAmB,EAAE,CAACc,QAAQ,EAAE;KACzE,MAAMkC,YAA0B,GAAGnC,KAAK,CAACX,IAAI,CAAEjC,IAAkB,IAAK;OACrE,OAAOA,IAAI,CAAC+C,eAAe,EAAE,KAAKlB,UAAU,IAAI7B,IAAI,CAAC4E,aAAa,CAAC,UAAU,CAAC,KAAKhD,QAAQ;MAC3F,CAAC;KAEF,IAAImD,YAAY,EAChB;OACC,IAAI,CAAC1C,UAAU,CAAC0C,YAAY,CAAC;OAE7B,OAAO,IAAI,CAAC1E,cAAc,CAAC0E,YAAY,EAAEtF,EAAE,CAAC;;KAG7C,OAAOiC,GAAG;IACV,CACD;CACF;CAAC,mBAEQsD,KAAK,EACd;GACC,MAAM;KAAE/D;IAAc,GAAG+D,KAAK;GAE9B,MAAMpC,KAAqB,GAAG,4CAAI,gBAAOb,mBAAmB,EAAE,CAACc,QAAQ,EAAE;GACzE,MAAMoC,YAA0B,GAAGrC,KAAK,CAACX,IAAI,CAAEjC,IAAkB,IAAc;KAC9E,OAAOA,IAAI,CAAC+C,eAAe,EAAE,KAAK9B,YAAY;IAC9C,CAAC;GAEF,IAAIgE,YAAY,EAChB;KACC,OAAO,IAAI,CAAC7E,gBAAgB,CAAC6E,YAAY,CAAC;;GAG3C,OAAO,EAAE;CACV;CAAC,kBAEOxF,EAAU,EAClB;GACC,IAAImC,QAAiB,GAAG,IAAI;GAC5B,IAAIC,UAAmB,GAAG,IAAI;GAC9B,IAAIpC,EAAE,CAAC,CAAC,CAAC,KAAK,GAAG,EACjB;KACCmC,QAAQ,GAAG6C,cAAI,CAACS,SAAS,CAACzF,EAAE,CAACgC,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;IAC9C,MAED;KACCI,UAAU,GAAG4C,cAAI,CAACS,SAAS,CAACzF,EAAE,CAAC;;GAGhC,OAAO;KAAEmC,QAAQ;KAAEC;IAAY;CAChC;;;;ACxPD,CAIuC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAMvC,CAAe,MAAMsD,YAAY,SAAS9F,6BAAY,CACtD;GAQCN,WAAW,CAACqG,gBAAkC,EAAEC,OAA4B,EAC5E;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OAT6B;;KAAI;OAAA;OAAA,OACL;;KAAI;OAAA;OAAA,OACb;;KAAI;OAAA;OAAA,OACN;;KAAI;OAAA;OAAA,OAChB;;KAAI;OAAA;OAAA,OACR;;KAKT,IAAI,CAACC,iBAAiB,CAAC,8BAA8B,CAAC;KAEtD,4CAAI,0CAAqBF,gBAAgB;KACzC,4CAAI,gCAAgBC,OAAO,CAACE,WAAW;KAEvC,4CAAI;KAEJ,IAAI,CAACC,oBAAoB,CAACH,OAAO,CAACI,MAAM,CAAC;KAEzC,IAAI,CAACC,aAAa,CAAC,SAAS,EAAE,MAAY;OACzC,IAAI,4CAAI,wCAAmBC,kBAAkB,EAAE,EAC/C;SACC,4CAAI;;MAEL,CAAC;KAEF,4CAAI,wCAAmBC,SAAS,CAAC,uBAAuB,EAAE,4CAAI,0DAA4BjG,IAAI,CAAC,IAAI,CAAC,CAAC;KACrG,4CAAI,wCAAmBiG,SAAS,CAAC,uBAAuB,EAAE,4CAAI,0DAA4BjG,IAAI,CAAC,IAAI,CAAC,CAAC;KAErGkG,eAAK,CAACC,KAAK,CAAC,4CAAI,8CAAsBnG,IAAI,CAAC,IAAI,CAAC,CAAC;;GAGlDoC,mBAAmB,GACnB;KACC,+CAAO,IAAI;;GAGZvC,SAAS,GACT;KACC,+CAAO,IAAI;;;;CAIb;CACA;CACA;GACCM,aAAa,GACb;KACC,+CAAO,IAAI;;GAGZP,cAAc,GACd;KACC,+CAAO,IAAI;;GAGZwG,gBAAgB,GAChB;KACC,MAAMC,KAAgB,GAAG,IAAIC,0BAAS,CAAC;OACtCC,IAAI,EAAE,MAAM;;OAEZC,UAAU,EAAE,CAAC,mBAAmB;MAChC,CAAC;KAEF9G,6BAAY,CAACC,IAAI,yCAAC,IAAI,+BAAe,mBAAmB,EAAE0G,KAAK,CAAC;;GAGjEI,kBAAkB,GAClB;KACC,MAAMJ,KAAgB,GAAG,IAAIC,0BAAS,CAAC;OACtCC,IAAI,EAAE,MAAM;;OAEZC,UAAU,EAAE,CAAC,mBAAmB;MAChC,CAAC;KAEF9G,6BAAY,CAACC,IAAI,yCAAC,IAAI,+BAAe,mBAAmB,EAAE0G,KAAK,CAAC;;GAGjEK,0BAA0B,GAC1B;KACC,4CAAI,IAAI,iDACR;OACC,MAAMC,SAAsB,GAAG,4CAAI,gDAAuBC,OAAO,CAAC,2BAA2B,CAAC;OAC9F,IAAID,SAAS,EACb;SACCA,SAAS,CAACE,YAAY,CAAC,uBAAuB,EAAE,QAAQ,CAAC;;;;GAK5DC,4BAA4B,GAC5B;KACC,4CAAI,IAAI,iDACR;OACC,MAAMH,SAAsB,GAAG,4CAAI,gDAAuBC,OAAO,CAAC,2BAA2B,CAAC;OAC9F,IAAID,SAAS,EACb;SACCA,SAAS,CAACI,eAAe,CAAC,uBAAuB,CAAC;;;;GAqbrDC,cAAc,CAACpG,IAAoB,EACnC;KACC,MAAMP,IAAkB,GAAG,4CAAI,wCAAmB4G,OAAO,CAACrG,IAAI,CAACd,EAAE,CAAC;KAClE,4CAAI,4BAAaM,UAAU,CAACC,IAAI,CAAC;;CA4BnC;CAAC,iCA9cA;GACC,MAAM6G,QAAQ,2CAAG,IAAI,+BAAe;GACpC,IAAIA,QAAQ,KAAK,IAAI,EACrB;KACCC,UAAU,CAAC,MAAM;OAChB,MAAMD,QAAQ,2CAAG,IAAI,+BAAe;OACpC,IAAIA,QAAQ,EACZ;SACC,4CAAI,8CAAsBA,QAAQ;QAClC,MAED;SACCE,OAAO,CAACC,KAAK,CAAC,uCAAuC,CAAC;;MAEvD,EAAE,GAAG,CAAC;IACP,MAED;KACC,4CAAI,8CAAsBH,QAAQ;;CAEpC;CAAC,+BAEoBA,QAAkB,EACvC;GACC,IAAIA,QAAQ,CAACI,OAAO,EACpB;KACC,4CAAI,oBAAOJ,QAAQ;IACnB,MAED;KACCxH,6BAAY,CAACuG,SAAS,CAACiB,QAAQ,EAAE,kBAAkB,EAAE,MAAY;OAChE,4CAAI,oBAAOA,QAAQ;MACnB,CAAC;;CAEJ;CAAC,kBAMKA,QAAQ,EACd;GACC,4CAAI;GAEJ,4CAAI,8BAAeA,QAAQ,CAACK,SAAS,EAAE;GACvC,4CAAI,8BAAe,IAAIpI,UAAU,CAAC,IAAI,CAAC;GAEvCO,6BAAY,CAACuG,SAAS,yCAAC,IAAI,6BAAc,kBAAkB,EAAGI,KAAgB,IAAK;KAClF,4CAAI,4BAAa/G,uBAAuB,EAAE;IAC1C,CAAC;GAEFI,6BAAY,CAACuG,SAAS,yCAAC,IAAI,6BAAc,6BAA6B,EAAGI,KAAgB,IAAK;KAC7F,OAAO,IAAImB,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAW;OAC7C,MAAMC,cAA8B,GAAGtB,KAAK,CAACuB,OAAO,EAAE,CAACD,cAAc;OACrE,MAAME,aAA2B,GAAGF,cAAc,CAACE,aAAa;OAEhEF,cAAc,CAACG,wBAAwB,EAAE,CAAC;OAC1C,IAAI,CAACD,aAAa,IAAI,CAACE,6BAAY,CAACF,aAAa,CAAC,EAClD;SACCJ,OAAO,EAAE;SAET;;OAGDE,cAAc,CAACK,cAAc,EAAE,CAAC;OAChC3B,KAAK,CAAC2B,cAAc,EAAE,CAAC;;OAEvBC,yCAAwB,CAACJ,aAAa,CAAC,CACrCK,IAAI,CAAEjF,KAAa,IAAW;SAC9BA,KAAK,CAAC9B,OAAO,CAAEd,IAAU,IAAW;WACnC,IAAI,CAAC+B,mBAAmB,EAAE,CAAC+F,WAAW,EAAE,CAACC,OAAO,CAAC/H,IAAI,EAAE;aACtDyF,MAAM,EAAE;eACP,CAACuC,0BAAS,CAACC,UAAU,GAAG,MAAM,EAAE;eAChC,CAACD,0BAAS,CAACE,YAAY,GAAG,MAAM,EAAE;eAClC,CAACF,0BAAS,CAACG,aAAa,GAAInC,KAAgB,IAAW;;;;;;;;;gBAStD;eACD,CAACgC,0BAAS,CAACI,eAAe,GAAIpC,KAAgB,IAAW;iBACxD,MAAMqC,YAA0B,GAAGrC,KAAK,CAACsC,SAAS,EAAE;iBACpD,IAAI,CAACvG,mBAAmB,EAAE,CAACwG,iBAAiB,EAAE;iBAC9C,IAAI,CAAC/I,SAAS,EAAE,CAACO,UAAU,CAACsI,YAAY,CAAC;;;YAG3C,CAAC;UACF,CAAC;SAEFjB,OAAO,EAAE;QACT,CAAC,CACDoB,KAAK,CAAC,MAAY;SAClBpB,OAAO,EAAE;QACT,CAAC;MAEH,CAAC;IACF,CAAC;GAEF,IAAI,CAAC9H,IAAI,CAAC,SAAS,CAAC;GAEpB,4CAAI,sBAAW,IAAI;CACpB;CAAC,yBAGD;GACC,MAAMmJ,QAAe,GAAGC,oBAAU,CAACC,QAAQ,CAAC,kBAAkB,CAAC;GAC/D,IAAI,CAACF,QAAQ,EACb;KACC,OAAO,IAAI;;GAGZ,IAAIG,MAAM,GAAG,IAAI;GACjBH,QAAQ,CAACI,IAAI,CAAC/H,OAAO,CAAEgI,MAAM,IAAK;KACjC,IAAIA,MAAM,CAACvJ,cAAc,EAAE,KAAK,IAAI,CAACA,cAAc,EAAE,EACrD;OACCqJ,MAAM,GAAGE,MAAM;;IAEhB,CAAC;GAEF,OAAOF,MAAM;CACd;CAAC,6BAGD;;GAECvJ,6BAAY,CAACuG,SAAS,CAAC,IAAI,CAACrG,cAAc,EAAE,EAAE,mBAAmB,EAAGyG,KAAgB,IAAW;KAC9F,IAAI+C,cAAI,CAACC,aAAa,CAAChD,KAAK,CAACiD,aAAa,EAAE,CAAC,IAAIjD,KAAK,CAACiD,aAAa,EAAE,CAAC,CAAC,CAAC,KAAK,mBAAmB,EACjG;;OAEC;;KAGD,MAAMC,MAAM,GAAGH,cAAI,CAACI,OAAO,CAACnD,KAAK,CAACuB,OAAO,EAAE,CAAC,GAAGvB,KAAK,CAACuB,OAAO,EAAE,CAAC6B,KAAK,EAAE,GAAGpD,KAAK,CAACuB,OAAO,EAAE;KACxF,IAAI2B,MAAM,KAAK,MAAM,EACrB;OACC,IAAI,CAACnH,mBAAmB,EAAE,CAACwG,iBAAiB,EAAE;MAC9C,MAED;OACC,IAAI,CAACxG,mBAAmB,EAAE,CAACsH,IAAI,EAAE;;IAElC,CAAC;;;GAGFhK,6BAAY,CAACuG,SAAS,CAAC,IAAI,CAACrG,cAAc,EAAE,EAAE,2BAA2B,EAAGyG,KAAgB,IAAc;KACzG,OAAO,IAAImB,OAAO,CAAEC,OAAO,IAAW;OACrC,4CAAI,IAAI,qBACR;SACC,4CAAI,wDAA2BpB,KAAK,EAAE6B,IAAI,CAAC,MAAMT,OAAO,EAAE,CAAC;QAC3D,MAED;SACC,IAAI,CAAC1B,aAAa,CAAC,SAAS,EAAE,MAAY;WACzC,4CAAI,wDAA2BM,KAAK,EAAE6B,IAAI,CAAC,MAAMT,OAAO,EAAE,CAAC;UAC3D,CAAC;;MAEH,CAAC;IACF,CAAC;;;;;GAKF/H,6BAAY,CAACuG,SAAS,CAAC,IAAI,CAACrG,cAAc,EAAE,EAAE,sBAAsB,EAAGyG,KAAgB,IAAW;KACjG,MAAME,IAAI,GAAGF,KAAK,CAACuB,OAAO,EAAE;KAE5B,MAAM+B,SAAiB,GAAG,IAAI,CAACvH,mBAAmB,EAAE,CAAC+F,WAAW,EAAE,CAACyB,kBAAkB,EAAE;KACvF,MAAMC,GAAG,GAAG,IAAI,CAACzH,mBAAmB,EAAE,CAACC,QAAQ,EAAE,CAACyH,GAAG,CAAElJ,IAAoB,IAAsB;OAChG,OAAOA,IAAI,CAACU,YAAY;MACxB,CAAC;KAEFiF,IAAI,CAACoD,SAAS,CAAC,GAAG;OACjBI,OAAO,EAAE,MAAM;OACf1I,GAAG,EAAE,qBAAqB;OAC1B2I,MAAM,EAAEH,GAAG;OACXI,OAAO,EAAE;SACRC,UAAU,EAAE,CAACC,GAAG,EAAEC,IAAI,EAAEC,QAAQ,KAAW;WAC1CrJ,MAAM,CAACgJ,MAAM,CAACK,QAAQ,CAAC,CAAClJ,OAAO,CAAEP,IAAI,IAAW;aAC/C,IAAI,CAACwB,mBAAmB,EAAE,CAAC+F,WAAW,EAAE,CAACC,OAAO,CAACxH,IAAI,CAAC;YACtD,CAAC;UACF;SACD0J,WAAW,EAAGrH,KAAK,IAAW;WAC7B,IAAIA,KAAK,KAAKsH,SAAS,IAAIC,KAAK,CAAChB,OAAO,CAACvG,KAAK,CAAC,EAC/C;aACC,MAAMwH,QAAQ,GAAG,IAAI,CAACrI,mBAAmB,EAAE,CAAC+F,WAAW,EAAE;aACzD,MAAMuC,WAAW,GAAGD,QAAQ,CAACvH,QAAQ,EAAE;aACvC,IAAIyH,aAAa,GAAG1H,KAAK,CAAC6G,GAAG,CAAClJ,IAAI,IAAI8J,WAAW,CAACpI,IAAI,CAACsI,UAAU,IAAIA,UAAU,CAACxH,eAAe,EAAE,KAAKxC,IAAI,CAAC,CAACiK,KAAK,EAAE,CAAC;aAEpHF,aAAa,CAACxJ,OAAO,CAACd,IAAI,IAAI;eAC7BoK,QAAQ,CAAC9J,UAAU,CAACN,IAAI,CAAC;cACzB,CAAC;;;;MAIL;IACD,CAAC;;;GAGFX,6BAAY,CAACuG,SAAS,CAAC,IAAI,CAACrG,cAAc,EAAE,EAAE,kBAAkB,EAAGyG,KAAgB,IAAW;KAC7FA,KAAK,CAACyB,wBAAwB,EAAE;KAChC,IAAI,CAAC1F,mBAAmB,EAAE,CAAC+F,WAAW,EAAE,CAACC,OAAO,CAAC/B,KAAK,CAACuB,OAAO,EAAE,EAAE;OACjE9B,MAAM,EAAE;SACP,CAACuC,0BAAS,CAACI,eAAe,GAAIpC,KAAgB,IAAW;WACxD,MAAMhG,IAAkB,GAAGgG,KAAK,CAACsC,SAAS,EAAE;WAC5C,IAAI,CAACvG,mBAAmB,EAAE,CAACwG,iBAAiB,EAAE;WAC9C,IAAI,CAAC/I,SAAS,EAAE,CAACO,UAAU,CAACC,IAAI,CAAC;;;MAGnC,CAAC;IACF,CAAC;;;GAGFX,6BAAY,CAACuG,SAAS,CAAC,IAAI,CAACrG,cAAc,EAAE,EAAE,kBAAkB,EAAGyG,KAAgB,IAAW;KAC7FA,KAAK,CAACyB,wBAAwB,EAAE;KAEhC,OAAO,IAAIN,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAW;OAC7C,IAAI,CAACtF,mBAAmB,EAAE,CAAC+F,WAAW,EAAE,CAACC,OAAO,CAAC/B,KAAK,CAACuB,OAAO,EAAE,EAAE;SACjE9B,MAAM,EAAE;WACP,CAACuC,0BAAS,CAACC,UAAU,GAAIjC,KAAgB,IAAW;aACnD,MAAMgB,KAAoB,GAAGhB,KAAK,CAACuB,OAAO,EAAE,CAACP,KAAK;aAClDK,MAAM,CAACL,KAAK,CAAC;YACb;WACD,CAACgB,0BAAS,CAACE,YAAY,GAAG,MAAOlC,KAAgB,IAAW;aAC3D,MAAMgB,KAAoB,GAAGhB,KAAK,CAACuB,OAAO,EAAE,CAACP,KAAK;aAClDK,MAAM,CAACL,KAAK,CAAC;YACb;WACD,CAACgB,0BAAS,CAACI,eAAe,GAAIpC,KAAgB,IAAW;aACxD,MAAMhG,IAAkB,GAAGgG,KAAK,CAACsC,SAAS,EAAE;aAC5C,MAAM/H,IAAoB,GAAG,IAAI,CAACwB,mBAAmB,EAAE,CAAC0I,OAAO,CAACzK,IAAI,CAACwK,KAAK,EAAE,CAAC;aAC7E,IAAIjK,IAAI,EACR;eACC,IAAI,CAACf,SAAS,EAAE,CAACJ,cAAc,EAAE;eAEjCgI,OAAO,CAAC;iBACPsD,KAAK,EAAE;mBACNC,GAAG,EAAE3K,IAAI,CAACuD,aAAa,EAAE;mBACzBgB,KAAK,EAAEvE,IAAI,CAAC0D,eAAe,EAAE;mBAC7Bc,MAAM,EAAExE,IAAI,CAAC6D,gBAAgB;kBAC7B;iBACD+G,IAAI,EAAE,IAAI,CAACpL,SAAS,EAAE,CAACa,cAAc,CAACL,IAAI;gBAC1C,CAAC;cACF,MAED;eACCqH,MAAM,CAAC,IAAIwD,8BAAa,CAAC,mBAAmB,CAAC,CAAC;;;;QAIjD,CAAC;MACF,CAAC;IACF,CAAC;;;GAGFxL,6BAAY,CAACuG,SAAS,CAAC,IAAI,CAACrG,cAAc,EAAE,EAAE,mBAAmB,EAAGyG,KAAgB,IAAW;;KAE9FA,KAAK,CAACyB,wBAAwB,EAAE;IAChC,CAAC;GAEFpI,6BAAY,CAACuG,SAAS,CAAC,IAAI,CAACrG,cAAc,EAAE,EAAE,oBAAoB,EAAGyG,KAAgB,IAAW;KAC/FA,KAAK,CAACyB,wBAAwB,EAAE;KAEhC,MAAMqD,SAAoB,GAAG9E,KAAK,CAACuB,OAAO,EAAE,CAACvB,KAAK;KAElD4B,yCAAwB,CAACkD,SAAS,CAACC,YAAY,CAAC,CAC9ClD,IAAI,CAAEjF,KAAa,IAAW;OAC9B,IAAI,CAACb,mBAAmB,EAAE,CAAC+F,WAAW,EAAE,CAACkD,QAAQ,CAACpI,KAAK,CAAC;MACxD,CAAC,CACD4F,KAAK,CAAC,MAAM,EAAE,CAAC;IAEjB,CAAC;CACH;CAAC,+BAGD;;GAEC,MAAMyC,OAA2B,GAAG,IAAI,CAAClJ,mBAAmB,EAAE,CAACmJ,UAAU,EAAE;GAC3ED,OAAO,CAACrF,SAAS,CAAC,YAAY,EAAE,MAAY;KAC3CvG,6BAAY,CAACC,IAAI,CAAC,IAAI,CAACC,cAAc,EAAE,EAAE,kCAAkC,CAAC;IAC5E,CAAC;GAEF0L,OAAO,CAACrF,SAAS,CAAC,eAAe,EAAGI,KAA0C,IAAW;KACxF3G,6BAAY,CAACC,IAAI,CAAC,IAAI,CAACC,cAAc,EAAE,EAAE,kCAAkC,CAAC;KAC5E,MAAMgB,IAAoB,GAAGyF,KAAK,CAACuB,OAAO,EAAE,CAAChH,IAAI;KAEjD,IAAI,IAAI,CAACf,SAAS,EAAE,EACpB;OACC,IAAI,CAACA,SAAS,EAAE,CAACc,UAAU,CAACC,IAAI,CAAC;;IAElC,CAAC;CACH;CAAC,oCAMyByF,KAAgB,EAC1C;GACC,IAAI,CAACjE,mBAAmB,EAAE,CAACoJ,KAAK,EAAE;GAElC,MAAM,GAAGC,UAAU,CAAC,GAAGpF,KAAK,CAACuB,OAAO,EAAE;GACtC,MAAM+B,SAAiB,GAAG,IAAI,CAACvH,mBAAmB,EAAE,CAAC+F,WAAW,EAAE,CAACyB,kBAAkB,EAAE;GACvF,MAAM8B,SAAS,GACdD,UAAU,IAAIA,UAAU,CAAC9B,SAAS,CAAC,IAAI8B,UAAU,CAAC9B,SAAS,CAAC,CAAC,cAAc,CAAC,KAAK,WAAW,GACzF8B,UAAU,CAAC9B,SAAS,CAAC,GACrB,IACH;GAED,IAAI+B,SAAS,KAAK,IAAI,EACtB;;KAEC,IACCtC,cAAI,CAACuC,aAAa,CAACD,SAAS,CAAC,aAAa,CAAC,CAAC,IACzCtC,cAAI,CAACwC,cAAc,CAACF,SAAS,CAAC,aAAa,CAAC,CAAC,gBAAgB,CAAC,CAAC,EAEnE;OACC,IAAI,CAACtJ,mBAAmB,EAAE,CAACyJ,oBAAoB,CAAC,QAAQ,CAAC;OACzD,IAAI,CAACzJ,mBAAmB,EAAE,CAACkB,gBAAgB,CAACoI,SAAS,CAAC,aAAa,CAAC,CAAC,gBAAgB,CAAC,CAAC;MACvF,MAED;OACC,IAAI,CAACtJ,mBAAmB,EAAE,CAACyJ,oBAAoB,CAAC,MAAM,CAAC;;IAExD,MAED;;KAEC,IAAI,CAACzJ,mBAAmB,EAAE,CAACyJ,oBAAoB,CAAC,MAAM,CAAC;KACvD,IAAI,CAACzJ,mBAAmB,EAAE,CAACkB,gBAAgB,CAAC,MAAM,CAAC;;GAGpD,IAAIoI,SAAS,KAAK,IAAI,EACtB;KACC,OAAOlE,OAAO,CAACC,OAAO,EAAE;;;;;GAKzB,IAAI2B,cAAI,CAACI,OAAO,CAACkC,SAAS,CAAC,OAAO,CAAC,CAAC,EACpC;KACC,OAAO,4CAAI,wCAAmBI,QAAQ,EAAE,CAAC5D,IAAI,CAAC,MAAM;OACnDwD,SAAS,CAAC,OAAO,CAAC,CAACvK,OAAO,CAACd,IAAI,IAAI;SAClC,IAAI,CAAC,IAAI,CAAC+B,mBAAmB,EAAE,CAAC+F,WAAW,EAAE,CAAClB,OAAO,CAAC5G,IAAI,CAACiB,YAAY,CAAC,EACxE;WACC,IAAI,CAACc,mBAAmB,EAAE,CAAC+F,WAAW,EAAE,CAACC,OAAO,CAAC/H,IAAI,CAAC;;QAEvD,CAAC;OAEF,IAAI,IAAI,CAAC+B,mBAAmB,EAAE,CAAC+F,WAAW,EAAE,CAACjF,QAAQ,EAAE,CAAC6I,MAAM,GAAG,CAAC,EAClE;SACC,4CAAI,wCAAmBC,kBAAkB,EAAE;;MAE5C,CAAC;IACF,MACI,IAAI5C,cAAI,CAACC,aAAa,CAACqC,SAAS,CAAC,OAAO,CAAC,CAAC,EAC/C;KACC,OAAO,4CAAI,wCAAmBI,QAAQ,EAAE,CAAC5D,IAAI,CAAC,MAAe;OAC5D,OAAO,IAAIV,OAAO,CAAEC,OAAO,IAAW;SACrC,IAAIwE,OAAiB,GAAGP,SAAS,CAAC,OAAO,CAAC;SAC1CO,OAAO,GAAGA,OAAO,CAACC,MAAM,CAAEpM,EAAU,IAAK,CAAC,IAAI,CAACsC,mBAAmB,EAAE,CAAC+F,WAAW,EAAE,CAAClB,OAAO,CAACnH,EAAE,CAAC,CAAC;SAE/F,IAAIqM,MAAM,GAAG,CAAC;SACd,IAAIC,UAA0B,GAAG,EAAE;SACnC,MAAMC,MAAM,GAAG,MAAM;WACpBF,MAAM,EAAE;WACR,IAAIA,MAAM,KAAKC,UAAU,CAACL,MAAM,EAChC;aACCtE,OAAO,EAAE;;UAEV;SAED,MAAM3B,MAAM,GAAG;WACd,CAACuC,0BAAS,CAACG,aAAa,GAAG6D,MAAM;WACjC,CAAChE,0BAAS,CAACC,UAAU,GAAG+D;UACxB;SAED,MAAMC,WAAW,GAAGL,OAAO,CAACnC,GAAG,CAAEhK,EAAU,IAAK,CAACA,EAAE,EAAE;WAAEgG;UAAQ,CAAC,CAAC;SACjE,IAAIwG,WAAW,CAACP,MAAM,GAAG,CAAC,EAC1B;WACCK,UAAU,GAAG,IAAI,CAAChK,mBAAmB,EAAE,CAAC+F,WAAW,EAAE,CAACkD,QAAQ,CAACiB,WAAW,CAAC;WAC3E,IAAIF,UAAU,CAACL,MAAM,KAAK,CAAC,EAC3B;aACCtE,OAAO,EAAE;YACT,MAED;aACC,4CAAI,wCAAmBuE,kBAAkB,EAAE;;UAE5C,MAED;WACCvE,OAAO,EAAE;;QAEV,CAAC;MACF,CAAC;;GAGH,OAAOD,OAAO,CAACC,OAAO,EAAE;CACzB;CAAC,qCAGD;GACC,4CAAI,kDAAyB8E,aAAG,CAACC,MAAM,cAAC;mBACzB,CAAqC;;MAElD,CAAmD;;GAErD,GAJiB,4CAAI,0CAAoBxM,IAAI,CAAC,IAAI,CAAC,EAE/CyM,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC,CAEnD;GAEDhN,6BAAY,CAACC,IAAI,CAChB,IAAI,CAACC,cAAc,EAAE,EACrB,aAAa,EACb,CAAC;KAAE+M,IAAI,0CAAE,IAAI,+CAAsB;KAAEC,EAAE,EAAE;IAAiB,EAAE,MAAM,CAAC,CACnE;CACF;CAAC,+BAGD;GACC,MAAMjG,SAAsB,GAAG,4CAAI,gDAAuBC,OAAO,CAAC,2BAA2B,CAAC;GAC9F,IAAID,SAAS,IAAIA,SAAS,CAACkG,YAAY,CAAC,uBAAuB,CAAC,EAChE;KACC,IAAI,CAACzK,mBAAmB,EAAE,CAACsH,IAAI,EAAE;IACjC,MAED;KACC,IAAI,CAACtH,mBAAmB,EAAE,CAAC0K,iBAAiB,EAAE;;CAEhD;CAAC,qCAQ0BzG,KAAgB,EAC3C;GACC,MAAM0G,MAAe,GAAG1G,KAAK,CAACuB,OAAO,EAAE,CAACmF,MAAM;GAC9C,IAAIA,MAAM,EACV;KACC,IAAI,CAAC3G,gBAAgB,EAAE;IACvB,MAED;KACC,IAAI,CAACK,kBAAkB,EAAE;;CAE3B;CAAC,qCAE0BJ,KAAgB,EAC3C;GACC,MAAM0G,MAAe,GAAG1G,KAAK,CAACuB,OAAO,EAAE,CAACmF,MAAM;GAC9C,IAAIA,MAAM,EACV;KACC,IAAI,CAACrG,0BAA0B,EAAE;IACjC,MAED;KACC,IAAI,CAACI,4BAA4B,EAAE;;CAErC;;;;;AChkBD,CAUA,MAAMkG,SAAwC,GAAG,IAAIC,GAAG,EAAE;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE3D,CAAe,MAAMC,gBAAgB,SAASxN,6BAAY,CAC1D;GAaCN,WAAW,CAAC+N,eAAe,EAC3B;KACC,KAAK,EAAE;KAAC;OAAA;OAAA,OAdM;;KAAI;OAAA;OAAA,OACY;;KAAI;OAAA;OAAA,OACL;;KAAI;OAAA;OAAA,OAEA;;KAAI;OAAA;OAAA,OAEJ;;KAAI;OAAA;OAAA,OACE;;KAAI;OAAA;OAAA,OACJ;;KAAM;OAAA;OAAA,OAE3B;;KAKlB,IAAI,CAACxH,iBAAiB,CAAC,8BAA8B,CAAC;KAEtD,4CAAI,wCAAoBwH,eAAe;KACvC,4CAAI,wBAAYA,eAAe,CAAC7B,OAAO;KAEvC,MAAM5F,OAA+B,GACpC0D,cAAI,CAACuC,aAAa,CAACwB,eAAe,CAACC,aAAa,CAAC,GAAGD,eAAe,CAACC,aAAa,GAAG,EACpF;KAED,4CAAI,sDACHhE,cAAI,CAACwC,cAAc,CAAClG,OAAO,CAAC2H,sBAAsB,CAAC,GAAG3H,OAAO,CAAC2H,sBAAsB,GAAG,IACvF;KAED,4CAAI,sDACHjE,cAAI,CAACwC,cAAc,CAAClG,OAAO,CAAC4H,sBAAsB,CAAC,GAAG5H,OAAO,CAAC4H,sBAAsB,GAAG,IACvF;KAED,4CAAI,sBAAUrH,SAAS,CAAC,YAAY,EAAGI,KAA0C,IAAW;OAC3F,MAAMzF,IAAoB,GAAGyF,KAAK,CAACuB,OAAO,EAAE,CAAChH,IAAI;OAEjD,IAAI,CAACjB,IAAI,CAAC,YAAY,EAAE;SAAEiB;QAAM,CAAC;MACjC,CAAC;KAEF,4CAAI,sBAAUqF,SAAS,CAAC,iBAAiB,EAAGI,KAA0C,IAAW;OAChG,MAAMzF,IAAoB,GAAGyF,KAAK,CAACuB,OAAO,EAAE,CAAChH,IAAI;OACjD,IAAI,CAAC2M,eAAe,CAAC3M,IAAI,CAAC;OAE1B,IAAI,CAACjB,IAAI,CAAC,iBAAiB,EAAE;SAAEiB;QAAM,CAAC;MACtC,CAAC;KAEF,4CAAI,sBAAUqF,SAAS,CAAC,eAAe,EAAGI,KAA0C,IAAW;OAC9F,MAAMzF,IAAoB,GAAGyF,KAAK,CAACuB,OAAO,EAAE,CAAChH,IAAI;OACjD,IAAI,CAAC4M,4BAA4B,CAAC5M,IAAI,CAAC;OAEvC,IAAI,CAACjB,IAAI,CAAC,eAAe,EAAE;SAAEiB;QAAM,CAAC;MACpC,CAAC;KAEF,IAAI8E,OAAO,CAAC+H,gBAAgB,EAC5B;;OAECC,EAAE,CAACC,IAAI,CAACC,QAAQ,CAACC,KAAK,CAACC,QAAQ,CAACC,OAAO,EAAE;;KAG1C,IAAI,4CAAI,wDAA6B,IAAI,IAAI,IAAI,CAAC5F,WAAW,EAAE,CAAC6F,wBAAwB,EAAE,KAAK,IAAI,EACnG;OACC,4CAAI,8CAAuBzB,aAAG,CAACC,MAAM,oBAAC;;aAE9B,CAA+B;cAC9B,CAA8E;;;IAGvF,2CAJU,IAAI,qDACHpD,cAAI,CAACwC,cAAc,CAAClG,OAAO,CAACuI,aAAa,CAAC,GAAGvI,OAAO,CAACuI,aAAa,GAAG,MAAM,CAGrF;OAED,IAAI,CAACpC,oBAAoB,CAACnG,OAAO,CAACwI,iBAAiB,CAAC;OAEpDC,aAAG,CAACC,MAAM,yCAAC,IAAI,6CAAsB,IAAI,CAACjG,WAAW,EAAE,CAAC6F,wBAAwB,EAAE,CAAC;;KAGpF,IACC,IAAI,CAAC7F,WAAW,EAAE,CAAC6F,wBAAwB,EAAE,KAAK,IAAI,KAClD,4CAAI,wDAA6B,IAAI,IAAI,4CAAI,wDAA6B,IAAI,CAAC,EAEpF;;OAEC5G,OAAO,CAACiH,IAAI,CACX,qFAAqF,GACnF,kEAAkE,CACpE;;KAGF,IAAI,CAACxI,oBAAoB,CAACH,OAAO,CAACI,MAAM,CAAC;KAEzC,MAAMF,WAAyB,GAAGwD,cAAI,CAACkF,aAAa,CAAC5I,OAAO,CAACE,WAAW,CAAC,GAAGF,OAAO,CAACE,WAAW,GAAG,IAAI;KACtG,IAAIA,WAAW,EACf;OACC,4CAAI,kCAAiB,IAAIJ,YAAY,CACpC,IAAI,EACJ;SACCI,WAAW;SACXE,MAAM,EAAE;WACPyI,OAAO,EAAE,MAAY;aACpB,IAAI,CAACpG,WAAW,EAAE,CAACkD,QAAQ,CAAC3F,OAAO,CAACzC,KAAK,CAAC;aAC1C,IAAI,IAAI,CAACkF,WAAW,EAAE,CAACjF,QAAQ,EAAE,CAAC6I,MAAM,GAAG,CAAC,EAC5C;eACC,IAAI,CAACnD,iBAAiB,EAAE;eACxB,IAAI,CAACoD,kBAAkB,EAAE;;;;QAI5B,CACD;MACD,MAED;OACC,IAAI,CAAC7D,WAAW,EAAE,CAACkD,QAAQ,CAAC3F,OAAO,CAACzC,KAAK,CAAC;;KAG3C,4CAAI,cACHmG,cAAI,CAACwC,cAAc,CAAClG,OAAO,CAAC8I,cAAc,CAAC,GACxC9I,OAAO,CAAC8I,cAAc,GACrB,sBAAqB1J,cAAI,CAAC2J,SAAS,EAAE,CAACC,WAAW,EAAG,EACxD;KAED1B,SAAS,CAAC2B,GAAG,yCAAC,IAAI,aAAM,IAAI,CAAC;;GAG9B,OAAOC,OAAO,CAAC9O,EAAU,EACzB;KACC,OAAOkN,SAAS,CAAC6B,GAAG,CAAC/O,EAAE,CAAC,IAAI,IAAI;;GAGjC,OAAOgP,YAAY,GACnB;KACC,OAAO,CAAC,GAAG9B,SAAS,CAAChD,MAAM,EAAE,CAAC;;GAG/BhE,kBAAkB,GAClB;KACC,MAAM+I,QAAQ,GAAGC,mBAAS,CAACC,WAAW,CAAC,iCAAiC,CAAC;KACzE,MAAMjJ,kBAAkB,GAAG+I,QAAQ,CAACF,GAAG,CAAC,oBAAoB,EAAE,KAAK,CAAC;KAEpE,OAAO7I,kBAAkB,IAAI,4CAAI,sCAAkBoH,aAAa,CAACpH,kBAAkB,KAAK,KAAK;;GAG9FuF,UAAU,GACV;KACC,+CAAO,IAAI;;GAGZ2D,eAAe,GACf;KACC,+CAAO,IAAI;;GAGZ7M,QAAQ,GACR;KACC,OAAO,4CAAI,sBAAUA,QAAQ,EAAE;;GAGhCyI,OAAO,CAAChL,EAAE,EACV;KACC,OAAO,4CAAI,sBAAUgL,OAAO,CAAChL,EAAE,CAAC;;GAGjCoD,QAAQ,GACR;KACC,OAAO,4CAAI,sBAAUiF,WAAW,EAAE,CAACjF,QAAQ,EAAE;;GAG9C+D,OAAO,CAACnH,EAAU,EAClB;KACC,OAAO,4CAAI,sBAAUqI,WAAW,EAAE,CAAClB,OAAO,CAACnH,EAAE,CAAC;;GAG/CqI,WAAW,GACX;KACC,OAAO,4CAAI,sBAAUA,WAAW,EAAE;;GAGnC2D,QAAQ,GACR;KACC,OAAO,4CAAI,sCAAkBqD,SAAS,EAAE;;GAGzCzF,IAAI,GACJ;KACC,4CAAI,sCAAkB0F,kBAAkB,GAAG,QAAQ;KACnD,IAAI,CAACzP,IAAI,CAAC,uBAAuB,EAAE;OAAEoN,MAAM,EAAE;MAAO,CAAC;KACrD,IAAI,CAACpN,IAAI,CAAC,uBAAuB,EAAE;OAAEoN,MAAM,EAAE;MAAO,CAAC;;GAGtDnE,iBAAiB,GACjB;KACC,4CAAI,sCAAkBwG,kBAAkB,GAAG,UAAU;KACrD,IAAI,CAACzP,IAAI,CAAC,uBAAuB,EAAE;OAAEoN,MAAM,EAAE;MAAM,CAAC;KACpD,IAAI,CAACpN,IAAI,CAAC,uBAAuB,EAAE;OAAEoN,MAAM,EAAE;MAAO,CAAC;;GAGtDD,iBAAiB,GACjB;KACC,IAAI,CAAC,IAAI,CAAC9G,kBAAkB,EAAE,EAC9B;OACC;;KAGD,4CAAI,sCAAkBoJ,kBAAkB,GAAG,WAAW;KACtD,IAAI,CAACzP,IAAI,CAAC,uBAAuB,EAAE;OAAEoN,MAAM,EAAE;MAAO,CAAC;KACrD,IAAI,CAACpN,IAAI,CAAC,uBAAuB,EAAE;OAAEoN,MAAM,EAAE;MAAM,CAAC;;GAGrDvB,KAAK,GACL;KACC,IAAI,CAACrD,WAAW,EAAE,CAACmC,WAAW,CAAC;OAAE+E,gBAAgB,EAAE;MAAO,CAAC;;GAG5DrD,kBAAkB,GAClB;KACC,4CAAI,sCAAkBA,kBAAkB,EAAE;;GAG3CsD,oBAAoB,GACpB;KACC,OAAO,4CAAI,wDAA6B,IAAI,IAAI,IAAI,CAACnH,WAAW,EAAE,CAAC6F,wBAAwB,EAAE,KAAK,IAAI;;GAGvGuB,gBAAgB,CAAC3O,IAAoB,EACrC;KACC,OACC,IAAI,CAAC0O,oBAAoB,EAAE,IACxB1O,IAAI,CAAC2B,UAAU,CAACiN,UAAU,KAAK,IAAI,IACnC5O,IAAI,CAAC2B,UAAU,CAACkN,SAAS,KAAK,IAAI;;GAIvCC,yBAAyB,CAAC9O,IAAoB,EAC9C;KACC,MAAM+O,QAAQ,GAAI,eAAY,wCAAE,IAAI,mDAAyB,IAAG/O,IAAI,CAACU,YAAa,KAAI;KAEtF,IAAI,IAAI,CAAC6G,WAAW,EAAE,CAAC6F,wBAAwB,EAAE,KAAK,IAAI,EAC1D;OACC,OAAO,IAAI,CAAC7F,WAAW,EAAE,CAAC6F,wBAAwB,EAAE,CAAC4B,aAAa,CAACD,QAAQ,CAAC;;KAG7E,OAAO,IAAI;;GAGZnC,4BAA4B,CAAC5M,IAAoB,EACjD;KACC,MAAMiP,KAAuB,GAAG,IAAI,CAACH,yBAAyB,CAAC9O,IAAI,CAAC;KACpE,IAAIiP,KAAK,KAAK,IAAI,EAClB;OACC1B,aAAG,CAAC2B,MAAM,CAACD,KAAK,CAAC;;;GAInBtC,eAAe,CAAC3M,IAAoB,EAAEmP,SAAmB,GAAG,IAAI,EAChE;KACC,IAAI,CAAC,IAAI,CAACR,gBAAgB,CAAC3O,IAAI,CAAC,EAChC;OACC;;KAGD,IAAIiP,KAAuB,GAAG,IAAI,CAACH,yBAAyB,CAAC9O,IAAI,CAAC;KAClE,IAAIiP,KAAK,KAAK,IAAI,EAClB;OACCA,KAAK,GAAGtD,aAAG,CAACC,MAAM,kBAAC,gBAAa,CAA+B,IAAC,CAAoB,qBAAmB,2CAArE,IAAI,qDAA4B5L,IAAI,CAACU,YAAY,CAAqB;OACxG6M,aAAG,CAACC,MAAM,CAACyB,KAAK,EAAE,IAAI,CAAC1H,WAAW,EAAE,CAAC6F,wBAAwB,EAAE,CAAC;;KAGjE+B,SAAS,GAAGA,SAAS,KAAK,IAAI,GAAGnP,IAAI,CAAC2B,UAAU,CAACwN,SAAS,KAAK,IAAI,GAAGA,SAAS;KAC/EF,KAAK,CAACG,KAAK,GAAGD,SAAS,GAAG,CAAC,GAAG,CAAC;KAE/B,MAAM1P,IAAkB,GAAG,IAAI,CAAC4G,OAAO,CAACrG,IAAI,CAACd,EAAE,CAAC;KAChDO,IAAI,CAACsC,aAAa,CAAC,WAAW,EAAEoN,SAAS,CAAC;;GAG3CE,sBAAsB,GACtB;KACC,OAAO,4CAAI,gDAAyB,IAAI;;GAGzC3M,gBAAgB,CAAC4M,IAAY,EAC7B;KACC,IAAI9G,cAAI,CAACwC,cAAc,CAACsE,IAAI,CAAC,IAAI,4CAAI,gDAAyB,IAAI,EAClE;OACC,4CAAI,4CAAqBF,KAAK,GAAGE,IAAI;;;GAIvCC,gBAAgB,GAChB;KACC,OAAO,4CAAI,gDAAyB,IAAI,GAAG,4CAAI,4CAAqBH,KAAK,GAAG,EAAE;;GAG/EnE,oBAAoB,CAACuE,IAAuB,EAC5C;KACC,IAAIA,IAAI,KAAK,MAAM,IAAIA,IAAI,KAAK,QAAQ,EACxC;OACC,4CAAI,4CAAsBA,IAAI;;;GAIhC/M,oBAAoB,GACpB;KACC,+CAAO,IAAI;;GAGZgN,mBAAmB,GACnB;KACC,MAAMtB,QAAQ,GAAGC,mBAAS,CAACC,WAAW,CAAC,iCAAiC,CAAC;KACzE,MAAMqB,gBAAgB,GAAGvB,QAAQ,CAACF,GAAG,CAAC,kBAAkB,EAAE,EAAE,CAAC;KAC7D,IAAIzF,cAAI,CAACuC,aAAa,CAAC2E,gBAAgB,CAAC,EACxC;OACC,OAAOA,gBAAgB;;KAGxB,OAAO,EAAE;;GAGVC,yBAAyB,GACzB;KACC,IAAIC,kBAAkB,GAAG9C,EAAE,CAACC,IAAI,CAAC8C,kBAAkB,EAAE;KACrD,IAAI,CAACD,kBAAkB,IAAI9C,EAAE,CAACC,IAAI,CAAC+C,qBAAqB,EAAE,EAC1D;OACCF,kBAAkB,GAAG,YAAY;MACjC,MACI,IAAI,CAACA,kBAAkB,EAC5B;OACCA,kBAAkB,GAAG,GAAG;;KAGzB,OAAO,IAAI,CAACH,mBAAmB,EAAE,CAACG,kBAAkB,CAAC,IAAI,IAAI;;GAG9DG,iBAAiB,GACjB;KACC,MAAM5B,QAAQ,GAAGC,mBAAS,CAACC,WAAW,CAAC,iCAAiC,CAAC;KACzE,MAAM2B,cAAc,GAAG7B,QAAQ,CAACF,GAAG,CAAC,gBAAgB,EAAE,EAAE,CAAC;KACzD,IAAIzF,cAAI,CAACuC,aAAa,CAACiF,cAAc,CAAC,EACtC;OACC,OAAOA,cAAc;;KAGtB,OAAO,EAAE;;GAGVC,mBAAmB,GACnB;KACC,MAAM9B,QAAQ,GAAGC,mBAAS,CAACC,WAAW,CAAC,iCAAiC,CAAC;KAEzE,OAAOF,QAAQ,CAACF,GAAG,CAAC,cAAc,EAAE,IAAI,CAAC;;GAG1CiC,kBAAkB,GAClB;KACC,MAAM/B,QAAQ,GAAGC,mBAAS,CAACC,WAAW,CAAC,iCAAiC,CAAC;KAEzE,OAAOF,QAAQ,CAACF,GAAG,CAAC,iBAAiB,EAAE,EAAE,CAAC;;GAG3CkC,eAAe,GACf;KACC,MAAMhC,QAAQ,GAAGC,mBAAS,CAACC,WAAW,CAAC,iCAAiC,CAAC;KAEzE,OAAOF,QAAQ,CAACF,GAAG,CAAC,iBAAiB,EAAE,EAAE,CAAC;;CAE5C;;OCpXamC,kBAAkB,GAAG,CAACC,UAAU,EAAEC,MAA8B,GAAG,EAAE,KAAc;GAC/F,OAAO,IAAI1J,OAAO,CAAEC,OAAO,IAAW;KACrClI,iBAAO,CAAC4R,aAAa,CAAC,yBAAyB,CAAC,CAACjJ,IAAI,CAAC,MAAM;OAC3D,MAAMkJ,UAAU,GAAI/K,KAAgB,IAAW;SAC9C,MAAM,CAAC6J,IAAI,CAAC,GAAG7J,KAAK,CAACuB,OAAO,EAAE;SAC9B,IAAIqJ,UAAU,KAAKf,IAAI,EACvB;WACCxQ,6BAAY,CAAC2R,WAAW,CAAC3D,EAAE,CAAC4D,cAAc,EAAE,QAAQ,EAAEF,UAAU,CAAC;WACjE3J,OAAO,EAAE;;QAEV;OAED/H,6BAAY,CAACuG,SAAS,CAACyH,EAAE,CAAC4D,cAAc,EAAE,QAAQ,EAAEF,UAAU,CAAC;;;OAG/DG,cAAI,CAAC1C,GAAG,CAAC2C,gBAAgB,CAACP,UAAU,EAAEC,MAAM,CAAC,CAAC;MAC9C,CAAC;IACF,CAAC;CACH,CAAC;CAED,MAAMM,gBAAgB,GAAG,CAACP,UAAU,EAAEC,MAA8B,GAAG,EAAE,KAAa;GACrF,MAAMO,GAAG,GAAI,uDACZhF,aAAG,CAACC,UAAU,CAAC,SAAS,CAAE,+CAA8CuE,UAAW,EAAC;GAGrF,OAAOS,aAAG,CAACC,QAAQ,CAACF,GAAG,EAAEP,MAAM,CAAC;CACjC,CAAC;;;;;AC7BD,CAWoC;CAAA;CAAA;CAAA;CAAA;AAEpC,CAAe,MAAMU,QAAQ,CAC7B;GAMCxS,WAAW,CAACqG,gBAAkC,EAAE7E,IAAoB,EAAEiR,IAAU,EAChF;KAAA;OAAA;;KAAA;OAAA;OAAA,OANsC;;KAAI;OAAA;OAAA,OAClB;;KAAI;OAAA;OAAA,OACd;;KAAI;OAAA;OAAA,OACQ;;KAIzB,4CAAI,8CAAqBpM,gBAAgB;KACzC,4CAAI,kBAAS7E,IAAI;KACjB,4CAAI,kBAASiR,IAAI;KACjB,4CAAI,sCAAoB,iBAAgB/M,cAAI,CAAC2J,SAAS,CAAC,CAAC,CAAE,EAAC;;GAG5DqD,KAAK,GACL;KACC,4CAAI,gBAAOC,cAAc,EAAE,CAACC,WAAW,CAAC,GAAG,CAAC;KAE5C,IAAI,4CAAI,4CAAmBzC,gBAAgB,yCAAC,IAAI,gBAAO,EACvD;OACC,4CAAI,gBAAO0C,WAAW,CAAC;SAAEC,SAAS,EAAE;QAAM,CAAC;OAC3C,4CAAI,gBAAOD,WAAW,CAAC;SACtBnS,EAAE,EAAE,YAAY;SAChBqS,SAAS,EAAE,4CAAI,gBAAO5P,UAAU,CAACwN,SAAS,KAAK,IAAI,GAAG,8BAA8B,GAAG,EAAE;SACzFqC,IAAI,EAAE3F,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;SAC1D2F,OAAO,EAAE,CAAChM,KAAK,EAAEiM,QAAkB,KAAW;WAC7C,IAAI,4CAAI,gBAAO/P,UAAU,CAACwN,SAAS,KAAK,IAAI,EAC5C;aACC,4CAAI,4CAAmBxC,eAAe,yCAAC,IAAI,iBAAQ,KAAK,CAAC;YACzD,MAED;aACC,4CAAI,4CAAmBA,eAAe,yCAAC,IAAI,iBAAQ,IAAI,CAAC;;WAGzD+E,QAAQ,CAACC,aAAa,EAAE,CAACC,KAAK,EAAE;;QAEjC,CAAC;;KAGH,IAAI,4CAAI,gBAAOjQ,UAAU,CAACkQ,SAAS,EACnC;OACC,4CAAI,gBAAOR,WAAW,CAAC;SAAEC,SAAS,EAAE;QAAM,CAAC;OAE3C,4CAAI,gBAAOD,WAAW,CAAC;SACtBnS,EAAE,EAAE,QAAQ;SACZsS,IAAI,EAAE3F,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;SAC7D5G,MAAM,EAAE;WACP,gBAAgB,EAAGO,KAAgB,IAAW;aAC7C,MAAMqM,UAAoB,GAAGrM,KAAK,CAACsC,SAAS,EAAE;aAC9C,4CAAI,oCAAiB+J,UAAU;;UAEhC;SACDvQ,KAAK,EAAE,CAAC;WACPrC,EAAE,EAAE,iBAAiB;WACrBmL,IAAI,EAAE,oDAAoD;WAC1DkH,SAAS,EAAE;UACX;QACD,CAAC;;KAGH,IAAI/I,cAAI,CAACwC,cAAc,CAAC,4CAAI,gBAAOrJ,UAAU,CAACwH,OAAO,CAAC,EACtD;OACC,4CAAI,gBAAOkI,WAAW,CAAC;SACtBC,SAAS,EAAE;;QAEX,CAAC;;OAEF,IAAI,4CAAI,gBAAO3P,UAAU,CAACoQ,OAAO,EACjC;SACC,4CAAI,gBAAOV,WAAW,CAAC;WACtBnS,EAAE,EAAE,SAAS;WACbsS,IAAI,EAAG,GAAE,4CAAI,gBAAO7P,UAAU,CAACwH,OAAQ,QAAO;WAC9CsI,OAAO,EAAE,MAAY;aACpB,IAAI,CAACO,gBAAgB,EAAE;aACvB,4CAAI,gBAAOJ,KAAK,EAAE;YAClB;WACDK,QAAQ,EAAE,4CAAI,gBAAOtQ,UAAU,CAACuQ,YAAY,KAAK;UACjD,CAAC;QACF,MAED;SACC,4CAAI,gBAAOb,WAAW,CAAC;WACtBnS,EAAE,EAAE,SAAS;WACbsS,IAAI,EAAE,4CAAI,gBAAO7P,UAAU,CAACwH,OAAO;WACnC8I,QAAQ,EAAE;UACV,CAAC;;;;GAKLE,MAAM,CAACC,OAAe,EACtB;KACC,OAAO,IAAIxL,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAW;OAC7C6J,cAAI,CAAC0B,SAAS,CAAC,+BAA+B,EAAE;SAC/C1M,IAAI,EAAE;WACLtE,QAAQ,EAAE,4CAAI,gBAAOM,UAAU,CAACN,QAAQ;WACxC+Q,OAAO;WACPE,WAAW,EAAE,IAAI;WACjBC,kBAAkB,EAAE;;QAErB,CAAC,CACAjL,IAAI,CAAEkL,QAAQ,IAAW;SAAA;SACzB,IAAI,CAAAA,QAAQ,oBAARA,QAAQ,CAAE7J,MAAM,MAAK,SAAS,IAAI,CAAA6J,QAAQ,sCAARA,QAAQ,CAAE7M,IAAI,8CAAd,eAAgB8M,MAAM,qBAAtB,sBAAwBnD,IAAI,MAAK,4CAAI,gBAAOA,IAAI,EACtF;WACC,MAAM7P,IAAkB,GAAG,4CAAI,4CAAmB4G,OAAO,CAAC,4CAAI,gBAAOnH,EAAE,CAAC;WACxE,MAAMoQ,IAAI,GAAGkD,QAAQ,CAAC7M,IAAI,CAAC8M,MAAM,CAACnD,IAAI;WACtC7P,IAAI,CAACiT,OAAO,CAACpD,IAAI,CAAC;;SAEnBzI,OAAO,EAAE;QACT,CAAC,CACDoB,KAAK,CAAEuK,QAAQ,IAAW;SAC1B1F,EAAE,CAACC,IAAI,CAAC4F,yBAAyB,CAACH,QAAQ,CAAC;SAC3C1L,MAAM,EAAE;QACR,CAAC;MACH,CAAC;;GA8EHkL,gBAAgB,GAChB;KACC5B,kBAAkB,yCAAC,IAAI,qCAAkB;OAAEwC,IAAI,EAAE;MAAY,CAAC,CAACtL,IAAI,CAAC,MAAY;OAC/EwF,EAAE,CAAC4D,cAAc,CAACmC,UAAU,yCAAC,IAAI,oCAAiB,GAAG;SACpDC,UAAU,EAAE,CAACvJ,GAAG,EAAEC,IAAI,EAAEuJ,aAAa,EAAEC,YAAY,KAAW;WAC7D,MAAMC,YAAY,GAAG7S,MAAM,CAACgJ,MAAM,CAAC2J,aAAa,CAAC,CAAC,CAAC,CAAC,IAAIC,YAAY;WACpE,IAAI,CAACC,YAAY,EACjB;aACC;;WAGD,MAAMC,QAAQ,GAAGD,YAAY,CAAC/T,EAAE,KAAK,MAAM,GAAGqK,GAAG,CAAC4J,YAAY,GAAGF,YAAY,CAAC/T,EAAE;WAEhFyR,cAAI,CAAC0B,SAAS,CAAC,6BAA6B,EAAE;aAC7C1M,IAAI,EAAE;eACLtE,QAAQ,EAAE,4CAAI,gBAAOM,UAAU,CAACN,QAAQ;eACxC+R,UAAU,EAAEF;;YAEb,CAAC,CACA5L,IAAI,CAAEkL,QAAQ,IAAW;aACzB,IAAI,CAAAA,QAAQ,oBAARA,QAAQ,CAAE7J,MAAM,MAAK,SAAS,EAClC;eACC,MAAMlJ,IAAkB,GAAG,4CAAI,4CAAmB4G,OAAO,CAAC,4CAAI,gBAAOnH,EAAE,CAAC;eACxE,MAAMoQ,IAAI,GAAGkD,QAAQ,CAAC7M,IAAI,CAAC8M,MAAM,CAACnD,IAAI;eACtC,MAAMpQ,EAAE,GAAGsT,QAAQ,CAAC7M,IAAI,CAAC8M,MAAM,CAACvT,EAAE;eAElCO,IAAI,CAAC4T,eAAe,CAAE,IAAGnU,EAAG,EAAC,CAAC;eAC9BO,IAAI,CAACiT,OAAO,CAACpD,IAAI,CAAC;eAElB,IAAI2D,YAAY,CAAC/T,EAAE,KAAK,MAAM,EAC9B;iBACCO,IAAI,CAACsC,aAAa,CAAC,SAAS,EAAG,GAAEwH,GAAG,CAAC+F,IAAK,KAAI,CAAC;gBAC/C,MAED;iBACC7P,IAAI,CAACsC,aAAa,CAAC,SAAS,EAAG,GAAEwH,GAAG,CAAC+F,IAAK,MAAK2D,YAAY,CAAC3D,IAAK,EAAC,CAAC;;;YAGrE,CAAC,CACDrH,KAAK,CAAEuK,QAAQ,IAAW;aAC1B1F,EAAE,CAACC,IAAI,CAAC4F,yBAAyB,CAACH,QAAQ,CAAC;YAC3C,CAAC;;QAEJ;OAED,IAAI1F,EAAE,CAAC4D,cAAc,CAAC4C,WAAW,KAAK,IAAI,EAC1C;SACCxG,EAAE,CAAC4D,cAAc,CAAC6C,UAAU,yCAAC,IAAI,oCAAiB;;MAEnD,CAAC,CACAtL,KAAK,CAAC,MAAM;;MAEZ,CAAC;;CAEL;CAAC,0BAjIgB6J,UAAoB,EACpC;GACCnT,iBAAO,CAAC4R,aAAa,CAAC,YAAY,CAAC,CAACjJ,IAAI,CAAEkM,OAAO,IAAW;KAC3D,MAAMC,MAAqB,GAAGD,OAAO,CAACC,MAAM;KAC5C,MAAMC,UAA6B,GAAGF,OAAO,CAACE,UAAU;KACxD,MAAMC,WAA+B,GAAGH,OAAO,CAACG,WAAW;KAC3D,MAAMC,YAAiC,GAAGJ,OAAO,CAACI,YAAY;KAE9D,MAAMC,aAAa,GAAIpO,KAAoB,IAAW;OACrD,IAAIA,KAAK,CAACqO,IAAI,KAAK,OAAO,EAC1B;SACCC,iBAAiB,EAAE;;MAEpB;KAED,MAAMC,oBAAoB,GAAGC,4CAA2B,CAAC,4CAAI,gBAAO3E,IAAI,CAAC;KACzE,MAAMyE,iBAAiB,GAAG,MAAY;OACrC,MAAMG,aAAqB,GAAGC,QAAQ,CAAC/E,KAAK,CAACgF,IAAI,EAAE;OACnD,IAAI,CAAC5L,cAAI,CAACwC,cAAc,CAACkJ,aAAa,CAAC,IAAIA,aAAa,KAAKF,oBAAoB,EACjF;SACClC,UAAU,CAACH,aAAa,EAAE,CAACC,KAAK,EAAE;SAElC;;OAGDyC,SAAS,CAACC,UAAU,CAAC,IAAI,CAAC;OAC1B,MAAMC,WAAW,GAAI,GAAEL,aAAc,IAAGM,iCAAgB,CAAC,4CAAI,gBAAOlF,IAAI,CAAE,EAAC;OAC3E,IAAI,CAAC6C,MAAM,CAACoC,WAAW,CAAC,CACtBjN,IAAI,CAAC,MAAY;SACjB+M,SAAS,CAACC,UAAU,CAAC,KAAK,CAAC;SAC3BxC,UAAU,CAACH,aAAa,EAAE,CAACC,KAAK,EAAE;QAClC,CAAC,CACD3J,KAAK,CAAC,MAAY;SAClBoM,SAAS,CAACC,UAAU,CAAC,KAAK,CAAC;QAC3B,CAAC;MAEH;KACD,MAAMH,QAA6B,GAAGxI,aAAG,CAACC,MAAM,oBAAC;;;kBAGpC,CAAgB;OAC3B,CAAoC;IACtC,GAFeiI,aAAa,EACxB3P,cAAI,CAACC,MAAM,CAAC6P,oBAAoB,CAAC,CACpC;KAED,MAAMK,SAAiB,GAAG,IAAIZ,MAAM,CAAC;OACpCjC,IAAI,EAAE3F,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;OAC/D2I,KAAK,EAAEd,WAAW,CAACe,OAAO;OAC1BC,IAAI,EAAEjB,UAAU,CAACkB,KAAK;OACtBnD,OAAO,EAAEsC;MACT,CAAC;KAEF,MAAMc,SAAuB,GAAG,IAAIjB,YAAY,CAAC;OAChDe,IAAI,EAAEjB,UAAU,CAACkB,KAAK;OACtBnD,OAAO,EAAE,MAAY;SACpBK,UAAU,CAACH,aAAa,EAAE,CAACC,KAAK,EAAE;;MAEnC,CAAC;KAEF,MAAMkD,OAAa,GAAGhD,UAAU,CAACiD,UAAU,EAAE;KAC7C,MAAMC,YAAsB,GAAGF,OAAO,CAACG,WAAW,CAAC,iBAAiB,CAAC;KAErED,YAAY,CAACE,OAAO,CACnBvJ,aAAG,CAACC,MAAM,sBAAC;;QAET,CAAW;oDACiC,CAA2C;;KAEzF,GAHIuI,QAAQ,EACoC,CAACE,SAAS,CAACzI,MAAM,EAAE,EAAEiJ,SAAS,CAACjJ,MAAM,EAAE,CAAC,GAGxF,IAAI,CACJ;KAEDkG,UAAU,CAACqD,WAAW,EAAE;IACxB,CAAC;CACH;;CC5M2C;CAAA;CAAA;AAI5C,CAAe,MAAMC,YAAY,CACjC;GAIC5W,WAAW,CAACqG,gBAAkC,EAC9C;KAAA;OAAA;;KAAA;OAAA;OAAA,OAJsC;;KAAI;OAAA;OAAA,OAC5B;;KAIb,4CAAI,8CAAqBA,gBAAgB;;GAG1CwQ,OAAO,CAACC,MAAM,EACd;KACC,IAAI,4CAAI,wBAAW,IAAI,EACvB;OACC,+CAAO,IAAI;;KAGZ,4CAAI,sBAAS,IAAIC,eAAI,CAAC;OACrBC,WAAW,EAAEF,MAAM,CAACG,YAAY,EAAE;OAClClE,SAAS,EAAE,gCAAgC;OAC3CmE,KAAK,EAAE,IAAI;OACXC,QAAQ,EAAE,IAAI;OACdC,UAAU,EAAE,EAAE;OACdC,SAAS,EAAE,KAAK;OAChBtU,KAAK,0CAAE,IAAI,yBAAY;OACvB2D,MAAM,EAAE;SACP4Q,MAAM,EAAE,MAAY;WACnBR,MAAM,CAACS,MAAM,EAAE;UACf;SACDC,SAAS,EAAE,MAAY;WACtBV,MAAM,CAACW,QAAQ,EAAE;WACjB,4CAAI,sBAAS,IAAI;;;MAGnB,CAAC;KAEF,+CAAO,IAAI;;GA6BZC,IAAI,CAACZ,MAAM,EACX;KACC,IAAI,CAACD,OAAO,CAACC,MAAM,CAAC,CAACY,IAAI,EAAE;;GAG5BC,MAAM,CAACb,MAAM,EACb;KACC,IAAI,4CAAI,wBAAW,IAAI,IAAI,4CAAI,oBAAOnE,cAAc,EAAE,CAACiF,OAAO,EAAE,EAChE;OACC,4CAAI,oBAAOxE,KAAK,EAAE;MAClB,MAED;OACC,IAAI,CAACsE,IAAI,CAACZ,MAAM,CAAC;;;GAInBxM,IAAI,GACJ;KACC,IAAI,4CAAI,wBAAW,IAAI,EACvB;OACC,4CAAI,oBAAO8I,KAAK,EAAE;;;GAIpByE,QAAQ,GACR;KACC,OAAO,4CAAI,0BAAalL,MAAM,GAAG,CAAC;;CAEpC;CAAC,sBAtDA;GACC,IAAI,CAAC,4CAAI,4CAAmBkE,sBAAsB,EAAE,EACpD;KACC,OAAO,EAAE;;GAGV,OAAO,CAAC;KACPkC,SAAS,EAAE,4CAAI,4CAAmBhC,gBAAgB,EAAE,KAAK,MAAM,GAAG,8BAA8B,GAAG,EAAE;KACrGiC,IAAI,EAAE3F,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;KAC1D2F,OAAO,EAAE,CAAChM,KAAK,EAAEiM,QAAkB,KAAW;OAC7C,4CAAI,4CAAmBzG,oBAAoB,CAAC,QAAQ,CAAC;OACrD,IAAI,4CAAI,4CAAmBsE,gBAAgB,EAAE,KAAK,MAAM,EACxD;SACC,4CAAI,4CAAmB7M,gBAAgB,CAAC,SAAS,CAAC;QAClD,MAED;SACC,4CAAI,4CAAmBA,gBAAgB,CAAC,MAAM,CAAC;;OAGhDgP,QAAQ,CAACC,aAAa,EAAE,CAACC,KAAK,EAAE;;IAEjC,CAAC;CACH;;CC/DD,MAAM0E,cAA2B,GAAG,IAAIpU,GAAG,EAAE;AAE7C,OAAaqU,kBAAkB,GAAIzR,OAAO,IAAW;GAEpDA,OAAO,GAAG0D,cAAI,CAACuC,aAAa,CAACjG,OAAO,CAAC,GAAGA,OAAO,GAAG,EAAE;GACpD,MAAM0R,QAAgB,GAAGhO,cAAI,CAACwC,cAAc,CAAClG,OAAO,CAAC0R,QAAQ,CAAC,GAAG1R,OAAO,CAAC0R,QAAQ,GAAI,eAActS,cAAI,CAAC2J,SAAS,CAAC,CAAC,CAAE,EAAC;GACtH,MAAMpC,MAAiB,GAAGjD,cAAI,CAACiO,UAAU,CAAC3R,OAAO,CAAC2G,MAAM,CAAC,GAAG3G,OAAO,CAAC2G,MAAM,GAAG,IAAI;GACjF,MAAMiL,QAAmB,GAAGlO,cAAI,CAACiO,UAAU,CAAC3R,OAAO,CAAC4R,QAAQ,CAAC,GAAG5R,OAAO,CAAC4R,QAAQ,GAAG,IAAI;GACvF,MAAMC,OAAkB,GAAGnO,cAAI,CAACiO,UAAU,CAAC3R,OAAO,CAAC6R,OAAO,CAAC,GAAG7R,OAAO,CAAC6R,OAAO,GAAG,IAAI;GACpF,MAAM9M,QAAmB,GAAG/E,OAAO,CAAC+E,QAAQ,YAAY+M,yBAAQ,GAAG9R,OAAO,CAAC+E,QAAQ,GAAG,IAAI;GAE1F,IAAIyM,cAAc,CAAC/T,GAAG,CAACiU,QAAQ,CAAC,EAChC;KACC;;GAGDF,cAAc,CAACnU,GAAG,CAACqU,QAAQ,CAAC;GAE5BpG,kBAAkB,CAACoG,QAAQ,CAAC,CAAClP,IAAI,CAAC,MAAY;KAC7CgP,cAAc,CAACO,MAAM,CAACL,QAAQ,CAAC;KAC/B,IAAI/K,MAAM,KAAK,IAAI,EACnB;OACCA,MAAM,EAAE;;KAGTqB,EAAE,CAAC4D,cAAc,CAACmC,UAAU,CAAC2D,QAAQ,CAAC,GAAG;OACxC1D,UAAU,EAAE,CAACvJ,GAAG,EAAEC,IAAI,EAAEuJ,aAAa,KAAW;SAC/C3S,MAAM,CAACgJ,MAAM,CAAC2J,aAAa,CAAC,CAACxS,OAAO,CAACP,IAAI,IAAI;WAC5C,IAAI6J,QAAQ,KAAK,IAAI,EACrB;aACCA,QAAQ,CAACrC,OAAO,CAACxH,IAAI,CAACd,EAAE,EAAE;eAAEoQ,IAAI,EAAEtP,IAAI,CAACsP,IAAI;eAAEwH,OAAO,EAAE;cAAM,CAAC;;UAE9D,CAAC;SAEF,IAAIJ,QAAQ,KAAK,IAAI,EACrB;WACCA,QAAQ,CAACnN,GAAG,EAAEC,IAAI,EAAEuJ,aAAa,CAAC;;QAEnC;OACDgE,YAAY,EAAE,MAAY;SACzBT,cAAc,CAACO,MAAM,CAACL,QAAQ,CAAC;SAC/B,IAAIG,OAAO,KAAK,IAAI,EACpB;WACCA,OAAO,EAAE;;;MAGX;KAED,IAAI7J,EAAE,CAAC4D,cAAc,CAAC4C,WAAW,KAAK,IAAI,EAC1C;OACCxG,EAAE,CAAC4D,cAAc,CAAC6C,UAAU,CAACiD,QAAQ,CAAC;;IAEvC,CAAC;CACH,CAAC;;CCxDc,MAAMQ,mBAAmB,SAASC,uCAAsB,CACvE;GACCzY,WAAW,CAAC0Y,MAAc,EAAEpS,OAAO,GAAG,EAAE,EACxC;KACC,KAAK,CAACoS,MAAM,EAAEpS,OAAO,CAAC;;GAGvBqS,IAAI,CAAC1X,IAAkB,EACvB;KACC,IAAI,CAACV,IAAI,CAAC,YAAY,EAAE;OAAEqY,QAAQ,EAAE;MAAK,CAAC;KAC1C,IAAI,CAACrY,IAAI,CAAC,QAAQ,CAAC;;GAGpBsY,KAAK,GACL;CAGD;;CCnBiG;CAAA;AAEjG,CAAe,MAAMC,qBAAqB,SAASC,yCAAwB,CAC3E;GAIC/Y,WAAW,CAAC0Y,MAAc,EAAEpS,OAAO,GAAG,EAAE,EACxC;KACC,KAAK,CAACoS,MAAM,EAAEpS,OAAO,CAAC;KAAC;OAAA;OAAA,OALN;;KAAI;OAAA;OAAA,OACD;;KAMpB,4CAAI,sBAAWA,OAAO,CAACjC,MAAM;KAC7B,4CAAI,4BAAciC,OAAO,CAAC0S,SAAS;;GAGpCC,MAAM,CAAChY,IAAkB,EACzB;KACCqN,EAAE,CAACC,IAAI,CAAC2K,cAAc,CAACC,SAAS,CAAC;OAChClY,IAAI,EAAE;SACLP,EAAE,0CAAE,IAAI,mBAAQ;SAChB0Y,OAAO,0CAAE,IAAI;QACb;OACDC,QAAQ,EAAGC,OAAO,IAAW;SAC5B,IAAI,CAAC/Y,IAAI,CAAC,UAAU,EAAE;WAAEgZ,QAAQ,EAAED,OAAO,CAACC;UAAS,CAAC;QACpD;OACDC,UAAU,EAAGZ,QAAQ,IAAW;SAC/B,IAAI,CAACrY,IAAI,CAAC,YAAY,EAAE;WAAEqY,QAAQ,EAAEA;UAAU,CAAC;QAC/C;OACDa,OAAO,EAAGC,MAAM,IAAW;SAC1B,IAAI,CAACnZ,IAAI,CAAC,SAAS,EAAE;WAAE0H,KAAK,EAAE6D,8BAAa,CAAC6N,oBAAoB,CAACD,MAAM;UAAG,CAAC;;MAE5E,CAAC;;GAGHb,KAAK,GACL;CAGD;;CC/BA,MAAMf,gBAA2B,GAAG,IAAIpU,GAAG,EAAE;AAE7C,OAAakW,mBAAmB,GAAItT,OAAO,IAAW;GACrDA,OAAO,GAAG0D,cAAI,CAACuC,aAAa,CAACjG,OAAO,CAAC,GAAGA,OAAO,GAAG,EAAE;GACpD,MAAM0R,QAAgB,GAAGhO,cAAI,CAACwC,cAAc,CAAClG,OAAO,CAAC0R,QAAQ,CAAC,GAAG1R,OAAO,CAAC0R,QAAQ,GAAI,gBAAetS,cAAI,CAAC2J,SAAS,CAAC,CAAC,CAAE,EAAC;GACvH,MAAM2J,SAAiB,GAAGhP,cAAI,CAACwC,cAAc,CAAClG,OAAO,CAAC0S,SAAS,CAAC,GAAG1S,OAAO,CAAC0S,SAAS,GAAG,QAAQ;GAC/F,MAAM/L,MAAiB,GAAGjD,cAAI,CAACiO,UAAU,CAAC3R,OAAO,CAAC2G,MAAM,CAAC,GAAG3G,OAAO,CAAC2G,MAAM,GAAG,IAAI;GACjF,MAAMiL,QAAmB,GAAGlO,cAAI,CAACiO,UAAU,CAAC3R,OAAO,CAAC4R,QAAQ,CAAC,GAAG5R,OAAO,CAAC4R,QAAQ,GAAG,IAAI;GACvF,MAAMC,OAAkB,GAAGnO,cAAI,CAACiO,UAAU,CAAC3R,OAAO,CAAC6R,OAAO,CAAC,GAAG7R,OAAO,CAAC6R,OAAO,GAAG,IAAI;GACpF,MAAM9M,QAAmB,GAAG/E,OAAO,CAAC+E,QAAQ,YAAY+M,yBAAQ,GAAG9R,OAAO,CAAC+E,QAAQ,GAAG,IAAI;GAE1F,IAAIyM,gBAAc,CAAC/T,GAAG,CAACiU,QAAQ,CAAC,EAChC;KACC;;GAGDF,gBAAc,CAACnU,GAAG,CAACqU,QAAQ,CAAC;GAE5BpG,kBAAkB,CAACoG,QAAQ,EAAE;KAAEoB,OAAO,EAAEJ,SAAS;KAAEa,WAAW,EAAE;IAAG,CAAC,CAAC/Q,IAAI,CAAC,MAAY;KACrFgP,gBAAc,CAACO,MAAM,CAACL,QAAQ,CAAC;KAC/B,IAAI/K,MAAM,KAAK,IAAI,EACnB;OACCA,MAAM,EAAE;;KAGTqB,EAAE,CAAC4D,cAAc,CAACmC,UAAU,CAAC2D,QAAQ,CAAC,GAAG;OACxC1D,UAAU,EAAE,CAACvJ,GAAG,EAAEC,IAAI,EAAEuJ,aAAa,KAAW;SAC/CpU,iBAAO,CAAC4R,aAAa,CAAC,6BAA6B,CAAC,CAACjJ,IAAI,CAAC,MAAY;WACrElH,MAAM,CAACgJ,MAAM,CAAC2J,aAAa,CAAC,CAACxS,OAAO,CAAEP,IAAI,IAAK;aAC9C,IAAIA,IAAI,CAACsY,IAAI,KAAK,MAAM,IAAIzO,QAAQ,KAAK,IAAI,EAC7C;eACCA,QAAQ,CAACrC,OAAO,CAAC;iBAChBtI,EAAE,EAAEc,IAAI,CAACd,EAAE;iBACXwB,YAAY,EAAEV,IAAI,CAACd,EAAE;iBACrBoQ,IAAI,EAAEtP,IAAI,CAACsP,IAAI;iBACfqF,IAAI,EAAEzQ,cAAI,CAACqU,QAAQ,CAACvY,IAAI,CAACwY,OAAO,CAAC;iBACjCC,cAAc,EAAE,IAAIzB,mBAAmB,CACtCnN,QAAQ,CAAC6O,SAAS,EAAE,EACpB;mBAAE7V,MAAM,EAAE7C,IAAI,CAACd,EAAE;mBAAEsY,SAAS,EAAExX,IAAI,CAAC2Y;kBAAU,CAC7C;iBACDC,gBAAgB,EAAE,IAAItB,qBAAqB,CAC1CzN,QAAQ,CAAC6O,SAAS,EAAE,EACpB;mBAAE7V,MAAM,EAAE7C,IAAI,CAACd,EAAE;mBAAEsY,SAAS,EAAExX,IAAI,CAAC2Y;kBAAU;gBAE9C,CAAC;;YAEH,CAAC;WAEF,IAAIjC,QAAQ,KAAK,IAAI,EACrB;aACCA,QAAQ,CAACnN,GAAG,EAAEC,IAAI,EAAEuJ,aAAa,CAAC;;UAEnC,CAAC;QACF;OACDgE,YAAY,EAAE,MAAY;SACzBT,gBAAc,CAACO,MAAM,CAACL,QAAQ,CAAC;SAC/B,IAAIG,OAAO,KAAK,IAAI,EACpB;WACCA,OAAO,EAAE;;;MAGX;KAED,IAAIa,SAAS,KAAK,QAAQ,EAC1B;OACCqB,cAAI,CAAC;SACJhI,GAAG,EAAE,mDAAmD;SACxDiI,QAAQ,EAAE,MAAM;SAChBC,SAAS,CAACpT,IAAI,EACd;WACC,IAAIA,IAAI,CAACqT,OAAO,EAChB;aACCC,aAAa,CAACtT,IAAI,CAACqT,OAAO,EAAElU,OAAO,CAAC;aAEpC;;WAGDoU,gBAAgB,CAACvT,IAAI,EAAE6Q,QAAQ,CAAC,CAAClP,IAAI,CAAE6R,MAAM,IAAK;aACjDA,MAAM,CAACC,iBAAiB,EAAE;YAC1B,CAAC,CAACnR,KAAK,CAAExB,KAAK,IAAK;aACnBD,OAAO,CAACC,KAAK,CAACA,KAAK,CAAC;YACpB,CAAC;UACF;SACD4S,SAAS,CAAC1T,IAAI,EACd;WACCmH,EAAE,CAAC4D,cAAc,CAAC4I,WAAW,GAAG,KAAK;;QAEtC,CAAC;OAEF;;KAGD,IAAIxM,EAAE,CAAC4D,cAAc,CAAC4C,WAAW,KAAK,IAAI,EAC1C;OACCxG,EAAE,CAAC4D,cAAc,CAAC6C,UAAU,CAACiD,QAAQ,CAAC;;IAEvC,CAAC;CACH,CAAC;CAED,MAAMyC,aAAa,GAAG,UAASD,OAAe,EAAEO,aAAkB,EAAQ;GACzEzM,EAAE,CAAC0M,IAAI,CAACC,KAAK,CAACT,OAAO,EAAE,IAAI,EAAE,GAAG,CAAC;GACjC1T,eAAK,CAAClG,IAAI,CAACsa,MAAM,EAAE,YAAY,EAAE,MAAM;KACtC,MAAMC,OAAO,GAAGC,QAAQ,CAACC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,qBAAqB,CAAC;KACnE,IAAI,CAACJ,OAAO,EACZ;OACC;;KAED7M,EAAE,CAAC4D,cAAc,CAAC4I,WAAW,GAAG,KAAK;KACrClB,mBAAmB,CAACmB,aAAa,CAAC;IAClC,CAAC;CACH,CAAC;CAED,MAAML,gBAAgB,GAAG,gBAAevT,IAAS,EAAE6Q,QAAgB,EAAW;GAC7E,OAAO7X,iBAAO,CAAC4R,aAAa,CAAC,0BAA0B,CAAC,CAACjJ,IAAI,CAAC,CAAC;KAAE0S;IAAmB,KAAK;KACxF,OAAO,IAAIA,iBAAiB,CAC3BrU,IAAI,CAACsU,QAAQ,EACbtU,IAAI,CAACuU,KAAK,EACVvU,IAAI,CAACwU,MAAM,EACXxU,IAAI,CAACyU,WAAW,EAChBtN,EAAE,CAAC4D,cAAc,CAACmC,UAAU,CAAC2D,QAAQ,CAAC,CACtC;IACD,CAAC;CACH,CAAC;;CC7HM,MAAM6D,MAA+B,GAAG;GAC9C/K,IAAI,EAAE,QAAQ;GACdgL,KAAK,EAAE;KACN3F,IAAI,EAAE;OACL2D,IAAI,EAAEiC,MAAM;OACZC,OAAO,EAAE;MACT;KACD/F,KAAK,EAAE;OACN6D,IAAI,EAAEmC,MAAM;OACZD,OAAO,EAAE;MACT;KACDE,MAAM,EAAE;OACPpC,IAAI,EAAElY,MAAM;OACZoa,OAAO,EAAE;MACT;KACDhL,IAAI,EAAE;OACL8I,IAAI,EAAEmC,MAAM;OACZD,OAAO,EAAE;;IAEV;GACDG,OAAO,GACP;KACC,IAAI,CAACC,MAAM,GAAG,IAAI;IAClB;GACDC,OAAO,GACP;KACClc,iBAAO,CAAC4R,aAAa,CAAC,aAAa,CAAC,CAACjJ,IAAI,CAAEkM,OAAO,IAAW;OAC5D,MAAM;SAAE6G;QAAQ,GAAG7G,OAAO;OAC1B,IAAI,CAACoH,MAAM,GAAG,IAAIP,MAAM,CAAC;SACxBS,MAAM,EAAE,IAAI,CAACC,KAAK,CAAChV,SAAS;SAC5B4O,IAAI,EAAE,IAAI,CAACA,IAAI;SACfF,KAAK,EAAE,IAAI,CAACA,KAAK;SACjBiG,MAAM,EAAE,IAAI,CAACA,MAAM;SACnBlL,IAAI,EAAE,IAAI,CAACA;QACX,CAAC;OAEF,IAAI,CAACoL,MAAM,CAAC1E,IAAI,EAAE;MAClB,CAAC;IACF;GACD8E,aAAa,GACb;KACC,IAAI,IAAI,CAACJ,MAAM,EACf;OACC,IAAI,CAACA,MAAM,CAACK,OAAO,EAAE;OACrB,IAAI,CAACL,MAAM,GAAG,IAAI;;IAEnB;GACDM,QAAQ,EAAE;CACX,CAAC;;CC1CM,MAAMC,YAAY,GAAG;GAC3B7L,IAAI,EAAE,cAAc;GACpB8L,MAAM,EAAE,CAAC,kBAAkB,EAAE,UAAU,EAAE,YAAY,CAAC;GACtDC,UAAU,EAAE;KACXhB;IACA;GACD1U,IAAI,EAAE,OAAO;KACZ2V,gBAAgB,EAAE,KAAK;KACvBC,qBAAqB,EAAE,KAAK;KAC5BC,gBAAgB,EAAE;IAClB,CAAC;GACFb,OAAO,GACP;KACC,IAAI,CAACc,YAAY,GAAI,eAAcvX,cAAI,CAAC2J,SAAS,CAAC,CAAC,CAAE,EAAC;KACtD,IAAI,CAAC6N,aAAa,GAAI,gBAAexX,cAAI,CAAC2J,SAAS,CAAC,CAAC,CAAE,EAAC;KACxD,IAAI,CAAC8N,cAAc,GAAG,IAAI,CAAC9W,gBAAgB,CAACkL,iBAAiB,EAAE;KAC/D,IAAI,CAACE,mBAAmB,GAAG,IAAI,CAACpL,gBAAgB,CAACoL,mBAAmB,EAAE;KACtE,IAAI,CAAC2L,eAAe,GAAG,IAAI,CAAC/W,gBAAgB,CAACqL,kBAAkB,EAAE;IACjE;GACD2K,OAAO,GACP;KACC,IAAI,CAAChR,QAAQ,CAACgS,YAAY,CAAC,IAAI,CAACd,KAAK,CAACtD,MAAM,CAAC;IAC7C;GACDqE,OAAO,EAAE;KACRvF,kBAAkB,GAClB;OACC,IAAI,IAAI,CAAC+E,gBAAgB,EACzB;SACC;;OAGD,IAAI,CAACA,gBAAgB,GAAG,IAAI;OAE5B/E,kBAAkB,CAAC;SAClBC,QAAQ,EAAE,IAAI,CAACiF,YAAY;SAC3B5R,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvB4B,MAAM,EAAE,MAAY;WACnB,IAAI,CAAC6P,gBAAgB,GAAG,KAAK;UAC7B;SACD3E,OAAO,EAAE,MAAY;WACpB,IAAI,CAAC2E,gBAAgB,GAAG,KAAK;;QAE9B,CAAC;MACF;KAEDlD,mBAAmB,CAACZ,SAAS,EAC7B;OACC,IAAI,CAAC,IAAI,CAACvH,mBAAmB,EAC7B;SACC8L,sCAAwB,CAACC,WAAW,CAAC;WAAEC,SAAS,EAAE,IAAI,CAACL;UAAiB,CAAC,CAAC1F,IAAI,EAAE;SAEhF;;OAGD,IAAI,IAAI,CAACqF,qBAAqB,EAC9B;SACC;;OAGD,IAAI,CAACC,gBAAgB,GAAGhE,SAAS;OACjC,IAAI,CAAC+D,qBAAqB,GAAG,IAAI;OAEjC,MAAMW,QAAQ,GAAG,MAAY;SAC5B,IAAI,CAACX,qBAAqB,GAAG,KAAK;SAClC,IAAI,CAACC,gBAAgB,GAAG,IAAI;QAC5B;OAEDpD,mBAAmB,CAAC;SACnB5B,QAAQ,EAAE,IAAI,CAACkF,aAAa;SAC5B7R,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvB2N,SAAS;SACT/L,MAAM,EAAEyQ,QAAQ;SAChBvF,OAAO,EAAEuF;QACT,CAAC;;IAEH;;GAEDhB,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAoEZ,CAAC;;;;;AC3JD,CAOO,MAAMiB,aAAsC,GAAG;GACrD7M,IAAI,EAAE,eAAe;GACrB8L,MAAM,EAAE,CAAC,UAAU,EAAE,kBAAkB,EAAE,YAAY,CAAC;GACtDd,KAAK,EAAE;KACNta,IAAI,EAAE;OACLsY,IAAI,EAAElY,MAAM;OACZoa,OAAO,EAAE;;IAEV;GACD7U,IAAI,GACJ;KACC,OAAO;OACNwK,eAAe,EAAE,IAAI,CAACtL,gBAAgB,CAACsL,eAAe;MACtD;IACD;GACDwK,OAAO,GACP;KACC,IAAI,CAAC1J,IAAI,GAAG,IAAI;KAChB,IAAI,CAACmL,kBAAkB,GAAG,IAAI;IAC9B;GACDvB,OAAO,GACP;KACC,MAAMwB,SAAiB,GAAGxQ,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC,IAAI,EAAE;KACnF,MAAMwQ,MAAM,GAAG,QAAQ;KACvB,MAAMC,QAAgB,GAAGF,SAAS,CAACG,OAAO,CAACF,MAAM,CAAC;KAClD,IAAIC,QAAQ,KAAK,CAAC,CAAC,EACnB;OAAA;OACC,MAAME,OAAe,GAAGJ,SAAS,CAACK,SAAS,CAAC,CAAC,EAAEH,QAAQ,CAAC;OACxD,MAAMI,QAAgB,GAAGN,SAAS,CAACK,SAAS,CAACH,QAAQ,GAAGD,MAAM,CAACnR,MAAM,CAAC;OAEtE,IAAI,CAACiR,kBAAkB,GAAGzQ,aAAG,CAACC,MAAM,oBAAC;6DACmB,CAEtD;IACF,4BAFE,IAAI,CAAC/G,gBAAgB,CAAC8K,yBAAyB,EAAE,qBAAjD,sBAAmDL,IAAI,CAExD;OAED,MAAMsN,KAAK,GAAGjR,aAAG,CAACC,MAAM,sBAAC;;aAEjB,CAAU;OAChB,CAA0B;aACpB,CAAW;;IAEnB,GAJU6Q,OAAO,EACb,IAAI,CAACL,kBAAkB,EACjBO,QAAQ,CAEjB;OAEDpP,aAAG,CAACC,MAAM,CAACoP,KAAK,EAAE,IAAI,CAAC7B,KAAK,CAAC,mBAAmB,CAAC,CAAC;;IAEnD;GACDe,OAAO,EAAE;KACRe,cAAc,CAACC,YAAoB,EACnC;;OAEC,IAAI,CAAChQ,EAAE,CAACC,IAAI,CAAC8C,kBAAkB,EAAE,IAAI/C,EAAE,CAACC,IAAI,CAAC+C,qBAAqB,EAAE,EACpE;SACChD,EAAE,CAACC,IAAI,CAACgQ,mBAAmB,CAAC,YAAY,CAAC;QACzC,MACI,IAAI,CAACjQ,EAAE,CAACC,IAAI,CAAC8C,kBAAkB,EAAE,EACtC;SACC/C,EAAE,CAACC,IAAI,CAACgQ,mBAAmB,CAAC,GAAG,CAAC;;OAGjC,IAAIC,MAAM,GAAG,IAAI;OACjB,IAAIF,YAAY,KAAK,OAAO,EAC5B;SACCE,MAAM,GAAGtD,MAAM,CAACuD,IAAI,CAAC,EAAE,EAAE,QAAQ,CAAC;;OAGnC,IAAInQ,EAAE,CAACC,IAAI,CAACC,QAAQ,CAACC,KAAK,CAACC,QAAQ,CAACgQ,uBAAuB,EAAE,IAAIJ,YAAY,KAAK,OAAO,EACzF;SACChQ,EAAE,CAACC,IAAI,CAACC,QAAQ,CAACC,KAAK,CAACC,QAAQ,CAACiQ,UAAU,CAAC;WAAE7E,IAAI,EAAEwE;UAAc,CAAC,CAACxV,IAAI,CAAEkL,QAAQ,IAAW;WAC3F,IAAIA,QAAQ,CAAC7J,MAAM,KAAK,SAAS,EACjC;aACC,IAAI,CAACkB,QAAQ,CAACrC,OAAO,CACnB,IAAGgL,QAAQ,CAACC,MAAM,CAACvT,EAAG,EAAC,EACxB;eACCoQ,IAAI,EAAEkD,QAAQ,CAACC,MAAM,CAACnD,IAAI;eAC1BwH,OAAO,EAAE;cACT,CACD;aAED,IAAI,CAACjS,gBAAgB,CAACmD,iBAAiB,EAAE;aAEzC,IAAIgV,MAAM,KAAK,IAAI,IAAIxK,QAAQ,CAAC4K,OAAO,EACvC;eACCJ,MAAM,CAACnD,QAAQ,CAACwD,IAAI,GAAG7K,QAAQ,CAAC4K,OAAO;;;UAGzC,CAAC;QACF,MAED;SACC,MAAME,aAAa,GAAG,IAAIxQ,EAAE,CAACC,IAAI,CAACC,QAAQ,CAACuQ,aAAa,CAAC;WACxDC,QAAQ,EAAEV,YAAY;WACtBW,WAAW,EAAE3Q,EAAE,CAACC,IAAI,CAAC8C,kBAAkB,EAAE;WACzC6N,WAAW,EAAE,CAAClL,QAAQ,EAAEmL,QAAQ,KAAW;aAC1C,IAAInL,QAAQ,CAAC7J,MAAM,KAAK,SAAS,EACjC;eACC;;aAGD,IAAI6J,QAAQ,CAACC,MAAM,EACnB;eACC,IAAI,CAAC5I,QAAQ,CAACrC,OAAO,CACnB,IAAGgL,QAAQ,CAACC,MAAM,CAACvT,EAAG,EAAC,EACxB;iBACCoQ,IAAI,EAAEkD,QAAQ,CAACC,MAAM,CAACnD,IAAI;iBAC1BqF,IAAI,EAAEnC,QAAQ,CAACC,MAAM,CAACkC,IAAI;iBAC1BmC,OAAO,EAAE;gBACT,CACD;eAED,IAAI,CAACjS,gBAAgB,CAACmD,iBAAiB,EAAE;;;UAG3C,CAAC;SAEFsV,aAAa,CAACM,KAAK,EAAE;;MAEtB;KAEDC,QAAQ,GACR;OACC,IAAI,IAAI,CAAC5M,IAAI,KAAK,IAAI,EACtB;SACC,IAAI,CAACA,IAAI,CAACgK,OAAO,EAAE;SAEnB;;OAGD,IAAI,CAAChK,IAAI,GAAG,IAAIsE,eAAI,CAAC;SACpBC,WAAW,EAAE,IAAI,CAAC4G,kBAAkB;SACpC7K,SAAS,EAAE,gCAAgC;SAC3CmE,KAAK,EAAE,IAAI;SACXC,QAAQ,EAAE,IAAI;SACdmI,SAAS,EAAE,CAAC;SACZjI,SAAS,EAAE,KAAK;SAChBtU,KAAK,EAAE,IAAI,CAACwc,YAAY,EAAE;SAC1B7Y,MAAM,EAAE;WACP8Q,SAAS,EAAE,MAAY;aACtB,IAAI,CAAC/E,IAAI,GAAG,IAAI;;;QAGlB,CAAC;OAEF,IAAI,CAACA,IAAI,CAACiF,IAAI,EAAE;MAChB;KAED6H,YAAY,GACZ;OAAA;OACC,MAAMxc,KAAK,GAAG,EAAE;OAChB,MAAMqO,kBAAkB,6BAAG,IAAI,CAAC/K,gBAAgB,CAAC8K,yBAAyB,EAAE,qBAAjD,uBAAmDmE,IAAI;OAClF,MAAMkK,QAA+C,GAAG5d,MAAM,CAACgJ,MAAM,CACpE,IAAI,CAACvE,gBAAgB,CAAC4K,mBAAmB,EAAE,CAC3C;OAEDuO,QAAQ,CAACzd,OAAO,CAAEqX,OAAuC,IAAW;SACnErW,KAAK,CAAC0c,IAAI,CAAC;WACVzM,IAAI,EAAEoG,OAAO,CAACtI,IAAI;WAClBiC,SAAS,EAAE3B,kBAAkB,KAAKgI,OAAO,CAAC9D,IAAI,GAAG,8BAA8B,GAAG,2BAA2B;WAC7GrC,OAAO,EAAE,CAAChM,KAAK,EAAEzF,IAAc,KAAW;aACzC8M,EAAE,CAACC,IAAI,CAACgQ,mBAAmB,CAACnF,OAAO,CAAC9D,IAAI,CAAC;aACzC,IAAI,CAACsI,kBAAkB,CAAC8B,WAAW,GAAGtG,OAAO,CAACtI,IAAI;aAClD,IAAI,CAAC2B,IAAI,CAACW,KAAK,EAAE;;UAElB,CAAC;QACF,CAAC;OAEF,OAAOrQ,KAAK;;IAEb;;GAED2Z,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAmCZ,CAAC;;CChMD;CACA;CACA;AACA,OAAaiD,wBAAiD,GAAG;GAChE7O,IAAI,EAAE,iBAAiB;GACvB8O,OAAO,EAAEC,oCAAoB;GAC7BhD,UAAU,EAAE;0BACXiD,0CAAmB;KACnBnC;IACA;GACDoC,KAAK,GACL;KACC,OAAO;OACNC,qBAAqB,EAAEC,eAAe,CAACC,yBAAyB;MAChE;IACD;GACDpE,KAAK,EAAE;KACNqE,UAAU,EAAE;OACXrG,IAAI,EAAEmC,MAAM;OACZD,OAAO,CAACoE,QAAQ,EAAU;SACzB,MAAMC,mBAAmB,GAAGrW,cAAI,CAACkF,aAAa,CAACkR,QAAQ,CAACpS,aAAa,CAACxH,WAAW,CAAC;SAElF,OAAO6Z,mBAAmB,GAAG,QAAQ,GAAG,MAAM;;;IAGhD;GACDlZ,IAAI,GACJ;KACC,OAAO;OACNmZ,kBAAkB,EAAE,IAAI,CAACH,UAAU,KAAK,MAAM;OAC9CnQ,kBAAkB,EAAE;MACpB;IACD;GACDuQ,OAAO,GACP;KACC,OAAO;OACNla,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;OACvCyB,QAAQ,EAAE,IAAI,CAACzB,gBAAgB,CAACyJ,eAAe,EAAE;OACjDxC,UAAU,EAAE,IAAI,CAACA;MACjB;IACD;GACDkT,YAAY,GACZ;KACC,IAAI,CAACna,gBAAgB,GAAG,IAAIyH,gBAAgB,CAAC,IAAI,CAAC;IAClD;GACDwP,OAAO,EAAE;KACRhQ,UAAU,CAACgI,IAAY,EAAEmL,YAAqC,EAC9D;OACC,OAAOpT,aAAG,CAACC,UAAU,CAACgI,IAAI,EAAEmL,YAAY,CAAC;MACzC;KAED7T,kBAAkB,GAClB;OACC,IAAI,CAAC2P,KAAK,CAACmE,UAAU,CAAC9T,kBAAkB,EAAE;MAC1C;KAED+T,kBAAkB,GAClB;OACC,OAAOV,eAAe,CAACW,sBAAsB,CAAC,IAAI,CAACC,eAAe,CAAC;MACnE;KACD7d,mBAAmB,GACnB;OACC,OAAO,IAAI,CAACqD,gBAAgB;;IAE7B;GACDya,QAAQ,EAAE;KACTC,iBAAiB,GAAsB;OACtC,MAAM/S,aAAqC,GAAG,IAAI,CAACA,aAAa;OAChE,MAAM+S,iBAAoC,GACzC/W,cAAI,CAACuC,aAAa,CAACyB,aAAa,CAAC+S,iBAAiB,CAAC,GAChD;SAAE,GAAG/S,aAAa,CAAC+S;QAAmB,GACtC,EACH;OAEDA,iBAAiB,CAACC,KAAK,GAAGhX,cAAI,CAACuC,aAAa,CAACwU,iBAAiB,CAACC,KAAK,CAAC,GAAGD,iBAAiB,CAACC,KAAK,GAAG,EAAE;OACpGD,iBAAiB,CAACC,KAAK,CAACC,qCAAc,CAACC,eAAe,CAAC,GAAGvE,YAAY;OACtEoE,iBAAiB,CAACnZ,cAAc,GAC/BoC,cAAI,CAACmX,SAAS,CAACnT,aAAa,CAACpG,cAAc,CAAC,GACzCoG,aAAa,CAACpG,cAAc,GAC5B,IAAI,CAACvB,gBAAgB,CAACyJ,eAAe,EAAE,KAAK,IAC/C;OAEDiR,iBAAiB,CAACK,kBAAkB,GAAG,IAAI;OAE3CL,iBAAiB,CAACra,MAAM,GAAGqa,iBAAiB,CAACra,MAAM,IAAI,EAAE;OACzDqa,iBAAiB,CAACra,MAAM,CAAC,uBAAuB,CAAC,GAAIO,KAAgB,IAAW;SAC/E,MAAM;WAAEzF,IAAI;WAAEiR;UAA4C,GAAGxL,KAAK,CAACuB,OAAO,EAAE;SAC5E,MAAM6Y,QAAkB,GAAG,IAAI7O,QAAQ,CAAC,IAAI,CAACnM,gBAAgB,EAAE7E,IAAI,EAAEiR,IAAI,CAAC;SAC1E4O,QAAQ,CAAC3O,KAAK,EAAE;QAChB;OAED,IAAI,IAAI,CAACrM,gBAAgB,CAACyJ,eAAe,EAAE,KAAK,IAAI,EACpD;SACCiR,iBAAiB,CAACra,MAAM,CAAC4a,gBAAgB,GAAIra,KAAgB,IAAW;WACvE,MAAM;aAAEzF;YAAgC,GAAGyF,KAAK,CAACuB,OAAO,EAAE;WAC1D,IAAI,CAACnC,gBAAgB,CAACyJ,eAAe,EAAE,CAAClI,cAAc,CAACpG,IAAI,CAAC;UAC5D;SAEDuf,iBAAiB,CAACQ,cAAc,GAAG,KAAK;;OAGzC,MAAMC,YAA0B,GAAG,IAAI5K,YAAY,CAAC,IAAI,CAACvQ,gBAAgB,CAAC;OAC1E,IAAImb,YAAY,CAAC3J,QAAQ,EAAE,EAC3B;SACCkJ,iBAAiB,CAACU,kBAAkB,GAAG,IAAI;SAC3CV,iBAAiB,CAACra,MAAM,CAAC,wBAAwB,CAAC,GAAIO,KAAgB,IAAW;WAChF,MAAM;aAAE6P;YAAQ,GAAG7P,KAAK,CAACuB,OAAO,EAAE;WAClCgZ,YAAY,CAAC7J,MAAM,CAACb,MAAM,CAAC;UAC3B;;OAGF,OAAOiK,iBAAiB;MACxB;KACDW,4BAA4B,GAC5B;OACC,OACC,IAAI,CAACrb,gBAAgB,CAACO,kBAAkB,EAAE,IACvC,IAAI,CAAC0Z,kBAAkB,IACvB,IAAI,CAACqB,eAAe,KAAK,MAAM;MAEnC;KACDC,mBAAmB,GACnB;OACC,OACC,IAAI,CAACvb,gBAAgB,CAACO,kBAAkB,EAAE,KAEzC,IAAI,CAAC+a,eAAe,KAAK,WAAW,IAChC,IAAI,CAACA,eAAe,KAAK,MAAM,IAAI,CAAC,IAAI,CAACrB,kBAAmB,CAChE;MAEF;KACDqB,eAAe,GACf;OACC,IAAI,IAAI,CAAC3R,kBAAkB,KAAK,IAAI,EACpC;SACC,OAAO,IAAI,CAACA,kBAAkB;;OAG/B,OAAO,IAAI,CAACmQ,UAAU;;IAEvB;;GAEDzD,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAmCZ,CAAC;;CC7LD;CACA;CACA;AACA,CAAe,MAAMuD,eAAe,SAAS4B,iCAAiB,CAC9D;GACC7hB,WAAW,CAAC6gB,eAAgC,EAAEva,OAA+B,EAC7E;KACC,MAAM0H,aAAqC,GAAGhE,cAAI,CAACuC,aAAa,CAACjG,OAAO,CAAC,GAAG;OAAE,GAAGA;MAAS,GAAG,EAAE;KAC/F,KAAK,CAAC2Z,eAAe,CAACW,sBAAsB,CAACC,eAAe,CAAC,EAAE7S,aAAa,CAAC;;GAG9E8T,eAAe,GACf;KACC,OAAOnC,wBAAwB;;GAGhC,OAAOiB,sBAAsB,CAACC,eAAgC,EAC9D;KACC,OAAO;OACN,GAAGZ,eAAe,CAACC,yBAAyB,EAAE;OAC9C,IAAIlW,cAAI,CAACuC,aAAa,CAACsU,eAAe,CAAC,GAAGA,eAAe,GAAG,EAAE;MAC9D;;GAGF,OAAOX,yBAAyB,GAChC;KACC,OAAO;OACN6B,UAAU,EAAE,4CAA4C;OACxDC,QAAQ,EAAE,IAAI;OACdC,WAAW,EAAE;MACb;;CAEH;;;;;;;;;;;;;"}