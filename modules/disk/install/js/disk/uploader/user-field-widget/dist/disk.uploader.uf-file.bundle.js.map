{"version":3,"file":"disk.uploader.uf-file.bundle.js","sources":["../src/integration/html-parser.js","../src/integration/main-post-form.js","../src/user-field-control.js","../src/helpers/load-disk-file-dialog.js","../src/item-menu.js","../src/settings-menu.js","../src/helpers/open-disk-file-dialog.js","../src/helpers/cloud-load-controller.js","../src/helpers/cloud-upload-controller.js","../src/helpers/open-cloud-file-dialog.js","../src/components/loader.js","../src/components/control-panel.js","../src/components/document-panel.js","../src/components/insert-into-text-button.js","../src/user-field-widget-component.js","../src/user-field-widget.js"],"sourcesContent":["import { Text, Runtime } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport type { TileWidgetItem } from 'ui.uploader.tile-widget';\nimport type MainPostForm from './main-post-form';\n\nexport default class HtmlParser\n{\n\t#form: MainPostForm = null;\n\t#parserId = 'diskfile0';\n\t#tag: string = '[DISK FILE ID=#id#]';\n\t#regexp: RegExp = /\\[(?:DOCUMENT ID|DISK FILE ID)=(n?[0-9]+)\\]/ig;\n\tsyncHighlightsDebounced: Function = null;\n\n\tconstructor(form: MainPostForm)\n\t{\n\t\tthis.#form = form;\n\n\t\tthis.syncHighlightsDebounced = Runtime.debounce(this.syncHighlights, 500, this);\n\n\t\t// BBCode Parser Registration ([DISK FILE ID=190])\n\t\tEventEmitter.emit(this.#form.getEventObject(), 'OnParserRegister', this.getParser());\n\t}\n\n\tgetParser(): Object<string, any>\n\t{\n\t\treturn {\n\t\t\tid: this.#parserId,\n\t\t\tinit: this.#init.bind(this),\n\t\t\tparse: this.#parse.bind(this),\n\t\t\tunparse: this.#unparse.bind(this),\n\t\t};\n\t}\n\n\t/**\n\t *\n\t * @returns {Window.BXEditor}\n\t */\n\tgetHtmlEditor()\n\t{\n\t\treturn this.#form.getHtmlEditor();\n\t}\n\n\tinsertFile(item: TileWidgetItem): void\n\t{\n\t\tconst bbDelimiter: string = item.isImage ? '\\n' : ' ';\n\t\tconst htmlDelimiter: string = item.isImage ? '<br>' : '&nbsp;';\n\n\t\tEventEmitter.emit(this.getHtmlEditor(), 'OnInsertContent', [\n\t\t\tbbDelimiter + this.createItemBBCode(item) + bbDelimiter,\n\t\t\thtmlDelimiter + this.createItemHtml(item) + htmlDelimiter,\n\t\t]);\n\n\t\tthis.syncHighlights();\n\t}\n\n\tremoveFile(item: TileWidgetItem): void\n\t{\n\t\tif (this.getHtmlEditor().GetViewMode() === 'wysiwyg')\n\t\t{\n\t\t\tconst doc = this.getHtmlEditor().GetIframeDoc();\n\t\t\tObject.keys(this.getHtmlEditor().bxTags).forEach((tagId: string) => {\n\t\t\t\tconst tag = this.getHtmlEditor().bxTags[tagId];\n\t\t\t\tif (tag.tag === this.#parserId && tag.serverFileId === item.serverFileId)\n\t\t\t\t{\n\t\t\t\t\tconst node = doc.getElementById(tagId);\n\t\t\t\t\tif (node)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.getHtmlEditor().SaveContent();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst content = this.getHtmlEditor().GetContent().replace(\n\t\t\t\tthis.#regexp,\n\t\t\t\t(str, foundId): string => {\n\t\t\t\t\tconst { objectId, attachedId } = this.#getIds(foundId);\n\t\t\t\t\tconst items: TileWidgetItem[] = this.#form.getUserFieldControl().getItems();\n\t\t\t\t\tconst item: TileWidgetItem = items.find((item: TileWidgetItem) => {\n\t\t\t\t\t\treturn item.serverFileId === attachedId || item.customData.objectId === objectId;\n\t\t\t\t\t});\n\n\t\t\t\t\treturn item ? '' : str;\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tthis.getHtmlEditor().SetContent(content);\n\t\t\tthis.getHtmlEditor().Focus();\n\t\t}\n\n\t\tthis.syncHighlights();\n\t}\n\n\tselectItem(item: TileWidgetItem): void\n\t{\n\t\titem.tileWidgetData.selected = true;\n\t}\n\n\tdeselectItem(item: TileWidgetItem): void\n\t{\n\t\titem.tileWidgetData.selected = false;\n\t}\n\n\tsyncHighlights(): void\n\t{\n\t\tconst doc = this.getHtmlEditor().GetIframeDoc();\n\t\tconst inserted: Set<number | string> = new Set();\n\t\tObject.keys(this.getHtmlEditor().bxTags).forEach((tagId: string): void => {\n\t\t\tconst tag = this.getHtmlEditor().bxTags[tagId];\n\t\t\tif (tag.tag === this.#parserId && doc.getElementById(tagId))\n\t\t\t{\n\t\t\t\tinserted.add(tag.serverFileId);\n\t\t\t}\n\t\t});\n\n\t\tlet hasInsertedItems = false;\n\n\t\tconst items: TileWidgetItem[] = this.#form.getUserFieldControl().getItems();\n\t\titems.forEach((item: TileWidgetItem): void => {\n\t\t\tif (inserted.has(item.serverFileId))\n\t\t\t{\n\t\t\t\thasInsertedItems = true;\n\t\t\t\tthis.selectItem(item);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.deselectItem(item);\n\t\t\t}\n\t\t});\n\n\t\tif (this.#form.getUserFieldControl().getPhotoTemplateMode() === 'auto')\n\t\t{\n\t\t\tthis.#form.getUserFieldControl().setPhotoTemplate(hasInsertedItems ? 'gallery' : 'grid');\n\t\t}\n\t}\n\n\tcreateItemHtml(item: TileWidgetItem, id: string): string\n\t{\n\t\tconst tagId = this.getHtmlEditor().SetBxTag(false, {\n\t\t\ttag: this.#parserId,\n\t\t\tserverFileId: item.serverFileId,\n\t\t\thideContextMenu: true,\n\t\t\tfileId: item.serverFileId,\n\t\t});\n\n\t\tif (item.isImage)\n\t\t{\n\t\t\tconst imageSrc = this.getHtmlEditor().bbCode ? item.previewUrl : item.serverPreviewUrl;\n\t\t\tconst previewWidth = this.getHtmlEditor().bbCode ? item.previewWidth : item.serverPreviewWidth;\n\t\t\tconst previewHeight = this.getHtmlEditor().bbCode ? item.previewHeight : item.serverPreviewHeight;\n\n\t\t\tconst renderWidth = 600; // half size of imagePreviewWidth\n\t\t\tconst renderHeight = 600; // half size of imagePreviewHeight\n\t\t\tconst ratioWidth: number = renderWidth / previewWidth;\n\t\t\tconst ratioHeight: number = renderHeight / previewHeight;\n\t\t\tconst ratio: number = Math.min(ratioWidth, ratioHeight);\n\n\t\t\tconst useOriginalSize = ratio > 1; // image is too small\n\t\t\tconst width = useOriginalSize ? previewWidth : previewWidth * ratio;\n\t\t\tconst height = useOriginalSize ? previewHeight : previewHeight * ratio;\n\n\t\t\treturn `<img style=\"max-width: 90%;\" width=\"${width}\" height=\"${height}\" data-bx-file-id=\"${Text.encode(item.serverFileId)}\" id=\"${tagId}\" src=\"${imageSrc}\" title=\"${Text.encode(item.name)}\" data-bx-paste-check=\"Y\" />`;\n\t\t}\n\t\telse if (item.customData.fileType === 'player')\n\t\t{\n\t\t\treturn `<img contenteditable=\"false\" class=\"bxhtmled-player-surrogate\" data-bx-file-id=\"${Text.encode(item.serverFileId)}\" id=\"${tagId}\" src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-bx-paste-check=\"Y\" />`;\n\t\t}\n\n\t\treturn `<span contenteditable=\"false\" data-bx-file-id=\"${Text.encode(item.serverFileId)}\" id=\"${tagId}\" style=\"color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;\">${Text.encode(item.name)}</span>`;\n\t}\n\n\tcreateItemBBCode(item: TileWidgetItem): string\n\t{\n\t\treturn this.#tag.replace('#id#', item.serverFileId);\n\t}\n\n\t#init(htmlEditor): void\n\t{\n\t\t// stub\n\t}\n\n\t#parse(content): string\n\t{\n\t\tif (!this.#regexp.test(content))\n\t\t{\n\t\t\treturn content;\n\t\t}\n\n\t\tthis.syncHighlightsDebounced();\n\n\t\treturn content.replace(\n\t\t\tthis.#regexp,\n\t\t\t(str, id): string => {\n\t\t\t\tconst { objectId, attachedId } = this.#getIds(id);\n\n\t\t\t\tconst items: TileWidgetItem[] = this.#form.getUserFieldControl().getItems();\n\t\t\t\tconst item: TileWidgetItem = items.find((item: TileWidgetItem) => {\n\t\t\t\t\treturn item.serverFileId === attachedId || item.customData.objectId === objectId;\n\t\t\t\t});\n\n\t\t\t\tif (item)\n\t\t\t\t{\n\t\t\t\t\tthis.selectItem(item);\n\n\t\t\t\t\treturn this.createItemHtml(item, id);\n\t\t\t\t}\n\n\t\t\t\treturn str;\n\t\t\t}\n\t\t);\n\t}\n\n\t#unparse(bxTag): string\n\t{\n\t\tconst { serverFileId } = bxTag;\n\n\t\tconst items: TileWidgetItem[] = this.#form.getUserFieldControl().getItems();\n\t\tconst item: TileWidgetItem = items.find((item: TileWidgetItem): boolean => {\n\t\t\treturn item.serverFileId === serverFileId;\n\t\t});\n\n\t\tif (item)\n\t\t{\n\t\t\treturn this.createItemBBCode(item);\n\t\t}\n\n\t\treturn '';\n\t}\n\n\t#getIds(id: string): { objectId: ?number, attachedId: ?number}\n\t{\n\t\tlet objectId: ?number = null;\n\t\tlet attachedId: ?number = null;\n\t\tif (id[0] === 'n')\n\t\t{\n\t\t\tobjectId = Text.toInteger(id.replace('n', ''));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tattachedId = Text.toInteger(id);\n\t\t}\n\n\t\treturn { objectId, attachedId };\n\t}\n}\n","import { Type, Event, Reflection, Loc, Tag } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { FileEvent, UploaderFile, UploaderError, getFilesFromDataTransfer, isFilePasted } from 'ui.uploader.core';\n\nimport HtmlParser from './html-parser';\n\nimport type { TileWidgetItem } from 'ui.uploader.tile-widget';\nimport type { VueUploaderAdapter } from 'ui.uploader.vue';\nimport type UserFieldControl from '../user-field-control';\n\nexport default class MainPostForm extends EventEmitter\n{\n\t#userFieldControl: UserFieldControl = null;\n\t#createDocumentButton: HTMLElement = null;\n\t#eventObject: HTMLElement = null;\n\t#htmlParser: HtmlParser = null;\n\t#htmlEditor = null;\n\t#inited = false;\n\n\tconstructor(userFieldControl: UserFieldControl, options: Object<string, any>)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Disk.Uploader.Integration');\n\n\t\tthis.#userFieldControl = userFieldControl;\n\t\tthis.#eventObject = options.eventObject;\n\n\t\tthis.#bindEventObject();\n\n\t\tthis.subscribeFromOptions(options.events);\n\n\t\tthis.subscribeOnce('onReady', (): void => {\n\t\t\tif (this.#userFieldControl.canCreateDocuments())\n\t\t\t{\n\t\t\t\tthis.#addCreateDocumentButton();\n\t\t\t}\n\t\t});\n\n\t\tEvent.ready(this.#handleDocumentReady.bind(this));\n\t}\n\n\tgetUserFieldControl(): UserFieldControl\n\t{\n\t\treturn this.#userFieldControl;\n\t}\n\n\tgetParser(): HtmlParser\n\t{\n\t\treturn this.#htmlParser;\n\t}\n\n\t/**\n\t *\n\t * @returns {BXEditor}\n\t */\n\tgetHtmlEditor()\n\t{\n\t\treturn this.#htmlEditor;\n\t}\n\n\tgetEventObject(): HTMLElement\n\t{\n\t\treturn this.#eventObject;\n\t}\n\n\tselectFileButton(): void\n\t{\n\t\tconst event: BaseEvent = new BaseEvent({\n\t\t\tdata: 'show',\n\t\t\t// needs to determine our own event (main.post.form emits onShowControllers as well)\n\t\t\tcompatData: ['user-field-widget'],\n\t\t});\n\n\t\tEventEmitter.emit(this.#eventObject, 'onShowControllers', event);\n\t}\n\n\tdeselectFileButton(): void\n\t{\n\t\tconst event: BaseEvent = new BaseEvent({\n\t\t\tdata: 'hide',\n\t\t\t// needs to determine our own event (main.post.form emits onShowControllers as well)\n\t\t\tcompatData: ['user-field-widget'],\n\t\t});\n\n\t\tEventEmitter.emit(this.#eventObject, 'onShowControllers', event);\n\t}\n\n\tselectCreateDocumentButton(): void\n\t{\n\t\tif (this.#createDocumentButton)\n\t\t{\n\t\t\tconst container: HTMLElement = this.#createDocumentButton.closest('[data-id=\"disk-document\"]');\n\t\t\tif (container)\n\t\t\t{\n\t\t\t\tcontainer.setAttribute('data-bx-button-status', 'active');\n\t\t\t}\n\t\t}\n\t}\n\n\tdeselectCreateDocumentButton(): void\n\t{\n\t\tif (this.#createDocumentButton)\n\t\t{\n\t\t\tconst container: HTMLElement = this.#createDocumentButton.closest('[data-id=\"disk-document\"]');\n\t\t\tif (container)\n\t\t\t{\n\t\t\t\tcontainer.removeAttribute('data-bx-button-status');\n\t\t\t}\n\t\t}\n\t}\n\n\t#handleDocumentReady(): void\n\t{\n\t\tconst postForm = this.#getPostForm();\n\t\tif (postForm === null)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst postForm = this.#getPostForm();\n\t\t\t\tif (postForm)\n\t\t\t\t{\n\t\t\t\t\tthis.#handlePostFormReady(postForm);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.error('Disk User Field: Post Form Not Found.');\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#handlePostFormReady(postForm);\n\t\t}\n\t}\n\n\t#handlePostFormReady(postForm: PostForm)\n\t{\n\t\tif (postForm.isReady)\n\t\t{\n\t\t\tthis.#init(postForm);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEventEmitter.subscribe(postForm, 'OnEditorIsLoaded', (): void => {\n\t\t\t\tthis.#init(postForm);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @param {PostForm} postForm\n\t */\n\t#init(postForm)\n\t{\n\t\tthis.#bindAdapterEvents();\n\n\t\tthis.#htmlEditor = postForm.getEditor();\n\t\tthis.#htmlParser = new HtmlParser(this);\n\n\t\tEventEmitter.subscribe(this.#htmlEditor, 'OnContentChanged', (event: BaseEvent) => {\n\t\t\tthis.#htmlParser.syncHighlightsDebounced();\n\t\t});\n\n\t\tEventEmitter.subscribe(this.#htmlEditor, 'BXEditor:onBeforePasteAsync', (event: BaseEvent) => {\n\t\t\treturn new Promise((resolve, reject): void => {\n\t\t\t\tconst clipboardEvent: ClipboardEvent = event.getData().clipboardEvent;\n\t\t\t\tconst clipboardData: DataTransfer = clipboardEvent.clipboardData;\n\n\t\t\t\tclipboardEvent.stopImmediatePropagation(); // Skip HTML Editor InitClipboardHandler\n\t\t\t\tif (!clipboardData || !isFilePasted(clipboardData))\n\t\t\t\t{\n\t\t\t\t\tresolve();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tclipboardEvent.preventDefault(); // Prevent Browser behavior\n\t\t\t\tevent.preventDefault(); // Prevent invoking HTMLEditor Paste Handler (OnPasteHandler)\n\n\t\t\t\tgetFilesFromDataTransfer(clipboardData)\n\t\t\t\t\t.then((files: File[]): void => {\n\t\t\t\t\t\tfiles.forEach((file: File): void => {\n\t\t\t\t\t\t\tthis.getUserFieldControl().getUploader().addFile(file, {\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t[FileEvent.LOAD_ERROR]: () => {},\n\t\t\t\t\t\t\t\t\t[FileEvent.UPLOAD_ERROR]: () => {},\n\t\t\t\t\t\t\t\t\t[FileEvent.LOAD_COMPLETE]: (event: BaseEvent): void => {\n\t\t\t\t\t\t\t\t\t\t// const file: UploaderFile = event.getTarget();\n\t\t\t\t\t\t\t\t\t\t// const item: TileWidgetItem = this.getUserFieldControl().getItem(file.getId());\n\t\t\t\t\t\t\t\t\t\t// We could try insert a file/image stub.\n\t\t\t\t\t\t\t\t\t\t// if (item)\n\t\t\t\t\t\t\t\t\t\t// {\n\t\t\t\t\t\t\t\t\t\t// \tthis.getUserFieldControl().show();\n\t\t\t\t\t\t\t\t\t\t// \tthis.getParser().insertFile(item);\n\t\t\t\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t[FileEvent.UPLOAD_COMPLETE]: (event: BaseEvent): void => {\n\t\t\t\t\t\t\t\t\t\tconst file: UploaderFile = event.getTarget();\n\t\t\t\t\t\t\t\t\t\tconst item: TileWidgetItem = this.getUserFieldControl().getItem(file.getId());\n\t\t\t\t\t\t\t\t\t\tif (item)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tthis.getUserFieldControl().showUploaderPanel();\n\t\t\t\t\t\t\t\t\t\t\tthis.getParser().insertFile(item);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((): void => {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t});\n\t\t});\n\n\t\tthis.emit('onReady');\n\n\t\tthis.#inited = true;\n\t}\n\n\t#getPostForm()\n\t{\n\t\tconst PostForm: Class = Reflection.getClass('BX.Main.PostForm');\n\t\tif (!PostForm)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet result = null;\n\t\tPostForm.repo.forEach((editor) => {\n\t\t\tif (editor.getEventObject() === this.getEventObject())\n\t\t\t{\n\t\t\t\tresult = editor;\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t#bindEventObject(): void\n\t{\n\t\t// Show / Hide files control panel\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onShowControllers', (event: BaseEvent): void => {\n\t\t\tif (Type.isArrayFilled(event.getCompatData()) && event.getCompatData()[0] === 'user-field-widget')\n\t\t\t{\n\t\t\t\t// Skip our own event (main.post.form emits onShowControllers as well).\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst status = Type.isArray(event.getData()) ? event.getData().shift() : event.getData();\n\t\t\tif (status === 'show')\n\t\t\t{\n\t\t\t\tthis.getUserFieldControl().showUploaderPanel();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getUserFieldControl().hide();\n\t\t\t}\n\t\t});\n\n\t\t// Inline a post/comment editing\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onReinitializeBeforeAsync', (event: BaseEvent): Promise => {\n\t\t\treturn new Promise((resolve): void => {\n\t\t\t\tif (this.#inited)\n\t\t\t\t{\n\t\t\t\t\tthis.#handleReinitializeBefore(event).then(() => resolve());\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.subscribeOnce('onReady', (): void => {\n\t\t\t\t\t\tthis.#handleReinitializeBefore(event).then(() => resolve());\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// Some components get attachments from main.post.form via arFiles and controllers properties.\n\t\t// See main.post.form/templates/.default/src/editor.js:778\n\t\t// See timeline/src/commenteditor.js:320\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onCollectControllers', (event: BaseEvent): void => {\n\t\t\tconst data = event.getData();\n\n\t\t\tconst fieldName: string = this.getUserFieldControl().getUploader().getHiddenFieldName();\n\t\t\tconst ids = this.getUserFieldControl().getItems().map((item: TileWidgetItem): number | string => {\n\t\t\t\treturn item.serverFileId;\n\t\t\t});\n\n\t\t\tdata[fieldName] = {\n\t\t\t\tstorage: 'disk',\n\t\t\t\ttag: '[DISK FILE ID=#id#]',\n\t\t\t\tvalues: ids,\n\t\t\t\thandler: {\n\t\t\t\t\tselectFile: (tab, path, selected): void => {\n\t\t\t\t\t\tObject.values(selected).forEach((item): void => {\n\t\t\t\t\t\t\tthis.getUserFieldControl().getUploader().addFile({\n\t\t\t\t\t\t\t\tserverFileId: item.id,\n\t\t\t\t\t\t\t\tname: item.name,\n\t\t\t\t\t\t\t\tsize: item.sizeInt,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tremoveFiles: (): void => {\n\t\t\t\t\t\tthis.getUserFieldControl().getUploader().removeFiles();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\n\t\t// Video records\n\t\tEventEmitter.subscribe(this.getEventObject(), 'OnVideoHasCaught', (event: BaseEvent): void => {\n\t\t\tevent.stopImmediatePropagation();\n\t\t\tthis.getUserFieldControl().getUploader().addFile(event.getData(), {\n\t\t\t\tevents: {\n\t\t\t\t\t[FileEvent.UPLOAD_COMPLETE]: (event: BaseEvent): void => {\n\t\t\t\t\t\tconst file: UploaderFile = event.getTarget();\n\t\t\t\t\t\tconst item: TileWidgetItem = this.getUserFieldControl().getItem(file.getId());\n\t\t\t\t\t\tif (item)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.getUserFieldControl().showUploaderPanel();\n\t\t\t\t\t\t\tthis.getParser().insertFile(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\t// An old approach (see BXEditor:onBeforePasteAsync) to process images from clipboard. Just in case.\n\t\tEventEmitter.subscribe(this.getEventObject(), 'OnImageHasCaught', (event: BaseEvent): void => {\n\t\t\tevent.stopImmediatePropagation();\n\n\t\t\treturn new Promise((resolve, reject): void => {\n\t\t\t\tthis.getUserFieldControl().getUploader().addFile(event.getData(), {\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t[FileEvent.LOAD_ERROR]: (event: BaseEvent): void => {\n\t\t\t\t\t\t\tconst error: UploaderError = event.getData().error;\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[FileEvent.UPLOAD_ERROR]: () => (event: BaseEvent): void => {\n\t\t\t\t\t\t\tconst error: UploaderError = event.getData().error;\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[FileEvent.UPLOAD_COMPLETE]: (event: BaseEvent): void => {\n\t\t\t\t\t\t\tconst file: UploaderFile = event.getTarget();\n\t\t\t\t\t\t\tconst item: TileWidgetItem = this.getUserFieldControl().getItem(file.getId());\n\t\t\t\t\t\t\tif (item)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.getParser().syncHighlights();\n\n\t\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\t\tsrc: file.getPreviewUrl(),\n\t\t\t\t\t\t\t\t\t\twidth: file.getPreviewWidth(),\n\t\t\t\t\t\t\t\t\t\theight: file.getPreviewHeight(),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\thtml: this.getParser().createItemHtml(item),\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treject(new UploaderError('WRONG_FILE_SOURCE'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t// Files from Drag&Drop\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onFilesHaveCaught', (event: BaseEvent): void => {\n\t\t\t// Skip this because an event doesn't have all Drag&Drop data\n\t\t\tevent.stopImmediatePropagation();\n\t\t});\n\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onFilesHaveDropped', (event: BaseEvent): void => {\n\t\t\tevent.stopImmediatePropagation();\n\n\t\t\tconst dragEvent: DragEvent = event.getData().event;\n\n\t\t\tgetFilesFromDataTransfer(dragEvent.dataTransfer)\n\t\t\t\t.then((files: File[]): void => {\n\t\t\t\t\tthis.getUserFieldControl().getUploader().addFiles(files);\n\t\t\t\t})\n\t\t\t\t.catch(() => {})\n\t\t\t;\n\t\t});\n\t}\n\n\t#bindAdapterEvents(): void\n\t{\n\t\t// Button counter: File -> File (1) -> File (2)\n\t\tconst adapter: VueUploaderAdapter = this.getUserFieldControl().getAdapter();\n\t\tadapter.subscribe('Item:onAdd', (): void => {\n\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowControllers:File:Increment');\n\t\t});\n\n\t\tadapter.subscribe('Item:onRemove', (event: BaseEvent<{ item: TileWidgetItem }>): void => {\n\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowControllers:File:Decrement');\n\t\t\tconst item: TileWidgetItem = event.getData().item;\n\n\t\t\tif (this.getParser())\n\t\t\t{\n\t\t\t\tthis.getParser().removeFile(item);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * This method invokes for inline entity editing\n\t * @param event\n\t */\n\t#handleReinitializeBefore(event: BaseEvent): Promise\n\t{\n\t\tthis.getUserFieldControl().clear();\n\n\t\tconst [, userFields] = event.getData();\n\t\tconst fieldName: string = this.getUserFieldControl().getUploader().getHiddenFieldName();\n\t\tconst userField = (\n\t\t\tuserFields && userFields[fieldName] && userFields[fieldName]['USER_TYPE_ID'] === 'disk_file'\n\t\t\t\t? userFields[fieldName]\n\t\t\t\t: null\n\t\t);\n\n\t\tif (userField !== null)\n\t\t{\n\t\t\t// existing entity\n\t\t\tif (\n\t\t\t\tType.isPlainObject(userField['CUSTOM_DATA'])\n\t\t\t\t&& Type.isStringFilled(userField['CUSTOM_DATA']['PHOTO_TEMPLATE'])\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.getUserFieldControl().setPhotoTemplateMode('manual');\n\t\t\t\tthis.getUserFieldControl().setPhotoTemplate(userField['CUSTOM_DATA']['PHOTO_TEMPLATE']);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getUserFieldControl().setPhotoTemplateMode('auto');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// new entity\n\t\t\tthis.getUserFieldControl().setPhotoTemplateMode('auto');\n\t\t\tthis.getUserFieldControl().setPhotoTemplate('grid');\n\t\t}\n\n\t\tif (userField === null)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\t// nextTick needs to unmount a TileList component after clear().\n\t\t// Component unmounting resets an auto collapse.\n\t\tif (Type.isArray(userField['FILES']))\n\t\t{\n\t\t\treturn this.#userFieldControl.nextTick().then(() => {\n\t\t\t\tuserField['FILES'].forEach(file => {\n\t\t\t\t\tif (!this.getUserFieldControl().getUploader().getFile(file.serverFileId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getUserFieldControl().getUploader().addFile(file);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (this.getUserFieldControl().getUploader().getFiles().length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.#userFieldControl.enableAutoCollapse();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (Type.isArrayFilled(userField['VALUE']))\n\t\t{\n\t\t\treturn this.#userFieldControl.nextTick().then((): Promise => {\n\t\t\t\treturn new Promise((resolve): void => {\n\t\t\t\t\tlet fileIds: number[] = userField['VALUE'];\n\t\t\t\t\tfileIds = fileIds.filter((id: number) => !this.getUserFieldControl().getUploader().getFile(id));\n\n\t\t\t\t\tlet loaded = 0;\n\t\t\t\t\tlet addedFiles: UploaderFile[] = [];\n\t\t\t\t\tconst onLoad = () => {\n\t\t\t\t\t\tloaded++;\n\t\t\t\t\t\tif (loaded === addedFiles.length)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tconst events = {\n\t\t\t\t\t\t[FileEvent.LOAD_COMPLETE]: onLoad,\n\t\t\t\t\t\t[FileEvent.LOAD_ERROR]: onLoad,\n\t\t\t\t\t};\n\n\t\t\t\t\tconst fileOptions = fileIds.map((id: number) => [id, { events }]);\n\t\t\t\t\tif (fileOptions.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\taddedFiles = this.getUserFieldControl().getUploader().addFiles(fileOptions);\n\t\t\t\t\t\tif (addedFiles.length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#userFieldControl.enableAutoCollapse();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\t#addCreateDocumentButton(): void\n\t{\n\t\tthis.#createDocumentButton = Tag.render`\n\t\t\t<div onclick=\"${this.#handleButtonClick.bind(this)}\">\n\t\t\t\t<i></i>\n\t\t\t\t${Loc.getMessage('DISK_UF_WIDGET_CREATE_DOCUMENT')}\n\t\t\t</div>\n\t\t`;\n\n\t\tEventEmitter.emit(\n\t\t\tthis.getEventObject(),\n\t\t\t'OnAddButton',\n\t\t\t[{ BODY: this.#createDocumentButton, ID: 'disk-document' }, 'file'],\n\t\t);\n\t}\n\n\t#handleButtonClick(): void\n\t{\n\t\tconst container: HTMLElement = this.#createDocumentButton.closest('[data-id=\"disk-document\"]');\n\t\tif (container && container.hasAttribute('data-bx-button-status'))\n\t\t{\n\t\t\tthis.getUserFieldControl().hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getUserFieldControl().showDocumentPanel();\n\t\t}\n\t}\n}\n","import { Type, Dom, Tag, Extension, Text } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { UploaderFile, Uploader } from 'ui.uploader.core';\n\nimport MainPostForm from './integration/main-post-form';\n\nimport type { TileWidgetItem } from 'ui.uploader.tile-widget';\nimport type { VueUploaderAdapter } from 'ui.uploader.vue';\nimport type { UserFieldWidgetOptions } from './user-field-widget-options';\n\nconst instances: Map<string, UserFieldControl> = new Map();\n\nexport default class UserFieldControl extends EventEmitter\n{\n\t#id: ?string = null;\n\t#adapter: VueUploaderAdapter = null;\n\t#mainPostForm: MainPostForm = null;\n\n\t#allowDocumentFieldName: string = null;\n\n\t#photoTemplateFieldName: string = null;\n\t#photoTemplateInput: HTMLInputElement = null;\n\t#photoTemplateMode: 'auto' | 'manual' = 'auto';\n\n\t#widgetComponent = null;\n\n\tconstructor(widgetComponent)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Disk.Uploader.Integration');\n\n\t\tthis.#widgetComponent = widgetComponent;\n\t\tthis.#adapter = widgetComponent.adapter;\n\n\t\tconst options: UserFieldWidgetOptions = (\n\t\t\tType.isPlainObject(widgetComponent.widgetOptions) ? widgetComponent.widgetOptions : {}\n\t\t);\n\n\t\tthis.#photoTemplateFieldName = (\n\t\t\tType.isStringFilled(options.photoTemplateFieldName) ? options.photoTemplateFieldName : null\n\t\t);\n\n\t\tthis.#allowDocumentFieldName = (\n\t\t\tType.isStringFilled(options.allowDocumentFieldName) ? options.allowDocumentFieldName : null\n\t\t);\n\n\t\tthis.#adapter.subscribe('Item:onComplete', (event: BaseEvent<{ item: TileWidgetItem }>): void => {\n\t\t\tconst item: TileWidgetItem = event.getData().item;\n\t\t\tthis.setDocumentEdit(item);\n\t\t});\n\n\t\tthis.#adapter.subscribe('Item:onRemove', (event: BaseEvent<{ item: TileWidgetItem }>): void => {\n\t\t\tconst item: TileWidgetItem = event.getData().item;\n\t\t\tthis.removeAllowDocumentEditInput(item);\n\t\t});\n\n\t\tif (options.disableLocalEdit)\n\t\t{\n\t\t\t// it would be better to load disk.document on demand\n\t\t\tBX.Disk.Document.Local.Instance.disable();\n\t\t}\n\n\t\tif (this.#photoTemplateFieldName !== null && this.getUploader().getHiddenFieldsContainer() !== null)\n\t\t{\n\t\t\tthis.#photoTemplateInput = Tag.render`\n\t\t\t\t\t<input \n\t\t\t\t\t\tname=\"${this.#photoTemplateFieldName}\" \n\t\t\t\t\t\tvalue=\"${Type.isStringFilled(options.photoTemplate) ? options.photoTemplate : 'grid'}\"\n\t\t\t\t\t\ttype=\"hidden\" \n\t\t\t\t\t/>\n\t\t\t\t`;\n\n\t\t\tthis.setPhotoTemplateMode(options.photoTemplateMode);\n\n\t\t\tDom.append(this.#photoTemplateInput, this.getUploader().getHiddenFieldsContainer());\n\t\t}\n\n\t\tconst eventObject: ?HTMLElement = Type.isElementNode(options.eventObject) ? options.eventObject : null;\n\t\tif (eventObject)\n\t\t{\n\t\t\tthis.#mainPostForm = new MainPostForm(\n\t\t\t\tthis,\n\t\t\t\t{\n\t\t\t\t\teventObject,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonReady: (): void => {\n\t\t\t\t\t\t\tthis.getUploader().addFiles(options.files);\n\t\t\t\t\t\t\tif (this.getUploader().getFiles().length > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.showUploaderPanel();\n\t\t\t\t\t\t\t\tthis.enableAutoCollapse();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getUploader().addFiles(options.files);\n\t\t}\n\n\t\tthis.#id = (\n\t\t\tType.isStringFilled(options.mainPostFormId)\n\t\t\t\t? options.mainPostFormId\n\t\t\t\t: `user-field-control-${Text.getRandom().toLowerCase()}`\n\t\t);\n\n\t\tinstances.set(this.#id, this);\n\t}\n\n\tstatic getById(id: string): ?UserFieldControl\n\t{\n\t\treturn instances.get(id) || null;\n\t}\n\n\tstatic getInstances(): UserFieldControl[]\n\t{\n\t\treturn [...instances.values()];\n\t}\n\n\tcanCreateDocuments(): boolean\n\t{\n\t\tconst settings = Extension.getSettings('disk.uploader.user-field-widget');\n\t\tconst canCreateDocuments = settings.get('canCreateDocuments', false);\n\n\t\treturn canCreateDocuments && this.#widgetComponent.widgetOptions.canCreateDocuments !== false;\n\t}\n\n\tgetAdapter(): VueUploaderAdapter\n\t{\n\t\treturn this.#adapter;\n\t}\n\n\tgetMainPostForm(): ?MainPostForm\n\t{\n\t\treturn this.#mainPostForm;\n\t}\n\n\tgetItems(): TileWidgetItem[]\n\t{\n\t\treturn this.#adapter.getItems();\n\t}\n\n\tgetItem(id): ?TileWidgetItem\n\t{\n\t\treturn this.#adapter.getItem(id);\n\t}\n\n\tgetFiles(): UploaderFile[]\n\t{\n\t\treturn this.#adapter.getUploader().getFiles();\n\t}\n\n\tgetFile(id: string): ?UploaderFile\n\t{\n\t\treturn this.#adapter.getUploader().getFile(id);\n\t}\n\n\tgetUploader(): Uploader\n\t{\n\t\treturn this.#adapter.getUploader();\n\t}\n\n\tnextTick(): Promise\n\t{\n\t\treturn this.#widgetComponent.$nextTick();\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#widgetComponent.show(true);\n\t}\n\n\thide(): void\n\t{\n\t\tthis.#widgetComponent.hide(true);\n\t\tthis.hideUploaderPanel();\n\t\tthis.hideDocumentPanel();\n\t}\n\n\tshowUploaderPanel(): void\n\t{\n\t\tthis.show();\n\t\tthis.hideDocumentPanel();\n\t\tthis.#widgetComponent.showUploaderPanel();\n\n\t\tif (this.getMainPostForm())\n\t\t{\n\t\t\tthis.getMainPostForm().selectFileButton();\n\t\t}\n\t}\n\n\thideUploaderPanel(): void\n\t{\n\t\tthis.#widgetComponent.hideUploaderPanel();\n\n\t\tif (this.getMainPostForm())\n\t\t{\n\t\t\tthis.getMainPostForm().deselectFileButton();\n\t\t}\n\t}\n\n\tshowDocumentPanel(): void\n\t{\n\t\tif (!this.canCreateDocuments())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.show();\n\t\tthis.hideUploaderPanel();\n\t\tthis.#widgetComponent.showDocumentPanel();\n\n\t\tif (this.getMainPostForm())\n\t\t{\n\t\t\tthis.getMainPostForm().selectCreateDocumentButton();\n\t\t}\n\t}\n\n\thideDocumentPanel(): void\n\t{\n\t\tif (!this.canCreateDocuments())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#widgetComponent.hideDocumentPanel();\n\n\t\tif (this.getMainPostForm())\n\t\t{\n\t\t\tthis.getMainPostForm().deselectCreateDocumentButton();\n\t\t}\n\t}\n\n\tclear(): void\n\t{\n\t\tthis.getUploader().removeFiles({ removeFromServer: false });\n\t}\n\n\tenableAutoCollapse(): void\n\t{\n\t\tthis.#widgetComponent.enableAutoCollapse();\n\t}\n\n\tcanAllowDocumentEdit(): boolean\n\t{\n\t\treturn this.#allowDocumentFieldName !== null && this.getUploader().getHiddenFieldsContainer() !== null;\n\t}\n\n\tcanItemAllowEdit(item: TileWidgetItem): boolean\n\t{\n\t\treturn (\n\t\t\tthis.canAllowDocumentEdit()\n\t\t\t&& item.customData['isEditable'] === true\n\t\t\t&& item.customData['canUpdate'] === true\n\t\t);\n\t}\n\n\tgetAllowDocumentEditInput(item: TileWidgetItem): ?HTMLInputElement\n\t{\n\t\tconst selector = `input[name='${this.#allowDocumentFieldName}[${item.serverFileId}]']`;\n\n\t\tif (this.getUploader().getHiddenFieldsContainer() !== null)\n\t\t{\n\t\t\treturn this.getUploader().getHiddenFieldsContainer().querySelector(selector);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tremoveAllowDocumentEditInput(item: TileWidgetItem): void\n\t{\n\t\tconst input: HTMLInputElement = this.getAllowDocumentEditInput(item);\n\t\tif (input !== null)\n\t\t{\n\t\t\tDom.remove(input);\n\t\t}\n\t}\n\n\tsetDocumentEdit(item: TileWidgetItem, allowEdit: ?boolean = null): void\n\t{\n\t\tif (!this.canItemAllowEdit(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet input: HTMLInputElement = this.getAllowDocumentEditInput(item);\n\t\tif (input === null)\n\t\t{\n\t\t\tinput = Tag.render`<input name=\"${this.#allowDocumentFieldName}[${item.serverFileId}]\" type=\"hidden\" />`;\n\t\t\tDom.append(input, this.getUploader().getHiddenFieldsContainer());\n\t\t}\n\n\t\tallowEdit = allowEdit === null ? item.customData['allowEdit'] === true : allowEdit;\n\t\tinput.value = allowEdit ? 1 : 0;\n\n\t\tconst file: UploaderFile = this.getFile(item.id);\n\t\tfile.setCustomData('allowEdit', allowEdit);\n\t}\n\n\tcanChangePhotoTemplate(): boolean\n\t{\n\t\treturn this.#photoTemplateFieldName !== null;\n\t}\n\n\tsetPhotoTemplate(name: string): void\n\t{\n\t\tif (Type.isStringFilled(name) && this.#photoTemplateInput !== null)\n\t\t{\n\t\t\tthis.#photoTemplateInput.value = name;\n\t\t}\n\t}\n\n\tgetPhotoTemplate(): string\n\t{\n\t\treturn this.#photoTemplateInput !== null ? this.#photoTemplateInput.value : '';\n\t}\n\n\tsetPhotoTemplateMode(mode: 'auto' | 'manual'): void\n\t{\n\t\tif (mode === 'auto' || mode === 'manual')\n\t\t{\n\t\t\tthis.#photoTemplateMode = mode;\n\t\t}\n\t}\n\n\tgetPhotoTemplateMode(): 'auto' | 'manual'\n\t{\n\t\treturn this.#photoTemplateMode;\n\t}\n\n\tgetDocumentServices(): Object<string, Array<{ name: string, code: string }>>\n\t{\n\t\tconst settings = Extension.getSettings('disk.uploader.user-field-widget');\n\t\tconst documentHandlers = settings.get('documentHandlers', {});\n\t\tif (Type.isPlainObject(documentHandlers))\n\t\t{\n\t\t\treturn documentHandlers;\n\t\t}\n\n\t\treturn {};\n\t}\n\n\tgetCurrentDocumentService(): { name: string, code: string } | null\n\t{\n\t\tlet currentServiceCode = BX.Disk.getDocumentService();\n\t\tif (!currentServiceCode && BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\tcurrentServiceCode = 'onlyoffice';\n\t\t}\n\t\telse if (!currentServiceCode)\n\t\t{\n\t\t\tcurrentServiceCode = 'l';\n\t\t}\n\n\t\treturn this.getDocumentServices()[currentServiceCode] || null;\n\t}\n\n\tgetImportServices(): Object<string, Array<{ name: string, code: string }>>\n\t{\n\t\tconst settings = Extension.getSettings('disk.uploader.user-field-widget');\n\t\tconst importHandlers = settings.get('importHandlers', {});\n\t\tif (Type.isPlainObject(importHandlers))\n\t\t{\n\t\t\treturn importHandlers;\n\t\t}\n\n\t\treturn {};\n\t}\n}\n","import { ajax as Ajax, Loc, Runtime, Uri } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nexport const loadDiskFileDialog = (dialogName, params: Object<string, string> = {}): Promise => {\n\treturn new Promise((resolve): void => {\n\t\tRuntime.loadExtension('disk.legacy.file-dialog').then(() => {\n\t\t\tconst handleInit = (event: BaseEvent): void => {\n\t\t\t\tconst [name] = event.getData();\n\t\t\t\tif (dialogName === name)\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'inited', handleInit);\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'inited', handleInit);\n\n\t\t\t// Invokes BX.DiskFileDialog.init\n\t\t\tAjax.get(getDialogInitUrl(dialogName, params));\n\t\t});\n\t});\n};\n\nconst getDialogInitUrl = (dialogName, params: Object<string, string> = {}): string => {\n\tconst url = `/bitrix/tools/disk/uf.php?action=openDialog&SITE_ID=${\n\t\tLoc.getMessage('SITE_ID')}&dialog2=Y&ACTION=SELECT&MULTI=Y&dialogName=${dialogName}`\n\t;\n\n\treturn Uri.addParam(url, params);\n};","import { Loc, Text, Type, Tag, Runtime, ajax as Ajax } from 'main.core';\n\nimport { UploaderFile, getFilenameWithoutExtension, getFileExtension } from 'ui.uploader.core';\nimport { loadDiskFileDialog } from './helpers/load-disk-file-dialog';\n\nimport type { TileWidgetItem } from 'ui.uploader.tile-widget';\nimport type { Menu, MenuItem } from 'main.popup';\nimport type { BaseEvent } from 'main.core.events';\nimport type { Button, ButtonSize, ButtonColor } from 'ui.buttons';\nimport type UserFieldControl from './user-field-control';\nimport type MainPostForm from './integration/main-post-form';\n\nimport './css/item-rename-form.css';\n\nexport default class ItemMenu\n{\n\t#userFieldControl: UserFieldControl = null;\n\t#item: TileWidgetItem = null;\n\t#menu: Menu = null;\n\t#folderDialogId: string = null;\n\n\tconstructor(userFieldControl: UserFieldControl, item: TileWidgetItem, menu: Menu)\n\t{\n\t\tthis.#userFieldControl = userFieldControl;\n\t\tthis.#item = item;\n\t\tthis.#menu = menu;\n\t\tthis.#folderDialogId = `folder-dialog-${Text.getRandom(5)}`;\n\t}\n\n\tbuild(): void\n\t{\n\t\tconst firstItemId: string = this.#menu.getMenuItems()[0]?.id ?? '';\n\n\t\tthis.#menu.getPopupWindow().setMaxWidth(500);\n\n\t\tthis.#menu.addMenuItem({\n\t\t\tid: 'filesize',\n\t\t\ttext: Loc.getMessage('DISK_UF_WIDGET_FILE_SIZE', { '#filesize#': this.#item.sizeFormatted }),\n\t\t\tdisabled: true,\n\t\t}, firstItemId);\n\n\t\tthis.#menu.addMenuItem({ delimiter: true }, firstItemId);\n\n\t\tconst postForm: ?MainPostForm = this.#userFieldControl.getMainPostForm();\n\t\tif (postForm)\n\t\t{\n\t\t\tthis.#menu.addMenuItem({\n\t\t\t\tid: 'insert-into-text',\n\t\t\t\ttext: Loc.getMessage('DISK_UF_WIDGET_INSERT_INTO_THE_TEXT'),\n\t\t\t\tonclick : (): void => {\n\t\t\t\t\tthis.#menu.close();\n\t\t\t\t\tpostForm.getParser().insertFile(this.#item);\n\t\t\t\t},\n\t\t\t}, firstItemId);\n\t\t}\n\n\t\tif (this.#userFieldControl.canItemAllowEdit(this.#item))\n\t\t{\n\t\t\tthis.#menu.addMenuItem({ delimiter: true });\n\t\t\tthis.#menu.addMenuItem({\n\t\t\t\tid: 'allow-edit',\n\t\t\t\tclassName: this.#item.customData['allowEdit'] === true ? 'disk-user-field-item-checked' : '',\n\t\t\t\ttext: Loc.getMessage('DISK_UF_WIDGET_ALLOW_DOCUMENT_EDIT'),\n\t\t\t\tonclick: (event, menuItem: MenuItem): void => {\n\t\t\t\t\tif (this.#item.customData['allowEdit'] === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#userFieldControl.setDocumentEdit(this.#item, false);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#userFieldControl.setDocumentEdit(this.#item, true);\n\t\t\t\t\t}\n\n\t\t\t\t\tmenuItem.getMenuWindow().close();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.#item.customData['canRename'])\n\t\t{\n\t\t\tthis.#menu.addMenuItem({ delimiter: true });\n\n\t\t\tthis.#menu.addMenuItem({\n\t\t\t\tid: 'rename',\n\t\t\t\ttext: Loc.getMessage('DISK_UF_WIDGET_RENAME_FILE_MENU_TITLE'),\n\t\t\t\tevents: {\n\t\t\t\t\t'SubMenu:onShow': (event: BaseEvent): void => {\n\t\t\t\t\t\tconst renameItem: MenuItem = event.getTarget();\n\t\t\t\t\t\tthis.#showRenameMenu(renameItem);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\titems: [{\n\t\t\t\t\tid: 'rename-textarea',\n\t\t\t\t\thtml: '<div class=\"disk-user-field-rename-loading\"></div>',\n\t\t\t\t\tclassName: 'disk-user-field-rename-menu-item',\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#item.customData['storage']))\n\t\t{\n\t\t\tthis.#menu.addMenuItem({\n\t\t\t\tdelimiter: true,\n\t\t\t\t//text: Loc.getMessage('DISK_UF_WIDGET_SAVED_IN_DISK_FOLDER'),\n\t\t\t});\n\n\t\t\tif (this.#item.customData['canMove'])\n\t\t\t{\n\t\t\t\tthis.#menu.addMenuItem({\n\t\t\t\t\tid: 'storage',\n\t\t\t\t\ttext: this.#item.customData['storage'] + '&mldr;',\n\t\t\t\t\tonclick : (): void => {\n\t\t\t\t\t\tthis.openFolderDialog();\n\t\t\t\t\t\tthis.#menu.close();\n\t\t\t\t\t},\n\t\t\t\t\tdisabled: this.#item.tileWidgetData.selected === true,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#menu.addMenuItem({\n\t\t\t\t\tid: 'storage',\n\t\t\t\t\ttext: this.#item.customData['storage'],\n\t\t\t\t\tdisabled: true,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\trename(newName: string): Promise\n\t{\n\t\treturn new Promise((resolve, reject): void => {\n\t\t\tAjax.runAction('disk.api.commonActions.rename', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tobjectId: this.#item.customData['objectId'],\n\t\t\t\t\t\tnewName: newName,\n\t\t\t\t\t\tautoCorrect: true,\n\t\t\t\t\t\tgenerateUniqueName: true,\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then((response): void => {\n\t\t\t\t\tif (response?.status === 'success' && response?.data?.object?.name !== this.#item.name)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst file: UploaderFile = this.#userFieldControl.getFile(this.#item.id);\n\t\t\t\t\t\tconst name = response.data.object.name;\n\t\t\t\t\t\tfile.setName(name);\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch((response): void => {\n\t\t\t\t\tBX.Disk.showModalWithStatusAction(response);\n\t\t\t\t\treject();\n\t\t\t\t})\n\t\t});\n\t}\n\n\t#showRenameMenu(renameItem: MenuItem): void\n\t{\n\t\tRuntime.loadExtension('ui.buttons').then((exports): void => {\n\t\t\tconst Button: Class<Button> = exports.Button;\n\t\t\tconst ButtonSize: Class<ButtonSize> = exports.ButtonSize;\n\t\t\tconst ButtonColor: Class<ButtonColor> = exports.ButtonColor;\n\t\t\tconst CancelButton: Class<CancelButton> = exports.CancelButton;\n\n\t\t\tconst handleKeydown = (event: KeyboardEvent): void => {\n\t\t\t\tif (event.code === 'Enter')\n\t\t\t\t{\n\t\t\t\t\thandleRenameClick();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst nameWithoutExtension = getFilenameWithoutExtension(this.#item.name);\n\t\t\tconst handleRenameClick = (): void => {\n\t\t\t\tconst textareaValue: string = textarea.value.trim();\n\t\t\t\tif (!Type.isStringFilled(textareaValue) || textareaValue === nameWithoutExtension)\n\t\t\t\t{\n\t\t\t\t\trenameItem.getMenuWindow().close();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\trenameBtn.setWaiting(true);\n\t\t\t\tconst newFilename = `${textareaValue}.${getFileExtension(this.#item.name)}`;\n\t\t\t\tthis.rename(newFilename)\n\t\t\t\t\t.then((): void => {\n\t\t\t\t\t\trenameBtn.setWaiting(false);\n\t\t\t\t\t\trenameItem.getMenuWindow().close();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((): void => {\n\t\t\t\t\t\trenameBtn.setWaiting(false);\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t};\n\t\t\tconst textarea: HTMLTextAreaElement = Tag.render`\n\t\t\t\t<textarea \n\t\t\t\t\tclass=\"disk-user-field-rename-textarea\" \n\t\t\t\t\tonkeydown=\"${handleKeydown}\"\n\t\t\t\t>${Text.encode(nameWithoutExtension)}</textarea>\n\t\t\t`;\n\n\t\t\tconst renameBtn: Button = new Button({\n\t\t\t\ttext: Loc.getMessage('DISK_UF_WIDGET_RENAME_FILE_BUTTON_TITLE'),\n\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\tonclick: handleRenameClick,\n\t\t\t});\n\n\t\t\tconst cancelBtn: CancelButton = new CancelButton({\n\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\tonclick: (): void => {\n\t\t\t\t\trenameItem.getMenuWindow().close();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst submenu: Menu = renameItem.getSubMenu();\n\t\t\tconst textareaItem: MenuItem = submenu.getMenuItem('rename-textarea');\n\n\t\t\ttextareaItem.setText(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"disk-user-field-rename-form\">\n\t\t\t\t\t\t${textarea}\n\t\t\t\t\t\t<div class=\"disk-user-field-rename-buttons\">${[renameBtn.render(), cancelBtn.render()]}</div>\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\trenameItem.showSubMenu();\n\t\t});\n\t}\n\n\topenFolderDialog(): void\n\t{\n\t\tloadDiskFileDialog(this.#folderDialogId, { wish: 'fakemove' }).then((): void => {\n\t\t\tBX.DiskFileDialog.obCallback[this.#folderDialogId] = {\n\t\t\t\tsaveButton: (tab, path, selectedItems, folderByPath): void => {\n\t\t\t\t\tconst selectedItem = Object.values(selectedItems)[0] || folderByPath;\n\t\t\t\t\tif (!selectedItem)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst folderId = selectedItem.id === 'root' ? tab.rootObjectId : selectedItem.id;\n\n\t\t\t\t\tAjax.runAction('disk.api.commonActions.move', {\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tobjectId: this.#item.customData['objectId'],\n\t\t\t\t\t\t\ttoFolderId: folderId,\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.then((response): void => {\n\t\t\t\t\t\tif (response?.status === 'success')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst file: UploaderFile = this.#userFieldControl.getFile(this.#item.id);\n\t\t\t\t\t\t\tconst name = response.data.object.name;\n\t\t\t\t\t\t\tconst id = response.data.object.id;\n\n\t\t\t\t\t\t\tfile.setServerFileId(`n${id}`);\n\t\t\t\t\t\t\tfile.setName(name);\n\n\t\t\t\t\t\t\tif (selectedItem.id === 'root')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfile.setCustomData('storage', `${tab.name} / `);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfile.setCustomData('storage', `${tab.name} / ${selectedItem.name}`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response): void => {\n\t\t\t\t\t\tBX.Disk.showModalWithStatusAction(response);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tif (BX.DiskFileDialog.popupWindow === null)\n\t\t\t{\n\t\t\t\tBX.DiskFileDialog.openDialog(this.#folderDialogId);\n\t\t\t}\n\t\t});\n\t}\n}","import { Loc } from 'main.core';\nimport { Menu, MenuItem } from 'main.popup';\n\nimport type UserFieldControl from './user-field-control';\n\nexport default class SettingsMenu\n{\n\t#userFieldControl: UserFieldControl = null;\n\t#menu: Menu = null;\n\n\tconstructor(userFieldControl: UserFieldControl)\n\t{\n\t\tthis.#userFieldControl = userFieldControl;\n\t}\n\n\tgetMenu(button): Menu\n\t{\n\t\tif (this.#menu !== null)\n\t\t{\n\t\t\treturn this.#menu;\n\t\t}\n\n\t\tthis.#menu = new Menu({\n\t\t\tbindElement: button.getContainer(),\n\t\t\tclassName: 'disk-user-field-settings-popup',\n\t\t\tangle: true,\n\t\t\tautoHide: true,\n\t\t\toffsetLeft: 16,\n\t\t\tcacheable: false,\n\t\t\titems: this.#getItems(),\n\t\t\tevents: {\n\t\t\t\tonShow: (): void => {\n\t\t\t\t\tbutton.select();\n\t\t\t\t},\n\t\t\t\tonDestroy: (): void => {\n\t\t\t\t\tbutton.deselect();\n\t\t\t\t\tthis.#menu = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this.#menu;\n\t}\n\n\t#getItems(): Array\n\t{\n\t\tif (!this.#userFieldControl.canChangePhotoTemplate())\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\treturn [{\n\t\t\tclassName: this.#userFieldControl.getPhotoTemplate() === 'grid' ? 'disk-user-field-item-checked' : '',\n\t\t\ttext: Loc.getMessage('DISK_UF_WIDGET_ALLOW_PHOTO_COLLAGE'),\n\t\t\tonclick: (event, menuItem: MenuItem): void => {\n\t\t\t\tthis.#userFieldControl.setPhotoTemplateMode('manual');\n\t\t\t\tif (this.#userFieldControl.getPhotoTemplate() === 'grid')\n\t\t\t\t{\n\t\t\t\t\tthis.#userFieldControl.setPhotoTemplate('gallery');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#userFieldControl.setPhotoTemplate('grid');\n\t\t\t\t}\n\n\t\t\t\tmenuItem.getMenuWindow().close();\n\t\t\t}\n\t\t}];\n\t}\n\n\tshow(button): void\n\t{\n\t\tthis.getMenu(button).show();\n\t}\n\n\ttoggle(button): void\n\t{\n\t\tif (this.#menu !== null && this.#menu.getPopupWindow().isShown())\n\t\t{\n\t\t\tthis.#menu.close();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.show(button);\n\t\t}\n\t}\n\n\thide(): void\n\t{\n\t\tif (this.#menu !== null)\n\t\t{\n\t\t\tthis.#menu.close();\n\t\t}\n\t}\n\n\thasItems(): boolean\n\t{\n\t\treturn this.#getItems().length > 0;\n\t}\n}","import { Text, Type } from 'main.core';\nimport { Uploader } from 'ui.uploader.core';\n\nimport { loadDiskFileDialog } from './load-disk-file-dialog';\n\nconst loadingDialogs: Set<string> = new Set();\n\nexport const openDiskFileDialog = (options): void => {\n\n\toptions = Type.isPlainObject(options) ? options : {};\n\tconst dialogId: string = Type.isStringFilled(options.dialogId) ? options.dialogId : `file-dialog-${Text.getRandom(5)}`;\n\tconst onLoad: ?Function = Type.isFunction(options.onLoad) ? options.onLoad : null;\n\tconst onSelect: ?Function = Type.isFunction(options.onSelect) ? options.onSelect : null;\n\tconst onClose: ?Function = Type.isFunction(options.onClose) ? options.onClose : null;\n\tconst uploader: ?Uploader = options.uploader instanceof Uploader ? options.uploader : null;\n\n\tif (loadingDialogs.has(dialogId))\n\t{\n\t\treturn;\n\t}\n\n\tloadingDialogs.add(dialogId);\n\n\tloadDiskFileDialog(dialogId).then((): void => {\n\t\tloadingDialogs.delete(dialogId);\n\t\tif (onLoad !== null)\n\t\t{\n\t\t\tonLoad();\n\t\t}\n\n\t\tBX.DiskFileDialog.obCallback[dialogId] = {\n\t\t\tsaveButton: (tab, path, selectedItems): void => {\n\t\t\t\tObject.values(selectedItems).forEach(item => {\n\t\t\t\t\tif (uploader !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tuploader.addFile(item.id, { name: item.name, preload: true });\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (onSelect !== null)\n\t\t\t\t{\n\t\t\t\t\tonSelect(tab, path, selectedItems);\n\t\t\t\t}\n\t\t\t},\n\t\t\tpopupDestroy: (): void => {\n\t\t\t\tloadingDialogs.delete(dialogId);\n\t\t\t\tif (onClose !== null)\n\t\t\t\t{\n\t\t\t\t\tonClose();\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\n\t\tif (BX.DiskFileDialog.popupWindow === null)\n\t\t{\n\t\t\tBX.DiskFileDialog.openDialog(dialogId);\n\t\t}\n\t});\n};","import { UploaderFile, AbstractLoadController, Server } from 'ui.uploader.core';\n\nexport default class CloudLoadController extends AbstractLoadController\n{\n\tconstructor(server: Server, options = {})\n\t{\n\t\tsuper(server, options);\n\t}\n\n\tload(file: UploaderFile): void\n\t{\n\t\tthis.emit('onProgress', { progress: 100 });\n\t\tthis.emit('onLoad');\n\t}\n\n\tabort(): void\n\t{\n\n\t}\n}","import { UploaderFile, AbstractUploadController, UploaderError, Server } from 'ui.uploader.core';\n\nexport default class CloudUploadController extends AbstractUploadController\n{\n\t#fileId: string = null;\n\t#serviceId: string = null;\n\n\tconstructor(server: Server, options = {})\n\t{\n\t\tsuper(server, options);\n\n\t\tthis.#fileId = options.fileId;\n\t\tthis.#serviceId = options.serviceId;\n\t}\n\n\tupload(file: UploaderFile): void\n\t{\n\t\tBX.Disk.ExternalLoader.startLoad({\n\t\t\tfile: {\n\t\t\t\tid: this.#fileId,\n\t\t\t\tservice: this.#serviceId,\n\t\t\t},\n\t\t\tonFinish: (newData): void => {\n\t\t\t\tthis.emit('onUpload', { fileInfo: newData.fileInfo});\n\t\t\t},\n\t\t\tonProgress: (progress): void => {\n\t\t\t\tthis.emit('onProgress', { progress: progress });\n\t\t\t},\n\t\t\tonError: (errors): void => {\n\t\t\t\tthis.emit('onError', { error: UploaderError.createFromAjaxErrors(errors) });\n\t\t\t},\n\t\t});\n\t}\n\n\tabort(): void\n\t{\n\n\t}\n}","import { Runtime, Text, Type } from 'main.core';\nimport { Uploader } from 'ui.uploader.core';\n\nimport { loadDiskFileDialog } from './load-disk-file-dialog';\nimport CloudLoadController from './cloud-load-controller';\nimport CloudUploadController from './cloud-upload-controller';\n\nconst loadingDialogs: Set<string> = new Set();\n\nexport const openCloudFileDialog = (options): void => {\n\n\toptions = Type.isPlainObject(options) ? options : {};\n\tconst dialogId: string = Type.isStringFilled(options.dialogId) ? options.dialogId : `cloud-dialog-${Text.getRandom(5)}`;\n\tconst serviceId: string = Type.isStringFilled(options.serviceId) ? options.serviceId : `gdrive`;\n\tconst onLoad: ?Function = Type.isFunction(options.onLoad) ? options.onLoad : null;\n\tconst onSelect: ?Function = Type.isFunction(options.onSelect) ? options.onSelect : null;\n\tconst onClose: ?Function = Type.isFunction(options.onClose) ? options.onClose : null;\n\tconst uploader: ?Uploader = options.uploader instanceof Uploader ? options.uploader : null;\n\n\tif (loadingDialogs.has(dialogId))\n\t{\n\t\treturn;\n\t}\n\n\tloadingDialogs.add(dialogId);\n\n\tloadDiskFileDialog(dialogId, { service: serviceId, cloudImport: 1 }).then((): void => {\n\t\tloadingDialogs.delete(dialogId);\n\t\tif (onLoad !== null)\n\t\t{\n\t\t\tonLoad();\n\t\t}\n\n\t\tBX.DiskFileDialog.obCallback[dialogId] = {\n\t\t\tsaveButton: (tab, path, selectedItems): void => {\n\t\t\t\tRuntime.loadExtension('disk.legacy.external-loader').then((): void => {\n\t\t\t\t\tObject.values(selectedItems).forEach(item => {\n\t\t\t\t\t\tif (item.type === 'file' && uploader !== null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuploader.addFile({\n\t\t\t\t\t\t\t\tid: item.id,\n\t\t\t\t\t\t\t\tserverFileId: item.id,\n\t\t\t\t\t\t\t\tname: item.name,\n\t\t\t\t\t\t\t\tsize: Text.toNumber(item.sizeInt),\n\t\t\t\t\t\t\t\tloadController: new CloudLoadController(\n\t\t\t\t\t\t\t\t\tuploader.getServer(),\n\t\t\t\t\t\t\t\t\t{ fileId: item.id, serviceId: item.provider }\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tuploadController: new CloudUploadController(\n\t\t\t\t\t\t\t\t\tuploader.getServer(),\n\t\t\t\t\t\t\t\t\t{ fileId: item.id, serviceId: item.provider }\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (onSelect !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tonSelect(tab, path, selectedItems);\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t},\n\t\t\tpopupDestroy: (): void => {\n\t\t\t\tloadingDialogs.delete(dialogId);\n\t\t\t\tif (onClose !== null)\n\t\t\t\t{\n\t\t\t\t\tonClose();\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\n\t\tif (BX.DiskFileDialog.popupWindow === null)\n\t\t{\n\t\t\tBX.DiskFileDialog.openDialog(dialogId);\n\t\t}\n\t});\n};","import { Runtime } from 'main.core';\n\nimport type { BitrixVueComponentProps } from 'ui.vue3';\n\nexport const Loader: BitrixVueComponentProps = {\n\tname: 'Loader',\n\tprops: {\n\t\tsize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 70,\n\t\t},\n\t\tcolor: {\n\t\t\ttype: String,\n\t\t\tdefault: '#2fc6f6',\n\t\t},\n\t\toffset: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t\tmode: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.loader = null;\n\t},\n\tmounted(): void\n\t{\n\t\tRuntime.loadExtension('main.loader').then((exports): void => {\n\t\t\tconst { Loader } = exports;\n\t\t\tthis.loader = new Loader({\n\t\t\t\ttarget: this.$refs.container,\n\t\t\t\tsize: this.size,\n\t\t\t\tcolor: this.color,\n\t\t\t\toffset: this.offset,\n\t\t\t\tmode: this.mode,\n\t\t\t});\n\n\t\t\tthis.loader.show();\n\t\t});\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (this.loader)\n\t\t{\n\t\t\tthis.loader.destroy();\n\t\t\tthis.loader = null;\n\t\t}\n\t},\n\ttemplate: `<span ref=\"container\"></span>`\n};\n","import { Text } from 'main.core';\n\nimport { openDiskFileDialog } from '../helpers/open-disk-file-dialog';\nimport { openCloudFileDialog } from '../helpers/open-cloud-file-dialog';\n\nimport { Loader } from './loader';\n\nimport './css/control-panel.css';\n\nexport const ControlPanel = {\n\tname: 'ControlPanel',\n\tinject: ['userFieldControl', 'uploader', 'getMessage'],\n\tcomponents: {\n\t\tLoader,\n\t},\n\tdata: () => ({\n\t\tshowDialogLoader: false,\n\t\tshowCloudDialogLoader: false,\n\t\tcurrentServiceId: null,\n\t}),\n\tcreated(): void\n\t{\n\t\tthis.fileDialogId = `file-dialog-${Text.getRandom(5)}`;\n\t\tthis.cloudDialogId = `cloud-dialog-${Text.getRandom(5)}`;\n\t\tthis.importServices = this.userFieldControl.getImportServices();\n\t},\n\tmounted(): void\n\t{\n\t\tthis.uploader.assignBrowse(this.$refs.upload);\n\t},\n\tmethods: {\n\t\topenDiskFileDialog(): void\n\t\t{\n\t\t\tif (this.showDialogLoader)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showDialogLoader = true;\n\n\t\t\topenDiskFileDialog({\n\t\t\t\tdialogId: this.fileDialogId,\n\t\t\t\tuploader: this.uploader,\n\t\t\t\tonLoad: (): void => { this.showDialogLoader = false; },\n\t\t\t\tonClose: (): void => { this.showDialogLoader = false; },\n\t\t\t});\n\t\t},\n\n\t\topenCloudFileDialog(serviceId)\n\t\t{\n\t\t\tif (this.showCloudDialogLoader)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentServiceId = serviceId;\n\t\t\tthis.showCloudDialogLoader = true;\n\n\t\t\tconst finalize = (): void => {\n\t\t\t\tthis.showCloudDialogLoader = false;\n\t\t\t\tthis.currentServiceId = null;\n\t\t\t};\n\n\t\t\topenCloudFileDialog({\n\t\t\t\tdialogId: this.cloudDialogId,\n\t\t\t\tuploader: this.uploader,\n\t\t\t\tserviceId,\n\t\t\t\tonLoad: finalize,\n\t\t\t\tonClose: finalize,\n\t\t\t});\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t<div class=\"disk-user-field-panel\">\n\t\t<div class=\"disk-user-field-panel-file-wrap\">\n\t\t\t<div class=\"disk-user-field-panel-card-box disk-user-field-panel-card-file\" ref=\"upload\">\n\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card-icon--upload\">\n\t\t\t\t\t<div class=\"disk-user-field-panel-card-content\">\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ getMessage('DISK_UF_WIDGET_UPLOAD_FILES') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"disk-user-field-panel-card-box disk-user-field-panel-card-file\" @click=\"openDiskFileDialog\">\n\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card-icon--b24\">\n\t\t\t\t\t<div class=\"disk-user-field-panel-card-content\">\n\t\t\t\t\t\t<Loader v-if=\"showDialogLoader\" :offset=\"{ top: '-7px' }\" />\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ getMessage('DISK_UF_WIDGET_MY_DRIVE') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"disk-user-field-panel-card-divider\"></div>\n\t\t\t<div \n\t\t\t\tclass=\"disk-user-field-panel-card-box disk-user-field-panel-card-file\"\n\t\t\t\tv-if=\"importServices['gdrive']\"\n\t\t\t\t@click=\"openCloudFileDialog('gdrive')\"\n\t\t\t>\n\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card-icon--google-docs\">\n\t\t\t\t\t<div class=\"disk-user-field-panel-card-content\">\n\t\t\t\t\t\t<Loader v-if=\"showCloudDialogLoader && currentServiceId === 'gdrive'\" :offset=\"{ top: '-7px' }\" />\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ importServices['gdrive']['name'] }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass=\"disk-user-field-panel-card-box disk-user-field-panel-card-file\"\n\t\t\t\tv-if=\"importServices['office365']\"\n\t\t\t\t@click=\"openCloudFileDialog('office365')\"\n\t\t\t>\n\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card-icon--office365\">\n\t\t\t\t\t<div class=\"disk-user-field-panel-card-content\">\n\t\t\t\t\t\t<Loader v-if=\"showCloudDialogLoader && currentServiceId === 'office365'\" :offset=\"{ top: '-7px' }\" />\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ importServices['office365']['name'] }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass=\"disk-user-field-panel-card-box disk-user-field-panel-card-file\"\n\t\t\t\tv-if=\"importServices['dropbox']\"\n\t\t\t\t@click=\"openCloudFileDialog('dropbox')\"\n\t\t\t>\n\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card-icon--dropbox\">\n\t\t\t\t\t<div class=\"disk-user-field-panel-card-content\">\n\t\t\t\t\t\t<Loader v-if=\"showCloudDialogLoader && currentServiceId === 'dropbox'\" :offset=\"{ top: '-7px' }\" />\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ importServices['dropbox']['name'] }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t`\n};\n","import { Loc, Tag, Dom } from 'main.core';\nimport { Menu, MenuItem } from 'main.popup';\n\nimport type { BitrixVueComponentProps } from 'ui.vue3';\n\nimport './css/document-panel.css';\n\nexport const DocumentPanel: BitrixVueComponentProps = {\n\tname: 'DocumentPanel',\n\tinject: ['uploader', 'userFieldControl', 'getMessage'],\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\tdefault: {}\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.menu = null;\n\t\tthis.currentServiceNode = null;\n\t},\n\tmounted(): void\n\t{\n\t\tconst labelText: string = Loc.getMessage('DISK_UF_WIDGET_EDIT_SERVICE_LABEL') || '';\n\t\tconst macros = '#NAME#';\n\t\tconst position: number = labelText.indexOf(macros);\n\t\tif (position !== -1)\n\t\t{\n\t\t\tconst preText: string = labelText.substring(0, position);\n\t\t\tconst postText: string = labelText.substring(position + macros.length);\n\n\t\t\tthis.currentServiceNode = Tag.render`\n\t\t\t\t<span class=\"disk-user-field-document-current-service\">${\n\t\t\t\t\tthis.userFieldControl.getCurrentDocumentService()?.name\n\t\t\t\t}</span>\n\t\t\t`;\n\n\t\t\tconst label = Tag.render`\n\t\t\t\t<span>\n\t\t\t\t\t<span>${preText}</span>\n\t\t\t\t\t${this.currentServiceNode}\n\t\t\t\t\t<span>${postText}</span>\n\t\t\t\t</span>`\n\t\t\t;\n\n\t\t\tDom.append(label, this.$refs['document-services']);\n\t\t}\n\t},\n\tmethods: {\n\t\tcreateDocument(documentType: string): void\n\t\t{\n\t\t\t// TODO: load disk and disk.document extensions on demand\n\t\t\tif (!BX.Disk.getDocumentService() && BX.Disk.isAvailableOnlyOffice())\n\t\t\t{\n\t\t\t\tBX.Disk.saveDocumentService('onlyoffice');\n\t\t\t}\n\t\t\telse if (!BX.Disk.getDocumentService())\n\t\t\t{\n\t\t\t\tBX.Disk.saveDocumentService('l');\n\t\t\t}\n\n\t\t\tif (BX.Disk.Document.Local.Instance.isSetWorkWithLocalBDisk())\n\t\t\t{\n\t\t\t\tBX.Disk.Document.Local.Instance.createFile({ type: documentType }).then((response): void => {\n\t\t\t\t\tif (response.status === 'success')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.uploader.addFile(\n\t\t\t\t\t\t\t`n${response.object.id}`,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: response.object.name,\n\t\t\t\t\t\t\t\tpreload: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tthis.userFieldControl.showUploaderPanel();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst createProcess = new BX.Disk.Document.CreateProcess({\n\t\t\t\t\ttypeFile: documentType,\n\t\t\t\t\tserviceCode: BX.Disk.getDocumentService(),\n\t\t\t\t\tonAfterSave: (response, fileData): void => {\n\t\t\t\t\t\tif (response.status !== 'success')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (fileData && fileData.object)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.uploader.addFile(\n\t\t\t\t\t\t\t\t`n${fileData.object.id}`,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: fileData.object.name,\n\t\t\t\t\t\t\t\t\tsize: fileData.object.sizeInt,\n\t\t\t\t\t\t\t\t\tpreload: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tthis.userFieldControl.showUploaderPanel();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (response.objectId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.uploader.addFile(\n\t\t\t\t\t\t\t\t`n${response.objectId}`,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: Type.isStringFilled(response.newName) ? response.newName : '',\n\t\t\t\t\t\t\t\t\tpreload: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tthis.userFieldControl.showUploaderPanel();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tcreateProcess.start();\n\t\t\t}\n\t\t},\n\n\t\topenMenu(): void\n\t\t{\n\t\t\tif (this.menu !== null)\n\t\t\t{\n\t\t\t\tthis.menu.destroy();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.menu = new Menu({\n\t\t\t\tbindElement: this.currentServiceNode,\n\t\t\t\tclassName: 'disk-user-field-settings-popup',\n\t\t\t\tangle: true,\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetTop: 5,\n\t\t\t\tcacheable: false,\n\t\t\t\titems: this.getMenuItems(),\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: (): void => {\n\t\t\t\t\t\tthis.menu = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.menu.show();\n\t\t},\n\n\t\tgetMenuItems(): Array\n\t\t{\n\t\t\tconst items = [];\n\t\t\tconst currentServiceCode = this.userFieldControl.getCurrentDocumentService()?.code;\n\t\t\tconst services: Array<{ name: string, code: string }> = Object.values(this.userFieldControl.getDocumentServices());\n\t\t\tservices.forEach((service: { name: string, code: string }): void => {\n\t\t\t\titems.push({\n\t\t\t\t\ttext: service.name,\n\t\t\t\t\tclassName: currentServiceCode === service.code ? 'disk-user-field-item-checked' : 'disk-user-field-item-stub',\n\t\t\t\t\tonclick: (event, item: MenuItem): void => {\n\t\t\t\t\t\tBX.Disk.saveDocumentService(service.code);\n\t\t\t\t\t\tthis.currentServiceNode.textContent = service.name;\n\t\t\t\t\t\tthis.menu.close();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn items;\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"disk-user-field-panel\">\n\t\t\t<div class=\"disk-user-field-panel-doc-wrap\">\n\t\t\t\t<div class=\"disk-user-field-panel-card-box\" @click=\"createDocument('docx')\">\n\t\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card--doc\">\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ getMessage('DISK_UF_WIDGET_CREATE_DOCX') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"disk-user-field-panel-card-box\" @click=\"createDocument('xlsx')\">\n\t\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card--xls\">\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ getMessage('DISK_UF_WIDGET_CREATE_XLSX') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"disk-user-field-panel-card-box\" @click=\"createDocument('pptx')\">\n\t\t\t\t\t<div class=\"disk-user-field-panel-card disk-user-field-panel-card--ppt\">\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-icon\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-btn\"></div>\n\t\t\t\t\t\t<div class=\"disk-user-field-panel-card-name\">{{ getMessage('DISK_UF_WIDGET_CREATE_PPTX') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"disk-user-field-create-document-by-service\" @click=\"openMenu\" ref=\"document-services\"></div>\n\t\t</div>\n\t`\n};\n","import { Loc } from 'main.core';\nimport { Popup } from 'main.popup';\n\nimport type { BaseEvent } from 'main.core.events';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\n\nimport './css/insert-into-text-button.css';\n\nexport const InsertIntoTextButton: BitrixVueComponentProps = {\n\tname: 'InsertIntoTextButton',\n\tinject: ['uploader', 'postForm'],\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\tdefault: {}\n\t\t},\n\t},\n\tmethods: {\n\t\tclick(): void\n\t\t{\n\t\t\tthis.postForm.getParser().insertFile(this.item);\n\t\t},\n\n\t\thandleMouseEnter(event: MouseEvent): void\n\t\t{\n\t\t\tif (this.hintPopup)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst targetNode: HTMLElement = event.currentTarget;\n\t\t\tconst targetNodeWidth: number = targetNode.offsetWidth;\n\n\t\t\tthis.hintPopup = new Popup({\n\t\t\t\tcontent: Loc.getMessage('DISK_UF_WIDGET_INSERT_INTO_THE_TEXT'),\n\t\t\t\tcacheable: false,\n\t\t\t\tanimation: 'fading-slide',\n\t\t\t\tbindElement: targetNode,\n\t\t\t\toffsetTop: 0,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t},\n\t\t\t\tdarkMode: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: (): void => {\n\t\t\t\t\t\tthis.hintPopup.destroy();\n\t\t\t\t\t\tthis.hintPopup = null;\n\t\t\t\t\t},\n\t\t\t\t\tonShow: (event: BaseEvent): void => {\n\t\t\t\t\t\tconst popup = event.getTarget();\n\t\t\t\t\t\tconst popupWidth = popup.getPopupContainer().offsetWidth;\n\t\t\t\t\t\tconst offsetLeft: number = (targetNodeWidth / 2) - (popupWidth / 2);\n\t\t\t\t\t\tconst angleShift: number = Popup.getOption('angleLeftOffset') - Popup.getOption('angleMinTop');\n\n\t\t\t\t\t\tpopup.setAngle({ offset: popupWidth / 2 - angleShift });\n\t\t\t\t\t\tpopup.setOffset({ offsetLeft: offsetLeft + Popup.getOption('angleLeftOffset') });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.hintPopup.show();\n\t\t},\n\n\t\thandleMouseLeave(event: Event): void\n\t\t{\n\t\t\tif (this.hintPopup)\n\t\t\t{\n\t\t\t\tthis.hintPopup.close();\n\t\t\t\tthis.hintPopup = null;\n\t\t\t}\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"disk-user-field-insert-into-text-button\"\n\t\t\t:class=\"[{ '--inserted': item.tileWidgetData.selected }]\"\n\t\t\t@mouseenter=\"handleMouseEnter\" \n\t\t\t@mouseleave=\"handleMouseLeave\" \n\t\t\t@click=\"click\"\n\t\t></div>\n\t`\n};\n","import { Type, Loc } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { VueUploaderComponent } from 'ui.uploader.vue';\nimport { TileWidgetComponent, TileWidgetSlot, TileWidgetOptions, TileWidgetItem } from 'ui.uploader.tile-widget';\n\nimport UserFieldWidget from './user-field-widget';\nimport UserFieldControl from './user-field-control';\nimport ItemMenu from './item-menu';\nimport SettingsMenu from './settings-menu';\n\nimport { ControlPanel } from './components/control-panel';\nimport { DocumentPanel } from './components/document-panel';\nimport { InsertIntoTextButton } from './components/insert-into-text-button';\n\nimport './css/user-field-widget-component.css';\n\nimport type { UploaderOptions } from 'ui.uploader.core';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport type { Menu } from 'main.popup';\nimport { UserFieldWidgetOptions } from './user-field-widget-options';\n\n/**\n * @memberof BX.Disk.Uploader\n */\nexport const UserFieldWidgetComponent: BitrixVueComponentProps = {\n\tname: 'UserFieldWidget',\n\textends: VueUploaderComponent,\n\tcomponents: {\n\t\tTileWidgetComponent,\n\t\tDocumentPanel,\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tcustomUploaderOptions: UserFieldWidget.getDefaultUploaderOptions(),\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\tconst options: UserFieldWidgetOptions = this.widgetOptions;\n\t\treturn {\n\t\t\tcontrolVisibility: Type.isBoolean(options.controlVisibility) ? options.controlVisibility : true,\n\t\t\tuploaderPanelVisibility: Type.isBoolean(options.uploaderPanelVisibility) ? options.uploaderPanelVisibility : true,\n\t\t\tdocumentPanelVisibility: Type.isBoolean(options.documentPanelVisibility) ? options.documentPanelVisibility : false,\n\t\t};\n\t},\n\tprovide(): Object<string, any>\n\t{\n\t\treturn {\n\t\t\tuserFieldControl: this.userFieldControl,\n\t\t\tpostForm: this.userFieldControl.getMainPostForm(),\n\t\t\tgetMessage: this.getMessage,\n\t\t}\n\t},\n\tbeforeCreate(): void\n\t{\n\t\tthis.userFieldControl = new UserFieldControl(this);\n\t},\n\tmethods: {\n\t\tgetMessage(code: string, replacements?: Object<string, string>): ?string\n\t\t{\n\t\t\treturn Loc.getMessage(code, replacements);\n\t\t},\n\n\t\tshow(forceUpdate = false): void\n\t\t{\n\t\t\tif (forceUpdate)\n\t\t\t{\n\t\t\t\tthis.$refs.container.style.display = 'block';\n\t\t\t}\n\n\t\t\tthis.controlVisibility = true;\n\t\t},\n\n\t\thide(forceUpdate = false): void\n\t\t{\n\t\t\tif (forceUpdate)\n\t\t\t{\n\t\t\t\tthis.$refs.container.style.display = 'none';\n\t\t\t}\n\n\t\t\tthis.controlVisibility = false;\n\t\t},\n\n\t\tshowUploaderPanel(): void\n\t\t{\n\t\t\tthis.uploaderPanelVisibility = true;\n\t\t},\n\n\t\thideUploaderPanel(): void\n\t\t{\n\t\t\tthis.uploaderPanelVisibility = false;\n\t\t},\n\n\t\tshowDocumentPanel(): void\n\t\t{\n\t\t\tthis.documentPanelVisibility = true;\n\t\t},\n\n\t\thideDocumentPanel(): void\n\t\t{\n\t\t\tthis.documentPanelVisibility = false;\n\t\t},\n\n\t\tenableAutoCollapse(): void\n\t\t{\n\t\t\tthis.$refs.tileWidget.enableAutoCollapse();\n\t\t},\n\n\t\tgetUploaderOptions(): UploaderOptions\n\t\t{\n\t\t\treturn UserFieldWidget.prepareUploaderOptions(this.uploaderOptions);\n\t\t},\n\t},\n\tcomputed: {\n\t\ttileWidgetOptions(): TileWidgetOptions {\n\t\t\tconst tileWidgetOptions: TileWidgetOptions =\n\t\t\t\tType.isPlainObject(this.widgetOptions.tileWidgetOptions)\n\t\t\t\t\t? Object.assign({}, this.widgetOptions.tileWidgetOptions)\n\t\t\t\t\t: {}\n\t\t\t;\n\n\t\t\ttileWidgetOptions.slots = Type.isPlainObject(tileWidgetOptions.slots) ? tileWidgetOptions.slots : {};\n\t\t\ttileWidgetOptions.slots[TileWidgetSlot.AFTER_TILE_LIST] = ControlPanel;\n\t\t\tif (this.userFieldControl.getMainPostForm())\n\t\t\t{\n\t\t\t\ttileWidgetOptions.slots[TileWidgetSlot.ITEM_EXTRA_ACTION] = InsertIntoTextButton;\n\t\t\t}\n\n\t\t\ttileWidgetOptions.showItemMenuButton = true;\n\t\t\ttileWidgetOptions.events = {\n\t\t\t\t'TileItem:onMenuCreate': (event: BaseEvent): void => {\n\t\t\t\t\tconst { item, menu }: { item: TileWidgetItem, menu: Menu } = event.getData();\n\t\t\t\t\tconst itemMenu: ItemMenu = new ItemMenu(this.userFieldControl, item, menu);\n\t\t\t\t\titemMenu.build();\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst settingsMenu: SettingsMenu = new SettingsMenu(this.userFieldControl);\n\t\t\tif (settingsMenu.hasItems())\n\t\t\t{\n\t\t\t\ttileWidgetOptions.showSettingsButton = true;\n\t\t\t\ttileWidgetOptions.events['SettingsButton:onClick'] = (event: BaseEvent): void => {\n\t\t\t\t\tconst { button } = event.getData();\n\t\t\t\t\tsettingsMenu.toggle(button);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn tileWidgetOptions;\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"disk-user-field-control\" \n\t\t\t:class=\"[{ '--has-files': this.items.length > 0 }]\"\n\t\t\t:style=\"{ display: controlVisibility ? 'block' : 'none' }\"\n\t\t\tref=\"container\"\n\t\t>\n\t\t\t<div \n\t\t\t\tclass=\"disk-user-field-uploader-panel\"\n\t\t\t\t:class=\"[{ '--hidden': !uploaderPanelVisibility }]\"\n\t\t\t\tref=\"uploader-container\"\n\t\t\t>\n\t\t\t\t<TileWidgetComponent\n\t\t\t\t\t:widgetOptions=\"tileWidgetOptions\" \n\t\t\t\t\t:uploader-adapter=\"adapter\"\n\t\t\t\t\tref=\"tileWidget\"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div \n\t\t\t\tclass=\"disk-user-field-create-document\"\n\t\t\t\tv-if=\"this.userFieldControl.canCreateDocuments() && !this.userFieldControl.getMainPostForm() && !documentPanelVisibility\"\n\t\t\t\t@click=\"documentPanelVisibility = true\"\n\t\t\t>{{ getMessage('DISK_UF_WIDGET_CREATE_DOCUMENT') }}</div>\n\n\t\t\t<div \n\t\t\t\tclass=\"disk-user-field-document-panel\"\n\t\t\t\t:class=\"{ '--single': this.userFieldControl.getMainPostForm() !== null }\"\n\t\t\t\tref=\"document-container\"\n\t\t\t\tv-if=\"this.userFieldControl.canCreateDocuments() && documentPanelVisibility\"\n\t\t\t>\n\t\t\t\t<DocumentPanel />\n\t\t\t</div>\n\t\t</div>\n\t\t`\n\t,\n};","import { Type } from 'main.core';\nimport { VueUploaderWidget } from 'ui.uploader.vue';\n\nimport { UserFieldWidgetComponent } from './user-field-widget-component';\n\nimport type { UploaderOptions } from 'ui.uploader.core';\nimport type { UserFieldWidgetOptions } from './user-field-widget-options';\n\n/**\n * @memberof BX.Disk.Uploader\n */\nexport default class UserFieldWidget extends VueUploaderWidget\n{\n\tconstructor(uploaderOptions: UploaderOptions, options: UserFieldWidgetOptions)\n\t{\n\t\tconst widgetOptions: UserFieldWidgetOptions = Type.isPlainObject(options) ? Object.assign({}, options) : {};\n\t\tsuper(UserFieldWidget.prepareUploaderOptions(uploaderOptions), widgetOptions);\n\t}\n\n\tdefineComponent(): ?Function\n\t{\n\t\treturn UserFieldWidgetComponent;\n\t}\n\n\tstatic prepareUploaderOptions(uploaderOptions: UploaderOptions): UploaderOptions\n\t{\n\t\treturn Object.assign(\n\t\t\t{},\n\t\t\tUserFieldWidget.getDefaultUploaderOptions(),\n\t\t\tType.isPlainObject(uploaderOptions) ? uploaderOptions : {}\n\t\t);\n\t}\n\n\tstatic getDefaultUploaderOptions(): UploaderOptions\n\t{\n\t\treturn {\n\t\t\tcontroller: 'disk.uf.integration.diskUploaderController',\n\t\t\tmultiple: true,\n\t\t\tmaxFileSize: null,\n\t\t};\n\t}\n}"],"names":["HtmlParser","constructor","form","syncHighlightsDebounced","Runtime","debounce","syncHighlights","EventEmitter","emit","getEventObject","getParser","id","init","bind","parse","unparse","getHtmlEditor","insertFile","item","bbDelimiter","isImage","htmlDelimiter","createItemBBCode","createItemHtml","removeFile","GetViewMode","doc","GetIframeDoc","Object","keys","bxTags","forEach","tagId","tag","serverFileId","node","getElementById","parentNode","removeChild","SaveContent","content","GetContent","replace","str","foundId","objectId","attachedId","items","getUserFieldControl","getItems","find","customData","SetContent","Focus","selectItem","tileWidgetData","selected","deselectItem","inserted","Set","add","hasInsertedItems","has","getPhotoTemplateMode","setPhotoTemplate","SetBxTag","hideContextMenu","fileId","imageSrc","bbCode","previewUrl","serverPreviewUrl","previewWidth","serverPreviewWidth","previewHeight","serverPreviewHeight","renderWidth","renderHeight","ratioWidth","ratioHeight","ratio","Math","min","useOriginalSize","width","height","Text","encode","name","fileType","htmlEditor","test","bxTag","toInteger","MainPostForm","userFieldControl","options","setEventNamespace","eventObject","subscribeFromOptions","events","subscribeOnce","canCreateDocuments","Event","ready","selectFileButton","event","BaseEvent","data","compatData","deselectFileButton","selectCreateDocumentButton","container","closest","setAttribute","deselectCreateDocumentButton","removeAttribute","postForm","setTimeout","console","error","isReady","subscribe","getEditor","Promise","resolve","reject","clipboardEvent","getData","clipboardData","stopImmediatePropagation","isFilePasted","preventDefault","getFilesFromDataTransfer","then","files","file","getUploader","addFile","FileEvent","LOAD_ERROR","UPLOAD_ERROR","LOAD_COMPLETE","UPLOAD_COMPLETE","getTarget","getItem","getId","showUploaderPanel","catch","PostForm","Reflection","getClass","result","repo","editor","Type","isArrayFilled","getCompatData","status","isArray","shift","hide","fieldName","getHiddenFieldName","ids","map","storage","values","handler","selectFile","tab","path","size","sizeInt","removeFiles","image","src","getPreviewUrl","getPreviewWidth","getPreviewHeight","html","UploaderError","dragEvent","dataTransfer","addFiles","adapter","getAdapter","clear","userFields","userField","isPlainObject","isStringFilled","setPhotoTemplateMode","nextTick","getFile","getFiles","length","enableAutoCollapse","fileIds","filter","loaded","addedFiles","onLoad","fileOptions","Tag","render","Loc","getMessage","BODY","ID","hasAttribute","showDocumentPanel","instances","Map","UserFieldControl","widgetComponent","widgetOptions","photoTemplateFieldName","allowDocumentFieldName","setDocumentEdit","removeAllowDocumentEditInput","disableLocalEdit","BX","Disk","Document","Local","Instance","disable","getHiddenFieldsContainer","photoTemplate","photoTemplateMode","Dom","append","isElementNode","onReady","mainPostFormId","getRandom","toLowerCase","set","getById","get","getInstances","settings","Extension","getSettings","getMainPostForm","$nextTick","show","hideUploaderPanel","hideDocumentPanel","removeFromServer","canAllowDocumentEdit","canItemAllowEdit","getAllowDocumentEditInput","selector","querySelector","input","remove","allowEdit","value","setCustomData","canChangePhotoTemplate","getPhotoTemplate","mode","getDocumentServices","documentHandlers","getCurrentDocumentService","currentServiceCode","getDocumentService","isAvailableOnlyOffice","getImportServices","importHandlers","loadDiskFileDialog","dialogName","params","loadExtension","handleInit","unsubscribe","DiskFileDialog","Ajax","getDialogInitUrl","url","Uri","addParam","ItemMenu","menu","build","firstItemId","getMenuItems","getPopupWindow","setMaxWidth","addMenuItem","text","sizeFormatted","disabled","delimiter","onclick","close","className","menuItem","getMenuWindow","renameItem","openFolderDialog","rename","newName","runAction","autoCorrect","generateUniqueName","response","object","setName","showModalWithStatusAction","wish","obCallback","saveButton","selectedItems","folderByPath","selectedItem","folderId","rootObjectId","toFolderId","setServerFileId","popupWindow","openDialog","exports","Button","ButtonSize","ButtonColor","CancelButton","handleKeydown","code","handleRenameClick","nameWithoutExtension","getFilenameWithoutExtension","textareaValue","textarea","trim","renameBtn","setWaiting","newFilename","getFileExtension","color","PRIMARY","SMALL","cancelBtn","submenu","getSubMenu","textareaItem","getMenuItem","setText","showSubMenu","SettingsMenu","getMenu","button","Menu","bindElement","getContainer","angle","autoHide","offsetLeft","cacheable","onShow","select","onDestroy","deselect","toggle","isShown","hasItems","loadingDialogs","openDiskFileDialog","dialogId","isFunction","onSelect","onClose","uploader","Uploader","delete","preload","popupDestroy","CloudLoadController","AbstractLoadController","server","load","progress","abort","CloudUploadController","AbstractUploadController","serviceId","upload","ExternalLoader","startLoad","service","onFinish","newData","fileInfo","onProgress","onError","errors","createFromAjaxErrors","openCloudFileDialog","cloudImport","type","toNumber","loadController","getServer","provider","uploadController","Loader","props","Number","default","String","offset","created","loader","mounted","target","$refs","beforeUnmount","destroy","template","ControlPanel","inject","components","showDialogLoader","showCloudDialogLoader","currentServiceId","fileDialogId","cloudDialogId","importServices","assignBrowse","methods","finalize","DocumentPanel","currentServiceNode","labelText","macros","position","indexOf","preText","substring","postText","label","createDocument","documentType","saveDocumentService","isSetWorkWithLocalBDisk","createFile","createProcess","CreateProcess","typeFile","serviceCode","onAfterSave","fileData","start","openMenu","offsetTop","services","push","textContent","InsertIntoTextButton","click","handleMouseEnter","hintPopup","targetNode","currentTarget","targetNodeWidth","offsetWidth","Popup","animation","bindOptions","darkMode","popup","popupWidth","getPopupContainer","angleShift","getOption","setAngle","setOffset","handleMouseLeave","UserFieldWidgetComponent","extends","VueUploaderComponent","TileWidgetComponent","setup","customUploaderOptions","UserFieldWidget","getDefaultUploaderOptions","controlVisibility","isBoolean","uploaderPanelVisibility","documentPanelVisibility","provide","beforeCreate","replacements","forceUpdate","style","display","tileWidget","getUploaderOptions","prepareUploaderOptions","uploaderOptions","computed","tileWidgetOptions","assign","slots","TileWidgetSlot","AFTER_TILE_LIST","ITEM_EXTRA_ACTION","showItemMenuButton","itemMenu","settingsMenu","showSettingsButton","VueUploaderWidget","defineComponent","controller","multiple","maxFileSize"],"mappings":";;;;;CACgD;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAKhD,CAAe,MAAMA,UAAU,CAC/B;GAOCC,WAAW,CAACC,IAAkB,EAC9B;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OAPsB;;KAAI;OAAA;OAAA,OACd;;KAAW;OAAA;OAAA,OACR;;KAAqB;OAAA;OAAA,OAClB;;KAA+C,KACjEC,uBAAuB,GAAa,IAAI;KAIvC,4CAAI,kBAASD,IAAI;KAEjB,IAAI,CAACC,uBAAuB,GAAGC,iBAAO,CAACC,QAAQ,CAAC,IAAI,CAACC,cAAc,EAAE,GAAG,EAAE,IAAI,CAAC;;;KAG/EC,6BAAY,CAACC,IAAI,CAAC,4CAAI,gBAAOC,cAAc,EAAE,EAAE,kBAAkB,EAAE,IAAI,CAACC,SAAS,EAAE,CAAC;;GAGrFA,SAAS,GACT;KACC,OAAO;OACNC,EAAE,0CAAE,IAAI,uBAAU;OAClBC,IAAI,EAAE,4CAAI,gBAAOC,IAAI,CAAC,IAAI,CAAC;OAC3BC,KAAK,EAAE,4CAAI,kBAAQD,IAAI,CAAC,IAAI,CAAC;OAC7BE,OAAO,EAAE,4CAAI,sBAAUF,IAAI,CAAC,IAAI;MAChC;;;;CAIH;CACA;CACA;GACCG,aAAa,GACb;KACC,OAAO,4CAAI,gBAAOA,aAAa,EAAE;;GAGlCC,UAAU,CAACC,IAAoB,EAC/B;KACC,MAAMC,WAAmB,GAAGD,IAAI,CAACE,OAAO,GAAG,IAAI,GAAG,GAAG;KACrD,MAAMC,aAAqB,GAAGH,IAAI,CAACE,OAAO,GAAG,MAAM,GAAG,QAAQ;KAE9Db,6BAAY,CAACC,IAAI,CAAC,IAAI,CAACQ,aAAa,EAAE,EAAE,iBAAiB,EAAE,CAC1DG,WAAW,GAAG,IAAI,CAACG,gBAAgB,CAACJ,IAAI,CAAC,GAAGC,WAAW,EACvDE,aAAa,GAAG,IAAI,CAACE,cAAc,CAACL,IAAI,CAAC,GAAGG,aAAa,CACzD,CAAC;KAEF,IAAI,CAACf,cAAc,EAAE;;GAGtBkB,UAAU,CAACN,IAAoB,EAC/B;KACC,IAAI,IAAI,CAACF,aAAa,EAAE,CAACS,WAAW,EAAE,KAAK,SAAS,EACpD;OACC,MAAMC,GAAG,GAAG,IAAI,CAACV,aAAa,EAAE,CAACW,YAAY,EAAE;OAC/CC,MAAM,CAACC,IAAI,CAAC,IAAI,CAACb,aAAa,EAAE,CAACc,MAAM,CAAC,CAACC,OAAO,CAAEC,KAAa,IAAK;SACnE,MAAMC,GAAG,GAAG,IAAI,CAACjB,aAAa,EAAE,CAACc,MAAM,CAACE,KAAK,CAAC;SAC9C,IAAIC,GAAG,CAACA,GAAG,6CAAK,IAAI,uBAAU,IAAIA,GAAG,CAACC,YAAY,KAAKhB,IAAI,CAACgB,YAAY,EACxE;WACC,MAAMC,IAAI,GAAGT,GAAG,CAACU,cAAc,CAACJ,KAAK,CAAC;WACtC,IAAIG,IAAI,EACR;aACCA,IAAI,CAACE,UAAU,CAACC,WAAW,CAACH,IAAI,CAAC;;;QAGnC,CAAC;OAEF,IAAI,CAACnB,aAAa,EAAE,CAACuB,WAAW,EAAE;MAClC,MAED;OACC,MAAMC,OAAO,GAAG,IAAI,CAACxB,aAAa,EAAE,CAACyB,UAAU,EAAE,CAACC,OAAO,yCACxD,IAAI,qBACJ,CAACC,GAAG,EAAEC,OAAO,KAAa;SACzB,MAAM;WAAEC,QAAQ;WAAEC;UAAY,2CAAG,IAAI,oBAASF,OAAO,CAAC;SACtD,MAAMG,KAAuB,GAAG,4CAAI,gBAAOC,mBAAmB,EAAE,CAACC,QAAQ,EAAE;SAC3E,MAAM/B,IAAoB,GAAG6B,KAAK,CAACG,IAAI,CAAEhC,IAAoB,IAAK;WACjE,OAAOA,IAAI,CAACgB,YAAY,KAAKY,UAAU,IAAI5B,IAAI,CAACiC,UAAU,CAACN,QAAQ,KAAKA,QAAQ;UAChF,CAAC;SAEF,OAAO3B,IAAI,GAAG,EAAE,GAAGyB,GAAG;QACtB,CACD;OAED,IAAI,CAAC3B,aAAa,EAAE,CAACoC,UAAU,CAACZ,OAAO,CAAC;OACxC,IAAI,CAACxB,aAAa,EAAE,CAACqC,KAAK,EAAE;;KAG7B,IAAI,CAAC/C,cAAc,EAAE;;GAGtBgD,UAAU,CAACpC,IAAoB,EAC/B;KACCA,IAAI,CAACqC,cAAc,CAACC,QAAQ,GAAG,IAAI;;GAGpCC,YAAY,CAACvC,IAAoB,EACjC;KACCA,IAAI,CAACqC,cAAc,CAACC,QAAQ,GAAG,KAAK;;GAGrClD,cAAc,GACd;KACC,MAAMoB,GAAG,GAAG,IAAI,CAACV,aAAa,EAAE,CAACW,YAAY,EAAE;KAC/C,MAAM+B,QAA8B,GAAG,IAAIC,GAAG,EAAE;KAChD/B,MAAM,CAACC,IAAI,CAAC,IAAI,CAACb,aAAa,EAAE,CAACc,MAAM,CAAC,CAACC,OAAO,CAAEC,KAAa,IAAW;OACzE,MAAMC,GAAG,GAAG,IAAI,CAACjB,aAAa,EAAE,CAACc,MAAM,CAACE,KAAK,CAAC;OAC9C,IAAIC,GAAG,CAACA,GAAG,6CAAK,IAAI,uBAAU,IAAIP,GAAG,CAACU,cAAc,CAACJ,KAAK,CAAC,EAC3D;SACC0B,QAAQ,CAACE,GAAG,CAAC3B,GAAG,CAACC,YAAY,CAAC;;MAE/B,CAAC;KAEF,IAAI2B,gBAAgB,GAAG,KAAK;KAE5B,MAAMd,KAAuB,GAAG,4CAAI,gBAAOC,mBAAmB,EAAE,CAACC,QAAQ,EAAE;KAC3EF,KAAK,CAAChB,OAAO,CAAEb,IAAoB,IAAW;OAC7C,IAAIwC,QAAQ,CAACI,GAAG,CAAC5C,IAAI,CAACgB,YAAY,CAAC,EACnC;SACC2B,gBAAgB,GAAG,IAAI;SACvB,IAAI,CAACP,UAAU,CAACpC,IAAI,CAAC;QACrB,MAED;SACC,IAAI,CAACuC,YAAY,CAACvC,IAAI,CAAC;;MAExB,CAAC;KAEF,IAAI,4CAAI,gBAAO8B,mBAAmB,EAAE,CAACe,oBAAoB,EAAE,KAAK,MAAM,EACtE;OACC,4CAAI,gBAAOf,mBAAmB,EAAE,CAACgB,gBAAgB,CAACH,gBAAgB,GAAG,SAAS,GAAG,MAAM,CAAC;;;GAI1FtC,cAAc,CAACL,IAAoB,EAAEP,EAAU,EAC/C;KACC,MAAMqB,KAAK,GAAG,IAAI,CAAChB,aAAa,EAAE,CAACiD,QAAQ,CAAC,KAAK,EAAE;OAClDhC,GAAG,0CAAE,IAAI,uBAAU;OACnBC,YAAY,EAAEhB,IAAI,CAACgB,YAAY;OAC/BgC,eAAe,EAAE,IAAI;OACrBC,MAAM,EAAEjD,IAAI,CAACgB;MACb,CAAC;KAEF,IAAIhB,IAAI,CAACE,OAAO,EAChB;OACC,MAAMgD,QAAQ,GAAG,IAAI,CAACpD,aAAa,EAAE,CAACqD,MAAM,GAAGnD,IAAI,CAACoD,UAAU,GAAGpD,IAAI,CAACqD,gBAAgB;OACtF,MAAMC,YAAY,GAAG,IAAI,CAACxD,aAAa,EAAE,CAACqD,MAAM,GAAGnD,IAAI,CAACsD,YAAY,GAAGtD,IAAI,CAACuD,kBAAkB;OAC9F,MAAMC,aAAa,GAAG,IAAI,CAAC1D,aAAa,EAAE,CAACqD,MAAM,GAAGnD,IAAI,CAACwD,aAAa,GAAGxD,IAAI,CAACyD,mBAAmB;OAEjG,MAAMC,WAAW,GAAG,GAAG,CAAC;OACxB,MAAMC,YAAY,GAAG,GAAG,CAAC;OACzB,MAAMC,UAAkB,GAAGF,WAAW,GAAGJ,YAAY;OACrD,MAAMO,WAAmB,GAAGF,YAAY,GAAGH,aAAa;OACxD,MAAMM,KAAa,GAAGC,IAAI,CAACC,GAAG,CAACJ,UAAU,EAAEC,WAAW,CAAC;OAEvD,MAAMI,eAAe,GAAGH,KAAK,GAAG,CAAC,CAAC;OAClC,MAAMI,KAAK,GAAGD,eAAe,GAAGX,YAAY,GAAGA,YAAY,GAAGQ,KAAK;OACnE,MAAMK,MAAM,GAAGF,eAAe,GAAGT,aAAa,GAAGA,aAAa,GAAGM,KAAK;OAEtE,OAAQ,uCAAsCI,KAAM,aAAYC,MAAO,sBAAqBC,cAAI,CAACC,MAAM,CAACrE,IAAI,CAACgB,YAAY,CAAE,SAAQF,KAAM,UAASoC,QAAS,YAAWkB,cAAI,CAACC,MAAM,CAACrE,IAAI,CAACsE,IAAI,CAAE,8BAA6B;MAC1N,MACI,IAAItE,IAAI,CAACiC,UAAU,CAACsC,QAAQ,KAAK,QAAQ,EAC9C;OACC,OAAQ,mFAAkFH,cAAI,CAACC,MAAM,CAACrE,IAAI,CAACgB,YAAY,CAAE,SAAQF,KAAM,mHAAkH;;KAG1P,OAAQ,kDAAiDsD,cAAI,CAACC,MAAM,CAACrE,IAAI,CAACgB,YAAY,CAAE,SAAQF,KAAM,8EAA6EsD,cAAI,CAACC,MAAM,CAACrE,IAAI,CAACsE,IAAI,CAAE,SAAQ;;GAGnNlE,gBAAgB,CAACJ,IAAoB,EACrC;KACC,OAAO,4CAAI,cAAMwB,OAAO,CAAC,MAAM,EAAExB,IAAI,CAACgB,YAAY,CAAC;;CAuErD;CAAC,gBApEMwD,UAAU,EAChB;;CACC;CACA,iBAEMlD,OAAO,EACd;GACC,IAAI,CAAC,4CAAI,oBAASmD,IAAI,CAACnD,OAAO,CAAC,EAC/B;KACC,OAAOA,OAAO;;GAGf,IAAI,CAACrC,uBAAuB,EAAE;GAE9B,OAAOqC,OAAO,CAACE,OAAO,yCACrB,IAAI,qBACJ,CAACC,GAAG,EAAEhC,EAAE,KAAa;KACpB,MAAM;OAAEkC,QAAQ;OAAEC;MAAY,2CAAG,IAAI,oBAASnC,EAAE,CAAC;KAEjD,MAAMoC,KAAuB,GAAG,4CAAI,gBAAOC,mBAAmB,EAAE,CAACC,QAAQ,EAAE;KAC3E,MAAM/B,IAAoB,GAAG6B,KAAK,CAACG,IAAI,CAAEhC,IAAoB,IAAK;OACjE,OAAOA,IAAI,CAACgB,YAAY,KAAKY,UAAU,IAAI5B,IAAI,CAACiC,UAAU,CAACN,QAAQ,KAAKA,QAAQ;MAChF,CAAC;KAEF,IAAI3B,IAAI,EACR;OACC,IAAI,CAACoC,UAAU,CAACpC,IAAI,CAAC;OAErB,OAAO,IAAI,CAACK,cAAc,CAACL,IAAI,EAAEP,EAAE,CAAC;;KAGrC,OAAOgC,GAAG;IACV,CACD;CACF;CAAC,mBAEQiD,KAAK,EACd;GACC,MAAM;KAAE1D;IAAc,GAAG0D,KAAK;GAE9B,MAAM7C,KAAuB,GAAG,4CAAI,gBAAOC,mBAAmB,EAAE,CAACC,QAAQ,EAAE;GAC3E,MAAM/B,IAAoB,GAAG6B,KAAK,CAACG,IAAI,CAAEhC,IAAoB,IAAc;KAC1E,OAAOA,IAAI,CAACgB,YAAY,KAAKA,YAAY;IACzC,CAAC;GAEF,IAAIhB,IAAI,EACR;KACC,OAAO,IAAI,CAACI,gBAAgB,CAACJ,IAAI,CAAC;;GAGnC,OAAO,EAAE;CACV;CAAC,kBAEOP,EAAU,EAClB;GACC,IAAIkC,QAAiB,GAAG,IAAI;GAC5B,IAAIC,UAAmB,GAAG,IAAI;GAC9B,IAAInC,EAAE,CAAC,CAAC,CAAC,KAAK,GAAG,EACjB;KACCkC,QAAQ,GAAGyC,cAAI,CAACO,SAAS,CAAClF,EAAE,CAAC+B,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;IAC9C,MAED;KACCI,UAAU,GAAGwC,cAAI,CAACO,SAAS,CAAClF,EAAE,CAAC;;GAGhC,OAAO;KAAEkC,QAAQ;KAAEC;IAAY;CAChC;;;;ACvPD,CAIuC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAMvC,CAAe,MAAMgD,YAAY,SAASvF,6BAAY,CACtD;GAQCN,WAAW,CAAC8F,gBAAkC,EAAEC,OAA4B,EAC5E;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OAT6B;;KAAI;OAAA;OAAA,OACL;;KAAI;OAAA;OAAA,OACb;;KAAI;OAAA;OAAA,OACN;;KAAI;OAAA;OAAA,OAChB;;KAAI;OAAA;OAAA,OACR;;KAKT,IAAI,CAACC,iBAAiB,CAAC,8BAA8B,CAAC;KAEtD,4CAAI,0CAAqBF,gBAAgB;KACzC,4CAAI,gCAAgBC,OAAO,CAACE,WAAW;KAEvC,4CAAI;KAEJ,IAAI,CAACC,oBAAoB,CAACH,OAAO,CAACI,MAAM,CAAC;KAEzC,IAAI,CAACC,aAAa,CAAC,SAAS,EAAE,MAAY;OACzC,IAAI,4CAAI,wCAAmBC,kBAAkB,EAAE,EAC/C;SACC,4CAAI;;MAEL,CAAC;KAEFC,eAAK,CAACC,KAAK,CAAC,4CAAI,8CAAsB3F,IAAI,CAAC,IAAI,CAAC,CAAC;;GAGlDmC,mBAAmB,GACnB;KACC,+CAAO,IAAI;;GAGZtC,SAAS,GACT;KACC,+CAAO,IAAI;;;;CAIb;CACA;CACA;GACCM,aAAa,GACb;KACC,+CAAO,IAAI;;GAGZP,cAAc,GACd;KACC,+CAAO,IAAI;;GAGZgG,gBAAgB,GAChB;KACC,MAAMC,KAAgB,GAAG,IAAIC,0BAAS,CAAC;OACtCC,IAAI,EAAE,MAAM;;OAEZC,UAAU,EAAE,CAAC,mBAAmB;MAChC,CAAC;KAEFtG,6BAAY,CAACC,IAAI,yCAAC,IAAI,+BAAe,mBAAmB,EAAEkG,KAAK,CAAC;;GAGjEI,kBAAkB,GAClB;KACC,MAAMJ,KAAgB,GAAG,IAAIC,0BAAS,CAAC;OACtCC,IAAI,EAAE,MAAM;;OAEZC,UAAU,EAAE,CAAC,mBAAmB;MAChC,CAAC;KAEFtG,6BAAY,CAACC,IAAI,yCAAC,IAAI,+BAAe,mBAAmB,EAAEkG,KAAK,CAAC;;GAGjEK,0BAA0B,GAC1B;KACC,4CAAI,IAAI,iDACR;OACC,MAAMC,SAAsB,GAAG,4CAAI,gDAAuBC,OAAO,CAAC,2BAA2B,CAAC;OAC9F,IAAID,SAAS,EACb;SACCA,SAAS,CAACE,YAAY,CAAC,uBAAuB,EAAE,QAAQ,CAAC;;;;GAK5DC,4BAA4B,GAC5B;KACC,4CAAI,IAAI,iDACR;OACC,MAAMH,SAAsB,GAAG,4CAAI,gDAAuBC,OAAO,CAAC,2BAA2B,CAAC;OAC9F,IAAID,SAAS,EACb;SACCA,SAAS,CAACI,eAAe,CAAC,uBAAuB,CAAC;;;;CAubtD;CAAC,iCAjbA;GACC,MAAMC,QAAQ,2CAAG,IAAI,+BAAe;GACpC,IAAIA,QAAQ,KAAK,IAAI,EACrB;KACCC,UAAU,CAAC,MAAM;OAChB,MAAMD,QAAQ,2CAAG,IAAI,+BAAe;OACpC,IAAIA,QAAQ,EACZ;SACC,4CAAI,8CAAsBA,QAAQ;QAClC,MAED;SACCE,OAAO,CAACC,KAAK,CAAC,uCAAuC,CAAC;;MAEvD,EAAE,GAAG,CAAC;IACP,MAED;KACC,4CAAI,8CAAsBH,QAAQ;;CAEpC;CAAC,+BAEoBA,QAAkB,EACvC;GACC,IAAIA,QAAQ,CAACI,OAAO,EACpB;KACC,4CAAI,oBAAOJ,QAAQ;IACnB,MAED;KACC9G,6BAAY,CAACmH,SAAS,CAACL,QAAQ,EAAE,kBAAkB,EAAE,MAAY;OAChE,4CAAI,oBAAOA,QAAQ;MACnB,CAAC;;CAEJ;CAAC,kBAMKA,QAAQ,EACd;GACC,4CAAI;GAEJ,4CAAI,8BAAeA,QAAQ,CAACM,SAAS,EAAE;GACvC,4CAAI,8BAAe,IAAI3H,UAAU,CAAC,IAAI,CAAC;GAEvCO,6BAAY,CAACmH,SAAS,yCAAC,IAAI,6BAAc,kBAAkB,EAAGhB,KAAgB,IAAK;KAClF,4CAAI,4BAAavG,uBAAuB,EAAE;IAC1C,CAAC;GAEFI,6BAAY,CAACmH,SAAS,yCAAC,IAAI,6BAAc,6BAA6B,EAAGhB,KAAgB,IAAK;KAC7F,OAAO,IAAIkB,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAW;OAC7C,MAAMC,cAA8B,GAAGrB,KAAK,CAACsB,OAAO,EAAE,CAACD,cAAc;OACrE,MAAME,aAA2B,GAAGF,cAAc,CAACE,aAAa;OAEhEF,cAAc,CAACG,wBAAwB,EAAE,CAAC;OAC1C,IAAI,CAACD,aAAa,IAAI,CAACE,6BAAY,CAACF,aAAa,CAAC,EAClD;SACCJ,OAAO,EAAE;SAET;;OAGDE,cAAc,CAACK,cAAc,EAAE,CAAC;OAChC1B,KAAK,CAAC0B,cAAc,EAAE,CAAC;;OAEvBC,yCAAwB,CAACJ,aAAa,CAAC,CACrCK,IAAI,CAAEC,KAAa,IAAW;SAC9BA,KAAK,CAACxG,OAAO,CAAEyG,IAAU,IAAW;WACnC,IAAI,CAACxF,mBAAmB,EAAE,CAACyF,WAAW,EAAE,CAACC,OAAO,CAACF,IAAI,EAAE;aACtDpC,MAAM,EAAE;eACP,CAACuC,0BAAS,CAACC,UAAU,GAAG,MAAM,EAAE;eAChC,CAACD,0BAAS,CAACE,YAAY,GAAG,MAAM,EAAE;eAClC,CAACF,0BAAS,CAACG,aAAa,GAAIpC,KAAgB,IAAW;;;;;;;;;gBAStD;eACD,CAACiC,0BAAS,CAACI,eAAe,GAAIrC,KAAgB,IAAW;iBACxD,MAAM8B,IAAkB,GAAG9B,KAAK,CAACsC,SAAS,EAAE;iBAC5C,MAAM9H,IAAoB,GAAG,IAAI,CAAC8B,mBAAmB,EAAE,CAACiG,OAAO,CAACT,IAAI,CAACU,KAAK,EAAE,CAAC;iBAC7E,IAAIhI,IAAI,EACR;mBACC,IAAI,CAAC8B,mBAAmB,EAAE,CAACmG,iBAAiB,EAAE;mBAC9C,IAAI,CAACzI,SAAS,EAAE,CAACO,UAAU,CAACC,IAAI,CAAC;;;;YAIpC,CAAC;UACF,CAAC;SAEF2G,OAAO,EAAE;QACT,CAAC,CACDuB,KAAK,CAAC,MAAY;SAClBvB,OAAO,EAAE;QACT,CAAC;MAEH,CAAC;IACF,CAAC;GAEF,IAAI,CAACrH,IAAI,CAAC,SAAS,CAAC;GAEpB,4CAAI,sBAAW,IAAI;CACpB;CAAC,yBAGD;GACC,MAAM6I,QAAe,GAAGC,oBAAU,CAACC,QAAQ,CAAC,kBAAkB,CAAC;GAC/D,IAAI,CAACF,QAAQ,EACb;KACC,OAAO,IAAI;;GAGZ,IAAIG,MAAM,GAAG,IAAI;GACjBH,QAAQ,CAACI,IAAI,CAAC1H,OAAO,CAAE2H,MAAM,IAAK;KACjC,IAAIA,MAAM,CAACjJ,cAAc,EAAE,KAAK,IAAI,CAACA,cAAc,EAAE,EACrD;OACC+I,MAAM,GAAGE,MAAM;;IAEhB,CAAC;GAEF,OAAOF,MAAM;CACd;CAAC,6BAGD;;GAECjJ,6BAAY,CAACmH,SAAS,CAAC,IAAI,CAACjH,cAAc,EAAE,EAAE,mBAAmB,EAAGiG,KAAgB,IAAW;KAC9F,IAAIiD,cAAI,CAACC,aAAa,CAAClD,KAAK,CAACmD,aAAa,EAAE,CAAC,IAAInD,KAAK,CAACmD,aAAa,EAAE,CAAC,CAAC,CAAC,KAAK,mBAAmB,EACjG;;OAEC;;KAGD,MAAMC,MAAM,GAAGH,cAAI,CAACI,OAAO,CAACrD,KAAK,CAACsB,OAAO,EAAE,CAAC,GAAGtB,KAAK,CAACsB,OAAO,EAAE,CAACgC,KAAK,EAAE,GAAGtD,KAAK,CAACsB,OAAO,EAAE;KACxF,IAAI8B,MAAM,KAAK,MAAM,EACrB;OACC,IAAI,CAAC9G,mBAAmB,EAAE,CAACmG,iBAAiB,EAAE;MAC9C,MAED;OACC,IAAI,CAACnG,mBAAmB,EAAE,CAACiH,IAAI,EAAE;;IAElC,CAAC;;;GAGF1J,6BAAY,CAACmH,SAAS,CAAC,IAAI,CAACjH,cAAc,EAAE,EAAE,2BAA2B,EAAGiG,KAAgB,IAAc;KACzG,OAAO,IAAIkB,OAAO,CAAEC,OAAO,IAAW;OACrC,4CAAI,IAAI,qBACR;SACC,4CAAI,wDAA2BnB,KAAK,EAAE4B,IAAI,CAAC,MAAMT,OAAO,EAAE,CAAC;QAC3D,MAED;SACC,IAAI,CAACxB,aAAa,CAAC,SAAS,EAAE,MAAY;WACzC,4CAAI,wDAA2BK,KAAK,EAAE4B,IAAI,CAAC,MAAMT,OAAO,EAAE,CAAC;UAC3D,CAAC;;MAEH,CAAC;IACF,CAAC;;;;;GAKFtH,6BAAY,CAACmH,SAAS,CAAC,IAAI,CAACjH,cAAc,EAAE,EAAE,sBAAsB,EAAGiG,KAAgB,IAAW;KACjG,MAAME,IAAI,GAAGF,KAAK,CAACsB,OAAO,EAAE;KAE5B,MAAMkC,SAAiB,GAAG,IAAI,CAAClH,mBAAmB,EAAE,CAACyF,WAAW,EAAE,CAAC0B,kBAAkB,EAAE;KACvF,MAAMC,GAAG,GAAG,IAAI,CAACpH,mBAAmB,EAAE,CAACC,QAAQ,EAAE,CAACoH,GAAG,CAAEnJ,IAAoB,IAAsB;OAChG,OAAOA,IAAI,CAACgB,YAAY;MACxB,CAAC;KAEF0E,IAAI,CAACsD,SAAS,CAAC,GAAG;OACjBI,OAAO,EAAE,MAAM;OACfrI,GAAG,EAAE,qBAAqB;OAC1BsI,MAAM,EAAEH,GAAG;OACXI,OAAO,EAAE;SACRC,UAAU,EAAE,CAACC,GAAG,EAAEC,IAAI,EAAEnH,QAAQ,KAAW;WAC1C5B,MAAM,CAAC2I,MAAM,CAAC/G,QAAQ,CAAC,CAACzB,OAAO,CAAEb,IAAI,IAAW;aAC/C,IAAI,CAAC8B,mBAAmB,EAAE,CAACyF,WAAW,EAAE,CAACC,OAAO,CAAC;eAChDxG,YAAY,EAAEhB,IAAI,CAACP,EAAE;eACrB6E,IAAI,EAAEtE,IAAI,CAACsE,IAAI;eACfoF,IAAI,EAAE1J,IAAI,CAAC2J;cACX,CAAC;YACF,CAAC;UACF;SACDC,WAAW,EAAE,MAAY;WACxB,IAAI,CAAC9H,mBAAmB,EAAE,CAACyF,WAAW,EAAE,CAACqC,WAAW,EAAE;;;MAGxD;IACD,CAAC;;;GAGFvK,6BAAY,CAACmH,SAAS,CAAC,IAAI,CAACjH,cAAc,EAAE,EAAE,kBAAkB,EAAGiG,KAAgB,IAAW;KAC7FA,KAAK,CAACwB,wBAAwB,EAAE;KAChC,IAAI,CAAClF,mBAAmB,EAAE,CAACyF,WAAW,EAAE,CAACC,OAAO,CAAChC,KAAK,CAACsB,OAAO,EAAE,EAAE;OACjE5B,MAAM,EAAE;SACP,CAACuC,0BAAS,CAACI,eAAe,GAAIrC,KAAgB,IAAW;WACxD,MAAM8B,IAAkB,GAAG9B,KAAK,CAACsC,SAAS,EAAE;WAC5C,MAAM9H,IAAoB,GAAG,IAAI,CAAC8B,mBAAmB,EAAE,CAACiG,OAAO,CAACT,IAAI,CAACU,KAAK,EAAE,CAAC;WAC7E,IAAIhI,IAAI,EACR;aACC,IAAI,CAAC8B,mBAAmB,EAAE,CAACmG,iBAAiB,EAAE;aAC9C,IAAI,CAACzI,SAAS,EAAE,CAACO,UAAU,CAACC,IAAI,CAAC;;;;MAIpC,CAAC;IACF,CAAC;;;GAGFX,6BAAY,CAACmH,SAAS,CAAC,IAAI,CAACjH,cAAc,EAAE,EAAE,kBAAkB,EAAGiG,KAAgB,IAAW;KAC7FA,KAAK,CAACwB,wBAAwB,EAAE;KAEhC,OAAO,IAAIN,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAW;OAC7C,IAAI,CAAC9E,mBAAmB,EAAE,CAACyF,WAAW,EAAE,CAACC,OAAO,CAAChC,KAAK,CAACsB,OAAO,EAAE,EAAE;SACjE5B,MAAM,EAAE;WACP,CAACuC,0BAAS,CAACC,UAAU,GAAIlC,KAAgB,IAAW;aACnD,MAAMc,KAAoB,GAAGd,KAAK,CAACsB,OAAO,EAAE,CAACR,KAAK;aAClDM,MAAM,CAACN,KAAK,CAAC;YACb;WACD,CAACmB,0BAAS,CAACE,YAAY,GAAG,MAAOnC,KAAgB,IAAW;aAC3D,MAAMc,KAAoB,GAAGd,KAAK,CAACsB,OAAO,EAAE,CAACR,KAAK;aAClDM,MAAM,CAACN,KAAK,CAAC;YACb;WACD,CAACmB,0BAAS,CAACI,eAAe,GAAIrC,KAAgB,IAAW;aACxD,MAAM8B,IAAkB,GAAG9B,KAAK,CAACsC,SAAS,EAAE;aAC5C,MAAM9H,IAAoB,GAAG,IAAI,CAAC8B,mBAAmB,EAAE,CAACiG,OAAO,CAACT,IAAI,CAACU,KAAK,EAAE,CAAC;aAC7E,IAAIhI,IAAI,EACR;eACC,IAAI,CAACR,SAAS,EAAE,CAACJ,cAAc,EAAE;eAEjCuH,OAAO,CAAC;iBACPkD,KAAK,EAAE;mBACNC,GAAG,EAAExC,IAAI,CAACyC,aAAa,EAAE;mBACzB7F,KAAK,EAAEoD,IAAI,CAAC0C,eAAe,EAAE;mBAC7B7F,MAAM,EAAEmD,IAAI,CAAC2C,gBAAgB;kBAC7B;iBACDC,IAAI,EAAE,IAAI,CAAC1K,SAAS,EAAE,CAACa,cAAc,CAACL,IAAI;gBAC1C,CAAC;cACF,MAED;eACC4G,MAAM,CAAC,IAAIuD,8BAAa,CAAC,mBAAmB,CAAC,CAAC;;;;QAIjD,CAAC;MACF,CAAC;IACF,CAAC;;;GAGF9K,6BAAY,CAACmH,SAAS,CAAC,IAAI,CAACjH,cAAc,EAAE,EAAE,mBAAmB,EAAGiG,KAAgB,IAAW;;KAE9FA,KAAK,CAACwB,wBAAwB,EAAE;IAChC,CAAC;GAEF3H,6BAAY,CAACmH,SAAS,CAAC,IAAI,CAACjH,cAAc,EAAE,EAAE,oBAAoB,EAAGiG,KAAgB,IAAW;KAC/FA,KAAK,CAACwB,wBAAwB,EAAE;KAEhC,MAAMoD,SAAoB,GAAG5E,KAAK,CAACsB,OAAO,EAAE,CAACtB,KAAK;KAElD2B,yCAAwB,CAACiD,SAAS,CAACC,YAAY,CAAC,CAC9CjD,IAAI,CAAEC,KAAa,IAAW;OAC9B,IAAI,CAACvF,mBAAmB,EAAE,CAACyF,WAAW,EAAE,CAAC+C,QAAQ,CAACjD,KAAK,CAAC;MACxD,CAAC,CACDa,KAAK,CAAC,MAAM,EAAE,CAAC;IAEjB,CAAC;CACH;CAAC,+BAGD;;GAEC,MAAMqC,OAA2B,GAAG,IAAI,CAACzI,mBAAmB,EAAE,CAAC0I,UAAU,EAAE;GAC3ED,OAAO,CAAC/D,SAAS,CAAC,YAAY,EAAE,MAAY;KAC3CnH,6BAAY,CAACC,IAAI,CAAC,IAAI,CAACC,cAAc,EAAE,EAAE,kCAAkC,CAAC;IAC5E,CAAC;GAEFgL,OAAO,CAAC/D,SAAS,CAAC,eAAe,EAAGhB,KAA0C,IAAW;KACxFnG,6BAAY,CAACC,IAAI,CAAC,IAAI,CAACC,cAAc,EAAE,EAAE,kCAAkC,CAAC;KAC5E,MAAMS,IAAoB,GAAGwF,KAAK,CAACsB,OAAO,EAAE,CAAC9G,IAAI;KAEjD,IAAI,IAAI,CAACR,SAAS,EAAE,EACpB;OACC,IAAI,CAACA,SAAS,EAAE,CAACc,UAAU,CAACN,IAAI,CAAC;;IAElC,CAAC;CACH;CAAC,oCAMyBwF,KAAgB,EAC1C;GACC,IAAI,CAAC1D,mBAAmB,EAAE,CAAC2I,KAAK,EAAE;GAElC,MAAM,GAAGC,UAAU,CAAC,GAAGlF,KAAK,CAACsB,OAAO,EAAE;GACtC,MAAMkC,SAAiB,GAAG,IAAI,CAAClH,mBAAmB,EAAE,CAACyF,WAAW,EAAE,CAAC0B,kBAAkB,EAAE;GACvF,MAAM0B,SAAS,GACdD,UAAU,IAAIA,UAAU,CAAC1B,SAAS,CAAC,IAAI0B,UAAU,CAAC1B,SAAS,CAAC,CAAC,cAAc,CAAC,KAAK,WAAW,GACzF0B,UAAU,CAAC1B,SAAS,CAAC,GACrB,IACH;GAED,IAAI2B,SAAS,KAAK,IAAI,EACtB;;KAEC,IACClC,cAAI,CAACmC,aAAa,CAACD,SAAS,CAAC,aAAa,CAAC,CAAC,IACzClC,cAAI,CAACoC,cAAc,CAACF,SAAS,CAAC,aAAa,CAAC,CAAC,gBAAgB,CAAC,CAAC,EAEnE;OACC,IAAI,CAAC7I,mBAAmB,EAAE,CAACgJ,oBAAoB,CAAC,QAAQ,CAAC;OACzD,IAAI,CAAChJ,mBAAmB,EAAE,CAACgB,gBAAgB,CAAC6H,SAAS,CAAC,aAAa,CAAC,CAAC,gBAAgB,CAAC,CAAC;MACvF,MAED;OACC,IAAI,CAAC7I,mBAAmB,EAAE,CAACgJ,oBAAoB,CAAC,MAAM,CAAC;;IAExD,MAED;;KAEC,IAAI,CAAChJ,mBAAmB,EAAE,CAACgJ,oBAAoB,CAAC,MAAM,CAAC;KACvD,IAAI,CAAChJ,mBAAmB,EAAE,CAACgB,gBAAgB,CAAC,MAAM,CAAC;;GAGpD,IAAI6H,SAAS,KAAK,IAAI,EACtB;KACC,OAAOjE,OAAO,CAACC,OAAO,EAAE;;;;;GAKzB,IAAI8B,cAAI,CAACI,OAAO,CAAC8B,SAAS,CAAC,OAAO,CAAC,CAAC,EACpC;KACC,OAAO,4CAAI,wCAAmBI,QAAQ,EAAE,CAAC3D,IAAI,CAAC,MAAM;OACnDuD,SAAS,CAAC,OAAO,CAAC,CAAC9J,OAAO,CAACyG,IAAI,IAAI;SAClC,IAAI,CAAC,IAAI,CAACxF,mBAAmB,EAAE,CAACyF,WAAW,EAAE,CAACyD,OAAO,CAAC1D,IAAI,CAACtG,YAAY,CAAC,EACxE;WACC,IAAI,CAACc,mBAAmB,EAAE,CAACyF,WAAW,EAAE,CAACC,OAAO,CAACF,IAAI,CAAC;;QAEvD,CAAC;OAEF,IAAI,IAAI,CAACxF,mBAAmB,EAAE,CAACyF,WAAW,EAAE,CAAC0D,QAAQ,EAAE,CAACC,MAAM,GAAG,CAAC,EAClE;SACC,4CAAI,wCAAmBC,kBAAkB,EAAE;;MAE5C,CAAC;IACF,MACI,IAAI1C,cAAI,CAACC,aAAa,CAACiC,SAAS,CAAC,OAAO,CAAC,CAAC,EAC/C;KACC,OAAO,4CAAI,wCAAmBI,QAAQ,EAAE,CAAC3D,IAAI,CAAC,MAAe;OAC5D,OAAO,IAAIV,OAAO,CAAEC,OAAO,IAAW;SACrC,IAAIyE,OAAiB,GAAGT,SAAS,CAAC,OAAO,CAAC;SAC1CS,OAAO,GAAGA,OAAO,CAACC,MAAM,CAAE5L,EAAU,IAAK,CAAC,IAAI,CAACqC,mBAAmB,EAAE,CAACyF,WAAW,EAAE,CAACyD,OAAO,CAACvL,EAAE,CAAC,CAAC;SAE/F,IAAI6L,MAAM,GAAG,CAAC;SACd,IAAIC,UAA0B,GAAG,EAAE;SACnC,MAAMC,MAAM,GAAG,MAAM;WACpBF,MAAM,EAAE;WACR,IAAIA,MAAM,KAAKC,UAAU,CAACL,MAAM,EAChC;aACCvE,OAAO,EAAE;;UAEV;SAED,MAAMzB,MAAM,GAAG;WACd,CAACuC,0BAAS,CAACG,aAAa,GAAG4D,MAAM;WACjC,CAAC/D,0BAAS,CAACC,UAAU,GAAG8D;UACxB;SAED,MAAMC,WAAW,GAAGL,OAAO,CAACjC,GAAG,CAAE1J,EAAU,IAAK,CAACA,EAAE,EAAE;WAAEyF;UAAQ,CAAC,CAAC;SACjE,IAAIuG,WAAW,CAACP,MAAM,GAAG,CAAC,EAC1B;WACCK,UAAU,GAAG,IAAI,CAACzJ,mBAAmB,EAAE,CAACyF,WAAW,EAAE,CAAC+C,QAAQ,CAACmB,WAAW,CAAC;WAC3E,IAAIF,UAAU,CAACL,MAAM,KAAK,CAAC,EAC3B;aACCvE,OAAO,EAAE;YACT,MAED;aACC,4CAAI,wCAAmBwE,kBAAkB,EAAE;;UAE5C,MAED;WACCxE,OAAO,EAAE;;QAEV,CAAC;MACF,CAAC;;GAGH,OAAOD,OAAO,CAACC,OAAO,EAAE;CACzB;CAAC,qCAGD;GACC,4CAAI,kDAAyB+E,aAAG,CAACC,MAAM,cAAC;mBACzB,CAAqC;;MAElD,CAAmD;;GAErD,GAJiB,4CAAI,0CAAoBhM,IAAI,CAAC,IAAI,CAAC,EAE/CiM,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC,CAEnD;GAEDxM,6BAAY,CAACC,IAAI,CAChB,IAAI,CAACC,cAAc,EAAE,EACrB,aAAa,EACb,CAAC;KAAEuM,IAAI,0CAAE,IAAI,+CAAsB;KAAEC,EAAE,EAAE;IAAiB,EAAE,MAAM,CAAC,CACnE;CACF;CAAC,+BAGD;GACC,MAAMjG,SAAsB,GAAG,4CAAI,gDAAuBC,OAAO,CAAC,2BAA2B,CAAC;GAC9F,IAAID,SAAS,IAAIA,SAAS,CAACkG,YAAY,CAAC,uBAAuB,CAAC,EAChE;KACC,IAAI,CAAClK,mBAAmB,EAAE,CAACiH,IAAI,EAAE;IACjC,MAED;KACC,IAAI,CAACjH,mBAAmB,EAAE,CAACmK,iBAAiB,EAAE;;CAEhD;;;;;AChiBD,CAUA,MAAMC,SAAwC,GAAG,IAAIC,GAAG,EAAE;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE3D,CAAe,MAAMC,gBAAgB,SAAS/M,6BAAY,CAC1D;GAaCN,WAAW,CAACsN,eAAe,EAC3B;KACC,KAAK,EAAE;KAAC;OAAA;OAAA,OAdM;;KAAI;OAAA;OAAA,OACY;;KAAI;OAAA;OAAA,OACL;;KAAI;OAAA;OAAA,OAEA;;KAAI;OAAA;OAAA,OAEJ;;KAAI;OAAA;OAAA,OACE;;KAAI;OAAA;OAAA,OACJ;;KAAM;OAAA;OAAA,OAE3B;;KAKlB,IAAI,CAACtH,iBAAiB,CAAC,8BAA8B,CAAC;KAEtD,4CAAI,wCAAoBsH,eAAe;KACvC,4CAAI,wBAAYA,eAAe,CAAC9B,OAAO;KAEvC,MAAMzF,OAA+B,GACpC2D,cAAI,CAACmC,aAAa,CAACyB,eAAe,CAACC,aAAa,CAAC,GAAGD,eAAe,CAACC,aAAa,GAAG,EACpF;KAED,4CAAI,sDACH7D,cAAI,CAACoC,cAAc,CAAC/F,OAAO,CAACyH,sBAAsB,CAAC,GAAGzH,OAAO,CAACyH,sBAAsB,GAAG,IACvF;KAED,4CAAI,sDACH9D,cAAI,CAACoC,cAAc,CAAC/F,OAAO,CAAC0H,sBAAsB,CAAC,GAAG1H,OAAO,CAAC0H,sBAAsB,GAAG,IACvF;KAED,4CAAI,sBAAUhG,SAAS,CAAC,iBAAiB,EAAGhB,KAA0C,IAAW;OAChG,MAAMxF,IAAoB,GAAGwF,KAAK,CAACsB,OAAO,EAAE,CAAC9G,IAAI;OACjD,IAAI,CAACyM,eAAe,CAACzM,IAAI,CAAC;MAC1B,CAAC;KAEF,4CAAI,sBAAUwG,SAAS,CAAC,eAAe,EAAGhB,KAA0C,IAAW;OAC9F,MAAMxF,IAAoB,GAAGwF,KAAK,CAACsB,OAAO,EAAE,CAAC9G,IAAI;OACjD,IAAI,CAAC0M,4BAA4B,CAAC1M,IAAI,CAAC;MACvC,CAAC;KAEF,IAAI8E,OAAO,CAAC6H,gBAAgB,EAC5B;;OAECC,EAAE,CAACC,IAAI,CAACC,QAAQ,CAACC,KAAK,CAACC,QAAQ,CAACC,OAAO,EAAE;;KAG1C,IAAI,4CAAI,wDAA6B,IAAI,IAAI,IAAI,CAAC1F,WAAW,EAAE,CAAC2F,wBAAwB,EAAE,KAAK,IAAI,EACnG;OACC,4CAAI,8CAAuBxB,aAAG,CAACC,MAAM,oBAAC;;cAE7B,CAA+B;eAC9B,CAA8E;;;KAGvF,2CAJU,IAAI,qDACHlD,cAAI,CAACoC,cAAc,CAAC/F,OAAO,CAACqI,aAAa,CAAC,GAAGrI,OAAO,CAACqI,aAAa,GAAG,MAAM,CAGrF;OAEF,IAAI,CAACrC,oBAAoB,CAAChG,OAAO,CAACsI,iBAAiB,CAAC;OAEpDC,aAAG,CAACC,MAAM,yCAAC,IAAI,6CAAsB,IAAI,CAAC/F,WAAW,EAAE,CAAC2F,wBAAwB,EAAE,CAAC;;KAGpF,MAAMlI,WAAyB,GAAGyD,cAAI,CAAC8E,aAAa,CAACzI,OAAO,CAACE,WAAW,CAAC,GAAGF,OAAO,CAACE,WAAW,GAAG,IAAI;KACtG,IAAIA,WAAW,EACf;OACC,4CAAI,kCAAiB,IAAIJ,YAAY,CACpC,IAAI,EACJ;SACCI,WAAW;SACXE,MAAM,EAAE;WACPsI,OAAO,EAAE,MAAY;aACpB,IAAI,CAACjG,WAAW,EAAE,CAAC+C,QAAQ,CAACxF,OAAO,CAACuC,KAAK,CAAC;aAC1C,IAAI,IAAI,CAACE,WAAW,EAAE,CAAC0D,QAAQ,EAAE,CAACC,MAAM,GAAG,CAAC,EAC5C;eACC,IAAI,CAACjD,iBAAiB,EAAE;eACxB,IAAI,CAACkD,kBAAkB,EAAE;;;;QAI5B,CACD;MACD,MAED;OACC,IAAI,CAAC5D,WAAW,EAAE,CAAC+C,QAAQ,CAACxF,OAAO,CAACuC,KAAK,CAAC;;KAG3C,4CAAI,cACHoB,cAAI,CAACoC,cAAc,CAAC/F,OAAO,CAAC2I,cAAc,CAAC,GACxC3I,OAAO,CAAC2I,cAAc,GACrB,sBAAqBrJ,cAAI,CAACsJ,SAAS,EAAE,CAACC,WAAW,EAAG,EACxD;KAEDzB,SAAS,CAAC0B,GAAG,yCAAC,IAAI,aAAM,IAAI,CAAC;;GAG9B,OAAOC,OAAO,CAACpO,EAAU,EACzB;KACC,OAAOyM,SAAS,CAAC4B,GAAG,CAACrO,EAAE,CAAC,IAAI,IAAI;;GAGjC,OAAOsO,YAAY,GACnB;KACC,OAAO,CAAC,GAAG7B,SAAS,CAAC7C,MAAM,EAAE,CAAC;;GAG/BjE,kBAAkB,GAClB;KACC,MAAM4I,QAAQ,GAAGC,mBAAS,CAACC,WAAW,CAAC,iCAAiC,CAAC;KACzE,MAAM9I,kBAAkB,GAAG4I,QAAQ,CAACF,GAAG,CAAC,oBAAoB,EAAE,KAAK,CAAC;KAEpE,OAAO1I,kBAAkB,IAAI,4CAAI,sCAAkBkH,aAAa,CAAClH,kBAAkB,KAAK,KAAK;;GAG9FoF,UAAU,GACV;KACC,+CAAO,IAAI;;GAGZ2D,eAAe,GACf;KACC,+CAAO,IAAI;;GAGZpM,QAAQ,GACR;KACC,OAAO,4CAAI,sBAAUA,QAAQ,EAAE;;GAGhCgG,OAAO,CAACtI,EAAE,EACV;KACC,OAAO,4CAAI,sBAAUsI,OAAO,CAACtI,EAAE,CAAC;;GAGjCwL,QAAQ,GACR;KACC,OAAO,4CAAI,sBAAU1D,WAAW,EAAE,CAAC0D,QAAQ,EAAE;;GAG9CD,OAAO,CAACvL,EAAU,EAClB;KACC,OAAO,4CAAI,sBAAU8H,WAAW,EAAE,CAACyD,OAAO,CAACvL,EAAE,CAAC;;GAG/C8H,WAAW,GACX;KACC,OAAO,4CAAI,sBAAUA,WAAW,EAAE;;GAGnCwD,QAAQ,GACR;KACC,OAAO,4CAAI,sCAAkBqD,SAAS,EAAE;;GAGzCC,IAAI,GACJ;KACC,4CAAI,sCAAkBA,IAAI,CAAC,IAAI,CAAC;;GAGjCtF,IAAI,GACJ;KACC,4CAAI,sCAAkBA,IAAI,CAAC,IAAI,CAAC;KAChC,IAAI,CAACuF,iBAAiB,EAAE;KACxB,IAAI,CAACC,iBAAiB,EAAE;;GAGzBtG,iBAAiB,GACjB;KACC,IAAI,CAACoG,IAAI,EAAE;KACX,IAAI,CAACE,iBAAiB,EAAE;KACxB,4CAAI,sCAAkBtG,iBAAiB,EAAE;KAEzC,IAAI,IAAI,CAACkG,eAAe,EAAE,EAC1B;OACC,IAAI,CAACA,eAAe,EAAE,CAAC5I,gBAAgB,EAAE;;;GAI3C+I,iBAAiB,GACjB;KACC,4CAAI,sCAAkBA,iBAAiB,EAAE;KAEzC,IAAI,IAAI,CAACH,eAAe,EAAE,EAC1B;OACC,IAAI,CAACA,eAAe,EAAE,CAACvI,kBAAkB,EAAE;;;GAI7CqG,iBAAiB,GACjB;KACC,IAAI,CAAC,IAAI,CAAC7G,kBAAkB,EAAE,EAC9B;OACC;;KAGD,IAAI,CAACiJ,IAAI,EAAE;KACX,IAAI,CAACC,iBAAiB,EAAE;KACxB,4CAAI,sCAAkBrC,iBAAiB,EAAE;KAEzC,IAAI,IAAI,CAACkC,eAAe,EAAE,EAC1B;OACC,IAAI,CAACA,eAAe,EAAE,CAACtI,0BAA0B,EAAE;;;GAIrD0I,iBAAiB,GACjB;KACC,IAAI,CAAC,IAAI,CAACnJ,kBAAkB,EAAE,EAC9B;OACC;;KAGD,4CAAI,sCAAkBmJ,iBAAiB,EAAE;KAEzC,IAAI,IAAI,CAACJ,eAAe,EAAE,EAC1B;OACC,IAAI,CAACA,eAAe,EAAE,CAAClI,4BAA4B,EAAE;;;GAIvDwE,KAAK,GACL;KACC,IAAI,CAAClD,WAAW,EAAE,CAACqC,WAAW,CAAC;OAAE4E,gBAAgB,EAAE;MAAO,CAAC;;GAG5DrD,kBAAkB,GAClB;KACC,4CAAI,sCAAkBA,kBAAkB,EAAE;;GAG3CsD,oBAAoB,GACpB;KACC,OAAO,4CAAI,wDAA6B,IAAI,IAAI,IAAI,CAAClH,WAAW,EAAE,CAAC2F,wBAAwB,EAAE,KAAK,IAAI;;GAGvGwB,gBAAgB,CAAC1O,IAAoB,EACrC;KACC,OACC,IAAI,CAACyO,oBAAoB,EAAE,IACxBzO,IAAI,CAACiC,UAAU,CAAC,YAAY,CAAC,KAAK,IAAI,IACtCjC,IAAI,CAACiC,UAAU,CAAC,WAAW,CAAC,KAAK,IAAI;;GAI1C0M,yBAAyB,CAAC3O,IAAoB,EAC9C;KACC,MAAM4O,QAAQ,GAAI,eAAY,wCAAE,IAAI,mDAAyB,IAAG5O,IAAI,CAACgB,YAAa,KAAI;KAEtF,IAAI,IAAI,CAACuG,WAAW,EAAE,CAAC2F,wBAAwB,EAAE,KAAK,IAAI,EAC1D;OACC,OAAO,IAAI,CAAC3F,WAAW,EAAE,CAAC2F,wBAAwB,EAAE,CAAC2B,aAAa,CAACD,QAAQ,CAAC;;KAG7E,OAAO,IAAI;;GAGZlC,4BAA4B,CAAC1M,IAAoB,EACjD;KACC,MAAM8O,KAAuB,GAAG,IAAI,CAACH,yBAAyB,CAAC3O,IAAI,CAAC;KACpE,IAAI8O,KAAK,KAAK,IAAI,EAClB;OACCzB,aAAG,CAAC0B,MAAM,CAACD,KAAK,CAAC;;;GAInBrC,eAAe,CAACzM,IAAoB,EAAEgP,SAAmB,GAAG,IAAI,EAChE;KACC,IAAI,CAAC,IAAI,CAACN,gBAAgB,CAAC1O,IAAI,CAAC,EAChC;OACC;;KAGD,IAAI8O,KAAuB,GAAG,IAAI,CAACH,yBAAyB,CAAC3O,IAAI,CAAC;KAClE,IAAI8O,KAAK,KAAK,IAAI,EAClB;OACCA,KAAK,GAAGpD,aAAG,CAACC,MAAM,kBAAC,gBAAa,CAA+B,IAAC,CAAoB,qBAAmB,2CAArE,IAAI,qDAA4B3L,IAAI,CAACgB,YAAY,CAAqB;OACxGqM,aAAG,CAACC,MAAM,CAACwB,KAAK,EAAE,IAAI,CAACvH,WAAW,EAAE,CAAC2F,wBAAwB,EAAE,CAAC;;KAGjE8B,SAAS,GAAGA,SAAS,KAAK,IAAI,GAAGhP,IAAI,CAACiC,UAAU,CAAC,WAAW,CAAC,KAAK,IAAI,GAAG+M,SAAS;KAClFF,KAAK,CAACG,KAAK,GAAGD,SAAS,GAAG,CAAC,GAAG,CAAC;KAE/B,MAAM1H,IAAkB,GAAG,IAAI,CAAC0D,OAAO,CAAChL,IAAI,CAACP,EAAE,CAAC;KAChD6H,IAAI,CAAC4H,aAAa,CAAC,WAAW,EAAEF,SAAS,CAAC;;GAG3CG,sBAAsB,GACtB;KACC,OAAO,4CAAI,wDAA6B,IAAI;;GAG7CrM,gBAAgB,CAACwB,IAAY,EAC7B;KACC,IAAImE,cAAI,CAACoC,cAAc,CAACvG,IAAI,CAAC,IAAI,4CAAI,gDAAyB,IAAI,EAClE;OACC,4CAAI,4CAAqB2K,KAAK,GAAG3K,IAAI;;;GAIvC8K,gBAAgB,GAChB;KACC,OAAO,4CAAI,gDAAyB,IAAI,GAAG,4CAAI,4CAAqBH,KAAK,GAAG,EAAE;;GAG/EnE,oBAAoB,CAACuE,IAAuB,EAC5C;KACC,IAAIA,IAAI,KAAK,MAAM,IAAIA,IAAI,KAAK,QAAQ,EACxC;OACC,4CAAI,4CAAsBA,IAAI;;;GAIhCxM,oBAAoB,GACpB;KACC,+CAAO,IAAI;;GAGZyM,mBAAmB,GACnB;KACC,MAAMtB,QAAQ,GAAGC,mBAAS,CAACC,WAAW,CAAC,iCAAiC,CAAC;KACzE,MAAMqB,gBAAgB,GAAGvB,QAAQ,CAACF,GAAG,CAAC,kBAAkB,EAAE,EAAE,CAAC;KAC7D,IAAIrF,cAAI,CAACmC,aAAa,CAAC2E,gBAAgB,CAAC,EACxC;OACC,OAAOA,gBAAgB;;KAGxB,OAAO,EAAE;;GAGVC,yBAAyB,GACzB;KACC,IAAIC,kBAAkB,GAAG7C,EAAE,CAACC,IAAI,CAAC6C,kBAAkB,EAAE;KACrD,IAAI,CAACD,kBAAkB,IAAI7C,EAAE,CAACC,IAAI,CAAC8C,qBAAqB,EAAE,EAC1D;OACCF,kBAAkB,GAAG,YAAY;MACjC,MACI,IAAI,CAACA,kBAAkB,EAC5B;OACCA,kBAAkB,GAAG,GAAG;;KAGzB,OAAO,IAAI,CAACH,mBAAmB,EAAE,CAACG,kBAAkB,CAAC,IAAI,IAAI;;GAG9DG,iBAAiB,GACjB;KACC,MAAM5B,QAAQ,GAAGC,mBAAS,CAACC,WAAW,CAAC,iCAAiC,CAAC;KACzE,MAAM2B,cAAc,GAAG7B,QAAQ,CAACF,GAAG,CAAC,gBAAgB,EAAE,EAAE,CAAC;KACzD,IAAIrF,cAAI,CAACmC,aAAa,CAACiF,cAAc,CAAC,EACtC;OACC,OAAOA,cAAc;;KAGtB,OAAO,EAAE;;CAEX;;OC/WaC,kBAAkB,GAAG,CAACC,UAAU,EAAEC,MAA8B,GAAG,EAAE,KAAc;GAC/F,OAAO,IAAItJ,OAAO,CAAEC,OAAO,IAAW;KACrCzH,iBAAO,CAAC+Q,aAAa,CAAC,yBAAyB,CAAC,CAAC7I,IAAI,CAAC,MAAM;OAC3D,MAAM8I,UAAU,GAAI1K,KAAgB,IAAW;SAC9C,MAAM,CAAClB,IAAI,CAAC,GAAGkB,KAAK,CAACsB,OAAO,EAAE;SAC9B,IAAIiJ,UAAU,KAAKzL,IAAI,EACvB;WACCjF,6BAAY,CAAC8Q,WAAW,CAACvD,EAAE,CAACwD,cAAc,EAAE,QAAQ,EAAEF,UAAU,CAAC;WACjEvJ,OAAO,EAAE;;QAEV;OAEDtH,6BAAY,CAACmH,SAAS,CAACoG,EAAE,CAACwD,cAAc,EAAE,QAAQ,EAAEF,UAAU,CAAC;;;OAG/DG,cAAI,CAACvC,GAAG,CAACwC,gBAAgB,CAACP,UAAU,EAAEC,MAAM,CAAC,CAAC;MAC9C,CAAC;IACF,CAAC;CACH,CAAC;CAED,MAAMM,gBAAgB,GAAG,CAACP,UAAU,EAAEC,MAA8B,GAAG,EAAE,KAAa;GACrF,MAAMO,GAAG,GAAI,uDACZ3E,aAAG,CAACC,UAAU,CAAC,SAAS,CAAE,+CAA8CkE,UAAW,EAAC;GAGrF,OAAOS,aAAG,CAACC,QAAQ,CAACF,GAAG,EAAEP,MAAM,CAAC;CACjC,CAAC;;;;;AC7BD,CAYoC;CAAA;CAAA;CAAA;CAAA;AAEpC,CAAe,MAAMU,QAAQ,CAC7B;GAMC3R,WAAW,CAAC8F,gBAAkC,EAAE7E,IAAoB,EAAE2Q,IAAU,EAChF;KAAA;OAAA;;KAAA;OAAA;OAAA,OANsC;;KAAI;OAAA;OAAA,OAClB;;KAAI;OAAA;OAAA,OACd;;KAAI;OAAA;OAAA,OACQ;;KAIzB,4CAAI,8CAAqB9L,gBAAgB;KACzC,4CAAI,kBAAS7E,IAAI;KACjB,4CAAI,kBAAS2Q,IAAI;KACjB,4CAAI,sCAAoB,iBAAgBvM,cAAI,CAACsJ,SAAS,CAAC,CAAC,CAAE,EAAC;;GAG5DkD,KAAK,GACL;KAAA;KACC,MAAMC,WAAmB,sDAAG,4CAAI,gBAAOC,YAAY,EAAE,CAAC,CAAC,CAAC,qBAA5B,uBAA8BrR,EAAE,oCAAI,EAAE;KAElE,4CAAI,gBAAOsR,cAAc,EAAE,CAACC,WAAW,CAAC,GAAG,CAAC;KAE5C,4CAAI,gBAAOC,WAAW,CAAC;OACtBxR,EAAE,EAAE,UAAU;OACdyR,IAAI,EAAEtF,aAAG,CAACC,UAAU,CAAC,0BAA0B,EAAE;SAAE,YAAY,EAAE,4CAAI,gBAAOsF;QAAe,CAAC;OAC5FC,QAAQ,EAAE;MACV,EAAEP,WAAW,CAAC;KAEf,4CAAI,gBAAOI,WAAW,CAAC;OAAEI,SAAS,EAAE;MAAM,EAAER,WAAW,CAAC;KAExD,MAAM1K,QAAuB,GAAG,4CAAI,4CAAmBgI,eAAe,EAAE;KACxE,IAAIhI,QAAQ,EACZ;OACC,4CAAI,gBAAO8K,WAAW,CAAC;SACtBxR,EAAE,EAAE,kBAAkB;SACtByR,IAAI,EAAEtF,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;SAC3DyF,OAAO,EAAG,MAAY;WACrB,4CAAI,gBAAOC,KAAK,EAAE;WAClBpL,QAAQ,CAAC3G,SAAS,EAAE,CAACO,UAAU,yCAAC,IAAI,gBAAO;;QAE5C,EAAE8Q,WAAW,CAAC;;KAGhB,IAAI,4CAAI,4CAAmBnC,gBAAgB,yCAAC,IAAI,gBAAO,EACvD;OACC,4CAAI,gBAAOuC,WAAW,CAAC;SAAEI,SAAS,EAAE;QAAM,CAAC;OAC3C,4CAAI,gBAAOJ,WAAW,CAAC;SACtBxR,EAAE,EAAE,YAAY;SAChB+R,SAAS,EAAE,4CAAI,gBAAOvP,UAAU,CAAC,WAAW,CAAC,KAAK,IAAI,GAAG,8BAA8B,GAAG,EAAE;SAC5FiP,IAAI,EAAEtF,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;SAC1DyF,OAAO,EAAE,CAAC9L,KAAK,EAAEiM,QAAkB,KAAW;WAC7C,IAAI,4CAAI,gBAAOxP,UAAU,CAAC,WAAW,CAAC,KAAK,IAAI,EAC/C;aACC,4CAAI,4CAAmBwK,eAAe,yCAAC,IAAI,iBAAQ,KAAK,CAAC;YACzD,MAED;aACC,4CAAI,4CAAmBA,eAAe,yCAAC,IAAI,iBAAQ,IAAI,CAAC;;WAGzDgF,QAAQ,CAACC,aAAa,EAAE,CAACH,KAAK,EAAE;;QAEjC,CAAC;;KAGH,IAAI,4CAAI,gBAAOtP,UAAU,CAAC,WAAW,CAAC,EACtC;OACC,4CAAI,gBAAOgP,WAAW,CAAC;SAAEI,SAAS,EAAE;QAAM,CAAC;OAE3C,4CAAI,gBAAOJ,WAAW,CAAC;SACtBxR,EAAE,EAAE,QAAQ;SACZyR,IAAI,EAAEtF,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;SAC7D3G,MAAM,EAAE;WACP,gBAAgB,EAAGM,KAAgB,IAAW;aAC7C,MAAMmM,UAAoB,GAAGnM,KAAK,CAACsC,SAAS,EAAE;aAC9C,4CAAI,oCAAiB6J,UAAU;;UAEhC;SACD9P,KAAK,EAAE,CAAC;WACPpC,EAAE,EAAE,iBAAiB;WACrByK,IAAI,EAAE,oDAAoD;WAC1DsH,SAAS,EAAE;UACX;QACD,CAAC;;KAGH,IAAI/I,cAAI,CAACoC,cAAc,CAAC,4CAAI,gBAAO5I,UAAU,CAAC,SAAS,CAAC,CAAC,EACzD;OACC,4CAAI,gBAAOgP,WAAW,CAAC;SACtBI,SAAS,EAAE;;QAEX,CAAC;;OAEF,IAAI,4CAAI,gBAAOpP,UAAU,CAAC,SAAS,CAAC,EACpC;SACC,4CAAI,gBAAOgP,WAAW,CAAC;WACtBxR,EAAE,EAAE,SAAS;WACbyR,IAAI,EAAE,4CAAI,gBAAOjP,UAAU,CAAC,SAAS,CAAC,GAAG,QAAQ;WACjDqP,OAAO,EAAG,MAAY;aACrB,IAAI,CAACM,gBAAgB,EAAE;aACvB,4CAAI,gBAAOL,KAAK,EAAE;YAClB;WACDH,QAAQ,EAAE,4CAAI,gBAAO/O,cAAc,CAACC,QAAQ,KAAK;UACjD,CAAC;QACF,MAED;SACC,4CAAI,gBAAO2O,WAAW,CAAC;WACtBxR,EAAE,EAAE,SAAS;WACbyR,IAAI,EAAE,4CAAI,gBAAOjP,UAAU,CAAC,SAAS,CAAC;WACtCmP,QAAQ,EAAE;UACV,CAAC;;;;GAKLS,MAAM,CAACC,OAAe,EACtB;KACC,OAAO,IAAIpL,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAW;OAC7CyJ,cAAI,CAAC0B,SAAS,CAAC,+BAA+B,EAAE;SAC9CrM,IAAI,EAAE;WACL/D,QAAQ,EAAE,4CAAI,gBAAOM,UAAU,CAAC,UAAU,CAAC;WAC3C6P,OAAO,EAAEA,OAAO;WAChBE,WAAW,EAAE,IAAI;WACjBC,kBAAkB,EAAE;;QAErB,CAAC,CACD7K,IAAI,CAAE8K,QAAQ,IAAW;SAAA;SACzB,IAAI,CAAAA,QAAQ,oBAARA,QAAQ,CAAEtJ,MAAM,MAAK,SAAS,IAAI,CAAAsJ,QAAQ,sCAARA,QAAQ,CAAExM,IAAI,8CAAd,eAAgByM,MAAM,qBAAtB,sBAAwB7N,IAAI,MAAK,4CAAI,gBAAOA,IAAI,EACtF;WACC,MAAMgD,IAAkB,GAAG,4CAAI,4CAAmB0D,OAAO,CAAC,4CAAI,gBAAOvL,EAAE,CAAC;WACxE,MAAM6E,IAAI,GAAG4N,QAAQ,CAACxM,IAAI,CAACyM,MAAM,CAAC7N,IAAI;WACtCgD,IAAI,CAAC8K,OAAO,CAAC9N,IAAI,CAAC;;SAEnBqC,OAAO,EAAE;QACT,CAAC,CACDuB,KAAK,CAAEgK,QAAQ,IAAW;SAC1BtF,EAAE,CAACC,IAAI,CAACwF,yBAAyB,CAACH,QAAQ,CAAC;SAC3CtL,MAAM,EAAE;QACR,CAAC;MACH,CAAC;;GA8EHgL,gBAAgB,GAChB;KACC9B,kBAAkB,yCAAC,IAAI,qCAAkB;OAAEwC,IAAI,EAAE;MAAY,CAAC,CAAClL,IAAI,CAAC,MAAY;OAC/EwF,EAAE,CAACwD,cAAc,CAACmC,UAAU,yCAAC,IAAI,oCAAiB,GAAG;SACpDC,UAAU,EAAE,CAAChJ,GAAG,EAAEC,IAAI,EAAEgJ,aAAa,EAAEC,YAAY,KAAW;WAC7D,MAAMC,YAAY,GAAGjS,MAAM,CAAC2I,MAAM,CAACoJ,aAAa,CAAC,CAAC,CAAC,CAAC,IAAIC,YAAY;WACpE,IAAI,CAACC,YAAY,EACjB;aACC;;WAGD,MAAMC,QAAQ,GAAGD,YAAY,CAAClT,EAAE,KAAK,MAAM,GAAG+J,GAAG,CAACqJ,YAAY,GAAGF,YAAY,CAAClT,EAAE;WAEhF4Q,cAAI,CAAC0B,SAAS,CAAC,6BAA6B,EAAE;aAC7CrM,IAAI,EAAE;eACL/D,QAAQ,EAAE,4CAAI,gBAAOM,UAAU,CAAC,UAAU,CAAC;eAC3C6Q,UAAU,EAAEF;;YAEb,CAAC,CACDxL,IAAI,CAAE8K,QAAQ,IAAW;aACzB,IAAI,CAAAA,QAAQ,oBAARA,QAAQ,CAAEtJ,MAAM,MAAK,SAAS,EAClC;eACC,MAAMtB,IAAkB,GAAG,4CAAI,4CAAmB0D,OAAO,CAAC,4CAAI,gBAAOvL,EAAE,CAAC;eACxE,MAAM6E,IAAI,GAAG4N,QAAQ,CAACxM,IAAI,CAACyM,MAAM,CAAC7N,IAAI;eACtC,MAAM7E,EAAE,GAAGyS,QAAQ,CAACxM,IAAI,CAACyM,MAAM,CAAC1S,EAAE;eAElC6H,IAAI,CAACyL,eAAe,CAAE,IAAGtT,EAAG,EAAC,CAAC;eAC9B6H,IAAI,CAAC8K,OAAO,CAAC9N,IAAI,CAAC;eAElB,IAAIqO,YAAY,CAAClT,EAAE,KAAK,MAAM,EAC9B;iBACC6H,IAAI,CAAC4H,aAAa,CAAC,SAAS,EAAG,GAAE1F,GAAG,CAAClF,IAAK,KAAI,CAAC;gBAC/C,MAED;iBACCgD,IAAI,CAAC4H,aAAa,CAAC,SAAS,EAAG,GAAE1F,GAAG,CAAClF,IAAK,MAAKqO,YAAY,CAACrO,IAAK,EAAC,CAAC;;;YAGrE,CAAC,CACD4D,KAAK,CAAEgK,QAAQ,IAAW;aAC1BtF,EAAE,CAACC,IAAI,CAACwF,yBAAyB,CAACH,QAAQ,CAAC;YAC3C,CAAC;;QAEH;OAED,IAAItF,EAAE,CAACwD,cAAc,CAAC4C,WAAW,KAAK,IAAI,EAC1C;SACCpG,EAAE,CAACwD,cAAc,CAAC6C,UAAU,yCAAC,IAAI,oCAAiB;;MAEnD,CAAC;;CAEJ;CAAC,0BA9HgBtB,UAAoB,EACpC;GACCzS,iBAAO,CAAC+Q,aAAa,CAAC,YAAY,CAAC,CAAC7I,IAAI,CAAE8L,OAAO,IAAW;KAC3D,MAAMC,MAAqB,GAAGD,OAAO,CAACC,MAAM;KAC5C,MAAMC,UAA6B,GAAGF,OAAO,CAACE,UAAU;KACxD,MAAMC,WAA+B,GAAGH,OAAO,CAACG,WAAW;KAC3D,MAAMC,YAAiC,GAAGJ,OAAO,CAACI,YAAY;KAE9D,MAAMC,aAAa,GAAI/N,KAAoB,IAAW;OACrD,IAAIA,KAAK,CAACgO,IAAI,KAAK,OAAO,EAC1B;SACCC,iBAAiB,EAAE;;MAEpB;KAED,MAAMC,oBAAoB,GAAGC,4CAA2B,CAAC,4CAAI,gBAAOrP,IAAI,CAAC;KACzE,MAAMmP,iBAAiB,GAAG,MAAY;OACrC,MAAMG,aAAqB,GAAGC,QAAQ,CAAC5E,KAAK,CAAC6E,IAAI,EAAE;OACnD,IAAI,CAACrL,cAAI,CAACoC,cAAc,CAAC+I,aAAa,CAAC,IAAIA,aAAa,KAAKF,oBAAoB,EACjF;SACC/B,UAAU,CAACD,aAAa,EAAE,CAACH,KAAK,EAAE;SAElC;;OAGDwC,SAAS,CAACC,UAAU,CAAC,IAAI,CAAC;OAC1B,MAAMC,WAAW,GAAI,GAAEL,aAAc,IAAGM,iCAAgB,CAAC,4CAAI,gBAAO5P,IAAI,CAAE,EAAC;OAC3E,IAAI,CAACuN,MAAM,CAACoC,WAAW,CAAC,CACtB7M,IAAI,CAAC,MAAY;SACjB2M,SAAS,CAACC,UAAU,CAAC,KAAK,CAAC;SAC3BrC,UAAU,CAACD,aAAa,EAAE,CAACH,KAAK,EAAE;QAClC,CAAC,CACDrJ,KAAK,CAAC,MAAY;SAClB6L,SAAS,CAACC,UAAU,CAAC,KAAK,CAAC;QAC3B,CAAC;MAEH;KACD,MAAMH,QAA6B,GAAGnI,aAAG,CAACC,MAAM,oBAAC;;;kBAGpC,CAAgB;OAC3B,CAAoC;IACtC,GAFe4H,aAAa,EACxBnP,cAAI,CAACC,MAAM,CAACqP,oBAAoB,CAAC,CACpC;KAED,MAAMK,SAAiB,GAAG,IAAIZ,MAAM,CAAC;OACpCjC,IAAI,EAAEtF,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;OAC/DsI,KAAK,EAAEd,WAAW,CAACe,OAAO;OAC1B1K,IAAI,EAAE0J,UAAU,CAACiB,KAAK;OACtB/C,OAAO,EAAEmC;MACT,CAAC;KAEF,MAAMa,SAAuB,GAAG,IAAIhB,YAAY,CAAC;OAChD5J,IAAI,EAAE0J,UAAU,CAACiB,KAAK;OACtB/C,OAAO,EAAE,MAAY;SACpBK,UAAU,CAACD,aAAa,EAAE,CAACH,KAAK,EAAE;;MAEnC,CAAC;KAEF,MAAMgD,OAAa,GAAG5C,UAAU,CAAC6C,UAAU,EAAE;KAC7C,MAAMC,YAAsB,GAAGF,OAAO,CAACG,WAAW,CAAC,iBAAiB,CAAC;KAErED,YAAY,CAACE,OAAO,CACnBjJ,aAAG,CAACC,MAAM,sBAAC;;QAET,CAAW;oDACiC,CAA2C;;KAEzF,GAHIkI,QAAQ,EACoC,CAACE,SAAS,CAACpI,MAAM,EAAE,EAAE2I,SAAS,CAAC3I,MAAM,EAAE,CAAC,GAGxF,IAAI,CACJ;KAEDgG,UAAU,CAACiD,WAAW,EAAE;IACxB,CAAC;CACH;;CCpO2C;CAAA;CAAA;AAI5C,CAAe,MAAMC,YAAY,CACjC;GAIC9V,WAAW,CAAC8F,gBAAkC,EAC9C;KAAA;OAAA;;KAAA;OAAA;OAAA,OAJsC;;KAAI;OAAA;OAAA,OAC5B;;KAIb,4CAAI,8CAAqBA,gBAAgB;;GAG1CiQ,OAAO,CAACC,MAAM,EACd;KACC,IAAI,4CAAI,wBAAW,IAAI,EACvB;OACC,+CAAO,IAAI;;KAGZ,4CAAI,sBAAS,IAAIC,eAAI,CAAC;OACrBC,WAAW,EAAEF,MAAM,CAACG,YAAY,EAAE;OAClC1D,SAAS,EAAE,gCAAgC;OAC3C2D,KAAK,EAAE,IAAI;OACXC,QAAQ,EAAE,IAAI;OACdC,UAAU,EAAE,EAAE;OACdC,SAAS,EAAE,KAAK;OAChBzT,KAAK,0CAAE,IAAI,yBAAY;OACvBqD,MAAM,EAAE;SACPqQ,MAAM,EAAE,MAAY;WACnBR,MAAM,CAACS,MAAM,EAAE;UACf;SACDC,SAAS,EAAE,MAAY;WACtBV,MAAM,CAACW,QAAQ,EAAE;WACjB,4CAAI,sBAAS,IAAI;;;MAGnB,CAAC;KAEF,+CAAO,IAAI;;GA6BZrH,IAAI,CAAC0G,MAAM,EACX;KACC,IAAI,CAACD,OAAO,CAACC,MAAM,CAAC,CAAC1G,IAAI,EAAE;;GAG5BsH,MAAM,CAACZ,MAAM,EACb;KACC,IAAI,4CAAI,wBAAW,IAAI,IAAI,4CAAI,oBAAOhE,cAAc,EAAE,CAAC6E,OAAO,EAAE,EAChE;OACC,4CAAI,oBAAOrE,KAAK,EAAE;MAClB,MAED;OACC,IAAI,CAAClD,IAAI,CAAC0G,MAAM,CAAC;;;GAInBhM,IAAI,GACJ;KACC,IAAI,4CAAI,wBAAW,IAAI,EACvB;OACC,4CAAI,oBAAOwI,KAAK,EAAE;;;GAIpBsE,QAAQ,GACR;KACC,OAAO,4CAAI,0BAAa3K,MAAM,GAAG,CAAC;;CAEpC;CAAC,sBAtDA;GACC,IAAI,CAAC,4CAAI,4CAAmBiE,sBAAsB,EAAE,EACpD;KACC,OAAO,EAAE;;GAGV,OAAO,CAAC;KACPqC,SAAS,EAAE,4CAAI,4CAAmBpC,gBAAgB,EAAE,KAAK,MAAM,GAAG,8BAA8B,GAAG,EAAE;KACrG8B,IAAI,EAAEtF,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;KAC1DyF,OAAO,EAAE,CAAC9L,KAAK,EAAEiM,QAAkB,KAAW;OAC7C,4CAAI,4CAAmB3G,oBAAoB,CAAC,QAAQ,CAAC;OACrD,IAAI,4CAAI,4CAAmBsE,gBAAgB,EAAE,KAAK,MAAM,EACxD;SACC,4CAAI,4CAAmBtM,gBAAgB,CAAC,SAAS,CAAC;QAClD,MAED;SACC,4CAAI,4CAAmBA,gBAAgB,CAAC,MAAM,CAAC;;OAGhD2O,QAAQ,CAACC,aAAa,EAAE,CAACH,KAAK,EAAE;;IAEjC,CAAC;CACH;;CC/DD,MAAMuE,cAA2B,GAAG,IAAIrT,GAAG,EAAE;AAE7C,OAAasT,kBAAkB,GAAIjR,OAAO,IAAW;GAEpDA,OAAO,GAAG2D,cAAI,CAACmC,aAAa,CAAC9F,OAAO,CAAC,GAAGA,OAAO,GAAG,EAAE;GACpD,MAAMkR,QAAgB,GAAGvN,cAAI,CAACoC,cAAc,CAAC/F,OAAO,CAACkR,QAAQ,CAAC,GAAGlR,OAAO,CAACkR,QAAQ,GAAI,eAAc5R,cAAI,CAACsJ,SAAS,CAAC,CAAC,CAAE,EAAC;GACtH,MAAMlC,MAAiB,GAAG/C,cAAI,CAACwN,UAAU,CAACnR,OAAO,CAAC0G,MAAM,CAAC,GAAG1G,OAAO,CAAC0G,MAAM,GAAG,IAAI;GACjF,MAAM0K,QAAmB,GAAGzN,cAAI,CAACwN,UAAU,CAACnR,OAAO,CAACoR,QAAQ,CAAC,GAAGpR,OAAO,CAACoR,QAAQ,GAAG,IAAI;GACvF,MAAMC,OAAkB,GAAG1N,cAAI,CAACwN,UAAU,CAACnR,OAAO,CAACqR,OAAO,CAAC,GAAGrR,OAAO,CAACqR,OAAO,GAAG,IAAI;GACpF,MAAMC,QAAmB,GAAGtR,OAAO,CAACsR,QAAQ,YAAYC,yBAAQ,GAAGvR,OAAO,CAACsR,QAAQ,GAAG,IAAI;GAE1F,IAAIN,cAAc,CAAClT,GAAG,CAACoT,QAAQ,CAAC,EAChC;KACC;;GAGDF,cAAc,CAACpT,GAAG,CAACsT,QAAQ,CAAC;GAE5BlG,kBAAkB,CAACkG,QAAQ,CAAC,CAAC5O,IAAI,CAAC,MAAY;KAC7C0O,cAAc,CAACQ,MAAM,CAACN,QAAQ,CAAC;KAC/B,IAAIxK,MAAM,KAAK,IAAI,EACnB;OACCA,MAAM,EAAE;;KAGToB,EAAE,CAACwD,cAAc,CAACmC,UAAU,CAACyD,QAAQ,CAAC,GAAG;OACxCxD,UAAU,EAAE,CAAChJ,GAAG,EAAEC,IAAI,EAAEgJ,aAAa,KAAW;SAC/C/R,MAAM,CAAC2I,MAAM,CAACoJ,aAAa,CAAC,CAAC5R,OAAO,CAACb,IAAI,IAAI;WAC5C,IAAIoW,QAAQ,KAAK,IAAI,EACrB;aACCA,QAAQ,CAAC5O,OAAO,CAACxH,IAAI,CAACP,EAAE,EAAE;eAAE6E,IAAI,EAAEtE,IAAI,CAACsE,IAAI;eAAEiS,OAAO,EAAE;cAAM,CAAC;;UAE9D,CAAC;SAEF,IAAIL,QAAQ,KAAK,IAAI,EACrB;WACCA,QAAQ,CAAC1M,GAAG,EAAEC,IAAI,EAAEgJ,aAAa,CAAC;;QAEnC;OACD+D,YAAY,EAAE,MAAY;SACzBV,cAAc,CAACQ,MAAM,CAACN,QAAQ,CAAC;SAC/B,IAAIG,OAAO,KAAK,IAAI,EACpB;WACCA,OAAO,EAAE;;;MAGX;KAED,IAAIvJ,EAAE,CAACwD,cAAc,CAAC4C,WAAW,KAAK,IAAI,EAC1C;OACCpG,EAAE,CAACwD,cAAc,CAAC6C,UAAU,CAAC+C,QAAQ,CAAC;;IAEvC,CAAC;CACH,CAAC;;CCxDc,MAAMS,mBAAmB,SAASC,uCAAsB,CACvE;GACC3X,WAAW,CAAC4X,MAAc,EAAE7R,OAAO,GAAG,EAAE,EACxC;KACC,KAAK,CAAC6R,MAAM,EAAE7R,OAAO,CAAC;;GAGvB8R,IAAI,CAACtP,IAAkB,EACvB;KACC,IAAI,CAAChI,IAAI,CAAC,YAAY,EAAE;OAAEuX,QAAQ,EAAE;MAAK,CAAC;KAC1C,IAAI,CAACvX,IAAI,CAAC,QAAQ,CAAC;;GAGpBwX,KAAK,GACL;CAGD;;CCnBiG;CAAA;AAEjG,CAAe,MAAMC,qBAAqB,SAASC,yCAAwB,CAC3E;GAICjY,WAAW,CAAC4X,MAAc,EAAE7R,OAAO,GAAG,EAAE,EACxC;KACC,KAAK,CAAC6R,MAAM,EAAE7R,OAAO,CAAC;KAAC;OAAA;OAAA,OALN;;KAAI;OAAA;OAAA,OACD;;KAMpB,4CAAI,sBAAWA,OAAO,CAAC7B,MAAM;KAC7B,4CAAI,4BAAc6B,OAAO,CAACmS,SAAS;;GAGpCC,MAAM,CAAC5P,IAAkB,EACzB;KACCsF,EAAE,CAACC,IAAI,CAACsK,cAAc,CAACC,SAAS,CAAC;OAChC9P,IAAI,EAAE;SACL7H,EAAE,0CAAE,IAAI,mBAAQ;SAChB4X,OAAO,0CAAE,IAAI;QACb;OACDC,QAAQ,EAAGC,OAAO,IAAW;SAC5B,IAAI,CAACjY,IAAI,CAAC,UAAU,EAAE;WAAEkY,QAAQ,EAAED,OAAO,CAACC;UAAS,CAAC;QACpD;OACDC,UAAU,EAAGZ,QAAQ,IAAW;SAC/B,IAAI,CAACvX,IAAI,CAAC,YAAY,EAAE;WAAEuX,QAAQ,EAAEA;UAAU,CAAC;QAC/C;OACDa,OAAO,EAAGC,MAAM,IAAW;SAC1B,IAAI,CAACrY,IAAI,CAAC,SAAS,EAAE;WAAEgH,KAAK,EAAE6D,8BAAa,CAACyN,oBAAoB,CAACD,MAAM;UAAG,CAAC;;MAE5E,CAAC;;GAGHb,KAAK,GACL;CAGD;;CC/BA,MAAMhB,gBAA2B,GAAG,IAAIrT,GAAG,EAAE;AAE7C,OAAaoV,mBAAmB,GAAI/S,OAAO,IAAW;GAErDA,OAAO,GAAG2D,cAAI,CAACmC,aAAa,CAAC9F,OAAO,CAAC,GAAGA,OAAO,GAAG,EAAE;GACpD,MAAMkR,QAAgB,GAAGvN,cAAI,CAACoC,cAAc,CAAC/F,OAAO,CAACkR,QAAQ,CAAC,GAAGlR,OAAO,CAACkR,QAAQ,GAAI,gBAAe5R,cAAI,CAACsJ,SAAS,CAAC,CAAC,CAAE,EAAC;GACvH,MAAMuJ,SAAiB,GAAGxO,cAAI,CAACoC,cAAc,CAAC/F,OAAO,CAACmS,SAAS,CAAC,GAAGnS,OAAO,CAACmS,SAAS,GAAI,QAAO;GAC/F,MAAMzL,MAAiB,GAAG/C,cAAI,CAACwN,UAAU,CAACnR,OAAO,CAAC0G,MAAM,CAAC,GAAG1G,OAAO,CAAC0G,MAAM,GAAG,IAAI;GACjF,MAAM0K,QAAmB,GAAGzN,cAAI,CAACwN,UAAU,CAACnR,OAAO,CAACoR,QAAQ,CAAC,GAAGpR,OAAO,CAACoR,QAAQ,GAAG,IAAI;GACvF,MAAMC,OAAkB,GAAG1N,cAAI,CAACwN,UAAU,CAACnR,OAAO,CAACqR,OAAO,CAAC,GAAGrR,OAAO,CAACqR,OAAO,GAAG,IAAI;GACpF,MAAMC,QAAmB,GAAGtR,OAAO,CAACsR,QAAQ,YAAYC,yBAAQ,GAAGvR,OAAO,CAACsR,QAAQ,GAAG,IAAI;GAE1F,IAAIN,gBAAc,CAAClT,GAAG,CAACoT,QAAQ,CAAC,EAChC;KACC;;GAGDF,gBAAc,CAACpT,GAAG,CAACsT,QAAQ,CAAC;GAE5BlG,kBAAkB,CAACkG,QAAQ,EAAE;KAAEqB,OAAO,EAAEJ,SAAS;KAAEa,WAAW,EAAE;IAAG,CAAC,CAAC1Q,IAAI,CAAC,MAAY;KACrF0O,gBAAc,CAACQ,MAAM,CAACN,QAAQ,CAAC;KAC/B,IAAIxK,MAAM,KAAK,IAAI,EACnB;OACCA,MAAM,EAAE;;KAGToB,EAAE,CAACwD,cAAc,CAACmC,UAAU,CAACyD,QAAQ,CAAC,GAAG;OACxCxD,UAAU,EAAE,CAAChJ,GAAG,EAAEC,IAAI,EAAEgJ,aAAa,KAAW;SAC/CvT,iBAAO,CAAC+Q,aAAa,CAAC,6BAA6B,CAAC,CAAC7I,IAAI,CAAC,MAAY;WACrE1G,MAAM,CAAC2I,MAAM,CAACoJ,aAAa,CAAC,CAAC5R,OAAO,CAACb,IAAI,IAAI;aAC5C,IAAIA,IAAI,CAAC+X,IAAI,KAAK,MAAM,IAAI3B,QAAQ,KAAK,IAAI,EAC7C;eACCA,QAAQ,CAAC5O,OAAO,CAAC;iBAChB/H,EAAE,EAAEO,IAAI,CAACP,EAAE;iBACXuB,YAAY,EAAEhB,IAAI,CAACP,EAAE;iBACrB6E,IAAI,EAAEtE,IAAI,CAACsE,IAAI;iBACfoF,IAAI,EAAEtF,cAAI,CAAC4T,QAAQ,CAAChY,IAAI,CAAC2J,OAAO,CAAC;iBACjCsO,cAAc,EAAE,IAAIxB,mBAAmB,CACtCL,QAAQ,CAAC8B,SAAS,EAAE,EACpB;mBAAEjV,MAAM,EAAEjD,IAAI,CAACP,EAAE;mBAAEwX,SAAS,EAAEjX,IAAI,CAACmY;kBAAU,CAC7C;iBACDC,gBAAgB,EAAE,IAAIrB,qBAAqB,CAC1CX,QAAQ,CAAC8B,SAAS,EAAE,EACpB;mBAAEjV,MAAM,EAAEjD,IAAI,CAACP,EAAE;mBAAEwX,SAAS,EAAEjX,IAAI,CAACmY;kBAAU;gBAE9C,CAAC;;YAEH,CAAC;WAEF,IAAIjC,QAAQ,KAAK,IAAI,EACrB;aACCA,QAAQ,CAAC1M,GAAG,EAAEC,IAAI,EAAEgJ,aAAa,CAAC;;UAEnC,CAAC;QAEF;OACD+D,YAAY,EAAE,MAAY;SACzBV,gBAAc,CAACQ,MAAM,CAACN,QAAQ,CAAC;SAC/B,IAAIG,OAAO,KAAK,IAAI,EACpB;WACCA,OAAO,EAAE;;;MAGX;KAED,IAAIvJ,EAAE,CAACwD,cAAc,CAAC4C,WAAW,KAAK,IAAI,EAC1C;OACCpG,EAAE,CAACwD,cAAc,CAAC6C,UAAU,CAAC+C,QAAQ,CAAC;;IAEvC,CAAC;CACH,CAAC;;CCzEM,MAAMqC,MAA+B,GAAG;GAC9C/T,IAAI,EAAE,QAAQ;GACdgU,KAAK,EAAE;KACN5O,IAAI,EAAE;OACLqO,IAAI,EAAEQ,MAAM;OACZC,OAAO,EAAE;MACT;KACDrE,KAAK,EAAE;OACN4D,IAAI,EAAEU,MAAM;OACZD,OAAO,EAAE;MACT;KACDE,MAAM,EAAE;OACPX,IAAI,EAAErX,MAAM;OACZ8X,OAAO,EAAE;MACT;KACDnJ,IAAI,EAAE;OACL0I,IAAI,EAAEU,MAAM;OACZD,OAAO,EAAE;;IAEV;GACDG,OAAO,GACP;KACC,IAAI,CAACC,MAAM,GAAG,IAAI;IAClB;GACDC,OAAO,GACP;KACC3Z,iBAAO,CAAC+Q,aAAa,CAAC,aAAa,CAAC,CAAC7I,IAAI,CAAE8L,OAAO,IAAW;OAC5D,MAAM;SAAEmF;QAAQ,GAAGnF,OAAO;OAC1B,IAAI,CAAC0F,MAAM,GAAG,IAAIP,MAAM,CAAC;SACxBS,MAAM,EAAE,IAAI,CAACC,KAAK,CAACjT,SAAS;SAC5B4D,IAAI,EAAE,IAAI,CAACA,IAAI;SACfyK,KAAK,EAAE,IAAI,CAACA,KAAK;SACjBuE,MAAM,EAAE,IAAI,CAACA,MAAM;SACnBrJ,IAAI,EAAE,IAAI,CAACA;QACX,CAAC;OAEF,IAAI,CAACuJ,MAAM,CAACvK,IAAI,EAAE;MAClB,CAAC;IACF;GACD2K,aAAa,GACb;KACC,IAAI,IAAI,CAACJ,MAAM,EACf;OACC,IAAI,CAACA,MAAM,CAACK,OAAO,EAAE;OACrB,IAAI,CAACL,MAAM,GAAG,IAAI;;IAEnB;GACDM,QAAQ,EAAG;CACZ,CAAC;;CC3CM,MAAMC,YAAY,GAAG;GAC3B7U,IAAI,EAAE,cAAc;GACpB8U,MAAM,EAAE,CAAC,kBAAkB,EAAE,UAAU,EAAE,YAAY,CAAC;GACtDC,UAAU,EAAE;KACXhB;IACA;GACD3S,IAAI,EAAE,OAAO;KACZ4T,gBAAgB,EAAE,KAAK;KACvBC,qBAAqB,EAAE,KAAK;KAC5BC,gBAAgB,EAAE;IAClB,CAAC;GACFb,OAAO,GACP;KACC,IAAI,CAACc,YAAY,GAAI,eAAcrV,cAAI,CAACsJ,SAAS,CAAC,CAAC,CAAE,EAAC;KACtD,IAAI,CAACgM,aAAa,GAAI,gBAAetV,cAAI,CAACsJ,SAAS,CAAC,CAAC,CAAE,EAAC;KACxD,IAAI,CAACiM,cAAc,GAAG,IAAI,CAAC9U,gBAAgB,CAAC+K,iBAAiB,EAAE;IAC/D;GACDiJ,OAAO,GACP;KACC,IAAI,CAACzC,QAAQ,CAACwD,YAAY,CAAC,IAAI,CAACb,KAAK,CAAC7B,MAAM,CAAC;IAC7C;GACD2C,OAAO,EAAE;KACR9D,kBAAkB,GAClB;OACC,IAAI,IAAI,CAACuD,gBAAgB,EACzB;SACC;;OAGD,IAAI,CAACA,gBAAgB,GAAG,IAAI;OAE5BvD,kBAAkB,CAAC;SAClBC,QAAQ,EAAE,IAAI,CAACyD,YAAY;SAC3BrD,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvB5K,MAAM,EAAE,MAAY;WAAE,IAAI,CAAC8N,gBAAgB,GAAG,KAAK;UAAG;SACtDnD,OAAO,EAAE,MAAY;WAAE,IAAI,CAACmD,gBAAgB,GAAG,KAAK;;QACpD,CAAC;MACF;KAEDzB,mBAAmB,CAACZ,SAAS,EAC7B;OACC,IAAI,IAAI,CAACsC,qBAAqB,EAC9B;SACC;;OAGD,IAAI,CAACC,gBAAgB,GAAGvC,SAAS;OACjC,IAAI,CAACsC,qBAAqB,GAAG,IAAI;OAEjC,MAAMO,QAAQ,GAAG,MAAY;SAC5B,IAAI,CAACP,qBAAqB,GAAG,KAAK;SAClC,IAAI,CAACC,gBAAgB,GAAG,IAAI;QAC5B;OAED3B,mBAAmB,CAAC;SACnB7B,QAAQ,EAAE,IAAI,CAAC0D,aAAa;SAC5BtD,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvBa,SAAS;SACTzL,MAAM,EAAEsO,QAAQ;SAChB3D,OAAO,EAAE2D;QACT,CAAC;;IAEH;;GAEDZ,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAoEZ,CAAC;;;;;AC7ID,CAOO,MAAMa,aAAsC,GAAG;GACrDzV,IAAI,EAAE,eAAe;GACrB8U,MAAM,EAAE,CAAC,UAAU,EAAE,kBAAkB,EAAE,YAAY,CAAC;GACtDd,KAAK,EAAE;KACNtY,IAAI,EAAE;OACL+X,IAAI,EAAErX,MAAM;OACZ8X,OAAO,EAAE;;IAEV;GACDG,OAAO,GACP;KACC,IAAI,CAAChI,IAAI,GAAG,IAAI;KAChB,IAAI,CAACqJ,kBAAkB,GAAG,IAAI;IAC9B;GACDnB,OAAO,GACP;KACC,MAAMoB,SAAiB,GAAGrO,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC,IAAI,EAAE;KACnF,MAAMqO,MAAM,GAAG,QAAQ;KACvB,MAAMC,QAAgB,GAAGF,SAAS,CAACG,OAAO,CAACF,MAAM,CAAC;KAClD,IAAIC,QAAQ,KAAK,CAAC,CAAC,EACnB;OAAA;OACC,MAAME,OAAe,GAAGJ,SAAS,CAACK,SAAS,CAAC,CAAC,EAAEH,QAAQ,CAAC;OACxD,MAAMI,QAAgB,GAAGN,SAAS,CAACK,SAAS,CAACH,QAAQ,GAAGD,MAAM,CAAChP,MAAM,CAAC;OAEtE,IAAI,CAAC8O,kBAAkB,GAAGtO,aAAG,CAACC,MAAM,oBAAC;6DACmB,CAEtD;IACF,4BAFE,IAAI,CAAC9G,gBAAgB,CAAC2K,yBAAyB,EAAE,qBAAjD,sBAAmDlL,IAAI,CAExD;OAED,MAAMkW,KAAK,GAAG9O,aAAG,CAACC,MAAM,sBAAC;;aAEjB,CAAU;OAChB,CAA0B;aACpB,CAAW;YACX,GAHE0O,OAAO,EACb,IAAI,CAACL,kBAAkB,EACjBO,QAAQ,CACT;OAGTlN,aAAG,CAACC,MAAM,CAACkN,KAAK,EAAE,IAAI,CAACzB,KAAK,CAAC,mBAAmB,CAAC,CAAC;;IAEnD;GACDc,OAAO,EAAE;KACRY,cAAc,CAACC,YAAoB,EACnC;;OAEC,IAAI,CAAC9N,EAAE,CAACC,IAAI,CAAC6C,kBAAkB,EAAE,IAAI9C,EAAE,CAACC,IAAI,CAAC8C,qBAAqB,EAAE,EACpE;SACC/C,EAAE,CAACC,IAAI,CAAC8N,mBAAmB,CAAC,YAAY,CAAC;QACzC,MACI,IAAI,CAAC/N,EAAE,CAACC,IAAI,CAAC6C,kBAAkB,EAAE,EACtC;SACC9C,EAAE,CAACC,IAAI,CAAC8N,mBAAmB,CAAC,GAAG,CAAC;;OAGjC,IAAI/N,EAAE,CAACC,IAAI,CAACC,QAAQ,CAACC,KAAK,CAACC,QAAQ,CAAC4N,uBAAuB,EAAE,EAC7D;SACChO,EAAE,CAACC,IAAI,CAACC,QAAQ,CAACC,KAAK,CAACC,QAAQ,CAAC6N,UAAU,CAAC;WAAE9C,IAAI,EAAE2C;UAAc,CAAC,CAACtT,IAAI,CAAE8K,QAAQ,IAAW;WAC3F,IAAIA,QAAQ,CAACtJ,MAAM,KAAK,SAAS,EACjC;aACC,IAAI,CAACwN,QAAQ,CAAC5O,OAAO,CACnB,IAAG0K,QAAQ,CAACC,MAAM,CAAC1S,EAAG,EAAC,EACxB;eACC6E,IAAI,EAAE4N,QAAQ,CAACC,MAAM,CAAC7N,IAAI;eAC1BiS,OAAO,EAAE;cACT,CACD;aAED,IAAI,CAAC1R,gBAAgB,CAACoD,iBAAiB,EAAE;;UAE1C,CAAC;QACF,MAED;SACC,MAAM6S,aAAa,GAAG,IAAIlO,EAAE,CAACC,IAAI,CAACC,QAAQ,CAACiO,aAAa,CAAC;WACxDC,QAAQ,EAAEN,YAAY;WACtBO,WAAW,EAAErO,EAAE,CAACC,IAAI,CAAC6C,kBAAkB,EAAE;WACzCwL,WAAW,EAAE,CAAChJ,QAAQ,EAAEiJ,QAAQ,KAAW;aAC1C,IAAIjJ,QAAQ,CAACtJ,MAAM,KAAK,SAAS,EACjC;eACC;;aAGD,IAAIuS,QAAQ,IAAIA,QAAQ,CAAChJ,MAAM,EAC/B;eACC,IAAI,CAACiE,QAAQ,CAAC5O,OAAO,CACnB,IAAG2T,QAAQ,CAAChJ,MAAM,CAAC1S,EAAG,EAAC,EACxB;iBACC6E,IAAI,EAAE6W,QAAQ,CAAChJ,MAAM,CAAC7N,IAAI;iBAC1BoF,IAAI,EAAEyR,QAAQ,CAAChJ,MAAM,CAACxI,OAAO;iBAC7B4M,OAAO,EAAE;gBACT,CACD;eAED,IAAI,CAAC1R,gBAAgB,CAACoD,iBAAiB,EAAE;cACzC,MACI,IAAIiK,QAAQ,CAACvQ,QAAQ,EAC1B;eACC,IAAI,CAACyU,QAAQ,CAAC5O,OAAO,CACnB,IAAG0K,QAAQ,CAACvQ,QAAS,EAAC,EACvB;iBACC2C,IAAI,EAAEmE,IAAI,CAACoC,cAAc,CAACqH,QAAQ,CAACJ,OAAO,CAAC,GAAGI,QAAQ,CAACJ,OAAO,GAAG,EAAE;iBACnEyE,OAAO,EAAE;gBACT,CACD;eAED,IAAI,CAAC1R,gBAAgB,CAACoD,iBAAiB,EAAE;;;UAG3C,CAAC;SAEF6S,aAAa,CAACM,KAAK,EAAE;;MAEtB;KAEDC,QAAQ,GACR;OACC,IAAI,IAAI,CAAC1K,IAAI,KAAK,IAAI,EACtB;SACC,IAAI,CAACA,IAAI,CAACsI,OAAO,EAAE;SAEnB;;OAGD,IAAI,CAACtI,IAAI,GAAG,IAAIqE,eAAI,CAAC;SACpBC,WAAW,EAAE,IAAI,CAAC+E,kBAAkB;SACpCxI,SAAS,EAAE,gCAAgC;SAC3C2D,KAAK,EAAE,IAAI;SACXC,QAAQ,EAAE,IAAI;SACdkG,SAAS,EAAE,CAAC;SACZhG,SAAS,EAAE,KAAK;SAChBzT,KAAK,EAAE,IAAI,CAACiP,YAAY,EAAE;SAC1B5L,MAAM,EAAE;WACPuQ,SAAS,EAAE,MAAY;aACtB,IAAI,CAAC9E,IAAI,GAAG,IAAI;;;QAGlB,CAAC;OAEF,IAAI,CAACA,IAAI,CAACtC,IAAI,EAAE;MAChB;KAEDyC,YAAY,GACZ;OAAA;OACC,MAAMjP,KAAK,GAAG,EAAE;OAChB,MAAM4N,kBAAkB,6BAAG,IAAI,CAAC5K,gBAAgB,CAAC2K,yBAAyB,EAAE,qBAAjD,uBAAmDgE,IAAI;OAClF,MAAM+H,QAA+C,GAAG7a,MAAM,CAAC2I,MAAM,CAAC,IAAI,CAACxE,gBAAgB,CAACyK,mBAAmB,EAAE,CAAC;OAClHiM,QAAQ,CAAC1a,OAAO,CAAEwW,OAAuC,IAAW;SACnExV,KAAK,CAAC2Z,IAAI,CAAC;WACVtK,IAAI,EAAEmG,OAAO,CAAC/S,IAAI;WAClBkN,SAAS,EAAE/B,kBAAkB,KAAK4H,OAAO,CAAC7D,IAAI,GAAG,8BAA8B,GAAG,2BAA2B;WAC7GlC,OAAO,EAAE,CAAC9L,KAAK,EAAExF,IAAc,KAAW;aACzC4M,EAAE,CAACC,IAAI,CAAC8N,mBAAmB,CAACtD,OAAO,CAAC7D,IAAI,CAAC;aACzC,IAAI,CAACwG,kBAAkB,CAACyB,WAAW,GAAGpE,OAAO,CAAC/S,IAAI;aAClD,IAAI,CAACqM,IAAI,CAACY,KAAK,EAAE;;UAElB,CAAC;QACF,CAAC;OAEF,OAAO1P,KAAK;;IAEb;;GAEDqX,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA4BZ,CAAC;;CC7LM,MAAMwC,oBAA6C,GAAG;GAC5DpX,IAAI,EAAE,sBAAsB;GAC5B8U,MAAM,EAAE,CAAC,UAAU,EAAE,UAAU,CAAC;GAChCd,KAAK,EAAE;KACNtY,IAAI,EAAE;OACL+X,IAAI,EAAErX,MAAM;OACZ8X,OAAO,EAAE;;IAEV;GACDqB,OAAO,EAAE;KACR8B,KAAK,GACL;OACC,IAAI,CAACxV,QAAQ,CAAC3G,SAAS,EAAE,CAACO,UAAU,CAAC,IAAI,CAACC,IAAI,CAAC;MAC/C;KAED4b,gBAAgB,CAACpW,KAAiB,EAClC;OACC,IAAI,IAAI,CAACqW,SAAS,EAClB;SACC;;OAGD,MAAMC,UAAuB,GAAGtW,KAAK,CAACuW,aAAa;OACnD,MAAMC,eAAuB,GAAGF,UAAU,CAACG,WAAW;OAEtD,IAAI,CAACJ,SAAS,GAAG,IAAIK,gBAAK,CAAC;SAC1B5a,OAAO,EAAEsK,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;SAC9DyJ,SAAS,EAAE,KAAK;SAChB6G,SAAS,EAAE,cAAc;SACzBlH,WAAW,EAAE6G,UAAU;SACvBR,SAAS,EAAE,CAAC;SACZc,WAAW,EAAE;WACZjC,QAAQ,EAAE;UACV;SACDkC,QAAQ,EAAE,IAAI;SACdnX,MAAM,EAAE;WACPiR,OAAO,EAAE,MAAY;aACpB,IAAI,CAAC0F,SAAS,CAAC5C,OAAO,EAAE;aACxB,IAAI,CAAC4C,SAAS,GAAG,IAAI;YACrB;WACDtG,MAAM,EAAG/P,KAAgB,IAAW;aACnC,MAAM8W,KAAK,GAAG9W,KAAK,CAACsC,SAAS,EAAE;aAC/B,MAAMyU,UAAU,GAAGD,KAAK,CAACE,iBAAiB,EAAE,CAACP,WAAW;aACxD,MAAM5G,UAAkB,GAAI2G,eAAe,GAAG,CAAC,GAAKO,UAAU,GAAG,CAAE;aACnE,MAAME,UAAkB,GAAGP,gBAAK,CAACQ,SAAS,CAAC,iBAAiB,CAAC,GAAGR,gBAAK,CAACQ,SAAS,CAAC,aAAa,CAAC;aAE9FJ,KAAK,CAACK,QAAQ,CAAC;eAAEjE,MAAM,EAAE6D,UAAU,GAAG,CAAC,GAAGE;cAAY,CAAC;aACvDH,KAAK,CAACM,SAAS,CAAC;eAAEvH,UAAU,EAAEA,UAAU,GAAG6G,gBAAK,CAACQ,SAAS,CAAC,iBAAiB;cAAG,CAAC;;;QAGlF,CAAC;OAEF,IAAI,CAACb,SAAS,CAACxN,IAAI,EAAE;MACrB;KAEDwO,gBAAgB,CAACrX,KAAY,EAC7B;OACC,IAAI,IAAI,CAACqW,SAAS,EAClB;SACC,IAAI,CAACA,SAAS,CAACtK,KAAK,EAAE;SACtB,IAAI,CAACsK,SAAS,GAAG,IAAI;;;IAGvB;;GAED3C,QAAQ,EAAG;;;;;;;;;CASZ,CAAC;;CC7DD;CACA;CACA;AACA,OAAa4D,wBAAiD,GAAG;GAChExY,IAAI,EAAE,iBAAiB;GACvByY,OAAO,EAAEC,oCAAoB;GAC7B3D,UAAU,EAAE;0BACX4D,0CAAmB;KACnBlD;IACA;GACDmD,KAAK,GACL;KACC,OAAO;OACNC,qBAAqB,EAAEC,eAAe,CAACC,yBAAyB;MAChE;IACD;GACD3X,IAAI,GACJ;KACC,MAAMZ,OAA+B,GAAG,IAAI,CAACwH,aAAa;KAC1D,OAAO;OACNgR,iBAAiB,EAAE7U,cAAI,CAAC8U,SAAS,CAACzY,OAAO,CAACwY,iBAAiB,CAAC,GAAGxY,OAAO,CAACwY,iBAAiB,GAAG,IAAI;OAC/FE,uBAAuB,EAAE/U,cAAI,CAAC8U,SAAS,CAACzY,OAAO,CAAC0Y,uBAAuB,CAAC,GAAG1Y,OAAO,CAAC0Y,uBAAuB,GAAG,IAAI;OACjHC,uBAAuB,EAAEhV,cAAI,CAAC8U,SAAS,CAACzY,OAAO,CAAC2Y,uBAAuB,CAAC,GAAG3Y,OAAO,CAAC2Y,uBAAuB,GAAG;MAC7G;IACD;GACDC,OAAO,GACP;KACC,OAAO;OACN7Y,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;OACvCsB,QAAQ,EAAE,IAAI,CAACtB,gBAAgB,CAACsJ,eAAe,EAAE;OACjDtC,UAAU,EAAE,IAAI,CAACA;MACjB;IACD;GACD8R,YAAY,GACZ;KACC,IAAI,CAAC9Y,gBAAgB,GAAG,IAAIuH,gBAAgB,CAAC,IAAI,CAAC;IAClD;GACDyN,OAAO,EAAE;KACRhO,UAAU,CAAC2H,IAAY,EAAEoK,YAAqC,EAC9D;OACC,OAAOhS,aAAG,CAACC,UAAU,CAAC2H,IAAI,EAAEoK,YAAY,CAAC;MACzC;KAEDvP,IAAI,CAACwP,WAAW,GAAG,KAAK,EACxB;OACC,IAAIA,WAAW,EACf;SACC,IAAI,CAAC9E,KAAK,CAACjT,SAAS,CAACgY,KAAK,CAACC,OAAO,GAAG,OAAO;;OAG7C,IAAI,CAACT,iBAAiB,GAAG,IAAI;MAC7B;KAEDvU,IAAI,CAAC8U,WAAW,GAAG,KAAK,EACxB;OACC,IAAIA,WAAW,EACf;SACC,IAAI,CAAC9E,KAAK,CAACjT,SAAS,CAACgY,KAAK,CAACC,OAAO,GAAG,MAAM;;OAG5C,IAAI,CAACT,iBAAiB,GAAG,KAAK;MAC9B;KAEDrV,iBAAiB,GACjB;OACC,IAAI,CAACuV,uBAAuB,GAAG,IAAI;MACnC;KAEDlP,iBAAiB,GACjB;OACC,IAAI,CAACkP,uBAAuB,GAAG,KAAK;MACpC;KAEDvR,iBAAiB,GACjB;OACC,IAAI,CAACwR,uBAAuB,GAAG,IAAI;MACnC;KAEDlP,iBAAiB,GACjB;OACC,IAAI,CAACkP,uBAAuB,GAAG,KAAK;MACpC;KAEDtS,kBAAkB,GAClB;OACC,IAAI,CAAC4N,KAAK,CAACiF,UAAU,CAAC7S,kBAAkB,EAAE;MAC1C;KAED8S,kBAAkB,GAClB;OACC,OAAOb,eAAe,CAACc,sBAAsB,CAAC,IAAI,CAACC,eAAe,CAAC;;IAEpE;GACDC,QAAQ,EAAE;KACTC,iBAAiB,GAAsB;OACtC,MAAMA,iBAAoC,GACzC5V,cAAI,CAACmC,aAAa,CAAC,IAAI,CAAC0B,aAAa,CAAC+R,iBAAiB,CAAC,GACrD3d,MAAM,CAAC4d,MAAM,CAAC,EAAE,EAAE,IAAI,CAAChS,aAAa,CAAC+R,iBAAiB,CAAC,GACvD,EAAE;OAGNA,iBAAiB,CAACE,KAAK,GAAG9V,cAAI,CAACmC,aAAa,CAACyT,iBAAiB,CAACE,KAAK,CAAC,GAAGF,iBAAiB,CAACE,KAAK,GAAG,EAAE;OACpGF,iBAAiB,CAACE,KAAK,CAACC,qCAAc,CAACC,eAAe,CAAC,GAAGtF,YAAY;OACtE,IAAI,IAAI,CAACtU,gBAAgB,CAACsJ,eAAe,EAAE,EAC3C;SACCkQ,iBAAiB,CAACE,KAAK,CAACC,qCAAc,CAACE,iBAAiB,CAAC,GAAGhD,oBAAoB;;OAGjF2C,iBAAiB,CAACM,kBAAkB,GAAG,IAAI;OAC3CN,iBAAiB,CAACnZ,MAAM,GAAG;SAC1B,uBAAuB,EAAGM,KAAgB,IAAW;WACpD,MAAM;aAAExF,IAAI;aAAE2Q;YAA4C,GAAGnL,KAAK,CAACsB,OAAO,EAAE;WAC5E,MAAM8X,QAAkB,GAAG,IAAIlO,QAAQ,CAAC,IAAI,CAAC7L,gBAAgB,EAAE7E,IAAI,EAAE2Q,IAAI,CAAC;WAC1EiO,QAAQ,CAAChO,KAAK,EAAE;;QAEjB;OAED,MAAMiO,YAA0B,GAAG,IAAIhK,YAAY,CAAC,IAAI,CAAChQ,gBAAgB,CAAC;OAC1E,IAAIga,YAAY,CAAChJ,QAAQ,EAAE,EAC3B;SACCwI,iBAAiB,CAACS,kBAAkB,GAAG,IAAI;SAC3CT,iBAAiB,CAACnZ,MAAM,CAAC,wBAAwB,CAAC,GAAIM,KAAgB,IAAW;WAChF,MAAM;aAAEuP;YAAQ,GAAGvP,KAAK,CAACsB,OAAO,EAAE;WAClC+X,YAAY,CAAClJ,MAAM,CAACZ,MAAM,CAAC;UAC3B;;OAGF,OAAOsJ,iBAAiB;;IAEzB;;GAEDnF,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAoCZ,CAAC;;CCpLD;CACA;CACA;AACA,CAAe,MAAMkE,eAAe,SAAS2B,iCAAiB,CAC9D;GACChgB,WAAW,CAACof,eAAgC,EAAErZ,OAA+B,EAC7E;KACC,MAAMwH,aAAqC,GAAG7D,cAAI,CAACmC,aAAa,CAAC9F,OAAO,CAAC,GAAGpE,MAAM,CAAC4d,MAAM,CAAC,EAAE,EAAExZ,OAAO,CAAC,GAAG,EAAE;KAC3G,KAAK,CAACsY,eAAe,CAACc,sBAAsB,CAACC,eAAe,CAAC,EAAE7R,aAAa,CAAC;;GAG9E0S,eAAe,GACf;KACC,OAAOlC,wBAAwB;;GAGhC,OAAOoB,sBAAsB,CAACC,eAAgC,EAC9D;KACC,OAAOzd,MAAM,CAAC4d,MAAM,CACnB,EAAE,EACFlB,eAAe,CAACC,yBAAyB,EAAE,EAC3C5U,cAAI,CAACmC,aAAa,CAACuT,eAAe,CAAC,GAAGA,eAAe,GAAG,EAAE,CAC1D;;GAGF,OAAOd,yBAAyB,GAChC;KACC,OAAO;OACN4B,UAAU,EAAE,4CAA4C;OACxDC,QAAQ,EAAE,IAAI;OACdC,WAAW,EAAE;MACb;;CAEH;;;;;;;;;;;;;"}