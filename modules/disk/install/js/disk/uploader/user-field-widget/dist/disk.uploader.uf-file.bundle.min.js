this.BX=this.BX||{};this.BX.Disk=this.BX.Disk||{};(function(e,t,s,i,l,a,o,r){"use strict";var n=babelHelpers.classPrivateFieldLooseKey("form");var d=babelHelpers.classPrivateFieldLooseKey("parserId");var c=babelHelpers.classPrivateFieldLooseKey("tag");var u=babelHelpers.classPrivateFieldLooseKey("regexp");var p=babelHelpers.classPrivateFieldLooseKey("init");var b=babelHelpers.classPrivateFieldLooseKey("parse");var h=babelHelpers.classPrivateFieldLooseKey("unparse");var v=babelHelpers.classPrivateFieldLooseKey("getIds");class g{constructor(e){Object.defineProperty(this,v,{value:P});Object.defineProperty(this,h,{value:f});Object.defineProperty(this,b,{value:F});Object.defineProperty(this,p,{value:m});Object.defineProperty(this,n,{writable:true,value:null});Object.defineProperty(this,d,{writable:true,value:"diskfile0"});Object.defineProperty(this,c,{writable:true,value:"[DISK FILE ID=#id#]"});Object.defineProperty(this,u,{writable:true,value:/\[(?:DOCUMENT ID|DISK FILE ID)=(n?[0-9]+)\]/gi});this.syncHighlightsDebounced=null;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e;this.syncHighlightsDebounced=o.Runtime.debounce(this.syncHighlights,500,this);i.EventEmitter.emit(babelHelpers.classPrivateFieldLooseBase(this,n)[n].getEventObject(),"OnParserRegister",this.getParser())}getParser(){return{id:babelHelpers.classPrivateFieldLooseBase(this,d)[d],init:babelHelpers.classPrivateFieldLooseBase(this,p)[p].bind(this),parse:babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this),unparse:babelHelpers.classPrivateFieldLooseBase(this,h)[h].bind(this)}}getHtmlEditor(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n].getHtmlEditor()}insertFile(e){const t=e.isImage?"\n":" ";const s=e.isImage?"<br>":"&nbsp;";i.EventEmitter.emit(this.getHtmlEditor(),"OnInsertContent",[t+this.createItemBBCode(e)+t,s+this.createItemHtml(e)+s]);this.syncHighlights()}removeFile(e){if(this.getHtmlEditor().GetViewMode()==="wysiwyg"){const t=this.getHtmlEditor().GetIframeDoc();Object.keys(this.getHtmlEditor().bxTags).forEach((s=>{const i=this.getHtmlEditor().bxTags[s];if(i.tag===babelHelpers.classPrivateFieldLooseBase(this,d)[d]&&i.serverFileId===e.serverFileId){const e=t.getElementById(s);if(e){e.parentNode.removeChild(e)}}}));this.getHtmlEditor().SaveContent()}else{const e=this.getHtmlEditor().GetContent().replace(babelHelpers.classPrivateFieldLooseBase(this,u)[u],((e,t)=>{const{objectId:s,attachedId:i}=babelHelpers.classPrivateFieldLooseBase(this,v)[v](t);const l=babelHelpers.classPrivateFieldLooseBase(this,n)[n].getUserFieldControl().getItems();const a=l.find((e=>e.serverFileId===i||e.customData.objectId===s));return a?"":e}));this.getHtmlEditor().SetContent(e);this.getHtmlEditor().Focus()}this.syncHighlights()}selectItem(e){e.tileWidgetData.selected=true}deselectItem(e){e.tileWidgetData.selected=false}syncHighlights(){const e=this.getHtmlEditor().GetIframeDoc();const t=new Set;Object.keys(this.getHtmlEditor().bxTags).forEach((s=>{const i=this.getHtmlEditor().bxTags[s];if(i.tag===babelHelpers.classPrivateFieldLooseBase(this,d)[d]&&e.getElementById(s)){t.add(i.serverFileId)}}));let s=false;const i=babelHelpers.classPrivateFieldLooseBase(this,n)[n].getUserFieldControl().getItems();i.forEach((e=>{if(t.has(e.serverFileId)){s=true;this.selectItem(e)}else{this.deselectItem(e)}}));if(babelHelpers.classPrivateFieldLooseBase(this,n)[n].getUserFieldControl().getPhotoTemplateMode()==="auto"){babelHelpers.classPrivateFieldLooseBase(this,n)[n].getUserFieldControl().setPhotoTemplate(s?"gallery":"grid")}}createItemHtml(e,t){const s=this.getHtmlEditor().SetBxTag(false,{tag:babelHelpers.classPrivateFieldLooseBase(this,d)[d],serverFileId:e.serverFileId,hideContextMenu:true,fileId:e.serverFileId});if(e.isImage){const t=this.getHtmlEditor().bbCode?e.previewUrl:e.serverPreviewUrl;const i=this.getHtmlEditor().bbCode?e.previewWidth:e.serverPreviewWidth;const l=this.getHtmlEditor().bbCode?e.previewHeight:e.serverPreviewHeight;const a=600;const r=600;const n=a/i;const d=r/l;const c=Math.min(n,d);const u=c>1;const p=u?i:i*c;const b=u?l:l*c;return`<img style="max-width: 90%;" width="${p}" height="${b}" data-bx-file-id="${o.Text.encode(e.serverFileId)}" id="${s}" src="${t}" title="${o.Text.encode(e.name)}" data-bx-paste-check="Y" />`}else if(e.customData.fileType==="player"){return`<img contenteditable="false" class="bxhtmled-player-surrogate" data-bx-file-id="${o.Text.encode(e.serverFileId)}" id="${s}" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-bx-paste-check="Y" />`}return`<span contenteditable="false" data-bx-file-id="${o.Text.encode(e.serverFileId)}" id="${s}" style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;">${o.Text.encode(e.name)}</span>`}createItemBBCode(e){return babelHelpers.classPrivateFieldLooseBase(this,c)[c].replace("#id#",e.serverFileId)}}function m(e){}function F(e){if(!babelHelpers.classPrivateFieldLooseBase(this,u)[u].test(e)){return e}this.syncHighlightsDebounced();return e.replace(babelHelpers.classPrivateFieldLooseBase(this,u)[u],((e,t)=>{const{objectId:s,attachedId:i}=babelHelpers.classPrivateFieldLooseBase(this,v)[v](t);const l=babelHelpers.classPrivateFieldLooseBase(this,n)[n].getUserFieldControl().getItems();const a=l.find((e=>e.serverFileId===i||e.customData.objectId===s));if(a){this.selectItem(a);return this.createItemHtml(a,t)}return e}))}function f(e){const{serverFileId:t}=e;const s=babelHelpers.classPrivateFieldLooseBase(this,n)[n].getUserFieldControl().getItems();const i=s.find((e=>e.serverFileId===t));if(i){return this.createItemBBCode(i)}return""}function P(e){let t=null;let s=null;if(e[0]==="n"){t=o.Text.toInteger(e.replace("n",""))}else{s=o.Text.toInteger(e)}return{objectId:t,attachedId:s}}let L=e=>e,D;var B=babelHelpers.classPrivateFieldLooseKey("userFieldControl");var H=babelHelpers.classPrivateFieldLooseKey("createDocumentButton");var E=babelHelpers.classPrivateFieldLooseKey("eventObject");var I=babelHelpers.classPrivateFieldLooseKey("htmlParser");var y=babelHelpers.classPrivateFieldLooseKey("htmlEditor");var C=babelHelpers.classPrivateFieldLooseKey("inited");var T=babelHelpers.classPrivateFieldLooseKey("handleDocumentReady");var k=babelHelpers.classPrivateFieldLooseKey("handlePostFormReady");var w=babelHelpers.classPrivateFieldLooseKey("init");var O=babelHelpers.classPrivateFieldLooseKey("getPostForm");var U=babelHelpers.classPrivateFieldLooseKey("bindEventObject");var S=babelHelpers.classPrivateFieldLooseKey("bindAdapterEvents");var A=babelHelpers.classPrivateFieldLooseKey("handleReinitializeBefore");var M=babelHelpers.classPrivateFieldLooseKey("addCreateDocumentButton");var j=babelHelpers.classPrivateFieldLooseKey("handleButtonClick");class x extends i.EventEmitter{constructor(e,t){super();Object.defineProperty(this,j,{value:G});Object.defineProperty(this,M,{value:V});Object.defineProperty(this,A,{value:N});Object.defineProperty(this,S,{value:$});Object.defineProperty(this,U,{value:X});Object.defineProperty(this,O,{value:K});Object.defineProperty(this,w,{value:W});Object.defineProperty(this,k,{value:R});Object.defineProperty(this,T,{value:_});Object.defineProperty(this,B,{writable:true,value:null});Object.defineProperty(this,H,{writable:true,value:null});Object.defineProperty(this,E,{writable:true,value:null});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,y,{writable:true,value:null});Object.defineProperty(this,C,{writable:true,value:false});this.setEventNamespace("BX.Disk.Uploader.Integration");babelHelpers.classPrivateFieldLooseBase(this,B)[B]=e;babelHelpers.classPrivateFieldLooseBase(this,E)[E]=t.eventObject;babelHelpers.classPrivateFieldLooseBase(this,U)[U]();this.subscribeFromOptions(t.events);this.subscribeOnce("onReady",(()=>{if(babelHelpers.classPrivateFieldLooseBase(this,B)[B].canCreateDocuments()){babelHelpers.classPrivateFieldLooseBase(this,M)[M]()}}));o.Event.ready(babelHelpers.classPrivateFieldLooseBase(this,T)[T].bind(this))}getUserFieldControl(){return babelHelpers.classPrivateFieldLooseBase(this,B)[B]}getParser(){return babelHelpers.classPrivateFieldLooseBase(this,I)[I]}getHtmlEditor(){return babelHelpers.classPrivateFieldLooseBase(this,y)[y]}getEventObject(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E]}selectFileButton(){const e=new i.BaseEvent({data:"show",compatData:["user-field-widget"]});i.EventEmitter.emit(babelHelpers.classPrivateFieldLooseBase(this,E)[E],"onShowControllers",e)}deselectFileButton(){const e=new i.BaseEvent({data:"hide",compatData:["user-field-widget"]});i.EventEmitter.emit(babelHelpers.classPrivateFieldLooseBase(this,E)[E],"onShowControllers",e)}selectCreateDocumentButton(){if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]){const e=babelHelpers.classPrivateFieldLooseBase(this,H)[H].closest('[data-id="disk-document"]');if(e){e.setAttribute("data-bx-button-status","active")}}}deselectCreateDocumentButton(){if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]){const e=babelHelpers.classPrivateFieldLooseBase(this,H)[H].closest('[data-id="disk-document"]');if(e){e.removeAttribute("data-bx-button-status")}}}}function _(){const e=babelHelpers.classPrivateFieldLooseBase(this,O)[O]();if(e===null){setTimeout((()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,O)[O]();if(e){babelHelpers.classPrivateFieldLooseBase(this,k)[k](e)}else{console.error("Disk User Field: Post Form Not Found.")}}),100)}else{babelHelpers.classPrivateFieldLooseBase(this,k)[k](e)}}function R(e){if(e.isReady){babelHelpers.classPrivateFieldLooseBase(this,w)[w](e)}else{i.EventEmitter.subscribe(e,"OnEditorIsLoaded",(()=>{babelHelpers.classPrivateFieldLooseBase(this,w)[w](e)}))}}function W(e){babelHelpers.classPrivateFieldLooseBase(this,S)[S]();babelHelpers.classPrivateFieldLooseBase(this,y)[y]=e.getEditor();babelHelpers.classPrivateFieldLooseBase(this,I)[I]=new g(this);i.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,y)[y],"OnContentChanged",(e=>{babelHelpers.classPrivateFieldLooseBase(this,I)[I].syncHighlightsDebounced()}));i.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,y)[y],"BXEditor:onBeforePasteAsync",(e=>new Promise(((t,s)=>{const i=e.getData().clipboardEvent;const a=i.clipboardData;i.stopImmediatePropagation();if(!a||!l.isFilePasted(a)){t();return}i.preventDefault();e.preventDefault();l.getFilesFromDataTransfer(a).then((e=>{e.forEach((e=>{this.getUserFieldControl().getUploader().addFile(e,{events:{[l.FileEvent.LOAD_ERROR]:()=>{},[l.FileEvent.UPLOAD_ERROR]:()=>{},[l.FileEvent.LOAD_COMPLETE]:e=>{},[l.FileEvent.UPLOAD_COMPLETE]:e=>{const t=e.getTarget();const s=this.getUserFieldControl().getItem(t.getId());if(s){this.getUserFieldControl().showUploaderPanel();this.getParser().insertFile(s)}}}})}));t()})).catch((()=>{t()}))}))));this.emit("onReady");babelHelpers.classPrivateFieldLooseBase(this,C)[C]=true}function K(){const e=o.Reflection.getClass("BX.Main.PostForm");if(!e){return null}let t=null;e.repo.forEach((e=>{if(e.getEventObject()===this.getEventObject()){t=e}}));return t}function X(){i.EventEmitter.subscribe(this.getEventObject(),"onShowControllers",(e=>{if(o.Type.isArrayFilled(e.getCompatData())&&e.getCompatData()[0]==="user-field-widget"){return}const t=o.Type.isArray(e.getData())?e.getData().shift():e.getData();if(t==="show"){this.getUserFieldControl().showUploaderPanel()}else{this.getUserFieldControl().hide()}}));i.EventEmitter.subscribe(this.getEventObject(),"onReinitializeBeforeAsync",(e=>new Promise((t=>{if(babelHelpers.classPrivateFieldLooseBase(this,C)[C]){babelHelpers.classPrivateFieldLooseBase(this,A)[A](e).then((()=>t()))}else{this.subscribeOnce("onReady",(()=>{babelHelpers.classPrivateFieldLooseBase(this,A)[A](e).then((()=>t()))}))}}))));i.EventEmitter.subscribe(this.getEventObject(),"onCollectControllers",(e=>{const t=e.getData();const s=this.getUserFieldControl().getUploader().getHiddenFieldName();const i=this.getUserFieldControl().getItems().map((e=>e.serverFileId));t[s]={storage:"disk",tag:"[DISK FILE ID=#id#]",values:i,handler:{selectFile:(e,t,s)=>{Object.values(s).forEach((e=>{this.getUserFieldControl().getUploader().addFile(e)}))},removeFiles:e=>{if(e!==undefined&&Array.isArray(e)){const t=this.getUserFieldControl().getUploader();const s=t.getFiles();let i=e.map((e=>s.find((t=>t.getServerFileId()===e)).getId()));i.forEach((e=>{t.removeFile(e)}))}}}}}));i.EventEmitter.subscribe(this.getEventObject(),"OnVideoHasCaught",(e=>{e.stopImmediatePropagation();this.getUserFieldControl().getUploader().addFile(e.getData(),{events:{[l.FileEvent.UPLOAD_COMPLETE]:e=>{const t=e.getTarget();const s=this.getUserFieldControl().getItem(t.getId());if(s){this.getUserFieldControl().showUploaderPanel();this.getParser().insertFile(s)}}}})}));i.EventEmitter.subscribe(this.getEventObject(),"OnImageHasCaught",(e=>{e.stopImmediatePropagation();return new Promise(((t,s)=>{this.getUserFieldControl().getUploader().addFile(e.getData(),{events:{[l.FileEvent.LOAD_ERROR]:e=>{const t=e.getData().error;s(t)},[l.FileEvent.UPLOAD_ERROR]:()=>e=>{const t=e.getData().error;s(t)},[l.FileEvent.UPLOAD_COMPLETE]:e=>{const i=e.getTarget();const a=this.getUserFieldControl().getItem(i.getId());if(a){this.getParser().syncHighlights();t({image:{src:i.getPreviewUrl(),width:i.getPreviewWidth(),height:i.getPreviewHeight()},html:this.getParser().createItemHtml(a)})}else{s(new l.UploaderError("WRONG_FILE_SOURCE"))}}}})}))}));i.EventEmitter.subscribe(this.getEventObject(),"onFilesHaveCaught",(e=>{e.stopImmediatePropagation()}));i.EventEmitter.subscribe(this.getEventObject(),"onFilesHaveDropped",(e=>{e.stopImmediatePropagation();const t=e.getData().event;l.getFilesFromDataTransfer(t.dataTransfer).then((e=>{this.getUserFieldControl().getUploader().addFiles(e)})).catch((()=>{}))}))}function $(){const e=this.getUserFieldControl().getAdapter();e.subscribe("Item:onAdd",(()=>{i.EventEmitter.emit(this.getEventObject(),"onShowControllers:File:Increment")}));e.subscribe("Item:onRemove",(e=>{i.EventEmitter.emit(this.getEventObject(),"onShowControllers:File:Decrement");const t=e.getData().item;if(this.getParser()){this.getParser().removeFile(t)}}))}function N(e){this.getUserFieldControl().clear();const[,t]=e.getData();const s=this.getUserFieldControl().getUploader().getHiddenFieldName();const i=t&&t[s]&&t[s]["USER_TYPE_ID"]==="disk_file"?t[s]:null;if(i!==null){if(o.Type.isPlainObject(i["CUSTOM_DATA"])&&o.Type.isStringFilled(i["CUSTOM_DATA"]["PHOTO_TEMPLATE"])){this.getUserFieldControl().setPhotoTemplateMode("manual");this.getUserFieldControl().setPhotoTemplate(i["CUSTOM_DATA"]["PHOTO_TEMPLATE"])}else{this.getUserFieldControl().setPhotoTemplateMode("auto")}}else{this.getUserFieldControl().setPhotoTemplateMode("auto");this.getUserFieldControl().setPhotoTemplate("grid")}if(i===null){return Promise.resolve()}if(o.Type.isArray(i["FILES"])){return babelHelpers.classPrivateFieldLooseBase(this,B)[B].nextTick().then((()=>{i["FILES"].forEach((e=>{if(!this.getUserFieldControl().getUploader().getFile(e.serverFileId)){this.getUserFieldControl().getUploader().addFile(e)}}));if(this.getUserFieldControl().getUploader().getFiles().length>0){babelHelpers.classPrivateFieldLooseBase(this,B)[B].enableAutoCollapse()}}))}else if(o.Type.isArrayFilled(i["VALUE"])){return babelHelpers.classPrivateFieldLooseBase(this,B)[B].nextTick().then((()=>new Promise((e=>{let t=i["VALUE"];t=t.filter((e=>!this.getUserFieldControl().getUploader().getFile(e)));let s=0;let a=[];const o=()=>{s++;if(s===a.length){e()}};const r={[l.FileEvent.LOAD_COMPLETE]:o,[l.FileEvent.LOAD_ERROR]:o};const n=t.map((e=>[e,{events:r}]));if(n.length>0){a=this.getUserFieldControl().getUploader().addFiles(n);if(a.length===0){e()}else{babelHelpers.classPrivateFieldLooseBase(this,B)[B].enableAutoCollapse()}}else{e()}}))))}return Promise.resolve()}function V(){babelHelpers.classPrivateFieldLooseBase(this,H)[H]=o.Tag.render(D||(D=L`
			<div onclick="${0}">
				<i></i>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,j)[j].bind(this),o.Loc.getMessage("DISK_UF_WIDGET_CREATE_DOCUMENT"));i.EventEmitter.emit(this.getEventObject(),"OnAddButton",[{BODY:babelHelpers.classPrivateFieldLooseBase(this,H)[H],ID:"disk-document"},"file"])}function G(){const e=babelHelpers.classPrivateFieldLooseBase(this,H)[H].closest('[data-id="disk-document"]');if(e&&e.hasAttribute("data-bx-button-status")){this.getUserFieldControl().hide()}else{this.getUserFieldControl().showDocumentPanel()}}let z=e=>e,Y,q;const Q=new Map;var Z=babelHelpers.classPrivateFieldLooseKey("id");var J=babelHelpers.classPrivateFieldLooseKey("adapter");var ee=babelHelpers.classPrivateFieldLooseKey("mainPostForm");var te=babelHelpers.classPrivateFieldLooseKey("allowDocumentFieldName");var se=babelHelpers.classPrivateFieldLooseKey("photoTemplateFieldName");var ie=babelHelpers.classPrivateFieldLooseKey("photoTemplateInput");var le=babelHelpers.classPrivateFieldLooseKey("photoTemplateMode");var ae=babelHelpers.classPrivateFieldLooseKey("widgetComponent");class oe extends i.EventEmitter{constructor(e){super();Object.defineProperty(this,Z,{writable:true,value:null});Object.defineProperty(this,J,{writable:true,value:null});Object.defineProperty(this,ee,{writable:true,value:null});Object.defineProperty(this,te,{writable:true,value:null});Object.defineProperty(this,se,{writable:true,value:null});Object.defineProperty(this,ie,{writable:true,value:null});Object.defineProperty(this,le,{writable:true,value:"auto"});Object.defineProperty(this,ae,{writable:true,value:null});this.setEventNamespace("BX.Disk.Uploader.Integration");babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=e;babelHelpers.classPrivateFieldLooseBase(this,J)[J]=e.adapter;const t=o.Type.isPlainObject(e.widgetOptions)?e.widgetOptions:{};babelHelpers.classPrivateFieldLooseBase(this,se)[se]=o.Type.isStringFilled(t.photoTemplateFieldName)?t.photoTemplateFieldName:null;babelHelpers.classPrivateFieldLooseBase(this,te)[te]=o.Type.isStringFilled(t.allowDocumentFieldName)?t.allowDocumentFieldName:null;babelHelpers.classPrivateFieldLooseBase(this,J)[J].subscribe("Item:onComplete",(e=>{const t=e.getData().item;this.setDocumentEdit(t)}));babelHelpers.classPrivateFieldLooseBase(this,J)[J].subscribe("Item:onRemove",(e=>{const t=e.getData().item;this.removeAllowDocumentEditInput(t)}));if(t.disableLocalEdit){BX.Disk.Document.Local.Instance.disable()}if(babelHelpers.classPrivateFieldLooseBase(this,se)[se]!==null&&this.getUploader().getHiddenFieldsContainer()!==null){babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]=o.Tag.render(Y||(Y=z`
					<input 
						name="${0}" 
						value="${0}"
						type="hidden" 
					/>
				`),babelHelpers.classPrivateFieldLooseBase(this,se)[se],o.Type.isStringFilled(t.photoTemplate)?t.photoTemplate:"grid");this.setPhotoTemplateMode(t.photoTemplateMode);o.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,ie)[ie],this.getUploader().getHiddenFieldsContainer())}const s=o.Type.isElementNode(t.eventObject)?t.eventObject:null;if(s){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=new x(this,{eventObject:s,events:{onReady:()=>{this.getUploader().addFiles(t.files);if(this.getUploader().getFiles().length>0){this.showUploaderPanel();this.enableAutoCollapse()}}}})}else{this.getUploader().addFiles(t.files)}babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=o.Type.isStringFilled(t.mainPostFormId)?t.mainPostFormId:`user-field-control-${o.Text.getRandom().toLowerCase()}`;Q.set(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z],this)}static getById(e){return Q.get(e)||null}static getInstances(){return[...Q.values()]}canCreateDocuments(){const e=o.Extension.getSettings("disk.uploader.user-field-widget");const t=e.get("canCreateDocuments",false);return t&&babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].widgetOptions.canCreateDocuments!==false}getAdapter(){return babelHelpers.classPrivateFieldLooseBase(this,J)[J]}getMainPostForm(){return babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]}getItems(){return babelHelpers.classPrivateFieldLooseBase(this,J)[J].getItems()}getItem(e){return babelHelpers.classPrivateFieldLooseBase(this,J)[J].getItem(e)}getFiles(){return babelHelpers.classPrivateFieldLooseBase(this,J)[J].getUploader().getFiles()}getFile(e){return babelHelpers.classPrivateFieldLooseBase(this,J)[J].getUploader().getFile(e)}getUploader(){return babelHelpers.classPrivateFieldLooseBase(this,J)[J].getUploader()}nextTick(){return babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].$nextTick()}show(){babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].show(true)}hide(){babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].hide(true);this.hideUploaderPanel();this.hideDocumentPanel()}showUploaderPanel(){this.show();this.hideDocumentPanel();babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].showUploaderPanel();if(this.getMainPostForm()){this.getMainPostForm().selectFileButton()}}hideUploaderPanel(){babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].hideUploaderPanel();if(this.getMainPostForm()){this.getMainPostForm().deselectFileButton()}}showDocumentPanel(){if(!this.canCreateDocuments()){return}this.show();this.hideUploaderPanel();babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].showDocumentPanel();if(this.getMainPostForm()){this.getMainPostForm().selectCreateDocumentButton()}}hideDocumentPanel(){if(!this.canCreateDocuments()){return}babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].hideDocumentPanel();if(this.getMainPostForm()){this.getMainPostForm().deselectCreateDocumentButton()}}clear(){this.getUploader().removeFiles({removeFromServer:false})}enableAutoCollapse(){babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].enableAutoCollapse()}canAllowDocumentEdit(){return babelHelpers.classPrivateFieldLooseBase(this,te)[te]!==null&&this.getUploader().getHiddenFieldsContainer()!==null}canItemAllowEdit(e){return this.canAllowDocumentEdit()&&e.customData["isEditable"]===true&&e.customData["canUpdate"]===true}getAllowDocumentEditInput(e){const t=`input[name='${babelHelpers.classPrivateFieldLooseBase(this,te)[te]}[${e.serverFileId}]']`;if(this.getUploader().getHiddenFieldsContainer()!==null){return this.getUploader().getHiddenFieldsContainer().querySelector(t)}return null}removeAllowDocumentEditInput(e){const t=this.getAllowDocumentEditInput(e);if(t!==null){o.Dom.remove(t)}}setDocumentEdit(e,t=null){if(!this.canItemAllowEdit(e)){return}let s=this.getAllowDocumentEditInput(e);if(s===null){s=o.Tag.render(q||(q=z`<input name="${0}[${0}]" type="hidden" />`),babelHelpers.classPrivateFieldLooseBase(this,te)[te],e.serverFileId);o.Dom.append(s,this.getUploader().getHiddenFieldsContainer())}t=t===null?e.customData["allowEdit"]===true:t;s.value=t?1:0;const i=this.getFile(e.id);i.setCustomData("allowEdit",t)}canChangePhotoTemplate(){return babelHelpers.classPrivateFieldLooseBase(this,se)[se]!==null}setPhotoTemplate(e){if(o.Type.isStringFilled(e)&&babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]!==null){babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].value=e}}getPhotoTemplate(){return babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]!==null?babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].value:""}setPhotoTemplateMode(e){if(e==="auto"||e==="manual"){babelHelpers.classPrivateFieldLooseBase(this,le)[le]=e}}getPhotoTemplateMode(){return babelHelpers.classPrivateFieldLooseBase(this,le)[le]}getDocumentServices(){const e=o.Extension.getSettings("disk.uploader.user-field-widget");const t=e.get("documentHandlers",{});if(o.Type.isPlainObject(t)){return t}return{}}getCurrentDocumentService(){let e=BX.Disk.getDocumentService();if(!e&&BX.Disk.isAvailableOnlyOffice()){e="onlyoffice"}else if(!e){e="l"}return this.getDocumentServices()[e]||null}getImportServices(){const e=o.Extension.getSettings("disk.uploader.user-field-widget");const t=e.get("importHandlers",{});if(o.Type.isPlainObject(t)){return t}return{}}}const re=(e,t={})=>new Promise((s=>{o.Runtime.loadExtension("disk.legacy.file-dialog").then((()=>{const l=t=>{const[a]=t.getData();if(e===a){i.EventEmitter.unsubscribe(BX.DiskFileDialog,"inited",l);s()}};i.EventEmitter.subscribe(BX.DiskFileDialog,"inited",l);o.ajax.get(ne(e,t))}))}));const ne=(e,t={})=>{const s=`/bitrix/tools/disk/uf.php?action=openDialog&SITE_ID=${o.Loc.getMessage("SITE_ID")}&dialog2=Y&ACTION=SELECT&MULTI=Y&dialogName=${e}`;return o.Uri.addParam(s,t)};let de=e=>e,ce,ue;var pe=babelHelpers.classPrivateFieldLooseKey("userFieldControl");var be=babelHelpers.classPrivateFieldLooseKey("item");var he=babelHelpers.classPrivateFieldLooseKey("menu");var ve=babelHelpers.classPrivateFieldLooseKey("folderDialogId");var ge=babelHelpers.classPrivateFieldLooseKey("showRenameMenu");class me{constructor(e,t,s){Object.defineProperty(this,ge,{value:Fe});Object.defineProperty(this,pe,{writable:true,value:null});Object.defineProperty(this,be,{writable:true,value:null});Object.defineProperty(this,he,{writable:true,value:null});Object.defineProperty(this,ve,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]=e;babelHelpers.classPrivateFieldLooseBase(this,be)[be]=t;babelHelpers.classPrivateFieldLooseBase(this,he)[he]=s;babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]=`folder-dialog-${o.Text.getRandom(5)}`}build(){var e,t;const s=(e=(t=babelHelpers.classPrivateFieldLooseBase(this,he)[he].getMenuItems()[0])==null?void 0:t.id)!=null?e:"";babelHelpers.classPrivateFieldLooseBase(this,he)[he].getPopupWindow().setMaxWidth(500);babelHelpers.classPrivateFieldLooseBase(this,he)[he].addMenuItem({id:"filesize",text:o.Loc.getMessage("DISK_UF_WIDGET_FILE_SIZE",{"#filesize#":babelHelpers.classPrivateFieldLooseBase(this,be)[be].sizeFormatted}),disabled:true},s);babelHelpers.classPrivateFieldLooseBase(this,he)[he].addMenuItem({delimiter:true},s);const i=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].getMainPostForm();if(i){babelHelpers.classPrivateFieldLooseBase(this,he)[he].addMenuItem({id:"insert-into-text",text:o.Loc.getMessage("DISK_UF_WIDGET_INSERT_INTO_THE_TEXT"),onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,he)[he].close();i.getParser().insertFile(babelHelpers.classPrivateFieldLooseBase(this,be)[be])}},s)}if(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].canItemAllowEdit(babelHelpers.classPrivateFieldLooseBase(this,be)[be])){babelHelpers.classPrivateFieldLooseBase(this,he)[he].addMenuItem({delimiter:true});babelHelpers.classPrivateFieldLooseBase(this,he)[he].addMenuItem({id:"allow-edit",className:babelHelpers.classPrivateFieldLooseBase(this,be)[be].customData["allowEdit"]===true?"disk-user-field-item-checked":"",text:o.Loc.getMessage("DISK_UF_WIDGET_ALLOW_DOCUMENT_EDIT"),onclick:(e,t)=>{if(babelHelpers.classPrivateFieldLooseBase(this,be)[be].customData["allowEdit"]===true){babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].setDocumentEdit(babelHelpers.classPrivateFieldLooseBase(this,be)[be],false)}else{babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].setDocumentEdit(babelHelpers.classPrivateFieldLooseBase(this,be)[be],true)}t.getMenuWindow().close()}})}if(babelHelpers.classPrivateFieldLooseBase(this,be)[be].customData["canRename"]){babelHelpers.classPrivateFieldLooseBase(this,he)[he].addMenuItem({delimiter:true});babelHelpers.classPrivateFieldLooseBase(this,he)[he].addMenuItem({id:"rename",text:o.Loc.getMessage("DISK_UF_WIDGET_RENAME_FILE_MENU_TITLE"),events:{"SubMenu:onShow":e=>{const t=e.getTarget();babelHelpers.classPrivateFieldLooseBase(this,ge)[ge](t)}},items:[{id:"rename-textarea",html:'<div class="disk-user-field-rename-loading"></div>',className:"disk-user-field-rename-menu-item"}]})}if(o.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,be)[be].customData["storage"])){babelHelpers.classPrivateFieldLooseBase(this,he)[he].addMenuItem({delimiter:true});if(babelHelpers.classPrivateFieldLooseBase(this,be)[be].customData["canMove"]){babelHelpers.classPrivateFieldLooseBase(this,he)[he].addMenuItem({id:"storage",text:babelHelpers.classPrivateFieldLooseBase(this,be)[be].customData["storage"]+"&mldr;",onclick:()=>{this.openFolderDialog();babelHelpers.classPrivateFieldLooseBase(this,he)[he].close()},disabled:babelHelpers.classPrivateFieldLooseBase(this,be)[be].tileWidgetData.selected===true})}else{babelHelpers.classPrivateFieldLooseBase(this,he)[he].addMenuItem({id:"storage",text:babelHelpers.classPrivateFieldLooseBase(this,be)[be].customData["storage"],disabled:true})}}}rename(e){return new Promise(((t,s)=>{o.ajax.runAction("disk.api.commonActions.rename",{data:{objectId:babelHelpers.classPrivateFieldLooseBase(this,be)[be].customData["objectId"],newName:e,autoCorrect:true,generateUniqueName:true}}).then((e=>{var s,i;if((e==null?void 0:e.status)==="success"&&(e==null?void 0:(s=e.data)==null?void 0:(i=s.object)==null?void 0:i.name)!==babelHelpers.classPrivateFieldLooseBase(this,be)[be].name){const t=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].getFile(babelHelpers.classPrivateFieldLooseBase(this,be)[be].id);const s=e.data.object.name;t.setName(s)}t()})).catch((e=>{BX.Disk.showModalWithStatusAction(e);s()}))}))}openFolderDialog(){re(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve],{wish:"fakemove"}).then((()=>{BX.DiskFileDialog.obCallback[babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]]={saveButton:(e,t,s,i)=>{const l=Object.values(s)[0]||i;if(!l){return}const a=l.id==="root"?e.rootObjectId:l.id;o.ajax.runAction("disk.api.commonActions.move",{data:{objectId:babelHelpers.classPrivateFieldLooseBase(this,be)[be].customData["objectId"],toFolderId:a}}).then((t=>{if((t==null?void 0:t.status)==="success"){const s=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].getFile(babelHelpers.classPrivateFieldLooseBase(this,be)[be].id);const i=t.data.object.name;const a=t.data.object.id;s.setServerFileId(`n${a}`);s.setName(i);if(l.id==="root"){s.setCustomData("storage",`${e.name} / `)}else{s.setCustomData("storage",`${e.name} / ${l.name}`)}}})).catch((e=>{BX.Disk.showModalWithStatusAction(e)}))}};if(BX.DiskFileDialog.popupWindow===null){BX.DiskFileDialog.openDialog(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve])}}))}}function Fe(e){o.Runtime.loadExtension("ui.buttons").then((t=>{const s=t.Button;const i=t.ButtonSize;const a=t.ButtonColor;const r=t.CancelButton;const n=e=>{if(e.code==="Enter"){c()}};const d=l.getFilenameWithoutExtension(babelHelpers.classPrivateFieldLooseBase(this,be)[be].name);const c=()=>{const t=u.value.trim();if(!o.Type.isStringFilled(t)||t===d){e.getMenuWindow().close();return}p.setWaiting(true);const s=`${t}.${l.getFileExtension(babelHelpers.classPrivateFieldLooseBase(this,be)[be].name)}`;this.rename(s).then((()=>{p.setWaiting(false);e.getMenuWindow().close()})).catch((()=>{p.setWaiting(false)}))};const u=o.Tag.render(ce||(ce=de`
				<textarea 
					class="disk-user-field-rename-textarea" 
					onkeydown="${0}"
				>${0}</textarea>
			`),n,o.Text.encode(d));const p=new s({text:o.Loc.getMessage("DISK_UF_WIDGET_RENAME_FILE_BUTTON_TITLE"),color:a.PRIMARY,size:i.SMALL,onclick:c});const b=new r({size:i.SMALL,onclick:()=>{e.getMenuWindow().close()}});const h=e.getSubMenu();const v=h.getMenuItem("rename-textarea");v.setText(o.Tag.render(ue||(ue=de`
					<div class="disk-user-field-rename-form">
						${0}
						<div class="disk-user-field-rename-buttons">${0}</div>
					</div>
				`),u,[p.render(),b.render()]),true);e.showSubMenu()}))}var fe=babelHelpers.classPrivateFieldLooseKey("userFieldControl");var Pe=babelHelpers.classPrivateFieldLooseKey("menu");var Le=babelHelpers.classPrivateFieldLooseKey("getItems");class De{constructor(e){Object.defineProperty(this,Le,{value:Be});Object.defineProperty(this,fe,{writable:true,value:null});Object.defineProperty(this,Pe,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]=e}getMenu(e){if(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]!==null){return babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]}babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=new r.Menu({bindElement:e.getContainer(),className:"disk-user-field-settings-popup",angle:true,autoHide:true,offsetLeft:16,cacheable:false,items:babelHelpers.classPrivateFieldLooseBase(this,Le)[Le](),events:{onShow:()=>{e.select()},onDestroy:()=>{e.deselect();babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=null}}});return babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]}show(e){this.getMenu(e).show()}toggle(e){if(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]!==null&&babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].getPopupWindow().isShown()){babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].close()}else{this.show(e)}}hide(){if(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]!==null){babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].close()}}hasItems(){return babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]().length>0}}function Be(){if(!babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].canChangePhotoTemplate()){return[]}return[{className:babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].getPhotoTemplate()==="grid"?"disk-user-field-item-checked":"",text:o.Loc.getMessage("DISK_UF_WIDGET_ALLOW_PHOTO_COLLAGE"),onclick:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].setPhotoTemplateMode("manual");if(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].getPhotoTemplate()==="grid"){babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].setPhotoTemplate("gallery")}else{babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].setPhotoTemplate("grid")}t.getMenuWindow().close()}}]}const He=new Set;const Ee=e=>{e=o.Type.isPlainObject(e)?e:{};const t=o.Type.isStringFilled(e.dialogId)?e.dialogId:`file-dialog-${o.Text.getRandom(5)}`;const s=o.Type.isFunction(e.onLoad)?e.onLoad:null;const i=o.Type.isFunction(e.onSelect)?e.onSelect:null;const a=o.Type.isFunction(e.onClose)?e.onClose:null;const r=e.uploader instanceof l.Uploader?e.uploader:null;if(He.has(t)){return}He.add(t);re(t).then((()=>{He.delete(t);if(s!==null){s()}BX.DiskFileDialog.obCallback[t]={saveButton:(e,t,s)=>{Object.values(s).forEach((e=>{if(r!==null){r.addFile(e.id,{name:e.name,preload:true})}}));if(i!==null){i(e,t,s)}},popupDestroy:()=>{He.delete(t);if(a!==null){a()}}};if(BX.DiskFileDialog.popupWindow===null){BX.DiskFileDialog.openDialog(t)}}))};class Ie extends l.AbstractLoadController{constructor(e,t={}){super(e,t)}load(e){this.emit("onProgress",{progress:100});this.emit("onLoad")}abort(){}}var ye=babelHelpers.classPrivateFieldLooseKey("fileId");var Ce=babelHelpers.classPrivateFieldLooseKey("serviceId");class Te extends l.AbstractUploadController{constructor(e,t={}){super(e,t);Object.defineProperty(this,ye,{writable:true,value:null});Object.defineProperty(this,Ce,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]=t.fileId;babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]=t.serviceId}upload(e){BX.Disk.ExternalLoader.startLoad({file:{id:babelHelpers.classPrivateFieldLooseBase(this,ye)[ye],service:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]},onFinish:e=>{this.emit("onUpload",{fileInfo:e.fileInfo})},onProgress:e=>{this.emit("onProgress",{progress:e})},onError:e=>{this.emit("onError",{error:l.UploaderError.createFromAjaxErrors(e)})}})}abort(){}}const ke=new Set;const we=e=>{e=o.Type.isPlainObject(e)?e:{};const t=o.Type.isStringFilled(e.dialogId)?e.dialogId:`cloud-dialog-${o.Text.getRandom(5)}`;const s=o.Type.isStringFilled(e.serviceId)?e.serviceId:"gdrive";const i=o.Type.isFunction(e.onLoad)?e.onLoad:null;const r=o.Type.isFunction(e.onSelect)?e.onSelect:null;const n=o.Type.isFunction(e.onClose)?e.onClose:null;const d=e.uploader instanceof l.Uploader?e.uploader:null;if(ke.has(t)){return}ke.add(t);re(t,{service:s,cloudImport:1}).then((()=>{ke.delete(t);if(i!==null){i()}BX.DiskFileDialog.obCallback[t]={saveButton:(e,t,s)=>{o.Runtime.loadExtension("disk.legacy.external-loader").then((()=>{Object.values(s).forEach((e=>{if(e.type==="file"&&d!==null){d.addFile({id:e.id,serverFileId:e.id,name:e.name,size:o.Text.toNumber(e.sizeInt),loadController:new Ie(d.getServer(),{fileId:e.id,serviceId:e.provider}),uploadController:new Te(d.getServer(),{fileId:e.id,serviceId:e.provider})})}}));if(r!==null){r(e,t,s)}}))},popupDestroy:()=>{ke.delete(t);if(n!==null){n()}}};if(s==="gdrive"){o.ajax({url:"/bitrix/tools/disk/uf.php?action=getGoogleAppData",dataType:"json",onsuccess(s){if(s.authUrl){BX.util.popup(s.authUrl,1030,700);o.Event.bind(window,"hashchange",(()=>{const t=document.location.hash.match(/external-auth-(\w+)/);if(!t){return}BX.DiskFileDialog.sendRequest=false;we(e)}))}else{const e=new a.GoogleDrivePicker(s.clientId,s.appId,s.apiKey,s.accessToken,BX.DiskFileDialog.obCallback[t]);e.loadAndOpenPicker()}},onfailure(e){BX.DiskFileDialog.sendRequest=false}});return}if(BX.DiskFileDialog.popupWindow===null){BX.DiskFileDialog.openDialog(t)}}))};const Oe={name:"Loader",props:{size:{type:Number,default:70},color:{type:String,default:"#2fc6f6"},offset:{type:Object,default:null},mode:{type:String,default:""}},created(){this.loader=null},mounted(){o.Runtime.loadExtension("main.loader").then((e=>{const{Loader:t}=e;this.loader=new t({target:this.$refs.container,size:this.size,color:this.color,offset:this.offset,mode:this.mode});this.loader.show()}))},beforeUnmount(){if(this.loader){this.loader.destroy();this.loader=null}},template:`<span ref="container"></span>`};const Ue={name:"ControlPanel",inject:["userFieldControl","uploader","getMessage"],components:{Loader:Oe},data:()=>({showDialogLoader:false,showCloudDialogLoader:false,currentServiceId:null}),created(){this.fileDialogId=`file-dialog-${o.Text.getRandom(5)}`;this.cloudDialogId=`cloud-dialog-${o.Text.getRandom(5)}`;this.importServices=this.userFieldControl.getImportServices()},mounted(){this.uploader.assignBrowse(this.$refs.upload)},methods:{openDiskFileDialog(){if(this.showDialogLoader){return}this.showDialogLoader=true;Ee({dialogId:this.fileDialogId,uploader:this.uploader,onLoad:()=>{this.showDialogLoader=false},onClose:()=>{this.showDialogLoader=false}})},openCloudFileDialog(e){if(this.showCloudDialogLoader){return}this.currentServiceId=e;this.showCloudDialogLoader=true;const t=()=>{this.showCloudDialogLoader=false;this.currentServiceId=null};we({dialogId:this.cloudDialogId,uploader:this.uploader,serviceId:e,onLoad:t,onClose:t})}},template:`\n\t<div class="disk-user-field-panel">\n\t\t<div class="disk-user-field-panel-file-wrap">\n\t\t\t<div class="disk-user-field-panel-card-box disk-user-field-panel-card-file" ref="upload">\n\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card-icon--upload">\n\t\t\t\t\t<div class="disk-user-field-panel-card-content">\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ getMessage('DISK_UF_WIDGET_UPLOAD_FILES') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="disk-user-field-panel-card-box disk-user-field-panel-card-file" @click="openDiskFileDialog">\n\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card-icon--b24">\n\t\t\t\t\t<div class="disk-user-field-panel-card-content">\n\t\t\t\t\t\t<Loader v-if="showDialogLoader" :offset="{ top: '-7px' }" />\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ getMessage('DISK_UF_WIDGET_MY_DRIVE') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="disk-user-field-panel-card-divider"></div>\n\t\t\t<div \n\t\t\t\tclass="disk-user-field-panel-card-box disk-user-field-panel-card-file"\n\t\t\t\tv-if="importServices['gdrive']"\n\t\t\t\t@click="openCloudFileDialog('gdrive')"\n\t\t\t>\n\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card-icon--google-docs">\n\t\t\t\t\t<div class="disk-user-field-panel-card-content">\n\t\t\t\t\t\t<Loader v-if="showCloudDialogLoader && currentServiceId === 'gdrive'" :offset="{ top: '-7px' }" />\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ importServices['gdrive']['name'] }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass="disk-user-field-panel-card-box disk-user-field-panel-card-file"\n\t\t\t\tv-if="importServices['office365']"\n\t\t\t\t@click="openCloudFileDialog('office365')"\n\t\t\t>\n\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card-icon--office365">\n\t\t\t\t\t<div class="disk-user-field-panel-card-content">\n\t\t\t\t\t\t<Loader v-if="showCloudDialogLoader && currentServiceId === 'office365'" :offset="{ top: '-7px' }" />\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ importServices['office365']['name'] }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass="disk-user-field-panel-card-box disk-user-field-panel-card-file"\n\t\t\t\tv-if="importServices['dropbox']"\n\t\t\t\t@click="openCloudFileDialog('dropbox')"\n\t\t\t>\n\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card-icon--dropbox">\n\t\t\t\t\t<div class="disk-user-field-panel-card-content">\n\t\t\t\t\t\t<Loader v-if="showCloudDialogLoader && currentServiceId === 'dropbox'" :offset="{ top: '-7px' }" />\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ importServices['dropbox']['name'] }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t`};let Se=e=>e,Ae,Me;const je={name:"DocumentPanel",inject:["uploader","userFieldControl","getMessage"],props:{item:{type:Object,default:{}}},created(){this.menu=null;this.currentServiceNode=null},mounted(){const e=o.Loc.getMessage("DISK_UF_WIDGET_EDIT_SERVICE_LABEL")||"";const t="#NAME#";const s=e.indexOf(t);if(s!==-1){var i;const l=e.substring(0,s);const a=e.substring(s+t.length);this.currentServiceNode=o.Tag.render(Ae||(Ae=Se`
				<span class="disk-user-field-document-current-service">${0}</span>
			`),(i=this.userFieldControl.getCurrentDocumentService())==null?void 0:i.name);const r=o.Tag.render(Me||(Me=Se`
				<span>
					<span>${0}</span>
					${0}
					<span>${0}</span>
				</span>`),l,this.currentServiceNode,a);o.Dom.append(r,this.$refs["document-services"])}},methods:{createDocument(e){if(!BX.Disk.getDocumentService()&&BX.Disk.isAvailableOnlyOffice()){BX.Disk.saveDocumentService("onlyoffice")}else if(!BX.Disk.getDocumentService()){BX.Disk.saveDocumentService("l")}if(BX.Disk.Document.Local.Instance.isSetWorkWithLocalBDisk()){BX.Disk.Document.Local.Instance.createFile({type:e}).then((e=>{if(e.status==="success"){this.uploader.addFile(`n${e.object.id}`,{name:e.object.name,preload:true});this.userFieldControl.showUploaderPanel()}}))}else{const t=new BX.Disk.Document.CreateProcess({typeFile:e,serviceCode:BX.Disk.getDocumentService(),onAfterSave:(e,t)=>{if(e.status!=="success"){return}if(e.object){this.uploader.addFile(`n${e.object.id}`,{name:e.object.name,size:e.object.size,preload:true});this.userFieldControl.showUploaderPanel()}}});t.start()}},openMenu(){if(this.menu!==null){this.menu.destroy();return}this.menu=new r.Menu({bindElement:this.currentServiceNode,className:"disk-user-field-settings-popup",angle:true,autoHide:true,offsetTop:5,cacheable:false,items:this.getMenuItems(),events:{onDestroy:()=>{this.menu=null}}});this.menu.show()},getMenuItems(){var e;const t=[];const s=(e=this.userFieldControl.getCurrentDocumentService())==null?void 0:e.code;const i=Object.values(this.userFieldControl.getDocumentServices());i.forEach((e=>{t.push({text:e.name,className:s===e.code?"disk-user-field-item-checked":"disk-user-field-item-stub",onclick:(t,s)=>{BX.Disk.saveDocumentService(e.code);this.currentServiceNode.textContent=e.name;this.menu.close()}})}));return t}},template:`\n\t\t<div class="disk-user-field-panel">\n\t\t\t<div class="disk-user-field-panel-doc-wrap">\n\t\t\t\t<div class="disk-user-field-panel-card-box" @click="createDocument('docx')">\n\t\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card--doc">\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ getMessage('DISK_UF_WIDGET_CREATE_DOCX') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="disk-user-field-panel-card-box" @click="createDocument('xlsx')">\n\t\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card--xls">\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ getMessage('DISK_UF_WIDGET_CREATE_XLSX') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="disk-user-field-panel-card-box" @click="createDocument('pptx')">\n\t\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card--ppt">\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ getMessage('DISK_UF_WIDGET_CREATE_PPTX') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="disk-user-field-create-document-by-service" @click="openMenu" ref="document-services"></div>\n\t\t</div>\n\t`};const xe={name:"InsertIntoTextButton",inject:["uploader","postForm"],props:{item:{type:Object,default:{}}},methods:{click(){this.postForm.getParser().insertFile(this.item)},handleMouseEnter(e){if(this.hintPopup){return}const t=e.currentTarget;const s=t.offsetWidth;this.hintPopup=new r.Popup({content:o.Loc.getMessage("DISK_UF_WIDGET_INSERT_INTO_THE_TEXT"),cacheable:false,animation:"fading-slide",bindElement:t,offsetTop:0,bindOptions:{position:"top"},darkMode:true,events:{onClose:()=>{this.hintPopup.destroy();this.hintPopup=null},onShow:e=>{const t=e.getTarget();const i=t.getPopupContainer().offsetWidth;const l=s/2-i/2;const a=r.Popup.getOption("angleLeftOffset")-r.Popup.getOption("angleMinTop");t.setAngle({offset:i/2-a});t.setOffset({offsetLeft:l+r.Popup.getOption("angleLeftOffset")})}}});this.hintPopup.show()},handleMouseLeave(e){if(this.hintPopup){this.hintPopup.close();this.hintPopup=null}}},template:`\n\t\t<div \n\t\t\tclass="disk-user-field-insert-into-text-button"\n\t\t\t:class="[{ '--inserted': item.tileWidgetData.selected }]"\n\t\t\t@mouseenter="handleMouseEnter" \n\t\t\t@mouseleave="handleMouseLeave" \n\t\t\t@click="click"\n\t\t></div>\n\t`};const _e={name:"UserFieldWidget",extends:t.VueUploaderComponent,components:{TileWidgetComponent:s.TileWidgetComponent,DocumentPanel:je},setup(){return{customUploaderOptions:Re.getDefaultUploaderOptions()}},data(){const e=this.widgetOptions;return{controlVisibility:o.Type.isBoolean(e.controlVisibility)?e.controlVisibility:true,uploaderPanelVisibility:o.Type.isBoolean(e.uploaderPanelVisibility)?e.uploaderPanelVisibility:true,documentPanelVisibility:o.Type.isBoolean(e.documentPanelVisibility)?e.documentPanelVisibility:false}},provide(){return{userFieldControl:this.userFieldControl,postForm:this.userFieldControl.getMainPostForm(),getMessage:this.getMessage}},beforeCreate(){this.userFieldControl=new oe(this)},methods:{getMessage(e,t){return o.Loc.getMessage(e,t)},show(e=false){if(e){this.$refs.container.style.display="block"}this.controlVisibility=true},hide(e=false){if(e){this.$refs.container.style.display="none"}this.controlVisibility=false},showUploaderPanel(){this.uploaderPanelVisibility=true},hideUploaderPanel(){this.uploaderPanelVisibility=false},showDocumentPanel(){this.documentPanelVisibility=true},hideDocumentPanel(){this.documentPanelVisibility=false},enableAutoCollapse(){this.$refs.tileWidget.enableAutoCollapse()},getUploaderOptions(){return Re.prepareUploaderOptions(this.uploaderOptions)}},computed:{tileWidgetOptions(){const e=o.Type.isPlainObject(this.widgetOptions.tileWidgetOptions)?Object.assign({},this.widgetOptions.tileWidgetOptions):{};e.slots=o.Type.isPlainObject(e.slots)?e.slots:{};e.slots[s.TileWidgetSlot.AFTER_TILE_LIST]=Ue;if(this.userFieldControl.getMainPostForm()){e.slots[s.TileWidgetSlot.ITEM_EXTRA_ACTION]=xe}e.showItemMenuButton=true;e.events={"TileItem:onMenuCreate":e=>{const{item:t,menu:s}=e.getData();const i=new me(this.userFieldControl,t,s);i.build()}};const t=new De(this.userFieldControl);if(t.hasItems()){e.showSettingsButton=true;e.events["SettingsButton:onClick"]=e=>{const{button:s}=e.getData();t.toggle(s)}}return e}},template:`\n\t\t<div \n\t\t\tclass="disk-user-field-control" \n\t\t\t:class="[{ '--has-files': this.items.length > 0 }]"\n\t\t\t:style="{ display: controlVisibility ? 'block' : 'none' }"\n\t\t\tref="container"\n\t\t>\n\t\t\t<div \n\t\t\t\tclass="disk-user-field-uploader-panel"\n\t\t\t\t:class="[{ '--hidden': !uploaderPanelVisibility }]"\n\t\t\t\tref="uploader-container"\n\t\t\t>\n\t\t\t\t<TileWidgetComponent\n\t\t\t\t\t:widgetOptions="tileWidgetOptions" \n\t\t\t\t\t:uploader-adapter="adapter"\n\t\t\t\t\tref="tileWidget"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div \n\t\t\t\tclass="disk-user-field-create-document"\n\t\t\t\tv-if="this.userFieldControl.canCreateDocuments() && !this.userFieldControl.getMainPostForm() && !documentPanelVisibility"\n\t\t\t\t@click="documentPanelVisibility = true"\n\t\t\t>{{ getMessage('DISK_UF_WIDGET_CREATE_DOCUMENT') }}</div>\n\n\t\t\t<div \n\t\t\t\tclass="disk-user-field-document-panel"\n\t\t\t\t:class="{ '--single': this.userFieldControl.getMainPostForm() !== null }"\n\t\t\t\tref="document-container"\n\t\t\t\tv-if="this.userFieldControl.canCreateDocuments() && documentPanelVisibility"\n\t\t\t>\n\t\t\t\t<DocumentPanel />\n\t\t\t</div>\n\t\t</div>\n\t\t`};class Re extends t.VueUploaderWidget{constructor(e,t){const s=o.Type.isPlainObject(t)?Object.assign({},t):{};super(Re.prepareUploaderOptions(e),s)}defineComponent(){return _e}static prepareUploaderOptions(e){return Object.assign({},Re.getDefaultUploaderOptions(),o.Type.isPlainObject(e)?e:{})}static getDefaultUploaderOptions(){return{controller:"disk.uf.integration.diskUploaderController",multiple:true,maxFileSize:null}}}e.UserFieldWidget=Re;e.UserFieldWidgetComponent=_e;e.UserFieldControl=oe;e.loadDiskFileDialog=re;e.openDiskFileDialog=Ee;e.openCloudFileDialog=we})(this.BX.Disk.Uploader=this.BX.Disk.Uploader||{},BX.UI.Uploader,BX.UI.Uploader,BX.Event,BX.UI.Uploader,BX.Disk,BX,BX.Main);
//# sourceMappingURL=disk.uploader.uf-file.bundle.map.js