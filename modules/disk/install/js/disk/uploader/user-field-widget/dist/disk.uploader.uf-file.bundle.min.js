this.BX=this.BX||{};this.BX.Disk=this.BX.Disk||{};(function(e,t,s,i,l,a,o,r,n){"use strict";var d=babelHelpers.classPrivateFieldLooseKey("form");var c=babelHelpers.classPrivateFieldLooseKey("parserId");var u=babelHelpers.classPrivateFieldLooseKey("tag");var p=babelHelpers.classPrivateFieldLooseKey("regexp");var b=babelHelpers.classPrivateFieldLooseKey("init");var h=babelHelpers.classPrivateFieldLooseKey("parse");var v=babelHelpers.classPrivateFieldLooseKey("unparse");var g=babelHelpers.classPrivateFieldLooseKey("getIds");class m{constructor(e){Object.defineProperty(this,g,{value:L});Object.defineProperty(this,v,{value:P});Object.defineProperty(this,h,{value:f});Object.defineProperty(this,b,{value:F});Object.defineProperty(this,d,{writable:true,value:null});Object.defineProperty(this,c,{writable:true,value:"diskfile0"});Object.defineProperty(this,u,{writable:true,value:"[DISK FILE ID=#id#]"});Object.defineProperty(this,p,{writable:true,value:/\[(?:DOCUMENT ID|DISK FILE ID)=(n?[0-9]+)\]/gi});this.syncHighlightsDebounced=null;babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e;this.syncHighlightsDebounced=r.Runtime.debounce(this.syncHighlights,500,this);i.EventEmitter.emit(babelHelpers.classPrivateFieldLooseBase(this,d)[d].getEventObject(),"OnParserRegister",this.getParser())}getParser(){return{id:babelHelpers.classPrivateFieldLooseBase(this,c)[c],init:babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this),parse:babelHelpers.classPrivateFieldLooseBase(this,h)[h].bind(this),unparse:babelHelpers.classPrivateFieldLooseBase(this,v)[v].bind(this)}}getHtmlEditor(){return babelHelpers.classPrivateFieldLooseBase(this,d)[d].getHtmlEditor()}insertFile(e){const t=e.isImage()?"\n":" ";const s=e.isImage()?"<br>":"&nbsp;";i.EventEmitter.emit(this.getHtmlEditor(),"OnInsertContent",[t+this.createItemBBCode(e)+t,s+this.createItemHtml(e)+s]);this.syncHighlights()}removeFile(e){if(this.getHtmlEditor().GetViewMode()==="wysiwyg"){const t=this.getHtmlEditor().GetIframeDoc();Object.keys(this.getHtmlEditor().bxTags).forEach((s=>{const i=this.getHtmlEditor().bxTags[s];if(i.tag===babelHelpers.classPrivateFieldLooseBase(this,c)[c]&&i.serverFileId===e.serverFileId){const e=t.getElementById(s);if(e){e.parentNode.removeChild(e)}}}));this.getHtmlEditor().SaveContent()}else{const e=this.getHtmlEditor().GetContent().replace(babelHelpers.classPrivateFieldLooseBase(this,p)[p],((e,t)=>{const{objectId:s,attachedId:i}=babelHelpers.classPrivateFieldLooseBase(this,g)[g](t);const l=babelHelpers.classPrivateFieldLooseBase(this,d)[d].getUserFieldControl().getItems();const a=l.find((e=>e.serverFileId===i||e.customData.objectId===s));return a?"":e}));this.getHtmlEditor().SetContent(e);this.getHtmlEditor().Focus()}this.syncHighlights()}selectItem(e){e.setCustomData("tileSelected",true)}deselectItem(e){e.setCustomData("tileSelected",false)}syncHighlights(){const e=this.getHtmlEditor().GetIframeDoc();const t=new Set;Object.keys(this.getHtmlEditor().bxTags).forEach((s=>{const i=this.getHtmlEditor().bxTags[s];if(i.tag===babelHelpers.classPrivateFieldLooseBase(this,c)[c]&&e.getElementById(s)){t.add(i.serverFileId)}}));let s=false;const i=babelHelpers.classPrivateFieldLooseBase(this,d)[d].getUserFieldControl().getFiles();i.forEach((e=>{if(t.has(e.getServerFileId())){s=true;this.selectItem(e)}else{this.deselectItem(e)}}));if(babelHelpers.classPrivateFieldLooseBase(this,d)[d].getUserFieldControl().getPhotoTemplateMode()==="auto"){babelHelpers.classPrivateFieldLooseBase(this,d)[d].getUserFieldControl().setPhotoTemplate(s?"gallery":"grid")}}createItemHtml(e,t){const s=this.getHtmlEditor().SetBxTag(false,{tag:babelHelpers.classPrivateFieldLooseBase(this,c)[c],serverFileId:e.getServerFileId(),hideContextMenu:true,fileId:e.getServerFileId()});if(e.isImage()){const t=this.getHtmlEditor().bbCode?e.getPreviewUrl():e.getServerPreviewUrl();const i=this.getHtmlEditor().bbCode?e.getPreviewWidth():e.getServerPreviewWidth();const l=this.getHtmlEditor().bbCode?e.getPreviewHeight():e.getServerPreviewHeight();const a=600;const o=600;const n=a/i;const d=o/l;const c=Math.min(n,d);const u=c>1;const p=u?i:i*c;const b=u?l:l*c;return`<img style="max-width: 90%;" width="${p}" height="${b}" data-bx-file-id="${r.Text.encode(e.getServerFileId())}" id="${s}" src="${t}" title="${r.Text.encode(e.getName())}" data-bx-paste-check="Y" />`}else if(e.getCustomData("fileType")==="player"){return`<img contenteditable="false" class="bxhtmled-player-surrogate" data-bx-file-id="${r.Text.encode(e.getServerFileId())}" id="${s}" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-bx-paste-check="Y" />`}return`<span contenteditable="false" data-bx-file-id="${r.Text.encode(e.getServerFileId())}" id="${s}" style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;">${r.Text.encode(e.getName())}</span>`}createItemBBCode(e){return babelHelpers.classPrivateFieldLooseBase(this,u)[u].replace("#id#",e.getServerFileId())}}function F(e){}function f(e){if(!babelHelpers.classPrivateFieldLooseBase(this,p)[p].test(e)){return e}this.syncHighlightsDebounced();return e.replace(babelHelpers.classPrivateFieldLooseBase(this,p)[p],((e,t)=>{const{objectId:s,attachedId:i}=babelHelpers.classPrivateFieldLooseBase(this,g)[g](t);const l=babelHelpers.classPrivateFieldLooseBase(this,d)[d].getUserFieldControl().getFiles();const a=l.find((e=>e.getServerFileId()===i||e.getCustomData("objectId")===s));if(a){this.selectItem(a);return this.createItemHtml(a,t)}return e}))}function P(e){const{serverFileId:t}=e;const s=babelHelpers.classPrivateFieldLooseBase(this,d)[d].getUserFieldControl().getFiles();const i=s.find((e=>e.getServerFileId()===t));if(i){return this.createItemBBCode(i)}return""}function L(e){let t=null;let s=null;if(e[0]==="n"){t=r.Text.toInteger(e.replace("n",""))}else{s=r.Text.toInteger(e)}return{objectId:t,attachedId:s}}let D=e=>e,H;var B=babelHelpers.classPrivateFieldLooseKey("userFieldControl");var I=babelHelpers.classPrivateFieldLooseKey("createDocumentButton");var E=babelHelpers.classPrivateFieldLooseKey("eventObject");var y=babelHelpers.classPrivateFieldLooseKey("htmlParser");var C=babelHelpers.classPrivateFieldLooseKey("htmlEditor");var k=babelHelpers.classPrivateFieldLooseKey("inited");var T=babelHelpers.classPrivateFieldLooseKey("handleDocumentReady");var w=babelHelpers.classPrivateFieldLooseKey("handlePostFormReady");var O=babelHelpers.classPrivateFieldLooseKey("init");var U=babelHelpers.classPrivateFieldLooseKey("getPostForm");var S=babelHelpers.classPrivateFieldLooseKey("bindEventObject");var A=babelHelpers.classPrivateFieldLooseKey("bindAdapterEvents");var j=babelHelpers.classPrivateFieldLooseKey("handleReinitializeBefore");var x=babelHelpers.classPrivateFieldLooseKey("addCreateDocumentButton");var M=babelHelpers.classPrivateFieldLooseKey("handleButtonClick");var _=babelHelpers.classPrivateFieldLooseKey("handleUploaderPanelToggle");var R=babelHelpers.classPrivateFieldLooseKey("handleDocumentPanelToggle");class K extends i.EventEmitter{constructor(e,t){super();Object.defineProperty(this,R,{value:J});Object.defineProperty(this,_,{value:Q});Object.defineProperty(this,M,{value:q});Object.defineProperty(this,x,{value:Y});Object.defineProperty(this,j,{value:z});Object.defineProperty(this,A,{value:G});Object.defineProperty(this,S,{value:V});Object.defineProperty(this,U,{value:N});Object.defineProperty(this,O,{value:$});Object.defineProperty(this,w,{value:W});Object.defineProperty(this,T,{value:X});Object.defineProperty(this,B,{writable:true,value:null});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,E,{writable:true,value:null});Object.defineProperty(this,y,{writable:true,value:null});Object.defineProperty(this,C,{writable:true,value:null});Object.defineProperty(this,k,{writable:true,value:false});this.setEventNamespace("BX.Disk.Uploader.Integration");babelHelpers.classPrivateFieldLooseBase(this,B)[B]=e;babelHelpers.classPrivateFieldLooseBase(this,E)[E]=t.eventObject;babelHelpers.classPrivateFieldLooseBase(this,S)[S]();this.subscribeFromOptions(t.events);this.subscribeOnce("onReady",(()=>{if(babelHelpers.classPrivateFieldLooseBase(this,B)[B].canCreateDocuments()){babelHelpers.classPrivateFieldLooseBase(this,x)[x]()}}));babelHelpers.classPrivateFieldLooseBase(this,B)[B].subscribe("onUploaderPanelToggle",babelHelpers.classPrivateFieldLooseBase(this,_)[_].bind(this));babelHelpers.classPrivateFieldLooseBase(this,B)[B].subscribe("onDocumentPanelToggle",babelHelpers.classPrivateFieldLooseBase(this,R)[R].bind(this));r.Event.ready(babelHelpers.classPrivateFieldLooseBase(this,T)[T].bind(this))}getUserFieldControl(){return babelHelpers.classPrivateFieldLooseBase(this,B)[B]}getParser(){return babelHelpers.classPrivateFieldLooseBase(this,y)[y]}getHtmlEditor(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C]}getEventObject(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E]}selectFileButton(){const e=new i.BaseEvent({data:"show",compatData:["user-field-widget"]});i.EventEmitter.emit(babelHelpers.classPrivateFieldLooseBase(this,E)[E],"onShowControllers",e)}deselectFileButton(){const e=new i.BaseEvent({data:"hide",compatData:["user-field-widget"]});i.EventEmitter.emit(babelHelpers.classPrivateFieldLooseBase(this,E)[E],"onShowControllers",e)}selectCreateDocumentButton(){if(babelHelpers.classPrivateFieldLooseBase(this,I)[I]){const e=babelHelpers.classPrivateFieldLooseBase(this,I)[I].closest('[data-id="disk-document"]');if(e){e.setAttribute("data-bx-button-status","active")}}}deselectCreateDocumentButton(){if(babelHelpers.classPrivateFieldLooseBase(this,I)[I]){const e=babelHelpers.classPrivateFieldLooseBase(this,I)[I].closest('[data-id="disk-document"]');if(e){e.removeAttribute("data-bx-button-status")}}}insertIntoText(e){const t=babelHelpers.classPrivateFieldLooseBase(this,B)[B].getFile(e.id);babelHelpers.classPrivateFieldLooseBase(this,y)[y].insertFile(t)}}function X(){const e=babelHelpers.classPrivateFieldLooseBase(this,U)[U]();if(e===null){setTimeout((()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,U)[U]();if(e){babelHelpers.classPrivateFieldLooseBase(this,w)[w](e)}else{console.error("Disk User Field: Post Form Not Found.")}}),100)}else{babelHelpers.classPrivateFieldLooseBase(this,w)[w](e)}}function W(e){if(e.isReady){babelHelpers.classPrivateFieldLooseBase(this,O)[O](e)}else{i.EventEmitter.subscribe(e,"OnEditorIsLoaded",(()=>{babelHelpers.classPrivateFieldLooseBase(this,O)[O](e)}))}}function $(e){babelHelpers.classPrivateFieldLooseBase(this,A)[A]();babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e.getEditor();babelHelpers.classPrivateFieldLooseBase(this,y)[y]=new m(this);i.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,C)[C],"OnContentChanged",(e=>{babelHelpers.classPrivateFieldLooseBase(this,y)[y].syncHighlightsDebounced()}));i.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,C)[C],"BXEditor:onBeforePasteAsync",(e=>new Promise(((t,s)=>{const i=e.getData().clipboardEvent;const l=i.clipboardData;i.stopImmediatePropagation();if(!l||!a.isFilePasted(l)){t();return}i.preventDefault();e.preventDefault();a.getFilesFromDataTransfer(l).then((e=>{e.forEach((e=>{this.getUserFieldControl().getUploader().addFile(e,{events:{[a.FileEvent.LOAD_ERROR]:()=>{},[a.FileEvent.UPLOAD_ERROR]:()=>{},[a.FileEvent.LOAD_COMPLETE]:e=>{},[a.FileEvent.UPLOAD_COMPLETE]:e=>{const t=e.getTarget();this.getUserFieldControl().showUploaderPanel();this.getParser().insertFile(t)}}})}));t()})).catch((()=>{t()}))}))));this.emit("onReady");babelHelpers.classPrivateFieldLooseBase(this,k)[k]=true}function N(){const e=r.Reflection.getClass("BX.Main.PostForm");if(!e){return null}let t=null;e.repo.forEach((e=>{if(e.getEventObject()===this.getEventObject()){t=e}}));return t}function V(){i.EventEmitter.subscribe(this.getEventObject(),"onShowControllers",(e=>{if(r.Type.isArrayFilled(e.getCompatData())&&e.getCompatData()[0]==="user-field-widget"){return}const t=r.Type.isArray(e.getData())?e.getData().shift():e.getData();if(t==="show"){this.getUserFieldControl().showUploaderPanel()}else{this.getUserFieldControl().hide()}}));i.EventEmitter.subscribe(this.getEventObject(),"onReinitializeBeforeAsync",(e=>new Promise((t=>{if(babelHelpers.classPrivateFieldLooseBase(this,k)[k]){babelHelpers.classPrivateFieldLooseBase(this,j)[j](e).then((()=>t()))}else{this.subscribeOnce("onReady",(()=>{babelHelpers.classPrivateFieldLooseBase(this,j)[j](e).then((()=>t()))}))}}))));i.EventEmitter.subscribe(this.getEventObject(),"onCollectControllers",(e=>{const t=e.getData();const s=this.getUserFieldControl().getUploader().getHiddenFieldName();const i=this.getUserFieldControl().getItems().map((e=>e.serverFileId));t[s]={storage:"disk",tag:"[DISK FILE ID=#id#]",values:i,handler:{selectFile:(e,t,s)=>{Object.values(s).forEach((e=>{this.getUserFieldControl().getUploader().addFile(e)}))},removeFiles:e=>{if(e!==undefined&&Array.isArray(e)){const t=this.getUserFieldControl().getUploader();const s=t.getFiles();let i=e.map((e=>s.find((t=>t.getServerFileId()===e)).getId()));i.forEach((e=>{t.removeFile(e)}))}}}}}));i.EventEmitter.subscribe(this.getEventObject(),"OnVideoHasCaught",(e=>{e.stopImmediatePropagation();this.getUserFieldControl().getUploader().addFile(e.getData(),{events:{[a.FileEvent.UPLOAD_COMPLETE]:e=>{const t=e.getTarget();this.getUserFieldControl().showUploaderPanel();this.getParser().insertFile(t)}}})}));i.EventEmitter.subscribe(this.getEventObject(),"OnImageHasCaught",(e=>{e.stopImmediatePropagation();return new Promise(((t,s)=>{this.getUserFieldControl().getUploader().addFile(e.getData(),{events:{[a.FileEvent.LOAD_ERROR]:e=>{const t=e.getData().error;s(t)},[a.FileEvent.UPLOAD_ERROR]:()=>e=>{const t=e.getData().error;s(t)},[a.FileEvent.UPLOAD_COMPLETE]:e=>{const i=e.getTarget();const l=this.getUserFieldControl().getItem(i.getId());if(l){this.getParser().syncHighlights();t({image:{src:i.getPreviewUrl(),width:i.getPreviewWidth(),height:i.getPreviewHeight()},html:this.getParser().createItemHtml(i)})}else{s(new a.UploaderError("WRONG_FILE_SOURCE"))}}}})}))}));i.EventEmitter.subscribe(this.getEventObject(),"onFilesHaveCaught",(e=>{e.stopImmediatePropagation()}));i.EventEmitter.subscribe(this.getEventObject(),"onFilesHaveDropped",(e=>{e.stopImmediatePropagation();const t=e.getData().event;a.getFilesFromDataTransfer(t.dataTransfer).then((e=>{this.getUserFieldControl().getUploader().addFiles(e)})).catch((()=>{}))}))}function G(){const e=this.getUserFieldControl().getAdapter();e.subscribe("Item:onAdd",(()=>{i.EventEmitter.emit(this.getEventObject(),"onShowControllers:File:Increment")}));e.subscribe("Item:onRemove",(e=>{i.EventEmitter.emit(this.getEventObject(),"onShowControllers:File:Decrement");const t=e.getData().item;if(this.getParser()){this.getParser().removeFile(t)}}))}function z(e){this.getUserFieldControl().clear();const[,t]=e.getData();const s=this.getUserFieldControl().getUploader().getHiddenFieldName();const i=t&&t[s]&&t[s]["USER_TYPE_ID"]==="disk_file"?t[s]:null;if(i!==null){if(r.Type.isPlainObject(i["CUSTOM_DATA"])&&r.Type.isStringFilled(i["CUSTOM_DATA"]["PHOTO_TEMPLATE"])){this.getUserFieldControl().setPhotoTemplateMode("manual");this.getUserFieldControl().setPhotoTemplate(i["CUSTOM_DATA"]["PHOTO_TEMPLATE"])}else{this.getUserFieldControl().setPhotoTemplateMode("auto")}}else{this.getUserFieldControl().setPhotoTemplateMode("auto");this.getUserFieldControl().setPhotoTemplate("grid")}if(i===null){return Promise.resolve()}if(r.Type.isArray(i["FILES"])){return babelHelpers.classPrivateFieldLooseBase(this,B)[B].nextTick().then((()=>{i["FILES"].forEach((e=>{if(!this.getUserFieldControl().getUploader().getFile(e.serverFileId)){this.getUserFieldControl().getUploader().addFile(e)}}));if(this.getUserFieldControl().getUploader().getFiles().length>0){babelHelpers.classPrivateFieldLooseBase(this,B)[B].enableAutoCollapse()}}))}else if(r.Type.isArrayFilled(i["VALUE"])){return babelHelpers.classPrivateFieldLooseBase(this,B)[B].nextTick().then((()=>new Promise((e=>{let t=i["VALUE"];t=t.filter((e=>!this.getUserFieldControl().getUploader().getFile(e)));let s=0;let l=[];const o=()=>{s++;if(s===l.length){e()}};const r={[a.FileEvent.LOAD_COMPLETE]:o,[a.FileEvent.LOAD_ERROR]:o};const n=t.map((e=>[e,{events:r}]));if(n.length>0){l=this.getUserFieldControl().getUploader().addFiles(n);if(l.length===0){e()}else{babelHelpers.classPrivateFieldLooseBase(this,B)[B].enableAutoCollapse()}}else{e()}}))))}return Promise.resolve()}function Y(){babelHelpers.classPrivateFieldLooseBase(this,I)[I]=r.Tag.render(H||(H=D`
			<div onclick="${0}">
				<i></i>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,M)[M].bind(this),r.Loc.getMessage("DISK_UF_WIDGET_CREATE_DOCUMENT"));i.EventEmitter.emit(this.getEventObject(),"OnAddButton",[{BODY:babelHelpers.classPrivateFieldLooseBase(this,I)[I],ID:"disk-document"},"file"])}function q(){const e=babelHelpers.classPrivateFieldLooseBase(this,I)[I].closest('[data-id="disk-document"]');if(e&&e.hasAttribute("data-bx-button-status")){this.getUserFieldControl().hide()}else{this.getUserFieldControl().showDocumentPanel()}}function Q(e){const t=e.getData().isOpen;if(t){this.selectFileButton()}else{this.deselectFileButton()}}function J(e){const t=e.getData().isOpen;if(t){this.selectCreateDocumentButton()}else{this.deselectCreateDocumentButton()}}let Z=e=>e,ee,te;const se=new Map;var ie=babelHelpers.classPrivateFieldLooseKey("id");var le=babelHelpers.classPrivateFieldLooseKey("adapter");var ae=babelHelpers.classPrivateFieldLooseKey("mainPostForm");var oe=babelHelpers.classPrivateFieldLooseKey("allowDocumentFieldName");var re=babelHelpers.classPrivateFieldLooseKey("photoTemplateFieldName");var ne=babelHelpers.classPrivateFieldLooseKey("photoTemplateInput");var de=babelHelpers.classPrivateFieldLooseKey("photoTemplateMode");var ce=babelHelpers.classPrivateFieldLooseKey("widgetComponent");class ue extends i.EventEmitter{constructor(e){super();Object.defineProperty(this,ie,{writable:true,value:null});Object.defineProperty(this,le,{writable:true,value:null});Object.defineProperty(this,ae,{writable:true,value:null});Object.defineProperty(this,oe,{writable:true,value:null});Object.defineProperty(this,re,{writable:true,value:null});Object.defineProperty(this,ne,{writable:true,value:null});Object.defineProperty(this,de,{writable:true,value:"auto"});Object.defineProperty(this,ce,{writable:true,value:null});this.setEventNamespace("BX.Disk.Uploader.Integration");babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]=e;babelHelpers.classPrivateFieldLooseBase(this,le)[le]=e.adapter;const t=r.Type.isPlainObject(e.widgetOptions)?e.widgetOptions:{};babelHelpers.classPrivateFieldLooseBase(this,re)[re]=r.Type.isStringFilled(t.photoTemplateFieldName)?t.photoTemplateFieldName:null;babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]=r.Type.isStringFilled(t.allowDocumentFieldName)?t.allowDocumentFieldName:null;babelHelpers.classPrivateFieldLooseBase(this,le)[le].subscribe("Item:onAdd",(e=>{const t=e.getData().item;this.emit("Item:onAdd",{item:t})}));babelHelpers.classPrivateFieldLooseBase(this,le)[le].subscribe("Item:onComplete",(e=>{const t=e.getData().item;this.setDocumentEdit(t);this.emit("Item:onComplete",{item:t})}));babelHelpers.classPrivateFieldLooseBase(this,le)[le].subscribe("Item:onRemove",(e=>{const t=e.getData().item;this.removeAllowDocumentEditInput(t);this.emit("Item:onRemove",{item:t})}));if(t.disableLocalEdit){BX.Disk.Document.Local.Instance.disable()}if(babelHelpers.classPrivateFieldLooseBase(this,re)[re]!==null&&this.getUploader().getHiddenFieldsContainer()!==null){babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]=r.Tag.render(ee||(ee=Z`
				<input 
					name="${0}" 
					value="${0}"
					type="hidden" 
				/>
			`),babelHelpers.classPrivateFieldLooseBase(this,re)[re],r.Type.isStringFilled(t.photoTemplate)?t.photoTemplate:"grid");this.setPhotoTemplateMode(t.photoTemplateMode);r.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,ne)[ne],this.getUploader().getHiddenFieldsContainer())}if(this.getUploader().getHiddenFieldsContainer()===null&&(babelHelpers.classPrivateFieldLooseBase(this,re)[re]!==null||babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]!==null)){console.warn('DiskUserField: to use "photoTemplateFieldName" or "allowDocumentFieldName" options '+'you have to set "hiddenFieldsContainer" in the uploader options.')}this.subscribeFromOptions(t.events);const s=r.Type.isElementNode(t.eventObject)?t.eventObject:null;if(s){babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=new K(this,{eventObject:s,events:{onReady:()=>{this.getUploader().addFiles(t.files);if(this.getUploader().getFiles().length>0){this.showUploaderPanel();this.enableAutoCollapse()}}}})}else{this.getUploader().addFiles(t.files)}babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]=r.Type.isStringFilled(t.mainPostFormId)?t.mainPostFormId:`user-field-control-${r.Text.getRandom().toLowerCase()}`;se.set(babelHelpers.classPrivateFieldLooseBase(this,ie)[ie],this)}static getById(e){return se.get(e)||null}static getInstances(){return[...se.values()]}canCreateDocuments(){const e=r.Extension.getSettings("disk.uploader.user-field-widget");const t=e.get("canCreateDocuments",false);return t&&babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].widgetOptions.canCreateDocuments!==false}getAdapter(){return babelHelpers.classPrivateFieldLooseBase(this,le)[le]}getMainPostForm(){return babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]}getItems(){return babelHelpers.classPrivateFieldLooseBase(this,le)[le].getItems()}getItem(e){return babelHelpers.classPrivateFieldLooseBase(this,le)[le].getItem(e)}getFiles(){return babelHelpers.classPrivateFieldLooseBase(this,le)[le].getUploader().getFiles()}getFile(e){return babelHelpers.classPrivateFieldLooseBase(this,le)[le].getUploader().getFile(e)}getUploader(){return babelHelpers.classPrivateFieldLooseBase(this,le)[le].getUploader()}nextTick(){return babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].$nextTick()}hide(){babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].priorityVisibility="hidden";this.emit("onUploaderPanelToggle",{isOpen:false});this.emit("onDocumentPanelToggle",{isOpen:false})}showUploaderPanel(){babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].priorityVisibility="uploader";this.emit("onUploaderPanelToggle",{isOpen:true});this.emit("onDocumentPanelToggle",{isOpen:false})}showDocumentPanel(){if(!this.canCreateDocuments()){return}babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].priorityVisibility="documents";this.emit("onUploaderPanelToggle",{isOpen:false});this.emit("onDocumentPanelToggle",{isOpen:true})}clear(){this.getUploader().removeFiles({removeFromServer:false})}enableAutoCollapse(){babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].enableAutoCollapse()}canAllowDocumentEdit(){return babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]!==null&&this.getUploader().getHiddenFieldsContainer()!==null}canItemAllowEdit(e){return this.canAllowDocumentEdit()&&e.customData.isEditable===true&&e.customData.canUpdate===true}getAllowDocumentEditInput(e){const t=`input[name='${babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]}[${e.serverFileId}]']`;if(this.getUploader().getHiddenFieldsContainer()!==null){return this.getUploader().getHiddenFieldsContainer().querySelector(t)}return null}removeAllowDocumentEditInput(e){const t=this.getAllowDocumentEditInput(e);if(t!==null){r.Dom.remove(t)}}setDocumentEdit(e,t=null){if(!this.canItemAllowEdit(e)){return}let s=this.getAllowDocumentEditInput(e);if(s===null){s=r.Tag.render(te||(te=Z`<input name="${0}[${0}]" type="hidden" />`),babelHelpers.classPrivateFieldLooseBase(this,oe)[oe],e.serverFileId);r.Dom.append(s,this.getUploader().getHiddenFieldsContainer())}t=t===null?e.customData.allowEdit===true:t;s.value=t?1:0;const i=this.getFile(e.id);i.setCustomData("allowEdit",t)}canChangePhotoTemplate(){return babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]!==null}setPhotoTemplate(e){if(r.Type.isStringFilled(e)&&babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]!==null){babelHelpers.classPrivateFieldLooseBase(this,ne)[ne].value=e}}getPhotoTemplate(){return babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]!==null?babelHelpers.classPrivateFieldLooseBase(this,ne)[ne].value:""}setPhotoTemplateMode(e){if(e==="auto"||e==="manual"){babelHelpers.classPrivateFieldLooseBase(this,de)[de]=e}}getPhotoTemplateMode(){return babelHelpers.classPrivateFieldLooseBase(this,de)[de]}getDocumentServices(){const e=r.Extension.getSettings("disk.uploader.user-field-widget");const t=e.get("documentHandlers",{});if(r.Type.isPlainObject(t)){return t}return{}}getCurrentDocumentService(){let e=BX.Disk.getDocumentService();if(!e&&BX.Disk.isAvailableOnlyOffice()){e="onlyoffice"}else if(!e){e="l"}return this.getDocumentServices()[e]||null}getImportServices(){const e=r.Extension.getSettings("disk.uploader.user-field-widget");const t=e.get("importHandlers",{});if(r.Type.isPlainObject(t)){return t}return{}}canUseImportService(){const e=r.Extension.getSettings("disk.uploader.user-field-widget");return e.get("canUseImport",true)}getImportFeatureId(){const e=r.Extension.getSettings("disk.uploader.user-field-widget");return e.get("importFeatureId","")}}const pe=(e,t={})=>new Promise((s=>{r.Runtime.loadExtension("disk.legacy.file-dialog").then((()=>{const l=t=>{const[a]=t.getData();if(e===a){i.EventEmitter.unsubscribe(BX.DiskFileDialog,"inited",l);s()}};i.EventEmitter.subscribe(BX.DiskFileDialog,"inited",l);r.ajax.get(be(e,t))}))}));const be=(e,t={})=>{const s=`/bitrix/tools/disk/uf.php?action=openDialog&SITE_ID=${r.Loc.getMessage("SITE_ID")}&dialog2=Y&ACTION=SELECT&MULTI=Y&dialogName=${e}`;return r.Uri.addParam(s,t)};let he=e=>e,ve,ge;var me=babelHelpers.classPrivateFieldLooseKey("userFieldControl");var Fe=babelHelpers.classPrivateFieldLooseKey("item");var fe=babelHelpers.classPrivateFieldLooseKey("menu");var Pe=babelHelpers.classPrivateFieldLooseKey("folderDialogId");var Le=babelHelpers.classPrivateFieldLooseKey("showRenameMenu");class De{constructor(e,t,s){Object.defineProperty(this,Le,{value:He});Object.defineProperty(this,me,{writable:true,value:null});Object.defineProperty(this,Fe,{writable:true,value:null});Object.defineProperty(this,fe,{writable:true,value:null});Object.defineProperty(this,Pe,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,me)[me]=e;babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]=t;babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]=s;babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=`folder-dialog-${r.Text.getRandom(5)}`}build(){babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].getPopupWindow().setMaxWidth(500);if(babelHelpers.classPrivateFieldLooseBase(this,me)[me].canItemAllowEdit(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe])){babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].addMenuItem({delimiter:true});babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].addMenuItem({id:"allow-edit",className:babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].customData.allowEdit===true?"disk-user-field-item-checked":"",text:r.Loc.getMessage("DISK_UF_WIDGET_ALLOW_DOCUMENT_EDIT"),onclick:(e,t)=>{if(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].customData.allowEdit===true){babelHelpers.classPrivateFieldLooseBase(this,me)[me].setDocumentEdit(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe],false)}else{babelHelpers.classPrivateFieldLooseBase(this,me)[me].setDocumentEdit(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe],true)}t.getMenuWindow().close()}})}if(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].customData.canRename){babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].addMenuItem({delimiter:true});babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].addMenuItem({id:"rename",text:r.Loc.getMessage("DISK_UF_WIDGET_RENAME_FILE_MENU_TITLE"),events:{"SubMenu:onShow":e=>{const t=e.getTarget();babelHelpers.classPrivateFieldLooseBase(this,Le)[Le](t)}},items:[{id:"rename-textarea",html:'<div class="disk-user-field-rename-loading"></div>',className:"disk-user-field-rename-menu-item"}]})}if(r.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].customData.storage)){babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].addMenuItem({delimiter:true});if(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].customData.canMove){babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].addMenuItem({id:"storage",text:`${babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].customData.storage}&mldr;`,onclick:()=>{this.openFolderDialog();babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].close()},disabled:babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].customData.tileSelected===true})}else{babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].addMenuItem({id:"storage",text:babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].customData.storage,disabled:true})}}}rename(e){return new Promise(((t,s)=>{r.ajax.runAction("disk.api.commonActions.rename",{data:{objectId:babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].customData.objectId,newName:e,autoCorrect:true,generateUniqueName:true}}).then((e=>{var s,i;if((e==null?void 0:e.status)==="success"&&(e==null?void 0:(s=e.data)==null?void 0:(i=s.object)==null?void 0:i.name)!==babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].name){const t=babelHelpers.classPrivateFieldLooseBase(this,me)[me].getFile(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].id);const s=e.data.object.name;t.setName(s)}t()})).catch((e=>{BX.Disk.showModalWithStatusAction(e);s()}))}))}openFolderDialog(){pe(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe],{wish:"fakemove"}).then((()=>{BX.DiskFileDialog.obCallback[babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]]={saveButton:(e,t,s,i)=>{const l=Object.values(s)[0]||i;if(!l){return}const a=l.id==="root"?e.rootObjectId:l.id;r.ajax.runAction("disk.api.commonActions.move",{data:{objectId:babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].customData.objectId,toFolderId:a}}).then((t=>{if((t==null?void 0:t.status)==="success"){const s=babelHelpers.classPrivateFieldLooseBase(this,me)[me].getFile(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].id);const i=t.data.object.name;const a=t.data.object.id;s.setServerFileId(`n${a}`);s.setName(i);if(l.id==="root"){s.setCustomData("storage",`${e.name} / `)}else{s.setCustomData("storage",`${e.name} / ${l.name}`)}}})).catch((e=>{BX.Disk.showModalWithStatusAction(e)}))}};if(BX.DiskFileDialog.popupWindow===null){BX.DiskFileDialog.openDialog(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe])}})).catch((()=>{}))}}function He(e){r.Runtime.loadExtension("ui.buttons").then((t=>{const s=t.Button;const i=t.ButtonSize;const l=t.ButtonColor;const o=t.CancelButton;const n=e=>{if(e.code==="Enter"){c()}};const d=a.getFilenameWithoutExtension(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].name);const c=()=>{const t=u.value.trim();if(!r.Type.isStringFilled(t)||t===d){e.getMenuWindow().close();return}p.setWaiting(true);const s=`${t}.${a.getFileExtension(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].name)}`;this.rename(s).then((()=>{p.setWaiting(false);e.getMenuWindow().close()})).catch((()=>{p.setWaiting(false)}))};const u=r.Tag.render(ve||(ve=he`
				<textarea 
					class="disk-user-field-rename-textarea" 
					onkeydown="${0}"
				>${0}</textarea>
			`),n,r.Text.encode(d));const p=new s({text:r.Loc.getMessage("DISK_UF_WIDGET_RENAME_FILE_BUTTON_TITLE"),color:l.PRIMARY,size:i.SMALL,onclick:c});const b=new o({size:i.SMALL,onclick:()=>{e.getMenuWindow().close()}});const h=e.getSubMenu();const v=h.getMenuItem("rename-textarea");v.setText(r.Tag.render(ge||(ge=he`
					<div class="disk-user-field-rename-form">
						${0}
						<div class="disk-user-field-rename-buttons">${0}</div>
					</div>
				`),u,[p.render(),b.render()]),true);e.showSubMenu()}))}var Be=babelHelpers.classPrivateFieldLooseKey("userFieldControl");var Ie=babelHelpers.classPrivateFieldLooseKey("menu");var Ee=babelHelpers.classPrivateFieldLooseKey("getItems");class ye{constructor(e){Object.defineProperty(this,Ee,{value:Ce});Object.defineProperty(this,Be,{writable:true,value:null});Object.defineProperty(this,Ie,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]=e}getMenu(e){if(babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]!==null){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]}babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]=new n.Menu({bindElement:e.getContainer(),className:"disk-user-field-settings-popup",angle:true,autoHide:true,offsetLeft:16,cacheable:false,items:babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee](),events:{onShow:()=>{e.select()},onDestroy:()=>{e.deselect();babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]=null}}});return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]}show(e){this.getMenu(e).show()}toggle(e){if(babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]!==null&&babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].getPopupWindow().isShown()){babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].close()}else{this.show(e)}}hide(){if(babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]!==null){babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].close()}}hasItems(){return babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]().length>0}}function Ce(){if(!babelHelpers.classPrivateFieldLooseBase(this,Be)[Be].canChangePhotoTemplate()){return[]}return[{className:babelHelpers.classPrivateFieldLooseBase(this,Be)[Be].getPhotoTemplate()==="grid"?"disk-user-field-item-checked":"",text:r.Loc.getMessage("DISK_UF_WIDGET_ALLOW_PHOTO_COLLAGE"),onclick:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,Be)[Be].setPhotoTemplateMode("manual");if(babelHelpers.classPrivateFieldLooseBase(this,Be)[Be].getPhotoTemplate()==="grid"){babelHelpers.classPrivateFieldLooseBase(this,Be)[Be].setPhotoTemplate("gallery")}else{babelHelpers.classPrivateFieldLooseBase(this,Be)[Be].setPhotoTemplate("grid")}t.getMenuWindow().close()}}]}const ke=new Set;const Te=e=>{e=r.Type.isPlainObject(e)?e:{};const t=r.Type.isStringFilled(e.dialogId)?e.dialogId:`file-dialog-${r.Text.getRandom(5)}`;const s=r.Type.isFunction(e.onLoad)?e.onLoad:null;const i=r.Type.isFunction(e.onSelect)?e.onSelect:null;const l=r.Type.isFunction(e.onClose)?e.onClose:null;const o=e.uploader instanceof a.Uploader?e.uploader:null;if(ke.has(t)){return}ke.add(t);pe(t).then((()=>{ke.delete(t);if(s!==null){s()}BX.DiskFileDialog.obCallback[t]={saveButton:(e,t,s)=>{Object.values(s).forEach((e=>{if(o!==null){o.addFile(e.id,{name:e.name,preload:true})}}));if(i!==null){i(e,t,s)}},popupDestroy:()=>{ke.delete(t);if(l!==null){l()}}};if(BX.DiskFileDialog.popupWindow===null){BX.DiskFileDialog.openDialog(t)}}))};class we extends a.AbstractLoadController{constructor(e,t={}){super(e,t)}load(e){this.emit("onProgress",{progress:100});this.emit("onLoad")}abort(){}}var Oe=babelHelpers.classPrivateFieldLooseKey("fileId");var Ue=babelHelpers.classPrivateFieldLooseKey("serviceId");class Se extends a.AbstractUploadController{constructor(e,t={}){super(e,t);Object.defineProperty(this,Oe,{writable:true,value:null});Object.defineProperty(this,Ue,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]=t.fileId;babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]=t.serviceId}upload(e){BX.Disk.ExternalLoader.startLoad({file:{id:babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe],service:babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]},onFinish:e=>{this.emit("onUpload",{fileInfo:e.fileInfo})},onProgress:e=>{this.emit("onProgress",{progress:e})},onError:e=>{this.emit("onError",{error:a.UploaderError.createFromAjaxErrors(e)})}})}abort(){}}const Ae=new Set;const je=e=>{e=r.Type.isPlainObject(e)?e:{};const t=r.Type.isStringFilled(e.dialogId)?e.dialogId:`cloud-dialog-${r.Text.getRandom(5)}`;const s=r.Type.isStringFilled(e.serviceId)?e.serviceId:"gdrive";const i=r.Type.isFunction(e.onLoad)?e.onLoad:null;const l=r.Type.isFunction(e.onSelect)?e.onSelect:null;const o=r.Type.isFunction(e.onClose)?e.onClose:null;const n=e.uploader instanceof a.Uploader?e.uploader:null;if(Ae.has(t)){return}Ae.add(t);pe(t,{service:s,cloudImport:1}).then((()=>{Ae.delete(t);if(i!==null){i()}BX.DiskFileDialog.obCallback[t]={saveButton:(e,t,s)=>{r.Runtime.loadExtension("disk.legacy.external-loader").then((()=>{Object.values(s).forEach((e=>{if(e.type==="file"&&n!==null){n.addFile({id:e.id,serverFileId:e.id,name:e.name,size:r.Text.toNumber(e.sizeInt),loadController:new we(n.getServer(),{fileId:e.id,serviceId:e.provider}),uploadController:new Se(n.getServer(),{fileId:e.id,serviceId:e.provider})})}}));if(l!==null){l(e,t,s)}}))},popupDestroy:()=>{Ae.delete(t);if(o!==null){o()}}};if(s==="gdrive"){r.ajax({url:"/bitrix/tools/disk/uf.php?action=getGoogleAppData",dataType:"json",onsuccess(s){if(s.authUrl){xe(s.authUrl,e);return}Me(s,t).then((e=>{e.loadAndShowPicker()})).catch((e=>{console.error(e)}))},onfailure(e){BX.DiskFileDialog.sendRequest=false}});return}if(BX.DiskFileDialog.popupWindow===null){BX.DiskFileDialog.openDialog(t)}}))};const xe=function(e,t){BX.util.popup(e,1030,700);r.Event.bind(window,"hashchange",(()=>{const e=document.location.hash.match(/external-auth-(\w+)/);if(!e){return}BX.DiskFileDialog.sendRequest=false;je(t)}))};const Me=async function(e,t){return r.Runtime.loadExtension("disk.google-drive-picker").then((({GoogleDrivePicker:s})=>new s(e.clientId,e.appId,e.apiKey,e.accessToken,BX.DiskFileDialog.obCallback[t])))};const _e={name:"Loader",props:{size:{type:Number,default:70},color:{type:String,default:"#2fc6f6"},offset:{type:Object,default:null},mode:{type:String,default:""}},created(){this.loader=null},mounted(){r.Runtime.loadExtension("main.loader").then((e=>{const{Loader:t}=e;this.loader=new t({target:this.$refs.container,size:this.size,color:this.color,offset:this.offset,mode:this.mode});this.loader.show()}))},beforeUnmount(){if(this.loader){this.loader.destroy();this.loader=null}},template:'<span ref="container"></span>'};const Re={name:"ControlPanel",inject:["userFieldControl","uploader","getMessage"],components:{Loader:_e},data:()=>({showDialogLoader:false,showCloudDialogLoader:false,currentServiceId:null}),created(){this.fileDialogId=`file-dialog-${r.Text.getRandom(5)}`;this.cloudDialogId=`cloud-dialog-${r.Text.getRandom(5)}`;this.importServices=this.userFieldControl.getImportServices();this.canUseImportService=this.userFieldControl.canUseImportService();this.importFeatureId=this.userFieldControl.getImportFeatureId()},mounted(){this.uploader.assignBrowse(this.$refs.upload)},methods:{openDiskFileDialog(){if(this.showDialogLoader){return}this.showDialogLoader=true;Te({dialogId:this.fileDialogId,uploader:this.uploader,onLoad:()=>{this.showDialogLoader=false},onClose:()=>{this.showDialogLoader=false}})},openCloudFileDialog(e){if(!this.canUseImportService){o.FeaturePromotersRegistry.getPromoter({featureId:this.importFeatureId}).show();return}if(this.showCloudDialogLoader){return}this.currentServiceId=e;this.showCloudDialogLoader=true;const t=()=>{this.showCloudDialogLoader=false;this.currentServiceId=null};je({dialogId:this.cloudDialogId,uploader:this.uploader,serviceId:e,onLoad:t,onClose:t})}},template:`\n\t\t<div class="disk-user-field-panel">\n\t\t\t<div class="disk-user-field-panel-file-wrap">\n\t\t\t\t<div class="disk-user-field-panel-card-box disk-user-field-panel-card-file" ref="upload">\n\t\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card-icon--upload">\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-content">\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ getMessage('DISK_UF_WIDGET_UPLOAD_FILES') }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="disk-user-field-panel-card-box disk-user-field-panel-card-file" @click="openDiskFileDialog">\n\t\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card-icon--b24">\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-content">\n\t\t\t\t\t\t\t<Loader v-if="showDialogLoader" :offset="{ top: '-7px' }" />\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ getMessage('DISK_UF_WIDGET_MY_DRIVE') }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="disk-user-field-panel-card-divider"></div>\n\t\t\t\t<div \n\t\t\t\t\tclass="disk-user-field-panel-card-box disk-user-field-panel-card-file"\n\t\t\t\t\tv-if="importServices['gdrive']"\n\t\t\t\t\t@click="openCloudFileDialog('gdrive')"\n\t\t\t\t>\n\t\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card-icon--google-docs">\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-content">\n\t\t\t\t\t\t\t<Loader v-if="showCloudDialogLoader && currentServiceId === 'gdrive'" :offset="{ top: '-7px' }" />\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ importServices['gdrive']['name'] }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass="disk-user-field-panel-card-box disk-user-field-panel-card-file"\n\t\t\t\t\tv-if="importServices['office365']"\n\t\t\t\t\t@click="openCloudFileDialog('office365')"\n\t\t\t\t>\n\t\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card-icon--office365">\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-content">\n\t\t\t\t\t\t\t<Loader v-if="showCloudDialogLoader && currentServiceId === 'office365'" :offset="{ top: '-7px' }" />\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ importServices['office365']['name'] }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass="disk-user-field-panel-card-box disk-user-field-panel-card-file"\n\t\t\t\t\tv-if="importServices['dropbox']"\n\t\t\t\t\t@click="openCloudFileDialog('dropbox')"\n\t\t\t\t>\n\t\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card-icon--dropbox">\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-content">\n\t\t\t\t\t\t\t<Loader v-if="showCloudDialogLoader && currentServiceId === 'dropbox'" :offset="{ top: '-7px' }" />\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ importServices['dropbox']['name'] }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};let Ke=e=>e,Xe,We;const $e={name:"DocumentPanel",inject:["uploader","userFieldControl","getMessage"],props:{item:{type:Object,default:{}}},created(){this.menu=null;this.currentServiceNode=null},mounted(){const e=r.Loc.getMessage("DISK_UF_WIDGET_EDIT_SERVICE_LABEL")||"";const t="#NAME#";const s=e.indexOf(t);if(s!==-1){var i;const l=e.substring(0,s);const a=e.substring(s+t.length);this.currentServiceNode=r.Tag.render(Xe||(Xe=Ke`
				<span class="disk-user-field-document-current-service">${0}</span>
			`),(i=this.userFieldControl.getCurrentDocumentService())==null?void 0:i.name);const o=r.Tag.render(We||(We=Ke`
				<span>
					<span>${0}</span>
					${0}
					<span>${0}</span>
				</span>
			`),l,this.currentServiceNode,a);r.Dom.append(o,this.$refs["document-services"])}},methods:{createDocument(e){if(!BX.Disk.getDocumentService()&&BX.Disk.isAvailableOnlyOffice()){BX.Disk.saveDocumentService("onlyoffice")}else if(!BX.Disk.getDocumentService()){BX.Disk.saveDocumentService("l")}if(BX.Disk.Document.Local.Instance.isSetWorkWithLocalBDisk()){BX.Disk.Document.Local.Instance.createFile({type:e}).then((e=>{if(e.status==="success"){this.uploader.addFile(`n${e.object.id}`,{name:e.object.name,preload:true});this.userFieldControl.showUploaderPanel()}}))}else{const t=new BX.Disk.Document.CreateProcess({typeFile:e,serviceCode:BX.Disk.getDocumentService(),onAfterSave:(e,t)=>{if(e.status!=="success"){return}if(e.object){this.uploader.addFile(`n${e.object.id}`,{name:e.object.name,size:e.object.size,preload:true});this.userFieldControl.showUploaderPanel()}}});t.start()}},openMenu(){if(this.menu!==null){this.menu.destroy();return}this.menu=new n.Menu({bindElement:this.currentServiceNode,className:"disk-user-field-settings-popup",angle:true,autoHide:true,offsetTop:5,cacheable:false,items:this.getMenuItems(),events:{onDestroy:()=>{this.menu=null}}});this.menu.show()},getMenuItems(){var e;const t=[];const s=(e=this.userFieldControl.getCurrentDocumentService())==null?void 0:e.code;const i=Object.values(this.userFieldControl.getDocumentServices());i.forEach((e=>{t.push({text:e.name,className:s===e.code?"disk-user-field-item-checked":"disk-user-field-item-stub",onclick:(t,s)=>{BX.Disk.saveDocumentService(e.code);this.currentServiceNode.textContent=e.name;this.menu.close()}})}));return t}},template:`\n\t\t<div class="disk-user-field-panel">\n\t\t\t<div class="disk-user-field-panel-doc-wrap">\n\t\t\t\t<div class="disk-user-field-panel-card-box" @click="createDocument('docx')">\n\t\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card--doc">\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ getMessage('DISK_UF_WIDGET_CREATE_DOCX') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="disk-user-field-panel-card-box" @click="createDocument('xlsx')">\n\t\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card--xls">\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ getMessage('DISK_UF_WIDGET_CREATE_XLSX') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="disk-user-field-panel-card-box" @click="createDocument('pptx')">\n\t\t\t\t\t<div class="disk-user-field-panel-card disk-user-field-panel-card--ppt">\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-icon"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-btn"></div>\n\t\t\t\t\t\t<div class="disk-user-field-panel-card-name">{{ getMessage('DISK_UF_WIDGET_CREATE_PPTX') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="disk-user-field-create-document-by-service" @click="openMenu" ref="document-services"></div>\n\t\t</div>\n\t`};const Ne={name:"UserFieldWidget",extends:t.VueUploaderComponent,components:{TileWidgetComponent:s.TileWidgetComponent,DocumentPanel:$e},setup(){return{customUploaderOptions:Ve.getDefaultUploaderOptions()}},props:{visibility:{type:String,default(e){const t=r.Type.isElementNode(e.widgetOptions.eventObject);return t?"hidden":"both"}}},data(){return{documentsCollapsed:this.visibility==="both",priorityVisibility:null}},provide(){return{userFieldControl:this.userFieldControl,postForm:this.userFieldControl.getMainPostForm(),getMessage:this.getMessage}},beforeCreate(){this.userFieldControl=new ue(this)},methods:{getMessage(e,t){return r.Loc.getMessage(e,t)},enableAutoCollapse(){this.$refs.tileWidget.enableAutoCollapse()},getUploaderOptions(){return Ve.prepareUploaderOptions(this.uploaderOptions)},getUserFieldControl(){return this.userFieldControl}},computed:{tileWidgetOptions(){const e=this.widgetOptions;const t=r.Type.isPlainObject(e.tileWidgetOptions)?{...e.tileWidgetOptions}:{};t.slots=r.Type.isPlainObject(t.slots)?t.slots:{};t.slots[s.TileWidgetSlot.AFTER_TILE_LIST]=Re;t.insertIntoText=r.Type.isBoolean(e.insertIntoText)?e.insertIntoText:this.userFieldControl.getMainPostForm()!==null;t.showItemMenuButton=true;t.events=t.events||{};t.events["TileItem:onMenuCreate"]=e=>{const{item:t,menu:s}=e.getData();const i=new De(this.userFieldControl,t,s);i.build()};if(this.userFieldControl.getMainPostForm()!==null){t.events.onInsertIntoText=e=>{const{item:t}=e.getData();this.userFieldControl.getMainPostForm().insertIntoText(t)}}const i=new ye(this.userFieldControl);if(i.hasItems()){t.showSettingsButton=true;t.events["SettingsButton:onClick"]=e=>{const{button:t}=e.getData();i.toggle(t)}}return t},shouldShowCreateDocumentLink(){return this.userFieldControl.canCreateDocuments()&&this.documentsCollapsed&&this.finalVisibility==="both"},shouldShowDocuments(){return this.userFieldControl.canCreateDocuments()&&(this.finalVisibility==="documents"||this.finalVisibility==="both"&&!this.documentsCollapsed)},finalVisibility(){if(this.priorityVisibility!==null){return this.priorityVisibility}return this.visibility}},template:`\n\t\t<div \n\t\t\tclass="disk-user-field-control" \n\t\t\t:class="[{ '--has-files': this.items.length > 0 }]"\n\t\t\t:style="{ display: finalVisibility === 'hidden' ? 'none' : 'block' }"\n\t\t\tref="container"\n\t\t>\n\t\t\t<div \n\t\t\t\tclass="disk-user-field-uploader-panel"\n\t\t\t\t:class="[{ '--hidden': finalVisibility !== 'uploader' && finalVisibility !== 'both' }]"\n\t\t\t\tref="uploader-container"\n\t\t\t>\n\t\t\t\t<TileWidgetComponent\n\t\t\t\t\t:widgetOptions="tileWidgetOptions" \n\t\t\t\t\t:uploader-adapter="adapter"\n\t\t\t\t\tref="tileWidget"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div \n\t\t\t\tclass="disk-user-field-create-document"\n\t\t\t\tv-if="shouldShowCreateDocumentLink"\n\t\t\t\t@click="documentsCollapsed = false"\n\t\t\t>{{ getMessage('DISK_UF_WIDGET_CREATE_DOCUMENT') }}</div>\n\n\t\t\t<div \n\t\t\t\tclass="disk-user-field-document-panel"\n\t\t\t\t:class="{ '--single': finalVisibility !== 'both' }"\n\t\t\t\tref="document-container"\n\t\t\t\tv-if="shouldShowDocuments"\n\t\t\t>\n\t\t\t\t<DocumentPanel />\n\t\t\t</div>\n\t\t</div>\n\t`};class Ve extends t.VueUploaderWidget{constructor(e,t){const s=r.Type.isPlainObject(t)?{...t}:{};super(Ve.prepareUploaderOptions(e),s)}defineComponent(){return Ne}static prepareUploaderOptions(e){return{...Ve.getDefaultUploaderOptions(),...r.Type.isPlainObject(e)?e:{}}}static getDefaultUploaderOptions(){return{controller:"disk.uf.integration.diskUploaderController",multiple:true,maxFileSize:null}}}e.UserFieldWidget=Ve;e.UserFieldWidgetComponent=Ne;e.UserFieldControl=ue;e.loadDiskFileDialog=pe;e.openDiskFileDialog=Te;e.openCloudFileDialog=je})(this.BX.Disk.Uploader=this.BX.Disk.Uploader||{},BX.UI.Uploader,BX.UI.Uploader,BX.Event,BX.UI,BX.UI.Uploader,BX.UI,BX,BX.Main);
//# sourceMappingURL=disk.uploader.uf-file.bundle.map.js