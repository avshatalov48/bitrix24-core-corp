this.BX=this.BX||{};(function(t,e,n,a,i,s,r,l,c,o,d){"use strict";var u=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"disableExternalLink",value:function t(e){return r.ajax.runAction("disk.api.commonActions.disableExternalLink",{data:{objectId:e}})}},{key:"generateExternalLink",value:function t(e){return r.ajax.runAction("disk.api.commonActions.generateExternalLink",{data:{objectId:e}})}},{key:"getExternalLink",value:function t(e){return r.ajax.runAction("disk.api.commonActions.getExternalLink",{data:{objectId:e}})}},{key:"setDeathTime",value:function t(e,n){return new Promise((function(t,a){r.ajax.runAction("disk.api.externalLink.setDeathTime",{data:{externalLinkId:e,deathTime:n}}).then(t,a)}))}},{key:"revokeDeathTime",value:function t(e){return new Promise((function(t,n){r.ajax.runAction("disk.api.externalLink.revokeDeathTime",{data:{externalLinkId:e}}).then(t,n)}))}},{key:"setPassword",value:function t(e,n){return new Promise((function(t,a){r.ajax.runAction("disk.api.externalLink.setPassword",{data:{externalLinkId:e,newPassword:n}}).then(t,a)}))}},{key:"revokePassword",value:function t(e){return new Promise((function(t,n){r.ajax.runAction("disk.api.externalLink.revokePassword",{data:{externalLinkId:e}}).then(t,n)}))}},{key:"allowEditDocument",value:function t(e){return new Promise((function(t,n){r.ajax.runAction("disk.api.externalLink.allowEditDocument",{data:{externalLinkId:e}}).then(t,n)}))}},{key:"disallowEditDocument",value:function t(e){return new Promise((function(t,n){r.ajax.runAction("disk.api.externalLink.disallowEditDocument",{data:{externalLinkId:e}}).then(t,n)}))}}]);return t}();var h=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,null,[{key:"disableExternalLink",value:function t(e){BX.ajax.runAction("disk.api.trackedObject.disableExternalLink",{data:{objectId:e}})}},{key:"generateExternalLink",value:function t(e){return r.ajax.runAction("disk.api.trackedObject.generateExternalLink",{data:{objectId:e}})}},{key:"getExternalLink",value:function t(e){return r.ajax.runAction("disk.api.trackedObject.getExternalLink",{data:{objectId:e}})}}]);return e}(u);var k,m,v;var g=function(){function t(e,n){babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(this,"data",{});this.bindEvents();if(r.Type.isPlainObject(e)){this.objectId=parseInt(e["objectId"]);this.setData(e,false)}else{this.objectId=parseInt(e);this.setData(n,false)}}babelHelpers.createClass(t,[{key:"setData",value:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;console.log("data: ",e);if(e&&r.Type.isPlainObject(e)){this.data=Object.assign(this.data,e);this.data["id"]=this.data["id"]===null?this.data["id"]:parseInt(this.data["id"])}else{this.data={id:null,link:null,hash:null,hasPassword:null,hasDeathTime:null,availableEdit:null,canEditDocument:null,deathTime:null,deathTimeTimestamp:null}}this.adjustData();l.EventEmitter.emit(this,"Disk:ExternalLink:DataSet",e);if(n!==false){l.EventEmitter.emit(l.EventEmitter.GLOBAL_TARGET,"Disk:ExternalLink:HasChanged",{objectId:this.objectId,data:this.data,target:this})}}},{key:"adjustData",value:function t(){if(this.data.id===null){this.getSwitcher().check(false,false);this.showUnchecked()}else{this.getSwitcher().check(true,false);this.showChecked();this.getLinkContainer().innerHTML=r.Text.encode(this.data.link);this.getLinkContainer().href=r.Text.encode(this.data.link);this.getPasswordContainer().innerHTML=this.data.hasPassword?r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_WITH_PASSWORD"):r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_WITHOUT_PASSWORD");this.getDeathTimeContainer().innerHTML=this.data.hasDeathTime?r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_BEFORE").replace("#deathTime#",BX.Main.Date.format(BX.Main.Date.convertBitrixFormat(r.Loc.getMessage("FORMAT_DATETIME").replace(":SS","")),new Date(this.data.deathTimeTimestamp*1e3))):r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_FOREVER");if(this.data.availableEdit===true){this.getRightsContainer().innerHTML=", "+(this.data.canEditDocument?r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_RIGHTS_CAN_EDIT"):r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_RIGHTS_CAN_READ"));this.getRightsContainer().style.display=""}else{this.getRightsContainer().style.display="none"}}}},{key:"bindEvents",value:function t(){var e=this;l.EventEmitter.subscribe(l.EventEmitter.GLOBAL_TARGET,"Disk:ExternalLink:HasChanged",(function(t){var n=t.data,a=n.objectId,i=n.data,s=n.target;if(a!==e.objectId||Object.is(s,e)){return}e.setData(i,false)}))}},{key:"getBackend",value:function t(){return u}},{key:"getContainer",value:function t(){var e=this;return this.cache.remember("main",(function(){var t=r.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(['<div class="disk-control-external-link-link-icon"></div>'])));BX.clipboard.bindCopyClick(t,{text:function t(){return e.data.link}});var n=function t(){return e.constructor.showPopup(e.objectId,e.data)};return r.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="disk-control-external-link-block','">\n\t\t\t\t\t<div class="disk-control-external-link">\n\t\t\t\t\t\t<div class="disk-control-external-link-btn">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="disk-control-external-link-main">\n\t\t\t\t\t\t\t<div class="disk-control-external-link-link-box">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t",'\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="disk-control-external-link-subtitle" onclick="','">',", ","",'</div>\n\t\t\t\t\t\t\t<div class="disk-control-external-link-text">','</div>\n\t\t\t\t\t\t\t<div class="disk-control-external-link-skeleton"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t'])),e.data.id!==null?" disk-control-external-link-block--active":"",e.getSwitcher().getNode(),e.getLinkContainer(),t,n,e.getDeathTimeContainer(),e.getPasswordContainer(),e.getRightsContainer(),r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_IS_NOT_PUBLISHED"))}))}},{key:"getSwitcher",value:function t(){var e=this;return this.cache.remember("switcher",(function(){var t=document.createElement("span");t.className="ui-switcher";var n=new BX.UI.Switcher({node:t,checked:e.data.id!==null,inputName:"ACTIVE",color:"green"});n.handlers={toggled:e.toggle.bind(e,{target:n})};return n}))}},{key:"getLinkContainer",value:function t(){var e=this;return this.cache.remember("link",(function(){return r.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['<a href="','" class="disk-control-external-link-link" target="_blank">',"</a>"])),r.Text.encode(e.data.link),r.Text.encode(e.data.link))}))}},{key:"getRightsContainer",value:function t(){return this.cache.remember("rights",(function(){return document.createElement("span")}))}},{key:"getDeathTimeContainer",value:function t(){return this.cache.remember("deathTime",(function(){return document.createElement("span")}))}},{key:"getPasswordContainer",value:function t(){return this.cache.remember("password",(function(){return document.createElement("span")}))}},{key:"toggle",value:function t(e){var n=this;var a=e.target;if(a.checked){this.showLoader();this.getBackend().generateExternalLink(this.objectId).then((function(t){var e=t.data.externalLink;n.setData(e);n.hideLoader()}))}else{this.getBackend().disableExternalLink(this.objectId);this.setData(null)}}},{key:"showChecked",value:function t(){var e=this.getContainer().classList.item(0);var n=[e,"--active"].join("");this.getContainer().classList.add(n)}},{key:"showUnchecked",value:function t(){var e=this.getContainer().classList.item(0);var n=[e,"--active"].join("");this.getContainer().classList.remove(n)}},{key:"showLoader",value:function t(){r.Dom.addClass(this.getContainer(),"disk-control-external-link-skeleton--active")}},{key:"hideLoader",value:function t(){r.Dom.removeClass(this.getContainer(),"disk-control-external-link-skeleton--active")}},{key:"reload",value:function t(){var e=this;this.showLoader();return this.getBackend().getExternalLink(this.objectId).then((function(t){var n=t.data;e.setData(n&&n.externalLink?n.externalLink:null);e.hideLoader()}))}}]);return t}();var E,p,b,f,T;var S=function(t){babelHelpers.inherits(e,t);function e(t,n){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t,n))}babelHelpers.createClass(e,[{key:"adjustData",value:function t(){if(this.data.id===null){this.getSwitcher().check(false,false);this.showUnchecked();if(this.cache.get("popup")){this.cache.get("popup").getPopupContainer().setAttribute("externalLinkIsSet","N")}}else{this.getSwitcher().check(true,false);this.showChecked();this.getLinkContainer().innerHTML=r.Text.encode(this.data.link);this.getLinkContainer().href=r.Text.encode(this.data.link);this.getPasswordContainer().innerHTML=this.data.hasPassword?r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_WITH_PASSWORD"):r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_WITHOUT_PASSWORD");this.getDeathTimeContainer().innerHTML=this.data.hasDeathTime?r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_BEFORE").replace("#deathTime#",BX.Main.Date.format(BX.Main.Date.convertBitrixFormat(r.Loc.getMessage("FORMAT_DATETIME").replace(":SS","")),new Date(this.data.deathTimeTimestamp*1e3))):r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_FOREVER");if(this.data.availableEdit===true){this.getRightsContainer().innerHTML=", "+(this.data.canEditDocument?r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_RIGHTS_CAN_EDIT"):r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_RIGHTS_CAN_READ"));this.getRightsContainer().style.display=""}else{this.getRightsContainer().style.display="none"}if(this.cache.get("popup")){this.cache.get("popup").getPopupContainer().setAttribute("externalLinkIsSet","Y")}}}},{key:"getContainer",value:function t(){var e=this;return this.cache.remember("main",(function(){var t=r.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['<div class="disk-control-external-link-link-icon"></div>'])));BX.clipboard.bindCopyClick(t,{text:function t(){return e.data.link}});e.showSettings=e.showSettings.bind(e);return r.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="disk-control-external-link-block',' disk-control-external-link-block--tunable">\n\t\t\t\t\t<div class="disk-control-external-link">\n\t\t\t\t\t\t<div class="disk-control-external-link-btn">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="disk-control-external-link-main">\n\t\t\t\t\t\t\t<div class="disk-control-external-link-link-box">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t",'\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="disk-control-external-link-subtitle" onclick="','">',", ","",'</div>\n\t\t\t\t\t\t\t<div class="disk-control-external-link-text">','</div>\n\t\t\t\t\t\t\t<div class="disk-control-external-link-skeleton"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="disk-public-link-config" onclick="','"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="disk-control-external-link-settings">\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),e.data.id!==null?" disk-control-external-link-block--active":"",e.getSwitcher().getNode(),e.getLinkContainer(),t,e.showSettings,e.getDeathTimeContainer(),e.getPasswordContainer(),e.getRightsContainer(),r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_IS_NOT_PUBLISHED"),e.showSettings,e.getDeathTimeSettingsContainer(),e.getPasswordSettingsContainer(),e.getEditSettingsContainer())}))}},{key:"showSettings",value:function t(){this.cache.set("settingsAreShown","Y");if(this.cache.get("popup")){this.cache.get("popup").getPopupContainer().setAttribute("settingsAreShown","Y")}}},{key:"hideSettings",value:function t(){this.cache.set("settingsAreShown","N");if(this.cache.get("popup")){this.cache.get("popup").getPopupContainer().setAttribute("settingsAreShown","N")}}},{key:"getDeathTimeSettingsContainer",value:function t(){var e=this;return this.cache.remember("deathTimeSettings",(function(){var t=r.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-form-line">\n\t\t\t\t<input type="checkbox" name="hasDeathTime">\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<label class="ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t\t<input type="checkbox" class="ui-ctl-element" name="enableDeathTime">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-row-inline" name="deathTimeIsNotSaved">\n\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w25 ui-ctl-inline">\n\t\t\t\t\t\t\t<input type="number" min="1" name="deathTimeValue" class="ui-ctl-element" value="10" size="4">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-inline ui-ctl-w50">\n\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t<select class="ui-ctl-element" name="deathTimeMeasure">\n\t\t\t\t\t\t\t\t<option value="60" selected>','</option>\n\t\t\t\t\t\t\t\t<option value="3600">','</option>\n\t\t\t\t\t\t\t\t<option value="86400">','</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-row-inline" name="deathTimeIsSaved">\n\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-no-border">\n\t\t\t\t\t\t\t<div class="ui-ctl-element" name="deathTimeParsed">14.10.2014 16:33</div>\n\t\t\t\t\t\t\t<button name="deathTimeButtonUnset" class="ui-ctl-after ui-ctl-icon-clear"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>'])),r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_DEATHTIME_LIMIT_CHECKBOX"),r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_MINUTES"),r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_HOURS"),r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_DAYS"),r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_DEATHTIME_LIMIT_PREPOSITION"));var n=function n(){if(!(e.data["id"]>0)){return}if(t.querySelector("input[name=enableDeathTime]").checked===true){t.querySelector("input[name=deathTimeValue]").disabled=false;t.querySelector("[name=deathTimeMeasure]").disabled=false}else{t.querySelector("input[name=deathTimeValue]").disabled=true;t.querySelector("input[name=deathTimeValue]").value="10";t.querySelector("[name=deathTimeMeasure]").disabled=true;t.querySelector("[name=deathTimeMeasure]").value="60"}};t.querySelector("input[name=enableDeathTime]").addEventListener("click",(function(){n();t.querySelector("input[name=enableDeathTime]").dataset.changed="Y";l.EventEmitter.emit(e,"Disk:ExternalLink:Settings:Change",{field:"deathTime"})}));t.querySelector("button[name=deathTimeButtonUnset]").addEventListener("click",(function(){t.querySelector("input[name=hasDeathTime]").checked=false;t.querySelector("input[name=enableDeathTime]").dataset.changed="Y";l.EventEmitter.emit(e,"Disk:ExternalLink:Settings:Change",{field:"deathTime"})}));var a=function a(){if(!(e.data["id"]>0)){return}t.querySelector("input[name=enableDeathTime]").dataset.changed="N";if(e.data["hasDeathTime"]){t.querySelector("input[name=hasDeathTime]").checked=true;t.querySelector("div[name=deathTimeParsed]").innerHTML=BX.Main.Date.format(BX.Main.Date.convertBitrixFormat(r.Loc.getMessage("FORMAT_DATETIME").replace(":SS","")),new Date(e.data.deathTimeTimestamp*1e3));t.querySelector("input[name=enableDeathTime]").checked=true}else{t.querySelector("input[name=hasDeathTime]").checked=false;t.querySelector("input[name=enableDeathTime]").checked=false}n()};l.EventEmitter.subscribe(e,"Disk:ExternalLink:DataSet",a);a();return t}))}},{key:"getPasswordSettingsContainer",value:function t(){var e=this;return this.cache.remember("passwordSettings",(function(){var t=r.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-form-line">\n\t\t\t\t<input type="checkbox" name="hasPassword">\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<label class="ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t\t<input type="checkbox" class="ui-ctl-element" name="enablePassword">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-row-inline" name="passwordIsNotSaved">\n\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="password" name="passwordValue" class="ui-ctl-element" placeholder="','" autocomplete="nope">\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-angle disk-external-link-setting-popup-password-show" name="passwordTypeSwitcher"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-row-inline" name="passwordIsSaved">\n\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-disabled ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="password" class="ui-ctl-element" readonly value="some password">\n\t\t\t\t\t\t\t<button name="passwordButtonUnset" class="ui-ctl-after ui-ctl-icon-clear"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t'])),r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_PASSWORD_CHECKBOX"),r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_PASSWORD_PLACEHOLDER"));var n=t.querySelector("input[name=passwordValue]");var a=function a(){if(!(e.data["id"]>0)){return}if(t.querySelector("input[name=enablePassword]").checked===true){n.disabled=false}else{n.disabled=true;n.value="";n.type="password"}};t.querySelector("input[name=enablePassword]").addEventListener("click",(function(){a();t.querySelector("input[name=enablePassword]").dataset.changed="Y";l.EventEmitter.emit(e,"Disk:ExternalLink:Settings:Change",{field:"password"})}));t.querySelector("button[name=passwordButtonUnset]").addEventListener("click",(function(){t.querySelector("input[name=hasPassword]").checked=false;t.querySelector("input[name=enablePassword]").dataset.changed="Y";n.value="";n.type="password";l.EventEmitter.emit(e,"Disk:ExternalLink:Settings:Change",{field:"password"})}));t.querySelector("button[name=passwordTypeSwitcher]").addEventListener("click",(function(){n.type=n.type==="text"?"password":"text"}));var i=function n(){if(!(e.data["id"]>0)){return}t.querySelector("input[name=enablePassword]").dataset.changed="N";t.querySelector("input[name=hasPassword]").checked=e.data["hasPassword"]===true;t.querySelector("input[name=enablePassword]").checked=e.data["hasPassword"]===true;a()};l.EventEmitter.subscribe(e,"Disk:ExternalLink:DataSet",i);i();return t}))}},{key:"getEditSettingsContainer",value:function t(){var e=this;return this.cache.remember("editSettings",(function(){var t=r.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-form-line">\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<label class="ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t\t<input type="checkbox" class="ui-ctl-element" name="canEditDocument">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">',"</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t"])),r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_ALLOW_EDITING"));var n=t.querySelector("input[name=canEditDocument]");n.addEventListener("click",(function(){n.dataset.changed="Y";l.EventEmitter.emit(e,"Disk:ExternalLink:Settings:Change",{field:"canEditDocument"})}));var a=function a(){n.checked=e.data["canEditDocument"]===true;n.dataset.changed="N";if(e.data["availableEdit"]!==true){t.style.display="none";n.disable=true}else{t.style.display="";delete t.style.display;delete n.disable}};l.EventEmitter.subscribe(e,"Disk:ExternalLink:DataSet",a);a();return t}))}},{key:"saveSettings",value:function t(){var e=this;if(!(this.data.id>0)){return}var n=this.getContainer();if(n.querySelector("input[name=enableDeathTime]").dataset.changed==="Y"){var a=parseInt(n.querySelector("input[name=deathTimeValue]").value)*parseInt(n.querySelector("[name=deathTimeMeasure]").value);var i=n.querySelector("input[name=enableDeathTime]").checked===true&&a>0;if(i===true){l.EventEmitter.emit(this,"Disk:ExternalLink:Settings:Save",(function(){}));var s=Math.floor(Date.now()/1e3)+a;this.getBackend().setDeathTime(this.data.id,s).then((function(t){var n=t.data.externalLink,a=n.hasDeathTime,i=n.deathTimeTimestamp,s=n.deathTime;e.setData({hasDeathTime:a,deathTimeTimestamp:i,deathTime:s})}))["finally"]((function(){l.EventEmitter.emit(e,"Disk:ExternalLink:Settings:Saved",(function(){}))}))}else if(i!==this.data.hasDeathTime){l.EventEmitter.emit(this,"Disk:ExternalLink:Settings:Save",(function(){}));this.getBackend().revokeDeathTime(this.data["id"]).then((function(){e.setData({hasDeathTime:false,deathTimeTimestamp:null,deathTime:null})}))["finally"]((function(){l.EventEmitter.emit(e,"Disk:ExternalLink:Settings:Saved",(function(){}))}))}}if(n.querySelector("input[name=enablePassword]").dataset.changed==="Y"){var r=n.querySelector("input[name=passwordValue]").value.trim();var c=n.querySelector("input[name=enablePassword]").checked===true&&r.length>0;if(c===true){l.EventEmitter.emit(this,"Disk:ExternalLink:Settings:Save",(function(){}));this.getBackend().setPassword(this.data["id"],r).then((function(){e.setData({hasPassword:true})}))["finally"]((function(){l.EventEmitter.emit(e,"Disk:ExternalLink:Settings:Saved",(function(){}))}))}else if(c!==this.data.hasPassword){l.EventEmitter.emit(this,"Disk:ExternalLink:Settings:Save",(function(){}));this.getBackend().revokePassword(this.data["id"]).then((function(){e.setData({hasPassword:false})}))["finally"]((function(){l.EventEmitter.emit(e,"Disk:ExternalLink:Settings:Saved",(function(){}))}))}}var o=n.querySelector("input[name=canEditDocument]");if(o&&o.dataset.changed==="Y"&&o.checked!==this.data.canEditDocument){if(o.checked){l.EventEmitter.emit(this,"Disk:ExternalLink:Settings:Save",(function(){}));this.getBackend().allowEditDocument(this.data["id"]).then((function(){e.setData({canEditDocument:true})}))["finally"]((function(){l.EventEmitter.emit(e,"Disk:ExternalLink:Settings:Saved",(function(){}))}))}else{l.EventEmitter.emit(this,"Disk:ExternalLink:Settings:Save",(function(){}));this.getBackend().disallowEditDocument(this.data["id"]).then((function(){e.setData({canEditDocument:false})}))["finally"]((function(){l.EventEmitter.emit(e,"Disk:ExternalLink:Settings:Saved",(function(){}))}))}}}},{key:"getPopup",value:function t(){var e=this;return this.cache.remember("popup",(function(){var t=new o.SaveButton({state:o.ButtonState.DISABLED,onclick:function t(){e.saveSettings()}});t.saveCounter=0;l.EventEmitter.subscribe(e,"Disk:ExternalLink:Settings:Save",(function(){e.cache.get("popup").getPopupContainer().setAttribute("externalLinkIsWaiting","Y");t.saveCounter++;t.setWaiting()}));l.EventEmitter.subscribe(e,"Disk:ExternalLink:Settings:Saved",(function(){t.saveCounter--;if(t.saveCounter<=0){e.cache.get("popup").getPopupContainer().setAttribute("externalLinkIsWaiting","N");t.setDisabled(true)}}));l.EventEmitter.subscribe(e,"Disk:ExternalLink:Settings:Change",(function(){t.setDisabled(false)}));l.EventEmitter.subscribe(e,"Disk:ExternalLink:DataSet",(function(){t.setDisabled(true)}));var n=new d.Popup({uniquePopupId:"disk-external-link",className:"disk-external-link-popup",titleBar:r.Loc.getMessage("DISK_EXTENSION_EXTERNAL_LINK_TITLE"),content:e.getContainer(),autoHide:true,closeIcon:true,closeByEsc:true,overlay:true,cacheable:false,minWidth:410,events:{onClose:function t(){e.cache["delete"]("popup")}},buttons:[t,new o.CloseButton({events:{click:function t(){n.close()}}})]});n.getPopupContainer().setAttribute("externalLinkIsSet",e.data.id>0?"Y":"N");n.getPopupContainer().setAttribute("settingsAreShown",e.cache.get("settingsAreShown")==="Y"?"Y":"N");return n}))}},{key:"show",value:function t(){this.getPopup().show()}}]);return e}(g);var L=function(t){babelHelpers.inherits(e,t);function e(t,n){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t,n))}babelHelpers.createClass(e,null,[{key:"getExtendedInputClass",value:function t(){return S}},{key:"showPopup",value:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var a=this.getExtendedInputClass();var i=new a(e,n);if(n===null){i.reload()}else{i.showSettings()}i.show()}}]);return e}(g);var D=function(t){babelHelpers.inherits(e,t);function e(t,n){babelHelpers.classCallCheck(this,e);console.log("InputExtendedForTrackedObject!!!");return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t,n))}babelHelpers.createClass(e,[{key:"getBackend",value:function t(){return h}}]);return e}(S);var I=function(t){babelHelpers.inherits(e,t);function e(t,n){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t,n))}babelHelpers.createClass(e,[{key:"getBackend",value:function t(){return h}}],[{key:"getExtendedInputClass",value:function t(){return D}}]);return e}(L);t.ExternalLink=L;t.ExternalLinkForTrackedObject=I})(this.BX.Disk=this.BX.Disk||{},BX,BX,BX,BX,BX.UI,BX,BX.Event,BX.Main,BX.UI,BX.Main);
//# sourceMappingURL=external-link.bundle.map.js