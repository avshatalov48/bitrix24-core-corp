{"version":3,"file":"disk.onlyoffice-promo-popup.bundle.js","sources":["../src/promo-popup.js"],"sourcesContent":["import {ajax as Ajax, Tag, Reflection, Loc} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport {MessageBox, MessageBoxButtons} from \"ui.dialogs.messagebox\";\n\nexport default class PromoPopup {\n\tuserBoxNode: HTMLElement = null;\n\n\tstatic shouldBlockViewAndEdit(): boolean\n\t{\n\t\tif (!BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tif (BX.message['disk_onlyoffice_can_view'] === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn BX.message['disk_onlyoffice_can_view'] == false;\n\t}\n\n\tstatic shouldShowViewPromo(): boolean\n\t{\n\t\tif (!BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tif (BX.message['disk_onlyoffice_got_promo_about'] === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn BX.message['disk_onlyoffice_got_promo_about'] == false;\n\t}\n\n\tstatic shouldShowEndDemo(): boolean\n\t{\n\t\tif (!BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tif (BX.message['disk_onlyoffice_demo_ended'] == false)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tif (BX.message['disk_onlyoffice_got_end_demo'] === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn BX.message['disk_onlyoffice_got_end_demo'] == false;\n\t}\n\n\tstatic shouldShowEditPromo(): boolean\n\t{\n\t\tif (!BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tif (BX.message['disk_onlyoffice_can_edit'] === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn BX.message['disk_onlyoffice_can_edit'] == false;\n\t}\n\n\tstatic canEdit(): boolean\n\t{\n\t\tif (!BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tif (BX.message['disk_onlyoffice_can_edit'] === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn BX.message['disk_onlyoffice_can_edit'] == true;\n\t}\n\n\tstatic registerView(optionName: string): void\n\t{\n\t\tBX.userOptions.save('disk', optionName, 'v', 1);\n\t\tBX.userOptions.send(null);\n\n\t\tif (optionName === 'got_promo_onlyoffice')\n\t\t{\n\t\t\tBX.message['disk_onlyoffice_got_promo_about'] = true;\n\t\t}\n\t\telse if (optionName === 'got_end_demo_onlyoffice')\n\t\t{\n\t\t\tBX.message['disk_onlyoffice_got_end_demo'] = true;\n\t\t}\n\t}\n\n\tstatic showCommonPromoForNonPaid(): void\n\t{\n\t\tif (this.shouldShowEndDemo())\n\t\t{\n\t\t\tthis.showEndOfDemo();\n\t\t}\n\t\telse if (Reflection.getClass('BX.UI.InfoHelper'))\n\t\t{\n\t\t\tBX.UI.InfoHelper.show('limit_office_no_document', {featureId: 'disk_onlyoffice_edit'});\n\t\t\tEventEmitter.subscribeOnce('BX.UI.InfoHelper:onActivateTrialFeatureSuccess', () => {\n\t\t\t\tAjax.runAction('disk.api.onlyoffice.handleTrialFeatureActivation', {});\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic showEditPromo(): void\n\t{\n\t\tif (this.shouldShowEndDemo())\n\t\t{\n\t\t\tthis.showEndOfDemo();\n\t\t}\n\t\telse if (Reflection.getClass('BX.UI.InfoHelper'))\n\t\t{\n\t\t\tBX.UI.InfoHelper.show('limit_office_small_documents', {featureId: 'disk_onlyoffice_edit'} );\n\t\t}\n\t}\n\n\tstatic showViewPromo(): void\n\t{\n\t\tconst firstRow = this.canEdit() ? Loc.getMessage('JS_DISK_ONLYOFFICE_PROMO_EDIT_POPUP_1') : Loc.getMessage('JS_DISK_ONLYOFFICE_PROMO_VIEW_POPUP_1');\n\t\tconst content = Tag.render`\n\t\t\t<div>\n\t\t\t\t<div>${firstRow}</div>\n\t\t\t\t<div style=\"padding-top: 15px;\">${Loc.getMessage('JS_DISK_ONLYOFFICE_PROMO_VIEW_POPUP_2')}</div>\n\t\t\t\t<div style=\"padding-top: 15px;\">${Loc.getMessage('JS_DISK_ONLYOFFICE_PROMO_VIEW_POPUP_3')}</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tMessageBox.show({\n\t\t\ttitle: this.canEdit()? Loc.getMessage('JS_DISK_ONLYOFFICE_PROMO_EDIT_POPUP_TITLE') : Loc.getMessage('JS_DISK_ONLYOFFICE_PROMO_VIEW_POPUP_TITLE'),\n\t\t\tmessage: content,\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.OK,\n\t\t\tokCaption: Loc.getMessage('DISK_JS_BTN_CLOSE'),\n\t\t\tpopupOptions: {\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: () => {\n\t\t\t\t\t\tthis.registerView('got_promo_onlyoffice');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic showEndOfDemo(): void\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div>\n\t\t\t\t<div>${Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_1')}</div>\n\t\t\t\t<ul>\n\t\t\t\t\t<li>${Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_LIST_1')}</li>\n\t\t\t\t\t<li>${Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_LIST_2')}</li>\n\t\t\t\t\t<li>${Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_LIST_3')}</li>\n\t\t\t\t</ul>\n\t\t\t\t<div>${Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_NOTICE')}</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tMessageBox.show({\n\t\t\ttitle: Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_TITLE'),\n\t\t\tmessage: content,\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tokCaption: Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_CONTINUE_WORK_WITH_DOCS'),\n\t\t\tonOk: () => {\n\t\t\t\tthis.showEditPromo();\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tcancelCaption: Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_SETUP_WORK'),\n\t\t\tonCancel: () => {\n\t\t\t\tBX.Disk.InformationPopups.openWindowForSelectDocumentService({});\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tpopupOptions: {\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: () => {\n\t\t\t\t\t\tthis.registerView('got_end_demo_onlyoffice');\n\n\t\t\t\t\t\tBX.message.disk_document_service = null;\n\t\t\t\t\t\tAjax.runAction('disk.api.onlyoffice.handleEndOfTrialFeature', {});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};"],"names":["PromoPopup","BX","Disk","isAvailableOnlyOffice","message","undefined","optionName","userOptions","save","send","shouldShowEndDemo","showEndOfDemo","Reflection","getClass","UI","InfoHelper","show","featureId","EventEmitter","subscribeOnce","Ajax","runAction","firstRow","canEdit","Loc","getMessage","content","Tag","render","MessageBox","title","modal","buttons","MessageBoxButtons","OK","okCaption","popupOptions","events","onPopupShow","registerView","OK_CANCEL","onOk","showEditPromo","cancelCaption","onCancel","InformationPopups","openWindowForSelectDocumentService","disk_document_service"],"mappings":"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"}