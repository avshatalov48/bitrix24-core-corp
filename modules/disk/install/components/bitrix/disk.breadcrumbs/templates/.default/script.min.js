BX.namespace("BX.Disk");BX.Disk.BreadcrumbsClass=function(){var t=function(t){this.storageId=t.storageId;this.containerId=t.containerId;this.collapsedCrumbs=t.collapsedCrumbs||[];this.showOnlyDeleted=t.showOnlyDeleted||0;this.enableDropdown=t.enableDropdown;this.container=BX(this.containerId);this.ajaxUrl="/bitrix/components/bitrix/disk.breadcrumbs/ajax.php";this.container.style.opacity=1;this.setEvents()};t.prototype.setEvents=function(){BX.bindDelegate(this.container,"click",{className:"js-disk-breadcrumbs-arrow"},this.onClickArrow.bind(this));BX.bind(this.getFirstCrumb(),"dblclick",function(t){var e=this.getFirstCrumb();new BX.Disk.Tree.NavigateModal({id:e.dataset.objectId,name:e.dataset.objectName},{}).show();t.preventDefault()}.bind(this));BX.bindDelegate(this.container,"click",{className:"js-disk-breadcrumbs-folder-link"},this.onClickBreadcrumb.bind(this));BX.addCustomEvent("Disk.FolderListClass:onFolderOpen",this.onOpenGridFolder.bind(this));BX.addCustomEvent("Disk.FolderListComponent:onFolderOpen",this.onOpenGridFolder.bind(this));BX.addCustomEvent("Disk.FolderListClass:onPopState",this.reloadByPath.bind(this));BX.addCustomEvent("Disk.FolderListComponent:onPopState",this.reloadByPath.bind(this));BX.addCustomEvent("Disk.FolderListClass:openFolderAfterFilter",this.reloadByPath.bind(this));BX.addCustomEvent("Disk.TrashCanClass:openFolderAfterFilter",this.reloadByPath.bind(this));BX.addCustomEvent("Disk.TrashCanClass:onPopState",this.reloadByPath.bind(this));BX.addCustomEvent("Disk.TrashCanClass:onFolderOpen",this.onOpenGridFolder.bind(this))};t.prototype.getSiblings=function(t){var e=[];var r=t;for(;r;r=r.nextSibling){if(r.nodeType==1&&r!=t){e.push(r)}}return e};t.prototype.expand=function(t,e,r){var s=t.dataset.objectId;var i=t.dataset.objectParentPath;if(i=="/"){i=""}else if(i.lastIndexOf("/")==i.length-1){i=i.substr(0,i.length-1)}var a=[];for(var n in r){if(!r.hasOwnProperty(n)){continue}var o=r[n];var d={text:o.name,title:o.name,href:i+"/"+encodeURIComponent(o.uriComponent)+"/",dataset:{objectId:o.id},onclick:function(t,e){e.menuWindow.close();var r=BX.findParent(e.menuWindow.bindElement,{className:"js-disk-breadcrumbs-folder"});this.removeRightSidedCrumbs(r)}.bind(this)};if(o.className){d.className=o.className+" menu-popup-no-icon"}a.push(d)}BX.PopupMenu.show("disk_breadcrumbs_"+s,e,a,{autoHide:true,angle:{offset:0},events:{onPopupClose:function(){}}})};t.prototype.onClickBreadcrumb=function(t){var e=t.target||t.srcElement;if(BX.hasClass(e,"js-disk-breadcrumbs-arrow")){return}if(!BX.hasClass(e,"js-disk-breadcrumbs-folder")){e=BX.findParent(e,{className:"js-disk-breadcrumbs-folder"})}this.removeRightSidedCrumbs(e);this.hideArrow(e)};t.prototype.removeRightSidedCrumbs=function(t){this.getSiblings(t).forEach(function(t){BX.remove(t)})};t.prototype.onOpenGridFolder=function(t,e){var r=this.getLastCrumb();if(r.dataset.objectId==t.id){return}if(e){return}this.appendCrumb(t)};t.prototype.getLastCrumb=function(){var t=this.container.querySelectorAll(".js-disk-breadcrumbs-folder");if(!t.length){return null}return t[t.length-1]};t.prototype.getFirstCrumb=function(){return this.container.querySelector(".js-disk-breadcrumbs-folder")};t.prototype.appendCrumb=function(t){var e=this.createCrumb(t);var r=this.getLastCrumb();this.showArrow(r);this.container.appendChild(e)};t.prototype.reloadByPath=function(t,e){e=e||false;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","reloadBreadcrumbs"),data:{storageId:this.storageId,path:t.link,isTrashcan:e?1:0},onsuccess:function(t){if(!t||!t.html){return}var e=BX.create("div",{html:t.html});var r=e.querySelector(".js-disk-breadcrumbs");this.container.innerHTML=r.innerHTML}.bind(this)})};t.prototype.createCrumb=function(t){var e=this.getFirstCrumb();var r=BX.clone(e);r.setAttribute("data-object-parent-path",t.link);r.setAttribute("data-is-root","");r.setAttribute("data-object-id",t.id);r.setAttribute("data-object-name",t.name);var s=r.querySelector(".js-disk-breadcrumbs-folder-link");s.href=t.link;s.dataset.objectId=t.id;r.setAttribute("title",t.name);r.setAttribute("alt",t.name);this.hideArrow(r);BX.adjust(s,{text:t.name});return r};t.prototype.hideArrow=function(t){var e=t.querySelector(".js-disk-breadcrumbs-arrow");if(e){e.style.opacity="0"}};t.prototype.showArrow=function(t){var e=t.querySelector(".js-disk-breadcrumbs-arrow");if(e){e.style.opacity=""}};t.prototype.onClickDots=function(t){var e=t.srcElement||t.target;BX.PopupMenu.show("disk_breadcrumbs_dots",e,this.collapsedCrumbs,{autoHide:true,angle:{offset:0},events:{onPopupClose:function(){}}});BX.PreventDefault(t)};t.prototype.onClickArrow=function(t){if(!this.enableDropdown){t.preventDefault();return}var e=t.srcElement||t.target;var r=BX.findParent(e,{className:"js-disk-breadcrumbs-folder"},this.container);var s=r.getAttribute("data-object-id");var i=r.getAttribute("data-is-root");if(!s){BX.PreventDefault(t);return}BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSubFolders"),data:{objectId:s,showOnlyDeleted:this.showOnlyDeleted?1:0,isRoot:i?1:0},onsuccess:BX.delegate(function(t){if(!t){return}this.expand(r,e,t.items)},this)});BX.PreventDefault(t)};return t}();