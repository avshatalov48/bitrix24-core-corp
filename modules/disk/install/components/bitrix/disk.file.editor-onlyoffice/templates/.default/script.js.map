{"version":3,"file":"script.js","sources":["src/user-manager.js","src/base-command-handler.js","src/client-command-handler.js","src/server-command-handler.js","src/custom-error-controls.js","src/onlyoffice.js","src/waiting.js"],"sourcesContent":["import type {Context, User, UserManagerOptions} from \"./types\";\nimport {PULL} from \"pull.client\";\nimport {ajax as Ajax} from \"main.core\";\nimport {Users} from \"disk.users\";\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\n\nconst ALLOWED_ATTEMPTS_TO_GET_USER_INFO = 3;\nconst SECONDS_TO_ACTUALIZE_ONLINE = 25;\n\nexport default class UserManager\n{\n\tuserBoxNode: HTMLElement = null;\n\tcontext: Context = null\n\tusers: Users;\n\tbadAttempts: Map<number>;\n\talreadySaidHi: boolean = false;\n\n\tconstructor(options: UserManagerOptions)\n\t{\n\t\tthis.users = new BX.Disk.Users([]);\n\t\tthis.badAttempts = new Map();\n\t\tthis.context = options.context;\n\t\tthis.userBoxNode = options.userBoxNode;\n\t\tthis.alreadySaidHi = false;\n\t\tthis.add(this.context.currentUser);\n\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('onPullStatus', (event: BaseEvent) => {\n\t\t\tif (event.getData()[0] === 'online')\n\t\t\t{\n\t\t\t\tthis.handleWhenPullConnected();\n\t\t\t}\n\t\t});\n\t}\n\n\thandleWhenPullConnected(): void\n\t{\n\t\tif (!this.sentGreetings())\n\t\t{\n\t\t\tthis.sendHiToUsers();\n\t\t\tsetInterval(this.actualizeOnline.bind(this), 1000*SECONDS_TO_ACTUALIZE_ONLINE);\n\t\t}\n\t}\n\n\tactualizeOnline(): void\n\t{\n\t\tthis.refineUsersByOnline();\n\t\tif (!this.sentGreetings())\n\t\t{\n\t\t\tthis.sendHiToUsers();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendPingToUsers();\n\t\t}\n\t}\n\n\tsentGreetings(): boolean\n\t{\n\t\treturn this.alreadySaidHi;\n\t}\n\n\tsendHiToUsers(): void\n\t{\n\t\tif (!PULL.isConnected())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tPULL.sendMessageToChannels([this.context.object.publicChannel], 'disk', 'hiToDocument', {\n\t\t\tuser: {\n\t\t\t\tid: this.context.currentUser.id,\n\t\t\t\tname: this.context.currentUser.name,\n\t\t\t\tavatar: this.#makeLinkAbsolute(this.context.currentUser.avatar),\n\t\t\t},\n\t\t});\n\n\t\tthis.alreadySaidHi = true;\n\t}\n\n\t#makeLinkAbsolute(link: string): string\n\t{\n\t\tif (link.includes('http://') || link.includes('https://'))\n\t\t{\n\t\t\treturn link;\n\t\t}\n\n\t\treturn document.location.origin + link;\n\t}\n\n\tsendWelcomeToUser(): void\n\t{\n\t\tif (!PULL.isConnected())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tPULL.sendMessageToChannels([this.context.object.publicChannel], 'disk', 'welcomeToDocument', {\n\t\t\tuser: {\n\t\t\t\tid: this.context.currentUser.id,\n\t\t\t\tname: this.context.currentUser.name,\n\t\t\t\tavatar: this.#makeLinkAbsolute(this.context.currentUser.avatar),\n\t\t\t},\n\t\t});\n\t}\n\n\tsendPingToUsers(): void\n\t{\n\t\tif (!PULL.isConnected())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tPULL.sendMessageToChannels([this.context.object.publicChannel], 'disk', 'pingDocument', {\n\t\t\tfromUserId: this.context.currentUser.id,\n\t\t\tinfoToken: this.context.currentUser.infoToken,\n\t\t});\n\t}\n\n\tadd(user: User): void\n\t{\n\t\tif (!this.users.hasUser(user.id))\n\t\t{\n\t\t\tthis.users.addUser(user);\n\n\t\t\tconsole.log('Hi new user!', user.id);\n\t\t}\n\n\t\tthis.updateOnline(user.id);\n\t\tthis.renderBox();\n\t}\n\n\tupdateOnline(userId: number): void\n\t{\n\t\tif (this.users.hasUser(userId))\n\t\t{\n\t\t\tthis.users.getUser(userId).onlineAt = Date.now();\n\t\t}\n\t}\n\n\tgetUserInfo(userId: number, infoToken: string): Promise\n\t{\n\t\tif (this.badAttempts.get(userId) >= ALLOWED_ATTEMPTS_TO_GET_USER_INFO)\n\t\t{\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\treject({\n\t\t\t\t\tstatus: 'blocked',\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runComponentAction('bitrix:disk.file.editor-onlyoffice', 'getUserInfo', {\n\t\t\t\tmode: 'ajax',\n\t\t\t\tjson: {\n\t\t\t\t\tdocumentSessionId: this.context.documentSession.id,\n\t\t\t\t\tdocumentSessionHash: this.context.documentSession.hash,\n\t\t\t\t\tuserId: userId,\n\t\t\t\t\tinfoToken: infoToken,\n\t\t\t\t}\n\t\t\t}).then((response) => {\n\t\t\t\tif (response.status === 'success')\n\t\t\t\t{\n\t\t\t\t\tthis.badAttempts.delete(userId);\n\t\t\t\t\tresolve(response.data.user);\n\t\t\t\t}\n\t\t\t}, (response) => {\n\t\t\t\tconst attempts = this.badAttempts.get(userId) || 0;\n\t\t\t\tthis.badAttempts.set(userId, attempts + 1);\n\t\t\t\tconsole.log(this.badAttempts)\n\n\t\t\t\treject(response);\n\t\t\t});\n\t\t});\n\t}\n\n\thas(userId: number): boolean\n\t{\n\t\treturn this.users.hasUser(userId);\n\t}\n\n\tremove(userId: number): void\n\t{\n\t\tif (userId === this.context.currentUser.id)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.users.deleteUser(userId);\n\t\tthis.renderBox();\n\t}\n\n\trefineUsersByOnline(): void\n\t{\n\t\tconst secondsToOffline = 1000*(SECONDS_TO_ACTUALIZE_ONLINE+1)*2;\n\t\tconst now = Date.now();\n\n\t\tthis.users.forEach((user: User) => {\n\t\t\tif (now - user.onlineAt > secondsToOffline)\n\t\t\t{\n\t\t\t\tthis.remove(user.id);\n\t\t\t}\n\t\t})\n\t}\n\n\trenderBox(): void\n\t{\n\t\tif (!this.userBoxNode.childElementCount)\n\t\t{\n\t\t\tthis.userBoxNode.appendChild(this.users.getContainer());\n\t\t}\n\t}\n};","import {PullClient} from \"pull.client\";\nimport type {CommandOptions} from \"./types\";\nimport UserManager from \"./user-manager\";\nimport OnlyOffice from \"./onlyoffice\";\n\nexport default class BaseCommandHandler\n{\n\toptions: CommandOptions = null;\n\tonlyOffice: OnlyOffice = null;\n\tuserManager: UserManager = null;\n\n\tconstructor(commandOptions: CommandOptions)\n\t{\n\t\tthis.options = commandOptions;\n\t\tthis.userManager = commandOptions.userManager;\n\t\tthis.context = commandOptions.context;\n\t\tthis.onlyOffice = commandOptions.onlyOffice;\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'disk';\n\t}\n\n\tgetSubscriptionType(): string\n\t{\n\t\treturn PullClient.SubscriptionType.Server;\n\t}\n\n\tfilterCurrentObject(handler: Function): any\n\t{\n\t\treturn (data) => {\n\t\t\tif (this.context.object.id !== data.object.id)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn handler(data);\n\t\t};\n\t}\n\n\tisCurrentUser(userId: number): boolean\n\t{\n\t\treturn this.context.currentUser.id === userId;\n\t}\n}","import BaseCommandHandler from \"./base-command-handler\";\nimport {PullClient} from \"pull.client\";\nimport type {ExitDocumentMessage, HiDocumentMessage, PingDocumentMessage, WelcomeDocumentMessage} from \"./types\";\n\nexport default class ClientCommandHandler extends BaseCommandHandler\n{\n\tgetSubscriptionType(): string\n\t{\n\t\treturn PullClient.SubscriptionType.Client;\n\t}\n\n\tgetMap(): Object\n\t{\n\t\treturn {\n\t\t\texitDocument: this.handleExitDocument.bind(this),\n\t\t\tpingDocument: this.handlePingDocument.bind(this),\n\t\t\thiToDocument: this.handleHiToDocument.bind(this),\n\t\t\twelcomeToDocument: this.handleWelcomeToDocument.bind(this),\n\t\t};\n\t}\n\n\thandleExitDocument(data: ExitDocumentMessage): void\n\t{\n\t\tconsole.log('exitDocument', data);\n\n\t\tconst fromUserId = data.fromUserId;\n\t\tif (!this.isCurrentUser(fromUserId))\n\t\t{\n\t\t\tthis.userManager.remove(fromUserId);\n\t\t}\n\t}\n\n\thandleWelcomeToDocument(data: WelcomeDocumentMessage): void\n\t{\n\t\tconsole.log('handleWelcomeToDocument', data);\n\n\t\tthis.processNewbieInDocument(data);\n\t}\n\n\thandleHiToDocument(data: HiDocumentMessage): void\n\t{\n\t\tconsole.log('handleHiToDocument', data);\n\n\t\tconst newbieAdded = this.processNewbieInDocument(data);\n\t\tif (newbieAdded)\n\t\t{\n\t\t\t//immediately send welcome to add actual online information for new user.\n\t\t\tthis.userManager.sendWelcomeToUser();\n\t\t}\n\t}\n\n\tprocessNewbieInDocument(data: HiDocumentMessage|WelcomeDocumentMessage): boolean\n\t{\n\t\tconst fromUserId = data.user.id;\n\t\tif (this.isCurrentUser(fromUserId))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.userManager.has(fromUserId))\n\t\t{\n\t\t\tthis.userManager.updateOnline(fromUserId);\n\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.userManager.add(data.user);\n\n\t\treturn true;\n\t}\n\n\thandlePingDocument(data: PingDocumentMessage): void\n\t{\n\t\tconsole.log('handlePingDocument', data);\n\n\t\tconst fromUserId = data.fromUserId;\n\t\tif (this.isCurrentUser(fromUserId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.userManager.has(fromUserId))\n\t\t{\n\t\t\tthis.userManager.updateOnline(fromUserId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.userManager.sentGreetings())\n\t\t\t{\n\t\t\t\tthis.userManager.getUserInfo(data.fromUserId, data.infoToken).then(userData => {\n\t\t\t\t\tthis.userManager.add(userData);\n\t\t\t\t}, () => {});\n\t\t\t}\n\t\t}\n\t}\n}","import BaseCommandHandler from \"./base-command-handler\";\nimport type {DocumentSavedMessage} from \"./types\";\nimport {ContentUpdatedMessage} from \"./types\";\nimport {Loc, Tag, Text} from \"main.core\";\n\nexport default class ServerCommandHandler extends BaseCommandHandler\n{\n\tgetMap(): Object\n\t{\n\t\treturn {\n\t\t\tonlyoffice: this.filterCurrentObject(this.handleSavedDocument.bind(this)),\n\t\t\tcontentUpdated: this.filterCurrentObject(this.handleContentUpdated.bind(this)),\n\t\t};\n\t}\n\n\thandleSavedDocument(data: DocumentSavedMessage): void\n\t{\n\t\tconsole.log('handleSavedDocument', data);\n\n\t\tif (data.documentSessionInfo.wasFinallySaved)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tautoHide: false,\n\t\t\t\tcontent: Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_SAVED_AFTER_IDLE'),\n\t\t\t});\n\t\t}\n\t}\n\n\thandleContentUpdated(data: ContentUpdatedMessage): void\n\t{\n\t\tconsole.log('handleContentUpdated', data);\n\n\t\tif (!data.object.updatedBy || this.isCurrentUser(data.object.updatedBy))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.onlyOffice.wasDocumentChanged())\n\t\t{\n\t\t\tthis.userManager.getUserInfo(data.object.updatedBy, data.updatedBy.infoToken).then(userData => {\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_SAVED_WHILE_EDITING', {\n\t\t\t\t\t\t'#NAME#': Text.encode(data.object.name),\n\t\t\t\t\t\t'#USER_NAME#': Text.encode(userData.name),\n\t\t\t\t\t}),\n\t\t\t\t});\n\t\t\t}, () => {});\n\t\t}\n\t\telse if (this.onlyOffice.isViewMode())\n\t\t{\n\t\t\tthis.userManager.getUserInfo(data.object.updatedBy, data.updatedBy.infoToken).then(userData => {\n\t\t\t\tlet content = Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_VIEW_NON_ACTUAL_VERSION', {\n\t\t\t\t\t'#NAME#': Text.encode(data.object.name),\n\t\t\t\t\t'#USER_NAME#': Text.encode(userData.name),\n\t\t\t\t});\n\t\t\t\tcontent = Tag.render`<span>${content}</span>`;\n\n\t\t\t\tconst refreshButton = content.querySelector('[data-refresh-btn]');\n\t\t\t\tif (refreshButton)\n\t\t\t\t{\n\t\t\t\t\tTag.style(refreshButton)`\n\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t`;\n\t\t\t\t\trefreshButton.addEventListener('click', this.#handleClickToRefreshEditor.bind(this));\n\t\t\t\t}\n\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: content,\n\t\t\t\t});\n\t\t\t}, () => {});\n\t\t}\n\t}\n\n\t#handleClickToRefreshEditor(): void\n\t{\n\t\tthis.onlyOffice.reloadView();\n\t}\n}","import {Dom, Loc, Tag, Text} from \"main.core\";\nimport {Button} from \"ui.buttons\";\nimport type {CommonWarningOptions} from \"./types\";\n\nexport default class CustomErrorControl\n{\n\tshowWhenTooLarge(fileName: string, container: HTMLElement, targetNode: HTMLElement, linkToDownload: string): void\n\t{\n\t\tthis.showCommonWarning({\n\t\t\tcontainer: container,\n\t\t\ttargetNode: targetNode,\n\t\t\ttitle: Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_CUSTOM_ERROR_LARGE_FILE_TITLE'),\n\t\t\tdescription: Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_CUSTOM_ERROR_LARGE_FILE_DESCR'),\n\t\t\tfileName: fileName,\n\t\t\tlinkToDownload: linkToDownload,\n\t\t});\n\t}\n\n\tshowWhenNotFound(container: HTMLElement, targetNode: HTMLElement): void\n\t{\n\t\tthis.showCommonWarning({\n\t\t\tcontainer: container,\n\t\t\ttargetNode: targetNode,\n\t\t\ttitle: Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_CUSTOM_ERROR_FILE_TITLE'),\n\t\t\tdescription: Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_CUSTOM_ERROR_RIGHTS_OR_NOT_FOUND_DESCR'),\n\t\t});\n\t}\n\n\tshowCommonWarning(options: CommonWarningOptions): void\n\t{\n\t\tconst containerClass = 'disk-fe-office-warning--popup';\n\n\t\tlet fileNameNode = '';\n\t\tif (options.fileName)\n\t\t{\n\t\t\tfileNameNode = Tag.render`<div class=\"disk-fe-office-warning-file-name\">${Text.encode(options.fileName)}</div>`;\n\t\t}\n\n\t\tlet downloadButtonNode = '';\n\t\tif (options.linkToDownload)\n\t\t{\n\t\t\tconst downloadButton = new Button({\n\t\t\t\ttext: Loc.getMessage('DISK_FILE_EDITOR_ONLYOFFICE_HEADER_BTN_DOWNLOAD'),\n\t\t\t\tround: true,\n\t\t\t\ttag: Button.Tag.LINK,\n\t\t\t\tlink: options.linkToDownload,\n\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\tclassName: 'disk-fe-office-warning-btn',\n\t\t\t\tprops: {\n\t\t\t\t\ttarget: '_blank',\n\t\t\t\t}\n\t\t\t});\n\t\t\tdownloadButtonNode = downloadButton.render();\n\t\t}\n\n\t\tconst errorControl = Tag.render`\n\t\t\t<div class=\"disk-fe-office-warning-wrap\">\n\t\t\t\t<div class=\"disk-fe-office-warning-overlay\"></div>\n\t\t\t\t<div class=\"disk-fe-office-warning-box\">\n\t\t\t\t\t<div class=\"disk-fe-office-warning-icon\"></div>\n\t\t\t\t\t<div class=\"disk-fe-office-warning-title\">${options.title}</div>\n\t\t\t\t\t${fileNameNode}\n\t\t\t\t\t<div class=\"disk-fe-office-warning-desc\">${options.description}</div>\n\t\t\t\t\t${downloadButtonNode}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.addClass(options.container, containerClass);\n\t\tDom.prepend(errorControl, options.targetNode);\n\t}\n}\n","import {ajax as Ajax, Runtime, Type} from \"main.core\";\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\nimport { MenuItem } from \"main.popup\";\nimport {PULL, PullClient} from \"pull.client\";\nimport type {EditorOptions, DocumentSession, Context} from \"./types\";\nimport {ButtonManager, Button, SplitButton} from \"ui.buttons\";\nimport ClientCommandHandler from \"./client-command-handler\";\nimport ServerCommandHandler from \"./server-command-handler\";\nimport UserManager from \"./user-manager\";\nimport {LegacyPopup, SharingControlType} from \"disk.sharing-legacy-popup\";\nimport {ExternalLink} from \"disk.external-link\";\nimport {PromoPopup} from \"disk.onlyoffice-promo-popup\";\nimport CustomErrorControl from \"./custom-error-controls\";\n\nconst SECONDS_TO_MARK_AS_STILL_WORKING = 60;\n\nexport default class OnlyOffice\n{\n\teditor: any = null;\n\teditorJson: any = null;\n\tuserBoxNode: HTMLElement = null;\n\teditorNode: HTMLElement = null;\n\teditorWrapperNode: HTMLElement = null;\n\ttargetNode: HTMLElement = null;\n\tdocumentSession: DocumentSession = null;\n\tlinkToEdit: string = null;\n\tlinkToView: string = null;\n\tlinkToDownload: string = null;\n\tpullConfig: any = null;\n\teditButton: SplitButton = null;\n\tsetupSharingButton: Button = null;\n\tdocumentWasChanged: boolean = false;\n\tdontEndCurrentDocumentSession: boolean = false;\n\tcontext: Context = null;\n\tusersInDocument: UserManager = null;\n\tsharingControlType: ?SharingControlType = null;\n\tbrokenDocumentOpened: boolean = false;\n\n\tconstructor(editorOptions: EditorOptions)\n\t{\n\t\tconst options = Type.isPlainObject(editorOptions) ? editorOptions : {};\n\n\t\tthis.pullConfig = options.pullConfig;\n\t\tthis.documentSession = options.documentSession;\n\t\tthis.linkToEdit = options.linkToEdit;\n\t\tthis.linkToView = options.linkToView;\n\t\tthis.linkToDownload = options.linkToDownload;\n\t\tthis.targetNode = options.targetNode;\n\t\tthis.userBoxNode = options.userBoxNode;\n\t\tthis.editorNode = options.editorNode;\n\t\tthis.editorWrapperNode = options.editorWrapperNode;\n\t\tthis.editButton = ButtonManager.createByUniqId(editorOptions.panelButtonUniqIds.edit);\n\t\tthis.setupSharingButton = ButtonManager.createByUniqId(editorOptions.panelButtonUniqIds.setupSharing);\n\t\tthis.sharingControlType = editorOptions.sharingControlType;\n\t\tthis.context = {\n\t\t\tcurrentUser: options.currentUser,\n\t\t\tdocumentSession: this.documentSession,\n\t\t\tobject: options.object,\n\t\t\tattachedObject: options.attachedObject,\n\t\t};\n\t\tthis.context.object.publicChannel = options.publicChannel;\n\t\tthis.usersInDocument = new UserManager({\n\t\t\tcontext: this.context,\n\t\t\tuserBoxNode: this.userBoxNode,\n\t\t});\n\n\t\tthis.sendTelemetryEvent('load');\n\t\tthis.initializeEditor(options.editorJson);\n\n\t\tconst currentSlider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (currentSlider)\n\t\t{\n\t\t\tcurrentSlider.getData().set('documentSession', this.documentSession);\n\t\t}\n\n\t\tthis.loadDiskExtensionInTopWindow();\n\n\t\tthis.initPull();\n\t\tthis.bindEvents();\n\t\tif (this.isEditMode())\n\t\t{\n\t\t\tthis.registerTimerToTrackWork();\n\t\t}\n\n\t\tif (PromoPopup.shouldShowViewPromo())\n\t\t{\n\t\t\tPromoPopup.showViewPromo();\n\t\t}\n\t}\n\n\tregisterTimerToTrackWork(): void\n\t{\n\t\tsetInterval(this.#trackWork.bind(this), SECONDS_TO_MARK_AS_STILL_WORKING*1000);\n\t}\n\n\t#trackWork(): void\n\t{\n\t\t\tAjax.runComponentAction('bitrix:disk.file.editor-onlyoffice', 'markAsStillWorkingSession', {\n\t\t\t\tmode: 'ajax',\n\t\t\t\tjson: {\n\t\t\t\t\tdocumentSessionId: this.context.documentSession.id,\n\t\t\t\t\tdocumentSessionHash: this.context.documentSession.hash,\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tinitPull(): void\n\t{\n\t\tif (this.pullConfig)\n\t\t{\n\t\t\tBX.PULL = new PullClient({\n\t\t\t\tskipStorageInit: true\n\t\t\t});\n\t\t\tBX.PULL.start(this.pullConfig);\n\t\t}\n\t}\n\n\tsendTelemetryEvent(action, data): void\n\t{\n\t\tdata = data || {};\n\n\t\tconst currentSlider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (!currentSlider)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentSliderData = currentSlider.getData();\n\t\tdata.action = action;\n\t\tdata.uid = currentSliderData.get('uid');\n\t\tdata.documentSessionId = this.context.documentSession.id;\n\t\tdata.documentSessionHash = this.context.documentSession.hash;\n\t\tdata.fileSize = this.context.object.size;\n\n\t\tBX.Disk.sendTelemetryEvent(data);\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe(\"SidePanel.Slider:onClose\", this.handleSliderClose.bind(this));\n\t\twindow.addEventListener(\"beforeunload\", this.handleClose.bind(this));\n\n\t\tif (window.top !== window)\n\t\t{\n\t\t\twindow.addEventListener(\"message\", (event: MessageEvent) => {\n\t\t\t\tif (event.data === 'closeIframe')\n\t\t\t\t{\n\t\t\t\t\tthis.handleClose();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.editorJson.document.permissions.edit === true && this.editButton)\n\t\t{\n\t\t\tif (this.editButton.hasOwnProperty('mainButton'))\n\t\t\t{\n\t\t\t\tthis.editButton.getMainButton().bindEvent('click', this.handleClickEditButton.bind(this));\n\n\t\t\t\tlet menuWindow = this.editButton.getMenuWindow();\n\t\t\t\tlet menuItems = Runtime.clone(menuWindow.getMenuItems());\n\n\t\t\t\tfor (let i = 0; i < menuItems.length; i++)\n\t\t\t\t{\n\t\t\t\t\tlet menuItem = menuItems[i];\n\t\t\t\t\tlet menuItemOptions = Runtime.clone(menuItem.options);\n\t\t\t\t\tmenuItemOptions.onclick = this.handleClickEditSubItems.bind(this);\n\n\t\t\t\t\tmenuWindow.removeMenuItem(menuItem.getId());\n\t\t\t\t\tmenuWindow.addMenuItem(menuItemOptions);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.editButton.bindEvent('click', this.handleClickEditButton.bind(this));\n\t\t\t}\n\t\t}\n\t\tif (this.setupSharingButton)\n\t\t{\n\t\t\tlet menuWindow = this.setupSharingButton.getMenuWindow();\n\t\t\tlet extLinkOptions = menuWindow.getMenuItem('ext-link').options;\n\t\t\textLinkOptions.onclick = this.handleClickSharingByExternalLink.bind(this);\n\n\t\t\tmenuWindow.removeMenuItem('ext-link');\n\t\t\tmenuWindow.addMenuItem(extLinkOptions);\n\n\t\t\tlet sharingOptions = menuWindow.getMenuItem('sharing').options;\n\t\t\tsharingOptions.onclick = this.handleClickSharing.bind(this);\n\n\t\t\tmenuWindow.removeMenuItem('sharing');\n\t\t\tmenuWindow.addMenuItem(sharingOptions);\n\t\t}\n\n\t\tPULL.subscribe(new ClientCommandHandler({\n\t\t\tonlyOffice: this,\n\t\t\tcontext: this.context,\n\t\t\tuserManager: this.usersInDocument,\n\t\t}));\n\t\tPULL.subscribe(new ServerCommandHandler({\n\t\t\tonlyOffice: this,\n\t\t\tcontext: this.context,\n\t\t\tuserManager: this.usersInDocument,\n\t\t}));\n\t}\n\n\tinitializeEditor(options): void\n\t{\n\t\toptions.events = {\n\t\t\tonDocumentStateChange: this.handleDocumentStateChange.bind(this),\n\t\t\tonDocumentReady: this.handleDocumentReady.bind(this),\n\t\t\tonMetaChange: this.handleMetaChange.bind(this),\n\t\t\tonInfo: this.handleInfo.bind(this),\n\t\t\tonWarning: this.handleWarning.bind(this),\n\t\t\tonError: this.handleError.bind(this),\n\t\t\tonRequestClose: this.handleRequestClose.bind(this),\n\t\t}\n\n\t\tif (options.document.permissions.rename)\n\t\t{\n\t\t\toptions.events.onRequestRename = this.handleRequestRename.bind(this);\n\t\t}\n\n\t\tthis.editorJson = options;\n\t\tthis.editor = new DocsAPI.DocEditor(this.editorNode.id, options);\n\t}\n\n\tloadDiskExtensionInTopWindow(): void\n\t{\n\t\tif (window.top !== window && !BX.getClass('window.top.BX.Disk.endEditSession'))\n\t\t{\n\t\t\ttop.BX.loadExt('disk');\n\t\t}\n\t}\n\n\temitEventOnSaved(): void\n\t{\n\t\tconst sliderByWindow = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (sliderByWindow)\n\t\t{\n\t\t\tBX.SidePanel.Instance.postMessageAll(window, 'Disk.OnlyOffice:onSaved', {\n\t\t\t\tdocumentSession: this.documentSession,\n\t\t\t\tobject: this.context.object,\n\t\t\t});\n\t\t}\n\n\t\tEventEmitter.emit('Disk.OnlyOffice:onSaved', {\n\t\t\tdocumentSession: this.documentSession,\n\t\t\tobject: this.context.object,\n\t\t});\n\t}\n\n\temitEventOnClosed(): void\n\t{\n\t\tconst sliderByWindow = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tlet process = 'edit';\n\t\tif (sliderByWindow)\n\t\t{\n\t\t\tprocess = sliderByWindow.getData().get('process') || 'edit';\n\n\t\t\tBX.SidePanel.Instance.postMessageAll(window, 'Disk.OnlyOffice:onClosed', {\n\t\t\t\tdocumentSession: this.documentSession,\n\t\t\t\tobject: this.context.object,\n\t\t\t\tprocess: process,\n\t\t\t});\n\t\t}\n\n\t\tEventEmitter.emit('Disk.OnlyOffice:onClosed', {\n\t\t\tdocumentSession: this.documentSession,\n\t\t\tobject: this.context.object,\n\t\t\tprocess: process,\n\t\t});\n\t}\n\n\thandleClickEditButton(): void\n\t{\n\t\tif (PromoPopup.shouldShowEditPromo())\n\t\t{\n\t\t\tPromoPopup.showEditPromo();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.handleRequestEditRights();\n\t}\n\n\thandleClickSharing(): void\n\t{\n\t\tswitch (this.sharingControlType)\n\t\t{\n\t\t\tcase SharingControlType.WITH_CHANGE_RIGHTS:\n\t\t\t\t(new LegacyPopup()).showSharingDetailWithChangeRights({\n\t\t\t\t\tobject: this.context.object\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase SharingControlType.WITH_SHARING:\n\t\t\t\t(new LegacyPopup()).showSharingDetailWithChangeRights({\n\t\t\t\t\tobject: this.context.object\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase SharingControlType.WITHOUT_EDIT:\n\t\t\t\t(new LegacyPopup()).showSharingDetailWithoutEdit({\n\t\t\t\t\tobject: this.context.object\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase SharingControlType.BLOCKED_BY_FEATURE:\n\t\t\t\tBX.UI.InfoHelper.show('limit_office_files_access_permissions');\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\thandleClickSharingByExternalLink(event, menuItem: MenuItem): void\n\t{\n\t\tif (menuItem.dataset.shouldBlockExternalLinkFeature)\n\t\t{\n\t\t\teval(menuItem.dataset.blockerExternalLinkFeature);\n\n\t\t\treturn;\n\t\t}\n\n\t\tExternalLink.showPopup(this.context.object.id);\n\t}\n\n\thandleClickEditSubItems(event, menuItem: MenuItem): void\n\t{\n\t\tlet serviceCode = menuItem.getId();\n\t\tif(serviceCode === 'onlyoffice')\n\t\t{\n\t\t\tthis.handleClickEditButton();\n\n\t\t\treturn;\n\t\t}\n\n\t\tBX.Disk.Viewer.Actions.runActionEdit({\n\t\t\tname: this.context.object.name,\n\t\t\tobjectId: this.context.object.id,\n\t\t\tattachedObjectId: this.context.attachedObject.id,\n\t\t\tserviceCode: serviceCode,\n\t\t});\n\t}\n\n\thandleSaveButtonClick(): void\n\t{\n\t\tPULL.subscribe({\n\t\t\tmoduleId: 'disk',\n\t\t\tcommand: 'onlyoffice',\n\t\t\tcallback: (data) => {\n\t\t\t\tif (data.hash === this.documentSession.hash)\n\t\t\t\t{\n\t\t\t\t\tthis.emitEventOnSaved();\n\n\t\t\t\t\twindow.BX.Disk.showModalWithStatusAction();\n\t\t\t\t\tBX.SidePanel.Instance.close();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleRequestClose(): void\n\t{\n\t\tconsole.log('handleRequestClose');\n\t\tconst currentSlider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (!currentSlider)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tcurrentSlider.getData().set('dontInvokeRequestClose', true);\n\t\tthis.handleClose();\n\t\tcurrentSlider.close();\n\t}\n\n\tisDocumentReadyToEdit(): boolean\n\t{\n\t\tif (this.brokenDocumentOpened)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.caughtDocumentReady)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\thandleSliderClose(event: BaseEvent): void\n\t{\n\t\tconsole.log('handleSliderClose');\n\n\t\tconst currentSlider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (!currentSlider)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentSliderData = currentSlider.getData();\n\t\tconst uid = currentSliderData.get('uid');\n\n\t\t/** @type {BX.SidePanel.Event} */\n\t\tconst [sliderEvent] = event.getData();\n\t\tif (sliderEvent.getSlider().getData().get('uid') !== uid)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isViewMode() || !this.isDocumentReadyToEdit())\n\t\t{\n\t\t\tthis.handleClose();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.editor.hasOwnProperty('requestClose'))\n\t\t{\n\t\t\tif (currentSliderData.get('dontInvokeRequestClose'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.editor.requestClose();\n\t\t\tsliderEvent.denyAction();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.handleClose();\n\t\t}\n\t}\n\n\thandleClose(): void\n\t{\n\t\tconsole.log('handleClose');\n\n\t\tPULL.sendMessageToChannels([this.context.object.publicChannel], 'disk', 'exitDocument', {\n\t\t\tfromUserId: this.context.currentUser.id,\n\t\t});\n\n\t\tthis.sendTelemetryEvent('exit');\n\n\t\tthis.emitEventOnClosed();\n\n\t\tif (this.dontEndCurrentDocumentSession)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttop.BX.Disk.endEditSession({\n\t\t\tid: this.documentSession.id,\n\t\t\thash: this.documentSession.hash,\n\t\t\tdocumentWasChanged: this.documentWasChanged,\n\t\t});\n\t}\n\n\thandleDocumentStateChange(event): void\n\t{\n\t\tif (!this.caughtDocumentReady || !this.caughtInfoEvent)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Date.now() - Math.max(this.caughtDocumentReady, this.caughtInfoEvent) < 500)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentWasChanged = true;\n\t}\n\n\twasDocumentChanged(): boolean\n\t{\n\t\treturn this.documentWasChanged;\n\t}\n\n\tisEditMode(): boolean\n\t{\n\t\treturn this.editorJson.editorConfig.mode === 'edit';\n\t}\n\n\tisViewMode(): boolean\n\t{\n\t\treturn !this.isEditMode();\n\t}\n\n\treloadView(): void\n\t{\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tdocument.location = this.linkToView;\n\t\t}\n\t}\n\n\thandleInfo(): void\n\t{\n\t\tthis.caughtInfoEvent = Date.now();\n\t}\n\n\thandleWarning(d): void\n\t{\n\t\tconsole.log('onlyoffice warning:', d.data);\n\t}\n\n\thandleError(d): void\n\t{\n\t\tconsole.log('onlyoffice error:', d.data);\n\n\t\tif (d.data.errorCode === -82)\n\t\t{\n\t\t\tthis.brokenDocumentOpened = true;\n\t\t}\n\t\telse if (d.data.errorCode === -84)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\t(new CustomErrorControl()).showWhenTooLarge(\n\t\t\t\t\tthis.context.object.name,\n\t\t\t\t\tthis.getEditorWrapperNode(),\n\t\t\t\t\tthis.getContainer(),\n\t\t\t\t\tthis.linkToDownload,\n\t\t\t\t);\n\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\thandleRequestRename(event): void\n\t{\n\t\tconst newName = event.data;\n\t\tAjax.runAction('disk.api.onlyoffice.renameDocument', {\n\t\t\tmode: 'ajax',\n\t\t\tjson: {\n\t\t\t\tdocumentSessionId: this.context.documentSession.id,\n\t\t\t\tdocumentSessionHash: this.context.documentSession.hash,\n\t\t\t\tnewName: newName,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleMetaChange(event): void\n\t{\n\t}\n\n\thandleDocumentReady(): void\n\t{\n\t\tthis.sendTelemetryEvent('ready');\n\n\t\tthis.caughtDocumentReady = Date.now();\n\t}\n\n\thandleRequestEditRights(): void\n\t{\n\t\tthis.dontEndCurrentDocumentSession = true;\n\n\t\tlet linkToEdit = BX.util.add_url_param(\n\t\t\t'/bitrix/services/main/ajax.php',\n\t\t\t{\n\t\t\t\taction: 'disk.api.documentService.goToEdit',\n\t\t\t\tserviceCode: 'onlyoffice',\n\t\t\t\tdocumentSessionId: this.documentSession.id,\n\t\t\t\tdocumentSessionHash: this.documentSession.hash,\n\t\t\t}\n\t\t);\n\n\t\tif (this.linkToEdit)\n\t\t{\n\t\t\tlinkToEdit = this.linkToEdit;\n\t\t}\n\n\t\tconst currentSlider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (!currentSlider)\n\t\t{\n\t\t\twindow.location = linkToEdit;\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet customLeftBoundary = currentSlider.getCustomLeftBoundary();\n\t\tcurrentSlider.close();\n\n\t\tBX.SidePanel.Instance.open(\n\t\t\tlinkToEdit, {\n\t\t\twidth: '100%',\n\t\t\tcustomLeftBoundary: customLeftBoundary,\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: false,\n\t\t\tdata: {\n\t\t\t\tdocumentEditor: true\n\t\t\t}\n\t\t});\n\t}\n\n\tgetEditor()\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorNode(): HTMLElement\n\t{\n\t\treturn this.editorNode;\n\t}\n\n\tgetEditorWrapperNode(): HTMLElement\n\t{\n\t\treturn this.editorWrapperNode;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.targetNode;\n\t}\n}\n","import {ajax as Ajax, Type} from \"main.core\";\nimport {PULL} from \"pull.client\";\nimport type {WaitingOptions, DocumentSession, BaseObject} from \"./types\";\n\nexport default class Waiting\n{\n\tdocumentSession: DocumentSession = null;\n\tobject: BaseObject = null;\n\n\tconstructor(waitingOptions: WaitingOptions)\n\t{\n\t\tconst options = Type.isPlainObject(waitingOptions) ? waitingOptions : {};\n\n\t\tthis.documentSession = options.documentSession;\n\t\tthis.object = options.object;\n\n\t\tconst loader = new BX.Loader({\n\t\t\ttarget: options.targetNode,\n\t\t});\n\t\tloader.show();\n\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tPULL.subscribe({\n\t\t\ttype: BX.PullClient.SubscriptionType.Server,\n\t\t\tmoduleId: 'disk',\n\t\t\tcommand: 'onlyoffice',\n\t\t\tcallback: this.handleSavedDocument.bind(this),\n\t\t});\n\t}\n\n\thandleSavedDocument(data): void\n\t{\n\t\tconsole.log('handleSavedDocument', data);\n\n\t\tAjax.runAction('disk.api.onlyoffice.continueWithNewSession', {\n\t\t\tmode: 'ajax',\n\t\t\tjson: {\n\t\t\t\tsessionId: this.documentSession.id,\n\t\t\t\tdocumentSessionHash: this.documentSession.hash,\n\t\t\t}\n\t\t}).then((response) => {\n\t\t\tif (response.status === 'success')\n\t\t\t{\n\t\t\t\tdocument.location.href = response.data.documentSession.link;\n\t\t\t}\n\t\t});\n\t}\n}"],"names":["ALLOWED_ATTEMPTS_TO_GET_USER_INFO","SECONDS_TO_ACTUALIZE_ONLINE","UserManager","options","users","BX","Disk","Users","badAttempts","Map","context","userBoxNode","alreadySaidHi","add","currentUser","bindEvents","EventEmitter","subscribe","event","getData","handleWhenPullConnected","sentGreetings","sendHiToUsers","setInterval","actualizeOnline","bind","refineUsersByOnline","sendPingToUsers","PULL","isConnected","sendMessageToChannels","object","publicChannel","user","id","name","avatar","fromUserId","infoToken","hasUser","addUser","console","log","updateOnline","renderBox","userId","getUser","onlineAt","Date","now","get","Promise","resolve","reject","status","Ajax","runComponentAction","mode","json","documentSessionId","documentSession","documentSessionHash","hash","then","response","data","attempts","set","deleteUser","secondsToOffline","forEach","remove","childElementCount","appendChild","getContainer","link","includes","document","location","origin","BaseCommandHandler","commandOptions","userManager","onlyOffice","PullClient","SubscriptionType","Server","handler","ClientCommandHandler","Client","exitDocument","handleExitDocument","pingDocument","handlePingDocument","hiToDocument","handleHiToDocument","welcomeToDocument","handleWelcomeToDocument","isCurrentUser","processNewbieInDocument","newbieAdded","sendWelcomeToUser","has","getUserInfo","userData","ServerCommandHandler","onlyoffice","filterCurrentObject","handleSavedDocument","contentUpdated","handleContentUpdated","documentSessionInfo","wasFinallySaved","UI","Notification","Center","notify","autoHide","content","Loc","getMessage","updatedBy","wasDocumentChanged","Text","encode","isViewMode","Tag","render","refreshButton","querySelector","style","addEventListener","_classPrivateMethodGet","reloadView","CustomErrorControl","fileName","container","targetNode","linkToDownload","showCommonWarning","title","description","containerClass","fileNameNode","downloadButtonNode","downloadButton","Button","text","round","tag","LINK","color","Color","SUCCESS","className","props","target","errorControl","Dom","addClass","prepend","SECONDS_TO_MARK_AS_STILL_WORKING","OnlyOffice","editorOptions","Type","isPlainObject","pullConfig","linkToEdit","linkToView","editorNode","editorWrapperNode","editButton","ButtonManager","createByUniqId","panelButtonUniqIds","edit","setupSharingButton","setupSharing","sharingControlType","attachedObject","usersInDocument","sendTelemetryEvent","initializeEditor","editorJson","currentSlider","SidePanel","Instance","getSliderByWindow","window","loadDiskExtensionInTopWindow","initPull","isEditMode","registerTimerToTrackWork","PromoPopup","shouldShowViewPromo","showViewPromo","skipStorageInit","start","action","currentSliderData","uid","fileSize","size","handleSliderClose","handleClose","top","permissions","hasOwnProperty","getMainButton","bindEvent","handleClickEditButton","menuWindow","getMenuWindow","menuItems","Runtime","clone","getMenuItems","i","length","menuItem","menuItemOptions","onclick","handleClickEditSubItems","removeMenuItem","getId","addMenuItem","extLinkOptions","getMenuItem","handleClickSharingByExternalLink","sharingOptions","handleClickSharing","events","onDocumentStateChange","handleDocumentStateChange","onDocumentReady","handleDocumentReady","onMetaChange","handleMetaChange","onInfo","handleInfo","onWarning","handleWarning","onError","handleError","onRequestClose","handleRequestClose","rename","onRequestRename","handleRequestRename","editor","DocsAPI","DocEditor","getClass","loadExt","sliderByWindow","postMessageAll","emit","process","shouldShowEditPromo","showEditPromo","handleRequestEditRights","SharingControlType","WITH_CHANGE_RIGHTS","LegacyPopup","showSharingDetailWithChangeRights","WITH_SHARING","WITHOUT_EDIT","showSharingDetailWithoutEdit","BLOCKED_BY_FEATURE","InfoHelper","show","dataset","shouldBlockExternalLinkFeature","eval","blockerExternalLinkFeature","ExternalLink","showPopup","serviceCode","Viewer","Actions","runActionEdit","objectId","attachedObjectId","moduleId","command","callback","emitEventOnSaved","showModalWithStatusAction","close","brokenDocumentOpened","caughtDocumentReady","sliderEvent","getSlider","isDocumentReadyToEdit","requestClose","denyAction","emitEventOnClosed","dontEndCurrentDocumentSession","endEditSession","documentWasChanged","caughtInfoEvent","Math","max","editorConfig","d","errorCode","setTimeout","showWhenTooLarge","getEditorWrapperNode","newName","runAction","util","add_url_param","customLeftBoundary","getCustomLeftBoundary","open","width","cacheable","allowChangeHistory","documentEditor","Waiting","waitingOptions","loader","Loader","type","sessionId","href"],"mappings":"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"}