BX.namespace("BX.Disk");BX.Disk.BreadcrumbsTreeClass=function(){var e=[];var t=true;function s(){return e}function i(t){e.push(t)}var a=function(e){this.rootObject=e.rootObject||{};this.firstObject=e.firstObject||{};this.containerId=e.containerId;this.container=BX(this.containerId);this.storageBaseUrl=e.storageBaseUrl||"/";this.lastNode=null;this.ajaxUrl="/bitrix/components/bitrix/disk.breadcrumbs.tree/ajax.php";this.setEvents();this.drawFirstNode(this.firstObject)};a.prototype.onSelectFolder=function(e){var t=BX.findChild(e,{className:"bx-disk-wf-folder-name"},true);if(!t)return false;var s=[];var i=BX.findChild(t,{tagName:"span"});if(i){s.push(encodeURIComponent(i.textContent||i.innerText))}BX.findParent(e,function(e){if(BX.type.isElementNode(e)&&BX.hasClass(e,"bx-disk-parent")){var t=BX.findChild(e,{className:"bx-disk-wf-folder-name"},true);if(t){var i=BX.findChild(t,{tagName:"span"});if(i){s.push(encodeURIComponent(i.textContent||i.innerText))}}}},this.container);var a=this.storageBaseUrl+s.reverse().join("/");if(a.slice(-1)!="/"){a+="/"}document.location.href=a};a.prototype.onUnSelectFolder=function(e){};a.prototype.onRemoveRowFromDiskList=function(e){var t=BX.findChild(this.container,{tagName:"li",className:"bx-disk-folder-container",attribute:{"data-object-id":e}},true);if(t){BX.remove(t)}};a.prototype.setEvents=function(){BX.addCustomEvent(this.container,"onSelectFolder",BX.proxy(this.onSelectFolder,this));BX.addCustomEvent(this.container,"onUnSelectFolder",BX.proxy(this.onUnSelectFolder,this));BX.addCustomEvent("onRemoveRowFromDiskList",BX.proxy(this.onRemoveRowFromDiskList,this))};a.prototype.drawFirstNode=function(e){var t=this.buildTreeNode(e);var s=BX.create("ul",{props:{className:"bx-disk-wood-folder"}});t.appendChild(s);this.lastNode=t;BX.adjust(this.container,{children:[BX.create("ul",{props:{className:"bx-disk-wood-folder"},children:[t]})]})};a.prototype.loadSubFolders=function(e){if(!e){return}var t=e.getAttribute("data-object-id");if(!t){return}BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSubFoldersToAdd"),data:{objectId:t},onsuccess:BX.delegate(function(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}this.buildTree(e,t);window.jsDD.refreshDestArea()},this)})};a.prototype.buildTree=function(e,t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}var s=BX.create("ul",{props:{className:"bx-disk-wood-folder"}});e.appendChild(s);if(t.items&&t.items.length){for(var i in t.items){if(!t.items.hasOwnProperty(i)){continue}s.appendChild(this.buildTreeNode(t.items[i]))}}else{var a=BX.findChild(e,{className:"bx-disk-wf-arrow"},true);if(a){BX.cleanNode(a)}}BX.removeClass(e,"bx-disk-close");BX.addClass(e,"bx-disk-open");BX.addClass(e,"bx-disk-loaded")};a.prototype.buildTreeNode=function(e){this.lastNode=BX.create("li",{props:{className:"bx-disk-folder-container bx-disk-parent bx-disk-close"},attrs:{"data-object-id":e.id},children:[BX.create("div",{props:{className:"bx-disk-folder-container"},children:[BX.create("table",{children:[BX.create("tr",{children:[BX.create("td",{props:{className:"bx-disk-wf-arrow"},events:{click:BX.delegate(function(e){var t=e.target||e.srcElement;var s=BX.findParent(t,{className:"bx-disk-parent"});if(BX.hasClass(s,"bx-disk-open")){BX.removeClass(s,"bx-disk-open");BX.addClass(s,"bx-disk-close");return}if(BX.hasClass(s,"bx-disk-loaded")){BX.removeClass(s,"bx-disk-close");BX.addClass(s,"bx-disk-open");return}this.loadSubFolders(s)},this)},children:[e.hasSubFolders?BX.create("span"):null]}),BX.create("td",{props:{className:"bx-disk-wf-folder-icon"},children:[BX.create("span")]}),BX.create("td",{props:{className:"bx-disk-wf-folder-name"},events:{click:BX.delegate(function(e){var t=e.target||e.srcElement;var s=BX.findParent(t,{className:"bx-disk-parent"});if(BX.hasClass(s,"selected")){BX.removeClass(s,"selected");BX.onCustomEvent(this.container,"onUnSelectFolder",[s]);return}BX.addClass(s,"selected");BX.onCustomEvent(this.container,"onSelectFolder",[s])},this)},children:[BX.create("span",{text:e.name})]})]})]})]})]});var s=BX.findChild(this.lastNode,{className:"bx-disk-folder-container"});if(!s){return this.lastNode}s.onbxdestdraghout=function(){BX.removeClass(this.parentNode,"selected")};s.onbxdestdragfinish=BX.delegate(function(e,t,s){if(!e.getAttribute("data-object-id")){return false}BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","moveTo"),data:{objectId:e.getAttribute("data-object-id"),targetObjectId:BX.proxy_context.parentNode.getAttribute("data-object-id")},onsuccess:function(e){BX.Disk.showModalWithStatusAction(e)}});return true},this);s.onbxdestdraghover=function(e,t,s){if(!e.getAttribute("data-object-id")){return false}if(BX.hasClass(this.parentNode,"selected")){return}BX.addClass(this.parentNode,"selected");if(BX.hasClass(this.parentNode,"bx-disk-open")){return}var i=BX.findChild(this,{className:"bx-disk-wf-arrow"},true);if(!i)return;BX.fireEvent(i,"click");return true};window.jsDD.registerDest(s);t&&i(this.lastNode);return this.lastNode};a.prototype.lazyLoadSubFolders=function(e){t=false;var i=BX.clone(s());var a=[];var r=this.buildTreeNode(this.rootObject);i.unshift(r);for(var o in i){if(!i.hasOwnProperty(o)){continue}var n=i[o].getAttribute("data-object-id");if(typeof n!=="undefined"&&n!="undefined"){a.push(n)}}if(!a.length){return}BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","showManySubFolders"),data:{objectIds:a},onsuccess:BX.delegate(function(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}var s=0;var i=null;var r=null;var o;var n;var d;while(a.length){d=a.shift();n=a.shift();if(n){a.unshift(n)}o=BX.create("ul",{props:{className:"bx-disk-wood-folder"}});r=i;if(t.items[d]&&t.items[d].length){for(var l in t.items[d]){if(!t.items[d].hasOwnProperty(l)){continue}var c=this.buildTreeNode(t.items[d][l]);if(t.items[d][l].id==n){i=c}o.appendChild(c)}}if(s==0){BX.cleanNode(this.container);BX.adjust(this.container,{children:[o]})}else if(r){r.appendChild(o);BX.removeClass(r,"bx-disk-close");BX.addClass(r,"bx-disk-open");BX.addClass(r,"bx-disk-loaded")}s++}e()},this)})};return a}();
//# sourceMappingURL=script.map.js