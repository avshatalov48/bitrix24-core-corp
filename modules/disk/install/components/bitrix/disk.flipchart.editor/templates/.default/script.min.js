this.BX=this.BX||{};this.BX.Disk=this.BX.Disk||{};(function(exports,ui_buttons,main_popup,disk_externalLink,disk_sharingLegacyPopup){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DashboardFlow=exports.AccessLevel=void 0;var AccessLevel;(function(e){e["private"]="private";e["readonly"]="readonly";e["editable"]="editable"})(AccessLevel||(exports.AccessLevel=AccessLevel={}));var DashboardFlow;(function(e){e["short"]="short"})(DashboardFlow||(exports.DashboardFlow=DashboardFlow={}));var InvalidTokenError=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(babelHelpers.wrapNativeSuper(Error));InvalidTokenError.prototype.name="InvalidTokenError";function b64DecodeUnicode(e){return decodeURIComponent(atob(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();if(n.length<2){n="0"+n}return"%"+n})))}function base64UrlDecode(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return b64DecodeUnicode(t)}catch(e){return atob(t)}}function jwtDecode(e,t){if(typeof e!=="string"){throw new InvalidTokenError("Invalid token specified: must be a string")}t||(t={});var n=t.header===true?0:1;var a=e.split(".")[n];if(typeof a!=="string"){throw new InvalidTokenError("Invalid token specified: missing part #".concat(n+1))}var i;try{i=base64UrlDecode(a)}catch(e){throw new InvalidTokenError("Invalid token specified: invalid base64 for part #".concat(n+1," (").concat(e.message,")"))}try{return JSON.parse(i)}catch(e){throw new InvalidTokenError("Invalid token specified: invalid json for part #".concat(n+1," (").concat(e.message,")"))}}Object.defineProperty(exports,"__esModule",{value:true});exports.WebSDK=void 0;var WebSDK=function(){function e(e){var t,n,a,i,r,o,s;this.params=e;var d;var l;var c={};var u={user_id:"",username:"",avatar_url:"",access_level:"read",can_edit_board:false,webhook_url:"",document_id:"",download_link:"",session_id:"",file_name:""};if(e.token){try{u=jwtDecode(e.token);d=u.access_level==="read"?exports.AccessLevel.readonly:exports.AccessLevel.editable;l=u.can_edit_board;c.documentId=u.document_id;c.fileUrl=u.download_link;c.sessionId=u.session_id;c.fileName=u.file_name}catch(e){console.error("invalid token")}}this.boardParams={appUrl:encodeURIComponent(e.appUrl),accessLevel:d,canEditBoard:l,token:e.token,lang:e.lang||"ru",partnerId:e.partnerId||"0",ui:{colorTheme:((t=e.ui)===null||t===void 0?void 0:t.colorTheme)||"flipOriginLight",openTemplatesModal:!!((n=e.ui)===null||n===void 0?void 0:n.openTemplatesModal),compactHeader:!!((a=e.ui)===null||a===void 0?void 0:a.compactHeader),showCloseButton:!!((i=e.ui)===null||i===void 0?void 0:i.showCloseButton),dashboardFlow:((r=e.ui)===null||r===void 0?void 0:r.dashboardFlow)||undefined,exportAsFile:((o=e.ui)===null||o===void 0?void 0:o.exportAsFile)!==false,spinner:(s=e.ui)===null||s===void 0?void 0:s.spinner},appContainerDomain:window.location.origin,boardData:c};this.iframeEl=document.createElement("iframe");this.iframeEl.allow="clipboard-read; clipboard-write";window.addEventListener("beforeunload",this.destroy.bind(this))}e.prototype.init=function(){var e=document.getElementById(this.params.containerId);if(!e){console.error('\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u0441 id "'.concat(this.params.containerId,'" \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d.'));return}this.iframeEl.src=this.createUrl();this.iframeEl.style.width="100%";this.iframeEl.style.height="100%";this.iframeEl.style.border="none";e.appendChild(this.iframeEl);this.addEventListener();window.FlipBoard=this.getBoardMethods()};e.prototype.getBoardMethods=function(){var t=this;return{tryToCloseBoard:function n(){return new Promise((function(n,a){var i;window.addEventListener("message",(function(t){var i,r;if(((i=t.data)===null||i===void 0?void 0:i.event)===e.SUCCESS_CLOSE_BOARD_EVENT_NAME){n()}if(((r=t.data)===null||r===void 0?void 0:r.event)===e.ERROR_CLOSE_BOARD_EVENT_NAME){a()}}));(i=t.iframeEl.contentWindow)===null||i===void 0?void 0:i.postMessage({event:e.TRY_TO_CLOSE_BOARD_EVENT_NAME},"*")}))},renameFlip:function n(a){return new Promise((function(n,i){var r;window.addEventListener("message",(function(t){var a,r;if(((a=t.data)===null||a===void 0?void 0:a.event)===e.SUCCESS_FLIP_RENAMED_EVENT_NAME){n()}if(((r=t.data)===null||r===void 0?void 0:r.event)===e.ERROR_FLIP_RENAMED_EVENT_NAME){i()}}));(r=t.iframeEl.contentWindow)===null||r===void 0?void 0:r.postMessage({event:e.RENAME_FLIP_EVENT,data:{name:a}},"*")}))}}};e.prototype.createUrl=function(){var e=new URL("".concat(this.params.appUrl).concat(this.boardParams.partnerId==="0"?"/sdkBoard":""));e.searchParams.set("fromSDK","true");if(this.boardParams.ui.openTemplatesModal)e.searchParams.set("openTemplates","true");if(this.boardParams.ui.spinner&&this.boardParams.ui.spinner!=="default")e.searchParams.set("spinner",this.boardParams.ui.spinner);return e.toString()};e.prototype.addEventListener=function(){window.addEventListener("message",this.listenBoardEvents.bind(this))};e.prototype.listenBoardEvents=function(t){var n,a,i,r,o,s,d,l,c,u;if(((n=t.data)===null||n===void 0?void 0:n.event)===e.WAIT_PARAMS_EVENT_NAME){(a=this.iframeEl.contentWindow)===null||a===void 0?void 0:a.postMessage({event:e.SET_PARAMS_EVENT_NAME,data:this.boardParams},"*")}if(((i=t.data)===null||i===void 0?void 0:i.event)===e.BOARD_CHANGED_EVENT_NAME){if((o=(r=this.params)===null||r===void 0?void 0:r.events)===null||o===void 0?void 0:o.onBoardChanged){this.params.events.onBoardChanged()}}if(((s=t.data)===null||s===void 0?void 0:s.event)===e.SUCCESS_FLIP_RENAMED_EVENT_NAME){if((l=(d=this.params)===null||d===void 0?void 0:d.events)===null||l===void 0?void 0:l.onFlipRenamed){this.params.events.onFlipRenamed(((u=(c=t.data)===null||c===void 0?void 0:c.data)===null||u===void 0?void 0:u.name)||"")}}};e.prototype.destroy=function(){window.removeEventListener("message",this.listenBoardEvents)};e.WAIT_PARAMS_EVENT_NAME="waitSDKParams";e.BOARD_CHANGED_EVENT_NAME="boardChanged";e.SET_PARAMS_EVENT_NAME="setSDKParams";e.TRY_TO_CLOSE_BOARD_EVENT_NAME="tryToCloseApp";e.SUCCESS_CLOSE_BOARD_EVENT_NAME="successCloseApp";e.ERROR_CLOSE_BOARD_EVENT_NAME="errorCloseApp";e.SUCCESS_FLIP_RENAMED_EVENT_NAME="successFlipRenamed";e.ERROR_FLIP_RENAMED_EVENT_NAME="errorFlipRenamed";e.RENAME_FLIP_EVENT="renameFlip";return e}();exports.WebSDK=WebSDK;var Board=function(){function Board(e){babelHelpers.classCallCheck(this,Board);babelHelpers.defineProperty(this,"setupSharingButton",null);babelHelpers.defineProperty(this,"data",null);this.setupSharingButton=ui_buttons.ButtonManager.createByUniqId(e.panelButtonUniqIds.setupSharing);this.data=e.boardData;this.bindEvents()}babelHelpers.createClass(Board,[{key:"bindEvents",value:function e(){if(this.setupSharingButton){var t=this.setupSharingButton.getMenuWindow();var n=t.getMenuItem("ext-link").options;n.onclick=this.handleClickSharingByExternalLink.bind(this);t.removeMenuItem("ext-link");t.addMenuItem(n);var a=t.getMenuItem("sharing").options;a.onclick=this.handleClickSharing.bind(this);t.removeMenuItem("sharing");t.addMenuItem(a)}}},{key:"handleClickSharingByExternalLink",value:function handleClickSharingByExternalLink(event,menuItem){this.setupSharingButton.getMenuWindow().close();if(menuItem.dataset.shouldBlockExternalLinkFeature){eval(menuItem.dataset.blockerExternalLinkFeature);return}disk_externalLink.ExternalLink.showPopup(this.data.id)}},{key:"handleClickSharing",value:function e(){this.setupSharingButton.getMenuWindow().close();(new disk_sharingLegacyPopup.LegacyPopup).showSharingDetailWithChangeRights({object:{id:this.data.id,name:this.data.name}})}}]);return Board}();var SDK=WebSDK;exports.Board=Board;exports.SDK=SDK})(this.BX.Disk.Flipchart=this.BX.Disk.Flipchart||{},BX.UI,BX.Main,BX.Disk,BX.Disk.Sharing);
//# sourceMappingURL=script.map.js