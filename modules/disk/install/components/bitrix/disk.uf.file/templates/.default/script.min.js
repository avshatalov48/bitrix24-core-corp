this.BX=this.BX||{};this.BX.Disk=this.BX.Disk||{};(function(e,t,i,s){"use strict";const o=new Map;var a=babelHelpers.classPrivateFieldLooseKey("container");var n=babelHelpers.classPrivateFieldLooseKey("eventObject");var l=babelHelpers.classPrivateFieldLooseKey("uploader");var r=babelHelpers.classPrivateFieldLooseKey("id");var d=babelHelpers.classPrivateFieldLooseKey("onProgressHandler");var c=babelHelpers.classPrivateFieldLooseKey("handleFileComplete");var u=babelHelpers.classPrivateFieldLooseKey("handleFileAdd");var p=babelHelpers.classPrivateFieldLooseKey("handleFileProgress");var h=babelHelpers.classPrivateFieldLooseKey("handleFileError");var f=babelHelpers.classPrivateFieldLooseKey("handleMyDriveClick");var b=babelHelpers.classPrivateFieldLooseKey("handleCloudDriveClick");var v=babelHelpers.classPrivateFieldLooseKey("createFileInfo");var m=babelHelpers.classPrivateFieldLooseKey("createFileResult");class g{constructor(e){Object.defineProperty(this,m,{value:I});Object.defineProperty(this,v,{value:y});Object.defineProperty(this,b,{value:w});Object.defineProperty(this,f,{value:k});Object.defineProperty(this,h,{value:L});Object.defineProperty(this,p,{value:P});Object.defineProperty(this,u,{value:F});Object.defineProperty(this,c,{value:D});Object.defineProperty(this,a,{writable:true,value:null});Object.defineProperty(this,n,{writable:true,value:null});Object.defineProperty(this,l,{writable:true,value:null});Object.defineProperty(this,r,{writable:true,value:`dialog-${t.Text.getRandom(5)}`});Object.defineProperty(this,d,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,a)[a]=e.container;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e.eventObject;let o=null;const g=babelHelpers.classPrivateFieldLooseBase(this,a)[a].querySelector(".diskuf-fileUploader");if(g){if(g.tagName.toLowerCase()==="input"){o=g.parentNode;g.disabled=true}else{o=g}}const _=babelHelpers.classPrivateFieldLooseBase(this,a)[a].querySelector(".diskuf-selector-link");if(_){t.Event.bind(_.parentNode,"click",babelHelpers.classPrivateFieldLooseBase(this,f)[f].bind(this))}const S=babelHelpers.classPrivateFieldLooseBase(this,a)[a].querySelector(".diskuf-selector-link-cloud");if(S){t.Event.bind(S.parentNode,"click",babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this))}const U={_onUploadProgress:null};s.EventEmitter.emit(babelHelpers.classPrivateFieldLooseBase(this,n)[n],"DiskDLoadFormControllerInit",new s.BaseEvent({compatData:[U]}));if(t.Type.isFunction(U._onUploadProgress)){babelHelpers.classPrivateFieldLooseBase(this,d)[d]=U._onUploadProgress}babelHelpers.classPrivateFieldLooseBase(this,l)[l]=new i.Uploader({id:e.id,controller:"disk.uf.integration.diskUploaderController",browseElement:o,multiple:true,maxFileSize:null,treatOversizeImageAsFile:true,ignoreUnknownImageTypes:true,hiddenFieldName:e.hiddenFieldName,hiddenFieldsContainer:babelHelpers.classPrivateFieldLooseBase(this,a)[a],events:{[i.UploaderEvent.FILE_ADD]:babelHelpers.classPrivateFieldLooseBase(this,u)[u].bind(this),[i.UploaderEvent.FILE_COMPLETE]:babelHelpers.classPrivateFieldLooseBase(this,c)[c].bind(this),[i.UploaderEvent.FILE_ERROR]:babelHelpers.classPrivateFieldLooseBase(this,h)[h].bind(this),[i.UploaderEvent.FILE_UPLOAD_PROGRESS]:babelHelpers.classPrivateFieldLooseBase(this,p)[p].bind(this)}})}getUploader(){return babelHelpers.classPrivateFieldLooseBase(this,l)[l]}}function D(e){const t=e.getData().file;s.EventEmitter.emit(babelHelpers.classPrivateFieldLooseBase(this,n)[n],"OnFileUploadSuccess",new s.BaseEvent({compatData:[babelHelpers.classPrivateFieldLooseBase(this,m)[m](t),this,t.getBinary(),babelHelpers.classPrivateFieldLooseBase(this,v)[v](t)]}))}function F(e){if(babelHelpers.classPrivateFieldLooseBase(this,d)[d]!==null){const t=e.getData().file;babelHelpers.classPrivateFieldLooseBase(this,d)[d](babelHelpers.classPrivateFieldLooseBase(this,v)[v](t),5)}}function P(e){if(babelHelpers.classPrivateFieldLooseBase(this,d)[d]!==null){const t=e.getData().file;const i=e.getData().progress;babelHelpers.classPrivateFieldLooseBase(this,d)[d](babelHelpers.classPrivateFieldLooseBase(this,v)[v](t),i)}}function L(e){const t=e.getData().file;console.log("UploadMenu Error:",t.getError());s.EventEmitter.emit(babelHelpers.classPrivateFieldLooseBase(this,n)[n],"OnFileUploadFailed",new s.BaseEvent({compatData:[this,t.getBinary(),babelHelpers.classPrivateFieldLooseBase(this,v)[v](t)]}))}function k(){t.Runtime.loadExtension("disk.uploader.user-field-widget").then((e=>{const{openDiskFileDialog:t}=e;t({dialogId:`file-${babelHelpers.classPrivateFieldLooseBase(this,r)[r]}`,uploader:babelHelpers.classPrivateFieldLooseBase(this,l)[l]})}))}function w(){t.Runtime.loadExtension("disk.uploader.user-field-widget").then((e=>{const{openCloudFileDialog:t}=e;t({dialogId:`cloud-${babelHelpers.classPrivateFieldLooseBase(this,r)[r]}`,uploader:babelHelpers.classPrivateFieldLooseBase(this,l)[l]})}))}function y(e){const t=e.getState();t.size=e.getSizeFormatted();t.sizeInt=e.getSize();t.ext=e.getExtension();t.nameWithoutExt=i.Helpers.getFilenameWithoutExtension(e.getName());return t}function I(e){return{element_id:e.getServerFileId(),element_name:e.getName(),element_url:e.getPreviewUrl(),storage:e.getCustomData("storage")||"disk"}}const _=e=>{const t=document.getElementById(`diskuf-selectdialog-${e["UID"]}`);if(!t){return null}if(o.has(e["UID"])){return o.get(e["UID"])}const i=new g({id:`disk-uf-file-${e["UID"]}`,container:t,eventObject:t.parentNode,hiddenFieldName:e.controlName});o.set(e["UID"],i);return i};e.add=_})(this.BX.Disk.UF=this.BX.Disk.UF||{},BX,BX.UI.Uploader,BX.Event);(function(e){if(e.BX.Disk&&e.BX.Disk.UFShowController)return;var t=e.BX;var i=0;var s={};var o=function(e){return t.Disk.ajaxPromise({url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","getBreadcrumbs"),method:"POST",dataType:"json",data:{attachedId:e}})};var a=function(e){if(!t(e)||e.hasAttribute("bx-is-bound"))return;e.setAttribute("bx-is-bound","Y");this.img=e;this.node=e.parentNode.parentNode.parentNode;t.unbindAll(e);t.unbindAll(this.node);t.show(this.node);t.remove(this.node.nextSibling);this.id="wufdp_"+Math.random()};a.prototype={turnOn:function(){this.timeout=setTimeout(t.delegate((function(){this.show()}),this),500)},turnOff:function(){clearTimeout(this.timeout);this.timeout=null;this.hide()},show:function(){if(this.popup!=null)this.popup.close();if(this.popup==null){var e={width:this.img.naturalWidth,height:this.img.naturalHeight};if(t["UploaderUtils"]){var i=t.UploaderUtils.scaleImage(e,{width:parseInt(t.message("DISK_THUMB_WIDTH")),height:parseInt(t.message("DISK_THUMB_HEIGHT"))});e=i.destin}this.popup=new t.PopupWindow("bx-wufd-preview-img-"+this.id,this.img.parentNode,{lightShadow:true,offsetTop:-7,offsetLeft:(51-28)/2+14,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:t.proxy((function(){this.popup=null}),this)},content:t.create("DIV",{props:e,children:[t.create("IMG",{props:e,attrs:{src:this.img.src}})]})});this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false},hide:function(){if(this.popup!=null)this.popup.close()}};t.addCustomEvent("onDiskPreviewIsReady",(function(e){new a(e)}));t.Disk.UF.runImport=function(e){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_PROCESS_LOADING"),showLoaderIcon:true,autoHide:false});t.Disk.ExternalLoader.reloadLoadAttachedObject({attachedObject:{id:e.id,name:e.name,service:e.service},onFinish:t.delegate((function(e){if(e.hasOwnProperty("hasNewVersion")&&!e.hasNewVersion){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_HAS_LAST_VERSION"),showSuccessIcon:true,autoHide:true})}else if(e.status==="success"){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_SUCCESS_LOADING"),showSuccessIcon:true,autoHide:true})}else{t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_FAIL_LOADING"),autoHide:true})}}),this),onProgress:t.delegate((function(e){}),this)}).start()};t.Disk.UF.disableAutoCommentToAttachedObject=function(e){var i=e.attachedId;t.Disk.ajax({method:"POST",dataType:"json",url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","disableAutoCommentToAttachedObject"),data:{attachedId:i},onsuccess:t.delegate((function(e){}),this)})};t.Disk.UF.enableAutoCommentToAttachedObject=function(e){var i=e.attachedId;t.Disk.ajax({method:"POST",dataType:"json",url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","enableAutoCommentToAttachedObject"),data:{attachedId:i},onsuccess:t.delegate((function(e){}),this)})};t.Disk.UF.showTransformationUpgradePopup=function(e){B24.licenseInfoPopup.show("disk_transformation_video_limit",t.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_TITLE"),t.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_CONTENT"),false)};t.Disk.UFShowController=function(e){if(!t.type.isPlainObject(e)){e={}}this.entityType=t.type.isNotEmptyString(e.entityType)?e.entityType:"";this.entityId=parseInt(e.entityId)>0?e.entityId:"";this.signedParameters=t.type.isNotEmptyString(e.signedParameters)?e.signedParameters:"";this.loader=null;this.container=t.type.isNotEmptyString(e.nodeId)?document.getElementById(e.nodeId):null;if(this.container){var i=this.container.querySelector(".disk-uf-file-switch-control");if(i){t.Event.bind(i,"click",t.Disk.UFShowController.onToggleView)}}if(t.type.isNotEmptyString(e.nodeId)){s[e.nodeId]=this}};t.Disk.UFShowController.getInstance=function(e){return t.type.isNotEmptyString(e)&&s[e]?s[e]:null};t.Disk.UFShowController.onToggleView=function(e){var i=e.currentTarget.closest(".diskuf-files-toggle-container"),s=e.currentTarget.getAttribute("data-bx-view-type");if(!t.type.isDomNode(i)||!t.type.isNotEmptyString(i.id)){return}var o=t.Disk.UFShowController.getInstance(i.id);if(o){o.toggleViewType({viewType:s})}e.preventDefault()};t.Disk.UFShowController.prototype.toggleViewType=function(e){this.showToggleViewLoader();t.ajax.runComponentAction("bitrix:disk.uf.file","toggleViewType",{mode:"class",signedParameters:this.signedParameters,data:{params:{viewType:e.viewType}}}).then(function(e){this.hideToggleViewLoader();t.clean(this.container);t.html(this.container,e.data.html)}.bind(this),(function(e){this.hideToggleViewLoader()}))};t.Disk.UFShowController.prototype.showToggleViewLoader=function(e){this.container.classList.add("diskuf-files-toggle-container-active");this.loader=new t.Loader({target:this.container});this.loader.show()};t.Disk.UFShowController.prototype.hideToggleViewLoader=function(e){this.container.classList.remove("diskuf-files-toggle-container-active");if(this.loader){this.loader.destroy()}};e.DiskOpenMenuCreateService=function(e){var i=[t.Disk.UF.getDocumentHandler("onlyoffice")?{text:t.Disk.UF.getDocumentHandler("onlyoffice").name,className:"bx-viewer-popup-item item-b24-docs",onclick:function(i,s){s.getMenuWindow().close();t.Disk.saveDocumentService("onlyoffice");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("onlyoffice").name})}}:null,t.Disk.Document.Local.Instance.isEnabled()?{text:t.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT"),className:"bx-viewer-popup-item item-b24",onclick:function(i,s){s.getMenuWindow().close();t.Disk.saveDocumentService("l");t.adjust(e,{text:t.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT")})}}:null,{text:t.Disk.UF.getDocumentHandler("gdrive").name,className:"bx-viewer-popup-item item-gdocs",onclick:function(i,s){s.getMenuWindow().close();t.Disk.saveDocumentService("gdrive");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("gdrive").name})}},{text:t.Disk.UF.getDocumentHandler("office365").name,className:"bx-viewer-popup-item item-office365",onclick:function(i,s){s.getMenuWindow().close();t.Disk.saveDocumentService("office365");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("office365").name})}},{text:t.Disk.UF.getDocumentHandler("onedrive").name,className:"bx-viewer-popup-item item-office",onclick:function(i,s){s.getMenuWindow().close();t.Disk.saveDocumentService("onedrive");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("onedrive").name})}}];t.PopupMenu.show("disk_open_menu_with_services",t(e),i,{offsetTop:0,offsetLeft:25,angle:{position:"top",offset:45},autoHide:true,zIndex:1e4,overlay:{opacity:.01},events:{}})};e.DiskOpenMenuImportService=function(e,i){var s=[];for(var o in i){if(!i.hasOwnProperty(o))continue;s.push({text:i[o].name,code:i[o].id,href:"#",onclick:function(e,i){var s=i.layout.item;t.addClass(s,"diskuf-selector-link-cloud");s.setAttribute("data-bx-doc-handler",i.code);t.onCustomEvent("onManualChooseCloudImport",[{target:s}]);t.removeClass(s,"diskuf-selector-link-cloud");s.removeAttribute("data-bx-doc-handler");t.PopupMenu.destroy("disk_open_menu_with_import_services");return t.PreventDefault(e)}})}var a=new t.CViewer({});a.openMenu("disk_open_menu_with_import_services",t(e),s,{offsetTop:0,offsetLeft:25});return t.PreventDefault()};e.DiskActionFileMenu=function(e,s,o){i++;t.PopupMenu.show("bx-viewer-wd-popup"+i+"_"+e,t(s),o,{angle:{position:"top",offset:25},autoHide:true});return false};e.WDInlineElementClickDispatcher=function(e,i){var s=t(i);if(s){t.fireEvent(s,"click")}return false}})(window);
//# sourceMappingURL=script.map.js