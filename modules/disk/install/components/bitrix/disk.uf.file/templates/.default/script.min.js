this.BX=this.BX||{};this.BX.Disk=this.BX.Disk||{};(function(e,t,i,n,a,r,o){"use strict";var s=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"set",value:function t(i){for(var n in i){if(e.hasOwnProperty(n)){e[n]=i[n]}}}},{key:"getDocumentHandlers",value:function t(){if(!e.documentHandlers){return[]}return e.documentHandlers}},{key:"getDocumentHandler",value:function t(i){if(!e.documentHandlers){return{}}var n=e.documentHandlers.find(function(e){return e.code===i});return n||{}}}]);return e}();babelHelpers.defineProperty(s,"urlUpload",null);babelHelpers.defineProperty(s,"documentHandlers",null);babelHelpers.defineProperty(s,"previewSize",{width:115,height:115});function l(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-file-thumb disk-file-thumb-file disk-file-thumb--',' disk-file-thumb--active">\n\t\t\t<div class="ui-icon ui-icon-file-',' disk-file-thumb-icon"><i></i></div>\n\t\t\t<div class="disk-file-thumb-text">','</div>\n\t\t\t<div class="disk-file-thumb-loader">\n\t\t\t\t','\n\t\t\t\t<div class="disk-file-thumb-loader-btn" onclick="','"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t']);l=function t(){return e};return e}var c=function(){function e(t,i){babelHelpers.classCallCheck(this,e);this.id=t;this.object=i;this.data={NAME:i.name};o.EventEmitter.subscribe(this.object,"onUploadProgress",this.onUploadProgress.bind(this));o.EventEmitter.subscribe(this.object,"onUploadDone",this.onUploadDone.bind(this));o.EventEmitter.subscribe(this.object,"onUploadError",this.onUploadError.bind(this));this.progress=new BX.UI.ProgressRound({width:18,colorTrack:"rgba(255,255,255,.3)",colorBar:"#fff",lineSize:3,statusType:BX.UI.ProgressRound.Status.INCIRCLE,textBefore:"<i></i>",textAfter:this.object.size})}babelHelpers.createClass(e,[{key:"getContainer",value:function e(){if(!this.container){var t=this.object.name.split(".").pop().toLowerCase();t=r.Text.encode(t===this.object.name?"":t);this.container=r.Tag.render(l(),t,t,this.object.name,this.progress.getContainer(),this.onClickDelete.bind(this))}return this.container}},{key:"onClickDelete",value:function e(t){var i=this;t.preventDefault();t.stopPropagation();o.EventEmitter.emit(this,"onDelete",[this]);setTimeout(function(){i.object.deleteFile()},400);delete this.container}},{key:"onUploadProgress",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,2),n=i[0],a=i[1];a=Math.min(Math.max(this.progress.getValue(),a),98);this.progress.update(a)}},{key:"onUploadDone",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,2),n=i[0],a=i[1].file;o.EventEmitter.emit(this,"onUploadDone",[a,n.file]);delete this.object.hash;this.object.deleteFile()}},{key:"onUploadError",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,1),n=i[0];o.EventEmitter.emit(this,"onUploadError",[n.file]);this.progress.setTextBefore(r.Loc.getMessage("WDUF_ITEM_ERROR"));this.container.classList.add("disk-file-upload-error");this.object.deleteFile()}}]);return e}();function u(e,t,i){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(i.get){return i.get.call(e)}return i.value}var d=new WeakMap;var h=function(){function e(t){var i=t.id,n=t.container,a=t.dropZone,r=t.input;babelHelpers.classCallCheck(this,e);d.set(this,{writable:true,value:0});this.container=n;this.agent=BX.Uploader.getInstance({id:i,allowUpload:"A",uploadFormData:"N",uploadMethod:"immediate",uploadFileUrl:s.urlUpload,showImage:false,sortItems:false,dropZone:a,input:r,pasteFileHashInForm:false});o.EventEmitter.subscribe(this.agent,"onFileIsCreated",this.catchFile.bind(this));o.EventEmitter.subscribe(this.agent,"onPackageIsInitialized",function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];var n={width:s.previewSize.width,height:s.previewSize.height,exact:"N"};if(i.data){i.data["previewParams"]=n}else{i.post.data["previewParams"]=n}})}babelHelpers.createClass(e,[{key:"catchFile",value:function t(i){var n=this;var a=babelHelpers.slicedToArray(i.compatData,2),r=a[0],s=a[1];this.incrementItemsCount();var l=new c(r,s);o.EventEmitter.subscribe(l,"onUploadDone",function(t){var i=babelHelpers.slicedToArray(t.data,2),a=i[0],r=i[1];if(!l[u(n.constructor,e,p)]){n.decrementItemsCount();o.EventEmitter.emit(n,"onUploadDone",{itemData:n.convertToItemSavedType(a),itemContainer:l.getContainer(),blob:r})}});o.EventEmitter.subscribe(l,"onUploadError",function(t){var i=babelHelpers.slicedToArray(t.data,1),a=i[0];n.decrementItemsCount();l[u(n.constructor,e,p)]=true;o.EventEmitter.emit(n,"onUploadError",{itemContainer:l.getContainer(),blob:a})});o.EventEmitter.subscribe(l,"onDelete",function(){n.decrementItemsCount();l[u(n.constructor,e,p)]=true;n.container.removeChild(l.getContainer())});this.container.appendChild(l.getContainer())}},{key:"addTestThumb",value:function e(t){var i=this;var n=new c(Math.ceil(Math.random()*1e3),{name:"test.file.js",size:"348 Kb",deleteFile:function e(){}});this.container.appendChild(n.getContainer());if(t>0){n.onUploadProgress({compatData:[null,t]})}o.EventEmitter.subscribe(n,"onDelete",function(){i.container.removeChild(n.getContainer())})}},{key:"addTestErrorThumb",value:function e(){var t=this;var i=new c(Math.ceil(Math.random()*1e3),{name:"test.file.js",size:"348 Kb",deleteFile:function e(){}});this.container.appendChild(i.getContainer());i.onUploadError({compatData:[{file:null}]});o.EventEmitter.subscribe(i,"onDelete",function(){t.container.removeChild(i.getContainer())})}},{key:"upload",value:function e(t){var i=babelHelpers.toArray(t),n=i.slice(0);this.agent.onAttach(n)}},{key:"convertToItemSavedType",value:function e(t){return{ID:t.attachId,IS_LOCKED:false,IS_MARK_DELETED:false,EDITABLE:false,FROM_EXTERNAL_SYSTEM:false,CAN_RESTORE:false,CAN_UPDATE:t.canChangeName,CAN_RENAME:t.canChangeName,CAN_MOVE:t.canChangeName,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:null,PREVIEW_URL:t.previewUrl?t.previewUrl:"",BIG_PREVIEW_URL:t.previewUrl?t.previewUrl.replace(/\&(width|height)=\d+/gi,""):null,EXTENSION:t.ext,NAME:t.name,SIZE:t.size,SIZE_BYTES:t.sizeInt,STORAGE:t.storage}}},{key:"incrementItemsCount",value:function e(){var t;if(babelHelpers.classPrivateFieldGet(this,d)<=0){o.EventEmitter.emit(this,"onUploadIsStart")}babelHelpers.classPrivateFieldSet(this,d,(t=+babelHelpers.classPrivateFieldGet(this,d))+1),t}},{key:"decrementItemsCount",value:function e(){var t;if(babelHelpers.classPrivateFieldGet(this,d)===1){o.EventEmitter.emit(this,"onUploadIsDone")}babelHelpers.classPrivateFieldSet(this,d,Math.max((babelHelpers.classPrivateFieldSet(this,d,(t=+babelHelpers.classPrivateFieldGet(this,d))-1),t),0))}}]);return e}();var p={writable:true,value:Symbol("deleted")};var b=function(){function e(t){var i=t.container,n=t.eventObject;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"hasContainer",false);babelHelpers.defineProperty(this,"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(this,"properties",{pluggedIn:false});this.container=i;this.eventObject=n;this.properties.pluggedIn=this.eventObject&&this.eventObject.dataset.bxHtmlEditable==="Y";if(!this.container){return}this.hasContainer=true}babelHelpers.createClass(e,[{key:"isRelevant",value:function e(){return this.hasContainer}},{key:"getEventObject",value:function e(){return this.eventObject}},{key:"getContainer",value:function e(){return this.container}},{key:"isPluggedIn",value:function e(){return this.properties.pluggedIn}},{key:"show",value:function e(){this.container.style.display="";delete this.container.style.display}},{key:"hide",value:function e(){this.container.style.display="none"}}]);return e}();function f(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-file-thumb disk-file-thumb-file" onclick="','">\n\t\t\t<div class="ui-icon ui-icon-more disk-file-thumb-icon">\n\t\t\t\t<i></i>\n\t\t\t</div>\n\t\t\t<div class="disk-file-thumb-text">',"</div>\n\t\t</div>"]);f=function t(){return e};return e}var m=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"hiddenFilesCount",0);babelHelpers.defineProperty(this,"stepNumber",0);babelHelpers.defineProperty(this,"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(this,"stepValue",5)}babelHelpers.createClass(e,[{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){return r.Tag.render(f(),t.onClick.bind(t),t.getValueContainer())})}},{key:"getValueContainer",value:function e(){return this.cache.remember("valueContainer",function(){return document.createElement("DIV")})}},{key:"reset",value:function e(){this.hiddenFilesCount=1;this.stepNumber=0;this.getValueContainer().innerHTML=this.hiddenFilesCount;this.show();return this}},{key:"increment",value:function e(){this.hiddenFilesCount++;this.getValueContainer().innerHTML=this.hiddenFilesCount;this.show()}},{key:"decrement",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;this.hiddenFilesCount-=t;this.getValueContainer().innerHTML=this.hiddenFilesCount;if(this.hiddenFilesCount<=0){this.hide()}}},{key:"onClick",value:function e(){this.stepNumber++;var t=Math.min(30,this.stepValue*this.stepNumber);this.decrement(t);o.EventEmitter.emit(this,"onGetMore",{itemsCount:t})}},{key:"show",value:function e(){delete this.getContainer().style.display}},{key:"hide",value:function e(){this.getContainer().style.display="none"}}]);return e}();var v=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getSelectedFile",value:function e(t,i,n){var a=this;return new Promise(function(e){r.ajax.get(r.Uri.addParam(a.urlSelect,{ACTION:"none",MULTI:"Y",ID:["E",t].join(""),NAME:i,wish:"fakemove",dialogName:n}),e)})}},{key:"loadFolder",value:function e(t,i,n){var a=t;var o=r.Uri.addParam([BX.DiskFileDialog.obCurrentTab[n].link.replace("/index.php","").replace("/files/lib/","/files/"),"element/upload",a].join("/"),{use_light_view:"Y",AJAX_CALL:"Y",SIMPLE_UPLOAD:"Y",IFRAME:"Y",sessid:BX.bitrix_sessid(),SECTION_ID:a,CHECK_NAME:i});return new Promise(function(e){r.ajax.loadJSON(o,{},e)})}},{key:"getSelectedData",value:function e(t){var i=this;return new Promise(function(e){r.ajax.get(r.Uri.addParam(i.urlSelect,{dialogName:t}),e)})}},{key:"getSelectedCloudData",value:function e(t,i){var n=this;return new Promise(function(e){r.ajax.get(r.Uri.addParam(n.urlSelect,{cloudImport:1,service:i,dialogName:t}),e)})}},{key:"moveFile",value:function e(t,i){return new Promise(function(e){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","moveUploadedFile"),data:{attachedId:t,targetFolderId:i},onsuccess:e})})}},{key:"getMetaDataForCreatedFileInUf",value:function e(t){return r.ajax.runAction("disk.api.file.getMetaDataForCreatedFileInUf",{data:{id:t}})}},{key:"renameAction",value:function e(t,i){return new Promise(function(e){r.ajax.post("/bitrix/tools/disk/uf.php?action=renameFile",{newName:i,attachedId:t,sessid:r.Loc.getMessage("bitrix_sessid")},e)})}},{key:"deleteAction",value:function e(t){return new Promise(function(e){r.ajax.post("/bitrix/tools/disk/uf.php?action=deleteFile",{attachedId:t,sessid:r.Loc.getMessage("bitrix_sessid")},e)})}}]);return e}();babelHelpers.defineProperty(v,"urlSelect","/bitrix/tools/disk/uf.php?action=selectFile&SITE_ID="+r.Loc.getMessage("SITE_ID")+"&dialog2=Y&ACTION=SELECT&MULTI=Y");function g(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-file-thumb disk-file-thumb-file disk-file-thumb--','" onclick="','">\n\t\t\t<div data-bx-role="icon" class="ui-icon ui-icon-file-',' disk-file-thumb-icon"><i></i></div>\n\t\t\t<div data-bx-role="name" class="disk-file-thumb-text">','</div>\n\t\t\t<div class="disk-file-thumb-btn-box">\n\t\t\t\t<div class="disk-file-thumb-btn-close" onclick="','"></div>\n\t\t\t\t<div class="disk-file-thumb-btn-more" data-bx-role="more" onclick="','"></div>\n\t\t\t</div>\n\t\t</div>']);g=function t(){return e};return e}var E=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"properties",{pluggedIn:false});i.setEventNamespace("Disk:UF:");i.id=String(e["ID"]);i.setData(e);i.subscribe("onMoved",i.onMoved.bind(babelHelpers.assertThisInitialized(i)));return i}babelHelpers.createClass(t,[{key:"getId",value:function e(){return this.id}},{key:"getFileId",value:function e(){return this.data.FILE_ID}},{key:"getData",value:function e(t){if(t){return this.data[t]}return this.data}},{key:"getAllIds",value:function e(){return[this.getId(),["n",this.data.FILE_ID].join("")]}},{key:"setData",value:function e(t){this.data=t}},{key:"setPluggedIn",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.properties.pluggedIn=t===true}},{key:"isPluggedIn",value:function e(){return this.properties.pluggedIn}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){var e=r.Text.encode(t.data["NAME"]);var i=r.Text.encode(t.data["EXTENSION"]).toLowerCase();switch(i){case"pptx":i="ppt";break}return r.Tag.render(g(),i,t.onClick.bind(t),i,e,t.onClickDelete.bind(t),t.onClickMore.bind(t))})}},{key:"rename",value:function e(t){this.data["NAME"]=t;if(this.hasContainer()){this.getContainer().querySelector('[data-bx-role="name"]').innerHTML=r.Text.encode(this.data["NAME"])}}},{key:"destroy",value:function e(){var t=this;var i=this.cache.keys();i.forEach(function(e){var i=t.cache.get(e);if(r.Type.isDomNode(i)&&i.parentNode){i.parentNode.removeChild(i)}t.cache.delete(e)});this.emit("onDestroy")}},{key:"hasContainer",value:function e(){return this.cache.has("container")}},{key:"getMenu",value:function e(){var t=this;var n=this.getData("NAME").split(".").pop();n=n===this.getData("NAME")?"":[".",n].join("");var a=String(this.getData("NAME"));var o=a.substring(0,a.length-n.length);return this.cache.remember("menu",function(){var e=t.getContainer().querySelector("div[data-bx-role='more']");var a=new i.Menu({id:"crm-tunnels-menu-".concat(r.Text.getRandom().toLowerCase()),bindElement:e,items:[t.isPluggedIn()?{dataset:{bxRole:"insertIntoTheText"},text:r.Loc.getMessage("WDUF_ITEM_MENU_INSERT_INTO_THE_TEXT"),onclick:function e(i,n){a.close();t.onClick(i)}}:null,{dataset:{bxRole:"deleteFile"},text:r.Loc.getMessage("WDUF_ITEM_MENU_DELETE"),onclick:function e(i){a.close();t.onClickDelete(i)}},t.data["CAN_RENAME"]===true?{dataset:{bxRole:"renameFile"},text:r.Loc.getMessage("WDUF_ITEM_MENU_RENAME"),items:[{html:['<textarea class="disk-file-popup-rename-file-textarea"\n\t\t\t\t\t\t\t\t\t\t\tname="rename" onkeydown="if(event.keyCode===13){ BX.fireEvent(event.target.parentNode.querySelector(\'input[name=save]\'), \'click\'); }"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder="'.concat(r.Text.encode(o),'">').concat(r.Text.encode(o),"</textarea>"),'<div class="ui-btn-container ui-btn-container-center">\n\t\t\t\t\t\t\t\t\t\t\t<input type="button" class="ui-btn ui-btn-sm ui-btn-primary" name="save" value="'.concat(r.Loc.getMessage("WDUF_ITEM_MENU_RENAME_SAVE"),'">\n\t\t\t\t\t\t\t\t\t\t\t<input type="button" class="ui-btn ui-btn-sm ui-btn-link" value="').concat(r.Loc.getMessage("WDUF_ITEM_MENU_RENAME_CANCEL"),'">\n\t\t\t\t\t\t\t\t\t\t</div>')].join(""),className:"menu-popup-item-rename-form",onclick:function e(i,o){if(r.Type.isDomNode(i.target)&&i.target.type==="button"){if(i.target.name==="save"){t.onRenamed([o.getContainer().querySelector("textarea").value,n].join(""));t.clearMenu()}a.close()}}}]}:null,{delimiter:true,text:[r.Loc.getMessage("WDUF_ITEM_MENU_FILE"),r.Text.encode(t.data["SIZE"])].join(" ")},t.data["CAN_MOVE"]===true?{dataset:{bxRole:"moveFile"},text:r.Text.encode(t.data["STORAGE"]),className:"menu-popup-item-storage",onclick:function e(i,n){var r;i["counter"]=((r=i["counter"])!==null&&r!==void 0?r:1)+1;a.close();t.onClickMoveTo(i,n)}}:{text:r.Text.encode(t.data["STORAGE"]),className:"menu-popup-item-storage"}].filter(function(e){return e!==null}),angle:true,offsetLeft:9});return a})}},{key:"clearMenu",value:function e(){if(this.cache.has("menu")){this.cache.get("menu").destroy();this.cache.delete("menu")}}},{key:"onClick",value:function e(t){this.emit("onClick")}},{key:"onClickDelete",value:function e(t){t.preventDefault();t.stopPropagation();this.emit("onDelete");this.destroy();v.deleteAction(this.getId())}},{key:"onClickMore",value:function e(t){t.preventDefault();t.stopPropagation();this.getMenu().show()}},{key:"onClickEdit",value:function e(){}},{key:"onClickMoveTo",value:function e(t,i,n){var a=o.EventEmitter.emit(BX.DiskFileDialog,"onFileNeedsToMove",[this]);return a.length>0}},{key:"onMoved",value:function e(t){var i=t.data;this.data["STORAGE"]=i;this.clearMenu()}},{key:"onRenamed",value:function e(t){if(this.getData("NAME")===t){return}this.rename(t);v.renameAction(this.getId(),t)}},{key:"getHTMLForHTMLEditor",value:function e(t){return'<span contenteditable="false" data-bx-file-id="'.concat(this.data.ID,'" id="').concat(t,'" style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;">').concat(r.Text.encode(this.data.NAME),"</span>")}}],[{key:"detect",value:function e(){return true}}]);return t}(o.EventEmitter);function D(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-file-thumb disk-file-thumb-preview" onclick="','">\n\t\t\t<div style="background-image: url(\'','\'); background-size: cover;" class="disk-file-thumb-image"></div>\n\t\t\t<div data-bx-role="icon" class="ui-icon ui-icon-file-',' disk-file-thumb-icon"><i></i></div>\n\t\t\t<div data-bx-role="name" class="disk-file-thumb-text">','</div>\n\t\t\t<div class="disk-file-thumb-btn-box">\n\t\t\t\t<div class="disk-file-thumb-btn-close" onclick="','"></div>\n\t\t\t\t<div class="disk-file-thumb-btn-more" data-bx-role="more" onclick="','"></div>\n\t\t\t</div>\n\t\t</div>']);D=function t(){return e};return e}var k=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++){a[o]=arguments[o]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"cache",new r.Cache.MemoryCache);return i}babelHelpers.createClass(t,[{key:"setData",value:function e(t){this.data=t;this.data.BIG_REVIEW_URL=this.data.PREVIEW_URL.replace(/\&(width|height)\=\d+/gi,"")}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){var e=r.Text.encode(t.data["NAME"]);var i=r.Text.encode(t.data["EXTENSION"]).toLowerCase();return r.Tag.render(D(),t.onClick.bind(t),t.data["PREVIEW_URL"],i,e,t.onClickDelete.bind(t),t.onClickMore.bind(t))})}},{key:"getHTMLForHTMLEditor",value:function e(t){return'<img style="max-width: 90%;" data-bx-file-id="'.concat(this.data.ID,'" id="').concat(t,'" src="').concat(this.data.BIG_REVIEW_URL,'" />')}}],[{key:"detect",value:function e(t){return!!t["PREVIEW_URL"]}}]);return t}(E);var I=0;var C=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"tag","[DISK FILE ID=#id#]");babelHelpers.defineProperty(this,"regexp",/\[(?:DOCUMENT ID|DISK FILE ID)=([n0-9]+)\]/gi);this.id=["diskfile"+I++].join("_");this.items=t.items}babelHelpers.createClass(e,[{key:"getInterface",value:function e(){var t=this;return{id:this.id,init:function e(i){t.htmlEditor=i},parse:this.parse.bind(this),unparse:this.unparse.bind(this)}}},{key:"hasInterface",value:function e(){return this.regexp!==null&&this.tag!==null}},{key:"setParams",value:function e(t){var i=t.tag,n=t.regexp;if(r.Type.isStringFilled(i)&&i!=="null"){this.tag=i}else{this.tag=null}if(r.Type.isStringFilled(n)&&n!=="null"){this.regexp=new RegExp(n)}else if(n instanceof RegExp){this.regexp=n}else{this.regexp=null}}},{key:"insertFile",value:function e(t){var i=this.items.get(String(t));if(i){var n=i instanceof k?"\n":" ";var a=i instanceof k?"<br>":"&nbsp;";o.EventEmitter.emit(this.htmlEditor,"OnInsertContent",[n+this.getItemBBCode(t)+n,a+this.getItemHTML(t)+a])}}},{key:"getItemBBCode",value:function e(t){return this.tag.replace("#id#",t)}},{key:"getItemHTML",value:function e(t){var i=this.items.get(String(t));if(i){return i.getHTMLForHTMLEditor(this.htmlEditor.SetBxTag(false,{tag:this.id,fileId:t,itemId:i.getId()}))}return null}},{key:"deleteFile",value:function e(t){if(!this.items.has(t)){return}var i=this.items.get(t).getAllIds();if(this.htmlEditor.GetViewMode()==="wysiwyg"){var n=this.htmlEditor.GetIframeDoc();for(var a in this.htmlEditor.bxTags){if(this.htmlEditor.bxTags.hasOwnProperty(a)&&babelHelpers.typeof(this.htmlEditor.bxTags[a])==="object"&&this.htmlEditor.bxTags[a]["tag"]===this.id&&i.indexOf(String(this.htmlEditor.bxTags[a]["itemId"]))>=0&&n.getElementById(a)){var r=n.getElementById(a);r.parentNode.removeChild(r)}}this.htmlEditor.SaveContent()}else{var o=this.htmlEditor.GetContent().replace(this.regexp,function(e,t){return i.indexOf(t)>=0?"":e});this.htmlEditor.SetContent(o);this.htmlEditor.Focus()}}},{key:"parse",value:function e(t){if(!this.regexp.test(t)){return t}t=t.replace(this.regexp,function(e,t){var i=this.items.has(t)?this.items.get(t):babelHelpers.toConsumableArray(this.items.values()).find(function(e){return e.getAllIds().indexOf(t)>=0});if(i){return i.getHTMLForHTMLEditor(this.htmlEditor.SetBxTag(false,{tag:this.id,fileId:t,itemId:i.getId()}))}return e}.bind(this));return t}},{key:"unparse",value:function e(t,i){var n=i.node;var a=t.itemId;if(this.items.has(a)){return this.getItemBBCode(a)}return""}}]);return e}();var y=[E,k];function T(e){var t=E;y.forEach(function(i){if(i.detect(e)){t=i}});return new t(e)}var S=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.id,a=e.container,r=e.fieldName,o=e.multiple,s=e.eventObject;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:a.querySelector('[data-bx-role="placeholder"]'),eventObject:s}));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"maxVisibleCount",10);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"prefixHTMLNode","disk-attach-");i.items=new Map;i.multiple=o!==false;i.fieldName=r;if(!a.querySelector('[data-bx-role="placeholder"]')){return babelHelpers.possibleConstructorReturn(i)}if(i.isPluggedIn()){i.buildInHTMLEditor()}return i}babelHelpers.createClass(t,[{key:"buildInHTMLEditor",value:function e(){var t=this;if(this.getParser().hasInterface()){o.EventEmitter.emit(this.eventObject,"OnParserRegister",this.getParser().getInterface())}o.EventEmitter.subscribe(this.eventObject,"onReinitializeBefore",function(e){var i=babelHelpers.slicedToArray(e.data,2),n=i[0],a=i[1];var o=true;if(a){Object.values(a).forEach(function(e){if(e&&e["USER_TYPE_ID"]==="disk_file"&&e["FIELD_NAME"].replace("[]","")===t.fieldName.replace("[]","")){try{var i=[];if(r.Type.isArray(e["VALUE"])){e["VALUE"].forEach(function(e){var n=document.querySelector(["#",t.prefixHTMLNode,e].join(""));if(!n){return}var a=n.querySelector("img");var o=a||n;var s=o.hasAttribute("data-title")?o.getAttribute("data-title"):o.hasAttribute("data-bx-title")?o.getAttribute("data-bx-title"):"";var l={ID:e,FILE_ID:o.getAttribute("bx-attach-file-id"),CAN_RESTORE:false,CAN_UPDATE:false,CAN_RENAME:false,CAN_MOVE:false,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:null,PREVIEW_URL:null,BIG_PREVIEW_URL:null,EXTENSION:s.split(".").pop(),NAME:s,SIZE:o.getAttribute("data-bx-size"),SIZE_BYTES:o.getAttribute("data-bx-size"),STORAGE:"disk"};if(a){l["PREVIEW_URL"]=a.hasAttribute("data-bx-preview")&&r.Type.isStringFilled(a.hasAttribute("data-bx-preview"))?a.getAttribute("data-bx-preview"):a.hasAttribute("data-thumb-src")&&r.Type.isStringFilled(a.getAttribute("data-thumb-src"))?a.getAttribute("data-thumb-src"):a.src;l["BIG_PREVIEW_URL"]=a.hasAttribute("data-bx-src")?a.getAttribute("data-bx-src"):a.getAttribute("data-src")}i.push(l)})}t.set(i);o=false}catch(e){console.log("e: ",e)}}})}if(o!==false){t.clear()}})}},{key:"set",value:function e(t){var i=this;this.clear();var n=this.maxVisibleCount;return new Promise(function(e){t.forEach(function(e){var t=i.addItem(e);n--;if(n>0){i.appendNode(t)}else if(n===0){i.container.appendChild(i.getItemMore().reset().getContainer())}else{i.getItemMore().increment()}});e()})}},{key:"clear",value:function e(){this.items.forEach(function(e){e.destroy()});this.container.innerHTML=""}},{key:"add",value:function e(t,i){this.multiple||this.clear();var n=this.addItem(t);this.appendNode(n,i);return n}},{key:"addItem",value:function e(t){var i=this;var n=T(t);var a=this.getContainer().querySelector('[data-bx-role="reserve-item"][value="'.concat(n.getId(),'"]'));if(!a){a=document.createElement("INPUT");a.name=this.fieldName;a.type="hidden";a.value=n.getId();this.container.appendChild(a)}n.subscribe("onDelete",function(){if(a&&a.parentNode){a.parentNode.removeChild(a)}o.EventEmitter.emit(i,"OnItemDelete",n)});if(this.isPluggedIn()){o.EventEmitter.emit(this.eventObject,"onShowControllers:File:Increment");if(this.getParser().hasInterface()){n.setPluggedIn();n.subscribe("onClick",function(){i.getParser().insertFile(n.getId())});n.subscribe("onDelete",function(){i.getParser().deleteFile(n.getId())});n.subscribe("onDestroy",function(){o.EventEmitter.emit(i.eventObject,"onShowControllers:File:Decrement")})}}this.items.set(n.getId(),n);return n}},{key:"getItem",value:function e(t){return this.items.get(t)}},{key:"appendNode",value:function e(t,i){if(i){if(i.parentNode){i.parentNode.replaceChild(t.getContainer(),i)}}else{this.container.appendChild(t.getContainer())}return t}},{key:"getItemMore",value:function e(){var t=this;return this.cache.remember("moreButton",function(){var e=new m;o.EventEmitter.subscribe(e,"onGetMore",t.showMoreItems.bind(t));return e})}},{key:"showMoreItems",value:function e(t){var i=t.data.itemsCount;var n=i;var a=this.getItemMore().getContainer();a.style.opacity="0";a.style.visibility="hidden";this.items.forEach(function(e){if(i>0){if(!e.hasContainer()){i--;var t=document.createElement("DIV");a.parentNode.insertBefore(t,a);setTimeout(function(){r.Dom.style(e.getContainer(),"opacity","0");r.Dom.addClass(e.getContainer(),"disk-file-thumb--animate");r.Dom.style(e.getContainer(),"opacity","");t.parentNode.replaceChild(e.getContainer(),t);e.getContainer().addEventListener("transitionend",function(){r.Dom.removeClass(e.getContainer(),"disk-file-thumb--animate")})},(n-i)*100)}}});if(i<=0){setTimeout(function(){a.style.opacity="";a.style.visibility=""},n*100+100)}}},{key:"getParser",value:function e(){this.parser=this.parser||new C(this);return this.parser}}]);return t}(b);var _=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.container,a=e.eventObject;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:n.querySelector('[data-bx-role="setting"]'),eventObject:a}));if(i.getContainer()){i.getContainer().addEventListener("click",i.show.bind(babelHelpers.assertThisInitialized(i)));i.allowEditNode=n.querySelector('input[data-bx-role="settings-allow-edit"]');i.allowGridNode=n.querySelector('input[data-bx-role="settings-allow-grid"]')}return i}babelHelpers.createClass(t,[{key:"show",value:function e(){var t=this;if(!this.popup){this.popup=new i.Menu({bindElement:this.getContainer(),className:"disk-uf-file-popup-settings",items:[this.allowEditNode?{dataset:{bxRole:"allowEdit"},className:this.allowEditNode.checked?"menu-popup-item-take":"",text:r.Loc.getMessage("WDUF_ALLOW_EDIT"),onclick:function(e,t){this.allowEditNode.checked=!this.allowEditNode.checked;if(this.allowEditNode.checked){t.getContainer().classList.add("menu-popup-item-take");t.getContainer().classList.remove("menu-popup-no-icon")}else{t.getContainer().classList.remove("menu-popup-item-take");t.getContainer().classList.add("menu-popup-no-icon")}}.bind(this)}:null,{dataset:{bxRole:"allowGrid"},className:this.allowGridNode.checked?"menu-popup-item-take":"",text:r.Loc.getMessage("WDUF_ALLOW_COLLAGE"),onclick:function(e,t){this.allowGridNode.checked=!this.allowGridNode.checked;if(this.allowGridNode.dataset.bxSave==="Y"){BX.userOptions.save("disk","disk.uf.file",this.allowGridNode.dataset.bxName,this.allowGridNode.checked?"grid":".default")}if(this.allowGridNode.checked){t.getContainer().classList.add("menu-popup-item-take");t.getContainer().classList.remove("menu-popup-no-icon")}else{t.getContainer().classList.remove("menu-popup-item-take");t.getContainer().classList.add("menu-popup-no-icon")}}.bind(this)},{text:this.buildDocumentServiceTextLabel(),items:this.buildSubMenuWithDocumentServices()}],angle:true,offsetTop:-16,offsetLeft:16,events:{onClose:function e(){delete t.popup}}})}this.popup.show()}},{key:"buildDocumentServiceTextLabel",value:function e(){var t=BX.Disk.getDocumentService();if(!t&&BX.Disk.isAvailableOnlyOffice()){t="onlyoffice"}else if(!t){t="l"}var i=s.getDocumentHandler(t).name;return r.Loc.getMessage("DISK_UF_FILE_EDIT_SERVICE_LABEL",{"#NAME#":i})}},{key:"buildSubMenuWithDocumentServices",value:function e(){var t=this;var i=[];s.getDocumentHandlers().forEach(function(e){i.push({text:e.name,dataset:{code:e.code},onclick:function e(i,n){BX.Disk.saveDocumentService(n.dataset.code);n.getMenuWindow().getParentMenuItem().setText(t.buildDocumentServiceTextLabel());n.getMenuWindow().getPopupWindow().close()}})});return i}},{key:"hide",value:function e(){if(this.popup){this.popup.close()}}}]);return t}(b);var F=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.container,a=e.eventObject;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:n.querySelector('[data-bx-role="document-area"]'),eventObject:a}));if(i.getContainer()){i.getContainer().querySelectorAll("[data-bx-handler]").forEach(function(e){e.addEventListener("click",function(){i.createDocument(e.getAttribute("data-bx-handler"))})})}return i}babelHelpers.createClass(t,[{key:"createDocument",value:function e(t){if(!BX.Disk.getDocumentService()&&BX.Disk.isAvailableOnlyOffice()){BX.Disk.saveDocumentService("onlyoffice")}else if(!BX.Disk.getDocumentService()){BX.Disk.saveDocumentService("l")}var i=function(e){var t=this;var i=e.object.name.split(".");i.pop();setTimeout(function(){o.EventEmitter.emit(t,"onFileIsCreated",{itemData:t.convertToItemSavedType(e)})},200)}.bind(this);if(BX.Disk.Document.Local.Instance.isSetWorkWithLocalBDisk()){BX.Disk.Document.Local.Instance.createFile({type:t}).then(function(e){i(e)}.bind(this));return}var n=new BX.Disk.Document.CreateProcess({typeFile:t,serviceCode:BX.Disk.getDocumentService(),onAfterSave:function e(t,n){if(t.status!=="success"){return}if(!n){v.getMetaDataForCreatedFileInUf(t.object.id).then(function(e){var t=e.data;i(t)})}else{i(n)}}});n.start()}},{key:"convertToItemSavedType",value:function e(t){return{ID:"n"+t.object.id,IS_LOCKED:false,IS_MARK_DELETED:false,EDITABLE:false,FROM_EXTERNAL_SYSTEM:false,CAN_RESTORE:false,CAN_UPDATE:true,CAN_RENAME:true,CAN_MOVE:true,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:t.link,PREVIEW_URL:null,BIG_PREVIEW_URL:null,EXTENSION:t.object.extension,NAME:t.object.name,SIZE:t.object.size,SIZE_BYTES:t.object.sizeInt,STORAGE:t.folderName}}}]);return t}(b);var w=function(e){babelHelpers.inherits(t,e);function t(e){var i=e.container,n=e.eventObject;babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:i.querySelector('[data-bx-role="control-panel"]'),eventObject:n}))}return t}(b);var U=0;var L=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.container,a=e.eventObject;babelHelpers.classCallCheck(this,t);var r=n.querySelector('[data-bx-role="file-local-controller"]')||n.querySelector(".diskuf-selector-link");i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:r,eventObject:a}));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"opened",false);i.dialogName=["selectFile",U++].join("-");if(!i.getContainer()){return babelHelpers.possibleConstructorReturn(i)}i.getContainer().addEventListener("click",i.onClick.bind(babelHelpers.assertThisInitialized(i)));i.openSection=i.openSection.bind(babelHelpers.assertThisInitialized(i));i.selectFile=i.selectFile.bind(babelHelpers.assertThisInitialized(i));o.EventEmitter.subscribe(BX.DiskFileDialog,"loadItems",i.openSection);return i}babelHelpers.createClass(t,[{key:"onClick",value:function e(){var t=this;v.getSelectedData(this.dialogName).then(function(){setTimeout(function(){BX.DiskFileDialog.obCallback[t.dialogName]={saveButton:t.selectFile};BX.DiskFileDialog.openDialog(t.dialogName)},10)})}},{key:"openSection",value:function e(t){var i=babelHelpers.slicedToArray(t.data,2),n=i[0],a=i[1];if(a===this.dialogName){BX.DiskFileDialog.target[a]=r.Uri.addParam(n,{dialog2:"Y"})}}},{key:"selectFile",value:function e(t,i,n){o.EventEmitter.unsubscribe(BX.DiskFileDialog,"loadItems",this.openSection);for(var a in n){if(n.hasOwnProperty(a)){o.EventEmitter.emit(this,"onUploadDone",{itemData:this.convertToItemSavedType(n[a])})}}}},{key:"convertToItemSavedType",value:function e(t){var i;return{ID:t.id,IS_LOCKED:false,IS_MARK_DELETED:false,EDITABLE:false,FROM_EXTERNAL_SYSTEM:false,CAN_RESTORE:false,CAN_RENAME:false,CAN_UPDATE:false,CAN_MOVE:false,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:null,PREVIEW_URL:t.previewUrl?t.previewUrl:"",BIG_PREVIEW_URL:t.previewUrl?t.previewUrl.replace(/\&(width|height)=\d+/gi,""):null,EXTENSION:t.ext,NAME:t.name,SIZE:t.size,SIZE_BYTES:t.sizeInt,STORAGE:(i=t["storage"])!==null&&i!==void 0?i:r.Loc.getMessage("WDUF_MY_DISK")}}}]);return t}(b);var N=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,i));BX.Disk.ExternalLoader.startLoad({file:{id:n.id,name:n.object.name,service:n.object.service},onFinish:function e(t){o.EventEmitter.emit(babelHelpers.assertThisInitialized(n),"onUploadDone",[t])},onProgress:function e(t){n.onUploadProgress({compatData:[{},t]})}});return n}babelHelpers.createClass(t,[{key:"onClickDelete",value:function e(t){t.preventDefault();t.stopPropagation();o.EventEmitter.emit(this,"onDelete",[this]);delete this.container}},{key:"onUploadDone",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,2),n=i[0],a=i[1].file}},{key:"onUploadError",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,1),n=i[0];o.EventEmitter.emit(this,"onUploadError",[n.file]);this.progress.getContainer().parentNode.removeChild(this.progress.getContainer());this.container.classList.add("disk-file-upload-error")}}]);return t}(c);var H=0;var A=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.container,a=e.eventObject;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:n.querySelector('[data-bx-role="placeholder"]'),eventObject:a}));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"services",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"items",new Map);if(!i.getContainer()){return babelHelpers.possibleConstructorReturn(i)}n.querySelectorAll('[data-bx-role="file-external-controller"]').forEach(function(e){i.services.push(e)});n.querySelectorAll(".diskuf-selector-link-cloud").forEach(function(e){i.services.push(e)});i.eventObject=a;i.dialogName=["selectFileCloud",H++].join("-");i.services.forEach(function(e){e.addEventListener("click",i.onClick.bind(babelHelpers.assertThisInitialized(i)))});i.openSection=i.openSection.bind(babelHelpers.assertThisInitialized(i));i.selectFile=i.selectFile.bind(babelHelpers.assertThisInitialized(i));return i}babelHelpers.createClass(t,[{key:"onClick",value:function e(t){var i=this;o.EventEmitter.subscribe(BX.DiskFileDialog,"loadItems",this.openSection);this.currentService=t.currentTarget.getAttribute("data-bx-doc-handler");v.getSelectedCloudData(this.dialogName,this.currentService).then(function(){setTimeout(function(){BX.DiskFileDialog.obCallback[i.dialogName]={saveButton:i.selectFile};BX.DiskFileDialog.openDialog(i.dialogName)},10)})}},{key:"openSection",value:function e(t){var i=babelHelpers.slicedToArray(t.data,2),n=i[0],a=i[1];if(a===this.dialogName){BX.DiskFileDialog.target[a]=r.Uri.addParam(n,{dialog2:"Y"})}}},{key:"selectFile",value:function e(t,i,n){o.EventEmitter.unsubscribe(BX.DiskFileDialog,"loadItems",this.openSection);for(var a in n){if(n.hasOwnProperty(a)&&n[a].type==="file"){this.catchFile(n[a],this.currentService)}}this.currentService=null}},{key:"catchFile",value:function e(t,i){var n=this;if(this.items.has(t.id)){return}t["service"]=t["provider"]||i;var a=new N(t.id,t);this.items.set(a.id,a);o.EventEmitter.subscribe(a,"onUploadDone",function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];if(n.items.has(a.id)){n.items.delete(a.id);o.EventEmitter.emit(n,"onUploadDone",{itemData:n.convertToItemSavedType(i),itemContainer:a.getContainer()})}});o.EventEmitter.subscribe(a,"onUploadError",function(){n.items.delete(a.id);o.EventEmitter.emit(n,"onUploadError",{itemContainer:a.getContainer()})});o.EventEmitter.subscribe(a,"onDelete",function(){n.items.delete(a.id);n.container.removeChild(a.getContainer())});this.container.appendChild(a.getContainer())}},{key:"convertToItemSavedType",value:function e(t){var i=t.name.split(".").pop().toLowerCase();var n={ID:t.ufId,IS_LOCKED:false,IS_MARK_DELETED:false,EDITABLE:false,FROM_EXTERNAL_SYSTEM:true,CAN_RESTORE:false,CAN_RENAME:false,CAN_UPDATE:false,CAN_MOVE:false,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:null,PREVIEW_URL:t.previewUrl?t.previewUrl:"",BIG_PREVIEW_URL:t.previewUrl?t.previewUrl.replace(/\&(width|height)=\d+/gi,""):null,EXTENSION:i===t.name?"":i,NAME:t.name,SIZE:t.sizeFormatted,SIZE_BYTES:t.size,STORAGE:t.storage};return n}}]);return t}(b);var O=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"dialogName","moveFile");this.openSection=this.openSection.bind(this);this.loadFolder=this.loadFolder.bind(this);this.stopLoadingFolder=this.stopLoadingFolder.bind(this);this.checkFileName=this.checkFileName.bind(this);this.onApply=this.onApply.bind(this);this.onCancel=this.onCancel.bind(this)}babelHelpers.createClass(e,[{key:"fire",value:function e(t){var i=this;if(this.item!==null&&this.item!==t){this.onCancel()}this.item=t;v.getSelectedFile(t.getFileId(),t.getData("NAME"),this.dialogName).then(function(){setTimeout(function(){BX.DiskFileDialog.obCallback[i.dialogName]={saveButton:i.onApply,cancelButton:i.onCancel};BX.DiskFileDialog.openDialog(i.dialogName)},10)});o.EventEmitter.subscribe(BX.DiskFileDialog,"loadItems",this.openSection);o.EventEmitter.subscribe(BX.DiskFileDialog,"selectItem",this.loadFolder);o.EventEmitter.subscribe(BX.DiskFileDialog,"unSelectItem",this.stopLoadingFolder)}},{key:"openSection",value:function e(t){var i=babelHelpers.slicedToArray(t.data,2),n=i[0],a=i[1];if(a===this.dialogName){BX.DiskFileDialog.target[a]=r.Uri.addParam(n,{dialog2:"Y"})}}},{key:"loadFolder",value:function e(t){var i=this;var n=babelHelpers.slicedToArray(t.data,3),a=n[0],o=n[1],s=n[2];if(s!==this.dialogName){return}v.loadFolder(o.substr(1),this.item.getData("NAME"),this.dialogName).then(function(e){var t=e.permission===true&&e["okmsg"]!=="";if(i.timeout>0){clearTimeout(i.timeout)}i.timeout=setTimeout(function(){if(t){BX.DiskFileDialog.showNotice(r.Loc.getMessage("WDUF_FILE_IS_EXISTS"),i.dialogName)}else{BX.DiskFileDialog.closeNotice(i.dialogName)}},200)})}},{key:"stopLoadingFolder",value:function e(t){var i=t.data;if(this.timeout>0){clearTimeout(this.timeout)}this.timeout=setTimeout(this.checkFileName,200)}},{key:"onApply",value:function e(t,i,n,a){var r=this;o.EventEmitter.unsubscribe(BX.DiskFileDialog,"loadItems",this.openSection);o.EventEmitter.unsubscribe(BX.DiskFileDialog,"selectItem",this.loadFolder);o.EventEmitter.unsubscribe(BX.DiskFileDialog,"unSelectItem",this.stopLoadingFolder);if(!this.item){return}var s=this.item.getId();var l=false;var c=function e(t,i,n,a){v.moveFile(t,i).then(function(e){if(!e||e.status!=="success"){BX.Disk.showModalWithStatusAction(e);return}r.showMovedFile(t,n,a)})};var u,d;for(var h in n){if(n.hasOwnProperty(h)&&n[h].type==="folder"){u=t.name+n[h].path;d={sectionID:h,iblockID:t.iblock_id};c(s,n[h].id,d,u);l=true}}if(!l){u=t.name;d={sectionID:t.section_id,iblockID:t.iblock_id};if(!!a&&!!a.path&&a.path!=="/"){u+=a.path;d.sectionID=a.id;if(!!a){c(s,a.id,d,u)}}}}},{key:"checkFileName",value:function e(t){if(this.timeout>0){clearTimeout(this.timeout)}if(t!==this.dialogName||!this.item){return}var i=this.item.getData("NAME");var n=false;for(var a in BX.DiskFileDialog.obItems[this.dialogName]){if(BX.DiskFileDialog.obItems[this.dialogName].hasOwnProperty(a)&&BX.DiskFileDialog.obItems[this.dialogName][a]["name"]===i){n=true;break}}if(n){BX.DiskFileDialog.showNotice(r.Loc.getMessage("WDUF_FILE_IS_EXISTS"),this.dialogName)}else{BX.DiskFileDialog.closeNotice(this.dialogName)}}},{key:"showMovedFile",value:function e(t,i,n){if(this.item){this.item.emit("onMoved",n)}this.item=null}},{key:"onCancel",value:function e(){o.EventEmitter.unsubscribe(BX.DiskFileDialog,"loadItems",this.openSection);o.EventEmitter.unsubscribe(BX.DiskFileDialog,"selectItem",this.loadFolder);o.EventEmitter.unsubscribe(BX.DiskFileDialog,"unSelectItem",this.stopLoadingFolder);this.item=null;if(this.timeout>0){clearTimeout(this.timeout)}this.timeout=null}}],[{key:"subscribe",value:function t(){if(BX.DiskFileDialog.subscribed!==true){BX.DiskFileDialog.subscribed=true;o.EventEmitter.subscribe(BX.DiskFileDialog,"onFileNeedsToMove",function(t){t.stopImmediatePropagation();e.getInstance().fire(babelHelpers.toConsumableArray(t.getData()).shift())})}}},{key:"getInstance",value:function t(){if(this.instance===null){this.instance=new e}return this.instance}}]);return e}();babelHelpers.defineProperty(O,"subscribed",false);babelHelpers.defineProperty(O,"instance",null);function M(){var e=babelHelpers.taggedTemplateLiteral(['<input type="hidden" name="','" value="','">']);M=function t(){return e};return e}function P(){var e=babelHelpers.taggedTemplateLiteral(['<input type="hidden" name="','" value="','">']);P=function t(){return e};return e}var x=0;function R(e){var t={},i,n;for(i in e){n=i.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase();t[n]=e[i];t[i]=e[i]}return t}var B=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.id,a=e.fieldName,r=e.container,l=e.eventObject,c=e.input;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:r,eventObject:l}));i.id=n;i.fieldName=a;i.input=c;if(!i.input){return babelHelpers.possibleConstructorReturn(i)}i.agent=BX.Uploader.getInstance({id:n,streams:1,allowUpload:"A",uploadFormData:"N",uploadMethod:"immediate",uploadFileUrl:s.urlUpload,showImage:false,sortItems:false,dropZone:null,input:i.input,pasteFileHashInForm:false});i.onUploadDone=i.onUploadDone.bind(babelHelpers.assertThisInitialized(i));i.onUploadError=i.onUploadError.bind(babelHelpers.assertThisInitialized(i));o.EventEmitter.subscribe(i.agent,"onFileIsUploaded",function(e){var t=babelHelpers.slicedToArray(e.compatData,3),n=t[0],a=t[1],r=t[2];i.onUploadDone(a,r)});o.EventEmitter.subscribe(i.agent,"onFileIsUploadedWithError",function(e){var t=babelHelpers.slicedToArray(e.compatData,3),n=t[0],a=t[1],r=t[2];i.onUploadError(a,r)});i.fileSelector=new L(babelHelpers.assertThisInitialized(i));o.EventEmitter.subscribe(i.fileSelector,"onUploadDone",function(e){var t=e.data.itemData;i.onSelectionIsDone(t)});i.fileSelectorCloud=new A(babelHelpers.assertThisInitialized(i));o.EventEmitter.subscribe(i.fileSelectorCloud,"onUploadDone",function(e){var t=e.data.itemData;i.onSelectionIsDone(t)});return i}babelHelpers.createClass(t,[{key:"onSelectionIsDone",value:function e(t){var i={id:"disk-edit-attach"+t["ID"],"bx-agentFileId":t["ID"]};if(t["FILE_ID"])i["bx-attach-file-id"]="n"+t["FILE_ID"];var n=r.Tag.render(P(),this.fieldName,t["ID"]);for(var a in i){if(i.hasOwnProperty(a)){n.setAttribute(a,i[a])}}this.getContainer().appendChild(n);var s={element_id:t["ID"],element_name:t["NAME"],element_url:t["PREVIEW_URL"],storage:t["STORAGE"]};o.EventEmitter.emit(this.getEventObject(),"OnFileUploadSuccess",new o.BaseEvent({compatData:[s,{},null,{id:x++,name:t["NAME"],size:t["SIZE"],sizeInt:t["SIZE_INT"]}]}))}},{key:"onUploadDone",value:function e(t,i){if(i["file"]&&i["file"]["attachId"]!==i["file"]["id"]){i["file"]["id"]=i["file"]["attachId"];delete i["file"]["attachId"]}var n=R(i["file"]);var a={id:"disk-edit-attach"+n.id,"bx-agentFileId":t.id};if(n["XML_ID"])a["bx-attach-xml-id"]=n["XML_ID"];if(n["FILE_ID"])a["bx-attach-file-id"]="n"+n["FILE_ID"];if(n["FILE_TYPE"])a["bx-attach-file-type"]=n["FILE_TYPE"];n.element_id=n.id;var o=r.Tag.render(M(),this.fieldName,n.id);for(var s in a){if(a.hasOwnProperty(s)){o.setAttribute(s,a[s])}}this.getContainer().appendChild(o);this.onFileIs(t,n)}},{key:"onFileIs",value:function e(t,i){var n={element_id:i.element_id,element_name:i.element_name||t.name,element_url:i.element_name||i.previewUrl||i.preview_url,storage:"disk"};o.EventEmitter.emit(this.getEventObject(),"OnFileUploadSuccess",new o.BaseEvent({compatData:[n,this,t.file,t]}))}},{key:"onUploadError",value:function e(t,i){BX.onCustomEvent(this.getEventObject(),"OnFileUploadFailed",[this,t.file,t])}}]);return t}(b);var j=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;var a=e.id,r=e.fieldName,s=e.container,l=e.eventObject,c=e.input,u=e.parserParams;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:s,eventObject:l}));n.id=a;n.fieldName=r;n.input=c;if(u){n.getFileController().getParser().setParams(u)}n.init();if(i.length>0){o.EventEmitter.emit(n.getEventObject(),"onShowControllers","show");n.show(i)}return n}babelHelpers.createClass(t,[{key:"init",value:function e(){var t=this;if(this.input){this.getFilesUploader()}this.initDocumentController();this.settingsController=new _(this,{});this.panelController=new w(this);this.fileSelector=new L(this);o.EventEmitter.subscribe(this.fileSelector,"onUploadDone",function(e){var i=e.data.itemData;t.getFileController().add(i)});this.fileSelectorCloud=new A(this);o.EventEmitter.subscribe(this.fileSelectorCloud,"onUploadDone",function(e){var i=e.data,n=i.itemData,a=i.itemContainer;t.getFileController().add(n,a)});var i=function e(i){var n=r.Type.isArray(i.getData())?i.getData().shift():i.getData();if(n==="show"){t.show()}else{t.hide()}};o.EventEmitter.subscribe(this.getEventObject(),"onCollectControllers",function(e){e.data[t.fieldName]={tag:t.getFileController().isPluggedIn()?t.getFileController().getParser().tag:null,values:[]};t.getContainer().querySelectorAll('input[type="hidden"][name="'.concat(t.fieldName,'"]')).forEach(function(i){e.data[t.fieldName].values.push(i.value)})});o.EventEmitter.subscribe(this.getEventObject(),"onShowControllers",i);o.EventEmitter.subscribe(this.getEventObject(),"DiskLoadFormController",i);o.EventEmitter.subscribe(o.EventEmitter.GLOBAL_TARGET,"disk.uf.file:create:thumb:upload",function(e){var i=e.data;t.show();t.getFilesUploader().addTestThumb(i)});o.EventEmitter.subscribe(o.EventEmitter.GLOBAL_TARGET,"disk.uf.file:create:thumb:error",function(){t.show();t.getFilesUploader().addTestErrorThumb()})}},{key:"initDocumentController",value:function e(){var i=this;this.documentController=new F({container:this.getContainer(),eventObject:this.getEventObject()});o.EventEmitter.subscribe(this.documentController,"onFileIsCreated",function(e){var t=e.data.itemData;o.EventEmitter.emit(i.getEventObject(),"onShowControllers","show");i.getFileController().add(t)});if(!this.documentController.isRelevant()){return}else if(!this.isPluggedIn()){this.documentController.show();return}if(this.eventObject.dataset.bxDiskDocumentButton!=="added"){this.eventObject.dataset.bxDiskDocumentButton="added";var n=document.createElement("DIV");n.addEventListener("click",function(){var e=n.closest('[data-id="disk-document"]');if(e&&e.hasAttribute("data-bx-button-status")){o.EventEmitter.emit(i.getEventObject(),"onHideDocuments")}else{o.EventEmitter.emit(i.getEventObject(),"onShowControllers","hide");o.EventEmitter.emit(i.getEventObject(),"onShowDocuments","show")}});n.innerHTML="<i></i>"+r.Loc.getMessage("WDUF_CREATE_DOCUMENT");o.EventEmitter.emit(this.eventObject,"OnAddButton",[{BODY:n,ID:"disk-document"},"file"]);o.EventEmitter.subscribe(this.getEventObject(),"onShowDocuments",function(){var e=n.closest('[data-id="disk-document"]');if(e){e.setAttribute("data-bx-button-status","active")}});o.EventEmitter.subscribe(this.getEventObject(),"onHideDocuments",function(){var e=n.closest('[data-id="disk-document"]');if(e){e.removeAttribute("data-bx-button-status")}})}o.EventEmitter.subscribe(this.getEventObject(),"onShowDocuments",function(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"show",i).call(i);i.documentController.show()});o.EventEmitter.subscribe(this.getEventObject(),"onHideDocuments",function(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"hide",i).call(i);i.documentController.hide()});var a=function e(t){var n=t.data;if(n==="show"){o.EventEmitter.emit(i.getEventObject(),"onHideDocuments")}};o.EventEmitter.subscribe(this.getEventObject(),"DiskLoadFormController",a);o.EventEmitter.subscribe(this.getEventObject(),"onShowControllers",a)}},{key:"getFileController",value:function e(){if(!this.filesController){this.filesController=new S({id:this.id,fieldName:this.fieldName,container:this.container,eventObject:this.eventObject})}return this.filesController}},{key:"getFilesUploader",value:function e(){var t=this;if(!this.filesUploader){this.filesUploader=new h({id:this.id,container:this.container.querySelector('[data-bx-role="placeholder"]'),dropZone:this.container,input:this.input});o.EventEmitter.subscribe(this.getEventObject(),"OnVideoHasCaught",function(e){var i=e.getData();var n=function e(n){var a=n.data,r=a.itemData,s=a.itemContainer,l=a.blob;if(i===l){o.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",e);t.getFileController().getParser().insertFile(r.ID)}};o.EventEmitter.subscribe(t.filesUploader,"onUploadDone",n);t.filesUploader.upload([i]);e.stopImmediatePropagation()});o.EventEmitter.subscribe(this.getEventObject(),"OnImageHasCaught",function(e){var i=e.getData();e.stopImmediatePropagation();return new Promise(function(e,n){var a=function n(a){var s=a.data,l=s.itemData,c=s.itemContainer,u=s.blob;if(i===u){o.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",n);o.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",r);e({image:{src:l.PREVIEW_URL},html:t.getFileController().getParser().getItemHTML(l.ID)})}};o.EventEmitter.subscribe(t.filesUploader,"onUploadDone",a);var r=function e(r){var s=r.data.blob;if(i===s){o.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",a);o.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",e);n()}};o.EventEmitter.subscribe(t.filesUploader,"onUploadDone",r);t.filesUploader.upload([i])})});o.EventEmitter.subscribe(this.getEventObject(),"onFilesHaveCaught",function(e){e.stopImmediatePropagation();t.filesUploader.upload(babelHelpers.toConsumableArray(e.getData()))});o.EventEmitter.subscribe(this.filesUploader,"onUploadDone",function(e){var i=e.data,n=i.itemData,a=i.itemContainer;t.getFileController().add(n,a)});o.EventEmitter.subscribe(this.filesUploader,"onUploadIsStart",function(){o.EventEmitter.emit(t.getEventObject(),"onBusy",t)});o.EventEmitter.subscribe(this.filesUploader,"onUploadIsDone",function(){o.EventEmitter.emit(t.getEventObject(),"onReady",t)})}return this.filesUploader}},{key:"getPanelController",value:function e(){return this.panelController}},{key:"show",value:function e(i){var n=this;var a=this.getContainer().parentNode.querySelector("#"+this.getContainer().id+"-switcher");if(a){a.parentNode.removeChild(a)}if(this.getFileController().isPluggedIn()){this.getContainer().setAttribute("data-bx-plugged-in","Y")}babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"show",this).call(this);this.showInitialLoader();this.getFileController().show();this.getPanelController().show();if(i){this.getFileController().set(i).then(function(){n.hideInitialLoader()})}else{this.hideInitialLoader()}}},{key:"hide",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"hide",this).call(this);this.getFileController().hide();this.getPanelController().hide()}},{key:"showInitialLoader",value:function e(){}},{key:"hideInitialLoader",value:function e(){}}],[{key:"getInstance",value:function e(i,n){if(!this.repo[i["id"]]){this.repo[i["id"]]=new t(i,n)}return this.repo[i["id"]]}},{key:"getBriefInstance",value:function e(t){if(!this.repo[t["id"]]){this.repo[t["id"]]=new B(t,[])}return this.repo[t["id"]]}}]);return t}(b);babelHelpers.defineProperty(j,"repo",{});setTimeout(function(){if(BX.DiskFileDialog){O.subscribe()}},1e3);var X=function e(t){var i=BX("diskuf-selectdialog-"+t["UID"]);if(i&&BX.isNodeInDom(i)){var n=i.parentNode;if(!i.hasAttribute("bx-disk-load-is-bound")){i.setAttribute("bx-disk-load-is-bound","Y");BX.addCustomEvent(n,"DiskLoadFormController",function(e){try{BX.Disk.UF.Options.set({urlUpload:t.urlUpload});return BX.Disk.UF.Form.getBriefInstance({container:i,eventObject:i.parentNode,id:t.UID,fieldName:t.controlName,input:BX.findChild(i,{className:"diskuf-fileUploader"},true)})}catch(e){console.log("Error with compatibility",e)}})}if(!!t["values"]&&t["values"].length>0&&!t["hideSelectDialog"])BX.onCustomEvent(i.parentNode,"DiskLoadFormController",["show"])}};e.Form=j;e.Options=s;e.add=X})(this.BX.Disk.UF=this.BX.Disk.UF||{},BX,BX.Main,BX.UI,BX.UI,BX,BX.Event);(function(e){if(e.BX.Disk&&e.BX.Disk.UFShowController)return;var t=e.BX;var i=0;var n={};var a=function(e){return t.Disk.ajaxPromise({url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","getBreadcrumbs"),method:"POST",dataType:"json",data:{attachedId:e}})};var r=function(e){if(!t(e)||e.hasAttribute("bx-is-bound"))return;e.setAttribute("bx-is-bound","Y");this.img=e;this.node=e.parentNode.parentNode.parentNode;t.unbindAll(e);t.unbindAll(this.node);t.show(this.node);t.remove(this.node.nextSibling);this.id="wufdp_"+Math.random()};r.prototype={turnOn:function(){this.timeout=setTimeout(t.delegate(function(){this.show()},this),500)},turnOff:function(){clearTimeout(this.timeout);this.timeout=null;this.hide()},show:function(){if(this.popup!=null)this.popup.close();if(this.popup==null){var e={width:this.img.naturalWidth,height:this.img.naturalHeight};if(t["UploaderUtils"]){var i=t.UploaderUtils.scaleImage(e,{width:parseInt(t.message("DISK_THUMB_WIDTH")),height:parseInt(t.message("DISK_THUMB_HEIGHT"))});e=i.destin}this.popup=new t.PopupWindow("bx-wufd-preview-img-"+this.id,this.img.parentNode,{lightShadow:true,offsetTop:-7,offsetLeft:(51-28)/2+14,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:t.proxy(function(){this.popup=null},this)},content:t.create("DIV",{props:e,children:[t.create("IMG",{props:e,attrs:{src:this.img.src}})]})});this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false},hide:function(){if(this.popup!=null)this.popup.close()}};t.addCustomEvent("onDiskPreviewIsReady",function(e){new r(e)});t.Disk.UF.runImport=function(e){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_PROCESS_LOADING"),showLoaderIcon:true,autoHide:false});t.Disk.ExternalLoader.reloadLoadAttachedObject({attachedObject:{id:e.id,name:e.name,service:e.service},onFinish:t.delegate(function(e){if(e.hasOwnProperty("hasNewVersion")&&!e.hasNewVersion){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_HAS_LAST_VERSION"),showSuccessIcon:true,autoHide:true})}else if(e.status==="success"){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_SUCCESS_LOADING"),showSuccessIcon:true,autoHide:true})}else{t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_FAIL_LOADING"),autoHide:true})}},this),onProgress:t.delegate(function(e){},this)}).start()};t.Disk.UF.disableAutoCommentToAttachedObject=function(e){var i=e.attachedId;t.Disk.ajax({method:"POST",dataType:"json",url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","disableAutoCommentToAttachedObject"),data:{attachedId:i},onsuccess:t.delegate(function(e){},this)})};t.Disk.UF.enableAutoCommentToAttachedObject=function(e){var i=e.attachedId;t.Disk.ajax({method:"POST",dataType:"json",url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","enableAutoCommentToAttachedObject"),data:{attachedId:i},onsuccess:t.delegate(function(e){},this)})};t.Disk.UF.showTransformationUpgradePopup=function(e){B24.licenseInfoPopup.show("disk_transformation_video_limit",t.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_TITLE"),t.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_CONTENT"),false)};t.Disk.UFShowController=function(e){if(!t.type.isPlainObject(e)){e={}}this.entityType=t.type.isNotEmptyString(e.entityType)?e.entityType:"";this.entityId=parseInt(e.entityId)>0?e.entityId:"";this.signedParameters=t.type.isNotEmptyString(e.signedParameters)?e.signedParameters:"";this.loader=null;this.container=t.type.isNotEmptyString(e.nodeId)?document.getElementById(e.nodeId):null;if(this.container){var i=this.container.querySelector(".disk-uf-file-switch-control");if(i){t.Event.bind(i,"click",t.Disk.UFShowController.onToggleView)}}if(t.type.isNotEmptyString(e.nodeId)){n[e.nodeId]=this}};t.Disk.UFShowController.getInstance=function(e){return t.type.isNotEmptyString(e)&&n[e]?n[e]:null};t.Disk.UFShowController.onToggleView=function(e){var i=e.currentTarget.closest(".diskuf-files-toggle-container"),n=e.currentTarget.getAttribute("data-bx-view-type");if(!t.type.isDomNode(i)||!t.type.isNotEmptyString(i.id)){return}var a=t.Disk.UFShowController.getInstance(i.id);if(a){a.toggleViewType({viewType:n})}e.preventDefault()};t.Disk.UFShowController.prototype.toggleViewType=function(e){this.showToggleViewLoader();t.ajax.runComponentAction("bitrix:disk.uf.file","toggleViewType",{mode:"class",signedParameters:this.signedParameters,data:{params:{viewType:e.viewType}}}).then(function(e){this.hideToggleViewLoader();t.clean(this.container);t.html(this.container,e.data.html)}.bind(this),function(e){this.hideToggleViewLoader()})};t.Disk.UFShowController.prototype.showToggleViewLoader=function(e){this.container.classList.add("diskuf-files-toggle-container-active");this.loader=new t.Loader({target:this.container});this.loader.show()};t.Disk.UFShowController.prototype.hideToggleViewLoader=function(e){this.container.classList.remove("diskuf-files-toggle-container-active");if(this.loader){this.loader.destroy()}};e.DiskOpenMenuCreateService=function(e){var i=[t.Disk.UF.getDocumentHandler("onlyoffice")?{text:t.Disk.UF.getDocumentHandler("onlyoffice").name,className:"bx-viewer-popup-item item-b24-docs",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("onlyoffice");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("onlyoffice").name})}}:null,t.Disk.Document.Local.Instance.isEnabled()?{text:t.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT"),className:"bx-viewer-popup-item item-b24",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("l");t.adjust(e,{text:t.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT")})}}:null,{text:t.Disk.UF.getDocumentHandler("gdrive").name,className:"bx-viewer-popup-item item-gdocs",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("gdrive");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("gdrive").name})}},{text:t.Disk.UF.getDocumentHandler("office365").name,className:"bx-viewer-popup-item item-office365",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("office365");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("office365").name})}},{text:t.Disk.UF.getDocumentHandler("onedrive").name,className:"bx-viewer-popup-item item-office",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("onedrive");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("onedrive").name})}}];t.PopupMenu.show("disk_open_menu_with_services",t(e),i,{offsetTop:0,offsetLeft:25,angle:{position:"top",offset:45},autoHide:true,zIndex:1e4,overlay:{opacity:.01},events:{}})};e.DiskOpenMenuImportService=function(e,i){var n=[];for(var a in i){if(!i.hasOwnProperty(a))continue;n.push({text:i[a].name,code:i[a].id,href:"#",onclick:function(e,i){var n=i.layout.item;t.addClass(n,"diskuf-selector-link-cloud");n.setAttribute("data-bx-doc-handler",i.code);t.onCustomEvent("onManualChooseCloudImport",[{target:n}]);t.removeClass(n,"diskuf-selector-link-cloud");n.removeAttribute("data-bx-doc-handler");t.PopupMenu.destroy("disk_open_menu_with_import_services");return t.PreventDefault(e)}})}var r=new t.CViewer({});r.openMenu("disk_open_menu_with_import_services",t(e),n,{offsetTop:0,offsetLeft:25});return t.PreventDefault()};e.DiskActionFileMenu=function(e,n,a){i++;t.PopupMenu.show("bx-viewer-wd-popup"+i+"_"+e,t(n),a,{angle:{position:"top",offset:25},autoHide:true});return false};e.WDInlineElementClickDispatcher=function(e,i){var n=t(i);if(n){t.fireEvent(n,"click")}return false}})(window);
//# sourceMappingURL=script.map.js