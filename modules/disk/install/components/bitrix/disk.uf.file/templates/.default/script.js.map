{"version":3,"sources":["upload-menu-compatibility.js","script-old.js"],"names":["instances","Map","UploadMenu","constructor","options","Text","getRandom","container","eventObject","browseElement","input","querySelector","tagName","toLowerCase","parentNode","disabled","openMyDriveLink","Event","bind","openCloudDriveLink","eventData","_onUploadProgress","EventEmitter","emit","BaseEvent","compatData","Type","isFunction","Uploader","id","controller","multiple","maxFileSize","treatOversizeImageAsFile","ignoreUnknownImageTypes","hiddenFieldName","hiddenFieldsContainer","events","UploaderEvent","FILE_ADD","FILE_COMPLETE","FILE_ERROR","FILE_UPLOAD_PROGRESS","getUploader","event","file","getData","getBinary","progress","console","log","getError","Runtime","loadExtension","then","exports","openDiskFileDialog","dialogId","uploader","openCloudFileDialog","fileInfo","getState","size","getSizeFormatted","sizeInt","getSize","ext","getExtension","nameWithoutExt","UploaderHelpers","getFilenameWithoutExtension","getName","element_id","getServerFileId","element_name","element_url","getPreviewUrl","storage","getCustomData","add","document","getElementById","has","get","uploadMenu","controlName","set"],"mappings":"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ACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"script.js.map","sourcesContent":["import { Event, Runtime, Text, Type } from 'main.core';\nimport { Uploader, UploaderEvent, UploaderFile, UploaderFileInfo, Helpers as UploaderHelpers } from 'ui.uploader.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\ntype FormBriefOptions = {\n\tUID: string,\n\tcontrolName: string,\n\thideSelectDialog: boolean,\n};\n\ntype UploaderMenuOptions = {\n\tid: string,\n\tcontainer: HTMLElement,\n\teventObject: HTMLElement,\n\thiddenFieldName: string,\n};\n\nconst instances: Map<string, UploadMenu> = new Map();\n\nclass UploadMenu\n{\n\t#container: HTMLElement = null;\n\t#eventObject: HTMLElement = null;\n\t#uploader: Uploader = null;\n\t#id: string = `dialog-${Text.getRandom(5)}`;\n\t#onProgressHandler: Function = null;\n\n\tconstructor(options: UploaderMenuOptions)\n\t{\n\t\tthis.#container = options.container;\n\t\tthis.#eventObject = options.eventObject;\n\n\t\tlet browseElement: HTMLElement = null;\n\t\tconst input: HTMLInputElement = this.#container.querySelector('.diskuf-fileUploader');\n\t\tif (input)\n\t\t{\n\t\t\tif (input.tagName.toLowerCase() === 'input')\n\t\t\t{\n\t\t\t\tbrowseElement = input.parentNode;\n\t\t\t\tinput.disabled = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tbrowseElement = input;\n\t\t\t}\n\t\t}\n\n\t\tconst openMyDriveLink: HTMLElement = this.#container.querySelector('.diskuf-selector-link');\n\t\tif (openMyDriveLink)\n\t\t{\n\t\t\tEvent.bind(openMyDriveLink.parentNode, 'click', this.#handleMyDriveClick.bind(this));\n\t\t}\n\n\t\tconst openCloudDriveLink: HTMLElement = this.#container.querySelector('.diskuf-selector-link-cloud');\n\t\tif (openCloudDriveLink)\n\t\t{\n\t\t\tEvent.bind(openCloudDriveLink.parentNode, 'click', this.#handleCloudDriveClick.bind(this));\n\t\t}\n\n\t\tconst eventData = { _onUploadProgress: null };\n\t\tEventEmitter.emit(this.#eventObject, 'DiskDLoadFormControllerInit', new BaseEvent({ compatData: [eventData] }));\n\t\tif (Type.isFunction(eventData._onUploadProgress))\n\t\t{\n\t\t\tthis.#onProgressHandler = eventData._onUploadProgress;\n\t\t}\n\n\t\tthis.#uploader = new Uploader({\n\t\t\tid: options.id,\n\t\t\tcontroller: 'disk.uf.integration.diskUploaderController',\n\t\t\tbrowseElement,\n\t\t\tmultiple: true,\n\t\t\tmaxFileSize: null,\n\t\t\ttreatOversizeImageAsFile: true,\n\t\t\tignoreUnknownImageTypes: true,\n\t\t\thiddenFieldName: options.hiddenFieldName,\n\t\t\thiddenFieldsContainer: this.#container,\n\t\t\tevents: {\n\t\t\t\t[UploaderEvent.FILE_ADD]: this.#handleFileAdd.bind(this),\n\t\t\t\t[UploaderEvent.FILE_COMPLETE]: this.#handleFileComplete.bind(this),\n\t\t\t\t[UploaderEvent.FILE_ERROR]: this.#handleFileError.bind(this),\n\t\t\t\t[UploaderEvent.FILE_UPLOAD_PROGRESS]: this.#handleFileProgress.bind(this),\n\t\t\t},\n\t\t});\n\t}\n\n\tgetUploader(): Uploader\n\t{\n\t\treturn this.#uploader;\n\t}\n\n\t#handleFileComplete(event: BaseEvent): void\n\t{\n\t\tconst file: UploaderFile = event.getData().file;\n\n\t\tEventEmitter.emit(\n\t\t\tthis.#eventObject,\n\t\t\t'OnFileUploadSuccess',\n\t\t\tnew BaseEvent({\n\t\t\t\tcompatData: [\n\t\t\t\t\tthis.#createFileResult(file),\n\t\t\t\t\tthis,\n\t\t\t\t\tfile.getBinary(),\n\t\t\t\t\tthis.#createFileInfo(file)\n\t\t\t\t]\n\t\t\t})\n\t\t);\n\t}\n\n\t#handleFileAdd(event: BaseEvent): void\n\t{\n\t\tif (this.#onProgressHandler !== null)\n\t\t{\n\t\t\tconst file: UploaderFile = event.getData().file;\n\t\t\tthis.#onProgressHandler(this.#createFileInfo(file), 5);\n\t\t}\n\t}\n\n\t#handleFileProgress(event: BaseEvent): void\n\t{\n\t\tif (this.#onProgressHandler !== null)\n\t\t{\n\t\t\tconst file: UploaderFile = event.getData().file;\n\t\t\tconst progress: Number = event.getData().progress;\n\n\t\t\tthis.#onProgressHandler(this.#createFileInfo(file), progress);\n\t\t}\n\t}\n\n\t#handleFileError(event: BaseEvent): void\n\t{\n\t\tconst file: UploaderFile = event.getData().file;\n\n\t\tconsole.log('UploadMenu Error:', file.getError());\n\n\t\tEventEmitter.emit(\n\t\t\tthis.#eventObject,\n\t\t\t'OnFileUploadFailed',\n\t\t\tnew BaseEvent({compatData: [this, file.getBinary(), this.#createFileInfo(file)]})\n\t\t);\n\t}\n\n\t#handleMyDriveClick(): void\n\t{\n\t\tRuntime.loadExtension('disk.uploader.user-field-widget').then((exports) => {\n\t\t\tconst { openDiskFileDialog } = exports;\n\t\t\topenDiskFileDialog({\n\t\t\t\tdialogId: `file-${this.#id}`,\n\t\t\t\tuploader: this.#uploader,\n\t\t\t});\n\t\t});\n\t}\n\n\t#handleCloudDriveClick(): void\n\t{\n\t\tRuntime.loadExtension('disk.uploader.user-field-widget').then((exports) => {\n\t\t\tconst { openCloudFileDialog } = exports;\n\t\t\topenCloudFileDialog({\n\t\t\t\tdialogId: `cloud-${this.#id}`,\n\t\t\t\tuploader: this.#uploader,\n\t\t\t});\n\t\t});\n\t}\n\n\t#createFileInfo(file: UploaderFile): UploaderFileInfo\n\t{\n\t\tconst fileInfo: UploaderFileInfo = file.getState();\n\n\t\tfileInfo.size = file.getSizeFormatted();\n\t\tfileInfo.sizeInt = file.getSize();\n\t\tfileInfo.ext = file.getExtension();\n\t\tfileInfo.nameWithoutExt = UploaderHelpers.getFilenameWithoutExtension(file.getName());\n\n\t\treturn fileInfo;\n\t}\n\n\t#createFileResult(file: UploaderFile): {\n\t\telement_id: string,\n\t\telement_name: string,\n\t\telement_url: string,\n\t\tstorage: string,\n\t}\n\t{\n\t\treturn {\n\t\t\telement_id: file.getServerFileId(),\n\t\t\telement_name: file.getName(),\n\t\t\telement_url: file.getPreviewUrl(),\n\t\t\tstorage: file.getCustomData('storage') || 'disk',\n\t\t};\n\t}\n}\n\nexport const add = (options: FormBriefOptions): ?UploadMenu => {\n\tconst container = document.getElementById(`diskuf-selectdialog-${options['UID']}`);\n\tif (!container)\n\t{\n\t\treturn null;\n\t}\n\n\tif (instances.has(options['UID']))\n\t{\n\t\treturn instances.get(options['UID']);\n\t}\n\n\tconst uploadMenu: UploadMenu = new UploadMenu({\n\t\tid: `disk-uf-file-${options['UID']}`,\n\t\tcontainer,\n\t\teventObject: container.parentNode,\n\t\thiddenFieldName: options.controlName,\n\t});\n\n\tinstances.set(options['UID'], uploadMenu);\n\n\treturn uploadMenu;\n};\n",null]}