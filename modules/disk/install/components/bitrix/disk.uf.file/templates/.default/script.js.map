{"version":3,"sources":["src/options.js","src/items/item-new.js","src/file-uploader.js","src/controllers/default-controller.js","src/items/item-more.js","src/backend.js","src/items/item.js","src/items/item-image.js","src/controllers/file-parser.js","src/items/index.js","src/controllers/file-controller.js","src/controllers/settings-controller.js","src/controllers/document-controller.js","src/controllers/panel-controller.js","src/controllers/file-selector.js","src/items/item-new-selected-cloud.js","src/controllers/file-selector-cloud.js","src/controllers/file-mover.js","src/form-brief.js","src/form.js","src/index.js","script-old.js"],"names":["Options","optionsToSet","optionName","hasOwnProperty","documentHandlers","code","handler","find","width","height","ItemNew","fileId","fileObject","id","object","data","NAME","name","EventEmitter","subscribe","onUploadProgress","bind","onUploadDone","onUploadError","progress","BX","UI","ProgressRound","colorTrack","colorBar","lineSize","statusType","Status","INCIRCLE","textBefore","textAfter","size","container","extension","split","pop","toLowerCase","Text","encode","Tag","render","getContainer","onClickDelete","event","preventDefault","stopPropagation","emit","setTimeout","deleteFile","compatData","Math","min","max","getValue","update","file","hash","setTextBefore","Loc","getMessage","classList","add","FileUploader","dropZone","input","agent","Uploader","getInstance","allowUpload","uploadFormData","uploadMethod","uploadFileUrl","urlUpload","showImage","sortItems","pasteFileHashInForm","catchFile","packageFormer","previewParams","previewSize","exact","post","incrementItemsCount","item","itemData","blob","constructor","decrementItemsCount","convertToItemSavedType","itemContainer","removeChild","appendChild","progressPercent","ceil","random","files","onAttach","ID","attachId","IS_LOCKED","IS_MARK_DELETED","EDITABLE","FROM_EXTERNAL_SYSTEM","CAN_RESTORE","CAN_UPDATE","canChangeName","CAN_RENAME","CAN_MOVE","COPY_TO_ME_URL","DELETE_URL","DOWNLOAD_URL","EDIT_URL","VIEW_URL","PREVIEW_URL","previewUrl","BIG_PREVIEW_URL","replace","EXTENSION","ext","SIZE","SIZE_BYTES","sizeInt","STORAGE","storage","Symbol","DefaultController","eventObject","Cache","MemoryCache","pluggedIn","properties","dataset","bxHtmlEditable","hasContainer","style","display","ItemMoreButton","cache","remember","onClick","getValueContainer","document","createElement","hiddenFilesCount","stepNumber","innerHTML","show","step","hide","itemsCount","stepValue","decrement","Backend","fileName","dialogName","Promise","resolve","ajax","get","Uri","addParam","urlSelect","ACTION","MULTI","join","wish","targetID","libLink","DiskFileDialog","obCurrentTab","link","use_light_view","AJAX_CALL","SIMPLE_UPLOAD","IFRAME","sessid","bitrix_sessid","SECTION_ID","CHECK_NAME","loadJSON","service","cloudImport","targetFolderId","Disk","method","dataType","url","addToLinkParam","attachedId","onsuccess","runAction","newName","Item","setEventNamespace","String","setData","onMoved","FILE_ID","key","getId","value","onClickMore","querySelector","keys","forEach","node","Type","isDomNode","parentNode","delete","has","getData","fullName","cleanName","substring","length","moreButton","contextMenu","Menu","getRandom","bindElement","items","isPluggedIn","bxRole","text","onclick","close","html","className","target","type","onRenamed","clearMenu","delimiter","onClickMoveTo","filter","preItem","angle","offsetLeft","destroy","deleteAction","getMenu","element_id","row","result","rename","renameAction","tagId","ItemImage","BIG_REVIEW_URL","justCounter","FileParser","fileController","init","htmlEditor","parse","unparse","regexp","tag","isStringFilled","RegExp","bbDelimiter","htmlDelimiter","getItemBBCode","getItemHTML","getHTMLForHTMLEditor","SetBxTag","itemId","fileIds","getAllIds","GetViewMode","doc","GetIframeDoc","ii","bxTags","indexOf","getElementById","SaveContent","content","GetContent","str","foundId","SetContent","Focus","test","foundedItem","values","bxTag","itemMappings","getItem","itemClassName","itemClass","detect","FileController","fieldName","multiple","Map","buildInHTMLEditor","getParser","hasInterface","getInterface","fileData","manualClearing","Object","uf","isArray","prefixHTMLNode","img","infoNode","hasAttribute","getAttribute","src","push","set","e","console","log","clear","counter","maxVisibleCount","addItem","appendNode","getItemMore","reset","increment","setPluggedIn","insertFile","replaceChild","res","showMoreItems","timeoutCounter","itemMoreNode","opacity","visibility","insertBefore","Dom","addClass","addEventListener","removeClass","parser","SettingsController","allowEditNode","allowGridNode","popup","checked","remove","bxSave","userOptions","save","bxName","buildDocumentServiceTextLabel","buildSubMenuWithDocumentServices","offsetTop","events","onClose","currentService","getDocumentService","isAvailableOnlyOffice","getDocumentHandler","getDocumentHandlers","saveDocumentService","getMenuWindow","getParentMenuItem","setText","getPopupWindow","DocumentController","querySelectorAll","createDocument","documentType","insertDocumentIntoUf","extendedFileData","parts","Document","Local","Instance","isSetWorkWithLocalBDisk","createFile","then","response","createProcess","CreateProcess","typeFile","serviceCode","onAfterSave","status","getMetaDataForCreatedFileInUf","start","folderName","PanelController","FileSelector","openSection","selectFile","getSelectedData","obCallback","saveButton","openDialog","dialog2","tab","path","selected","unsubscribe","ItemNewSelectedCloud","ExternalLoader","startLoad","onFinish","newData","onProgress","FileSelectorCloud","services","currentTarget","getSelectedCloudData","ufId","sizeFormatted","FileMover","loadFolder","stopLoadingFolder","checkFileName","onApply","onCancel","getSelectedFile","getFileId","cancelButton","someDialogName","element","substr","documentExists","permission","timeout","clearTimeout","showNotice","closeNotice","someData","folderByPath","moved","moveQuery","sectionProperties","sectionPath","moveFile","showModalWithStatusAction","showMovedFile","i","sectionID","iblockID","iblock_id","section_id","exist","obItems","subscribed","stopImmediatePropagation","fire","shift","instance","_camelToSNAKE","obj","o","k","toUpperCase","FormBrief","streams","params","fileSelector","onSelectionIsDone","fileSelectorCloud","attrs","setAttribute","element_name","element_url","getEventObject","BaseEvent","onFileIs","preview_url","onCustomEvent","Form","parserParams","getFileController","setParams","getFilesUploader","initDocumentController","settingsController","panelController","switcher","nodeItem","GLOBAL_TARGET","addTestThumb","addTestErrorThumb","documentController","isRelevant","bxDiskDocumentButton","closest","BODY","removeAttribute","filesController","filesUploader","fileToUpload","onSuccess","upload","reject","onFailed","image","showInitialLoader","getPanelController","hideInitialLoader","repo","isNodeInDom","addCustomEvent","UF","getBriefInstance","UID","controlName","findChild"],"mappings":"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AAE,CAACmc,aAAH,CAAiBvb,SAAS,CAACgL,UAA3B,EAAuC,wBAAvC,EAAiE,CAAC,MAAD,CAAjE;CACD;CACD,CA/BD;;;;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"script.js.map","sourcesContent":["export default class Options\n{\n\tstatic urlUpload = null;\n\tstatic documentHandlers = null;\n\tstatic previewSize = {width: 115, height: 115};\n\n\tstatic set(optionsToSet: Object): void\n\t{\n\t\tfor (let optionName in optionsToSet)\n\t\t{\n\t\t\tif (Options.hasOwnProperty(optionName))\n\t\t\t{\n\t\t\t\tOptions[optionName] = optionsToSet[optionName];\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic getDocumentHandlers(): Array<Object>\n\t{\n\t\tif (!Options.documentHandlers)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\treturn Options.documentHandlers;\n\t}\n\n\tstatic getDocumentHandler(code): Object\n\t{\n\t\tif (!Options.documentHandlers)\n\t\t{\n\t\t\treturn {};\n\t\t}\n\n\t\tlet handler = Options.documentHandlers.find(function (handler) {\n\t\t\treturn handler.code === code;\n\t\t});\n\n\t\treturn handler || {};\n\t}\n}","import {Tag, Text, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport 'ui.progressround';\n\nexport default class ItemNew\n{\n\tid: string;\n\tobject: Object;\n\tcontainer: Element;\n\tdata: Object;\n\tprogress;\n\n\tconstructor(fileId, fileObject)\n\t{\n\t\tthis.id = fileId;\n\t\tthis.object = fileObject;\n\t\tthis.data = {\n\t\t\tNAME: fileObject.name,\n\t\t};\n\t\tEventEmitter.subscribe(this.object, 'onUploadProgress', this.onUploadProgress.bind(this));\n\t\tEventEmitter.subscribe(this.object, 'onUploadDone', this.onUploadDone.bind(this));\n\t\tEventEmitter.subscribe(this.object, 'onUploadError', this.onUploadError.bind(this));\n\t\tthis.progress = new BX.UI.ProgressRound({\n\t\t\twidth: 18,\n\t\t\tcolorTrack: 'rgba(255,255,255,.3)',\n\t\t\tcolorBar: '#fff',\n\t\t\tlineSize: 3,\n\t\t\tstatusType: BX.UI.ProgressRound.Status.INCIRCLE,\n\t\t\ttextBefore: '<i></i>',\n\t\t\ttextAfter: this.object.size,\n\t\t});\n\t}\n\n\tgetContainer()\n\t{\n\t\tif (!this.container)\n\t\t{\n\t\t\tlet extension = this.object.name.split('.').pop().toLowerCase();\n\t\t\textension = Text.encode(extension === this.object.name ? '' : extension);\n\t\t\tthis.container = Tag.render`\n\t\t<div class=\"disk-file-thumb disk-file-thumb-file disk-file-thumb--${extension} disk-file-thumb--active\">\n\t\t\t<div class=\"ui-icon ui-icon-file-${extension} disk-file-thumb-icon\"><i></i></div>\n\t\t\t<div class=\"disk-file-thumb-text\">${this.object.name}</div>\n\t\t\t<div class=\"disk-file-thumb-loader\">\n\t\t\t\t${this.progress.getContainer()}\n\t\t\t\t<div class=\"disk-file-thumb-loader-btn\" onclick=\"${this.onClickDelete.bind(this)}\"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t`;\n\t\t}\n\t\treturn this.container;\n\t}\n\n\tonClickDelete(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tEventEmitter.emit(this, 'onDelete', [this]);\n\n\t\tsetTimeout(() => { this.object.deleteFile(); }, 400);\n\t\tdelete this.container;\n\t}\n\n\tonUploadProgress({compatData: [fileObject, progress]})\n\t{\n\t\tprogress = Math.min(Math.max(this.progress.getValue(), progress), 98);\n\t\tthis.progress.update(progress);\n\t}\n\n\tonUploadDone({compatData: [fileObject, {file}]})\n\t{\n\t\tEventEmitter.emit(this, 'onUploadDone', [file, fileObject.file]);\n\t\tdelete this.object.hash;\n\t\tthis.object.deleteFile();\n\t}\n\n\tonUploadError({compatData: [fileObject]})\n\t{\n\t\tEventEmitter.emit(this, 'onUploadError', [fileObject.file]);\n\t\tthis.progress.setTextBefore(Loc.getMessage('WDUF_ITEM_ERROR'));\n\t\tthis.container.classList.add('disk-file-upload-error')\n\t\tthis.object.deleteFile();\n\t}\n}\n","import {EventEmitter} from 'main.core.events';\nimport Options from './options';\nimport ItemNew from './items/item-new';\nimport 'main.core_uploader';\nimport type {ItemUploadedType, ItemSavedType} from \"./items/item-type\";\n\nexport default class FileUploader\n{\n\t#itemsCount: number = 0;\n\tcontainer: Element;\n\tstatic #deleted = Symbol('deleted');\n\n\n\tconstructor({id, container, dropZone, input})\n\t{\n\t\tthis.container = container;\n\t\tthis.agent = BX.Uploader.getInstance({\n\t\t\tid: id,\n\t\t\tallowUpload: 'A',\n\t\t\tuploadFormData: 'N',\n\t\t\tuploadMethod: 'immediate',\n\t\t\tuploadFileUrl: Options.urlUpload,\n\t\t\tshowImage: false,\n\t\t\tsortItems: false,\n\t\t\tdropZone: dropZone,\n\t\t\tinput: input,\n\t\t\tpasteFileHashInForm: false,\n\t\t});\n\n\t\tEventEmitter.subscribe(this.agent, 'onFileIsCreated', this.catchFile.bind(this));\n\t\tEventEmitter.subscribe(this.agent, 'onPackageIsInitialized', ({compatData: [packageFormer]}) => {\n\t\t\tconst previewParams = {\n\t\t\t\twidth: Options.previewSize.width,\n\t\t\t\theight: Options.previewSize.height,\n\t\t\t\texact: 'N'\n\t\t\t};\n\t\t\tif (packageFormer.data)\n\t\t\t{\n\t\t\t\tpackageFormer.data['previewParams'] = previewParams;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tpackageFormer.post.data['previewParams'] = previewParams;\n\t\t\t}\n\t\t});\n\t}\n\n\tcatchFile({compatData: [fileId, fileObject]})\n\t{\n\t\tthis.incrementItemsCount();\n\t\tconst item = new ItemNew(fileId, fileObject);\n\t\tEventEmitter.subscribe(item, 'onUploadDone', ({data: [itemData: ItemUploadedType, blob]}) => {\n\t\t\tif (!item[this.constructor.#deleted])\n\t\t\t{\n\t\t\t\tthis.decrementItemsCount();\n\t\t\t\tEventEmitter.emit(this, 'onUploadDone', {\n\t\t\t\t\titemData: this.convertToItemSavedType(itemData),\n\t\t\t\t\titemContainer: item.getContainer(),\n\t\t\t\t\tblob: blob\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tEventEmitter.subscribe(item, 'onUploadError', ({data: [blob]}) => {\n\t\t\tthis.decrementItemsCount();\n\t\t\titem[this.constructor.#deleted] = true;\n\t\t\tEventEmitter.emit(this, 'onUploadError', {itemContainer: item.getContainer(), blob: blob});\n\t\t});\n\t\tEventEmitter.subscribe(item, 'onDelete', () => {\n\t\t\tthis.decrementItemsCount();\n\t\t\titem[this.constructor.#deleted] = true;\n\t\t\tthis.container.removeChild(item.getContainer());\n\t\t});\n\t\tthis.container.appendChild(item.getContainer());\n\t}\n\n\taddTestThumb(progressPercent)\n\t{\n\t\tconst item = new ItemNew(Math.ceil(Math.random() * 1000), {name: 'test.file.js', size: '348 Kb', deleteFile: () => {}});\n\t\tthis.container.appendChild(item.getContainer());\n\t\tif (progressPercent > 0)\n\t\t{\n\t\t\titem.onUploadProgress({compatData: [null, progressPercent]})\n\t\t}\n\t\tEventEmitter.subscribe(item, 'onDelete', () => {\n\t\t\tthis.container.removeChild(item.getContainer());\n\t\t});\n\t}\n\n\taddTestErrorThumb()\n\t{\n\t\tconst item = new ItemNew(Math.ceil(Math.random() * 1000), {name: 'test.file.js', size: '348 Kb', deleteFile: () => {}});\n\t\tthis.container.appendChild(item.getContainer());\n\t\titem.onUploadError({compatData: [{file: null}]});\n\t\tEventEmitter.subscribe(item, 'onDelete', () => {\n\t\t\tthis.container.removeChild(item.getContainer());\n\t\t});\n\t}\n\n\tupload([...files])\n\t{\n\t\tthis.agent.onAttach(files);\n\t}\n\n\tconvertToItemSavedType(item: ItemUploadedType) :ItemSavedType\n\t{\n\t\treturn {\n\t\t\tID: item.attachId,\n\t\t\tIS_LOCKED: false,\n\t\t\tIS_MARK_DELETED: false,\n\n\t\t\tEDITABLE: false,\n\t\t\tFROM_EXTERNAL_SYSTEM: false,\n\n\t\t\tCAN_RESTORE: false,\n\t\t\tCAN_UPDATE: item.canChangeName,\n\t\t\tCAN_RENAME: item.canChangeName,\n\t\t\tCAN_MOVE:  item.canChangeName,\n\n\t\t\tCOPY_TO_ME_URL: null,\n\t\t\tDELETE_URL: null,\n\t\t\tDOWNLOAD_URL: null,\n\t\t\tEDIT_URL: null,\n\t\t\tVIEW_URL: null,\n\t\t\tPREVIEW_URL: (item.previewUrl ? item.previewUrl : ''),\n\t\t\tBIG_PREVIEW_URL: (item.previewUrl ? item.previewUrl.replace(/\\&(width|height)=\\d+/gi, '') : null),\n\n\t\t\tEXTENSION: item.ext,\n\t\t\tNAME: item.name,\n\t\t\tSIZE: item.size,\n\t\t\tSIZE_BYTES: item.sizeInt,\n\t\t\tSTORAGE: item.storage,\n\t\t};\n\t}\n\tincrementItemsCount()\n\t{\n\t\tif (this.#itemsCount <= 0)\n\t\t{\n\t\t\tEventEmitter.emit(this, 'onUploadIsStart');\n\t\t}\n\t\tthis.#itemsCount++;\n\t}\n\tdecrementItemsCount()\n\t{\n\t\tif (this.#itemsCount === 1)\n\t\t{\n\t\t\tEventEmitter.emit(this, 'onUploadIsDone');\n\t\t}\n\n\t\tthis.#itemsCount = Math.max(this.#itemsCount--, 0);\n\t}\n}\n","import {Cache} from 'main.core';\n\nexport default class DefaultController {\n\thasContainer: boolean = false;\n\tcontainer: Element;\n\teventObject: Element;\n\tcache = new Cache.MemoryCache();\n\tproperties = {\n\t\tpluggedIn: false,\n\t};\n\n\tconstructor({container, eventObject})\n\t{\n\t\tthis.container = container;\n\t\tthis.eventObject = eventObject;\n\t\tthis.properties.pluggedIn = this.eventObject && this.eventObject.dataset.bxHtmlEditable === 'Y';\n\t\tif (!this.container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hasContainer = true;\n\t}\n\n\n\tisRelevant()\n\t{\n\t\treturn this.hasContainer;\n\t}\n\n\tgetEventObject()\n\t{\n\t\treturn this.eventObject;\n\t}\n\n\tgetContainer()\n\t{\n\t\treturn this.container;\n\t}\n\n\tisPluggedIn(): boolean\n\t{\n\t\treturn this.properties.pluggedIn;\n\t}\n\n\tshow()\n\t{\n\t\tthis.container.style.display = '';\n\t\tdelete this.container.style.display;\n\t}\n\n\thide()\n\t{\n\t\tthis.container.style.display = 'none';\n\t}\n}\n","import {Tag, Cache} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nexport default class ItemMoreButton\n{\n\thiddenFilesCount: number = 0;\n\tstepNumber: number = 0;\n\tcache = new Cache.MemoryCache();\n\tstepValue = 5;\n\n\tconstructor()\n\t{\n\t}\n\n\tgetContainer(): Element\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn Tag.render`\n\t\t<div class=\"disk-file-thumb disk-file-thumb-file\" onclick=\"${this.onClick.bind(this)}\">\n\t\t\t<div class=\"ui-icon ui-icon-more disk-file-thumb-icon\">\n\t\t\t\t<i></i>\n\t\t\t</div>\n\t\t\t<div class=\"disk-file-thumb-text\">${this.getValueContainer()}</div>\n\t\t</div>`;\n\t\t});\n\t}\n\n\tgetValueContainer(): Element\n\t{\n\t\treturn this.cache.remember('valueContainer', () => {\n\t\t\treturn document.createElement('DIV');\n\t\t});\n\t}\n\n\treset()\n\t{\n\t\tthis.hiddenFilesCount = 1;\n\t\tthis.stepNumber = 0;\n\t\tthis.getValueContainer().innerHTML = this.hiddenFilesCount;\n\t\tthis.show();\n\t\treturn this;\n\t}\n\n\tincrement()\n\t{\n\t\tthis.hiddenFilesCount++;\n\t\tthis.getValueContainer().innerHTML = this.hiddenFilesCount;\n\t\tthis.show();\n\t}\n\n\tdecrement(step: number = 1)\n\t{\n\t\tthis.hiddenFilesCount -= step;\n\t\tthis.getValueContainer().innerHTML = this.hiddenFilesCount;\n\t\tif (this.hiddenFilesCount <= 0)\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\tonClick()\n\t{\n\t\tthis.stepNumber++;\n\t\tconst itemsCount = Math.min(30, this.stepValue * this.stepNumber);\n\t\tthis.decrement(itemsCount);\n\t\tEventEmitter.emit(this, 'onGetMore', {itemsCount: itemsCount});\n\t}\n\n\tshow()\n\t{\n\t\tdelete this.getContainer().style.display;\n\t}\n\n\thide()\n\t{\n\t\tthis.getContainer().style.display = 'none';\n\t}\n}\n","import {ajax, Loc, Uri} from 'main.core';\n\nexport default class Backend\n{\n\tstatic urlSelect = '/bitrix/tools/disk/uf.php?action=selectFile&SITE_ID=' +\n\t\tLoc.getMessage('SITE_ID') + '&dialog2=Y&ACTION=SELECT&MULTI=Y';\n\n\tstatic getSelectedFile(fileId, fileName, dialogName)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.get(\n\t\t\t\tUri.addParam(this.urlSelect, {\n\t\t\t\t\tACTION: 'none',\n\t\t\t\t\tMULTI: 'Y',\n\t\t\t\t\tID: ['E', fileId].join(''),\n\t\t\t\t\tNAME: fileName,\n\t\t\t\t\twish: 'fakemove',\n\t\t\t\t\tdialogName: dialogName\n\t\t\t\t}),\n\t\t\t\tresolve\n\t\t\t);\n\t\t});\n\t}\n\n\tstatic loadFolder(fileId, fileName, dialogName)\n\t{\n\t\tconst targetID = fileId;\n\t\tconst libLink = Uri.addParam(\n\t\t\t[\n\t\t\t\tBX.DiskFileDialog.obCurrentTab[dialogName].link\n\t\t\t\t\t.replace('/index.php', '')\n\t\t\t\t\t.replace('/files/lib/', '/files/'),\n\t\t\t\t'element/upload',\n\t\t\t\ttargetID\n\t\t\t].join('/'),\n\t\t\t{\n\t\t\t\tuse_light_view: 'Y',\n\t\t\t\tAJAX_CALL: 'Y',\n\t\t\t\tSIMPLE_UPLOAD: 'Y',\n\t\t\t\tIFRAME: 'Y',\n\t\t\t\tsessid: BX.bitrix_sessid(),\n\t\t\t\tSECTION_ID: targetID,\n\t\t\t\tCHECK_NAME: fileName\n\t\t\t}\n\t\t);\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.loadJSON(libLink, {}, resolve);\n\t\t});\n\t}\n\n\tstatic getSelectedData(dialogName)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.get(\n\t\t\t\tUri.addParam(this.urlSelect, {\n\t\t\t\t\tdialogName: dialogName\n\t\t\t\t}),\n\t\t\t\tresolve\n\t\t\t)\n\t\t})\n\t}\n\n\tstatic getSelectedCloudData(dialogName, service)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.get(\n\t\t\t\tUri.addParam(this.urlSelect, {\n\t\t\t\t\tcloudImport: 1,\n\t\t\t\t\tservice: service,\n\t\t\t\t\tdialogName: dialogName\n\t\t\t\t}),\n\t\t\t\tresolve\n\t\t\t)\n\t\t})\n\t}\n\n\tstatic moveFile(id, targetFolderId)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tBX.Disk.ajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl: BX.Disk.addToLinkParam('/bitrix/tools/disk/uf.php', 'action', 'moveUploadedFile'),\n\t\t\t\tdata: {\n\t\t\t\t\tattachedId: id,\n\t\t\t\t\ttargetFolderId: targetFolderId\n\t\t\t\t},\n\t\t\t\tonsuccess: resolve\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic getMetaDataForCreatedFileInUf(id)\n\t{\n\t\treturn ajax.runAction(\n\t\t\t'disk.api.file.getMetaDataForCreatedFileInUf',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tid: id\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tstatic renameAction(id, newName)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.post(\n\t\t\t\t'/bitrix/tools/disk/uf.php?action=renameFile',\n\t\t\t\t{\n\t\t\t\t\tnewName: newName,\n\t\t\t\t\tattachedId: id,\n\t\t\t\t\tsessid: Loc.getMessage('bitrix_sessid')\n\t\t\t\t},\n\t\t\t\tresolve\n\t\t\t)\n\t\t})\n\t}\n\n\tstatic deleteAction(id)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.post(\n\t\t\t\t'/bitrix/tools/disk/uf.php?action=deleteFile',\n\t\t\t\t{\n\t\t\t\t\tattachedId: id,\n\t\t\t\t\tsessid: Loc.getMessage('bitrix_sessid')\n\t\t\t\t},\n\t\t\t\tresolve\n\t\t\t)\n\t\t})\n\t}\n}","import {Cache, Tag, Text, Type, Dom, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Menu} from 'main.popup';\nimport type {ItemSavedType} from './item-type';\nimport Backend from '../backend';\n\nexport default class Item extends EventEmitter\n{\n\tid: string;\n\tdata: ItemSavedType;\n\tcache = new Cache.MemoryCache();\n\tproperties = {\n\t\tpluggedIn: false\n\t};\n\n\tconstructor(itemData: ItemSavedType)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('Disk:UF:');\n\t\tthis.id = String(itemData['ID']);\n\n\t\tthis.setData(itemData);\n\t\tthis.subscribe('onMoved', this.onMoved.bind(this))\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetFileId(): string\n\t{\n\t\treturn this.data.FILE_ID;\n\t}\n\n\tgetData(key:?string)\n\t{\n\t\tif (key)\n\t\t{\n\t\t\treturn this.data[key];\n\t\t}\n\t\treturn this.data;\n\t}\n\n\tgetAllIds()\n\t{\n\t\treturn [this.getId(), ['n', this.data.FILE_ID].join('')];\n\t}\n\n\tsetData(data)\n\t{\n\t\tthis.data = data;\n\t}\n\n\tsetPluggedIn(value: boolean = true): boolean\n\t{\n\t\tthis.properties.pluggedIn = (value === true);\n\t}\n\n\tisPluggedIn()\n\t{\n\t\treturn this.properties.pluggedIn;\n\t}\n\n\tgetContainer(): Element\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\tconst name = Text.encode(this.data['NAME']);\n\t\t\tlet extension = Text.encode(this.data['EXTENSION']).toLowerCase();\n\n\t\t\tswitch (extension) {\n\t\t\t\tcase 'pptx':\n\t\t\t\t\textension = 'ppt';\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn Tag.render`\n\t\t<div class=\"disk-file-thumb disk-file-thumb-file disk-file-thumb--${extension}\" onclick=\"${this.onClick.bind(this)}\">\n\t\t\t<div data-bx-role=\"icon\" class=\"ui-icon ui-icon-file-${extension} disk-file-thumb-icon\"><i></i></div>\n\t\t\t<div data-bx-role=\"name\" class=\"disk-file-thumb-text\">${name}</div>\n\t\t\t<div class=\"disk-file-thumb-btn-box\">\n\t\t\t\t<div class=\"disk-file-thumb-btn-close\" onclick=\"${this.onClickDelete.bind(this)}\"></div>\n\t\t\t\t<div class=\"disk-file-thumb-btn-more\" data-bx-role=\"more\" onclick=\"${this.onClickMore.bind(this)}\"></div>\n\t\t\t</div>\n\t\t</div>`;\n\t\t});\n\t}\n\n\trename(newName: string)\n\t{\n\t\tthis.data['NAME'] = newName;\n\t\tif (this.hasContainer())\n\t\t{\n\t\t\tthis.getContainer().querySelector('[data-bx-role=\"name\"]').innerHTML = Text.encode(this.data['NAME']);\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tconst keys = this.cache.keys();\n\t\tkeys.forEach((key) => {\n\t\t\tconst node = this.cache.get(key);\n\t\t\tif (Type.isDomNode(node) && node.parentNode)\n\t\t\t{\n\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t}\n\t\t\tthis.cache.delete(key);\n\t\t});\n\n\t\tthis.emit('onDestroy');\n\t}\n\n\thasContainer(): boolean\n\t{\n\t\treturn this.cache.has('container');\n\t}\n\n\tgetMenu(): Menu\n\t{\n\t\tlet extension = this.getData('NAME').split('.').pop();\n\t\textension = (extension === this.getData('NAME') ? '' : ['.', extension].join(''));\n\t\tconst fullName = String(this.getData('NAME'));\n\t\tconst cleanName = fullName.substring(0, fullName.length - extension.length);\n\n\t\treturn this.cache.remember('menu', () => {\n\t\t\tconst moreButton = this.getContainer().querySelector('div[data-bx-role=\\'more\\']');\n\t\t\tconst contextMenu = new Menu({\n\t\t\t\tid: `crm-tunnels-menu-${Text.getRandom().toLowerCase()}`,\n\t\t\t\tbindElement: moreButton,\n\t\t\t\titems: ([\n\t\t\t\t\tthis.isPluggedIn() ? {\n\t\t\t\t\t\tdataset: {bxRole: 'insertIntoTheText'},\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ITEM_MENU_INSERT_INTO_THE_TEXT'),\n\t\t\t\t\t\tonclick : (event, item) => {\n\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\tthis.onClick(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t} : null,\n\t\t\t\t\t{\n\t\t\t\t\t\tdataset: {bxRole: 'deleteFile'},\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ITEM_MENU_DELETE'),\n\t\t\t\t\t\tonclick: (event) => {\n\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\tthis.onClickDelete(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t/*TODO For the Future\n\t\t\t\t\t   (this.data['CAN_UPDATE'] === true && this.data['EDITABLE'] === true ? {\n\t\t\t\t\t\ttext:  Loc.getMessage('WDUF_ITEM_MENU_EDIT'),\n\t\t\t\t\t\tclassName: 'menu-popup-item-edit',\n\t\t\t\t\t\tonclick: (event) => {\n\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\tthis.onClickEdit(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t} : null),*/\n\t\t\t\t\t(this.data['CAN_RENAME'] === true ? {\n\t\t\t\t\t\tdataset: {bxRole: 'renameFile'},\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ITEM_MENU_RENAME'),\n\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\thtml:\n\t\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t\t`<textarea class=\"disk-file-popup-rename-file-textarea\"\n\t\t\t\t\t\t\t\t\t\t\tname=\"rename\" onkeydown=\"if(event.keyCode===13){ BX.fireEvent(event.target.parentNode.querySelector('input[name=save]'), 'click'); }\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"${Text.encode(cleanName)}\">${Text.encode(cleanName)}</textarea>`,\n\t\t\t\t\t\t\t\t\t\t`<div class=\"ui-btn-container ui-btn-container-center\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"button\" class=\"ui-btn ui-btn-sm ui-btn-primary\" name=\"save\" value=\"${Loc.getMessage('WDUF_ITEM_MENU_RENAME_SAVE')}\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"button\" class=\"ui-btn ui-btn-sm ui-btn-link\" value=\"${Loc.getMessage('WDUF_ITEM_MENU_RENAME_CANCEL')}\">\n\t\t\t\t\t\t\t\t\t\t</div>`\n\t\t\t\t\t\t\t\t\t].join(''),\n\t\t\t\t\t\t\t\tclassName: 'menu-popup-item-rename-form',\n\t\t\t\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\t\t\t\tif (Type.isDomNode(event.target) && event.target.type === 'button')\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tif (event.target.name === 'save')\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tthis.onRenamed([item.getContainer().querySelector('textarea').value, extension].join(''));\n\t\t\t\t\t\t\t\t\t\t\tthis.clearMenu();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t]\n\t\t\t\t\t} : null),\n\t\t\t\t\t{\n\t\t\t\t\t\tdelimiter : true,\n\t\t\t\t\t\ttext: [\n\t\t\t\t\t\t\tLoc.getMessage('WDUF_ITEM_MENU_FILE'),\n\t\t\t\t\t\t\tText.encode(this.data['SIZE'])\n\t\t\t\t\t\t].join(' ')\n\t\t\t\t\t},\n\t\t\t\t\t(this.data['CAN_MOVE'] === true ? {\n\t\t\t\t\t\tdataset: {bxRole: 'moveFile'},\n\t\t\t\t\t\ttext: Text.encode(this.data['STORAGE']),\n\t\t\t\t\t\tclassName: 'menu-popup-item-storage',\n\t\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\t\tevent['counter'] = (event['counter'] ?? 1) + 1;\n\t\t\t\t\t\t\tcontextMenu.close();\n\t\t\t\t\t\t\tthis.onClickMoveTo(event, item);\n\t\t\t\t\t\t}\n\t\t\t\t\t} : {\n\t\t\t\t\t\ttext: Text.encode(this.data['STORAGE']),\n\t\t\t\t\t\tclassName: 'menu-popup-item-storage',\n\t\t\t\t\t})\n\t\t\t\t].\n\t\t\t\tfilter(preItem => preItem !== null)),\n\t\t\t\tangle: true,\n\t\t\t\toffsetLeft: 9\n\t\t\t});\n\t\t\treturn contextMenu;\n\t\t});\n\t}\n\n\tclearMenu()\n\t{\n\t\tif (this.cache.has('menu'))\n\t\t{\n\t\t\tthis.cache.get('menu').destroy();\n\t\t\tthis.cache.delete('menu');\n\t\t}\n\t}\n\n\tonClick(event: MouseEvent)\n\t{\n\t\tthis.emit('onClick');\n\t}\n\n\tonClickDelete(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tthis.emit('onDelete');\n\t\tthis.destroy();\n\t\tBackend.deleteAction(this.getId());\n\t}\n\n\tonClickMore(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tthis.getMenu().show();\n\t}\n\n\tonClickEdit()\n\t{\n\n\t}\n\n\tonClickMoveTo(element_id, name, row)\n\t{\n\t\tconst result = EventEmitter.emit(BX.DiskFileDialog, 'onFileNeedsToMove', [this]);\n\t\treturn result.length > 0;\n\t}\n\n\tonMoved({data})\n\t{\n\t\tthis.data['STORAGE'] = data;\n\t\tthis.clearMenu();\n\t}\n\n\tonRenamed(newName)\n\t{\n\t\tif (this.getData('NAME') === newName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.rename(newName);\n\t\tBackend.renameAction(this.getId(), newName);\n\t}\n\n\t//region HTMLEditor functions\n\tgetHTMLForHTMLEditor(tagId: String)\n\t{\n\t\treturn `<span contenteditable=\"false\" data-bx-file-id=\"${this.data.ID}\" id=\"${tagId}\" style=\"color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;\">${Text.encode(this.data.NAME)}</span>`;\n\t}\n\t//endregion\n\n\tstatic detect()\n\t{\n\t\treturn true;\n\t}\n}\n","import {Cache, Tag, Text} from 'main.core';\nimport Item from './item';\nimport type {ItemSavedType} from './item-type';\n\nexport default class ItemImage extends Item\n{\n\tid: string;\n\tdata: ItemSavedType;\n\tcache = new Cache.MemoryCache();\n\n\tsetData(data)\n\t{\n\t\tthis.data = data;\n\t\tthis.data.BIG_REVIEW_URL = this.data.PREVIEW_URL.replace(/\\&(width|height)\\=\\d+/gi, '');\n\t}\n\n\tgetContainer(): Element\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\tconst name = Text.encode(this.data['NAME']);\n\t\t\tconst extension = Text.encode(this.data['EXTENSION']).toLowerCase();\n\n\t\t\treturn Tag.render`\n\t\t<div class=\"disk-file-thumb disk-file-thumb-preview\" onclick=\"${this.onClick.bind(this)}\">\n\t\t\t<div style=\"background-image: url('${this.data['PREVIEW_URL']}'); background-size: cover;\" class=\"disk-file-thumb-image\"></div>\n\t\t\t<div data-bx-role=\"icon\" class=\"ui-icon ui-icon-file-${extension} disk-file-thumb-icon\"><i></i></div>\n\t\t\t<div data-bx-role=\"name\" class=\"disk-file-thumb-text\">${name}</div>\n\t\t\t<div class=\"disk-file-thumb-btn-box\">\n\t\t\t\t<div class=\"disk-file-thumb-btn-close\" onclick=\"${this.onClickDelete.bind(this)}\"></div>\n\t\t\t\t<div class=\"disk-file-thumb-btn-more\" data-bx-role=\"more\" onclick=\"${this.onClickMore.bind(this)}\"></div>\n\t\t\t</div>\n\t\t</div>`;\n\t\t});\n\t}\n\n\tgetHTMLForHTMLEditor(tagId: String)\n\t{\n\t\treturn `<img style=\"max-width: 90%;\" data-bx-file-id=\"${this.data.ID}\" id=\"${tagId}\" src=\"${this.data.BIG_REVIEW_URL}\" />`\n\t}\n\n\tstatic detect(itemData: ItemSavedType)\n\t{\n\t\treturn !!itemData['PREVIEW_URL'];\n\t}\n}\n","import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport FileController from './file-controller';\nimport Item from '../items/item';\nimport ItemImage from '../items/item-image';\n\nlet justCounter = 0;\n\nexport default class FileParser {\n\tid: String;\n\thtmlEditor;\n\titems: Map<Item>;\n\ttag: string = '[DISK FILE ID=#id#]';\n\tregexp: RegExp = /\\[(?:DOCUMENT ID|DISK FILE ID)=([n0-9]+)\\]/ig;\n\n\tconstructor(fileController: FileController)\n\t{\n\t\tthis.id = ['diskfile' + justCounter++].join('_');\n\t\tthis.items = fileController.items;\n\t}\n\n\tgetInterface()\n\t{\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tinit: (htmlEditor) => {\n\t\t\t\tthis.htmlEditor = htmlEditor;\n\t\t\t},\n\t\t\tparse: this.parse.bind(this),\n\t\t\tunparse: this.unparse.bind(this),\n\t\t};\n\t}\n\n\thasInterface()\n\t{\n\t\treturn this.regexp !== null && this.tag !== null;\n\t}\n\n\tsetParams({tag, regexp})\n\t{\n\t\tif (Type.isStringFilled(tag) && tag !== 'null')\n\t\t{\n\t\t\tthis.tag = tag;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.tag = null;\n\t\t}\n\n\t\tif (Type.isStringFilled(regexp) && regexp !== 'null')\n\t\t{\n\t\t\tthis.regexp = new RegExp(regexp);\n\t\t}\n\t\telse if (regexp instanceof RegExp)\n\t\t{\n\t\t\tthis.regexp = regexp;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.regexp = null;\n\t\t}\n\t}\n\n\tinsertFile(id: string)\n\t{\n\t\tconst item = this.items.get(String(id));\n\t\tif (item)\n\t\t{\n\t\t\tconst bbDelimiter = item instanceof ItemImage ? '\\n' : ' ';\n\t\t\tconst htmlDelimiter = item instanceof ItemImage ? '<br>' : '&nbsp;';\n\t\t\tEventEmitter.emit(this.htmlEditor, 'OnInsertContent', [\n\t\t\t\tbbDelimiter + this.getItemBBCode(id) + bbDelimiter,\n\t\t\t\thtmlDelimiter + this.getItemHTML(id) + htmlDelimiter\n\t\t\t]);\n\t\t}\n\t}\n\n\tgetItemBBCode(id: String)\n\t{\n\t\treturn this.tag.replace('#id#', id);\n\t}\n\n\tgetItemHTML(id: String)\n\t{\n\t\tconst item = this.items.get(String(id));\n\t\tif (item)\n\t\t{\n\t\t\treturn item.getHTMLForHTMLEditor(this.htmlEditor.SetBxTag(false, {tag: this.id, fileId: id, itemId: item.getId()}));\n\t\t}\n\t\treturn null;\n\t}\n\n\tdeleteFile(fileId)\n\t{\n\t\tif (!this.items.has(fileId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fileIds = this.items.get(fileId).getAllIds();\n\n\t\tif (this.htmlEditor.GetViewMode() === 'wysiwyg')\n\t\t{\n\t\t\tconst doc = this.htmlEditor.GetIframeDoc();\n\n\t\t\tfor (let ii in this.htmlEditor.bxTags)\n\t\t\t{\n\t\t\t\tif (this.htmlEditor.bxTags.hasOwnProperty(ii)\n\t\t\t\t\t&& typeof this.htmlEditor.bxTags[ii] === 'object'\n\t\t\t\t\t&& this.htmlEditor.bxTags[ii]['tag'] === this.id\n\t\t\t\t\t&& fileIds.indexOf(String(this.htmlEditor.bxTags[ii]['itemId'])) >= 0\n\t\t\t\t\t&& doc.getElementById(ii)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst node = doc.getElementById(ii);\n\t\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.htmlEditor.SaveContent();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst content = this.htmlEditor.GetContent().replace(this.regexp,\n\t\t\t\tfunction(str, foundId) {\n\t\t\t\t\treturn fileIds.indexOf(foundId) >= 0 ? '' : str;\n\t\t\t\t}\n\t\t\t);\n\t\t\tthis.htmlEditor.SetContent(content);\n\t\t\tthis.htmlEditor.Focus();\n\t\t}\n\t}\n\n\tparse(content)\n\t{\n\t\tif (!this.regexp.test(content))\n\t\t{\n\t\t\treturn content;\n\t\t}\n\t\tcontent = content.replace(\n\t\t\tthis.regexp,\n\t\t\tfunction(str, id)\n\t\t\t{\n\t\t\t\tconst foundedItem = this.items.has(id) ? this.items.get(id) : [...this.items.values()].find((item: Item) => {\n\t\t\t\t\treturn item.getAllIds().indexOf(id) >= 0;\n\t\t\t\t});\n\t\t\t\tif (foundedItem)\n\t\t\t\t{\n\t\t\t\t\treturn foundedItem.getHTMLForHTMLEditor(this.htmlEditor.SetBxTag(false, {tag: this.id, fileId: id, itemId: foundedItem.getId()}))\n\t\t\t\t}\n\t\t\t\treturn str;\n\t\t\t}.bind(this)\n\t\t);\n\t\treturn content;\n\t}\n\n\tunparse(bxTag, {node})\n\t{\n\t\tconst id = bxTag.itemId;\n\n\t\tif (this.items.has(id))\n\t\t{\n\t\t\treturn this.getItemBBCode(id);\n\t\t}\n\t\treturn '';\n\t}\n}","import Item from './item';\nimport ItemImage from './item-image';\n\nconst itemMappings = [\n\tItem,\n\tItemImage,\n];\n\nexport default function getItem(itemData): Item\n{\n\tlet itemClassName = Item;\n\titemMappings.forEach((itemClass) => {\n\t\tif (itemClass.detect(itemData))\n\t\t{\n\t\t\titemClassName = itemClass;\n\t\t}\n\t});\n\treturn new itemClassName(itemData);\n}","import {Type, Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport DefaultController from './default-controller';\nimport ItemMoreButton from '../items/item-more';\nimport FileParser from './file-parser';\nimport type {ItemSavedType, ItemNew} from '../items/item-type';\nimport getItem from '../items/index';\n\nexport default class FileController extends DefaultController {\n\tmaxVisibleCount = 10;\n\tparser: FileParser;\n\tprefixHTMLNode = 'disk-attach-';\n\n\tconstructor({id, container, fieldName, multiple, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"placeholder\"]'),\n\t\t\teventObject: eventObject});\n\t\tthis.items = new Map();\n\t\tthis.multiple = multiple !== false;\n\t\tthis.fieldName = fieldName;\n\t\tif (!container.querySelector('[data-bx-role=\"placeholder\"]'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.isPluggedIn())\n\t\t{\n\t\t\tthis.buildInHTMLEditor();\n\t\t}\n\t}\n\n\tbuildInHTMLEditor()\n\t{\n\t\tif (this.getParser().hasInterface())\n\t\t{\n\t\t\tEventEmitter.emit(this.eventObject, 'OnParserRegister', this.getParser().getInterface());\n\t\t}\n\t\tEventEmitter.subscribe(this.eventObject, 'onReinitializeBefore', ({data: [text, fileData]}) => {\n\t\t\tlet manualClearing = true;\n\t\t\tif (fileData)\n\t\t\t{\n\t\t\t\tObject.values(fileData).forEach((uf) => {\n\t\t\t\t\tif (uf &&\n\t\t\t\t\t\tuf['USER_TYPE_ID'] === \"disk_file\"\n\t\t\t\t\t\t&& uf['FIELD_NAME'].replace('[]', '') === this.fieldName.replace('[]', '')\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst items = [];\n\t\t\t\t\t\t\tif (Type.isArray(uf['VALUE']))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tuf['VALUE'].forEach((id) => {\n\t\t\t\t\t\t\t\t\tlet node = document.querySelector(['#', this.prefixHTMLNode, id].join(''));\n\t\t\t\t\t\t\t\t\tif (!node) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tconst img = node.querySelector('img');\n\t\t\t\t\t\t\t\t\tconst infoNode = img || node;\n\t\t\t\t\t\t\t\t\tconst name = infoNode.hasAttribute(\"data-title\") ? infoNode.getAttribute(\"data-title\")\n\t\t\t\t\t\t\t\t\t\t: (infoNode.hasAttribute(\"data-bx-title\") ? infoNode.getAttribute(\"data-bx-title\") : '');\n\n\t\t\t\t\t\t\t\t\tconst itemData = {\n\t\t\t\t\t\t\t\t\t\tID: id,\n\t\t\t\t\t\t\t\t\t\tFILE_ID: infoNode.getAttribute(\"bx-attach-file-id\"),\n\t\t\t\t\t\t\t\t\t\t// IS_LOCKED: boolean\n\t\t\t\t\t\t\t\t\t\t// IS_MARK_DELETED: boolean\n\t\t\t\t\t\t\t\t\t\t// EDITABLE: boolean\n\t\t\t\t\t\t\t\t\t\t// FROM_EXTERNAL_SYSTEM: boolean\n\n\t\t\t\t\t\t\t\t\t\tCAN_RESTORE: false,\n\t\t\t\t\t\t\t\t\t\tCAN_UPDATE: false,\n\t\t\t\t\t\t\t\t\t\tCAN_RENAME: false,\n\t\t\t\t\t\t\t\t\t\tCAN_MOVE: false,\n\n\t\t\t\t\t\t\t\t\t\tCOPY_TO_ME_URL: null,\n\t\t\t\t\t\t\t\t\t\tDELETE_URL: null,\n\t\t\t\t\t\t\t\t\t\tDOWNLOAD_URL: null,\n\t\t\t\t\t\t\t\t\t\tEDIT_URL: null,\n\t\t\t\t\t\t\t\t\t\tVIEW_URL: null,\n\t\t\t\t\t\t\t\t\t\tPREVIEW_URL: null,\n\t\t\t\t\t\t\t\t\t\tBIG_PREVIEW_URL: null,\n\n\t\t\t\t\t\t\t\t\t\tEXTENSION: name.split('.').pop(),\n\t\t\t\t\t\t\t\t\t\tNAME: name,\n\t\t\t\t\t\t\t\t\t\tSIZE: infoNode.getAttribute(\"data-bx-size\"),\n\t\t\t\t\t\t\t\t\t\tSIZE_BYTES: infoNode.getAttribute(\"data-bx-size\"),\n\t\t\t\t\t\t\t\t\t\tSTORAGE: 'disk',\n\t\t\t\t\t\t\t\t\t\t// width: node.getAttribute(\"data-bx-width\"),\n\t\t\t\t\t\t\t\t\t\t// height: node.getAttribute(\"data-bx-height\"),\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\tif (img)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\titemData['PREVIEW_URL'] = img.hasAttribute('data-bx-preview') && Type.isStringFilled(img.hasAttribute('data-bx-preview'))\n\t\t\t\t\t\t\t\t\t\t\t? img.getAttribute('data-bx-preview') : (\n\t\t\t\t\t\t\t\t\t\t\t\timg.hasAttribute('data-thumb-src') && Type.isStringFilled(img.getAttribute('data-thumb-src'))\n\t\t\t\t\t\t\t\t\t\t\t\t\t? img.getAttribute('data-thumb-src') :\n\t\t\t\t\t\t\t\t\t\t\t\t\timg.src\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\titemData['BIG_PREVIEW_URL'] = img.hasAttribute(\"data-bx-src\")\n\t\t\t\t\t\t\t\t\t\t\t? img.getAttribute(\"data-bx-src\") :\n\t\t\t\t\t\t\t\t\t\t\timg.getAttribute('data-src')\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\titems.push(itemData);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.set(items);\n\t\t\t\t\t\t\tmanualClearing = false;\n\t\t\t\t\t\t}catch (e) {\n\t\t\t\t\t\t\tconsole.log('e: ', e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (manualClearing !== false)\n\t\t\t{\n\t\t\t\tthis.clear();\n\t\t\t}\n\t\t});\n\t}\n\n\tset(values: Array<ItemSavedType>): Promise\n\t{\n\t\tthis.clear();\n\n\t\tlet counter = this.maxVisibleCount;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tvalues.forEach((itemData: ItemSavedType) => {\n\t\t\t\tconst item = this.addItem(itemData);\n\t\t\t\tcounter--;\n\t\t\t\tif (counter > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.appendNode(item);\n\t\t\t\t}\n\t\t\t\telse if (counter === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.container.appendChild(this.getItemMore().reset().getContainer());\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.getItemMore().increment();\n\t\t\t\t}\n\t\t\t});\n\t\t\tresolve();\n\t\t});\n\t}\n\n\tclear()\n\t{\n\t\tthis.items.forEach((item) => {\n\t\t\titem.destroy();\n\t\t});\n\n\t\tthis.container.innerHTML = '';\n\t}\n\n\t// to add into DOM fom uploader\n\tadd(itemData: ItemNew, itemContainer: ?Element)\n\t{\n\t\tthis.multiple || this.clear();\n\t\tconst item = this.addItem(itemData);\n\t\tthis.appendNode(item, itemContainer);\n\t\treturn item;\n\t}\n\n\taddItem(itemData: ItemSavedType)\n\t{\n\t\tconst item = getItem(itemData);\n\n\t\tlet input = this.getContainer()\n\t\t\t.querySelector(`[data-bx-role=\"reserve-item\"][value=\"${item.getId()}\"]`);\n\t\tif (!input)\n\t\t{\n\t\t\tinput = document.createElement('INPUT');\n\t\t\tinput.name = this.fieldName;\n\t\t\tinput.type = 'hidden';\n\t\t\tinput.value = item.getId();\n\t\t\tthis.container.appendChild(input);\n\t\t}\n\t\titem.subscribe('onDelete', () => {\n\t\t\tif (input && input.parentNode)\n\t\t\t{\n\t\t\t\tinput.parentNode.removeChild(input);\n\t\t\t}\n\t\t\tEventEmitter.emit(this, 'OnItemDelete', item);\n\t\t});\n\n\t\tif (this.isPluggedIn())\n\t\t{\n\t\t\tEventEmitter.emit(this.eventObject, 'onShowControllers:File:Increment');\n\t\t\tif (this.getParser().hasInterface())\n\t\t\t{\n\t\t\t\titem.setPluggedIn();\n\t\t\t\titem.subscribe('onClick', () => {\n\t\t\t\t\tthis.getParser().insertFile(item.getId());\n\t\t\t\t});\n\t\t\t\titem.subscribe('onDelete', () => {\n\t\t\t\t\tthis.getParser().deleteFile(item.getId());\n\t\t\t\t});\n\t\t\t\titem.subscribe('onDestroy', () => {\n\t\t\t\t\tEventEmitter.emit(this.eventObject, 'onShowControllers:File:Decrement');\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.items.set(item.getId(), item);\n\t\treturn item;\n\t}\n\n\tgetItem(id)\n\t{\n\t\treturn this.items.get(id);\n\t}\n\n\t/*@\n\tAppends node to the container\n\t */\n\tappendNode(item: Item, itemContainer: ?Element)\n\t{\n\t\tif (itemContainer)\n\t\t{\n\t\t\tif (itemContainer.parentNode)\n\t\t\t{\n\t\t\t\titemContainer.parentNode.replaceChild(item.getContainer(), itemContainer)\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.container.appendChild(item.getContainer());\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tgetItemMore(): ItemMoreButton\n\t{\n\t\treturn this.cache.remember('moreButton', () => {\n\t\t\tconst res = new ItemMoreButton();\n\t\t\tEventEmitter.subscribe(res, 'onGetMore', this.showMoreItems.bind(this));\n\t\t\treturn res;\n\t\t});\n\t}\n\n\tshowMoreItems({data:{itemsCount}})\n\t{\n\t\tconst timeoutCounter = itemsCount;\n\t\tconst itemMoreNode = this.getItemMore().getContainer();\n\t\titemMoreNode.style.opacity = '0';\n\t\titemMoreNode.style.visibility = 'hidden';\n\t\tthis.items.forEach((item: Item) => {\n\t\t\tif (itemsCount > 0)\n\t\t\t{\n\t\t\t\tif (!item.hasContainer())\n\t\t\t\t{\n\t\t\t\t\titemsCount--;\n\t\t\t\t\tconst node = document.createElement('DIV');\n\t\t\t\t\titemMoreNode.parentNode.insertBefore(node, itemMoreNode);\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tDom.style(item.getContainer(), 'opacity', '0');\n\t\t\t\t\t\tDom.addClass(item.getContainer(), 'disk-file-thumb--animate');\n\t\t\t\t\t\tDom.style(item.getContainer(), 'opacity', '');\n\t\t\t\t\t\tnode.parentNode.replaceChild(item.getContainer(), node);\n\t\t\t\t\t\titem.getContainer().addEventListener('transitionend', () => {\n\t\t\t\t\t\t\tDom.removeClass(item.getContainer(), 'disk-file-thumb--animate');\n\t\t\t\t\t\t})\n\t\t\t\t\t}, (timeoutCounter - itemsCount) * 100);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (itemsCount <= 0)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\titemMoreNode.style.opacity = '';\n\t\t\t\titemMoreNode.style.visibility = '';\n\t\t\t}, timeoutCounter * 100 + 100);\n\t\t}\n\t}\n\n\tgetParser()\n\t{\n\t\tthis.parser = this.parser || new FileParser(this);\n\t\treturn this.parser;\n\t}\n}\n","import {Loc} from 'main.core';\nimport {Menu, MenuItem} from 'main.popup';\nimport DefaultController from \"./default-controller\";\nimport Options from \"../options\";\n\nexport default class SettingsController extends DefaultController\n{\n\tallowEditNode: ?Element;\n\tallowGridNode: ?Element;\n\tconstructor({container, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"setting\"]'),\n\t\t\teventObject: eventObject\n\t\t});\n\t\tif (this.getContainer())\n\t\t{\n\t\t\tthis.getContainer().addEventListener('click', this.show.bind(this))\n\t\t\tthis.allowEditNode = container.querySelector('input[data-bx-role=\"settings-allow-edit\"]');\n\t\t\tthis.allowGridNode = container.querySelector('input[data-bx-role=\"settings-allow-grid\"]');\n\t\t}\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.popup = new Menu({\n\t\t\t\tbindElement: this.getContainer(),\n\t\t\t\tclassName: 'disk-uf-file-popup-settings',\n\t\t\t\titems: [\n\t\t\t\t\tthis.allowEditNode ? {\n\t\t\t\t\t\tdataset: {bxRole: 'allowEdit'},\n\t\t\t\t\t\tclassName: this.allowEditNode.checked ? 'menu-popup-item-take' : '',\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ALLOW_EDIT'),\n\t\t\t\t\t\tonclick: function(event, item: MenuItem) {\n\t\t\t\t\t\t\tthis.allowEditNode.checked = !this.allowEditNode.checked;\n\t\t\t\t\t\t\tif (this.allowEditNode.checked)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.getContainer().classList.add('menu-popup-item-take');\n\t\t\t\t\t\t\t\titem.getContainer().classList.remove('menu-popup-no-icon');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.getContainer().classList.remove('menu-popup-item-take');\n\t\t\t\t\t\t\t\titem.getContainer().classList.add('menu-popup-no-icon');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t} : null,\n\t\t\t\t\t{\n\t\t\t\t\t\tdataset: {bxRole: 'allowGrid'},\n\t\t\t\t\t\tclassName: this.allowGridNode.checked ? 'menu-popup-item-take' : '',\n\t\t\t\t\t\ttext: Loc.getMessage('WDUF_ALLOW_COLLAGE'),\n\t\t\t\t\t\tonclick: function(event, item: MenuItem) {\n\t\t\t\t\t\t\tthis.allowGridNode.checked = !this.allowGridNode.checked;\n\t\t\t\t\t\t\tif (this.allowGridNode.dataset.bxSave === 'Y')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.userOptions.save('disk', 'disk.uf.file', this.allowGridNode.dataset.bxName, (this.allowGridNode.checked ? 'grid' : '.default'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (this.allowGridNode.checked)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.getContainer().classList.add('menu-popup-item-take');\n\t\t\t\t\t\t\t\titem.getContainer().classList.remove('menu-popup-no-icon');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.getContainer().classList.remove('menu-popup-item-take');\n\t\t\t\t\t\t\t\titem.getContainer().classList.add('menu-popup-no-icon');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: this.buildDocumentServiceTextLabel(),\n\t\t\t\t\t\titems: this.buildSubMenuWithDocumentServices(),\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tangle: true,\n\t\t\t\toffsetTop: -16,\n\t\t\t\toffsetLeft: 16,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tdelete this.popup;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\tthis.popup.show()\n\t}\n\n\tbuildDocumentServiceTextLabel(): string\n\t{\n\t\tlet currentService = BX.Disk.getDocumentService();\n\t\tif (!currentService && BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\tcurrentService = 'onlyoffice';\n\t\t}\n\t\telse if (!currentService)\n\t\t{\n\t\t\tcurrentService = 'l';\n\t\t}\n\n\t\tconst name = Options.getDocumentHandler(currentService).name;\n\n\t\treturn Loc.getMessage('DISK_UF_FILE_EDIT_SERVICE_LABEL', { '#NAME#' : name});\n\t}\n\n\tbuildSubMenuWithDocumentServices(): Array<Object>\n\t{\n\t\tlet items = [];\n\n\t\tOptions.getDocumentHandlers().forEach(item => {\n\t\t\titems.push({\n\t\t\t\ttext: item.name,\n\t\t\t\tdataset: {\n\t\t\t\t\tcode: item.code,\n\t\t\t\t},\n\t\t\t\tonclick: (event, item: MenuItem) => {\n\t\t\t\t\tBX.Disk.saveDocumentService(item.dataset.code);\n\n\t\t\t\t\titem.getMenuWindow().getParentMenuItem().setText(this.buildDocumentServiceTextLabel());\n\t\t\t\t\titem.getMenuWindow().getPopupWindow().close();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\treturn items;\n\t}\n\n\thide()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n \t\t}\n\t}\n}","import DefaultController from './default-controller';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport Backend from '../backend';\nimport type {ItemSavedType, ItemUploadedType} from \"../items/item-type\";\n\nexport default class DocumentController extends DefaultController\n{\n\tconstructor({container, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"document-area\"]'),\n\t\t\teventObject: eventObject\n\t\t});\n\t\tif (this.getContainer())\n\t\t{\n\t\t\tthis.getContainer()\n\t\t\t\t.querySelectorAll('[data-bx-handler]')\n\t\t\t\t.forEach((item) => {\n\t\t\t\t\titem.addEventListener('click', () => {\n\t\t\t\t\t\tthis.createDocument(item.getAttribute('data-bx-handler'));\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t}\n\t}\n\n\tcreateDocument(documentType)\n\t{\n\t\tif (!BX.Disk.getDocumentService() && BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\tBX.Disk.saveDocumentService('onlyoffice');\n\t\t}\n\t\telse if (!BX.Disk.getDocumentService())\n\t\t{\n\t\t\tBX.Disk.saveDocumentService('l');\n\t\t}\n\n\t\tlet insertDocumentIntoUf = function (extendedFileData) {\n\t\t\tvar parts = extendedFileData.object.name.split('.');\n\t\t\tparts.pop();\n\t\t\tsetTimeout(() => {\n\t\t\t\tEventEmitter.emit(this,\n\t\t\t\t\t'onFileIsCreated',\n\t\t\t\t\t{itemData: this.convertToItemSavedType(extendedFileData)});\n\t\t\t}, 200);\n\t\t}.bind(this);\n\n\t\tif (BX.Disk.Document.Local.Instance.isSetWorkWithLocalBDisk())\n\t\t{\n\t\t\tBX.Disk.Document.Local.Instance.createFile({\n\t\t\t\ttype: documentType\n\t\t\t}).then(function (response) {\n\t\t\t\tinsertDocumentIntoUf(response);\n\t\t\t}.bind(this));\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet createProcess = new BX.Disk.Document.CreateProcess({\n\t\t\ttypeFile: documentType,\n\t\t\tserviceCode: BX.Disk.getDocumentService(),\n\t\t\tonAfterSave: function(response, extendedFileData) {\n\t\t\t\tif (response.status !== 'success')\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!extendedFileData)\n\t\t\t\t{\n\t\t\t\t\tBackend\n\t\t\t\t\t\t.getMetaDataForCreatedFileInUf(response.object.id)\n\t\t\t\t\t\t.then(function({data}) {\n\t\t\t\t\t\t\tinsertDocumentIntoUf(data);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tinsertDocumentIntoUf(extendedFileData);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tcreateProcess.start();\n\t}\n\n\tconvertToItemSavedType(extendedFileData) :ItemSavedType\n\t{\n\t\treturn {\n\t\t\tID: 'n' + extendedFileData.object.id,\n\t\t\tIS_LOCKED: false,\n\t\t\tIS_MARK_DELETED: false,\n\n\t\t\tEDITABLE: false,\n\t\t\tFROM_EXTERNAL_SYSTEM: false,\n\n\t\t\tCAN_RESTORE: false,\n\t\t\tCAN_UPDATE: true,\n\t\t\tCAN_RENAME: true,\n\t\t\tCAN_MOVE:  true,\n\n\t\t\tCOPY_TO_ME_URL: null,\n\t\t\tDELETE_URL: null,\n\t\t\tDOWNLOAD_URL: null,\n\t\t\tEDIT_URL: null,\n\t\t\tVIEW_URL: extendedFileData.link,\n\t\t\tPREVIEW_URL: null,\n\t\t\tBIG_PREVIEW_URL: null,\n\n\t\t\tEXTENSION: extendedFileData.object.extension,\n\t\t\tNAME: extendedFileData.object.name,\n\t\t\tSIZE: extendedFileData.object.size,\n\t\t\tSIZE_BYTES: extendedFileData.object.sizeInt,\n\t\t\tSTORAGE: extendedFileData.folderName\n\t\t};\n\t}\n}\n\n","import DefaultController from './default-controller';\n\nexport default class PanelController extends DefaultController\n{\n\tconstructor({container, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"control-panel\"]'),\n\t\t\teventObject: eventObject\n\t\t});\n\t}\n}","import {Uri, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport DefaultController from './default-controller';\nimport Backend from '../backend';\nimport type {ItemSelectedType, ItemSavedType} from \"../items/item-type\";\n\nlet justCounter = 0;\nexport default class FileSelector extends DefaultController\n{\n\topened: boolean = false;\n\tdialogName: string;\n\tconstructor({container, eventObject})\n\t{\n\t\tconst node = container.querySelector('[data-bx-role=\"file-local-controller\"]') ||\n\t\t\tcontainer.querySelector('.diskuf-selector-link');\n\n\t\tsuper({\n\t\t\tcontainer: node,\n\t\t\teventObject: eventObject\n\t\t});\n\n\t\tthis.dialogName = ['selectFile', justCounter++].join('-');\n\t\tif (!this.getContainer())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.getContainer().addEventListener('click', this.onClick.bind(this));\n\t\tthis.openSection = this.openSection.bind(this);\n\t\tthis.selectFile = this.selectFile.bind(this);\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t}\n\n\tonClick()\n\t{\n\t\tBackend\n\t\t\t.getSelectedData(this.dialogName)\n\t\t\t.then(() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tBX.DiskFileDialog.obCallback[this.dialogName] = {saveButton: this.selectFile};\n\t\t\t\t\tBX.DiskFileDialog.openDialog(this.dialogName);\n\t\t\t\t}, 10)\n\t\t\t});\n\t}\n\n\topenSection({data: [link, name]})\n\t{\n\t\tif (name === this.dialogName)\n\t\t{\n\t\t\tBX.DiskFileDialog.target[name] = Uri.addParam(link, {dialog2: 'Y'});\n\t\t}\n\t}\n\n\tselectFile(tab, path, selected)\n\t{\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\tfor (let id in selected)\n\t\t{\n\t\t\tif (selected.hasOwnProperty(id))\n\t\t\t{\n\t\t\t\tEventEmitter.emit(this, 'onUploadDone', {itemData: this.convertToItemSavedType(selected[id])});\n\t\t\t}\n\t\t}\n\t}\n\n\tconvertToItemSavedType(item: ItemSelectedType) :ItemSavedType\n\t{\n\t\treturn {\n\t\t\tID: item.id,\n\t\t\tIS_LOCKED: false,\n\t\t\tIS_MARK_DELETED: false,\n\n\t\t\tEDITABLE: false,\n\t\t\tFROM_EXTERNAL_SYSTEM: false,\n\n\t\t\tCAN_RESTORE: false,\n\t\t\tCAN_RENAME: false,\n\t\t\tCAN_UPDATE: false,\n\t\t\tCAN_MOVE: false,\n\n\t\t\tCOPY_TO_ME_URL: null,\n\t\t\tDELETE_URL: null,\n\t\t\tDOWNLOAD_URL: null,\n\t\t\tEDIT_URL: null,\n\t\t\tVIEW_URL: null,\n\t\t\tPREVIEW_URL: (item.previewUrl ? item.previewUrl : ''),\n\t\t\tBIG_PREVIEW_URL: (item.previewUrl ? item.previewUrl.replace(/\\&(width|height)=\\d+/gi, '') : null),\n\n\t\t\tEXTENSION: item.ext,\n\t\t\tNAME: item.name,\n\t\t\tSIZE: item.size,\n\t\t\tSIZE_BYTES: item.sizeInt,\n\t\t\tSTORAGE: item['storage'] ?? Loc.getMessage('WDUF_MY_DISK'),\n\t\t};\n\t}\n}\n","import {Tag, Text} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport 'ui.progressround';\nimport ItemNew from \"./item-new\";\n\nexport default class ItemNewSelectedCloud extends ItemNew\n{\n\tconstructor(fileId, fileObject: ItemNewSelectedCloud)\n\t{\n\t\tsuper(fileId, fileObject);\n\n\t\tBX.Disk.ExternalLoader.startLoad({\n\t\t\tfile: {\n\t\t\t\tid: this.id,\n\t\t\t\tname: this.object.name,\n\t\t\t\tservice: this.object.service\n\t\t\t},\n\t\t\tonFinish: (newData) => {\n\t\t\t\tEventEmitter.emit(this, 'onUploadDone', [newData]);\n\t\t\t},\n\t\t\tonProgress: (progress) => {\n\t\t\t\tthis.onUploadProgress({compatData: [{}, progress]});\n\t\t\t}\n\t\t});\n\t}\n\n\tonClickDelete(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tEventEmitter.emit(this, 'onDelete', [this]);\n\n\t\tdelete this.container;\n\t}\n\n\tonUploadDone({compatData: [fileObject, {file}]})\n\t{\n\t}\n\n\tonUploadError({compatData: [fileObject]})\n\t{\n\t\tEventEmitter.emit(this, 'onUploadError', [fileObject.file]);\n\t\tthis.progress.getContainer().parentNode.removeChild(this.progress.getContainer());\n\t\tthis.container.classList.add('disk-file-upload-error')\n\t}\n}\n","import {Uri} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport Backend from '../backend';\nimport type {ItemSavedCloudType, ItemSavedType, ItemUploadedType, ItemSelectedCloudType} from \"../items/item-type\";\nimport ItemNewSelectedCloud from \"../items/item-new-selected-cloud\";\nimport DefaultController from \"./default-controller\";\n\nlet justCounter = 0;\nexport default class FileSelectorCloud extends DefaultController\n{\n\tdialogName: string;\n\tservices: Array<Element> = [];\n\titems: Map = new Map;\n\n\tconstructor({container, eventObject})\n\t{\n\t\tsuper({\n\t\t\tcontainer: container.querySelector('[data-bx-role=\"placeholder\"]'),\n\t\t\teventObject: eventObject\n\t\t});\n\n\t\tif (!this.getContainer())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tcontainer\n\t\t\t.querySelectorAll('[data-bx-role=\"file-external-controller\"]')\n\t\t\t.forEach((item) => {\n\t\t\t\tthis.services.push(item)\n\t\t\t});\n\t\tcontainer\n\t\t\t.querySelectorAll('.diskuf-selector-link-cloud')\n\t\t\t.forEach((item) => {\n\t\t\t\tthis.services.push(item)\n\t\t\t});\n\n\t\tthis.eventObject = eventObject;\n\t\tthis.dialogName = ['selectFileCloud', justCounter++].join('-');\n\t\tthis.services.forEach((node) => {\n\t\t\tnode.addEventListener('click', this.onClick.bind(this));\n\t\t});\n\t\tthis.openSection = this.openSection.bind(this);\n\t\tthis.selectFile = this.selectFile.bind(this);\n\t}\n\n\tonClick(event: MouseEvent)\n\t{\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\tthis.currentService = event.currentTarget.getAttribute('data-bx-doc-handler');\n\n\t\tBackend\n\t\t\t.getSelectedCloudData(this.dialogName, this.currentService)\n\t\t\t.then(() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tBX.DiskFileDialog.obCallback[this.dialogName] = {saveButton: this.selectFile};\n\t\t\t\t\tBX.DiskFileDialog.openDialog(this.dialogName);\n\t\t\t\t}, 10)\n\t\t\t});\n\t}\n\n\topenSection({data: [link, name]})\n\t{\n\t\tif (name === this.dialogName)\n\t\t{\n\t\t\tBX.DiskFileDialog.target[name] = Uri.addParam(link, {dialog2: 'Y'});\n\t\t}\n\t}\n\n\tselectFile(tab, path, selected)\n\t{\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\tfor (let id in selected)\n\t\t{\n\t\t\tif (selected.hasOwnProperty(id) && selected[id].type === 'file')\n\t\t\t{\n\t\t\t\tthis.catchFile(selected[id], this.currentService);\n\t\t\t}\n\t\t}\n\t\tthis.currentService = null;\n\t}\n\n\tcatchFile(fileObject: ItemSelectedCloudType, service)\n\t{\n\t\tif (this.items.has(fileObject.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfileObject['service'] = fileObject['provider'] || service;\n\t\tconst item = new ItemNewSelectedCloud(fileObject.id, fileObject);\n\t\tthis.items.set(item.id, item);\n\t\tEventEmitter.subscribe(item, 'onUploadDone', ({data: [itemData: ItemUploadedType]}) => {\n\t\t\tif (this.items.has(item.id))\n\t\t\t{\n\t\t\t\tthis.items.delete(item.id);\n\t\t\t\tEventEmitter.emit(this, 'onUploadDone', {\n\t\t\t\t\titemData: this.convertToItemSavedType(itemData),\n\t\t\t\t\titemContainer: item.getContainer(),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tEventEmitter.subscribe(item, 'onUploadError', () => {\n\t\t\tthis.items.delete(item.id);\n\t\t\tEventEmitter.emit(this, 'onUploadError', {itemContainer: item.getContainer()});\n\t\t});\n\t\tEventEmitter.subscribe(item, 'onDelete', () => {\n\t\t\tthis.items.delete(item.id);\n\t\t\tthis.container.removeChild(item.getContainer());\n\t\t});\n\t\tthis.container.appendChild(item.getContainer());\n\t}\n\n\tconvertToItemSavedType(item: ItemSavedCloudType) :ItemSavedType\n\t{\n\t\tconst extension = item.name.split('.').pop().toLowerCase();\n\t\tconst itemData = {\n\t\t\tID: item.ufId,\n\t\t\tIS_LOCKED: false,\n\t\t\tIS_MARK_DELETED: false,\n\n\t\t\tEDITABLE: false,\n\t\t\tFROM_EXTERNAL_SYSTEM: true,\n\n\t\t\tCAN_RESTORE: false,\n\t\t\tCAN_RENAME: false,\n\t\t\tCAN_UPDATE: false,\n\t\t\tCAN_MOVE: false,\n\n\t\t\tCOPY_TO_ME_URL: null,\n\t\t\tDELETE_URL: null,\n\t\t\tDOWNLOAD_URL: null,\n\t\t\tEDIT_URL: null,\n\t\t\tVIEW_URL: null,\n\t\t\tPREVIEW_URL: (item.previewUrl ? item.previewUrl : ''),\n\t\t\tBIG_PREVIEW_URL: (item.previewUrl ? item.previewUrl.replace(/\\&(width|height)=\\d+/gi, '') : null),\n\n\t\t\tEXTENSION: extension === item.name ? '' : extension,\n\t\t\tNAME: item.name,\n\t\t\tSIZE: item.sizeFormatted,\n\t\t\tSIZE_BYTES: item.size,\n\t\t\tSTORAGE: item.storage,\n\t\t};\n\t\treturn itemData;\n\t}\n}\n","import {Uri, Loc} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport Backend from '../backend';\nimport Item from \"../items/item\";\n\nexport default class FileMover\n{\n\tstatic subscribed = false;\n\tstatic instance = null;\n\tdialogName: string = 'moveFile';\n\titem: ?Item;\n\ttimeout: ?number;\n\n\tconstructor()\n\t{\n\t\tthis.openSection = this.openSection.bind(this);\n\t\tthis.loadFolder = this.loadFolder.bind(this);\n\t\tthis.stopLoadingFolder = this.stopLoadingFolder.bind(this);\n\t\tthis.checkFileName = this.checkFileName.bind(this);\n\t\tthis.onApply = this.onApply.bind(this);\n\t\tthis.onCancel = this.onCancel.bind(this);\n\t}\n\n\tfire(item: Item): void\n\t{\n\t\tif (this.item !== null && this.item !== item)\n\t\t{\n\t\t\tthis.onCancel();\n\t\t}\n\n\t\tthis.item = item;\n\t\tBackend.getSelectedFile(\n\t\t\titem.getFileId(),\n\t\t\titem.getData('NAME'),\n\t\t\tthis.dialogName\n\t\t)\n\t\t.then(() => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tBX.DiskFileDialog.obCallback[this.dialogName] = {saveButton: this.onApply, cancelButton: this.onCancel};\n\t\t\t\tBX.DiskFileDialog.openDialog(this.dialogName);\n\t\t\t}, 10)\n\t\t});\n\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\t//EventEmitter.subscribe(BX.DiskFileDialog, 'loadItemsDone', this.checkFileName);\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'selectItem', this.loadFolder);\n\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'unSelectItem', this.stopLoadingFolder);\n\t}\n\n\topenSection({data: [link, someDialogName]}): void\n\t{\n\t\tif (someDialogName === this.dialogName)\n\t\t{\n\t\t\tBX.DiskFileDialog.target[someDialogName] = Uri.addParam(link, {dialog2: 'Y'});\n\t\t}\n\t}\n\n\tloadFolder({data: [element, itemId: string, someDialogName]}): void\n\t{\n\t\tif (someDialogName !== this.dialogName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tBackend\n\t\t\t.loadFolder(itemId.substr(1), this.item.getData('NAME'), this.dialogName)\n\t\t\t.then((result) => {\n\t\t\t\tconst documentExists = (result.permission === true && result[\"okmsg\"] !== '');\n\n\t\t\t\tif (this.timeout > 0)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.timeout);\n\t\t\t\t}\n\t\t\t\tthis.timeout = setTimeout(() => {\n\t\t\t\t\tif (documentExists)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.DiskFileDialog.showNotice(Loc.getMessage('WDUF_FILE_IS_EXISTS'), this.dialogName);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.DiskFileDialog.closeNotice(this.dialogName);\n\t\t\t\t\t}\n\t\t\t\t}, 200);\n\t\t\t});\n\t}\n\n\tstopLoadingFolder({data: someData}): void\n\t{\n\t\tif (this.timeout > 0)\n\t\t{\n\t\t\tclearTimeout(this.timeout);\n\t\t}\n\t\tthis.timeout = setTimeout(this.checkFileName, 200);\n\t}\n\n\tonApply(tab, path, selected, folderByPath)\n\t{\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\t//EventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItemsDone', this.checkFileName);\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'selectItem', this.loadFolder);\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'unSelectItem', this.stopLoadingFolder);\n\n\t\tif (!this.item)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst id = this.item.getId();\n\t\tlet moved = false;\n\n\t\tconst moveQuery = (id, targetFolderId, sectionProperties, sectionPath) => {\n\t\t\tBackend\n\t\t\t\t.moveFile(id, targetFolderId)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tif (!response || response.status !== 'success')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.Disk.showModalWithStatusAction(response);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.showMovedFile(id, sectionProperties, sectionPath);\n\t\t\t\t});\n\t\t};\n\n\t\tlet sectionPath, sectionProperties;\n\t\tfor (let i in selected)\n\t\t{\n\t\t\tif (selected.hasOwnProperty(i) && selected[i].type === 'folder')\n\t\t\t{\n\t\t\t\tsectionPath = tab.name + selected[i].path;\n\t\t\t\tsectionProperties = { sectionID : i, iblockID : tab.iblock_id };\n\n\t\t\t\tmoveQuery(id, selected[i].id, sectionProperties, sectionPath);\n\t\t\t\tmoved = true;\n\t\t\t}\n\t\t}\n\n\t\tif (!moved)\n\t\t{\n\t\t\tsectionPath = tab.name;\n\t\t\tsectionProperties = { sectionID : tab.section_id, iblockID : tab.iblock_id };\n\t\t\tif (!!folderByPath && !!folderByPath.path && folderByPath.path !== '/')\n\t\t\t{\n\t\t\t\tsectionPath += folderByPath.path;\n\t\t\t\tsectionProperties.sectionID = folderByPath.id;\n\t\t\t\tif(!!folderByPath)\n\t\t\t\t{\n\t\t\t\t\tmoveQuery(id, folderByPath.id, sectionProperties, sectionPath);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tcheckFileName(someDialogName): void\n\t{\n\t\tif (this.timeout > 0)\n\t\t{\n\t\t\tclearTimeout(this.timeout);\n\t\t}\n\n\t\tif (someDialogName !== this.dialogName || !this.item)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fileName = this.item.getData('NAME');\n\t\tlet exist = false;\n\n\t\tfor (let i in BX.DiskFileDialog.obItems[this.dialogName])\n\t\t{\n\t\t\tif (BX.DiskFileDialog.obItems[this.dialogName].hasOwnProperty(i)\n\t\t\t\t&& BX.DiskFileDialog.obItems[this.dialogName][i]['name'] === fileName)\n\t\t\t{\n\t\t\t\texist = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (exist)\n\t\t{\n\t\t\tBX.DiskFileDialog.showNotice(Loc.getMessage('WDUF_FILE_IS_EXISTS'), this.dialogName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.DiskFileDialog.closeNotice(this.dialogName);\n\t\t}\n\t}\n\n\tshowMovedFile(id, sectionProperties, sectionPath): void\n\t{\n\t\tif (this.item)\n\t\t{\n\t\t\tthis.item.emit('onMoved', sectionPath);\n\t\t}\n\t\tthis.item = null;\n\t}\n\n\tonCancel(): void\n\t{\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItems', this.openSection);\n\t\t//EventEmitter.unsubscribe(BX.DiskFileDialog, 'loadItemsDone', this.checkFileName);\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'selectItem', this.loadFolder);\n\t\tEventEmitter.unsubscribe(BX.DiskFileDialog, 'unSelectItem', this.stopLoadingFolder);\n\t\tthis.item = null;\n\t\tif (this.timeout > 0)\n\t\t{\n\t\t\tclearTimeout(this.timeout);\n\t\t}\n\t\tthis.timeout = null;\n\t}\n\n\tstatic subscribe(): void\n\t{\n\t\tif (BX.DiskFileDialog.subscribed !== true)\n\t\t{\n\t\t\tBX.DiskFileDialog.subscribed = true;\n\t\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'onFileNeedsToMove', (event: BaseEvent) => {\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\tFileMover.getInstance().fire([...event.getData()].shift());\n\t\t\t})\n\t\t}\n\t}\n\n\tstatic getInstance(): FileMover\n\t{\n\t\tif (this.instance === null)\n\t\t{\n\t\t\tthis.instance = new FileMover();\n\t\t}\n\t\treturn this.instance;\n\t}\n}\n","import {Tag, Type} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport FileUploader from './file-uploader';\nimport DefaultController from './controllers/default-controller';\nimport Options from \"./options\";\nimport FileSelector from \"./controllers/file-selector\";\nimport FileSelectorCloud from \"./controllers/file-selector-cloud\";\nimport type {ItemSavedType} from './items/item-type'\n\nlet justCounter = 0;\nfunction _camelToSNAKE(obj)\n{\n\tvar o = {}, i, k;\n\tfor (i in obj)\n\t{\n\t\tk = i.replace(/(.)([A-Z])/g, \"$1_$2\").toUpperCase();\n\t\to[k] = obj[i];\n\t\to[i] = obj[i];\n\t}\n\n\treturn o;\n}\n\nexport default class FormBrief extends DefaultController {\n\tid: string;\n\tfileUploader: FileUploader;\n\tfieldName: string;\n\tfileSelector: FileSelector;\n\tfileSelectorCloud: FileSelectorCloud;\n\n\tconstructor({id, fieldName, container, eventObject, input})\n\t{\n\t\tsuper({container, eventObject});\n\t\tthis.id = id;\n\t\tthis.fieldName = fieldName;\n\t\tthis.input = input;\n\n\t\tif (!this.input)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.agent = BX.Uploader.getInstance({\n\t\t\tid: id,\n\t\t\tstreams: 1,\n\t\t\tallowUpload: 'A',\n\t\t\tuploadFormData: 'N',\n\t\t\tuploadMethod: 'immediate',\n\t\t\tuploadFileUrl: Options.urlUpload,\n\t\t\tshowImage: false,\n\t\t\tsortItems: false,\n\t\t\tdropZone: null,\n\t\t\tinput: this.input,\n\t\t\tpasteFileHashInForm: false,\n\t\t});\n\n\t\tthis.onUploadDone = this.onUploadDone.bind(this);\n\t\tthis.onUploadError = this.onUploadError.bind(this);\n\n\t\tEventEmitter.subscribe(this.agent, \"onFileIsUploaded\", ({compatData: [itemId, item, params]}) => {\n\t\t\tthis.onUploadDone(item, params);\n\t\t});\n\t\tEventEmitter.subscribe(this.agent, \"onFileIsUploadedWithError\", ({compatData: [itemId, item, params]}) => {\n\t\t\tthis.onUploadError(item, params);\n\t\t});\n\n\t\tthis.fileSelector = new FileSelector(this);\n\t\tEventEmitter.subscribe(this.fileSelector, 'onUploadDone', ({data: {itemData}}) => {\n\t\t\tthis.onSelectionIsDone(itemData);\n\t\t});\n\t\tthis.fileSelectorCloud = new FileSelectorCloud(this);\n\t\tEventEmitter.subscribe(this.fileSelectorCloud, 'onUploadDone', ({data: {itemData}}) => {\n\t\t\tthis.onSelectionIsDone(itemData);\n\t\t});\n\t}\n\n\tonSelectionIsDone(item: ItemSavedType)\n\t{\n\t\tconst attrs = {\n\t\t\tid: 'disk-edit-attach' + item['ID'],\n\t\t\t'bx-agentFileId': item['ID']\n\t\t};\n\t\tif (item[\"FILE_ID\"])\n\t\t\tattrs[\"bx-attach-file-id\"] = 'n' + item[\"FILE_ID\"];\n\t\tconst node = Tag.render`<input type=\"hidden\" name=\"${this.fieldName}\" value=\"${item['ID']}\">`;\n\t\tfor (let ii in attrs)\n\t\t{\n\t\t\tif (attrs.hasOwnProperty(ii))\n\t\t\t{\n\t\t\t\tnode.setAttribute(ii, attrs[ii]);\n\t\t\t}\n\t\t}\n\t\tthis.getContainer().appendChild(node);\n\n\t\tlet res = {\n\t\t\telement_id: item['ID'],\n\t\t\telement_name: item['NAME'],\n\t\t\telement_url: item['PREVIEW_URL'],\n\t\t\tstorage: item['STORAGE']\n\t\t};\n\t\tEventEmitter.emit(this.getEventObject(),\n\t\t\t'OnFileUploadSuccess',\n\t\t\tnew BaseEvent({compatData: [res, {}, null, {\n\t\t\t\tid: justCounter++,\n\t\t\t\tname: item['NAME'],\n\t\t\t\tsize: item['SIZE'],\n\t\t\t\tsizeInt: item['SIZE_INT'],\n\t\t\t}]})\n\t\t);\n\n\t}\n\n\tonUploadDone(item, result)\n\t{\n\t\tif (result[\"file\"] && result[\"file\"][\"attachId\"] !== result[\"file\"][\"id\"])\n\t\t{\n\t\t\tresult[\"file\"][\"id\"] = result[\"file\"][\"attachId\"];\n\t\t\tdelete result[\"file\"][\"attachId\"];\n\t\t}\n\n\t\tconst file = _camelToSNAKE(result[\"file\"]);\n\t\tconst attrs = {\n\t\t\tid: 'disk-edit-attach' + file.id,\n\t\t\t'bx-agentFileId': item.id\n\t\t};\n\t\tif (file[\"XML_ID\"])\n\t\t\tattrs[\"bx-attach-xml-id\"] = file[\"XML_ID\"];\n\t\tif (file[\"FILE_ID\"])\n\t\t\tattrs[\"bx-attach-file-id\"] = 'n' + file[\"FILE_ID\"];\n\t\tif (file['FILE_TYPE'])\n\t\t\tattrs[\"bx-attach-file-type\"] = file[\"FILE_TYPE\"];\n\t\tfile.element_id = file.id;\n\t\tconst node = Tag.render`<input type=\"hidden\" name=\"${this.fieldName}\" value=\"${file.id}\">`;\n\t\tfor (let ii in attrs)\n\t\t{\n\t\t\tif (attrs.hasOwnProperty(ii))\n\t\t\t{\n\t\t\t\tnode.setAttribute(ii, attrs[ii]);\n\t\t\t}\n\t\t}\n\t\tthis.getContainer().appendChild(node);\n\t\tthis.onFileIs(item, file);\n\t}\n\t\n\tonFileIs(item, file)\n\t{\n\t\tlet res = {\n\t\t\telement_id : file.element_id,\n\t\t\telement_name : (file.element_name || item.name),\n\t\t\telement_url: (file.element_name || file.previewUrl || file.preview_url),\n\t\t\tstorage: 'disk'\n\t\t};\n\t\tEventEmitter.emit(this.getEventObject(),\n\t\t\t'OnFileUploadSuccess',\n\t\t\tnew BaseEvent({compatData: [res, this, item.file, item]}));\n\t}\n\n\tonUploadError(item, params)\n\t{\n\t\tBX.onCustomEvent(this.getEventObject(), 'OnFileUploadFailed', [this, item.file, item]);\n\t}\n}","import {Loc, Type} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport FileUploader from './file-uploader';\nimport FileController from './controllers/file-controller';\nimport DefaultController from './controllers/default-controller';\nimport SettingsController from './controllers/settings-controller';\nimport DocumentController from './controllers/document-controller';\nimport PanelController from './controllers/panel-controller';\nimport FileSelector from \"./controllers/file-selector\";\nimport FileSelectorCloud from \"./controllers/file-selector-cloud\";\nimport FileMover from \"./controllers/file-mover\";\nimport {Ears} from 'ui.ears';\nimport FormBrief from './form-brief'\n\nexport default class Form extends DefaultController {\n\tid: string;\n\tfilesController: FileController;\n\tfileUploader: FileUploader;\n\tfileSelector: FileSelector;\n\tfileSelectorCloud: FileSelectorCloud;\n\tfieldName: string;\n\n\tconstructor({id, fieldName, container, eventObject, input, parserParams}, values: ?Array)\n\t{\n\t\tsuper({container, eventObject});\n\t\tthis.id = id;\n\t\tthis.fieldName = fieldName;\n\t\tthis.input = input;\n\n\t\tif (parserParams)\n\t\t{\n\t\t\tthis.getFileController()\n\t\t\t\t.getParser()\n\t\t\t\t.setParams(parserParams);\n\t\t}\n\n\t\tthis.init();\n\n\t\tif (values.length > 0)\n\t\t{\n\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowControllers', 'show');\n\t\t\tthis.show(values);\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tif (this.input)\n\t\t{\n\t\t\tthis.getFilesUploader();\n\t\t}\n\n\t\tthis.initDocumentController();\n\t\tthis.settingsController = new SettingsController(this, {});\n\t\tthis.panelController = new PanelController(this);\n\t\tthis.fileSelector = new FileSelector(this);\n\t\tEventEmitter.subscribe(this.fileSelector, 'onUploadDone', ({data: {itemData}}) => {\n\t\t\tthis.getFileController().add(itemData);\n\t\t});\n\t\tthis.fileSelectorCloud = new FileSelectorCloud(this);\n\t\tEventEmitter.subscribe(this.fileSelectorCloud, 'onUploadDone', ({data: {itemData, itemContainer}}) => {\n\t\t\tthis.getFileController().add(itemData, itemContainer);\n\t\t});\n\n\t\tconst switcher = (event: BaseEvent) => {\n\t\t\tlet status = Type.isArray(event.getData()) ? event.getData().shift() : event.getData();\n\t\t\tif (status === 'show')\n\t\t\t{\n\t\t\t\tthis.show();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t};\n\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onCollectControllers', (event) => {\n\t\t\tevent.data[this.fieldName] = {\n\t\t\t\ttag: this.getFileController().isPluggedIn() ? this.getFileController().getParser().tag : null,\n\t\t\t\tvalues: []\n\t\t\t};\n\t\t\tthis.getContainer()\n\t\t\t\t.querySelectorAll(`input[type=\"hidden\"][name=\"${this.fieldName}\"]`)\n\t\t\t\t.forEach((nodeItem) => {\n\t\t\t\t\tevent.data[this.fieldName].values.push(nodeItem.value);\n\t\t\t\t});\n\t\t});\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onShowControllers', switcher);\n\t\tEventEmitter.subscribe(this.getEventObject(), 'DiskLoadFormController', switcher);\n\n\t\t// (new Ears({\n\t\t// \tcontainer: this.getContainer().querySelector('[data-bx-role=\"control-panel-main-actions\"]'),\n\t\t// \tnoScrollbar: false,\n\t\t// \tclassName: 'disk-documents-ears'\n\t\t// })).init();\n\n\t\tEventEmitter.subscribe(EventEmitter.GLOBAL_TARGET, 'disk.uf.file:create:thumb:upload', ({data}) => {\n\t\t\tthis.show();\n\t\t\tthis.getFilesUploader().addTestThumb(data);\n\t\t});\n\t\tEventEmitter.subscribe(EventEmitter.GLOBAL_TARGET, 'disk.uf.file:create:thumb:error', () => {\n\t\t\tthis.show();\n\t\t\tthis.getFilesUploader().addTestErrorThumb();\n\t\t});\n\t}\n\n\tinitDocumentController()\n\t{\n\t\tthis.documentController = new DocumentController({container: this.getContainer(), eventObject: this.getEventObject()});\n\t\tEventEmitter.subscribe(this.documentController, 'onFileIsCreated', ({data: {itemData}}) => {\n\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowControllers', 'show');\n\t\t\tthis.getFileController().add(itemData);\n\t\t});\n\n\t\tif (!this.documentController.isRelevant())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\telse if (!this.isPluggedIn())\n\t\t{\n\t\t\tthis.documentController.show();\n\t\t\treturn;\n\t\t}\n\t\tif (this.eventObject.dataset.bxDiskDocumentButton !== 'added')\n\t\t{\n\t\t\tthis.eventObject.dataset.bxDiskDocumentButton = 'added';\n\n\t\t\tconst node = document.createElement('DIV');\n\t\t\tnode.addEventListener('click', () => {\n\t\t\t\tconst container = node.closest('[data-id=\"disk-document\"]');\n\t\t\t\tif (container && container.hasAttribute('data-bx-button-status'))\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onHideDocuments');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowControllers', 'hide');\n\t\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onShowDocuments', 'show')\n\t\t\t\t}\n\t\t\t});\n\t\t\tnode.innerHTML = '<i></i>' + Loc.getMessage('WDUF_CREATE_DOCUMENT');\n\n\t\t\tEventEmitter.emit(this.eventObject, 'OnAddButton', [{BODY: node, ID: 'disk-document'}, 'file']);\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'onShowDocuments', () => {\n\t\t\t\tconst container = node.closest('[data-id=\"disk-document\"]');\n\t\t\t\tif (container)\n\t\t\t\t{\n\t\t\t\t\tcontainer.setAttribute('data-bx-button-status', 'active');\n\t\t\t\t}\n\t\t\t});\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'onHideDocuments', () => {\n\t\t\t\tconst container = node.closest('[data-id=\"disk-document\"]');\n\t\t\t\tif (container)\n\t\t\t\t{\n\t\t\t\t\tcontainer.removeAttribute('data-bx-button-status');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onShowDocuments', () => {\n\t\t\tsuper.show();\n\t\t\tthis.documentController.show();\n\t\t});\n\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onHideDocuments', () => {\n\t\t\tsuper.hide();\n\t\t\tthis.documentController.hide();\n\t\t});\n\t\tconst switcher = ({data}) => {\n\t\t\tif (data === 'show')\n\t\t\t{\n\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onHideDocuments');\n\t\t\t}\n\t\t};\n\t\tEventEmitter.subscribe(this.getEventObject(), 'DiskLoadFormController', switcher);\n\t\tEventEmitter.subscribe(this.getEventObject(), 'onShowControllers', switcher);\n\t}\n\n\tgetFileController(): FileController\n\t{\n\t\tif (!this.filesController)\n\t\t{\n\t\t\tthis.filesController = new FileController({\n\t\t\t\tid: this.id,\n\t\t\t\tfieldName: this.fieldName,\n\t\t\t\tcontainer: this.container,\n\t\t\t\teventObject: this.eventObject\n\t\t\t});\n\t\t}\n\t\treturn this.filesController\n\t}\n\n\tgetFilesUploader()\n\t{\n\t\tif (!this.filesUploader)\n\t\t{\n\t\t\tthis.filesUploader = new FileUploader({\n\t\t\t\tid: this.id,\n\t\t\t\tcontainer: this.container.querySelector('[data-bx-role=\"placeholder\"]'),\n\t\t\t\tdropZone: this.container,\n\t\t\t\tinput: this.input,\n\t\t\t});\n\t\t\t//Video\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'OnVideoHasCaught', (event: BaseEvent) => {\n\t\t\t\tconst fileToUpload = event.getData();\n\t\t\t\tconst onSuccess = ({data: {itemData, itemContainer, blob}}) => {\n\t\t\t\t\tif (fileToUpload === blob)\n\t\t\t\t\t{\n\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\t\t\tthis.getFileController().getParser().insertFile(itemData.ID);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\tthis.filesUploader.upload([fileToUpload]);\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t});\n\t\t\t//Image\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'OnImageHasCaught', (event: BaseEvent) => {\n\t\t\t\tconst fileToUpload = event.getData();\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst onSuccess = ({data: {itemData, itemContainer, blob}}) => {\n\t\t\t\t\t\tif (fileToUpload === blob)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onFailed);\n\t\t\t\t\t\t\tresolve({image: {src: itemData.PREVIEW_URL}, html: this.getFileController().getParser().getItemHTML(itemData.ID)});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\t\tconst onFailed = ({data: {blob}}) => {\n\t\t\t\t\t\tif (fileToUpload === blob)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onSuccess);\n\t\t\t\t\t\t\tEventEmitter.unsubscribe(this.filesUploader, 'onUploadDone', onFailed);\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadDone', onFailed);\n\t\t\t\t\tthis.filesUploader.upload([fileToUpload]);\n\t\t\t\t});\n\t\t\t});\n\t\t\tEventEmitter.subscribe(this.getEventObject(), 'onFilesHaveCaught', (event: BaseEvent) => {\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\tthis.filesUploader.upload([...event.getData()]);\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadDone', ({data: {itemData, itemContainer}}) => {\n\t\t\t\tthis.getFileController().add(itemData, itemContainer);\n\t\t\t});\n\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadIsStart', () => {\n\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onBusy', this);\n\t\t\t});\n\t\t\tEventEmitter.subscribe(this.filesUploader, 'onUploadIsDone', () => {\n\t\t\t\tEventEmitter.emit(this.getEventObject(), 'onReady', this);\n\t\t\t});\n\n\t\t}\n\t\treturn this.filesUploader;\n\t}\n\n\tgetPanelController(): PanelController\n\t{\n\t\treturn this.panelController;\n\t}\n\n\tshow(values: ?Array)\n\t{\n\t\tconst switcher = this.getContainer().parentNode.querySelector('#' + this.getContainer().id + '-switcher');\n\t\tif (switcher)\n\t\t{\n\t\t\tswitcher.parentNode.removeChild(switcher);\n\t\t}\n\t\tif (this.getFileController().isPluggedIn())\n\t\t{\n\t\t\tthis.getContainer().setAttribute('data-bx-plugged-in', 'Y');\n\t\t}\n\t\tsuper.show();\n\t\tthis.showInitialLoader();\n\t\tthis.getFileController().show();\n\t\tthis.getPanelController().show();\n\n\t\tif (values)\n\t\t{\n\t\t\tthis.getFileController()\n\t\t\t\t.set(values)\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.hideInitialLoader();\n\t\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideInitialLoader();\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tsuper.hide();\n\t\tthis.getFileController().hide();\n\t\tthis.getPanelController().hide();\n\t}\n\n\tshowInitialLoader()\n\t{\n\t}\n\n\thideInitialLoader()\n\t{\n\t}\n\n\tstatic repo = {};\n\n\tstatic getInstance(data, values)\n\t{\n\t\tif (!this.repo[data['id']])\n\t\t{\n\t\t\tthis.repo[data['id']] = new Form(data, values);\n\t\t}\n\t\treturn this.repo[data['id']];\n\t}\n\n\tstatic getBriefInstance(data)\n\t{\n\t\tif (!this.repo[data['id']])\n\t\t{\n\t\t\tthis.repo[data['id']] = new FormBrief(data, []);\n\t\t}\n\t\treturn this.repo[data['id']];\n\t}\n}\n\nsetTimeout(() => {\n\tif (BX.DiskFileDialog)\n\t{\n\t\tFileMover.subscribe();\n\t}\n}, 1000);\n","import Form from './form.js';\nimport Options from './options.js';\n\nconst add = function(params)\n{\n\tconst container = BX('diskuf-selectdialog-' + params['UID']);\n\n\tif (container && BX.isNodeInDom(container))\n\t{\n\t\tconst eventObject = container.parentNode;\n\t\tif (!container.hasAttribute(\"bx-disk-load-is-bound\"))\n\t\t{\n\t\t\tcontainer.setAttribute(\"bx-disk-load-is-bound\", \"Y\");\n\t\t\tBX.addCustomEvent(eventObject, \"DiskLoadFormController\", function (status)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tBX.Disk.UF.Options.set({urlUpload: params.urlUpload});\n\t\t\t\t\treturn BX.Disk.UF.Form.getBriefInstance({\n\t\t\t\t\t\tcontainer: container,\n\t\t\t\t\t\teventObject: container.parentNode,\n\t\t\t\t\t\tid: params.UID,\n\t\t\t\t\t\tfieldName: params.controlName,\n\t\t\t\t\t\tinput: BX.findChild(container, { className : 'diskuf-fileUploader' }, true)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tcatch(e)\n\t\t\t\t{\n\t\t\t\t\tconsole.log('Error with compatibility', e);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (!!params['values'] && params['values'].length > 0 && !params['hideSelectDialog'])\n\t\t\tBX.onCustomEvent(container.parentNode, 'DiskLoadFormController', ['show']);\n\t}\n}\nexport {\n\tForm,\n\tOptions,\n\tadd\n}\n",null]}