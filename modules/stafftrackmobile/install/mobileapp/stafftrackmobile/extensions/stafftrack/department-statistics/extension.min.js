jn.define("stafftrack/department-statistics",((t,e,s)=>{const{Loc:n}=t("loc");const{BottomSheet:a}=t("bottom-sheet");const{Color:i,Indent:r}=t("tokens");const{Area:d}=t("ui-system/layout/area");const{Box:o}=t("ui-system/layout/box");const{IconView:c,Icon:l}=t("ui-system/blocks/icon");const{H4:m}=t("ui-system/typography/heading");const{StageSelector:p,CardDesign:h}=t("ui-system/blocks/stage-selector");const{ShiftManager:g}=t("stafftrack/data-managers/shift-manager");const{OptionManager:S,OptionEnum:T}=t("stafftrack/data-managers/option-manager");const{Skeleton:f}=t("stafftrack/department-statistics/skeleton");const{SegmentButton:u}=t("stafftrack/department-statistics/segment-button");const{TodayStatistics:I}=t("stafftrack/department-statistics/today-statistics");const{MonthStatistics:D}=t("stafftrack/department-statistics/month-statistics");const{Analytics:M,StatsOpenEnum:y}=t("stafftrack/analytics");const{PureComponent:E}=t("layout/pure-component");const A="today";const C="month";class _ extends E{constructor({departments:t}){super({departments:t});this.refs={layoutWidget:null,todayStatistics:null,monthStatistics:null};const e=Number(S.getOption(T.SELECTED_DEPARTMENT_ID));this.selectedDepartment=this.getDepartmentById(e)??t[0];this.state={rangeMode:A,isLoading:true,departmentId:this.selectedDepartment.id};this.onRangeModeSelectedHandler=this.onRangeModeSelectedHandler.bind(this);void this.load();M.sendStatisticsOpen(y.DEPARTMENT)}get departments(){return this.props.departments}get departmentId(){return this.selectedDepartment.id}get departmentName(){return this.selectedDepartment.name}componentWillUnmount(){this.saveSelectedDepartment()}saveSelectedDepartment(){if(this.departmentId!==this.props.selectedDepartmentId){S.saveSelectedDepartmentId(this.departmentId)}}async load(){if(!g.hasDepartmentStatistics(this.departmentId)){this.setState({isLoading:true})}this.refs.todayStatistics?.setDepartmentId(this.departmentId);this.refs.monthStatistics?.setDepartmentId(this.departmentId);await g.getDepartmentStatistics(this.departmentId);this.setState({isLoading:false,departmentId:this.departmentId})}show(t=PageManager){void new a({component:this}).setParentWidget(t).setBackgroundColor(i.bgSecondary.toHex()).disableContentSwipe().setMediumPositionPercent(70).open().then((t=>{this.refs.layoutWidget=t}))}render(){return o({backgroundColor:i.bgSecondary},this.state.isLoading&&f(),this.renderHeader(),this.renderDepartmentSelector(),this.renderContent())}renderHeader(){const t=!this.state.isLoading;return d({isFirst:true,style:{display:t?"flex":"none",flexDirection:"row",alignItems:"center"}},c({icon:l.ARROW_TO_THE_LEFT,size:24,color:i.base4,onClick:()=>this.refs.layoutWidget.close()}),m({numberOfLines:1,ellipsize:"end",text:this.departments.length>1?n.getMessage("M_STAFFTRACK_DEPARTMENT_STATISTICS_DEPARTMENT_CHECKINS"):n.getMessage("M_STAFFTRACK_DEPARTMENT_STATISTICS_DEPARTMENT_NAME_CHECKINS",{"#NAME#":this.departmentName}),style:{flex:1,marginLeft:r.XL.toNumber()}}))}renderDepartmentSelector(){const t=!this.state.isLoading&&this.departments.length>1;return d({isFirst:true,style:{display:t?"flex":"none"}},p({testId:"stafftrack-department-selector",cardDesign:h.SECONDARY,cardBorder:true,leftIcon:l.DEPARTMENT,title:this.departmentName,onClick:()=>{this.onDepartmentSelectorClick()}}))}renderContent(){const t=!this.state.isLoading;return d({isFirst:true,style:{display:t?"flex":"none",flex:1}},this.renderStatisticsRangeMode(),this.renderTodayStatistics(),this.renderMonthStatistics())}renderStatisticsRangeMode(){return new u({segments:[{id:A,title:n.getMessage("M_STAFFTRACK_DEPARTMENT_STATISTICS_FOR_TODAY"),selected:this.state.rangeMode===A},{id:C,title:n.getMessage("M_STAFFTRACK_DEPARTMENT_STATISTICS_FOR_MONTH"),selected:this.state.rangeMode===C}],onSegmentSelected:this.onRangeModeSelectedHandler})}onRangeModeSelectedHandler(t){this.setState({rangeMode:t})}renderTodayStatistics(){return View({style:{display:this.state.rangeMode===A?"flex":"none",flex:1}},new I({departmentId:this.departmentId,layoutWidget:this.refs.layoutWidget,ref:t=>{this.refs.todayStatistics=t}}))}renderMonthStatistics(){return View({style:{display:this.state.rangeMode===C?"flex":"none",flex:1}},new D({departmentId:this.departmentId,ref:t=>{this.refs.monthStatistics=t}}))}onDepartmentSelectorClick(){this.refs.layoutWidget.openWidget("selector",{backdrop:{},title:n.getMessage("M_STAFFTRACK_DEPARTMENT_STATISTICS_SELECT_DEPARTMENT")}).then((t=>{t.setSearchEnabled(false);t.allowMultipleSelection(false);t.setItems(this.prepareDepartmentItems());t.setListener(((e,s)=>{if(e==="onSelectedChanged"){const e=parseInt(s.items[0].id,10);this.selectDepartment(e);t.close()}}))}))}prepareDepartmentItems(){return this.departments.map((t=>({id:t.id,title:t.name,useLetterImage:false,sectionCode:"departments"})))}selectDepartment(t){if(this.selectedDepartment.id===t){return}this.selectedDepartment=this.getDepartmentById(t);void this.load()}getDepartmentById(t){return this.departments.find((e=>e.id===t))}}s.exports={DepartmentStatistics:_}}));
//# sourceMappingURL=extension.map.js