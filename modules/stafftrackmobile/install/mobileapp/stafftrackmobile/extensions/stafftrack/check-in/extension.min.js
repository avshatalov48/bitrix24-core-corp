jn.define("stafftrack/check-in",((t,e,s)=>{const{Loc:i}=t("loc");const{Type:n}=t("type");const{Color:a,Indent:o}=t("tokens");const{H3:r}=t("ui-system/typography/heading");const{IconView:h,Icon:c}=t("ui-system/blocks/icon");const{Area:l}=t("ui-system/layout/area");const{Box:d}=t("ui-system/layout/box");const{ChipButton:u,ChipButtonDesign:g,ChipButtonMode:f}=t("ui-system/blocks/chips/chip-button");const{Skeleton:p}=t("stafftrack/check-in/skeleton");const{CheckInPage:M}=t("stafftrack/check-in/pages/check-in");const{DisabledCheckInPage:k}=t("stafftrack/check-in/pages/disabled-check-in");const{SettingsPage:m}=t("stafftrack/check-in/pages/settings");const{HeightManager:y}=t("stafftrack/check-in/height-manager");const{MoreMenu:I}=t("stafftrack/check-in/more-menu");const{StatisticsMenu:b}=t("stafftrack/check-in/statistics-menu");const{DateHelper:C}=t("stafftrack/date-helper");const{ShiftManager:S}=t("stafftrack/data-managers/shift-manager");const{SettingsManager:w}=t("stafftrack/data-managers/settings-manager");const{OptionManager:H,OptionEnum:A}=t("stafftrack/data-managers/option-manager");const{ShiftModel:E}=t("stafftrack/model/shift");const{MuteEnum:B}=t("stafftrack/model/counter");const{Analytics:W,CheckinOpenEnum:O,HelpdeskEnum:T}=t("stafftrack/analytics");const{PureComponent:D}=t("layout/pure-component");class N extends D{constructor(t){super(t);this.layoutWidget=this.props.layoutWidget||PageManager;this.heightManager=new y(this.layoutWidget);this.state={loading:true,config:null,options:null,shift:null,dialogInfo:{dialogName:this.props.dialogName,dialogId:this.props.dialogId},userInfo:null,counter:null,enabledBySettings:true};this.closeLayoutWidget=this.closeLayoutWidget.bind(this);this.showMoreMenu=this.showMoreMenu.bind(this);this.showStatisticsMenu=this.showStatisticsMenu.bind(this);this.openHelp=this.openHelp.bind(this);this.load=this.load.bind(this);this.settingsOpened=false;this.statisticsMenu=null;this.moreMenu=null;this.refs={checkIn:null,disabledCheckIn:null,statisticsMenu:null,moreMenu:null,continueButton:null};W.sendCheckinOpen(t.dialogId?O.CHAT:O.AVA_MENU)}get user(){return this.state.userInfo??{}}get dialogInfo(){return this.state.dialogInfo??{}}get shift(){return this.state.shift??{}}get config(){return this.state.config??{}}isCounterMuted(){return this.state.counter?.muteStatus!==B.DISABLED.toNumber()}componentDidMount(){this.bindEvents();void this.load()}componentWillUnmount(){this.unbindEvents()}bindEvents(){w.on("updated",this.load)}unbindEvents(){w.off("updated",this.load)}async load(){const t=await S.getMain(C.getCurrentDayCode());const e=BX.prop.getObject(t,"currentShift",{});const s={loading:false,enabledBySettings:w.isEnabledBySettings(),config:BX.prop.getObject(t,"config",{}),options:BX.prop.getObject(t,"options",{}),userInfo:BX.prop.getObject(t,"userInfo",{}),counter:BX.prop.getObject(t,"counter",{}),shift:new E(e)};this.heightManager.setStatus(s.shift.getStatus());this.heightManager.setEnabledBySettings(s.config.enabledBySettings);this.heightManager.updateSheetHeight();if(n.isNil(this.dialogInfo.dialogName)&&n.isNil(this.dialogInfo.dialogId)){s.dialogInfo=s.config.dialogInfo}this.setState(s,(()=>{this.handleFirstHelpView();this.handleSettingsPage()}))}render(){return d({resizableByKeyboard:true,backgroundColor:a.bgSecondary,style:{flex:1},onClick:()=>Keyboard.dismiss()},this.state.loading&&p(),!this.state.loading&&this.renderHeader(),!this.state.loading&&this.state.enabledBySettings&&this.renderCheckIn(),!this.state.loading&&!this.state.enabledBySettings&&this.renderDisabledCheckIn())}renderCheckIn(){return new M({...this.state,layoutWidget:this.layoutWidget,heightManager:this.heightManager,ref:t=>{this.refs.checkIn=t}})}renderDisabledCheckIn(){return new k({layoutWidget:this.layoutWidget,isAdmin:this.user.isAdmin,onHelpClick:this.openHelp,onDepartmentHeadChatButtonClick:this.closeLayoutWidget,userInfo:this.state.userInfo,ref:t=>{this.refs.disabledCheckIn=t}})}renderHeader(){return l({isFirst:true,style:{flexDirection:"row",justifyContent:"space-between"}},r({text:i.getMessage("M_STAFFTRACK_CHECK_IN_TITLE")}),this.renderHeaderRightIcons())}renderHeaderRightIcons(){if(this.state.enabledBySettings){return View({style:{flexDirection:"row"}},this.renderStatisticsChip(),this.renderMoreMenuIcon())}return null}renderStatisticsChip(){return View({ref:t=>{this.refs.statisticsMenu=t}},u({testId:"stafftrack-check-in-statistics",design:g.GREY,mode:f.OUTLINE,dropdown:true,compact:true,color:a.base3,text:i.getMessage("M_STAFFTRACK_CHECK_IN_STATISTICS"),onClick:this.showStatisticsMenu}))}renderMoreMenuIcon(){return View({style:{marginLeft:o.S.toNumber()},ref:t=>{this.refs.moreMenu=t}},h({size:24,icon:c.MORE,color:a.base4,onClick:this.showMoreMenu}))}showStatisticsMenu(){this.statisticsMenu??=new b({layoutWidget:this.layoutWidget,user:this.user});this.statisticsMenu.show(this.refs.statisticsMenu)}showMoreMenu(){this.moreMenu??=new I({layoutWidget:this.layoutWidget,isMuted:this.isCounterMuted(),onHelpClick:this.openHelp,isAdmin:this.user.isAdmin,hasShift:this.hasCurrentShift(),timemanAvailable:this.config.timemanAvailable});this.moreMenu.show(this.refs.moreMenu)}handleFirstHelpView(){if(H.getOption(A.IS_FIRST_HELP_VIEWED)===false){this.openHelp();H.handleFirstHelpView()}}handleSettingsPage(){if(this.props.openSettings&&!this.settingsOpened){m.show({isAdmin:this.user.isAdmin,parentLayout:this.layoutWidget});this.settingsOpened=true}}hasCurrentShift(){return n.isNumber(this.shift.id)&&this.shift.id!==0}openHelp(){helpdesk.openHelpArticle("20922794");W.sendHelpdeskOpen(this.props.dialogId?T.CHAT:T.AVA_MENU)}closeLayoutWidget(){this.layoutWidget.close()}}s.exports={CheckIn:N}}));
//# sourceMappingURL=extension.map.js