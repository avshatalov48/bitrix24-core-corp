StateMachineWorkflowActivity=function(){var e=new BizProcActivity;e.classname="StateMachineWorkflowActivity";e.Table=null;e.__l=[];e.SerializeStateMachineWorkflowActivity=e.Serialize;e.Serialize=function(){if(e.childActivities.length>0)e.Properties["InitialStateName"]=e.childActivities[0]["Name"];return e.SerializeStateMachineWorkflowActivity()};e.LineMouseOver=function(e){var t=this.id;t=t.substring(0,t.length-2);for(var l=1;l<=3;l++){var i=document.getElementById(t+"."+l);i.style.backgroundColor="#ee0000";i.style.zIndex=parseInt(i.style.zIndex)+1e3}};e.LineMouseOut=function(e){var t=this.id;t=t.substring(0,t.length-2);for(var l=1;l<=3;l++){var i=document.getElementById(t+"."+l);i.style.backgroundColor="#afb8d2";i.style.zIndex=parseInt(i.style.zIndex)-1e3}};e.DrawLines=function(){var t,l;for(t=0;t<e.__l.length;t++)for(l=0;l<e.__l[t].length;l++)e.__l[t][l].parentNode.removeChild(e.__l[t][l]);e.__l=[];e.StatusArrows=[];e.FindSetState(false,e);var i=[],r=e.StatusArrows,s,o={};for(t=0;t<r.length;t++){s=r[t][0]+"|"+r[t][1];if(!(s in o)){o[s]=true;i.push(r[t])}}var a=0,n=0,p=0;for(t=0;t<i.length;t++){var c=ActGetRealPos(document.getElementById(i[t][0]));var d=ActGetRealPos(document.getElementById(i[t][1]));if(c===false||d===false||c["left"]<=0||d["left"]<=0)continue;var h=e.Table.parentNode;var f=h.appendChild(document.createElement("IMG"));f.style.position="absolute";f.style.zIndex=14+t*10;f.width="8";f.height="8";var u=h.appendChild(document.createElement("IMG"));u.style.position="absolute";u.style.zIndex=15+t*10;u.width="8";u.height="8";var y=h.appendChild(document.createElement("DIV"));y.style.position="absolute";y.style.backgroundColor="#afb8d2";y.style.zIndex=11+t*10;y.style.height="2px";y.id=i[t][0]+"-"+i[t][1]+".1";y.onmouseover=e.LineMouseOver;y.onmouseout=e.LineMouseOut;var g=h.appendChild(document.createElement("DIV"));g.style.position="absolute";g.style.backgroundColor="#afb8d2";g.style.zIndex=12+t*10;g.style.width="2px";g.id=i[t][0]+"-"+i[t][1]+".2";g.onmouseover=e.LineMouseOver;g.onmouseout=e.LineMouseOut;var v=h.appendChild(document.createElement("DIV"));v.style.position="absolute";v.style.backgroundColor="#afb8d2";v.style.zIndex=13+t*10;v.style.height="2px";v.id=i[t][0]+"-"+i[t][1]+".3";v.onmouseover=e.LineMouseOver;v.onmouseout=e.LineMouseOut;var b=v.appendChild(document.createElement("IMG"));b.width="1";b.height="1";b=y.appendChild(document.createElement("IMG"));b.width="1";b.height="1";c["right"]=c["right"]+10;c["left"]=c["left"]-10;var m,x=-50,w=12,A=-1;if(c["right"]<d["left"]){++n;x+=n%6*6;m=d["left"]-c["right"];y.style.left=c["right"]+"px";y.style.width=m/2+x+"px";g.style.left=c["right"]+m/2+x+"px";v.style.left=c["right"]+m/2+x+"px";f.src="/bitrix/images/bizproc/arr_l1.gif";f.style.left=c["right"]-2+"px";f.style.top=c["top"]+w-3+"px";u.src="/bitrix/images/bizproc/arr_r1.gif";u.style.left=d["left"]+"px";u.style.top=d["top"]+w-3+"px"}else if(c["left"]===d["left"]){m=150;var T=BX.findParent(document.getElementById(i[t][0]),{attr:"data-column"});if(T&&T.getAttribute("data-column")==="2"){++p;x+=p%10*10;f.src="/bitrix/images/bizproc/arr_l1.gif";f.style.left=c["right"]-2+"px";f.style.top=c["top"]+w-3+"px";y.style.left=c["right"]+"px";y.style.width=m/2+x+"px";g.style.left=c["right"]+m/2+x+"px";v.style.left=d["right"]+"px";u.src="/bitrix/images/bizproc/arr_l2.gif";u.style.left=d["right"]-8+"px";u.style.top=d["top"]+w-3+"px";A=1}else{++a;x+=a%10*10;y.style.left=c["left"]-m/2+x+"px";y.style.width=m/2-x+"px";g.style.left=c["left"]-m/2+x+"px";v.style.left=c["left"]-m/2+x+"px";f.src="/bitrix/images/bizproc/arr_l2.gif";f.style.left=c["left"]-6+"px";f.style.top=c["top"]+w-3+"px";u.src="/bitrix/images/bizproc/arr_r1.gif";u.style.left=d["left"]+"px";u.style.top=d["top"]+w-3+"px"}}else{++n;x=n%6*6-50;m=c["left"]-d["right"];y.style.left=d["right"]+m/2-x+"px";y.style.width=m/2+x+"px";g.style.left=d["right"]+m/2-x+"px";v.style.left=d["right"]+"px";f.src="/bitrix/images/bizproc/arr_r2.gif";f.style.left=c["left"]-6+"px";f.style.top=c["top"]+w-3+"px";u.src="/bitrix/images/bizproc/arr_l2.gif";u.style.left=d["right"]-8+"px";u.style.top=d["top"]+w-3+"px"}y.style.top=c["top"]+w+"px";if(c["top"]<d["top"]){g.style.top=c["top"]+w+"px";g.style.height=d["top"]-c["top"]+"px"}else{g.style.top=d["top"]+w+"px";g.style.height=c["top"]-d["top"]+"px"}v.style.top=d["top"]+Math.floor((d["bottom"]-d["top"])/2)+"px";v.style.width=m/2+A*x+2+"px";e.__l.push([f,y,g,v,u])}};e.FindSetState=function(t,l){if(l.Type=="SetStateActivity"){if(l.Properties["TargetStateName"])e.StatusArrows.push([t,l.Properties["TargetStateName"]])}else{for(var i=0;i<l.childActivities.length;i++){if(l.Type=="StateActivity")t=l.childActivities[i].Name;e.FindSetState(t,l.childActivities[i])}}};e.Draw=function(t){e.statediv=t;e.Table=t.appendChild(_crt(e.childActivities.length+1,3));e.Table.onresize=function(){};var l;for(l=0;l<e.childActivities.length;l++){e.Table.rows[l].cells[0].align="right";e.Table.rows[l].cells[0].setAttribute("data-column",1);e.Table.rows[l].cells[2].align="left";e.Table.rows[l].cells[2].setAttribute("data-column",2);e.childActivities[l].Draw(e.Table.rows[l].cells[l%2*2])}l=e.childActivities.length;e.Table.rows[l].cells[0].align="right";e.Table.rows[l].cells[0].width="350px";e.Table.rows[l].cells[1].width="150px";e.Table.rows[l].cells[2].align="left";var i=jsUtils.CreateElement("INPUT",{type:"button",value:BPMESS["STM_ADD_STATUS"]});i.style.marginBottom="20px";e.Table.rows[l].cells[l%2*2].appendChild(i);e.Table.rows[l].cells[(l+1)%2*2].innerHTML="&nbsp";i.onclick=e.AddStatus;e.ReCheckPosition(true)};e.AddStatus=function(t){var l=e.childActivities.length;var i=CreateActivity("StateActivity");e.childActivities.push(i);i.parentActivity=e;i.Draw(e.Table.rows[l].cells[l%2*2]);var r=e.Table.insertRow(-1);r.insertCell(-1).align="right";r.insertCell(-1).align="center";r.insertCell(-1).align="left";l++;e.Table.rows[l].cells[l%2*2].appendChild(this);i.Settings()};e.RemoveChildStateMachine=e.RemoveChild;e.RemoveChild=function(t){e.RemoveChildStateMachine(t);e.Table.parentNode.removeChild(e.Table);e.Draw(e.statediv)};e.RemoveResourcesActivity=e.RemoveResources;e.RemoveResources=function(){e.RemoveResourcesActivity();if(e.Table){e.Table.parentNode.removeChild(e.Table);e.Table=null}};e.ReCheckPosition=function(t){if(e.Table.style.display=="none")return;var l=ActGetRealPos(e.Table);if(t||e.__lpos!=l["left"]||e.__rpos!=l["right"]){e.__lpos=l["left"];e.__rpos=l["right"];e.DrawLines()}setTimeout(function(){e.ReCheckPosition.call(e)},1e3)};return e};