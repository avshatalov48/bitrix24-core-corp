var _SequenceActivityCurClick=null;function _SequenceActivityClick(i,e,t){const r=t?arAllActivities[i]["PRESETS"].find((i=>i["ID"]===t)):null;const n=r?r["PROPERTIES"]:{};const a={Properties:{Title:r&&r["NAME"]||HTMLEncode(arAllActivities[i]["NAME"]),...n},Type:arAllActivities[i]["CLASS"],Children:[]};_SequenceActivityCurClick.AddActivity(CreateActivity(a),e)}function _SequenceActivityMyActivityClick(i,e){if(arUserParams&&BX.type.isArray(arUserParams["SNIPPETS"])&&arUserParams["SNIPPETS"][i]){_SequenceActivityCurClick.AddActivity(CreateActivity(arUserParams["SNIPPETS"][i]),e)}}SequenceActivity=function(){var i=new BizProcActivity;i.Type="SequenceActivity";i.childsContainer=null;i.iHead=0;i.LineMouseOver=function(i){this.parentNode.style.backgroundImage="url(/bitrix/images/bizproc/arr_over.gif)"};i.LineMouseOut=function(i){this.parentNode.style.backgroundImage="url(/bitrix/images/bizproc/arr.gif)"};i.OnClick=function(e){_SequenceActivityCurClick=i;var t=[];var r,n;for(r in arAllActGroups){n=[];for(var a in arAllActivities){if(!arAllActivities.hasOwnProperty(a))continue;if(arAllActivities[a]["EXCLUDED"]||!arAllActivities[a]["CATEGORY"])continue;var l=arAllActivities[a]["CATEGORY"]["ID"];if(arAllActivities[a]["CATEGORY"]["OWN_ID"])l=arAllActivities[a]["CATEGORY"]["OWN_ID"];if(l!=r)continue;if(a=="setstateactivity"&&rootActivity.Type==i.Type)continue;n.push({ICON:"url("+arAllActivities[a]["ICON"]+")",TEXT:'<img src="'+(arAllActivities[a]["ICON"]?arAllActivities[a]["ICON"]:"/bitrix/images/bizproc/act_icon.gif")+'" align="left" style="margin-right: 7px;margin-left: 0px">'+"<b>"+HTMLEncode(arAllActivities[a]["NAME"])+"</b><br>"+HTMLEncode(arAllActivities[a]["DESCRIPTION"]),ONCLICK:"_SequenceActivityClick('"+a+"', "+this.ind+");"});const e=arAllActivities[a]["PRESETS"];if(BX.Type.isArrayFilled(e)){e.forEach((i=>{n.push({ICON:"url("+arAllActivities[a]["ICON"]+")",TEXT:'<img src="'+(arAllActivities[a]["ICON"]?arAllActivities[a]["ICON"]:"/bitrix/images/bizproc/act_icon.gif")+'" align="left" style="margin-right: 7px;margin-left: 0px">'+"<b>"+HTMLEncode(i["NAME"])+"</b><br>"+HTMLEncode(i["DESCRIPTION"]||arAllActivities[a]["DESCRIPTION"]),ONCLICK:"_SequenceActivityClick('"+a+"', "+this.ind+", '"+i["ID"]+"');"})}))}}if(r==="rest"&&BX.getClass("BX.rest.Marketplace")){n.push({ICON:"url(/bitrix/images/bizproc/act_icon_plus.png)",TEXT:'<img src="/bitrix/images/bizproc/act_icon_plus.png" align="left" style="margin-right: 7px;margin-left: 0px">'+"<b>"+HTMLEncode(BPMESS["BPSA_MARKETPLACE_ADD_TITLE_2"])+"</b><br>"+HTMLEncode(BPMESS["BPSA_MARKETPLACE_ADD_DESCR_3"]),ONCLICK:"BX.rest.Marketplace.open({}, 'auto_pb'); if(window.jsPopup_WFAct) {window.jsPopup_WFAct.PopupHide();}"})}if(n.length>0)t.push({TEXT:HTMLEncode(arAllActGroups[r]),MENU:n})}if(arUserParams&&BX.type.isArray(arUserParams["SNIPPETS"])){n=[];for(var c in arUserParams["SNIPPETS"]){if(!arUserParams["SNIPPETS"].hasOwnProperty(c)){continue}var o=arUserParams["SNIPPETS"][c]["Icon"];if(!o){o="/bitrix/images/bizproc/act_icon.gif"}var s=arUserParams["SNIPPETS"][c]["Properties"]["Title"];n.push({ICON:"url("+o+")",TEXT:'<img src="'+o+'" align="left" style="margin-right: 7px;margin-left: 0px">'+"<b>"+HTMLEncode(s)+"</b>",ONCLICK:"_SequenceActivityMyActivityClick('"+c+"', "+this.ind+");"})}if(n.length>0)t.push({TEXT:HTMLEncode(BPMESS["BPSA_MY_ACTIVITIES_1"]),MENU:n})}if(window.jsPopup_WFAct)window.jsPopup_WFAct.PopupHide();else window.jsPopup_WFAct=new PopupMenu("PopupWFAct",3e4);window.jsPopup_WFAct.ShowMenu(this,t)};i.lastDrop=false;i.ondragging=function(e,t,r){if(!i.childsContainer)return false;for(var n=0;n<=i.childActivities.length;n++){var a=i.childsContainer.rows[n*2+i.iHead].cells[0].childNodes[0];var l=BX.pos(a);if(l.left<t&&t<l.right&&l.top<r&&r<l.bottom){a.onmouseover();i.lastDrop=a;return}}if(i.lastDrop){i.lastDrop.onmouseout();i.lastDrop=false}};i.h1id=DragNDrop.AddHandler("ondragging",i.ondragging);i.ondrop=function(e,t,r){if(!i.childsContainer)return false;if(i.lastDrop){var n;if(DragNDrop.obj.parentActivity&&(r.ctrlKey==false&&r.metaKey==false)){var a,l=-1,c=DragNDrop.obj.parentActivity;for(a=0;a<c.childActivities.length;a++){if(c.childActivities[a].Name==DragNDrop.obj.Name){l=a;break}}if(c.Name!=i.Name||l!=i.lastDrop.ind&&l+1!=i.lastDrop.ind){var o=i,s=false;while(o){if(DragNDrop.obj.Name==o.Name){s=true;break}o=o.parentActivity}if(s){alert(BPMESS["BPSA_ERROR_MOVE_1"])}else{c.childsContainer.deleteRow(l*2+1+c.iHead);c.childsContainer.deleteRow(l*2+1+c.iHead);for(var d=l;d<c.childActivities.length-1;d++)c.childActivities[d]=c.childActivities[d+1];c.childActivities.pop();for(d=0;d<=c.childActivities.length;d++)c.childsContainer.rows[d*2+c.iHead].cells[0].childNodes[0].ind=d;n=DragNDrop.obj;i.AddActivity(n,i.lastDrop.ind)}}}else{n=CreateActivity(DragNDrop.obj);i.AddActivity(n,i.lastDrop.ind)}i.lastDrop.onmouseout();i.lastDrop=false}};i.h2id=DragNDrop.AddHandler("ondrop",i.ondrop);i.ActivityRemoveChild=i.RemoveChild;i.RemoveChild=function(e){var t,r;for(t=0;t<i.childActivities.length;t++){if(i.childActivities[t].Name==e.Name){if(i.childsContainer){i.childsContainer.rows[t*2+1+i.iHead].cells[0].childNodes[0].onmouseover=null;i.childsContainer.rows[t*2+1+i.iHead].cells[0].childNodes[0].onmouseout=null;i.childsContainer.rows[t*2+1+i.iHead].cells[0].childNodes[0].onclick=null}i.ActivityRemoveChild(e);if(i.childsContainer){i.childsContainer.deleteRow(t*2+1+i.iHead);i.childsContainer.deleteRow(t*2+1+i.iHead);for(r=0;r<=i.childActivities.length;r++)i.childsContainer.rows[r*2+i.iHead].cells[0].childNodes[0].ind=r}break}}};i.RemoveResources=function(e){DragNDrop.RemoveHandler("ondragging",i.h1id);DragNDrop.RemoveHandler("ondrop",i.h2id);if(i.childsContainer&&i.childsContainer.parentNode){i.childsContainer.parentNode.removeChild(i.childsContainer);i.childsContainer=null}};i.AddActivity=function(e,t){var r;for(r=i.childActivities.length;r>t;r--)i.childActivities[r]=i.childActivities[r-1];i.childActivities[t]=e;e.parentActivity=i;var n=i.childsContainer.insertRow(t*2+1+i.iHead).insertCell(-1);n.align="center";n.vAlign="center";e.Draw(n);n=i.childsContainer.insertRow(t*2+2+i.iHead).insertCell(-1);n.align="center";n.vAlign="center";i.CreateLine(t+1);for(r=0;r<=i.childActivities.length;r++)i.childsContainer.rows[r*2+i.iHead].cells[0].childNodes[0].ind=r;BPTemplateIsModified=true};i.CreateLine=function(e){i.childsContainer.rows[e*2+i.iHead].cells[0].style.height="40px";i.childsContainer.rows[e*2+i.iHead].cells[0].style.background="url(/bitrix/images/bizproc/arr.gif) no-repeat scroll 50% 50%";var t=i.childsContainer.rows[e*2+i.iHead].cells[0].appendChild(document.createElement("IMG"));t.src="/bitrix/images/1.gif";t.width="28";t.height="21";t.onmouseover=i.LineMouseOver;t.onmouseout=i.LineMouseOut;t.onclick=i.OnClick;t.ind=e};i.ActivityDraw=i.Draw;i.Draw=function(e){i.childsContainer=e.appendChild(_crt(1+i.childActivities.length*2+i.iHead,1));i.childsContainer.className="seqactivitycontainer";i.childsContainer.id=i.Name;i.CreateLine(0);for(var t in i.childActivities){if(!i.childActivities.hasOwnProperty(t))continue;i.childActivities[t].Draw(i.childsContainer.rows[t*2+1+i.iHead].cells[0]);i.CreateLine(parseInt(t)+1)}if(i.AfterSDraw)i.AfterSDraw()};return i};
//# sourceMappingURL=sequenceactivity.map.js