{"version":3,"file":"stateactivity.js","sources":["src/index.js"],"sourcesContent":["import { Tag, Text, Dom, Event, Runtime, Reflection } from 'main.core';\nimport { Menu, MenuItem, MenuItemOptions } from 'main.popup';\nimport { Button } from 'ui.buttons';\n\nimport './css/style.css';\n\nexport class StateActivity extends window.BizProcActivity\n{\n\tlastDrop = false;\n\tmain: ?HTMLTableElement = null;\n\tcommandTable: ?HTMLTableElement = null;\n\th1id;\n\th2id;\n\tmenu;\n\n\t#sequenceHeader: ?HTMLDivElement = null;\n\t#sequenceContent: ?HTMLDivElement = null;\n\t#sequenceFooter: ?HTMLDivElement = null;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.Type = 'StateActivity';\n\n\t\tthis.Draw = this.#draw.bind(this);\n\t\tthis.OnRemoveClick = this.#onRemoveClick.bind(this);\n\t\tthis.RemoveResources = this.#removeResources.bind(this);\n\n\t\tthis.InitStateActivity = this.Init;\n\t\tthis.Init = this.#init.bind(this);\n\n\t\t// region compatibility\n\t\tthis.ondragging = this.#onDragging.bind(this);\n\t\tthis.ondrop = this.#onDrop.bind(this);\n\t\tthis.reDraw = this.#reDraw.bind(this);\n\t\tthis.remove = (event: PointerEvent) => {\n\t\t\tconst target = event.target;\n\t\t\tconst node = target.parentNode.parentNode.parentNode.parentNode.parentNode;\n\t\t\tconst id = node.id;\n\t\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-native-dom-methods\n\t\t\tthis.#removeChildActivity(node, id);\n\t\t};\n\n\t\tthis.settings = (event: PointerEvent) => {\n\t\t\tconst target = event.target;\n\t\t\tconst id = target.parentNode.parentNode.parentNode.parentNode.parentNode.id;\n\t\t\tthis.#openChildSetting(id);\n\t\t};\n\n\t\tthis.clickrow = (event: PointerEvent) => {\n\t\t\tconst target = event.target;\n\t\t\tconst id = target.parentNode.parentNode.parentNode.parentNode.parentNode.id;\n\t\t\tthis.#onClickChildRow(id);\n\t\t};\n\t\tthis.HideRows = this.#hideRows.bind(this);\n\t\tthis.SequentialShow = this.#showSequence.bind(this);\n\t\tthis.SequentialHide = this.#hideSequence.bind(this);\n\t\tthis.AddInitialize = this.#addInitializeChild.bind(this);\n\t\tthis.AddCommand = this.#addCommandChild.bind(this);\n\t\tthis.AddDelayActivity = this.#addDelayChild.bind(this);\n\t\tthis.AddFinilize = this.#addFinalizeChild.bind(this);\n\t\tthis.ShowAddMenu = (event: PointerEvent) => {\n\t\t\t// eslint-disable-next-line no-undef\n\t\t\tthis.menu = new PopupMenu('state_float_menu');\n\t\t\tthis.menu.create(2000);\n\n\t\t\tconst target = event.target;\n\t\t\tthis.#showAddChildMenu(target);\n\t\t};\n\t\t// endregion\n\t}\n\n\t#init(activityInfo)\n\t{\n\t\tthis.InitStateActivity(activityInfo);\n\t\tthis.childActivities.forEach((child) => {\n\t\t\tif (child.Type === 'EventDrivenActivity')\n\t\t\t{\n\t\t\t\tconst child0 = child.childActivities[0];\n\t\t\t\tchild.setActivated(child0.Activated);\n\t\t\t\tchild0.setCanBeActivated(child.canBeActivated);\n\t\t\t}\n\t\t});\n\t}\n\n\t#draw(wrapper)\n\t{\n\t\tthis.#initDragNDropHandlers();\n\n\t\tthis.main = Tag.render`\n\t\t\t<table class=\"bizproc-designer-state-activity-table\" cellpadding=\"0\" cellspacing=\"0\">\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr id=\"${Text.encode(this.Name)}\">\n\t\t\t\t\t\t<td style=\"height: 24px; white-space: nowrap;\">\n\t\t\t\t\t\t\t${this.#renderTitle()}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t${this.#renderContent()}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t`;\n\t\tDom.append(this.main, wrapper);\n\t}\n\n\t#reDraw()\n\t{\n\t\tconst parentNode = this.main.parentNode;\n\t\tDom.remove(this.main);\n\t\tthis.main = null;\n\t\tthis.commandTable = null;\n\t\tthis.#draw(parentNode);\n\t}\n\n\t#onRemoveClick()\n\t{\n\t\tthis.parentActivity.RemoveChild(this);\n\t}\n\n\t#removeResources()\n\t{\n\t\twindow.DragNDrop.RemoveHandler('ondragging', this.h1id);\n\t\twindow.DragNDrop.RemoveHandler('ondrop', this.h2id);\n\t\tDom.remove(this.main);\n\n\t\tthis.h1id = null;\n\t\tthis.h2id = null;\n\t\tthis.main = null;\n\t\tthis.commandTable = null;\n\t}\n\n\t#initDragNDropHandlers()\n\t{\n\t\tthis.lastDrop = false;\n\t\tif (!this.h1id)\n\t\t{\n\t\t\tthis.h1id = window.DragNDrop.AddHandler('ondragging', this.#onDragging.bind(this));\n\t\t\tthis.h2id = window.DragNDrop.AddHandler('ondrop', this.#onDrop.bind(this));\n\t\t}\n\t}\n\n\t#onDragging(event, X, Y)\n\t{\n\t\tconst arrow = this.main;\n\t\tconst position = Dom.getPosition(arrow);\n\n\t\tif (position.left < X && X < position.right && position.top < Y && Y < position.bottom)\n\t\t{\n\t\t\tthis.lastDrop = arrow;\n\t\t\tDom.style(arrow, 'opacity', '.25');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.lastDrop)\n\t\t{\n\t\t\tDom.style(arrow, 'opacity', null);\n\t\t\tthis.lastDrop = false;\n\t\t}\n\t}\n\n\t#onDrop()\n\t{\n\t\tif (this.lastDrop)\n\t\t{\n\t\t\tDom.style(this.lastDrop, 'opacity', null);\n\t\t\tthis.lastDrop = false;\n\n\t\t\tif (this !== window.DragNDrop.obj && this.parentActivity.ReplaceChild)\n\t\t\t{\n\t\t\t\tthis.parentActivity.ReplaceChild(this, window.DragNDrop.obj);\n\t\t\t}\n\t\t}\n\t}\n\n\t#renderTitle(): HTMLTableElement\n\t{\n\t\tconst { root, title, setting, remove } = Tag.render`\n\t\t\t<table \n\t\t\t\tclass=\"bizproc-designer-state-activity-title-table${this.Activated === 'N' ? ' --deactivated' : ''}\"\n\t\t\t\tcellpadding=\"0\"\n\t\t\t\tcellspacing=\"0\"\n\t\t\t>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td ref=\"title\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"bizproc-designer-state-activity-title\"\n\t\t\t\t\t\t\t\ttitle=\"${Text.encode(this.Properties.Title)}\"\n\t\t\t\t\t\t\t><b>${Text.encode(this.Properties.Title)}</b></div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ref='setting' style=\"cursor: pointer;\">\n\t\t\t\t\t\t\t<div class=\"ui-icon-set --settings-4 bizproc-designer-state-activity-title-icon\"></div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ref='remove' style=\"cursor: pointer;\">\n\t\t\t\t\t\t\t<div class=\"ui-icon-set --cross-60 bizproc-designer-state-activity-title-icon\"></div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t`;\n\t\tEvent.bind(title, 'mousedown', (event) => {\n\t\t\tconst draggedDiv = window.DragNDrop.StartDrag(event, this);\n\t\t\tdraggedDiv.innerHTML = this.main.innerHTML;\n\t\t\tDom.style(draggedDiv, 'width', `${this.main.offsetWidth}px`);\n\t\t});\n\t\tEvent.bind(setting, 'click', this.OnSettingsClick);\n\t\tEvent.bind(remove, 'click', this.#onRemoveClick.bind(this));\n\n\t\treturn root;\n\t}\n\n\t#renderContent(): HTMLTableElement\n\t{\n\t\tconst { root, add } = Tag.render`\n\t\t\t<table \n\t\t\t\tclass=\"bizproc-designer-state-activity-children-table${this.Activated === 'N' ? ' --deactivated' : ''}\"\n\t\t\t\tcellpadding=\"4\"\n\t\t\t\tcellspacing=\"0\"\n\t\t\t>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td style=\"font-size: 12px; text-align: left; vertical-align: center\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\tref=\"add\"\n\t\t\t\t\t\t\t\thref=\"javascript:void(0)\"\n\t\t\t\t\t\t\t\tstyle=\"text-decoration: none\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span>${Text.encode(window.BPMESS.STATEACT_ADD)}</span>\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tclass=\"ui-icon-set --chevron-down\"\n\t\t\t\t\t\t\t\t\tstyle=\"--ui-icon-set__icon-color: #2067b0; --ui-icon-set__icon-size: 10px\"\n\t\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t${this.#renderChildren()}\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t`;\n\t\tEvent.bind(add, 'click', this.#showAddChildMenu.bind(this, add));\n\t\tthis.commandTable = root;\n\n\t\treturn root;\n\t}\n\n\t#renderChildren(): []\n\t{\n\t\tif (this.childActivities.length <= 0)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst nodes = [];\n\t\tthis.childActivities.forEach((child) => {\n\t\t\tlet childTitle = child.Properties.Title;\n\t\t\tlet icon = child.Type === 'StateFinalizationActivity' ? 'fin' : 'init';\n\t\t\tlet activatedClass = (!child.canBeActivated || child.Activated === 'N') ? ' --deactivated' : '';\n\n\t\t\tif (child.Type === 'EventDrivenActivity')\n\t\t\t{\n\t\t\t\tconst child0 = child.childActivities[0];\n\t\t\t\tchildTitle = child0.Properties.Title;\n\t\t\t\ticon = child0.Type === 'DelayActivity' ? 'delay' : 'cmd';\n\t\t\t\tactivatedClass = (!child0.canBeActivated || child0.Activated === 'N') ? ' --deactivated' : '';\n\t\t\t}\n\n\t\t\tconst { iconCode, iconSize, iconColor } = this.constructor.#resolveIcon(icon);\n\t\t\tconst { root, title, setting, remove } = Tag.render`\n\t\t\t\t<tr id=\"${Text.encode(child.Name)}\">\n\t\t\t\t\t<td class=\"bizproc-designer-state-activity-child${activatedClass}\">\n\t\t\t\t\t\t<table style=\"font-size: 12px; width: 100%\">\n\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td style=\"width: 17px\">\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclass=\"ui-icon-set --${iconCode}\"\n\t\t\t\t\t\t\t\t\t\t\tstyle=\"\n\t\t\t\t\t\t\t\t\t\t\t\t--ui-icon-set__icon-size: ${iconSize};\n\t\t\t\t\t\t\t\t\t\t\t\t--ui-icon-set__icon-color: ${iconColor}\n\t\t\t\t\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td ref=\"title\" title=\"${Text.encode(window.BPMESS.STATEACT_EDITBP)}\">\n\t\t\t\t\t\t\t\t\t\t${Text.encode(childTitle)}\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td \n\t\t\t\t\t\t\t\t\t\tref=\"setting\" \n\t\t\t\t\t\t\t\t\t\ttitle=\"${Text.encode(window.BPMESS.STATEACT_SETT)}\"\n\t\t\t\t\t\t\t\t\t\tstyle=\"width: 14px\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\t\tclass=\"ui-icon-set --settings-4 bizproc-designer-state-activity-child-icon\"\n\t\t\t\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td\n\t\t\t\t\t\t\t\t\t\tref=\"remove\"\n\t\t\t\t\t\t\t\t\t\ttitle=\"${Text.encode(window.BPMESS.STATEACT_DEL)}\"\n\t\t\t\t\t\t\t\t\t\tstyle=\"width: 14px\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\t\tclass=\"ui-icon-set --cross-60 bizproc-designer-state-activity-child-icon\"\n\t\t\t\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t`;\n\t\t\tEvent.bind(title, 'click', this.#onClickChildRow.bind(this, child.Name));\n\t\t\tEvent.bind(setting, 'click', this.#openChildSetting.bind(this, child.Name));\n\t\t\tEvent.bind(remove, 'click', this.#removeChildActivity.bind(this, root, child.Name));\n\n\t\t\tnodes.push(root);\n\t\t});\n\n\t\treturn nodes;\n\t}\n\n\tstatic #resolveIcon(icon: string): {iconCode: string, iconSize: string, iconColor: string}\n\t{\n\t\tif (icon === 'delay')\n\t\t{\n\t\t\treturn {\n\t\t\t\ticonCode: 'hourglass-sandglass',\n\t\t\t\ticonSize: '17px',\n\t\t\t\ticonColor: 'rgb(42, 177, 28)', // 'rgb(123, 205, 116)',\n\t\t\t};\n\t\t}\n\n\t\tif (icon === 'cmd')\n\t\t{\n\t\t\treturn {\n\t\t\t\ticonCode: 'forward',\n\t\t\t\ticonSize: '17px',\n\t\t\t\ticonColor: 'rgb(176, 26, 109)',\n\t\t\t};\n\t\t}\n\n\t\tif (icon === 'fin')\n\t\t{\n\t\t\treturn {\n\t\t\t\ticonCode: 'statefin',\n\t\t\t\ticonSize: '12px',\n\t\t\t\ticonColor: 'none',\n\t\t\t};\n\t\t}\n\n\t\tif (icon === 'init')\n\t\t{\n\t\t\treturn {\n\t\t\t\ticonCode: 'stateinit',\n\t\t\t\ticonSize: '12px',\n\t\t\t\ticonColor: '#1a92b7',\n\t\t\t};\n\t\t}\n\n\t\treturn {};\n\t}\n\n\t#removeChildActivity(childNode: HTMLTableRowElement, childId: string)\n\t{\n\t\tconst child = this.findChildById(childId);\n\t\tif (child)\n\t\t{\n\t\t\tDom.remove(childNode);\n\t\t\tthis.RemoveChild(child);\n\t\t\tthis.parentActivity.DrawLines();\n\t\t}\n\t}\n\n\t#openChildSetting(childId: string)\n\t{\n\t\tlet child = this.findChildById(childId);\n\t\tif (child)\n\t\t{\n\t\t\tif (child.Type === 'EventDrivenActivity')\n\t\t\t{\n\t\t\t\tchild = child.childActivities[0];\n\t\t\t}\n\t\t\tchild.Settings();\n\t\t}\n\t}\n\n\t#onClickChildRow(childId: string)\n\t{\n\t\tconst child = this.findChildById(childId);\n\t\tif (child)\n\t\t{\n\t\t\tthis.#showSequence(child);\n\t\t}\n\t}\n\n\t#showSequence(child)\n\t{\n\t\t// eslint-disable-next-line no-underscore-dangle,@bitrix24/bitrix24-rules/no-pseudo-private\n\t\twindow.rootActivity._redrawObject = child;\n\t\tDom.style(this.parentActivity.Table, 'display', 'none');\n\n\t\tthis.#hideRows();\n\t\tthis.#drawSequenceHeader(child);\n\t\tthis.#drawSequenceContent(child);\n\t\tthis.#drawSequenceFooter();\n\n\t\tif (document.getElementById('bizprocsavebuttons'))\n\t\t{\n\t\t\tDom.style(document.getElementById('bizprocsavebuttons'), 'display', 'none');\n\t\t}\n\t\tscroll(0, 0);\n\t}\n\n\t#hideRows()\n\t{\n\t\t// eslint-disable-next-line no-underscore-dangle\n\t\tfor (let i = 0; i < this.parentActivity.__l.length; i++)\n\t\t{\n\t\t\tfor (let j = 0; j < 5; j++)\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-underscore-dangle\n\t\t\t\tDom.style(this.parentActivity.__l[i][j], 'display', 'none');\n\t\t\t}\n\t\t}\n\t}\n\n\t#drawSequenceHeader(child)\n\t{\n\t\tconst title = (\n\t\t\tchild.Type === 'EventDrivenActivity'\n\t\t\t\t? child.childActivities[0].Properties.Title\n\t\t\t\t: child.Properties.Title\n\t\t);\n\t\tconst { root, link } = Tag.render`\n\t\t\t<div style=\"font-size: 12px\">\n\t\t\t\t<a ref=\"link\" href=\"javascript:void(0)\">${Text.encode(this.Properties.Title)}</a>\n\t\t\t\t<span> - ${Text.encode(title)}</span>\n\t\t\t</div>\n\t\t`;\n\t\tEvent.bind(link, 'click', this.#hideSequence.bind(this));\n\n\t\tthis.#sequenceHeader = root;\n\t\tDom.append(this.#sequenceHeader, this.parentActivity.Table.parentNode);\n\t}\n\n\t#drawSequenceContent(child)\n\t{\n\t\tthis.#sequenceContent = Tag.render`<div></div>`;\n\t\tDom.append(this.#sequenceContent, this.parentActivity.Table.parentNode);\n\n\t\tchild.Draw(this.#sequenceContent);\n\t}\n\n\t#drawSequenceFooter()\n\t{\n\t\tconst backButton = new Button({\n\t\t\ttext: window.BPMESS.STATEACT_BACK_1,\n\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\tnoCaps: true,\n\t\t\tonclick: this.#hideSequence.bind(this),\n\t\t});\n\t\tthis.#sequenceFooter = Tag.render`<div>${backButton.render()}</div>`;\n\t\tDom.style(backButton.getContainer(), 'margin', '15px');\n\t\tDom.append(this.#sequenceFooter, this.parentActivity.Table.parentNode);\n\t}\n\n\t#hideSequence()\n\t{\n\t\tDom.style(this.parentActivity.Table, 'display', 'table');\n\n\t\tDom.remove(this.#sequenceHeader);\n\t\tDom.remove(this.#sequenceContent);\n\t\tDom.remove(this.#sequenceFooter);\n\n\t\tthis.#sequenceHeader = null;\n\t\tthis.#sequenceContent = null;\n\t\tthis.#sequenceFooter = null;\n\n\t\tif (document.getElementById('bizprocsavebuttons'))\n\t\t{\n\t\t\tDom.style(document.getElementById('bizprocsavebuttons'), 'display', 'block');\n\t\t}\n\n\t\t// eslint-disable-next-line no-underscore-dangle,@bitrix24/bitrix24-rules/no-pseudo-private\n\t\twindow.rootActivity._redrawObject = null;\n\t\twindow.arWorkflowTemplate = window.rootActivity.Serialize();\n\t\twindow.ReDraw();\n\t}\n\n\t#showAddChildMenu(bindElement)\n\t{\n\t\tconst showMenuAction = () => {\n\t\t\t(new Menu({\n\t\t\t\tbindElement,\n\t\t\t\tid: `state_float_menu-${Text.getRandom()}`,\n\t\t\t\tminWidth: 277,\n\t\t\t\tautoHide: true,\n\t\t\t\tzIndexOptions: { alwaysOnTop: true },\n\t\t\t\tcacheable: false,\n\t\t\t\titems: this.#getChildMenuItems(),\n\t\t\t})).show();\n\t\t};\n\n\t\tif (!Reflection.getClass('BX.Main.Menu'))\n\t\t{\n\t\t\tRuntime.loadExtension('main.popup')\n\t\t\t\t.then(() => showMenuAction())\n\t\t\t\t.catch(() => {})\n\t\t\t;\n\n\t\t\treturn;\n\t\t}\n\n\t\tshowMenuAction();\n\t}\n\n\t#getChildMenuItems(): MenuItemOptions[]\n\t{\n\t\tconst getItemHtml = (icon, text) => {\n\t\t\tconst { iconCode, iconColor } = this.constructor.#resolveIcon(icon);\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div style=\"display: inline-flex; align-items: center\">\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass=\"ui-icon-set --${iconCode}\"\n\t\t\t\t\t\tstyle=\"\n\t\t\t\t\t\t\t--ui-icon-set__icon-size: 17px;\n\t\t\t\t\t\t\t--ui-icon-set__icon-color: ${iconColor};\n\t\t\t\t\t\t\tmargin-right: 5px;\n\t\t\t\t\t\t\"\n\t\t\t\t\t></span>\n\t\t\t\t\t<span>${Text.encode(text)}</span>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t};\n\n\t\tconst items = [\n\t\t\t{\n\t\t\t\tid: '2',\n\t\t\t\thtml: getItemHtml('cmd', window.BPMESS.STATEACT_MENU_COMMAND),\n\t\t\t\tonclick: (event, menuItem: MenuItem) => {\n\t\t\t\t\tmenuItem.getMenuWindow().close();\n\t\t\t\t\tthis.#addCommandChild();\n\t\t\t\t\tthis.#reDraw();\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: '3',\n\t\t\t\thtml: getItemHtml('delay', window.BPMESS.STATEACT_MENU_DELAY),\n\t\t\t\tonclick: (event, menuItem: MenuItem) => {\n\t\t\t\t\tmenuItem.getMenuWindow().close();\n\t\t\t\t\tthis.#addDelayChild();\n\t\t\t\t\tthis.#reDraw();\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\n\t\tlet hasInitChild = false;\n\t\tlet hasFinishChild = false;\n\t\tthis.childActivities.forEach((child) => {\n\t\t\tif (child.Type === 'StateInitializationActivity')\n\t\t\t{\n\t\t\t\thasInitChild = true;\n\t\t\t}\n\n\t\t\tif (child.Type === 'StateFinalizationActivity')\n\t\t\t{\n\t\t\t\thasFinishChild = true;\n\t\t\t}\n\t\t});\n\n\t\tif (!hasInitChild)\n\t\t{\n\t\t\titems.push({\n\t\t\t\tid: '1',\n\t\t\t\thtml: getItemHtml('init', window.BPMESS.STATEACT_MENU_INIT_1),\n\t\t\t\tonclick: (event, menuItem: MenuItem) => {\n\t\t\t\t\tmenuItem.getMenuWindow().close();\n\t\t\t\t\tthis.#addInitializeChild();\n\t\t\t\t\tthis.#reDraw();\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (!hasFinishChild)\n\t\t{\n\t\t\titems.push({\n\t\t\t\tid: '5',\n\t\t\t\thtml: getItemHtml('fin', window.BPMESS.STATEACT_MENU_FIN_1),\n\t\t\t\tonclick: (event, menuItem: MenuItem) => {\n\t\t\t\t\tmenuItem.getMenuWindow().close();\n\t\t\t\t\tthis.#addFinalizeChild();\n\t\t\t\t\tthis.#reDraw();\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn items;\n\t}\n\n\t#addInitializeChild()\n\t{\n\t\tconst row = this.commandTable.insertRow(1);\n\t\tconst cell = row.insertCell(-1);\n\t\tcell.innerHTML = '';\n\n\t\tconst activity = window.CreateActivity('StateInitializationActivity');\n\t\tthis.childActivities.push(activity);\n\t\tactivity.parentActivity = this;\n\t\tactivity.setCanBeActivated(this.getCanBeActivatedChild());\n\n\t\tthis.#showSequence(activity);\n\t}\n\n\t#addCommandChild()\n\t{\n\t\tconst eventDrivenActivity = window.CreateActivity('EventDrivenActivity');\n\t\tconst handleExternalEventActivity = window.CreateActivity('HandleExternalEventActivity');\n\n\t\teventDrivenActivity.childActivities.push(handleExternalEventActivity);\n\t\thandleExternalEventActivity.parentActivity = eventDrivenActivity;\n\n\t\tconst row = this.commandTable.insertRow(1);\n\t\tconst cell = row.insertCell(-1);\n\t\tcell.innerHTML = '';\n\n\t\tthis.childActivities.push(eventDrivenActivity);\n\t\teventDrivenActivity.parentActivity = this;\n\t\teventDrivenActivity.setCanBeActivated(this.getCanBeActivatedChild());\n\n\t\thandleExternalEventActivity.Settings();\n\t}\n\n\t#addDelayChild()\n\t{\n\t\tconst eventDrivenActivity = window.CreateActivity('EventDrivenActivity');\n\t\tconst delayActivity = window.CreateActivity('DelayActivity');\n\n\t\teventDrivenActivity.childActivities.push(delayActivity);\n\t\tdelayActivity.parentActivity = eventDrivenActivity;\n\n\t\tconst row = this.commandTable.insertRow(1);\n\t\tconst cell = row.insertCell(-1);\n\t\tcell.innerHTML = '';\n\n\t\tthis.childActivities.push(eventDrivenActivity);\n\t\teventDrivenActivity.parentActivity = this;\n\t\teventDrivenActivity.setCanBeActivated(this.getCanBeActivatedChild());\n\n\t\tdelayActivity.Settings();\n\t}\n\n\t#addFinalizeChild()\n\t{\n\t\tconst row = this.commandTable.insertRow(1);\n\t\tconst cell = row.insertCell(-1);\n\t\tcell.innerHTML = '';\n\n\t\tconst activity = window.CreateActivity('StateFinalizationActivity');\n\t\tthis.childActivities.push(activity);\n\t\tactivity.parentActivity = this;\n\t\tactivity.setCanBeActivated(this.getCanBeActivatedChild());\n\n\t\tthis.#showSequence(activity);\n\t}\n}\n\n// eslint-disable-next-line @bitrix24/bitrix24-rules/no-pseudo-private,no-underscore-dangle\nwindow.__StateActivityAdd = function(type, id)\n{\n\tconst activity = window.rootActivity.childActivities.find((act) => act.Name === id);\n\tif (activity)\n\t{\n\t\tswitch (type)\n\t\t{\n\t\t\tcase 'init':\n\t\t\t\tactivity.AddInitialize();\n\t\t\t\tbreak;\n\t\t\tcase 'command':\n\t\t\t\tactivity.AddCommand();\n\t\t\t\tbreak;\n\t\t\tcase 'delay':\n\t\t\t\tactivity.AddDelayActivity();\n\t\t\t\tbreak;\n\t\t\tcase 'finish':\n\t\t\t\tactivity.AddFinilize();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\t// no default\n\t\t}\n\n\t\tif (BX.Type.isFunction(activity.reDraw))\n\t\t{\n\t\t\tactivity.reDraw();\n\t\t}\n\t}\n};\n"],"names":["StateActivity","window","BizProcActivity","constructor","lastDrop","main","commandTable","Type","Draw","bind","OnRemoveClick","RemoveResources","InitStateActivity","Init","ondragging","ondrop","reDraw","remove","event","target","node","parentNode","id","settings","clickrow","HideRows","SequentialShow","SequentialHide","AddInitialize","AddCommand","AddDelayActivity","AddFinilize","ShowAddMenu","menu","PopupMenu","create","activityInfo","childActivities","forEach","child","child0","setActivated","Activated","setCanBeActivated","canBeActivated","wrapper","Tag","render","Text","encode","Name","Dom","append","parentActivity","RemoveChild","DragNDrop","RemoveHandler","h1id","h2id","AddHandler","X","Y","arrow","position","getPosition","left","right","top","bottom","style","obj","ReplaceChild","root","title","setting","Properties","Title","Event","draggedDiv","StartDrag","innerHTML","offsetWidth","OnSettingsClick","add","BPMESS","STATEACT_ADD","length","nodes","childTitle","icon","activatedClass","iconCode","iconSize","iconColor","STATEACT_EDITBP","STATEACT_SETT","STATEACT_DEL","push","childNode","childId","findChildById","DrawLines","Settings","rootActivity","_redrawObject","Table","document","getElementById","scroll","i","__l","j","link","backButton","Button","text","STATEACT_BACK_1","size","Size","EXTRA_SMALL","color","Color","LIGHT_BORDER","noCaps","onclick","getContainer","arWorkflowTemplate","Serialize","ReDraw","bindElement","showMenuAction","Menu","getRandom","minWidth","autoHide","zIndexOptions","alwaysOnTop","cacheable","items","show","Reflection","getClass","Runtime","loadExtension","then","catch","getItemHtml","html","STATEACT_MENU_COMMAND","menuItem","getMenuWindow","close","STATEACT_MENU_DELAY","hasInitChild","hasFinishChild","STATEACT_MENU_INIT_1","STATEACT_MENU_FIN_1","row","insertRow","cell","insertCell","activity","CreateActivity","getCanBeActivatedChild","eventDrivenActivity","handleExternalEventActivity","delayActivity","__StateActivityAdd","type","find","act","BX","isFunction"],"mappings":";;;;;;;;;;;;AAAA,CAIyB;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEzB,CAAO,MAAMA,aAAa,SAASC,MAAM,CAACC,eAAe,CACzD;GAYCC,WAAW,GACX;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA,KAbTC,QAAQ,GAAG,KAAK;KAAA,KAChBC,IAAI,GAAsB,IAAI;KAAA,KAC9BC,YAAY,GAAsB,IAAI;KAAA;OAAA;OAAA,OAKH;;KAAI;OAAA;OAAA,OACH;;KAAI;OAAA;OAAA,OACL;;KAKlC,IAAI,CAACC,IAAI,GAAG,eAAe;KAE3B,IAAI,CAACC,IAAI,GAAG,4CAAI,gBAAOC,IAAI,CAAC,IAAI,CAAC;KACjC,IAAI,CAACC,aAAa,GAAG,4CAAI,kCAAgBD,IAAI,CAAC,IAAI,CAAC;KACnD,IAAI,CAACE,eAAe,GAAG,4CAAI,sCAAkBF,IAAI,CAAC,IAAI,CAAC;KAEvD,IAAI,CAACG,iBAAiB,GAAG,IAAI,CAACC,IAAI;KAClC,IAAI,CAACA,IAAI,GAAG,4CAAI,gBAAOJ,IAAI,CAAC,IAAI,CAAC;;;KAGjC,IAAI,CAACK,UAAU,GAAG,4CAAI,4BAAaL,IAAI,CAAC,IAAI,CAAC;KAC7C,IAAI,CAACM,MAAM,GAAG,4CAAI,oBAASN,IAAI,CAAC,IAAI,CAAC;KACrC,IAAI,CAACO,MAAM,GAAG,4CAAI,oBAASP,IAAI,CAAC,IAAI,CAAC;KACrC,IAAI,CAACQ,MAAM,GAAIC,KAAmB,IAAK;OACtC,MAAMC,MAAM,GAAGD,KAAK,CAACC,MAAM;OAC3B,MAAMC,IAAI,GAAGD,MAAM,CAACE,UAAU,CAACA,UAAU,CAACA,UAAU,CAACA,UAAU,CAACA,UAAU;OAC1E,MAAMC,EAAE,GAAGF,IAAI,CAACE,EAAE;;OAElB,4CAAI,8CAAsBF,IAAI,EAAEE,EAAE;MAClC;KAED,IAAI,CAACC,QAAQ,GAAIL,KAAmB,IAAK;OACxC,MAAMC,MAAM,GAAGD,KAAK,CAACC,MAAM;OAC3B,MAAMG,EAAE,GAAGH,MAAM,CAACE,UAAU,CAACA,UAAU,CAACA,UAAU,CAACA,UAAU,CAACA,UAAU,CAACC,EAAE;OAC3E,4CAAI,wCAAmBA,EAAE;MACzB;KAED,IAAI,CAACE,QAAQ,GAAIN,KAAmB,IAAK;OACxC,MAAMC,MAAM,GAAGD,KAAK,CAACC,MAAM;OAC3B,MAAMG,EAAE,GAAGH,MAAM,CAACE,UAAU,CAACA,UAAU,CAACA,UAAU,CAACA,UAAU,CAACA,UAAU,CAACC,EAAE;OAC3E,4CAAI,sCAAkBA,EAAE;MACxB;KACD,IAAI,CAACG,QAAQ,GAAG,4CAAI,wBAAWhB,IAAI,CAAC,IAAI,CAAC;KACzC,IAAI,CAACiB,cAAc,GAAG,4CAAI,gCAAejB,IAAI,CAAC,IAAI,CAAC;KACnD,IAAI,CAACkB,cAAc,GAAG,4CAAI,gCAAelB,IAAI,CAAC,IAAI,CAAC;KACnD,IAAI,CAACmB,aAAa,GAAG,4CAAI,4CAAqBnB,IAAI,CAAC,IAAI,CAAC;KACxD,IAAI,CAACoB,UAAU,GAAG,4CAAI,sCAAkBpB,IAAI,CAAC,IAAI,CAAC;KAClD,IAAI,CAACqB,gBAAgB,GAAG,4CAAI,kCAAgBrB,IAAI,CAAC,IAAI,CAAC;KACtD,IAAI,CAACsB,WAAW,GAAG,4CAAI,wCAAmBtB,IAAI,CAAC,IAAI,CAAC;KACpD,IAAI,CAACuB,WAAW,GAAId,KAAmB,IAAK;;OAE3C,IAAI,CAACe,IAAI,GAAG,IAAIC,SAAS,CAAC,kBAAkB,CAAC;OAC7C,IAAI,CAACD,IAAI,CAACE,MAAM,CAAC,IAAI,CAAC;OAEtB,MAAMhB,MAAM,GAAGD,KAAK,CAACC,MAAM;OAC3B,4CAAI,wCAAmBA,MAAM;MAC7B;;;CAwlBH;;CAEA;CAAA,gBAtlBOiB,YAAY,EAClB;GACC,IAAI,CAACxB,iBAAiB,CAACwB,YAAY,CAAC;GACpC,IAAI,CAACC,eAAe,CAACC,OAAO,CAAEC,KAAK,IAAK;KACvC,IAAIA,KAAK,CAAChC,IAAI,KAAK,qBAAqB,EACxC;OACC,MAAMiC,MAAM,GAAGD,KAAK,CAACF,eAAe,CAAC,CAAC,CAAC;OACvCE,KAAK,CAACE,YAAY,CAACD,MAAM,CAACE,SAAS,CAAC;OACpCF,MAAM,CAACG,iBAAiB,CAACJ,KAAK,CAACK,cAAc,CAAC;;IAE/C,CAAC;CACH;CAAC,gBAEKC,OAAO,EACb;GACC,4CAAI;GAEJ,IAAI,CAACxC,IAAI,GAAGyC,aAAG,CAACC,MAAM,cAAC;;;eAGZ,CAAyB;;SAE/B,CAAsB;;;;;SAKtB,CAAwB;;;;;GAK7B,GAZaC,cAAI,CAACC,MAAM,CAAC,IAAI,CAACC,IAAI,CAAC,0CAE5B,IAAI,yEAKJ,IAAI,oCAKV;GACDC,aAAG,CAACC,MAAM,CAAC,IAAI,CAAC/C,IAAI,EAAEwC,OAAO,CAAC;CAC/B;CAAC,oBAGD;GACC,MAAMxB,UAAU,GAAG,IAAI,CAAChB,IAAI,CAACgB,UAAU;GACvC8B,aAAG,CAAClC,MAAM,CAAC,IAAI,CAACZ,IAAI,CAAC;GACrB,IAAI,CAACA,IAAI,GAAG,IAAI;GAChB,IAAI,CAACC,YAAY,GAAG,IAAI;GACxB,4CAAI,gBAAOe,UAAU;CACtB;CAAC,2BAGD;GACC,IAAI,CAACgC,cAAc,CAACC,WAAW,CAAC,IAAI,CAAC;CACtC;CAAC,6BAGD;GACCrD,MAAM,CAACsD,SAAS,CAACC,aAAa,CAAC,YAAY,EAAE,IAAI,CAACC,IAAI,CAAC;GACvDxD,MAAM,CAACsD,SAAS,CAACC,aAAa,CAAC,QAAQ,EAAE,IAAI,CAACE,IAAI,CAAC;GACnDP,aAAG,CAAClC,MAAM,CAAC,IAAI,CAACZ,IAAI,CAAC;GAErB,IAAI,CAACoD,IAAI,GAAG,IAAI;GAChB,IAAI,CAACC,IAAI,GAAG,IAAI;GAChB,IAAI,CAACrD,IAAI,GAAG,IAAI;GAChB,IAAI,CAACC,YAAY,GAAG,IAAI;CACzB;CAAC,mCAGD;GACC,IAAI,CAACF,QAAQ,GAAG,KAAK;GACrB,IAAI,CAAC,IAAI,CAACqD,IAAI,EACd;KACC,IAAI,CAACA,IAAI,GAAGxD,MAAM,CAACsD,SAAS,CAACI,UAAU,CAAC,YAAY,EAAE,4CAAI,4BAAalD,IAAI,CAAC,IAAI,CAAC,CAAC;KAClF,IAAI,CAACiD,IAAI,GAAGzD,MAAM,CAACsD,SAAS,CAACI,UAAU,CAAC,QAAQ,EAAE,4CAAI,oBAASlD,IAAI,CAAC,IAAI,CAAC,CAAC;;CAE5E;CAAC,sBAEWS,KAAK,EAAE0C,CAAC,EAAEC,CAAC,EACvB;GACC,MAAMC,KAAK,GAAG,IAAI,CAACzD,IAAI;GACvB,MAAM0D,QAAQ,GAAGZ,aAAG,CAACa,WAAW,CAACF,KAAK,CAAC;GAEvC,IAAIC,QAAQ,CAACE,IAAI,GAAGL,CAAC,IAAIA,CAAC,GAAGG,QAAQ,CAACG,KAAK,IAAIH,QAAQ,CAACI,GAAG,GAAGN,CAAC,IAAIA,CAAC,GAAGE,QAAQ,CAACK,MAAM,EACtF;KACC,IAAI,CAAChE,QAAQ,GAAG0D,KAAK;KACrBX,aAAG,CAACkB,KAAK,CAACP,KAAK,EAAE,SAAS,EAAE,KAAK,CAAC;KAElC;;GAGD,IAAI,IAAI,CAAC1D,QAAQ,EACjB;KACC+C,aAAG,CAACkB,KAAK,CAACP,KAAK,EAAE,SAAS,EAAE,IAAI,CAAC;KACjC,IAAI,CAAC1D,QAAQ,GAAG,KAAK;;CAEvB;CAAC,oBAGD;GACC,IAAI,IAAI,CAACA,QAAQ,EACjB;KACC+C,aAAG,CAACkB,KAAK,CAAC,IAAI,CAACjE,QAAQ,EAAE,SAAS,EAAE,IAAI,CAAC;KACzC,IAAI,CAACA,QAAQ,GAAG,KAAK;KAErB,IAAI,IAAI,KAAKH,MAAM,CAACsD,SAAS,CAACe,GAAG,IAAI,IAAI,CAACjB,cAAc,CAACkB,YAAY,EACrE;OACC,IAAI,CAAClB,cAAc,CAACkB,YAAY,CAAC,IAAI,EAAEtE,MAAM,CAACsD,SAAS,CAACe,GAAG,CAAC;;;CAG/D;CAAC,yBAGD;GACC,MAAM;KAAEE,IAAI;KAAEC,KAAK;KAAEC,OAAO;KAAEzD;IAAQ,GAAG6B,aAAG,CAACC,MAAM,gBAAC;;wDAEA,CAAiD;;;;;;;;;iBASxF,CAAqC;aACzC,CAAqC;;;;;;;;;;;GAW9C,GArBsD,IAAI,CAACL,SAAS,KAAK,GAAG,GAAG,gBAAgB,GAAG,EAAE,EASrFM,cAAI,CAACC,MAAM,CAAC,IAAI,CAAC0B,UAAU,CAACC,KAAK,CAAC,EACtC5B,cAAI,CAACC,MAAM,CAAC,IAAI,CAAC0B,UAAU,CAACC,KAAK,CAAC,CAW5C;GACDC,eAAK,CAACpE,IAAI,CAACgE,KAAK,EAAE,WAAW,EAAGvD,KAAK,IAAK;KACzC,MAAM4D,UAAU,GAAG7E,MAAM,CAACsD,SAAS,CAACwB,SAAS,CAAC7D,KAAK,EAAE,IAAI,CAAC;KAC1D4D,UAAU,CAACE,SAAS,GAAG,IAAI,CAAC3E,IAAI,CAAC2E,SAAS;KAC1C7B,aAAG,CAACkB,KAAK,CAACS,UAAU,EAAE,OAAO,EAAG,GAAE,IAAI,CAACzE,IAAI,CAAC4E,WAAY,IAAG,CAAC;IAC5D,CAAC;GACFJ,eAAK,CAACpE,IAAI,CAACiE,OAAO,EAAE,OAAO,EAAE,IAAI,CAACQ,eAAe,CAAC;GAClDL,eAAK,CAACpE,IAAI,CAACQ,MAAM,EAAE,OAAO,EAAE,4CAAI,kCAAgBR,IAAI,CAAC,IAAI,CAAC,CAAC;GAE3D,OAAO+D,IAAI;CACZ;CAAC,2BAGD;GACC,MAAM;KAAEA,IAAI;KAAEW;IAAK,GAAGrC,aAAG,CAACC,MAAM,gBAAC;;2DAEsB,CAAiD;;;;;;;;;;;;gBAY5F,CAA0C;;;;;;;;OAQnD,CAAyB;;;GAG5B,GAvByD,IAAI,CAACL,SAAS,KAAK,GAAG,GAAG,gBAAgB,GAAG,EAAE,EAYzFM,cAAI,CAACC,MAAM,CAAChD,MAAM,CAACmF,MAAM,CAACC,YAAY,CAAC,0CAQhD,IAAI,sCAGR;GACDR,eAAK,CAACpE,IAAI,CAAC0E,GAAG,EAAE,OAAO,EAAE,4CAAI,wCAAmB1E,IAAI,CAAC,IAAI,EAAE0E,GAAG,CAAC,CAAC;GAChE,IAAI,CAAC7E,YAAY,GAAGkE,IAAI;GAExB,OAAOA,IAAI;CACZ;CAAC,4BAGD;GACC,IAAI,IAAI,CAACnC,eAAe,CAACiD,MAAM,IAAI,CAAC,EACpC;KACC,OAAO,EAAE;;GAGV,MAAMC,KAAK,GAAG,EAAE;GAChB,IAAI,CAAClD,eAAe,CAACC,OAAO,CAAEC,KAAK,IAAK;KACvC,IAAIiD,UAAU,GAAGjD,KAAK,CAACoC,UAAU,CAACC,KAAK;KACvC,IAAIa,IAAI,GAAGlD,KAAK,CAAChC,IAAI,KAAK,2BAA2B,GAAG,KAAK,GAAG,MAAM;KACtE,IAAImF,cAAc,GAAI,CAACnD,KAAK,CAACK,cAAc,IAAIL,KAAK,CAACG,SAAS,KAAK,GAAG,GAAI,gBAAgB,GAAG,EAAE;KAE/F,IAAIH,KAAK,CAAChC,IAAI,KAAK,qBAAqB,EACxC;OACC,MAAMiC,MAAM,GAAGD,KAAK,CAACF,eAAe,CAAC,CAAC,CAAC;OACvCmD,UAAU,GAAGhD,MAAM,CAACmC,UAAU,CAACC,KAAK;OACpCa,IAAI,GAAGjD,MAAM,CAACjC,IAAI,KAAK,eAAe,GAAG,OAAO,GAAG,KAAK;OACxDmF,cAAc,GAAI,CAAClD,MAAM,CAACI,cAAc,IAAIJ,MAAM,CAACE,SAAS,KAAK,GAAG,GAAI,gBAAgB,GAAG,EAAE;;KAG9F,MAAM;OAAEiD,QAAQ;OAAEC,QAAQ;OAAEC;MAAW,2CAAG,IAAI,CAAC1F,WAAW,8BAAcsF,IAAI,CAAC;KAC7E,MAAM;OAAEjB,IAAI;OAAEC,KAAK;OAAEC,OAAO;OAAEzD;MAAQ,GAAG6B,aAAG,CAACC,MAAM,gBAAC;cAC3C,CAA0B;uDACe,CAAiB;;;;;;kCAMtC,CAAW;;wCAEL,CAAW;yCACV,CAAY;;;;kCAInB,CAA6C;YACnE,CAA0B;;;;mBAInB,CAA2C;;;;;;;;;mBAS3C,CAA0C;;;;;;;;;;;;IAYxD,GAxCWC,cAAI,CAACC,MAAM,CAACV,KAAK,CAACW,IAAI,CAAC,EACkBwC,cAAc,EAMnCC,QAAQ,EAEFC,QAAQ,EACPC,SAAS,EAIhB7C,cAAI,CAACC,MAAM,CAAChD,MAAM,CAACmF,MAAM,CAACU,eAAe,CAAC,EAChE9C,cAAI,CAACC,MAAM,CAACuC,UAAU,CAAC,EAIhBxC,cAAI,CAACC,MAAM,CAAChD,MAAM,CAACmF,MAAM,CAACW,aAAa,CAAC,EASxC/C,cAAI,CAACC,MAAM,CAAChD,MAAM,CAACmF,MAAM,CAACY,YAAY,CAAC,CAYtD;KACDnB,eAAK,CAACpE,IAAI,CAACgE,KAAK,EAAE,OAAO,EAAE,4CAAI,sCAAkBhE,IAAI,CAAC,IAAI,EAAE8B,KAAK,CAACW,IAAI,CAAC,CAAC;KACxE2B,eAAK,CAACpE,IAAI,CAACiE,OAAO,EAAE,OAAO,EAAE,4CAAI,wCAAmBjE,IAAI,CAAC,IAAI,EAAE8B,KAAK,CAACW,IAAI,CAAC,CAAC;KAC3E2B,eAAK,CAACpE,IAAI,CAACQ,MAAM,EAAE,OAAO,EAAE,4CAAI,8CAAsBR,IAAI,CAAC,IAAI,EAAE+D,IAAI,EAAEjC,KAAK,CAACW,IAAI,CAAC,CAAC;KAEnFqC,KAAK,CAACU,IAAI,CAACzB,IAAI,CAAC;IAChB,CAAC;GAEF,OAAOe,KAAK;CACb;CAAC,uBAEmBE,IAAY,EAChC;GACC,IAAIA,IAAI,KAAK,OAAO,EACpB;KACC,OAAO;OACNE,QAAQ,EAAE,qBAAqB;OAC/BC,QAAQ,EAAE,MAAM;OAChBC,SAAS,EAAE,kBAAkB;MAC7B;;;GAGF,IAAIJ,IAAI,KAAK,KAAK,EAClB;KACC,OAAO;OACNE,QAAQ,EAAE,SAAS;OACnBC,QAAQ,EAAE,MAAM;OAChBC,SAAS,EAAE;MACX;;GAGF,IAAIJ,IAAI,KAAK,KAAK,EAClB;KACC,OAAO;OACNE,QAAQ,EAAE,UAAU;OACpBC,QAAQ,EAAE,MAAM;OAChBC,SAAS,EAAE;MACX;;GAGF,IAAIJ,IAAI,KAAK,MAAM,EACnB;KACC,OAAO;OACNE,QAAQ,EAAE,WAAW;OACrBC,QAAQ,EAAE,MAAM;OAChBC,SAAS,EAAE;MACX;;GAGF,OAAO,EAAE;CACV;CAAC,+BAEoBK,SAA8B,EAAEC,OAAe,EACpE;GACC,MAAM5D,KAAK,GAAG,IAAI,CAAC6D,aAAa,CAACD,OAAO,CAAC;GACzC,IAAI5D,KAAK,EACT;KACCY,aAAG,CAAClC,MAAM,CAACiF,SAAS,CAAC;KACrB,IAAI,CAAC5C,WAAW,CAACf,KAAK,CAAC;KACvB,IAAI,CAACc,cAAc,CAACgD,SAAS,EAAE;;CAEjC;CAAC,4BAEiBF,OAAe,EACjC;GACC,IAAI5D,KAAK,GAAG,IAAI,CAAC6D,aAAa,CAACD,OAAO,CAAC;GACvC,IAAI5D,KAAK,EACT;KACC,IAAIA,KAAK,CAAChC,IAAI,KAAK,qBAAqB,EACxC;OACCgC,KAAK,GAAGA,KAAK,CAACF,eAAe,CAAC,CAAC,CAAC;;KAEjCE,KAAK,CAAC+D,QAAQ,EAAE;;CAElB;CAAC,2BAEgBH,OAAe,EAChC;GACC,MAAM5D,KAAK,GAAG,IAAI,CAAC6D,aAAa,CAACD,OAAO,CAAC;GACzC,IAAI5D,KAAK,EACT;KACC,4CAAI,gCAAeA,KAAK;;CAE1B;CAAC,wBAEaA,KAAK,EACnB;;GAECtC,MAAM,CAACsG,YAAY,CAACC,aAAa,GAAGjE,KAAK;GACzCY,aAAG,CAACkB,KAAK,CAAC,IAAI,CAAChB,cAAc,CAACoD,KAAK,EAAE,SAAS,EAAE,MAAM,CAAC;GAEvD,4CAAI;GACJ,4CAAI,4CAAqBlE,KAAK;GAC9B,4CAAI,8CAAsBA,KAAK;GAC/B,4CAAI;GAEJ,IAAImE,QAAQ,CAACC,cAAc,CAAC,oBAAoB,CAAC,EACjD;KACCxD,aAAG,CAACkB,KAAK,CAACqC,QAAQ,CAACC,cAAc,CAAC,oBAAoB,CAAC,EAAE,SAAS,EAAE,MAAM,CAAC;;GAE5EC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC;CACb;CAAC,sBAGD;;GAEC,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACxD,cAAc,CAACyD,GAAG,CAACxB,MAAM,EAAEuB,CAAC,EAAE,EACvD;KACC,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,CAAC,EAAEA,CAAC,EAAE,EAC1B;;OAEC5D,aAAG,CAACkB,KAAK,CAAC,IAAI,CAAChB,cAAc,CAACyD,GAAG,CAACD,CAAC,CAAC,CAACE,CAAC,CAAC,EAAE,SAAS,EAAE,MAAM,CAAC;;;CAG9D;CAAC,8BAEmBxE,KAAK,EACzB;GACC,MAAMkC,KAAK,GACVlC,KAAK,CAAChC,IAAI,KAAK,qBAAqB,GACjCgC,KAAK,CAACF,eAAe,CAAC,CAAC,CAAC,CAACsC,UAAU,CAACC,KAAK,GACzCrC,KAAK,CAACoC,UAAU,CAACC,KACpB;GACD,MAAM;KAAEJ,IAAI;KAAEwC;IAAM,GAAGlE,aAAG,CAACC,MAAM,gBAAC;;8CAEQ,CAAqC;eACpE,CAAqB;;GAEhC,GAH4CC,cAAI,CAACC,MAAM,CAAC,IAAI,CAAC0B,UAAU,CAACC,KAAK,CAAC,EACjE5B,cAAI,CAACC,MAAM,CAACwB,KAAK,CAAC,CAE9B;GACDI,eAAK,CAACpE,IAAI,CAACuG,IAAI,EAAE,OAAO,EAAE,4CAAI,gCAAevG,IAAI,CAAC,IAAI,CAAC,CAAC;GAExD,4CAAI,sCAAmB+D,IAAI;GAC3BrB,aAAG,CAACC,MAAM,yCAAC,IAAI,qCAAkB,IAAI,CAACC,cAAc,CAACoD,KAAK,CAACpF,UAAU,CAAC;CACvE;CAAC,+BAEoBkB,KAAK,EAC1B;GACC,4CAAI,wCAAoBO,aAAG,CAACC,MAAM,gBAAC,aAAW,EAAC;GAC/CI,aAAG,CAACC,MAAM,yCAAC,IAAI,uCAAmB,IAAI,CAACC,cAAc,CAACoD,KAAK,CAACpF,UAAU,CAAC;GAEvEkB,KAAK,CAAC/B,IAAI,yCAAC,IAAI,sCAAkB;CAClC;CAAC,gCAGD;GACC,MAAMyG,UAAU,GAAG,IAAIC,iBAAM,CAAC;KAC7BC,IAAI,EAAElH,MAAM,CAACmF,MAAM,CAACgC,eAAe;KACnCC,IAAI,EAAEH,iBAAM,CAACI,IAAI,CAACC,WAAW;KAC7BC,KAAK,EAAEN,iBAAM,CAACO,KAAK,CAACC,YAAY;KAChCC,MAAM,EAAE,IAAI;KACZC,OAAO,EAAE,4CAAI,gCAAenH,IAAI,CAAC,IAAI;IACrC,CAAC;GACF,4CAAI,sCAAmBqC,aAAG,CAACC,MAAM,gBAAC,QAAK,CAAsB,QAAM,GAA1BkE,UAAU,CAAClE,MAAM,EAAE,CAAQ;GACpEI,aAAG,CAACkB,KAAK,CAAC4C,UAAU,CAACY,YAAY,EAAE,EAAE,QAAQ,EAAE,MAAM,CAAC;GACtD1E,aAAG,CAACC,MAAM,yCAAC,IAAI,qCAAkB,IAAI,CAACC,cAAc,CAACoD,KAAK,CAACpF,UAAU,CAAC;CACvE;CAAC,0BAGD;GACC8B,aAAG,CAACkB,KAAK,CAAC,IAAI,CAAChB,cAAc,CAACoD,KAAK,EAAE,SAAS,EAAE,OAAO,CAAC;GAExDtD,aAAG,CAAClC,MAAM,yCAAC,IAAI,oCAAiB;GAChCkC,aAAG,CAAClC,MAAM,yCAAC,IAAI,sCAAkB;GACjCkC,aAAG,CAAClC,MAAM,yCAAC,IAAI,oCAAiB;GAEhC,4CAAI,sCAAmB,IAAI;GAC3B,4CAAI,wCAAoB,IAAI;GAC5B,4CAAI,sCAAmB,IAAI;GAE3B,IAAIyF,QAAQ,CAACC,cAAc,CAAC,oBAAoB,CAAC,EACjD;KACCxD,aAAG,CAACkB,KAAK,CAACqC,QAAQ,CAACC,cAAc,CAAC,oBAAoB,CAAC,EAAE,SAAS,EAAE,OAAO,CAAC;;;;GAI7E1G,MAAM,CAACsG,YAAY,CAACC,aAAa,GAAG,IAAI;GACxCvG,MAAM,CAAC6H,kBAAkB,GAAG7H,MAAM,CAACsG,YAAY,CAACwB,SAAS,EAAE;GAC3D9H,MAAM,CAAC+H,MAAM,EAAE;CAChB;CAAC,4BAEiBC,WAAW,EAC7B;GACC,MAAMC,cAAc,GAAG,MAAM;KAC3B,IAAIC,eAAI,CAAC;OACTF,WAAW;OACX3G,EAAE,EAAG,oBAAmB0B,cAAI,CAACoF,SAAS,EAAG,EAAC;OAC1CC,QAAQ,EAAE,GAAG;OACbC,QAAQ,EAAE,IAAI;OACdC,aAAa,EAAE;SAAEC,WAAW,EAAE;QAAM;OACpCC,SAAS,EAAE,KAAK;OAChBC,KAAK,0CAAE,IAAI;MACX,CAAC,CAAEC,IAAI,EAAE;IACV;GAED,IAAI,CAACC,oBAAU,CAACC,QAAQ,CAAC,cAAc,CAAC,EACxC;KACCC,iBAAO,CAACC,aAAa,CAAC,YAAY,CAAC,CACjCC,IAAI,CAAC,MAAMd,cAAc,EAAE,CAAC,CAC5Be,KAAK,CAAC,MAAM,EAAE,CAAC;KAGjB;;GAGDf,cAAc,EAAE;CACjB;CAAC,+BAGD;GACC,MAAMgB,WAAW,GAAG,CAACzD,IAAI,EAAE0B,IAAI,KAAK;KACnC,MAAM;OAAExB,QAAQ;OAAEE;MAAW,2CAAG,IAAI,CAAC1F,WAAW,8BAAcsF,IAAI,CAAC;KAEnE,OAAO3C,aAAG,CAACC,MAAM,gBAAC;;;6BAGM,CAAW;;;oCAGJ,CAAY;;;;aAInC,CAAoB;;IAE5B,GAT0B4C,QAAQ,EAGDE,SAAS,EAIhC7C,cAAI,CAACC,MAAM,CAACkE,IAAI,CAAC;IAG3B;GAED,MAAMuB,KAAK,GAAG,CACb;KACCpH,EAAE,EAAE,GAAG;KACP6H,IAAI,EAAED,WAAW,CAAC,KAAK,EAAEjJ,MAAM,CAACmF,MAAM,CAACgE,qBAAqB,CAAC;KAC7DxB,OAAO,EAAE,CAAC1G,KAAK,EAAEmI,QAAkB,KAAK;OACvCA,QAAQ,CAACC,aAAa,EAAE,CAACC,KAAK,EAAE;OAChC,4CAAI;OACJ,4CAAI;;IAEL,EACD;KACCjI,EAAE,EAAE,GAAG;KACP6H,IAAI,EAAED,WAAW,CAAC,OAAO,EAAEjJ,MAAM,CAACmF,MAAM,CAACoE,mBAAmB,CAAC;KAC7D5B,OAAO,EAAE,CAAC1G,KAAK,EAAEmI,QAAkB,KAAK;OACvCA,QAAQ,CAACC,aAAa,EAAE,CAACC,KAAK,EAAE;OAChC,4CAAI;OACJ,4CAAI;;IAEL,CACD;GAED,IAAIE,YAAY,GAAG,KAAK;GACxB,IAAIC,cAAc,GAAG,KAAK;GAC1B,IAAI,CAACrH,eAAe,CAACC,OAAO,CAAEC,KAAK,IAAK;KACvC,IAAIA,KAAK,CAAChC,IAAI,KAAK,6BAA6B,EAChD;OACCkJ,YAAY,GAAG,IAAI;;KAGpB,IAAIlH,KAAK,CAAChC,IAAI,KAAK,2BAA2B,EAC9C;OACCmJ,cAAc,GAAG,IAAI;;IAEtB,CAAC;GAEF,IAAI,CAACD,YAAY,EACjB;KACCf,KAAK,CAACzC,IAAI,CAAC;OACV3E,EAAE,EAAE,GAAG;OACP6H,IAAI,EAAED,WAAW,CAAC,MAAM,EAAEjJ,MAAM,CAACmF,MAAM,CAACuE,oBAAoB,CAAC;OAC7D/B,OAAO,EAAE,CAAC1G,KAAK,EAAEmI,QAAkB,KAAK;SACvCA,QAAQ,CAACC,aAAa,EAAE,CAACC,KAAK,EAAE;SAChC,4CAAI;SACJ,4CAAI;;MAEL,CAAC;;GAGH,IAAI,CAACG,cAAc,EACnB;KACChB,KAAK,CAACzC,IAAI,CAAC;OACV3E,EAAE,EAAE,GAAG;OACP6H,IAAI,EAAED,WAAW,CAAC,KAAK,EAAEjJ,MAAM,CAACmF,MAAM,CAACwE,mBAAmB,CAAC;OAC3DhC,OAAO,EAAE,CAAC1G,KAAK,EAAEmI,QAAkB,KAAK;SACvCA,QAAQ,CAACC,aAAa,EAAE,CAACC,KAAK,EAAE;SAChC,4CAAI;SACJ,4CAAI;;MAEL,CAAC;;GAGH,OAAOb,KAAK;CACb;CAAC,gCAGD;GACC,MAAMmB,GAAG,GAAG,IAAI,CAACvJ,YAAY,CAACwJ,SAAS,CAAC,CAAC,CAAC;GAC1C,MAAMC,IAAI,GAAGF,GAAG,CAACG,UAAU,CAAC,CAAC,CAAC,CAAC;GAC/BD,IAAI,CAAC/E,SAAS,GAAG,EAAE;GAEnB,MAAMiF,QAAQ,GAAGhK,MAAM,CAACiK,cAAc,CAAC,6BAA6B,CAAC;GACrE,IAAI,CAAC7H,eAAe,CAAC4D,IAAI,CAACgE,QAAQ,CAAC;GACnCA,QAAQ,CAAC5G,cAAc,GAAG,IAAI;GAC9B4G,QAAQ,CAACtH,iBAAiB,CAAC,IAAI,CAACwH,sBAAsB,EAAE,CAAC;GAEzD,4CAAI,gCAAeF,QAAQ;CAC5B;CAAC,6BAGD;GACC,MAAMG,mBAAmB,GAAGnK,MAAM,CAACiK,cAAc,CAAC,qBAAqB,CAAC;GACxE,MAAMG,2BAA2B,GAAGpK,MAAM,CAACiK,cAAc,CAAC,6BAA6B,CAAC;GAExFE,mBAAmB,CAAC/H,eAAe,CAAC4D,IAAI,CAACoE,2BAA2B,CAAC;GACrEA,2BAA2B,CAAChH,cAAc,GAAG+G,mBAAmB;GAEhE,MAAMP,GAAG,GAAG,IAAI,CAACvJ,YAAY,CAACwJ,SAAS,CAAC,CAAC,CAAC;GAC1C,MAAMC,IAAI,GAAGF,GAAG,CAACG,UAAU,CAAC,CAAC,CAAC,CAAC;GAC/BD,IAAI,CAAC/E,SAAS,GAAG,EAAE;GAEnB,IAAI,CAAC3C,eAAe,CAAC4D,IAAI,CAACmE,mBAAmB,CAAC;GAC9CA,mBAAmB,CAAC/G,cAAc,GAAG,IAAI;GACzC+G,mBAAmB,CAACzH,iBAAiB,CAAC,IAAI,CAACwH,sBAAsB,EAAE,CAAC;GAEpEE,2BAA2B,CAAC/D,QAAQ,EAAE;CACvC;CAAC,2BAGD;GACC,MAAM8D,mBAAmB,GAAGnK,MAAM,CAACiK,cAAc,CAAC,qBAAqB,CAAC;GACxE,MAAMI,aAAa,GAAGrK,MAAM,CAACiK,cAAc,CAAC,eAAe,CAAC;GAE5DE,mBAAmB,CAAC/H,eAAe,CAAC4D,IAAI,CAACqE,aAAa,CAAC;GACvDA,aAAa,CAACjH,cAAc,GAAG+G,mBAAmB;GAElD,MAAMP,GAAG,GAAG,IAAI,CAACvJ,YAAY,CAACwJ,SAAS,CAAC,CAAC,CAAC;GAC1C,MAAMC,IAAI,GAAGF,GAAG,CAACG,UAAU,CAAC,CAAC,CAAC,CAAC;GAC/BD,IAAI,CAAC/E,SAAS,GAAG,EAAE;GAEnB,IAAI,CAAC3C,eAAe,CAAC4D,IAAI,CAACmE,mBAAmB,CAAC;GAC9CA,mBAAmB,CAAC/G,cAAc,GAAG,IAAI;GACzC+G,mBAAmB,CAACzH,iBAAiB,CAAC,IAAI,CAACwH,sBAAsB,EAAE,CAAC;GAEpEG,aAAa,CAAChE,QAAQ,EAAE;CACzB;CAAC,8BAGD;GACC,MAAMuD,GAAG,GAAG,IAAI,CAACvJ,YAAY,CAACwJ,SAAS,CAAC,CAAC,CAAC;GAC1C,MAAMC,IAAI,GAAGF,GAAG,CAACG,UAAU,CAAC,CAAC,CAAC,CAAC;GAC/BD,IAAI,CAAC/E,SAAS,GAAG,EAAE;GAEnB,MAAMiF,QAAQ,GAAGhK,MAAM,CAACiK,cAAc,CAAC,2BAA2B,CAAC;GACnE,IAAI,CAAC7H,eAAe,CAAC4D,IAAI,CAACgE,QAAQ,CAAC;GACnCA,QAAQ,CAAC5G,cAAc,GAAG,IAAI;GAC9B4G,QAAQ,CAACtH,iBAAiB,CAAC,IAAI,CAACwH,sBAAsB,EAAE,CAAC;GAEzD,4CAAI,gCAAeF,QAAQ;CAC5B;CAAC,sBArpBWjK,aAAa;GAAA;CAAA;CAypB1BC,MAAM,CAACsK,kBAAkB,GAAG,UAASC,IAAI,EAAElJ,EAAE,EAC7C;GACC,MAAM2I,QAAQ,GAAGhK,MAAM,CAACsG,YAAY,CAAClE,eAAe,CAACoI,IAAI,CAAEC,GAAG,IAAKA,GAAG,CAACxH,IAAI,KAAK5B,EAAE,CAAC;GACnF,IAAI2I,QAAQ,EACZ;KACC,QAAQO,IAAI;OAEX,KAAK,MAAM;SACVP,QAAQ,CAACrI,aAAa,EAAE;SACxB;OACD,KAAK,SAAS;SACbqI,QAAQ,CAACpI,UAAU,EAAE;SACrB;OACD,KAAK,OAAO;SACXoI,QAAQ,CAACnI,gBAAgB,EAAE;SAC3B;OACD,KAAK,QAAQ;SACZmI,QAAQ,CAAClI,WAAW,EAAE;SACtB;OACD;;;;KAID,IAAI4I,EAAE,CAACpK,IAAI,CAACqK,UAAU,CAACX,QAAQ,CAACjJ,MAAM,CAAC,EACvC;OACCiJ,QAAQ,CAACjJ,MAAM,EAAE;;;CAGpB,CAAC;;;;;;;;"}