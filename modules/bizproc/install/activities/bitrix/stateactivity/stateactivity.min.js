StateActivity=function(){var e=new BizProcActivity;e.Type="StateActivity";e.Draw=function(i){e.main=i.appendChild(document.createElement("TABLE"));e.main.cellPadding=0;e.main.width="220";e.main.cellSpacing=0;e.main.style.fontSize="12px";e.main.style.textAlign="left";var t=e.main.insertRow(-1);t.id=e.Name;var n=t.insertCell(-1);n.width="5";n.style.background="url(/bitrix/images/bizproc/stat_hl.gif)";var r=t.insertCell(-1);r.noWrap="nowrap";r.style.background="url(/bitrix/images/bizproc/stat_hbg.gif)";r.style.height="24px";n=t.insertCell(-1);n.width="5";n.style.background="url(/bitrix/images/bizproc/stat_hr.gif)";var a=r.appendChild(document.createElement("TABLE"));a.width="100%";a.cellPadding=0;a.cellSpacing=0;a.style.fontSize="12px";t=a.insertRow(-1);n=t.insertCell(-1);var l=n.appendChild(document.createElement("DIV"));l.innerHTML="<b>"+HTMLEncode(e["Properties"]["Title"])+"</b>";l.style.padding="5px";l.style.marginLeft="5px";l.style.width="160px";l.style.overflow="hidden";l.style.whiteSpace="nowrap";l.title=e["Properties"]["Title"];l.align="left";l.classList.add("bizproc-StateActivity-title");l.onmousedown=function(i){var t=DragNDrop.StartDrag(i,e);t.innerHTML=e.main.innerHTML;t.style.width=e.main.offsetWidth+"px"};e.lastDrop=false;if(!e.h1id){e.h1id=DragNDrop.AddHandler("ondragging",e.ondragging);e.h2id=DragNDrop.AddHandler("ondrop",e.ondrop)}n=t.insertCell(-1);n.className="statset";n.onclick=e.OnSettingsClick;n=t.insertCell(-1);n.className="statdel";n.onclick=e.OnRemoveClick;t=e.main.insertRow(-1);n=t.insertCell(-1);n.style.background="url(/bitrix/images/bizproc/stat_l.gif) left top repeat-y";var o=t.insertCell(-1);n=t.insertCell(-1);n.style.background="url(/bitrix/images/bizproc/stat_r.gif) right top repeat-y";o.style.backgroundColor="#ffffff";o.style.padding="5px";e.commandTable=o.appendChild(_crt(1,1));e.commandTable.cellPadding="4";e.commandTable.rows[0].cells[0].align="left";e.commandTable.rows[0].cells[0].style.fontSize="12px";var c=e.commandTable.rows[0].cells[0].appendChild(jsUtils.CreateElement("A",{href:"javascript:void(0)"}));c.onclick=e.ShowAddMenu;c.style.textDecoration="none";c.innerHTML=BPMESS["STATEACT_ADD"]+' <img src="/bitrix/images/bizproc/add.gif" border="0">';for(var d=0;d<e.childActivities.length;d++){var s,p=e.commandTable.insertRow(-1),v=p.insertCell(-1),m;if(e.childActivities[d]["Type"]=="EventDrivenActivity"){s=e.childActivities[d].childActivities[0]["Properties"]["Title"];if(e.childActivities[d].childActivities[0].Type!="DelayActivity")m="cmd";else m="delay"}else{if(e.childActivities[d]["Properties"]["Title"])s=e.childActivities[d]["Properties"]["Title"];if(e.childActivities[d].Type=="StateFinalizationActivity")m="fin";else m="init"}p.id=e.childActivities[d].Name;var A=v.appendChild(document.createElement("TABLE")),h=A.insertRow(-1),y=h.insertCell(-1);A.style.fontSize="12px";A.width="100%";y.width=12;y.height=12;y.style.background="url(/bitrix/images/bizproc/state"+m+".gif) center center no-repeat";y=h.insertCell(-1);y.innerHTML=HTMLEncode(s);y.onclick=e.clickrow;y.title=BPMESS["STATEACT_EDITBP"];y=h.insertCell(-1);y.width=20;y.height=12;y.style.background="url(/bitrix/images/bizproc/state_set.gif) center center no-repeat";y.title=BPMESS["STATEACT_SETT"];y.onclick=e.settings;y=h.insertCell(-1);y.width=12;y.height=12;y.style.background="url(/bitrix/images/bizproc/state_del.gif) center center no-repeat";y.title=BPMESS["STATEACT_DEL"];y.onclick=e.remove;v.style.borderTop="1px solid #e5e5e5";v.style.fontSize="12px";v.style.cursor="pointer";v.onmouseover=function(e){this.style.backgroundColor="#f7f7f7"};v.onmouseout=function(e){this.style.backgroundColor="#FFFFFF"}}t=e.main.insertRow(-1);n=t.insertCell(-1);n.width="5";n.style.background="url(/bitrix/images/bizproc/stat_bl.gif)";n=t.insertCell(-1);n.style.background="url(/bitrix/images/bizproc/stat_b.gif)";n.height="5";n=t.insertCell(-1);n.width="5";n.style.background="url(/bitrix/images/bizproc/stat_br.gif)"};e.ondragging=function(i,t,n){var r=e.main;var a=BX.pos(r);if(a.left<t&&t<a.right&&a.top<n&&n<a.bottom){e.lastDrop=r;r.style.opacity=".25";return}if(e.lastDrop){r.style.opacity="";e.lastDrop=false}};e.ondrop=function(i,t,n){if(e.lastDrop){e.lastDrop.style.opacity="";e.lastDrop=false;if(e!==DragNDrop.obj&&e.parentActivity.ReplaceChild){e.parentActivity.ReplaceChild(e,DragNDrop.obj)}}};e.reDraw=function(){var i=e.main.parentNode;i.removeChild(e.main);e.Draw(i)};e.OnRemoveClick=function(){e.parentActivity.RemoveChild(e)};e.remove=function(i){var t=this.parentNode.parentNode.parentNode.parentNode.parentNode.id;for(var n in e.childActivities){if(!e.childActivities.hasOwnProperty(n)){continue}if(e.childActivities[n]["Name"]==t){e.commandTable.deleteRow(parseInt(n)+1);e.RemoveChild(e.childActivities[n]);e.parentActivity.DrawLines();break}}};e.settings=function(i){var t=this.parentNode.parentNode.parentNode.parentNode.parentNode.id;for(var n in e.childActivities){if(!e.childActivities.hasOwnProperty(n)){continue}if(e.childActivities[n]["Name"]==t){if(e.childActivities[n].Type=="EventDrivenActivity")e.childActivities[n].childActivities[0].Settings();else e.childActivities[n].Settings();break}}};e.clickrow=function(i){var t=this.parentNode.parentNode.parentNode.parentNode.parentNode.id;for(var n in e.childActivities){if(!e.childActivities.hasOwnProperty(n)){continue}if(e.childActivities[n]["Name"]==t){e.SequentialShow(e.childActivities[n]);break}}};e.HideRows=function(){for(var i=0;i<e.parentActivity.__l.length;i++)for(var t=0;t<5;t++)e.parentActivity.__l[i][t].style.display="none"};e.SequentialShow=function(i){rootActivity._redrawObject=i;e.parentActivity.Table.style.display="none";e.HideRows();e.__header=e.parentActivity.Table.parentNode.appendChild(document.createElement("DIV"));e.__header.style.fontSize="12px";var t=e.__header.appendChild(document.createElement("A"));t.href="javascript:void(0)";t.onclick=e.SequentialHide;t.innerHTML=HTMLEncode(e.Properties["Title"]);var n=e.__header.appendChild(document.createElement("span"));n.innerHTML=" - "+(i.Type!="EventDrivenActivity"?HTMLEncode(i.Properties["Title"]):HTMLEncode(i.childActivities[0].Properties["Title"]));e.__seq=e.parentActivity.Table.parentNode.appendChild(document.createElement("DIV"));e.__footer=e.parentActivity.Table.parentNode.appendChild(document.createElement("DIV"));var r=e.__footer.appendChild(jsUtils.CreateElement("INPUT",{type:"button",value:BPMESS["STATEACT_BACK_1"]}));r.onclick=e.SequentialHide;r.style.margin="15px";if(document.getElementById("bizprocsavebuttons"))document.getElementById("bizprocsavebuttons").style.display="none";i.Draw(e.__seq)};e.SequentialHide=function(){try{e.parentActivity.Table.style.display="table"}catch(i){e.parentActivity.Table.style.display="block"}e.__header.parentNode.removeChild(e.__header);e.__seq.parentNode.removeChild(e.__seq);e.__footer.parentNode.removeChild(e.__footer);if(document.getElementById("bizprocsavebuttons"))document.getElementById("bizprocsavebuttons").style.display="block";rootActivity._redrawObject=null;arWorkflowTemplate=rootActivity.Serialize();ReDraw()};e.AddInitialize=function(){var i=e.commandTable.insertRow(1);var t=i.insertCell(-1);t.innerHTML="";var n=CreateActivity("StateInitializationActivity");e.childActivities.push(n);n.parentActivity=e;e.SequentialShow(n)};e.AddCommand=function(){var i=CreateActivity("EventDrivenActivity");var t=CreateActivity("HandleExternalEventActivity");i.childActivities.push(t);t.parentActivity=i;var n=e.commandTable.insertRow(1);var r=n.insertCell(-1);r.innerHTML="";e.childActivities.push(i);i.parentActivity=e;t.Settings()};e.AddDelayActivity=function(){var i=CreateActivity("EventDrivenActivity");var t=CreateActivity("DelayActivity");i.childActivities.push(t);t.parentActivity=i;var n=e.commandTable.insertRow(1);var r=n.insertCell(-1);r.innerHTML="";e.childActivities.push(i);i.parentActivity=e;t.Settings()};e.AddFinilize=function(){var i=e.commandTable.insertRow(1);var t=i.insertCell(-1);t.innerHTML="";var n=CreateActivity("StateFinalizationActivity");e.childActivities.push(n);n.parentActivity=e;e.SequentialShow(n)};e.ShowAddMenu=function(i){e.menu=new PopupMenu("state_float_menu");e.menu.Create(2e3);if(e.menu.IsVisible())return;var t=false,n=false;for(var r=0;r<e.childActivities.length;r++){if(e.childActivities[r].Type=="StateInitializationActivity")t=true;if(e.childActivities[r].Type=="StateFinalizationActivity")n=true}e.menuItems=new Array;e.menuItems.push({ID:"2",TEXT:BPMESS["STATEACT_MENU_COMMAND"],ONCLICK:"__StateActivityAdd('command', '"+e.Name+"')"});e.menuItems.push({ID:"3",TEXT:BPMESS["STATEACT_MENU_DELAY"],ONCLICK:"__StateActivityAdd('delay', '"+e.Name+"')"});if(!t)e.menuItems.push({ID:"1",TEXT:BPMESS["STATEACT_MENU_INIT_1"],ONCLICK:"__StateActivityAdd('init', '"+e.Name+"')"});if(!n)e.menuItems.push({ID:"5",TEXT:BPMESS["STATEACT_MENU_FIN_1"],ONCLICK:"__StateActivityAdd('finish', '"+e.Name+"')"});e.menu.SetItems(e.menuItems);e.menu.BuildItems();var a=jsUtils.GetRealPos(this);a["bottom"]+=1;e.menu.PopupShow(a)};e.RemoveResources=function(){DragNDrop.RemoveHandler("ondragging",e.h1id);DragNDrop.RemoveHandler("ondrop",e.h2id);e.main.parentNode.removeChild(e.main)};return e};__StateActivityAdd=function(e,i){var t;for(var n=0;n<rootActivity.childActivities.length;n++){if(rootActivity.childActivities[n]["Name"]==i){t=rootActivity.childActivities[n];switch(e){case"init":t.AddInitialize();break;case"command":t.AddCommand();break;case"delay":t.AddDelayActivity();break;case"finish":t.AddFinilize();break}if(BX.type.isFunction(t.reDraw)){t.reDraw()}break}}};
//# sourceMappingURL=stateactivity.map.js