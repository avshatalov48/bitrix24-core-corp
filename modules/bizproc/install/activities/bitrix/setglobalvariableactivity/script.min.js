this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,t,i,a,r,s,l){"use strict";var n,o,u,p,c,d,b;function v(e,t){g(e,t);t.add(e)}function h(e,t,i){g(e,t);t.set(e,i)}function g(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function f(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var y=new WeakMap;var m=new WeakMap;var T=new WeakMap;var w=new WeakSet;var P=new WeakSet;var I=new WeakSet;var H=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));v(babelHelpers.assertThisInitialized(i),I);v(babelHelpers.assertThisInitialized(i),P);v(babelHelpers.assertThisInitialized(i),w);h(babelHelpers.assertThisInitialized(i),y,{writable:true,value:void 0});h(babelHelpers.assertThisInitialized(i),m,{writable:true,value:void 0});h(babelHelpers.assertThisInitialized(i),T,{writable:true,value:void 0});i.setEventNamespace("BX.Bizproc.Activity.SetGlobalVariable.Menu");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),m,{});if(a.Type.isPlainObject(e.popupOptions)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),m,a.Runtime.clone(e.popupOptions));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),m).target=e.popupOptions.target;if(a.Type.isNil(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),m).autoHide)){babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),m).autoHide=true}if(a.Type.isNil(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),m).closeByEsc)){babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),m).closeByEsc=true}if(a.Type.isNil(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),m).cacheable)){babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),m).cacheable=true}if(!a.Type.isArray(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),m).buttons)){babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),m).buttons=f(babelHelpers.assertThisInitialized(i),I,S).call(babelHelpers.assertThisInitialized(i))}}if(a.Type.isPlainObject(e.contentData)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),T,a.Runtime.clone(e.contentData));if(!a.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),T).rows)){babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),T).rows=[]}babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),T).values={}}if(a.Type.isPlainObject(e.events)){i.subscribeFromOptions(e.events)}return i}babelHelpers.createClass(t,[{key:"create",value:function e(){if(a.Type.isNil(babelHelpers.classPrivateFieldGet(this,y))&&Object.keys(babelHelpers.classPrivateFieldGet(this,m)).length>0){babelHelpers.classPrivateFieldSet(this,y,new i.Popup({id:babelHelpers.classPrivateFieldGet(this,m).id,bindElement:babelHelpers.classPrivateFieldGet(this,m).target,className:"bizproc-automation-popup-set",autoHide:babelHelpers.classPrivateFieldGet(this,m).autoHide,closeByEsc:babelHelpers.classPrivateFieldGet(this,m).closeByEsc,offsetLeft:babelHelpers.classPrivateFieldGet(this,m).offsetLeft,offsetTop:babelHelpers.classPrivateFieldGet(this,m).offsetTop,overlay:babelHelpers.classPrivateFieldGet(this,m).overlay,content:f(this,w,A).call(this),buttons:babelHelpers.classPrivateFieldGet(this,m).buttons,events:babelHelpers.classPrivateFieldGet(this,m).events}))}return this}},{key:"createEmptyRow",value:function e(t){var i=a.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-popup-settings-dropdown" readonly="readonly"></div>'])));a.Event.bind(i,"click",f(this,P,G).bind(this,a.Text.toInteger(t)));return i}},{key:"show",value:function e(){if(a.Type.isNil(babelHelpers.classPrivateFieldGet(this,y))){this.create();if(!babelHelpers.classPrivateFieldGet(this,y)){return}}if(babelHelpers.classPrivateFieldGet(this,y).isShown()){return}babelHelpers.classPrivateFieldGet(this,y).show()}},{key:"close",value:function e(){if(a.Type.isNil(babelHelpers.classPrivateFieldGet(this,y))){return}if(babelHelpers.classPrivateFieldGet(this,y).isShown()){babelHelpers.classPrivateFieldGet(this,y).close()}}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,T).values={};babelHelpers.classPrivateFieldGet(this,T).rows.forEach((function(e){delete e.targetNode;delete e.inputNode;delete e.labelNode}));if(!babelHelpers.classPrivateFieldGet(this,y)){return}if(!babelHelpers.classPrivateFieldGet(this,y).isDestroyed()){babelHelpers.classPrivateFieldGet(this,y).destroy()}babelHelpers.classPrivateFieldSet(this,y,null)}},{key:"getRowValue",value:function e(t){var i;return(i=babelHelpers.classPrivateFieldGet(this,T).values[t])!==null&&i!==void 0?i:null}},{key:"setRowValue",value:function e(t,i,s){if(a.Type.isNumber(t)&&t<babelHelpers.classPrivateFieldGet(this,T).rows.length&&a.Type.isString(i)){babelHelpers.classPrivateFieldGet(this,T).values[t]=i;if(babelHelpers.classPrivateFieldGet(this,T).rows[t].inputNode){babelHelpers.classPrivateFieldGet(this,T).rows[t].inputNode.value=i;if(a.Type.isStringFilled(s)){babelHelpers.classPrivateFieldGet(this,T).rows[t].inputNode.innerText=a.Text.encode(s)}}this.emit("onSetRowValue",new r.BaseEvent({data:{value:i,rowIndex:a.Text.toInteger(t),menu:this}}))}}},{key:"getRowTarget",value:function e(t){var i,a;return(i=(a=babelHelpers.classPrivateFieldGet(this,T).rows[t])===null||a===void 0?void 0:a.targetNode)!==null&&i!==void 0?i:null}},{key:"getRowInput",value:function e(t){var i,a;return(i=(a=babelHelpers.classPrivateFieldGet(this,T).rows[t])===null||a===void 0?void 0:a.inputNode)!==null&&i!==void 0?i:null}},{key:"replaceRowTarget",value:function e(t,i,r){if(a.Type.isNumber(t)&&t<babelHelpers.classPrivateFieldGet(this,T).rows.length){if(a.Type.isElementNode(babelHelpers.classPrivateFieldGet(this,T).rows[t].targetNode)&&a.Type.isElementNode(i)){a.Dom.replace(babelHelpers.classPrivateFieldGet(this,T).rows[t].targetNode,i);babelHelpers.classPrivateFieldGet(this,T).rows[t].targetNode=i;babelHelpers.classPrivateFieldGet(this,T).rows[t].inputNode=r}}}},{key:"setRowLabel",value:function e(t,i){var r;if(a.Type.isNumber(t)&&t<babelHelpers.classPrivateFieldGet(this,T).rows.length&&a.Type.isStringFilled(i)&&a.Type.isElementNode((r=babelHelpers.classPrivateFieldGet(this,T).rows[t])===null||r===void 0?void 0:r.labelNode)){babelHelpers.classPrivateFieldGet(this,T).rows[t].labelNode.innerText=a.Text.encode(i)}}},{key:"target",get:function e(){return babelHelpers.classPrivateFieldGet(this,m).target}}]);return t}(r.EventEmitter);function A(){var e=this;var t=a.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['<form class="bizproc-automation-popup-select-block"></form>'])));var i=function i(r){var s;var l=babelHelpers.classPrivateFieldGet(e,T).rows[r];var n="";if(l.onClick){var o;n=a.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="bizproc-automation-popup-settings-dropdown" readonly="readonly">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t"])),a.Text.encode(((o=l.values[0])===null||o===void 0?void 0:o.text)||""))}else{n=a.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['<select class="bizproc-automation-popup-settings-dropdown"></select>'])));if(a.Type.isArrayFilled(l.values)){l.values.forEach((function(e){var t=e.id,i=e.text;a.Dom.append(a.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['<option value="','">',"</option>"])),a.Text.encode(t),a.Text.encode(i)),n)}));e.setRowValue(0,l.values[0].id)}a.Event.bind(n,"change",(function(t){e.setRowValue(a.Text.toInteger(r),t.target.value)}))}a.Event.bind(n,"click",f(e,P,G).bind(e,a.Text.toInteger(r)));var v=a.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="bizproc-automation-robot-settings-title">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),a.Text.encode((s=l.label)!==null&&s!==void 0?s:""));l.targetNode=n;l.inputNode=n;l.labelNode=v;a.Dom.append(a.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="bizproc-automation-popup-settings">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t"])),v,n),t)};for(var r in babelHelpers.classPrivateFieldGet(this,T).rows){i(r)}return t}function G(e){var t;if(a.Type.isFunction((t=babelHelpers.classPrivateFieldGet(this,T).rows[e])===null||t===void 0?void 0:t.onClick)){var i=new r.BaseEvent({data:{menu:this}});i.setTarget(babelHelpers.classPrivateFieldGet(this,T).rows[e].targetNode);babelHelpers.classPrivateFieldGet(this,T).rows[e].onClick.call(this,i)}}function S(){return[new i.PopupWindowButton({text:a.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CHOOSE"),className:"webform-button webform-button-create",events:{click:function(){var e=new r.BaseEvent({data:{menu:this,values:babelHelpers.classPrivateFieldGet(this,T).values,target:babelHelpers.classPrivateFieldGet(this,m).target}});this.emit("onApplyChangesClick",e);this.close()}.bind(this)}}),new i.PopupWindowButtonLink({text:a.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CANCEL"),className:"popup-window-button-link",events:{click:function(){this.emit("onDiscardChangesClick",new r.BaseEvent({}));this.close()}.bind(this)}})]}var R;function F(e,t){O(e,t);t.add(e)}function x(e,t,i){O(e,t);t.set(e,i)}function O(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function E(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var V=new WeakMap;var k=new WeakMap;var _=new WeakMap;var B=new WeakMap;var M=new WeakMap;var L=new WeakSet;var N=new WeakSet;var D=new WeakSet;var C=new WeakSet;var z=new WeakSet;var W=new WeakSet;var j=function(e){babelHelpers.inherits(t,e);function t(){var e;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var r=arguments.length>1?arguments[1]:undefined;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));F(babelHelpers.assertThisInitialized(e),W);F(babelHelpers.assertThisInitialized(e),z);F(babelHelpers.assertThisInitialized(e),C);F(babelHelpers.assertThisInitialized(e),D);F(babelHelpers.assertThisInitialized(e),N);F(babelHelpers.assertThisInitialized(e),L);x(babelHelpers.assertThisInitialized(e),V,{writable:true,value:{width:480,height:300,multiple:false,dropdownMode:true,enableSearch:true,showAvatars:false,compactView:true,tagSelectorOptions:{textBoxWidth:400},targetNode:null,events:{},recentTabOptions:{},searchTabOptions:{},searchOptions:{}}});x(babelHelpers.assertThisInitialized(e),k,{writable:true,value:void 0});x(babelHelpers.assertThisInitialized(e),_,{writable:true,value:void 0});x(babelHelpers.assertThisInitialized(e),B,{writable:true,value:void 0});x(babelHelpers.assertThisInitialized(e),M,{writable:true,value:void 0});e.setEventNamespace("BX.Bizproc.Activity.SetGlobalVariable.Selector");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),_,a.Type.isArrayFilled(i)?i:[]);if(a.Type.isPlainObject(r)){if(a.Type.isElementNode(r.target)){babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(e),V).targetNode=r.target}if(r.showStubs===true){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),k,{recentTabOptions:{stub:true,icon:"",stubOptions:E(babelHelpers.assertThisInitialized(e),L,X).call(babelHelpers.assertThisInitialized(e),r.objectName)},searchTabOptions:{stub:true,stubOptions:E(babelHelpers.assertThisInitialized(e),N,U).call(babelHelpers.assertThisInitialized(e),r.objectName)},searchOptions:{allowCreateItem:true,footerOptions:E(babelHelpers.assertThisInitialized(e),D,Y).call(babelHelpers.assertThisInitialized(e),r.objectName)}})}if(a.Type.isPlainObject(r.itemCreateContext)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),B,r.itemCreateContext)}if(a.Type.isPlainObject(r.events)&&Object.keys(r.events).length>0){e.subscribeFromOptions(r.events)}}return e}babelHelpers.createClass(t,[{key:"create",value:function e(){var t=this;if(a.Type.isNil(babelHelpers.classPrivateFieldGet(this,M))){var i=babelHelpers.classPrivateFieldGet(this,V);if(a.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,k))){i=Object.assign(i,babelHelpers.classPrivateFieldGet(this,k))}i.items=babelHelpers.classPrivateFieldGet(this,_);i.events={"Item:onBeforeSelect":function(e){var t=e.data.item;this.emit("onBeforeSelect",new r.BaseEvent({data:{item:t}}))}.bind(this),onHide:function e(){return t.destroy()},"Search:onItemCreateAsync":function(e){var t=this;return new Promise((function(i){var a=e.getData().searchQuery.query;E(t,C,q).call(t,a,i)}))}.bind(this)};babelHelpers.classPrivateFieldSet(this,M,new s.Dialog(i));if(babelHelpers.classPrivateFieldGet(this,_).length<=0){var l,n;var o=a.Tag.render(R||(R=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="ui-selector-footer-link ui-selector-footer-link-add" style="border: none">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t"])),a.Text.encode((l=(n=i.searchOptions.footerOptions)===null||n===void 0?void 0:n.label)!==null&&l!==void 0?l:""));a.Event.bind(o,"click",E(this,C,q).bind(this));babelHelpers.classPrivateFieldGet(this,M).setFooter(o)}}return this}},{key:"show",value:function e(){if(a.Type.isNil(babelHelpers.classPrivateFieldGet(this,M))){this.create()}babelHelpers.classPrivateFieldGet(this,M).show()}},{key:"close",value:function e(){if(a.Type.isNil(babelHelpers.classPrivateFieldGet(this,M))){return}if(babelHelpers.classPrivateFieldGet(this,M).isOpen()){babelHelpers.classPrivateFieldGet(this,M).hide()}}},{key:"destroy",value:function e(){if(a.Type.isNil(babelHelpers.classPrivateFieldGet(this,M))){return}babelHelpers.classPrivateFieldGet(this,M).destroy();babelHelpers.classPrivateFieldSet(this,M,null)}}]);return t}(r.EventEmitter);function X(e){if(!a.Type.isStringFilled(e)){return{}}if(e==="GlobalVar"){return{title:a.Loc.getMessage("BPSGVA_GVARIABLE_NO_EXIST"),subtitle:a.Loc.getMessage("BPSGVA_CREATE_GVARIABLE_QUESTION"),arrow:true}}if(e==="GlobalConst"){return{title:a.Loc.getMessage("BPSGVA_GCONSTANT_NO_EXIST"),subtitle:a.Loc.getMessage("BPSGVA_CREATE_GCONSTANT_QUESTION"),arrow:true}}return{}}function U(e){if(!a.Type.isStringFilled(e)){return{}}if(e==="GlobalVar"){return{title:a.Loc.getMessage("BPSGVA_GVARIABLE_NOT_FOUND"),subtitle:a.Loc.getMessage("BPSGVA_CREATE_GVARIABLE_QUESTION"),arrow:true}}if(e==="GlobalConst"){return{title:a.Loc.getMessage("BPSGVA_GCONSTANT_NOT_FOUND"),subtitle:a.Loc.getMessage("BPSGVA_CREATE_GCONSTANT_QUESTION"),arrow:true}}return{}}function Y(e){if(!a.Type.isStringFilled(e)){return{}}if(e==="GlobalVar"){return{label:a.Loc.getMessage("BPSGVA_CREATE_GVARIABLE")}}if(e==="GlobalConst"){return{label:a.Loc.getMessage("BPSGVA_CREATE_GCONSTANT")}}return{}}function q(e,t){var i=this;if(!a.Type.isStringFilled(e)){e=""}var r=babelHelpers.classPrivateFieldGet(this,B).visibility;var s={visibility:r.slice(r.indexOf(":")+1),availableTypes:E(this,W,Z).call(this,babelHelpers.classPrivateFieldGet(this,B).type)};l.Globals.Manager.Instance.createGlobals(babelHelpers.classPrivateFieldGet(this,B).mode,babelHelpers.classPrivateFieldGet(this,B).signedDocumentType,e,s).then((function(e){var r={objectName:babelHelpers.classPrivateFieldGet(i,B).objectName,visibility:babelHelpers.classPrivateFieldGet(i,B).visibility,index:babelHelpers.classPrivateFieldGet(i,B).index};E(i,z,Q).call(i,e,r);if(a.Type.isFunction(t)){t()}}))}function Q(e,t){var i=e.getData().entries();var s=Object.keys(i);if(s.length<=0){return}var l=s[0];var n=a.Runtime.clone(i[s[0]]);n.Multiple=n.Multiple==="Y";var o={entityId:"bp",tabs:"recents",title:n.Name,id:"{="+t.objectName+":"+l+"}",customData:{groupId:t.objectName+":"+n["Visibility"],property:n,title:n["Name"]}};var u=E(this,W,Z).call(this,babelHelpers.classPrivateFieldGet(this,B).type);if(o.customData.groupId===t.visibility&&u.includes(n.Type)){babelHelpers.classPrivateFieldGet(this,M).setFooter(null);babelHelpers.classPrivateFieldGet(this,M).addItem(o)}this.emit("onAfterCreate",new r.BaseEvent({data:{item:o}}))}function Z(e){if(e==="double"){return["int","double"]}if(e==="datetime"){return["date","datetime"]}if(["date","int","user"].includes(e)){return e}return["string","text","select","bool","int","double","date","datetime","user"]}var $,J,K,ee,te,ie,ae,re,se,le,ne,oe,ue,pe,ce,de,be,ve,he;function ge(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=fe(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function fe(e,t){if(!e)return;if(typeof e==="string")return ye(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ye(e,t)}function ye(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function me(e,t){Te(e,t);t.add(e)}function Te(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function we(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}function Pe(e,t,i){He(e,t);Ie(i,"get");return Ae(e,i)}function Ie(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function He(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function Ae(e,t){if(t.get){return t.get.call(e)}return t.value}var Ge=a.Reflection.namespace("BX.Bizproc.Activity");var Se=new WeakSet;var Re=new WeakSet;var Fe=new WeakSet;var xe=new WeakSet;var Oe=new WeakSet;var Ee=new WeakSet;var Ve=new WeakSet;var ke=new WeakSet;var _e=new WeakSet;var Be=new WeakSet;var Me=new WeakSet;var Le=new WeakSet;var Ne=new WeakSet;var De=new WeakSet;var Ce=new WeakSet;var ze=function(){function e(t){babelHelpers.classCallCheck(this,e);me(this,Ce);me(this,De);me(this,Ne);me(this,Le);me(this,Me);me(this,Be);me(this,_e);me(this,ke);me(this,Ve);me(this,Ee);me(this,Oe);me(this,xe);me(this,Fe);me(this,Re);me(this,Se);babelHelpers.defineProperty(this,"rowIndex",-1);babelHelpers.defineProperty(this,"numberOfTypes",9);if(a.Type.isPlainObject(t)){var i,r;this.isRobot=t.isRobot;this.documentType=t.documentType;this.signedDocumentType=t.signedDocumentType;this.variables=t.variables;this.constants=(i=t.constants)!==null&&i!==void 0?i:{};this.documentFields=(r=t.documentFields)!==null&&r!==void 0?r:{};this.currentValues=t.currentValues;this.visibilityMessages=t.visibilityMessages;this.formName=t.formName;this.addRowTable=t.addRowTable}}babelHelpers.createClass(e,[{key:"init",value:function e(){this.initAvailableOptions();var t=this.isRobot?"addAssignmentExpressionRobot":"addAssignmentExpressionDesigner";if(Object.keys(this.currentValues).length<=0){this[t]()}for(var i in this.currentValues){this[t](i,this.currentValues[i])}if(this.isRobot);else{this.addExpressionButtonDesigner()}}},{key:"isGVariableVisibility",value:function t(i){return i.startsWith(Pe(this.constructor,e,lt))}},{key:"isGConstantVisibility",value:function t(i){return i.startsWith(Pe(this.constructor,e,nt))}},{key:"isDocumentVisibility",value:function t(i){return i.startsWith(Pe(this.constructor,e,ot))}},{key:"isHelperVisibility",value:function t(i){return i.startsWith(Pe(this.constructor,e,ut))}},{key:"initAvailableOptions",value:function e(){this.availableOptions=this.getAvailableOptions();this.availableOptionsByGroupId=this.getAvailableOptionsByGroup()}},{key:"getAvailableOptions",value:function t(){var i=new Map;this.fillOptions(this.variables,i);this.fillOptions(this.constants,i);this.fillOptions(this.documentFields,i);i.set("variable",{id:"",title:a.Loc.getMessage("BPSGVA_VARIABLE"),customData:{property:{Type:"string",Multiple:false},groupId:Pe(this.constructor,e,ut),title:a.Loc.getMessage("BPSGVA_VARIABLE")}});i.set("parameter",{id:"",title:a.Loc.getMessage("BPSGVA_PARAMETER"),customData:{property:{Type:"string",Multiple:false},groupId:Pe(this.constructor,e,ut),title:a.Loc.getMessage("BPSGVA_PARAMETER")}});i.set("clear",{id:"",title:a.Loc.getMessage("BPSGVA_CLEAR"),customData:{property:{Type:"string",Multiple:false},groupId:Pe(this.constructor,e,ut),title:a.Loc.getMessage("BPSGVA_CLEAR")}});return i}},{key:"fillOptions",value:function e(t,i){var a,r,s;for(var l in t){s=t[l];if(s["children"]){s=s["children"]}for(var n in s){a=s[n]["id"];r=s[n];i.set(a,r)}}}},{key:"getAvailableOptionsByGroup",value:function t(){var i=new Map;this.fillOptionsByGroupWithGlobals(this.variables,i,Pe(this.constructor,e,lt));this.fillOptionsByGroupWithGlobals(this.constants,i,Pe(this.constructor,e,nt));var a=[];for(var r in this.documentFields){a.push(this.documentFields[r])}i.set(Pe(this.constructor,e,ot)+":"+Pe(this.constructor,e,ot),a);return i}},{key:"fillOptionsByGroupWithGlobals",value:function e(t,i,a){for(var r in t){var s=a+":"+r;i.set(s,t[r])}}},{key:"addAssignmentExpressionRobot",value:function t(i,r){if(a.Type.isString(r)){r={0:r}}var s={variable:i,values:r};this.modifyIncomingDataRobot(s);var l=this.addRowTable;this.rowIndex++;var n=a.Tag.render($||($=babelHelpers.taggedTemplateLiteral(['<div id="','"></div>'])),Pe(this.constructor,e,dt)+this.rowIndex);var o=a.Tag.render(J||(J=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="bizproc-automation-popup-settings-title"\n\t\t\t\tdata-role="','"\n\t\t\t></div>\n\t\t'])),a.Text.encode(Pe(this.constructor,e,vt)+this.rowIndex));if(s.values.length<=0){var u=a.Runtime.clone(this.getOptionPropertiesRobot("clear"));u["multiple"]=s.variable.property.Multiple;u["type"]=s.variable.property.Type;u["inputIndex"]=0;a.Dom.append(this.createParameterRowRobot(this.rowIndex,u,n),o)}for(var p in s.values){var c=a.Runtime.clone(s.values[p]);c["multiple"]=s.variable.property.Multiple;c["type"]=s.variable.property.Type;c["inputIndex"]=p;a.Dom.append(this.createParameterRowRobot(this.rowIndex,c,n),o)}if(s.variable.property.Multiple&&s.variable.property.Type!=="user"){var d=s.values.length<=0?1:s.values.length;a.Dom.append(this.createAddParameterRowRobot(this.rowIndex,d),o)}var b=a.Tag.render(K||(K=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings">\n\t\t\t\t<div\n\t\t\t\t\tclass="bizproc-automation-popup-settings bizproc-automation-popup-settings-text"\n\t\t\t\t\tstyle="display: flex; align-items: flex-start"\n\t\t\t\t>\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this.createVariableRowRobot(s.variable,n),o,n);a.Dom.append(b,l)}},{key:"modifyIncomingDataRobot",value:function t(i){var r=this.getOptionPropertiesRobot(i.variable);if(i.variable===undefined||r.groupId===Pe(this.constructor,e,ut)+":text"){i.variable=a.Runtime.clone(this.getOptionPropertiesRobot("variable"));var s=a.Runtime.clone(this.getOptionPropertiesRobot("parameter"));i.values=[{id:s.id,title:s.title}];return}var l=[];switch(r.property.Type){case"select":l=this.getIncomingValuesSelect(i);break;case"bool":l=this.getIncomingValuesBool(i);break;default:for(var n in i.values){var o=this.getOptionPropertiesRobot(i.values[n]);if(i.values[n]===""){o=this.getOptionPropertiesRobot("clear")}l.push({id:o.id,title:o.title})}}i.variable=a.Runtime.clone(r);i.values=l}},{key:"getOptionPropertiesRobot",value:function e(t){var i=this.availableOptions.get(t);if(a.Type.isUndefined(i)){return this.getDefaultOptionProperties(t)}return this.getShortOptionProperties(i)}},{key:"getDefaultOptionProperties",value:function t(i){return{id:i,property:{Type:"string",Multiple:false},groupId:Pe(this.constructor,e,ut)+":text",title:i}}},{key:"getShortOptionProperties",value:function e(t){return{id:t.id,property:t.customData.property,groupId:t.customData.groupId,title:t.customData.title}}},{key:"getIncomingValuesSelect",value:function e(t){var i=this.getOptionPropertiesRobot(t.variable);var r=[];var s;var l;var n;for(var o in t.values){s=a.Loc.getMessage("BPSGVA_CLEAR");if(t.values[o]!==""){l=this.getOptionPropertiesRobot(t.values[o]);n=true;s=l.title}if(i.property.Options[t.values[o]]!==undefined){n=false;s=i.property.Options[t.values[o]]}r.push({id:t.values[o],title:s,isExpressionOption:n})}return r}},{key:"getIncomingValuesBool",value:function e(t){var i=[];var r;var s;for(var l in t.values){var n=false;switch(t.values[l]){case"Y":r=a.Loc.getMessage("BPSGVA_BOOL_YES");break;case"N":r=a.Loc.getMessage("BPSGVA_BOOL_NO");break;case"":r=a.Loc.getMessage("BPSGVA_CLEAR");break;default:s=this.getOptionPropertiesRobot(t.values[l]);r=s.title;n=true}i.push({id:t.values[l],title:r,isExpressionOption:n})}return i}},{key:"createVariableRowRobot",value:function t(i,r){var s=a.Tag.render(ee||(ee=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span \n\t\t\t\tclass="bizproc-automation-popup-settings-link setglobalvariableactivity-underline"\n\t\t\t\tdata-role="','"\n\t\t\t\tbp_sgva_index="','"\n\t\t\t>\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),a.Text.encode(Pe(this.constructor,e,bt)+this.rowIndex),a.Text.encode(String(this.rowIndex)),a.Loc.getMessage("BPSGVA_VARIABLE"));var l=we(this,Re,je).call(this,i.id);var n=l.groupId===Pe(this.constructor,e,ut)+":text";if(n){l.title=a.Loc.getMessage("BPSGVA_VARIABLE")}we(this,Ve,Qe).call(this,s,l.title);we(this,ke,Ze).call(this,s,l.id,{isMultiple:false,inputIndex:0,isExpressionOption:false},r);a.Event.bind(s,"click",this.onVariableSelectClickRobot.bind(this));return a.Tag.render(te||(te=babelHelpers.taggedTemplateLiteral(["<div>","</div>"])),s)}},{key:"createParameterRowRobot",value:function t(i,r,s){var l;var n=a.Tag.render(ie||(ie=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span \n\t\t\t\tclass="bizproc-automation-popup-settings-link setglobalvariableactivity-underline"\n\t\t\t\tdata-role="','"\n\t\t\t\tbp_sgva_index="','"\n\t\t\t>\n\t\t\t</span>\n\t\t'])),a.Text.encode(Pe(this.constructor,e,vt)+i),a.Text.encode(String(i)));n.setAttribute(Pe(this.constructor,e,st),a.Text.toInteger(String(r.inputIndex)));var o=we(this,Re,je).call(this,r.id);o.title=(l=we(this,Se,We).call(this,r.type,r.title,r.id))!==null&&l!==void 0?l:r.title;if(!a.Type.isStringFilled(o.title)){o.title=a.Loc.getMessage("BPSGVA_CLEAR")}we(this,Ve,Qe).call(this,n,o.title);we(this,ke,Ze).call(this,n,o.id,{isMultiple:r.multiple,inputIndex:a.Text.toInteger(String(r.inputIndex)),isExpressionOption:r.isExpressionOption},s);a.Event.bind(n,"click",this.onParameterSelectClickRobot.bind(this,r.inputIndex));return a.Tag.render(ae||(ae=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings-title setglobalvariableactivity-parameter-wrapper">\n\t\t\t\t<div class="bizproc-automation-popup-settings-title setglobalvariableactivity-symbol-equal"> = </div>\n\t\t\t\t<div>\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),n)}},{key:"replaceHiddenInputRobot",value:function t(i,r){var s=i.inputValue;var l=i.role+"_input";var n=document.querySelectorAll('[data-role="'+l+'"]');if(n.length>=1&&!i.multiple){n[0].name=i.isExpressionOption?i.role+"_text":i.role;n[0].value=i.inputValue;return}if(n.length>=1&&i.multiple){var o=Object.keys(n);for(var u in o){var p=n[o[u]].getAttribute(Pe(this.constructor,e,st));if(i.inputIndex===p){n[u].name=i.isExpressionOption?i.role+"_text":i.role+"[]";n[u].value=i.inputValue;return}}}n=a.Tag.render(re||(re=babelHelpers.taggedTemplateLiteral(['<input type="hidden">'])));if(i.isExpressionOption){n.name=i.role+"_text"}else{n.name=i.multiple?i.role+"[]":i.role}n.value=s;n.setAttribute("data-role",l);n.setAttribute(Pe(this.constructor,e,st),String(i.inputIndex));a.Dom.append(n,r)}},{key:"onVariableSelectClickRobot",value:function t(i){var r=i.target;var s=this.getVisibilityNamesForSelect("variable");var l=new H({popupOptions:{id:r.dataset.role+"_popup",target:r,offsetTop:5,overlay:{backgroundColor:"transparent"},cacheable:false,events:{onClose:function e(){return l.destroy()}}},contentData:{rows:[{label:a.Loc.getMessage("BPSGVA_TYPE_OF_PARAMETER"),values:s},{label:a.Loc.getMessage("BPSGVA_LIST_OF_VALUES"),values:[{id:"empty",text:a.Loc.getMessage("BPSGVA_EMPTY")}],onClick:we(this,Fe,Xe).bind(this)}]},events:{onSetRowValue:we(this,Oe,Ye),onApplyChangesClick:we(this,Ee,qe).bind(this)}});l.create();var n=this.getVariableInputValue(r.getAttribute("data-role"));var o=we(this,Re,je).call(this,n);var u=o.groupId===Pe(this.constructor,e,ut)+":text";if(u){o.groupId=s[0].id;o.title=a.Loc.getMessage("BPSGVA_EMPTY")}l.setRowValue(0,o.groupId);l.setRowValue(1,n,o.title);l.show()}},{key:"getVariableInputValue",value:function e(t){var i=t+"_input";var a=document.querySelectorAll('[data-role="'+i+'"]');return a.length>=1?a["0"].value:""}},{key:"createInputForMenuFormRobot",value:function e(t,i,r){if(t==="variable"){var s=a.Tag.render(se||(se=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-popup-select"></div>'])));var l=a.Tag.render(le||(le=babelHelpers.taggedTemplateLiteral(['<input class="bizproc-automation-popup-input" type="hidden" style="width: 280px">'])));a.Dom.append(l,s);return s}var n=this.getVariableOptionFromVariableInput(i);var o;switch(n.property.Type){case"user":o=BX.Bizproc.FieldType.renderControl(this.documentType,n.property,"bp_sgva_field_input",r);break;case"select":case"bool":o=BX.Bizproc.FieldType.renderControl(this.documentType,{Type:n.property.Type,Options:n.property.Options},"bp_sgva_field_input",r);break;default:o=BX.Bizproc.FieldType.renderControl(this.documentType,{Type:n.property.Type},"bp_sgva_field_input",n.id)}a.Dom.style(o,"width","280px");var u=this.findInputInFormRobot(o);if(["bool","select"].includes(n.property.Type)){if(u.value!==r){var p=this.getOptionPropertiesRobot(r);this.resolveAdditionOptionInSelectRobot(u,p)}}if(u){a.Dom.style(u,"width","100%")}return o}},{key:"getVariableOptionFromVariableInput",value:function t(i){var a=document.querySelector('[data-role="'+Pe(this.constructor,e,bt)+i+'_input"]');var r=a?a.value:"";return this.getOptionPropertiesRobot(r)}},{key:"findInputInFormRobot",value:function e(t){var i=t.getElementsByTagName("input");if(i.length>=1){return i[i.length-1]}i=t.getElementsByTagName("textarea");if(i.length>=1){return i[i.length-1]}i=t.getElementsByTagName("select");if(i.length>=1){return i[i.length-1]}}},{key:"resolveAdditionOptionInSelectRobot",value:function e(t,i){var r=t.options;var s=r[r.length-1];if(s.getAttribute("data-role")!=="expression"){s=a.Tag.render(ne||(ne=babelHelpers.taggedTemplateLiteral(["<option></option>"])));s.setAttribute("data-role","expression");a.Dom.append(s,t)}s.value=i.id;if(!i.customData){s.text=i.title}else{s.text=i.customData.get("title")}s.setAttribute("selected","selected");if(!s.selected){s.selected=true}}},{key:"filterItemsInStandardMenuRobot",value:function e(t,i){var a=this.getFilterByVariableType(t);if(a.length===this.numberOfTypes){return i}var r=[];for(var s in i){if(i[s].children){var l=this.filterItemsInStandardMenuRobot(t,i[s].children);if(l.length>=1){var n=i[s];n.children=l;r.push(n)}}else{if(a.includes(i[s].customData.property.Type)){r.push(i[s])}}}return r}},{key:"getFilterByVariableType",value:function e(t){switch(t){case"double":return["int","double"];case"datetime":return["date","datetime"];case"date":case"int":case"user":return[t];default:return["string","text","select","bool","int","double","date","datetime","user"]}}},{key:"getVisibilityNamesForSelect",value:function t(i){var r=[];var s=this.visibilityMessages;s[Pe(this.constructor,e,ut)]={text:a.Loc.getMessage("BPSGVA_TEXT")};for(var l in s){if(i==="variable"&&l!==Pe(this.constructor,e,lt)){continue}for(var n in s[l]){r.push({id:l+":"+n,text:s[l][n]})}}return r}},{key:"changeParameterExpressionRobot",value:function t(i,r){var s=document.querySelector('[data-role="'+Pe(this.constructor,e,vt)+i+'"]');this.deleteOldValueRowsRobot(s);var l=document.getElementById(Pe(this.constructor,e,dt)+i);var n=a.Runtime.clone(this.getOptionPropertiesRobot("parameter"));n["multiple"]=r.property.Multiple;n["inputIndex"]="0";a.Dom.append(this.createParameterRowRobot(i,n,l),s);if(r.property.Multiple&&r.property.Type!=="user"){var o=r.inputIndex!=="0"?r.inputIndex:"1";a.Dom.append(this.createAddParameterRowRobot(i,o),s)}}},{key:"deleteOldValueRowsRobot",value:function e(t){var i=t.getAttribute("data-role");t.innerHTML="";var a=document.querySelectorAll('[data-role="'+i+'_input"]');for(var r in Object.keys(a)){a[r].remove()}}},{key:"createAddParameterRowRobot",value:function t(i,r){var s=a.Tag.render(oe||(oe=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-popup-settings-title" style="display:flex;"></div>'])));var l=a.Tag.render(ue||(ue=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-type-control-clone-btn setglobalvariableactivity-dashed-grey setglobalvariableactivity-add-parameter">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),a.Text.encode(a.Loc.getMessage("BPSGVA_ADD_PARAMETER")));l.setAttribute(Pe(this.constructor,e,rt),String(i));l.setAttribute(Pe(this.constructor,e,st),String(r));a.Event.bind(l,"click",this.onAddParameterButtonClickRobot.bind(this));a.Dom.append(l,s);return s}},{key:"onAddParameterButtonClickRobot",value:function t(i){var r=i.target.getAttribute(Pe(this.constructor,e,rt));var s=document.getElementById(Pe(this.constructor,e,dt)+r);var l=i.target.getAttribute(Pe(this.constructor,e,st));var n=a.Runtime.clone(this.getOptionPropertiesRobot("parameter"));n["multiple"]=true;n["inputIndex"]=l;i.target.parentNode.before(this.createParameterRowRobot(r,n,s));i.target.setAttribute(Pe(this.constructor,e,st),Number(l)+1)}},{key:"onParameterSelectClickRobot",value:function t(i,r){var s=r.target;var l=this.getVisibilityNamesForSelect("all");var n=new H({popupOptions:{id:s.dataset.role+"_popup",target:s,offsetTop:5,overlay:{backgroundColor:"transparent"},cacheable:false,events:{onClose:function e(){return n.destroy()}}},contentData:{rows:[{label:a.Loc.getMessage("BPSGVA_TYPE_OF_PARAMETER"),values:l},{label:a.Loc.getMessage("BPSGVA_LIST_OF_VALUES"),values:[{id:"empty",text:a.Loc.getMessage("BPSGVA_EMPTY")}],onClick:we(this,Me,Ke).bind(this)}]},events:{onSetRowValue:we(this,Le,et).bind(this),onApplyChangesClick:we(this,Ne,tt).bind(this)}});n.create();var o=this.getParameterInputValue(s.getAttribute("data-role")+"_input",i);var u=we(this,Re,je).call(this,o);n.setRowValue(0,u.groupId);var p=u.groupId===Pe(this.constructor,e,ut)+":text";var c=this.getParameterInputValue(s.getAttribute("data-role")+"_input",i);if(p){var d=s.getAttribute(Pe(this.constructor,e,rt));var b=this.createInputForMenuFormRobot("all",d,c);var v=this.findInputInFormRobot(b);n.replaceRowTarget(1,b,v)}n.setRowValue(1,c,p?"":u.title);n.show()}},{key:"getParameterInputValue",value:function t(i,a){var r=document.querySelectorAll('[data-role="'+i+'"]',a);var s=Object.keys(r);for(var l in s){if(String(r[s[l]].getAttribute(Pe(this.constructor,e,st)))===String(a)){return r[s[l]].value}}return""}},{key:"addExpressionButtonRobot",value:function t(){var i=document.getElementById(Pe(this.constructor,e,ct));i.innerText=a.Loc.getMessage("BPSGVA_ADD_VARIABLE");a.Event.bind(i,"click",this.addAssignmentExpressionRobot.bind(this))}},{key:"addExpressionButtonDesigner",value:function e(){var t=this;var i=a.Tag.render(pe||(pe=babelHelpers.taggedTemplateLiteral(["<a href='#'>","</a>"])),a.Loc.getMessage("BPSGVA_PD_ADD"));a.Event.bind(i,"click",(function(e){t.addAssignmentExpressionDesigner();e.preventDefault()}));a.Dom.insertAfter(i,this.addRowTable)}},{key:"convertFieldExpression",value:function t(i){if(this.isDocumentVisibility(i.groupId)){return"{{"+i.property.Name+"}}"}if(this.isGVariableVisibility(i.groupId)){var a=this.visibilityMessages[Pe(this.constructor,e,lt)];var r=i.property.Visibility;var s=i.property.Name;return"{{"+a[r]+": "+s+"}}"}if(this.isGConstantVisibility(i.groupId)){var l=this.visibilityMessages[Pe(this.constructor,e,nt)];var n=i.property.Visibility;var o=i.property.Name;return"{{"+l[n]+": "+o+"}}"}return i.id}},{key:"addAssignmentExpressionDesigner",value:function t(i,r){var s=this.addRowTable;this.rowIndex++;var l=s.insertRow(-1);l.id="delete_row_"+this.rowIndex;var n=l.insertCell(-1);var o=a.Tag.render(ce||(ce=babelHelpers.taggedTemplateLiteral(['<select name="','"></select>'])),Pe(this.constructor,e,bt)+this.rowIndex);o.setAttribute(Pe(this.constructor,e,rt),this.rowIndex);var u=this;o.onchange=function(){u.changeFieldTypeDesigner(this.getAttribute(Pe(u.constructor,e,rt)),this.options[this.selectedIndex].value,null)};var p=this.visibilityMessages[Pe(this.constructor,e,lt)];for(var c in p){var d=p[c];var b=a.Tag.render(de||(de=babelHelpers.taggedTemplateLiteral(['<optgroup label="','"></optgroup>'])),a.Text.encode(d));var v=this.availableOptionsByGroupId.get(Pe(this.constructor,e,lt)+":"+c);if(!v){continue}var h=void 0;for(var g in v){h=a.Tag.render(be||(be=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<option value="','">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</option>\n\t\t\t\t"])),a.Text.encode(v[g]["id"]),a.Text.encode(v[g]["customData"]["title"]));a.Dom.append(h,b)}a.Dom.append(b,o)}o.value=i;if(o.selectedIndex===-1){o.selectedIndex=0}a.Dom.append(o,n);var f=l.insertCell(-1);f.innerHTML="=";var y=l.insertCell(-1);y.id="id_td_variable_value_"+this.rowIndex;y.innerHTML="";var m=l.insertCell(-1);m.aligh="right";var T=a.Tag.render(ve||(ve=babelHelpers.taggedTemplateLiteral(['<a href="#">',"</a>"])),a.Text.encode(a.Loc.getMessage("BPSGVA_PD_DELETE")));var w=this.rowIndex;a.Event.bind(T,"click",(function(e){u.deleteConditionDesigner(w);e.preventDefault()}));a.Dom.append(T,m);if(a.Type.isArray(r)){for(var P in r){var I=this.getOptionPropertiesRobot(r[P]);if(I.groupId===Pe(this.constructor,e,ut)+":text"){continue}r[P]=this.convertFieldExpression(I)}}else{var H=this.getOptionPropertiesRobot(r);if(H.groupId!==Pe(this.constructor,e,ut)+":text"){r=this.convertFieldExpression(H)}}if(r===undefined){r=null}this.changeFieldTypeDesigner(this.rowIndex,o.value,r)}},{key:"changeFieldTypeDesigner",value:function e(t,i,r){BX.showWait();var s=document.getElementById("id_td_variable_value_"+t);var l=i.indexOf(":");var n=i;if(l!==-1){n=i.slice(l+1,i.length-1)}objFieldsGlobalVar.GetFieldInputControl(objFieldsGlobalVar.arDocumentFields[n],r,{Field:n,Form:this.formName},(function(e){if(e===undefined){s.innerHTML=""}else{s.innerHTML=e;if(!a.Type.isUndefined(BX.Bizproc.Selector)){BX.Bizproc.Selector.initSelectors(s)}}BX.closeWait()}),true)}},{key:"deleteConditionDesigner",value:function t(i){var a=document.getElementById(Pe(this.constructor,e,pt));var r=a.rows.length;for(var s=0;s<r;s++){if(a.rows[s].id!=="delete_row_"+i){continue}a.deleteRow(s);break}}}]);return e}();function We(e,t,i){var r;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var l={Type:e,Options:a.Type.isPlainObject(s)?s:null};var n=e==="bool"?i:t;if(e==="bool"&&!["Y","N"].includes(n)){return null}return(r=BX.Bizproc.FieldType.formatValuePrintable(l,n))!==null&&r!==void 0?r:null}function je(e){var t=this.availableOptions.get(e);if(a.Type.isUndefined(t)){return{id:e,groupId:Pe(this.constructor,ze,ut)+":text",title:e}}return{id:t.id,groupId:t.customData.groupId,title:t.customData.title}}function Xe(e){var t;var i=e.getData().menu;var a=i.getRowValue(0);var r=(t=this.availableOptionsByGroupId.get(a))!==null&&t!==void 0?t:[];var s=this.filterItemsInStandardMenuRobot("string",r);var n=new j(s,{target:e.getTarget(),showStubs:true,objectName:Pe(this.constructor,ze,lt),events:{onBeforeSelect:we(this,De,it).bind(this,i),onAfterCreate:we(this,Ce,at).bind(this)},itemCreateContext:{index:0,visibility:String(a),type:"string",mode:l.Globals.Manager.Instance.mode.variable,objectName:Pe(this.constructor,ze,lt),signedDocumentType:this.signedDocumentType}});n.show()}function Ue(e){if(this.isGVariableVisibility(e)){return Pe(this.constructor,ze,lt)}if(this.isGConstantVisibility(e)){return Pe(this.constructor,ze,nt)}if(this.isDocumentVisibility(e)){return Pe(this.constructor,ze,ot)}return""}function Ye(e){var t=e.getData();var i=t.rowIndex;var r=t.menu;if(i===0){r.setRowValue(1,"",a.Loc.getMessage("BPSGVA_EMPTY"))}}function qe(e){var t=e.getData();var i=t.values;var r=t.target;var s=i[1];var l=we(this,Re,je).call(this,s);var n=l.groupId!==Pe(this.constructor,ze,ut)+":text";if(!n){l.title=a.Loc.getMessage("BPSGVA_VARIABLE")}we(this,Ve,Qe).call(this,r,l.title);we(this,ke,Ze).call(this,r,l.id,{isMultiple:false,inputIndex:0,isExpressionOption:false});we(this,_e,$e).call(this,r);we(this,Be,Je).call(this,r,s)}function Qe(e,t){e.innerText=t}function Ze(e,t,i,r){var s=e.getAttribute(Pe(this.constructor,ze,rt));var l=e.getAttribute("data-role");var n=l+"_input";if(a.Type.isNil(r)){r=document.getElementById(Pe(this.constructor,ze,dt)+s)}var o=document.querySelectorAll('[data-role="'+n+'"]');if(o.length>=1&&!i.isMultiple){o[0].name=a.Text.encode(l+(i.isExpressionOption?"_text":""));o[0].value=t;return}if(o.length>=1&&i.isMultiple){var u=ge(o),p;try{for(u.s();!(p=u.n()).done;){var c=p.value;if(i.inputIndex===c.getAttribute(Pe(this.constructor,ze,st))){c.name=i.isExpressionOption?a.Text.encode(l+"_text"):a.Text.encode(l+"[]");c.value=t;return}}}catch(e){u.e(e)}finally{u.f()}}var d;if(i.isExpressionOption){d=l+"_text"}else{d=l+(i.isMultiple?"[]":"")}var b=a.Tag.render(he||(he=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input \n\t\t\t\ttype="hidden"\n\t\t\t\tname="','" value="','"\n\t\t\t\tdata-role="','"\n\t\t\t>\n\t\t'])),a.Text.encode(d),a.Text.encode(t),a.Text.encode(n));b.setAttribute(Pe(this.constructor,ze,st),a.Text.toInteger(i.inputIndex));a.Dom.append(b,r)}function $e(e){var t=e.getAttribute(Pe(this.constructor,ze,rt));var i=document.querySelector('[data-role="'+Pe(this.constructor,ze,vt)+t+'"]');this.deleteOldValueRowsRobot(i)}function Je(e,t){var i=e.getAttribute(Pe(this.constructor,ze,rt));var a=this.getOptionPropertiesRobot(t);a.inputIndex="0";this.changeParameterExpressionRobot(i,a)}function Ke(e){var t;var i=e.getData().menu;var a=i.getRowValue(0);var r=i.target.getAttribute(Pe(this.constructor,ze,rt));var s=this.getVariableOptionFromVariableInput(r);var n=s.property.Type;var o=(t=this.availableOptionsByGroupId.get(a))!==null&&t!==void 0?t:[];var u=this.filterItemsInStandardMenuRobot(n,o);var p=this.isGVariableVisibility(a)||this.isGConstantVisibility(a);var c=we(this,xe,Ue).call(this,a);var d="";if(p){d=this.isGVariableVisibility(a)?l.Globals.Manager.Instance.mode.variable:l.Globals.Manager.Instance.mode.constant}var b=new j(u,{showStubs:p,objectName:c,target:e.getTarget(),events:{onBeforeSelect:we(this,De,it).bind(this,i),onAfterCreate:we(this,Ce,at).bind(this)},itemCreateContext:{mode:d,objectName:c,index:0,visibility:String(a),type:String(n),signedDocumentType:this.signedDocumentType}});b.show()}function et(e){var t=e.getData();var i=t.rowIndex;var r=t.menu;if(i===0){if(t.value!==Pe(this.constructor,ze,ut)+":text"){r.setRowLabel(1,a.Loc.getMessage("BPSGVA_LIST_OF_VALUES"));var s=r.createEmptyRow(1);r.replaceRowTarget(1,s,s);r.setRowValue(1,"",a.Loc.getMessage("BPSGVA_EMPTY"));return}r.setRowLabel(1,a.Loc.getMessage("BPSGVA_INPUT_TEXT"));var l=r.target.getAttribute(Pe(this.constructor,ze,rt));var n=this.createInputForMenuFormRobot("all",l,"");var o=this.findInputInFormRobot(n);r.replaceRowTarget(1,n,o);r.setRowValue(1,"","")}}function tt(e){var t;var i=e.getData();var r=i.menu;var s=i.values;var l=i.target;var n=s[0];var o=s[1];if(n===Pe(this.constructor,ze,ut)+":text"){var u,p;var c=r.getRowInput(1);if(!c){c=this.findInputInFormRobot(r.getRowTarget(1))}o=(u=(p=c)===null||p===void 0?void 0:p.value)!==null&&u!==void 0?u:""}var d=we(this,Re,je).call(this,o);if(!a.Type.isStringFilled(d.title)){d.title=a.Loc.getMessage("BPSGVA_CLEAR")}var b=r.target.getAttribute(Pe(this.constructor,ze,rt));var v=this.getVariableOptionFromVariableInput(b);d.title=(t=we(this,Se,We).call(this,v.property.Type,d.title,o,v.property.Options))!==null&&t!==void 0?t:d.title;we(this,Ve,Qe).call(this,l,d.title);var h=["select","bool"].includes(v.property.Type)&&n!==Pe(this.constructor,ze,ut)+":text";we(this,ke,Ze).call(this,l,d.id,{isMultiple:v.property.Multiple,inputIndex:l.getAttribute(Pe(this.constructor,ze,st)),isExpressionOption:h})}function it(e,t){var i=t.getData().item;e.setRowValue(1,i.id,i.customData.get("title"))}function at(e){var t;var i=e.getData().item;this.availableOptions.set(i.id,i);var a=(t=this.availableOptionsByGroupId.get(i.customData.groupId))!==null&&t!==void 0?t:[];a.push(i);this.availableOptionsByGroupId.set(i.customData.groupId,a)}var rt={writable:true,value:"bp_sgva_index"};var st={writable:true,value:"bp_sgva_input_index"};var lt={writable:true,value:"GlobalVar"};var nt={writable:true,value:"GlobalConst"};var ot={writable:true,value:"Document"};var ut={writable:true,value:"Default"};var pt={writable:true,value:"bp_sgva_addrow_table"};var ct={writable:true,value:"bp_sgva_add_button"};var dt={writable:true,value:"bp_sgva_results_"};var bt={writable:true,value:"bp_sgva_variable_"};var vt={writable:true,value:"bp_sgva_value_"};Ge.SetGlobalVariableActivity=ze})(this.BX.Bizproc.Activity=this.BX.Bizproc.Activity||{},BX,BX.Main,BX,BX.Event,BX.UI.EntitySelector,BX.Bizproc);
//# sourceMappingURL=script.map.js