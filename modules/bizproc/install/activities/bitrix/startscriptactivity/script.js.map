{"version":3,"file":"script.js","sources":["src/index.js"],"sourcesContent":["import {Reflection, Type, Text, ajax} from 'main.core';\nimport {TagSelector} from \"ui.entity-selector\";\n\nconst namespace = Reflection.namespace('BX.Bizproc.Activity');\n\nclass StartScriptActivity\n{\n\t#templateNode: HTMLElement;\n\t#templateInput: HTMLInputElement;\n\t#templateId: number = null;\n\t#parametersNode: HTMLElement;\n\t#documentType: [];\n\t#formName: string;\n\t#isRobot: boolean = false;\n\n\tconstructor(options: {\n\t\ttemplateNode: HTMLElement,\n\t\ttemplateInput: HTMLInputElement,\n\t\ttemplateId: number,\n\t\tparametersNode: HTMLElement,\n\t\tdocumentType: [],\n\t\tformName: string,\n\t\tisRobot: boolean,\n\t})\n\t{\n\t\tif (!Type.isElementNode(options.templateNode))\n\t\t{\n\t\t\tthrow 'templateNode must be HTML Element';\n\t\t}\n\t\tthis.#templateNode = options.templateNode;\n\n\t\tif (!Type.isElementNode(options.templateInput))\n\t\t{\n\t\t\tthrow 'templateInput must be HTML Input Element';\n\t\t}\n\t\tthis.#templateInput = options.templateInput;\n\n\t\tif (!Type.isElementNode(options.parametersNode))\n\t\t{\n\t\t\tthrow 'parametersNode must be HTML Element';\n\t\t}\n\t\tthis.#parametersNode = options.parametersNode;\n\n\t\tconst templateId = Text.toInteger(options.templateId);\n\t\tif (templateId > 0)\n\t\t{\n\t\t\tthis.#templateId = templateId;\n\t\t}\n\n\t\tthis.#documentType = Type.isArrayFilled(options.documentType) ? options.documentType : [];\n\t\tthis.#formName = Type.isStringFilled(options.formName) ? options.formName : '';\n\t\tthis.#isRobot = Type.isBoolean(options.isRobot) ? options.isRobot: false;\n\t}\n\n\tinit()\n\t{\n\t\tthis.#initTemplateSelector();\n\t}\n\n\t#initTemplateSelector()\n\t{\n\t\tconst preselectedItems = [];\n\t\tif (this.#templateId)\n\t\t{\n\t\t\tpreselectedItems.push(['bizproc-script-template', this.#templateId]);\n\t\t}\n\n\t\tconst selector = new TagSelector({\n\t\t\tdialogOptions: {\n\t\t\t\tentities: [\n\t\t\t\t\t{ id: 'bizproc-script-template' }\n\t\t\t\t],\n\t\t\t\tmultiple: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tenableSearch: true,\n\t\t\t\thideOnSelect: true,\n\t\t\t\thideOnDeselect: false,\n\t\t\t\tclearSearchOnSelect: true,\n\t\t\t\tshowAvatars: false,\n\t\t\t\tcompactView: true,\n\t\t\t\theight: 300,\n\t\t\t\tpreselectedItems: preselectedItems,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\t\tconst { item: selectedItem } = event.getData();\n\t\t\t\t\t\tthis.#renderTemplateParameters(selectedItem.getId());\n\n\t\t\t\t\t\tthis.#templateInput.value = selectedItem.getId();\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onDeselect': () => {\n\t\t\t\t\t\tthis.#renderTemplateParameters(-1);\n\t\t\t\t\t\tthis.#templateInput.value = '';\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tmultiple: false,\n\t\t\ttagMaxWidth: 500\n\t\t});\n\n\t\tselector.renderTo(this.#templateNode);\n\t}\n\n\t#renderTemplateParameters(templateId: number) {\n\t\tthis.#parametersNode.innerHTML = '';\n\n\t\ttemplateId = Text.toInteger(templateId);\n\t\tif (templateId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tajax.runAction('bizproc.activity.request', {\n\t\t\tdata: {\n\t\t\t\tdocumentType: this.#documentType,\n\t\t\t\tactivity: 'StartScriptActivity',\n\t\t\t\tparams: {\n\t\t\t\t\ttemplate_id: templateId,\n\t\t\t\t\tform_name: this.#formName,\n\t\t\t\t\tdocument_type: this.#documentType,\n\t\t\t\t},\n\t\t\t},\n\t\t}).then((response) => {\n\t\t\tthis.#parametersNode.innerHTML = response.data;\n\t\t});\n\t}\n}\n\nnamespace.StartScriptActivity = StartScriptActivity;"],"names":["namespace","Reflection","StartScriptActivity","options","Type","isElementNode","templateNode","templateInput","parametersNode","templateId","Text","toInteger","isArrayFilled","documentType","isStringFilled","formName","isBoolean","isRobot","preselectedItems","push","selector","TagSelector","dialogOptions","entities","id","multiple","dropdownMode","enableSearch","hideOnSelect","hideOnDeselect","clearSearchOnSelect","showAvatars","compactView","height","events","event","getData","selectedItem","item","getId","value","tagMaxWidth","renderTo","innerHTML","ajax","runAction","data","activity","params","template_id","form_name","document_type","then","response"],"mappings":"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"}