SequentialWorkflowActivity=function(){var e=new SequenceActivity;e.Type="SequentialWorkflowActivity";e.swfWorkspaceDiv=null;e.swfToolBoxDiv=null;e.Table=null;e.hSnippid1=false;e.onScroll=function(){var t=BX("bx-panel");if(!t)return;var i=0;if(BX.hasClass(t,"bx-panel-fixed")){var l=BX.pos(t);i=l.height}var r=BX.GetWindowInnerSize();var o=BX.pos(e.swfWorkspaceDiv);if(o.height>r.innerHeight){var s=BX.pos(e.Table.rows[0].cells[2]);var a=BX.GetWindowScrollPos();if(a.scrollTop>s.top-i){e.swfToolboxDiv.style.position="fixed";e.swfToolboxDiv.style.top=i+"px";e.swfToolboxDiv.style.overflowY="auto";e.swfToolboxDiv.style.height=r.innerHeight-i+"px";e.swfToolboxDiv.style.width="200px";e.swfToolboxDiv.style.left=s.left-a.scrollLeft+0+"px"}else if(a.scrollTop<s.top-i){e.swfToolboxDiv.style.position="static"}if(a.scrollTop+r.innerHeight>s.bottom){e.swfToolboxDiv.style.height=s.bottom-a.scrollTop-i+"px"}}else{e.swfToolboxDiv.style.position="static"}};e.UpdateButtonPanel=function(){if(BX.UI.ButtonPanel&&BX.UI.ButtonPanel.pinner){BX.UI.ButtonPanel.pinner.onChange()}};e.DrawSequenceActivity=e.Draw;e.Draw=function(t){requestAnimationFrame((()=>{e.UpdateButtonPanel()}));if(!window.dlgSnippetsSettings){window.dlgSnippetsSettings=new BX.CDialog({content:'<table width="100%"><tr><td align="right" width="40%">'+BPMESS["SEQWF_SNIP_NAME"]+'</td><td width="60%"><input type="hidden" id="snippsid" value=""><input size="40" id="snippstitle" value=""></td></tr><tr><td align="right" width="40%"></td><td width="60%" style="height:100px"></td></tr><tr><td align="right" width="40%"></td><td width="60%"><input type="button" id="snippsdel" value="'+BPMESS["SEQWF_SNIP_DEL_1"]+'"></td></tr></table>',title:BPMESS["SEQWF_SNIP_TITLE_1"],height:200,width:400,buttons:[{title:BX.message("JS_CORE_WINDOW_SAVE"),id:"savebtn",name:"savebtn",action:function(){var e=window.__lastSnippet;var t=e._ind;arUserParams["SNIPPETS"][t]["Properties"]["Title"]=BX("snippstitle").value;e.childNodes[0].rows[0].cells[1].innerHTML=HTMLEncode(document.getElementById("snippstitle").value);this.parentWindow.Close();BCPSaveUserParams()}},BX.CDialog.prototype.btnCancel]});setTimeout((function(){BX("snippsdel").onclick=function(){if(confirm(BPMESS["SEQWF_CONF_1"])){var e=window.__lastSnippet;var t=e._ind;arUserParams["SNIPPETS"].splice(t,1);var i=e.parentNode;BX.remove(e);for(var l=1;l<i.childNodes.length;l++)i.childNodes[l]._ind=l-1;window.dlgSnippetsSettings.Close();BCPSaveUserParams()}}}),1e3)}e.Table=t.appendChild(_crt(1,3));{window.onscroll=e.onScroll;window.onresize=e.onScroll}e.hSnippid1=DragNDrop.AddHandler("ondragging",e.ondragging2);e.hSnippid2=DragNDrop.AddHandler("ondrop",e.ondrop2);e.swfWorkspaceDiv=e.Table.rows[0].cells[0].appendChild(document.createElement("DIV"));e.swfWorkspaceDiv.className="swfworkspace";if(parseInt(t.clientHeight)>50)e.swfWorkspaceDiv.style.height=parseInt(t.clientHeight)+"px";e.ShowActivities(e.Table.rows[0].cells[2]);e._table=e.swfWorkspaceDiv.appendChild(_crt(3,1));e.Table.rows[0].cells[1].style.width="0px";e.Table.rows[0].cells[1].innerHTML='<img src="/bitrix/images/1.gif" width="0">';e.Table.rows[0].cells[2].style.width="200px";e.Table.rows[0].cells[0].vAlign="top";e.Table.rows[0].cells[2].vAlign="top";e.Table.rows[0].cells[2].align="left";e.Table.rows[0].cells[2].appendChild(document.createElement("DIV")).style.width="200px";var i=e._table.rows[0].cells[0].appendChild(document.createElement("DIV"));i.style.margin="0px auto";i.style.textAlign="center";i.style.width="120px";i.innerHTML='<div style="background: url(/bitrix/images/bizproc/beg_bg.gif);"><div style="background: url(/bitrix/images/bizproc/beg_r.gif) right top no-repeat;"><div style="background: url(/bitrix/images/bizproc/beg_l.gif) left top no-repeat; height: 23px;"><div style="padding-top: 3px; font-size: 12px; color:#194d0b;">'+BPMESS["SEQWF_BEG"]+"</div></div></div></div>";e.DrawActivities();var l=e._table.rows[2].cells[0].appendChild(document.createElement("DIV"));l.style.margin="0px auto";l.style.textAlign="center";l.style.width="120px";l.innerHTML='<div style="background: url(/bitrix/images/bizproc/beg_bg.gif);"><div  style="background: url(/bitrix/images/bizproc/beg_r.gif) right top no-repeat;"><div style="background: url(/bitrix/images/bizproc/beg_l.gif) left top no-repeat; height: 23px;"><div style="padding-top: 3px; font-size: 12px; color:#194d0b;">'+BPMESS["SEQWF_END"]+"</div></div></div></div>"};e.DrawActivities=function(){while(e._table.rows[1].cells[0].childNodes.length>0)e._table.rows[1].cells[0].removeChild(e._table.rows[1].cells[0].childNodes[0]);e.DrawSequenceActivity(e._table.rows[1].cells[0])};e.DrawGroup=function(t){var i=e.swfToolboxDiv.childNodes.length;var l=e.swfToolboxDiv.appendChild(document.createElement("DIV"));if(!arUserParams["TOOLBOX_GROUPS"])arUserParams["TOOLBOX_GROUPS"]=[];if(arUserParams["TOOLBOX_GROUPS"][i]==true)l.className="swftoolboxgroupopened";else l.className="swftoolboxgroupclosed";l.swftoolboxid=i;l.onclick=function(t){requestAnimationFrame((()=>{e.UpdateButtonPanel()}));if(this.className=="swftoolboxgroupclosed"){this.className="swftoolboxgroupopened";arUserParams["TOOLBOX_GROUPS"][this.swftoolboxid]=true}else{this.className="swftoolboxgroupclosed";arUserParams["TOOLBOX_GROUPS"][this.swftoolboxid]=false}BCPSaveUserParams()};var r=l.appendChild(document.createElement("DIV"));r.className="swftoolboxgroupheader";r.innerHTML='<div class="t"><div class="tr"><div class="tl"><div class="imarr"></div><div class="swftoolboxgrheadtext" title="'+HTMLEncode(t)+'">'+HTMLEncode(t)+"</div></div></div></div>";var o=l.appendChild(document.createElement("DIV"));o.className="swftoolboxgrouplist";return o};e.DrawGroupItem=function(e,t,i,l){var r,o,s;r=e.appendChild(document.createElement("DIV"));r.onclick=function(e){BX.PreventDefault(e)};if(t["NAME"]!==undefined)r.activityTemplate={Properties:{Title:t["NAME"]},Type:t["CLASS"],Children:[],Icon:t["ICON"]};else r.activityTemplate=t;var a=r.appendChild(_crt(1,3));a.rows[0].style.height="30px";a.rows[0].cells[0].style.width="30px";a.rows[0].cells[0].style.minWidth="30px";if(!r.activityTemplate["Icon"]&&arAllActivities[r.activityTemplate["Type"].toLowerCase()])r.activityTemplate["Icon"]=arAllActivities[r.activityTemplate["Type"].toLowerCase()]["ICON"];if(r.activityTemplate["Icon"])a.rows[0].cells[0].style.background="url("+r.activityTemplate["Icon"]+") 3px 3px no-repeat";else a.rows[0].cells[0].style.background="url(/bitrix/images/bizproc/act_icon.gif) 3px 3px no-repeat";a.rows[0].cells[0].style.cursor="pointer";a.rows[0].cells[1].style.cursor="pointer";a.rows[0].cells[1].style.fontSize="11px";a.rows[0].cells[1].innerHTML=HTMLEncode(r.activityTemplate["Properties"]["Title"]);a.rows[0].cells[1].align="left";if(i){a.rows[0].cells[2].style.width="14px";a.rows[0].cells[2].style.cursor="pointer";a.rows[0].cells[2].innerHTML='<img src="/bitrix/themes/.default/public/popup/pencil.gif" hspace="2">';a.rows[0].cells[2].onmousedown=function(e){return BX.PreventDefault(e)};r._ind=l;a.rows[0].cells[2].onclick=function(e){window.__lastSnippet=this.parentNode.parentNode.parentNode.parentNode;BX("snippstitle").value=r.activityTemplate["Properties"]["Title"];BX("snippsid").value=l;window.dlgSnippetsSettings.Show();return BX.PreventDefault(e)}}a.insertRow(-1);a.rows[1].insertCell(-1).innerHTML='<table width="100%" style="border-collapse: collapse" cellpadding="0" cellspacing="0" border="0"><tr><td width="5"></td><td style="border-bottom: 1px #EBEBEB solid; height: 1px; font-size: 1px;"><img src="/bitrix/images/1.gif" width="1" height="1"></td><td width="5"></td></tr></table>';a.rows[1].cells[0].colSpan="3";r.onmousedown=function(e){if(!e)e=window.event;var t=DragNDrop.StartDrag(e,this.activityTemplate);t.innerHTML=this.innerHTML;t.style.width=this.parentNode.offsetWidth+"px"}};e.DrawMarketplaceItem=function(e){var t,i,l;t=e.appendChild(document.createElement("DIV"));t.onclick=function(e){BX.PreventDefault(e);BX.rest.Marketplace.open({},"auto_pb")};var r=t.appendChild(_crt(1,3));r.rows[0].style.height="30px";r.rows[0].cells[0].style.width="30px";r.rows[0].cells[0].style.background="url(/bitrix/images/bizproc/act_icon_plus.png) 3px 3px no-repeat";r.rows[0].cells[0].style.cursor="pointer";r.rows[0].cells[1].style.cursor="pointer";r.rows[0].cells[1].style.fontSize="11px";r.rows[0].cells[1].innerHTML=HTMLEncode(BPMESS["SEQWF_MARKETPLACE_ADD"]);r.rows[0].cells[1].align="left";r.insertRow(-1);r.rows[1].insertCell(-1).innerHTML='<table width="100%" style="border-collapse: collapse" cellpadding="0" cellspacing="0" border="0"><tr><td width="5"></td><td style="border-bottom: 1px #EBEBEB solid; height: 1px; font-size: 1px;"><img src="/bitrix/images/1.gif" width="1" height="1"></td><td width="5"></td></tr></table>';r.rows[1].cells[0].colSpan="3"};e.ShowActivities=function(t){e.swfToolboxDiv=t.appendChild(document.createElement("DIV"));if(parseInt(t.clientHeight)>50)e.swfToolboxDiv.style.height=parseInt(t.clientHeight)+"px";e.swfToolboxDiv.style.overflowX="hidden";e.swfToolboxDiv.className="swftoolbox";var i,l;for(i in arAllActGroups){l=null;for(var r in arAllActivities){if(!arAllActivities.hasOwnProperty(r))continue;if(arAllActivities[r]["EXCLUDED"]||!arAllActivities[r]["CATEGORY"])continue;var o=arAllActivities[r]["CATEGORY"]["ID"];if(arAllActivities[r]["CATEGORY"]["OWN_ID"])o=arAllActivities[r]["CATEGORY"]["OWN_ID"];if(o!=i)continue;if(r=="setstateactivity"&&rootActivity.Type==e.Type)continue;if(l===null)l=e.DrawGroup(arAllActGroups[i]);e.DrawGroupItem(l,arAllActivities[r]);const t=arAllActivities[r]["PRESETS"];if(BX.Type.isArrayFilled(t)){t.forEach((t=>{const i={Properties:{Title:t["NAME"],...t["PROPERTIES"]},Type:arAllActivities[r]["CLASS"],Children:[],Icon:arAllActivities[r]["ICON"]};e.DrawGroupItem(l,i)}))}}if(i==="rest"&&BX.getClass("BX.rest.Marketplace")){if(l===null){l=e.DrawGroup(arAllActGroups[i])}e.DrawMarketplaceItem(l)}}var s=e.DrawGroup(BPMESS["SEQWF_SNIP_1"]);e.divSnippets=s;var a=s.appendChild(document.createElement("DIV"));a.style.padding="4px";var n=a.appendChild(document.createElement("DIV"));n.style.padding="7px 5px 7px 5px";n.style.textAlign="center";n.style.color="#AAAAAA";n.style.border="1px dashed #DDDDDD";n.innerHTML=BPMESS["SEQWF_SNIP_DD_1"];e.drdrop=n;arUserParams["SNIPPETS"]=arUserParams["SNIPPETS"]||[];for(var p in arUserParams["SNIPPETS"]){if(!arUserParams["SNIPPETS"].hasOwnProperty(p))continue;e.DrawGroupItem(e.divSnippets,arUserParams["SNIPPETS"][p],true,p)}};e.lastDrop2=false;e.ondragging2=function(t,i,l){var r=BX.pos(e.drdrop);if(r.left<i&&i<r.right&&r.top<l&&l<r.bottom){e.drdrop.style.border="1px dashed #333333";e.lastDrop2=true;return}if(e.lastDrop2){e.drdrop.style.border="1px dashed #DDDDDD";e.lastDrop2=false}};e.ondrop2=function(t,i,l){if(e.lastDrop2){var r=CreateActivity(DragNDrop.obj);e.DrawGroupItem(e.divSnippets,r,true,arUserParams["SNIPPETS"].length);arUserParams["SNIPPETS"].push(r.Serialize());BCPSaveUserParams();e.drdrop.style.border="1px dashed #DDDDDD";e.lastDrop2=false}};e.RemoveResourcesSequenceActivity=e.RemoveResources;e.RemoveResources=function(){requestAnimationFrame((()=>{e.UpdateButtonPanel()}));if(e.hSnippid1){DragNDrop.RemoveHandler("ondragging",e.hSnippid1);DragNDrop.RemoveHandler("ondrop",e.hSnippid2);e.hSnippid1=false}e.RemoveResourcesSequenceActivity();if(e.Table){e.Table.parentNode.removeChild(e.Table);e.Table=null}};return e};
//# sourceMappingURL=sequentialworkflowactivity.map.js