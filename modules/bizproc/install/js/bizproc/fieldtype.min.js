if(!BX.getClass("BX.Bizproc.FieldType"))(function(e){"use strict";e.namespace("BX.Bizproc");var t=function(e){return e.Multiple===true};var r=function(t){if(!e.type.isArray(t)){return[t]}return t};var i=function(t){if(e.Type.isArray(t)){return t.map((e=>e?e.replace(/(\s\[-?[0-9]+\])$/,""):""))}return t?t.replace(/(\s\[-?[0-9]+\])$/,""):""};var a=function(e){return e.Options?e.Options:{}};var o=function(t){let r="";if(!e.Type.isUndefined(t.Placeholder)){r=String(t.Placeholder)}return r};var n={isBaseType:function(e){switch(e){case"bool":case"UF:boolean":case"select":case"internalselect":case"date":case"UF:date":case"datetime":case"text":case"int":case"double":case"string":case"user":return true}return false},renderControl:function(t,r,i,a,o){if(!o||o==="public"){return this.renderControlPublic(t,r,i,a)}if(o==="designer"){return this.renderControlDesigner(t,r,i,a)}return e.create("div",{text:"incorrect render mode"})},renderControlPublic:function(i,a,o,n,c){var s,l=this.getRenderFunctionName(a);if(!e.Type.isBoolean(c)){c=true}if(e.type.isString(i)){i=i.split("@")}if(l){if(t(a)&&a.Type!=="select"){var p=[],u=this;r(n).forEach((function(e){p.push(u[l](a,o,e))}));if(p.length<=0){p.push(u[l](a,o))}s=this.wrapMultipleControls(a,o,p)}else{s=e.create("div",{children:[this[l](a,o,n)]})}}else{s=e.create("div",{text:"..."});e.ajax.post("/bitrix/tools/bizproc_get_field.php",{DocumentType:i,Field:{Field:o,Form:"sfa_form"},Value:n||"",Type:a,Als:0,rnd:Math.random(),Mode:"",Func:"",sessid:e.bitrix_sessid(),RenderMode:"public"},function(e){if(e){s.innerHTML=e;this.initControl(s,a)}}.bind(this));if(a["Type"]==="user"){c=false}}if(c&&s){return this.initControl(s,a)||s}return s},renderControlDesigner:function(t,r,i,a){var o=e.create("div",{text:"..."});e.ajax.post("/bitrix/tools/bizproc_get_field.php",{DocumentType:t,Field:{Field:i,Form:"sfa_form"},Value:a||"",Type:r,Als:1,rnd:Math.random(),Mode:"",Func:"",sessid:e.bitrix_sessid(),RenderMode:"designer"},(function(t){if(t){o.innerHTML=t;if(typeof e.Bizproc.Selector!=="undefined"){e.Bizproc.Selector.initSelectors(o)}}}));return o},formatValuePrintable:function(t,r){var a;switch(t["Type"]){case"bool":case"UF:boolean":a=e.message(r==="Y"?"BIZPROC_JS_BP_FIELD_TYPE_YES":"BIZPROC_JS_BP_FIELD_TYPE_NO");break;case"select":case"internalselect":var o=t["Options"]||{};if(e.type.isArray(r)){a=[];r.forEach((function(e){a.push(o[e])}));a=a.join(", ")}else{a=o[r]}break;case"date":case"UF:date":case"datetime":a=i(r);break;case"text":case"int":case"double":case"string":a=r;break;case"user":a=[];var n,c,s,l,p=e.Type.isArray(r)?r:r.split(",");for(n=0;n<p.length;++n){s=e.util.trim(p[n]);if(l=s.match(/(.*)\[([A-Z]{0,2}\d+)\]/)){c=e.util.trim(l[1]);a.push(c)}else{a.push(s)}}a=a.join(", ");break;default:if(e.type.isString(r)){a=r}else{a="(?)"}break}return a},getRenderFunctionName:function(e){var t;switch(e["Type"]){case"B":case"bool":case"UF:boolean":t="createBoolNode";break;case"date":case"UF:date":case"datetime":case"S:Date":case"S:DateTime":t="createDateNode";break;case"L":case"select":case"internalselect":t="createSelectNode";break;case"T":case"text":t="createTextNode";break;case"N":case"int":case"double":t="createNumericNode";break;case"S":case"string":t="createStringNode";break;case"F":case"file":t="createFileNode";break}return t},wrapMultipleControls:function(t,r,i){var a=e.create("div",{children:i});var o=e.create("a",{attrs:{className:"bizproc-type-control-clone-btn"},text:e.message("BIZPROC_JS_BP_FIELD_TYPE_ADD"),events:{click:function(e){e.preventDefault();n.cloneControl(t,r,this.parentNode)}}});a.appendChild(e.create("div",{children:[o]}));return a},cloneControl:function(t,r,i){var a=this.getRenderFunctionName(t);if(a){var o=this[a](t,r);if(o&&i.parentNode){var n=e.create("div",{children:[o]});this.initControl(n,t);i.parentNode.insertBefore(n,i)}}},createControlOptions:function(t,r){var i=a(t);var o="";for(var n in i){if(String(n)!==String(i[n])){o+="["+n+"]"+i[n]}else{o+=i[n]}o+="\n"}var c=e.util.getRandomString(3);var s=e.create("textarea",{attrs:{id:"bizproc_fieldtype_select_form_options_"+c}});s.innerHTML=e.util.htmlspecialchars(o);var l=this;var p=e.create("button",{attrs:{type:"button"},text:e.Loc.getMessage("BIZPROC_JS_BP_FIELD_TYPE_SELECT_OPTIONS3"),events:{click:function(){r(l.parseSelectFormOptions(c))}}});var u=e.create("div");u.appendChild(s);u.appendChild(e.create("br"));u.innerHTML+=e.Loc.getMessage("BIZPROC_JS_BP_FIELD_TYPE_SELECT_OPTIONS1");u.appendChild(e.create("br"));u.innerHTML+=e.Loc.getMessage("BIZPROC_JS_BP_FIELD_TYPE_SELECT_OPTIONS2");u.appendChild(e.create("br"));u.appendChild(p);return u},parseSelectFormOptions:function(t){var r={};var i=document.getElementById("bizproc_fieldtype_select_form_options_"+t).value;if(!i){return r}var a=i.split(/[\r\n]+/);var o=/\[([^\]]+)].+/;for(var n in a){var c=e.util.trim(a[n]);if(c.length>0){var s=c.match(o);if(s){var l=c.indexOf("]");r[s[1]]=c.substr(l+1)}else{r[c]=c}}}return r},createBoolNode:function(r,i,a){var o=e.message("BIZPROC_JS_BP_FIELD_TYPE_YES");var n=e.message("BIZPROC_JS_BP_FIELD_TYPE_NO");o=o.charAt(0).toUpperCase()+o.slice(1);n=n.charAt(0).toUpperCase()+n.slice(1);var c=e.create("select",{attrs:{className:"bizproc-type-control bizproc-type-control-bool"+(t(r)?" bizproc-type-control-multiple":"")},props:{name:i+(t(r)?"[]":"")},children:[e.create("option",{props:{value:""},text:e.message("BIZPROC_JS_BP_FIELD_TYPE_NOT_SELECTED")})]});var s=e.create("option",{props:{value:"Y"},text:o});if(a==="Y"||a===1||a==="1"){s.setAttribute("selected","selected")}var l=e.create("option",{props:{value:"N"},text:n});if(a==="N"||a===0||a==="0"){l.setAttribute("selected","selected")}c.appendChild(s);c.appendChild(l);return c},createDateNode:function(r,a,n){var c=r["Type"];if(c==="UF:date"||c==="S:Date"){c="date"}if(c==="S:DateTime"){c="datetime"}var s=e.create("input",{attrs:{className:"bizproc-type-control bizproc-type-control-"+c+(t(r)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target","data-selector-type":c,placeholder:o(r)},props:{type:"text",name:a+(t(r)?"[]":""),value:i(n)}});var l=e.getClass("BX.Bizproc.Automation.Designer")&&e.Bizproc.Automation.Designer.getInstance();var p=l&&l.getRobotSettingsDialog();if(!p){var u=e.create("img",{attrs:{src:"/bitrix/js/main/core/images/calendar-icon.gif",className:"calendar-icon",border:"0"},events:{click:function(t){t.preventDefault();e.calendar({node:this,field:s,bTime:c==="datetime",bHideTime:c==="date"})}}});var d;if(r["Settings"]&&r["Settings"]["timezones"]){d=e.create("select",{props:{name:"tz_"+(a+(t(r)?"[]":""))},attrs:{className:"bizproc-type-control-date-lc"}});r["Settings"]["timezones"].forEach((function(t){var r=e.create("option",{props:{value:t.value},text:t.text});if(t.value==="current"){r.setAttribute("selected","selected")}d.appendChild(r)}))}return e.create("div",{children:[s,u,d]})}return s},createNumericNode:function(r,i,a){return e.create("input",{attrs:{className:"bizproc-type-control bizproc-type-control-int"+(t(r)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target",placeholder:o(r)},props:{type:"text",name:i+(t(r)?"[]":""),value:a||""}})},createStringNode:function(r,i,a){return e.create("input",{attrs:{className:"bizproc-type-control bizproc-type-control-string"+(t(r)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target",placeholder:o(r)},props:{type:"text",name:i+(t(r)?"[]":""),value:a||""}})},createFileNode:function(r,i,a){var o=e.getClass("BX.Bizproc.Automation.Designer")&&e.Bizproc.Automation.Designer.getInstance();var n=o&&o.getRobotSettingsDialog();if(!n){var c=e.create("input",{props:{type:"file",name:i+(t(r)?"[]":""),value:a||""},events:{change:function(){this.nextSibling.textContent=e.Bizproc.FieldType.File.parseLabel(this.value)}}});var s=e.create("span",{children:[e.create("span",{attrs:{className:"webform-small-button"},text:e.message("BIZPROC_JS_BP_FIELD_TYPE_CHOOSE_FILE")})]});return e.create("div",{children:[s,c,e.create("span",{attrs:{className:"bizproc-type-control-file-label"}})],attrs:{className:"bizproc-type-control bizproc-type-control-file"+(t(r)?" bizproc-type-control-multiple":"")}})}return e.create("input",{attrs:{className:"bizproc-type-control bizproc-type-control-file-selectable"+(t(r)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target","data-selector-type":"file"},props:{type:"text",name:i+(t(r)?"[]":""),value:a||""}})},createTextNode:function(r,i,a){return e.create("textarea",{attrs:{className:"bizproc-type-control bizproc-type-control-text"+(t(r)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target",rows:5,cols:40,placeholder:o(r)},props:{name:i+(t(r)?"[]":""),value:a||""}})},createSelectNode:function(r,i,a){var o=function(t,r){if(!t||!r){return false}if(e.type.isArray(r)){return e.util.in_array(t,r)}return t.toString()===r.toString()};var n,c=e.create("select",{attrs:{className:"bizproc-type-control bizproc-type-control-select"+(t(r)?" bizproc-type-control-multiple":"")},props:{name:i+(t(r)?"[]":"")}});var s=function(){return e.create("option",{props:{value:""},text:e.message("BIZPROC_JS_BP_FIELD_TYPE_NOT_SELECTED")})};if(t(r)){c.setAttribute("multiple","multiple");c.setAttribute("size","5")}n=s();if(e.Type.isNil(a)||a.length===0){n.setAttribute("selected","selected")}c.appendChild(n);if(e.type.isPlainObject(r["Options"])){for(var l in r["Options"]){if(!r["Options"].hasOwnProperty(l)){continue}n=e.create("option",{props:{value:l},text:e.Text.decode(r["Options"][l])});if(o(l,a)){n.setAttribute("selected","selected")}c.appendChild(n)}}else if(e.type.isArray(r["Options"])){for(var p=0;p<r["Options"].length;++p){n=e.create("option",{props:{value:p},text:e.Text.decode(r["Options"][p])});if(o(p,a)){n.setAttribute("selected","selected")}c.appendChild(n)}}return c},initControl:function(t,r){var i=e.getClass("BX.Bizproc.Automation.Designer")&&e.Bizproc.Automation.Designer.getInstance();var a;var o=t.querySelectorAll("[data-role]");if(i&&i.getRobotSettingsDialog()){a=i.getRobotSettingsDialog();a.template.initRobotSettingsControls(a.robot,t)}else if(i&&i.getTriggerSettingsDialog()){a=i.getTriggerSettingsDialog();a.triggerManager.initSettingsDialogControls(t)}else if(r&&r["Type"]==="user"&&e.Bizproc.UserSelector){e.Bizproc.UserSelector.decorateNode(t.querySelector('[data-role="user-selector"]'))}else if(o.length>0){var n=e.Bizproc.Automation&&e.Bizproc.Automation.tryGetGlobalContext();if(n){o.forEach((function(t){var r=e.Bizproc.Automation.SelectorManager.createSelectorByRole(t.getAttribute("data-role"),{context:new e.Bizproc.Automation.SelectorContext({fields:e.clone(n.document.getFields()),useSwitcherMenu:n.get("showTemplatePropertiesMenuOnSelecting"),rootGroupTitle:n.document.title,userOptions:n.userOptions})});if(r&&t.parentNode){t.parentNode.replaceChild(r.renderWith(t),t)}}))}}},getDocumentFields:function(){var t=e.getClass("BX.Bizproc.Automation.Designer")&&e.Bizproc.Automation.Designer.getInstance();var r=t&&t.component;if(r){return r.data["DOCUMENT_FIELDS"]}if(e.getClass("BX.Bizproc.Automation.API.documentFields")){return e.Bizproc.Automation.API.documentFields}return[]},getDocumentUserGroups:function(){if(e.getClass("BX.Bizproc.Automation.API.documentUserGroups")){return e.Bizproc.Automation.API.documentUserGroups}return[]}};n.File={parseLabel:function(e){var t;if(e.lastIndexOf("\\")){t=e.lastIndexOf("\\")+1}else{t=e.lastIndexOf("/")+1}return e.slice(t)}};e.Bizproc.FieldType=n})(window.BX||window.top.BX);
//# sourceMappingURL=fieldtype.map.js