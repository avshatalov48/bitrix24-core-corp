if(!BX.getClass("BX.Bizproc.FieldType"))(function(e){"use strict";e.namespace("BX.Bizproc");var t=function(e){return e.Multiple===true};var r=function(t){if(!e.type.isArray(t)){return[t]}return t};var i={renderControl:function(i,a,o,n){var c,s=this.getRenderFunctionName(a),l=true;if(s){if(t(a)&&a.Type!=="select"){var p=[],u=this;r(n).forEach(function(e){p.push(u[s](a,o,e))});c=this.wrapMultipleControls(a,o,p)}else{c=e.create("div",{children:[this[s](a,o,n)]})}}else if(a["Type"]==="user"){c=e.create("div",{children:[e.create("div",{attrs:{className:"bizproc-type-control bizproc-type-control-user","data-role":"user-selector","data-config":JSON.stringify({valueInputName:o,value:n,multiple:a.Multiple===true,required:a.Required===true})}})]})}else{c=e.create("div",{text:"..."});e.ajax.post("/bitrix/tools/bizproc_get_field.php",{DocumentType:i,Field:{Field:o,Form:"sfa_form"},Value:n||"",Type:a,Als:0,rnd:Math.random(),Mode:"",Func:"",sessid:e.bitrix_sessid()},function(e){if(e){c.innerHTML=e;this.initControl(c)}}.bind(this))}if(l&&c){this.initControl(c)}return c},formatValuePrintable:function(t,r){var i;switch(t["Type"]){case"bool":case"UF:boolean":i=e.message(r==="Y"?"BIZPROC_JS_BP_FIELD_TYPE_YES":"BIZPROC_JS_BP_FIELD_TYPE_NO");break;case"select":case"internalselect":if(e.type.isArray(r)){i=[];r.forEach(function(e){i.push(t["Options"][e])});i=i.join(", ")}else{i=t["Options"][r]}break;case"date":case"UF:date":case"datetime":case"text":case"int":case"double":case"string":i=r;break;case"user":i=[];var a,o,n,c,s=r.split(",");for(a=0;a<s.length;++a){n=e.util.trim(s[a]);if(c=n.match(/(.*)\[([A-Z]{0,2}\d+)\]/)){o=e.util.trim(c[1]);i.push(o)}else{i.push(n)}}i=i.join(", ");break;default:if(e.type.isString(r)){i=r}else{i="(?)"}break}return i},getRenderFunctionName:function(e){var t;switch(e["Type"]){case"B":case"bool":case"UF:boolean":t="createBoolNode";break;case"date":case"UF:date":case"datetime":case"S:Date":case"S:DateTime":t="createDateNode";break;case"L":case"select":case"internalselect":t="createSelectNode";break;case"T":case"text":t="createTextNode";break;case"N":case"int":case"double":t="createNumericNode";break;case"S":case"string":t="createStringNode";break;case"F":case"file":t="createFileNode";break}return t},wrapMultipleControls:function(t,r,a){var o=e.create("div",{children:a});var n=e.create("a",{attrs:{className:"bizproc-type-control-clone-btn"},text:e.message("BIZPROC_JS_BP_FIELD_TYPE_ADD"),events:{click:function(e){e.preventDefault();i.cloneControl(t,r,this.parentNode)}}});o.appendChild(e.create("div",{children:[n]}));return o},cloneControl:function(t,r,i){var a=this.getRenderFunctionName(t);if(a){var o=this[a](t,r);if(o&&i.parentNode){var n=e.create("div",{children:[o]});this.initControl(n);i.parentNode.insertBefore(n,i)}}},createBoolNode:function(r,i,a){var o=e.message("BIZPROC_JS_BP_FIELD_TYPE_YES");var n=e.message("BIZPROC_JS_BP_FIELD_TYPE_NO");o=o.charAt(0).toUpperCase()+o.slice(1);n=n.charAt(0).toUpperCase()+n.slice(1);var c=e.create("select",{attrs:{className:"bizproc-type-control bizproc-type-control-bool"+(t(r)?" bizproc-type-control-multiple":"")},props:{name:i+(t(r)?"[]":"")},children:[e.create("option",{props:{value:""},text:e.message("BIZPROC_JS_BP_FIELD_TYPE_NOT_SELECTED")})]});var s=e.create("option",{props:{value:"Y"},text:o});if(a==="Y"||a===1||a==="1"){s.setAttribute("selected","selected")}var l=e.create("option",{props:{value:"N"},text:n});if(a==="N"||a===0||a==="0"){l.setAttribute("selected","selected")}c.appendChild(s);c.appendChild(l);return c},createDateNode:function(r,i,a){var o=r["Type"];if(o==="UF:date"||o==="S:Date"){o="date"}if(o==="S:DateTime"){o="datetime"}var n=e.create("input",{attrs:{className:"bizproc-type-control bizproc-type-control-"+o+(t(r)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target","data-selector-type":o},props:{type:"text",name:i+(t(r)?"[]":""),value:a||""}});var c=e.Bizproc.Automation&&e.Bizproc.Automation.Designer.getRobotSettingsDialog();if(!c){var s=e.create("img",{attrs:{src:"/bitrix/js/main/core/images/calendar-icon.gif",className:"calendar-icon",border:"0"},events:{click:function(t){t.preventDefault();e.calendar({node:this,field:n,bTime:o==="datetime",bHideTime:o==="date"})}}});return e.create("div",{children:[n,s]})}return n},createNumericNode:function(r,i,a){return e.create("input",{attrs:{className:"bizproc-type-control bizproc-type-control-int"+(t(r)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target"},props:{type:"text",name:i+(t(r)?"[]":""),value:a||""}})},createStringNode:function(r,i,a){return e.create("input",{attrs:{className:"bizproc-type-control bizproc-type-control-string"+(t(r)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target"},props:{type:"text",name:i+(t(r)?"[]":""),value:a||""}})},createFileNode:function(r,i,a){var o=e.Bizproc.Automation&&e.Bizproc.Automation.Designer.getRobotSettingsDialog();if(!o){var n=e.create("input",{props:{type:"file",name:i+(t(r)?"[]":""),value:a||""},events:{change:function(){this.nextSibling.textContent=e.Bizproc.FieldType.File.parseLabel(this.value)}}});var c=e.create("span",{children:[e.create("span",{attrs:{className:"webform-small-button"},text:e.message("BIZPROC_JS_BP_FIELD_TYPE_CHOOSE_FILE")})]});return e.create("div",{children:[c,n,e.create("span",{attrs:{className:"bizproc-type-control-file-label"}})],attrs:{className:"bizproc-type-control bizproc-type-control-file"+(t(r)?" bizproc-type-control-multiple":"")}})}return e.create("input",{attrs:{className:"bizproc-type-control bizproc-type-control-file-selectable"+(t(r)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target","data-selector-type":"file"},props:{type:"text",name:i+(t(r)?"[]":""),value:a||""}})},createTextNode:function(r,i,a){return e.create("textarea",{attrs:{className:"bizproc-type-control bizproc-type-control-text"+(t(r)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target",rows:5,cols:40},props:{name:i+(t(r)?"[]":"")},text:a||""})},createSelectNode:function(r,i,a){var o=function(t,r){if(!t||!r){return false}if(e.type.isArray(r)){return e.util.in_array(t,r)}return t.toString()===r.toString()};var n,c=e.create("select",{attrs:{className:"bizproc-type-control bizproc-type-control-select"+(t(r)?" bizproc-type-control-multiple":"")},props:{name:i+(t(r)?"[]":"")},children:[e.create("option",{props:{value:""},text:e.message("BIZPROC_JS_BP_FIELD_TYPE_NOT_SELECTED")})]});if(t(r)){c.setAttribute("multiple","multiple");c.setAttribute("size","5")}if(e.type.isPlainObject(r["Options"])){for(var s in r["Options"]){if(!r["Options"].hasOwnProperty(s)){continue}n=e.create("option",{props:{value:s},text:r["Options"][s]});if(o(s,a)){n.setAttribute("selected","selected")}c.appendChild(n)}}else if(e.type.isArray(r["Options"])){for(var l=0;l<r["Options"].length;++l){n=e.create("option",{props:{value:l},text:r["Options"][l]});if(o(l,a)){n.setAttribute("selected","selected")}c.appendChild(n)}}return c},initControl:function(t){var r;if(r=e.Bizproc.Automation&&e.Bizproc.Automation.Designer.getRobotSettingsDialog()){r.template.initRobotSettingsControls(r.robot,t)}else if(r=e.Bizproc.Automation&&e.Bizproc.Automation.Designer.getTriggerSettingsDialog()){r.component.triggerManager.initSettingsDialogControls(t)}},getDocumentFields:function(){var t=[];var r=e.Bizproc.Automation&&e.Bizproc.Automation.Designer.getRobotSettingsDialog();if(r){t=r.robot.component.data["DOCUMENT_FIELDS"]}return t}};i.File={parseLabel:function(e){var t;if(e.lastIndexOf("\\")){t=e.lastIndexOf("\\")+1}else{t=e.lastIndexOf("/")+1}return e.slice(t)}};e.Bizproc.FieldType=i})(window.BX||window.top.BX);
//# sourceMappingURL=fieldtype.map.js