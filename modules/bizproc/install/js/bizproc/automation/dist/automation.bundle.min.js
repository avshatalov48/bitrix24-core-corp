this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,t,i,a,s,r,l,n,o){"use strict";function c(e,t,i){u(e,t);t.set(e,i)}function u(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var p=new WeakMap;var b=new WeakMap;var d=new WeakMap;var v=function(){function e(t){babelHelpers.classCallCheck(this,e);c(this,p,{writable:true,value:void 0});c(this,b,{writable:true,value:void 0});c(this,d,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,p,t.DocumentType);babelHelpers.classPrivateFieldSet(this,b,!n.Type.isNil(t.Category.Id)?t.Category:null);babelHelpers.classPrivateFieldSet(this,d,t.Status)}babelHelpers.createClass(e,[{key:"getId",value:function e(){if(this.hasCategory()){return"".concat(babelHelpers.classPrivateFieldGet(this,p).Type,"_").concat(babelHelpers.classPrivateFieldGet(this,b).Id,"_").concat(babelHelpers.classPrivateFieldGet(this,d).Id)}return"".concat(babelHelpers.classPrivateFieldGet(this,p).Type,"_").concat(babelHelpers.classPrivateFieldGet(this,d).Id)}},{key:"getDocumentType",value:function e(){return babelHelpers.classPrivateFieldGet(this,p)}},{key:"getDocumentCategory",value:function e(){return babelHelpers.classPrivateFieldGet(this,b)}},{key:"getDocumentStatus",value:function e(){return babelHelpers.classPrivateFieldGet(this,d)}},{key:"hasCategory",value:function e(){return!n.Type.isNull(babelHelpers.classPrivateFieldGet(this,b))}}]);return e}();function h(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=f(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var s=function e(){};return{s:s,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!r&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function f(e,t){if(!e)return;if(typeof e==="string")return g(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return g(e,t)}function g(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++){a[i]=e[i]}return a}function m(e,t){P(e,t);t.add(e)}function T(e,t,i){P(e,t);t.set(e,i)}function P(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function y(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var H=new WeakMap;var I=new WeakSet;var O=function(){function e(t){var i=this;babelHelpers.classCallCheck(this,e);m(this,I);T(this,H,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,H,[]);if(n.Type.isArray(t)){t.forEach((function(e){var t=new v(e);babelHelpers.classPrivateFieldGet(i,H).push(t)}))}}babelHelpers.createClass(e,[{key:"getDocumentTypes",value:function e(){var t=new Map;var i=h(babelHelpers.classPrivateFieldGet(this,H)),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;t.set(s.getDocumentType().Type,s.getDocumentType())}}catch(e){i.e(e)}finally{i.f()}return Array.from(t.values())}},{key:"getTypeCategories",value:function e(t){var i=new Map;var a=h(babelHelpers.classPrivateFieldGet(this,H)),s;try{for(a.s();!(s=a.n()).done;){var r=s.value;if(r.hasCategory()&&r.getDocumentType().Type===t.Type){var l=r.getDocumentCategory();i.set(l.Id,l)}}}catch(e){a.e(e)}finally{a.f()}return Array.from(i.values())}},{key:"getTypeStatuses",value:function e(t,i){var a=new Set;if(n.Type.isNil(i)){i={Id:null}}var s=function e(s){var r=s.getDocumentType().Type===t.Type&&(s.hasCategory()?s.getDocumentCategory().Id===i.Id:true)&&!a.has(s.getDocumentStatus().Id);if(r){a.add(s.getDocumentStatus().Id)}return r};return Array.from(y(this,I,E).call(this,s)).map((function(e){return e.getDocumentStatus()}))}}]);return e}();function E(e){var t=regeneratorRuntime.mark((function t(i){var a,s,r;return regeneratorRuntime.wrap((function t(l){while(1){switch(l.prev=l.next){case 0:a=h(i);l.prev=1;a.s();case 3:if((s=a.n()).done){l.next=10;break}r=s.value;if(!e(r)){l.next=8;break}l.next=8;return r;case 8:l.next=3;break;case 10:l.next=15;break;case 12:l.prev=12;l.t0=l["catch"](1);a.e(l.t0);case 15:l.prev=15;a.f();return l.finish(15);case 18:case"end":return l.stop()}}}),t,null,[[1,12,15,18]])}));return t(babelHelpers.classPrivateFieldGet(this,H))}function F(e,t,i){C(e,t);t.set(e,i)}function C(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _(e,t,i){A(e,t);S(i,"get");return k(e,i)}function S(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function A(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function k(e,t){if(t.get){return t.get.call(e)}return t.value}var N=new WeakMap;var w=new WeakMap;var G=function(){function e(t){babelHelpers.classCallCheck(this,e);F(this,N,{writable:true,value:void 0});F(this,w,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,N,t);babelHelpers.classPrivateFieldSet(this,w,{})}babelHelpers.createClass(e,[{key:"isNone",value:function t(){return babelHelpers.classPrivateFieldGet(this,N)===_(e,e,M)}},{key:"isView",value:function t(){return babelHelpers.classPrivateFieldGet(this,N)===_(e,e,D)}},{key:"isEdit",value:function t(){return babelHelpers.classPrivateFieldGet(this,N)===_(e,e,R)}},{key:"isManage",value:function t(){return babelHelpers.classPrivateFieldGet(this,N)===_(e,e,L)}},{key:"setProperty",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,w)[t]=i;return this}},{key:"getProperty",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(babelHelpers.classPrivateFieldGet(this,w).hasOwnProperty(t)){return babelHelpers.classPrivateFieldGet(this,w)[t]}return i}},{key:"intoRaw",value:function e(){return babelHelpers.classPrivateFieldGet(this,N)}}],[{key:"none",value:function t(){return new e(_(e,e,M))}},{key:"view",value:function t(){return new e(_(e,e,D))}},{key:"edit",value:function t(){return new e(_(e,e,R))}},{key:"manage",value:function t(){return new e(_(e,e,L))}},{key:"fromRaw",value:function t(i){if(e.getAll().includes(i)){return new e(i)}return e.none()}},{key:"getAll",value:function t(){return[_(this,e,M),_(this,e,D),_(this,e,R),_(this,e,L)]}}]);return e}();var M={writable:true,value:0};var D={writable:true,value:1};var R={writable:true,value:2};var L={writable:true,value:3};function B(e,t,i){x(e,t);t.set(e,i)}function x(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var z=new WeakMap;var U=new WeakMap;var W=new WeakMap;var j=new WeakMap;var Y=new WeakMap;var Z=new WeakMap;var X=new WeakMap;var V=new WeakMap;var K=new WeakMap;var q=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));B(babelHelpers.assertThisInitialized(e),z,{writable:true,value:void 0});B(babelHelpers.assertThisInitialized(e),U,{writable:true,value:void 0});B(babelHelpers.assertThisInitialized(e),W,{writable:true,value:void 0});B(babelHelpers.assertThisInitialized(e),j,{writable:true,value:void 0});B(babelHelpers.assertThisInitialized(e),Y,{writable:true,value:void 0});B(babelHelpers.assertThisInitialized(e),Z,{writable:true,value:void 0});B(babelHelpers.assertThisInitialized(e),X,{writable:true,value:void 0});B(babelHelpers.assertThisInitialized(e),V,{writable:true,value:void 0});B(babelHelpers.assertThisInitialized(e),K,{writable:true,value:void 0});e.setEventNamespace("BX.Bizproc.Automation");e.draft=false;babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),z,{});babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),U,false);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),W,G.none());babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),j,new s.ConditionGroup);return e}babelHelpers.createClass(t,[{key:"init",value:function e(t,i){babelHelpers.classPrivateFieldSet(this,z,n.clone(t));if(!n.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,z)["APPLY_RULES"])){babelHelpers.classPrivateFieldGet(this,z)["APPLY_RULES"]={}}if(babelHelpers.classPrivateFieldGet(this,z)["APPLY_RULES"].Condition){babelHelpers.classPrivateFieldSet(this,j,new s.ConditionGroup(babelHelpers.classPrivateFieldGet(this,z)["APPLY_RULES"].Condition))}else{babelHelpers.classPrivateFieldSet(this,j,new s.ConditionGroup)}babelHelpers.classPrivateFieldSet(this,W,n.Type.isNil(i)?G.edit():i);babelHelpers.classPrivateFieldSet(this,Y,this.createNode())}},{key:"reInit",value:function e(t,i){var a=babelHelpers.classPrivateFieldGet(this,Y);babelHelpers.classPrivateFieldSet(this,Y,this.createNode());if(a.parentNode){a.parentNode.replaceChild(babelHelpers.classPrivateFieldGet(this,Y),a)}}},{key:"canEdit",value:function e(){return s.getGlobalContext().canEdit}},{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,z)["ID"]||0}},{key:"getStatusId",value:function e(){return String(babelHelpers.classPrivateFieldGet(this,z)["DOCUMENT_STATUS"]||"")}},{key:"getStatus",value:function e(){var t=this;return s.getGlobalContext().document.statusList.find((function(e){return String(e.STATUS_ID)===t.getStatusId()}))}},{key:"getCode",value:function e(){var t;return(t=babelHelpers.classPrivateFieldGet(this,z)["CODE"])!==null&&t!==void 0?t:""}},{key:"getName",value:function e(){var t=babelHelpers.classPrivateFieldGet(this,z)["NAME"];if(!t){var i;var a=this.getCode();var r=s.getGlobalContext().availableTriggers.find((function(e){return a===e["CODE"]}));t=(i=r===null||r===void 0?void 0:r.NAME)!==null&&i!==void 0?i:a}return t}},{key:"setName",value:function e(t){if(n.Type.isString(t)){babelHelpers.classPrivateFieldGet(this,z)["NAME"]=t}return this}},{key:"getApplyRules",value:function e(){return babelHelpers.classPrivateFieldGet(this,z)["APPLY_RULES"]}},{key:"setApplyRules",value:function e(t){babelHelpers.classPrivateFieldGet(this,z)["APPLY_RULES"]=t;return this}},{key:"getLogStatus",value:function e(){var t=s.getGlobalContext().tracker.getTriggerLog(this.getId());return t?t.status:null}},{key:"getCondition",value:function e(){return babelHelpers.classPrivateFieldGet(this,j)}},{key:"setCondition",value:function e(t){babelHelpers.classPrivateFieldSet(this,j,t);return this}},{key:"isBackwardsAllowed",value:function e(){return babelHelpers.classPrivateFieldGet(this,z)["APPLY_RULES"]["ALLOW_BACKWARDS"]==="Y"}},{key:"setAllowBackwards",value:function e(t){babelHelpers.classPrivateFieldGet(this,z)["APPLY_RULES"]["ALLOW_BACKWARDS"]=t?"Y":"N";return this}},{key:"getExecuteBy",value:function e(){return babelHelpers.classPrivateFieldGet(this,z)["APPLY_RULES"]["ExecuteBy"]||""}},{key:"setExecuteBy",value:function e(t){babelHelpers.classPrivateFieldGet(this,z)["APPLY_RULES"]["ExecuteBy"]=t;return this}},{key:"createNode",value:function e(){var t="bizproc-automation-trigger-item-wrapper";if(babelHelpers.classPrivateFieldGet(this,W).isEdit()&&this.canEdit()){t+=" bizproc-automation-trigger-item-wrapper-draggable"}var i=null;var a=null;if(babelHelpers.classPrivateFieldGet(this,W).isEdit()){i=n.Dom.create("div",{attrs:{className:"bizproc-automation-trigger-item-wrapper-edit"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EDIT")});a=n.Dom.create("div",{attrs:{className:"bizproc-automation-trigger-btn-copy"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_COPY")||"copy"});n.Event.bind(a,"click",this.onCopyButtonClick.bind(this,a))}if(this.getLogStatus()===s.TrackingStatus.COMPLETED){t+=" bizproc-automation-trigger-item-wrapper-complete"}else if(s.getGlobalContext().document.getPreviousStatusIdList().includes(this.getStatusId())){t+=" bizproc-automation-trigger-item-wrapper-complete-light"}var r=this.getName();var l="bizproc-automation-trigger-item";if(this.getLogStatus()===s.TrackingStatus.COMPLETED){l+=" --complete"}else if(this.draft){l+=" --draft"}var o=n.Dom.create("DIV",{attrs:{"data-role":"trigger-container",className:l,"data-type":"item-trigger"},children:[n.Dom.create("div",{attrs:{className:t},children:[n.Dom.create("div",{attrs:{className:"bizproc-automation-trigger-item-wrapper-text"},text:r})]}),a,i]});if(!babelHelpers.classPrivateFieldGet(this,W).isEdit()){return o}if(this.canEdit()){this.registerItem(o)}var c=n.Dom.create("SPAN",{attrs:{"data-role":"btn-delete-trigger",className:"bizproc-automation-trigger-btn-delete"}});n.Event.bind(c,"click",this.onDeleteButtonClick.bind(this,c));o.appendChild(c);if(babelHelpers.classPrivateFieldGet(this,W).isEdit()){n.Event.bind(o,"click",this.onSettingsButtonClick.bind(this,o))}return o}},{key:"onSettingsButtonClick",value:function e(t){if(!this.canEdit()){s.HelpHint.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,W).isManage()){this.emit("Trigger:onSettingsOpen",{trigger:this})}}},{key:"onCopyButtonClick",value:function e(i,a){a.stopPropagation();if(!this.canEdit()){s.HelpHint.showNoPermissionsHint(i)}else if(!babelHelpers.classPrivateFieldGet(this,W).isManage()){var r=new t;var l=this.serialize();delete l["ID"];if(l["CODE"]==="WEBHOOK"){l["APPLY_RULES"]={}}r.init(l,babelHelpers.classPrivateFieldGet(this,W));this.emit("Trigger:copied",{trigger:r})}}},{key:"onSearch",value:function e(t){if(!babelHelpers.classPrivateFieldGet(this,Y)){return}var i=t.getData().queryString;var a=!i||this.getName().toLowerCase().indexOf(i)>=0;n.Dom[a?"removeClass":"addClass"](babelHelpers.classPrivateFieldGet(this,Y),"--search-mismatch")}},{key:"registerItem",value:function e(t){if(n.Type.isNil(t["__bxddid"])){t.onbxdragstart=BX.proxy(this.dragStart,this);t.onbxdrag=BX.proxy(this.dragMove,this);t.onbxdragstop=BX.proxy(this.dragStop,this);t.onbxdraghover=BX.proxy(this.dragOver,this);jsDD.registerObject(t);jsDD.registerDest(t,1)}}},{key:"unregisterItem",value:function e(t){t.onbxdragstart=undefined;t.onbxdrag=undefined;t.onbxdragstop=undefined;t.onbxdraghover=undefined;jsDD.unregisterObject(t);jsDD.unregisterDest(t)}},{key:"dragStart",value:function e(){babelHelpers.classPrivateFieldSet(this,Z,BX.proxy_context);if(!babelHelpers.classPrivateFieldGet(this,Z)){jsDD.stopCurrentDrag();return}if(!babelHelpers.classPrivateFieldGet(this,K)){var t=babelHelpers.classPrivateFieldGet(this,Z).offsetWidth;babelHelpers.classPrivateFieldSet(this,K,babelHelpers.classPrivateFieldGet(this,Z).cloneNode(true));babelHelpers.classPrivateFieldGet(this,K).style.position="absolute";babelHelpers.classPrivateFieldGet(this,K).classList.add("bizproc-automation-trigger-item-drag");babelHelpers.classPrivateFieldGet(this,K).style.width=t+"px";document.body.appendChild(babelHelpers.classPrivateFieldGet(this,K))}}},{key:"dragMove",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,K).style.left=t+"px";babelHelpers.classPrivateFieldGet(this,K).style.top=i+"px"}},{key:"dragOver",value:function e(t,i,a){if(babelHelpers.classPrivateFieldGet(this,X)){babelHelpers.classPrivateFieldGet(this,X).classList.remove("bizproc-automation-trigger-item-pre")}if(babelHelpers.classPrivateFieldGet(this,V)){babelHelpers.classPrivateFieldGet(this,V).classList.remove("bizproc-automation-trigger-list-pre")}var s=t.getAttribute("data-type");if(s==="item-trigger"){babelHelpers.classPrivateFieldSet(this,X,t);babelHelpers.classPrivateFieldSet(this,V,null)}if(s==="column-trigger"){babelHelpers.classPrivateFieldSet(this,V,t.querySelector('[data-role="trigger-list"]'));babelHelpers.classPrivateFieldSet(this,X,null)}if(babelHelpers.classPrivateFieldGet(this,X)){babelHelpers.classPrivateFieldGet(this,X).classList.add("bizproc-automation-trigger-item-pre")}if(babelHelpers.classPrivateFieldGet(this,V)){babelHelpers.classPrivateFieldGet(this,V).classList.add("bizproc-automation-trigger-list-pre")}}},{key:"dragStop",value:function e(i,a,s){s=s||window.event;var r=null;var l=s&&(s.ctrlKey||s.metaKey);var n=function e(i,a){var s=new t;var r=i.serialize();delete r["ID"];if(r["CODE"]==="WEBHOOK"){r["APPLY_RULES"]={}}r["DOCUMENT_STATUS"]=a;s.init(r,babelHelpers.classPrivateFieldGet(i,W));return s};if(babelHelpers.classPrivateFieldGet(this,Z)){if(babelHelpers.classPrivateFieldGet(this,X)){babelHelpers.classPrivateFieldGet(this,X).classList.remove("bizproc-automation-trigger-item-pre");var o=babelHelpers.classPrivateFieldGet(this,X).parentNode;if(!l){o.insertBefore(babelHelpers.classPrivateFieldGet(this,Z),babelHelpers.classPrivateFieldGet(this,X));this.moveTo(o.getAttribute("data-status-id"))}else{r=n(this,o.getAttribute("data-status-id"));o.insertBefore(babelHelpers.classPrivateFieldGet(r,Y),babelHelpers.classPrivateFieldGet(this,X))}}else if(babelHelpers.classPrivateFieldGet(this,V)){babelHelpers.classPrivateFieldGet(this,V).classList.remove("bizproc-automation-trigger-list-pre");if(!l){babelHelpers.classPrivateFieldGet(this,V).appendChild(babelHelpers.classPrivateFieldGet(this,Z));this.moveTo(babelHelpers.classPrivateFieldGet(this,V).getAttribute("data-status-id"))}else{r=n(this,babelHelpers.classPrivateFieldGet(this,V).getAttribute("data-status-id"));babelHelpers.classPrivateFieldGet(this,V).appendChild(babelHelpers.classPrivateFieldGet(r,Y))}}if(r){this.emit("Trigger:copied",{trigger:r,skipInsert:true})}}babelHelpers.classPrivateFieldGet(this,K).parentNode.removeChild(babelHelpers.classPrivateFieldGet(this,K));babelHelpers.classPrivateFieldSet(this,K,null);babelHelpers.classPrivateFieldSet(this,Z,null);babelHelpers.classPrivateFieldSet(this,X,null)}},{key:"onDeleteButtonClick",value:function e(t,i){i.stopPropagation();if(!this.canEdit()){s.HelpHint.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,W).isManage()){n.Dom.remove(t.parentNode);this.emit("Trigger:deleted",{trigger:this})}}},{key:"updateData",value:function e(t){if(n.Type.isPlainObject(t)){babelHelpers.classPrivateFieldSet(this,z,t)}else{throw"Invalid data"}}},{key:"markDeleted",value:function e(){babelHelpers.classPrivateFieldSet(this,U,true);return this}},{key:"serialize",value:function e(){var t=n.clone(babelHelpers.classPrivateFieldGet(this,z));if(babelHelpers.classPrivateFieldGet(this,U)){t["DELETED"]="Y"}if(!n.Type.isPlainObject(t.APPLY_RULES)){t.APPLY_RULES={}}if(!babelHelpers.classPrivateFieldGet(this,j).items.length){delete t.APPLY_RULES.Condition}else{t.APPLY_RULES.Condition=babelHelpers.classPrivateFieldGet(this,j).serialize()}return t}},{key:"moveTo",value:function e(t){babelHelpers.classPrivateFieldGet(this,z)["DOCUMENT_STATUS"]=t;this.emit("Trigger:modified",{trigger:this})}},{key:"getReturnProperties",value:function e(){var t=this;var i=s.getGlobalContext().availableTriggers.find((function(e){return e["CODE"]===t.getCode()}));return i&&n.Type.isArray(i.RETURN)?i.RETURN:[]}},{key:"node",get:function e(){return babelHelpers.classPrivateFieldGet(this,Y)}},{key:"deleted",get:function e(){return babelHelpers.classPrivateFieldGet(this,U)}},{key:"documentStatus",get:function e(){var t;return(t=babelHelpers.classPrivateFieldGet(this,z)["DOCUMENT_STATUS"])!==null&&t!==void 0?t:""}}]);return t}(a.EventEmitter);var J=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"bindAll",value:function t(i){i.querySelectorAll("[data-text]").forEach((function(t){return e.bindToNode(t)}))}},{key:"bindToNode",value:function e(t){n.Event.bind(t,"mouseover",this.showHint.bind(this,t));n.Event.bind(t,"mouseout",this.hideHint.bind(this))}},{key:"isBindedToNode",value:function e(t){var i,a;return!!((i=this.popupHint)!==null&&i!==void 0&&(a=i.bindElement)!==null&&a!==void 0&&a.isSameNode(t))}},{key:"showHint",value:function e(t){var i=t.getAttribute("data-text");if(!i){return}var a=n.Text.encode(i);a=BX.util.nl2br(a);if(!n.Type.isStringFilled(a)){return}this.hideHint();this.popupHint=new BX.PopupWindow("bizproc-automation-help-tip",t,{lightShadow:true,autoHide:false,darkMode:true,offsetLeft:0,offsetTop:2,bindOptions:{position:"top"},events:{onPopupClose:function e(){this.destroy()}},content:n.Dom.create("div",{attrs:{style:"padding-right: 5px; width: 250px;"},html:a})});this.popupHint.setAngle({offset:32,position:"bottom"});this.popupHint.show();return true}},{key:"showNoPermissionsHint",value:function e(t){this.showAngleHint(t,n.Loc.getMessage("BIZPROC_AUTOMATION_RIGHTS_ERROR"))}},{key:"showAngleHint",value:function e(t,i){if(this.timeout){clearTimeout(this.timeout)}this.popupHint=BX.UI.Hint.createInstance({popupParameters:{width:334,height:104,closeByEsc:true,autoHide:true,angle:{offset:n.Dom.getPosition(t).width/2},bindOptions:{position:"top"}}});this.popupHint.close=function(){this.hide()};this.popupHint.show(t,i);this.timeout=setTimeout(this.hideHint.bind(this),5e3)}},{key:"hideHint",value:function e(){if(this.popupHint){this.popupHint.close()}this.popupHint=null}}]);return e}();function $(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=Q(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var s=function e(){};return{s:s,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!r&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function Q(e,t){if(!e)return;if(typeof e==="string")return ee(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ee(e,t)}function ee(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++){a[i]=e[i]}return a}function te(e,t,i,a){re(e,t);se(i,"set");ie(e,i,a);return a}function ie(e,t,i){if(t.set){t.set.call(e,i)}else{if(!t.writable){throw new TypeError("attempted to set read only private field")}t.value=i}}function ae(e,t,i){re(e,t);se(i,"get");return le(e,i)}function se(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function re(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function le(e,t){if(t.get){return t.get.call(e)}return t.value}var ne=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"generateUniqueId",value:function t(){te(e,e,oe,+ae(e,e,oe)+1);return"bizproc-automation-cmp-"+ae(e,e,oe)}},{key:"toJsonString",value:function e(t){return JSON.stringify(t,(function(e,t){if(typeof t=="boolean"){return t?"1":"0"}return t}))}},{key:"getResponsibleUserExpression",value:function e(t){if(n.Type.isArray(t)){var i=$(t),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;if(s["Id"]==="ASSIGNED_BY_ID"||s["Id"]==="RESPONSIBLE_ID"){return"{{"+s["Name"]+"}}"}}}catch(e){i.e(e)}finally{i.f()}}return null}}]);return e}();var oe={writable:true,value:0};function ce(e,t,i,a){de(e,t);be(i,"set");ue(e,i,a);return a}function ue(e,t,i){if(t.set){t.set.call(e,i)}else{if(!t.writable){throw new TypeError("attempted to set read only private field")}t.value=i}}function pe(e,t,i){de(e,t);be(i,"get");return ve(e,i)}function be(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function de(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function ve(e,t){if(t.get){return t.get.call(e)}return t.value}var he=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"setRobotSettingsDialog",value:function e(t){this.robotSettingsDialog=t;this.robot=t?t.robot:null}},{key:"getRobotSettingsDialog",value:function e(){return this.robotSettingsDialog}},{key:"setTriggerSettingsDialog",value:function e(t){this.triggerSettingsDialog=t}},{key:"getTriggerSettingsDialog",value:function e(){return this.triggerSettingsDialog}}],[{key:"getInstance",value:function t(){if(!pe(e,e,fe)){ce(e,e,fe,new e)}return pe(e,e,fe)}}]);return e}();var fe={writable:true,value:void 0};function ge(e,t,i){me(e,t);t.set(e,i)}function me(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Te=new WeakMap;var Pe=new WeakMap;var ye=new WeakMap;var He=new WeakMap;var Ie=new WeakMap;var Oe=new WeakMap;var Ee=new WeakMap;var Fe=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));ge(babelHelpers.assertThisInitialized(i),Te,{writable:true,value:void 0});ge(babelHelpers.assertThisInitialized(i),Pe,{writable:true,value:void 0});ge(babelHelpers.assertThisInitialized(i),ye,{writable:true,value:void 0});ge(babelHelpers.assertThisInitialized(i),He,{writable:true,value:void 0});ge(babelHelpers.assertThisInitialized(i),Ie,{writable:true,value:void 0});ge(babelHelpers.assertThisInitialized(i),Oe,{writable:true,value:void 0});ge(babelHelpers.assertThisInitialized(i),Ee,{writable:true,value:void 0});i.setEventNamespace("BX.Bizproc.Automation");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Te,e);return i}babelHelpers.createClass(t,[{key:"init",value:function e(t,i){if(!n.Type.isPlainObject(t)){t={}}babelHelpers.classPrivateFieldSet(this,Pe,i.isNone()?G.edit():i);babelHelpers.classPrivateFieldSet(this,He,n.Type.isArray(t.TRIGGERS)?t.TRIGGERS:[]);babelHelpers.classPrivateFieldSet(this,Ie,document.querySelectorAll('[data-type="column-trigger"]'));babelHelpers.classPrivateFieldSet(this,Oe,babelHelpers.classPrivateFieldGet(this,Te).querySelectorAll('[data-role="trigger-list"]'));babelHelpers.classPrivateFieldSet(this,Ee,false);this.initTriggers();this.markModified(false);babelHelpers.classPrivateFieldGet(this,Ie).forEach((function(e){return jsDD.registerDest(e,10)}));top.BX.addCustomEvent(top,"Rest:AppLayout:ApplicationInstall",this.onRestAppInstall.bind(this))}},{key:"reInit",value:function e(t,i){if(!n.Type.isPlainObject(t)){t={}}babelHelpers.classPrivateFieldSet(this,Pe,i||G.none());babelHelpers.classPrivateFieldGet(this,Oe).forEach((function(e){return n.Dom.clean(e)}));babelHelpers.classPrivateFieldSet(this,He,n.Type.isArray(t.TRIGGERS)?t.TRIGGERS:[]);this.initTriggers();this.markModified(false)}},{key:"initTriggers",value:function e(){var t=this;babelHelpers.classPrivateFieldSet(this,ye,[]);babelHelpers.classPrivateFieldGet(this,He).forEach((function(e){var i=new q;i.init(e,babelHelpers.classPrivateFieldGet(t,Pe));t.subscribeTriggerEvents(i);t.insertTriggerNode(i.getStatusId(),i.node);babelHelpers.classPrivateFieldGet(t,ye).push(i)}))}},{key:"subscribeTriggerEvents",value:function e(t){var i=this;t.subscribe("Trigger:copied",(function(e){var t=e.data.trigger;babelHelpers.classPrivateFieldGet(i,ye).push(t);if(!e.data.skipInsert){i.insertTriggerNode(t.getStatusId(),t.node)}i.subscribeTriggerEvents(t);i.markModified()}));t.subscribe("Trigger:modified",(function(){return i.markModified()}));t.subscribe("Trigger:onSettingsOpen",(function(e){i.openTriggerSettingsDialog(e.data.trigger)}));t.subscribe("Trigger:deleted",(function(e){return i.deleteTrigger(e.data.trigger)}))}},{key:"onSearch",value:function e(t){babelHelpers.classPrivateFieldGet(this,ye).forEach((function(e){return e.onSearch(t)}))}},{key:"enableManageMode",value:function e(){babelHelpers.classPrivateFieldSet(this,Pe,G.manage());var t=document.querySelectorAll('[data-role="btn-delete-trigger"]');t.forEach((function(e){return n.Dom.hide(e)}));babelHelpers.classPrivateFieldGet(this,ye).forEach((function(e){return n.Dom.addClass(e.node,"--locked-node")}))}},{key:"disableManageMode",value:function e(){babelHelpers.classPrivateFieldSet(this,Pe,G.edit());var t=document.querySelectorAll('[data-role="btn-delete-trigger"]');t.forEach((function(e){return n.Dom.show(e)}));babelHelpers.classPrivateFieldGet(this,ye).forEach((function(e){return n.Dom.removeClass(e.node,"--locked-node")}))}},{key:"addTrigger",value:function e(t,i){var a=new q;a.draft=true;a.init(t,babelHelpers.classPrivateFieldGet(this,Pe));this.subscribeTriggerEvents(a);if(i){i.call(this,a)}}},{key:"deleteTrigger",value:function e(t,i){if(t.getId()>0){t.markDeleted()}else{for(var a=0;a<babelHelpers.classPrivateFieldGet(this,ye).length;++a){if(babelHelpers.classPrivateFieldGet(this,ye)[a]===t){babelHelpers.classPrivateFieldGet(this,ye).splice(a,1)}}}if(i){i(t)}this.markModified()}},{key:"enableDragAndDrop",value:function e(){babelHelpers.classPrivateFieldGet(this,ye).forEach((function(e){return e.registerItem(e.node)}));babelHelpers.classPrivateFieldGet(this,Te).querySelectorAll(".bizproc-automation-trigger-item-wrapper").forEach((function(e){n.Dom.addClass(e,"bizproc-automation-trigger-item-wrapper-draggable")}))}},{key:"disableDragAndDrop",value:function e(){babelHelpers.classPrivateFieldGet(this,ye).forEach((function(e){return e.unregisterItem(e.node)}));babelHelpers.classPrivateFieldGet(this,Te).querySelectorAll(".bizproc-automation-trigger-item-wrapper").forEach((function(e){n.Dom.removeClass(e,"bizproc-automation-trigger-item-wrapper-draggable")}))}},{key:"insertTrigger",value:function e(t){babelHelpers.classPrivateFieldGet(this,ye).push(t);this.markModified(true)}},{key:"insertTriggerNode",value:function e(t,i){var a=babelHelpers.classPrivateFieldGet(this,Te).querySelector('[data-role="trigger-list"][data-status-id="'+t+'"]');if(a){a.appendChild(i)}}},{key:"serialize",value:function e(){return babelHelpers.classPrivateFieldGet(this,ye).map((function(e){return e.serialize()}))}},{key:"countAllTriggers",value:function e(){return babelHelpers.classPrivateFieldGet(this,ye).filter((function(e){return!e.deleted})).length}},{key:"getTriggerName",value:function e(t){var i,a;return(i=(a=s.getGlobalContext().availableTriggers.find((function(e){return t===e["CODE"]})))===null||a===void 0?void 0:a.NAME)!==null&&i!==void 0?i:t}},{key:"getAvailableTrigger",value:function e(t){var i=s.getGlobalContext().availableTriggers;for(var a=0;a<i.length;++a){if(t===i[a]["CODE"]){return i[a]}}return null}},{key:"canEdit",value:function e(){return s.getGlobalContext().canEdit}},{key:"canSetExecuteBy",value:function e(){var t;return(t=s.getGlobalContext().get("TRIGGER_CAN_SET_EXECUTE_BY"))!==null&&t!==void 0?t:false}},{key:"needSave",value:function e(){return babelHelpers.classPrivateFieldGet(this,Ee)}},{key:"markModified",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ee,t!==false);if(babelHelpers.classPrivateFieldGet(this,Ee)){this.emit("TriggerManager:dataModified")}}},{key:"openTriggerSettingsDialog",value:function e(t,i){var a=this;if(he.getInstance().getTriggerSettingsDialog()){if(i&&i.changeTrigger){he.getInstance().getTriggerSettingsDialog().popup.close()}else{return}}var r="bizproc_automation_trigger_dialog";var l=n.Dom.create("form",{props:{name:r},style:{"min-width":"540px"}});l.appendChild(this.renderConditionSettings(t));var o=n.Dom.create("div",{attrs:{className:"bizproc-automation-robot-help"},events:{click:function e(t){return a.emit("TriggerManager:onHelpClick",t)}}});l.appendChild(o);var c=this.getTriggerName(t.getCode());l.appendChild(n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TRIGGER_NAME")+":"}));l.appendChild(n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[n.Dom.create("input",{attrs:{className:"bizproc-automation-popup-input",type:"text",name:"name",value:t.getName()||c}})]}));var u=this.getAvailableTrigger(t.getCode());if(t.getCode()==="WEBHOOK"){if(!t.getApplyRules()["code"]){t.getApplyRules()["code"]=n.Text.getRandom(5)}l.appendChild(n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete"},text:"URL:"}));l.appendChild(n.Dom.create("input",{props:{type:"hidden",value:t.getApplyRules()["code"],name:"code"}}));var p=n.Dom.create("textarea",{attrs:{className:"bizproc-automation-popup-textarea",placeholder:"...",readonly:"readonly",name:"webhook_handler"},events:{click:function e(t){this.select()}}});l.appendChild(n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[p]}));l.appendChild(n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_WEBHOOK_ID")}));if(u&&u["HANDLER"]){var b=window.location.protocol+"//"+window.location.host+u["HANDLER"];b=n.Uri.addParam(b,{code:t.getApplyRules()["code"]});b=b.replace("{{DOCUMENT_TYPE}}",s.getGlobalContext().document.getRawType()[2]);p.value=b}}else if(t.getCode()==="EMAIL_LINK"){l.appendChild(n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_TRIGGER_EMAIL_LINK_URL")+":"}));l.appendChild(n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[n.Dom.create("textarea",{attrs:{className:"bizproc-automation-popup-textarea",placeholder:"https://example.com"},props:{name:"url"},text:t.getApplyRules()["url"]||""})]}))}else if(t.getCode()==="WEBFORM"){if(u&&u["WEBFORM_LIST"]){var d=n.Dom.create("select",{attrs:{className:"bizproc-automation-popup-settings-dropdown"},props:{name:"form_id",value:""},children:[n.Dom.create("option",{props:{value:""},text:n.Loc.getMessage("BIZPROC_AUTOMATION_TRIGGER_WEBFORM_ANY")})]});for(var v=0;v<u["WEBFORM_LIST"].length;++v){var h=u["WEBFORM_LIST"][v];d.appendChild(n.Dom.create("option",{props:{value:h["ID"]},text:h["NAME"]}))}if(n.Type.isPlainObject(t.getApplyRules())&&t.getApplyRules()["form_id"]){d.value=t.getApplyRules()["form_id"]}var f=n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_TRIGGER_WEBFORM_LABEL")+":"}),d]});l.appendChild(f)}}else if(t.getCode()==="CALLBACK"){if(u&&u["WEBFORM_LIST"]){var g=n.Dom.create("select",{attrs:{className:"bizproc-automation-popup-settings-dropdown"},props:{name:"form_id",value:""},children:[n.Dom.create("option",{props:{value:""},text:n.Loc.getMessage("BIZPROC_AUTOMATION_TRIGGER_WEBFORM_ANY")})]});for(var m=0;m<u["WEBFORM_LIST"].length;++m){var T=u["WEBFORM_LIST"][m];g.appendChild(n.Dom.create("option",{props:{value:T["ID"]},text:T["NAME"]}))}if(n.Type.isPlainObject(t.getApplyRules())&&t.getApplyRules()["form_id"]){g.value=t.getApplyRules()["form_id"]}var P=n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_TRIGGER_WEBFORM_LABEL")+":"}),g]});l.appendChild(P)}}else if(t.getCode()==="STATUS"){if(u&&u["STATUS_LIST"]){var y=n.Dom.create("select",{attrs:{className:"bizproc-automation-popup-settings-dropdown"},props:{name:"STATUS",value:""},children:[n.Dom.create("option",{props:{value:""},text:n.Loc.getMessage("BIZPROC_AUTOMATION_TRIGGER_STATUS_ANY")})]});for(var H=0;H<u["STATUS_LIST"].length;++H){var I=u["STATUS_LIST"][H];y.appendChild(n.Dom.create("option",{props:{value:I["ID"]},text:I["NAME"]}))}if(n.Type.isPlainObject(t.getApplyRules())&&t.getApplyRules()["STATUS"]){y.value=t.getApplyRules()["STATUS"]}var O=n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:u["STATUS_LABEL"]+":"}),y]});l.appendChild(O)}}else if(t.getCode()=="CALL"){if(u&&u["LINES"]){var E=n.Dom.create("select",{attrs:{className:"bizproc-automation-popup-settings-dropdown"},props:{name:"LINE_NUMBER",value:""},children:[n.Dom.create("option",{props:{value:""},text:n.Loc.getMessage("BIZPROC_AUTOMATION_TRIGGER_WEBFORM_ANY")})]});for(var F=0;F<u["LINES"].length;++F){var C=u["LINES"][F];E.appendChild(n.Dom.create("option",{props:{value:C["LINE_NUMBER"]},text:C["SHORT_NAME"]}))}if(t.getApplyRules()["LINE_NUMBER"]){E.value=t.getApplyRules()["LINE_NUMBER"]}var _=n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_TRIGGER_CALL_LABEL")+":"}),E]});l.appendChild(_)}}else if(t.getCode()=="OPENLINE"||t.getCode()=="OPENLINE_MSG"){if(u&&u["CONFIG_LIST"]){var S=n.Dom.create("select",{attrs:{className:"bizproc-automation-popup-settings-dropdown"},props:{name:"config_id",value:""},children:[n.Dom.create("option",{props:{value:""},text:n.Loc.getMessage("BIZPROC_AUTOMATION_TRIGGER_WEBFORM_ANY")})]});for(var A=0;A<u["CONFIG_LIST"].length;++A){var k=u["CONFIG_LIST"][A];S.appendChild(n.Dom.create("option",{props:{value:k["ID"]},text:k["NAME"]}))}if(n.Type.isPlainObject(t.getApplyRules())&&t.getApplyRules()["config_id"]){S.value=t.getApplyRules()["config_id"]}var N=n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_TRIGGER_OPENLINE_LABEL")+":"}),S]});l.appendChild(N)}}BX.onCustomEvent("BX.Bizproc.Automation.TriggerManager:onOpenSettingsDialog-"+t.getCode(),[t,l]);if(this.canSetExecuteBy()){this.renderExecuteByControl(t,l)}this.renderAllowBackwardsControl(t,l);n.Dom.addClass(babelHelpers.classPrivateFieldGet(this,Te),"automation-base-blocked");he.getInstance().setTriggerSettingsDialog({triggerManager:this,trigger:t,form:l});var w=this;var G=new BX.PopupWindow(ne.generateUniqueId(),null,{titleBar:c,content:l,closeIcon:true,offsetLeft:0,offsetTop:0,closeByEsc:true,draggable:{restrict:false},overlay:false,events:{onPopupClose:function e(t){he.getInstance().setTriggerSettingsDialog(null);w.destroySettingsDialogControls();t.destroy();n.Dom.removeClass(babelHelpers.classPrivateFieldGet(w,Te),"automation-base-blocked")}},buttons:[new BX.PopupWindowButton({text:n.Loc.getMessage("JS_CORE_WINDOW_SAVE"),className:"popup-window-button-accept",events:{click:function e(){var i=BX.ajax.prepareForm(l);t.setName(i["data"]["name"]);if(t.getCode()==="WEBFORM"){t.setApplyRules({form_id:i["data"]["form_id"]})}if(t.getCode()==="CALLBACK"){t.setApplyRules({form_id:i["data"]["form_id"]})}if(t.getCode()==="STATUS"){t.setApplyRules({STATUS:i["data"]["STATUS"]})}if(t.getCode()==="CALL"&&"LINE_NUMBER"in i["data"]){t.setApplyRules({LINE_NUMBER:i["data"]["LINE_NUMBER"]})}if(t.getCode()==="OPENLINE"||t.getCode()==="OPENLINE_MSG"){t.setApplyRules({config_id:i["data"]["config_id"]})}if(t.getCode()==="WEBHOOK"){t.setApplyRules({code:i["data"]["code"]})}if(t.getCode()==="EMAIL_LINK"){t.setApplyRules({url:i["data"]["url"]})}BX.onCustomEvent("BX.Bizproc.Automation.TriggerManager:onSaveSettings-"+t.getCode(),[t,i]);w.setConditionSettingsFromForm(i["data"],t);t.setAllowBackwards(i["data"]["allow_backwards"]==="Y");if(w.canSetExecuteBy()){t.setExecuteBy(i["data"]["execute_by"])}if(t.draft);n.ajax.runAction("bizproc.analytics.push",{analyticsLabel:"automation_trigger".concat(t.draft?"_draft":"","_save_").concat(t.getCode().toLowerCase())});delete t.draft;t.reInit();w.markModified();this.popupWindow.close()}}}),new BX.PopupWindowButtonLink({text:n.Loc.getMessage("JS_CORE_WINDOW_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function e(){this.popupWindow.close()}}})]});he.getInstance().getTriggerSettingsDialog().popup=G;G.show();n.ajax.runAction("bizproc.analytics.push",{analyticsLabel:"automation_trigger".concat(t.draft?"_draft":"","_settings_").concat(t.getCode().toLowerCase())})}},{key:"renderConditionSettings",value:function e(t){var i=t.getCondition().clone();this.conditionSelector=new s.ConditionGroupSelector(i,{fields:s.getGlobalContext().document.getFields()});var a=this.conditionSelector;return n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-block"},children:[n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION")+":"}),a.createNode()]})]})}},{key:"renderExecuteByControl",value:function e(t,i){i.appendChild(n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-top bizproc-automation-popup-settings-title-autocomplete"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TRIGGER_EXECUTE_BY")+":"}));i.appendChild(n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[BX.Bizproc.FieldType.renderControl(s.getGlobalContext().document.getRawType(),{Type:"user"},"execute_by",t.draft?ne.getResponsibleUserExpression(s.getGlobalContext().document.getFields()):t.getExecuteBy())]}))}},{key:"renderAllowBackwardsControl",value:function e(t,i){i.appendChild(n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-checkbox"},children:[n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-checkbox-item"},children:[n.Dom.create("label",{attrs:{className:"bizproc-automation-popup-chk-label"},children:[n.Dom.create("input",{attrs:{className:"bizproc-automation-popup-chk",type:"checkbox",name:"allow_backwards",value:"Y"},props:{checked:t.isBackwardsAllowed()}}),document.createTextNode(n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TRIGGER_ALLOW_REVERSE"))]})]})]}))}},{key:"setConditionSettingsFromForm",value:function e(t,i){i.setCondition(s.ConditionGroup.createFromForm(t));return this}},{key:"onRestAppInstall",value:function e(t,i){i.redirect=false;setTimeout((function(){BX.ajax({method:"POST",dataType:"json",url:s.getGlobalContext().ajaxUrl,data:{ajax_action:"get_available_triggers",document_signed:s.getGlobalContext().signedDocument},onsuccess:function e(t){if(n.Type.isArray(t["DATA"])){s.getGlobalContext().set("availableTriggers",t["DATA"])}}})}),1500)}},{key:"initSettingsDialogControls",value:function e(t){if(!n.Type.isArray(this.settingsDialogControls)){this.settingsDialogControls=[]}var i=t.querySelectorAll("[data-role]");for(var a=0;a<i.length;++a){var s=null;var r=i[a].getAttribute("data-role");if(r==="user-selector"){s=BX.Bizproc.UserSelector.decorateNode(i[a])}BX.UI.Hint.init(i[a]);if(s){this.settingsDialogControls.push(s)}}}},{key:"destroySettingsDialogControls",value:function e(){if(this.conditionSelector){this.conditionSelector.destroy();this.conditionSelector=null}if(n.Type.isArray(this.settingsDialogControls)){for(var t=0;t<this.settingsDialogControls.length;++t){if(n.Type.isFunction(this.settingsDialogControls[t].destroy)){this.settingsDialogControls[t].destroy()}}}this.settingsDialogControls=null}},{key:"getListByDocumentStatus",value:function e(t){var i=[];babelHelpers.classPrivateFieldGet(this,ye).forEach((function(e){if(e.getStatusId()===t){i.push(e)}}));return i}},{key:"getReturnProperties",value:function e(t){var i=[];var a={};var s=this.getListByDocumentStatus(t);s.forEach((function(e){var t=e.deleted?[]:e.getReturnProperties();if(t.length){t.forEach((function(t){if(!a[t.Id]){i.push({Id:t.Id,ObjectId:"Template",Name:t.Name,ObjectName:e.getName(),Type:t.Type,Expression:"{{~*:"+t.Id+"}}",SystemExpression:"{=Template:"+t.Id+"}"});a[t.Id]=true}}))}}));return i}},{key:"getReturnProperty",value:function e(t,i){var a=this.getReturnProperties(t);for(var s=0;s<a.length;++s){if(a[s].Id===i){return a[s]}}return null}}]);return t}(a.EventEmitter);function Ce(e,t,i){_e(e,t);t.set(e,i)}function _e(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Se=new WeakMap;var Ae=new WeakMap;var ke=new WeakMap;var Ne=new WeakMap;var we=new WeakMap;var Ge=new WeakMap;var Me=new WeakMap;var De=function(){function e(t){babelHelpers.classCallCheck(this,e);Ce(this,Se,{writable:true,value:void 0});Ce(this,Ae,{writable:true,value:void 0});Ce(this,ke,{writable:true,value:void 0});Ce(this,Ne,{writable:true,value:void 0});Ce(this,we,{writable:true,value:void 0});Ce(this,Ge,{writable:true,value:void 0});Ce(this,Me,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Se,t.rawDocumentType);babelHelpers.classPrivateFieldSet(this,Ae,t.documentId);babelHelpers.classPrivateFieldSet(this,ke,t.title);babelHelpers.classPrivateFieldSet(this,Ne,t.categoryId);babelHelpers.classPrivateFieldSet(this,we,[]);babelHelpers.classPrivateFieldSet(this,Ge,0);if(n.Type.isArray(t.statusList)){babelHelpers.classPrivateFieldSet(this,we,t.statusList);babelHelpers.classPrivateFieldSet(this,Ge,babelHelpers.classPrivateFieldGet(this,we).findIndex((function(e){return e.STATUS_ID===t.statusId})))}else if(n.Type.isStringFilled(t.statusId)){babelHelpers.classPrivateFieldGet(this,we).push(t.statusId)}if(babelHelpers.classPrivateFieldGet(this,Ge)<0){babelHelpers.classPrivateFieldSet(this,Ge,0)}babelHelpers.classPrivateFieldSet(this,Me,n.Type.isArray(t.documentFields)?t.documentFields:[])}babelHelpers.createClass(e,[{key:"clone",value:function t(){return new e({rawDocumentType:n.Runtime.clone(babelHelpers.classPrivateFieldGet(this,Se)),documentId:babelHelpers.classPrivateFieldGet(this,Ae),categoryId:babelHelpers.classPrivateFieldGet(this,Ne),statusId:this.getCurrentStatusId(),statusList:n.Runtime.clone(babelHelpers.classPrivateFieldGet(this,we)),documentFields:n.Runtime.clone(babelHelpers.classPrivateFieldGet(this,Me)),title:babelHelpers.classPrivateFieldGet(this,ke)})}},{key:"getRawType",value:function e(){return babelHelpers.classPrivateFieldGet(this,Se)}},{key:"getCategoryId",value:function e(){return babelHelpers.classPrivateFieldGet(this,Ne)}},{key:"getCurrentStatusId",value:function e(){var t;return(t=babelHelpers.classPrivateFieldGet(this,we)[babelHelpers.classPrivateFieldGet(this,Ge)])===null||t===void 0?void 0:t.STATUS_ID}},{key:"getSortedStatusId",value:function e(t){if(t>=0&&t<babelHelpers.classPrivateFieldGet(this,we).length){return babelHelpers.classPrivateFieldGet(this,we)[t].STATUS_ID}return null}},{key:"getNextStatusIdList",value:function e(){return babelHelpers.classPrivateFieldGet(this,we).slice(babelHelpers.classPrivateFieldGet(this,Ge)+1).map((function(e){return e.STATUS_ID}))}},{key:"getPreviousStatusIdList",value:function e(){return babelHelpers.classPrivateFieldGet(this,we).slice(0,babelHelpers.classPrivateFieldGet(this,Ge)).map((function(e){return e.STATUS_ID}))}},{key:"setStatus",value:function e(t){var i=babelHelpers.classPrivateFieldGet(this,we).findIndex((function(e){return e.STATUS_ID===t}));if(i>=0){babelHelpers.classPrivateFieldSet(this,Ge,i)}return this}},{key:"getFields",value:function e(){return babelHelpers.classPrivateFieldGet(this,Me)}},{key:"setFields",value:function e(t){babelHelpers.classPrivateFieldSet(this,Me,t);return this}},{key:"setStatusList",value:function e(t){if(n.Type.isArrayFilled(t)){babelHelpers.classPrivateFieldSet(this,we,t)}return this}},{key:"title",get:function e(){return babelHelpers.classPrivateFieldGet(this,ke)}},{key:"statusList",get:function e(){return babelHelpers.classPrivateFieldGet(this,we)}}]);return e}();function Re(e,t,i){Le(e,t);t.set(e,i)}function Le(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Be=new WeakMap;var xe=new WeakMap;var ze=new WeakMap;var Ue=new WeakMap;var We=new WeakMap;var je=new WeakMap;var Ye=function(){function e(t){babelHelpers.classCallCheck(this,e);Re(this,Be,{writable:true,value:void 0});Re(this,xe,{writable:true,value:void 0});Re(this,ze,{writable:true,value:void 0});Re(this,Ue,{writable:true,value:void 0});Re(this,We,{writable:true,value:void 0});Re(this,je,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Be,e.BASIS_TYPE.CurrentDateTime);babelHelpers.classPrivateFieldSet(this,xe,e.DELAY_TYPE.After);babelHelpers.classPrivateFieldSet(this,ze,0);babelHelpers.classPrivateFieldSet(this,Ue,"i");babelHelpers.classPrivateFieldSet(this,We,false);babelHelpers.classPrivateFieldSet(this,je,false);if(n.Type.isPlainObject(t)){if(t["type"]){this.setType(t["type"])}if(t["value"]){this.setValue(t["value"])}if(t["valueType"]){this.setValueType(t["valueType"])}if(t["basis"]){this.setBasis(t["basis"])}if(t["workTime"]){this.setWorkTime(t["workTime"])}if(t["localTime"]){this.setLocalTime(t["localTime"])}}}babelHelpers.createClass(e,[{key:"clone",value:function t(){return new e({type:babelHelpers.classPrivateFieldGet(this,xe),value:babelHelpers.classPrivateFieldGet(this,ze),valueType:babelHelpers.classPrivateFieldGet(this,Ue),basis:babelHelpers.classPrivateFieldGet(this,Be),workTime:babelHelpers.classPrivateFieldGet(this,We),localTime:babelHelpers.classPrivateFieldGet(this,je)})}},{key:"setType",value:function t(i){if(i!==e.DELAY_TYPE.After&&i!==e.DELAY_TYPE.Before&&i!==e.DELAY_TYPE.In){i=e.DELAY_TYPE.After}babelHelpers.classPrivateFieldSet(this,xe,i);return this}},{key:"setValue",value:function e(t){t=parseInt(t);babelHelpers.classPrivateFieldSet(this,ze,t>=0?t:0);return this}},{key:"setValueType",value:function e(t){if(t!=="i"&&t!=="h"&&t!=="d"){t="i"}babelHelpers.classPrivateFieldSet(this,Ue,t);return this}},{key:"setBasis",value:function e(t){if(n.Type.isString(t)&&t!==""){babelHelpers.classPrivateFieldSet(this,Be,t)}return this}},{key:"setWorkTime",value:function e(t){babelHelpers.classPrivateFieldSet(this,We,!!t);return this}},{key:"setLocalTime",value:function e(t){babelHelpers.classPrivateFieldSet(this,je,!!t);return this}},{key:"isNow",value:function t(){return babelHelpers.classPrivateFieldGet(this,xe)===e.DELAY_TYPE.After&&babelHelpers.classPrivateFieldGet(this,Be)===e.BASIS_TYPE.CurrentDateTime&&!babelHelpers.classPrivateFieldGet(this,ze)}},{key:"setNow",value:function t(){this.setType(e.DELAY_TYPE.After);this.setValue(0);this.setValueType("i");this.setBasis(e.BASIS_TYPE.CurrentDateTime)}},{key:"serialize",value:function e(){return{type:babelHelpers.classPrivateFieldGet(this,xe),value:babelHelpers.classPrivateFieldGet(this,ze),valueType:babelHelpers.classPrivateFieldGet(this,Ue),basis:babelHelpers.classPrivateFieldGet(this,Be),workTime:babelHelpers.classPrivateFieldGet(this,We)?1:0}}},{key:"toExpression",value:function t(i,a){var s=babelHelpers.classPrivateFieldGet(this,Be)?babelHelpers.classPrivateFieldGet(this,Be):e.BASIS_TYPE.CurrentDate;if(!e.isSystemBasis(s)&&n.Type.isArray(i)){for(var r=0,l=i.length;r<l;++r){if(s===i[r].SystemExpression){s=i[r].Expression;break}}}if(!babelHelpers.classPrivateFieldGet(this,We)&&(babelHelpers.classPrivateFieldGet(this,xe)===e.DELAY_TYPE.In||this.isNow())){return s}var o=0;var c=0;var u=0;switch(babelHelpers.classPrivateFieldGet(this,Ue)){case"i":u=babelHelpers.classPrivateFieldGet(this,ze);break;case"h":c=babelHelpers.classPrivateFieldGet(this,ze);break;case"d":o=babelHelpers.classPrivateFieldGet(this,ze);break}var p="";if(babelHelpers.classPrivateFieldGet(this,xe)===e.DELAY_TYPE.Before){p="-"}if(o>0){p+=o+"d"}if(c>0){p+=c+"h"}if(u>0){p+=u+"i"}var b=babelHelpers.classPrivateFieldGet(this,We)?"workdateadd":"dateadd";if(b==="workdateadd"&&p===""){p="0d"}var d="";if(b==="workdateadd"&&a){d=a}return"="+b+"("+s+',"'+p+'"'+(d?","+d:"")+")"}},{key:"format",value:function t(i,a){var s=i;if(babelHelpers.classPrivateFieldGet(this,xe)===e.DELAY_TYPE.In){s=n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_IN_TIME");if(n.Type.isArray(a)){for(var r=0;r<a.length;++r){if(babelHelpers.classPrivateFieldGet(this,Be)===a[r].SystemExpression){s+=" "+a[r].Name;break}}}}else if(babelHelpers.classPrivateFieldGet(this,ze)){var l=babelHelpers.classPrivateFieldGet(this,xe)===e.DELAY_TYPE.After?n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_THROUGH"):n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_FOR_TIME_1");s=l+" "+this.getFormattedPeriodLabel(babelHelpers.classPrivateFieldGet(this,ze),babelHelpers.classPrivateFieldGet(this,Ue));if(n.Type.isArray(a)){var o=babelHelpers.classPrivateFieldGet(this,xe)===e.DELAY_TYPE.After?n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AFTER"):n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BEFORE_1");for(var c=0;c<a.length;++c){if(babelHelpers.classPrivateFieldGet(this,Be)===a[c].SystemExpression){s+=" "+o+" "+a[c].Name;break}}}}if(babelHelpers.classPrivateFieldGet(this,We)){s+=", "+n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_IN_WORKTIME")}return s}},{key:"getFormattedPeriodLabel",value:function t(i,a){var s=i+" ";var r=0;if(i>20){i=i%10}if(i===1){r=0}else if(i>1&&i<5){r=1}else{r=2}var l=e.getPeriodLabels(a);return s+(l?l[r]:"")}},{key:"basis",get:function e(){return babelHelpers.classPrivateFieldGet(this,Be)}},{key:"type",get:function e(){return babelHelpers.classPrivateFieldGet(this,xe)}},{key:"value",get:function e(){return babelHelpers.classPrivateFieldGet(this,ze)}},{key:"valueType",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ue)}},{key:"workTime",get:function e(){return babelHelpers.classPrivateFieldGet(this,We)}},{key:"localTime",get:function e(){return babelHelpers.classPrivateFieldGet(this,je)}}],[{key:"isSystemBasis",value:function e(t){return t===this.BASIS_TYPE.CurrentDate||t===this.BASIS_TYPE.CurrentDateTime||t===this.BASIS_TYPE.CurrentDateTimeLocal}},{key:"fromString",value:function t(i,a){i=i.toString();var s={basis:e.BASIS_TYPE.CurrentDateTime,i:0,h:0,d:0,workTime:false,localTime:false};if(i.indexOf("=dateadd(")===0||i.indexOf("=workdateadd(")===0){if(i.indexOf("=workdateadd(")===0){i=i.substring(13);s["workTime"]=true}else{i=i.substring(9)}var r=i.split(",");s["basis"]=r[0].trim();r[1]=r[1].replace(/['")]+/g,"");s["type"]=r[1].indexOf("-")===0?e.DELAY_TYPE.Before:e.DELAY_TYPE.After;var l;var n=/s*([\d]+)\s*(i|h|d)\s*/gi;while(l=n.exec(r[1])){s[l[2]]=parseInt(l[1])}}else{s["basis"]=i}if(!e.isSystemBasis(s["basis"])&&BX.type.isArray(a)){var o=false;for(var c=0,u=a.length;c<u;++c){if(s["basis"]===a[c].SystemExpression||s["basis"]===a[c].Expression){s["basis"]=a[c].SystemExpression;o=true;break}}if(!o){s["basis"]=e.BASIS_TYPE.CurrentDateTime}}var p=s["i"]+s["h"]*60+s["d"]*60*24;if(p%1440===0){s["value"]=p/1440;s["valueType"]="d"}else if(p%60===0){s["value"]=p/60;s["valueType"]="h"}else{s["value"]=p;s["valueType"]="i"}if(!s["value"]&&s["basis"]!==e.BASIS_TYPE.CurrentDateTime&&s["basis"]){s["type"]=e.DELAY_TYPE.In}return new e(s)}},{key:"fromMinutes",value:function e(t){var i;var a;if(t%1440===0){i=t/1440;a="d"}else if(t%60===0){i=t/60;a="h"}else{i=t;a="i"}return[i,a]}},{key:"toMinutes",value:function e(t,i){var a=0;switch(i){case"i":a=t;break;case"h":a=t*60;break;case"d":a=t*60*24;break}return a}},{key:"getPeriodLabels",value:function e(t){var i=[];if(t==="i"){i=[n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MIN1"),n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MIN2"),n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MIN3")]}else if(t==="h"){i=[n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_HOUR1"),n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_HOUR2"),n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_HOUR3")]}else if(t==="d"){i=[n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DAY1"),n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DAY2"),n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DAY3")]}return i}}]);return e}();babelHelpers.defineProperty(Ye,"BASIS_TYPE",{CurrentDate:"{=System:Date}",CurrentDateTime:"{=System:Now}",CurrentDateTimeLocal:"{=System:NowLocal}"});babelHelpers.defineProperty(Ye,"DELAY_TYPE",{After:"after",Before:"before",In:"in"});var Ze=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(Ze,"CREATED",0);babelHelpers.defineProperty(Ze,"RUNNING",1);babelHelpers.defineProperty(Ze,"COMPLETED",2);babelHelpers.defineProperty(Ze,"SUSPENDED",3);babelHelpers.defineProperty(Ze,"TERMINATED",4);function Xe(e,t,i){Ve(e,t);t.set(e,i)}function Ve(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Ke=new WeakMap;var qe=new WeakMap;var Je=function(){function e(){babelHelpers.classCallCheck(this,e);Xe(this,Ke,{writable:true,value:void 0});Xe(this,qe,{writable:true,value:void 0})}babelHelpers.createClass(e,[{key:"isTriggerEntry",value:function t(){return this.type===e.TRIGGER_ACTIVITY_TYPE}},{key:"type",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ke)},set:function t(i){if(e.getAllActivityTypes().includes(i)){babelHelpers.classPrivateFieldSet(this,Ke,i)}}},{key:"workflowStatus",get:function e(){return babelHelpers.classPrivateFieldGet(this,qe)},set:function t(i){if(e.getAllWorkflowStatuses().includes(i)){babelHelpers.classPrivateFieldSet(this,qe,i)}}}],[{key:"getAllActivityTypes",value:function t(){return[e.UNKNOWN_ACTIVITY_TYPE,e.EXECUTE_ACTIVITY_TYPE,e.CLOSE_ACTIVITY_TYPE,e.CANCEL_ACTIVITY_TYPE,e.FAULT_ACTIVITY_TYPE,e.CUSTOM_ACTIVITY_TYPE,e.REPORT_ACTIVITY_TYPE,e.ATTACHED_ENTITY_TYPE,e.TRIGGER_ACTIVITY_TYPE,e.ERROR_ACTIVITY_TYPE,e.DEBUG_ACTIVITY_TYPE,e.DEBUG_AUTOMATION_TYPE,e.DEBUG_DESIGNER_TYPE,e.DEBUG_LINK_TYPE]}},{key:"isKnownActivityType",value:function t(i){return e.getAllActivityTypes().includes(i)}},{key:"getAllWorkflowStatuses",value:function e(){return[Ze.CREATED,Ze.RUNNING,Ze.COMPLETED,Ze.SUSPENDED,Ze.TERMINATED]}},{key:"isKnownWorkflowStatus",value:function t(i){return e.getAllWorkflowStatuses().includes(i)}}]);return e}();babelHelpers.defineProperty(Je,"UNKNOWN_ACTIVITY_TYPE",0);babelHelpers.defineProperty(Je,"EXECUTE_ACTIVITY_TYPE",1);babelHelpers.defineProperty(Je,"CLOSE_ACTIVITY_TYPE",2);babelHelpers.defineProperty(Je,"CANCEL_ACTIVITY_TYPE",3);babelHelpers.defineProperty(Je,"FAULT_ACTIVITY_TYPE",4);babelHelpers.defineProperty(Je,"CUSTOM_ACTIVITY_TYPE",5);babelHelpers.defineProperty(Je,"REPORT_ACTIVITY_TYPE",6);babelHelpers.defineProperty(Je,"ATTACHED_ENTITY_TYPE",7);babelHelpers.defineProperty(Je,"TRIGGER_ACTIVITY_TYPE",8);babelHelpers.defineProperty(Je,"ERROR_ACTIVITY_TYPE",9);babelHelpers.defineProperty(Je,"DEBUG_ACTIVITY_TYPE",10);babelHelpers.defineProperty(Je,"DEBUG_AUTOMATION_TYPE",11);babelHelpers.defineProperty(Je,"DEBUG_DESIGNER_TYPE",12);babelHelpers.defineProperty(Je,"DEBUG_LINK_TYPE",13);var $e=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty($e,"WAITING",0);babelHelpers.defineProperty($e,"RUNNING",1);babelHelpers.defineProperty($e,"COMPLETED",2);babelHelpers.defineProperty($e,"AUTOCOMPLETED",3);function Qe(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=et(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var s=function e(){};return{s:s,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!r&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function et(e,t){if(!e)return;if(typeof e==="string")return tt(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return tt(e,t)}function tt(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++){a[i]=e[i]}return a}function it(e,t,i){at(e,t);t.set(e,i)}function at(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var st=new WeakMap;var rt=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id","");babelHelpers.defineProperty(this,"status",$e.WAITING);babelHelpers.defineProperty(this,"modified",undefined);babelHelpers.defineProperty(this,"notes",[]);babelHelpers.defineProperty(this,"errors",[]);it(this,st,{writable:true,value:-1});babelHelpers.defineProperty(this,"workflowStatus",Ze.CREATED);if(n.Type.isArray(t)){var i=Qe(t),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;this.addEntry(s)}}catch(e){i.e(e)}finally{i.f()}}}babelHelpers.createClass(e,[{key:"addEntry",value:function e(t){this.id=t.name;if(babelHelpers.classPrivateFieldGet(this,st)<t.id){babelHelpers.classPrivateFieldSet(this,st,t.id);this.modified=t.datetime;this.workflowStatus=t.workflowStatus;if(t.type===s.TrackingEntry.CLOSE_ACTIVITY_TYPE){this.status=$e.COMPLETED}else{this.status=$e.RUNNING}}if(t.type===s.TrackingEntry.ERROR_ACTIVITY_TYPE){this.errors.push(t.note)}else if(t.type===s.TrackingEntry.CUSTOM_ACTIVITY_TYPE){this.notes.push(t.note)}}}]);return e}();var lt=function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id","");babelHelpers.defineProperty(this,"status",$e.COMPLETED);babelHelpers.defineProperty(this,"modified",undefined);if(t.isTriggerEntry()){this.id=t.note;this.modified=t.datetime}};function nt(e,t,i){ot(e,t);t.set(e,i)}function ot(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var ct=new WeakMap;var ut=new WeakMap;var pt=function(){function e(){babelHelpers.classCallCheck(this,e);nt(this,ct,{writable:true,value:{id:Je.UNKNOWN_ACTIVITY_TYPE,workflowId:"",type:Je.EXECUTE_ACTIVITY_TYPE,name:"",title:"",datetime:"",note:"",workflowStatus:Ze.CREATED}});nt(this,ut,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,ut,babelHelpers.classPrivateFieldGet(this,ct))}babelHelpers.createClass(e,[{key:"setLogEntry",value:function e(t){babelHelpers.classPrivateFieldSet(this,ut,Object.assign({},babelHelpers.classPrivateFieldGet(this,ct)));t=Object.assign({},t);if(n.Type.isStringFilled(t["ID"])){t["ID"]=parseInt(t["ID"])}if(n.Type.isStringFilled(t["TYPE"])){t["TYPE"]=parseInt(t["TYPE"])}if(n.Type.isNumber(t["ID"])){babelHelpers.classPrivateFieldGet(this,ut).id=t["ID"]}if(n.Type.isStringFilled(t["WORKFLOW_ID"])){babelHelpers.classPrivateFieldGet(this,ut).workflowId=t["WORKFLOW_ID"]}if(n.Type.isNumber(t["TYPE"])&&Je.isKnownActivityType(t["TYPE"])){babelHelpers.classPrivateFieldGet(this,ut).type=t["TYPE"]}if(n.Type.isStringFilled(t["MODIFIED"])){babelHelpers.classPrivateFieldGet(this,ut).datetime=t["MODIFIED"]}if(n.Type.isNumber(t["WORKFLOW_STATUS"])&&Je.isKnownWorkflowStatus(t["WORKFLOW_STATUS"])){babelHelpers.classPrivateFieldGet(this,ut).workflowStatus=t["WORKFLOW_STATUS"]}babelHelpers.classPrivateFieldGet(this,ut).name=String(t["ACTION_NAME"]);babelHelpers.classPrivateFieldGet(this,ut).title=String(t["ACTION_TITLE"]);babelHelpers.classPrivateFieldGet(this,ut).note=String(t["ACTION_NOTE"]);return this}},{key:"setStatus",value:function e(t){babelHelpers.classPrivateFieldGet(this,ut).status=t;return this}},{key:"build",value:function e(){var t=new Je;t.id=babelHelpers.classPrivateFieldGet(this,ut).id;t.workflowId=babelHelpers.classPrivateFieldGet(this,ut).workflowId;t.type=babelHelpers.classPrivateFieldGet(this,ut).type;t.name=babelHelpers.classPrivateFieldGet(this,ut).name;t.title=babelHelpers.classPrivateFieldGet(this,ut).title;t.note=babelHelpers.classPrivateFieldGet(this,ut).note;t.datetime=babelHelpers.classPrivateFieldGet(this,ut).datetime;t.workflowStatus=babelHelpers.classPrivateFieldGet(this,ut).workflowStatus;return t}}]);return e}();function bt(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=dt(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var s=function e(){};return{s:s,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!r&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function dt(e,t){if(!e)return;if(typeof e==="string")return vt(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return vt(e,t)}function vt(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++){a[i]=e[i]}return a}function ht(e,t,i){ft(e,t);t.set(e,i)}function ft(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var gt=new WeakMap;var mt=new WeakMap;var Tt=new WeakMap;var Pt=new WeakMap;var yt=function(){function e(t,i){babelHelpers.classCallCheck(this,e);ht(this,gt,{writable:true,value:void 0});ht(this,mt,{writable:true,value:void 0});ht(this,Tt,{writable:true,value:void 0});ht(this,Pt,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,gt,i);babelHelpers.classPrivateFieldSet(this,mt,t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){babelHelpers.classPrivateFieldSet(this,Tt,{});babelHelpers.classPrivateFieldSet(this,Pt,{});this.addLogs(t)}},{key:"reInit",value:function e(t){this.init(t)}},{key:"addLogs",value:function e(t){if(!n.Type.isPlainObject(t)){t={}}var i=new pt;for(var a=0,s=Object.entries(t);a<s.length;a++){var r=babelHelpers.slicedToArray(s[a],2),l=r[0],o=r[1];if(!n.Type.isArray(o)){continue}var c=bt(o),u;try{for(c.s();!(u=c.n()).done;){var p=u.value;var b=i.setLogEntry(p).build();if(b.isTriggerEntry()){this.addTriggerEntry(b)}else{this.addRobotEntry(b);var d=babelHelpers.classPrivateFieldGet(this,Pt)[b.name];if(!n.Type.isNil(babelHelpers.classPrivateFieldGet(this,mt))){var v=d.status===$e.RUNNING;var h=d.workflowStatus===Ze.COMPLETED;var f=babelHelpers.classPrivateFieldGet(this,mt).getCurrentStatusId()===l;var g=v&&!f;var m=v&&h&&f;if(g||m){d.status=$e.COMPLETED}}}}}catch(e){c.e(e)}finally{c.f()}}}},{key:"addTriggerEntry",value:function e(t){if(t.isTriggerEntry()){babelHelpers.classPrivateFieldGet(this,Tt)[t.note]=new lt(t)}}},{key:"addRobotEntry",value:function e(t){if(t.isTriggerEntry()){return}if(!babelHelpers.classPrivateFieldGet(this,Pt)[t.name]){babelHelpers.classPrivateFieldGet(this,Pt)[t.name]=new rt([t])}else{babelHelpers.classPrivateFieldGet(this,Pt)[t.name].addEntry(t)}}},{key:"getRobotLog",value:function e(t){return babelHelpers.classPrivateFieldGet(this,Pt)[t]||null}},{key:"getTriggerLog",value:function e(t){return babelHelpers.classPrivateFieldGet(this,Tt)[t]||null}},{key:"update",value:function e(t){var i=this;return BX.ajax({method:"POST",dataType:"json",url:babelHelpers.classPrivateFieldGet(this,gt),data:{ajax_action:"get_log",document_signed:t},onsuccess:function e(t){if(t.DATA&&t.DATA.LOG){i.reInit(t.DATA.LOG)}}})}}]);return e}();function Ht(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=It(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var s=function e(){};return{s:s,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!r&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function It(e,t){if(!e)return;if(typeof e==="string")return Ot(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ot(e,t)}function Ot(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++){a[i]=e[i]}return a}function Et(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function Ft(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Et(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Et(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Ct(e,t,i){_t(e,t);t.set(e,i)}function _t(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var St=new WeakMap;var At=new WeakMap;var kt=new WeakMap;var Nt=new WeakMap;var wt=new WeakMap;var Gt=new WeakMap;var Mt=new WeakMap;var Dt=new WeakMap;var Rt=new WeakMap;var Lt=new WeakMap;var Bt=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"SYSTEM_EXPRESSION_PATTERN","\\{=\\s*(?<object>[a-z0-9_]+)\\s*\\:\\s*(?<field>[a-z0-9_\\.]+)(\\s*>\\s*(?<mod1>[a-z0-9_\\:]+)(\\s*,\\s*(?<mod2>[a-z0-9_]+))?)?\\s*\\}");Ct(babelHelpers.assertThisInitialized(i),St,{writable:true,value:void 0});Ct(babelHelpers.assertThisInitialized(i),At,{writable:true,value:void 0});Ct(babelHelpers.assertThisInitialized(i),kt,{writable:true,value:void 0});Ct(babelHelpers.assertThisInitialized(i),Nt,{writable:true,value:void 0});Ct(babelHelpers.assertThisInitialized(i),wt,{writable:true,value:void 0});Ct(babelHelpers.assertThisInitialized(i),Gt,{writable:true,value:void 0});Ct(babelHelpers.assertThisInitialized(i),Mt,{writable:true,value:void 0});Ct(babelHelpers.assertThisInitialized(i),Dt,{writable:true,value:void 0});Ct(babelHelpers.assertThisInitialized(i),Rt,{writable:true,value:void 0});Ct(babelHelpers.assertThisInitialized(i),Lt,{writable:true,value:void 0});i.setEventNamespace("BX.Bizproc.Automation");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),At,e.document);if(!n.Type.isNil(e.template)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),kt,e.template)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Rt,e.isFrameMode);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Lt,G.none());babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Nt,e.tracker);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Dt,false);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),wt,new Ye);return i}babelHelpers.createClass(t,[{key:"hasTemplate",value:function e(){return!n.Type.isNil(babelHelpers.classPrivateFieldGet(this,kt))}},{key:"getTemplate",value:function e(){return babelHelpers.classPrivateFieldGet(this,kt)}},{key:"getDocument",value:function e(){return babelHelpers.classPrivateFieldGet(this,At)}},{key:"clone",value:function e(){var i=new t({document:babelHelpers.classPrivateFieldGet(this,At),template:babelHelpers.classPrivateFieldGet(this,kt),isFrameMode:babelHelpers.classPrivateFieldGet(this,Rt),tracker:babelHelpers.classPrivateFieldGet(this,Nt)});var a=Ft({Name:t.generateName(),Delay:this.getDelayInterval().serialize(),Condition:this.getCondition().serialize()},BX.clone(babelHelpers.classPrivateFieldGet(this,St)));i.init(a,babelHelpers.classPrivateFieldGet(this,Lt));return i}},{key:"isEqual",value:function e(t){return babelHelpers.classPrivateFieldGet(this,St).Name===babelHelpers.classPrivateFieldGet(t,St).Name}},{key:"init",value:function e(i,a){if(n.Type.isPlainObject(i)){babelHelpers.classPrivateFieldSet(this,St,i)}if(!babelHelpers.classPrivateFieldGet(this,St).Name){babelHelpers.classPrivateFieldGet(this,St).Name=t.generateName()}babelHelpers.classPrivateFieldSet(this,wt,new Ye(babelHelpers.classPrivateFieldGet(this,St).Delay));babelHelpers.classPrivateFieldSet(this,Mt,new s.ConditionGroup(babelHelpers.classPrivateFieldGet(this,St).Condition));if(!babelHelpers.classPrivateFieldGet(this,St).Condition){babelHelpers.classPrivateFieldGet(this,Mt).type=s.ConditionGroup.CONDITION_TYPE.Mixed}babelHelpers.classPrivateFieldSet(this,Lt,n.Type.isNil(a)?G.edit():a);if(!babelHelpers.classPrivateFieldGet(this,Lt).isNone()){babelHelpers.classPrivateFieldSet(this,Gt,this.createNode())}}},{key:"reInit",value:function e(t,i){if(n.Type.isNil(i)&&babelHelpers.classPrivateFieldGet(this,Lt).isNone()){return}var a=babelHelpers.classPrivateFieldGet(this,Gt);babelHelpers.classPrivateFieldSet(this,Gt,this.createNode());if(a.parentNode){a.parentNode.replaceChild(babelHelpers.classPrivateFieldGet(this,Gt),a)}}},{key:"destroy",value:function e(){n.Dom.remove(babelHelpers.classPrivateFieldGet(this,Gt));this.emit("Robot:destroyed")}},{key:"canEdit",value:function e(){return babelHelpers.classPrivateFieldGet(this,kt).canEdit()}},{key:"getProperties",value:function e(){if(babelHelpers.classPrivateFieldGet(this,St)&&n.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,St).Properties)){return babelHelpers.classPrivateFieldGet(this,St).Properties}return{}}},{key:"getProperty",value:function e(t){return this.getProperties()[t]||null}},{key:"hasProperty",value:function e(t){return this.getProperties().hasOwnProperty(t)}},{key:"setProperty",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,St).Properties[t]=i;return this}},{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,St).Name||null}},{key:"getLogStatus",value:function e(){var t=$e.WAITING;var i=babelHelpers.classPrivateFieldGet(this,Nt).getRobotLog(this.getId());if(i){t=i.status}else if(babelHelpers.classPrivateFieldGet(this,St).DelayName){i=babelHelpers.classPrivateFieldGet(this,Nt).getRobotLog(babelHelpers.classPrivateFieldGet(this,St).DelayName);if(i&&i.status===$e.RUNNING){t=$e.RUNNING}}return t}},{key:"getLogErrors",value:function e(){var t=[];var i=babelHelpers.classPrivateFieldGet(this,Nt).getRobotLog(this.getId());if(i&&i.errors){t=i.errors}return t}},{key:"getDelayNotes",value:function e(){if(babelHelpers.classPrivateFieldGet(this,St).DelayName){var t=babelHelpers.classPrivateFieldGet(this,Nt).getRobotLog(babelHelpers.classPrivateFieldGet(this,St).DelayName);if(t&&t.status===$e.RUNNING){return t.notes}}return[]}},{key:"selectNode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Gt)){n.Dom.addClass(babelHelpers.classPrivateFieldGet(this,Gt),"--selected");this.emit("Robot:selected")}}},{key:"unselectNode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Gt)){n.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,Gt),"--selected");this.emit("Robot:unselected")}}},{key:"isSelected",value:function e(){return babelHelpers.classPrivateFieldGet(this,Gt)&&n.Dom.hasClass(babelHelpers.classPrivateFieldGet(this,Gt),"--selected")}},{key:"enableManageMode",value:function e(t){var i=this;babelHelpers.classPrivateFieldSet(this,Lt,G.manage().setProperty("isActive",t));if(!t){n.Dom.addClass(babelHelpers.classPrivateFieldGet(this,Gt),"--locked-node")}var a=babelHelpers.classPrivateFieldGet(this,Gt).querySelector(".bizproc-automation-robot-btn-delete");n.Dom.hide(a);babelHelpers.classPrivateFieldGet(this,Gt).onclick=function(){if(!babelHelpers.classPrivateFieldGet(i,Lt).isManage()||!babelHelpers.classPrivateFieldGet(i,Lt).getProperty("isActive",false)){return}if(!i.isSelected()){i.selectNode()}else{i.unselectNode()}}}},{key:"disableManageMode",value:function e(){babelHelpers.classPrivateFieldSet(this,Lt,G.edit());this.unselectNode();n.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,Gt),"--locked-node");var t=babelHelpers.classPrivateFieldGet(this,Gt).querySelector(".bizproc-automation-robot-btn-delete");n.Dom.show(t);babelHelpers.classPrivateFieldGet(this,Gt).onclick=undefined}},{key:"createNode",value:function e(){var t=this;var i="bizproc-automation-robot-container-wrapper";var a="bizproc-automation-robot-container";if(babelHelpers.classPrivateFieldGet(this,Lt).isEdit()&&this.canEdit()){i+=" bizproc-automation-robot-container-wrapper-draggable"}if(this.draft){a+=" --draft"}var s=n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TO");var r=n.Dom.create("a",{attrs:{className:"bizproc-automation-robot-settings-name "+(babelHelpers.classPrivateFieldGet(this,Lt).isView()?"--mode-view":""),title:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AUTOMATICALLY")},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AUTOMATICALLY")});if(n.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,St).viewData)&&babelHelpers.classPrivateFieldGet(this,St).viewData.responsibleLabel){var l=babelHelpers.classPrivateFieldGet(this,St).viewData.responsibleLabel.replace("{=Document:ASSIGNED_BY_ID}",n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_RESPONSIBLE")).replace("author",n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_RESPONSIBLE")).replace(/\{=Constant\:Constant[0-9]+\}/,n.Loc.getMessage("BIZPROC_AUTOMATION_ASK_CONSTANT")).replace(/\{\{~&\:Constant[0-9]+\}\}/,n.Loc.getMessage("BIZPROC_AUTOMATION_ASK_CONSTANT")).replace(/\{=Template\:Parameter[0-9]+\}/,n.Loc.getMessage("BIZPROC_AUTOMATION_ASK_PARAMETER")).replace(/\{\{~&:\:Parameter[0-9]+\}\}/,n.Loc.getMessage("BIZPROC_AUTOMATION_ASK_PARAMETER"));if(l.indexOf("{=Document")>=0){babelHelpers.classPrivateFieldGet(this,At).getFields().forEach((function(e){l=l.replace(e["SystemExpression"],e["Name"])}))}if(l.indexOf("{=A")>=0){babelHelpers.classPrivateFieldGet(this,kt).robots.forEach((function(e){e.getReturnFieldsDescription().forEach((function(t){if(t["Type"]==="user"){l=l.replace(t["SystemExpression"],e.getTitle()+": "+t["Name"])}}))}))}r.textContent=l;r.setAttribute("title",l);if(babelHelpers.classPrivateFieldGet(this,St).viewData.responsibleUrl){r.href=babelHelpers.classPrivateFieldGet(this,St).viewData.responsibleUrl;if(babelHelpers.classPrivateFieldGet(this,Rt)){r.setAttribute("target","_blank")}}if(babelHelpers.classPrivateFieldGet(this,Lt).isEdit()&&parseInt(babelHelpers.classPrivateFieldGet(this,St).viewData.responsibleId)>0){r.setAttribute("bx-tooltip-user-id",babelHelpers.classPrivateFieldGet(this,St).viewData.responsibleId)}}var o=this.getDelayInterval().format(n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AT_ONCE"),babelHelpers.classPrivateFieldGet(this,At).getFields());if(this.isExecuteAfterPrevious()){o=o!==n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AT_ONCE")?o+", ":"";o+=n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AFTER_PREVIOUS")}if(this.getCondition().items.length>0){o+=", "+n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BY_CONDITION")}var c=n.Dom.create(babelHelpers.classPrivateFieldGet(this,Lt).isEdit()?"a":"span",{attrs:{className:babelHelpers.classPrivateFieldGet(this,Lt).isEdit()?"bizproc-automation-robot-link":"bizproc-automation-robot-text",title:o},text:o});var u=n.Dom.create("div",{attrs:{className:"bizproc-automation-robot-information"}});this.subscribeOnce("Robot:destroyed",(function(){if(J.isBindedToNode(u)){J.hideHint()}}));switch(this.getLogStatus()){case $e.RUNNING:if(babelHelpers.classPrivateFieldGet(this,At).getCurrentStatusId()===babelHelpers.classPrivateFieldGet(this,kt).getStatusId()){u.classList.add("--loader");var p=this.getDelayNotes();if(p.length){u.setAttribute("data-text",p.join("\n"));J.bindToNode(u)}}break;case $e.COMPLETED:case $e.AUTOCOMPLETED:a+=" --complete";u.classList.add("--complete");break}var b=this.getLogErrors();if(b.length>0){u.classList.add("--errors");u.setAttribute("data-text",b.join("\n"));J.bindToNode(u)}var d="bizproc-automation-robot-title-text";if(babelHelpers.classPrivateFieldGet(this,Lt).isEdit()&&this.canEdit()){d+=" bizproc-automation-robot-title-text-editable"}var v=n.Dom.create("div",{attrs:{className:a,"data-role":"robot-container","data-type":"item-robot","data-id":this.getId()},children:[n.Dom.create("div",{props:{className:"bizproc-automation-robot-container-checkbox"}}),n.Dom.create("div",{attrs:{className:i},children:[n.Dom.create("div",{attrs:{className:"bizproc-automation-robot-deadline"},children:[c]}),n.Dom.create("div",{attrs:{className:"bizproc-automation-robot-title"},children:[n.Dom.create("div",{attrs:{className:d},html:this.clipTitle(this.getTitle()),events:{click:function e(i){if(babelHelpers.classPrivateFieldGet(t,Lt).isEdit()&&t.canEdit()&&!babelHelpers.classPrivateFieldGet(t,Lt).isManage()){t.onTitleEditClick(i)}}}})]}),n.Dom.create("div",{attrs:{className:"bizproc-automation-robot-settings"},children:[n.Dom.create("div",{attrs:{className:"bizproc-automation-robot-settings-title"},text:s+":"}),r]}),u]})]});if(this.canEdit()){this.registerItem(v)}if(babelHelpers.classPrivateFieldGet(this,Lt).isEdit()){var h=n.Dom.create("SPAN",{attrs:{className:"bizproc-automation-robot-btn-delete"}});n.Event.bind(h,"click",this.onDeleteButtonClick.bind(this,h));v.lastChild.appendChild(h);var f=n.Dom.create("div",{attrs:{className:"bizproc-automation-robot-btn-copy"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_COPY")||"copy"});n.Event.bind(f,"click",this.onCopyButtonClick.bind(this,f));v.appendChild(f);var g=n.Dom.create("div",{attrs:{className:"bizproc-automation-robot-btn-settings"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EDIT")});n.Event.bind(v,"click",this.onSettingsButtonClick.bind(this,v));v.appendChild(g)}return v}},{key:"onDeleteButtonClick",value:function e(t,i){i.stopPropagation();if(!this.canEdit()){J.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,Lt).isManage()){n.Dom.remove(babelHelpers.classPrivateFieldGet(this,Gt));babelHelpers.classPrivateFieldGet(this,kt).deleteRobot(this)}}},{key:"onSettingsButtonClick",value:function e(t){if(!this.canEdit()){J.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,Lt).isManage()){var i;babelHelpers.classPrivateFieldGet(this,kt).openRobotSettingsDialog(this,(i=babelHelpers.classPrivateFieldGet(this,St).DialogContext)!==null&&i!==void 0?i:null)}}},{key:"onCopyButtonClick",value:function e(t,i){i.stopPropagation();if(!this.canEdit()){J.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,Lt).isManage()){var a=this.clone();var s=a.getProperty("Title");if(!n.Type.isNil(s)){var r=s+" "+" "+n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_COPY_CAPTION");a.setProperty("Title",r);a.reInit()}ui.copyRobotTo(babelHelpers.classPrivateFieldGet(this,kt),a,babelHelpers.classPrivateFieldGet(this,kt).getNextRobot(this))}}},{key:"onTitleEditClick",value:function e(t){t.preventDefault();t.stopPropagation();var i="bizproc_automation_robot_title_dialog";var a=n.Dom.create("form",{props:{name:i},style:{"min-width":"540px"}});a.appendChild(n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ROBOT_NAME")+":"}));a.appendChild(n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[BX.create("input",{attrs:{className:"bizproc-automation-popup-input",type:"text",name:"name",value:this.getTitle()}})]}));this.emit("Robot:title:editStart");var r=this;var l=new BX.PopupWindow(s.Helper.generateUniqueId(),null,{titleBar:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ROBOT_NAME"),content:a,closeIcon:true,offsetLeft:0,offsetTop:0,closeByEsc:true,draggable:{restrict:false},overlay:false,events:{onPopupClose:function e(t){t.destroy();r.emit("Robot:title:editCompleted")}},buttons:[new BX.PopupWindowButton({text:n.Loc.getMessage("JS_CORE_WINDOW_SAVE"),className:"popup-window-button-accept",events:{click:function e(){var t=a.elements.name;r.setProperty("Title",t.value);r.reInit();babelHelpers.classPrivateFieldGet(r,kt).markModified();this.popupWindow.close()}}}),new BX.PopupWindowButtonLink({text:n.Loc.getMessage("JS_CORE_WINDOW_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function e(){this.popupWindow.close()}}})]});l.show()}},{key:"onSearch",value:function e(t){if(!babelHelpers.classPrivateFieldGet(this,Gt)){return}var i=t.getData().queryString;var a=!i||this.getTitle().toLowerCase().indexOf(i)>=0;if(a){n.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,Gt),"--search-mismatch")}else{n.Dom.addClass(babelHelpers.classPrivateFieldGet(this,Gt),"--search-mismatch")}}},{key:"clipTitle",value:function e(t){var i=n.Text.encode(t);var a=i.split(" ");var s="<span>"+a[a.length-1]+"</span>";a.splice(a.length-1);i=a.join(" ")+" "+s;return i}},{key:"updateData",value:function e(t){if(n.Type.isPlainObject(t)){babelHelpers.classPrivateFieldSet(this,St,t)}else{throw"Invalid data"}}},{key:"serialize",value:function e(){var t=BX.clone(babelHelpers.classPrivateFieldGet(this,St));delete t["viewData"];delete t["DialogContext"];t.Delay=babelHelpers.classPrivateFieldGet(this,wt).serialize();t.Condition=babelHelpers.classPrivateFieldGet(this,Mt).serialize();return t}},{key:"getDelayInterval",value:function e(){return babelHelpers.classPrivateFieldGet(this,wt)}},{key:"setDelayInterval",value:function e(t){babelHelpers.classPrivateFieldSet(this,wt,t);return this}},{key:"getCondition",value:function e(){return babelHelpers.classPrivateFieldGet(this,Mt)}},{key:"setCondition",value:function e(t){babelHelpers.classPrivateFieldSet(this,Mt,t);return this}},{key:"setExecuteAfterPrevious",value:function e(t){babelHelpers.classPrivateFieldGet(this,St).ExecuteAfterPrevious=t?1:0;return this}},{key:"isExecuteAfterPrevious",value:function e(){return babelHelpers.classPrivateFieldGet(this,St).ExecuteAfterPrevious===1||babelHelpers.classPrivateFieldGet(this,St).ExecuteAfterPrevious==="1"}},{key:"registerItem",value:function e(t){if(n.Type.isNil(t["__bxddid"])){t.onbxdragstart=BX.proxy(this.dragStart,this);t.onbxdrag=BX.proxy(this.dragMove,this);t.onbxdragstop=BX.proxy(this.dragStop,this);t.onbxdraghover=BX.proxy(this.dragOver,this);jsDD.registerObject(t);jsDD.registerDest(t,1)}}},{key:"unregisterItem",value:function e(t){t.onbxdragstart=undefined;t.onbxdrag=undefined;t.onbxdragstop=undefined;t.onbxdraghover=undefined;jsDD.unregisterObject(t);jsDD.unregisterDest(t)}},{key:"dragStart",value:function e(){this.draggableItem=BX.proxy_context;if(!this.draggableItem){jsDD.stopCurrentDrag();return}if(!this.stub){var t=this.draggableItem.offsetWidth;this.stub=this.draggableItem.cloneNode(true);this.stub.style.position="absolute";this.stub.classList.add("bizproc-automation-robot-container-drag");this.stub.style.width=t+"px";document.body.appendChild(this.stub)}}},{key:"dragMove",value:function e(t,i){this.stub.style.left=t+"px";this.stub.style.top=i+"px"}},{key:"dragOver",value:function e(t,i,a){if(this.droppableItem){this.droppableItem.classList.remove("bizproc-automation-robot-container-pre")}if(this.droppableColumn){this.droppableColumn.classList.remove("bizproc-automation-robot-list-pre")}var s=t.getAttribute("data-type");if(s==="item-robot"){this.droppableItem=t;this.droppableColumn=null}if(s==="column-robot"){this.droppableColumn=t.querySelector('[data-role="robot-list"]');this.droppableItem=null}if(this.droppableItem){this.droppableItem.classList.add("bizproc-automation-robot-container-pre")}if(this.droppableColumn){this.droppableColumn.classList.add("bizproc-automation-robot-list-pre")}}},{key:"dragStop",value:function e(t,i,a){a=a||window.event;var s=a&&(a.ctrlKey||a.metaKey);if(this.draggableItem){if(this.droppableItem){this.droppableItem.classList.remove("bizproc-automation-robot-container-pre");this.emit("Robot:manage",{templateNode:this.droppableItem.parentNode,isCopy:s,droppableItem:this.droppableItem,robot:this})}else if(this.droppableColumn){this.droppableColumn.classList.remove("bizproc-automation-robot-list-pre");this.emit("Robot:manage",{templateNode:this.droppableColumn,isCopy:s,robot:this})}}this.stub.parentNode.removeChild(this.stub);this.stub=null;this.draggableItem=null;this.droppableItem=null}},{key:"moveTo",value:function e(t,i){n.Dom.remove(babelHelpers.classPrivateFieldGet(this,Gt));babelHelpers.classPrivateFieldGet(this,kt).deleteRobot(this);babelHelpers.classPrivateFieldSet(this,kt,t);babelHelpers.classPrivateFieldGet(this,kt).insertRobot(this,i);babelHelpers.classPrivateFieldSet(this,Gt,this.createNode());babelHelpers.classPrivateFieldGet(this,kt).insertRobotNode(babelHelpers.classPrivateFieldGet(this,Gt),i?i.node:null)}},{key:"copyTo",value:function e(i,a){var s=new t({document:babelHelpers.classPrivateFieldGet(this,At),template:i,isFrameMode:babelHelpers.classPrivateFieldGet(this,Rt),tracker:babelHelpers.classPrivateFieldGet(this,Nt)});var r=this.serialize();delete r["Name"];delete r["DelayName"];s.init(r,babelHelpers.classPrivateFieldGet(this,Lt));i.insertRobot(s,a);i.insertRobotNode(s.node,a?a.node:null);return s}},{key:"getTitle",value:function e(){return this.getProperty("Title")||this.getDescriptionTitle()}},{key:"getDescriptionTitle",value:function e(){var t="untitled";var i=this.template.getRobotDescription(babelHelpers.classPrivateFieldGet(this,St)["Type"]);if(i["NAME"]){t=i["NAME"]}if(i["ROBOT_SETTINGS"]&&i["ROBOT_SETTINGS"]["TITLE"]){t=i["ROBOT_SETTINGS"]["TITLE"]}return t}},{key:"hasTitle",value:function e(){return this.getTitle()!=="untitled"}},{key:"hasReturnFields",value:function e(){var t=this.template.getRobotDescription(babelHelpers.classPrivateFieldGet(this,St)["Type"]);var i=babelHelpers.classPrivateFieldGet(this,St)["Properties"];if(!n.Type.isObject(t)){return false}var a=function e(){return n.Type.isObject(t["RETURN"])&&n.Type.isArrayFilled(Object.values(t["RETURN"]))};var s=function e(){return n.Type.isArray(t["ADDITIONAL_RESULT"])&&t["ADDITIONAL_RESULT"].some((function(e){var t;return Object.values((t=i[e])!==null&&t!==void 0?t:[]).length>0}))};return a()||s()}},{key:"getReturnFieldsDescription",value:function e(){var t=this;var i=[];var a=this.template.getRobotDescription(babelHelpers.classPrivateFieldGet(this,St)["Type"]);if(a&&a["RETURN"]){for(var s in a["RETURN"]){if(a["RETURN"].hasOwnProperty(s)){var r=a["RETURN"][s];i.push({Id:s,ObjectId:this.getId(),ObjectName:this.getTitle(),Name:r["NAME"],Type:r["TYPE"],Expression:"{{~"+this.getId()+":"+s+" # "+this.getTitle()+": "+r["NAME"]+"}}",SystemExpression:"{="+this.getId()+":"+s+"}"});if(!this.appendPropertyMods){continue}if(r["TYPE"]==="user"||r["TYPE"]==="bool"||r["TYPE"]==="file"){var l=r["TYPE"]==="user"?"friendly":"printable";i.push({Id:s+"_printable",ObjectId:this.getId(),Name:r["NAME"]+" "+n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX"),Type:"string",Expression:"{{~".concat(this.getId(),":").concat(s," > ").concat(l," # ").concat(this.getTitle(),": ").concat(r["NAME"],"}}"),SystemExpression:"{=".concat(this.getId(),":").concat(s,">").concat(l,"}")})}}}}if(a&&n.Type.isArray(a["ADDITIONAL_RESULT"])){var o=babelHelpers.classPrivateFieldGet(this,St)["Properties"];a["ADDITIONAL_RESULT"].forEach((function(e){if(o[e]){for(var a in o[e]){if(o[e].hasOwnProperty(a)){var s=o[e][a];i.push({Id:a,ObjectId:t.getId(),Name:s["Name"],Type:s["Type"],Options:s["Options"]||null,Expression:"{{~".concat(t.getId(),":").concat(a," # ").concat(t.getTitle(),": ").concat(s["Name"],"}}"),SystemExpression:"{="+t.getId()+":"+a+"}"});if(s["Type"]==="user"||s["Type"]==="bool"||s["Type"]==="file"){var r=s["Type"]==="user"?"friendly":"printable";var l="{{~".concat(t.getId(),":").concat(a," > ").concat(r," # ").concat(t.getTitle(),": ").concat(s["Name"],"}}");i.push({Id:a+"_printable",ObjectId:t.getId(),Name:s["Name"]+" "+n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX"),Type:"string",Expression:l,SystemExpression:"{="+t.getId()+":"+a+">"+r+"}"})}}}}}))}return i}},{key:"getReturnProperty",value:function e(t){var i=this.getReturnFieldsDescription();for(var a=0;a<i.length;++a){if(i[a]["Id"]===t){return i[a]}}return null}},{key:"collectUsages",value:function e(){var t=this;var i=this.getProperties();var a={Document:new Set,Constant:new Set,Variable:new Set,Parameter:new Set,GlobalConstant:new Set,GlobalVariable:new Set,Activity:new Set};Object.values(i).forEach((function(e){return t.collectExpressions(e,a)}));var s=this.getCondition().serialize();s.items.forEach((function(e){return t.collectParsedExpressions(e[0],a)}));return a}},{key:"collectExpressions",value:function e(t,i){var a=this;if(n.Type.isArray(t)){t.forEach((function(e){return a.collectExpressions(e,i)}))}else if(n.Type.isPlainObject(t)){Object.values(t).forEach((function(e){return a.collectExpressions(e,i)}))}else if(n.Type.isStringFilled(t)){var s;var r=new RegExp(this.SYSTEM_EXPRESSION_PATTERN,"ig");while((s=r.exec(t))!==null){this.collectParsedExpressions(s.groups,i)}}}},{key:"collectParsedExpressions",value:function e(t,i){if(n.Type.isPlainObject(t)&&t["object"]&&t["field"]){switch(t["object"]){case"Document":i.Document.add(t["field"]);return;case"Constant":i.Constant.add(t["field"]);return;case"Variable":i.Variable.add(t["field"]);return;case"Template":i.Parameter.add(t["field"]);return;case"GlobalConst":i.GlobalConstant.add(t["field"]);return;case"GlobalVar":i.GlobalVariable.add(t["field"]);return}var a=new RegExp(/^A[_0-9]+$/,"ig");if(a.exec(t["object"])){i.Activity.add([t["object"],t["field"]])}}}},{key:"hasBrokenLink",value:function e(){var t=BX.clone(this.collectUsages());if(!this.template){return false}var i={Document:babelHelpers.classPrivateFieldGet(this,At).getFields(),Constant:babelHelpers.classPrivateFieldGet(this,kt).getConstants(),Variable:babelHelpers.classPrivateFieldGet(this,kt).getVariables(),GlobalConstant:babelHelpers.classPrivateFieldGet(this,kt).globalConstants,GlobalVariable:babelHelpers.classPrivateFieldGet(this,kt).globalVariables,Parameter:babelHelpers.classPrivateFieldGet(this,kt).getParameters(),Activity:babelHelpers.classPrivateFieldGet(this,kt).getSerializedRobots()};for(var a in t){if(t[a].size>0){var s=new Set;for(var r in i[a]){if(i[a][r]["Id"]){s.add(i[a][r]["Id"])}else if(i[a][r]["Name"]){s.add(i[a][r]["Name"])}}var l=Ht(t[a].values()),o;try{for(l.s();!(o=l.n()).done;){var c=o.value;var u=c;var p=c;if(n.Type.isArray(u)){u=c[0];p=c[1]}if(!s.has(u)){return true}if(a==="Activity"){var b=babelHelpers.classPrivateFieldGet(this,kt).getRobotById(u);if(!b.getReturnProperty(p)){return true}}}}catch(e){l.e(e)}finally{l.f()}}}return false}},{key:"node",get:function e(){return babelHelpers.classPrivateFieldGet(this,Gt)}},{key:"data",get:function e(){return babelHelpers.classPrivateFieldGet(this,St)}},{key:"draft",get:function e(){return babelHelpers.classPrivateFieldGet(this,Dt)},set:function e(t){babelHelpers.classPrivateFieldSet(this,Dt,t)}},{key:"template",get:function e(){return babelHelpers.classPrivateFieldGet(this,kt)}}],[{key:"generateName",value:function e(){return"A"+parseInt(Math.random()*1e5)+"_"+parseInt(Math.random()*1e5)+"_"+parseInt(Math.random()*1e5)+"_"+parseInt(Math.random()*1e5)}}]);return t}(a.EventEmitter);function xt(e,t,i){zt(e,t);t.set(e,i)}function zt(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Ut=new WeakMap;var Wt=function(){function e(t){babelHelpers.classCallCheck(this,e);xt(this,Ut,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Ut,t)}babelHelpers.createClass(e,[{key:"clone",value:function t(){return new e(n.Runtime.clone(babelHelpers.classPrivateFieldGet(this,Ut)))}},{key:"set",value:function e(t,i,a){if(!n.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,Ut)[t])){babelHelpers.classPrivateFieldGet(this,Ut)[t]={}}var s=babelHelpers.classPrivateFieldGet(this,Ut)[t][i];if(s!==a){BX.userOptions.save("bizproc.automation",t,i,a,false)}return this}},{key:"get",value:function e(t,i,a){var s=a;if(this.has(t,i)){s=babelHelpers.classPrivateFieldGet(this,Ut)[t][i]}return s}},{key:"has",value:function e(t,i){return n.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,Ut)[t])&&n.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,Ut)[t][i])}}]);return e}();function jt(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function Yt(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?jt(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):jt(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Zt(e,t){Vt(e,t);t.add(e)}function Xt(e,t,i){Vt(e,t);t.set(e,i)}function Vt(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Kt(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var qt=new WeakMap;var Jt=new WeakMap;var $t=new WeakMap;var Qt=new WeakMap;var ei=new WeakMap;var ti=new WeakMap;var ii=new WeakMap;var ai=new WeakMap;var si=new WeakMap;var ri=new WeakMap;var li=new WeakMap;var ni=new WeakSet;var oi=new WeakSet;var ci=new WeakSet;var ui=function(e){babelHelpers.inherits(t,e);function t(e){var i;var a;babelHelpers.classCallCheck(this,t);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Zt(babelHelpers.assertThisInitialized(a),ci);Zt(babelHelpers.assertThisInitialized(a),oi);Zt(babelHelpers.assertThisInitialized(a),ni);Xt(babelHelpers.assertThisInitialized(a),qt,{writable:true,value:void 0});Xt(babelHelpers.assertThisInitialized(a),Jt,{writable:true,value:void 0});Xt(babelHelpers.assertThisInitialized(a),$t,{writable:true,value:void 0});Xt(babelHelpers.assertThisInitialized(a),Qt,{writable:true,value:void 0});Xt(babelHelpers.assertThisInitialized(a),ei,{writable:true,value:void 0});Xt(babelHelpers.assertThisInitialized(a),ti,{writable:true,value:void 0});Xt(babelHelpers.assertThisInitialized(a),ii,{writable:true,value:void 0});Xt(babelHelpers.assertThisInitialized(a),ai,{writable:true,value:void 0});Xt(babelHelpers.assertThisInitialized(a),si,{writable:true,value:void 0});Xt(babelHelpers.assertThisInitialized(a),ri,{writable:true,value:void 0});Xt(babelHelpers.assertThisInitialized(a),li,{writable:true,value:void 0});a.setEventNamespace("BX.Bizproc.Automation");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),qt,(i=e.context)!==null&&i!==void 0?i:s.getGlobalContext());a.constants=e.constants;a.globalConstants=e.globalConstants;a.variables=e.variables;a.globalVariables=e.globalVariables;babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),ti,e.templateContainerNode);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Jt,e.delayMinLimitM);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),$t,e.userOptions);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Qt,babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(a),qt).tracker);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),li,{});babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),ri,[]);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),ei,G.none());return a}babelHelpers.createClass(t,[{key:"init",value:function e(t,i){if(n.Type.isPlainObject(t)){babelHelpers.classPrivateFieldSet(this,li,t);if(!n.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,li).CONSTANTS)){babelHelpers.classPrivateFieldGet(this,li).CONSTANTS={}}if(!n.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,li).PARAMETERS)){babelHelpers.classPrivateFieldGet(this,li).PARAMETERS={}}if(!n.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,li).VARIABLES)){babelHelpers.classPrivateFieldGet(this,li).VARIABLES={}}this.markExternalModified(babelHelpers.classPrivateFieldGet(this,li)["IS_EXTERNAL_MODIFIED"]);this.markModified(false)}babelHelpers.classPrivateFieldSet(this,ei,G.fromRaw(i));if(!babelHelpers.classPrivateFieldGet(this,ei).isNone()){babelHelpers.classPrivateFieldSet(this,ii,babelHelpers.classPrivateFieldGet(this,ti).querySelector('[data-role="automation-template"][data-status-id="'+babelHelpers.classPrivateFieldGet(this,li).DOCUMENT_STATUS+'"]'));babelHelpers.classPrivateFieldSet(this,ai,babelHelpers.classPrivateFieldGet(this,ii).querySelector('[data-role="robot-list"]'));babelHelpers.classPrivateFieldSet(this,si,babelHelpers.classPrivateFieldGet(this,ii).querySelector('[data-role="buttons"]'));this.initRobots();this.initButtons();if(!this.isExternalModified()&&this.canEdit()){jsDD.registerDest(babelHelpers.classPrivateFieldGet(this,ii),10)}else{jsDD.unregisterDest(babelHelpers.classPrivateFieldGet(this,ii))}}}},{key:"reInit",value:function e(t,i){n.Dom.clean(babelHelpers.classPrivateFieldGet(this,ai));n.Dom.clean(babelHelpers.classPrivateFieldGet(this,si));this.destroy();this.init(t,i)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,ri).forEach((function(e){return e.destroy()}))}},{key:"canEdit",value:function e(){return babelHelpers.classPrivateFieldGet(this,qt).canEdit}},{key:"initRobots",value:function e(){babelHelpers.classPrivateFieldSet(this,ri,[]);if(n.Type.isArray(babelHelpers.classPrivateFieldGet(this,li).ROBOTS)){for(var t=0;t<babelHelpers.classPrivateFieldGet(this,li).ROBOTS.length;++t){var i=new Bt({document:babelHelpers.classPrivateFieldGet(this,qt).document,template:this,isFrameMode:babelHelpers.classPrivateFieldGet(this,qt).get("isFrameMode"),tracker:babelHelpers.classPrivateFieldGet(this,Qt)});i.init(babelHelpers.classPrivateFieldGet(this,li).ROBOTS[t],babelHelpers.classPrivateFieldGet(this,ei));this.insertRobotNode(i.node);babelHelpers.classPrivateFieldGet(this,ri).push(i)}}}},{key:"getSelectedRobotNames",value:function e(){var t=[];babelHelpers.classPrivateFieldGet(this,ri).forEach((function(e){if(e.isSelected()){t.push(e.data.Name)}}));return t}},{key:"getSerializedRobots",value:function e(){var t=[];babelHelpers.classPrivateFieldGet(this,ri).forEach((function(e){return t.push(e.serialize())}));return t}},{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,li).ID}},{key:"getStatusId",value:function e(){return babelHelpers.classPrivateFieldGet(this,li).DOCUMENT_STATUS}},{key:"getStatus",value:function e(){var t=this;return babelHelpers.classPrivateFieldGet(this,qt).document.statusList.find((function(e){return String(e.STATUS_ID)===t.getStatusId()}))}},{key:"getTemplateId",value:function e(){var t=parseInt(babelHelpers.classPrivateFieldGet(this,li).ID);return!isNaN(t)?t:0}},{key:"initButtons",value:function e(){if(this.isExternalModified()){this.createExternalLocker()}else if(babelHelpers.classPrivateFieldGet(this,ei).isEdit()&&this.getTemplateId()>0){this.createConstantsEditButton();this.createParametersEditButton();this.createExternalEditTemplateButton();this.createManageModeButton()}}},{key:"enableManageMode",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,ai)){babelHelpers.classPrivateFieldSet(this,ei,G.manage().setProperty("isActive",t));if(t){n.Dom.addClass(babelHelpers.classPrivateFieldGet(this,ai),"--multiselect-mode")}if(this.isExternalModified()){n.Dom.addClass(babelHelpers.classPrivateFieldGet(this,ai),"--locked-node")}else{babelHelpers.classPrivateFieldGet(this,ri).forEach((function(e){return e.enableManageMode(t)}))}}}},{key:"disableManageMode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,ai)){babelHelpers.classPrivateFieldSet(this,ei,G.edit());n.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,ai),"--multiselect-mode");if(this.isExternalModified()){n.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,ai),"--locked-node")}else{babelHelpers.classPrivateFieldGet(this,ri).forEach((function(e){return e.disableManageMode()}))}babelHelpers.classPrivateFieldGet(this,ii).querySelectorAll(".bizproc-automation-robot-container-wrapper").forEach((function(e){n.Dom.addClass(e,"bizproc-automation-robot-container-wrapper-draggable")}))}}},{key:"enableDragAndDrop",value:function e(){babelHelpers.classPrivateFieldGet(this,ri).forEach((function(e){return e.registerItem(e.node)}));babelHelpers.classPrivateFieldGet(this,ii).querySelectorAll(".bizproc-automation-robot-container-wrapper").forEach((function(e){n.Dom.addClass(e,"bizproc-automation-robot-container-wrapper-draggable")}))}},{key:"disableDragAndDrop",value:function e(){babelHelpers.classPrivateFieldGet(this,ri).forEach((function(e){return e.unregisterItem(e.node)}));babelHelpers.classPrivateFieldGet(this,ii).querySelectorAll(".bizproc-automation-robot-container-wrapper").forEach((function(e){n.Dom.removeClass(e,"bizproc-automation-robot-container-wrapper-draggable")}))}},{key:"createExternalEditTemplateButton",value:function e(){if(n.Type.isNil(babelHelpers.classPrivateFieldGet(this,qt).bizprocEditorUrl)){return false}var t=this;var i=n.Dom.create("a",{text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EXTERNAL_EDIT"),props:{href:"#"},events:{click:function e(i){i.preventDefault();if(!babelHelpers.classPrivateFieldGet(t,ei).isManage()){t.onExternalEditTemplateButtonClick(this)}}},attrs:{className:"bizproc-automation-robot-btn-set",target:"_top"}});if(!babelHelpers.classPrivateFieldGet(this,qt).bizprocEditorUrl.length){n.Dom.addClass(i,"bizproc-automation-robot-btn-set-locked")}babelHelpers.classPrivateFieldGet(this,si).appendChild(i)}},{key:"createManageModeButton",value:function e(){var t=this;if(!babelHelpers.classPrivateFieldGet(this,qt).canManage){return}var i=n.Dom.create("a",{text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MANAGE_ROBOTS"),attrs:{className:"bizproc-automation-robot-btn-set",target:"_top"},style:{cursor:"pointer"},events:{click:function e(a){a.preventDefault();t.onManageModeButtonClick(i)}}});babelHelpers.classPrivateFieldGet(this,si).appendChild(i)}},{key:"onManageModeButtonClick",value:function e(t){if(!this.canEdit()){J.showNoPermissionsHint(t)}else{this.emit("Template:enableManageMode",{documentStatus:babelHelpers.classPrivateFieldGet(this,li).DOCUMENT_STATUS})}}},{key:"createConstantsEditButton",value:function e(){if(n.Type.isNil(babelHelpers.classPrivateFieldGet(this,qt).constantsEditorUrl)){return false}var t=!babelHelpers.classPrivateFieldGet(this,ei).isManage()?babelHelpers.classPrivateFieldGet(this,qt).constantsEditorUrl.replace("#ID#",this.getTemplateId()):"#";if(!t.length){return false}var i=n.Dom.create("a",{text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CONSTANTS_EDIT"),props:{href:t},attrs:{className:"bizproc-automation-robot-btn-set"}});babelHelpers.classPrivateFieldGet(this,si).appendChild(i)}},{key:"createParametersEditButton",value:function e(){if(n.Type.isNil(babelHelpers.classPrivateFieldGet(this,qt).parametersEditorUrl)){return false}var t=babelHelpers.classPrivateFieldGet(this,qt).parametersEditorUrl.replace("#ID#",this.getTemplateId());if(!t.length||babelHelpers.classPrivateFieldGet(this,ei).isManage()){return false}var i=n.Dom.create("a",{text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_PARAMETERS_EDIT"),props:{href:t},attrs:{className:"bizproc-automation-robot-btn-set"}});babelHelpers.classPrivateFieldGet(this,si).appendChild(i)}},{key:"createExternalLocker",value:function e(){var t=n.Dom.create("div",{attrs:{className:"bizproc-automation-robot-container"},children:[n.Dom.create("div",{attrs:{className:"bizproc-automation-robot-container-wrapper bizproc-automation-robot-container-wrapper-lock"},children:[n.Dom.create("div",{attrs:{className:"bizproc-automation-robot-deadline"}}),n.Dom.create("div",{attrs:{className:"bizproc-automation-robot-title"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EXTERNAL_EDIT_TEXT")})]})]});if(babelHelpers.classPrivateFieldGet(this,ei).isEdit()){var i=n.Dom.create("div",{attrs:{className:"bizproc-automation-robot-btn-settings"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EDIT")});var a=this;n.Event.bind(t,"click",(function(e){e.stopPropagation();if(!babelHelpers.classPrivateFieldGet(a,ei).isManage()){a.onExternalEditTemplateButtonClick(this)}}));t.appendChild(i);var s=n.Dom.create("SPAN",{attrs:{className:"bizproc-automation-robot-btn-delete"}});n.Event.bind(s,"click",(function(e){e.stopPropagation();if(!babelHelpers.classPrivateFieldGet(a,ei).isManage()){a.onUnsetExternalModifiedClick(this)}}));t.lastChild.appendChild(s)}babelHelpers.classPrivateFieldGet(this,ai).appendChild(t);babelHelpers.classPrivateFieldSet(this,ii,t)}},{key:"onSearch",value:function e(t){if(this.isExternalModified()){this.onExternalModifiedSearch(t)}else{babelHelpers.classPrivateFieldGet(this,ri).forEach((function(e){return e.onSearch(t)}))}}},{key:"onExternalModifiedSearch",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,ii)){var i=t.getData().queryString;BX[!i?"removeClass":"addClass"](babelHelpers.classPrivateFieldGet(this,ii),"--search-mismatch")}}},{key:"onExternalEditTemplateButtonClick",value:function e(t){if(!this.canEdit()){J.showNoPermissionsHint(t);return}if(!babelHelpers.classPrivateFieldGet(this,qt).bizprocEditorUrl.length){if(top.BX.UI&&top.BX.UI.InfoHelper){top.BX.UI.InfoHelper.show("limit_office_bp_designer")}return}var i=this.getTemplateId();if(i>0){this.openBizprocEditor(i)}}},{key:"onUnsetExternalModifiedClick",value:function e(t){babelHelpers.classPrivateFieldSet(this,ii,null);this.markExternalModified(false);this.markModified();this.reInit(null,babelHelpers.classPrivateFieldGet(this,ei).intoRaw())}},{key:"openBizprocEditor",value:function e(t){top.window.location.href=babelHelpers.classPrivateFieldGet(this,qt).bizprocEditorUrl.replace("#ID#",t)}},{key:"addRobot",value:function e(t,i){var a=new Bt({document:babelHelpers.classPrivateFieldGet(this,qt).document,template:this,isFrameMode:babelHelpers.classPrivateFieldGet(this,qt).get("isFrameMode"),tracker:babelHelpers.classPrivateFieldGet(this,Qt)});var s={Type:t["CLASS"],Properties:{Title:t["NAME"]},DialogContext:t["DIALOG_CONTEXT"]};if(babelHelpers.classPrivateFieldGet(this,ri).length>0){var r=babelHelpers.classPrivateFieldGet(this,ri)[babelHelpers.classPrivateFieldGet(this,ri).length-1];if(!r.getDelayInterval().isNow()||r.isExecuteAfterPrevious()){s["Delay"]=r.getDelayInterval().serialize();s["ExecuteAfterPrevious"]=1}}a.draft=true;a.init(s,babelHelpers.classPrivateFieldGet(this,ei));this.insertRobot(a);this.insertRobotNode(a.node);this.emit("Template:robot:add",{robot:a});if(i){i.call(this,a)}}},{key:"insertRobot",value:function e(t,i){if(i){for(var a=0;a<babelHelpers.classPrivateFieldGet(this,ri).length;++a){if(babelHelpers.classPrivateFieldGet(this,ri)[a]!==i){continue}babelHelpers.classPrivateFieldGet(this,ri).splice(a,0,t);break}}else{babelHelpers.classPrivateFieldGet(this,ri).push(t)}this.markModified()}},{key:"getNextRobot",value:function e(t){for(var i=0;i<babelHelpers.classPrivateFieldGet(this,ri).length;++i){if(babelHelpers.classPrivateFieldGet(this,ri)[i]===t){return babelHelpers.classPrivateFieldGet(this,ri)[i+1]||null}}return null}},{key:"deleteRobot",value:function e(t,i){for(var a=0;a<babelHelpers.classPrivateFieldGet(this,ri).length;++a){if(babelHelpers.classPrivateFieldGet(this,ri)[a].isEqual(t)){babelHelpers.classPrivateFieldGet(this,ri).splice(a,1);break}}if(i){i(t)}this.markModified()}},{key:"insertRobotNode",value:function e(t,i){if(i){babelHelpers.classPrivateFieldGet(this,ai).insertBefore(t,i)}else{babelHelpers.classPrivateFieldGet(this,ai).appendChild(t)}}},{key:"openRobotSettingsDialog",value:function e(t,i,a){var r=this;if(!n.Type.isPlainObject(i)){i={}}if(s.Designer.getInstance().getRobotSettingsDialog()){if(i.changeRobot){s.Designer.getInstance().getRobotSettingsDialog().popup.close()}else{return}}var l="bizproc_automation_robot_dialog";var o=n.Dom.create("form",{props:{name:l}});s.Designer.getInstance().setRobotSettingsDialog({template:this,context:i,robot:t,form:o});o.appendChild(this.renderDelaySettings(t));o.appendChild(this.renderConditionSettings(t));if(t.hasBrokenLink()){o.appendChild(this.renderBrokenLinkAlert())}var c=n.Dom.create("div",{attrs:{className:"bizproc-automation-robot-help"},events:{click:function e(t){return r.emit("Template:help:show",t)}}});o.appendChild(c);i["DOCUMENT_CATEGORY_ID"]=babelHelpers.classPrivateFieldGet(this,qt).document.getCategoryId();BX.ajax({method:"POST",dataType:"html",url:n.Uri.addParam(babelHelpers.classPrivateFieldGet(this,qt).ajaxUrl,{analyticsLabel:"automation_robot".concat(t.draft?"_draft":"","_settings_").concat(t.data.Type.toLowerCase())}),data:{ajax_action:"get_robot_dialog",document_signed:babelHelpers.classPrivateFieldGet(this,qt).signedDocument,document_status:babelHelpers.classPrivateFieldGet(this,qt).document.getCurrentStatusId(),context:i,robot_json:ne.toJsonString(t.serialize()),form_name:l},onsuccess:function e(i){if(i){var s=n.Dom.create("div",{html:i});o.appendChild(s)}r.showRobotSettingsPopup(t,o,a)}})}},{key:"showRobotSettingsPopup",value:function e(t,i,a){var r=this;var l=580;var o=l;if(babelHelpers.classPrivateFieldGet(this,$t)){this.emit("Template:robot:showSettings");o=parseInt(babelHelpers.classPrivateFieldGet(this,$t).get("defaults","robot_settings_popup_width",580))}this.initRobotSettingsControls(t,i);if(t.data.Type==="CrmSendEmailActivity"||t.data.Type==="MailActivity"||t.data.Type==="RpaApproveActivity"){l+=170;if(o<l){o=l}}var c=t.hasTitle()?t.getTitle():n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_SETTINGS_TITLE");var u=this;var p=new BX.PopupWindow(ne.generateUniqueId(),null,{titleBar:c,content:i,closeIcon:true,width:o,resizable:{minWidth:l,minHeight:100},offsetLeft:0,offsetTop:0,closeByEsc:true,draggable:{restrict:false},events:{onPopupClose:function e(t){s.Designer.getInstance().setRobotSettingsDialog(null);r.destroyRobotSettingsControls();t.destroy();r.emit("Template:robot:closeSettings")},onPopupResize:function e(){r.onResizeRobotSettings()},onPopupResizeEnd:function e(){if(babelHelpers.classPrivateFieldGet(u,$t)){babelHelpers.classPrivateFieldGet(u,$t).set("defaults","robot_settings_popup_width",this.getWidth())}}},buttons:[new BX.PopupWindowButton({text:n.Loc.getMessage("JS_CORE_WINDOW_SAVE"),className:"popup-window-button-accept",events:{click:function e(){var s=t.draft;u.saveRobotSettings(i,t,BX.delegate((function(){this.popupWindow.close();if(s){u.emit("Template:robot:add",{robot:t})}if(a){a(t)}}),this),this.buttonNode)}}}),new BX.PopupWindowButtonLink({text:n.Loc.getMessage("JS_CORE_WINDOW_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function e(){this.popupWindow.close()}}})]});s.Designer.getInstance().getRobotSettingsDialog().popup=p;p.show()}},{key:"initRobotSettingsControls",value:function e(t,i){if(!n.Type.isArray(this.robotSettingsControls)){this.robotSettingsControls=[]}var a=i.querySelectorAll("[data-role]");for(var s=0;s<a.length;++s){this.initRobotSettingsControl(t,a[s])}}},{key:"initRobotSettingsControl",value:function e(t,i){var a=this;if(!n.Type.isArray(this.robotSettingsControls)){this.robotSettingsControls=[]}var r=i.getAttribute("data-role");var l={context:new s.SelectorContext({fields:n.Runtime.clone(babelHelpers.classPrivateFieldGet(this,qt).document.getFields()),useSwitcherMenu:babelHelpers.classPrivateFieldGet(this,qt).get("showTemplatePropertiesMenuOnSelecting"),rootGroupTitle:babelHelpers.classPrivateFieldGet(this,qt).document.title,userOptions:babelHelpers.classPrivateFieldGet(this,qt).userOptions}),needSync:t.draft,checkbox:i};if(r===s.SelectorManager.SELECTOR_ROLE_USER){var o=JSON.parse(i.getAttribute("data-property"));l.context.set("additionalUserFields",Kt(this,ni,pi).call(this,o))}else if(r===s.SelectorManager.SELECTOR_ROLE_FILE){this.robots.forEach((function(e){var t;(t=l.context.fields).push.apply(t,babelHelpers.toConsumableArray(e.getReturnFieldsDescription().filter((function(e){return e["Type"]==="file"})).map((function(t){return{Id:"{{~".concat(e.getId(),":").concat(t["Id"],"}}"),Name:"".concat(e.getTitle(),": ").concat(t["Name"]),Type:"file",Expression:"{{~".concat(e.getId(),":").concat(t["Id"],"}}")}}))))}))}var c=s.SelectorManager.createSelectorByRole(r,l);if(c&&r!==s.SelectorManager.SELECTOR_ROLE_SAVE_STATE){c.renderTo(i);c.subscribe("onAskConstant",(function(e){var t=e.getData(),i=t.fieldProperty;c.onFieldSelect(a.addConstant(i))}));c.subscribe("onAskParameter",(function(e){var t=e.getData(),i=t.fieldProperty;c.onFieldSelect(a.addParameter(i))}));c.subscribe("onOpenFieldMenu",(function(e){return a.onOpenMenu(e,t)}));c.subscribe("onOpenMenu",(function(e){return a.onOpenMenu(e,t)}))}BX.UI.Hint.init(i);if(c){this.robotSettingsControls.push(c)}}},{key:"destroyRobotSettingsControls",value:function e(){if(this.conditionSelector){this.conditionSelector.destroy();this.conditionSelector=null}if(n.Type.isArray(this.robotSettingsControls)){for(var t=0;t<this.robotSettingsControls.length;++t){if(n.Type.isFunction(this.robotSettingsControls[t].destroy)){this.robotSettingsControls[t].destroy()}}}this.robotSettingsControls=null}},{key:"onBeforeSaveRobotSettings",value:function e(){if(n.Type.isArray(this.robotSettingsControls)){for(var t=0;t<this.robotSettingsControls.length;++t){if(n.Type.isFunction(this.robotSettingsControls[t].onBeforeSave)){this.robotSettingsControls[t].onBeforeSave()}}}}},{key:"onResizeRobotSettings",value:function e(){if(n.Type.isArray(this.robotSettingsControls)){for(var t=0;t<this.robotSettingsControls.length;++t){if(n.Type.isFunction(this.robotSettingsControls[t].onPopupResize)){this.robotSettingsControls[t].onPopupResize()}}}}},{key:"renderDelaySettings",value:function e(t){var i=t.getDelayInterval().clone();var a=ne.generateUniqueId();var r=n.Dom.create("input",{attrs:{type:"hidden",name:"delay_type",value:i.type}});var l=n.Dom.create("input",{attrs:{type:"hidden",name:"delay_value",value:i.value}});var o=n.Dom.create("input",{attrs:{type:"hidden",name:"delay_value_type",value:i.valueType}});var c=n.Dom.create("input",{attrs:{type:"hidden",name:"delay_basis",value:i.basis}});var u=n.Dom.create("input",{attrs:{type:"hidden",name:"delay_worktime",value:i.workTime?1:0}});var p=n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis"}});var b=[];var d=babelHelpers.classPrivateFieldGet(this,qt).document.getFields();var v=babelHelpers.classPrivateFieldGet(this,Jt);if(n.Type.isArray(d)){for(var h=0;h<d.length;++h){var f=d[h];if(f["Type"]=="date"||f["Type"]=="datetime"){b.push(f)}}}var g=new s.DelayIntervalSelector({labelNode:p,onchange:function e(t){r.value=t.type;l.value=t.value;o.value=t.valueType;c.value=t.basis;u.value=t.workTime?1:0},basisFields:b,minLimitM:v,useAfterBasis:true});var m=null;if(t.hasTemplate()){var T=n.Dom.create("input",{attrs:{type:"checkbox",id:"param-group-3-1"+a,name:"execute_after_previous",value:"1",style:"vertical-align: middle"}});if(t.isExecuteAfterPrevious()){T.setAttribute("checked","checked")}m=n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-block"},children:[T,n.Dom.create("label",{attrs:{for:"param-group-3-1"+a,style:"color: #535C69"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AFTER_PREVIOUS_WIDE")})]})}var P=n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings bizproc-automation-popup-settings-flex"},children:[n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-block bizproc-automation-popup-settings-block-flex"},children:[n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title-wrapper"},children:[r,l,o,c,u,n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-left"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TO_EXECUTE")+":"}),p]})]}),m]});g.init(i);return P}},{key:"setDelaySettingsFromForm",value:function e(t,i){var a=new Ye;a.setType(t["delay_type"]);a.setValue(t["delay_value"]);a.setValueType(t["delay_value_type"]);a.setBasis(t["delay_basis"]);a.setWorkTime(t["delay_worktime"]==="1");i.setDelayInterval(a);if(i.hasTemplate()){i.setExecuteAfterPrevious(t["execute_after_previous"]&&t["execute_after_previous"]==="1")}return this}},{key:"renderConditionSettings",value:function e(t){var i=this;var a=t.getCondition();this.conditionSelector=new s.ConditionGroupSelector(a,{fields:babelHelpers.classPrivateFieldGet(this,qt).document.getFields(),onOpenFieldMenu:function e(a){return i.onOpenMenu(a,t)},onOpenMenu:function e(a){return i.onOpenMenu(a,t)}});return n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-block"},children:[n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION")+":"}),this.conditionSelector.createNode()]})]})}},{key:"onOpenMenu",value:function e(t,i){Kt(this,oi,bi).call(this,t,i);this.emit("Template:onSelectorMenuOpen",Yt({template:this,robot:i},t.getData()))}},{key:"setConditionSettingsFromForm",value:function e(t,i){i.setCondition(s.ConditionGroup.createFromForm(t));return this}},{key:"renderBrokenLinkAlert",value:function e(){var t=n.Dom.create("div",{attrs:{className:"ui-alert ui-alert-warning ui-alert-icon-info ui-alert-xs"}});var i=n.Dom.create("span",{attrs:{className:"ui-alert-message"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_BROKEN_LINK_MESSAGE_ERROR")});t.appendChild(i);t.appendChild(n.Dom.create("span",{attrs:{className:"ui-alert-close-btn"},events:{click:function e(){t.style.display="none"}}}));return t}},{key:"saveRobotSettings",value:function e(t,i,a,s){var r=this;if(s){s.classList.add("popup-window-button-wait")}this.onBeforeSaveRobotSettings();var l=BX.ajax.prepareForm(t);var o=babelHelpers.classPrivateFieldGet(this,qt).ajaxUrl;var c=babelHelpers.classPrivateFieldGet(this,qt).signedDocument;BX.ajax({method:"POST",dataType:"json",url:n.Uri.addParam(o,{analyticsLabel:"automation_robot".concat(i.draft?"_draft":"","_save_").concat(i.data.Type.toLowerCase())}),data:{ajax_action:"save_robot_settings",document_signed:c,robot_json:ne.toJsonString(i.serialize()),form_data_json:ne.toJsonString(l["data"]),form_data:l["data"]},onsuccess:function e(t){if(s){s.classList.remove("popup-window-button-wait")}if(t.SUCCESS){i.updateData(t.DATA.robot);r.setDelaySettingsFromForm(l["data"],i);r.setConditionSettingsFromForm(l["data"],i);if(i.draft);i.draft=false;i.reInit();r.markModified();if(a){a(t.DATA)}}else{alert(t.ERRORS[0])}}})}},{key:"serialize",value:function e(){var t=BX.clone(babelHelpers.classPrivateFieldGet(this,li));t["IS_EXTERNAL_MODIFIED"]=this.isExternalModified()?1:0;t["ROBOTS"]=[];for(var i=0;i<babelHelpers.classPrivateFieldGet(this,ri).length;++i){t["ROBOTS"].push(babelHelpers.classPrivateFieldGet(this,ri)[i].serialize())}return t}},{key:"isExternalModified",value:function e(){return this.externalModified===true}},{key:"markExternalModified",value:function e(t){this.externalModified=t!==false}},{key:"getRobotById",value:function e(t){return babelHelpers.classPrivateFieldGet(this,ri).find((function(e){return e.getId()===t}))}},{key:"isModified",value:function e(){return this.modified}},{key:"markModified",value:function e(t){this.modified=t!==false;if(this.modified){this.emit("Template:modified")}}},{key:"getConstants",value:function e(){var t=this;var i=[];Object.keys(babelHelpers.classPrivateFieldGet(this,li).CONSTANTS).forEach((function(e){var a=BX.clone(babelHelpers.classPrivateFieldGet(t,li).CONSTANTS[e]);a.Id=e;a.ObjectId="Constant";a.SystemExpression="{=Constant:"+e+"}";a.Expression="{{~&:"+e+"}}";i.push(a)}));return i}},{key:"getConstant",value:function e(t){var i=this.getConstants();for(var a=0;a<i.length;++a){if(i[a].Id===t){return i[a]}}return null}},{key:"addConstant",value:function e(t){var i=t.Id||this.generatePropertyId("Constant",babelHelpers.classPrivateFieldGet(this,li).CONSTANTS);if(babelHelpers.classPrivateFieldGet(this,li).CONSTANTS[i]){throw'Constant with id "'.concat(i,'" is already exists')}babelHelpers.classPrivateFieldGet(this,li).CONSTANTS[i]=t;this.emit("Template:constant:add");return this.getConstant(i)}},{key:"updateConstant",value:function e(t,i){if(!babelHelpers.classPrivateFieldGet(this,li).CONSTANTS[t]){throw'Constant with id "'.concat(t,'" does not exists')}babelHelpers.classPrivateFieldGet(this,li).CONSTANTS[t].Description=i.Description;this.emit("Template:constant:update",{constant:this.getConstant(t)});return this.getConstant(t)}},{key:"deleteConstant",value:function e(t){delete babelHelpers.classPrivateFieldGet(this,li).CONSTANTS[t];return true}},{key:"setConstantValue",value:function e(t,i){if(babelHelpers.classPrivateFieldGet(this,li).CONSTANTS[t]){babelHelpers.classPrivateFieldGet(this,li).CONSTANTS[t]["Default"]=i;return true}return false}},{key:"getParameters",value:function e(){var t=this;var i=[];Object.keys(babelHelpers.classPrivateFieldGet(this,li).PARAMETERS).forEach((function(e){var a=BX.clone(babelHelpers.classPrivateFieldGet(t,li).PARAMETERS[e]);a.Id=e;a.ObjectId="Template";a.SystemExpression="{=Template:"+e+"}";a.Expression="{{~*:"+e+"}}";i.push(a)}));return i}},{key:"getParameter",value:function e(t){var i=this.getParameters();for(var a=0;a<i.length;++a){if(i[a].Id===t){return i[a]}}return null}},{key:"addParameter",value:function e(t){var i=t.Id||this.generatePropertyId("Parameter",babelHelpers.classPrivateFieldGet(this,li).PARAMETERS);if(babelHelpers.classPrivateFieldGet(this,li).PARAMETERS[i]){throw'Parameter with id "'.concat(i,'" is already exists')}babelHelpers.classPrivateFieldGet(this,li).PARAMETERS[i]=t;this.emit("Template:parameter:add",{parameter:this.getParameter(i)});return this.getParameter(i)}},{key:"updateParameter",value:function e(t,i){if(!babelHelpers.classPrivateFieldGet(this,li).PARAMETERS[t]){throw'Parameter with id "'.concat(t,'" does not exists')}babelHelpers.classPrivateFieldGet(this,li).PARAMETERS[t].Description=i.Description;this.emit("Template:parameter:update",{parameter:this.getParameter(t)});return this.getParameter(t)}},{key:"deleteParameter",value:function e(t){delete babelHelpers.classPrivateFieldGet(this,li).PARAMETERS[t];return true}},{key:"setParameterValue",value:function e(t,i){if(babelHelpers.classPrivateFieldGet(this,li).PARAMETERS[t]){babelHelpers.classPrivateFieldGet(this,li).PARAMETERS[t]["Default"]=i;return true}return false}},{key:"getVariables",value:function e(){var t=this;var i=[];Object.keys(babelHelpers.classPrivateFieldGet(this,li).VARIABLES).forEach((function(e){var a=BX.clone(babelHelpers.classPrivateFieldGet(t,li).VARIABLES[e]);a.Id=e;a.ObjectId="Variable";a.SystemExpression="{=Variable:"+e+"}";a.Expression="{=Variable:"+e+"}";i.push(a)}));return i}},{key:"generatePropertyId",value:function e(t,i){var a;for(a=1;a<=1e3;++a){if(!i[t+a]){break}}return t+a}},{key:"collectUsages",value:function e(){var t={Document:new Set,Constant:new Set,Variable:new Set,Parameter:new Set,GlobalConstant:new Set,GlobalVariable:new Set,Activity:new Set};babelHelpers.classPrivateFieldGet(this,ri).forEach((function(e){var i=e.collectUsages();Object.keys(t).forEach((function(e){i[e].forEach((function(i){if(!t[e].has(i)){t[e].add(i)}}))}))}));return t}},{key:"subscribeRobotEvents",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,ri).forEach((function(e){return e.subscribe(t,i)}));return this}},{key:"unsubscribeRobotEvents",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,ri).forEach((function(e){return e.unsubscribe(t,i)}));return this}},{key:"getRobotDescription",value:function e(t){return babelHelpers.classPrivateFieldGet(this,qt).availableRobots.find((function(e){return e["CLASS"]===t}))}},{key:"setGlobalVariables",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];this.globalVariables=t;return this}},{key:"setGlobalConstants",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];this.globalConstants=t;return this}},{key:"robots",get:function e(){return babelHelpers.classPrivateFieldGet(this,ri)}},{key:"userOptions",get:function e(){return babelHelpers.classPrivateFieldGet(this,$t)}}],[{key:"copyRobotTo",value:function e(t,i,a){var s=i.copyTo(t,a);t.emit("Template:robot:add",{robot:s})}}]);return t}(a.EventEmitter);function pi(e){var t=Kt(this,ci,di).call(this).map((function(e){return e.getReturnFieldsDescription().filter((function(e){return e["Type"]==="user"})).map((function(t){return{id:"{{~".concat(e.getId(),":").concat(t["Id"],"}}"),title:"".concat(e.getTitle(),": ").concat(t["Name"])}}))})).flat();if(babelHelpers.classPrivateFieldGet(this,qt).get("showTemplatePropertiesMenuOnSelecting")&&e){var i=this.addConstant(n.Runtime.clone(e));t.push({id:i.Expression,title:n.Loc.getMessage("BIZPROC_AUTOMATION_ASK_CONSTANT"),tabs:["recents","bpuserroles"],sort:1});var a=this.addParameter(n.Runtime.clone(e));t.push({id:a.Expression,title:n.Loc.getMessage("BIZPROC_AUTOMATION_ASK_PARAMETER"),tabs:["recents","bpuserroles"],sort:2})}return t}function bi(e,t){var i=e.getData().selector;var a=e.getData().isMixedCondition;if(n.Type.isBoolean(a)&&!a){return}var s=Kt(this,ci,di).call(this,t).map((function(e){return{id:e.getId(),title:e.getTitle(),children:e.getReturnFieldsDescription().map((function(e){return{id:e.Expression,title:e.Name,customData:{field:e}}}))}}));if(s.length>0){i.addGroup("__RESULT",{id:"__RESULT",title:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ROBOT_LIST"),children:s})}}function di(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:undefined;var t=(e===null||e===void 0?void 0:e.getId())||"";return this.robots.filter((function(e){return e.getId()!==t&&e.hasReturnFields()}))}function vi(e,t,i){hi(e,t);t.set(e,i)}function hi(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var fi=new WeakMap;var gi=new WeakMap;var mi=new WeakMap;var Ti=new WeakMap;var Pi=function(){function e(t,i){babelHelpers.classCallCheck(this,e);vi(this,fi,{writable:true,value:void 0});vi(this,gi,{writable:true,value:void 0});vi(this,mi,{writable:true,value:void 0});vi(this,Ti,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,fi,"Document");babelHelpers.classPrivateFieldSet(this,gi,"");babelHelpers.classPrivateFieldSet(this,mi,"!empty");babelHelpers.classPrivateFieldSet(this,Ti,"");this.parentGroup=null;if(n.Type.isPlainObject(t)){if(t["object"]){this.setObject(t["object"])}if(t["field"]){this.setField(t["field"])}if(t["operator"]){this.setOperator(t["operator"])}if("value"in t){this.setValue(t["value"])}}if(i){this.parentGroup=i}}babelHelpers.createClass(e,[{key:"clone",value:function t(){return new e({object:babelHelpers.classPrivateFieldGet(this,fi),field:babelHelpers.classPrivateFieldGet(this,gi),operator:babelHelpers.classPrivateFieldGet(this,mi),value:babelHelpers.classPrivateFieldGet(this,Ti)},this.parentGroup)}},{key:"setObject",value:function e(t){if(n.Type.isStringFilled(t)){babelHelpers.classPrivateFieldSet(this,fi,t)}}},{key:"setField",value:function e(t){if(n.Type.isStringFilled(t)){babelHelpers.classPrivateFieldSet(this,gi,t)}}},{key:"setOperator",value:function e(t){if(!t){t="="}babelHelpers.classPrivateFieldSet(this,mi,t)}},{key:"setValue",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ti,t);if(babelHelpers.classPrivateFieldGet(this,mi)==="="&&babelHelpers.classPrivateFieldGet(this,Ti)===""){babelHelpers.classPrivateFieldSet(this,mi,"empty")}else if(babelHelpers.classPrivateFieldGet(this,mi)==="!="&&babelHelpers.classPrivateFieldGet(this,Ti)===""){babelHelpers.classPrivateFieldSet(this,mi,"!empty")}}},{key:"serialize",value:function e(){return{object:babelHelpers.classPrivateFieldGet(this,fi),field:babelHelpers.classPrivateFieldGet(this,gi),operator:babelHelpers.classPrivateFieldGet(this,mi),value:babelHelpers.classPrivateFieldGet(this,Ti)}}},{key:"object",get:function e(){return babelHelpers.classPrivateFieldGet(this,fi)}},{key:"field",get:function e(){return babelHelpers.classPrivateFieldGet(this,gi)}},{key:"operator",get:function e(){return babelHelpers.classPrivateFieldGet(this,mi)}},{key:"value",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ti)}}]);return e}();function yi(e,t,i){Hi(e,t);t.set(e,i)}function Hi(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Ii=new WeakMap;var Oi=new WeakMap;var Ei=function(){function e(t){var i=this;babelHelpers.classCallCheck(this,e);yi(this,Ii,{writable:true,value:void 0});yi(this,Oi,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Ii,e.CONDITION_TYPE.Field);babelHelpers.classPrivateFieldSet(this,Oi,[]);if(n.Type.isPlainObject(t)){if(t["type"]){babelHelpers.classPrivateFieldSet(this,Ii,t["type"])}if(n.Type.isArray(t["items"])){t["items"].forEach((function(e){var t=new Pi(e[0],i);i.addItem(t,e[1])}))}}}babelHelpers.createClass(e,[{key:"clone",value:function t(){var i=new e({type:babelHelpers.classPrivateFieldGet(this,Ii)});babelHelpers.classPrivateFieldGet(this,Oi).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),a=t[0],s=t[1];var r=a.clone();r.parentGroup=i;i.addItem(r,s)}));return i}},{key:"addItem",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,Oi).push([t,i])}},{key:"getItems",value:function e(){return babelHelpers.classPrivateFieldGet(this,Oi)}},{key:"serialize",value:function e(){var t=[];babelHelpers.classPrivateFieldGet(this,Oi).forEach((function(e){if(e.field!==""){t.push([e[0].serialize(),e[1]])}}));return{type:babelHelpers.classPrivateFieldGet(this,Ii),items:t}}},{key:"type",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ii)},set:function t(i){if(Object.values(e.CONDITION_TYPE).includes(i)){babelHelpers.classPrivateFieldSet(this,Ii,i)}return this}},{key:"items",get:function e(){return babelHelpers.classPrivateFieldGet(this,Oi)}}],[{key:"createFromForm",value:function t(i,a){var s=new e;if(!a){a="condition_"}if(n.Type.isArray(i[a+"field"])){for(var r=0;r<i[a+"field"].length;++r){if(i[a+"field"][r]===""){continue}var l=new Pi({},s);l.setObject(i[a+"object"][r]);l.setField(i[a+"field"][r]);l.setOperator(i[a+"operator"][r]);l.setValue(i[a+"value"][r]);var o=e.JOINER.And;if(i[a+"joiner"]&&i[a+"joiner"][r]===e.JOINER.Or){o=e.JOINER.Or}s.addItem(l,o)}}return s}}]);return e}();babelHelpers.defineProperty(Ei,"CONDITION_TYPE",{Field:"field",Mixed:"mixed"});babelHelpers.defineProperty(Ei,"JOINER",{And:"AND",Or:"OR",message:function e(t){if(t===this.Or){return n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_OR")}return n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_AND")}});function Fi(e,t,i){Ci(e,t);t.set(e,i)}function Ci(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var _i=new WeakMap;var Si=new WeakMap;var Ai=new WeakMap;var ki=new WeakMap;var Ni=new WeakMap;var wi=new WeakMap;var Gi=new WeakMap;var Mi=function(){function e(t,i){babelHelpers.classCallCheck(this,e);Fi(this,_i,{writable:true,value:void 0});Fi(this,Si,{writable:true,value:void 0});Fi(this,Ai,{writable:true,value:void 0});Fi(this,ki,{writable:true,value:void 0});Fi(this,Ni,{writable:true,value:void 0});Fi(this,wi,{writable:true,value:void 0});Fi(this,Gi,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,_i,t);babelHelpers.classPrivateFieldSet(this,Si,[]);babelHelpers.classPrivateFieldSet(this,Ai,s.ConditionGroup.JOINER.And);babelHelpers.classPrivateFieldSet(this,ki,"condition_");if(n.Type.isPlainObject(i)){if(n.Type.isArray(i.fields)){babelHelpers.classPrivateFieldSet(this,Si,i.fields.map((function(e){e.ObjectId="Document";return e})))}if(i.joiner&&i.joiner===s.ConditionGroup.JOINER.Or){babelHelpers.classPrivateFieldSet(this,Ai,s.ConditionGroup.JOINER.Or)}if(i.fieldPrefix){babelHelpers.classPrivateFieldSet(this,ki,i.fieldPrefix)}babelHelpers.classPrivateFieldSet(this,Ni,i.rootGroupTitle);babelHelpers.classPrivateFieldSet(this,wi,i.onOpenFieldMenu);babelHelpers.classPrivateFieldSet(this,Gi,i.onOpenMenu)}}babelHelpers.createClass(e,[{key:"createNode",value:function e(){var t=this.objectNode=n.Dom.create("input",{attrs:{type:"hidden",name:babelHelpers.classPrivateFieldGet(this,ki)+"object[]",value:babelHelpers.classPrivateFieldGet(this,_i).object}});var i=this.fieldNode=n.Dom.create("input",{attrs:{type:"hidden",name:babelHelpers.classPrivateFieldGet(this,ki)+"field[]",value:babelHelpers.classPrivateFieldGet(this,_i).field}});var a=this.operatorNode=n.Dom.create("input",{attrs:{type:"hidden",name:babelHelpers.classPrivateFieldGet(this,ki)+"operator[]",value:babelHelpers.classPrivateFieldGet(this,_i).operator}});var r=this.valueNode=n.Dom.create("input",{attrs:{type:"hidden",name:babelHelpers.classPrivateFieldGet(this,ki)+"value[]",value:babelHelpers.classPrivateFieldGet(this,_i).value}});var l=this.joinerNode=n.Dom.create("input",{attrs:{type:"hidden",name:babelHelpers.classPrivateFieldGet(this,ki)+"joiner[]",value:babelHelpers.classPrivateFieldGet(this,Ai)}});var o=this.labelNode=n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link-wrapper"}});this.setLabelText();this.bindLabelNode();var c=n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link-remove"},events:{click:this.removeCondition.bind(this)}});var u=n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link bizproc-automation-condition-joiner"},text:s.ConditionGroup.JOINER.message(babelHelpers.classPrivateFieldGet(this,Ai))});n.Event.bind(u,"click",this.changeJoiner.bind(this,u));this.node=n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link-wrapper bizproc-automation-condition-wrapper"},children:[t,i,a,r,l,o,c,u]});return this.node}},{key:"init",value:function e(t){babelHelpers.classPrivateFieldSet(this,_i,t);this.setLabelText();this.bindLabelNode()}},{key:"setLabelText",value:function e(){if(!this.labelNode||!babelHelpers.classPrivateFieldGet(this,_i)){return}n.Dom.clean(this.labelNode);if(babelHelpers.classPrivateFieldGet(this,_i).field!==""){var t=this.getField(babelHelpers.classPrivateFieldGet(this,_i).object,babelHelpers.classPrivateFieldGet(this,_i).field)||"?";var i=babelHelpers.classPrivateFieldGet(this,_i).operator.indexOf("empty")<0?BX.Bizproc.FieldType.formatValuePrintable(t,babelHelpers.classPrivateFieldGet(this,_i).value):null;this.labelNode.appendChild(n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link"},text:t.Name}));this.labelNode.appendChild(n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link"},text:this.getOperatorLabel(babelHelpers.classPrivateFieldGet(this,_i).operator)}));if(i){this.labelNode.appendChild(n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link"},text:i}))}}else{this.labelNode.appendChild(n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_EMPTY")}))}}},{key:"bindLabelNode",value:function e(){if(this.labelNode){n.Event.bind(this.labelNode,"click",this.onLabelClick.bind(this))}}},{key:"onLabelClick",value:function e(){this.showPopup()}},{key:"showPopup",value:function e(){if(this.popup){this.popup.show();return}var t=this.filterFields();var i=n.Dom.create("input",{attrs:{type:"hidden",className:"bizproc-automation-popup-settings-dropdown"}});var a=n.Dom.create("input",{attrs:{type:"hidden",className:"bizproc-automation-popup-settings-dropdown"}});var s=n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-dropdown",readonly:"readonly"},children:[a]});n.Event.bind(s,"click",this.onFieldSelectorClick.bind(this,s,a,t,i));var r=this.getField(babelHelpers.classPrivateFieldGet(this,_i).object,babelHelpers.classPrivateFieldGet(this,_i).field);if(!babelHelpers.classPrivateFieldGet(this,_i).field){r=t[0]}a.value=r.Id;i.value=r.ObjectId;s.textContent=r.Name;var l=babelHelpers.classPrivateFieldGet(this,_i).operator.indexOf("empty")<0?this.createValueNode(r,babelHelpers.classPrivateFieldGet(this,_i).value):null;var o=n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[l]});var c=this.createOperatorNode(r,o);var u=n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[c]});if(babelHelpers.classPrivateFieldGet(this,_i).field!==""){c.value=babelHelpers.classPrivateFieldGet(this,_i).operator}var p=n.Dom.create("form",{attrs:{className:"bizproc-automation-popup-select-block"},children:[n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[s]}),u,o]});n.Event.bind(a,"change",this.onFieldChange.bind(this,a,u,o,i));var b=this;this.popup=new BX.PopupWindow("bizproc-automation-popup-set",this.labelNode,{className:"bizproc-automation-popup-set",autoHide:false,closeByEsc:true,closeIcon:false,titleBar:false,angle:true,offsetLeft:45,overlay:{backgroundColor:"transparent"},content:p,buttons:[new BX.PopupWindowButton({text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CHOOSE"),className:"webform-button webform-button-create",events:{click:function e(){babelHelpers.classPrivateFieldGet(b,_i).setObject(i.value);babelHelpers.classPrivateFieldGet(b,_i).setField(a.value);babelHelpers.classPrivateFieldGet(b,_i).setOperator(u.firstChild.value);var t=o.querySelector('[name^="'+babelHelpers.classPrivateFieldGet(b,ki)+'value"]');if(t){babelHelpers.classPrivateFieldGet(b,_i).setValue(t.value)}else{babelHelpers.classPrivateFieldGet(b,_i).setValue("")}b.setLabelText();b.updateValueNode();this.popupWindow.close()}}}),new BX.PopupWindowButtonLink({text:n.Loc.getMessage("JS_CORE_WINDOW_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function e(){this.popupWindow.close()}}})],events:{onPopupClose:function e(){this.destroy();if(b.fieldDialog){b.fieldDialog.destroy();delete b.fieldDialog}delete b.popup}}});this.popup.show()}},{key:"onFieldSelectorClick",value:function e(t,i,a,r,l){if(!this.fieldDialog){var o=s.getGlobalContext();var c=n.Runtime.clone(n.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,Si))?babelHelpers.classPrivateFieldGet(this,Si):o.document.getFields());this.fieldDialog=new s.InlineSelectorCondition({context:new s.SelectorContext({fields:c,rootGroupTitle:o.document.title}),condition:babelHelpers.classPrivateFieldGet(this,_i)});if(n.Type.isFunction(babelHelpers.classPrivateFieldGet(this,wi))){this.fieldDialog.subscribe("onOpenMenu",babelHelpers.classPrivateFieldGet(this,wi))}this.fieldDialog.subscribe("change",(function(e){var a=e.getData().field;t.textContent=a.Name;i.value=a.Id;r.value=a.ObjectId;BX.fireEvent(i,"change")}));this.fieldDialog.renderTo(t)}this.fieldDialog.openMenu(l)}},{key:"updateValueNode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,_i)){if(this.objectNode){this.objectNode.value=babelHelpers.classPrivateFieldGet(this,_i).object}if(this.fieldNode){this.fieldNode.value=babelHelpers.classPrivateFieldGet(this,_i).field}if(this.operatorNode){this.operatorNode.value=babelHelpers.classPrivateFieldGet(this,_i).operator}if(this.valueNode){this.valueNode.value=babelHelpers.classPrivateFieldGet(this,_i).value}}}},{key:"onFieldChange",value:function e(t,i,a,s){var r=this.getField(s.value,t.value);var l=this.createOperatorNode(r,a);i.replaceChild(l,i.firstChild);this.onOperatorChange(l,r,a)}},{key:"onOperatorChange",value:function e(t,i,a){n.Dom.clean(a);if(t.value.indexOf("empty")<0){var s=this.createValueNode(i);a.appendChild(s)}}},{key:"getField",value:function e(t,i){var a;var r=s.Designer.getInstance().robot;var l=s.Designer.getInstance().component;var n=r?r.getTemplate():null;switch(t){case"Document":for(var o=0;o<babelHelpers.classPrivateFieldGet(this,Si).length;++o){if(i===babelHelpers.classPrivateFieldGet(this,Si)[o].Id){a=babelHelpers.classPrivateFieldGet(this,Si)[o]}}break;case"Template":if(n&&l&&l.triggerManager){a=l.triggerManager.getReturnProperty(n.getStatusId(),i)}break;case"Constant":if(n){a=n.getConstant(i)}break;case"GlobalConst":if(l){a=l.getConstant(i)}break;case"GlobalVar":if(l){a=l.getGVariable(i)}break;default:var c=n?n.getRobotById(t):null;if(c){a=c.getReturnProperty(i)}break}return a||{Id:i,ObjectId:t,Name:i,Type:"string",Expression:i,SystemExpression:"{="+t+":"+i+"}"}}},{key:"getOperators",value:function e(t,i){var a={"!empty":n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_NOT_EMPTY"),empty:n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_EMPTY"),"=":n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_EQ"),"!=":n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_NE")};switch(t){case"file":case"UF:crm":case"UF:resourcebooking":a={"!empty":n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_NOT_EMPTY"),empty:n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_EMPTY")};break;case"bool":case"select":if(i){a["contain"]=n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_CONTAIN");a["!contain"]=n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_NOT_CONTAIN")}break;case"user":a["in"]=n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_IN");a["!in"]=n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_NOT_IN");a["contain"]=n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_CONTAIN");a["!contain"]=n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_NOT_CONTAIN");break;default:a["in"]=n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_IN");a["!in"]=n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_NOT_IN");a["contain"]=n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_CONTAIN");a["!contain"]=n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_NOT_CONTAIN");a[">"]=n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_GT");a[">="]=n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_GTE");a["<"]=n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_LT");a["<="]=n.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_LTE")}return a}},{key:"getOperatorLabel",value:function e(t){return this.getOperators()[t]}},{key:"filterFields",value:function e(){var t=[];for(var i=0;i<babelHelpers.classPrivateFieldGet(this,Si).length;++i){var a=babelHelpers.classPrivateFieldGet(this,Si)[i]["Type"];if(a==="bool"||a==="date"||a==="datetime"||a==="double"||a==="file"||a==="int"||a==="select"||a==="string"||a==="text"||a==="user"||a==="UF:money"||a==="UF:crm"||a==="UF:resourcebooking"||a==="UF:url"){t.push(babelHelpers.classPrivateFieldGet(this,Si)[i])}}return t}},{key:"createValueNode",value:function e(t,i){var a=this;var r=s.Designer.getInstance().component?s.Designer.getInstance().component.document.getRawType():s.getGlobalContext().document.getRawType();var l=BX.clone(t);l.Multiple=false;var o=BX.Bizproc.FieldType.renderControlPublic(r,l,babelHelpers.classPrivateFieldGet(this,ki)+"value",i,false);o.querySelectorAll("[data-role]").forEach((function(e){var t;var i=s.SelectorManager.createSelectorByRole(e.dataset.role,{context:new s.SelectorContext({fields:s.getGlobalContext().document.getFields(),useSwitcherMenu:false,rootGroupTitle:(t=babelHelpers.classPrivateFieldGet(a,Ni))!==null&&t!==void 0?t:s.getGlobalContext().document.title})});if(i){if(n.Type.isFunction(babelHelpers.classPrivateFieldGet(a,Gi))){i.subscribe("onOpenMenu",babelHelpers.classPrivateFieldGet(a,Gi))}i.renderTo(e)}}));return o}},{key:"createOperatorNode",value:function e(t,i){var a=n.Dom.create("select",{attrs:{className:"bizproc-automation-popup-settings-dropdown"}});var s=this.getOperators(t["Type"],t["Multiple"]);for(var r in s){if(!s.hasOwnProperty(r)){continue}a.appendChild(n.Dom.create("option",{props:{value:r},text:s[r]}))}n.Event.bind(a,"change",this.onOperatorChange.bind(this,a,t,i));return a}},{key:"removeCondition",value:function e(t){babelHelpers.classPrivateFieldSet(this,_i,null);n.Dom.remove(this.node);this.labelNode=this.fieldNode=this.operatorNode=this.valueNode=this.node=null;t.stopPropagation()}},{key:"changeJoiner",value:function e(t,i){babelHelpers.classPrivateFieldSet(this,Ai,babelHelpers.classPrivateFieldGet(this,Ai)===s.ConditionGroup.JOINER.Or?s.ConditionGroup.JOINER.And:s.ConditionGroup.JOINER.Or);t.textContent=s.ConditionGroup.JOINER.message(babelHelpers.classPrivateFieldGet(this,Ai));if(this.joinerNode){this.joinerNode.value=babelHelpers.classPrivateFieldGet(this,Ai)}i.preventDefault()}},{key:"destroy",value:function e(){if(this.popup){this.popup.close()}}}]);return e}();function Di(e,t,i){Ri(e,t);t.set(e,i)}function Ri(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Li=new WeakMap;var Bi=new WeakMap;var xi=new WeakMap;var zi=new WeakMap;var Ui=new WeakMap;var Wi=new WeakMap;var ji=new WeakMap;var Yi=function(){function e(t,i){babelHelpers.classCallCheck(this,e);Di(this,Li,{writable:true,value:void 0});Di(this,Bi,{writable:true,value:void 0});Di(this,xi,{writable:true,value:void 0});Di(this,zi,{writable:true,value:void 0});Di(this,Ui,{writable:true,value:void 0});Di(this,Wi,{writable:true,value:void 0});Di(this,ji,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Li,t);babelHelpers.classPrivateFieldSet(this,Bi,[]);babelHelpers.classPrivateFieldSet(this,xi,"condition_");babelHelpers.classPrivateFieldSet(this,zi,[]);if(n.Type.isPlainObject(i)){if(n.Type.isArray(i.fields)){babelHelpers.classPrivateFieldSet(this,Bi,i.fields)}if(i.fieldPrefix){babelHelpers.classPrivateFieldSet(this,xi,i.fieldPrefix)}babelHelpers.classPrivateFieldSet(this,ji,i.rootGroupTitle);babelHelpers.classPrivateFieldSet(this,Ui,i.onOpenFieldMenu);babelHelpers.classPrivateFieldSet(this,Wi,i.onOpenMenu)}}babelHelpers.createClass(e,[{key:"createNode",value:function e(){var t=this;var i=[];var a=babelHelpers.classPrivateFieldGet(this,Bi);babelHelpers.classPrivateFieldGet(this,Li).getItems().forEach((function(e){var s=new Mi(e[0],{fields:a,joiner:e[1],fieldPrefix:babelHelpers.classPrivateFieldGet(t,xi),rootGroupTitle:babelHelpers.classPrivateFieldGet(this,ji),onOpenFieldMenu:babelHelpers.classPrivateFieldGet(this,Ui),onOpenMenu:babelHelpers.classPrivateFieldGet(this,Wi)});babelHelpers.classPrivateFieldGet(this,zi).push(s);i.push(s.createNode())}),this);i.push(n.Dom.create("a",{attrs:{className:"bizproc-automation-popup-settings-link"},text:"[+]",events:{click:function e(){t.addItem(this)}}}));return n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link-wrapper"},children:i})}},{key:"addItem",value:function e(t){var i=new Mi(new s.Condition({},babelHelpers.classPrivateFieldGet(this,Li)),{fields:babelHelpers.classPrivateFieldGet(this,Bi),fieldPrefix:babelHelpers.classPrivateFieldGet(this,xi),rootGroupTitle:babelHelpers.classPrivateFieldGet(this,ji),onOpenFieldMenu:babelHelpers.classPrivateFieldGet(this,Ui),onOpenMenu:babelHelpers.classPrivateFieldGet(this,Wi)});babelHelpers.classPrivateFieldGet(this,zi).push(i);t.parentNode.insertBefore(i.createNode(),t)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,zi).forEach((function(e){return e.destroy()}));babelHelpers.classPrivateFieldSet(this,zi,[])}}]);return e}();var Zi=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"createSelectorByRole",value:function e(t,i){if(t===this.SELECTOR_ROLE_USER){return new s.UserSelector(i)}else if(t===this.SELECTOR_ROLE_FILE){return new s.FileSelector(i)}else if(t===this.SELECTOR_ROLE_INLINE){return new s.InlineSelector(i)}else if(t===this.SELECTOR_ROLE_INLINE_HTML){return new s.InlineSelectorHtml(i)}else if(t===this.SELECTOR_ROLE_TIME){return new s.TimeSelector(i)}else if(t===this.SELECTOR_ROLE_SAVE_STATE){return new s.SaveStateCheckbox(i)}else{return undefined}}}]);return e}();babelHelpers.defineProperty(Zi,"SELECTOR_ROLE_USER","user-selector");babelHelpers.defineProperty(Zi,"SELECTOR_ROLE_FILE","file-selector");babelHelpers.defineProperty(Zi,"SELECTOR_ROLE_INLINE","inline-selector-target");babelHelpers.defineProperty(Zi,"SELECTOR_ROLE_INLINE_HTML","inline-selector-html");babelHelpers.defineProperty(Zi,"SELECTOR_ROLE_TIME","time-selector");babelHelpers.defineProperty(Zi,"SELECTOR_ROLE_SAVE_STATE","save-state-checkbox");var Xi,Vi;function Ki(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function qi(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ki(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ki(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Ji(e,t){Qi(e,t);t.add(e)}function $i(e,t,i){Qi(e,t);t.set(e,i)}function Qi(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function ea(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var ta=new WeakMap;var ia=new WeakMap;var aa=new WeakMap;var sa=new WeakSet;var ra=new WeakSet;var la=new WeakSet;var na=new WeakSet;var oa=new WeakSet;var ca=function(e){babelHelpers.inherits(a,e);function a(e){var t;babelHelpers.classCallCheck(this,a);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).call(this));Ji(babelHelpers.assertThisInitialized(t),oa);Ji(babelHelpers.assertThisInitialized(t),na);Ji(babelHelpers.assertThisInitialized(t),la);Ji(babelHelpers.assertThisInitialized(t),ra);Ji(babelHelpers.assertThisInitialized(t),sa);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"fieldProperty",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"replaceOnWrite",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"menuButton",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"targetInput",null);$i(babelHelpers.assertThisInitialized(t),ta,{writable:true,value:{}});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"basisFields",[]);$i(babelHelpers.assertThisInitialized(t),ia,{writable:true,value:null});$i(babelHelpers.assertThisInitialized(t),aa,{writable:true,value:null});t.setEventNamespace("BX.Bizproc.Automation.Selector");t.context=e.context;t.basisFields=t.context.fields;return t}babelHelpers.createClass(a,[{key:"hasGroup",value:function e(t){return babelHelpers.classPrivateFieldGet(this,ta).hasOwnProperty(t)}},{key:"addGroup",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,ta)[t]=ea(this,sa,ua).call(this,i)}},{key:"addGroupItem",value:function e(t,i){if(this.hasGroup(t)){babelHelpers.classPrivateFieldGet(this,ta)[t].children.push(ea(this,sa,ua).call(this,i))}}},{key:"renderWith",value:function e(t){this.targetInput=n.Runtime.clone(t);this.targetInput.setAttribute("autocomplete","off");this.menuButton=n.Tag.render(Xi||(Xi=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span \n\t\t\t\tonclick="','"\n\t\t\t\tclass="bizproc-automation-popup-select-dotted"\n\t\t\t></span>\n\t\t'])),this.openMenu.bind(this));this.parseTargetProperties();this.replaceOnWrite|=this.targetInput.getAttribute("data-select-mode")==="replace";return n.Tag.render(Vi||(Vi=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-select">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this.targetInput,this.menuButton)}},{key:"renderTo",value:function e(t){t.parentNode.replaceChild(this.renderWith(t),t)}},{key:"bindTargetEvents",value:function e(){n.Event.bind(this.targetInput,"keydown",ea(this,na,da).bind(this))}},{key:"parseTargetProperties",value:function e(){this.fieldProperty=JSON.parse(this.targetInput.getAttribute("data-property"));var t=this.targetInput.getAttribute("data-selector-type");if(!this.fieldProperty&&t){this.fieldProperty={Type:t}}if(this.fieldProperty){this.fieldProperty.Type=this.fieldProperty.Type||t;ea(this,ra,pa).call(this)}else{this.context.useSwitcherMenu=false}this.replaceOnWrite|=this.targetInput.getAttribute("data-select-mode")==="replace"}},{key:"openMenu",value:function e(i){var a=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!r&&this.context.useSwitcherMenu&&!this.targetInput.value){return this.openPropertiesSwitcherMenu()}if(babelHelpers.classPrivateFieldGet(this,ia)){babelHelpers.classPrivateFieldGet(this,ia).show();return}this.fillGroups();this.onMenuOpen();var l=[];for(var n=0,o=Object.values(babelHelpers.classPrivateFieldGet(this,ta));n<o.length;n++){var c=o[n];if(c.children.length>0){l.push(c)}}if(l.length===1){l=l[0].children}var u=this.menuButton.getAttribute("data-selector-id");if(!u){u=s.Helper.generateUniqueId();this.menuButton.setAttribute("data-selector-id",u)}babelHelpers.classPrivateFieldSet(this,ia,new t.Dialog({targetNode:this.menuButton,width:500,height:300,multiple:false,dropdownMode:true,enableSearch:true,items:this.injectDialogMenuTitles(l),showAvatars:false,events:{"Item:onBeforeSelect":function e(t){t.preventDefault();var i=t.getData().item;a.onFieldSelect(i.getCustomData().get("field"))}},compactView:true}));babelHelpers.classPrivateFieldGet(this,ia).show()}},{key:"fillGroups",value:function e(){this.fillFieldsGroups();this.fillFileGroup()}},{key:"fillFieldsGroups",value:function e(){var t=this;this.addGroup("ROOT",{id:"ROOT",title:this.context.rootGroupTitle,searchable:false});this.getFields().forEach((function(e){var i=e.Id.indexOf(".")<0?"ROOT":e.Id.split(".")[0];var a="";var s=e.Name;if(e.Name&&i!=="ROOT"&&e.Name.indexOf(": ")>=0){var r=e.Name.split(": ");a=r.shift();s=r.join(": ")}if(e["Id"].indexOf("ASSIGNED_BY_")===0&&e["Id"]!=="ASSIGNED_BY_ID"&&e["Id"]!=="ASSIGNED_BY_PRINTABLE"){i="ASSIGNED_BY";var l=e.Name.split(" ");a=l.shift();s=l.join(" ").replace("(","").replace(")","")}if(!t.hasGroup(i)){t.addGroup(i,{id:i,title:a,searchable:false})}t.addGroupItem(i,{id:e.SystemExpression,title:s||e.Id,customData:{field:e}})}))}},{key:"fillFileGroup",value:function e(){var t=this.getFields().filter((function(e){return e.Type==="file"}));if(t.length>0){this.addGroup("__FILES",{id:"__FILES",title:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_FILES_LINKS"),children:ea(this,oa,va).call(this,t),searchable:false})}}},{key:"onMenuOpen",value:function e(){this.emit("onOpenMenu",{selector:this})}},{key:"openPropertiesSwitcherMenu",value:function e(){var t=this;i.MenuManager.show(s.Helper.generateUniqueId(),this.menuButton,[{text:n.Loc.getMessage("BIZPROC_AUTOMATION_ASK_CONSTANT"),onclick:function e(i){this.popupWindow.close();t.emit("onAskConstant",{fieldProperty:t.fieldProperty})}},{text:n.Loc.getMessage("BIZPROC_AUTOMATION_ASK_PARAMETER"),onclick:function e(i){this.popupWindow.close();t.emit("onAskParameter",{fieldProperty:t.fieldProperty})}},{text:n.Loc.getMessage("BIZPROC_AUTOMATION_ASK_MANUAL"),onclick:function e(i){this.popupWindow.close();t.openMenu(i,true)}}],{autoHide:true,offsetLeft:20,angle:{position:"top"},events:{onPopupClose:function e(){this.destroy()}}});babelHelpers.classPrivateFieldSet(this,aa,i.MenuManager.currentItem);return true}},{key:"injectDialogMenuTitles",value:function e(t){var i=this;t.forEach((function(e){if(n.Type.isArray(e.children)){i.injectDialogMenuSupertitles(e.title,e.children)}}));return t}},{key:"injectDialogMenuSupertitles",value:function e(t,i){var a=this;i.forEach((function(e){if(!e.supertitle){e.supertitle=t}if(n.Type.isArrayFilled(e.children)){a.injectDialogMenuSupertitles(e.title,e.children)}}))}},{key:"onFieldSelect",value:function e(t){if(!t){return}var i=this.targetInput.tagName.toLowerCase();if(i==="select"){var a=this.targetInput.querySelector('[data-role="expression"]');if(!a){a=this.targetInput.appendChild(n.Dom.create("option",{attrs:{"data-role":"expression"}}))}a.setAttribute("value",t.Expression);a.textContent=t["Expression"];a.selected=true}else if(i==="label"){this.targetInput.textContent=t.Expression;var s=document.getElementById(this.targetInput.getAttribute("for"));if(s){s.value=t.Expression}}else{if(this.replaceOnWrite){this.targetInput.value=t.Expression;this.targetInput.selectionEnd=this.targetInput.value.length}else{var r=this.targetInput.value.substr(0,this.targetInput.selectionEnd);var l=t.Expression;var o=this.targetInput.value.substr(this.targetInput.selectionEnd);this.targetInput.value=r+l+o;this.targetInput.selectionEnd=r.length+l.length}}BX.fireEvent(this.targetInput,"change");this.emit("change",{field:t})}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,ia)){babelHelpers.classPrivateFieldGet(this,ia).destroy()}if(babelHelpers.classPrivateFieldGet(this,aa)){babelHelpers.classPrivateFieldGet(this,aa).destroy()}}},{key:"getFields",value:function e(){var t=n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX");var i=this.context.fields.map((function(e){return e.Name})).join("\n");var a=[];this.basisFields.forEach((function(e){e.ObjectId="Document";var s=e["BaseType"]==="string"&&e["Type"]!=="string";if(!s){a.push(e)}if(e["Type"]==="user"||e["Type"]==="bool"||e["Type"]==="file"||s){var r=e["Name"]+" "+t;if(i.indexOf(r)<0){var l=BX.clone(e);var o=e["Type"]==="user"?"friendly":"printable";l["Name"]=r;l["Type"]="string";l["SystemExpression"]="{=Document:"+l["Id"]+" > "+o+"}";l["Expression"]="{{"+e["Name"]+" > "+o+"}}";a.push(l)}}if(e["BaseType"]==="date"||e["BaseType"]==="datetime"){var c=BX.clone(e);c["Name"]+=" "+n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_DATE_BY_SERVER");c["Type"]="string";c["SystemExpression"]="{=Document:".concat(c["Id"]," > server}");c["Expression"]="{{".concat(e["Name"]," > server}}");a.push(c);var u=BX.clone(e);u["Name"]+=" "+n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_DATE_BY_RESPONSIBLE");u["Type"]="string";u["SystemExpression"]="{=Document:".concat(c["Id"]," > responsible}");u["Expression"]="{{".concat(e["Name"]," > responsible}}");a.push(u)}}));return a}}]);return a}(a.EventEmitter);function ua(e){var t=this;if(!n.Type.isArray(e.children)){e.children=[]}e.children=e.children.filter((function(e){var i;return(i=e.customData)!==null&&i!==void 0&&i.field?ea(t,la,ba).call(t,e.customData.field):true})).map((function(e){return ea(t,sa,ua).call(t,e)}));return qi({entityId:"bp",tabs:"recents"},e)}function pa(){var e=this,t;this.basisFields=this.basisFields.filter((function(t){return ea(e,la,ba).call(e,t)}));var i=(t=this.fieldProperty)===null||t===void 0?void 0:t.Type;if(i==="file"){this.replaceOnWrite=true}else if(i==="date"||i==="datetime"){this.replaceOnWrite=true;var a=new s.DelayIntervalSelector({labelNode:this.targetInput,basisFields:this.basisFields,useAfterBasis:true,onchange:function(e){this.targetInput.value=e.toExpression(this.basisFields,s.Helper.getResponsibleUserExpression(this.context.fields))}.bind(this)});a.init(s.DelayInterval.fromString(this.targetInput.value,this.basisFields))}}function ba(e){var t;var i=(t=this.fieldProperty)===null||t===void 0?void 0:t.Type;if(i==="file"){return e.Type==="file"}else if(i==="date"||i==="datetime"){return e.Type==="date"||e.Type==="datetime"}return true}function da(e){if(e.keyCode===45&&e.altKey===false&&e.ctrlKey===false&&e.shiftKey===false){this.openMenu(e);e.preventDefault()}}function va(e){return e.map((function(e){var t=e["ObjectId"]==="Document"?"{{"+e["Name"]+" > shortlink}}":"{{~"+e["ObjectId"]+":"+e["Id"]+" > shortlink}}";var i=e.Name||e.Id;if(e.ObjectName){i=e.ObjectName+": "+i}return{title:i,customData:{field:{Id:e["Id"]+"_shortlink",ObjectId:e["ObjectId"],Name:e["Name"],Type:"string",Expression:t,SystemExpression:"{="+e["ObjectId"]+":"+e["Id"]+" > shortlink}"}},id:t}}))}function ha(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function fa(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ha(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ha(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function ga(e,t){Ta(e,t);t.add(e)}function ma(e,t,i){Ta(e,t);t.set(e,i)}function Ta(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Pa(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var ya=new WeakMap;var Ha=new WeakSet;var Ia=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));ga(babelHelpers.assertThisInitialized(i),Ha);ma(babelHelpers.assertThisInitialized(i),ya,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),ya,e.condition);return i}babelHelpers.createClass(t,[{key:"renderTo",value:function e(t){this.targetInput=t;this.menuButton=t;this.parseTargetProperties();this.bindTargetEvents()}},{key:"fillGroups",value:function e(){this.fillFieldsGroups()}},{key:"onMenuOpen",value:function e(){this.emit("onOpenMenu",{selector:this,isMixedCondition:Pa(this,Ha,Oa).call(this)})}},{key:"onFieldSelect",value:function e(t){this.emit("change",{field:t})}},{key:"getFields",value:function e(){return this.context.fields.map((function(e){return fa(fa({},e),{},{ObjectId:"Document"})}))}}]);return t}(ca);function Oa(){return babelHelpers.classPrivateFieldGet(this,ya)&&babelHelpers.classPrivateFieldGet(this,ya).parentGroup&&babelHelpers.classPrivateFieldGet(this,ya).parentGroup.type===s.ConditionGroup.CONDITION_TYPE.Mixed}var Ea;function Fa(e,t){_a(e,t);t.add(e)}function Ca(e,t,i){_a(e,t);t.set(e,i)}function _a(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Sa(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Aa=new WeakMap;var ka=new WeakMap;var Na=new WeakSet;var wa=new WeakSet;var Ga=new WeakSet;var Ma=new WeakSet;var Da=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,s=new Array(a),r=0;r<a;r++){s[r]=arguments[r]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s)));Fa(babelHelpers.assertThisInitialized(i),Ma);Fa(babelHelpers.assertThisInitialized(i),Ga);Fa(babelHelpers.assertThisInitialized(i),wa);Fa(babelHelpers.assertThisInitialized(i),Na);Ca(babelHelpers.assertThisInitialized(i),Aa,{writable:true,value:void 0});Ca(babelHelpers.assertThisInitialized(i),ka,{writable:true,value:{OnEditorInitedAfter:Sa(babelHelpers.assertThisInitialized(i),Ga,Ba).bind(babelHelpers.assertThisInitialized(i))}});return i}babelHelpers.createClass(t,[{key:"destroy",value:function e(){Sa(this,wa,La).call(this)}},{key:"renderTo",value:function e(t){this.targetInput=t;babelHelpers.classPrivateFieldSet(this,Aa,t.querySelector(".bx-html-editor"));this.menuButton=n.Tag.render(Ea||(Ea=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span\n\t\t\t\tonclick="','"\n\t\t\t\tclass="bizproc-automation-popup-select-dotted"\n\t\t\t></span>\n\t\t'])),this.openMenu.bind(this));this.parseTargetProperties();this.bindTargetEvents();t.firstElementChild.appendChild(this.menuButton);Sa(this,Na,Ra).call(this)}},{key:"onFieldSelect",value:function e(t){var i=t.Expression;var a=Sa(this,Ma,xa).call(this);if(a&&a.InsertHtml){if(a.synchro.IsFocusedOnTextarea()){a.textareaView.Focus();a.textareaView.WrapWith("","",i)}else{a.InsertHtml(i)}a.synchro.Sync()}}},{key:"onBeforeSave",value:function e(){var t=Sa(this,Ma,xa).call(this);if(t&&t.SaveContent){t.SaveContent()}}},{key:"onPopupResize",value:function e(){var t=Sa(this,Ma,xa).call(this);if(t&&t.ResizeSceleton){t.ResizeSceleton()}}}]);return t}(ca);function Ra(){for(var e=0,t=Object.entries(babelHelpers.classPrivateFieldGet(this,ka));e<t.length;e++){var i=babelHelpers.slicedToArray(t[e],2),a=i[0],s=i[1];BX.addCustomEvent(a,s)}}function La(){for(var e=0,t=Object.entries(babelHelpers.classPrivateFieldGet(this,ka));e<t.length;e++){var i=babelHelpers.slicedToArray(t[e],2),a=i[0],s=i[1];BX.removeCustomEvent(a,s)}}function Ba(e){if(e.dom.cont!==babelHelpers.classPrivateFieldGet(this,Aa)){return false}var t="";var i="";var a=function e(i){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return i.replace(/(^[\s\S]*?)(<body.*?>)/i,(function(e){if(a){t=e}return""}))};var s=function e(t){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return t.replace(/(<\/body>[\s\S]*?$)/i,(function(e){if(a){i=e}return""}))};BX.addCustomEvent(e,"OnParse",(function(e){if(!e){this.content=s(a(this.content,true),true)}}));BX.addCustomEvent(e,"OnAfterParse",(function(e){if(e){var r=s(a(this.content));if(t!==""&&i!==""){r=t+r+i}this.content=r}}))}function xa(){if(babelHelpers.classPrivateFieldGet(this,Aa)){var e=babelHelpers.classPrivateFieldGet(this,Aa).id.split("-");return BXHtmlEditor.Get(e[e.length-1])}return null}function za(e,t){Wa(e,t);t.add(e)}function Ua(e,t,i){Wa(e,t);t.set(e,i)}function Wa(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function ja(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Ya=new WeakMap;var Za=new WeakMap;var Xa=new WeakMap;var Va=new WeakSet;var Ka=new WeakSet;var qa=function(){function e(t){babelHelpers.classCallCheck(this,e);za(this,Ka);za(this,Va);Ua(this,Ya,{writable:true,value:void 0});Ua(this,Za,{writable:true,value:void 0});Ua(this,Xa,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Ya,t.context);babelHelpers.classPrivateFieldSet(this,Za,t.checkbox);babelHelpers.classPrivateFieldSet(this,Xa,t.needSync);if(t.needSync){var i="save_state_checkbox";var a=babelHelpers.classPrivateFieldGet(this,Ya).get("userOptions").get(i,ja(this,Va,Ja).call(this),"N");if(a==="Y"){babelHelpers.classPrivateFieldGet(this,Za).checked=true}}}babelHelpers.createClass(e,[{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Xa)){babelHelpers.classPrivateFieldGet(this,Ya).get("userOptions").set("save_state_checkboxes",ja(this,Va,Ja).call(this),ja(this,Ka,$a).call(this))}}}]);return e}();function Ja(){return babelHelpers.classPrivateFieldGet(this,Za).getAttribute("data-save-state-key")}function $a(){return babelHelpers.classPrivateFieldGet(this,Za).checked?"Y":"N"}var Qa=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"renderTo",value:function e(t){this.targetInput=t;this.menuButton=t;this.fieldProperty=JSON.parse(t.getAttribute("data-property"));if(!this.fieldProperty){this.context.useSwitcherMenu=false}var i=this.context.get("additionalUserFields");this.userSelector=BX.Bizproc.UserSelector.decorateNode(t,{additionalFields:n.Type.isArray(i)?i:[]})}},{key:"destroy",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"destroy",this).call(this);if(this.userSelector){this.userSelector.destroy();this.userSelector=null}}}]);return t}(ca);var es,ts,is,as,ss,rs,ls,ns;function os(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=cs(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var s=function e(){};return{s:s,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!r&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function cs(e,t){if(!e)return;if(typeof e==="string")return us(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return us(e,t)}function us(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++){a[i]=e[i]}return a}function ps(e,t){ds(e,t);t.add(e)}function bs(e,t,i){ds(e,t);t.set(e,i)}function ds(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function vs(e,t,i){hs(e,t);return i}function hs(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function fs(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var gs=new WeakMap;var ms=new WeakMap;var Ts=new WeakMap;var Ps=new WeakMap;var ys=new WeakMap;var Hs=new WeakMap;var Is=new WeakMap;var Os=new WeakMap;var Es=new WeakMap;var Fs=new WeakMap;var Cs=new WeakMap;var _s=new WeakMap;var Ss=new WeakMap;var As=new WeakMap;var ks=new WeakSet;var Ns=new WeakSet;var ws=new WeakSet;var Gs=new WeakSet;var Ms=new WeakSet;var Ds=new WeakSet;var Rs=new WeakSet;var Ls=new WeakSet;var Bs=new WeakSet;var xs=new WeakSet;var zs=new WeakSet;var Us=new WeakSet;var Ws=new WeakSet;var js=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));ps(babelHelpers.assertThisInitialized(i),Ws);ps(babelHelpers.assertThisInitialized(i),Us);ps(babelHelpers.assertThisInitialized(i),zs);ps(babelHelpers.assertThisInitialized(i),xs);ps(babelHelpers.assertThisInitialized(i),Bs);ps(babelHelpers.assertThisInitialized(i),Ls);ps(babelHelpers.assertThisInitialized(i),Rs);ps(babelHelpers.assertThisInitialized(i),Ds);ps(babelHelpers.assertThisInitialized(i),Ms);ps(babelHelpers.assertThisInitialized(i),Gs);ps(babelHelpers.assertThisInitialized(i),ws);ps(babelHelpers.assertThisInitialized(i),Ns);ps(babelHelpers.assertThisInitialized(i),ks);bs(babelHelpers.assertThisInitialized(i),gs,{writable:true,value:t.TYPE.None});bs(babelHelpers.assertThisInitialized(i),ms,{writable:true,value:false});bs(babelHelpers.assertThisInitialized(i),Ts,{writable:true,value:false});bs(babelHelpers.assertThisInitialized(i),Ps,{writable:true,value:""});bs(babelHelpers.assertThisInitialized(i),ys,{writable:true,value:""});bs(babelHelpers.assertThisInitialized(i),Hs,{writable:true,value:false});bs(babelHelpers.assertThisInitialized(i),Is,{writable:true,value:""});bs(babelHelpers.assertThisInitialized(i),Os,{writable:true,value:""});bs(babelHelpers.assertThisInitialized(i),Es,{writable:true,value:""});bs(babelHelpers.assertThisInitialized(i),Fs,{writable:true,value:null});bs(babelHelpers.assertThisInitialized(i),Cs,{writable:true,value:null});bs(babelHelpers.assertThisInitialized(i),_s,{writable:true,value:null});bs(babelHelpers.assertThisInitialized(i),Ss,{writable:true,value:null});bs(babelHelpers.assertThisInitialized(i),As,{writable:true,value:void 0});i.context.set("fileFields",i.context.fields.filter((function(e){return e.Type==="file"})));return i}babelHelpers.createClass(t,[{key:"destroy",value:function e(){if(this.menu){this.menu.popupWindow.close()}}},{key:"renderTo",value:function e(t){this.targetInput=t;var i=this.parseTargetProperties();this.targetInput.appendChild(fs(this,ks,Ys).call(this));fs(this,Ns,Zs).call(this,i)}},{key:"parseTargetProperties",value:function e(){var i=JSON.parse(this.targetInput.getAttribute("data-config"));if(!n.Type.isPlainObject(i)){i={}}babelHelpers.classPrivateFieldSet(this,gs,i.type||t.TYPE.File);if(i.selected&&!i.selected.length){babelHelpers.classPrivateFieldSet(this,gs,t.TYPE.None)}babelHelpers.classPrivateFieldSet(this,ms,i.multiple||false);babelHelpers.classPrivateFieldSet(this,Ts,i.required||false);babelHelpers.classPrivateFieldSet(this,Ps,i.valueInputName||"");babelHelpers.classPrivateFieldSet(this,ys,i.typeInputName||"");babelHelpers.classPrivateFieldSet(this,Hs,i.useDisk||false);babelHelpers.classPrivateFieldSet(this,Is,i.label||"Attachment");babelHelpers.classPrivateFieldSet(this,Os,i.labelFile||"File");babelHelpers.classPrivateFieldSet(this,Es,i.labelDisk||"Disk");if(i.selected&&i.selected.length>0){return n.Runtime.clone(i.selected)}}},{key:"addItems",value:function e(i){if(babelHelpers.classPrivateFieldGet(this,gs)===t.TYPE.File){var a=os(i),s;try{for(a.s();!(s=a.n()).done;){var r=s.value;fs(this,Bs,Qs).call(this,r)}}catch(e){a.e(e)}finally{a.f()}}else{fs(this,Rs,Js).call(this).setValues(vs(t,t,tr).call(t,i))}}},{key:"onFieldSelect",value:function e(i){fs(this,Bs,Qs).call(this,{id:i.Id,expression:i.Expression,name:i.Name,type:t.TYPE.File})}},{key:"onBeforeSave",value:function e(){var i=[];if(babelHelpers.classPrivateFieldGet(this,gs)===t.TYPE.Disk){i=fs(this,Rs,Js).call(this).getValues()}else if(babelHelpers.classPrivateFieldGet(this,gs)===t.TYPE.File){i=Array.from(babelHelpers.classPrivateFieldGet(this,_s).childNodes).map((function(e){return e.getAttribute("data-file-expression")})).filter((function(e){return e!==""}))}var a=os(i),s;try{for(a.s();!(s=a.n()).done;){var r=s.value;this.targetInput.appendChild(n.Tag.render(es||(es=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input\n\t\t\t\t\ttype="hidden"\n\t\t\t\t\tname="','"\n\t\t\t\t\tvalue="','"\n\t\t\t\t/>\n\t\t\t'])),babelHelpers.classPrivateFieldGet(this,Ps)+(babelHelpers.classPrivateFieldGet(this,ms)?"[]":""),r))}}catch(e){a.e(e)}finally{a.f()}}}]);return t}(ca);function Ys(){var e=s.Helper.generateUniqueId();var t=null;var i=[];if(this.context.get("fileFields").length>0){t=n.Tag.render(ts||(ts=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input\n\t\t\t\t\tid="type-1','"\n\t\t\t\t\tclass="bizproc-automation-popup-select-input"\n\t\t\t\t\ttype="radio"\n\t\t\t\t\tname="','"\n\t\t\t\t\tvalue="','"\n\t\t\t\t\t',"\n\t\t\t\t/>\n\t\t\t"])),e,babelHelpers.classPrivateFieldGet(this,ys),js.TYPE.File,babelHelpers.classPrivateFieldGet(this,gs)===js.TYPE.File?"checked":"")}var a=n.Tag.render(is||(is=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input\n\t\t\t\tid="type-2','"\n\t\t\t\tclass="bizproc-automation-popup-select-input"\n\t\t\t\ttype="radio"\n\t\t\t\tname="','"\n\t\t\t\tvalue="','"\n\t\t\t\t',"\n\t\t\t/>\n\t\t"])),e,babelHelpers.classPrivateFieldGet(this,ys),js.TYPE.Disk,babelHelpers.classPrivateFieldGet(this,gs)===js.TYPE.Disk?"checked":"");i.push(n.Tag.render(as||(as=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="bizproc-automation-popup-settings-title">',":</span>\n\t\t"])),babelHelpers.classPrivateFieldGet(this,Is)));if(t){i.push(t,n.Tag.render(ss||(ss=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<label\n\t\t\t\t\tclass="bizproc-automation-popup-settings-link"\n\t\t\t\t\tfor="type-1','"\n\t\t\t\t\tonclick="','"\n\t\t\t\t>\n\t\t\t\t',"\n\t\t\t\t</label>\n\t\t\t"])),e,fs(this,Ls,$s).bind(this,js.TYPE.File),babelHelpers.classPrivateFieldGet(this,Os)))}i.push(a,n.Tag.render(rs||(rs=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<label\n\t\t\t\tclass="bizproc-automation-popup-settings-link"\n\t\t\t\tfor="type-2','"\n\t\t\t\tonclick="','"\n\t\t\t>\n\t\t\t',"\n\t\t\t</label>\n\t\t"])),e,fs(this,Ls,$s).bind(this,js.TYPE.Disk),babelHelpers.classPrivateFieldGet(this,Es)));return n.Tag.render(ls||(ls=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings-block">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),i)}function Zs(e){if(babelHelpers.classPrivateFieldGet(this,gs)===js.TYPE.Disk){fs(this,Ds,qs).call(this);fs(this,ws,Xs).call(this,e)}else if(babelHelpers.classPrivateFieldGet(this,gs)===js.TYPE.File){fs(this,Gs,Vs).call(this);fs(this,Ms,Ks).call(this,e)}else{fs(this,Ds,qs).call(this);fs(this,Gs,Vs).call(this)}}function Xs(e){if(!babelHelpers.classPrivateFieldGet(this,Cs)){babelHelpers.classPrivateFieldSet(this,Cs,n.Dom.create("div"));this.targetInput.appendChild(babelHelpers.classPrivateFieldGet(this,Cs));var t=fs(this,Rs,Js).call(this);t.layout(babelHelpers.classPrivateFieldGet(this,Cs));t.show(true);if(e){this.addItems(e)}}else{n.Dom.show(babelHelpers.classPrivateFieldGet(this,Cs))}}function Vs(){if(babelHelpers.classPrivateFieldGet(this,Cs)){n.Dom.hide(babelHelpers.classPrivateFieldGet(this,Cs))}}function Ks(e){if(!babelHelpers.classPrivateFieldGet(this,Ss)){babelHelpers.classPrivateFieldSet(this,_s,n.Dom.create("span"));babelHelpers.classPrivateFieldSet(this,Ss,n.Dom.create("div",{children:[babelHelpers.classPrivateFieldGet(this,_s)]}));this.targetInput.appendChild(babelHelpers.classPrivateFieldGet(this,Ss));var t=n.Dom.create("a",{attrs:{className:"bizproc-automation-popup-settings-link bizproc-automation-popup-settings-link-thin"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ADD")});babelHelpers.classPrivateFieldGet(this,Ss).appendChild(t);n.Event.bind(t,"click",fs(this,Us,ar).bind(this,t));if(e){this.addItems(e)}}else{n.Dom.show(babelHelpers.classPrivateFieldGet(this,Ss))}}function qs(){if(babelHelpers.classPrivateFieldGet(this,Ss)){n.Dom.hide(babelHelpers.classPrivateFieldGet(this,Ss))}}function Js(){if(!babelHelpers.classPrivateFieldGet(this,Fs)){babelHelpers.classPrivateFieldSet(this,Fs,BX.Bizproc.Automation.DiskUploader.create("",{msg:{diskAttachFiles:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_ATTACH_FILE"),diskAttachedFiles:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_ATTACHED_FILES"),diskSelectFile:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_SELECT_FILE"),diskSelectFileLegend:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_SELECT_FILE_LEGEND"),diskUploadFile:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_UPLOAD_FILE"),diskUploadFileLegend:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_UPLOAD_FILE_LEGEND")}}));babelHelpers.classPrivateFieldGet(this,Fs).setMode(1)}return babelHelpers.classPrivateFieldGet(this,Fs)}function $s(e){if(babelHelpers.classPrivateFieldGet(this,gs)!==e){babelHelpers.classPrivateFieldSet(this,gs,e);fs(this,Ns,Zs).call(this)}}function Qs(e){if(fs(this,xs,er).call(this,e)){return false}var t=fs(this,Ws,sr).call(this,e);if(!babelHelpers.classPrivateFieldGet(this,ms)){n.Dom.clean(babelHelpers.classPrivateFieldGet(this,_s))}babelHelpers.classPrivateFieldGet(this,_s).appendChild(t)}function er(e){return!!babelHelpers.classPrivateFieldGet(this,_s).querySelector('[data-file-id="'.concat(e.id,'"]'))}function tr(e){return e.map((function(e){return{ID:e["id"],NAME:e["name"],SIZE:e["size"],VIEW_URL:""}}))}function ir(e){var t=babelHelpers.classPrivateFieldGet(this,_s).querySelector('[data-file-id="'.concat(e.id,'"]'));if(t){babelHelpers.classPrivateFieldGet(this,_s).removeChild(t)}}function ar(e,t){var a=this;if(!babelHelpers.classPrivateFieldGet(this,As)){babelHelpers.classPrivateFieldSet(this,As,s.Helper.generateUniqueId())}i.MenuManager.show(babelHelpers.classPrivateFieldGet(this,As),e,this.context.get("fileFields").map((function(e){return{text:n.Text.encode(e.Name),field:e,onclick:function t(i,s){this.popupWindow.close();a.onFieldSelect(e)}}})),{autoHide:true,offsetLeft:n.Dom.getPosition(e)["width"]/2,angle:{position:"top",offset:0}});t.preventDefault()}function sr(e){var t=this.context.get("fileFields").find((function(t){return t.Expression===e.expression}));var i=(t===null||t===void 0?void 0:t.Name)||"";return n.Tag.render(ns||(ns=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span\n\t\t\t\tclass="bizproc-automation-popup-autocomplete-item"\n\t\t\t\tdata-file-id="','"\n\t\t\t\tdata-file-expression="','"\n\t\t\t>\n\t\t\t\t<span class="bizproc-automation-popup-autocomplete-name">','</span>\n\t\t\t\t<span\n\t\t\t\t\tclass="bizproc-automation-popup-autocomplete-delete"\n\t\t\t\t\tonclick="','"\n\t\t\t\t></span>\n\t\t\t</span>\n\t\t'])),e.id,e.expression,i,fs(this,zs,ir).bind(this,e))}babelHelpers.defineProperty(js,"TYPE",{None:"",Disk:"disk",File:"file"});function rr(e,t){nr(e,t);t.add(e)}function lr(e,t,i){nr(e,t);t.set(e,i)}function nr(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function or(e,t,i){cr(e,t);return i}function cr(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function ur(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var pr=new WeakMap;var br=new WeakSet;var dr=new WeakSet;var vr=new WeakSet;var hr=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,s=new Array(a),r=0;r<a;r++){s[r]=arguments[r]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s)));rr(babelHelpers.assertThisInitialized(i),vr);rr(babelHelpers.assertThisInitialized(i),dr);rr(babelHelpers.assertThisInitialized(i),br);lr(babelHelpers.assertThisInitialized(i),pr,{writable:true,value:void 0});return i}babelHelpers.createClass(t,[{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,pr)){babelHelpers.classPrivateFieldGet(this,pr).closeWnd()}}},{key:"renderTo",value:function e(i){var a;this.targetInput=i;var s=new Date;s.setHours(0,0,0,0);s.setTime(s.getTime()+ur(this,dr,gr).call(this)*1e3);this.targetInput.value=or(a=this.constructor,t,Tr).call(a,s);n.Event.bind(i,"click",this.showClock.bind(this))}},{key:"showClock",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,pr)){babelHelpers.classPrivateFieldSet(this,pr,new BX.CClockSelector({start_time:ur(this,dr,gr).call(this),node:this.targetInput,callback:ur(this,br,fr).bind(this)}))}babelHelpers.classPrivateFieldGet(this,pr).Show()}}]);return t}(ca);function fr(e){this.targetInput.value=e;BX.fireEvent(this.targetInput,"change");babelHelpers.classPrivateFieldGet(this,pr).closeWnd()}function gr(){return ur(this,vr,mr).call(this,this.targetInput.value)}function mr(e){var t=e.split(/[\s:]+/).map((function(e){return parseInt(e)}));var i=babelHelpers.slicedToArray(t,2),a=i[0],s=i[1];if(t.length===3){var r=t[2];if(r==="pm"&&a<12){a+=12}else if(r==="am"&&a===12){a=0}}return a*3600+s*60}function Tr(e){var t=function e(t){return BX.date.convertBitrixFormat(n.Loc.getMessage(t)).replace(/:?\s*s/,"")};var i=t("FORMAT_DATE");var a=t("FORMAT_DATETIME").replace(i,"").trim();return BX.date.format(a,e)}var Pr=function(){function e(t){babelHelpers.classCallCheck(this,e);this.basisFields=[];this.onchange=null;if(n.Type.isPlainObject(t)){this.labelNode=t.labelNode;this.useAfterBasis=t.useAfterBasis;if(n.Type.isArray(t.basisFields)){this.basisFields=t.basisFields}this.onchange=t.onchange;this.minLimitM=t.minLimitM}}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.delay=t;this.setLabelText();this.bindLabelNode();this.prepareBasisFields()}},{key:"setLabelText",value:function e(){if(this.delay&&this.labelNode){this.labelNode.textContent=this.delay.format(n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AT_ONCE"),this.basisFields)}}},{key:"bindLabelNode",value:function e(){if(this.labelNode){n.Event.bind(this.labelNode,"click",BX.delegate(this.onLabelClick,this))}}},{key:"onLabelClick",value:function e(t){this.showDelayIntervalPopup();t.preventDefault()}},{key:"showDelayIntervalPopup",value:function e(){var t=this.delay;var i=ne.generateUniqueId();var a=n.Dom.create("form",{attrs:{className:"bizproc-automation-popup-select-block"}});var s=n.Dom.create("input",{attrs:{className:"bizproc-automation-popup-select-input",id:i+"now",type:"radio",value:"now",name:"type"}});if(t.isNow()){s.setAttribute("checked","checked")}var r=n.Dom.create("label",{attrs:{className:"bizproc-automation-popup-select-wrapper",for:i+"now"},children:[n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:n.Loc.getMessage(this.useAfterBasis?"BIZPROC_AUTOMATION_CMP_BASIS_NOW":"BIZPROC_AUTOMATION_CMP_AT_ONCE_2")})]});var l=n.Dom.create("span",{attrs:{className:"bizproc-automation-status-help bizproc-automation-status-help-right","data-hint":n.Loc.getMessage(this.useAfterBasis?"BIZPROC_AUTOMATION_CMP_DELAY_NOW_HELP_2":"BIZPROC_AUTOMATION_CMP_DELAY_NOW_HELP")}});r.appendChild(l);a.appendChild(n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-select-item"},children:[s,r]}));a.appendChild(this.createAfterControlNode());if(this.basisFields.length>0){a.appendChild(this.createBeforeControlNode());a.appendChild(this.createInControlNode())}var o=n.Dom.create("input",{attrs:{type:"checkbox",id:i+"worktime",name:"worktime",value:"1",style:"vertical-align: middle"},props:{checked:t.workTime}});var c=n.Dom.create("span",{attrs:{className:"bizproc-automation-status-help bizproc-automation-status-help-right","data-hint":n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DELAY_WORKTIME_HELP_2")}});a.appendChild(n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-title"},children:[o,n.Dom.create("label",{attrs:{className:"bizproc-automation-popup-settings-lbl",for:i+"worktime"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_WORK_TIME")}),c]}));var u=this;BX.UI.Hint.init(a);var p=new BX.PopupWindow(ne.generateUniqueId(),this.labelNode,{autoHide:true,closeByEsc:true,closeIcon:false,titleBar:false,angle:true,offsetLeft:20,content:a,buttons:[new BX.PopupWindowButton({text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CHOOSE"),className:"webform-button webform-button-create bizproc-automation-button-left",events:{click:function e(){var t=BX.ajax.prepareForm(a);u.saveFormData(t["data"]);this.popupWindow.close()}}})],events:{onPopupClose:function e(){if(u.fieldsMenu){u.fieldsMenu.popupWindow.close()}if(u.valueTypeMenu){u.valueTypeMenu.popupWindow.close()}this.destroy()}},overlay:{backgroundColor:"transparent"}});p.show()}},{key:"saveFormData",value:function e(t){if(t["type"]==="now"){this.delay.setNow()}else if(t["type"]===Ye.DELAY_TYPE.In){this.delay.setType(Ye.DELAY_TYPE.In);this.delay.setValue(0);this.delay.setValueType("i");this.delay.setBasis(t["basis_in"])}else{this.delay.setType(t["type"]);this.delay.setValue(t["value_"+t["type"]]);this.delay.setValueType(t["value_type_"+t["type"]]);if(t["type"]===Ye.DELAY_TYPE.After){if(this.useAfterBasis){this.delay.setBasis(t["basis_after"])}else{this.delay.setBasis(Ye.BASIS_TYPE.CurrentDateTime)}if(this.minLimitM>0&&this.delay.basis===Ye.BASIS_TYPE.CurrentDateTime&&this.delay.valueType==="i"&&this.delay.value<this.minLimitM){BX.UI.Notification.Center.notify({content:n.Loc.getMessage("BIZPROC_AUTOMATION_DELAY_MIN_LIMIT_LABEL")});this.delay.setValue(this.minLimitM)}}else{this.delay.setBasis(t["basis_before"])}}this.delay.setWorkTime(t["worktime"]);this.setLabelText();if(this.onchange){this.onchange(this.delay)}}},{key:"createAfterControlNode",value:function e(){var t=this.delay;var i=ne.generateUniqueId();var a=n.Dom.create("input",{attrs:{className:"bizproc-automation-popup-select-input",id:i,type:"radio",value:Ye.DELAY_TYPE.After,name:"type"}});if(t.type===Ye.DELAY_TYPE.After&&t.value>0){a.setAttribute("checked","checked")}var s=n.Dom.create("input",{attrs:{type:"text",name:"value_after",className:"bizproc-automation-popup-settings-input"},props:{value:t.type===Ye.DELAY_TYPE.After&&t.value?t.value:this.minLimitM||5}});var r=n.Dom.create("label",{attrs:{className:"bizproc-automation-popup-select-wrapper",for:i},children:[n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_THROUGH_3")}),s,this.createValueTypeSelector("value_type_after")]});if(this.useAfterBasis){r.appendChild(n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-auto-width"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AFTER")}));var l=this.getBasisField(t.basis,true);var o=t.basis;if(!l){l=this.getBasisField(Ye.BASIS_TYPE.CurrentDateTime,true);o=l.SystemExpression}var c=n.Dom.create("input",{attrs:{type:"hidden",name:"basis_after",value:o}});var u=this;var p=n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis"},text:l?l.Name:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD"),events:{click:function e(t){u.onBasisClick(t,this,(function(e){p.textContent=e.Name;c.value=e.SystemExpression}),Ye.DELAY_TYPE.After)}}});r.appendChild(c);r.appendChild(p)}if(!this.useAfterBasis){var b=n.Dom.create("span",{attrs:{className:"bizproc-automation-status-help bizproc-automation-status-help-right","data-hint":n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DELAY_AFTER_HELP")}});r.appendChild(b)}return n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-select-item"},children:[a,r]})}},{key:"createBeforeControlNode",value:function e(){var t=this.delay;var i=ne.generateUniqueId();var a=n.Dom.create("input",{attrs:{className:"bizproc-automation-popup-select-input",id:i,type:"radio",value:Ye.DELAY_TYPE.Before,name:"type"}});if(t.type===Ye.DELAY_TYPE.Before){a.setAttribute("checked","checked")}var s=n.Dom.create("input",{attrs:{type:"text",name:"value_before",className:"bizproc-automation-popup-settings-input"},props:{value:t.type===Ye.DELAY_TYPE.Before&&t.value?t.value:this.minLimitM||5}});var r=n.Dom.create("label",{attrs:{className:"bizproc-automation-popup-select-wrapper",for:i},children:[n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_FOR_TIME_3")}),s,this.createValueTypeSelector("value_type_before"),n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-auto-width"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BEFORE_1")})]});var l=this.getBasisField(t.basis);var o=t.basis;if(!l){l=this.basisFields[0];o=l.SystemExpression}var c=n.Dom.create("input",{attrs:{type:"hidden",name:"basis_before",value:o}});var u=this;var p=n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis"},text:l?l.Name:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD"),events:{click:function e(t){u.onBasisClick(t,this,(function(e){p.textContent=e.Name;c.value=e.SystemExpression}),Ye.DELAY_TYPE.Before)}}});r.appendChild(c);r.appendChild(p);if(!this.useAfterBasis){var b=n.Dom.create("span",{attrs:{className:"bizproc-automation-status-help bizproc-automation-status-help-right","data-hint":n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DELAY_BEFORE_HELP")}});r.appendChild(b)}return n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-select-item"},children:[a,r]})}},{key:"createInControlNode",value:function e(){var t=this.delay;var i=ne.generateUniqueId();var a=n.Dom.create("input",{attrs:{className:"bizproc-automation-popup-select-input",id:i,type:"radio",value:Ye.DELAY_TYPE.In,name:"type"}});if(t.type===Ye.DELAY_TYPE.In){a.setAttribute("checked","checked")}var s=n.Dom.create("label",{attrs:{className:"bizproc-automation-popup-select-wrapper",for:i},children:[n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_IN_TIME_2")})]});var r=this.getBasisField(t.basis);var l=t.basis;if(!r){r=this.basisFields[0];l=r.SystemExpression}var o=n.Dom.create("input",{attrs:{type:"hidden",name:"basis_in",value:l}});var c=this;var u=n.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis"},text:r?r.Name:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD"),events:{click:function e(t){c.onBasisClick(t,this,(function(e){u.textContent=e.Name;o.value=e.SystemExpression}))}}});s.appendChild(o);s.appendChild(u);if(!this.useAfterBasis){var p=n.Dom.create("span",{attrs:{className:"bizproc-automation-status-help bizproc-automation-status-help-right","data-hint":n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DELAY_IN_HELP")}});s.appendChild(p)}return n.Dom.create("div",{attrs:{className:"bizproc-automation-popup-select-item"},children:[a,s]})}},{key:"createValueTypeSelector",value:function e(t){var i=this.delay;var a={i:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_M"),h:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_H"),d:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_D")};var s=n.Dom.create("label",{attrs:{className:"bizproc-automation-popup-settings-link"},text:a[i.valueType]});var r=n.Dom.create("input",{attrs:{type:"hidden",name:t},props:{value:i.valueType}});n.Event.bind(s,"click",this.onValueTypeSelectorClick.bind(this,s,r));return n.Dom.create("span",{children:[s,r]})}},{key:"onValueTypeSelectorClick",value:function e(t,a){var s=ne.generateUniqueId();var r=function e(i,s){this.popupWindow.close();a.value=s.valueId;t.textContent=s.text};var l=[{text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_M"),valueId:"i",onclick:r},{text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_H"),valueId:"h",onclick:r},{text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_D"),valueId:"d",onclick:r}];i.MenuManager.show(s,t,l,{autoHide:true,offsetLeft:25,angle:{position:"top"},events:{onPopupClose:function e(){this.destroy()}},overlay:{backgroundColor:"transparent"}});this.valueTypeMenu=i.MenuManager.currentItem}},{key:"onBasisClick",value:function e(t,a,s,r){var l=[];if(r===Ye.DELAY_TYPE.After){l.push({text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_NOW"),field:{Name:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_NOW"),SystemExpression:Ye.BASIS_TYPE.CurrentDateTime},onclick:function e(t,i){if(s){s(i.field)}this.popupWindow.close()}},{text:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_DATE"),field:{Name:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_DATE"),SystemExpression:Ye.BASIS_TYPE.CurrentDate},onclick:function e(t,i){if(s){s(i.field)}this.popupWindow.close()}},{delimiter:true})}for(var o=0;o<this.basisFields.length;++o){if(r!==Ye.DELAY_TYPE.After&&this.basisFields[o]["Id"].indexOf("DATE_CREATE")>-1){continue}l.push({text:n.Text.encode(this.basisFields[o].Name),field:this.basisFields[o],onclick:function e(t,i){if(s){s(i.field||i.options.field)}this.popupWindow.close()}})}var c=a.getAttribute("data-menu-id");if(!c){c=ne.generateUniqueId();a.setAttribute("data-menu-id",c)}i.MenuManager.show(c,a,l,{autoHide:true,offsetLeft:BX.pos(a)["width"]/2,angle:{position:"top",offset:0},overlay:{backgroundColor:"transparent"}});this.fieldsMenu=i.MenuManager.currentItem}},{key:"getBasisField",value:function e(t,i){if(i&&(t===Ye.BASIS_TYPE.CurrentDateTime||t===Ye.BASIS_TYPE.CurrentDateTimeLocal)){return{Name:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_NOW"),SystemExpression:Ye.BASIS_TYPE.CurrentDateTime}}if(i&&t===Ye.BASIS_TYPE.CurrentDate){return{Name:n.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_DATE"),SystemExpression:Ye.BASIS_TYPE.CurrentDate}}var a=null;for(var s=0;s<this.basisFields.length;++s){if(t===this.basisFields[s].SystemExpression){a=this.basisFields[s]}}return a}},{key:"prepareBasisFields",value:function e(){var t=[];for(var i=0;i<this.basisFields.length;++i){var a=this.basisFields[i];if(a["Id"].indexOf("DATE_MODIFY")<0&&a["Id"].indexOf("EVENT_DATE")<0&&a["Id"].indexOf("BIRTHDATE")<0){t.push(a)}}this.basisFields=t}}]);return e}();function yr(e,t,i){Hr(e,t);t.set(e,i)}function Hr(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Ir=new WeakMap;var Or=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));yr(babelHelpers.assertThisInitialized(i),Ir,{writable:true,value:void 0});i.setEventNamespace("BX.Bizproc.Automation.Context");if(n.Type.isPlainObject(e)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Ir,e)}return i}babelHelpers.createClass(t,[{key:"clone",value:function e(){return new t(n.clone(babelHelpers.classPrivateFieldGet(this,Ir)))}},{key:"getValues",value:function e(){return babelHelpers.classPrivateFieldGet(this,Ir)}},{key:"set",value:function e(t,i){var a=this.has(t);babelHelpers.classPrivateFieldGet(this,Ir)[t]=i;this.emit(a?"valueChanged":"valueAdded",{name:t,value:i});return this}},{key:"get",value:function e(t){return babelHelpers.classPrivateFieldGet(this,Ir)[t]}},{key:"has",value:function e(t){return babelHelpers.classPrivateFieldGet(this,Ir).hasOwnProperty(t)}},{key:"subsribeValueChanges",value:function e(t,i){this.subscribe("valueChanged",(function(e){if(e.data.name===t){i(e)}}));return this}}]);return t}(a.EventEmitter);var Er=function(e){babelHelpers.inherits(t,e);function t(e){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e))}babelHelpers.createClass(t,[{key:"fields",get:function e(){var t=this.get("fields");return n.Type.isArray(t)?t:[]}},{key:"useSwitcherMenu",get:function e(){return n.Type.isBoolean(this.get("useSwitcherMenu"))?this.get("useSwitcherMenu"):false},set:function e(t){this.set("useSwitcherMenu",t)}},{key:"rootGroupTitle",get:function e(){var t;return(t=this.get("rootGroupTitle"))!==null&&t!==void 0?t:""}}]);return t}(Or);var Fr=function(e){babelHelpers.inherits(t,e);function t(e){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e))}babelHelpers.createClass(t,[{key:"clone",value:function e(){var i;return new t(n.Runtime.clone(this.getValues())).set("document",this.document.clone()).set("userOptions",(i=this.userOptions)===null||i===void 0?void 0:i.clone())}},{key:"getAvailableTrigger",value:function e(t){return this.availableTriggers.find((function(e){return e["CODE"]===t}))}},{key:"document",get:function e(){return this.get("document")}},{key:"signedDocument",get:function e(){var t;return(t=this.get("signedDocument"))!==null&&t!==void 0?t:""}},{key:"ajaxUrl",get:function e(){var t;return(t=this.get("ajaxUrl"))!==null&&t!==void 0?t:""}},{key:"availableRobots",get:function e(){var t=this.get("availableRobots");if(n.Type.isArray(t)){return t}return[]}},{key:"availableTriggers",get:function e(){var t=this.get("availableTriggers");if(n.Type.isArray(t)){return t}return[]}},{key:"canManage",get:function e(){var t=this.get("canManage");return n.Type.isBoolean(t)&&t}},{key:"canEdit",get:function e(){var t=this.get("canEdit");return n.Type.isBoolean(t)&&t}},{key:"userOptions",get:function e(){return this.get("userOptions")}},{key:"tracker",get:function e(){return this.get("tracker")},set:function e(t){this.set("tracker",t)}},{key:"bizprocEditorUrl",get:function e(){return this.get("bizprocEditorUrl")}},{key:"constantsEditorUrl",get:function e(){return this.get("constantsEditorUrl")}},{key:"parametersEditorUrl",get:function e(){return this.get("parametersEditorUrl")}}]);return t}(Or);function Cr(e,t,i){_r(e,t);t.set(e,i)}function _r(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Sr=new WeakMap;var Ar=function(){function e(t){babelHelpers.classCallCheck(this,e);Cr(this,Sr,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Sr,new o.Guide({steps:[{target:t.target,title:n.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_BEGINNING_TITLE"),text:n.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_BEGINNING_SUBTITLE"),article:"16547606",condition:{top:true,bottom:false,color:"primary"},position:"bottom"}],onEvents:true}));babelHelpers.classPrivateFieldGet(this,Sr).getPopup().setAutoHide(true)}babelHelpers.createClass(e,[{key:"start",value:function e(){babelHelpers.classPrivateFieldGet(this,Sr).showNextStep()}}]);return e}();function kr(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=Nr(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var s=function e(){};return{s:s,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!r&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function Nr(e,t){if(!e)return;if(typeof e==="string")return wr(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return wr(e,t)}function wr(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++){a[i]=e[i]}return a}function Gr(e,t){Dr(e,t);t.add(e)}function Mr(e,t,i){Dr(e,t);t.set(e,i)}function Dr(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Rr(e,t,i){Lr(e,t);return i}function Lr(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function Br(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var xr=new WeakMap;var zr=new WeakMap;var Ur=new WeakMap;var Wr=new WeakMap;var jr=new WeakMap;var Yr=new WeakMap;var Zr=new WeakMap;var Xr=new WeakSet;var Vr=new WeakSet;var Kr=new WeakSet;var qr=new WeakSet;var Jr=new WeakSet;var $r=function(){function e(t){babelHelpers.classCallCheck(this,e);Gr(this,Jr);Gr(this,qr);Gr(this,Kr);Gr(this,Vr);Gr(this,Xr);Mr(this,xr,{writable:true,value:true});Mr(this,zr,{writable:true,value:true});Mr(this,Ur,{writable:true,value:false});Mr(this,Wr,{writable:true,value:false});Mr(this,jr,{writable:true,value:false});Mr(this,Yr,{writable:true,value:false});Mr(this,Zr,{writable:true,value:{}});if(n.Type.isBoolean(t.isShownRobotGuide)){babelHelpers.classPrivateFieldSet(this,xr,t.isShownRobotGuide)}if(n.Type.isBoolean(t.isShownTriggerGuide)){babelHelpers.classPrivateFieldSet(this,zr,t.isShownTriggerGuide)}}babelHelpers.createClass(e,[{key:"setShowRobotGuide",value:function e(t,i){babelHelpers.classPrivateFieldSet(this,Wr,t);if(t){babelHelpers.classPrivateFieldGet(this,Zr)["robot"]=i!==null&&i!==void 0?i:null}}},{key:"setShowTriggerGuide",value:function e(t,i){babelHelpers.classPrivateFieldSet(this,jr,t);if(t){babelHelpers.classPrivateFieldGet(this,Zr)["trigger"]=i!==null&&i!==void 0?i:null}}},{key:"setShowSupportingRobotGuide",value:function e(t,i){babelHelpers.classPrivateFieldSet(this,Yr,t);if(t){babelHelpers.classPrivateFieldGet(this,Zr)["supportingRobot"]=i!==null&&i!==void 0?i:null}}},{key:"start",value:function e(){Br(this,Xr,Qr).call(this);var t=Br(this,Vr,el).call(this);if(t){var i=t.getCurrentStep().target;if(n.Type.isDomNode(i)&&document.body.contains(i)){t.showNextStep()}}}},{key:"isShownRobotGuide",get:function e(){return babelHelpers.classPrivateFieldGet(this,xr)}},{key:"isShownTriggerGuide",get:function e(){return babelHelpers.classPrivateFieldGet(this,zr)}}]);return e}();function Qr(){if(babelHelpers.classPrivateFieldGet(this,zr)){babelHelpers.classPrivateFieldSet(this,jr,false)}if(babelHelpers.classPrivateFieldGet(this,Ur)){babelHelpers.classPrivateFieldSet(this,Yr,false);babelHelpers.classPrivateFieldSet(this,xr,true)}if(babelHelpers.classPrivateFieldGet(this,xr)){babelHelpers.classPrivateFieldSet(this,Wr,false)}if(babelHelpers.classPrivateFieldGet(this,Yr)){babelHelpers.classPrivateFieldSet(this,xr,true)}}function el(){var e=null;if(babelHelpers.classPrivateFieldGet(this,Yr)){if(n.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,Zr)["supportingRobot"])){e=Br(this,Jr,al).call(this);e.getPopup().setAutoHide(true)}return e}if(babelHelpers.classPrivateFieldGet(this,jr)){if(n.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,Zr)["trigger"])){e=Br(this,qr,il).call(this);e.getPopup().setAutoHide(true)}return e}if(babelHelpers.classPrivateFieldGet(this,Wr)){if(n.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,Zr)["robot"])){e=Br(this,Kr,tl).call(this);e.getPopup().setAutoHide(true)}return e}return e}function tl(){var e=this;var t;return new o.Guide({steps:[{target:babelHelpers.classPrivateFieldGet(this,Zr)["robot"],title:n.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_TITLE"),text:Rr(t=this.constructor,$r,sl).call(t,[n.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_SUBTITLE_1"),n.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_SUBTITLE_2")]),article:"16547618",condition:{top:false,bottom:true,color:"primary"},position:"top",events:{onShow:function t(){babelHelpers.classPrivateFieldSet(e,xr,true)}}}],onEvents:true})}function il(){var e=this;var t;return new o.Guide({steps:[{target:babelHelpers.classPrivateFieldGet(this,Zr)["trigger"],title:n.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_TITLE"),text:Rr(t=this.constructor,$r,sl).call(t,[n.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_SUBTITLE_1"),n.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_SUBTITLE_2")]),article:"16547632",condition:{top:false,bottom:true,color:"primary"},position:"top",events:{onShow:function t(){babelHelpers.classPrivateFieldSet(e,zr,true)}}}],onEvents:true})}function al(){var e=this;var t;return new o.Guide({steps:[{target:babelHelpers.classPrivateFieldGet(this,Zr)["supportingRobot"],title:n.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_TITLE"),text:Rr(t=this.constructor,$r,sl).call(t,[n.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_SUBTITLE_1"),n.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_SUBTITLE_2")]),article:"16547644",condition:{top:false,bottom:true,color:"primary"},position:"top",events:{onShow:function t(){babelHelpers.classPrivateFieldSet(e,Ur,true)}}}],onEvents:true})}function sl(e){var t='<ul class="bizproc-automation-tour-guide-list">';var i=kr(e),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;t+='<li class="bizproc-automation-tour-guide-list-item"> '.concat(n.Text.encode(s)," </li>")}}catch(e){i.e(e)}finally{i.f()}t+="</ul>";return t}var rl;function ll(){if(rl instanceof Fr){return rl}throw new Error("Context is not initialized yet")}function nl(){try{return ll()}catch(e){return null}}function ol(e){if(e instanceof Fr){rl=e}else{throw new Error("Unsupported Context")}return e}e.TemplatesScheme=O;e.Context=Fr;e.getGlobalContext=ll;e.tryGetGlobalContext=nl;e.setGlobalContext=ol;e.TemplateScope=v;e.TriggerManager=Fe;e.Trigger=q;e.Template=ui;e.Robot=Bt;e.UserOptions=Wt;e.Document=De;e.ViewMode=G;e.ConditionGroup=Ei;e.ConditionGroupSelector=Yi;e.Condition=Pi;e.Designer=he;e.SelectorManager=Zi;e.InlineSelector=ca;e.InlineSelectorCondition=Ia;e.InlineSelectorHtml=Da;e.SaveStateCheckbox=qa;e.UserSelector=Qa;e.FileSelector=js;e.TimeSelector=hr;e.DelayInterval=Ye;e.DelayIntervalSelector=Pr;e.HelpHint=J;e.SelectorContext=Er;e.Helper=ne;e.BeginningGuide=Ar;e.AutomationGuide=$r;e.RobotEntry=rt;e.TriggerEntry=lt;e.TrackingEntryBuilder=pt;e.TrackingEntry=Je;e.TrackingStatus=$e;e.Tracker=yt;e.WorkflowStatus=Ze})(this.BX.Bizproc.Automation=this.BX.Bizproc.Automation||{},BX.UI.EntitySelector,BX.Main,BX.Event,BX.Bizproc.Automation,BX,BX,BX,BX.UI.Tour);
//# sourceMappingURL=automation.bundle.map.js