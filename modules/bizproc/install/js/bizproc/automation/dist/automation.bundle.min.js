this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,t,i,a,r,s,l,n,o,c,u,p,b,d){"use strict";function v(e,t,i){h(e,t);t.set(e,i)}function h(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var f=new WeakMap;var g=new WeakMap;var m=new WeakMap;var y=function(){function e(t){babelHelpers.classCallCheck(this,e);v(this,f,{writable:true,value:void 0});v(this,g,{writable:true,value:void 0});v(this,m,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,f,t.DocumentType);babelHelpers.classPrivateFieldSet(this,g,!b.Type.isNil(t.Category.Id)?t.Category:null);babelHelpers.classPrivateFieldSet(this,m,t.Status)}babelHelpers.createClass(e,[{key:"getId",value:function e(){if(this.hasCategory()){return"".concat(babelHelpers.classPrivateFieldGet(this,f).Type,"_").concat(babelHelpers.classPrivateFieldGet(this,g).Id,"_").concat(babelHelpers.classPrivateFieldGet(this,m).Id)}return"".concat(babelHelpers.classPrivateFieldGet(this,f).Type,"_").concat(babelHelpers.classPrivateFieldGet(this,m).Id)}},{key:"getDocumentType",value:function e(){return babelHelpers.classPrivateFieldGet(this,f)}},{key:"getDocumentCategory",value:function e(){return babelHelpers.classPrivateFieldGet(this,g)}},{key:"getDocumentStatus",value:function e(){return babelHelpers.classPrivateFieldGet(this,m)}},{key:"hasCategory",value:function e(){return!b.Type.isNull(babelHelpers.classPrivateFieldGet(this,g))}}]);return e}();function P(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */P=function t(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,a=Object.defineProperty||function(e,t,i){e[t]=i.value},r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",l=r.asyncIterator||"@@asyncIterator",n=r.toStringTag||"@@toStringTag";function o(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(e){o=function e(t,i,a){return t[i]=a}}function c(e,t,i,r){var s=t&&t.prototype instanceof b?t:b,l=Object.create(s.prototype),n=new S(r||[]);return a(l,"_invoke",{value:H(e,i,n)}),l}function u(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var p={};function b(){}function d(){}function v(){}var h={};o(h,s,(function(){return this}));var f=Object.getPrototypeOf,g=f&&f(f(O([])));g&&g!==t&&i.call(g,s)&&(h=g);var m=v.prototype=b.prototype=Object.create(h);function y(e){["next","throw","return"].forEach((function(t){o(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(a,s,l,n){var o=u(e[a],e,s);if("throw"!==o.type){var c=o.arg,p=c.value;return p&&"object"==babelHelpers["typeof"](p)&&i.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,l,n)}),(function(e){r("throw",e,l,n)})):t.resolve(p).then((function(e){c.value=e,l(c)}),(function(e){return r("throw",e,l,n)}))}n(o.arg)}var s;a(this,"_invoke",{value:function e(i,a){function l(){return new t((function(e,t){r(i,a,e,t)}))}return s=s?s.then(l,l):l()}})}function H(e,t,i){var a="suspendedStart";return function(r,s){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw s;return w()}for(i.method=r,i.arg=s;;){var l=i.delegate;if(l){var n=I(l,i);if(n){if(n===p)continue;return n}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===a)throw a="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a="executing";var o=u(e,t,i);if("normal"===o.type){if(a=i.done?"completed":"suspendedYield",o.arg===p)continue;return{value:o.arg,done:i.done}}"throw"===o.type&&(a="completed",i.method="throw",i.arg=o.arg)}}}function I(e,t){var i=t.method,a=e.iterator[i];if(undefined===a)return t.delegate=null,"throw"===i&&e.iterator["return"]&&(t.method="return",t.arg=undefined,I(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),p;var r=u(a,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,p;var s=r.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,p):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function F(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(F,this),this.reset(!0)}function O(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,r=function t(){for(;++a<e.length;)if(i.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=undefined,t.done=!0,t};return r.next=r}}return{next:w}}function w(){return{value:undefined,done:!0}}return d.prototype=v,a(m,"constructor",{value:v,configurable:!0}),a(v,"constructor",{value:d,configurable:!0}),d.displayName=o(v,n,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,o(e,n,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(T.prototype),o(T.prototype,l,(function(){return this})),e.AsyncIterator=T,e.async=function(t,i,a,r,s){void 0===s&&(s=Promise);var l=new T(c(t,i,a,r),s);return e.isGeneratorFunction(i)?l:l.next().then((function(e){return e.done?e.value:l.next()}))},y(m),o(m,n,"Generator"),o(m,s,(function(){return this})),o(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),i=[];for(var a in t)i.push(a);return i.reverse(),function e(){for(;i.length;){var a=i.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},e.values=O,S.prototype={constructor:S,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(E),!t)for(var a in this)"t"===a.charAt(0)&&i.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var a=this;function r(e,i){return n.type="throw",n.arg=t,a.next=e,i&&(a.method="next",a.arg=undefined),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var l=this.tryEntries[s],n=l.completion;if("root"===l.tryLoc)return r("end");if(l.tryLoc<=this.prev){var o=i.call(l,"catchLoc"),c=i.call(l,"finallyLoc");if(o&&c){if(this.prev<l.catchLoc)return r(l.catchLoc,!0);if(this.prev<l.finallyLoc)return r(l.finallyLoc)}else if(o){if(this.prev<l.catchLoc)return r(l.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<l.finallyLoc)return r(l.finallyLoc)}}}},abrupt:function e(t,a){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(s.tryLoc<=this.prev&&i.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var l=s;break}}l&&("break"===t||"continue"===t)&&l.tryLoc<=a&&a<=l.finallyLoc&&(l=null);var n=l?l.completion:{};return n.type=t,n.arg=a,l?(this.method="next",this.next=l.finallyLoc,p):this.complete(n)},complete:function e(t,i){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&i&&(this.next=i),p},finish:function e(t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),E(a),p}},catch:function e(t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc===t){var r=a.completion;if("throw"===r.type){var s=r.arg;E(a)}return s}}throw new Error("illegal catch attempt")},delegateYield:function e(t,i,a){return this.delegate={iterator:O(t),resultName:i,nextLoc:a},"next"===this.method&&(this.arg=undefined),p}},e}function T(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=H(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function H(e,t){if(!e)return;if(typeof e==="string")return I(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return I(e,t)}function I(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function F(e,t){S(e,t);t.add(e)}function E(e,t,i){S(e,t);t.set(e,i)}function S(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function O(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var w=new WeakMap;var k=new WeakSet;var C=function(){function e(t){var i=this;babelHelpers.classCallCheck(this,e);F(this,k);E(this,w,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,w,[]);if(b.Type.isArray(t)){t.forEach((function(e){var t=new y(e);babelHelpers.classPrivateFieldGet(i,w).push(t)}))}}babelHelpers.createClass(e,[{key:"getDocumentTypes",value:function e(){var t=new Map;var i=T(babelHelpers.classPrivateFieldGet(this,w)),a;try{for(i.s();!(a=i.n()).done;){var r=a.value;t.set(r.getDocumentType().Type,r.getDocumentType())}}catch(e){i.e(e)}finally{i.f()}return Array.from(t.values())}},{key:"getTypeCategories",value:function e(t){var i=new Map;var a=T(babelHelpers.classPrivateFieldGet(this,w)),r;try{for(a.s();!(r=a.n()).done;){var s=r.value;if(s.hasCategory()&&s.getDocumentType().Type===t.Type){var l=s.getDocumentCategory();i.set(l.Id,l)}}}catch(e){a.e(e)}finally{a.f()}return Array.from(i.values())}},{key:"getTypeStatuses",value:function e(t,i){var a=new Set;if(b.Type.isNil(i)){i={Id:null}}var r=function e(r){var s=r.getDocumentType().Type===t.Type&&(r.hasCategory()?r.getDocumentCategory().Id===i.Id:true)&&!a.has(r.getDocumentStatus().Id);if(s){a.add(r.getDocumentStatus().Id)}return s};return Array.from(O(this,k,_).call(this,r)).map((function(e){return e.getDocumentStatus()}))}}]);return e}();function _(e){var t=P().mark((function t(i){var a,r,s;return P().wrap((function t(l){while(1)switch(l.prev=l.next){case 0:a=T(i);l.prev=1;a.s();case 3:if((r=a.n()).done){l.next=10;break}s=r.value;if(!e(s)){l.next=8;break}l.next=8;return s;case 8:l.next=3;break;case 10:l.next=15;break;case 12:l.prev=12;l.t0=l["catch"](1);a.e(l.t0);case 15:l.prev=15;a.f();return l.finish(15);case 18:case"end":return l.stop()}}),t,null,[[1,12,15,18]])}));return t(babelHelpers.classPrivateFieldGet(this,w))}function G(e,t,i){A(e,t);t.set(e,i)}function A(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var N=new WeakMap;var M=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));G(babelHelpers.assertThisInitialized(i),N,{writable:true,value:void 0});i.setEventNamespace("BX.Bizproc.Automation.Context");if(b.Type.isPlainObject(e)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),N,e)}return i}babelHelpers.createClass(t,[{key:"clone",value:function e(){return new t(b.clone(babelHelpers.classPrivateFieldGet(this,N)))}},{key:"getValues",value:function e(){return babelHelpers.classPrivateFieldGet(this,N)}},{key:"set",value:function e(t,i){var a=this.has(t);babelHelpers.classPrivateFieldGet(this,N)[t]=i;this.emit(a?"valueChanged":"valueAdded",{name:t,value:i});return this}},{key:"get",value:function e(t){return babelHelpers.classPrivateFieldGet(this,N)[t]}},{key:"has",value:function e(t){return babelHelpers.classPrivateFieldGet(this,N).hasOwnProperty(t)}},{key:"subsribeValueChanges",value:function e(t,i){this.subscribe("valueChanged",(function(e){if(e.data.name===t){i(e)}}));return this}}]);return t}(r.EventEmitter);var D=function(e){babelHelpers.inherits(t,e);function t(e){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e))}babelHelpers.createClass(t,[{key:"clone",value:function e(){var i;return new t(b.Runtime.clone(this.getValues())).set("document",this.document.clone()).set("userOptions",(i=this.userOptions)===null||i===void 0?void 0:i.clone())}},{key:"getAvailableTrigger",value:function e(t){return this.availableTriggers.find((function(e){return e["CODE"]===t}))}},{key:"document",get:function e(){return this.get("document")}},{key:"signedDocument",get:function e(){var t;return(t=this.get("signedDocument"))!==null&&t!==void 0?t:""}},{key:"ajaxUrl",get:function e(){var t;return(t=this.get("ajaxUrl"))!==null&&t!==void 0?t:""}},{key:"availableRobots",get:function e(){var t=this.get("availableRobots");if(b.Type.isArray(t)){return t}return[]}},{key:"availableTriggers",get:function e(){var t=this.get("availableTriggers");if(b.Type.isArray(t)){return t}return[]}},{key:"canManage",get:function e(){var t=this.get("canManage");return b.Type.isBoolean(t)&&t}},{key:"canEdit",get:function e(){var t=this.get("canEdit");return b.Type.isBoolean(t)&&t}},{key:"userOptions",get:function e(){return this.get("userOptions")}},{key:"tracker",get:function e(){return this.get("tracker")},set:function e(t){this.set("tracker",t)}},{key:"bizprocEditorUrl",get:function e(){return this.get("bizprocEditorUrl")}},{key:"constantsEditorUrl",get:function e(){return this.get("constantsEditorUrl")}},{key:"parametersEditorUrl",get:function e(){return this.get("parametersEditorUrl")}},{key:"automationGlobals",get:function e(){return this.get("automationGlobals")}}]);return t}(M);function R(e,t,i){L(e,t);t.set(e,i)}function L(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function B(e,t,i){z(e,t);x(i,"get");return U(e,i)}function x(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function z(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function U(e,t){if(t.get){return t.get.call(e)}return t.value}var W=new WeakMap;var j=new WeakMap;var Y=function(){function e(t){babelHelpers.classCallCheck(this,e);R(this,W,{writable:true,value:void 0});R(this,j,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,W,t);babelHelpers.classPrivateFieldSet(this,j,{})}babelHelpers.createClass(e,[{key:"isNone",value:function t(){return babelHelpers.classPrivateFieldGet(this,W)===B(e,e,V)}},{key:"isView",value:function t(){return babelHelpers.classPrivateFieldGet(this,W)===B(e,e,X)}},{key:"isEdit",value:function t(){return babelHelpers.classPrivateFieldGet(this,W)===B(e,e,Z)}},{key:"isManage",value:function t(){return babelHelpers.classPrivateFieldGet(this,W)===B(e,e,q)}},{key:"setProperty",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,j)[t]=i;return this}},{key:"getProperty",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(babelHelpers.classPrivateFieldGet(this,j).hasOwnProperty(t)){return babelHelpers.classPrivateFieldGet(this,j)[t]}return i}},{key:"intoRaw",value:function e(){return babelHelpers.classPrivateFieldGet(this,W)}}],[{key:"none",value:function t(){return new e(B(e,e,V))}},{key:"view",value:function t(){return new e(B(e,e,X))}},{key:"edit",value:function t(){return new e(B(e,e,Z))}},{key:"manage",value:function t(){return new e(B(e,e,q))}},{key:"fromRaw",value:function t(i){if(e.getAll().includes(i)){return new e(i)}return e.none()}},{key:"getAll",value:function t(){return[B(this,e,V),B(this,e,X),B(this,e,Z),B(this,e,q)]}}]);return e}();var V={writable:true,value:0};var X={writable:true,value:1};var Z={writable:true,value:2};var q={writable:true,value:3};function K(e,t,i){J(e,t);t.set(e,i)}function J(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Q=new WeakMap;var $=new WeakMap;var ee=new WeakMap;var te=new WeakMap;var ie=new WeakMap;var ae=new WeakMap;var re=new WeakMap;var se=new WeakMap;var le=new WeakMap;var ne=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));K(babelHelpers.assertThisInitialized(e),Q,{writable:true,value:void 0});K(babelHelpers.assertThisInitialized(e),$,{writable:true,value:void 0});K(babelHelpers.assertThisInitialized(e),ee,{writable:true,value:void 0});K(babelHelpers.assertThisInitialized(e),te,{writable:true,value:void 0});K(babelHelpers.assertThisInitialized(e),ie,{writable:true,value:void 0});K(babelHelpers.assertThisInitialized(e),ae,{writable:true,value:void 0});K(babelHelpers.assertThisInitialized(e),re,{writable:true,value:void 0});K(babelHelpers.assertThisInitialized(e),se,{writable:true,value:void 0});K(babelHelpers.assertThisInitialized(e),le,{writable:true,value:void 0});e.setEventNamespace("BX.Bizproc.Automation");e.draft=false;babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),Q,{});babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),$,false);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),ee,Y.none());babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),te,new c.ConditionGroup);return e}babelHelpers.createClass(t,[{key:"init",value:function e(t,i){babelHelpers.classPrivateFieldSet(this,Q,b.clone(t));if(!b.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,Q)["APPLY_RULES"])){babelHelpers.classPrivateFieldGet(this,Q)["APPLY_RULES"]={}}if(babelHelpers.classPrivateFieldGet(this,Q)["APPLY_RULES"].Condition){babelHelpers.classPrivateFieldSet(this,te,new c.ConditionGroup(babelHelpers.classPrivateFieldGet(this,Q)["APPLY_RULES"].Condition))}else{babelHelpers.classPrivateFieldSet(this,te,new c.ConditionGroup)}babelHelpers.classPrivateFieldSet(this,ee,b.Type.isNil(i)?Y.edit():i);babelHelpers.classPrivateFieldSet(this,ie,this.createNode())}},{key:"reInit",value:function e(t,i){var a=babelHelpers.classPrivateFieldGet(this,ie);babelHelpers.classPrivateFieldSet(this,ie,this.createNode());if(a.parentNode){a.parentNode.replaceChild(babelHelpers.classPrivateFieldGet(this,ie),a)}}},{key:"canEdit",value:function e(){return c.getGlobalContext().canEdit}},{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,Q)["ID"]||0}},{key:"getStatusId",value:function e(){return String(babelHelpers.classPrivateFieldGet(this,Q)["DOCUMENT_STATUS"]||"")}},{key:"getStatus",value:function e(){var t=this;return c.getGlobalContext().document.statusList.find((function(e){return String(e.STATUS_ID)===t.getStatusId()}))}},{key:"getCode",value:function e(){var t;return(t=babelHelpers.classPrivateFieldGet(this,Q)["CODE"])!==null&&t!==void 0?t:""}},{key:"getName",value:function e(){var t=babelHelpers.classPrivateFieldGet(this,Q)["NAME"];if(!t){var i;var a=this.getCode();var r=c.getGlobalContext().availableTriggers.find((function(e){return a===e["CODE"]}));t=(i=r===null||r===void 0?void 0:r.NAME)!==null&&i!==void 0?i:a}return t}},{key:"setName",value:function e(t){if(b.Type.isString(t)){babelHelpers.classPrivateFieldGet(this,Q)["NAME"]=t}return this}},{key:"getApplyRules",value:function e(){return babelHelpers.classPrivateFieldGet(this,Q)["APPLY_RULES"]}},{key:"setApplyRules",value:function e(t){babelHelpers.classPrivateFieldGet(this,Q)["APPLY_RULES"]=t;return this}},{key:"getLogStatus",value:function e(){var t=c.getGlobalContext().tracker.getTriggerLog(this.getId());return t?t.status:null}},{key:"getCondition",value:function e(){return babelHelpers.classPrivateFieldGet(this,te)}},{key:"setCondition",value:function e(t){babelHelpers.classPrivateFieldSet(this,te,t);return this}},{key:"isBackwardsAllowed",value:function e(){return babelHelpers.classPrivateFieldGet(this,Q)["APPLY_RULES"]["ALLOW_BACKWARDS"]==="Y"}},{key:"setAllowBackwards",value:function e(t){babelHelpers.classPrivateFieldGet(this,Q)["APPLY_RULES"]["ALLOW_BACKWARDS"]=t?"Y":"N";return this}},{key:"getExecuteBy",value:function e(){return babelHelpers.classPrivateFieldGet(this,Q)["APPLY_RULES"]["ExecuteBy"]||""}},{key:"setExecuteBy",value:function e(t){babelHelpers.classPrivateFieldGet(this,Q)["APPLY_RULES"]["ExecuteBy"]=t;return this}},{key:"createNode",value:function e(){var t="bizproc-automation-trigger-item-wrapper";if(babelHelpers.classPrivateFieldGet(this,ee).isEdit()&&this.canEdit()){t+=" bizproc-automation-trigger-item-wrapper-draggable"}var i=null;var a=null;if(babelHelpers.classPrivateFieldGet(this,ee).isEdit()){i=b.Dom.create("div",{attrs:{className:"bizproc-automation-trigger-item-wrapper-edit"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EDIT")});a=b.Dom.create("div",{attrs:{className:"bizproc-automation-trigger-btn-copy"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_COPY")||"copy"});b.Event.bind(a,"click",this.onCopyButtonClick.bind(this,a))}if(this.getLogStatus()===c.TrackingStatus.COMPLETED){t+=" bizproc-automation-trigger-item-wrapper-complete"}else if(c.getGlobalContext().document.getPreviousStatusIdList().includes(this.getStatusId())){t+=" bizproc-automation-trigger-item-wrapper-complete-light"}var r=this.getName();var s="bizproc-automation-trigger-item";if(this.getLogStatus()===c.TrackingStatus.COMPLETED){s+=" --complete"}else if(this.draft){s+=" --draft"}var l=b.Dom.create("DIV",{attrs:{"data-role":"trigger-container",className:s,"data-type":"item-trigger"},children:[b.Dom.create("div",{attrs:{className:t},children:[b.Dom.create("div",{attrs:{className:"bizproc-automation-trigger-item-wrapper-text",title:r},text:r})]}),a,i]});if(!babelHelpers.classPrivateFieldGet(this,ee).isEdit()){return l}if(this.canEdit()){this.registerItem(l)}var n=b.Dom.create("SPAN",{attrs:{"data-role":"btn-delete-trigger",className:"bizproc-automation-trigger-btn-delete"}});b.Event.bind(n,"click",this.onDeleteButtonClick.bind(this,n));l.appendChild(n);if(babelHelpers.classPrivateFieldGet(this,ee).isEdit()){b.Event.bind(l,"click",this.onSettingsButtonClick.bind(this,l))}return l}},{key:"onSettingsButtonClick",value:function e(t){if(!this.canEdit()){c.HelpHint.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,ee).isManage()){this.emit("Trigger:onSettingsOpen",{trigger:this})}}},{key:"onCopyButtonClick",value:function e(i,a){a.stopPropagation();if(!this.canEdit()){c.HelpHint.showNoPermissionsHint(i)}else if(!babelHelpers.classPrivateFieldGet(this,ee).isManage()){var r=new t;var s=this.serialize();delete s["ID"];var l=this.getSettingProperties().filter((function(e){return e.Copyable===false})).map((function(e){return e.Id}));l.forEach((function(e){return delete s["APPLY_RULES"][e]}));r.init(s,babelHelpers.classPrivateFieldGet(this,ee));this.emit("Trigger:copied",{trigger:r})}}},{key:"onSearch",value:function e(t){if(!babelHelpers.classPrivateFieldGet(this,ie)){return}var i=t.getData().queryString;var a=!i||this.getName().toLowerCase().indexOf(i)>=0;b.Dom[a?"removeClass":"addClass"](babelHelpers.classPrivateFieldGet(this,ie),"--search-mismatch")}},{key:"registerItem",value:function e(t){if(b.Type.isNil(t["__bxddid"])){t.onbxdragstart=BX.proxy(this.dragStart,this);t.onbxdrag=BX.proxy(this.dragMove,this);t.onbxdragstop=BX.proxy(this.dragStop,this);t.onbxdraghover=BX.proxy(this.dragOver,this);jsDD.registerObject(t);jsDD.registerDest(t,1)}}},{key:"unregisterItem",value:function e(t){t.onbxdragstart=undefined;t.onbxdrag=undefined;t.onbxdragstop=undefined;t.onbxdraghover=undefined;jsDD.unregisterObject(t);jsDD.unregisterDest(t)}},{key:"dragStart",value:function e(){babelHelpers.classPrivateFieldSet(this,ae,BX.proxy_context);if(!babelHelpers.classPrivateFieldGet(this,ae)){jsDD.stopCurrentDrag();return}if(!babelHelpers.classPrivateFieldGet(this,le)){var t=babelHelpers.classPrivateFieldGet(this,ae).offsetWidth;babelHelpers.classPrivateFieldSet(this,le,babelHelpers.classPrivateFieldGet(this,ae).cloneNode(true));babelHelpers.classPrivateFieldGet(this,le).style.position="absolute";babelHelpers.classPrivateFieldGet(this,le).classList.add("bizproc-automation-trigger-item-drag");babelHelpers.classPrivateFieldGet(this,le).style.width=t+"px";document.body.appendChild(babelHelpers.classPrivateFieldGet(this,le))}}},{key:"dragMove",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,le).style.left=t+"px";babelHelpers.classPrivateFieldGet(this,le).style.top=i+"px"}},{key:"dragOver",value:function e(t,i,a){if(babelHelpers.classPrivateFieldGet(this,re)){babelHelpers.classPrivateFieldGet(this,re).classList.remove("bizproc-automation-trigger-item-pre")}if(babelHelpers.classPrivateFieldGet(this,se)){babelHelpers.classPrivateFieldGet(this,se).classList.remove("bizproc-automation-trigger-list-pre")}var r=t.getAttribute("data-type");if(r==="item-trigger"){babelHelpers.classPrivateFieldSet(this,re,t);babelHelpers.classPrivateFieldSet(this,se,null)}if(r==="column-trigger"){babelHelpers.classPrivateFieldSet(this,se,t.querySelector('[data-role="trigger-list"]'));babelHelpers.classPrivateFieldSet(this,re,null)}if(babelHelpers.classPrivateFieldGet(this,re)){babelHelpers.classPrivateFieldGet(this,re).classList.add("bizproc-automation-trigger-item-pre")}if(babelHelpers.classPrivateFieldGet(this,se)){babelHelpers.classPrivateFieldGet(this,se).classList.add("bizproc-automation-trigger-list-pre")}}},{key:"dragStop",value:function e(i,a,r){var s=this;r=r||window.event;var l=null;var n=r&&(r.ctrlKey||r.metaKey);var o=function e(i,a){var r=new t;var l=i.serialize();delete l["ID"];var n=s.getSettingProperties().filter((function(e){return e.Copyable===false})).map((function(e){return e.Id}));n.forEach((function(e){return delete l["APPLY_RULES"][e]}));l["DOCUMENT_STATUS"]=a;r.init(l,babelHelpers.classPrivateFieldGet(i,ee));return r};if(babelHelpers.classPrivateFieldGet(this,ae)){if(babelHelpers.classPrivateFieldGet(this,re)){babelHelpers.classPrivateFieldGet(this,re).classList.remove("bizproc-automation-trigger-item-pre");var c=babelHelpers.classPrivateFieldGet(this,re).parentNode;if(!n){c.insertBefore(babelHelpers.classPrivateFieldGet(this,ae),babelHelpers.classPrivateFieldGet(this,re));this.moveTo(c.getAttribute("data-status-id"))}else{l=o(this,c.getAttribute("data-status-id"));c.insertBefore(babelHelpers.classPrivateFieldGet(l,ie),babelHelpers.classPrivateFieldGet(this,re))}}else if(babelHelpers.classPrivateFieldGet(this,se)){babelHelpers.classPrivateFieldGet(this,se).classList.remove("bizproc-automation-trigger-list-pre");if(!n){babelHelpers.classPrivateFieldGet(this,se).appendChild(babelHelpers.classPrivateFieldGet(this,ae));this.moveTo(babelHelpers.classPrivateFieldGet(this,se).getAttribute("data-status-id"))}else{l=o(this,babelHelpers.classPrivateFieldGet(this,se).getAttribute("data-status-id"));babelHelpers.classPrivateFieldGet(this,se).appendChild(babelHelpers.classPrivateFieldGet(l,ie))}}if(l){this.emit("Trigger:copied",{trigger:l,skipInsert:true})}}babelHelpers.classPrivateFieldGet(this,le).parentNode.removeChild(babelHelpers.classPrivateFieldGet(this,le));babelHelpers.classPrivateFieldSet(this,le,null);babelHelpers.classPrivateFieldSet(this,ae,null);babelHelpers.classPrivateFieldSet(this,re,null)}},{key:"onDeleteButtonClick",value:function e(t,i){i.stopPropagation();if(!this.canEdit()){c.HelpHint.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,ee).isManage()){b.Dom.remove(t.parentNode);this.emit("Trigger:deleted",{trigger:this})}}},{key:"updateData",value:function e(t){if(b.Type.isPlainObject(t)){babelHelpers.classPrivateFieldSet(this,Q,t)}else{throw"Invalid data"}}},{key:"markDeleted",value:function e(){babelHelpers.classPrivateFieldSet(this,$,true);return this}},{key:"serialize",value:function e(){var t=b.clone(babelHelpers.classPrivateFieldGet(this,Q));if(babelHelpers.classPrivateFieldGet(this,$)){t["DELETED"]="Y"}if(!b.Type.isPlainObject(t.APPLY_RULES)){t.APPLY_RULES={}}if(!babelHelpers.classPrivateFieldGet(this,te).items.length){delete t.APPLY_RULES.Condition}else{t.APPLY_RULES.Condition=babelHelpers.classPrivateFieldGet(this,te).serialize()}return t}},{key:"moveTo",value:function e(t){babelHelpers.classPrivateFieldGet(this,Q)["DOCUMENT_STATUS"]=t;this.emit("Trigger:modified",{trigger:this})}},{key:"getReturnProperties",value:function e(){var t=this;var i=c.getGlobalContext().availableTriggers.find((function(e){return e["CODE"]===t.getCode()}));return i&&b.Type.isArray(i.RETURN)?i.RETURN:[]}},{key:"getSettingProperties",value:function e(){var t=this;var i=c.getGlobalContext().availableTriggers.find((function(e){return e["CODE"]===t.getCode()}));if(i.SETTINGS&&i.SETTINGS.Properties){return i.SETTINGS.Properties}return[]}},{key:"node",get:function e(){return babelHelpers.classPrivateFieldGet(this,ie)}},{key:"deleted",get:function e(){return babelHelpers.classPrivateFieldGet(this,$)}},{key:"documentStatus",get:function e(){var t;return(t=babelHelpers.classPrivateFieldGet(this,Q)["DOCUMENT_STATUS"])!==null&&t!==void 0?t:""}}]);return t}(r.EventEmitter);function oe(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=ce(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function ce(e,t){if(!e)return;if(typeof e==="string")return ue(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ue(e,t)}function ue(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function pe(e,t,i,a){he(e,t);ve(i,"set");be(e,i,a);return a}function be(e,t,i){if(t.set){t.set.call(e,i)}else{if(!t.writable){throw new TypeError("attempted to set read only private field")}t.value=i}}function de(e,t,i){he(e,t);ve(i,"get");return fe(e,i)}function ve(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function he(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function fe(e,t){if(t.get){return t.get.call(e)}return t.value}var ge=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"generateUniqueId",value:function t(){var i;pe(e,e,me,(i=de(e,e,me),++i));return"bizproc-automation-cmp-"+de(e,e,me)}},{key:"toJsonString",value:function e(t){return JSON.stringify(t,(function(e,t){if(typeof t=="boolean"){return t?"1":"0"}return t}))}},{key:"getResponsibleUserExpression",value:function e(t){if(b.Type.isArray(t)){var i=oe(t),a;try{for(i.s();!(a=i.n()).done;){var r=a.value;if(r["Id"]==="ASSIGNED_BY_ID"||r["Id"]==="RESPONSIBLE_ID"){return"{{"+r["Name"]+"}}"}}}catch(e){i.e(e)}finally{i.f()}}return null}}]);return e}();var me={writable:true,value:0};function ye(e,t,i,a){Ie(e,t);He(i,"set");Pe(e,i,a);return a}function Pe(e,t,i){if(t.set){t.set.call(e,i)}else{if(!t.writable){throw new TypeError("attempted to set read only private field")}t.value=i}}function Te(e,t,i){Ie(e,t);He(i,"get");return Fe(e,i)}function He(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function Ie(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function Fe(e,t){if(t.get){return t.get.call(e)}return t.value}var Ee=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"setRobotSettingsDialog",value:function e(t){this.robotSettingsDialog=t;this.robot=t?t.robot:null}},{key:"getRobotSettingsDialog",value:function e(){return this.robotSettingsDialog}},{key:"setTriggerSettingsDialog",value:function e(t){this.triggerSettingsDialog=t}},{key:"getTriggerSettingsDialog",value:function e(){return this.triggerSettingsDialog}}],[{key:"getInstance",value:function t(){if(!Te(e,e,Se)){ye(e,e,Se,new e)}return Te(e,e,Se)}}]);return e}();var Se={writable:true,value:void 0};function Oe(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function we(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Oe(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function ke(e,t){_e(e,t);t.add(e)}function Ce(e,t,i){_e(e,t);t.set(e,i)}function _e(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Ge(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Ae=new WeakMap;var Ne=new WeakMap;var Me=new WeakMap;var De=new WeakMap;var Re=new WeakMap;var Le=new WeakMap;var Be=new WeakMap;var xe=new WeakSet;var ze=new WeakSet;var Ue=new WeakSet;var We=new WeakSet;var je=new WeakSet;var Ye=new WeakSet;var Ve=new WeakSet;var Xe=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));ke(babelHelpers.assertThisInitialized(i),Ve);ke(babelHelpers.assertThisInitialized(i),Ye);ke(babelHelpers.assertThisInitialized(i),je);ke(babelHelpers.assertThisInitialized(i),We);ke(babelHelpers.assertThisInitialized(i),Ue);ke(babelHelpers.assertThisInitialized(i),ze);ke(babelHelpers.assertThisInitialized(i),xe);Ce(babelHelpers.assertThisInitialized(i),Ae,{writable:true,value:void 0});Ce(babelHelpers.assertThisInitialized(i),Ne,{writable:true,value:void 0});Ce(babelHelpers.assertThisInitialized(i),Me,{writable:true,value:void 0});Ce(babelHelpers.assertThisInitialized(i),De,{writable:true,value:void 0});Ce(babelHelpers.assertThisInitialized(i),Re,{writable:true,value:void 0});Ce(babelHelpers.assertThisInitialized(i),Le,{writable:true,value:void 0});Ce(babelHelpers.assertThisInitialized(i),Be,{writable:true,value:void 0});i.setEventNamespace("BX.Bizproc.Automation");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Ae,e);return i}babelHelpers.createClass(t,[{key:"init",value:function e(t,i){if(!b.Type.isPlainObject(t)){t={}}babelHelpers.classPrivateFieldSet(this,Ne,i.isNone()?Y.edit():i);babelHelpers.classPrivateFieldSet(this,De,b.Type.isArray(t.TRIGGERS)?t.TRIGGERS:[]);babelHelpers.classPrivateFieldSet(this,Re,document.querySelectorAll('[data-type="column-trigger"]'));babelHelpers.classPrivateFieldSet(this,Le,babelHelpers.classPrivateFieldGet(this,Ae).querySelectorAll('[data-role="trigger-list"]'));babelHelpers.classPrivateFieldSet(this,Be,false);this.initTriggers();this.markModified(false);babelHelpers.classPrivateFieldGet(this,Re).forEach((function(e){return jsDD.registerDest(e,10)}));top.BX.addCustomEvent(top,"Rest:AppLayout:ApplicationInstall",this.onRestAppInstall.bind(this))}},{key:"reInit",value:function e(t,i){if(!b.Type.isPlainObject(t)){t={}}babelHelpers.classPrivateFieldSet(this,Ne,i||Y.none());babelHelpers.classPrivateFieldGet(this,Le).forEach((function(e){return b.Dom.clean(e)}));babelHelpers.classPrivateFieldSet(this,De,b.Type.isArray(t.TRIGGERS)?t.TRIGGERS:[]);this.initTriggers();this.markModified(false)}},{key:"initTriggers",value:function e(){var t=this;babelHelpers.classPrivateFieldSet(this,Me,[]);babelHelpers.classPrivateFieldGet(this,De).forEach((function(e){var i=new ne;i.init(e,babelHelpers.classPrivateFieldGet(t,Ne));t.subscribeTriggerEvents(i);t.insertTriggerNode(i.getStatusId(),i.node);babelHelpers.classPrivateFieldGet(t,Me).push(i)}))}},{key:"subscribeTriggerEvents",value:function e(t){var i=this;t.subscribe("Trigger:copied",(function(e){var t=e.data.trigger;babelHelpers.classPrivateFieldGet(i,Me).push(t);if(!e.data.skipInsert){i.insertTriggerNode(t.getStatusId(),t.node)}i.subscribeTriggerEvents(t);i.markModified()}));t.subscribe("Trigger:modified",(function(){return i.markModified()}));t.subscribe("Trigger:onSettingsOpen",(function(e){i.openTriggerSettingsDialog(e.data.trigger)}));t.subscribe("Trigger:deleted",(function(e){return i.deleteTrigger(e.data.trigger)}))}},{key:"onSearch",value:function e(t){babelHelpers.classPrivateFieldGet(this,Me).forEach((function(e){return e.onSearch(t)}))}},{key:"enableManageMode",value:function e(){babelHelpers.classPrivateFieldSet(this,Ne,Y.manage());var t=document.querySelectorAll('[data-role="btn-delete-trigger"]');t.forEach((function(e){return b.Dom.hide(e)}));babelHelpers.classPrivateFieldGet(this,Me).forEach((function(e){return b.Dom.addClass(e.node,"--locked-node")}))}},{key:"disableManageMode",value:function e(){babelHelpers.classPrivateFieldSet(this,Ne,Y.edit());var t=document.querySelectorAll('[data-role="btn-delete-trigger"]');t.forEach((function(e){return b.Dom.show(e)}));babelHelpers.classPrivateFieldGet(this,Me).forEach((function(e){return b.Dom.removeClass(e.node,"--locked-node")}))}},{key:"addTrigger",value:function e(t,i){var a=new ne;a.draft=true;a.init(t,babelHelpers.classPrivateFieldGet(this,Ne));this.subscribeTriggerEvents(a);if(i){i.call(this,a)}this.emit("TriggerManager:trigger:add",{trigger:a})}},{key:"deleteTrigger",value:function e(t,i){if(t.getId()>0){t.markDeleted()}else{for(var a=0;a<babelHelpers.classPrivateFieldGet(this,Me).length;++a){if(babelHelpers.classPrivateFieldGet(this,Me)[a]===t){babelHelpers.classPrivateFieldGet(this,Me).splice(a,1)}}}if(i){i(t)}this.emit("TriggerManager:trigger:delete",{trigger:t});this.markModified()}},{key:"enableDragAndDrop",value:function e(){babelHelpers.classPrivateFieldGet(this,Me).forEach((function(e){return e.registerItem(e.node)}));babelHelpers.classPrivateFieldGet(this,Ae).querySelectorAll(".bizproc-automation-trigger-item-wrapper").forEach((function(e){b.Dom.addClass(e,"bizproc-automation-trigger-item-wrapper-draggable")}))}},{key:"disableDragAndDrop",value:function e(){babelHelpers.classPrivateFieldGet(this,Me).forEach((function(e){return e.unregisterItem(e.node)}));babelHelpers.classPrivateFieldGet(this,Ae).querySelectorAll(".bizproc-automation-trigger-item-wrapper").forEach((function(e){b.Dom.removeClass(e,"bizproc-automation-trigger-item-wrapper-draggable")}))}},{key:"insertTrigger",value:function e(t){babelHelpers.classPrivateFieldGet(this,Me).push(t);this.markModified(true)}},{key:"insertTriggerNode",value:function e(t,i){var a=babelHelpers.classPrivateFieldGet(this,Ae).querySelector('[data-role="trigger-list"][data-status-id="'+t+'"]');if(a){b.Dom.append(i,a)}}},{key:"serialize",value:function e(){return babelHelpers.classPrivateFieldGet(this,Me).map((function(e){return e.serialize()}))}},{key:"countAllTriggers",value:function e(){return babelHelpers.classPrivateFieldGet(this,Me).filter((function(e){return!e.deleted})).length}},{key:"getTriggerName",value:function e(t){var i,a;return(i=(a=c.getGlobalContext().availableTriggers.find((function(e){return t===e["CODE"]})))===null||a===void 0?void 0:a.NAME)!==null&&i!==void 0?i:t}},{key:"getAvailableTrigger",value:function e(t){var i=c.getGlobalContext().availableTriggers;for(var a=0;a<i.length;++a){if(t===i[a]["CODE"]){return i[a]}}return null}},{key:"canEdit",value:function e(){return c.getGlobalContext().canEdit}},{key:"canSetExecuteBy",value:function e(){var t;return(t=c.getGlobalContext().get("TRIGGER_CAN_SET_EXECUTE_BY"))!==null&&t!==void 0?t:false}},{key:"needSave",value:function e(){return babelHelpers.classPrivateFieldGet(this,Be)}},{key:"markModified",value:function e(t){babelHelpers.classPrivateFieldSet(this,Be,t!==false);if(babelHelpers.classPrivateFieldGet(this,Be)){this.emit("TriggerManager:dataModified")}}},{key:"openTriggerSettingsDialog",value:function e(t,i){var a=this;if(Ee.getInstance().getTriggerSettingsDialog()){if(i&&i.changeTrigger){Ee.getInstance().getTriggerSettingsDialog().popup.close()}else{return}}var r="bizproc_automation_trigger_dialog";var s=b.Dom.create("form",{props:{name:r},style:{"min-width":"540px"}});b.Dom.append(this.renderConditionSettings(t),s);var l=b.Dom.create("div",{attrs:{className:"bizproc-automation-robot-help"},events:{click:function e(t){return a.emit("TriggerManager:onHelpClick",t)}}});b.Dom.append(l,s);var n=this.getTriggerName(t.getCode());b.Dom.append(b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TRIGGER_NAME")+":"}),s);b.Dom.append(b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[b.Dom.create("input",{attrs:{className:"bizproc-automation-popup-input",type:"text",name:"name",value:t.getName()||n}})]}),s);var o=this.getAvailableTrigger(t.getCode());if(o&&o["SETTINGS"]){Ge(this,xe,Ze).call(this,t,o["SETTINGS"]["Properties"],s)}BX.onCustomEvent("BX.Bizproc.Automation.TriggerManager:onOpenSettingsDialog-"+t.getCode(),[t,s]);if(this.canSetExecuteBy()){this.renderExecuteByControl(t,s)}this.renderAllowBackwardsControl(t,s);b.Dom.addClass(babelHelpers.classPrivateFieldGet(this,Ae),"automation-base-blocked");Ee.getInstance().setTriggerSettingsDialog({triggerManager:this,trigger:t,form:s});var c=this;var u=new BX.PopupWindow(ge.generateUniqueId(),null,{titleBar:n,content:s,closeIcon:true,offsetLeft:0,offsetTop:0,closeByEsc:true,draggable:{restrict:false},overlay:false,events:{onPopupClose:function e(t){Ee.getInstance().setTriggerSettingsDialog(null);c.destroySettingsDialogControls();t.destroy();b.Dom.removeClass(babelHelpers.classPrivateFieldGet(c,Ae),"automation-base-blocked");c.emit("TriggerManager:onCloseTriggerSettingsDialog")}},buttons:[new BX.PopupWindowButton({text:b.Loc.getMessage("JS_CORE_WINDOW_SAVE"),className:"popup-window-button-accept",events:{click:function e(){var i=BX.ajax.prepareForm(s);t.setName(i["data"]["name"]);if(o["SETTINGS"]){Ge(a,Ue,Ke).call(a,t,o["SETTINGS"]["Properties"],s)}BX.onCustomEvent("BX.Bizproc.Automation.TriggerManager:onSaveSettings-"+t.getCode(),[t,i]);c.setConditionSettingsFromForm(i["data"],t);t.setAllowBackwards(i["data"]["allow_backwards"]==="Y");if(c.canSetExecuteBy()){t.setExecuteBy(i["data"]["execute_by"])}if(t.draft);b.ajax.runAction("bizproc.analytics.push",{analyticsLabel:"automation_trigger".concat(t.draft?"_draft":"","_save_").concat(t.getCode().toLowerCase())});delete t.draft;t.reInit();c.markModified();u.close()}}}),new BX.PopupWindowButtonLink({text:b.Loc.getMessage("JS_CORE_WINDOW_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function e(){this.popupWindow.close()}}})]});Ee.getInstance().getTriggerSettingsDialog().popup=u;u.show();b.ajax.runAction("bizproc.analytics.push",{analyticsLabel:"automation_trigger".concat(t.draft?"_draft":"","_settings_").concat(t.getCode().toLowerCase())})}},{key:"renderConditionSettings",value:function e(t){var i=t.getCondition().clone();this.conditionSelector=new c.ConditionGroupSelector(i,{fields:c.getGlobalContext().document.getFields(),showValuesSelector:false});var a=this.conditionSelector;return b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-block"},children:[b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION")+":"}),a.createNode()]})]})}},{key:"renderExecuteByControl",value:function e(t,i){b.Dom.append(b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-top bizproc-automation-popup-settings-title-autocomplete"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TRIGGER_EXECUTE_BY")+":"}),i);b.Dom.append(b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[BX.Bizproc.FieldType.renderControl(c.getGlobalContext().document.getRawType(),{Type:"user"},"execute_by",t.draft?ge.getResponsibleUserExpression(c.getGlobalContext().document.getFields()):t.getExecuteBy())]}),i)}},{key:"renderAllowBackwardsControl",value:function e(t,i){b.Dom.append(b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-checkbox"},children:[b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-checkbox-item"},children:[b.Dom.create("label",{attrs:{className:"bizproc-automation-popup-chk-label"},children:[b.Dom.create("input",{attrs:{className:"bizproc-automation-popup-chk",type:"checkbox",name:"allow_backwards",value:"Y"},props:{checked:t.isBackwardsAllowed()}}),document.createTextNode(b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TRIGGER_ALLOW_REVERSE"))]})]})]}),i)}},{key:"setConditionSettingsFromForm",value:function e(t,i){i.setCondition(c.ConditionGroup.createFromForm(t));return this}},{key:"onRestAppInstall",value:function e(t,i){i.redirect=false;setTimeout((function(){BX.ajax({method:"POST",dataType:"json",url:c.getGlobalContext().ajaxUrl,data:{ajax_action:"get_available_triggers",document_signed:c.getGlobalContext().signedDocument},onsuccess:function e(t){if(b.Type.isArray(t["DATA"])){c.getGlobalContext().set("availableTriggers",t["DATA"])}}})}),1500)}},{key:"initSettingsDialogControls",value:function e(t){if(!b.Type.isArray(this.settingsDialogControls)){this.settingsDialogControls=[]}var i=t.querySelectorAll("[data-role]");for(var a=0;a<i.length;++a){var r=null;var s=i[a].getAttribute("data-role");if(s==="user-selector"){r=BX.Bizproc.UserSelector.decorateNode(i[a])}BX.UI.Hint.init(i[a]);if(r){this.settingsDialogControls.push(r)}}}},{key:"destroySettingsDialogControls",value:function e(){if(this.conditionSelector){this.conditionSelector.destroy();this.conditionSelector=null}if(b.Type.isArray(this.settingsDialogControls)){for(var t=0;t<this.settingsDialogControls.length;++t){if(b.Type.isFunction(this.settingsDialogControls[t].destroy)){this.settingsDialogControls[t].destroy()}}}this.settingsDialogControls=null}},{key:"getListByDocumentStatus",value:function e(t){var i=[];babelHelpers.classPrivateFieldGet(this,Me).forEach((function(e){if(e.getStatusId()===t){i.push(e)}}));return i}},{key:"getReturnProperties",value:function e(t){var i=[];var a={};var r=this.getListByDocumentStatus(t);r.forEach((function(e){var t=e.deleted?[]:e.getReturnProperties();if(t.length){t.forEach((function(t){if(!a[t.Id]){i.push({Id:t.Id,ObjectId:"Template",Name:t.Name,ObjectName:e.getName(),Type:t.Type,Expression:"{{~*:"+t.Id+"}}",SystemExpression:"{=Template:"+t.Id+"}"});a[t.Id]=true}}))}}));return i}},{key:"getReturnProperty",value:function e(t,i){var a=this.getReturnProperties(t);for(var r=0;r<a.length;++r){if(a[r].Id===i){return a[r]}}return null}}]);return t}(r.EventEmitter);function Ze(e,t,i){var a=this;t.forEach((function(t){var r=e.getApplyRules()[t.Id];if(t.Type==="@condition-group-selector"){Ge(a,We,Je).call(a,t,r,i);return}if(t.Type==="@webhook-code"){Ge(a,Ye,$e).call(a,t,r,i);return}if(t.Type==="@field-selector"){Ge(a,Ve,et).call(a,t,r,i);return}var s=we({AllowSelection:false},t);if(s.Type==="@robot-select"){Ge(a,ze,qe).call(a,s)}b.Dom.append(b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-top bizproc-automation-popup-settings-title-autocomplete"},text:t.Name+":"}),i);b.Dom.append(b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[BX.Bizproc.FieldType.renderControl([].concat(babelHelpers.toConsumableArray(c.getGlobalContext().document.getRawType()),[c.getGlobalContext().document.getCategoryId()]),s,t.Id,r||"")]}),i)}))}function qe(e){var t=Ee.getInstance().component;e.Options=[];var i=e.Settings.Filter;var a=function e(t){for(var a in i){if(t.data[a]!==i[a]){return false}}return true};t.templateManager.templates.forEach((function(t){t.robots.forEach((function(t){if(a(t)){e.Options.push({value:t.getId(),name:t.getProperty(e.Settings.OptionNameProperty)})}}))}));delete e.Settings;e.Type="select"}function Ke(e,t,i){var a=this;var r={};t.forEach((function(e){if(e.Type==="@condition-group-selector"){r[e.Id]=Ge(a,je,Qe).call(a,e,i);return}var t=BX.ajax.prepareForm(i);r[e.Id]=t.data[e.Id]}));e.setApplyRules(r)}function Je(e,t,i){var a=new c.ConditionGroupSelector(new c.ConditionGroup(t),{fields:e.Settings.Fields,fieldPrefix:e.Id,showValuesSelector:false});b.Dom.append(b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-block"},children:[b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:e.Name+":"}),a.createNode()]})]}),i)}function Qe(e,t){var i=BX.ajax.prepareForm(t);var a=c.ConditionGroup.createFromForm(i["data"],e.Id);return a.serialize()}function $e(e,i,a){if(!i){i=b.Text.getRandom(5)}b.Dom.append(b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete"},text:e.Name+":"}),a);b.Dom.append(b.Dom.create("input",{props:{type:"hidden",value:i,name:"code"}}),a);var r=b.Dom.create("textarea",{attrs:{className:"bizproc-automation-popup-textarea",placeholder:"...",readonly:"readonly",name:"webhook_handler"},events:{click:function e(){this.select()}}});b.Dom.append(b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[r]}),a);b.Dom.append(b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_WEBHOOK_ID")}),a);if(e.Settings.Handler){var s=window.location.protocol+"//"+window.location.host+e.Settings.Handler;s=b.Uri.addParam(s,{code:i});s=s.replace("{{DOCUMENT_TYPE}}",c.getGlobalContext().document.getRawType()[2]);s=s.replace("{{USER_ID}}",b.Loc.getMessage("USER_ID"));if(e.Settings.Password){s=s.replace("{{PASSWORD}}",e.Settings.Password)}r.value=s}if(!e.Settings.Password&&e.Settings.PasswordLoader){var l=b.Loc.getMessage("BIZPROC_AUTOMATION_WEBHOOK_PASSWORD_ALERT").replace("#A1#",'<a class="bizproc-automation-popup-settings-link '+'bizproc-automation-popup-settings-link-light" data-role="token-gen">').replace("#A2#","</a>");var n=new t.Alert({color:t.AlertColor.WARNING,icon:t.AlertIcon.WARNING,text:l});b.Event.bind(n.getTextContainer().querySelector('[data-role="token-gen"]'),"click",(function(){var t=e.Settings.PasswordLoader;BX.ajax.runComponentAction(t.component,t.action,{mode:t.mode||undefined,data:{documentType:[].concat(babelHelpers.toConsumableArray(c.getGlobalContext().document.getRawType()),[c.getGlobalContext().document.getCategoryId()])}}).then((function(t){if(t.data.error){window.alert(t.data.error)}else if(t.data.password){e.Settings.Password=t.data.password;r.value=r.value.replace("{{PASSWORD}}",e.Settings.Password);n.handleCloseBtnClick()}}))}));b.Dom.append(n.getContainer(),a)}}function et(e,t,i){var a="@field-selector"+Math.random();var r=e.Id+"[]";var s=e.Settings.Fields;var l=function e(t,i){var a=i.querySelector('[data-field="'+t["Id"]+'"]');if(a){return}b.Dom.append(b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-checkbox-item","data-field":t["Id"]},children:[b.Dom.create("label",{attrs:{className:"bizproc-automation-popup-chk-label"},children:[b.Dom.create("input",{attrs:{className:"bizproc-automation-popup-chk",type:"checkbox",name:r,value:t["Id"]},props:{checked:true}}),document.createTextNode(t["Name"])]})]}),i)};var n=function e(t,i){if(BX.Main.MenuManager.getMenuById(a)){return BX.Main.MenuManager.getMenuById(a).show()}var r=[];s.forEach((function(e){r.push({text:BX.Text.encode(e["Name"]),field:e,onclick:function e(t,a){l(a.field,i);this.popupWindow.close()}})}));BX.Main.MenuManager.show(a,t,r,{autoHide:true,offsetLeft:BX.pos(this)["width"]/2,angle:{position:"top",offset:0},zIndex:200,className:"bizproc-automation-inline-selector-menu",events:{onPopupClose:function e(t){t.destroy()}}})};b.Dom.append(b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete"},text:e.Name+":"}),i);var o=b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-checkbox"},children:[]});b.Dom.append(o,i);b.Dom.append(b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings bizproc-automation-popup-settings-text"},children:[b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link"},text:e.Settings.ChooseFieldLabel,events:{click:function e(){n(this,o)}}})]}),i);if(b.Type.isArray(t)){t.forEach((function(e){var t=s.find((function(t){return t.Id===e}));if(t){l(t,o)}}))}}function tt(e,t,i){it(e,t);t.set(e,i)}function it(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var at=new WeakMap;var rt=new WeakMap;var st=new WeakMap;var lt=new WeakMap;var nt=new WeakMap;var ot=new WeakMap;var ct=new WeakMap;var ut=function(){function e(t){babelHelpers.classCallCheck(this,e);tt(this,at,{writable:true,value:void 0});tt(this,rt,{writable:true,value:void 0});tt(this,st,{writable:true,value:void 0});tt(this,lt,{writable:true,value:void 0});tt(this,nt,{writable:true,value:void 0});tt(this,ot,{writable:true,value:void 0});tt(this,ct,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,at,t.rawDocumentType);babelHelpers.classPrivateFieldSet(this,rt,t.documentId);babelHelpers.classPrivateFieldSet(this,st,t.title);babelHelpers.classPrivateFieldSet(this,lt,t.categoryId);babelHelpers.classPrivateFieldSet(this,nt,[]);babelHelpers.classPrivateFieldSet(this,ot,0);if(b.Type.isArray(t.statusList)){babelHelpers.classPrivateFieldSet(this,nt,t.statusList);babelHelpers.classPrivateFieldSet(this,ot,babelHelpers.classPrivateFieldGet(this,nt).findIndex((function(e){return e.STATUS_ID===t.statusId})))}else if(b.Type.isStringFilled(t.statusId)){babelHelpers.classPrivateFieldGet(this,nt).push(t.statusId)}if(babelHelpers.classPrivateFieldGet(this,ot)<0){babelHelpers.classPrivateFieldSet(this,ot,0)}babelHelpers.classPrivateFieldSet(this,ct,b.Type.isArray(t.documentFields)?t.documentFields:[])}babelHelpers.createClass(e,[{key:"clone",value:function t(){return new e({rawDocumentType:b.Runtime.clone(babelHelpers.classPrivateFieldGet(this,at)),documentId:babelHelpers.classPrivateFieldGet(this,rt),categoryId:babelHelpers.classPrivateFieldGet(this,lt),statusId:this.getCurrentStatusId(),statusList:b.Runtime.clone(babelHelpers.classPrivateFieldGet(this,nt)),documentFields:b.Runtime.clone(babelHelpers.classPrivateFieldGet(this,ct)),title:babelHelpers.classPrivateFieldGet(this,st)})}},{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,rt)}},{key:"getRawType",value:function e(){return babelHelpers.classPrivateFieldGet(this,at)}},{key:"getCategoryId",value:function e(){return babelHelpers.classPrivateFieldGet(this,lt)}},{key:"getCurrentStatusId",value:function e(){var t;var i=(t=babelHelpers.classPrivateFieldGet(this,nt)[babelHelpers.classPrivateFieldGet(this,ot)])===null||t===void 0?void 0:t.STATUS_ID;return!b.Type.isNil(i)?String(i):i}},{key:"getSortedStatusId",value:function e(t){if(t>=0&&t<babelHelpers.classPrivateFieldGet(this,nt).length){return babelHelpers.classPrivateFieldGet(this,nt)[t].STATUS_ID}return null}},{key:"getNextStatusIdList",value:function e(){return babelHelpers.classPrivateFieldGet(this,nt).slice(babelHelpers.classPrivateFieldGet(this,ot)+1).map((function(e){return e.STATUS_ID}))}},{key:"getPreviousStatusIdList",value:function e(){return babelHelpers.classPrivateFieldGet(this,nt).slice(0,babelHelpers.classPrivateFieldGet(this,ot)).map((function(e){return e.STATUS_ID}))}},{key:"setStatus",value:function e(t){var i=babelHelpers.classPrivateFieldGet(this,nt).findIndex((function(e){return e.STATUS_ID===t}));if(i>=0){babelHelpers.classPrivateFieldSet(this,ot,i)}return this}},{key:"getFields",value:function e(){return babelHelpers.classPrivateFieldGet(this,ct)}},{key:"setFields",value:function e(t){babelHelpers.classPrivateFieldSet(this,ct,t);return this}},{key:"setStatusList",value:function e(t){if(b.Type.isArrayFilled(t)){babelHelpers.classPrivateFieldSet(this,nt,t)}return this}},{key:"title",get:function e(){return babelHelpers.classPrivateFieldGet(this,st)}},{key:"statusList",get:function e(){return babelHelpers.classPrivateFieldGet(this,nt)}}]);return e}();function pt(e,t,i){bt(e,t);t.set(e,i)}function bt(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var dt=new WeakMap;var vt=new WeakMap;var ht=new WeakMap;var ft=new WeakMap;var gt=new WeakMap;var mt=new WeakMap;var yt=new WeakMap;var Pt=function(){function e(t){babelHelpers.classCallCheck(this,e);pt(this,dt,{writable:true,value:e.BASIS_TYPE.CurrentDateTime});pt(this,vt,{writable:true,value:e.DELAY_TYPE.After});pt(this,ht,{writable:true,value:0});pt(this,ft,{writable:true,value:"i"});pt(this,gt,{writable:true,value:false});pt(this,mt,{writable:true,value:false});pt(this,yt,{writable:true,value:void 0});if(b.Type.isPlainObject(t)){if(t["type"]){this.setType(t["type"])}if(t["value"]){this.setValue(t["value"])}if(t["valueType"]){this.setValueType(t["valueType"])}if(t["basis"]){this.setBasis(t["basis"])}if(t["workTime"]){this.setWorkTime(t["workTime"])}if(t["waitWorkDay"]){this.setWaitWorkDay(t["waitWorkDay"])}if(t["inTime"]){this.setInTime(t["inTime"])}}}babelHelpers.createClass(e,[{key:"clone",value:function t(){return new e({type:babelHelpers.classPrivateFieldGet(this,vt),value:babelHelpers.classPrivateFieldGet(this,ht),valueType:babelHelpers.classPrivateFieldGet(this,ft),basis:babelHelpers.classPrivateFieldGet(this,dt),workTime:babelHelpers.classPrivateFieldGet(this,gt),waitWorkDay:babelHelpers.classPrivateFieldGet(this,mt),inTime:babelHelpers.classPrivateFieldGet(this,yt)})}},{key:"setType",value:function t(i){if(i!==e.DELAY_TYPE.After&&i!==e.DELAY_TYPE.Before&&i!==e.DELAY_TYPE.In){i=e.DELAY_TYPE.After}babelHelpers.classPrivateFieldSet(this,vt,i);return this}},{key:"setValue",value:function e(t){t=parseInt(t);babelHelpers.classPrivateFieldSet(this,ht,t>=0?t:0);return this}},{key:"setValueType",value:function e(t){if(t!=="i"&&t!=="h"&&t!=="d"){t="i"}babelHelpers.classPrivateFieldSet(this,ft,t);return this}},{key:"setBasis",value:function e(t){if(b.Type.isString(t)&&t!==""){babelHelpers.classPrivateFieldSet(this,dt,t)}return this}},{key:"setWorkTime",value:function e(t){babelHelpers.classPrivateFieldSet(this,gt,!!t);return this}},{key:"setWaitWorkDay",value:function e(t){babelHelpers.classPrivateFieldSet(this,mt,!!t);return this}},{key:"setInTime",value:function e(t){babelHelpers.classPrivateFieldSet(this,yt,t);return this}},{key:"isNow",value:function t(){return babelHelpers.classPrivateFieldGet(this,vt)===e.DELAY_TYPE.After&&babelHelpers.classPrivateFieldGet(this,dt)===e.BASIS_TYPE.CurrentDateTime&&!babelHelpers.classPrivateFieldGet(this,ht)&&!this.workTime&&!this.inTime}},{key:"setNow",value:function t(){this.setType(e.DELAY_TYPE.After);this.setValue(0);this.setValueType("i");this.setBasis(e.BASIS_TYPE.CurrentDateTime);this.setInTime(null)}},{key:"serialize",value:function e(){return{type:babelHelpers.classPrivateFieldGet(this,vt),value:babelHelpers.classPrivateFieldGet(this,ht),valueType:babelHelpers.classPrivateFieldGet(this,ft),basis:babelHelpers.classPrivateFieldGet(this,dt),workTime:babelHelpers.classPrivateFieldGet(this,gt)?1:0,waitWorkDay:babelHelpers.classPrivateFieldGet(this,mt)?1:0,inTime:babelHelpers.classPrivateFieldGet(this,yt)||null}}},{key:"toExpression",value:function t(i,a){var r=babelHelpers.classPrivateFieldGet(this,dt)?babelHelpers.classPrivateFieldGet(this,dt):e.BASIS_TYPE.CurrentDate;if(!e.isSystemBasis(r)&&b.Type.isArray(i)){for(var s=0,l=i.length;s<l;++s){if(r===i[s].SystemExpression){r=i[s].Expression;break}}}if(this.isNow()||babelHelpers.classPrivateFieldGet(this,vt)===e.DELAY_TYPE.In&&!babelHelpers.classPrivateFieldGet(this,gt)&&!babelHelpers.classPrivateFieldGet(this,yt)){return r}var n=0;var o=0;var c=0;switch(babelHelpers.classPrivateFieldGet(this,ft)){case"i":c=babelHelpers.classPrivateFieldGet(this,ht);break;case"h":o=babelHelpers.classPrivateFieldGet(this,ht);break;case"d":n=babelHelpers.classPrivateFieldGet(this,ht);break}var u="";if(babelHelpers.classPrivateFieldGet(this,vt)===e.DELAY_TYPE.Before){u="-"}if(n>0){u+=n+"d"}if(o>0){u+=o+"h"}if(c>0){u+=c+"i"}var p=babelHelpers.classPrivateFieldGet(this,gt)?"workdateadd":"dateadd";if(p==="workdateadd"&&u===""){u="0d"}var d="";if(p==="workdateadd"&&a){d=a}var v=p+"("+r+',"'+u+'"'+(d?","+d:"")+")";if(babelHelpers.classPrivateFieldGet(this,vt)===e.DELAY_TYPE.In&&babelHelpers.classPrivateFieldGet(this,yt)){if(!babelHelpers.classPrivateFieldGet(this,gt)){v=r}v="settime(".concat(v,", ").concat(babelHelpers.classPrivateFieldGet(this,yt)[0]||0,", ").concat(babelHelpers.classPrivateFieldGet(this,yt)[1]||0,")")}return"="+v}},{key:"format",value:function t(i,a){var r=i;if(babelHelpers.classPrivateFieldGet(this,vt)===e.DELAY_TYPE.In){r=b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_IN_TIME");if(b.Type.isArray(a)){for(var s=0;s<a.length;++s){if(babelHelpers.classPrivateFieldGet(this,dt)===a[s].SystemExpression){r+=" "+a[s].Name;break}}}if(this.inTime){r+=" "+this.inTimeString}}else if(babelHelpers.classPrivateFieldGet(this,ht)){var l=babelHelpers.classPrivateFieldGet(this,vt)===e.DELAY_TYPE.After?b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_THROUGH"):b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_FOR_TIME_1");r=l+" "+this.getFormattedPeriodLabel(babelHelpers.classPrivateFieldGet(this,ht),babelHelpers.classPrivateFieldGet(this,ft));if(b.Type.isArray(a)){var n=babelHelpers.classPrivateFieldGet(this,vt)===e.DELAY_TYPE.After?b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AFTER"):b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BEFORE_1");for(var o=0;o<a.length;++o){if(babelHelpers.classPrivateFieldGet(this,dt)===a[o].SystemExpression){r+=" "+n+" "+a[o].Name;break}}}}if(babelHelpers.classPrivateFieldGet(this,gt)){r+=", "+b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_IN_WORKTIME")}return r}},{key:"getFormattedPeriodLabel",value:function t(i,a){var r=i+" ";var s=0;if(i>20){i=i%10}if(i===1){s=0}else if(i>1&&i<5){s=1}else{s=2}var l=e.getPeriodLabels(a);return r+(l?l[s]:"")}},{key:"basis",get:function e(){return babelHelpers.classPrivateFieldGet(this,dt)}},{key:"type",get:function e(){return babelHelpers.classPrivateFieldGet(this,vt)}},{key:"value",get:function e(){return babelHelpers.classPrivateFieldGet(this,ht)}},{key:"valueType",get:function e(){return babelHelpers.classPrivateFieldGet(this,ft)}},{key:"workTime",get:function e(){return babelHelpers.classPrivateFieldGet(this,gt)}},{key:"waitWorkDay",get:function e(){return babelHelpers.classPrivateFieldGet(this,mt)}},{key:"inTime",get:function e(){return babelHelpers.classPrivateFieldGet(this,yt)}},{key:"inTimeString",get:function e(){if(!babelHelpers.classPrivateFieldGet(this,yt)){return""}return("0"+babelHelpers.classPrivateFieldGet(this,yt)[0]).slice(-2)+":"+("0"+babelHelpers.classPrivateFieldGet(this,yt)[1]).slice(-2)}}],[{key:"isSystemBasis",value:function e(t){return t===this.BASIS_TYPE.CurrentDate||t===this.BASIS_TYPE.CurrentDateTime||t===this.BASIS_TYPE.CurrentDateTimeLocal}},{key:"fromString",value:function t(i,a){if(!i){return new e}i=i.toString().trimStart().replace(/^=/,"");var r={basis:e.BASIS_TYPE.CurrentDateTime,workTime:false,inTime:null};var s={i:0,h:0,d:0};if(i.indexOf("settime(")===0){i=i.substring(8,i.length-1);var l=i.split(",");var n=parseInt(l.pop().trim());var o=parseInt(l.pop().trim());r.inTime=[o||0,n||0];i=l.join(",")}if(i.indexOf("dateadd(")===0||i.indexOf("workdateadd(")===0){if(i.indexOf("workdateadd(")===0){i=i.substring(12,i.length-1);r["workTime"]=true}else{i=i.substring(8,i.length-1)}var c=i.split(",");r["basis"]=c[0].trim();c[1]=(c[1]||"").replace(/['")]+/g,"");r["type"]=c[1].indexOf("-")===0?e.DELAY_TYPE.Before:e.DELAY_TYPE.After;var u;var p=/s*([\d]+)\s*(i|h|d)\s*/gi;while(u=p.exec(c[1])){s[u[2]]=parseInt(u[1])}}else{r["basis"]=i}if(!e.isSystemBasis(r["basis"])&&BX.type.isArray(a)){var b=false;for(var d=0,v=a.length;d<v;++d){if(r["basis"]===a[d].SystemExpression||r["basis"]===a[d].Expression){r["basis"]=a[d].SystemExpression;b=true;break}}if(!b){r["basis"]=e.BASIS_TYPE.CurrentDateTime}}var h=s["i"]+s["h"]*60+s["d"]*60*24;if(h%1440===0){r["value"]=h/1440;r["valueType"]="d"}else if(h%60===0){r["value"]=h/60;r["valueType"]="h"}else{r["value"]=h;r["valueType"]="i"}if(!r["value"]&&(r["basis"]!==e.BASIS_TYPE.CurrentDateTime||r.inTime)&&r["basis"]){r["type"]=e.DELAY_TYPE.In}return new e(r)}},{key:"fromMinutes",value:function e(t){var i;var a;if(t%1440===0){i=t/1440;a="d"}else if(t%60===0){i=t/60;a="h"}else{i=t;a="i"}return[i,a]}},{key:"toMinutes",value:function e(t,i){var a=0;switch(i){case"i":a=t;break;case"h":a=t*60;break;case"d":a=t*60*24;break}return a}},{key:"getPeriodLabels",value:function e(t){var i=[];if(t==="i"){i=[b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MIN1"),b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MIN2"),b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MIN3")]}else if(t==="h"){i=[b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_HOUR1"),b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_HOUR2"),b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_HOUR3")]}else if(t==="d"){i=[b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DAY1"),b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DAY2"),b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DAY3")]}return i}}]);return e}();babelHelpers.defineProperty(Pt,"BASIS_TYPE",{CurrentDate:"{=System:Date}",CurrentDateTime:"{=System:Now}",CurrentDateTimeLocal:"{=System:NowLocal}"});babelHelpers.defineProperty(Pt,"DELAY_TYPE",{After:"after",Before:"before",In:"in"});var Tt=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"bindAll",value:function t(i){i.querySelectorAll("[data-text]").forEach((function(t){return e.bindToNode(t)}))}},{key:"bindToNode",value:function e(t){b.Event.bind(t,"mouseover",this.showHint.bind(this,t));b.Event.bind(t,"mouseout",this.hideHint.bind(this))}},{key:"isBindedToNode",value:function e(t){var i,a;return!!((i=this.popupHint)!==null&&i!==void 0&&(a=i.bindElement)!==null&&a!==void 0&&a.isSameNode(t))}},{key:"showHint",value:function e(t){var i=t.getAttribute("data-text");if(!i){return}var a=b.Text.encode(i);a=BX.util.nl2br(a);if(!b.Type.isStringFilled(a)){return}this.hideHint();this.popupHint=new BX.PopupWindow("bizproc-automation-help-tip",t,{lightShadow:true,autoHide:false,darkMode:true,offsetLeft:0,offsetTop:2,bindOptions:{position:"top"},events:{onPopupClose:function e(){this.destroy()}},content:b.Dom.create("div",{attrs:{style:"padding-right: 5px; width: 250px;"},html:a})});this.popupHint.setAngle({offset:32,position:"bottom"});this.popupHint.show();return true}},{key:"showNoPermissionsHint",value:function e(t){this.showAngleHint(t,b.Loc.getMessage("BIZPROC_AUTOMATION_RIGHTS_ERROR"))}},{key:"showAngleHint",value:function e(t,i){if(this.timeout){clearTimeout(this.timeout)}this.popupHint=BX.UI.Hint.createInstance({popupParameters:{width:334,height:104,closeByEsc:true,autoHide:true,angle:{offset:b.Dom.getPosition(t).width/2},bindOptions:{position:"top"}}});this.popupHint.close=function(){this.hide()};this.popupHint.show(t,i);this.timeout=setTimeout(this.hideHint.bind(this),5e3)}},{key:"hideHint",value:function e(){if(this.popupHint){this.popupHint.close()}this.popupHint=null}}]);return e}();var Ht=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(Ht,"CREATED",0);babelHelpers.defineProperty(Ht,"RUNNING",1);babelHelpers.defineProperty(Ht,"COMPLETED",2);babelHelpers.defineProperty(Ht,"SUSPENDED",3);babelHelpers.defineProperty(Ht,"TERMINATED",4);function It(e,t,i){Ft(e,t);t.set(e,i)}function Ft(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Et=new WeakMap;var St=new WeakMap;var Ot=function(){function e(){babelHelpers.classCallCheck(this,e);It(this,Et,{writable:true,value:void 0});It(this,St,{writable:true,value:void 0})}babelHelpers.createClass(e,[{key:"isTriggerEntry",value:function t(){return this.type===e.TRIGGER_ACTIVITY_TYPE}},{key:"type",get:function e(){return babelHelpers.classPrivateFieldGet(this,Et)},set:function t(i){if(e.getAllActivityTypes().includes(i)){babelHelpers.classPrivateFieldSet(this,Et,i)}}},{key:"workflowStatus",get:function e(){return babelHelpers.classPrivateFieldGet(this,St)},set:function t(i){if(e.getAllWorkflowStatuses().includes(i)){babelHelpers.classPrivateFieldSet(this,St,i)}}}],[{key:"getAllActivityTypes",value:function t(){return[e.UNKNOWN_ACTIVITY_TYPE,e.EXECUTE_ACTIVITY_TYPE,e.CLOSE_ACTIVITY_TYPE,e.CANCEL_ACTIVITY_TYPE,e.FAULT_ACTIVITY_TYPE,e.CUSTOM_ACTIVITY_TYPE,e.REPORT_ACTIVITY_TYPE,e.ATTACHED_ENTITY_TYPE,e.TRIGGER_ACTIVITY_TYPE,e.ERROR_ACTIVITY_TYPE,e.DEBUG_ACTIVITY_TYPE,e.DEBUG_AUTOMATION_TYPE,e.DEBUG_DESIGNER_TYPE,e.DEBUG_LINK_TYPE]}},{key:"isKnownActivityType",value:function t(i){return e.getAllActivityTypes().includes(i)}},{key:"getAllWorkflowStatuses",value:function e(){return[Ht.CREATED,Ht.RUNNING,Ht.COMPLETED,Ht.SUSPENDED,Ht.TERMINATED]}},{key:"isKnownWorkflowStatus",value:function t(i){return e.getAllWorkflowStatuses().includes(i)}}]);return e}();babelHelpers.defineProperty(Ot,"UNKNOWN_ACTIVITY_TYPE",0);babelHelpers.defineProperty(Ot,"EXECUTE_ACTIVITY_TYPE",1);babelHelpers.defineProperty(Ot,"CLOSE_ACTIVITY_TYPE",2);babelHelpers.defineProperty(Ot,"CANCEL_ACTIVITY_TYPE",3);babelHelpers.defineProperty(Ot,"FAULT_ACTIVITY_TYPE",4);babelHelpers.defineProperty(Ot,"CUSTOM_ACTIVITY_TYPE",5);babelHelpers.defineProperty(Ot,"REPORT_ACTIVITY_TYPE",6);babelHelpers.defineProperty(Ot,"ATTACHED_ENTITY_TYPE",7);babelHelpers.defineProperty(Ot,"TRIGGER_ACTIVITY_TYPE",8);babelHelpers.defineProperty(Ot,"ERROR_ACTIVITY_TYPE",9);babelHelpers.defineProperty(Ot,"DEBUG_ACTIVITY_TYPE",10);babelHelpers.defineProperty(Ot,"DEBUG_AUTOMATION_TYPE",11);babelHelpers.defineProperty(Ot,"DEBUG_DESIGNER_TYPE",12);babelHelpers.defineProperty(Ot,"DEBUG_LINK_TYPE",13);var wt=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(wt,"WAITING",0);babelHelpers.defineProperty(wt,"RUNNING",1);babelHelpers.defineProperty(wt,"COMPLETED",2);babelHelpers.defineProperty(wt,"AUTOCOMPLETED",3);function kt(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=Ct(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function Ct(e,t){if(!e)return;if(typeof e==="string")return _t(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return _t(e,t)}function _t(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Gt(e,t,i){At(e,t);t.set(e,i)}function At(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Nt=new WeakMap;var Mt=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id","");babelHelpers.defineProperty(this,"status",wt.WAITING);babelHelpers.defineProperty(this,"modified",undefined);babelHelpers.defineProperty(this,"notes",[]);babelHelpers.defineProperty(this,"errors",[]);Gt(this,Nt,{writable:true,value:-1});babelHelpers.defineProperty(this,"workflowStatus",Ht.CREATED);if(b.Type.isArray(t)){var i=kt(t),a;try{for(i.s();!(a=i.n()).done;){var r=a.value;this.addEntry(r)}}catch(e){i.e(e)}finally{i.f()}}}babelHelpers.createClass(e,[{key:"addEntry",value:function e(t){this.id=t.name;if(babelHelpers.classPrivateFieldGet(this,Nt)<t.id){babelHelpers.classPrivateFieldSet(this,Nt,t.id);this.modified=t.datetime;this.workflowStatus=t.workflowStatus;if(t.type===c.TrackingEntry.CLOSE_ACTIVITY_TYPE){this.status=wt.COMPLETED}else{this.status=wt.RUNNING}}if(t.type===c.TrackingEntry.ERROR_ACTIVITY_TYPE){this.errors.push(t.note)}else if(t.type===c.TrackingEntry.CUSTOM_ACTIVITY_TYPE){this.notes.push(t.note)}}}]);return e}();var Dt=function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id","");babelHelpers.defineProperty(this,"status",wt.COMPLETED);babelHelpers.defineProperty(this,"modified",undefined);if(t.isTriggerEntry()){this.id=t.note;this.modified=t.datetime}};function Rt(e,t,i){Lt(e,t);t.set(e,i)}function Lt(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Bt=new WeakMap;var xt=new WeakMap;var zt=function(){function e(){babelHelpers.classCallCheck(this,e);Rt(this,Bt,{writable:true,value:{id:Ot.UNKNOWN_ACTIVITY_TYPE,workflowId:"",type:Ot.EXECUTE_ACTIVITY_TYPE,name:"",title:"",datetime:"",note:"",workflowStatus:Ht.CREATED}});Rt(this,xt,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,xt,babelHelpers.classPrivateFieldGet(this,Bt))}babelHelpers.createClass(e,[{key:"setLogEntry",value:function e(t){babelHelpers.classPrivateFieldSet(this,xt,Object.assign({},babelHelpers.classPrivateFieldGet(this,Bt)));t=Object.assign({},t);if(b.Type.isStringFilled(t["ID"])){t["ID"]=parseInt(t["ID"])}if(b.Type.isStringFilled(t["TYPE"])){t["TYPE"]=parseInt(t["TYPE"])}if(b.Type.isNumber(t["ID"])){babelHelpers.classPrivateFieldGet(this,xt).id=t["ID"]}if(b.Type.isStringFilled(t["WORKFLOW_ID"])){babelHelpers.classPrivateFieldGet(this,xt).workflowId=t["WORKFLOW_ID"]}if(b.Type.isNumber(t["TYPE"])&&Ot.isKnownActivityType(t["TYPE"])){babelHelpers.classPrivateFieldGet(this,xt).type=t["TYPE"]}if(b.Type.isStringFilled(t["MODIFIED"])){babelHelpers.classPrivateFieldGet(this,xt).datetime=t["MODIFIED"]}if(b.Type.isNumber(t["WORKFLOW_STATUS"])&&Ot.isKnownWorkflowStatus(t["WORKFLOW_STATUS"])){babelHelpers.classPrivateFieldGet(this,xt).workflowStatus=t["WORKFLOW_STATUS"]}babelHelpers.classPrivateFieldGet(this,xt).name=String(t["ACTION_NAME"]);babelHelpers.classPrivateFieldGet(this,xt).title=String(t["ACTION_TITLE"]);babelHelpers.classPrivateFieldGet(this,xt).note=String(t["ACTION_NOTE"]);return this}},{key:"setStatus",value:function e(t){babelHelpers.classPrivateFieldGet(this,xt).status=t;return this}},{key:"build",value:function e(){var t=new Ot;t.id=babelHelpers.classPrivateFieldGet(this,xt).id;t.workflowId=babelHelpers.classPrivateFieldGet(this,xt).workflowId;t.type=babelHelpers.classPrivateFieldGet(this,xt).type;t.name=babelHelpers.classPrivateFieldGet(this,xt).name;t.title=babelHelpers.classPrivateFieldGet(this,xt).title;t.note=babelHelpers.classPrivateFieldGet(this,xt).note;t.datetime=babelHelpers.classPrivateFieldGet(this,xt).datetime;t.workflowStatus=babelHelpers.classPrivateFieldGet(this,xt).workflowStatus;return t}}]);return e}();function Ut(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=Wt(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function Wt(e,t){if(!e)return;if(typeof e==="string")return jt(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return jt(e,t)}function jt(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Yt(e,t,i){Vt(e,t);t.set(e,i)}function Vt(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Xt=new WeakMap;var Zt=new WeakMap;var qt=new WeakMap;var Kt=new WeakMap;var Jt=function(){function e(t,i){babelHelpers.classCallCheck(this,e);Yt(this,Xt,{writable:true,value:void 0});Yt(this,Zt,{writable:true,value:void 0});Yt(this,qt,{writable:true,value:void 0});Yt(this,Kt,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Xt,i);babelHelpers.classPrivateFieldSet(this,Zt,t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){babelHelpers.classPrivateFieldSet(this,qt,{});babelHelpers.classPrivateFieldSet(this,Kt,{});this.addLogs(t)}},{key:"reInit",value:function e(t){this.init(t)}},{key:"addLogs",value:function e(t){if(!b.Type.isPlainObject(t)){t={}}var i=new zt;for(var a=0,r=Object.entries(t);a<r.length;a++){var s=babelHelpers.slicedToArray(r[a],2),l=s[0],n=s[1];if(!b.Type.isArray(n)){continue}var o=Ut(n),c;try{for(o.s();!(c=o.n()).done;){var u=c.value;var p=i.setLogEntry(u).build();if(p.isTriggerEntry()){this.addTriggerEntry(p)}else{this.addRobotEntry(p);var d=babelHelpers.classPrivateFieldGet(this,Kt)[p.name];if(!b.Type.isNil(babelHelpers.classPrivateFieldGet(this,Zt))){var v=d.status===wt.RUNNING;var h=d.workflowStatus===Ht.COMPLETED;var f=babelHelpers.classPrivateFieldGet(this,Zt).getCurrentStatusId()===l;var g=v&&!f;var m=v&&h&&f;if(g||m){d.status=wt.COMPLETED}}}}}catch(e){o.e(e)}finally{o.f()}}}},{key:"addTriggerEntry",value:function e(t){if(t.isTriggerEntry()){babelHelpers.classPrivateFieldGet(this,qt)[t.note]=new Dt(t)}}},{key:"addRobotEntry",value:function e(t){if(t.isTriggerEntry()){return}if(!babelHelpers.classPrivateFieldGet(this,Kt)[t.name]){babelHelpers.classPrivateFieldGet(this,Kt)[t.name]=new Mt([t])}else{babelHelpers.classPrivateFieldGet(this,Kt)[t.name].addEntry(t)}}},{key:"getRobotLog",value:function e(t){return babelHelpers.classPrivateFieldGet(this,Kt)[t]||null}},{key:"getTriggerLog",value:function e(t){return babelHelpers.classPrivateFieldGet(this,qt)[t]||null}},{key:"update",value:function e(t){var i=this;return BX.ajax({method:"POST",dataType:"json",url:babelHelpers.classPrivateFieldGet(this,Xt),data:{ajax_action:"get_log",document_signed:t},onsuccess:function e(t){if(t.DATA&&t.DATA.LOG){i.reInit(t.DATA.LOG)}}})}}]);return e}();function Qt(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=$t(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function $t(e,t){if(!e)return;if(typeof e==="string")return ei(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ei(e,t)}function ei(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function ti(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function ii(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ti(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ti(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function ai(e,t,i){ri(e,t);t.set(e,i)}function ri(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var si=new WeakMap;var li=new WeakMap;var ni=new WeakMap;var oi=new WeakMap;var ci=new WeakMap;var ui=new WeakMap;var pi=new WeakMap;var bi=new WeakMap;var di=new WeakMap;var vi=new WeakMap;var hi=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"SYSTEM_EXPRESSION_PATTERN","\\{=\\s*(?<object>[a-z0-9_]+)\\s*\\:\\s*(?<field>[a-z0-9_\\.]+)(\\s*>\\s*(?<mod1>[a-z0-9_\\:]+)(\\s*,\\s*(?<mod2>[a-z0-9_]+))?)?\\s*\\}");ai(babelHelpers.assertThisInitialized(i),si,{writable:true,value:void 0});ai(babelHelpers.assertThisInitialized(i),li,{writable:true,value:void 0});ai(babelHelpers.assertThisInitialized(i),ni,{writable:true,value:void 0});ai(babelHelpers.assertThisInitialized(i),oi,{writable:true,value:void 0});ai(babelHelpers.assertThisInitialized(i),ci,{writable:true,value:void 0});ai(babelHelpers.assertThisInitialized(i),ui,{writable:true,value:void 0});ai(babelHelpers.assertThisInitialized(i),pi,{writable:true,value:void 0});ai(babelHelpers.assertThisInitialized(i),bi,{writable:true,value:void 0});ai(babelHelpers.assertThisInitialized(i),di,{writable:true,value:void 0});ai(babelHelpers.assertThisInitialized(i),vi,{writable:true,value:void 0});i.setEventNamespace("BX.Bizproc.Automation");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),li,e.document);if(!b.Type.isNil(e.template)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),ni,e.template)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),di,e.isFrameMode);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),vi,Y.none());babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),oi,e.tracker);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),bi,false);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),ci,new Pt);return i}babelHelpers.createClass(t,[{key:"hasTemplate",value:function e(){return!b.Type.isNil(babelHelpers.classPrivateFieldGet(this,ni))}},{key:"getTemplate",value:function e(){return babelHelpers.classPrivateFieldGet(this,ni)}},{key:"getDocument",value:function e(){return babelHelpers.classPrivateFieldGet(this,li)}},{key:"clone",value:function e(){var i=new t({document:babelHelpers.classPrivateFieldGet(this,li),template:babelHelpers.classPrivateFieldGet(this,ni),isFrameMode:babelHelpers.classPrivateFieldGet(this,di),tracker:babelHelpers.classPrivateFieldGet(this,oi)});var a=ii(ii({},BX.clone(babelHelpers.classPrivateFieldGet(this,si))),{},{Name:t.generateName(),Delay:this.getDelayInterval().serialize(),Condition:this.getCondition().serialize()});i.init(a,babelHelpers.classPrivateFieldGet(this,vi));return i}},{key:"isEqual",value:function e(t){return babelHelpers.classPrivateFieldGet(this,si).Name===babelHelpers.classPrivateFieldGet(t,si).Name}},{key:"init",value:function e(i,a){if(b.Type.isPlainObject(i)){babelHelpers.classPrivateFieldSet(this,si,Object.assign({},i))}if(!babelHelpers.classPrivateFieldGet(this,si).Name){babelHelpers.classPrivateFieldGet(this,si).Name=t.generateName()}babelHelpers.classPrivateFieldSet(this,ci,new Pt(babelHelpers.classPrivateFieldGet(this,si).Delay));babelHelpers.classPrivateFieldSet(this,pi,new c.ConditionGroup(babelHelpers.classPrivateFieldGet(this,si).Condition));if(!babelHelpers.classPrivateFieldGet(this,si).Condition){babelHelpers.classPrivateFieldGet(this,pi).type=c.ConditionGroup.CONDITION_TYPE.Mixed}delete babelHelpers.classPrivateFieldGet(this,si).Condition;delete babelHelpers.classPrivateFieldGet(this,si).Delay;babelHelpers.classPrivateFieldSet(this,vi,b.Type.isNil(a)?Y.edit():a);if(!babelHelpers.classPrivateFieldGet(this,vi).isNone()){babelHelpers.classPrivateFieldSet(this,ui,this.createNode())}}},{key:"reInit",value:function e(t,i){if(b.Type.isNil(i)&&babelHelpers.classPrivateFieldGet(this,vi).isNone()){return}var a=babelHelpers.classPrivateFieldGet(this,ui);babelHelpers.classPrivateFieldSet(this,ui,this.createNode());if(a.parentNode){a.parentNode.replaceChild(babelHelpers.classPrivateFieldGet(this,ui),a)}}},{key:"destroy",value:function e(){b.Dom.remove(babelHelpers.classPrivateFieldGet(this,ui));this.emit("Robot:destroyed")}},{key:"canEdit",value:function e(){return babelHelpers.classPrivateFieldGet(this,ni).canEdit()}},{key:"getProperties",value:function e(){if(babelHelpers.classPrivateFieldGet(this,si)&&b.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,si).Properties)){return babelHelpers.classPrivateFieldGet(this,si).Properties}return{}}},{key:"getProperty",value:function e(t){return this.getProperties()[t]||null}},{key:"hasProperty",value:function e(t){return this.getProperties().hasOwnProperty(t)}},{key:"setProperty",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,si).Properties[t]=i;return this}},{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,si).Name||null}},{key:"getLogStatus",value:function e(){var t=wt.WAITING;var i=babelHelpers.classPrivateFieldGet(this,oi).getRobotLog(this.getId());if(i){t=i.status}else if(babelHelpers.classPrivateFieldGet(this,si).DelayName){i=babelHelpers.classPrivateFieldGet(this,oi).getRobotLog(babelHelpers.classPrivateFieldGet(this,si).DelayName);if(i&&i.status===wt.RUNNING){t=wt.RUNNING}}return t}},{key:"getLogErrors",value:function e(){var t=[];var i=babelHelpers.classPrivateFieldGet(this,oi).getRobotLog(this.getId());if(i&&i.errors){t=i.errors}return t}},{key:"getDelayNotes",value:function e(){if(babelHelpers.classPrivateFieldGet(this,si).DelayName){var t=babelHelpers.classPrivateFieldGet(this,oi).getRobotLog(babelHelpers.classPrivateFieldGet(this,si).DelayName);if(t&&t.status===wt.RUNNING){return t.notes}}return[]}},{key:"selectNode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,ui)){b.Dom.addClass(babelHelpers.classPrivateFieldGet(this,ui),"--selected");this.emit("Robot:selected")}}},{key:"unselectNode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,ui)){b.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,ui),"--selected");this.emit("Robot:unselected")}}},{key:"isSelected",value:function e(){return babelHelpers.classPrivateFieldGet(this,ui)&&b.Dom.hasClass(babelHelpers.classPrivateFieldGet(this,ui),"--selected")}},{key:"enableManageMode",value:function e(t){var i=this;babelHelpers.classPrivateFieldSet(this,vi,Y.manage().setProperty("isActive",t));if(!t){b.Dom.addClass(babelHelpers.classPrivateFieldGet(this,ui),"--locked-node")}var a=babelHelpers.classPrivateFieldGet(this,ui).querySelector(".bizproc-automation-robot-btn-delete");b.Dom.hide(a);babelHelpers.classPrivateFieldGet(this,ui).onclick=function(){if(!babelHelpers.classPrivateFieldGet(i,vi).isManage()||!babelHelpers.classPrivateFieldGet(i,vi).getProperty("isActive",false)){return}if(!i.isSelected()){i.selectNode()}else{i.unselectNode()}}}},{key:"disableManageMode",value:function e(){babelHelpers.classPrivateFieldSet(this,vi,Y.edit());this.unselectNode();b.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,ui),"--locked-node");var t=babelHelpers.classPrivateFieldGet(this,ui).querySelector(".bizproc-automation-robot-btn-delete");b.Dom.show(t);babelHelpers.classPrivateFieldGet(this,ui).onclick=undefined}},{key:"createNode",value:function e(){var t=this;var i="bizproc-automation-robot-container-wrapper";var a="bizproc-automation-robot-container";if(babelHelpers.classPrivateFieldGet(this,vi).isEdit()&&this.canEdit()){i+=" bizproc-automation-robot-container-wrapper-draggable"}if(this.draft){a+=" --draft"}var r=b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TO");var s=b.Dom.create("a",{attrs:{className:"bizproc-automation-robot-settings-name "+(babelHelpers.classPrivateFieldGet(this,vi).isView()?"--mode-view":""),title:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AUTOMATICALLY")},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AUTOMATICALLY")});if(b.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,si).viewData)&&babelHelpers.classPrivateFieldGet(this,si).viewData.responsibleLabel){var l=babelHelpers.classPrivateFieldGet(this,si).viewData.responsibleLabel.replace("{=Document:ASSIGNED_BY_ID}",b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_RESPONSIBLE")).replace("author",b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_RESPONSIBLE")).replace(/\{=Constant\:Constant[0-9]+\}/,b.Loc.getMessage("BIZPROC_AUTOMATION_ASK_CONSTANT")).replace(/\{\{~&\:Constant[0-9]+\}\}/,b.Loc.getMessage("BIZPROC_AUTOMATION_ASK_CONSTANT")).replace(/\{=Template\:Parameter[0-9]+\}/,b.Loc.getMessage("BIZPROC_AUTOMATION_ASK_PARAMETER")).replace(/\{\{~&:\:Parameter[0-9]+\}\}/,b.Loc.getMessage("BIZPROC_AUTOMATION_ASK_PARAMETER"));if(l.indexOf("{=Document")>=0){babelHelpers.classPrivateFieldGet(this,li).getFields().forEach((function(e){l=l.replace(e["SystemExpression"],e["Name"])}))}if(l.indexOf("{=A")>=0){babelHelpers.classPrivateFieldGet(this,ni).robots.forEach((function(e){e.getReturnFieldsDescription().forEach((function(t){if(t["Type"]==="user"){l=l.replace(t["SystemExpression"],e.getTitle()+": "+t["Name"])}}))}))}if(l.indexOf("{=GlobalVar:")>=0&&b.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,ni).globalVariables)){babelHelpers.classPrivateFieldGet(this,ni).globalVariables.forEach((function(e){l=l.replace(e.SystemExpression,e.Name)}))}if(l.indexOf("{=GlobalConst:")>=0&&b.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,ni).globalConstants)){babelHelpers.classPrivateFieldGet(this,ni).globalConstants.forEach((function(e){l=l.replace(e.SystemExpression,e.Name)}))}s.textContent=l;s.setAttribute("title",l);if(babelHelpers.classPrivateFieldGet(this,si).viewData.responsibleUrl){s.href=babelHelpers.classPrivateFieldGet(this,si).viewData.responsibleUrl;if(babelHelpers.classPrivateFieldGet(this,di)){s.setAttribute("target","_blank")}}if(babelHelpers.classPrivateFieldGet(this,vi).isEdit()&&parseInt(babelHelpers.classPrivateFieldGet(this,si).viewData.responsibleId)>0){s.setAttribute("bx-tooltip-user-id",babelHelpers.classPrivateFieldGet(this,si).viewData.responsibleId)}}var n=this.getDelayInterval().format(b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AT_ONCE"),babelHelpers.classPrivateFieldGet(this,li).getFields());if(this.isExecuteAfterPrevious()){n=n!==b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AT_ONCE")?n+", ":"";n+=b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AFTER_PREVIOUS")}if(this.getCondition().items.length>0){n+=", "+b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BY_CONDITION")}var o=b.Dom.create(babelHelpers.classPrivateFieldGet(this,vi).isEdit()?"a":"span",{attrs:{className:babelHelpers.classPrivateFieldGet(this,vi).isEdit()?"bizproc-automation-robot-link":"bizproc-automation-robot-text",title:n},text:n});var c=b.Dom.create("div",{attrs:{className:"bizproc-automation-robot-information"}});this.subscribeOnce("Robot:destroyed",(function(){if(Tt.isBindedToNode(c)){Tt.hideHint()}}));switch(this.getLogStatus()){case wt.RUNNING:if(babelHelpers.classPrivateFieldGet(this,li).getCurrentStatusId()===babelHelpers.classPrivateFieldGet(this,ni).getStatusId()){c.classList.add("--loader");var u=this.getDelayNotes();if(u.length){c.setAttribute("data-text",u.join("\n"));Tt.bindToNode(c)}}break;case wt.COMPLETED:case wt.AUTOCOMPLETED:a+=" --complete";c.classList.add("--complete");break}var p=this.getLogErrors();if(p.length>0){c.classList.add("--errors");c.setAttribute("data-text",p.join("\n"));Tt.bindToNode(c)}var d="bizproc-automation-robot-title-text";if(babelHelpers.classPrivateFieldGet(this,vi).isEdit()&&this.canEdit()){d+=" bizproc-automation-robot-title-text-editable"}var v=b.Dom.create("div",{attrs:{className:a,"data-role":"robot-container","data-type":"item-robot","data-id":this.getId()},children:[b.Dom.create("div",{props:{className:"bizproc-automation-robot-container-checkbox"}}),b.Dom.create("div",{attrs:{className:i},children:[b.Dom.create("div",{attrs:{className:"bizproc-automation-robot-deadline"},children:[o]}),b.Dom.create("div",{attrs:{className:"bizproc-automation-robot-title"},children:[b.Dom.create("div",{attrs:{className:d,title:this.getTitle()},html:this.clipTitle(this.getTitle()),events:{click:function e(i){if(babelHelpers.classPrivateFieldGet(t,vi).isEdit()&&t.canEdit()&&!babelHelpers.classPrivateFieldGet(t,vi).isManage()){t.onTitleEditClick(i)}}}})]}),b.Dom.create("div",{attrs:{className:"bizproc-automation-robot-settings"},children:[b.Dom.create("div",{attrs:{className:"bizproc-automation-robot-settings-title"},text:r+":"}),s]}),c]})]});if(this.canEdit()){this.registerItem(v)}if(babelHelpers.classPrivateFieldGet(this,vi).isEdit()){var h=b.Dom.create("SPAN",{attrs:{className:"bizproc-automation-robot-btn-delete"}});b.Event.bind(h,"click",this.onDeleteButtonClick.bind(this,h));v.lastChild.appendChild(h);var f=b.Dom.create("div",{attrs:{className:"bizproc-automation-robot-btn-copy"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_COPY")||"copy"});b.Event.bind(f,"click",this.onCopyButtonClick.bind(this,f));v.appendChild(f);var g=b.Dom.create("div",{attrs:{className:"bizproc-automation-robot-btn-settings"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EDIT")});b.Event.bind(v,"click",this.onSettingsButtonClick.bind(this,v));v.appendChild(g)}return v}},{key:"onDeleteButtonClick",value:function e(t,i){i.stopPropagation();if(!this.canEdit()){Tt.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,vi).isManage()){b.Dom.remove(babelHelpers.classPrivateFieldGet(this,ui));babelHelpers.classPrivateFieldGet(this,ni).deleteRobot(this)}}},{key:"onSettingsButtonClick",value:function e(t){if(!this.canEdit()){Tt.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,vi).isManage()){var i;babelHelpers.classPrivateFieldGet(this,ni).openRobotSettingsDialog(this,(i=babelHelpers.classPrivateFieldGet(this,si).DialogContext)!==null&&i!==void 0?i:null)}}},{key:"onCopyButtonClick",value:function e(t,i){i.stopPropagation();if(!this.canEdit()){Tt.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,vi).isManage()){var a=this.clone();var r=a.getProperty("Title");if(!b.Type.isNil(r)){var s=r+" "+" "+b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_COPY_CAPTION");a.setProperty("Title",s);a.reInit()}Xi.copyRobotTo(babelHelpers.classPrivateFieldGet(this,ni),a,babelHelpers.classPrivateFieldGet(this,ni).getNextRobot(this))}}},{key:"onTitleEditClick",value:function e(t){t.preventDefault();t.stopPropagation();var i="bizproc_automation_robot_title_dialog";var a=b.Dom.create("form",{props:{name:i},style:{"min-width":"540px"}});a.appendChild(b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ROBOT_NAME")+":"}));a.appendChild(b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[BX.create("input",{attrs:{className:"bizproc-automation-popup-input",type:"text",name:"name",value:this.getTitle()}})]}));this.emit("Robot:title:editStart");var r=this;var s=new BX.PopupWindow(c.Helper.generateUniqueId(),null,{titleBar:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ROBOT_NAME"),content:a,closeIcon:true,offsetLeft:0,offsetTop:0,closeByEsc:true,draggable:{restrict:false},overlay:false,events:{onPopupClose:function e(t){t.destroy();r.emit("Robot:title:editCompleted")}},buttons:[new BX.PopupWindowButton({text:b.Loc.getMessage("JS_CORE_WINDOW_SAVE"),className:"popup-window-button-accept",events:{click:function e(){var t=a.elements.name;r.setProperty("Title",t.value);r.reInit();babelHelpers.classPrivateFieldGet(r,ni).markModified();this.popupWindow.close()}}}),new BX.PopupWindowButtonLink({text:b.Loc.getMessage("JS_CORE_WINDOW_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function e(){this.popupWindow.close()}}})]});s.show()}},{key:"onSearch",value:function e(t){if(!babelHelpers.classPrivateFieldGet(this,ui)){return}var i=t.getData().queryString;var a=!i||this.getTitle().toLowerCase().indexOf(i)>=0;if(a){b.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,ui),"--search-mismatch")}else{b.Dom.addClass(babelHelpers.classPrivateFieldGet(this,ui),"--search-mismatch")}}},{key:"clipTitle",value:function e(t){var i=b.Text.encode(t);var a=i.split(" ");var r="<span>"+a[a.length-1]+"</span>";a.splice(a.length-1);i=a.join(" ")+" "+r;return i}},{key:"updateData",value:function e(t){if(b.Type.isPlainObject(t)){babelHelpers.classPrivateFieldSet(this,si,t)}else{throw"Invalid data"}}},{key:"serialize",value:function e(){var t=BX.clone(babelHelpers.classPrivateFieldGet(this,si));delete t["viewData"];delete t["DialogContext"];t.Delay=babelHelpers.classPrivateFieldGet(this,ci).serialize();t.Condition=babelHelpers.classPrivateFieldGet(this,pi).serialize();return t}},{key:"getDelayInterval",value:function e(){return babelHelpers.classPrivateFieldGet(this,ci)}},{key:"setDelayInterval",value:function e(t){babelHelpers.classPrivateFieldSet(this,ci,t);return this}},{key:"getCondition",value:function e(){return babelHelpers.classPrivateFieldGet(this,pi)}},{key:"setCondition",value:function e(t){babelHelpers.classPrivateFieldSet(this,pi,t);return this}},{key:"setExecuteAfterPrevious",value:function e(t){babelHelpers.classPrivateFieldGet(this,si).ExecuteAfterPrevious=t?1:0;return this}},{key:"isExecuteAfterPrevious",value:function e(){return babelHelpers.classPrivateFieldGet(this,si).ExecuteAfterPrevious===1||babelHelpers.classPrivateFieldGet(this,si).ExecuteAfterPrevious==="1"}},{key:"registerItem",value:function e(t){if(b.Type.isNil(t["__bxddid"])){t.onbxdragstart=BX.proxy(this.dragStart,this);t.onbxdrag=BX.proxy(this.dragMove,this);t.onbxdragstop=BX.proxy(this.dragStop,this);t.onbxdraghover=BX.proxy(this.dragOver,this);jsDD.registerObject(t);jsDD.registerDest(t,1)}}},{key:"unregisterItem",value:function e(t){t.onbxdragstart=undefined;t.onbxdrag=undefined;t.onbxdragstop=undefined;t.onbxdraghover=undefined;jsDD.unregisterObject(t);jsDD.unregisterDest(t)}},{key:"dragStart",value:function e(){this.draggableItem=BX.proxy_context;if(!this.draggableItem){jsDD.stopCurrentDrag();return}if(!this.stub){var t=this.draggableItem.offsetWidth;this.stub=this.draggableItem.cloneNode(true);this.stub.style.position="absolute";this.stub.classList.add("bizproc-automation-robot-container-drag");this.stub.style.width=t+"px";document.body.appendChild(this.stub)}}},{key:"dragMove",value:function e(t,i){this.stub.style.left=t+"px";this.stub.style.top=i+"px"}},{key:"dragOver",value:function e(t,i,a){if(this.droppableItem){this.droppableItem.classList.remove("bizproc-automation-robot-container-pre")}if(this.droppableColumn){this.droppableColumn.classList.remove("bizproc-automation-robot-list-pre")}var r=t.getAttribute("data-type");if(r==="item-robot"){this.droppableItem=t;this.droppableColumn=null}if(r==="column-robot"){this.droppableColumn=t.querySelector('[data-role="robot-list"]');this.droppableItem=null}if(this.droppableItem){this.droppableItem.classList.add("bizproc-automation-robot-container-pre")}if(this.droppableColumn){this.droppableColumn.classList.add("bizproc-automation-robot-list-pre")}}},{key:"dragStop",value:function e(t,i,a){a=a||window.event;var r=a&&(a.ctrlKey||a.metaKey);if(this.draggableItem){if(this.droppableItem){this.droppableItem.classList.remove("bizproc-automation-robot-container-pre");this.emit("Robot:manage",{templateNode:this.droppableItem.parentNode,isCopy:r,droppableItem:this.droppableItem,robot:this})}else if(this.droppableColumn){this.droppableColumn.classList.remove("bizproc-automation-robot-list-pre");this.emit("Robot:manage",{templateNode:this.droppableColumn,isCopy:r,robot:this})}}this.stub.parentNode.removeChild(this.stub);this.stub=null;this.draggableItem=null;this.droppableItem=null}},{key:"moveTo",value:function e(t,i){b.Dom.remove(babelHelpers.classPrivateFieldGet(this,ui));babelHelpers.classPrivateFieldGet(this,ni).deleteRobot(this);babelHelpers.classPrivateFieldSet(this,ni,t);babelHelpers.classPrivateFieldGet(this,ni).insertRobot(this,i);babelHelpers.classPrivateFieldSet(this,ui,this.createNode());babelHelpers.classPrivateFieldGet(this,ni).insertRobotNode(babelHelpers.classPrivateFieldGet(this,ui),i?i.node:null)}},{key:"copyTo",value:function e(i,a){var r=new t({document:babelHelpers.classPrivateFieldGet(this,li),template:i,isFrameMode:babelHelpers.classPrivateFieldGet(this,di),tracker:babelHelpers.classPrivateFieldGet(this,oi)});var s=this.serialize();delete s["Name"];delete s["DelayName"];r.init(s,babelHelpers.classPrivateFieldGet(this,vi));i.insertRobot(r,a);i.insertRobotNode(r.node,a?a.node:null);return r}},{key:"getTitle",value:function e(){return this.getProperty("Title")||this.getDescriptionTitle()}},{key:"getDescriptionTitle",value:function e(){var t,i;var a="untitled";var r=(t=(i=this.template)===null||i===void 0?void 0:i.getRobotDescription(babelHelpers.classPrivateFieldGet(this,si)["Type"]))!==null&&t!==void 0?t:{};if(r["NAME"]){a=r["NAME"]}if(r["ROBOT_SETTINGS"]&&r["ROBOT_SETTINGS"]["TITLE"]){a=r["ROBOT_SETTINGS"]["TITLE"]}return a}},{key:"hasTitle",value:function e(){return this.getTitle()!=="untitled"}},{key:"hasReturnFields",value:function e(){var t=this.template.getRobotDescription(babelHelpers.classPrivateFieldGet(this,si)["Type"]);var i=babelHelpers.classPrivateFieldGet(this,si)["Properties"];if(!b.Type.isObject(t)){return false}var a=function e(){return b.Type.isObject(t["RETURN"])&&b.Type.isArrayFilled(Object.values(t["RETURN"]))};var r=function e(){return b.Type.isArray(t["ADDITIONAL_RESULT"])&&t["ADDITIONAL_RESULT"].some((function(e){var t;return Object.values((t=i[e])!==null&&t!==void 0?t:[]).length>0}))};return a()||r()}},{key:"getReturnFieldsDescription",value:function e(){var t=this;var i=[];var a=this.template.getRobotDescription(babelHelpers.classPrivateFieldGet(this,si)["Type"]);if(a&&a["RETURN"]){for(var r in a["RETURN"]){if(a["RETURN"].hasOwnProperty(r)){var s=a["RETURN"][r];i.push({Id:r,ObjectId:this.getId(),ObjectName:this.getTitle(),Name:s["NAME"],Type:s["TYPE"],Options:s["OPTIONS"]||null,Expression:"{{~"+this.getId()+":"+r+" # "+this.getTitle()+": "+s["NAME"]+"}}",SystemExpression:"{="+this.getId()+":"+r+"}"});if(!this.appendPropertyMods){continue}if(s["TYPE"]==="user"||s["TYPE"]==="bool"||s["TYPE"]==="file"){var l=s["TYPE"]==="user"?"friendly":"printable";i.push({Id:r+"_printable",ObjectId:this.getId(),Name:s["NAME"]+" "+b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX"),Type:"string",Expression:"{{~".concat(this.getId(),":").concat(r," > ").concat(l," # ").concat(this.getTitle(),": ").concat(s["NAME"],"}}"),SystemExpression:"{=".concat(this.getId(),":").concat(r,">").concat(l,"}")})}}}}if(a&&b.Type.isArray(a["ADDITIONAL_RESULT"])){var n=babelHelpers.classPrivateFieldGet(this,si)["Properties"];a["ADDITIONAL_RESULT"].forEach((function(e){if(n[e]){for(var a in n[e]){if(n[e].hasOwnProperty(a)){var r=n[e][a];i.push({Id:a,ObjectId:t.getId(),Name:r["Name"],Type:r["Type"],Options:r["Options"]||null,Expression:"{{~".concat(t.getId(),":").concat(a," # ").concat(t.getTitle(),": ").concat(r["Name"],"}}"),SystemExpression:"{="+t.getId()+":"+a+"}"});if(r["Type"]==="user"||r["Type"]==="bool"||r["Type"]==="file"){var s=r["Type"]==="user"?"friendly":"printable";var l="{{~".concat(t.getId(),":").concat(a," > ").concat(s," # ").concat(t.getTitle(),": ").concat(r["Name"],"}}");i.push({Id:a+"_printable",ObjectId:t.getId(),Name:r["Name"]+" "+b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX"),Type:"string",Expression:l,SystemExpression:"{="+t.getId()+":"+a+">"+s+"}"})}}}}}))}return i}},{key:"getReturnProperty",value:function e(t){var i=this.getReturnFieldsDescription();for(var a=0;a<i.length;++a){if(i[a]["Id"]===t){return i[a]}}return null}},{key:"collectUsages",value:function e(){var t=this;var i=this.getProperties();var a={Document:new Set,Constant:new Set,Variable:new Set,Parameter:new Set,GlobalConstant:new Set,GlobalVariable:new Set,Activity:new Set};Object.values(i).forEach((function(e){return t.collectExpressions(e,a)}));var r=this.getCondition().serialize();r.items.forEach((function(e){return t.collectParsedExpressions(e[0],a)}));return a}},{key:"collectExpressions",value:function e(t,i){var a=this;if(b.Type.isArray(t)){t.forEach((function(e){return a.collectExpressions(e,i)}))}else if(b.Type.isPlainObject(t)){Object.values(t).forEach((function(e){return a.collectExpressions(e,i)}))}else if(b.Type.isStringFilled(t)){var r;var s=new RegExp(this.SYSTEM_EXPRESSION_PATTERN,"ig");while((r=s.exec(t))!==null){this.collectParsedExpressions(r.groups,i)}}}},{key:"collectParsedExpressions",value:function e(t,i){if(b.Type.isPlainObject(t)&&t["object"]&&t["field"]){switch(t["object"]){case"Document":i.Document.add(t["field"]);return;case"Constant":i.Constant.add(t["field"]);return;case"Variable":i.Variable.add(t["field"]);return;case"Template":i.Parameter.add(t["field"]);return;case"GlobalConst":i.GlobalConstant.add(t["field"]);return;case"GlobalVar":i.GlobalVariable.add(t["field"]);return}var a=new RegExp(/^A[_0-9]+$/,"ig");if(a.exec(t["object"])){i.Activity.add([t["object"],t["field"]])}}}},{key:"hasBrokenLink",value:function e(){return this.getBrokenLinks().length>0}},{key:"getBrokenLinks",value:function e(){var t=b.Runtime.clone(this.collectUsages());if(!this.template){return[]}var i={Document:babelHelpers.classPrivateFieldGet(this,li).getFields(),Constant:babelHelpers.classPrivateFieldGet(this,ni).getConstants(),Variable:babelHelpers.classPrivateFieldGet(this,ni).getVariables(),GlobalConstant:babelHelpers.classPrivateFieldGet(this,ni).globalConstants,GlobalVariable:babelHelpers.classPrivateFieldGet(this,ni).globalVariables,Parameter:babelHelpers.classPrivateFieldGet(this,ni).getParameters(),Activity:babelHelpers.classPrivateFieldGet(this,ni).getSerializedRobots()};var a=[];for(var r in t){if(t[r].size>0){var s=new Set;for(var l in i[r]){if(i[r][l]["Id"]){s.add(i[r][l]["Id"])}else if(i[r][l]["Name"]){s.add(i[r][l]["Name"])}}var n=Qt(t[r].values()),o;try{for(n.s();!(o=n.n()).done;){var c=o.value;var u=c;var p=c;if(b.Type.isArray(u)){u=c[0];p=c[1]}if(!s.has(u)){if(r==="Activity"){a.push("{="+u+":"+p+"}")}else{var d=r;if(d==="GlobalVariable"){d="GlobalVar"}if(d==="GlobalConstant"){d="GlobalConst"}if(d==="Parameter"){d="Template"}a.push("{="+d+":"+u+"}")}continue}if(r==="Activity"){var v=babelHelpers.classPrivateFieldGet(this,ni).getRobotById(u);if(!v.getReturnProperty(p)){a.push("{="+u+":"+p+"}")}}}}catch(e){n.e(e)}finally{n.f()}}}return a}},{key:"node",get:function e(){return babelHelpers.classPrivateFieldGet(this,ui)}},{key:"data",get:function e(){return ii(ii({},babelHelpers.classPrivateFieldGet(this,si)),{},{Condition:babelHelpers.classPrivateFieldGet(this,pi).serialize(),Delay:babelHelpers.classPrivateFieldGet(this,ci).serialize()})}},{key:"draft",get:function e(){return babelHelpers.classPrivateFieldGet(this,bi)},set:function e(t){babelHelpers.classPrivateFieldSet(this,bi,t)}},{key:"template",get:function e(){return babelHelpers.classPrivateFieldGet(this,ni)}}],[{key:"generateName",value:function e(){return"A"+parseInt(Math.random()*1e5)+"_"+parseInt(Math.random()*1e5)+"_"+parseInt(Math.random()*1e5)+"_"+parseInt(Math.random()*1e5)}}]);return t}(r.EventEmitter);function fi(e,t,i){gi(e,t);t.set(e,i)}function gi(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var mi=new WeakMap;var yi=function(){function e(t){babelHelpers.classCallCheck(this,e);fi(this,mi,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,mi,t)}babelHelpers.createClass(e,[{key:"clone",value:function t(){return new e(b.Runtime.clone(babelHelpers.classPrivateFieldGet(this,mi)))}},{key:"set",value:function e(t,i,a){if(!b.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,mi)[t])){babelHelpers.classPrivateFieldGet(this,mi)[t]={}}var r=babelHelpers.classPrivateFieldGet(this,mi)[t][i];if(r!==a){BX.userOptions.save("bizproc.automation",t,i,a,false)}return this}},{key:"get",value:function e(t,i,a){var r=a;if(this.has(t,i)){r=babelHelpers.classPrivateFieldGet(this,mi)[t][i]}return r}},{key:"has",value:function e(t,i){return b.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,mi)[t])&&b.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,mi)[t][i])}}]);return e}();var Pi,Ti,Hi,Ii,Fi;function Ei(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function Si(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ei(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ei(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Oi(e,t){ki(e,t);t.add(e)}function wi(e,t,i){ki(e,t);t.set(e,i)}function ki(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Ci(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var _i=new WeakMap;var Gi=new WeakMap;var Ai=new WeakMap;var Ni=new WeakMap;var Mi=new WeakMap;var Di=new WeakMap;var Ri=new WeakMap;var Li=new WeakMap;var Bi=new WeakMap;var xi=new WeakMap;var zi=new WeakMap;var Ui=new WeakSet;var Wi=new WeakSet;var ji=new WeakSet;var Yi=new WeakSet;var Vi=new WeakSet;var Xi=function(e){babelHelpers.inherits(t,e);function t(e){var i;var a;babelHelpers.classCallCheck(this,t);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Oi(babelHelpers.assertThisInitialized(a),Vi);Oi(babelHelpers.assertThisInitialized(a),Yi);Oi(babelHelpers.assertThisInitialized(a),ji);Oi(babelHelpers.assertThisInitialized(a),Wi);Oi(babelHelpers.assertThisInitialized(a),Ui);wi(babelHelpers.assertThisInitialized(a),_i,{writable:true,value:void 0});wi(babelHelpers.assertThisInitialized(a),Gi,{writable:true,value:void 0});wi(babelHelpers.assertThisInitialized(a),Ai,{writable:true,value:void 0});wi(babelHelpers.assertThisInitialized(a),Ni,{writable:true,value:void 0});wi(babelHelpers.assertThisInitialized(a),Mi,{writable:true,value:void 0});wi(babelHelpers.assertThisInitialized(a),Di,{writable:true,value:void 0});wi(babelHelpers.assertThisInitialized(a),Ri,{writable:true,value:void 0});wi(babelHelpers.assertThisInitialized(a),Li,{writable:true,value:void 0});wi(babelHelpers.assertThisInitialized(a),Bi,{writable:true,value:void 0});wi(babelHelpers.assertThisInitialized(a),xi,{writable:true,value:void 0});wi(babelHelpers.assertThisInitialized(a),zi,{writable:true,value:void 0});a.setEventNamespace("BX.Bizproc.Automation");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),_i,(i=e.context)!==null&&i!==void 0?i:c.getGlobalContext());a.constants=e.constants;a.variables=e.variables;babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Di,e.templateContainerNode);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Gi,e.delayMinLimitM);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Ai,e.userOptions);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Ni,babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(a),_i).tracker);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),zi,{});babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),xi,[]);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Mi,Y.none());return a}babelHelpers.createClass(t,[{key:"init",value:function e(t,i){if(b.Type.isPlainObject(t)){babelHelpers.classPrivateFieldSet(this,zi,t);if(!b.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,zi).CONSTANTS)){babelHelpers.classPrivateFieldGet(this,zi).CONSTANTS={}}if(!b.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,zi).PARAMETERS)){babelHelpers.classPrivateFieldGet(this,zi).PARAMETERS={}}if(!b.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,zi).VARIABLES)){babelHelpers.classPrivateFieldGet(this,zi).VARIABLES={}}if(!b.Type.isNil(babelHelpers.classPrivateFieldGet(this,zi).DOCUMENT_STATUS)){babelHelpers.classPrivateFieldGet(this,zi).DOCUMENT_STATUS=String(babelHelpers.classPrivateFieldGet(this,zi).DOCUMENT_STATUS)}this.markExternalModified(babelHelpers.classPrivateFieldGet(this,zi)["IS_EXTERNAL_MODIFIED"]);this.markModified(false)}babelHelpers.classPrivateFieldSet(this,Mi,Y.fromRaw(i));if(!babelHelpers.classPrivateFieldGet(this,Mi).isNone()){babelHelpers.classPrivateFieldSet(this,Ri,babelHelpers.classPrivateFieldGet(this,Di).querySelector('[data-role="automation-template"][data-status-id="'+babelHelpers.classPrivateFieldGet(this,zi).DOCUMENT_STATUS+'"]'));babelHelpers.classPrivateFieldSet(this,Li,babelHelpers.classPrivateFieldGet(this,Ri).querySelector('[data-role="robot-list"]'));babelHelpers.classPrivateFieldSet(this,Bi,babelHelpers.classPrivateFieldGet(this,Ri).querySelector('[data-role="buttons"]'));this.initRobots();this.initButtons();if(!this.isExternalModified()&&this.canEdit()){jsDD.registerDest(babelHelpers.classPrivateFieldGet(this,Ri),10)}else{jsDD.unregisterDest(babelHelpers.classPrivateFieldGet(this,Ri))}}}},{key:"reInit",value:function e(t,i){b.Dom.clean(babelHelpers.classPrivateFieldGet(this,Li));b.Dom.clean(babelHelpers.classPrivateFieldGet(this,Bi));this.destroy();this.init(t,i)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,xi).forEach((function(e){return e.destroy()}))}},{key:"canEdit",value:function e(){return babelHelpers.classPrivateFieldGet(this,_i).canEdit}},{key:"initRobots",value:function e(){babelHelpers.classPrivateFieldSet(this,xi,[]);if(b.Type.isArray(babelHelpers.classPrivateFieldGet(this,zi).ROBOTS)){for(var t=0;t<babelHelpers.classPrivateFieldGet(this,zi).ROBOTS.length;++t){var i=new hi({document:babelHelpers.classPrivateFieldGet(this,_i).document,template:this,isFrameMode:babelHelpers.classPrivateFieldGet(this,_i).get("isFrameMode"),tracker:babelHelpers.classPrivateFieldGet(this,Ni)});i.init(babelHelpers.classPrivateFieldGet(this,zi).ROBOTS[t],babelHelpers.classPrivateFieldGet(this,Mi));this.insertRobotNode(i.node);babelHelpers.classPrivateFieldGet(this,xi).push(i)}}}},{key:"getSelectedRobotNames",value:function e(){var t=[];babelHelpers.classPrivateFieldGet(this,xi).forEach((function(e){if(e.isSelected()){t.push(e.data.Name)}}));return t}},{key:"getSerializedRobots",value:function e(){var t=[];babelHelpers.classPrivateFieldGet(this,xi).forEach((function(e){return t.push(e.serialize())}));return t}},{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,zi).ID}},{key:"getStatusId",value:function e(){return babelHelpers.classPrivateFieldGet(this,zi).DOCUMENT_STATUS}},{key:"getStatus",value:function e(){var t=this;return babelHelpers.classPrivateFieldGet(this,_i).document.statusList.find((function(e){return String(e.STATUS_ID)===t.getStatusId()}))}},{key:"getTemplateId",value:function e(){var t=parseInt(babelHelpers.classPrivateFieldGet(this,zi).ID);return!isNaN(t)?t:0}},{key:"initButtons",value:function e(){if(this.isExternalModified()){this.createExternalLocker()}else if(babelHelpers.classPrivateFieldGet(this,Mi).isEdit()&&this.getTemplateId()>0){this.createConstantsEditButton();this.createParametersEditButton();this.createExternalEditTemplateButton();this.createManageModeButton()}}},{key:"enableManageMode",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,Li)){babelHelpers.classPrivateFieldSet(this,Mi,Y.manage().setProperty("isActive",t));if(t){b.Dom.addClass(babelHelpers.classPrivateFieldGet(this,Li),"--multiselect-mode")}if(this.isExternalModified()){b.Dom.addClass(babelHelpers.classPrivateFieldGet(this,Li),"--locked-node")}else{babelHelpers.classPrivateFieldGet(this,xi).forEach((function(e){return e.enableManageMode(t)}))}}}},{key:"disableManageMode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Li)){babelHelpers.classPrivateFieldSet(this,Mi,Y.edit());b.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,Li),"--multiselect-mode");if(this.isExternalModified()){b.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,Li),"--locked-node")}else{babelHelpers.classPrivateFieldGet(this,xi).forEach((function(e){return e.disableManageMode()}))}babelHelpers.classPrivateFieldGet(this,Ri).querySelectorAll(".bizproc-automation-robot-container-wrapper").forEach((function(e){b.Dom.addClass(e,"bizproc-automation-robot-container-wrapper-draggable")}))}}},{key:"enableDragAndDrop",value:function e(){babelHelpers.classPrivateFieldGet(this,xi).forEach((function(e){return e.registerItem(e.node)}));babelHelpers.classPrivateFieldGet(this,Ri).querySelectorAll(".bizproc-automation-robot-container-wrapper").forEach((function(e){b.Dom.addClass(e,"bizproc-automation-robot-container-wrapper-draggable")}))}},{key:"disableDragAndDrop",value:function e(){babelHelpers.classPrivateFieldGet(this,xi).forEach((function(e){return e.unregisterItem(e.node)}));babelHelpers.classPrivateFieldGet(this,Ri).querySelectorAll(".bizproc-automation-robot-container-wrapper").forEach((function(e){b.Dom.removeClass(e,"bizproc-automation-robot-container-wrapper-draggable")}))}},{key:"createExternalEditTemplateButton",value:function e(){if(b.Type.isNil(babelHelpers.classPrivateFieldGet(this,_i).bizprocEditorUrl)){return false}var t=this;var i=b.Dom.create("a",{text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EXTERNAL_EDIT"),props:{href:"#"},events:{click:function e(i){i.preventDefault();if(!babelHelpers.classPrivateFieldGet(t,Mi).isManage()){t.onExternalEditTemplateButtonClick(this)}}},attrs:{className:"bizproc-automation-robot-btn-set",target:"_top"}});if(!babelHelpers.classPrivateFieldGet(this,_i).bizprocEditorUrl.length){b.Dom.addClass(i,"bizproc-automation-robot-btn-set-locked")}babelHelpers.classPrivateFieldGet(this,Bi).appendChild(i)}},{key:"createManageModeButton",value:function e(){var t=this;if(!babelHelpers.classPrivateFieldGet(this,_i).canManage){return}var i=b.Dom.create("a",{text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MANAGE_ROBOTS"),attrs:{className:"bizproc-automation-robot-btn-set",target:"_top"},style:{cursor:"pointer"},events:{click:function e(a){a.preventDefault();t.onManageModeButtonClick(i)}}});babelHelpers.classPrivateFieldGet(this,Bi).appendChild(i)}},{key:"onManageModeButtonClick",value:function e(t){if(!this.canEdit()){Tt.showNoPermissionsHint(t)}else{this.emit("Template:enableManageMode",{documentStatus:babelHelpers.classPrivateFieldGet(this,zi).DOCUMENT_STATUS})}}},{key:"createConstantsEditButton",value:function e(){if(b.Type.isNil(babelHelpers.classPrivateFieldGet(this,_i).constantsEditorUrl)){return false}var t=!babelHelpers.classPrivateFieldGet(this,Mi).isManage()?babelHelpers.classPrivateFieldGet(this,_i).constantsEditorUrl.replace("#ID#",this.getTemplateId()):"#";if(!t.length){return false}var i=b.Dom.create("a",{text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CONSTANTS_EDIT"),props:{href:t},attrs:{className:"bizproc-automation-robot-btn-set"}});babelHelpers.classPrivateFieldGet(this,Bi).appendChild(i)}},{key:"createParametersEditButton",value:function e(){if(b.Type.isNil(babelHelpers.classPrivateFieldGet(this,_i).parametersEditorUrl)){return false}var t=babelHelpers.classPrivateFieldGet(this,_i).parametersEditorUrl.replace("#ID#",this.getTemplateId());if(!t.length||babelHelpers.classPrivateFieldGet(this,Mi).isManage()){return false}var i=b.Dom.create("a",{text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_PARAMETERS_EDIT"),props:{href:t},attrs:{className:"bizproc-automation-robot-btn-set"}});babelHelpers.classPrivateFieldGet(this,Bi).appendChild(i)}},{key:"createExternalLocker",value:function e(){var t=b.Dom.create("div",{attrs:{className:"bizproc-automation-robot-container"},children:[b.Dom.create("div",{attrs:{className:"bizproc-automation-robot-container-wrapper bizproc-automation-robot-container-wrapper-lock"},children:[b.Dom.create("div",{attrs:{className:"bizproc-automation-robot-deadline"}}),b.Dom.create("div",{attrs:{className:"bizproc-automation-robot-title"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EXTERNAL_EDIT_TEXT")})]})]});if(babelHelpers.classPrivateFieldGet(this,Mi).isEdit()){var i=b.Dom.create("div",{attrs:{className:"bizproc-automation-robot-btn-settings"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EDIT")});var a=this;b.Event.bind(t,"click",(function(e){e.stopPropagation();if(!babelHelpers.classPrivateFieldGet(a,Mi).isManage()){a.onExternalEditTemplateButtonClick(this)}}));t.appendChild(i);var r=b.Dom.create("SPAN",{attrs:{className:"bizproc-automation-robot-btn-delete"}});b.Event.bind(r,"click",(function(e){e.stopPropagation();if(!babelHelpers.classPrivateFieldGet(a,Mi).isManage()){a.onUnsetExternalModifiedClick(this)}}));t.lastChild.appendChild(r)}babelHelpers.classPrivateFieldGet(this,Li).appendChild(t);babelHelpers.classPrivateFieldSet(this,Ri,t)}},{key:"onSearch",value:function e(t){if(this.isExternalModified()){this.onExternalModifiedSearch(t)}else{babelHelpers.classPrivateFieldGet(this,xi).forEach((function(e){return e.onSearch(t)}))}}},{key:"onExternalModifiedSearch",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,Ri)){var i=t.getData().queryString;BX[!i?"removeClass":"addClass"](babelHelpers.classPrivateFieldGet(this,Ri),"--search-mismatch")}}},{key:"onExternalEditTemplateButtonClick",value:function e(t){if(!this.canEdit()){Tt.showNoPermissionsHint(t);return}if(!babelHelpers.classPrivateFieldGet(this,_i).bizprocEditorUrl.length){if(top.BX.UI&&top.BX.UI.InfoHelper){top.BX.UI.InfoHelper.show("limit_office_bp_designer")}return}var i=this.getTemplateId();if(i>0){this.openBizprocEditor(i)}}},{key:"onUnsetExternalModifiedClick",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ri,null);this.markExternalModified(false);this.markModified();this.reInit(null,babelHelpers.classPrivateFieldGet(this,Mi).intoRaw())}},{key:"openBizprocEditor",value:function e(t){top.window.location.href=babelHelpers.classPrivateFieldGet(this,_i).bizprocEditorUrl.replace("#ID#",t)}},{key:"addRobot",value:function e(t,i){var a=new hi({document:babelHelpers.classPrivateFieldGet(this,_i).document,template:this,isFrameMode:babelHelpers.classPrivateFieldGet(this,_i).get("isFrameMode"),tracker:babelHelpers.classPrivateFieldGet(this,Ni)});var r={Type:t["CLASS"],Properties:{Title:t["NAME"]},DialogContext:t["DIALOG_CONTEXT"]};if(babelHelpers.classPrivateFieldGet(this,xi).length>0){var s=babelHelpers.classPrivateFieldGet(this,xi)[babelHelpers.classPrivateFieldGet(this,xi).length-1];if(!s.getDelayInterval().isNow()||s.isExecuteAfterPrevious()){r["Delay"]=s.getDelayInterval().serialize();r["ExecuteAfterPrevious"]=1}}a.draft=true;a.init(r,babelHelpers.classPrivateFieldGet(this,Mi));this.insertRobot(a);this.insertRobotNode(a.node);this.emit("Template:robot:add",{robot:a});if(i){i.call(this,a)}}},{key:"insertRobot",value:function e(t,i){if(i){for(var a=0;a<babelHelpers.classPrivateFieldGet(this,xi).length;++a){if(babelHelpers.classPrivateFieldGet(this,xi)[a]!==i){continue}babelHelpers.classPrivateFieldGet(this,xi).splice(a,0,t);break}}else{babelHelpers.classPrivateFieldGet(this,xi).push(t)}this.markModified()}},{key:"getNextRobot",value:function e(t){for(var i=0;i<babelHelpers.classPrivateFieldGet(this,xi).length;++i){if(babelHelpers.classPrivateFieldGet(this,xi)[i]===t){return babelHelpers.classPrivateFieldGet(this,xi)[i+1]||null}}return null}},{key:"deleteRobot",value:function e(t,i){for(var a=0;a<babelHelpers.classPrivateFieldGet(this,xi).length;++a){if(babelHelpers.classPrivateFieldGet(this,xi)[a].isEqual(t)){babelHelpers.classPrivateFieldGet(this,xi).splice(a,1);if(i){i(t)}this.markModified();this.emit("Template:robot:delete",{robot:t});break}}}},{key:"insertRobotNode",value:function e(t,i){if(i){babelHelpers.classPrivateFieldGet(this,Li).insertBefore(t,i)}else{babelHelpers.classPrivateFieldGet(this,Li).appendChild(t)}}},{key:"openRobotSettingsDialog",value:function e(t,i,a){var r=this;if(!b.Type.isPlainObject(i)){i={}}if(c.Designer.getInstance().getRobotSettingsDialog()){if(i.changeRobot){c.Designer.getInstance().getRobotSettingsDialog().popup.close()}else{return}}var s="bizproc_automation_robot_dialog";var l=b.Dom.create("form",{props:{name:s}});c.Designer.getInstance().setRobotSettingsDialog({template:this,context:i,robot:t,form:l});l.appendChild(this.renderDelaySettings(t));l.appendChild(this.renderConditionSettings(t));var n=t.getBrokenLinks();if(n.length>0){b.Dom.append(this.renderBrokenLinkAlert(n),l)}var o=b.Dom.create("div",{attrs:{className:"bizproc-automation-robot-help"},events:{click:function e(t){return r.emit("Template:help:show",t)}}});l.appendChild(o);i["DOCUMENT_CATEGORY_ID"]=babelHelpers.classPrivateFieldGet(this,_i).document.getCategoryId();if(b.Type.isPlainObject(t.data.DialogContext)&&t.data.DialogContext.hasOwnProperty("addMenuGroup")){i["addMenuGroup"]=t.data.DialogContext.addMenuGroup}BX.ajax({method:"POST",dataType:"html",url:b.Uri.addParam(babelHelpers.classPrivateFieldGet(this,_i).ajaxUrl,{analyticsLabel:"automation_robot".concat(t.draft?"_draft":"","_settings_").concat(t.data.Type.toLowerCase())}),data:{ajax_action:"get_robot_dialog",document_signed:babelHelpers.classPrivateFieldGet(this,_i).signedDocument,document_status:babelHelpers.classPrivateFieldGet(this,_i).document.getCurrentStatusId(),context:i,robot_json:ge.toJsonString(t.serialize()),form_name:s},onsuccess:function e(i){if(i){var s=b.Dom.create("div",{html:i});l.appendChild(s)}r.showRobotSettingsPopup(t,l,a)}})}},{key:"showRobotSettingsPopup",value:function e(t,i,a){var r=this;var s=580;var l=s;if(babelHelpers.classPrivateFieldGet(this,Ai)){this.emit("Template:robot:showSettings");l=parseInt(babelHelpers.classPrivateFieldGet(this,Ai).get("defaults","robot_settings_popup_width",580))}this.initRobotSettingsControls(t,i);if(t.data.Type==="CrmSendEmailActivity"||t.data.Type==="MailActivity"||t.data.Type==="RpaApproveActivity"){s+=170;if(l<s){l=s}}var n=b.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_SETTINGS_TITLE");var o=b.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_SETTINGS_TITLE");if(t.hasTitle()){n=t.getTitle();o=t.getDescriptionTitle();if(o==="untitled"){o=n}}var u=b.Tag.render(Pi||(Pi=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="popup-window-titlebar-text bizproc-automation-robot-settings-popup-titlebar">\n\t\t\t\t<span class="bizproc-automation-robot-settings-popup-titlebar-text">','</span>\n\t\t\t\t<div class="ui-hint">\n\t\t\t\t\t<span class="ui-hint-icon" data-text="','"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),b.Text.encode(n),b.Text.encode(o));Tt.bindAll(u);var p=this;var d=new BX.PopupWindow(ge.generateUniqueId(),null,{titleBar:{content:u},content:i,closeIcon:true,width:l,resizable:{minWidth:s,minHeight:100},offsetLeft:0,offsetTop:0,closeByEsc:true,draggable:{restrict:false},events:{onPopupClose:function e(t){c.Designer.getInstance().setRobotSettingsDialog(null);r.destroyRobotSettingsControls();t.destroy();r.emit("Template:robot:closeSettings")},onPopupResize:function e(){r.onResizeRobotSettings()},onPopupResizeEnd:function e(){if(babelHelpers.classPrivateFieldGet(p,Ai)){babelHelpers.classPrivateFieldGet(p,Ai).set("defaults","robot_settings_popup_width",this.getWidth())}}},buttons:[new BX.PopupWindowButton({text:b.Loc.getMessage("JS_CORE_WINDOW_SAVE"),className:"popup-window-button-accept",events:{click:function e(){var r=t.draft;p.saveRobotSettings(i,t,BX.delegate((function(){this.popupWindow.close();if(r){p.emit("Template:robot:add",{robot:t})}if(a){a(t)}}),this),this.buttonNode)}}}),new BX.PopupWindowButtonLink({text:b.Loc.getMessage("JS_CORE_WINDOW_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function e(){this.popupWindow.close()}}})]});c.Designer.getInstance().getRobotSettingsDialog().popup=d;d.show()}},{key:"initRobotSettingsControls",value:function e(t,i){if(!b.Type.isArray(this.robotSettingsControls)){this.robotSettingsControls=[]}var a=i.querySelectorAll("[data-role]");for(var r=0;r<a.length;++r){this.initRobotSettingsControl(t,a[r])}}},{key:"initRobotSettingsControl",value:function e(t,i){var a=this;if(!b.Type.isArray(this.robotSettingsControls)){this.robotSettingsControls=[]}var r=i.getAttribute("data-role");var s={context:new c.SelectorContext({fields:b.Runtime.clone(babelHelpers.classPrivateFieldGet(this,_i).document.getFields()),useSwitcherMenu:babelHelpers.classPrivateFieldGet(this,_i).get("showTemplatePropertiesMenuOnSelecting"),rootGroupTitle:babelHelpers.classPrivateFieldGet(this,_i).document.title,userOptions:babelHelpers.classPrivateFieldGet(this,_i).userOptions}),needSync:t.draft,checkbox:i};if(r===c.SelectorManager.SELECTOR_ROLE_USER){var l=JSON.parse(i.getAttribute("data-property"));s.context.set("additionalUserFields",[].concat(babelHelpers.toConsumableArray(Ci(this,Ui,Zi).call(this,l)),babelHelpers.toConsumableArray(this.globalConstants.filter((function(e){return e["Type"]==="user"})).map((function(e){return{id:e["Expression"],title:e["Name"]}}))),babelHelpers.toConsumableArray(this.globalVariables.filter((function(e){return e["Type"]==="user"})).map((function(e){return{id:e["Expression"],title:e["Name"]}})))))}else if(r===c.SelectorManager.SELECTOR_ROLE_FILE){this.robots.forEach((function(e){var t;(t=s.context.fields).push.apply(t,babelHelpers.toConsumableArray(e.getReturnFieldsDescription().filter((function(e){return e["Type"]==="file"})).map((function(t){return{Id:"{{~".concat(e.getId(),":").concat(t["Id"],"}}"),Name:"".concat(e.getTitle(),": ").concat(t["Name"]),Type:"file",Expression:"{{~".concat(e.getId(),":").concat(t["Id"],"}}")}}))))}))}var n=c.SelectorManager.createSelectorByRole(r,s);if(n&&r!==c.SelectorManager.SELECTOR_ROLE_SAVE_STATE){n.renderTo(i);n.subscribe("onAskConstant",(function(e){var t=e.getData(),i=t.fieldProperty;n.onFieldSelect(a.addConstant(i))}));n.subscribe("onAskParameter",(function(e){var t=e.getData(),i=t.fieldProperty;n.onFieldSelect(a.addParameter(i))}));n.subscribe("onOpenFieldMenu",(function(e){return a.onOpenMenu(e,t)}));n.subscribe("onOpenMenu",(function(e){return a.onOpenMenu(e,t)}))}BX.UI.Hint.init(i);if(n){this.robotSettingsControls.push(n)}}},{key:"destroyRobotSettingsControls",value:function e(){if(this.conditionSelector){this.conditionSelector.destroy();this.conditionSelector=null}if(b.Type.isArray(this.robotSettingsControls)){for(var t=0;t<this.robotSettingsControls.length;++t){if(b.Type.isFunction(this.robotSettingsControls[t].destroy)){this.robotSettingsControls[t].destroy()}}}this.robotSettingsControls=null}},{key:"onBeforeSaveRobotSettings",value:function e(){if(b.Type.isArray(this.robotSettingsControls)){for(var t=0;t<this.robotSettingsControls.length;++t){if(b.Type.isFunction(this.robotSettingsControls[t].onBeforeSave)){this.robotSettingsControls[t].onBeforeSave()}}}}},{key:"onResizeRobotSettings",value:function e(){if(b.Type.isArray(this.robotSettingsControls)){for(var t=0;t<this.robotSettingsControls.length;++t){if(b.Type.isFunction(this.robotSettingsControls[t].onPopupResize)){this.robotSettingsControls[t].onPopupResize()}}}}},{key:"renderDelaySettings",value:function e(t){var i=t.getDelayInterval().clone();var a=ge.generateUniqueId();var r=b.Dom.create("input",{attrs:{type:"hidden",name:"delay_type",value:i.type}});var s=b.Dom.create("input",{attrs:{type:"hidden",name:"delay_value",value:i.value}});var l=b.Dom.create("input",{attrs:{type:"hidden",name:"delay_value_type",value:i.valueType}});var n=b.Dom.create("input",{attrs:{type:"hidden",name:"delay_basis",value:i.basis}});var o=b.Dom.create("input",{attrs:{type:"hidden",name:"delay_worktime",value:i.workTime?1:0}});var u=b.Dom.create("input",{attrs:{type:"hidden",name:"delay_wait_workday",value:i.waitWorkDay?1:0}});var p=b.Dom.create("input",{attrs:{type:"hidden",name:"delay_in_time",value:i.inTimeString}});var d=b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis"}});var v=[];var h=babelHelpers.classPrivateFieldGet(this,_i).document.getFields();var f=babelHelpers.classPrivateFieldGet(this,Gi);if(b.Type.isArray(h)){for(var g=0;g<h.length;++g){var m=h[g];if(m["Type"]==="date"||m["Type"]==="datetime"){v.push(m)}}}var y=new c.DelayIntervalSelector({labelNode:d,onchange:function e(t){r.value=t.type;s.value=t.value;l.value=t.valueType;n.value=t.basis;o.value=t.workTime?1:0;u.value=t.waitWorkDay?1:0;p.value=t.inTimeString},basisFields:v,minLimitM:f,useAfterBasis:true,showWaitWorkDay:true});var P=null;if(t.hasTemplate()){var T=b.Dom.create("input",{attrs:{type:"checkbox",id:"param-group-3-1"+a,name:"execute_after_previous",value:"1",style:"vertical-align: middle"}});if(t.isExecuteAfterPrevious()){T.setAttribute("checked","checked")}P=b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-block"},children:[T,b.Dom.create("label",{attrs:{for:"param-group-3-1"+a,style:"color: #535C69"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AFTER_PREVIOUS_WIDE")})]})}var H=b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings bizproc-automation-popup-settings-flex"},children:[b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-block bizproc-automation-popup-settings-block-flex"},children:[b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title-wrapper"},children:[r,s,l,n,o,u,p,b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-left"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TO_EXECUTE")+":"}),d]})]}),P]});y.init(i);return H}},{key:"setDelaySettingsFromForm",value:function e(t,i){var a=new Pt;a.setType(t["delay_type"]);a.setValue(t["delay_value"]);a.setValueType(t["delay_value_type"]);a.setBasis(t["delay_basis"]);a.setWorkTime(t["delay_worktime"]==="1");a.setWaitWorkDay(t["delay_wait_workday"]==="1");a.setInTime(t["delay_in_time"]?t["delay_in_time"].split(":"):null);i.setDelayInterval(a);if(i.hasTemplate()){i.setExecuteAfterPrevious(t["execute_after_previous"]&&t["execute_after_previous"]==="1")}return this}},{key:"renderConditionSettings",value:function e(t){var i=this;var a=t.getCondition();this.conditionSelector=new c.ConditionGroupSelector(a,{fields:babelHelpers.classPrivateFieldGet(this,_i).document.getFields(),onOpenFieldMenu:function e(a){return i.onOpenMenu(a,t)},onOpenMenu:function e(a){return i.onOpenMenu(a,t)}});return b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-block"},children:[b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION")+":"}),this.conditionSelector.createNode()]})]})}},{key:"onOpenMenu",value:function e(t,i){Ci(this,Wi,qi).call(this,t,i);Ci(this,ji,Ki).call(this,t);Ci(this,Yi,Ji).call(this,t);this.emit("Template:onSelectorMenuOpen",Si({template:this,robot:i},t.getData()))}},{key:"setConditionSettingsFromForm",value:function e(t,i){i.setCondition(c.ConditionGroup.createFromForm(t));return this}},{key:"renderBrokenLinkAlert",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var i=b.Tag.render(Ti||(Ti=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-robot-broken-link-full-info">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),t.map((function(e){return b.Text.encode(e)})).join("<br>"));var a=b.Tag.render(Hi||(Hi=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="bizproc-automation-robot-broken-link-show-more">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),b.Loc.getMessage("JS_BIZPROC_AUTOMATION_BROKEN_LINK_MESSAGE_ERROR_MORE_INFO"));b.Event.bindOnce(a,"click",(function(){b.Dom.style(i,"height",i.scrollHeight+"px");b.Dom.remove(a)}));var r=b.Tag.render(Ii||(Ii=babelHelpers.taggedTemplateLiteral(['<span class="ui-alert-close-btn"></span>'])));var s=b.Tag.render(Fi||(Fi=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-alert ui-alert-warning ui-alert-icon-info">\n\t\t\t\t<div class="ui-alert-message">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span>',"</span>\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),b.Loc.getMessage("BIZPROC_AUTOMATION_BROKEN_LINK_MESSAGE_ERROR"),a,i,r);b.Event.bindOnce(r,"click",(function(){b.Dom.remove(s)}));return s}},{key:"saveRobotSettings",value:function e(t,i,a,r){var s=this;if(r){r.classList.add("popup-window-button-wait")}this.onBeforeSaveRobotSettings();var l=BX.ajax.prepareForm(t);var n=babelHelpers.classPrivateFieldGet(this,_i).ajaxUrl;var o=babelHelpers.classPrivateFieldGet(this,_i).signedDocument;BX.ajax({method:"POST",dataType:"json",url:b.Uri.addParam(n,{analyticsLabel:"automation_robot".concat(i.draft?"_draft":"","_save_").concat(i.data.Type.toLowerCase())}),data:{ajax_action:"save_robot_settings",document_signed:o,robot_json:ge.toJsonString(i.serialize()),form_data_json:ge.toJsonString(l["data"]),form_data:l["data"]},onsuccess:function e(t){if(r){r.classList.remove("popup-window-button-wait")}if(t.SUCCESS){i.updateData(t.DATA.robot);s.setDelaySettingsFromForm(l["data"],i);s.setConditionSettingsFromForm(l["data"],i);i.draft=false;i.reInit();s.markModified();if(a){a(t.DATA)}}else{alert(t.ERRORS[0])}}})}},{key:"serialize",value:function e(){var t=BX.clone(babelHelpers.classPrivateFieldGet(this,zi));t["IS_EXTERNAL_MODIFIED"]=this.isExternalModified()?1:0;t["ROBOTS"]=[];for(var i=0;i<babelHelpers.classPrivateFieldGet(this,xi).length;++i){t["ROBOTS"].push(babelHelpers.classPrivateFieldGet(this,xi)[i].serialize())}return t}},{key:"isExternalModified",value:function e(){return this.externalModified===true}},{key:"markExternalModified",value:function e(t){this.externalModified=t!==false}},{key:"getRobotById",value:function e(t){return babelHelpers.classPrivateFieldGet(this,xi).find((function(e){return e.getId()===t}))}},{key:"isModified",value:function e(){return this.modified}},{key:"markModified",value:function e(t){this.modified=t!==false;if(this.modified){this.emit("Template:modified")}}},{key:"getConstants",value:function e(){var t=this;var i=[];Object.keys(babelHelpers.classPrivateFieldGet(this,zi).CONSTANTS).forEach((function(e){var a=b.Runtime.clone(babelHelpers.classPrivateFieldGet(t,zi).CONSTANTS[e]);a.Id=e;a.ObjectId="Constant";a.SystemExpression="{=Constant:"+e+"}";a.Expression="{{~&:"+e+"}}";i.push(a)}));return i}},{key:"getConstant",value:function e(t){var i=this.getConstants();for(var a=0;a<i.length;++a){if(i[a].Id===t){return i[a]}}return null}},{key:"addConstant",value:function e(t){var i=t.Id||this.generatePropertyId("Constant",babelHelpers.classPrivateFieldGet(this,zi).CONSTANTS);if(babelHelpers.classPrivateFieldGet(this,zi).CONSTANTS[i]){throw'Constant with id "'.concat(i,'" is already exists')}babelHelpers.classPrivateFieldGet(this,zi).CONSTANTS[i]=t;this.emit("Template:constant:add");return this.getConstant(i)}},{key:"updateConstant",value:function e(t,i){if(!babelHelpers.classPrivateFieldGet(this,zi).CONSTANTS[t]){throw'Constant with id "'.concat(t,'" does not exists')}babelHelpers.classPrivateFieldGet(this,zi).CONSTANTS[t].Description=i.Description;this.emit("Template:constant:update",{constant:this.getConstant(t)});return this.getConstant(t)}},{key:"deleteConstant",value:function e(t){delete babelHelpers.classPrivateFieldGet(this,zi).CONSTANTS[t];return true}},{key:"setConstantValue",value:function e(t,i){if(babelHelpers.classPrivateFieldGet(this,zi).CONSTANTS[t]){babelHelpers.classPrivateFieldGet(this,zi).CONSTANTS[t]["Default"]=i;return true}return false}},{key:"getParameters",value:function e(){var t=this;var i=[];Object.keys(babelHelpers.classPrivateFieldGet(this,zi).PARAMETERS).forEach((function(e){var a=BX.clone(babelHelpers.classPrivateFieldGet(t,zi).PARAMETERS[e]);a.Id=e;a.ObjectId="Template";a.SystemExpression="{=Template:"+e+"}";a.Expression="{{~*:"+e+"}}";i.push(a)}));return i}},{key:"getParameter",value:function e(t){var i=this.getParameters();for(var a=0;a<i.length;++a){if(i[a].Id===t){return i[a]}}return null}},{key:"addParameter",value:function e(t){var i=t.Id||this.generatePropertyId("Parameter",babelHelpers.classPrivateFieldGet(this,zi).PARAMETERS);if(babelHelpers.classPrivateFieldGet(this,zi).PARAMETERS[i]){throw'Parameter with id "'.concat(i,'" is already exists')}babelHelpers.classPrivateFieldGet(this,zi).PARAMETERS[i]=t;this.emit("Template:parameter:add",{parameter:this.getParameter(i)});return this.getParameter(i)}},{key:"updateParameter",value:function e(t,i){if(!babelHelpers.classPrivateFieldGet(this,zi).PARAMETERS[t]){throw'Parameter with id "'.concat(t,'" does not exists')}babelHelpers.classPrivateFieldGet(this,zi).PARAMETERS[t].Description=i.Description;this.emit("Template:parameter:update",{parameter:this.getParameter(t)});return this.getParameter(t)}},{key:"deleteParameter",value:function e(t){delete babelHelpers.classPrivateFieldGet(this,zi).PARAMETERS[t];return true}},{key:"setParameterValue",value:function e(t,i){if(babelHelpers.classPrivateFieldGet(this,zi).PARAMETERS[t]){babelHelpers.classPrivateFieldGet(this,zi).PARAMETERS[t]["Default"]=i;return true}return false}},{key:"getVariables",value:function e(){var t=this;var i=[];Object.keys(babelHelpers.classPrivateFieldGet(this,zi).VARIABLES).forEach((function(e){var a=b.Runtime.clone(babelHelpers.classPrivateFieldGet(t,zi).VARIABLES[e]);a.Id=e;a.ObjectId="Variable";a.SystemExpression="{=Variable:"+e+"}";a.Expression="{=Variable:"+e+"}";i.push(a)}));return i}},{key:"generatePropertyId",value:function e(t,i){var a;for(a=1;a<=1e3;++a){if(!i[t+a]){break}}return t+a}},{key:"collectUsages",value:function e(){var t={Document:new Set,Constant:new Set,Variable:new Set,Parameter:new Set,GlobalConstant:new Set,GlobalVariable:new Set,Activity:new Set};babelHelpers.classPrivateFieldGet(this,xi).forEach((function(e){var i=e.collectUsages();Object.keys(t).forEach((function(e){i[e].forEach((function(i){if(!t[e].has(i)){t[e].add(i)}}))}))}));return t}},{key:"subscribeRobotEvents",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,xi).forEach((function(e){return e.subscribe(t,i)}));return this}},{key:"unsubscribeRobotEvents",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,xi).forEach((function(e){return e.unsubscribe(t,i)}));return this}},{key:"getRobotDescription",value:function e(t){return babelHelpers.classPrivateFieldGet(this,_i).availableRobots.find((function(e){return e["CLASS"]===t}))}},{key:"robots",get:function e(){return babelHelpers.classPrivateFieldGet(this,xi)}},{key:"userOptions",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ai)}},{key:"globalConstants",get:function e(){return babelHelpers.classPrivateFieldGet(this,_i).automationGlobals?babelHelpers.classPrivateFieldGet(this,_i).automationGlobals.globalConstants:[]}},{key:"globalVariables",get:function e(){return babelHelpers.classPrivateFieldGet(this,_i).automationGlobals?babelHelpers.classPrivateFieldGet(this,_i).automationGlobals.globalVariables:[]}}],[{key:"copyRobotTo",value:function e(t,i,a){var r=i.copyTo(t,a);t.emit("Template:robot:add",{robot:r})}}]);return t}(r.EventEmitter);function Zi(e){var t=Ci(this,Vi,Qi).call(this).map((function(e){return e.getReturnFieldsDescription().filter((function(e){return e["Type"]==="user"})).map((function(t){return{id:"{{~".concat(e.getId(),":").concat(t["Id"],"}}"),title:"".concat(e.getTitle(),": ").concat(t["Name"])}}))})).flat();if(babelHelpers.classPrivateFieldGet(this,_i).get("showTemplatePropertiesMenuOnSelecting")&&e){var i=this.addConstant(b.Runtime.clone(e));t.push({id:i.Expression,title:b.Loc.getMessage("BIZPROC_AUTOMATION_ASK_CONSTANT"),tabs:["recents","bpuserroles"],sort:1});var a=this.addParameter(b.Runtime.clone(e));t.push({id:a.Expression,title:b.Loc.getMessage("BIZPROC_AUTOMATION_ASK_PARAMETER"),tabs:["recents","bpuserroles"],sort:2})}return t}function qi(e,t){var i=e.getData().selector;var a=e.getData().isMixedCondition;if(b.Type.isBoolean(a)&&!a){return}var r=Ci(this,Vi,Qi).call(this,t).map((function(e){return{id:e.getId(),title:e.getTitle(),children:e.getReturnFieldsDescription().map((function(e){return{id:e.Expression,title:e.Name,customData:{field:e}}}))}}));if(r.length>0){i.addGroup("__RESULT",{id:"__RESULT",title:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ROBOT_LIST"),children:r})}}function Ki(e){var t=e.getData().selector;var i=e.getData().isMixedCondition;if(b.Type.isBoolean(i)&&!i){return}var a=this.getConstants().map((function(e){return{id:e.SystemExpression,title:e.Name,supertitle:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TEMPLATE_CONSTANTS_LIST"),customData:{field:e}}}));this.globalConstants.forEach((function(e){a.push({id:e.SystemExpression,title:e["Name"],supertitle:e.SuperTitle,customData:{field:e}})}));if(b.Type.isArrayFilled(a)){t.addGroup("__CONSTANTS",{id:"__CONSTANTS",title:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CONSTANTS_LIST"),children:a})}}function Ji(e){var t=e.getData().selector;var i=e.getData().isMixedCondition;if(b.Type.isBoolean(i)&&!i){return}var a=this.globalVariables.map((function(e){return{id:e.SystemExpression,title:e.Name,supertitle:e.SuperTitle,customData:{field:e}}}));if(b.Type.isArrayFilled(a)){t.addGroup("__GLOB_VARIABLES",{id:"__GLOB_VARIABLES",title:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_GLOB_VARIABLES_LIST_1"),children:a})}}function Qi(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:undefined;var t=(e===null||e===void 0?void 0:e.getId())||"";return this.robots.filter((function(e){return e.getId()!==t&&e.hasReturnFields()}))}function $i(e,t,i){ea(e,t);t.set(e,i)}function ea(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var ta=new WeakMap;var ia=new WeakMap;var aa=new WeakMap;var ra=new WeakMap;var sa=function(){function e(t,i){babelHelpers.classCallCheck(this,e);$i(this,ta,{writable:true,value:void 0});$i(this,ia,{writable:true,value:void 0});$i(this,aa,{writable:true,value:void 0});$i(this,ra,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,ta,"Document");babelHelpers.classPrivateFieldSet(this,ia,"");babelHelpers.classPrivateFieldSet(this,aa,"!empty");babelHelpers.classPrivateFieldSet(this,ra,"");this.parentGroup=null;if(b.Type.isPlainObject(t)){if(t["object"]){this.setObject(t["object"])}if(t["field"]){this.setField(t["field"])}if(t["operator"]){this.setOperator(t["operator"])}if("value"in t){this.setValue(t["value"])}}if(i){this.parentGroup=i}}babelHelpers.createClass(e,[{key:"clone",value:function t(){return new e({object:babelHelpers.classPrivateFieldGet(this,ta),field:babelHelpers.classPrivateFieldGet(this,ia),operator:babelHelpers.classPrivateFieldGet(this,aa),value:babelHelpers.classPrivateFieldGet(this,ra)},this.parentGroup)}},{key:"setObject",value:function e(t){if(b.Type.isStringFilled(t)){babelHelpers.classPrivateFieldSet(this,ta,t)}}},{key:"setField",value:function e(t){if(b.Type.isStringFilled(t)){babelHelpers.classPrivateFieldSet(this,ia,t)}}},{key:"setOperator",value:function e(t){if(!t){t=a.Operator.EQUAL}babelHelpers.classPrivateFieldSet(this,aa,t)}},{key:"setValue",value:function e(t){babelHelpers.classPrivateFieldSet(this,ra,t);if(babelHelpers.classPrivateFieldGet(this,aa)===a.Operator.EQUAL&&babelHelpers.classPrivateFieldGet(this,ra)===""){babelHelpers.classPrivateFieldSet(this,aa,"empty")}else if(babelHelpers.classPrivateFieldGet(this,aa)===a.Operator.NOT_EQUAL&&babelHelpers.classPrivateFieldGet(this,ra)===""){babelHelpers.classPrivateFieldSet(this,aa,"!empty")}}},{key:"serialize",value:function e(){return{object:babelHelpers.classPrivateFieldGet(this,ta),field:babelHelpers.classPrivateFieldGet(this,ia),operator:babelHelpers.classPrivateFieldGet(this,aa),value:babelHelpers.classPrivateFieldGet(this,ra)}}},{key:"object",get:function e(){return babelHelpers.classPrivateFieldGet(this,ta)}},{key:"field",get:function e(){return babelHelpers.classPrivateFieldGet(this,ia)}},{key:"operator",get:function e(){return babelHelpers.classPrivateFieldGet(this,aa)}},{key:"value",get:function e(){return babelHelpers.classPrivateFieldGet(this,ra)}}]);return e}();function la(e,t,i){na(e,t);t.set(e,i)}function na(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var oa=new WeakMap;var ca=new WeakMap;var ua=new WeakMap;var pa=function(){function e(t){var i=this;babelHelpers.classCallCheck(this,e);la(this,oa,{writable:true,value:void 0});la(this,ca,{writable:true,value:void 0});la(this,ua,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,oa,e.CONDITION_TYPE.Field);babelHelpers.classPrivateFieldSet(this,ca,[]);if(b.Type.isPlainObject(t)){if(t["type"]){babelHelpers.classPrivateFieldSet(this,oa,t["type"])}if(b.Type.isArray(t["items"])){t["items"].forEach((function(e){var t=new sa(e[0],i);i.addItem(t,e[1])}))}if(b.Type.isPlainObject(t["activityNames"])){babelHelpers.classPrivateFieldSet(this,ua,t["activityNames"])}}}babelHelpers.createClass(e,[{key:"clone",value:function t(){var i=new e({type:babelHelpers.classPrivateFieldGet(this,oa)});babelHelpers.classPrivateFieldGet(this,ca).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),a=t[0],r=t[1];var s=a.clone();s.parentGroup=i;i.addItem(s,r)}));return i}},{key:"addItem",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,ca).push([t,i])}},{key:"getItems",value:function e(){return babelHelpers.classPrivateFieldGet(this,ca)}},{key:"serialize",value:function e(){var t=[];babelHelpers.classPrivateFieldGet(this,ca).forEach((function(e){if(e.field!==""){t.push([e[0].serialize(),e[1]])}}));return{type:babelHelpers.classPrivateFieldGet(this,oa),items:t,activityNames:babelHelpers.classPrivateFieldGet(this,ua)}}},{key:"conditionNamesList",get:function e(){if(b.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,ua))){return[babelHelpers.classPrivateFieldGet(this,ua).Activity,babelHelpers.classPrivateFieldGet(this,ua).Branch1,babelHelpers.classPrivateFieldGet(this,ua).Branch2]}return[]}},{key:"type",get:function e(){return babelHelpers.classPrivateFieldGet(this,oa)},set:function t(i){if(Object.values(e.CONDITION_TYPE).includes(i)){babelHelpers.classPrivateFieldSet(this,oa,i)}return this}},{key:"items",get:function e(){return babelHelpers.classPrivateFieldGet(this,ca)}}],[{key:"createFromForm",value:function t(i,r){var s=new e;if(!r){r="condition_"}if(b.Type.isArray(i[r+"field"])){for(var l=0,n=0;l<i[r+"field"].length;++l,++n){if(i[r+"field"][l]===""){continue}var o=new sa({},s);o.setObject(i[r+"object"][l]);o.setField(i[r+"field"][l]);o.setOperator(i[r+"operator"][l]);var c=o.operator===a.Operator.BETWEEN?[i[r+"value"][n],i[r+"value"][n+1]]:i[r+"value"][n];o.setValue(c);var u=e.JOINER.And;if(i[r+"joiner"]&&i[r+"joiner"][l]===e.JOINER.Or){u=e.JOINER.Or}if(o.operator===a.Operator.BETWEEN){n++}s.addItem(o,u)}}return s}}]);return e}();babelHelpers.defineProperty(pa,"CONDITION_TYPE",{Field:"field",Mixed:"mixed"});babelHelpers.defineProperty(pa,"JOINER",{And:"AND",Or:"OR",message:function e(t){if(t===this.Or){return b.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_OR")}return b.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_AND")}});var ba,da,va,ha,fa,ga;function ma(e,t){Pa(e,t);t.add(e)}function ya(e,t,i){Pa(e,t);t.set(e,i)}function Pa(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Ta(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Ha=new WeakMap;var Ia=new WeakMap;var Fa=new WeakMap;var Ea=new WeakMap;var Sa=new WeakMap;var Oa=new WeakMap;var wa=new WeakMap;var ka=new WeakMap;var Ca=new WeakMap;var _a=new WeakMap;var Ga=new WeakSet;var Aa=new WeakSet;var Na=new WeakSet;var Ma=function(){function e(t,i){babelHelpers.classCallCheck(this,e);ma(this,Na);ma(this,Aa);ma(this,Ga);ya(this,Ha,{writable:true,value:void 0});ya(this,Ia,{writable:true,value:void 0});ya(this,Fa,{writable:true,value:void 0});ya(this,Ea,{writable:true,value:void 0});ya(this,Sa,{writable:true,value:void 0});ya(this,Oa,{writable:true,value:void 0});ya(this,wa,{writable:true,value:void 0});ya(this,ka,{writable:true,value:void 0});ya(this,Ca,{writable:true,value:null});ya(this,_a,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Ha,t);babelHelpers.classPrivateFieldSet(this,Ia,[]);babelHelpers.classPrivateFieldSet(this,Fa,c.ConditionGroup.JOINER.And);babelHelpers.classPrivateFieldSet(this,Ea,"condition_");if(b.Type.isPlainObject(i)){var a;if(b.Type.isArray(i.fields)){babelHelpers.classPrivateFieldSet(this,Ia,i.fields.map((function(e){e.ObjectId="Document";return e})))}if(i.joiner&&i.joiner===c.ConditionGroup.JOINER.Or){babelHelpers.classPrivateFieldSet(this,Fa,c.ConditionGroup.JOINER.Or)}if(i.fieldPrefix){babelHelpers.classPrivateFieldSet(this,Ea,i.fieldPrefix)}babelHelpers.classPrivateFieldSet(this,Sa,i.rootGroupTitle);babelHelpers.classPrivateFieldSet(this,Oa,i.onOpenFieldMenu);babelHelpers.classPrivateFieldSet(this,wa,i.onOpenMenu);babelHelpers.classPrivateFieldSet(this,ka,(a=i.showValuesSelector)!==null&&a!==void 0?a:true)}}babelHelpers.createClass(e,[{key:"createNode",value:function e(){var t=this.objectNode=b.Dom.create("input",{attrs:{type:"hidden",name:babelHelpers.classPrivateFieldGet(this,Ea)+"object[]",value:babelHelpers.classPrivateFieldGet(this,Ha).object}});var i=this.fieldNode=b.Dom.create("input",{attrs:{type:"hidden",name:babelHelpers.classPrivateFieldGet(this,Ea)+"field[]",value:babelHelpers.classPrivateFieldGet(this,Ha).field}});var r=this.operatorNode=b.Dom.create("input",{attrs:{type:"hidden",name:babelHelpers.classPrivateFieldGet(this,Ea)+"operator[]",value:babelHelpers.classPrivateFieldGet(this,Ha).operator}});var s=b.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,Ha).value)?babelHelpers.classPrivateFieldGet(this,Ha).value[0]:babelHelpers.classPrivateFieldGet(this,Ha).value;this.valueNode=Ta(this,Ga,Da).call(this,s);var l=this.valueNode;var n;if(babelHelpers.classPrivateFieldGet(this,Ha).operator===a.Operator.BETWEEN){var o=b.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,Ha).value)&&babelHelpers.classPrivateFieldGet(this,Ha).value.length>1?babelHelpers.classPrivateFieldGet(this,Ha).value[1]:"";babelHelpers.classPrivateFieldSet(this,Ca,Ta(this,Ga,Da).call(this,o));n=babelHelpers.classPrivateFieldGet(this,Ca)}var u=this.joinerNode=b.Dom.create("input",{attrs:{type:"hidden",name:babelHelpers.classPrivateFieldGet(this,Ea)+"joiner[]",value:babelHelpers.classPrivateFieldGet(this,Fa)}});var p=this.labelNode=b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link-wrapper"}});this.setLabelText();this.bindLabelNode();var d=b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link-remove"},events:{click:this.removeCondition.bind(this)}});var v=b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link bizproc-automation-condition-joiner"},text:c.ConditionGroup.JOINER.message(babelHelpers.classPrivateFieldGet(this,Fa))});b.Event.bind(v,"click",this.changeJoiner.bind(this,v));this.node=b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link-wrapper bizproc-automation-condition-wrapper"},children:[t,i,r,l,n,u,p,d,v]});return this.node}},{key:"init",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ha,t);this.setLabelText();this.bindLabelNode()}},{key:"setLabelText",value:function e(){if(!this.labelNode||!babelHelpers.classPrivateFieldGet(this,Ha)){return}b.Dom.clean(this.labelNode);if(babelHelpers.classPrivateFieldGet(this,Ha).field!==""){var t=this.getField(babelHelpers.classPrivateFieldGet(this,Ha).object,babelHelpers.classPrivateFieldGet(this,Ha).field)||"?";var i=Ta(this,Aa,Ra).call(this,t);b.Dom.append(b.Tag.render(ba||(ba=babelHelpers.taggedTemplateLiteral(['<span class="bizproc-automation-popup-settings-link">',"</span>"])),b.Text.encode(t.Name)),this.labelNode);b.Dom.append(b.Tag.render(da||(da=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="bizproc-automation-popup-settings-link">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t"])),b.Text.encode(this.getOperatorLabel(babelHelpers.classPrivateFieldGet(this,Ha).operator))),this.labelNode);if(i){b.Dom.append(b.Tag.render(va||(va=babelHelpers.taggedTemplateLiteral(['<span class="bizproc-automation-popup-settings-link">',"</span>"])),b.Text.encode(i)),this.labelNode)}}else{b.Dom.append(b.Tag.render(ha||(ha=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="bizproc-automation-popup-settings-link">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t"])),b.Text.encode(this.getOperatorLabel(a.Operator.EMPTY))),this.labelNode)}}},{key:"bindLabelNode",value:function e(){if(this.labelNode){b.Event.bind(this.labelNode,"click",this.onLabelClick.bind(this))}}},{key:"onLabelClick",value:function e(){this.showPopup()}},{key:"showPopup",value:function e(){if(this.popup){this.popup.show();return}var t=this.filterFields();var i=b.Dom.create("input",{attrs:{type:"hidden",className:"bizproc-automation-popup-settings-dropdown"}});var r=b.Dom.create("input",{attrs:{type:"hidden",className:"bizproc-automation-popup-settings-dropdown"}});var s=b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-dropdown",readonly:"readonly"},children:[r]});b.Event.bind(s,"click",this.onFieldSelectorClick.bind(this,s,r,t,i));var l=this.getField(babelHelpers.classPrivateFieldGet(this,Ha).object,babelHelpers.classPrivateFieldGet(this,Ha).field);if(!babelHelpers.classPrivateFieldGet(this,Ha).field){l=t[0]}babelHelpers.classPrivateFieldSet(this,_a,l);r.value=l.Id;i.value=l.ObjectId;s.textContent=l.Name;var n=Ta(this,Na,La).call(this,l,babelHelpers.classPrivateFieldGet(this,Ha).value,babelHelpers.classPrivateFieldGet(this,Ha).operator);var o=b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[n]});var c=this.createOperatorNode(l,o);var u=b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[c]});if(babelHelpers.classPrivateFieldGet(this,Ha).field!==""){c.value=babelHelpers.classPrivateFieldGet(this,Ha).operator}var p=b.Dom.create("form",{attrs:{className:"bizproc-automation-popup-select-block"},children:[b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[s]}),u,o]});b.Event.bind(r,"change",this.onFieldChange.bind(this,r,u,o,i));var d=this;this.popup=new BX.PopupWindow("bizproc-automation-popup-set",this.labelNode,{className:"bizproc-automation-popup-set",autoHide:false,closeByEsc:true,closeIcon:false,titleBar:false,angle:true,offsetLeft:45,overlay:{backgroundColor:"transparent"},content:p,buttons:[new BX.PopupWindowButton({text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CHOOSE"),className:"webform-button webform-button-create",events:{click:function e(){babelHelpers.classPrivateFieldGet(d,Ha).setObject(i.value);babelHelpers.classPrivateFieldGet(d,Ha).setField(r.value);babelHelpers.classPrivateFieldGet(d,Ha).setOperator(u.firstChild.value);var t=o.querySelectorAll('[name^="'+babelHelpers.classPrivateFieldGet(d,Ea)+'value"]');if(t.length>0){var s=t[0].value;if(babelHelpers.classPrivateFieldGet(d,Ha).operator===a.Operator.BETWEEN&&t.length>1){s=[t[0].value,t[1].value]}babelHelpers.classPrivateFieldGet(d,Ha).setValue(s)}else{babelHelpers.classPrivateFieldGet(d,Ha).setValue("")}d.setLabelText();var l=d.getField(babelHelpers.classPrivateFieldGet(d,Ha).object,babelHelpers.classPrivateFieldGet(d,Ha).field);if(l&&l.Type==="UF:address"){var n=o.querySelector('[name="'+babelHelpers.classPrivateFieldGet(d,Ea)+'value"]');babelHelpers.classPrivateFieldGet(d,Ha).setValue(n?n.value:"")}d.updateValueNode();this.popupWindow.close()}}}),new BX.PopupWindowButtonLink({text:b.Loc.getMessage("JS_CORE_WINDOW_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function e(){this.popupWindow.close()}}})],events:{onPopupClose:function e(){this.destroy();if(d.fieldDialog){d.fieldDialog.destroy();delete d.fieldDialog}delete d.popup}}});this.popup.show()}},{key:"onFieldSelectorClick",value:function e(t,i,a,r,s){if(!this.fieldDialog){var l=c.getGlobalContext();var n=b.Runtime.clone(b.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,Ia))?babelHelpers.classPrivateFieldGet(this,Ia):l.document.getFields());this.fieldDialog=new c.InlineSelectorCondition({context:new c.SelectorContext({fields:n,rootGroupTitle:l.document.title}),condition:babelHelpers.classPrivateFieldGet(this,Ha)});if(b.Type.isFunction(babelHelpers.classPrivateFieldGet(this,Oa))){this.fieldDialog.subscribe("onOpenMenu",babelHelpers.classPrivateFieldGet(this,Oa))}this.fieldDialog.subscribe("change",(function(e){var a=e.getData().field;t.textContent=a.Name;i.value=a.Id;r.value=a.ObjectId;BX.fireEvent(i,"change")}));this.fieldDialog.renderTo(t)}this.fieldDialog.openMenu(s)}},{key:"updateValueNode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ha)){if(this.objectNode){this.objectNode.value=babelHelpers.classPrivateFieldGet(this,Ha).object}if(this.fieldNode){this.fieldNode.value=babelHelpers.classPrivateFieldGet(this,Ha).field}if(this.operatorNode){this.operatorNode.value=babelHelpers.classPrivateFieldGet(this,Ha).operator}if(this.valueNode){this.valueNode.value=b.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,Ha).value)?babelHelpers.classPrivateFieldGet(this,Ha).value[0]:babelHelpers.classPrivateFieldGet(this,Ha).value}if(babelHelpers.classPrivateFieldGet(this,Ha).operator===a.Operator.BETWEEN){var t=babelHelpers.classPrivateFieldGet(this,Ha).value[1]||"";if(babelHelpers.classPrivateFieldGet(this,Ca)){babelHelpers.classPrivateFieldGet(this,Ca).value=t}else{babelHelpers.classPrivateFieldSet(this,Ca,Ta(this,Ga,Da).call(this,t));b.Dom.append(babelHelpers.classPrivateFieldGet(this,Ca),this.node)}}else if(b.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,Ca))){b.Dom.remove(babelHelpers.classPrivateFieldGet(this,Ca));babelHelpers.classPrivateFieldSet(this,Ca,null)}}}},{key:"onFieldChange",value:function e(t,i,a,r){var s;var l=this.getField(r.value,t.value);var n=this.createOperatorNode(l,a);if(l.Type!==((s=babelHelpers.classPrivateFieldGet(this,_a))===null||s===void 0?void 0:s.Type)){b.Dom.clean(a)}babelHelpers.classPrivateFieldSet(this,_a,l);if(this.getOperators(l["Type"],l["Multiple"])[i.firstChild.value]){n.value=i.firstChild.value}i.replaceChild(n,i.firstChild);this.onOperatorChange(n,l,a)}},{key:"onOperatorChange",value:function e(t,i,a){var r=a.querySelector('[name^="'+babelHelpers.classPrivateFieldGet(this,Ea)+'value"]');b.Dom.clean(a);b.Dom.append(Ta(this,Na,La).call(this,i,(r===null||r===void 0?void 0:r.value)||babelHelpers.classPrivateFieldGet(this,Ha).value,t.value),a)}},{key:"getField",value:function e(t,i){var a;var r=c.Designer.getInstance().robot;var s=c.Designer.getInstance().component;var l=r?r.getTemplate():null;switch(t){case"Document":for(var n=0;n<babelHelpers.classPrivateFieldGet(this,Ia).length;++n){if(i===babelHelpers.classPrivateFieldGet(this,Ia)[n].Id){a=babelHelpers.classPrivateFieldGet(this,Ia)[n]}}break;case"Template":if(l&&s&&s.triggerManager){a=s.triggerManager.getReturnProperty(l.getStatusId(),i)}break;case"Constant":if(l){a=l.getConstant(i)}break;case"GlobalConst":if(s){a=s.getConstant(i)}break;case"GlobalVar":if(s){a=s.getGVariable(i)}break;default:var o=l?l.getRobotById(t):null;if(o){a=o.getReturnProperty(i)}break}return a||{Id:i,ObjectId:t,Name:i,Type:"string",Expression:i,SystemExpression:"{="+t+":"+i+"}"}}},{key:"getOperators",value:function e(t,i){var r=a.Operator.getAllLabels();var s={"!empty":r[a.Operator.NOT_EMPTY],empty:r[a.Operator.EMPTY],"=":r[a.Operator.EQUAL],"!=":r[a.Operator.NOT_EQUAL]};switch(t){case"file":case"UF:crm":case"UF:resourcebooking":s={"!empty":r[a.Operator.NOT_EMPTY],empty:r[a.Operator.EMPTY]};break;case"bool":case"select":if(i){s[a.Operator.CONTAIN]=r[a.Operator.CONTAIN];s[a.Operator.NOT_CONTAIN]=r[a.Operator.NOT_CONTAIN]}break;case"user":s[a.Operator.IN]=r[a.Operator.IN];s[a.Operator.NOT_IN]=r[a.Operator.NOT_IN];s[a.Operator.CONTAIN]=r[a.Operator.CONTAIN];s[a.Operator.NOT_CONTAIN]=r[a.Operator.NOT_CONTAIN];break;default:s[a.Operator.IN]=r[a.Operator.IN];s[a.Operator.NOT_IN]=r[a.Operator.NOT_IN];s[a.Operator.CONTAIN]=r[a.Operator.CONTAIN];s[a.Operator.NOT_CONTAIN]=r[a.Operator.NOT_CONTAIN];s[a.Operator.GREATER_THEN]=r[a.Operator.GREATER_THEN];s[a.Operator.GREATER_THEN_OR_EQUAL]=r[a.Operator.GREATER_THEN_OR_EQUAL];s[a.Operator.LESS_THEN]=r[a.Operator.LESS_THEN];s[a.Operator.LESS_THEN_OR_EQUAL]=r[a.Operator.LESS_THEN_OR_EQUAL]}return s}},{key:"getOperatorLabel",value:function e(t){return a.Operator.getOperatorLabel(t)}},{key:"filterFields",value:function e(){var t=[];for(var i=0;i<babelHelpers.classPrivateFieldGet(this,Ia).length;++i){var a=babelHelpers.classPrivateFieldGet(this,Ia)[i]["Type"];if(a==="bool"||a==="date"||a==="datetime"||a==="double"||a==="file"||a==="int"||a==="select"||a==="string"||a==="text"||a==="user"||a==="UF:money"||a==="UF:crm"||a==="UF:resourcebooking"||a==="UF:url"){t.push(babelHelpers.classPrivateFieldGet(this,Ia)[i])}}return t}},{key:"createValueNode",value:function e(t,i){var a=this;var r=c.Designer.getInstance().component?c.Designer.getInstance().component.document.getRawType():c.getGlobalContext().document.getRawType();var s=BX.clone(t);s.Multiple=false;var l=BX.Bizproc.FieldType.renderControlPublic(r,s,babelHelpers.classPrivateFieldGet(this,Ea)+"value",i,false);l.querySelectorAll("[data-role]").forEach((function(e){var t;var i=c.SelectorManager.createSelectorByRole(e.dataset.role,{context:new c.SelectorContext({fields:c.getGlobalContext().document.getFields(),useSwitcherMenu:false,rootGroupTitle:(t=babelHelpers.classPrivateFieldGet(a,Sa))!==null&&t!==void 0?t:c.getGlobalContext().document.title})});if(i){if(babelHelpers.classPrivateFieldGet(a,ka)===true){if(b.Type.isFunction(babelHelpers.classPrivateFieldGet(a,wa))){i.subscribe("onOpenMenu",babelHelpers.classPrivateFieldGet(a,wa))}i.renderTo(e)}else{i.targetInput=e;i.parseTargetProperties()}}}));return l}},{key:"createOperatorNode",value:function e(t,i){var a=b.Dom.create("select",{attrs:{className:"bizproc-automation-popup-settings-dropdown"}});var r=this.getOperators(t["Type"],t["Multiple"]);for(var s in r){if(!r.hasOwnProperty(s)){continue}a.appendChild(b.Dom.create("option",{props:{value:s},text:r[s]}))}b.Event.bind(a,"change",this.onOperatorChange.bind(this,a,t,i));return a}},{key:"removeCondition",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ha,null);b.Dom.remove(this.node);this.labelNode=null;this.fieldNode=null;this.operatorNode=null;this.valueNode=null;babelHelpers.classPrivateFieldSet(this,Ca,null);this.node=null;t.stopPropagation()}},{key:"changeJoiner",value:function e(t,i){babelHelpers.classPrivateFieldSet(this,Fa,babelHelpers.classPrivateFieldGet(this,Fa)===c.ConditionGroup.JOINER.Or?c.ConditionGroup.JOINER.And:c.ConditionGroup.JOINER.Or);t.textContent=c.ConditionGroup.JOINER.message(babelHelpers.classPrivateFieldGet(this,Fa));if(this.joinerNode){this.joinerNode.value=babelHelpers.classPrivateFieldGet(this,Fa)}i.preventDefault()}},{key:"destroy",value:function e(){if(this.popup){this.popup.close()}}}]);return e}();function Da(e){return b.Tag.render(fa||(fa=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input\n\t\t\t\ttype="hidden"\n\t\t\t\tname="','"\n\t\t\t\tvalue="','"\n\t\t\t>\n\t\t'])),b.Text.encode(babelHelpers.classPrivateFieldGet(this,Ea)+"value[]"),b.Text.encode(e))}function Ra(e){var t=babelHelpers.classPrivateFieldGet(this,Ha).operator;var i=babelHelpers.classPrivateFieldGet(this,Ha).value;if(t==="between"){var a;return(a=b.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_BETWEEN_VALUE",{"#VALUE_1#":BX.Bizproc.FieldType.formatValuePrintable(e,b.Type.isArrayFilled(i)?i[0]:i),"#VALUE_2#":BX.Bizproc.FieldType.formatValuePrintable(e,b.Type.isArrayFilled(i)?i[1]:"")}))!==null&&a!==void 0?a:""}else if(t.indexOf("empty")<0){return BX.Bizproc.FieldType.formatValuePrintable(e,i)}return null}function La(e,t,i){if(i===a.Operator.BETWEEN){var r=this.createValueNode(e,b.Type.isArrayFilled(t)?t[0]:t);var s=this.createValueNode(e,b.Type.isArrayFilled(t)?t[1]:"");return b.Tag.render(ga||(ga=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t<div>\n\t\t\t\t\t","\n\t\t\t\t\t<div>","</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"])),r,c.ConditionGroup.JOINER.message("AND"),s)}else if(i.indexOf("empty")<0){return this.createValueNode(e,t)}return""}function Ba(e,t,i){xa(e,t);t.set(e,i)}function xa(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var za=new WeakMap;var Ua=new WeakMap;var Wa=new WeakMap;var ja=new WeakMap;var Ya=new WeakMap;var Va=new WeakMap;var Xa=new WeakMap;var Za=new WeakMap;var qa=function(){function e(t,i){babelHelpers.classCallCheck(this,e);Ba(this,za,{writable:true,value:void 0});Ba(this,Ua,{writable:true,value:void 0});Ba(this,Wa,{writable:true,value:void 0});Ba(this,ja,{writable:true,value:void 0});Ba(this,Ya,{writable:true,value:void 0});Ba(this,Va,{writable:true,value:void 0});Ba(this,Xa,{writable:true,value:void 0});Ba(this,Za,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,za,t);babelHelpers.classPrivateFieldSet(this,Ua,[]);babelHelpers.classPrivateFieldSet(this,Wa,"condition_");babelHelpers.classPrivateFieldSet(this,ja,[]);if(b.Type.isPlainObject(i)){var a;if(b.Type.isArray(i.fields)){babelHelpers.classPrivateFieldSet(this,Ua,i.fields)}if(i.fieldPrefix){babelHelpers.classPrivateFieldSet(this,Wa,i.fieldPrefix)}babelHelpers.classPrivateFieldSet(this,Za,i.rootGroupTitle);babelHelpers.classPrivateFieldSet(this,Ya,i.onOpenFieldMenu);babelHelpers.classPrivateFieldSet(this,Va,i.onOpenMenu);babelHelpers.classPrivateFieldSet(this,Xa,(a=i.showValuesSelector)!==null&&a!==void 0?a:true)}}babelHelpers.createClass(e,[{key:"createNode",value:function e(){var t=this;var i=[];babelHelpers.classPrivateFieldGet(this,za).getItems().forEach((function(e){var a=new Ma(e[0],{fields:babelHelpers.classPrivateFieldGet(t,Ua),joiner:e[1],fieldPrefix:babelHelpers.classPrivateFieldGet(t,Wa),rootGroupTitle:babelHelpers.classPrivateFieldGet(t,Za),onOpenFieldMenu:babelHelpers.classPrivateFieldGet(t,Ya),onOpenMenu:babelHelpers.classPrivateFieldGet(t,Va),showValuesSelector:babelHelpers.classPrivateFieldGet(t,Xa)});babelHelpers.classPrivateFieldGet(t,ja).push(a);i.push(a.createNode())}));var a=this;i.push(b.Dom.create("a",{attrs:{className:"bizproc-automation-popup-settings-link"},text:"[+]",events:{click:function e(){a.addItem(this)}}}));return b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link-wrapper"},children:i})}},{key:"addItem",value:function e(t){var i=new Ma(new c.Condition({},babelHelpers.classPrivateFieldGet(this,za)),{fields:babelHelpers.classPrivateFieldGet(this,Ua),fieldPrefix:babelHelpers.classPrivateFieldGet(this,Wa),rootGroupTitle:babelHelpers.classPrivateFieldGet(this,Za),onOpenFieldMenu:babelHelpers.classPrivateFieldGet(this,Ya),onOpenMenu:babelHelpers.classPrivateFieldGet(this,Va),showValuesSelector:babelHelpers.classPrivateFieldGet(this,Xa)});babelHelpers.classPrivateFieldGet(this,ja).push(i);t.parentNode.insertBefore(i.createNode(),t)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,ja).forEach((function(e){return e.destroy()}));babelHelpers.classPrivateFieldSet(this,ja,[])}}]);return e}();var Ka=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getSelectorByTarget",value:function e(t){var i;var a=(i=c.Designer.getInstance().getRobotSettingsDialog())===null||i===void 0?void 0:i.template;if(a&&b.Type.isArray(a.robotSettingsControls)){return a.robotSettingsControls.find((function(e){return e.targetInput===t}))}return undefined}},{key:"createSelectorByRole",value:function e(t,i){if(t===this.SELECTOR_ROLE_USER){return new c.UserSelector(i)}else if(t===this.SELECTOR_ROLE_FILE){return new c.FileSelector(i)}else if(t===this.SELECTOR_ROLE_INLINE){return new c.InlineSelector(i)}else if(t===this.SELECTOR_ROLE_INLINE_HTML){return new c.InlineSelectorHtml(i)}else if(t===this.SELECTOR_ROLE_TIME){return new c.TimeSelector(i)}else if(t===this.SELECTOR_ROLE_SAVE_STATE){return new c.SaveStateCheckbox(i)}else{return undefined}}}]);return e}();babelHelpers.defineProperty(Ka,"SELECTOR_ROLE_USER","user-selector");babelHelpers.defineProperty(Ka,"SELECTOR_ROLE_FILE","file-selector");babelHelpers.defineProperty(Ka,"SELECTOR_ROLE_INLINE","inline-selector-target");babelHelpers.defineProperty(Ka,"SELECTOR_ROLE_INLINE_HTML","inline-selector-html");babelHelpers.defineProperty(Ka,"SELECTOR_ROLE_TIME","time-selector");babelHelpers.defineProperty(Ka,"SELECTOR_ROLE_SAVE_STATE","save-state-checkbox");function Ja(e,t){$a(e,t);t.add(e)}function Qa(e,t,i){$a(e,t);t.set(e,i)}function $a(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function er(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var tr=new WeakMap;var ir=new WeakMap;var ar=new WeakMap;var rr=new WeakMap;var sr=new WeakMap;var lr=new WeakSet;var nr=new WeakSet;var or=new WeakSet;var cr=new WeakSet;var ur=new WeakSet;var pr=new WeakSet;var br=new WeakSet;var dr=function(){function e(t){babelHelpers.classCallCheck(this,e);Ja(this,br);Ja(this,pr);Ja(this,ur);Ja(this,cr);Ja(this,or);Ja(this,nr);Ja(this,lr);Qa(this,tr,{writable:true,value:null});Qa(this,ir,{writable:true,value:""});Qa(this,ar,{writable:true,value:[]});Qa(this,rr,{writable:true,value:void 0});Qa(this,sr,{writable:true,value:void 0});if(b.Type.isPlainObject(t)){if(b.Type.isElementNode(t.labelNode)){babelHelpers.classPrivateFieldSet(this,tr,t.labelNode)}}er(this,lr,vr).call(this);er(this,nr,hr).call(this)}babelHelpers.createClass(e,[{key:"init",value:function e(t){if(b.Type.isStringFilled(t)){babelHelpers.classPrivateFieldSet(this,ir,t)}er(this,cr,gr).call(this);er(this,ur,mr).call(this)}}]);return e}();function vr(){var e=function e(t){return BX.Main.Date.convertBitrixFormat(b.Loc.getMessage(t)).replace(/:?\s*s/,"")};var t=e("FORMAT_DATE");var i=e("FORMAT_DATETIME");babelHelpers.classPrivateFieldSet(this,rr,i.replace(t,"").trim())}function hr(){var e=this;var t=function t(i,a){i.preventDefault();babelHelpers.classPrivateFieldGet(e,tr).value=b.Text.encode(a.text);this.close()};for(var i=0;i<24;i++){babelHelpers.classPrivateFieldGet(this,ar).push({id:i*60,text:er(this,or,fr).call(this,i,0),onclick:t});babelHelpers.classPrivateFieldGet(this,ar).push({id:i*60+30,text:er(this,or,fr).call(this,i,30),onclick:t})}}function fr(e,t){var i=new Date;i.setHours(e,t);return l.DateTimeFormat.format(babelHelpers.classPrivateFieldGet(this,rr),i.getTime()/1e3)}function gr(){if(b.Type.isElementNode(babelHelpers.classPrivateFieldGet(this,tr))){babelHelpers.classPrivateFieldGet(this,tr).textContent=babelHelpers.classPrivateFieldGet(this,ir)}}function mr(){if(b.Type.isElementNode(babelHelpers.classPrivateFieldGet(this,tr))){b.Event.bind(babelHelpers.classPrivateFieldGet(this,tr),"click",er(this,pr,yr).bind(this))}}function yr(e){er(this,br,Pr).call(this);e.preventDefault()}function Pr(){if(b.Type.isNil(babelHelpers.classPrivateFieldGet(this,sr))){babelHelpers.classPrivateFieldSet(this,sr,new n.Menu({autoHide:true,bindElement:babelHelpers.classPrivateFieldGet(this,tr),items:babelHelpers.classPrivateFieldGet(this,ar),maxHeight:230}))}babelHelpers.classPrivateFieldGet(this,sr).show()}var Tr,Hr;function Ir(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function Fr(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ir(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ir(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Er(e,t){Or(e,t);t.add(e)}function Sr(e,t,i){Or(e,t);t.set(e,i)}function Or(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function wr(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var kr=new WeakMap;var Cr=new WeakMap;var _r=new WeakMap;var Gr=new WeakSet;var Ar=new WeakSet;var Nr=new WeakSet;var Mr=new WeakSet;var Dr=new WeakSet;var Rr=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Er(babelHelpers.assertThisInitialized(i),Dr);Er(babelHelpers.assertThisInitialized(i),Mr);Er(babelHelpers.assertThisInitialized(i),Nr);Er(babelHelpers.assertThisInitialized(i),Ar);Er(babelHelpers.assertThisInitialized(i),Gr);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"fieldProperty",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"replaceOnWrite",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"menuButton",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"targetInput",null);Sr(babelHelpers.assertThisInitialized(i),kr,{writable:true,value:{}});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"basisFields",[]);Sr(babelHelpers.assertThisInitialized(i),Cr,{writable:true,value:null});Sr(babelHelpers.assertThisInitialized(i),_r,{writable:true,value:null});i.setEventNamespace("BX.Bizproc.Automation.Selector");i.context=e.context;i.basisFields=i.context.fields;return i}babelHelpers.createClass(t,[{key:"hasGroup",value:function e(t){return babelHelpers.classPrivateFieldGet(this,kr).hasOwnProperty(t)}},{key:"addGroup",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,kr)[t]=wr(this,Gr,Lr).call(this,i)}},{key:"addGroupItem",value:function e(t,i){if(this.hasGroup(t)){babelHelpers.classPrivateFieldGet(this,kr)[t].children.push(wr(this,Gr,Lr).call(this,i))}}},{key:"renderWith",value:function e(t){this.targetInput=b.Runtime.clone(t);this.targetInput.setAttribute("autocomplete","off");this.menuButton=b.Tag.render(Tr||(Tr=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span \n\t\t\t\tonclick="','"\n\t\t\t\tclass="bizproc-automation-popup-select-dotted"\n\t\t\t></span>\n\t\t'])),this.openMenu.bind(this));this.parseTargetProperties();this.replaceOnWrite|=this.targetInput.getAttribute("data-select-mode")==="replace";return b.Tag.render(Hr||(Hr=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-select">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this.targetInput,this.menuButton)}},{key:"renderTo",value:function e(t){t.parentNode.replaceChild(this.renderWith(t),t)}},{key:"bindTargetEvents",value:function e(){b.Event.bind(this.targetInput,"keydown",wr(this,Mr,zr).bind(this))}},{key:"parseTargetProperties",value:function e(){this.fieldProperty=JSON.parse(this.targetInput.getAttribute("data-property"));var t=this.targetInput.getAttribute("data-selector-type");if(!this.fieldProperty&&t){this.fieldProperty={Type:t}}if(this.fieldProperty){this.fieldProperty.Type=this.fieldProperty.Type||t;wr(this,Ar,Br).call(this)}else{this.context.useSwitcherMenu=false}this.replaceOnWrite|=this.targetInput.getAttribute("data-select-mode")==="replace"}},{key:"openMenu",value:function e(t){var i=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!a&&this.context.useSwitcherMenu&&!this.targetInput.value){return this.openPropertiesSwitcherMenu()}if(babelHelpers.classPrivateFieldGet(this,Cr)){babelHelpers.classPrivateFieldGet(this,Cr).show();return}this.fillGroups();this.onMenuOpen();var r=[];for(var l=0,n=Object.values(babelHelpers.classPrivateFieldGet(this,kr));l<n.length;l++){var o=n[l];if(o.children.length>0){r.push(o)}}if(r.length===1){r=r[0].children}var u=this.menuButton.getAttribute("data-selector-id");if(!u){u=c.Helper.generateUniqueId();this.menuButton.setAttribute("data-selector-id",u)}babelHelpers.classPrivateFieldSet(this,Cr,new s.Dialog({targetNode:this.menuButton,width:500,height:300,multiple:false,dropdownMode:true,enableSearch:true,items:this.injectDialogMenuTitles(r),showAvatars:false,events:{"Item:onBeforeSelect":function e(t){t.preventDefault();var a=t.getData().item;i.onFieldSelect(a.getCustomData().get("field"))}},compactView:true}));babelHelpers.classPrivateFieldGet(this,Cr).show()}},{key:"fillGroups",value:function e(){this.fillFieldsGroups();this.fillFileGroup()}},{key:"fillFieldsGroups",value:function e(){var t=this;this.addGroup("ROOT",{id:"ROOT",title:this.context.rootGroupTitle,searchable:false});this.getFields().forEach((function(e){var i=e.Id.indexOf(".")<0?"ROOT":e.Id.split(".")[0];var a="";var r=e.Name;if(e.Name&&i!=="ROOT"&&e.Name.indexOf(": ")>=0){var s=e.Name.split(": ");a=s.shift();r=s.join(": ")}if(e["Id"].indexOf("ASSIGNED_BY_")===0&&e["Id"]!=="ASSIGNED_BY_ID"&&e["Id"]!=="ASSIGNED_BY_PRINTABLE"){i="ASSIGNED_BY";var l=e.Name.split(" ");a=l.shift();r=l.join(" ").replace("(","").replace(")","")}if(!t.hasGroup(i)){t.addGroup(i,{id:i,title:a,searchable:false})}t.addGroupItem(i,{id:e.SystemExpression,title:r||e.Id,customData:{field:e}})}))}},{key:"fillFileGroup",value:function e(){var t=this.getFields().filter((function(e){return e.Type==="file"}));if(t.length>0){this.addGroup("__FILES",{id:"__FILES",title:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_FILES_LINKS"),children:wr(this,Dr,Ur).call(this,t),searchable:false})}}},{key:"onMenuOpen",value:function e(){this.emit("onOpenMenu",{selector:this})}},{key:"openPropertiesSwitcherMenu",value:function e(){var t;var i=this;n.MenuManager.show(c.Helper.generateUniqueId(),this.menuButton,[{text:b.Loc.getMessage("BIZPROC_AUTOMATION_ASK_CONSTANT"),disabled:((t=i.fieldProperty)===null||t===void 0?void 0:t.Type)==="file",onclick:function e(t){this.popupWindow.close();i.emit("onAskConstant",{fieldProperty:i.fieldProperty})}},{text:b.Loc.getMessage("BIZPROC_AUTOMATION_ASK_PARAMETER"),onclick:function e(t){this.popupWindow.close();i.emit("onAskParameter",{fieldProperty:i.fieldProperty})}},{text:b.Loc.getMessage("BIZPROC_AUTOMATION_ASK_MANUAL"),onclick:function e(t){this.popupWindow.close();i.openMenu(t,true)}}],{autoHide:true,offsetLeft:20,angle:{position:"top"},events:{onPopupClose:function e(){this.destroy()}}});babelHelpers.classPrivateFieldSet(this,_r,n.MenuManager.currentItem);return true}},{key:"injectDialogMenuTitles",value:function e(t){var i=this;t.forEach((function(e){if(b.Type.isArray(e.children)){i.injectDialogMenuSupertitles(e.title,e.children)}}));return t}},{key:"injectDialogMenuSupertitles",value:function e(t,i){var a=this;i.forEach((function(e){if(!e.supertitle){e.supertitle=t}if(b.Type.isArrayFilled(e.children)){a.injectDialogMenuSupertitles(e.title,e.children)}}))}},{key:"onFieldSelect",value:function e(t){if(!t){return}var i=this.targetInput.tagName.toLowerCase();if(i==="select"){var a=this.targetInput.querySelector('[data-role="expression"]');if(!a){a=this.targetInput.appendChild(b.Dom.create("option",{attrs:{"data-role":"expression"}}))}a.setAttribute("value",t.Expression);a.textContent=t["Expression"];a.selected=true}else if(i==="label"){this.targetInput.textContent=t.Expression;var r=document.getElementById(this.targetInput.getAttribute("for"));if(r){r.value=t.Expression}}else{if(this.replaceOnWrite){this.targetInput.value=t.Expression;this.targetInput.selectionEnd=this.targetInput.value.length}else{var s="";var l=t.Expression;var n="";if(b.Type.isStringFilled(this.targetInput.value)){s=this.targetInput.value.substr(0,this.targetInput.selectionEnd);n=this.targetInput.value.substr(this.targetInput.selectionEnd)}this.targetInput.value=s+l+n;this.targetInput.selectionEnd=s.length+l.length}}BX.fireEvent(this.targetInput,"change");this.emit("Field:Selected",{field:t})}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Cr)){babelHelpers.classPrivateFieldGet(this,Cr).destroy()}if(babelHelpers.classPrivateFieldGet(this,_r)){babelHelpers.classPrivateFieldGet(this,_r).destroy()}}},{key:"getFields",value:function e(){var t=b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX");var i=this.context.fields.map((function(e){return e.Name})).join("\n");var a=[];this.basisFields.forEach((function(e){e.ObjectId="Document";var r=e["BaseType"]==="string"&&e["Type"]!=="string";if(!r){a.push(e)}if(e["Type"]==="user"||e["Type"]==="bool"||e["Type"]==="file"||r){var s=e["Name"]+" "+t;if(i.indexOf(s)<0){var l=BX.clone(e);var n=e["Type"]==="user"?"friendly":"printable";l["Name"]=s;l["Type"]="string";l["SystemExpression"]="{=Document:"+l["Id"]+" > "+n+"}";l["Expression"]="{{"+e["Name"]+" > "+n+"}}";a.push(l)}}if(e["BaseType"]==="date"||e["BaseType"]==="datetime"||e["BaseType"]==="time"){var o=BX.clone(e);o["Name"]+=" "+b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_DATE_BY_SERVER");o["Type"]="string";o["SystemExpression"]="{=Document:".concat(o["Id"]," > server}");o["Expression"]="{{".concat(e["Name"]," > server}}");a.push(o);var c=BX.clone(e);c["Name"]+=" "+b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_DATE_BY_RESPONSIBLE");c["Type"]="string";c["SystemExpression"]="{=Document:".concat(o["Id"]," > responsible}");c["Expression"]="{{".concat(e["Name"]," > responsible}}");a.push(c)}}));return a}}]);return t}(r.EventEmitter);function Lr(e){var t=this;if(!b.Type.isArray(e.children)){e.children=[]}e.children=e.children.filter((function(e){var i;return(i=e.customData)!==null&&i!==void 0&&i.field?wr(t,Nr,xr).call(t,e.customData.field):true})).map((function(e){return wr(t,Gr,Lr).call(t,e)}));return Fr({entityId:"bp",tabs:"recents"},e)}function Br(){var e=this,t;this.basisFields=this.basisFields.filter((function(t){return wr(e,Nr,xr).call(e,t)}));var i=(t=this.fieldProperty)===null||t===void 0?void 0:t.Type;if(i==="file"){this.replaceOnWrite=true}else if(i==="date"||i==="datetime"){this.replaceOnWrite=true;var a=new c.DelayIntervalSelector({labelNode:this.targetInput,basisFields:this.basisFields,useAfterBasis:true,onchange:function(e){this.targetInput.value=e.toExpression(this.basisFields,c.Helper.getResponsibleUserExpression(this.context.fields))}.bind(this)});a.init(c.DelayInterval.fromString(this.targetInput.value,this.basisFields))}else if(i==="time"){this.replaceOnWrite=true;var r=new dr({labelNode:this.targetInput});r.init(this.targetInput.value)}}function xr(e){var t;var i=(t=this.fieldProperty)===null||t===void 0?void 0:t.Type;if(i==="file"){return e.Type==="file"}else if(i==="date"||i==="datetime"){return e.Type==="date"||e.Type==="datetime"}else if(i==="time"){return e.Type==="date"||e.Type==="datetime"||e.Type==="time"}return true}function zr(e){if(e.keyCode===45&&e.altKey===false&&e.ctrlKey===false&&e.shiftKey===false){this.openMenu(e);e.preventDefault()}}function Ur(e){return e.map((function(e){var t=e["ObjectId"]==="Document"?"{{"+e["Name"]+" > shortlink}}":"{{~"+e["ObjectId"]+":"+e["Id"]+" > shortlink}}";var i=e.Name||e.Id;if(e.ObjectName){i=e.ObjectName+": "+i}return{title:i,customData:{field:{Id:e["Id"]+"_shortlink",ObjectId:e["ObjectId"],Name:e["Name"],Type:"string",Expression:t,SystemExpression:"{="+e["ObjectId"]+":"+e["Id"]+" > shortlink}"}},id:t}}))}function Wr(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function jr(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Wr(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Wr(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Yr(e,t){Xr(e,t);t.add(e)}function Vr(e,t,i){Xr(e,t);t.set(e,i)}function Xr(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Zr(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var qr=new WeakMap;var Kr=new WeakSet;var Jr=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Yr(babelHelpers.assertThisInitialized(i),Kr);Vr(babelHelpers.assertThisInitialized(i),qr,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),qr,e.condition);return i}babelHelpers.createClass(t,[{key:"renderTo",value:function e(t){this.targetInput=t;this.menuButton=t;this.parseTargetProperties();this.bindTargetEvents()}},{key:"fillGroups",value:function e(){this.fillFieldsGroups()}},{key:"onMenuOpen",value:function e(){this.emit("onOpenMenu",{selector:this,isMixedCondition:Zr(this,Kr,Qr).call(this)})}},{key:"onFieldSelect",value:function e(t){this.emit("change",{field:t})}},{key:"getFields",value:function e(){return this.context.fields.map((function(e){return jr(jr({},e),{},{ObjectId:"Document"})}))}}]);return t}(Rr);function Qr(){return babelHelpers.classPrivateFieldGet(this,qr)&&babelHelpers.classPrivateFieldGet(this,qr).parentGroup&&babelHelpers.classPrivateFieldGet(this,qr).parentGroup.type===c.ConditionGroup.CONDITION_TYPE.Mixed}var $r;function es(e,t){is(e,t);t.add(e)}function ts(e,t,i){is(e,t);t.set(e,i)}function is(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function as(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var rs=new WeakMap;var ss=new WeakMap;var ls=new WeakSet;var ns=new WeakSet;var os=new WeakSet;var cs=new WeakSet;var us=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++){r[s]=arguments[s]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(r)));es(babelHelpers.assertThisInitialized(i),cs);es(babelHelpers.assertThisInitialized(i),os);es(babelHelpers.assertThisInitialized(i),ns);es(babelHelpers.assertThisInitialized(i),ls);ts(babelHelpers.assertThisInitialized(i),rs,{writable:true,value:void 0});ts(babelHelpers.assertThisInitialized(i),ss,{writable:true,value:{OnEditorInitedAfter:as(babelHelpers.assertThisInitialized(i),os,ds).bind(babelHelpers.assertThisInitialized(i))}});return i}babelHelpers.createClass(t,[{key:"destroy",value:function e(){as(this,ns,bs).call(this)}},{key:"renderTo",value:function e(t){this.targetInput=t;babelHelpers.classPrivateFieldSet(this,rs,t.querySelector(".bx-html-editor"));this.menuButton=b.Tag.render($r||($r=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span\n\t\t\t\tonclick="','"\n\t\t\t\tclass="bizproc-automation-popup-select-dotted"\n\t\t\t></span>\n\t\t'])),this.openMenu.bind(this));this.parseTargetProperties();this.bindTargetEvents();t.firstElementChild.appendChild(this.menuButton);as(this,ls,ps).call(this)}},{key:"onFieldSelect",value:function e(t){var i=t.Expression;var a=as(this,cs,vs).call(this);if(a&&a.InsertHtml){if(a.synchro.IsFocusedOnTextarea()){a.textareaView.Focus();a.textareaView.WrapWith("","",i)}else{a.InsertHtml(i)}a.synchro.Sync()}}},{key:"onBeforeSave",value:function e(){var t=as(this,cs,vs).call(this);if(t&&t.SaveContent){t.SaveContent()}}},{key:"onPopupResize",value:function e(){var t=as(this,cs,vs).call(this);if(t&&t.ResizeSceleton){t.ResizeSceleton()}}}]);return t}(Rr);function ps(){for(var e=0,t=Object.entries(babelHelpers.classPrivateFieldGet(this,ss));e<t.length;e++){var i=babelHelpers.slicedToArray(t[e],2),a=i[0],r=i[1];BX.addCustomEvent(a,r)}}function bs(){for(var e=0,t=Object.entries(babelHelpers.classPrivateFieldGet(this,ss));e<t.length;e++){var i=babelHelpers.slicedToArray(t[e],2),a=i[0],r=i[1];BX.removeCustomEvent(a,r)}}function ds(e){if(e.dom.cont!==babelHelpers.classPrivateFieldGet(this,rs)){return false}var t="";var i="";var a=function e(i){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return i.replace(/(^[\s\S]*?)(<body.*?>)/i,(function(e){if(a){t=e}return""}))};var r=function e(t){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return t.replace(/(<\/body>[\s\S]*?$)/i,(function(e){if(a){i=e}return""}))};BX.addCustomEvent(e,"OnParse",(function(e){if(!e){this.content=r(a(this.content,true),true)}}));BX.addCustomEvent(e,"OnAfterParse",(function(e){if(e){var s=r(a(this.content));if(t!==""&&i!==""){s=t+s+i}this.content=s}}))}function vs(){if(babelHelpers.classPrivateFieldGet(this,rs)){var e=babelHelpers.classPrivateFieldGet(this,rs).id.split("-");return BXHtmlEditor.Get(e[e.length-1])}return null}function hs(e,t){gs(e,t);t.add(e)}function fs(e,t,i){gs(e,t);t.set(e,i)}function gs(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function ms(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var ys=new WeakMap;var Ps=new WeakMap;var Ts=new WeakMap;var Hs=new WeakSet;var Is=new WeakSet;var Fs=function(){function e(t){babelHelpers.classCallCheck(this,e);hs(this,Is);hs(this,Hs);fs(this,ys,{writable:true,value:void 0});fs(this,Ps,{writable:true,value:void 0});fs(this,Ts,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,ys,t.context);babelHelpers.classPrivateFieldSet(this,Ps,t.checkbox);babelHelpers.classPrivateFieldSet(this,Ts,t.needSync);if(t.needSync){var i="save_state_checkbox";var a=babelHelpers.classPrivateFieldGet(this,ys).get("userOptions").get(i,ms(this,Hs,Es).call(this),"N");if(a==="Y"){babelHelpers.classPrivateFieldGet(this,Ps).checked=true}}}babelHelpers.createClass(e,[{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ts)){babelHelpers.classPrivateFieldGet(this,ys).get("userOptions").set("save_state_checkboxes",ms(this,Hs,Es).call(this),ms(this,Is,Ss).call(this))}}}]);return e}();function Es(){return babelHelpers.classPrivateFieldGet(this,Ps).getAttribute("data-save-state-key")}function Ss(){return babelHelpers.classPrivateFieldGet(this,Ps).checked?"Y":"N"}var Os=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"renderTo",value:function e(t){this.targetInput=t;this.menuButton=t;this.fieldProperty=JSON.parse(t.getAttribute("data-property"));if(!this.fieldProperty){this.context.useSwitcherMenu=false}var i=this.context.get("additionalUserFields");this.userSelector=BX.Bizproc.UserSelector.decorateNode(t,{additionalFields:b.Type.isArray(i)?i:[]})}},{key:"destroy",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"destroy",this).call(this);if(this.userSelector){this.userSelector.destroy();this.userSelector=null}}}]);return t}(Rr);var ws,ks,Cs,_s,Gs,As,Ns,Ms;function Ds(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=Rs(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function Rs(e,t){if(!e)return;if(typeof e==="string")return Ls(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ls(e,t)}function Ls(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Bs(e,t){zs(e,t);t.add(e)}function xs(e,t,i){zs(e,t);t.set(e,i)}function zs(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Us(e,t,i){Ws(e,t);return i}function Ws(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function js(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Ys=new WeakMap;var Vs=new WeakMap;var Xs=new WeakMap;var Zs=new WeakMap;var qs=new WeakMap;var Ks=new WeakMap;var Js=new WeakMap;var Qs=new WeakMap;var $s=new WeakMap;var el=new WeakMap;var tl=new WeakMap;var il=new WeakMap;var al=new WeakMap;var rl=new WeakMap;var sl=new WeakSet;var ll=new WeakSet;var nl=new WeakSet;var ol=new WeakSet;var cl=new WeakSet;var ul=new WeakSet;var pl=new WeakSet;var bl=new WeakSet;var dl=new WeakSet;var vl=new WeakSet;var hl=new WeakSet;var fl=new WeakSet;var gl=new WeakSet;var ml=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Bs(babelHelpers.assertThisInitialized(i),gl);Bs(babelHelpers.assertThisInitialized(i),fl);Bs(babelHelpers.assertThisInitialized(i),hl);Bs(babelHelpers.assertThisInitialized(i),vl);Bs(babelHelpers.assertThisInitialized(i),dl);Bs(babelHelpers.assertThisInitialized(i),bl);Bs(babelHelpers.assertThisInitialized(i),pl);Bs(babelHelpers.assertThisInitialized(i),ul);Bs(babelHelpers.assertThisInitialized(i),cl);Bs(babelHelpers.assertThisInitialized(i),ol);Bs(babelHelpers.assertThisInitialized(i),nl);Bs(babelHelpers.assertThisInitialized(i),ll);Bs(babelHelpers.assertThisInitialized(i),sl);xs(babelHelpers.assertThisInitialized(i),Ys,{writable:true,value:t.TYPE.None});xs(babelHelpers.assertThisInitialized(i),Vs,{writable:true,value:false});xs(babelHelpers.assertThisInitialized(i),Xs,{writable:true,value:false});xs(babelHelpers.assertThisInitialized(i),Zs,{writable:true,value:""});xs(babelHelpers.assertThisInitialized(i),qs,{writable:true,value:""});xs(babelHelpers.assertThisInitialized(i),Ks,{writable:true,value:false});xs(babelHelpers.assertThisInitialized(i),Js,{writable:true,value:""});xs(babelHelpers.assertThisInitialized(i),Qs,{writable:true,value:""});xs(babelHelpers.assertThisInitialized(i),$s,{writable:true,value:""});xs(babelHelpers.assertThisInitialized(i),el,{writable:true,value:null});xs(babelHelpers.assertThisInitialized(i),tl,{writable:true,value:null});xs(babelHelpers.assertThisInitialized(i),il,{writable:true,value:null});xs(babelHelpers.assertThisInitialized(i),al,{writable:true,value:null});xs(babelHelpers.assertThisInitialized(i),rl,{writable:true,value:void 0});i.context.set("fileFields",i.context.fields.filter((function(e){return e.Type==="file"})));return i}babelHelpers.createClass(t,[{key:"destroy",value:function e(){if(this.menu){this.menu.popupWindow.close()}}},{key:"renderTo",value:function e(t){this.targetInput=t;var i=this.parseTargetProperties();this.targetInput.appendChild(js(this,sl,yl).call(this));js(this,ll,Pl).call(this,i)}},{key:"parseTargetProperties",value:function e(){var i=JSON.parse(this.targetInput.getAttribute("data-config"));if(!b.Type.isPlainObject(i)){i={}}babelHelpers.classPrivateFieldSet(this,Ys,i.type||t.TYPE.File);if(i.selected&&!i.selected.length){babelHelpers.classPrivateFieldSet(this,Ys,t.TYPE.None)}babelHelpers.classPrivateFieldSet(this,Vs,i.multiple||false);babelHelpers.classPrivateFieldSet(this,Xs,i.required||false);babelHelpers.classPrivateFieldSet(this,Zs,i.valueInputName||"");babelHelpers.classPrivateFieldSet(this,qs,i.typeInputName||"");babelHelpers.classPrivateFieldSet(this,Ks,i.useDisk||false);babelHelpers.classPrivateFieldSet(this,Js,i.label||"Attachment");babelHelpers.classPrivateFieldSet(this,Qs,i.labelFile||"File");babelHelpers.classPrivateFieldSet(this,$s,i.labelDisk||"Disk");if(i.selected&&i.selected.length>0){return b.Runtime.clone(i.selected)}}},{key:"addItems",value:function e(i){if(babelHelpers.classPrivateFieldGet(this,Ys)===t.TYPE.File){var a=Ds(i),r;try{for(a.s();!(r=a.n()).done;){var s=r.value;js(this,dl,Ol).call(this,s)}}catch(e){a.e(e)}finally{a.f()}}else{js(this,pl,El).call(this).setValues(Us(t,t,kl).call(t,i))}}},{key:"onFieldSelect",value:function e(i){js(this,dl,Ol).call(this,{id:i.Id,expression:i.Expression,name:i.Name,type:t.TYPE.File})}},{key:"onBeforeSave",value:function e(){var i=[];if(babelHelpers.classPrivateFieldGet(this,Ys)===t.TYPE.Disk){i=js(this,pl,El).call(this).getValues()}else if(babelHelpers.classPrivateFieldGet(this,Ys)===t.TYPE.File){i=Array.from(babelHelpers.classPrivateFieldGet(this,il).childNodes).map((function(e){return e.getAttribute("data-file-expression")})).filter((function(e){return e!==""}))}var a=Ds(i),r;try{for(a.s();!(r=a.n()).done;){var s=r.value;this.targetInput.appendChild(b.Tag.render(ws||(ws=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input\n\t\t\t\t\ttype="hidden"\n\t\t\t\t\tname="','"\n\t\t\t\t\tvalue="','"\n\t\t\t\t/>\n\t\t\t'])),babelHelpers.classPrivateFieldGet(this,Zs)+(babelHelpers.classPrivateFieldGet(this,Vs)?"[]":""),s))}}catch(e){a.e(e)}finally{a.f()}}}]);return t}(Rr);function yl(){var e=c.Helper.generateUniqueId();var t=null;var i=[];if(this.context.get("fileFields").length>0){t=b.Tag.render(ks||(ks=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input\n\t\t\t\t\tid="type-1','"\n\t\t\t\t\tclass="bizproc-automation-popup-select-input"\n\t\t\t\t\ttype="radio"\n\t\t\t\t\tname="','"\n\t\t\t\t\tvalue="','"\n\t\t\t\t\t',"\n\t\t\t\t/>\n\t\t\t"])),e,babelHelpers.classPrivateFieldGet(this,qs),ml.TYPE.File,babelHelpers.classPrivateFieldGet(this,Ys)===ml.TYPE.File?"checked":"")}var a=b.Tag.render(Cs||(Cs=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input\n\t\t\t\tid="type-2','"\n\t\t\t\tclass="bizproc-automation-popup-select-input"\n\t\t\t\ttype="radio"\n\t\t\t\tname="','"\n\t\t\t\tvalue="','"\n\t\t\t\t',"\n\t\t\t/>\n\t\t"])),e,babelHelpers.classPrivateFieldGet(this,qs),ml.TYPE.Disk,babelHelpers.classPrivateFieldGet(this,Ys)===ml.TYPE.Disk?"checked":"");i.push(b.Tag.render(_s||(_s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="bizproc-automation-popup-settings-title">',":</span>\n\t\t"])),babelHelpers.classPrivateFieldGet(this,Js)));if(t){i.push(t,b.Tag.render(Gs||(Gs=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<label\n\t\t\t\t\tclass="bizproc-automation-popup-settings-link"\n\t\t\t\t\tfor="type-1','"\n\t\t\t\t\tonclick="','"\n\t\t\t\t>\n\t\t\t\t',"\n\t\t\t\t</label>\n\t\t\t"])),e,js(this,bl,Sl).bind(this,ml.TYPE.File),babelHelpers.classPrivateFieldGet(this,Qs)))}i.push(a,b.Tag.render(As||(As=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<label\n\t\t\t\tclass="bizproc-automation-popup-settings-link"\n\t\t\t\tfor="type-2','"\n\t\t\t\tonclick="','"\n\t\t\t>\n\t\t\t',"\n\t\t\t</label>\n\t\t"])),e,js(this,bl,Sl).bind(this,ml.TYPE.Disk),babelHelpers.classPrivateFieldGet(this,$s)));return b.Tag.render(Ns||(Ns=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings-block">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),i)}function Pl(e){if(babelHelpers.classPrivateFieldGet(this,Ys)===ml.TYPE.Disk){js(this,ul,Fl).call(this);js(this,nl,Tl).call(this,e)}else if(babelHelpers.classPrivateFieldGet(this,Ys)===ml.TYPE.File){js(this,ol,Hl).call(this);js(this,cl,Il).call(this,e)}else{js(this,ul,Fl).call(this);js(this,ol,Hl).call(this)}}function Tl(e){if(!babelHelpers.classPrivateFieldGet(this,tl)){babelHelpers.classPrivateFieldSet(this,tl,b.Dom.create("div"));this.targetInput.appendChild(babelHelpers.classPrivateFieldGet(this,tl));var t=js(this,pl,El).call(this);t.layout(babelHelpers.classPrivateFieldGet(this,tl));t.show(true);if(e){this.addItems(e)}}else{b.Dom.show(babelHelpers.classPrivateFieldGet(this,tl))}}function Hl(){if(babelHelpers.classPrivateFieldGet(this,tl)){b.Dom.hide(babelHelpers.classPrivateFieldGet(this,tl))}}function Il(e){if(!babelHelpers.classPrivateFieldGet(this,al)){babelHelpers.classPrivateFieldSet(this,il,b.Dom.create("span"));babelHelpers.classPrivateFieldSet(this,al,b.Dom.create("div",{children:[babelHelpers.classPrivateFieldGet(this,il)]}));this.targetInput.appendChild(babelHelpers.classPrivateFieldGet(this,al));var t=b.Dom.create("a",{attrs:{className:"bizproc-automation-popup-settings-link bizproc-automation-popup-settings-link-thin"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ADD")});babelHelpers.classPrivateFieldGet(this,al).appendChild(t);b.Event.bind(t,"click",js(this,fl,_l).bind(this,t));if(e){this.addItems(e)}}else{b.Dom.show(babelHelpers.classPrivateFieldGet(this,al))}}function Fl(){if(babelHelpers.classPrivateFieldGet(this,al)){b.Dom.hide(babelHelpers.classPrivateFieldGet(this,al))}}function El(){if(!babelHelpers.classPrivateFieldGet(this,el)){babelHelpers.classPrivateFieldSet(this,el,BX.Bizproc.Automation.DiskUploader.create("",{msg:{diskAttachFiles:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_ATTACH_FILE"),diskAttachedFiles:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_ATTACHED_FILES"),diskSelectFile:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_SELECT_FILE"),diskSelectFileLegend:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_SELECT_FILE_LEGEND"),diskUploadFile:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_UPLOAD_FILE"),diskUploadFileLegend:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_UPLOAD_FILE_LEGEND")}}));babelHelpers.classPrivateFieldGet(this,el).setMode(1)}return babelHelpers.classPrivateFieldGet(this,el)}function Sl(e){if(babelHelpers.classPrivateFieldGet(this,Ys)!==e){babelHelpers.classPrivateFieldSet(this,Ys,e);js(this,ll,Pl).call(this)}}function Ol(e){if(js(this,vl,wl).call(this,e)){return false}var t=js(this,gl,Gl).call(this,e);if(!babelHelpers.classPrivateFieldGet(this,Vs)){b.Dom.clean(babelHelpers.classPrivateFieldGet(this,il))}babelHelpers.classPrivateFieldGet(this,il).appendChild(t)}function wl(e){return!!babelHelpers.classPrivateFieldGet(this,il).querySelector('[data-file-id="'.concat(e.id,'"]'))}function kl(e){return e.map((function(e){return{ID:e["id"],NAME:e["name"],SIZE:e["size"],VIEW_URL:""}}))}function Cl(e){var t=babelHelpers.classPrivateFieldGet(this,il).querySelector('[data-file-id="'.concat(e.id,'"]'));if(t){babelHelpers.classPrivateFieldGet(this,il).removeChild(t)}}function _l(e,t){var i=this;if(!babelHelpers.classPrivateFieldGet(this,rl)){babelHelpers.classPrivateFieldSet(this,rl,c.Helper.generateUniqueId())}n.MenuManager.show(babelHelpers.classPrivateFieldGet(this,rl),e,this.context.get("fileFields").map((function(e){return{text:b.Text.encode(e.Name),field:e,onclick:function t(a,r){this.popupWindow.close();i.onFieldSelect(e)}}})),{autoHide:true,offsetLeft:b.Dom.getPosition(e)["width"]/2,angle:{position:"top",offset:0}});t.preventDefault()}function Gl(e){var t=this.context.get("fileFields").find((function(t){return t.Expression===e.expression}));var i=(t===null||t===void 0?void 0:t.Name)||"";return b.Tag.render(Ms||(Ms=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span\n\t\t\t\tclass="bizproc-automation-popup-autocomplete-item"\n\t\t\t\tdata-file-id="','"\n\t\t\t\tdata-file-expression="','"\n\t\t\t>\n\t\t\t\t<span class="bizproc-automation-popup-autocomplete-name">','</span>\n\t\t\t\t<span\n\t\t\t\t\tclass="bizproc-automation-popup-autocomplete-delete"\n\t\t\t\t\tonclick="','"\n\t\t\t\t></span>\n\t\t\t</span>\n\t\t'])),e.id,e.expression,i,js(this,hl,Cl).bind(this,e))}babelHelpers.defineProperty(ml,"TYPE",{None:"",Disk:"disk",File:"file"});function Al(e,t){Ml(e,t);t.add(e)}function Nl(e,t,i){Ml(e,t);t.set(e,i)}function Ml(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Dl(e,t,i){Rl(e,t);return i}function Rl(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function Ll(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Bl=new WeakMap;var xl=new WeakSet;var zl=new WeakSet;var Ul=new WeakSet;var Wl=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++){r[s]=arguments[s]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(r)));Al(babelHelpers.assertThisInitialized(i),Ul);Al(babelHelpers.assertThisInitialized(i),zl);Al(babelHelpers.assertThisInitialized(i),xl);Nl(babelHelpers.assertThisInitialized(i),Bl,{writable:true,value:void 0});return i}babelHelpers.createClass(t,[{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Bl)){babelHelpers.classPrivateFieldGet(this,Bl).closeWnd()}}},{key:"renderTo",value:function e(i){var a;this.targetInput=i;var r=new Date;r.setHours(0,0,0,0);r.setTime(r.getTime()+Ll(this,zl,Yl).call(this)*1e3);this.targetInput.value=Dl(a=this.constructor,t,Xl).call(a,r);b.Event.bind(i,"click",this.showClock.bind(this))}},{key:"showClock",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,Bl)){babelHelpers.classPrivateFieldSet(this,Bl,new BX.CClockSelector({start_time:Ll(this,zl,Yl).call(this),node:this.targetInput,callback:Ll(this,xl,jl).bind(this)}))}babelHelpers.classPrivateFieldGet(this,Bl).Show()}}]);return t}(Rr);function jl(e){this.targetInput.value=e;BX.fireEvent(this.targetInput,"change");babelHelpers.classPrivateFieldGet(this,Bl).closeWnd()}function Yl(){return Ll(this,Ul,Vl).call(this,this.targetInput.value)}function Vl(e){var t=e.split(/[\s:]+/).map((function(e){return parseInt(e)}));var i=babelHelpers.slicedToArray(t,2),a=i[0],r=i[1];if(t.length===3){var s=t[2];if(s==="pm"&&a<12){a+=12}else if(s==="am"&&a===12){a=0}}return a*3600+r*60}function Xl(e){var t=function e(t){return BX.date.convertBitrixFormat(b.Loc.getMessage(t)).replace(/:?\s*s/,"")};var i=t("FORMAT_DATE");var a=t("FORMAT_DATETIME").replace(i,"").trim();return BX.date.format(a,e)}var Zl;function ql(e,t){Kl(e,t);t.add(e)}function Kl(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Jl(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Ql=new WeakSet;var $l=new WeakSet;var en=function(){function e(t){babelHelpers.classCallCheck(this,e);ql(this,$l);ql(this,Ql);this.basisFields=[];this.onchange=null;if(b.Type.isPlainObject(t)){this.labelNode=t.labelNode;this.useAfterBasis=t.useAfterBasis;if(b.Type.isArray(t.basisFields)){this.basisFields=t.basisFields}this.onchange=t.onchange;this.minLimitM=t.minLimitM;this.showWaitWorkDay=t.showWaitWorkDay}}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.delay=t;this.setLabelText();this.bindLabelNode();this.prepareBasisFields()}},{key:"setLabelText",value:function e(){if(this.delay&&this.labelNode){this.labelNode.textContent=this.delay.format(b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AT_ONCE"),this.basisFields)}}},{key:"bindLabelNode",value:function e(){if(this.labelNode){b.Event.bind(this.labelNode,"click",BX.delegate(this.onLabelClick,this))}}},{key:"onLabelClick",value:function e(t){this.showDelayIntervalPopup();t.preventDefault()}},{key:"showDelayIntervalPopup",value:function e(){var t=this.delay;var i=ge.generateUniqueId();var a=b.Dom.create("form",{attrs:{className:"bizproc-automation-popup-select-block"}});var r=b.Dom.create("input",{attrs:{className:"bizproc-automation-popup-select-input",id:i+"now",type:"radio",value:"now",name:"type"}});if(t.isNow()){r.setAttribute("checked","checked")}var s=b.Dom.create("label",{attrs:{className:"bizproc-automation-popup-select-wrapper",for:i+"now"},children:[b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:b.Loc.getMessage(this.useAfterBasis?"BIZPROC_AUTOMATION_CMP_BASIS_NOW":"BIZPROC_AUTOMATION_CMP_AT_ONCE_2")})]});var l=b.Dom.create("span",{attrs:{className:"bizproc-automation-status-help bizproc-automation-status-help-right","data-hint":b.Loc.getMessage(this.useAfterBasis?"BIZPROC_AUTOMATION_CMP_DELAY_NOW_HELP_2":"BIZPROC_AUTOMATION_CMP_DELAY_NOW_HELP")}});s.appendChild(l);a.appendChild(b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-select-item"},children:[r,s]}));a.appendChild(this.createAfterControlNode());if(this.basisFields.length>0){a.appendChild(this.createBeforeControlNode());a.appendChild(this.createInControlNode())}var n=b.Dom.create("input",{attrs:{type:"checkbox",id:i+"worktime",name:"worktime",value:"1",style:"vertical-align: middle"},props:{checked:t.workTime}});var o=b.Dom.create("span",{attrs:{className:"bizproc-automation-status-help bizproc-automation-status-help-right","data-hint":b.Loc.getMessage("BIZPROC_AUTOMATION_DELAY_WORK_TIME_HELP")}});a.appendChild(b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-title"},children:[n,b.Dom.create("label",{attrs:{className:"bizproc-automation-popup-settings-lbl",for:i+"worktime"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_DELAY_WORK_TIME_MSGVER_1")}),o]}));if(this.showWaitWorkDay){a.appendChild(Jl(this,Ql,tn).call(this))}var c=this;BX.UI.Hint.init(a);var u=new BX.PopupWindow(ge.generateUniqueId(),this.labelNode,{autoHide:true,closeByEsc:true,closeIcon:false,titleBar:false,angle:true,offsetLeft:20,content:a,buttons:[new BX.PopupWindowButton({text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CHOOSE"),className:"webform-button webform-button-create bizproc-automation-button-left",events:{click:function e(){c.saveFormData(new FormData(a));this.popupWindow.close()}}})],events:{onPopupClose:function e(){if(c.fieldsMenu){c.fieldsMenu.popupWindow.close()}if(c.valueTypeMenu){c.valueTypeMenu.popupWindow.close()}this.destroy()}},overlay:{backgroundColor:"transparent"}});u.show()}},{key:"saveFormData",value:function e(t){var i=t.get("type");if(i==="now"){this.delay.setNow()}else if(i===Pt.DELAY_TYPE.In){this.delay.setType(Pt.DELAY_TYPE.In);this.delay.setValue(0);this.delay.setValueType("i");this.delay.setBasis(t.get("basis_in"));this.delay.setInTime(t.get("basis_in_time")?t.get("basis_in_time").split(":"):null)}else{this.delay.setType(i);this.delay.setValue(t.get("value_"+i));this.delay.setValueType(t.get("value_type_"+i));if(i===Pt.DELAY_TYPE.After){if(this.useAfterBasis){this.delay.setBasis(t.get("basis_after"))}else{this.delay.setBasis(Pt.BASIS_TYPE.CurrentDateTime)}if(this.minLimitM>0&&this.delay.basis===Pt.BASIS_TYPE.CurrentDateTime&&this.delay.valueType==="i"&&this.delay.value<this.minLimitM){BX.UI.Notification.Center.notify({content:b.Loc.getMessage("BIZPROC_AUTOMATION_DELAY_MIN_LIMIT_LABEL")});this.delay.setValue(this.minLimitM)}}else{this.delay.setBasis(t.get("basis_before"))}}this.delay.setWorkTime(t.get("worktime"));this.delay.setWaitWorkDay(t.get("wait_workday"));this.setLabelText();if(this.onchange){this.onchange(this.delay)}}},{key:"createAfterControlNode",value:function e(){var t=this.delay;var i=ge.generateUniqueId();var a=b.Dom.create("input",{attrs:{className:"bizproc-automation-popup-select-input",id:i,type:"radio",value:Pt.DELAY_TYPE.After,name:"type"}});if(t.type===Pt.DELAY_TYPE.After&&t.value>0){a.setAttribute("checked","checked")}var r=b.Dom.create("input",{attrs:{type:"text",name:"value_after",className:"bizproc-automation-popup-settings-input"},props:{value:t.type===Pt.DELAY_TYPE.After&&t.value?t.value:this.minLimitM||5}});var s=b.Dom.create("label",{attrs:{className:"bizproc-automation-popup-select-wrapper",for:i},children:[b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_THROUGH_3")}),r,this.createValueTypeSelector("value_type_after")]});if(this.useAfterBasis){s.appendChild(b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-auto-width"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AFTER")}));var l=this.getBasisField(t.basis,true);var n=t.basis;if(!l){l=this.getBasisField(Pt.BASIS_TYPE.CurrentDateTime,true);n=l.SystemExpression}var o=b.Dom.create("input",{attrs:{type:"hidden",name:"basis_after",value:n}});var c=this;var u=b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis"},text:l?l.Name:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD"),events:{click:function e(t){c.onBasisClick(t,this,(function(e){u.textContent=e.Name;o.value=e.SystemExpression}),Pt.DELAY_TYPE.After)}}});s.appendChild(o);s.appendChild(u)}if(!this.useAfterBasis){var p=b.Dom.create("span",{attrs:{className:"bizproc-automation-status-help bizproc-automation-status-help-right","data-hint":b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DELAY_AFTER_HELP")}});s.appendChild(p)}return b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-select-item"},children:[a,s]})}},{key:"createBeforeControlNode",value:function e(){var t=this.delay;var i=ge.generateUniqueId();var a=b.Dom.create("input",{attrs:{className:"bizproc-automation-popup-select-input",id:i,type:"radio",value:Pt.DELAY_TYPE.Before,name:"type"}});if(t.type===Pt.DELAY_TYPE.Before){a.setAttribute("checked","checked")}var r=b.Dom.create("input",{attrs:{type:"text",name:"value_before",className:"bizproc-automation-popup-settings-input"},props:{value:t.type===Pt.DELAY_TYPE.Before&&t.value?t.value:this.minLimitM||5}});var s=b.Dom.create("label",{attrs:{className:"bizproc-automation-popup-select-wrapper",for:i},children:[b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_FOR_TIME_3")}),r,this.createValueTypeSelector("value_type_before"),b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-auto-width"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BEFORE_1")})]});var l=this.getBasisField(t.basis);var n=t.basis;if(!l){l=this.basisFields[0];n=l.SystemExpression}var o=b.Dom.create("input",{attrs:{type:"hidden",name:"basis_before",value:n}});var c=this;var u=b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis"},text:l?l.Name:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD"),events:{click:function e(t){c.onBasisClick(t,this,(function(e){u.textContent=e.Name;o.value=e.SystemExpression}),Pt.DELAY_TYPE.Before)}}});s.appendChild(o);s.appendChild(u);if(!this.useAfterBasis){var p=b.Dom.create("span",{attrs:{className:"bizproc-automation-status-help bizproc-automation-status-help-right","data-hint":b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DELAY_BEFORE_HELP")}});s.appendChild(p)}return b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-select-item"},children:[a,s]})}},{key:"createInControlNode",value:function e(){var t=this.delay;var i=ge.generateUniqueId();var a=b.Dom.create("input",{attrs:{className:"bizproc-automation-popup-select-input",id:i,type:"radio",value:Pt.DELAY_TYPE.In,name:"type"}});if(t.type===Pt.DELAY_TYPE.In){a.setAttribute("checked","checked")}var r=b.Dom.create("label",{attrs:{className:"bizproc-automation-popup-select-wrapper",for:i},children:[b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_IN_TIME_2")})]});var s=this.getBasisField(t.basis,true);var l=t.basis;if(!s){s=this.basisFields[0];l=s.SystemExpression}var n=b.Dom.create("input",{attrs:{type:"hidden",name:"basis_in",value:l}});var o=this;var c=b.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis"},text:s?s.Name:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD"),events:{click:function e(t){o.onBasisClick(t,this,(function(e){c.textContent=e.Name;n.value=e.SystemExpression}),Pt.DELAY_TYPE.In)}}});r.appendChild(n);r.appendChild(c);if(!this.useAfterBasis){var u=b.Dom.create("span",{attrs:{className:"bizproc-automation-status-help bizproc-automation-status-help-right","data-hint":b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DELAY_IN_HELP")}});r.appendChild(u)}var p=b.Tag.render(Zl||(Zl=babelHelpers.taggedTemplateLiteral(['\n\t\t\t <span>\n\t\t\t \tTime: <input type="time" value="','" name="basis_in_time"/>\n\t\t\t</span>\n\t\t'])),t.inTimeString);return b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-select-item"},children:[a,r]})}},{key:"createValueTypeSelector",value:function e(t){var i=this.delay;var a={i:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_M"),h:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_H"),d:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_D")};var r=b.Dom.create("label",{attrs:{className:"bizproc-automation-popup-settings-link"},text:a[i.valueType]});var s=b.Dom.create("input",{attrs:{type:"hidden",name:t},props:{value:i.valueType}});b.Event.bind(r,"click",this.onValueTypeSelectorClick.bind(this,r,s));return b.Dom.create("span",{children:[r,s]})}},{key:"onValueTypeSelectorClick",value:function e(t,i){var a=ge.generateUniqueId();var r=function e(a,r){this.popupWindow.close();i.value=r.valueId;t.textContent=r.text};var s=[{text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_M"),valueId:"i",onclick:r},{text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_H"),valueId:"h",onclick:r},{text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_D"),valueId:"d",onclick:r}];n.MenuManager.show(a,t,s,{autoHide:true,offsetLeft:25,angle:{position:"top"},events:{onPopupClose:function e(){this.destroy()}},overlay:{backgroundColor:"transparent"}});this.valueTypeMenu=n.MenuManager.currentItem}},{key:"onBasisClick",value:function e(t,i,a,r){var s=[];if(r===Pt.DELAY_TYPE.After||r===Pt.DELAY_TYPE.In){s.push({text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_NOW"),field:{Name:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_NOW"),SystemExpression:Pt.BASIS_TYPE.CurrentDateTime},onclick:function e(t,i){if(a){a(i.field)}this.popupWindow.close()}},{text:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_DATE"),field:{Name:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_DATE"),SystemExpression:Pt.BASIS_TYPE.CurrentDate},onclick:function e(t,i){if(a){a(i.field)}this.popupWindow.close()}},{delimiter:true})}for(var l=0;l<this.basisFields.length;++l){if(r!==Pt.DELAY_TYPE.After&&this.basisFields[l]["Id"].indexOf("DATE_CREATE")>-1){continue}s.push({text:b.Text.encode(this.basisFields[l].Name),field:this.basisFields[l],onclick:function e(t,i){if(a){a(i.field||i.options.field)}this.popupWindow.close()}})}var o=i.getAttribute("data-menu-id");if(!o){o=ge.generateUniqueId();i.setAttribute("data-menu-id",o)}n.MenuManager.show(o,i,s,{autoHide:true,offsetLeft:BX.pos(i)["width"]/2,angle:{position:"top",offset:0},overlay:{backgroundColor:"transparent"}});this.fieldsMenu=n.MenuManager.currentItem}},{key:"getBasisField",value:function e(t,i){if(i&&(t===Pt.BASIS_TYPE.CurrentDateTime||t===Pt.BASIS_TYPE.CurrentDateTimeLocal)){return{Name:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_NOW"),SystemExpression:Pt.BASIS_TYPE.CurrentDateTime}}if(i&&t===Pt.BASIS_TYPE.CurrentDate){return{Name:b.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_DATE"),SystemExpression:Pt.BASIS_TYPE.CurrentDate}}var a=null;for(var r=0;r<this.basisFields.length;++r){if(t===this.basisFields[r].SystemExpression){a=this.basisFields[r]}}return a}},{key:"prepareBasisFields",value:function e(){var t=[];for(var i=0;i<this.basisFields.length;++i){var a=this.basisFields[i];if(a["Id"].indexOf("DATE_MODIFY")<0&&a["Id"].indexOf("EVENT_DATE")<0&&a["Id"].indexOf("BIRTHDATE")<0){t.push(a)}}this.basisFields=t}}]);return e}();function tn(){var e=this.delay;var t=ge.generateUniqueId();var i=Jl(this,$l,an).call(this);var a=b.Dom.create("input",{attrs:{type:"checkbox",id:t+"wait_workday",name:"wait_workday",value:"1",style:"vertical-align: middle"},props:{checked:e.waitWorkDay&&i}});if(!i){a.disabled=true}var r=b.Dom.create("span",{attrs:{className:"bizproc-automation-status-help bizproc-automation-status-help-right","data-hint":b.Loc.getMessage("BIZPROC_AUTOMATION_DELAY_WAIT_WORK_DAY_HELP")}});var s={};if(!i){s.click=function(){if(top.BX.UI&&top.BX.UI.InfoHelper){top.BX.UI.InfoHelper.show("limit_office_worktime_responsible")}}}return b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-select-item"},children:[b.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-title"},children:[a,b.Dom.create("label",{attrs:{className:"bizproc-automation-popup-settings-lbl ".concat(!i?"bizproc-automation-robot-btn-set-locked":""),for:t+"wait_workday"},text:b.Loc.getMessage("BIZPROC_AUTOMATION_DELAY_WAIT_WORK_DAY_MSGVER_1")}),r]})],events:s})}function an(){var e;return(e=Po().get("IS_WORKTIME_AVAILABLE"))!==null&&e!==void 0?e:false}var rn=function(e){babelHelpers.inherits(t,e);function t(e){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e))}babelHelpers.createClass(t,[{key:"fields",get:function e(){var t=this.get("fields");return b.Type.isArray(t)?t:[]}},{key:"useSwitcherMenu",get:function e(){return b.Type.isBoolean(this.get("useSwitcherMenu"))?this.get("useSwitcherMenu"):false},set:function e(t){this.set("useSwitcherMenu",t)}},{key:"rootGroupTitle",get:function e(){var t;return(t=this.get("rootGroupTitle"))!==null&&t!==void 0?t:""}}]);return t}(M);function sn(e,t){nn(e,t);t.add(e)}function ln(e,t,i){nn(e,t);t.set(e,i)}function nn(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function on(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var cn=new WeakMap;var un=new WeakMap;var pn=new WeakSet;var bn=new WeakSet;var dn=new WeakSet;var vn=new WeakSet;var hn=new WeakSet;var fn=new WeakSet;var gn=new WeakSet;var mn=function(){function e(t){var i=this;babelHelpers.classCallCheck(this,e);sn(this,gn);sn(this,fn);sn(this,hn);sn(this,vn);sn(this,dn);sn(this,bn);sn(this,pn);ln(this,cn,{writable:true,value:[]});ln(this,un,{writable:true,value:[]});if(b.Type.isArrayFilled(t.variables)){var a=[];t.variables.forEach((function(e){a.push(on(i,bn,Pn).call(i,e.Id,e,o.Globals.Manager.Instance.mode.variable))}));babelHelpers.classPrivateFieldSet(this,cn,a)}if(b.Type.isArrayFilled(t.constants)){var r=[];t.constants.forEach((function(e){r.push(on(i,bn,Pn).call(i,e.Id,e,o.Globals.Manager.Instance.mode.constant))}));babelHelpers.classPrivateFieldSet(this,un,r)}}babelHelpers.createClass(e,[{key:"updateGlobals",value:function e(t,i){var a=this;if(!on(this,pn,yn).call(this,t)||Object.keys(i).length<1){return}var r=on(this,fn,Fn).call(this,t);var s=[];var l=function e(l){var n=i[l];var o=r.findIndex((function(e){return e.Id===l}));if(o>-1){if(r[o].Name!==n.Name){r[o].Name=n.Name;r[o].Expression=on(a,dn,Tn).call(a,n.Name,n.VisibilityName)}return"continue"}s.push(on(a,bn,Pn).call(a,l,n,t))};for(var n in i){var o=l(n);if(o==="continue")continue}if(b.Type.isArrayFilled(s)){r=r.concat(s)}on(this,gn,En).call(this,t,r)}},{key:"deleteGlobals",value:function e(t,i){if(!on(this,pn,yn).call(this,t)||!b.Type.isArrayFilled(i)){return}var a=on(this,fn,Fn).call(this,t);i.forEach((function(e){var t=a.findIndex((function(t){return t.Id===e}));if(t>-1){a.splice(t,1)}}));on(this,gn,En).call(this,t,a)}},{key:"globalVariables",get:function e(){return babelHelpers.classPrivateFieldGet(this,cn)},set:function e(t){if(!b.Type.isArray(t)){return}babelHelpers.classPrivateFieldSet(this,cn,t)}},{key:"globalConstants",get:function e(){return babelHelpers.classPrivateFieldGet(this,un)},set:function e(t){if(!b.Type.isArray(t)){return}babelHelpers.classPrivateFieldSet(this,un,t)}}]);return e}();function yn(e){return b.Type.isStringFilled(e)&&Object.values(o.Globals.Manager.Instance.mode).includes(e)}function Pn(e,t,i){return{ObjectId:on(this,hn,In).call(this,i),SuperTitle:String(t.VisibilityName),Id:String(e),Name:String(t.Name),Type:String(t.Type),BaseType:String(t.BaseType||t.Type),Expression:b.Type.isStringFilled(t.Expression)?t.Expression:on(this,dn,Tn).call(this,t.Name,t.VisibilityName),SystemExpression:b.Type.isStringFilled(t.SystemExpression)?t.SystemExpression:on(this,vn,Hn).call(this,i,e),Options:t.Options,Multiple:b.Type.isBoolean(t.Multiple)?t.Multiple:t.Multiple==="Y",Visibility:String(t.Visibility)}}function Tn(e,t){return"{{"+String(t)+": "+String(e)+"}}"}function Hn(e,t){return"{="+on(this,hn,In).call(this,e)+":"+String(t)+"}"}function In(e){return e===o.Globals.Manager.Instance.mode.variable?"GlobalVar":"GlobalConst"}function Fn(e){if(e===o.Globals.Manager.Instance.mode.variable){return this.globalVariables}if(e===o.Globals.Manager.Instance.mode.constant){return this.globalConstants}}function En(e,t){if(e===o.Globals.Manager.Instance.mode.variable){babelHelpers.classPrivateFieldSet(this,cn,t)}if(e===o.Globals.Manager.Instance.mode.constant){babelHelpers.classPrivateFieldSet(this,un,t)}}function Sn(e,t){wn(e,t);t.add(e)}function On(e,t,i){wn(e,t);t.set(e,i)}function wn(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function kn(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Cn=new WeakMap;var _n=new WeakMap;var Gn=new WeakMap;var An=new WeakSet;var Nn=new WeakSet;var Mn=new WeakSet;var Dn=function(){function e(t){babelHelpers.classCallCheck(this,e);Sn(this,Mn);Sn(this,Nn);Sn(this,An);On(this,Cn,{writable:true,value:[]});On(this,_n,{writable:true,value:-1});On(this,Gn,{writable:true,value:"#d4d6da"});var i=t.querySelector(".bizproc-automation-status-list");if(i){babelHelpers.classPrivateFieldSet(this,Cn,i.querySelectorAll('[data-role="automation-status-title"]'))}}babelHelpers.createClass(e,[{key:"init",value:function e(t){var i=c.getGlobalContext();if(i.document.getId()<=0){babelHelpers.classPrivateFieldSet(this,_n,babelHelpers.classPrivateFieldGet(this,Cn).length-1)}else{babelHelpers.classPrivateFieldSet(this,_n,t.findIndex((function(e){return e.getStatusId()===i.document.getCurrentStatusId()})))}}},{key:"fixColors",value:function e(){kn(this,An,Rn).call(this);kn(this,Nn,Ln).call(this)}}]);return e}();function Rn(){var e=this;babelHelpers.classPrivateFieldGet(this,Cn).forEach((function(t,i){var a=t.querySelector(".bizproc-automation__status--bg");if(a){var r=kn(e,Mn,Bn).call(e,i)&&t.dataset.bgcolor?t.dataset.bgcolor:babelHelpers.classPrivateFieldGet(e,Gn);b.Dom.style(a,{backgroundColor:r,borderColor:r})}}))}function Ln(){var e=this;babelHelpers.classPrivateFieldGet(this,Cn).forEach((function(t,i){if(!kn(e,Mn,Bn).call(e,i)){return}var a=t.dataset.bgcolor;if(a){var r=parseInt(a,16);var s=r>>16&255;var l=r>>8&255;var n=r&255;var o=.21*s+.72*l+.07*n<145;if(o){b.Dom.style(t,"color","white")}}}))}function Bn(e){return e<=babelHelpers.classPrivateFieldGet(this,_n)}function xn(e,t,i){zn(e,t);t.set(e,i)}function zn(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Un=new WeakMap;var Wn=function(){function e(t){babelHelpers.classCallCheck(this,e);xn(this,Un,{writable:true,value:void 0});if(!b.Type.isElementNode(t.target)){throw"options.target must be Node Element"}var i=b.Type.isStringFilled(t.text)?t.text:b.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_BEGINNING_SUBTITLE_1");var a=b.Type.isStringFilled(t.article)?b.Text.toInteger(t.article):"";babelHelpers.classPrivateFieldSet(this,Un,new d.Guide({steps:[{target:t.target,title:b.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_BEGINNING_TITLE"),text:i,article:a,condition:{top:true,bottom:false,color:"primary"},position:"bottom"}],onEvents:true}));babelHelpers.classPrivateFieldGet(this,Un).getPopup().setAutoHide(true)}babelHelpers.createClass(e,[{key:"start",value:function e(){babelHelpers.classPrivateFieldGet(this,Un).showNextStep()}}]);return e}();function jn(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=Yn(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function Yn(e,t){if(!e)return;if(typeof e==="string")return Vn(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Vn(e,t)}function Vn(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Xn(e,t){qn(e,t);t.add(e)}function Zn(e,t,i){qn(e,t);t.set(e,i)}function qn(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Kn(e,t,i){Jn(e,t);return i}function Jn(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function Qn(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var $n=new WeakMap;var eo=new WeakMap;var to=new WeakMap;var io=new WeakMap;var ao=new WeakMap;var ro=new WeakMap;var so=new WeakMap;var lo=new WeakSet;var no=new WeakSet;var oo=new WeakSet;var co=new WeakSet;var uo=new WeakSet;var po=function(){function e(t){babelHelpers.classCallCheck(this,e);Xn(this,uo);Xn(this,co);Xn(this,oo);Xn(this,no);Xn(this,lo);Zn(this,$n,{writable:true,value:true});Zn(this,eo,{writable:true,value:true});Zn(this,to,{writable:true,value:false});Zn(this,io,{writable:true,value:false});Zn(this,ao,{writable:true,value:false});Zn(this,ro,{writable:true,value:false});Zn(this,so,{writable:true,value:{}});if(b.Type.isBoolean(t.isShownRobotGuide)){babelHelpers.classPrivateFieldSet(this,$n,t.isShownRobotGuide)}if(b.Type.isBoolean(t.isShownTriggerGuide)){babelHelpers.classPrivateFieldSet(this,eo,t.isShownTriggerGuide)}}babelHelpers.createClass(e,[{key:"setShowRobotGuide",value:function e(t,i){babelHelpers.classPrivateFieldSet(this,io,t);if(t){babelHelpers.classPrivateFieldGet(this,so)["robot"]=i!==null&&i!==void 0?i:null}}},{key:"setShowTriggerGuide",value:function e(t,i){babelHelpers.classPrivateFieldSet(this,ao,t);if(t){babelHelpers.classPrivateFieldGet(this,so)["trigger"]=i!==null&&i!==void 0?i:null}}},{key:"setShowSupportingRobotGuide",value:function e(t,i){babelHelpers.classPrivateFieldSet(this,ro,t);if(t){babelHelpers.classPrivateFieldGet(this,so)["supportingRobot"]=i!==null&&i!==void 0?i:null}}},{key:"start",value:function e(){Qn(this,lo,bo).call(this);var t=Qn(this,no,vo).call(this);if(t){var i=t.getCurrentStep().target;if(b.Type.isDomNode(i)&&document.body.contains(i)){t.showNextStep()}}}},{key:"isShownRobotGuide",get:function e(){return babelHelpers.classPrivateFieldGet(this,$n)}},{key:"isShownTriggerGuide",get:function e(){return babelHelpers.classPrivateFieldGet(this,eo)}}]);return e}();function bo(){if(babelHelpers.classPrivateFieldGet(this,eo)){babelHelpers.classPrivateFieldSet(this,ao,false)}if(babelHelpers.classPrivateFieldGet(this,to)){babelHelpers.classPrivateFieldSet(this,ro,false);babelHelpers.classPrivateFieldSet(this,$n,true)}if(babelHelpers.classPrivateFieldGet(this,$n)){babelHelpers.classPrivateFieldSet(this,io,false)}if(babelHelpers.classPrivateFieldGet(this,ro)){babelHelpers.classPrivateFieldSet(this,$n,true)}}function vo(){var e=null;if(babelHelpers.classPrivateFieldGet(this,ro)){if(b.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,so)["supportingRobot"])){e=Qn(this,uo,go).call(this);e.getPopup().setAutoHide(true)}return e}if(babelHelpers.classPrivateFieldGet(this,ao)){if(b.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,so)["trigger"])){e=Qn(this,co,fo).call(this);e.getPopup().setAutoHide(true)}return e}if(babelHelpers.classPrivateFieldGet(this,io)){if(b.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,so)["robot"])){e=Qn(this,oo,ho).call(this);e.getPopup().setAutoHide(true)}return e}return e}function ho(){var e=this;var t;return new d.Guide({steps:[{target:babelHelpers.classPrivateFieldGet(this,so)["robot"],title:b.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_TITLE_1"),text:Kn(t=this.constructor,po,mo).call(t,[b.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_SUBTITLE_1"),b.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_SUBTITLE_2")]),article:"16547618",condition:{top:false,bottom:true,color:"primary"},position:"top",events:{onShow:function t(){babelHelpers.classPrivateFieldSet(e,$n,true)}}}],onEvents:true})}function fo(){var e=this;var t;return new d.Guide({steps:[{target:babelHelpers.classPrivateFieldGet(this,so)["trigger"],title:b.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_TITLE_1"),text:Kn(t=this.constructor,po,mo).call(t,[b.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_SUBTITLE_1"),b.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_SUBTITLE_2")]),article:"16547632",condition:{top:false,bottom:true,color:"primary"},position:"top",events:{onShow:function t(){babelHelpers.classPrivateFieldSet(e,eo,true)}}}],onEvents:true})}function go(){var e=this;var t;return new d.Guide({steps:[{target:babelHelpers.classPrivateFieldGet(this,so)["supportingRobot"],title:b.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_TITLE"),text:Kn(t=this.constructor,po,mo).call(t,[b.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_SUBTITLE_1"),b.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_SUBTITLE_2")]),article:"16547644",condition:{top:false,bottom:true,color:"primary"},position:"top",events:{onShow:function t(){babelHelpers.classPrivateFieldSet(e,to,true)}}}],onEvents:true})}function mo(e){var t='<ul class="bizproc-automation-tour-guide-list">';var i=jn(e),a;try{for(i.s();!(a=i.n()).done;){var r=a.value;t+='<li class="bizproc-automation-tour-guide-list-item"> '.concat(b.Text.encode(r)," </li>")}}catch(e){i.e(e)}finally{i.f()}t+="</ul>";return t}var yo;function Po(){if(yo instanceof D){return yo}throw new Error("Context is not initialized yet")}function To(){try{return Po()}catch(e){return null}}function Ho(e){if(e instanceof D){yo=e}else{throw new Error("Unsupported Context")}return e}e.TemplatesScheme=C;e.Context=D;e.getGlobalContext=Po;e.tryGetGlobalContext=To;e.setGlobalContext=Ho;e.TemplateScope=y;e.TriggerManager=Xe;e.Trigger=ne;e.Template=Xi;e.Robot=hi;e.UserOptions=yi;e.Document=ut;e.ViewMode=Y;e.ConditionGroup=pa;e.ConditionGroupSelector=qa;e.Condition=sa;e.Designer=Ee;e.SelectorManager=Ka;e.InlineSelector=Rr;e.InlineSelectorCondition=Jr;e.InlineSelectorHtml=us;e.SaveStateCheckbox=Fs;e.UserSelector=Os;e.FileSelector=ml;e.TimeSelector=Wl;e.DelayInterval=Pt;e.DelayIntervalSelector=en;e.HelpHint=Tt;e.SelectorContext=rn;e.AutomationGlobals=mn;e.Statuses=Dn;e.Helper=ge;e.BeginningGuide=Wn;e.AutomationGuide=po;e.RobotEntry=Mt;e.TriggerEntry=Dt;e.TrackingEntryBuilder=zt;e.TrackingEntry=Ot;e.TrackingStatus=wt;e.Tracker=Jt;e.WorkflowStatus=Ht})(this.BX.Bizproc.Automation=this.BX.Bizproc.Automation||{},BX.UI,BX,BX.Bizproc,BX.Event,BX.UI.EntitySelector,BX.Main,BX.Main,BX.Bizproc,BX.Bizproc.Automation,BX,BX,BX,BX.UI.Tour);
//# sourceMappingURL=automation.bundle.map.js