{"version":3,"file":"automation.bundle.js","sources":["../src/template-scope.js","../src/templates-scheme.js","../src/context/base-context.js","../src/context/context.js","../src/view-mode.js","../src/trigger.js","../src/helper.js","../src/designer.js","../src/trigger-manager.js","../src/document/document.js","../src/delay-interval.js","../src/help-hint.js","../src/workflow/types.js","../src/tracker/tracking-entry.js","../src/tracker/types.js","../src/tracker/robot-entry.js","../src/tracker/trigger-entry.js","../src/tracker/tracking-entry-builder.js","../src/tracker/tracker.js","../src/robot.js","../src/user-options.js","../src/template.js","../src/condition/condition.js","../src/condition/condition-group.js","../src/selectors/condition-selector.js","../src/selectors/condition-group-selector.js","../src/selectors/manager.js","../src/selectors/inline-time-selector.js","../src/selectors/inline-selector.js","../src/selectors/inline-selector-condition.js","../src/selectors/inline-selector-html.js","../src/selectors/save-state-checkbox.js","../src/selectors/user-selector.js","../src/selectors/file-selector.js","../src/selectors/time-selector.js","../src/delay-interval-selector.js","../src/context/selector-context.js","../src/automation-globals.js","../src/statuses.js","../src/tourguide/beginning-guide.js","../src/tourguide/automation-guide.js","../src/automation.js"],"sourcesContent":["import { Type } from 'main.core';\nimport { DocumentType, DocumentCategory, DocumentStatus } from './document/types';\n\nexport class TemplateScope\n{\n\t#documentType: DocumentType;\n\t#category: DocumentCategory | null;\n\t#status: DocumentStatus;\n\n\tconstructor(rawTemplateScope: {\n\t\tDocumentType: {\n\t\t\tType: string,\n\t\t\tName: string,\n\t\t},\n\t\tCategory: {\n\t\t\tId: string | null,\n\t\t\tName: string | null,\n\t\t},\n\t\tStatus: {\n\t\t\tId: string,\n\t\t\tName: string,\n\t\t\tColor: string,\n\t\t}\n\t})\n\t{\n\t\tthis.#documentType = rawTemplateScope.DocumentType;\n\t\tthis.#category = !Type.isNil(rawTemplateScope.Category.Id) ? rawTemplateScope.Category : null;\n\t\tthis.#status = rawTemplateScope.Status;\n\t}\n\n\tgetId()\n\t{\n\t\tif (this.hasCategory())\n\t\t{\n\t\t\treturn `${this.#documentType.Type}_${this.#category.Id}_${this.#status.Id}`;\n\t\t}\n\n\t\treturn `${this.#documentType.Type}_${this.#status.Id}`;\n\t}\n\n\tgetDocumentType(): DocumentType\n\t{\n\t\treturn this.#documentType;\n\t}\n\n\tgetDocumentCategory(): DocumentCategory\n\t{\n\t\treturn this.#category;\n\t}\n\n\tgetDocumentStatus(): DocumentStatus\n\t{\n\t\treturn this.#status;\n\t}\n\n\thasCategory(): boolean\n\t{\n\t\treturn !Type.isNull(this.#category);\n\t}\n}","import {Type} from 'main.core';\nimport {DocumentType, DocumentCategory, DocumentStatus} from './document/types';\nimport {TemplateScope} from './template-scope';\n\nexport default class TemplatesScheme\n{\n\t#scheme: Array<TemplateScope>;\n\n\tconstructor(scheme: Array<TemplateScope>)\n\t{\n\t\tthis.#scheme = [];\n\n\t\tif (Type.isArray(scheme))\n\t\t{\n\t\t\tscheme.forEach(rawScope => {\n\t\t\t\tconst scope = new TemplateScope(rawScope);\n\t\t\t\tthis.#scheme.push(scope);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetDocumentTypes(): Array<DocumentType>\n\t{\n\t\tconst documentTypes = new Map();\n\n\t\tfor (const scope of this.#scheme)\n\t\t{\n\t\t\tdocumentTypes.set(scope.getDocumentType().Type, scope.getDocumentType());\n\t\t}\n\n\t\treturn Array.from(documentTypes.values());\n\t}\n\n\tgetTypeCategories(documentType: DocumentType): Array<DocumentCategory>\n\t{\n\t\tconst documentCategories = new Map();\n\n\t\tfor (const scope of this.#scheme)\n\t\t{\n\t\t\tif (scope.hasCategory() && scope.getDocumentType().Type === documentType.Type)\n\t\t\t{\n\t\t\t\tconst category = scope.getDocumentCategory();\n\t\t\t\tdocumentCategories.set(category.Id, category);\n\t\t\t}\n\t\t}\n\n\t\treturn Array.from(documentCategories.values());\n\t}\n\n\tgetTypeStatuses(documentType: DocumentType, documentCategory: DocumentCategory | null): Array<DocumentStatus>\n\t{\n\t\tconst takenStatuses = new Set();\n\t\tif (Type.isNil(documentCategory))\n\t\t{\n\t\t\tdocumentCategory = {Id: null};\n\t\t}\n\n\t\tconst predicate = scope => {\n\t\t\tconst shouldBeTaken = (\n\t\t\t\tscope.getDocumentType().Type === documentType.Type\n\t\t\t\t&& (scope.hasCategory() ? scope.getDocumentCategory().Id === documentCategory.Id : true)\n\t\t\t\t&& !takenStatuses.has(scope.getDocumentStatus().Id)\n\t\t\t);\n\n\t\t\tif (shouldBeTaken)\n\t\t\t{\n\t\t\t\ttakenStatuses.add(scope.getDocumentStatus().Id);\n\t\t\t}\n\n\t\t\treturn shouldBeTaken;\n\t\t};\n\n\t\treturn Array.from(this.#filterBy(predicate)).map(scope => scope.getDocumentStatus());\n\t}\n\n\t#filterBy(predicate: (TemplateScope) => boolean): Iterable<TemplateScope>\n\t{\n\t\tconst generator = function*(scheme)\n\t\t{\n\t\t\tfor (const scope of scheme)\n\t\t\t{\n\t\t\t\tif (predicate(scope))\n\t\t\t\t{\n\t\t\t\t\tyield scope;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn generator(this.#scheme);\n\t}\n}","import { Type, clone } from \"main.core\";\nimport { EventEmitter, BaseEvent } from \"main.core.events\";\n\nexport class BaseContext extends EventEmitter\n{\n\t#values: Object<string, any>;\n\n\tconstructor(defaultValue: Object<string, any>)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Bizproc.Automation.Context');\n\t\tif (Type.isPlainObject(defaultValue))\n\t\t{\n\t\t\tthis.#values = defaultValue;\n\t\t}\n\t}\n\n\tclone(): this\n\t{\n\t\treturn new BaseContext(clone(this.#values));\n\t}\n\n\tgetValues(): object\n\t{\n\t\treturn this.#values;\n\t}\n\n\tset(name: string, value: any): this\n\t{\n\t\tconst isValueChanged = this.has(name);\n\t\tthis.#values[name] = value;\n\t\tthis.emit(isValueChanged ? 'valueChanged' : 'valueAdded', {name, value})\n\n\t\treturn this;\n\t}\n\n\tget(name: string): any\n\t{\n\t\treturn this.#values[name];\n\t}\n\n\thas(name: string): boolean\n\t{\n\t\treturn this.#values.hasOwnProperty(name);\n\t}\n\n\tsubsribeValueChanges(name: string, listener: (BaseEvent) => void): this\n\t{\n\t\tthis.subscribe('valueChanged', (event) => {\n\t\t\tif (event.data.name === name)\n\t\t\t{\n\t\t\t\tlistener(event);\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n}","import { Type, Runtime } from \"main.core\";\nimport { BaseContext } from \"./base-context\";\nimport {Document, UserOptions, Tracker, AutomationGlobals} from \"bizproc.automation\";\nexport class Context extends BaseContext\n{\n\tconstructor(props: {\n\t\tdocument: Document,\n\t\tsignedDocument: string,\n\t\tajaxUrl: string,\n\t\tavailableRobots?: Array<Object>,\n\t\tavailableTriggers?: Array<Object>,\n\t\tcanManage?: boolean,\n\t\tcanEdit?: boolean,\n\t\tuserOptions?: UserOptions,\n\t\ttracker?: Tracker,\n\n\t\tbizprocEditorUrl?: string,\n\t\tconstantsEditorUrl?: string,\n\t\tparametersEditorUrl?: string,\n\n\t\tmarketplaceRobotCategory?: string,\n\t})\n\t{\n\t\tsuper(props);\n\t}\n\n\tclone(): this\n\t{\n\t\t// TODO - clone Tracker object when the corresponding method appears\n\t\treturn (new Context(Runtime.clone(this.getValues())))\n\t\t\t.set('document', this.document.clone())\n\t\t\t.set('userOptions', this.userOptions?.clone())\n\t\t;\n\t}\n\n\tget document(): ?Document\n\t{\n\t\treturn this.get('document');\n\t}\n\n\tget signedDocument(): string\n\t{\n\t\treturn this.get('signedDocument') ?? '';\n\t}\n\n\tget ajaxUrl(): string\n\t{\n\t\treturn this.get('ajaxUrl') ?? '';\n\t}\n\n\tget availableRobots(): Array<Object>\n\t{\n\t\tconst availableRobots = this.get('availableRobots');\n\t\tif (Type.isArray(availableRobots))\n\t\t{\n\t\t\treturn availableRobots;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tget availableTriggers(): Array<Object>\n\t{\n\t\tconst availableTriggers = this.get('availableTriggers');\n\t\tif (Type.isArray(availableTriggers))\n\t\t{\n\t\t\treturn availableTriggers;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tget canManage(): boolean\n\t{\n\t\tconst canManage = this.get('canManage');\n\n\t\treturn Type.isBoolean(canManage) && canManage;\n\t}\n\n\tget canEdit(): boolean\n\t{\n\t\tconst canEdit = this.get('canEdit');\n\n\t\treturn Type.isBoolean(canEdit) && canEdit;\n\t}\n\n\tget userOptions(): ?UserOptions\n\t{\n\t\treturn this.get('userOptions');\n\t}\n\n\tget tracker(): ?Tracker\n\t{\n\t\treturn this.get('tracker');\n\t}\n\n\tset tracker(tracker: Tracker)\n\t{\n\t\tthis.set('tracker', tracker);\n\t}\n\n\tget bizprocEditorUrl(): ?string\n\t{\n\t\treturn this.get('bizprocEditorUrl');\n\t}\n\n\tget constantsEditorUrl(): ?string\n\t{\n\t\treturn this.get('constantsEditorUrl');\n\t}\n\n\tget parametersEditorUrl(): ?string\n\t{\n\t\treturn this.get('parametersEditorUrl');\n\t}\n\n\tgetAvailableTrigger(code: string): ?Object\n\t{\n\t\treturn this.availableTriggers.find(trigger => trigger['CODE'] === code);\n\t}\n\n\tget automationGlobals(): ?AutomationGlobals\n\t{\n\t\treturn this.get('automationGlobals');\n\t}\n}\n","export class ViewMode\n{\n\t#mode: number;\n\t#properties: Object;\n\n\tstatic #none = 0;\n\tstatic #view = 1;\n\tstatic #edit = 2;\n\tstatic #manage = 3;\n\n\tconstructor(mode: number)\n\t{\n\t\tthis.#mode = mode;\n\t\tthis.#properties = {};\n\t}\n\n\tstatic none(): ViewMode\n\t{\n\t\treturn new ViewMode(ViewMode.#none)\n\t}\n\n\tisNone(): boolean\n\t{\n\t\treturn this.#mode === ViewMode.#none;\n\t}\n\n\tstatic view(): ViewMode\n\t{\n\t\treturn new ViewMode(ViewMode.#view);\n\t}\n\n\tisView(): boolean\n\t{\n\t\treturn this.#mode === ViewMode.#view;\n\t}\n\n\tstatic edit(): ViewMode\n\t{\n\t\treturn new ViewMode(ViewMode.#edit);\n\t}\n\n\tisEdit(): boolean\n\t{\n\t\treturn this.#mode === ViewMode.#edit;\n\t}\n\n\tstatic manage(): ViewMode\n\t{\n\t\treturn new ViewMode(ViewMode.#manage);\n\t}\n\n\tisManage(): boolean\n\t{\n\t\treturn this.#mode === ViewMode.#manage;\n\t}\n\n\tsetProperty(name: string, value: any): ViewMode\n\t{\n\t\tthis.#properties[name] = value;\n\n\t\treturn this;\n\t}\n\n\tgetProperty(name: string, defaultValue: any = null): ?any\n\t{\n\t\tif (this.#properties.hasOwnProperty(name))\n\t\t{\n\t\t\treturn this.#properties[name];\n\t\t}\n\n\t\treturn defaultValue;\n\t}\n\n\tstatic fromRaw(mode: number): ViewMode\n\t{\n\t\tif (ViewMode.getAll().includes(mode))\n\t\t{\n\t\t\treturn new ViewMode(mode);\n\t\t}\n\n\t\treturn ViewMode.none();\n\t}\n\n\tintoRaw(): number\n\t{\n\t\treturn this.#mode;\n\t}\n\n\tstatic getAll(): Array<number>\n\t{\n\t\treturn [\n\t\t\tthis.#none,\n\t\t\tthis.#view,\n\t\t\tthis.#edit,\n\t\t\tthis.#manage,\n\t\t];\n\t}\n}\n","import { clone, Type, Dom, Loc, Event } from \"main.core\";\nimport { EventEmitter } from \"main.core.events\";\nimport { ViewMode } from \"./view-mode\";\nimport { getGlobalContext, ConditionGroup, TrackingStatus, HelpHint } from \"bizproc.automation\";\n\nexport class Trigger extends EventEmitter\n{\n\tdraft: boolean;\n\n\t#data: Object<string, any>;\n\t#deleted: boolean;\n\t#viewMode: ViewMode;\n\t#condition: ConditionGroup;\n\t#node: ?HTMLDivElement;\n\t#draggableItem: ?HTMLElement;\n\t#droppableItem: ?HTMLElement;\n\t#droppableColumn: ?HTMLElement;\n\t#stub: ?HTMLElement;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Automation');\n\n\t\tthis.draft = false;\n\t\tthis.#data = {};\n\t\tthis.#deleted = false;\n\t\tthis.#viewMode = ViewMode.none();\n\t\tthis.#condition = new ConditionGroup();\n\t}\n\n\tget node(): HTMLDivElement\n\t{\n\t\treturn this.#node;\n\t}\n\n\tget deleted(): boolean\n\t{\n\t\treturn this.#deleted;\n\t}\n\n\tget documentStatus(): string\n\t{\n\t\treturn this.#data['DOCUMENT_STATUS'] ?? '';\n\t}\n\n\tinit(data: Object<string, any>, viewMode: ?ViewMode): void\n\t{\n\t\tthis.#data = clone(data);\n\n\t\tif (!Type.isPlainObject(this.#data['APPLY_RULES']))\n\t\t{\n\t\t\tthis.#data['APPLY_RULES'] = {};\n\t\t}\n\n\t\tif (this.#data['APPLY_RULES'].Condition)\n\t\t{\n\t\t\tthis.#condition = new ConditionGroup(this.#data['APPLY_RULES'].Condition);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#condition = new ConditionGroup();\n\t\t}\n\n\t\tthis.#viewMode = Type.isNil(viewMode) ? ViewMode.edit() : viewMode;\n\t\tthis.#node = this.createNode();\n\t}\n\n\treInit(data: Object<string, any>, viewMode: ?ViewMode)\n\t{\n\t\tconst node = this.#node;\n\t\tthis.#node = this.createNode();\n\t\tif (node.parentNode)\n\t\t{\n\t\t\tnode.parentNode.replaceChild(this.#node, node);\n\t\t}\n\t}\n\n\tcanEdit()\n\t{\n\t\treturn getGlobalContext().canEdit;\n\t}\n\n\tgetId(): number\n\t{\n\t\treturn this.#data['ID'] || 0;\n\t}\n\n\tgetStatusId(): string\n\t{\n\t\treturn String(this.#data['DOCUMENT_STATUS'] || '');\n\t}\n\n\tgetStatus(): ?object\n\t{\n\t\treturn getGlobalContext().document.statusList.find(status => String(status.STATUS_ID) === this.getStatusId());\n\t}\n\n\tgetCode(): string\n\t{\n\t\treturn this.#data['CODE'] ?? '';\n\t}\n\n\tgetName(): string\n\t{\n\t\tlet triggerName = this.#data['NAME'];\n\t\tif (!triggerName)\n\t\t{\n\t\t\tconst code = this.getCode();\n\t\t\tconst trigger = getGlobalContext().availableTriggers.find((trigger) => code === trigger['CODE']);\n\t\t\ttriggerName = trigger?.NAME ?? code;\n\t\t}\n\n\t\treturn triggerName;\n\t}\n\n\tsetName(name: string): this\n\t{\n\t\tif (Type.isString(name))\n\t\t{\n\t\t\tthis.#data['NAME'] = name;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetApplyRules()\n\t{\n\t\treturn this.#data['APPLY_RULES'];\n\t}\n\n\tsetApplyRules(rules: Object): this\n\t{\n\t\tthis.#data['APPLY_RULES'] = rules;\n\n\t\treturn this;\n\t}\n\n\tgetLogStatus()\n\t{\n\t\tconst log = getGlobalContext().tracker.getTriggerLog(this.getId());\n\t\treturn log ? log.status : null;\n\t}\n\n\tgetCondition(): ConditionGroup\n\t{\n\t\treturn this.#condition;\n\t}\n\n\tsetCondition(condition: ConditionGroup): this\n\t{\n\t\tthis.#condition = condition;\n\t\treturn this;\n\t}\n\n\tisBackwardsAllowed(): boolean\n\t{\n\t\treturn this.#data['APPLY_RULES']['ALLOW_BACKWARDS'] === 'Y';\n\t}\n\n\tsetAllowBackwards(flag: boolean): this\n\t{\n\t\tthis.#data['APPLY_RULES']['ALLOW_BACKWARDS'] = flag ? 'Y' : 'N';\n\n\t\treturn this;\n\t}\n\n\tgetExecuteBy(): string\n\t{\n\t\treturn this.#data['APPLY_RULES']['ExecuteBy'] || '';\n\t}\n\n\tsetExecuteBy(userId: number): this\n\t{\n\t\tthis.#data['APPLY_RULES']['ExecuteBy'] = userId;\n\n\t\treturn this;\n\t}\n\n\tcreateNode()\n\t{\n\t\tlet wrapperClass = 'bizproc-automation-trigger-item-wrapper';\n\n\t\tif (this.#viewMode.isEdit() && this.canEdit())\n\t\t{\n\t\t\twrapperClass += ' bizproc-automation-trigger-item-wrapper-draggable';\n\t\t}\n\n\t\tlet settingsBtn = null;\n\t\tlet copyBtn = null;\n\t\tif (this.#viewMode.isEdit())\n\t\t{\n\t\t\tsettingsBtn = Dom.create(\"div\", {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: \"bizproc-automation-trigger-item-wrapper-edit\"\n\t\t\t\t},\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_EDIT')\n\t\t\t});\n\n\t\t\tcopyBtn = Dom.create('div', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'bizproc-automation-trigger-btn-copy'\n\t\t\t\t},\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_COPY') || 'copy'\n\t\t\t});\n\n\t\t\tEvent.bind(copyBtn, 'click', this.onCopyButtonClick.bind(this, copyBtn));\n\t\t}\n\n\t\tif (this.getLogStatus() === TrackingStatus.COMPLETED)\n\t\t{\n\t\t\twrapperClass += ' bizproc-automation-trigger-item-wrapper-complete';\n\t\t}\n\t\telse if (getGlobalContext().document.getPreviousStatusIdList().includes(this.getStatusId()))\n\t\t{\n\t\t\twrapperClass += ' bizproc-automation-trigger-item-wrapper-complete-light';\n\t\t}\n\n\t\tconst triggerName = this.getName();\n\n\t\tlet containerClass = 'bizproc-automation-trigger-item';\n\n\t\tif (this.getLogStatus() === TrackingStatus.COMPLETED)\n\t\t{\n\t\t\tcontainerClass += ' --complete';\n\t\t}\n\t\telse if (this.draft)\n\t\t{\n\t\t\tcontainerClass += ' --draft';\n\t\t}\n\n\t\tconst div = Dom.create('DIV', {\n\t\t\tattrs: {\n\t\t\t\t'data-role': 'trigger-container',\n\t\t\t\t'className': containerClass,\n\t\t\t\t'data-type': 'item-trigger'\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: wrapperClass\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\tclassName: \"bizproc-automation-trigger-item-wrapper-text\",\n\t\t\t\t\t\t\t\ttitle: triggerName,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: triggerName\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tcopyBtn,\n\t\t\t\tsettingsBtn\n\t\t\t]\n\t\t});\n\n\t\tif (!this.#viewMode.isEdit())\n\t\t{\n\t\t\treturn div;\n\t\t}\n\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.registerItem(div);\n\t\t}\n\n\t\tconst deleteBtn = Dom.create('SPAN', {\n\t\t\tattrs: {\n\t\t\t\t'data-role': 'btn-delete-trigger',\n\t\t\t\t'className': 'bizproc-automation-trigger-btn-delete',\n\t\t\t}\n\t\t});\n\n\t\tEvent.bind(deleteBtn, 'click', this.onDeleteButtonClick.bind(this, deleteBtn));\n\n\t\tdiv.appendChild(deleteBtn);\n\n\t\tif (this.#viewMode.isEdit())\n\t\t{\n\t\t\tEvent.bind(div, 'click', this.onSettingsButtonClick.bind(this, div));\n\t\t}\n\n\t\treturn div;\n\t}\n\n\tonSettingsButtonClick(button)\n\t{\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\t\t}\n\t\telse if (!this.#viewMode.isManage())\n\t\t{\n\t\t\tthis.emit('Trigger:onSettingsOpen', {trigger: this});\n\t\t}\n\t}\n\n\tonCopyButtonClick(button: HTMLElement, event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\t\t}\n\t\telse if (!this.#viewMode.isManage())\n\t\t{\n\t\t\tconst trigger = new Trigger();\n\t\t\tconst initData = this.serialize();\n\t\t\tdelete initData['ID'];\n\n\t\t\tconst clearRules = this.getSettingProperties()\n\t\t\t\t.filter((property) => property.Copyable === false)\n\t\t\t\t.map((property) => property.Id)\n\t\t\t;\n\n\t\t\tclearRules.forEach(key => delete initData['APPLY_RULES'][key]);\n\n\t\t\ttrigger.init(initData, this.#viewMode);\n\t\t\tthis.emit('Trigger:copied', {trigger});\n\t\t}\n\t}\n\tonSearch(event)\n\t{\n\t\tif (!this.#node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst query = event.getData().queryString;\n\t\tconst match = !query || this.getName().toLowerCase().indexOf(query) >= 0;\n\n\t\tDom[match ? 'removeClass' : 'addClass'](this.#node, '--search-mismatch');\n\t}\n\n\tregisterItem(object)\n\t{\n\t\tif (Type.isNil(object[\"__bxddid\"]))\n\t\t{\n\t\t\tobject.onbxdragstart = BX.proxy(this.dragStart, this);\n\t\t\tobject.onbxdrag = BX.proxy(this.dragMove, this);\n\t\t\tobject.onbxdragstop = BX.proxy(this.dragStop, this);\n\t\t\tobject.onbxdraghover = BX.proxy(this.dragOver, this);\n\t\t\tjsDD.registerObject(object);\n\t\t\tjsDD.registerDest(object, 1);\n\t\t}\n\t}\n\n\tunregisterItem(object)\n\t{\n\t\tobject.onbxdragstart = undefined;\n\t\tobject.onbxdrag = undefined;\n\t\tobject.onbxdragstop = undefined;\n\t\tobject.onbxdraghover = undefined;\n\t\tjsDD.unregisterObject(object);\n\t\tjsDD.unregisterDest(object);\n\t}\n\n\tdragStart()\n\t{\n\t\tthis.#draggableItem = BX.proxy_context;\n\n\t\tif (!this.#draggableItem)\n\t\t{\n\t\t\tjsDD.stopCurrentDrag();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#stub)\n\t\t{\n\t\t\tconst itemWidth = this.#draggableItem.offsetWidth;\n\t\t\tthis.#stub = this.#draggableItem.cloneNode(true);\n\t\t\tthis.#stub.style.position = \"absolute\";\n\t\t\tthis.#stub.classList.add(\"bizproc-automation-trigger-item-drag\");\n\t\t\tthis.#stub.style.width = itemWidth + \"px\";\n\t\t\tdocument.body.appendChild(this.#stub);\n\t\t}\n\t}\n\n\tdragMove(x, y)\n\t{\n\t\tthis.#stub.style.left = x + \"px\";\n\t\tthis.#stub.style.top = y + \"px\";\n\t}\n\n\tdragOver(destination, x, y)\n\t{\n\t\tif (this.#droppableItem)\n\t\t{\n\t\t\tthis.#droppableItem.classList.remove(\"bizproc-automation-trigger-item-pre\");\n\t\t}\n\n\t\tif (this.#droppableColumn)\n\t\t{\n\t\t\tthis.#droppableColumn.classList.remove(\"bizproc-automation-trigger-list-pre\");\n\t\t}\n\n\t\tconst type = destination.getAttribute(\"data-type\");\n\n\t\tif (type === \"item-trigger\")\n\t\t{\n\t\t\tthis.#droppableItem = destination;\n\t\t\tthis.#droppableColumn = null;\n\t\t}\n\n\t\tif (type === \"column-trigger\")\n\t\t{\n\t\t\tthis.#droppableColumn = destination.querySelector('[data-role=\"trigger-list\"]');\n\t\t\tthis.#droppableItem = null;\n\t\t}\n\n\t\tif (this.#droppableItem)\n\t\t{\n\t\t\tthis.#droppableItem.classList.add(\"bizproc-automation-trigger-item-pre\");\n\t\t}\n\n\t\tif (this.#droppableColumn)\n\t\t{\n\t\t\tthis.#droppableColumn.classList.add(\"bizproc-automation-trigger-list-pre\");\n\t\t}\n\t}\n\n\tdragStop(x, y, event)\n\t{\n\t\tevent = event || window.event;\n\t\tlet trigger = null;\n\t\tconst isCopy = event && (event.ctrlKey || event.metaKey);\n\t\tconst copyTrigger = (parent, statusId) => {\n\t\t\tconst trigger = new Trigger();\n\t\t\tconst initData = parent.serialize();\n\t\t\tdelete initData['ID'];\n\n\t\t\tconst clearRules = this.getSettingProperties()\n\t\t\t\t.filter((property) => property.Copyable === false)\n\t\t\t\t.map((property) => property.Id)\n\t\t\t;\n\n\t\t\tclearRules.forEach(key => delete initData['APPLY_RULES'][key]);\n\n\t\t\tinitData['DOCUMENT_STATUS'] = statusId;\n\t\t\ttrigger.init(initData, parent.#viewMode);\n\n\t\t\treturn trigger;\n\t\t};\n\n\t\tif (this.#draggableItem)\n\t\t{\n\t\t\tif (this.#droppableItem)\n\t\t\t{\n\t\t\t\tthis.#droppableItem.classList.remove(\"bizproc-automation-trigger-item-pre\");\n\t\t\t\tconst thisColumn = this.#droppableItem.parentNode;\n\t\t\t\tif (!isCopy)\n\t\t\t\t{\n\t\t\t\t\tthisColumn.insertBefore(this.#draggableItem, this.#droppableItem);\n\t\t\t\t\tthis.moveTo(thisColumn.getAttribute('data-status-id'));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttrigger = copyTrigger(this, thisColumn.getAttribute('data-status-id'));\n\t\t\t\t\tthisColumn.insertBefore(trigger.#node, this.#droppableItem);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.#droppableColumn)\n\t\t\t{\n\t\t\t\tthis.#droppableColumn.classList.remove(\"bizproc-automation-trigger-list-pre\");\n\t\t\t\tif (!isCopy)\n\t\t\t\t{\n\t\t\t\t\tthis.#droppableColumn.appendChild(this.#draggableItem);\n\t\t\t\t\tthis.moveTo(this.#droppableColumn.getAttribute('data-status-id'));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttrigger = copyTrigger(this, this.#droppableColumn.getAttribute('data-status-id'));\n\t\t\t\t\tthis.#droppableColumn.appendChild(trigger.#node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (trigger)\n\t\t\t{\n\t\t\t\tthis.emit('Trigger:copied', {\n\t\t\t\t\ttrigger,\n\t\t\t\t\tskipInsert: true,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.#stub.parentNode.removeChild(this.#stub);\n\t\tthis.#stub = null;\n\t\tthis.#draggableItem = null;\n\t\tthis.#droppableItem = null;\n\t}\n\n\tonDeleteButtonClick(button: HTMLElement, event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\t\t}\n\t\telse if (!this.#viewMode.isManage())\n\t\t{\n\t\t\tDom.remove(button.parentNode);\n\t\t\tthis.emit('Trigger:deleted', {trigger: this});\n\t\t}\n\t}\n\n\tupdateData(data: Object<string, any>): void\n\t{\n\t\tif (Type.isPlainObject(data))\n\t\t{\n\t\t\tthis.#data = data;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow 'Invalid data';\n\t\t}\n\t}\n\n\tmarkDeleted(): this\n\t{\n\t\tthis.#deleted = true;\n\n\t\treturn this;\n\t}\n\n\tserialize(): Object<string, any>\n\t{\n\t\tconst data = clone(this.#data);\n\t\tif (this.#deleted)\n\t\t{\n\t\t\tdata['DELETED'] = 'Y';\n\t\t}\n\n\t\tif (!Type.isPlainObject(data.APPLY_RULES))\n\t\t{\n\t\t\tdata.APPLY_RULES = {};\n\t\t}\n\n\t\tif (!this.#condition.items.length)\n\t\t{\n\t\t\tdelete data.APPLY_RULES.Condition;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.APPLY_RULES.Condition = this.#condition.serialize();\n\t\t}\n\n\t\treturn data;\n\t}\n\n\tmoveTo(statusId)\n\t{\n\t\tthis.#data['DOCUMENT_STATUS'] = statusId;\n\t\tthis.emit('Trigger:modified', {trigger: this});\n\t}\n\n\tgetReturnProperties()\n\t{\n\t\tconst triggerData = getGlobalContext().availableTriggers.find(trigger => trigger['CODE'] === this.getCode());\n\n\t\treturn triggerData && Type.isArray(triggerData.RETURN) ? triggerData.RETURN : [];\n\t}\n\n\tgetSettingProperties(): Array\n\t{\n\t\tconst triggerData = getGlobalContext().availableTriggers.find(trigger => trigger['CODE'] === this.getCode());\n\n\t\tif (triggerData.SETTINGS && triggerData.SETTINGS.Properties)\n\t\t{\n\t\t\treturn triggerData.SETTINGS.Properties;\n\t\t}\n\n\t\treturn [];\n\t}\n}","import { Type } from \"main.core\";\n\nexport class Helper\n{\n\tstatic #idIncrement = 0;\n\n\tstatic generateUniqueId()\n\t{\n\t\t++Helper.#idIncrement;\n\t\treturn 'bizproc-automation-cmp-' + Helper.#idIncrement;\n\t}\n\n\tstatic toJsonString(data)\n\t{\n\t\treturn JSON.stringify(data, function (i, v)\n\t\t{\n\t\t\tif (typeof(v) == 'boolean')\n\t\t\t{\n\t\t\t\treturn v ? '1' : '0';\n\t\t\t}\n\t\t\treturn v;\n\t\t});\n\t}\n\n\tstatic getResponsibleUserExpression(fields: Array<Object>): ?string\n\t{\n\t\tif (Type.isArray(fields))\n\t\t{\n\t\t\tfor (const field of fields)\n\t\t\t{\n\t\t\t\tif (field['Id'] === 'ASSIGNED_BY_ID' || field['Id'] === 'RESPONSIBLE_ID')\n\t\t\t\t{\n\t\t\t\t\treturn '{{'+field['Name']+'}}';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t};\n}","export class Designer\n{\n\tstatic #instance;\n\n\trobotSettingsDialog;\n\tcomponent;\n\trobot;\n\ttriggerSettingsDialog;\n\n\tstatic getInstance()\n\t{\n\t\tif (!Designer.#instance)\n\t\t{\n\t\t\tDesigner.#instance = new Designer();\n\t\t}\n\n\t\treturn Designer.#instance;\n\t}\n\n\tsetRobotSettingsDialog(dialog)\n\t{\n\t\tthis.robotSettingsDialog = dialog;\n\t\tthis.robot = dialog ? dialog.robot : null;\n\t}\n\n\tgetRobotSettingsDialog()\n\t{\n\t\treturn this.robotSettingsDialog;\n\t}\n\n\tsetTriggerSettingsDialog(dialog)\n\t{\n\t\tthis.triggerSettingsDialog = dialog;\n\t}\n\n\tgetTriggerSettingsDialog()\n\t{\n\t\treturn this.triggerSettingsDialog;\n\t}\n}","import { Type, Event, Loc, Dom, Text, Uri, ajax } from \"main.core\";\nimport { EventEmitter } from \"main.core.events\";\nimport { ViewMode } from \"./view-mode\";\nimport { Trigger } from \"./trigger\";\nimport { Helper } from \"./helper\";\nimport { Designer } from \"./designer\";\nimport { getGlobalContext, ConditionGroup, ConditionGroupSelector } from \"bizproc.automation\";\nimport { Alert, AlertColor, AlertIcon } from \"ui.alerts\";\n\nexport class TriggerManager extends EventEmitter\n{\n\t#triggersContainerNode: HTMLElement;\n\t#viewMode: ViewMode;\n\t#triggers: Array<Trigger>;\n\t#triggersData: Array<Object<string, any>>;\n\t#columnNodes: NodeList;\n\t#listNodes: NodeList;\n\t#modified: boolean;\n\n\tconstructor(triggersContainerNode: HTMLElement)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Automation');\n\n\t\tthis.#triggersContainerNode = triggersContainerNode;\n\t}\n\n\tinit(data: ?Object<string, any>, viewMode: ViewMode)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tthis.#viewMode = viewMode.isNone() ? ViewMode.edit() : viewMode;\n\t\tthis.#triggersData = Type.isArray(data.TRIGGERS) ? data.TRIGGERS : [];\n\t\tthis.#columnNodes = document.querySelectorAll('[data-type=\"column-trigger\"]');\n\t\tthis.#listNodes = this.#triggersContainerNode.querySelectorAll('[data-role=\"trigger-list\"]');\n\t\tthis.#modified = false;\n\t\tthis.initTriggers();\n\n\t\tthis.markModified(false);\n\n\t\t//register DD\n\t\tthis.#columnNodes.forEach(columnNode => jsDD.registerDest(columnNode, 10));\n\n\t\ttop.BX.addCustomEvent(\n\t\t\ttop,\n\t\t\t'Rest:AppLayout:ApplicationInstall',\n\t\t\tthis.onRestAppInstall.bind(this)\n\t\t);\n\t}\n\n\treInit(data: ?Object<string, any>, viewMode: ?ViewMode)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tthis.#viewMode = viewMode || ViewMode.none();\n\t\tthis.#listNodes.forEach(node => Dom.clean(node));\n\n\t\tthis.#triggersData = Type.isArray(data.TRIGGERS) ? data.TRIGGERS : [];\n\n\t\tthis.initTriggers();\n\n\t\tthis.markModified(false);\n\t}\n\n\tinitTriggers()\n\t{\n\t\tthis.#triggers = [];\n\t\tthis.#triggersData.forEach((triggerData) => {\n\t\t\tconst trigger = new Trigger();\n\t\t\ttrigger.init(triggerData, this.#viewMode);\n\t\t\tthis.subscribeTriggerEvents(trigger);\n\t\t\tthis.insertTriggerNode(trigger.getStatusId(), trigger.node);\n\t\t\tthis.#triggers.push(trigger);\n\t\t});\n\t}\n\n\tsubscribeTriggerEvents(trigger: Trigger)\n\t{\n\t\ttrigger.subscribe('Trigger:copied', (event) => {\n\t\t\tconst trigger = event.data.trigger;\n\n\t\t\tthis.#triggers.push(trigger);\n\t\t\tif (!event.data.skipInsert)\n\t\t\t{\n\t\t\t\tthis.insertTriggerNode(trigger.getStatusId(), trigger.node);\n\t\t\t}\n\t\t\tthis.subscribeTriggerEvents(trigger);\n\t\t\tthis.markModified();\n\t\t});\n\t\ttrigger.subscribe('Trigger:modified', () => this.markModified());\n\t\ttrigger.subscribe('Trigger:onSettingsOpen', (event) => {\n\t\t\tthis.openTriggerSettingsDialog(event.data.trigger);\n\t\t});\n\t\ttrigger.subscribe('Trigger:deleted', (event) => this.deleteTrigger(event.data.trigger));\n\n\t}\n\n\tonSearch(event)\n\t{\n\t\tthis.#triggers.forEach(trigger => trigger.onSearch(event));\n\t}\n\n\tenableManageMode()\n\t{\n\t\tthis.#viewMode = ViewMode.manage();\n\t\tconst deleteButtons = document.querySelectorAll('[data-role=\"btn-delete-trigger\"]');\n\t\tdeleteButtons.forEach(node => Dom.hide(node));\n\n\t\tthis.#triggers.forEach(trigger => Dom.addClass(trigger.node, '--locked-node'));\n\t}\n\n\tdisableManageMode()\n\t{\n\t\tthis.#viewMode = ViewMode.edit();\n\t\tconst deleteButtons = document.querySelectorAll('[data-role=\"btn-delete-trigger\"]');\n\t\tdeleteButtons.forEach(node => Dom.show(node));\n\n\t\tthis.#triggers.forEach(trigger => Dom.removeClass(trigger.node, '--locked-node'));\n\t}\n\n\taddTrigger(triggerData: ?Object<string, any>, callback)\n\t{\n\t\tconst trigger = new Trigger();\n\t\ttrigger.draft = true;\n\t\ttrigger.init(triggerData, this.#viewMode);\n\t\tthis.subscribeTriggerEvents(trigger);\n\t\tif (callback)\n\t\t{\n\t\t\tcallback.call(this, trigger);\n\t\t}\n\t\tthis.emit('TriggerManager:trigger:add', {trigger});\n\t}\n\n\tdeleteTrigger(trigger: Trigger, callback)\n\t{\n\t\tif (trigger.getId() > 0)\n\t\t{\n\t\t\ttrigger.markDeleted();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor(let i = 0; i < this.#triggers.length; ++i)\n\t\t\t{\n\t\t\t\tif (this.#triggers[i] === trigger)\n\t\t\t\t{\n\t\t\t\t\tthis.#triggers.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (callback)\n\t\t{\n\t\t\tcallback(trigger);\n\t\t}\n\n\t\tthis.emit('TriggerManager:trigger:delete', { trigger });\n\n\t\tthis.markModified();\n\t}\n\n\tenableDragAndDrop()\n\t{\n\t\tthis.#triggers.forEach(trigger => trigger.registerItem(trigger.node));\n\t\tthis.#triggersContainerNode.querySelectorAll('.bizproc-automation-trigger-item-wrapper').forEach((node) => {\n\t\t\tDom.addClass(node, 'bizproc-automation-trigger-item-wrapper-draggable');\n\t\t});\n\t}\n\n\tdisableDragAndDrop()\n\t{\n\t\tthis.#triggers.forEach(trigger => trigger.unregisterItem(trigger.node));\n\t\tthis.#triggersContainerNode.querySelectorAll('.bizproc-automation-trigger-item-wrapper').forEach((node) => {\n\t\t\tDom.removeClass(node, 'bizproc-automation-trigger-item-wrapper-draggable');\n\t\t});\n\t}\n\n\tinsertTrigger(trigger)\n\t{\n\t\tthis.#triggers.push(trigger);\n\t\tthis.markModified(true);\n\t}\n\n\tinsertTriggerNode(documentStatus: string, triggerNode)\n\t{\n\t\tconst listNode = this.#triggersContainerNode.querySelector('[data-role=\"trigger-list\"][data-status-id=\"'+documentStatus+'\"]');\n\t\tif (listNode)\n\t\t{\n\t\t\tDom.append(triggerNode, listNode);\n\t\t}\n\t}\n\n\tserialize(): Array<Object<string, any>>\n\t{\n\t\treturn this.#triggers.map(trigger => trigger.serialize());\n\t}\n\n\tcountAllTriggers(): number\n\t{\n\t\treturn this.#triggers.filter(trigger => !trigger.deleted).length;\n\t}\n\n\tgetTriggerName(code: string)\n\t{\n\t\treturn getGlobalContext().availableTriggers.find((trigger) => code === trigger['CODE'])?.NAME ?? code;\n\t}\n\n\tgetAvailableTrigger(code): ?Object\n\t{\n\t\tconst availableTriggers = getGlobalContext().availableTriggers;\n\t\tfor (let i = 0; i < availableTriggers.length; ++i)\n\t\t{\n\t\t\tif (code === availableTriggers[i]['CODE'])\n\t\t\t{\n\t\t\t\treturn availableTriggers[i];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn getGlobalContext().canEdit;\n\t}\n\n\tcanSetExecuteBy(): boolean\n\t{\n\t\treturn getGlobalContext().get('TRIGGER_CAN_SET_EXECUTE_BY') ?? false;\n\t}\n\n\tneedSave()\n\t{\n\t\treturn this.#modified;\n\t}\n\n\tmarkModified(modified: boolean)\n\t{\n\t\tthis.#modified = modified !== false;\n\t\tif (this.#modified)\n\t\t{\n\t\t\tthis.emit('TriggerManager:dataModified');\n\t\t}\n\t}\n\n\topenTriggerSettingsDialog(trigger, context)\n\t{\n\t\tif (Designer.getInstance().getTriggerSettingsDialog())\n\t\t{\n\t\t\tif (context && context.changeTrigger)\n\t\t\t{\n\t\t\t\tDesigner.getInstance().getTriggerSettingsDialog().popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst formName = 'bizproc_automation_trigger_dialog';\n\t\tconst form = Dom.create('form', {\n\t\t\tprops: {\n\t\t\t\tname: formName\n\t\t\t},\n\t\t\tstyle: {\"min-width\": '540px'}\n\t\t});\n\n\t\tDom.append(this.renderConditionSettings(trigger), form);\n\n\t\tconst iconHelp = Dom.create('div', {\n\t\t\tattrs: { className: 'bizproc-automation-robot-help' },\n\t\t\tevents: {click: (event) => this.emit('TriggerManager:onHelpClick', event)}\n\t\t});\n\t\tDom.append(iconHelp, form);\n\n\t\tconst title = this.getTriggerName(trigger.getCode());\n\n\t\tDom.append(Dom.create(\"span\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete\" },\n\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_TRIGGER_NAME') + ':'\n\t\t}), form);\n\n\t\tDom.append(Dom.create(\"div\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings\" },\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"input\", {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'bizproc-automation-popup-input',\n\t\t\t\t\t\ttype: \"text\",\n\t\t\t\t\t\tname: \"name\",\n\t\t\t\t\t\tvalue: trigger.getName() || title\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t}), form);\n\n\t\tconst triggerData = this.getAvailableTrigger(trigger.getCode());\n\n\t\tif (triggerData && triggerData['SETTINGS'])\n\t\t{\n\t\t\tthis.#renderTriggerProperties(trigger, triggerData['SETTINGS']['Properties'], form);\n\t\t}\n\n\t\tBX.onCustomEvent(\n\t\t\t'BX.Bizproc.Automation.TriggerManager:onOpenSettingsDialog-' + trigger.getCode(),\n\t\t\t[trigger, form]\n\t\t);\n\n\t\tif (this.canSetExecuteBy())\n\t\t{\n\t\t\tthis.renderExecuteByControl(trigger, form);\n\t\t}\n\n\t\tthis.renderAllowBackwardsControl(trigger, form);\n\n\t\tDom.addClass(this.#triggersContainerNode, 'automation-base-blocked');\n\n\t\tDesigner.getInstance().setTriggerSettingsDialog({\n\t\t\ttriggerManager: this,\n\t\t\ttrigger: trigger,\n\t\t\tform: form\n\t\t});\n\n\t\tconst self = this;\n\t\tconst popup = new BX.PopupWindow(Helper.generateUniqueId(), null, {\n\t\t\ttitleBar: title,\n\t\t\tcontent: form,\n\t\t\tcloseIcon: true,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: true,\n\t\t\tdraggable: {restrict: false},\n\t\t\toverlay: false,\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function(popup)\n\t\t\t\t{\n\t\t\t\t\tDesigner.getInstance().setTriggerSettingsDialog(null);\n\t\t\t\t\tself.destroySettingsDialogControls();\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t\tDom.removeClass(self.#triggersContainerNode, 'automation-base-blocked');\n\t\t\t\t\tself.emit('TriggerManager:onCloseTriggerSettingsDialog')\n\t\t\t\t}\n\t\t\t},\n\t\t\tbuttons: [\n\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\ttext : Loc.getMessage('JS_CORE_WINDOW_SAVE'),\n\t\t\t\t\tclassName : \"popup-window-button-accept\",\n\t\t\t\t\tevents : {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tconst formData = BX.ajax.prepareForm(form);\n\t\t\t\t\t\t\ttrigger.setName(formData['data']['name']);\n\n\t\t\t\t\t\t\tif (triggerData['SETTINGS'])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#setTriggerProperties(trigger, triggerData['SETTINGS']['Properties'], form);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tBX.onCustomEvent(\n\t\t\t\t\t\t\t\t'BX.Bizproc.Automation.TriggerManager:onSaveSettings-'+trigger.getCode(),\n\t\t\t\t\t\t\t\t[trigger, formData]\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tself.setConditionSettingsFromForm(formData['data'], trigger);\n\t\t\t\t\t\t\ttrigger.setAllowBackwards(formData['data']['allow_backwards'] === 'Y');\n\n\t\t\t\t\t\t\tif (self.canSetExecuteBy())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttrigger.setExecuteBy(formData['data']['execute_by']);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (trigger.draft)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t// remove orange/yellow color\n\n\t\t\t\t\t\t\t\t//self.#triggers.push(trigger);\n\t\t\t\t\t\t\t\t//self.insertTriggerNode(trigger.getStatusId(), trigger.node)\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t//analytics\n\t\t\t\t\t\t\tajax.runAction(\n\t\t\t\t\t\t\t\t'bizproc.analytics.push',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tanalyticsLabel: `automation_trigger${trigger.draft ? '_draft' : ''}_save_${trigger.getCode().toLowerCase()}`\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tdelete trigger.draft;\n\n\t\t\t\t\t\t\ttrigger.reInit();\n\t\t\t\t\t\t\tself.markModified();\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.PopupWindowButtonLink({\n\t\t\t\t\ttext : Loc.getMessage('JS_CORE_WINDOW_CANCEL'),\n\t\t\t\t\tclassName : \"popup-window-button-link-cancel\",\n\t\t\t\t\tevents : {\n\t\t\t\t\t\tclick()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tDesigner.getInstance().getTriggerSettingsDialog().popup = popup;\n\t\tpopup.show();\n\n\t\t//analytics\n\t\tajax.runAction(\n\t\t\t'bizproc.analytics.push',\n\t\t\t{\n\t\t\t\tanalyticsLabel: `automation_trigger${trigger.draft ? '_draft' : ''}_settings_${trigger.getCode().toLowerCase()}`\n\t\t\t}\n\t\t);\n\t}\n\n\t#renderTriggerProperties(trigger: Trigger, properties: [], form: Element)\n\t{\n\t\tproperties.forEach((property) => {\n\n\t\t\tconst value = trigger.getApplyRules()[property.Id];\n\n\t\t\tif (property.Type === '@condition-group-selector')\n\t\t\t{\n\t\t\t\tthis.#renderConditionGroupSelector(property, value, form);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (property.Type === '@webhook-code')\n\t\t\t{\n\t\t\t\tthis.#renderWebhookCodeProperty(property, value, form);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (property.Type === '@field-selector')\n\t\t\t{\n\t\t\t\tthis.#renderFieldSelectorProperty(property, value, form);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst toRenderProperty = {AllowSelection: false, ...property};\n\n\t\t\tif (toRenderProperty.Type === '@robot-select')\n\t\t\t{\n\t\t\t\tthis.#prepareRobotSelectProperty(toRenderProperty);\n\t\t\t}\n\n\t\t\tDom.append(Dom.create(\"span\", {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: \"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-top bizproc-automation-popup-settings-title-autocomplete\",\n\t\t\t\t},\n\t\t\t\ttext: property.Name + ':',\n\t\t\t}), form);\n\n\t\t\tDom.append(Dom.create(\"div\", {\n\t\t\t\tattrs: { className: \"bizproc-automation-popup-settings\" },\n\t\t\t\tchildren: [\n\t\t\t\t\tBX.Bizproc.FieldType.renderControl(\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t...getGlobalContext().document.getRawType(),\n\t\t\t\t\t\t\tgetGlobalContext().document.getCategoryId(),\n\t\t\t\t\t\t],\n\t\t\t\t\t\ttoRenderProperty,\n\t\t\t\t\t\tproperty.Id,\n\t\t\t\t\t\tvalue || ''\n\t\t\t\t\t)\n\t\t\t\t],\n\t\t\t}), form);\n\t\t});\n\t}\n\n\t#prepareRobotSelectProperty(property)\n\t{\n\t\tconst cmp = Designer.getInstance().component;\n\t\tproperty.Options = [];\n\t\tconst filter = property.Settings.Filter;\n\t\tconst check = (robot) =>\n\t\t{\n\t\t\tfor (const field in filter)\n\t\t\t{\n\t\t\t\tif (robot.data[field] !== filter[field])\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t};\n\n\t\tcmp.templateManager.templates.forEach((template) => {\n\t\t\ttemplate.robots.forEach((robot) => {\n\t\t\t\tif (check(robot))\n\t\t\t\t{\n\t\t\t\t\tproperty.Options.push(\n\t\t\t\t\t\t{value: robot.getId(), name: robot.getProperty(property.Settings.OptionNameProperty)}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tdelete property.Settings;\n\t\tproperty.Type = 'select';\n\t}\n\n\t#setTriggerProperties(trigger: Trigger, properties: [], form: Element)\n\t{\n\t\tconst values = {};\n\n\t\tproperties.forEach((property) => {\n\n\t\t\tif (property.Type === '@condition-group-selector')\n\t\t\t{\n\t\t\t\tvalues[property.Id] = this.#setConditionGroupValue(property, form);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst formData = BX.ajax.prepareForm(form);\n\t\t\tvalues[property.Id] = formData.data[property.Id];\n\t\t});\n\n\t\ttrigger.setApplyRules(values);\n\t}\n\n\trenderConditionSettings(trigger: Trigger)\n\t{\n\t\tconst conditionGroup = trigger.getCondition().clone();\n\n\t\tthis.conditionSelector = new ConditionGroupSelector(\n\t\t\tconditionGroup,\n\t\t\t{\n\t\t\t\tfields: getGlobalContext().document.getFields(),\n\t\t\t\tshowValuesSelector: false,\n\t\t\t},\n\t\t);\n\t\tconst selector = this.conditionSelector;\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings\" },\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tattrs: { className: \"bizproc-automation-popup-settings-block\" },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\tattrs: { className: \"bizproc-automation-popup-settings-title\" },\n\t\t\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_ROBOT_CONDITION') + \":\",\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tselector.createNode(),\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t}\n\n\t#renderConditionGroupSelector(property, value, form)\n\t{\n\t\tconst selector = new ConditionGroupSelector(new ConditionGroup(value), {\n\t\t\tfields: property.Settings.Fields,\n\t\t\tfieldPrefix: property.Id,\n\t\t\tshowValuesSelector: false,\n\t\t});\n\n\t\tDom.append(\n\t\t\tDom.create(\"div\", {\n\t\t\t\tattrs: { className: \"bizproc-automation-popup-settings\" },\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tattrs: { className: \"bizproc-automation-popup-settings-block\" },\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\tattrs: { className: \"bizproc-automation-popup-settings-title\" },\n\t\t\t\t\t\t\t\ttext: property.Name + \":\"\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tselector.createNode()\n\t\t\t\t\t\t]\n\t\t\t\t\t})\n\t\t\t\t],\n\t\t\t}),\n\t\t\tform\n\t\t);\n\t}\n\n\t#setConditionGroupValue(property, form)\n\t{\n\t\tconst formData = BX.ajax.prepareForm(form);\n\t\tconst conditionGroup = ConditionGroup.createFromForm(\n\t\t\tformData['data'],\n\t\t\tproperty.Id\n\t\t);\n\n\t\treturn conditionGroup.serialize();\n\t}\n\n\t#renderWebhookCodeProperty(property, value, form)\n\t{\n\t\tif (!value)\n\t\t{\n\t\t\tvalue = Text.getRandom(5);\n\t\t}\n\n\t\tDom.append(Dom.create(\"span\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete\" },\n\t\t\ttext: property.Name + ':'\n\t\t}), form);\n\n\t\tDom.append(Dom.create('input', {\n\t\t\tprops: {\n\t\t\t\ttype: 'hidden',\n\t\t\t\tvalue: value,\n\t\t\t\tname: 'code'\n\t\t\t}\n\t\t}), form);\n\n\t\tconst hookLinkTextarea = Dom.create(\"textarea\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-textarea\",\n\t\t\t\tplaceholder: \"...\",\n\t\t\t\treadonly: 'readonly',\n\t\t\t\tname: 'webhook_handler'\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick()\n\t\t\t\t{\n\t\t\t\t\tthis.select();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tDom.append(Dom.create(\"div\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings\" },\n\t\t\tchildren: [hookLinkTextarea]\n\t\t}), form);\n\n\t\tDom.append(Dom.create(\"span\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete\" },\n\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_WEBHOOK_ID'),\n\t\t}), form);\n\n\t\tif (property.Settings.Handler)\n\t\t{\n\t\t\tlet url = window.location.protocol + '//' + window.location.host + property.Settings.Handler;\n\t\t\turl = Uri.addParam(url, {code: value});\n\t\t\turl = url.replace('{{DOCUMENT_TYPE}}', getGlobalContext().document.getRawType()[2]);\n\t\t\turl = url.replace('{{USER_ID}}', Loc.getMessage('USER_ID'));\n\n\t\t\tif (property.Settings.Password)\n\t\t\t{\n\t\t\t\turl = url.replace('{{PASSWORD}}', property.Settings.Password);\n\t\t\t}\n\n\t\t\thookLinkTextarea.value = url;\n\t\t}\n\n\t\tif (!property.Settings.Password && property.Settings.PasswordLoader)\n\t\t{\n\t\t\tconst myAlertText =\n\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_WEBHOOK_PASSWORD_ALERT')\n\t\t\t\t\t.replace(\n\t\t\t\t\t\t'#A1#',\n\t\t\t\t\t\t'<a class=\"bizproc-automation-popup-settings-link '\n\t\t\t\t\t\t+ 'bizproc-automation-popup-settings-link-light\" data-role=\"token-gen\">'\n\t\t\t\t\t)\n\t\t\t\t\t.replace('#A2#', '</a>')\n\t\t\t;\n\n\t\t\tconst passwordAlert = new Alert({\n\t\t\t\tcolor: AlertColor.WARNING,\n\t\t\t\ticon: AlertIcon.WARNING,\n\t\t\t\ttext: myAlertText\n\t\t\t});\n\n\t\t\tEvent.bind(\n\t\t\t\tpasswordAlert.getTextContainer().querySelector('[data-role=\"token-gen\"]'),\n\t\t\t\t'click',\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tconst loaderConfig = property.Settings.PasswordLoader;\n\n\t\t\t\t\tBX.ajax.runComponentAction(\n\t\t\t\t\t\tloaderConfig.component,\n\t\t\t\t\t\tloaderConfig.action,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: loaderConfig.mode || undefined,\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tdocumentType: [\n\t\t\t\t\t\t\t\t\t...getGlobalContext().document.getRawType(),\n\t\t\t\t\t\t\t\t\tgetGlobalContext().document.getCategoryId(),\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t).then(\n\t\t\t\t\t\tfunction(response)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (response.data.error)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\twindow.alert(response.data.error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (response.data.password)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tproperty.Settings.Password = response.data.password;\n\t\t\t\t\t\t\t\thookLinkTextarea.value = hookLinkTextarea\n\t\t\t\t\t\t\t\t\t.value.replace('{{PASSWORD}}', property.Settings.Password)\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\tpasswordAlert.handleCloseBtnClick();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tDom.append(passwordAlert.getContainer(), form);\n\t\t}\n\t}\n\n\t#renderFieldSelectorProperty(property, value, form)\n\t{\n\t\tconst menuId = '@field-selector' + Math.random();\n\t\tconst fieldName = property.Id + '[]';\n\n\t\tconst fieldsList = property.Settings.Fields;\n\n\t\tconst renderFieldCheckbox = function(field, listNode)\n\t\t{\n\t\t\tconst exists = listNode.querySelector('[data-field=\"' + field['Id'] + '\"]');\n\t\t\tif (exists)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.append(\n\t\t\t\tDom.create(\n\t\t\t\t\t'div',\n\t\t\t\t\t{\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\tclassName: 'bizproc-automation-popup-checkbox-item',\n\t\t\t\t\t\t\t'data-field': field['Id']\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create(\n\t\t\t\t\t\t\t\t'label',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\tclassName: 'bizproc-automation-popup-chk-label'\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\n\t\t\t\t\t\t\t\t\t\t\t'input', {\n\t\t\t\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'bizproc-automation-popup-chk',\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'checkbox',\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: fieldName,\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: field['Id'],\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tchecked: true\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\tdocument.createTextNode(field['Name']),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t\tlistNode\n\t\t\t);\n\t\t}\n\n\t\tconst fieldSelectorHandler = function(targetNode, listNode)\n\t\t{\n\t\t\tif (BX.Main.MenuManager.getMenuById(menuId))\n\t\t\t{\n\t\t\t\treturn BX.Main.MenuManager.getMenuById(menuId).show();\n\t\t\t}\n\n\t\t\tconst menuItems = [];\n\n\t\t\tfieldsList.forEach(function(field)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: BX.Text.encode(field['Name']),\n\t\t\t\t\tfield: field,\n\t\t\t\t\tonclick: function(event, item)\n\t\t\t\t\t{\n\t\t\t\t\t\trenderFieldCheckbox(item.field, listNode);\n\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tBX.Main.MenuManager.show(\n\t\t\t\tmenuId,\n\t\t\t\ttargetNode,\n\t\t\t\tmenuItems,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\toffsetLeft: (BX.pos(this)['width'] / 2),\n\t\t\t\t\tangle: { position: 'top', offset: 0 },\n\t\t\t\t\tzIndex: 200,\n\t\t\t\t\tclassName: 'bizproc-automation-inline-selector-menu',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonPopupClose: function(popup)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tDom.append(\n\t\t\tDom.create(\n\t\t\t\t'span',\n\t\t\t\t{\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: \"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: property.Name + ':',\n\t\t\t\t}\n\t\t\t),\n\t\t\tform\n\t\t);\n\n\t\tconst fieldListNode = Dom.create(\n\t\t\t'div',\n\t\t\t{\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'bizproc-automation-popup-checkbox',\n\t\t\t\t},\n\t\t\t\tchildren: [],\n\t\t\t}\n\t\t);\n\t\tDom.append(fieldListNode, form);\n\n\t\tDom.append(\n\t\t\tDom.create(\n\t\t\t\t'div',\n\t\t\t\t{\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'bizproc-automation-popup-settings bizproc-automation-popup-settings-text',\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\n\t\t\t\t\t\t\t'span',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\tclassName: \"bizproc-automation-popup-settings-link\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttext: property.Settings.ChooseFieldLabel,\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tclick: function()\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tfieldSelectorHandler(this, fieldListNode);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t),\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t),\n\t\t\tform\n\t\t);\n\n\t\tif (Type.isArray(value))\n\t\t{\n\t\t\tvalue.forEach(function(field)\n\t\t\t{\n\t\t\t\tconst foundField = fieldsList.find((fld) => fld.Id === field);\n\t\t\t\tif (foundField)\n\t\t\t\t{\n\t\t\t\t\trenderFieldCheckbox(foundField, fieldListNode);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\trenderExecuteByControl(trigger, form)\n\t{\n\t\tDom.append(Dom.create(\"span\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-top bizproc-automation-popup-settings-title-autocomplete\",\n\t\t\t},\n\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_TRIGGER_EXECUTE_BY') + ':',\n\t\t}), form);\n\n\t\tDom.append(Dom.create(\"div\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings\" },\n\t\t\tchildren: [\n\t\t\t\tBX.Bizproc.FieldType.renderControl(\n\t\t\t\t\tgetGlobalContext().document.getRawType(),\n\t\t\t\t\t{\n\t\t\t\t\t\tType: 'user'\n\t\t\t\t\t},\n\t\t\t\t\t'execute_by',\n\t\t\t\t\ttrigger.draft\n\t\t\t\t\t\t? Helper.getResponsibleUserExpression(getGlobalContext().document.getFields())\n\t\t\t\t\t\t: trigger.getExecuteBy()\n\t\t\t\t),\n\t\t\t],\n\t\t}), form);\n\t}\n\n\trenderAllowBackwardsControl(trigger, form)\n\t{\n\t\tDom.append(Dom.create(\"div\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-checkbox\" },\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tattrs: { className: \"bizproc-automation-popup-checkbox-item\" },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\t\tattrs: { className: \"bizproc-automation-popup-chk-label\" },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"input\", {\n\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\tclassName: 'bizproc-automation-popup-chk',\n\t\t\t\t\t\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\t\t\t\t\t\tname: \"allow_backwards\",\n\t\t\t\t\t\t\t\t\t\tvalue: 'Y'\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tchecked: trigger.isBackwardsAllowed()\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tdocument.createTextNode(Loc.getMessage('BIZPROC_AUTOMATION_CMP_TRIGGER_ALLOW_REVERSE')),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t}), form);\n\t}\n\n\tsetConditionSettingsFromForm(formFields: Object,  trigger: Trigger): this\n\t{\n\t\ttrigger.setCondition(ConditionGroup.createFromForm(formFields));\n\n\t\treturn this;\n\t}\n\n\tonRestAppInstall(installed, eventResult)\n\t{\n\t\teventResult.redirect = false;\n\t\tconst self = this;\n\n\t\tsetTimeout(function()\n\t\t{\n\t\t\tBX.ajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl: getGlobalContext().ajaxUrl,\n\t\t\t\tdata: {\n\t\t\t\t\tajax_action: 'get_available_triggers',\n\t\t\t\t\tdocument_signed: getGlobalContext().signedDocument\n\t\t\t\t},\n\t\t\t\tonsuccess(response)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isArray(response['DATA']))\n\t\t\t\t\t{\n\t\t\t\t\t\tgetGlobalContext().set('availableTriggers', response['DATA']);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}, 1500);\n\t}\n\n\tinitSettingsDialogControls(node)\n\t{\n\t\tif (!Type.isArray(this.settingsDialogControls))\n\t\t{\n\t\t\tthis.settingsDialogControls = [];\n\t\t}\n\n\t\tconst controlNodes = node.querySelectorAll('[data-role]');\n\t\tfor (let i = 0; i < controlNodes.length; ++i)\n\t\t{\n\t\t\tlet control = null;\n\t\t\tconst role = controlNodes[i].getAttribute('data-role');\n\n\t\t\tif (role === 'user-selector')\n\t\t\t{\n\t\t\t\tcontrol = BX.Bizproc.UserSelector.decorateNode(controlNodes[i]);\n\t\t\t}\n\n\t\t\tBX.UI.Hint.init(controlNodes[i]);\n\n\t\t\tif (control)\n\t\t\t{\n\t\t\t\tthis.settingsDialogControls.push(control);\n\t\t\t}\n\t\t}\n\t}\n\n\tdestroySettingsDialogControls()\n\t{\n\t\tif (this.conditionSelector)\n\t\t{\n\t\t\tthis.conditionSelector.destroy();\n\t\t\tthis.conditionSelector = null;\n\t\t}\n\n\t\tif (Type.isArray(this.settingsDialogControls))\n\t\t{\n\t\t\tfor (let i = 0; i < this.settingsDialogControls.length; ++i)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(this.settingsDialogControls[i].destroy))\n\t\t\t\t{\n\t\t\t\t\tthis.settingsDialogControls[i].destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.settingsDialogControls = null;\n\t}\n\n\tgetListByDocumentStatus(statusId): Array<Trigger>\n\t{\n\t\tconst result = [];\n\t\tthis.#triggers.forEach((trigger) => {\n\t\t\tif (trigger.getStatusId() === statusId)\n\t\t\t{\n\t\t\t\tresult.push(trigger);\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tgetReturnProperties(statusId): Array<Object>\n\t{\n\t\tconst result = [];\n\t\tconst exists = {};\n\t\tconst triggers = this.getListByDocumentStatus(statusId);\n\n\t\ttriggers.forEach((trigger) => {\n\t\t\tconst props = trigger.deleted ? [] : trigger.getReturnProperties();\n\t\t\tif (props.length)\n\t\t\t{\n\t\t\t\tprops.forEach((property) => {\n\t\t\t\t\tif (!exists[property.Id])\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\tId: property.Id,\n\t\t\t\t\t\t\tObjectId: 'Template',\n\t\t\t\t\t\t\tName: property.Name,\n\t\t\t\t\t\t\tObjectName: trigger.getName(),\n\t\t\t\t\t\t\tType: property.Type,\n\t\t\t\t\t\t\tExpression: '{{~*:'+property.Id+'}}',\n\t\t\t\t\t\t\tSystemExpression: '{=Template:'+property.Id+'}'\n\t\t\t\t\t\t});\n\t\t\t\t\t\texists[property.Id] = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tgetReturnProperty(statusId, propertyId): ?Object\n\t{\n\t\tconst properties = this.getReturnProperties(statusId);\n\t\tfor (let i = 0; i < properties.length; ++i)\n\t\t{\n\t\t\tif (properties[i].Id === propertyId)\n\t\t\t{\n\t\t\t\treturn properties[i];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n}","import { Type, Runtime } from 'main.core';\n\nexport class Document\n{\n\t#rawType: Array<string>;\n\t#id: number;\n\t#title: ?string;\n\t#categoryId: ?number;\n\t#statusList: ?Array<Object>;\n\t#currentStatusIndex: number;\n\n\t#fields: ?Array<Object>;\n\n\tconstructor(options: {\n\t\trawDocumentType: Array<string>,\n\t\tdocumentId: number,\n\t\tcategoryId?: number,\n\t\tstatusId?: string,\n\n\t\tstatusList: Array<Object>,\n\n\t\tdocumentFields?: Array<Object>;\n\t\ttitle?: string,\n\t})\n\t{\n\t\tthis.#rawType = options.rawDocumentType;\n\t\tthis.#id = options.documentId;\n\t\tthis.#title = options.title;\n\t\tthis.#categoryId = options.categoryId;\n\n\t\tthis.#statusList = [];\n\t\tthis.#currentStatusIndex = 0;\n\t\tif (Type.isArray(options.statusList))\n\t\t{\n\t\t\tthis.#statusList = options.statusList\n\t\t\tthis.#currentStatusIndex = this.#statusList.findIndex(status => status.STATUS_ID === options.statusId)\n\t\t}\n\t\telse if (Type.isStringFilled(options.statusId))\n\t\t{\n\t\t\tthis.#statusList.push(options.statusId);\n\t\t}\n\n\t\tif (this.#currentStatusIndex < 0)\n\t\t{\n\t\t\tthis.#currentStatusIndex = 0;\n\t\t}\n\n\t\tthis.#fields = Type.isArray(options.documentFields) ? options.documentFields : [];\n\t}\n\n\tclone(): this\n\t{\n\t\treturn new Document({\n\t\t\trawDocumentType: Runtime.clone(this.#rawType),\n\t\t\tdocumentId: this.#id,\n\t\t\tcategoryId: this.#categoryId,\n\t\t\tstatusId: this.getCurrentStatusId(),\n\n\t\t\tstatusList: Runtime.clone(this.#statusList),\n\n\t\t\tdocumentFields: Runtime.clone(this.#fields),\n\t\t\ttitle: this.#title,\n\t\t});\n\t}\n\n\tget title(): ?string\n\t{\n\t\treturn this.#title;\n\t}\n\n\tgetId(): number\n\t{\n\t\treturn this.#id;\n\t}\n\n\tgetRawType(): Array<string>\n\t{\n\t\treturn this.#rawType;\n\t}\n\n\tgetCategoryId(): ?number\n\t{\n\t\treturn this.#categoryId;\n\t}\n\n\tgetCurrentStatusId(): ?string\n\t{\n\t\tconst documentStatus = this.#statusList[this.#currentStatusIndex]?.STATUS_ID;\n\n\t\treturn !Type.isNil(documentStatus) ? String(documentStatus) : documentStatus;\n\t}\n\n\tgetSortedStatusId(index: number): ?string\n\t{\n\t\tif (index >= 0 && index < this.#statusList.length)\n\t\t{\n\t\t\treturn this.#statusList[index].STATUS_ID;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetNextStatusIdList(): Array<string>\n\t{\n\t\treturn this.#statusList.slice(this.#currentStatusIndex + 1).map(status => status.STATUS_ID);\n\t}\n\n\tgetPreviousStatusIdList(): Array<string>\n\t{\n\t\treturn this.#statusList.slice(0, this.#currentStatusIndex).map(status => status.STATUS_ID);\n\t}\n\n\tsetStatus(statusId: string): Document\n\t{\n\t\tconst newStatusId = this.#statusList.findIndex(status => status.STATUS_ID === statusId);\n\t\tif (newStatusId >= 0)\n\t\t{\n\t\t\tthis.#currentStatusIndex = newStatusId;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetFields(): Array<Object>\n\t{\n\t\treturn this.#fields;\n\t}\n\n\tsetFields(documentFields: Array<object>): this\n\t{\n\t\tthis.#fields = documentFields;\n\n\t\treturn this;\n\t}\n\n\tsetStatusList(statusList: Array<Object>): this\n\t{\n\t\tif (Type.isArrayFilled(statusList))\n\t\t{\n\t\t\tthis.#statusList = statusList;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tget statusList(): ?Array<Object>\n\t{\n\t\treturn this.#statusList;\n\t}\n}","import { Type, Loc } from 'main.core';\n\nexport class DelayInterval\n{\n\tstatic BASIS_TYPE = {\n\t\tCurrentDate: '{=System:Date}',\n\t\tCurrentDateTime: '{=System:Now}',\n\t\tCurrentDateTimeLocal: '{=System:NowLocal}',\n\t};\n\n\tstatic DELAY_TYPE = {\n\t\tAfter: 'after',\n\t\tBefore: 'before',\n\t\tIn: 'in',\n\t};\n\n\t#basis: string = DelayInterval.BASIS_TYPE.CurrentDateTime;\n\t#type: string = DelayInterval.DELAY_TYPE.After;\n\t#value: number = 0;\n\t#valueType: string = 'i';\n\t#workTime: boolean = false;\n\t#waitWorkDay: boolean = false;\n\t#inTime: ?Array<[number, number]>;\n\n\tconstructor(params: ?Object)\n\t{\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tif (params['type'])\n\t\t\t{\n\t\t\t\tthis.setType(params['type']);\n\t\t\t}\n\t\t\tif (params['value'])\n\t\t\t{\n\t\t\t\tthis.setValue(params['value']);\n\t\t\t}\n\t\t\tif (params['valueType'])\n\t\t\t{\n\t\t\t\tthis.setValueType(params['valueType']);\n\t\t\t}\n\t\t\tif (params['basis'])\n\t\t\t{\n\t\t\t\tthis.setBasis(params['basis']);\n\t\t\t}\n\t\t\tif (params['workTime'])\n\t\t\t{\n\t\t\t\tthis.setWorkTime(params['workTime']);\n\t\t\t}\n\t\t\tif (params['waitWorkDay'])\n\t\t\t{\n\t\t\t\tthis.setWaitWorkDay(params['waitWorkDay']);\n\t\t\t}\n\t\t\tif (params['inTime'])\n\t\t\t{\n\t\t\t\tthis.setInTime(params['inTime']);\n\t\t\t}\n\t\t}\n\t}\n\n\tget basis()\n\t{\n\t\treturn this.#basis;\n\t}\n\n\tget type()\n\t{\n\t\treturn this.#type;\n\t}\n\n\tget value()\n\t{\n\t\treturn this.#value;\n\t}\n\n\tget valueType()\n\t{\n\t\treturn this.#valueType;\n\t}\n\n\tget workTime()\n\t{\n\t\treturn this.#workTime;\n\t}\n\n\tget waitWorkDay()\n\t{\n\t\treturn this.#waitWorkDay;\n\t}\n\n\tget inTime()\n\t{\n\t\treturn this.#inTime;\n\t}\n\n\tget inTimeString(): string\n\t{\n\t\tif (!this.#inTime)\n\t\t{\n\t\t\treturn ''\n\t\t}\n\n\t\treturn ('0' + this.#inTime[0]).slice(-2) + ':' + ('0' + this.#inTime[1]).slice(-2);\n\t}\n\n\tclone()\n\t{\n\t\treturn new DelayInterval({\n\t\t\ttype: this.#type,\n\t\t\tvalue: this.#value,\n\t\t\tvalueType: this.#valueType,\n\t\t\tbasis: this.#basis,\n\t\t\tworkTime: this.#workTime,\n\t\t\twaitWorkDay: this.#waitWorkDay,\n\t\t\tinTime: this.#inTime,\n\t\t});\n\t}\n\n\tstatic isSystemBasis(basis: string): boolean\n\t{\n\t\treturn (\n\t\t\tbasis === this.BASIS_TYPE.CurrentDate\n\t\t\t|| basis === this.BASIS_TYPE.CurrentDateTime\n\t\t\t|| basis === this.BASIS_TYPE.CurrentDateTimeLocal\n\t\t);\n\t}\n\n\tstatic fromString(intervalString, basisFields): this\n\t{\n\t\tif (!intervalString)\n\t\t{\n\t\t\treturn new DelayInterval();\n\t\t}\n\n\t\tintervalString = intervalString.toString().trimStart().replace(/^=/, '');\n\t\tconst params = {\n\t\t\tbasis: DelayInterval.BASIS_TYPE.CurrentDateTime,\n\t\t\tworkTime: false,\n\t\t\tinTime: null,\n\t\t};\n\n\t\tconst values = {\n\t\t\ti: 0,\n\t\t\th: 0,\n\t\t\td: 0,\n\t\t};\n\n\t\tif (intervalString.indexOf('settime(') === 0)\n\t\t{\n\t\t\tintervalString = intervalString.substring(8, intervalString.length - 1);\n\n\t\t\tconst setTimeArgs = intervalString.split(',');\n\t\t\tconst minute = parseInt(setTimeArgs.pop().trim());\n\t\t\tconst hour = parseInt(setTimeArgs.pop().trim());\n\n\t\t\tparams.inTime = [hour || 0, minute || 0];\n\t\t\tintervalString = setTimeArgs.join(',');\n\t\t}\n\n\t\tif (intervalString.indexOf('dateadd(') === 0 || intervalString.indexOf('workdateadd(') === 0)\n\t\t{\n\t\t\tif (intervalString.indexOf('workdateadd(') === 0)\n\t\t\t{\n\t\t\t\tintervalString = intervalString.substring(12, intervalString.length - 1);\n\t\t\t\tparams['workTime'] = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintervalString = intervalString.substring(8, intervalString.length - 1);\n\t\t\t}\n\n\t\t\tconst fnArgs = intervalString.split(',');\n\t\t\tparams['basis'] = fnArgs[0].trim();\n\t\t\tfnArgs[1] = (fnArgs[1] || '').replace(/['\")]+/g, '');\n\t\t\tparams['type'] = fnArgs[1].indexOf('-') === 0 ? DelayInterval.DELAY_TYPE.Before : DelayInterval.DELAY_TYPE.After;\n\n\t\t\tlet match;\n\t\t\tconst re = /s*([\\d]+)\\s*(i|h|d)\\s*/ig;\n\t\t\twhile (match = re.exec(fnArgs[1]))\n\t\t\t{\n\t\t\t\tvalues[match[2]] = parseInt(match[1]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparams['basis'] = intervalString;\n\t\t}\n\n\t\tif (!DelayInterval.isSystemBasis(params['basis']) && BX.type.isArray(basisFields))\n\t\t{\n\t\t\tlet found = false;\n\t\t\tfor (let i = 0, s = basisFields.length; i < s; ++i)\n\t\t\t{\n\t\t\t\tif (params['basis'] === basisFields[i].SystemExpression || params['basis'] === basisFields[i].Expression)\n\t\t\t\t{\n\t\t\t\t\tparams['basis'] = basisFields[i].SystemExpression;\n\t\t\t\t\tfound = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!found)\n\t\t\t{\n\t\t\t\tparams['basis'] = DelayInterval.BASIS_TYPE.CurrentDateTime;\n\t\t\t}\n\t\t}\n\n\t\tconst minutes = values['i'] + values['h'] * 60 + values['d'] * 60 * 24;\n\n\t\tif (minutes % 1440 === 0)\n\t\t{\n\t\t\tparams['value'] = minutes / 1440;\n\t\t\tparams['valueType'] = 'd';\n\t\t}\n\t\telse if (minutes % 60 === 0)\n\t\t{\n\t\t\tparams['value'] = minutes / 60;\n\t\t\tparams['valueType'] = 'h';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparams['value'] = minutes;\n\t\t\tparams['valueType'] = 'i';\n\t\t}\n\n\t\tif (\n\t\t\t!params['value']\n\t\t\t&& (\n\t\t\t\tparams['basis'] !== DelayInterval.BASIS_TYPE.CurrentDateTime\n\t\t\t\t|| params.inTime\n\t\t\t)\n\t\t\t&& params['basis']\n\t\t)\n\t\t{\n\t\t\tparams['type'] = DelayInterval.DELAY_TYPE.In;\n\t\t}\n\n\t\treturn new DelayInterval(params);\n\t};\n\n\tstatic fromMinutes(minutes): Array<string>\n\t{\n\t\tlet value;\n\t\tlet type;\n\n\t\tif (minutes % 1440 === 0)\n\t\t{\n\t\t\tvalue = minutes / 1440;\n\t\t\ttype = 'd';\n\t\t}\n\t\telse if (minutes % 60 === 0)\n\t\t{\n\t\t\tvalue = minutes / 60;\n\t\t\ttype = 'h';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvalue = minutes;\n\t\t\ttype = 'i';\n\t\t}\n\n\t\treturn [value, type];\n\t}\n\n\tstatic toMinutes(value, valueType): number\n\t{\n\t\tlet result = 0;\n\n\t\tswitch (valueType)\n\t\t{\n\t\t\tcase 'i':\n\t\t\t\tresult = value;\n\t\t\t\tbreak;\n\t\t\tcase 'h':\n\t\t\t\tresult = value * 60;\n\t\t\t\tbreak;\n\t\t\tcase 'd':\n\t\t\t\tresult = value * 60 * 24;\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsetType(type): this\n\t{\n\t\tif (\n\t\t\ttype !== DelayInterval.DELAY_TYPE.After\n\t\t\t&& type !== DelayInterval.DELAY_TYPE.Before\n\t\t\t&& type !== DelayInterval.DELAY_TYPE.In\n\t\t)\n\t\t{\n\t\t\ttype = DelayInterval.DELAY_TYPE.After;\n\t\t}\n\t\tthis.#type = type;\n\n\t\treturn this;\n\t}\n\n\tsetValue(value): this\n\t{\n\t\tvalue = parseInt(value);\n\t\tthis.#value = value >= 0 ? value : 0;\n\n\t\treturn this;\n\t}\n\n\tsetValueType(valueType: string): this\n\t{\n\t\tif (valueType !== 'i' && valueType !== 'h' && valueType !== 'd')\n\t\t{\n\t\t\tvalueType = 'i';\n\t\t}\n\n\t\tthis.#valueType = valueType;\n\n\t\treturn this;\n\t}\n\n\tsetBasis(basis: string): this\n\t{\n\t\tif (Type.isString(basis) && basis !== '')\n\t\t{\n\t\t\tthis.#basis = basis;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetWorkTime(flag): this\n\t{\n\t\tthis.#workTime = !!flag;\n\n\t\treturn this;\n\t}\n\n\tsetWaitWorkDay(flag): this\n\t{\n\t\tthis.#waitWorkDay = !!flag;\n\n\t\treturn this;\n\t}\n\n\tsetInTime(value: ?Array<[number, number]>): this\n\t{\n\t\tthis.#inTime = value;\n\n\t\treturn this;\n\t}\n\n\tisNow(): boolean\n\t{\n\t\treturn (\n\t\t\tthis.#type === DelayInterval.DELAY_TYPE.After\n\t\t\t&& this.#basis === DelayInterval.BASIS_TYPE.CurrentDateTime\n\t\t\t&& !this.#value\n\t\t\t&& !this.workTime\n\t\t\t&& !this.inTime\n\t\t);\n\t}\n\n\tsetNow(): void\n\t{\n\t\tthis.setType(DelayInterval.DELAY_TYPE.After);\n\t\tthis.setValue(0);\n\t\tthis.setValueType('i');\n\t\tthis.setBasis(DelayInterval.BASIS_TYPE.CurrentDateTime);\n\t\tthis.setInTime(null);\n\t}\n\n\tserialize(): Object\n\t{\n\t\treturn {\n\t\t\ttype: this.#type,\n\t\t\tvalue: this.#value,\n\t\t\tvalueType: this.#valueType,\n\t\t\tbasis: this.#basis,\n\t\t\tworkTime: this.#workTime ? 1 : 0,\n\t\t\twaitWorkDay: this.#waitWorkDay ? 1 : 0,\n\t\t\tinTime: this.#inTime || null,\n\t\t}\n\t}\n\n\ttoExpression(basisFields, workerExpression): string\n\t{\n\t\tlet basis = this.#basis ? this.#basis : DelayInterval.BASIS_TYPE.CurrentDate;\n\n\t\tif (!DelayInterval.isSystemBasis(basis) && Type.isArray(basisFields))\n\t\t{\n\t\t\tfor (let i = 0, s = basisFields.length; i < s; ++i)\n\t\t\t{\n\t\t\t\tif (basis === basisFields[i].SystemExpression)\n\t\t\t\t{\n\t\t\t\t\tbasis = basisFields[i].Expression;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.isNow() || this.#type === DelayInterval.DELAY_TYPE.In && !this.#workTime && !this.#inTime)\n\t\t{\n\t\t\treturn basis;\n\t\t}\n\n\t\tlet days = 0;\n\t\tlet hours = 0;\n\t\tlet minutes = 0;\n\n\t\tswitch (this.#valueType)\n\t\t{\n\t\t\tcase 'i':\n\t\t\t\tminutes = this.#value;\n\t\t\t\tbreak;\n\t\t\tcase 'h':\n\t\t\t\thours = this.#value;\n\t\t\t\tbreak;\n\t\t\tcase 'd':\n\t\t\t\tdays = this.#value;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tlet add = '';\n\n\t\tif (this.#type === DelayInterval.DELAY_TYPE.Before)\n\t\t{\n\t\t\tadd = '-';\n\t\t}\n\n\t\tif (days > 0)\n\t\t{\n\t\t\tadd += days + 'd';\n\t\t}\n\t\tif (hours > 0)\n\t\t{\n\t\t\tadd += hours + 'h';\n\t\t}\n\t\tif (minutes > 0)\n\t\t{\n\t\t\tadd += minutes + 'i';\n\t\t}\n\n\t\tconst fn = this.#workTime ? 'workdateadd' : 'dateadd';\n\n\t\tif (fn === 'workdateadd' && add === '')\n\t\t{\n\t\t\tadd = '0d';\n\t\t}\n\n\t\tlet worker = '';\n\t\tif (fn === 'workdateadd' && workerExpression)\n\t\t{\n\t\t\tworker = workerExpression;\n\t\t}\n\n\t\tlet result = fn + '(' + basis + ',\"' + add + '\"' + (worker ? ',' + worker : '') + ')'\n\n\t\tif (this.#type === DelayInterval.DELAY_TYPE.In && this.#inTime)\n\t\t{\n\t\t\tif (!this.#workTime)\n\t\t\t{\n\t\t\t\tresult = basis;\n\t\t\t}\n\n\t\t\tresult = `settime(${result}, ${this.#inTime[0] || 0}, ${this.#inTime[1] || 0})`;\n\t\t}\n\n\t\treturn '=' + result;\n\t}\n\n\tformat(emptyText, fields)\n\t{\n\t\tlet str = emptyText;\n\n\t\tif (this.#type === DelayInterval.DELAY_TYPE.In)\n\t\t{\n\t\t\tstr = Loc.getMessage('BIZPROC_AUTOMATION_CMP_IN_TIME');\n\t\t\tif (Type.isArray(fields))\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < fields.length; ++i)\n\t\t\t\t{\n\t\t\t\t\tif (this.#basis === fields[i].SystemExpression)\n\t\t\t\t\t{\n\t\t\t\t\t\tstr += ' ' + fields[i].Name;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.inTime)\n\t\t\t{\n\t\t\t\tstr += ' ' + this.inTimeString;\n\t\t\t}\n\t\t}\n\t\telse if (this.#value)\n\t\t{\n\t\t\tconst prefix = (\n\t\t\t\tthis.#type === DelayInterval.DELAY_TYPE.After\n\t\t\t\t\t? Loc.getMessage('BIZPROC_AUTOMATION_CMP_THROUGH')\n\t\t\t\t\t: Loc.getMessage('BIZPROC_AUTOMATION_CMP_FOR_TIME_1')\n\t\t\t);\n\n\t\t\tstr = prefix + ' ' + this.getFormattedPeriodLabel(this.#value, this.#valueType);\n\n\t\t\tif (Type.isArray(fields))\n\t\t\t{\n\t\t\t\tconst fieldSuffix = (\n\t\t\t\t\tthis.#type === DelayInterval.DELAY_TYPE.After\n\t\t\t\t\t\t? Loc.getMessage('BIZPROC_AUTOMATION_CMP_AFTER')\n\t\t\t\t\t\t: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BEFORE_1')\n\t\t\t\t);\n\t\t\t\tfor (let i = 0; i < fields.length; ++i)\n\t\t\t\t{\n\t\t\t\t\tif (this.#basis === fields[i].SystemExpression)\n\t\t\t\t\t{\n\t\t\t\t\t\tstr += ' ' + fieldSuffix + ' ' + fields[i].Name;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.#workTime)\n\t\t{\n\t\t\tstr += ', ' + Loc.getMessage('BIZPROC_AUTOMATION_CMP_IN_WORKTIME');\n\t\t}\n\n\t\treturn str;\n\t}\n\n\tgetFormattedPeriodLabel(value, type)\n\t{\n\t\tconst label = value + ' ';\n\t\tlet labelIndex = 0;\n\t\tif (value > 20)\n\t\t{\n\t\t\tvalue = (value % 10);\n\t\t}\n\n\t\tif (value === 1)\n\t\t{\n\t\t\tlabelIndex = 0;\n\t\t}\n\t\telse if (value > 1 && value < 5)\n\t\t{\n\t\t\tlabelIndex = 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlabelIndex = 2;\n\t\t}\n\n\t\tconst labels = DelayInterval.getPeriodLabels(type);\n\n\t\treturn label + (labels ? labels[labelIndex] : '');\n\t}\n\n\tstatic getPeriodLabels(period)\n\t{\n\t\tlet labels = [];\n\t\tif (period === 'i')\n\t\t{\n\t\t\tlabels = [\n\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_MIN1'),\n\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_MIN2'),\n\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_MIN3')\n\t\t\t];\n\t\t}\n\t\telse if (period === 'h')\n\t\t{\n\t\t\tlabels = [\n\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_HOUR1'),\n\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_HOUR2'),\n\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_HOUR3')\n\t\t\t];\n\t\t}\n\t\telse if (period === 'd')\n\t\t{\n\t\t\tlabels = [\n\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_DAY1'),\n\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_DAY2'),\n\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_DAY3')\n\t\t\t];\n\t\t}\n\n\t\treturn labels;\n\t}\n}","import { Event, Text, Type, Dom, Loc } from 'main.core';\n\nexport class HelpHint\n{\n\tstatic popupHint;\n\tstatic timeout;\n\n\tstatic bindAll(node)\n\t{\n\t\tnode.querySelectorAll('[data-text]').forEach((element) => HelpHint.bindToNode(element));\n\t}\n\n\tstatic bindToNode(node)\n\t{\n\t\tEvent.bind(node, 'mouseover', this.showHint.bind(this, node));\n\t\tEvent.bind(node, 'mouseout', this.hideHint.bind(this));\n\t}\n\n\tstatic isBindedToNode(node): boolean\n\t{\n\t\treturn !!this.popupHint?.bindElement?.isSameNode(node);\n\t}\n\n\tstatic showHint(node)\n\t{\n\t\tconst rawText = node.getAttribute('data-text');\n\t\tif (!rawText)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet text = Text.encode(rawText);\n\t\ttext = BX.util.nl2br(text);\n\n\t\tif (!Type.isStringFilled(text))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.hideHint();\n\n\t\tthis.popupHint = new BX.PopupWindow('bizproc-automation-help-tip', node, {\n\t\t\tlightShadow: true,\n\t\t\tautoHide: false,\n\t\t\tdarkMode: true,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 2,\n\t\t\tbindOptions: {position: \"top\"},\n\t\t\tevents : {\n\t\t\t\tonPopupClose()\n\t\t\t\t{\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t},\n\t\t\tcontent : Dom.create('div', {\n\t\t\t\tattrs : {\n\t\t\t\t\tstyle : 'padding-right: 5px; width: 250px;'\n\t\t\t\t},\n\t\t\t\thtml: text\n\t\t\t}),\n\t\t});\n\t\tthis.popupHint.setAngle({offset: 32, position: 'bottom'});\n\t\tthis.popupHint.show();\n\n\t\treturn true;\n\t}\n\n\tstatic showNoPermissionsHint(node)\n\t{\n\t\tthis.showAngleHint(node, Loc.getMessage('BIZPROC_AUTOMATION_RIGHTS_ERROR'));\n\t}\n\n\tstatic showAngleHint(node, text)\n\t{\n\t\tif (this.timeout)\n\t\t{\n\t\t\tclearTimeout(this.timeout);\n\t\t}\n\n\t\tthis.popupHint = BX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\twidth: 334,\n\t\t\t\theight: 104,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tangle: {offset: Dom.getPosition(node).width / 2},\n\t\t\t\tbindOptions: {position: 'top'},\n\t\t\t}\n\t\t});\n\n\t\tthis.popupHint.close = function ()\n\t\t{\n\t\t\tthis.hide();\n\t\t};\n\t\tthis.popupHint.show(node, text);\n\t\tthis.timeout = setTimeout(this.hideHint.bind(this), 5000);\n\t}\n\n\tstatic hideHint()\n\t{\n\t\tif (this.popupHint)\n\t\t{\n\t\t\tthis.popupHint.close();\n\t\t}\n\t\tthis.popupHint = null;\n\t}\n}","export class WorkflowStatus\n{\n\tstatic CREATED = 0;\n\tstatic RUNNING = 1;\n\tstatic COMPLETED = 2;\n\tstatic SUSPENDED = 3;\n\tstatic TERMINATED = 4;\n}","import {WorkflowStatus} from \"../workflow/types\";\n\nexport class TrackingEntry\n{\n\tstatic UNKNOWN_ACTIVITY_TYPE = 0;\n\tstatic EXECUTE_ACTIVITY_TYPE = 1;\n\tstatic CLOSE_ACTIVITY_TYPE = 2;\n\tstatic CANCEL_ACTIVITY_TYPE = 3;\n\tstatic FAULT_ACTIVITY_TYPE = 4;\n\tstatic CUSTOM_ACTIVITY_TYPE = 5;\n\tstatic REPORT_ACTIVITY_TYPE = 6;\n\tstatic ATTACHED_ENTITY_TYPE = 7;\n\tstatic TRIGGER_ACTIVITY_TYPE = 8;\n\tstatic ERROR_ACTIVITY_TYPE = 9;\n\tstatic DEBUG_ACTIVITY_TYPE = 10;\n\tstatic DEBUG_AUTOMATION_TYPE = 11;\n\tstatic DEBUG_DESIGNER_TYPE = 12;\n\tstatic DEBUG_LINK_TYPE = 13;\n\n\tid: number;\n\tworkflowId: string;\n\t#type: number;\n\tname: string;\n\ttitle: string;\n\tnote: string;\n\t// TODO - convert string to Date\n\tdatetime: string;\n\t#workflowStatus: number;\n\n\tget type(): number\n\t{\n\t\treturn this.#type;\n\t}\n\n\tget workflowStatus(): number\n\t{\n\t\treturn this.#workflowStatus;\n\t}\n\n\tset type(entryType: number)\n\t{\n\t\tif (TrackingEntry.getAllActivityTypes().includes(entryType))\n\t\t{\n\t\t\tthis.#type = entryType;\n\t\t}\n\t}\n\n\tset workflowStatus(entryWorkflowStatus: number)\n\t{\n\t\tif (TrackingEntry.getAllWorkflowStatuses().includes(entryWorkflowStatus))\n\t\t{\n\t\t\tthis.#workflowStatus = entryWorkflowStatus;\n\t\t}\n\t}\n\n\tisTriggerEntry(): boolean\n\t{\n\t\treturn this.type === TrackingEntry.TRIGGER_ACTIVITY_TYPE;\n\t}\n\n\tstatic getAllActivityTypes(): Array<number>\n\t{\n\t\treturn [\n\t\t\tTrackingEntry.UNKNOWN_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.EXECUTE_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.CLOSE_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.CANCEL_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.FAULT_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.CUSTOM_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.REPORT_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.ATTACHED_ENTITY_TYPE,\n\t\t\tTrackingEntry.TRIGGER_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.ERROR_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.DEBUG_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.DEBUG_AUTOMATION_TYPE,\n\t\t\tTrackingEntry.DEBUG_DESIGNER_TYPE,\n\t\t\tTrackingEntry.DEBUG_LINK_TYPE,\n\t\t];\n\t}\n\n\tstatic isKnownActivityType(typeId: number): boolean\n\t{\n\t\treturn TrackingEntry.getAllActivityTypes().includes(typeId);\n\t}\n\n\tstatic getAllWorkflowStatuses(): Array<number>\n\t{\n\t\treturn [\n\t\t\tWorkflowStatus.CREATED,\n\t\t\tWorkflowStatus.RUNNING,\n\t\t\tWorkflowStatus.COMPLETED,\n\t\t\tWorkflowStatus.SUSPENDED,\n\t\t\tWorkflowStatus.TERMINATED,\n\t\t];\n\t}\n\n\tstatic isKnownWorkflowStatus(statusId: number): boolean\n\t{\n\t\treturn TrackingEntry.getAllWorkflowStatuses().includes(statusId);\n\t}\n}","export class TrackingStatus\n{\n\tstatic WAITING = 0;\n\tstatic RUNNING = 1;\n\tstatic COMPLETED = 2;\n\tstatic AUTOCOMPLETED = 3;\n}","import {Type} from 'main.core';\nimport { TrackingEntry } from 'bizproc.automation';\nimport { TrackingStatus } from './types';\nimport {WorkflowStatus} from \"../workflow/types\";\n\nexport class RobotEntry\n{\n\tid: string = '';\n\tstatus: string = TrackingStatus.WAITING;\n\t// TODO - change string to Date when Date appear in TrackingEntry\n\tmodified: ?string = undefined;\n\tnotes: Array<string> = [];\n\terrors: Array<string> = [];\n\t#entryId: number = -1;\n\tworkflowStatus: number = WorkflowStatus.CREATED;\n\n\tconstructor(entries: ?Array<TrackingEntry>)\n\t{\n\t\tif (Type.isArray(entries))\n\t\t{\n\t\t\tfor (const entry of entries)\n\t\t\t{\n\t\t\t\tthis.addEntry(entry);\n\t\t\t}\n\t\t}\n\t}\n\n\taddEntry(entry: TrackingEntry)\n\t{\n\t\tthis.id = entry.name;\n\n\t\tif (this.#entryId < entry.id)\n\t\t{\n\t\t\tthis.#entryId = entry.id;\n\t\t\tthis.modified = entry.datetime;\n\t\t\tthis.workflowStatus = entry.workflowStatus;\n\n\t\t\tif (entry.type === TrackingEntry.CLOSE_ACTIVITY_TYPE)\n\t\t\t{\n\t\t\t\tthis.status = TrackingStatus.COMPLETED;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.status = TrackingStatus.RUNNING;\n\t\t\t}\n\t\t}\n\n\t\tif (entry.type === TrackingEntry.ERROR_ACTIVITY_TYPE)\n\t\t{\n\t\t\tthis.errors.push(entry.note);\n\t\t}\n\t\telse if (entry.type === TrackingEntry.CUSTOM_ACTIVITY_TYPE)\n\t\t{\n\t\t\tthis.notes.push(entry.note);\n\t\t}\n\t}\n}","import { TrackingEntry } from 'bizproc.automation';\nimport { TrackingStatus } from './types';\n\nexport class TriggerEntry\n{\n\tid: string = '';\n\tstatus: number = TrackingStatus.COMPLETED;\n\t// TODO - change string to Date when Date appear in TrackingEntry\n\tmodified: ?string = undefined;\n\n\tconstructor(entry: TrackingEntry)\n\t{\n\t\tif (entry.isTriggerEntry())\n\t\t{\n\t\t\tthis.id = entry.note;\n\t\t\tthis.modified = entry.datetime;\n\t\t}\n\t}\n}","import { Type } from 'main.core';\nimport { TrackingEntry } from './tracking-entry';\nimport { WorkflowStatus } from \"../workflow/types\";\n\nexport class TrackingEntryBuilder\n{\n\t#defaultSettings = {\n\t\tid: TrackingEntry.UNKNOWN_ACTIVITY_TYPE,\n\t\tworkflowId: '',\n\t\ttype: TrackingEntry.EXECUTE_ACTIVITY_TYPE,\n\t\tname: '',\n\t\ttitle: '',\n\t\tdatetime: '',\n\t\tnote: '',\n\t\tworkflowStatus: WorkflowStatus.CREATED,\n\t};\n\t#entrySettings: Object<string, string | number>;\n\n\tconstructor()\n\t{\n\t\tthis.#entrySettings = this.#defaultSettings;\n\t}\n\n\tsetLogEntry(logEntry: Object<string, any>): this\n\t{\n\t\tthis.#entrySettings = Object.assign({}, this.#defaultSettings);\n\t\tlogEntry = Object.assign({}, logEntry);\n\n\t\tif (Type.isStringFilled(logEntry['ID']))\n\t\t{\n\t\t\tlogEntry['ID'] = parseInt(logEntry['ID']);\n\t\t}\n\t\tif (Type.isStringFilled(logEntry['TYPE']))\n\t\t{\n\t\t\tlogEntry['TYPE'] = parseInt(logEntry['TYPE']);\n\t\t}\n\n\t\tif (Type.isNumber(logEntry['ID']))\n\t\t{\n\t\t\tthis.#entrySettings.id = logEntry['ID'];\n\t\t}\n\t\tif (Type.isStringFilled(logEntry['WORKFLOW_ID']))\n\t\t{\n\t\t\tthis.#entrySettings.workflowId = logEntry['WORKFLOW_ID'];\n\t\t}\n\t\tif (Type.isNumber(logEntry['TYPE']) && TrackingEntry.isKnownActivityType(logEntry['TYPE']))\n\t\t{\n\t\t\tthis.#entrySettings.type = logEntry['TYPE'];\n\t\t}\n\t\tif (Type.isStringFilled(logEntry['MODIFIED']))\n\t\t{\n\t\t\tthis.#entrySettings.datetime = logEntry['MODIFIED'];\n\t\t}\n\t\tif (Type.isNumber(logEntry['WORKFLOW_STATUS']) && TrackingEntry.isKnownWorkflowStatus(logEntry['WORKFLOW_STATUS']))\n\t\t{\n\t\t\tthis.#entrySettings.workflowStatus = logEntry['WORKFLOW_STATUS'];\n\t\t}\n\n\t\tthis.#entrySettings.name = String(logEntry['ACTION_NAME']);\n\t\tthis.#entrySettings.title = String(logEntry['ACTION_TITLE']);\n\t\tthis.#entrySettings.note = String(logEntry['ACTION_NOTE']);\n\n\t\treturn this;\n\t}\n\n\tsetStatus(status: string): this\n\t{\n\t\tthis.#entrySettings.status = status;\n\n\t\treturn this;\n\t}\n\n\tbuild(): TrackingEntry\n\t{\n\t\tconst entry = new TrackingEntry();\n\n\t\tentry.id = this.#entrySettings.id;\n\t\tentry.workflowId = this.#entrySettings.workflowId;\n\t\tentry.type = this.#entrySettings.type;\n\t\tentry.name = this.#entrySettings.name;\n\t\tentry.title = this.#entrySettings.title;\n\t\tentry.note = this.#entrySettings.note;\n\t\tentry.datetime = this.#entrySettings.datetime;\n\t\tentry.workflowStatus = this.#entrySettings.workflowStatus;\n\n\t\treturn entry;\n\t}\n}","import { Type } from 'main.core';\nimport { TrackingEntry } from './tracking-entry';\nimport { RobotEntry } from './robot-entry';\nimport { TriggerEntry } from './trigger-entry';\nimport { TrackingEntryBuilder } from './tracking-entry-builder';\nimport { Document } from 'bizproc.automation';\nimport { TrackingStatus } from './types';\nimport { WorkflowStatus } from \"../workflow/types\";\n\nexport {\n\tRobotEntry,\n\tTriggerEntry,\n\tTrackingEntryBuilder,\n\tTrackingEntry,\n\tTrackingStatus,\n}\n\nexport class Tracker\n{\n\t#ajaxUrl: string;\n\t#document: ?Document;\n\n\t#triggerLogs: Object<string, TrackingEntry>;\n\t#robotLogs: Object<string, RobotEntry>;\n\n\tconstructor(document: ?Document, ajaxUrl: string)\n\t{\n\t\tthis.#ajaxUrl = ajaxUrl;\n\t\tthis.#document = document;\n\t}\n\n\tinit(log)\n\t{\n\t\tthis.#triggerLogs = {};\n\t\tthis.#robotLogs = {};\n\n\t\tthis.addLogs(log);\n\t}\n\n\treInit(log)\n\t{\n\t\tthis.init(log);\n\t}\n\n\taddLogs(log: Object<string, Array<Object<string, any>>>)\n\t{\n\t\tif (!Type.isPlainObject(log))\n\t\t{\n\t\t\tlog = {};\n\t\t}\n\n\t\tconst logEntryBuilder = new TrackingEntryBuilder();\n\n\t\tfor (const [statusId, entries] of Object.entries(log))\n\t\t{\n\t\t\tif (!Type.isArray(entries))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (const rawEntry of entries)\n\t\t\t{\n\t\t\t\tconst entry = logEntryBuilder.setLogEntry(rawEntry).build();\n\n\t\t\t\tif (entry.isTriggerEntry())\n\t\t\t\t{\n\t\t\t\t\tthis.addTriggerEntry(entry);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.addRobotEntry(entry);\n\t\t\t\t\tconst robotEntry = this.#robotLogs[entry.name];\n\n\t\t\t\t\tif (!Type.isNil(this.#document))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst isRobotRunning = (robotEntry.status === TrackingStatus.RUNNING);\n\t\t\t\t\t\tconst isWorkflowCompleted =\n\t\t\t\t\t\t\t(robotEntry.workflowStatus === WorkflowStatus.COMPLETED)\n\t\t\t\t\t\t;\n\t\t\t\t\t\tconst isCurrentStatus = (this.#document.getCurrentStatusId() === statusId);\n\n\t\t\t\t\t\tconst isRobotRunningAtAnotherStatus = isRobotRunning && !isCurrentStatus;\n\t\t\t\t\t\tconst isRobotRunningAndCurrentWorkflowCompleted =\n\t\t\t\t\t\t\tisRobotRunning && isWorkflowCompleted && isCurrentStatus\n\t\t\t\t\t\t;\n\n\t\t\t\t\t\tif (isRobotRunningAtAnotherStatus || isRobotRunningAndCurrentWorkflowCompleted)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trobotEntry.status = TrackingStatus.COMPLETED;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\taddTriggerEntry(entry: TrackingEntry)\n\t{\n\t\tif (entry.isTriggerEntry())\n\t\t{\n\t\t\tthis.#triggerLogs[entry.note] = new TriggerEntry(entry);\n\t\t}\n\t}\n\n\taddRobotEntry(entry: TrackingEntry)\n\t{\n\t\tif (entry.isTriggerEntry())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#robotLogs[entry.name])\n\t\t{\n\t\t\tthis.#robotLogs[entry.name] = new RobotEntry([entry]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#robotLogs[entry.name].addEntry(entry);\n\t\t}\n\t}\n\n\tgetRobotLog(id: string): ?RobotEntry\n\t{\n\t\treturn this.#robotLogs[id] || null;\n\t}\n\n\tgetTriggerLog(id: string): ?TriggerEntry\n\t{\n\t\treturn this.#triggerLogs[id] || null;\n\t}\n\n\tupdate(documentSigned: string)\n\t{\n\t\treturn BX.ajax({\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\turl: this.#ajaxUrl,\n\t\t\tdata: {\n\t\t\t\tajax_action: 'get_log',\n\t\t\t\tdocument_signed: documentSigned\n\t\t\t},\n\t\t\tonsuccess: (response) => {\n\t\t\t\tif (response.DATA && response.DATA.LOG)\n\t\t\t\t{\n\t\t\t\t\tthis.reInit(response.DATA.LOG);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n","import { Dom, Type, Event, Text, Loc, Runtime } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Document } from './document/document';\nimport { Template } from './template';\nimport { DelayInterval } from './delay-interval';\nimport { ViewMode } from './view-mode';\nimport { HelpHint } from './help-hint';\nimport { ConditionGroup, Helper } from 'bizproc.automation';\nimport { Tracker } from './tracker/tracker'\nimport { TrackingStatus } from './tracker/types';\n\nexport class Robot extends EventEmitter\n{\n\tSYSTEM_EXPRESSION_PATTERN = '\\\\{=\\\\s*(?<object>[a-z0-9_]+)\\\\s*\\\\:\\\\s*(?<field>[a-z0-9_\\\\.]+)(\\\\s*>\\\\s*(?<mod1>[a-z0-9_\\\\:]+)(\\\\s*,\\\\s*(?<mod2>[a-z0-9_]+))?)?\\\\s*\\\\}';\n\n\t#data: Object<string, any>;\n\t#document: Document;\n\t#template: ?Template;\n\t#tracker: ?Object;\n\t#delay: DelayInterval;\n\t#node: HTMLElement;\n\t#condition: ConditionGroup;\n\t#isDraft: boolean;\n\n\t#isFrameMode: boolean;\n\t#viewMode: ViewMode;\n\n\tconstructor(params: {\n\t\tdocument: Document,\n\t\ttemplate: ?Template,\n\t\tisFrameMode: boolean,\n\t\ttracker: Tracker,\n\t})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Automation');\n\n\t\tthis.#document = params.document;\n\t\tif (!Type.isNil(params.template))\n\t\t{\n\t\t\tthis.#template = params.template;\n\t\t}\n\t\tthis.#isFrameMode = params.isFrameMode;\n\t\tthis.#viewMode = ViewMode.none();\n\t\tthis.#tracker = params.tracker;\n\t\tthis.#isDraft = false;\n\n\t\tthis.#delay = new DelayInterval();\n\t}\n\n\tget node()\n\t{\n\t\treturn this.#node;\n\t}\n\n\tget data()\n\t{\n\t\treturn {\n\t\t\t...this.#data,\n\t\t\tCondition: this.#condition.serialize(),\n\t\t\tDelay: this.#delay.serialize(),\n\t\t};\n\t}\n\n\tget draft()\n\t{\n\t\treturn this.#isDraft;\n\t}\n\n\tset draft(draft: boolean)\n\t{\n\t\tthis.#isDraft = draft;\n\t}\n\n\tget template()\n\t{\n\t\treturn this.#template;\n\t}\n\n\thasTemplate(): boolean\n\t{\n\t\treturn !Type.isNil(this.#template);\n\t}\n\n\tgetTemplate(): ?Template\n\t{\n\t\treturn this.#template;\n\t}\n\n\tgetDocument(): Document\n\t{\n\t\treturn this.#document;\n\t}\n\n\tstatic generateName(): string\n\t{\n\t\treturn (\n\t\t\t'A' + parseInt(Math.random() * 100000)\n\t\t\t+ '_' + parseInt(Math.random() * 100000)\n\t\t\t+ '_' + parseInt(Math.random() * 100000)\n\t\t\t+ '_' + parseInt(Math.random() * 100000)\n\t\t);\n\t}\n\n\tclone(): Robot\n\t{\n\t\tconst clonedRobot = new Robot({\n\t\t\tdocument: this.#document,\n\t\t\ttemplate: this.#template,\n\t\t\tisFrameMode: this.#isFrameMode,\n\t\t\ttracker: this.#tracker,\n\t\t});\n\n\t\tconst robotData = {\n\t\t\t...BX.clone(this.#data),\n\t\t\tName: Robot.generateName(),\n\t\t\tDelay: this.getDelayInterval().serialize(),\n\t\t\tCondition: this.getCondition().serialize(),\n\t\t};\n\t\tclonedRobot.init(robotData, this.#viewMode);\n\n\t\treturn clonedRobot;\n\t}\n\n\tisEqual(other: Robot): boolean\n\t{\n\t\treturn this.#data.Name === other.#data.Name;\n\t}\n\n\tinit(data: Object, viewMode: ?ViewMode): void\n\t{\n\t\tif (Type.isPlainObject(data))\n\t\t{\n\t\t\tthis.#data = Object.assign({}, data);\n\t\t}\n\t\tif (!this.#data.Name)\n\t\t{\n\t\t\tthis.#data.Name = Robot.generateName();\n\t\t}\n\n\t\tthis.#delay = new DelayInterval(this.#data.Delay);\n\t\tthis.#condition = new ConditionGroup(this.#data.Condition);\n\t\tif (!this.#data.Condition)\n\t\t{\n\t\t\tthis.#condition.type = ConditionGroup.CONDITION_TYPE.Mixed;\n\t\t}\n\n\t\tdelete this.#data.Condition;\n\t\tdelete this.#data.Delay;\n\n\t\tthis.#viewMode = Type.isNil(viewMode) ? ViewMode.edit() : viewMode;\n\t\tif (!this.#viewMode.isNone())\n\t\t{\n\t\t\tthis.#node = this.createNode();\n\t\t}\n\t}\n\n\treInit(data: Object, viewMode: ?ViewMode): void\n\t{\n\t\tif (Type.isNil(viewMode) && this.#viewMode.isNone())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst node = this.#node;\n\t\tthis.#node = this.createNode();\n\t\tif (node.parentNode)\n\t\t{\n\t\t\tnode.parentNode.replaceChild(this.#node, node);\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tDom.remove(this.#node);\n\t\tthis.emit('Robot:destroyed');\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.#template.canEdit();\n\t}\n\n\tgetProperties(): Object\n\t{\n\t\tif (this.#data && Type.isPlainObject(this.#data.Properties))\n\t\t{\n\t\t\treturn this.#data.Properties;\n\t\t}\n\n\t\treturn {};\n\t}\n\n\tgetProperty(name: string): ?Object\n\t{\n\t\treturn this.getProperties()[name] || null;\n\t}\n\n\thasProperty(name: string): boolean\n\t{\n\t\treturn this.getProperties().hasOwnProperty(name);\n\t}\n\n\tsetProperty(name: string, value: any): Robot\n\t{\n\t\tthis.#data.Properties[name] = value;\n\n\t\treturn this;\n\t}\n\n\tgetId(): ?string\n\t{\n\t\treturn this.#data.Name || null;\n\t}\n\n\tgetLogStatus(): number\n\t{\n\t\tlet status = TrackingStatus.WAITING;\n\t\tlet log = this.#tracker.getRobotLog(this.getId());\n\n\t\tif (log)\n\t\t{\n\t\t\tstatus = log.status;\n\t\t}\n\t\telse if (this.#data.DelayName)\n\t\t{\n\t\t\tlog = this.#tracker.getRobotLog(this.#data.DelayName);\n\t\t\tif (log && log.status === TrackingStatus.RUNNING)\n\t\t\t{\n\t\t\t\tstatus = TrackingStatus.RUNNING;\n\t\t\t}\n\t\t}\n\n\t\treturn status;\n\t}\n\n\tgetLogErrors(): Array<string>\n\t{\n\t\tlet errors = [];\n\t\tconst log = this.#tracker.getRobotLog(this.getId());\n\t\tif (log && log.errors)\n\t\t{\n\t\t\terrors = log.errors;\n\t\t}\n\n\t\treturn errors;\n\t}\n\n\tgetDelayNotes(): Array<string>\n\t{\n\t\tif (this.#data.DelayName)\n\t\t{\n\t\t\tconst log = this.#tracker.getRobotLog(this.#data.DelayName);\n\t\t\tif (log && log.status === TrackingStatus.RUNNING)\n\t\t\t{\n\t\t\t\treturn log.notes;\n\t\t\t}\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tselectNode(): void\n\t{\n\t\tif (this.#node)\n\t\t{\n\t\t\tDom.addClass(this.#node, '--selected');\n\t\t\tthis.emit('Robot:selected');\n\t\t}\n\t}\n\n\tunselectNode()\n\t{\n\t\tif (this.#node)\n\t\t{\n\t\t\tDom.removeClass(this.#node, '--selected');\n\t\t\tthis.emit('Robot:unselected');\n\t\t}\n\t}\n\n\tisSelected()\n\t{\n\t\treturn this.#node && Dom.hasClass(this.#node, '--selected');\n\t}\n\n\tenableManageMode(isActive: boolean)\n\t{\n\t\tthis.#viewMode = ViewMode.manage().setProperty('isActive', isActive);\n\n\t\tif (!isActive)\n\t\t{\n\t\t\tDom.addClass(this.#node, '--locked-node');\n\t\t}\n\n\t\tconst deleteButton = this.#node.querySelector('.bizproc-automation-robot-btn-delete');\n\t\tDom.hide(deleteButton);\n\n\t\tthis.#node.onclick = () => {\n\t\t\tif (!this.#viewMode.isManage() || !this.#viewMode.getProperty('isActive', false))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.isSelected())\n\t\t\t{\n\t\t\t\tthis.selectNode();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.unselectNode();\n\t\t\t}\n\t\t};\n\t}\n\n\tdisableManageMode()\n\t{\n\t\tthis.#viewMode = ViewMode.edit();\n\t\tthis.unselectNode();\n\t\tDom.removeClass(this.#node, '--locked-node');\n\n\t\tconst deleteButton = this.#node.querySelector('.bizproc-automation-robot-btn-delete');\n\t\tDom.show(deleteButton);\n\n\t\tthis.#node.onclick = undefined;\n\t}\n\n\tcreateNode(): HTMLElement\n\t{\n\t\tlet wrapperClass = 'bizproc-automation-robot-container-wrapper';\n\t\tlet containerClass = 'bizproc-automation-robot-container';\n\n\t\tif (this.#viewMode.isEdit() && this.canEdit())\n\t\t{\n\t\t\twrapperClass += ' bizproc-automation-robot-container-wrapper-draggable';\n\t\t}\n\t\tif (this.draft)\n\t\t{\n\t\t\tcontainerClass += ' --draft';\n\t\t}\n\n\t\tconst targetLabel = Loc.getMessage('BIZPROC_AUTOMATION_CMP_TO');\n\t\tconst targetNode = Dom.create(\"a\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-robot-settings-name \" + (this.#viewMode.isView() ? '--mode-view' : ''),\n\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_AUTOMATICALLY')\n\t\t\t},\n\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_AUTOMATICALLY')\n\t\t});\n\n\t\tif (Type.isPlainObject(this.#data.viewData) && this.#data.viewData.responsibleLabel)\n\t\t{\n\t\t\tlet labelText =\n\t\t\t\tthis.#data.viewData.responsibleLabel\n\t\t\t\t\t.replace('{=Document:ASSIGNED_BY_ID}', Loc.getMessage('BIZPROC_AUTOMATION_CMP_RESPONSIBLE'))\n\t\t\t\t\t.replace('author', Loc.getMessage('BIZPROC_AUTOMATION_CMP_RESPONSIBLE'))\n\t\t\t\t\t.replace(/\\{=Constant\\:Constant[0-9]+\\}/, Loc.getMessage('BIZPROC_AUTOMATION_ASK_CONSTANT'))\n\t\t\t\t\t.replace(/\\{\\{~&\\:Constant[0-9]+\\}\\}/, Loc.getMessage('BIZPROC_AUTOMATION_ASK_CONSTANT'))\n\t\t\t\t\t.replace(/\\{=Template\\:Parameter[0-9]+\\}/, Loc.getMessage('BIZPROC_AUTOMATION_ASK_PARAMETER'))\n\t\t\t\t\t.replace(/\\{\\{~&:\\:Parameter[0-9]+\\}\\}/, Loc.getMessage('BIZPROC_AUTOMATION_ASK_PARAMETER'))\n\t\t\t;\n\n\t\t\tif (labelText.indexOf('{=Document') >= 0)\n\t\t\t{\n\t\t\t\tthis.#document.getFields().forEach(field => {\n\t\t\t\t\tlabelText = labelText.replace(field['SystemExpression'], field['Name']);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (labelText.indexOf('{=A') >= 0)\n\t\t\t{\n\t\t\t\tthis.#template.robots.forEach(robot => {\n\t\t\t\t\trobot.getReturnFieldsDescription().forEach(field => {\n\t\t\t\t\t\tif (field['Type'] === 'user')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabelText = labelText.replace(\n\t\t\t\t\t\t\t\tfield['SystemExpression'],\n\t\t\t\t\t\t\t\trobot.getTitle() + ': ' + field['Name']\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (labelText.indexOf('{=GlobalVar:') >= 0 && Type.isArrayFilled(this.#template.globalVariables))\n\t\t\t{\n\t\t\t\tthis.#template.globalVariables.forEach(variable => {\n\t\t\t\t\tlabelText = labelText.replace(variable.SystemExpression, variable.Name);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (labelText.indexOf('{=GlobalConst:') >= 0 && Type.isArrayFilled(this.#template.globalConstants))\n\t\t\t{\n\t\t\t\tthis.#template.globalConstants.forEach(constant => {\n\t\t\t\t\tlabelText = labelText.replace(constant.SystemExpression, constant.Name);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttargetNode.textContent = labelText;\n\t\t\ttargetNode.setAttribute('title', labelText);\n\n\t\t\tif (this.#data.viewData.responsibleUrl)\n\t\t\t{\n\t\t\t\ttargetNode.href = this.#data.viewData.responsibleUrl;\n\t\t\t\tif (this.#isFrameMode)\n\t\t\t\t{\n\t\t\t\t\ttargetNode.setAttribute('target', '_blank');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.#viewMode.isEdit() && parseInt(this.#data.viewData.responsibleId) > 0)\n\t\t\t{\n\t\t\t\ttargetNode.setAttribute('bx-tooltip-user-id', this.#data.viewData.responsibleId);\n\t\t\t}\n\t\t}\n\n\t\tlet delayLabel = this.getDelayInterval().format(\n\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_AT_ONCE'),\n\t\t\tthis.#document.getFields()\n\t\t);\n\n\t\tif (this.isExecuteAfterPrevious())\n\t\t{\n\t\t\tdelayLabel = (delayLabel !== Loc.getMessage('BIZPROC_AUTOMATION_CMP_AT_ONCE')) ? delayLabel + ', ' : '';\n\t\t\tdelayLabel += Loc.getMessage('BIZPROC_AUTOMATION_CMP_AFTER_PREVIOUS');\n\t\t}\n\n\t\tif (this.getCondition().items.length > 0)\n\t\t{\n\t\t\tdelayLabel += ', ' + Loc.getMessage('BIZPROC_AUTOMATION_CMP_BY_CONDITION');\n\t\t}\n\n\t\tconst delayNode = Dom.create(\n\t\t\tthis.#viewMode.isEdit() ? \"a\" : \"span\",\n\t\t\t{\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: this.#viewMode.isEdit() ? 'bizproc-automation-robot-link' : 'bizproc-automation-robot-text',\n\t\t\t\t\ttitle: delayLabel\n\t\t\t\t},\n\t\t\t\ttext: delayLabel,\n\t\t\t}\n\t\t);\n\n\t\tconst statusNode = Dom.create(\"div\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-robot-information\"\n\t\t\t}\n\t\t});\n\t\tthis.subscribeOnce('Robot:destroyed', () => {\n\t\t\tif (HelpHint.isBindedToNode(statusNode))\n\t\t\t{\n\t\t\t\tHelpHint.hideHint();\n\t\t\t}\n\t\t})\n\n\t\tswitch (this.getLogStatus())\n\t\t{\n\t\t\tcase TrackingStatus.RUNNING:\n\t\t\t\tif (this.#document.getCurrentStatusId() === this.#template.getStatusId())\n\t\t\t\t{\n\t\t\t\t\tstatusNode.classList.add('--loader');\n\n\t\t\t\t\tconst delayNotes = this.getDelayNotes();\n\t\t\t\t\tif (delayNotes.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tstatusNode.setAttribute('data-text', delayNotes.join('\\n'));\n\t\t\t\t\t\tHelpHint.bindToNode(statusNode);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase TrackingStatus.COMPLETED:\n\t\t\tcase TrackingStatus.AUTOCOMPLETED:\n\t\t\t\tcontainerClass += ' --complete';\n\t\t\t\tstatusNode.classList.add('--complete');\n\t\t\t\tbreak;\n\t\t}\n\n\t\tconst errors = this.getLogErrors();\n\t\tif (errors.length > 0)\n\t\t{\n\t\t\tstatusNode.classList.add('--errors');\n\t\t\tstatusNode.setAttribute('data-text', errors.join('\\n'));\n\t\t\tHelpHint.bindToNode(statusNode);\n\t\t}\n\n\t\tlet titleClassName = 'bizproc-automation-robot-title-text';\n\t\tif (this.#viewMode.isEdit() && this.canEdit())\n\t\t{\n\t\t\ttitleClassName += ' bizproc-automation-robot-title-text-editable';\n\t\t}\n\n\t\tconst div = Dom.create(\"div\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: containerClass,\n\t\t\t\t'data-role': 'robot-container',\n\t\t\t\t'data-type': 'item-robot',\n\t\t\t\t'data-id': this.getId()\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bizproc-automation-robot-container-checkbox\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: wrapperClass\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tattrs: { className: \"bizproc-automation-robot-deadline\" },\n\t\t\t\t\t\t\tchildren: [delayNode]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\tclassName: \"bizproc-automation-robot-title\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\tclassName: titleClassName,\n\t\t\t\t\t\t\t\t\t\ttitle: this.getTitle(),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\thtml: this.clipTitle(this.getTitle()),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: event => {\n\t\t\t\t\t\t\t\t\t\t\tif (this.#viewMode.isEdit() && this.canEdit() && !this.#viewMode.isManage())\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tthis.onTitleEditClick(event);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tattrs: { className: \"bizproc-automation-robot-settings\" },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tattrs: { className: \"bizproc-automation-robot-settings-title\" },\n\t\t\t\t\t\t\t\t\ttext: targetLabel + ':'\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\ttargetNode\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tstatusNode,\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.registerItem(div);\n\t\t}\n\n\t\tif (this.#viewMode.isEdit())\n\t\t{\n\t\t\tconst deleteBtn = Dom.create('SPAN', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'bizproc-automation-robot-btn-delete'\n\t\t\t\t}\n\t\t\t});\n\t\t\tEvent.bind(deleteBtn, 'click', this.onDeleteButtonClick.bind(this, deleteBtn));\n\t\t\tdiv.lastChild.appendChild(deleteBtn);\n\n\t\t\tconst copyBtn = Dom.create('div', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'bizproc-automation-robot-btn-copy'\n\t\t\t\t},\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_COPY') || 'copy'\n\t\t\t});\n\t\t\tEvent.bind(copyBtn, 'click', this.onCopyButtonClick.bind(this, copyBtn));\n\t\t\tdiv.appendChild(copyBtn);\n\n\t\t\tconst settingsBtn = Dom.create('div', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'bizproc-automation-robot-btn-settings'\n\t\t\t\t},\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_EDIT')\n\t\t\t});\n\t\t\tEvent.bind(div, 'click', this.onSettingsButtonClick.bind(this, div));\n\n\t\t\tdiv.appendChild(settingsBtn);\n\t\t}\n\n\t\treturn div;\n\t}\n\n\tonDeleteButtonClick(button, event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\t\t}\n\t\telse if (!this.#viewMode.isManage())\n\t\t{\n\t\t\tDom.remove(this.#node);\n\t\t\tthis.#template.deleteRobot(this);\n\t\t}\n\t}\n\n\tonSettingsButtonClick(button)\n\t{\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\t\t}\n\t\telse if (!this.#viewMode.isManage())\n\t\t{\n\t\t\tthis.#template.openRobotSettingsDialog(this, this.#data.DialogContext ?? null);\n\t\t}\n\t}\n\n\tonCopyButtonClick(button, event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\t\t}\n\t\telse if (!this.#viewMode.isManage())\n\t\t{\n\t\t\tconst copiedRobot = this.clone();\n\t\t\tconst robotTitle = copiedRobot.getProperty('Title');\n\t\t\tif (!Type.isNil(robotTitle))\n\t\t\t{\n\t\t\t\tconst newTitle = robotTitle + ' ' + ' ' + Loc.getMessage('BIZPROC_AUTOMATION_CMP_COPY_CAPTION');\n\t\t\t\tcopiedRobot.setProperty('Title', newTitle);\n\t\t\t\tcopiedRobot.reInit();\n\t\t\t}\n\n\t\t\tTemplate.copyRobotTo(this.#template, copiedRobot, this.#template.getNextRobot(this));\n\t\t}\n\t}\n\n\tonTitleEditClick(e)\n\t{\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tconst formName = 'bizproc_automation_robot_title_dialog';\n\n\t\tconst form = Dom.create('form', {\n\t\t\tprops: {\n\t\t\t\tname: formName\n\t\t\t},\n\t\t\tstyle: {\"min-width\": '540px'}\n\t\t});\n\n\t\tform.appendChild(Dom.create(\"span\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete\" },\n\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_ROBOT_NAME') + ':'\n\t\t}));\n\n\t\tform.appendChild(Dom.create(\"div\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings\" },\n\t\t\tchildren: [BX.create(\"input\", {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'bizproc-automation-popup-input',\n\t\t\t\t\ttype: \"text\",\n\t\t\t\t\tname: \"name\",\n\t\t\t\t\tvalue: this.getTitle()\n\t\t\t\t}\n\t\t\t})]\n\t\t}));\n\n\t\tthis.emit('Robot:title:editStart');\n\n\t\tconst self = this;\n\t\tconst popup = new BX.PopupWindow(Helper.generateUniqueId(), null, {\n\t\t\ttitleBar: Loc.getMessage('BIZPROC_AUTOMATION_CMP_ROBOT_NAME'),\n\t\t\tcontent: form,\n\t\t\tcloseIcon: true,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: true,\n\t\t\tdraggable: {restrict: false},\n\t\t\toverlay: false,\n\t\t\tevents: {\n\t\t\t\tonPopupClose(popup)\n\t\t\t\t{\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t\tself.emit('Robot:title:editCompleted');\n\t\t\t\t}\n\t\t\t},\n\t\t\tbuttons: [\n\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\ttext : Loc.getMessage('JS_CORE_WINDOW_SAVE'),\n\t\t\t\t\tclassName : \"popup-window-button-accept\",\n\t\t\t\t\tevents : {\n\t\t\t\t\t\tclick()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst nameNode = form.elements.name;\n\t\t\t\t\t\t\tself.setProperty('Title', nameNode.value);\n\t\t\t\t\t\t\tself.reInit();\n\t\t\t\t\t\t\tself.#template.markModified();\n\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.PopupWindowButtonLink({\n\t\t\t\t\ttext : Loc.getMessage('JS_CORE_WINDOW_CANCEL'),\n\t\t\t\t\tclassName : \"popup-window-button-link-cancel\",\n\t\t\t\t\tevents : {\n\t\t\t\t\t\tclick()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.popupWindow.close()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tpopup.show();\n\t}\n\n\tonSearch(event)\n\t{\n\t\tif (!this.#node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst query = event.getData().queryString;\n\t\tconst match = !query || this.getTitle().toLowerCase().indexOf(query) >= 0;\n\n\t\tif (match)\n\t\t{\n\t\t\tDom.removeClass(this.#node, '--search-mismatch');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.#node, '--search-mismatch');\n\t\t}\n\t}\n\n\tclipTitle(fullTitle: string)\n\t{\n\t\tlet title = Text.encode(fullTitle);\n\t\tconst arrTitle = title.split(\" \");\n\t\tconst lastWord = \"<span>\" + arrTitle[arrTitle.length - 1] + \"</span>\";\n\n\t\tarrTitle.splice(arrTitle.length - 1);\n\n\t\ttitle = arrTitle.join(\" \") + \" \" + lastWord;\n\n\t\treturn title;\n\t}\n\n\tupdateData(data)\n\t{\n\t\tif (Type.isPlainObject(data))\n\t\t{\n\t\t\tthis.#data = data;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow 'Invalid data';\n\t\t}\n\t}\n\n\tserialize()\n\t{\n\t\tconst result = BX.clone(this.#data);\n\t\tdelete result['viewData'];\n\t\tdelete result['DialogContext'];\n\t\tresult.Delay = this.#delay.serialize();\n\t\tresult.Condition = this.#condition.serialize();\n\n\t\treturn result;\n\t}\n\n\tgetDelayInterval(): DelayInterval\n\t{\n\t\treturn this.#delay;\n\t}\n\n\tsetDelayInterval(delay): Robot\n\t{\n\t\tthis.#delay = delay;\n\n\t\treturn this;\n\t}\n\n\tgetCondition(): ConditionGroup\n\t{\n\t\treturn this.#condition;\n\t}\n\n\tsetCondition(condition)\n\t{\n\t\tthis.#condition = condition;\n\n\t\treturn this;\n\t}\n\n\tsetExecuteAfterPrevious(flag)\n\t{\n\t\tthis.#data.ExecuteAfterPrevious = flag ? 1 : 0;\n\n\t\treturn this;\n\t}\n\n\tisExecuteAfterPrevious()\n\t{\n\t\treturn (this.#data.ExecuteAfterPrevious === 1 || this.#data.ExecuteAfterPrevious === '1')\n\t}\n\n\tregisterItem(object)\n\t{\n\t\tif (Type.isNil(object[\"__bxddid\"]))\n\t\t{\n\t\t\tobject.onbxdragstart = BX.proxy(this.dragStart, this);\n\t\t\tobject.onbxdrag = BX.proxy(this.dragMove, this);\n\t\t\tobject.onbxdragstop = BX.proxy(this.dragStop, this);\n\t\t\tobject.onbxdraghover = BX.proxy(this.dragOver, this);\n\t\t\tjsDD.registerObject(object);\n\t\t\tjsDD.registerDest(object, 1);\n\t\t}\n\t}\n\n\tunregisterItem(object)\n\t{\n\t\tobject.onbxdragstart = undefined;\n\t\tobject.onbxdrag = undefined;\n\t\tobject.onbxdragstop = undefined;\n\t\tobject.onbxdraghover = undefined;\n\t\tjsDD.unregisterObject(object);\n\t\tjsDD.unregisterDest(object);\n\t}\n\n\tdragStart()\n\t{\n\t\tthis.draggableItem = BX.proxy_context;\n\n\t\tif (!this.draggableItem)\n\t\t{\n\t\t\tjsDD.stopCurrentDrag();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.stub)\n\t\t{\n\t\t\tconst itemWidth = this.draggableItem.offsetWidth;\n\t\t\tthis.stub = this.draggableItem.cloneNode(true);\n\t\t\tthis.stub.style.position = \"absolute\";\n\t\t\tthis.stub.classList.add(\"bizproc-automation-robot-container-drag\");\n\t\t\tthis.stub.style.width = itemWidth + \"px\";\n\t\t\tdocument.body.appendChild(this.stub);\n\t\t}\n\t}\n\n\tdragMove(x,y)\n\t{\n\t\tthis.stub.style.left = x + \"px\";\n\t\tthis.stub.style.top = y + \"px\";\n\t}\n\n\tdragOver(destination, x, y)\n\t{\n\t\tif (this.droppableItem)\n\t\t{\n\t\t\tthis.droppableItem.classList.remove(\"bizproc-automation-robot-container-pre\");\n\t\t}\n\n\t\tif (this.droppableColumn)\n\t\t{\n\t\t\tthis.droppableColumn.classList.remove(\"bizproc-automation-robot-list-pre\");\n\t\t}\n\n\t\tconst type = destination.getAttribute(\"data-type\");\n\n\t\tif (type === \"item-robot\")\n\t\t{\n\t\t\tthis.droppableItem = destination;\n\t\t\tthis.droppableColumn = null;\n\t\t}\n\n\t\tif (type === \"column-robot\")\n\t\t{\n\t\t\tthis.droppableColumn = destination.querySelector('[data-role=\"robot-list\"]');\n\t\t\tthis.droppableItem = null;\n\t\t}\n\n\t\tif (this.droppableItem)\n\t\t{\n\t\t\tthis.droppableItem.classList.add(\"bizproc-automation-robot-container-pre\");\n\t\t}\n\n\t\tif (this.droppableColumn)\n\t\t{\n\t\t\tthis.droppableColumn.classList.add(\"bizproc-automation-robot-list-pre\");\n\t\t}\n\t}\n\n\tdragStop(x, y, event)\n\t{\n\t\tevent = event || window.event;\n\t\tconst isCopy = event && (event.ctrlKey || event.metaKey);\n\n\t\tif (this.draggableItem)\n\t\t{\n\t\t\tif (this.droppableItem)\n\t\t\t{\n\t\t\t\tthis.droppableItem.classList.remove(\"bizproc-automation-robot-container-pre\");\n\t\t\t\tthis.emit('Robot:manage', {\n\t\t\t\t\ttemplateNode: this.droppableItem.parentNode,\n\t\t\t\t\tisCopy,\n\t\t\t\t\tdroppableItem: this.droppableItem,\n\t\t\t\t\trobot: this,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (this.droppableColumn)\n\t\t\t{\n\t\t\t\tthis.droppableColumn.classList.remove(\"bizproc-automation-robot-list-pre\");\n\t\t\t\tthis.emit('Robot:manage', {\n\t\t\t\t\ttemplateNode: this.droppableColumn,\n\t\t\t\t\tisCopy,\n\t\t\t\t\trobot: this,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.stub.parentNode.removeChild(this.stub);\n\t\tthis.stub = null;\n\t\tthis.draggableItem = null;\n\t\tthis.droppableItem = null;\n\t}\n\n\tmoveTo(template, beforeRobot)\n\t{\n\t\tDom.remove(this.#node);\n\t\tthis.#template.deleteRobot(this);\n\t\tthis.#template = template;\n\n\t\tthis.#template.insertRobot(this, beforeRobot);\n\t\tthis.#node = this.createNode();\n\t\tthis.#template.insertRobotNode(this.#node, beforeRobot ? beforeRobot.node : null);\n\t}\n\n\tcopyTo(template, beforeRobot)\n\t{\n\t\tconst robot = new Robot({\n\t\t\tdocument: this.#document,\n\t\t\ttemplate,\n\t\t\tisFrameMode: this.#isFrameMode,\n\t\t\ttracker: this.#tracker,\n\t\t});\n\n\t\tconst robotData = this.serialize();\n\t\tdelete robotData['Name'];\n\t\tdelete robotData['DelayName'];\n\n\t\trobot.init(robotData, this.#viewMode);\n\n\t\ttemplate.insertRobot(robot, beforeRobot);\n\t\ttemplate.insertRobotNode(robot.node, beforeRobot ? beforeRobot.node : null);\n\n\t\treturn robot;\n\t}\n\n\tgetTitle()\n\t{\n\t\treturn this.getProperty('Title') || this.getDescriptionTitle();\n\t}\n\n\tgetDescriptionTitle()\n\t{\n\t\tlet name = 'untitled';\n\t\tconst description = this.template?.getRobotDescription(this.#data['Type']) ?? {};\n\t\tif (description['NAME'])\n\t\t{\n\t\t\tname = description['NAME'];\n\t\t}\n\t\tif (description['ROBOT_SETTINGS'] && description['ROBOT_SETTINGS']['TITLE'])\n\t\t{\n\t\t\tname = description['ROBOT_SETTINGS']['TITLE'];\n\t\t}\n\n\t\treturn name;\n\t}\n\n\thasTitle(): boolean\n\t{\n\t\treturn this.getTitle() !== 'untitled';\n\t}\n\n\thasReturnFields(): boolean\n\t{\n\t\tconst description = this.template.getRobotDescription(this.#data['Type']);\n\t\tconst props = this.#data['Properties'];\n\n\t\tif (!Type.isObject(description))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst hasReturnProperties = () => (\n\t\t\tType.isObject(description['RETURN'])\n\t\t\t&& Type.isArrayFilled(Object.values(description['RETURN']))\n\t\t);\n\n\t\tconst hasAdditionalResultProperties = () => (\n\t\t\tType.isArray(description['ADDITIONAL_RESULT'])\n\t\t\t&& description['ADDITIONAL_RESULT'].some(addProperty => Object.values(props[addProperty] ?? []).length > 0)\n\t\t);\n\n\t\treturn hasReturnProperties() || hasAdditionalResultProperties();\n\t}\n\n\tgetReturnFieldsDescription()\n\t{\n\t\tconst fields = [];\n\t\tconst description = this.template.getRobotDescription(this.#data['Type']);\n\n\t\tif (description && description['RETURN'])\n\t\t{\n\t\t\tfor (const fieldId in description['RETURN'])\n\t\t\t{\n\t\t\t\tif (description['RETURN'].hasOwnProperty(fieldId))\n\t\t\t\t{\n\t\t\t\t\tconst field = description['RETURN'][fieldId];\n\t\t\t\t\tfields.push({\n\t\t\t\t\t\tId: fieldId,\n\t\t\t\t\t\tObjectId: this.getId(),\n\t\t\t\t\t\tObjectName: this.getTitle(),\n\t\t\t\t\t\tName: field['NAME'],\n\t\t\t\t\t\tType: field['TYPE'],\n\t\t\t\t\t\tOptions: field['OPTIONS'] || null,\n\t\t\t\t\t\tExpression: '{{~'+this.getId()+':'+fieldId+' # '+this.getTitle()+': '+field['NAME']+'}}',\n\t\t\t\t\t\tSystemExpression: '{='+this.getId()+':'+fieldId+'}'\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!this.appendPropertyMods)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t//generate printable version\n\t\t\t\t\tif (\n\t\t\t\t\t\tfield['TYPE'] === 'user'\n\t\t\t\t\t\t||\n\t\t\t\t\t\tfield['TYPE'] === 'bool'\n\t\t\t\t\t\t||\n\t\t\t\t\t\tfield['TYPE'] === 'file'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst printableTag = (field['TYPE'] === 'user') ? 'friendly' : 'printable';\n\t\t\t\t\t\tfields.push({\n\t\t\t\t\t\t\tId: fieldId + '_printable',\n\t\t\t\t\t\t\tObjectId: this.getId(),\n\t\t\t\t\t\t\tName: field['NAME'] + ' ' + Loc.getMessage('BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX'),\n\t\t\t\t\t\t\tType: 'string',\n\t\t\t\t\t\t\tExpression: `{{~${this.getId()}:${fieldId} > ${printableTag} # ${this.getTitle()}: ${field['NAME']}}}`,\n\t\t\t\t\t\t\tSystemExpression: `{=${this.getId()}:${fieldId}>${printableTag}}`,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (description && Type.isArray(description['ADDITIONAL_RESULT']))\n\t\t{\n\t\t\tconst props = this.#data['Properties'];\n\n\t\t\tdescription['ADDITIONAL_RESULT'].forEach((addProperty) => {\n\t\t\t\tif (props[addProperty])\n\t\t\t\t{\n\t\t\t\t\tfor (const fieldId in props[addProperty])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (props[addProperty].hasOwnProperty(fieldId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst field = props[addProperty][fieldId];\n\t\t\t\t\t\t\tfields.push({\n\t\t\t\t\t\t\t\tId: fieldId,\n\t\t\t\t\t\t\t\tObjectId: this.getId(),\n\t\t\t\t\t\t\t\tName: field['Name'],\n\t\t\t\t\t\t\t\tType: field['Type'],\n\t\t\t\t\t\t\t\tOptions: field['Options'] || null,\n\t\t\t\t\t\t\t\tExpression: `{{~${this.getId()}:${fieldId} # ${this.getTitle()}: ${field['Name']}}}`,\n\t\t\t\t\t\t\t\tSystemExpression: '{=' + this.getId() + ':' + fieldId + '}',\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t//generate printable version\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tfield['Type'] === 'user'\n\t\t\t\t\t\t\t\t||\n\t\t\t\t\t\t\t\tfield['Type'] === 'bool'\n\t\t\t\t\t\t\t\t||\n\t\t\t\t\t\t\t\tfield['Type'] === 'file'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst printableTag = (field['Type'] === 'user') ? 'friendly' : 'printable';\n\t\t\t\t\t\t\t\tconst expression = `{{~${this.getId()}:${fieldId} > ${printableTag} # ${this.getTitle()}: ${field['Name']}}}`;\n\t\t\t\t\t\t\t\tfields.push({\n\t\t\t\t\t\t\t\t\tId: fieldId + '_printable',\n\t\t\t\t\t\t\t\t\tObjectId: this.getId(),\n\t\t\t\t\t\t\t\t\tName: field['Name'] + ' ' + Loc.getMessage('BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX'),\n\t\t\t\t\t\t\t\t\tType: 'string',\n\t\t\t\t\t\t\t\t\tExpression: expression,\n\t\t\t\t\t\t\t\t\tSystemExpression: '{=' + this.getId() + ':' + fieldId + '>' + printableTag + '}',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tgetReturnProperty(id): Array<Object>\n\t{\n\t\tconst fields = this.getReturnFieldsDescription();\n\t\tfor (let i = 0; i < fields.length; ++i)\n\t\t{\n\t\t\tif (fields[i]['Id'] === id)\n\t\t\t{\n\t\t\t\treturn fields[i];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tcollectUsages()\n\t{\n\t\tconst properties = this.getProperties();\n\t\tconst usages = {\n\t\t\tDocument: new Set(),\n\t\t\tConstant: new Set(),\n\t\t\tVariable: new Set(),\n\t\t\tParameter: new Set(),\n\t\t\tGlobalConstant: new Set(),\n\t\t\tGlobalVariable: new Set(),\n\t\t\tActivity: new Set()\n\t\t};\n\n\t\tObject.values(properties).forEach(property => this.collectExpressions(property, usages));\n\n\t\tconst conditions = this.getCondition().serialize();\n\t\tconditions.items.forEach(item => this.collectParsedExpressions(item[0], usages));\n\n\t\treturn usages;\n\t}\n\n\tcollectExpressions(value, usages)\n\t{\n\t\tif (Type.isArray(value))\n\t\t{\n\t\t\tvalue.forEach(v => this.collectExpressions(v, usages));\n\t\t}\n\t\telse if (Type.isPlainObject(value))\n\t\t{\n\t\t\tObject.values(value).forEach(value => this.collectExpressions(value, usages));\n\t\t}\n\t\telse if (Type.isStringFilled(value))\n\t\t{\n\t\t\tlet found;\n\t\t\tconst systemExpressionRegExp = new RegExp(this.SYSTEM_EXPRESSION_PATTERN, 'ig');\n\t\t\twhile ((found = systemExpressionRegExp.exec(value)) !== null)\n\t\t\t{\n\t\t\t\tthis.collectParsedExpressions(found.groups, usages);\n\t\t\t}\n\t\t}\n\t}\n\n\tcollectParsedExpressions(parsedUsage, usages)\n\t{\n\t\tif (Type.isPlainObject(parsedUsage) && parsedUsage['object'] && parsedUsage['field'])\n\t\t{\n\t\t\tswitch (parsedUsage['object'])\n\t\t\t{\n\t\t\t\tcase 'Document':\n\t\t\t\t\tusages.Document.add(parsedUsage['field']);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'Constant':\n\t\t\t\t\tusages.Constant.add(parsedUsage['field']);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'Variable':\n\t\t\t\t\tusages.Variable.add(parsedUsage['field']);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'Template':\n\t\t\t\t\tusages.Parameter.add(parsedUsage['field']);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'GlobalConst':\n\t\t\t\t\tusages.GlobalConstant.add(parsedUsage['field']);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'GlobalVar':\n\t\t\t\t\tusages.GlobalVariable.add(parsedUsage['field']);\n\t\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst activityRegExp = new RegExp(/^A[_0-9]+$/, 'ig');\n\t\t\tif (activityRegExp.exec(parsedUsage['object']))\n\t\t\t{\n\t\t\t\tusages.Activity.add([parsedUsage['object'], parsedUsage['field']]);\n\t\t\t}\n\t\t}\n\t}\n\n\thasBrokenLink(): boolean\n\t{\n\t\treturn this.getBrokenLinks().length > 0;\n\t}\n\n\tgetBrokenLinks(): []\n\t{\n\t\tconst usages = Runtime.clone(this.collectUsages());\n\n\t\tif (!this.template)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst objectsData = {\n\t\t\tDocument: this.#document.getFields(),\n\t\t\tConstant: this.#template.getConstants(),\n\t\t\tVariable: this.#template.getVariables(),\n\t\t\tGlobalConstant: this.#template.globalConstants,\n\t\t\tGlobalVariable: this.#template.globalVariables,\n\t\t\tParameter: this.#template.getParameters(),\n\t\t\tActivity: this.#template.getSerializedRobots()\n\t\t};\n\n\t\tconst brokenLinks = [];\n\t\tfor (const object in usages)\n\t\t{\n\t\t\tif (usages[object].size > 0)\n\t\t\t{\n\t\t\t\tconst source = new Set();\n\n\t\t\t\tfor (const key in objectsData[object])\n\t\t\t\t{\n\t\t\t\t\tif (objectsData[object][key]['Id'])\n\t\t\t\t\t{\n\t\t\t\t\t\tsource.add(objectsData[object][key]['Id']);\n\t\t\t\t\t}\n\t\t\t\t\telse if (objectsData[object][key]['Name'])\n\t\t\t\t\t{\n\t\t\t\t\t\tsource.add(objectsData[object][key]['Name']);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (const value of usages[object].values())\n\t\t\t\t{\n\t\t\t\t\tlet searchInSource = value;\n\t\t\t\t\tlet id = value;\n\n\t\t\t\t\tif (Type.isArray(searchInSource))\n\t\t\t\t\t{\n\t\t\t\t\t\tsearchInSource = value[0];\n\t\t\t\t\t\tid = value[1];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!source.has(searchInSource))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (object === 'Activity')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbrokenLinks.push('{=' + searchInSource + ':' + id + '}');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet brokenLinkObject = object;\n\n\t\t\t\t\t\t\tif (brokenLinkObject === 'GlobalVariable')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbrokenLinkObject = 'GlobalVar';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (brokenLinkObject === 'GlobalConstant')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbrokenLinkObject = 'GlobalConst';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (brokenLinkObject === 'Parameter')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbrokenLinkObject = 'Template';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbrokenLinks.push('{=' + brokenLinkObject + ':' + searchInSource + '}');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (object === 'Activity')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst robot = this.#template.getRobotById(searchInSource);\n\t\t\t\t\t\tif (!robot.getReturnProperty(id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbrokenLinks.push('{=' + searchInSource + ':' + id + '}');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn brokenLinks;\n\t}\n}","import { Type, Runtime } from 'main.core';\n\nexport class UserOptions\n{\n\t#options: Object<string, any>;\n\n\tconstructor(options: Object<string, any>)\n\t{\n\t\tthis.#options = options;\n\t}\n\n\tclone(): this\n\t{\n\t\treturn new UserOptions(Runtime.clone(this.#options));\n\t}\n\n\tset(category: string, key: string, value: any): UserOptions\n\t{\n\t\tif (!Type.isPlainObject(this.#options[category]))\n\t\t{\n\t\t\tthis.#options[category] = {};\n\t\t}\n\t\tconst storedValue = this.#options[category][key];\n\n\t\tif (storedValue !== value)\n\t\t{\n\t\t\tBX.userOptions.save(\n\t\t\t\t'bizproc.automation',\n\t\t\t\tcategory,\n\t\t\t\tkey,\n\t\t\t\tvalue,\n\t\t\t\tfalse\n\t\t\t);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tget(category: string, key: string, defaultValue: any): any\n\t{\n\t\tlet result = defaultValue;\n\t\tif (this.has(category, key))\n\t\t{\n\t\t\tresult = this.#options[category][key];\n\t\t}\n\n\t\treturn result;\n\t}\n\n\thas(category: string, key: string): boolean\n\t{\n\t\treturn Type.isPlainObject(this.#options[category]) && Type.isPlainObject(this.#options[category][key]);\n\t}\n}","import {Type, Dom, Loc, Event, Runtime, Uri, Text, Tag} from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport {\n\tContext,\n\tSelectorContext,\n\tgetGlobalContext,\n\tTracker,\n\tDesigner,\n\tConditionGroupSelector,\n\tConditionGroup,\n\tDelayIntervalSelector,\n\tSelectorManager,\n} from 'bizproc.automation';\nimport { Robot } from './robot'\nimport { UserOptions } from './user-options';\nimport { ViewMode } from './view-mode';\nimport { Helper } from './helper';\nimport { HelpHint } from './help-hint';\nimport { DelayInterval } from './delay-interval';\nimport 'ui.hint';\n\nexport class Template extends EventEmitter\n{\n\t#context: Context;\n\n\tconstants: Object<string, any>;\n\tvariables: Object<string, any>;\n\trobotSettingsControls;\n\n\t#delayMinLimitM: number;\n\t#userOptions: UserOptions | null;\n\t#tracker: Tracker;\n\t#viewMode: ViewMode;\n\n\t#templateContainerNode: Element;\n\t#templateNode: ?Element;\n\t#listNode: Element | undefined;\n\t#buttonsNode: Element | undefined;\n\n\t#robots: Array<Robot>;\n\t#data: Object;\n\n\tconstructor(params: {\n\t\tcontext: ?Context,\n\t\ttemplateContainerNode: Element,\n\t\tconstants: Object<string, any>,\n\t\tvariables: Object<string, any>,\n\t\tuserOptions: ?UserOptions,\n\t\tdelayMinLimitM: number,\n\t})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Automation');\n\n\t\tthis.#context = params.context ?? getGlobalContext();\n\t\tthis.constants = params.constants;\n\t\tthis.variables = params.variables;\n\n\t\tthis.#templateContainerNode = params.templateContainerNode;\n\t\tthis.#delayMinLimitM = params.delayMinLimitM;\n\t\tthis.#userOptions = params.userOptions;\n\t\tthis.#tracker = this.#context.tracker;\n\t\tthis.#data = {};\n\t\tthis.#robots = [];\n\t\tthis.#viewMode = ViewMode.none();\n\t}\n\n\tinit(data: Object, viewMode: number)\n\t{\n\t\tif (Type.isPlainObject(data))\n\t\t{\n\t\t\tthis.#data = data;\n\t\t\tif (!Type.isPlainObject(this.#data.CONSTANTS))\n\t\t\t{\n\t\t\t\tthis.#data.CONSTANTS = {};\n\t\t\t}\n\t\t\tif (!Type.isPlainObject(this.#data.PARAMETERS))\n\t\t\t{\n\t\t\t\tthis.#data.PARAMETERS = {};\n\t\t\t}\n\t\t\tif (!Type.isPlainObject(this.#data.VARIABLES))\n\t\t\t{\n\t\t\t\tthis.#data.VARIABLES = {};\n\t\t\t}\n\t\t\tif (!Type.isNil(this.#data.DOCUMENT_STATUS))\n\t\t\t{\n\t\t\t\tthis.#data.DOCUMENT_STATUS = String(this.#data.DOCUMENT_STATUS);\n\t\t\t}\n\n\t\t\tthis.markExternalModified(this.#data['IS_EXTERNAL_MODIFIED']);\n\t\t\tthis.markModified(false);\n\t\t}\n\n\t\tthis.#viewMode = ViewMode.fromRaw(viewMode);\n\n\t\tif (!this.#viewMode.isNone())\n\t\t{\n\t\t\tthis.#templateNode = this.#templateContainerNode.querySelector(\n\t\t\t\t'[data-role=\"automation-template\"][data-status-id=\"' + this.#data.DOCUMENT_STATUS + '\"]'\n\t\t\t);\n\t\t\tthis.#listNode = this.#templateNode.querySelector('[data-role=\"robot-list\"]');\n\t\t\tthis.#buttonsNode = this.#templateNode.querySelector('[data-role=\"buttons\"]');\n\n\t\t\tthis.initRobots();\n\t\t\tthis.initButtons();\n\n\t\t\tif (!this.isExternalModified() && this.canEdit())\n\t\t\t{\n\t\t\t\t//register DD\n\t\t\t\tjsDD.registerDest(this.#templateNode, 10);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tjsDD.unregisterDest(this.#templateNode);\n\t\t\t}\n\t\t}\n\t}\n\n\treInit(data: Object, viewMode: number)\n\t{\n\t\tDom.clean(this.#listNode);\n\t\tDom.clean(this.#buttonsNode);\n\n\t\tthis.destroy();\n\t\tthis.init(data, viewMode);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#robots.forEach(robot => robot.destroy());\n\t}\n\n\tstatic copyRobotTo(dstTemplate: Template, robot: Robot, beforeRobot: ?Robot): Robot\n\t{\n\t\tconst copiedRobot = robot.copyTo(dstTemplate, beforeRobot);\n\t\tdstTemplate.emit('Template:robot:add', {robot: copiedRobot});\n\t}\n\n\tcanEdit()\n\t{\n\t\treturn this.#context.canEdit;\n\t}\n\n\tinitRobots()\n\t{\n\t\tthis.#robots = [];\n\n\t\tif (Type.isArray(this.#data.ROBOTS))\n\t\t{\n\t\t\tfor (let i = 0; i < this.#data.ROBOTS.length; ++i)\n\t\t\t{\n\t\t\t\tconst robot = new Robot({\n\t\t\t\t\tdocument: this.#context.document,\n\t\t\t\t\ttemplate: this,\n\t\t\t\t\tisFrameMode: this.#context.get('isFrameMode'),\n\t\t\t\t\ttracker: this.#tracker,\n\t\t\t\t});\n\t\t\t\trobot.init(this.#data.ROBOTS[i], this.#viewMode);\n\t\t\t\tthis.insertRobotNode(robot.node);\n\t\t\t\tthis.#robots.push(robot);\n\t\t\t}\n\t\t}\n\t}\n\n\tget robots(): Array<Robot>\n\t{\n\t\treturn this.#robots;\n\t}\n\n\tget userOptions(): ?UserOptions\n\t{\n\t\treturn this.#userOptions;\n\t}\n\n\tgetSelectedRobotNames(): Array<Robot>\n\t{\n\t\tconst selectedRobots = [];\n\n\t\tthis.#robots.forEach(robot => {\n\t\t\tif (robot.isSelected())\n\t\t\t{\n\t\t\t\tselectedRobots.push(robot.data.Name);\n\t\t\t}\n\t\t});\n\n\t\treturn selectedRobots;\n\t}\n\n\tgetSerializedRobots()\n\t{\n\t\tconst serialized = [];\n\t\tthis.#robots.forEach(robot => serialized.push(robot.serialize()));\n\n\t\treturn serialized;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.#data.ID;\n\t}\n\n\tgetStatusId(): ?string\n\t{\n\t\treturn this.#data.DOCUMENT_STATUS;\n\t}\n\n\tgetStatus(): ?object\n\t{\n\t\treturn this.#context.document.statusList.find(status => String(status.STATUS_ID) === this.getStatusId());\n\t}\n\n\tgetTemplateId()\n\t{\n\t\tconst id = parseInt(this.#data.ID);\n\n\t\treturn !isNaN(id) ? id : 0;\n\t}\n\n\tinitButtons()\n\t{\n\t\tif (this.isExternalModified())\n\t\t{\n\t\t\tthis.createExternalLocker();\n\t\t}\n\t\telse if (this.#viewMode.isEdit() && this.getTemplateId() > 0)\n\t\t{\n\t\t\tthis.createConstantsEditButton();\n\t\t\tthis.createParametersEditButton();\n\t\t\tthis.createExternalEditTemplateButton();\n\t\t\tthis.createManageModeButton();\n\t\t}\n\t}\n\n\tenableManageMode(isActive: boolean)\n\t{\n\t\tif (this.#listNode)\n\t\t{\n\t\t\tthis.#viewMode = ViewMode.manage().setProperty('isActive', isActive);\n\n\t\t\tif (isActive)\n\t\t\t{\n\t\t\t\tDom.addClass(this.#listNode, '--multiselect-mode');\n\t\t\t}\n\n\t\t\tif (this.isExternalModified())\n\t\t\t{\n\t\t\t\tDom.addClass(this.#listNode, '--locked-node');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#robots.forEach(robot => robot.enableManageMode(isActive));\n\t\t\t}\n\t\t}\n\t}\n\n\tdisableManageMode()\n\t{\n\t\tif (this.#listNode)\n\t\t{\n\t\t\tthis.#viewMode = ViewMode.edit();\n\t\t\tDom.removeClass(this.#listNode, '--multiselect-mode');\n\t\t\tif (this.isExternalModified())\n\t\t\t{\n\t\t\t\tDom.removeClass(this.#listNode, '--locked-node');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#robots.forEach(robot => robot.disableManageMode());\n\t\t\t}\n\n\t\t\tthis.#templateNode.querySelectorAll('.bizproc-automation-robot-container-wrapper').forEach(node => {\n\t\t\t\tDom.addClass(node, 'bizproc-automation-robot-container-wrapper-draggable');\n\t\t\t});\n\t\t}\n\t}\n\n\tenableDragAndDrop()\n\t{\n\t\tthis.#robots.forEach(robot => robot.registerItem(robot.node));\n\n\t\tthis.#templateNode.querySelectorAll('.bizproc-automation-robot-container-wrapper').forEach(node => {\n\t\t\tDom.addClass(node, 'bizproc-automation-robot-container-wrapper-draggable');\n\t\t});\n\t}\n\n\tdisableDragAndDrop()\n\t{\n\t\tthis.#robots.forEach(robot => robot.unregisterItem(robot.node));\n\n\t\tthis.#templateNode.querySelectorAll('.bizproc-automation-robot-container-wrapper').forEach(node => {\n\t\t\tDom.removeClass(node, 'bizproc-automation-robot-container-wrapper-draggable');\n\t\t});\n\t}\n\n\tcreateExternalEditTemplateButton(): undefined | boolean\n\t{\n\t\tif (Type.isNil(this.#context.bizprocEditorUrl))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst self = this;\n\t\tconst anchor = Dom.create('a', {\n\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_EXTERNAL_EDIT'),\n\t\t\tprops: {\n\t\t\t\thref: '#'\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick(event)\n\t\t\t\t{\n\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\tif (!self.#viewMode.isManage())\n\t\t\t\t\t{\n\t\t\t\t\t\tself.onExternalEditTemplateButtonClick(this);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-robot-btn-set\",\n\t\t\t\ttarget: '_top'\n\t\t\t}\n\t\t});\n\n\t\tif (!this.#context.bizprocEditorUrl.length)\n\t\t{\n\t\t\tDom.addClass(anchor, 'bizproc-automation-robot-btn-set-locked');\n\t\t}\n\n\t\tthis.#buttonsNode.appendChild(anchor);\n\t}\n\n\tcreateManageModeButton()\n\t{\n\t\tif (!this.#context.canManage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst manageButton = Dom.create('a', {\n\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_MANAGE_ROBOTS'),\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-robot-btn-set\",\n\t\t\t\ttarget: '_top',\n\t\t\t},\n\t\t\tstyle: {\n\t\t\t\tcursor: 'pointer',\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: event => {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tthis.onManageModeButtonClick(manageButton);\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\n\t\tthis.#buttonsNode.appendChild(manageButton);\n\t}\n\n\tonManageModeButtonClick(manageButtonNode: HTMLElement)\n\t{\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(manageButtonNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit('Template:enableManageMode', {\n\t\t\t\tdocumentStatus: this.#data.DOCUMENT_STATUS,\n\t\t\t});\n\t\t}\n\t}\n\n\tcreateConstantsEditButton(): boolean | undefined\n\t{\n\t\tif (Type.isNil(this.#context.constantsEditorUrl))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst url =\n\t\t\t!this.#viewMode.isManage()\n\t\t\t\t? this.#context.constantsEditorUrl.replace('#ID#', this.getTemplateId())\n\t\t\t\t: '#'\n\t\t;\n\n\t\tif (!url.length)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst anchor = Dom.create('a', {\n\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_CONSTANTS_EDIT'),\n\t\t\tprops: {\n\t\t\t\thref: url\n\t\t\t},\n\t\t\tattrs: { className: \"bizproc-automation-robot-btn-set\" }\n\t\t});\n\n\t\tthis.#buttonsNode.appendChild(anchor);\n\t}\n\n\tcreateParametersEditButton(): boolean | undefined\n\t{\n\t\tif (Type.isNil(this.#context.parametersEditorUrl))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst url = this.#context.parametersEditorUrl.replace('#ID#', this.getTemplateId());\n\n\t\tif (!url.length || this.#viewMode.isManage())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst anchor = Dom.create('a', {\n\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_PARAMETERS_EDIT'),\n\t\t\tprops: {\n\t\t\t\thref: url\n\t\t\t},\n\t\t\tattrs: { className: \"bizproc-automation-robot-btn-set\" }\n\t\t});\n\n\t\tthis.#buttonsNode.appendChild(anchor);\n\t}\n\n\tcreateExternalLocker()\n\t{\n\t\tconst div = Dom.create(\"div\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-robot-container\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'bizproc-automation-robot-container-wrapper bizproc-automation-robot-container-wrapper-lock'\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tattrs: { className: \"bizproc-automation-robot-deadline\" }\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tattrs: { className: \"bizproc-automation-robot-title\" },\n\t\t\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_EXTERNAL_EDIT_TEXT')\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.#viewMode.isEdit())\n\t\t{\n\t\t\tconst settingsBtn = Dom.create('div', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'bizproc-automation-robot-btn-settings'\n\t\t\t\t},\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_EDIT')\n\t\t\t});\n\n\t\t\tconst self = this;\n\t\t\tEvent.bind(div, 'click', function (event) {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tif (!self.#viewMode.isManage())\n\t\t\t\t{\n\t\t\t\t\tself.onExternalEditTemplateButtonClick(this);\n\t\t\t\t}\n\t\t\t});\n\t\t\tdiv.appendChild(settingsBtn);\n\n\t\t\tconst deleteBtn = Dom.create('SPAN', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'bizproc-automation-robot-btn-delete'\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tEvent.bind(deleteBtn, 'click', function (event) {\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\tif (!self.#viewMode.isManage())\n\t\t\t\t{\n\t\t\t\t\tself.onUnsetExternalModifiedClick(this);\n\t\t\t\t}\n\t\t\t});\n\t\t\tdiv.lastChild.appendChild(deleteBtn);\n\t\t}\n\n\t\tthis.#listNode.appendChild(div);\n\t\tthis.#templateNode = div;\n\t}\n\n\tonSearch(event: BaseEvent)\n\t{\n\t\tif (this.isExternalModified())\n\t\t{\n\t\t\tthis.onExternalModifiedSearch(event);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#robots.forEach(robot => robot.onSearch(event));\n\t\t}\n\t}\n\n\tonExternalModifiedSearch(event)\n\t{\n\t\tif (this.#templateNode)\n\t\t{\n\t\t\tconst query = event.getData().queryString;\n\t\t\tBX[!query ? 'removeClass' : 'addClass'](this.#templateNode, '--search-mismatch');\n\t\t}\n\t}\n\n\tonExternalEditTemplateButtonClick(button)\n\t{\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\t\t\treturn;\n\t\t}\n\t\tif (!this.#context.bizprocEditorUrl.length)\n\t\t{\n\t\t\tif (top.BX.UI && top.BX.UI.InfoHelper)\n\t\t\t{\n\t\t\t\ttop.BX.UI.InfoHelper.show('limit_office_bp_designer');\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst templateId = this.getTemplateId();\n\t\tif (templateId > 0)\n\t\t{\n\t\t\tthis.openBizprocEditor(templateId);\n\t\t}\n\t}\n\n\tonUnsetExternalModifiedClick(button)\n\t{\n\t\tthis.#templateNode = null;\n\n\t\tthis.markExternalModified(false);\n\t\tthis.markModified();\n\t\tthis.reInit(null, this.#viewMode.intoRaw());\n\t}\n\n\topenBizprocEditor(templateId)\n\t{\n\t\ttop.window.location.href = this.#context.bizprocEditorUrl.replace('#ID#', templateId)\n\t}\n\n\taddRobot(robotData, callback)\n\t{\n\t\tconst robot = new Robot({\n\t\t\tdocument: this.#context.document,\n\t\t\ttemplate: this,\n\t\t\tisFrameMode: this.#context.get('isFrameMode'),\n\t\t\ttracker: this.#tracker,\n\t\t});\n\t\tconst initData = {\n\t\t\tType: robotData['CLASS'],\n\t\t\tProperties: {\n\t\t\t\tTitle: robotData['NAME']\n\t\t\t},\n\t\t\tDialogContext: robotData['DIALOG_CONTEXT'],\n\t\t};\n\n\t\tif (this.#robots.length > 0)\n\t\t{\n\t\t\tconst parentRobot = this.#robots[this.#robots.length - 1];\n\t\t\tif (!parentRobot.getDelayInterval().isNow() || parentRobot.isExecuteAfterPrevious())\n\t\t\t{\n\t\t\t\tinitData['Delay'] = parentRobot.getDelayInterval().serialize();\n\t\t\t\tinitData['ExecuteAfterPrevious'] =  1;\n\t\t\t}\n\t\t}\n\n\t\trobot.draft = true;\n\t\trobot.init(initData, this.#viewMode);\n\n\t\tthis.insertRobot(robot);\n\t\tthis.insertRobotNode(robot.node);\n\t\tthis.emit('Template:robot:add', {robot});\n\n\t\tif (callback)\n\t\t{\n\t\t\tcallback.call(this, robot);\n\t\t}\n\t}\n\n\tinsertRobot(robot, beforeRobot)\n\t{\n\t\tif (beforeRobot)\n\t\t{\n\t\t\tfor (let i = 0; i < this.#robots.length; ++i)\n\t\t\t{\n\t\t\t\tif (this.#robots[i] !== beforeRobot)\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.#robots.splice(i, 0, robot);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#robots.push(robot);\n\t\t}\n\n\t\tthis.markModified();\n\t}\n\n\tgetNextRobot(robot)\n\t{\n\t\tfor (let i = 0; i < this.#robots.length; ++i)\n\t\t{\n\t\t\tif (this.#robots[i] === robot)\n\t\t\t{\n\t\t\t\treturn (this.#robots[i + 1] || null);\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tdeleteRobot(robot, callback)\n\t{\n\t\tfor(let i = 0; i < this.#robots.length; ++i)\n\t\t{\n\t\t\tif (this.#robots[i].isEqual(robot))\n\t\t\t{\n\t\t\t\tthis.#robots.splice(i, 1);\n\n\t\t\t\tif (callback)\n\t\t\t\t{\n\t\t\t\t\tcallback(robot);\n\t\t\t\t}\n\n\t\t\t\tthis.markModified();\n\t\t\t\tthis.emit('Template:robot:delete', { robot });\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tinsertRobotNode(robotNode, beforeNode)\n\t{\n\t\tif (beforeNode)\n\t\t{\n\t\t\tthis.#listNode.insertBefore(robotNode, beforeNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#listNode.appendChild(robotNode);\n\t\t}\n\t}\n\n\topenRobotSettingsDialog(robot: Robot, context?: Object, saveCallback: (Robot) => void)\n\t{\n\t\tif (!Type.isPlainObject(context))\n\t\t{\n\t\t\tcontext = {};\n\t\t}\n\n\t\tif (Designer.getInstance().getRobotSettingsDialog())\n\t\t{\n\t\t\tif (context.changeRobot)\n\t\t\t{\n\t\t\t\tDesigner.getInstance().getRobotSettingsDialog().popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst formName = 'bizproc_automation_robot_dialog';\n\n\t\tconst form = Dom.create('form', {\n\t\t\tprops: {\n\t\t\t\tname: formName\n\t\t\t}\n\t\t});\n\n\t\tDesigner.getInstance().setRobotSettingsDialog({\n\t\t\ttemplate: this,\n\t\t\tcontext: context,\n\t\t\trobot: robot,\n\t\t\tform: form\n\t\t});\n\n\t\tform.appendChild(this.renderDelaySettings(robot));\n\t\tform.appendChild(this.renderConditionSettings(robot));\n\n\t\tconst robotBrokenLinks = robot.getBrokenLinks();\n\t\tif (robotBrokenLinks.length > 0)\n\t\t{\n\t\t\tDom.append(this.renderBrokenLinkAlert(robotBrokenLinks), form);\n\t\t}\n\n\t\tconst iconHelp = Dom.create('div', {\n\t\t\tattrs: { className: 'bizproc-automation-robot-help' },\n\t\t\tevents: {\n\t\t\t\tclick: (event) => this.emit('Template:help:show', event)\n\t\t\t},\n\t\t});\n\t\tform.appendChild(iconHelp);\n\t\tcontext['DOCUMENT_CATEGORY_ID'] = this.#context.document.getCategoryId();\n\t\tif (Type.isPlainObject(robot.data.DialogContext) && (robot.data.DialogContext.hasOwnProperty('addMenuGroup')))\n\t\t{\n\t\t\tcontext['addMenuGroup'] = robot.data.DialogContext.addMenuGroup;\n\t\t}\n\n\t\tBX.ajax({\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'html',\n\t\t\turl: Uri.addParam(\n\t\t\t\tthis.#context.ajaxUrl,\n\t\t\t\t{\n\t\t\t\t\tanalyticsLabel: `automation_robot${robot.draft ? '_draft' : ''}_settings_${robot.data.Type.toLowerCase()}`\n\t\t\t\t}\n\t\t\t),\n\t\t\tdata: {\n\t\t\t\tajax_action: 'get_robot_dialog',\n\t\t\t\tdocument_signed: this.#context.signedDocument,\n\t\t\t\tdocument_status: this.#context.document.getCurrentStatusId(),\n\t\t\t\tcontext: context,\n\t\t\t\trobot_json: Helper.toJsonString(robot.serialize()),\n\t\t\t\tform_name: formName\n\t\t\t},\n\t\t\tonsuccess: html => {\n\t\t\t\tif (html)\n\t\t\t\t{\n\t\t\t\t\tconst dialogRows = Dom.create('div', {\n\t\t\t\t\t\thtml: html\n\t\t\t\t\t});\n\t\t\t\t\tform.appendChild(dialogRows);\n\t\t\t\t}\n\n\t\t\t\tthis.showRobotSettingsPopup(robot, form, saveCallback);\n\t\t\t}\n\t\t});\n\t}\n\n\tshowRobotSettingsPopup(robot: Robot, form: HTMLFormElement, saveCallback: (Robot) => void)\n\t{\n\t\tlet popupMinWidth = 580;\n\t\tlet popupWidth = popupMinWidth;\n\n\t\tif (this.#userOptions)\n\t\t{\n\t\t\t// TODO move from if?\n\t\t\tthis.emit('Template:robot:showSettings');\n\t\t\tpopupWidth = parseInt(\n\t\t\t\tthis.#userOptions.get('defaults', 'robot_settings_popup_width', 580)\n\t\t\t);\n\t\t}\n\n\t\tthis.initRobotSettingsControls(robot, form);\n\n\t\tif (\n\t\t\trobot.data.Type === 'CrmSendEmailActivity'\n\t\t\t|| robot.data.Type === 'MailActivity'\n\t\t\t|| robot.data.Type === 'RpaApproveActivity'\n\t\t)\n\t\t{\n\t\t\tpopupMinWidth += 170;\n\t\t\tif (popupWidth < popupMinWidth)\n\t\t\t{\n\t\t\t\tpopupWidth = popupMinWidth;\n\t\t\t}\n\t\t}\n\n\t\tlet robotTitle = Loc.getMessage('BIZPROC_AUTOMATION_ROBOT_SETTINGS_TITLE');\n\t\tlet descriptionTitle = Loc.getMessage('BIZPROC_AUTOMATION_ROBOT_SETTINGS_TITLE');\n\n\t\tif (robot.hasTitle())\n\t\t{\n\t\t\trobotTitle = robot.getTitle();\n\t\t\tdescriptionTitle = robot.getDescriptionTitle();\n\n\t\t\tif (descriptionTitle === 'untitled')\n\t\t\t{\n\t\t\t\tdescriptionTitle = robotTitle;\n\t\t\t}\n\t\t}\n\n\t\tconst titleBarContent = Tag.render`\n\t\t\t<div class=\"popup-window-titlebar-text bizproc-automation-robot-settings-popup-titlebar\">\n\t\t\t\t<span class=\"bizproc-automation-robot-settings-popup-titlebar-text\">${Text.encode(robotTitle)}</span>\n\t\t\t\t<div class=\"ui-hint\">\n\t\t\t\t\t<span class=\"ui-hint-icon\" data-text=\"${Text.encode(descriptionTitle)}\"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tHelpHint.bindAll(titleBarContent);\n\n\t\tconst me = this;\n\t\tconst popup = new BX.PopupWindow(Helper.generateUniqueId(), null, {\n\t\t\ttitleBar: {\n\t\t\t\tcontent: titleBarContent,\n\t\t\t},\n\t\t\tcontent: form,\n\t\t\tcloseIcon: true,\n\t\t\twidth: popupWidth,\n\t\t\tresizable: {\n\t\t\t\tminWidth: popupMinWidth,\n\t\t\t\tminHeight: 100\n\t\t\t},\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: true,\n\t\t\tdraggable: {restrict: false},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: (popup) => {\n\t\t\t\t\tDesigner.getInstance().setRobotSettingsDialog(null);\n\t\t\t\t\tthis.destroyRobotSettingsControls();\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t\tthis.emit('Template:robot:closeSettings');\n\t\t\t\t},\n\t\t\t\tonPopupResize: () => {\n\t\t\t\t\tthis.onResizeRobotSettings();\n\t\t\t\t},\n\t\t\t\tonPopupResizeEnd: function() {\n\t\t\t\t\tif (me.#userOptions)\n\t\t\t\t\t{\n\t\t\t\t\t\tme.#userOptions.set(\n\t\t\t\t\t\t\t'defaults',\n\t\t\t\t\t\t\t'robot_settings_popup_width',\n\t\t\t\t\t\t\tthis.getWidth()\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tbuttons: [\n\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\ttext : Loc.getMessage('JS_CORE_WINDOW_SAVE'),\n\t\t\t\t\tclassName : \"popup-window-button-accept\",\n\t\t\t\t\tevents : {\n\t\t\t\t\t\tclick()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst isNewRobot = robot.draft;\n\n\t\t\t\t\t\t\tme.saveRobotSettings(form, robot, BX.delegate(function()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t\t\tif (isNewRobot)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tme.emit('Template:robot:add', { robot });\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (saveCallback)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tsaveCallback(robot);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, this), this.buttonNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.PopupWindowButtonLink({\n\t\t\t\t\ttext : Loc.getMessage('JS_CORE_WINDOW_CANCEL'),\n\t\t\t\t\tclassName : \"popup-window-button-link-cancel\",\n\t\t\t\t\tevents : {\n\t\t\t\t\t\tclick: function(){\n\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tDesigner.getInstance().getRobotSettingsDialog().popup = popup;\n\t\tpopup.show();\n\t}\n\n\tinitRobotSettingsControls(robot, node)\n\t{\n\t\tif (!Type.isArray(this.robotSettingsControls))\n\t\t{\n\t\t\tthis.robotSettingsControls = [];\n\t\t}\n\n\t\tconst controlNodes = node.querySelectorAll('[data-role]');\n\t\tfor (let i = 0; i < controlNodes.length; ++i)\n\t\t{\n\t\t\tthis.initRobotSettingsControl(robot, controlNodes[i]);\n\t\t}\n\t}\n\n\tinitRobotSettingsControl(robot, controlNode)\n\t{\n\t\tif (!Type.isArray(this.robotSettingsControls))\n\t\t{\n\t\t\tthis.robotSettingsControls = [];\n\t\t}\n\n\t\tconst role = controlNode.getAttribute('data-role');\n\n\t\tconst controlProps = {\n\t\t\tcontext: new SelectorContext({\n\t\t\t\tfields: Runtime.clone(this.#context.document.getFields()),\n\t\t\t\tuseSwitcherMenu: this.#context.get('showTemplatePropertiesMenuOnSelecting'),\n\t\t\t\trootGroupTitle: this.#context.document.title,\n\t\t\t\tuserOptions: this.#context.userOptions,\n\t\t\t}),\n\t\t\tneedSync: robot.draft,\n\t\t\tcheckbox: controlNode,\n\t\t};\n\n\t\tif (role === SelectorManager.SELECTOR_ROLE_USER)\n\t\t{\n\t\t\tconst fieldProperty = JSON.parse(controlNode.getAttribute('data-property'));\n\t\t\tcontrolProps.context.set('additionalUserFields', [\n\t\t\t\t...this.#getUserSelectorAdditionalFields(fieldProperty),\n\t\t\t\t...this.globalConstants.filter(constant => constant['Type'] === 'user').map(constant => ({\n\t\t\t\t\tid: constant['Expression'],\n\t\t\t\t\ttitle: constant['Name'],\n\t\t\t\t})),\n\t\t\t\t...this.globalVariables.filter(variable => variable['Type'] === 'user').map(variable => ({\n\t\t\t\t\tid: variable['Expression'],\n\t\t\t\t\ttitle: variable['Name'],\n\t\t\t\t})),\n\t\t\t]);\n\t\t}\n\t\telse if (role === SelectorManager.SELECTOR_ROLE_FILE)\n\t\t{\n\t\t\tthis.robots.forEach((robot) => {\n\t\t\t\tcontrolProps.context.fields.push(\n\t\t\t\t\t...robot\n\t\t\t\t\t\t.getReturnFieldsDescription()\n\t\t\t\t\t\t.filter(field => field['Type'] === 'file')\n\t\t\t\t\t\t.map((field) => ({\n\t\t\t\t\t\t\tId: `{{~${robot.getId()}:${field['Id']}}}`,\n\t\t\t\t\t\t\tName: `${robot.getTitle()}: ${field['Name']}`,\n\t\t\t\t\t\t\tType: 'file',\n\t\t\t\t\t\t\tExpression: `{{~${robot.getId()}:${field['Id']}}}`,\n\t\t\t\t\t\t}))\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\tconst control = SelectorManager.createSelectorByRole(role, controlProps);\n\n\t\tif (control && role !== SelectorManager.SELECTOR_ROLE_SAVE_STATE)\n\t\t{\n\t\t\tcontrol.renderTo(controlNode);\n\n\t\t\tcontrol.subscribe('onAskConstant', (event) => {\n\t\t\t\tconst {fieldProperty} = event.getData();\n\t\t\t\tcontrol.onFieldSelect(this.addConstant(fieldProperty));\n\t\t\t});\n\t\t\tcontrol.subscribe('onAskParameter', (event) => {\n\t\t\t\tconst {fieldProperty} = event.getData();\n\t\t\t\tcontrol.onFieldSelect(this.addParameter(fieldProperty));\n\t\t\t});\n\t\t\tcontrol.subscribe('onOpenFieldMenu', (event) => this.onOpenMenu(event, robot));\n\t\t\tcontrol.subscribe('onOpenMenu', (event) => this.onOpenMenu(event, robot));\n\t\t}\n\n\t\tBX.UI.Hint.init(controlNode);\n\n\t\tif (control)\n\t\t{\n\t\t\tthis.robotSettingsControls.push(control);\n\t\t}\n\t}\n\n\t#getUserSelectorAdditionalFields(fieldProperty): Array<object>\n\t{\n\t\tconst additionalFields = (\n\t\t\tthis\n\t\t\t\t.#getRobotsWithReturnFields()\n\t\t\t\t.map((robot) => (\n\t\t\t\t\trobot\n\t\t\t\t\t\t.getReturnFieldsDescription()\n\t\t\t\t\t\t.filter(field => field['Type'] === 'user')\n\t\t\t\t\t\t.map((field) => ({\n\t\t\t\t\t\t\tid: `{{~${robot.getId()}:${field['Id']}}}`,\n\t\t\t\t\t\t\ttitle: `${robot.getTitle()}: ${field['Name']}`,\n\t\t\t\t\t\t}))\n\t\t\t\t))\n\t\t\t\t.flat()\n\t\t);\n\n\t\tif (this.#context.get('showTemplatePropertiesMenuOnSelecting') && fieldProperty)\n\t\t{\n\t\t\tconst ask = this.addConstant(Runtime.clone(fieldProperty));\n\n\t\t\tadditionalFields.push({\n\t\t\t\tid: ask.Expression,\n\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_ASK_CONSTANT'),\n\t\t\t\ttabs: ['recents', 'bpuserroles'],\n\t\t\t\tsort: 1,\n\t\t\t});\n\n\t\t\tconst param = this.addParameter(Runtime.clone(fieldProperty));\n\n\t\t\tadditionalFields.push({\n\t\t\t\tid: param.Expression,\n\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_ASK_PARAMETER'),\n\t\t\t\ttabs: ['recents', 'bpuserroles'],\n\t\t\t\tsort: 2,\n\t\t\t});\n\t\t}\n\n\t\treturn additionalFields;\n\t}\n\n\t#addRobotReturnFieldsToSelector(event: BaseEvent, skipRobot: ?Robot)\n\t{\n\t\tconst selector = event.getData().selector;\n\t\tconst isMixedCondition = event.getData().isMixedCondition;\n\n\t\tif (Type.isBoolean(isMixedCondition) && !isMixedCondition)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst robotMenuItems = (\n\t\t\tthis\n\t\t\t\t.#getRobotsWithReturnFields(skipRobot)\n\t\t\t\t.map((robot) => ({\n\t\t\t\t\tid: robot.getId(),\n\t\t\t\t\ttitle: robot.getTitle(),\n\t\t\t\t\tchildren: robot.getReturnFieldsDescription().map((field) => ({\n\t\t\t\t\t\tid: field.Expression,\n\t\t\t\t\t\ttitle: field.Name,\n\t\t\t\t\t\tcustomData: { field },\n\t\t\t\t\t}))\n\t\t\t\t}))\n\t\t);\n\n\t\tif (robotMenuItems.length > 0)\n\t\t{\n\t\t\tselector.addGroup('__RESULT', {\n\t\t\t\tid: '__RESULT',\n\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_ROBOT_LIST'),\n\t\t\t\tchildren: robotMenuItems\n\t\t\t});\n\t\t}\n\t}\n\n\t#addConstantsToSelector(event: BaseEvent)\n\t{\n\t\tconst selector = event.getData().selector;\n\t\tconst isMixedCondition = event.getData().isMixedCondition;\n\n\t\tif (Type.isBoolean(isMixedCondition) && !isMixedCondition)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// TODO - test !this.showTemplatePropertiesMenuOnSelecting\n\t\tconst constants = this.getConstants().map((constant) => {\n\t\t\treturn {\n\t\t\t\tid: constant.SystemExpression,\n\t\t\t\ttitle: constant.Name,\n\t\t\t\tsupertitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_TEMPLATE_CONSTANTS_LIST'),\n\t\t\t\tcustomData: { field: constant }\n\t\t\t};\n\t\t});\n\n\t\tthis.globalConstants.forEach((constant) => {\n\t\t\tconstants.push({\n\t\t\t\tid: constant.SystemExpression,\n\t\t\t\ttitle: constant['Name'],\n\t\t\t\tsupertitle: constant.SuperTitle,\n\t\t\t\tcustomData: { field: constant },\n\t\t\t});\n\t\t});\n\n\t\tif (Type.isArrayFilled(constants))\n\t\t{\n\t\t\tselector.addGroup(\n\t\t\t\t'__CONSTANTS',\n\t\t\t\t{\n\t\t\t\t\tid: '__CONSTANTS',\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_CONSTANTS_LIST'),\n\t\t\t\t\tchildren: constants\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\t#addVariablesToSelector(event: BaseEvent)\n\t{\n\t\tconst selector = event.getData().selector;\n\t\tconst isMixedCondition = event.getData().isMixedCondition;\n\n\t\tif (Type.isBoolean(isMixedCondition) && !isMixedCondition)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst gVariables = this.globalVariables.map((variable) => {\n\t\t\treturn {\n\t\t\t\tid: variable.SystemExpression,\n\t\t\t\ttitle: variable.Name,\n\t\t\t\tsupertitle: variable.SuperTitle,\n\t\t\t\tcustomData: {field: variable},\n\t\t\t};\n\t\t});\n\n\t\tif (Type.isArrayFilled(gVariables))\n\t\t{\n\t\t\tselector.addGroup(\n\t\t\t\t'__GLOB_VARIABLES',\n\t\t\t\t{\n\t\t\t\t\tid: '__GLOB_VARIABLES',\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_GLOB_VARIABLES_LIST_1'),\n\t\t\t\t\tchildren: gVariables,\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\t#getRobotsWithReturnFields(skipRobot: ?Robot = undefined): Array<Robot>\n\t{\n\t\tconst skipId = skipRobot?.getId() || '';\n\n\t\treturn this\n\t\t\t.robots\n\t\t\t.filter((templateRobot) => (\n\t\t\t\ttemplateRobot.getId() !== skipId && templateRobot.hasReturnFields()\n\t\t\t))\n\t\t;\n\t}\n\n\tdestroyRobotSettingsControls()\n\t{\n\t\tif (this.conditionSelector)\n\t\t{\n\t\t\tthis.conditionSelector.destroy();\n\t\t\tthis.conditionSelector = null;\n\t\t}\n\n\t\tif (Type.isArray(this.robotSettingsControls))\n\t\t{\n\t\t\tfor (let i = 0; i < this.robotSettingsControls.length; ++i)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(this.robotSettingsControls[i].destroy))\n\t\t\t\t{\n\t\t\t\t\tthis.robotSettingsControls[i].destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.robotSettingsControls = null;\n\t}\n\n\tonBeforeSaveRobotSettings()\n\t{\n\t\tif (Type.isArray(this.robotSettingsControls))\n\t\t{\n\t\t\tfor (let i = 0; i < this.robotSettingsControls.length; ++i)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(this.robotSettingsControls[i].onBeforeSave))\n\t\t\t\t{\n\t\t\t\t\tthis.robotSettingsControls[i].onBeforeSave();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonResizeRobotSettings()\n\t{\n\t\tif (Type.isArray(this.robotSettingsControls))\n\t\t{\n\t\t\tfor (let i = 0; i < this.robotSettingsControls.length; ++i)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(this.robotSettingsControls[i].onPopupResize))\n\t\t\t\t{\n\t\t\t\t\tthis.robotSettingsControls[i].onPopupResize();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\trenderDelaySettings(robot)\n\t{\n\t\tconst delay = robot.getDelayInterval().clone();\n\t\tconst idSalt = Helper.generateUniqueId();\n\n\t\tconst delayTypeNode = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: \"hidden\",\n\t\t\t\tname: \"delay_type\",\n\t\t\t\tvalue: delay.type\n\t\t\t}\n\t\t});\n\t\tconst delayValueNode = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: \"hidden\",\n\t\t\t\tname: \"delay_value\",\n\t\t\t\tvalue: delay.value\n\t\t\t}\n\t\t});\n\t\tconst delayValueTypeNode = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: \"hidden\",\n\t\t\t\tname: \"delay_value_type\",\n\t\t\t\tvalue: delay.valueType\n\t\t\t}\n\t\t});\n\t\tconst delayBasisNode = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: \"hidden\",\n\t\t\t\tname: \"delay_basis\",\n\t\t\t\tvalue: delay.basis\n\t\t\t}\n\t\t});\n\t\tconst delayWorkTimeNode = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: \"hidden\",\n\t\t\t\tname: \"delay_worktime\",\n\t\t\t\tvalue: delay.workTime ? 1 : 0\n\t\t\t}\n\t\t});\n\n\t\tconst delayWaitWorkDayNode = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: \"hidden\",\n\t\t\t\tname: \"delay_wait_workday\",\n\t\t\t\tvalue: delay.waitWorkDay ? 1 : 0\n\t\t\t}\n\t\t});\n\n\t\tconst delayInTimeNode = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: \"hidden\",\n\t\t\t\tname: \"delay_in_time\",\n\t\t\t\tvalue: delay.inTimeString,\n\t\t\t}\n\t\t});\n\n\t\tconst delayIntervalLabelNode = Dom.create(\"span\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis\"\n\t\t\t}\n\t\t});\n\n\t\tconst basisFields = [];\n\n\t\tconst docFields = this.#context.document.getFields();\n\t\tconst minLimitM = this.#delayMinLimitM;\n\n\t\tif (Type.isArray(docFields))\n\t\t{\n\t\t\tfor (let i = 0; i < docFields.length; ++i)\n\t\t\t{\n\t\t\t\tconst field = docFields[i];\n\t\t\t\tif (field['Type'] === 'date' || field['Type'] === 'datetime')\n\t\t\t\t{\n\t\t\t\t\tbasisFields.push(field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst delayIntervalSelector = new DelayIntervalSelector({\n\t\t\tlabelNode: delayIntervalLabelNode,\n\t\t\tonchange(delay) {\n\t\t\t\tdelayTypeNode.value = delay.type;\n\t\t\t\tdelayValueNode.value = delay.value;\n\t\t\t\tdelayValueTypeNode.value = delay.valueType;\n\t\t\t\tdelayBasisNode.value = delay.basis;\n\t\t\t\tdelayWorkTimeNode.value = delay.workTime ? 1 : 0;\n\t\t\t\tdelayWaitWorkDayNode.value = delay.waitWorkDay ? 1 : 0;\n\t\t\t\tdelayInTimeNode.value = delay.inTimeString;\n\t\t\t},\n\t\t\tbasisFields: basisFields,\n\t\t\tminLimitM: minLimitM,\n\t\t\tuseAfterBasis: true,\n\t\t\tshowWaitWorkDay: true,\n\t\t});\n\n\t\tlet executeAfterPreviousBlock = null;\n\t\tif (robot.hasTemplate())\n\t\t{\n\t\t\tconst executeAfterPreviousCheckbox = Dom.create(\"input\", {\n\t\t\t\tattrs: {\n\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\tid: \"param-group-3-1\" + idSalt,\n\t\t\t\t\tname: \"execute_after_previous\",\n\t\t\t\t\tvalue: '1',\n\t\t\t\t\tstyle: 'vertical-align: middle'\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (robot.isExecuteAfterPrevious())\n\t\t\t{\n\t\t\t\texecuteAfterPreviousCheckbox.setAttribute('checked', 'checked');\n\t\t\t}\n\t\t\texecuteAfterPreviousBlock = Dom.create(\"div\", {\n\t\t\t\tattrs: { className: \"bizproc-automation-popup-settings-block\" },\n\t\t\t\tchildren: [\n\t\t\t\t\texecuteAfterPreviousCheckbox,\n\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\tfor: \"param-group-3-1\" + idSalt,\n\t\t\t\t\t\t\tstyle: 'color: #535C69'\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_AFTER_PREVIOUS_WIDE')\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t})\n\t\t}\n\n\t\tconst div = Dom.create(\"div\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings bizproc-automation-popup-settings-flex\" },\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tattrs: { className: \"bizproc-automation-popup-settings-block bizproc-automation-popup-settings-block-flex\" },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\tattrs: { className: \"bizproc-automation-popup-settings-title-wrapper\" },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tdelayTypeNode,\n\t\t\t\t\t\t\t\tdelayValueNode,\n\t\t\t\t\t\t\t\tdelayValueTypeNode,\n\t\t\t\t\t\t\t\tdelayBasisNode,\n\t\t\t\t\t\t\t\tdelayWorkTimeNode,\n\t\t\t\t\t\t\t\tdelayWaitWorkDayNode,\n\t\t\t\t\t\t\t\tdelayInTimeNode,\n\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tattrs: { className: \"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-left\" },\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_TO_EXECUTE') + \":\"\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tdelayIntervalLabelNode\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\texecuteAfterPreviousBlock\n\t\t\t]\n\t\t});\n\n\t\tdelayIntervalSelector.init(delay);\n\n\t\treturn div;\n\t}\n\n\tsetDelaySettingsFromForm(formFields,  robot)\n\t{\n\t\tconst delay = new DelayInterval();\n\t\tdelay.setType(formFields['delay_type']);\n\t\tdelay.setValue(formFields['delay_value']);\n\t\tdelay.setValueType(formFields['delay_value_type']);\n\t\tdelay.setBasis(formFields['delay_basis']);\n\t\tdelay.setWorkTime(formFields['delay_worktime'] === '1');\n\t\tdelay.setWaitWorkDay(formFields['delay_wait_workday'] === '1');\n\t\tdelay.setInTime(formFields['delay_in_time'] ? formFields['delay_in_time'].split(':') : null);\n\t\trobot.setDelayInterval(delay);\n\n\t\tif (robot.hasTemplate())\n\t\t{\n\t\t\trobot.setExecuteAfterPrevious(\n\t\t\t\tformFields['execute_after_previous'] && (formFields['execute_after_previous']) === '1'\n\t\t\t);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\trenderConditionSettings(robot)\n\t{\n\t\tconst conditionGroup = robot.getCondition();\n\t\tthis.conditionSelector = new ConditionGroupSelector(conditionGroup, {\n\t\t\tfields: this.#context.document.getFields(),\n\t\t\tonOpenFieldMenu: (event) => this.onOpenMenu(event, robot),\n\t\t\tonOpenMenu: (event) => this.onOpenMenu(event, robot),\n\t\t});\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings\" },\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tattrs: { className: \"bizproc-automation-popup-settings-block\" },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\tattrs: { className: \"bizproc-automation-popup-settings-title\" },\n\t\t\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_ROBOT_CONDITION') + \":\"\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.conditionSelector.createNode(),\n\t\t\t\t\t],\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t}\n\n\tonOpenMenu(event: BaseEvent, robot: Robot): void\n\t{\n\t\tthis.#addRobotReturnFieldsToSelector(event, robot);\n\t\tthis.#addConstantsToSelector(event);\n\t\tthis.#addVariablesToSelector(event);\n\n\t\tthis.emit(\n\t\t\t'Template:onSelectorMenuOpen',\n\t\t\t{\n\t\t\t\ttemplate: this,\n\t\t\t\trobot,\n\t\t\t\t...event.getData()\n\t\t\t}\n\t\t);\n\t}\n\n\tsetConditionSettingsFromForm(formFields, robot)\n\t{\n\t\trobot.setCondition(ConditionGroup.createFromForm(formFields));\n\n\t\treturn this;\n\t}\n\n\trenderBrokenLinkAlert(brokenLinks: [] = [])\n\t{\n\t\tconst moreInfoNode = Tag.render`\n\t\t\t<div class=\"bizproc-automation-robot-broken-link-full-info\">\n\t\t\t\t${brokenLinks.map((value) => {return Text.encode(value)}).join('<br>')}\n\t\t\t</div>\n\t\t`;\n\n\t\tconst showMoreLabel = Tag.render`\n\t\t\t<span class=\"bizproc-automation-robot-broken-link-show-more\">\n\t\t\t\t${Loc.getMessage('JS_BIZPROC_AUTOMATION_BROKEN_LINK_MESSAGE_ERROR_MORE_INFO')}\n\t\t\t</span>\n\t\t`;\n\t\tEvent.bindOnce(showMoreLabel, 'click', () => {\n\t\t\tDom.style(moreInfoNode, 'height', moreInfoNode.scrollHeight + 'px');\n\t\t\tDom.remove(showMoreLabel);\n\t\t});\n\n\t\tconst closeBtn = Tag.render`<span class=\"ui-alert-close-btn\"></span>`;\n\n\t\tconst alert = Tag.render`\n\t\t\t<div class=\"ui-alert ui-alert-warning ui-alert-icon-info\">\n\t\t\t\t<div class=\"ui-alert-message\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span>${Loc.getMessage('BIZPROC_AUTOMATION_BROKEN_LINK_MESSAGE_ERROR')}</span>\n\t\t\t\t\t\t${showMoreLabel}\n\t\t\t\t\t</div>\n\t\t\t\t\t${moreInfoNode}\n\t\t\t\t</div>\n\t\t\t\t${closeBtn}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bindOnce(closeBtn, 'click', () => {Dom.remove(alert)});\n\n\t\treturn alert;\n\t}\n\n\tsaveRobotSettings(form, robot, callback, btnNode)\n\t{\n\t\tif (btnNode)\n\t\t{\n\t\t\tbtnNode.classList.add('popup-window-button-wait');\n\t\t}\n\n\t\tthis.onBeforeSaveRobotSettings();\n\t\tconst formData = BX.ajax.prepareForm(form);\n\n\t\tconst ajaxUrl = this.#context.ajaxUrl;\n\t\tconst documentSigned = this.#context.signedDocument;\n\t\tBX.ajax({\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\turl: Uri.addParam(\n\t\t\t\tajaxUrl,\n\t\t\t\t{\n\t\t\t\t\tanalyticsLabel: `automation_robot${robot.draft ? '_draft' : ''}_save_${robot.data.Type.toLowerCase()}`\n\t\t\t\t}\n\t\t\t),\n\t\t\tdata: {\n\t\t\t\tajax_action: 'save_robot_settings',\n\t\t\t\tdocument_signed: documentSigned,\n\t\t\t\trobot_json: Helper.toJsonString(robot.serialize()),\n\t\t\t\tform_data_json: Helper.toJsonString(formData['data']),\n\t\t\t\tform_data: formData['data'], /** @bug 0135641 */\n\t\t\t},\n\t\t\tonsuccess: response => {\n\t\t\t\tif (btnNode)\n\t\t\t\t{\n\t\t\t\t\tbtnNode.classList.remove('popup-window-button-wait');\n\t\t\t\t}\n\n\t\t\t\tif (response.SUCCESS)\n\t\t\t\t{\n\t\t\t\t\trobot.updateData(response.DATA.robot);\n\t\t\t\t\tthis.setDelaySettingsFromForm(formData['data'], robot);\n\t\t\t\t\tthis.setConditionSettingsFromForm(formData['data'], robot);\n\n\t\t\t\t\trobot.draft = false;\n\n\t\t\t\t\trobot.reInit();\n\t\t\t\t\tthis.markModified();\n\t\t\t\t\tif (callback)\n\t\t\t\t\t{\n\t\t\t\t\t\tcallback(response.DATA)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\talert(response.ERRORS[0]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tserialize()\n\t{\n\t\tconst data = BX.clone(this.#data);\n\t\tdata['IS_EXTERNAL_MODIFIED'] = this.isExternalModified() ? 1 : 0;\n\t\tdata['ROBOTS'] = [];\n\n\t\tfor (let i = 0; i < this.#robots.length; ++i)\n\t\t{\n\t\t\tdata['ROBOTS'].push(this.#robots[i].serialize());\n\t\t}\n\n\t\treturn data;\n\t}\n\n\tisExternalModified()\n\t{\n\t\treturn (this.externalModified === true);\n\t}\n\n\tmarkExternalModified(modified)\n\t{\n\t\tthis.externalModified = modified !== false;\n\t}\n\n\tgetRobotById(id)\n\t{\n\t\treturn this.#robots.find(robot => robot.getId() === id);\n\t}\n\n\tisModified()\n\t{\n\t\treturn this.modified;\n\t}\n\n\tmarkModified(modified)\n\t{\n\t\tthis.modified = modified !== false;\n\n\t\tif (this.modified)\n\t\t{\n\t\t\tthis.emit('Template:modified');\n\t\t}\n\t}\n\n\tgetConstants(): []\n\t{\n\t\tconst constants = [];\n\n\t\tObject.keys(this.#data.CONSTANTS).forEach(id => {\n\t\t\tconst constant = Runtime.clone(this.#data.CONSTANTS[id]);\n\n\t\t\tconstant.Id = id;\n\t\t\tconstant.ObjectId = 'Constant';\n\t\t\tconstant.SystemExpression = '{=Constant:' + id + '}';\n\t\t\tconstant.Expression = '{{~&:' + id + '}}';\n\n\t\t\tconstants.push(constant);\n\t\t});\n\n\t\treturn constants;\n\t}\n\n\tgetConstant(id)\n\t{\n\t\tconst constants = this.getConstants();\n\n\t\tfor (let i = 0; i < constants.length; ++i)\n\t\t{\n\t\t\tif (constants[i].Id === id)\n\t\t\t{\n\t\t\t\treturn constants[i];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddConstant(property)\n\t{\n\t\tconst id = property.Id || this.generatePropertyId('Constant', this.#data.CONSTANTS);\n\n\t\tif (this.#data.CONSTANTS[id])\n\t\t{\n\t\t\tthrow `Constant with id \"${id}\" is already exists`;\n\t\t}\n\n\t\tthis.#data.CONSTANTS[id] = property;\n\n\t\tthis.emit('Template:constant:add');\n\t\t// if (this.component)\n\t\t// {\n\t\t// \tBX.onCustomEvent(this.component, 'onTemplateConstantAdd', [this, this.getConstant(id)]);\n\t\t// }\n\n\t\treturn this.getConstant(id);\n\t}\n\n\tupdateConstant(id, property)\n\t{\n\t\tif (!this.#data.CONSTANTS[id])\n\t\t{\n\t\t\tthrow `Constant with id \"${id}\" does not exists`;\n\t\t}\n\n\t\t//TODO: only Description yet.\n\t\tthis.#data.CONSTANTS[id].Description = property.Description;\n\n\t\tthis.emit('Template:constant:update', {constant: this.getConstant(id)});\n\t\t// if (this.component)\n\t\t// {\n\t\t// \tBX.onCustomEvent(this.component, 'onTemplateConstantUpdate', [this, this.getConstant(id)]);\n\t\t// }\n\n\t\treturn this.getConstant(id);\n\t}\n\n\tdeleteConstant(id)\n\t{\n\t\tdelete this.#data.CONSTANTS[id];\n\n\t\treturn true;\n\t}\n\n\tsetConstantValue(id, value)\n\t{\n\t\tif (this.#data.CONSTANTS[id])\n\t\t{\n\t\t\tthis.#data.CONSTANTS[id]['Default'] = value;\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetParameters()\n\t{\n\t\tconst params = [];\n\n\t\tObject.keys(this.#data.PARAMETERS).forEach(id => {\n\t\t\tconst param = BX.clone(this.#data.PARAMETERS[id]);\n\n\t\t\tparam.Id = id;\n\t\t\tparam.ObjectId = 'Template';\n\t\t\tparam.SystemExpression = '{=Template:' + id + '}';\n\t\t\tparam.Expression = '{{~*:' + id + '}}';\n\n\t\t\tparams.push(param);\n\t\t});\n\n\t\treturn params;\n\t}\n\n\tgetParameter(id)\n\t{\n\t\tconst params = this.getParameters();\n\n\t\tfor (let i = 0; i < params.length; ++i)\n\t\t{\n\t\t\tif (params[i].Id === id)\n\t\t\t{\n\t\t\t\treturn params[i];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddParameter(property)\n\t{\n\t\tconst id = property.Id || this.generatePropertyId('Parameter', this.#data.PARAMETERS);\n\n\t\tif (this.#data.PARAMETERS[id])\n\t\t{\n\t\t\tthrow `Parameter with id \"${id}\" is already exists`;\n\t\t}\n\n\t\tthis.#data.PARAMETERS[id] = property;\n\n\t\tthis.emit('Template:parameter:add', {parameter: this.getParameter(id)});\n\t\t// if (this.component)\n\t\t// {\n\t\t// \tBX.onCustomEvent(this.component, 'onTemplateParameterAdd', [this, this.getParameter(id)]);\n\t\t// }\n\n\t\treturn this.getParameter(id);\n\t}\n\n\tupdateParameter(id, property)\n\t{\n\t\tif (!this.#data.PARAMETERS[id])\n\t\t{\n\t\t\tthrow `Parameter with id \"${id}\" does not exists`;\n\t\t}\n\n\t\t//TODO: only Description yet.\n\t\tthis.#data.PARAMETERS[id].Description = property.Description;\n\n\t\tthis.emit('Template:parameter:update', {parameter: this.getParameter(id)});\n\t\t// if (this.component)\n\t\t// {\n\t\t// \tBX.onCustomEvent(this.component, 'onTemplateParameterUpdate', [this, this.getParameter(id)]);\n\t\t// }\n\n\t\treturn this.getParameter(id);\n\t}\n\n\tdeleteParameter(id)\n\t{\n\t\tdelete this.#data.PARAMETERS[id];\n\n\t\treturn true;\n\t}\n\n\tsetParameterValue(id, value)\n\t{\n\t\tif (this.#data.PARAMETERS[id])\n\t\t{\n\t\t\tthis.#data.PARAMETERS[id]['Default'] = value;\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetVariables(): []\n\t{\n\t\tconst variables = [];\n\n\t\tObject.keys(this.#data.VARIABLES).forEach(id => {\n\t\t\tconst variable = Runtime.clone(this.#data.VARIABLES[id]);\n\n\t\t\tvariable.Id = id;\n\t\t\tvariable.ObjectId = 'Variable';\n\t\t\tvariable.SystemExpression = '{=Variable:' + id + '}';\n\t\t\tvariable.Expression = '{=Variable:' + id + '}';\n\n\t\t\tvariables.push(variable);\n\t\t});\n\n\t\treturn variables;\n\t}\n\n\tgeneratePropertyId(prefix, existsList)\n\t{\n\t\tlet index;\n\t\tfor(index = 1; index <= 1000; ++index)\n\t\t{\n\t\t\tif (!existsList[prefix + index])\n\t\t\t{\n\t\t\t\tbreak; //found\n\t\t\t}\n\t\t}\n\n\t\treturn prefix + index;\n\t}\n\n\tcollectUsages()\n\t{\n\t\tconst usages = {\n\t\t\tDocument: new Set(),\n\t\t\tConstant: new Set(),\n\t\t\tVariable: new Set(),\n\t\t\tParameter: new Set(),\n\t\t\tGlobalConstant: new Set(),\n\t\t\tGlobalVariable: new Set(),\n\t\t\tActivity: new Set()\n\t\t};\n\n\t\tthis.#robots.forEach(robot => {\n\t\t\tconst robotUsages = robot.collectUsages();\n\n\t\t\tObject.keys(usages).forEach(key => {\n\t\t\t\trobotUsages[key].forEach(usage => {\n\t\t\t\t\tif (!usages[key].has(usage))\n\t\t\t\t\t{\n\t\t\t\t\t\tusages[key].add(usage);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn usages;\n\t}\n\n\tsubscribeRobotEvents(eventName: string, listener: (BaseEvent) => void): this\n\t{\n\t\tthis.#robots.forEach(robot => robot.subscribe(eventName, listener))\n\n\t\treturn this;\n\t}\n\n\tunsubscribeRobotEvents(eventName: string, listener: (BaseEvent) => void)\n\t{\n\t\tthis.#robots.forEach(robot => robot.unsubscribe(eventName, listener));\n\n\t\treturn this;\n\t}\n\n\tgetRobotDescription(type: string): ?object\n\t{\n\t\treturn this.#context.availableRobots.find(item => item['CLASS'] === type);\n\t}\n\n\tget globalConstants(): []\n\t{\n\t\treturn this.#context.automationGlobals ? this.#context.automationGlobals.globalConstants : [];\n\t}\n\n\tget globalVariables(): []\n\t{\n\t\treturn this.#context.automationGlobals ? this.#context.automationGlobals.globalVariables : [];\n\t}\n}","import { Type } from 'main.core';\nimport { Operator } from 'bizproc.condition';\n\nexport class Condition\n{\n\t#object: string;\n\t#field: string;\n\t#operator: string;\n\t#value: string;\n\n\tparentGroup;\n\n\tconstructor(params: ?Object, group)\n\t{\n\t\tthis.#object = 'Document';\n\t\tthis.#field = '';\n\t\tthis.#operator = '!empty';\n\t\tthis.#value = '';\n\n\t\tthis.parentGroup = null;\n\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tif (params['object'])\n\t\t\t{\n\t\t\t\tthis.setObject(params['object']);\n\t\t\t}\n\t\t\tif (params['field'])\n\t\t\t{\n\t\t\t\tthis.setField(params['field']);\n\t\t\t}\n\t\t\tif (params['operator'])\n\t\t\t{\n\t\t\t\tthis.setOperator(params['operator']);\n\t\t\t}\n\t\t\tif ('value' in params)\n\t\t\t{\n\t\t\t\tthis.setValue(params['value']);\n\t\t\t}\n\t\t}\n\t\tif (group)\n\t\t{\n\t\t\tthis.parentGroup = group;\n\t\t}\n\t}\n\n\tclone(): Condition\n\t{\n\t\treturn new Condition(\n\t\t\t{\n\t\t\t\tobject: this.#object,\n\t\t\t\tfield: this.#field,\n\t\t\t\toperator: this.#operator,\n\t\t\t\tvalue: this.#value,\n\t\t\t},\n\t\t\tthis.parentGroup,\n\t\t);\n\t}\n\n\tsetObject(object)\n\t{\n\t\tif (Type.isStringFilled(object))\n\t\t{\n\t\t\tthis.#object = object;\n\t\t}\n\t}\n\n\tget object()\n\t{\n\t\treturn this.#object;\n\t}\n\n\tsetField(field)\n\t{\n\t\tif (Type.isStringFilled(field))\n\t\t{\n\t\t\tthis.#field = field;\n\t\t}\n\t}\n\n\tget field()\n\t{\n\t\treturn this.#field;\n\t}\n\n\tsetOperator(operator)\n\t{\n\t\tif (!operator)\n\t\t{\n\t\t\toperator = Operator.EQUAL;\n\t\t}\n\n\t\tthis.#operator = operator;\n\t}\n\n\tget operator(): string\n\t{\n\t\treturn this.#operator;\n\t}\n\n\tsetValue(value)\n\t{\n\t\tthis.#value = value;\n\t\tif (this.#operator === Operator.EQUAL && this.#value === '')\n\t\t{\n\t\t\tthis.#operator = 'empty';\n\t\t}\n\t\telse if (this.#operator === Operator.NOT_EQUAL && this.#value === '')\n\t\t{\n\t\t\tthis.#operator = '!empty';\n\t\t}\n\t}\n\n\tget value()\n\t{\n\t\treturn this.#value;\n\t}\n\n\tserialize(): Object\n\t{\n\t\treturn {\n\t\t\tobject: this.#object,\n\t\t\tfield: this.#field,\n\t\t\toperator: this.#operator,\n\t\t\tvalue: this.#value\n\t\t}\n\t}\n}","import { Type, Loc } from 'main.core';\nimport { Condition } from './condition';\nimport { ConditionNames } from './types';\nimport { Operator } from 'bizproc.condition';\n\nexport class ConditionGroup\n{\n\tstatic CONDITION_TYPE = {\n\t\tField: 'field',\n\t\tMixed: 'mixed',\n\t}\n\tstatic JOINER = {\n\t\tAnd: 'AND',\n\t\tOr: 'OR',\n\n\t\tmessage(type)\n\t\t{\n\t\t\tif (type === this.Or)\n\t\t\t{\n\t\t\t\treturn Loc.getMessage('BIZPROC_AUTOMATION_ROBOT_CONDITION_OR');\n\t\t\t}\n\n\t\t\treturn Loc.getMessage('BIZPROC_AUTOMATION_ROBOT_CONDITION_AND');\n\t\t}\n\t}\n\n\t#type: string;\n\t#items: Array<[Condition, string]>;\n\t#activityNames: ?ConditionNames;\n\n\tconstructor(params: ?Object)\n\t{\n\t\tthis.#type = ConditionGroup.CONDITION_TYPE.Field;\n\t\tthis.#items = [];\n\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tif (params['type'])\n\t\t\t{\n\t\t\t\tthis.#type = params['type'];\n\t\t\t}\n\t\t\tif (Type.isArray(params['items']))\n\t\t\t{\n\t\t\t\tparams['items'].forEach(item => {\n\t\t\t\t\tconst condition = new Condition(item[0], this);\n\t\t\t\t\tthis.addItem(condition, item[1]);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (Type.isPlainObject(params['activityNames']))\n\t\t\t{\n\t\t\t\tthis.#activityNames = params['activityNames'];\n\t\t\t}\n\t\t}\n\t}\n\n\tclone()\n\t{\n\t\tconst clonedGroup = new ConditionGroup({type: this.#type});\n\t\tthis.#items.forEach(([condition, joiner]) => {\n\t\t\tconst clonedCondition = condition.clone();\n\t\t\tclonedCondition.parentGroup = clonedGroup;\n\n\t\t\tclonedGroup.addItem(clonedCondition, joiner);\n\t\t});\n\n\t\treturn clonedGroup;\n\t}\n\n\tget conditionNamesList(): Array<string>\n\t{\n\t\tif (Type.isPlainObject(this.#activityNames))\n\t\t{\n\t\t\treturn [\n\t\t\t\tthis.#activityNames.Activity,\n\t\t\t\tthis.#activityNames.Branch1,\n\t\t\t\tthis.#activityNames.Branch2,\n\t\t\t];\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tget type()\n\t{\n\t\treturn this.#type;\n\t}\n\n\tset type(type: string)\n\t{\n\t\tif (Object.values(ConditionGroup.CONDITION_TYPE).includes(type))\n\t\t{\n\t\t\tthis.#type = type;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tget items()\n\t{\n\t\treturn this.#items;\n\t}\n\n\tstatic createFromForm(formFields, prefix)\n\t{\n\t\tconst conditionGroup = new ConditionGroup();\n\t\tif (!prefix)\n\t\t{\n\t\t\tprefix = 'condition_';\n\t\t}\n\n\t\tif (Type.isArray(formFields[prefix + 'field']))\n\t\t{\n\t\t\tfor (let i = 0, valueIndex = 0; i < formFields[prefix + 'field'].length; ++i, ++valueIndex)\n\t\t\t{\n\t\t\t\tif (formFields[prefix + 'field'][i] === '')\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst condition = new Condition({}, conditionGroup);\n\t\t\t\tcondition.setObject(formFields[prefix + 'object'][i]);\n\t\t\t\tcondition.setField(formFields[prefix + 'field'][i]);\n\t\t\t\tcondition.setOperator(formFields[prefix + 'operator'][i]);\n\n\t\t\t\tconst value =\n\t\t\t\t\tcondition.operator === Operator.BETWEEN\n\t\t\t\t\t\t? [formFields[prefix + 'value'][valueIndex], formFields[prefix + 'value'][valueIndex + 1]]\n\t\t\t\t\t\t: formFields[prefix + 'value'][valueIndex]\n\t\t\t\t;\n\t\t\t\tcondition.setValue(value);\n\n\t\t\t\tlet joiner = ConditionGroup.JOINER.And;\n\t\t\t\tif (formFields[prefix + 'joiner'] && formFields[prefix + 'joiner'][i] === ConditionGroup.JOINER.Or)\n\t\t\t\t{\n\t\t\t\t\tjoiner = ConditionGroup.JOINER.Or;\n\t\t\t\t}\n\n\t\t\t\tif (condition.operator === Operator.BETWEEN)\n\t\t\t\t{\n\t\t\t\t\tvalueIndex++;\n\t\t\t\t}\n\n\t\t\t\tconditionGroup.addItem(condition, joiner);\n\t\t\t}\n\t\t}\n\n\t\treturn conditionGroup;\n\t}\n\n\taddItem(condition, joiner)\n\t{\n\t\tthis.#items.push([condition, joiner]);\n\t}\n\n\tgetItems(): Array<Array<Condition, string>>\n\t{\n\t\treturn this.#items;\n\t}\n\n\tserialize()\n\t{\n\t\tconst itemsArray = [];\n\n\t\tthis.#items.forEach(item => {\n\t\t\tif (item.field !== '')\n\t\t\t{\n\t\t\t\titemsArray.push([item[0].serialize(), item[1]]);\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\ttype: this.#type,\n\t\t\titems: itemsArray,\n\t\t\tactivityNames: this.#activityNames,\n\t\t};\n\t}\n}","import {\n\tCondition,\n\tConditionGroup,\n\tDesigner,\n\tgetGlobalContext,\n\tInlineSelectorCondition,\n\tSelectorContext,\n\tSelectorManager,\n} from 'bizproc.automation';\nimport { Dom, Type, Event, Loc, Runtime, Tag, Text} from 'main.core';\n\nimport type { ConditionSelectorOptions } from './types';\nimport { BaseEvent } from 'main.core.events';\nimport { Operator } from \"bizproc.condition\";\n\nexport class ConditionSelector\n{\n\t#condition: ?Condition;\n\t#fields: Array<Object>;\n\t#joiner: string;\n\t#fieldPrefix: string;\n\t#rootGroupTitle: ?string;\n\t#onOpenFieldMenu: ?(BaseEvent) => void;\n\t#onOpenMenu: ?(BaseEvent) => void;\n\t#showValuesSelector: boolean;\n\n\tnode: ?HTMLElement;\n\tobjectNode: ?HTMLElement;\n\tfieldNode: ?HTMLElement;\n\tjoinerNode: ?HTMLElement;\n\tlabelNode: ?HTMLElement;\n\tvalueNode: ?HTMLElement;\n\t#valueNode2: ?HTMLElement = null;\n\n\tpopup: BX.PopupWindow;\n\tfieldDialog: ?InlineSelectorCondition;\n\t#selectedField;\n\n\tconstructor(condition, options: ?ConditionSelectorOptions)\n\t{\n\t\tthis.#condition = condition;\n\t\tthis.#fields = [];\n\t\tthis.#joiner = ConditionGroup.JOINER.And;\n\t\tthis.#fieldPrefix = 'condition_';\n\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tif (Type.isArray(options.fields))\n\t\t\t{\n\t\t\t\tthis.#fields = options.fields.map(field => {\n\t\t\t\t\tfield.ObjectId = 'Document';\n\n\t\t\t\t\treturn field;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (options.joiner && options.joiner === ConditionGroup.JOINER.Or)\n\t\t\t{\n\t\t\t\tthis.#joiner = ConditionGroup.JOINER.Or;\n\t\t\t}\n\t\t\tif (options.fieldPrefix)\n\t\t\t{\n\t\t\t\tthis.#fieldPrefix = options.fieldPrefix;\n\t\t\t}\n\n\t\t\tthis.#rootGroupTitle = options.rootGroupTitle;\n\t\t\tthis.#onOpenFieldMenu = options.onOpenFieldMenu;\n\t\t\tthis.#onOpenMenu = options.onOpenMenu;\n\t\t\tthis.#showValuesSelector = options.showValuesSelector ?? true;\n\t\t}\n\t}\n\n\tcreateNode()\n\t{\n\t\tconst conditionObjectNode = this.objectNode = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: \"hidden\",\n\t\t\t\tname: this.#fieldPrefix + \"object[]\",\n\t\t\t\tvalue: this.#condition.object\n\t\t\t}\n\t\t});\n\t\tconst conditionFieldNode = this.fieldNode = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: \"hidden\",\n\t\t\t\tname: this.#fieldPrefix + \"field[]\",\n\t\t\t\tvalue: this.#condition.field\n\t\t\t}\n\t\t});\n\t\tconst conditionOperatorNode = this.operatorNode = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: \"hidden\",\n\t\t\t\tname: this.#fieldPrefix + \"operator[]\",\n\t\t\t\tvalue: this.#condition.operator\n\t\t\t}\n\t\t});\n\n\t\tconst value = Type.isArrayFilled(this.#condition.value) ? this.#condition.value[0] : this.#condition.value;\n\t\tthis.valueNode = this.#createValueNode(value)\n\t\tconst conditionValueNode = this.valueNode;\n\n\t\tlet conditionValueNode2;\n\t\tif (this.#condition.operator === Operator.BETWEEN)\n\t\t{\n\t\t\tconst value2 =\n\t\t\t\t(Type.isArrayFilled(this.#condition.value) && this.#condition.value.length > 1)\n\t\t\t\t\t? this.#condition.value[1]\n\t\t\t\t\t: ''\n\t\t\t;\n\n\t\t\tthis.#valueNode2 = this.#createValueNode(value2);\n\t\t\tconditionValueNode2 = this.#valueNode2;\n\t\t}\n\n\t\tconst conditionJoinerNode = this.joinerNode = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: \"hidden\",\n\t\t\t\tname: this.#fieldPrefix + \"joiner[]\",\n\t\t\t\tvalue: this.#joiner\n\t\t\t}\n\t\t});\n\n\t\tconst labelNode = this.labelNode = Dom.create(\"span\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-settings-link-wrapper\"\n\t\t\t}\n\t\t});\n\n\t\tthis.setLabelText();\n\t\tthis.bindLabelNode();\n\n\t\tconst removeButtonNode = Dom.create(\"span\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-settings-link-remove\"\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: this.removeCondition.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tconst joinerButtonNode = Dom.create(\"span\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-settings-link bizproc-automation-condition-joiner\"\n\t\t\t},\n\t\t\ttext: ConditionGroup.JOINER.message(this.#joiner),\n\t\t});\n\n\t\tEvent.bind(joinerButtonNode, 'click', this.changeJoiner.bind(this, joinerButtonNode));\n\n\t\tthis.node = Dom.create(\"span\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings-link-wrapper bizproc-automation-condition-wrapper\" },\n\t\t\tchildren: [\n\t\t\t\tconditionObjectNode,\n\t\t\t\tconditionFieldNode,\n\t\t\t\tconditionOperatorNode,\n\t\t\t\tconditionValueNode,\n\t\t\t\tconditionValueNode2,\n\t\t\t\tconditionJoinerNode,\n\t\t\t\tlabelNode,\n\t\t\t\tremoveButtonNode,\n\t\t\t\tjoinerButtonNode\n\t\t\t]\n\t\t});\n\n\t\treturn this.node;\n\t}\n\n\t#createValueNode(value: string): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<input\n\t\t\t\ttype=\"hidden\"\n\t\t\t\tname=\"${Text.encode(this.#fieldPrefix + 'value[]')}\"\n\t\t\t\tvalue=\"${Text.encode(value)}\"\n\t\t\t>\n\t\t`;\n\t}\n\n\tinit(condition: Condition)\n\t{\n\t\tthis.#condition = condition;\n\t\tthis.setLabelText();\n\t\tthis.bindLabelNode();\n\t}\n\n\tsetLabelText()\n\t{\n\t\tif (!this.labelNode || !this.#condition)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.clean(this.labelNode);\n\n\t\tif (this.#condition.field !== '')\n\t\t{\n\t\t\tconst field = this.getField(this.#condition.object, this.#condition.field) || '?';\n\t\t\tconst valueLabel = this.#getValueLabel(field);\n\n\t\t\tDom.append(\n\t\t\t\tTag.render`<span class=\"bizproc-automation-popup-settings-link\">${Text.encode(field.Name)}</span>`,\n\t\t\t\tthis.labelNode\n\t\t\t);\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<span class=\"bizproc-automation-popup-settings-link\">\n\t\t\t\t\t\t${Text.encode(this.getOperatorLabel(this.#condition.operator))}\n\t\t\t\t\t</span>\n\t\t\t\t`,\n\t\t\t\tthis.labelNode\n\t\t\t);\n\n\t\t\tif (valueLabel)\n\t\t\t{\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<span class=\"bizproc-automation-popup-settings-link\">${Text.encode(valueLabel)}</span>`,\n\t\t\t\t\tthis.labelNode\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<span class=\"bizproc-automation-popup-settings-link\">\n\t\t\t\t\t\t${Text.encode(this.getOperatorLabel(Operator.EMPTY))}\n\t\t\t\t\t</span>\n\t\t\t\t`,\n\t\t\t\tthis.labelNode\n\t\t\t);\n\t\t}\n\t}\n\n\t#getValueLabel(field): ?string\n\t{\n\t\tconst operator = this.#condition.operator;\n\t\tconst value = this.#condition.value;\n\n\t\tif (operator === 'between')\n\t\t{\n\t\t\treturn (\n\t\t\t\tLoc.getMessage(\n\t\t\t\t'BIZPROC_AUTOMATION_ROBOT_CONDITION_BETWEEN_VALUE',\n\t\t\t\t\t{\n\t\t\t\t\t\t'#VALUE_1#': BX.Bizproc.FieldType.formatValuePrintable(\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\tType.isArrayFilled(value) ? value[0] : value\n\t\t\t\t\t\t),\n\t\t\t\t\t\t'#VALUE_2#': BX.Bizproc.FieldType.formatValuePrintable(\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\tType.isArrayFilled(value) ? value[1] : ''\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t?? ''\n\t\t\t);\n\t\t}\n\t\telse if(operator.indexOf('empty') < 0)\n\t\t{\n\t\t\treturn BX.Bizproc.FieldType.formatValuePrintable(field, value);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tbindLabelNode()\n\t{\n\t\tif (this.labelNode)\n\t\t{\n\t\t\tEvent.bind(this.labelNode, 'click', this.onLabelClick.bind(this));\n\t\t}\n\t}\n\n\tonLabelClick()\n\t{\n\t\tthis.showPopup();\n\t}\n\n\tshowPopup()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\treturn;\n\t\t}\n\n\t\tconst fields = this.filterFields();\n\n\t\tconst objectSelect = Dom.create('input', {\n\t\t\tattrs: {\n\t\t\t\ttype: 'hidden',\n\t\t\t\tclassName: 'bizproc-automation-popup-settings-dropdown'\n\t\t\t}\n\t\t});\n\t\tconst fieldSelect = Dom.create('input', {\n\t\t\tattrs: {\n\t\t\t\ttype: 'hidden',\n\t\t\t\tclassName: 'bizproc-automation-popup-settings-dropdown'\n\t\t\t}\n\t\t});\n\t\tconst fieldSelectLabel = Dom.create('div', {\n\t\t\tattrs: {\n\t\t\t\tclassName: 'bizproc-automation-popup-settings-dropdown',\n\t\t\t\treadonly: 'readonly'\n\t\t\t},\n\t\t\tchildren: [fieldSelect]\n\t\t});\n\n\t\tEvent.bind(\n\t\t\tfieldSelectLabel,\n\t\t\t'click',\n\t\t\tthis.onFieldSelectorClick.bind(this, fieldSelectLabel, fieldSelect, fields, objectSelect)\n\t\t);\n\n\t\tlet selectedField = this.getField(this.#condition.object, this.#condition.field);\n\t\tif (!this.#condition.field)\n\t\t{\n\t\t\tselectedField = fields[0];\n\t\t}\n\n\t\tthis.#selectedField = selectedField;\n\n\t\tfieldSelect.value = selectedField.Id;\n\t\tobjectSelect.value = selectedField.ObjectId;\n\t\tfieldSelectLabel.textContent = selectedField.Name;\n\n\t\tconst valueInput = this.#getValueNode(selectedField, this.#condition.value, this.#condition.operator);\n\n\t\tconst valueWrapper = Dom.create('div', {\n\t\t\tattrs: {\n\t\t\t\tclassName: 'bizproc-automation-popup-settings'\n\t\t\t},\n\t\t\tchildren: [valueInput]\n\t\t});\n\n\t\tconst operatorSelect = this.createOperatorNode(selectedField, valueWrapper);\n\t\tconst operatorWrapper = Dom.create('div', {\n\t\t\tattrs: {\n\t\t\t\tclassName: 'bizproc-automation-popup-settings'\n\t\t\t},\n\t\t\tchildren: [operatorSelect]\n\t\t});\n\n\t\tif (this.#condition.field !== '')\n\t\t{\n\t\t\toperatorSelect.value = this.#condition.operator;\n\t\t}\n\n\t\tconst form = Dom.create(\"form\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-select-block\" },\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'bizproc-automation-popup-settings'\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [fieldSelectLabel]\n\t\t\t\t}),\n\t\t\t\toperatorWrapper,\n\t\t\t\tvalueWrapper\n\t\t\t]\n\t\t});\n\n\t\tEvent.bind(fieldSelect, 'change', this.onFieldChange.bind(\n\t\t\tthis,\n\t\t\tfieldSelect,\n\t\t\toperatorWrapper,\n\t\t\tvalueWrapper,\n\t\t\tobjectSelect\n\t\t));\n\n\t\tconst self = this;\n\t\tthis.popup = new BX.PopupWindow('bizproc-automation-popup-set', this.labelNode, {\n\t\t\tclassName: 'bizproc-automation-popup-set',\n\t\t\tautoHide: false,\n\t\t\tcloseByEsc: true,\n\t\t\tcloseIcon: false,\n\t\t\ttitleBar: false,\n\t\t\tangle: true,\n\t\t\toffsetLeft: 45,\n\t\t\toverlay: { backgroundColor: 'transparent' },\n\t\t\tcontent: form,\n\t\t\tbuttons: [\n\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_CHOOSE'),\n\t\t\t\t\tclassName: \"webform-button webform-button-create\" ,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tself.#condition.setObject(objectSelect.value);\n\t\t\t\t\t\t\tself.#condition.setField(fieldSelect.value);\n\t\t\t\t\t\t\tself.#condition.setOperator(operatorWrapper.firstChild.value);\n\n\t\t\t\t\t\t\tconst valueInputs = valueWrapper.querySelectorAll('[name^=\"' + self.#fieldPrefix + 'value\"]');\n\n\t\t\t\t\t\t\tif (valueInputs.length > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet value = valueInputs[0].value;\n\n\t\t\t\t\t\t\t\tif (self.#condition.operator === Operator.BETWEEN && valueInputs.length > 1)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvalue = [valueInputs[0].value, valueInputs[1].value];\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tself.#condition.setValue(value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tself.#condition.setValue('');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tself.setLabelText();\n\n\t\t\t\t\t\t\tconst field = self.getField(self.#condition.object, self.#condition.field);\n\t\t\t\t\t\t\tif (field && field.Type === 'UF:address')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst input = valueWrapper.querySelector('[name=\"' + self.#fieldPrefix + 'value\"]');\n\t\t\t\t\t\t\t\tself.#condition.setValue(input ? input.value : '');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself.updateValueNode();\n\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.PopupWindowButtonLink({\n\t\t\t\t\ttext : Loc.getMessage('JS_CORE_WINDOW_CANCEL'),\n\t\t\t\t\tclassName : \"popup-window-button-link-cancel\",\n\t\t\t\t\tevents : {\n\t\t\t\t\t\tclick()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.popupWindow.close()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tonPopupClose()\n\t\t\t\t{\n\t\t\t\t\tthis.destroy();\n\t\t\t\t\tif (self.fieldDialog)\n\t\t\t\t\t{\n\t\t\t\t\t\tself.fieldDialog.destroy();\n\t\t\t\t\t\tdelete(self.fieldDialog);\n\t\t\t\t\t}\n\t\t\t\t\tdelete(self.popup);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.popup.show();\n\t}\n\n\tonFieldSelectorClick(fieldSelectLabel, fieldSelect, fields, objectSelect, event)\n\t{\n\t\tif (!this.fieldDialog)\n\t\t{\n\t\t\tconst globalContext = getGlobalContext();\n\t\t\tconst fields = Runtime.clone(\n\t\t\t\tType.isArrayFilled(this.#fields) ? this.#fields : globalContext.document.getFields()\n\t\t\t);\n\n\t\t\tthis.fieldDialog = new InlineSelectorCondition({\n\t\t\t\tcontext: new SelectorContext({\n\t\t\t\t\tfields,\n\t\t\t\t\trootGroupTitle: globalContext.document.title,\n\t\t\t\t}),\n\t\t\t\tcondition: this.#condition,\n\t\t\t});\n\n\t\t\tif (Type.isFunction(this.#onOpenFieldMenu))\n\t\t\t{\n\t\t\t\tthis.fieldDialog.subscribe('onOpenMenu', this.#onOpenFieldMenu);\n\t\t\t}\n\n\t\t\tthis.fieldDialog.subscribe('change', (event) => {\n\t\t\t\tconst property = event.getData().field;\n\t\t\t\tfieldSelectLabel.textContent = property.Name\n\t\t\t\tfieldSelect.value = property.Id;\n\t\t\t\tobjectSelect.value = property.ObjectId;\n\t\t\t\tBX.fireEvent(fieldSelect, 'change');\n\t\t\t});\n\n\t\t\tthis.fieldDialog.renderTo(fieldSelectLabel);\n\t\t}\n\n\t\tthis.fieldDialog.openMenu(event);\n\t}\n\n\tupdateValueNode()\n\t{\n\t\tif (this.#condition)\n\t\t{\n\t\t\tif (this.objectNode)\n\t\t\t{\n\t\t\t\tthis.objectNode.value = this.#condition.object;\n\t\t\t}\n\t\t\tif (this.fieldNode)\n\t\t\t{\n\t\t\t\tthis.fieldNode.value = this.#condition.field;\n\t\t\t}\n\t\t\tif (this.operatorNode)\n\t\t\t{\n\t\t\t\tthis.operatorNode.value = this.#condition.operator;\n\t\t\t}\n\t\t\tif (this.valueNode)\n\t\t\t{\n\t\t\t\tthis.valueNode.value = Type.isArrayFilled(this.#condition.value) ? this.#condition.value[0] : this.#condition.value;\n\t\t\t}\n\n\t\t\tif (this.#condition.operator === Operator.BETWEEN)\n\t\t\t{\n\t\t\t\tconst value2 = this.#condition.value[1] || '';\n\t\t\t\tif (this.#valueNode2)\n\t\t\t\t{\n\t\t\t\t\tthis.#valueNode2.value = value2;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#valueNode2 = this.#createValueNode(value2);\n\t\t\t\t\tDom.append(this.#valueNode2, this.node);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (Type.isDomNode(this.#valueNode2))\n\t\t\t{\n\t\t\t\tDom.remove(this.#valueNode2);\n\t\t\t\tthis.#valueNode2 = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tonFieldChange(selectNode: Node, conditionWrapper: Node, valueWrapper: Node, objectSelect)\n\t{\n\t\tconst field = this.getField(objectSelect.value, selectNode.value);\n\t\tconst operatorNode = this.createOperatorNode(field, valueWrapper);\n\n\t\t//clean value if field types are different\n\t\tif (field.Type !== this.#selectedField?.Type)\n\t\t{\n\t\t\tDom.clean(valueWrapper);\n\t\t}\n\t\tthis.#selectedField = field;\n\n\t\t//keep selected operator if possible\n\t\tif (this.getOperators(field['Type'], field['Multiple'])[conditionWrapper.firstChild.value])\n\t\t{\n\t\t\toperatorNode.value = conditionWrapper.firstChild.value;\n\t\t}\n\n\t\tconditionWrapper.replaceChild(operatorNode, conditionWrapper.firstChild);\n\t\tthis.onOperatorChange(operatorNode, field, valueWrapper);\n\t}\n\n\tonOperatorChange(selectNode: Node, field: Object, valueWrapper: HTMLElement)\n\t{\n\t\tconst valueInput = valueWrapper.querySelector('[name^=\"' + this.#fieldPrefix + 'value\"]');\n\t\tDom.clean(valueWrapper);\n\n\t\tDom.append(\n\t\t\tthis.#getValueNode(field, valueInput?.value || this.#condition.value, selectNode.value),\n\t\t\tvalueWrapper\n\t\t);\n\t}\n\n\t#getValueNode(field: {}, value, operator: string): any\n\t{\n\t\tif (operator === Operator.BETWEEN)\n\t\t{\n\t\t\tconst valueNode1 = this.createValueNode(field, Type.isArrayFilled(value) ? value[0] : value);\n\t\t\tconst valueNode2 = this.createValueNode(field, Type.isArrayFilled(value) ? value[1] : '');\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t${valueNode1}\n\t\t\t\t\t<div>${ConditionGroup.JOINER.message('AND')}</div>\n\t\t\t\t\t${valueNode2}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse if (operator.indexOf('empty') < 0)\n\t\t{\n\t\t\treturn this.createValueNode(field, value);\n\t\t}\n\n\t\treturn '';\n\t}\n\n\t// TODO - fix this method\n\tgetField(object, id)\n\t{\n\t\tlet field;\n\t\tconst robot = Designer.getInstance().robot;\n\t\tconst component = Designer.getInstance().component;\n\t\tconst tpl = robot? robot.getTemplate() : null;\n\n\t\tswitch (object)\n\t\t{\n\t\t\tcase 'Document':\n\t\t\t\tfor (let i = 0; i < this.#fields.length; ++i)\n\t\t\t\t{\n\t\t\t\t\tif (id === this.#fields[i].Id)\n\t\t\t\t\t{\n\t\t\t\t\t\tfield = this.#fields[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'Template':\n\t\t\t\tif (tpl && component && component.triggerManager)\n\t\t\t\t{\n\t\t\t\t\tfield = component.triggerManager.getReturnProperty(tpl.getStatusId(), id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'Constant':\n\t\t\t\tif (tpl)\n\t\t\t\t{\n\t\t\t\t\tfield = tpl.getConstant(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'GlobalConst':\n\t\t\t\tif (component)\n\t\t\t\t{\n\t\t\t\t\tfield = component.getConstant(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'GlobalVar':\n\t\t\t\tif (component)\n\t\t\t\t{\n\t\t\t\t\tfield = component.getGVariable(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tvar foundRobot = tpl? tpl.getRobotById(object) : null;\n\t\t\t\tif (foundRobot)\n\t\t\t\t{\n\t\t\t\t\tfield = foundRobot.getReturnProperty(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn field || {\n\t\t\tId: id,\n\t\t\tObjectId: object,\n\t\t\tName: id,\n\t\t\tType: 'string',\n\t\t\tExpression: id,\n\t\t\tSystemExpression: '{='+object+':'+id+'}'\n\t\t};\n\t}\n\n\tgetOperators(fieldType, multiple): {}\n\t{\n\t\tconst allLabels = Operator.getAllLabels();\n\n\t\tlet list = {\n\t\t\t'!empty': allLabels[Operator.NOT_EMPTY],\n\t\t\t'empty': allLabels[Operator.EMPTY],\n\t\t\t'=': allLabels[Operator.EQUAL],\n\t\t\t'!=': allLabels[Operator.NOT_EQUAL],\n\t\t};\n\t\tswitch (fieldType)\n\t\t{\n\t\t\tcase 'file':\n\t\t\tcase 'UF:crm':\n\t\t\tcase 'UF:resourcebooking':\n\t\t\t\tlist = {\n\t\t\t\t\t'!empty': allLabels[Operator.NOT_EMPTY],\n\t\t\t\t\t'empty': allLabels[Operator.EMPTY],\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase 'bool':\n\t\t\tcase 'select':\n\t\t\t\tif (multiple)\n\t\t\t\t{\n\t\t\t\t\tlist[Operator.CONTAIN] = allLabels[Operator.CONTAIN];\n\t\t\t\t\tlist[Operator.NOT_CONTAIN] = allLabels[Operator.NOT_CONTAIN];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t//TODO: render multiple select in value selector\n\t\t\t\t\t//list['in'] = Loc.getMessage('BIZPROC_AUTOMATION_ROBOT_CONDITION_IN');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'user':\n\t\t\t\tlist[Operator.IN] = allLabels[Operator.IN];\n\t\t\t\tlist[Operator.NOT_IN] = allLabels[Operator.NOT_IN];\n\t\t\t\tlist[Operator.CONTAIN] = allLabels[Operator.CONTAIN];\n\t\t\t\tlist[Operator.NOT_CONTAIN] = allLabels[Operator.NOT_CONTAIN];\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tlist[Operator.IN] = allLabels[Operator.IN];\n\t\t\t\tlist[Operator.NOT_IN] = allLabels[Operator.NOT_IN];\n\t\t\t\tlist[Operator.CONTAIN] = allLabels[Operator.CONTAIN];\n\t\t\t\tlist[Operator.NOT_CONTAIN] = allLabels[Operator.NOT_CONTAIN];\n\t\t\t\tlist[Operator.GREATER_THEN] = allLabels[Operator.GREATER_THEN];\n\t\t\t\tlist[Operator.GREATER_THEN_OR_EQUAL] = allLabels[Operator.GREATER_THEN_OR_EQUAL];\n\t\t\t\tlist[Operator.LESS_THEN] = allLabels[Operator.LESS_THEN];\n\t\t\t\tlist[Operator.LESS_THEN_OR_EQUAL] = allLabels[Operator.LESS_THEN_OR_EQUAL];\n\t\t}\n\n\t\t// todo: interface\n\t\t// if (['time', 'date', 'datetime', 'int', 'double'].includes(fieldType) || Type.isUndefined(fieldType))\n\t\t// {\n\t\t// \tlist[Operator.BETWEEN] = allLabels[Operator.BETWEEN];\n\t\t// }\n\n\t\treturn list;\n\t}\n\n\tgetOperatorLabel(id): string\n\t{\n\t\treturn Operator.getOperatorLabel(id);\n\t}\n\n\tfilterFields()\n\t{\n\t\tconst filtered = [];\n\t\tfor (let i = 0; i < this.#fields.length; ++i)\n\t\t{\n\t\t\tconst type = this.#fields[i]['Type'];\n\n\t\t\tif (\n\t\t\t\ttype === 'bool'\n\t\t\t\t|| type === 'date'\n\t\t\t\t|| type === 'datetime'\n\t\t\t\t|| type === 'double'\n\t\t\t\t|| type === 'file'\n\t\t\t\t|| type === 'int'\n\t\t\t\t|| type === 'select'\n\t\t\t\t|| type === 'string'\n\t\t\t\t|| type === 'text'\n\t\t\t\t|| type === 'user'\n\t\t\t\t|| type === 'UF:money'\n\t\t\t\t|| type === 'UF:crm'\n\t\t\t\t|| type === 'UF:resourcebooking'\n\t\t\t\t|| type === 'UF:url'\n\t\t\t)\n\t\t\t{\n\t\t\t\tfiltered.push(this.#fields[i]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t//TODO add support of custom types\n\t\t\t}\n\t\t}\n\n\t\treturn filtered;\n\t}\n\n\tcreateValueNode(docField, value)\n\t{\n\t\tconst docType = (\n\t\t\tDesigner.getInstance().component\n\t\t\t\t? Designer.getInstance().component.document.getRawType()\n\t\t\t\t: getGlobalContext().document.getRawType()\n\t\t);\n\t\tconst field = BX.clone(docField);\n\t\tfield.Multiple = false;\n\n\t\tconst valueNodes = BX.Bizproc.FieldType.renderControlPublic(\n\t\t\tdocType,\n\t\t\tfield,\n\t\t\tthis.#fieldPrefix + 'value',\n\t\t\tvalue,\n\t\t\tfalse\n\t\t);\n\n\t\tvalueNodes.querySelectorAll('[data-role]').forEach((node) => {\n\t\t\tconst selector = SelectorManager.createSelectorByRole(node.dataset.role, {\n\t\t\t\tcontext: new SelectorContext({\n\t\t\t\t\tfields: getGlobalContext().document.getFields(),\n\t\t\t\t\tuseSwitcherMenu: false,\n\t\t\t\t\trootGroupTitle: this.#rootGroupTitle ?? getGlobalContext().document.title,\n\t\t\t\t}),\n\t\t\t});\n\n\t\t\tif (selector)\n\t\t\t{\n\t\t\t\tif (this.#showValuesSelector === true)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isFunction(this.#onOpenMenu))\n\t\t\t\t\t{\n\t\t\t\t\t\tselector.subscribe('onOpenMenu', this.#onOpenMenu);\n\t\t\t\t\t}\n\t\t\t\t\tselector.renderTo(node);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tselector.targetInput = node;\n\t\t\t\t\tselector.parseTargetProperties();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn valueNodes;\n\t}\n\n\tcreateOperatorNode(field, valueWrapper)\n\t{\n\t\tconst select = Dom.create('select', {\n\t\t\tattrs: {className: 'bizproc-automation-popup-settings-dropdown'}\n\t\t});\n\n\t\tconst operatorList = this.getOperators(field['Type'], field['Multiple']);\n\t\tfor (var operatorId in operatorList)\n\t\t{\n\t\t\tif (!operatorList.hasOwnProperty(operatorId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tselect.appendChild(Dom.create('option', {\n\t\t\t\tprops: {value: operatorId},\n\t\t\t\ttext: operatorList[operatorId]\n\t\t\t}));\n\t\t}\n\n\t\tEvent.bind(select, 'change', this.onOperatorChange.bind(\n\t\t\tthis,\n\t\t\tselect,\n\t\t\tfield,\n\t\t\tvalueWrapper\n\t\t));\n\n\t\treturn select;\n\t}\n\n\tremoveCondition(event: Event)\n\t{\n\t\tthis.#condition = null;\n\t\tDom.remove(this.node);\n\n\t\tthis.labelNode = null;\n\t\tthis.fieldNode = null;\n\t\tthis.operatorNode = null;\n\t\tthis.valueNode = null;\n\t\tthis.#valueNode2 = null;\n\t\tthis.node = null;\n\n\t\tevent.stopPropagation();\n\t}\n\n\tchangeJoiner(btn: Element, event: Event)\n\t{\n\t\tthis.#joiner = (this.#joiner === ConditionGroup.JOINER.Or ? ConditionGroup.JOINER.And : ConditionGroup.JOINER.Or);\n\t\tbtn.textContent = ConditionGroup.JOINER.message(this.#joiner);\n\n\t\tif (this.joinerNode)\n\t\t{\n\t\t\tthis.joinerNode.value = this.#joiner;\n\t\t}\n\n\t\tevent.preventDefault();\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n}","import { Type, Dom } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\n\nimport { ConditionGroup } from 'bizproc.automation';\nimport { ConditionSelector } from './condition-selector';\nimport { Condition } from 'bizproc.automation';\n\nexport class ConditionGroupSelector\n{\n\t#conditionGroup: ConditionGroup;\n\t#fields: Array<Object>;\n\t#fieldPrefix: string;\n\t#itemSelectors: Array<ConditionSelector>;\n\t#onOpenFieldMenu: ?(BaseEvent) => void;\n\t#onOpenMenu: ?(BaseEvent) => void;\n\t#showValuesSelector: boolean;\n\t#rootGroupTitle: ?string;\n\n\tconstructor(conditionGroup: ConditionGroup, options: Object)\n\t{\n\t\tthis.#conditionGroup = conditionGroup;\n\t\tthis.#fields = [];\n\t\tthis.#fieldPrefix = 'condition_';\n\t\tthis.#itemSelectors = [];\n\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tif (Type.isArray(options.fields))\n\t\t\t{\n\t\t\t\tthis.#fields = options.fields;\n\t\t\t}\n\t\t\tif (options.fieldPrefix)\n\t\t\t{\n\t\t\t\tthis.#fieldPrefix = options.fieldPrefix;\n\t\t\t}\n\n\t\t\tthis.#rootGroupTitle = options.rootGroupTitle\n\t\t\tthis.#onOpenFieldMenu = options.onOpenFieldMenu;\n\t\t\tthis.#onOpenMenu = options.onOpenMenu;\n\t\t\tthis.#showValuesSelector = options.showValuesSelector ?? true;\n\t\t}\n\t}\n\n\tcreateNode()\n\t{\n\t\tconst conditionNodes = [];\n\n\t\tthis.#conditionGroup.getItems().forEach((item) => {\n\t\t\tconst conditionSelector = new ConditionSelector(item[0], {\n\t\t\t\tfields: this.#fields,\n\t\t\t\tjoiner: item[1],\n\t\t\t\tfieldPrefix: this.#fieldPrefix,\n\t\t\t\trootGroupTitle: this.#rootGroupTitle,\n\t\t\t\tonOpenFieldMenu: this.#onOpenFieldMenu,\n\t\t\t\tonOpenMenu: this.#onOpenMenu,\n\t\t\t\tshowValuesSelector: this.#showValuesSelector,\n\t\t\t});\n\n\t\t\tthis.#itemSelectors.push(conditionSelector);\n\t\t\tconditionNodes.push(conditionSelector.createNode());\n\t\t});\n\n\t\tconst self = this;\n\t\tconditionNodes.push(Dom.create(\"a\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings-link\" },\n\t\t\ttext: '[+]',\n\t\t\tevents: {\n\t\t\t\tclick()\n\t\t\t\t{\n\t\t\t\t\tself.addItem(this);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\treturn Dom.create(\"span\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings-link-wrapper\" },\n\t\t\tchildren: conditionNodes\n\t\t});\n\t}\n\n\taddItem(buttonNode)\n\t{\n\t\tconst conditionSelector = new ConditionSelector(new Condition({}, this.#conditionGroup), {\n\t\t\tfields: this.#fields,\n\t\t\tfieldPrefix: this.#fieldPrefix,\n\t\t\trootGroupTitle: this.#rootGroupTitle,\n\t\t\tonOpenFieldMenu: this.#onOpenFieldMenu,\n\t\t\tonOpenMenu: this.#onOpenMenu,\n\t\t\tshowValuesSelector: this.#showValuesSelector,\n\t\t});\n\t\tthis.#itemSelectors.push(conditionSelector);\n\n\t\tbuttonNode.parentNode.insertBefore(conditionSelector.createNode(), buttonNode);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#itemSelectors.forEach(selector => selector.destroy());\n\t\tthis.#itemSelectors = [];\n\t}\n}","import {\n\tDesigner,\n\tFileSelector,\n\tInlineSelector,\n\tInlineSelectorHtml,\n\tSaveStateCheckbox,\n\tTimeSelector,\n\tUserSelector,\n} from 'bizproc.automation';\nimport {Type} from \"main.core\";\n\nexport class Manager\n{\n\tstatic SELECTOR_ROLE_USER = 'user-selector';\n\tstatic SELECTOR_ROLE_FILE = 'file-selector';\n\tstatic SELECTOR_ROLE_INLINE = 'inline-selector-target';\n\tstatic SELECTOR_ROLE_INLINE_HTML = 'inline-selector-html';\n\tstatic SELECTOR_ROLE_TIME = 'time-selector';\n\tstatic SELECTOR_ROLE_SAVE_STATE = 'save-state-checkbox';\n\n\tstatic getSelectorByTarget(targetInput: HTMLElement): ?InlineSelector\n\t{\n\t\t// TODO - save created selectors with Manager\n\t\tconst template = Designer.getInstance().getRobotSettingsDialog()?.template;\n\n\t\tif (template && Type.isArray(template.robotSettingsControls))\n\t\t{\n\t\t\treturn template.robotSettingsControls.find(selector => selector.targetInput === targetInput);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tstatic createSelectorByRole(role: string, selectorProps: object): InlineSelector | SaveStateCheckbox\n\t{\n\t\tif (role === this.SELECTOR_ROLE_USER)\n\t\t{\n\t\t\treturn new UserSelector(selectorProps);\n\t\t}\n\t\telse if (role === this.SELECTOR_ROLE_FILE)\n\t\t{\n\t\t\treturn new FileSelector(selectorProps);\n\t\t}\n\t\telse if (role === this.SELECTOR_ROLE_INLINE)\n\t\t{\n\t\t\treturn new InlineSelector(selectorProps);\n\t\t}\n\t\telse if (role === this.SELECTOR_ROLE_INLINE_HTML)\n\t\t{\n\t\t\treturn new InlineSelectorHtml(selectorProps);\n\t\t}\n\t\telse if (role === this.SELECTOR_ROLE_TIME)\n\t\t{\n\t\t\treturn new TimeSelector(selectorProps);\n\t\t}\n\t\telse if (role === this.SELECTOR_ROLE_SAVE_STATE)\n\t\t{\n\t\t\treturn new SaveStateCheckbox(selectorProps);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn undefined;\n\t\t}\n\t}\n}","import {Type, Event, Loc, Text} from 'main.core';\nimport {DateTimeFormat} from 'main.date';\nimport { Menu } from 'main.popup';\n\nexport class InlineTimeSelector\n{\n\t#labelNode: HTMLInputElement = null;\n\n\t#time: string = '';\n\n\t#timeValues: [] = [];\n\t#timeFormat: string;\n\n\t#selector: Menu;\n\n\tconstructor(options: {\n\t\tlabelNode: HTMLInputElement,\n\t})\n\t{\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tif (Type.isElementNode(options.labelNode))\n\t\t\t{\n\t\t\t\tthis.#labelNode = options.labelNode;\n\t\t\t}\n\t\t}\n\n\t\tthis.#fillTimeFormat();\n\t\tthis.#fillTimeValues();\n\t}\n\n\t#fillTimeFormat()\n\t{\n\t\tconst getFormat = (formatId) => (\n\t\t\tBX.Main.Date.convertBitrixFormat(Loc.getMessage(formatId)).replace(/:?\\s*s/, '')\n\t\t);\n\n\t\tconst dateFormat = getFormat('FORMAT_DATE');\n\t\tconst dateTimeFormat = getFormat('FORMAT_DATETIME');\n\t\tthis.#timeFormat = dateTimeFormat.replace(dateFormat, '').trim();\n\t}\n\n\t#fillTimeValues()\n\t{\n\t\tconst self = this;\n\t\tconst onclick = function(event, item)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\tself.#labelNode.value = Text.encode(item.text);\n\t\t\tthis.close();\n\t\t};\n\n\t\tfor (let hour = 0; hour < 24; hour++)\n\t\t{\n\t\t\tthis.#timeValues.push({\n\t\t\t\tid: hour * 60,\n\t\t\t\ttext: this.#formatTime(hour, 0),\n\t\t\t\tonclick: onclick\n\t\t\t});\n\t\t\tthis.#timeValues.push({\n\t\t\t\tid: hour * 60 + 30,\n\t\t\t\ttext: this.#formatTime(hour, 30),\n\t\t\t\tonclick: onclick\n\t\t\t});\n\t\t}\n\t}\n\n\t#formatTime(hour, minute): string\n\t{\n\t\tconst date = new Date();\n\t\tdate.setHours(hour, minute);\n\n\t\treturn DateTimeFormat.format(this.#timeFormat, date.getTime() / 1000);\n\t}\n\n\tinit(time: string)\n\t{\n\t\tif (Type.isStringFilled(time))\n\t\t{\n\t\t\tthis.#time = time;\n\t\t}\n\n\t\tthis.#setLabelText();\n\t\tthis.#bindLabelNode();\n\t}\n\n\t#setLabelText()\n\t{\n\t\tif (Type.isElementNode(this.#labelNode))\n\t\t{\n\t\t\tthis.#labelNode.textContent = this.#time;\n\t\t}\n\t}\n\n\t#bindLabelNode()\n\t{\n\t\tif (Type.isElementNode(this.#labelNode))\n\t\t{\n\t\t\tEvent.bind(this.#labelNode, 'click', this.#onLabelClick.bind(this));\n\t\t}\n\t}\n\n\t#onLabelClick(event)\n\t{\n\t\tthis.#showTimeSelector();\n\t\tevent.preventDefault();\n\t}\n\n\t#showTimeSelector()\n\t{\n\t\tif (Type.isNil(this.#selector))\n\t\t{\n\t\t\tthis.#selector = new Menu({\n\t\t\t\tautoHide: true,\n\t\t\t\tbindElement: this.#labelNode,\n\t\t\t\titems: this.#timeValues,\n\t\t\t\tmaxHeight: 230,\n\t\t\t})\n\t\t}\n\n\t\tthis.#selector.show();\n\t}\n}","import { SelectorContext, DelayIntervalSelector, Helper, DelayInterval } from 'bizproc.automation';\nimport { Dom, Event, Type, Loc, Tag, Runtime } from \"main.core\";\nimport { EventEmitter } from \"main.core.events\";\n\nimport { Field, MenuGroupItem }  from \"./types\";\nimport { MenuManager, Menu } from 'main.popup';\nimport { Dialog } from 'ui.entity-selector';\nimport {InlineTimeSelector} from \"./inline-time-selector\";\n\nexport class InlineSelector extends EventEmitter\n{\n\tcontext: SelectorContext;\n\tfieldProperty: ?Field = null;\n\treplaceOnWrite: boolean = false;\n\tmenuButton: ?HTMLSpanElement = null;\n\ttargetInput: ?HTMLElement = null;\n\t#menuGroups: Object<string, MenuGroupItem> = {};\n\tbasisFields: Array<Object> = [];\n\t#dialog: ?Dialog = null;\n\t#switcherDialog: ?Menu = null;\n\n\tconstructor(props: { context: SelectorContext })\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Automation.Selector');\n\n\t\tthis.context = props.context;\n\t\tthis.basisFields = this.context.fields;\n\t}\n\n\thasGroup(groupId: string): boolean\n\t{\n\t\treturn this.#menuGroups.hasOwnProperty(groupId);\n\t}\n\n\taddGroup(groupId: string, group: MenuGroupItem)\n\t{\n\t\tthis.#menuGroups[groupId] = this.#normalizeGroup(group);\n\t}\n\n\taddGroupItem(groupId: string, item: MenuGroupItem)\n\t{\n\t\tif (this.hasGroup(groupId))\n\t\t{\n\t\t\tthis.#menuGroups[groupId].children.push(this.#normalizeGroup(item));\n\t\t}\n\t}\n\n\t#normalizeGroup(group: MenuGroupItem)\n\t{\n\t\tif (!Type.isArray(group.children))\n\t\t{\n\t\t\tgroup.children = [];\n\t\t}\n\n\t\tgroup.children = (\n\t\t\tgroup\n\t\t\t\t.children\n\t\t\t\t.filter(item => item.customData?.field ? this.#shouldShowField(item.customData.field) : true)\n\t\t\t\t.map(childGroup => this.#normalizeGroup(childGroup))\n\t\t);\n\n\t\treturn {\n\t\t\tentityId: 'bp',\n\t\t\ttabs: 'recents',\n\t\t\t...group\n\t\t};\n\t}\n\n\trenderWith(targetInput: Element): HTMLDivElement\n\t{\n\t\tthis.targetInput = Runtime.clone(targetInput);\n\t\tthis.targetInput.setAttribute('autocomplete', 'off');\n\n\t\tthis.menuButton = Tag.render`\n\t\t\t<span \n\t\t\t\tonclick=\"${this.openMenu.bind(this)}\"\n\t\t\t\tclass=\"bizproc-automation-popup-select-dotted\"\n\t\t\t></span>\n\t\t`;\n\n\t\tthis.parseTargetProperties();\n\n\t\tthis.replaceOnWrite |= (this.targetInput.getAttribute('data-select-mode') === 'replace');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-select\">\n\t\t\t\t${this.targetInput}\n\t\t\t\t${this.menuButton}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderTo(targetInput: Element): void\n\t{\n\t\ttargetInput.parentNode.replaceChild(this.renderWith(targetInput), targetInput);\n\t}\n\n\tbindTargetEvents(): void\n\t{\n\t\tEvent.bind(this.targetInput, 'keydown', this.#onKeyDown.bind(this));\n\t}\n\n\tparseTargetProperties(): void\n\t{\n\t\tthis.fieldProperty = JSON.parse(this.targetInput.getAttribute('data-property'));\n\t\tconst propertyType = this.targetInput.getAttribute('data-selector-type');\n\n\t\tif (!this.fieldProperty && propertyType)\n\t\t{\n\t\t\tthis.fieldProperty = {Type: propertyType};\n\t\t}\n\n\t\tif (this.fieldProperty)\n\t\t{\n\t\t\tthis.fieldProperty.Type = this.fieldProperty.Type || propertyType;\n\t\t\tthis.#prepareSelectorUsingFieldType();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.context.useSwitcherMenu = false;\n\t\t}\n\n\t\tthis.replaceOnWrite |= (this.targetInput.getAttribute('data-select-mode') === 'replace');\n\t}\n\n\t#prepareSelectorUsingFieldType(): void\n\t{\n\t\tthis.basisFields = this.basisFields.filter(field => this.#shouldShowField(field));\n\n\t\tconst type = this.fieldProperty?.Type;\n\t\tif (type === 'file')\n\t\t{\n\t\t\tthis.replaceOnWrite = true;\n\t\t}\n\t\telse if (type === 'date' || type === 'datetime')\n\t\t{\n\t\t\tthis.replaceOnWrite = true;\n\n\t\t\tconst delayIntervalSelector = new DelayIntervalSelector({\n\t\t\t\tlabelNode: this.targetInput,\n\t\t\t\tbasisFields: this.basisFields,\n\t\t\t\tuseAfterBasis: true,\n\t\t\t\tonchange: (function(delay)\n\t\t\t\t{\n\t\t\t\t\tthis.targetInput.value = delay.toExpression(\n\t\t\t\t\t\tthis.basisFields,\n\t\t\t\t\t\tHelper.getResponsibleUserExpression(this.context.fields)\n\t\t\t\t\t);\n\t\t\t\t}).bind(this)\n\t\t\t});\n\n\t\t\tdelayIntervalSelector.init(DelayInterval.fromString(this.targetInput.value, this.basisFields));\n\t\t}\n\t\telse if (type === 'time')\n\t\t{\n\t\t\tthis.replaceOnWrite = true;\n\n\t\t\tconst timeSelector = new InlineTimeSelector({labelNode: this.targetInput});\n\n\t\t\ttimeSelector.init(this.targetInput.value);\n\t\t}\n\t}\n\n\t#shouldShowField(field: Field): boolean\n\t{\n\t\tconst fieldType = this.fieldProperty?.Type;\n\t\tif (fieldType === 'file')\n\t\t{\n\t\t\treturn field.Type === 'file';\n\t\t}\n\t\telse if (fieldType === 'date' || fieldType === 'datetime')\n\t\t{\n\t\t\treturn field.Type === 'date' || field.Type === 'datetime';\n\t\t}\n\t\telse if (fieldType === 'time')\n\t\t{\n\t\t\treturn field.Type === 'date' || field.Type === 'datetime' || field.Type === 'time';\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#onKeyDown(event: KeyboardEvent)\n\t{\n\t\tif (event.keyCode === 45 && event.altKey === false && event.ctrlKey === false && event.shiftKey === false)\n\t\t{\n\t\t\tthis.openMenu(event);\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\topenMenu(event: KeyboardEvent, skipPropertiesSwitcher: boolean = false)\n\t{\n\t\tif (!skipPropertiesSwitcher && this.context.useSwitcherMenu && !this.targetInput.value)\n\t\t{\n\t\t\treturn this.openPropertiesSwitcherMenu();\n\t\t}\n\n\t\tif (this.#dialog)\n\t\t{\n\t\t\tthis.#dialog.show();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fillGroups();\n\t\tthis.onMenuOpen();\n\n\t\tlet menuItems = [];\n\t\tfor (const group of Object.values(this.#menuGroups))\n\t\t{\n\t\t\tif (group.children.length > 0)\n\t\t\t{\n\t\t\t\tmenuItems.push(group);\n\t\t\t}\n\t\t}\n\n\t\tif (menuItems.length === 1)\n\t\t{\n\t\t\tmenuItems = menuItems[0].children;\n\t\t}\n\n\t\tlet menuId = this.menuButton.getAttribute('data-selector-id');\n\t\tif (!menuId)\n\t\t{\n\t\t\tmenuId = Helper.generateUniqueId();\n\t\t\tthis.menuButton.setAttribute('data-selector-id', menuId);\n\t\t}\n\n\t\tthis.#dialog = new Dialog({\n\t\t\ttargetNode: this.menuButton,\n\t\t\twidth: 500,\n\t\t\theight: 300,\n\t\t\tmultiple: false,\n\t\t\tdropdownMode: true,\n\t\t\tenableSearch: true,\n\t\t\titems: this.injectDialogMenuTitles(menuItems),\n\t\t\tshowAvatars: false,\n\t\t\tevents: {\n\t\t\t\t'Item:onBeforeSelect': (event) => {\n\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\tconst item = event.getData().item;\n\t\t\t\t\tthis.onFieldSelect(item.getCustomData().get('field'));\n\t\t\t\t}\n\t\t\t},\n\t\t\tcompactView: true,\n\t\t});\n\n\t\tthis.#dialog.show();\n\t}\n\n\tfillGroups(): void\n\t{\n\t\tthis.fillFieldsGroups();\n\t\tthis.fillFileGroup();\n\t}\n\n\tfillFieldsGroups(): void\n\t{\n\t\tthis.addGroup('ROOT', {\n\t\t\tid: 'ROOT',\n\t\t\ttitle: this.context.rootGroupTitle,\n\t\t\tsearchable: false,\n\t\t});\n\n\t\tthis.getFields().forEach((field) => {\n\t\t\tlet groupKey = field.Id.indexOf('.') < 0 ? 'ROOT' : field.Id.split('.')[0];\n\t\t\tlet groupName = '';\n\t\t\tlet fieldName = field.Name;\n\n\t\t\tif (field.Name && groupKey !== 'ROOT' && field.Name.indexOf(': ') >= 0)\n\t\t\t{\n\t\t\t\tconst names = field.Name.split(': ');\n\t\t\t\tgroupName = names.shift();\n\t\t\t\tfieldName = names.join(': ');\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tfield['Id'].indexOf('ASSIGNED_BY_') === 0\n\t\t\t\t&& field['Id'] !== 'ASSIGNED_BY_ID'\n\t\t\t\t&& field['Id'] !== 'ASSIGNED_BY_PRINTABLE'\n\t\t\t)\n\t\t\t{\n\t\t\t\tgroupKey = 'ASSIGNED_BY';\n\t\t\t\tconst names = field.Name.split(' ');\n\t\t\t\tgroupName = names.shift();\n\t\t\t\tfieldName = names.join(' ').replace('(', '').replace(')', '');\n\t\t\t}\n\n\t\t\tif (!this.hasGroup(groupKey))\n\t\t\t{\n\t\t\t\tthis.addGroup(groupKey, {\n\t\t\t\t\tid: groupKey,\n\t\t\t\t\ttitle: groupName,\n\t\t\t\t\tsearchable: false,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.addGroupItem(groupKey, {\n\t\t\t\tid: field.SystemExpression,\n\t\t\t\ttitle: fieldName || field.Id,\n\t\t\t\tcustomData: {field},\n\t\t\t});\n\t\t});\n\t}\n\n\tfillFileGroup(): void\n\t{\n\t\tconst fileFields = this.getFields().filter((field) => field.Type === 'file');\n\n\t\tif (fileFields.length > 0)\n\t\t{\n\t\t\tthis.addGroup('__FILES', {\n\t\t\t\tid: '__FILES',\n\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_FILES_LINKS'),\n\t\t\t\tchildren: this.#prepareFilesMenu(fileFields),\n\t\t\t\tsearchable: false,\n\t\t\t});\n\t\t}\n\t}\n\n\t#prepareFilesMenu(fileFields: Array<Field>): Array<MenuGroupItem>\n\t{\n\t\treturn fileFields.map((field) => {\n\t\t\tconst exp = (\n\t\t\t\tfield['ObjectId'] === 'Document'\n\t\t\t\t\t? '{{'+field['Name']+' > shortlink}}'\n\t\t\t\t\t: '{{~'+field['ObjectId']+':'+field['Id']+' > shortlink}}'\n\t\t\t);\n\n\t\t\tlet title = field.Name || field.Id;\n\n\t\t\tif (field.ObjectName)\n\t\t\t{\n\t\t\t\ttitle = field.ObjectName + ': ' + title;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttitle: title,\n\t\t\t\tcustomData: {\n\t\t\t\t\tfield: {\n\t\t\t\t\t\tId: field['Id'] + '_shortlink',\n\t\t\t\t\t\tObjectId: field['ObjectId'],\n\t\t\t\t\t\tName: field['Name'],\n\t\t\t\t\t\tType: 'string',\n\t\t\t\t\t\tExpression: exp,\n\t\t\t\t\t\tSystemExpression: '{='+field['ObjectId']+':'+field['Id']+' > shortlink}'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tid: exp,\n\t\t\t};\n\t\t});\n\t}\n\n\tonMenuOpen(): void\n\t{\n\t\tthis.emit('onOpenMenu', { selector: this });\n\t}\n\n\topenPropertiesSwitcherMenu()\n\t{\n\t\tconst self = this;\n\n\t\tMenuManager.show(\n\t\t\tHelper.generateUniqueId(),\n\t\t\tthis.menuButton,\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_ASK_CONSTANT'),\n\t\t\t\t\tdisabled: self.fieldProperty?.Type === 'file',\n\t\t\t\t\tonclick(event) {\n\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\tself.emit('onAskConstant', {fieldProperty: self.fieldProperty});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_ASK_PARAMETER'),\n\t\t\t\t\tonclick(event) {\n\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\tself.emit('onAskParameter', {fieldProperty: self.fieldProperty});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_ASK_MANUAL'),\n\t\t\t\t\tonclick(event) {\n\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\tself.openMenu(event, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: 20,\n\t\t\t\tangle: { position: 'top'},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.#switcherDialog = MenuManager.currentItem;\n\n\t\treturn true;\n\t}\n\n\tinjectDialogMenuTitles(items)\n\t{\n\t\titems.forEach((parent) => {\n\t\t\tif (Type.isArray(parent.children))\n\t\t\t{\n\t\t\t\tthis.injectDialogMenuSupertitles(parent.title, parent.children);\n\t\t\t}\n\t\t});\n\n\t\treturn items;\n\t}\n\n\tinjectDialogMenuSupertitles(title: string, children)\n\t{\n\t\tchildren.forEach((child) => {\n\t\t\tif (!child.supertitle)\n\t\t\t{\n\t\t\t\tchild.supertitle = title;\n\t\t\t}\n\t\t\tif (Type.isArrayFilled(child.children))\n\t\t\t{\n\t\t\t\tthis.injectDialogMenuSupertitles(child.title, child.children);\n\t\t\t}\n\t\t});\n\t}\n\n\tonFieldSelect(field: ?Field): void\n\t{\n\t\tif (!field)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst inputType = this.targetInput.tagName.toLowerCase();\n\n\t\tif (inputType === 'select')\n\t\t{\n\t\t\tlet expressionOption = this.targetInput.querySelector('[data-role=\"expression\"]');\n\t\t\tif (!expressionOption)\n\t\t\t{\n\t\t\t\texpressionOption = (\n\t\t\t\t\tthis.targetInput.appendChild(\n\t\t\t\t\t\tDom.create(\n\t\t\t\t\t\t\t'option',\n\t\t\t\t\t\t\t{attrs: {'data-role': 'expression'}}\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t\texpressionOption.setAttribute('value', field.Expression);\n\t\t\texpressionOption.textContent = field['Expression'];\n\n\t\t\texpressionOption.selected = true;\n\t\t}\n\t\telse if (inputType === 'label')\n\t\t{\n\t\t\tthis.targetInput.textContent = field.Expression;\n\t\t\tconst hiddenInput = document.getElementById(this.targetInput.getAttribute('for'));\n\t\t\tif (hiddenInput)\n\t\t\t{\n\t\t\t\thiddenInput.value = field.Expression;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.replaceOnWrite)\n\t\t\t{\n\t\t\t\tthis.targetInput.value = field.Expression;\n\t\t\t\tthis.targetInput.selectionEnd = this.targetInput.value.length;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet beforePart = '';\n\t\t\t\tconst middlePart = field.Expression;\n\t\t\t\tlet afterPart = '';\n\t\t\t\tif (Type.isStringFilled(this.targetInput.value))\n\t\t\t\t{\n\t\t\t\t\tbeforePart = this.targetInput.value.substr(0, this.targetInput.selectionEnd);\n\t\t\t\t\tafterPart = this.targetInput.value.substr(this.targetInput.selectionEnd);\n\t\t\t\t}\n\n\t\t\t\tthis.targetInput.value = beforePart + middlePart + afterPart;\n\t\t\t\tthis.targetInput.selectionEnd = beforePart.length + middlePart.length;\n\t\t\t}\n\t\t}\n\n\t\tBX.fireEvent(this.targetInput, 'change');\n\t\tthis.emit('Field:Selected', { field });\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.#dialog)\n\t\t{\n\t\t\tthis.#dialog.destroy();\n\t\t}\n\t\tif (this.#switcherDialog)\n\t\t{\n\t\t\tthis.#switcherDialog.destroy();\n\t\t}\n\t}\n\n\tgetFields(): Array<Field>\n\t{\n\t\tconst printablePrefix = Loc.getMessage('BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX');\n\t\tconst names = this.context.fields.map(field => field.Name).join('\\n');\n\n\t\tconst fields = [];\n\t\tthis.basisFields.forEach((field) => {\n\t\t\tfield.ObjectId = 'Document';\n\n\t\t\tconst custom = (field['BaseType'] === 'string' && field['Type'] !== 'string');\n\n\t\t\tif (!custom)\n\t\t\t{\n\t\t\t\tfields.push(field);\n\t\t\t}\n\n\t\t\t//generate printable version\n\t\t\tif (\n\t\t\t\tfield['Type'] === 'user'\n\t\t\t\t||\n\t\t\t\tfield['Type'] === 'bool'\n\t\t\t\t||\n\t\t\t\tfield['Type'] === 'file'\n\t\t\t\t||\n\t\t\t\tcustom\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst printableName = field['Name'] + ' ' + printablePrefix;\n\n\t\t\t\tif (names.indexOf(printableName) < 0)\n\t\t\t\t{\n\t\t\t\t\tconst printableField = BX.clone(field);\n\t\t\t\t\tconst printableTag = (field['Type'] === 'user') ? 'friendly' : 'printable';\n\n\t\t\t\t\tprintableField['Name'] = printableName;\n\t\t\t\t\tprintableField['Type'] = 'string';\n\t\t\t\t\tprintableField['SystemExpression'] = '{=Document:'+printableField['Id']+' > '+printableTag+'}';\n\t\t\t\t\tprintableField['Expression'] = '{{'+field['Name']+' > '+printableTag+'}}';\n\n\t\t\t\t\tfields.push(printableField);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (field['BaseType'] === 'date' || field['BaseType'] === 'datetime' || field['BaseType'] === 'time')\n\t\t\t{\n\t\t\t\tconst serverField = BX.clone(field);\n\t\t\t\tserverField['Name'] += ' ' + Loc.getMessage('BIZPROC_AUTOMATION_CMP_MOD_DATE_BY_SERVER');\n\t\t\t\tserverField['Type'] = 'string';\n\t\t\t\tserverField['SystemExpression'] = `{=Document:${serverField['Id']} > server}`;\n\t\t\t\tserverField['Expression'] = `{{${field['Name']} > server}}`;\n\n\t\t\t\tfields.push(serverField);\n\n\t\t\t\tconst responsibleField = BX.clone(field);\n\t\t\t\tresponsibleField['Name'] += ' ' + Loc.getMessage('BIZPROC_AUTOMATION_CMP_MOD_DATE_BY_RESPONSIBLE');\n\t\t\t\tresponsibleField['Type'] = 'string';\n\t\t\t\tresponsibleField['SystemExpression'] = `{=Document:${serverField['Id']} > responsible}`;\n\t\t\t\tresponsibleField['Expression'] = `{{${field['Name']} > responsible}}`;\n\n\t\t\t\tfields.push(responsibleField);\n\t\t\t}\n\t\t});\n\n\t\treturn fields;\n\t}\n}","import { SelectorContext, Condition, ConditionGroup } from 'bizproc.automation';\nimport { InlineSelector } from './inline-selector';\nimport { Field } from './types';\n\nexport class InlineSelectorCondition extends InlineSelector\n{\n\t#condition: Condition;\n\n\tconstructor(props: {\n\t\tcontext: SelectorContext,\n\t\tcondition: Condition,\n\t})\n\t{\n\t\tsuper(props);\n\n\t\tthis.#condition = props.condition;\n\t}\n\n\trenderTo(target: Element)\n\t{\n\t\tthis.targetInput = target;\n\t\tthis.menuButton = target;\n\n\t\tthis.parseTargetProperties();\n\t\tthis.bindTargetEvents();\n\t}\n\n\tfillGroups(): void\n\t{\n\t\tthis.fillFieldsGroups();\n\t}\n\n\tonMenuOpen(): void\n\t{\n\t\tthis.emit('onOpenMenu', {\n\t\t\tselector: this,\n\t\t\t// TODO - rename\n\t\t\tisMixedCondition: this.#isMixedConditionGroup(),\n\t\t});\n\t}\n\n\tonFieldSelect(field: ?Field)\n\t{\n\t\tthis.emit('change', { field });\n\t}\n\n\t#isMixedConditionGroup(): boolean\n\t{\n\t\treturn (\n\t\t\tthis.#condition\n\t\t\t&& this.#condition.parentGroup\n\t\t\t&& this.#condition.parentGroup.type === ConditionGroup.CONDITION_TYPE.Mixed\n\t\t);\n\t}\n\n\tgetFields(): Array<Field>\n\t{\n\t\treturn this.context.fields.map((field) => ({\n\t\t\t...field,\n\t\t\tObjectId: 'Document',\n\t\t}));\n\t}\n}","import { Tag } from 'main.core';\nimport { Field } from './types';\nimport { InlineSelector } from './inline-selector';\n\nexport class InlineSelectorHtml extends InlineSelector\n{\n\t#editorNode: ?BXHtmlEditor;\n\t#eventHandlers = {\n\t\t'OnEditorInitedAfter': this.#bindEditorHooks.bind(this),\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#unbindEvents();\n\t}\n\n\trenderTo(targetInput: Element)\n\t{\n\t\tthis.targetInput = targetInput;\n\t\tthis.#editorNode = targetInput.querySelector('.bx-html-editor');\n\t\tthis.menuButton = Tag.render`\n\t\t\t<span\n\t\t\t\tonclick=\"${this.openMenu.bind(this)}\"\n\t\t\t\tclass=\"bizproc-automation-popup-select-dotted\"\n\t\t\t></span>\n\t\t`;\n\n\t\tthis.parseTargetProperties();\n\t\tthis.bindTargetEvents()\n\n\t\ttargetInput.firstElementChild.appendChild(this.menuButton);\n\n\t\tthis.#bindEvents();\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tfor (const [name, handler] of Object.entries(this.#eventHandlers))\n\t\t{\n\t\t\tBX.addCustomEvent(name, handler);\n\t\t}\n\t}\n\n\t#unbindEvents(): void\n\t{\n\t\tfor (const [name, handler] of Object.entries(this.#eventHandlers))\n\t\t{\n\t\t\tBX.removeCustomEvent(name, handler);\n\t\t}\n\t}\n\n\t#bindEditorHooks(editor): void\n\t{\n\t\tif (editor.dom.cont !== this.#editorNode)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet header = '';\n\t\tlet footer = '';\n\n\t\tconst cutHeader = (content: string, shouldSaveHeader: boolean = false) => {\n\t\t\treturn content.replace(/(^[\\s\\S]*?)(<body.*?>)/i, (str) => {\n\t\t\t\tif (shouldSaveHeader)\n\t\t\t\t{\n\t\t\t\t\theader = str;\n\t\t\t\t}\n\n\t\t\t\treturn '';\n\t\t\t});\n\t\t};\n\n\t\tconst cutFooter = (content: string, shouldSaveFooter: boolean = false) => {\n\t\t\treturn content.replace(/(<\\/body>[\\s\\S]*?$)/i, (str) => {\n\t\t\t\tif (shouldSaveFooter)\n\t\t\t\t{\n\t\t\t\t\tfooter = str;\n\t\t\t\t}\n\n\t\t\t\treturn '';\n\t\t\t});\n\t\t}\n\n\t\tBX.addCustomEvent(editor, 'OnParse', function (mode)\n\t\t{\n\t\t\tif (!mode)\n\t\t\t{\n\t\t\t\tthis.content = cutFooter(cutHeader(this.content, true), true);\n\t\t\t}\n\t\t});\n\n\t\tBX.addCustomEvent(editor, 'OnAfterParse', function (mode)\n\t\t{\n\t\t\tif (mode)\n\t\t\t{\n\t\t\t\tlet content = cutFooter(cutHeader(this.content));\n\n\t\t\t\tif (header !== '' && footer !== '')\n\t\t\t\t{\n\t\t\t\t\tcontent = header + content + footer;\n\t\t\t\t}\n\n\t\t\t\tthis.content = content;\n\t\t\t}\n\t\t});\n\t}\n\n\tonFieldSelect(field: ?Field): void\n\t{\n\t\tconst insertText = field.Expression;\n\t\tconst editor = this.#getEditor();\n\n\t\tif (editor && editor.InsertHtml)\n\t\t{\n\t\t\tif (editor.synchro.IsFocusedOnTextarea())\n\t\t\t{\n\t\t\t\teditor.textareaView.Focus();\n\t\t\t\teditor.textareaView.WrapWith('', '', insertText);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\teditor.InsertHtml(insertText);\n\t\t\t}\n\t\t\teditor.synchro.Sync();\n\t\t}\n\t}\n\n\tonBeforeSave(): void\n\t{\n\t\tconst editor = this.#getEditor();\n\t\tif (editor && editor.SaveContent)\n\t\t{\n\t\t\teditor.SaveContent();\n\t\t}\n\t}\n\n\tonPopupResize()\n\t{\n\t\tconst editor = this.#getEditor();\n\t\tif (editor && editor.ResizeSceleton)\n\t\t{\n\t\t\teditor.ResizeSceleton();\n\t\t}\n\t}\n\n\t#getEditor(): ?BXHtmlEditor\n\t{\n\t\tif (this.#editorNode)\n\t\t{\n\t\t\tconst editorId = this.#editorNode.id.split('-');\n\t\t\treturn BXHtmlEditor.Get(editorId[editorId.length - 1]);\n\t\t}\n\n\t\treturn null;\n\t}\n}","import { SelectorContext } from 'bizproc.automation';\n\nexport class SaveStateCheckbox\n{\n\t#context: SelectorContext;\n\t#checkbox: Element;\n\t#needSync: boolean;\n\n\tconstructor(props: {\n\t\tcontext: SelectorContext,\n\t\tcheckbox: Element,\n\t\tneedSync: boolean,\n\t})\n\t{\n\t\tthis.#context = props.context;\n\t\tthis.#checkbox = props.checkbox;\n\t\tthis.#needSync = props.needSync;\n\n\t\tif (props.needSync)\n\t\t{\n\t\t\tconst category = 'save_state_checkbox';\n\t\t\tconst savedState = this.#context.get('userOptions').get(category, this.#getKey(), 'N');\n\t\t\tif (savedState === 'Y')\n\t\t\t{\n\t\t\t\tthis.#checkbox.checked = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tdestroy(): void\n\t{\n\t\tif (this.#needSync)\n\t\t{\n\t\t\tthis.#context.get('userOptions').set('save_state_checkboxes', this.#getKey(), this.#getValue());\n\t\t}\n\t}\n\n\t#getKey(): ?string\n\t{\n\t\treturn this.#checkbox.getAttribute('data-save-state-key');\n\t}\n\n\t#getValue(): string\n\t{\n\t\treturn this.#checkbox.checked ? 'Y'\t : 'N';\n\t}\n}","import { Type } from 'main.core';\nimport { InlineSelector } from './inline-selector';\n\nexport class UserSelector extends InlineSelector\n{\n\trenderTo(targetInput: Element)\n\t{\n\t\tthis.targetInput = targetInput;\n\t\tthis.menuButton = targetInput;\n\n\t\tthis.fieldProperty = JSON.parse(targetInput.getAttribute('data-property'));\n\t\tif (!this.fieldProperty)\n\t\t{\n\t\t\tthis.context.useSwitcherMenu = false;\n\t\t}\n\n\t\tconst additionalUserFields = this.context.get('additionalUserFields');\n\t\tthis.userSelector = BX.Bizproc.UserSelector.decorateNode(\n\t\t\ttargetInput,\n\t\t\t{\n\t\t\t\tadditionalFields: Type.isArray(additionalUserFields) ? additionalUserFields : [],\n\t\t\t},\n\t\t);\n\t}\n\n\tdestroy()\n\t{\n\t\tsuper.destroy();\n\n\t\tif (this.userSelector)\n\t\t{\n\t\t\tthis.userSelector.destroy();\n\t\t\tthis.userSelector = null;\n\t\t}\n\t}\n}","import { Type, Runtime, Tag, Dom, Event, Text, Loc } from 'main.core';\nimport { MenuManager } from 'main.popup';\nimport { SelectorContext, Helper } from 'bizproc.automation';\nimport { InlineSelector } from './inline-selector';\n\nexport class FileSelector extends InlineSelector\n{\n\tstatic TYPE = {\n\t\tNone: '',\n\t\tDisk: 'disk',\n\t\tFile: 'file',\n\t}\n\n\t#type: string = FileSelector.TYPE.None;\n\t#multiple: boolean = false;\n\t#required: boolean = false;\n\t#valueInputName: string = '';\n\t#typeInputName: string = '';\n\t#useDisk: boolean = false;\n\t#label: string = '';\n\t#labelFile: string = '';\n\t#labelDisk: string = '';\n\n\t#diskUploader: ?BX.Bizproc.Automation.DiskUploader = null;\n\n\t#diskControllerNode: ?HTMLDivElement = null;\n\t#fileItemsNode: ?HTMLSpanElement = null;\n\t#fileControllerNode: ?HTMLDivElement = null;\n\n\t#menuId: ?string;\n\n\tconstructor(props: { context: SelectorContext })\n\t{\n\t\tsuper(props);\n\n\t\tthis.context.set(\n\t\t\t'fileFields',\n\t\t\tthis.context.fields.filter(field => field.Type === 'file'),\n\t\t);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.menu)\n\t\t{\n\t\t\tthis.menu.popupWindow.close();\n\t\t}\n\t}\n\n\trenderTo(targetInput: Element)\n\t{\n\t\tthis.targetInput = targetInput;\n\n\t\tconst selected = this.parseTargetProperties();\n\n\t\tthis.targetInput.appendChild(this.#createBaseNode());\n\t\tthis.#showTypeControlLayout(selected);\n\t\t// this.setFileFields()\n\t\t// this.createDom\n\t}\n\n\tparseTargetProperties()\n\t{\n\t\tlet config = JSON.parse(this.targetInput.getAttribute('data-config'));\n\t\tif (!Type.isPlainObject(config))\n\t\t{\n\t\t\tconfig = {};\n\t\t}\n\n\t\tthis.#type = config.type || FileSelector.TYPE.File;\n\t\tif (config.selected && !config.selected.length)\n\t\t{\n\t\t\tthis.#type = FileSelector.TYPE.None;\n\t\t}\n\n\t\tthis.#multiple = config.multiple || false;\n\t\tthis.#required = config.required || false;\n\t\tthis.#valueInputName = config.valueInputName || '';\n\t\tthis.#typeInputName = config.typeInputName || '';\n\t\tthis.#useDisk = config.useDisk || false;\n\t\tthis.#label = config.label || 'Attachment';\n\t\tthis.#labelFile = config.labelFile || 'File';\n\t\tthis.#labelDisk = config.labelDisk || 'Disk';\n\n\t\tif (config.selected && config.selected.length > 0)\n\t\t{\n\t\t\treturn Runtime.clone(config.selected);\n\t\t}\n\t}\n\n\t#createBaseNode(): HTMLDivElement\n\t{\n\t\tconst idSalt = Helper.generateUniqueId();\n\t\tlet fileRadio = null;\n\n\t\tconst fileTypeOptions = [];\n\n\t\tif (this.context.get('fileFields').length > 0)\n\t\t{\n\t\t\tfileRadio = Tag.render`\n\t\t\t\t<input\n\t\t\t\t\tid=\"type-1${idSalt}\"\n\t\t\t\t\tclass=\"bizproc-automation-popup-select-input\"\n\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\tname=\"${this.#typeInputName}\"\n\t\t\t\t\tvalue=\"${FileSelector.TYPE.File}\"\n\t\t\t\t\t${this.#type === FileSelector.TYPE.File ? 'checked' : ''}\n\t\t\t\t/>\n\t\t\t`;\n\t\t}\n\n\t\tconst diskFileRadio = Tag.render`\n\t\t\t<input\n\t\t\t\tid=\"type-2${idSalt}\"\n\t\t\t\tclass=\"bizproc-automation-popup-select-input\"\n\t\t\t\ttype=\"radio\"\n\t\t\t\tname=\"${this.#typeInputName}\"\n\t\t\t\tvalue=\"${FileSelector.TYPE.Disk}\"\n\t\t\t\t${this.#type === FileSelector.TYPE.Disk ? 'checked' : ''}\n\t\t\t/>\n\t\t`;\n\n\t\tfileTypeOptions.push(Tag.render`\n\t\t\t<span class=\"bizproc-automation-popup-settings-title\">${this.#label}:</span>\n\t\t`);\n\n\t\tif (fileRadio)\n\t\t{\n\t\t\tfileTypeOptions.push(fileRadio, Tag.render`\n\t\t\t\t<label\n\t\t\t\t\tclass=\"bizproc-automation-popup-settings-link\"\n\t\t\t\t\tfor=\"type-1${idSalt}\"\n\t\t\t\t\tonclick=\"${this.#onTypeChange.bind(this, FileSelector.TYPE.File)}\"\n\t\t\t\t>\n\t\t\t\t${this.#labelFile}\n\t\t\t\t</label>\n\t\t\t`);\n\t\t}\n\n\t\tfileTypeOptions.push(diskFileRadio, Tag.render`\n\t\t\t<label\n\t\t\t\tclass=\"bizproc-automation-popup-settings-link\"\n\t\t\t\tfor=\"type-2${idSalt}\"\n\t\t\t\tonclick=\"${this.#onTypeChange.bind(this, FileSelector.TYPE.Disk)}\"\n\t\t\t>\n\t\t\t${this.#labelDisk}\n\t\t\t</label>\n\t\t`);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-settings-block\">\n\t\t\t\t${fileTypeOptions}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#showTypeControlLayout(selected: Array): void\n\t{\n\t\tif (this.#type === FileSelector.TYPE.Disk)\n\t\t{\n\t\t\tthis.#hideFileControllerLayout();\n\t\t\tthis.#showDiskControllerLayout(selected);\n\t\t}\n\t\telse if (this.#type === FileSelector.TYPE.File)\n\t\t{\n\t\t\tthis.#hideDiskControllerLayout();\n\t\t\tthis.#showFileControllerLayout(selected);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#hideFileControllerLayout();\n\t\t\tthis.#hideDiskControllerLayout();\n\t\t}\n\t}\n\n\t#showDiskControllerLayout(selected: Array): void\n\t{\n\t\tif (!this.#diskControllerNode)\n\t\t{\n\t\t\tthis.#diskControllerNode = Dom.create('div');\n\n\t\t\tthis.targetInput.appendChild(this.#diskControllerNode);\n\n\t\t\tconst diskUploader = this.#getDiskUploader();\n\t\t\tdiskUploader.layout(this.#diskControllerNode);\n\t\t\tdiskUploader.show(true);\n\n\t\t\tif (selected)\n\t\t\t{\n\t\t\t\tthis.addItems(selected);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(this.#diskControllerNode);\n\t\t}\n\t}\n\n\t#hideDiskControllerLayout(): void\n\t{\n\t\tif (this.#diskControllerNode)\n\t\t{\n\t\t\tDom.hide(this.#diskControllerNode);\n\t\t}\n\t}\n\n\t#showFileControllerLayout(selected: Array): void\n\t{\n\t\tif (!this.#fileControllerNode)\n\t\t{\n\t\t\tthis.#fileItemsNode = Dom.create('span');\n\t\t\tthis.#fileControllerNode = Dom.create('div', {children: [this.#fileItemsNode]});\n\t\t\tthis.targetInput.appendChild(this.#fileControllerNode);\n\t\t\tconst addButtonNode = Dom.create('a', {\n\t\t\t\tattrs: {className: 'bizproc-automation-popup-settings-link bizproc-automation-popup-settings-link-thin'},\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_ADD')\n\t\t\t});\n\n\t\t\tthis.#fileControllerNode.appendChild(addButtonNode);\n\n\t\t\tEvent.bind(addButtonNode, 'click', this.#onFileFieldAddClick.bind(this, addButtonNode));\n\n\t\t\tif (selected)\n\t\t\t{\n\t\t\t\tthis.addItems(selected);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(this.#fileControllerNode);\n\t\t}\n\t}\n\n\t#hideFileControllerLayout(): void\n\t{\n\t\tif (this.#fileControllerNode)\n\t\t{\n\t\t\tDom.hide(this.#fileControllerNode);\n\t\t}\n\t}\n\n\t#getDiskUploader(): BX.Bizproc.Automation.DiskUploader\n\t{\n\t\tif (!this.#diskUploader)\n\t\t{\n\t\t\tthis.#diskUploader = BX.Bizproc.Automation.DiskUploader.create(\n\t\t\t\t'',\n\t\t\t\t{\n\t\t\t\t\tmsg: {\n\t\t\t\t\t\t'diskAttachFiles' : Loc.getMessage('BIZPROC_AUTOMATION_CMP_DISK_ATTACH_FILE'),\n\t\t\t\t\t\t'diskAttachedFiles' : Loc.getMessage('BIZPROC_AUTOMATION_CMP_DISK_ATTACHED_FILES'),\n\t\t\t\t\t\t'diskSelectFile' : Loc.getMessage('BIZPROC_AUTOMATION_CMP_DISK_SELECT_FILE'),\n\t\t\t\t\t\t'diskSelectFileLegend' : Loc.getMessage('BIZPROC_AUTOMATION_CMP_DISK_SELECT_FILE_LEGEND'),\n\t\t\t\t\t\t'diskUploadFile' : Loc.getMessage('BIZPROC_AUTOMATION_CMP_DISK_UPLOAD_FILE'),\n\t\t\t\t\t\t'diskUploadFileLegend' : Loc.getMessage('BIZPROC_AUTOMATION_CMP_DISK_UPLOAD_FILE_LEGEND')\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.#diskUploader.setMode(1);\n\t\t}\n\n\t\treturn this.#diskUploader;\n\t}\n\n\t#onTypeChange(newType: string): void\n\t{\n\t\tif (this.#type !== newType)\n\t\t{\n\t\t\tthis.#type = newType;\n\t\t\tthis.#showTypeControlLayout();\n\t\t}\n\t}\n\n\t#addFileItem(item)\n\t{\n\t\tif (this.#isFileItemSelected(item))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst node = this.#createFileItemNode(item);\n\t\tif (!this.#multiple)\n\t\t{\n\t\t\tDom.clean(this.#fileItemsNode)\n\t\t}\n\n\t\tthis.#fileItemsNode.appendChild(node);\n\t}\n\n\t#isFileItemSelected(item: object)\n\t{\n\t\treturn !!this.#fileItemsNode.querySelector(`[data-file-id=\"${item.id}\"]`);\n\t}\n\n\taddItems(items: Array<object>)\n\t{\n\t\tif (this.#type === FileSelector.TYPE.File)\n\t\t{\n\t\t\tfor(const fileItem of items)\n\t\t\t{\n\t\t\t\tthis.#addFileItem(fileItem)\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis\n\t\t\t\t.#getDiskUploader()\n\t\t\t\t.setValues(\n\t\t\t\t\tFileSelector.#convertToDiskItems(items)\n\t\t\t\t);\n\t\t}\n\t}\n\n\tstatic #convertToDiskItems(items: Array<object>)\n\t{\n\t\treturn items.map((item) => ({\n\t\t\tID: item['id'],\n\t\t\tNAME: item['name'],\n\t\t\tSIZE: item['size'],\n\t\t\tVIEW_URL: '',\n\t\t}));\n\t}\n\n\t#removeFileItem(item)\n\t{\n\t\tconst itemNode = this.#fileItemsNode.querySelector(`[data-file-id=\"${item.id}\"]`);\n\t\tif (itemNode)\n\t\t{\n\t\t\tthis.#fileItemsNode.removeChild(itemNode);\n\t\t}\n\t}\n\n\t#onFileFieldAddClick(addButtonNode, event)\n\t{\n\t\tconst self = this;\n\n\t\tif (!this.#menuId)\n\t\t{\n\t\t\tthis.#menuId = Helper.generateUniqueId();\n\t\t}\n\n\t\tMenuManager.show(\n\t\t\tthis.#menuId,\n\t\t\taddButtonNode,\n\t\t\tthis.context.get('fileFields').map((field) => ({\n\t\t\t\ttext: Text.encode(field.Name),\n\t\t\t\tfield,\n\t\t\t\tonclick(event, item)\n\t\t\t\t{\n\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\tself.onFieldSelect(field);\n\t\t\t\t}\n\t\t\t})),\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: Dom.getPosition(addButtonNode)['width'] / 2,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 0,\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\n\t\t// this.#menu = MenuManager.currentItem;\n\t\tevent.preventDefault();\n\t}\n\n\tonFieldSelect(field)\n\t{\n\t\tthis.#addFileItem({\n\t\t\tid: field.Id,\n\t\t\texpression: field.Expression,\n\t\t\tname: field.Name,\n\t\t\ttype: FileSelector.TYPE.File\n\t\t});\n\t}\n\n\t#createFileItemNode(item)\n\t{\n\t\tconst itemField = this.context.get('fileFields').find(field => field.Expression === item.expression);\n\t\tconst label = itemField?.Name || '';\n\n\t\treturn Tag.render`\n\t\t\t<span\n\t\t\t\tclass=\"bizproc-automation-popup-autocomplete-item\"\n\t\t\t\tdata-file-id=\"${item.id}\"\n\t\t\t\tdata-file-expression=\"${item.expression}\"\n\t\t\t>\n\t\t\t\t<span class=\"bizproc-automation-popup-autocomplete-name\">${label}</span>\n\t\t\t\t<span\n\t\t\t\t\tclass=\"bizproc-automation-popup-autocomplete-delete\"\n\t\t\t\t\tonclick=\"${this.#removeFileItem.bind(this, item)}\"\n\t\t\t\t></span>\n\t\t\t</span>\n\t\t`;\n\t}\n\n\tonBeforeSave()\n\t{\n\t\tlet ids = [];\n\t\tif (this.#type === FileSelector.TYPE.Disk)\n\t\t{\n\t\t\tids = this.#getDiskUploader().getValues();\n\t\t}\n\t\telse if (this.#type === FileSelector.TYPE.File)\n\t\t{\n\t\t\tids = (\n\t\t\t\tArray.from(this.#fileItemsNode.childNodes)\n\t\t\t\t\t.map(node => node.getAttribute('data-file-expression'))\n\t\t\t\t\t.filter(id => id !== '')\n\t\t\t);\n\t\t}\n\n\t\tfor (const id of ids)\n\t\t{\n\t\t\tthis.targetInput.appendChild(Tag.render`\n\t\t\t\t<input\n\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\tname=\"${this.#valueInputName + (this.#multiple ? '[]' : '')}\"\n\t\t\t\t\tvalue=\"${id}\"\n\t\t\t\t/>\n\t\t\t`);\n\t\t}\n\t}\n}\n","import { Event, Loc } from 'main.core';\nimport { InlineSelector } from './inline-selector';\n\nexport class TimeSelector extends InlineSelector\n{\n\t#clockInstance;\n\n\tdestroy()\n\t{\n\t\tif (this.#clockInstance)\n\t\t{\n\t\t\tthis.#clockInstance.closeWnd();\n\t\t}\n\t}\n\n\trenderTo(targetInput: Element)\n\t{\n\t\tthis.targetInput = targetInput; //this.targetInput = Runtime.clone(targetInput);\n\n\t\tconst datetime = new Date();\n\t\tdatetime.setHours(0, 0, 0, 0);\n\t\tdatetime.setTime(datetime.getTime() + this.#getCurrentTime() * 1000);\n\n\t\tthis.targetInput.value = this.constructor.#formatTime(datetime);\n\n\t\tEvent.bind(targetInput, 'click', this.showClock.bind(this));\n\t}\n\n\tshowClock(): void\n\t{\n\t\tif (!this.#clockInstance)\n\t\t{\n\t\t\tthis.#clockInstance = new BX.CClockSelector({\n\t\t\t\tstart_time: this.#getCurrentTime(),\n\t\t\t\tnode: this.targetInput,\n\t\t\t\tcallback: this.#onTimeSelect.bind(this),\n\t\t\t});\n\t\t}\n\n\t\tthis.#clockInstance.Show();\n\t}\n\n\t#onTimeSelect(time): void\n\t{\n\t\tthis.targetInput.value = time;\n\t\tBX.fireEvent(this.targetInput, 'change');\n\t\tthis.#clockInstance.closeWnd();\n\t}\n\n\t#getCurrentTime(): number\n\t{\n\t\treturn this.#convertTimeToSeconds(this.targetInput.value);\n\t}\n\n\t#convertTimeToSeconds(time: string): number\n\t{\n\t\tconst timeParts = time.split(/[\\s:]+/).map(part => parseInt(part));\n\n\t\tlet [hours, minutes] = timeParts;\n\t\tif (timeParts.length === 3)\n\t\t{\n\t\t\tconst period = timeParts[2];\n\n\t\t\tif (period === 'pm' && hours < 12)\n\t\t\t{\n\t\t\t\thours += 12;\n\t\t\t}\n\t\t\telse if (period === 'am' && hours === 12)\n\t\t\t{\n\t\t\t\thours = 0;\n\t\t\t}\n\t\t}\n\n\t\treturn hours * 3600 + minutes * 60;\n\t}\n\n\tstatic #formatTime(datetime: Date): string\n\t{\n\t\tconst getFormat = (formatId) => (\n\t\t\tBX.date.convertBitrixFormat(Loc.getMessage(formatId)).replace(/:?\\s*s/, '')\n\t\t);\n\n\t\tconst dateFormat = getFormat('FORMAT_DATE');\n\t\tconst timeFormat = getFormat('FORMAT_DATETIME').replace(dateFormat, '').trim();\n\n\t\treturn BX.date.format(timeFormat, datetime);\n\t}\n}","import { Type, Loc, Event, Dom, Text, Tag } from 'main.core';\nimport { Helper } from './helper';\nimport { DelayInterval } from './delay-interval';\nimport { MenuManager } from 'main.popup';\nimport { getGlobalContext } from \"./automation\";\n\nexport class DelayIntervalSelector\n{\n\tbasisFields: Array;\n\tonchange: () => void;\n\tlabelNode;\n\tuseAfterBasis;\n\tminLimitM;\n\tshowWaitWorkDay;\n\n\tdelay;\n\n\tconstructor(options)\n\t{\n\t\tthis.basisFields = [];\n\t\tthis.onchange = null;\n\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.labelNode = options.labelNode;\n\t\t\tthis.useAfterBasis = options.useAfterBasis;\n\n\t\t\tif (Type.isArray(options.basisFields))\n\t\t\t{\n\t\t\t\tthis.basisFields = options.basisFields;\n\t\t\t}\n\t\t\tthis.onchange = options.onchange;\n\t\t\tthis.minLimitM = options.minLimitM;\n\t\t\tthis.showWaitWorkDay = options.showWaitWorkDay;\n\t\t}\n\t}\n\n\tinit(delay)\n\t{\n\t\tthis.delay = delay;\n\t\tthis.setLabelText();\n\t\tthis.bindLabelNode();\n\t\tthis.prepareBasisFields();\n\t}\n\n\tsetLabelText()\n\t{\n\t\tif (this.delay && this.labelNode)\n\t\t{\n\t\t\tthis.labelNode.textContent = this.delay.format(\n\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_AT_ONCE'),\n\t\t\t\tthis.basisFields\n\t\t\t);\n\t\t}\n\t}\n\n\tbindLabelNode()\n\t{\n\t\tif (this.labelNode)\n\t\t{\n\t\t\tEvent.bind(this.labelNode, 'click', BX.delegate(this.onLabelClick, this));\n\t\t}\n\t}\n\n\tonLabelClick(event)\n\t{\n\t\tthis.showDelayIntervalPopup();\n\t\tevent.preventDefault();\n\t}\n\n\tshowDelayIntervalPopup()\n\t{\n\t\tconst delay = this.delay;\n\t\tconst uid = Helper.generateUniqueId();\n\n\t\tconst form = Dom.create(\"form\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-select-block\" }\n\t\t});\n\n\t\tconst radioNow = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-select-input\",\n\t\t\t\tid: uid + \"now\",\n\t\t\t\ttype: \"radio\",\n\t\t\t\tvalue: 'now',\n\t\t\t\tname: \"type\"\n\t\t\t}\n\t\t});\n\t\tif (delay.isNow())\n\t\t{\n\t\t\tradioNow.setAttribute('checked', 'checked');\n\t\t}\n\n\t\tconst labelNow = Dom.create(\"label\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-select-wrapper\",\n\t\t\t\tfor: uid + \"now\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('span', {\n\t\t\t\t\tattrs: {className: 'bizproc-automation-popup-settings-title'},\n\t\t\t\t\ttext: Loc.getMessage(this.useAfterBasis ? 'BIZPROC_AUTOMATION_CMP_BASIS_NOW' : 'BIZPROC_AUTOMATION_CMP_AT_ONCE_2')\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tconst labelNowHelpNode = Dom.create('span', {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-status-help bizproc-automation-status-help-right\",\n\t\t\t\t'data-hint': Loc.getMessage(this.useAfterBasis ? 'BIZPROC_AUTOMATION_CMP_DELAY_NOW_HELP_2' : 'BIZPROC_AUTOMATION_CMP_DELAY_NOW_HELP')\n\t\t\t}\n\t\t});\n\t\tlabelNow.appendChild(labelNowHelpNode);\n\n\t\tform.appendChild(Dom.create(\"div\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-select-item\" },\n\t\t\tchildren: [radioNow, labelNow]\n\t\t}));\n\n\t\tform.appendChild(this.createAfterControlNode());\n\n\t\tif (this.basisFields.length > 0)\n\t\t{\n\t\t\tform.appendChild(this.createBeforeControlNode());\n\t\t\tform.appendChild(this.createInControlNode());\n\t\t}\n\n\t\tconst workTimeRadio = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: \"checkbox\",\n\t\t\t\tid: uid + \"worktime\",\n\t\t\t\tname: \"worktime\",\n\t\t\t\tvalue: '1',\n\t\t\t\tstyle: 'vertical-align: middle'\n\t\t\t},\n\t\t\tprops: {\n\t\t\t\tchecked: delay.workTime\n\t\t\t}\n\t\t});\n\n\t\tconst workTimeHelpNode = Dom.create('span', {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-status-help bizproc-automation-status-help-right\",\n\t\t\t\t'data-hint': Loc.getMessage('BIZPROC_AUTOMATION_DELAY_WORK_TIME_HELP')\n\t\t\t}\n\t\t});\n\n\t\tform.appendChild(Dom.create(\"div\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings-title\" },\n\t\t\tchildren: [\n\t\t\t\tworkTimeRadio,\n\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: \"bizproc-automation-popup-settings-lbl\",\n\t\t\t\t\t\tfor: uid + \"worktime\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_DELAY_WORK_TIME_MSGVER_1')\n\t\t\t\t}),\n\t\t\t\tworkTimeHelpNode\n\t\t\t]\n\t\t}));\n\n\t\tif (this.showWaitWorkDay)\n\t\t{\n\t\t\tform.appendChild(this.#createWaitWorkDayNode());\n\t\t}\n\n\t\tconst self = this;\n\t\t//init modern Help tips\n\t\tBX.UI.Hint.init(form);\n\t\tconst popup = new BX.PopupWindow(Helper.generateUniqueId(), this.labelNode, {\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tcloseIcon: false,\n\t\t\ttitleBar: false,\n\t\t\tangle: true,\n\t\t\toffsetLeft: 20,\n\t\t\tcontent: form,\n\t\t\tbuttons: [\n\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_CHOOSE'),\n\t\t\t\t\tclassName: 'webform-button webform-button-create bizproc-automation-button-left',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tself.saveFormData(new FormData(form));\n\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t}}\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tonPopupClose()\n\t\t\t\t{\n\t\t\t\t\tif (self.fieldsMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\tself.fieldsMenu.popupWindow.close();\n\t\t\t\t\t}\n\t\t\t\t\tif (self.valueTypeMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\tself.valueTypeMenu.popupWindow.close();\n\t\t\t\t\t}\n\t\t\t\t\tthis.destroy();\n\t\t\t\t}\n\t\t\t},\n\t\t\toverlay: { backgroundColor: 'transparent' }\n\t\t});\n\n\t\tpopup.show();\n\t}\n\n\tsaveFormData(formData: FormData)\n\t{\n\t\tconst type = formData.get('type');\n\n\t\tif (type === 'now')\n\t\t{\n\t\t\tthis.delay.setNow();\n\t\t}\n\t\telse if (type === DelayInterval.DELAY_TYPE.In)\n\t\t{\n\t\t\tthis.delay.setType(DelayInterval.DELAY_TYPE.In);\n\t\t\tthis.delay.setValue(0);\n\t\t\tthis.delay.setValueType('i');\n\t\t\tthis.delay.setBasis(formData.get('basis_in'));\n\t\t\tthis.delay.setInTime(formData.get('basis_in_time') ? formData.get('basis_in_time').split(':') : null);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.delay.setType(type);\n\t\t\tthis.delay.setValue(formData.get('value_' + type));\n\t\t\tthis.delay.setValueType(formData.get('value_type_' + type));\n\n\t\t\tif (type === DelayInterval.DELAY_TYPE.After)\n\t\t\t{\n\t\t\t\tif (this.useAfterBasis)\n\t\t\t\t{\n\t\t\t\t\tthis.delay.setBasis(formData.get('basis_after'));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.delay.setBasis(DelayInterval.BASIS_TYPE.CurrentDateTime);\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\tthis.minLimitM > 0\n\t\t\t\t\t&& this.delay.basis === DelayInterval.BASIS_TYPE.CurrentDateTime\n\t\t\t\t\t&& this.delay.valueType === 'i'\n\t\t\t\t\t&& this.delay.value < this.minLimitM\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('BIZPROC_AUTOMATION_DELAY_MIN_LIMIT_LABEL')\n\t\t\t\t\t});\n\t\t\t\t\tthis.delay.setValue(this.minLimitM);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.delay.setBasis(formData.get('basis_before'));\n\t\t\t}\n\t\t}\n\n\t\tthis.delay.setWorkTime(formData.get('worktime'));\n\t\tthis.delay.setWaitWorkDay(formData.get('wait_workday'));\n\t\tthis.setLabelText();\n\n\t\tif (this.onchange)\n\t\t{\n\t\t\tthis.onchange(this.delay);\n\t\t}\n\t}\n\n\tcreateAfterControlNode()\n\t{\n\t\tconst delay = this.delay;\n\t\tconst uid = Helper.generateUniqueId();\n\n\t\tconst radioAfter = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-select-input\",\n\t\t\t\tid: uid,\n\t\t\t\ttype: \"radio\",\n\t\t\t\tvalue: DelayInterval.DELAY_TYPE.After,\n\t\t\t\tname: \"type\"\n\t\t\t}\n\t\t});\n\t\tif (delay.type === DelayInterval.DELAY_TYPE.After && delay.value > 0)\n\t\t{\n\t\t\tradioAfter.setAttribute('checked', 'checked');\n\t\t}\n\n\t\tconst valueNode = Dom.create('input', {\n\t\t\tattrs: {\n\t\t\t\ttype: 'text',\n\t\t\t\tname: 'value_after',\n\n\t\t\t\tclassName: 'bizproc-automation-popup-settings-input'\n\t\t\t},\n\t\t\tprops: {\n\t\t\t\tvalue: delay.type === DelayInterval.DELAY_TYPE.After && delay.value ? delay.value : (this.minLimitM || 5)\n\t\t\t}\n\t\t});\n\n\t\tconst labelAfter = Dom.create(\"label\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-select-wrapper\",\n\t\t\t\tfor: uid\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('span', {\n\t\t\t\t\tattrs: {className: 'bizproc-automation-popup-settings-title'},\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_THROUGH_3')\n\t\t\t\t}),\n\t\t\t\tvalueNode,\n\t\t\t\tthis.createValueTypeSelector('value_type_after')\n\t\t\t]\n\t\t});\n\n\t\tif (this.useAfterBasis)\n\t\t{\n\t\t\tlabelAfter.appendChild(Dom.create('span', {\n\t\t\t\tattrs: {className: 'bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-auto-width'},\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_AFTER')\n\t\t\t}));\n\n\t\t\tlet basisField = this.getBasisField(delay.basis, true);\n\t\t\tlet basisValue = delay.basis;\n\t\t\tif (!basisField)\n\t\t\t{\n\t\t\t\tbasisField = this.getBasisField(DelayInterval.BASIS_TYPE.CurrentDateTime, true);\n\t\t\t\tbasisValue = basisField.SystemExpression;\n\t\t\t}\n\n\t\t\tconst beforeBasisValueNode = Dom.create('input', {\n\t\t\t\tattrs: {\n\t\t\t\t\ttype: \"hidden\",\n\t\t\t\t\tname: \"basis_after\",\n\t\t\t\t\tvalue: basisValue\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst self = this;\n\t\t\tconst beforeBasisNode = Dom.create('span', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: \"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis\"\n\t\t\t\t},\n\t\t\t\ttext: basisField ? basisField.Name : Loc.getMessage('BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD'),\n\t\t\t\tevents: {\n\t\t\t\t\tclick(event)\n\t\t\t\t\t{\n\t\t\t\t\t\tself.onBasisClick(event, this, function(field)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbeforeBasisNode.textContent = field.Name;\n\t\t\t\t\t\t\tbeforeBasisValueNode.value = field.SystemExpression;\n\t\t\t\t\t\t}, DelayInterval.DELAY_TYPE.After);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tlabelAfter.appendChild(beforeBasisValueNode);\n\t\t\tlabelAfter.appendChild(beforeBasisNode);\n\t\t}\n\n\t\tif (!this.useAfterBasis)\n\t\t{\n\t\t\tconst afterHelpNode = Dom.create('span', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: \"bizproc-automation-status-help bizproc-automation-status-help-right\",\n\t\t\t\t\t'data-hint': Loc.getMessage('BIZPROC_AUTOMATION_CMP_DELAY_AFTER_HELP')\n\t\t\t\t}\n\t\t\t});\n\t\t\tlabelAfter.appendChild(afterHelpNode);\n\t\t}\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-select-item\" },\n\t\t\tchildren: [radioAfter, labelAfter]\n\t\t});\n\t}\n\n\tcreateBeforeControlNode()\n\t{\n\t\tconst delay = this.delay;\n\t\tconst uid = Helper.generateUniqueId();\n\n\t\tconst radioBefore = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-select-input\",\n\t\t\t\tid: uid,\n\t\t\t\ttype: \"radio\",\n\t\t\t\tvalue: DelayInterval.DELAY_TYPE.Before,\n\t\t\t\tname: \"type\"\n\t\t\t}\n\t\t});\n\n\t\tif (delay.type === DelayInterval.DELAY_TYPE.Before)\n\t\t{\n\t\t\tradioBefore.setAttribute('checked', 'checked');\n\t\t}\n\n\t\tconst valueNode = Dom.create('input', {\n\t\t\tattrs: {\n\t\t\t\ttype: 'text',\n\t\t\t\tname: 'value_before',\n\n\t\t\t\tclassName: 'bizproc-automation-popup-settings-input'\n\t\t\t},\n\t\t\tprops: {\n\t\t\t\tvalue: delay.type === DelayInterval.DELAY_TYPE.Before && delay.value ? delay.value : (this.minLimitM || 5)\n\t\t\t}\n\t\t});\n\n\t\tconst labelBefore = Dom.create(\"label\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-select-wrapper\",\n\t\t\t\tfor: uid\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('span', {\n\t\t\t\t\tattrs: {className: 'bizproc-automation-popup-settings-title'},\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_FOR_TIME_3')\n\t\t\t\t}),\n\t\t\t\tvalueNode,\n\t\t\t\tthis.createValueTypeSelector('value_type_before'),\n\t\t\t\tDom.create('span', {\n\t\t\t\t\tattrs: {className: 'bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-auto-width'},\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BEFORE_1')\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tlet basisField = this.getBasisField(delay.basis);\n\t\tlet basisValue = delay.basis;\n\t\tif (!basisField)\n\t\t{\n\t\t\tbasisField = this.basisFields[0];\n\t\t\tbasisValue = basisField.SystemExpression;\n\t\t}\n\n\t\tconst beforeBasisValueNode = Dom.create('input', {\n\t\t\tattrs: {\n\t\t\t\ttype: \"hidden\",\n\t\t\t\tname: \"basis_before\",\n\t\t\t\tvalue: basisValue\n\t\t\t}\n\t\t});\n\n\t\tconst self = this;\n\t\tconst beforeBasisNode = Dom.create('span', {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis\"\n\t\t\t},\n\t\t\ttext: basisField ? basisField.Name : Loc.getMessage('BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD'),\n\t\t\tevents: {\n\t\t\t\tclick(event)\n\t\t\t\t{\n\t\t\t\t\tself.onBasisClick(\n\t\t\t\t\t\tevent,\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\t(field) => {\n\t\t\t\t\t\t\tbeforeBasisNode.textContent = field.Name;\n\t\t\t\t\t\t\tbeforeBasisValueNode.value = field.SystemExpression;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tDelayInterval.DELAY_TYPE.Before\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tlabelBefore.appendChild(beforeBasisValueNode);\n\t\tlabelBefore.appendChild(beforeBasisNode);\n\n\t\tif (!this.useAfterBasis)\n\t\t{\n\t\t\tconst beforeHelpNode = Dom.create('span', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: \"bizproc-automation-status-help bizproc-automation-status-help-right\",\n\t\t\t\t\t'data-hint': Loc.getMessage('BIZPROC_AUTOMATION_CMP_DELAY_BEFORE_HELP')\n\t\t\t\t}\n\t\t\t});\n\t\t\tlabelBefore.appendChild(beforeHelpNode);\n\t\t}\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tattrs: {className: \"bizproc-automation-popup-select-item\"},\n\t\t\tchildren: [radioBefore, labelBefore]\n\t\t});\n\t}\n\n\tcreateInControlNode()\n\t{\n\t\tconst delay = this.delay;\n\t\tconst uid = Helper.generateUniqueId();\n\n\t\tconst radioIn = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-select-input\",\n\t\t\t\tid: uid,\n\t\t\t\ttype: \"radio\",\n\t\t\t\tvalue: DelayInterval.DELAY_TYPE.In,\n\t\t\t\tname: \"type\"\n\t\t\t}\n\t\t});\n\n\t\tif (delay.type === DelayInterval.DELAY_TYPE.In)\n\t\t{\n\t\t\tradioIn.setAttribute('checked', 'checked');\n\t\t}\n\n\t\tconst labelIn = Dom.create(\"label\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-select-wrapper\",\n\t\t\t\tfor: uid\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('span', {\n\t\t\t\t\tattrs: {className: 'bizproc-automation-popup-settings-title'},\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_IN_TIME_2')\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tlet basisField = this.getBasisField(delay.basis, true);\n\t\tlet basisValue = delay.basis;\n\t\tif (!basisField)\n\t\t{\n\t\t\tbasisField = this.basisFields[0];\n\t\t\tbasisValue = basisField.SystemExpression;\n\t\t}\n\n\t\tconst inBasisValueNode = Dom.create('input', {\n\t\t\tattrs: {\n\t\t\t\ttype: \"hidden\",\n\t\t\t\tname: \"basis_in\",\n\t\t\t\tvalue: basisValue\n\t\t\t}\n\t\t});\n\n\t\tconst self = this;\n\t\tconst inBasisNode = Dom.create('span', {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis\"\n\t\t\t},\n\t\t\ttext: basisField ? basisField.Name : Loc.getMessage('BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD'),\n\t\t\tevents: {\n\t\t\t\tclick(event)\n\t\t\t\t{\n\t\t\t\t\tself.onBasisClick(\n\t\t\t\t\t\tevent,\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tfield => {\n\t\t\t\t\t\t\tinBasisNode.textContent = field.Name;\n\t\t\t\t\t\t\tinBasisValueNode.value = field.SystemExpression;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tDelayInterval.DELAY_TYPE.In\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\t\tlabelIn.appendChild(inBasisValueNode);\n\t\tlabelIn.appendChild(inBasisNode);\n\t\tif (!this.useAfterBasis)\n\t\t{\n\t\t\tconst helpNode = Dom.create('span', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: \"bizproc-automation-status-help bizproc-automation-status-help-right\",\n\t\t\t\t\t'data-hint': Loc.getMessage('BIZPROC_AUTOMATION_CMP_DELAY_IN_HELP')\n\t\t\t\t}\n\t\t\t});\n\t\t\tlabelIn.appendChild(helpNode);\n\t\t}\n\n\t\tconst inTime = Tag.render`\n\t\t\t <span>\n\t\t\t \tTime: <input type=\"time\" value=\"${delay.inTimeString}\" name=\"basis_in_time\"/>\n\t\t\t</span>\n\t\t`;\n\n\t\t// Dom.append(inTime, labelIn); // TODO interface\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tattrs: {className: \"bizproc-automation-popup-select-item\"},\n\t\t\tchildren: [radioIn, labelIn]\n\t\t});\n\t}\n\n\tcreateValueTypeSelector(name)\n\t{\n\t\tconst delay = this.delay;\n\t\tconst labelTexts = {\n\t\t\ti: Loc.getMessage('BIZPROC_AUTOMATION_CMP_INTERVAL_M'),\n\t\t\th: Loc.getMessage('BIZPROC_AUTOMATION_CMP_INTERVAL_H'),\n\t\t\td: Loc.getMessage('BIZPROC_AUTOMATION_CMP_INTERVAL_D')\n\t\t};\n\n\t\tconst label = Dom.create('label', {\n\t\t\tattrs: {className: 'bizproc-automation-popup-settings-link'},\n\t\t\ttext: labelTexts[delay.valueType],\n\t\t});\n\n\t\tconst input = Dom.create('input', {\n\t\t\tattrs: {\n\t\t\t\ttype: 'hidden',\n\t\t\t\tname: name\n\t\t\t},\n\t\t\tprops: {\n\t\t\t\tvalue: delay.valueType\n\t\t\t}\n\t\t});\n\n\t\tEvent.bind(label, 'click', this.onValueTypeSelectorClick.bind(this, label, input));\n\n\t\treturn Dom.create('span', {\n\t\t\tchildren: [label, input]\n\t\t});\n\t}\n\n\tonValueTypeSelectorClick(label, input)\n\t{\n\t\tconst uid = Helper.generateUniqueId();\n\n\t\tconst handler = function(event, item)\n\t\t{\n\t\t\tthis.popupWindow.close();\n\t\t\tinput.value = item.valueId;\n\t\t\tlabel.textContent = item.text;\n\t\t};\n\n\t\tconst menuItems = [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_INTERVAL_M'),\n\t\t\t\tvalueId: 'i',\n\t\t\t\tonclick: handler\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_INTERVAL_H'),\n\t\t\t\tvalueId: 'h',\n\t\t\t\tonclick: handler\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_INTERVAL_D'),\n\t\t\t\tvalueId: 'd',\n\t\t\t\tonclick: handler\n\t\t\t}\n\t\t];\n\n\t\tMenuManager.show(\n\t\t\tuid,\n\t\t\tlabel,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: 25,\n\t\t\t\tangle: { position: 'top'},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\toverlay: { backgroundColor: 'transparent' }\n\t\t\t}\n\t\t);\n\n\t\tthis.valueTypeMenu = MenuManager.currentItem;\n\t}\n\n\tonBasisClick(event, labelNode, callback, delayType)\n\t{\n\t\tconst menuItems = [];\n\n\t\tif (delayType === DelayInterval.DELAY_TYPE.After || delayType === DelayInterval.DELAY_TYPE.In)\n\t\t{\n\t\t\tmenuItems.push(\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BASIS_NOW'),\n\t\t\t\t\tfield: {\n\t\t\t\t\t\tName: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BASIS_NOW'),\n\t\t\t\t\t\tSystemExpression: DelayInterval.BASIS_TYPE.CurrentDateTime,\n\t\t\t\t\t},\n\t\t\t\t\tonclick(event, item)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (callback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcallback(item.field);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BASIS_DATE'),\n\t\t\t\t\tfield: {\n\t\t\t\t\t\tName: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BASIS_DATE'),\n\t\t\t\t\t\tSystemExpression: DelayInterval.BASIS_TYPE.CurrentDate,\n\t\t\t\t\t},\n\t\t\t\t\tonclick(event, item)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (callback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcallback(item.field);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tdelimiter: true\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tfor (let i = 0; i < this.basisFields.length; ++i)\n\t\t{\n\t\t\tif (\n\t\t\t\tdelayType !== DelayInterval.DELAY_TYPE.After\n\t\t\t\t&& this.basisFields[i]['Id'].indexOf('DATE_CREATE') > -1\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Text.encode(this.basisFields[i].Name),\n\t\t\t\tfield: this.basisFields[i],\n\t\t\t\tonclick(e, item)\n\t\t\t\t{\n\t\t\t\t\tif (callback)\n\t\t\t\t\t{\n\t\t\t\t\t\tcallback(item.field || item.options.field);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tlet menuId = labelNode.getAttribute('data-menu-id');\n\t\tif (!menuId)\n\t\t{\n\t\t\tmenuId = Helper.generateUniqueId();\n\t\t\tlabelNode.setAttribute('data-menu-id', menuId);\n\t\t}\n\n\t\tMenuManager.show(\n\t\t\tmenuId,\n\t\t\tlabelNode,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: (BX.pos(labelNode)['width'] / 2),\n\t\t\t\tangle: { position: 'top', offset: 0 },\n\t\t\t\toverlay: { backgroundColor: 'transparent' }\n\t\t\t}\n\t\t);\n\n\t\tthis.fieldsMenu = MenuManager.currentItem;\n\t}\n\n\tgetBasisField(basis, system)\n\t{\n\t\tif (system && (basis === DelayInterval.BASIS_TYPE.CurrentDateTime || basis === DelayInterval.BASIS_TYPE.CurrentDateTimeLocal))\n\t\t{\n\t\t\treturn {\n\t\t\t\tName: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BASIS_NOW'),\n\t\t\t\tSystemExpression: DelayInterval.BASIS_TYPE.CurrentDateTime,\n\t\t\t};\n\t\t}\n\t\tif (system && basis === DelayInterval.BASIS_TYPE.CurrentDate)\n\t\t{\n\t\t\treturn {\n\t\t\t\tName: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BASIS_DATE'),\n\t\t\t\tSystemExpression: DelayInterval.BASIS_TYPE.CurrentDate,\n\t\t\t};\n\t\t}\n\n\t\tlet field = null;\n\t\tfor (let i = 0; i < this.basisFields.length; ++i)\n\t\t{\n\t\t\tif (basis === this.basisFields[i].SystemExpression)\n\t\t\t{\n\t\t\t\tfield = this.basisFields[i];\n\t\t\t}\n\t\t}\n\n\t\treturn field;\n\t}\n\n\tprepareBasisFields()\n\t{\n\t\tconst fields = [];\n\t\tfor (let i = 0; i < this.basisFields.length; ++i)\n\t\t{\n\t\t\tconst fld = this.basisFields[i];\n\t\t\tif (\n\t\t\t\tfld['Id'].indexOf('DATE_MODIFY') < 0\n\t\t\t\t&& fld['Id'].indexOf('EVENT_DATE') < 0\n\t\t\t\t&& fld['Id'].indexOf('BIRTHDATE') < 0\n\t\t\t)\n\t\t\t{\n\t\t\t\tfields.push(fld);\n\t\t\t}\n\t\t}\n\n\t\tthis.basisFields = fields;\n\t}\n\n\t#createWaitWorkDayNode()\n\t{\n\t\tconst delay = this.delay;\n\t\tconst uid = Helper.generateUniqueId();\n\t\tconst isAvailable = this.#isWorkTimeAvailable();\n\n\t\tconst workDayRadio = Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: \"checkbox\",\n\t\t\t\tid: uid + \"wait_workday\",\n\t\t\t\tname: \"wait_workday\",\n\t\t\t\tvalue: '1',\n\t\t\t\tstyle: 'vertical-align: middle'\n\t\t\t},\n\t\t\tprops: {\n\t\t\t\tchecked: delay.waitWorkDay && isAvailable\n\t\t\t}\n\t\t});\n\n\t\tif (!isAvailable)\n\t\t{\n\t\t\tworkDayRadio.disabled = true;\n\t\t}\n\n\t\tconst workDayHelpNode = Dom.create('span', {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"bizproc-automation-status-help bizproc-automation-status-help-right\",\n\t\t\t\t'data-hint': Loc.getMessage('BIZPROC_AUTOMATION_DELAY_WAIT_WORK_DAY_HELP')\n\t\t\t}\n\t\t});\n\n\t\tconst events = {};\n\n\t\tif (!isAvailable)\n\t\t{\n\t\t\tevents.click = () => {\n\t\t\t\tif (top.BX.UI && top.BX.UI.InfoHelper)\n\t\t\t\t{\n\t\t\t\t\ttop.BX.UI.InfoHelper.show('limit_office_worktime_responsible');\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-select-item\" },\n\t\t\tchildren: [ Dom.create(\"div\", {\n\t\t\t\tattrs: { className: \"bizproc-automation-popup-settings-title\" },\n\t\t\t\tchildren: [\n\t\t\t\t\tworkDayRadio,\n\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\tclassName: `bizproc-automation-popup-settings-lbl ${!isAvailable? 'bizproc-automation-robot-btn-set-locked' : ''}`,\n\t\t\t\t\t\t\tfor: uid + \"wait_workday\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_DELAY_WAIT_WORK_DAY_MSGVER_1')\n\t\t\t\t\t}),\n\t\t\t\t\tworkDayHelpNode\n\t\t\t\t]\n\t\t\t})],\n\t\t\tevents,\n\t\t});\n\t}\n\n\t#isWorkTimeAvailable(): boolean\n\t{\n\t\treturn getGlobalContext().get('IS_WORKTIME_AVAILABLE') ?? false;\n\t}\n}","import { Type } from 'main.core';\nimport { BaseContext } from './base-context';\nimport { Field } from '../selectors/types';\n\nexport class SelectorContext extends BaseContext\n{\n\tconstructor(props: {\n\t\tfields: Array<Field>,\n\t\tuseSwitcherMenu: boolean,\n\t\trootGroupTitle: string,\n\t})\n\t{\n\t\tsuper(props);\n\t}\n\n\tget fields(): Array<Field>\n\t{\n\t\tconst fields = this.get('fields');\n\n\t\treturn Type.isArray(fields) ? fields : [];\n\t}\n\n\tget useSwitcherMenu(): boolean\n\t{\n\t\treturn Type.isBoolean(this.get('useSwitcherMenu')) ? this.get('useSwitcherMenu') : false;\n\t}\n\n\tset useSwitcherMenu(value: boolean)\n\t{\n\t\tthis.set('useSwitcherMenu', value);\n\t}\n\n\tget rootGroupTitle(): string\n\t{\n\t\treturn this.get('rootGroupTitle') ?? '';\n\t}\n}","import {Type} from 'main.core';\nimport {Globals} from \"bizproc.globals\";\n\nexport class AutomationGlobals\n{\n\t#globalVariables: [] = [];\n\t#globalConstants: [] = [];\n\n\tconstructor(parameters: {\n\t\tvariables: ?[],\n\t\tconstants: ?[],\n\t})\n\t{\n\t\tif (Type.isArrayFilled(parameters.variables))\n\t\t{\n\t\t\tconst variables = [];\n\t\t\tparameters.variables.forEach((property) => {\n\t\t\t\tvariables.push(\n\t\t\t\t\tthis.#getAutomationGlobalsProperty(property.Id, property, Globals.Manager.Instance.mode.variable)\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tthis.#globalVariables = variables;\n\t\t}\n\n\t\tif (Type.isArrayFilled(parameters.constants))\n\t\t{\n\t\t\tconst constants = [];\n\t\t\tparameters.constants.forEach((property) => {\n\t\t\t\tconstants.push(\n\t\t\t\t\tthis.#getAutomationGlobalsProperty(property.Id, property, Globals.Manager.Instance.mode.constant)\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tthis.#globalConstants = constants;\n\t\t}\n\t}\n\n\tget globalVariables(): []\n\t{\n\t\treturn this.#globalVariables;\n\t}\n\n\tset globalVariables(variables: [])\n\t{\n\t\tif (!Type.isArray(variables))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#globalVariables = variables;\n\t}\n\n\tget globalConstants(): []\n\t{\n\t\treturn this.#globalConstants;\n\t}\n\n\tset globalConstants(constants: [])\n\t{\n\t\tif (!Type.isArray(constants))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#globalConstants = constants;\n\t}\n\n\t#isCorrectMode(mode): boolean\n\t{\n\t\treturn Type.isStringFilled(mode) && Object.values(Globals.Manager.Instance.mode).includes(mode);\n\t}\n\n\t#getAutomationGlobalsProperty(id: string, property: {}, mode: string): {\n\t\tObjectId: string,\n\t\tSuperTitle: string,\n\t\tId: string,\n\t\tName: string,\n\t\tType: string,\n\t\tBaseType: string,\n\t\tExpression: string,\n\t\tSystemExpression: string,\n\t\tOptions: any,\n\t\tMultiple: boolean,\n\t\tVisibility: string,\n\t}\n\t{\n\t\treturn {\n\t\t\tObjectId: this.#getObjectId(mode),\n\t\t\tSuperTitle: String(property.VisibilityName),\n\t\t\tId: String(id),\n\t\t\tName: String(property.Name),\n\t\t\tType: String(property.Type),\n\t\t\tBaseType: String(property.BaseType || property.Type),\n\t\t\tExpression:\n\t\t\t\tType.isStringFilled(property.Expression)\n\t\t\t\t\t? property.Expression\n\t\t\t\t\t: this.#getExpression(property.Name, property.VisibilityName)\n\t\t\t,\n\t\t\tSystemExpression:\n\t\t\t\tType.isStringFilled(property.SystemExpression)\n\t\t\t\t\t? property.SystemExpression\n\t\t\t\t\t: this.#getSystemExpression(mode, id)\n\t\t\t,\n\t\t\tOptions: property.Options,\n\t\t\tMultiple: Type.isBoolean(property.Multiple) ? property.Multiple : property.Multiple === 'Y',\n\t\t\tVisibility: String(property.Visibility),\n\t\t};\n\t}\n\n\t#getExpression(name, visibilityName): string\n\t{\n\t\treturn '{{' + String(visibilityName) + ': ' + String(name) + '}}'\n\t}\n\n\t#getSystemExpression(mode, id): string\n\t{\n\t\treturn '{=' + this.#getObjectId(mode) + ':' + String(id) + '}';\n\t}\n\n\t#getObjectId(mode): string\n\t{\n\t\treturn (mode === Globals.Manager.Instance.mode.variable) ? 'GlobalVar' : 'GlobalConst'\n\t}\n\n\tupdateGlobals(mode: string, updatedGlobals: {})\n\t{\n\t\tif (!this.#isCorrectMode(mode) || Object.keys(updatedGlobals).length < 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet globals = this.#getGlobals(mode);\n\n\t\tconst newGlobals = [];\n\t\tfor (const id in updatedGlobals)\n\t\t{\n\t\t\tconst property = updatedGlobals[id];\n\t\t\tconst index = globals.findIndex(prop => prop.Id === id);\n\t\t\tif (index > -1)\n\t\t\t{\n\t\t\t\tif (globals[index].Name !== property.Name)\n\t\t\t\t{\n\t\t\t\t\tglobals[index].Name = property.Name;\n\t\t\t\t\tglobals[index].Expression = this.#getExpression(property.Name, property.VisibilityName);\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tnewGlobals.push(this.#getAutomationGlobalsProperty(id, property, mode));\n\t\t}\n\n\t\tif (Type.isArrayFilled(newGlobals))\n\t\t{\n\t\t\tglobals = globals.concat(newGlobals);\n\t\t}\n\n\t\tthis.#setGlobals(mode, globals);\n\t}\n\n\tdeleteGlobals(mode: string, deletedGlobals: [])\n\t{\n\t\tif (!this.#isCorrectMode(mode) || !Type.isArrayFilled(deletedGlobals))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst globals = this.#getGlobals(mode);\n\n\t\tdeletedGlobals.forEach((id) => {\n\t\t\tconst index = globals.findIndex((prop) => prop.Id === id);\n\t\t\tif (index > -1)\n\t\t\t{\n\t\t\t\tglobals.splice(index, 1);\n\t\t\t}\n\t\t});\n\n\t\tthis.#setGlobals(mode, globals);\n\t}\n\n\t#getGlobals(mode): []\n\t{\n\t\tif (mode === Globals.Manager.Instance.mode.variable)\n\t\t{\n\t\t\treturn this.globalVariables;\n\t\t}\n\n\t\tif (mode === Globals.Manager.Instance.mode.constant)\n\t\t{\n\t\t\treturn this.globalConstants;\n\t\t}\n\t}\n\n\t#setGlobals(mode, globals)\n\t{\n\t\tif (mode === Globals.Manager.Instance.mode.variable)\n\t\t{\n\t\t\tthis.#globalVariables = globals;\n\t\t}\n\n\t\tif (mode === Globals.Manager.Instance.mode.constant)\n\t\t{\n\t\t\tthis.#globalConstants = globals;\n\t\t}\n\t}\n}","import {Dom} from 'main.core';\nimport {getGlobalContext, TrackingStatus, Template} from \"bizproc.automation\";\n\nexport class Statuses\n{\n\t#nodes: Array<HTMLElement> = [];\n\t#lastColorStatusIndex: number = -1;\n\t#defaultStatusColor: string = '#d4d6da';\n\n\tconstructor(stagesContainerNode: HTMLElement)\n\t{\n\t\tconst stagesContainer = stagesContainerNode.querySelector('.bizproc-automation-status-list');\n\t\tif (stagesContainer)\n\t\t{\n\t\t\tthis.#nodes = stagesContainer.querySelectorAll('[data-role=\"automation-status-title\"]');\n\t\t}\n\t}\n\n\tinit(templates: Array<Template>): void\n\t{\n\t\tconst context = getGlobalContext();\n\t\tif (context.document.getId() <= 0)\n\t\t{\n\t\t\tthis.#lastColorStatusIndex = this.#nodes.length - 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#lastColorStatusIndex = templates.findIndex((template) => (\n\t\t\t\ttemplate.getStatusId() === context.document.getCurrentStatusId()\n\t\t\t));\n\t\t}\n\t}\n\n\tfixColors(): void\n\t{\n\t\tthis.#fixBackgroundColors();\n\t\tthis.#fixTitleColors();\n\t}\n\n\t#fixBackgroundColors(): void\n\t{\n\t\tthis.#nodes.forEach((statusNode, index) => {\n\t\t\tconst backgroundNode = statusNode.querySelector('.bizproc-automation__status--bg');\n\n\t\t\tif (backgroundNode)\n\t\t\t{\n\t\t\t\tconst color = (\n\t\t\t\t\tthis.#isColorStatus(index) && statusNode.dataset.bgcolor\n\t\t\t\t\t\t? statusNode.dataset.bgcolor\n\t\t\t\t\t\t: this.#defaultStatusColor\n\t\t\t\t);\n\n\t\t\t\tDom.style(backgroundNode, {\n\t\t\t\t\tbackgroundColor: color,\n\t\t\t\t\tborderColor: color,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t#fixTitleColors(): void\n\t{\n\t\tthis.#nodes.forEach((statusNode, index) => {\n\t\t\tif (!this.#isColorStatus(index))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst backgroundColor = statusNode.dataset.bgcolor;\n\t\t\tif (backgroundColor)\n\t\t\t{\n\t\t\t\tconst bigint = parseInt(backgroundColor, 16);\n\t\t\t\tconst red = (bigint >> 16) & 255;\n\t\t\t\tconst green = (bigint >> 8) & 255;\n\t\t\t\tconst blue = bigint & 255;\n\n\t\t\t\tconst isDarkColor = 0.21 * red + 0.72 * green + 0.07 * blue < 145;\n\t\t\t\tif (isDarkColor)\n\t\t\t\t{\n\t\t\t\t\tDom.style(statusNode, 'color', 'white');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t#isColorStatus(index: number): boolean\n\t{\n\t\treturn index <= this.#lastColorStatusIndex;\n\t}\n}","import {Loc, Type, Text} from 'main.core';\nimport {Guide} from 'ui.tour';\n\nexport class BeginningGuide\n{\n\t#guide: Guide;\n\n\tconstructor(options: {target: HTMLElement, text?: string, article?: string})\n\t{\n\t\tif (!Type.isElementNode(options.target))\n\t\t{\n\t\t\tthrow 'options.target must be Node Element';\n\t\t}\n\n\t\tconst text =\n\t\t\tType.isStringFilled(options.text)\n\t\t\t\t? options.text\n\t\t\t\t: Loc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_BEGINNING_SUBTITLE_1')\n\t\t;\n\t\tconst article = Type.isStringFilled(options.article) ? Text.toInteger(options.article) : '';\n\n\t\tthis.#guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: options.target,\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_BEGINNING_TITLE'),\n\t\t\t\t\ttext,\n\t\t\t\t\tarticle,\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: true,\n\t\t\t\t\t\tbottom: false,\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t},\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\n\t\tthis.#guide.getPopup().setAutoHide(true);\n\t}\n\n\tstart()\n\t{\n\t\tthis.#guide.showNextStep();\n\t}\n}","import { Loc, Type, Text } from 'main.core';\nimport { Guide } from 'ui.tour';\n\nimport '../css/tourguide.css';\n\nexport class AutomationGuide\n{\n\t#isShownRobotGuide: boolean = true;\n\t#isShownTriggerGuide: boolean = true;\n\n\t#isShownSupportingRobotGuide: boolean = false;\n\n\t#showRobotGuide: boolean = false;\n\t#showTriggerGuide: boolean = false;\n\t#showSupportingRobotGuide: boolean = false;\n\n\t#guideTargets: {\n\t\ttrigger?: Element,\n\t\tsupportingRobot?: Element,\n\t\trobot?: Element,\n\t} = {};\n\n\tconstructor(options: {\n\t\tisShownRobotGuide: boolean,\n\t\tisShownTriggerGuide: boolean,\n\t})\n\t{\n\t\tif (Type.isBoolean(options.isShownRobotGuide))\n\t\t{\n\t\t\tthis.#isShownRobotGuide = options.isShownRobotGuide;\n\t\t}\n\t\tif (Type.isBoolean(options.isShownTriggerGuide))\n\t\t{\n\t\t\tthis.#isShownTriggerGuide = options.isShownTriggerGuide;\n\t\t}\n\t}\n\n\tget isShownRobotGuide(): boolean\n\t{\n\t\treturn this.#isShownRobotGuide;\n\t}\n\n\tget isShownTriggerGuide(): boolean\n\t{\n\t\treturn this.#isShownTriggerGuide;\n\t}\n\n\tsetShowRobotGuide(show: boolean, target?: Element)\n\t{\n\t\tthis.#showRobotGuide = show;\n\n\t\tif (show)\n\t\t{\n\t\t\tthis.#guideTargets['robot'] = target ?? null;\n\t\t}\n\t}\n\n\tsetShowTriggerGuide(show: boolean, target?: Element)\n\t{\n\t\tthis.#showTriggerGuide = show;\n\n\t\tif (show)\n\t\t{\n\t\t\tthis.#guideTargets['trigger'] = target ?? null;\n\t\t}\n\t}\n\n\tsetShowSupportingRobotGuide(show: boolean, target?: Element)\n\t{\n\t\tthis.#showSupportingRobotGuide = show;\n\n\t\tif (show)\n\t\t{\n\t\t\tthis.#guideTargets['supportingRobot'] = target ?? null;\n\t\t}\n\t}\n\n\t#resolveShowGuides()\n\t{\n\t\t// settings\n\t\tif (this.#isShownTriggerGuide)\n\t\t{\n\t\t\tthis.#showTriggerGuide = false;\n\t\t}\n\n\t\tif (this.#isShownSupportingRobotGuide)\n\t\t{\n\t\t\tthis.#showSupportingRobotGuide = false;\n\t\t\tthis.#isShownRobotGuide = true;\n\t\t}\n\n\t\tif (this.#isShownRobotGuide)\n\t\t{\n\t\t\tthis.#showRobotGuide = false;\n\t\t}\n\n\t\t// logic\n\t\tif (this.#showSupportingRobotGuide)\n\t\t{\n\t\t\tthis.#isShownRobotGuide = true;\n\t\t}\n\t}\n\n\t#getGuide(): ?Guide\n\t{\n\t\tlet guide = null;\n\n\t\tif (this.#showSupportingRobotGuide)\n\t\t{\n\t\t\tif (Type.isDomNode(this.#guideTargets['supportingRobot']))\n\t\t\t{\n\t\t\t\tguide = this.#getSupportingRobotGuide();\n\t\t\t\tguide.getPopup().setAutoHide(true);\n\t\t\t}\n\n\t\t\treturn guide;\n\t\t}\n\n\t\tif (this.#showTriggerGuide)\n\t\t{\n\t\t\tif (Type.isDomNode(this.#guideTargets['trigger']))\n\t\t\t{\n\t\t\t\tguide = this.#getTriggerGuide();\n\t\t\t\tguide.getPopup().setAutoHide(true);\n\t\t\t}\n\n\t\t\treturn guide;\n\t\t}\n\n\t\tif (this.#showRobotGuide)\n\t\t{\n\t\t\tif (Type.isDomNode(this.#guideTargets['robot']))\n\t\t\t{\n\t\t\t\tguide = this.#getRobotGuide();\n\t\t\t\tguide.getPopup().setAutoHide(true);\n\t\t\t}\n\n\t\t\treturn guide;\n\t\t}\n\n\t\treturn guide;\n\t}\n\n\tstart()\n\t{\n\t\tthis.#resolveShowGuides();\n\t\tconst guide = this.#getGuide();\n\t\tif (guide)\n\t\t{\n\t\t\tconst bindElement = guide.getCurrentStep().target;\n\t\t\tif (Type.isDomNode(bindElement) && document.body.contains(bindElement))\n\t\t\t{\n\t\t\t\tguide.showNextStep();\n\t\t\t}\n\t\t}\n\t}\n\n\t#getRobotGuide(): Guide\n\t{\n\t\treturn new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.#guideTargets['robot'],\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_TITLE_1'),\n\t\t\t\t\ttext: this.constructor.#getText([\n\t\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_SUBTITLE_1'),\n\t\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_SUBTITLE_2')\n\t\t\t\t\t]),\n\t\t\t\t\tarticle: '16547618',\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: false,\n\t\t\t\t\t\tbottom: true,\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'onShow': () => {\n\t\t\t\t\t\t\tthis.#isShownRobotGuide = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t}\n\n\t#getTriggerGuide(): Guide\n\t{\n\t\treturn new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.#guideTargets['trigger'],\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_TITLE_1'),\n\t\t\t\t\ttext: this.constructor.#getText([\n\t\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_SUBTITLE_1'),\n\t\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_SUBTITLE_2')\n\t\t\t\t\t]),\n\t\t\t\t\tarticle: '16547632',\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: false,\n\t\t\t\t\t\tbottom: true,\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'onShow': () => {\n\t\t\t\t\t\t\tthis.#isShownTriggerGuide = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t}\n\n\t#getSupportingRobotGuide(): Guide\n\t{\n\t\treturn new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.#guideTargets['supportingRobot'],\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_TITLE'),\n\t\t\t\t\ttext: this.constructor.#getText([\n\t\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_SUBTITLE_1'),\n\t\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_SUBTITLE_2'),\n\t\t\t\t\t]),\n\t\t\t\t\tarticle: '16547644',\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: false,\n\t\t\t\t\t\tbottom: true,\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'onShow': () => {\n\t\t\t\t\t\t\tthis.#isShownSupportingRobotGuide = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t}\n\n\tstatic #getText(subtitles: Array): Element\n\t{\n\t\tlet text = `<ul class=\"bizproc-automation-tour-guide-list\">`;\n\n\t\tfor (const subtitle of subtitles)\n\t\t{\n\t\t\ttext += `<li class=\"bizproc-automation-tour-guide-list-item\"> ${Text.encode(subtitle)} </li>`;\n\t\t}\n\n\t\ttext += `</ul>`;\n\n\t\treturn text;\n\t}\n}","import TemplatesScheme from './templates-scheme';\nimport { Context } from './context/context';\n\nexport {TemplateScope} from './template-scope';\nexport {TriggerManager} from './trigger-manager';\nexport {Trigger} from './trigger';\nexport {Template} from './template';\nexport {Robot} from './robot';\nexport {UserOptions} from './user-options';\nexport {Document} from './document/document';\nexport {ViewMode} from './view-mode';\nexport {ConditionGroup} from './condition/condition-group';\nexport {ConditionGroupSelector} from './selectors/condition-group-selector';\nexport {Condition} from './condition/condition';\nexport {Designer} from './designer';\nexport * from './tracker/tracker';\nexport * from './workflow/types';\nexport {Manager as SelectorManager} from './selectors/manager';\nexport {InlineSelector} from './selectors/inline-selector';\nexport {InlineSelectorCondition} from './selectors/inline-selector-condition';\nexport {InlineSelectorHtml} from './selectors/inline-selector-html';\nexport {SaveStateCheckbox} from './selectors/save-state-checkbox';\nexport {UserSelector} from './selectors/user-selector';\nexport {FileSelector} from './selectors/file-selector';\nexport {TimeSelector} from './selectors/time-selector';\nexport {DelayInterval} from './delay-interval';\nexport {DelayIntervalSelector} from './delay-interval-selector';\nexport {HelpHint} from './help-hint';\nexport {SelectorContext} from './context/selector-context';\nexport {AutomationGlobals} from './automation-globals';\nexport {Statuses} from './statuses';\n\nexport {Helper} from './helper';\n\nimport 'ui.design-tokens';\nimport 'ui.fonts.opensans';\nimport './css/style.css'\n\nexport {\n\tTemplatesScheme,\n\tContext,\n}\n\nexport {BeginningGuide} from './tourguide/beginning-guide';\nexport {AutomationGuide} from './tourguide/automation-guide';\n\nlet contextInstance: ?Context;\n\nexport function getGlobalContext(): Context\n{\n\tif (contextInstance instanceof Context)\n\t{\n\t\treturn contextInstance;\n\t}\n\n\tthrow new Error('Context is not initialized yet');\n}\n\nexport function tryGetGlobalContext(): ?Context\n{\n\ttry\n\t{\n\t\treturn getGlobalContext();\n\t}\n\tcatch (error)\n\t{\n\t\treturn null;\n\t}\n}\n\nexport function setGlobalContext(context: Context): Context\n{\n\tif (context instanceof Context)\n\t{\n\t\tcontextInstance = context;\n\t}\n\telse\n\t{\n\t\tthrow new Error('Unsupported Context');\n\t}\n\n\treturn context;\n}"],"names":["TemplateScope","rawTemplateScope","DocumentType","Type","isNil","Category","Id","Status","hasCategory","isNull","TemplatesScheme","scheme","_classPrivateFieldInitSpec","isArray","forEach","rawScope","scope","push","documentTypes","Map","set","getDocumentType","Array","from","values","documentType","documentCategories","category","getDocumentCategory","documentCategory","takenStatuses","Set","predicate","shouldBeTaken","has","getDocumentStatus","add","map","generator","BaseContext","defaultValue","setEventNamespace","isPlainObject","clone","name","value","isValueChanged","emit","hasOwnProperty","listener","subscribe","event","data","EventEmitter","Context","props","Runtime","getValues","document","userOptions","code","availableTriggers","find","trigger","get","availableRobots","canManage","isBoolean","canEdit","tracker","ViewMode","mode","getAll","includes","none","Trigger","draft","ConditionGroup","viewMode","Condition","edit","createNode","node","parentNode","replaceChild","getGlobalContext","String","statusList","status","STATUS_ID","getStatusId","triggerName","getCode","NAME","isString","rules","log","getTriggerLog","getId","condition","flag","userId","wrapperClass","isEdit","settingsBtn","copyBtn","Dom","create","attrs","className","text","Loc","getMessage","Event","bind","onCopyButtonClick","getLogStatus","TrackingStatus","COMPLETED","getPreviousStatusIdList","getName","containerClass","div","children","title","registerItem","deleteBtn","onDeleteButtonClick","appendChild","onSettingsButtonClick","button","HelpHint","showNoPermissionsHint","isManage","stopPropagation","initData","serialize","clearRules","getSettingProperties","filter","property","Copyable","key","init","query","getData","queryString","match","toLowerCase","indexOf","object","onbxdragstart","BX","proxy","dragStart","onbxdrag","dragMove","onbxdragstop","dragStop","onbxdraghover","dragOver","jsDD","registerObject","registerDest","undefined","unregisterObject","unregisterDest","proxy_context","stopCurrentDrag","itemWidth","offsetWidth","cloneNode","style","position","classList","width","body","x","y","left","top","destination","remove","type","getAttribute","querySelector","window","isCopy","ctrlKey","metaKey","copyTrigger","parent","statusId","thisColumn","insertBefore","moveTo","skipInsert","removeChild","APPLY_RULES","items","length","triggerData","RETURN","SETTINGS","Properties","Helper","JSON","stringify","i","v","fields","field","Designer","dialog","robotSettingsDialog","robot","triggerSettingsDialog","_classStaticPrivateFieldSpecSet","TriggerManager","triggersContainerNode","_classPrivateMethodInitSpec","isNone","TRIGGERS","querySelectorAll","initTriggers","markModified","columnNode","addCustomEvent","onRestAppInstall","clean","subscribeTriggerEvents","insertTriggerNode","openTriggerSettingsDialog","deleteTrigger","onSearch","manage","deleteButtons","hide","addClass","show","removeClass","callback","call","markDeleted","splice","unregisterItem","documentStatus","triggerNode","listNode","append","deleted","modified","context","getInstance","getTriggerSettingsDialog","changeTrigger","popup","close","formName","form","renderConditionSettings","iconHelp","events","click","getTriggerName","getAvailableTrigger","_classPrivateMethodGet","onCustomEvent","canSetExecuteBy","renderExecuteByControl","renderAllowBackwardsControl","setTriggerSettingsDialog","triggerManager","self","PopupWindow","generateUniqueId","titleBar","content","closeIcon","offsetLeft","offsetTop","closeByEsc","draggable","restrict","overlay","onPopupClose","destroySettingsDialogControls","destroy","buttons","PopupWindowButton","formData","ajax","prepareForm","setName","setConditionSettingsFromForm","setAllowBackwards","setExecuteBy","runAction","analyticsLabel","reInit","PopupWindowButtonLink","popupWindow","conditionGroup","getCondition","conditionSelector","ConditionGroupSelector","getFields","showValuesSelector","selector","Bizproc","FieldType","renderControl","getRawType","getResponsibleUserExpression","getExecuteBy","checked","isBackwardsAllowed","createTextNode","formFields","setCondition","createFromForm","installed","eventResult","redirect","setTimeout","method","dataType","url","ajaxUrl","ajax_action","document_signed","signedDocument","onsuccess","response","settingsDialogControls","controlNodes","control","role","UserSelector","decorateNode","UI","Hint","isFunction","result","exists","triggers","getListByDocumentStatus","getReturnProperties","ObjectId","Name","ObjectName","Expression","SystemExpression","propertyId","properties","getApplyRules","toRenderProperty","AllowSelection","getCategoryId","cmp","component","Options","Settings","Filter","check","templateManager","templates","template","robots","getProperty","OptionNameProperty","setApplyRules","Fields","fieldPrefix","Text","getRandom","hookLinkTextarea","placeholder","readonly","select","Handler","location","protocol","host","Uri","addParam","replace","Password","PasswordLoader","myAlertText","passwordAlert","Alert","color","AlertColor","WARNING","icon","AlertIcon","getTextContainer","loaderConfig","runComponentAction","action","then","error","alert","password","handleCloseBtnClick","getContainer","menuId","Math","random","fieldName","fieldsList","renderFieldCheckbox","fieldSelectorHandler","targetNode","Main","MenuManager","getMenuById","menuItems","encode","onclick","item","autoHide","pos","angle","offset","zIndex","fieldListNode","ChooseFieldLabel","foundField","fld","Document","options","rawDocumentType","documentId","categoryId","findIndex","isStringFilled","documentFields","getCurrentStatusId","index","slice","newStatusId","isArrayFilled","DelayInterval","params","BASIS_TYPE","CurrentDateTime","DELAY_TYPE","After","setType","setValue","setValueType","setBasis","setWorkTime","setWaitWorkDay","setInTime","valueType","basis","workTime","waitWorkDay","inTime","Before","In","parseInt","basisFields","workerExpression","CurrentDate","isSystemBasis","s","isNow","days","hours","minutes","fn","worker","emptyText","str","inTimeString","prefix","getFormattedPeriodLabel","fieldSuffix","label","labelIndex","labels","getPeriodLabels","CurrentDateTimeLocal","intervalString","toString","trimStart","h","d","substring","setTimeArgs","split","minute","pop","trim","hour","join","fnArgs","re","exec","found","period","element","bindToNode","showHint","hideHint","popupHint","bindElement","isSameNode","rawText","util","nl2br","lightShadow","darkMode","bindOptions","html","setAngle","showAngleHint","timeout","clearTimeout","createInstance","popupParameters","height","getPosition","WorkflowStatus","TrackingEntry","TRIGGER_ACTIVITY_TYPE","entryType","getAllActivityTypes","entryWorkflowStatus","getAllWorkflowStatuses","UNKNOWN_ACTIVITY_TYPE","EXECUTE_ACTIVITY_TYPE","CLOSE_ACTIVITY_TYPE","CANCEL_ACTIVITY_TYPE","FAULT_ACTIVITY_TYPE","CUSTOM_ACTIVITY_TYPE","REPORT_ACTIVITY_TYPE","ATTACHED_ENTITY_TYPE","ERROR_ACTIVITY_TYPE","DEBUG_ACTIVITY_TYPE","DEBUG_AUTOMATION_TYPE","DEBUG_DESIGNER_TYPE","DEBUG_LINK_TYPE","typeId","CREATED","RUNNING","SUSPENDED","TERMINATED","RobotEntry","entries","WAITING","entry","addEntry","id","datetime","workflowStatus","errors","note","notes","TriggerEntry","isTriggerEntry","TrackingEntryBuilder","workflowId","logEntry","Object","assign","isNumber","isKnownActivityType","isKnownWorkflowStatus","Tracker","addLogs","logEntryBuilder","rawEntry","setLogEntry","build","addTriggerEntry","addRobotEntry","robotEntry","isRobotRunning","isWorkflowCompleted","isCurrentStatus","isRobotRunningAtAnotherStatus","isRobotRunningAndCurrentWorkflowCompleted","documentSigned","DATA","LOG","Robot","isFrameMode","clonedRobot","robotData","generateName","Delay","getDelayInterval","other","CONDITION_TYPE","Mixed","getProperties","getRobotLog","DelayName","hasClass","isActive","setProperty","deleteButton","isSelected","selectNode","unselectNode","targetLabel","isView","viewData","responsibleLabel","labelText","getReturnFieldsDescription","getTitle","globalVariables","variable","globalConstants","constant","textContent","setAttribute","responsibleUrl","href","responsibleId","delayLabel","format","isExecuteAfterPrevious","delayNode","statusNode","subscribeOnce","isBindedToNode","delayNotes","getDelayNotes","AUTOCOMPLETED","getLogErrors","titleClassName","clipTitle","onTitleEditClick","lastChild","deleteRobot","openRobotSettingsDialog","DialogContext","copiedRobot","robotTitle","newTitle","Template","copyRobotTo","getNextRobot","e","preventDefault","nameNode","elements","fullTitle","arrTitle","lastWord","delay","ExecuteAfterPrevious","draggableItem","stub","droppableItem","droppableColumn","templateNode","beforeRobot","insertRobot","insertRobotNode","getDescriptionTitle","description","getRobotDescription","isObject","hasReturnProperties","hasAdditionalResultProperties","some","addProperty","fieldId","appendPropertyMods","printableTag","expression","usages","Constant","Variable","Parameter","GlobalConstant","GlobalVariable","Activity","collectExpressions","conditions","collectParsedExpressions","systemExpressionRegExp","RegExp","SYSTEM_EXPRESSION_PATTERN","groups","parsedUsage","activityRegExp","getBrokenLinks","collectUsages","objectsData","getConstants","getVariables","getParameters","getSerializedRobots","brokenLinks","size","source","searchInSource","brokenLinkObject","getRobotById","getReturnProperty","UserOptions","storedValue","save","constants","variables","templateContainerNode","delayMinLimitM","CONSTANTS","PARAMETERS","VARIABLES","DOCUMENT_STATUS","markExternalModified","fromRaw","initRobots","initButtons","isExternalModified","ROBOTS","selectedRobots","serialized","ID","isNaN","createExternalLocker","getTemplateId","createConstantsEditButton","createParametersEditButton","createExternalEditTemplateButton","createManageModeButton","enableManageMode","disableManageMode","bizprocEditorUrl","anchor","onExternalEditTemplateButtonClick","target","manageButton","cursor","onManageModeButtonClick","manageButtonNode","constantsEditorUrl","parametersEditorUrl","onUnsetExternalModifiedClick","onExternalModifiedSearch","InfoHelper","templateId","openBizprocEditor","intoRaw","Title","parentRobot","isEqual","robotNode","beforeNode","saveCallback","getRobotSettingsDialog","changeRobot","setRobotSettingsDialog","renderDelaySettings","robotBrokenLinks","renderBrokenLinkAlert","addMenuGroup","document_status","robot_json","toJsonString","form_name","dialogRows","showRobotSettingsPopup","popupMinWidth","popupWidth","initRobotSettingsControls","descriptionTitle","hasTitle","titleBarContent","Tag","render","bindAll","me","resizable","minWidth","minHeight","destroyRobotSettingsControls","onPopupResize","onResizeRobotSettings","onPopupResizeEnd","getWidth","isNewRobot","saveRobotSettings","delegate","buttonNode","robotSettingsControls","initRobotSettingsControl","controlNode","controlProps","SelectorContext","useSwitcherMenu","rootGroupTitle","needSync","checkbox","SelectorManager","SELECTOR_ROLE_USER","fieldProperty","parse","SELECTOR_ROLE_FILE","createSelectorByRole","SELECTOR_ROLE_SAVE_STATE","renderTo","onFieldSelect","addConstant","addParameter","onOpenMenu","onBeforeSave","idSalt","delayTypeNode","delayValueNode","delayValueTypeNode","delayBasisNode","delayWorkTimeNode","delayWaitWorkDayNode","delayInTimeNode","delayIntervalLabelNode","docFields","minLimitM","delayIntervalSelector","DelayIntervalSelector","labelNode","onchange","useAfterBasis","showWaitWorkDay","executeAfterPreviousBlock","hasTemplate","executeAfterPreviousCheckbox","setDelayInterval","setExecuteAfterPrevious","onOpenFieldMenu","moreInfoNode","showMoreLabel","bindOnce","scrollHeight","closeBtn","btnNode","onBeforeSaveRobotSettings","form_data_json","form_data","SUCCESS","updateData","setDelaySettingsFromForm","ERRORS","externalModified","keys","generatePropertyId","getConstant","Description","param","parameter","getParameter","existsList","robotUsages","usage","eventName","unsubscribe","automationGlobals","dstTemplate","copyTo","additionalFields","flat","ask","tabs","sort","skipRobot","isMixedCondition","robotMenuItems","customData","addGroup","supertitle","SuperTitle","gVariables","skipId","templateRobot","hasReturnFields","group","parentGroup","setObject","setField","setOperator","operator","Operator","EQUAL","NOT_EQUAL","Field","addItem","clonedGroup","joiner","clonedCondition","itemsArray","activityNames","Branch1","Branch2","valueIndex","BETWEEN","JOINER","And","Or","message","ConditionSelector","conditionObjectNode","objectNode","conditionFieldNode","fieldNode","conditionOperatorNode","operatorNode","valueNode","conditionValueNode","conditionValueNode2","value2","conditionJoinerNode","joinerNode","setLabelText","bindLabelNode","removeButtonNode","removeCondition","joinerButtonNode","changeJoiner","getField","valueLabel","getOperatorLabel","EMPTY","onLabelClick","showPopup","filterFields","objectSelect","fieldSelect","fieldSelectLabel","onFieldSelectorClick","selectedField","valueInput","valueWrapper","operatorSelect","createOperatorNode","operatorWrapper","onFieldChange","backgroundColor","firstChild","valueInputs","input","updateValueNode","fieldDialog","globalContext","InlineSelectorCondition","fireEvent","openMenu","isDomNode","conditionWrapper","getOperators","onOperatorChange","tpl","getTemplate","getGVariable","foundRobot","fieldType","multiple","allLabels","getAllLabels","list","NOT_EMPTY","CONTAIN","NOT_CONTAIN","IN","NOT_IN","GREATER_THEN","GREATER_THEN_OR_EQUAL","LESS_THEN","LESS_THEN_OR_EQUAL","filtered","docField","docType","Multiple","valueNodes","renderControlPublic","dataset","targetInput","parseTargetProperties","operatorList","operatorId","btn","formatValuePrintable","valueNode1","createValueNode","valueNode2","conditionNodes","getItems","Manager","selectorProps","FileSelector","SELECTOR_ROLE_INLINE","InlineSelector","SELECTOR_ROLE_INLINE_HTML","InlineSelectorHtml","SELECTOR_ROLE_TIME","TimeSelector","SaveStateCheckbox","InlineTimeSelector","isElementNode","time","getFormat","formatId","Date","convertBitrixFormat","dateFormat","dateTimeFormat","date","setHours","DateTimeFormat","getTime","Menu","maxHeight","groupId","hasGroup","menuButton","replaceOnWrite","renderWith","propertyType","skipPropertiesSwitcher","openPropertiesSwitcherMenu","fillGroups","onMenuOpen","Dialog","dropdownMode","enableSearch","injectDialogMenuTitles","showAvatars","getCustomData","compactView","fillFieldsGroups","fillFileGroup","searchable","groupKey","groupName","names","shift","addGroupItem","fileFields","disabled","currentItem","injectDialogMenuSupertitles","child","inputType","tagName","expressionOption","selected","hiddenInput","getElementById","selectionEnd","beforePart","middlePart","afterPart","substr","printablePrefix","custom","printableName","printableField","serverField","responsibleField","childGroup","entityId","toExpression","fromString","timeSelector","keyCode","altKey","shiftKey","exp","bindTargetEvents","firstElementChild","insertText","editor","InsertHtml","synchro","IsFocusedOnTextarea","textareaView","Focus","WrapWith","Sync","SaveContent","ResizeSceleton","handler","removeCustomEvent","dom","cont","header","footer","cutHeader","shouldSaveHeader","cutFooter","shouldSaveFooter","editorId","BXHtmlEditor","Get","savedState","additionalUserFields","userSelector","TYPE","None","menu","config","File","required","valueInputName","typeInputName","useDisk","labelFile","labelDisk","fileItem","setValues","ids","Disk","childNodes","fileRadio","fileTypeOptions","diskFileRadio","diskUploader","layout","addItems","addButtonNode","Automation","DiskUploader","msg","setMode","newType","SIZE","VIEW_URL","itemNode","itemField","closeWnd","setTime","constructor","showClock","CClockSelector","start_time","Show","timeParts","part","timeFormat","prepareBasisFields","showDelayIntervalPopup","uid","radioNow","labelNow","labelNowHelpNode","createAfterControlNode","createBeforeControlNode","createInControlNode","workTimeRadio","workTimeHelpNode","saveFormData","FormData","fieldsMenu","valueTypeMenu","setNow","Notification","Center","notify","radioAfter","labelAfter","createValueTypeSelector","basisField","getBasisField","basisValue","beforeBasisValueNode","beforeBasisNode","onBasisClick","afterHelpNode","radioBefore","labelBefore","beforeHelpNode","radioIn","labelIn","inBasisValueNode","inBasisNode","helpNode","labelTexts","onValueTypeSelectorClick","valueId","delayType","delimiter","system","isAvailable","workDayRadio","workDayHelpNode","AutomationGlobals","parameters","Globals","Instance","updatedGlobals","globals","newGlobals","prop","VisibilityName","concat","deletedGlobals","BaseType","Visibility","visibilityName","Statuses","stagesContainerNode","stagesContainer","backgroundNode","bgcolor","borderColor","bigint","red","green","blue","isDarkColor","BeginningGuide","article","toInteger","Guide","steps","bottom","onEvents","getPopup","setAutoHide","showNextStep","AutomationGuide","isShownRobotGuide","isShownTriggerGuide","guide","getCurrentStep","contains","subtitles","subtitle","contextInstance","Error","tryGetGlobalContext","setGlobalContext"],"mappings":";;;;;;;AAAA,CACkF;CAAA;CAAA;AAElF,KAAaA,aAAa;GAMzB,uBAAYC,gBAcX,EACD;KAAA;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,sCAAI,iBAAiBA,gBAAgB,CAACC,YAAY;KAClD,sCAAI,aAAa,CAACC,cAAI,CAACC,KAAK,CAACH,gBAAgB,CAACI,QAAQ,CAACC,EAAE,CAAC,GAAGL,gBAAgB,CAACI,QAAQ,GAAG,IAAI;KAC7F,sCAAI,WAAWJ,gBAAgB,CAACM,MAAM;;GACtC;KAAA;KAAA,wBAGD;OACC,IAAI,IAAI,CAACC,WAAW,EAAE,EACtB;SACC,iBAAU,sCAAI,iBAAeL,IAAI,cAAI,sCAAI,aAAWG,EAAE,cAAI,sCAAI,WAASA,EAAE;;OAG1E,iBAAU,sCAAI,iBAAeH,IAAI,cAAI,sCAAI,WAASG,EAAE;;;KACpD;KAAA,kCAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,sCAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,oCAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,8BAGD;OACC,OAAO,CAACH,cAAI,CAACM,MAAM,mCAAC,IAAI,aAAW;;;GACnC;CAAA;;;CCzDF;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AADA,CAE+C;CAAA;AAAA,KAE1BC,eAAe;GAInC,yBAAYC,QAA4B,EACxC;KAAA;KAAA;KAAA;KAAAC;OAAA;OAAA;;KACC,sCAAI,WAAW,EAAE;KAEjB,IAAIT,cAAI,CAACU,OAAO,CAACF,QAAM,CAAC,EACxB;OACCA,QAAM,CAACG,OAAO,CAAC,UAAAC,QAAQ,EAAI;SAC1B,IAAMC,KAAK,GAAG,IAAIhB,aAAa,CAACe,QAAQ,CAAC;SACzC,uCAAI,WAASE,IAAI,CAACD,KAAK,CAAC;QACxB,CAAC;;;GAEH;KAAA;KAAA,mCAGD;OACC,IAAME,aAAa,GAAG,IAAIC,GAAG,EAAE;OAAC,6EAEZ,IAAI;SAAA;OAAA;SAAxB,oDACA;WAAA,IADWH,KAAK;WAEfE,aAAa,CAACE,GAAG,CAACJ,KAAK,CAACK,eAAe,EAAE,CAAClB,IAAI,EAAEa,KAAK,CAACK,eAAe,EAAE,CAAC;;;SACxE;;SAAA;;OAED,OAAOC,KAAK,CAACC,IAAI,CAACL,aAAa,CAACM,MAAM,EAAE,CAAC;;;KACzC;KAAA,kCAEiBC,YAA0B,EAC5C;OACC,IAAMC,kBAAkB,GAAG,IAAIP,GAAG,EAAE;OAAC,8EAEjB,IAAI;SAAA;OAAA;SAAxB,uDACA;WAAA,IADWH,KAAK;WAEf,IAAIA,KAAK,CAACR,WAAW,EAAE,IAAIQ,KAAK,CAACK,eAAe,EAAE,CAAClB,IAAI,KAAKsB,YAAY,CAACtB,IAAI,EAC7E;aACC,IAAMwB,QAAQ,GAAGX,KAAK,CAACY,mBAAmB,EAAE;aAC5CF,kBAAkB,CAACN,GAAG,CAACO,QAAQ,CAACrB,EAAE,EAAEqB,QAAQ,CAAC;;;;SAE9C;;SAAA;;OAED,OAAOL,KAAK,CAACC,IAAI,CAACG,kBAAkB,CAACF,MAAM,EAAE,CAAC;;;KAC9C;KAAA,gCAEeC,YAA0B,EAAEI,gBAAyC,EACrF;OACC,IAAMC,aAAa,GAAG,IAAIC,GAAG,EAAE;OAC/B,IAAI5B,cAAI,CAACC,KAAK,CAACyB,gBAAgB,CAAC,EAChC;SACCA,gBAAgB,GAAG;WAACvB,EAAE,EAAE;UAAK;;OAG9B,IAAM0B,SAAS,GAAG,SAAZA,SAAS,CAAGhB,KAAK,EAAI;SAC1B,IAAMiB,aAAa,GAClBjB,KAAK,CAACK,eAAe,EAAE,CAAClB,IAAI,KAAKsB,YAAY,CAACtB,IAAI,KAC9Ca,KAAK,CAACR,WAAW,EAAE,GAAGQ,KAAK,CAACY,mBAAmB,EAAE,CAACtB,EAAE,KAAKuB,gBAAgB,CAACvB,EAAE,GAAG,IAAI,CAAC,IACrF,CAACwB,aAAa,CAACI,GAAG,CAAClB,KAAK,CAACmB,iBAAiB,EAAE,CAAC7B,EAAE,CAClD;SAED,IAAI2B,aAAa,EACjB;WACCH,aAAa,CAACM,GAAG,CAACpB,KAAK,CAACmB,iBAAiB,EAAE,CAAC7B,EAAE,CAAC;;SAGhD,OAAO2B,aAAa;QACpB;OAED,OAAOX,KAAK,CAACC,IAAI,wBAAC,IAAI,8BAAJ,IAAI,EAAWS,SAAS,EAAE,CAACK,GAAG,CAAC,UAAArB,KAAK;SAAA,OAAIA,KAAK,CAACmB,iBAAiB,EAAE;SAAC;;;GACpF;CAAA;CAAA,oBAESH,SAAqC,EAC/C;GACC,IAAMM,SAAS,2CAAG,SAAZA,SAAS,CAAa3B,MAAM;KAAA;KAAA;OAAA;SAAA;WAAA,wCAEbA,MAAM;WAAA;WAAA;SAAA;WAAA;aAAA;aAAA;;WAAfK,KAAK;WAAA,KAEXgB,SAAS,CAAChB,KAAK,CAAC;aAAA;aAAA;;WAAA;WAEnB,OAAMA,KAAK;SAAA;WAAA;WAAA;SAAA;WAAA;WAAA;SAAA;WAAA;WAAA;WAAA;SAAA;WAAA;WAAA;WAAA;SAAA;SAAA;WAAA;;QANRsB,SAAS;IASd;GAED,OAAOA,SAAS,mCAAC,IAAI,WAAS;CAC/B;;;;ACzFD,CAC2D;AAE3D,KAAaC,WAAW;GAAA;GAIvB,qBAAYC,YAAiC,EAC7C;KAAA;KAAA;KACC;KAAQ5B;OAAA;OAAA;;KAER,MAAK6B,iBAAiB,CAAC,+BAA+B,CAAC;KACvD,IAAItC,cAAI,CAACuC,aAAa,CAACF,YAAY,CAAC,EACpC;OACC,sFAAeA,YAAY;;KAC3B;;GACD;KAAA;KAAA,wBAGD;OACC,OAAO,IAAID,WAAW,CAACI,eAAK,mCAAC,IAAI,WAAS,CAAC;;;KAC3C;KAAA,4BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAEGC,IAAY,EAAEC,KAAU,EAC5B;OACC,IAAMC,cAAc,GAAG,IAAI,CAACZ,GAAG,CAACU,IAAI,CAAC;OACrC,sCAAI,WAASA,IAAI,CAAC,GAAGC,KAAK;OAC1B,IAAI,CAACE,IAAI,CAACD,cAAc,GAAG,cAAc,GAAG,YAAY,EAAE;SAACF,IAAI,EAAJA,IAAI;SAAEC,KAAK,EAALA;QAAM,CAAC;OAExE,OAAO,IAAI;;;KACX;KAAA,oBAEGD,IAAY,EAChB;OACC,OAAO,sCAAI,WAASA,IAAI,CAAC;;;KACzB;KAAA,oBAEGA,IAAY,EAChB;OACC,OAAO,sCAAI,WAASI,cAAc,CAACJ,IAAI,CAAC;;;KACxC;KAAA,qCAEoBA,IAAY,EAAEK,QAA6B,EAChE;OACC,IAAI,CAACC,SAAS,CAAC,cAAc,EAAE,UAACC,KAAK,EAAK;SACzC,IAAIA,KAAK,CAACC,IAAI,CAACR,IAAI,KAAKA,IAAI,EAC5B;WACCK,QAAQ,CAACE,KAAK,CAAC;;QAEhB,CAAC;OAEF,OAAO,IAAI;;;GACX;CAAA,EAtD+BE,6BAAY;;KCAhCC,OAAO;GAAA;GAEnB,iBAAYC,KAgBX,EACD;KAAA;KAAA,oGACOA,KAAK;;GACX;KAAA;KAAA,wBAGD;OAAA;;OAEC,OAAQ,IAAID,OAAO,CAACE,iBAAO,CAACb,KAAK,CAAC,IAAI,CAACc,SAAS,EAAE,CAAC,CAAC,CAClDrC,GAAG,CAAC,UAAU,EAAE,IAAI,CAACsC,QAAQ,CAACf,KAAK,EAAE,CAAC,CACtCvB,GAAG,CAAC,aAAa,uBAAE,IAAI,CAACuC,WAAW,sDAAhB,kBAAkBhB,KAAK,EAAE,CAAC;;;KAE/C;KAAA,oCAmFmBiB,IAAY,EAChC;OACC,OAAO,IAAI,CAACC,iBAAiB,CAACC,IAAI,CAAC,UAAAC,OAAO;SAAA,OAAIA,OAAO,CAAC,MAAM,CAAC,KAAKH,IAAI;SAAC;;;KACvE;KAAA,oBAnFD;OACC,OAAO,IAAI,CAACI,GAAG,CAAC,UAAU,CAAC;;;KAC3B;KAAA,oBAGD;OAAA;OACC,oBAAO,IAAI,CAACA,GAAG,CAAC,gBAAgB,CAAC,iDAAI,EAAE;;;KACvC;KAAA,oBAGD;OAAA;OACC,qBAAO,IAAI,CAACA,GAAG,CAAC,SAAS,CAAC,mDAAI,EAAE;;;KAChC;KAAA,oBAGD;OACC,IAAMC,eAAe,GAAG,IAAI,CAACD,GAAG,CAAC,iBAAiB,CAAC;OACnD,IAAI7D,cAAI,CAACU,OAAO,CAACoD,eAAe,CAAC,EACjC;SACC,OAAOA,eAAe;;OAGvB,OAAO,EAAE;;;KACT;KAAA,oBAGD;OACC,IAAMJ,iBAAiB,GAAG,IAAI,CAACG,GAAG,CAAC,mBAAmB,CAAC;OACvD,IAAI7D,cAAI,CAACU,OAAO,CAACgD,iBAAiB,CAAC,EACnC;SACC,OAAOA,iBAAiB;;OAGzB,OAAO,EAAE;;;KACT;KAAA,oBAGD;OACC,IAAMK,SAAS,GAAG,IAAI,CAACF,GAAG,CAAC,WAAW,CAAC;OAEvC,OAAO7D,cAAI,CAACgE,SAAS,CAACD,SAAS,CAAC,IAAIA,SAAS;;;KAC7C;KAAA,oBAGD;OACC,IAAME,OAAO,GAAG,IAAI,CAACJ,GAAG,CAAC,SAAS,CAAC;OAEnC,OAAO7D,cAAI,CAACgE,SAAS,CAACC,OAAO,CAAC,IAAIA,OAAO;;;KACzC;KAAA,oBAGD;OACC,OAAO,IAAI,CAACJ,GAAG,CAAC,aAAa,CAAC;;;KAC9B;KAAA,oBAGD;OACC,OAAO,IAAI,CAACA,GAAG,CAAC,SAAS,CAAC;MAC1B;KAAA,kBAEWK,OAAgB,EAC5B;OACC,IAAI,CAACjD,GAAG,CAAC,SAAS,EAAEiD,OAAO,CAAC;;;KAC5B;KAAA,oBAGD;OACC,OAAO,IAAI,CAACL,GAAG,CAAC,kBAAkB,CAAC;;;KACnC;KAAA,oBAGD;OACC,OAAO,IAAI,CAACA,GAAG,CAAC,oBAAoB,CAAC;;;KACrC;KAAA,oBAGD;OACC,OAAO,IAAI,CAACA,GAAG,CAAC,qBAAqB,CAAC;;;KACtC;KAAA,oBAQD;OACC,OAAO,IAAI,CAACA,GAAG,CAAC,mBAAmB,CAAC;;;GACpC;CAAA,EAzH2BzB,WAAW;;;;;;;;;;ACHxC,KAAa+B,QAAQ;GAUpB,kBAAYC,IAAY,EACxB;KAAA;KAAA3D;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KACC,sCAAI,SAAS2D,IAAI;KACjB,sCAAI,eAAe,EAAE;;GACrB;KAAA;KAAA,yBAQD;OACC,OAAO,sCAAI,6CAAWD,QAAQ,EAvBnBA,QAAQ,QAuBiB;;;KACpC;KAAA,yBAQD;OACC,OAAO,sCAAI,6CAAWA,QAAQ,EAjCnBA,QAAQ,QAiCiB;;;KACpC;KAAA,yBAQD;OACC,OAAO,sCAAI,6CAAWA,QAAQ,EA3CnBA,QAAQ,QA2CiB;;;KACpC;KAAA,2BAQD;OACC,OAAO,sCAAI,6CAAWA,QAAQ,EArDnBA,QAAQ,UAqDmB;;;KACtC;KAAA,4BAEW1B,IAAY,EAAEC,KAAU,EACpC;OACC,sCAAI,eAAaD,IAAI,CAAC,GAAGC,KAAK;OAE9B,OAAO,IAAI;;;KACX;KAAA,4BAEWD,IAAY,EACxB;OAAA,IAD0BJ,YAAiB,uEAAG,IAAI;OAEjD,IAAI,sCAAI,eAAaQ,cAAc,CAACJ,IAAI,CAAC,EACzC;SACC,OAAO,sCAAI,eAAaA,IAAI,CAAC;;OAG9B,OAAOJ,YAAY;;;KACnB;KAAA,0BAaD;OACC,yCAAO,IAAI;;;KACX;KAAA,uBArED;OACC,OAAO,IAAI8B,QAAQ,iCAACA,QAAQ,EAlBjBA,QAAQ,SAkBgB;;;KACnC;KAAA,uBAQD;OACC,OAAO,IAAIA,QAAQ,iCAACA,QAAQ,EA5BjBA,QAAQ,SA4BgB;;;KACnC;KAAA,uBAQD;OACC,OAAO,IAAIA,QAAQ,iCAACA,QAAQ,EAtCjBA,QAAQ,SAsCgB;;;KACnC;KAAA,yBAQD;OACC,OAAO,IAAIA,QAAQ,iCAACA,QAAQ,EAhDjBA,QAAQ,WAgDkB;;;KACrC;KAAA,wBAwBcC,IAAY,EAC3B;OACC,IAAID,QAAQ,CAACE,MAAM,EAAE,CAACC,QAAQ,CAACF,IAAI,CAAC,EACpC;SACC,OAAO,IAAID,QAAQ,CAACC,IAAI,CAAC;;OAG1B,OAAOD,QAAQ,CAACI,IAAI,EAAE;;;KACtB;KAAA,yBAQD;OACC,OAAO,iCACN,IAAI,EA3FMJ,QAAQ,0CA4FlB,IAAI,EA5FMA,QAAQ,0CA6FlB,IAAI,EA7FMA,QAAQ,0CA8FlB,IAAI,EA9FMA,QAAQ,WA+FlB;;;GACD;CAAA;CACD;GAAA;GAAA,OA5Fe;CAAC;CAAA;GAAA;GAAA,OACD;CAAC;CAAA;GAAA;GAAA,OACD;CAAC;CAAA;GAAA;GAAA,OACC;CAAC;;;;ACRnB,CAGgG;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEhG,KAAaK,OAAO;GAAA;GAcnB,mBACA;KAAA;KAAA;KACC;KAAQ/D;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KACR,MAAK6B,iBAAiB,CAAC,uBAAuB,CAAC;KAE/C,MAAKmC,KAAK,GAAG,KAAK;KAClB,oFAAa,EAAE;KACf,uFAAgB,KAAK;KACrB,wFAAiBN,QAAQ,CAACI,IAAI,EAAE;KAChC,yFAAkB,IAAIG,iCAAc,EAAE;KAAC;;GACvC;KAAA;KAAA,qBAiBIzB,IAAyB,EAAE0B,QAAmB,EACnD;OACC,sCAAI,SAASnC,eAAK,CAACS,IAAI,CAAC;OAExB,IAAI,CAACjD,cAAI,CAACuC,aAAa,CAAC,sCAAI,SAAO,aAAa,CAAC,CAAC,EAClD;SACC,sCAAI,SAAO,aAAa,CAAC,GAAG,EAAE;;OAG/B,IAAI,sCAAI,SAAO,aAAa,CAAC,CAACqC,SAAS,EACvC;SACC,sCAAI,cAAc,IAAIF,iCAAc,CAAC,sCAAI,SAAO,aAAa,CAAC,CAACE,SAAS,CAAC;QACzE,MAED;SACC,sCAAI,cAAc,IAAIF,iCAAc,EAAE;;OAGvC,sCAAI,aAAa1E,cAAI,CAACC,KAAK,CAAC0E,QAAQ,CAAC,GAAGR,QAAQ,CAACU,IAAI,EAAE,GAAGF,QAAQ;OAClE,sCAAI,SAAS,IAAI,CAACG,UAAU,EAAE;;;KAC9B;KAAA,uBAEM7B,IAAyB,EAAE0B,QAAmB,EACrD;OACC,IAAMI,IAAI,qCAAG,IAAI,QAAM;OACvB,sCAAI,SAAS,IAAI,CAACD,UAAU,EAAE;OAC9B,IAAIC,IAAI,CAACC,UAAU,EACnB;SACCD,IAAI,CAACC,UAAU,CAACC,YAAY,mCAAC,IAAI,UAAQF,IAAI,CAAC;;;;KAE/C;KAAA,0BAGD;OACC,OAAOG,mCAAgB,EAAE,CAACjB,OAAO;;;KACjC;KAAA,wBAGD;OACC,OAAO,sCAAI,SAAO,IAAI,CAAC,IAAI,CAAC;;;KAC5B;KAAA,8BAGD;OACC,OAAOkB,MAAM,CAAC,sCAAI,SAAO,iBAAiB,CAAC,IAAI,EAAE,CAAC;;;KAClD;KAAA,4BAGD;OAAA;OACC,OAAOD,mCAAgB,EAAE,CAAC3B,QAAQ,CAAC6B,UAAU,CAACzB,IAAI,CAAC,UAAA0B,MAAM;SAAA,OAAIF,MAAM,CAACE,MAAM,CAACC,SAAS,CAAC,KAAK,MAAI,CAACC,WAAW,EAAE;SAAC;;;KAC7G;KAAA,0BAGD;OAAA;OACC,gCAAO,sCAAI,SAAO,MAAM,CAAC,yEAAI,EAAE;;;KAC/B;KAAA,0BAGD;OACC,IAAIC,WAAW,GAAG,sCAAI,SAAO,MAAM,CAAC;OACpC,IAAI,CAACA,WAAW,EAChB;SAAA;SACC,IAAM/B,IAAI,GAAG,IAAI,CAACgC,OAAO,EAAE;SAC3B,IAAM7B,OAAO,GAAGsB,mCAAgB,EAAE,CAACxB,iBAAiB,CAACC,IAAI,CAAC,UAACC,OAAO;WAAA,OAAKH,IAAI,KAAKG,OAAO,CAAC,MAAM,CAAC;WAAC;SAChG4B,WAAW,oBAAG5B,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAE8B,IAAI,yDAAIjC,IAAI;;OAGpC,OAAO+B,WAAW;;;KAClB;KAAA,wBAEO/C,IAAY,EACpB;OACC,IAAIzC,cAAI,CAAC2F,QAAQ,CAAClD,IAAI,CAAC,EACvB;SACC,sCAAI,SAAO,MAAM,CAAC,GAAGA,IAAI;;OAG1B,OAAO,IAAI;;;KACX;KAAA,gCAGD;OACC,OAAO,sCAAI,SAAO,aAAa,CAAC;;;KAChC;KAAA,8BAEamD,KAAa,EAC3B;OACC,sCAAI,SAAO,aAAa,CAAC,GAAGA,KAAK;OAEjC,OAAO,IAAI;;;KACX;KAAA,+BAGD;OACC,IAAMC,GAAG,GAAGX,mCAAgB,EAAE,CAAChB,OAAO,CAAC4B,aAAa,CAAC,IAAI,CAACC,KAAK,EAAE,CAAC;OAClE,OAAOF,GAAG,GAAGA,GAAG,CAACR,MAAM,GAAG,IAAI;;;KAC9B;KAAA,+BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,6BAEYW,SAAyB,EACtC;OACC,sCAAI,cAAcA,SAAS;OAC3B,OAAO,IAAI;;;KACX;KAAA,qCAGD;OACC,OAAO,sCAAI,SAAO,aAAa,CAAC,CAAC,iBAAiB,CAAC,KAAK,GAAG;;;KAC3D;KAAA,kCAEiBC,IAAa,EAC/B;OACC,sCAAI,SAAO,aAAa,CAAC,CAAC,iBAAiB,CAAC,GAAGA,IAAI,GAAG,GAAG,GAAG,GAAG;OAE/D,OAAO,IAAI;;;KACX;KAAA,+BAGD;OACC,OAAO,sCAAI,SAAO,aAAa,CAAC,CAAC,WAAW,CAAC,IAAI,EAAE;;;KACnD;KAAA,6BAEYC,MAAc,EAC3B;OACC,sCAAI,SAAO,aAAa,CAAC,CAAC,WAAW,CAAC,GAAGA,MAAM;OAE/C,OAAO,IAAI;;;KACX;KAAA,6BAGD;OACC,IAAIC,YAAY,GAAG,yCAAyC;OAE5D,IAAI,sCAAI,aAAWC,MAAM,EAAE,IAAI,IAAI,CAACnC,OAAO,EAAE,EAC7C;SACCkC,YAAY,IAAI,oDAAoD;;OAGrE,IAAIE,WAAW,GAAG,IAAI;OACtB,IAAIC,OAAO,GAAG,IAAI;OAClB,IAAI,sCAAI,aAAWF,MAAM,EAAE,EAC3B;SACCC,WAAW,GAAGE,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAC/BC,KAAK,EAAE;aACNC,SAAS,EAAE;YACX;WACDC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,6BAA6B;UAClD,CAAC;SAEFP,OAAO,GAAGC,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAC3BC,KAAK,EAAE;aACNC,SAAS,EAAE;YACX;WACDC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC,IAAI;UACvD,CAAC;SAEFC,eAAK,CAACC,IAAI,CAACT,OAAO,EAAE,OAAO,EAAE,IAAI,CAACU,iBAAiB,CAACD,IAAI,CAAC,IAAI,EAAET,OAAO,CAAC,CAAC;;OAGzE,IAAI,IAAI,CAACW,YAAY,EAAE,KAAKC,iCAAc,CAACC,SAAS,EACpD;SACChB,YAAY,IAAI,mDAAmD;QACnE,MACI,IAAIjB,mCAAgB,EAAE,CAAC3B,QAAQ,CAAC6D,uBAAuB,EAAE,CAAC9C,QAAQ,CAAC,IAAI,CAACiB,WAAW,EAAE,CAAC,EAC3F;SACCY,YAAY,IAAI,yDAAyD;;OAG1E,IAAMX,WAAW,GAAG,IAAI,CAAC6B,OAAO,EAAE;OAElC,IAAIC,cAAc,GAAG,iCAAiC;OAEtD,IAAI,IAAI,CAACL,YAAY,EAAE,KAAKC,iCAAc,CAACC,SAAS,EACpD;SACCG,cAAc,IAAI,aAAa;QAC/B,MACI,IAAI,IAAI,CAAC7C,KAAK,EACnB;SACC6C,cAAc,IAAI,UAAU;;OAG7B,IAAMC,GAAG,GAAGhB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAC7BC,KAAK,EAAE;WACN,WAAW,EAAE,mBAAmB;WAChC,WAAW,EAAEa,cAAc;WAC3B,WAAW,EAAE;UACb;SACDE,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aACNC,SAAS,EAAEP;YACX;WACDqB,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eACNC,SAAS,EAAE,8CAA8C;eACzDe,KAAK,EAAEjC;cACP;aACDmB,IAAI,EAAEnB;YACN,CAAC;UAEH,CAAC,EACFc,OAAO,EACPD,WAAW;QAEZ,CAAC;OAEF,IAAI,CAAC,sCAAI,aAAWD,MAAM,EAAE,EAC5B;SACC,OAAOmB,GAAG;;OAGX,IAAI,IAAI,CAACtD,OAAO,EAAE,EAClB;SACC,IAAI,CAACyD,YAAY,CAACH,GAAG,CAAC;;OAGvB,IAAMI,SAAS,GAAGpB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SACpCC,KAAK,EAAE;WACN,WAAW,EAAE,oBAAoB;WACjC,WAAW,EAAE;;QAEd,CAAC;OAEFK,eAAK,CAACC,IAAI,CAACY,SAAS,EAAE,OAAO,EAAE,IAAI,CAACC,mBAAmB,CAACb,IAAI,CAAC,IAAI,EAAEY,SAAS,CAAC,CAAC;OAE9EJ,GAAG,CAACM,WAAW,CAACF,SAAS,CAAC;OAE1B,IAAI,sCAAI,aAAWvB,MAAM,EAAE,EAC3B;SACCU,eAAK,CAACC,IAAI,CAACQ,GAAG,EAAE,OAAO,EAAE,IAAI,CAACO,qBAAqB,CAACf,IAAI,CAAC,IAAI,EAAEQ,GAAG,CAAC,CAAC;;OAGrE,OAAOA,GAAG;;;KACV;KAAA,sCAEqBQ,MAAM,EAC5B;OACC,IAAI,CAAC,IAAI,CAAC9D,OAAO,EAAE,EACnB;SACC+D,2BAAQ,CAACC,qBAAqB,CAACF,MAAM,CAAC;QACtC,MACI,IAAI,CAAC,sCAAI,aAAWG,QAAQ,EAAE,EACnC;SACC,IAAI,CAACtF,IAAI,CAAC,wBAAwB,EAAE;WAACgB,OAAO,EAAE;UAAK,CAAC;;;;KAErD;KAAA,kCAEiBmE,MAAmB,EAAE/E,KAAK,EAC5C;OACCA,KAAK,CAACmF,eAAe,EAAE;OAEvB,IAAI,CAAC,IAAI,CAAClE,OAAO,EAAE,EACnB;SACC+D,2BAAQ,CAACC,qBAAqB,CAACF,MAAM,CAAC;QACtC,MACI,IAAI,CAAC,sCAAI,aAAWG,QAAQ,EAAE,EACnC;SACC,IAAMtE,OAAO,GAAG,IAAIY,OAAO,EAAE;SAC7B,IAAM4D,QAAQ,GAAG,IAAI,CAACC,SAAS,EAAE;SACjC,OAAOD,QAAQ,CAAC,IAAI,CAAC;SAErB,IAAME,UAAU,GAAG,IAAI,CAACC,oBAAoB,EAAE,CAC5CC,MAAM,CAAC,UAACC,QAAQ;WAAA,OAAKA,QAAQ,CAACC,QAAQ,KAAK,KAAK;WAAC,CACjDxG,GAAG,CAAC,UAACuG,QAAQ;WAAA,OAAKA,QAAQ,CAACtI,EAAE;WAAC;SAGhCmI,UAAU,CAAC3H,OAAO,CAAC,UAAAgI,GAAG;WAAA,OAAI,OAAOP,QAAQ,CAAC,aAAa,CAAC,CAACO,GAAG,CAAC;WAAC;SAE9D/E,OAAO,CAACgF,IAAI,CAACR,QAAQ,oCAAE,IAAI,aAAW;SACtC,IAAI,CAACxF,IAAI,CAAC,gBAAgB,EAAE;WAACgB,OAAO,EAAPA;UAAQ,CAAC;;;;KAEvC;KAAA,yBACQZ,KAAK,EACd;OACC,IAAI,mCAAC,IAAI,QAAM,EACf;SACC;;OAGD,IAAM6F,KAAK,GAAG7F,KAAK,CAAC8F,OAAO,EAAE,CAACC,WAAW;OACzC,IAAMC,KAAK,GAAG,CAACH,KAAK,IAAI,IAAI,CAACxB,OAAO,EAAE,CAAC4B,WAAW,EAAE,CAACC,OAAO,CAACL,KAAK,CAAC,IAAI,CAAC;OAExEtC,aAAG,CAACyC,KAAK,GAAG,aAAa,GAAG,UAAU,CAAC,mCAAC,IAAI,UAAQ,mBAAmB,CAAC;;;KACxE;KAAA,6BAEYG,MAAM,EACnB;OACC,IAAInJ,cAAI,CAACC,KAAK,CAACkJ,MAAM,CAAC,UAAU,CAAC,CAAC,EAClC;SACCA,MAAM,CAACC,aAAa,GAAGC,EAAE,CAACC,KAAK,CAAC,IAAI,CAACC,SAAS,EAAE,IAAI,CAAC;SACrDJ,MAAM,CAACK,QAAQ,GAAGH,EAAE,CAACC,KAAK,CAAC,IAAI,CAACG,QAAQ,EAAE,IAAI,CAAC;SAC/CN,MAAM,CAACO,YAAY,GAAGL,EAAE,CAACC,KAAK,CAAC,IAAI,CAACK,QAAQ,EAAE,IAAI,CAAC;SACnDR,MAAM,CAACS,aAAa,GAAGP,EAAE,CAACC,KAAK,CAAC,IAAI,CAACO,QAAQ,EAAE,IAAI,CAAC;SACpDC,IAAI,CAACC,cAAc,CAACZ,MAAM,CAAC;SAC3BW,IAAI,CAACE,YAAY,CAACb,MAAM,EAAE,CAAC,CAAC;;;;KAE7B;KAAA,+BAEcA,MAAM,EACrB;OACCA,MAAM,CAACC,aAAa,GAAGa,SAAS;OAChCd,MAAM,CAACK,QAAQ,GAAGS,SAAS;OAC3Bd,MAAM,CAACO,YAAY,GAAGO,SAAS;OAC/Bd,MAAM,CAACS,aAAa,GAAGK,SAAS;OAChCH,IAAI,CAACI,gBAAgB,CAACf,MAAM,CAAC;OAC7BW,IAAI,CAACK,cAAc,CAAChB,MAAM,CAAC;;;KAC3B;KAAA,4BAGD;OACC,sCAAI,kBAAkBE,EAAE,CAACe,aAAa;OAEtC,IAAI,mCAAC,IAAI,iBAAe,EACxB;SACCN,IAAI,CAACO,eAAe,EAAE;SACtB;;OAGD,IAAI,mCAAC,IAAI,QAAM,EACf;SACC,IAAMC,SAAS,GAAG,sCAAI,kBAAgBC,WAAW;SACjD,sCAAI,SAAS,sCAAI,kBAAgBC,SAAS,CAAC,IAAI,CAAC;SAChD,sCAAI,SAAOC,KAAK,CAACC,QAAQ,GAAG,UAAU;SACtC,sCAAI,SAAOC,SAAS,CAAC1I,GAAG,CAAC,sCAAsC,CAAC;SAChE,sCAAI,SAAOwI,KAAK,CAACG,KAAK,GAAGN,SAAS,GAAG,IAAI;SACzC/G,QAAQ,CAACsH,IAAI,CAAChD,WAAW,mCAAC,IAAI,SAAO;;;;KAEtC;KAAA,yBAEQiD,CAAC,EAAEC,CAAC,EACb;OACC,sCAAI,SAAON,KAAK,CAACO,IAAI,GAAGF,CAAC,GAAG,IAAI;OAChC,sCAAI,SAAOL,KAAK,CAACQ,GAAG,GAAGF,CAAC,GAAG,IAAI;;;KAC/B;KAAA,yBAEQG,WAAW,EAAEJ,CAAC,EAAEC,CAAC,EAC1B;OACC,sCAAI,IAAI,mBACR;SACC,sCAAI,kBAAgBJ,SAAS,CAACQ,MAAM,CAAC,qCAAqC,CAAC;;OAG5E,sCAAI,IAAI,qBACR;SACC,sCAAI,oBAAkBR,SAAS,CAACQ,MAAM,CAAC,qCAAqC,CAAC;;OAG9E,IAAMC,IAAI,GAAGF,WAAW,CAACG,YAAY,CAAC,WAAW,CAAC;OAElD,IAAID,IAAI,KAAK,cAAc,EAC3B;SACC,sCAAI,kBAAkBF,WAAW;SACjC,sCAAI,oBAAoB,IAAI;;OAG7B,IAAIE,IAAI,KAAK,gBAAgB,EAC7B;SACC,sCAAI,oBAAoBF,WAAW,CAACI,aAAa,CAAC,4BAA4B,CAAC;SAC/E,sCAAI,kBAAkB,IAAI;;OAG3B,sCAAI,IAAI,mBACR;SACC,sCAAI,kBAAgBX,SAAS,CAAC1I,GAAG,CAAC,qCAAqC,CAAC;;OAGzE,sCAAI,IAAI,qBACR;SACC,sCAAI,oBAAkB0I,SAAS,CAAC1I,GAAG,CAAC,qCAAqC,CAAC;;;;KAE3E;KAAA,yBAEQ6I,CAAC,EAAEC,CAAC,EAAE/H,KAAK,EACpB;OAAA;OACCA,KAAK,GAAGA,KAAK,IAAIuI,MAAM,CAACvI,KAAK;OAC7B,IAAIY,OAAO,GAAG,IAAI;OAClB,IAAM4H,MAAM,GAAGxI,KAAK,KAAKA,KAAK,CAACyI,OAAO,IAAIzI,KAAK,CAAC0I,OAAO,CAAC;OACxD,IAAMC,WAAW,GAAG,SAAdA,WAAW,CAAIC,MAAM,EAAEC,QAAQ,EAAK;SACzC,IAAMjI,OAAO,GAAG,IAAIY,OAAO,EAAE;SAC7B,IAAM4D,QAAQ,GAAGwD,MAAM,CAACvD,SAAS,EAAE;SACnC,OAAOD,QAAQ,CAAC,IAAI,CAAC;SAErB,IAAME,UAAU,GAAG,MAAI,CAACC,oBAAoB,EAAE,CAC5CC,MAAM,CAAC,UAACC,QAAQ;WAAA,OAAKA,QAAQ,CAACC,QAAQ,KAAK,KAAK;WAAC,CACjDxG,GAAG,CAAC,UAACuG,QAAQ;WAAA,OAAKA,QAAQ,CAACtI,EAAE;WAAC;SAGhCmI,UAAU,CAAC3H,OAAO,CAAC,UAAAgI,GAAG;WAAA,OAAI,OAAOP,QAAQ,CAAC,aAAa,CAAC,CAACO,GAAG,CAAC;WAAC;SAE9DP,QAAQ,CAAC,iBAAiB,CAAC,GAAGyD,QAAQ;SACtCjI,OAAO,CAACgF,IAAI,CAACR,QAAQ,oCAAEwD,MAAM,aAAW;SAExC,OAAOhI,OAAO;QACd;OAED,sCAAI,IAAI,mBACR;SACC,sCAAI,IAAI,mBACR;WACC,sCAAI,kBAAgB+G,SAAS,CAACQ,MAAM,CAAC,qCAAqC,CAAC;WAC3E,IAAMW,UAAU,GAAG,sCAAI,kBAAgB9G,UAAU;WACjD,IAAI,CAACwG,MAAM,EACX;aACCM,UAAU,CAACC,YAAY,mCAAC,IAAI,qDAAiB,IAAI,kBAAgB;aACjE,IAAI,CAACC,MAAM,CAACF,UAAU,CAACT,YAAY,CAAC,gBAAgB,CAAC,CAAC;YACtD,MAED;aACCzH,OAAO,GAAG+H,WAAW,CAAC,IAAI,EAAEG,UAAU,CAACT,YAAY,CAAC,gBAAgB,CAAC,CAAC;aACtES,UAAU,CAACC,YAAY,mCAACnI,OAAO,4CAAQ,IAAI,kBAAgB;;UAE5D,MACI,sCAAI,IAAI,qBACb;WACC,sCAAI,oBAAkB+G,SAAS,CAACQ,MAAM,CAAC,qCAAqC,CAAC;WAC7E,IAAI,CAACK,MAAM,EACX;aACC,sCAAI,oBAAkB3D,WAAW,mCAAC,IAAI,kBAAgB;aACtD,IAAI,CAACmE,MAAM,CAAC,sCAAI,oBAAkBX,YAAY,CAAC,gBAAgB,CAAC,CAAC;YACjE,MAED;aACCzH,OAAO,GAAG+H,WAAW,CAAC,IAAI,EAAE,sCAAI,oBAAkBN,YAAY,CAAC,gBAAgB,CAAC,CAAC;aACjF,sCAAI,oBAAkBxD,WAAW,mCAACjE,OAAO,SAAO;;;SAIlD,IAAIA,OAAO,EACX;WACC,IAAI,CAAChB,IAAI,CAAC,gBAAgB,EAAE;aAC3BgB,OAAO,EAAPA,OAAO;aACPqI,UAAU,EAAE;YACZ,CAAC;;;OAIJ,sCAAI,SAAOjH,UAAU,CAACkH,WAAW,mCAAC,IAAI,SAAO;OAC7C,sCAAI,SAAS,IAAI;OACjB,sCAAI,kBAAkB,IAAI;OAC1B,sCAAI,kBAAkB,IAAI;;;KAC1B;KAAA,oCAEmBnE,MAAmB,EAAE/E,KAAK,EAC9C;OACCA,KAAK,CAACmF,eAAe,EAAE;OAEvB,IAAI,CAAC,IAAI,CAAClE,OAAO,EAAE,EACnB;SACC+D,2BAAQ,CAACC,qBAAqB,CAACF,MAAM,CAAC;QACtC,MACI,IAAI,CAAC,sCAAI,aAAWG,QAAQ,EAAE,EACnC;SACC3B,aAAG,CAAC4E,MAAM,CAACpD,MAAM,CAAC/C,UAAU,CAAC;SAC7B,IAAI,CAACpC,IAAI,CAAC,iBAAiB,EAAE;WAACgB,OAAO,EAAE;UAAK,CAAC;;;;KAE9C;KAAA,2BAEUX,IAAyB,EACpC;OACC,IAAIjD,cAAI,CAACuC,aAAa,CAACU,IAAI,CAAC,EAC5B;SACC,sCAAI,SAASA,IAAI;QACjB,MAED;SACC,MAAM,cAAc;;;;KAErB;KAAA,8BAGD;OACC,sCAAI,YAAY,IAAI;OAEpB,OAAO,IAAI;;;KACX;KAAA,4BAGD;OACC,IAAMA,IAAI,GAAGT,eAAK,mCAAC,IAAI,SAAO;OAC9B,sCAAI,IAAI,aACR;SACCS,IAAI,CAAC,SAAS,CAAC,GAAG,GAAG;;OAGtB,IAAI,CAACjD,cAAI,CAACuC,aAAa,CAACU,IAAI,CAACkJ,WAAW,CAAC,EACzC;SACClJ,IAAI,CAACkJ,WAAW,GAAG,EAAE;;OAGtB,IAAI,CAAC,sCAAI,cAAYC,KAAK,CAACC,MAAM,EACjC;SACC,OAAOpJ,IAAI,CAACkJ,WAAW,CAACvH,SAAS;QACjC,MAED;SACC3B,IAAI,CAACkJ,WAAW,CAACvH,SAAS,GAAG,sCAAI,cAAYyD,SAAS,EAAE;;OAGzD,OAAOpF,IAAI;;;KACX;KAAA,uBAEM4I,QAAQ,EACf;OACC,sCAAI,SAAO,iBAAiB,CAAC,GAAGA,QAAQ;OACxC,IAAI,CAACjJ,IAAI,CAAC,kBAAkB,EAAE;SAACgB,OAAO,EAAE;QAAK,CAAC;;;KAC9C;KAAA,sCAGD;OAAA;OACC,IAAM0I,WAAW,GAAGpH,mCAAgB,EAAE,CAACxB,iBAAiB,CAACC,IAAI,CAAC,UAAAC,OAAO;SAAA,OAAIA,OAAO,CAAC,MAAM,CAAC,KAAK,MAAI,CAAC6B,OAAO,EAAE;SAAC;OAE5G,OAAO6G,WAAW,IAAItM,cAAI,CAACU,OAAO,CAAC4L,WAAW,CAACC,MAAM,CAAC,GAAGD,WAAW,CAACC,MAAM,GAAG,EAAE;;;KAChF;KAAA,uCAGD;OAAA;OACC,IAAMD,WAAW,GAAGpH,mCAAgB,EAAE,CAACxB,iBAAiB,CAACC,IAAI,CAAC,UAAAC,OAAO;SAAA,OAAIA,OAAO,CAAC,MAAM,CAAC,KAAK,MAAI,CAAC6B,OAAO,EAAE;SAAC;OAE5G,IAAI6G,WAAW,CAACE,QAAQ,IAAIF,WAAW,CAACE,QAAQ,CAACC,UAAU,EAC3D;SACC,OAAOH,WAAW,CAACE,QAAQ,CAACC,UAAU;;OAGvC,OAAO,EAAE;;;KACT;KAAA,oBA/hBD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAGD;OAAA;OACC,iCAAO,sCAAI,SAAO,iBAAiB,CAAC,2EAAI,EAAE;;;GAC1C;CAAA,EAvC2BvJ,6BAAY;;;;;;;;;;;ACLzC,KAEawJ,MAAM;GAAA;KAAA;;GAAA;KAAA;KAAA,mCAKlB;OAAA;OACC,gCAAEA,MAAM,EANGA,MAAM,yEAMfA,MAAM,EANGA,MAAM;OAOjB,OAAO,yBAAyB,qCAAGA,MAAM,EAP9BA,MAAM,eAOqC;;;KACtD;KAAA,6BAEmBzJ,IAAI,EACxB;OACC,OAAO0J,IAAI,CAACC,SAAS,CAAC3J,IAAI,EAAE,UAAU4J,CAAC,EAAEC,CAAC,EAC1C;SACC,IAAI,OAAOA,CAAE,IAAI,SAAS,EAC1B;WACC,OAAOA,CAAC,GAAG,GAAG,GAAG,GAAG;;SAErB,OAAOA,CAAC;QACR,CAAC;;;KACF;KAAA,6CAEmCC,MAAqB,EACzD;OACC,IAAI/M,cAAI,CAACU,OAAO,CAACqM,MAAM,CAAC,EACxB;SAAA,6CACqBA,MAAM;WAAA;SAAA;WAA1B,oDACA;aAAA,IADWC,KAAK;aAEf,IAAIA,KAAK,CAAC,IAAI,CAAC,KAAK,gBAAgB,IAAIA,KAAK,CAAC,IAAI,CAAC,KAAK,gBAAgB,EACxE;eACC,OAAO,IAAI,GAACA,KAAK,CAAC,MAAM,CAAC,GAAC,IAAI;;;;WAE/B;;WAAA;;;OAGF,OAAO,IAAI;;;GACX;CAAA;CACD;GAAA;GAAA,OAnCsB;CAAC;;;;;;;;ACJxB,KAAaC,QAAQ;GAAA;KAAA;;GAAA;KAAA;KAAA,uCAmBGC,MAAM,EAC7B;OACC,IAAI,CAACC,mBAAmB,GAAGD,MAAM;OACjC,IAAI,CAACE,KAAK,GAAGF,MAAM,GAAGA,MAAM,CAACE,KAAK,GAAG,IAAI;;;KACzC;KAAA,yCAGD;OACC,OAAO,IAAI,CAACD,mBAAmB;;;KAC/B;KAAA,yCAEwBD,MAAM,EAC/B;OACC,IAAI,CAACG,qBAAqB,GAAGH,MAAM;;;KACnC;KAAA,2CAGD;OACC,OAAO,IAAI,CAACG,qBAAqB;;;KACjC;KAAA,8BA5BD;OACC,IAAI,mCAACJ,QAAQ,EAXFA,QAAQ,YAWI,EACvB;SACCK,kCAAAL,QAAQ,EAbEA,QAAQ,aAaG,IAAIA,QAAQ,EAAE;;OAGpC,yCAAOA,QAAQ,EAhBJA,QAAQ;;;GAiBnB;CAAA;CAsBD;GAAA;GAAA;CAAA;;;;;;;;ACvCD,CAOyD;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEzD,KAAaM,cAAc;GAAA;GAU1B,wBAAYC,qBAAkC,EAC9C;KAAA;KAAA;KACC;KAAQC;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAhN;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KACR,MAAK6B,iBAAiB,CAAC,uBAAuB,CAAC;KAE/C,qGAA8BkL,qBAAqB;KAAC;;GACpD;KAAA;KAAA,qBAEIvK,IAA0B,EAAE0B,QAAkB,EACnD;OACC,IAAI,CAAC3E,cAAI,CAACuC,aAAa,CAACU,IAAI,CAAC,EAC7B;SACCA,IAAI,GAAG,EAAE;;OAGV,sCAAI,eAAa0B,QAAQ,CAAC+I,MAAM,EAAE,GAAGvJ,QAAQ,CAACU,IAAI,EAAE,GAAGF,QAAQ;OAC/D,sCAAI,iBAAiB3E,cAAI,CAACU,OAAO,CAACuC,IAAI,CAAC0K,QAAQ,CAAC,GAAG1K,IAAI,CAAC0K,QAAQ,GAAG,EAAE;OACrE,sCAAI,gBAAgBpK,QAAQ,CAACqK,gBAAgB,CAAC,8BAA8B,CAAC;OAC7E,sCAAI,cAAc,sCAAI,0BAAwBA,gBAAgB,CAAC,4BAA4B,CAAC;OAC5F,sCAAI,aAAa,KAAK;OACtB,IAAI,CAACC,YAAY,EAAE;OAEnB,IAAI,CAACC,YAAY,CAAC,KAAK,CAAC;;;OAGxB,sCAAI,gBAAcnN,OAAO,CAAC,UAAAoN,UAAU;SAAA,OAAIjE,IAAI,CAACE,YAAY,CAAC+D,UAAU,EAAE,EAAE,CAAC;SAAC;OAE1E9C,GAAG,CAAC5B,EAAE,CAAC2E,cAAc,CACpB/C,GAAG,EACH,mCAAmC,EACnC,IAAI,CAACgD,gBAAgB,CAAClH,IAAI,CAAC,IAAI,CAAC,CAChC;;;KACD;KAAA,uBAEM9D,IAA0B,EAAE0B,QAAmB,EACtD;OACC,IAAI,CAAC3E,cAAI,CAACuC,aAAa,CAACU,IAAI,CAAC,EAC7B;SACCA,IAAI,GAAG,EAAE;;OAGV,sCAAI,eAAa0B,QAAQ,IAAIR,QAAQ,CAACI,IAAI,EAAE;OAC5C,sCAAI,cAAY5D,OAAO,CAAC,UAAAoE,IAAI;SAAA,OAAIwB,aAAG,CAAC2H,KAAK,CAACnJ,IAAI,CAAC;SAAC;OAEhD,sCAAI,iBAAiB/E,cAAI,CAACU,OAAO,CAACuC,IAAI,CAAC0K,QAAQ,CAAC,GAAG1K,IAAI,CAAC0K,QAAQ,GAAG,EAAE;OAErE,IAAI,CAACE,YAAY,EAAE;OAEnB,IAAI,CAACC,YAAY,CAAC,KAAK,CAAC;;;KACxB;KAAA,+BAGD;OAAA;OACC,sCAAI,aAAa,EAAE;OACnB,sCAAI,iBAAenN,OAAO,CAAC,UAAC2L,WAAW,EAAK;SAC3C,IAAM1I,OAAO,GAAG,IAAIY,OAAO,EAAE;SAC7BZ,OAAO,CAACgF,IAAI,CAAC0D,WAAW,oCAAE,MAAI,eAAW;SACzC,MAAI,CAAC6B,sBAAsB,CAACvK,OAAO,CAAC;SACpC,MAAI,CAACwK,iBAAiB,CAACxK,OAAO,CAAC2B,WAAW,EAAE,EAAE3B,OAAO,CAACmB,IAAI,CAAC;SAC3D,wCAAI,aAAWjE,IAAI,CAAC8C,OAAO,CAAC;QAC5B,CAAC;;;KACF;KAAA,uCAEsBA,OAAgB,EACvC;OAAA;OACCA,OAAO,CAACb,SAAS,CAAC,gBAAgB,EAAE,UAACC,KAAK,EAAK;SAC9C,IAAMY,OAAO,GAAGZ,KAAK,CAACC,IAAI,CAACW,OAAO;SAElC,wCAAI,aAAW9C,IAAI,CAAC8C,OAAO,CAAC;SAC5B,IAAI,CAACZ,KAAK,CAACC,IAAI,CAACgJ,UAAU,EAC1B;WACC,MAAI,CAACmC,iBAAiB,CAACxK,OAAO,CAAC2B,WAAW,EAAE,EAAE3B,OAAO,CAACmB,IAAI,CAAC;;SAE5D,MAAI,CAACoJ,sBAAsB,CAACvK,OAAO,CAAC;SACpC,MAAI,CAACkK,YAAY,EAAE;QACnB,CAAC;OACFlK,OAAO,CAACb,SAAS,CAAC,kBAAkB,EAAE;SAAA,OAAM,MAAI,CAAC+K,YAAY,EAAE;SAAC;OAChElK,OAAO,CAACb,SAAS,CAAC,wBAAwB,EAAE,UAACC,KAAK,EAAK;SACtD,MAAI,CAACqL,yBAAyB,CAACrL,KAAK,CAACC,IAAI,CAACW,OAAO,CAAC;QAClD,CAAC;OACFA,OAAO,CAACb,SAAS,CAAC,iBAAiB,EAAE,UAACC,KAAK;SAAA,OAAK,MAAI,CAACsL,aAAa,CAACtL,KAAK,CAACC,IAAI,CAACW,OAAO,CAAC;SAAC;;;KAEvF;KAAA,yBAEQZ,KAAK,EACd;OACC,sCAAI,aAAWrC,OAAO,CAAC,UAAAiD,OAAO;SAAA,OAAIA,OAAO,CAAC2K,QAAQ,CAACvL,KAAK,CAAC;SAAC;;;KAC1D;KAAA,mCAGD;OACC,sCAAI,eAAamB,QAAQ,CAACqK,MAAM,EAAE;OAClC,IAAMC,aAAa,GAAGlL,QAAQ,CAACqK,gBAAgB,CAAC,kCAAkC,CAAC;OACnFa,aAAa,CAAC9N,OAAO,CAAC,UAAAoE,IAAI;SAAA,OAAIwB,aAAG,CAACmI,IAAI,CAAC3J,IAAI,CAAC;SAAC;OAE7C,sCAAI,aAAWpE,OAAO,CAAC,UAAAiD,OAAO;SAAA,OAAI2C,aAAG,CAACoI,QAAQ,CAAC/K,OAAO,CAACmB,IAAI,EAAE,eAAe,CAAC;SAAC;;;KAC9E;KAAA,oCAGD;OACC,sCAAI,eAAaZ,QAAQ,CAACU,IAAI,EAAE;OAChC,IAAM4J,aAAa,GAAGlL,QAAQ,CAACqK,gBAAgB,CAAC,kCAAkC,CAAC;OACnFa,aAAa,CAAC9N,OAAO,CAAC,UAAAoE,IAAI;SAAA,OAAIwB,aAAG,CAACqI,IAAI,CAAC7J,IAAI,CAAC;SAAC;OAE7C,sCAAI,aAAWpE,OAAO,CAAC,UAAAiD,OAAO;SAAA,OAAI2C,aAAG,CAACsI,WAAW,CAACjL,OAAO,CAACmB,IAAI,EAAE,eAAe,CAAC;SAAC;;;KACjF;KAAA,2BAEUuH,WAAiC,EAAEwC,QAAQ,EACtD;OACC,IAAMlL,OAAO,GAAG,IAAIY,OAAO,EAAE;OAC7BZ,OAAO,CAACa,KAAK,GAAG,IAAI;OACpBb,OAAO,CAACgF,IAAI,CAAC0D,WAAW,oCAAE,IAAI,eAAW;OACzC,IAAI,CAAC6B,sBAAsB,CAACvK,OAAO,CAAC;OACpC,IAAIkL,QAAQ,EACZ;SACCA,QAAQ,CAACC,IAAI,CAAC,IAAI,EAAEnL,OAAO,CAAC;;OAE7B,IAAI,CAAChB,IAAI,CAAC,4BAA4B,EAAE;SAACgB,OAAO,EAAPA;QAAQ,CAAC;;;KAClD;KAAA,8BAEaA,OAAgB,EAAEkL,QAAQ,EACxC;OACC,IAAIlL,OAAO,CAACmC,KAAK,EAAE,GAAG,CAAC,EACvB;SACCnC,OAAO,CAACoL,WAAW,EAAE;QACrB,MAED;SACC,KAAI,IAAInC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,sCAAI,aAAWR,MAAM,EAAE,EAAEQ,CAAC,EAC7C;WACC,IAAI,sCAAI,aAAWA,CAAC,CAAC,KAAKjJ,OAAO,EACjC;aACC,sCAAI,aAAWqL,MAAM,CAACpC,CAAC,EAAE,CAAC,CAAC;;;;OAK9B,IAAIiC,QAAQ,EACZ;SACCA,QAAQ,CAAClL,OAAO,CAAC;;OAGlB,IAAI,CAAChB,IAAI,CAAC,+BAA+B,EAAE;SAAEgB,OAAO,EAAPA;QAAS,CAAC;OAEvD,IAAI,CAACkK,YAAY,EAAE;;;KACnB;KAAA,oCAGD;OACC,sCAAI,aAAWnN,OAAO,CAAC,UAAAiD,OAAO;SAAA,OAAIA,OAAO,CAAC8D,YAAY,CAAC9D,OAAO,CAACmB,IAAI,CAAC;SAAC;OACrE,sCAAI,0BAAwB6I,gBAAgB,CAAC,0CAA0C,CAAC,CAACjN,OAAO,CAAC,UAACoE,IAAI,EAAK;SAC1GwB,aAAG,CAACoI,QAAQ,CAAC5J,IAAI,EAAE,mDAAmD,CAAC;QACvE,CAAC;;;KACF;KAAA,qCAGD;OACC,sCAAI,aAAWpE,OAAO,CAAC,UAAAiD,OAAO;SAAA,OAAIA,OAAO,CAACsL,cAAc,CAACtL,OAAO,CAACmB,IAAI,CAAC;SAAC;OACvE,sCAAI,0BAAwB6I,gBAAgB,CAAC,0CAA0C,CAAC,CAACjN,OAAO,CAAC,UAACoE,IAAI,EAAK;SAC1GwB,aAAG,CAACsI,WAAW,CAAC9J,IAAI,EAAE,mDAAmD,CAAC;QAC1E,CAAC;;;KACF;KAAA,8BAEanB,OAAO,EACrB;OACC,sCAAI,aAAW9C,IAAI,CAAC8C,OAAO,CAAC;OAC5B,IAAI,CAACkK,YAAY,CAAC,IAAI,CAAC;;;KACvB;KAAA,kCAEiBqB,cAAsB,EAAEC,WAAW,EACrD;OACC,IAAMC,QAAQ,GAAG,sCAAI,0BAAwB/D,aAAa,CAAC,6CAA6C,GAAC6D,cAAc,GAAC,IAAI,CAAC;OAC7H,IAAIE,QAAQ,EACZ;SACC9I,aAAG,CAAC+I,MAAM,CAACF,WAAW,EAAEC,QAAQ,CAAC;;;;KAElC;KAAA,4BAGD;OACC,OAAO,sCAAI,aAAWnN,GAAG,CAAC,UAAA0B,OAAO;SAAA,OAAIA,OAAO,CAACyE,SAAS,EAAE;SAAC;;;KACzD;KAAA,mCAGD;OACC,OAAO,sCAAI,aAAWG,MAAM,CAAC,UAAA5E,OAAO;SAAA,OAAI,CAACA,OAAO,CAAC2L,OAAO;SAAC,CAAClD,MAAM;;;KAChE;KAAA,+BAEc5I,IAAY,EAC3B;OAAA;OACC,0DAAOyB,mCAAgB,EAAE,CAACxB,iBAAiB,CAACC,IAAI,CAAC,UAACC,OAAO;SAAA,OAAKH,IAAI,KAAKG,OAAO,CAAC,MAAM,CAAC;SAAC,2DAAhF,uBAAkF8B,IAAI,yEAAIjC,IAAI;;;KACrG;KAAA,oCAEmBA,IAAI,EACxB;OACC,IAAMC,iBAAiB,GAAGwB,mCAAgB,EAAE,CAACxB,iBAAiB;OAC9D,KAAK,IAAImJ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGnJ,iBAAiB,CAAC2I,MAAM,EAAE,EAAEQ,CAAC,EACjD;SACC,IAAIpJ,IAAI,KAAKC,iBAAiB,CAACmJ,CAAC,CAAC,CAAC,MAAM,CAAC,EACzC;WACC,OAAOnJ,iBAAiB,CAACmJ,CAAC,CAAC;;;OAI7B,OAAO,IAAI;;;KACX;KAAA,0BAGD;OACC,OAAO3H,mCAAgB,EAAE,CAACjB,OAAO;;;KACjC;KAAA,kCAGD;OAAA;OACC,gCAAOiB,mCAAgB,EAAE,CAACrB,GAAG,CAAC,4BAA4B,CAAC,yEAAI,KAAK;;;KACpE;KAAA,2BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,6BAEY2L,QAAiB,EAC9B;OACC,sCAAI,aAAaA,QAAQ,KAAK,KAAK;OACnC,sCAAI,IAAI,cACR;SACC,IAAI,CAAC5M,IAAI,CAAC,6BAA6B,CAAC;;;;KAEzC;KAAA,0CAEyBgB,OAAO,EAAE6L,OAAO,EAC1C;OAAA;OACC,IAAIxC,QAAQ,CAACyC,WAAW,EAAE,CAACC,wBAAwB,EAAE,EACrD;SACC,IAAIF,OAAO,IAAIA,OAAO,CAACG,aAAa,EACpC;WACC3C,QAAQ,CAACyC,WAAW,EAAE,CAACC,wBAAwB,EAAE,CAACE,KAAK,CAACC,KAAK,EAAE;UAC/D,MAED;WACC;;;OAIF,IAAMC,QAAQ,GAAG,mCAAmC;OACpD,IAAMC,IAAI,GAAGzJ,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAC/BpD,KAAK,EAAE;WACNX,IAAI,EAAEsN;UACN;SACDtF,KAAK,EAAE;WAAC,WAAW,EAAE;;QACrB,CAAC;OAEFlE,aAAG,CAAC+I,MAAM,CAAC,IAAI,CAACW,uBAAuB,CAACrM,OAAO,CAAC,EAAEoM,IAAI,CAAC;OAEvD,IAAME,QAAQ,GAAG3J,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAClCC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAiC;SACrDyJ,MAAM,EAAE;WAACC,KAAK,EAAE,eAACpN,KAAK;aAAA,OAAK,MAAI,CAACJ,IAAI,CAAC,4BAA4B,EAAEI,KAAK,CAAC;;;QACzE,CAAC;OACFuD,aAAG,CAAC+I,MAAM,CAACY,QAAQ,EAAEF,IAAI,CAAC;OAE1B,IAAMvI,KAAK,GAAG,IAAI,CAAC4I,cAAc,CAACzM,OAAO,CAAC6B,OAAO,EAAE,CAAC;OAEpDc,aAAG,CAAC+I,MAAM,CAAC/I,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAC7BC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAgG;SACpHC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC,GAAG;QAC9D,CAAC,EAAEmJ,IAAI,CAAC;OAETzJ,aAAG,CAAC+I,MAAM,CAAC/I,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAC5BC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAqC;SACzDc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;WACnBC,KAAK,EAAE;aACNC,SAAS,EAAE,gCAAgC;aAC3C0E,IAAI,EAAE,MAAM;aACZ3I,IAAI,EAAE,MAAM;aACZC,KAAK,EAAEkB,OAAO,CAACyD,OAAO,EAAE,IAAII;;UAE7B,CAAC;QAEH,CAAC,EAAEuI,IAAI,CAAC;OAET,IAAM1D,WAAW,GAAG,IAAI,CAACgE,mBAAmB,CAAC1M,OAAO,CAAC6B,OAAO,EAAE,CAAC;OAE/D,IAAI6G,WAAW,IAAIA,WAAW,CAAC,UAAU,CAAC,EAC1C;SACCiE,6BAAI,4DAAJ,IAAI,EAA0B3M,OAAO,EAAE0I,WAAW,CAAC,UAAU,CAAC,CAAC,YAAY,CAAC,EAAE0D,IAAI;;OAGnF3G,EAAE,CAACmH,aAAa,CACf,4DAA4D,GAAG5M,OAAO,CAAC6B,OAAO,EAAE,EAChF,CAAC7B,OAAO,EAAEoM,IAAI,CAAC,CACf;OAED,IAAI,IAAI,CAACS,eAAe,EAAE,EAC1B;SACC,IAAI,CAACC,sBAAsB,CAAC9M,OAAO,EAAEoM,IAAI,CAAC;;OAG3C,IAAI,CAACW,2BAA2B,CAAC/M,OAAO,EAAEoM,IAAI,CAAC;OAE/CzJ,aAAG,CAACoI,QAAQ,mCAAC,IAAI,2BAAyB,yBAAyB,CAAC;OAEpE1B,QAAQ,CAACyC,WAAW,EAAE,CAACkB,wBAAwB,CAAC;SAC/CC,cAAc,EAAE,IAAI;SACpBjN,OAAO,EAAEA,OAAO;SAChBoM,IAAI,EAAEA;QACN,CAAC;OAEF,IAAMc,IAAI,GAAG,IAAI;OACjB,IAAMjB,KAAK,GAAG,IAAIxG,EAAE,CAAC0H,WAAW,CAACrE,MAAM,CAACsE,gBAAgB,EAAE,EAAE,IAAI,EAAE;SACjEC,QAAQ,EAAExJ,KAAK;SACfyJ,OAAO,EAAElB,IAAI;SACbmB,SAAS,EAAE,IAAI;SACfC,UAAU,EAAE,CAAC;SACbC,SAAS,EAAE,CAAC;SACZC,UAAU,EAAE,IAAI;SAChBC,SAAS,EAAE;WAACC,QAAQ,EAAE;UAAM;SAC5BC,OAAO,EAAE,KAAK;SACdtB,MAAM,EAAE;WACPuB,YAAY,EAAE,sBAAS7B,KAAK,EAC5B;aACC5C,QAAQ,CAACyC,WAAW,EAAE,CAACkB,wBAAwB,CAAC,IAAI,CAAC;aACrDE,IAAI,CAACa,6BAA6B,EAAE;aACpC9B,KAAK,CAAC+B,OAAO,EAAE;aACfrL,aAAG,CAACsI,WAAW,mCAACiC,IAAI,2BAAyB,yBAAyB,CAAC;aACvEA,IAAI,CAAClO,IAAI,CAAC,6CAA6C,CAAC;;UAEzD;SACDiP,OAAO,EAAE,CACR,IAAIxI,EAAE,CAACyI,iBAAiB,CAAC;WACxBnL,IAAI,EAAGC,aAAG,CAACC,UAAU,CAAC,qBAAqB,CAAC;WAC5CH,SAAS,EAAG,4BAA4B;WACxCyJ,MAAM,EAAG;aACRC,KAAK,EAAE,iBAAM;eACZ,IAAM2B,QAAQ,GAAG1I,EAAE,CAAC2I,IAAI,CAACC,WAAW,CAACjC,IAAI,CAAC;eAC1CpM,OAAO,CAACsO,OAAO,CAACH,QAAQ,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,CAAC;eAEzC,IAAIzF,WAAW,CAAC,UAAU,CAAC,EAC3B;iBACCiE,+BAAI,sDAAJ,MAAI,EAAuB3M,OAAO,EAAE0I,WAAW,CAAC,UAAU,CAAC,CAAC,YAAY,CAAC,EAAE0D,IAAI;;eAGhF3G,EAAE,CAACmH,aAAa,CACf,sDAAsD,GAAC5M,OAAO,CAAC6B,OAAO,EAAE,EACxE,CAAC7B,OAAO,EAAEmO,QAAQ,CAAC,CACnB;eAEDjB,IAAI,CAACqB,4BAA4B,CAACJ,QAAQ,CAAC,MAAM,CAAC,EAAEnO,OAAO,CAAC;eAC5DA,OAAO,CAACwO,iBAAiB,CAACL,QAAQ,CAAC,MAAM,CAAC,CAAC,iBAAiB,CAAC,KAAK,GAAG,CAAC;eAEtE,IAAIjB,IAAI,CAACL,eAAe,EAAE,EAC1B;iBACC7M,OAAO,CAACyO,YAAY,CAACN,QAAQ,CAAC,MAAM,CAAC,CAAC,YAAY,CAAC,CAAC;;eAGrD,IAAInO,OAAO,CAACa,KAAK,EACjB;;;eAQAuN,cAAI,CAACM,SAAS,CACb,wBAAwB,EACxB;iBACCC,cAAc,8BAAuB3O,OAAO,CAACa,KAAK,GAAG,QAAQ,GAAG,EAAE,mBAASb,OAAO,CAAC6B,OAAO,EAAE,CAACwD,WAAW,EAAE;gBAC1G,CACD;eAED,OAAOrF,OAAO,CAACa,KAAK;eAEpBb,OAAO,CAAC4O,MAAM,EAAE;eAChB1B,IAAI,CAAChD,YAAY,EAAE;eACnB+B,KAAK,CAACC,KAAK,EAAE;;;UAGf,CAAC,EACF,IAAIzG,EAAE,CAACoJ,qBAAqB,CAAC;WAC5B9L,IAAI,EAAGC,aAAG,CAACC,UAAU,CAAC,uBAAuB,CAAC;WAC9CH,SAAS,EAAG,iCAAiC;WAC7CyJ,MAAM,EAAG;aACRC,KAAK,mBACL;eACC,IAAI,CAACsC,WAAW,CAAC5C,KAAK,EAAE;;;UAG1B,CAAC;QAEH,CAAC;OAEF7C,QAAQ,CAACyC,WAAW,EAAE,CAACC,wBAAwB,EAAE,CAACE,KAAK,GAAGA,KAAK;OAC/DA,KAAK,CAACjB,IAAI,EAAE;;;OAGZoD,cAAI,CAACM,SAAS,CACb,wBAAwB,EACxB;SACCC,cAAc,8BAAuB3O,OAAO,CAACa,KAAK,GAAG,QAAQ,GAAG,EAAE,uBAAab,OAAO,CAAC6B,OAAO,EAAE,CAACwD,WAAW,EAAE;QAC9G,CACD;;;KACD;KAAA,wCAiHuBrF,OAAgB,EACxC;OACC,IAAM+O,cAAc,GAAG/O,OAAO,CAACgP,YAAY,EAAE,CAACpQ,KAAK,EAAE;OAErD,IAAI,CAACqQ,iBAAiB,GAAG,IAAIC,yCAAsB,CAClDH,cAAc,EACd;SACC5F,MAAM,EAAE7H,mCAAgB,EAAE,CAAC3B,QAAQ,CAACwP,SAAS,EAAE;SAC/CC,kBAAkB,EAAE;QACpB,CACD;OACD,IAAMC,QAAQ,GAAG,IAAI,CAACJ,iBAAiB;OAEvC,OAAOtM,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACxBC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAqC;SACzDc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAAEC,SAAS,EAAE;YAA2C;WAC/Dc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;aAClBC,KAAK,EAAE;eAAEC,SAAS,EAAE;cAA2C;aAC/DC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC,GAAG;YAC7D,CAAC,EACFoM,QAAQ,CAACnO,UAAU,EAAE;UAEtB,CAAC;QAEH,CAAC;;;KACF;KAAA,uCAqUsBlB,OAAO,EAAEoM,IAAI,EACpC;OACCzJ,aAAG,CAAC+I,MAAM,CAAC/I,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAC7BC,KAAK,EAAE;WACNC,SAAS,EAAE;UACX;SACDC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC,GAAG;QACpE,CAAC,EAAEmJ,IAAI,CAAC;OAETzJ,aAAG,CAAC+I,MAAM,CAAC/I,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAC5BC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAqC;SACzDc,QAAQ,EAAE,CACT6B,EAAE,CAAC6J,OAAO,CAACC,SAAS,CAACC,aAAa,CACjClO,mCAAgB,EAAE,CAAC3B,QAAQ,CAAC8P,UAAU,EAAE,EACxC;WACCrT,IAAI,EAAE;UACN,EACD,YAAY,EACZ4D,OAAO,CAACa,KAAK,GACViI,MAAM,CAAC4G,4BAA4B,CAACpO,mCAAgB,EAAE,CAAC3B,QAAQ,CAACwP,SAAS,EAAE,CAAC,GAC5EnP,OAAO,CAAC2P,YAAY,EAAE,CACzB;QAEF,CAAC,EAAEvD,IAAI,CAAC;;;KACT;KAAA,4CAE2BpM,OAAO,EAAEoM,IAAI,EACzC;OACCzJ,aAAG,CAAC+I,MAAM,CAAC/I,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAC5BC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAqC;SACzDc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAAEC,SAAS,EAAE;YAA0C;WAC9Dc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;aACnBC,KAAK,EAAE;eAAEC,SAAS,EAAE;cAAsC;aAC1Dc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;eACnBC,KAAK,EAAE;iBACNC,SAAS,EAAE,8BAA8B;iBACzC0E,IAAI,EAAE,UAAU;iBAChB3I,IAAI,EAAE,iBAAiB;iBACvBC,KAAK,EAAE;gBACP;eACDU,KAAK,EAAE;iBACNoQ,OAAO,EAAE5P,OAAO,CAAC6P,kBAAkB;;cAEpC,CAAC,EACFlQ,QAAQ,CAACmQ,cAAc,CAAC9M,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC,CAAC;YAExF,CAAC;UAEH,CAAC;QAEH,CAAC,EAAEmJ,IAAI,CAAC;;;KACT;KAAA,6CAE4B2D,UAAkB,EAAG/P,OAAgB,EAClE;OACCA,OAAO,CAACgQ,YAAY,CAAClP,iCAAc,CAACmP,cAAc,CAACF,UAAU,CAAC,CAAC;OAE/D,OAAO,IAAI;;;KACX;KAAA,iCAEgBG,SAAS,EAAEC,WAAW,EACvC;OACCA,WAAW,CAACC,QAAQ,GAAG,KAAK;OAG5BC,UAAU,CAAC,YACX;SACC5K,EAAE,CAAC2I,IAAI,CAAC;WACPkC,MAAM,EAAE,MAAM;WACdC,QAAQ,EAAE,MAAM;WAChBC,GAAG,EAAElP,mCAAgB,EAAE,CAACmP,OAAO;WAC/BpR,IAAI,EAAE;aACLqR,WAAW,EAAE,wBAAwB;aACrCC,eAAe,EAAErP,mCAAgB,EAAE,CAACsP;YACpC;WACDC,SAAS,qBAACC,QAAQ,EAClB;aACC,IAAI1U,cAAI,CAACU,OAAO,CAACgU,QAAQ,CAAC,MAAM,CAAC,CAAC,EAClC;eACCxP,mCAAgB,EAAE,CAACjE,GAAG,CAAC,mBAAmB,EAAEyT,QAAQ,CAAC,MAAM,CAAC,CAAC;;;UAG/D,CAAC;QACF,EAAE,IAAI,CAAC;;;KACR;KAAA,2CAE0B3P,IAAI,EAC/B;OACC,IAAI,CAAC/E,cAAI,CAACU,OAAO,CAAC,IAAI,CAACiU,sBAAsB,CAAC,EAC9C;SACC,IAAI,CAACA,sBAAsB,GAAG,EAAE;;OAGjC,IAAMC,YAAY,GAAG7P,IAAI,CAAC6I,gBAAgB,CAAC,aAAa,CAAC;OACzD,KAAK,IAAIf,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG+H,YAAY,CAACvI,MAAM,EAAE,EAAEQ,CAAC,EAC5C;SACC,IAAIgI,OAAO,GAAG,IAAI;SAClB,IAAMC,IAAI,GAAGF,YAAY,CAAC/H,CAAC,CAAC,CAACxB,YAAY,CAAC,WAAW,CAAC;SAEtD,IAAIyJ,IAAI,KAAK,eAAe,EAC5B;WACCD,OAAO,GAAGxL,EAAE,CAAC6J,OAAO,CAAC6B,YAAY,CAACC,YAAY,CAACJ,YAAY,CAAC/H,CAAC,CAAC,CAAC;;SAGhExD,EAAE,CAAC4L,EAAE,CAACC,IAAI,CAACtM,IAAI,CAACgM,YAAY,CAAC/H,CAAC,CAAC,CAAC;SAEhC,IAAIgI,OAAO,EACX;WACC,IAAI,CAACF,sBAAsB,CAAC7T,IAAI,CAAC+T,OAAO,CAAC;;;;;KAG3C;KAAA,gDAGD;OACC,IAAI,IAAI,CAAChC,iBAAiB,EAC1B;SACC,IAAI,CAACA,iBAAiB,CAACjB,OAAO,EAAE;SAChC,IAAI,CAACiB,iBAAiB,GAAG,IAAI;;OAG9B,IAAI7S,cAAI,CAACU,OAAO,CAAC,IAAI,CAACiU,sBAAsB,CAAC,EAC7C;SACC,KAAK,IAAI9H,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAAC8H,sBAAsB,CAACtI,MAAM,EAAE,EAAEQ,CAAC,EAC3D;WACC,IAAI7M,cAAI,CAACmV,UAAU,CAAC,IAAI,CAACR,sBAAsB,CAAC9H,CAAC,CAAC,CAAC+E,OAAO,CAAC,EAC3D;aACC,IAAI,CAAC+C,sBAAsB,CAAC9H,CAAC,CAAC,CAAC+E,OAAO,EAAE;;;;OAI3C,IAAI,CAAC+C,sBAAsB,GAAG,IAAI;;;KAClC;KAAA,wCAEuB9I,QAAQ,EAChC;OACC,IAAMuJ,MAAM,GAAG,EAAE;OACjB,sCAAI,aAAWzU,OAAO,CAAC,UAACiD,OAAO,EAAK;SACnC,IAAIA,OAAO,CAAC2B,WAAW,EAAE,KAAKsG,QAAQ,EACtC;WACCuJ,MAAM,CAACtU,IAAI,CAAC8C,OAAO,CAAC;;QAErB,CAAC;OAEF,OAAOwR,MAAM;;;KACb;KAAA,oCAEmBvJ,QAAQ,EAC5B;OACC,IAAMuJ,MAAM,GAAG,EAAE;OACjB,IAAMC,MAAM,GAAG,EAAE;OACjB,IAAMC,QAAQ,GAAG,IAAI,CAACC,uBAAuB,CAAC1J,QAAQ,CAAC;OAEvDyJ,QAAQ,CAAC3U,OAAO,CAAC,UAACiD,OAAO,EAAK;SAC7B,IAAMR,KAAK,GAAGQ,OAAO,CAAC2L,OAAO,GAAG,EAAE,GAAG3L,OAAO,CAAC4R,mBAAmB,EAAE;SAClE,IAAIpS,KAAK,CAACiJ,MAAM,EAChB;WACCjJ,KAAK,CAACzC,OAAO,CAAC,UAAC8H,QAAQ,EAAK;aAC3B,IAAI,CAAC4M,MAAM,CAAC5M,QAAQ,CAACtI,EAAE,CAAC,EACxB;eACCiV,MAAM,CAACtU,IAAI,CAAC;iBACXX,EAAE,EAAEsI,QAAQ,CAACtI,EAAE;iBACfsV,QAAQ,EAAE,UAAU;iBACpBC,IAAI,EAAEjN,QAAQ,CAACiN,IAAI;iBACnBC,UAAU,EAAE/R,OAAO,CAACyD,OAAO,EAAE;iBAC7BrH,IAAI,EAAEyI,QAAQ,CAACzI,IAAI;iBACnB4V,UAAU,EAAE,OAAO,GAACnN,QAAQ,CAACtI,EAAE,GAAC,IAAI;iBACpC0V,gBAAgB,EAAE,aAAa,GAACpN,QAAQ,CAACtI,EAAE,GAAC;gBAC5C,CAAC;eACFkV,MAAM,CAAC5M,QAAQ,CAACtI,EAAE,CAAC,GAAG,IAAI;;YAE3B,CAAC;;QAEH,CAAC;OAEF,OAAOiV,MAAM;;;KACb;KAAA,kCAEiBvJ,QAAQ,EAAEiK,UAAU,EACtC;OACC,IAAMC,UAAU,GAAG,IAAI,CAACP,mBAAmB,CAAC3J,QAAQ,CAAC;OACrD,KAAK,IAAIgB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGkJ,UAAU,CAAC1J,MAAM,EAAE,EAAEQ,CAAC,EAC1C;SACC,IAAIkJ,UAAU,CAAClJ,CAAC,CAAC,CAAC1M,EAAE,KAAK2V,UAAU,EACnC;WACC,OAAOC,UAAU,CAAClJ,CAAC,CAAC;;;OAItB,OAAO,IAAI;;;GACX;CAAA,EAjjCkC3J,6BAAY;CAkjC/C,mCAnpByBU,OAAgB,EAAEmS,UAAc,EAAE/F,IAAa,EACxE;GAAA;GACC+F,UAAU,CAACpV,OAAO,CAAC,UAAC8H,QAAQ,EAAK;KAEhC,IAAM/F,KAAK,GAAGkB,OAAO,CAACoS,aAAa,EAAE,CAACvN,QAAQ,CAACtI,EAAE,CAAC;KAElD,IAAIsI,QAAQ,CAACzI,IAAI,KAAK,2BAA2B,EACjD;OACCuQ,+BAAI,sEAAJ,MAAI,EAA+B9H,QAAQ,EAAE/F,KAAK,EAAEsN,IAAI;OAExD;;KAGD,IAAIvH,QAAQ,CAACzI,IAAI,KAAK,eAAe,EACrC;OACCuQ,+BAAI,gEAAJ,MAAI,EAA4B9H,QAAQ,EAAE/F,KAAK,EAAEsN,IAAI;OAErD;;KAGD,IAAIvH,QAAQ,CAACzI,IAAI,KAAK,iBAAiB,EACvC;OACCuQ,+BAAI,oEAAJ,MAAI,EAA8B9H,QAAQ,EAAE/F,KAAK,EAAEsN,IAAI;OAEvD;;KAGD,IAAMiG,gBAAgB;OAAIC,cAAc,EAAE;QAAUzN,QAAQ,CAAC;KAE7D,IAAIwN,gBAAgB,CAACjW,IAAI,KAAK,eAAe,EAC7C;OACCuQ,+BAAI,kEAAJ,MAAI,EAA6B0F,gBAAgB;;KAGlD1P,aAAG,CAAC+I,MAAM,CAAC/I,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;OAC7BC,KAAK,EAAE;SACNC,SAAS,EAAE;QACX;OACDC,IAAI,EAAE8B,QAAQ,CAACiN,IAAI,GAAG;MACtB,CAAC,EAAE1F,IAAI,CAAC;KAETzJ,aAAG,CAAC+I,MAAM,CAAC/I,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;OAC5BC,KAAK,EAAE;SAAEC,SAAS,EAAE;QAAqC;OACzDc,QAAQ,EAAE,CACT6B,EAAE,CAAC6J,OAAO,CAACC,SAAS,CAACC,aAAa,0CAE7BlO,mCAAgB,EAAE,CAAC3B,QAAQ,CAAC8P,UAAU,EAAE,IAC3CnO,mCAAgB,EAAE,CAAC3B,QAAQ,CAAC4S,aAAa,EAAE,IAE5CF,gBAAgB,EAChBxN,QAAQ,CAACtI,EAAE,EACXuC,KAAK,IAAI,EAAE,CACX;MAEF,CAAC,EAAEsN,IAAI,CAAC;IACT,CAAC;CACH;CAAC,sCAE2BvH,QAAQ,EACpC;GACC,IAAM2N,GAAG,GAAGnJ,QAAQ,CAACyC,WAAW,EAAE,CAAC2G,SAAS;GAC5C5N,QAAQ,CAAC6N,OAAO,GAAG,EAAE;GACrB,IAAM9N,MAAM,GAAGC,QAAQ,CAAC8N,QAAQ,CAACC,MAAM;GACvC,IAAMC,KAAK,GAAG,SAARA,KAAK,CAAIrJ,KAAK,EACpB;KACC,KAAK,IAAMJ,KAAK,IAAIxE,MAAM,EAC1B;OACC,IAAI4E,KAAK,CAACnK,IAAI,CAAC+J,KAAK,CAAC,KAAKxE,MAAM,CAACwE,KAAK,CAAC,EACvC;SACC,OAAO,KAAK;;;KAId,OAAO,IAAI;IACX;GAEDoJ,GAAG,CAACM,eAAe,CAACC,SAAS,CAAChW,OAAO,CAAC,UAACiW,QAAQ,EAAK;KACnDA,QAAQ,CAACC,MAAM,CAAClW,OAAO,CAAC,UAACyM,KAAK,EAAK;OAClC,IAAIqJ,KAAK,CAACrJ,KAAK,CAAC,EAChB;SACC3E,QAAQ,CAAC6N,OAAO,CAACxV,IAAI,CACpB;WAAC4B,KAAK,EAAE0K,KAAK,CAACrH,KAAK,EAAE;WAAEtD,IAAI,EAAE2K,KAAK,CAAC0J,WAAW,CAACrO,QAAQ,CAAC8N,QAAQ,CAACQ,kBAAkB;UAAE,CACrF;;MAEF,CAAC;IACF,CAAC;GAEF,OAAOtO,QAAQ,CAAC8N,QAAQ;GACxB9N,QAAQ,CAACzI,IAAI,GAAG,QAAQ;CACzB;CAAC,gCAEqB4D,OAAgB,EAAEmS,UAAc,EAAE/F,IAAa,EACrE;GAAA;GACC,IAAM3O,MAAM,GAAG,EAAE;GAEjB0U,UAAU,CAACpV,OAAO,CAAC,UAAC8H,QAAQ,EAAK;KAEhC,IAAIA,QAAQ,CAACzI,IAAI,KAAK,2BAA2B,EACjD;OACCqB,MAAM,CAACoH,QAAQ,CAACtI,EAAE,CAAC,4BAAG,MAAI,0DAAJ,MAAI,EAAyBsI,QAAQ,EAAEuH,IAAI,CAAC;OAElE;;KAGD,IAAM+B,QAAQ,GAAG1I,EAAE,CAAC2I,IAAI,CAACC,WAAW,CAACjC,IAAI,CAAC;KAC1C3O,MAAM,CAACoH,QAAQ,CAACtI,EAAE,CAAC,GAAG4R,QAAQ,CAAC9O,IAAI,CAACwF,QAAQ,CAACtI,EAAE,CAAC;IAChD,CAAC;GAEFyD,OAAO,CAACoT,aAAa,CAAC3V,MAAM,CAAC;CAC9B;CAAC,wCAgC6BoH,QAAQ,EAAE/F,KAAK,EAAEsN,IAAI,EACnD;GACC,IAAMiD,QAAQ,GAAG,IAAIH,yCAAsB,CAAC,IAAIpO,iCAAc,CAAChC,KAAK,CAAC,EAAE;KACtEqK,MAAM,EAAEtE,QAAQ,CAAC8N,QAAQ,CAACU,MAAM;KAChCC,WAAW,EAAEzO,QAAQ,CAACtI,EAAE;KACxB6S,kBAAkB,EAAE;IACpB,CAAC;GAEFzM,aAAG,CAAC+I,MAAM,CACT/I,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;KACjBC,KAAK,EAAE;OAAEC,SAAS,EAAE;MAAqC;KACzDc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;OACjBC,KAAK,EAAE;SAAEC,SAAS,EAAE;QAA2C;OAC/Dc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAClBC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAA2C;SAC/DC,IAAI,EAAE8B,QAAQ,CAACiN,IAAI,GAAG;QACtB,CAAC,EACFzC,QAAQ,CAACnO,UAAU,EAAE;MAEtB,CAAC;IAEH,CAAC,EACFkL,IAAI,CACJ;CACF;CAAC,kCAEuBvH,QAAQ,EAAEuH,IAAI,EACtC;GACC,IAAM+B,QAAQ,GAAG1I,EAAE,CAAC2I,IAAI,CAACC,WAAW,CAACjC,IAAI,CAAC;GAC1C,IAAM2C,cAAc,GAAGjO,iCAAc,CAACmP,cAAc,CACnD9B,QAAQ,CAAC,MAAM,CAAC,EAChBtJ,QAAQ,CAACtI,EAAE,CACX;GAED,OAAOwS,cAAc,CAACtK,SAAS,EAAE;CAClC;CAAC,qCAE0BI,QAAQ,EAAE/F,KAAK,EAAEsN,IAAI,EAChD;GACC,IAAI,CAACtN,KAAK,EACV;KACCA,KAAK,GAAGyU,cAAI,CAACC,SAAS,CAAC,CAAC,CAAC;;GAG1B7Q,aAAG,CAAC+I,MAAM,CAAC/I,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;KAC7BC,KAAK,EAAE;OAAEC,SAAS,EAAE;MAAgG;KACpHC,IAAI,EAAE8B,QAAQ,CAACiN,IAAI,GAAG;IACtB,CAAC,EAAE1F,IAAI,CAAC;GAETzJ,aAAG,CAAC+I,MAAM,CAAC/I,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;KAC9BpD,KAAK,EAAE;OACNgI,IAAI,EAAE,QAAQ;OACd1I,KAAK,EAAEA,KAAK;OACZD,IAAI,EAAE;;IAEP,CAAC,EAAEuN,IAAI,CAAC;GAET,IAAMqH,gBAAgB,GAAG9Q,aAAG,CAACC,MAAM,CAAC,UAAU,EAAE;KAC/CC,KAAK,EAAE;OACNC,SAAS,EAAE,mCAAmC;OAC9C4Q,WAAW,EAAE,KAAK;OAClBC,QAAQ,EAAE,UAAU;OACpB9U,IAAI,EAAE;MACN;KACD0N,MAAM,EAAE;OACPC,KAAK,mBACL;SACC,IAAI,CAACoH,MAAM,EAAE;;;IAGf,CAAC;GAEFjR,aAAG,CAAC+I,MAAM,CAAC/I,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;KAC5BC,KAAK,EAAE;OAAEC,SAAS,EAAE;MAAqC;KACzDc,QAAQ,EAAE,CAAC6P,gBAAgB;IAC3B,CAAC,EAAErH,IAAI,CAAC;GAETzJ,aAAG,CAAC+I,MAAM,CAAC/I,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;KAC7BC,KAAK,EAAE;OAAEC,SAAS,EAAE;MAAgG;KACpHC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,mCAAmC;IACxD,CAAC,EAAEmJ,IAAI,CAAC;GAET,IAAIvH,QAAQ,CAAC8N,QAAQ,CAACkB,OAAO,EAC7B;KACC,IAAIrD,GAAG,GAAG7I,MAAM,CAACmM,QAAQ,CAACC,QAAQ,GAAG,IAAI,GAAGpM,MAAM,CAACmM,QAAQ,CAACE,IAAI,GAAGnP,QAAQ,CAAC8N,QAAQ,CAACkB,OAAO;KAC5FrD,GAAG,GAAGyD,aAAG,CAACC,QAAQ,CAAC1D,GAAG,EAAE;OAAC3Q,IAAI,EAAEf;MAAM,CAAC;KACtC0R,GAAG,GAAGA,GAAG,CAAC2D,OAAO,CAAC,mBAAmB,EAAE7S,mCAAgB,EAAE,CAAC3B,QAAQ,CAAC8P,UAAU,EAAE,CAAC,CAAC,CAAC,CAAC;KACnFe,GAAG,GAAGA,GAAG,CAAC2D,OAAO,CAAC,aAAa,EAAEnR,aAAG,CAACC,UAAU,CAAC,SAAS,CAAC,CAAC;KAE3D,IAAI4B,QAAQ,CAAC8N,QAAQ,CAACyB,QAAQ,EAC9B;OACC5D,GAAG,GAAGA,GAAG,CAAC2D,OAAO,CAAC,cAAc,EAAEtP,QAAQ,CAAC8N,QAAQ,CAACyB,QAAQ,CAAC;;KAG9DX,gBAAgB,CAAC3U,KAAK,GAAG0R,GAAG;;GAG7B,IAAI,CAAC3L,QAAQ,CAAC8N,QAAQ,CAACyB,QAAQ,IAAIvP,QAAQ,CAAC8N,QAAQ,CAAC0B,cAAc,EACnE;KACC,IAAMC,WAAW,GAChBtR,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC,CACzDkR,OAAO,CACP,MAAM,EACN,mDAAmD,GACjD,sEAAsE,CACxE,CACAA,OAAO,CAAC,MAAM,EAAE,MAAM,CAAC;KAG1B,IAAMI,aAAa,GAAG,IAAIC,eAAK,CAAC;OAC/BC,KAAK,EAAEC,oBAAU,CAACC,OAAO;OACzBC,IAAI,EAAEC,mBAAS,CAACF,OAAO;OACvB5R,IAAI,EAAEuR;MACN,CAAC;KAEFpR,eAAK,CAACC,IAAI,CACToR,aAAa,CAACO,gBAAgB,EAAE,CAACpN,aAAa,CAAC,yBAAyB,CAAC,EACzE,OAAO,EACP,YACA;OACC,IAAMqN,YAAY,GAAGlQ,QAAQ,CAAC8N,QAAQ,CAAC0B,cAAc;OAErD5O,EAAE,CAAC2I,IAAI,CAAC4G,kBAAkB,CACzBD,YAAY,CAACtC,SAAS,EACtBsC,YAAY,CAACE,MAAM,EACnB;SACCzU,IAAI,EAAEuU,YAAY,CAACvU,IAAI,IAAI6F,SAAS;SACpChH,IAAI,EAAE;WACL3B,YAAY,2CACR4D,mCAAgB,EAAE,CAAC3B,QAAQ,CAAC8P,UAAU,EAAE,IAC3CnO,mCAAgB,EAAE,CAAC3B,QAAQ,CAAC4S,aAAa,EAAE;;QAG7C,CACD,CAAC2C,IAAI,CACL,UAASpE,QAAQ,EACjB;SACC,IAAIA,QAAQ,CAACzR,IAAI,CAAC8V,KAAK,EACvB;WACCxN,MAAM,CAACyN,KAAK,CAACtE,QAAQ,CAACzR,IAAI,CAAC8V,KAAK,CAAC;UACjC,MACI,IAAIrE,QAAQ,CAACzR,IAAI,CAACgW,QAAQ,EAC/B;WACCxQ,QAAQ,CAAC8N,QAAQ,CAACyB,QAAQ,GAAGtD,QAAQ,CAACzR,IAAI,CAACgW,QAAQ;WACnD5B,gBAAgB,CAAC3U,KAAK,GAAG2U,gBAAgB,CACvC3U,KAAK,CAACqV,OAAO,CAAC,cAAc,EAAEtP,QAAQ,CAAC8N,QAAQ,CAACyB,QAAQ,CAAC;WAE3DG,aAAa,CAACe,mBAAmB,EAAE;;QAEpC,CACD;MACD,CACD;KAED3S,aAAG,CAAC+I,MAAM,CAAC6I,aAAa,CAACgB,YAAY,EAAE,EAAEnJ,IAAI,CAAC;;CAEhD;CAAC,uCAE4BvH,QAAQ,EAAE/F,KAAK,EAAEsN,IAAI,EAClD;GACC,IAAMoJ,MAAM,GAAG,iBAAiB,GAAGC,IAAI,CAACC,MAAM,EAAE;GAChD,IAAMC,SAAS,GAAG9Q,QAAQ,CAACtI,EAAE,GAAG,IAAI;GAEpC,IAAMqZ,UAAU,GAAG/Q,QAAQ,CAAC8N,QAAQ,CAACU,MAAM;GAE3C,IAAMwC,mBAAmB,GAAG,SAAtBA,mBAAmB,CAAYzM,KAAK,EAAEqC,QAAQ,EACpD;KACC,IAAMgG,MAAM,GAAGhG,QAAQ,CAAC/D,aAAa,CAAC,eAAe,GAAG0B,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC;KAC3E,IAAIqI,MAAM,EACV;OACC;;KAGD9O,aAAG,CAAC+I,MAAM,CACT/I,aAAG,CAACC,MAAM,CACT,KAAK,EACL;OACCC,KAAK,EAAE;SACNC,SAAS,EAAE,wCAAwC;SACnD,YAAY,EAAEsG,KAAK,CAAC,IAAI;QACxB;OACDxF,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CACT,OAAO,EACP;SACCC,KAAK,EAAE;WACNC,SAAS,EAAE;UACX;SACDc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CACT,OAAO,EAAE;WACRC,KAAK,EAAE;aACNC,SAAS,EAAE,8BAA8B;aACzC0E,IAAI,EAAE,UAAU;aAChB3I,IAAI,EAAE8W,SAAS;aACf7W,KAAK,EAAEsK,KAAK,CAAC,IAAI;YACjB;WACD5J,KAAK,EAAE;aACNoQ,OAAO,EAAE;;UAEV,CACD,EACDjQ,QAAQ,CAACmQ,cAAc,CAAC1G,KAAK,CAAC,MAAM,CAAC,CAAC;QAEvC,CACD;MAEF,CACD,EACDqC,QAAQ,CACR;IACD;GAED,IAAMqK,oBAAoB,GAAG,SAAvBA,oBAAoB,CAAYC,UAAU,EAAEtK,QAAQ,EAC1D;KACC,IAAIhG,EAAE,CAACuQ,IAAI,CAACC,WAAW,CAACC,WAAW,CAACV,MAAM,CAAC,EAC3C;OACC,OAAO/P,EAAE,CAACuQ,IAAI,CAACC,WAAW,CAACC,WAAW,CAACV,MAAM,CAAC,CAACxK,IAAI,EAAE;;KAGtD,IAAMmL,SAAS,GAAG,EAAE;KAEpBP,UAAU,CAAC7Y,OAAO,CAAC,UAASqM,KAAK,EACjC;OACC+M,SAAS,CAACjZ,IAAI,CAAC;SACd6F,IAAI,EAAE0C,EAAE,CAAC8N,IAAI,CAAC6C,MAAM,CAAChN,KAAK,CAAC,MAAM,CAAC,CAAC;SACnCA,KAAK,EAAEA,KAAK;SACZiN,OAAO,EAAE,iBAASjX,KAAK,EAAEkX,IAAI,EAC7B;WACCT,mBAAmB,CAACS,IAAI,CAAClN,KAAK,EAAEqC,QAAQ,CAAC;WACzC,IAAI,CAACqD,WAAW,CAAC5C,KAAK,EAAE;;QAEzB,CAAC;MACF,CAAC;KAEFzG,EAAE,CAACuQ,IAAI,CAACC,WAAW,CAACjL,IAAI,CACvBwK,MAAM,EACNO,UAAU,EACVI,SAAS,EACT;OACCI,QAAQ,EAAE,IAAI;OACd/I,UAAU,EAAG/H,EAAE,CAAC+Q,GAAG,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,GAAG,CAAE;OACvCC,KAAK,EAAE;SAAE3P,QAAQ,EAAE,KAAK;SAAE4P,MAAM,EAAE;QAAG;OACrCC,MAAM,EAAE,GAAG;OACX7T,SAAS,EAAE,yCAAyC;OACpDyJ,MAAM,EAAE;SACPuB,YAAY,EAAE,sBAAS7B,KAAK,EAC5B;WACCA,KAAK,CAAC+B,OAAO,EAAE;;;MAGjB,CACD;IACD;GAEDrL,aAAG,CAAC+I,MAAM,CACT/I,aAAG,CAACC,MAAM,CACT,MAAM,EACN;KACCC,KAAK,EAAE;OACNC,SAAS,EAAE;MACX;KACDC,IAAI,EAAE8B,QAAQ,CAACiN,IAAI,GAAG;IACtB,CACD,EACD1F,IAAI,CACJ;GAED,IAAMwK,aAAa,GAAGjU,aAAG,CAACC,MAAM,CAC/B,KAAK,EACL;KACCC,KAAK,EAAE;OACNC,SAAS,EAAE;MACX;KACDc,QAAQ,EAAE;IACV,CACD;GACDjB,aAAG,CAAC+I,MAAM,CAACkL,aAAa,EAAExK,IAAI,CAAC;GAE/BzJ,aAAG,CAAC+I,MAAM,CACT/I,aAAG,CAACC,MAAM,CACT,KAAK,EACL;KACCC,KAAK,EAAE;OACNC,SAAS,EAAE;MACX;KACDc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CACT,MAAM,EACN;OACCC,KAAK,EAAE;SACNC,SAAS,EAAE;QACX;OACDC,IAAI,EAAE8B,QAAQ,CAAC8N,QAAQ,CAACkE,gBAAgB;OACxCtK,MAAM,EAAE;SACPC,KAAK,EAAE,iBACP;WACCsJ,oBAAoB,CAAC,IAAI,EAAEc,aAAa,CAAC;;;MAG3C,CACD;IAEF,CACD,EACDxK,IAAI,CACJ;GAED,IAAIhQ,cAAI,CAACU,OAAO,CAACgC,KAAK,CAAC,EACvB;KACCA,KAAK,CAAC/B,OAAO,CAAC,UAASqM,KAAK,EAC5B;OACC,IAAM0N,UAAU,GAAGlB,UAAU,CAAC7V,IAAI,CAAC,UAACgX,GAAG;SAAA,OAAKA,GAAG,CAACxa,EAAE,KAAK6M,KAAK;SAAC;OAC7D,IAAI0N,UAAU,EACd;SACCjB,mBAAmB,CAACiB,UAAU,EAAEF,aAAa,CAAC;;MAE/C,CAAC;;CAEJ;;;;ACt3BD,CAA0C;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE1C,KAAaI,QAAQ;GAWpB,kBAAYC,OAUX,EACD;KAAA;KAAApa;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KACC,sCAAI,YAAYoa,OAAO,CAACC,eAAe;KACvC,sCAAI,OAAOD,OAAO,CAACE,UAAU;KAC7B,sCAAI,UAAUF,OAAO,CAACpT,KAAK;KAC3B,sCAAI,eAAeoT,OAAO,CAACG,UAAU;KAErC,sCAAI,eAAe,EAAE;KACrB,sCAAI,uBAAuB,CAAC;KAC5B,IAAIhb,cAAI,CAACU,OAAO,CAACma,OAAO,CAACzV,UAAU,CAAC,EACpC;OACC,sCAAI,eAAeyV,OAAO,CAACzV,UAAU;OACrC,sCAAI,uBAAuB,sCAAI,eAAa6V,SAAS,CAAC,UAAA5V,MAAM;SAAA,OAAIA,MAAM,CAACC,SAAS,KAAKuV,OAAO,CAAChP,QAAQ;SAAC;MACtG,MACI,IAAI7L,cAAI,CAACkb,cAAc,CAACL,OAAO,CAAChP,QAAQ,CAAC,EAC9C;OACC,sCAAI,eAAa/K,IAAI,CAAC+Z,OAAO,CAAChP,QAAQ,CAAC;;KAGxC,IAAI,sCAAI,yBAAuB,CAAC,EAChC;OACC,sCAAI,uBAAuB,CAAC;;KAG7B,sCAAI,WAAW7L,cAAI,CAACU,OAAO,CAACma,OAAO,CAACM,cAAc,CAAC,GAAGN,OAAO,CAACM,cAAc,GAAG,EAAE;;GACjF;KAAA;KAAA,wBAGD;OACC,OAAO,IAAIP,QAAQ,CAAC;SACnBE,eAAe,EAAEzX,iBAAO,CAACb,KAAK,mCAAC,IAAI,YAAU;SAC7CuY,UAAU,oCAAE,IAAI,MAAI;SACpBC,UAAU,oCAAE,IAAI,cAAY;SAC5BnP,QAAQ,EAAE,IAAI,CAACuP,kBAAkB,EAAE;SAEnChW,UAAU,EAAE/B,iBAAO,CAACb,KAAK,mCAAC,IAAI,eAAa;SAE3C2Y,cAAc,EAAE9X,iBAAO,CAACb,KAAK,mCAAC,IAAI,WAAS;SAC3CiF,KAAK,oCAAE,IAAI;QACX,CAAC;;;KACF;KAAA,wBAQD;OACC,yCAAO,IAAI;;;KACX;KAAA,6BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,gCAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,qCAGD;OAAA;OACC,IAAM0H,cAAc,4BAAG,sCAAI,iDAAa,IAAI,uBAAqB,0DAA1C,sBAA4C7J,SAAS;OAE5E,OAAO,CAACtF,cAAI,CAACC,KAAK,CAACkP,cAAc,CAAC,GAAGhK,MAAM,CAACgK,cAAc,CAAC,GAAGA,cAAc;;;KAC5E;KAAA,kCAEiBkM,KAAa,EAC/B;OACC,IAAIA,KAAK,IAAI,CAAC,IAAIA,KAAK,GAAG,sCAAI,eAAahP,MAAM,EACjD;SACC,OAAO,sCAAI,eAAagP,KAAK,CAAC,CAAC/V,SAAS;;OAGzC,OAAO,IAAI;;;KACX;KAAA,sCAGD;OACC,OAAO,sCAAI,eAAagW,KAAK,CAAC,sCAAI,yBAAuB,CAAC,CAAC,CAACpZ,GAAG,CAAC,UAAAmD,MAAM;SAAA,OAAIA,MAAM,CAACC,SAAS;SAAC;;;KAC3F;KAAA,0CAGD;OACC,OAAO,sCAAI,eAAagW,KAAK,CAAC,CAAC,oCAAE,IAAI,uBAAqB,CAACpZ,GAAG,CAAC,UAAAmD,MAAM;SAAA,OAAIA,MAAM,CAACC,SAAS;SAAC;;;KAC1F;KAAA,0BAESuG,QAAgB,EAC1B;OACC,IAAM0P,WAAW,GAAG,sCAAI,eAAaN,SAAS,CAAC,UAAA5V,MAAM;SAAA,OAAIA,MAAM,CAACC,SAAS,KAAKuG,QAAQ;SAAC;OACvF,IAAI0P,WAAW,IAAI,CAAC,EACpB;SACC,sCAAI,uBAAuBA,WAAW;;OAGvC,OAAO,IAAI;;;KACX;KAAA,4BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,0BAESJ,cAA6B,EACvC;OACC,sCAAI,WAAWA,cAAc;OAE7B,OAAO,IAAI;;;KACX;KAAA,8BAEa/V,UAAyB,EACvC;OACC,IAAIpF,cAAI,CAACwb,aAAa,CAACpW,UAAU,CAAC,EAClC;SACC,sCAAI,eAAeA,UAAU;;OAG9B,OAAO,IAAI;;;KACX;KAAA,oBA7ED;OACC,yCAAO,IAAI;;;KACX;KAAA,oBA8ED;OACC,yCAAO,IAAI;;;GACX;CAAA;;;;ACpJF,CAAsC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEtC,KAAaqW,aAAa;GAsBzB,uBAAYC,MAAe,EAC3B;KAAA;KAAAjb;OAAA;OAAA,OATiBgb,aAAa,CAACE,UAAU,CAACC;;KAAenb;OAAA;OAAA,OACzCgb,aAAa,CAACI,UAAU,CAACC;;KAAKrb;OAAA;OAAA,OAC7B;;KAACA;OAAA;OAAA,OACG;;KAAGA;OAAA;OAAA,OACH;;KAAKA;OAAA;OAAA,OACF;;KAAKA;OAAA;OAAA;;KAK5B,IAAIT,cAAI,CAACuC,aAAa,CAACmZ,MAAM,CAAC,EAC9B;OACC,IAAIA,MAAM,CAAC,MAAM,CAAC,EAClB;SACC,IAAI,CAACK,OAAO,CAACL,MAAM,CAAC,MAAM,CAAC,CAAC;;OAE7B,IAAIA,MAAM,CAAC,OAAO,CAAC,EACnB;SACC,IAAI,CAACM,QAAQ,CAACN,MAAM,CAAC,OAAO,CAAC,CAAC;;OAE/B,IAAIA,MAAM,CAAC,WAAW,CAAC,EACvB;SACC,IAAI,CAACO,YAAY,CAACP,MAAM,CAAC,WAAW,CAAC,CAAC;;OAEvC,IAAIA,MAAM,CAAC,OAAO,CAAC,EACnB;SACC,IAAI,CAACQ,QAAQ,CAACR,MAAM,CAAC,OAAO,CAAC,CAAC;;OAE/B,IAAIA,MAAM,CAAC,UAAU,CAAC,EACtB;SACC,IAAI,CAACS,WAAW,CAACT,MAAM,CAAC,UAAU,CAAC,CAAC;;OAErC,IAAIA,MAAM,CAAC,aAAa,CAAC,EACzB;SACC,IAAI,CAACU,cAAc,CAACV,MAAM,CAAC,aAAa,CAAC,CAAC;;OAE3C,IAAIA,MAAM,CAAC,QAAQ,CAAC,EACpB;SACC,IAAI,CAACW,SAAS,CAACX,MAAM,CAAC,QAAQ,CAAC,CAAC;;;;GAGlC;KAAA;KAAA,wBAgDD;OACC,OAAO,IAAID,aAAa,CAAC;SACxBrQ,IAAI,oCAAE,IAAI,QAAM;SAChB1I,KAAK,oCAAE,IAAI,SAAO;SAClB4Z,SAAS,oCAAE,IAAI,aAAW;SAC1BC,KAAK,oCAAE,IAAI,SAAO;SAClBC,QAAQ,oCAAE,IAAI,YAAU;SACxBC,WAAW,oCAAE,IAAI,eAAa;SAC9BC,MAAM,oCAAE,IAAI;QACZ,CAAC;;;KACF;KAAA,wBAuKOtR,IAAI,EACZ;OACC,IACCA,IAAI,KAAKqQ,aAAa,CAACI,UAAU,CAACC,KAAK,IACpC1Q,IAAI,KAAKqQ,aAAa,CAACI,UAAU,CAACc,MAAM,IACxCvR,IAAI,KAAKqQ,aAAa,CAACI,UAAU,CAACe,EAAE,EAExC;SACCxR,IAAI,GAAGqQ,aAAa,CAACI,UAAU,CAACC,KAAK;;OAEtC,sCAAI,SAAS1Q,IAAI;OAEjB,OAAO,IAAI;;;KACX;KAAA,yBAEQ1I,KAAK,EACd;OACCA,KAAK,GAAGma,QAAQ,CAACna,KAAK,CAAC;OACvB,sCAAI,UAAUA,KAAK,IAAI,CAAC,GAAGA,KAAK,GAAG,CAAC;OAEpC,OAAO,IAAI;;;KACX;KAAA,6BAEY4Z,SAAiB,EAC9B;OACC,IAAIA,SAAS,KAAK,GAAG,IAAIA,SAAS,KAAK,GAAG,IAAIA,SAAS,KAAK,GAAG,EAC/D;SACCA,SAAS,GAAG,GAAG;;OAGhB,sCAAI,cAAcA,SAAS;OAE3B,OAAO,IAAI;;;KACX;KAAA,yBAEQC,KAAa,EACtB;OACC,IAAIvc,cAAI,CAAC2F,QAAQ,CAAC4W,KAAK,CAAC,IAAIA,KAAK,KAAK,EAAE,EACxC;SACC,sCAAI,UAAUA,KAAK;;OAGpB,OAAO,IAAI;;;KACX;KAAA,4BAEWtW,IAAI,EAChB;OACC,sCAAI,aAAa,CAAC,CAACA,IAAI;OAEvB,OAAO,IAAI;;;KACX;KAAA,+BAEcA,IAAI,EACnB;OACC,sCAAI,gBAAgB,CAAC,CAACA,IAAI;OAE1B,OAAO,IAAI;;;KACX;KAAA,0BAESvD,KAA+B,EACzC;OACC,sCAAI,WAAWA,KAAK;OAEpB,OAAO,IAAI;;;KACX;KAAA,wBAGD;OACC,OACC,sCAAI,aAAW+Y,aAAa,CAACI,UAAU,CAACC,KAAK,IAC1C,sCAAI,cAAYL,aAAa,CAACE,UAAU,CAACC,eAAe,IACxD,mCAAC,IAAI,SAAO,IACZ,CAAC,IAAI,CAACY,QAAQ,IACd,CAAC,IAAI,CAACE,MAAM;;;KAEhB;KAAA,yBAGD;OACC,IAAI,CAACX,OAAO,CAACN,aAAa,CAACI,UAAU,CAACC,KAAK,CAAC;OAC5C,IAAI,CAACE,QAAQ,CAAC,CAAC,CAAC;OAChB,IAAI,CAACC,YAAY,CAAC,GAAG,CAAC;OACtB,IAAI,CAACC,QAAQ,CAACT,aAAa,CAACE,UAAU,CAACC,eAAe,CAAC;OACvD,IAAI,CAACS,SAAS,CAAC,IAAI,CAAC;;;KACpB;KAAA,4BAGD;OACC,OAAO;SACNjR,IAAI,oCAAE,IAAI,QAAM;SAChB1I,KAAK,oCAAE,IAAI,SAAO;SAClB4Z,SAAS,oCAAE,IAAI,aAAW;SAC1BC,KAAK,oCAAE,IAAI,SAAO;SAClBC,QAAQ,EAAE,sCAAI,eAAa,CAAC,GAAG,CAAC;SAChCC,WAAW,EAAE,sCAAI,kBAAgB,CAAC,GAAG,CAAC;SACtCC,MAAM,EAAE,sCAAI,cAAY;QACxB;;;KACD;KAAA,6BAEYI,WAAW,EAAEC,gBAAgB,EAC1C;OACC,IAAIR,KAAK,GAAG,sCAAI,8CAAU,IAAI,YAAUd,aAAa,CAACE,UAAU,CAACqB,WAAW;OAE5E,IAAI,CAACvB,aAAa,CAACwB,aAAa,CAACV,KAAK,CAAC,IAAIvc,cAAI,CAACU,OAAO,CAACoc,WAAW,CAAC,EACpE;SACC,KAAK,IAAIjQ,CAAC,GAAG,CAAC,EAAEqQ,CAAC,GAAGJ,WAAW,CAACzQ,MAAM,EAAEQ,CAAC,GAAGqQ,CAAC,EAAE,EAAErQ,CAAC,EAClD;WACC,IAAI0P,KAAK,KAAKO,WAAW,CAACjQ,CAAC,CAAC,CAACgJ,gBAAgB,EAC7C;aACC0G,KAAK,GAAGO,WAAW,CAACjQ,CAAC,CAAC,CAAC+I,UAAU;aACjC;;;;OAKH,IAAI,IAAI,CAACuH,KAAK,EAAE,IAAI,sCAAI,aAAW1B,aAAa,CAACI,UAAU,CAACe,EAAE,IAAI,mCAAC,IAAI,YAAU,IAAI,mCAAC,IAAI,UAAQ,EAClG;SACC,OAAOL,KAAK;;OAGb,IAAIa,IAAI,GAAG,CAAC;OACZ,IAAIC,KAAK,GAAG,CAAC;OACb,IAAIC,OAAO,GAAG,CAAC;OAEf,0CAAQ,IAAI;SAEX,KAAK,GAAG;WACPA,OAAO,qCAAG,IAAI,SAAO;WACrB;SACD,KAAK,GAAG;WACPD,KAAK,qCAAG,IAAI,SAAO;WACnB;SACD,KAAK,GAAG;WACPD,IAAI,qCAAG,IAAI,SAAO;WAClB;;OAGF,IAAInb,GAAG,GAAG,EAAE;OAEZ,IAAI,sCAAI,aAAWwZ,aAAa,CAACI,UAAU,CAACc,MAAM,EAClD;SACC1a,GAAG,GAAG,GAAG;;OAGV,IAAImb,IAAI,GAAG,CAAC,EACZ;SACCnb,GAAG,IAAImb,IAAI,GAAG,GAAG;;OAElB,IAAIC,KAAK,GAAG,CAAC,EACb;SACCpb,GAAG,IAAIob,KAAK,GAAG,GAAG;;OAEnB,IAAIC,OAAO,GAAG,CAAC,EACf;SACCrb,GAAG,IAAIqb,OAAO,GAAG,GAAG;;OAGrB,IAAMC,EAAE,GAAG,sCAAI,eAAa,aAAa,GAAG,SAAS;OAErD,IAAIA,EAAE,KAAK,aAAa,IAAItb,GAAG,KAAK,EAAE,EACtC;SACCA,GAAG,GAAG,IAAI;;OAGX,IAAIub,MAAM,GAAG,EAAE;OACf,IAAID,EAAE,KAAK,aAAa,IAAIR,gBAAgB,EAC5C;SACCS,MAAM,GAAGT,gBAAgB;;OAG1B,IAAI3H,MAAM,GAAGmI,EAAE,GAAG,GAAG,GAAGhB,KAAK,GAAG,IAAI,GAAGta,GAAG,GAAG,GAAG,IAAIub,MAAM,GAAG,GAAG,GAAGA,MAAM,GAAG,EAAE,CAAC,GAAG,GAAG;OAErF,IAAI,sCAAI,aAAW/B,aAAa,CAACI,UAAU,CAACe,EAAE,sCAAI,IAAI,UAAQ,EAC9D;SACC,IAAI,mCAAC,IAAI,YAAU,EACnB;WACCxH,MAAM,GAAGmH,KAAK;;SAGfnH,MAAM,qBAAcA,MAAM,eAAK,sCAAI,WAAS,CAAC,CAAC,IAAI,CAAC,eAAK,sCAAI,WAAS,CAAC,CAAC,IAAI,CAAC,MAAG;;OAGhF,OAAO,GAAG,GAAGA,MAAM;;;KACnB;KAAA,uBAEMqI,SAAS,EAAE1Q,MAAM,EACxB;OACC,IAAI2Q,GAAG,GAAGD,SAAS;OAEnB,IAAI,sCAAI,aAAWhC,aAAa,CAACI,UAAU,CAACe,EAAE,EAC9C;SACCc,GAAG,GAAG9W,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC;SACtD,IAAI7G,cAAI,CAACU,OAAO,CAACqM,MAAM,CAAC,EACxB;WACC,KAAK,IAAIF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGE,MAAM,CAACV,MAAM,EAAE,EAAEQ,CAAC,EACtC;aACC,IAAI,sCAAI,cAAYE,MAAM,CAACF,CAAC,CAAC,CAACgJ,gBAAgB,EAC9C;eACC6H,GAAG,IAAI,GAAG,GAAG3Q,MAAM,CAACF,CAAC,CAAC,CAAC6I,IAAI;eAC3B;;;;SAIH,IAAI,IAAI,CAACgH,MAAM,EACf;WACCgB,GAAG,IAAI,GAAG,GAAG,IAAI,CAACC,YAAY;;QAE/B,MACI,sCAAI,IAAI,WACb;SACC,IAAMC,MAAM,GACX,sCAAI,aAAWnC,aAAa,CAACI,UAAU,CAACC,KAAK,GAC1ClV,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC,GAChDD,aAAG,CAACC,UAAU,CAAC,mCAAmC,CACrD;SAED6W,GAAG,GAAGE,MAAM,GAAG,GAAG,GAAG,IAAI,CAACC,uBAAuB,mCAAC,IAAI,6CAAS,IAAI,cAAY;SAE/E,IAAI7d,cAAI,CAACU,OAAO,CAACqM,MAAM,CAAC,EACxB;WACC,IAAM+Q,WAAW,GAChB,sCAAI,aAAWrC,aAAa,CAACI,UAAU,CAACC,KAAK,GAC1ClV,aAAG,CAACC,UAAU,CAAC,8BAA8B,CAAC,GAC9CD,aAAG,CAACC,UAAU,CAAC,iCAAiC,CACnD;WACD,KAAK,IAAIgG,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGE,MAAM,CAACV,MAAM,EAAE,EAAEQ,EAAC,EACtC;aACC,IAAI,sCAAI,cAAYE,MAAM,CAACF,EAAC,CAAC,CAACgJ,gBAAgB,EAC9C;eACC6H,GAAG,IAAI,GAAG,GAAGI,WAAW,GAAG,GAAG,GAAG/Q,MAAM,CAACF,EAAC,CAAC,CAAC6I,IAAI;eAC/C;;;;;OAMJ,sCAAI,IAAI,cACR;SACCgI,GAAG,IAAI,IAAI,GAAG9W,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;;OAGnE,OAAO6W,GAAG;;;KACV;KAAA,wCAEuBhb,KAAK,EAAE0I,IAAI,EACnC;OACC,IAAM2S,KAAK,GAAGrb,KAAK,GAAG,GAAG;OACzB,IAAIsb,UAAU,GAAG,CAAC;OAClB,IAAItb,KAAK,GAAG,EAAE,EACd;SACCA,KAAK,GAAIA,KAAK,GAAG,EAAG;;OAGrB,IAAIA,KAAK,KAAK,CAAC,EACf;SACCsb,UAAU,GAAG,CAAC;QACd,MACI,IAAItb,KAAK,GAAG,CAAC,IAAIA,KAAK,GAAG,CAAC,EAC/B;SACCsb,UAAU,GAAG,CAAC;QACd,MAED;SACCA,UAAU,GAAG,CAAC;;OAGf,IAAMC,MAAM,GAAGxC,aAAa,CAACyC,eAAe,CAAC9S,IAAI,CAAC;OAElD,OAAO2S,KAAK,IAAIE,MAAM,GAAGA,MAAM,CAACD,UAAU,CAAC,GAAG,EAAE,CAAC;;;KACjD;KAAA,oBA3eD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAGD;OACC,IAAI,mCAAC,IAAI,UAAQ,EACjB;SACC,OAAO,EAAE;;OAGV,OAAO,CAAC,GAAG,GAAG,sCAAI,WAAS,CAAC,CAAC,EAAE1C,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,sCAAI,WAAS,CAAC,CAAC,EAAEA,KAAK,CAAC,CAAC,CAAC,CAAC;;;KAClF;KAAA,8BAeoBiB,KAAa,EAClC;OACC,OACCA,KAAK,KAAK,IAAI,CAACZ,UAAU,CAACqB,WAAW,IAClCT,KAAK,KAAK,IAAI,CAACZ,UAAU,CAACC,eAAe,IACzCW,KAAK,KAAK,IAAI,CAACZ,UAAU,CAACwC,oBAAoB;;;KAElD;KAAA,2BAEiBC,cAAc,EAAEtB,WAAW,EAC7C;OACC,IAAI,CAACsB,cAAc,EACnB;SACC,OAAO,IAAI3C,aAAa,EAAE;;OAG3B2C,cAAc,GAAGA,cAAc,CAACC,QAAQ,EAAE,CAACC,SAAS,EAAE,CAACvG,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC;OACxE,IAAM2D,MAAM,GAAG;SACda,KAAK,EAAEd,aAAa,CAACE,UAAU,CAACC,eAAe;SAC/CY,QAAQ,EAAE,KAAK;SACfE,MAAM,EAAE;QACR;OAED,IAAMrb,MAAM,GAAG;SACdwL,CAAC,EAAE,CAAC;SACJ0R,CAAC,EAAE,CAAC;SACJC,CAAC,EAAE;QACH;OAED,IAAIJ,cAAc,CAAClV,OAAO,CAAC,UAAU,CAAC,KAAK,CAAC,EAC5C;SACCkV,cAAc,GAAGA,cAAc,CAACK,SAAS,CAAC,CAAC,EAAEL,cAAc,CAAC/R,MAAM,GAAG,CAAC,CAAC;SAEvE,IAAMqS,WAAW,GAAGN,cAAc,CAACO,KAAK,CAAC,GAAG,CAAC;SAC7C,IAAMC,MAAM,GAAG/B,QAAQ,CAAC6B,WAAW,CAACG,GAAG,EAAE,CAACC,IAAI,EAAE,CAAC;SACjD,IAAMC,IAAI,GAAGlC,QAAQ,CAAC6B,WAAW,CAACG,GAAG,EAAE,CAACC,IAAI,EAAE,CAAC;SAE/CpD,MAAM,CAACgB,MAAM,GAAG,CAACqC,IAAI,IAAI,CAAC,EAAEH,MAAM,IAAI,CAAC,CAAC;SACxCR,cAAc,GAAGM,WAAW,CAACM,IAAI,CAAC,GAAG,CAAC;;OAGvC,IAAIZ,cAAc,CAAClV,OAAO,CAAC,UAAU,CAAC,KAAK,CAAC,IAAIkV,cAAc,CAAClV,OAAO,CAAC,cAAc,CAAC,KAAK,CAAC,EAC5F;SACC,IAAIkV,cAAc,CAAClV,OAAO,CAAC,cAAc,CAAC,KAAK,CAAC,EAChD;WACCkV,cAAc,GAAGA,cAAc,CAACK,SAAS,CAAC,EAAE,EAAEL,cAAc,CAAC/R,MAAM,GAAG,CAAC,CAAC;WACxEqP,MAAM,CAAC,UAAU,CAAC,GAAG,IAAI;UACzB,MAED;WACC0C,cAAc,GAAGA,cAAc,CAACK,SAAS,CAAC,CAAC,EAAEL,cAAc,CAAC/R,MAAM,GAAG,CAAC,CAAC;;SAGxE,IAAM4S,MAAM,GAAGb,cAAc,CAACO,KAAK,CAAC,GAAG,CAAC;SACxCjD,MAAM,CAAC,OAAO,CAAC,GAAGuD,MAAM,CAAC,CAAC,CAAC,CAACH,IAAI,EAAE;SAClCG,MAAM,CAAC,CAAC,CAAC,GAAG,CAACA,MAAM,CAAC,CAAC,CAAC,IAAI,EAAE,EAAElH,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;SACpD2D,MAAM,CAAC,MAAM,CAAC,GAAGuD,MAAM,CAAC,CAAC,CAAC,CAAC/V,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,GAAGuS,aAAa,CAACI,UAAU,CAACc,MAAM,GAAGlB,aAAa,CAACI,UAAU,CAACC,KAAK;SAEhH,IAAI9S,KAAK;SACT,IAAMkW,EAAE,GAAG,0BAA0B;SACrC,OAAOlW,KAAK,GAAGkW,EAAE,CAACC,IAAI,CAACF,MAAM,CAAC,CAAC,CAAC,CAAC,EACjC;WACC5d,MAAM,CAAC2H,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG6T,QAAQ,CAAC7T,KAAK,CAAC,CAAC,CAAC,CAAC;;QAEtC,MAED;SACC0S,MAAM,CAAC,OAAO,CAAC,GAAG0C,cAAc;;OAGjC,IAAI,CAAC3C,aAAa,CAACwB,aAAa,CAACvB,MAAM,CAAC,OAAO,CAAC,CAAC,IAAIrS,EAAE,CAAC+B,IAAI,CAAC1K,OAAO,CAACoc,WAAW,CAAC,EACjF;SACC,IAAIsC,KAAK,GAAG,KAAK;SACjB,KAAK,IAAIvS,CAAC,GAAG,CAAC,EAAEqQ,CAAC,GAAGJ,WAAW,CAACzQ,MAAM,EAAEQ,CAAC,GAAGqQ,CAAC,EAAE,EAAErQ,CAAC,EAClD;WACC,IAAI6O,MAAM,CAAC,OAAO,CAAC,KAAKoB,WAAW,CAACjQ,CAAC,CAAC,CAACgJ,gBAAgB,IAAI6F,MAAM,CAAC,OAAO,CAAC,KAAKoB,WAAW,CAACjQ,CAAC,CAAC,CAAC+I,UAAU,EACxG;aACC8F,MAAM,CAAC,OAAO,CAAC,GAAGoB,WAAW,CAACjQ,CAAC,CAAC,CAACgJ,gBAAgB;aACjDuJ,KAAK,GAAG,IAAI;aACZ;;;SAGF,IAAI,CAACA,KAAK,EACV;WACC1D,MAAM,CAAC,OAAO,CAAC,GAAGD,aAAa,CAACE,UAAU,CAACC,eAAe;;;OAI5D,IAAM0B,OAAO,GAAGjc,MAAM,CAAC,GAAG,CAAC,GAAGA,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,GAAGA,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE;OAEtE,IAAIic,OAAO,GAAG,IAAI,KAAK,CAAC,EACxB;SACC5B,MAAM,CAAC,OAAO,CAAC,GAAG4B,OAAO,GAAG,IAAI;SAChC5B,MAAM,CAAC,WAAW,CAAC,GAAG,GAAG;QACzB,MACI,IAAI4B,OAAO,GAAG,EAAE,KAAK,CAAC,EAC3B;SACC5B,MAAM,CAAC,OAAO,CAAC,GAAG4B,OAAO,GAAG,EAAE;SAC9B5B,MAAM,CAAC,WAAW,CAAC,GAAG,GAAG;QACzB,MAED;SACCA,MAAM,CAAC,OAAO,CAAC,GAAG4B,OAAO;SACzB5B,MAAM,CAAC,WAAW,CAAC,GAAG,GAAG;;OAG1B,IACC,CAACA,MAAM,CAAC,OAAO,CAAC,KAEfA,MAAM,CAAC,OAAO,CAAC,KAAKD,aAAa,CAACE,UAAU,CAACC,eAAe,IACzDF,MAAM,CAACgB,MAAM,CAChB,IACEhB,MAAM,CAAC,OAAO,CAAC,EAEnB;SACCA,MAAM,CAAC,MAAM,CAAC,GAAGD,aAAa,CAACI,UAAU,CAACe,EAAE;;OAG7C,OAAO,IAAInB,aAAa,CAACC,MAAM,CAAC;;;KAChC;KAAA,4BAEkB4B,OAAO,EAC1B;OACC,IAAI5a,KAAK;OACT,IAAI0I,IAAI;OAER,IAAIkS,OAAO,GAAG,IAAI,KAAK,CAAC,EACxB;SACC5a,KAAK,GAAG4a,OAAO,GAAG,IAAI;SACtBlS,IAAI,GAAG,GAAG;QACV,MACI,IAAIkS,OAAO,GAAG,EAAE,KAAK,CAAC,EAC3B;SACC5a,KAAK,GAAG4a,OAAO,GAAG,EAAE;SACpBlS,IAAI,GAAG,GAAG;QACV,MAED;SACC1I,KAAK,GAAG4a,OAAO;SACflS,IAAI,GAAG,GAAG;;OAGX,OAAO,CAAC1I,KAAK,EAAE0I,IAAI,CAAC;;;KACpB;KAAA,0BAEgB1I,KAAK,EAAE4Z,SAAS,EACjC;OACC,IAAIlH,MAAM,GAAG,CAAC;OAEd,QAAQkH,SAAS;SAEhB,KAAK,GAAG;WACPlH,MAAM,GAAG1S,KAAK;WACd;SACD,KAAK,GAAG;WACP0S,MAAM,GAAG1S,KAAK,GAAG,EAAE;WACnB;SACD,KAAK,GAAG;WACP0S,MAAM,GAAG1S,KAAK,GAAG,EAAE,GAAG,EAAE;WACxB;;OAGF,OAAO0S,MAAM;;;KACb;KAAA,gCAiRsBiK,MAAM,EAC7B;OACC,IAAIpB,MAAM,GAAG,EAAE;OACf,IAAIoB,MAAM,KAAK,GAAG,EAClB;SACCpB,MAAM,GAAG,CACRrX,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC,EAC7CD,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC,EAC7CD,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC,CAC7C;QACD,MACI,IAAIwY,MAAM,KAAK,GAAG,EACvB;SACCpB,MAAM,GAAG,CACRrX,aAAG,CAACC,UAAU,CAAC,8BAA8B,CAAC,EAC9CD,aAAG,CAACC,UAAU,CAAC,8BAA8B,CAAC,EAC9CD,aAAG,CAACC,UAAU,CAAC,8BAA8B,CAAC,CAC9C;QACD,MACI,IAAIwY,MAAM,KAAK,GAAG,EACvB;SACCpB,MAAM,GAAG,CACRrX,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC,EAC7CD,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC,EAC7CD,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC,CAC7C;;OAGF,OAAOoX,MAAM;;;GACb;CAAA;CACD,4BArkBYxC,aAAa,gBAEL;GACnBuB,WAAW,EAAE,gBAAgB;GAC7BpB,eAAe,EAAE,eAAe;GAChCuC,oBAAoB,EAAE;CACvB,CAAC;CAAA,4BANW1C,aAAa,gBAQL;GACnBK,KAAK,EAAE,OAAO;GACda,MAAM,EAAE,QAAQ;GAChBC,EAAE,EAAE;CACL,CAAC;;KCZW5U,QAAQ;GAAA;KAAA;;GAAA;KAAA;KAAA,wBAKLjD,IAAI,EACnB;OACCA,IAAI,CAAC6I,gBAAgB,CAAC,aAAa,CAAC,CAACjN,OAAO,CAAC,UAAC2e,OAAO;SAAA,OAAKtX,QAAQ,CAACuX,UAAU,CAACD,OAAO,CAAC;SAAC;;;KACvF;KAAA,2BAEiBva,IAAI,EACtB;OACC+B,eAAK,CAACC,IAAI,CAAChC,IAAI,EAAE,WAAW,EAAE,IAAI,CAACya,QAAQ,CAACzY,IAAI,CAAC,IAAI,EAAEhC,IAAI,CAAC,CAAC;OAC7D+B,eAAK,CAACC,IAAI,CAAChC,IAAI,EAAE,UAAU,EAAE,IAAI,CAAC0a,QAAQ,CAAC1Y,IAAI,CAAC,IAAI,CAAC,CAAC;;;KACtD;KAAA,+BAEqBhC,IAAI,EAC1B;OAAA;OACC,OAAO,CAAC,qBAAC,IAAI,CAAC2a,SAAS,qEAAd,gBAAgBC,WAAW,kDAA3B,sBAA6BC,UAAU,CAAC7a,IAAI,CAAC;;;KACtD;KAAA,yBAEeA,IAAI,EACpB;OACC,IAAM8a,OAAO,GAAG9a,IAAI,CAACsG,YAAY,CAAC,WAAW,CAAC;OAC9C,IAAI,CAACwU,OAAO,EACZ;SACC;;OAED,IAAIlZ,IAAI,GAAGwQ,cAAI,CAAC6C,MAAM,CAAC6F,OAAO,CAAC;OAC/BlZ,IAAI,GAAG0C,EAAE,CAACyW,IAAI,CAACC,KAAK,CAACpZ,IAAI,CAAC;OAE1B,IAAI,CAAC3G,cAAI,CAACkb,cAAc,CAACvU,IAAI,CAAC,EAC9B;SACC;;OAED,IAAI,CAAC8Y,QAAQ,EAAE;OAEf,IAAI,CAACC,SAAS,GAAG,IAAIrW,EAAE,CAAC0H,WAAW,CAAC,6BAA6B,EAAEhM,IAAI,EAAE;SACxEib,WAAW,EAAE,IAAI;SACjB7F,QAAQ,EAAE,KAAK;SACf8F,QAAQ,EAAE,IAAI;SACd7O,UAAU,EAAE,CAAC;SACbC,SAAS,EAAE,CAAC;SACZ6O,WAAW,EAAE;WAACxV,QAAQ,EAAE;UAAM;SAC9ByF,MAAM,EAAG;WACRuB,YAAY,0BACZ;aACC,IAAI,CAACE,OAAO,EAAE;;UAEf;SACDV,OAAO,EAAG3K,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAC3BC,KAAK,EAAG;aACPgE,KAAK,EAAG;YACR;WACD0V,IAAI,EAAExZ;UACN;QACD,CAAC;OACF,IAAI,CAAC+Y,SAAS,CAACU,QAAQ,CAAC;SAAC9F,MAAM,EAAE,EAAE;SAAE5P,QAAQ,EAAE;QAAS,CAAC;OACzD,IAAI,CAACgV,SAAS,CAAC9Q,IAAI,EAAE;OAErB,OAAO,IAAI;;;KACX;KAAA,sCAE4B7J,IAAI,EACjC;OACC,IAAI,CAACsb,aAAa,CAACtb,IAAI,EAAE6B,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC,CAAC;;;KAC3E;KAAA,8BAEoB9B,IAAI,EAAE4B,IAAI,EAC/B;OACC,IAAI,IAAI,CAAC2Z,OAAO,EAChB;SACCC,YAAY,CAAC,IAAI,CAACD,OAAO,CAAC;;OAG3B,IAAI,CAACZ,SAAS,GAAGrW,EAAE,CAAC4L,EAAE,CAACC,IAAI,CAACsL,cAAc,CAAC;SAC1CC,eAAe,EAAE;WAChB7V,KAAK,EAAE,GAAG;WACV8V,MAAM,EAAE,GAAG;WACXpP,UAAU,EAAE,IAAI;WAChB6I,QAAQ,EAAE,IAAI;WACdE,KAAK,EAAE;aAACC,MAAM,EAAE/T,aAAG,CAACoa,WAAW,CAAC5b,IAAI,CAAC,CAAC6F,KAAK,GAAG;YAAE;WAChDsV,WAAW,EAAE;aAACxV,QAAQ,EAAE;;;QAEzB,CAAC;OAEF,IAAI,CAACgV,SAAS,CAAC5P,KAAK,GAAG,YACvB;SACC,IAAI,CAACpB,IAAI,EAAE;QACX;OACD,IAAI,CAACgR,SAAS,CAAC9Q,IAAI,CAAC7J,IAAI,EAAE4B,IAAI,CAAC;OAC/B,IAAI,CAAC2Z,OAAO,GAAGrM,UAAU,CAAC,IAAI,CAACwL,QAAQ,CAAC1Y,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC;;;KACzD;KAAA,2BAGD;OACC,IAAI,IAAI,CAAC2Y,SAAS,EAClB;SACC,IAAI,CAACA,SAAS,CAAC5P,KAAK,EAAE;;OAEvB,IAAI,CAAC4P,SAAS,GAAG,IAAI;;;GACrB;CAAA;;KCvGWkB,cAAc;GAAA;CAAA;CAO1B,4BAPYA,cAAc,aAET,CAAC;CAAA,4BAFNA,cAAc,aAGT,CAAC;CAAA,4BAHNA,cAAc,eAIP,CAAC;CAAA,4BAJRA,cAAc,eAKP,CAAC;CAAA,4BALRA,cAAc,gBAMN,CAAC;;;;ACNtB,CAAiD;CAAA;AAEjD,KAAaC,aAAa;GAAA;KAAA;KAAApgB;OAAA;OAAA;;KAAAA;OAAA;OAAA;;;GAAA;KAAA;KAAA,iCAsDzB;OACC,OAAO,IAAI,CAAC2K,IAAI,KAAKyV,aAAa,CAACC,qBAAqB;;;KACxD;KAAA,oBA5BD;OACC,yCAAO,IAAI;MACX;KAAA,kBAOQC,SAAiB,EAC1B;OACC,IAAIF,aAAa,CAACG,mBAAmB,EAAE,CAAC1c,QAAQ,CAACyc,SAAS,CAAC,EAC3D;SACC,sCAAI,WAASA,SAAS;;;;KAEvB;KAAA,oBAVD;OACC,yCAAO,IAAI;MACX;KAAA,kBAUkBE,mBAA2B,EAC9C;OACC,IAAIJ,aAAa,CAACK,sBAAsB,EAAE,CAAC5c,QAAQ,CAAC2c,mBAAmB,CAAC,EACxE;SACC,sCAAI,mBAAmBA,mBAAmB;;;;KAE3C;KAAA,sCAQD;OACC,OAAO,CACNJ,aAAa,CAACM,qBAAqB,EACnCN,aAAa,CAACO,qBAAqB,EACnCP,aAAa,CAACQ,mBAAmB,EACjCR,aAAa,CAACS,oBAAoB,EAClCT,aAAa,CAACU,mBAAmB,EACjCV,aAAa,CAACW,oBAAoB,EAClCX,aAAa,CAACY,oBAAoB,EAClCZ,aAAa,CAACa,oBAAoB,EAClCb,aAAa,CAACC,qBAAqB,EACnCD,aAAa,CAACc,mBAAmB,EACjCd,aAAa,CAACe,mBAAmB,EACjCf,aAAa,CAACgB,qBAAqB,EACnChB,aAAa,CAACiB,mBAAmB,EACjCjB,aAAa,CAACkB,eAAe,CAC7B;;;KACD;KAAA,oCAE0BC,MAAc,EACzC;OACC,OAAOnB,aAAa,CAACG,mBAAmB,EAAE,CAAC1c,QAAQ,CAAC0d,MAAM,CAAC;;;KAC3D;KAAA,yCAGD;OACC,OAAO,CACNpB,cAAc,CAACqB,OAAO,EACtBrB,cAAc,CAACsB,OAAO,EACtBtB,cAAc,CAACzZ,SAAS,EACxByZ,cAAc,CAACuB,SAAS,EACxBvB,cAAc,CAACwB,UAAU,CACzB;;;KACD;KAAA,sCAE4BvW,QAAgB,EAC7C;OACC,OAAOgV,aAAa,CAACK,sBAAsB,EAAE,CAAC5c,QAAQ,CAACuH,QAAQ,CAAC;;;GAChE;CAAA;CACD,4BAlGYgV,aAAa,2BAEM,CAAC;CAAA,4BAFpBA,aAAa,2BAGM,CAAC;CAAA,4BAHpBA,aAAa,yBAII,CAAC;CAAA,4BAJlBA,aAAa,0BAKK,CAAC;CAAA,4BALnBA,aAAa,yBAMI,CAAC;CAAA,4BANlBA,aAAa,0BAOK,CAAC;CAAA,4BAPnBA,aAAa,0BAQK,CAAC;CAAA,4BARnBA,aAAa,0BASK,CAAC;CAAA,4BATnBA,aAAa,2BAUM,CAAC;CAAA,4BAVpBA,aAAa,yBAWI,CAAC;CAAA,4BAXlBA,aAAa,yBAYI,EAAE;CAAA,4BAZnBA,aAAa,2BAaM,EAAE;CAAA,4BAbrBA,aAAa,yBAcI,EAAE;CAAA,4BAdnBA,aAAa,qBAeA,EAAE;;KCjBf3Z,cAAc;GAAA;CAAA;CAM1B,4BANYA,cAAc,aAET,CAAC;CAAA,4BAFNA,cAAc,aAGT,CAAC;CAAA,4BAHNA,cAAc,eAIP,CAAC;CAAA,4BAJRA,cAAc,mBAKH,CAAC;;;;;;;ACLzB,CAGiD;AAEjD,KAAamb,UAAU;;;GAWtB,oBAAYC,OAA8B,EAC1C;KAAA;KAAA,wCAVa,EAAE;KAAA,4CACEpb,cAAc,CAACqb,OAAO;KAAA,8CAEnBtY,SAAS;KAAA,2CACN,EAAE;KAAA,4CACD,EAAE;KAAAxJ;OAAA;OAAA,OACP,CAAC;;KAAC,oDACImgB,cAAc,CAACqB,OAAO;KAI9C,IAAIjiB,cAAI,CAACU,OAAO,CAAC4hB,OAAO,CAAC,EACzB;OAAA,6CACqBA,OAAO;SAAA;OAAA;SAA3B,oDACA;WAAA,IADWE,KAAK;WAEf,IAAI,CAACC,QAAQ,CAACD,KAAK,CAAC;;;SACpB;;SAAA;;;;GAEF;KAAA;KAAA,yBAEQA,KAAoB,EAC7B;OACC,IAAI,CAACE,EAAE,GAAGF,KAAK,CAAC/f,IAAI;OAEpB,IAAI,sCAAI,cAAY+f,KAAK,CAACE,EAAE,EAC5B;SACC,sCAAI,YAAYF,KAAK,CAACE,EAAE;SACxB,IAAI,CAAClT,QAAQ,GAAGgT,KAAK,CAACG,QAAQ;SAC9B,IAAI,CAACC,cAAc,GAAGJ,KAAK,CAACI,cAAc;SAE1C,IAAIJ,KAAK,CAACpX,IAAI,KAAKyV,gCAAa,CAACQ,mBAAmB,EACpD;WACC,IAAI,CAAChc,MAAM,GAAG6B,cAAc,CAACC,SAAS;UACtC,MAED;WACC,IAAI,CAAC9B,MAAM,GAAG6B,cAAc,CAACgb,OAAO;;;OAItC,IAAIM,KAAK,CAACpX,IAAI,KAAKyV,gCAAa,CAACc,mBAAmB,EACpD;SACC,IAAI,CAACkB,MAAM,CAAC/hB,IAAI,CAAC0hB,KAAK,CAACM,IAAI,CAAC;QAC5B,MACI,IAAIN,KAAK,CAACpX,IAAI,KAAKyV,gCAAa,CAACW,oBAAoB,EAC1D;SACC,IAAI,CAACuB,KAAK,CAACjiB,IAAI,CAAC0hB,KAAK,CAACM,IAAI,CAAC;;;;GAE5B;CAAA;;KCpDWE,YAAY;CAIxB;;CAGA,sBAAYR,KAAoB,EAChC;GAAA;GAAA,wCANa,EAAE;GAAA,4CACEtb,cAAc,CAACC,SAAS;GAAA,8CAErB8C,SAAS;GAI5B,IAAIuY,KAAK,CAACS,cAAc,EAAE,EAC1B;KACC,IAAI,CAACP,EAAE,GAAGF,KAAK,CAACM,IAAI;KACpB,IAAI,CAACtT,QAAQ,GAAGgT,KAAK,CAACG,QAAQ;;CAEhC,CAAC;;;;ACjBF,CAEmD;CAAA;AAEnD,KAAaO,oBAAoB;GAchC,gCACA;KAAA;KAAAziB;OAAA;OAAA,OAbmB;SAClBiiB,EAAE,EAAE7B,aAAa,CAACM,qBAAqB;SACvCgC,UAAU,EAAE,EAAE;SACd/X,IAAI,EAAEyV,aAAa,CAACO,qBAAqB;SACzC3e,IAAI,EAAE,EAAE;SACRgF,KAAK,EAAE,EAAE;SACTkb,QAAQ,EAAE,EAAE;SACZG,IAAI,EAAE,EAAE;SACRF,cAAc,EAAEhC,cAAc,CAACqB;;;KAC/BxhB;OAAA;OAAA;;KAKA,sCAAI,oDAAkB,IAAI;;GAC1B;KAAA;KAAA,4BAEW2iB,QAA6B,EACzC;OACC,sCAAI,kBAAkBC,MAAM,CAACC,MAAM,CAAC,EAAE,oCAAE,IAAI,oBAAkB;OAC9DF,QAAQ,GAAGC,MAAM,CAACC,MAAM,CAAC,EAAE,EAAEF,QAAQ,CAAC;OAEtC,IAAIpjB,cAAI,CAACkb,cAAc,CAACkI,QAAQ,CAAC,IAAI,CAAC,CAAC,EACvC;SACCA,QAAQ,CAAC,IAAI,CAAC,GAAGvG,QAAQ,CAACuG,QAAQ,CAAC,IAAI,CAAC,CAAC;;OAE1C,IAAIpjB,cAAI,CAACkb,cAAc,CAACkI,QAAQ,CAAC,MAAM,CAAC,CAAC,EACzC;SACCA,QAAQ,CAAC,MAAM,CAAC,GAAGvG,QAAQ,CAACuG,QAAQ,CAAC,MAAM,CAAC,CAAC;;OAG9C,IAAIpjB,cAAI,CAACujB,QAAQ,CAACH,QAAQ,CAAC,IAAI,CAAC,CAAC,EACjC;SACC,sCAAI,kBAAgBV,EAAE,GAAGU,QAAQ,CAAC,IAAI,CAAC;;OAExC,IAAIpjB,cAAI,CAACkb,cAAc,CAACkI,QAAQ,CAAC,aAAa,CAAC,CAAC,EAChD;SACC,sCAAI,kBAAgBD,UAAU,GAAGC,QAAQ,CAAC,aAAa,CAAC;;OAEzD,IAAIpjB,cAAI,CAACujB,QAAQ,CAACH,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAIvC,aAAa,CAAC2C,mBAAmB,CAACJ,QAAQ,CAAC,MAAM,CAAC,CAAC,EAC1F;SACC,sCAAI,kBAAgBhY,IAAI,GAAGgY,QAAQ,CAAC,MAAM,CAAC;;OAE5C,IAAIpjB,cAAI,CAACkb,cAAc,CAACkI,QAAQ,CAAC,UAAU,CAAC,CAAC,EAC7C;SACC,sCAAI,kBAAgBT,QAAQ,GAAGS,QAAQ,CAAC,UAAU,CAAC;;OAEpD,IAAIpjB,cAAI,CAACujB,QAAQ,CAACH,QAAQ,CAAC,iBAAiB,CAAC,CAAC,IAAIvC,aAAa,CAAC4C,qBAAqB,CAACL,QAAQ,CAAC,iBAAiB,CAAC,CAAC,EAClH;SACC,sCAAI,kBAAgBR,cAAc,GAAGQ,QAAQ,CAAC,iBAAiB,CAAC;;OAGjE,sCAAI,kBAAgB3gB,IAAI,GAAG0C,MAAM,CAACie,QAAQ,CAAC,aAAa,CAAC,CAAC;OAC1D,sCAAI,kBAAgB3b,KAAK,GAAGtC,MAAM,CAACie,QAAQ,CAAC,cAAc,CAAC,CAAC;OAC5D,sCAAI,kBAAgBN,IAAI,GAAG3d,MAAM,CAACie,QAAQ,CAAC,aAAa,CAAC,CAAC;OAE1D,OAAO,IAAI;;;KACX;KAAA,0BAES/d,MAAc,EACxB;OACC,sCAAI,kBAAgBA,MAAM,GAAGA,MAAM;OAEnC,OAAO,IAAI;;;KACX;KAAA,wBAGD;OACC,IAAMmd,KAAK,GAAG,IAAI3B,aAAa,EAAE;OAEjC2B,KAAK,CAACE,EAAE,GAAG,sCAAI,kBAAgBA,EAAE;OACjCF,KAAK,CAACW,UAAU,GAAG,sCAAI,kBAAgBA,UAAU;OACjDX,KAAK,CAACpX,IAAI,GAAG,sCAAI,kBAAgBA,IAAI;OACrCoX,KAAK,CAAC/f,IAAI,GAAG,sCAAI,kBAAgBA,IAAI;OACrC+f,KAAK,CAAC/a,KAAK,GAAG,sCAAI,kBAAgBA,KAAK;OACvC+a,KAAK,CAACM,IAAI,GAAG,sCAAI,kBAAgBA,IAAI;OACrCN,KAAK,CAACG,QAAQ,GAAG,sCAAI,kBAAgBA,QAAQ;OAC7CH,KAAK,CAACI,cAAc,GAAG,sCAAI,kBAAgBA,cAAc;OAEzD,OAAOJ,KAAK;;;GACZ;CAAA;;;;;;;ACtFF,CAeC;CAAA;CAAA;CAAA;AAED,KAAakB,OAAO;GAQnB,iBAAYngB,QAAmB,EAAE8Q,OAAe,EAChD;KAAA;KAAA5T;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KACC,sCAAI,YAAY4T,OAAO;KACvB,sCAAI,aAAa9Q,QAAQ;;GACzB;KAAA;KAAA,qBAEIsC,GAAG,EACR;OACC,sCAAI,gBAAgB,EAAE;OACtB,sCAAI,cAAc,EAAE;OAEpB,IAAI,CAAC8d,OAAO,CAAC9d,GAAG,CAAC;;;KACjB;KAAA,uBAEMA,GAAG,EACV;OACC,IAAI,CAAC+C,IAAI,CAAC/C,GAAG,CAAC;;;KACd;KAAA,wBAEOA,GAA+C,EACvD;OACC,IAAI,CAAC7F,cAAI,CAACuC,aAAa,CAACsD,GAAG,CAAC,EAC5B;SACCA,GAAG,GAAG,EAAE;;OAGT,IAAM+d,eAAe,GAAG,IAAIV,oBAAoB,EAAE;OAElD,mCAAkCG,MAAM,CAACf,OAAO,CAACzc,GAAG,CAAC,qCACrD;SADK;WAAOgG,QAAQ;WAAEyW,OAAO;SAE5B,IAAI,CAACtiB,cAAI,CAACU,OAAO,CAAC4hB,OAAO,CAAC,EAC1B;WACC;;SACA,6CAEsBA,OAAO;WAAA;SAAA;WAA9B,oDACA;aAAA,IADWuB,QAAQ;aAElB,IAAMrB,KAAK,GAAGoB,eAAe,CAACE,WAAW,CAACD,QAAQ,CAAC,CAACE,KAAK,EAAE;aAE3D,IAAIvB,KAAK,CAACS,cAAc,EAAE,EAC1B;eACC,IAAI,CAACe,eAAe,CAACxB,KAAK,CAAC;cAC3B,MAED;eACC,IAAI,CAACyB,aAAa,CAACzB,KAAK,CAAC;eACzB,IAAM0B,UAAU,GAAG,sCAAI,cAAY1B,KAAK,CAAC/f,IAAI,CAAC;eAE9C,IAAI,CAACzC,cAAI,CAACC,KAAK,mCAAC,IAAI,aAAW,EAC/B;iBACC,IAAMkkB,cAAc,GAAID,UAAU,CAAC7e,MAAM,KAAK6B,cAAc,CAACgb,OAAQ;iBACrE,IAAMkC,mBAAmB,GACvBF,UAAU,CAACtB,cAAc,KAAKhC,cAAc,CAACzZ,SAAU;iBAEzD,IAAMkd,eAAe,GAAI,sCAAI,aAAWjJ,kBAAkB,EAAE,KAAKvP,QAAS;iBAE1E,IAAMyY,6BAA6B,GAAGH,cAAc,IAAI,CAACE,eAAe;iBACxE,IAAME,yCAAyC,GAC9CJ,cAAc,IAAIC,mBAAmB,IAAIC,eAAe;iBAGzD,IAAIC,6BAA6B,IAAIC,yCAAyC,EAC9E;mBACCL,UAAU,CAAC7e,MAAM,GAAG6B,cAAc,CAACC,SAAS;;;;;;WAI/C;;WAAA;;;;;KAEF;KAAA,gCAEeqb,KAAoB,EACpC;OACC,IAAIA,KAAK,CAACS,cAAc,EAAE,EAC1B;SACC,sCAAI,gBAAcT,KAAK,CAACM,IAAI,CAAC,GAAG,IAAIE,YAAY,CAACR,KAAK,CAAC;;;;KAExD;KAAA,8BAEaA,KAAoB,EAClC;OACC,IAAIA,KAAK,CAACS,cAAc,EAAE,EAC1B;SACC;;OAGD,IAAI,CAAC,sCAAI,cAAYT,KAAK,CAAC/f,IAAI,CAAC,EAChC;SACC,sCAAI,cAAY+f,KAAK,CAAC/f,IAAI,CAAC,GAAG,IAAI4f,UAAU,CAAC,CAACG,KAAK,CAAC,CAAC;QACrD,MAED;SACC,sCAAI,cAAYA,KAAK,CAAC/f,IAAI,CAAC,CAACggB,QAAQ,CAACD,KAAK,CAAC;;;;KAE5C;KAAA,4BAEWE,EAAU,EACtB;OACC,OAAO,sCAAI,cAAYA,EAAE,CAAC,IAAI,IAAI;;;KAClC;KAAA,8BAEaA,EAAU,EACxB;OACC,OAAO,sCAAI,gBAAcA,EAAE,CAAC,IAAI,IAAI;;;KACpC;KAAA,uBAEM8B,cAAsB,EAC7B;OAAA;OACC,OAAOnb,EAAE,CAAC2I,IAAI,CAAC;SACdkC,MAAM,EAAE,MAAM;SACdC,QAAQ,EAAE,MAAM;SAChBC,GAAG,oCAAE,IAAI,WAAS;SAClBnR,IAAI,EAAE;WACLqR,WAAW,EAAE,SAAS;WACtBC,eAAe,EAAEiQ;UACjB;SACD/P,SAAS,EAAE,mBAACC,QAAQ,EAAK;WACxB,IAAIA,QAAQ,CAAC+P,IAAI,IAAI/P,QAAQ,CAAC+P,IAAI,CAACC,GAAG,EACtC;aACC,KAAI,CAAClS,MAAM,CAACkC,QAAQ,CAAC+P,IAAI,CAACC,GAAG,CAAC;;;QAGhC,CAAC;;;GACF;CAAA;;;;;;;;;ACpJF,CASiD;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEjD,KAAaC,KAAK;GAAA;GAgBjB,eAAYjJ,MAKX,EACD;KAAA;KAAA;KACC;KAAQ,oGArBmB,yIAAyI;KAAAjb;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAsBpK,MAAK6B,iBAAiB,CAAC,uBAAuB,CAAC;KAE/C,0FAAiBoZ,MAAM,CAACnY,QAAQ;KAChC,IAAI,CAACvD,cAAI,CAACC,KAAK,CAACyb,MAAM,CAAC9E,QAAQ,CAAC,EAChC;OACC,wFAAiB8E,MAAM,CAAC9E,QAAQ;;KAEjC,2FAAoB8E,MAAM,CAACkJ,WAAW;KACtC,0FAAiBzgB,QAAQ,CAACI,IAAI,EAAE;KAChC,uFAAgBmX,MAAM,CAACxX,OAAO;KAC9B,uFAAgB,KAAK;KAErB,qFAAc,IAAIuX,aAAa,EAAE;KAAC;;GAClC;KAAA;KAAA,8BAgCD;OACC,OAAO,CAACzb,cAAI,CAACC,KAAK,mCAAC,IAAI,aAAW;;;KAClC;KAAA,8BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,8BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,wBAaD;OACC,IAAM4kB,WAAW,GAAG,IAAIF,KAAK,CAAC;SAC7BphB,QAAQ,oCAAE,IAAI,cAAU;SACxBqT,QAAQ,oCAAE,IAAI,YAAU;SACxBgO,WAAW,oCAAE,IAAI,eAAa;SAC9B1gB,OAAO,oCAAE,IAAI;QACb,CAAC;OAEF,IAAM4gB,SAAS,uCACXzb,EAAE,CAAC7G,KAAK,mCAAC,IAAI,WAAO;SACvBkT,IAAI,EAAEiP,KAAK,CAACI,YAAY,EAAE;SAC1BC,KAAK,EAAE,IAAI,CAACC,gBAAgB,EAAE,CAAC5c,SAAS,EAAE;SAC1CzD,SAAS,EAAE,IAAI,CAACgO,YAAY,EAAE,CAACvK,SAAS;SACxC;OACDwc,WAAW,CAACjc,IAAI,CAACkc,SAAS,oCAAE,IAAI,eAAW;OAE3C,OAAOD,WAAW;;;KAClB;KAAA,wBAEOK,KAAY,EACpB;OACC,OAAO,sCAAI,WAAOxP,IAAI,KAAK,kCAAAwP,KAAK,WAAOxP,IAAI;;;KAC3C;KAAA,qBAEIzS,IAAY,EAAE0B,QAAmB,EACtC;OACC,IAAI3E,cAAI,CAACuC,aAAa,CAACU,IAAI,CAAC,EAC5B;SACC,sCAAI,WAASogB,MAAM,CAACC,MAAM,CAAC,EAAE,EAAErgB,IAAI,CAAC;;OAErC,IAAI,CAAC,sCAAI,WAAOyS,IAAI,EACpB;SACC,sCAAI,WAAOA,IAAI,GAAGiP,KAAK,CAACI,YAAY,EAAE;;OAGvC,sCAAI,UAAU,IAAItJ,aAAa,CAAC,sCAAI,WAAOuJ,KAAK,CAAC;OACjD,sCAAI,gBAAc,IAAItgB,iCAAc,CAAC,sCAAI,WAAOE,SAAS,CAAC;OAC1D,IAAI,CAAC,sCAAI,WAAOA,SAAS,EACzB;SACC,sCAAI,gBAAYwG,IAAI,GAAG1G,iCAAc,CAACygB,cAAc,CAACC,KAAK;;OAG3D,OAAO,sCAAI,WAAOxgB,SAAS;OAC3B,OAAO,sCAAI,WAAOogB,KAAK;OAEvB,sCAAI,eAAahlB,cAAI,CAACC,KAAK,CAAC0E,QAAQ,CAAC,GAAGR,QAAQ,CAACU,IAAI,EAAE,GAAGF,QAAQ;OAClE,IAAI,CAAC,sCAAI,eAAW+I,MAAM,EAAE,EAC5B;SACC,sCAAI,WAAS,IAAI,CAAC5I,UAAU,EAAE;;;;KAE/B;KAAA,uBAEM7B,IAAY,EAAE0B,QAAmB,EACxC;OACC,IAAI3E,cAAI,CAACC,KAAK,CAAC0E,QAAQ,CAAC,IAAI,sCAAI,eAAW+I,MAAM,EAAE,EACnD;SACC;;OAGD,IAAM3I,IAAI,qCAAG,IAAI,UAAM;OACvB,sCAAI,WAAS,IAAI,CAACD,UAAU,EAAE;OAC9B,IAAIC,IAAI,CAACC,UAAU,EACnB;SACCD,IAAI,CAACC,UAAU,CAACC,YAAY,mCAAC,IAAI,YAAQF,IAAI,CAAC;;;;KAE/C;KAAA,0BAGD;OACCwB,aAAG,CAAC4E,MAAM,mCAAC,IAAI,WAAO;OACtB,IAAI,CAACvI,IAAI,CAAC,iBAAiB,CAAC;;;KAC5B;KAAA,0BAGD;OACC,OAAO,sCAAI,aAAWqB,OAAO,EAAE;;;KAC/B;KAAA,gCAGD;OACC,IAAI,sCAAI,cAAUjE,cAAI,CAACuC,aAAa,CAAC,sCAAI,WAAOkK,UAAU,CAAC,EAC3D;SACC,OAAO,sCAAI,WAAOA,UAAU;;OAG7B,OAAO,EAAE;;;KACT;KAAA,4BAEWhK,IAAY,EACxB;OACC,OAAO,IAAI,CAAC4iB,aAAa,EAAE,CAAC5iB,IAAI,CAAC,IAAI,IAAI;;;KACzC;KAAA,4BAEWA,IAAY,EACxB;OACC,OAAO,IAAI,CAAC4iB,aAAa,EAAE,CAACxiB,cAAc,CAACJ,IAAI,CAAC;;;KAChD;KAAA,4BAEWA,IAAY,EAAEC,KAAU,EACpC;OACC,sCAAI,WAAO+J,UAAU,CAAChK,IAAI,CAAC,GAAGC,KAAK;OAEnC,OAAO,IAAI;;;KACX;KAAA,wBAGD;OACC,OAAO,sCAAI,WAAOgT,IAAI,IAAI,IAAI;;;KAC9B;KAAA,+BAGD;OACC,IAAIrQ,MAAM,GAAG6B,cAAc,CAACqb,OAAO;OACnC,IAAI1c,GAAG,GAAG,sCAAI,YAAUyf,WAAW,CAAC,IAAI,CAACvf,KAAK,EAAE,CAAC;OAEjD,IAAIF,GAAG,EACP;SACCR,MAAM,GAAGQ,GAAG,CAACR,MAAM;QACnB,MACI,IAAI,sCAAI,WAAOkgB,SAAS,EAC7B;SACC1f,GAAG,GAAG,sCAAI,YAAUyf,WAAW,CAAC,sCAAI,WAAOC,SAAS,CAAC;SACrD,IAAI1f,GAAG,IAAIA,GAAG,CAACR,MAAM,KAAK6B,cAAc,CAACgb,OAAO,EAChD;WACC7c,MAAM,GAAG6B,cAAc,CAACgb,OAAO;;;OAIjC,OAAO7c,MAAM;;;KACb;KAAA,+BAGD;OACC,IAAIwd,MAAM,GAAG,EAAE;OACf,IAAMhd,GAAG,GAAG,sCAAI,YAAUyf,WAAW,CAAC,IAAI,CAACvf,KAAK,EAAE,CAAC;OACnD,IAAIF,GAAG,IAAIA,GAAG,CAACgd,MAAM,EACrB;SACCA,MAAM,GAAGhd,GAAG,CAACgd,MAAM;;OAGpB,OAAOA,MAAM;;;KACb;KAAA,gCAGD;OACC,IAAI,sCAAI,WAAO0C,SAAS,EACxB;SACC,IAAM1f,GAAG,GAAG,sCAAI,YAAUyf,WAAW,CAAC,sCAAI,WAAOC,SAAS,CAAC;SAC3D,IAAI1f,GAAG,IAAIA,GAAG,CAACR,MAAM,KAAK6B,cAAc,CAACgb,OAAO,EAChD;WACC,OAAOrc,GAAG,CAACkd,KAAK;;;OAIlB,OAAO,EAAE;;;KACT;KAAA,6BAGD;OACC,sCAAI,IAAI,YACR;SACCxc,aAAG,CAACoI,QAAQ,mCAAC,IAAI,YAAQ,YAAY,CAAC;SACtC,IAAI,CAAC/L,IAAI,CAAC,gBAAgB,CAAC;;;;KAE5B;KAAA,+BAGD;OACC,sCAAI,IAAI,YACR;SACC2D,aAAG,CAACsI,WAAW,mCAAC,IAAI,YAAQ,YAAY,CAAC;SACzC,IAAI,CAACjM,IAAI,CAAC,kBAAkB,CAAC;;;;KAE9B;KAAA,6BAGD;OACC,OAAO,sCAAI,cAAU2D,aAAG,CAACif,QAAQ,mCAAC,IAAI,YAAQ,YAAY,CAAC;;;KAC3D;KAAA,iCAEgBC,QAAiB,EAClC;OAAA;OACC,sCAAI,eAAathB,QAAQ,CAACqK,MAAM,EAAE,CAACkX,WAAW,CAAC,UAAU,EAAED,QAAQ,CAAC;OAEpE,IAAI,CAACA,QAAQ,EACb;SACClf,aAAG,CAACoI,QAAQ,mCAAC,IAAI,YAAQ,eAAe,CAAC;;OAG1C,IAAMgX,YAAY,GAAG,sCAAI,WAAOra,aAAa,CAAC,sCAAsC,CAAC;OACrF/E,aAAG,CAACmI,IAAI,CAACiX,YAAY,CAAC;OAEtB,sCAAI,WAAO1L,OAAO,GAAG,YAAM;SAC1B,IAAI,CAAC,wCAAI,eAAW/R,QAAQ,EAAE,IAAI,CAAC,wCAAI,eAAW4O,WAAW,CAAC,UAAU,EAAE,KAAK,CAAC,EAChF;WACC;;SAGD,IAAI,CAAC,MAAI,CAAC8O,UAAU,EAAE,EACtB;WACC,MAAI,CAACC,UAAU,EAAE;UACjB,MAED;WACC,MAAI,CAACC,YAAY,EAAE;;QAEpB;;;KACD;KAAA,oCAGD;OACC,sCAAI,eAAa3hB,QAAQ,CAACU,IAAI,EAAE;OAChC,IAAI,CAACihB,YAAY,EAAE;OACnBvf,aAAG,CAACsI,WAAW,mCAAC,IAAI,YAAQ,eAAe,CAAC;OAE5C,IAAM8W,YAAY,GAAG,sCAAI,WAAOra,aAAa,CAAC,sCAAsC,CAAC;OACrF/E,aAAG,CAACqI,IAAI,CAAC+W,YAAY,CAAC;OAEtB,sCAAI,WAAO1L,OAAO,GAAGhQ,SAAS;;;KAC9B;KAAA,6BAGD;OAAA;OACC,IAAI9D,YAAY,GAAG,4CAA4C;OAC/D,IAAImB,cAAc,GAAG,oCAAoC;OAEzD,IAAI,sCAAI,eAAWlB,MAAM,EAAE,IAAI,IAAI,CAACnC,OAAO,EAAE,EAC7C;SACCkC,YAAY,IAAI,uDAAuD;;OAExE,IAAI,IAAI,CAAC1B,KAAK,EACd;SACC6C,cAAc,IAAI,UAAU;;OAG7B,IAAMye,WAAW,GAAGnf,aAAG,CAACC,UAAU,CAAC,2BAA2B,CAAC;OAC/D,IAAM8S,UAAU,GAAGpT,aAAG,CAACC,MAAM,CAAC,GAAG,EAAE;SAClCC,KAAK,EAAE;WACNC,SAAS,EAAE,yCAAyC,IAAI,sCAAI,eAAWsf,MAAM,EAAE,GAAG,aAAa,GAAG,EAAE,CAAC;WACrGve,KAAK,EAAEb,aAAG,CAACC,UAAU,CAAC,sCAAsC;UAC5D;SACDF,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,sCAAsC;QAC3D,CAAC;OAEF,IAAI7G,cAAI,CAACuC,aAAa,CAAC,sCAAI,WAAO0jB,QAAQ,CAAC,IAAI,sCAAI,WAAOA,QAAQ,CAACC,gBAAgB,EACnF;SACC,IAAIC,SAAS,GACZ,sCAAI,WAAOF,QAAQ,CAACC,gBAAgB,CAClCnO,OAAO,CAAC,4BAA4B,EAAEnR,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC,CAAC,CAC3FkR,OAAO,CAAC,QAAQ,EAAEnR,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC,CAAC,CACvEkR,OAAO,CAAC,+BAA+B,EAAEnR,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC,CAAC,CAC3FkR,OAAO,CAAC,4BAA4B,EAAEnR,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC,CAAC,CACxFkR,OAAO,CAAC,gCAAgC,EAAEnR,aAAG,CAACC,UAAU,CAAC,kCAAkC,CAAC,CAAC,CAC7FkR,OAAO,CAAC,8BAA8B,EAAEnR,aAAG,CAACC,UAAU,CAAC,kCAAkC,CAAC,CAAC;SAG9F,IAAIsf,SAAS,CAACjd,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,EACxC;WACC,sCAAI,eAAW6J,SAAS,EAAE,CAACpS,OAAO,CAAC,UAAAqM,KAAK,EAAI;aAC3CmZ,SAAS,GAAGA,SAAS,CAACpO,OAAO,CAAC/K,KAAK,CAAC,kBAAkB,CAAC,EAAEA,KAAK,CAAC,MAAM,CAAC,CAAC;YACvE,CAAC;;SAGH,IAAImZ,SAAS,CAACjd,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,EACjC;WACC,sCAAI,aAAW2N,MAAM,CAAClW,OAAO,CAAC,UAAAyM,KAAK,EAAI;aACtCA,KAAK,CAACgZ,0BAA0B,EAAE,CAACzlB,OAAO,CAAC,UAAAqM,KAAK,EAAI;eACnD,IAAIA,KAAK,CAAC,MAAM,CAAC,KAAK,MAAM,EAC5B;iBACCmZ,SAAS,GAAGA,SAAS,CAACpO,OAAO,CAC5B/K,KAAK,CAAC,kBAAkB,CAAC,EACzBI,KAAK,CAACiZ,QAAQ,EAAE,GAAG,IAAI,GAAGrZ,KAAK,CAAC,MAAM,CAAC,CACvC;;cAEF,CAAC;YACF,CAAC;;SAGH,IAAImZ,SAAS,CAACjd,OAAO,CAAC,cAAc,CAAC,IAAI,CAAC,IAAIlJ,cAAI,CAACwb,aAAa,CAAC,sCAAI,aAAW8K,eAAe,CAAC,EAChG;WACC,sCAAI,aAAWA,eAAe,CAAC3lB,OAAO,CAAC,UAAA4lB,QAAQ,EAAI;aAClDJ,SAAS,GAAGA,SAAS,CAACpO,OAAO,CAACwO,QAAQ,CAAC1Q,gBAAgB,EAAE0Q,QAAQ,CAAC7Q,IAAI,CAAC;YACvE,CAAC;;SAGH,IAAIyQ,SAAS,CAACjd,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAIlJ,cAAI,CAACwb,aAAa,CAAC,sCAAI,aAAWgL,eAAe,CAAC,EAClG;WACC,sCAAI,aAAWA,eAAe,CAAC7lB,OAAO,CAAC,UAAA8lB,QAAQ,EAAI;aAClDN,SAAS,GAAGA,SAAS,CAACpO,OAAO,CAAC0O,QAAQ,CAAC5Q,gBAAgB,EAAE4Q,QAAQ,CAAC/Q,IAAI,CAAC;YACvE,CAAC;;SAGHiE,UAAU,CAAC+M,WAAW,GAAGP,SAAS;SAClCxM,UAAU,CAACgN,YAAY,CAAC,OAAO,EAAER,SAAS,CAAC;SAE3C,IAAI,sCAAI,WAAOF,QAAQ,CAACW,cAAc,EACtC;WACCjN,UAAU,CAACkN,IAAI,GAAG,sCAAI,WAAOZ,QAAQ,CAACW,cAAc;WACpD,sCAAI,IAAI,iBACR;aACCjN,UAAU,CAACgN,YAAY,CAAC,QAAQ,EAAE,QAAQ,CAAC;;;SAI7C,IAAI,sCAAI,eAAWvgB,MAAM,EAAE,IAAIyW,QAAQ,CAAC,sCAAI,WAAOoJ,QAAQ,CAACa,aAAa,CAAC,GAAG,CAAC,EAC9E;WACCnN,UAAU,CAACgN,YAAY,CAAC,oBAAoB,EAAE,sCAAI,WAAOV,QAAQ,CAACa,aAAa,CAAC;;;OAIlF,IAAIC,UAAU,GAAG,IAAI,CAAC9B,gBAAgB,EAAE,CAAC+B,MAAM,CAC9CpgB,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC,EAChD,sCAAI,eAAWkM,SAAS,EAAE,CAC1B;OAED,IAAI,IAAI,CAACkU,sBAAsB,EAAE,EACjC;SACCF,UAAU,GAAIA,UAAU,KAAKngB,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC,GAAIkgB,UAAU,GAAG,IAAI,GAAG,EAAE;SACvGA,UAAU,IAAIngB,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;;OAGtE,IAAI,IAAI,CAAC+L,YAAY,EAAE,CAACxG,KAAK,CAACC,MAAM,GAAG,CAAC,EACxC;SACC0a,UAAU,IAAI,IAAI,GAAGngB,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;;OAG3E,IAAMqgB,SAAS,GAAG3gB,aAAG,CAACC,MAAM,CAC3B,sCAAI,eAAWJ,MAAM,EAAE,GAAG,GAAG,GAAG,MAAM,EACtC;SACCK,KAAK,EAAE;WACNC,SAAS,EAAE,sCAAI,eAAWN,MAAM,EAAE,GAAG,+BAA+B,GAAG,+BAA+B;WACtGqB,KAAK,EAAEsf;UACP;SACDpgB,IAAI,EAAEogB;QACN,CACD;OAED,IAAMI,UAAU,GAAG5gB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACpCC,KAAK,EAAE;WACNC,SAAS,EAAE;;QAEZ,CAAC;OACF,IAAI,CAAC0gB,aAAa,CAAC,iBAAiB,EAAE,YAAM;SAC3C,IAAIpf,QAAQ,CAACqf,cAAc,CAACF,UAAU,CAAC,EACvC;WACCnf,QAAQ,CAACyX,QAAQ,EAAE;;QAEpB,CAAC;OAEF,QAAQ,IAAI,CAACxY,YAAY,EAAE;SAE1B,KAAKC,cAAc,CAACgb,OAAO;WAC1B,IAAI,sCAAI,eAAW9G,kBAAkB,EAAE,KAAK,sCAAI,aAAW7V,WAAW,EAAE,EACxE;aACC4hB,UAAU,CAACxc,SAAS,CAAC1I,GAAG,CAAC,UAAU,CAAC;aAEpC,IAAMqlB,UAAU,GAAG,IAAI,CAACC,aAAa,EAAE;aACvC,IAAID,UAAU,CAACjb,MAAM,EACrB;eACC8a,UAAU,CAACR,YAAY,CAAC,WAAW,EAAEW,UAAU,CAACtI,IAAI,CAAC,IAAI,CAAC,CAAC;eAC3DhX,QAAQ,CAACuX,UAAU,CAAC4H,UAAU,CAAC;;;WAGjC;SACD,KAAKjgB,cAAc,CAACC,SAAS;SAC7B,KAAKD,cAAc,CAACsgB,aAAa;WAChClgB,cAAc,IAAI,aAAa;WAC/B6f,UAAU,CAACxc,SAAS,CAAC1I,GAAG,CAAC,YAAY,CAAC;WACtC;;OAGF,IAAM4gB,MAAM,GAAG,IAAI,CAAC4E,YAAY,EAAE;OAClC,IAAI5E,MAAM,CAACxW,MAAM,GAAG,CAAC,EACrB;SACC8a,UAAU,CAACxc,SAAS,CAAC1I,GAAG,CAAC,UAAU,CAAC;SACpCklB,UAAU,CAACR,YAAY,CAAC,WAAW,EAAE9D,MAAM,CAAC7D,IAAI,CAAC,IAAI,CAAC,CAAC;SACvDhX,QAAQ,CAACuX,UAAU,CAAC4H,UAAU,CAAC;;OAGhC,IAAIO,cAAc,GAAG,qCAAqC;OAC1D,IAAI,sCAAI,eAAWthB,MAAM,EAAE,IAAI,IAAI,CAACnC,OAAO,EAAE,EAC7C;SACCyjB,cAAc,IAAI,+CAA+C;;OAGlE,IAAMngB,GAAG,GAAGhB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAC7BC,KAAK,EAAE;WACNC,SAAS,EAAEY,cAAc;WACzB,WAAW,EAAE,iBAAiB;WAC9B,WAAW,EAAE,YAAY;WACzB,SAAS,EAAE,IAAI,CAACvB,KAAK;UACrB;SACDyB,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBpD,KAAK,EAAE;aACNsD,SAAS,EAAE;;UAEZ,CAAC,EACFH,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aACNC,SAAS,EAAEP;YACX;WACDqB,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAAEC,SAAS,EAAE;cAAqC;aACzDc,QAAQ,EAAE,CAAC0f,SAAS;YACpB,CAAC,EACF3gB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eACNC,SAAS,EAAE;cACX;aACDc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eACjBC,KAAK,EAAE;iBACNC,SAAS,EAAEghB,cAAc;iBACzBjgB,KAAK,EAAE,IAAI,CAAC4e,QAAQ;gBACpB;eACDlG,IAAI,EAAE,IAAI,CAACwH,SAAS,CAAC,IAAI,CAACtB,QAAQ,EAAE,CAAC;eACrClW,MAAM,EAAE;iBACPC,KAAK,EAAE,eAAApN,KAAK,EAAI;mBACf,IAAI,wCAAI,eAAWoD,MAAM,EAAE,IAAI,MAAI,CAACnC,OAAO,EAAE,IAAI,CAAC,wCAAI,eAAWiE,QAAQ,EAAE,EAC3E;qBACC,MAAI,CAAC0f,gBAAgB,CAAC5kB,KAAK,CAAC;;;;cAI/B,CAAC;YAEH,CAAC,EACFuD,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAAEC,SAAS,EAAE;cAAqC;aACzDc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eACjBC,KAAK,EAAE;iBAAEC,SAAS,EAAE;gBAA2C;eAC/DC,IAAI,EAAEof,WAAW,GAAG;cACpB,CAAC,EACFpM,UAAU;YAEX,CAAC,EACFwN,UAAU;UAEX,CAAC;QAEH,CAAC;OAEF,IAAI,IAAI,CAACljB,OAAO,EAAE,EAClB;SACC,IAAI,CAACyD,YAAY,CAACH,GAAG,CAAC;;OAGvB,IAAI,sCAAI,eAAWnB,MAAM,EAAE,EAC3B;SACC,IAAMuB,SAAS,GAAGpB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WACpCC,KAAK,EAAE;aACNC,SAAS,EAAE;;UAEZ,CAAC;SACFI,eAAK,CAACC,IAAI,CAACY,SAAS,EAAE,OAAO,EAAE,IAAI,CAACC,mBAAmB,CAACb,IAAI,CAAC,IAAI,EAAEY,SAAS,CAAC,CAAC;SAC9EJ,GAAG,CAACsgB,SAAS,CAAChgB,WAAW,CAACF,SAAS,CAAC;SAEpC,IAAMrB,OAAO,GAAGC,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjCC,KAAK,EAAE;aACNC,SAAS,EAAE;YACX;WACDC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC,IAAI;UACvD,CAAC;SACFC,eAAK,CAACC,IAAI,CAACT,OAAO,EAAE,OAAO,EAAE,IAAI,CAACU,iBAAiB,CAACD,IAAI,CAAC,IAAI,EAAET,OAAO,CAAC,CAAC;SACxEiB,GAAG,CAACM,WAAW,CAACvB,OAAO,CAAC;SAExB,IAAMD,WAAW,GAAGE,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACrCC,KAAK,EAAE;aACNC,SAAS,EAAE;YACX;WACDC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,6BAA6B;UAClD,CAAC;SACFC,eAAK,CAACC,IAAI,CAACQ,GAAG,EAAE,OAAO,EAAE,IAAI,CAACO,qBAAqB,CAACf,IAAI,CAAC,IAAI,EAAEQ,GAAG,CAAC,CAAC;SAEpEA,GAAG,CAACM,WAAW,CAACxB,WAAW,CAAC;;OAG7B,OAAOkB,GAAG;;;KACV;KAAA,oCAEmBQ,MAAM,EAAE/E,KAAK,EACjC;OACCA,KAAK,CAACmF,eAAe,EAAE;OAEvB,IAAI,CAAC,IAAI,CAAClE,OAAO,EAAE,EACnB;SACC+D,QAAQ,CAACC,qBAAqB,CAACF,MAAM,CAAC;QACtC,MACI,IAAI,CAAC,sCAAI,eAAWG,QAAQ,EAAE,EACnC;SACC3B,aAAG,CAAC4E,MAAM,mCAAC,IAAI,WAAO;SACtB,sCAAI,aAAW2c,WAAW,CAAC,IAAI,CAAC;;;;KAEjC;KAAA,sCAEqB/f,MAAM,EAC5B;OACC,IAAI,CAAC,IAAI,CAAC9D,OAAO,EAAE,EACnB;SACC+D,QAAQ,CAACC,qBAAqB,CAACF,MAAM,CAAC;QACtC,MACI,IAAI,CAAC,sCAAI,eAAWG,QAAQ,EAAE,EACnC;SAAA;SACC,sCAAI,aAAW6f,uBAAuB,CAAC,IAAI,2BAAE,sCAAI,WAAOC,aAAa,yEAAI,IAAI,CAAC;;;;KAE/E;KAAA,kCAEiBjgB,MAAM,EAAE/E,KAAK,EAC/B;OACCA,KAAK,CAACmF,eAAe,EAAE;OAEvB,IAAI,CAAC,IAAI,CAAClE,OAAO,EAAE,EACnB;SACC+D,QAAQ,CAACC,qBAAqB,CAACF,MAAM,CAAC;QACtC,MACI,IAAI,CAAC,sCAAI,eAAWG,QAAQ,EAAE,EACnC;SACC,IAAM+f,WAAW,GAAG,IAAI,CAACzlB,KAAK,EAAE;SAChC,IAAM0lB,UAAU,GAAGD,WAAW,CAACnR,WAAW,CAAC,OAAO,CAAC;SACnD,IAAI,CAAC9W,cAAI,CAACC,KAAK,CAACioB,UAAU,CAAC,EAC3B;WACC,IAAMC,QAAQ,GAAGD,UAAU,GAAG,GAAG,GAAG,GAAG,GAAGthB,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;WAC/FohB,WAAW,CAACvC,WAAW,CAAC,OAAO,EAAEyC,QAAQ,CAAC;WAC1CF,WAAW,CAACzV,MAAM,EAAE;;SAGrB4V,QAAQ,CAACC,WAAW,mCAAC,IAAI,cAAYJ,WAAW,EAAE,sCAAI,aAAWK,YAAY,CAAC,IAAI,CAAC,CAAC;;;;KAErF;KAAA,iCAEgBC,CAAC,EAClB;OACCA,CAAC,CAACC,cAAc,EAAE;OAClBD,CAAC,CAACpgB,eAAe,EAAE;OAEnB,IAAM4H,QAAQ,GAAG,uCAAuC;OAExD,IAAMC,IAAI,GAAGzJ,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAC/BpD,KAAK,EAAE;WACNX,IAAI,EAAEsN;UACN;SACDtF,KAAK,EAAE;WAAC,WAAW,EAAE;;QACrB,CAAC;OAEFuF,IAAI,CAACnI,WAAW,CAACtB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SACnCC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAgG;SACpHC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC,GAAG;QAC5D,CAAC,CAAC;OAEHmJ,IAAI,CAACnI,WAAW,CAACtB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAClCC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAqC;SACzDc,QAAQ,EAAE,CAAC6B,EAAE,CAAC7C,MAAM,CAAC,OAAO,EAAE;WAC7BC,KAAK,EAAE;aACNC,SAAS,EAAE,gCAAgC;aAC3C0E,IAAI,EAAE,MAAM;aACZ3I,IAAI,EAAE,MAAM;aACZC,KAAK,EAAE,IAAI,CAAC2jB,QAAQ;;UAErB,CAAC;QACF,CAAC,CAAC;OAEH,IAAI,CAACzjB,IAAI,CAAC,uBAAuB,CAAC;OAElC,IAAMkO,IAAI,GAAG,IAAI;OACjB,IAAMjB,KAAK,GAAG,IAAIxG,EAAE,CAAC0H,WAAW,CAACrE,yBAAM,CAACsE,gBAAgB,EAAE,EAAE,IAAI,EAAE;SACjEC,QAAQ,EAAErK,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC;SAC7DqK,OAAO,EAAElB,IAAI;SACbmB,SAAS,EAAE,IAAI;SACfC,UAAU,EAAE,CAAC;SACbC,SAAS,EAAE,CAAC;SACZC,UAAU,EAAE,IAAI;SAChBC,SAAS,EAAE;WAACC,QAAQ,EAAE;UAAM;SAC5BC,OAAO,EAAE,KAAK;SACdtB,MAAM,EAAE;WACPuB,YAAY,wBAAC7B,KAAK,EAClB;aACCA,KAAK,CAAC+B,OAAO,EAAE;aACfd,IAAI,CAAClO,IAAI,CAAC,2BAA2B,CAAC;;UAEvC;SACDiP,OAAO,EAAE,CACR,IAAIxI,EAAE,CAACyI,iBAAiB,CAAC;WACxBnL,IAAI,EAAGC,aAAG,CAACC,UAAU,CAAC,qBAAqB,CAAC;WAC5CH,SAAS,EAAG,4BAA4B;WACxCyJ,MAAM,EAAG;aACRC,KAAK,mBACL;eACC,IAAMqY,QAAQ,GAAGzY,IAAI,CAAC0Y,QAAQ,CAACjmB,IAAI;eACnCqO,IAAI,CAAC4U,WAAW,CAAC,OAAO,EAAE+C,QAAQ,CAAC/lB,KAAK,CAAC;eACzCoO,IAAI,CAAC0B,MAAM,EAAE;eACb,kCAAA1B,IAAI,aAAWhD,YAAY,EAAE;eAC7B,IAAI,CAAC4E,WAAW,CAAC5C,KAAK,EAAE;;;UAG1B,CAAC,EACF,IAAIzG,EAAE,CAACoJ,qBAAqB,CAAC;WAC5B9L,IAAI,EAAGC,aAAG,CAACC,UAAU,CAAC,uBAAuB,CAAC;WAC9CH,SAAS,EAAG,iCAAiC;WAC7CyJ,MAAM,EAAG;aACRC,KAAK,mBACL;eACC,IAAI,CAACsC,WAAW,CAAC5C,KAAK,EAAE;;;UAG1B,CAAC;QAEH,CAAC;OAEFD,KAAK,CAACjB,IAAI,EAAE;;;KACZ;KAAA,yBAEQ5L,KAAK,EACd;OACC,IAAI,mCAAC,IAAI,UAAM,EACf;SACC;;OAGD,IAAM6F,KAAK,GAAG7F,KAAK,CAAC8F,OAAO,EAAE,CAACC,WAAW;OACzC,IAAMC,KAAK,GAAG,CAACH,KAAK,IAAI,IAAI,CAACwd,QAAQ,EAAE,CAACpd,WAAW,EAAE,CAACC,OAAO,CAACL,KAAK,CAAC,IAAI,CAAC;OAEzE,IAAIG,KAAK,EACT;SACCzC,aAAG,CAACsI,WAAW,mCAAC,IAAI,YAAQ,mBAAmB,CAAC;QAChD,MAED;SACCtI,aAAG,CAACoI,QAAQ,mCAAC,IAAI,YAAQ,mBAAmB,CAAC;;;;KAE9C;KAAA,0BAESga,SAAiB,EAC3B;OACC,IAAIlhB,KAAK,GAAG0P,cAAI,CAAC6C,MAAM,CAAC2O,SAAS,CAAC;OAClC,IAAMC,QAAQ,GAAGnhB,KAAK,CAACkX,KAAK,CAAC,GAAG,CAAC;OACjC,IAAMkK,QAAQ,GAAG,QAAQ,GAAGD,QAAQ,CAACA,QAAQ,CAACvc,MAAM,GAAG,CAAC,CAAC,GAAG,SAAS;OAErEuc,QAAQ,CAAC3Z,MAAM,CAAC2Z,QAAQ,CAACvc,MAAM,GAAG,CAAC,CAAC;OAEpC5E,KAAK,GAAGmhB,QAAQ,CAAC5J,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG6J,QAAQ;OAE3C,OAAOphB,KAAK;;;KACZ;KAAA,2BAEUxE,IAAI,EACf;OACC,IAAIjD,cAAI,CAACuC,aAAa,CAACU,IAAI,CAAC,EAC5B;SACC,sCAAI,WAASA,IAAI;QACjB,MAED;SACC,MAAM,cAAc;;;;KAErB;KAAA,4BAGD;OACC,IAAMmS,MAAM,GAAG/L,EAAE,CAAC7G,KAAK,mCAAC,IAAI,WAAO;OACnC,OAAO4S,MAAM,CAAC,UAAU,CAAC;OACzB,OAAOA,MAAM,CAAC,eAAe,CAAC;OAC9BA,MAAM,CAAC4P,KAAK,GAAG,sCAAI,UAAQ3c,SAAS,EAAE;OACtC+M,MAAM,CAACxQ,SAAS,GAAG,sCAAI,gBAAYyD,SAAS,EAAE;OAE9C,OAAO+M,MAAM;;;KACb;KAAA,mCAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,iCAEgB0T,KAAK,EACtB;OACC,sCAAI,UAAUA,KAAK;OAEnB,OAAO,IAAI;;;KACX;KAAA,+BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,6BAEY9iB,SAAS,EACtB;OACC,sCAAI,gBAAcA,SAAS;OAE3B,OAAO,IAAI;;;KACX;KAAA,wCAEuBC,IAAI,EAC5B;OACC,sCAAI,WAAO8iB,oBAAoB,GAAG9iB,IAAI,GAAG,CAAC,GAAG,CAAC;OAE9C,OAAO,IAAI;;;KACX;KAAA,yCAGD;OACC,OAAQ,sCAAI,WAAO8iB,oBAAoB,KAAK,CAAC,IAAI,sCAAI,WAAOA,oBAAoB,KAAK,GAAG;;;KACxF;KAAA,6BAEY5f,MAAM,EACnB;OACC,IAAInJ,cAAI,CAACC,KAAK,CAACkJ,MAAM,CAAC,UAAU,CAAC,CAAC,EAClC;SACCA,MAAM,CAACC,aAAa,GAAGC,EAAE,CAACC,KAAK,CAAC,IAAI,CAACC,SAAS,EAAE,IAAI,CAAC;SACrDJ,MAAM,CAACK,QAAQ,GAAGH,EAAE,CAACC,KAAK,CAAC,IAAI,CAACG,QAAQ,EAAE,IAAI,CAAC;SAC/CN,MAAM,CAACO,YAAY,GAAGL,EAAE,CAACC,KAAK,CAAC,IAAI,CAACK,QAAQ,EAAE,IAAI,CAAC;SACnDR,MAAM,CAACS,aAAa,GAAGP,EAAE,CAACC,KAAK,CAAC,IAAI,CAACO,QAAQ,EAAE,IAAI,CAAC;SACpDC,IAAI,CAACC,cAAc,CAACZ,MAAM,CAAC;SAC3BW,IAAI,CAACE,YAAY,CAACb,MAAM,EAAE,CAAC,CAAC;;;;KAE7B;KAAA,+BAEcA,MAAM,EACrB;OACCA,MAAM,CAACC,aAAa,GAAGa,SAAS;OAChCd,MAAM,CAACK,QAAQ,GAAGS,SAAS;OAC3Bd,MAAM,CAACO,YAAY,GAAGO,SAAS;OAC/Bd,MAAM,CAACS,aAAa,GAAGK,SAAS;OAChCH,IAAI,CAACI,gBAAgB,CAACf,MAAM,CAAC;OAC7BW,IAAI,CAACK,cAAc,CAAChB,MAAM,CAAC;;;KAC3B;KAAA,4BAGD;OACC,IAAI,CAAC6f,aAAa,GAAG3f,EAAE,CAACe,aAAa;OAErC,IAAI,CAAC,IAAI,CAAC4e,aAAa,EACvB;SACClf,IAAI,CAACO,eAAe,EAAE;SACtB;;OAGD,IAAI,CAAC,IAAI,CAAC4e,IAAI,EACd;SACC,IAAM3e,SAAS,GAAG,IAAI,CAAC0e,aAAa,CAACze,WAAW;SAChD,IAAI,CAAC0e,IAAI,GAAG,IAAI,CAACD,aAAa,CAACxe,SAAS,CAAC,IAAI,CAAC;SAC9C,IAAI,CAACye,IAAI,CAACxe,KAAK,CAACC,QAAQ,GAAG,UAAU;SACrC,IAAI,CAACue,IAAI,CAACte,SAAS,CAAC1I,GAAG,CAAC,yCAAyC,CAAC;SAClE,IAAI,CAACgnB,IAAI,CAACxe,KAAK,CAACG,KAAK,GAAGN,SAAS,GAAG,IAAI;SACxC/G,QAAQ,CAACsH,IAAI,CAAChD,WAAW,CAAC,IAAI,CAACohB,IAAI,CAAC;;;;KAErC;KAAA,yBAEQne,CAAC,EAACC,CAAC,EACZ;OACC,IAAI,CAACke,IAAI,CAACxe,KAAK,CAACO,IAAI,GAAGF,CAAC,GAAG,IAAI;OAC/B,IAAI,CAACme,IAAI,CAACxe,KAAK,CAACQ,GAAG,GAAGF,CAAC,GAAG,IAAI;;;KAC9B;KAAA,yBAEQG,WAAW,EAAEJ,CAAC,EAAEC,CAAC,EAC1B;OACC,IAAI,IAAI,CAACme,aAAa,EACtB;SACC,IAAI,CAACA,aAAa,CAACve,SAAS,CAACQ,MAAM,CAAC,wCAAwC,CAAC;;OAG9E,IAAI,IAAI,CAACge,eAAe,EACxB;SACC,IAAI,CAACA,eAAe,CAACxe,SAAS,CAACQ,MAAM,CAAC,mCAAmC,CAAC;;OAG3E,IAAMC,IAAI,GAAGF,WAAW,CAACG,YAAY,CAAC,WAAW,CAAC;OAElD,IAAID,IAAI,KAAK,YAAY,EACzB;SACC,IAAI,CAAC8d,aAAa,GAAGhe,WAAW;SAChC,IAAI,CAACie,eAAe,GAAG,IAAI;;OAG5B,IAAI/d,IAAI,KAAK,cAAc,EAC3B;SACC,IAAI,CAAC+d,eAAe,GAAGje,WAAW,CAACI,aAAa,CAAC,0BAA0B,CAAC;SAC5E,IAAI,CAAC4d,aAAa,GAAG,IAAI;;OAG1B,IAAI,IAAI,CAACA,aAAa,EACtB;SACC,IAAI,CAACA,aAAa,CAACve,SAAS,CAAC1I,GAAG,CAAC,wCAAwC,CAAC;;OAG3E,IAAI,IAAI,CAACknB,eAAe,EACxB;SACC,IAAI,CAACA,eAAe,CAACxe,SAAS,CAAC1I,GAAG,CAAC,mCAAmC,CAAC;;;;KAExE;KAAA,yBAEQ6I,CAAC,EAAEC,CAAC,EAAE/H,KAAK,EACpB;OACCA,KAAK,GAAGA,KAAK,IAAIuI,MAAM,CAACvI,KAAK;OAC7B,IAAMwI,MAAM,GAAGxI,KAAK,KAAKA,KAAK,CAACyI,OAAO,IAAIzI,KAAK,CAAC0I,OAAO,CAAC;OAExD,IAAI,IAAI,CAACsd,aAAa,EACtB;SACC,IAAI,IAAI,CAACE,aAAa,EACtB;WACC,IAAI,CAACA,aAAa,CAACve,SAAS,CAACQ,MAAM,CAAC,wCAAwC,CAAC;WAC7E,IAAI,CAACvI,IAAI,CAAC,cAAc,EAAE;aACzBwmB,YAAY,EAAE,IAAI,CAACF,aAAa,CAAClkB,UAAU;aAC3CwG,MAAM,EAANA,MAAM;aACN0d,aAAa,EAAE,IAAI,CAACA,aAAa;aACjC9b,KAAK,EAAE;YACP,CAAC;UACF,MACI,IAAI,IAAI,CAAC+b,eAAe,EAC7B;WACC,IAAI,CAACA,eAAe,CAACxe,SAAS,CAACQ,MAAM,CAAC,mCAAmC,CAAC;WAC1E,IAAI,CAACvI,IAAI,CAAC,cAAc,EAAE;aACzBwmB,YAAY,EAAE,IAAI,CAACD,eAAe;aAClC3d,MAAM,EAANA,MAAM;aACN4B,KAAK,EAAE;YACP,CAAC;;;OAIJ,IAAI,CAAC6b,IAAI,CAACjkB,UAAU,CAACkH,WAAW,CAAC,IAAI,CAAC+c,IAAI,CAAC;OAC3C,IAAI,CAACA,IAAI,GAAG,IAAI;OAChB,IAAI,CAACD,aAAa,GAAG,IAAI;OACzB,IAAI,CAACE,aAAa,GAAG,IAAI;;;KACzB;KAAA,uBAEMtS,QAAQ,EAAEyS,WAAW,EAC5B;OACC9iB,aAAG,CAAC4E,MAAM,mCAAC,IAAI,WAAO;OACtB,sCAAI,aAAW2c,WAAW,CAAC,IAAI,CAAC;OAChC,sCAAI,aAAalR,QAAQ;OAEzB,sCAAI,aAAW0S,WAAW,CAAC,IAAI,EAAED,WAAW,CAAC;OAC7C,sCAAI,WAAS,IAAI,CAACvkB,UAAU,EAAE;OAC9B,sCAAI,aAAWykB,eAAe,mCAAC,IAAI,YAAQF,WAAW,GAAGA,WAAW,CAACtkB,IAAI,GAAG,IAAI,CAAC;;;KACjF;KAAA,uBAEM6R,QAAQ,EAAEyS,WAAW,EAC5B;OACC,IAAMjc,KAAK,GAAG,IAAIuX,KAAK,CAAC;SACvBphB,QAAQ,oCAAE,IAAI,cAAU;SACxBqT,QAAQ,EAARA,QAAQ;SACRgO,WAAW,oCAAE,IAAI,eAAa;SAC9B1gB,OAAO,oCAAE,IAAI;QACb,CAAC;OAEF,IAAM4gB,SAAS,GAAG,IAAI,CAACzc,SAAS,EAAE;OAClC,OAAOyc,SAAS,CAAC,MAAM,CAAC;OACxB,OAAOA,SAAS,CAAC,WAAW,CAAC;OAE7B1X,KAAK,CAACxE,IAAI,CAACkc,SAAS,oCAAE,IAAI,eAAW;OAErClO,QAAQ,CAAC0S,WAAW,CAAClc,KAAK,EAAEic,WAAW,CAAC;OACxCzS,QAAQ,CAAC2S,eAAe,CAACnc,KAAK,CAACrI,IAAI,EAAEskB,WAAW,GAAGA,WAAW,CAACtkB,IAAI,GAAG,IAAI,CAAC;OAE3E,OAAOqI,KAAK;;;KACZ;KAAA,2BAGD;OACC,OAAO,IAAI,CAAC0J,WAAW,CAAC,OAAO,CAAC,IAAI,IAAI,CAAC0S,mBAAmB,EAAE;;;KAC9D;KAAA,sCAGD;OAAA;OACC,IAAI/mB,IAAI,GAAG,UAAU;OACrB,IAAMgnB,WAAW,8CAAG,IAAI,CAAC7S,QAAQ,mDAAb,eAAe8S,mBAAmB,CAAC,sCAAI,WAAO,MAAM,CAAC,CAAC,yEAAI,EAAE;OAChF,IAAID,WAAW,CAAC,MAAM,CAAC,EACvB;SACChnB,IAAI,GAAGgnB,WAAW,CAAC,MAAM,CAAC;;OAE3B,IAAIA,WAAW,CAAC,gBAAgB,CAAC,IAAIA,WAAW,CAAC,gBAAgB,CAAC,CAAC,OAAO,CAAC,EAC3E;SACChnB,IAAI,GAAGgnB,WAAW,CAAC,gBAAgB,CAAC,CAAC,OAAO,CAAC;;OAG9C,OAAOhnB,IAAI;;;KACX;KAAA,2BAGD;OACC,OAAO,IAAI,CAAC4jB,QAAQ,EAAE,KAAK,UAAU;;;KACrC;KAAA,kCAGD;OACC,IAAMoD,WAAW,GAAG,IAAI,CAAC7S,QAAQ,CAAC8S,mBAAmB,CAAC,sCAAI,WAAO,MAAM,CAAC,CAAC;OACzE,IAAMtmB,KAAK,GAAG,sCAAI,WAAO,YAAY,CAAC;OAEtC,IAAI,CAACpD,cAAI,CAAC2pB,QAAQ,CAACF,WAAW,CAAC,EAC/B;SACC,OAAO,KAAK;;OAGb,IAAMG,mBAAmB,GAAG,SAAtBA,mBAAmB;SAAA,OACxB5pB,cAAI,CAAC2pB,QAAQ,CAACF,WAAW,CAAC,QAAQ,CAAC,CAAC,IACjCzpB,cAAI,CAACwb,aAAa,CAAC6H,MAAM,CAAChiB,MAAM,CAACooB,WAAW,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3D;OAED,IAAMI,6BAA6B,GAAG,SAAhCA,6BAA6B;SAAA,OAClC7pB,cAAI,CAACU,OAAO,CAAC+oB,WAAW,CAAC,mBAAmB,CAAC,CAAC,IAC3CA,WAAW,CAAC,mBAAmB,CAAC,CAACK,IAAI,CAAC,UAAAC,WAAW;WAAA;WAAA,OAAI1G,MAAM,CAAChiB,MAAM,uBAAC+B,KAAK,CAAC2mB,WAAW,CAAC,mEAAI,EAAE,CAAC,CAAC1d,MAAM,GAAG,CAAC;WAAC;QAC3G;OAED,OAAOud,mBAAmB,EAAE,IAAIC,6BAA6B,EAAE;;;KAC/D;KAAA,6CAGD;OAAA;OACC,IAAM9c,MAAM,GAAG,EAAE;OACjB,IAAM0c,WAAW,GAAG,IAAI,CAAC7S,QAAQ,CAAC8S,mBAAmB,CAAC,sCAAI,WAAO,MAAM,CAAC,CAAC;OAEzE,IAAID,WAAW,IAAIA,WAAW,CAAC,QAAQ,CAAC,EACxC;SACC,KAAK,IAAMO,OAAO,IAAIP,WAAW,CAAC,QAAQ,CAAC,EAC3C;WACC,IAAIA,WAAW,CAAC,QAAQ,CAAC,CAAC5mB,cAAc,CAACmnB,OAAO,CAAC,EACjD;aACC,IAAMhd,KAAK,GAAGyc,WAAW,CAAC,QAAQ,CAAC,CAACO,OAAO,CAAC;aAC5Cjd,MAAM,CAACjM,IAAI,CAAC;eACXX,EAAE,EAAE6pB,OAAO;eACXvU,QAAQ,EAAE,IAAI,CAAC1P,KAAK,EAAE;eACtB4P,UAAU,EAAE,IAAI,CAAC0Q,QAAQ,EAAE;eAC3B3Q,IAAI,EAAE1I,KAAK,CAAC,MAAM,CAAC;eACnBhN,IAAI,EAAEgN,KAAK,CAAC,MAAM,CAAC;eACnBsJ,OAAO,EAAEtJ,KAAK,CAAC,SAAS,CAAC,IAAI,IAAI;eACjC4I,UAAU,EAAE,KAAK,GAAC,IAAI,CAAC7P,KAAK,EAAE,GAAC,GAAG,GAACikB,OAAO,GAAC,KAAK,GAAC,IAAI,CAAC3D,QAAQ,EAAE,GAAC,IAAI,GAACrZ,KAAK,CAAC,MAAM,CAAC,GAAC,IAAI;eACxF6I,gBAAgB,EAAE,IAAI,GAAC,IAAI,CAAC9P,KAAK,EAAE,GAAC,GAAG,GAACikB,OAAO,GAAC;cAChD,CAAC;aAEF,IAAI,CAAC,IAAI,CAACC,kBAAkB,EAC5B;eACC;;;;aAID,IACCjd,KAAK,CAAC,MAAM,CAAC,KAAK,MAAM,IAExBA,KAAK,CAAC,MAAM,CAAC,KAAK,MAAM,IAExBA,KAAK,CAAC,MAAM,CAAC,KAAK,MAAM,EAEzB;eACC,IAAMkd,YAAY,GAAIld,KAAK,CAAC,MAAM,CAAC,KAAK,MAAM,GAAI,UAAU,GAAG,WAAW;eAC1ED,MAAM,CAACjM,IAAI,CAAC;iBACXX,EAAE,EAAE6pB,OAAO,GAAG,YAAY;iBAC1BvU,QAAQ,EAAE,IAAI,CAAC1P,KAAK,EAAE;iBACtB2P,IAAI,EAAE1I,KAAK,CAAC,MAAM,CAAC,GAAG,GAAG,GAAGpG,aAAG,CAACC,UAAU,CAAC,6CAA6C,CAAC;iBACzF7G,IAAI,EAAE,QAAQ;iBACd4V,UAAU,eAAQ,IAAI,CAAC7P,KAAK,EAAE,cAAIikB,OAAO,gBAAME,YAAY,gBAAM,IAAI,CAAC7D,QAAQ,EAAE,eAAKrZ,KAAK,CAAC,MAAM,CAAC,OAAI;iBACtG6I,gBAAgB,cAAO,IAAI,CAAC9P,KAAK,EAAE,cAAIikB,OAAO,cAAIE,YAAY;gBAC9D,CAAC;;;;;OAMN,IAAIT,WAAW,IAAIzpB,cAAI,CAACU,OAAO,CAAC+oB,WAAW,CAAC,mBAAmB,CAAC,CAAC,EACjE;SACC,IAAMrmB,KAAK,GAAG,sCAAI,WAAO,YAAY,CAAC;SAEtCqmB,WAAW,CAAC,mBAAmB,CAAC,CAAC9oB,OAAO,CAAC,UAACopB,WAAW,EAAK;WACzD,IAAI3mB,KAAK,CAAC2mB,WAAW,CAAC,EACtB;aACC,KAAK,IAAMC,QAAO,IAAI5mB,KAAK,CAAC2mB,WAAW,CAAC,EACxC;eACC,IAAI3mB,KAAK,CAAC2mB,WAAW,CAAC,CAAClnB,cAAc,CAACmnB,QAAO,CAAC,EAC9C;iBACC,IAAMhd,MAAK,GAAG5J,KAAK,CAAC2mB,WAAW,CAAC,CAACC,QAAO,CAAC;iBACzCjd,MAAM,CAACjM,IAAI,CAAC;mBACXX,EAAE,EAAE6pB,QAAO;mBACXvU,QAAQ,EAAE,MAAI,CAAC1P,KAAK,EAAE;mBACtB2P,IAAI,EAAE1I,MAAK,CAAC,MAAM,CAAC;mBACnBhN,IAAI,EAAEgN,MAAK,CAAC,MAAM,CAAC;mBACnBsJ,OAAO,EAAEtJ,MAAK,CAAC,SAAS,CAAC,IAAI,IAAI;mBACjC4I,UAAU,eAAQ,MAAI,CAAC7P,KAAK,EAAE,cAAIikB,QAAO,gBAAM,MAAI,CAAC3D,QAAQ,EAAE,eAAKrZ,MAAK,CAAC,MAAM,CAAC,OAAI;mBACpF6I,gBAAgB,EAAE,IAAI,GAAG,MAAI,CAAC9P,KAAK,EAAE,GAAG,GAAG,GAAGikB,QAAO,GAAG;kBACxD,CAAC;;;iBAGF,IACChd,MAAK,CAAC,MAAM,CAAC,KAAK,MAAM,IAExBA,MAAK,CAAC,MAAM,CAAC,KAAK,MAAM,IAExBA,MAAK,CAAC,MAAM,CAAC,KAAK,MAAM,EAEzB;mBACC,IAAMkd,aAAY,GAAIld,MAAK,CAAC,MAAM,CAAC,KAAK,MAAM,GAAI,UAAU,GAAG,WAAW;mBAC1E,IAAMmd,UAAU,gBAAS,MAAI,CAACpkB,KAAK,EAAE,cAAIikB,QAAO,gBAAME,aAAY,gBAAM,MAAI,CAAC7D,QAAQ,EAAE,eAAKrZ,MAAK,CAAC,MAAM,CAAC,OAAI;mBAC7GD,MAAM,CAACjM,IAAI,CAAC;qBACXX,EAAE,EAAE6pB,QAAO,GAAG,YAAY;qBAC1BvU,QAAQ,EAAE,MAAI,CAAC1P,KAAK,EAAE;qBACtB2P,IAAI,EAAE1I,MAAK,CAAC,MAAM,CAAC,GAAG,GAAG,GAAGpG,aAAG,CAACC,UAAU,CAAC,6CAA6C,CAAC;qBACzF7G,IAAI,EAAE,QAAQ;qBACd4V,UAAU,EAAEuU,UAAU;qBACtBtU,gBAAgB,EAAE,IAAI,GAAG,MAAI,CAAC9P,KAAK,EAAE,GAAG,GAAG,GAAGikB,QAAO,GAAG,GAAG,GAAGE,aAAY,GAAG;oBAC7E,CAAC;;;;;UAKN,CAAC;;OAGH,OAAOnd,MAAM;;;KACb;KAAA,kCAEiB2V,EAAE,EACpB;OACC,IAAM3V,MAAM,GAAG,IAAI,CAACqZ,0BAA0B,EAAE;OAChD,KAAK,IAAIvZ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGE,MAAM,CAACV,MAAM,EAAE,EAAEQ,CAAC,EACtC;SACC,IAAIE,MAAM,CAACF,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK6V,EAAE,EAC1B;WACC,OAAO3V,MAAM,CAACF,CAAC,CAAC;;;OAIlB,OAAO,IAAI;;;KACX;KAAA,gCAGD;OAAA;OACC,IAAMkJ,UAAU,GAAG,IAAI,CAACsP,aAAa,EAAE;OACvC,IAAM+E,MAAM,GAAG;SACdxP,QAAQ,EAAE,IAAIhZ,GAAG,EAAE;SACnByoB,QAAQ,EAAE,IAAIzoB,GAAG,EAAE;SACnB0oB,QAAQ,EAAE,IAAI1oB,GAAG,EAAE;SACnB2oB,SAAS,EAAE,IAAI3oB,GAAG,EAAE;SACpB4oB,cAAc,EAAE,IAAI5oB,GAAG,EAAE;SACzB6oB,cAAc,EAAE,IAAI7oB,GAAG,EAAE;SACzB8oB,QAAQ,EAAE,IAAI9oB,GAAG;QACjB;OAEDyhB,MAAM,CAAChiB,MAAM,CAAC0U,UAAU,CAAC,CAACpV,OAAO,CAAC,UAAA8H,QAAQ;SAAA,OAAI,MAAI,CAACkiB,kBAAkB,CAACliB,QAAQ,EAAE2hB,MAAM,CAAC;SAAC;OAExF,IAAMQ,UAAU,GAAG,IAAI,CAAChY,YAAY,EAAE,CAACvK,SAAS,EAAE;OAClDuiB,UAAU,CAACxe,KAAK,CAACzL,OAAO,CAAC,UAAAuZ,IAAI;SAAA,OAAI,MAAI,CAAC2Q,wBAAwB,CAAC3Q,IAAI,CAAC,CAAC,CAAC,EAAEkQ,MAAM,CAAC;SAAC;OAEhF,OAAOA,MAAM;;;KACb;KAAA,mCAEkB1nB,KAAK,EAAE0nB,MAAM,EAChC;OAAA;OACC,IAAIpqB,cAAI,CAACU,OAAO,CAACgC,KAAK,CAAC,EACvB;SACCA,KAAK,CAAC/B,OAAO,CAAC,UAAAmM,CAAC;WAAA,OAAI,MAAI,CAAC6d,kBAAkB,CAAC7d,CAAC,EAAEsd,MAAM,CAAC;WAAC;QACtD,MACI,IAAIpqB,cAAI,CAACuC,aAAa,CAACG,KAAK,CAAC,EAClC;SACC2gB,MAAM,CAAChiB,MAAM,CAACqB,KAAK,CAAC,CAAC/B,OAAO,CAAC,UAAA+B,KAAK;WAAA,OAAI,MAAI,CAACioB,kBAAkB,CAACjoB,KAAK,EAAE0nB,MAAM,CAAC;WAAC;QAC7E,MACI,IAAIpqB,cAAI,CAACkb,cAAc,CAACxY,KAAK,CAAC,EACnC;SACC,IAAI0c,KAAK;SACT,IAAM0L,sBAAsB,GAAG,IAAIC,MAAM,CAAC,IAAI,CAACC,yBAAyB,EAAE,IAAI,CAAC;SAC/E,OAAO,CAAC5L,KAAK,GAAG0L,sBAAsB,CAAC3L,IAAI,CAACzc,KAAK,CAAC,MAAM,IAAI,EAC5D;WACC,IAAI,CAACmoB,wBAAwB,CAACzL,KAAK,CAAC6L,MAAM,EAAEb,MAAM,CAAC;;;;;KAGrD;KAAA,yCAEwBc,WAAW,EAAEd,MAAM,EAC5C;OACC,IAAIpqB,cAAI,CAACuC,aAAa,CAAC2oB,WAAW,CAAC,IAAIA,WAAW,CAAC,QAAQ,CAAC,IAAIA,WAAW,CAAC,OAAO,CAAC,EACpF;SACC,QAAQA,WAAW,CAAC,QAAQ,CAAC;WAE5B,KAAK,UAAU;aACdd,MAAM,CAACxP,QAAQ,CAAC3Y,GAAG,CAACipB,WAAW,CAAC,OAAO,CAAC,CAAC;aACzC;WAED,KAAK,UAAU;aACdd,MAAM,CAACC,QAAQ,CAACpoB,GAAG,CAACipB,WAAW,CAAC,OAAO,CAAC,CAAC;aACzC;WAED,KAAK,UAAU;aACdd,MAAM,CAACE,QAAQ,CAACroB,GAAG,CAACipB,WAAW,CAAC,OAAO,CAAC,CAAC;aACzC;WAED,KAAK,UAAU;aACdd,MAAM,CAACG,SAAS,CAACtoB,GAAG,CAACipB,WAAW,CAAC,OAAO,CAAC,CAAC;aAC1C;WAED,KAAK,aAAa;aACjBd,MAAM,CAACI,cAAc,CAACvoB,GAAG,CAACipB,WAAW,CAAC,OAAO,CAAC,CAAC;aAC/C;WAED,KAAK,WAAW;aACfd,MAAM,CAACK,cAAc,CAACxoB,GAAG,CAACipB,WAAW,CAAC,OAAO,CAAC,CAAC;aAC/C;;SAGF,IAAMC,cAAc,GAAG,IAAIJ,MAAM,CAAC,YAAY,EAAE,IAAI,CAAC;SACrD,IAAII,cAAc,CAAChM,IAAI,CAAC+L,WAAW,CAAC,QAAQ,CAAC,CAAC,EAC9C;WACCd,MAAM,CAACM,QAAQ,CAACzoB,GAAG,CAAC,CAACipB,WAAW,CAAC,QAAQ,CAAC,EAAEA,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC;;;;;KAGpE;KAAA,gCAGD;OACC,OAAO,IAAI,CAACE,cAAc,EAAE,CAAC/e,MAAM,GAAG,CAAC;;;KACvC;KAAA,iCAGD;OACC,IAAM+d,MAAM,GAAG/mB,iBAAO,CAACb,KAAK,CAAC,IAAI,CAAC6oB,aAAa,EAAE,CAAC;OAElD,IAAI,CAAC,IAAI,CAACzU,QAAQ,EAClB;SACC,OAAO,EAAE;;OAGV,IAAM0U,WAAW,GAAG;SACnB1Q,QAAQ,EAAE,sCAAI,eAAW7H,SAAS,EAAE;SACpCsX,QAAQ,EAAE,sCAAI,aAAWkB,YAAY,EAAE;SACvCjB,QAAQ,EAAE,sCAAI,aAAWkB,YAAY,EAAE;SACvChB,cAAc,EAAE,sCAAI,aAAWhE,eAAe;SAC9CiE,cAAc,EAAE,sCAAI,aAAWnE,eAAe;SAC9CiE,SAAS,EAAE,sCAAI,aAAWkB,aAAa,EAAE;SACzCf,QAAQ,EAAE,sCAAI,aAAWgB,mBAAmB;QAC5C;OAED,IAAMC,WAAW,GAAG,EAAE;OACtB,KAAK,IAAMxiB,MAAM,IAAIihB,MAAM,EAC3B;SACC,IAAIA,MAAM,CAACjhB,MAAM,CAAC,CAACyiB,IAAI,GAAG,CAAC,EAC3B;WACC,IAAMC,MAAM,GAAG,IAAIjqB,GAAG,EAAE;WAExB,KAAK,IAAM+G,GAAG,IAAI2iB,WAAW,CAACniB,MAAM,CAAC,EACrC;aACC,IAAImiB,WAAW,CAACniB,MAAM,CAAC,CAACR,GAAG,CAAC,CAAC,IAAI,CAAC,EAClC;eACCkjB,MAAM,CAAC5pB,GAAG,CAACqpB,WAAW,CAACniB,MAAM,CAAC,CAACR,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC;cAC1C,MACI,IAAI2iB,WAAW,CAACniB,MAAM,CAAC,CAACR,GAAG,CAAC,CAAC,MAAM,CAAC,EACzC;eACCkjB,MAAM,CAAC5pB,GAAG,CAACqpB,WAAW,CAACniB,MAAM,CAAC,CAACR,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC;;;WAE7C,6CAEmByhB,MAAM,CAACjhB,MAAM,CAAC,CAAC9H,MAAM,EAAE;aAAA;WAAA;aAA3C,oDACA;eAAA,IADWqB,KAAK;eAEf,IAAIopB,cAAc,GAAGppB,KAAK;eAC1B,IAAIggB,EAAE,GAAGhgB,KAAK;eAEd,IAAI1C,cAAI,CAACU,OAAO,CAACorB,cAAc,CAAC,EAChC;iBACCA,cAAc,GAAGppB,KAAK,CAAC,CAAC,CAAC;iBACzBggB,EAAE,GAAGhgB,KAAK,CAAC,CAAC,CAAC;;eAGd,IAAI,CAACmpB,MAAM,CAAC9pB,GAAG,CAAC+pB,cAAc,CAAC,EAC/B;iBACC,IAAI3iB,MAAM,KAAK,UAAU,EACzB;mBACCwiB,WAAW,CAAC7qB,IAAI,CAAC,IAAI,GAAGgrB,cAAc,GAAG,GAAG,GAAGpJ,EAAE,GAAG,GAAG,CAAC;kBACxD,MAED;mBACC,IAAIqJ,gBAAgB,GAAG5iB,MAAM;mBAE7B,IAAI4iB,gBAAgB,KAAK,gBAAgB,EACzC;qBACCA,gBAAgB,GAAG,WAAW;;mBAE/B,IAAIA,gBAAgB,KAAK,gBAAgB,EACzC;qBACCA,gBAAgB,GAAG,aAAa;;mBAEjC,IAAIA,gBAAgB,KAAK,WAAW,EACpC;qBACCA,gBAAgB,GAAG,UAAU;;mBAG9BJ,WAAW,CAAC7qB,IAAI,CAAC,IAAI,GAAGirB,gBAAgB,GAAG,GAAG,GAAGD,cAAc,GAAG,GAAG,CAAC;;iBAGvE;;eAGD,IAAI3iB,MAAM,KAAK,UAAU,EACzB;iBACC,IAAMiE,KAAK,GAAG,sCAAI,aAAW4e,YAAY,CAACF,cAAc,CAAC;iBACzD,IAAI,CAAC1e,KAAK,CAAC6e,iBAAiB,CAACvJ,EAAE,CAAC,EAChC;mBACCiJ,WAAW,CAAC7qB,IAAI,CAAC,IAAI,GAAGgrB,cAAc,GAAG,GAAG,GAAGpJ,EAAE,GAAG,GAAG,CAAC;;;;;aAG1D;;aAAA;;;;OAIH,OAAOiJ,WAAW;;;KAClB;KAAA,oBAvuCD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAGD;OACC,6EACI,IAAI;SACP/mB,SAAS,EAAE,sCAAI,gBAAYyD,SAAS,EAAE;SACtC2c,KAAK,EAAE,sCAAI,UAAQ3c,SAAS;;;;KAE7B;KAAA,oBAGD;OACC,yCAAO,IAAI;MACX;KAAA,kBAES5D,KAAc,EACxB;OACC,sCAAI,YAAYA,KAAK;;;KACrB;KAAA,oBAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,+BAkBD;OACC,OACC,GAAG,GAAGoY,QAAQ,CAACxD,IAAI,CAACC,MAAM,EAAE,GAAG,MAAM,CAAC,GACpC,GAAG,GAAGuD,QAAQ,CAACxD,IAAI,CAACC,MAAM,EAAE,GAAG,MAAM,CAAC,GACtC,GAAG,GAAGuD,QAAQ,CAACxD,IAAI,CAACC,MAAM,EAAE,GAAG,MAAM,CAAC,GACtC,GAAG,GAAGuD,QAAQ,CAACxD,IAAI,CAACC,MAAM,EAAE,GAAG,MAAM,CAAC;;;GAEzC;CAAA,EA3FyBpW,6BAAY;;;;ACXvC,CAA0C;AAE1C,KAAagpB,WAAW;GAIvB,qBAAYrR,OAA4B,EACxC;KAAA;KAAApa;OAAA;OAAA;;KACC,sCAAI,YAAYoa,OAAO;;GACvB;KAAA;KAAA,wBAGD;OACC,OAAO,IAAIqR,WAAW,CAAC7oB,iBAAO,CAACb,KAAK,mCAAC,IAAI,YAAU,CAAC;;;KACpD;KAAA,oBAEGhB,QAAgB,EAAEmH,GAAW,EAAEjG,KAAU,EAC7C;OACC,IAAI,CAAC1C,cAAI,CAACuC,aAAa,CAAC,sCAAI,YAAUf,QAAQ,CAAC,CAAC,EAChD;SACC,sCAAI,YAAUA,QAAQ,CAAC,GAAG,EAAE;;OAE7B,IAAM2qB,WAAW,GAAG,sCAAI,YAAU3qB,QAAQ,CAAC,CAACmH,GAAG,CAAC;OAEhD,IAAIwjB,WAAW,KAAKzpB,KAAK,EACzB;SACC2G,EAAE,CAAC7F,WAAW,CAAC4oB,IAAI,CAClB,oBAAoB,EACpB5qB,QAAQ,EACRmH,GAAG,EACHjG,KAAK,EACL,KAAK,CACL;;OAGF,OAAO,IAAI;;;KACX;KAAA,oBAEGlB,QAAgB,EAAEmH,GAAW,EAAEtG,YAAiB,EACpD;OACC,IAAI+S,MAAM,GAAG/S,YAAY;OACzB,IAAI,IAAI,CAACN,GAAG,CAACP,QAAQ,EAAEmH,GAAG,CAAC,EAC3B;SACCyM,MAAM,GAAG,sCAAI,YAAU5T,QAAQ,CAAC,CAACmH,GAAG,CAAC;;OAGtC,OAAOyM,MAAM;;;KACb;KAAA,oBAEG5T,QAAgB,EAAEmH,GAAW,EACjC;OACC,OAAO3I,cAAI,CAACuC,aAAa,CAAC,sCAAI,YAAUf,QAAQ,CAAC,CAAC,IAAIxB,cAAI,CAACuC,aAAa,CAAC,sCAAI,YAAUf,QAAQ,CAAC,CAACmH,GAAG,CAAC,CAAC;;;GACtG;CAAA;;;;;;;;;ACpDF,CAmBiB;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEjB,KAAayf,QAAQ;GAAA;GAqBpB,kBAAY1M,MAOX,EACD;KAAA;KAAA;KAAA;KACC;KAAQjO;KAAAA;KAAAA;KAAAA;KAAAA;KAAAhN;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KACR,MAAK6B,iBAAiB,CAAC,uBAAuB,CAAC;KAE/C,0GAAgBoZ,MAAM,CAACjM,OAAO,6DAAIvK,mCAAgB,EAAE;KACpD,MAAKmnB,SAAS,GAAG3Q,MAAM,CAAC2Q,SAAS;KACjC,MAAKC,SAAS,GAAG5Q,MAAM,CAAC4Q,SAAS;KAEjC,qGAA8B5Q,MAAM,CAAC6Q,qBAAqB;KAC1D,8FAAuB7Q,MAAM,CAAC8Q,cAAc;KAC5C,2FAAoB9Q,MAAM,CAAClY,WAAW;KACtC,yFAAgB,uFAAcU,OAAO;KACrC,sFAAa,EAAE;KACf,sFAAe,EAAE;KACjB,0FAAiBC,QAAQ,CAACI,IAAI,EAAE;KAAC;;GACjC;KAAA;KAAA,qBAEItB,IAAY,EAAE0B,QAAgB,EACnC;OACC,IAAI3E,cAAI,CAACuC,aAAa,CAACU,IAAI,CAAC,EAC5B;SACC,sCAAI,WAASA,IAAI;SACjB,IAAI,CAACjD,cAAI,CAACuC,aAAa,CAAC,sCAAI,WAAOkqB,SAAS,CAAC,EAC7C;WACC,sCAAI,WAAOA,SAAS,GAAG,EAAE;;SAE1B,IAAI,CAACzsB,cAAI,CAACuC,aAAa,CAAC,sCAAI,WAAOmqB,UAAU,CAAC,EAC9C;WACC,sCAAI,WAAOA,UAAU,GAAG,EAAE;;SAE3B,IAAI,CAAC1sB,cAAI,CAACuC,aAAa,CAAC,sCAAI,WAAOoqB,SAAS,CAAC,EAC7C;WACC,sCAAI,WAAOA,SAAS,GAAG,EAAE;;SAE1B,IAAI,CAAC3sB,cAAI,CAACC,KAAK,CAAC,sCAAI,WAAO2sB,eAAe,CAAC,EAC3C;WACC,sCAAI,WAAOA,eAAe,GAAGznB,MAAM,CAAC,sCAAI,WAAOynB,eAAe,CAAC;;SAGhE,IAAI,CAACC,oBAAoB,CAAC,sCAAI,WAAO,sBAAsB,CAAC,CAAC;SAC7D,IAAI,CAAC/e,YAAY,CAAC,KAAK,CAAC;;OAGzB,sCAAI,eAAa3J,QAAQ,CAAC2oB,OAAO,CAACnoB,QAAQ,CAAC;OAE3C,IAAI,CAAC,sCAAI,eAAW+I,MAAM,EAAE,EAC5B;SACC,sCAAI,iBAAiB,sCAAI,0BAAwBpC,aAAa,CAC7D,oDAAoD,GAAG,sCAAI,WAAOshB,eAAe,GAAG,IAAI,CACxF;SACD,sCAAI,aAAa,sCAAI,iBAAethB,aAAa,CAAC,0BAA0B,CAAC;SAC7E,sCAAI,gBAAgB,sCAAI,iBAAeA,aAAa,CAAC,uBAAuB,CAAC;SAE7E,IAAI,CAACyhB,UAAU,EAAE;SACjB,IAAI,CAACC,WAAW,EAAE;SAElB,IAAI,CAAC,IAAI,CAACC,kBAAkB,EAAE,IAAI,IAAI,CAAChpB,OAAO,EAAE,EAChD;;WAEC6F,IAAI,CAACE,YAAY,mCAAC,IAAI,kBAAgB,EAAE,CAAC;UACzC,MAED;WACCF,IAAI,CAACK,cAAc,mCAAC,IAAI,iBAAe;;;;;KAGzC;KAAA,uBAEMlH,IAAY,EAAE0B,QAAgB,EACrC;OACC4B,aAAG,CAAC2H,KAAK,mCAAC,IAAI,aAAW;OACzB3H,aAAG,CAAC2H,KAAK,mCAAC,IAAI,gBAAc;OAE5B,IAAI,CAAC0D,OAAO,EAAE;OACd,IAAI,CAAChJ,IAAI,CAAC3F,IAAI,EAAE0B,QAAQ,CAAC;;;KACzB;KAAA,0BAGD;OACC,sCAAI,WAAShE,OAAO,CAAC,UAAAyM,KAAK;SAAA,OAAIA,KAAK,CAACwE,OAAO,EAAE;SAAC;;;KAC9C;KAAA,0BASD;OACC,OAAO,sCAAI,YAAU3N,OAAO;;;KAC5B;KAAA,6BAGD;OACC,sCAAI,WAAW,EAAE;OAEjB,IAAIjE,cAAI,CAACU,OAAO,CAAC,sCAAI,WAAOwsB,MAAM,CAAC,EACnC;SACC,KAAK,IAAIrgB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,sCAAI,WAAOqgB,MAAM,CAAC7gB,MAAM,EAAE,EAAEQ,CAAC,EACjD;WACC,IAAMO,KAAK,GAAG,IAAIuX,KAAK,CAAC;aACvBphB,QAAQ,EAAE,sCAAI,YAAUA,QAAQ;aAChCqT,QAAQ,EAAE,IAAI;aACdgO,WAAW,EAAE,sCAAI,YAAU/gB,GAAG,CAAC,aAAa,CAAC;aAC7CK,OAAO,oCAAE,IAAI;YACb,CAAC;WACFkJ,KAAK,CAACxE,IAAI,CAAC,sCAAI,WAAOskB,MAAM,CAACrgB,CAAC,CAAC,oCAAE,IAAI,eAAW;WAChD,IAAI,CAAC0c,eAAe,CAACnc,KAAK,CAACrI,IAAI,CAAC;WAChC,sCAAI,WAASjE,IAAI,CAACsM,KAAK,CAAC;;;;;KAG1B;KAAA,wCAaD;OACC,IAAM+f,cAAc,GAAG,EAAE;OAEzB,sCAAI,WAASxsB,OAAO,CAAC,UAAAyM,KAAK,EAAI;SAC7B,IAAIA,KAAK,CAACwY,UAAU,EAAE,EACtB;WACCuH,cAAc,CAACrsB,IAAI,CAACsM,KAAK,CAACnK,IAAI,CAACyS,IAAI,CAAC;;QAErC,CAAC;OAEF,OAAOyX,cAAc;;;KACrB;KAAA,sCAGD;OACC,IAAMC,UAAU,GAAG,EAAE;OACrB,sCAAI,WAASzsB,OAAO,CAAC,UAAAyM,KAAK;SAAA,OAAIggB,UAAU,CAACtsB,IAAI,CAACsM,KAAK,CAAC/E,SAAS,EAAE,CAAC;SAAC;OAEjE,OAAO+kB,UAAU;;;KACjB;KAAA,wBAGD;OACC,OAAO,sCAAI,WAAOC,EAAE;;;KACpB;KAAA,8BAGD;OACC,OAAO,sCAAI,WAAOT,eAAe;;;KACjC;KAAA,4BAGD;OAAA;OACC,OAAO,sCAAI,YAAUrpB,QAAQ,CAAC6B,UAAU,CAACzB,IAAI,CAAC,UAAA0B,MAAM;SAAA,OAAIF,MAAM,CAACE,MAAM,CAACC,SAAS,CAAC,KAAK,MAAI,CAACC,WAAW,EAAE;SAAC;;;KACxG;KAAA,gCAGD;OACC,IAAMmd,EAAE,GAAG7F,QAAQ,CAAC,sCAAI,WAAOwQ,EAAE,CAAC;OAElC,OAAO,CAACC,KAAK,CAAC5K,EAAE,CAAC,GAAGA,EAAE,GAAG,CAAC;;;KAC1B;KAAA,8BAGD;OACC,IAAI,IAAI,CAACuK,kBAAkB,EAAE,EAC7B;SACC,IAAI,CAACM,oBAAoB,EAAE;QAC3B,MACI,IAAI,sCAAI,eAAWnnB,MAAM,EAAE,IAAI,IAAI,CAAConB,aAAa,EAAE,GAAG,CAAC,EAC5D;SACC,IAAI,CAACC,yBAAyB,EAAE;SAChC,IAAI,CAACC,0BAA0B,EAAE;SACjC,IAAI,CAACC,gCAAgC,EAAE;SACvC,IAAI,CAACC,sBAAsB,EAAE;;;;KAE9B;KAAA,iCAEgBnI,QAAiB,EAClC;OACC,sCAAI,IAAI,cACR;SACC,sCAAI,eAAathB,QAAQ,CAACqK,MAAM,EAAE,CAACkX,WAAW,CAAC,UAAU,EAAED,QAAQ,CAAC;SAEpE,IAAIA,QAAQ,EACZ;WACClf,aAAG,CAACoI,QAAQ,mCAAC,IAAI,cAAY,oBAAoB,CAAC;;SAGnD,IAAI,IAAI,CAACse,kBAAkB,EAAE,EAC7B;WACC1mB,aAAG,CAACoI,QAAQ,mCAAC,IAAI,cAAY,eAAe,CAAC;UAC7C,MAED;WACC,sCAAI,WAAShO,OAAO,CAAC,UAAAyM,KAAK;aAAA,OAAIA,KAAK,CAACygB,gBAAgB,CAACpI,QAAQ,CAAC;aAAC;;;;;KAGjE;KAAA,oCAGD;OACC,sCAAI,IAAI,cACR;SACC,sCAAI,eAAathB,QAAQ,CAACU,IAAI,EAAE;SAChC0B,aAAG,CAACsI,WAAW,mCAAC,IAAI,cAAY,oBAAoB,CAAC;SACrD,IAAI,IAAI,CAACoe,kBAAkB,EAAE,EAC7B;WACC1mB,aAAG,CAACsI,WAAW,mCAAC,IAAI,cAAY,eAAe,CAAC;UAChD,MAED;WACC,sCAAI,WAASlO,OAAO,CAAC,UAAAyM,KAAK;aAAA,OAAIA,KAAK,CAAC0gB,iBAAiB,EAAE;aAAC;;SAGzD,sCAAI,iBAAelgB,gBAAgB,CAAC,6CAA6C,CAAC,CAACjN,OAAO,CAAC,UAAAoE,IAAI,EAAI;WAClGwB,aAAG,CAACoI,QAAQ,CAAC5J,IAAI,EAAE,sDAAsD,CAAC;UAC1E,CAAC;;;;KAEH;KAAA,oCAGD;OACC,sCAAI,WAASpE,OAAO,CAAC,UAAAyM,KAAK;SAAA,OAAIA,KAAK,CAAC1F,YAAY,CAAC0F,KAAK,CAACrI,IAAI,CAAC;SAAC;OAE7D,sCAAI,iBAAe6I,gBAAgB,CAAC,6CAA6C,CAAC,CAACjN,OAAO,CAAC,UAAAoE,IAAI,EAAI;SAClGwB,aAAG,CAACoI,QAAQ,CAAC5J,IAAI,EAAE,sDAAsD,CAAC;QAC1E,CAAC;;;KACF;KAAA,qCAGD;OACC,sCAAI,WAASpE,OAAO,CAAC,UAAAyM,KAAK;SAAA,OAAIA,KAAK,CAAC8B,cAAc,CAAC9B,KAAK,CAACrI,IAAI,CAAC;SAAC;OAE/D,sCAAI,iBAAe6I,gBAAgB,CAAC,6CAA6C,CAAC,CAACjN,OAAO,CAAC,UAAAoE,IAAI,EAAI;SAClGwB,aAAG,CAACsI,WAAW,CAAC9J,IAAI,EAAE,sDAAsD,CAAC;QAC7E,CAAC;;;KACF;KAAA,mDAGD;OACC,IAAI/E,cAAI,CAACC,KAAK,CAAC,sCAAI,YAAU8tB,gBAAgB,CAAC,EAC9C;SACC,OAAO,KAAK;;OAGb,IAAMjd,IAAI,GAAG,IAAI;OACjB,IAAMkd,MAAM,GAAGznB,aAAG,CAACC,MAAM,CAAC,GAAG,EAAE;SAC9BG,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,sCAAsC,CAAC;SAC5DzD,KAAK,EAAE;WACNyjB,IAAI,EAAE;UACN;SACD1W,MAAM,EAAE;WACPC,KAAK,iBAACpN,KAAK,EACX;aACCA,KAAK,CAACwlB,cAAc,EAAE;aAEtB,IAAI,CAAC,kCAAA1X,IAAI,eAAW5I,QAAQ,EAAE,EAC9B;eACC4I,IAAI,CAACmd,iCAAiC,CAAC,IAAI,CAAC;;;UAG9C;SACDxnB,KAAK,EAAE;WACNC,SAAS,EAAE,kCAAkC;WAC7CwnB,MAAM,EAAE;;QAET,CAAC;OAEF,IAAI,CAAC,sCAAI,YAAUH,gBAAgB,CAAC1hB,MAAM,EAC1C;SACC9F,aAAG,CAACoI,QAAQ,CAACqf,MAAM,EAAE,yCAAyC,CAAC;;OAGhE,sCAAI,gBAAcnmB,WAAW,CAACmmB,MAAM,CAAC;;;KACrC;KAAA,yCAGD;OAAA;OACC,IAAI,CAAC,sCAAI,YAAUjqB,SAAS,EAC5B;SACC;;OAGD,IAAMoqB,YAAY,GAAG5nB,aAAG,CAACC,MAAM,CAAC,GAAG,EAAE;SACpCG,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,sCAAsC,CAAC;SAC5DJ,KAAK,EAAE;WACNC,SAAS,EAAE,kCAAkC;WAC7CwnB,MAAM,EAAE;UACR;SACDzjB,KAAK,EAAE;WACN2jB,MAAM,EAAE;UACR;SACDje,MAAM,EAAE;WACPC,KAAK,EAAE,eAAApN,KAAK,EAAI;aACfA,KAAK,CAACwlB,cAAc,EAAE;aACtB,MAAI,CAAC6F,uBAAuB,CAACF,YAAY,CAAC;;;QAG5C,CAAC;OAEF,sCAAI,gBAActmB,WAAW,CAACsmB,YAAY,CAAC;;;KAC3C;KAAA,wCAEuBG,gBAA6B,EACrD;OACC,IAAI,CAAC,IAAI,CAACrqB,OAAO,EAAE,EACnB;SACC+D,QAAQ,CAACC,qBAAqB,CAACqmB,gBAAgB,CAAC;QAChD,MAED;SACC,IAAI,CAAC1rB,IAAI,CAAC,2BAA2B,EAAE;WACtCuM,cAAc,EAAE,sCAAI,WAAOyd;UAC3B,CAAC;;;;KAEH;KAAA,4CAGD;OACC,IAAI5sB,cAAI,CAACC,KAAK,CAAC,sCAAI,YAAUsuB,kBAAkB,CAAC,EAChD;SACC,OAAO,KAAK;;OAGb,IAAMna,GAAG,GACR,CAAC,sCAAI,eAAWlM,QAAQ,EAAE,GACvB,sCAAI,YAAUqmB,kBAAkB,CAACxW,OAAO,CAAC,MAAM,EAAE,IAAI,CAACyV,aAAa,EAAE,CAAC,GACtE,GAAG;OAGP,IAAI,CAACpZ,GAAG,CAAC/H,MAAM,EACf;SACC,OAAO,KAAK;;OAGb,IAAM2hB,MAAM,GAAGznB,aAAG,CAACC,MAAM,CAAC,GAAG,EAAE;SAC9BG,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;SAC7DzD,KAAK,EAAE;WACNyjB,IAAI,EAAEzS;UACN;SACD3N,KAAK,EAAE;WAAEC,SAAS,EAAE;;QACpB,CAAC;OAEF,sCAAI,gBAAcmB,WAAW,CAACmmB,MAAM,CAAC;;;KACrC;KAAA,6CAGD;OACC,IAAIhuB,cAAI,CAACC,KAAK,CAAC,sCAAI,YAAUuuB,mBAAmB,CAAC,EACjD;SACC,OAAO,KAAK;;OAGb,IAAMpa,GAAG,GAAG,sCAAI,YAAUoa,mBAAmB,CAACzW,OAAO,CAAC,MAAM,EAAE,IAAI,CAACyV,aAAa,EAAE,CAAC;OAEnF,IAAI,CAACpZ,GAAG,CAAC/H,MAAM,IAAI,sCAAI,eAAWnE,QAAQ,EAAE,EAC5C;SACC,OAAO,KAAK;;OAGb,IAAM8lB,MAAM,GAAGznB,aAAG,CAACC,MAAM,CAAC,GAAG,EAAE;SAC9BG,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,wCAAwC,CAAC;SAC9DzD,KAAK,EAAE;WACNyjB,IAAI,EAAEzS;UACN;SACD3N,KAAK,EAAE;WAAEC,SAAS,EAAE;;QACpB,CAAC;OAEF,sCAAI,gBAAcmB,WAAW,CAACmmB,MAAM,CAAC;;;KACrC;KAAA,uCAGD;OACC,IAAMzmB,GAAG,GAAGhB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAC7BC,KAAK,EAAE;WACNC,SAAS,EAAE;UACX;SACDc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aACNC,SAAS,EAAE;YACX;WACDc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAAEC,SAAS,EAAE;;YACpB,CAAC,EACFH,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAAEC,SAAS,EAAE;cAAkC;aACtDC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,2CAA2C;YAChE,CAAC;UAEH,CAAC;QAEH,CAAC;OAEF,IAAI,sCAAI,eAAWT,MAAM,EAAE,EAC3B;SACC,IAAMC,WAAW,GAAGE,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACrCC,KAAK,EAAE;aACNC,SAAS,EAAE;YACX;WACDC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,6BAA6B;UAClD,CAAC;SAEF,IAAMiK,IAAI,GAAG,IAAI;SACjBhK,eAAK,CAACC,IAAI,CAACQ,GAAG,EAAE,OAAO,EAAE,UAAUvE,KAAK,EAAE;WACzCA,KAAK,CAACmF,eAAe,EAAE;WACvB,IAAI,CAAC,kCAAA2I,IAAI,eAAW5I,QAAQ,EAAE,EAC9B;aACC4I,IAAI,CAACmd,iCAAiC,CAAC,IAAI,CAAC;;UAE7C,CAAC;SACF1mB,GAAG,CAACM,WAAW,CAACxB,WAAW,CAAC;SAE5B,IAAMsB,SAAS,GAAGpB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WACpCC,KAAK,EAAE;aACNC,SAAS,EAAE;;UAEZ,CAAC;SAEFI,eAAK,CAACC,IAAI,CAACY,SAAS,EAAE,OAAO,EAAE,UAAU3E,KAAK,EAAE;WAC/CA,KAAK,CAACmF,eAAe,EAAE;WAEvB,IAAI,CAAC,kCAAA2I,IAAI,eAAW5I,QAAQ,EAAE,EAC9B;aACC4I,IAAI,CAAC2d,4BAA4B,CAAC,IAAI,CAAC;;UAExC,CAAC;SACFlnB,GAAG,CAACsgB,SAAS,CAAChgB,WAAW,CAACF,SAAS,CAAC;;OAGrC,sCAAI,aAAWE,WAAW,CAACN,GAAG,CAAC;OAC/B,sCAAI,iBAAiBA,GAAG;;;KACxB;KAAA,yBAEQvE,KAAgB,EACzB;OACC,IAAI,IAAI,CAACiqB,kBAAkB,EAAE,EAC7B;SACC,IAAI,CAACyB,wBAAwB,CAAC1rB,KAAK,CAAC;QACpC,MAED;SACC,sCAAI,WAASrC,OAAO,CAAC,UAAAyM,KAAK;WAAA,OAAIA,KAAK,CAACmB,QAAQ,CAACvL,KAAK,CAAC;WAAC;;;;KAErD;KAAA,yCAEwBA,KAAK,EAC9B;OACC,sCAAI,IAAI,kBACR;SACC,IAAM6F,KAAK,GAAG7F,KAAK,CAAC8F,OAAO,EAAE,CAACC,WAAW;SACzCM,EAAE,CAAC,CAACR,KAAK,GAAG,aAAa,GAAG,UAAU,CAAC,mCAAC,IAAI,kBAAgB,mBAAmB,CAAC;;;;KAEjF;KAAA,kDAEiCd,MAAM,EACxC;OACC,IAAI,CAAC,IAAI,CAAC9D,OAAO,EAAE,EACnB;SACC+D,QAAQ,CAACC,qBAAqB,CAACF,MAAM,CAAC;SACtC;;OAED,IAAI,CAAC,sCAAI,YAAUgmB,gBAAgB,CAAC1hB,MAAM,EAC1C;SACC,IAAIpB,GAAG,CAAC5B,EAAE,CAAC4L,EAAE,IAAIhK,GAAG,CAAC5B,EAAE,CAAC4L,EAAE,CAAC0Z,UAAU,EACrC;WACC1jB,GAAG,CAAC5B,EAAE,CAAC4L,EAAE,CAAC0Z,UAAU,CAAC/f,IAAI,CAAC,0BAA0B,CAAC;;SAGtD;;OAGD,IAAMggB,UAAU,GAAG,IAAI,CAACpB,aAAa,EAAE;OACvC,IAAIoB,UAAU,GAAG,CAAC,EAClB;SACC,IAAI,CAACC,iBAAiB,CAACD,UAAU,CAAC;;;;KAEnC;KAAA,6CAE4B7mB,MAAM,EACnC;OACC,sCAAI,iBAAiB,IAAI;OAEzB,IAAI,CAAC8kB,oBAAoB,CAAC,KAAK,CAAC;OAChC,IAAI,CAAC/e,YAAY,EAAE;OACnB,IAAI,CAAC0E,MAAM,CAAC,IAAI,EAAE,sCAAI,eAAWsc,OAAO,EAAE,CAAC;;;KAC3C;KAAA,kCAEiBF,UAAU,EAC5B;OACC3jB,GAAG,CAACM,MAAM,CAACmM,QAAQ,CAACmP,IAAI,GAAG,sCAAI,YAAUkH,gBAAgB,CAAChW,OAAO,CAAC,MAAM,EAAE6W,UAAU,CAAC;;;KACrF;KAAA,yBAEQ9J,SAAS,EAAEhW,QAAQ,EAC5B;OACC,IAAM1B,KAAK,GAAG,IAAIuX,KAAK,CAAC;SACvBphB,QAAQ,EAAE,sCAAI,YAAUA,QAAQ;SAChCqT,QAAQ,EAAE,IAAI;SACdgO,WAAW,EAAE,sCAAI,YAAU/gB,GAAG,CAAC,aAAa,CAAC;SAC7CK,OAAO,oCAAE,IAAI;QACb,CAAC;OACF,IAAMkE,QAAQ,GAAG;SAChBpI,IAAI,EAAE8kB,SAAS,CAAC,OAAO,CAAC;SACxBrY,UAAU,EAAE;WACXsiB,KAAK,EAAEjK,SAAS,CAAC,MAAM;UACvB;SACDkD,aAAa,EAAElD,SAAS,CAAC,gBAAgB;QACzC;OAED,IAAI,sCAAI,WAASzY,MAAM,GAAG,CAAC,EAC3B;SACC,IAAM2iB,WAAW,GAAG,sCAAI,WAAS,sCAAI,WAAS3iB,MAAM,GAAG,CAAC,CAAC;SACzD,IAAI,CAAC2iB,WAAW,CAAC/J,gBAAgB,EAAE,CAAC9H,KAAK,EAAE,IAAI6R,WAAW,CAAC/H,sBAAsB,EAAE,EACnF;WACC7e,QAAQ,CAAC,OAAO,CAAC,GAAG4mB,WAAW,CAAC/J,gBAAgB,EAAE,CAAC5c,SAAS,EAAE;WAC9DD,QAAQ,CAAC,sBAAsB,CAAC,GAAI,CAAC;;;OAIvCgF,KAAK,CAAC3I,KAAK,GAAG,IAAI;OAClB2I,KAAK,CAACxE,IAAI,CAACR,QAAQ,oCAAE,IAAI,eAAW;OAEpC,IAAI,CAACkhB,WAAW,CAAClc,KAAK,CAAC;OACvB,IAAI,CAACmc,eAAe,CAACnc,KAAK,CAACrI,IAAI,CAAC;OAChC,IAAI,CAACnC,IAAI,CAAC,oBAAoB,EAAE;SAACwK,KAAK,EAALA;QAAM,CAAC;OAExC,IAAI0B,QAAQ,EACZ;SACCA,QAAQ,CAACC,IAAI,CAAC,IAAI,EAAE3B,KAAK,CAAC;;;;KAE3B;KAAA,4BAEWA,KAAK,EAAEic,WAAW,EAC9B;OACC,IAAIA,WAAW,EACf;SACC,KAAK,IAAIxc,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,sCAAI,WAASR,MAAM,EAAE,EAAEQ,CAAC,EAC5C;WACC,IAAI,sCAAI,WAASA,CAAC,CAAC,KAAKwc,WAAW,EACnC;aACC;;WAGD,sCAAI,WAASpa,MAAM,CAACpC,CAAC,EAAE,CAAC,EAAEO,KAAK,CAAC;WAChC;;QAED,MAED;SACC,sCAAI,WAAStM,IAAI,CAACsM,KAAK,CAAC;;OAGzB,IAAI,CAACU,YAAY,EAAE;;;KACnB;KAAA,6BAEYV,KAAK,EAClB;OACC,KAAK,IAAIP,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,sCAAI,WAASR,MAAM,EAAE,EAAEQ,CAAC,EAC5C;SACC,IAAI,sCAAI,WAASA,CAAC,CAAC,KAAKO,KAAK,EAC7B;WACC,OAAQ,sCAAI,WAASP,CAAC,GAAG,CAAC,CAAC,IAAI,IAAI;;;OAIrC,OAAO,IAAI;;;KACX;KAAA,4BAEWO,KAAK,EAAE0B,QAAQ,EAC3B;OACC,KAAI,IAAIjC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,sCAAI,WAASR,MAAM,EAAE,EAAEQ,CAAC,EAC3C;SACC,IAAI,sCAAI,WAASA,CAAC,CAAC,CAACoiB,OAAO,CAAC7hB,KAAK,CAAC,EAClC;WACC,sCAAI,WAAS6B,MAAM,CAACpC,CAAC,EAAE,CAAC,CAAC;WAEzB,IAAIiC,QAAQ,EACZ;aACCA,QAAQ,CAAC1B,KAAK,CAAC;;WAGhB,IAAI,CAACU,YAAY,EAAE;WACnB,IAAI,CAAClL,IAAI,CAAC,uBAAuB,EAAE;aAAEwK,KAAK,EAALA;YAAO,CAAC;WAC7C;;;;;KAGF;KAAA,gCAEe8hB,SAAS,EAAEC,UAAU,EACrC;OACC,IAAIA,UAAU,EACd;SACC,sCAAI,aAAWpjB,YAAY,CAACmjB,SAAS,EAAEC,UAAU,CAAC;QAClD,MAED;SACC,sCAAI,aAAWtnB,WAAW,CAACqnB,SAAS,CAAC;;;;KAEtC;KAAA,wCAEuB9hB,KAAY,EAAEqC,OAAgB,EAAE2f,YAA6B,EACrF;OAAA;OACC,IAAI,CAACpvB,cAAI,CAACuC,aAAa,CAACkN,OAAO,CAAC,EAChC;SACCA,OAAO,GAAG,EAAE;;OAGb,IAAIxC,2BAAQ,CAACyC,WAAW,EAAE,CAAC2f,sBAAsB,EAAE,EACnD;SACC,IAAI5f,OAAO,CAAC6f,WAAW,EACvB;WACCriB,2BAAQ,CAACyC,WAAW,EAAE,CAAC2f,sBAAsB,EAAE,CAACxf,KAAK,CAACC,KAAK,EAAE;UAC7D,MAED;WACC;;;OAIF,IAAMC,QAAQ,GAAG,iCAAiC;OAElD,IAAMC,IAAI,GAAGzJ,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAC/BpD,KAAK,EAAE;WACNX,IAAI,EAAEsN;;QAEP,CAAC;OAEF9C,2BAAQ,CAACyC,WAAW,EAAE,CAAC6f,sBAAsB,CAAC;SAC7C3Y,QAAQ,EAAE,IAAI;SACdnH,OAAO,EAAEA,OAAO;SAChBrC,KAAK,EAAEA,KAAK;SACZ4C,IAAI,EAAEA;QACN,CAAC;OAEFA,IAAI,CAACnI,WAAW,CAAC,IAAI,CAAC2nB,mBAAmB,CAACpiB,KAAK,CAAC,CAAC;OACjD4C,IAAI,CAACnI,WAAW,CAAC,IAAI,CAACoI,uBAAuB,CAAC7C,KAAK,CAAC,CAAC;OAErD,IAAMqiB,gBAAgB,GAAGriB,KAAK,CAACge,cAAc,EAAE;OAC/C,IAAIqE,gBAAgB,CAACpjB,MAAM,GAAG,CAAC,EAC/B;SACC9F,aAAG,CAAC+I,MAAM,CAAC,IAAI,CAACogB,qBAAqB,CAACD,gBAAgB,CAAC,EAAEzf,IAAI,CAAC;;OAG/D,IAAME,QAAQ,GAAG3J,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAClCC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAiC;SACrDyJ,MAAM,EAAE;WACPC,KAAK,EAAE,eAACpN,KAAK;aAAA,OAAK,MAAI,CAACJ,IAAI,CAAC,oBAAoB,EAAEI,KAAK,CAAC;;;QAEzD,CAAC;OACFgN,IAAI,CAACnI,WAAW,CAACqI,QAAQ,CAAC;OAC1BT,OAAO,CAAC,sBAAsB,CAAC,GAAG,sCAAI,YAAUlM,QAAQ,CAAC4S,aAAa,EAAE;OACxE,IAAInW,cAAI,CAACuC,aAAa,CAAC6K,KAAK,CAACnK,IAAI,CAAC+kB,aAAa,CAAC,IAAK5a,KAAK,CAACnK,IAAI,CAAC+kB,aAAa,CAACnlB,cAAc,CAAC,cAAc,CAAE,EAC7G;SACC4M,OAAO,CAAC,cAAc,CAAC,GAAGrC,KAAK,CAACnK,IAAI,CAAC+kB,aAAa,CAAC2H,YAAY;;OAGhEtmB,EAAE,CAAC2I,IAAI,CAAC;SACPkC,MAAM,EAAE,MAAM;SACdC,QAAQ,EAAE,MAAM;SAChBC,GAAG,EAAEyD,aAAG,CAACC,QAAQ,CAChB,sCAAI,YAAUzD,OAAO,EACrB;WACC9B,cAAc,4BAAqBnF,KAAK,CAAC3I,KAAK,GAAG,QAAQ,GAAG,EAAE,uBAAa2I,KAAK,CAACnK,IAAI,CAACjD,IAAI,CAACiJ,WAAW,EAAE;UACxG,CACD;SACDhG,IAAI,EAAE;WACLqR,WAAW,EAAE,kBAAkB;WAC/BC,eAAe,EAAE,sCAAI,YAAUC,cAAc;WAC7Cob,eAAe,EAAE,sCAAI,YAAUrsB,QAAQ,CAAC6X,kBAAkB,EAAE;WAC5D3L,OAAO,EAAEA,OAAO;WAChBogB,UAAU,EAAEnjB,MAAM,CAACojB,YAAY,CAAC1iB,KAAK,CAAC/E,SAAS,EAAE,CAAC;WAClD0nB,SAAS,EAAEhgB;UACX;SACD0E,SAAS,EAAE,mBAAA0L,IAAI,EAAI;WAClB,IAAIA,IAAI,EACR;aACC,IAAM6P,UAAU,GAAGzpB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eACpC2Z,IAAI,EAAEA;cACN,CAAC;aACFnQ,IAAI,CAACnI,WAAW,CAACmoB,UAAU,CAAC;;WAG7B,MAAI,CAACC,sBAAsB,CAAC7iB,KAAK,EAAE4C,IAAI,EAAEof,YAAY,CAAC;;QAEvD,CAAC;;;KACF;KAAA,uCAEsBhiB,KAAY,EAAE4C,IAAqB,EAAEof,YAA6B,EACzF;OAAA;OACC,IAAIc,aAAa,GAAG,GAAG;OACvB,IAAIC,UAAU,GAAGD,aAAa;OAE9B,sCAAI,IAAI,iBACR;;SAEC,IAAI,CAACttB,IAAI,CAAC,6BAA6B,CAAC;SACxCutB,UAAU,GAAGtT,QAAQ,CACpB,sCAAI,gBAAchZ,GAAG,CAAC,UAAU,EAAE,4BAA4B,EAAE,GAAG,CAAC,CACpE;;OAGF,IAAI,CAACusB,yBAAyB,CAAChjB,KAAK,EAAE4C,IAAI,CAAC;OAE3C,IACC5C,KAAK,CAACnK,IAAI,CAACjD,IAAI,KAAK,sBAAsB,IACvCoN,KAAK,CAACnK,IAAI,CAACjD,IAAI,KAAK,cAAc,IAClCoN,KAAK,CAACnK,IAAI,CAACjD,IAAI,KAAK,oBAAoB,EAE5C;SACCkwB,aAAa,IAAI,GAAG;SACpB,IAAIC,UAAU,GAAGD,aAAa,EAC9B;WACCC,UAAU,GAAGD,aAAa;;;OAI5B,IAAIhI,UAAU,GAAGthB,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;OAC1E,IAAIwpB,gBAAgB,GAAGzpB,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;OAEhF,IAAIuG,KAAK,CAACkjB,QAAQ,EAAE,EACpB;SACCpI,UAAU,GAAG9a,KAAK,CAACiZ,QAAQ,EAAE;SAC7BgK,gBAAgB,GAAGjjB,KAAK,CAACoc,mBAAmB,EAAE;SAE9C,IAAI6G,gBAAgB,KAAK,UAAU,EACnC;WACCA,gBAAgB,GAAGnI,UAAU;;;OAI/B,IAAMqI,eAAe,GAAGC,aAAG,CAACC,MAAM,wZAEsCtZ,cAAI,CAAC6C,MAAM,CAACkO,UAAU,CAAC,EAEpD/Q,cAAI,CAAC6C,MAAM,CAACqW,gBAAgB,CAAC,CAGvE;OACDroB,QAAQ,CAAC0oB,OAAO,CAACH,eAAe,CAAC;OAEjC,IAAMI,EAAE,GAAG,IAAI;OACf,IAAM9gB,KAAK,GAAG,IAAIxG,EAAE,CAAC0H,WAAW,CAACrE,MAAM,CAACsE,gBAAgB,EAAE,EAAE,IAAI,EAAE;SACjEC,QAAQ,EAAE;WACTC,OAAO,EAAEqf;UACT;SACDrf,OAAO,EAAElB,IAAI;SACbmB,SAAS,EAAE,IAAI;SACfvG,KAAK,EAAEulB,UAAU;SACjBS,SAAS,EAAE;WACVC,QAAQ,EAAEX,aAAa;WACvBY,SAAS,EAAE;UACX;SACD1f,UAAU,EAAE,CAAC;SACbC,SAAS,EAAE,CAAC;SACZC,UAAU,EAAE,IAAI;SAChBC,SAAS,EAAE;WAACC,QAAQ,EAAE;UAAM;SAC5BrB,MAAM,EAAE;WACPuB,YAAY,EAAE,sBAAC7B,KAAK,EAAK;aACxB5C,2BAAQ,CAACyC,WAAW,EAAE,CAAC6f,sBAAsB,CAAC,IAAI,CAAC;aACnD,MAAI,CAACwB,4BAA4B,EAAE;aACnClhB,KAAK,CAAC+B,OAAO,EAAE;aACf,MAAI,CAAChP,IAAI,CAAC,8BAA8B,CAAC;YACzC;WACDouB,aAAa,EAAE,yBAAM;aACpB,MAAI,CAACC,qBAAqB,EAAE;YAC5B;WACDC,gBAAgB,EAAE,4BAAW;aAC5B,sCAAIP,EAAE,iBACN;eACC,kCAAAA,EAAE,gBAAc1vB,GAAG,CAClB,UAAU,EACV,4BAA4B,EAC5B,IAAI,CAACkwB,QAAQ,EAAE,CACf;;;UAGH;SACDtf,OAAO,EAAE,CACR,IAAIxI,EAAE,CAACyI,iBAAiB,CAAC;WACxBnL,IAAI,EAAGC,aAAG,CAACC,UAAU,CAAC,qBAAqB,CAAC;WAC5CH,SAAS,EAAG,4BAA4B;WACxCyJ,MAAM,EAAG;aACRC,KAAK,mBACL;eACC,IAAMghB,UAAU,GAAGhkB,KAAK,CAAC3I,KAAK;eAE9BksB,EAAE,CAACU,iBAAiB,CAACrhB,IAAI,EAAE5C,KAAK,EAAE/D,EAAE,CAACioB,QAAQ,CAAC,YAC9C;iBACC,IAAI,CAAC5e,WAAW,CAAC5C,KAAK,EAAE;iBACxB,IAAIshB,UAAU,EACd;mBACCT,EAAE,CAAC/tB,IAAI,CAAC,oBAAoB,EAAE;qBAAEwK,KAAK,EAALA;oBAAO,CAAC;;iBAEzC,IAAIgiB,YAAY,EAChB;mBACCA,YAAY,CAAChiB,KAAK,CAAC;;gBAEpB,EAAE,IAAI,CAAC,EAAE,IAAI,CAACmkB,UAAU,CAAC;;;UAG5B,CAAC,EACF,IAAIloB,EAAE,CAACoJ,qBAAqB,CAAC;WAC5B9L,IAAI,EAAGC,aAAG,CAACC,UAAU,CAAC,uBAAuB,CAAC;WAC9CH,SAAS,EAAG,iCAAiC;WAC7CyJ,MAAM,EAAG;aACRC,KAAK,EAAE,iBAAU;eAChB,IAAI,CAACsC,WAAW,CAAC5C,KAAK,EAAE;;;UAG1B,CAAC;QAEH,CAAC;OAEF7C,2BAAQ,CAACyC,WAAW,EAAE,CAAC2f,sBAAsB,EAAE,CAACxf,KAAK,GAAGA,KAAK;OAC7DA,KAAK,CAACjB,IAAI,EAAE;;;KACZ;KAAA,0CAEyBxB,KAAK,EAAErI,IAAI,EACrC;OACC,IAAI,CAAC/E,cAAI,CAACU,OAAO,CAAC,IAAI,CAAC8wB,qBAAqB,CAAC,EAC7C;SACC,IAAI,CAACA,qBAAqB,GAAG,EAAE;;OAGhC,IAAM5c,YAAY,GAAG7P,IAAI,CAAC6I,gBAAgB,CAAC,aAAa,CAAC;OACzD,KAAK,IAAIf,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG+H,YAAY,CAACvI,MAAM,EAAE,EAAEQ,CAAC,EAC5C;SACC,IAAI,CAAC4kB,wBAAwB,CAACrkB,KAAK,EAAEwH,YAAY,CAAC/H,CAAC,CAAC,CAAC;;;;KAEtD;KAAA,yCAEwBO,KAAK,EAAEskB,WAAW,EAC3C;OAAA;OACC,IAAI,CAAC1xB,cAAI,CAACU,OAAO,CAAC,IAAI,CAAC8wB,qBAAqB,CAAC,EAC7C;SACC,IAAI,CAACA,qBAAqB,GAAG,EAAE;;OAGhC,IAAM1c,IAAI,GAAG4c,WAAW,CAACrmB,YAAY,CAAC,WAAW,CAAC;OAElD,IAAMsmB,YAAY,GAAG;SACpBliB,OAAO,EAAE,IAAImiB,kCAAe,CAAC;WAC5B7kB,MAAM,EAAE1J,iBAAO,CAACb,KAAK,CAAC,sCAAI,YAAUe,QAAQ,CAACwP,SAAS,EAAE,CAAC;WACzD8e,eAAe,EAAE,sCAAI,YAAUhuB,GAAG,CAAC,uCAAuC,CAAC;WAC3EiuB,cAAc,EAAE,sCAAI,YAAUvuB,QAAQ,CAACkE,KAAK;WAC5CjE,WAAW,EAAE,sCAAI,YAAUA;UAC3B,CAAC;SACFuuB,QAAQ,EAAE3kB,KAAK,CAAC3I,KAAK;SACrButB,QAAQ,EAAEN;QACV;OAED,IAAI5c,IAAI,KAAKmd,kCAAe,CAACC,kBAAkB,EAC/C;SACC,IAAMC,aAAa,GAAGxlB,IAAI,CAACylB,KAAK,CAACV,WAAW,CAACrmB,YAAY,CAAC,eAAe,CAAC,CAAC;SAC3EsmB,YAAY,CAACliB,OAAO,CAACxO,GAAG,CAAC,sBAAsB,oEAC3C,IAAI,4EAAJ,IAAI,EAAkCkxB,aAAa,mCACnD,IAAI,CAAC3L,eAAe,CAAChe,MAAM,CAAC,UAAAie,QAAQ;WAAA,OAAIA,QAAQ,CAAC,MAAM,CAAC,KAAK,MAAM;WAAC,CAACvkB,GAAG,CAAC,UAAAukB,QAAQ;WAAA,OAAK;aACxF/D,EAAE,EAAE+D,QAAQ,CAAC,YAAY,CAAC;aAC1Bhf,KAAK,EAAEgf,QAAQ,CAAC,MAAM;YACtB;UAAC,CAAC,kCACA,IAAI,CAACH,eAAe,CAAC9d,MAAM,CAAC,UAAA+d,QAAQ;WAAA,OAAIA,QAAQ,CAAC,MAAM,CAAC,KAAK,MAAM;WAAC,CAACrkB,GAAG,CAAC,UAAAqkB,QAAQ;WAAA,OAAK;aACxF7D,EAAE,EAAE6D,QAAQ,CAAC,YAAY,CAAC;aAC1B9e,KAAK,EAAE8e,QAAQ,CAAC,MAAM;YACtB;UAAC,CAAC,GACF;QACF,MACI,IAAIzR,IAAI,KAAKmd,kCAAe,CAACI,kBAAkB,EACpD;SACC,IAAI,CAACxb,MAAM,CAAClW,OAAO,CAAC,UAACyM,KAAK,EAAK;WAAA;WAC9B,yBAAAukB,YAAY,CAACliB,OAAO,CAAC1C,MAAM,EAACjM,IAAI,6DAC5BsM,KAAK,CACNgZ,0BAA0B,EAAE,CAC5B5d,MAAM,CAAC,UAAAwE,KAAK;aAAA,OAAIA,KAAK,CAAC,MAAM,CAAC,KAAK,MAAM;aAAC,CACzC9K,GAAG,CAAC,UAAC8K,KAAK;aAAA,OAAM;eAChB7M,EAAE,eAAQiN,KAAK,CAACrH,KAAK,EAAE,cAAIiH,KAAK,CAAC,IAAI,CAAC,OAAI;eAC1C0I,IAAI,YAAKtI,KAAK,CAACiZ,QAAQ,EAAE,eAAKrZ,KAAK,CAAC,MAAM,CAAC,CAAE;eAC7ChN,IAAI,EAAE,MAAM;eACZ4V,UAAU,eAAQxI,KAAK,CAACrH,KAAK,EAAE,cAAIiH,KAAK,CAAC,IAAI,CAAC;cAC9C;YAAC,CAAC,EACJ;UACD,CAAC;;OAGH,IAAM6H,OAAO,GAAGod,kCAAe,CAACK,oBAAoB,CAACxd,IAAI,EAAE6c,YAAY,CAAC;OAExE,IAAI9c,OAAO,IAAIC,IAAI,KAAKmd,kCAAe,CAACM,wBAAwB,EAChE;SACC1d,OAAO,CAAC2d,QAAQ,CAACd,WAAW,CAAC;SAE7B7c,OAAO,CAAC9R,SAAS,CAAC,eAAe,EAAE,UAACC,KAAK,EAAK;WAC7C,qBAAwBA,KAAK,CAAC8F,OAAO,EAAE;aAAhCqpB,aAAa,kBAAbA,aAAa;WACpBtd,OAAO,CAAC4d,aAAa,CAAC,MAAI,CAACC,WAAW,CAACP,aAAa,CAAC,CAAC;UACtD,CAAC;SACFtd,OAAO,CAAC9R,SAAS,CAAC,gBAAgB,EAAE,UAACC,KAAK,EAAK;WAC9C,sBAAwBA,KAAK,CAAC8F,OAAO,EAAE;aAAhCqpB,aAAa,mBAAbA,aAAa;WACpBtd,OAAO,CAAC4d,aAAa,CAAC,MAAI,CAACE,YAAY,CAACR,aAAa,CAAC,CAAC;UACvD,CAAC;SACFtd,OAAO,CAAC9R,SAAS,CAAC,iBAAiB,EAAE,UAACC,KAAK;WAAA,OAAK,MAAI,CAAC4vB,UAAU,CAAC5vB,KAAK,EAAEoK,KAAK,CAAC;WAAC;SAC9EyH,OAAO,CAAC9R,SAAS,CAAC,YAAY,EAAE,UAACC,KAAK;WAAA,OAAK,MAAI,CAAC4vB,UAAU,CAAC5vB,KAAK,EAAEoK,KAAK,CAAC;WAAC;;OAG1E/D,EAAE,CAAC4L,EAAE,CAACC,IAAI,CAACtM,IAAI,CAAC8oB,WAAW,CAAC;OAE5B,IAAI7c,OAAO,EACX;SACC,IAAI,CAAC2c,qBAAqB,CAAC1wB,IAAI,CAAC+T,OAAO,CAAC;;;;KAEzC;KAAA,+CAoKD;OACC,IAAI,IAAI,CAAChC,iBAAiB,EAC1B;SACC,IAAI,CAACA,iBAAiB,CAACjB,OAAO,EAAE;SAChC,IAAI,CAACiB,iBAAiB,GAAG,IAAI;;OAG9B,IAAI7S,cAAI,CAACU,OAAO,CAAC,IAAI,CAAC8wB,qBAAqB,CAAC,EAC5C;SACC,KAAK,IAAI3kB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAAC2kB,qBAAqB,CAACnlB,MAAM,EAAE,EAAEQ,CAAC,EAC1D;WACC,IAAI7M,cAAI,CAACmV,UAAU,CAAC,IAAI,CAACqc,qBAAqB,CAAC3kB,CAAC,CAAC,CAAC+E,OAAO,CAAC,EAC1D;aACC,IAAI,CAAC4f,qBAAqB,CAAC3kB,CAAC,CAAC,CAAC+E,OAAO,EAAE;;;;OAK1C,IAAI,CAAC4f,qBAAqB,GAAG,IAAI;;;KACjC;KAAA,4CAGD;OACC,IAAIxxB,cAAI,CAACU,OAAO,CAAC,IAAI,CAAC8wB,qBAAqB,CAAC,EAC5C;SACC,KAAK,IAAI3kB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAAC2kB,qBAAqB,CAACnlB,MAAM,EAAE,EAAEQ,CAAC,EAC1D;WACC,IAAI7M,cAAI,CAACmV,UAAU,CAAC,IAAI,CAACqc,qBAAqB,CAAC3kB,CAAC,CAAC,CAACgmB,YAAY,CAAC,EAC/D;aACC,IAAI,CAACrB,qBAAqB,CAAC3kB,CAAC,CAAC,CAACgmB,YAAY,EAAE;;;;;;KAI/C;KAAA,wCAGD;OACC,IAAI7yB,cAAI,CAACU,OAAO,CAAC,IAAI,CAAC8wB,qBAAqB,CAAC,EAC5C;SACC,KAAK,IAAI3kB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAAC2kB,qBAAqB,CAACnlB,MAAM,EAAE,EAAEQ,CAAC,EAC1D;WACC,IAAI7M,cAAI,CAACmV,UAAU,CAAC,IAAI,CAACqc,qBAAqB,CAAC3kB,CAAC,CAAC,CAACmkB,aAAa,CAAC,EAChE;aACC,IAAI,CAACQ,qBAAqB,CAAC3kB,CAAC,CAAC,CAACmkB,aAAa,EAAE;;;;;;KAIhD;KAAA,oCAEmB5jB,KAAK,EACzB;OACC,IAAM0b,KAAK,GAAG1b,KAAK,CAAC6X,gBAAgB,EAAE,CAACziB,KAAK,EAAE;OAC9C,IAAMswB,MAAM,GAAGpmB,MAAM,CAACsE,gBAAgB,EAAE;OAExC,IAAM+hB,aAAa,GAAGxsB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACzCC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd3I,IAAI,EAAE,YAAY;WAClBC,KAAK,EAAEomB,KAAK,CAAC1d;;QAEd,CAAC;OACF,IAAM4nB,cAAc,GAAGzsB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SAC1CC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd3I,IAAI,EAAE,aAAa;WACnBC,KAAK,EAAEomB,KAAK,CAACpmB;;QAEd,CAAC;OACF,IAAMuwB,kBAAkB,GAAG1sB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SAC9CC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd3I,IAAI,EAAE,kBAAkB;WACxBC,KAAK,EAAEomB,KAAK,CAACxM;;QAEd,CAAC;OACF,IAAM4W,cAAc,GAAG3sB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SAC1CC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd3I,IAAI,EAAE,aAAa;WACnBC,KAAK,EAAEomB,KAAK,CAACvM;;QAEd,CAAC;OACF,IAAM4W,iBAAiB,GAAG5sB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SAC7CC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd3I,IAAI,EAAE,gBAAgB;WACtBC,KAAK,EAAEomB,KAAK,CAACtM,QAAQ,GAAG,CAAC,GAAG;;QAE7B,CAAC;OAEF,IAAM4W,oBAAoB,GAAG7sB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SAChDC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd3I,IAAI,EAAE,oBAAoB;WAC1BC,KAAK,EAAEomB,KAAK,CAACrM,WAAW,GAAG,CAAC,GAAG;;QAEhC,CAAC;OAEF,IAAM4W,eAAe,GAAG9sB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SAC3CC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd3I,IAAI,EAAE,eAAe;WACrBC,KAAK,EAAEomB,KAAK,CAACnL;;QAEd,CAAC;OAEF,IAAM2V,sBAAsB,GAAG/sB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SACjDC,KAAK,EAAE;WACNC,SAAS,EAAE;;QAEZ,CAAC;OAEF,IAAMoW,WAAW,GAAG,EAAE;OAEtB,IAAMyW,SAAS,GAAG,sCAAI,YAAUhwB,QAAQ,CAACwP,SAAS,EAAE;OACpD,IAAMygB,SAAS,qCAAG,IAAI,kBAAgB;OAEtC,IAAIxzB,cAAI,CAACU,OAAO,CAAC6yB,SAAS,CAAC,EAC3B;SACC,KAAK,IAAI1mB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG0mB,SAAS,CAAClnB,MAAM,EAAE,EAAEQ,CAAC,EACzC;WACC,IAAMG,KAAK,GAAGumB,SAAS,CAAC1mB,CAAC,CAAC;WAC1B,IAAIG,KAAK,CAAC,MAAM,CAAC,KAAK,MAAM,IAAIA,KAAK,CAAC,MAAM,CAAC,KAAK,UAAU,EAC5D;aACC8P,WAAW,CAAChc,IAAI,CAACkM,KAAK,CAAC;;;;OAK1B,IAAMymB,qBAAqB,GAAG,IAAIC,wCAAqB,CAAC;SACvDC,SAAS,EAAEL,sBAAsB;SACjCM,QAAQ,oBAAC9K,KAAK,EAAE;WACfiK,aAAa,CAACrwB,KAAK,GAAGomB,KAAK,CAAC1d,IAAI;WAChC4nB,cAAc,CAACtwB,KAAK,GAAGomB,KAAK,CAACpmB,KAAK;WAClCuwB,kBAAkB,CAACvwB,KAAK,GAAGomB,KAAK,CAACxM,SAAS;WAC1C4W,cAAc,CAACxwB,KAAK,GAAGomB,KAAK,CAACvM,KAAK;WAClC4W,iBAAiB,CAACzwB,KAAK,GAAGomB,KAAK,CAACtM,QAAQ,GAAG,CAAC,GAAG,CAAC;WAChD4W,oBAAoB,CAAC1wB,KAAK,GAAGomB,KAAK,CAACrM,WAAW,GAAG,CAAC,GAAG,CAAC;WACtD4W,eAAe,CAAC3wB,KAAK,GAAGomB,KAAK,CAACnL,YAAY;UAC1C;SACDb,WAAW,EAAEA,WAAW;SACxB0W,SAAS,EAAEA,SAAS;SACpBK,aAAa,EAAE,IAAI;SACnBC,eAAe,EAAE;QACjB,CAAC;OAEF,IAAIC,yBAAyB,GAAG,IAAI;OACpC,IAAI3mB,KAAK,CAAC4mB,WAAW,EAAE,EACvB;SACC,IAAMC,4BAA4B,GAAG1tB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;WACxDC,KAAK,EAAE;aACN2E,IAAI,EAAE,UAAU;aAChBsX,EAAE,EAAE,iBAAiB,GAAGoQ,MAAM;aAC9BrwB,IAAI,EAAE,wBAAwB;aAC9BC,KAAK,EAAE,GAAG;aACV+H,KAAK,EAAE;;UAER,CAAC;SACF,IAAI2C,KAAK,CAAC6Z,sBAAsB,EAAE,EAClC;WACCgN,4BAA4B,CAACtN,YAAY,CAAC,SAAS,EAAE,SAAS,CAAC;;SAEhEoN,yBAAyB,GAAGxtB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAC7CC,KAAK,EAAE;aAAEC,SAAS,EAAE;YAA2C;WAC/Dc,QAAQ,EAAE,CACTysB,4BAA4B,EAC5B1tB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;aACnBC,KAAK,EAAE;eACN,OAAK,iBAAiB,GAAGqsB,MAAM;eAC/BroB,KAAK,EAAE;cACP;aACD9D,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,4CAA4C;YACjE,CAAC;UAEH,CAAC;;OAGH,IAAMU,GAAG,GAAGhB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAC7BC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAA4E;SAChGc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAAEC,SAAS,EAAE;YAAwF;WAC5Gc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;aAClBC,KAAK,EAAE;eAAEC,SAAS,EAAE;cAAmD;aACvEc,QAAQ,EAAE,CACTurB,aAAa,EACbC,cAAc,EACdC,kBAAkB,EAClBC,cAAc,EACdC,iBAAiB,EACjBC,oBAAoB,EACpBC,eAAe,EACf9sB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;eAClBC,KAAK,EAAE;iBAAEC,SAAS,EAAE;gBAAwF;eAC5GC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC,GAAG;cAC5D,CAAC,EACFysB,sBAAsB;YAEvB,CAAC;UAEH,CAAC,EACFS,yBAAyB;QAE1B,CAAC;OAEFN,qBAAqB,CAAC7qB,IAAI,CAACkgB,KAAK,CAAC;OAEjC,OAAOvhB,GAAG;;;KACV;KAAA,yCAEwBoM,UAAU,EAAGvG,KAAK,EAC3C;OACC,IAAM0b,KAAK,GAAG,IAAIrN,aAAa,EAAE;OACjCqN,KAAK,CAAC/M,OAAO,CAACpI,UAAU,CAAC,YAAY,CAAC,CAAC;OACvCmV,KAAK,CAAC9M,QAAQ,CAACrI,UAAU,CAAC,aAAa,CAAC,CAAC;OACzCmV,KAAK,CAAC7M,YAAY,CAACtI,UAAU,CAAC,kBAAkB,CAAC,CAAC;OAClDmV,KAAK,CAAC5M,QAAQ,CAACvI,UAAU,CAAC,aAAa,CAAC,CAAC;OACzCmV,KAAK,CAAC3M,WAAW,CAACxI,UAAU,CAAC,gBAAgB,CAAC,KAAK,GAAG,CAAC;OACvDmV,KAAK,CAAC1M,cAAc,CAACzI,UAAU,CAAC,oBAAoB,CAAC,KAAK,GAAG,CAAC;OAC9DmV,KAAK,CAACzM,SAAS,CAAC1I,UAAU,CAAC,eAAe,CAAC,GAAGA,UAAU,CAAC,eAAe,CAAC,CAACgL,KAAK,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;OAC5FvR,KAAK,CAAC8mB,gBAAgB,CAACpL,KAAK,CAAC;OAE7B,IAAI1b,KAAK,CAAC4mB,WAAW,EAAE,EACvB;SACC5mB,KAAK,CAAC+mB,uBAAuB,CAC5BxgB,UAAU,CAAC,wBAAwB,CAAC,IAAKA,UAAU,CAAC,wBAAwB,CAAC,KAAM,GAAG,CACtF;;OAGF,OAAO,IAAI;;;KACX;KAAA,wCAEuBvG,KAAK,EAC7B;OAAA;OACC,IAAMuF,cAAc,GAAGvF,KAAK,CAACwF,YAAY,EAAE;OAC3C,IAAI,CAACC,iBAAiB,GAAG,IAAIC,yCAAsB,CAACH,cAAc,EAAE;SACnE5F,MAAM,EAAE,sCAAI,YAAUxJ,QAAQ,CAACwP,SAAS,EAAE;SAC1CqhB,eAAe,EAAE,yBAACpxB,KAAK;WAAA,OAAK,MAAI,CAAC4vB,UAAU,CAAC5vB,KAAK,EAAEoK,KAAK,CAAC;;SACzDwlB,UAAU,EAAE,oBAAC5vB,KAAK;WAAA,OAAK,MAAI,CAAC4vB,UAAU,CAAC5vB,KAAK,EAAEoK,KAAK,CAAC;;QACpD,CAAC;OAEF,OAAO7G,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACxBC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAqC;SACzDc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAAEC,SAAS,EAAE;YAA2C;WAC/Dc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;aAClBC,KAAK,EAAE;eAAEC,SAAS,EAAE;cAA2C;aAC/DC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC,GAAG;YAC7D,CAAC,EACF,IAAI,CAACgM,iBAAiB,CAAC/N,UAAU,EAAE;UAEpC,CAAC;QAEH,CAAC;;;KACF;KAAA,2BAEU9B,KAAgB,EAAEoK,KAAY,EACzC;OACCmD,6BAAI,0EAAJ,IAAI,EAAiCvN,KAAK,EAAEoK,KAAK;OACjDmD,6BAAI,0DAAJ,IAAI,EAAyBvN,KAAK;OAClCuN,6BAAI,0DAAJ,IAAI,EAAyBvN,KAAK;OAElC,IAAI,CAACJ,IAAI,CACR,6BAA6B;SAE5BgU,QAAQ,EAAE,IAAI;SACdxJ,KAAK,EAALA;UACGpK,KAAK,CAAC8F,OAAO,EAAE,EAEnB;;;KACD;KAAA,6CAE4B6K,UAAU,EAAEvG,KAAK,EAC9C;OACCA,KAAK,CAACwG,YAAY,CAAClP,iCAAc,CAACmP,cAAc,CAACF,UAAU,CAAC,CAAC;OAE7D,OAAO,IAAI;;;KACX;KAAA,wCAGD;OAAA,IADsBgY,WAAe,uEAAG,EAAE;OAEzC,IAAM0I,YAAY,GAAG7D,aAAG,CAACC,MAAM,4LAE3B9E,WAAW,CAACzpB,GAAG,CAAC,UAACQ,KAAK,EAAK;SAAC,OAAOyU,cAAI,CAAC6C,MAAM,CAACtX,KAAK,CAAC;QAAC,CAAC,CAACsc,IAAI,CAAC,MAAM,CAAC,CAEvE;OAED,IAAMsV,aAAa,GAAG9D,aAAG,CAACC,MAAM,8LAE5B7pB,aAAG,CAACC,UAAU,CAAC,2DAA2D,CAAC,CAE9E;OACDC,eAAK,CAACytB,QAAQ,CAACD,aAAa,EAAE,OAAO,EAAE,YAAM;SAC5C/tB,aAAG,CAACkE,KAAK,CAAC4pB,YAAY,EAAE,QAAQ,EAAEA,YAAY,CAACG,YAAY,GAAG,IAAI,CAAC;SACnEjuB,aAAG,CAAC4E,MAAM,CAACmpB,aAAa,CAAC;QACzB,CAAC;OAEF,IAAMG,QAAQ,GAAGjE,aAAG,CAACC,MAAM,6HAA0C;OAErE,IAAMzX,KAAK,GAAGwX,aAAG,CAACC,MAAM,wVAIZ7pB,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC,EACpEytB,aAAa,EAEdD,YAAY,EAEbI,QAAQ,CAEX;OAED3tB,eAAK,CAACytB,QAAQ,CAACE,QAAQ,EAAE,OAAO,EAAE,YAAM;SAACluB,aAAG,CAAC4E,MAAM,CAAC6N,KAAK,CAAC;QAAC,CAAC;OAE5D,OAAOA,KAAK;;;KACZ;KAAA,kCAEiBhJ,IAAI,EAAE5C,KAAK,EAAE0B,QAAQ,EAAE4lB,OAAO,EAChD;OAAA;OACC,IAAIA,OAAO,EACX;SACCA,OAAO,CAAC/pB,SAAS,CAAC1I,GAAG,CAAC,0BAA0B,CAAC;;OAGlD,IAAI,CAAC0yB,yBAAyB,EAAE;OAChC,IAAM5iB,QAAQ,GAAG1I,EAAE,CAAC2I,IAAI,CAACC,WAAW,CAACjC,IAAI,CAAC;OAE1C,IAAMqE,OAAO,GAAG,sCAAI,YAAUA,OAAO;OACrC,IAAMmQ,cAAc,GAAG,sCAAI,YAAUhQ,cAAc;OACnDnL,EAAE,CAAC2I,IAAI,CAAC;SACPkC,MAAM,EAAE,MAAM;SACdC,QAAQ,EAAE,MAAM;SAChBC,GAAG,EAAEyD,aAAG,CAACC,QAAQ,CAChBzD,OAAO,EACP;WACC9B,cAAc,4BAAqBnF,KAAK,CAAC3I,KAAK,GAAG,QAAQ,GAAG,EAAE,mBAAS2I,KAAK,CAACnK,IAAI,CAACjD,IAAI,CAACiJ,WAAW,EAAE;UACpG,CACD;SACDhG,IAAI,EAAE;WACLqR,WAAW,EAAE,qBAAqB;WAClCC,eAAe,EAAEiQ,cAAc;WAC/BqL,UAAU,EAAEnjB,MAAM,CAACojB,YAAY,CAAC1iB,KAAK,CAAC/E,SAAS,EAAE,CAAC;WAClDusB,cAAc,EAAEloB,MAAM,CAACojB,YAAY,CAAC/d,QAAQ,CAAC,MAAM,CAAC,CAAC;WACrD8iB,SAAS,EAAE9iB,QAAQ,CAAC,MAAM,CAAC;UAC3B;;SACD0C,SAAS,EAAE,mBAAAC,QAAQ,EAAI;WACtB,IAAIggB,OAAO,EACX;aACCA,OAAO,CAAC/pB,SAAS,CAACQ,MAAM,CAAC,0BAA0B,CAAC;;WAGrD,IAAIuJ,QAAQ,CAACogB,OAAO,EACpB;aACC1nB,KAAK,CAAC2nB,UAAU,CAACrgB,QAAQ,CAAC+P,IAAI,CAACrX,KAAK,CAAC;aACrC,MAAI,CAAC4nB,wBAAwB,CAACjjB,QAAQ,CAAC,MAAM,CAAC,EAAE3E,KAAK,CAAC;aACtD,MAAI,CAAC+E,4BAA4B,CAACJ,QAAQ,CAAC,MAAM,CAAC,EAAE3E,KAAK,CAAC;aAE1DA,KAAK,CAAC3I,KAAK,GAAG,KAAK;aAEnB2I,KAAK,CAACoF,MAAM,EAAE;aACd,MAAI,CAAC1E,YAAY,EAAE;aACnB,IAAIgB,QAAQ,EACZ;eACCA,QAAQ,CAAC4F,QAAQ,CAAC+P,IAAI,CAAC;;YAExB,MAED;aACCzL,KAAK,CAACtE,QAAQ,CAACugB,MAAM,CAAC,CAAC,CAAC,CAAC;;;QAG3B,CAAC;;;KACF;KAAA,4BAGD;OACC,IAAMhyB,IAAI,GAAGoG,EAAE,CAAC7G,KAAK,mCAAC,IAAI,WAAO;OACjCS,IAAI,CAAC,sBAAsB,CAAC,GAAG,IAAI,CAACgqB,kBAAkB,EAAE,GAAG,CAAC,GAAG,CAAC;OAChEhqB,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE;OAEnB,KAAK,IAAI4J,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,sCAAI,WAASR,MAAM,EAAE,EAAEQ,CAAC,EAC5C;SACC5J,IAAI,CAAC,QAAQ,CAAC,CAACnC,IAAI,CAAC,sCAAI,WAAS+L,CAAC,CAAC,CAACxE,SAAS,EAAE,CAAC;;OAGjD,OAAOpF,IAAI;;;KACX;KAAA,qCAGD;OACC,OAAQ,IAAI,CAACiyB,gBAAgB,KAAK,IAAI;;;KACtC;KAAA,qCAEoB1lB,QAAQ,EAC7B;OACC,IAAI,CAAC0lB,gBAAgB,GAAG1lB,QAAQ,KAAK,KAAK;;;KAC1C;KAAA,6BAEYkT,EAAE,EACf;OACC,OAAO,sCAAI,WAAS/e,IAAI,CAAC,UAAAyJ,KAAK;SAAA,OAAIA,KAAK,CAACrH,KAAK,EAAE,KAAK2c,EAAE;SAAC;;;KACvD;KAAA,6BAGD;OACC,OAAO,IAAI,CAAClT,QAAQ;;;KACpB;KAAA,6BAEYA,QAAQ,EACrB;OACC,IAAI,CAACA,QAAQ,GAAGA,QAAQ,KAAK,KAAK;OAElC,IAAI,IAAI,CAACA,QAAQ,EACjB;SACC,IAAI,CAAC5M,IAAI,CAAC,mBAAmB,CAAC;;;;KAE/B;KAAA,+BAGD;OAAA;OACC,IAAMypB,SAAS,GAAG,EAAE;OAEpBhJ,MAAM,CAAC8R,IAAI,CAAC,sCAAI,WAAO1I,SAAS,CAAC,CAAC9rB,OAAO,CAAC,UAAA+hB,EAAE,EAAI;SAC/C,IAAM+D,QAAQ,GAAGpjB,iBAAO,CAACb,KAAK,CAAC,wCAAI,WAAOiqB,SAAS,CAAC/J,EAAE,CAAC,CAAC;SAExD+D,QAAQ,CAACtmB,EAAE,GAAGuiB,EAAE;SAChB+D,QAAQ,CAAChR,QAAQ,GAAG,UAAU;SAC9BgR,QAAQ,CAAC5Q,gBAAgB,GAAG,aAAa,GAAG6M,EAAE,GAAG,GAAG;SACpD+D,QAAQ,CAAC7Q,UAAU,GAAG,OAAO,GAAG8M,EAAE,GAAG,IAAI;SAEzC2J,SAAS,CAACvrB,IAAI,CAAC2lB,QAAQ,CAAC;QACxB,CAAC;OAEF,OAAO4F,SAAS;;;KAChB;KAAA,4BAEW3J,EAAE,EACd;OACC,IAAM2J,SAAS,GAAG,IAAI,CAACd,YAAY,EAAE;OAErC,KAAK,IAAI1e,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGwf,SAAS,CAAChgB,MAAM,EAAE,EAAEQ,CAAC,EACzC;SACC,IAAIwf,SAAS,CAACxf,CAAC,CAAC,CAAC1M,EAAE,KAAKuiB,EAAE,EAC1B;WACC,OAAO2J,SAAS,CAACxf,CAAC,CAAC;;;OAIrB,OAAO,IAAI;;;KACX;KAAA,4BAEWpE,QAAQ,EACpB;OACC,IAAMia,EAAE,GAAGja,QAAQ,CAACtI,EAAE,IAAI,IAAI,CAACi1B,kBAAkB,CAAC,UAAU,EAAE,sCAAI,WAAO3I,SAAS,CAAC;OAEnF,IAAI,sCAAI,WAAOA,SAAS,CAAC/J,EAAE,CAAC,EAC5B;SACC,mCAA2BA,EAAE;;OAG9B,sCAAI,WAAO+J,SAAS,CAAC/J,EAAE,CAAC,GAAGja,QAAQ;OAEnC,IAAI,CAAC7F,IAAI,CAAC,uBAAuB,CAAC;;;;;;OAMlC,OAAO,IAAI,CAACyyB,WAAW,CAAC3S,EAAE,CAAC;;;KAC3B;KAAA,+BAEcA,EAAE,EAAEja,QAAQ,EAC3B;OACC,IAAI,CAAC,sCAAI,WAAOgkB,SAAS,CAAC/J,EAAE,CAAC,EAC7B;SACC,mCAA2BA,EAAE;;;;OAI9B,sCAAI,WAAO+J,SAAS,CAAC/J,EAAE,CAAC,CAAC4S,WAAW,GAAG7sB,QAAQ,CAAC6sB,WAAW;OAE3D,IAAI,CAAC1yB,IAAI,CAAC,0BAA0B,EAAE;SAAC6jB,QAAQ,EAAE,IAAI,CAAC4O,WAAW,CAAC3S,EAAE;QAAE,CAAC;;;;;;OAMvE,OAAO,IAAI,CAAC2S,WAAW,CAAC3S,EAAE,CAAC;;;KAC3B;KAAA,+BAEcA,EAAE,EACjB;OACC,OAAO,sCAAI,WAAO+J,SAAS,CAAC/J,EAAE,CAAC;OAE/B,OAAO,IAAI;;;KACX;KAAA,iCAEgBA,EAAE,EAAEhgB,KAAK,EAC1B;OACC,IAAI,sCAAI,WAAO+pB,SAAS,CAAC/J,EAAE,CAAC,EAC5B;SACC,sCAAI,WAAO+J,SAAS,CAAC/J,EAAE,CAAC,CAAC,SAAS,CAAC,GAAGhgB,KAAK;SAE3C,OAAO,IAAI;;OAGZ,OAAO,KAAK;;;KACZ;KAAA,gCAGD;OAAA;OACC,IAAMgZ,MAAM,GAAG,EAAE;OAEjB2H,MAAM,CAAC8R,IAAI,CAAC,sCAAI,WAAOzI,UAAU,CAAC,CAAC/rB,OAAO,CAAC,UAAA+hB,EAAE,EAAI;SAChD,IAAM6S,KAAK,GAAGlsB,EAAE,CAAC7G,KAAK,CAAC,yCAAI,WAAOkqB,UAAU,CAAChK,EAAE,CAAC,CAAC;SAEjD6S,KAAK,CAACp1B,EAAE,GAAGuiB,EAAE;SACb6S,KAAK,CAAC9f,QAAQ,GAAG,UAAU;SAC3B8f,KAAK,CAAC1f,gBAAgB,GAAG,aAAa,GAAG6M,EAAE,GAAG,GAAG;SACjD6S,KAAK,CAAC3f,UAAU,GAAG,OAAO,GAAG8M,EAAE,GAAG,IAAI;SAEtChH,MAAM,CAAC5a,IAAI,CAACy0B,KAAK,CAAC;QAClB,CAAC;OAEF,OAAO7Z,MAAM;;;KACb;KAAA,6BAEYgH,EAAE,EACf;OACC,IAAMhH,MAAM,GAAG,IAAI,CAAC+P,aAAa,EAAE;OAEnC,KAAK,IAAI5e,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG6O,MAAM,CAACrP,MAAM,EAAE,EAAEQ,CAAC,EACtC;SACC,IAAI6O,MAAM,CAAC7O,CAAC,CAAC,CAAC1M,EAAE,KAAKuiB,EAAE,EACvB;WACC,OAAOhH,MAAM,CAAC7O,CAAC,CAAC;;;OAIlB,OAAO,IAAI;;;KACX;KAAA,6BAEYpE,QAAQ,EACrB;OACC,IAAMia,EAAE,GAAGja,QAAQ,CAACtI,EAAE,IAAI,IAAI,CAACi1B,kBAAkB,CAAC,WAAW,EAAE,sCAAI,WAAO1I,UAAU,CAAC;OAErF,IAAI,sCAAI,WAAOA,UAAU,CAAChK,EAAE,CAAC,EAC7B;SACC,oCAA4BA,EAAE;;OAG/B,sCAAI,WAAOgK,UAAU,CAAChK,EAAE,CAAC,GAAGja,QAAQ;OAEpC,IAAI,CAAC7F,IAAI,CAAC,wBAAwB,EAAE;SAAC4yB,SAAS,EAAE,IAAI,CAACC,YAAY,CAAC/S,EAAE;QAAE,CAAC;;;;;;OAMvE,OAAO,IAAI,CAAC+S,YAAY,CAAC/S,EAAE,CAAC;;;KAC5B;KAAA,gCAEeA,EAAE,EAAEja,QAAQ,EAC5B;OACC,IAAI,CAAC,sCAAI,WAAOikB,UAAU,CAAChK,EAAE,CAAC,EAC9B;SACC,oCAA4BA,EAAE;;;;OAI/B,sCAAI,WAAOgK,UAAU,CAAChK,EAAE,CAAC,CAAC4S,WAAW,GAAG7sB,QAAQ,CAAC6sB,WAAW;OAE5D,IAAI,CAAC1yB,IAAI,CAAC,2BAA2B,EAAE;SAAC4yB,SAAS,EAAE,IAAI,CAACC,YAAY,CAAC/S,EAAE;QAAE,CAAC;;;;;;OAM1E,OAAO,IAAI,CAAC+S,YAAY,CAAC/S,EAAE,CAAC;;;KAC5B;KAAA,gCAEeA,EAAE,EAClB;OACC,OAAO,sCAAI,WAAOgK,UAAU,CAAChK,EAAE,CAAC;OAEhC,OAAO,IAAI;;;KACX;KAAA,kCAEiBA,EAAE,EAAEhgB,KAAK,EAC3B;OACC,IAAI,sCAAI,WAAOgqB,UAAU,CAAChK,EAAE,CAAC,EAC7B;SACC,sCAAI,WAAOgK,UAAU,CAAChK,EAAE,CAAC,CAAC,SAAS,CAAC,GAAGhgB,KAAK;SAE5C,OAAO,IAAI;;OAGZ,OAAO,KAAK;;;KACZ;KAAA,+BAGD;OAAA;OACC,IAAM4pB,SAAS,GAAG,EAAE;OAEpBjJ,MAAM,CAAC8R,IAAI,CAAC,sCAAI,WAAOxI,SAAS,CAAC,CAAChsB,OAAO,CAAC,UAAA+hB,EAAE,EAAI;SAC/C,IAAM6D,QAAQ,GAAGljB,iBAAO,CAACb,KAAK,CAAC,yCAAI,WAAOmqB,SAAS,CAACjK,EAAE,CAAC,CAAC;SAExD6D,QAAQ,CAACpmB,EAAE,GAAGuiB,EAAE;SAChB6D,QAAQ,CAAC9Q,QAAQ,GAAG,UAAU;SAC9B8Q,QAAQ,CAAC1Q,gBAAgB,GAAG,aAAa,GAAG6M,EAAE,GAAG,GAAG;SACpD6D,QAAQ,CAAC3Q,UAAU,GAAG,aAAa,GAAG8M,EAAE,GAAG,GAAG;SAE9C4J,SAAS,CAACxrB,IAAI,CAACylB,QAAQ,CAAC;QACxB,CAAC;OAEF,OAAO+F,SAAS;;;KAChB;KAAA,mCAEkB1O,MAAM,EAAE8X,UAAU,EACrC;OACC,IAAIra,KAAK;OACT,KAAIA,KAAK,GAAG,CAAC,EAAEA,KAAK,IAAI,IAAI,EAAE,EAAEA,KAAK,EACrC;SACC,IAAI,CAACqa,UAAU,CAAC9X,MAAM,GAAGvC,KAAK,CAAC,EAC/B;WACC,MAAM;;;;OAIR,OAAOuC,MAAM,GAAGvC,KAAK;;;KACrB;KAAA,gCAGD;OACC,IAAM+O,MAAM,GAAG;SACdxP,QAAQ,EAAE,IAAIhZ,GAAG,EAAE;SACnByoB,QAAQ,EAAE,IAAIzoB,GAAG,EAAE;SACnB0oB,QAAQ,EAAE,IAAI1oB,GAAG,EAAE;SACnB2oB,SAAS,EAAE,IAAI3oB,GAAG,EAAE;SACpB4oB,cAAc,EAAE,IAAI5oB,GAAG,EAAE;SACzB6oB,cAAc,EAAE,IAAI7oB,GAAG,EAAE;SACzB8oB,QAAQ,EAAE,IAAI9oB,GAAG;QACjB;OAED,sCAAI,WAASjB,OAAO,CAAC,UAAAyM,KAAK,EAAI;SAC7B,IAAMuoB,WAAW,GAAGvoB,KAAK,CAACie,aAAa,EAAE;SAEzChI,MAAM,CAAC8R,IAAI,CAAC/K,MAAM,CAAC,CAACzpB,OAAO,CAAC,UAAAgI,GAAG,EAAI;WAClCgtB,WAAW,CAAChtB,GAAG,CAAC,CAAChI,OAAO,CAAC,UAAAi1B,KAAK,EAAI;aACjC,IAAI,CAACxL,MAAM,CAACzhB,GAAG,CAAC,CAAC5G,GAAG,CAAC6zB,KAAK,CAAC,EAC3B;eACCxL,MAAM,CAACzhB,GAAG,CAAC,CAAC1G,GAAG,CAAC2zB,KAAK,CAAC;;YAEvB,CAAC;UACF,CAAC;QACF,CAAC;OAEF,OAAOxL,MAAM;;;KACb;KAAA,qCAEoByL,SAAiB,EAAE/yB,QAA6B,EACrE;OACC,sCAAI,WAASnC,OAAO,CAAC,UAAAyM,KAAK;SAAA,OAAIA,KAAK,CAACrK,SAAS,CAAC8yB,SAAS,EAAE/yB,QAAQ,CAAC;SAAC;OAEnE,OAAO,IAAI;;;KACX;KAAA,uCAEsB+yB,SAAiB,EAAE/yB,QAA6B,EACvE;OACC,sCAAI,WAASnC,OAAO,CAAC,UAAAyM,KAAK;SAAA,OAAIA,KAAK,CAAC0oB,WAAW,CAACD,SAAS,EAAE/yB,QAAQ,CAAC;SAAC;OAErE,OAAO,IAAI;;;KACX;KAAA,oCAEmBsI,IAAY,EAChC;OACC,OAAO,sCAAI,YAAUtH,eAAe,CAACH,IAAI,CAAC,UAAAuW,IAAI;SAAA,OAAIA,IAAI,CAAC,OAAO,CAAC,KAAK9O,IAAI;SAAC;;;KACzE;KAAA,oBA3mDD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAumDD;OACC,OAAO,sCAAI,YAAU2qB,iBAAiB,GAAG,sCAAI,YAAUA,iBAAiB,CAACvP,eAAe,GAAG,EAAE;;;KAC7F;KAAA,oBAGD;OACC,OAAO,sCAAI,YAAUuP,iBAAiB,GAAG,sCAAI,YAAUA,iBAAiB,CAACzP,eAAe,GAAG,EAAE;;;KAC7F;KAAA,4BAtpDkB0P,WAAqB,EAAE5oB,KAAY,EAAEic,WAAmB,EAC3E;OACC,IAAMpB,WAAW,GAAG7a,KAAK,CAAC6oB,MAAM,CAACD,WAAW,EAAE3M,WAAW,CAAC;OAC1D2M,WAAW,CAACpzB,IAAI,CAAC,oBAAoB,EAAE;SAACwK,KAAK,EAAE6a;QAAY,CAAC;;;GAC5D;CAAA,EAnH4B/kB,6BAAY;CAswDzC,2CAr1BiCivB,aAAa,EAC9C;GACC,IAAM+D,gBAAgB,GACrB3lB,6BAAI,gEAAJ,IAAI,EAEFrO,GAAG,CAAC,UAACkL,KAAK;KAAA,OACVA,KAAK,CACHgZ,0BAA0B,EAAE,CAC5B5d,MAAM,CAAC,UAAAwE,KAAK;OAAA,OAAIA,KAAK,CAAC,MAAM,CAAC,KAAK,MAAM;OAAC,CACzC9K,GAAG,CAAC,UAAC8K,KAAK;OAAA,OAAM;SAChB0V,EAAE,eAAQtV,KAAK,CAACrH,KAAK,EAAE,cAAIiH,KAAK,CAAC,IAAI,CAAC,OAAI;SAC1CvF,KAAK,YAAK2F,KAAK,CAACiZ,QAAQ,EAAE,eAAKrZ,KAAK,CAAC,MAAM,CAAC;QAC5C;MAAC,CAAC;IACJ,CAAC,CACDmpB,IAAI,EACN;GAED,IAAI,sCAAI,YAAUtyB,GAAG,CAAC,uCAAuC,CAAC,IAAIsuB,aAAa,EAC/E;KACC,IAAMiE,GAAG,GAAG,IAAI,CAAC1D,WAAW,CAACrvB,iBAAO,CAACb,KAAK,CAAC2vB,aAAa,CAAC,CAAC;KAE1D+D,gBAAgB,CAACp1B,IAAI,CAAC;OACrB4hB,EAAE,EAAE0T,GAAG,CAACxgB,UAAU;OAClBnO,KAAK,EAAEb,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;OACxDwvB,IAAI,EAAE,CAAC,SAAS,EAAE,aAAa,CAAC;OAChCC,IAAI,EAAE;MACN,CAAC;KAEF,IAAMf,KAAK,GAAG,IAAI,CAAC5C,YAAY,CAACtvB,iBAAO,CAACb,KAAK,CAAC2vB,aAAa,CAAC,CAAC;KAE7D+D,gBAAgB,CAACp1B,IAAI,CAAC;OACrB4hB,EAAE,EAAE6S,KAAK,CAAC3f,UAAU;OACpBnO,KAAK,EAAEb,aAAG,CAACC,UAAU,CAAC,kCAAkC,CAAC;OACzDwvB,IAAI,EAAE,CAAC,SAAS,EAAE,aAAa,CAAC;OAChCC,IAAI,EAAE;MACN,CAAC;;GAGH,OAAOJ,gBAAgB;CACxB;CAAC,0CAE+BlzB,KAAgB,EAAEuzB,SAAiB,EACnE;GACC,IAAMtjB,QAAQ,GAAGjQ,KAAK,CAAC8F,OAAO,EAAE,CAACmK,QAAQ;GACzC,IAAMujB,gBAAgB,GAAGxzB,KAAK,CAAC8F,OAAO,EAAE,CAAC0tB,gBAAgB;GAEzD,IAAIx2B,cAAI,CAACgE,SAAS,CAACwyB,gBAAgB,CAAC,IAAI,CAACA,gBAAgB,EACzD;KACC;;GAGD,IAAMC,cAAc,GACnBlmB,6BAAI,gEAAJ,IAAI,EACyBgmB,SAAS,EACpCr0B,GAAG,CAAC,UAACkL,KAAK;KAAA,OAAM;OAChBsV,EAAE,EAAEtV,KAAK,CAACrH,KAAK,EAAE;OACjB0B,KAAK,EAAE2F,KAAK,CAACiZ,QAAQ,EAAE;OACvB7e,QAAQ,EAAE4F,KAAK,CAACgZ,0BAA0B,EAAE,CAAClkB,GAAG,CAAC,UAAC8K,KAAK;SAAA,OAAM;WAC5D0V,EAAE,EAAE1V,KAAK,CAAC4I,UAAU;WACpBnO,KAAK,EAAEuF,KAAK,CAAC0I,IAAI;WACjBghB,UAAU,EAAE;aAAE1pB,KAAK,EAALA;;UACd;QAAC;MACF;IAAC,CACH;GAED,IAAIypB,cAAc,CAACpqB,MAAM,GAAG,CAAC,EAC7B;KACC4G,QAAQ,CAAC0jB,QAAQ,CAAC,UAAU,EAAE;OAC7BjU,EAAE,EAAE,UAAU;OACdjb,KAAK,EAAEb,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC;OAC1DW,QAAQ,EAAEivB;MACV,CAAC;;CAEJ;CAAC,kCAEuBzzB,KAAgB,EACxC;GACC,IAAMiQ,QAAQ,GAAGjQ,KAAK,CAAC8F,OAAO,EAAE,CAACmK,QAAQ;GACzC,IAAMujB,gBAAgB,GAAGxzB,KAAK,CAAC8F,OAAO,EAAE,CAAC0tB,gBAAgB;GAEzD,IAAIx2B,cAAI,CAACgE,SAAS,CAACwyB,gBAAgB,CAAC,IAAI,CAACA,gBAAgB,EACzD;KACC;;;;GAID,IAAMnK,SAAS,GAAG,IAAI,CAACd,YAAY,EAAE,CAACrpB,GAAG,CAAC,UAACukB,QAAQ,EAAK;KACvD,OAAO;OACN/D,EAAE,EAAE+D,QAAQ,CAAC5Q,gBAAgB;OAC7BpO,KAAK,EAAEgf,QAAQ,CAAC/Q,IAAI;OACpBkhB,UAAU,EAAEhwB,aAAG,CAACC,UAAU,CAAC,gDAAgD,CAAC;OAC5E6vB,UAAU,EAAE;SAAE1pB,KAAK,EAAEyZ;;MACrB;IACD,CAAC;GAEF,IAAI,CAACD,eAAe,CAAC7lB,OAAO,CAAC,UAAC8lB,QAAQ,EAAK;KAC1C4F,SAAS,CAACvrB,IAAI,CAAC;OACd4hB,EAAE,EAAE+D,QAAQ,CAAC5Q,gBAAgB;OAC7BpO,KAAK,EAAEgf,QAAQ,CAAC,MAAM,CAAC;OACvBmQ,UAAU,EAAEnQ,QAAQ,CAACoQ,UAAU;OAC/BH,UAAU,EAAE;SAAE1pB,KAAK,EAAEyZ;;MACrB,CAAC;IACF,CAAC;GAEF,IAAIzmB,cAAI,CAACwb,aAAa,CAAC6Q,SAAS,CAAC,EACjC;KACCpZ,QAAQ,CAAC0jB,QAAQ,CAChB,aAAa,EACb;OACCjU,EAAE,EAAE,aAAa;OACjBjb,KAAK,EAAEb,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;OAC9DW,QAAQ,EAAE6kB;MACV,CACD;;CAEH;CAAC,kCAEuBrpB,KAAgB,EACxC;GACC,IAAMiQ,QAAQ,GAAGjQ,KAAK,CAAC8F,OAAO,EAAE,CAACmK,QAAQ;GACzC,IAAMujB,gBAAgB,GAAGxzB,KAAK,CAAC8F,OAAO,EAAE,CAAC0tB,gBAAgB;GAEzD,IAAIx2B,cAAI,CAACgE,SAAS,CAACwyB,gBAAgB,CAAC,IAAI,CAACA,gBAAgB,EACzD;KACC;;GAGD,IAAMM,UAAU,GAAG,IAAI,CAACxQ,eAAe,CAACpkB,GAAG,CAAC,UAACqkB,QAAQ,EAAK;KACzD,OAAO;OACN7D,EAAE,EAAE6D,QAAQ,CAAC1Q,gBAAgB;OAC7BpO,KAAK,EAAE8e,QAAQ,CAAC7Q,IAAI;OACpBkhB,UAAU,EAAErQ,QAAQ,CAACsQ,UAAU;OAC/BH,UAAU,EAAE;SAAC1pB,KAAK,EAAEuZ;;MACpB;IACD,CAAC;GAEF,IAAIvmB,cAAI,CAACwb,aAAa,CAACsb,UAAU,CAAC,EAClC;KACC7jB,QAAQ,CAAC0jB,QAAQ,CAChB,kBAAkB,EAClB;OACCjU,EAAE,EAAE,kBAAkB;OACtBjb,KAAK,EAAEb,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC;OACrEW,QAAQ,EAAEsvB;MACV,CACD;;CAEH;CAAC,uCAGD;GAAA,IAD2BP,SAAiB,uEAAGtsB,SAAS;GAEvD,IAAM8sB,MAAM,GAAG,CAAAR,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAExwB,KAAK,EAAE,KAAI,EAAE;GAEvC,OAAO,IAAI,CACT8Q,MAAM,CACNrO,MAAM,CAAC,UAACwuB,aAAa;KAAA,OACrBA,aAAa,CAACjxB,KAAK,EAAE,KAAKgxB,MAAM,IAAIC,aAAa,CAACC,eAAe,EAAE;IACnE,CAAC;CAEJ;;;;ACrmCD,CAC6C;CAAA;CAAA;CAAA;AAE7C,KAAaryB,SAAS;GASrB,mBAAY8W,MAAe,EAAEwb,KAAK,EAClC;KAAA;KAAAz2B;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KACC,sCAAI,WAAW,UAAU;KACzB,sCAAI,UAAU,EAAE;KAChB,sCAAI,aAAa,QAAQ;KACzB,sCAAI,YAAU,EAAE;KAEhB,IAAI,CAAC02B,WAAW,GAAG,IAAI;KAEvB,IAAIn3B,cAAI,CAACuC,aAAa,CAACmZ,MAAM,CAAC,EAC9B;OACC,IAAIA,MAAM,CAAC,QAAQ,CAAC,EACpB;SACC,IAAI,CAAC0b,SAAS,CAAC1b,MAAM,CAAC,QAAQ,CAAC,CAAC;;OAEjC,IAAIA,MAAM,CAAC,OAAO,CAAC,EACnB;SACC,IAAI,CAAC2b,QAAQ,CAAC3b,MAAM,CAAC,OAAO,CAAC,CAAC;;OAE/B,IAAIA,MAAM,CAAC,UAAU,CAAC,EACtB;SACC,IAAI,CAAC4b,WAAW,CAAC5b,MAAM,CAAC,UAAU,CAAC,CAAC;;OAErC,IAAI,OAAO,IAAIA,MAAM,EACrB;SACC,IAAI,CAACM,QAAQ,CAACN,MAAM,CAAC,OAAO,CAAC,CAAC;;;KAGhC,IAAIwb,KAAK,EACT;OACC,IAAI,CAACC,WAAW,GAAGD,KAAK;;;GAEzB;KAAA;KAAA,wBAGD;OACC,OAAO,IAAItyB,SAAS,CACnB;SACCuE,MAAM,oCAAE,IAAI,UAAQ;SACpB6D,KAAK,oCAAE,IAAI,SAAO;SAClBuqB,QAAQ,oCAAE,IAAI,YAAU;SACxB70B,KAAK,oCAAE,IAAI;QACX,EACD,IAAI,CAACy0B,WAAW,CAChB;;;KACD;KAAA,0BAEShuB,MAAM,EAChB;OACC,IAAInJ,cAAI,CAACkb,cAAc,CAAC/R,MAAM,CAAC,EAC/B;SACC,sCAAI,WAAWA,MAAM;;;;KAEtB;KAAA,yBAOQ6D,KAAK,EACd;OACC,IAAIhN,cAAI,CAACkb,cAAc,CAAClO,KAAK,CAAC,EAC9B;SACC,sCAAI,UAAUA,KAAK;;;;KAEpB;KAAA,4BAOWuqB,QAAQ,EACpB;OACC,IAAI,CAACA,QAAQ,EACb;SACCA,QAAQ,GAAGC,0BAAQ,CAACC,KAAK;;OAG1B,sCAAI,aAAaF,QAAQ;;;KACzB;KAAA,yBAOQ70B,KAAK,EACd;OACC,sCAAI,YAAUA,KAAK;OACnB,IAAI,sCAAI,iBAAe80B,0BAAQ,CAACC,KAAK,IAAI,sCAAI,gBAAY,EAAE,EAC3D;SACC,sCAAI,aAAa,OAAO;QACxB,MACI,IAAI,sCAAI,iBAAeD,0BAAQ,CAACE,SAAS,IAAI,sCAAI,gBAAY,EAAE,EACpE;SACC,sCAAI,aAAa,QAAQ;;;;KAE1B;KAAA,4BAQD;OACC,OAAO;SACNvuB,MAAM,oCAAE,IAAI,UAAQ;SACpB6D,KAAK,oCAAE,IAAI,SAAO;SAClBuqB,QAAQ,oCAAE,IAAI,YAAU;SACxB70B,KAAK,oCAAE,IAAI;QACX;;;KACD;KAAA,oBA1DD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAWD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAaD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAgBD;OACC,yCAAO,IAAI;;;GACX;CAAA;;;;ACpHF,CAG6C;CAAA;CAAA;AAE7C,KAAagC,cAAc;GAyB1B,wBAAYgX,MAAe,EAC3B;KAAA;KAAA;KAAAjb;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KACC,sCAAI,WAASiE,cAAc,CAACygB,cAAc,CAACwS,KAAK;KAChD,sCAAI,UAAU,EAAE;KAEhB,IAAI33B,cAAI,CAACuC,aAAa,CAACmZ,MAAM,CAAC,EAC9B;OACC,IAAIA,MAAM,CAAC,MAAM,CAAC,EAClB;SACC,sCAAI,WAASA,MAAM,CAAC,MAAM,CAAC;;OAE5B,IAAI1b,cAAI,CAACU,OAAO,CAACgb,MAAM,CAAC,OAAO,CAAC,CAAC,EACjC;SACCA,MAAM,CAAC,OAAO,CAAC,CAAC/a,OAAO,CAAC,UAAAuZ,IAAI,EAAI;WAC/B,IAAMlU,SAAS,GAAG,IAAIpB,SAAS,CAACsV,IAAI,CAAC,CAAC,CAAC,EAAE,KAAI,CAAC;WAC9C,KAAI,CAAC0d,OAAO,CAAC5xB,SAAS,EAAEkU,IAAI,CAAC,CAAC,CAAC,CAAC;UAChC,CAAC;;OAEH,IAAIla,cAAI,CAACuC,aAAa,CAACmZ,MAAM,CAAC,eAAe,CAAC,CAAC,EAC/C;SACC,sCAAI,kBAAkBA,MAAM,CAAC,eAAe,CAAC;;;;GAG/C;KAAA;KAAA,wBAGD;OACC,IAAMmc,WAAW,GAAG,IAAInzB,cAAc,CAAC;SAAC0G,IAAI,oCAAE,IAAI;QAAO,CAAC;OAC1D,sCAAI,UAAQzK,OAAO,CAAC,gBAAyB;SAAA;WAAvBqF,SAAS;WAAE8xB,MAAM;SACtC,IAAMC,eAAe,GAAG/xB,SAAS,CAACxD,KAAK,EAAE;SACzCu1B,eAAe,CAACZ,WAAW,GAAGU,WAAW;SAEzCA,WAAW,CAACD,OAAO,CAACG,eAAe,EAAED,MAAM,CAAC;QAC5C,CAAC;OAEF,OAAOD,WAAW;;;KAClB;KAAA,wBAmFO7xB,SAAS,EAAE8xB,MAAM,EACzB;OACC,sCAAI,UAAQh3B,IAAI,CAAC,CAACkF,SAAS,EAAE8xB,MAAM,CAAC,CAAC;;;KACrC;KAAA,2BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,4BAGD;OACC,IAAME,UAAU,GAAG,EAAE;OAErB,sCAAI,UAAQr3B,OAAO,CAAC,UAAAuZ,IAAI,EAAI;SAC3B,IAAIA,IAAI,CAAClN,KAAK,KAAK,EAAE,EACrB;WACCgrB,UAAU,CAACl3B,IAAI,CAAC,CAACoZ,IAAI,CAAC,CAAC,CAAC,CAAC7R,SAAS,EAAE,EAAE6R,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;;QAEhD,CAAC;OAEF,OAAO;SACN9O,IAAI,oCAAE,IAAI,UAAM;SAChBgB,KAAK,EAAE4rB,UAAU;SACjBC,aAAa,oCAAE,IAAI;QACnB;;;KACD;KAAA,oBA1GD;OACC,IAAIj4B,cAAI,CAACuC,aAAa,mCAAC,IAAI,kBAAgB,EAC3C;SACC,OAAO,CACN,sCAAI,kBAAgBmoB,QAAQ,EAC5B,sCAAI,kBAAgBwN,OAAO,EAC3B,sCAAI,kBAAgBC,OAAO,CAC3B;;OAGF,OAAO,EAAE;;;KACT;KAAA,oBAGD;OACC,yCAAO,IAAI;MACX;KAAA,kBAEQ/sB,IAAY,EACrB;OACC,IAAIiY,MAAM,CAAChiB,MAAM,CAACqD,cAAc,CAACygB,cAAc,CAAC,CAAC7gB,QAAQ,CAAC8G,IAAI,CAAC,EAC/D;SACC,sCAAI,WAASA,IAAI;;OAGlB,OAAO,IAAI;;;KACX;KAAA,oBAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,+BAEqBuI,UAAU,EAAEiK,MAAM,EACxC;OACC,IAAMjL,cAAc,GAAG,IAAIjO,cAAc,EAAE;OAC3C,IAAI,CAACkZ,MAAM,EACX;SACCA,MAAM,GAAG,YAAY;;OAGtB,IAAI5d,cAAI,CAACU,OAAO,CAACiT,UAAU,CAACiK,MAAM,GAAG,OAAO,CAAC,CAAC,EAC9C;SACC,KAAK,IAAI/Q,CAAC,GAAG,CAAC,EAAEurB,UAAU,GAAG,CAAC,EAAEvrB,CAAC,GAAG8G,UAAU,CAACiK,MAAM,GAAG,OAAO,CAAC,CAACvR,MAAM,EAAE,EAAEQ,CAAC,EAAE,EAAEurB,UAAU,EAC1F;WACC,IAAIzkB,UAAU,CAACiK,MAAM,GAAG,OAAO,CAAC,CAAC/Q,CAAC,CAAC,KAAK,EAAE,EAC1C;aACC;;WAGD,IAAM7G,SAAS,GAAG,IAAIpB,SAAS,CAAC,EAAE,EAAE+N,cAAc,CAAC;WACnD3M,SAAS,CAACoxB,SAAS,CAACzjB,UAAU,CAACiK,MAAM,GAAG,QAAQ,CAAC,CAAC/Q,CAAC,CAAC,CAAC;WACrD7G,SAAS,CAACqxB,QAAQ,CAAC1jB,UAAU,CAACiK,MAAM,GAAG,OAAO,CAAC,CAAC/Q,CAAC,CAAC,CAAC;WACnD7G,SAAS,CAACsxB,WAAW,CAAC3jB,UAAU,CAACiK,MAAM,GAAG,UAAU,CAAC,CAAC/Q,CAAC,CAAC,CAAC;WAEzD,IAAMnK,KAAK,GACVsD,SAAS,CAACuxB,QAAQ,KAAKC,0BAAQ,CAACa,OAAO,GACpC,CAAC1kB,UAAU,CAACiK,MAAM,GAAG,OAAO,CAAC,CAACwa,UAAU,CAAC,EAAEzkB,UAAU,CAACiK,MAAM,GAAG,OAAO,CAAC,CAACwa,UAAU,GAAG,CAAC,CAAC,CAAC,GACxFzkB,UAAU,CAACiK,MAAM,GAAG,OAAO,CAAC,CAACwa,UAAU,CAAC;WAE5CpyB,SAAS,CAACgW,QAAQ,CAACtZ,KAAK,CAAC;WAEzB,IAAIo1B,MAAM,GAAGpzB,cAAc,CAAC4zB,MAAM,CAACC,GAAG;WACtC,IAAI5kB,UAAU,CAACiK,MAAM,GAAG,QAAQ,CAAC,IAAIjK,UAAU,CAACiK,MAAM,GAAG,QAAQ,CAAC,CAAC/Q,CAAC,CAAC,KAAKnI,cAAc,CAAC4zB,MAAM,CAACE,EAAE,EAClG;aACCV,MAAM,GAAGpzB,cAAc,CAAC4zB,MAAM,CAACE,EAAE;;WAGlC,IAAIxyB,SAAS,CAACuxB,QAAQ,KAAKC,0BAAQ,CAACa,OAAO,EAC3C;aACCD,UAAU,EAAE;;WAGbzlB,cAAc,CAACilB,OAAO,CAAC5xB,SAAS,EAAE8xB,MAAM,CAAC;;;OAI3C,OAAOnlB,cAAc;;;GACrB;CAAA;CA6BD,4BA3KYjO,cAAc,oBAEF;GACvBizB,KAAK,EAAE,OAAO;GACdvS,KAAK,EAAE;CACR,CAAC;CAAA,4BALW1gB,cAAc,YAMV;GACf6zB,GAAG,EAAE,KAAK;GACVC,EAAE,EAAE,IAAI;GAERC,OAAO,mBAACrtB,IAAI,EACZ;KACC,IAAIA,IAAI,KAAK,IAAI,CAACotB,EAAE,EACpB;OACC,OAAO5xB,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;;KAG/D,OAAOD,aAAG,CAACC,UAAU,CAAC,wCAAwC,CAAC;;CAEjE,CAAC;;;;;;;ACxBF,CAa6C;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE7C,KAAa6xB,iBAAiB;GAuB7B,2BAAY1yB,SAAS,EAAE6U,OAAkC,EACzD;KAAA;KAAApN;KAAAA;KAAAA;KAAAhN;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA,OAP4B;;KAAIA;OAAA;OAAA;;KAQ/B,sCAAI,gBAAcuF,SAAS;KAC3B,sCAAI,aAAW,EAAE;KACjB,sCAAI,WAAWtB,iCAAc,CAAC4zB,MAAM,CAACC,GAAG;KACxC,sCAAI,gBAAgB,YAAY;KAEhC,IAAIv4B,cAAI,CAACuC,aAAa,CAACsY,OAAO,CAAC,EAC/B;OAAA;OACC,IAAI7a,cAAI,CAACU,OAAO,CAACma,OAAO,CAAC9N,MAAM,CAAC,EAChC;SACC,sCAAI,aAAW8N,OAAO,CAAC9N,MAAM,CAAC7K,GAAG,CAAC,UAAA8K,KAAK,EAAI;WAC1CA,KAAK,CAACyI,QAAQ,GAAG,UAAU;WAE3B,OAAOzI,KAAK;UACZ,CAAC;;OAGH,IAAI6N,OAAO,CAACid,MAAM,IAAIjd,OAAO,CAACid,MAAM,KAAKpzB,iCAAc,CAAC4zB,MAAM,CAACE,EAAE,EACjE;SACC,sCAAI,WAAW9zB,iCAAc,CAAC4zB,MAAM,CAACE,EAAE;;OAExC,IAAI3d,OAAO,CAAC3D,WAAW,EACvB;SACC,sCAAI,gBAAgB2D,OAAO,CAAC3D,WAAW;;OAGxC,sCAAI,mBAAmB2D,OAAO,CAACiX,cAAc;OAC7C,sCAAI,oBAAoBjX,OAAO,CAACuZ,eAAe;OAC/C,sCAAI,eAAevZ,OAAO,CAAC+X,UAAU;OACrC,sCAAI,gDAAuB/X,OAAO,CAAC7H,kBAAkB,yEAAI,IAAI;;;GAE9D;KAAA;KAAA,6BAGD;OACC,IAAM2lB,mBAAmB,GAAG,IAAI,CAACC,UAAU,GAAGryB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACjEC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd3I,IAAI,EAAE,sCAAI,kBAAgB,UAAU;WACpCC,KAAK,EAAE,sCAAI,gBAAYyG;;QAExB,CAAC;OACF,IAAM0vB,kBAAkB,GAAG,IAAI,CAACC,SAAS,GAAGvyB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SAC/DC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd3I,IAAI,EAAE,sCAAI,kBAAgB,SAAS;WACnCC,KAAK,EAAE,sCAAI,gBAAYsK;;QAExB,CAAC;OACF,IAAM+rB,qBAAqB,GAAG,IAAI,CAACC,YAAY,GAAGzyB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACrEC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd3I,IAAI,EAAE,sCAAI,kBAAgB,YAAY;WACtCC,KAAK,EAAE,sCAAI,gBAAY60B;;QAExB,CAAC;OAEF,IAAM70B,KAAK,GAAG1C,cAAI,CAACwb,aAAa,CAAC,sCAAI,gBAAY9Y,KAAK,CAAC,GAAG,sCAAI,gBAAYA,KAAK,CAAC,CAAC,CAAC,GAAG,sCAAI,gBAAYA,KAAK;OAC1G,IAAI,CAACu2B,SAAS,4BAAG,IAAI,4CAAJ,IAAI,EAAkBv2B,KAAK,CAAC;OAC7C,IAAMw2B,kBAAkB,GAAG,IAAI,CAACD,SAAS;OAEzC,IAAIE,mBAAmB;OACvB,IAAI,sCAAI,gBAAY5B,QAAQ,KAAKC,0BAAQ,CAACa,OAAO,EACjD;SACC,IAAMe,MAAM,GACVp5B,cAAI,CAACwb,aAAa,CAAC,sCAAI,gBAAY9Y,KAAK,CAAC,IAAI,sCAAI,gBAAYA,KAAK,CAAC2J,MAAM,GAAG,CAAC,GAC3E,sCAAI,gBAAY3J,KAAK,CAAC,CAAC,CAAC,GACxB,EAAE;SAGN,sCAAI,uCAAe,IAAI,4CAAJ,IAAI,EAAkB02B,MAAM;SAC/CD,mBAAmB,qCAAG,IAAI,aAAY;;OAGvC,IAAME,mBAAmB,GAAG,IAAI,CAACC,UAAU,GAAG/yB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACjEC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd3I,IAAI,EAAE,sCAAI,kBAAgB,UAAU;WACpCC,KAAK,oCAAE,IAAI;;QAEZ,CAAC;OAEF,IAAMixB,SAAS,GAAG,IAAI,CAACA,SAAS,GAAGptB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SACrDC,KAAK,EAAE;WACNC,SAAS,EAAE;;QAEZ,CAAC;OAEF,IAAI,CAAC6yB,YAAY,EAAE;OACnB,IAAI,CAACC,aAAa,EAAE;OAEpB,IAAMC,gBAAgB,GAAGlzB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAC3CC,KAAK,EAAE;WACNC,SAAS,EAAE;UACX;SACDyJ,MAAM,EAAE;WACPC,KAAK,EAAE,IAAI,CAACspB,eAAe,CAAC3yB,IAAI,CAAC,IAAI;;QAEtC,CAAC;OAEF,IAAM4yB,gBAAgB,GAAGpzB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAC3CC,KAAK,EAAE;WACNC,SAAS,EAAE;UACX;SACDC,IAAI,EAAEjC,iCAAc,CAAC4zB,MAAM,CAACG,OAAO,mCAAC,IAAI;QACxC,CAAC;OAEF3xB,eAAK,CAACC,IAAI,CAAC4yB,gBAAgB,EAAE,OAAO,EAAE,IAAI,CAACC,YAAY,CAAC7yB,IAAI,CAAC,IAAI,EAAE4yB,gBAAgB,CAAC,CAAC;OAErF,IAAI,CAAC50B,IAAI,GAAGwB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAC9BC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAuF;SAC3Gc,QAAQ,EAAE,CACTmxB,mBAAmB,EACnBE,kBAAkB,EAClBE,qBAAqB,EACrBG,kBAAkB,EAClBC,mBAAmB,EACnBE,mBAAmB,EACnB1F,SAAS,EACT8F,gBAAgB,EAChBE,gBAAgB;QAEjB,CAAC;OAEF,OAAO,IAAI,CAAC50B,IAAI;;;KAChB;KAAA,qBAaIiB,SAAoB,EACzB;OACC,sCAAI,gBAAcA,SAAS;OAC3B,IAAI,CAACuzB,YAAY,EAAE;OACnB,IAAI,CAACC,aAAa,EAAE;;;KACpB;KAAA,+BAGD;OACC,IAAI,CAAC,IAAI,CAAC7F,SAAS,IAAI,mCAAC,IAAI,eAAW,EACvC;SACC;;OAGDptB,aAAG,CAAC2H,KAAK,CAAC,IAAI,CAACylB,SAAS,CAAC;OAEzB,IAAI,sCAAI,gBAAY3mB,KAAK,KAAK,EAAE,EAChC;SACC,IAAMA,KAAK,GAAG,IAAI,CAAC6sB,QAAQ,CAAC,sCAAI,gBAAY1wB,MAAM,EAAE,sCAAI,gBAAY6D,KAAK,CAAC,IAAI,GAAG;SACjF,IAAM8sB,UAAU,4BAAG,IAAI,wCAAJ,IAAI,EAAgB9sB,KAAK,CAAC;SAE7CzG,aAAG,CAAC+I,MAAM,CACTkhB,aAAG,CAACC,MAAM,wJAAwDtZ,cAAI,CAAC6C,MAAM,CAAChN,KAAK,CAAC0I,IAAI,CAAC,GACzF,IAAI,CAACie,SAAS,CACd;SACDptB,aAAG,CAAC+I,MAAM,CACTkhB,aAAG,CAACC,MAAM,0MAENtZ,cAAI,CAAC6C,MAAM,CAAC,IAAI,CAAC+f,gBAAgB,CAAC,sCAAI,gBAAYxC,QAAQ,CAAC,CAAC,GAGhE,IAAI,CAAC5D,SAAS,CACd;SAED,IAAImG,UAAU,EACd;WACCvzB,aAAG,CAAC+I,MAAM,CACTkhB,aAAG,CAACC,MAAM,0JAAwDtZ,cAAI,CAAC6C,MAAM,CAAC8f,UAAU,CAAC,GACzF,IAAI,CAACnG,SAAS,CACd;;QAEF,MAED;SACCptB,aAAG,CAAC+I,MAAM,CACTkhB,aAAG,CAACC,MAAM,0MAENtZ,cAAI,CAAC6C,MAAM,CAAC,IAAI,CAAC+f,gBAAgB,CAACvC,0BAAQ,CAACwC,KAAK,CAAC,CAAC,GAGtD,IAAI,CAACrG,SAAS,CACd;;;;KAEF;KAAA,gCAmCD;OACC,IAAI,IAAI,CAACA,SAAS,EAClB;SACC7sB,eAAK,CAACC,IAAI,CAAC,IAAI,CAAC4sB,SAAS,EAAE,OAAO,EAAE,IAAI,CAACsG,YAAY,CAAClzB,IAAI,CAAC,IAAI,CAAC,CAAC;;;;KAElE;KAAA,+BAGD;OACC,IAAI,CAACmzB,SAAS,EAAE;;;KAChB;KAAA,4BAGD;OACC,IAAI,IAAI,CAACrqB,KAAK,EACd;SACC,IAAI,CAACA,KAAK,CAACjB,IAAI,EAAE;SACjB;;OAGD,IAAM7B,MAAM,GAAG,IAAI,CAACotB,YAAY,EAAE;OAElC,IAAMC,YAAY,GAAG7zB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACxCC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd1E,SAAS,EAAE;;QAEZ,CAAC;OACF,IAAM2zB,WAAW,GAAG9zB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACvCC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd1E,SAAS,EAAE;;QAEZ,CAAC;OACF,IAAM4zB,gBAAgB,GAAG/zB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAC1CC,KAAK,EAAE;WACNC,SAAS,EAAE,4CAA4C;WACvD6Q,QAAQ,EAAE;UACV;SACD/P,QAAQ,EAAE,CAAC6yB,WAAW;QACtB,CAAC;OAEFvzB,eAAK,CAACC,IAAI,CACTuzB,gBAAgB,EAChB,OAAO,EACP,IAAI,CAACC,oBAAoB,CAACxzB,IAAI,CAAC,IAAI,EAAEuzB,gBAAgB,EAAED,WAAW,EAAEttB,MAAM,EAAEqtB,YAAY,CAAC,CACzF;OAED,IAAII,aAAa,GAAG,IAAI,CAACX,QAAQ,CAAC,sCAAI,gBAAY1wB,MAAM,EAAE,sCAAI,gBAAY6D,KAAK,CAAC;OAChF,IAAI,CAAC,sCAAI,gBAAYA,KAAK,EAC1B;SACCwtB,aAAa,GAAGztB,MAAM,CAAC,CAAC,CAAC;;OAG1B,sCAAI,kBAAkBytB,aAAa;OAEnCH,WAAW,CAAC33B,KAAK,GAAG83B,aAAa,CAACr6B,EAAE;OACpCi6B,YAAY,CAAC13B,KAAK,GAAG83B,aAAa,CAAC/kB,QAAQ;OAC3C6kB,gBAAgB,CAAC5T,WAAW,GAAG8T,aAAa,CAAC9kB,IAAI;OAEjD,IAAM+kB,UAAU,4BAAG,IAAI,sCAAJ,IAAI,EAAeD,aAAa,EAAE,sCAAI,gBAAY93B,KAAK,EAAE,sCAAI,gBAAY60B,QAAQ,CAAC;OAErG,IAAMmD,YAAY,GAAGn0B,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACtCC,KAAK,EAAE;WACNC,SAAS,EAAE;UACX;SACDc,QAAQ,EAAE,CAACizB,UAAU;QACrB,CAAC;OAEF,IAAME,cAAc,GAAG,IAAI,CAACC,kBAAkB,CAACJ,aAAa,EAAEE,YAAY,CAAC;OAC3E,IAAMG,eAAe,GAAGt0B,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACzCC,KAAK,EAAE;WACNC,SAAS,EAAE;UACX;SACDc,QAAQ,EAAE,CAACmzB,cAAc;QACzB,CAAC;OAEF,IAAI,sCAAI,gBAAY3tB,KAAK,KAAK,EAAE,EAChC;SACC2tB,cAAc,CAACj4B,KAAK,GAAG,sCAAI,gBAAY60B,QAAQ;;OAGhD,IAAMvnB,IAAI,GAAGzJ,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAC/BC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAyC;SAC7Dc,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aACNC,SAAS,EAAE;YACX;WACDc,QAAQ,EAAE,CAAC8yB,gBAAgB;UAC3B,CAAC,EACFO,eAAe,EACfH,YAAY;QAEb,CAAC;OAEF5zB,eAAK,CAACC,IAAI,CAACszB,WAAW,EAAE,QAAQ,EAAE,IAAI,CAACS,aAAa,CAAC/zB,IAAI,CACxD,IAAI,EACJszB,WAAW,EACXQ,eAAe,EACfH,YAAY,EACZN,YAAY,CACZ,CAAC;OAEF,IAAMtpB,IAAI,GAAG,IAAI;OACjB,IAAI,CAACjB,KAAK,GAAG,IAAIxG,EAAE,CAAC0H,WAAW,CAAC,8BAA8B,EAAE,IAAI,CAAC4iB,SAAS,EAAE;SAC/EjtB,SAAS,EAAE,8BAA8B;SACzCyT,QAAQ,EAAE,KAAK;SACf7I,UAAU,EAAE,IAAI;SAChBH,SAAS,EAAE,KAAK;SAChBF,QAAQ,EAAE,KAAK;SACfoJ,KAAK,EAAE,IAAI;SACXjJ,UAAU,EAAE,EAAE;SACdK,OAAO,EAAE;WAAEspB,eAAe,EAAE;UAAe;SAC3C7pB,OAAO,EAAElB,IAAI;SACb6B,OAAO,EAAE,CACR,IAAIxI,EAAE,CAACyI,iBAAiB,CAAC;WACxBnL,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,+BAA+B,CAAC;WACrDH,SAAS,EAAE,sCAAsC;WACjDyJ,MAAM,EAAE;aACPC,KAAK,mBACL;eACC,kCAAAU,IAAI,gBAAYsmB,SAAS,CAACgD,YAAY,CAAC13B,KAAK,CAAC;eAC7C,kCAAAoO,IAAI,gBAAYumB,QAAQ,CAACgD,WAAW,CAAC33B,KAAK,CAAC;eAC3C,kCAAAoO,IAAI,gBAAYwmB,WAAW,CAACuD,eAAe,CAACG,UAAU,CAACt4B,KAAK,CAAC;eAE7D,IAAMu4B,WAAW,GAAGP,YAAY,CAAC9sB,gBAAgB,CAAC,UAAU,qCAAGkD,IAAI,eAAa,GAAG,SAAS,CAAC;eAE7F,IAAImqB,WAAW,CAAC5uB,MAAM,GAAG,CAAC,EAC1B;iBACC,IAAI3J,KAAK,GAAGu4B,WAAW,CAAC,CAAC,CAAC,CAACv4B,KAAK;iBAEhC,IAAI,kCAAAoO,IAAI,gBAAYymB,QAAQ,KAAKC,0BAAQ,CAACa,OAAO,IAAI4C,WAAW,CAAC5uB,MAAM,GAAG,CAAC,EAC3E;mBACC3J,KAAK,GAAG,CAACu4B,WAAW,CAAC,CAAC,CAAC,CAACv4B,KAAK,EAAEu4B,WAAW,CAAC,CAAC,CAAC,CAACv4B,KAAK,CAAC;;iBAGrD,kCAAAoO,IAAI,gBAAYkL,QAAQ,CAACtZ,KAAK,CAAC;gBAC/B,MAED;iBACC,kCAAAoO,IAAI,gBAAYkL,QAAQ,CAAC,EAAE,CAAC;;eAG7BlL,IAAI,CAACyoB,YAAY,EAAE;eAEnB,IAAMvsB,KAAK,GAAG8D,IAAI,CAAC+oB,QAAQ,CAAC,kCAAA/oB,IAAI,gBAAY3H,MAAM,EAAE,kCAAA2H,IAAI,gBAAY9D,KAAK,CAAC;eAC1E,IAAIA,KAAK,IAAIA,KAAK,CAAChN,IAAI,KAAK,YAAY,EACxC;iBACC,IAAMk7B,KAAK,GAAGR,YAAY,CAACpvB,aAAa,CAAC,SAAS,qCAAGwF,IAAI,eAAa,GAAG,SAAS,CAAC;iBACnF,kCAAAA,IAAI,gBAAYkL,QAAQ,CAACkf,KAAK,GAAGA,KAAK,CAACx4B,KAAK,GAAG,EAAE,CAAC;;eAEnDoO,IAAI,CAACqqB,eAAe,EAAE;eACtB,IAAI,CAACzoB,WAAW,CAAC5C,KAAK,EAAE;;;UAG1B,CAAC,EACF,IAAIzG,EAAE,CAACoJ,qBAAqB,CAAC;WAC5B9L,IAAI,EAAGC,aAAG,CAACC,UAAU,CAAC,uBAAuB,CAAC;WAC9CH,SAAS,EAAG,iCAAiC;WAC7CyJ,MAAM,EAAG;aACRC,KAAK,mBACL;eACC,IAAI,CAACsC,WAAW,CAAC5C,KAAK,EAAE;;;UAG1B,CAAC,CACF;SACDK,MAAM,EAAE;WACPuB,YAAY,0BACZ;aACC,IAAI,CAACE,OAAO,EAAE;aACd,IAAId,IAAI,CAACsqB,WAAW,EACpB;eACCtqB,IAAI,CAACsqB,WAAW,CAACxpB,OAAO,EAAE;eAC1B,OAAOd,IAAI,CAACsqB,WAAY;;aAEzB,OAAOtqB,IAAI,CAACjB,KAAM;;;QAGpB,CAAC;OAEF,IAAI,CAACA,KAAK,CAACjB,IAAI,EAAE;;;KACjB;KAAA,qCAEoB0rB,gBAAgB,EAAED,WAAW,EAAEttB,MAAM,EAAEqtB,YAAY,EAAEp3B,KAAK,EAC/E;OACC,IAAI,CAAC,IAAI,CAACo4B,WAAW,EACrB;SACC,IAAMC,aAAa,GAAGn2B,mCAAgB,EAAE;SACxC,IAAM6H,QAAM,GAAG1J,iBAAO,CAACb,KAAK,CAC3BxC,cAAI,CAACwb,aAAa,mCAAC,IAAI,aAAS,qCAAG,IAAI,eAAW6f,aAAa,CAAC93B,QAAQ,CAACwP,SAAS,EAAE,CACpF;SAED,IAAI,CAACqoB,WAAW,GAAG,IAAIE,0CAAuB,CAAC;WAC9C7rB,OAAO,EAAE,IAAImiB,kCAAe,CAAC;aAC5B7kB,MAAM,EAANA,QAAM;aACN+kB,cAAc,EAAEuJ,aAAa,CAAC93B,QAAQ,CAACkE;YACvC,CAAC;WACFzB,SAAS,oCAAE,IAAI;UACf,CAAC;SAEF,IAAIhG,cAAI,CAACmV,UAAU,mCAAC,IAAI,oBAAkB,EAC1C;WACC,IAAI,CAACimB,WAAW,CAACr4B,SAAS,CAAC,YAAY,oCAAE,IAAI,oBAAkB;;SAGhE,IAAI,CAACq4B,WAAW,CAACr4B,SAAS,CAAC,QAAQ,EAAE,UAACC,KAAK,EAAK;WAC/C,IAAMyF,QAAQ,GAAGzF,KAAK,CAAC8F,OAAO,EAAE,CAACkE,KAAK;WACtCstB,gBAAgB,CAAC5T,WAAW,GAAGje,QAAQ,CAACiN,IAAI;WAC5C2kB,WAAW,CAAC33B,KAAK,GAAG+F,QAAQ,CAACtI,EAAE;WAC/Bi6B,YAAY,CAAC13B,KAAK,GAAG+F,QAAQ,CAACgN,QAAQ;WACtCpM,EAAE,CAACkyB,SAAS,CAAClB,WAAW,EAAE,QAAQ,CAAC;UACnC,CAAC;SAEF,IAAI,CAACe,WAAW,CAAC5I,QAAQ,CAAC8H,gBAAgB,CAAC;;OAG5C,IAAI,CAACc,WAAW,CAACI,QAAQ,CAACx4B,KAAK,CAAC;;;KAChC;KAAA,kCAGD;OACC,sCAAI,IAAI,iBACR;SACC,IAAI,IAAI,CAAC41B,UAAU,EACnB;WACC,IAAI,CAACA,UAAU,CAACl2B,KAAK,GAAG,sCAAI,gBAAYyG,MAAM;;SAE/C,IAAI,IAAI,CAAC2vB,SAAS,EAClB;WACC,IAAI,CAACA,SAAS,CAACp2B,KAAK,GAAG,sCAAI,gBAAYsK,KAAK;;SAE7C,IAAI,IAAI,CAACgsB,YAAY,EACrB;WACC,IAAI,CAACA,YAAY,CAACt2B,KAAK,GAAG,sCAAI,gBAAY60B,QAAQ;;SAEnD,IAAI,IAAI,CAAC0B,SAAS,EAClB;WACC,IAAI,CAACA,SAAS,CAACv2B,KAAK,GAAG1C,cAAI,CAACwb,aAAa,CAAC,sCAAI,gBAAY9Y,KAAK,CAAC,GAAG,sCAAI,gBAAYA,KAAK,CAAC,CAAC,CAAC,GAAG,sCAAI,gBAAYA,KAAK;;SAGpH,IAAI,sCAAI,gBAAY60B,QAAQ,KAAKC,0BAAQ,CAACa,OAAO,EACjD;WACC,IAAMe,MAAM,GAAG,sCAAI,gBAAY12B,KAAK,CAAC,CAAC,CAAC,IAAI,EAAE;WAC7C,sCAAI,IAAI,eACR;aACC,sCAAI,cAAaA,KAAK,GAAG02B,MAAM;YAC/B,MAED;aACC,sCAAI,uCAAe,IAAI,4CAAJ,IAAI,EAAkBA,MAAM;aAC/C7yB,aAAG,CAAC+I,MAAM,mCAAC,IAAI,eAAc,IAAI,CAACvK,IAAI,CAAC;;UAExC,MACI,IAAI/E,cAAI,CAACy7B,SAAS,mCAAC,IAAI,cAAa,EACzC;WACCl1B,aAAG,CAAC4E,MAAM,mCAAC,IAAI,cAAa;WAC5B,sCAAI,cAAe,IAAI;;;;;KAGzB;KAAA,8BAEa0a,UAAgB,EAAE6V,gBAAsB,EAAEhB,YAAkB,EAAEN,YAAY,EACxF;OAAA;OACC,IAAMptB,KAAK,GAAG,IAAI,CAAC6sB,QAAQ,CAACO,YAAY,CAAC13B,KAAK,EAAEmjB,UAAU,CAACnjB,KAAK,CAAC;OACjE,IAAMs2B,YAAY,GAAG,IAAI,CAAC4B,kBAAkB,CAAC5tB,KAAK,EAAE0tB,YAAY,CAAC;;;OAGjE,IAAI1tB,KAAK,CAAChN,IAAI,iEAAK,IAAI,2EAAJ,sBAAqBA,IAAI,GAC5C;SACCuG,aAAG,CAAC2H,KAAK,CAACwsB,YAAY,CAAC;;OAExB,sCAAI,kBAAkB1tB,KAAK;;;OAG3B,IAAI,IAAI,CAAC2uB,YAAY,CAAC3uB,KAAK,CAAC,MAAM,CAAC,EAAEA,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC0uB,gBAAgB,CAACV,UAAU,CAACt4B,KAAK,CAAC,EAC1F;SACCs2B,YAAY,CAACt2B,KAAK,GAAGg5B,gBAAgB,CAACV,UAAU,CAACt4B,KAAK;;OAGvDg5B,gBAAgB,CAACz2B,YAAY,CAAC+zB,YAAY,EAAE0C,gBAAgB,CAACV,UAAU,CAAC;OACxE,IAAI,CAACY,gBAAgB,CAAC5C,YAAY,EAAEhsB,KAAK,EAAE0tB,YAAY,CAAC;;;KACxD;KAAA,iCAEgB7U,UAAgB,EAAE7Y,KAAa,EAAE0tB,YAAyB,EAC3E;OACC,IAAMD,UAAU,GAAGC,YAAY,CAACpvB,aAAa,CAAC,UAAU,qCAAG,IAAI,eAAa,GAAG,SAAS,CAAC;OACzF/E,aAAG,CAAC2H,KAAK,CAACwsB,YAAY,CAAC;OAEvBn0B,aAAG,CAAC+I,MAAM,0BACT,IAAI,sCAAJ,IAAI,EAAetC,KAAK,EAAE,CAAAytB,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAE/3B,KAAK,KAAI,sCAAI,gBAAYA,KAAK,EAAEmjB,UAAU,CAACnjB,KAAK,GACtFg4B,YAAY,CACZ;;;KACD;;KAyBD,yBACSvxB,MAAM,EAAEuZ,EAAE,EACnB;OACC,IAAI1V,KAAK;OACT,IAAMI,KAAK,GAAGH,2BAAQ,CAACyC,WAAW,EAAE,CAACtC,KAAK;OAC1C,IAAMiJ,SAAS,GAAGpJ,2BAAQ,CAACyC,WAAW,EAAE,CAAC2G,SAAS;OAClD,IAAMwlB,GAAG,GAAGzuB,KAAK,GAAEA,KAAK,CAAC0uB,WAAW,EAAE,GAAG,IAAI;OAE7C,QAAQ3yB,MAAM;SAEb,KAAK,UAAU;WACd,KAAK,IAAI0D,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,sCAAI,aAASR,MAAM,EAAE,EAAEQ,CAAC,EAC5C;aACC,IAAI6V,EAAE,KAAK,sCAAI,aAAS7V,CAAC,CAAC,CAAC1M,EAAE,EAC7B;eACC6M,KAAK,GAAG,sCAAI,aAASH,CAAC,CAAC;;;WAGzB;SACD,KAAK,UAAU;WACd,IAAIgvB,GAAG,IAAIxlB,SAAS,IAAIA,SAAS,CAACxF,cAAc,EAChD;aACC7D,KAAK,GAAGqJ,SAAS,CAACxF,cAAc,CAACob,iBAAiB,CAAC4P,GAAG,CAACt2B,WAAW,EAAE,EAAEmd,EAAE,CAAC;;WAE1E;SACD,KAAK,UAAU;WACd,IAAImZ,GAAG,EACP;aACC7uB,KAAK,GAAG6uB,GAAG,CAACxG,WAAW,CAAC3S,EAAE,CAAC;;WAE5B;SACD,KAAK,aAAa;WACjB,IAAIrM,SAAS,EACb;aACCrJ,KAAK,GAAGqJ,SAAS,CAACgf,WAAW,CAAC3S,EAAE,CAAC;;WAElC;SACD,KAAK,WAAW;WACf,IAAIrM,SAAS,EACb;aACCrJ,KAAK,GAAGqJ,SAAS,CAAC0lB,YAAY,CAACrZ,EAAE,CAAC;;WAEnC;SACD;WACC,IAAIsZ,UAAU,GAAGH,GAAG,GAAEA,GAAG,CAAC7P,YAAY,CAAC7iB,MAAM,CAAC,GAAG,IAAI;WACrD,IAAI6yB,UAAU,EACd;aACChvB,KAAK,GAAGgvB,UAAU,CAAC/P,iBAAiB,CAACvJ,EAAE,CAAC;;WAEzC;;OAGF,OAAO1V,KAAK,IAAI;SACf7M,EAAE,EAAEuiB,EAAE;SACNjN,QAAQ,EAAEtM,MAAM;SAChBuM,IAAI,EAAEgN,EAAE;SACR1iB,IAAI,EAAE,QAAQ;SACd4V,UAAU,EAAE8M,EAAE;SACd7M,gBAAgB,EAAE,IAAI,GAAC1M,MAAM,GAAC,GAAG,GAACuZ,EAAE,GAAC;QACrC;;;KACD;KAAA,6BAEYuZ,SAAS,EAAEC,QAAQ,EAChC;OACC,IAAMC,SAAS,GAAG3E,0BAAQ,CAAC4E,YAAY,EAAE;OAEzC,IAAIC,IAAI,GAAG;SACV,QAAQ,EAAEF,SAAS,CAAC3E,0BAAQ,CAAC8E,SAAS,CAAC;SACvC,OAAO,EAAEH,SAAS,CAAC3E,0BAAQ,CAACwC,KAAK,CAAC;SAClC,GAAG,EAAEmC,SAAS,CAAC3E,0BAAQ,CAACC,KAAK,CAAC;SAC9B,IAAI,EAAE0E,SAAS,CAAC3E,0BAAQ,CAACE,SAAS;QAClC;OACD,QAAQuE,SAAS;SAEhB,KAAK,MAAM;SACX,KAAK,QAAQ;SACb,KAAK,oBAAoB;WACxBI,IAAI,GAAG;aACN,QAAQ,EAAEF,SAAS,CAAC3E,0BAAQ,CAAC8E,SAAS,CAAC;aACvC,OAAO,EAAEH,SAAS,CAAC3E,0BAAQ,CAACwC,KAAK;YACjC;WACD;SACD,KAAK,MAAM;SACX,KAAK,QAAQ;WACZ,IAAIkC,QAAQ,EACZ;aACCG,IAAI,CAAC7E,0BAAQ,CAAC+E,OAAO,CAAC,GAAGJ,SAAS,CAAC3E,0BAAQ,CAAC+E,OAAO,CAAC;aACpDF,IAAI,CAAC7E,0BAAQ,CAACgF,WAAW,CAAC,GAAGL,SAAS,CAAC3E,0BAAQ,CAACgF,WAAW,CAAC;YAC5D;WAMD;SACD,KAAK,MAAM;WACVH,IAAI,CAAC7E,0BAAQ,CAACiF,EAAE,CAAC,GAAGN,SAAS,CAAC3E,0BAAQ,CAACiF,EAAE,CAAC;WAC1CJ,IAAI,CAAC7E,0BAAQ,CAACkF,MAAM,CAAC,GAAGP,SAAS,CAAC3E,0BAAQ,CAACkF,MAAM,CAAC;WAClDL,IAAI,CAAC7E,0BAAQ,CAAC+E,OAAO,CAAC,GAAGJ,SAAS,CAAC3E,0BAAQ,CAAC+E,OAAO,CAAC;WACpDF,IAAI,CAAC7E,0BAAQ,CAACgF,WAAW,CAAC,GAAGL,SAAS,CAAC3E,0BAAQ,CAACgF,WAAW,CAAC;WAC5D;SACD;WACCH,IAAI,CAAC7E,0BAAQ,CAACiF,EAAE,CAAC,GAAGN,SAAS,CAAC3E,0BAAQ,CAACiF,EAAE,CAAC;WAC1CJ,IAAI,CAAC7E,0BAAQ,CAACkF,MAAM,CAAC,GAAGP,SAAS,CAAC3E,0BAAQ,CAACkF,MAAM,CAAC;WAClDL,IAAI,CAAC7E,0BAAQ,CAAC+E,OAAO,CAAC,GAAGJ,SAAS,CAAC3E,0BAAQ,CAAC+E,OAAO,CAAC;WACpDF,IAAI,CAAC7E,0BAAQ,CAACgF,WAAW,CAAC,GAAGL,SAAS,CAAC3E,0BAAQ,CAACgF,WAAW,CAAC;WAC5DH,IAAI,CAAC7E,0BAAQ,CAACmF,YAAY,CAAC,GAAGR,SAAS,CAAC3E,0BAAQ,CAACmF,YAAY,CAAC;WAC9DN,IAAI,CAAC7E,0BAAQ,CAACoF,qBAAqB,CAAC,GAAGT,SAAS,CAAC3E,0BAAQ,CAACoF,qBAAqB,CAAC;WAChFP,IAAI,CAAC7E,0BAAQ,CAACqF,SAAS,CAAC,GAAGV,SAAS,CAAC3E,0BAAQ,CAACqF,SAAS,CAAC;WACxDR,IAAI,CAAC7E,0BAAQ,CAACsF,kBAAkB,CAAC,GAAGX,SAAS,CAAC3E,0BAAQ,CAACsF,kBAAkB,CAAC;;;;;;;;;OAS5E,OAAOT,IAAI;;;KACX;KAAA,iCAEgB3Z,EAAE,EACnB;OACC,OAAO8U,0BAAQ,CAACuC,gBAAgB,CAACrX,EAAE,CAAC;;;KACpC;KAAA,+BAGD;OACC,IAAMqa,QAAQ,GAAG,EAAE;OACnB,KAAK,IAAIlwB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,sCAAI,aAASR,MAAM,EAAE,EAAEQ,CAAC,EAC5C;SACC,IAAMzB,IAAI,GAAG,sCAAI,aAASyB,CAAC,CAAC,CAAC,MAAM,CAAC;SAEpC,IACCzB,IAAI,KAAK,MAAM,IACZA,IAAI,KAAK,MAAM,IACfA,IAAI,KAAK,UAAU,IACnBA,IAAI,KAAK,QAAQ,IACjBA,IAAI,KAAK,MAAM,IACfA,IAAI,KAAK,KAAK,IACdA,IAAI,KAAK,QAAQ,IACjBA,IAAI,KAAK,QAAQ,IACjBA,IAAI,KAAK,MAAM,IACfA,IAAI,KAAK,MAAM,IACfA,IAAI,KAAK,UAAU,IACnBA,IAAI,KAAK,QAAQ,IACjBA,IAAI,KAAK,oBAAoB,IAC7BA,IAAI,KAAK,QAAQ,EAErB;WACC2xB,QAAQ,CAACj8B,IAAI,CAAC,sCAAI,aAAS+L,CAAC,CAAC,CAAC;UAC9B;;OAOF,OAAOkwB,QAAQ;;;KACf;KAAA,gCAEeC,QAAQ,EAAEt6B,KAAK,EAC/B;OAAA;OACC,IAAMu6B,OAAO,GACZhwB,2BAAQ,CAACyC,WAAW,EAAE,CAAC2G,SAAS,GAC7BpJ,2BAAQ,CAACyC,WAAW,EAAE,CAAC2G,SAAS,CAAC9S,QAAQ,CAAC8P,UAAU,EAAE,GACtDnO,mCAAgB,EAAE,CAAC3B,QAAQ,CAAC8P,UAAU,EACzC;OACD,IAAMrG,KAAK,GAAG3D,EAAE,CAAC7G,KAAK,CAACw6B,QAAQ,CAAC;OAChChwB,KAAK,CAACkwB,QAAQ,GAAG,KAAK;OAEtB,IAAMC,UAAU,GAAG9zB,EAAE,CAAC6J,OAAO,CAACC,SAAS,CAACiqB,mBAAmB,CAC1DH,OAAO,EACPjwB,KAAK,EACL,sCAAI,kBAAgB,OAAO,EAC3BtK,KAAK,EACL,KAAK,CACL;OAEDy6B,UAAU,CAACvvB,gBAAgB,CAAC,aAAa,CAAC,CAACjN,OAAO,CAAC,UAACoE,IAAI,EAAK;SAAA;SAC5D,IAAMkO,QAAQ,GAAGgf,kCAAe,CAACK,oBAAoB,CAACvtB,IAAI,CAACs4B,OAAO,CAACvoB,IAAI,EAAE;WACxErF,OAAO,EAAE,IAAImiB,kCAAe,CAAC;aAC5B7kB,MAAM,EAAE7H,mCAAgB,EAAE,CAAC3B,QAAQ,CAACwP,SAAS,EAAE;aAC/C8e,eAAe,EAAE,KAAK;aACtBC,cAAc,8DAAE,KAAI,6FAAoB5sB,mCAAgB,EAAE,CAAC3B,QAAQ,CAACkE;YACpE;UACD,CAAC;SAEF,IAAIwL,QAAQ,EACZ;WACC,IAAI,uCAAI,2BAAyB,IAAI,EACrC;aACC,IAAIjT,cAAI,CAACmV,UAAU,mCAAC,KAAI,eAAa,EACrC;eACClC,QAAQ,CAAClQ,SAAS,CAAC,YAAY,oCAAE,KAAI,eAAa;;aAEnDkQ,QAAQ,CAACuf,QAAQ,CAACztB,IAAI,CAAC;YACvB,MAED;aACCkO,QAAQ,CAACqqB,WAAW,GAAGv4B,IAAI;aAC3BkO,QAAQ,CAACsqB,qBAAqB,EAAE;;;QAGlC,CAAC;OAEF,OAAOJ,UAAU;;;KACjB;KAAA,mCAEkBnwB,KAAK,EAAE0tB,YAAY,EACtC;OACC,IAAMljB,MAAM,GAAGjR,aAAG,CAACC,MAAM,CAAC,QAAQ,EAAE;SACnCC,KAAK,EAAE;WAACC,SAAS,EAAE;;QACnB,CAAC;OAEF,IAAM82B,YAAY,GAAG,IAAI,CAAC7B,YAAY,CAAC3uB,KAAK,CAAC,MAAM,CAAC,EAAEA,KAAK,CAAC,UAAU,CAAC,CAAC;OACxE,KAAK,IAAIywB,UAAU,IAAID,YAAY,EACnC;SACC,IAAI,CAACA,YAAY,CAAC36B,cAAc,CAAC46B,UAAU,CAAC,EAC5C;WACC;;SAGDjmB,MAAM,CAAC3P,WAAW,CAACtB,aAAG,CAACC,MAAM,CAAC,QAAQ,EAAE;WACvCpD,KAAK,EAAE;aAACV,KAAK,EAAE+6B;YAAW;WAC1B92B,IAAI,EAAE62B,YAAY,CAACC,UAAU;UAC7B,CAAC,CAAC;;OAGJ32B,eAAK,CAACC,IAAI,CAACyQ,MAAM,EAAE,QAAQ,EAAE,IAAI,CAACokB,gBAAgB,CAAC70B,IAAI,CACtD,IAAI,EACJyQ,MAAM,EACNxK,KAAK,EACL0tB,YAAY,CACZ,CAAC;OAEF,OAAOljB,MAAM;;;KACb;KAAA,gCAEexU,KAAY,EAC5B;OACC,sCAAI,gBAAc,IAAI;OACtBuD,aAAG,CAAC4E,MAAM,CAAC,IAAI,CAACpG,IAAI,CAAC;OAErB,IAAI,CAAC4uB,SAAS,GAAG,IAAI;OACrB,IAAI,CAACmF,SAAS,GAAG,IAAI;OACrB,IAAI,CAACE,YAAY,GAAG,IAAI;OACxB,IAAI,CAACC,SAAS,GAAG,IAAI;OACrB,sCAAI,cAAe,IAAI;OACvB,IAAI,CAACl0B,IAAI,GAAG,IAAI;OAEhB/B,KAAK,CAACmF,eAAe,EAAE;;;KACvB;KAAA,6BAEYu1B,GAAY,EAAE16B,KAAY,EACvC;OACC,sCAAI,WAAY,sCAAI,eAAa0B,iCAAc,CAAC4zB,MAAM,CAACE,EAAE,GAAG9zB,iCAAc,CAAC4zB,MAAM,CAACC,GAAG,GAAG7zB,iCAAc,CAAC4zB,MAAM,CAACE,EAAE;OAChHkF,GAAG,CAAChX,WAAW,GAAGhiB,iCAAc,CAAC4zB,MAAM,CAACG,OAAO,mCAAC,IAAI,WAAS;OAE7D,IAAI,IAAI,CAACa,UAAU,EACnB;SACC,IAAI,CAACA,UAAU,CAAC52B,KAAK,qCAAG,IAAI,UAAQ;;OAGrCM,KAAK,CAACwlB,cAAc,EAAE;;;KACtB;KAAA,0BAGD;OACC,IAAI,IAAI,CAAC3Y,KAAK,EACd;SACC,IAAI,CAACA,KAAK,CAACC,KAAK,EAAE;;;;GAEnB;CAAA;CACD,2BAprBiBpN,KAAa,EAC9B;GACC,OAAO8tB,aAAG,CAACC,MAAM,6LAGPtZ,cAAI,CAAC6C,MAAM,CAAC,sCAAI,kBAAgB,SAAS,CAAC,EACzC7C,cAAI,CAAC6C,MAAM,CAACtX,KAAK,CAAC;CAG9B;CAAC,yBAyDcsK,KAAK,EACpB;GACC,IAAMuqB,QAAQ,GAAG,sCAAI,gBAAYA,QAAQ;GACzC,IAAM70B,KAAK,GAAG,sCAAI,gBAAYA,KAAK;GAEnC,IAAI60B,QAAQ,KAAK,SAAS,EAC1B;KAAA;KACC,0BACC3wB,aAAG,CAACC,UAAU,CACd,kDAAkD,EACjD;OACC,WAAW,EAAEwC,EAAE,CAAC6J,OAAO,CAACC,SAAS,CAACwqB,oBAAoB,CACrD3wB,KAAK,EACLhN,cAAI,CAACwb,aAAa,CAAC9Y,KAAK,CAAC,GAAGA,KAAK,CAAC,CAAC,CAAC,GAAGA,KAAK,CAC5C;OACD,WAAW,EAAE2G,EAAE,CAAC6J,OAAO,CAACC,SAAS,CAACwqB,oBAAoB,CACrD3wB,KAAK,EACLhN,cAAI,CAACwb,aAAa,CAAC9Y,KAAK,CAAC,GAAGA,KAAK,CAAC,CAAC,CAAC,GAAG,EAAE;MAE1C,CACD,6DACE,EAAE;IAEN,MACI,IAAG60B,QAAQ,CAACruB,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,EACrC;KACC,OAAOG,EAAE,CAAC6J,OAAO,CAACC,SAAS,CAACwqB,oBAAoB,CAAC3wB,KAAK,EAAEtK,KAAK,CAAC;;GAG/D,OAAO,IAAI;CACZ;CAAC,wBA2SasK,KAAS,EAAEtK,KAAK,EAAE60B,QAAgB,EAChD;GACC,IAAIA,QAAQ,KAAKC,0BAAQ,CAACa,OAAO,EACjC;KACC,IAAMuF,UAAU,GAAG,IAAI,CAACC,eAAe,CAAC7wB,KAAK,EAAEhN,cAAI,CAACwb,aAAa,CAAC9Y,KAAK,CAAC,GAAGA,KAAK,CAAC,CAAC,CAAC,GAAGA,KAAK,CAAC;KAC5F,IAAMo7B,UAAU,GAAG,IAAI,CAACD,eAAe,CAAC7wB,KAAK,EAAEhN,cAAI,CAACwb,aAAa,CAAC9Y,KAAK,CAAC,GAAGA,KAAK,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;KAEzF,OAAO8tB,aAAG,CAACC,MAAM,sLAEbmN,UAAU,EACLl5B,iCAAc,CAAC4zB,MAAM,CAACG,OAAO,CAAC,KAAK,CAAC,EACzCqF,UAAU;IAGd,MACI,IAAIvG,QAAQ,CAACruB,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,EACtC;KACC,OAAO,IAAI,CAAC20B,eAAe,CAAC7wB,KAAK,EAAEtK,KAAK,CAAC;;GAG1C,OAAO,EAAE;CACV;;;;ACtkBD,CAK+C;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE/C,KAAaoQ,sBAAsB;GAWlC,gCAAYH,cAA8B,EAAEkI,OAAe,EAC3D;KAAA;KAAApa;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KACC,sCAAI,mBAAmBkS,cAAc;KACrC,sCAAI,aAAW,EAAE;KACjB,sCAAI,kBAAgB,YAAY;KAChC,sCAAI,kBAAkB,EAAE;KAExB,IAAI3S,cAAI,CAACuC,aAAa,CAACsY,OAAO,CAAC,EAC/B;OAAA;OACC,IAAI7a,cAAI,CAACU,OAAO,CAACma,OAAO,CAAC9N,MAAM,CAAC,EAChC;SACC,sCAAI,aAAW8N,OAAO,CAAC9N,MAAM;;OAE9B,IAAI8N,OAAO,CAAC3D,WAAW,EACvB;SACC,sCAAI,kBAAgB2D,OAAO,CAAC3D,WAAW;;OAGxC,sCAAI,qBAAmB2D,OAAO,CAACiX,cAAc;OAC7C,sCAAI,sBAAoBjX,OAAO,CAACuZ,eAAe;OAC/C,sCAAI,iBAAevZ,OAAO,CAAC+X,UAAU;OACrC,sCAAI,kDAAuB/X,OAAO,CAAC7H,kBAAkB,yEAAI,IAAI;;;GAE9D;KAAA;KAAA,6BAGD;OAAA;OACC,IAAM+qB,cAAc,GAAG,EAAE;OAEzB,sCAAI,mBAAiBC,QAAQ,EAAE,CAACr9B,OAAO,CAAC,UAACuZ,IAAI,EAAK;SACjD,IAAMrH,iBAAiB,GAAG,IAAI6lB,iBAAiB,CAACxe,IAAI,CAAC,CAAC,CAAC,EAAE;WACxDnN,MAAM,oCAAE,KAAI,YAAQ;WACpB+qB,MAAM,EAAE5d,IAAI,CAAC,CAAC,CAAC;WACfhD,WAAW,oCAAE,KAAI,iBAAa;WAC9B4a,cAAc,oCAAE,KAAI,oBAAgB;WACpCsC,eAAe,oCAAE,KAAI,qBAAiB;WACtCxB,UAAU,oCAAE,KAAI,gBAAY;WAC5B5f,kBAAkB,oCAAE,KAAI;UACxB,CAAC;SAEF,uCAAI,kBAAgBlS,IAAI,CAAC+R,iBAAiB,CAAC;SAC3CkrB,cAAc,CAACj9B,IAAI,CAAC+R,iBAAiB,CAAC/N,UAAU,EAAE,CAAC;QACnD,CAAC;OAEF,IAAMgM,IAAI,GAAG,IAAI;OACjBitB,cAAc,CAACj9B,IAAI,CAACyF,aAAG,CAACC,MAAM,CAAC,GAAG,EAAE;SACnCC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAA0C;SAC9DC,IAAI,EAAE,KAAK;SACXwJ,MAAM,EAAE;WACPC,KAAK,mBACL;aACCU,IAAI,CAAC8mB,OAAO,CAAC,IAAI,CAAC;;;QAGpB,CAAC,CAAC;OAEH,OAAOrxB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SACzBC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAkD;SACtEc,QAAQ,EAAEu2B;QACV,CAAC;;;KACF;KAAA,wBAEOxM,UAAU,EAClB;OACC,IAAM1e,iBAAiB,GAAG,IAAI6lB,iBAAiB,CAAC,IAAI9zB,4BAAS,CAAC,EAAE,oCAAE,IAAI,mBAAiB,EAAE;SACxFmI,MAAM,oCAAE,IAAI,YAAQ;SACpBmK,WAAW,oCAAE,IAAI,iBAAa;SAC9B4a,cAAc,oCAAE,IAAI,oBAAgB;SACpCsC,eAAe,oCAAE,IAAI,qBAAiB;SACtCxB,UAAU,oCAAE,IAAI,gBAAY;SAC5B5f,kBAAkB,oCAAE,IAAI;QACxB,CAAC;OACF,sCAAI,kBAAgBlS,IAAI,CAAC+R,iBAAiB,CAAC;OAE3C0e,UAAU,CAACvsB,UAAU,CAAC+G,YAAY,CAAC8G,iBAAiB,CAAC/N,UAAU,EAAE,EAAEysB,UAAU,CAAC;;;KAC9E;KAAA,0BAGD;OACC,sCAAI,kBAAgB5wB,OAAO,CAAC,UAAAsS,QAAQ;SAAA,OAAIA,QAAQ,CAACrB,OAAO,EAAE;SAAC;OAC3D,sCAAI,kBAAkB,EAAE;;;GACxB;CAAA;;KCxFWqsB,OAAO;GAAA;KAAA;;GAAA;KAAA;KAAA,oCASQX,WAAwB,EACnD;OAAA;;OAEC,IAAM1mB,QAAQ,4BAAG3J,2BAAQ,CAACyC,WAAW,EAAE,CAAC2f,sBAAsB,EAAE,0DAA/C,sBAAiDzY,QAAQ;OAE1E,IAAIA,QAAQ,IAAI5W,cAAI,CAACU,OAAO,CAACkW,QAAQ,CAAC4a,qBAAqB,CAAC,EAC5D;SACC,OAAO5a,QAAQ,CAAC4a,qBAAqB,CAAC7tB,IAAI,CAAC,UAAAsP,QAAQ;WAAA,OAAIA,QAAQ,CAACqqB,WAAW,KAAKA,WAAW;WAAC;;OAG7F,OAAOrzB,SAAS;;;KAChB;KAAA,qCAE2B6K,IAAY,EAAEopB,aAAqB,EAC/D;OACC,IAAIppB,IAAI,KAAK,IAAI,CAACod,kBAAkB,EACpC;SACC,OAAO,IAAInd,+BAAY,CAACmpB,aAAa,CAAC;QACtC,MACI,IAAIppB,IAAI,KAAK,IAAI,CAACud,kBAAkB,EACzC;SACC,OAAO,IAAI8L,+BAAY,CAACD,aAAa,CAAC;QACtC,MACI,IAAIppB,IAAI,KAAK,IAAI,CAACspB,oBAAoB,EAC3C;SACC,OAAO,IAAIC,iCAAc,CAACH,aAAa,CAAC;QACxC,MACI,IAAIppB,IAAI,KAAK,IAAI,CAACwpB,yBAAyB,EAChD;SACC,OAAO,IAAIC,qCAAkB,CAACL,aAAa,CAAC;QAC5C,MACI,IAAIppB,IAAI,KAAK,IAAI,CAAC0pB,kBAAkB,EACzC;SACC,OAAO,IAAIC,+BAAY,CAACP,aAAa,CAAC;QACtC,MACI,IAAIppB,IAAI,KAAK,IAAI,CAACyd,wBAAwB,EAC/C;SACC,OAAO,IAAImM,oCAAiB,CAACR,aAAa,CAAC;QAC3C,MAED;SACC,OAAOj0B,SAAS;;;;GAEjB;CAAA;CACD,4BArDYg0B,OAAO,wBAES,eAAe;CAAA,4BAF/BA,OAAO,wBAGS,eAAe;CAAA,4BAH/BA,OAAO,0BAIW,wBAAwB;CAAA,4BAJ1CA,OAAO,+BAKgB,sBAAsB;CAAA,4BAL7CA,OAAO,wBAMS,eAAe;CAAA,4BAN/BA,OAAO,8BAOe,qBAAqB;;;;;;AClBxD,CAEkC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAElC,KAAaU,kBAAkB;GAW9B,4BAAY9jB,OAEX,EACD;KAAA;KAAApN;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAhN;OAAA;OAAA,OAZ+B;;KAAIA;OAAA;OAAA,OAEnB;;KAAEA;OAAA;OAAA,OAEA;;KAAEA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KASnB,IAAIT,cAAI,CAACuC,aAAa,CAACsY,OAAO,CAAC,EAC/B;OACC,IAAI7a,cAAI,CAAC4+B,aAAa,CAAC/jB,OAAO,CAAC8Y,SAAS,CAAC,EACzC;SACC,sCAAI,cAAc9Y,OAAO,CAAC8Y,SAAS;;;KAIrCpjB,6BAAI,0CAAJ,IAAI;KACJA,6BAAI,0CAAJ,IAAI;;GACJ;KAAA;KAAA,qBA8CIsuB,IAAY,EACjB;OACC,IAAI7+B,cAAI,CAACkb,cAAc,CAAC2jB,IAAI,CAAC,EAC7B;SACC,sCAAI,SAASA,IAAI;;OAGlBtuB,6BAAI,sCAAJ,IAAI;OACJA,6BAAI,wCAAJ,IAAI;;;GACJ;CAAA;CAsCD,4BA1FA;GACC,IAAMuuB,SAAS,GAAG,SAAZA,SAAS,CAAIC,QAAQ;KAAA,OAC1B11B,EAAE,CAACuQ,IAAI,CAAColB,IAAI,CAACC,mBAAmB,CAACr4B,aAAG,CAACC,UAAU,CAACk4B,QAAQ,CAAC,CAAC,CAAChnB,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC;IAChF;GAED,IAAMmnB,UAAU,GAAGJ,SAAS,CAAC,aAAa,CAAC;GAC3C,IAAMK,cAAc,GAAGL,SAAS,CAAC,iBAAiB,CAAC;GACnD,sCAAI,eAAeK,cAAc,CAACpnB,OAAO,CAACmnB,UAAU,EAAE,EAAE,CAAC,CAACpgB,IAAI,EAAE;CACjE;CAAC,4BAGD;GACC,IAAMhO,IAAI,GAAG,IAAI;GACjB,IAAMmJ,OAAO,GAAG,SAAVA,OAAO,CAAYjX,KAAK,EAAEkX,IAAI,EACpC;KACClX,KAAK,CAACwlB,cAAc,EAAE;KACtB,kCAAA1X,IAAI,cAAYpO,KAAK,GAAGyU,cAAI,CAAC6C,MAAM,CAACE,IAAI,CAACvT,IAAI,CAAC;KAC9C,IAAI,CAACmJ,KAAK,EAAE;IACZ;GAED,KAAK,IAAIiP,IAAI,GAAG,CAAC,EAAEA,IAAI,GAAG,EAAE,EAAEA,IAAI,EAAE,EACpC;KACC,sCAAI,eAAaje,IAAI,CAAC;OACrB4hB,EAAE,EAAE3D,IAAI,GAAG,EAAE;OACbpY,IAAI,2BAAE,IAAI,kCAAJ,IAAI,EAAaoY,IAAI,EAAE,CAAC,CAAC;OAC/B9E,OAAO,EAAEA;MACT,CAAC;KACF,sCAAI,eAAanZ,IAAI,CAAC;OACrB4hB,EAAE,EAAE3D,IAAI,GAAG,EAAE,GAAG,EAAE;OAClBpY,IAAI,2BAAE,IAAI,kCAAJ,IAAI,EAAaoY,IAAI,EAAE,EAAE,CAAC;OAChC9E,OAAO,EAAEA;MACT,CAAC;;CAEJ;CAAC,sBAEW8E,IAAI,EAAEH,MAAM,EACxB;GACC,IAAMwgB,IAAI,GAAG,IAAIJ,IAAI,EAAE;GACvBI,IAAI,CAACC,QAAQ,CAACtgB,IAAI,EAAEH,MAAM,CAAC;GAE3B,OAAO0gB,wBAAc,CAACtY,MAAM,mCAAC,IAAI,gBAAcoY,IAAI,CAACG,OAAO,EAAE,GAAG,IAAI,CAAC;CACtE;CAAC,0BAcD;GACC,IAAIv/B,cAAI,CAAC4+B,aAAa,mCAAC,IAAI,cAAY,EACvC;KACC,sCAAI,cAAYlY,WAAW,qCAAG,IAAI,QAAM;;CAE1C;CAAC,2BAGD;GACC,IAAI1mB,cAAI,CAAC4+B,aAAa,mCAAC,IAAI,cAAY,EACvC;KACC93B,eAAK,CAACC,IAAI,mCAAC,IAAI,eAAa,OAAO,EAAEwJ,6BAAI,iCAAexJ,IAAI,CAAC,IAAI,CAAC,CAAC;;CAErE;CAAC,wBAEa/D,KAAK,EACnB;GACCuN,6BAAI,8CAAJ,IAAI;GACJvN,KAAK,CAACwlB,cAAc,EAAE;CACvB;CAAC,8BAGD;GACC,IAAIxoB,cAAI,CAACC,KAAK,mCAAC,IAAI,aAAW,EAC9B;KACC,sCAAI,aAAa,IAAIu/B,eAAI,CAAC;OACzBrlB,QAAQ,EAAE,IAAI;OACdwF,WAAW,oCAAE,IAAI,aAAW;OAC5BvT,KAAK,oCAAE,IAAI,cAAY;OACvBqzB,SAAS,EAAE;MACX,CAAC;;GAGH,sCAAI,aAAW7wB,IAAI,EAAE;CACtB;;;;;;;;;ACzHD,CAO0D;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE1D,KAAayvB,cAAc;GAAA;GAY1B,wBAAYj7B,KAAmC,EAC/C;KAAA;KAAA;KACC;KAAQqK;KAAAA;KAAAA;KAAAA;KAAAA;KAAA,wFAXe,IAAI;KAAA,yFACF,KAAK;KAAA,qFACA,IAAI;KAAA,sFACP,IAAI;KAAAhN;OAAA;OAAA,OACa;;KAAE,sFAClB,EAAE;KAAAA;OAAA;OAAA,OACZ;;KAAIA;OAAA;OAAA,OACE;;KAKxB,MAAK6B,iBAAiB,CAAC,gCAAgC,CAAC;KAExD,MAAKmN,OAAO,GAAGrM,KAAK,CAACqM,OAAO;KAC5B,MAAKqN,WAAW,GAAG,MAAKrN,OAAO,CAAC1C,MAAM;KAAC;;GACvC;KAAA;KAAA,yBAEQ2yB,OAAe,EACxB;OACC,OAAO,sCAAI,eAAa78B,cAAc,CAAC68B,OAAO,CAAC;;;KAC/C;KAAA,yBAEQA,OAAe,EAAExI,KAAoB,EAC9C;OACC,sCAAI,eAAawI,OAAO,CAAC,4BAAG,IAAI,0CAAJ,IAAI,EAAiBxI,KAAK,CAAC;;;KACvD;KAAA,6BAEYwI,OAAe,EAAExlB,IAAmB,EACjD;OACC,IAAI,IAAI,CAACylB,QAAQ,CAACD,OAAO,CAAC,EAC1B;SACC,sCAAI,eAAaA,OAAO,CAAC,CAACl4B,QAAQ,CAAC1G,IAAI,0BAAC,IAAI,0CAAJ,IAAI,EAAiBoZ,IAAI,EAAE;;;;KAEpE;KAAA,2BAuBUojB,WAAoB,EAC/B;OACC,IAAI,CAACA,WAAW,GAAGj6B,iBAAO,CAACb,KAAK,CAAC86B,WAAW,CAAC;OAC7C,IAAI,CAACA,WAAW,CAAC3W,YAAY,CAAC,cAAc,EAAE,KAAK,CAAC;OAEpD,IAAI,CAACiZ,UAAU,GAAGpP,aAAG,CAACC,MAAM,8MAEf,IAAI,CAAC+K,QAAQ,CAACz0B,IAAI,CAAC,IAAI,CAAC,CAGpC;OAED,IAAI,CAACw2B,qBAAqB,EAAE;OAE5B,IAAI,CAACsC,cAAc,IAAK,IAAI,CAACvC,WAAW,CAACjyB,YAAY,CAAC,kBAAkB,CAAC,KAAK,SAAU;OAExF,OAAOmlB,aAAG,CAACC,MAAM,+LAEb,IAAI,CAAC6M,WAAW,EAChB,IAAI,CAACsC,UAAU;;;KAGnB;KAAA,yBAEQtC,WAAoB,EAC7B;OACCA,WAAW,CAACt4B,UAAU,CAACC,YAAY,CAAC,IAAI,CAAC66B,UAAU,CAACxC,WAAW,CAAC,EAAEA,WAAW,CAAC;;;KAC9E;KAAA,mCAGD;OACCx2B,eAAK,CAACC,IAAI,CAAC,IAAI,CAACu2B,WAAW,EAAE,SAAS,EAAE/sB,6BAAI,2BAAYxJ,IAAI,CAAC,IAAI,CAAC,CAAC;;;KACnE;KAAA,wCAGD;OACC,IAAI,CAACorB,aAAa,GAAGxlB,IAAI,CAACylB,KAAK,CAAC,IAAI,CAACkL,WAAW,CAACjyB,YAAY,CAAC,eAAe,CAAC,CAAC;OAC/E,IAAM00B,YAAY,GAAG,IAAI,CAACzC,WAAW,CAACjyB,YAAY,CAAC,oBAAoB,CAAC;OAExE,IAAI,CAAC,IAAI,CAAC8mB,aAAa,IAAI4N,YAAY,EACvC;SACC,IAAI,CAAC5N,aAAa,GAAG;WAACnyB,IAAI,EAAE+/B;UAAa;;OAG1C,IAAI,IAAI,CAAC5N,aAAa,EACtB;SACC,IAAI,CAACA,aAAa,CAACnyB,IAAI,GAAG,IAAI,CAACmyB,aAAa,CAACnyB,IAAI,IAAI+/B,YAAY;SACjExvB,6BAAI,wEAAJ,IAAI;QACJ,MAED;SACC,IAAI,CAACd,OAAO,CAACoiB,eAAe,GAAG,KAAK;;OAGrC,IAAI,CAACgO,cAAc,IAAK,IAAI,CAACvC,WAAW,CAACjyB,YAAY,CAAC,kBAAkB,CAAC,KAAK,SAAU;;;KACxF;KAAA,yBAoEQrI,KAAoB,EAC7B;OAAA;OAAA,IAD+Bg9B,sBAA+B,uEAAG,KAAK;OAErE,IAAI,CAACA,sBAAsB,IAAI,IAAI,CAACvwB,OAAO,CAACoiB,eAAe,IAAI,CAAC,IAAI,CAACyL,WAAW,CAAC56B,KAAK,EACtF;SACC,OAAO,IAAI,CAACu9B,0BAA0B,EAAE;;OAGzC,sCAAI,IAAI,YACR;SACC,sCAAI,WAASrxB,IAAI,EAAE;SACnB;;OAGD,IAAI,CAACsxB,UAAU,EAAE;OACjB,IAAI,CAACC,UAAU,EAAE;OAEjB,IAAIpmB,SAAS,GAAG,EAAE;OAClB,kCAAoBsJ,MAAM,CAAChiB,MAAM,mCAAC,IAAI,eAAa,oCACnD;SADK,IAAM61B,KAAK;SAEf,IAAIA,KAAK,CAAC1vB,QAAQ,CAAC6E,MAAM,GAAG,CAAC,EAC7B;WACC0N,SAAS,CAACjZ,IAAI,CAACo2B,KAAK,CAAC;;;OAIvB,IAAInd,SAAS,CAAC1N,MAAM,KAAK,CAAC,EAC1B;SACC0N,SAAS,GAAGA,SAAS,CAAC,CAAC,CAAC,CAACvS,QAAQ;;OAGlC,IAAI4R,MAAM,GAAG,IAAI,CAACwmB,UAAU,CAACv0B,YAAY,CAAC,kBAAkB,CAAC;OAC7D,IAAI,CAAC+N,MAAM,EACX;SACCA,MAAM,GAAG1M,yBAAM,CAACsE,gBAAgB,EAAE;SAClC,IAAI,CAAC4uB,UAAU,CAACjZ,YAAY,CAAC,kBAAkB,EAAEvN,MAAM,CAAC;;OAGzD,sCAAI,WAAW,IAAIgnB,wBAAM,CAAC;SACzBzmB,UAAU,EAAE,IAAI,CAACimB,UAAU;SAC3Bh1B,KAAK,EAAE,GAAG;SACV8V,MAAM,EAAE,GAAG;SACXwb,QAAQ,EAAE,KAAK;SACfmE,YAAY,EAAE,IAAI;SAClBC,YAAY,EAAE,IAAI;SAClBl0B,KAAK,EAAE,IAAI,CAACm0B,sBAAsB,CAACxmB,SAAS,CAAC;SAC7CymB,WAAW,EAAE,KAAK;SAClBrwB,MAAM,EAAE;WACP,qBAAqB,EAAE,4BAACnN,KAAK,EAAK;aACjCA,KAAK,CAACwlB,cAAc,EAAE;aAEtB,IAAMtO,IAAI,GAAGlX,KAAK,CAAC8F,OAAO,EAAE,CAACoR,IAAI;aACjC,MAAI,CAACuY,aAAa,CAACvY,IAAI,CAACumB,aAAa,EAAE,CAAC58B,GAAG,CAAC,OAAO,CAAC,CAAC;;UAEtD;SACD68B,WAAW,EAAE;QACb,CAAC;OAEF,sCAAI,WAAS9xB,IAAI,EAAE;;;KACnB;KAAA,6BAGD;OACC,IAAI,CAAC+xB,gBAAgB,EAAE;OACvB,IAAI,CAACC,aAAa,EAAE;;;KACpB;KAAA,mCAGD;OAAA;OACC,IAAI,CAACjK,QAAQ,CAAC,MAAM,EAAE;SACrBjU,EAAE,EAAE,MAAM;SACVjb,KAAK,EAAE,IAAI,CAACgI,OAAO,CAACqiB,cAAc;SAClC+O,UAAU,EAAE;QACZ,CAAC;OAEF,IAAI,CAAC9tB,SAAS,EAAE,CAACpS,OAAO,CAAC,UAACqM,KAAK,EAAK;SACnC,IAAI8zB,QAAQ,GAAG9zB,KAAK,CAAC7M,EAAE,CAAC+I,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,MAAM,GAAG8D,KAAK,CAAC7M,EAAE,CAACwe,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;SAC1E,IAAIoiB,SAAS,GAAG,EAAE;SAClB,IAAIxnB,SAAS,GAAGvM,KAAK,CAAC0I,IAAI;SAE1B,IAAI1I,KAAK,CAAC0I,IAAI,IAAIorB,QAAQ,KAAK,MAAM,IAAI9zB,KAAK,CAAC0I,IAAI,CAACxM,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,EACtE;WACC,IAAM83B,KAAK,GAAGh0B,KAAK,CAAC0I,IAAI,CAACiJ,KAAK,CAAC,IAAI,CAAC;WACpCoiB,SAAS,GAAGC,KAAK,CAACC,KAAK,EAAE;WACzB1nB,SAAS,GAAGynB,KAAK,CAAChiB,IAAI,CAAC,IAAI,CAAC;;SAG7B,IACChS,KAAK,CAAC,IAAI,CAAC,CAAC9D,OAAO,CAAC,cAAc,CAAC,KAAK,CAAC,IACtC8D,KAAK,CAAC,IAAI,CAAC,KAAK,gBAAgB,IAChCA,KAAK,CAAC,IAAI,CAAC,KAAK,uBAAuB,EAE3C;WACC8zB,QAAQ,GAAG,aAAa;WACxB,IAAME,MAAK,GAAGh0B,KAAK,CAAC0I,IAAI,CAACiJ,KAAK,CAAC,GAAG,CAAC;WACnCoiB,SAAS,GAAGC,MAAK,CAACC,KAAK,EAAE;WACzB1nB,SAAS,GAAGynB,MAAK,CAAChiB,IAAI,CAAC,GAAG,CAAC,CAACjH,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC,CAACA,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC;;SAG9D,IAAI,CAAC,MAAI,CAAC4nB,QAAQ,CAACmB,QAAQ,CAAC,EAC5B;WACC,MAAI,CAACnK,QAAQ,CAACmK,QAAQ,EAAE;aACvBpe,EAAE,EAAEoe,QAAQ;aACZr5B,KAAK,EAAEs5B,SAAS;aAChBF,UAAU,EAAE;YACZ,CAAC;;SAGH,MAAI,CAACK,YAAY,CAACJ,QAAQ,EAAE;WAC3Bpe,EAAE,EAAE1V,KAAK,CAAC6I,gBAAgB;WAC1BpO,KAAK,EAAE8R,SAAS,IAAIvM,KAAK,CAAC7M,EAAE;WAC5Bu2B,UAAU,EAAE;aAAC1pB,KAAK,EAALA;;UACb,CAAC;QACF,CAAC;;;KACF;KAAA,gCAGD;OACC,IAAMm0B,UAAU,GAAG,IAAI,CAACpuB,SAAS,EAAE,CAACvK,MAAM,CAAC,UAACwE,KAAK;SAAA,OAAKA,KAAK,CAAChN,IAAI,KAAK,MAAM;SAAC;OAE5E,IAAImhC,UAAU,CAAC90B,MAAM,GAAG,CAAC,EACzB;SACC,IAAI,CAACsqB,QAAQ,CAAC,SAAS,EAAE;WACxBjU,EAAE,EAAE,SAAS;WACbjb,KAAK,EAAEb,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;WAC3DW,QAAQ,2BAAE,IAAI,8CAAJ,IAAI,EAAmB25B,UAAU,CAAC;WAC5CN,UAAU,EAAE;UACZ,CAAC;;;;KAEH;KAAA,6BAoCD;OACC,IAAI,CAACj+B,IAAI,CAAC,YAAY,EAAE;SAAEqQ,QAAQ,EAAE;QAAM,CAAC;;;KAC3C;KAAA,6CAGD;OAAA;OACC,IAAMnC,IAAI,GAAG,IAAI;OAEjB+I,sBAAW,CAACjL,IAAI,CACflC,yBAAM,CAACsE,gBAAgB,EAAE,EACzB,IAAI,CAAC4uB,UAAU,EACf,CACC;SACCj5B,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;SACvDu6B,QAAQ,EAAE,wBAAAtwB,IAAI,CAACqhB,aAAa,wDAAlB,oBAAoBnyB,IAAI,MAAK,MAAM;SAC7Cia,OAAO,mBAACjX,KAAK,EAAE;WACd,IAAI,CAAC0P,WAAW,CAAC5C,KAAK,EAAE;WACxBgB,IAAI,CAAClO,IAAI,CAAC,eAAe,EAAE;aAACuvB,aAAa,EAAErhB,IAAI,CAACqhB;YAAc,CAAC;;QAEhE,EACD;SACCxrB,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,kCAAkC,CAAC;SACxDoT,OAAO,mBAACjX,KAAK,EAAE;WACd,IAAI,CAAC0P,WAAW,CAAC5C,KAAK,EAAE;WACxBgB,IAAI,CAAClO,IAAI,CAAC,gBAAgB,EAAE;aAACuvB,aAAa,EAAErhB,IAAI,CAACqhB;YAAc,CAAC;;QAEjE,EACD;SACCxrB,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,+BAA+B,CAAC;SACrDoT,OAAO,mBAACjX,KAAK,EAAE;WACd,IAAI,CAAC0P,WAAW,CAAC5C,KAAK,EAAE;WACxBgB,IAAI,CAAC0qB,QAAQ,CAACx4B,KAAK,EAAE,IAAI,CAAC;;QAE3B,CACD,EACD;SACCmX,QAAQ,EAAE,IAAI;SACd/I,UAAU,EAAE,EAAE;SACdiJ,KAAK,EAAE;WAAE3P,QAAQ,EAAE;UAAM;SACzByF,MAAM,EAAE;WACPuB,YAAY,0BACZ;aACC,IAAI,CAACE,OAAO,EAAE;;;QAGhB,CACD;OACD,sCAAI,mBAAmBiI,sBAAW,CAACwnB,WAAW;OAE9C,OAAO,IAAI;;;KACX;KAAA,uCAEsBj1B,KAAK,EAC5B;OAAA;OACCA,KAAK,CAACzL,OAAO,CAAC,UAACiL,MAAM,EAAK;SACzB,IAAI5L,cAAI,CAACU,OAAO,CAACkL,MAAM,CAACpE,QAAQ,CAAC,EACjC;WACC,MAAI,CAAC85B,2BAA2B,CAAC11B,MAAM,CAACnE,KAAK,EAAEmE,MAAM,CAACpE,QAAQ,CAAC;;QAEhE,CAAC;OAEF,OAAO4E,KAAK;;;KACZ;KAAA,4CAE2B3E,KAAa,EAAED,QAAQ,EACnD;OAAA;OACCA,QAAQ,CAAC7G,OAAO,CAAC,UAAC4gC,KAAK,EAAK;SAC3B,IAAI,CAACA,KAAK,CAAC3K,UAAU,EACrB;WACC2K,KAAK,CAAC3K,UAAU,GAAGnvB,KAAK;;SAEzB,IAAIzH,cAAI,CAACwb,aAAa,CAAC+lB,KAAK,CAAC/5B,QAAQ,CAAC,EACtC;WACC,MAAI,CAAC85B,2BAA2B,CAACC,KAAK,CAAC95B,KAAK,EAAE85B,KAAK,CAAC/5B,QAAQ,CAAC;;QAE9D,CAAC;;;KACF;KAAA,8BAEawF,KAAa,EAC3B;OACC,IAAI,CAACA,KAAK,EACV;SACC;;OAGD,IAAMw0B,SAAS,GAAG,IAAI,CAAClE,WAAW,CAACmE,OAAO,CAACx4B,WAAW,EAAE;OAExD,IAAIu4B,SAAS,KAAK,QAAQ,EAC1B;SACC,IAAIE,gBAAgB,GAAG,IAAI,CAACpE,WAAW,CAAChyB,aAAa,CAAC,0BAA0B,CAAC;SACjF,IAAI,CAACo2B,gBAAgB,EACrB;WACCA,gBAAgB,GACf,IAAI,CAACpE,WAAW,CAACz1B,WAAW,CAC3BtB,aAAG,CAACC,MAAM,CACT,QAAQ,EACR;aAACC,KAAK,EAAE;eAAC,WAAW,EAAE;;YAAc,CACpC,CAEF;;SAEFi7B,gBAAgB,CAAC/a,YAAY,CAAC,OAAO,EAAE3Z,KAAK,CAAC4I,UAAU,CAAC;SACxD8rB,gBAAgB,CAAChb,WAAW,GAAG1Z,KAAK,CAAC,YAAY,CAAC;SAElD00B,gBAAgB,CAACC,QAAQ,GAAG,IAAI;QAChC,MACI,IAAIH,SAAS,KAAK,OAAO,EAC9B;SACC,IAAI,CAAClE,WAAW,CAAC5W,WAAW,GAAG1Z,KAAK,CAAC4I,UAAU;SAC/C,IAAMgsB,WAAW,GAAGr+B,QAAQ,CAACs+B,cAAc,CAAC,IAAI,CAACvE,WAAW,CAACjyB,YAAY,CAAC,KAAK,CAAC,CAAC;SACjF,IAAIu2B,WAAW,EACf;WACCA,WAAW,CAACl/B,KAAK,GAAGsK,KAAK,CAAC4I,UAAU;;QAErC,MAED;SACC,IAAI,IAAI,CAACiqB,cAAc,EACvB;WACC,IAAI,CAACvC,WAAW,CAAC56B,KAAK,GAAGsK,KAAK,CAAC4I,UAAU;WACzC,IAAI,CAAC0nB,WAAW,CAACwE,YAAY,GAAG,IAAI,CAACxE,WAAW,CAAC56B,KAAK,CAAC2J,MAAM;UAC7D,MAED;WACC,IAAI01B,UAAU,GAAG,EAAE;WACnB,IAAMC,UAAU,GAAGh1B,KAAK,CAAC4I,UAAU;WACnC,IAAIqsB,SAAS,GAAG,EAAE;WAClB,IAAIjiC,cAAI,CAACkb,cAAc,CAAC,IAAI,CAACoiB,WAAW,CAAC56B,KAAK,CAAC,EAC/C;aACCq/B,UAAU,GAAG,IAAI,CAACzE,WAAW,CAAC56B,KAAK,CAACw/B,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC5E,WAAW,CAACwE,YAAY,CAAC;aAC5EG,SAAS,GAAG,IAAI,CAAC3E,WAAW,CAAC56B,KAAK,CAACw/B,MAAM,CAAC,IAAI,CAAC5E,WAAW,CAACwE,YAAY,CAAC;;WAGzE,IAAI,CAACxE,WAAW,CAAC56B,KAAK,GAAGq/B,UAAU,GAAGC,UAAU,GAAGC,SAAS;WAC5D,IAAI,CAAC3E,WAAW,CAACwE,YAAY,GAAGC,UAAU,CAAC11B,MAAM,GAAG21B,UAAU,CAAC31B,MAAM;;;OAIvEhD,EAAE,CAACkyB,SAAS,CAAC,IAAI,CAAC+B,WAAW,EAAE,QAAQ,CAAC;OACxC,IAAI,CAAC16B,IAAI,CAAC,gBAAgB,EAAE;SAAEoK,KAAK,EAALA;QAAO,CAAC;;;KACtC;KAAA,0BAGD;OACC,sCAAI,IAAI,YACR;SACC,sCAAI,WAAS4E,OAAO,EAAE;;OAEvB,sCAAI,IAAI,oBACR;SACC,sCAAI,mBAAiBA,OAAO,EAAE;;;;KAE/B;KAAA,4BAGD;OACC,IAAMuwB,eAAe,GAAGv7B,aAAG,CAACC,UAAU,CAAC,6CAA6C,CAAC;OACrF,IAAMm6B,KAAK,GAAG,IAAI,CAACvxB,OAAO,CAAC1C,MAAM,CAAC7K,GAAG,CAAC,UAAA8K,KAAK;SAAA,OAAIA,KAAK,CAAC0I,IAAI;SAAC,CAACsJ,IAAI,CAAC,IAAI,CAAC;OAErE,IAAMjS,MAAM,GAAG,EAAE;OACjB,IAAI,CAAC+P,WAAW,CAACnc,OAAO,CAAC,UAACqM,KAAK,EAAK;SACnCA,KAAK,CAACyI,QAAQ,GAAG,UAAU;SAE3B,IAAM2sB,MAAM,GAAIp1B,KAAK,CAAC,UAAU,CAAC,KAAK,QAAQ,IAAIA,KAAK,CAAC,MAAM,CAAC,KAAK,QAAS;SAE7E,IAAI,CAACo1B,MAAM,EACX;WACCr1B,MAAM,CAACjM,IAAI,CAACkM,KAAK,CAAC;;;;SAInB,IACCA,KAAK,CAAC,MAAM,CAAC,KAAK,MAAM,IAExBA,KAAK,CAAC,MAAM,CAAC,KAAK,MAAM,IAExBA,KAAK,CAAC,MAAM,CAAC,KAAK,MAAM,IAExBo1B,MAAM,EAEP;WACC,IAAMC,aAAa,GAAGr1B,KAAK,CAAC,MAAM,CAAC,GAAG,GAAG,GAAGm1B,eAAe;WAE3D,IAAInB,KAAK,CAAC93B,OAAO,CAACm5B,aAAa,CAAC,GAAG,CAAC,EACpC;aACC,IAAMC,cAAc,GAAGj5B,EAAE,CAAC7G,KAAK,CAACwK,KAAK,CAAC;aACtC,IAAMkd,YAAY,GAAIld,KAAK,CAAC,MAAM,CAAC,KAAK,MAAM,GAAI,UAAU,GAAG,WAAW;aAE1Es1B,cAAc,CAAC,MAAM,CAAC,GAAGD,aAAa;aACtCC,cAAc,CAAC,MAAM,CAAC,GAAG,QAAQ;aACjCA,cAAc,CAAC,kBAAkB,CAAC,GAAG,aAAa,GAACA,cAAc,CAAC,IAAI,CAAC,GAAC,KAAK,GAACpY,YAAY,GAAC,GAAG;aAC9FoY,cAAc,CAAC,YAAY,CAAC,GAAG,IAAI,GAACt1B,KAAK,CAAC,MAAM,CAAC,GAAC,KAAK,GAACkd,YAAY,GAAC,IAAI;aAEzEnd,MAAM,CAACjM,IAAI,CAACwhC,cAAc,CAAC;;;SAG7B,IAAIt1B,KAAK,CAAC,UAAU,CAAC,KAAK,MAAM,IAAIA,KAAK,CAAC,UAAU,CAAC,KAAK,UAAU,IAAIA,KAAK,CAAC,UAAU,CAAC,KAAK,MAAM,EACpG;WACC,IAAMu1B,WAAW,GAAGl5B,EAAE,CAAC7G,KAAK,CAACwK,KAAK,CAAC;WACnCu1B,WAAW,CAAC,MAAM,CAAC,IAAI,GAAG,GAAG37B,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;WACxF07B,WAAW,CAAC,MAAM,CAAC,GAAG,QAAQ;WAC9BA,WAAW,CAAC,kBAAkB,CAAC,wBAAiBA,WAAW,CAAC,IAAI,CAAC,eAAY;WAC7EA,WAAW,CAAC,YAAY,CAAC,eAAQv1B,KAAK,CAAC,MAAM,CAAC,gBAAa;WAE3DD,MAAM,CAACjM,IAAI,CAACyhC,WAAW,CAAC;WAExB,IAAMC,gBAAgB,GAAGn5B,EAAE,CAAC7G,KAAK,CAACwK,KAAK,CAAC;WACxCw1B,gBAAgB,CAAC,MAAM,CAAC,IAAI,GAAG,GAAG57B,aAAG,CAACC,UAAU,CAAC,gDAAgD,CAAC;WAClG27B,gBAAgB,CAAC,MAAM,CAAC,GAAG,QAAQ;WACnCA,gBAAgB,CAAC,kBAAkB,CAAC,wBAAiBD,WAAW,CAAC,IAAI,CAAC,oBAAiB;WACvFC,gBAAgB,CAAC,YAAY,CAAC,eAAQx1B,KAAK,CAAC,MAAM,CAAC,qBAAkB;WAErED,MAAM,CAACjM,IAAI,CAAC0hC,gBAAgB,CAAC;;QAE9B,CAAC;OAEF,OAAOz1B,MAAM;;;GACb;CAAA,EApjBkC7J,6BAAY;CAqjB/C,0BA9gBgBg0B,KAAoB,EACpC;GAAA;GACC,IAAI,CAACl3B,cAAI,CAACU,OAAO,CAACw2B,KAAK,CAAC1vB,QAAQ,CAAC,EACjC;KACC0vB,KAAK,CAAC1vB,QAAQ,GAAG,EAAE;;GAGpB0vB,KAAK,CAAC1vB,QAAQ,GACb0vB,KAAK,CACH1vB,QAAQ,CACRgB,MAAM,CAAC,UAAA0R,IAAI;KAAA;KAAA,OAAI,oBAAAA,IAAI,CAACwc,UAAU,6CAAf,iBAAiB1pB,KAAK,4BAAG,MAAI,4CAAJ,MAAI,EAAkBkN,IAAI,CAACwc,UAAU,CAAC1pB,KAAK,IAAI,IAAI;KAAC,CAC5F9K,GAAG,CAAC,UAAAugC,UAAU;KAAA,gCAAI,MAAI,0CAAJ,MAAI,EAAiBA,UAAU;IAAC,CACpD;GAED;KACCC,QAAQ,EAAE,IAAI;KACdrM,IAAI,EAAE;MACHa,KAAK;CAEV;CAAC,2CA4DD;GAAA;KAAA;GACC,IAAI,CAACpa,WAAW,GAAG,IAAI,CAACA,WAAW,CAACtU,MAAM,CAAC,UAAAwE,KAAK;KAAA,gCAAI,MAAI,4CAAJ,MAAI,EAAkBA,KAAK;IAAC,CAAC;GAEjF,IAAM5B,IAAI,0BAAG,IAAI,CAAC+mB,aAAa,wDAAlB,oBAAoBnyB,IAAI;GACrC,IAAIoL,IAAI,KAAK,MAAM,EACnB;KACC,IAAI,CAACy0B,cAAc,GAAG,IAAI;IAC1B,MACI,IAAIz0B,IAAI,KAAK,MAAM,IAAIA,IAAI,KAAK,UAAU,EAC/C;KACC,IAAI,CAACy0B,cAAc,GAAG,IAAI;KAE1B,IAAMpM,qBAAqB,GAAG,IAAIC,wCAAqB,CAAC;OACvDC,SAAS,EAAE,IAAI,CAAC2J,WAAW;OAC3BxgB,WAAW,EAAE,IAAI,CAACA,WAAW;OAC7B+W,aAAa,EAAE,IAAI;OACnBD,QAAQ,EAAG,UAAS9K,KAAK,EACzB;SACC,IAAI,CAACwU,WAAW,CAAC56B,KAAK,GAAGomB,KAAK,CAAC6Z,YAAY,CAC1C,IAAI,CAAC7lB,WAAW,EAChBpQ,yBAAM,CAAC4G,4BAA4B,CAAC,IAAI,CAAC7D,OAAO,CAAC1C,MAAM,CAAC,CACxD;QACD,CAAEhG,IAAI,CAAC,IAAI;MACZ,CAAC;KAEF0sB,qBAAqB,CAAC7qB,IAAI,CAAC6S,gCAAa,CAACmnB,UAAU,CAAC,IAAI,CAACtF,WAAW,CAAC56B,KAAK,EAAE,IAAI,CAACoa,WAAW,CAAC,CAAC;IAC9F,MACI,IAAI1R,IAAI,KAAK,MAAM,EACxB;KACC,IAAI,CAACy0B,cAAc,GAAG,IAAI;KAE1B,IAAMgD,YAAY,GAAG,IAAIlE,kBAAkB,CAAC;OAAChL,SAAS,EAAE,IAAI,CAAC2J;MAAY,CAAC;KAE1EuF,YAAY,CAACj6B,IAAI,CAAC,IAAI,CAAC00B,WAAW,CAAC56B,KAAK,CAAC;;CAE3C;CAAC,2BAEgBsK,KAAY,EAC7B;GAAA;GACC,IAAMivB,SAAS,2BAAG,IAAI,CAAC9J,aAAa,yDAAlB,qBAAoBnyB,IAAI;GAC1C,IAAIi8B,SAAS,KAAK,MAAM,EACxB;KACC,OAAOjvB,KAAK,CAAChN,IAAI,KAAK,MAAM;IAC5B,MACI,IAAIi8B,SAAS,KAAK,MAAM,IAAIA,SAAS,KAAK,UAAU,EACzD;KACC,OAAOjvB,KAAK,CAAChN,IAAI,KAAK,MAAM,IAAIgN,KAAK,CAAChN,IAAI,KAAK,UAAU;IACzD,MACI,IAAIi8B,SAAS,KAAK,MAAM,EAC7B;KACC,OAAOjvB,KAAK,CAAChN,IAAI,KAAK,MAAM,IAAIgN,KAAK,CAAChN,IAAI,KAAK,UAAU,IAAIgN,KAAK,CAAChN,IAAI,KAAK,MAAM;;GAGnF,OAAO,IAAI;CACZ;CAAC,qBAEUgD,KAAoB,EAC/B;GACC,IAAIA,KAAK,CAAC8/B,OAAO,KAAK,EAAE,IAAI9/B,KAAK,CAAC+/B,MAAM,KAAK,KAAK,IAAI//B,KAAK,CAACyI,OAAO,KAAK,KAAK,IAAIzI,KAAK,CAACggC,QAAQ,KAAK,KAAK,EACzG;KACC,IAAI,CAACxH,QAAQ,CAACx4B,KAAK,CAAC;KACpBA,KAAK,CAACwlB,cAAc,EAAE;;CAExB;CAAC,4BAoIiB2Y,UAAwB,EAC1C;GACC,OAAOA,UAAU,CAACj/B,GAAG,CAAC,UAAC8K,KAAK,EAAK;KAChC,IAAMi2B,GAAG,GACRj2B,KAAK,CAAC,UAAU,CAAC,KAAK,UAAU,GAC7B,IAAI,GAACA,KAAK,CAAC,MAAM,CAAC,GAAC,gBAAgB,GACnC,KAAK,GAACA,KAAK,CAAC,UAAU,CAAC,GAAC,GAAG,GAACA,KAAK,CAAC,IAAI,CAAC,GAAC,gBAC3C;KAED,IAAIvF,KAAK,GAAGuF,KAAK,CAAC0I,IAAI,IAAI1I,KAAK,CAAC7M,EAAE;KAElC,IAAI6M,KAAK,CAAC2I,UAAU,EACpB;OACClO,KAAK,GAAGuF,KAAK,CAAC2I,UAAU,GAAG,IAAI,GAAGlO,KAAK;;KAGxC,OAAO;OACNA,KAAK,EAAEA,KAAK;OACZivB,UAAU,EAAE;SACX1pB,KAAK,EAAE;WACN7M,EAAE,EAAE6M,KAAK,CAAC,IAAI,CAAC,GAAG,YAAY;WAC9ByI,QAAQ,EAAEzI,KAAK,CAAC,UAAU,CAAC;WAC3B0I,IAAI,EAAE1I,KAAK,CAAC,MAAM,CAAC;WACnBhN,IAAI,EAAE,QAAQ;WACd4V,UAAU,EAAEqtB,GAAG;WACfptB,gBAAgB,EAAE,IAAI,GAAC7I,KAAK,CAAC,UAAU,CAAC,GAAC,GAAG,GAACA,KAAK,CAAC,IAAI,CAAC,GAAC;;QAE1D;OACD0V,EAAE,EAAEugB;MACJ;IACD,CAAC;CACH;;;;;;;;ACjWD,CAEgC;CAAA;AAEhC,KAAa3H,uBAAuB;GAAA;GAInC,iCAAYl4B,KAGX,EACD;KAAA;KAAA;KACC,qHAAMA,KAAK;KAAEqK;KAAAhN;OAAA;OAAA;;KAEb,2FAAkB2C,KAAK,CAAC4C,SAAS;KAAC;;GAClC;KAAA;KAAA,yBAEQkoB,MAAe,EACxB;OACC,IAAI,CAACoP,WAAW,GAAGpP,MAAM;OACzB,IAAI,CAAC0R,UAAU,GAAG1R,MAAM;OAExB,IAAI,CAACqP,qBAAqB,EAAE;OAC5B,IAAI,CAAC2F,gBAAgB,EAAE;;;KACvB;KAAA,6BAGD;OACC,IAAI,CAACvC,gBAAgB,EAAE;;;KACvB;KAAA,6BAGD;OACC,IAAI,CAAC/9B,IAAI,CAAC,YAAY,EAAE;SACvBqQ,QAAQ,EAAE,IAAI;;SAEdujB,gBAAgB,2BAAE,IAAI,wDAAJ,IAAI;QACtB,CAAC;;;KACF;KAAA,8BAEaxpB,KAAa,EAC3B;OACC,IAAI,CAACpK,IAAI,CAAC,QAAQ,EAAE;SAAEoK,KAAK,EAALA;QAAO,CAAC;;;KAC9B;KAAA,4BAYD;OACC,OAAO,IAAI,CAACyC,OAAO,CAAC1C,MAAM,CAAC7K,GAAG,CAAC,UAAC8K,KAAK;SAAA,2CACjCA,KAAK;WACRyI,QAAQ,EAAE;;QACT,CAAC;;;GACH;CAAA,EAzD2C4oB,cAAc;CA0D1D,mCAfA;GACC,OACC,sCAAI,mBACD,sCAAI,gBAAYlH,WAAW,IAC3B,sCAAI,gBAAYA,WAAW,CAAC/rB,IAAI,KAAK1G,iCAAc,CAACygB,cAAc,CAACC,KAAK;CAE7E;;;;;;;ACrDD,CAEmD;CAAA;CAAA;CAAA;CAAA;CAAA;AAEnD,KAAamZ,kBAAkB;GAAA;GAAA;KAAA;KAAA;KAAA;KAAA;OAAA;;KAAA;KAAA9wB;KAAAA;KAAAA;KAAAA;KAAAhN;OAAA;OAAA;;KAAAA;OAAA;OAAA,OAGb;SAChB,qBAAqB,EAAE8P,yGAAsBxJ,IAAI;;;KACjD;;GAAA;KAAA;KAAA,0BAGD;OACCwJ,6BAAI,sCAAJ,IAAI;;;KACJ;KAAA,yBAEQ+sB,WAAoB,EAC7B;OACC,IAAI,CAACA,WAAW,GAAGA,WAAW;OAC9B,sCAAI,eAAeA,WAAW,CAAChyB,aAAa,CAAC,iBAAiB,CAAC;OAC/D,IAAI,CAACs0B,UAAU,GAAGpP,aAAG,CAACC,MAAM,6MAEf,IAAI,CAAC+K,QAAQ,CAACz0B,IAAI,CAAC,IAAI,CAAC,CAGpC;OAED,IAAI,CAACw2B,qBAAqB,EAAE;OAC5B,IAAI,CAAC2F,gBAAgB,EAAE;OAEvB5F,WAAW,CAAC6F,iBAAiB,CAACt7B,WAAW,CAAC,IAAI,CAAC+3B,UAAU,CAAC;OAE1DrvB,6BAAI,kCAAJ,IAAI;;;KACJ;KAAA,8BA0EavD,KAAa,EAC3B;OACC,IAAMo2B,UAAU,GAAGp2B,KAAK,CAAC4I,UAAU;OACnC,IAAMytB,MAAM,4BAAG,IAAI,gCAAJ,IAAI,CAAa;OAEhC,IAAIA,MAAM,IAAIA,MAAM,CAACC,UAAU,EAC/B;SACC,IAAID,MAAM,CAACE,OAAO,CAACC,mBAAmB,EAAE,EACxC;WACCH,MAAM,CAACI,YAAY,CAACC,KAAK,EAAE;WAC3BL,MAAM,CAACI,YAAY,CAACE,QAAQ,CAAC,EAAE,EAAE,EAAE,EAAEP,UAAU,CAAC;UAChD,MAED;WACCC,MAAM,CAACC,UAAU,CAACF,UAAU,CAAC;;SAE9BC,MAAM,CAACE,OAAO,CAACK,IAAI,EAAE;;;;KAEtB;KAAA,+BAGD;OACC,IAAMP,MAAM,4BAAG,IAAI,gCAAJ,IAAI,CAAa;OAChC,IAAIA,MAAM,IAAIA,MAAM,CAACQ,WAAW,EAChC;SACCR,MAAM,CAACQ,WAAW,EAAE;;;;KAErB;KAAA,gCAGD;OACC,IAAMR,MAAM,4BAAG,IAAI,gCAAJ,IAAI,CAAa;OAChC,IAAIA,MAAM,IAAIA,MAAM,CAACS,cAAc,EACnC;SACCT,MAAM,CAACS,cAAc,EAAE;;;;GAExB;CAAA,EA3IsCzF,cAAc;CAuJrD,wBAvHA;GACC,mCAA8Bhb,MAAM,CAACf,OAAO,mCAAC,IAAI,kBAAgB,qCACjE;KADK;OAAO7f,IAAI;OAAEshC,OAAO;KAExB16B,EAAE,CAAC2E,cAAc,CAACvL,IAAI,EAAEshC,OAAO,CAAC;;CAElC;CAAC,0BAGD;GACC,qCAA8B1gB,MAAM,CAACf,OAAO,mCAAC,IAAI,kBAAgB,wCACjE;KADK;OAAO7f,IAAI;OAAEshC,OAAO;KAExB16B,EAAE,CAAC26B,iBAAiB,CAACvhC,IAAI,EAAEshC,OAAO,CAAC;;CAErC;CAAC,2BAEgBV,MAAM,EACvB;GACC,IAAIA,MAAM,CAACY,GAAG,CAACC,IAAI,uCAAK,IAAI,cAAY,EACxC;KACC,OAAO,KAAK;;GAGb,IAAIC,MAAM,GAAG,EAAE;GACf,IAAIC,MAAM,GAAG,EAAE;GAEf,IAAMC,SAAS,GAAG,SAAZA,SAAS,CAAInzB,OAAe,EAAwC;KAAA,IAAtCozB,gBAAyB,uEAAG,KAAK;KACpE,OAAOpzB,OAAO,CAAC6G,OAAO,CAAC,yBAAyB,EAAE,UAAC2F,GAAG,EAAK;OAC1D,IAAI4mB,gBAAgB,EACpB;SACCH,MAAM,GAAGzmB,GAAG;;OAGb,OAAO,EAAE;MACT,CAAC;IACF;GAED,IAAM6mB,SAAS,GAAG,SAAZA,SAAS,CAAIrzB,OAAe,EAAwC;KAAA,IAAtCszB,gBAAyB,uEAAG,KAAK;KACpE,OAAOtzB,OAAO,CAAC6G,OAAO,CAAC,sBAAsB,EAAE,UAAC2F,GAAG,EAAK;OACvD,IAAI8mB,gBAAgB,EACpB;SACCJ,MAAM,GAAG1mB,GAAG;;OAGb,OAAO,EAAE;MACT,CAAC;IACF;GAEDrU,EAAE,CAAC2E,cAAc,CAACq1B,MAAM,EAAE,SAAS,EAAE,UAAUj/B,IAAI,EACnD;KACC,IAAI,CAACA,IAAI,EACT;OACC,IAAI,CAAC8M,OAAO,GAAGqzB,SAAS,CAACF,SAAS,CAAC,IAAI,CAACnzB,OAAO,EAAE,IAAI,CAAC,EAAE,IAAI,CAAC;;IAE9D,CAAC;GAEF7H,EAAE,CAAC2E,cAAc,CAACq1B,MAAM,EAAE,cAAc,EAAE,UAAUj/B,IAAI,EACxD;KACC,IAAIA,IAAI,EACR;OACC,IAAI8M,OAAO,GAAGqzB,SAAS,CAACF,SAAS,CAAC,IAAI,CAACnzB,OAAO,CAAC,CAAC;OAEhD,IAAIizB,MAAM,KAAK,EAAE,IAAIC,MAAM,KAAK,EAAE,EAClC;SACClzB,OAAO,GAAGizB,MAAM,GAAGjzB,OAAO,GAAGkzB,MAAM;;OAGpC,IAAI,CAAClzB,OAAO,GAAGA,OAAO;;IAEvB,CAAC;CACH;CAAC,uBAyCD;GACC,sCAAI,IAAI,gBACR;KACC,IAAMuzB,QAAQ,GAAG,sCAAI,eAAa/hB,EAAE,CAAC/D,KAAK,CAAC,GAAG,CAAC;KAC/C,OAAO+lB,YAAY,CAACC,GAAG,CAACF,QAAQ,CAACA,QAAQ,CAACp4B,MAAM,GAAG,CAAC,CAAC,CAAC;;GAGvD,OAAO,IAAI;CACZ;;;;;;AC1JD,CAAqD;CAAA;CAAA;CAAA;CAAA;AAErD,KAAaqyB,iBAAiB;GAM7B,2BAAYt7B,KAIX,EACD;KAAA;KAAAqK;KAAAA;KAAAhN;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KAAAA;OAAA;OAAA;;KACC,sCAAI,cAAY2C,KAAK,CAACqM,OAAO;KAC7B,sCAAI,aAAarM,KAAK,CAAC4uB,QAAQ;KAC/B,sCAAI,aAAa5uB,KAAK,CAAC2uB,QAAQ;KAE/B,IAAI3uB,KAAK,CAAC2uB,QAAQ,EAClB;OACC,IAAMvwB,QAAQ,GAAG,qBAAqB;OACtC,IAAMojC,UAAU,GAAG,sCAAI,cAAU/gC,GAAG,CAAC,aAAa,CAAC,CAACA,GAAG,CAACrC,QAAQ,2BAAE,IAAI,0BAAJ,IAAI,GAAY,GAAG,CAAC;OACtF,IAAIojC,UAAU,KAAK,GAAG,EACtB;SACC,sCAAI,aAAWpxB,OAAO,GAAG,IAAI;;;;GAG/B;KAAA;KAAA,0BAGD;OACC,sCAAI,IAAI,cACR;SACC,sCAAI,cAAU3P,GAAG,CAAC,aAAa,CAAC,CAAC5C,GAAG,CAAC,uBAAuB,2BAAE,IAAI,0BAAJ,IAAI,4BAAY,IAAI,8BAAJ,IAAI,EAAa;;;;GAEhG;CAAA;CAWD,oBARA;GACC,OAAO,sCAAI,aAAWoK,YAAY,CAAC,qBAAqB,CAAC;CAC1D;CAAC,sBAGD;GACC,OAAO,sCAAI,aAAWmI,OAAO,GAAG,GAAG,GAAI,GAAG;CAC3C;;KC1CYuB,YAAY;GAAA;GAAA;KAAA;KAAA;;GAAA;KAAA;KAAA,yBAEfuoB,WAAoB,EAC7B;OACC,IAAI,CAACA,WAAW,GAAGA,WAAW;OAC9B,IAAI,CAACsC,UAAU,GAAGtC,WAAW;OAE7B,IAAI,CAACnL,aAAa,GAAGxlB,IAAI,CAACylB,KAAK,CAACkL,WAAW,CAACjyB,YAAY,CAAC,eAAe,CAAC,CAAC;OAC1E,IAAI,CAAC,IAAI,CAAC8mB,aAAa,EACvB;SACC,IAAI,CAAC1iB,OAAO,CAACoiB,eAAe,GAAG,KAAK;;OAGrC,IAAMgT,oBAAoB,GAAG,IAAI,CAACp1B,OAAO,CAAC5L,GAAG,CAAC,sBAAsB,CAAC;OACrE,IAAI,CAACihC,YAAY,GAAGz7B,EAAE,CAAC6J,OAAO,CAAC6B,YAAY,CAACC,YAAY,CACvDsoB,WAAW,EACX;SACCpH,gBAAgB,EAAEl2B,cAAI,CAACU,OAAO,CAACmkC,oBAAoB,CAAC,GAAGA,oBAAoB,GAAG;QAC9E,CACD;;;KACD;KAAA,0BAGD;OACC;OAEA,IAAI,IAAI,CAACC,YAAY,EACrB;SACC,IAAI,CAACA,YAAY,CAAClzB,OAAO,EAAE;SAC3B,IAAI,CAACkzB,YAAY,GAAG,IAAI;;;;GAEzB;CAAA,EA/BgCzG,cAAc;;;;;;;;;;;;ACHhD,CAGmD;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEnD,KAAaF,YAAY;GAAA;GA0BxB,sBAAY/6B,KAAmC,EAC/C;KAAA;KAAA;KACC,0GAAMA,KAAK;KAAEqK;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAhN;OAAA;OAAA,OApBE09B,YAAY,CAAC4G,IAAI,CAACC;;KAAIvkC;OAAA;OAAA,OACjB;;KAAKA;OAAA;OAAA,OACL;;KAAKA;OAAA;OAAA,OACA;;KAAEA;OAAA;OAAA,OACH;;KAAEA;OAAA;OAAA,OACP;;KAAKA;OAAA;OAAA,OACR;;KAAEA;OAAA;OAAA,OACE;;KAAEA;OAAA;OAAA,OACF;;KAAEA;OAAA;OAAA,OAE8B;;KAAIA;OAAA;OAAA,OAElB;;KAAIA;OAAA;OAAA,OACR;;KAAIA;OAAA;OAAA,OACA;;KAAIA;OAAA;OAAA;;KAQ1C,MAAKgP,OAAO,CAACxO,GAAG,CACf,YAAY,EACZ,MAAKwO,OAAO,CAAC1C,MAAM,CAACvE,MAAM,CAAC,UAAAwE,KAAK;OAAA,OAAIA,KAAK,CAAChN,IAAI,KAAK,MAAM;OAAC,CAC1D;KAAC;;GACF;KAAA;KAAA,0BAGD;OACC,IAAI,IAAI,CAACilC,IAAI,EACb;SACC,IAAI,CAACA,IAAI,CAACvyB,WAAW,CAAC5C,KAAK,EAAE;;;;KAE9B;KAAA,yBAEQwtB,WAAoB,EAC7B;OACC,IAAI,CAACA,WAAW,GAAGA,WAAW;OAE9B,IAAMqE,QAAQ,GAAG,IAAI,CAACpE,qBAAqB,EAAE;OAE7C,IAAI,CAACD,WAAW,CAACz1B,WAAW,0BAAC,IAAI,0CAAJ,IAAI,EAAmB;OACpD0I,6BAAI,wDAAJ,IAAI,EAAwBoxB,QAAQ;;;;;KAGpC;KAAA,wCAGD;OACC,IAAIuD,MAAM,GAAGv4B,IAAI,CAACylB,KAAK,CAAC,IAAI,CAACkL,WAAW,CAACjyB,YAAY,CAAC,aAAa,CAAC,CAAC;OACrE,IAAI,CAACrL,cAAI,CAACuC,aAAa,CAAC2iC,MAAM,CAAC,EAC/B;SACCA,MAAM,GAAG,EAAE;;OAGZ,sCAAI,WAASA,MAAM,CAAC95B,IAAI,IAAI+yB,YAAY,CAAC4G,IAAI,CAACI,IAAI;OAClD,IAAID,MAAM,CAACvD,QAAQ,IAAI,CAACuD,MAAM,CAACvD,QAAQ,CAACt1B,MAAM,EAC9C;SACC,sCAAI,WAAS8xB,YAAY,CAAC4G,IAAI,CAACC,IAAI;;OAGpC,sCAAI,aAAaE,MAAM,CAAChJ,QAAQ,IAAI,KAAK;OACzC,sCAAI,aAAagJ,MAAM,CAACE,QAAQ,IAAI,KAAK;OACzC,sCAAI,mBAAmBF,MAAM,CAACG,cAAc,IAAI,EAAE;OAClD,sCAAI,kBAAkBH,MAAM,CAACI,aAAa,IAAI,EAAE;OAChD,sCAAI,YAAYJ,MAAM,CAACK,OAAO,IAAI,KAAK;OACvC,sCAAI,UAAUL,MAAM,CAACnnB,KAAK,IAAI,YAAY;OAC1C,sCAAI,cAAcmnB,MAAM,CAACM,SAAS,IAAI,MAAM;OAC5C,sCAAI,cAAcN,MAAM,CAACO,SAAS,IAAI,MAAM;OAE5C,IAAIP,MAAM,CAACvD,QAAQ,IAAIuD,MAAM,CAACvD,QAAQ,CAACt1B,MAAM,GAAG,CAAC,EACjD;SACC,OAAOhJ,iBAAO,CAACb,KAAK,CAAC0iC,MAAM,CAACvD,QAAQ,CAAC;;;;KAEtC;KAAA,yBA+MQv1B,KAAoB,EAC7B;OACC,IAAI,sCAAI,eAAW+xB,YAAY,CAAC4G,IAAI,CAACI,IAAI,EACzC;SAAA,6CACuB/4B,KAAK;WAAA;SAAA;WAA3B,oDACA;aAAA,IADUs5B,QAAQ;aAEjBn1B,6BAAI,oCAAJ,IAAI,EAAcm1B,QAAQ;;;WAC1B;;WAAA;;QACD,MAED;SACCn1B,6BAAI,4CAAJ,IAAI,EAEFo1B,SAAS,8BACTxH,YAAY,EAhTJA,YAAY,4BAgTpBA,YAAY,EAAqB/xB,KAAK,EACtC;;;;KAEH;KAAA,8BAwDaY,KAAK,EACnB;OACCuD,6BAAI,oCAAJ,IAAI,EAAc;SACjBmS,EAAE,EAAE1V,KAAK,CAAC7M,EAAE;SACZgqB,UAAU,EAAEnd,KAAK,CAAC4I,UAAU;SAC5BnT,IAAI,EAAEuK,KAAK,CAAC0I,IAAI;SAChBtK,IAAI,EAAE+yB,YAAY,CAAC4G,IAAI,CAACI;QACxB;;;KACD;KAAA,+BAuBD;OACC,IAAIS,GAAG,GAAG,EAAE;OACZ,IAAI,sCAAI,eAAWzH,YAAY,CAAC4G,IAAI,CAACc,IAAI,EACzC;SACCD,GAAG,GAAGr1B,6BAAI,4CAAJ,IAAI,EAAoBjN,SAAS,EAAE;QACzC,MACI,IAAI,sCAAI,eAAW66B,YAAY,CAAC4G,IAAI,CAACI,IAAI,EAC9C;SACCS,GAAG,GACFzkC,KAAK,CAACC,IAAI,CAAC,sCAAI,kBAAgB0kC,UAAU,CAAC,CACxC5jC,GAAG,CAAC,UAAA6C,IAAI;WAAA,OAAIA,IAAI,CAACsG,YAAY,CAAC,sBAAsB,CAAC;WAAC,CACtD7C,MAAM,CAAC,UAAAka,EAAE;WAAA,OAAIA,EAAE,KAAK,EAAE;WACxB;;OACD,8CAEgBkjB,GAAG;SAAA;OAAA;SAApB,uDACA;WAAA,IADWljB,EAAE;WAEZ,IAAI,CAAC4a,WAAW,CAACz1B,WAAW,CAAC2oB,aAAG,CAACC,MAAM,wMAG7B,sCAAI,sBAAoB,sCAAI,eAAa,IAAI,GAAG,EAAE,CAAC,EAClD/N,EAAE,EAEX;;;SACF;;SAAA;;;;GACD;CAAA,EAnagC2b,cAAc;CAoa/C,4BA9UA;GACC,IAAMvL,MAAM,GAAGpmB,yBAAM,CAACsE,gBAAgB,EAAE;GACxC,IAAI+0B,SAAS,GAAG,IAAI;GAEpB,IAAMC,eAAe,GAAG,EAAE;GAE1B,IAAI,IAAI,CAACv2B,OAAO,CAAC5L,GAAG,CAAC,YAAY,CAAC,CAACwI,MAAM,GAAG,CAAC,EAC7C;KACC05B,SAAS,GAAGvV,aAAG,CAACC,MAAM,iTAERqC,MAAM,oCAGV,IAAI,mBACHqL,YAAY,CAAC4G,IAAI,CAACI,IAAI,EAC7B,sCAAI,eAAWhH,YAAY,CAAC4G,IAAI,CAACI,IAAI,GAAG,SAAS,GAAG,EAAE,CAEzD;;GAGF,IAAMc,aAAa,GAAGzV,aAAG,CAACC,MAAM,+RAElBqC,MAAM,oCAGV,IAAI,mBACHqL,YAAY,CAAC4G,IAAI,CAACc,IAAI,EAC7B,sCAAI,eAAW1H,YAAY,CAAC4G,IAAI,CAACc,IAAI,GAAG,SAAS,GAAG,EAAE,CAEzD;GAEDG,eAAe,CAACllC,IAAI,CAAC0vB,aAAG,CAACC,MAAM,4MAC0B,IAAI,WAC3D;GAEF,IAAIsV,SAAS,EACb;KACCC,eAAe,CAACllC,IAAI,CAACilC,SAAS,EAAEvV,aAAG,CAACC,MAAM,iRAG3BqC,MAAM,EACRviB,6BAAI,iCAAexJ,IAAI,CAAC,IAAI,EAAEo3B,YAAY,CAAC4G,IAAI,CAACI,IAAI,CAAC,oCAE/D,IAAI,eAEL;;GAGHa,eAAe,CAACllC,IAAI,CAACmlC,aAAa,EAAEzV,aAAG,CAACC,MAAM,iQAG/BqC,MAAM,EACRviB,6BAAI,iCAAexJ,IAAI,CAAC,IAAI,EAAEo3B,YAAY,CAAC4G,IAAI,CAACc,IAAI,CAAC,oCAE/D,IAAI,eAEL;GAEF,OAAOrV,aAAG,CAACC,MAAM,qLAEbuV,eAAe;CAGpB;CAAC,iCAEsBrE,QAAe,EACtC;GACC,IAAI,sCAAI,eAAWxD,YAAY,CAAC4G,IAAI,CAACc,IAAI,EACzC;KACCt1B,6BAAI,8DAAJ,IAAI;KACJA,6BAAI,8DAAJ,IAAI,EAA2BoxB,QAAQ;IACvC,MACI,IAAI,sCAAI,eAAWxD,YAAY,CAAC4G,IAAI,CAACI,IAAI,EAC9C;KACC50B,6BAAI,8DAAJ,IAAI;KACJA,6BAAI,8DAAJ,IAAI,EAA2BoxB,QAAQ;IACvC,MAED;KACCpxB,6BAAI,8DAAJ,IAAI;KACJA,6BAAI,8DAAJ,IAAI;;CAEN;CAAC,oCAEyBoxB,QAAe,EACzC;GACC,IAAI,mCAAC,IAAI,sBAAoB,EAC7B;KACC,sCAAI,uBAAuBp7B,aAAG,CAACC,MAAM,CAAC,KAAK,CAAC;KAE5C,IAAI,CAAC82B,WAAW,CAACz1B,WAAW,mCAAC,IAAI,uBAAqB;KAEtD,IAAMq+B,YAAY,4BAAG,IAAI,4CAAJ,IAAI,CAAmB;KAC5CA,YAAY,CAACC,MAAM,mCAAC,IAAI,uBAAqB;KAC7CD,YAAY,CAACt3B,IAAI,CAAC,IAAI,CAAC;KAEvB,IAAI+yB,QAAQ,EACZ;OACC,IAAI,CAACyE,QAAQ,CAACzE,QAAQ,CAAC;;IAExB,MAED;KACCp7B,aAAG,CAACqI,IAAI,mCAAC,IAAI,uBAAqB;;CAEpC;CAAC,sCAGD;GACC,sCAAI,IAAI,wBACR;KACCrI,aAAG,CAACmI,IAAI,mCAAC,IAAI,uBAAqB;;CAEpC;CAAC,oCAEyBizB,QAAe,EACzC;GACC,IAAI,mCAAC,IAAI,sBAAoB,EAC7B;KACC,sCAAI,kBAAkBp7B,aAAG,CAACC,MAAM,CAAC,MAAM,CAAC;KACxC,sCAAI,uBAAuBD,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;OAACgB,QAAQ,EAAE,mCAAC,IAAI;MAAiB,CAAC;KAC/E,IAAI,CAAC81B,WAAW,CAACz1B,WAAW,mCAAC,IAAI,uBAAqB;KACtD,IAAMw+B,aAAa,GAAG9/B,aAAG,CAACC,MAAM,CAAC,GAAG,EAAE;OACrCC,KAAK,EAAE;SAACC,SAAS,EAAE;QAAqF;OACxGC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,4BAA4B;MACjD,CAAC;KAEF,sCAAI,uBAAqBgB,WAAW,CAACw+B,aAAa,CAAC;KAEnDv/B,eAAK,CAACC,IAAI,CAACs/B,aAAa,EAAE,OAAO,EAAE91B,6BAAI,+CAAsBxJ,IAAI,CAAC,IAAI,EAAEs/B,aAAa,CAAC,CAAC;KAEvF,IAAI1E,QAAQ,EACZ;OACC,IAAI,CAACyE,QAAQ,CAACzE,QAAQ,CAAC;;IAExB,MAED;KACCp7B,aAAG,CAACqI,IAAI,mCAAC,IAAI,uBAAqB;;CAEpC;CAAC,sCAGD;GACC,sCAAI,IAAI,wBACR;KACCrI,aAAG,CAACmI,IAAI,mCAAC,IAAI,uBAAqB;;CAEpC;CAAC,6BAGD;GACC,IAAI,mCAAC,IAAI,gBAAc,EACvB;KACC,sCAAI,iBAAiBrF,EAAE,CAAC6J,OAAO,CAACozB,UAAU,CAACC,YAAY,CAAC//B,MAAM,CAC7D,EAAE,EACF;OACCggC,GAAG,EAAE;SACJ,iBAAiB,EAAG5/B,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;SAC7E,mBAAmB,EAAGD,aAAG,CAACC,UAAU,CAAC,4CAA4C,CAAC;SAClF,gBAAgB,EAAGD,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;SAC5E,sBAAsB,EAAGD,aAAG,CAACC,UAAU,CAAC,gDAAgD,CAAC;SACzF,gBAAgB,EAAGD,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;SAC5E,sBAAsB,EAAGD,aAAG,CAACC,UAAU,CAAC,gDAAgD;;MAEzF,CACD;KAED,sCAAI,iBAAe4/B,OAAO,CAAC,CAAC,CAAC;;GAG9B,yCAAO,IAAI;CACZ;CAAC,wBAEaC,OAAe,EAC7B;GACC,IAAI,sCAAI,eAAWA,OAAO,EAC1B;KACC,sCAAI,WAASA,OAAO;KACpBn2B,6BAAI,wDAAJ,IAAI;;CAEN;CAAC,uBAEY2J,IAAI,EACjB;GACC,6BAAI,IAAI,kDAAJ,IAAI,EAAqBA,IAAI,GACjC;KACC,OAAO,KAAK;;GAGb,IAAMnV,IAAI,4BAAG,IAAI,kDAAJ,IAAI,EAAqBmV,IAAI,CAAC;GAC3C,IAAI,mCAAC,IAAI,YAAU,EACnB;KACC3T,aAAG,CAAC2H,KAAK,mCAAC,IAAI,kBAAgB;;GAG/B,sCAAI,kBAAgBrG,WAAW,CAAC9C,IAAI,CAAC;CACtC;CAAC,8BAEmBmV,IAAY,EAChC;GACC,OAAO,CAAC,CAAC,sCAAI,kBAAgB5O,aAAa,2BAAmB4O,IAAI,CAACwI,EAAE,SAAK;CAC1E;CAAC,6BAqB0BtW,KAAoB,EAC/C;GACC,OAAOA,KAAK,CAAClK,GAAG,CAAC,UAACgY,IAAI;KAAA,OAAM;OAC3BmT,EAAE,EAAEnT,IAAI,CAAC,IAAI,CAAC;OACdxU,IAAI,EAAEwU,IAAI,CAAC,MAAM,CAAC;OAClBysB,IAAI,EAAEzsB,IAAI,CAAC,MAAM,CAAC;OAClB0sB,QAAQ,EAAE;MACV;IAAC,CAAC;CACJ;CAAC,0BAEe1sB,IAAI,EACpB;GACC,IAAM2sB,QAAQ,GAAG,sCAAI,kBAAgBv7B,aAAa,2BAAmB4O,IAAI,CAACwI,EAAE,SAAK;GACjF,IAAImkB,QAAQ,EACZ;KACC,sCAAI,kBAAgB36B,WAAW,CAAC26B,QAAQ,CAAC;;CAE3C;CAAC,+BAEoBR,aAAa,EAAErjC,KAAK,EACzC;GACC,IAAM8N,IAAI,GAAG,IAAI;GAEjB,IAAI,mCAAC,IAAI,UAAQ,EACjB;KACC,sCAAI,WAAWpE,yBAAM,CAACsE,gBAAgB,EAAE;;GAGzC6I,sBAAW,CAACjL,IAAI,mCACf,IAAI,YACJy3B,aAAa,EACb,IAAI,CAAC52B,OAAO,CAAC5L,GAAG,CAAC,YAAY,CAAC,CAAC3B,GAAG,CAAC,UAAC8K,KAAK;KAAA,OAAM;OAC9CrG,IAAI,EAAEwQ,cAAI,CAAC6C,MAAM,CAAChN,KAAK,CAAC0I,IAAI,CAAC;OAC7B1I,KAAK,EAALA,KAAK;OACLiN,OAAO,mBAACjX,KAAK,EAAEkX,IAAI,EACnB;SACC,IAAI,CAACxH,WAAW,CAAC5C,KAAK,EAAE;SACxBgB,IAAI,CAAC2hB,aAAa,CAACzlB,KAAK,CAAC;;MAE1B;IAAC,CAAC,EACH;KACCmN,QAAQ,EAAE,IAAI;KACd/I,UAAU,EAAE7K,aAAG,CAACoa,WAAW,CAAC0lB,aAAa,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC;KACvDhsB,KAAK,EAAE;OACN3P,QAAQ,EAAE,KAAK;OACf4P,MAAM,EAAE;;IAET,CACD;;;GAGDtX,KAAK,CAACwlB,cAAc,EAAE;CACvB;CAAC,8BAYmBtO,IAAI,EACxB;GACC,IAAM4sB,SAAS,GAAG,IAAI,CAACr3B,OAAO,CAAC5L,GAAG,CAAC,YAAY,CAAC,CAACF,IAAI,CAAC,UAAAqJ,KAAK;KAAA,OAAIA,KAAK,CAAC4I,UAAU,KAAKsE,IAAI,CAACiQ,UAAU;KAAC;GACpG,IAAMpM,KAAK,GAAG,CAAA+oB,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAEpxB,IAAI,KAAI,EAAE;GAEnC,OAAO8a,aAAG,CAACC,MAAM,kdAGCvW,IAAI,CAACwI,EAAE,EACCxI,IAAI,CAACiQ,UAAU,EAEoBpM,KAAK,EAGpDxN,6BAAI,qCAAiBxJ,IAAI,CAAC,IAAI,EAAEmT,IAAI,CAAC;CAIpD;CAAC,4BAvYWikB,YAAY,UAEV;GACb6G,IAAI,EAAE,EAAE;GACRa,IAAI,EAAE,MAAM;GACZV,IAAI,EAAE;CACP,CAAC;;;;;;;;ACXF,CACmD;CAAA;CAAA;CAAA;AAEnD,KAAa1G,YAAY;GAAA;GAAA;KAAA;KAAA;KAAA;KAAA;OAAA;;KAAA;KAAAhxB;KAAAA;KAAAA;KAAAhN;OAAA;OAAA;;KAAA;;GAAA;KAAA;KAAA,0BAKxB;OACC,sCAAI,IAAI,mBACR;SACC,sCAAI,kBAAgBsmC,QAAQ,EAAE;;;;KAE/B;KAAA,yBAEQzJ,WAAoB,EAC7B;OAAA;OACC,IAAI,CAACA,WAAW,GAAGA,WAAW,CAAC;;OAE/B,IAAM3a,QAAQ,GAAG,IAAIqc,IAAI,EAAE;OAC3Brc,QAAQ,CAAC0c,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;OAC7B1c,QAAQ,CAACqkB,OAAO,CAACrkB,QAAQ,CAAC4c,OAAO,EAAE,GAAGhvB,6BAAI,0CAAJ,IAAI,IAAqB,IAAI,CAAC;OAEpE,IAAI,CAAC+sB,WAAW,CAAC56B,KAAK,sDAAG,IAAI,CAACukC,WAAW,EApB9BxI,YAAY,yCAoB+B9b,QAAQ,CAAC;OAE/D7b,eAAK,CAACC,IAAI,CAACu2B,WAAW,EAAE,OAAO,EAAE,IAAI,CAAC4J,SAAS,CAACngC,IAAI,CAAC,IAAI,CAAC,CAAC;;;KAC3D;KAAA,4BAGD;OACC,IAAI,mCAAC,IAAI,iBAAe,EACxB;SACC,sCAAI,kBAAkB,IAAIsC,EAAE,CAAC89B,cAAc,CAAC;WAC3CC,UAAU,2BAAE,IAAI,0CAAJ,IAAI,CAAkB;WAClCriC,IAAI,EAAE,IAAI,CAACu4B,WAAW;WACtBxuB,QAAQ,EAAEyB,6BAAI,iCAAexJ,IAAI,CAAC,IAAI;UACtC,CAAC;;OAGH,sCAAI,kBAAgBsgC,IAAI,EAAE;;;GAC1B;CAAA,EArCgChJ,cAAc;CAoF/C,wBA7CcQ,IAAI,EAClB;GACC,IAAI,CAACvB,WAAW,CAAC56B,KAAK,GAAGm8B,IAAI;GAC7Bx1B,EAAE,CAACkyB,SAAS,CAAC,IAAI,CAAC+B,WAAW,EAAE,QAAQ,CAAC;GACxC,sCAAI,kBAAgByJ,QAAQ,EAAE;CAC/B;CAAC,4BAGD;GACC,gCAAO,IAAI,sDAAJ,IAAI,EAAuB,IAAI,CAACzJ,WAAW,CAAC56B,KAAK;CACzD;CAAC,gCAEqBm8B,IAAY,EAClC;GACC,IAAMyI,SAAS,GAAGzI,IAAI,CAAClgB,KAAK,CAAC,QAAQ,CAAC,CAACzc,GAAG,CAAC,UAAAqlC,IAAI;KAAA,OAAI1qB,QAAQ,CAAC0qB,IAAI,CAAC;KAAC;GAElE,4CAAuBD,SAAS;KAA3BjqB,KAAK;KAAEC,OAAO;GACnB,IAAIgqB,SAAS,CAACj7B,MAAM,KAAK,CAAC,EAC1B;KACC,IAAMgT,MAAM,GAAGioB,SAAS,CAAC,CAAC,CAAC;KAE3B,IAAIjoB,MAAM,KAAK,IAAI,IAAIhC,KAAK,GAAG,EAAE,EACjC;OACCA,KAAK,IAAI,EAAE;MACX,MACI,IAAIgC,MAAM,KAAK,IAAI,IAAIhC,KAAK,KAAK,EAAE,EACxC;OACCA,KAAK,GAAG,CAAC;;;GAIX,OAAOA,KAAK,GAAG,IAAI,GAAGC,OAAO,GAAG,EAAE;CACnC;CAAC,uBAEkBqF,QAAc,EACjC;GACC,IAAMmc,SAAS,GAAG,SAAZA,SAAS,CAAIC,QAAQ;KAAA,OAC1B11B,EAAE,CAAC+1B,IAAI,CAACH,mBAAmB,CAACr4B,aAAG,CAACC,UAAU,CAACk4B,QAAQ,CAAC,CAAC,CAAChnB,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC;IAC3E;GAED,IAAMmnB,UAAU,GAAGJ,SAAS,CAAC,aAAa,CAAC;GAC3C,IAAM0I,UAAU,GAAG1I,SAAS,CAAC,iBAAiB,CAAC,CAAC/mB,OAAO,CAACmnB,UAAU,EAAE,EAAE,CAAC,CAACpgB,IAAI,EAAE;GAE9E,OAAOzV,EAAE,CAAC+1B,IAAI,CAACpY,MAAM,CAACwgB,UAAU,EAAE7kB,QAAQ,CAAC;CAC5C;;;;;;ACtFD,CAIgD;CAAA;AAEhD,KAAa+Q,wBAAqB;GAWjC,kCAAY7Y,OAAO,EACnB;KAAA;KAAApN;KAAAA;KACC,IAAI,CAACqP,WAAW,GAAG,EAAE;KACrB,IAAI,CAAC8W,QAAQ,GAAG,IAAI;KAEpB,IAAI5zB,cAAI,CAACuC,aAAa,CAACsY,OAAO,CAAC,EAC/B;OACC,IAAI,CAAC8Y,SAAS,GAAG9Y,OAAO,CAAC8Y,SAAS;OAClC,IAAI,CAACE,aAAa,GAAGhZ,OAAO,CAACgZ,aAAa;OAE1C,IAAI7zB,cAAI,CAACU,OAAO,CAACma,OAAO,CAACiC,WAAW,CAAC,EACrC;SACC,IAAI,CAACA,WAAW,GAAGjC,OAAO,CAACiC,WAAW;;OAEvC,IAAI,CAAC8W,QAAQ,GAAG/Y,OAAO,CAAC+Y,QAAQ;OAChC,IAAI,CAACJ,SAAS,GAAG3Y,OAAO,CAAC2Y,SAAS;OAClC,IAAI,CAACM,eAAe,GAAGjZ,OAAO,CAACiZ,eAAe;;;GAE/C;KAAA;KAAA,qBAEIhL,KAAK,EACV;OACC,IAAI,CAACA,KAAK,GAAGA,KAAK;OAClB,IAAI,CAACyQ,YAAY,EAAE;OACnB,IAAI,CAACC,aAAa,EAAE;OACpB,IAAI,CAACiO,kBAAkB,EAAE;;;KACzB;KAAA,+BAGD;OACC,IAAI,IAAI,CAAC3e,KAAK,IAAI,IAAI,CAAC6K,SAAS,EAChC;SACC,IAAI,CAACA,SAAS,CAACjN,WAAW,GAAG,IAAI,CAACoC,KAAK,CAAC9B,MAAM,CAC7CpgB,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC,EAChD,IAAI,CAACiW,WAAW,CAChB;;;;KAEF;KAAA,gCAGD;OACC,IAAI,IAAI,CAAC6W,SAAS,EAClB;SACC7sB,eAAK,CAACC,IAAI,CAAC,IAAI,CAAC4sB,SAAS,EAAE,OAAO,EAAEtqB,EAAE,CAACioB,QAAQ,CAAC,IAAI,CAAC2I,YAAY,EAAE,IAAI,CAAC,CAAC;;;;KAE1E;KAAA,6BAEYj3B,KAAK,EAClB;OACC,IAAI,CAAC0kC,sBAAsB,EAAE;OAC7B1kC,KAAK,CAACwlB,cAAc,EAAE;;;KACtB;KAAA,yCAGD;OACC,IAAMM,KAAK,GAAG,IAAI,CAACA,KAAK;OACxB,IAAM6e,GAAG,GAAGj7B,MAAM,CAACsE,gBAAgB,EAAE;OAErC,IAAMhB,IAAI,GAAGzJ,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAC/BC,KAAK,EAAE;WAAEC,SAAS,EAAE;;QACpB,CAAC;OAEF,IAAMkhC,QAAQ,GAAGrhC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACpCC,KAAK,EAAE;WACNC,SAAS,EAAE,uCAAuC;WAClDgc,EAAE,EAAEilB,GAAG,GAAG,KAAK;WACfv8B,IAAI,EAAE,OAAO;WACb1I,KAAK,EAAE,KAAK;WACZD,IAAI,EAAE;;QAEP,CAAC;OACF,IAAIqmB,KAAK,CAAC3L,KAAK,EAAE,EACjB;SACCyqB,QAAQ,CAACjhB,YAAY,CAAC,SAAS,EAAE,SAAS,CAAC;;OAG5C,IAAMkhB,QAAQ,GAAGthC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACpCC,KAAK,EAAE;WACNC,SAAS,EAAE,yCAAyC;WACpD,OAAKihC,GAAG,GAAG;UACX;SACDngC,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WAClBC,KAAK,EAAE;aAACC,SAAS,EAAE;YAA0C;WAC7DC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,IAAI,CAACgtB,aAAa,GAAG,kCAAkC,GAAG,kCAAkC;UACjH,CAAC;QAEH,CAAC;OAEF,IAAMiU,gBAAgB,GAAGvhC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAC3CC,KAAK,EAAE;WACNC,SAAS,EAAE,qEAAqE;WAChF,WAAW,EAAEE,aAAG,CAACC,UAAU,CAAC,IAAI,CAACgtB,aAAa,GAAG,yCAAyC,GAAG,uCAAuC;;QAErI,CAAC;OACFgU,QAAQ,CAAChgC,WAAW,CAACigC,gBAAgB,CAAC;OAEtC93B,IAAI,CAACnI,WAAW,CAACtB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAClCC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAwC;SAC5Dc,QAAQ,EAAE,CAACogC,QAAQ,EAAEC,QAAQ;QAC7B,CAAC,CAAC;OAEH73B,IAAI,CAACnI,WAAW,CAAC,IAAI,CAACkgC,sBAAsB,EAAE,CAAC;OAE/C,IAAI,IAAI,CAACjrB,WAAW,CAACzQ,MAAM,GAAG,CAAC,EAC/B;SACC2D,IAAI,CAACnI,WAAW,CAAC,IAAI,CAACmgC,uBAAuB,EAAE,CAAC;SAChDh4B,IAAI,CAACnI,WAAW,CAAC,IAAI,CAACogC,mBAAmB,EAAE,CAAC;;OAG7C,IAAMC,aAAa,GAAG3hC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACzCC,KAAK,EAAE;WACN2E,IAAI,EAAE,UAAU;WAChBsX,EAAE,EAAEilB,GAAG,GAAG,UAAU;WACpBllC,IAAI,EAAE,UAAU;WAChBC,KAAK,EAAE,GAAG;WACV+H,KAAK,EAAE;UACP;SACDrH,KAAK,EAAE;WACNoQ,OAAO,EAAEsV,KAAK,CAACtM;;QAEhB,CAAC;OAEF,IAAM2rB,gBAAgB,GAAG5hC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAC3CC,KAAK,EAAE;WACNC,SAAS,EAAE,qEAAqE;WAChF,WAAW,EAAEE,aAAG,CAACC,UAAU,CAAC,yCAAyC;;QAEtE,CAAC;OAEFmJ,IAAI,CAACnI,WAAW,CAACtB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAClCC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAA2C;SAC/Dc,QAAQ,EAAE,CACT0gC,aAAa,EACb3hC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;WACnBC,KAAK,EAAE;aACNC,SAAS,EAAE,uCAAuC;aAClD,OAAKihC,GAAG,GAAG;YACX;WACDhhC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,6CAA6C;UAClE,CAAC,EACFshC,gBAAgB;QAEjB,CAAC,CAAC;OAEH,IAAI,IAAI,CAACrU,eAAe,EACxB;SACC9jB,IAAI,CAACnI,WAAW,0BAAC,IAAI,wDAAJ,IAAI,EAA0B;;OAGhD,IAAMiJ,IAAI,GAAG,IAAI;;OAEjBzH,EAAE,CAAC4L,EAAE,CAACC,IAAI,CAACtM,IAAI,CAACoH,IAAI,CAAC;OACrB,IAAMH,KAAK,GAAG,IAAIxG,EAAE,CAAC0H,WAAW,CAACrE,MAAM,CAACsE,gBAAgB,EAAE,EAAE,IAAI,CAAC2iB,SAAS,EAAE;SAC3ExZ,QAAQ,EAAE,IAAI;SACd7I,UAAU,EAAE,IAAI;SAChBH,SAAS,EAAE,KAAK;SAChBF,QAAQ,EAAE,KAAK;SACfoJ,KAAK,EAAE,IAAI;SACXjJ,UAAU,EAAE,EAAE;SACdF,OAAO,EAAElB,IAAI;SACb6B,OAAO,EAAE,CACR,IAAIxI,EAAE,CAACyI,iBAAiB,CAAC;WACxBnL,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,+BAA+B,CAAC;WACrDH,SAAS,EAAE,qEAAqE;WAChFyJ,MAAM,EAAE;aACPC,KAAK,mBACL;eACCU,IAAI,CAACs3B,YAAY,CAAC,IAAIC,QAAQ,CAACr4B,IAAI,CAAC,CAAC;eACrC,IAAI,CAAC0C,WAAW,CAAC5C,KAAK,EAAE;;;UAE1B,CAAC,CACF;SACDK,MAAM,EAAE;WACPuB,YAAY,0BACZ;aACC,IAAIZ,IAAI,CAACw3B,UAAU,EACnB;eACCx3B,IAAI,CAACw3B,UAAU,CAAC51B,WAAW,CAAC5C,KAAK,EAAE;;aAEpC,IAAIgB,IAAI,CAACy3B,aAAa,EACtB;eACCz3B,IAAI,CAACy3B,aAAa,CAAC71B,WAAW,CAAC5C,KAAK,EAAE;;aAEvC,IAAI,CAAC8B,OAAO,EAAE;;UAEf;SACDH,OAAO,EAAE;WAAEspB,eAAe,EAAE;;QAC5B,CAAC;OAEFlrB,KAAK,CAACjB,IAAI,EAAE;;;KACZ;KAAA,6BAEYmD,QAAkB,EAC/B;OACC,IAAM3G,IAAI,GAAG2G,QAAQ,CAAClO,GAAG,CAAC,MAAM,CAAC;OAEjC,IAAIuH,IAAI,KAAK,KAAK,EAClB;SACC,IAAI,CAAC0d,KAAK,CAAC0f,MAAM,EAAE;QACnB,MACI,IAAIp9B,IAAI,KAAKqQ,aAAa,CAACI,UAAU,CAACe,EAAE,EAC7C;SACC,IAAI,CAACkM,KAAK,CAAC/M,OAAO,CAACN,aAAa,CAACI,UAAU,CAACe,EAAE,CAAC;SAC/C,IAAI,CAACkM,KAAK,CAAC9M,QAAQ,CAAC,CAAC,CAAC;SACtB,IAAI,CAAC8M,KAAK,CAAC7M,YAAY,CAAC,GAAG,CAAC;SAC5B,IAAI,CAAC6M,KAAK,CAAC5M,QAAQ,CAACnK,QAAQ,CAAClO,GAAG,CAAC,UAAU,CAAC,CAAC;SAC7C,IAAI,CAACilB,KAAK,CAACzM,SAAS,CAACtK,QAAQ,CAAClO,GAAG,CAAC,eAAe,CAAC,GAAGkO,QAAQ,CAAClO,GAAG,CAAC,eAAe,CAAC,CAAC8a,KAAK,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;QACrG,MAED;SACC,IAAI,CAACmK,KAAK,CAAC/M,OAAO,CAAC3Q,IAAI,CAAC;SACxB,IAAI,CAAC0d,KAAK,CAAC9M,QAAQ,CAACjK,QAAQ,CAAClO,GAAG,CAAC,QAAQ,GAAGuH,IAAI,CAAC,CAAC;SAClD,IAAI,CAAC0d,KAAK,CAAC7M,YAAY,CAAClK,QAAQ,CAAClO,GAAG,CAAC,aAAa,GAAGuH,IAAI,CAAC,CAAC;SAE3D,IAAIA,IAAI,KAAKqQ,aAAa,CAACI,UAAU,CAACC,KAAK,EAC3C;WACC,IAAI,IAAI,CAAC+X,aAAa,EACtB;aACC,IAAI,CAAC/K,KAAK,CAAC5M,QAAQ,CAACnK,QAAQ,CAAClO,GAAG,CAAC,aAAa,CAAC,CAAC;YAChD,MAED;aACC,IAAI,CAACilB,KAAK,CAAC5M,QAAQ,CAACT,aAAa,CAACE,UAAU,CAACC,eAAe,CAAC;;WAE9D,IACC,IAAI,CAAC4X,SAAS,GAAG,CAAC,IACf,IAAI,CAAC1K,KAAK,CAACvM,KAAK,KAAKd,aAAa,CAACE,UAAU,CAACC,eAAe,IAC7D,IAAI,CAACkN,KAAK,CAACxM,SAAS,KAAK,GAAG,IAC5B,IAAI,CAACwM,KAAK,CAACpmB,KAAK,GAAG,IAAI,CAAC8wB,SAAS,EAErC;aACCnqB,EAAE,CAAC4L,EAAE,CAACwzB,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;eAChCz3B,OAAO,EAAEtK,aAAG,CAACC,UAAU,CAAC,0CAA0C;cAClE,CAAC;aACF,IAAI,CAACiiB,KAAK,CAAC9M,QAAQ,CAAC,IAAI,CAACwX,SAAS,CAAC;;UAEpC,MAED;WACC,IAAI,CAAC1K,KAAK,CAAC5M,QAAQ,CAACnK,QAAQ,CAAClO,GAAG,CAAC,cAAc,CAAC,CAAC;;;OAInD,IAAI,CAACilB,KAAK,CAAC3M,WAAW,CAACpK,QAAQ,CAAClO,GAAG,CAAC,UAAU,CAAC,CAAC;OAChD,IAAI,CAACilB,KAAK,CAAC1M,cAAc,CAACrK,QAAQ,CAAClO,GAAG,CAAC,cAAc,CAAC,CAAC;OACvD,IAAI,CAAC01B,YAAY,EAAE;OAEnB,IAAI,IAAI,CAAC3F,QAAQ,EACjB;SACC,IAAI,CAACA,QAAQ,CAAC,IAAI,CAAC9K,KAAK,CAAC;;;;KAE1B;KAAA,yCAGD;OACC,IAAMA,KAAK,GAAG,IAAI,CAACA,KAAK;OACxB,IAAM6e,GAAG,GAAGj7B,MAAM,CAACsE,gBAAgB,EAAE;OAErC,IAAM43B,UAAU,GAAGriC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACtCC,KAAK,EAAE;WACNC,SAAS,EAAE,uCAAuC;WAClDgc,EAAE,EAAEilB,GAAG;WACPv8B,IAAI,EAAE,OAAO;WACb1I,KAAK,EAAE+Y,aAAa,CAACI,UAAU,CAACC,KAAK;WACrCrZ,IAAI,EAAE;;QAEP,CAAC;OACF,IAAIqmB,KAAK,CAAC1d,IAAI,KAAKqQ,aAAa,CAACI,UAAU,CAACC,KAAK,IAAIgN,KAAK,CAACpmB,KAAK,GAAG,CAAC,EACpE;SACCkmC,UAAU,CAACjiB,YAAY,CAAC,SAAS,EAAE,SAAS,CAAC;;OAG9C,IAAMsS,SAAS,GAAG1yB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACrCC,KAAK,EAAE;WACN2E,IAAI,EAAE,MAAM;WACZ3I,IAAI,EAAE,aAAa;WAEnBiE,SAAS,EAAE;UACX;SACDtD,KAAK,EAAE;WACNV,KAAK,EAAEomB,KAAK,CAAC1d,IAAI,KAAKqQ,aAAa,CAACI,UAAU,CAACC,KAAK,IAAIgN,KAAK,CAACpmB,KAAK,GAAGomB,KAAK,CAACpmB,KAAK,GAAI,IAAI,CAAC8wB,SAAS,IAAI;;QAExG,CAAC;OAEF,IAAMqV,UAAU,GAAGtiC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACtCC,KAAK,EAAE;WACNC,SAAS,EAAE,yCAAyC;WACpD,OAAKihC;UACL;SACDngC,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WAClBC,KAAK,EAAE;aAACC,SAAS,EAAE;YAA0C;WAC7DC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,kCAAkC;UACvD,CAAC,EACFoyB,SAAS,EACT,IAAI,CAAC6P,uBAAuB,CAAC,kBAAkB,CAAC;QAEjD,CAAC;OAEF,IAAI,IAAI,CAACjV,aAAa,EACtB;SACCgV,UAAU,CAAChhC,WAAW,CAACtB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WACzCC,KAAK,EAAE;aAACC,SAAS,EAAE;YAA6F;WAChHC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,8BAA8B;UACnD,CAAC,CAAC;SAEH,IAAIkiC,UAAU,GAAG,IAAI,CAACC,aAAa,CAAClgB,KAAK,CAACvM,KAAK,EAAE,IAAI,CAAC;SACtD,IAAI0sB,UAAU,GAAGngB,KAAK,CAACvM,KAAK;SAC5B,IAAI,CAACwsB,UAAU,EACf;WACCA,UAAU,GAAG,IAAI,CAACC,aAAa,CAACvtB,aAAa,CAACE,UAAU,CAACC,eAAe,EAAE,IAAI,CAAC;WAC/EqtB,UAAU,GAAGF,UAAU,CAAClzB,gBAAgB;;SAGzC,IAAMqzB,oBAAoB,GAAG3iC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;WAChDC,KAAK,EAAE;aACN2E,IAAI,EAAE,QAAQ;aACd3I,IAAI,EAAE,aAAa;aACnBC,KAAK,EAAEumC;;UAER,CAAC;SAEF,IAAMn4B,IAAI,GAAG,IAAI;SACjB,IAAMq4B,eAAe,GAAG5iC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WAC1CC,KAAK,EAAE;aACNC,SAAS,EAAE;YACX;WACDC,IAAI,EAAEoiC,UAAU,GAAGA,UAAU,CAACrzB,IAAI,GAAG9O,aAAG,CAACC,UAAU,CAAC,0CAA0C,CAAC;WAC/FsJ,MAAM,EAAE;aACPC,KAAK,iBAACpN,KAAK,EACX;eACC8N,IAAI,CAACs4B,YAAY,CAACpmC,KAAK,EAAE,IAAI,EAAE,UAASgK,KAAK,EAC7C;iBACCm8B,eAAe,CAACziB,WAAW,GAAG1Z,KAAK,CAAC0I,IAAI;iBACxCwzB,oBAAoB,CAACxmC,KAAK,GAAGsK,KAAK,CAAC6I,gBAAgB;gBACnD,EAAE4F,aAAa,CAACI,UAAU,CAACC,KAAK,CAAC;;;UAGpC,CAAC;SACF+sB,UAAU,CAAChhC,WAAW,CAACqhC,oBAAoB,CAAC;SAC5CL,UAAU,CAAChhC,WAAW,CAACshC,eAAe,CAAC;;OAGxC,IAAI,CAAC,IAAI,CAACtV,aAAa,EACvB;SACC,IAAMwV,aAAa,GAAG9iC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WACxCC,KAAK,EAAE;aACNC,SAAS,EAAE,qEAAqE;aAChF,WAAW,EAAEE,aAAG,CAACC,UAAU,CAAC,yCAAyC;;UAEtE,CAAC;SACFgiC,UAAU,CAAChhC,WAAW,CAACwhC,aAAa,CAAC;;OAGtC,OAAO9iC,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACxBC,KAAK,EAAE;WAAEC,SAAS,EAAE;UAAwC;SAC5Dc,QAAQ,EAAE,CAACohC,UAAU,EAAEC,UAAU;QACjC,CAAC;;;KACF;KAAA,0CAGD;OACC,IAAM/f,KAAK,GAAG,IAAI,CAACA,KAAK;OACxB,IAAM6e,GAAG,GAAGj7B,MAAM,CAACsE,gBAAgB,EAAE;OAErC,IAAMs4B,WAAW,GAAG/iC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACvCC,KAAK,EAAE;WACNC,SAAS,EAAE,uCAAuC;WAClDgc,EAAE,EAAEilB,GAAG;WACPv8B,IAAI,EAAE,OAAO;WACb1I,KAAK,EAAE+Y,aAAa,CAACI,UAAU,CAACc,MAAM;WACtCla,IAAI,EAAE;;QAEP,CAAC;OAEF,IAAIqmB,KAAK,CAAC1d,IAAI,KAAKqQ,aAAa,CAACI,UAAU,CAACc,MAAM,EAClD;SACC2sB,WAAW,CAAC3iB,YAAY,CAAC,SAAS,EAAE,SAAS,CAAC;;OAG/C,IAAMsS,SAAS,GAAG1yB,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACrCC,KAAK,EAAE;WACN2E,IAAI,EAAE,MAAM;WACZ3I,IAAI,EAAE,cAAc;WAEpBiE,SAAS,EAAE;UACX;SACDtD,KAAK,EAAE;WACNV,KAAK,EAAEomB,KAAK,CAAC1d,IAAI,KAAKqQ,aAAa,CAACI,UAAU,CAACc,MAAM,IAAImM,KAAK,CAACpmB,KAAK,GAAGomB,KAAK,CAACpmB,KAAK,GAAI,IAAI,CAAC8wB,SAAS,IAAI;;QAEzG,CAAC;OAEF,IAAM+V,WAAW,GAAGhjC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACvCC,KAAK,EAAE;WACNC,SAAS,EAAE,yCAAyC;WACpD,OAAKihC;UACL;SACDngC,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WAClBC,KAAK,EAAE;aAACC,SAAS,EAAE;YAA0C;WAC7DC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,mCAAmC;UACxD,CAAC,EACFoyB,SAAS,EACT,IAAI,CAAC6P,uBAAuB,CAAC,mBAAmB,CAAC,EACjDviC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WAClBC,KAAK,EAAE;aAACC,SAAS,EAAE;YAA6F;WAChHC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,iCAAiC;UACtD,CAAC;QAEH,CAAC;OAEF,IAAIkiC,UAAU,GAAG,IAAI,CAACC,aAAa,CAAClgB,KAAK,CAACvM,KAAK,CAAC;OAChD,IAAI0sB,UAAU,GAAGngB,KAAK,CAACvM,KAAK;OAC5B,IAAI,CAACwsB,UAAU,EACf;SACCA,UAAU,GAAG,IAAI,CAACjsB,WAAW,CAAC,CAAC,CAAC;SAChCmsB,UAAU,GAAGF,UAAU,CAAClzB,gBAAgB;;OAGzC,IAAMqzB,oBAAoB,GAAG3iC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SAChDC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd3I,IAAI,EAAE,cAAc;WACpBC,KAAK,EAAEumC;;QAER,CAAC;OAEF,IAAMn4B,IAAI,GAAG,IAAI;OACjB,IAAMq4B,eAAe,GAAG5iC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAC1CC,KAAK,EAAE;WACNC,SAAS,EAAE;UACX;SACDC,IAAI,EAAEoiC,UAAU,GAAGA,UAAU,CAACrzB,IAAI,GAAG9O,aAAG,CAACC,UAAU,CAAC,0CAA0C,CAAC;SAC/FsJ,MAAM,EAAE;WACPC,KAAK,iBAACpN,KAAK,EACX;aACC8N,IAAI,CAACs4B,YAAY,CAChBpmC,KAAK,EACL,IAAI,EACJ,UAACgK,KAAK,EAAK;eACVm8B,eAAe,CAACziB,WAAW,GAAG1Z,KAAK,CAAC0I,IAAI;eACxCwzB,oBAAoB,CAACxmC,KAAK,GAAGsK,KAAK,CAAC6I,gBAAgB;cACnD,EACD4F,aAAa,CAACI,UAAU,CAACc,MAAM,CAC/B;;;QAGH,CAAC;OACF4sB,WAAW,CAAC1hC,WAAW,CAACqhC,oBAAoB,CAAC;OAC7CK,WAAW,CAAC1hC,WAAW,CAACshC,eAAe,CAAC;OAExC,IAAI,CAAC,IAAI,CAACtV,aAAa,EACvB;SACC,IAAM2V,cAAc,GAAGjjC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WACzCC,KAAK,EAAE;aACNC,SAAS,EAAE,qEAAqE;aAChF,WAAW,EAAEE,aAAG,CAACC,UAAU,CAAC,0CAA0C;;UAEvE,CAAC;SACF0iC,WAAW,CAAC1hC,WAAW,CAAC2hC,cAAc,CAAC;;OAGxC,OAAOjjC,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACxBC,KAAK,EAAE;WAACC,SAAS,EAAE;UAAuC;SAC1Dc,QAAQ,EAAE,CAAC8hC,WAAW,EAAEC,WAAW;QACnC,CAAC;;;KACF;KAAA,sCAGD;OACC,IAAMzgB,KAAK,GAAG,IAAI,CAACA,KAAK;OACxB,IAAM6e,GAAG,GAAGj7B,MAAM,CAACsE,gBAAgB,EAAE;OAErC,IAAMy4B,OAAO,GAAGljC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACnCC,KAAK,EAAE;WACNC,SAAS,EAAE,uCAAuC;WAClDgc,EAAE,EAAEilB,GAAG;WACPv8B,IAAI,EAAE,OAAO;WACb1I,KAAK,EAAE+Y,aAAa,CAACI,UAAU,CAACe,EAAE;WAClCna,IAAI,EAAE;;QAEP,CAAC;OAEF,IAAIqmB,KAAK,CAAC1d,IAAI,KAAKqQ,aAAa,CAACI,UAAU,CAACe,EAAE,EAC9C;SACC6sB,OAAO,CAAC9iB,YAAY,CAAC,SAAS,EAAE,SAAS,CAAC;;OAG3C,IAAM+iB,OAAO,GAAGnjC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACnCC,KAAK,EAAE;WACNC,SAAS,EAAE,yCAAyC;WACpD,OAAKihC;UACL;SACDngC,QAAQ,EAAE,CACTjB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WAClBC,KAAK,EAAE;aAACC,SAAS,EAAE;YAA0C;WAC7DC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,kCAAkC;UACvD,CAAC;QAEH,CAAC;OAEF,IAAIkiC,UAAU,GAAG,IAAI,CAACC,aAAa,CAAClgB,KAAK,CAACvM,KAAK,EAAE,IAAI,CAAC;OACtD,IAAI0sB,UAAU,GAAGngB,KAAK,CAACvM,KAAK;OAC5B,IAAI,CAACwsB,UAAU,EACf;SACCA,UAAU,GAAG,IAAI,CAACjsB,WAAW,CAAC,CAAC,CAAC;SAChCmsB,UAAU,GAAGF,UAAU,CAAClzB,gBAAgB;;OAGzC,IAAM8zB,gBAAgB,GAAGpjC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SAC5CC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd3I,IAAI,EAAE,UAAU;WAChBC,KAAK,EAAEumC;;QAER,CAAC;OAEF,IAAMn4B,IAAI,GAAG,IAAI;OACjB,IAAM84B,WAAW,GAAGrjC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SACtCC,KAAK,EAAE;WACNC,SAAS,EAAE;UACX;SACDC,IAAI,EAAEoiC,UAAU,GAAGA,UAAU,CAACrzB,IAAI,GAAG9O,aAAG,CAACC,UAAU,CAAC,0CAA0C,CAAC;SAC/FsJ,MAAM,EAAE;WACPC,KAAK,iBAACpN,KAAK,EACX;aACC8N,IAAI,CAACs4B,YAAY,CAChBpmC,KAAK,EACL,IAAI,EACJ,UAAAgK,KAAK,EAAI;eACR48B,WAAW,CAACljB,WAAW,GAAG1Z,KAAK,CAAC0I,IAAI;eACpCi0B,gBAAgB,CAACjnC,KAAK,GAAGsK,KAAK,CAAC6I,gBAAgB;cAC/C,EACD4F,aAAa,CAACI,UAAU,CAACe,EAAE,CAC3B;;;QAGH,CAAC;OACF8sB,OAAO,CAAC7hC,WAAW,CAAC8hC,gBAAgB,CAAC;OACrCD,OAAO,CAAC7hC,WAAW,CAAC+hC,WAAW,CAAC;OAChC,IAAI,CAAC,IAAI,CAAC/V,aAAa,EACvB;SACC,IAAMgW,QAAQ,GAAGtjC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WACnCC,KAAK,EAAE;aACNC,SAAS,EAAE,qEAAqE;aAChF,WAAW,EAAEE,aAAG,CAACC,UAAU,CAAC,sCAAsC;;UAEnE,CAAC;SACF6iC,OAAO,CAAC7hC,WAAW,CAACgiC,QAAQ,CAAC;;OAG9B,IAAMntB,MAAM,GAAG8T,aAAG,CAACC,MAAM,uMAEY3H,KAAK,CAACnL,YAAY,CAEtD;;;;OAID,OAAOpX,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACxBC,KAAK,EAAE;WAACC,SAAS,EAAE;UAAuC;SAC1Dc,QAAQ,EAAE,CAACiiC,OAAO,EAAEC,OAAO;QAC3B,CAAC;;;KACF;KAAA,wCAEuBjnC,IAAI,EAC5B;OACC,IAAMqmB,KAAK,GAAG,IAAI,CAACA,KAAK;OACxB,IAAMghB,UAAU,GAAG;SAClBj9B,CAAC,EAAEjG,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC;SACtD0X,CAAC,EAAE3X,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC;SACtD2X,CAAC,EAAE5X,aAAG,CAACC,UAAU,CAAC,mCAAmC;QACrD;OAED,IAAMkX,KAAK,GAAGxX,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACjCC,KAAK,EAAE;WAACC,SAAS,EAAE;UAAyC;SAC5DC,IAAI,EAAEmjC,UAAU,CAAChhB,KAAK,CAACxM,SAAS;QAChC,CAAC;OAEF,IAAM4e,KAAK,GAAG30B,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACjCC,KAAK,EAAE;WACN2E,IAAI,EAAE,QAAQ;WACd3I,IAAI,EAAEA;UACN;SACDW,KAAK,EAAE;WACNV,KAAK,EAAEomB,KAAK,CAACxM;;QAEd,CAAC;OAEFxV,eAAK,CAACC,IAAI,CAACgX,KAAK,EAAE,OAAO,EAAE,IAAI,CAACgsB,wBAAwB,CAAChjC,IAAI,CAAC,IAAI,EAAEgX,KAAK,EAAEmd,KAAK,CAAC,CAAC;OAElF,OAAO30B,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SACzBgB,QAAQ,EAAE,CAACuW,KAAK,EAAEmd,KAAK;QACvB,CAAC;;;KACF;KAAA,yCAEwBnd,KAAK,EAAEmd,KAAK,EACrC;OACC,IAAMyM,GAAG,GAAGj7B,MAAM,CAACsE,gBAAgB,EAAE;OAErC,IAAM+yB,OAAO,GAAG,SAAVA,OAAO,CAAY/gC,KAAK,EAAEkX,IAAI,EACpC;SACC,IAAI,CAACxH,WAAW,CAAC5C,KAAK,EAAE;SACxBorB,KAAK,CAACx4B,KAAK,GAAGwX,IAAI,CAAC8vB,OAAO;SAC1BjsB,KAAK,CAAC2I,WAAW,GAAGxM,IAAI,CAACvT,IAAI;QAC7B;OAED,IAAMoT,SAAS,GAAG,CACjB;SACCpT,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC;SACzDmjC,OAAO,EAAE,GAAG;SACZ/vB,OAAO,EAAE8pB;QACT,EACD;SACCp9B,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC;SACzDmjC,OAAO,EAAE,GAAG;SACZ/vB,OAAO,EAAE8pB;QACT,EACD;SACCp9B,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC;SACzDmjC,OAAO,EAAE,GAAG;SACZ/vB,OAAO,EAAE8pB;QACT,CACD;OAEDlqB,sBAAW,CAACjL,IAAI,CACf+4B,GAAG,EACH5pB,KAAK,EACLhE,SAAS,EACT;SACCI,QAAQ,EAAE,IAAI;SACd/I,UAAU,EAAE,EAAE;SACdiJ,KAAK,EAAE;WAAE3P,QAAQ,EAAE;UAAM;SACzByF,MAAM,EAAE;WACPuB,YAAY,0BACZ;aACC,IAAI,CAACE,OAAO,EAAE;;UAEf;SACDH,OAAO,EAAE;WAAEspB,eAAe,EAAE;;QAC5B,CACD;OAED,IAAI,CAACwN,aAAa,GAAG1uB,sBAAW,CAACwnB,WAAW;;;KAC5C;KAAA,6BAEYr+B,KAAK,EAAE2wB,SAAS,EAAE7kB,QAAQ,EAAEm7B,SAAS,EAClD;OACC,IAAMlwB,SAAS,GAAG,EAAE;OAEpB,IAAIkwB,SAAS,KAAKxuB,aAAa,CAACI,UAAU,CAACC,KAAK,IAAImuB,SAAS,KAAKxuB,aAAa,CAACI,UAAU,CAACe,EAAE,EAC7F;SACC7C,SAAS,CAACjZ,IAAI,CACb;WACC6F,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,kCAAkC,CAAC;WACxDmG,KAAK,EAAE;aACN0I,IAAI,EAAE9O,aAAG,CAACC,UAAU,CAAC,kCAAkC,CAAC;aACxDgP,gBAAgB,EAAE4F,aAAa,CAACE,UAAU,CAACC;YAC3C;WACD3B,OAAO,mBAACjX,KAAK,EAAEkX,IAAI,EACnB;aACC,IAAIpL,QAAQ,EACZ;eACCA,QAAQ,CAACoL,IAAI,CAAClN,KAAK,CAAC;;aAGrB,IAAI,CAAC0F,WAAW,CAAC5C,KAAK,EAAE;;UAEzB,EACD;WACCnJ,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC;WACzDmG,KAAK,EAAE;aACN0I,IAAI,EAAE9O,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC;aACzDgP,gBAAgB,EAAE4F,aAAa,CAACE,UAAU,CAACqB;YAC3C;WACD/C,OAAO,mBAACjX,KAAK,EAAEkX,IAAI,EACnB;aACC,IAAIpL,QAAQ,EACZ;eACCA,QAAQ,CAACoL,IAAI,CAAClN,KAAK,CAAC;;aAGrB,IAAI,CAAC0F,WAAW,CAAC5C,KAAK,EAAE;;UAEzB,EACD;WACCo6B,SAAS,EAAE;UACX,CACD;;OAGF,KAAK,IAAIr9B,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACiQ,WAAW,CAACzQ,MAAM,EAAE,EAAEQ,CAAC,EAChD;SACC,IACCo9B,SAAS,KAAKxuB,aAAa,CAACI,UAAU,CAACC,KAAK,IACzC,IAAI,CAACgB,WAAW,CAACjQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC3D,OAAO,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,EAEzD;WACC;;SAGD6Q,SAAS,CAACjZ,IAAI,CAAC;WACd6F,IAAI,EAAEwQ,cAAI,CAAC6C,MAAM,CAAC,IAAI,CAAC8C,WAAW,CAACjQ,CAAC,CAAC,CAAC6I,IAAI,CAAC;WAC3C1I,KAAK,EAAE,IAAI,CAAC8P,WAAW,CAACjQ,CAAC,CAAC;WAC1BoN,OAAO,mBAACsO,CAAC,EAAErO,IAAI,EACf;aACC,IAAIpL,QAAQ,EACZ;eACCA,QAAQ,CAACoL,IAAI,CAAClN,KAAK,IAAIkN,IAAI,CAACW,OAAO,CAAC7N,KAAK,CAAC;;aAG3C,IAAI,CAAC0F,WAAW,CAAC5C,KAAK,EAAE;;UAEzB,CAAC;;OAGH,IAAIsJ,MAAM,GAAGua,SAAS,CAACtoB,YAAY,CAAC,cAAc,CAAC;OACnD,IAAI,CAAC+N,MAAM,EACX;SACCA,MAAM,GAAG1M,MAAM,CAACsE,gBAAgB,EAAE;SAClC2iB,SAAS,CAAChN,YAAY,CAAC,cAAc,EAAEvN,MAAM,CAAC;;OAG/CS,sBAAW,CAACjL,IAAI,CACfwK,MAAM,EACNua,SAAS,EACT5Z,SAAS,EACT;SACCI,QAAQ,EAAE,IAAI;SACd/I,UAAU,EAAG/H,EAAE,CAAC+Q,GAAG,CAACuZ,SAAS,CAAC,CAAC,OAAO,CAAC,GAAG,CAAE;SAC5CtZ,KAAK,EAAE;WAAE3P,QAAQ,EAAE,KAAK;WAAE4P,MAAM,EAAE;UAAG;SACrC7I,OAAO,EAAE;WAAEspB,eAAe,EAAE;;QAC5B,CACD;OAED,IAAI,CAACuN,UAAU,GAAGzuB,sBAAW,CAACwnB,WAAW;;;KACzC;KAAA,8BAEa9kB,KAAK,EAAE4tB,MAAM,EAC3B;OACC,IAAIA,MAAM,KAAK5tB,KAAK,KAAKd,aAAa,CAACE,UAAU,CAACC,eAAe,IAAIW,KAAK,KAAKd,aAAa,CAACE,UAAU,CAACwC,oBAAoB,CAAC,EAC7H;SACC,OAAO;WACNzI,IAAI,EAAE9O,aAAG,CAACC,UAAU,CAAC,kCAAkC,CAAC;WACxDgP,gBAAgB,EAAE4F,aAAa,CAACE,UAAU,CAACC;UAC3C;;OAEF,IAAIuuB,MAAM,IAAI5tB,KAAK,KAAKd,aAAa,CAACE,UAAU,CAACqB,WAAW,EAC5D;SACC,OAAO;WACNtH,IAAI,EAAE9O,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC;WACzDgP,gBAAgB,EAAE4F,aAAa,CAACE,UAAU,CAACqB;UAC3C;;OAGF,IAAIhQ,KAAK,GAAG,IAAI;OAChB,KAAK,IAAIH,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACiQ,WAAW,CAACzQ,MAAM,EAAE,EAAEQ,CAAC,EAChD;SACC,IAAI0P,KAAK,KAAK,IAAI,CAACO,WAAW,CAACjQ,CAAC,CAAC,CAACgJ,gBAAgB,EAClD;WACC7I,KAAK,GAAG,IAAI,CAAC8P,WAAW,CAACjQ,CAAC,CAAC;;;OAI7B,OAAOG,KAAK;;;KACZ;KAAA,qCAGD;OACC,IAAMD,MAAM,GAAG,EAAE;OACjB,KAAK,IAAIF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACiQ,WAAW,CAACzQ,MAAM,EAAE,EAAEQ,CAAC,EAChD;SACC,IAAM8N,GAAG,GAAG,IAAI,CAACmC,WAAW,CAACjQ,CAAC,CAAC;SAC/B,IACC8N,GAAG,CAAC,IAAI,CAAC,CAACzR,OAAO,CAAC,aAAa,CAAC,GAAG,CAAC,IACjCyR,GAAG,CAAC,IAAI,CAAC,CAACzR,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC,IACnCyR,GAAG,CAAC,IAAI,CAAC,CAACzR,OAAO,CAAC,WAAW,CAAC,GAAG,CAAC,EAEtC;WACC6D,MAAM,CAACjM,IAAI,CAAC6Z,GAAG,CAAC;;;OAIlB,IAAI,CAACmC,WAAW,GAAG/P,MAAM;;;GACzB;CAAA;CAqED,mCAlEA;GACC,IAAM+b,KAAK,GAAG,IAAI,CAACA,KAAK;GACxB,IAAM6e,GAAG,GAAGj7B,MAAM,CAACsE,gBAAgB,EAAE;GACrC,IAAMo5B,WAAW,4BAAG,IAAI,oDAAJ,IAAI,CAAuB;GAE/C,IAAMC,YAAY,GAAG9jC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;KACxCC,KAAK,EAAE;OACN2E,IAAI,EAAE,UAAU;OAChBsX,EAAE,EAAEilB,GAAG,GAAG,cAAc;OACxBllC,IAAI,EAAE,cAAc;OACpBC,KAAK,EAAE,GAAG;OACV+H,KAAK,EAAE;MACP;KACDrH,KAAK,EAAE;OACNoQ,OAAO,EAAEsV,KAAK,CAACrM,WAAW,IAAI2tB;;IAE/B,CAAC;GAEF,IAAI,CAACA,WAAW,EAChB;KACCC,YAAY,CAACjJ,QAAQ,GAAG,IAAI;;GAG7B,IAAMkJ,eAAe,GAAG/jC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;KAC1CC,KAAK,EAAE;OACNC,SAAS,EAAE,qEAAqE;OAChF,WAAW,EAAEE,aAAG,CAACC,UAAU,CAAC,6CAA6C;;IAE1E,CAAC;GAEF,IAAMsJ,MAAM,GAAG,EAAE;GAEjB,IAAI,CAACi6B,WAAW,EAChB;KACCj6B,MAAM,CAACC,KAAK,GAAG,YAAM;OACpB,IAAInF,GAAG,CAAC5B,EAAE,CAAC4L,EAAE,IAAIhK,GAAG,CAAC5B,EAAE,CAAC4L,EAAE,CAAC0Z,UAAU,EACrC;SACC1jB,GAAG,CAAC5B,EAAE,CAAC4L,EAAE,CAAC0Z,UAAU,CAAC/f,IAAI,CAAC,mCAAmC,CAAC;;MAE/D;;GAGF,OAAOrI,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;KACxBC,KAAK,EAAE;OAAEC,SAAS,EAAE;MAAwC;KAC5Dc,QAAQ,EAAE,CAAEjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;OAC7BC,KAAK,EAAE;SAAEC,SAAS,EAAE;QAA2C;OAC/Dc,QAAQ,EAAE,CACT6iC,YAAY,EACZ9jC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;SACnBC,KAAK,EAAE;WACNC,SAAS,kDAA2C,CAAC0jC,WAAW,GAAE,yCAAyC,GAAG,EAAE,CAAE;WAClH,OAAKzC,GAAG,GAAG;UACX;SACDhhC,IAAI,EAAEC,aAAG,CAACC,UAAU,CAAC,iDAAiD;QACtE,CAAC,EACFyjC,eAAe;MAEhB,CAAC,CAAC;KACHn6B,MAAM,EAANA;IACA,CAAC;CACH;CAAC,iCAGD;GAAA;GACC,gCAAOjL,gBAAgB,EAAE,CAACrB,GAAG,CAAC,uBAAuB,CAAC,yEAAI,KAAK;CAChE;;KCl2BY+tB,eAAe;GAAA;GAE3B,yBAAYxuB,KAIX,EACD;KAAA;KAAA,4GACOA,KAAK;;GACX;KAAA;KAAA,oBAGD;OACC,IAAM2J,MAAM,GAAG,IAAI,CAAClJ,GAAG,CAAC,QAAQ,CAAC;OAEjC,OAAO7D,cAAI,CAACU,OAAO,CAACqM,MAAM,CAAC,GAAGA,MAAM,GAAG,EAAE;;;KACzC;KAAA,oBAGD;OACC,OAAO/M,cAAI,CAACgE,SAAS,CAAC,IAAI,CAACH,GAAG,CAAC,iBAAiB,CAAC,CAAC,GAAG,IAAI,CAACA,GAAG,CAAC,iBAAiB,CAAC,GAAG,KAAK;MACxF;KAAA,kBAEmBnB,KAAc,EAClC;OACC,IAAI,CAACzB,GAAG,CAAC,iBAAiB,EAAEyB,KAAK,CAAC;;;KAClC;KAAA,oBAGD;OAAA;OACC,oBAAO,IAAI,CAACmB,GAAG,CAAC,gBAAgB,CAAC,iDAAI,EAAE;;;GACvC;CAAA,EA/BmCzB,WAAW;;;;;;ACJhD,CACwC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAExC,KAAamoC,iBAAiB;GAK7B,2BAAYC,UAGX,EACD;KAAA;KAAA;KAAA/8B;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAhN;OAAA;OAAA,OAPuB;;KAAEA;OAAA;OAAA,OACF;;KAOtB,IAAIT,cAAI,CAACwb,aAAa,CAACgvB,UAAU,CAACle,SAAS,CAAC,EAC5C;OACC,IAAMA,SAAS,GAAG,EAAE;OACpBke,UAAU,CAACle,SAAS,CAAC3rB,OAAO,CAAC,UAAC8H,QAAQ,EAAK;SAC1C6jB,SAAS,CAACxrB,IAAI,0BACb,KAAI,sEAAJ,KAAI,EAA+B2H,QAAQ,CAACtI,EAAE,EAAEsI,QAAQ,EAAEgiC,uBAAO,CAACxM,OAAO,CAACyM,QAAQ,CAACtmC,IAAI,CAACmiB,QAAQ,EAChG;QACD,CAAC;OAEF,sCAAI,oBAAoB+F,SAAS;;KAGlC,IAAItsB,cAAI,CAACwb,aAAa,CAACgvB,UAAU,CAACne,SAAS,CAAC,EAC5C;OACC,IAAMA,SAAS,GAAG,EAAE;OACpBme,UAAU,CAACne,SAAS,CAAC1rB,OAAO,CAAC,UAAC8H,QAAQ,EAAK;SAC1C4jB,SAAS,CAACvrB,IAAI,0BACb,KAAI,sEAAJ,KAAI,EAA+B2H,QAAQ,CAACtI,EAAE,EAAEsI,QAAQ,EAAEgiC,uBAAO,CAACxM,OAAO,CAACyM,QAAQ,CAACtmC,IAAI,CAACqiB,QAAQ,EAChG;QACD,CAAC;OAEF,sCAAI,oBAAoB4F,SAAS;;;GAElC;KAAA;KAAA,8BAyFajoB,IAAY,EAAEumC,cAAkB,EAC9C;OAAA;OACC,IAAI,0BAAC,IAAI,wCAAJ,IAAI,EAAgBvmC,IAAI,CAAC,IAAIif,MAAM,CAAC8R,IAAI,CAACwV,cAAc,CAAC,CAACt+B,MAAM,GAAG,CAAC,EACxE;SACC;;OAGD,IAAIu+B,OAAO,4BAAG,IAAI,kCAAJ,IAAI,EAAaxmC,IAAI,CAAC;OAEpC,IAAMymC,UAAU,GAAG,EAAE;OAAC,+BAEtB;SACC,IAAMpiC,QAAQ,GAAGkiC,cAAc,CAACjoB,EAAE,CAAC;SACnC,IAAMrH,KAAK,GAAGuvB,OAAO,CAAC3vB,SAAS,CAAC,UAAA6vB,IAAI;WAAA,OAAIA,IAAI,CAAC3qC,EAAE,KAAKuiB,EAAE;WAAC;SACvD,IAAIrH,KAAK,GAAG,CAAC,CAAC,EACd;WACC,IAAIuvB,OAAO,CAACvvB,KAAK,CAAC,CAAC3F,IAAI,KAAKjN,QAAQ,CAACiN,IAAI,EACzC;aACCk1B,OAAO,CAACvvB,KAAK,CAAC,CAAC3F,IAAI,GAAGjN,QAAQ,CAACiN,IAAI;aACnCk1B,OAAO,CAACvvB,KAAK,CAAC,CAACzF,UAAU,4BAAG,MAAI,wCAAJ,MAAI,EAAgBnN,QAAQ,CAACiN,IAAI,EAAEjN,QAAQ,CAACsiC,cAAc,CAAC;;WACvF;;SAKFF,UAAU,CAAC/pC,IAAI,0BAAC,MAAI,sEAAJ,MAAI,EAA+B4hB,EAAE,EAAEja,QAAQ,EAAErE,IAAI,EAAE;QACvE;OAhBD,KAAK,IAAMse,EAAE,IAAIioB,cAAc;SAAA;SAAA,yBAY7B;;OAMF,IAAI3qC,cAAI,CAACwb,aAAa,CAACqvB,UAAU,CAAC,EAClC;SACCD,OAAO,GAAGA,OAAO,CAACI,MAAM,CAACH,UAAU,CAAC;;OAGrCt6B,6BAAI,kCAAJ,IAAI,EAAanM,IAAI,EAAEwmC,OAAO;;;KAC9B;KAAA,8BAEaxmC,IAAY,EAAE6mC,cAAkB,EAC9C;OACC,IAAI,0BAAC,IAAI,wCAAJ,IAAI,EAAgB7mC,IAAI,CAAC,IAAI,CAACpE,cAAI,CAACwb,aAAa,CAACyvB,cAAc,CAAC,EACrE;SACC;;OAGD,IAAML,OAAO,4BAAG,IAAI,kCAAJ,IAAI,EAAaxmC,IAAI,CAAC;OAEtC6mC,cAAc,CAACtqC,OAAO,CAAC,UAAC+hB,EAAE,EAAK;SAC9B,IAAMrH,KAAK,GAAGuvB,OAAO,CAAC3vB,SAAS,CAAC,UAAC6vB,IAAI;WAAA,OAAKA,IAAI,CAAC3qC,EAAE,KAAKuiB,EAAE;WAAC;SACzD,IAAIrH,KAAK,GAAG,CAAC,CAAC,EACd;WACCuvB,OAAO,CAAC37B,MAAM,CAACoM,KAAK,EAAE,CAAC,CAAC;;QAEzB,CAAC;OAEF9K,6BAAI,kCAAJ,IAAI,EAAanM,IAAI,EAAEwmC,OAAO;;;KAC9B;KAAA,oBA5ID;OACC,yCAAO,IAAI;MACX;KAAA,kBAEmBte,SAAa,EACjC;OACC,IAAI,CAACtsB,cAAI,CAACU,OAAO,CAAC4rB,SAAS,CAAC,EAC5B;SACC;;OAGD,sCAAI,oBAAoBA,SAAS;;;KACjC;KAAA,oBAGD;OACC,yCAAO,IAAI;MACX;KAAA,kBAEmBD,SAAa,EACjC;OACC,IAAI,CAACrsB,cAAI,CAACU,OAAO,CAAC2rB,SAAS,CAAC,EAC5B;SACC;;OAGD,sCAAI,oBAAoBA,SAAS;;;GACjC;CAAA;CA4ID,yBA1IejoB,IAAI,EACnB;GACC,OAAOpE,cAAI,CAACkb,cAAc,CAAC9W,IAAI,CAAC,IAAIif,MAAM,CAAChiB,MAAM,CAACopC,uBAAO,CAACxM,OAAO,CAACyM,QAAQ,CAACtmC,IAAI,CAAC,CAACE,QAAQ,CAACF,IAAI,CAAC;CAChG;CAAC,wCAE6Bse,EAAU,EAAEja,QAAY,EAAErE,IAAY,EAapE;GACC,OAAO;KACNqR,QAAQ,2BAAE,IAAI,oCAAJ,IAAI,EAAcrR,IAAI,CAAC;KACjCyyB,UAAU,EAAE1xB,MAAM,CAACsD,QAAQ,CAACsiC,cAAc,CAAC;KAC3C5qC,EAAE,EAAEgF,MAAM,CAACud,EAAE,CAAC;KACdhN,IAAI,EAAEvQ,MAAM,CAACsD,QAAQ,CAACiN,IAAI,CAAC;KAC3B1V,IAAI,EAAEmF,MAAM,CAACsD,QAAQ,CAACzI,IAAI,CAAC;KAC3BkrC,QAAQ,EAAE/lC,MAAM,CAACsD,QAAQ,CAACyiC,QAAQ,IAAIziC,QAAQ,CAACzI,IAAI,CAAC;KACpD4V,UAAU,EACT5V,cAAI,CAACkb,cAAc,CAACzS,QAAQ,CAACmN,UAAU,CAAC,GACrCnN,QAAQ,CAACmN,UAAU,4BACnB,IAAI,wCAAJ,IAAI,EAAgBnN,QAAQ,CAACiN,IAAI,EAAEjN,QAAQ,CAACsiC,cAAc,CAAC;KAE/Dl1B,gBAAgB,EACf7V,cAAI,CAACkb,cAAc,CAACzS,QAAQ,CAACoN,gBAAgB,CAAC,GAC3CpN,QAAQ,CAACoN,gBAAgB,4BACzB,IAAI,oDAAJ,IAAI,EAAsBzR,IAAI,EAAEse,EAAE,CAAC;KAEvCpM,OAAO,EAAE7N,QAAQ,CAAC6N,OAAO;KACzB4mB,QAAQ,EAAEl9B,cAAI,CAACgE,SAAS,CAACyE,QAAQ,CAACy0B,QAAQ,CAAC,GAAGz0B,QAAQ,CAACy0B,QAAQ,GAAGz0B,QAAQ,CAACy0B,QAAQ,KAAK,GAAG;KAC3FiO,UAAU,EAAEhmC,MAAM,CAACsD,QAAQ,CAAC0iC,UAAU;IACtC;CACF;CAAC,yBAEc1oC,IAAI,EAAE2oC,cAAc,EACnC;GACC,OAAO,IAAI,GAAGjmC,MAAM,CAACimC,cAAc,CAAC,GAAG,IAAI,GAAGjmC,MAAM,CAAC1C,IAAI,CAAC,GAAG,IAAI;CAClE;CAAC,+BAEoB2B,IAAI,EAAEse,EAAE,EAC7B;GACC,OAAO,IAAI,4BAAG,IAAI,oCAAJ,IAAI,EAActe,IAAI,CAAC,GAAG,GAAG,GAAGe,MAAM,CAACud,EAAE,CAAC,GAAG,GAAG;CAC/D;CAAC,uBAEYte,IAAI,EACjB;GACC,OAAQA,IAAI,KAAKqmC,uBAAO,CAACxM,OAAO,CAACyM,QAAQ,CAACtmC,IAAI,CAACmiB,QAAQ,GAAI,WAAW,GAAG,aAAa;CACvF;CAAC,sBA0DWniB,IAAI,EAChB;GACC,IAAIA,IAAI,KAAKqmC,uBAAO,CAACxM,OAAO,CAACyM,QAAQ,CAACtmC,IAAI,CAACmiB,QAAQ,EACnD;KACC,OAAO,IAAI,CAACD,eAAe;;GAG5B,IAAIliB,IAAI,KAAKqmC,uBAAO,CAACxM,OAAO,CAACyM,QAAQ,CAACtmC,IAAI,CAACqiB,QAAQ,EACnD;KACC,OAAO,IAAI,CAACD,eAAe;;CAE7B;CAAC,sBAEWpiB,IAAI,EAAEwmC,OAAO,EACzB;GACC,IAAIxmC,IAAI,KAAKqmC,uBAAO,CAACxM,OAAO,CAACyM,QAAQ,CAACtmC,IAAI,CAACmiB,QAAQ,EACnD;KACC,sCAAI,oBAAoBqkB,OAAO;;GAGhC,IAAIxmC,IAAI,KAAKqmC,uBAAO,CAACxM,OAAO,CAACyM,QAAQ,CAACtmC,IAAI,CAACqiB,QAAQ,EACnD;KACC,sCAAI,oBAAoBmkB,OAAO;;CAEjC;;;;;;AC7MD,CAC8E;CAAA;CAAA;CAAA;CAAA;CAAA;AAE9E,KAAaS,QAAQ;GAMpB,kBAAYC,mBAAgC,EAC5C;KAAA;KAAA79B;KAAAA;KAAAA;KAAAhN;OAAA;OAAA,OAL6B;;KAAEA;OAAA;OAAA,OACC,CAAC;;KAACA;OAAA;OAAA,OACJ;;KAI7B,IAAM8qC,eAAe,GAAGD,mBAAmB,CAAChgC,aAAa,CAAC,iCAAiC,CAAC;KAC5F,IAAIigC,eAAe,EACnB;OACC,sCAAI,UAAUA,eAAe,CAAC39B,gBAAgB,CAAC,uCAAuC,CAAC;;;GAExF;KAAA;KAAA,qBAEI+I,SAA0B,EAC/B;OACC,IAAMlH,OAAO,GAAGvK,mCAAgB,EAAE;OAClC,IAAIuK,OAAO,CAAClM,QAAQ,CAACwC,KAAK,EAAE,IAAI,CAAC,EACjC;SACC,sCAAI,yBAAyB,sCAAI,UAAQsG,MAAM,GAAG,CAAC;QACnD,MAED;SACC,sCAAI,yBAAyBsK,SAAS,CAACsE,SAAS,CAAC,UAACrE,QAAQ;WAAA,OACzDA,QAAQ,CAACrR,WAAW,EAAE,KAAKkK,OAAO,CAAClM,QAAQ,CAAC6X,kBAAkB,EAAE;UAChE,CAAC;;;;KAEH;KAAA,4BAGD;OACC7K,6BAAI,oDAAJ,IAAI;OACJA,6BAAI,0CAAJ,IAAI;;;GACJ;CAAA;CAoDD,iCAjDA;GAAA;GACC,sCAAI,UAAQ5P,OAAO,CAAC,UAACwmB,UAAU,EAAE9L,KAAK,EAAK;KAC1C,IAAMmwB,cAAc,GAAGrkB,UAAU,CAAC7b,aAAa,CAAC,iCAAiC,CAAC;KAElF,IAAIkgC,cAAc,EAClB;OACC,IAAMnzB,KAAK,GACV9H,8BAAI,wCAAJ,KAAI,EAAgB8K,KAAK,KAAK8L,UAAU,CAACkW,OAAO,CAACoO,OAAO,GACrDtkB,UAAU,CAACkW,OAAO,CAACoO,OAAO,qCAC1B,KAAI,sBACP;OAEDllC,aAAG,CAACkE,KAAK,CAAC+gC,cAAc,EAAE;SACzBzQ,eAAe,EAAE1iB,KAAK;SACtBqzB,WAAW,EAAErzB;QACb,CAAC;;IAEH,CAAC;CACH;CAAC,4BAGD;GAAA;GACC,sCAAI,UAAQ1X,OAAO,CAAC,UAACwmB,UAAU,EAAE9L,KAAK,EAAK;KAC1C,IAAI,0BAAC,MAAI,wCAAJ,MAAI,EAAgBA,KAAK,CAAC,EAC/B;OACC;;KAGD,IAAM0f,eAAe,GAAG5T,UAAU,CAACkW,OAAO,CAACoO,OAAO;KAClD,IAAI1Q,eAAe,EACnB;OACC,IAAM4Q,MAAM,GAAG9uB,QAAQ,CAACke,eAAe,EAAE,EAAE,CAAC;OAC5C,IAAM6Q,GAAG,GAAID,MAAM,IAAI,EAAE,GAAI,GAAG;OAChC,IAAME,KAAK,GAAIF,MAAM,IAAI,CAAC,GAAI,GAAG;OACjC,IAAMG,IAAI,GAAGH,MAAM,GAAG,GAAG;OAEzB,IAAMI,WAAW,GAAG,IAAI,GAAGH,GAAG,GAAG,IAAI,GAAGC,KAAK,GAAG,IAAI,GAAGC,IAAI,GAAG,GAAG;OACjE,IAAIC,WAAW,EACf;SACCxlC,aAAG,CAACkE,KAAK,CAAC0c,UAAU,EAAE,OAAO,EAAE,OAAO,CAAC;;;IAGzC,CAAC;CACH;CAAC,yBAEc9L,KAAa,EAC5B;GACC,OAAOA,KAAK,sCAAI,IAAI,wBAAsB;CAC3C;;;;ACxFD,CAC8B;AAE9B,KAAa2wB,cAAc;GAI1B,wBAAYnxB,OAA+D,EAC3E;KAAA;KAAApa;OAAA;OAAA;;KACC,IAAI,CAACT,cAAI,CAAC4+B,aAAa,CAAC/jB,OAAO,CAACqT,MAAM,CAAC,EACvC;OACC,MAAM,qCAAqC;;KAG5C,IAAMvnB,IAAI,GACT3G,cAAI,CAACkb,cAAc,CAACL,OAAO,CAAClU,IAAI,CAAC,GAC9BkU,OAAO,CAAClU,IAAI,GACZC,aAAG,CAACC,UAAU,CAAC,oDAAoD,CAAC;KAExE,IAAMolC,OAAO,GAAGjsC,cAAI,CAACkb,cAAc,CAACL,OAAO,CAACoxB,OAAO,CAAC,GAAG90B,cAAI,CAAC+0B,SAAS,CAACrxB,OAAO,CAACoxB,OAAO,CAAC,GAAG,EAAE;KAE3F,sCAAI,UAAU,IAAIE,aAAK,CAAC;OACvBC,KAAK,EAAE,CACN;SACCle,MAAM,EAAErT,OAAO,CAACqT,MAAM;SACtBzmB,KAAK,EAAEb,aAAG,CAACC,UAAU,CAAC,+CAA+C,CAAC;SACtEF,IAAI,EAAJA,IAAI;SACJslC,OAAO,EAAPA,OAAO;SACPjmC,SAAS,EAAE;WACViF,GAAG,EAAE,IAAI;WACTohC,MAAM,EAAE,KAAK;WACbh0B,KAAK,EAAE;UACP;SACD3N,QAAQ,EAAE;QACV,CACD;OACD4hC,QAAQ,EAAE;MACV,CAAC;KAEF,sCAAI,UAAQC,QAAQ,EAAE,CAACC,WAAW,CAAC,IAAI,CAAC;;GACxC;KAAA;KAAA,wBAGD;OACC,sCAAI,UAAQC,YAAY,EAAE;;;GAC1B;CAAA;;;;;;;;;;;AC7CF,CAG8B;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE9B,KAAaC,eAAe;GAiB3B,yBAAY7xB,OAGX,EACD;KAAA;KAAApN;KAAAA;KAAAA;KAAAA;KAAAA;KAAAhN;OAAA;OAAA,OAnB8B;;KAAIA;OAAA;OAAA,OACF;;KAAIA;OAAA;OAAA,OAEI;;KAAKA;OAAA;OAAA,OAElB;;KAAKA;OAAA;OAAA,OACH;;KAAKA;OAAA;OAAA,OACG;;KAAKA;OAAA;OAAA,OAMtC;;KAOH,IAAIT,cAAI,CAACgE,SAAS,CAAC6W,OAAO,CAAC8xB,iBAAiB,CAAC,EAC7C;OACC,sCAAI,sBAAsB9xB,OAAO,CAAC8xB,iBAAiB;;KAEpD,IAAI3sC,cAAI,CAACgE,SAAS,CAAC6W,OAAO,CAAC+xB,mBAAmB,CAAC,EAC/C;OACC,sCAAI,wBAAwB/xB,OAAO,CAAC+xB,mBAAmB;;;GAExD;KAAA;KAAA,kCAYiBh+B,IAAa,EAAEsf,MAAgB,EACjD;OACC,sCAAI,mBAAmBtf,IAAI;OAE3B,IAAIA,IAAI,EACR;SACC,sCAAI,iBAAe,OAAO,CAAC,GAAGsf,MAAM,aAANA,MAAM,cAANA,MAAM,GAAI,IAAI;;;;KAE7C;KAAA,oCAEmBtf,IAAa,EAAEsf,MAAgB,EACnD;OACC,sCAAI,qBAAqBtf,IAAI;OAE7B,IAAIA,IAAI,EACR;SACC,sCAAI,iBAAe,SAAS,CAAC,GAAGsf,MAAM,aAANA,MAAM,cAANA,MAAM,GAAI,IAAI;;;;KAE/C;KAAA,4CAE2Btf,IAAa,EAAEsf,MAAgB,EAC3D;OACC,sCAAI,6BAA6Btf,IAAI;OAErC,IAAIA,IAAI,EACR;SACC,sCAAI,iBAAe,iBAAiB,CAAC,GAAGsf,MAAM,aAANA,MAAM,cAANA,MAAM,GAAI,IAAI;;;;KAEvD;KAAA,wBAqED;OACC3d,6BAAI,gDAAJ,IAAI;OACJ,IAAMs8B,KAAK,4BAAG,IAAI,8BAAJ,IAAI,CAAY;OAC9B,IAAIA,KAAK,EACT;SACC,IAAMltB,WAAW,GAAGktB,KAAK,CAACC,cAAc,EAAE,CAAC5e,MAAM;SACjD,IAAIluB,cAAI,CAACy7B,SAAS,CAAC9b,WAAW,CAAC,IAAIpc,QAAQ,CAACsH,IAAI,CAACkiC,QAAQ,CAACptB,WAAW,CAAC,EACtE;WACCktB,KAAK,CAACJ,YAAY,EAAE;;;;;KAGtB;KAAA,oBArHD;OACC,yCAAO,IAAI;;;KACX;KAAA,oBAGD;OACC,yCAAO,IAAI;;;GACX;CAAA;CAoND,+BAnLA;;GAEC,sCAAI,IAAI,yBACR;KACC,sCAAI,qBAAqB,KAAK;;GAG/B,sCAAI,IAAI,iCACR;KACC,sCAAI,6BAA6B,KAAK;KACtC,sCAAI,sBAAsB,IAAI;;GAG/B,sCAAI,IAAI,uBACR;KACC,sCAAI,mBAAmB,KAAK;;;;GAI7B,sCAAI,IAAI,8BACR;KACC,sCAAI,sBAAsB,IAAI;;CAEhC;CAAC,sBAGD;GACC,IAAII,KAAK,GAAG,IAAI;GAEhB,sCAAI,IAAI,8BACR;KACC,IAAI7sC,cAAI,CAACy7B,SAAS,CAAC,sCAAI,iBAAe,iBAAiB,CAAC,CAAC,EACzD;OACCoR,KAAK,4BAAG,IAAI,4DAAJ,IAAI,CAA2B;OACvCA,KAAK,CAACN,QAAQ,EAAE,CAACC,WAAW,CAAC,IAAI,CAAC;;KAGnC,OAAOK,KAAK;;GAGb,sCAAI,IAAI,sBACR;KACC,IAAI7sC,cAAI,CAACy7B,SAAS,CAAC,sCAAI,iBAAe,SAAS,CAAC,CAAC,EACjD;OACCoR,KAAK,4BAAG,IAAI,4CAAJ,IAAI,CAAmB;OAC/BA,KAAK,CAACN,QAAQ,EAAE,CAACC,WAAW,CAAC,IAAI,CAAC;;KAGnC,OAAOK,KAAK;;GAGb,sCAAI,IAAI,oBACR;KACC,IAAI7sC,cAAI,CAACy7B,SAAS,CAAC,sCAAI,iBAAe,OAAO,CAAC,CAAC,EAC/C;OACCoR,KAAK,4BAAG,IAAI,wCAAJ,IAAI,CAAiB;OAC7BA,KAAK,CAACN,QAAQ,EAAE,CAACC,WAAW,CAAC,IAAI,CAAC;;KAGnC,OAAOK,KAAK;;GAGb,OAAOA,KAAK;CACb;CAAC,2BAiBD;GAAA;GAAA;GACC,OAAO,IAAIV,aAAK,CAAC;KAChBC,KAAK,EAAE,CACN;OACCle,MAAM,EAAE,sCAAI,iBAAe,OAAO,CAAC;OACnCzmB,KAAK,EAAEb,aAAG,CAACC,UAAU,CAAC,6CAA6C,CAAC;OACpEF,IAAI,qDAAE,IAAI,CAACsgC,WAAW,EA/JdyF,eAAe,oCA+JS,CAC/B9lC,aAAG,CAACC,UAAU,CAAC,gDAAgD,CAAC,EAChED,aAAG,CAACC,UAAU,CAAC,gDAAgD,CAAC,CAChE,CAAC;OACFolC,OAAO,EAAE,UAAU;OACnBjmC,SAAS,EAAE;SACViF,GAAG,EAAE,KAAK;SACVohC,MAAM,EAAE,IAAI;SACZh0B,KAAK,EAAE;QACP;OACD3N,QAAQ,EAAE,KAAK;OACfyF,MAAM,EAAE;SACP,QAAQ,EAAE,kBAAM;WACf,uCAAI,sBAAsB,IAAI;;;MAGhC,CACD;KACDm8B,QAAQ,EAAE;IACV,CAAC;CACH;CAAC,6BAGD;GAAA;GAAA;GACC,OAAO,IAAIH,aAAK,CAAC;KAChBC,KAAK,EAAE,CACN;OACCle,MAAM,EAAE,sCAAI,iBAAe,SAAS,CAAC;OACrCzmB,KAAK,EAAEb,aAAG,CAACC,UAAU,CAAC,+CAA+C,CAAC;OACtEF,IAAI,sDAAE,IAAI,CAACsgC,WAAW,EA5LdyF,eAAe,qCA4LS,CAC/B9lC,aAAG,CAACC,UAAU,CAAC,kDAAkD,CAAC,EAClED,aAAG,CAACC,UAAU,CAAC,kDAAkD,CAAC,CAClE,CAAC;OACFolC,OAAO,EAAE,UAAU;OACnBjmC,SAAS,EAAE;SACViF,GAAG,EAAE,KAAK;SACVohC,MAAM,EAAE,IAAI;SACZh0B,KAAK,EAAE;QACP;OACD3N,QAAQ,EAAE,KAAK;OACfyF,MAAM,EAAE;SACP,QAAQ,EAAE,kBAAM;WACf,wCAAI,wBAAwB,IAAI;;;MAGlC,CACD;KACDm8B,QAAQ,EAAE;IACV,CAAC;CACH;CAAC,qCAGD;GAAA;GAAA;GACC,OAAO,IAAIH,aAAK,CAAC;KAChBC,KAAK,EAAE,CACN;OACCle,MAAM,EAAE,sCAAI,iBAAe,iBAAiB,CAAC;OAC7CzmB,KAAK,EAAEb,aAAG,CAACC,UAAU,CAAC,sDAAsD,CAAC;OAC7EF,IAAI,sDAAE,IAAI,CAACsgC,WAAW,EAzNdyF,eAAe,qCAyNS,CAC/B9lC,aAAG,CAACC,UAAU,CAAC,2DAA2D,CAAC,EAC3ED,aAAG,CAACC,UAAU,CAAC,2DAA2D,CAAC,CAC3E,CAAC;OACFolC,OAAO,EAAE,UAAU;OACnBjmC,SAAS,EAAE;SACViF,GAAG,EAAE,KAAK;SACVohC,MAAM,EAAE,IAAI;SACZh0B,KAAK,EAAE;QACP;OACD3N,QAAQ,EAAE,KAAK;OACfyF,MAAM,EAAE;SACP,QAAQ,EAAE,kBAAM;WACf,wCAAI,gCAAgC,IAAI;;;MAG1C,CACD;KACDm8B,QAAQ,EAAE;IACV,CAAC;CACH;CAAC,kBAEeU,SAAgB,EAChC;GACC,IAAIrmC,IAAI,sDAAoD;GAAC,6CAEtCqmC,SAAS;KAAA;GAAA;KAAhC,oDACA;OAAA,IADWC,QAAQ;OAElBtmC,IAAI,qEAA4DwQ,cAAI,CAAC6C,MAAM,CAACizB,QAAQ,CAAC,WAAQ;;;KAC7F;;KAAA;;GAEDtmC,IAAI,WAAW;GAEf,OAAOA,IAAI;CACZ;;CClND,IAAIumC,eAAyB;AAE7B,CAAO,SAAShoC,gBAAgB,GAChC;GACC,IAAIgoC,eAAe,YAAY/pC,OAAO,EACtC;KACC,OAAO+pC,eAAe;;GAGvB,MAAM,IAAIC,KAAK,CAAC,gCAAgC,CAAC;CAClD;AAEA,CAAO,SAASC,mBAAmB,GACnC;GACC,IACA;KACC,OAAOloC,gBAAgB,EAAE;IACzB,CACD,OAAO6T,KAAK,EACZ;KACC,OAAO,IAAI;;CAEb;AAEA,CAAO,SAASs0B,gBAAgB,CAAC59B,OAAgB,EACjD;GACC,IAAIA,OAAO,YAAYtM,OAAO,EAC9B;KACC+pC,eAAe,GAAGz9B,OAAO;IACzB,MAED;KACC,MAAM,IAAI09B,KAAK,CAAC,qBAAqB,CAAC;;GAGvC,OAAO19B,OAAO;CACf;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}