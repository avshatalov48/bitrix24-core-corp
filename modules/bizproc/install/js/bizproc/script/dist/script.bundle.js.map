{"version":3,"file":"script.bundle.js","sources":["../src/manager.js","../src/market.js","../src/script.js"],"sourcesContent":["import {ajax, Text, Type, Tag, Uri, Dom, Loc} from 'main.core';\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {UI} from 'ui.notification';\nimport {Popup} from 'main.popup';\nimport {Button} from 'ui.buttons';\nimport 'sidepanel';\nimport 'bp_field_type';\n\nlet instance = null;\n\nexport default class Manager\n{\n\tscriptEditUrl = '/bitrix/components/bitrix/bizproc.script.edit/';\n\tscriptListUrl = '/bitrix/components/bitrix/bizproc.script.list/';\n\tscriptQueueListUrl = '/bitrix/components/bitrix/bizproc.script.queue.list/';\n\tscriptQueueDocumentListUrl = '/bitrix/components/bitrix/bizproc.script.queue.document.list/';\n\n\tstatic get Instance(): Manager\n\t{\n\t\tif(instance === null)\n\t\t{\n\t\t\tinstance = new Manager();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tstartScript(scriptId, placement)\n\t{\n\t\tconst documentIds = this.getDocumentIds(...placement.split(':'));\n\n\t\tif (!documentIds.length)\n\t\t{\n\t\t\tMessageBox.alert(Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_NOTHING_SELECTED'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst startCallback = () =>\n\t\t{\n\t\t\tthis.#startScriptInternal(scriptId, documentIds);\n\t\t\treturn true;\n\t\t};\n\n\t\tif (documentIds.length > 1)\n\t\t{\n\t\t\tMessageBox.confirm(\n\t\t\t\tLoc.getMessage('BIZPROC_SCRIPT_MANAGER_START_TEXT_START')\n\t\t\t\t\t.replace('#CNT#', documentIds.length),\n\t\t\t\tstartCallback,\n\t\t\t\tLoc.getMessage('BIZPROC_SCRIPT_MANAGER_START_BUTTON_START')\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstartCallback();\n\t\t}\n\t}\n\n\t#startScriptInternal(scriptId, documentIds, parameters = {}, popup)\n\t{\n\t\tlet data = {scriptId, documentIds, parameters};\n\n\t\tif (parameters instanceof FormData)\n\t\t{\n\t\t\tdata = parameters;\n\t\t\tdata.set('scriptId', scriptId);\n\t\t\tdocumentIds.forEach(id => data.append('documentIds[]', id));\n\t\t}\n\n\t\tajax.runAction('bizproc.script.start', {\n\t\t\tanalyticsLabel: 'bizprocScriptStart',\n\t\t\tdata\n\t\t})\n\t\t\t.then((response) =>\n\t\t\t{\n\t\t\t\tif (response.data.error)\n\t\t\t\t{\n\t\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t\t}\n\n\t\t\t\tif (response.data.status === 'FILL_PARAMETERS')\n\t\t\t\t{\n\t\t\t\t\tthis.#showFillParametersPopup(scriptId, documentIds, response.data);\n\t\t\t\t}\n\t\t\t\telse if (response.data.status === 'INVALID_PARAMETERS')\n\t\t\t\t{\n\t\t\t\t\t//error has already shown by MessageBox.alert\n\t\t\t\t\t//no actions to do\n\t\t\t\t}\n\t\t\t\telse if (response.data.status === 'QUEUED')\n\t\t\t\t{\n\t\t\t\t\tif (popup)\n\t\t\t\t\t{\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t}\n\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_QUEUED')\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.#keepAliveQueue(response.data.queueId);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(response => MessageBox.alert(response.errors.pop().message))\n\t\t;\n\t}\n\n\t#keepAliveQueue(queueId, delay = 500)\n\t{\n\t\tsetTimeout(() => {\n\t\t\tajax.runAction('bizproc.script.execQueue', {\n\t\t\t\tdata: {queueId}\n\t\t\t}).then((response) =>\n\t\t\t{\n\t\t\t\tif (!response.data.finished)\n\t\t\t\t{\n\t\t\t\t\tthis.#keepAliveQueue(queueId, delay);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_FINISHED')\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}, delay);\n\t}\n\n\t#showFillParametersPopup(scriptId, documentIds, {parameters, documentType, scriptName})\n\t{\n\t\tconst form = this.renderParametersPopupContent(parameters, documentType);\n\t\tconst popup = new Popup(null, null, {\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttitleBar: scriptName || Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_PARAMS_POPUP_TITLE'),\n\t\t\tcontent: form,\n\t\t\twidth: 595,\n\t\t\tcontentNoPaddings: true,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext : Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_BUTTON_SEND_PARAMS'),\n\t\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.#startScriptInternal(scriptId, documentIds, new FormData(form), popup);\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\ttext : Loc.getMessage('UI_MESSAGE_BOX_CANCEL_CAPTION'),\n\t\t\t\t\tcolor: BX.UI.Button.Color.LINK,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t\tpopup.show();\n\t}\n\n\trenderParametersPopupContent(parameters: [], documentType)\n\t{\n\t\tconst form = Dom.create('form', {attrs: {className: 'bp-script-start-form'}});\n\n\t\tparameters.forEach((param) => {\n\t\t\tconst field = BX.Bizproc.FieldType.renderControl(documentType, param, param.Id, param.Default || '');\n\t\t\tconst description = param.Description\n\t\t\t\t? Dom.create('span', {\n\t\t\t\t\ttext: param.Description,\n\t\t\t\t\tattrs: {className: 'bp-script-start-form-row-desc'}\n\t\t\t\t})\n\t\t\t\t: ''\n\t\t\t;\n\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"bp-script-start-form-row\">\n\t\t\t\t\t\t<span class=\"bp-script-start-form-row-title\">${Text.encode(param.Name)}</span>\n\t\t\t\t\t\t${description}\n\t\t\t\t\t\t<div class=\"bp-script-start-form-row-field\">${field}</div>\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\tform\n\t\t\t);\n\t\t});\n\n\t\treturn form;\n\t}\n\n\tgetDocumentIds(section, entity): []\n\t{\n\t\tlet ids = [];\n\t\tif (section === 'crm_switcher')\n\t\t{\n\t\t\tconst grid = this.#findGridInstance(entity);\n\t\t\tif (grid)\n\t\t\t{\n\t\t\t\tids = grid.getRows().getSelectedIds();\n\t\t\t}\n\t\t\telse if (BX.CRM && BX.CRM.Kanban && BX.CRM.Kanban.Grid && BX.CRM.Kanban.Grid.Instance)\n\t\t\t{\n\t\t\t\tids = BX.CRM.Kanban.Grid.Instance.getCheckedId();\n\t\t\t}\n\t\t}\n\t\telse if (section === 'crm_detail')\n\t\t{\n\t\t\tids = [BX.Crm.EntityEditor.getDefault().getEntityId()];\n\t\t}\n\n\t\t//Prepare crm document ids\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tids = ids.map((id) => `${entity.toUpperCase()}_${id}`);\n\t\t}\n\n\t\treturn ids;\n\t}\n\n\t#findGridInstance(entity: string)\n\t{\n\t\tif (!BX.Main.gridManager)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst gridId = `CRM_${entity.toUpperCase()}_LIST`;\n\t\tconst grid = BX.Main.gridManager.data.find((current) => {\n\t\t\treturn current.id.indexOf(gridId) === 0 || current.id.indexOf('crm-type-item-list') === 0;\n\t\t})\n\n\t\treturn grid ? grid.instance : null;\n\t}\n\n\tcreateScript(documentType: string, placement: string): Promise\n\t{\n\t\treturn Manager.openSlider(\n\t\t\tUri.addParam(this.scriptEditUrl, {documentType, placement}),\n\t\t\t{\n\t\t\t\twidth: 930,\n\t\t\t\tcacheable: false,\n\t\t\t\tallowChangeHistory: false\n\t\t\t}\n\t\t);\n\t}\n\n\tshowScriptList(documentType: string, placement: string)\n\t{\n\n\t\tManager.openSlider(\n\t\t\tUri.addParam(this.scriptListUrl, {documentType, placement}),\n\t\t\t{cacheable: false, allowChangeHistory: false}\n\t\t).then((slider) =>\n\t\t{\n\t\t\tif(slider.isLoaded())\n\t\t\t{\n\t\t\t\t//do smth\n\t\t\t}\n\t\t});\n\t}\n\n\tshowScriptQueueList(scriptId: number)\n\t{\n\t\tManager.openSlider(\n\t\t\tUri.addParam(this.scriptQueueListUrl, {scriptId}),\n\t\t\t{cacheable: false, allowChangeHistory: false}\n\t\t);\n\t}\n\n\tshowScriptQueueDocumentList(queueId: number)\n\t{\n\t\tManager.openSlider(\n\t\t\tUri.addParam(this.scriptQueueDocumentListUrl, {queueId}),\n\t\t\t{cacheable: false, allowChangeHistory: false}\n\t\t);\n\t}\n\n\tstatic openSlider(url, options): Promise<?BX.SidePanel.Slider>\n\t{\n\t\tif(!Type.isPlainObject(options))\n\t\t{\n\t\t\toptions = {};\n\t\t}\n\t\toptions = {...{cacheable: false, allowChangeHistory: true, events: {}}, ...options};\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif(Type.isString(url) && url.length > 1)\n\t\t\t{\n\t\t\t\toptions.events.onClose = function(event)\n\t\t\t\t{\n\t\t\t\t\tresolve(event.getSlider());\n\t\t\t\t};\n\t\t\t\tBX.SidePanel.Instance.open(url, options);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\teditScript(scriptId: number, placement: string): Promise\n\t{\n\t\treturn Manager.openSlider(\n\t\t\tUri.addParam(this.scriptEditUrl, {scriptId, placement}),\n\t\t\t{width: 930, cacheable: false, allowChangeHistory: false}\n\t\t);\n\t}\n\n\tdeleteScript(scriptId: number): Promise\n\t{\n\t\treturn ajax.runAction('bizproc.script.delete', {\n\t\t\tanalyticsLabel: 'bizprocScriptDelete',\n\t\t\tdata: {scriptId}\n\t\t});\n\t}\n\n\tactivateScript(scriptId: number): Promise\n\t{\n\t\treturn ajax.runAction('bizproc.script.activate', {\n\t\t\tanalyticsLabel: 'bizprocScriptActivate',\n\t\t\tdata: {scriptId}\n\t\t});\n\t}\n\n\tdeactivateScript(scriptId: number): Promise\n\t{\n\t\treturn ajax.runAction('bizproc.script.deactivate', {\n\t\t\tanalyticsLabel: 'bizprocScriptDeactivate',\n\t\t\tdata: {scriptId}\n\t\t});\n\t}\n\n\tterminateScriptQueue(queueId: number)\n\t{\n\t\tajax.runAction('bizproc.script.terminateQueue', {\n\t\t\tanalyticsLabel: 'bizprocScriptTerminateQueue',\n\t\t\tdata: {queueId}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (response.data.error)\n\t\t\t{\n\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t}\n\t\t});\n\t}\n\n\tdeleteScriptQueue(queueId: number)\n\t{\n\t\tajax.runAction('bizproc.script.deleteQueue', {\n\t\t\tanalyticsLabel: 'bizprocScriptDeleteQueue',\n\t\t\tdata: {queueId}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (response.data.error)\n\t\t\t{\n\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t}\n\t\t});\n\t}\n}","let instance = null;\n\nexport default class Market\n{\n\tstatic get Instance(): Market\n\t{\n\t\tif(instance === null)\n\t\t{\n\t\t\tinstance = new Market();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tshowForPlacement(placement: string)\n\t{\n\t\tif (BX.rest && BX.rest.Marketplace)\n\t\t{\n\t\t\tBX.rest.Marketplace.open({PLACEMENT: placement});\n\t\t}\n\t}\n}","import Manager from './manager';\nimport Market from './market';\n\nexport const Script = {\n\tMarket,\n\tManager,\n};"],"names":["instance","Manager","scriptId","placement","documentIds","getDocumentIds","split","length","MessageBox","alert","Loc","getMessage","startCallback","confirm","replace","parameters","documentType","form","Dom","create","attrs","className","forEach","param","field","BX","Bizproc","FieldType","renderControl","Id","Default","description","Description","text","append","Tag","render","Text","encode","Name","section","entity","ids","grid","getRows","getSelectedIds","CRM","Kanban","Grid","Instance","getCheckedId","Crm","EntityEditor","getDefault","getEntityId","Type","isArrayFilled","map","id","toUpperCase","openSlider","Uri","addParam","scriptEditUrl","width","cacheable","allowChangeHistory","scriptListUrl","then","slider","isLoaded","scriptQueueListUrl","queueId","scriptQueueDocumentListUrl","ajax","runAction","analyticsLabel","data","response","error","url","options","isPlainObject","events","Promise","resolve","isString","onClose","event","getSlider","SidePanel","open","popup","FormData","set","status","close","UI","Notification","Center","notify","content","errors","pop","message","delay","setTimeout","finished","scriptName","renderParametersPopupContent","Popup","onPopupClose","destroy","titleBar","contentNoPaddings","buttons","Button","color","Color","SUCCESS","onclick","LINK","show","Main","gridManager","gridId","find","current","indexOf","Market","rest","Marketplace","PLACEMENT","Script"],"mappings":";;;;;;;;;;;AAAA,CAQA,IAAIA,QAAQ,GAAG,IAAI;CAAC;CAAA;CAAA;CAAA;CAAA,IAECC,OAAO;GAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA,mDAEX,gDAAgD;KAAA,mDAChD,gDAAgD;KAAA,wDAC3C,sDAAsD;KAAA,gEAC9C,+DAA+D;;GAAA;KAAA;KAAA,4BAYhFC,QAAQ,EAAEC,SAAS,EAC/B;OAAA;OACC,IAAMC,WAAW,GAAG,IAAI,CAACC,cAAc,OAAnB,IAAI,iCAAmBF,SAAS,CAACG,KAAK,CAAC,GAAG,CAAC,EAAC;OAEhE,IAAI,CAACF,WAAW,CAACG,MAAM,EACvB;SACCC,gCAAU,CAACC,KAAK,CAACC,aAAG,CAACC,UAAU,CAAC,+CAA+C,CAAC,CAAC;SACjF;;OAGD,IAAMC,aAAa,GAAG,SAAhBA,aAAa,GACnB;SACC,4BAAI,oDAAJ,KAAI,EAAsBV,QAAQ,EAAEE,WAAW;SAC/C,OAAO,IAAI;QACX;OAED,IAAIA,WAAW,CAACG,MAAM,GAAG,CAAC,EAC1B;SACCC,gCAAU,CAACK,OAAO,CACjBH,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC,CACvDG,OAAO,CAAC,OAAO,EAAEV,WAAW,CAACG,MAAM,CAAC,EACtCK,aAAa,EACbF,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC,CAC3D;QACD,MAED;SACCC,aAAa,EAAE;;;;KAEhB;KAAA,6CAyG4BG,UAAc,EAAEC,YAAY,EACzD;OACC,IAAMC,IAAI,GAAGC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;SAACC,KAAK,EAAE;WAACC,SAAS,EAAE;;QAAwB,CAAC;OAE7EN,UAAU,CAACO,OAAO,CAAC,UAACC,KAAK,EAAK;SAC7B,IAAMC,KAAK,GAAGC,EAAE,CAACC,OAAO,CAACC,SAAS,CAACC,aAAa,CAACZ,YAAY,EAAEO,KAAK,EAAEA,KAAK,CAACM,EAAE,EAAEN,KAAK,CAACO,OAAO,IAAI,EAAE,CAAC;SACpG,IAAMC,WAAW,GAAGR,KAAK,CAACS,WAAW,GAClCd,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WACpBc,IAAI,EAAEV,KAAK,CAACS,WAAW;WACvBZ,KAAK,EAAE;aAACC,SAAS,EAAE;;UACnB,CAAC,GACA,EAAE;SAGLH,aAAG,CAACgB,MAAM,CACTC,aAAG,CAACC,MAAM,kUAEuCC,cAAI,CAACC,MAAM,CAACf,KAAK,CAACgB,IAAI,CAAC,EACpER,WAAW,EACiCP,KAAK,GAGrDP,IAAI,CACJ;QACD,CAAC;OAEF,OAAOA,IAAI;;;KACX;KAAA,+BAEcuB,OAAO,EAAEC,MAAM,EAC9B;OACC,IAAIC,GAAG,GAAG,EAAE;OACZ,IAAIF,OAAO,KAAK,cAAc,EAC9B;SACC,IAAMG,IAAI,0BAAG,IAAI,8CAAJ,IAAI,EAAmBF,MAAM,CAAC;SAC3C,IAAIE,IAAI,EACR;WACCD,GAAG,GAAGC,IAAI,CAACC,OAAO,EAAE,CAACC,cAAc,EAAE;UACrC,MACI,IAAIpB,EAAE,CAACqB,GAAG,IAAIrB,EAAE,CAACqB,GAAG,CAACC,MAAM,IAAItB,EAAE,CAACqB,GAAG,CAACC,MAAM,CAACC,IAAI,IAAIvB,EAAE,CAACqB,GAAG,CAACC,MAAM,CAACC,IAAI,CAACC,QAAQ,EACrF;WACCP,GAAG,GAAGjB,EAAE,CAACqB,GAAG,CAACC,MAAM,CAACC,IAAI,CAACC,QAAQ,CAACC,YAAY,EAAE;;QAEjD,MACI,IAAIV,OAAO,KAAK,YAAY,EACjC;SACCE,GAAG,GAAG,CAACjB,EAAE,CAAC0B,GAAG,CAACC,YAAY,CAACC,UAAU,EAAE,CAACC,WAAW,EAAE,CAAC;;;;OAIvD,IAAIC,cAAI,CAACC,aAAa,CAACd,GAAG,CAAC,EAC3B;SACCA,GAAG,GAAGA,GAAG,CAACe,GAAG,CAAC,UAACC,EAAE;WAAA,iBAAQjB,MAAM,CAACkB,WAAW,EAAE,cAAID,EAAE;UAAE,CAAC;;OAGvD,OAAOhB,GAAG;;;KACV;KAAA,6BAiBY1B,YAAoB,EAAEb,SAAiB,EACpD;OACC,OAAOF,OAAO,CAAC2D,UAAU,CACxBC,aAAG,CAACC,QAAQ,CAAC,IAAI,CAACC,aAAa,EAAE;SAAC/C,YAAY,EAAZA,YAAY;SAAEb,SAAS,EAATA;QAAU,CAAC,EAC3D;SACC6D,KAAK,EAAE,GAAG;SACVC,SAAS,EAAE,KAAK;SAChBC,kBAAkB,EAAE;QACpB,CACD;;;KACD;KAAA,+BAEclD,YAAoB,EAAEb,SAAiB,EACtD;OAECF,OAAO,CAAC2D,UAAU,CACjBC,aAAG,CAACC,QAAQ,CAAC,IAAI,CAACK,aAAa,EAAE;SAACnD,YAAY,EAAZA,YAAY;SAAEb,SAAS,EAATA;QAAU,CAAC,EAC3D;SAAC8D,SAAS,EAAE,KAAK;SAAEC,kBAAkB,EAAE;QAAM,CAC7C,CAACE,IAAI,CAAC,UAACC,MAAM,EACd;SACC,IAAGA,MAAM,CAACC,QAAQ,EAAE,EACpB;QAGA,CAAC;;;KACF;KAAA,oCAEmBpE,QAAgB,EACpC;OACCD,OAAO,CAAC2D,UAAU,CACjBC,aAAG,CAACC,QAAQ,CAAC,IAAI,CAACS,kBAAkB,EAAE;SAACrE,QAAQ,EAARA;QAAS,CAAC,EACjD;SAAC+D,SAAS,EAAE,KAAK;SAAEC,kBAAkB,EAAE;QAAM,CAC7C;;;KACD;KAAA,4CAE2BM,OAAe,EAC3C;OACCvE,OAAO,CAAC2D,UAAU,CACjBC,aAAG,CAACC,QAAQ,CAAC,IAAI,CAACW,0BAA0B,EAAE;SAACD,OAAO,EAAPA;QAAQ,CAAC,EACxD;SAACP,SAAS,EAAE,KAAK;SAAEC,kBAAkB,EAAE;QAAM,CAC7C;;;KACD;KAAA,2BA0BUhE,QAAgB,EAAEC,SAAiB,EAC9C;OACC,OAAOF,OAAO,CAAC2D,UAAU,CACxBC,aAAG,CAACC,QAAQ,CAAC,IAAI,CAACC,aAAa,EAAE;SAAC7D,QAAQ,EAARA,QAAQ;SAAEC,SAAS,EAATA;QAAU,CAAC,EACvD;SAAC6D,KAAK,EAAE,GAAG;SAAEC,SAAS,EAAE,KAAK;SAAEC,kBAAkB,EAAE;QAAM,CACzD;;;KACD;KAAA,6BAEYhE,QAAgB,EAC7B;OACC,OAAOwE,cAAI,CAACC,SAAS,CAAC,uBAAuB,EAAE;SAC9CC,cAAc,EAAE,qBAAqB;SACrCC,IAAI,EAAE;WAAC3E,QAAQ,EAARA;;QACP,CAAC;;;KACF;KAAA,+BAEcA,QAAgB,EAC/B;OACC,OAAOwE,cAAI,CAACC,SAAS,CAAC,yBAAyB,EAAE;SAChDC,cAAc,EAAE,uBAAuB;SACvCC,IAAI,EAAE;WAAC3E,QAAQ,EAARA;;QACP,CAAC;;;KACF;KAAA,iCAEgBA,QAAgB,EACjC;OACC,OAAOwE,cAAI,CAACC,SAAS,CAAC,2BAA2B,EAAE;SAClDC,cAAc,EAAE,yBAAyB;SACzCC,IAAI,EAAE;WAAC3E,QAAQ,EAARA;;QACP,CAAC;;;KACF;KAAA,qCAEoBsE,OAAe,EACpC;OACCE,cAAI,CAACC,SAAS,CAAC,+BAA+B,EAAE;SAC/CC,cAAc,EAAE,6BAA6B;SAC7CC,IAAI,EAAE;WAACL,OAAO,EAAPA;;QACP,CAAC,CAACJ,IAAI,CAAC,UAACU,QAAQ,EACjB;SACC,IAAIA,QAAQ,CAACD,IAAI,CAACE,KAAK,EACvB;WACCvE,gCAAU,CAACC,KAAK,CAACqE,QAAQ,CAACD,IAAI,CAACE,KAAK,CAAC;;QAEtC,CAAC;;;KACF;KAAA,kCAEiBP,OAAe,EACjC;OACCE,cAAI,CAACC,SAAS,CAAC,4BAA4B,EAAE;SAC5CC,cAAc,EAAE,0BAA0B;SAC1CC,IAAI,EAAE;WAACL,OAAO,EAAPA;;QACP,CAAC,CAACJ,IAAI,CAAC,UAACU,QAAQ,EACjB;SACC,IAAIA,QAAQ,CAACD,IAAI,CAACE,KAAK,EACvB;WACCvE,gCAAU,CAACC,KAAK,CAACqE,QAAQ,CAACD,IAAI,CAACE,KAAK,CAAC;;QAEtC,CAAC;;;KACF;KAAA,2BAlFiBC,GAAG,EAAEC,OAAO,EAC9B;OACC,IAAG,CAAC1B,cAAI,CAAC2B,aAAa,CAACD,OAAO,CAAC,EAC/B;SACCA,OAAO,GAAG,EAAE;;OAEbA,OAAO,mCAAO;SAAChB,SAAS,EAAE,KAAK;SAAEC,kBAAkB,EAAE,IAAI;SAAEiB,MAAM,EAAE;QAAG,GAAKF,OAAO,CAAC;OACnF,OAAO,IAAIG,OAAO,CAAC,UAACC,OAAO,EAC3B;SACC,IAAG9B,cAAI,CAAC+B,QAAQ,CAACN,GAAG,CAAC,IAAIA,GAAG,CAACzE,MAAM,GAAG,CAAC,EACvC;WACC0E,OAAO,CAACE,MAAM,CAACI,OAAO,GAAG,UAASC,KAAK,EACvC;aACCH,OAAO,CAACG,KAAK,CAACC,SAAS,EAAE,CAAC;YAC1B;WACDhE,EAAE,CAACiE,SAAS,CAACzC,QAAQ,CAAC0C,IAAI,CAACX,GAAG,EAAEC,OAAO,CAAC;UACxC,MAED;WACCI,OAAO,EAAE;;QAEV,CAAC;;;KACF;KAAA,oBAzRD;OACC,IAAGrF,QAAQ,KAAK,IAAI,EACpB;SACCA,QAAQ,GAAG,IAAIC,OAAO,EAAE;;OAGzB,OAAOD,QAAQ;;;GACf;CAAA;CAAA,+BAiCoBE,QAAQ,EAAEE,WAAW,EAC1C;GAAA;GAAA,IAD4CW,UAAU,uEAAG,EAAE;GAAA,IAAE6E,KAAK;GAEjE,IAAIf,IAAI,GAAG;KAAC3E,QAAQ,EAARA,QAAQ;KAAEE,WAAW,EAAXA,WAAW;KAAEW,UAAU,EAAVA;IAAW;GAE9C,IAAIA,UAAU,YAAY8E,QAAQ,EAClC;KACChB,IAAI,GAAG9D,UAAU;KACjB8D,IAAI,CAACiB,GAAG,CAAC,UAAU,EAAE5F,QAAQ,CAAC;KAC9BE,WAAW,CAACkB,OAAO,CAAC,UAAAoC,EAAE;OAAA,OAAImB,IAAI,CAAC3C,MAAM,CAAC,eAAe,EAAEwB,EAAE,CAAC;OAAC;;GAG5DgB,cAAI,CAACC,SAAS,CAAC,sBAAsB,EAAE;KACtCC,cAAc,EAAE,oBAAoB;KACpCC,IAAI,EAAJA;IACA,CAAC,CACAT,IAAI,CAAC,UAACU,QAAQ,EACf;KACC,IAAIA,QAAQ,CAACD,IAAI,CAACE,KAAK,EACvB;OACCvE,gCAAU,CAACC,KAAK,CAACqE,QAAQ,CAACD,IAAI,CAACE,KAAK,CAAC;;KAGtC,IAAID,QAAQ,CAACD,IAAI,CAACkB,MAAM,KAAK,iBAAiB,EAC9C;OACC,6BAAI,4DAAJ,MAAI,EAA0B7F,QAAQ,EAAEE,WAAW,EAAE0E,QAAQ,CAACD,IAAI;MAClE,MACI,IAAIC,QAAQ,CAACD,IAAI,CAACkB,MAAM,KAAK,oBAAoB,EACtD,CAGC,MACI,IAAIjB,QAAQ,CAACD,IAAI,CAACkB,MAAM,KAAK,QAAQ,EAC1C;OACC,IAAIH,KAAK,EACT;SACCA,KAAK,CAACI,KAAK,EAAE;;OAGdC,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;SAC7BC,OAAO,EAAE3F,aAAG,CAACC,UAAU,CAAC,qCAAqC;QAC7D,CAAC;OAEF,6BAAI,0CAAJ,MAAI,EAAiBmE,QAAQ,CAACD,IAAI,CAACL,OAAO;;IAE3C,CAAC,SACI,CAAC,UAAAM,QAAQ;KAAA,OAAItE,gCAAU,CAACC,KAAK,CAACqE,QAAQ,CAACwB,MAAM,CAACC,GAAG,EAAE,CAACC,OAAO,CAAC;KAAC;CAErE;CAAC,0BAEehC,OAAO,EACvB;GAAA;GAAA,IADyBiC,KAAK,uEAAG,GAAG;GAEnCC,UAAU,CAAC,YAAM;KAChBhC,cAAI,CAACC,SAAS,CAAC,0BAA0B,EAAE;OAC1CE,IAAI,EAAE;SAACL,OAAO,EAAPA;;MACP,CAAC,CAACJ,IAAI,CAAC,UAACU,QAAQ,EACjB;OACC,IAAI,CAACA,QAAQ,CAACD,IAAI,CAAC8B,QAAQ,EAC3B;SACC,6BAAI,0CAAJ,MAAI,EAAiBnC,OAAO,EAAEiC,KAAK;QACnC,MAED;SACCR,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;WAC7BC,OAAO,EAAE3F,aAAG,CAACC,UAAU,CAAC,uCAAuC;UAC/D,CAAC;;MAEH,CAAC;IACF,EAAE8F,KAAK,CAAC;CACV;CAAC,mCAEwBvG,QAAQ,EAAEE,WAAW,QAC9C;GAAA;GAAA,IADiDW,UAAU,QAAVA,UAAU;KAAEC,YAAY,QAAZA,YAAY;KAAE4F,UAAU,QAAVA,UAAU;GAEpF,IAAM3F,IAAI,GAAG,IAAI,CAAC4F,4BAA4B,CAAC9F,UAAU,EAAEC,YAAY,CAAC;GACxE,IAAM4E,KAAK,GAAG,IAAIkB,gBAAK,CAAC,IAAI,EAAE,IAAI,EAAE;KACnC3B,MAAM,EAAE;OACP4B,YAAY,EAAE,wBAAM;SACnBnB,KAAK,CAACoB,OAAO,EAAE;;MAEhB;KACDC,QAAQ,EAAEL,UAAU,IAAIlG,aAAG,CAACC,UAAU,CAAC,iDAAiD,CAAC;KACzF0F,OAAO,EAAEpF,IAAI;KACb+C,KAAK,EAAE,GAAG;KACVkD,iBAAiB,EAAE,IAAI;KACvBC,OAAO,EAAE,CACR,IAAIC,iBAAM,CAAC;OACVnF,IAAI,EAAGvB,aAAG,CAACC,UAAU,CAAC,iDAAiD,CAAC;OACxE0G,KAAK,EAAED,iBAAM,CAACE,KAAK,CAACC,OAAO;OAC3BC,OAAO,EAAE,mBAAM;SACd,6BAAI,oDAAJ,MAAI,EAAsBtH,QAAQ,EAAEE,WAAW,EAAE,IAAIyF,QAAQ,CAAC5E,IAAI,CAAC,EAAE2E,KAAK;;MAE3E,CAAC,EACF,IAAInE,EAAE,CAACwE,EAAE,CAACmB,MAAM,CAAC;OAChBnF,IAAI,EAAGvB,aAAG,CAACC,UAAU,CAAC,+BAA+B,CAAC;OACtD0G,KAAK,EAAE5F,EAAE,CAACwE,EAAE,CAACmB,MAAM,CAACE,KAAK,CAACG,IAAI;OAC9BD,OAAO,EAAE,mBAAM;SACd5B,KAAK,CAACI,KAAK,EAAE;;MAEd,CAAC;IAEH,CAAC;GACFJ,KAAK,CAAC8B,IAAI,EAAE;CACb;CAAC,4BA4DiBjF,MAAc,EAChC;GACC,IAAI,CAAChB,EAAE,CAACkG,IAAI,CAACC,WAAW,EACxB;KACC,OAAO,IAAI;;GAGZ,IAAMC,MAAM,iBAAUpF,MAAM,CAACkB,WAAW,EAAE,UAAO;GACjD,IAAMhB,IAAI,GAAGlB,EAAE,CAACkG,IAAI,CAACC,WAAW,CAAC/C,IAAI,CAACiD,IAAI,CAAC,UAACC,OAAO,EAAK;KACvD,OAAOA,OAAO,CAACrE,EAAE,CAACsE,OAAO,CAACH,MAAM,CAAC,KAAK,CAAC,IAAIE,OAAO,CAACrE,EAAE,CAACsE,OAAO,CAAC,oBAAoB,CAAC,KAAK,CAAC;IACzF,CAAC;GAEF,OAAOrF,IAAI,GAAGA,IAAI,CAAC3C,QAAQ,GAAG,IAAI;CACnC;;CCxOD,IAAIA,UAAQ,GAAG,IAAI;CAAC,IAECiI,MAAM;GAAA;KAAA;;GAAA;KAAA;KAAA,iCAYT9H,SAAiB,EAClC;OACC,IAAIsB,EAAE,CAACyG,IAAI,IAAIzG,EAAE,CAACyG,IAAI,CAACC,WAAW,EAClC;SACC1G,EAAE,CAACyG,IAAI,CAACC,WAAW,CAACxC,IAAI,CAAC;WAACyC,SAAS,EAAEjI;UAAU,CAAC;;;;KAEjD;KAAA,oBAfD;OACC,IAAGH,UAAQ,KAAK,IAAI,EACpB;SACCA,UAAQ,GAAG,IAAIiI,MAAM,EAAE;;OAGxB,OAAOjI,UAAQ;;;GACf;CAAA;;KCTWqI,MAAM,GAAG;GACrBJ,MAAM,EAANA,MAAM;GACNhI,OAAO,EAAPA;CACD,CAAC;;;;;;;;"}