{"version":3,"file":"script.bundle.js","sources":["../src/manager.js","../src/market.js","../src/script.js"],"sourcesContent":["import {ajax, Text, Type, Tag, Uri, Dom, Loc} from 'main.core';\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {UI} from 'ui.notification';\nimport {Popup} from 'main.popup';\nimport {Button} from 'ui.buttons';\nimport 'sidepanel';\nimport 'bp_field_type';\n\nlet instance = null;\n\nexport default class Manager\n{\n\tscriptEditUrl = '/bitrix/components/bitrix/bizproc.script.edit/';\n\tscriptListUrl = '/bitrix/components/bitrix/bizproc.script.list/';\n\tscriptQueueListUrl = '/bitrix/components/bitrix/bizproc.script.queue.list/';\n\tscriptQueueDocumentListUrl = '/bitrix/components/bitrix/bizproc.script.queue.document.list/';\n\n\tstatic get Instance(): Manager\n\t{\n\t\tif(instance === null)\n\t\t{\n\t\t\tinstance = new Manager();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tstartScript(scriptId, placement)\n\t{\n\t\tconst documentIds = this.getDocumentIds(...placement.split(':'));\n\n\t\tif (!documentIds.length)\n\t\t{\n\t\t\tMessageBox.alert(Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_NOTHING_SELECTED'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst startCallback = () =>\n\t\t{\n\t\t\tthis.#startScriptInternal(scriptId, documentIds);\n\t\t\treturn true;\n\t\t};\n\n\t\tif (documentIds.length > 1)\n\t\t{\n\t\t\tMessageBox.confirm(\n\t\t\t\tLoc.getMessage('BIZPROC_SCRIPT_MANAGER_START_TEXT_START')\n\t\t\t\t\t.replace('#CNT#', documentIds.length),\n\t\t\t\tstartCallback,\n\t\t\t\tLoc.getMessage('BIZPROC_SCRIPT_MANAGER_START_BUTTON_START')\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstartCallback();\n\t\t}\n\t}\n\n\t#startScriptInternal(scriptId, documentIds, parameters = {}, popup)\n\t{\n\t\tajax.runAction('bizproc.script.start', {\n\t\t\tanalyticsLabel: 'bizprocScriptStart',\n\t\t\tdata: {scriptId, documentIds, parameters}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (response.data.error)\n\t\t\t{\n\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t}\n\n\t\t\tif (response.data.status === 'FILL_PARAMETERS')\n\t\t\t{\n\t\t\t\tthis.showFillParametersPopup(scriptId, documentIds, response.data.parameters, response.data.documentType);\n\t\t\t}\n\t\t\telse if (response.data.status === 'INVALID_PARAMETERS')\n\t\t\t{\n\t\t\t\t//error has already shown by MessageBox.alert\n\t\t\t\t//no actions to do\n\t\t\t}\n\t\t\telse if (response.data.status === 'QUEUED')\n\t\t\t{\n\t\t\t\tif (popup)\n\t\t\t\t{\n\t\t\t\t\tpopup.close();\n\t\t\t\t}\n\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_QUEUED')\n\t\t\t\t});\n\n\t\t\t\tthis.#keepAliveQueue(response.data.queueId);\n\t\t\t}\n\t\t});\n\t}\n\n\t#keepAliveQueue(queueId, delay = 500)\n\t{\n\t\tsetTimeout(() => {\n\t\t\tajax.runAction('bizproc.script.execQueue', {\n\t\t\t\tdata: {queueId}\n\t\t\t}).then((response) =>\n\t\t\t{\n\t\t\t\tif (!response.data.finished)\n\t\t\t\t{\n\t\t\t\t\tthis.#keepAliveQueue(queueId, delay);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_FINISHED')\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}, delay);\n\t}\n\n\tshowFillParametersPopup(scriptId, documentIds, parameters, documentType)\n\t{\n\t\tconst form = this.renderParametersPopupContent(parameters, documentType);\n\t\tconst popup = new Popup(null, null, {\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttitleBar: Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_PARAMS_POPUP_TITLE'),\n\t\t\tcontent: form,\n\t\t\tminWidth: 500,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext : Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_BUTTON_SEND_PARAMS'),\n\t\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tconst paramFields = {};\n\t\t\t\t\t\tfor (let field of (new FormData(form)).entries())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tparamFields[field[0]] = field[1];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.#startScriptInternal(scriptId, documentIds, paramFields, popup);\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\ttext : Loc.getMessage('UI_MESSAGE_BOX_CANCEL_CAPTION'),\n\t\t\t\t\tcolor: BX.UI.Button.Color.LINK,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t\tpopup.show();\n\t}\n\n\trenderParametersPopupContent(parameters: [], documentType)\n\t{\n\t\tconst form = Dom.create('form');\n\n\t\tparameters.forEach((param) => {\n\t\t\tconst field = BX.Bizproc.FieldType.renderControl(documentType, param, param.Id, param.Default || '');\n\n\t\t\tDom.append(\n\t\t\t\tTag.render`<div><p><b>${Text.encode(param.Name)}</b></p><div>${field}</div></div>`,\n\t\t\t\tform\n\t\t\t);\n\t\t});\n\n\t\treturn form;\n\t}\n\n\tgetDocumentIds(section, entity): []\n\t{\n\t\tlet ids = [];\n\t\tif (section === 'crm_switcher')\n\t\t{\n\t\t\tconst grid = this.#findGridInstance(entity);\n\t\t\tif (grid)\n\t\t\t{\n\t\t\t\tids = grid.getRows().getSelectedIds();\n\t\t\t}\n\t\t\telse if (BX.CRM && BX.CRM.Kanban && BX.CRM.Kanban.Grid && BX.CRM.Kanban.Grid.Instance)\n\t\t\t{\n\t\t\t\tids = BX.CRM.Kanban.Grid.Instance.getCheckedId();\n\t\t\t}\n\t\t}\n\t\telse if (section === 'crm_detail')\n\t\t{\n\t\t\tids = [BX.Crm.EntityEditor.getDefault().getEntityId()];\n\t\t}\n\n\t\t//Prepare crm document ids\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tids = ids.map((id) => `${entity.toUpperCase()}_${id}`);\n\t\t}\n\n\t\treturn ids;\n\t}\n\n\t#findGridInstance(entity: string)\n\t{\n\t\tif (!BX.Main.gridManager)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst gridId = `CRM_${entity.toUpperCase()}_LIST`;\n\t\tconst grid = BX.Main.gridManager.data.find((current) => {\n\t\t\treturn current.id.indexOf(gridId) === 0;\n\t\t})\n\n\t\treturn grid ? grid.instance : null;\n\t}\n\n\tcreateScript(documentType: string, placement: string): Promise\n\t{\n\t\treturn Manager.openSlider(\n\t\t\tUri.addParam(this.scriptEditUrl, {documentType, placement}),\n\t\t\t{\n\t\t\t\twidth: 930,\n\t\t\t\tcacheable: false,\n\t\t\t\tallowChangeHistory: false\n\t\t\t}\n\t\t);\n\t}\n\n\tshowScriptList(documentType: string, placement: string)\n\t{\n\n\t\tManager.openSlider(\n\t\t\tUri.addParam(this.scriptListUrl, {documentType, placement}),\n\t\t\t{cacheable: false, allowChangeHistory: false}\n\t\t).then((slider) =>\n\t\t{\n\t\t\tif(slider.isLoaded())\n\t\t\t{\n\t\t\t\t//do smth\n\t\t\t}\n\t\t});\n\t}\n\n\tshowScriptQueueList(scriptId: number)\n\t{\n\t\tManager.openSlider(\n\t\t\tUri.addParam(this.scriptQueueListUrl, {scriptId}),\n\t\t\t{cacheable: false, allowChangeHistory: false}\n\t\t);\n\t}\n\n\tshowScriptQueueDocumentList(queueId: number)\n\t{\n\t\tManager.openSlider(\n\t\t\tUri.addParam(this.scriptQueueDocumentListUrl, {queueId}),\n\t\t\t{cacheable: false, allowChangeHistory: false}\n\t\t);\n\t}\n\n\tstatic openSlider(url, options): Promise<?BX.SidePanel.Slider>\n\t{\n\t\tif(!Type.isPlainObject(options))\n\t\t{\n\t\t\toptions = {};\n\t\t}\n\t\toptions = {...{cacheable: false, allowChangeHistory: true, events: {}}, ...options};\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif(Type.isString(url) && url.length > 1)\n\t\t\t{\n\t\t\t\toptions.events.onClose = function(event)\n\t\t\t\t{\n\t\t\t\t\tresolve(event.getSlider());\n\t\t\t\t};\n\t\t\t\tBX.SidePanel.Instance.open(url, options);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\teditScript(scriptId: number, placement: string): Promise\n\t{\n\t\treturn Manager.openSlider(\n\t\t\tUri.addParam(this.scriptEditUrl, {scriptId, placement}),\n\t\t\t{width: 930, cacheable: false, allowChangeHistory: false}\n\t\t);\n\t}\n\n\tdeleteScript(scriptId: number): Promise\n\t{\n\t\treturn ajax.runAction('bizproc.script.delete', {\n\t\t\tanalyticsLabel: 'bizprocScriptDelete',\n\t\t\tdata: {scriptId}\n\t\t});\n\t}\n\n\tactivateScript(scriptId: number): Promise\n\t{\n\t\treturn ajax.runAction('bizproc.script.activate', {\n\t\t\tanalyticsLabel: 'bizprocScriptActivate',\n\t\t\tdata: {scriptId}\n\t\t});\n\t}\n\n\tdeactivateScript(scriptId: number): Promise\n\t{\n\t\treturn ajax.runAction('bizproc.script.deactivate', {\n\t\t\tanalyticsLabel: 'bizprocScriptDeactivate',\n\t\t\tdata: {scriptId}\n\t\t});\n\t}\n\n\tterminateScriptQueue(queueId: number)\n\t{\n\t\tajax.runAction('bizproc.script.terminateQueue', {\n\t\t\tanalyticsLabel: 'bizprocScriptTerminateQueue',\n\t\t\tdata: {queueId}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (response.data.error)\n\t\t\t{\n\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t}\n\t\t});\n\t}\n\n\tdeleteScriptQueue(queueId: number)\n\t{\n\t\tajax.runAction('bizproc.script.deleteQueue', {\n\t\t\tanalyticsLabel: 'bizprocScriptDeleteQueue',\n\t\t\tdata: {queueId}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (response.data.error)\n\t\t\t{\n\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t}\n\t\t});\n\t}\n}","let instance = null;\n\nexport default class Market\n{\n\tstatic get Instance(): Market\n\t{\n\t\tif(instance === null)\n\t\t{\n\t\t\tinstance = new Market();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tshowForPlacement(placement: string)\n\t{\n\t\tif (BX.rest && BX.rest.Marketplace)\n\t\t{\n\t\t\tBX.rest.Marketplace.open({PLACEMENT: placement});\n\t\t}\n\t}\n}","import Manager from './manager';\nimport Market from './market';\n\nexport const Script = {\n\tMarket,\n\tManager,\n};"],"names":["instance","Manager","scriptId","placement","documentIds","getDocumentIds","split","length","MessageBox","alert","Loc","getMessage","startCallback","confirm","replace","parameters","documentType","form","renderParametersPopupContent","popup","Popup","events","onPopupClose","destroy","titleBar","content","minWidth","buttons","Button","text","color","Color","SUCCESS","onclick","paramFields","FormData","entries","field","BX","UI","LINK","close","show","Dom","create","forEach","param","Bizproc","FieldType","renderControl","Id","Default","append","Tag","render","Text","encode","Name","section","entity","ids","grid","getRows","getSelectedIds","CRM","Kanban","Grid","Instance","getCheckedId","Crm","EntityEditor","getDefault","getEntityId","Type","isArrayFilled","map","id","toUpperCase","openSlider","Uri","addParam","scriptEditUrl","width","cacheable","allowChangeHistory","scriptListUrl","then","slider","isLoaded","scriptQueueListUrl","queueId","scriptQueueDocumentListUrl","ajax","runAction","analyticsLabel","data","response","error","url","options","isPlainObject","Promise","resolve","isString","onClose","event","getSlider","SidePanel","open","status","showFillParametersPopup","Notification","Center","notify","delay","setTimeout","finished","Main","gridManager","gridId","find","current","indexOf","Market","rest","Marketplace","PLACEMENT","Script"],"mappings":"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"}