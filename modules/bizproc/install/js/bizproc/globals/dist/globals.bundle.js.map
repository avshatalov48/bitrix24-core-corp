{"version":3,"file":"globals.bundle.js","sources":["../src/manager.js","../src/globals.js"],"sourcesContent":["import {ajax, Type, Uri} from 'main.core';\nimport 'sidepanel';\n\nlet instance = null;\n\nexport default class Manager\n{\n\tmode = {\n\t\tvariable: 'variable',\n\t\tconstant: 'constant',\n\t}\n\n\tlistUrl = '/bitrix/components/bitrix/bizproc.globalfield.list/';\n\teditUrl = '/bitrix/components/bitrix/bizproc.globalfield.edit/';\n\n\tlistSliderOptions = {\n\t\twidth: 1150,\n\t\tcacheable: false,\n\t\tallowChangeHistory: false,\n\t};\n\n\teditSliderOptions = {\n\t\twidth: 500,\n\t\tcacheable: false,\n\t\tallowChangeHistory: false\n\t};\n\n\tstatic get Instance(): Manager\n\t{\n\t\tif(instance === null)\n\t\t{\n\t\t\tinstance = new Manager();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tstatic openSlider(url, options): Promise<?BX.SidePanel.Slider>\n\t{\n\t\tif(!Type.isPlainObject(options))\n\t\t{\n\t\t\toptions = {};\n\t\t}\n\t\toptions = {...{cacheable: false, allowChangeHistory: true, events: {}}, ...options};\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif(Type.isString(url) && url.length > 1)\n\t\t\t{\n\t\t\t\toptions.events.onClose = function(event)\n\t\t\t\t{\n\t\t\t\t\tresolve(event.getSlider());\n\t\t\t\t};\n\t\t\t\tBX.SidePanel.Instance.open(url, options);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\tcreateGlobals(mode: string, documentType: string, name: string, additionContext: object)\n\t{\n\t\tlet customName = name ?? '';\n\t\tlet visibility = null;\n\t\tlet availableTypes = [];\n\t\tif (additionContext !== undefined)\n\t\t{\n\t\t\tvisibility = additionContext['visibility'] ?? null;\n\t\t\tavailableTypes = additionContext['availableTypes'] ?? [];\n\t\t}\n\t\treturn Manager.openSlider(\n\t\t\tUri.addParam(this.editUrl, {documentType, mode: this.mode[mode], name: customName, visibility, availableTypes}),\n\t\t\tthis.editSliderOptions\n\t\t);\n\t}\n\n\teditGlobals(id: string, mode: string, documentType: string)\n\t{\n\t\tid = BX.util.htmlspecialcharsback(id);\n\t\treturn Manager.openSlider(\n\t\t\tUri.addParam(this.editUrl, {fieldId: id, mode, documentType,}),\n\t\t\tthis.editSliderOptions\n\t\t);\n\t}\n\n\tshowGlobals(mode: string, documentType: string)\n\t{\n\t\treturn Manager.openSlider(\n\t\t\tUri.addParam(this.listUrl, {documentType, mode}),\n\t\t\tthis.listSliderOptions\n\t\t);\n\t}\n\n\tdeleteGlobalsAction(id: string, mode: string, documentType: string)\n\t{\n\t\treturn ajax.runAction('bizproc.globalfield.delete', {\n\t\t\tanalyticsLabel: 'bizprocGlobalFieldDelete',\n\t\t\tdata: {\n\t\t\t\tfieldId: id,\n\t\t\t\tmode,\n\t\t\t\tdocumentType,\n\t\t\t}\n\t\t});\n\t}\n\n\tupsertGlobalsAction(id: string, property: object, documentType: string, mode: string)\n\t{\n\t\treturn ajax.runAction('bizproc.globalfield.upsert', {\n\t\t\tanalyticsLabel: 'bizprocGlobalFieldUpsert',\n\t\t\tdata: {\n\t\t\t\tfieldId: id,\n\t\t\t\tproperty,\n\t\t\t\tdocumentType,\n\t\t\t\tmode\n\t\t\t}\n\t\t});\n\t}\n}","import Manager from './manager';\n\nexport const Globals = {\n\tManager,\n};"],"names":["instance","Manager","variable","constant","width","cacheable","allowChangeHistory","mode","documentType","name","additionContext","customName","visibility","availableTypes","undefined","openSlider","Uri","addParam","editUrl","editSliderOptions","id","BX","util","htmlspecialcharsback","fieldId","listUrl","listSliderOptions","ajax","runAction","analyticsLabel","data","property","url","options","Type","isPlainObject","events","Promise","resolve","isString","length","onClose","event","getSlider","SidePanel","Instance","open","Globals"],"mappings":"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"}