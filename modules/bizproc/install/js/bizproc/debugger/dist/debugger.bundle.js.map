{"version":3,"file":"debugger.bundle.js","sources":["../src/workflow/types.js","../src/helper.js","../src/views/automation-main.js","../src/session/mode.js","../src/session/document.js","../src/session/session.js","../src/tracker/types.js","../src/tracker/robot-log.js","../src/tracker/trigger-log.js","../src/views/automation-log.js","../src/settings.js","../src/automation.js","../src/pull/command-handler.js","../src/manager.js","../src/index.js"],"sourcesContent":["export class WorkflowStatus\n{\n\tstatic Created = 0;\n\tstatic Running = 1;\n\tstatic Completed = 2;\n\tstatic Suspended = 3;\n\tstatic Terminated = 4;\n}\n\nexport class DebuggerState\n{\n\tstatic Run = 0;\n\tstatic NextStep = 1;\n\tstatic Stop = 2;\n\tstatic Pause = 3;\n\tstatic Undefined = -1;\n}\n","import {Loc, Type} from 'main.core';\nimport {DateTimeFormat} from 'main.date';\n\nexport class Helper\n{\n\t/** Finds whether a variable is a number or a numeric string */\n\tstatic isNumeric(num: string | number): boolean\n\t{\n\t\tif (Type.isNumber(num))\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (!Type.isStringFilled(num))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn (Number(num).toString() === num.trim());\n\t}\n\n\t/** Checks whether the variable is a date or a timestamp */\n\tstatic isDate(date: string | Date): boolean\n\t{\n\t\tif (Type.isDate(date))\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (!Helper.isNumeric(date))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn (new Date(Number(date)).getTime() === Number(date));\n\t}\n\n\t/** Convert date from DataBase to date in JS */\n\tstatic convertDateFromDB(date: string | number): ?Date\n\t{\n\t\tif (!Helper.isNumeric(date))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn new Date(date * 1000);\n\t}\n\n\t/** if the variable is a date or a timestamp return Date, else null  */\n\tstatic toDate(date: string | Date): ?Date\n\t{\n\t\tif (Date.parse(date))\n\t\t{\n\t\t\treturn new Date(date);\n\t\t}\n\n\t\tif (!Helper.isDate(date))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (Type.isDate(date))\n\t\t{\n\t\t\treturn date;\n\t\t}\n\n\t\treturn Helper.convertDateFromDB(date);\n\t}\n\n\t/** formats the date */\n\tstatic formatDate(format: string, date: Date): string\n\t{\n\t\tif (!Type.isStringFilled(format))\n\t\t{\n\t\t\tformat = 'j F Y H:i:s';\n\t\t}\n\n\t\treturn DateTimeFormat.format(format, date);\n\t}\n\n\t/** return condition operators label */\n\tstatic getOperatorsLabel(): object\n\t{\n\t\treturn {\n\t\t\t'!empty': Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_NOT_EMPTY'),\n\t\t\t'empty': Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_EMPTY'),\n\t\t\t'=': Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_EQ'),\n\t\t\t'!=': Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_NE'),\n\t\t\t'in': Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_IN'),\n\t\t\t'!in': Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_NOT_IN'),\n\t\t\t'contain': Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_CONTAIN'),\n\t\t\t'!contain': Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_NOT_CONTAIN'),\n\t\t\t'>': Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_GT'),\n\t\t\t'>=': Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_GTE'),\n\t\t\t'<': Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_LT'),\n\t\t\t'<=': Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_LTE'),\n\t\t};\n\t}\n\n\t/** return condition operator label */\n\tstatic getOperatorLabel(operator: string): string\n\t{\n\t\treturn Helper.getOperatorsLabel()[operator];\n\t}\n\n\t/** return joiner label */\n\tstatic getJoinerLabel(joiner: string): string\n\t{\n\t\tconst joiners = {\n\t\t\t'AND': Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_AND'),\n\t\t\t'OR': Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_OR'),\n\t\t};\n\n\t\treturn joiners[joiner];\n\t}\n\n\tstatic getColorBrightness(bgColor: string): number\n\t{\n\t\tif (bgColor[0] === '#')\n\t\t{\n\t\t\tbgColor = bgColor.replace('#', '');\n\t\t}\n\n\t\tconst bigint = parseInt(bgColor, 16);\n\t\tconst r = (bigint >> 16) & 255;\n\t\tconst g = (bigint >> 8) & 255;\n\t\tconst b = bigint & 255;\n\n\t\treturn 0.21 * r + 0.72 * g + 0.07 * b;\n\t}\n\n\tstatic getBgColorAdditionalClass(bgColor: string): boolean\n\t{\n\t\tconst brightness = Helper.getColorBrightness(bgColor);\n\t\tif (brightness > 224)\n\t\t{\n\t\t\treturn '--with-border --light-color';\n\t\t}\n\n\t\tif (brightness > 145)\n\t\t{\n\t\t\treturn '--light-color';\n\t\t}\n\n\t\treturn '';\n\t}\n}","import {Dom, Loc, Tag, Text, Type} from 'main.core';\nimport Automation from \"../automation\";\nimport {Menu, MenuItem, Popup} from \"main.popup\";\nimport {getGlobalContext, Template, Tracker, ViewMode, TriggerManager, HelpHint } from 'bizproc.automation';\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\nimport { Button, ButtonSize, ButtonColor, ButtonIcon} from 'ui.buttons';\nimport 'ui.buttons.icons';\nimport {EntitySelector} from \"ui.entity-selector\";\nimport \"bp_field_type\";\nimport 'ui.layout-form';\nimport 'ui.hint';\nimport {DebuggerState, WorkflowStatus} from \"../workflow/types\";\nimport {MessageBox, MessageBoxButtons} from \"ui.dialogs.messagebox\";\nimport {Manager} from \"bizproc.debugger\";\nimport {Helper} from \"../helper\";\n\nexport default class AutomationMainView extends EventEmitter\n{\n\t#debuggerInstance: Automation;\n\n\t#popupInstance;\n\t#loaded = false;\n\t#node;\n\t#triggerManager: ?TriggerManager;\n\t#template;\n\t#tracker;\n\t#tabs = ['doc', 'log'];\n\n\t#expandedMinWidth = 781;\n\t#expandedMinHeight = 612;\n\n\t#collapsedMinWidth = 465;\n\t#collapsedMinHeight = 187;\n\n\t#changingViewTimeout;\n\n\t#buttonPlay: Button;\n\n\tconstructor(debuggerInstance: Automation)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Debugger.AutomationMainView');\n\n\t\tthis.#debuggerInstance = debuggerInstance;\n\n\t\tdebuggerInstance.subscribe('onDocumentStatusChanged', this.#onDocumentStatusChanged.bind(this));\n\t\tdebuggerInstance.subscribe('onWorkflowEventsChanged', this.#onWorkflowEventsChanged.bind(this));\n\t\tdebuggerInstance.subscribe('onWorkflowTrackAdded', this.#onWorkflowTrackAdded.bind(this));\n\t\tdebuggerInstance.subscribe('onDocumentValuesUpdated', this.#onDocumentValuesUpdated.bind(this));\n\t\tdebuggerInstance.subscribe('onWorkflowStatusChanged', this.#onWorkflowStatusChange.bind(this));\n\t}\n\n\tget debugger(): Automation\n\t{\n\t\treturn this.#debuggerInstance;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.#loaded)\n\t\t{\n\t\t\tthis.#getPopup().show();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.debugger.loadMainViewInfo().then(() => {\n\t\t\tthis.#loaded = true;\n\t\t\tthis.#getPopup().setContent(this.#getNode());\n\t\t\tthis.#setDebuggerState(this.debugger.getState());\n\n\t\t\tthis.#getPopup().show();\n\t\t});\n\t}\n\n\tshowExpanded()\n\t{\n\t\tthis.debugger.settings.set('popup-collapsed', false);\n\t\tthis.show();\n\t}\n\n\tclose()\n\t{\n\t\tthis.#getPopup().close();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.close();\n\t\t//TODO - cleanup\n\t}\n\n\t#getPopup(): Popup\n\t{\n\t\tif (!this.#popupInstance)\n\t\t{\n\t\t\tconst collapsed = this.debugger.settings.get('popup-collapsed');\n\n\t\t\tthis.#popupInstance = new Popup({\n\t\t\t\tclassName: 'bizproc-debugger-automation__main-popup bizproc-debugger-automation__scope ' + (collapsed ? '--collapse' : ''),\n\t\t\t\ttitleBar: this.#getPopupTitleBar(),\n\t\t\t\tnoAllPaddings: true,\n\t\t\t\tcontentBackground: 'white',\n\t\t\t\tdraggable: true,\n\t\t\t\tzIndexOptions: {\n\t\t\t\t\talwaysOnTop: collapsed\n\t\t\t\t},\n\t\t\t\twidth: this.#getPopupWidth(collapsed),\n\t\t\t\theight: this.#getPopupHeight(collapsed),\n\t\t\t\tevents: {\n\t\t\t\t\tonResizeStart: ()=> {\n\t\t\t\t\t\tthis.#popupInstance.setMinWidth(this.#expandedMinWidth);\n\t\t\t\t\t\tthis.#popupInstance.setMinHeight(this.#expandedMinHeight);\n\t\t\t\t\t},\n\t\t\t\t\tonResizeEnd: ()=> {\n\t\t\t\t\t\tthis.#popupInstance.setMinWidth(null);\n\t\t\t\t\t\tthis.#popupInstance.setMinHeight(null);\n\n\t\t\t\t\t\tthis.debugger.settings.set('popup-width', this.#popupInstance.getWidth());\n\t\t\t\t\t\tthis.debugger.settings.set('popup-height', this.#popupInstance.getHeight());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.#popupInstance.setResizeMode(!collapsed);\n\t\t}\n\n\t\treturn this.#popupInstance;\n\t}\n\n\t#getPopupWidth(collapsed: boolean): number\n\t{\n\t\tif (collapsed)\n\t\t{\n\t\t\treturn this.#collapsedMinWidth;\n\t\t}\n\n\t\treturn Math.max(\n\t\t\tthis.#expandedMinWidth,\n\t\t\tthis.debugger.settings.get('popup-width') || 0\n\t\t);\n\t}\n\n\t#getPopupHeight(collapsed: boolean): number\n\t{\n\t\tif (collapsed)\n\t\t{\n\t\t\treturn this.#collapsedMinHeight;\n\t\t}\n\n\t\treturn Math.max(\n\t\t\tthis.#expandedMinHeight,\n\t\t\tthis.debugger.settings.get('popup-height') || 0\n\t\t);\n\t}\n\n\t#getPopupTitleBar(): {}\n\t{\n\t\treturn {\n\t\t\tcontent: Tag.render`\n\t\t\t\t<div class=\"popup-window-titlebar-text bizproc-debugger-automation__titlebar\">\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__titlebar--move-icon\"></div>\n\t\t\t\t\t${document.createTextNode(Loc.getMessage('BIZPROC_DEBUGGER_AUTOMATION_POPUP_TITLE'))}\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"bizproc-debugger-automation__titlebar--button-collapse\" \n\t\t\t\t\t\tonclick=\"${this.#handleCollapse.bind(this)}\"\n\t\t\t\t\t></div>\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass=\" popup-window-close-icon \n\t\t\t\t\t\t\t\tpopup-window-titlebar-close-icon \n\t\t\t\t\t\t\t\tbizproc-debugger-automation__titlebar--button-close\"\n\t\t\t\t\t\tonclick=\"${this.#handleClose.bind(this)}\"\n\t\t\t\t\t></span>\n\t\t\t\t</div>\n\t\t\t`\n\t\t};\n\t}\n\n\t#handleCollapse()\n\t{\n\t\tconst node = this.#getPopup().getPopupContainer();\n\t\tconst collapsed = Dom.hasClass(node, '--collapse');\n\n\t\tthis.debugger.settings.set('popup-collapsed', !collapsed);\n\t\tthis.#getPopup().getZIndexComponent().setAlwaysOnTop(!collapsed);\n\n\t\tthis.#getPopup().setResizeMode(collapsed);\n\n\t\tDom.toggleClass(node, '--collapse');\n\n\t\tclearTimeout(this.#changingViewTimeout);\n\t\tDom.addClass(node, '--changing-view');\n\n\t\tthis.#getPopup().setWidth(this.#getPopupWidth(!collapsed));\n\t\tthis.#getPopup().setHeight(this.#getPopupHeight(!collapsed));\n\n\t\tthis.#changingViewTimeout = setTimeout(\n\t\t\t() => Dom.removeClass(node, '--changing-view'),\n\t\t\t500\n\t\t);\n\t}\n\n\t#handleClose()\n\t{\n\t\tMessageBox.show({\n\t\t\tmessage: Loc.getMessage('BIZPROC_JS_DEBUGGER_CONFIRM_FINISH_SESSION'),\n\t\t\tokCaption: Loc.getMessage('BIZPROC_JS_DEBUGGER_VIEWS_MENU_FINISH_SESSION'),\n\t\t\tonOk: () => Manager.Instance.finishSession(this.debugger.session),\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t});\n\t}\n\n\t#getNode(): Element\n\t{\n\t\tif (!this.#node)\n\t\t{\n\t\t\tthis.#node = Tag.render`\n\t\t\t\t<div class=\"bizproc-debugger-automation__content\">\n\t\t\t\t\t<div class=\"bizproc-debugger-automation-content-collapsed\">\n\t\t\t\t\t\t${this.#renderCollapsedMode()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__content-expanded\">\n\t\t\t\t\t\t${this.#renderExpandedMode()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tHelpHint.bindAll(this.#node);\n\t\t}\n\n\t\treturn this.#node;\n\t}\n\n\t#renderExpandedMode(): Element\n\t{\n\t\tconst hasFields = this.debugger.settings.getSet('watch-fields').size > 0;\n\t\tconst hasRobots = !this.debugger.isTemplateEmpty();\n\n\t\tconst activeTab = this.debugger.settings.get('tab') === 'log' ? 'log' : 'doc';\n\t\tconst tabDocClass = activeTab === 'doc' ? '--active' : '';\n\t\tconst tabLogClass = activeTab === 'log' ? '--active' : '';\n\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"bizproc-debugger-automation__main\">\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__main-robots\">\n\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__main-robots--head\">\n\t\t\t\t\t\t\t${this.#createStageNode()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div data-role=\"automation-content\" class=\"bizproc-debugger-automation__main-robots--main-content\">\n\t\t\t\t\t\t\t${this.#createTriggersHeaderNode() ?? ''}\n\t\t\t\t\t\t\t${this.#createTriggersNode() ?? ''}\n\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__head\">\n\t\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__main--title\">\n\t\t\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__main--name\">${Loc.getMessage('BIZPROC_DEBUGGER_AUTOMATION_ROBOTS_TITLE')} </div>\n\t\t\t\t\t\t\t\t\t<div class=\"ui-hint\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"ui-hint-icon\" data-text=\"${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_HELPTIP_ROBOT'))}\"></span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div data-role=\"no-template\" class=\"bizproc-debugger-automation__main-hint ${hasRobots ? '' : '--active'}\">\n\t\t\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__main-hint--title\">\n\t\t\t\t\t\t\t\t\t\t${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_NO_ROBOTS_TITLE'))}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__main-hint--text\">\n\t\t\t\t\t\t\t\t\t\t${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_NO_ROBOTS_SUBTITLE'))}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<a href=\"${this.debugger.getSettingsUrl()}\" class=\"bizproc-debugger-automation__link\">${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_AUTOMATION_SETTINGS'))}</a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n<!--\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__dividing-line\"></div>-->\n\t\t\t\t\t\t\t${this.#createTemplateNode()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${this.#createTemplateToolbar()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__main-fields\">\n\t\t\t\t\t\t<div data-role=\"tabs-container\" class=\"bizproc-debugger-automation__main-navigation --active-${activeTab}\">\n\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__tab-block\">\n\t\t\t\t\t\t\t\t<span class=\"bizproc-debugger-automation__tab ${tabDocClass}\" data-tab-item=\"doc\" onclick=\"${this.#handleChangeTab.bind(this)}\">\n\t\t\t\t\t\t\t\t\t${Loc.getMessage('BIZPROC_DEBUGGER_AUTOMATION_DOCUMENT_TITLE')}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<div class=\"ui-hint\">\n\t\t\t\t\t\t\t\t\t<span class=\"ui-hint-icon\" data-text=\"${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_HELPTIP_FIELD'))}\"></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__tab-block\">\n\t\t\t\t\t\t\t\t<span class=\"bizproc-debugger-automation__tab ${tabLogClass}\" data-tab-item=\"log\" onclick=\"${this.#handleChangeTab.bind(this)}\">\n\t\t\t\t\t\t\t\t\t${Loc.getMessage('BIZPROC_DEBUGGER_AUTOMATION_LOG_TITLE')}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<div class=\"ui-hint\">\n\t\t\t\t\t\t\t\t\t<span class=\"ui-hint-icon\" data-text=\"${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_HELPTIP_LOG'))}\"></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div data-tab-item=\"doc\" class=\"bizproc-debugger-automation__tab-action ${tabDocClass}\">\n\t\t\t\t\t\t\t\t${this.#getAddFieldNode()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div data-tab-item=\"log\" class=\"bizproc-debugger-automation__tab-action ${tabLogClass}\">\n\t\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__action-btn --icon-search\" style=\"display: none\"></div>\n\t\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__action-btn --icon-log\" onclick=\"${() => {Manager.Instance.openSessionLog(this.debugger.sessionId);}}\"></div>\n\t\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__action-btn --icon-note\" style=\"display: none\"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div data-tab-item=\"doc\" data-role=\"tab-content-doc\" class=\"bizproc-debugger-tab__content ${tabDocClass} ${hasFields ? '' : '--empty'}\">\n\t\t\t\t\t\t\t<div class=\"bizproc-debugger-tab__content--empty\">\n\t\t\t\t\t\t\t\t${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_NO_FIELD_TITLE'))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"bizproc-debugger-tab__content--not-empty\">\n\t\t\t\t\t\t\t\t<div class=\"bizproc-debugger-tab__content-title\">${Loc.getMessage('BIZPROC_DEBUGGER_AUTOMATION_DOCUMENT_TITLE')}</div>\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t${this.#getFieldListNode()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div data-tab-item=\"log\" class=\"bizproc-debugger-tab__content ${tabLogClass} bizproc-debugger-automation-main-section-log\">\n\t\t\t\t\t\t\t${this.debugger.getLogView().shouldScrollToBottom(true).shouldLoadPreviousLog(true).render()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t}\n\n\t#renderCollapsedMode(): Element\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation-menu__content-body\">\n\t\t\t\t<div class=\"bizproc-debugger-automation-menu__content-body--logo\"></div>\n\t\t\t\t<div class=\"bizproc-debugger-automation-menu__content-body--text\">${Loc.getMessage('BIZPROC_JS_DEBUGGER_VIEWS_MENU_SUBTITLE')}</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getAddFieldNode()\n\t{\n\t\treturn (new Button({\n\t\t\tsize: ButtonSize.EXTRA_SMALL,\n\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\tround: true,\n\t\t\tnoCaps: true,\n\t\t\ttext: Loc.getMessage('BIZPROC_JS_DEBUGGER_VIEWS_ADD_FIELD'),\n\t\t\tonclick: this.#handleAddDocFieldMenu.bind(this)\n\t\t})).render();\n\t}\n\n\t#getFieldListNode()\n\t{\n\t\tconst form = Tag.render`<div class=\"ui-form\" data-role=\"doc-field-list\">\n\t\t\t</div>`;\n\t\tconst fields = this.debugger.settings.getSet('watch-fields');\n\n\t\tfields.forEach(value => {\n\t\t\tconst node = this.#getFieldNode(value);\n\t\t\tif (node)\n\t\t\t{\n\t\t\t\tDom.append(node, form);\n\t\t\t}\n\t\t});\n\n\t\treturn form;\n\t}\n\n\t#handleChangeTab(event: Event)\n\t{\n\t\tconst activeTabName = event.target.dataset.tabItem;\n\t\tconst hiddenTabName = this.#tabs.filter((tabName) => tabName !== activeTabName)[0]\n\n\t\tconst node = this.#getNode();\n\t\tconst navigationNode = node.querySelector('[data-role=\"tabs-container\"]');\n\n\t\tnode.querySelectorAll([`[data-tab-item=\"${activeTabName}\"]`]).forEach(\n\t\t\t(tab) => Dom.addClass(tab, '--active')\n\t\t);\n\n\t\tnode.querySelectorAll([`[data-tab-item=\"${hiddenTabName}\"]`]).forEach(\n\t\t\t(tab) => Dom.removeClass(tab, '--active')\n\t\t);\n\n\t\tDom.addClass(navigationNode, `--active-${activeTabName}`);\n\t\tDom.removeClass(navigationNode, `--active-${hiddenTabName}`);\n\n\t\tthis.debugger.settings.set('tab', activeTabName);\n\n\t\tthis.emit('onChangeTab', {tab: activeTabName});\n\t}\n\n\t#handleAddDocFieldMenu(button: Button, event: Event)\n\t{\n\t\tconst documentFields = this.debugger.getDocumentFields();\n\t\tconst selectedFields = this.debugger.settings.getSet('watch-fields');\n\n\t\tconst fieldsDialog = new EntitySelector.Dialog({\n\t\t\ttargetNode: event.target,\n\t\t\twidth: 500,\n\t\t\theight: 300,\n\t\t\tmultiple: true,\n\t\t\tdropdownMode: true,\n\t\t\tenableSearch: true,\n\t\t\tcacheable: false,\n\t\t\titems: documentFields\n\t\t\t\t.filter(field => field.Watchable === true)\n\t\t\t\t.map((field) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttitle: field.Name,\n\t\t\t\t\t\tid: field.Id,\n\t\t\t\t\t\tcustomData: {field},\n\t\t\t\t\t\tentityId: 'bp',\n\t\t\t\t\t\ttabs: 'recents',\n\t\t\t\t\t\tselected: selectedFields.has(field.Id)\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\tshowAvatars: false,\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': event => this.#handleAddField(event.getData().item),\n\t\t\t\t'Item:onDeselect': event => this.#handleRemoveField(event.getData().item.getId()),\n\t\t\t},\n\t\t\tcompactView: true,\n\t\t});\n\n\t\tfieldsDialog.show();\n\t}\n\n\t#handleAddField(item)\n\t{\n\t\tconst fields = this.debugger.settings.getSet('watch-fields');\n\t\tconst field = item.getCustomData().get('field');\n\n\t\tif (fields.has(field.Id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldNode = this.#getFieldNode(field);\n\n\t\tDom.append(\n\t\t\tfieldNode,\n\t\t\tthis.#getNode().querySelector('[data-role=\"doc-field-list\"]')\n\t\t);\n\n\t\tfields.add(field.Id);\n\t\tthis.debugger.settings.set('watch-fields', fields);\n\t\tthis.#handleFieldListChange(fields);\n\t}\n\n\t#handleRemoveField(fieldId: string)\n\t{\n\t\tconst fields = this.debugger.settings.getSet('watch-fields');\n\n\t\tif (!fields.has(fieldId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfields.delete(fieldId);\n\t\tthis.debugger.settings.set('watch-fields', fields);\n\t\tthis.#handleFieldListChange(fields);\n\n\t\tDom.remove(this.#getNode().querySelector(`[data-field-id=\"${fieldId}\"]`));\n\t}\n\n\t#handleFieldListChange(fields: Set)\n\t{\n\t\tconst contentNode = this.#getNode().querySelector('[data-role=\"tab-content-doc\"]');\n\n\t\tDom[fields.size > 0 ? 'removeClass' : 'addClass'](contentNode, '--empty');\n\t}\n\n\t#getFieldNode(field: string | {}): ?Element\n\t{\n\t\tif (Type.isString(field))\n\t\t{\n\t\t\tfield = this.debugger.getDocumentField(field);\n\t\t}\n\n\t\tif (!field || !field.Id)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst value = this.debugger.getDocumentValue(field.Id) || '';\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-form-row\" data-role=\"field-row\" data-field-id=\"${Text.encode(field.Id)}\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Text.encode(field.Name)}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-ext-after-icon\">\n\t\t\t\t\t\t<input type=\"text\" readonly class=\"ui-ctl-element\"\n\t\t\t\t\t\t placeholder=\"${Loc.getMessage('BIZPROC_JS_DEBUGGER_VIEWS_EMPTY_VALUE')}\"\n\t\t\t\t\t\t data-role=\"field-value-${Text.encode(field.Id)}\"\n\t\t\t\t\t\t value=\"${Text.encode(value)}\"\n\t\t\t\t\t\t >\n\t\t\t\t\t\t <a class=\"ui-ctl-after ui-ctl-icon-clear\" onclick=\"${this.#handleRemoveField.bind(this, field.Id)}\"></a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createTriggersHeaderNode(): ?Element\n\t{\n\t\tconst hasTriggers = this.debugger.templateTriggers.length > 0;\n\t\tconst hasRobots = !this.debugger.isTemplateEmpty();\n\n\t\tif (!hasTriggers && hasRobots)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div data-role=\"triggers-header\" class=\"bizproc-debugger-automation__head\">\n\t\t\t\t<div class=\"bizproc-debugger-automation__main--title\">\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__main--name\">${Loc.getMessage('BIZPROC_DEBUGGER_AUTOMATION_TRIGGERS_TITLE')} </div>\n\t\t\t\t\t<div class=\"ui-hint\">\n\t\t\t\t\t\t<span class=\"ui-hint-icon\" data-text=\"${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_HELPTIP_TRIGGER'))}\"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div data-role=\"no-triggers\" class=\"bizproc-debugger-automation__main-hint ${hasTriggers || hasRobots ? '' : '--active'}\">\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__main-hint--title\">\n\t\t\t\t\t\t${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_NO_TRIGGERS_TITLE'))}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__main-hint--text\">\n\t\t\t\t\t\t${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_NO_TRIGGERS_SUBTITLE'))}\n\t\t\t\t\t</div>\n\t\t\t\t\t<a href=\"${this.debugger.getSettingsUrl()}\" class=\"bizproc-debugger-automation__link\">${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_AUTOMATION_SETTINGS'))}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createTriggersNode(): ?Element\n\t{\n\t\tconst documentStatus = this.debugger.getTemplate().DOCUMENT_STATUS;\n\n\t\tthis.#tracker = new Tracker(getGlobalContext().document);\n\t\tconst logs = {};\n\t\tlogs[documentStatus] = this.debugger.track;\n\t\tthis.#tracker.init(logs);\n\t\tgetGlobalContext().tracker = this.#tracker;\n\n\t\tconst triggers = this.debugger.templateTriggers;\n\t\tif (triggers.length === 0)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst node = Tag.render`\n\t\t\t<div data-role=\"triggers\" class=\"bizproc-debugger__template\">\n\t\t\t\t<div class=\"bizproc-automation-status-list-item\" data-type=\"column-trigger\">\n\t\t\t\t\t<div data-role=\"trigger-list\" class=\"bizproc-automation-trigger-list\" data-status-id=\"${documentStatus}\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#triggerManager = new TriggerManager(node);\n\t\tthis.#triggerManager.init({TRIGGERS: triggers}, ViewMode.view());\n\n\t\treturn node;\n\t}\n\n\t#createTemplateNode(): Element\n\t{\n\t\tconst templateData = this.debugger.getTemplate();\n\n\t\tthis.#tracker = new Tracker(getGlobalContext().document);\n\t\tconst logs = {};\n\t\tlogs[templateData.DOCUMENT_STATUS] = this.debugger.track;\n\t\tthis.#tracker.init(logs);\n\t\tgetGlobalContext().tracker = this.#tracker;\n\n\t\tconst node = Tag.render`\n\t\t\t<div data-role=\"template\" class=\"bizproc-debugger__template\">\n\t\t\t\t<div data-role=\"automation-template\" data-status-id=\"${templateData.DOCUMENT_STATUS}\">\n\t\t\t\t\t<div data-role=\"robot-list\" class=\"bizproc-automation-robot-list\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst template = new Template({\n\t\t\tconstants: {},\n\t\t\t// globalConstants: this.component.getConstants(),\n\t\t\tvariables: {},\n\t\t\t// globalVariables: this.component.getGVariables(),\n\t\t\ttemplateContainerNode: node,\n\t\t\tdelayMinLimitM: 0,\n\t\t\t// userOptions: this.userOptions,\n\t\t});\n\n\t\ttemplate.init(templateData, ViewMode.view().intoRaw());\n\t\tthis.#updateTemplate(template);\n\n\t\treturn node;\n\t}\n\n\t#updateTemplate(newTemplate: Template): Template\n\t{\n\t\tif (!Type.isNil(this.#template))\n\t\t{\n\t\t\tthis.#template.destroy();\n\t\t}\n\t\tthis.#template = newTemplate;\n\n\t\treturn this.#template;\n\t}\n\n\t#createTemplateToolbar(): Element\n\t{\n\t\tthis.#buttonPlay = new Button({\n\t\t\tsize: ButtonSize.EXTRA_SMALL,\n\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\tround: true,\n\t\t\ticon: ButtonIcon.START,\n\t\t\tonclick: this.#handleStartTemplate.bind(this)\n\t\t});\n\n\t\tconst hasEvents = this.debugger.hasWorkflowEvents();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__toolbar\">\n\t\t\t<div data-role=\"external-event-info\" class=\"bizproc-debugger-automation__toolbar--info-waiting ${hasEvents ? '--active' : ''}\">\n\t\t\t\t<div>\n\t\t\t\t\t${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_SKIP_WAITING_SUBTITLE'))}\n\t\t\t\t</div>\n\t\t\t\t<a onclick=\"${this.#handleEmulateExternalEvent.bind(this)}\" class=\"bizproc-debugger-automation__link\">\n\t\t\t\t\t${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_SKIP_WAITING_TITLE'))}\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t\t<div class=\"bizproc-debugger-automation__toolbar--btn-block\">\n\t\t\t\t${this.#buttonPlay.render()}\n\t\t\t\t<div class=\"bizproc-debugger-automation__toolbar--btn-text\">\n\t\t\t\t\t${Loc.getMessage('BIZPROC_DEBUGGER_AUTOMATION_ACTION_START')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#handleStartTemplate(button: Button)\n\t{\n\t\tbutton.setWaiting(true);\n\t\tthis.debugger.startDebugTemplate().then(() => {\n\t\t\tbutton.setWaiting(false);\n\t\t\tthis.#setDebuggerState(this.debugger.getState());\n\t\t});\n\t}\n\n\t#handleEmulateExternalEvent(event: Event)\n\t{\n\t\tconst infoNode = this.#getNode().querySelector('[data-role=\"external-event-info\"]');\n\t\tDom.removeClass(infoNode, '--active');\n\t\tthis.debugger.emulateExternalEvent();\n\t}\n\n\t#updateTracker(data: Array)\n\t{\n\t\tif (this.#tracker)\n\t\t{\n\t\t\tconst logs = {};\n\t\t\tlogs[this.debugger.getDocumentStatus()] = this.debugger.track;\n\n\t\t\tthis.#tracker.reInit(logs);\n\t\t\tthis.#template.reInit(null, ViewMode.view().intoRaw());\n\t\t}\n\t}\n\n\t#createStageNode(): Element\n\t{\n\t\tconst color = this.#getDocumentStatusColor();\n\t\tconst title = Text.encode(this.#getDocumentStatusTitle());\n\n\t\t//class --robot-change\n\t\t//onclick=\"${this.#handleShowStages.bind(this)}\"\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__status ---robot-change ${Helper.getBgColorAdditionalClass(color)}\" data-role=\"document-status\" title=\"${title}\">\n\t\t\t\t<div class=\"bizproc-debugger-automation__status--title\" data-role=\"document-status-title\">\n\t\t\t\t\t${title}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bizproc-debugger-automation__status--bg\" data-role=\"document-status-bg\" style=\"background-color: ${color}; border-color: ${color};\">\n\t\t\t\t\t<span class=\"bizproc-debugger-automation__status--bg-arrow\"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#handleShowStages(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst statusList = this.debugger.getStatusList();\n\n\t\tconst menu = new Menu({\n\t\t\tbindElement: event.target,\n\t\t\titems: statusList.map((stage) => {\n\t\t\t\treturn {text: stage.NAME, statusId: stage['STATUS_ID'], onclick: this.#handleChangeStatus.bind(this)}\n\t\t\t}),\n\t\t});\n\t\tmenu.show();\n\t}\n\n\t#handleChangeStatus(event, item: MenuItem)\n\t{\n\t\titem.getMenuWindow().destroy();\n\t\tthis.debugger.setDocumentStatus(item.statusId);\n\t}\n\n\t#getDocumentStatusTitle(): string\n\t{\n\t\tconst statusId = this.debugger.getDocumentStatus();\n\t\tconst statusList = this.debugger.getStatusList();\n\n\t\tconst status = statusList.find((stage) => stage['STATUS_ID'] === statusId);\n\n\t\treturn status ? (status.NAME || status.TITLE) : '?'\n\t}\n\n\t#getDocumentStatusColor(): string\n\t{\n\t\tconst statusId = this.debugger.getDocumentStatus();\n\t\tconst statusList = this.debugger.getStatusList();\n\n\t\tconst status = statusList.find((stage) => stage['STATUS_ID'] === statusId);\n\n\t\treturn status ? status.COLOR : '#9DCF00';\n\t}\n\n\t#onDocumentStatusChanged()\n\t{\n\t\tif (!this.#getPopup().isShown())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst statusTitleNode = this.#getNode().querySelector('[data-role=\"document-status-title\"]');\n\t\tconst statusTitle = this.#getDocumentStatusTitle();\n\t\tstatusTitleNode.textContent = statusTitle;\n\t\tstatusTitleNode.parentNode.setAttribute('title', statusTitle);\n\n\t\tconst statusBgNode = this.#getNode().querySelector('[data-role=\"document-status-bg\"]');\n\t\tconst color = this.#getDocumentStatusColor();\n\t\tDom.style(statusBgNode, {\n\t\t\tbackgroundColor: color,\n\t\t\tborderColor: color,\n\t\t});\n\n\t\tconst documentStatusNode = this.#getNode().querySelector('[data-role=\"document-status\"]');\n\t\tDom.removeClass(documentStatusNode,['--with-border', '--light-color']);\n\t\tDom.addClass(documentStatusNode, Helper.getBgColorAdditionalClass(color));\n\n\t\tDom.remove(this.#getNode().querySelector('[data-role=\"triggers-header\"]'));\n\t\tDom.remove(this.#getNode().querySelector('[data-role=\"triggers\"]'));\n\n\t\tconst automationContentNode = this.#getNode().querySelector('[data-role=\"automation-content\"]');\n\n\t\tDom.prepend(this.#createTriggersNode(), automationContentNode);\n\t\tconst triggersHeaderNode = this.#createTriggersHeaderNode();\n\t\tif (triggersHeaderNode)\n\t\t{\n\t\t\tHelpHint.bindAll(triggersHeaderNode);\n\t\t\tDom.prepend(triggersHeaderNode, automationContentNode);\n\t\t}\n\n\t\tconst tplNode = this.#createTemplateNode();\n\t\tDom.replace(this.#node.querySelector('[data-role=\"template\"]'), tplNode);\n\n\t\tconst hasTriggers = this.debugger.templateTriggers.length > 0;\n\t\tconst hasRobots = !this.debugger.isTemplateEmpty()\n\t\tDom[hasTriggers || hasRobots ? 'removeClass' : 'addClass'](this.#node.querySelector('[data-role=\"no-triggers\"]'), '--active');\n\t\tDom[hasRobots ? 'removeClass' :'addClass'](this.#node.querySelector('[data-role=\"no-template\"]'), '--active');\n\t}\n\n\t#onWorkflowEventsChanged(event: BaseEvent)\n\t{\n\t\tif (!this.#buttonPlay)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst events = event.getData().events;\n\t\tconst infoNode = this.#getNode().querySelector('[data-role=\"external-event-info\"]');\n\t\tDom[events.length ? 'addClass' : 'removeClass'](infoNode, '--active');\n\t}\n\n\t#onWorkflowTrackAdded(event: BaseEvent)\n\t{\n\t\tthis.#updateTracker(this.debugger.track);\n\t}\n\n\t#onDocumentValuesUpdated(event: BaseEvent)\n\t{\n\t\tif (!this.#getPopup().isShown())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst values = event.getData().values;\n\t\tconst node = this.#getNode();\n\n\t\tObject.keys(values).forEach(key => {\n\t\t\tconst valueNode = node.querySelector(`[data-role=\"field-value-${key}\"]`);\n\t\t\tif (valueNode)\n\t\t\t{\n\t\t\t\tvalueNode.value = values[key] || '';\n\t\t\t}\n\t\t});\n\t}\n\n\t#onWorkflowStatusChange(event: BaseEvent)\n\t{\n\t\tconst status = event.getData().status;\n\t\tconst workflowId = event.getData().workflowId;\n\n\t\tif ([WorkflowStatus.Completed, WorkflowStatus.Terminated].includes(status))\n\t\t{\n\t\t\tthis.debugger.track.forEach((track) => {\n\t\t\t\tif (track['WORKFLOW_ID'] === workflowId)\n\t\t\t\t{\n\t\t\t\t\ttrack['WORKFLOW_STATUS'] = WorkflowStatus.Completed;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.#updateTracker(this.debugger.track);\n\t\t}\n\t}\n\n\t#setDebuggerState(state: number)\n\t{\n\t\tif (!this.#buttonPlay)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (state)\n\t\t{\n\t\t\tcase DebuggerState.Run:\n\t\t\t\tthis.#buttonPlay.setIcon(ButtonIcon.PAUSE);\n\t\t\t\tthis.#buttonPlay.getContainer()\n\t\t\t\t\t.nextElementSibling.textContent = Loc.getMessage('BIZPROC_DEBUGGER_AUTOMATION_ACTION_PAUSE');\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthis.#buttonPlay.setIcon(ButtonIcon.START);\n\t\t\t\tthis.#buttonPlay.getContainer()\n\t\t\t\t\t.nextElementSibling.textContent = Loc.getMessage('BIZPROC_DEBUGGER_AUTOMATION_ACTION_START');\n\n\t\t}\n\t}\n}","export class Mode\n{\n\tstatic experimental: ModeOptions = {\n\t\tid: 0\n\t};\n\n\tstatic interception: ModeOptions = {\n\t\tid: 1\n\t};\n\n\tstatic isMode(modeId: number): boolean\n\t{\n\t\treturn [0, 1].includes(modeId);\n\t}\n\n\tstatic getMode(modeId: number): ModeOptions | null\n\t{\n\t\tif (modeId === 0)\n\t\t{\n\t\t\treturn Mode.experimental;\n\t\t}\n\t\telse if (modeId === 1)\n\t\t{\n\t\t\treturn Mode.interception;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tstatic getAllModes(): object<number, ModeOptions>\n\t{\n\t\treturn {\n\t\t\t0: Mode.experimental,\n\t\t\t1: Mode.interception\n\t\t};\n\t}\n}\n\nexport type ModeOptions = {\n\tid: number,\n}","import {Type} from 'main.core';\nimport {DocumentOptions} from './document-options';\nimport {Helper} from '../helper';\n\nexport class Document\n{\n\t#id: number;\n\t#sessionId: string;\n\t#documentId: string;\n\t#dateExpire: Date;\n\n\t#documentSigned: string = '';\n\n\tconstructor(options: DocumentOptions)\n\t{\n\t\tthis.#id = parseInt(options.Id) >= 0 ? parseInt(options.Id) : 0;\n\t\tthis.#sessionId = Type.isStringFilled(options.SessionId) ? options.SessionId : '';\n\t\tthis.#documentId = Type.isStringFilled(options.DocumentId) ? options.DocumentId : '';\n\t\tthis.#dateExpire = Helper.toDate(options.DateExpire);\n\t\tif (options.DocumentSigned)\n\t\t{\n\t\t\tthis.documentSigned = options.DocumentSigned;\n\t\t}\n\t}\n\n\tget documentId(): string\n\t{\n\t\treturn this.#documentId;\n\t}\n\n\tget documentSigned(): string\n\t{\n\t\treturn this.#documentSigned;\n\t}\n\n\tset documentSigned(documentSigned: string)\n\t{\n\t\tthis.#documentSigned = Type.isStringFilled(documentSigned) ? documentSigned : '';\n\t}\n}","import {Type, ajax} from 'main.core';\nimport {SessionOptions} from './session-options';\nimport {Mode, ModeOptions} from './mode';\nimport {Document} from './document';\nimport {Helper} from '../helper';\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\nimport {Manager} from \"bizproc.debugger\";\n\nexport default class Session extends EventEmitter\n{\n\t#id: string = '';\n\t#mode: ModeOptions = {};\n\t#startedBy: number = 0;\n\t#active: boolean;\n\t#fixed: boolean;\n\t#documents: Array<Document> = [];\n\t#shortDescription: string = '';\n\n\t#documentSigned: string = '';\n\n\t#finished: boolean = false;\n\t#pullFinishHandler: Function;\n\n\tconstructor(options: SessionOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Debugger.Session');\n\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\n\t\tthis.#id = options.Id;\n\t\tthis.#setMode(options.Mode);\n\t\tthis.#startedBy = parseInt(options.StartedBy) >= 0 ? parseInt(options.StartedBy) : 0;\n\t\tthis.#shortDescription = String(options.ShortDescription);\n\t\tthis.#active = Boolean(options.Active);\n\t\tthis.#fixed = Boolean(options.Fixed);\n\n\t\tthis.#setDocuments(options.Documents);\n\n\t\tif (this.isActive())\n\t\t{\n\t\t\tthis.#pullFinishHandler = this.#handleExternalFinished.bind(this);\n\t\t\tManager.Instance.pullHandler.subscribe('sessionFinish', this.#pullFinishHandler);\n\t\t}\n\t}\n\n\tset documentSigned(documentSigned: string)\n\t{\n\t\tif (this.isFixed())\n\t\t{\n\t\t\tthis.activeDocument.documentSigned = documentSigned;\n\t\t}\n\n\t\tthis.#documentSigned = documentSigned;\n\t}\n\n\tget documentSigned(): string\n\t{\n\t\tif (this.activeDocument)\n\t\t{\n\t\t\tconst documentSigned = this.activeDocument.documentSigned;\n\t\t\tif (Type.isStringFilled(documentSigned))\n\t\t\t{\n\t\t\t\treturn documentSigned;\n\t\t\t}\n\t\t}\n\n\t\treturn this.#documentSigned;\n\t}\n\n\t#setMode(modeId: string | number)\n\t{\n\t\tmodeId = Helper.isNumeric(modeId) ? Number(modeId) : null;\n\n\t\tif (Mode.isMode(modeId))\n\t\t{\n\t\t\tthis.#mode = Mode.getMode(modeId);\n\t\t}\n\t}\n\n\t#setDocuments(documents: Array): this\n\t{\n\t\tif (Type.isArrayFilled(documents))\n\t\t{\n\t\t\tdocuments.forEach((document) => {\n\t\t\t\tthis.#documents.push(\n\t\t\t\t\tnew Document(document)\n\t\t\t\t);\n\t\t\t})\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tget id(): string\n\t{\n\t\treturn this.#id;\n\t}\n\n\tget startedBy(): number\n\t{\n\t\treturn this.#startedBy;\n\t}\n\n\tget activeDocument(): Document | null\n\t{\n\t\tif (this.#documents.length === 1)\n\t\t{\n\t\t\treturn this.#documents[0];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tget modeId(): number\n\t{\n\t\treturn this.#mode.id;\n\t}\n\n\tget shortDescription(): string\n\t{\n\t\treturn this.#shortDescription;\n\t}\n\n\tisActive(): boolean\n\t{\n\t\treturn this.#active;\n\t}\n\n\tisFixed(): boolean\n\t{\n\t\treturn this.#fixed;\n\t}\n\n\tisSessionStartedByUser(userId: number): boolean\n\t{\n\t\treturn this.startedBy === userId;\n\t}\n\n\tisAutomation(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\tstatic start(documentSigned: string, modeId: number): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runAction(\n\t\t\t\t'bizproc.debugger.startSession',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tdocumentSigned,\n\t\t\t\t\t\tmode: modeId,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then(\n\t\t\t\t(response) => {\n\t\t\t\t\tconst session = new Session(response.data.session);\n\t\t\t\t\tsession.documentSigned = response.data.documentSigned;\n\n\t\t\t\t\tresolve(session);\n\t\t\t\t},\n\t\t\t\treject\n\t\t\t)\n\t\t});\n\t}\n\n\tfinish(): Promise\n\t{\n\t\treturn ajax.runAction(\n\t\t\t'bizproc.debugger.finishDebugSession',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tsessionId: this.id,\n\t\t\t\t}\n\t\t\t}\n\t\t).then(response => {\n\t\t\tthis.#handleFinish();\n\n\t\t\treturn response;\n\t\t});\n\t}\n\n\t#handleExternalFinished(event: BaseEvent)\n\t{\n\t\tconst sessionId: string = event.getData().sessionId;\n\t\tif (sessionId === this.id)\n\t\t{\n\t\t\tthis.#handleFinish();\n\t\t}\n\t}\n\n\t#handleFinish()\n\t{\n\t\tif (!this.#finished)\n\t\t{\n\t\t\tthis.#finished = true;\n\t\t\tthis.emit('onFinished');\n\t\t\tthis.unsubscribeAll();\n\t\t\tif (this.#pullFinishHandler)\n\t\t\t{\n\t\t\t\tManager.Instance.pullHandler.unsubscribe('sessionFinish', this.#pullFinishHandler);\n\t\t\t\tthis.#pullFinishHandler = null;\n\t\t\t}\n\t\t}\n\t}\n}","export type TrackingRow = {\n\tId: number,\n\tWorkflowId: string,\n\tType: number,\n\tName: string,\n\tTitle: string,\n\tNote: string,\n\tDateTime: string,\n};\n\nexport class TrackingType\n{\n\tstatic Unknown = 0;\n\tstatic ExecuteActivity = 1;\n\tstatic CloseActivity = 2;\n\tstatic CancelActivity = 3;\n\tstatic FaultActivity = 4;\n\tstatic Custom = 5;\n\tstatic Report = 6;\n\tstatic AttachedEntity = 7;\n\tstatic Trigger = 8;\n\tstatic Error = 9;\n\tstatic Debug = 10;\n\tstatic DebugAutomation = 11;\n\tstatic DebugDesigner = 12;\n\tstatic DebugLink = 13;\n}","import {Loc, Tag, Text, Type, Dom} from 'main.core';\nimport {TrackingType} from \"./types\";\nimport {DelayInterval, DelayIntervalSelector, TrackingEntry} from \"bizproc.automation\";\nimport AutomationLogView from \"../views/automation-log\";\nimport {Helper} from \"../helper\";\n\nexport type RobotInfo = {\n\tname: string,\n\ttitle: string,\n\tdelayName: string | null;\n\tconditionNames: Array<string>\n};\n\nexport default class RobotLog\n{\n\t#robot: RobotInfo;\n\t#view: AutomationLogView;\n\n\t#currentNode: HTMLDivElement = null;\n\t#currentIndex: number = null;\n\n\t#isAfterPreviousRendered: boolean = false;\n\t#isPauseRendered: boolean = false;\n\t#isActivityBodyRendered: boolean = false;\n\n\t#prevRobotTitle: string = null;\n\n\tconstructor(view: AutomationLogView, robotInfo: RobotInfo)\n\t{\n\t\tthis.#view = view;\n\t\tthis.#robot = robotInfo;\n\t}\n\n\tget name(): string\n\t{\n\t\treturn this.#robot.name;\n\t}\n\n\tget title(): string\n\t{\n\t\treturn this.#robot.title;\n\t}\n\n\tget delayName(): string | null\n\t{\n\t\treturn this.#robot.delayName;\n\t}\n\n\tget conditionNames(): Array<string>\n\t{\n\t\treturn this.#robot.conditionNames;\n\t}\n\n\tgetActivitiesName(): Array<string>\n\t{\n\t\tlet names = [];\n\n\t\tif (this.name)\n\t\t{\n\t\t\tnames.push(this.name);\n\t\t}\n\n\t\tif (this.delayName)\n\t\t{\n\t\t\tnames.push(this.delayName);\n\t\t}\n\n\t\tnames = names.concat(this.conditionNames);\n\n\t\treturn names;\n\t}\n\n\tset previousRobotTitle(title: string)\n\t{\n\t\tthis.#prevRobotTitle = title;\n\t}\n\n\trenderTrack(track: TrackingEntry): void\n\t{\n\t\tconst excludedTypes = [TrackingType.ExecuteActivity, TrackingType.AttachedEntity];\n\t\tif (excludedTypes.includes(track.type))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (track.name === this.delayName)\n\t\t{\n\t\t\treturn this.#renderPause(track);\n\t\t}\n\n\t\tif (this.conditionNames.includes(track.name))\n\t\t{\n\t\t\tif (this.#isPauseRendered === false)\n\t\t\t{\n\t\t\t\tconst node = this.#getCurrentRobotNode(track);\n\t\t\t\tDom.append(this.#renderDelayInterval(new DelayInterval()), node);\n\t\t\t\tthis.#isPauseRendered = true;\n\t\t\t}\n\n\t\t\treturn this.#renderCondition(track);\n\t\t}\n\n\t\tif (track.name === this.name)\n\t\t{\n\t\t\tif (this.#isPauseRendered === false)\n\t\t\t{\n\t\t\t\tconst node = this.#getCurrentRobotNode(track);\n\t\t\t\tDom.append(this.#renderDelayInterval(new DelayInterval()), node);\n\t\t\t\tthis.#isPauseRendered = true;\n\t\t\t}\n\n\t\t\treturn this.#renderActivity(track);\n\t\t}\n\t}\n\n\t#getCurrentRobotNode(track: TrackingEntry): HTMLDivElement\n\t{\n\t\tif (this.#view.index !== this.#currentIndex)\n\t\t{\n\t\t\tconst node = Tag.render`\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-section\">\n\t\t\t\t\t${this.#renderRobotTitle(track.datetime)}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tif (Type.isStringFilled(this.#prevRobotTitle) && this.#isAfterPreviousRendered === false)\n\t\t\t{\n\t\t\t\tDom.append(this.#renderAfterPrevious(), node);\n\t\t\t}\n\n\t\t\tDom.append(node, this.#view.logNode);\n\n\t\t\tthis.#currentNode = node;\n\t\t}\n\n\t\treturn this.#currentNode;\n\t}\n\n\t#renderRobotTitle(time: string): HTMLDivElement\n\t{\n\t\tconst message = Loc.getMessage(\n\t\t\t'BIZPROC_JS_DEBUGGER_LOG_TITLE',\n\t\t\t{'#TITLE#' : this.title}\n\t\t);\n\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-section--row\">\n\t\t\t\t${this.#view.renderIndex()}\n\t\t\t\t${AutomationLogView.renderTime(time)}\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-section--title\">${Text.encode(message)}</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#currentIndex = this.#view.index;\n\n\t\treturn node;\n\t}\n\n\t#renderAfterPrevious(): HTMLDivElement\n\t{\n\t\tthis.#isAfterPreviousRendered = true;\n\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-section--row\">\n\t\t\t\t${this.#view.renderIndex()}\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-info\">\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__log-info--name\">\n\t\t\t\t\t\t<span class=\"bizproc-debugger-automation__log-info--name-text\">\n\t\t\t\t\t\t\t${Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_AFTER_PREVIOUS')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span>:</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__log-info--value\">\n\t\t\t\t\t\t<span class=\"bizproc-debugger-automation__log-color-box --blue\">\n\t\t\t\t\t\t\t\"${Text.encode(this.#prevRobotTitle)}\"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#currentIndex = this.#view.index;\n\n\t\treturn node;\n\t}\n\n\t// region Pause\n\t#renderPause(track: TrackingEntry): void\n\t{\n\t\tthis.#isPauseRendered = true;\n\n\t\tconst excludedTypes = [TrackingType.CloseActivity];\n\n\t\t// ignore\n\t\tif (excludedTypes.includes(track.type))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// delay Interval\n\t\tif (track.type === TrackingType.DebugAutomation)\n\t\t{\n\t\t\tconst node = this.#getCurrentRobotNode(track);\n\t\t\tconst note = JSON.parse(track.note);\n\n\t\t\treturn Dom.append(this.#renderDelayInterval(note), node);\n\t\t}\n\n\t\tconst node = this.#getCurrentRobotNode(track);\n\n\t\treturn Dom.append(this.#renderNote(track), node);\n\t}\n\n\t#renderDelayInterval(note ={}): HTMLDivElement\n\t{\n\t\tconst delayInterval = new DelayInterval(note);\n\t\tlet name = note.fieldName ?? (new DelayIntervalSelector()).getBasisField(delayInterval.basis, true).Name;\n\t\tname = name + ' [' + note.fieldValue + ']';\n\n\t\tconst delay = delayInterval.format(\n\t\t\tLoc.getMessage('BIZPROC_JS_DEBUGGER_LOG_DELAY_INTERVAL_AT_ONCE'),\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tSystemExpression: delayInterval.basis,\n\t\t\t\t\tName: name\n\t\t\t\t}\n\t\t\t]\n\t\t);\n\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-section--row\">\n\t\t\t\t${this.#view.renderIndex()}\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-info\">\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__log-info--name\">\n\t\t\t\t\t\t<span class=\"bizproc-debugger-automation__log-info--name-text\">\n\t\t\t\t\t\t\t${Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_DELAY_INTERVAL_RUN')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span>:</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__log-info--value\">\n\t\t\t\t\t\t<span class=\"bizproc-debugger-automation__log-color-box --dark-blue\">\n\t\t\t\t\t\t\t${Text.encode(delay)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#currentIndex = this.#view.index;\n\n\t\treturn node;\n\t}\n\t// endregion\n\n\t// region Condition\n\t#renderCondition(track: TrackingEntry): void\n\t{\n\t\tconst excludedTypes = [TrackingType.CloseActivity];\n\n\t\t// ignore\n\t\tif (excludedTypes.includes(track.type))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (track.type === TrackingType.DebugAutomation)\n\t\t{\n\t\t\tconst node = this.#getCurrentRobotNode(track);\n\n\t\t\treturn Dom.append(this.#renderConditions(track), node);\n\t\t}\n\n\t\tconst node = this.#getCurrentRobotNode(track);\n\n\t\treturn Dom.append(this.#renderNote(track), node);\n\t}\n\n\t#renderConditions(track: TrackingEntry): HTMLDivElement\n\t{\n\t\tconst note = JSON.parse(track.note);\n\n\t\tconst conditionNode = Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-info\">\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-info--name\">\n\t\t\t\t\t<span class=\"bizproc-debugger-automation__log-info--name-text\">\n\t\t\t\t\t\t${\n\t\t\t\t\t\t\tnote.result === 'Y'\n\t\t\t\t\t\t\t\t? Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION')\n\t\t\t\t\t\t\t\t: Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION_FALSE')\n\t\t\t\t\t\t}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span>:</span> \n\t\t\t\t</div> \n\t\t\t</div>\n\t\t`;\n\n\t\tObject.keys(note).forEach((key) => {\n\t\t\tif (key === 'result')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet colorCondition = '';\n\t\t\tif (note.result === note[key]['result'])\n\t\t\t{\n\t\t\t\tcolorCondition =\n\t\t\t\t\t(note.result === 'Y')\n\t\t\t\t\t\t? 'bizproc-debugger-automation__log-color-box --green'\n\t\t\t\t\t\t: 'bizproc-debugger-automation__log-color-box --orange'\n\t\t\t\t;\n\t\t\t}\n\n\t\t\tconst condition = note[key]['condition'];\n\t\t\tconst field = condition['field'];\n\t\t\tconst fieldValue =\n\t\t\t\t(note[key]['fieldValue'])\n\t\t\t\t\t? String(note[key]['fieldValue'])\n\t\t\t\t\t: ''\n\t\t\t;\n\t\t\tconst operator = Helper.getOperatorLabel(condition['operator']);\n\t\t\tconst value = condition['value'];\n\t\t\tconst joiner = Helper.getJoinerLabel(note[key]['joiner']);\n\n\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__log-info--value\">\n\t\t\t\t\t\t<span class=\"${colorCondition}\" >\n\t\t\t\t\t\t\t${(key === '0') ? '' : Text.encode(joiner) + ' '}\n\t\t\t\t\t\t\t${Text.encode(field) + ' '}\n\t\t\t\t\t\t\t${'[' + Text.encode(fieldValue) + '] '} \n\t\t\t\t\t\t\t${Text.encode(operator) + ' '} \n\t\t\t\t\t\t\t${Text.encode(value)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\tconditionNode\n\t\t\t);\n\t\t});\n\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-section--row\">\n\t\t\t\t${this.#view.renderIndex()}\n\t\t\t\t${conditionNode}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#currentIndex = this.#view.index;\n\n\t\treturn node;\n\t}\n\t// endregion\n\n\t// region Activity\n\t#renderActivity(track: TrackingEntry): void\n\t{\n\t\tif (track.type === TrackingType.CloseActivity)\n\t\t{\n\t\t\tif (this.#isActivityBodyRendered === false)\n\t\t\t{\n\t\t\t\tconst node = this.#getCurrentRobotNode(track);\n\n\t\t\t\treturn Dom.append(this.#renderActivityFinish(), node);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t// fields\n\t\tthis.#isActivityBodyRendered = true;\n\t\tconst node = this.#getCurrentRobotNode(track);\n\n\t\tconst renderedNote = this.#renderNote(track);\n\n\t\tDom.append(renderedNote, node);\n\n\t\tthis.#view.collapseInfoResults(renderedNote);\n\t}\n\n\t#renderActivityFinish(): HTMLDivElement\n\t{\n\t\t// tracking-track-2\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-section--row\">\n\t\t\t\t${this.#view.renderIndex()}\n\t\t\t\t<div class=\"bizproc-debugger-automation-log-section-robot-activity\">\n\t\t\t\t\t${Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_FINISH_WITHOUT_SETTINGS')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\t// endregion\n\n\t#renderNote(track: TrackingEntry): HTMLDivElement\n\t{\n\t\tif ([TrackingType.DebugAutomation, TrackingType.Debug].includes(track.type))\n\t\t{\n\t\t\treturn this.#renderDebugNote(track);\n\t\t}\n\n\t\tif ([TrackingType.DebugLink].includes(track.type))\n\t\t{\n\t\t\treturn this.#renderDebugLink(track);\n\t\t}\n\n\t\tconst colorBox =\n\t\t\t[TrackingType.CancelActivity, TrackingType.FaultActivity, TrackingType.Error].includes(track.type)\n\t\t\t\t? 'bizproc-debugger-automation__log-color-box --red'\n\t\t\t\t: ''\n\t\t;\n\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-section--row\">\n\t\t\t\t${this.#view.renderIndex()}\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-info--value --first\">\n\t\t\t\t\t<span class=\"${colorBox}\">\n\t\t\t\t\t\t${Text.encode(track.note).replace(/([^>])\\n/g, '$1<br>')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#currentIndex = this.#view.index;\n\n\t\treturn node;\n\t}\n\n\t#renderDebugNote(track: TrackingEntry): HTMLDivElement\n\t{\n\t\tconst note = JSON.parse(track.note);\n\n\t\tconst infoNode = Tag.render`<div class=\"bizproc-debugger-automation__log-info\"></div>`;\n\n\t\tif (note['propertyName'])\n\t\t{\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__log-info--name\">\n\t\t\t\t\t\t<span class=\"bizproc-debugger-automation__log-info--name-text\" title=\"${Text.encode(note['propertyName'])}\">\n\t\t\t\t\t\t\t${Text.encode(note['propertyName'])}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span>:</span>\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\tinfoNode\n\t\t\t);\n\t\t}\n\n\t\tDom.append(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-info--value ${note['propertyName'] ? '' : '--first'}\">\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__log--variable-height\" data-role=\"info-result\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t${note['propertyValue'] ? Text.encode(note['propertyValue']).replace(/([^>])\\n/g, '$1<br>') : ''}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div data-role=\"more-info-result\" style=\"display:none;\">\n\t\t\t\t\t\t<span class=\"bizproc-debugger-automation__log-info--more\">\n\t\t\t\t\t\t\t${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_MORE_INFORMATION'))}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`,\n\t\t\tinfoNode\n\t\t);\n\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-section--row\">\n\t\t\t\t${this.#view.renderIndex()}\n\t\t\t\t${infoNode}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#currentIndex = this.#view.index;\n\n\t\treturn node;\n\t}\n\n\t#renderDebugLink(track: TrackingEntry): HTMLDivElement\n\t{\n\t\tconst note = JSON.parse(track.note);\n\t\tconst infoNode = Tag.render`<div class=\"bizproc-debugger-automation__log-info\"></div>`;\n\t\tconst label = note['propertyLinkName'] || note['propertyValue'];\n\t\tconst link = note['propertyValue'];\n\n\t\tif (note['propertyName'])\n\t\t{\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__log-info--name\">\n\t\t\t\t\t\t<span class=\"bizproc-debugger-automation__log-info--name-text\" title=\"${Text.encode(note['propertyName'])}\">\n\t\t\t\t\t\t\t${Text.encode(note['propertyName'])}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span>:</span>\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\tinfoNode\n\t\t\t);\n\t\t}\n\n\t\tDom.append(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-info--value ${note['propertyName'] ? '' : '--first'}\">\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__log--variable-height\" data-role=\"info-result\">\n\t\t\t\t\t\t<a href=\"${Text.encode(link)}\" target=\"_blank\">\n\t\t\t\t\t\t\t${label}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`,\n\t\t\tinfoNode\n\t\t);\n\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-section--row\">\n\t\t\t\t${this.#view.renderIndex()}\n\t\t\t\t${infoNode}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#currentIndex = this.#view.index;\n\n\t\treturn node;\n\t}\n}","import AutomationLogView from \"../views/automation-log\";\nimport {TrackingEntry} from \"bizproc.automation\";\nimport {Dom, Loc, Tag, Text} from 'main.core';\nimport {TrackingType} from \"./types\";\nimport {Helper} from \"../helper\";\n\nexport default class TriggerLog\n{\n\t#view: AutomationLogView;\n\n\t#condition: {} = {};\n\t#title: string = '';\n\t#track: TrackingEntry = null;\n\n\tconstructor(view: AutomationLogView)\n\t{\n\t\tthis.#view = view;\n\t}\n\n\taddTrack(track: TrackingEntry): TriggerLog\n\t{\n\t\tif (track.type === TrackingType.DebugAutomation && track.name === 'TRIGGER_LOG')\n\t\t{\n\t\t\tthis.#condition = JSON.parse(track.note);\n\t\t\tthis.#title = track.title;\n\t\t\tthis.#track = track;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\trender()\n\t{\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-section\">\n\t\t\t\t${this.#renderTitle()}\n\t\t\t\t${this.#renderCondition()}\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-section--row\">\n\t\t\t\t\t${this.#view.renderIndex()}\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__log-info--value --first\">\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t${Text.encode(Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_TRIGGER_FINISH'))}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.append(node, this.#view.logNode);\n\t}\n\n\t#renderTitle(): HTMLDivElement | string\n\t{\n\t\tconst message = Loc.getMessage(\n\t\t\t'BIZPROC_JS_DEBUGGER_LOG_TRIGGER_TITLE',\n\t\t\t{'#TITLE#' : this.#title}\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-section--row\">\n\t\t\t\t${this.#view.renderIndex()}\n\t\t\t\t${AutomationLogView.renderTime(this.#track.datetime)}\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-section--title\">${Text.encode(message)}</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderCondition(): HTMLDivElement | string\n\t{\n\t\tif (!this.#condition || Object.keys(this.#condition).length <= 0)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst note = this.#condition;\n\n\t\tconst conditionNode = Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-info\">\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-info--name\">\n\t\t\t\t\t<span class=\"bizproc-debugger-automation__log-info--name-text\">\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_JS_DEBUGGER_LOG_CONDITION')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span>:</span> \n\t\t\t\t</div> \n\t\t\t</div>\n\t\t`;\n\n\t\tObject.keys(note).forEach((key) => {\n\t\t\tconst colorCondition = (note[key]['result'] === 'Y') ? 'bizproc-debugger-automation__log-color-box --green' : '';\n\n\t\t\tconst condition = note[key]['condition'];\n\t\t\t//const object = Helper.getFieldObjectLabel(condition['object']);\n\t\t\tconst field = condition['field'];\n\t\t\tconst fieldValue =\n\t\t\t\t(note[key]['fieldValue'])\n\t\t\t\t\t? String(note[key]['fieldValue'])\n\t\t\t\t\t: ''\n\t\t\t;\n\t\t\tconst operator = Helper.getOperatorLabel(condition['operator']);\n\t\t\tconst value = condition['value'];\n\t\t\tconst joiner = Helper.getJoinerLabel(note[key]['joiner']);\n\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__log-info--value\">\n\t\t\t\t\t\t<span class=\"${colorCondition}\" >\n\t\t\t\t\t\t\t${(key === '0') ? '' : (Text.encode(joiner) + ' ')}\n\t\t\t\t\t\t\t${Text.encode(field) + ' '}\n\t\t\t\t\t\t\t${'[' + Text.encode(fieldValue) + '] '}\n\t\t\t\t\t\t\t${Text.encode(operator) + ' '}\n\t\t\t\t\t\t\t${Text.encode(value)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\tconditionNode\n\t\t\t);\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-section--row\">\n\t\t\t\t${this.#view.renderIndex()}\n\t\t\t\t${conditionNode}\n\t\t\t</div>\n\t\t`;\n\t}\n}","import {Tag, Text, Type, Dom, Event, Loc} from 'main.core';\nimport RobotLog from \"../tracker/robot-log\";\nimport Automation from \"../automation\";\nimport {Robot, TrackingEntry, TrackingEntryBuilder, ViewMode} from 'bizproc.automation';\nimport {Helper} from \"../helper\";\nimport {BaseEvent} from \"main.core.events\";\nimport TriggerLog from \"../tracker/trigger-log\";\nimport 'ui.fonts.robotomono';\nimport {TrackingType} from \"../tracker/types\";\n\nexport default class AutomationLogView\n{\n\t#debuggerInstance: Automation = null;\n\t#workflowId: string;\n\n\t#activityRenderer = {};\n\n\t#documentStatus: string = '';\n\t#categoryName: string = '';\n\t#statusSettings: object;\n\n\t#node: HTMLDivElement = null;\n\t#index: number = 0;\n\t#trackId: number = 0;\n\n\t#poolTrack: Array<TrackingEntry> = [];\n\t#poolWorkflowRobots: object = {};\n\t#isRendering: boolean = true;\n\n\tstatic #NUMBER_OF_LINES_TO_SHOW_IN_PIXELS: number = 50; // 3 lines\n\t#shouldScrollToBottom: boolean = false;\n\t#shouldLoadPreviousLog: boolean = false;\n\n\tconstructor(debuggerInstance: Automation)\n\t{\n\t\tthis.#debuggerInstance = debuggerInstance;\n\t\tthis.#workflowId = this.debugger.workflowId;\n\n\t\tconst template = this.debugger.getTemplate();\n\t\tthis.initializeWorkflowRobotsRenderer(template ? template['ROBOTS'] : []);\n\n\t\tif (this.debugger.session.isActive())\n\t\t{\n\t\t\tthis.debugger.subscribe('onWorkflowTrackAdded', this.onTrackAdded.bind(this));\n\t\t\tthis.debugger.getMainView().subscribe('onChangeTab', this.#onChangeTab.bind(this));\n\n\t\t\tthis.debugger.session.subscribe('onFinished', this.#onSessionFinished.bind(this));\n\t\t}\n\t}\n\n\tget debugger(): Automation | null\n\t{\n\t\treturn this.#debuggerInstance;\n\t}\n\n\tget index(): number\n\t{\n\t\treturn this.#index;\n\t}\n\n\tget logNode(): HTMLDivElement | null\n\t{\n\t\tif (!this.#node)\n\t\t{\n\t\t\tthis.#node = Tag.render`<div data-role=\"log\" class=\"bizproc-debugger-tab__log\"></div>`;\n\t\t}\n\n\t\treturn this.#node;\n\t}\n\n\tinitializeWorkflowRobotsRenderer(workflowRobots: Array = [], workflowId: string = null)\n\t{\n\t\tif (!workflowId && ! this.#workflowId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isUndefined(this.#activityRenderer[workflowId ?? this.#workflowId]))\n\t\t{\n\t\t\tthis.#activityRenderer[workflowId ?? this.#workflowId] = {};\n\t\t}\n\n\t\tif (Type.isArrayFilled(workflowRobots))\n\t\t{\n\t\t\tlet prevRobotTitle = null;\n\n\t\t\tfor (let i = 0; i < workflowRobots.length; ++i)\n\t\t\t{\n\t\t\t\tconst robot = new Robot({});\n\t\t\t\trobot.init(workflowRobots[i], ViewMode.none());\n\n\t\t\t\tconst conditionNames = [];\n\t\t\t\tif (Type.isPlainObject(robot.data.Condition))\n\t\t\t\t{\n\t\t\t\t\tconditionNames.push(robot.data.Condition['activityNames']['Activity']);\n\t\t\t\t\tconditionNames.push(robot.data.Condition['activityNames']['Branch1']);\n\t\t\t\t\tconditionNames.push(robot.data.Condition['activityNames']['Branch2']);\n\t\t\t\t}\n\n\t\t\t\tconst robotLogger = new RobotLog(this, {\n\t\t\t\t\tname: robot.getId(),\n\t\t\t\t\ttitle: robot.getTitle(),\n\t\t\t\t\tdelayName: robot.data.DelayName ?? null,\n\t\t\t\t\tconditionNames: conditionNames\n\t\t\t\t});\n\n\t\t\t\tif (robot.isExecuteAfterPrevious() && prevRobotTitle)\n\t\t\t\t{\n\t\t\t\t\trobotLogger.previousRobotTitle = prevRobotTitle;\n\t\t\t\t}\n\n\t\t\t\tprevRobotTitle = robot.getTitle();\n\n\t\t\t\trobotLogger.getActivitiesName().forEach((activityName) => {\n\t\t\t\t\tthis.#activityRenderer[workflowId ?? this.#workflowId][activityName] = robotLogger;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t// region LOAD LOG\n\n\tshouldLoadPreviousLog(should: boolean): this\n\t{\n\t\tthis.#shouldLoadPreviousLog = should;\n\n\t\treturn this;\n\t}\n\n\t#loadPreviousLog(): Promise<this>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.debugger.loadAllLog()\n\t\t\t\t.then(\n\t\t\t\t\t(data) => {\n\t\t\t\t\t\tthis.#onAfterGetLog(data);\n\n\t\t\t\t\t\tresolve(this)\n\t\t\t\t\t},\n\t\t\t\t\t() => {resolve(this)}\n\t\t\t\t)\n\t\t\t;\n\t\t});\n\t}\n\n\t#loadWorkflowRobotsByWorkflowId(track)\n\t{\n\t\tthis.debugger.loadRobotsByWorkflowId(track.workflowId)\n\t\t\t.then(\n\t\t\t\t(data) => {\n\t\t\t\t\tthis.#poolWorkflowRobots[track.workflowId] = data.workflowRobots;\n\t\t\t\t\tthis.initializeWorkflowRobotsRenderer(this.#poolWorkflowRobots[track.workflowId], track.workflowId);\n\t\t\t\t\tthis.startRendering();\n\t\t\t\t},\n\t\t\t\t() => {\n\t\t\t\t\tthis.#poolWorkflowRobots[track.workflowId] = [];\n\t\t\t\t\tconsole.info('session has no workflowId from track:', track);\n\t\t\t\t\tthis.startRendering();\n\t\t\t\t}\n\t\t\t)\n\t\t;\n\t}\n\n\tsetPreviousLog(data = {logs: [], workflowRobots: {}}): this\n\t{\n\t\tthis.#onAfterGetLog(data);\n\n\t\treturn this;\n\t}\n\n\t#onAfterGetLog(data)\n\t{\n\t\tconst logFromDB = [];\n\t\tconst builder = new TrackingEntryBuilder();\n\n\t\tif (Type.isArrayFilled(data['logs']))\n\t\t{\n\t\t\tdata['logs'].forEach((item) => {\n\t\t\t\tlogFromDB.push(builder.setLogEntry(item).build());\n\t\t\t});\n\t\t}\n\n\t\tthis.#poolTrack = logFromDB.concat(this.#poolTrack);\n\t\tthis.#poolWorkflowRobots = Object.assign(data['workflowRobots'], this.#poolWorkflowRobots);\n\t}\n\n\t// endregion\n\n\t// region RENDER LOG\n\n\trender(): HTMLDivElement\n\t{\n\t\tif (this.logNode.children.length <= 0)\n\t\t{\n\t\t\tthis.#isRendering = true;\n\n\t\t\tif (this.#shouldLoadPreviousLog)\n\t\t\t{\n\t\t\t\tthis.#loadPreviousLog().then(() => {\n\t\t\t\t\tthis.startRendering();\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.startRendering();\n\t\t\t}\n\t\t}\n\n\t\treturn this.logNode;\n\t}\n\n\trenderTo(element: HTMLElement): this\n\t{\n\t\tDom.append(this.logNode, element);\n\t\tthis.#isRendering = true;\n\t\tthis.startRendering();\n\n\t\treturn this;\n\t}\n\n\tstartRendering()\n\t{\n\t\tconst track = this.#poolTrack.shift();\n\t\tif (Type.isUndefined(track))\n\t\t{\n\t\t\tthis.#isRendering = false;\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#workflowId !== track.workflowId)\n\t\t{\n\t\t\tif (Type.isUndefined(this.#activityRenderer[track.workflowId]))\n\t\t\t{\n\t\t\t\tif (Type.isUndefined(this.#poolWorkflowRobots[track.workflowId]))\n\t\t\t\t{\n\t\t\t\t\tthis.#loadWorkflowRobotsByWorkflowId(track);\n\n\t\t\t\t\tthis.renderTrack(track);\n\t\t\t\t\tthis.#workflowId = track.workflowId;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.initializeWorkflowRobotsRenderer(this.#poolWorkflowRobots[track.workflowId], track.workflowId);\n\t\t\t}\n\t\t}\n\n\t\tthis.renderTrack(track);\n\t\tthis.startRendering();\n\t}\n\n\t#renderStartDebugLog(track: TrackingEntry)\n\t{\n\t\tthis.#renderStartedDate(track);\n\t\tthis.#renderLegend(track);\n\t}\n\n\t#renderStartedDate(track: TrackingEntry)\n\t{\n\t\tconst startedDate = Helper.toDate(track.datetime);\n\n\t\tconst dateNode = Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log--date\">\n\t\t\t\t<div class=\"bizproc-debugger-automation__log--date-text\">${Text.encode(Helper.formatDate('j F Y', startedDate))}</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.append(dateNode, this.logNode);\n\t}\n\n\t#renderLegend(track: TrackingEntry)\n\t{\n\t\tconst description = JSON.parse(track.note)['propertyValue'];\n\n\t\t// separator <div class=\"bizproc-debugger-automation__log-separator\"></div>\n\n\t\tconst descriptionNode = Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-section\">\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-section--row\">\n\t\t\t\t\t${this.renderIndex()}\n\t\t\t\t\t${AutomationLogView.renderTime(track.datetime)}\n\t\t\t\t\t<div>${Text.encode(description)}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.append(descriptionNode, this.logNode);\n\t}\n\n\trenderIndex(): HTMLDivElement\n\t{\n\t\tthis.#index++;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log--index\" data-role=\"index\">${String(this.#index).padStart(3, '0')}</div>\n\t\t`;\n\t}\n\n\tstatic renderTime(datetime: string): HTMLDivElement\n\t{\n\t\tdatetime = Helper.toDate(datetime);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log--time\">\n\t\t\t\t[${Text.encode(Helper.formatDate('H:i:s', datetime))}]\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t// endregion\n\n\t// region status log\n\n\trenderStatusChange(track: TrackingEntry)\n\t{\n\t\tconst parsedTrackNote = JSON.parse(track.note);\n\t\tif (!Type.isStringFilled(this.#documentStatus))\n\t\t{\n\t\t\tthis.#documentStatus = parsedTrackNote['STATUS_ID'];\n\t\t\tthis.#statusSettings = parsedTrackNote;\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst sourceStage = this.getStatusSettings(this.#documentStatus);\n\t\tconst destinationStage = parsedTrackNote;\n\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"bizproc-debugger-automation__log-section\">\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-section--row\">\n\t\t\t\t\t${this.renderIndex()}\n\t\t\t\t\t${AutomationLogView.renderTime(track.datetime)}\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__status--change-info\">\n\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__status --log-status ${Helper.getBgColorAdditionalClass(sourceStage['COLOR'])}\" title=\"${Text.encode(sourceStage['NAME'])}\"> \n\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__status--title\">${Text.encode(sourceStage['NAME'])}</div>\n\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__status--bg\" style=\"background-color: ${sourceStage['COLOR']}; border-color: ${sourceStage['COLOR']};\">\n\t\t\t\t\t\t\t\t<span class=\"bizproc-debugger-automation__status--bg-arrow\"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__status--robot-change-arrow\"></div>\n\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__status --log-status ${Helper.getBgColorAdditionalClass(destinationStage['COLOR'])}\" title=\"${Text.encode(destinationStage['NAME'])}\"> \n\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__status--title\">${Text.encode(destinationStage['NAME'])}</div>\n\t\t\t\t\t\t\t<div class=\"bizproc-debugger-automation__status--bg\" style=\"background-color: ${destinationStage.COLOR}; border-color: ${destinationStage.COLOR};\">\n\t\t\t\t\t\t\t\t<span class=\"bizproc-debugger-automation__status--bg-arrow\"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.append(node, this.logNode);\n\n\t\tthis.#documentStatus = parsedTrackNote['STATUS_ID'];\n\t\tthis.#statusSettings = parsedTrackNote;\n\t}\n\n\tgetStatusSettings(): object\n\t{\n\t\tif (Type.isUndefined(this.#statusSettings))\n\t\t{\n\t\t\treturn {\n\t\t\t\tNAME: '',\n\t\t\t\tCOLOR: 'AEF2F9'\n\t\t\t};\n\t\t}\n\n\t\treturn this.#statusSettings;\n\t}\n\n\t#renderCategoryChange(track: TrackingEntry)\n\t{\n\t\tconst categoryName = JSON.parse(track.note)['propertyValue'];\n\t\tif (!Type.isStringFilled(this.#categoryName))\n\t\t{\n\t\t\tthis.#categoryName = categoryName;\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst descriptionNode = Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-separator\"></div>\n\t\t\t\t<div class=\"bizproc-debugger-automation__log-section\">\n\t\t\t\t\t<div class=\"bizproc-debugger-automation__log-section--row\">\n\t\t\t\t\t\t${this.renderIndex()}\n\t\t\t\t\t\t${AutomationLogView.renderTime(track.datetime)}\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t${Text.encode(Loc.getMessage(\n\t\t\t\t\t\t\t\t'BIZPROC_JS_DEBUGGER_CATEGORY_CHANGE',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t'#SOURCE_CATEGORY#': this.#categoryName,\n\t\t\t\t\t\t\t\t\t'#DESTINATION_CATEGORY#': categoryName\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.append(descriptionNode, this.logNode);\n\n\t\tthis.#categoryName = categoryName;\n\t}\n\n\t// endregion\n\n\t// region TRACK\n\tonTrackAdded(event: BaseEvent)\n\t{\n\t\tconst entryBuilder = new TrackingEntryBuilder();\n\t\tentryBuilder.setLogEntry(event.getData().row);\n\n\t\tthis.addTrack(entryBuilder.build());\n\t}\n\n\taddTrack(track: TrackingEntry): void {\n\t\tif (!this.#isRendering)\n\t\t{\n\t\t\treturn this.renderTrack(track);\n\t\t}\n\n\t\tthis.#poolTrack.push(track);\n\t}\n\n\trenderTrack(track: TrackingEntry)\n\t{\n\t\tif ((track.id <= this.#trackId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Object.keys(this.#activityRenderer[track.workflowId] ?? {}).includes(track.name))\n\t\t{\n\t\t\tif (track.name === 'SESSION_LEGEND')\n\t\t\t{\n\t\t\t\tthis.#renderStartDebugLog(track);\n\t\t\t\tthis.#trackId = track.id;\n\t\t\t}\n\t\t\telse if (track.name === 'STATUS_CHANGED')\n\t\t\t{\n\t\t\t\tthis.renderStatusChange(track);\n\t\t\t\tthis.#trackId = track.id;\n\t\t\t}\n\t\t\telse if (track.name === 'CATEGORY_CHANGED')\n\t\t\t{\n\t\t\t\tthis.#renderCategoryChange(track);\n\t\t\t\tthis.#trackId = track.id;\n\t\t\t}\n\t\t\telse if (track.name === 'TRIGGER_LOG')\n\t\t\t{\n\t\t\t\t(new TriggerLog(this)).addTrack(track).render();\n\t\t\t\tthis.#trackId = track.id;\n\t\t\t}\n\t\t\telse if (track.name === 'Template' && track.type === TrackingType.ExecuteActivity)\n\t\t\t{\n\t\t\t\tif (Type.isUndefined(this.#poolWorkflowRobots[track.workflowId]) && this.#isRendering === false)\n\t\t\t\t{\n\t\t\t\t\tthis.#isRendering = true;\n\n\t\t\t\t\tthis.#loadWorkflowRobotsByWorkflowId(track);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (track.name === 'Template' && track.type === TrackingType.CloseActivity)\n\t\t\t{\n\t\t\t\tthis.#clearWorkflowRobots(track.workflowId);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#activityRenderer[track.workflowId][track.name].renderTrack(track);\n\t\tthis.#trackId = track.id;\n\t}\n\t//endregion\n\n\t// region ON CHANGE TAB: scrollToBottom, collapseInfoResults\n\n\t#onChangeTab(event: BaseEvent)\n\t{\n\t\tif (event.getData().tab === 'log')\n\t\t{\n\t\t\tthis.collapseInfoResults();\n\n\t\t\tif (this.#shouldScrollToBottom)\n\t\t\t{\n\t\t\t\tthis.#scrollToBottom();\n\t\t\t\tthis.#shouldScrollToBottom = false; // scroll once\n\t\t\t}\n\t\t}\n\t}\n\n\tcollapseInfoResults(node?: HTMLElement): this\n\t{\n\t\tif (!node)\n\t\t{\n\t\t\tnode = this.logNode;\n\t\t}\n\n\t\tconst infoResults = node.querySelectorAll('[data-role=\"info-result\"]');\n\t\tinfoResults.forEach((infoNode) => {\n\t\t\tif (infoNode.firstElementChild.clientHeight > this.constructor.#NUMBER_OF_LINES_TO_SHOW_IN_PIXELS)\n\t\t\t{\n\t\t\t\tconst moreInfoNode = infoNode.parentNode.querySelector('[data-role=\"more-info-result\"]');\n\n\t\t\t\tEvent.bind(moreInfoNode, 'click', () => {\n\t\t\t\t\tDom.style(infoNode, 'height', infoNode.firstElementChild.clientHeight + 'px');\n\t\t\t\t\tDom.style(moreInfoNode, 'display', 'none');\n\t\t\t\t});\n\n\t\t\t\tEvent.bind(infoNode, 'transitionend', () => {\n\t\t\t\t\tDom.style(infoNode, 'height', null);\n\t\t\t\t});\n\n\t\t\t\tDom.style(infoNode, 'height', this.constructor.#NUMBER_OF_LINES_TO_SHOW_IN_PIXELS + 'px');\n\t\t\t\tDom.style(moreInfoNode, 'display', 'block');\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tshouldScrollToBottom(should: boolean): this\n\t{\n\t\tthis.#shouldScrollToBottom = should;\n\n\t\treturn this;\n\t}\n\n\t#scrollToBottom()\n\t{\n\t\tthis.logNode.parentNode.scrollTop = this.logNode.parentNode?.scrollHeight;\n\t}\n\n\t// endregion\n\n\t#clearWorkflowRobots(workflowId: string)\n\t{\n\t\tdelete this.#poolWorkflowRobots[workflowId];\n\t\tdelete this.#activityRenderer[workflowId];\n\t}\n\n\t#onSessionFinished()\n\t{\n\t\tthis.debugger.unsubscribe('onWorkflowTrackAdded', this.onTrackAdded.bind(this));\n\t\tthis.debugger.getMainView().unsubscribe('onChangeTab', this.#onChangeTab.bind(this));\n\t}\n}","import \"ls\";\n\nexport default class Settings\n{\n\t#ttl = 3 * 86400;\n\t#prefix = 'bp-atm-dbg-'\n\n\t#getName(name: string)\n\t{\n\t\treturn this.#prefix + name;\n\t}\n\n\tgetSet(name: string): Set\n\t{\n\t\tconst value = this.get(name);\n\n\t\treturn value instanceof Array ? new Set(value) : new Set();\n\t}\n\n\tget(name: string): any\n\t{\n\t\treturn BX.localStorage.get(this.#getName(name));\n\t}\n\n\tset(name: string, value: any): this\n\t{\n\t\tif (value instanceof Set)\n\t\t{\n\t\t\tvalue = Array.from(value);\n\t\t}\n\n\t\tBX.localStorage.set(this.#getName(name), value, this.#ttl);\n\n\t\treturn this;\n\t}\n}","import AutomationMainView from './views/automation-main';\nimport Session from './session/session';\nimport {ajax, Loc, Type} from \"main.core\";\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\nimport AutomationLogView from \"./views/automation-log\";\nimport {WorkflowStatus} from \"./workflow/types\";\nimport Settings from \"./settings\";\nimport {MessageBox, MessageBoxButtons} from \"ui.dialogs.messagebox\";\nimport {Manager} from \"./index\";\nimport { setGlobalContext, getGlobalContext, AutomationContext, Document } from 'bizproc.automation';\n\nexport default class Automation extends EventEmitter\n{\n\tsession: Session = null;\n\t#pullHandlers: ?[] = null;\n\n\t#settings: Settings;\n\n\t#mainView;\n\n\t#triggers: Array;\n\t#template: Array;\n\t#documentStatus: string;\n\t#statusList: Array;\n\t#documentCategoryId: Number = 0;\n\t#documentFields: Array;\n\t#documentValues: Object = {};\n\n\t#workflowId: string;\n\t#workflowStatus: number;\n\t#workflowEvents: Array = [];\n\t#workflowTrack: Array = [];\n\t#debuggerState: number;\n\n\tconstructor(parameters = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Debugger.Automation');\n\n\t\tthis.session = parameters.session;\n\n\t\tif (this.session.isActive())\n\t\t{\n\t\t\tthis.session.subscribe('onFinished', this.destroy.bind(this));\n\t\t\tthis.#subscribePull();\n\t\t}\n\n\t\tthis.#settings = new Settings();\n\t\tthis.#initAutomationContext();\n\t}\n\n\t#initAutomationContext()\n\t{\n\t\tconst context = new AutomationContext({\n\t\t\tdocument: new Document({\n\t\t\t\trawDocumentType: [],\n\t\t\t\tdocumentId: null,\n\t\t\t\tcategoryId: 0,\n\t\t\t\tstatusList: this.getStatusList(),\n\t\t\t\tstatusId: this.getDocumentStatus(),\n\t\t\t\tdocumentFields: this.getDocumentFields(),\n\t\t\t}),\n\t\t\tdocumentSigned: this.documentSigned,\n\t\t\tcanEdit: false,\n\t\t\tcanManage: false,\n\t\t});\n\n\t\tsetGlobalContext(context);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.unsubscribeAll();\n\t\tthis.#unsubscribePull();\n\n\t\tthis.#mainView?.destroy();\n\n\t\tthis.session = null;\n\t\tthis.#settings = null;\n\t\tthis.#mainView = null;\n\n\t\tthis.#template = [];\n\t\tthis.#documentStatus = null;\n\t\tthis.#statusList = [];\n\t\tthis.#documentFields = [];\n\t\tthis.#documentValues = {};\n\n\t\tthis.#workflowId = null;\n\t\tthis.#workflowStatus = 0;\n\t\tthis.#workflowEvents = [];\n\t\tthis.#workflowTrack = [];\n\t}\n\n\tget track()\n\t{\n\t\treturn this.#workflowTrack;\n\t}\n\n\tget settings(): Settings\n\t{\n\t\treturn this.#settings;\n\t}\n\n\tget documentSigned(): string\n\t{\n\t\treturn this.session.documentSigned;\n\t}\n\n\tget sessionId(): string\n\t{\n\t\treturn this.session.id;\n\t}\n\n\tget workflowId(): string\n\t{\n\t\treturn this.#workflowId;\n\t}\n\n\tget pullHandlers(): []\n\t{\n\t\tif (this.#pullHandlers === null)\n\t\t{\n\t\t\tthis.#pullHandlers = [\n\t\t\t\t{name: 'documentStatus', func: this.handleExternalDocumentStatus.bind(this)},\n\t\t\t\t{name: 'documentValues', func: this.handleExternalDocumentValues.bind(this)},\n\t\t\t\t{name: 'documentDelete', func: this.handleExternalDocumentDelete.bind(this)},\n\t\t\t\t{name: 'workflowStatus', func: this.handleExternalWorkflowStatus.bind(this)},\n\t\t\t\t{name: 'workflowEventAdd', func: this.handleExternalWorkflowEventAdd.bind(this)},\n\t\t\t\t{name: 'workflowEventRemove', func: this.handleExternalWorkflowEventRemove.bind(this)},\n\t\t\t\t{name: 'trackRow', func: this.handleExternalTrackRow.bind(this)},\n\t\t\t]\n\t\t}\n\t\treturn this.#pullHandlers;\n\t}\n\n\t#subscribePull()\n\t{\n\t\tconst pull = Manager.Instance.pullHandler;\n\n\t\tthis.pullHandlers.forEach(({name, func}) => {\n\t\t\tpull.subscribe(name, func);\n\t\t});\n\t}\n\n\t#unsubscribePull()\n\t{\n\t\tif (this.#pullHandlers === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst pull = Manager.Instance.pullHandler;\n\n\t\tthis.pullHandlers.forEach(({name, func}) => {\n\t\t\tpull.unsubscribe(name, func);\n\t\t});\n\n\t\tthis.#pullHandlers = null;\n\t}\n\n\tgetMainView(): AutomationMainView\n\t{\n\t\tif (!this.#mainView)\n\t\t{\n\t\t\tthis.#mainView = new AutomationMainView(this);\n\t\t}\n\n\t\treturn this.#mainView;\n\t}\n\n\tgetLogView(): AutomationLogView\n\t{\n\t\treturn new AutomationLogView(this);\n\t}\n\n\tgetStatusList(): Array\n\t{\n\t\treturn this.#statusList;\n\t}\n\n\tgetDocumentFields(): Array\n\t{\n\t\treturn this.#documentFields;\n\t}\n\n\tgetDocumentField(fieldId: string): null | {}\n\t{\n\t\treturn this.#documentFields.find((field) => field.Id === fieldId);\n\t}\n\n\tgetDocumentValue(fieldId: string): null | any\n\t{\n\t\treturn this.#documentValues[fieldId] || null;\n\t}\n\n\tgetDocumentStatus(): string\n\t{\n\t\treturn this.#documentStatus; //getActiveDocument().getStatus();\n\t}\n\n\tgetWorkflowStatus(): number\n\t{\n\t\treturn this.#workflowStatus;\n\t}\n\n\tgetState(): number\n\t{\n\t\treturn this.#debuggerState;\n\t}\n\n\thasWorkflowEvents(): boolean\n\t{\n\t\treturn this.#workflowEvents.length > 0;\n\t}\n\n\tsetDocumentStatus(statusId: string): Promise\n\t{\n\t\treturn new Promise(resolve => {\n\t\t\tajax.runAction(\n\t\t\t\t'bizproc.debugger.setDocumentStatus',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tstatusId: statusId,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then(\n\t\t\t\t(response) => {\n\n\t\t\t\t\tif (response.data && response.data.newStatus)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#documentStatus = response.data.newStatus;\n\t\t\t\t\t\tthis.#template = response.data.template;\n\t\t\t\t\t\tthis.#workflowTrack = [];\n\t\t\t\t\t\tthis.emit('onDocumentStatusChanged');\n\t\t\t\t\t}\n\t\t\t\t\tresolve(response);\n\t\t\t\t},\n\t\t\t\tthis.#handleRejectResponse.bind(this)\n\t\t\t);\n\t\t});\n\t}\n\n\tget templateTriggers(): Array\n\t{\n\t\treturn this.#triggers.filter(trigger => trigger['DOCUMENT_STATUS'] === this.#template['DOCUMENT_STATUS']);\n\t}\n\n\tgetTemplate(): Array\n\t{\n\t\treturn this.#template;\n\t}\n\n\tisTemplateEmpty(): boolean\n\t{\n\t\treturn this.#template.IS_EXTERNAL_MODIFIED === false && !Type.isArrayFilled(this.#template.ROBOTS)\n\t}\n\n\tstartDebugTemplate(): Promise\n\t{\n\t\treturn new Promise(resolve => {\n\t\t\tajax.runAction(\n\t\t\t\t'bizproc.debugger.resumeAutomationTemplate',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsessionId: this.sessionId,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then(\n\t\t\t\t(response) => {\n\n\t\t\t\t\tthis.#workflowId = response.data.workflowId;\n\t\t\t\t\tthis.#debuggerState = response.data.debuggerState;\n\n\t\t\t\t\tresolve(response.data);\n\t\t\t\t},\n\t\t\t\tthis.#handleRejectResponse.bind(this));\n\t\t});\n\t}\n\n\temulateExternalEvent()\n\t{\n\t\treturn new Promise(resolve => {\n\t\t\tconst eventId = this.#workflowEvents[0];\n\n\t\t\tif (!eventId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tajax.runAction(\n\t\t\t\t'bizproc.debugger.emulateExternalEvent',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tworkflowId: this.#workflowId,\n\t\t\t\t\t\teventId,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then(\n\t\t\t\t(response) => {\n\n\t\t\t\tresolve(response.data)\n\t\t\t\t},\n\t\t\t\tthis.#handleRejectResponse.bind(this)\n\t\t\t);\n\t\t});\n\t}\n\n\tloadMainViewInfo(): Promise\n\t{\n\t\treturn new Promise(resolve => {\n\t\t\tajax.runAction(\n\t\t\t\t'bizproc.debugger.fillAutomationView',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsessionId: this.sessionId,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then(\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tthis.#triggers = response.data.triggers;\n\t\t\t\t\tthis.#template = response.data.template;\n\t\t\t\t\tthis.#documentStatus = response.data.documentStatus;\n\t\t\t\t\tthis.#statusList = response.data.statusList;\n\t\t\t\t\tthis.#documentCategoryId = response.data.documentCategoryId;\n\t\t\t\t\tthis.#documentFields = response.data.documentFields;\n\t\t\t\t\tthis.#documentValues = response.data.documentValues;\n\n\t\t\t\t\tthis.#workflowId = response.data.workflowId;\n\t\t\t\t\tthis.#workflowStatus = response.data.workflowStatus;\n\t\t\t\t\tthis.#workflowEvents = response.data.workflowEvents;\n\t\t\t\t\tthis.#workflowTrack = response.data.track;\n\t\t\t\t\tthis.#debuggerState = response.data.debuggerState;\n\n\t\t\t\t\tgetGlobalContext().document\n\t\t\t\t\t\t.setFields(this.getDocumentFields())\n\t\t\t\t\t\t.setStatusList(this.getStatusList())\n\t\t\t\t\t\t.setStatus(this.getDocumentStatus())\n\t\t\t\t\t;\n\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\tthis.#handleRejectResponse.bind(this)\n\t\t\t);\n\t\t});\n\t}\n\n\tloadAllLog(): Promise\n\t{\n\t\treturn new Promise(resolve => {\n\t\t\tajax.runAction(\n\t\t\t\t'bizproc.debugger.loadAllLog',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsessionId: this.session.id,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then(\n\t\t\t\t(response) => {\n\t\t\t\t\tresolve(response.data);\n\t\t\t\t},\n\t\t\t\tthis.#handleRejectResponse.bind(this)\n\t\t\t);\n\t\t});\n\t}\n\n\tloadRobotsByWorkflowId(workflowId: string): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runAction(\n\t\t\t\t'bizproc.debugger.loadRobotsByWorkflowId',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsessionId: this.sessionId,\n\t\t\t\t\t\tworkflowId\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).then(\n\t\t\t\t(response) => {\n\t\t\t\t\tresolve(response.data);\n\t\t\t\t},\n\t\t\t\t(response) => {\n\t\t\t\t\treject(response.data);\n\t\t\t\t\t//this.#handleRejectResponse.bind(this);\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\thandleExternalDocumentStatus(event: BaseEvent)\n\t{\n\t\tconst status: string = event.getData().status;\n\n\t\tif (this.getDocumentStatus() === status)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.info('document status: ' + status);\n\n\t\t//this.#documentStatus = status\n\t\t//TODO - don`t load all\n\n\t\tthis.loadMainViewInfo().then(() => {\n\t\t\tthis.emit('onDocumentStatusChanged');\n\t\t});\n\t}\n\n\thandleExternalDocumentValues(event: BaseEvent)\n\t{\n\t\tconst values: {} = event.getData().values;\n\n\t\tObject.keys(values).forEach((key) => this.#documentValues[key] = values[key]);\n\n\t\tconsole.info('document values: ' + Object.keys(values));\n\n\t\tthis.emit('onDocumentValuesUpdated', {values});\n\t}\n\n\thandleExternalDocumentDelete()\n\t{\n\t\tMessageBox.show({\n\t\t\tmessage: Loc.getMessage('BIZPROC_JS_DEBUGGER_CONFIRM_ON_DOCUMENT_DELETE'),\n\t\t\tokCaption: Loc.getMessage('BIZPROC_JS_DEBUGGER_VIEWS_MENU_FINISH_SESSION'),\n\t\t\tonOk: () => {\n\t\t\t\treturn Manager.Instance.finishSession(this.session).then(\n\t\t\t\t\tnull,\n\t\t\t\t\tthis.#handleRejectResponse.bind(this)\n\t\t\t\t);\n\t\t\t},\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t});\n\t}\n\n\t#handleRejectResponse(response)\n\t{\n\t\tif (Type.isArrayFilled(response.errors))\n\t\t{\n\t\t\tconst noDocumentError = response.errors.find((error) => error.code === 404);\n\n\t\t\tif (noDocumentError)\n\t\t\t{\n\t\t\t\tthis.handleExternalDocumentDelete();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst message = response.errors.map(error => error.message).join('\\n');\n\n\t\t\t\tMessageBox.alert(message);\n\t\t\t}\n\t\t}\n\t}\n\n\thandleExternalTrackRow(event: BaseEvent)\n\t{\n\t\tconst row: {} = event.getData().row;\n\t\trow['WORKFLOW_STATUS'] = this.#workflowStatus;\n\n\t\tthis.#workflowTrack.push(row);\n\n\t\tthis.emit('onWorkflowTrackAdded', {row});\n\t}\n\n\thandleExternalWorkflowStatus(event: BaseEvent)\n\t{\n\t\tconst status: WorkflowStatus = event.getData().status;\n\t\tconst workflowId: string = event.getData().workflowId;\n\n\t\tthis.#workflowStatus = status;\n\n\t\tif (status === WorkflowStatus.Running)\n\t\t{\n\t\t\tthis.#workflowId = workflowId;\n\t\t}\n\n\t\tif (this.#workflowId !== workflowId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.info('workflow status: ' + status);\n\t\tthis.emit('onWorkflowStatusChanged', {status, workflowId});\n\t}\n\n\thandleExternalWorkflowEventAdd(event: BaseEvent)\n\t{\n\t\tconst eventName: string = event.getData().eventName;\n\n\t\tconsole.info('workflow event added: ' + eventName);\n\t\tthis.#workflowEvents.push(eventName);\n\t\tconsole.info('workflow events: ' + this.#workflowEvents.join(', '));\n\t\tthis.emit('onWorkflowEventsChanged', {events: this.#workflowEvents});\n\t}\n\n\thandleExternalWorkflowEventRemove(event: BaseEvent)\n\t{\n\t\tconst eventName: string = event.getData().eventName;\n\n\t\tconsole.info('workflow event removed: ' + eventName);\n\t\tthis.#workflowEvents = this.#workflowEvents.filter(value => value !== eventName);\n\t\tconsole.info('workflow events: ' + this.#workflowEvents.join(', '));\n\t\tthis.emit('onWorkflowEventsChanged', {events: this.#workflowEvents});\n\t}\n\n\tgetField(object, id): object\n\t{\n\t\tlet field;\n\n\t\tswitch (object)\n\t\t{\n\t\t\tcase 'Document':\n\t\t\t\tfield = this.#documentFields.find((field) => field.Id === id);\n\t\t\t\tbreak;\n\t\t\tcase 'Template':\n\t\t\tcase 'Parameter':\n\t\t\tcase 'Constant':\n\t\t\tcase 'GlobalConst':\n\t\t\tcase 'GlobalVar':\n\t\t\t\t// todo: parameter, variable, constant, GlobalConst, GlobalVar, Activity\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn field || {\n\t\t\tId: id,\n\t\t\tObjectId: object,\n\t\t\tName: id,\n\t\t\tType: 'string',\n\t\t\tExpression: id,\n\t\t\tSystemExpression: '{='+object+':'+id+'}'\n\t\t};\n\t}\n\n\tgetSettingsUrl(): string\n\t{\n\t\t//TODO: get actual url\n\t\treturn `/crm/deal/automation/${this.#documentCategoryId}/`;\n\t}\n}","import {Type} from 'main.core';\nimport {PULL} from \"pull.client\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport class CommandHandler extends EventEmitter\n{\n\t#unsubscribe: CallableFunction;\n\t#commands = [\n\t\t'documentStatus',\n\t\t'documentValues',\n\t\t'documentDelete',\n\t\t//workflow\n\t\t'workflowStatus',\n\t\t'workflowEventAdd',\n\t\t'workflowEventRemove',\n\t\t//track\n\t\t'trackRow',\n\t\t//session\n\t\t'sessionFinish'\n\t];\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Debugger.Pull');\n\n\t\tthis.#unsubscribe = PULL.subscribe(this);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (Type.isFunction(this.#unsubscribe))\n\t\t{\n\t\t\tthis.#unsubscribe();\n\t\t}\n\n\t\tthis.#unsubscribe = null;\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'bizproc';\n\t}\n\n\tgetSubscriptionType()\n\t{\n\t\treturn BX.PullClient.SubscriptionType.Server;\n\t}\n\n\tgetMap()\n\t{\n\t\tconst map = {};\n\t\tthis.#commands.forEach(command => {\n\t\t\tmap[command] = this.#handleCommand.bind(this);\n\t\t});\n\n\t\treturn map;\n\t}\n\n\t#handleCommand(params, extra, command)\n\t{\n\t\tthis.emit(command, params);\n\t}\n}","import {Type} from 'main.core';\nimport Automation from \"./automation\";\nimport Session from './session/session';\nimport {CommandHandler} from \"./pull/command-handler\";\n\nlet instance = null;\n\nexport default class Manager\n{\n\tpullHandler: CommandHandler;\n\n\tstatic get Instance(): Manager\n\t{\n\t\tif (instance === null)\n\t\t{\n\t\t\tinstance = new Manager();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.pullHandler = new CommandHandler();\n\t}\n\n\tinitializeDebugger(parameters = {session: {}, documentSigned: ''})\n\t{\n\t\tconst session = Type.isPlainObject(parameters.session) ? new Session(parameters.session) : null;\n\t\tif (!session)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tsession.documentSigned = parameters.documentSigned;\n\n\t\tthis.#showDebugger(session);\n\t}\n\n\tstartSession(documentSigned: string, modeId: number): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tSession.start(documentSigned, modeId).then(\n\t\t\t\t(session: Session) => {\n\t\t\t\t\tthis.setDebugFilter();\n\t\t\t\t\tthis.#showDebugger(session, true);\n\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\treject\n\t\t\t);\n\t\t});\n\t}\n\n\tfinishSession(session: Session): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tsession.finish().then(\n\t\t\t\t(response) => {\n\t\t\t\t\tthis.removeDebugFilter();\n\t\t\t\t\tresolve(response);\n\t\t\t\t},\n\t\t\t\treject\n\t\t\t);\n\t\t});\n\t}\n\n\t#showDebugger(session: Session, expanded: boolean = false)\n\t{\n\t\tlet debuggerInstance = null;\n\n\t\tif (session.isAutomation())\n\t\t{\n\t\t\tdebuggerInstance = this.createAutomationDebugger({\n\t\t\t\tsession: session\n\t\t\t});\n\t\t}\n\n\t\tif (debuggerInstance)\n\t\t{\n\t\t\tdebuggerInstance.getMainView()[expanded? 'showExpanded' : 'show']();\n\t\t}\n\t}\n\n\tsetDebugFilter()\n\t{\n\t\tconst filters = BX.Main.filterManager?.getList();\n\t\tif (!filters)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfilters.forEach((filter) => {\n\t\t\tconst api = filter.getApi();\n\t\t\tapi.setFilter({preset_id: 'filter_robot_debugger'});\n\t\t});\n\t}\n\n\tremoveDebugFilter()\n\t{\n\t\tconst filters = BX.Main.filterManager?.getList();\n\t\tif (!filters)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfilters.forEach((filter) => {\n\t\t\tconst api = filter.getApi();\n\t\t\tapi.setFilter({preset_id: 'default_filter'});\n\t\t});\n\t}\n\n\tcreateAutomationDebugger(parameters = {}): Automation\n\t{\n\t\treturn new Automation(parameters);\n\t}\n\n\topenDebuggerStartPage(documentSigned: string): Promise\n\t{\n\t\tconst url = BX.Uri.addParam(\n\t\t\t'/bitrix/components/bitrix/bizproc.debugger.start/',\n\t\t\t{\n\t\t\t\tdocumentSigned: documentSigned\n\t\t\t}\n\t\t);\n\n\t\tconst options = {\n\t\t\twidth: 745,\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: true,\n\t\t\tevents: {},\n\t\t};\n\n\t\treturn Manager.openSlider(url, options);\n\t}\n\n\topenSessionLog(sessionId: string): Promise\n\t{\n\t\tconst url = BX.Uri.addParam(\n\t\t\t'/bitrix/components/bitrix/bizproc.debugger.log/',\n\t\t\t{\n\t\t\t\t'setTitle': 'Y',\n\t\t\t\t'sessionId': sessionId,\n\t\t\t}\n\t\t);\n\n\t\tconst options = {\n\t\t\twidth: 720,\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: true,\n\t\t\tevents: {},\n\t\t\tnewWindowLabel: true\n\t\t};\n\n\t\treturn Manager.openSlider(url, options);\n\t}\n\n\tstatic openSlider(url, options): Promise\n\t{\n\t\tif(!Type.isPlainObject(options))\n\t\t{\n\t\t\toptions = {};\n\t\t}\n\t\toptions = {...{cacheable: false, allowChangeHistory: true, events: {}}, ...options};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (Type.isStringFilled(url))\n\t\t\t{\n\t\t\t\tif (BX.SidePanel.Instance.open(url, options))\n\t\t\t\t{\n\t\t\t\t\treturn resolve();\n\t\t\t\t}\n\n\t\t\t\treturn reject();\n\t\t\t}\n\n\t\t\treturn reject();\n\t\t});\n\t}\n}\n","import Manager from \"./manager\";\nimport Session from './session/session';\nimport {Mode} from './session/mode';\nimport 'ui.fonts.opensans';\nimport 'ui.design-tokens';\n\nconst Debugger = {\n\tManager,\n\tSession,\n\tMode,\n};\n\nexport {\n\tDebugger,\n\tManager,\n\tSession,\n\tMode,\n}"],"names":["WorkflowStatus","Created","Running","Completed","Suspended","Terminated","DebuggerState","Run","NextStep","Stop","Pause","Undefined","Helper","isNumeric","num","Type","isNumber","isStringFilled","Number","toString","trim","isDate","date","Date","getTime","convertDateFromDB","toDate","parse","formatDate","format","DateTimeFormat","getOperatorsLabel","Loc","getMessage","getOperatorLabel","operator","getJoinerLabel","joiner","joiners","getColorBrightness","bgColor","replace","bigint","parseInt","r","g","b","getBgColorAdditionalClass","brightness","AutomationMainView","EventEmitter","constructor","debuggerInstance","setEventNamespace","subscribe","bind","debugger","show","loadMainViewInfo","then","setContent","getState","showExpanded","settings","set","close","destroy","collapsed","get","Popup","className","titleBar","noAllPaddings","contentBackground","draggable","zIndexOptions","alwaysOnTop","width","height","events","onResizeStart","setMinWidth","setMinHeight","onResizeEnd","getWidth","getHeight","setResizeMode","Math","max","content","Tag","render","document","createTextNode","node","getPopupContainer","Dom","hasClass","getZIndexComponent","setAlwaysOnTop","toggleClass","clearTimeout","addClass","setWidth","setHeight","setTimeout","removeClass","MessageBox","message","okCaption","onOk","Manager","Instance","finishSession","session","buttons","MessageBoxButtons","OK_CANCEL","HelpHint","bindAll","hasFields","getSet","size","hasRobots","isTemplateEmpty","activeTab","tabDocClass","tabLogClass","Text","encode","getSettingsUrl","openSessionLog","sessionId","getLogView","shouldScrollToBottom","shouldLoadPreviousLog","Button","ButtonSize","EXTRA_SMALL","color","ButtonColor","PRIMARY","round","noCaps","text","onclick","form","fields","forEach","value","append","event","activeTabName","target","dataset","tabItem","hiddenTabName","filter","tabName","navigationNode","querySelector","querySelectorAll","tab","emit","button","documentFields","getDocumentFields","selectedFields","fieldsDialog","EntitySelector","Dialog","targetNode","multiple","dropdownMode","enableSearch","cacheable","items","field","Watchable","map","title","Name","id","Id","customData","entityId","tabs","selected","has","showAvatars","getData","item","getId","compactView","getCustomData","fieldNode","add","fieldId","delete","remove","contentNode","isString","getDocumentField","getDocumentValue","hasTriggers","templateTriggers","length","documentStatus","getTemplate","DOCUMENT_STATUS","Tracker","getGlobalContext","logs","track","init","tracker","triggers","TriggerManager","TRIGGERS","ViewMode","view","templateData","template","Template","constants","variables","templateContainerNode","delayMinLimitM","intoRaw","newTemplate","isNil","icon","ButtonIcon","START","hasEvents","hasWorkflowEvents","setWaiting","startDebugTemplate","infoNode","emulateExternalEvent","data","getDocumentStatus","reInit","preventDefault","statusList","getStatusList","menu","Menu","bindElement","stage","NAME","statusId","getMenuWindow","setDocumentStatus","status","find","TITLE","COLOR","isShown","statusTitleNode","statusTitle","textContent","parentNode","setAttribute","statusBgNode","style","backgroundColor","borderColor","documentStatusNode","automationContentNode","prepend","triggersHeaderNode","tplNode","values","Object","keys","key","valueNode","workflowId","includes","state","setIcon","PAUSE","getContainer","nextElementSibling","Mode","isMode","modeId","getMode","experimental","interception","getAllModes","Document","options","SessionId","DocumentId","DateExpire","DocumentSigned","documentSigned","documentId","Session","isPlainObject","StartedBy","String","ShortDescription","Boolean","Active","Fixed","Documents","isActive","pullHandler","isFixed","activeDocument","startedBy","shortDescription","isSessionStartedByUser","userId","isAutomation","start","Promise","resolve","reject","ajax","runAction","mode","response","finish","documents","isArrayFilled","push","unsubscribeAll","unsubscribe","TrackingType","Unknown","ExecuteActivity","CloseActivity","CancelActivity","FaultActivity","Custom","Report","AttachedEntity","Trigger","Error","Debug","DebugAutomation","DebugDesigner","DebugLink","RobotLog","robotInfo","name","delayName","conditionNames","getActivitiesName","names","concat","previousRobotTitle","renderTrack","excludedTypes","type","DelayInterval","index","datetime","logNode","time","renderIndex","AutomationLogView","renderTime","note","JSON","delayInterval","fieldName","DelayIntervalSelector","getBasisField","basis","fieldValue","delay","SystemExpression","conditionNode","result","colorCondition","condition","renderedNote","collapseInfoResults","colorBox","label","link","TriggerLog","addTrack","initializeWorkflowRobotsRenderer","onTrackAdded","getMainView","workflowRobots","isUndefined","prevRobotTitle","i","robot","Robot","none","Condition","robotLogger","getTitle","DelayName","isExecuteAfterPrevious","activityName","should","setPreviousLog","children","startRendering","renderTo","element","shift","padStart","renderStatusChange","parsedTrackNote","sourceStage","getStatusSettings","destinationStage","entryBuilder","TrackingEntryBuilder","setLogEntry","row","build","infoResults","firstElementChild","clientHeight","moreInfoNode","Event","loadAllLog","loadRobotsByWorkflowId","console","info","logFromDB","builder","assign","startedDate","dateNode","description","descriptionNode","categoryName","scrollTop","scrollHeight","Settings","Array","Set","BX","localStorage","from","Automation","parameters","pullHandlers","func","handleExternalDocumentStatus","handleExternalDocumentValues","handleExternalDocumentDelete","handleExternalWorkflowStatus","handleExternalWorkflowEventAdd","handleExternalWorkflowEventRemove","handleExternalTrackRow","getWorkflowStatus","newStatus","trigger","IS_EXTERNAL_MODIFIED","ROBOTS","debuggerState","eventId","documentCategoryId","documentValues","workflowStatus","workflowEvents","setFields","setStatusList","setStatus","eventName","join","getField","object","ObjectId","Expression","context","AutomationContext","rawDocumentType","categoryId","canEdit","canManage","setGlobalContext","pull","errors","noDocumentError","error","code","alert","CommandHandler","PULL","isFunction","getModuleId","getSubscriptionType","PullClient","SubscriptionType","Server","getMap","command","params","extra","instance","initializeDebugger","startSession","setDebugFilter","removeDebugFilter","filters","Main","filterManager","getList","api","getApi","setFilter","preset_id","createAutomationDebugger","openDebuggerStartPage","url","Uri","addParam","allowChangeHistory","openSlider","newWindowLabel","SidePanel","open","expanded","Debugger"],"mappings":"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"}