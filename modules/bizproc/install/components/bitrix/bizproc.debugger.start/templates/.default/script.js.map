{"version":3,"file":"script.js","sources":["src/index.js"],"sourcesContent":["import {Dom, Event, Reflection, Type, Text} from 'main.core';\nimport {MessageBox } from 'ui.dialogs.messagebox';\nimport {Mode, Session} from 'bizproc.debugger';\nimport './css/style.css';\n\nconst namespace = Reflection.namespace('BX.Bizproc.Component');\n\nclass DebuggerStartComponent\n{\n\t#documentSigned: string = '';\n\t#activeSession: Session | null = null;\n\n\tconstructor(options)\n\t{\n\t\tthis.#documentSigned = options.documentSigned;\n\t\tthis.#activeSession = options.activeSession ? new Session(options.activeSession) : null;\n\t}\n\n\tinit()\n\t{\n\t\tif (this.#activeSession)\n\t\t{\n\t\t\tthis.#disableButtons();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#initEvents();\n\t\t}\n\t}\n\n\tget buttons(): object\n\t{\n\t\tconst buttons = {};\n\t\tbuttons[Mode.experimental.id] = document.getElementById('bizproc-debugger-start-experimental-element');\n\n\t\treturn buttons;\n\t}\n\n\t#disableButtons()\n\t{\n\t\tconst buttons = this.buttons;\n\t\tObject.keys(buttons).forEach(key => {\n\t\t\tDom.addClass(buttons[key], 'ui-btn-disabled');\n\t\t\tDom.attr(buttons[key],'title', Text.encode(this.#activeSession?.shortDescription));\n\t\t});\n\t}\n\n\t#enableButtons()\n\t{\n\t\tconst buttons = this.buttons;\n\t\tObject.keys(buttons).forEach(key => {\n\t\t\tDom.removeClass(buttons[key], 'ui-btn-disabled');\n\t\t});\n\t}\n\n\t#initEvents()\n\t{\n\t\tconst buttons = this.buttons;\n\t\tObject.keys(buttons).forEach(key => {\n\t\t\tEvent.bind(buttons[key], 'click', () => {\n\t\t\t\tthis.#onStartSessionClick(buttons[key], key);\n\t\t\t});\n\t\t});\n\t}\n\n\t#onStartSessionClick(btn: HTMLButtonElement, modeId: number)\n\t{\n\t\ttop.BX.Runtime.loadExtension('bizproc.debugger')\n\t\t\t.then((exports) => {\n\t\t\t\tthis.#disableButtons();\n\t\t\t\tDom.addClass(btn, 'ui-btn-wait');\n\n\t\t\t\tconst {Manager} = exports;\n\t\t\t\tManager.Instance.startSession(this.#documentSigned, modeId)\n\t\t\t\t\t.then(\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tthis.#enableButtons();\n\t\t\t\t\t\t\tBX.SidePanel.Instance.closeAll();\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tif (Type.isArrayFilled(response.errors))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet message = '';\n\t\t\t\t\t\t\t\tresponse.errors.forEach((error)=>{\n\t\t\t\t\t\t\t\t\tmessage = message + '\\n' + error.message;\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tMessageBox.alert(\n\t\t\t\t\t\t\t\t\tmessage,\n\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\tthis.#enableButtons();\n\t\t\t\t\t\t\t\t\t\tDom.removeClass(btn, 'ui-btn-wait');\n\n\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t;\n\t\t\t}\n\t\t);\n\t}\n}\n\nnamespace.DebuggerStartComponent = DebuggerStartComponent;"],"names":["namespace","Reflection","DebuggerStartComponent","options","documentSigned","activeSession","Session","buttons","Mode","experimental","id","document","getElementById","Object","keys","forEach","key","Dom","addClass","attr","Text","encode","shortDescription","removeClass","Event","bind","btn","modeId","top","BX","Runtime","loadExtension","then","exports","Manager","Instance","startSession","SidePanel","closeAll","response","Type","isArrayFilled","errors","message","error","MessageBox","alert"],"mappings":"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"}