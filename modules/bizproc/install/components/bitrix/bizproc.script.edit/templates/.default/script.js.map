{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Type, Event, Tag, Dom, Text, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {UI} from 'ui.notification';\n\nconst namespace = Reflection.namespace('BX.Bizproc');\n\nconst toJsonString = function(data)\n{\n\treturn JSON.stringify(data, (i, v) => {\n\t\tif (typeof(v) === 'boolean')\n\t\t{\n\t\t\treturn v ? '1' : '0';\n\t\t}\n\t\treturn v;\n\t});\n}\n\nclass ScriptEditComponent\n{\n\tbaseNode;\n\tleftMenuNode;\n\tsaveButtonNode;\n\tformNode;\n\tscriptNameNode;\n\tdocumentType;\n\tsignedParameters;\n\tautomationDesigner;\n\tsaveCallback;\n\tconfigsMenuItem;\n\n\tconstantPrefix = 'Constant__';\n\tparameterPrefix = 'Parameter__';\n\n\tconstructor(options)\n\t{\n\t\tif(Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.baseNode = options.baseNode;\n\t\t\tthis.leftMenuNode = options.leftMenuNode;\n\t\t\tthis.saveButtonNode = options.saveButtonNode;\n\t\t\tthis.formNode = options.formNode;\n\t\t\tthis.documentType = options.documentType;\n\t\t\tthis.signedParameters = options.signedParameters;\n\t\t\tthis.saveCallback = options.saveCallback\n\t\t}\n\t\tthis.automationDesigner = BX.Bizproc.Automation.Designer.component;\n\t}\n\n\tinit()\n\t{\n\t\tif (this.saveButtonNode)\n\t\t{\n\t\t\tEvent.bind(this.saveButtonNode, 'click', this.saveHandler.bind(this));\n\t\t}\n\t\tif (this.baseNode && this.leftMenuNode)\n\t\t{\n\t\t\tthis.initMenu();\n\t\t}\n\n\t\tif (this.formNode)\n\t\t{\n\t\t\tthis.scriptNameNode = this.formNode.elements.NAME;\n\t\t\tEvent.bind(this.scriptNameNode, 'blur', () => {\n\t\t\t\tif (!Type.isStringFilled(this.scriptNameNode.value))\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.scriptNameNode.closest('.ui-ctl'), 'ui-ctl-danger');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(this.scriptNameNode.closest('.ui-ctl'), 'ui-ctl-danger');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.automationDesigner)\n\t\t{\n\t\t\tEventEmitter.subscribe(this.automationDesigner, 'onTemplateConstantAdd', () => {\n\t\t\t\tif (this.configsMenuItem)\n\t\t\t\t{\n\t\t\t\t\tthis.configsMenuItem.addNoticeIcon();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tsaveHandler()\n\t{\n\t\tconst form = new FormData(this.formNode);\n\t\tconst scriptFields = {};\n\t\tfor (let field of form.entries())\n\t\t{\n\t\t\tscriptFields[field[0]] = field[1];\n\t\t}\n\n\t\tif (!this.#validateScriptName(scriptFields.NAME))\n\t\t{\n\t\t\tDom.removeClass(this.saveButtonNode, 'ui-btn-wait');\n\t\t\treturn false;\n\t\t}\n\n\t\tconst robotsTemplate = this.#getRobotsTemplate();\n\t\tthis.setTemplateValues(robotsTemplate);\n\n\t\tif (!this.#validateConstants(robotsTemplate.getConstants(), robotsTemplate.collectUsages().Constant))\n\t\t{\n\t\t\tDom.removeClass(this.saveButtonNode, 'ui-btn-wait');\n\t\t\treturn false;\n\t\t}\n\n\t\tBX.ajax.runComponentAction('bitrix:bizproc.script.edit', 'saveScript', {\n\t\t\tanalyticsLabel: scriptFields.ID > 0 ? 'bizprocScriptUpdate' : 'bizprocScriptAdd',\n\t\t\tdata: {\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\tdocumentType: this.documentType,\n\t\t\t\tscript: scriptFields,\n\t\t\t\trobotsTemplate: toJsonString(robotsTemplate.serialize())\n\t\t\t}\n\t\t}).then((result) =>\n\t\t{\n\t\t\tif (Type.isFunction(this.saveCallback))\n\t\t\t{\n\t\t\t\tthis.saveCallback(result);\n\t\t\t}\n\t\t});\n\t}\n\n\t#getRobotsTemplate()\n\t{\n\t\treturn this.automationDesigner.templateManager.templates[0];\n\t}\n\n\t#activateSection(section: string): void\n\t{\n\t\tif (BX.UI.DropdownMenuItem.getItemByNode)\n\t\t{\n\t\t\tconst menuItem = BX.UI.DropdownMenuItem.getItemByNode(this.leftMenuNode.querySelector(`[data-page=\"${section}\"]`));\n\n\t\t\tthis.menuActivateHandler(section);\n\t\t\tmenuItem && menuItem.setActiveHandler();\n\t\t}\n\n\t\tif (section === 'general')\n\t\t{\n\t\t\tthis.scriptNameNode.focus();\n\t\t}\n\t\tif (section !== 'configs')\n\t\t{\n\t\t\tthis.setTemplateValues(this.#getRobotsTemplate());\n\t\t}\n\t}\n\n\t#validateScriptName(name: string): boolean\n\t{\n\t\tif (!Type.isStringFilled(name))\n\t\t{\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('BIZPROC_SCRIPT_EDIT_VALIDATION_EMPTY_NAME')\n\t\t\t});\n\n\t\t\tthis.#activateSection('general');\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t#validateConstants(constants: [], usedConstants: Set): boolean\n\t{\n\t\tlet result = true;\n\n\t\tconstants.forEach((constant) => {\n\t\t\tif (usedConstants.has(constant.Id) && !Type.isStringFilled(constant.Default))\n\t\t\t{\n\t\t\t\tresult = false;\n\t\t\t}\n\t\t});\n\n\t\tif (!result)\n\t\t{\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('BIZPROC_SCRIPT_EDIT_VALIDATION_EMPTY_CONFIGS')\n\t\t\t});\n\n\t\t\tthis.#activateSection('configs');\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinitMenu()\n\t{\n\t\tArray.from(this.leftMenuNode.querySelectorAll('[data-role=\"menu-item\"]')).forEach((el) =>\n\t\t{\n\t\t\tEvent.bind(el, 'click', this.menuActivateHandler.bind(this, el.getAttribute('data-page')));\n\n\t\t\tif (el.getAttribute('data-page') === 'configs' && BX.UI.DropdownMenuItem.getItemByNode)\n\t\t\t{\n\t\t\t\tthis.configsMenuItem = BX.UI.DropdownMenuItem.getItemByNode(el);\n\t\t\t}\n\t\t});\n\t}\n\n\tmenuActivateHandler(page)\n\t{\n\t\tArray.from(this.baseNode.querySelectorAll('[data-section]')).forEach((el) =>\n\t\t\t{\n\t\t\t\tif (el.getAttribute('data-section') === page)\n\t\t\t\t{\n\t\t\t\t\tif (page === 'configs' && Dom.hasClass(el,'bizproc-script-edit-block-hidden'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showConfigsHandler(el);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTemplateValues(this.#getRobotsTemplate());\n\t\t\t\t\t}\n\t\t\t\t\tDom.removeClass(el, 'bizproc-script-edit-block-hidden')\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(el, 'bizproc-script-edit-block-hidden');\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tshowConfigsHandler(configsNode)\n\t{\n\t\tDom.clean(configsNode);\n\n\t\tconst robotsTemplate = this.#getRobotsTemplate();\n\t\tconst constants = robotsTemplate.getConstants();\n\t\tconst parameters = robotsTemplate.getParameters();\n\t\tconst robotNodes = [];\n\n\t\trobotsTemplate.robots.forEach((robot) => {\n\t\t\tconst node = this.renderRobotConfigBlock(robot, constants, parameters);\n\t\t\tif (node)\n\t\t\t{\n\t\t\t\trobotNodes.push(node);\n\t\t\t}\n\t\t});\n\n\t\tif (robotNodes.length)\n\t\t{\n\t\t\tDom.append(Tag.render`<form data-role=\"constant-list\" onsubmit=\"return false;\">${robotNodes}</form>`, configsNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Dom.append(\n\t\t\t\tTag.render`<div class=\"ui-alert ui-alert-default ui-alert-xs ui-alert-icon-info\">\n\t\t\t\t\t<span class=\"ui-alert-message\">${Loc.getMessage('BIZPROC_SCRIPT_EDIT_SECTION_CONFIGS_EMPTY')}</span>\n\t\t\t\t</div>`,\n\t\t\t\tconfigsNode\n\t\t\t);\n\t\t}\n\t}\n\t\n\trenderRobotConfigBlock(robot, constants, parameters): ?HTMLElement\n\t{\n\t\tconst usages = robot.collectUsages();\n\t\tconst itemNodes = [];\n\n\t\tif (!usages.Constant.size && !usages.Parameter.size)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (usages.Constant.size)\n\t\t{\n\t\t\titemNodes.push(Tag.render`<div class=\"bizproc-script-edit-item\">\n\t\t\t\t<div class=\"bizproc-script-edit-title\">${Loc.getMessage('BIZPROC_SCRIPT_EDIT_CONSTANT_LABEL')}</div>\n\t\t\t\t<div class=\"bizproc-script-edit-text\">${Loc.getMessage('BIZPROC_SCRIPT_EDIT_CONSTANT_DESCRIPTION')}</div>\n\t\t\t</div>`);\n\n\t\t\tusages.Constant.forEach((constId) => {\n\t\t\t\tlet constant = constants.find((c) => c.Id === constId);\n\t\t\t\tif (constant)\n\t\t\t\t{\n\t\t\t\t\titemNodes.push(this.renderPropertyBlock(constant, this.constantPrefix));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (usages.Parameter.size)\n\t\t{\n\t\t\titemNodes.push(Tag.render`<div class=\"bizproc-script-edit-item\">\n\t\t\t\t<div class=\"bizproc-script-edit-title\">${Loc.getMessage('BIZPROC_SCRIPT_EDIT_PARAMETER_LABEL')}</div>\n\t\t\t\t<div class=\"bizproc-script-edit-text\">${Loc.getMessage('BIZPROC_SCRIPT_EDIT_PARAMETER_DESCRIPTION')}</div>\n\t\t\t</div>`);\n\n\t\t\tusages.Parameter.forEach((paramId) => {\n\t\t\t\tlet parameter = parameters.find((p) => p.Id === paramId);\n\t\t\t\tif (parameter)\n\t\t\t\t{\n\t\t\t\t\titemNodes.push(this.renderPropertyBlock(parameter, this.parameterPrefix));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-slider-section\">\n\t\t\t\t<div class=\"ui-slider-heading-4 ui-slider-heading-4--bizproc-icon\">${Text.encode(robot.getTitle())}</div>\n\t\t\t\t${itemNodes}\n\t\t\t</div>`\n\t\t;\n\t}\n\t\n\trenderPropertyBlock(property: {}, prefix: string)\n\t{\n\t\tconst control = BX.Bizproc.FieldType.renderControl(\n\t\t\tthis.automationDesigner.documentType,\n\t\t\tproperty,\n\t\t\tprefix + property.Id,\n\t\t\tproperty.Default\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-script-edit-item\">\n\t\t\t\t<div class=\"bizproc-script-edit-subtitle\">${Text.encode(property.Name)}</div>\n\t\t\t\t<div class=\"bizproc-script-edit-text\">${Text.encode(property.Description)}</div>\n\t\t\t\t<a onclick=\"${this.changePropertyDescription.bind(this, prefix, property)}\" class=\"ui-link ui-link-secondary ui-link-dashed\">${Loc.getMessage('BIZPROC_SCRIPT_EDIT_BTN_CHANGE')}</a>\n\t\t\t\t<div class=\"bizproc-script-edit-field\">\n\t\t\t\t\t${control}\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t;\n\t}\n\n\tchangePropertyDescription(prefix, property, event)\n\t{\n\t\tconst element = event.currentTarget;\n\t\tconst wrapper = element.previousElementSibling;\n\n\t\tDom.hide(element);\n\n\t\tconst inputElement = Tag.render`\n\t\t\t<input value=\"\" type=\"text\" class=\"ui-ctl-element\">\n\t\t`;\n\n\t\tinputElement.value = property.Description || '';\n\n\t\tDom.clean(wrapper);\n\t\tDom.append(inputElement, wrapper);\n\t\tinputElement.focus();\n\n\t\tconst applyNewDescription = () =>\n\t\t{\n\t\t\tconst text = inputElement.value.trim();\n\n\t\t\tproperty.Description = text;\n\t\t\tDom.clean(wrapper);\n\t\t\twrapper.textContent = text;\n\t\t\tDom.show(element);\n\n\t\t\tconst robotsTemplate = this.#getRobotsTemplate();\n\n\t\t\tif (prefix === this.constantPrefix)\n\t\t\t{\n\t\t\t\trobotsTemplate.updateConstant(property.Id, property);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\trobotsTemplate.updateParameter(property.Id, property);\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(inputElement, 'blur', applyNewDescription);\n\t\tEvent.bind(inputElement, 'keydown', (event) => {\n\t\t\tif (event.keyCode === 13)\n\t\t\t{\n\t\t\t\tEvent.unbind(inputElement, 'blur', applyNewDescription);\n\t\t\t\tapplyNewDescription();\n\t\t\t}\n\t\t});\n\t}\n\n\tsetTemplateValues(template): void\n\t{\n\t\tconst formNode = this.baseNode? this.baseNode.querySelector('[data-role=\"constant-list\"]') : null;\n\t\tif (!formNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst form = new FormData(formNode);\n\n\t\ttemplate.getConstants().forEach((constant) => {\n\t\t\ttemplate.setConstantValue(constant.Id, form.get(this.constantPrefix+constant.Id));\n\t\t});\n\n\t\ttemplate.getParameters().forEach((param) => {\n\t\t\ttemplate.setParameterValue(param.Id, form.get(this.parameterPrefix+param.Id));\n\t\t});\n\t}\n}\n\nnamespace.ScriptEditComponent = ScriptEditComponent;"],"names":["namespace","Reflection","toJsonString","data","JSON","stringify","i","v","ScriptEditComponent","options","Type","isPlainObject","baseNode","leftMenuNode","saveButtonNode","formNode","documentType","signedParameters","saveCallback","automationDesigner","BX","Bizproc","Automation","Designer","component","Event","bind","saveHandler","initMenu","scriptNameNode","elements","NAME","isStringFilled","value","Dom","addClass","closest","removeClass","EventEmitter","subscribe","configsMenuItem","addNoticeIcon","form","FormData","scriptFields","entries","field","robotsTemplate","setTemplateValues","getConstants","collectUsages","Constant","ajax","runComponentAction","analyticsLabel","ID","script","serialize","then","result","isFunction","Array","from","querySelectorAll","forEach","el","menuActivateHandler","getAttribute","UI","DropdownMenuItem","getItemByNode","page","hasClass","showConfigsHandler","configsNode","clean","constants","parameters","getParameters","robotNodes","robots","robot","node","renderRobotConfigBlock","push","length","append","Tag","render","Loc","getMessage","usages","itemNodes","size","Parameter","constId","constant","find","c","Id","renderPropertyBlock","constantPrefix","paramId","parameter","p","parameterPrefix","Text","encode","getTitle","property","prefix","control","FieldType","renderControl","Default","Name","Description","changePropertyDescription","event","element","currentTarget","wrapper","previousElementSibling","hide","inputElement","focus","applyNewDescription","text","trim","textContent","show","updateConstant","updateParameter","keyCode","unbind","template","querySelector","setConstantValue","get","param","setParameterValue","templateManager","templates","section","menuItem","setActiveHandler","name","Notification","Center","notify","content","usedConstants","has"],"mappings":"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"}