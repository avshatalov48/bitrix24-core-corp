{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Reflection, ajax, Type, Dom, Tag, Loc, Runtime, Text } from 'main.core';\nimport { Alert, AlertColor } from 'ui.alerts';\nimport { Counter, CounterColor } from 'ui.cnt';\nimport { TagSelector } from 'ui.entity-selector';\nimport { Menu, MenuItemOptions, MenuManager } from 'main.popup';\n\nconst namespace = Reflection.namespace('BX.Bizproc.Component');\n\ntype WorkflowId = string;\ntype TaskId = number;\n\ntype Task = {\n\tid: number,\n\tname: string,\n\tcanComplete: boolean,\n\trenderedName: string,\n};\n\nclass UserProcesses\n{\n\tgridId: string;\n\tdelegateToSelector: TagSelector;\n\tdelegateToUserId: number = 0;\n\tactionPanel: {\n\t\twrapperElementId: string,\n\t\tactionButtonName: string,\n\t\tuserWrapperElement: ?HTMLElement,\n\t};\n\n\tworkflowTasks: Object<WorkflowId, Array<Task>> = {};\n\ttasksWorkflowsMap: Object<TaskId, WorkflowId> = {};\n\tcurrentUserId: number;\n\n\tconstructor(options: {\n\t\tgridId: string,\n\t\tactionPanelUserWrapperId: string,\n\t\terrors: Array<{message: string}>,\n\t\tcurrentUserId: number,\n\t})\n\t{\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.gridId = options.gridId;\n\n\t\t\tif (Type.isArray(options.errors))\n\t\t\t{\n\t\t\t\tthis.showErrors(options.errors);\n\t\t\t}\n\t\t\tthis.actionPanel = {\n\t\t\t\twrapperElementId: options.actionPanelUserWrapperId,\n\t\t\t\tactionButtonName: `${this.gridId}_action_button`,\n\t\t\t};\n\n\t\t\tthis.currentUserId = options.currentUserId;\n\t\t}\n\n\t\tthis.bindAnchors();\n\t\tthis.init();\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.actionPanel.userWrapperElement = document.getElementById(this.actionPanel.wrapperElementId);\n\n\t\tfor (const workflowTasksWrapper of document.querySelectorAll('[data-role=\"workflow-tasks-data\"]'))\n\t\t{\n\t\t\tconst workflowId = workflowTasksWrapper.dataset.workflowId;\n\t\t\tconst tasks = JSON.parse(workflowTasksWrapper.dataset.tasks);\n\n\t\t\tif (Type.isStringFilled(workflowId) && Type.isArray(tasks))\n\t\t\t{\n\t\t\t\tthis.workflowTasks[workflowId] = tasks;\n\n\t\t\t\tfor (const task of tasks)\n\t\t\t\t{\n\t\t\t\t\tthis.tasksWorkflowsMap[task.id] = workflowId;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.initUserSelector();\n\t\tthis.initTasksColumn();\n\n\t\tthis.onActionPanelChanged();\n\t}\n\n\tbindAnchors()\n\t{\n\t\tBX.SidePanel.Instance.bindAnchors({\n\t\t\trules:\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\tcondition: [\n\t\t\t\t\t\t\t'/rpa/task/',\n\t\t\t\t\t\t],\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\twidth: 580,\n\t\t\t\t\t\t\tcacheable: false,\n\t\t\t\t\t\t\tallowChangeHistory: false,\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonClose: () => this.reloadGrid(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t});\n\t}\n\n\tinitTasksColumn(): void\n\t{\n\t\tconst taskNameContainers = document.querySelectorAll('.bp-task-container');\n\t\tfor (const container of taskNameContainers)\n\t\t{\n\t\t\tthis.renderParallelTasksTo(container);\n\t\t}\n\t}\n\n\trenderParallelTasksTo(container: HTMLElement): void\n\t{\n\t\tconst taskId = parseInt(container.dataset.taskId, 10);\n\t\tconst workflowId = this.tasksWorkflowsMap[taskId];\n\n\t\tif (Type.isNumber(taskId) && Type.isStringFilled(workflowId))\n\t\t{\n\t\t\tconst tasks: Task[] = this.workflowTasks[workflowId] ?? [];\n\n\t\t\tif (tasks.length > 1)\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line unicorn/no-this-assignment\n\t\t\t\tconst self = this;\n\t\t\t\tconst menuTasks = tasks.filter((task) => task.id !== taskId).map((task) => ({\n\t\t\t\t\tid: task.id,\n\t\t\t\t\ttext: task.name,\n\t\t\t\t\tonclick()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\tconst bindElement = this.getPopupWindow().bindElement;\n\t\t\t\t\t\tconst currentTaskContainer = bindElement.parentElement.parentElement.parentElement;\n\t\t\t\t\t\tconst gridCell = currentTaskContainer.parentElement;\n\n\t\t\t\t\t\tDom.clean(gridCell);\n\t\t\t\t\t\tRuntime.html(gridCell, task.renderedName).catch((err) => console.error(err));\n\n\t\t\t\t\t\tconst newContainer = gridCell.querySelector('.bp-task-container');\n\t\t\t\t\t\tif (newContainer)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tself.renderParallelTasksTo(newContainer);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}));\n\n\t\t\t\tif (!Type.isNil(container.lastElementChild))\n\t\t\t\t{\n\t\t\t\t\tconst activeTasks = tasks.filter((task) => task.canComplete);\n\n\t\t\t\t\tif (activeTasks.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.prepend(this.renderParallelTasksCounter(activeTasks.length), container);\n\t\t\t\t\t}\n\t\t\t\t\tDom.append(this.renderParallelTasksLabel(workflowId, taskId, menuTasks), container.lastElementChild);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\trenderParallelTasksCounter(count: number): HTMLElement\n\t{\n\t\tconst counter = new Counter({\n\t\t\tvalue: count,\n\t\t\tcolor: CounterColor.DANGER,\n\t\t});\n\n\t\treturn Dom.create('div', {\n\t\t\tstyle: { paddingRight: '5px' },\n\t\t\tchildren: [counter.createContainer()],\n\t\t});\n\t}\n\n\trenderParallelTasksLabel(workflowId: string, showTaskId: number, tasks: MenuItemOptions[]): HTMLElement\n\t{\n\t\tconst { label, root } = Tag.render`\n\t\t\t<span class=\"bp-task-label-container\">\n\t\t\t\t<a ref=\"label\" class=\"bp-task-label\">\n\t\t\t\t\t${Loc.getMessage(\n\t\t\t\t\t\t'BIZPROC_USER_PROCESSES_TEMPLATE_TASKS_LABEL',\n\t\t\t\t\t\t{ '#COUNT#': tasks.length },\n\t\t\t\t\t)}\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t`;\n\n\t\tlabel.onclick = (event) => {\n\t\t\tevent.preventDefault();\n\n\t\t\tconst menuId = `bp-workflow-${workflowId}-parallel-tasks-with-task-id-${showTaskId}`;\n\t\t\tconst menu = MenuManager.create({\n\t\t\t\tid: menuId,\n\t\t\t\tangle: true,\n\t\t\t\titems: tasks,\n\t\t\t});\n\t\t\tmenu.getPopupWindow().setBindElement(label);\n\t\t\tmenu.show();\n\t\t};\n\n\t\treturn root;\n\t}\n\n\tinitStartWorkflowButton(buttonId: ?string)\n\t{\n\t\tconst button = Type.isStringFilled(buttonId) && document.getElementById(buttonId);\n\t\tconst lists = Type.isStringFilled(button?.dataset.lists) && JSON.parse(button.dataset.lists);\n\n\t\tif (lists)\n\t\t{\n\t\t\tconst popupMenu = new Menu({\n\t\t\t\tangle: true,\n\t\t\t\toffsetLeft: Dom.getPosition(button).width / 2,\n\t\t\t\tautoHide: true,\n\t\t\t\tbindElement: button,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\titems: Object.values(lists).map((list) => ({\n\t\t\t\t\ttext: list.name,\n\t\t\t\t\thref: list.url,\n\t\t\t\t\tclassName: 'feed-add-post-form-link-lists',\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\ticonUrl: list.icon,\n\t\t\t\t\t},\n\t\t\t\t})),\n\t\t\t});\n\t\t\tconst popupElement = popupMenu.getMenuContainer();\n\t\t\tfor (const iconElement of popupElement.querySelectorAll('.menu-popup-item-icon'))\n\t\t\t{\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`\n\t\t\t\t\t\t<img src = \"${iconElement.parentElement.dataset.iconUrl}\" alt=\"\" width = \"19\" height = \"16\"/>\n\t\t\t\t\t`,\n\t\t\t\t\ticonElement,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tbutton.onclick = (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tpopupMenu.show();\n\t\t\t};\n\t\t}\n\t}\n\n\tinitUserSelector(): void\n\t{\n\t\tthis.delegateToSelector = new TagSelector({\n\t\t\tmultiple: false,\n\t\t\ttagMaxWidth: 180,\n\t\t\tevents: {\n\t\t\t\tonTagAdd: (event) => {\n\t\t\t\t\tthis.delegateToUserId = parseInt(event.getData().tag.getId(), 10);\n\n\t\t\t\t\tif (!Type.isInteger(this.delegateToUserId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.delegateToUserId = 0;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonTagRemove: () => {\n\t\t\t\t\tthis.delegateToUserId = 0;\n\t\t\t\t},\n\t\t\t},\n\t\t\tdialogOptions: {\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t});\n\n\t\tif (Type.isDomNode(this.actionPanel.userWrapperElement))\n\t\t{\n\t\t\tthis.delegateToSelector.renderTo(this.actionPanel.userWrapperElement);\n\t\t}\n\t}\n\n\tshowErrors(errors: Array<{ message: string }>): void\n\t{\n\t\tconst errorsContainer = document.getElementById('bp-user-processes-errors-container');\n\n\t\tif (errorsContainer)\n\t\t{\n\t\t\tlet errorCounter = 0;\n\t\t\tconst fixStyles = () => {\n\t\t\t\tif (errorCounter > 0)\n\t\t\t\t{\n\t\t\t\t\tDom.style(errorsContainer, { margin: '10px' });\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.style(errorsContainer, { margin: '0px' });\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tfor (const error of errors)\n\t\t\t{\n\t\t\t\terrorCounter += 1;\n\n\t\t\t\tconst alert = new Alert({\n\t\t\t\t\ttext: Text.encode(error.message),\n\t\t\t\t\tcolor: AlertColor.DANGER,\n\t\t\t\t\tcloseBtn: true,\n\t\t\t\t\tanimated: true,\n\t\t\t\t});\n\n\t\t\t\talert.renderTo(errorsContainer);\n\n\t\t\t\tif (alert.getCloseBtn())\n\t\t\t\t{\n\t\t\t\t\t// eslint-disable-next-line no-loop-func\n\t\t\t\t\talert.getCloseBtn().onclick = () => {\n\t\t\t\t\t\terrorCounter -= 1;\n\t\t\t\t\t\tfixStyles();\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfixStyles();\n\t\t}\n\t}\n\n\tonActionPanelChanged(): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst actionPanel = grid?.getActionsPanel();\n\n\t\tif (actionPanel)\n\t\t{\n\t\t\tconst action = actionPanel.getValues()[this.actionPanel.actionButtonName];\n\t\t\tif (!Type.isString(action) || action.includes('set_status'))\n\t\t\t{\n\t\t\t\tDom.hide(this.actionPanel.userWrapperElement);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.show(this.actionPanel.userWrapperElement);\n\t\t\t}\n\t\t}\n\t}\n\n\tapplyActionPanelValues(): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst actionsPanel = grid?.getActionsPanel();\n\n\t\tif (grid && actionsPanel)\n\t\t{\n\t\t\tconst isApplyingForAll = actionsPanel.getForAllCheckbox()?.checked === true;\n\t\t\t// TODO - implement doing all tasks\n\t\t\tif (isApplyingForAll)\n\t\t\t{\n\t\t\t\tthis.showErrors([{ message: 'Not implemented currently' }]);\n\t\t\t}\n\n\t\t\tconst action: string = actionsPanel.getValues()[this.actionPanel.actionButtonName];\n\n\t\t\tif (Type.isString(action))\n\t\t\t{\n\t\t\t\tconst selectedTasks = this.getSelectedTaskIds(grid.getRows().getSelectedIds());\n\n\t\t\t\tif (action.includes('set_status_'))\n\t\t\t\t{\n\t\t\t\t\tconst status = parseInt(action.split('_').pop(), 10);\n\n\t\t\t\t\tif (Type.isNumber(status))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTasksStatuses(selectedTasks, status);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (action.startsWith('delegate_to'))\n\t\t\t\t{\n\t\t\t\t\tthis.delegateTasks(selectedTasks, this.delegateToUserId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetSelectedTaskIds(selectedWorkflowIds: Array<WorkflowId>): Array<TaskId>\n\t{\n\t\treturn (\n\t\t\tselectedWorkflowIds\n\t\t\t\t.map((workflowId) => this.workflowTasks[workflowId][0]?.id)\n\t\t\t\t.filter((taskId) => Type.isNumber(taskId))\n\t\t);\n\t}\n\n\tsetTasksStatuses(taskIds: Array<TaskId>, newStatus: number): void\n\t{\n\t\t// eslint-disable-next-line promise/catch-or-return\n\t\tajax\n\t\t\t.runAction('bizproc.task.doInlineTasks', {\n\t\t\t\tdata: {\n\t\t\t\t\ttaskIds,\n\t\t\t\t\tnewStatus,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.showErrors(response.errors);\n\t\t\t\tthis.reloadGrid();\n\t\t\t})\n\t\t\t.then(() => this.reloadGrid())\n\t\t;\n\t}\n\n\tdelegateTasks(taskIds: Array<TaskId>, toUserId: number): void\n\t{\n\t\t// eslint-disable-next-line promise/catch-or-return\n\t\tajax\n\t\t\t.runComponentAction('bitrix:bizproc.user.processes', 'delegateTasks', {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\ttaskIds,\n\t\t\t\t\ttoUserId,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.showErrors(response.errors);\n\t\t\t\tthis.reloadGrid();\n\t\t\t})\n\t\t\t.then(() => this.reloadGrid())\n\t\t;\n\t}\n\n\treloadGrid(): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tgrid.reload();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.warn('Grid not found');\n\t\t}\n\t}\n\n\tupdateTaskData(taskId: number): void\n\t{\n\t\tlocation.reload();\n\t}\n\n\tgetGrid(): ?BX.Main.grid\n\t{\n\t\tif (this.gridId)\n\t\t{\n\t\t\treturn BX.Main.gridManager?.getInstanceById(this.gridId);\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nnamespace.UserProcesses = UserProcesses;\n"],"names":["namespace","Reflection","UserProcesses","options","Type","isPlainObject","gridId","isArray","errors","showErrors","actionPanel","wrapperElementId","actionPanelUserWrapperId","actionButtonName","currentUserId","bindAnchors","init","userWrapperElement","document","getElementById","querySelectorAll","workflowTasksWrapper","workflowId","dataset","tasks","JSON","parse","isStringFilled","workflowTasks","task","tasksWorkflowsMap","id","initUserSelector","initTasksColumn","onActionPanelChanged","BX","SidePanel","Instance","rules","condition","width","cacheable","allowChangeHistory","events","onClose","reloadGrid","taskNameContainers","container","renderParallelTasksTo","taskId","parseInt","isNumber","length","self","menuTasks","filter","map","text","name","onclick","close","bindElement","getPopupWindow","currentTaskContainer","parentElement","gridCell","Dom","clean","Runtime","html","renderedName","err","console","error","newContainer","querySelector","isNil","lastElementChild","activeTasks","canComplete","prepend","renderParallelTasksCounter","append","renderParallelTasksLabel","count","counter","Counter","value","color","CounterColor","DANGER","create","style","paddingRight","children","createContainer","showTaskId","Tag","render","Loc","getMessage","label","root","event","preventDefault","menuId","menu","MenuManager","angle","items","setBindElement","show","buttonId","button","lists","popupMenu","Menu","offsetLeft","getPosition","autoHide","closeByEsc","Object","values","list","href","url","className","iconUrl","icon","popupElement","getMenuContainer","iconElement","delegateToSelector","TagSelector","multiple","tagMaxWidth","onTagAdd","delegateToUserId","getData","tag","getId","isInteger","onTagRemove","dialogOptions","entities","intranetUsersOnly","inviteEmployeeLink","isDomNode","renderTo","errorsContainer","errorCounter","fixStyles","margin","alert","Alert","Text","encode","message","AlertColor","closeBtn","animated","getCloseBtn","grid","getGrid","getActionsPanel","action","getValues","isString","includes","hide","actionsPanel","isApplyingForAll","getForAllCheckbox","checked","selectedTasks","getSelectedTaskIds","getRows","getSelectedIds","status","split","pop","setTasksStatuses","startsWith","delegateTasks","selectedWorkflowIds","taskIds","newStatus","ajax","runAction","data","response","then","toUserId","runComponentAction","mode","reload","warn","location","Main","gridManager","getInstanceById"],"mappings":";;;;;;;;AAAA,CAMA,IAAMA,SAAS,GAAGC,oBAAU,CAACD,SAAS,CAAC,sBAAsB,CAAC;CAAC,IAYzDE,aAAa;GAelB,uBAAYC,OAKX,EACD;KAAA;KAAA,sDAjB2B,CAAC;KAAA,mDAOqB,EAAE;KAAA,uDACH,EAAE;KAUjD,IAAIC,cAAI,CAACC,aAAa,CAACF,OAAO,CAAC,EAC/B;OACC,IAAI,CAACG,MAAM,GAAGH,OAAO,CAACG,MAAM;OAE5B,IAAIF,cAAI,CAACG,OAAO,CAACJ,OAAO,CAACK,MAAM,CAAC,EAChC;SACC,IAAI,CAACC,UAAU,CAACN,OAAO,CAACK,MAAM,CAAC;;OAEhC,IAAI,CAACE,WAAW,GAAG;SAClBC,gBAAgB,EAAER,OAAO,CAACS,wBAAwB;SAClDC,gBAAgB,YAAK,IAAI,CAACP,MAAM;QAChC;OAED,IAAI,CAACQ,aAAa,GAAGX,OAAO,CAACW,aAAa;;KAG3C,IAAI,CAACC,WAAW,EAAE;KAClB,IAAI,CAACC,IAAI,EAAE;;GACX;KAAA;KAAA,uBAGD;OACC,IAAI,CAACN,WAAW,CAACO,kBAAkB,GAAGC,QAAQ,CAACC,cAAc,CAAC,IAAI,CAACT,WAAW,CAACC,gBAAgB,CAAC;OAAC,2CAE9DO,QAAQ,CAACE,gBAAgB,CAAC,mCAAmC,CAAC;SAAA;OAAA;SAAjG,oDACA;WAAA,IADWC,oBAAoB;WAE9B,IAAMC,UAAU,GAAGD,oBAAoB,CAACE,OAAO,CAACD,UAAU;WAC1D,IAAME,KAAK,GAAGC,IAAI,CAACC,KAAK,CAACL,oBAAoB,CAACE,OAAO,CAACC,KAAK,CAAC;WAE5D,IAAIpB,cAAI,CAACuB,cAAc,CAACL,UAAU,CAAC,IAAIlB,cAAI,CAACG,OAAO,CAACiB,KAAK,CAAC,EAC1D;aACC,IAAI,CAACI,aAAa,CAACN,UAAU,CAAC,GAAGE,KAAK;aAAC,4CAEpBA,KAAK;eAAA;aAAA;eAAxB,uDACA;iBAAA,IADWK,IAAI;iBAEd,IAAI,CAACC,iBAAiB,CAACD,IAAI,CAACE,EAAE,CAAC,GAAGT,UAAU;;;eAC5C;;eAAA;;;;;SAEF;;SAAA;;OAED,IAAI,CAACU,gBAAgB,EAAE;OACvB,IAAI,CAACC,eAAe,EAAE;OAEtB,IAAI,CAACC,oBAAoB,EAAE;;;KAC3B;KAAA,8BAGD;OAAA;OACCC,EAAE,CAACC,SAAS,CAACC,QAAQ,CAACtB,WAAW,CAAC;SACjCuB,KAAK,EACJ,CACC;WACCC,SAAS,EAAE,CACV,YAAY,CACZ;WACDpC,OAAO,EAAE;aACRqC,KAAK,EAAE,GAAG;aACVC,SAAS,EAAE,KAAK;aAChBC,kBAAkB,EAAE,KAAK;aACzBC,MAAM,EAAE;eACPC,OAAO,EAAE;iBAAA,OAAM,KAAI,CAACC,UAAU,EAAE;;;;UAGlC;QAEH,CAAC;;;KACF;KAAA,kCAGD;OACC,IAAMC,kBAAkB,GAAG5B,QAAQ,CAACE,gBAAgB,CAAC,oBAAoB,CAAC;OAAC,4CACnD0B,kBAAkB;SAAA;OAAA;SAA1C,uDACA;WAAA,IADWC,SAAS;WAEnB,IAAI,CAACC,qBAAqB,CAACD,SAAS,CAAC;;;SACrC;;SAAA;;;;KACD;KAAA,sCAEqBA,SAAsB,EAC5C;OACC,IAAME,MAAM,GAAGC,QAAQ,CAACH,SAAS,CAACxB,OAAO,CAAC0B,MAAM,EAAE,EAAE,CAAC;OACrD,IAAM3B,UAAU,GAAG,IAAI,CAACQ,iBAAiB,CAACmB,MAAM,CAAC;OAEjD,IAAI7C,cAAI,CAAC+C,QAAQ,CAACF,MAAM,CAAC,IAAI7C,cAAI,CAACuB,cAAc,CAACL,UAAU,CAAC,EAC5D;SAAA;SACC,IAAME,KAAa,4BAAG,IAAI,CAACI,aAAa,CAACN,UAAU,CAAC,yEAAI,EAAE;SAE1D,IAAIE,KAAK,CAAC4B,MAAM,GAAG,CAAC,EACpB;;WAEC,IAAMC,IAAI,GAAG,IAAI;WACjB,IAAMC,SAAS,GAAG9B,KAAK,CAAC+B,MAAM,CAAC,UAAC1B,IAAI;aAAA,OAAKA,IAAI,CAACE,EAAE,KAAKkB,MAAM;aAAC,CAACO,GAAG,CAAC,UAAC3B,IAAI;aAAA,OAAM;eAC3EE,EAAE,EAAEF,IAAI,CAACE,EAAE;eACX0B,IAAI,EAAE5B,IAAI,CAAC6B,IAAI;eACfC,OAAO,qBACP;iBACC,IAAI,CAACC,KAAK,EAAE;iBACZ,IAAMC,WAAW,GAAG,IAAI,CAACC,cAAc,EAAE,CAACD,WAAW;iBACrD,IAAME,oBAAoB,GAAGF,WAAW,CAACG,aAAa,CAACA,aAAa,CAACA,aAAa;iBAClF,IAAMC,QAAQ,GAAGF,oBAAoB,CAACC,aAAa;iBAEnDE,aAAG,CAACC,KAAK,CAACF,QAAQ,CAAC;iBACnBG,iBAAO,CAACC,IAAI,CAACJ,QAAQ,EAAEpC,IAAI,CAACyC,YAAY,CAAC,SAAM,CAAC,UAACC,GAAG;mBAAA,OAAKC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;mBAAC;iBAE5E,IAAMG,YAAY,GAAGT,QAAQ,CAACU,aAAa,CAAC,oBAAoB,CAAC;iBACjE,IAAID,YAAY,EAChB;mBACCrB,IAAI,CAACL,qBAAqB,CAAC0B,YAAY,CAAC;;;cAG1C;YAAC,CAAC;WAEH,IAAI,CAACtE,cAAI,CAACwE,KAAK,CAAC7B,SAAS,CAAC8B,gBAAgB,CAAC,EAC3C;aACC,IAAMC,WAAW,GAAGtD,KAAK,CAAC+B,MAAM,CAAC,UAAC1B,IAAI;eAAA,OAAKA,IAAI,CAACkD,WAAW;eAAC;aAE5D,IAAID,WAAW,CAAC1B,MAAM,GAAG,CAAC,EAC1B;eACCc,aAAG,CAACc,OAAO,CAAC,IAAI,CAACC,0BAA0B,CAACH,WAAW,CAAC1B,MAAM,CAAC,EAAEL,SAAS,CAAC;;aAE5EmB,aAAG,CAACgB,MAAM,CAAC,IAAI,CAACC,wBAAwB,CAAC7D,UAAU,EAAE2B,MAAM,EAAEK,SAAS,CAAC,EAAEP,SAAS,CAAC8B,gBAAgB,CAAC;;;;;;KAIvG;KAAA,2CAE0BO,KAAa,EACxC;OACC,IAAMC,OAAO,GAAG,IAAIC,cAAO,CAAC;SAC3BC,KAAK,EAAEH,KAAK;SACZI,KAAK,EAAEC,mBAAY,CAACC;QACpB,CAAC;OAEF,OAAOxB,aAAG,CAACyB,MAAM,CAAC,KAAK,EAAE;SACxBC,KAAK,EAAE;WAAEC,YAAY,EAAE;UAAO;SAC9BC,QAAQ,EAAE,CAACT,OAAO,CAACU,eAAe,EAAE;QACpC,CAAC;;;KACF;KAAA,yCAEwBzE,UAAkB,EAAE0E,UAAkB,EAAExE,KAAwB,EACzF;OACC,WAAwByE,aAAG,CAACC,MAAM,wOAG7BC,aAAG,CAACC,UAAU,CACf,6CAA6C,EAC7C;WAAE,SAAS,EAAE5E,KAAK,CAAC4B;UAAQ,CAC3B;SANIiD,KAAK,QAALA,KAAK;SAAEC,IAAI,QAAJA,IAAI;OAWnBD,KAAK,CAAC1C,OAAO,GAAG,UAAC4C,KAAK,EAAK;SAC1BA,KAAK,CAACC,cAAc,EAAE;SAEtB,IAAMC,MAAM,yBAAkBnF,UAAU,0CAAgC0E,UAAU,CAAE;SACpF,IAAMU,IAAI,GAAGC,sBAAW,CAAChB,MAAM,CAAC;WAC/B5D,EAAE,EAAE0E,MAAM;WACVG,KAAK,EAAE,IAAI;WACXC,KAAK,EAAErF;UACP,CAAC;SACFkF,IAAI,CAAC5C,cAAc,EAAE,CAACgD,cAAc,CAACT,KAAK,CAAC;SAC3CK,IAAI,CAACK,IAAI,EAAE;QACX;OAED,OAAOT,IAAI;;;KACX;KAAA,wCAEuBU,QAAiB,EACzC;OACC,IAAMC,MAAM,GAAG7G,cAAI,CAACuB,cAAc,CAACqF,QAAQ,CAAC,IAAI9F,QAAQ,CAACC,cAAc,CAAC6F,QAAQ,CAAC;OACjF,IAAME,KAAK,GAAG9G,cAAI,CAACuB,cAAc,CAACsF,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAE1F,OAAO,CAAC2F,KAAK,CAAC,IAAIzF,IAAI,CAACC,KAAK,CAACuF,MAAM,CAAC1F,OAAO,CAAC2F,KAAK,CAAC;OAE5F,IAAIA,KAAK,EACT;SACC,IAAMC,SAAS,GAAG,IAAIC,eAAI,CAAC;WAC1BR,KAAK,EAAE,IAAI;WACXS,UAAU,EAAEnD,aAAG,CAACoD,WAAW,CAACL,MAAM,CAAC,CAACzE,KAAK,GAAG,CAAC;WAC7C+E,QAAQ,EAAE,IAAI;WACd1D,WAAW,EAAEoD,MAAM;WACnBO,UAAU,EAAE,IAAI;WAChBX,KAAK,EAAEY,MAAM,CAACC,MAAM,CAACR,KAAK,CAAC,CAAC1D,GAAG,CAAC,UAACmE,IAAI;aAAA,OAAM;eAC1ClE,IAAI,EAAEkE,IAAI,CAACjE,IAAI;eACfkE,IAAI,EAAED,IAAI,CAACE,GAAG;eACdC,SAAS,EAAE,+BAA+B;eAC1CvG,OAAO,EAAE;iBACRwG,OAAO,EAAEJ,IAAI,CAACK;;cAEf;YAAC;UACF,CAAC;SACF,IAAMC,YAAY,GAAGd,SAAS,CAACe,gBAAgB,EAAE;SAAC,4CACxBD,YAAY,CAAC7G,gBAAgB,CAAC,uBAAuB,CAAC;WAAA;SAAA;WAAhF,uDACA;aAAA,IADW+G,WAAW;aAErBjE,aAAG,CAACgB,MAAM,CACTe,aAAG,CAACC,MAAM,2KACKiC,WAAW,CAACnE,aAAa,CAACzC,OAAO,CAACwG,OAAO,GAExDI,WAAW,CACX;;;WACD;;WAAA;;SAEDlB,MAAM,CAACtD,OAAO,GAAG,UAAC4C,KAAK,EAAK;WAC3BA,KAAK,CAACC,cAAc,EAAE;WACtBW,SAAS,CAACJ,IAAI,EAAE;UAChB;;;;KAEF;KAAA,mCAGD;OAAA;OACC,IAAI,CAACqB,kBAAkB,GAAG,IAAIC,6BAAW,CAAC;SACzCC,QAAQ,EAAE,KAAK;SACfC,WAAW,EAAE,GAAG;SAChB5F,MAAM,EAAE;WACP6F,QAAQ,EAAE,kBAACjC,KAAK,EAAK;aACpB,MAAI,CAACkC,gBAAgB,GAAGvF,QAAQ,CAACqD,KAAK,CAACmC,OAAO,EAAE,CAACC,GAAG,CAACC,KAAK,EAAE,EAAE,EAAE,CAAC;aAEjE,IAAI,CAACxI,cAAI,CAACyI,SAAS,CAAC,MAAI,CAACJ,gBAAgB,CAAC,EAC1C;eACC,MAAI,CAACA,gBAAgB,GAAG,CAAC;;YAE1B;WACDK,WAAW,EAAE,uBAAM;aAClB,MAAI,CAACL,gBAAgB,GAAG,CAAC;;UAE1B;SACDM,aAAa,EAAE;WACdC,QAAQ,EAAE,CACT;aACCjH,EAAE,EAAE,MAAM;aACV5B,OAAO,EAAE;eACR8I,iBAAiB,EAAE,IAAI;eACvBC,kBAAkB,EAAE;;YAErB;;QAGH,CAAC;OAEF,IAAI9I,cAAI,CAAC+I,SAAS,CAAC,IAAI,CAACzI,WAAW,CAACO,kBAAkB,CAAC,EACvD;SACC,IAAI,CAACmH,kBAAkB,CAACgB,QAAQ,CAAC,IAAI,CAAC1I,WAAW,CAACO,kBAAkB,CAAC;;;;KAEtE;KAAA,2BAEUT,MAAkC,EAC7C;OACC,IAAM6I,eAAe,GAAGnI,QAAQ,CAACC,cAAc,CAAC,oCAAoC,CAAC;OAErF,IAAIkI,eAAe,EACnB;SACC,IAAIC,YAAY,GAAG,CAAC;SACpB,IAAMC,SAAS,GAAG,SAAZA,SAAS,GAAS;WACvB,IAAID,YAAY,GAAG,CAAC,EACpB;aACCpF,aAAG,CAAC0B,KAAK,CAACyD,eAAe,EAAE;eAAEG,MAAM,EAAE;cAAQ,CAAC;YAC9C,MAED;aACCtF,aAAG,CAAC0B,KAAK,CAACyD,eAAe,EAAE;eAAEG,MAAM,EAAE;cAAO,CAAC;;UAE9C;SAAC,4CAEkBhJ,MAAM;WAAA;SAAA;WAA1B,uDACA;aAAA,IADWiE,KAAK;aAEf6E,YAAY,IAAI,CAAC;aAEjB,IAAMG,KAAK,GAAG,IAAIC,eAAK,CAAC;eACvBjG,IAAI,EAAEkG,cAAI,CAACC,MAAM,CAACnF,KAAK,CAACoF,OAAO,CAAC;eAChCrE,KAAK,EAAEsE,oBAAU,CAACpE,MAAM;eACxBqE,QAAQ,EAAE,IAAI;eACdC,QAAQ,EAAE;cACV,CAAC;aAEFP,KAAK,CAACL,QAAQ,CAACC,eAAe,CAAC;aAE/B,IAAII,KAAK,CAACQ,WAAW,EAAE,EACvB;;eAECR,KAAK,CAACQ,WAAW,EAAE,CAACtG,OAAO,GAAG,YAAM;iBACnC2F,YAAY,IAAI,CAAC;iBACjBC,SAAS,EAAE;gBACX;;;;WAEF;;WAAA;;SAEDA,SAAS,EAAE;;;;KAEZ;KAAA,uCAGD;OACC,IAAMW,IAAI,GAAG,IAAI,CAACC,OAAO,EAAE;OAC3B,IAAMzJ,WAAW,GAAGwJ,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEE,eAAe,EAAE;OAE3C,IAAI1J,WAAW,EACf;SACC,IAAM2J,MAAM,GAAG3J,WAAW,CAAC4J,SAAS,EAAE,CAAC,IAAI,CAAC5J,WAAW,CAACG,gBAAgB,CAAC;SACzE,IAAI,CAACT,cAAI,CAACmK,QAAQ,CAACF,MAAM,CAAC,IAAIA,MAAM,CAACG,QAAQ,CAAC,YAAY,CAAC,EAC3D;WACCtG,aAAG,CAACuG,IAAI,CAAC,IAAI,CAAC/J,WAAW,CAACO,kBAAkB,CAAC;UAC7C,MAED;WACCiD,aAAG,CAAC6C,IAAI,CAAC,IAAI,CAACrG,WAAW,CAACO,kBAAkB,CAAC;;;;;KAG/C;KAAA,yCAGD;OACC,IAAMiJ,IAAI,GAAG,IAAI,CAACC,OAAO,EAAE;OAC3B,IAAMO,YAAY,GAAGR,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEE,eAAe,EAAE;OAE5C,IAAIF,IAAI,IAAIQ,YAAY,EACxB;SAAA;SACC,IAAMC,gBAAgB,GAAG,0BAAAD,YAAY,CAACE,iBAAiB,EAAE,0DAAhC,sBAAkCC,OAAO,MAAK,IAAI;;SAE3E,IAAIF,gBAAgB,EACpB;WACC,IAAI,CAAClK,UAAU,CAAC,CAAC;aAAEoJ,OAAO,EAAE;YAA6B,CAAC,CAAC;;SAG5D,IAAMQ,MAAc,GAAGK,YAAY,CAACJ,SAAS,EAAE,CAAC,IAAI,CAAC5J,WAAW,CAACG,gBAAgB,CAAC;SAElF,IAAIT,cAAI,CAACmK,QAAQ,CAACF,MAAM,CAAC,EACzB;WACC,IAAMS,aAAa,GAAG,IAAI,CAACC,kBAAkB,CAACb,IAAI,CAACc,OAAO,EAAE,CAACC,cAAc,EAAE,CAAC;WAE9E,IAAIZ,MAAM,CAACG,QAAQ,CAAC,aAAa,CAAC,EAClC;aACC,IAAMU,MAAM,GAAGhI,QAAQ,CAACmH,MAAM,CAACc,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,EAAE,EAAE,EAAE,CAAC;aAEpD,IAAIhL,cAAI,CAAC+C,QAAQ,CAAC+H,MAAM,CAAC,EACzB;eACC,IAAI,CAACG,gBAAgB,CAACP,aAAa,EAAEI,MAAM,CAAC;;YAE7C,MACI,IAAIb,MAAM,CAACiB,UAAU,CAAC,aAAa,CAAC,EACzC;aACC,IAAI,CAACC,aAAa,CAACT,aAAa,EAAE,IAAI,CAACrC,gBAAgB,CAAC;;;;;;KAI3D;KAAA,mCAEkB+C,mBAAsC,EACzD;OAAA;OACC,OACCA,mBAAmB,CACjBhI,GAAG,CAAC,UAAClC,UAAU;SAAA;SAAA,gCAAK,MAAI,CAACM,aAAa,CAACN,UAAU,CAAC,CAAC,CAAC,CAAC,0DAAjC,sBAAmCS,EAAE;SAAC,CAC1DwB,MAAM,CAAC,UAACN,MAAM;SAAA,OAAK7C,cAAI,CAAC+C,QAAQ,CAACF,MAAM,CAAC;SAAC;;;KAE5C;KAAA,iCAEgBwI,OAAsB,EAAEC,SAAiB,EAC1D;OAAA;;OAECC,cAAI,CACFC,SAAS,CAAC,4BAA4B,EAAE;SACxCC,IAAI,EAAE;WACLJ,OAAO,EAAPA,OAAO;WACPC,SAAS,EAATA;;QAED,CAAC,SACI,CAAC,UAACI,QAAQ,EAAK;SACpB,MAAI,CAACrL,UAAU,CAACqL,QAAQ,CAACtL,MAAM,CAAC;SAChC,MAAI,CAACqC,UAAU,EAAE;QACjB,CAAC,CACDkJ,IAAI,CAAC;SAAA,OAAM,MAAI,CAAClJ,UAAU,EAAE;SAAC;;;KAE/B;KAAA,8BAEa4I,OAAsB,EAAEO,QAAgB,EACtD;OAAA;;OAECL,cAAI,CACFM,kBAAkB,CAAC,+BAA+B,EAAE,eAAe,EAAE;SACrEC,IAAI,EAAE,OAAO;SACbL,IAAI,EAAE;WACLJ,OAAO,EAAPA,OAAO;WACPO,QAAQ,EAARA;;QAED,CAAC,SACI,CAAC,UAACF,QAAQ,EAAK;SACpB,MAAI,CAACrL,UAAU,CAACqL,QAAQ,CAACtL,MAAM,CAAC;SAChC,MAAI,CAACqC,UAAU,EAAE;QACjB,CAAC,CACDkJ,IAAI,CAAC;SAAA,OAAM,MAAI,CAAClJ,UAAU,EAAE;SAAC;;;KAE/B;KAAA,6BAGD;OACC,IAAMqH,IAAI,GAAG,IAAI,CAACC,OAAO,EAAE;OAC3B,IAAID,IAAI,EACR;SACCA,IAAI,CAACiC,MAAM,EAAE;QACb,MAED;SACC3H,OAAO,CAAC4H,IAAI,CAAC,gBAAgB,CAAC;;;;KAE/B;KAAA,+BAEcnJ,MAAc,EAC7B;OACCoJ,QAAQ,CAACF,MAAM,EAAE;;;KACjB;KAAA,0BAGD;OACC,IAAI,IAAI,CAAC7L,MAAM,EACf;SAAA;SACC,+BAAO6B,EAAE,CAACmK,IAAI,CAACC,WAAW,yDAAnB,qBAAqBC,eAAe,CAAC,IAAI,CAAClM,MAAM,CAAC;;OAGzD,OAAO,IAAI;;;GACX;CAAA;CAGFN,SAAS,CAACE,aAAa,GAAGA,aAAa;;;;"}