jn.define("crm/product-grid/components/product-pricing",((e,t,n)=>{const{Loc:o}=e("loc");const{mergeImmutable:r}=e("utils/object");const{debounce:i}=e("utils/function");const{ProductGridStringField:s,ProductGridMoneyField:c,ProductGridNumberField:u}=e("layout/ui/product-grid/components/string-field");const{DiscountPrice:a}=e("layout/ui/product-grid/components/discount-price");const{notify:l}=e("layout/ui/product-grid/components/hint");const{ProductRow:d}=e("crm/product-grid/model");const{Haptics:g}=e("haptics");const{DiscountType:p}=e("crm/product-calculator");const h=e=>(...t)=>{setTimeout((()=>g.impactMedium()),0);e(...t)};class m extends LayoutComponent{constructor(e){super(e)}get productRow(){return this.props.productRow}render(){return View({},y({},this.renderPrice(),this.renderQuantity()),y({style:{marginBottom:0}},this.renderDiscountField(),this.renderTotalSum()),this.renderDiscountValue(),this.renderTaxes())}renderPrice(){const e=this.productRow.getBasePrice();const t=this.productRow.getCurrency();const n=new Money({amount:e,currency:t});const r=new Money({amount:0,currency:t});const s=!this.productRow.isPriceEditable()||!this.props.editable;const u=t=>{const n=this.normalizeMoneyFieldValue(t.value);if(n!==e){this.onChangePrice(n)}};return new c({disabled:s,value:n.amount,currency:n.currency,placeholder:r.formattedAmount,label:`${o.getMessage("PRODUCT_GRID_CONTROL_PRICING_PRICE")}, ${n.formattedCurrency}`,onChange:i((e=>{if(e.value==="")return;u(e)}),300),onBlur:e=>{if(e.value==="")u(e)},onClick:()=>this.notifyPriceDisabled()})}renderQuantity(){const e=this.productRow.getQuantity();const t=!this.props.editable;const n=Money.create({amount:0,currency:this.productRow.getCurrency()}).format;const o=jnComponent.convertHtmlEntities(n.THOUSANDS_SEP);const r=t=>{const n=t.value;if(n!==e){this.onChangeQuantity(n)}};return new u({disabled:t,value:e,groupSize:3,groupSeparator:Boolean(o)?o:" ",decimalSeparator:n.DEC_POINT,placeholder:"0",useIncrement:true,useDecrement:true,min:1,step:1,label:this.productRow.getMeasureName(),labelAlign:"center",textAlign:"center",onChange:i((e=>{if(e.value==="")return;r(e)}),300),onBlur:e=>{if(e.value==="")r(e)}})}renderDiscountField(){const e=this.productRow.getCurrency();const t=this.productRow.getDiscountType();const n=t===p.MONETARY?this.productRow.getDiscountSum():this.productRow.getDiscountRate();const r=new Money({amount:0,currency:e});const s=!this.props.editable;const u=e=>{const t=this.normalizeMoneyFieldValue(e.value);if(t!==n){this.onChangeDiscountValue(t)}};return new c({value:n,currency:e,disabled:s,placeholder:r.formattedAmount,keyboardType:"decimal-pad",label:o.getMessage("PRODUCT_GRID_CONTROL_PRICING_DISCOUNT"),onChange:i((e=>{if(e.value==="")return;u(e)}),300),onBlur:e=>{if(e.value==="")u(e)},rightBlock:e=>C({disabled:s,text:t===p.PERCENTAGE?"%":r.formattedCurrency,onClick:h((()=>{const n=t===p.PERCENTAGE?p.MONETARY:p.PERCENTAGE;const o=e.isFocused?this.normalizeMoneyFieldValue(e.value):false;this.onChangeDiscountType(n,o)}))})})}renderDiscountValue(){const e=this.productRow.getCurrency();const t=this.productRow.getDiscountRow();const n=this.productRow.getMaxPrice();const o=this.productRow.getQuantity();const r=n*o;if(t===0){return null}const i=new Money({amount:t,currency:e});const s=new Money({amount:r,currency:e});return y({style:{marginTop:6,marginBottom:0}},View({style:{flexDirection:"row",justifyContent:"flex-end"}},a({oldPrice:s,discount:i})))}renderTotalSum(){const e=this.productRow.getSum();const t=this.productRow.getCurrency();const n=new Money({amount:e,currency:t});const r=new Money({amount:0,currency:t});const s=t=>{const n=this.normalizeMoneyFieldValue(t.value);if(n!==e){this.onChangeSum(n)}};return new c({value:n.amount,currency:n.currency,placeholder:r.formattedAmount,label:`${o.getMessage("PRODUCT_GRID_CONTROL_PRICING_SUM_EDITABLE")}, ${n.formattedCurrency}`,labelAlign:"right",textAlign:"right",disabled:!this.props.editable,onChange:i((e=>{if(e.value==="")return;s(e)}),300),onBlur:e=>{if(e.value==="")s(e)}})}renderTaxes(){const e=this.productRow.getTaxRate();if(e===null||e===0||this.productRow.isTaxMode()){return null}const t=this.productRow.isTaxIncluded();const n=t?"PRODUCT_GRID_CONTROL_PRICING_TAX_INCLUDED":"PRODUCT_GRID_CONTROL_PRICING_TAX_NOT_INCLUDED";const r=o.getMessage(n);const i=o.getMessage("PRODUCT_GRID_CONTROL_PRICING_TAX").replace("#PERCENT#",e);const s=this.productRow.getTaxSum();const c=this.productRow.getCurrency();const u=new Money({amount:s,currency:c});const a=`${i}, ${u.formatted}`;const l={fontSize:12,color:"#A8ADB4",textAlign:"right"};return y({style:{marginTop:4,marginBottom:0}},View({style:{flexDirection:"row",justifyContent:"flex-end"}},View({style:{flexDirection:"column"}},Text({style:l,text:a}),Text({style:l,text:r}))))}onChangePrice(e){if(this.props.onChangePrice){this.props.onChangePrice(e)}}onChangeSum(e){if(this.props.onChangeSum){this.props.onChangeSum(e)}}onChangeQuantity(e){if(this.props.onChangeQuantity){this.props.onChangeQuantity(e)}}onChangeDiscountValue(e){if(this.props.onChangeDiscountValue){this.props.onChangeDiscountValue(e)}}onChangeDiscountType(e,t){if(this.props.onChangeDiscountType){this.props.onChangeDiscountType(e,t)}}onToggleDiscount(){if(this.props.onToggleDiscount){const e=!this.props.discountVisible;this.props.onToggleDiscount(e)}}notifyPriceDisabled(){if(!this.productRow.isPriceEditable()){const e=o.getMessage("PRODUCT_GRID_CONTROL_PRICING_PRICE_CHANGE_DISABLED_TITLE");const t=o.getMessage("PRODUCT_GRID_CONTROL_PRICING_PRICE_CHANGE_DISABLED_BODY2");const n=5;l({title:e,message:t,seconds:n})}}normalizeMoneyFieldValue(e){const t=String(e).replace(",",".").trim();return Number(t)}}function y(e,...t){const n=8;const o=8;const i=t.map(((e,t,o)=>{const r=o.length-1;const i={flexGrow:1,flexBasis:0,marginLeft:t===0?0:n,marginRight:t===r?0:n};return View({style:i},e)}));const s={style:{flexDirection:"row",justifyContent:"space-between",marginBottom:o}};return View(r(s,e),...i)}function C(e){return View({style:{flexDirection:"row"},onClick:()=>e.disabled?false:e.onClick()},View({style:{flexDirection:"column",justifyContent:"center",paddingLeft:4,paddingRight:4}},Text({text:String(e.text),style:{color:"#828B95",fontSize:16}})),!e.disabled&&View({style:{flexDirection:"column",justifyContent:"center"}},Image({style:{width:8,height:5},svg:{content:`<svg width="8" height="5" viewBox="0 0 8 5" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.8344 0.0751953L4.57087 2.33872L4.00061 2.90015L3.44117 2.33872L1.17764 0.0751953L0.378906 0.873929L4.00599 4.50101L7.63307 0.873929L6.8344 0.0751953Z" fill="#A8ADB4"/></svg>`}})))}n.exports={ProductPricing:m}}));
//# sourceMappingURL=extension.map.js