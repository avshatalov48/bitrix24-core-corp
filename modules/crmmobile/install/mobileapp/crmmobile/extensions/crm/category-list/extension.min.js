jn.define("crm/category-list",((t,e,s)=>{const{CategoryListItem:o}=t("crm/category-list/item");const{CategorySelectActions:n}=t("crm/category-list/actions");const{clone:a}=t("utils/object");class r extends LayoutComponent{constructor(t){super(t);this.layout=t.layout||layout;this.state={categories:BX.prop.getArray(t,"categories",[]),currentCategoryId:this.props.currentCategoryId,enabled:true};this.onSelectCategoryHandler=this.onSelectCategory.bind(this);this.onEditCategoryHandler=this.editCategory.bind(this);this.onCreateCategoryHandler=this.onCreateCategory.bind(this)}componentWillReceiveProps(t){this.state.categories=BX.prop.getArray(t,"categories",[]);this.state.currentCategoryId=t.currentCategoryId}onCreateCategory(){const{onCreateCategory:t}=this.props;if(typeof t==="function"){t(this.state.categories)}}isReadOnly(){return BX.prop.getBoolean(this.props,"readOnly",false)}isEnabledSelect(){return BX.prop.getBoolean(this.props,"enableSelect",false)}componentDidMount(){BX.addCustomEvent("Crm.CategoryDetail::onCreateCategory",this.setNewCategory.bind(this));BX.addCustomEvent("Crm.CategoryDetail::onUpdateCategory",this.onUpdateCategory.bind(this));BX.addCustomEvent("Crm.CategoryDetail::onDeleteCategory",this.onDeleteCategory.bind(this));BX.addCustomEvent("Crm.StageDetail::onUpdateStage",this.onUpdateStage.bind(this));BX.addCustomEvent("Crm.StageDetail::onDeleteStage",this.onDeleteStage.bind(this));BX.addCustomEvent("Crm.StageDetail::onUpdateTunnels",this.onUpdateTunnels.bind(this))}render(){const t=this.state.categories.map(((t,e)=>this.renderCategory(t,e===this.state.categories.length-1)));return ScrollView({style:{flex:1}},View({style:i.listContainer},...t,this.renderCreateCategoryButton()))}renderCreateCategoryButton(){if(this.isReadOnly()||!this.canUserEditCategory()){return null}return View({style:{paddingTop:4,paddingBottom:6}},new BaseButton({icon:l.createCategoryButtonIcon,text:BX.message("CRM_CATEGORY_CREATE_CATEGORY2"),style:{button:{borderColor:"#ffffff",justifyContent:"flex-start"},icon:{marginRight:22,marginLeft:28,width:12,height:12},text:{color:"#333333",fontWeight:"normal",fontSize:18}},onClick:this.onCreateCategoryHandler}))}canUserEditCategory(){return this.props.canUserEditCategory}renderCategory(t,e){const{showCounters:s,showTunnels:n}=this.props;const a=this.canUserEditCategory();const r=!e||!this.isReadOnly()&&a;return new o({category:t,layout:this.layout,active:this.state.currentCategoryId===t.id,onSelectCategory:this.onSelectCategoryHandler,onEditCategory:this.onEditCategoryHandler,readOnly:this.isReadOnly(),enabled:this.isCategoryEnabled(t),canUserEditCategory:a,showBottomBorder:r,showCounters:s,showTunnels:n})}isCategoryEnabled(t){return this.state.enabled&&!this.disabledCategoryIds.includes(t.id)}get disabledCategoryIds(){return BX.prop.getArray(this.props,"disabledCategoryIds",[])}onSelectCategory(t){const{selectAction:e,openStageListHandler:s,uid:o,onSelectCategory:a}=this.props;if(a){return this.disableCategoryList().then((()=>a(t,this.layout))).catch((()=>this.enableCategoryList()))}if(e){switch(e){case n.SelectCurrentCategory:BX.postComponentEvent("Crm.CategoryList::onSelectedCategory",[t]);this.layout.close();break;case n.CreateTunnel:BX.postComponentEvent("Crm.TunnelList::selectCategoryOnCreateTunnel",[t]);if(typeof s==="function"){s(t)}break;case n.SelectTunnelDestination:BX.postComponentEvent(`Crm.TunnelListItem::selectTunnelDestinationCategory-${o}`,[t]);if(typeof s==="function"){s(t)}break;default:break}}}enableCategoryList(){if(this.state.enable===true){return Promise.resolve()}return new Promise((t=>{this.setState({enabled:true},t)}))}disableCategoryList(){if(this.state.enable===false){return Promise.resolve()}return new Promise((t=>{this.setState({enabled:false},t)}))}editCategory(t){const{onEditCategory:e}=this.props;if(typeof e==="function"){e(t,this.state.categories)}}setNewCategory(t){this.setState({categories:[...this.state.categories,t.category]})}onDeleteCategory(t){const e=this.state.categories.findIndex((e=>e.id===t));if(e!==-1){const t=[...this.state.categories];t.splice(e,1);this.setState({categories:t})}}onUpdateCategory(t){const e=[...this.state.categories];const s=this.state.categories.findIndex((e=>e.id===t.category.id));if(s!==-1){e[s]=t.category}for(let s=0;s<e.length;s++){e[s].tunnels=e[s].tunnels.reduce(((e,s)=>{if(s.dstCategoryId===t.category.id){return[...e,{...s,dstCategoryName:t.category.name}]}return[...e,s]}),[])}this.setState({categories:e})}onUpdateStage(t){const e=[...this.state.categories];for(let s=0;s<e.length;s++){const o=e[s].tunnels.reduce(((e,s)=>{if(s.dstStageId===t.id){return[...e,{...s,dstStageName:t.name,dstStageColor:t.color}]}return[...e,s]}),[]);e[s]={...e[s],tunnels:o}}this.setState({categories:[...e]})}onDeleteStage(t){const e=[...this.state.categories];for(let s=0;s<e.length;s++){const o=e[s].tunnels.findIndex((e=>e.dstStageId===t.id||e.srcStageId===t.id));if(o!==-1){const t=[...e[s].tunnels];t.splice(o,1);e[s]={...e[s],tunnels:t}}}this.setState({categories:[...e]})}onDeleteTunnel(t){const e=[...this.state.categories];const s=e.findIndex((e=>e.tunnels.find((e=>e.srcCategoryId===t.srcCategoryId))));if(s!==-1){const o=[...e[s].tunnels];const n=o.findIndex((e=>e.robot.name===t.robot.name));if(n!==-1){o.splice(n,1);e[s]={...e[s],tunnels:o};this.setState({categories:e})}}}onCreateTunnel(t){if(this.isEnabledSelect()){this.layout.close()}const e=[...this.state.categories];const s=e.findIndex((e=>e.id===t.srcCategoryId));if(s!==-1){const o=[...e[s].tunnels,t];e[s].tunnels=o;this.setState({categories:e})}}onUpdateTunnels(t,e){const{categories:s}=this.state;const o=a(s);const n=o.findIndex((t=>t.id===e));if(n!==-1){o[n]={...s[n],tunnels:t};this.setState({categories:o})}}}const i={listContainer:{flexDirection:"column",backgroundColor:"#ffffff",borderRadius:12}};const l={createCategoryButtonIcon:`<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 0H7V12H5V0Z" fill="#525C69"/><path d="M12 5V7L0 7L1.19209e-07 5L12 5Z" fill="#525C69"/></svg>`};s.exports={CategoryList:r}}));
//# sourceMappingURL=extension.map.js