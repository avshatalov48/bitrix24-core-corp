jn.define("crm/entity-detail/component/menu-provider",((e,t,n)=>{const{Alert:o}=e("alert");const{NotifyManager:s}=e("notify-manager");const{TypeId:i}=e("crm/type");const{getEntityMessage:_}=e("crm/loc");const{CategoryListView:T}=e("crm/category-list-view");const{getSmartActivityMenuItem:a}=e("crm/entity-detail/component/smart-activity-menu-item");const c=e=>{const t=[];const{entityTypeId:n,qrUrl:o,permissions:s={},todoNotificationParams:T}=e.getComponentParams();const{entityModel:c}=e;if(!c){return[]}if(!e.isNewEntity()){const E=BX.prop.getBoolean(s,"update",false);const I=BX.prop.getBoolean(s,"delete",false);const C=BX.prop.getBoolean(s,"exclude",false);if(n===i.Deal){t.push({id:"excludeItem",sectionCode:"action",onItemSelected:()=>p(e),title:BX.message("M_CRM_ENTITY_ACTION_EXCLUDE"),iconUrl:component.path+"/icons/exclude.png",disable:!C})}t.push({id:"deleteItem",sectionCode:"action",onItemSelected:()=>d(e),title:_("M_CRM_ENTITY_ACTION_DELETE",e.getEntityTypeId()),iconUrl:component.path+"/icons/delete.png",disable:!I});if(n===i.Deal){if(c.hasOwnProperty("IS_MANUAL_OPPORTUNITY")){t.push({id:"disableManualOpportunity",sectionCode:"action",onItemSelected:()=>e.customEventEmitter.emit("EntityDetails::onChangeManualOpportunity"),title:BX.message("M_CRM_CHANGE_MANUAL_OPPORTUNITY_SET_TO_AUTOMATIC"),checked:c.IS_MANUAL_OPPORTUNITY!=="Y",iconUrl:component.path+"/icons/manual_opportunity.png",disable:!E})}t.push({id:"changeCategoryItem",sectionCode:"action",onItemSelected:()=>r(e,c),title:BX.message("M_CRM_ENTITY_ACTION_CHANGE_CATEGORY2"),iconUrl:component.path+"/icons/change_category.png",disable:!E});if(T){t.push(a(!T.isSkipped,(e=>T.isSkipped=!e)))}}t.push({id:"shareItem",sectionCode:"action",onItemSelected:()=>dialogs.showSharingDialog({message:currentDomain+o}),title:BX.message("M_CRM_ENTITY_ACTION_SHARE"),iconUrl:component.path+"/icons/share.png",showTopSeparator:t.length>0})}t.push({type:UI.Menu.Types.DESKTOP,data:{qrUrl:o},showTopSeparator:t.length>0&&!t.some((e=>e.id==="shareItem"))});const E=A(c.ENTITY_TYPE_NAME);if(E){t.push({type:UI.Menu.Types.HELPDESK,data:{articleCode:E}})}return t};const r=(e,t)=>{let n=Promise.resolve();if(e.isToolPanelVisible()){n=n.then((()=>E()))}n.then((()=>I(e,t)))};const E=()=>new Promise(((e,t)=>{o.confirm(BX.message("M_CRM_ENTITY_ACTION_CHANGE_CATEGORY_UNSAVED_ALERT_TITLE2"),BX.message("M_CRM_ENTITY_ACTION_CHANGE_CATEGORY_UNSAVED_ALERT_TEXT2"),[{text:BX.message("M_CRM_ENTITY_ACTION_CHANGE_CATEGORY_UNSAVED_ALERT_OK"),type:"destructive",onPress:e},{text:BX.message("M_CRM_ENTITY_ACTION_CHANGE_CATEGORY_UNSAVED_ALERT_CANCEL"),type:"cancel",onPress:t}])}));const I=(e,t)=>T.open({entityTypeId:e.getEntityTypeId(),currentCategoryId:t.CATEGORY_ID,readOnly:true,showCounters:false,showTunnels:false,onSelectCategory:(n,o)=>{if(parseInt(t.CATEGORY_ID)!==parseInt(n.id)){return l().then((()=>{C(o,e,n.id)}))}o.close();return Promise.resolve()}},{title:BX.message("M_CRM_ENTITY_ACTION_CHANGE_CATEGORY_TITLE2")});const C=(e,t,n)=>{e.setListener((e=>{if(e==="onViewHidden"){t.refreshDetailCard().then((()=>t.handleSave({CATEGORY_ID:n})))}}));e.close()};const l=()=>new Promise(((e,t)=>{o.confirm(BX.message("M_CRM_ENTITY_ACTION_CHANGE_CATEGORY_ALERT_TITLE2"),BX.message("M_CRM_ENTITY_ACTION_CHANGE_CATEGORY_ALERT_TEXT2"),[{text:BX.message("M_CRM_ENTITY_ACTION_CHANGE_CATEGORY_ALERT_OK2"),onPress:e},{type:"cancel",onPress:t}])}));const p=e=>{o.confirm(BX.message("M_CRM_ENTITY_ACTION_EXCLUDE"),_("M_CRM_ENTITY_ACTION_EXCLUDE_CONFIRMATION",e.getEntityTypeId()),[{text:BX.message("M_CRM_ENTITY_ACTION_EXCLUDE_CONFIRMATION_OK"),type:"destructive",onPress:()=>N("excludeEntity",e)},{type:"cancel"}])};const d=e=>{o.confirm(_("M_CRM_ENTITY_ACTION_DELETE",e.getEntityTypeId()),_("M_CRM_ENTITY_ACTION_DELETE_CONFIRMATION",e.getEntityTypeId()),[{text:BX.message("M_CRM_ENTITY_ACTION_DELETE_CONFIRMATION_OK"),type:"destructive",onPress:()=>N("deleteEntity",e)},{type:"cancel"}])};const N=(e,t)=>{s.showLoadingIndicator();BX.ajax.runAction(`crmmobile.EntityDetails.${e}`,{json:{entityTypeId:t.getEntityTypeId(),entityId:t.getEntityId()}}).then((()=>{t.emitEntityUpdate(e);s.hideLoadingIndicatorWithoutFallback();t.close()})).catch((e=>{s.showDefaultError();console.error(e)}))};const A=e=>null;n.exports={menuProvider:c}}));
//# sourceMappingURL=menu-provider.map.js