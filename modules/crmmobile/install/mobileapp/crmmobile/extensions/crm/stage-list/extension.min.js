jn.define("crm/stage-list",((t,e,s)=>{const{CategoryCountersStoreManager:n}=t("crm/state-storage");const{StageListItem:o,TUNNEL_HEIGHT:a,MIN_STAGE_HEIGHT:r,FIRST_TUNNEL_ADDITIONAL_HEIGHT:i}=t("crm/stage-list/item");const l=0;const g="";class h extends LayoutComponent{constructor(t){super(t);this.initStageProps(t);this.onOpenStageDetail=this.handlerOnOpenStageDetail.bind(this);this.state.categoryCounters=n.getStages()}componentWillReceiveProps(t){this.initStageProps(t)}initStageProps(t){const{stageParams:e}=t;this.showTunnels=BX.prop.get(e,"showTunnels",false);this.showTotal=BX.prop.get(e,"showTotal",false);this.showCount=BX.prop.get(e,"showCount",false);this.showCounters=BX.prop.get(e,"showCounters",false);this.showAllStagesItem=BX.prop.get(e,"showAllStagesItem",false)}prepareStagesData(t){return t.sort((({sort:t},{sort:e})=>t-e)).reduce(((e,s,n)=>[...e,{...s,type:String(Random.getString(10)),key:String(s.id),index:n+1,showContentBorder:n!==t.length-1}]),[])}getAllStagesItem(){const{categoryCounters:t}=this.state;const e=t.reduce(((t,e)=>{t.count+=e.count;t.total+=e.total;return t}),{count:0,total:0});return{id:l,statusId:g,color:"#e6ecef",name:BX.message("CRM_STAGE_LIST_ALL_STAGES_TITLE"),count:e.count,total:e.total,currency:t[0].currency,tunnels:[],showContentBorder:true,listMode:true}}handlerOnOpenStageDetail(t){const{onOpenStageDetail:e}=this.props;if(typeof e==="function"){e(t)}}moveStage(t,e){const{processStages:s}=this.props;const n=s[t];let o=[...s];o.splice(t,1);o.splice(e,0,n);o=this.updateStagesSort(o);this.onStageMove(o)}onStageMove(t){const{onStageMove:e}=this.props;if(typeof e==="function"){e(t)}}updateStagesSort(t){return t.map(((t,e)=>{t.sort=e*10+10;t.index=e+1;return t}))}renderProcessStageList(t){const{readOnly:e}=this.props;return ListView({data:[{items:t}],renderItem:t=>this.renderStageListItem(t),dragInteractionEnabled:!e,onItemDrop:t=>{this.moveStage(t.from.index,t.to.index)},style:{height:this.calculateHeight(t),alignItems:"center"},isScrollable:false})}calculateHeight(t){return t.reduce(((t,e)=>{t+=r;if(this.showTunnels&&e.tunnels.length){t+=i;t+=a*e.tunnels.length}return t}),5)}getActiveStageId(){const{activeStageId:t}=this.props;if(t!==null){return t}return l}renderStageListItem(t){const{readOnly:e,onSelectedStage:s,canMoveStages:n}=this.props;const a=this.getActiveStageId()===t.id;const{categoryCounters:r}=this.state;let i={...t,active:a};const l=r.find((e=>e.id===t.id));if(t.id&&l){i={...i,...l}}return new o({readOnly:e,onSelectedStage:s,canMoveStages:n,showTunnels:this.showTunnels,showTotal:this.showTotal,showCount:this.showCount,showCounters:this.showCounters,showAllStagesItem:this.showAllStagesItem,stage:i,onOpenStageDetail:this.onOpenStageDetail,enableStageSelect:this.props.enableStageSelect,enabled:this.isStageEnabled(t)})}isStageEnabled(t){return!this.disabledStageIds.includes(t.id)}get disabledStageIds(){return BX.prop.getArray(this.props,"disabledStageIds",[])}render(){const{processStages:t,finalStages:e,title:s}=this.props;return View({style:c.stagesContainer},Text({text:s||BX.message("CRM_STAGE_LIST_TITLE"),style:c.stagesTitle}),this.renderAllStagesItem(t),this.renderProcessStageList(this.prepareStagesData(t)),e.length&&View({style:c.delimeter}),...this.prepareStagesData(e).map((t=>this.renderStageListItem(t))))}renderAllStagesItem(t){const{stageParams:e}=this.props;if(e&&e.showAllStagesItem&&!t.find((t=>t.id===0))){return this.renderStageListItem(this.getAllStagesItem())}return null}}const c={stagesContainer:{borderRadius:12,backgroundColor:"#fff",paddingTop:9,flexDirection:"column",marginBottom:8},stagesTitle:{color:"#525c69",fontSize:15,fontWeight:"500",marginLeft:22,marginRight:19,marginBottom:4},delimeter:{backgroundColor:"#d9dce2",height:4}};s.exports={StageList:h}}));
//# sourceMappingURL=extension.map.js