jn.define("crm/timeline/scheduler",((e,t,i)=>{const{Loc:o}=e("loc");const n=Object.values(e("crm/timeline/scheduler/providers"));class s{constructor({entity:e,onActivityCreate:t,onClose:i,onCancel:n,onSkip:s,parentWidget:r=PageManager}){this.entity=e;this.onActivityCreate=t;this.onClose=i;this.onCancel=n;this.onSkip=s;this.parentWidget=r;this.menu=new ContextMenu({actions:this.buildMenuItems(),params:{showActionLoader:false,showCancelButton:false,title:o.getMessage("M_CRM_TIMELINE_SCHEDULER_MENU_TITLE")}})}openMenu(){void this.menu.show()}openActivityEditor(e={}){const t=n.find((e=>e.getId()==="activity"));if(t&&t.isSupported()){this.openEditor(t,e)}}openActivityReminder(e={}){const t=n.find((e=>e.getId()==="activity-reminder"));if(t&&t.isSupported()){this.openEditor(t,e)}}buildMenuItems(){const e=(e,t)=>e.getMenuPosition()-t.getMenuPosition();const t=n.filter((e=>e.isSupported())).sort(e);const i=n.filter((e=>!e.isSupported())).sort(e);const o=[...t,...i];return o.filter((e=>e.isAvailableInMenu())).map((e=>({id:e.getId(),title:e.getMenuTitle(),sectionCode:e.isSupported()?"default":"service",subTitle:"",data:{svgIcon:e.getMenuIcon(),svgIconAfter:{type:e.isSupported()?null:ContextMenuItem.ImageAfterTypes.WEB}},onClickCallback:()=>{this.menu.close((()=>this.onMenuItemClick(e)));return Promise.resolve()}})))}onMenuItemClick(e){if(e.isSupported()){this.openEditor(e)}else{qrauth.open({title:o.getMessage("M_CRM_TIMELINE_SCHEDULER_DESKTOP_VERSION"),redirectUrl:this.entity.detailPageUrl})}}openEditor(e,t={}){this.parentWidget.openWidget("layout",{modal:true,backdrop:{onlyMediumPosition:false,showOnTop:true,forceDismissOnSwipeDown:true,mediumPositionPercent:50,navigationBarColor:"#EEF2F4",swipeAllowed:true,swipeContentAllowed:false,horizontalSwipeAllowed:false,...e.getBackdropParams()}}).then((i=>{i.setTitle({text:e.getTitle()});i.enableNavigationBarBorder(false);i.showComponent(new e({context:t,layout:i,entity:this.entity,onActivityCreate:this.onActivityCreate,onClose:this.onClose,onCancel:this.onCancel,onSkip:this.onSkip}))}))}}i.exports={TimelineScheduler:s}}));
//# sourceMappingURL=extension.map.js