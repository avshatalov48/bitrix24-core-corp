jn.define("intranet/user-mini-profile",((t,e,o)=>{const{Button:r,ButtonSize:s,ButtonDesign:n}=t("ui-system/form/buttons/button");const{Color:i,Indent:l}=t("tokens");const{Box:u}=t("ui-system/layout/box");const{Area:a}=t("ui-system/layout/area");const{Loc:c}=t("loc");const{PortalLogo:f}=t("intranet/portal-logo");const{UserMiniProfileForm:g}=t("intranet/user-mini-profile-form");const{H3:d}=t("ui-system/typography/heading");const{StatusBlock:m}=t("ui-system/blocks/status-block");const{PureComponent:h}=t("layout/pure-component");const{isEmpty:I}=t("utils/object");const{BoxFooter:L}=t("ui-system/layout/dialog-footer");class p extends h{constructor(t){super(t);this.form=null;this.state={logoLoaded:false,profileLoaded:false,primaryFieldSelected:false}}fetchPortalLogo(){f.getPortalLogo().then((t=>{if(!t?.answer?.result){return}const e={title:t.answer.result.title??"",logo24:t.answer.result.logo24??"",logo:t.answer.result.logo?currentDomain+(t.answer.result.logo.src??""):"",defaultLogo:t.answer.result.defaultLogo??[]};this.setState({logoLoaded:true,portalLogo:e})})).catch(console.error)}fetchUserCurrent(){BX.rest.callMethod("user.current").then((t=>{if(!t?.answer?.result){return}const{ID:e,NAME:o,LAST_NAME:r,PERSONAL_MOBILE:s,EMAIL:n,PERSONAL_PHOTO:i}=t.answer.result;this.setState({profileLoaded:true,profile:{profileData:{ID:e,NAME:o,LAST_NAME:r,PERSONAL_MOBILE:s,EMAIL:n},photo:i}})})).catch(console.error)}getProfileForm(){const{profile:t}=this.state;if(I(t)){return null}return new g({...t,ref:this.bindProfileFormRef,scrollToInput:this.scrollToInput})}bindProfileFormRef=t=>{this.formRef=t};getPortalLogoView(){const{portalLogo:t}=this.state;if(I(t)){return null}return new f(t)}componentDidMount(){this.fetchPortalLogo();this.fetchUserCurrent()}getTitle(){return d({color:i.base1,style:{alignSelf:"center",marginBottom:24},text:c.getMessage("INTRANETMOBILE_USER_MINI_PROFILE_TITLE")??""})}onContinue=()=>{this.formRef?.onContinue()};getSubmitButton(){return r({size:s.L,design:n.FILLED,text:c.getMessage("INTRANETMOBILE_USER_MINI_PROFILE_BUTTON_SUBMIT")??"",border:true,onClick:this.onSubmit,testId:"USER_MINI_PROFILE_BUTTON_SUBMIT",stretched:true})}onSubmit=()=>{this.formRef?.submit()};renderButtons(){return L({safeArea:true,keyboardButton:{text:c.getMessage("INTRANETMOBILE_USER_MINI_PROFILE_BUTTON_CONTINUE")??"",onClick:this.onContinue}},this.getSubmitButton())}bindScrollViewRef=t=>{this.scrollViewRef=t};scrollToInput=t=>{const{y:e}=this.scrollViewRef.getPosition(t.contentFieldRef);const o=Application.getPlatform()==="ios"?e-20:e-140;this.scrollViewRef.scrollTo({y:o,animated:true})};render(){const{profileLoaded:t,logoLoaded:e}=this.state;const o=`${currentDomain}/bitrix/mobileapp/intranetmobile/components/intranet/user-mini-profile/images/confetti-background.svg`;if(!t||!e){return m({testId:"USER_MINI_PROFILE_LOADING"})}return u({footer:this.renderButtons(),withScroll:true,resizableByKeyboard:true,style:{position:"relative"},scrollProps:{ref:this.bindScrollViewRef}},Image({resizeMode:"contain",style:{width:"100%",height:127,position:"absolute"},svg:{uri:encodeURI(o)}}),a({},View({style:{paddingTop:l.XL3.toNumber()}},this.getPortalLogoView(),this.getTitle(),this.getProfileForm())))}}o.exports={UserMiniProfile:p}}));(()=>{const{UserMiniProfile:t}=jn.require("intranet/user-mini-profile");layout.showComponent(new t)})();
//# sourceMappingURL=component.map.js