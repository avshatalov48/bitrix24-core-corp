(()=>{const e=e=>jn.require(e);const{selectWholeUserById:t}=e("intranet/statemanager/redux/slices/employees/selector");const{observeListChange:s}=e("intranet/statemanager/redux/slices/employees/observers/stateful-list-observer");const{usersUpserted:n,usersAdded:i}=e("intranet/statemanager/redux/slices/employees");const{usersUpserted:r,usersAdded:o}=e("statemanager/redux/slices/users");const{batchActions:a}=e("statemanager/redux/batched-actions");const l=e("statemanager/redux/store");const{dispatch:m}=l;const{makeLibraryImagePath:u,downloadImages:c}=e("asset-manager");const{Color:h,Component:d,Indent:p}=e("tokens");const{AnalyticsEvent:g}=e("analytics");const{Loc:y}=e("loc");const{TypeGenerator:f}=e("layout/ui/stateful-list/type-generator");const{StatefulList:S}=e("layout/ui/stateful-list");const{SearchLayout:L}=e("layout/ui/search-bar");const{StatusBlock:I}=e("ui-system/blocks/status-block");const{Box:E}=e("ui-system/layout/box");const{ProfileView:b}=e("user/profile");const{UserListSorting:v,UserListMoreMenu:T,UserListFilter:M,DepartmentButton:R}=e("intranet/user-list");const{ListItemType:F,ListItemsFactory:C}=e("intranet/simple-list/items");const{openIntranetInviteWidget:P}=e("intranet/invite-opener-new");const _=Application.getPlatform()==="android";class w extends LayoutComponent{constructor(e){super(e);this.stateFulListRef=null;this.userListFilter=new M({presetId:M.presetType.default,department:M.defaultDepartment});this.search=new L({layout:layout,id:"users",cacheId:`users_${env.userId}`,presetId:this.userListFilter.getPresetId(),searchDataAction:"intranetmobile.employees.getSearchBarPresets",searchDataActionParams:{},onSearch:this.onSearch,onCancel:this.onSearch});this.sorting=new v({type:v.types.WORK_DEPARTMENT,isASC:false});this.moreMenu=new T(this.sorting.getType(),this.sorting.getOrder(),{onSelectSorting:this.onSelectSorting});this.state={sorting:this.sorting.getType(),order:this.sorting.getOrder(),department:this.userListFilter.getDefaultDepartment()};this.scrollOffset=Animated.newCalculatedValue2D(0,0);if(this.scrollOffset.getValue2().diffClampWithConfig){this.departmentTop=this.scrollOffset.getValue2().diffClampWithConfig(-52,p.M.toNumber(),{direction:"reverse",option:"disableTopBounce"})}else{this.departmentTop=p.M.toNumber()}}onMomentumScrollEnd=()=>{const e=p.M.toNumber();const t=this.departmentTop.getValue();if(t!==e&&t!==-52){if(t>-26){const e=t-p.M.toNumber();this.stateFulListRef.scrollBy({x:0,y:e,animated:true,duration:350})}else{const e=-t;this.stateFulListRef.scrollBy({x:0,y:e,animated:true,duration:350})}}};onScrollEndDrag=()=>{this.scrollEndTimer=setTimeout(this.onMomentumScrollEnd,250)};onMomentumScrollBegin=()=>{clearTimeout(this.scrollEndTimer)};componentDidMount(){this.unsubscribeEmployeesObserver=s(l,this.userListFilter.getEmployeesFilter,this.onVisibleEmployeesChange);this.prefetchAssets()}componentWillUnmount(){if(this.unsubscribeEmployeesObserver){this.unsubscribeEmployeesObserver()}}prefetchAssets(){void c([u("install-desktop.svg","recommendation-box","intranet"),u("enable-2fa.svg","recommendation-box","intranet"),u("admin.svg","recommendation-box","intranet"),u("install-mobile.svg","recommendation-box","intranet"),u("empty_employee.svg","empty-states","intranet"),u("empty_search.svg","empty-states","intranet")])}get canInvite(){return BX.componentParameters.get("canInvite",false)}setSorting(e){if(this.sorting.getType()!==e){this.sorting.setType(e);this.moreMenu.setSelectedSorting(e);this.setState({sorting:e},(()=>this.stateFulListRef.reload()))}}setDepartment=e=>{if(this.userListFilter.getDepartment()!==e){this.userListFilter.setDepartment(e);this.setState({department:this.userListFilter.getDepartment()},(()=>this.stateFulListRef.reload()))}};render(){return E({backgroundColor:h.bgPrimary},View({style:{flex:1}},this.renderList()),this.renderDepartmentButton())}renderList(){return new S({testId:"user-list",showAirStyle:true,layout:layout,menuButtons:this.getLayoutMenuButtons(),needInitMenu:true,typeGenerator:{generator:f.generators.bySelectedProperties,properties:["isAdmin","workPosition","employeeStatus","department"],callbacks:{}},actions:{loadItems:"intranetmobile.employees.getUserList"},actionParams:{loadItems:{filterParams:this.getSearchParams(),sortingParams:{type:this.state.sorting}}},actionCallbacks:{loadItems:this.onItemsLoaded},itemType:F.USER,itemFactory:C,itemDetailOpenHandler:this.openUserDetail,getItemCustomStyles:this.getItemCustomStyles,isShowFloatingButton:this.canInvite,onFloatingButtonClick:this.onFloatingButtonClick,onPanListHandler:this.onPanList,getEmptyListComponent:this.getEmptyListComponent,ref:this.onListRef,sortingConfig:this.sorting.getSortingConfig(),showEmptySpaceItem:true,pull:{shouldReloadDynamically:true},onBeforeItemsRender:this.onBeforeItemsRender,onScrollCalculated:{contentOffsetWithoutOverscroll:this.scrollOffset},onMomentumScrollEnd:_?this.onMomentumScrollEnd:null,onMomentumScrollBegin:_?this.onMomentumScrollBegin:null,onScrollEndDrag:_?this.onScrollEndDrag:null})}renderDepartmentButton(){if(this.state.itemsCount>4&&!_){return View({style:{position:"absolute",top:this.departmentTop,width:"100%",alignItems:"center",paddingHorizontal:d.paddingLr.toNumber()}},new R({department:this.state.department,onSelect:this.setDepartment,layout:layout}))}return View({style:{position:"absolute",top:p.M.toNumber(),width:"100%",alignItems:"center",paddingHorizontal:d.paddingLr.toNumber()}},new R({department:this.state.department,onSelect:this.setDepartment,layout:layout}))}getEmptyListComponent=()=>{const e=!(this.userListFilter.isDefault()||this.userListFilter.isEmpty());let t=y.getMessage("M_INTRANET_USER_LIST_EMPTY_EMPLOYEE_TITLE");let s=y.getMessage("M_INTRANET_USER_LIST_EMPTY_EMPLOYEE_DESCRIPTION");let n=u("empty_employee.svg","empty-states","intranet");if(e){t=y.getMessage("M_INTRANET_USER_LIST_SEARCH_EMPTY_TITLE");s=y.getMessage("M_INTRANET_USER_LIST_SEARCH_EMPTY_DESCRIPTION");n=u("empty_search.svg","empty-states","intranet")}return I({testId:"empty-state",title:t,description:s,emptyScreen:true,onRefresh:()=>{},image:Image({resizeMode:"contain",style:{width:202,height:172},svg:{uri:n}})})};getLayoutMenuButtons(){return[this.search.getSearchButton(),this.moreMenu.getMenuButton()]}getSearchParams(){return{department:this.userListFilter.getDepartment().id,presetId:this.userListFilter.getPresetId(),searchString:this.userListFilter.getSearchString()}}static get presetsIds(){return{company:"company",extranet:"extranet",fired:"fired",invited:"invited",waitConfirmation:"wait_confirmation"}}getItemCustomStyles=(e,t,s)=>{if(e.key==="EmptySpace_top"){return{minHeight:p.XL.toNumber()+52+p.M.toNumber()}}return{}};onBeforeItemsRender=e=>e.map(((t,s)=>({...t,showBorder:s!==e.length-1,canInvite:this.canInvite})));onVisibleEmployeesChange=({moved:e,removed:t,added:s,created:n})=>{if(!this.stateFulListRef||this.stateFulListRef.isLoading()){setTimeout((()=>{this.onVisibleEmployeesChange({moved:e,removed:t,added:s,created:n})}),30);return}if(t.length>0){void this.removeEmployees(t);if(this.search?.searchLayoutView){this.search.fetchPresets(true)}}if(s.length>0){void this.addOrRestoreEmployees(s)}if(e.length>0){void this.updateEmployees(e)}};removeEmployees(e){if(e.length>0){const t=e.map((({id:e})=>e));return this.stateFulListRef.deleteItem(t)}return Promise.resolve()}addOrRestoreEmployees(e){}updateEmployees(e){return this.stateFulListRef.updateItemsData(e)}onSelectSorting=e=>{this.setSorting(e)};onFloatingButtonClick=()=>{P({analytics:(new g).setSection("userList"),parentLayout:layout,onInviteSentHandler:this.onInviteSuccess})};onInviteSuccess=e=>{this.stateFulListRef.addItemsFromPull(e)};onPanList=()=>{this.search.close()};onListRef=e=>{this.stateFulListRef=e};onItemsLoaded=(e,t)=>{const{items:s=[],users:l=[]}=e||{};const u=t==="cache";const c=s;const h=l;const d=[];if(c.length>0){d.push(u?o(c):r(c))}if(h.length>0){d.push(u?i(h):n(h))}if(d.length>0){m(a(d))}this.setState({itemsCount:s.length})};openUserDetail=e=>{const s=t(l.getState(),e);if(!s){return}const{id:n,avatarSize100:i,fullName:r,link:o,workPosition:a}=s;b.open({userId:n,imageUrl:encodeURI(i),title:y.getMessage("PROFILE_INFO"),workPosition:a,name:r,url:o})};showSearch=()=>{this.search.show()};onSearch=({text:e,presetId:t})=>{this.userListFilter.setPresetId(t);this.userListFilter.setSearchString(e);this.setState({},(()=>this.stateFulListRef.reload()))}}layout.showComponent(new w({currentUserId:Number(env.userId)}))})();
//# sourceMappingURL=component.map.js