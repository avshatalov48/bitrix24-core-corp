jn.define("intranet/reinvite",((e,t,n)=>{const{Loc:i}=e("loc");const{Type:s}=e("type");const{Color:o,Indent:r,Component:a}=e("tokens");const{isPhoneNumber:u}=e("utils/phone");const{isValidEmail:l}=e("utils/email");const{BottomSheet:d}=e("bottom-sheet");const{showErrorToast:c}=e("toast");const{Icon:I}=e("ui-system/blocks/icon");const{Area:g}=e("ui-system/layout/area");const{Box:T}=e("ui-system/layout/box");const{BoxFooter:p}=e("ui-system/layout/dialog-footer");const{ButtonSize:h,ButtonDesign:E,Button:m}=e("ui-system/form/buttons/button");const{InputSize:N,InputDesign:_,InputMode:b,PhoneInput:M}=e("ui-system/form/inputs/phone");const{EmailInput:R,InputDomainIconPlace:y}=e("ui-system/form/inputs/email");const{Chip:f}=e("ui-system/blocks/chips/chip");const{Text4:v}=e("ui-system/typography/text");const{BBCodeText:S}=e("ui-system/typography/bbcodetext");const{ReduxAvatar:x}=e("layout/ui/user/avatar");const{InviteStatusBox:B}=e("intranet/invite-status-box");const A=e("statemanager/redux/store");const{selectWholeUserById:C}=e("intranet/statemanager/redux/slices/employees/selector");const{RunActionExecutor:L}=e("rest/run-action-executor");const O=Application.getPlatform()==="android";const P="phone";const H="email";class U extends LayoutComponent{constructor(e){super(e);this.layoutWidget=null;this.canOpen=false;this.inviteStatusBoxIsOpened=false;this.user=C(A.getState(),Number(this.userId))??{};this.state={phone:this.user.personalMobile,email:this.user.email,inputError:null}}get userId(){return this.props.userId}isEmailInvite(){return s.isStringFilled(this.user.email)}isPhoneInvite(){return s.isStringFilled(this.user.personalMobile)}static async open(e){const t=e.parentWidget||PageManager;const n=new U(e);await n.fetchInviteSettings(t);if(!n.canOpen){return}const s=new d({component:n,titleParams:{type:"dialog",text:e.title??i.getMessage("M_INTRANET_REINVITE_TITLE"),largeMode:true}});s.setParentWidget(t).setBackgroundColor(o.bgSecondary.toHex()).setNavigationBarColor(o.bgSecondary.toHex()).disableShowOnTop().disableOnlyMediumPosition().setMediumPositionHeight(U.getStartingLayoutHeight()).enableBounce().enableSwipe().disableHorizontalSwipe().enableResizeContent().enableAdoptHeightByKeyboard().open().then((e=>{n.layoutWidget=e})).catch((e=>{console.error("Failed to open widget:",e)}))}static getStartingLayoutHeight(){const e=44;const t=a.areaPaddingTFirst.toNumber();const n=32+r.XL2.toNumber()+r.XS.toNumber();const i=42+r.M.toNumber()+r.XL2.toNumber();const s=42+r.XL2.toNumber()*2;const o=66+r.M.toNumber();return e+t+n+i+s+o}async fetchInviteSettings(e){new L("intranetmobile.invite.getInviteSettings").setCacheTtl(3600*24).setCacheId("inviteSettings").setHandler((t=>this.fetchInviteSettingsHandler(t,e))).setCacheHandler((t=>this.fetchInviteSettingsHandler(t,e))).call(true)}fetchInviteSettingsHandler=(e,t)=>{const n=e.errors&&e.errors.length>0;if(n){c(e.errors[0].message);this.canOpen=false;return}const{isBitrix24Included:i,adminInBoxRedirectLink:s}=e.data;if(!i){if(env.isAdmin){this.openBoxAdminCanInviteInWeb(s,t)}else{this.openBoxOnlyAdminCanInvite(t)}this.canOpen=false;return}this.canOpen=true};openBoxAdminCanInviteInWeb(e,t){if(this.inviteStatusBoxIsOpened){return}this.inviteStatusBoxIsOpened=true;B.open({backdropTitle:i.getMessage("M_INTRANET_REINVITE_TITLE"),testId:"status-box-reinvite-in-web",imageName:"user-locked.svg",description:i.getMessage("M_INTRANET_REINVITE_ADMIN_ONLY_IN_WEB_BOX_TEXT"),buttonText:i.getMessage("M_INTRANET_REINVITE_GO_TO_WEB_BUTTON_TEXT"),parentWidget:t,onButtonClick:()=>{setTimeout((()=>{qrauth.open({redirectUrl:e,showHint:true})}),500)}})}openBoxOnlyAdminCanInvite(e){if(this.inviteStatusBoxIsOpened){return}this.inviteStatusBoxIsOpened=true;B.open({backdropTitle:i.getMessage("M_INTRANET_REINVITE_TITLE"),testId:"status-box-no-permission",imageName:"user-locked.svg",parentWidget:e,description:i.getMessage("M_INTRANET_REINVITE_ADMIN_ONLY_BOX_TEXT"),buttonText:i.getMessage("M_INTRANET_REINVITE_DISABLED_BOX_BUTTON_TEXT")})}componentDidMount(){super.componentDidMount();Keyboard.on(Keyboard.Event.WillHide,(()=>{this.layoutWidget.setBottomSheetHeight(U.getStartingLayoutHeight())}))}componentWillUnmount(){super.componentWillUnmount();Keyboard.on(Keyboard.Event.WillHide,(()=>{}))}render(){return T({resizableByKeyboard:true,safeArea:{bottom:true},footer:this.renderFooter()},g({isFirst:true,excludePaddingSide:{bottom:true},style:{flex:1,justifyContent:"space-between"}},View({style:{flexDirection:"row",flexWrap:"wrap",justifyContent:"center",paddingHorizontal:r.M.toNumber()}},this.renderUserChip(),this.renderInput(),this.renderDescription())))}renderDescription(){const e=this.isEmailInvite()?i.getMessage("M_INTRANET_REINVITE_DESCRIPTION_EMAIL_TEXT"):i.getMessage("M_INTRANET_REINVITE_DESCRIPTION_PHONE_TEXT");const t=i.getMessage("M_INTRANET_REINVITE_DESCRIPTION_BUTTON_TEXT");const n="17729332";const s=helpdesk.getArticleUrl(n);return View({style:{paddingTop:r.M.toNumber(),paddingHorizontal:r.XL2.toNumber()}},S({style:{textAlign:"center"},color:o.base2.toHex(),size:4,linksUnderline:false,onLinkClick:()=>{helpdesk.openHelpArticle(n,"helpdesk")},value:`${e} [COLOR=${o.accentMainLink.toHex()}][URL=${s}]${t}[/URL][/COLOR]`}))}renderFooter(){return p({safeArea:!O,keyboardButton:{text:i.getMessage("M_INTRANET_REINVITE_SEND_BUTTON"),loading:this.state.loading,onClick:this.save,testId:"reinvite-keyboard-send-button"}},m({design:E.FILLED,size:h.L,text:i.getMessage("M_INTRANET_REINVITE_SEND_BUTTON"),stretched:true,onClick:this.save,testId:"reinvite-send-button",disabled:this.state.inputError!==null}))}renderUserChip(){return f({style:{marginBottom:r.XL2.toNumber(),marginTop:r.XS.toNumber()},backgroundColor:o.bgPrimary,borderColor:o.bgSeparatorPrimary,compact:true,children:[x({id:this.userId}),v({text:this.user.fullName,style:{marginLeft:r.XS.toNumber()}})]})}renderInput(){const{phone:e,inputError:t,email:n}=this.state;if(this.isEmailInvite()){return R({value:n,style:{marginTop:r.M.toNumber(),marginBottom:r.XL2.toNumber()},label:i.getMessage("M_INTRANET_EMAIL_INPUT_TITLE"),size:N.L,design:_.GREY,mode:b.STROKE,align:"center",focus:true,error:t??null,errorText:t,domainIconPlace:y.LEFT,leftContent:I.MAIL,onChange:this.onChangeEmail,forwardRef:this.handleInputRef,testId:"reinvite-email-input"})}if(this.isPhoneInvite()){return M({value:e,style:{marginTop:r.M.toNumber(),marginBottom:r.XL2.toNumber()},label:i.getMessage("M_INTRANET_PHONE_INPUT_TITLE"),size:N.L,design:_.GREY,mode:b.STROKE,align:"center",focus:true,error:t??null,errorText:t,onChange:this.onChangePhone,forwardRef:this.handleInputRef,testId:"reinvite-phone-input"})}console.error("User must have either phone or email to reinvite");return null}onChangeEmail=e=>{this.setState({email:e,inputError:s.isStringFilled(e)?null:i.getMessage("M_INTRANET_REINVITE_EMAIL_INPUT_EMPTY_EMAIL")})};onChangePhone=e=>{this.setState({phone:e,inputError:s.isStringFilled(e)?null:i.getMessage("M_INTRANET_REINVITE_PHONE_INPUT_EMPTY_NUMBER")})};handleInputRef=e=>{this.inputRef=e;if(this.inputRef){this.inputRef.focus()}};save=()=>{const{phone:e,email:t,inputError:n}=this.state;if(n){return}if(e&&!u(e)){this.setState({inputError:i.getMessage("M_INTRANET_REINVITE_PHONE_INPUT_INCORRECT_NUMBER")});return}if(t&&!l(t)){this.setState({inputError:i.getMessage("M_INTRANET_REINVITE_EMAIL_INPUT_INCORRECT_EMAIL")});return}const s=e??t;const o=e?P:H;if(this.props.onSave){this.props.onSave(s,o)}this.layoutWidget.close()}}n.exports={Reinvite:U}}));
//# sourceMappingURL=extension.map.js