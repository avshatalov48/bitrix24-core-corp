jn.define("intranet/create-department",((e,t,n)=>{const{Loc:r}=e("loc");const{Type:a}=e("type");const{Color:o,Corner:s,Indent:i,Component:d}=e("tokens");const{Area:l}=e("ui-system/layout/area");const{Box:T}=e("ui-system/layout/box");const{BoxFooter:g}=e("ui-system/layout/dialog-footer");const{IconView:u,Icon:c}=e("ui-system/blocks/icon");const{InputSize:E,InputDesign:p,InputMode:m,StringInput:h}=e("ui-system/form/inputs/string");const{ButtonSize:_,ButtonDesign:R,Button:N}=e("ui-system/form/buttons/button");const{UserSelectorCard:A}=e("intranet/layout/user-selector-card");const{DepartmentSelectorCard:I}=e("intranet/layout/department-selector-card");const{showToast:M,showErrorToast:f}=e("toast");const{BottomSheet:S}=e("bottom-sheet");const y=Application.getPlatform()==="android";class D extends LayoutComponent{static open(e){const t=e.parentWidget||PageManager;const n=new D(e);const a=new S({component:n,titleParams:{type:"dialog",text:e.title||r.getMessage("M_INTRANET_CREATE_DEPARTMENT_TITLE"),largeMode:true}});a.setParentWidget(t).setBackgroundColor(o.bgSecondary.toHex()).setNavigationBarColor(o.bgSecondary.toHex()).disableShowOnTop().disableOnlyMediumPosition().setMediumPositionHeight(D.getStartingLayoutHeight()).enableBounce().enableSwipe().disableHorizontalSwipe().enableResizeContent().enableAdoptHeightByKeyboard().open().then((e=>{n.layoutWidget=e})).catch((()=>{}))}static getStartingLayoutHeight(){const e=44;const t=d.areaPaddingB.toNumber()+d.areaPaddingTFirst.toNumber();const n=48;const r=42*2+2*i.XL2.toNumber();const a=42+i.XL2.toNumber();return e+t+n+r+a+(y?i.XL2.toNumber():0)}constructor(e){super(e);this.nameInputRef=null;this.layoutWidget=null;this.state={parentDepartmentId:null,headOfDepartmentId:env.userId,departmentName:"",error:null,loading:false}}get showToastAfterCreation(){return this.props.showToastAfterCreation??true}componentDidMount(){Keyboard.on(Keyboard.Event.WillHide,(()=>{this.layoutWidget.setBottomSheetHeight(D.getStartingLayoutHeight())}))}render(){return T({resizableByKeyboard:true,safeArea:{bottom:true},footer:this.renderFooter()},l({isFirst:true},View({style:{flexDirection:"row",alignItems:"center"}},this.renderDepartmentIcon(),this.renderDepartmentNameInput()),View({style:{flexDirection:"row",flexWrap:"wrap"}},this.renderParentDepartmentSelector(),this.renderHeadOfDepartmentSelector())))}renderFooter(){return g({safeArea:!y,keyboardButton:{text:r.getMessage("M_INTRANET_CREATE_DEPARTMENT_CREATE_BUTTON_TEXT"),loading:this.state.loading,onClick:this.save}},N({design:R.FILLED,size:_.L,text:r.getMessage("M_INTRANET_CREATE_DEPARTMENT_CREATE_BUTTON_TEXT"),stretched:true,onClick:this.save,loading:this.state.loading}))}renderDepartmentIcon(){return View({style:{backgroundColor:o.accentSoftBlue2.toHex(),flexDirection:"row",justifyContent:"center",alignContent:"center",alignItems:"center",width:48,height:48,borderRadius:s.M.toNumber()}},u({icon:c.COMPANY,size:31,color:o.accentMainPrimaryalt}))}renderDepartmentNameInput(){return View({style:{flex:1,marginLeft:i.L.toNumber()}},h({placeholder:r.getMessage("M_INTRANET_CREATE_DEPARTMENT_NAME_INPUT_TITLE"),size:E.L,design:p.PRIMARY,mode:m.STROKE,align:"left",focus:true,error:this.state.error||false,errorText:this.state.error,onChange:e=>{const t=a.isStringFilled(e)?null:r.getMessage("M_INTRANET_CREATE_DEPARTMENT_NAME_INPUT_ERROR");this.setState({departmentName:e,error:t})},forwardRef:this.handleInputRef}))}handleInputRef=e=>{this.nameInputRef=e;this.nameInputRef.focus()};renderParentDepartmentSelector(){return View({style:{width:"100%",marginTop:i.XL2.toNumber(),borderBottomWidth:1,borderBottomColor:o.bgSeparatorSecondary.toHex()}},new I({title:r.getMessage("M_INTRANET_CREATE_DEPARTMENT_PARENT_DEPARTMENT_SELECTOR_TITLE"),parentWidget:this.layoutWidget||PageManager,onViewHidden:()=>this.nameInputRef.focus(),onChange:e=>this.setState({parentDepartmentId:e}),onLoadRootDepartment:e=>this.setState({parentDepartmentId:e})}))}renderHeadOfDepartmentSelector(){return View({style:{width:"100%",marginTop:i.XL2.toNumber()}},new A({title:r.getMessage("M_INTRANET_CREATE_DEPARTMENT_HEAD_OF_DEPARTMENT_SELECTOR_TITLE"),parentWidget:this.layoutWidget||PageManager,onViewHidden:()=>this.nameInputRef.focus(),onChange:e=>this.setState({headOfDepartmentId:e})}))}save=()=>{if(this.state.loading){return}if(!a.isStringFilled(this.state.departmentName)){this.setState({error:r.getMessage("M_INTRANET_CREATE_DEPARTMENT_NAME_INPUT_ERROR")});return}const e={name:this.state.departmentName,parentDepartmentId:this.state.parentDepartmentId,headOfDepartmentId:this.state.headOfDepartmentId};this.setState({loading:true},(()=>{BX.ajax.runAction("intranetmobile.departments.createDepartment",{data:e}).then((e=>{if(e.status==="success"){if(this.showToastAfterCreation){M({message:r.getMessage("M_INTRANET_CREATE_DEPARTMENT_SAVE_TOAST_SUCCESS_MESSAGE")},this.props.parentWidget)}if(this.props.onSave){this.props.onSave({id:e.data.id,title:this.state.departmentName})}this.setState({loading:false},(()=>{this.layoutWidget.close()}))}else{f({message:r.getMessage("M_INTRANET_CREATE_DEPARTMENT_SAVE_TOAST_ERROR_MESSAGE")},this.props.parentWidget);this.setState({loading:false})}})).catch((e=>console.error(e)))}))}}n.exports={CreateDepartment:D}}));
//# sourceMappingURL=extension.map.js