jn.define("intranet/invite-opener-new",((e,n,t)=>{const{Notify:i}=e("notify");const{Invite:r,IntranetInviteAnalytics:o}=e("intranet/invite-new");const{Alert:a}=e("alert");const{Loc:s}=e("loc");const{InviteStatusBox:I}=e("intranet/invite-status-box");const{Tourist:l}=e("tourist");const T={POSSIBILITIES_RESTRICTED:"Invite possibilities restricted",PERMISSIONS_RESTRICTED:"Invite permissions restricted"};const E=e=>{if(env.isCollaber||env.extranet){return}i.showIndicatorLoading();f().then((n=>d(n,e)),(n=>c(n,e))).catch((e=>console.error(e))).finally((()=>i.hideCurrentIndicator()))};const c=(e,n)=>{const t=e.errors&&e.errors.length>0;if(t){N(e.errors,n.onInviteError)}};const d=(e,n)=>{g();const t=e.errors&&e.errors.length>0;if(t){N(e.errors,n.onInviteError);return}const{canCurrentUserInvite:i,canInviteByPhone:r,canInviteByLink:o,isBitrix24Included:a,adminInBoxRedirectLink:s}=e.data;if(!a){if(env.isAdmin){v(n.onInviteError,s,n.parentLayout)}else{u(n.onInviteError,n.parentLayout)}return}if(!i||!r&&!o){_(n.onInviteError,n.parentLayout);return}p({...m(e.data),...n})};const g=()=>{l.ready().then((()=>{if(l.firstTime("visit_invitations")){return l.remember("visit_invitations").then((()=>{BX.postComponentEvent("onSetUserCounters",[{[String(env.siteId)]:{menu_invite:0}}])})).catch(console.error)}return Promise.resolve()})).catch(console.error)};const v=(e,n,t=PageManager)=>{I.open({backdropTitle:s.getMessage("INTRANET_INVITE_OPENER_TITLE"),testId:"status-box-invite-in-web",imageName:"user-locked.svg",description:s.getMessage("INTRANET_INVITE_ADMIN_ONLY_IN_WEB_BOX_TEXT"),buttonText:s.getMessage("INTRANET_INVITE_GO_TO_WEB_BUTTON_TEXT"),parentWidget:t,onButtonClick:()=>{setTimeout((()=>{qrauth.open({redirectUrl:n,showHint:true,analyticsSection:"userList"})}),500)}});if(e){e([new Error(T.POSSIBILITIES_RESTRICTED)])}};const u=(e,n=PageManager)=>{I.open({backdropTitle:s.getMessage("INTRANET_INVITE_OPENER_TITLE"),testId:"status-box-no-permission",imageName:"user-locked.svg",parentWidget:n,description:s.getMessage("INTRANET_INVITE_ADMIN_ONLY_BOX_TEXT"),buttonText:s.getMessage("INTRANET_INVITE_DISABLED_BOX_BUTTON_TEXT")});if(e){e([new Error(T.PERMISSIONS_RESTRICTED)])}};const _=(e,n=PageManager)=>{I.open({backdropTitle:s.getMessage("INTRANET_INVITE_OPENER_TITLE"),testId:"status-box-no-invitation",imageName:"no-invitation.svg",parentWidget:n,description:s.getMessage("INTRANET_INVITE_DISABLED_BOX_TEXT"),buttonText:s.getMessage("INTRANET_INVITE_DISABLED_BOX_BUTTON_TEXT")});if(e){e([new Error(T.PERMISSIONS_RESTRICTED)])}};const N=(e,n)=>{a.alert("",r.getAjaxErrorText(e));if(n){n(e)}};const f=()=>BX.ajax.runAction("intranetmobile.invite.getInviteSettings");const m=e=>({adminConfirm:e.adminConfirm??false,inviteLink:e.inviteLink??"",creatorEmailConfirmed:e.creatorEmailConfirmed??false,sharingMessage:e.sharingMessage??"",canInviteByPhone:e.canInviteByPhone??false,canInviteByLink:e.canInviteByLink??false});const p=({parentLayout:e=null,openWidgetConfig:n={},analytics:t={},onInviteSentHandler:i=null,onInviteError:a=null,onViewHiddenWithoutInvitingHandler:I=null,inviteLink:l="",canInviteByPhone:T=false,canInviteByLink:E=false,creatorEmailConfirmed:c=false,sharingMessage:d="",multipleInvite:g=true,adminConfirm:v=false})=>{const u=new o({analytics:t});u.sendDrawerOpenEvent();u.setDepartmentParam(false);const _={enableNavigationBarBorder:false,titleParams:{text:s.getMessage("INTRANET_INVITE_OPENER_TITLE"),type:"dialog"},modal:true,backdrop:{showOnTop:false,onlyMediumPosition:false,mediumPositionHeight:516,bounceEnable:true,swipeAllowed:true,swipeContentAllowed:false,horizontalSwipeAllowed:false,shouldResizeContent:true,adoptHeightByKeyboard:true},...n,onReady:t=>{let o=false;let s=false;t.showComponent(new r({layout:t,parentLayout:e,openWidgetConfig:n,analytics:u,onInviteSentHandler:e=>{o=true;if(i){i(e)}},onInviteError:e=>{s=true;if(a){a(e)}},inviteLink:l,canInviteByPhone:T,canInviteByLink:E,creatorEmailConfirmed:c,sharingMessage:d,multipleInvite:g,adminConfirm:v}));t.on("onViewRemoved",(()=>{if(!o&&!s&&I){I()}}))}};if(e){e.openWidget("layout",_);return}PageManager.openWidget("layout",_)};t.exports={openIntranetInviteWidget:E,ErrorCode:T}}));
//# sourceMappingURL=extension.map.js