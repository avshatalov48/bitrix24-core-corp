{"version":3,"file":"utils.bundle.js","sources":["../src/utils.js"],"sourcesContent":["import {Type} from \"main.core\";\n\nclass Utils\n{\n\tconstructor()\n\t{\n\t};\n\n\tgetFileMimeType = (fileType) => {\n\t\tfileType = fileType.toString().toLowerCase();\n\n\t\tif (fileType.indexOf('/') !== -1) // iOS old form\n\t\t{\n\t\t\treturn fileType;\n\t\t}\n\n\t\tlet\n\t\t\tresult = '';\n\n\t\tswitch (fileType)\n\t\t{\n\t\t\tcase 'png':\n\t\t\t\tresult = 'image/png';\n\t\t\t\tbreak;\n\t\t\tcase 'gif':\n\t\t\t\tresult = 'image/gif';\n\t\t\t\tbreak;\n\t\t\tcase 'jpg':\n\t\t\tcase 'jpeg':\n\t\t\t\tresult = 'image/jpeg';\n\t\t\t\tbreak;\n\t\t\tcase 'heic':\n\t\t\t\tresult = 'image/heic';\n\t\t\t\tbreak;\n\t\t\tcase 'mp3':\n\t\t\t\tresult = 'audio/mpeg';\n\t\t\t\tbreak;\n\t\t\tcase 'mp4':\n\t\t\t\tresult = 'video/mp4';\n\t\t\t\tbreak;\n\t\t\tcase 'mpeg':\n\t\t\t\tresult = 'video/mpeg';\n\t\t\t\tbreak;\n\t\t\tcase 'ogg':\n\t\t\t\tresult = 'video/ogg';\n\t\t\t\tbreak;\n\t\t\tcase 'mov':\n\t\t\t\tresult = 'video/quicktime';\n\t\t\t\tbreak;\n\t\t\tcase 'zip':\n\t\t\t\tresult = 'application/zip';\n\t\t\t\tbreak;\n\t\t\tcase 'php':\n\t\t\t\tresult = 'text/php';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tresult = '';\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tgetType = (mimeType) => {\n\t\tlet result = mimeType.substring(0, mimeType.indexOf('/'));\n\n\t\tif (\n\t\t\tresult !== 'image'\n\t\t\t&& result !== 'video'\n\t\t\t&& result !== 'audio'\n\t\t)\n\t\t{\n\t\t\tresult = 'file';\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tgetResizeOptions = (type) => {\n\t\tconst\n\t\t\tmimeType = BX.MobileUtils.getFileMimeType(type),\n\t\t\tfileType = BX.MobileUtils.getType(mimeType);\n\n\t\treturn (\n\t\t\t(\n\t\t\t\tfileType === 'image'\n\t\t\t\t&& mimeType !== 'image/gif'\n\t\t\t)\n\t\t\t|| fileType === 'video'\n\t\t\t\t? {\n\t\t\t\t\tquality: 80,\n\t\t\t\t\twidth: 1920,\n\t\t\t\t\theight: 1080\n\t\t\t\t}\n\t\t\t\t: null\n\t\t);\n\t};\n\n\tgetUploadFilename = (filename, type) => {\n\t\tconst\n\t\t\tmimeType = BX.MobileUtils.getFileMimeType(type),\n\t\t\tfileType = BX.MobileUtils.getType(mimeType);\n\n\t\tif (\n\t\t\tfileType === 'image'\n\t\t\t|| fileType === 'video'\n\t\t)\n\t\t{\n\t\t\tlet extension = filename.split('.').slice(-1)[0].toLowerCase();\n\t\t\tif (mimeType === 'image/heic')\n\t\t\t{\n\t\t\t\textension = 'jpg';\n\t\t\t}\n\t\t\tfilename = 'mobile_file_' + (new Date).toJSON().slice(0, 19).replace('T', '_').split(':').join('-') + '.' + extension;\n\t\t}\n\n\t\treturn filename;\n\t};\n\n\tstatic htmlWithInlineJS(node: HTMLElement, html, params = {}): Promise | string\n\t{\n\t\tconst r = {\n\t\t\tscript: /<script([^>]*)>/ig,\n\t\t\tscript_end: /<\\/script>/ig,\n\t\t\tscript_src: /src=[\"\\']([^\"\\']+)[\"\\']/i,\n\t\t\tscript_type: /type=[\"\\']([^\"\\']+)[\"\\']/i,\n\t\t\tspace: /\\s+/,\n\t\t\tltrim: /^[\\s\\r\\n]+/g,\n\t\t\trtrim: /[\\s\\r\\n]+$/g,\n\t\t\tstyle: /<link.*?(rel=\"stylesheet\"|type=\"text\\/css\")[^>]*>/i,\n\t\t\tstyle_href: /href=[\"\\']([^\"\\']+)[\"\\']/i\n\t\t};\n\n\t\ttype JsItem = {\n\t\t\tisInternal: boolean,\n\t\t\tJS: string,\n\t\t};\n\n\t\tfunction makeIterable(value: any): Array<any>\n\t\t{\n\t\t\treturn Type.isArray(value) ? value : [value];\n\t\t}\n\n\t\tfunction externalStyles(acc: Array<string>, item: ?string)\n\t\t{\n\t\t\tif (Type.isString(item) && item !== '')\n\t\t\t{\n\t\t\t\tacc.push(item);\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}\n\n\t\tfunction externalScripts(acc: Array<string>, item: JsItem)\n\t\t{\n\t\t\tif (!item.isInternal)\n\t\t\t{\n\t\t\t\tacc.push(item.JS);\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}\n\n\t\tfunction inlineScripts(acc: Array<string>, item: JsItem)\n\t\t{\n\t\t\tif (item.isInternal)\n\t\t\t{\n\t\t\t\tacc.push(item.JS);\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}\n\n\t\tfunction loadAll(items: Array<string>): Promise<void>\n\t\t{\n\t\t\tconst itemsList = makeIterable(items);\n\n\t\t\tif (!itemsList.length)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tBX.load(itemsList, resolve);\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isNil(html) && Type.isDomNode(node))\n\t\t{\n\t\t\treturn node.innerHTML;\n\t\t}\n\n\t\t// eslint-disable-next-line\n\t\tconst parsedHtml = BX.processHTML(html);\n\t\tconst externalCss = parsedHtml.STYLE.reduce(externalStyles, []);\n\t\tconst externalJs = parsedHtml.SCRIPT.reduce(externalScripts, []);\n\t\tconst inlineJs = parsedHtml.SCRIPT.reduce(inlineScripts, []);\n\n\t\tlet\n\t\t\tinlineJsString = '',\n\t\t\tinlineJsStringNode = ''\n\t\t;\n\n\t\t// eslint-disable-next-line\n\t\tinlineJs.forEach(script => {\n\t\t\tinlineJsString += \"\\n\" + script;\n\t\t});\n\n\t\tif (inlineJsString.length > 0)\n\t\t{\n\t\t\tinlineJsStringNode = `<span data-type=\"inline-script\"><script>${inlineJsString}</script></span>`;\n\t\t}\n\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tif (params.htmlFirst || (!externalJs.length && !externalCss.length))\n\t\t\t{\n\t\t\t\tnode.innerHTML = parsedHtml.HTML + inlineJsStringNode;\n\t\t\t}\n\t\t}\n\n\t\treturn Promise\n\t\t\t.all([\n\t\t\t\tloadAll(externalJs),\n\t\t\t\tloadAll(externalCss),\n\t\t\t])\n\t\t\t.then(() => {\n\n\t\t\t\tif (Type.isDomNode(node) && (externalJs.length > 0 || externalCss.length > 0))\n\t\t\t\t{\n\t\t\t\t\tnode.innerHTML = parsedHtml.HTML + inlineJsStringNode;\n\t\t\t\t}\n\n\t\t\t\tBX.evalGlobal(inlineJsString);\n\n\t\t\t\tif (Type.isFunction(params.callback))\n\t\t\t\t{\n\t\t\t\t\tparams.callback();\n\t\t\t\t}\n\t\t\t});\n\t}\n}\n\nlet MobileUtils = new Utils;\n\nexport {\n\tUtils,\n\tMobileUtils\n};\n"],"names":["Utils","fileType","toString","toLowerCase","indexOf","result","mimeType","substring","type","BX","MobileUtils","getFileMimeType","getType","quality","width","height","filename","extension","split","slice","Date","toJSON","replace","join","node","html","params","makeIterable","value","Type","isArray","externalStyles","acc","item","isString","push","externalScripts","isInternal","JS","inlineScripts","loadAll","items","itemsList","length","Promise","resolve","load","isNil","isDomNode","innerHTML","parsedHtml","processHTML","externalCss","STYLE","reduce","externalJs","SCRIPT","inlineJs","inlineJsString","inlineJsStringNode","forEach","script","htmlFirst","HTML","all","then","evalGlobal","isFunction","callback"],"mappings":";;;KAEMA;CAEL,mBACA;CAAA;CAAA,yDAGkB,UAACC,QAAD,EAAc;CAC/BA,MAAAA,QAAQ,GAAGA,QAAQ,CAACC,QAAT,GAAoBC,WAApB,EAAX;;CAEA,UAAIF,QAAQ,CAACG,OAAT,CAAiB,GAAjB,MAA0B,CAAC,CAA/B;CACA;CACC,iBAAOH,QAAP;CACA;;CAED,UACCI,MAAM,GAAG,EADV;;CAGA,cAAQJ,QAAR;CAEC,aAAK,KAAL;CACCI,UAAAA,MAAM,GAAG,WAAT;CACA;;CACD,aAAK,KAAL;CACCA,UAAAA,MAAM,GAAG,WAAT;CACA;;CACD,aAAK,KAAL;CACA,aAAK,MAAL;CACCA,UAAAA,MAAM,GAAG,YAAT;CACA;;CACD,aAAK,MAAL;CACCA,UAAAA,MAAM,GAAG,YAAT;CACA;;CACD,aAAK,KAAL;CACCA,UAAAA,MAAM,GAAG,YAAT;CACA;;CACD,aAAK,KAAL;CACCA,UAAAA,MAAM,GAAG,WAAT;CACA;;CACD,aAAK,MAAL;CACCA,UAAAA,MAAM,GAAG,YAAT;CACA;;CACD,aAAK,KAAL;CACCA,UAAAA,MAAM,GAAG,WAAT;CACA;;CACD,aAAK,KAAL;CACCA,UAAAA,MAAM,GAAG,iBAAT;CACA;;CACD,aAAK,KAAL;CACCA,UAAAA,MAAM,GAAG,iBAAT;CACA;;CACD,aAAK,KAAL;CACCA,UAAAA,MAAM,GAAG,UAAT;CACA;;CACD;CACCA,UAAAA,MAAM,GAAG,EAAT;CArCF;;CAwCA,aAAOA,MAAP;CACA,KAvDD;CAAA,iDAyDU,UAACC,QAAD,EAAc;CACvB,UAAID,MAAM,GAAGC,QAAQ,CAACC,SAAT,CAAmB,CAAnB,EAAsBD,QAAQ,CAACF,OAAT,CAAiB,GAAjB,CAAtB,CAAb;;CAEA,UACCC,MAAM,KAAK,OAAX,IACGA,MAAM,KAAK,OADd,IAEGA,MAAM,KAAK,OAHf,EAKA;CACCA,QAAAA,MAAM,GAAG,MAAT;CACA;;CAED,aAAOA,MAAP;CACA,KAtED;CAAA,0DAwEmB,UAACG,IAAD,EAAU;CAC5B,UACCF,QAAQ,GAAGG,EAAE,CAACC,WAAH,CAAeC,eAAf,CAA+BH,IAA/B,CADZ;CAAA,UAECP,QAAQ,GAAGQ,EAAE,CAACC,WAAH,CAAeE,OAAf,CAAuBN,QAAvB,CAFZ;CAIA,aAEEL,QAAQ,KAAK,OAAb,IACGK,QAAQ,KAAK,WAFjB,IAIGL,QAAQ,KAAK,OAJhB,GAKG;CACDY,QAAAA,OAAO,EAAE,EADR;CAEDC,QAAAA,KAAK,EAAE,IAFN;CAGDC,QAAAA,MAAM,EAAE;CAHP,OALH,GAUG,IAXJ;CAaA,KA1FD;CAAA,2DA4FoB,UAACC,QAAD,EAAWR,IAAX,EAAoB;CACvC,UACCF,QAAQ,GAAGG,EAAE,CAACC,WAAH,CAAeC,eAAf,CAA+BH,IAA/B,CADZ;CAAA,UAECP,QAAQ,GAAGQ,EAAE,CAACC,WAAH,CAAeE,OAAf,CAAuBN,QAAvB,CAFZ;;CAIA,UACCL,QAAQ,KAAK,OAAb,IACGA,QAAQ,KAAK,OAFjB,EAIA;CACC,YAAIgB,SAAS,GAAGD,QAAQ,CAACE,KAAT,CAAe,GAAf,EAAoBC,KAApB,CAA0B,CAAC,CAA3B,EAA8B,CAA9B,EAAiChB,WAAjC,EAAhB;;CACA,YAAIG,QAAQ,KAAK,YAAjB,EACA;CACCW,UAAAA,SAAS,GAAG,KAAZ;CACA;;CACDD,QAAAA,QAAQ,GAAG,iBAAkB,IAAII,IAAJ,EAAD,CAAWC,MAAX,GAAoBF,KAApB,CAA0B,CAA1B,EAA6B,EAA7B,EAAiCG,OAAjC,CAAyC,GAAzC,EAA8C,GAA9C,EAAmDJ,KAAnD,CAAyD,GAAzD,EAA8DK,IAA9D,CAAmE,GAAnE,CAAjB,GAA2F,GAA3F,GAAiGN,SAA5G;CACA;;CAED,aAAOD,QAAP;CACA,KA/GD;CACC;;;;sCAgHuBQ,MAAmBC,MAC3C;CAAA,UADiDC,MACjD,uEAD0D,EAC1D;AACC;CAiBA,eAASC,YAAT,CAAsBC,KAAtB,EACA;CACC,eAAOC,cAAI,CAACC,OAAL,CAAaF,KAAb,IAAsBA,KAAtB,GAA8B,CAACA,KAAD,CAArC;CACA;;CAED,eAASG,cAAT,CAAwBC,GAAxB,EAA4CC,IAA5C,EACA;CACC,YAAIJ,cAAI,CAACK,QAAL,CAAcD,IAAd,KAAuBA,IAAI,KAAK,EAApC,EACA;CACCD,UAAAA,GAAG,CAACG,IAAJ,CAASF,IAAT;CACA;;CAED,eAAOD,GAAP;CACA;;CAED,eAASI,eAAT,CAAyBJ,GAAzB,EAA6CC,IAA7C,EACA;CACC,YAAI,CAACA,IAAI,CAACI,UAAV,EACA;CACCL,UAAAA,GAAG,CAACG,IAAJ,CAASF,IAAI,CAACK,EAAd;CACA;;CAED,eAAON,GAAP;CACA;;CAED,eAASO,aAAT,CAAuBP,GAAvB,EAA2CC,IAA3C,EACA;CACC,YAAIA,IAAI,CAACI,UAAT,EACA;CACCL,UAAAA,GAAG,CAACG,IAAJ,CAASF,IAAI,CAACK,EAAd;CACA;;CAED,eAAON,GAAP;CACA;;CAED,eAASQ,OAAT,CAAiBC,KAAjB,EACA;CACC,YAAMC,SAAS,GAAGf,YAAY,CAACc,KAAD,CAA9B;;CAEA,YAAI,CAACC,SAAS,CAACC,MAAf,EACA;CACC,iBAAOC,OAAO,CAACC,OAAR,EAAP;CACA;;CAED,eAAO,IAAID,OAAJ,CAAY,UAACC,OAAD,EAAa;CAC/B;CACApC,UAAAA,EAAE,CAACqC,IAAH,CAAQJ,SAAR,EAAmBG,OAAnB;CACA,SAHM,CAAP;CAIA;;CAED,UAAIhB,cAAI,CAACkB,KAAL,CAAWtB,IAAX,KAAoBI,cAAI,CAACmB,SAAL,CAAexB,IAAf,CAAxB,EACA;CACC,eAAOA,IAAI,CAACyB,SAAZ;CACA,OAvEF;;;CA0EC,UAAMC,UAAU,GAAGzC,EAAE,CAAC0C,WAAH,CAAe1B,IAAf,CAAnB;CACA,UAAM2B,WAAW,GAAGF,UAAU,CAACG,KAAX,CAAiBC,MAAjB,CAAwBvB,cAAxB,EAAwC,EAAxC,CAApB;CACA,UAAMwB,UAAU,GAAGL,UAAU,CAACM,MAAX,CAAkBF,MAAlB,CAAyBlB,eAAzB,EAA0C,EAA1C,CAAnB;CACA,UAAMqB,QAAQ,GAAGP,UAAU,CAACM,MAAX,CAAkBF,MAAlB,CAAyBf,aAAzB,EAAwC,EAAxC,CAAjB;CAEA,UACCmB,cAAc,GAAG,EADlB;CAAA,UAECC,kBAAkB,GAAG,EAFtB,CA/ED;;CAqFCF,MAAAA,QAAQ,CAACG,OAAT,CAAiB,UAAAC,MAAM,EAAI;CAC1BH,QAAAA,cAAc,IAAI,OAAOG,MAAzB;CACA,OAFD;;CAIA,UAAIH,cAAc,CAACf,MAAf,GAAwB,CAA5B,EACA;CACCgB,QAAAA,kBAAkB,uDAA8CD,cAA9C,qBAAlB;CACA;;CAED,UAAI7B,cAAI,CAACmB,SAAL,CAAexB,IAAf,CAAJ,EACA;CACC,YAAIE,MAAM,CAACoC,SAAP,IAAqB,CAACP,UAAU,CAACZ,MAAZ,IAAsB,CAACS,WAAW,CAACT,MAA5D,EACA;CACCnB,UAAAA,IAAI,CAACyB,SAAL,GAAiBC,UAAU,CAACa,IAAX,GAAkBJ,kBAAnC;CACA;CACD;;CAED,aAAOf,OAAO,CACZoB,GADK,CACD,CACJxB,OAAO,CAACe,UAAD,CADH,EAEJf,OAAO,CAACY,WAAD,CAFH,CADC,EAKLa,IALK,CAKA,YAAM;CAEX,YAAIpC,cAAI,CAACmB,SAAL,CAAexB,IAAf,MAAyB+B,UAAU,CAACZ,MAAX,GAAoB,CAApB,IAAyBS,WAAW,CAACT,MAAZ,GAAqB,CAAvE,CAAJ,EACA;CACCnB,UAAAA,IAAI,CAACyB,SAAL,GAAiBC,UAAU,CAACa,IAAX,GAAkBJ,kBAAnC;CACA;;CAEDlD,QAAAA,EAAE,CAACyD,UAAH,CAAcR,cAAd;;CAEA,YAAI7B,cAAI,CAACsC,UAAL,CAAgBzC,MAAM,CAAC0C,QAAvB,CAAJ,EACA;CACC1C,UAAAA,MAAM,CAAC0C,QAAP;CACA;CACD,OAlBK,CAAP;CAmBA;;;;;AAGF,KAAI1D,WAAW,GAAG,IAAIV,KAAJ,EAAlB;;;;;;;;;"}