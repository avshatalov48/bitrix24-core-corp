{"version":3,"file":"utils.bundle.js","sources":["../src/utils.js"],"sourcesContent":["import {Type} from \"main.core\";\n\nclass Utils\n{\n\tconstructor()\n\t{\n\t};\n\n\tgetFileMimeType = (fileType) => {\n\t\tfileType = fileType.toString().toLowerCase();\n\n\t\tif (fileType.indexOf('/') !== -1) // iOS old form\n\t\t{\n\t\t\treturn fileType;\n\t\t}\n\n\t\tlet\n\t\t\tresult = '';\n\n\t\tswitch (fileType)\n\t\t{\n\t\t\tcase 'png':\n\t\t\t\tresult = 'image/png';\n\t\t\t\tbreak;\n\t\t\tcase 'gif':\n\t\t\t\tresult = 'image/gif';\n\t\t\t\tbreak;\n\t\t\tcase 'jpg':\n\t\t\tcase 'jpeg':\n\t\t\t\tresult = 'image/jpeg';\n\t\t\t\tbreak;\n\t\t\tcase 'heic':\n\t\t\t\tresult = 'image/heic';\n\t\t\t\tbreak;\n\t\t\tcase 'mp3':\n\t\t\t\tresult = 'audio/mpeg';\n\t\t\t\tbreak;\n\t\t\tcase 'mp4':\n\t\t\t\tresult = 'video/mp4';\n\t\t\t\tbreak;\n\t\t\tcase 'mpeg':\n\t\t\t\tresult = 'video/mpeg';\n\t\t\t\tbreak;\n\t\t\tcase 'ogg':\n\t\t\t\tresult = 'video/ogg';\n\t\t\t\tbreak;\n\t\t\tcase 'mov':\n\t\t\t\tresult = 'video/quicktime';\n\t\t\t\tbreak;\n\t\t\tcase 'zip':\n\t\t\t\tresult = 'application/zip';\n\t\t\t\tbreak;\n\t\t\tcase 'php':\n\t\t\t\tresult = 'text/php';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tresult = '';\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tgetType = (mimeType) => {\n\t\tlet result = mimeType.substring(0, mimeType.indexOf('/'));\n\n\t\tif (\n\t\t\tresult !== 'image'\n\t\t\t&& result !== 'video'\n\t\t\t&& result !== 'audio'\n\t\t)\n\t\t{\n\t\t\tresult = 'file';\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tgetResizeOptions = (type) => {\n\t\tconst\n\t\t\tmimeType = BX.MobileUtils.getFileMimeType(type),\n\t\t\tfileType = BX.MobileUtils.getType(mimeType);\n\n\t\treturn (\n\t\t\t(\n\t\t\t\tfileType === 'image'\n\t\t\t\t&& mimeType !== 'image/gif'\n\t\t\t)\n\t\t\t|| fileType === 'video'\n\t\t\t\t? {\n\t\t\t\t\tquality: 80,\n\t\t\t\t\twidth: 1920,\n\t\t\t\t\theight: 1080\n\t\t\t\t}\n\t\t\t\t: null\n\t\t);\n\t};\n\n\tgetUploadFilename = (filename, type) => {\n\t\tconst\n\t\t\tmimeType = BX.MobileUtils.getFileMimeType(type),\n\t\t\tfileType = BX.MobileUtils.getType(mimeType);\n\n\t\tif (\n\t\t\tfileType === 'image'\n\t\t\t|| fileType === 'video'\n\t\t)\n\t\t{\n\t\t\tlet extension = filename.split('.').slice(-1)[0].toLowerCase();\n\t\t\tif (mimeType === 'image/heic')\n\t\t\t{\n\t\t\t\textension = 'jpg';\n\t\t\t}\n\t\t\tfilename = 'mobile_file_' + (new Date).toJSON().slice(0, 19).replace('T', '_').split(':').join('-') + '.' + extension;\n\t\t}\n\n\t\treturn filename;\n\t};\n\n\tstatic htmlWithInlineJS(node: HTMLElement, html, params = {}): Promise | string\n\t{\n\t\tconst r = {\n\t\t\tscript: /<script([^>]*)>/ig,\n\t\t\tscript_end: /<\\/script>/ig,\n\t\t\tscript_src: /src=[\"\\']([^\"\\']+)[\"\\']/i,\n\t\t\tscript_type: /type=[\"\\']([^\"\\']+)[\"\\']/i,\n\t\t\tspace: /\\s+/,\n\t\t\tltrim: /^[\\s\\r\\n]+/g,\n\t\t\trtrim: /[\\s\\r\\n]+$/g,\n\t\t\tstyle: /<link.*?(rel=\"stylesheet\"|type=\"text\\/css\")[^>]*>/i,\n\t\t\tstyle_href: /href=[\"\\']([^\"\\']+)[\"\\']/i\n\t\t};\n\n\t\ttype JsItem = {\n\t\t\tisInternal: boolean,\n\t\t\tJS: string,\n\t\t};\n\n\t\tfunction makeIterable(value: any): Array<any>\n\t\t{\n\t\t\treturn Type.isArray(value) ? value : [value];\n\t\t}\n\n\t\tfunction externalStyles(acc: Array<string>, item: ?string)\n\t\t{\n\t\t\tif (Type.isString(item) && item !== '')\n\t\t\t{\n\t\t\t\tacc.push(item);\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}\n\n\t\tfunction externalScripts(acc: Array<string>, item: JsItem)\n\t\t{\n\t\t\tif (!item.isInternal)\n\t\t\t{\n\t\t\t\tacc.push(item.JS);\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}\n\n\t\tfunction inlineScripts(acc: Array<string>, item: JsItem)\n\t\t{\n\t\t\tif (item.isInternal)\n\t\t\t{\n\t\t\t\tacc.push(item.JS);\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}\n\n\t\tfunction loadAll(items: Array<string>): Promise<void>\n\t\t{\n\t\t\tconst itemsList = makeIterable(items);\n\n\t\t\tif (!itemsList.length)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tBX.load(itemsList, resolve);\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isNil(html) && Type.isDomNode(node))\n\t\t{\n\t\t\treturn node.innerHTML;\n\t\t}\n\n\t\t// eslint-disable-next-line\n\t\tconst parsedHtml = BX.processHTML(html);\n\t\tconst externalCss = parsedHtml.STYLE.reduce(externalStyles, []);\n\t\tconst externalJs = parsedHtml.SCRIPT.reduce(externalScripts, []);\n\t\tconst inlineJs = parsedHtml.SCRIPT.reduce(inlineScripts, []);\n\n\t\tlet\n\t\t\tinlineJsString = '',\n\t\t\tinlineJsStringNode = ''\n\t\t;\n\n\t\t// eslint-disable-next-line\n\t\tinlineJs.forEach(script => {\n\t\t\tinlineJsString += \"\\n\" + script;\n\t\t});\n\n\t\tif (inlineJsString.length > 0)\n\t\t{\n\t\t\tinlineJsStringNode = `<span data-type=\"inline-script\"><script>${inlineJsString}</script></span>`;\n\t\t}\n\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tif (params.htmlFirst || (!externalJs.length && !externalCss.length))\n\t\t\t{\n\t\t\t\tnode.innerHTML = parsedHtml.HTML + inlineJsStringNode;\n\t\t\t}\n\t\t}\n\n\t\treturn Promise\n\t\t\t.all([\n\t\t\t\tloadAll(externalJs),\n\t\t\t\tloadAll(externalCss),\n\t\t\t])\n\t\t\t.then(() => {\n\n\t\t\t\tif (Type.isDomNode(node) && (externalJs.length > 0 || externalCss.length > 0))\n\t\t\t\t{\n\t\t\t\t\tnode.innerHTML = parsedHtml.HTML + inlineJsStringNode;\n\t\t\t\t}\n\n\t\t\t\tBX.evalGlobal(inlineJsString);\n\n\t\t\t\tif (Type.isFunction(params.callback))\n\t\t\t\t{\n\t\t\t\t\tparams.callback();\n\t\t\t\t}\n\t\t\t});\n\t}\n}\n\nlet MobileUtils = new Utils;\n\nexport {\n\tUtils,\n\tMobileUtils\n};\n"],"names":["Utils","fileType","toString","toLowerCase","indexOf","result","mimeType","substring","type","BX","MobileUtils","getFileMimeType","getType","quality","width","height","filename","extension","split","slice","Date","toJSON","replace","join","node","html","params","makeIterable","value","Type","isArray","externalStyles","acc","item","isString","push","externalScripts","isInternal","JS","inlineScripts","loadAll","items","itemsList","length","Promise","resolve","load","isNil","isDomNode","innerHTML","parsedHtml","processHTML","externalCss","STYLE","reduce","externalJs","SCRIPT","inlineJs","inlineJsString","inlineJsStringNode","forEach","script","htmlFirst","HTML","all","then","evalGlobal","isFunction","callback"],"mappings":"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"}