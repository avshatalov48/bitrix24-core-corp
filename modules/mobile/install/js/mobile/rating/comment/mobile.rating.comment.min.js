this.BX=this.BX||{};(function(e,t){"use strict";var i=function(){function e(t,i,s,n){babelHelpers.classCallCheck(this,e);this.likeId=t;this.entityTypeId=i;this.entityId=s;this.available=n==="Y";this.likeTimeout=false;this.enabled=this.init();e.setInstance(t,this)}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this;this.box=BX("bx-ilike-button-"+this.likeId);if(!this.box){return false}BXMobileApp.addCustomEvent("onPull-main",(function(e){if(e.command!=="rating_vote"){return}var i=e.params;if(i.USER_ID+""!=BX.message("USER_ID")+""&&t.entityTypeId==i.ENTITY_TYPE_ID&&t.entityId==i.ENTITY_ID){t.someoneVote(i.TYPE=="ADD",i.TOTAL_POSITIVE_VOTES)}}));this.voted=BX.hasClass(this.box,"post-comment-likes-liked");BX.bind(this.box,"click",BX.proxy(this.vote,this));this.countText=BX("bx-ilike-count-"+this.likeId);BX.bind(this.countText,"click",BX.proxy(this.list,this));return true}},{key:"vote",value:function e(t){clearTimeout(this.likeTimeout);if(BX.type.isBoolean(t)&&this.voted==t)return false;var i=BX.type.isNotEmptyString(this.countText.innerHTML)?parseInt(this.countText.innerHTML):0,s;s=this.voted=BX.type.isBoolean(t)?t:!this.voted;if(this.voted){this.countText.innerHTML=i+1;BX.addClass(this.box,"post-comment-likes-liked");BX.removeClass(this.box,"post-comment-likes");var n=BX.clone(this.box);var o=this.box;BX.adjust(o.parentNode,{style:{position:"relative"}});BX.adjust(n,{attrs:{id:"bx-ilike-button-animation"},style:{position:"absolute",minWidth:0}});BX.adjust(o,{style:{visibility:"hidden"}});o.parentNode.insertBefore(n,o);new BX.easing({duration:120,start:{scale:100},finish:{scale:130},transition:BX.easing.transitions.quad,step:function e(t){n.style.transform="scale("+t.scale/100+")"},complete:function e(){new BX.easing({duration:120,start:{scale:130},finish:{scale:100},transition:BX.easing.transitions.quad,step:function e(t){n.style.transform="scale("+t.scale/100+")"},complete:function e(){n.parentNode.removeChild(n);BX.adjust(o,{style:{visibility:"visible"}});BX.adjust(o.parentNode,{style:{position:"static"}})}}).animate()}}).animate()}else{this.countText.innerHTML=i-1;BX.addClass(this.box,"post-comment-likes");BX.removeClass(this.box,"post-comment-likes-liked")}if(BX.type.isBoolean(t)){return false}else{this.likeTimeout=setTimeout(BX.proxy((function(){this.send(s)}),this),1e3);BX.eventCancelBubble(t);return BX.PreventDefault(t)}}},{key:"send",value:function e(t){var i=new window.MobileAjaxWrapper;i.Wrap({type:"json",method:"POST",url:BX.message("SITE_DIR")+"mobile/ajax.php?mobile_action=like",data:{RATING_VOTE:"Y",RATING_VOTE_TYPE_ID:this.entityTypeId,RATING_VOTE_ENTITY_ID:this.entityId,RATING_VOTE_ACTION:t===true?"plus":"cancel",sessid:BX.bitrix_sessid()},callback:BX.proxy((function(e){if(typeof e!="undefined"&&typeof e.action!="undefined"&&typeof e.items_all!="undefined"){this.vote(e.action=="plus");this.countText.innerHTML=e.items_all}else this.vote(!t)}),this),callback_failure:BX.proxy((function(){this.vote(!t)}),this)})}},{key:"someoneVote",value:function e(t,i){this.countText.innerHTML=i;if(i>1||i==1&&!this.voted){BX.addClass(this.box,"post-comment-liked")}else{BX.removeClass(this.box,"post-comment-liked")}}},{key:"list",value:function e(t){if(window["app"]){var i=BX.message("RVPathToUserProfile")?BX.message("RVPathToUserProfile"):BX.message("RVCPathToUserProfile");window.app.openTable({callback:function e(){},url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?mobile_action=get_likes&RATING_VOTE_TYPE_ID="+this.entityTypeId+"&RATING_VOTE_ENTITY_ID="+this.entityId+"&URL="+i,markmode:false,showtitle:false,modal:false,cache:false,outsection:false,cancelname:BX.message("RVCListBack")})}return BX.PreventDefault(t)}}],[{key:"setInstance",value:function e(t,i){this.repo.set(t,i);window.BXRLC[t]=i}},{key:"getById",value:function e(t){return this.getInstance(t)}},{key:"getInstance",value:function e(t){return this.repo.get(t)}},{key:"List",value:function e(t){var i=this.getInstance(t);if(!i){return}i.list()}}]);return e}();babelHelpers.defineProperty(i,"repo",new Map);if(t.Type.isUndefined(window.BXRLC)){window.BXRLC={}}window.RatingLikeComments=i;if(!t.Type.isUndefined(window.RatingLikeCommentsQueue)&&window.RatingLikeCommentsQueue.length>0){var s;while((s=window.RatingLikeCommentsQueue.pop())&&s){s()}delete window.RatingLikeCommentsQueue}})(this.BX.Mobile=this.BX.Mobile||{},BX);
//# sourceMappingURL=mobile.rating.comment.map.js