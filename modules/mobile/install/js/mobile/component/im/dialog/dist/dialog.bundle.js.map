{"version":3,"file":"dialog.bundle.js","sources":["../src/rest.handler.js","../src/dialog.js","../src/component/bx-messenger.js","../src/component/bx-messenger-body-error.js","../src/component/bx-messenger-body-loading.js","../src/component/bx-messenger-body-empty.js","../src/registry.js"],"sourcesContent":["/**\n * Bitrix Mobile Dialog\n * Dialog Rest answers (Rest Answer Handler)\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BaseRestAnswerHandler} from \"im.provider.rest\";\nimport {LocalStorage} from \"im.tools.localstorage\";\nimport {EventType} from \"im.const\";\n\nexport class MobileRestAnswerHandler extends BaseRestAnswerHandler\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\n\t\tif (typeof params.context === 'object' && params.context)\n\t\t{\n\t\t\tthis.context = params.context;\n\t\t}\n\t}\n\n\thandleImChatGetSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {dialog: {\n\t\t\tchatId: data.id,\n\t\t\tdialogId: data.dialog_id,\n\t\t\tdiskFolderId: data.disk_folder_id,\n\t\t}});\n\n\t\tthis.context.redrawHeader();\n\t}\n\thandleImChatGetError(error)\n\t{\n\t\tif (error.ex.error === 'ACCESS_ERROR')\n\t\t{\n\t\t\tapp.closeController();\n\t\t}\n\t}\n\n\thandleMobileBrowserConstGetSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {disk: {\n\t\t\tenabled: true,\n\t\t\tmaxFileSize: data.phpUploadMaxFilesize\n\t\t}});\n\n\t\tthis.context.addLocalize(data);\n\t\tBX.message(data);\n\n\t\tLocalStorage.set(this.controller.getSiteId(), 0, 'serverVariables', data || {});\n\t}\n\n\thandleImDialogMessagesGetInitSuccess()\n\t{\n\t\tthis.controller.emit(EventType.dialog.sendReadMessages);\n\t}\n\n\thandleImMessageAddSuccess(messageId, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n\n\thandleImMessageAddError(error, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n\n\thandleImDiskFileCommitSuccess(result, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n}","/**\n * Bitrix im dialog mobile\n * Dialog runtime class\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2019 Bitrix\n */\n\n// main\nimport \"main.date\";\n\n// pull\nimport {PULL as Pull, PullClient} from \"mobile.pull.client\";\n\n// ui\nimport {Vue} from \"ui.vue\";\nimport {VuexBuilder} from \"ui.vue.vuex\";\n\n// messenger files\nimport {ApplicationModel, MessagesModel, DialoguesModel, UsersModel, FilesModel} from 'im.model';\nimport {ApplicationController} from 'im.controller';\nimport {\n\tDeviceType,\n\tDeviceOrientation,\n\tRestMethod,\n\tRestMethodHandler,\n\tEventType,\n\tDialogType,\n\tDialogReferenceClassName,\n\tFileStatus,\n\tFileType, DialogCrmType,\n} from 'im.const';\nimport {Utils} from \"im.utils\";\nimport {LocalStorage} from \"im.tools.localstorage\";\nimport {ImRestAnswerHandler} from \"im.provider.rest\";\nimport {ImPullCommandHandler} from \"im.provider.pull\";\nimport {MobileRestAnswerHandler} from \"./rest.handler\";\nimport {Timer} from \"im.tools.timer\";\n\n// TODO change BX.Promise, BX.Main.Date to IMPORT\n\nexport class Dialog\n{\n\t/* region 01. Initialize and store data */\n\n\tconstructor(params = {})\n\t{\n\t\tthis.ready = true;\n\n\t\tthis.offline = false;\n\n\t\tthis.host = this.getHost();\n\n\t\tthis.inited = false;\n\n\t\tthis.restClient = BX.rest;\n\n\t\tthis.customData = [];\n\n\t\tthis.localize = {...BX.message};\n\n\t\tthis.subscribers = {};\n\t\tthis.dateFormat = null;\n\n\t\tthis.messagesQueue = [];\n\n\t\tthis.configRequestXhr = null;\n\n\t\tthis.windowFocused = true;\n\n\t\tthis.rootNode = document.getElementById('messenger-root');\n\n\t\tthis.template = null;\n\n\t\tthis.timer = new Timer();\n\n\t\twindow.addEventListener('orientationchange', () => {\n\t\t\tif (!this.store)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.store.commit('application/set', {\n\t\t\t\tdevice : {\n\t\t\t\t\torientation : Utils.device.getOrientation()\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (\n\t\t\t\tthis.store.state.application.device.type === DeviceType.mobile\n\t\t\t\t&& this.store.state.application.device.orientation === DeviceOrientation.horizontal\n\t\t\t)\n\t\t\t{\n\t\t\t\tdocument.activeElement.blur();\n\t\t\t}\n\t\t});\n\n\t\t// todo change to dynamic storage (LocalStorage web, PageParams for mobile)\n\t\tlet serverVariables = LocalStorage.get(this.getSiteId(), 0, 'serverVariables', false);\n\t\tif (serverVariables)\n\t\t{\n\t\t\tthis.addLocalize(serverVariables);\n\t\t}\n\n\t\t//alert('Pause: open console for debug');\n\n\t\tBX.componentParameters.init()\n\t\t\t.then(result => this.initMobileSettings(result))\n\t\t\t.then(result => this.initStorage(result))\n\t\t\t.then(result => this.initComponent(result))\n\t\t\t.then(result => this.requestData(result))\n\t\t\t.then(result => this.initEnvironment(result))\n\t\t\t.then(result => this.initMobileEnvironment(result))\n\t\t\t.then(result => this.initPullClient(result))\n\t\t;\n\t}\n\n\tinitMobileSettings(data)\n\t{\n\t\tconsole.log('1. initMobileSettings');\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tApplicationStorage.getObject('settings.chat', {\n\t\t\t\tquoteEnable: ChatPerformance.isGestureQuoteSupported(),\n\t\t\t\tquoteFromRight: false,\n\t\t\t\tautoplayVideo: ChatPerformance.isAutoPlayVideoSupported(),\n\t\t\t\tbackgroundType: 'LIGHT_GRAY'\n\t\t\t}).then(value => {\n\t\t\t\tdata.OPTIONS = value;\n\t\t\t\tresolve(data);\n\t\t\t})\n\t\t});\n\t}\n\n\tinitStorage(data)\n\t{\n\t\tconsole.log('2. initStorage');\n\n\t\tthis.controller = new ApplicationController();\n\n\t\tthis.localize['SITE_DIR'] = data.SITE_DIR;\n\n\t\tthis.storedEvents = data.STORED_EVENTS || [];\n\n\t\tlet applicationVariables = {\n\t\t\tcommon: {\n\t\t\t\thost: this.host,\n\t\t\t\tuserId: data.USER_ID,\n\t\t\t\tsiteId: data.SITE_ID,\n\t\t\t\tlanguageId: data.LANGUAGE_ID,\n\t\t\t},\n\t\t\tdevice: {\n\t\t\t\ttype: Utils.device.isMobile()? DeviceType.mobile: DeviceType.desktop,\n\t\t\t\torientation: Utils.device.getOrientation(),\n\t\t\t},\n\t\t\tdialog: {\n\t\t\t\tdialogId: data.DIALOG_ID,\n\t\t\t\tmessageLimit: this.controller.getDefaultMessageLimit(),\n\t\t\t\tenableReadMessages: false,\n\t\t\t},\n\t\t\toptions: {\n\t\t\t\tquoteEnable: data.OPTIONS.quoteEnable,\n\t\t\t\tquoteFromRight: data.OPTIONS.quoteFromRight,\n\t\t\t\tautoplayVideo: data.OPTIONS.autoplayVideo,\n\t\t\t\tdarkBackground: ChatDialogBackground && ChatDialogBackground[data.OPTIONS.backgroundType] && ChatDialogBackground[data.OPTIONS.backgroundType].dark\n\t\t\t}\n\t\t};\n\n\t\treturn new VuexBuilder()\n\t\t\t.addModel(ApplicationModel.create().useDatabase(false).setVariables(applicationVariables))\n\t\t\t.addModel(MessagesModel.create().setVariables({host: this.host}))\n\t\t\t.addModel(DialoguesModel.create().setVariables({host: this.host}))\n\t\t\t.addModel(FilesModel.create().setVariables({host: this.host, default: {name: this.getLocalize('IM_MESSENGER_MESSAGE_FILE_DELETED')}}))\n\t\t\t.addModel(UsersModel.create().setVariables({host: this.host, default: {name: this.getLocalize('IM_MESSENGER_MESSAGE_USER_ANONYM')}}))\n\t\t\t.setDatabaseConfig({\n\t\t\t\tname: 'mobile/im',\n\t\t\t\ttype: VuexBuilder.DatabaseType.jnSharedStorage,\n\t\t\t\tsiteId: data.SITE_ID,\n\t\t\t\tuserId: data.USER_ID,\n\t\t\t})\n\t\t.build();\n\t}\n\n\tinitComponent(result)\n\t{\n\t\tconsole.log('3. initComponent');\n\n\t\tthis.store = result.store;\n\n\t\tthis.store.subscribe(mutation => this.eventStoreInteraction(mutation));\n\n\t\tthis.storeCollector = result.builder;\n\n\t\tthis.controller.setStore(this.store);\n\t\tthis.controller.setRestClient(this.restClient);\n\t\tthis.controller.setPrepareFilesBeforeSaveFunction(this.prepareFileData.bind(this));\n\n\t\tthis.imRestAnswer = ImRestAnswerHandler.create({\n\t\t\tstore: this.store,\n\t\t\tcontroller: this.controller,\n\t\t});\n\t\tthis.mobileRestAnswer = MobileRestAnswerHandler.create({\n\t\t\tstore: this.store,\n\t\t\tcontroller: this.controller,\n\t\t\tcontext: this,\n\t\t});\n\n\t\tlet dialog = this.store.getters['dialogues/get'](this.controller.getDialogId());\n\t\tif (dialog)\n\t\t{\n\t\t\tthis.store.commit('application/set', {dialog: {\n\t\t\t\tchatId: dialog.chatId,\n\t\t\t\tdiskFolderId: dialog.diskFolderId || 0\n\t\t\t}});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitEnvironment(result)\n\t{\n\t\tlet executionTime = new Date();\n\t\tthis.template = this.attachTemplate();\n\t\tconsole.log('5. initEnvironment', (+new Date() - executionTime)+'ms');\n\n\t\tthis.controller.setTemplateEngine(this.template);\n\n\t\tthis.setTextareaMessage = Utils.debounce(this.controller.setTextareaMessage, 300, this.controller);\n\n\t\twindow.addEventListener('orientationchange', () =>\n\t\t{\n\t\t\tif (!this.store)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.store.commit('application/set', {device: {\n\t\t\t\torientation: Utils.device.getOrientation()\n\t\t\t}});\n\t\t});\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitMobileEnvironment(result)\n\t{\n\t\tconsole.log('6. initMobileEnvironment');\n\n\t\tBXMobileApp.UI.Page.Scroll.setEnabled(false);\n\t\tBXMobileApp.UI.Page.captureKeyboardEvents(true);\n\n\t\tBX.addCustomEvent(\"onKeyboardWillShow\", () => {\n\t\t\tthis.store.dispatch('application/set', {mobile: {\n\t\t\t\tkeyboardShow: true,\n\t\t\t}});\n\t\t});\n\t\tBX.addCustomEvent(\"onKeyboardDidShow\", () => {\n\t\t\tthis.controller.emit('EventType.dialog.scrollToBottom', {duration: 300, cancelIfScrollChange: true});\n\t\t});\n\t\tBX.addCustomEvent(\"onKeyboardWillHide\", () => {\n\t\t\tclearInterval(this.keyboardOpeningInterval);\n\t\t\tthis.store.dispatch('application/set', {mobile: {\n\t\t\t\tkeyboardShow: false,\n\t\t\t}});\n\t\t});\n\n\t\tconst checkWindowFocused = () =>\n\t\t{\n\t\t\tBXMobileApp.UI.Page.isVisible({callback: (data) =>\n\t\t\t{\n\t\t\t\tthis.windowFocused = data.status === 'visible';\n\t\t\t\tif (this.windowFocused)\n\t\t\t\t{\n\t\t\t\t\tVue.event.$emit('bitrixmobile:controller:focus');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t\t\t}\n\t\t\t}});\n\t\t};\n\n\t\tBX.addCustomEvent(\"onAppActive\", () =>\n\t\t{\n\t\t\tcheckWindowFocused();\n\n\t\t\tBXMobileApp.UI.Page.isVisible({callback: (data) =>\n\t\t\t{\n\t\t\t\tif (data.status !== 'visible')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.getDialogUnread().then(() => {\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t\tthis.controller.emit(EventType.dialog.sendReadMessages);\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t});\n\t\t\t}});\n\t\t});\n\t\tBX.addCustomEvent(\"onAppPaused\", () => {\n\t\t\tthis.windowFocused = false;\n\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t});\n\n\t\tBX.addCustomEvent(\"onOpenPageAfter\", checkWindowFocused);\n\t\tBX.addCustomEvent(\"onHidePageBefore\", () => {\n\t\t\tthis.windowFocused = false;\n\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t});\n\n\t\tBXMobileApp.addCustomEvent(\"chatbackground::task::status::success\", (params) => {\n\t\t\tlet action = params.taskId.toString().split('|')[0];\n\t\t\tthis.executeBackgroundTaskSuccess(action, params);\n\t\t});\n\t\tBXMobileApp.addCustomEvent(\"chatbackground::task::status::failure\", (params) => {\n\t\t\tlet action = params.taskId.toString().split('|')[0];\n\t\t\tthis.executeBackgroundTaskFailure(action, params);\n\t\t});\n\t\tBXMobileApp.addCustomEvent(\"chatrecent::push::get\", (params) => {\n\t\t\tif (this.pullCommandHandler)\n\t\t\t{\n\t\t\t\tparams.optionImportant = true;\n\t\t\t\tthis.pullCommandHandler.handleMessageAdd(params, {});\n\t\t\t}\n\t\t});\n\n\t\tBXMobileApp.UI.Page.TextPanel.setParams(this.getKeyboardParams());\n\t\tthis.changeChatKeyboardStatus();\n\n\t\tBX.MobileUploadProvider.setListener(this.executeUploaderEvent.bind(this));\n\n\t\tthis.fileUpdateProgress = Utils.throttle((chatId, fileId, progress, size) => {\n\t\t\tthis.store.dispatch('files/update', {\n\t\t\t\tchatId: chatId,\n\t\t\t\tid: fileId,\n\t\t\t\tfields: {\n\t\t\t\t\tsize: size,\n\t\t\t\t\tprogress: progress\n\t\t\t\t}\n\t\t\t});\n\t\t}, 500);\n\n\t\tif (Utils.dialog.isChatId(this.controller.getDialogId()))\n\t\t{\n\t\t\tlet type = this.controller.getDialogData().type;\n\t\t\tif (type !== DialogType.call)\n\t\t\t{\n\t\t\t\tapp.exec(\"setRightButtons\", {items:[\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: \"user_plus\",\n\t\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatAddUserButton\", {});\n\t\t\t\t\t\t\tthis.openAddUserDialog()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]});\n\t\t\t}\n\t\t}\n\n\t\tif (!Utils.dialog.isChatId(this.controller.getDialogId()))\n\t\t{\n\t\t\tthis.userShowWorkPosition = true;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.userShowWorkPosition = false;\n\t\t\t\tthis.redrawHeader();\n\t\t\t}, 1500);\n\n\t\t\tsetInterval(() => {\n\t\t\t\tthis.redrawHeader();\n\t\t\t}, 60000);\n\t\t}\n\n\t\tthis.redrawHeader();\n\n\t\tthis.widgetCache = new ChatWidgetCache(this.controller.getUserId(), this.controller.getLanguageId());\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitPullClient()\n\t{\n\t\tconsole.log('7. initPullClient');\n\n\t\tPull.subscribe(\n\t\t\tthis.pullCommandHandler = new ImPullCommandHandler({\n\t\t\t\tstore: this.store,\n\t\t\t\tcontroller: this.controller,\n\t\t\t})\n\t\t);\n\n\t\tif (this.storedEvents && this.storedEvents.length > 0)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.storedEvents = this.storedEvents.filter(event => {\n\t\t\t\t\tBX.onCustomEvent('chatrecent::push::get', [event]);\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t}, 50);\n\t\t}\n\n\t\tPull.subscribe({\n\t\t\ttype: BX.PullClient.SubscriptionType.Server,\n\t\t\tmoduleId: 'im',\n\t\t\tcommand: 'chatUserLeave',\n\t\t\tcallback: (params) =>\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tparams.userId === this.controller.getUserId()\n\t\t\t\t\t&& params.dialogId === this.controller.getDialogId()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tapp.closeController();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tPull.subscribe({\n\t\t\ttype: PullClient.SubscriptionType.Status,\n\t\t\tcallback: this.eventStatusInteraction.bind(this)\n\t\t});\n\n\t\tif (!Utils.dialog.isChatId(this.controller.getDialogId()))\n\t\t{\n\t\t\tPull.subscribe({\n\t\t\t\ttype: PullClient.SubscriptionType.Online,\n\t\t\t\tcallback: this.eventOnlineInteraction.bind(this)\n\t\t\t});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\trequestData()\n\t{\n\t\tconsole.log('4. requestData');\n\n\t\tif (this.requestDataSend)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t\tthis.timer.start('data', 'load', .5, () => {\n\t\t\tconsole.warn(\"ChatDialog.requestData: slow connection show progress icon\");\n\t\t\tapp.titleAction(\"setParams\", {useProgress: true, useLetterImage: false});\n\t\t});\n\n\t\tthis.requestDataSend = true;\n\n\t\tlet query = {\n\t\t\t[RestMethodHandler.mobileBrowserConstGet]: [RestMethod.mobileBrowserConstGet, {}],\n\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {dialog_id: this.controller.getDialogId()}],\n\t\t\t[RestMethodHandler.imDialogMessagesGetInit]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\tdialog_id: this.controller.getDialogId(),\n\t\t\t\tlimit: this.controller.getRequestMessageLimit(),\n\t\t\t\tconvert_text: 'Y'\n\t\t\t}],\n\t\t};\n\t\tif (Utils.dialog.isChatId(this.controller.getDialogId()))\n\t\t{\n\t\t\tquery[RestMethodHandler.imUserGet] = [RestMethod.imUserGet, {}];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tquery[RestMethodHandler.imUserListGet] = [RestMethod.imUserListGet, {id: [this.controller.getUserId(), this.controller.getDialogId()]}];\n\t\t}\n\n\t\tthis.restClient.callBatch(query, (response) =>\n\t\t{\n\t\t\tif (!response)\n\t\t\t{\n\t\t\t\tthis.requestDataSend = false;\n\t\t\t\tthis.setError('EMPTY_RESPONSE', 'Server returned an empty response.');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet constGet = response[RestMethodHandler.mobileBrowserConstGet];\n\t\t\tif (constGet.error())\n\t\t\t{\n\t\t\t\t// this.setError(constGet.error().ex.error, constGet.error().ex.error_description);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.executeRestAnswer(RestMethodHandler.mobileBrowserConstGet, constGet);\n\t\t\t}\n\n\t\t\tlet userGet = response[RestMethodHandler.imUserGet];\n\t\t\tif (userGet && !userGet.error())\n\t\t\t{\n\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imUserGet, userGet);\n\t\t\t}\n\n\t\t\tlet userListGet = response[RestMethodHandler.imUserListGet];\n\t\t\tif (userListGet && !userListGet.error())\n\t\t\t{\n\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imUserListGet, userListGet);\n\t\t\t}\n\n\t\t\tlet chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\tthis.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\n\t\t\tlet dialogMessagesGetResult = response[RestMethodHandler.imDialogMessagesGetInit];\n\t\t\tif (dialogMessagesGetResult.error())\n\t\t\t{\n\t\t\t\t//this.setError(dialogMessagesGetResult.error().ex.error, dialogMessagesGetResult.error().ex.error_description);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tapp.titleAction(\"setParams\", {useProgress: false, useLetterImage: true});\n\t\t\t\tthis.timer.stop('data', 'load', true);\n\n\t\t\t\tthis.store.dispatch('dialogues/saveDialog', {\n\t\t\t\t\tdialogId: this.controller.getDialogId(),\n\t\t\t\t\tchatId: this.controller.getChatId(),\n\t\t\t\t});\n\n\t\t\t\tif (this.pullCommandHandler)\n\t\t\t\t{\n\t\t\t\t\tthis.pullCommandHandler.option.skip = false;\n\t\t\t\t}\n\n\t\t\t\tthis.store.dispatch('application/set', {dialog: {\n\t\t\t\t\tenableReadMessages: true\n\t\t\t\t}}).then(() => {\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imDialogMessagesGetInit, dialogMessagesGetResult);\n\t\t\t\t});\n\n\t\t\t\tthis.processSendMessages();\n\t\t\t}\n\n\t\t\tthis.requestDataSend = false;\n\t\t}, false, false, Utils.getLogTrackingParams({name: 'mobile.im.dialog', dialog: this.controller.getDialogData()}));\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\texecuteRestAnswer(command, result, extra)\n\t{\n\t\tconsole.warn(command, result, extra);\n\t\tthis.imRestAnswer.execute(command, result, extra);\n\t\tthis.mobileRestAnswer.execute(command, result, extra);\n\t}\n\n\texecuteUploaderEvent(eventName, eventData, taskId)\n\t{\n\t\tif (eventName !== BX.MobileUploaderConst.FILE_UPLOAD_PROGRESS)\n\t\t{\n\t\t\tconsole.log(\"ChatDialog.disk.eventRouter: \", eventName, taskId, eventData);\n\t\t}\n\n\t\tif (eventName === BX.MobileUploaderConst.FILE_UPLOAD_PROGRESS)\n\t\t{\n\t\t\tif (eventData.percent > 95)\n\t\t\t{\n\t\t\t\teventData.percent = 95;\n\t\t\t}\n\t\t\tthis.fileUpdateProgress(eventData.file.params.chatId, eventData.file.params.file.id, eventData.percent, eventData.byteTotal);\n\t\t}\n\t\telse if (eventName === BX.MobileUploaderConst.FILE_CREATED)\n\t\t{\n\t\t\tif (eventData.result.status === 'error')\n\t\t\t{\n\t\t\t\tthis.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\t\t\t\tconsole.error('File upload error', eventData.result.errors[0].message);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.store.dispatch('files/update', {\n\t\t\t\t\tchatId: eventData.file.params.chatId,\n\t\t\t\t\tid: eventData.file.params.file.id,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tstatus: FileStatus.wait,\n\t\t\t\t\t\tprogress: 95\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (eventName === 'onimdiskmessageaddsuccess')\n\t\t{\n\t\t\tconsole.info('ChatDialog.disk.eventRouter: DISK_MESSAGE_ADD_SUCCESS: ', eventData, taskId);\n\n\t\t\tlet file = eventData.result.FILES['upload'+eventData.result.DISK_ID[0]];\n\n\t\t\tthis.store.dispatch('files/update', {\n\t\t\t\tchatId: eventData.file.params.chatId,\n\t\t\t\tid: eventData.file.params.file.id,\n\t\t\t\tfields: {\n\t\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\t\tprogress: 100,\n\t\t\t\t\tid: file.id,\n\t\t\t\t\tsize: file.size,\n\t\t\t\t\turlDownload: file.urlDownload,\n\t\t\t\t\turlPreview: file.urlPreview,\n\t\t\t\t\turlShow: file.urlShow,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (eventName === 'onimdiskmessageaddfail')\n\t\t{\n\t\t\tconsole.error('ChatDialog.disk.eventRouter: DISK_MESSAGE_ADD_FAIL: ', eventData, taskId);\n\t\t\tthis.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\t\t}\n\t\telse if (\n\t\t\teventName === BX.MobileUploaderConst.TASK_CANCELLED\n\t\t\t|| eventName === BX.MobileUploaderConst.TASK_NOT_FOUND\n\t\t)\n\t\t{\n\t\t\tthis.cancelUploadFile(eventData.file.params.file.id);\n\t\t}\n\t\telse if (\n\t\t\teventName === BX.MobileUploaderConst.FILE_CREATED_FAILED\n\t\t\t|| eventName === BX.MobileUploaderConst.FILE_UPLOAD_FAILED\n\t\t\t|| eventName === BX.MobileUploaderConst.FILE_READ_ERROR\n\t\t\t|| eventName === BX.MobileUploaderConst.TASK_STARTED_FAILED\n\t\t)\n\t\t{\n\t\t\tconsole.error('ChatDialog.disk.eventRouter: ', eventName, eventData, taskId);\n\t\t\tthis.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tprepareFileData(files)\n\t{\n\t\tlet prepareFunction = (file) =>\n\t\t{\n\t\t\tif (file.urlPreview && file.urlPreview.startsWith('file://'))\n\t\t\t{\n\t\t\t\tfile.urlPreview = 'bx'+file.urlPreview;\n\t\t\t}\n\t\t\tif (file.urlShow && file.urlShow.startsWith('file://'))\n\t\t\t{\n\t\t\t\tfile.urlShow = 'bx'+file.urlShow;\n\t\t\t}\n\n\t\t\tif (file.type !== FileType.image)\n\t\t\t{\n\t\t\t\treturn file;\n\t\t\t}\n\n\t\t\tif (file.urlPreview)\n\t\t\t{\n\t\t\t\tif (file.urlPreview.startsWith('/'))\n\t\t\t\t{\n\t\t\t\t\tfile.urlPreview = currentDomain+file.urlPreview;\n\t\t\t\t}\n\n\t\t\t\tfile.urlPreview = file.urlPreview\n\t\t\t\t\t.replace('http://', 'bxhttp://')\n\t\t\t\t\t.replace('https://', 'bxhttps://');\n\t\t\t}\n\n\t\t\tif (file.urlShow)\n\t\t\t{\n\t\t\t\tif (file.urlShow.startsWith('/'))\n\t\t\t\t{\n\t\t\t\t\tfile.urlShow = currentDomain+file.urlShow;\n\t\t\t\t}\n\n\t\t\t\tfile.urlShow = file.urlShow\n\t\t\t\t\t.replace('http://', 'bxhttp://')\n\t\t\t\t\t.replace('https://', 'bxhttps://');\n\t\t\t}\n\n\t\t\treturn file;\n\t\t};\n\n\t\tif (files instanceof Array)\n\t\t{\n\t\t\treturn files.map(file => prepareFunction(file));\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn prepareFunction(files);\n\t\t}\n\t}\n\n/* endregion 01. Initialize and store data */\n\n/* region 02. Mobile environment methods */\n\tredrawHeader()\n\t{\n\t\tlet headerProperties;\n\t\tif (Utils.dialog.isChatId(this.controller.getDialogId()))\n\t\t{\n\t\t\theaderProperties = this.getChatHeaderParams();\n\n\t\t\tthis.changeChatKeyboardStatus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\theaderProperties = this.getUserHeaderParams();\n\t\t\tthis.setCallMenu();\n\t\t}\n\n\t\tif (!headerProperties)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.headerMenuInited)\n\t\t{\n\t\t\t//BXMobileApp.UI.Page.TopBar.title.setUseLetterImage();\n\t\t\tBXMobileApp.UI.Page.TopBar.title.params.useLetterImage = true; // TODO remove this\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setCallback(() => this.openHeaderMenu());\n\n\t\t\tthis.headerMenuInited = true;\n\t\t}\n\n\t\tif (headerProperties.name)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setText(headerProperties.name);\n\t\t}\n\t\tif (headerProperties.desc)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setDetailText(headerProperties.desc);\n\t\t}\n\t\tif (headerProperties.avatar)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setImage(headerProperties.avatar);\n\t\t}\n\t\telse if (headerProperties.color)\n\t\t{\n\t\t\t//BXMobileApp.UI.Page.TopBar.title.setImageColor(dialog.color);\n\t\t\tBXMobileApp.UI.Page.TopBar.title.params.imageColor = headerProperties.color;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetUserHeaderParams()\n\t{\n\t\tlet user = this.store.getters['users/get'](this.controller.getDialogId());\n\t\tif (!user || !user.init)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = {\n\t\t\t'name': null,\n\t\t\t'desc': null,\n\t\t\t'avatar': null,\n\t\t\t'color': null,\n\t\t};\n\n\t\tif (user.avatar)\n\t\t{\n\t\t\tresult.avatar = user.avatar;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.color = user.color;\n\t\t}\n\n\t\tresult.name = user.name;\n\n\t\tlet showLastDate = false;\n\n\t\tif (!this.userShowWorkPosition && user.lastActivityDate)\n\t\t{\n\t\t\tshowLastDate = Utils.user.getLastDateText(user, this.localize);\n\t\t}\n\n\t\tif (showLastDate)\n\t\t{\n\t\t\tresult.desc = showLastDate;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (user.workPosition)\n\t\t\t{\n\t\t\t\tresult.desc = user.workPosition;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.desc = this.localize['MOBILE_HEADER_MENU_CHAT_TYPE_USER'];\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetChatHeaderParams()\n\t{\n\t\tlet dialog = this.store.getters['dialogues/get'](this.controller.getDialogId());\n\t\tif (!dialog || !dialog.init)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = {\n\t\t\t'name': null,\n\t\t\t'desc': null,\n\t\t\t'avatar': null,\n\t\t\t'color': null,\n\t\t};\n\n\t\tif (dialog.avatar)\n\t\t{\n\t\t\tresult.avatar = dialog.avatar;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.color = dialog.color;\n\t\t}\n\n\t\tresult.name = dialog.name;\n\n\t\tlet chatTypeTitle = this.localize['MOBILE_HEADER_MENU_CHAT_TYPE_CHAT'];\n\t\tif (this.localize['MOBILE_HEADER_MENU_CHAT_TYPE_'+dialog.type.toUpperCase()])\n\t\t{\n\t\t\tchatTypeTitle = this.localize['MOBILE_HEADER_MENU_CHAT_TYPE_'+dialog.type.toUpperCase()];\n\t\t}\n\t\tresult.desc = chatTypeTitle;\n\n\t\treturn result;\n\t}\n\n\tchangeChatKeyboardStatus()\n\t{\n\t\tlet dialog = this.store.getters['dialogues/get'](this.controller.getDialogId());\n\t\tif (!dialog || !dialog.init)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.show();\n\t\t\treturn true;\n\t\t}\n\n\t\tlet keyboardShow = true;\n\n\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.getUserId()))\n\t\t{\n\t\t\tkeyboardShow = false;\n\t\t}\n\n\t\tif (\n\t\t\ttypeof this.keyboardShowFlag !== 'undefined'\n\t\t\t&& (\n\t\t\t\tthis.keyboardShowFlag && keyboardShow\n\t\t\t\t|| !this.keyboardShowFlag && !keyboardShow\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn this.keyboardShowFlag;\n\t\t}\n\n\t\tif (keyboardShow)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.show();\n\t\t\tthis.keyboardShowFlag = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.hide();\n\t\t\tthis.keyboardShowFlag = false;\n\t\t}\n\n\t\treturn this.keyboardShowFlag;\n\t}\n\n\tsetCallMenu()\n\t{\n\t\tif (this.callMenuSetted)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tlet userData = this.store.getters['users/get'](this.controller.getDialogId(), true);\n\t\tif (!userData.init)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\tthis.controller.getUserId() === parseInt(this.controller.getDialogId())\n\t\t\t|| userData.bot\n\t\t\t|| userData.network\n\t\t)\n\t\t{\n\t\t\tapp.exec(\"setRightButtons\", {items: []});\n\n\t\t\tthis.callMenuSetted = true;\n\t\t\treturn true;\n\t\t}\n\n\t\tapp.exec(\"setRightButtons\", {items: [\n\t\t\t{\n\t\t\t\ttype: \"call_audio\",\n\t\t\t\tcallback: () => {\n\t\t\t\t\tthis.openCallMenu();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: \"call_video\",\n\t\t\t\tcallback: () => {\n\n\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatCallVideoButton\", {});\n\n\t\t\t\t\tlet userData = {};\n\t\t\t\t\tuserData[this.controller.getDialogId()] = this.store.getters['users/get'](this.controller.getDialogId(), true);\n\n\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\tuserId: this.controller.getDialogId(),\n\t\t\t\t\t\tvideo: true,\n\t\t\t\t\t\tuserData\n\t\t\t\t\t}, \"calls\")\n\t\t\t\t}\n\t\t\t}\n\t\t]});\n\n\t\tthis.callMenuSetted = true;\n\n\t\treturn true;\n\t}\n\n\topenUserList(params = {})\n\t{\n\t\tlet {users = false, title = '', listType = 'LIST', backdrop = true} = params;\n\n\t\tlet settings = {\n\t\t\ttitle,\n\t\t\tobjectName: \"ChatUserListInterface\",\n\t\t};\n\t\tif (backdrop)\n\t\t{\n\t\t\tsettings.backdrop = {};\n\t\t}\n\n\t\tapp.exec(\"openComponent\", {\n\t\t\tname: \"JSStackComponent\",\n\t\t\tcomponentCode: 'im.dialog.list',\n\t\t\tscriptPath: \"/mobileapp/jn/im.chat.user.list/?version=\"+BX.componentParameters.get('WIDGET_CHAT_USERS_VERSION', '1.0.0'),\n\t\t\tparams: {\n\t\t\t\t\"DIALOG_ID\": this.controller.getDialogId(),\n\t\t\t\t\"DIALOG_OWNER_ID\": this.controller.getDialogData().ownerId,\n\t\t\t\t\"USER_ID\": this.controller.getUserId(),\n\t\t\t\t\"LIST_TYPE\": listType,\n\t\t\t\t\"USERS\": users,\n\t\t\t\t\"IS_BACKDROP\": true,\n\t\t\t},\n\t\t\trootWidget: {name: \"list\", settings}\n\t\t}, false);\n\t}\n\n\topenCallMenu()\n\t{\n\t\tfabric.Answers.sendCustomEvent(\"vueChatCallAudioButton\", {});\n\n\t\tlet userData = this.store.getters['users/get'](this.controller.getDialogId(), true);\n\n\t\tif (\n\t\t\tuserData.phones.personalMobile\n\t\t\t|| userData.phones.workPhone\n\t\t\t|| userData.phones.personalPhone\n\t\t\t|| userData.phones.innerPhone\n\t\t)\n\t\t{\n\t\t\tBackdropMenu\n\t\t\t\t.create('im.dialog.menu.call|'+this.controller.getDialogId())\n\t\t\t\t.setItems([\n\t\t\t\t\tBackdropMenuItem.create('audio')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_HEADER_MENU_AUDIO_CALL'])\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('personalMobile')\n\t\t\t\t\t\t.setTitle(userData.phones.personalMobile)\n\t\t\t\t\t\t.setSubTitle(this.localize['MOBILE_MENU_CALL_MOBILE'])\n\t\t\t\t\t\t.skip(!userData.phones.personalMobile)\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('workPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.workPhone)\n\t\t\t\t\t\t.setSubTitle(this.localize['MOBILE_MENU_CALL_WORK'])\n\t\t\t\t\t\t.skip(!userData.phones.workPhone)\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('personalPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.personalPhone)\n\t\t\t\t\t\t.setSubTitle(this.localize['MOBILE_MENU_CALL_PHONE'])\n\t\t\t\t\t\t.skip(!userData.phones.personalPhone)\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('innerPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.innerPhone)\n\t\t\t\t\t\t.setSubTitle(this.localize['MOBILE_MENU_CALL_PHONE'])\n\t\t\t\t\t\t.skip(!userData.phones.innerPhone)\n\t\t\t\t\t,\n\t\t\t\t])\n\t\t\t\t.setVersion(BX.componentParameters.get('WIDGET_BACKDROP_MENU_VERSION', '1.0.0'))\n\t\t\t\t.setEventListener((name, params, user, backdrop) =>\n\t\t\t\t{\n\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (params.id === 'audio')\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tuserId: this.controller.getDialogId(),\n\t\t\t\t\t\t\tvideo: false,\n\t\t\t\t\t\t\tuserData: {[user.id]: user}\n\t\t\t\t\t\t}, \"calls\");\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'innerPhone')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.MobileTools.phoneTo(user.phones[params.id], {callMethod: 'telephony'});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.MobileTools.phoneTo(user.phones[params.id], {callMethod: 'device'});\n\n\t\t\t\t\t\t// items options\n\t\t\t\t\t\t//.setType(BackdropMenuItemType.menu)\n\t\t\t\t\t\t//.disableClose(BX.MobileTools.canUseTelephony())\n\t\t\t\t\t\t// if (!BX.MobileTools.canUseTelephony())\n\t\t\t\t\t\t// {\n\t\t\t\t\t\t// \tBX.MobileTools.phoneTo(user.phones[params.id], {callMethod: 'device'});\n\t\t\t\t\t\t// \treturn false\n\t\t\t\t\t\t// }\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// let subMenu = BackdropMenu\n\t\t\t\t\t\t// \t.create('im.dialog.menu.call.submenu|'+this.controller.getDialogId())\n\t\t\t\t\t\t// \t.setItems([\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('number')\n\t\t\t\t\t\t// \t\t\t.setType(BackdropMenuItemType.info)\n\t\t\t\t\t\t// \t\t\t.setTitle(this.localize[\"MOBILE_MENU_CALL_TO\"]\n\t\t\t\t\t\t// \t\t\t.replace('#PHONE_NUMBER#', user.phones[params.id]))\n\t\t\t\t\t\t// \t\t\t.setHeight(50)\n\t\t\t\t\t\t// \t\t\t.setStyles(BackdropMenuStyle.create().setFont(WidgetListItemFont.create().setFontStyle('bold')))\n\t\t\t\t\t\t// \t\t\t.setDisabled(),\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('telephony').setTitle(this.localize[\"MOBILE_CALL_BY_B24\"]),\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('device').setTitle(this.localize[\"MOBILE_CALL_BY_MOBILE\"]),\n\t\t\t\t\t\t// \t])\n\t\t\t\t\t\t// \t.setEventListener((name, params, options, backdrop) =>\n\t\t\t\t\t\t// \t{\n\t\t\t\t\t\t// \t\tif (name !== 'selected')\n\t\t\t\t\t\t// \t\t{\n\t\t\t\t\t\t// \t\t\treturn false;\n\t\t\t\t\t\t// \t\t}\n\t\t\t\t\t\t// \t\tBX.MobileTools.phoneTo(options.phone, {callMethod: params.id});\n\t\t\t\t\t\t// \t})\n\t\t\t\t\t\t// \t.setCustomParams({phone: user.phones[params.id]})\n\t\t\t\t\t\t// ;\n\t\t\t\t\t\t// backdrop.showSubMenu(subMenu);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.setCustomParams(userData)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\tuserId: this.controller.getDialogId(),\n\t\t\t\tvideo: false,\n\t\t\t\tuserData: {[this.controller.getDialogId()]: userData}\n\t\t\t}, \"calls\");\n\t\t}\n\t}\n\n\tleaveChat(confirm = false)\n\t{\n\t\tif (!confirm)\n\t\t{\n\t\t\tapp.confirm({\n\t\t\t\ttitle: this.localize.MOBILE_HEADER_MENU_LEAVE_CONFIRM,\n\t\t\t\ttext: '',\n\t\t\t\tbuttons: [\n\t\t\t\t\tthis.localize.MOBILE_HEADER_MENU_LEAVE_YES,\n\t\t\t\t\tthis.localize.MOBILE_HEADER_MENU_LEAVE_NO\n\t\t\t\t],\n\t\t\t\tcallback: (button) =>\n\t\t\t\t{\n\t\t\t\t\tif (button === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.leaveChat(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn true;\n\t\t}\n\n\t\tlet dialogId = this.controller.getDialogId();\n\n\t\tthis.restClient.callMethod(RestMethod.imChatLeave, {DIALOG_ID: dialogId}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imChatLeave,\n\t\t\tdialog: this.controller.getDialogData(dialogId)\n\t\t})).then(response => {\n\t\t\tapp.closeController();\n\t\t});\n\t}\n\n\topenAddUserDialog()\n\t{\n\t\tlet listUsers = this.getItemsForAddUserDialog();\n\n\t\tapp.exec(\"openComponent\", {\n\t\t\tname: \"JSStackComponent\",\n\t\t\tcomponentCode: \"im.chat.user.selector\",\n\t\t\tscriptPath: \"/mobileapp/jn/im.chat.user.selector/?version=\"+BX.componentParameters.get('WIDGET_CHAT_RECIPIENTS_VERSION', '1.0.0'),\n\t\t\tparams: {\n\t\t\t\t\"DIALOG_ID\": this.controller.getDialogId(),\n\t\t\t\t\"USER_ID\": this.controller.getUserId(),\n\n\t\t\t\t\"LIST_USERS\": listUsers,\n\t\t\t\t\"LIST_DEPARTMENTS\": [],\n\t\t\t\t\"SKIP_LIST\": [],\n\n\t\t\t\t\"SEARCH_MIN_SIZE\": BX.componentParameters.get('SEARCH_MIN_TOKEN_SIZE', 3),\n\t\t\t},\n\t\t\trootWidget: {\n\t\t\t\tname: \"chat.recipients\",\n\t\t\t\tsettings: {\n\t\t\t\t\tobjectName: \"ChatUserSelectorInterface\",\n\t\t\t\t\ttitle: BX.message('MOBILE_HEADER_MENU_USER_ADD'),\n\t\t\t\t\tlimit: 100,\n\t\t\t\t\titems: listUsers.map(element => ChatDataConverter.getListElementByUser(element)),\n\t\t\t\t\tscopes: [\n\t\t\t\t\t\t{ title: BX.message('MOBILE_SCOPE_USERS'), id: \"user\" },\n\t\t\t\t\t\t{ title: BX.message('MOBILE_SCOPE_DEPARTMENTS'), id: \"department\" }\n\t\t\t\t\t],\n\t\t\t\t\tmodal: true,\n\t\t\t\t}\n\t\t\t}\n\t\t}, false);\n\t}\n\n\tgetItemsForAddUserDialog()\n\t{\n\t\tlet items = [];\n\t\tlet itemsIndex = {};\n\n\t\tif (!this.widgetCache)\n\t\t{\n\t\t\tthis.widgetCache = new ChatWidgetCache(this.controller.getUserId(), this.controller.getLanguageId());\n\t\t}\n\n\t\tif (this.widgetCache.recentList.length > 0)\n\t\t{\n\t\t\tthis.widgetCache.recentList.map(element =>\n\t\t\t{\n\t\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (element.type === 'user')\n\t\t\t\t{\n\t\t\t\t\titems.push(element.user);\n\t\t\t\t\titemsIndex[element.id] = true;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\n\t\tthis.widgetCache.colleaguesList.map(element =>\n\t\t{\n\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\titems.push(element);\n\t\t\titemsIndex[element.id] = true;\n\t\t});\n\n\t\tthis.widgetCache.lastSearchList.map(element =>\n\t\t{\n\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (element.type === 'user')\n\t\t\t{\n\t\t\t\titems.push(element.user);\n\t\t\t\titemsIndex[element.id] = true;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\n\t\t/*\n\t\tlet skipList = ChatMessengerCommon.getChatUsers();\n\t\tif (skipList.indexOf(this.base.userId) === -1)\n\t\t{\n\t\t\tskipList.push(this.base.userId)\n\t\t}\n\t\titems = items.filter((element) => skipList.indexOf(element.id) === -1);\n\t\t*/\n\n\t\treturn items;\n\t};\n\n/* endregion 02. Mobile environment methods */\n\n/* region 02. Push & Pull */\n\n\teventStoreInteraction(data)\n\t{\n\t\tif (data.type === 'dialogues/update' && data.payload && data.payload.fields)\n\t\t{\n\t\t\t if (\n\t\t\t \ttypeof data.payload.fields.counter !== 'undefined'\n\t\t\t\t&& typeof data.payload.dialogId !== 'undefined'\n\t\t\t )\n\t\t\t {\n\t\t\t \tBXMobileApp.Events.postToComponent(\"chatdialog::counter::change\", [{\n\t\t\t \t\tdialogId: data.payload.dialogId,\n\t\t\t \t\tcounter: data.payload.fields.counter,\n\t\t\t\t}, true], 'im.recent');\n\t\t\t }\n\t\t}\n\t\telse if (data.type === 'dialogues/set')\n\t\t{\n\t\t\tdata.payload.forEach((dialog) => {\n\t\t\t\tBXMobileApp.Events.postToComponent(\"chatdialog::counter::change\", [{\n\t\t\t \t\tdialogId: dialog.dialogId,\n\t\t\t \t\tcounter: dialog.counter,\n\t\t\t\t}, true], 'im.recent');\n\t\t\t});\n\t\t}\n\t}\n\n\teventStatusInteraction(data)\n\t{\n\t\tif (data.status === PullClient.PullStatus.Online)\n\t\t{\n\t\t\tthis.offline = false;\n\n\t\t\tif (this.pullRequestMessage)\n\t\t\t{\n\t\t\t\tthis.pullCommandHandler.option.skip = true;\n\n\t\t\t\tthis.getDialogUnread().then(() => {\n\t\t\t\t\tthis.pullCommandHandler.option.skip = false;\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t\tthis.controller.emit(EventType.dialog.sendReadMessages);\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.pullCommandHandler.option.skip = false;\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t});\n\n\t\t\t\tthis.pullRequestMessage = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.readMessage();\n\t\t\t\tthis.processSendMessages();\n\t\t\t}\n\t\t}\n\t\telse if (data.status === PullClient.PullStatus.Offline)\n\t\t{\n\t\t\tthis.pullRequestMessage = true;\n\t\t\tthis.offline = true;\n\t\t}\n\t}\n\n\teventOnlineInteraction(data)\n\t{\n\t\tif (data.command === 'list' || data.command === 'userStatus')\n\t\t{\n\t\t\tfor (let userId in data.params.users)\n\t\t\t{\n\t\t\t\tif (!data.params.users.hasOwnProperty(userId))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.store.dispatch('users/update', {\n\t\t\t\t\tid: data.params.users[userId].id,\n\t\t\t\t\tfields: data.params.users[userId]\n\t\t\t\t});\n\n\t\t\t\tif (userId.toString() === this.controller.getDialogId())\n\t\t\t\t{\n\t\t\t\t\tthis.redrawHeader();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n/* endregion 02. Push & Pull */\n\n\tgetKeyboardParams()\n\t{\n\t\tlet dialogData = this.controller.getDialogData();\n\n\t\tlet siteDir = this.localize.SITE_DIR? this.localize.SITE_DIR: '/';\n\n\t\treturn {\n\t\t\ttext: dialogData? dialogData.textareaMessage: '',\n\t\t\tplaceholder: this.getLocalize('MOBILE_CHAT_PANEL_PLACEHOLDER'),\n\t\t\tsmileButton: {},\n\t\t\tuseImageButton:true,\n\t\t\tuseAudioMessages: true,\n\t\t\tmentionDataSource:\n\t\t\t{\n\t\t\t\toutsection: \"NO\",\n\t\t\t\turl: siteDir + \"mobile/index.php?mobile_action=get_user_list&use_name_format=Y&with_bots\"\n\t\t\t},\n\t\t\tattachFileSettings:\n\t\t\t{\n\t\t\t\tpreviewMaxWidth: 640,\n\t\t\t\tpreviewMaxHeight: 640,\n\t\t\t\tresize:\n\t\t\t\t{\n\t\t\t\t\ttargetWidth: -1,\n\t\t\t\t\ttargetHeight: -1,\n\t\t\t\t\tsourceType: 1,\n\t\t\t\t\tencodingType: 0,\n\t\t\t\t\tmediaType: 2,\n\t\t\t\t\tallowsEdit: false,\n\t\t\t\t\tsaveToPhotoAlbum: true,\n\t\t\t\t\tpopoverOptions: false,\n\t\t\t\t\tcameraDirection: 0,\n\t\t\t\t},\n\t\t\t\tsendFileSeparately: true,\n\t\t\t\tshowAttachedFiles: true,\n\t\t\t\teditingMediaFiles:false,\n\t\t\t\tmaxAttachedFilesCount: 100\n\t\t\t},\n\t\t\tattachButton: {items:\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tid:\"disk\",\n\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_DISK\"),\n\t\t\t\t\tdataSource:\n\t\t\t\t\t{\n\t\t\t\t\t\tmultiple:false,\n\t\t\t\t\t\turl: siteDir + \"mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId=\"+this.getLocalize(\"USER_ID\"),\n\t\t\t\t\t\tTABLE_SETTINGS:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsearchField: true,\n\t\t\t\t\t\t\tshowtitle: true,\n\t\t\t\t\t\t\tmodal: true,\n\t\t\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_DISK_FILES\")\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"mediateka\",\n\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_GALLERY\")\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"camera\",\n\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_CAMERA\")\n\t\t\t\t}\n\t\t\t]},\n\t\t\taction: (data) =>\n\t\t\t{\n\t\t\t\tif (typeof data === \"string\")\n\t\t\t\t{\n\t\t\t\t\tdata = {text: data, attachedFiles: []};\n\t\t\t\t}\n\n\t\t\t\tconst text = data.text.toString().trim();\n\t\t\t\tconst attachedFiles = data.attachedFiles instanceof Array? data.attachedFiles: [];\n\n\t\t\t\tif (attachedFiles.length <= 0)\n\t\t\t\t{\n\t\t\t\t\tthis.clearText();\n\t\t\t\t\tthis.addMessage(text);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tattachedFiles.forEach(file => {\n\t\t\t\t\t\t// disk\n\t\t\t\t\t\tif (typeof file.dataAttributes !== 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileDisk\", {});\n\n\t\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\t\tsource: 'disk',\n\t\t\t\t\t\t\t\tname: file.name,\n\t\t\t\t\t\t\t\ttype: file.type.toString().toLowerCase(),\n\t\t\t\t\t\t\t\tpreview: !file.dataAttributes.URL || !file.dataAttributes.URL.PREVIEW? null: {\n\t\t\t\t\t\t\t\t\turl: file.dataAttributes.URL.PREVIEW,\n\t\t\t\t\t\t\t\t\twidth: file.dataAttributes.URL.PREVIEW.match(/(width=(\\d+))/i)[2],\n\t\t\t\t\t\t\t\t\theight: file.dataAttributes.URL.PREVIEW.match(/(height=(\\d+))/i)[2]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuploadLink: parseInt(file.dataAttributes.ID),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// audio\n\t\t\t\t\t\tif (file.type === 'audio/mp4')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileAudio\", {});\n\n\t\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\t\tsource: 'audio',\n\t\t\t\t\t\t\t\tname: 'mobile_audio_'+(new Date).toJSON().slice(0, 19).replace('T', '_').split(':').join('-')+'.mp3',\n\t\t\t\t\t\t\t\ttype: 'mp3',\n\t\t\t\t\t\t\t\tpreview: null,\n\t\t\t\t\t\t\t\tuploadLink: file.url,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet filename = file.name;\n\t\t\t\t\t\tlet fileType = FilesModel.getType(file.name);\n\n\t\t\t\t\t\tif (fileType === FileType.video)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileVideo\", {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (fileType === FileType.image)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileImage\", {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileOther\", {});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tfileType === FileType.image\n\t\t\t\t\t\t\t|| fileType === FileType.video\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet extension = file.name.split('.').slice(-1)[0].toLowerCase();\n\t\t\t\t\t\t\tif (file.type === 'image/heic')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\textension = 'jpg';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfilename = 'mobile_file_'+(new Date).toJSON().slice(0, 19).replace('T', '_').split(':').join('-')+'.'+extension;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// file\n\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\tsource: 'gallery',\n\t\t\t\t\t\t\tname: filename,\n\t\t\t\t\t\t\ttype: file.type.toString().toLowerCase(),\n\t\t\t\t\t\t\tpreview: !file.previewUrl? null: {\n\t\t\t\t\t\t\t\turl: file.previewUrl,\n\t\t\t\t\t\t\t\twidth: file.previewWidth,\n\t\t\t\t\t\t\t\theight: file.previewHeight\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tuploadLink: file.url,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tcallback: (data) =>\n\t\t\t{\n\t\t\t\tconsole.log('Textpanel callback', data);\n\t\t\t\tif (!data.event)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (data.event === \"onKeyPress\")\n\t\t\t\t{\n\t\t\t\t\tlet text = data.text.toString();\n\t\t\t\t\tif (text.trim().length > 2)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controller.startWriting();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (text.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controller.setTextareaMessage({message: ''});\n\t\t\t\t\t\tthis.controller.stopWriting();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTextareaMessage({message: text});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (Application.getPlatform() !== \"android\")\n\t\t\t\t{\n\t\t\t\t\tif (data.event === \"getFocus\")\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Utils.platform.isIos() && Utils.platform.getIosVersion() > 12)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.controller.emit(EventType.dialog.scrollToBottom, {duration: 300, cancelIfScrollChange: true})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (data.event === \"removeFocus\")\n\t\t\t\t\t{\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n/* region 03. Template engine */\n\n\tattachTemplate()\n\t{\n\t\tif (this.template)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst application = this;\n\t\tconst controller = this.controller;\n\t\tconst restClient = this.restClient;\n\t\tconst pullClient = this.pullClient || null;\n\n\t\treturn Vue.create({\n\t\t\tel: this.rootNode,\n\t\t\tstore: this.store,\n\t\t\ttemplate: '<bx-messenger/>',\n\t\t\tbeforeCreate()\n\t\t\t{\n\t\t\t\tthis.$bitrixApplication = application;\n\t\t\t\tthis.$bitrixController = controller;\n\t\t\t\tthis.$bitrixRestClient = restClient;\n\t\t\t\tthis.$bitrixPullClient = pullClient;\n\t\t\t\tthis.$bitrixMessages = application.localize;\n\t\t\t},\n\t\t\tdestroyed()\n\t\t\t{\n\t\t\t\tthis.$bitrixApplication.template = null;\n\t\t\t\tthis.$bitrixApplication = null;\n\t\t\t\tthis.$bitrixController = null;\n\t\t\t\tthis.$bitrixRestClient = null;\n\t\t\t\tthis.$bitrixPullClient = null;\n\t\t\t\tthis.$bitrixMessages = null;\n\t\t\t}\n\t\t});\n\t}\n\n\tdetachTemplate()\n\t{\n\t\tif (!this.template)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.template.$destroy();\n\n\t\treturn true;\n\t}\n\n/* endregion 03. Template engine */\n\n/* region 04. Rest methods */\n\n\taddMessage(text, file = null)\n\t{\n\t\tif (!text && !file)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet quiteId = this.store.getters['dialogues/getQuoteId'](this.controller.getDialogId());\n\t\tif (quiteId)\n\t\t{\n\t\t\tlet quoteMessage = this.store.getters['messages/getMessage'](this.controller.getChatId(), quiteId);\n\t\t\tif (quoteMessage)\n\t\t\t{\n\t\t\t\tlet user = null;\n\t\t\t\tif (quoteMessage.authorId)\n\t\t\t\t{\n\t\t\t\t\tuser = this.store.getters['users/get'](quoteMessage.authorId);\n\t\t\t\t}\n\n\t\t\t\tlet files = this.store.getters['files/getList'](this.controller.getChatId());\n\n\t\t\t\tlet message = [];\n\t\t\t\tmessage.push('-'.repeat(54));\n\t\t\t\tmessage.push((user && user.name? user.name: this.getLocalize('MOBILE_CHAT_SYSTEM_MESSAGE'))+' ['+Utils.date.format(quoteMessage.date, null, this.localize)+']');\n\t\t\t\tmessage.push(Utils.text.quote(quoteMessage.text, quoteMessage.params, files, this.localize));\n\t\t\t\tmessage.push('-'.repeat(54));\n\t\t\t\tmessage.push(text);\n\t\t\t\ttext = message.join(\"\\n\");\n\n\t\t\t\tthis.quoteMessageClear();\n\t\t\t}\n\t\t}\n\n\t\tconsole.warn('addMessage', text, file);\n\n\t\tif (!this.controller.isUnreadMessagesLoaded())\n\t\t{\n\t\t\tthis.sendMessage({id: 0, chatId: this.controller.getChatId(), dialogId: this.controller.getDialogId(), text, file});\n\t\t\tthis.processSendMessages();\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.store.commit('application/increaseDialogExtraCount');\n\n\t\tlet params = {};\n\t\tif (file)\n\t\t{\n\t\t\tparams.FILE_ID = [file.id];\n\t\t}\n\n\t\tthis.store.dispatch('messages/add', {\n\t\t\tchatId: this.controller.getChatId(),\n\t\t\tauthorId: this.controller.getUserId(),\n\t\t\ttext: text,\n\t\t\tparams,\n\t\t\tsending: !file,\n\t\t}).then(messageId => {\n\n\t\t\tthis.messagesQueue.push({\n\t\t\t\tid: messageId,\n\t\t\t\tchatId: this.controller.getChatId(),\n\t\t\t\tdialogId: this.controller.getDialogId(),\n\t\t\t\ttext,\n\t\t\t\tfile,\n\t\t\t\tsending: false\n\t\t\t});\n\n\t\t\tif (this.controller.getChatId())\n\t\t\t{\n\t\t\t\tthis.processSendMessages();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.requestData();\n\t\t\t}\n\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tuploadFile(file, text = '')\n\t{\n\t\tif (!file)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconsole.warn('addFile', file, text);\n\n\t\tif (!this.controller.isUnreadMessagesLoaded())\n\t\t{\n\t\t\tthis.addMessage(text, {id: 0, source: file});\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.store.dispatch('files/add', this.controller.prepareFilesBeforeSave({\n\t\t\tchatId: this.controller.getChatId(),\n\t\t\tauthorId: this.controller.getUserId(),\n\t\t\tname: file.name,\n\t\t\ttype: FilesModel.getType(file.name),\n\t\t\textension: file.name.split('.').splice(-1)[0],\n\t\t\tsize: 0,\n\t\t\timage: !file.preview? false: {\n\t\t\t\twidth: file.preview.width,\n\t\t\t\theight: file.preview.height,\n\t\t\t},\n\t\t\tstatus: file.source === 'disk'? FileStatus.wait: FileStatus.upload,\n\t\t\tprogress: 0,\n\t\t\tauthorName: this.controller.getCurrentUser().name,\n\t\t\turlPreview: !file.preview? '': file.preview.url,\n\t\t})).then(fileId => this.addMessage(text, {id: fileId, ...file}));\n\n\t\treturn true;\n\t}\n\n\tcancelUploadFile(fileId)\n\t{\n\t\tlet element = this.messagesQueue.find(element => element.file && element.file.id === fileId);\n\t\tif (element)\n\t\t{\n\t\t\tBX.MobileUploadProvider.cancelTasks(['imDialog'+fileId]);\n\n\t\t\tthis.store.dispatch('messages/delete', {\n\t\t\t\tchatId: element.chatId,\n\t\t\t\tid: element.id,\n\t\t\t}).then(() => {\n\t\t\t\tthis.store.dispatch('files/delete', {\n\t\t\t\t\tchatId: element.chatId,\n\t\t\t\t\tid: element.file.id,\n\t\t\t\t});\n\t\t\t\tthis.messagesQueue = this.messagesQueue.filter(el => el.id !== element.id);\n\t\t\t});\n\t\t}\n\t}\n\n\tretryUploadFile(fileId)\n\t{\n\t\tlet element = this.messagesQueue.find(element => element.file && element.file.id === fileId);\n\t\tif (!element)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/actionStart', {\n\t\t\tchatId: element.chatId,\n\t\t\tid: element.id\n\t\t}).then(() => {\n\t\t\tthis.store.dispatch('files/update', {\n\t\t\t\tchatId: element.chatId,\n\t\t\t\tid: element.file.id,\n\t\t\t\tfields: {\n\t\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\t\tprogress: 0\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\telement.sending = false;\n\t\tthis.processSendMessages();\n\n\t\treturn true;\n\t}\n\n\tprocessSendMessages()\n\t{\n\t\tthis.messagesQueue.filter(element => !element.sending).forEach(element =>\n\t\t{\n\t\t\telement.sending = true;\n\n\t\t\tif (element.file)\n\t\t\t{\n\t\t\t\tif (element.file.source === 'disk')\n\t\t\t\t{\n\t\t\t\t\tthis.fileCommit({\n\t\t\t\t\t\tchatId: element.chatId,\n\t\t\t\t\t\tdialogId: element.dialogId,\n\t\t\t\t\t\tdiskId: element.file.uploadLink,\n\t\t\t\t\t\tmessageText: element.text,\n\t\t\t\t\t\tmessageId: element.id,\n\t\t\t\t\t\tfileId: element.file.id,\n\t\t\t\t\t\tfileType: FilesModel.getType(element.file.name),\n\t\t\t\t\t}, element);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.controller.getDiskFolderId())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.sendMessageWithFile(element);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\telement.sending = false;\n\t\t\t\t\t\tthis.requestDiskFolderId();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\telement.sending = true;\n\t\t\t\tthis.sendMessage(element);\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tprocessMarkReadMessages()\n\t{\n\t\tthis.controller.readMessageExecute(this.controller.getChatId(), true);\n\t\treturn true;\n\t}\n\n\tsendMessage(message)\n\t{\n\t\tmessage.text = message.text.replace(/^([-]{21}\\n)/gm, '-'.repeat(54)+'\\n');\n\n\t\tthis.controller.stopWriting(message.dialogId);\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::add', [\n\t\t\t'sendMessage|'+message.id,\n\t\t\t[RestMethod.imMessageAdd, {\n\t\t\t\t'TEMPLATE_ID': message.id,\n\t\t\t\t'DIALOG_ID': message.dialogId,\n\t\t\t\t'MESSAGE': message.text\n\t\t\t}],\n\t\t\tmessage\n\t\t], 'background');\n\t}\n\n\tsendMessageWithFile(message)\n\t{\n\t\tlet fileType = FilesModel.getType(message.file.name);\n\t\tlet fileExtension = message.file.name.toString().toLowerCase().split('.').splice(-1)[0];\n\t\tlet attachPreviewFile = fileType !== FileType.image && message.file.preview;\n\t\tlet needConvert = fileType === FileType.image && message.file.type !== 'image/gif' || fileType === FileType.video;\n\n\t\tBX.MobileUploadProvider.addTasks([{\n\t\t\turl: message.file.uploadLink,\n\t\t\tparams: message,\n\t\t\tname: message.file.name,\n\t\t\ttype: fileExtension,\n\t\t\tmimeType: fileType === FileType.audio? 'audio/mp4': null,\n\t\t\tresize: !needConvert? null: {\n\t\t\t\t\"quality\":80,\n\t\t\t\t\"width\":1920,\n\t\t\t\t\"height\":1080,\n\t\t\t},\n\t\t\tpreviewUrl: attachPreviewFile? message.file.preview.url: '',\n\t\t\tfolderId: this.controller.getDiskFolderId(),\n\t\t\ttaskId: 'imDialog'+message.file.id,\n\t\t\tonDestroyEventName: 'onimdiskmessageaddsuccess'\n\t\t}]);\n\t}\n\n\tfileError(chatId, fileId, messageId = 0)\n\t{\n\t\tthis.store.dispatch('files/update', {\n\t\t\tchatId: chatId,\n\t\t\tid: fileId,\n\t\t\tfields: {\n\t\t\t\tstatus: FileStatus.error,\n\t\t\t\tprogress: 0\n\t\t\t}\n\t\t});\n\t\tif (messageId)\n\t\t{\n\t\t\tthis.store.dispatch('messages/actionError', {\n\t\t\t\tchatId: chatId,\n\t\t\t\tid: messageId,\n\t\t\t\tretry: true,\n\t\t\t});\n\t\t}\n\t}\n\n\tfileCommit(params, message)\n\t{\n\t\tlet queryParams = {\n\t\t\tchat_id: params.chatId,\n\t\t\tmessage: params.messageText,\n\t\t\ttemplate_id: params.messageId? params.messageId: 0,\n\t\t\tfile_template_id: params.fileId? params.fileId: 0,\n\t\t};\n\t\tif (params.uploadId)\n\t\t{\n\t\t\tqueryParams.upload_id = params.uploadId;\n\t\t}\n\t\telse if (params.diskId)\n\t\t{\n\t\t\tqueryParams.disk_id = params.diskId;\n\t\t}\n\n\t\tthis.restClient.callMethod(RestMethod.imDiskFileCommit, queryParams, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imDiskFileCommit,\n\t\t\tdata: {timMessageType: params.fileType},\n\t\t\tdialog: this.controller.getDialogData(params.dialogId)\n\t\t})).then(response => {\n\t\t\tthis.executeRestAnswer(RestMethodHandler.imDiskFileCommit, response, message);\n\t\t}).catch(error => {\n\t\t\tthis.executeRestAnswer(RestMethodHandler.imDiskFileCommit, error, message);\n\t\t});\n\n\t\treturn true;\n\t}\n\n\trequestDiskFolderId()\n\t{\n\t\tif (this.flagRequestDiskFolderIdSended || this.controller.getDiskFolderId())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.flagRequestDiskFolderIdSended = true;\n\n\t\tthis.restClient.callMethod(RestMethod.imDiskFolderGet, {chat_id: this.controller.getChatId()}).then(response => {\n\t\t\tthis.executeRestAnswer(RestMethodHandler.imDiskFolderGet, response);\n\t\t\tthis.flagRequestDiskFolderIdSended = false;\n\t\t\tthis.processSendMessages();\n\t\t}).catch(error => {\n\t\t\tthis.flagRequestDiskFolderIdSended = false;\n\t\t\tthis.executeRestAnswer(RestMethodHandler.imDiskFolderGet, error);\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tgetDialogHistory(lastId, limit = this.controller.getRequestMessageLimit())\n\t{\n\t\tthis.restClient.callMethod(RestMethod.imDialogMessagesGet, {\n\t\t\t'CHAT_ID': this.controller.getChatId(),\n\t\t\t'LAST_ID': lastId,\n\t\t\t'LIMIT': limit,\n\t\t\t'CONVERT_TEXT': 'Y'\n\t\t}).then(result => {\n\t\t\tthis.executeRestAnswer(RestMethodHandler.imDialogMessagesGet, result);\n\t\t\tthis.controller.emit(EventType.dialog.requestHistoryResult, {count: result.data().messages.length});\n\t\t}).catch(result => {\n\t\t\tthis.controller.emit(EventType.dialog.requestHistoryResult, {error: result.error().ex});\n\t\t});\n\t}\n\n\tgetDialogUnread(lastId, limit = this.controller.getRequestMessageLimit())\n\t{\n\t\tif (this.promiseGetDialogUnreadWait)\n\t\t{\n\t\t\treturn this.promiseGetDialogUnread;\n\t\t}\n\n\t\tthis.promiseGetDialogUnread = new BX.Promise();\n\t\tthis.promiseGetDialogUnreadWait = true;\n\n\t\tif (!lastId)\n\t\t{\n\t\t\tlastId = this.store.getters['messages/getLastId'](this.controller.getChatId());\n\t\t}\n\n\t\tif (!lastId)\n\t\t{\n\t\t\tthis.controller.emit(EventType.dialog.requestUnreadResult, {error: {error: 'LAST_ID_EMPTY', error_description: 'LastId is empty.'}});\n\n\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\treturn this.promiseGetDialogUnread;\n\t\t}\n\n\t\tthis.controller.readMessage(lastId, true, true).then(() =>\n\t\t{\n\t\t\tthis.timer.start('data', 'load', .5, () => {\n\t\t\t\tconsole.warn(\"ChatDialog.requestData: slow connection show progress icon\");\n\t\t\t\tapp.titleAction(\"setParams\", {useProgress: true, useLetterImage: false});\n\t\t\t});\n\n\t\t\tlet query = {\n\t\t\t\t[RestMethodHandler.imDialogRead]: [RestMethod.imDialogRead, {\n\t\t\t\t\tdialog_id: this.controller.getDialogId(),\n\t\t\t\t\tmessage_id: lastId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {\n\t\t\t\t\tdialog_id: this.controller.getDialogId()\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetUnread]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tchat_id: this.controller.getChatId(),\n\t\t\t\t\tfirst_id: lastId,\n\t\t\t\t\tlimit: limit,\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}]\n\t\t\t};\n\n\t\t\tthis.restClient.callBatch(query, (response) =>\n\t\t\t{\n\t\t\t\tif (!response)\n\t\t\t\t{\n\t\t\t\t\tthis.controller.emit(EventType.dialog.requestUnreadResult, {error: {error: 'EMPTY_RESPONSE', error_description: 'Server returned an empty response.'}});\n\n\t\t\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tlet chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\t\tif (!chatGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\t\t\t\t}\n\n\t\t\t\tlet dialogMessageUnread = response[RestMethodHandler.imDialogMessagesGetUnread];\n\t\t\t\tif (dialogMessageUnread.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.emit(EventType.dialog.requestUnreadResult, {error: dialogMessageUnread.error().ex});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imDialogMessagesGetUnread, dialogMessageUnread);\n\n\t\t\t\t\tthis.controller.emit(EventType.dialog.requestUnreadResult, {\n\t\t\t\t\t\tfirstMessageId: dialogMessageUnread.data().messages.length > 0? dialogMessageUnread.data().messages[0].id: 0,\n\t\t\t\t\t\tcount: dialogMessageUnread.data().messages.length\n\t\t\t\t\t});\n\n\t\t\t\t\tapp.titleAction(\"setParams\", {useProgress: false, useLetterImage: true});\n\t\t\t\t\tthis.timer.stop('data', 'load', true);\n\t\t\t\t}\n\n\t\t\t\tthis.promiseGetDialogUnread.fulfill(response);\n\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t}, false, false, Utils.getLogTrackingParams({name: RestMethodHandler.imDialogMessagesGetUnread, dialog: this.controller.getDialogData()}));\n\t\t});\n\n\t\treturn this.promiseGetDialogUnread;\n\t}\n\n\tretrySendMessage(message)\n\t{\n\t\tlet element = this.messagesQueue.find(el => el.id === message.id);\n\t\tif (element)\n\t\t{\n\t\t\tif (element.file && element.file.id)\n\t\t\t{\n\t\t\t\tthis.retryUploadFile(element.file.id)\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.messagesQueue.push({\n\t\t\tid: message.id,\n\t\t\tchatId: this.controller.getChatId(),\n\t\t\tdialogId: this.controller.getDialogId(),\n\t\t\ttext: message.text,\n\t\t\tsending: false\n\t\t});\n\n\t\tthis.controller.setSendingMessageFlag(message.id);\n\n\t\tthis.processSendMessages();\n\t}\n\n\topenProfile(userId)\n\t{\n\t\tBXMobileApp.Events.postToComponent(\"onUserProfileOpen\", [userId, {backdrop: true}], 'communication');\n\t}\n\n\topenDialog(dialogId)\n\t{\n\t\tBXMobileApp.Events.postToComponent(\"onOpenDialog\", [{dialogId}, true], 'im.recent');\n\t}\n\n\topenPhoneMenu(number)\n\t{\n\t\tBX.MobileTools.phoneTo(number);\n\t}\n\n\topenMessageMenu(message)\n\t{\n\t\tif (this.messagesQueue.find(el => el.id === message.id))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: message.id,\n\t\t\tchatId: message.chatId,\n\t\t\tfields: {\n\t\t\t\tblink: true\n\t\t\t}\n\t\t});\n\n\t\tif (!this.messageMenuInstance)\n\t\t{\n\t\t\tlet currentUser = this.controller.getCurrentUser();\n\t\t\tlet dialog = this.controller.getDialogData();\n\n\t\t\tthis.messageMenuInstance = BackdropMenu\n\t\t\t\t.create('im.dialog.menu.mess|'+this.controller.getDialogId())\n\t\t\t\t.setItems([\n\t\t\t\t\tBackdropMenuItem.create('reply')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_MESSAGE_MENU_REPLY'])\n\t\t\t\t\t\t.setIcon(BackdropMenuIcon.reply)\n\t\t\t\t\t\t.skip((message) => {\n\t\t\t\t\t\t\tlet dialog = this.controller.getDialogData();\n\t\t\t\t\t\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.getUserId()))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn !message.authorId || message.authorId === this.controller.getUserId()\n\t\t\t\t\t\t})\n\t\t\t\t\t,\n\n\t\t\t\t\tBackdropMenuItem.create('copy')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_MESSAGE_MENU_COPY'])\n\t\t\t\t\t\t.setIcon(BackdropMenuIcon.copy)\n\t\t\t\t\t\t.skip((message) => message.params.IS_DELETED === 'Y')\n\t\t\t\t\t,\n\n\t\t\t\t\tBackdropMenuItem.create('quote')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_MESSAGE_MENU_QUOTE'])\n\t\t\t\t\t\t.setIcon(BackdropMenuIcon.quote)\n\t\t\t\t\t\t.skip((message) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet dialog = this.controller.getDialogData();\n\t\t\t\t\t\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.getUserId()))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn message.params.IS_DELETED === 'Y';\n\t\t\t\t\t\t})\n\t\t\t\t\t,\n\n\t\t\t\t\tBackdropMenuItem.create('unread')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_MESSAGE_MENU_UNREAD'])\n\t\t\t\t\t\t.setIcon(BackdropMenuIcon.unread)\n\t\t\t\t\t\t.skip((message) => message.authorId === this.controller.getUserId() || message.unread)\n\t\t\t\t\t,\n\n\t\t\t\t\tBackdropMenuItem.create('read')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_MESSAGE_MENU_READ'])\n\t\t\t\t\t\t.setIcon(BackdropMenuIcon.checked)\n\t\t\t\t\t\t.skip((message) => !message.unread)\n\t\t\t\t\t,\n\n\t\t\t\t\tBackdropMenuItem.create('edit')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_MESSAGE_MENU_EDIT'])\n\t\t\t\t\t\t.setIcon(BackdropMenuIcon.edit)\n\t\t\t\t\t\t.skip((message) => message.authorId !== this.controller.getUserId() || message.params.IS_DELETED === 'Y')\n\t\t\t\t\t,\n\n\t\t\t\t\tBackdropMenuItem.create('share')\n\t\t\t\t\t\t.setType(BackdropMenuItemType.menu)\n\t\t\t\t\t\t.setIcon(BackdropMenuIcon.circle_plus)\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_MESSAGE_MENU_SHARE_MENU'])\n\t\t\t\t\t\t.disableClose()\n\t\t\t\t\t\t.skip(currentUser.extranet || dialog.type === 'announcement')\n\t\t\t\t\t,\n\n\t\t\t\t\tBackdropMenuItem.create('profile')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_MESSAGE_MENU_PROFILE'])\n\t\t\t\t\t\t.setIcon(BackdropMenuIcon.user)\n\t\t\t\t\t\t.skip((message) => message.authorId <= 0 || !Utils.dialog.isChatId(this.controller.getDialogId()) || message.authorId === this.controller.getUserId())\n\t\t\t\t\t,\n\n\t\t\t\t\tBackdropMenuItem.create('delete')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_MESSAGE_MENU_DELETE'])\n\t\t\t\t\t\t.setStyles(BackdropMenuStyle.create().setFont(WidgetListItemFont.create().setColor('#c50000')))\n\t\t\t\t\t\t.setIcon(BackdropMenuIcon.trash)\n\t\t\t\t\t\t.skip((message) => message.authorId !== this.controller.getUserId() || message.params.IS_DELETED === 'Y')\n\t\t\t\t\t,\n\t\t\t\t])\n\t\t\t\t.setVersion(BX.componentParameters.get('WIDGET_BACKDROP_MENU_VERSION', '1.0.0'))\n\t\t\t\t.setEventListener((name, params, message, backdrop) => {\n\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (params.id === 'reply')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.replyToUser(message.authorId);\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'copy')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.copyMessage(message.id);\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'quote')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.quoteMessage(message.id);\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'edit')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.editMessage(message.id);\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'delete')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deleteMessage(message.id);\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'unread')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.unreadMessage(message.id);\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'read')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.readMessage(message.id);\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'share')\n\t\t\t\t\t{\n\t\t\t\t\t\tlet dialog = this.controller.getDialogData();\n\t\t\t\t\t\tlet subMenu = BackdropMenu\n\t\t\t\t\t\t\t.create('im.dialog.menu.mess.submenu|'+this.controller.getDialogId())\n\t\t\t\t\t\t\t.setItems([\n\t\t\t\t\t\t\t\tBackdropMenuItem.create('share_task')\n\t\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.task)\n\t\t\t\t\t\t\t\t\t.setTitle(this.localize['MOBILE_MESSAGE_MENU_SHARE_TASK'])\n\t\t\t\t\t\t\t\t,\n\t\t\t\t\t\t\t\tBackdropMenuItem.create('share_post')\n\t\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.lifefeed)\n\t\t\t\t\t\t\t\t\t.setTitle(this.localize['MOBILE_MESSAGE_MENU_SHARE_POST'])\n\t\t\t\t\t\t\t\t,\n\t\t\t\t\t\t\t\tBackdropMenuItem.create('share_chat')\n\t\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.chat)\n\t\t\t\t\t\t\t\t\t.setTitle(this.localize['MOBILE_MESSAGE_MENU_SHARE_CHAT'])\n\t\t\t\t\t\t\t\t,\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\t.setEventListener((name, params, options, backdrop) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\t\tif (params.id === 'share_task')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'TASK');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (params.id === 'share_post')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'POST');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (params.id === 'share_chat')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'CHAT');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t\tbackdrop.showSubMenu(subMenu);\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'profile')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openProfile(message.authorId);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.warn('BackdropMenuItem is not implemented', params);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\tthis.messageMenuInstance.setCustomParams(message).show();\n\n\t\tfabric.Answers.sendCustomEvent(\"vueChatOpenDropdown\", {});\n\t}\n\n\topenHeaderMenu()\n\t{\n\t\tfabric.Answers.sendCustomEvent(\"vueChatOpenHeaderMenu\", {});\n\n\t\tif (!this.headerMenu)\n\t\t{\n\t\t\tthis.headerMenu = HeaderMenu.create()\n\t\t\t\t.setUseNavigationBarColor()\n\t\t\t\t.setEventListener((name, params, customParams) => {\n\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (params.id === 'profile')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openProfile(this.controller.getDialogId());\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'user_list')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openUserList({listType: 'USERS', title: this.localize.MOBILE_HEADER_MENU_USER_LIST, backdrop: false});\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'user_add')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openAddUserDialog();\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'leave')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.leaveChat();\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'notify')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controller.muteDialog();\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'call_chat_call')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.MobileTools.phoneTo(this.controller.getDialogData().entityId);\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'goto_crm')\n\t\t\t\t\t{\n\t\t\t\t\t\tlet crmData = this.controller.getDialogCrmData();\n\t\t\t\t\t\tlet openWidget = BX.MobileTools.resolveOpenFunction('/crm/'+crmData.entityType+'/show/'+crmData.entityId+'/');\n\t\t\t\t\t\tif (openWidget)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\topenWidget();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'reload')\n\t\t\t\t\t{\n\t\t\t\t\t\t(new BXMobileApp.UI.NotificationBar({\n\t\t\t\t\t\t\tmessage: this.localize.MOBILE_HEADER_MENU_RELOAD_WAIT,\n\t\t\t\t\t\t\tcolor: \"#d920b0ff\",\n\t\t\t\t\t\t\ttextColor: \"#ffffff\",\n\t\t\t\t\t\t\tgroupId: \"refresh\",\n\t\t\t\t\t\t\tuseLoader: true,\n\t\t\t\t\t\t\tmaxLines: 1,\n\t\t\t\t\t\t\talign: \"center\",\n\t\t\t\t\t\t\thideOnTap: true\n\t\t\t\t\t\t}, \"copy\")).show();\n\n\t\t\t\t\t\tChatDialog.storeCollector.clearDatabase();\n\n\t\t\t\t\t\treload();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\n\t\tif (Utils.dialog.isChatId(this.controller.getDialogId()))\n\t\t{\n\t\t\tlet dialogData = this.controller.getDialogData();\n\t\t\tlet notifyToggleText = !this.controller.isDialogMuted()? this.localize['MOBILE_HEADER_MENU_NOTIFY_DISABLE']: this.localize['MOBILE_HEADER_MENU_NOTIFY_ENABLE'];\n\t\t\tlet notifyToggleIcon = !this.controller.isDialogMuted()? HeaderMenuIcon.notify: HeaderMenuIcon.notify_off;\n\n\t\t\tlet gotoCrmLocalize = '';\n\t\t\tif (\n\t\t\t\tdialogData.type === DialogType.call\n\t\t\t\t|| dialogData.type === DialogType.crm\n\t\t\t)\n\t\t\t{\n\t\t\t\tlet crmData = this.controller.getDialogCrmData();\n\t\t\t\tif (crmData.enabled)\n\t\t\t\t{\n\t\t\t\t\tif (crmData.entityType === DialogCrmType.lead)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.localize['MOBILE_GOTO_CRM_LEAD'];\n\t\t\t\t\t}\n\t\t\t\t\telse if (crmData.entityType === DialogCrmType.company)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.localize['MOBILE_GOTO_CRM_COMPANY'];\n\t\t\t\t\t}\n\t\t\t\t\telse if (crmData.entityType === DialogCrmType.contact)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.localize['MOBILE_GOTO_CRM_CONTACT'];\n\t\t\t\t\t}\n\t\t\t\t\telse if (crmData.entityType === DialogCrmType.deal)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.localize['MOBILE_GOTO_CRM_DEAL'];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.localize['MOBILE_GOTO_CRM'];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (dialogData.type === DialogType.call)\n\t\t\t{\n\t\t\t\tthis.headerMenu.setItems([\n\t\t\t\t\tHeaderMenuItem.create('call_chat_call')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_HEADER_MENU_AUDIO_CALL'])\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.phone)\n\t\t\t\t\t\t.skip(dialogData.entityId === 'UNIFY_CALL_CHAT')\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('goto_crm')\n\t\t\t\t\t\t.setTitle(gotoCrmLocalize)\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.lifefeed)\n\t\t\t\t\t\t.skip(dialogData.entityId === 'UNIFY_CALL_CHAT')\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_HEADER_MENU_RELOAD'])\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.reload)\n\t\t\t\t\t,\n\t\t\t\t]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet items = [\n\t\t\t\t\tHeaderMenuItem.create('notify')\n\t\t\t\t\t\t.setTitle(notifyToggleText)\n\t\t\t\t\t\t.setIcon(notifyToggleIcon)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('user_list')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_HEADER_MENU_USER_LIST'])\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.user)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('user_add')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_HEADER_MENU_USER_ADD'])\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.user_plus)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('leave')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_HEADER_MENU_LEAVE'])\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.cross)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t\t.setTitle(this.localize['MOBILE_HEADER_MENU_RELOAD'])\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.reload)\n\t\t\t\t\t,\n\t\t\t\t];\n\n\t\t\t\tif (\n\t\t\t\t\tdialogData.type === DialogType.crm\n\t\t\t\t\t&& gotoCrmLocalize\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\titems.unshift(HeaderMenuItem.create('goto_crm')\n\t\t\t\t\t\t.setTitle(gotoCrmLocalize)\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.lifefeed)\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis.headerMenu.setItems(items);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.headerMenu.setItems([\n\t\t\t\tHeaderMenuItem.create('profile')\n\t\t\t\t\t.setTitle(this.localize['MOBILE_HEADER_MENU_PROFILE'])\n\t\t\t\t\t.setIcon('user')\n\t\t\t\t\t.skip(Utils.dialog.isChatId(this.controller.getDialogId()))\n\t\t\t\t,\n\t\t\t\tHeaderMenuItem.create('user_add')\n\t\t\t\t\t.setTitle(this.localize['MOBILE_HEADER_MENU_USER_ADD'])\n\t\t\t\t\t.setIcon(HeaderMenuIcon.user_plus)\n\t\t\t\t,\n\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t.setTitle(this.localize['MOBILE_HEADER_MENU_RELOAD'])\n\t\t\t\t\t.setIcon(HeaderMenuIcon.reload)\n\t\t\t\t,\n\t\t\t]);\n\t\t}\n\n\t\tthis.headerMenu.show(true);\n\t}\n\n\tshareMessage(messageId, type)\n\t{\n\t\tif (this.offline)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.controller.shareMessage(messageId, type);\n\t}\n\n\treadMessage(messageId)\n\t{\n\t\t// if (this.offline)\n\t\t// {\n\t\t// \treturn false;\n\t\t// }\n\n\t\tthis.controller.readMessage(messageId, true, true).then((result) =>\n\t\t{\n\t\t\tif (result.lastId <= 0)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tBXMobileApp.Events.postToComponent('chatbackground::task::action', [\n\t\t\t\t'readMessage',\n\t\t\t\t'readMessage|'+result.dialogId,\n\t\t\t\tresult,\n\t\t\t\tfalse,\n\t\t\t\t200\n\t\t\t], 'background');\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tunreadMessage(messageId)\n\t{\n\t\tif (this.offline)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.controller.unreadMessage(messageId);\n\t}\n\n\topenReadedList(list)\n\t{\n\t\tif (!Utils.dialog.isChatId(this.controller.getDialogId()))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!list || list.length <= 1)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.openUserList({\n\t\t\tusers: list.map(element => element.userId),\n\t\t\ttitle: this.localize.MOBILE_MESSAGE_LIST_VIEW\n\t\t});\n\t}\n\n\treplyToUser(userId, userData = null)\n\t{\n\t\tif (this.offline)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!userData)\n\t\t{\n\t\t\tuserData = this.store.getters['users/get'](userId);\n\t\t}\n\n\t\treturn this.insertText({text: `[USER=${userId}]${userData.firstName}[/USER] `});\n\t}\n\n\tcopyMessage(id)\n\t{\n\t\tlet quoteMessage = this.store.getters['messages/getMessage'](this.controller.getChatId(), id);\n\n\t\tlet text = '';\n\n\t\tif (quoteMessage.params.FILE_ID && quoteMessage.params.FILE_ID.length)\n\t\t{\n\t\t\ttext = quoteMessage.params.FILE_ID.map(fileId => '[DISK='+fileId+']').join(\" \");\n\t\t}\n\n\t\tif (quoteMessage.text)\n\t\t{\n\t\t\tif (text)\n\t\t\t{\n\t\t\t\ttext += '\\n';\n\t\t\t}\n\n\t\t\ttext += quoteMessage.text.replace(/^([-]{54}\\n)/gm, '-'.repeat(21)+'\\n');\n\t\t}\n\n\t\tapp.exec(\"copyToClipboard\", {text});\n\n\t\t(new BXMobileApp.UI.NotificationBar({\n\t\t\tmessage: BX.message(\"MOBILE_MESSAGE_MENU_COPY_SUCCESS\"),\n\t\t\tcolor: \"#af000000\",\n\t\t\ttextColor: \"#ffffff\",\n\t\t\tgroupId: \"clipboard\",\n\t\t\tmaxLines: 1,\n\t\t\talign: \"center\",\n\t\t\tisGlobal: true,\n\t\t\tuseCloseButton: true,\n\t\t\tautoHideTimeout: 1500,\n\t\t\thideOnTap: true\n\t\t}, \"copy\")).show();\n\t}\n\n\tquoteMessage(id)\n\t{\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: id\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tif (this.store.state.application.mobile.keyboardShow)\n\t\t\t{\n\t\t\t\tsetTimeout(() => this.controller.emit(EventType.dialog.scrollToBottom, {duration: 300, cancelIfScrollChange: true}), 300);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setTextFocus();\n\t\t\t}\n\t\t});\n\t}\n\n\treactMessage(id, reaction)\n\t{\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::action', [\n\t\t\t'reactMessage',\n\t\t\t'reactMessage|'+id,\n\t\t\t{\n\t\t\t\tmessageId: id,\n\t\t\t\taction: reaction.action === 'auto'? 'auto': (reaction.action === 'set'? 'plus': 'minus')\n\t\t\t},\n\t\t\tfalse,\n\t\t\t1000\n\t\t], 'background');\n\n\t\tif (reaction.action === 'set')\n\t\t{\n\t\t\tsetTimeout(() => app.exec(\"callVibration\"), 200);\n\t\t}\n\t}\n\n\topenMessageReactionList(id, reactions)\n\t{\n\t\tif (!Utils.dialog.isChatId(this.controller.getDialogId()))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet users = [];\n\t\tfor (let reaction in reactions)\n\t\t{\n\t\t\tif (!reactions.hasOwnProperty(reaction))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tusers = users.concat(reactions[reaction]);\n\t\t}\n\n\t\tthis.openUserList({\n\t\t\tusers: users,\n\t\t\ttitle: this.localize.MOBILE_MESSAGE_LIST_LIKE\n\t\t});\n\t}\n\n\texecMessageKeyboardCommand(data)\n\t{\n\t\tif (data.action !== 'COMMAND')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet {dialogId, messageId, botId, command, params} = data.params;\n\n\t\tthis.restClient.callMethod(RestMethod.imMessageCommand, {\n\t\t\t'MESSAGE_ID': messageId,\n\t\t\t'DIALOG_ID': dialogId,\n\t\t\t'BOT_ID': botId,\n\t\t\t'COMMAND': command,\n\t\t\t'COMMAND_PARAMS': params,\n\t\t});\n\n\t\treturn true;\n\t}\n\n\texecMessageOpenChatTeaser(data)\n\t{\n\t\tthis.controller.joinParentChat(data.message.id, 'chat'+data.message.params.CHAT_ID).then((dialogId) => {\n\t\t\tthis.openDialog(dialogId);\n\t\t}).catch(() => {});\n\n\t\treturn true;\n\t}\n\n\tquoteMessageClear()\n\t{\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: 0\n\t\t\t}\n\t\t});\n\t}\n\n\teditMessage(id)\n\t{\n\t\t//if (!this.checkEditMessage(messageId, 'edit'))\n\t\t//\treturn false;\n\n\t\tlet message = this.store.getters['messages/getMessage'](this.controller.getChatId(), id);\n\n\t\tthis.store.dispatch('application/set', {mobile: {\n\t\t\tkeyboardShow: true,\n\t\t}});\n\n\t\tlet siteDir = this.localize.SITE_DIR? this.localize.SITE_DIR: '/';\n\n\t\tapp.exec('showPostForm', {\n\t\t\tmentionButton: {\n\t\t\t\tdataSource: {\n\t\t\t\t\treturn_full_mode: \"YES\",\n\t\t\t\t\toutsection: \"NO\",\n\t\t\t\t\tmultiple: \"NO\",\n\t\t\t\t\talphabet_index: \"YES\",\n\t\t\t\t\turl: siteDir + 'mobile/index.php?mobile_action=get_user_list'\n\t\t\t\t}\n\t\t\t},\n\t\t\tsmileButton: {},\n\t\t\tmessage: {\n\t\t\t\ttext: message.text\n\t\t\t},\n\t\t\tokButton: {\n\t\t\t\tcallback: (data) => this.editMessageSend(id, data.text),\n\t\t\t\tname: BX.message('MOBILE_EDIT_SAVE')\n\t\t\t},\n\t\t\tcancelButton: {\n\t\t\t\tcallback: () => {\n\t\t\t\t\tthis.store.dispatch('application/set', {mobile: {\n\t\t\t\t\t\tkeyboardShow: false,\n\t\t\t\t\t}});\n\t\t\t\t},\n\t\t\t\tname: BX.message('MOBILE_EDIT_CANCEL')\n\t\t\t}\n\t\t});\n\t}\n\n\teditMessageSend(id, text)\n\t{\n\t\tthis.restClient.callMethod(RestMethod.imMessageUpdate, {\n\t\t\t'MESSAGE_ID': id,\n\t\t\t'MESSAGE': text\n\t\t}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imMessageUpdate,\n\t\t\tdata: {timMessageType: 'text'},\n\t\t\tdialog: this.controller.getDialogData()\n\t\t}));\n\t}\n\n\tdeleteMessage(id)\n\t{\n\t\tlet message = this.store.getters['messages/getMessage'](this.controller.getChatId(), id);\n\t\tlet files = this.store.getters['files/getList'](this.controller.getChatId());\n\n\t\tlet messageText = Utils.text.purify(message.text, message.params, files, this.localize);\n\t\tmessageText = messageText.length > 50? messageText.substr(0, 47) + '...': messageText;\n\n\t\tapp.confirm({\n\t\t\ttitle: this.localize.MOBILE_MESSAGE_MENU_DELETE_CONFIRM,\n\t\t\ttext: messageText? '\"' + messageText + '\"': '',\n\t\t\tbuttons: [\n\t\t\t\tthis.localize.MOBILE_MESSAGE_MENU_DELETE_YES,\n\t\t\t\tthis.localize.MOBILE_MESSAGE_MENU_DELETE_NO\n\t\t\t],\n\t\t\tcallback: (button) =>\n\t\t\t{\n\t\t\t\tif (button === 1)\n\t\t\t\t{\n\t\t\t\t\tthis.deleteMessageSend(id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tdeleteMessageSend(id)\n\t{\n\t\tthis.restClient.callMethod(RestMethod.imMessageDelete, {\n\t\t\t'MESSAGE_ID': id\n\t\t}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imMessageDelete,\n\t\t\tdata: {},\n\t\t\tdialog: this.controller.getDialogData(this.controller.getDialogId())\n\t\t}));\n\t}\n\n\tinsertText(params)\n\t{\n\t\tBXMobileApp.UI.Page.TextPanel.getText((text) => {\n\t\t\ttext = text.toString().trim();\n\n\t\t\ttext = text? text+' '+params.text: params.text;\n\n\t\t\tthis.setText(text);\n\t\t\tthis.setTextFocus();\n\t\t});\n\t}\n\n\tsetText(text = '')\n\t{\n\t\ttext = text.toString();\n\n\t\tif (text)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.setText(text);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.clear();\n\t\t}\n\n\t\tthis.setTextareaMessage({message: text});\n\n\t\tconsole.log('Set new text in textarea', text? text: '-- empty --');\n\t}\n\n\tclearText()\n\t{\n\t\tthis.setText();\n\t}\n\n\tsetTextFocus()\n\t{\n\t\tif (!this.store.state.application.mobile.keyboardShow)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.focus();\n\t\t}\n\t}\n\n\tgetHost()\n\t{\n\t\treturn currentDomain || '';\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn 's1';\n\t}\n\n\tisBackground()\n\t{\n\t\tif (typeof BXMobileAppContext !== \"object\")\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\ttypeof BXMobileAppContext.isAppActive === \"function\"\n\t\t\t&& !BXMobileAppContext.isAppActive()\n\t\t)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (typeof BXMobileAppContext.isBackground === \"function\")\n\t\t{\n\t\t\treturn BXMobileAppContext.isBackground();\n\t\t}\n\n\t\treturn false;\n\t}\n\n/* endregion 05. Templates and template interaction */\n\n/* region 05. Interaction and utils */\n\n\texecuteBackgroundTaskSuccess(action, data)\n\t{\n\t\tlet successObject =\n\t\t{\n\t\t\terror: () => false,\n\t\t\tdata: () => data.result,\n\t\t};\n\n\t\tconsole.log('Dialog.executeBackgroundTaskSuccess', action, data);\n\n\t\tif (action === 'sendMessage')\n\t\t{\n\t\t\tthis.executeRestAnswer(RestMethodHandler.imMessageAdd, successObject, data.extra);\n\t\t}\n\t\telse if (action === 'readMessage')\n\t\t{\n\t\t\tthis.processMarkReadMessages();\n\t\t}\n\t}\n\n\texecuteBackgroundTaskFailure(action, data)\n\t{\n\t\tlet errorObject =\n\t\t{\n\t\t\terror: () => {\n\t\t\t\treturn {\n\t\t\t\t\terror: data.code,\n\t\t\t\t\terror_description: data.text,\n\t\t\t\t\tex: {\n\t\t\t\t\t\tstatus: data.status,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tdata: () => false,\n\t\t};\n\n\t\tconsole.log('Dialog.executeBackgroundTaskFailure', action, data);\n\n\t\tif (action === 'sendMessage')\n\t\t{\n\t\t\tthis.executeRestAnswer(RestMethodHandler.imMessageAdd, errorObject, data.extra);\n\t\t}\n\t}\n\n/* endregion 05. Interaction and utils */\n\n/* region 06. Interaction and utils */\n\n\tsetError(code = '', description = '')\n\t{\n\t\tconsole.error(`MobileChat.error: ${code} (${description})`);\n\n\t\tlet localizeDescription = '';\n\t\tif (code.endsWith('LOCALIZED'))\n\t\t{\n\t\t\tlocalizeDescription = description;\n\t\t}\n\n\t\tthis.store.commit('application/set', {error: {\n\t\t\tactive: true,\n\t\t\tcode,\n\t\t\tdescription: localizeDescription\n\t\t}});\n\t}\n\n\tclearError()\n\t{\n\t\tthis.store.commit('application/set', {error: {\n\t\t\tactive: false,\n\t\t\tcode: '',\n\t\t\tdescription: ''}\n\t\t});\n\t}\n\n\taddLocalize(phrases)\n\t{\n\t\tif (typeof phrases !== \"object\" || !phrases)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (let name in phrases)\n\t\t{\n\t\t\tif (phrases.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.localize[name] = phrases[name];\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetLocalize(name)\n\t{\n\t\tlet phrase = '';\n\t\tif (typeof name === 'undefined')\n\t\t{\n\t\t\treturn this.localize;\n\t\t}\n\t\telse if (typeof this.localize[name.toString()] === 'undefined')\n\t\t{\n\t\t\tconsole.warn(`MobileChat.getLocalize: message with code '${name.toString()}' is undefined.`)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tphrase = this.localize[name];\n\t\t}\n\n\t\treturn phrase;\n\t}\n\n/* endregion 06. Interaction and utils */\n}","/**\n * Bitrix im dialog mobile\n * Dialog vue component\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2019 Bitrix\n */\n\nimport {Vue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\nimport {Logger} from \"im.tools.logger\";\nimport {EventType} from \"im.const\";\nimport {Utils} from \"im.utils\";\nimport \"im.component.dialog\";\nimport \"im.component.quotepanel\";\n\n/**\n * @notice Do not mutate or clone this component! It is under development.\n */\nVue.component('bx-messenger',\n{\n\tdata: function()\n\t{\n\t\treturn {\n\t\t\tdialogState: 'loading'\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tEventType: () => EventType,\n\t\tlocalize()\n\t\t{\n\t\t\treturn Object.assign({},\n\t\t\t\tVue.getFilteredPhrases('MOBILE_CHAT_', this.$root.$bitrixMessages),\n\t\t\t\tVue.getFilteredPhrases('IM_UTILS_', this.$root.$bitrixMessages),\n\t\t\t);\n\t\t},\n\t\twidgetClassName(state)\n\t\t{\n\t\t\tlet className = ['bx-mobilechat-wrapper'];\n\n\t\t\tif (this.showMessageDialog)\n\t\t\t{\n\t\t\t\tclassName.push('bx-mobilechat-chat-start');\n\t\t\t}\n\n\t\t\treturn className.join(' ');\n\t\t},\n\t\tquotePanelData()\n\t\t{\n\t\t\tlet result = {\n\t\t\t\tid: 0,\n\t\t\t\ttitle: '',\n\t\t\t\tdescription: '',\n\t\t\t\tcolor: ''\n\t\t\t};\n\n\t\t\tif (!this.showMessageDialog || !this.dialog.quoteId)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tlet message = this.$store.getters['messages/getMessage'](this.dialog.chatId, this.dialog.quoteId);\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tlet user = this.$store.getters['users/get'](message.authorId);\n\t\t\tlet files = this.$store.getters['files/getList'](this.dialog.chatId);\n\n\t\t\treturn {\n\t\t\t\tid: this.dialog.quoteId,\n\t\t\t\ttitle: message.params.NAME ? message.params.NAME : (user ? user.name: ''),\n\t\t\t\tcolor: user? user.color: '',\n\t\t\t\tdescription: Utils.text.purify(message.text, message.params, files, this.localize)\n\t\t\t};\n\t\t},\n\n\t\tisDialog()\n\t\t{\n\t\t\treturn Utils.dialog.isChatId(this.dialog.dialogId);\n\t\t},\n\n\t\tisGestureQuoteSupported()\n\t\t{\n\t\t\tif (this.dialog && this.dialog.type === 'announcement' && !this.dialog.managerList.includes(this.application.common.userId))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn ChatPerformance.isGestureQuoteSupported();\n\t\t},\n\t\tisDarkBackground()\n\t\t{\n\t\t\treturn this.application.options.darkBackground;\n\t\t},\n\t\tshowMessageDialog()\n\t\t{\n\t\t\tlet result = this.messageCollection && this.messageCollection.length > 0;\n\t\t\tlet timeout = ChatPerformance.getDialogShowTimeout();\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\tif (timeout > 0)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.dialogStateTimeout);\n\t\t\t\t\tthis.dialogStateTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.dialogState = 'show';\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.dialogState = 'show';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.dialog && this.dialog.init)\n\t\t\t{\n\t\t\t\tif (timeout > 0)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.dialogStateTimeout);\n\t\t\t\t\tthis.dialogStateTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.dialogState = 'empty';\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.dialogState = 'empty';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.dialogState = 'loading';\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t\tdialog: state => state.dialogues.collection[state.application.dialog.dialogId],\n\t\t\tmessageCollection: state => state.messages.collection[state.application.dialog.chatId]\n\t\t})\n\t},\n\tmethods:\n\t{\n\t\tlogEvent(name, ...params)\n\t\t{\n\t\t\tLogger.info(name, ...params);\n\t\t},\n\t\tonDialogRequestHistory(event)\n\t\t{\n\t\t\tthis.$root.$bitrixApplication.getDialogHistory(event.lastId);\n\t\t},\n\t\tonDialogRequestUnread(event)\n\t\t{\n\t\t\tthis.$root.$bitrixApplication.getDialogUnread(event.lastId);\n\t\t},\n\t\tonDialogMessageClickByUserName(event)\n\t\t{\n\t\t\tthis.$root.$bitrixApplication.replyToUser(event.user.id, event.user);\n\t\t},\n\t\tonDialogMessageClickByUploadCancel(event)\n\t\t{\n\t\t\tthis.$root.$bitrixApplication.cancelUploadFile(event.file.id);\n\t\t},\n\t\tonDialogMessageClickByCommand(event)\n\t\t{\n\t\t\tif (event.type === 'put')\n\t\t\t{\n\t\t\t\tthis.$root.$bitrixApplication.insertText({text: event.value+' '});\n\t\t\t}\n\t\t\telse if (event.type === 'send')\n\t\t\t{\n\t\t\t\tthis.$root.$bitrixApplication.addMessage(event.value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('Unprocessed command', event);\n\t\t\t}\n\t\t},\n\t\tonDialogMessageClickByMention(event)\n\t\t{\n\t\t\tif (event.type === 'USER')\n\t\t\t{\n\t\t\t\tthis.$root.$bitrixApplication.openProfile(event.value);\n\t\t\t}\n\t\t\telse if (event.type === 'CHAT')\n\t\t\t{\n\t\t\t\tthis.$root.$bitrixApplication.openDialog(event.value);\n\t\t\t}\n\t\t\telse if (event.type === 'CALL')\n\t\t\t{\n\t\t\t\tthis.$root.$bitrixApplication.openPhoneMenu(event.value);\n\t\t\t}\n\t\t},\n\t\tonDialogMessageMenuClick(event)\n\t\t{\n\t\t\tLogger.warn('Message menu:', event);\n\t\t\tthis.$root.$bitrixApplication.openMessageMenu(event.message);\n\t\t},\n\t\tonDialogMessageRetryClick(event)\n\t\t{\n\t\t\tLogger.warn('Message retry:', event);\n\t\t\tthis.$root.$bitrixApplication.retrySendMessage(event.message);\n\t\t},\n\t\tonDialogReadMessage(event)\n\t\t{\n\t\t\tthis.$root.$bitrixApplication.readMessage(event.id);\n\t\t},\n\t\tonDialogReadedListClick(event)\n\t\t{\n\t\t\tthis.$root.$bitrixApplication.openReadedList(event.list);\n\t\t},\n\t\tonDialogQuoteMessage(event)\n\t\t{\n\t\t\tthis.$root.$bitrixApplication.quoteMessage(event.message.id);\n\t\t},\n\t\tonDialogMessageReactionSet(event)\n\t\t{\n\t\t\tthis.$root.$bitrixApplication.reactMessage(event.message.id, event.reaction);\n\t\t},\n\t\tonDialogMessageReactionListOpen(event)\n\t\t{\n\t\t\tthis.$root.$bitrixApplication.openMessageReactionList(event.message.id, event.values);\n\t\t},\n\t\tonDialogMessageClickByKeyboardButton(event)\n\t\t{\n\t\t\tthis.$root.$bitrixApplication.execMessageKeyboardCommand(event);\n\t\t},\n\t\tonDialogMessageClickByChatTeaser(event)\n\t\t{\n\t\t\tthis.$root.$bitrixApplication.execMessageOpenChatTeaser(event);\n\t\t},\n\t\tonDialogClick(event)\n\t\t{\n\t\t},\n\t\tonQuotePanelClose()\n\t\t{\n\t\t\tthis.$root.$bitrixApplication.quoteMessageClear();\n\t\t},\n\n\t},\n\ttemplate: `\n\t\t<div :class=\"widgetClassName\">\n\t\t\t<div :class=\"['bx-mobilechat-box', {'bx-mobilechat-box-dark-background': isDarkBackground}]\">\n\t\t\t\t<template v-if=\"application.error.active\">\n\t\t\t\t\t<bx-messenger-body-error/>\n\t\t\t\t</template>\t\t\t\n\t\t\t\t<template v-else>\n\t\t\t\t\t<bx-pull-status/>\n\t\t\t\t\t<div :class=\"['bx-mobilechat-body', {'bx-mobilechat-body-with-message': dialogState == 'show'}]\" key=\"with-message\">\n\t\t\t\t\t\t<template v-if=\"dialogState == 'loading'\">\n\t\t\t\t\t\t\t<bx-messenger-body-loading/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else-if=\"dialogState == 'empty'\">\n\t\t\t\t\t\t\t<bx-messenger-body-empty/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class=\"bx-mobilechat-dialog\">\n\t\t\t\t\t\t\t\t<bx-messenger-dialog\n\t\t\t\t\t\t\t\t\t:userId=\"application.common.userId\" \n\t\t\t\t\t\t\t\t\t:dialogId=\"application.dialog.dialogId\"\n\t\t\t\t\t\t\t\t\t:chatId=\"application.dialog.chatId\"\n\t\t\t\t\t\t\t\t\t:messageLimit=\"application.dialog.messageLimit\"\n\t\t\t\t\t\t\t\t\t:messageExtraCount=\"application.dialog.messageExtraCount\"\n\t\t\t\t\t\t\t\t\t:enableReadMessages=\"application.dialog.enableReadMessages\"\n\t\t\t\t\t\t\t\t\t:enableReactions=\"true\"\n\t\t\t\t\t\t\t\t\t:enableDateActions=\"false\"\n\t\t\t\t\t\t\t\t\t:enableCreateContent=\"false\"\n\t\t\t\t\t\t\t\t\t:enableGestureQuote=\"application.options.quoteEnable\"\n\t\t\t\t\t\t\t\t\t:enableGestureQuoteFromRight=\"application.options.quoteFromRight\"\n\t\t\t\t\t\t\t\t\t:enableGestureMenu=\"true\"\n\t\t\t\t\t\t\t\t\t:showMessageUserName=\"isDialog\"\n\t\t\t\t\t\t\t\t\t:showMessageAvatar=\"isDialog\"\n\t\t\t\t\t\t\t\t\t:showMessageMenu=\"false\"\n\t\t\t\t\t\t\t\t\t:listenEventScrollToBottom=\"EventType.dialog.scrollToBottom\"\n\t\t\t\t\t\t\t\t\t:listenEventRequestHistory=\"EventType.dialog.requestHistoryResult\"\n\t\t\t\t\t\t\t\t\t:listenEventRequestUnread=\"EventType.dialog.requestUnreadResult\"\n\t\t\t\t\t\t\t\t\t:listenEventSendReadMessages=\"EventType.dialog.sendReadMessages\"\n\t\t\t\t\t\t\t\t\t@readMessage=\"onDialogReadMessage\"\n\t\t\t\t\t\t\t\t\t@quoteMessage=\"onDialogQuoteMessage\"\n\t\t\t\t\t\t\t\t\t@requestHistory=\"onDialogRequestHistory\"\n\t\t\t\t\t\t\t\t\t@requestUnread=\"onDialogRequestUnread\"\n\t\t\t\t\t\t\t\t\t@clickByCommand=\"onDialogMessageClickByCommand\"\n\t\t\t\t\t\t\t\t\t@clickByMention=\"onDialogMessageClickByMention\"\n\t\t\t\t\t\t\t\t\t@clickByUserName=\"onDialogMessageClickByUserName\"\n\t\t\t\t\t\t\t\t\t@clickByMessageMenu=\"onDialogMessageMenuClick\"\n\t\t\t\t\t\t\t\t\t@clickByMessageRetry=\"onDialogMessageRetryClick\"\n\t\t\t\t\t\t\t\t\t@clickByUploadCancel=\"onDialogMessageClickByUploadCancel\"\n\t\t\t\t\t\t\t\t\t@clickByReadedList=\"onDialogReadedListClick\"\n\t\t\t\t\t\t\t\t\t@setMessageReaction=\"onDialogMessageReactionSet\"\n\t\t\t\t\t\t\t\t\t@openMessageReactionList=\"onDialogMessageReactionListOpen\"\n\t\t\t\t\t\t\t\t\t@clickByKeyboardButton=\"onDialogMessageClickByKeyboardButton\"\n\t\t\t\t\t\t\t\t\t@clickByChatTeaser=\"onDialogMessageClickByChatTeaser\"\n\t\t\t\t\t\t\t\t\t@click=\"onDialogClick\"\n\t\t\t\t\t\t\t\t />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<bx-messenger-quote-panel :id=\"quotePanelData.id\" :title=\"quotePanelData.title\" :description=\"quotePanelData.description\" :color=\"quotePanelData.color\" @close=\"onQuotePanelClose\"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`\n});","/**\n * Bitrix OpenLines widget\n * Body error component (Vue component)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {Vue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\n\nVue.component('bx-messenger-body-error',\n{\n\tcomputed:\n\t{\n\t\tlocalize()\n\t\t{\n\t\t\treturn  Object.freeze({\n\t\t\t\tMOBILE_CHAT_ERROR_TITLE: this.$root.$bitrixMessages.MOBILE_CHAT_ERROR_TITLE,\n\t\t\t\tMOBILE_CHAT_ERROR_DESC: this.$root.$bitrixMessages.MOBILE_CHAT_ERROR_DESC\n\t\t\t});\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application\n\t\t}),\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-body\" key=\"error-body\">\n\t\t\t<div class=\"bx-mobilechat-warning-window\">\n\t\t\t\t<div class=\"bx-mobilechat-warning-icon\"></div>\n\t\t\t\t<template v-if=\"application.error.description\"> \n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\" v-html=\"application.error.description\"></div>\n\t\t\t\t</template> \n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-warning-msg\">{{localize.MOBILE_CHAT_ERROR_TITLE}}</div>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\">{{localize.MOBILE_CHAT_ERROR_DESC}}</div>\n\t\t\t\t</template> \n\t\t\t</div>\n\t\t</div>\n\t`\n});\n","/**\n * Bitrix OpenLines widget\n * Body loading component (Vue component)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {Vue} from \"ui.vue\";\n\nVue.component('bx-messenger-body-loading',\n{\n\tcomputed:\n\t{\n\t\tlocalize()\n\t\t{\n\t\t\treturn  Object.freeze({\n\t\t\t\tMOBILE_CHAT_LOADING: this.$root.$bitrixMessages.MOBILE_CHAT_LOADING\n\t\t\t});\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t<svg class=\"bx-mobilechat-loading-circular\" viewBox=\"25 25 50 50\">\n\t\t\t\t<circle class=\"bx-mobilechat-loading-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t\t<circle class=\"bx-mobilechat-loading-inner-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t</svg>\n\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">{{localize.MOBILE_CHAT_LOADING}}</h3>\n\t\t</div>\n\t`\n});","/**\n * Bitrix OpenLines widget\n * Body loading component (Vue component)\n *\n * @package bitrix\n * @subpackage imopenlines\n * @copyright 2001-2019 Bitrix\n */\n\nimport {Vue} from \"ui.vue\";\n\nVue.component('bx-messenger-body-empty',\n{\n\tcomputed:\n\t{\n\t\tlocalize()\n\t\t{\n\t\t\treturn  Object.freeze({\n\t\t\t\tMOBILE_CHAT_EMPTY: this.$root.$bitrixMessages.MOBILE_CHAT_EMPTY\n\t\t\t});\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">{{localize.MOBILE_CHAT_EMPTY}}</h3>\n\t\t</div>\n\t`\n});","/**\n * Bitrix im dialog mobile\n * Registry class\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2019 Bitrix\n */\n\n// vue components\nimport 'pull.components.status';\nimport 'im.component.dialog';\n\n// dialog files\nimport \"./dialog.css\";\nimport {Dialog} from \"./dialog\";\n\n// widget components\n\nimport \"./component/bx-messenger\";\nimport \"./component/bx-messenger-body-error\";\nimport \"./component/bx-messenger-body-loading\";\nimport \"./component/bx-messenger-body-empty\";\n\nexport {Dialog}"],"names":["MobileRestAnswerHandler","params","context","data","store","commit","dialog","chatId","id","dialogId","dialog_id","diskFolderId","disk_folder_id","redrawHeader","error","ex","app","closeController","disk","enabled","maxFileSize","phpUploadMaxFilesize","addLocalize","BX","message","LocalStorage","set","controller","getSiteId","emit","EventType","sendReadMessages","messageId","messagesQueue","filter","el","result","BaseRestAnswerHandler","Dialog","ready","offline","host","getHost","inited","restClient","rest","customData","localize","subscribers","dateFormat","configRequestXhr","windowFocused","rootNode","document","getElementById","template","timer","Timer","window","addEventListener","device","orientation","Utils","getOrientation","state","application","type","DeviceType","mobile","DeviceOrientation","horizontal","activeElement","blur","serverVariables","get","componentParameters","init","then","initMobileSettings","initStorage","initComponent","requestData","initEnvironment","initMobileEnvironment","initPullClient","console","log","Promise","resolve","reject","ApplicationStorage","getObject","quoteEnable","ChatPerformance","isGestureQuoteSupported","quoteFromRight","autoplayVideo","isAutoPlayVideoSupported","backgroundType","value","OPTIONS","ApplicationController","SITE_DIR","storedEvents","STORED_EVENTS","applicationVariables","common","userId","USER_ID","siteId","SITE_ID","languageId","LANGUAGE_ID","isMobile","desktop","DIALOG_ID","messageLimit","getDefaultMessageLimit","enableReadMessages","options","darkBackground","ChatDialogBackground","dark","VuexBuilder","addModel","ApplicationModel","create","useDatabase","setVariables","MessagesModel","DialoguesModel","FilesModel","default","name","getLocalize","UsersModel","setDatabaseConfig","DatabaseType","jnSharedStorage","build","subscribe","mutation","eventStoreInteraction","storeCollector","builder","setStore","setRestClient","setPrepareFilesBeforeSaveFunction","prepareFileData","bind","imRestAnswer","ImRestAnswerHandler","mobileRestAnswer","getters","getDialogId","executionTime","Date","attachTemplate","setTemplateEngine","setTextareaMessage","debounce","BXMobileApp","UI","Page","Scroll","setEnabled","captureKeyboardEvents","addCustomEvent","dispatch","keyboardShow","duration","cancelIfScrollChange","clearInterval","keyboardOpeningInterval","checkWindowFocused","isVisible","callback","status","Vue","event","$emit","getDialogUnread","processSendMessages","catch","action","taskId","toString","split","executeBackgroundTaskSuccess","executeBackgroundTaskFailure","pullCommandHandler","optionImportant","handleMessageAdd","TextPanel","setParams","getKeyboardParams","changeChatKeyboardStatus","MobileUploadProvider","setListener","executeUploaderEvent","fileUpdateProgress","throttle","fileId","progress","size","fields","isChatId","getDialogData","DialogType","call","exec","items","fabric","Answers","sendCustomEvent","openAddUserDialog","userShowWorkPosition","setTimeout","setInterval","widgetCache","ChatWidgetCache","getUserId","getLanguageId","Pull","ImPullCommandHandler","length","onCustomEvent","PullClient","SubscriptionType","Server","moduleId","command","Status","eventStatusInteraction","Online","eventOnlineInteraction","requestDataSend","start","warn","titleAction","useProgress","useLetterImage","query","RestMethodHandler","mobileBrowserConstGet","RestMethod","imChatGet","imDialogMessagesGetInit","imDialogMessagesGet","limit","getRequestMessageLimit","convert_text","imUserGet","imUserListGet","callBatch","response","setError","constGet","executeRestAnswer","userGet","userListGet","chatGetResult","dialogMessagesGetResult","stop","getChatId","option","skip","getLogTrackingParams","extra","execute","eventName","eventData","MobileUploaderConst","FILE_UPLOAD_PROGRESS","percent","file","byteTotal","FILE_CREATED","fileError","errors","FileStatus","wait","info","FILES","DISK_ID","upload","urlDownload","urlPreview","urlShow","TASK_CANCELLED","TASK_NOT_FOUND","cancelUploadFile","FILE_CREATED_FAILED","FILE_UPLOAD_FAILED","FILE_READ_ERROR","TASK_STARTED_FAILED","files","prepareFunction","startsWith","FileType","image","currentDomain","replace","Array","map","headerProperties","getChatHeaderParams","getUserHeaderParams","setCallMenu","headerMenuInited","TopBar","title","setCallback","openHeaderMenu","setText","desc","setDetailText","avatar","setImage","color","imageColor","user","showLastDate","lastActivityDate","getLastDateText","workPosition","chatTypeTitle","toUpperCase","show","managerList","includes","keyboardShowFlag","hide","callMenuSetted","userData","parseInt","bot","network","openCallMenu","Events","postToComponent","video","users","listType","backdrop","settings","objectName","componentCode","scriptPath","ownerId","rootWidget","phones","personalMobile","workPhone","personalPhone","innerPhone","BackdropMenu","setItems","BackdropMenuItem","setTitle","setSubTitle","setVersion","setEventListener","MobileTools","phoneTo","callMethod","setCustomParams","confirm","MOBILE_HEADER_MENU_LEAVE_CONFIRM","text","buttons","MOBILE_HEADER_MENU_LEAVE_YES","MOBILE_HEADER_MENU_LEAVE_NO","button","leaveChat","imChatLeave","listUsers","getItemsForAddUserDialog","element","ChatDataConverter","getListElementByUser","scopes","modal","itemsIndex","recentList","push","colleaguesList","lastSearchList","payload","counter","forEach","PullStatus","pullRequestMessage","readMessage","Offline","hasOwnProperty","dialogData","siteDir","textareaMessage","placeholder","smileButton","useImageButton","useAudioMessages","mentionDataSource","outsection","url","attachFileSettings","previewMaxWidth","previewMaxHeight","resize","targetWidth","targetHeight","sourceType","encodingType","mediaType","allowsEdit","saveToPhotoAlbum","popoverOptions","cameraDirection","sendFileSeparately","showAttachedFiles","editingMediaFiles","maxAttachedFilesCount","attachButton","dataSource","multiple","TABLE_SETTINGS","searchField","showtitle","attachedFiles","trim","clearText","addMessage","dataAttributes","uploadFile","source","toLowerCase","preview","URL","PREVIEW","width","match","height","uploadLink","ID","toJSON","slice","join","filename","fileType","getType","extension","previewUrl","previewWidth","previewHeight","startWriting","stopWriting","Application","getPlatform","platform","isIos","getIosVersion","scrollToBottom","pullClient","beforeCreate","$bitrixApplication","$bitrixController","$bitrixRestClient","$bitrixPullClient","$bitrixMessages","destroyed","$destroy","quiteId","quoteMessage","authorId","repeat","date","format","quote","quoteMessageClear","isUnreadMessagesLoaded","sendMessage","FILE_ID","sending","prepareFilesBeforeSave","splice","authorName","getCurrentUser","find","cancelTasks","fileCommit","diskId","messageText","getDiskFolderId","sendMessageWithFile","requestDiskFolderId","readMessageExecute","imMessageAdd","fileExtension","attachPreviewFile","needConvert","addTasks","mimeType","audio","folderId","onDestroyEventName","retry","queryParams","chat_id","template_id","file_template_id","uploadId","upload_id","disk_id","imDiskFileCommit","timMessageType","flagRequestDiskFolderIdSended","imDiskFolderGet","lastId","requestHistoryResult","count","messages","promiseGetDialogUnreadWait","promiseGetDialogUnread","requestUnreadResult","error_description","imDialogRead","message_id","imDialogMessagesGetUnread","first_id","dialogMessageUnread","firstMessageId","fulfill","retryUploadFile","setSendingMessageFlag","number","blink","messageMenuInstance","currentUser","setIcon","BackdropMenuIcon","reply","copy","IS_DELETED","unread","checked","edit","setType","BackdropMenuItemType","menu","circle_plus","disableClose","extranet","setStyles","BackdropMenuStyle","setFont","WidgetListItemFont","setColor","trash","replyToUser","copyMessage","editMessage","deleteMessage","unreadMessage","subMenu","task","lifefeed","chat","shareMessage","showSubMenu","openProfile","headerMenu","HeaderMenu","setUseNavigationBarColor","customParams","openUserList","MOBILE_HEADER_MENU_USER_LIST","muteDialog","entityId","crmData","getDialogCrmData","openWidget","resolveOpenFunction","entityType","NotificationBar","MOBILE_HEADER_MENU_RELOAD_WAIT","textColor","groupId","useLoader","maxLines","align","hideOnTap","ChatDialog","clearDatabase","reload","notifyToggleText","isDialogMuted","notifyToggleIcon","HeaderMenuIcon","notify","notify_off","gotoCrmLocalize","crm","DialogCrmType","lead","company","contact","deal","HeaderMenuItem","phone","user_plus","cross","unshift","list","MOBILE_MESSAGE_LIST_VIEW","insertText","firstName","isGlobal","useCloseButton","autoHideTimeout","quoteId","setTextFocus","reaction","reactions","concat","MOBILE_MESSAGE_LIST_LIKE","botId","imMessageCommand","joinParentChat","CHAT_ID","openDialog","mentionButton","return_full_mode","alphabet_index","okButton","editMessageSend","cancelButton","imMessageUpdate","purify","substr","MOBILE_MESSAGE_MENU_DELETE_CONFIRM","MOBILE_MESSAGE_MENU_DELETE_YES","MOBILE_MESSAGE_MENU_DELETE_NO","deleteMessageSend","imMessageDelete","getText","clear","focus","BXMobileAppContext","isAppActive","isBackground","successObject","processMarkReadMessages","errorObject","code","description","localizeDescription","endsWith","active","phrases","phrase","component","dialogState","computed","Object","assign","getFilteredPhrases","$root","widgetClassName","className","showMessageDialog","quotePanelData","$store","NAME","isDialog","isDarkBackground","messageCollection","timeout","getDialogShowTimeout","clearTimeout","dialogStateTimeout","Vuex","mapState","dialogues","collection","methods","logEvent","Logger","onDialogRequestHistory","getDialogHistory","onDialogRequestUnread","onDialogMessageClickByUserName","onDialogMessageClickByUploadCancel","onDialogMessageClickByCommand","onDialogMessageClickByMention","openPhoneMenu","onDialogMessageMenuClick","openMessageMenu","onDialogMessageRetryClick","retrySendMessage","onDialogReadMessage","onDialogReadedListClick","openReadedList","onDialogQuoteMessage","onDialogMessageReactionSet","reactMessage","onDialogMessageReactionListOpen","openMessageReactionList","values","onDialogMessageClickByKeyboardButton","execMessageKeyboardCommand","onDialogMessageClickByChatTeaser","execMessageOpenChatTeaser","onDialogClick","onQuotePanelClose","freeze","MOBILE_CHAT_ERROR_TITLE","MOBILE_CHAT_ERROR_DESC","MOBILE_CHAT_LOADING","MOBILE_CHAT_EMPTY"],"mappings":"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"}