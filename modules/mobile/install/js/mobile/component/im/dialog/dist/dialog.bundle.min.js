this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e,t,i,s,a,o,r,n,l,d,c,u,h,g,p,f,m){"use strict";var M=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));if(babelHelpers.typeof(e.context)==="object"&&e.context){i.context=e.context}return i}babelHelpers.createClass(t,[{key:"handleImChatGetSuccess",value:function e(t){this.store.commit("application/set",{dialog:{chatId:t.id,dialogId:t.dialog_id,diskFolderId:t.disk_folder_id}});this.context.redrawHeader()}},{key:"handleImChatGetError",value:function e(t){if(t.ex.error==="ACCESS_ERROR"){app.closeController()}}},{key:"handleMobileBrowserConstGetSuccess",value:function e(t){this.store.commit("application/set",{disk:{enabled:true,maxFileSize:t.phpUploadMaxFilesize}});this.context.addLocalize(t);BX.message(t);l.LocalStorage.set(this.controller.getSiteId(),0,"serverVariables",t||{})}},{key:"handleImDialogMessagesGetInitSuccess",value:function e(){this.controller.emit(u.EventType.dialog.sendReadMessages)}},{key:"handleImMessageAddSuccess",value:function e(t,i){this.context.messagesQueue=this.context.messagesQueue.filter(function(e){return e.id!==i.id})}},{key:"handleImMessageAddError",value:function e(t,i){this.context.messagesQueue=this.context.messagesQueue.filter(function(e){return e.id!==i.id})}},{key:"handleImDiskFileCommitSuccess",value:function e(t,i){this.context.messagesQueue=this.context.messagesQueue.filter(function(e){return e.id!==i.id})}}]);return t}(n.BaseRestAnswerHandler);var I=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.ready=true;this.offline=false;this.host=this.getHost();this.inited=false;this.restClient=BX.rest;this.customData=[];this.localize=babelHelpers.objectSpread({},BX.message);this.subscribers={};this.dateFormat=null;this.messagesQueue=[];this.configRequestXhr=null;this.windowFocused=true;this.rootNode=document.getElementById("messenger-root");this.template=null;this.timer=new d.Timer;window.addEventListener("orientationchange",function(){if(!t.store){return}t.store.commit("application/set",{device:{orientation:h.Utils.device.getOrientation()}});if(t.store.state.application.device.type===u.DeviceType.mobile&&t.store.state.application.device.orientation===u.DeviceOrientation.horizontal){document.activeElement.blur()}});var i=l.LocalStorage.get(this.getSiteId(),0,"serverVariables",false);if(i){this.addLocalize(i)}BX.componentParameters.init().then(function(e){return t.initMobileSettings(e)}).then(function(e){return t.initStorage(e)}).then(function(e){return t.initComponent(e)}).then(function(e){return t.requestData(e)}).then(function(e){return t.initEnvironment(e)}).then(function(e){return t.initMobileEnvironment(e)}).then(function(e){return t.initPullClient(e)})}babelHelpers.createClass(e,[{key:"initMobileSettings",value:function e(t){console.log("1. initMobileSettings");return new Promise(function(e,i){ApplicationStorage.getObject("settings.chat",{quoteEnable:ChatPerformance.isGestureQuoteSupported(),quoteFromRight:false,autoplayVideo:ChatPerformance.isAutoPlayVideoSupported(),backgroundType:"LIGHT_GRAY"}).then(function(i){t.OPTIONS=i;e(t)})})}},{key:"initStorage",value:function e(t){console.log("2. initStorage");this.controller=new o.ApplicationController;this.localize["SITE_DIR"]=t.SITE_DIR;this.storedEvents=t.STORED_EVENTS||[];var i={common:{host:this.host,userId:t.USER_ID,siteId:t.SITE_ID,languageId:t.LANGUAGE_ID},device:{type:h.Utils.device.isMobile()?u.DeviceType.mobile:u.DeviceType.desktop,orientation:h.Utils.device.getOrientation()},dialog:{dialogId:t.DIALOG_ID,messageLimit:this.controller.getDefaultMessageLimit(),enableReadMessages:false},options:{quoteEnable:t.OPTIONS.quoteEnable,quoteFromRight:t.OPTIONS.quoteFromRight,autoplayVideo:t.OPTIONS.autoplayVideo,darkBackground:ChatDialogBackground&&ChatDialogBackground[t.OPTIONS.backgroundType]&&ChatDialogBackground[t.OPTIONS.backgroundType].dark}};return(new f.VuexBuilder).addModel(a.ApplicationModel.create().useDatabase(false).setVariables(i)).addModel(a.MessagesModel.create()).addModel(a.DialoguesModel.create().setVariables({host:this.host})).addModel(a.FilesModel.create().setVariables({host:this.host,default:{name:this.getLocalize("IM_MESSENGER_MESSAGE_FILE_DELETED")}})).addModel(a.UsersModel.create().setVariables({host:this.host,default:{name:this.getLocalize("IM_MESSENGER_MESSAGE_USER_ANONYM")}})).setDatabaseConfig({name:"mobile/im",type:f.VuexBuilder.DatabaseType.jnSharedStorage,siteId:t.SITE_ID,userId:t.USER_ID}).build()}},{key:"initComponent",value:function e(t){var i=this;console.log("3. initComponent");this.store=t.store;this.store.subscribe(function(e){return i.eventStoreInteraction(e)});this.storeCollector=t.builder;this.controller.setStore(this.store);this.controller.setRestClient(this.restClient);this.controller.setPrepareFilesBeforeSaveFunction(this.prepareFileData.bind(this));this.imRestAnswer=n.ImRestAnswerHandler.create({store:this.store,controller:this.controller});this.mobileRestAnswer=M.create({store:this.store,controller:this.controller,context:this});var s=this.store.getters["dialogues/get"](this.controller.getDialogId());if(s){this.store.commit("application/set",{dialog:{chatId:s.chatId,diskFolderId:s.diskFolderId||0}})}return new Promise(function(e,t){return e()})}},{key:"initEnvironment",value:function e(t){var i=this;var s=new Date;this.template=this.attachTemplate();console.log("5. initEnvironment",+new Date-s+"ms");this.controller.setTemplateEngine(this.template);this.setTextareaMessage=h.Utils.debounce(this.controller.setTextareaMessage,300,this.controller);window.addEventListener("orientationchange",function(){if(!i.store){return}i.store.commit("application/set",{device:{orientation:h.Utils.device.getOrientation()}})});return new Promise(function(e,t){return e()})}},{key:"initMobileEnvironment",value:function e(t){var i=this;console.log("6. initMobileEnvironment");BXMobileApp.UI.Page.Scroll.setEnabled(false);BXMobileApp.UI.Page.captureKeyboardEvents(true);BX.addCustomEvent("onKeyboardWillShow",function(){i.store.dispatch("application/set",{mobile:{keyboardShow:true}})});BX.addCustomEvent("onKeyboardDidShow",function(){i.controller.emit("EventType.dialog.scrollToBottom",{duration:300,cancelIfScrollChange:true})});BX.addCustomEvent("onKeyboardWillHide",function(){clearInterval(i.keyboardOpeningInterval);i.store.dispatch("application/set",{mobile:{keyboardShow:false}})});var s=function e(){BXMobileApp.UI.Page.isVisible({callback:function e(t){i.windowFocused=t.status==="visible";if(i.windowFocused){m.Vue.event.$emit("bitrixmobile:controller:focus")}else{m.Vue.event.$emit("bitrixmobile:controller:blur")}}})};BX.addCustomEvent("onAppActive",function(){s();BXMobileApp.UI.Page.isVisible({callback:function e(t){if(t.status!=="visible"){return false}i.getDialogUnread().then(function(){i.processSendMessages();i.controller.emit(u.EventType.dialog.sendReadMessages)}).catch(function(){i.processSendMessages()})}})});BX.addCustomEvent("onAppPaused",function(){i.windowFocused=false;m.Vue.event.$emit("bitrixmobile:controller:blur")});BX.addCustomEvent("onOpenPageAfter",s);BX.addCustomEvent("onHidePageBefore",function(){i.windowFocused=false;m.Vue.event.$emit("bitrixmobile:controller:blur")});BXMobileApp.addCustomEvent("chatbackground::task::status::success",function(e){var t=e.taskId.toString().split("|")[0];i.executeBackgroundTaskSuccess(t,e)});BXMobileApp.addCustomEvent("chatbackground::task::status::failure",function(e){var t=e.taskId.toString().split("|")[0];i.executeBackgroundTaskFailure(t,e)});BXMobileApp.addCustomEvent("chatrecent::push::get",function(e){if(i.pullCommandHandler){e.optionImportant=true;i.pullCommandHandler.handleMessageAdd(e,{})}});BXMobileApp.UI.Page.TextPanel.setParams(this.getKeyboardParams());this.changeChatKeyboardStatus();BX.MobileUploadProvider.setListener(this.executeUploaderEvent.bind(this));this.fileUpdateProgress=h.Utils.throttle(function(e,t,s,a){i.store.dispatch("files/update",{chatId:e,id:t,fields:{size:a,progress:s}})},500);if(h.Utils.dialog.isChatId(this.controller.getDialogId())){var a=this.controller.getDialogData().type;if(a!==u.DialogType.call){app.exec("setRightButtons",{items:[{type:"user_plus",callback:function e(){fabric.Answers.sendCustomEvent("vueChatAddUserButton",{});i.openAddUserDialog()}}]})}}if(!h.Utils.dialog.isChatId(this.controller.getDialogId())){this.userShowWorkPosition=true;setTimeout(function(){i.userShowWorkPosition=false;i.redrawHeader()},1500);setInterval(function(){i.redrawHeader()},6e4)}this.redrawHeader();this.widgetCache=new ChatWidgetCache(this.controller.getUserId(),this.controller.getLanguageId());return new Promise(function(e,t){return e()})}},{key:"initPullClient",value:function e(){var t=this;console.log("7. initPullClient");s.PULL.subscribe(this.pullCommandHandler=new r.ImPullCommandHandler({store:this.store,controller:this.controller}));if(this.storedEvents&&this.storedEvents.length>0){setTimeout(function(){t.storedEvents=t.storedEvents.filter(function(e){BX.onCustomEvent("chatrecent::push::get",[e]);return false})},50)}s.PULL.subscribe({type:BX.PullClient.SubscriptionType.Server,moduleId:"im",command:"chatUserLeave",callback:function e(i){if(i.userId===t.controller.getUserId()&&i.dialogId===t.controller.getDialogId()){app.closeController()}}});s.PULL.subscribe({type:s.PullClient.SubscriptionType.Status,callback:this.eventStatusInteraction.bind(this)});if(!h.Utils.dialog.isChatId(this.controller.getDialogId())){s.PULL.subscribe({type:s.PullClient.SubscriptionType.Online,callback:this.eventOnlineInteraction.bind(this)})}return new Promise(function(e,t){return e()})}},{key:"requestData",value:function e(){var t,i=this;console.log("4. requestData");if(this.requestDataSend){return true}this.timer.start("data","load",.5,function(){console.warn("ChatDialog.requestData: slow connection show progress icon");app.titleAction("setParams",{useProgress:true,useLetterImage:false})});this.requestDataSend=true;var s=(t={},babelHelpers.defineProperty(t,u.RestMethodHandler.mobileBrowserConstGet,[u.RestMethod.mobileBrowserConstGet,{}]),babelHelpers.defineProperty(t,u.RestMethodHandler.imChatGet,[u.RestMethod.imChatGet,{dialog_id:this.controller.getDialogId()}]),babelHelpers.defineProperty(t,u.RestMethodHandler.imDialogMessagesGetInit,[u.RestMethod.imDialogMessagesGet,{dialog_id:this.controller.getDialogId(),limit:this.controller.getRequestMessageLimit(),convert_text:"Y"}]),t);if(h.Utils.dialog.isChatId(this.controller.getDialogId())){s[u.RestMethodHandler.imUserGet]=[u.RestMethod.imUserGet,{}]}else{s[u.RestMethodHandler.imUserListGet]=[u.RestMethod.imUserListGet,{id:[this.controller.getUserId(),this.controller.getDialogId()]}]}this.restClient.callBatch(s,function(e){if(!e){i.requestDataSend=false;i.setError("EMPTY_RESPONSE","Server returned an empty response.");return false}var t=e[u.RestMethodHandler.mobileBrowserConstGet];if(t.error());else{i.executeRestAnswer(u.RestMethodHandler.mobileBrowserConstGet,t)}var s=e[u.RestMethodHandler.imUserGet];if(s&&!s.error()){i.executeRestAnswer(u.RestMethodHandler.imUserGet,s)}var a=e[u.RestMethodHandler.imUserListGet];if(a&&!a.error()){i.executeRestAnswer(u.RestMethodHandler.imUserListGet,a)}var o=e[u.RestMethodHandler.imChatGet];i.executeRestAnswer(u.RestMethodHandler.imChatGet,o);var r=e[u.RestMethodHandler.imDialogMessagesGetInit];if(r.error());else{app.titleAction("setParams",{useProgress:false,useLetterImage:true});i.timer.stop("data","load",true);i.store.dispatch("dialogues/saveDialog",{dialogId:i.controller.getDialogId(),chatId:i.controller.getChatId()});if(i.pullCommandHandler){i.pullCommandHandler.option.skip=false}i.store.dispatch("application/set",{dialog:{enableReadMessages:true}}).then(function(){i.executeRestAnswer(u.RestMethodHandler.imDialogMessagesGetInit,r)});i.processSendMessages()}i.requestDataSend=false},false,false,h.Utils.getLogTrackingParams({name:"mobile.im.dialog",dialog:this.controller.getDialogData()}));return new Promise(function(e,t){return e()})}},{key:"executeRestAnswer",value:function e(t,i,s){console.warn(t,i,s);this.imRestAnswer.execute(t,i,s);this.mobileRestAnswer.execute(t,i,s)}},{key:"executeUploaderEvent",value:function e(t,i,s){if(t!==BX.MobileUploaderConst.FILE_UPLOAD_PROGRESS){console.log("ChatDialog.disk.eventRouter: ",t,s,i)}if(t===BX.MobileUploaderConst.FILE_UPLOAD_PROGRESS){if(i.percent>95){i.percent=95}this.fileUpdateProgress(i.file.params.chatId,i.file.params.file.id,i.percent,i.byteTotal)}else if(t===BX.MobileUploaderConst.FILE_CREATED){if(i.result.status==="error"){this.fileError(i.file.params.chatId,i.file.params.file.id,i.file.params.id);console.error("File upload error",i.result.errors[0].message)}else{this.store.dispatch("files/update",{chatId:i.file.params.chatId,id:i.file.params.file.id,fields:{status:u.FileStatus.wait,progress:95}})}}else if(t==="onimdiskmessageaddsuccess"){console.info("ChatDialog.disk.eventRouter: DISK_MESSAGE_ADD_SUCCESS: ",i,s);var a=i.result.FILES["upload"+i.result.DISK_ID[0]];this.store.dispatch("files/update",{chatId:i.file.params.chatId,id:i.file.params.file.id,fields:{status:u.FileStatus.upload,progress:100,id:a.id,size:a.size,urlDownload:a.urlDownload,urlPreview:a.urlPreview,urlShow:a.urlShow}})}else if(t==="onimdiskmessageaddfail"){console.error("ChatDialog.disk.eventRouter: DISK_MESSAGE_ADD_FAIL: ",i,s);this.fileError(i.file.params.chatId,i.file.params.file.id,i.file.params.id)}else if(t===BX.MobileUploaderConst.TASK_CANCELLED||t===BX.MobileUploaderConst.TASK_NOT_FOUND){this.cancelUploadFile(i.file.params.file.id)}else if(t===BX.MobileUploaderConst.FILE_CREATED_FAILED||t===BX.MobileUploaderConst.FILE_UPLOAD_FAILED||t===BX.MobileUploaderConst.FILE_READ_ERROR||t===BX.MobileUploaderConst.TASK_STARTED_FAILED){console.error("ChatDialog.disk.eventRouter: ",t,i,s);this.fileError(i.file.params.chatId,i.file.params.file.id,i.file.params.id)}return true}},{key:"prepareFileData",value:function e(t){var i=function e(t){if(t.urlPreview&&t.urlPreview.startsWith("file://")){t.urlPreview="bx"+t.urlPreview}if(t.urlShow&&t.urlShow.startsWith("file://")){t.urlShow="bx"+t.urlShow}if(t.type!==u.FileType.image){return t}if(t.urlPreview){if(t.urlPreview.startsWith("/")){t.urlPreview=currentDomain+t.urlPreview}t.urlPreview=t.urlPreview.replace("http://","bxhttp://").replace("https://","bxhttps://")}if(t.urlShow){if(t.urlShow.startsWith("/")){t.urlShow=currentDomain+t.urlShow}t.urlShow=t.urlShow.replace("http://","bxhttp://").replace("https://","bxhttps://")}return t};if(t instanceof Array){return t.map(function(e){return i(e)})}else{return i(t)}}},{key:"redrawHeader",value:function e(){var t=this;var i;if(h.Utils.dialog.isChatId(this.controller.getDialogId())){i=this.getChatHeaderParams();this.changeChatKeyboardStatus()}else{i=this.getUserHeaderParams();this.setCallMenu()}if(!i){return false}if(!this.headerMenuInited){BXMobileApp.UI.Page.TopBar.title.params.useLetterImage=true;BXMobileApp.UI.Page.TopBar.title.setCallback(function(){return t.openHeaderMenu()});this.headerMenuInited=true}if(i.name){BXMobileApp.UI.Page.TopBar.title.setText(i.name)}if(i.desc){BXMobileApp.UI.Page.TopBar.title.setDetailText(i.desc)}if(i.avatar){BXMobileApp.UI.Page.TopBar.title.setImage(i.avatar)}else if(i.color){BXMobileApp.UI.Page.TopBar.title.params.imageColor=i.color}return true}},{key:"getUserHeaderParams",value:function e(){var t=this.store.getters["users/get"](this.controller.getDialogId());if(!t||!t.init){return false}var i={name:null,desc:null,avatar:null,color:null};if(t.avatar){i.avatar=t.avatar}else{i.color=t.color}i.name=t.name;var s=false;if(!this.userShowWorkPosition&&t.lastActivityDate){s=h.Utils.user.getLastDateText(t,this.localize)}if(s){i.desc=s}else{if(t.workPosition){i.desc=t.workPosition}else{i.desc=this.localize["MOBILE_HEADER_MENU_CHAT_TYPE_USER"]}}return i}},{key:"getChatHeaderParams",value:function e(){var t=this.store.getters["dialogues/get"](this.controller.getDialogId());if(!t||!t.init){return false}var i={name:null,desc:null,avatar:null,color:null};if(t.avatar){i.avatar=t.avatar}else{i.color=t.color}i.name=t.name;var s=this.localize["MOBILE_HEADER_MENU_CHAT_TYPE_CHAT"];if(this.localize["MOBILE_HEADER_MENU_CHAT_TYPE_"+t.type.toUpperCase()]){s=this.localize["MOBILE_HEADER_MENU_CHAT_TYPE_"+t.type.toUpperCase()]}i.desc=s;return i}},{key:"changeChatKeyboardStatus",value:function e(){var t=this.store.getters["dialogues/get"](this.controller.getDialogId());if(!t||!t.init){BXMobileApp.UI.Page.TextPanel.show();return true}var i=true;if(t.type==="announcement"&&!t.managerList.includes(this.controller.getUserId())){i=false}if(typeof this.keyboardShowFlag!=="undefined"&&(this.keyboardShowFlag&&i||!this.keyboardShowFlag&&!i)){return this.keyboardShowFlag}if(i){BXMobileApp.UI.Page.TextPanel.show();this.keyboardShowFlag=true}else{BXMobileApp.UI.Page.TextPanel.hide();this.keyboardShowFlag=false}return this.keyboardShowFlag}},{key:"setCallMenu",value:function e(){var t=this;if(this.callMenuSetted){return true}var i=this.store.getters["users/get"](this.controller.getDialogId(),true);if(!i.init){return false}if(this.controller.getUserId()===parseInt(this.controller.getDialogId())||i.bot||i.network){app.exec("setRightButtons",{items:[]});this.callMenuSetted=true;return true}app.exec("setRightButtons",{items:[{type:"call_audio",callback:function e(){t.openCallMenu()}},{type:"call_video",callback:function e(){fabric.Answers.sendCustomEvent("vueChatCallVideoButton",{});var i={};i[t.controller.getDialogId()]=t.store.getters["users/get"](t.controller.getDialogId(),true);BXMobileApp.Events.postToComponent("onCallInvite",{userId:t.controller.getDialogId(),video:true,userData:i},"calls")}}]});this.callMenuSetted=true;return true}},{key:"openUserList",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.users,s=i===void 0?false:i,a=t.title,o=a===void 0?"":a,r=t.listType,n=r===void 0?"LIST":r,l=t.backdrop,d=l===void 0?true:l;var c={title:o,objectName:"ChatUserListInterface"};if(d){c.backdrop={}}app.exec("openComponent",{name:"JSStackComponent",componentCode:"im.dialog.list",scriptPath:"/mobileapp/jn/im.chat.user.list/?version="+BX.componentParameters.get("WIDGET_CHAT_USERS_VERSION","1.0.0"),params:{DIALOG_ID:this.controller.getDialogId(),DIALOG_OWNER_ID:this.controller.getDialogData().ownerId,USER_ID:this.controller.getUserId(),LIST_TYPE:n,USERS:s,IS_BACKDROP:true},rootWidget:{name:"list",settings:c}},false)}},{key:"openCallMenu",value:function e(){var t=this;fabric.Answers.sendCustomEvent("vueChatCallAudioButton",{});var i=this.store.getters["users/get"](this.controller.getDialogId(),true);if(i.phones.personalMobile||i.phones.workPhone||i.phones.personalPhone||i.phones.innerPhone){BackdropMenu.create("im.dialog.menu.call|"+this.controller.getDialogId()).setItems([BackdropMenuItem.create("audio").setTitle(this.localize["MOBILE_HEADER_MENU_AUDIO_CALL"]),BackdropMenuItem.create("personalMobile").setTitle(i.phones.personalMobile).setSubTitle(this.localize["MOBILE_MENU_CALL_MOBILE"]).skip(!i.phones.personalMobile),BackdropMenuItem.create("workPhone").setTitle(i.phones.workPhone).setSubTitle(this.localize["MOBILE_MENU_CALL_WORK"]).skip(!i.phones.workPhone),BackdropMenuItem.create("personalPhone").setTitle(i.phones.personalPhone).setSubTitle(this.localize["MOBILE_MENU_CALL_PHONE"]).skip(!i.phones.personalPhone),BackdropMenuItem.create("innerPhone").setTitle(i.phones.innerPhone).setSubTitle(this.localize["MOBILE_MENU_CALL_PHONE"]).skip(!i.phones.innerPhone)]).setVersion(BX.componentParameters.get("WIDGET_BACKDROP_MENU_VERSION","1.0.0")).setEventListener(function(e,i,s,a){if(e!=="selected"){return false}if(i.id==="audio"){BXMobileApp.Events.postToComponent("onCallInvite",{userId:t.controller.getDialogId(),video:false,userData:babelHelpers.defineProperty({},s.id,s)},"calls")}else if(i.id==="innerPhone"){BX.MobileTools.phoneTo(s.phones[i.id],{callMethod:"telephony"})}else{BX.MobileTools.phoneTo(s.phones[i.id],{callMethod:"device"})}}).setCustomParams(i).show()}else{BXMobileApp.Events.postToComponent("onCallInvite",{userId:this.controller.getDialogId(),video:false,userData:babelHelpers.defineProperty({},this.controller.getDialogId(),i)},"calls")}}},{key:"leaveChat",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!i){app.confirm({title:this.localize.MOBILE_HEADER_MENU_LEAVE_CONFIRM,text:"",buttons:[this.localize.MOBILE_HEADER_MENU_LEAVE_YES,this.localize.MOBILE_HEADER_MENU_LEAVE_NO],callback:function e(i){if(i===1){t.leaveChat(true)}}});return true}var s=this.controller.getDialogId();this.restClient.callMethod(u.RestMethod.imChatLeave,{DIALOG_ID:s},null,null,h.Utils.getLogTrackingParams({name:u.RestMethod.imChatLeave,dialog:this.controller.getDialogData(s)})).then(function(e){app.closeController()})}},{key:"openAddUserDialog",value:function e(){var t=this.getItemsForAddUserDialog();app.exec("openComponent",{name:"JSStackComponent",componentCode:"im.chat.user.selector",scriptPath:"/mobileapp/jn/im.chat.user.selector/?version="+BX.componentParameters.get("WIDGET_CHAT_RECIPIENTS_VERSION","1.0.0"),params:{DIALOG_ID:this.controller.getDialogId(),USER_ID:this.controller.getUserId(),LIST_USERS:t,LIST_DEPARTMENTS:[],SKIP_LIST:[],SEARCH_MIN_SIZE:BX.componentParameters.get("SEARCH_MIN_TOKEN_SIZE",3)},rootWidget:{name:"chat.recipients",settings:{objectName:"ChatUserSelectorInterface",title:BX.message("MOBILE_HEADER_MENU_USER_ADD"),limit:100,items:t.map(function(e){return ChatDataConverter.getListElementByUser(e)}),scopes:[{title:BX.message("MOBILE_SCOPE_USERS"),id:"user"},{title:BX.message("MOBILE_SCOPE_DEPARTMENTS"),id:"department"}],modal:true}}},false)}},{key:"getItemsForAddUserDialog",value:function e(){var t=[];var i={};if(!this.widgetCache){this.widgetCache=new ChatWidgetCache(this.controller.getUserId(),this.controller.getLanguageId())}if(this.widgetCache.recentList.length>0){this.widgetCache.recentList.map(function(e){if(!e||i[e.id]){return false}if(e.type==="user"){t.push(e.user);i[e.id]=true}return true})}this.widgetCache.colleaguesList.map(function(e){if(!e||i[e.id]){return false}t.push(e);i[e.id]=true});this.widgetCache.lastSearchList.map(function(e){if(!e||i[e.id]){return false}if(!e){return false}if(e.type==="user"){t.push(e.user);i[e.id]=true}return true});return t}},{key:"eventStoreInteraction",value:function e(t){if(t.type==="dialogues/update"&&t.payload&&t.payload.fields){if(typeof t.payload.fields.counter!=="undefined"&&typeof t.payload.dialogId!=="undefined"){BXMobileApp.Events.postToComponent("chatdialog::counter::change",[{dialogId:t.payload.dialogId,counter:t.payload.fields.counter},true],"im.recent")}}else if(t.type==="dialogues/set"){t.payload.forEach(function(e){BXMobileApp.Events.postToComponent("chatdialog::counter::change",[{dialogId:e.dialogId,counter:e.counter},true],"im.recent")})}}},{key:"eventStatusInteraction",value:function e(t){var i=this;if(t.status===s.PullClient.PullStatus.Online){this.offline=false;if(this.pullRequestMessage){this.pullCommandHandler.option.skip=true;this.getDialogUnread().then(function(){i.pullCommandHandler.option.skip=false;i.processSendMessages();i.controller.emit(u.EventType.dialog.sendReadMessages)}).catch(function(){i.pullCommandHandler.option.skip=false;i.processSendMessages()});this.pullRequestMessage=false}else{this.readMessage();this.processSendMessages()}}else if(t.status===s.PullClient.PullStatus.Offline){this.pullRequestMessage=true;this.offline=true}}},{key:"eventOnlineInteraction",value:function e(t){if(t.command==="list"||t.command==="userStatus"){for(var i in t.params.users){if(!t.params.users.hasOwnProperty(i)){continue}this.store.dispatch("users/update",{id:t.params.users[i].id,fields:t.params.users[i]});if(i.toString()===this.controller.getDialogId()){this.redrawHeader()}}}}},{key:"getKeyboardParams",value:function e(){var t=this;var i=this.controller.getDialogData();var s=this.localize.SITE_DIR?this.localize.SITE_DIR:"/";return{text:i?i.textareaMessage:"",placeholder:this.getLocalize("MOBILE_CHAT_PANEL_PLACEHOLDER"),smileButton:{},useImageButton:true,useAudioMessages:true,mentionDataSource:{outsection:"NO",url:s+"mobile/index.php?mobile_action=get_user_list&use_name_format=Y&with_bots"},attachFileSettings:{previewMaxWidth:640,previewMaxHeight:640,resize:{targetWidth:-1,targetHeight:-1,sourceType:1,encodingType:0,mediaType:2,allowsEdit:false,saveToPhotoAlbum:true,popoverOptions:false,cameraDirection:0},sendFileSeparately:true,showAttachedFiles:true,editingMediaFiles:false,maxAttachedFilesCount:100},attachButton:{items:[{id:"disk",name:this.getLocalize("MOBILE_CHAT_PANEL_UPLOAD_DISK"),dataSource:{multiple:false,url:s+"mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId="+this.getLocalize("USER_ID"),TABLE_SETTINGS:{searchField:true,showtitle:true,modal:true,name:this.getLocalize("MOBILE_CHAT_PANEL_UPLOAD_DISK_FILES")}}},{id:"mediateka",name:this.getLocalize("MOBILE_CHAT_PANEL_UPLOAD_GALLERY")},{id:"camera",name:this.getLocalize("MOBILE_CHAT_PANEL_UPLOAD_CAMERA")}]},action:function e(i){if(typeof i==="string"){i={text:i,attachedFiles:[]}}var s=i.text.toString().trim();var o=i.attachedFiles instanceof Array?i.attachedFiles:[];if(o.length<=0){t.clearText();t.addMessage(s)}else{o.forEach(function(e){if(typeof e.dataAttributes!=="undefined"){fabric.Answers.sendCustomEvent("vueChatFileDisk",{});return t.uploadFile({source:"disk",name:e.name,type:e.type.toString().toLowerCase(),preview:!e.dataAttributes.URL||!e.dataAttributes.URL.PREVIEW?null:{url:e.dataAttributes.URL.PREVIEW,width:e.dataAttributes.URL.PREVIEW.match(/(width=(\d+))/i)[2],height:e.dataAttributes.URL.PREVIEW.match(/(height=(\d+))/i)[2]},uploadLink:parseInt(e.dataAttributes.ID)})}if(e.type==="audio/mp4"){fabric.Answers.sendCustomEvent("vueChatFileAudio",{});return t.uploadFile({source:"audio",name:"mobile_audio_"+(new Date).toJSON().slice(0,19).replace("T","_").split(":").join("-")+".mp3",type:"mp3",preview:null,uploadLink:e.url})}var i=e.name;var s=a.FilesModel.getType(e.name);if(s===u.FileType.video){fabric.Answers.sendCustomEvent("vueChatFileVideo",{})}else if(s===u.FileType.image){fabric.Answers.sendCustomEvent("vueChatFileImage",{})}else{fabric.Answers.sendCustomEvent("vueChatFileOther",{})}if(s===u.FileType.image||s===u.FileType.video){var o=e.name.split(".").slice(-1)[0].toLowerCase();if(e.type==="image/heic"){o="jpg"}i="mobile_file_"+(new Date).toJSON().slice(0,19).replace("T","_").split(":").join("-")+"."+o}return t.uploadFile({source:"gallery",name:i,type:e.type.toString().toLowerCase(),preview:!e.previewUrl?null:{url:e.previewUrl,width:e.previewWidth,height:e.previewHeight},uploadLink:e.url})})}},callback:function e(i){console.log("Textpanel callback",i);if(!i.event){return false}if(i.event==="onKeyPress"){var s=i.text.toString();if(s.trim().length>2){t.controller.startWriting()}if(s.length===0){t.controller.setTextareaMessage({message:""});t.controller.stopWriting()}else{t.setTextareaMessage({message:s})}}else if(Application.getPlatform()!=="android"){if(i.event==="getFocus"){if(h.Utils.platform.isIos()&&h.Utils.platform.getIosVersion()>12){t.controller.emit(u.EventType.dialog.scrollToBottom,{duration:300,cancelIfScrollChange:true})}}else if(i.event==="removeFocus");}}}}},{key:"attachTemplate",value:function e(){if(this.template){return true}var t=this;var i=this.controller;var s=this.restClient;var a=this.pullClient||null;return m.Vue.create({el:this.rootNode,store:this.store,template:"<bx-messenger/>",beforeCreate:function e(){this.$bitrixApplication=t;this.$bitrixController=i;this.$bitrixRestClient=s;this.$bitrixPullClient=a;this.$bitrixMessages=t.localize},destroyed:function e(){this.$bitrixApplication.template=null;this.$bitrixApplication=null;this.$bitrixController=null;this.$bitrixRestClient=null;this.$bitrixPullClient=null;this.$bitrixMessages=null}})}},{key:"detachTemplate",value:function e(){if(!this.template){return true}this.template.$destroy();return true}},{key:"addMessage",value:function e(t){var i=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!t&&!s){return false}var a=this.store.getters["dialogues/getQuoteId"](this.controller.getDialogId());if(a){var o=this.store.getters["messages/getMessage"](this.controller.getChatId(),a);if(o){var r=null;if(o.authorId){r=this.store.getters["users/get"](o.authorId)}var n=this.store.getters["files/getList"](this.controller.getChatId());var l=[];l.push("-".repeat(54));l.push((r&&r.name?r.name:this.getLocalize("MOBILE_CHAT_SYSTEM_MESSAGE"))+" ["+h.Utils.date.format(o.date,null,this.localize)+"]");l.push(h.Utils.text.quote(o.text,o.params,n,this.localize));l.push("-".repeat(54));l.push(t);t=l.join("\n");this.quoteMessageClear()}}console.warn("addMessage",t,s);if(!this.controller.isUnreadMessagesLoaded()){this.sendMessage({id:0,chatId:this.controller.getChatId(),dialogId:this.controller.getDialogId(),text:t,file:s});this.processSendMessages();return true}this.store.commit("application/increaseDialogExtraCount");var d={};if(s){d.FILE_ID=[s.id]}this.store.dispatch("messages/add",{chatId:this.controller.getChatId(),authorId:this.controller.getUserId(),text:t,params:d,sending:!s}).then(function(e){i.messagesQueue.push({id:e,chatId:i.controller.getChatId(),dialogId:i.controller.getDialogId(),text:t,file:s,sending:false});if(i.controller.getChatId()){i.processSendMessages()}else{i.requestData()}});return true}},{key:"uploadFile",value:function e(t){var i=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";if(!t){return false}console.warn("addFile",t,s);if(!this.controller.isUnreadMessagesLoaded()){this.addMessage(s,{id:0,source:t});return true}this.store.dispatch("files/add",this.controller.prepareFilesBeforeSave({chatId:this.controller.getChatId(),authorId:this.controller.getUserId(),name:t.name,type:a.FilesModel.getType(t.name),extension:t.name.split(".").splice(-1)[0],size:0,image:!t.preview?false:{width:t.preview.width,height:t.preview.height},status:t.source==="disk"?u.FileStatus.wait:u.FileStatus.upload,progress:0,authorName:this.controller.getCurrentUser().name,urlPreview:!t.preview?"":t.preview.url})).then(function(e){return i.addMessage(s,babelHelpers.objectSpread({id:e},t))});return true}},{key:"cancelUploadFile",value:function e(t){var i=this;var s=this.messagesQueue.find(function(e){return e.file&&e.file.id===t});if(s){BX.MobileUploadProvider.cancelTasks(["imDialog"+t]);this.store.dispatch("messages/delete",{chatId:s.chatId,id:s.id}).then(function(){i.store.dispatch("files/delete",{chatId:s.chatId,id:s.file.id});i.messagesQueue=i.messagesQueue.filter(function(e){return e.id!==s.id})})}}},{key:"retryUploadFile",value:function e(t){var i=this;var s=this.messagesQueue.find(function(e){return e.file&&e.file.id===t});if(!s){return false}this.store.dispatch("messages/actionStart",{chatId:s.chatId,id:s.id}).then(function(){i.store.dispatch("files/update",{chatId:s.chatId,id:s.file.id,fields:{status:u.FileStatus.upload,progress:0}})});s.sending=false;this.processSendMessages();return true}},{key:"processSendMessages",value:function e(){var t=this;this.messagesQueue.filter(function(e){return!e.sending}).forEach(function(e){e.sending=true;if(e.file){if(e.file.source==="disk"){t.fileCommit({chatId:e.chatId,dialogId:e.dialogId,diskId:e.file.uploadLink,messageText:e.text,messageId:e.id,fileId:e.file.id,fileType:a.FilesModel.getType(e.file.name)},e)}else{if(t.controller.getDiskFolderId()){t.sendMessageWithFile(e)}else{e.sending=false;t.requestDiskFolderId()}}}else{e.sending=true;t.sendMessage(e)}});return true}},{key:"processMarkReadMessages",value:function e(){this.controller.readMessageExecute(this.controller.getChatId(),true);return true}},{key:"sendMessage",value:function e(t){t.text=t.text.replace(/^([-]{21}\n)/gm,"-".repeat(54)+"\n");this.controller.stopWriting(t.dialogId);BXMobileApp.Events.postToComponent("chatbackground::task::add",["sendMessage|"+t.id,[u.RestMethod.imMessageAdd,{TEMPLATE_ID:t.id,DIALOG_ID:t.dialogId,MESSAGE:t.text}],t],"background")}},{key:"sendMessageWithFile",value:function e(t){var i=a.FilesModel.getType(t.file.name);var s=t.file.name.toString().toLowerCase().split(".").splice(-1)[0];var o=i!==u.FileType.image&&t.file.preview;var r=i===u.FileType.image&&t.file.type!=="image/gif"||i===u.FileType.video;BX.MobileUploadProvider.addTasks([{url:t.file.uploadLink,params:t,name:t.file.name,type:s,mimeType:i===u.FileType.audio?"audio/mp4":null,resize:!r?null:{quality:80,width:1920,height:1080},previewUrl:o?t.file.preview.url:"",folderId:this.controller.getDiskFolderId(),taskId:"imDialog"+t.file.id,onDestroyEventName:"onimdiskmessageaddsuccess"}])}},{key:"fileError",value:function e(t,i){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;this.store.dispatch("files/update",{chatId:t,id:i,fields:{status:u.FileStatus.error,progress:0}});if(s){this.store.dispatch("messages/actionError",{chatId:t,id:s,retry:true})}}},{key:"fileCommit",value:function e(t,i){var s=this;var a={chat_id:t.chatId,message:t.messageText,template_id:t.messageId?t.messageId:0,file_template_id:t.fileId?t.fileId:0};if(t.uploadId){a.upload_id=t.uploadId}else if(t.diskId){a.disk_id=t.diskId}this.restClient.callMethod(u.RestMethod.imDiskFileCommit,a,null,null,h.Utils.getLogTrackingParams({name:u.RestMethod.imDiskFileCommit,data:{timMessageType:t.fileType},dialog:this.controller.getDialogData(t.dialogId)})).then(function(e){s.executeRestAnswer(u.RestMethodHandler.imDiskFileCommit,e,i)}).catch(function(e){s.executeRestAnswer(u.RestMethodHandler.imDiskFileCommit,e,i)});return true}},{key:"requestDiskFolderId",value:function e(){var t=this;if(this.flagRequestDiskFolderIdSended||this.controller.getDiskFolderId()){return true}this.flagRequestDiskFolderIdSended=true;this.restClient.callMethod(u.RestMethod.imDiskFolderGet,{chat_id:this.controller.getChatId()}).then(function(e){t.executeRestAnswer(u.RestMethodHandler.imDiskFolderGet,e);t.flagRequestDiskFolderIdSended=false;t.processSendMessages()}).catch(function(e){t.flagRequestDiskFolderIdSended=false;t.executeRestAnswer(u.RestMethodHandler.imDiskFolderGet,e)});return true}},{key:"getDialogHistory",value:function e(t){var i=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.controller.getRequestMessageLimit();this.restClient.callMethod(u.RestMethod.imDialogMessagesGet,{CHAT_ID:this.controller.getChatId(),LAST_ID:t,LIMIT:s,CONVERT_TEXT:"Y"}).then(function(e){i.executeRestAnswer(u.RestMethodHandler.imDialogMessagesGet,e);i.controller.emit(u.EventType.dialog.requestHistoryResult,{count:e.data().messages.length})}).catch(function(e){i.controller.emit(u.EventType.dialog.requestHistoryResult,{error:e.error().ex})})}},{key:"getDialogUnread",value:function e(t){var i=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.controller.getRequestMessageLimit();if(this.promiseGetDialogUnreadWait){return this.promiseGetDialogUnread}this.promiseGetDialogUnread=new BX.Promise;this.promiseGetDialogUnreadWait=true;if(!t){t=this.store.getters["messages/getLastId"](this.controller.getChatId())}if(!t){this.controller.emit(u.EventType.dialog.requestUnreadResult,{error:{error:"LAST_ID_EMPTY",error_description:"LastId is empty."}});this.promiseGetDialogUnread.reject();this.promiseGetDialogUnreadWait=false;return this.promiseGetDialogUnread}this.controller.readMessage(t,true,true).then(function(){var e;i.timer.start("data","load",.5,function(){console.warn("ChatDialog.requestData: slow connection show progress icon");app.titleAction("setParams",{useProgress:true,useLetterImage:false})});var a=(e={},babelHelpers.defineProperty(e,u.RestMethodHandler.imDialogRead,[u.RestMethod.imDialogRead,{dialog_id:i.controller.getDialogId(),message_id:t}]),babelHelpers.defineProperty(e,u.RestMethodHandler.imChatGet,[u.RestMethod.imChatGet,{dialog_id:i.controller.getDialogId()}]),babelHelpers.defineProperty(e,u.RestMethodHandler.imDialogMessagesGetUnread,[u.RestMethod.imDialogMessagesGet,{chat_id:i.controller.getChatId(),first_id:t,limit:s,convert_text:"Y"}]),e);i.restClient.callBatch(a,function(e){if(!e){i.controller.emit(u.EventType.dialog.requestUnreadResult,{error:{error:"EMPTY_RESPONSE",error_description:"Server returned an empty response."}});i.promiseGetDialogUnread.reject();i.promiseGetDialogUnreadWait=false;return false}var t=e[u.RestMethodHandler.imChatGet];if(!t.error()){i.executeRestAnswer(u.RestMethodHandler.imChatGet,t)}var s=e[u.RestMethodHandler.imDialogMessagesGetUnread];if(s.error()){i.controller.emit(u.EventType.dialog.requestUnreadResult,{error:s.error().ex})}else{i.executeRestAnswer(u.RestMethodHandler.imDialogMessagesGetUnread,s);i.controller.emit(u.EventType.dialog.requestUnreadResult,{firstMessageId:s.data().messages.length>0?s.data().messages[0].id:0,count:s.data().messages.length});app.titleAction("setParams",{useProgress:false,useLetterImage:true});i.timer.stop("data","load",true)}i.promiseGetDialogUnread.fulfill(e);i.promiseGetDialogUnreadWait=false},false,false,h.Utils.getLogTrackingParams({name:u.RestMethodHandler.imDialogMessagesGetUnread,dialog:i.controller.getDialogData()}))});return this.promiseGetDialogUnread}},{key:"retrySendMessage",value:function e(t){var i=this.messagesQueue.find(function(e){return e.id===t.id});if(i){if(i.file&&i.file.id){this.retryUploadFile(i.file.id)}return false}this.messagesQueue.push({id:t.id,chatId:this.controller.getChatId(),dialogId:this.controller.getDialogId(),text:t.text,sending:false});this.controller.setSendingMessageFlag(t.id);this.processSendMessages()}},{key:"openProfile",value:function e(t){BXMobileApp.Events.postToComponent("onUserProfileOpen",[t,{backdrop:true}],"communication")}},{key:"openDialog",value:function e(t){BXMobileApp.Events.postToComponent("onOpenDialog",[{dialogId:t},true],"im.recent")}},{key:"openPhoneMenu",value:function e(t){BX.MobileTools.phoneTo(t)}},{key:"openMessageMenu",value:function e(t){var i=this;if(this.messagesQueue.find(function(e){return e.id===t.id})){return false}this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{blink:true}});if(!this.messageMenuInstance){var s=this.controller.getCurrentUser();var a=this.controller.getDialogData();this.messageMenuInstance=BackdropMenu.create("im.dialog.menu.mess|"+this.controller.getDialogId()).setItems([BackdropMenuItem.create("reply").setTitle(this.localize["MOBILE_MESSAGE_MENU_REPLY"]).setIcon(BackdropMenuIcon.reply).skip(function(e){var t=i.controller.getDialogData();if(t.type==="announcement"&&!t.managerList.includes(i.controller.getUserId())){return true}return!e.authorId||e.authorId===i.controller.getUserId()}),BackdropMenuItem.create("copy").setTitle(this.localize["MOBILE_MESSAGE_MENU_COPY"]).setIcon(BackdropMenuIcon.copy).skip(function(e){return e.params.IS_DELETED==="Y"}),BackdropMenuItem.create("quote").setTitle(this.localize["MOBILE_MESSAGE_MENU_QUOTE"]).setIcon(BackdropMenuIcon.quote).skip(function(e){var t=i.controller.getDialogData();if(t.type==="announcement"&&!t.managerList.includes(i.controller.getUserId())){return true}return e.params.IS_DELETED==="Y"}),BackdropMenuItem.create("unread").setTitle(this.localize["MOBILE_MESSAGE_MENU_UNREAD"]).setIcon(BackdropMenuIcon.unread).skip(function(e){return e.authorId===i.controller.getUserId()||e.unread}),BackdropMenuItem.create("read").setTitle(this.localize["MOBILE_MESSAGE_MENU_READ"]).setIcon(BackdropMenuIcon.checked).skip(function(e){return!e.unread}),BackdropMenuItem.create("edit").setTitle(this.localize["MOBILE_MESSAGE_MENU_EDIT"]).setIcon(BackdropMenuIcon.edit).skip(function(e){return e.authorId!==i.controller.getUserId()||e.params.IS_DELETED==="Y"}),BackdropMenuItem.create("share").setType(BackdropMenuItemType.menu).setIcon(BackdropMenuIcon.circle_plus).setTitle(this.localize["MOBILE_MESSAGE_MENU_SHARE_MENU"]).disableClose().skip(s.extranet||a.type==="announcement"),BackdropMenuItem.create("profile").setTitle(this.localize["MOBILE_MESSAGE_MENU_PROFILE"]).setIcon(BackdropMenuIcon.user).skip(function(e){return e.authorId<=0||!h.Utils.dialog.isChatId(i.controller.getDialogId())||e.authorId===i.controller.getUserId()}),BackdropMenuItem.create("delete").setTitle(this.localize["MOBILE_MESSAGE_MENU_DELETE"]).setStyles(BackdropMenuStyle.create().setFont(WidgetListItemFont.create().setColor("#c50000"))).setIcon(BackdropMenuIcon.trash).skip(function(e){return e.authorId!==i.controller.getUserId()||e.params.IS_DELETED==="Y"})]).setVersion(BX.componentParameters.get("WIDGET_BACKDROP_MENU_VERSION","1.0.0")).setEventListener(function(e,t,s,a){if(e!=="selected"){return false}if(t.id==="reply"){i.replyToUser(s.authorId)}else if(t.id==="copy"){i.copyMessage(s.id)}else if(t.id==="quote"){i.quoteMessage(s.id)}else if(t.id==="edit"){i.editMessage(s.id)}else if(t.id==="delete"){i.deleteMessage(s.id)}else if(t.id==="unread"){i.unreadMessage(s.id)}else if(t.id==="read"){i.readMessage(s.id)}else if(t.id==="share"){var o=i.controller.getDialogData();var r=BackdropMenu.create("im.dialog.menu.mess.submenu|"+i.controller.getDialogId()).setItems([BackdropMenuItem.create("share_task").setIcon(BackdropMenuIcon.task).setTitle(i.localize["MOBILE_MESSAGE_MENU_SHARE_TASK"]),BackdropMenuItem.create("share_post").setIcon(BackdropMenuIcon.lifefeed).setTitle(i.localize["MOBILE_MESSAGE_MENU_SHARE_POST"]),BackdropMenuItem.create("share_chat").setIcon(BackdropMenuIcon.chat).setTitle(i.localize["MOBILE_MESSAGE_MENU_SHARE_CHAT"])]).setEventListener(function(e,t,a,o){if(e!=="selected"){return false}if(t.id==="share_task"){i.shareMessage(s.id,"TASK")}else if(t.id==="share_post"){i.shareMessage(s.id,"POST")}else if(t.id==="share_chat"){i.shareMessage(s.id,"CHAT")}});a.showSubMenu(r)}else if(t.id==="profile"){i.openProfile(s.authorId)}else{console.warn("BackdropMenuItem is not implemented",t)}})}this.messageMenuInstance.setCustomParams(t).show();fabric.Answers.sendCustomEvent("vueChatOpenDropdown",{})}},{key:"openHeaderMenu",value:function e(){var t=this;fabric.Answers.sendCustomEvent("vueChatOpenHeaderMenu",{});if(!this.headerMenu){this.headerMenu=HeaderMenu.create().setUseNavigationBarColor().setEventListener(function(e,i,s){if(e!=="selected"){return false}if(i.id==="profile"){t.openProfile(t.controller.getDialogId())}else if(i.id==="user_list"){t.openUserList({listType:"USERS",title:t.localize.MOBILE_HEADER_MENU_USER_LIST,backdrop:false})}else if(i.id==="user_add"){t.openAddUserDialog()}else if(i.id==="leave"){t.leaveChat()}else if(i.id==="notify"){t.controller.muteDialog()}else if(i.id==="call_chat_call"){BX.MobileTools.phoneTo(t.controller.getDialogData().entityId)}else if(i.id==="goto_crm"){var a=t.controller.getDialogCrmData();var o=BX.MobileTools.resolveOpenFunction("/crm/"+a.entityType+"/show/"+a.entityId+"/");if(o){o()}}else if(i.id==="reload"){new BXMobileApp.UI.NotificationBar({message:t.localize.MOBILE_HEADER_MENU_RELOAD_WAIT,color:"#d920b0ff",textColor:"#ffffff",groupId:"refresh",useLoader:true,maxLines:1,align:"center",hideOnTap:true},"copy").show();ChatDialog.storeCollector.clearDatabase();reload()}})}if(h.Utils.dialog.isChatId(this.controller.getDialogId())){var i=this.controller.getDialogData();var s=!this.controller.isDialogMuted()?this.localize["MOBILE_HEADER_MENU_NOTIFY_DISABLE"]:this.localize["MOBILE_HEADER_MENU_NOTIFY_ENABLE"];var a=!this.controller.isDialogMuted()?HeaderMenuIcon.notify:HeaderMenuIcon.notify_off;var o="";if(i.type===u.DialogType.call||i.type===u.DialogType.crm){var r=this.controller.getDialogCrmData();if(r.enabled){if(r.entityType===u.DialogCrmType.lead){o=this.localize["MOBILE_GOTO_CRM_LEAD"]}else if(r.entityType===u.DialogCrmType.company){o=this.localize["MOBILE_GOTO_CRM_COMPANY"]}else if(r.entityType===u.DialogCrmType.contact){o=this.localize["MOBILE_GOTO_CRM_CONTACT"]}else if(r.entityType===u.DialogCrmType.deal){o=this.localize["MOBILE_GOTO_CRM_DEAL"]}else{o=this.localize["MOBILE_GOTO_CRM"]}}}if(i.type===u.DialogType.call){this.headerMenu.setItems([HeaderMenuItem.create("call_chat_call").setTitle(this.localize["MOBILE_HEADER_MENU_AUDIO_CALL"]).setIcon(HeaderMenuIcon.phone).skip(i.entityId==="UNIFY_CALL_CHAT"),HeaderMenuItem.create("goto_crm").setTitle(o).setIcon(HeaderMenuIcon.lifefeed).skip(i.entityId==="UNIFY_CALL_CHAT"),HeaderMenuItem.create("reload").setTitle(this.localize["MOBILE_HEADER_MENU_RELOAD"]).setIcon(HeaderMenuIcon.reload)])}else{var n=[HeaderMenuItem.create("notify").setTitle(s).setIcon(a),HeaderMenuItem.create("user_list").setTitle(this.localize["MOBILE_HEADER_MENU_USER_LIST"]).setIcon(HeaderMenuIcon.user),HeaderMenuItem.create("user_add").setTitle(this.localize["MOBILE_HEADER_MENU_USER_ADD"]).setIcon(HeaderMenuIcon.user_plus),HeaderMenuItem.create("leave").setTitle(this.localize["MOBILE_HEADER_MENU_LEAVE"]).setIcon(HeaderMenuIcon.cross),HeaderMenuItem.create("reload").setTitle(this.localize["MOBILE_HEADER_MENU_RELOAD"]).setIcon(HeaderMenuIcon.reload)];if(i.type===u.DialogType.crm&&o){n.unshift(HeaderMenuItem.create("goto_crm").setTitle(o).setIcon(HeaderMenuIcon.lifefeed))}this.headerMenu.setItems(n)}}else{this.headerMenu.setItems([HeaderMenuItem.create("profile").setTitle(this.localize["MOBILE_HEADER_MENU_PROFILE"]).setIcon("user").skip(h.Utils.dialog.isChatId(this.controller.getDialogId())),HeaderMenuItem.create("user_add").setTitle(this.localize["MOBILE_HEADER_MENU_USER_ADD"]).setIcon(HeaderMenuIcon.user_plus),HeaderMenuItem.create("reload").setTitle(this.localize["MOBILE_HEADER_MENU_RELOAD"]).setIcon(HeaderMenuIcon.reload)])}this.headerMenu.show(true)}},{key:"shareMessage",value:function e(t,i){if(this.offline){return false}return this.controller.shareMessage(t,i)}},{key:"readMessage",value:function e(t){this.controller.readMessage(t,true,true).then(function(e){if(e.lastId<=0){return true}BXMobileApp.Events.postToComponent("chatbackground::task::action",["readMessage","readMessage|"+e.dialogId,e,false,200],"background")});return true}},{key:"unreadMessage",value:function e(t){if(this.offline){return false}return this.controller.unreadMessage(t)}},{key:"openReadedList",value:function e(t){if(!h.Utils.dialog.isChatId(this.controller.getDialogId())){return false}if(!t||t.length<=1){return false}this.openUserList({users:t.map(function(e){return e.userId}),title:this.localize.MOBILE_MESSAGE_LIST_VIEW})}},{key:"replyToUser",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(this.offline){return false}if(!i){i=this.store.getters["users/get"](t)}return this.insertText({text:"[USER=".concat(t,"]").concat(i.firstName,"[/USER] ")})}},{key:"copyMessage",value:function e(t){var i=this.store.getters["messages/getMessage"](this.controller.getChatId(),t);var s="";if(i.params.FILE_ID&&i.params.FILE_ID.length){s=i.params.FILE_ID.map(function(e){return"[DISK="+e+"]"}).join(" ")}if(i.text){if(s){s+="\n"}s+=i.text.replace(/^([-]{54}\n)/gm,"-".repeat(21)+"\n")}app.exec("copyToClipboard",{text:s});new BXMobileApp.UI.NotificationBar({message:BX.message("MOBILE_MESSAGE_MENU_COPY_SUCCESS"),color:"#af000000",textColor:"#ffffff",groupId:"clipboard",maxLines:1,align:"center",isGlobal:true,useCloseButton:true,autoHideTimeout:1500,hideOnTap:true},"copy").show()}},{key:"quoteMessage",value:function e(t){var i=this;this.store.dispatch("dialogues/update",{dialogId:this.controller.getDialogId(),fields:{quoteId:t}}).then(function(){if(i.store.state.application.mobile.keyboardShow){setTimeout(function(){return i.controller.emit(u.EventType.dialog.scrollToBottom,{duration:300,cancelIfScrollChange:true})},300)}else{i.setTextFocus()}})}},{key:"reactMessage",value:function e(t,i){BXMobileApp.Events.postToComponent("chatbackground::task::action",["reactMessage","reactMessage|"+t,{messageId:t,action:i.action==="auto"?"auto":i.action==="set"?"plus":"minus"},false,1e3],"background");if(i.action==="set"){setTimeout(function(){return app.exec("callVibration")},200)}}},{key:"openMessageReactionList",value:function e(t,i){if(!h.Utils.dialog.isChatId(this.controller.getDialogId())){return false}var s=[];for(var a in i){if(!i.hasOwnProperty(a)){continue}s=s.concat(i[a])}this.openUserList({users:s,title:this.localize.MOBILE_MESSAGE_LIST_LIKE})}},{key:"execMessageKeyboardCommand",value:function e(t){if(t.action!=="COMMAND"){return false}var i=t.params,s=i.dialogId,a=i.messageId,o=i.botId,r=i.command,n=i.params;this.restClient.callMethod(u.RestMethod.imMessageCommand,{MESSAGE_ID:a,DIALOG_ID:s,BOT_ID:o,COMMAND:r,COMMAND_PARAMS:n});return true}},{key:"execMessageOpenChatTeaser",value:function e(t){var i=this;this.controller.joinParentChat(t.message.id,"chat"+t.message.params.CHAT_ID).then(function(e){i.openDialog(e)}).catch(function(){});return true}},{key:"quoteMessageClear",value:function e(){this.store.dispatch("dialogues/update",{dialogId:this.controller.getDialogId(),fields:{quoteId:0}})}},{key:"editMessage",value:function e(t){var i=this;var s=this.store.getters["messages/getMessage"](this.controller.getChatId(),t);this.store.dispatch("application/set",{mobile:{keyboardShow:true}});var a=this.localize.SITE_DIR?this.localize.SITE_DIR:"/";app.exec("showPostForm",{mentionButton:{dataSource:{return_full_mode:"YES",outsection:"NO",multiple:"NO",alphabet_index:"YES",url:a+"mobile/index.php?mobile_action=get_user_list"}},smileButton:{},message:{text:s.text},okButton:{callback:function e(s){return i.editMessageSend(t,s.text)},name:BX.message("MOBILE_EDIT_SAVE")},cancelButton:{callback:function e(){i.store.dispatch("application/set",{mobile:{keyboardShow:false}})},name:BX.message("MOBILE_EDIT_CANCEL")}})}},{key:"editMessageSend",value:function e(t,i){this.restClient.callMethod(u.RestMethod.imMessageUpdate,{MESSAGE_ID:t,MESSAGE:i},null,null,h.Utils.getLogTrackingParams({name:u.RestMethod.imMessageUpdate,data:{timMessageType:"text"},dialog:this.controller.getDialogData()}))}},{key:"deleteMessage",value:function e(t){var i=this;var s=this.store.getters["messages/getMessage"](this.controller.getChatId(),t);var a=this.store.getters["files/getList"](this.controller.getChatId());var o=h.Utils.text.purify(s.text,s.params,a,this.localize);o=o.length>50?o.substr(0,47)+"...":o;app.confirm({title:this.localize.MOBILE_MESSAGE_MENU_DELETE_CONFIRM,text:o?'"'+o+'"':"",buttons:[this.localize.MOBILE_MESSAGE_MENU_DELETE_YES,this.localize.MOBILE_MESSAGE_MENU_DELETE_NO],callback:function e(s){if(s===1){i.deleteMessageSend(t)}}})}},{key:"deleteMessageSend",value:function e(t){this.restClient.callMethod(u.RestMethod.imMessageDelete,{MESSAGE_ID:t},null,null,h.Utils.getLogTrackingParams({name:u.RestMethod.imMessageDelete,data:{},dialog:this.controller.getDialogData(this.controller.getDialogId())}))}},{key:"insertText",value:function e(t){var i=this;BXMobileApp.UI.Page.TextPanel.getText(function(e){e=e.toString().trim();e=e?e+" "+t.text:t.text;i.setText(e);i.setTextFocus()})}},{key:"setText",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";t=t.toString();if(t){BXMobileApp.UI.Page.TextPanel.setText(t)}else{BXMobileApp.UI.Page.TextPanel.clear()}this.setTextareaMessage({message:t});console.log("Set new text in textarea",t?t:"-- empty --")}},{key:"clearText",value:function e(){this.setText()}},{key:"setTextFocus",value:function e(){if(!this.store.state.application.mobile.keyboardShow){BXMobileApp.UI.Page.TextPanel.focus()}}},{key:"getHost",value:function e(){return currentDomain||""}},{key:"getSiteId",value:function e(){return"s1"}},{key:"isBackground",value:function e(){if((typeof BXMobileAppContext==="undefined"?"undefined":babelHelpers.typeof(BXMobileAppContext))!=="object"){return false}if(typeof BXMobileAppContext.isAppActive==="function"&&!BXMobileAppContext.isAppActive()){return true}if(typeof BXMobileAppContext.isBackground==="function"){return BXMobileAppContext.isBackground()}return false}},{key:"executeBackgroundTaskSuccess",value:function e(t,i){var s={error:function e(){return false},data:function e(){return i.result}};console.log("Dialog.executeBackgroundTaskSuccess",t,i);if(t==="sendMessage"){this.executeRestAnswer(u.RestMethodHandler.imMessageAdd,s,i.extra)}else if(t==="readMessage"){this.processMarkReadMessages()}}},{key:"executeBackgroundTaskFailure",value:function e(t,i){var s={error:function e(){return{error:i.code,error_description:i.text,ex:{status:i.status}}},data:function e(){return false}};console.log("Dialog.executeBackgroundTaskFailure",t,i);if(t==="sendMessage"){this.executeRestAnswer(u.RestMethodHandler.imMessageAdd,s,i.extra)}}},{key:"setError",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";console.error("MobileChat.error: ".concat(t," (").concat(i,")"));var s="";if(t.endsWith("LOCALIZED")){s=i}this.store.commit("application/set",{error:{active:true,code:t,description:s}})}},{key:"clearError",value:function e(){this.store.commit("application/set",{error:{active:false,code:"",description:""}})}},{key:"addLocalize",value:function e(t){if(babelHelpers.typeof(t)!=="object"||!t){return false}for(var i in t){if(t.hasOwnProperty(i)){this.localize[i]=t[i]}}return true}},{key:"getLocalize",value:function e(t){var i="";if(typeof t==="undefined"){return this.localize}else if(typeof this.localize[t.toString()]==="undefined"){console.warn("MobileChat.getLocalize: message with code '".concat(t.toString(),"' is undefined."))}else{i=this.localize[t]}return i}}]);return e}();m.Vue.component("bx-messenger",{data:function e(){return{dialogState:"loading"}},computed:babelHelpers.objectSpread({EventType:function e(){return u.EventType},localize:function e(){return Object.assign({},m.Vue.getFilteredPhrases("MOBILE_CHAT_",this.$root.$bitrixMessages),m.Vue.getFilteredPhrases("IM_UTILS_",this.$root.$bitrixMessages))},widgetClassName:function e(t){var i=["bx-mobilechat-wrapper"];if(this.showMessageDialog){i.push("bx-mobilechat-chat-start")}return i.join(" ")},quotePanelData:function e(){var t={id:0,title:"",description:"",color:""};if(!this.showMessageDialog||!this.dialog.quoteId){return t}var i=this.$store.getters["messages/getMessage"](this.dialog.chatId,this.dialog.quoteId);if(!i){return t}var s=this.$store.getters["users/get"](i.authorId);var a=this.$store.getters["files/getList"](this.dialog.chatId);return{id:this.dialog.quoteId,title:s?s.name:"",color:s?s.color:"",description:h.Utils.text.purify(i.text,i.params,a,this.localize)}},isDialog:function e(){return h.Utils.dialog.isChatId(this.dialog.dialogId)},isGestureQuoteSupported:function e(){if(this.dialog&&this.dialog.type==="announcement"&&!this.dialog.managerList.includes(this.application.common.userId)){return false}return ChatPerformance.isGestureQuoteSupported()},isDarkBackground:function e(){return this.application.options.darkBackground},showMessageDialog:function e(){var t=this;var i=this.messageCollection&&this.messageCollection.length>0;var s=ChatPerformance.getDialogShowTimeout();if(i){if(s>0){clearTimeout(this.dialogStateTimeout);this.dialogStateTimeout=setTimeout(function(){t.dialogState="show"},s)}else{this.dialogState="show"}}else if(this.dialog&&this.dialog.init){if(s>0){clearTimeout(this.dialogStateTimeout);this.dialogStateTimeout=setTimeout(function(){t.dialogState="empty"},s)}else{this.dialogState="empty"}}else{this.dialogState="loading"}return i}},f.Vuex.mapState({application:function e(t){return t.application},dialog:function e(t){return t.dialogues.collection[t.application.dialog.dialogId]},messageCollection:function e(t){return t.messages.collection[t.application.dialog.chatId]}})),methods:{logEvent:function e(t){for(var i=arguments.length,s=new Array(i>1?i-1:0),a=1;a<i;a++){s[a-1]=arguments[a]}c.Logger.info.apply(c.Logger,[t].concat(s))},onDialogRequestHistory:function e(t){this.$root.$bitrixApplication.getDialogHistory(t.lastId)},onDialogRequestUnread:function e(t){this.$root.$bitrixApplication.getDialogUnread(t.lastId)},onDialogMessageClickByUserName:function e(t){this.$root.$bitrixApplication.replyToUser(t.user.id,t.user)},onDialogMessageClickByUploadCancel:function e(t){this.$root.$bitrixApplication.cancelUploadFile(t.file.id)},onDialogMessageClickByCommand:function e(t){if(t.type==="put"){this.$root.$bitrixApplication.insertText({text:t.value+" "})}else if(t.type==="send"){this.$root.$bitrixApplication.addMessage(t.value)}else{c.Logger.warn("Unprocessed command",t)}},onDialogMessageClickByMention:function e(t){if(t.type==="USER"){this.$root.$bitrixApplication.openProfile(t.value)}else if(t.type==="CHAT"){this.$root.$bitrixApplication.openDialog(t.value)}else if(t.type==="CALL"){this.$root.$bitrixApplication.openPhoneMenu(t.value)}},onDialogMessageMenuClick:function e(t){c.Logger.warn("Message menu:",t);this.$root.$bitrixApplication.openMessageMenu(t.message)},onDialogMessageRetryClick:function e(t){c.Logger.warn("Message retry:",t);this.$root.$bitrixApplication.retrySendMessage(t.message)},onDialogReadMessage:function e(t){this.$root.$bitrixApplication.readMessage(t.id)},onDialogReadedListClick:function e(t){this.$root.$bitrixApplication.openReadedList(t.list)},onDialogQuoteMessage:function e(t){this.$root.$bitrixApplication.quoteMessage(t.message.id)},onDialogMessageReactionSet:function e(t){this.$root.$bitrixApplication.reactMessage(t.message.id,t.reaction)},onDialogMessageReactionListOpen:function e(t){this.$root.$bitrixApplication.openMessageReactionList(t.message.id,t.values)},onDialogMessageClickByKeyboardButton:function e(t){this.$root.$bitrixApplication.execMessageKeyboardCommand(t)},onDialogMessageClickByChatTeaser:function e(t){this.$root.$bitrixApplication.execMessageOpenChatTeaser(t)},onDialogClick:function e(t){},onQuotePanelClose:function e(){this.$root.$bitrixApplication.quoteMessageClear()}},template:'\n\t\t<div :class="widgetClassName">\n\t\t\t<div :class="[\'bx-mobilechat-box\', {\'bx-mobilechat-box-dark-background\': isDarkBackground}]">\n\t\t\t\t<template v-if="application.error.active">\n\t\t\t\t\t<bx-messenger-body-error/>\n\t\t\t\t</template>\t\t\t\n\t\t\t\t<template v-else>\n\t\t\t\t\t<bx-pull-status/>\n\t\t\t\t\t<div :class="[\'bx-mobilechat-body\', {\'bx-mobilechat-body-with-message\': dialogState == \'show\'}]" key="with-message">\n\t\t\t\t\t\t<template v-if="dialogState == \'loading\'">\n\t\t\t\t\t\t\t<bx-messenger-body-loading/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else-if="dialogState == \'empty\'">\n\t\t\t\t\t\t\t<bx-messenger-body-empty/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class="bx-mobilechat-dialog">\n\t\t\t\t\t\t\t\t<bx-messenger-dialog\n\t\t\t\t\t\t\t\t\t:userId="application.common.userId" \n\t\t\t\t\t\t\t\t\t:dialogId="application.dialog.dialogId"\n\t\t\t\t\t\t\t\t\t:chatId="application.dialog.chatId"\n\t\t\t\t\t\t\t\t\t:messageLimit="application.dialog.messageLimit"\n\t\t\t\t\t\t\t\t\t:messageExtraCount="application.dialog.messageExtraCount"\n\t\t\t\t\t\t\t\t\t:enableReadMessages="application.dialog.enableReadMessages"\n\t\t\t\t\t\t\t\t\t:enableReactions="true"\n\t\t\t\t\t\t\t\t\t:enableDateActions="false"\n\t\t\t\t\t\t\t\t\t:enableCreateContent="false"\n\t\t\t\t\t\t\t\t\t:enableGestureQuote="application.options.quoteEnable"\n\t\t\t\t\t\t\t\t\t:enableGestureQuoteFromRight="application.options.quoteFromRight"\n\t\t\t\t\t\t\t\t\t:enableGestureMenu="true"\n\t\t\t\t\t\t\t\t\t:showMessageUserName="isDialog"\n\t\t\t\t\t\t\t\t\t:showMessageAvatar="isDialog"\n\t\t\t\t\t\t\t\t\t:showMessageMenu="false"\n\t\t\t\t\t\t\t\t\t:listenEventScrollToBottom="EventType.dialog.scrollToBottom"\n\t\t\t\t\t\t\t\t\t:listenEventRequestHistory="EventType.dialog.requestHistoryResult"\n\t\t\t\t\t\t\t\t\t:listenEventRequestUnread="EventType.dialog.requestUnreadResult"\n\t\t\t\t\t\t\t\t\t:listenEventSendReadMessages="EventType.dialog.sendReadMessages"\n\t\t\t\t\t\t\t\t\t@readMessage="onDialogReadMessage"\n\t\t\t\t\t\t\t\t\t@quoteMessage="onDialogQuoteMessage"\n\t\t\t\t\t\t\t\t\t@requestHistory="onDialogRequestHistory"\n\t\t\t\t\t\t\t\t\t@requestUnread="onDialogRequestUnread"\n\t\t\t\t\t\t\t\t\t@clickByCommand="onDialogMessageClickByCommand"\n\t\t\t\t\t\t\t\t\t@clickByMention="onDialogMessageClickByMention"\n\t\t\t\t\t\t\t\t\t@clickByUserName="onDialogMessageClickByUserName"\n\t\t\t\t\t\t\t\t\t@clickByMessageMenu="onDialogMessageMenuClick"\n\t\t\t\t\t\t\t\t\t@clickByMessageRetry="onDialogMessageRetryClick"\n\t\t\t\t\t\t\t\t\t@clickByUploadCancel="onDialogMessageClickByUploadCancel"\n\t\t\t\t\t\t\t\t\t@clickByReadedList="onDialogReadedListClick"\n\t\t\t\t\t\t\t\t\t@setMessageReaction="onDialogMessageReactionSet"\n\t\t\t\t\t\t\t\t\t@openMessageReactionList="onDialogMessageReactionListOpen"\n\t\t\t\t\t\t\t\t\t@clickByKeyboardButton="onDialogMessageClickByKeyboardButton"\n\t\t\t\t\t\t\t\t\t@clickByChatTeaser="onDialogMessageClickByChatTeaser"\n\t\t\t\t\t\t\t\t\t@click="onDialogClick"\n\t\t\t\t\t\t\t\t />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<bx-messenger-quote-panel :id="quotePanelData.id" :title="quotePanelData.title" :description="quotePanelData.description" :color="quotePanelData.color" @close="onQuotePanelClose"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t'});m.Vue.component("bx-messenger-body-error",{computed:babelHelpers.objectSpread({localize:function e(){return Object.freeze({MOBILE_CHAT_ERROR_TITLE:this.$root.$bitrixMessages.MOBILE_CHAT_ERROR_TITLE,MOBILE_CHAT_ERROR_DESC:this.$root.$bitrixMessages.MOBILE_CHAT_ERROR_DESC})}},f.Vuex.mapState({application:function e(t){return t.application}})),template:'\n\t\t<div class="bx-mobilechat-body" key="error-body">\n\t\t\t<div class="bx-mobilechat-warning-window">\n\t\t\t\t<div class="bx-mobilechat-warning-icon"></div>\n\t\t\t\t<template v-if="application.error.description"> \n\t\t\t\t\t<div class="bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg" v-html="application.error.description"></div>\n\t\t\t\t</template> \n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class="bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-warning-msg">{{localize.MOBILE_CHAT_ERROR_TITLE}}</div>\n\t\t\t\t\t<div class="bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg">{{localize.MOBILE_CHAT_ERROR_DESC}}</div>\n\t\t\t\t</template> \n\t\t\t</div>\n\t\t</div>\n\t'});m.Vue.component("bx-messenger-body-loading",{computed:{localize:function e(){return Object.freeze({MOBILE_CHAT_LOADING:this.$root.$bitrixMessages.MOBILE_CHAT_LOADING})}},template:'\n\t\t<div class="bx-mobilechat-loading-window">\n\t\t\t<svg class="bx-mobilechat-loading-circular" viewBox="25 25 50 50">\n\t\t\t\t<circle class="bx-mobilechat-loading-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>\n\t\t\t\t<circle class="bx-mobilechat-loading-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>\n\t\t\t</svg>\n\t\t\t<h3 class="bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg">{{localize.MOBILE_CHAT_LOADING}}</h3>\n\t\t</div>\n\t'});m.Vue.component("bx-messenger-body-empty",{computed:{localize:function e(){return Object.freeze({MOBILE_CHAT_EMPTY:this.$root.$bitrixMessages.MOBILE_CHAT_EMPTY})}},template:'\n\t\t<div class="bx-mobilechat-loading-window">\n\t\t\t<h3 class="bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg">{{localize.MOBILE_CHAT_EMPTY}}</h3>\n\t\t</div>\n\t'});e.Dialog=I})(this.BX.Messenger.Runtime=this.BX.Messenger.Runtime||{},window,BX,BX,BX.Messenger.Model,BX.Messenger.Controller,BX.Messenger.Provider.Pull,BX.Messenger.Provider.Pull,BX.Messenger,BX.Messenger,BX.Messenger,BX.Messenger.Const,BX.Messenger,window,window,BX,BX);
//# sourceMappingURL=dialog.bundle.map.js