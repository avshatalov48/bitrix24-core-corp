(function(e,t,i,s){"use strict";var a=function e(t){var i=[];for(var s in t){if(t.hasOwnProperty(s)){i.push(t[s])}}return i};var l=Object.freeze({pullServerTime:"server.time",pullConfigGet:"pull.config.get",imMessageAdd:"im.message.add",imMessageUpdate:"im.message.update",imMessageDelete:"im.message.delete",imMessageLike:"im.message.like",imChatGet:"im.chat.get",imChatSendTyping:"im.chat.sendTyping",imDialogMessagesGet:"im.dialog.messages.get",imDialogMessagesUnread:"im.dialog.messages.unread",imDialogRead:"im.dialog.read",diskFolderGet:"im.disk.folder.get",diskFileUpload:"disk.folder.uploadfile",diskFileCommit:"im.disk.file.commit"});var r=a(l);var o=function(){function e(){var a=this;babelHelpers.classCallCheck(this,e);this.restClient=null;this.pullClient=null;this.offline=false;this.dateFormat=null;this.messagesQueue=[];this.filesQueue=[];this.filesQueueIndex=0;this.messageLastReadId=null;this.messageReadQueue=[];this.defaultMessageLimit=20;this.requestMessageLimit=this.defaultMessageLimit;this.rootNode=document.body;this.template=null;var l=BX.Messenger.LocalStorage.get(this.getSiteId(),0,"serverVariables",false);if(l){this.addLocalize(l)}this.timer=new BX.Messenger.Timer;this.controller=new s.ApplicationController;var r={common:{siteId:this.getSiteId(),languageId:this.getLanguageId()},device:{type:BX.Messenger.Utils.device.isMobile()?t.DeviceType.mobile:t.DeviceType.desktop,orientation:BX.Messenger.Utils.device.getOrientation()},dialog:{messageLimit:this.defaultMessageLimit}};(new BX.VuexBuilder).addModel(i.ApplicationModel.create().setVariables(r)).addModel(i.MessagesModel.create()).addModel(i.DialoguesModel.create().setVariables({host:this.getHost()}).useDatabase(false)).addModel(i.UsersModel.create().setVariables({host:this.getHost(),defaultName:BX.message("IM_MESSENGER_MESSAGE_USER_ANONYM")}).useDatabase(false)).addModel(i.FilesModel.create().setVariables({host:this.getHost()}).useDatabase(false)).setDatabaseConfig({type:BX.VuexBuilder.DatabaseType.indexedDb,siteId:this.getSiteId()}).build(function(e){a.store=e.store;a.storeCollector=e.builder;a.restClient=BX.rest;a.pullClient=BX.PULL;a.controller.setPrepareFilesBeforeSaveFunction(a.prepareFileData);a.requestData(a.getDialogId());a.attachTemplate()})}babelHelpers.createClass(e,[{key:"addLocalize",value:function e(t){if(babelHelpers.typeof(t)!=="object"){return false}for(var i in t){if(t.hasOwnProperty(i)){BX.message[i]=t[i]}}return true}},{key:"getHost",value:function e(){return location.protocol+"//"+location.host}},{key:"getSiteId",value:function e(){return"default"}},{key:"getDialogId",value:function e(){return"chat56"}},{key:"getLanguageId",value:function e(){return"ru"}},{key:"requestData",value:function e(){}},{key:"executeRestAnswer",value:function e(t,i){}},{key:"prepareFileData",value:function e(t){{return t}return t.map(function(e){if(e.urlPreview){e.urlPreview=e.urlPreview.replace("http://","bx://").replace("https://","bx://")}if(e.urlShow){e.urlShow=e.urlShow.replace("http://","bx://").replace("https://","bx://")}if(e.urlDownload){e.urlDownload=e.urlDownload.replace("http://","bx://").replace("https://","bx://")}return e})}},{key:"attachTemplate",value:function e(){this.rootNode.innerHTML="";var t=this;var i=this.restClient;var s=this.pullClient;this.template=BX.Vue.create({el:this.rootNode.firstChild,store:this.store,template:"<bx-mobile-dialog/>",beforeCreate:function e(){this.$bitrixWidget=t;this.$bitrixRestClient=i;this.$bitrixMessages=t.localize}});return true}}]);return e}();window.MessengerDialog=new o})(this.window=this.window||{},BX.Messenger.Const,BX.Messenger.Model,BX.Messenger.Controller);
//# sourceMappingURL=dialog.bundle.map.js