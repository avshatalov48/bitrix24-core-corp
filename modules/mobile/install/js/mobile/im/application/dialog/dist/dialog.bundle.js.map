{"version":3,"file":"dialog.bundle.js","sources":["../src/pull.handler.js","../src/rest.handler.js","../src/component/loading-status.js","../src/component/error-status.js","../src/component/empty-status.js","../src/component/mobile-smiles.js","../src/component/dialog.js","../src/dialog.js"],"sourcesContent":["/**\n * Bitrix Mobile Dialog\n * Dialog Pull commands (Pull Command Handler)\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2020 Bitrix\n */\n\nexport class MobileImCommandHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tconstructor(params = {})\n\t{\n\t\tthis.controller = params.controller;\n\t\tthis.store = params.store;\n\t\tthis.dialog = params.dialog;\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleUserInvite(params, extra, command)\n\t{\n\t\tif (!params.invited)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.dialog.redrawHeader();\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\thandleMessage(params, extra, command)\n\t{\n\t\tlet currentHeaderName = BXMobileApp.UI.Page.TopBar.title.params.text;\n\t\tlet senderId = params.message.senderId;\n\t\tif (params.users[senderId].name !== currentHeaderName)\n\t\t{\n\t\t\tthis.dialog.redrawHeader();\n\t\t}\n\t}\n}","/**\n * Bitrix Mobile Dialog\n * Dialog Rest answers (Rest Answer Handler)\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BaseRestHandler} from \"im.provider.rest\";\nimport {LocalStorage} from \"im.lib.localstorage\";\nimport {EventType} from \"im.const\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport class MobileRestAnswerHandler extends BaseRestHandler\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\n\t\tif (typeof params.context === 'object' && params.context)\n\t\t{\n\t\t\tthis.context = params.context;\n\t\t}\n\t}\n\n\thandleImCallGetCallLimitsSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {call: {\n\t\t\tserverEnabled: data.callServerEnabled,\n\t\t\tmaxParticipants: data.maxParticipants,\n\t\t}});\n\t}\n\n\thandleImChatGetSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {dialog: {\n\t\t\tchatId: data.id,\n\t\t\tdialogId: data.dialog_id,\n\t\t\tdiskFolderId: data.disk_folder_id,\n\t\t}});\n\n\t\tif (data.restrictions)\n\t\t{\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: data.dialog_id,\n\t\t\t\tfields: data.restrictions\n\t\t\t});\n\t\t}\n\t}\n\thandleImChatGetError(error)\n\t{\n\t\tif (error.ex.error === 'ACCESS_ERROR')\n\t\t{\n\t\t\tapp.closeController();\n\t\t}\n\t}\n\n\thandleMobileBrowserConstGetSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {disk: {\n\t\t\tenabled: true,\n\t\t\tmaxFileSize: data.phpUploadMaxFilesize\n\t\t}});\n\n\t\tthis.context.addLocalize(data);\n\t\tBX.message(data);\n\n\t\tLocalStorage.set(this.controller.getSiteId(), 0, 'serverVariables', data || {});\n\t}\n\n\thandleImDialogMessagesGetInitSuccess()\n\t{\n\t\t// EventEmitter.emit(EventType.dialog.readVisibleMessages, {chatId: this.controller.application.getChatId()});\n\t}\n\n\thandleImMessageAddSuccess(messageId, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n\n\thandleImMessageAddError(error, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n\n\thandleImDiskFileCommitSuccess(result, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n}","export const LoadingStatus = {\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t<svg class=\"bx-mobilechat-loading-circular\" viewBox=\"25 25 50 50\">\n\t\t\t\t<circle class=\"bx-mobilechat-loading-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t\t<circle class=\"bx-mobilechat-loading-inner-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t</svg>\n\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_LOADING')}}</h3>\n\t\t</div>\n\t`\n};","import {Vuex} from \"ui.vue.vuex\";\n\nexport const ErrorStatus = {\n\tcomputed:\n\t{\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application\n\t\t}),\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-body\" key=\"error-body\">\n\t\t\t<div class=\"bx-mobilechat-warning-window\">\n\t\t\t\t<div class=\"bx-mobilechat-warning-icon\"></div>\n\t\t\t\t<template v-if=\"application.error.description\"> \n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\" v-html=\"application.error.description\"></div>\n\t\t\t\t</template> \n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-warning-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_ERROR_TITLE')}}</div>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_ERROR_DESC')}}</div>\n\t\t\t\t</template> \n\t\t\t</div>\n\t\t</div>\n\t`\n};\n","export const EmptyStatus = {\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_EMPTY')}}</h3>\n\t\t</div>\n\t`\n};","import \"ui.vue.components.smiles\";\n\nexport const MobileSmiles = {\n\tmethods:\n\t{\n\t\tonSelectSmile(event)\n\t\t{\n\t\t\tthis.$emit('selectSmile', event);\n\t\t},\n\t\tonSelectSet(event)\n\t\t{\n\t\t\tthis.$emit('selectSet', event);\n\t\t},\n\t\thideSmiles()\n\t\t{\n\t\t\tthis.$emit('hideSmiles');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<transition enter-active-class=\"bx-livechat-consent-window-show\" leave-active-class=\"bx-livechat-form-close\">\n\t\t\t<div class=\"bx-messenger-alert-box bx-livechat-alert-box-zero-padding bx-livechat-form-show\" key=\"vote\">\n\t\t\t\t<div class=\"bx-livechat-alert-close\" @click=\"hideSmiles\"></div>\n\t\t\t\t<div class=\"bx-messenger-smiles-box\">\n\t\t\t\t\t<bx-smiles\n\t\t\t\t\t\t@selectSmile=\"onSelectSmile\"\n\t\t\t\t\t\t@selectSet=\"onSelectSet\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t`\n};","/**\n * Bitrix im dialog mobile\n * Dialog vue component\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BitrixVue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\nimport {Logger} from \"im.lib.logger\";\nimport {EventType, RestMethod} from \"im.const\";\nimport {Utils} from \"im.lib.utils\";\nimport \"im.component.dialog\";\nimport \"im.view.quotepanel\";\n\nimport {EventEmitter} from \"main.core.events\";\n\nimport {LoadingStatus} from './loading-status';\nimport {ErrorStatus} from './error-status';\nimport {EmptyStatus} from './empty-status';\nimport {MobileSmiles} from './mobile-smiles';\n\nimport {\n\tDialogCore, DialogReadMessages, DialogQuoteMessage, DialogClickOnCommand, DialogClickOnMention, DialogClickOnUserName,\n\tDialogClickOnMessageMenu, DialogClickOnMessageRetry, DialogClickOnUploadCancel, DialogClickOnReadList, DialogSetMessageReaction,\n\tDialogOpenMessageReactionList, DialogClickOnKeyboardButton, DialogClickOnChatTeaser, DialogClickOnDialog\n} from 'im.mixin';\n\n/**\n * @notice Do not clone this component! It is under development.\n */\nBitrixVue.component('bx-mobile-im-component-dialog',\n{\n\tmixins: [\n\t\tDialogCore, DialogReadMessages, DialogQuoteMessage, DialogClickOnCommand, DialogClickOnMention, DialogClickOnUserName,\n\t\tDialogClickOnMessageMenu, DialogClickOnMessageRetry, DialogClickOnUploadCancel, DialogClickOnReadList, DialogSetMessageReaction,\n\t\tDialogOpenMessageReactionList, DialogClickOnKeyboardButton, DialogClickOnChatTeaser, DialogClickOnDialog\n\t],\n\tcomponents: {LoadingStatus, ErrorStatus, EmptyStatus, MobileSmiles},\n\tdata: function()\n\t{\n\t\treturn {\n\t\t\tdialogState: 'loading'\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tEventType: () => EventType,\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases(['MOBILE_CHAT_', 'IM_UTILS_'], this.$root.$bitrixMessages);\n\t\t},\n\t\twidgetClassName()\n\t\t{\n\t\t\tlet className = [];\n\n\t\t\tclassName.push('bx-mobile');\n\n\t\t\tif (Utils.platform.isIos())\n\t\t\t{\n\t\t\t\tclassName.push('bx-mobile-ios');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tclassName.push('bx-mobile-android');\n\t\t\t}\n\n\t\t\treturn className.join(' ');\n\t\t},\n\t\tquotePanelData()\n\t\t{\n\t\t\tlet result = {\n\t\t\t\tid: 0,\n\t\t\t\ttitle: '',\n\t\t\t\tdescription: '',\n\t\t\t\tcolor: ''\n\t\t\t};\n\n\t\t\tif (!this.showMessageDialog || !this.dialog.quoteId)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tlet message = this.$store.getters['messages/getMessage'](this.dialog.chatId, this.dialog.quoteId);\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tlet user = this.$store.getters['users/get'](message.authorId);\n\t\t\tlet files = this.$store.getters['files/getList'](this.dialog.chatId);\n\t\t\tlet editId = this.$store.getters['dialogues/getEditId'](this.dialog.dialogId);\n\n\t\t\treturn {\n\t\t\t\tid: this.dialog.quoteId,\n\t\t\t\ttitle: editId? this.$Bitrix.Loc.getMessage('MOBILE_CHAT_EDIT_TITLE') : (message.params.NAME ? message.params.NAME : (user ? user.name: '')),\n\t\t\t\tcolor: user? user.color: '',\n\t\t\t\tdescription: Utils.text.purify(message.text, message.params, files, this.$Bitrix.Loc.getMessages())\n\t\t\t};\n\t\t},\n\n\t\tisDialog()\n\t\t{\n\t\t\treturn Utils.dialog.isChatId(this.dialog.dialogId);\n\t\t},\n\n\t\tisGestureQuoteSupported()\n\t\t{\n\t\t\tif (this.dialog && this.dialog.type === 'announcement' && !this.dialog.managerList.includes(this.application.common.userId))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn ChatPerformance.isGestureQuoteSupported();\n\t\t},\n\t\tisDarkBackground()\n\t\t{\n\t\t\treturn this.application.options.darkBackground;\n\t\t},\n\t\tshowMessageDialog()\n\t\t{\n\t\t\tlet result = this.messageCollection && this.messageCollection.length > 0;\n\t\t\tlet timeout = ChatPerformance.getDialogShowTimeout();\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\tif (timeout > 0)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.dialogStateTimeout);\n\t\t\t\t\tthis.dialogStateTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.dialogState = 'show';\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.dialogState = 'show';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.dialog && this.dialog.init)\n\t\t\t{\n\t\t\t\tif (timeout > 0)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.dialogStateTimeout);\n\t\t\t\t\tthis.dialogStateTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.dialogState = 'empty';\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.dialogState = 'empty';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.dialogState = 'loading';\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t\tmessageCollection: state => state.messages.collection[state.application.dialog.chatId]\n\t\t})\n\t},\n\tmethods:\n\t{\n\t\tgetApplication()\n\t\t{\n\t\t\treturn this.$Bitrix.Application.get();\n\t\t},\n\t\tlogEvent(name, ...params)\n\t\t{\n\t\t\tLogger.info(name, ...params);\n\t\t},\n\t\tonDialogRequestHistory(event)\n\t\t{\n\t\t\tthis.getApplication().getDialogHistory(event.lastId);\n\t\t},\n\t\tonDialogRequestUnread(event)\n\t\t{\n\t\t\tthis.getApplication().getDialogUnread(event.lastId);\n\t\t},\n\t\tonClickOnUserName({data: event})\n\t\t{\n\t\t\tthis.getApplication().replyToUser(event.user.id, event.user);\n\t\t},\n\t\tonClickOnUploadCancel({data: event})\n\t\t{\n\t\t\tthis.getApplication().cancelUploadFile(event.file.id);\n\t\t},\n\t\tonClickOnCommand({data: event})\n\t\t{\n\t\t\tif (event.type === 'put')\n\t\t\t{\n\t\t\t\tthis.getApplication().insertText({text: event.value+' '});\n\t\t\t}\n\t\t\telse if (event.type === 'send')\n\t\t\t{\n\t\t\t\tthis.getApplication().addMessage(event.value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('Unprocessed command', event);\n\t\t\t}\n\t\t},\n\t\tonClickOnMention({data: event})\n\t\t{\n\t\t\tif (event.type === 'USER')\n\t\t\t{\n\t\t\t\tthis.getApplication().openProfile(event.value);\n\t\t\t}\n\t\t\telse if (event.type === 'CHAT')\n\t\t\t{\n\t\t\t\tthis.getApplication().openDialog(event.value);\n\t\t\t}\n\t\t\telse if (event.type === 'CALL')\n\t\t\t{\n\t\t\t\tthis.getApplication().openPhoneMenu(event.value);\n\t\t\t}\n\t\t},\n\t\tonClickOnMessageMenu({data: event})\n\t\t{\n\t\t\tLogger.warn('Message menu:', event);\n\t\t\tthis.getApplication().openMessageMenu(event.message);\n\t\t},\n\t\tonClickOnMessageRetry({data: event})\n\t\t{\n\t\t\tLogger.warn('Message retry:', event);\n\t\t\tthis.getApplication().retrySendMessage(event.message);\n\t\t},\n\t\tonReadMessage({data: event})\n\t\t{\n\t\t\tthis.getApplication().readMessage(event.id);\n\t\t},\n\t\tonClickOnReadList({data: event})\n\t\t{\n\t\t\tthis.getApplication().openReadedList(event.list);\n\t\t},\n\t\tonQuoteMessage({data: event})\n\t\t{\n\t\t\tthis.getApplication().quoteMessage(event.message.id);\n\t\t},\n\t\tonSetMessageReaction({data: event})\n\t\t{\n\t\t\tthis.getApplication().reactMessage(event.message.id, event.reaction);\n\t\t},\n\t\tonOpenMessageReactionList({data: event})\n\t\t{\n\t\t\tthis.getApplication().openMessageReactionList(event.message.id, event.values);\n\t\t},\n\t\tonClickOnKeyboardButton({data: event})\n\t\t{\n\t\t\tif (event.action === 'ACTION')\n\t\t\t{\n\t\t\t\tlet {dialogId, messageId, botId, action, value} = event.params;\n\n\t\t\t\tif (action === 'SEND')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().addMessage(value);\n\t\t\t\t\tsetTimeout(() => EventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.chatId, duration: 300, cancelIfScrollChange: false}), 300);\n\t\t\t\t}\n\t\t\t\telse if (action === 'PUT')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().insertText({text: value+' '});\n\t\t\t\t}\n\t\t\t\telse if (action === 'CALL')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().openPhoneMenu(value);\n\t\t\t\t}\n\t\t\t\telse if (action === 'COPY')\n\t\t\t\t{\n\t\t\t\t\tapp.exec(\"copyToClipboard\", {text: value});\n\n\t\t\t\t\t(new BXMobileApp.UI.NotificationBar({\n\t\t\t\t\t\tmessage: BX.message(\"MOBILE_MESSAGE_MENU_COPY_SUCCESS\"),\n\t\t\t\t\t\tcolor: \"#af000000\",\n\t\t\t\t\t\ttextColor: \"#ffffff\",\n\t\t\t\t\t\tgroupId: \"clipboard\",\n\t\t\t\t\t\tmaxLines: 1,\n\t\t\t\t\t\talign: \"center\",\n\t\t\t\t\t\tisGlobal: true,\n\t\t\t\t\t\tuseCloseButton: true,\n\t\t\t\t\t\tautoHideTimeout: 1500,\n\t\t\t\t\t\thideOnTap: true\n\t\t\t\t\t}, \"copy\")).show();\n\n\t\t\t\t}\n\t\t\t\telse if (action === 'DIALOG')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().openDialog(value);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (event.action === 'COMMAND')\n\t\t\t{\n\t\t\t\tlet {dialogId, messageId, botId, command, params} = event.params;\n\n\t\t\t\tthis.$Bitrix.RestClient.get().callMethod(RestMethod.imMessageCommand, {\n\t\t\t\t\t'MESSAGE_ID': messageId,\n\t\t\t\t\t'DIALOG_ID': dialogId,\n\t\t\t\t\t'BOT_ID': botId,\n\t\t\t\t\t'COMMAND': command,\n\t\t\t\t\t'COMMAND_PARAMS': params,\n\t\t\t\t});\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tonClickOnChatTeaser({data: event})\n\t\t{\n\t\t\tthis.$Bitrix.Data.get('controller').application.joinParentChat(event.message.id, 'chat'+event.message.params.CHAT_ID).then((dialogId) => {\n\t\t\t\tthis.getApplication().openDialog(dialogId);\n\t\t\t}).catch(() => {});\n\t\t},\n\t\tonClickOnDialog({data: event})\n\t\t{\n\t\t\t//this.getApplication().controller.hideSmiles();\n\t\t},\n\t\tonQuotePanelClose()\n\t\t{\n\t\t\tthis.getApplication().quoteMessageClear();\n\t\t},\n\t\tonSmilesSelectSmile(event)\n\t\t{\n\t\t\tconsole.warn('Smile selected:', event);\n\t\t\tthis.getApplication().insertText({text: event.text});\n\t\t},\n\t\tonSmilesSelectSet()\n\t\t{\n\t\t\tconsole.warn('Set selected');\n\t\t\tthis.getApplication().setTextFocus();\n\t\t},\n\t\tonHideSmiles()\n\t\t{\n\t\t\t//this.getApplication().controller.hideSmiles();\n\t\t\tthis.getApplication().setTextFocus();\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div :class=\"widgetClassName\">\n\t\t\t<bx-im-component-dialog\n\t\t\t\t:userId=\"application.common.userId\"\n\t\t\t\t:dialogId=\"application.dialog.dialogId\"\n\t\t\t\t:enableReadMessages=\"application.dialog.enableReadMessages\"\n\t\t\t\t:enableReactions=\"true\"\n\t\t\t\t:enableDateActions=\"false\"\n\t\t\t\t:enableCreateContent=\"false\"\n\t\t\t\t:enableGestureQuote=\"application.options.quoteEnable\"\n\t\t\t\t:enableGestureQuoteFromRight=\"application.options.quoteFromRight\"\n\t\t\t\t:enableGestureMenu=\"true\"\n\t\t\t\t:showMessageUserName=\"isDialog\"\n\t\t\t\t:showMessageAvatar=\"isDialog\"\n\t\t\t\t:showMessageMenu=\"false\"\n\t\t\t\t:skipDataRequest=\"true\"\n\t\t\t />\n\t\t\t<template v-if=\"application.options.showSmiles\">\n\t\t\t\t<MobileSmiles @selectSmile=\"onSmilesSelectSmile\" @selectSet=\"onSmilesSelectSet\" @hideSmiles=\"onHideSmiles\" />\n\t\t\t</template>\n\t\t</div>\n\t`\n}, {immutable: true});\n","/**\n * Bitrix Im mobile\n * Dialog application\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2020 Bitrix\n */\n\n// vue\nimport {VueVendorV2, Vue} from \"ui.vue\";\nimport {Core} from \"mobile.im.application.core\";\n\n// main\nimport \"main.date\";\nimport {EventEmitter} from \"main.core.events\";\n\n// pull\nimport {PULL as Pull, PullClient} from \"mobile.pull.client\";\n\n// messenger files\nimport {FilesModel} from 'im.model';\n\nimport {\n\tRestMethod,\n\tRestMethodHandler,\n\tEventType,\n\tDialogType,\n\tFileStatus,\n\tFileType, DialogCrmType,\n} from 'im.const';\nimport {Utils} from \"im.lib.utils\";\nimport {LocalStorage} from \"im.lib.localstorage\";\n\nimport {MobileImCommandHandler} from \"./pull.handler\";\nimport {MobileRestAnswerHandler} from \"./rest.handler\";\nimport {Timer} from \"im.lib.timer\";\n\n// TODO change BX.Promise, BX.Main.Date to IMPORT\n\n// vue components\nimport 'pull.component.status';\n\n// dialog files\nimport \"./dialog.css\";\n\n// widget components\nimport \"./component/dialog\";\n\nconst STORAGE_PREFIX = 'chatBackgroundUser';\nconst FILES_STORAGE_NAME = 'uploadTasks';\nconst MESSAGES_STORAGE_NAME = 'tasks';\n\nexport class MobileDialogApplication\n{\n\t/* region 01. Initialize and store data */\n\n\tconstructor(params = {})\n\t{\n\t\tthis.inited = false;\n\t\tthis.initPromise = new BX.Promise;\n\n\t\tthis.params = params;\n\n\t\tthis.template = null;\n\t\tthis.rootNode = this.params.node || document.createElement('div');\n\n\t\tthis.eventBus = new VueVendorV2;\n\t\tthis.timer = new Timer();\n\n\t\tthis.messagesQueue = [];\n\t\tthis.windowFocused = true;\n\n\t\tthis.uploadTasks = [];\n\t\tthis.messagesTasks = [];\n\n\t\tthis.messagesSet = false;\n\n\t\t//alert('Pause: open console for debug');\n\n\t\tthis.initCore()\n\t\t\t.then(() => this.subscribeToEvents())\n\t\t\t.then(() => this.initComponentParams())\n\t\t\t.then(result => this.initMobileEntity(result))\n\t\t\t.then(result => this.initMobileSettings(result))\n\t\t\t.then(() => this.initComponent())\n\t\t\t.then(() => this.initEnvironment())\n\t\t\t.then(() => this.initMobileEnvironment())\n\t\t\t.then(() => this.loadUnsentFromStorage())\n\t\t\t.then(() => this.initPullClient())\n\t\t\t.then(() => this.initComplete())\n\t\t;\n\t}\n\n\tinitCore()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tCore.ready().then(controller => {\n\t\t\t\tthis.controller = controller;\n\t\t\t\tresolve();\n\t\t\t})\n\t\t});\n\t}\n\n\tsubscribeToEvents()\n\t{\n\t\tEventEmitter.subscribe(EventType.dialog.messagesSet, this.onMessagesSet.bind(this));\n\t}\n\n\tinitComponentParams()\n\t{\n\t\treturn BX.componentParameters.init();\n\t}\n\n\tinitMobileEntity(data)\n\t{\n\t\tconsole.log('1. initMobileEntity');\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (data.DIALOG_ENTITY)\n\t\t\t{\n\t\t\t\tdata.DIALOG_ENTITY = JSON.parse(data.DIALOG_ENTITY);\n\t\t\t\tif (data.DIALOG_TYPE === 'user')\n\t\t\t\t{\n\t\t\t\t\tthis.controller.getStore().dispatch('users/set', data.DIALOG_ENTITY).then(() => {\n\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse if (data.DIALOG_TYPE === 'chat')\n\t\t\t\t{\n\t\t\t\t\tthis.controller.getStore().dispatch('dialogues/set', data.DIALOG_ENTITY).then(() => {\n\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve(data);\n\t\t\t}\n\t\t});\n\t}\n\n\tinitMobileSettings(data)\n\t{\n\t\tconsole.log('2. initMobileSettings');\n\n\t\t// todo change to dynamic storage (LocalStorage web, PageParams for mobile)\n\t\tlet serverVariables = LocalStorage.get(this.controller.getSiteId(), 0, 'serverVariables', false);\n\t\tif (serverVariables)\n\t\t{\n\t\t\tthis.addLocalize(serverVariables);\n\t\t}\n\n\t\tthis.storedEvents = data.STORED_EVENTS || [];\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tApplicationStorage.getObject('settings.chat', {\n\t\t\t\tquoteEnable: ChatPerformance.isGestureQuoteSupported(),\n\t\t\t\tquoteFromRight: false,\n\t\t\t\tautoplayVideo: ChatPerformance.isAutoPlayVideoSupported(),\n\t\t\t\tbackgroundType: 'LIGHT_GRAY'\n\t\t\t}).then(options => {\n\t\t\t\tthis.controller.getStore().dispatch('application/set', {\n\t\t\t\t\tdialog: {\n\t\t\t\t\t\tdialogId: data.DIALOG_ID\n\t\t\t\t\t},\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tquoteEnable: options.quoteEnable,\n\t\t\t\t\t\tquoteFromRight: options.quoteFromRight,\n\t\t\t\t\t\tautoplayVideo: options.autoplayVideo,\n\t\t\t\t\t\tdarkBackground: ChatDialogBackground && ChatDialogBackground[options.backgroundType] && ChatDialogBackground[options.backgroundType].dark\n\t\t\t\t\t}\n\t\t\t\t}).then(() => resolve());\n\t\t\t})\n\t\t});\n\t}\n\n\tinitComponent()\n\t{\n\t\tconsole.log('3. initComponent');\n\n\t\tthis.controller.application.setPrepareFilesBeforeSaveFunction(this.prepareFileData.bind(this));\n\n\t\tthis.controller.addRestAnswerHandler(\n\t\t\tMobileRestAnswerHandler.create({\n\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\tcontroller: this.controller,\n\t\t\t\tcontext: this,\n\t\t\t})\n\t\t);\n\n\t\tlet dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (dialog)\n\t\t{\n\t\t\tthis.controller.getStore().commit('application/set', {dialog: {\n\t\t\t\tchatId: dialog.chatId,\n\t\t\t\tdiskFolderId: dialog.diskFolderId || 0\n\t\t\t}});\n\t\t}\n\n\t\treturn this.controller.createVue(this, {\n\t\t\tel: this.rootNode,\n\t\t\ttemplate: `<bx-mobile-im-component-dialog/>`,\n\t\t})\n\t\t.then(vue => {\n\t\t\tthis.template = vue;\n\t\t\treturn new Promise((resolve, reject) => resolve());\n\t\t});\n\t}\n\n\tinitEnvironment()\n\t{\n\t\tconsole.log('4. initEnvironment');\n\n\t\tthis.setTextareaMessage = Utils.debounce(this.controller.application.setTextareaMessage, 300, this.controller.application);\n\n\t\tif (\n\t\t\tUtils.platform.isIos()\n\t\t\t&& Application.getApiVersion() >= 39\n\t\t)\n\t\t{\n\t\t\t//document.body.classList.add('bx-mobile-ios-safe-area');\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitMobileEnvironment()\n\t{\n\t\tconsole.log('5. initMobileEnvironment');\n\n\t\tBXMobileApp.UI.Page.Scroll.setEnabled(false);\n\t\tBXMobileApp.UI.Page.captureKeyboardEvents(true);\n\n\t\tBX.addCustomEvent(\"onKeyboardWillShow\", () => {\n\t\t\t// EventEmitter.emit(EventType.dialog.beforeMobileKeyboard);\n\t\t\tthis.controller.getStore().dispatch('application/set', {mobile: {\n\t\t\t\tkeyboardShow: true,\n\t\t\t}});\n\t\t});\n\n\t\tBX.addCustomEvent(\"onKeyboardDidShow\", () => {\n\t\t\tconsole.log('Keyboard was showed');\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.controller.application.getChatId(), duration: 300, cancelIfScrollChange: true});\n\t\t});\n\n\t\tBX.addCustomEvent(\"onKeyboardWillHide\", () => {\n\t\t\tclearInterval(this.keyboardOpeningInterval);\n\t\t\tthis.controller.getStore().dispatch('application/set', {mobile: {\n\t\t\t\tkeyboardShow: false,\n\t\t\t}});\n\t\t});\n\n\t\tconst checkWindowFocused = () =>\n\t\t{\n\t\t\tBXMobileApp.UI.Page.isVisible({callback: (data) =>\n\t\t\t{\n\t\t\t\tthis.windowFocused = data.status === 'visible';\n\t\t\t\tif (this.windowFocused)\n\t\t\t\t{\n\t\t\t\t\tVue.event.$emit('bitrixmobile:controller:focus');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t\t\t}\n\t\t\t}});\n\t\t};\n\n\t\tBXMobileApp.addCustomEvent(\"CallEvents::viewOpened\", () => {\n\t\t\tconsole.warn('CallView show - disable read message');\n\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t});\n\n\t\tBXMobileApp.addCustomEvent(\"CallEvents::viewClosed\", () => {\n\t\t\tconsole.warn('CallView hide - enable read message');\n\t\t\tcheckWindowFocused();\n\t\t});\n\n\t\tBX.addCustomEvent(\"onAppActive\", () =>\n\t\t{\n\t\t\tcheckWindowFocused();\n\n\t\t\tBXMobileApp.UI.Page.isVisible({callback: (data) =>\n\t\t\t{\n\t\t\t\tif (data.status !== 'visible')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.getDialogUnread().then(() => {\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.readVisibleMessages, {chatId: this.controller.application.getChatId()});\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollOnStart, {chatId: this.controller.application.getChatId()});\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t});\n\t\t\t}});\n\t\t});\n\n\t\tBX.addCustomEvent(\"onAppPaused\", () => {\n\t\t\tthis.windowFocused = false;\n\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t\t//app.closeController();z\n\t\t});\n\n\t\tBX.addCustomEvent(\"onOpenPageAfter\", checkWindowFocused);\n\t\tBX.addCustomEvent(\"onHidePageBefore\", () => {\n\t\t\tthis.windowFocused = false;\n\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t});\n\n\t\tBXMobileApp.addCustomEvent(\"chatbackground::task::status::success\", (params) => {\n\t\t\tlet action = params.taskId.toString().split('|')[0];\n\t\t\tthis.executeBackgroundTaskSuccess(action, params);\n\t\t});\n\t\tBXMobileApp.addCustomEvent(\"chatbackground::task::status::failure\", (params) => {\n\t\t\tlet action = params.taskId.toString().split('|')[0];\n\t\t\tthis.executeBackgroundTaskFailure(action, params);\n\t\t});\n\t\tBXMobileApp.addCustomEvent(\"chatrecent::push::get\", (params) => {\n\t\t\tPull.emit({\n\t\t\t\ttype: PullClient.SubscriptionType.Server,\n\t\t\t\tmoduleId: this.pullMobileHandler.getModuleId(),\n\t\t\t\tdata: {command: 'messageAdd', params: {...params, optionImportant: true}}\n\t\t\t});\n\t\t});\n\n\t\tBXMobileApp.UI.Page.TextPanel.setParams(this.getKeyboardParams());\n\t\tthis.changeChatKeyboardStatus();\n\n\t\tBX.MobileUploadProvider.setListener(this.executeUploaderEvent.bind(this));\n\n\t\tthis.fileUpdateProgress = Utils.throttle((chatId, fileId, progress, size) => {\n\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\tchatId: chatId,\n\t\t\t\tid: fileId,\n\t\t\t\tfields: {\n\t\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\t\tsize: size,\n\t\t\t\t\tprogress: progress\n\t\t\t\t}\n\t\t\t});\n\t\t}, 500);\n\n\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tthis.userShowWorkPosition = true;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.userShowWorkPosition = false;\n\t\t\t\tthis.redrawHeader();\n\t\t\t}, 1500);\n\n\t\t\tsetInterval(() => {\n\t\t\t\tthis.redrawHeader();\n\t\t\t}, 60000);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.chatShowUserCounter = false;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.chatShowUserCounter = true;\n\t\t\t\tthis.redrawHeader();\n\t\t\t}, 1500);\n\t\t}\n\n\t\tthis.redrawHeader();\n\n\t\tthis.widgetCache = new ChatWidgetCache(this.controller.getUserId(), this.controller.getLanguageId());\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitPullClient()\n\t{\n\t\tconsole.log('6. initPullClient');\n\n\t\tif (this.storedEvents && this.storedEvents.length > 0 && this.controller.application.isUnreadMessagesLoaded())\n\t\t{\n\t\t\t//sort events and get first 50 (to match unread messages cache size)\n\t\t\tthis.storedEvents = this.storedEvents.sort((a, b) => {\n\t\t\t\treturn a.message.id - b.message.id;\n\t\t\t});\n\t\t\tthis.storedEvents = this.storedEvents.slice(0, 50);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.storedEvents = this.storedEvents.filter(event => {\n\t\t\t\t\tBX.onCustomEvent('chatrecent::push::get', [event]);\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t}, 50);\n\t\t}\n\n\t\tPull.subscribe(\n\t\t\tthis.pullMobileHandler = new MobileImCommandHandler({\n\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\tcontroller: this.controller,\n\t\t\t\tdialog: this,\n\t\t\t})\n\t\t);\n\t\tPull.subscribe({\n\t\t\ttype: BX.PullClient.SubscriptionType.Server,\n\t\t\tmoduleId: 'im',\n\t\t\tcommand: 'chatUserLeave',\n\t\t\tcallback: (params) =>\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tparams.userId === this.controller.application.getUserId()\n\t\t\t\t\t&& params.dialogId === this.controller.application.getDialogId()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tapp.closeController();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tPull.subscribe({\n\t\t\ttype: PullClient.SubscriptionType.Status,\n\t\t\tcallback: this.eventStatusInteraction.bind(this)\n\t\t});\n\n\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tPull.subscribe({\n\t\t\t\ttype: PullClient.SubscriptionType.Online,\n\t\t\t\tcallback: this.eventOnlineInteraction.bind(this)\n\t\t\t});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitComplete()\n\t{\n\t\tconsole.log('7. init complete')\n\t\tthis.controller.getStore().subscribe(mutation => this.eventStoreInteraction(mutation));\n\n\t\tthis.inited = true;\n\t\tthis.initPromise.resolve(this);\n\n\t\tBXMobileApp.Events.postToComponent(\"chatdialog::init::complete\", [{\n\t\t\tdialogId: this.controller.application.getDialogId()\n\t\t}, true], 'im.recent');\n\n\t\treturn this.requestData();\n\t}\n\n\trenderUnsentMessages()\n\t{\n\t\tconsole.log('render unsent messages');\n\n\t\tthis.timer.stop('data', 'renderUnsentMessages', true);\n\n\t\tif (this.messagesSet)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst chatId = this.controller.application.getChatId();\n\n\t\tthis.uploadTasks.forEach(entry => {\n\t\t\tif (chatId === entry.eventData.file.params.chatId)\n\t\t\t{\n\t\t\t\tconst file = entry.eventData.file.params.file;\n\t\t\t\tfile.messageTempId = entry.eventData.file.params.id;\n\n\t\t\t\tthis.uploadFile(file);\n\t\t\t}\n\t\t});\n\n\t\tthis.messagesTasks.forEach(entry => {\n\t\t\tif (chatId === entry.extra.chatId)\n\t\t\t{\n\t\t\t\tthis.addMessage(entry.extra.text, null, entry.extra.id);\n\t\t\t}\n\t\t});\n\t}\n\n\tloadUnsentFromStorage()\n\t{\n\t\tconsole.log('load unsent messages from storage');\n\n\t\treturn new Promise(resolve => {\n\t\t\tconst filesPromise = this.loadUnsentFiles();\n\t\t\tconst messagesPromise = this.loadUnsentMessages();\n\n\t\t\tPromise.all([filesPromise, messagesPromise]).then(resolve);\n\t\t});\n\n\t}\n\n\tloadUnsentMessages()\n\t{\n\t\tconst userId = this.controller.application.getUserId();\n\t\tconst chatId = this.controller.application.getChatId();\n\t\tconst storageId = `${STORAGE_PREFIX}_${userId}`;\n\n\t\treturn ApplicationStorage.getObject(MESSAGES_STORAGE_NAME, [], storageId)\n\t\t\t.then(result => {\n\t\t\t\tObject.values(result).forEach(entry => {\n\t\t\t\t\tif (chatId === entry.extra.chatId)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.messagesTasks.push(entry);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tloadUnsentFiles()\n\t{\n\t\tconst userId = this.controller.application.getUserId();\n\t\tconst chatId = this.controller.application.getChatId();\n\t\tconst storageId = `${STORAGE_PREFIX}_${userId}`;\n\n\t\treturn ApplicationStorage.getObject(FILES_STORAGE_NAME, [], storageId)\n\t\t\t.then(result => {\n\t\t\t\tObject.values(result).forEach(entry => {\n\t\t\t\t\tif (\n\t\t\t\t\t\ttypeof entry.eventData.file !== 'undefined'\n\t\t\t\t\t\t&& chatId === entry.eventData.file.params.chatId\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.uploadTasks.push(entry);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t});\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\tlet promise = new BX.Promise;\n\t\t\tpromise.resolve(this);\n\n\t\t\treturn promise;\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n\n\trequestData()\n\t{\n\t\tconsole.log('4. requestData');\n\t\tif (this.requestDataSend)\n\t\t{\n\t\t\treturn this.requestDataSend;\n\t\t}\n\n\t\tthis.timer.start('data', 'load', .5, () => {\n\t\t\tconsole.warn(\"ChatDialog.requestData: slow connection show progress icon\");\n\t\t\tapp.titleAction(\"setParams\", {useProgress: true, useLetterImage: false});\n\t\t});\n\n\t\tthis.timer.start('data', 'renderUnsentMessages', 3, () => {\n\t\t\tthis.renderUnsentMessages();\n\t\t});\n\n\t\tthis.requestDataSend = new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet query = {\n\t\t\t\t[RestMethodHandler.mobileBrowserConstGet]: [RestMethod.mobileBrowserConstGet, {}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {dialog_id: this.controller.application.getDialogId()}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetInit]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tdialog_id: this.controller.application.getDialogId(),\n\t\t\t\t\tlimit: this.controller.application.getRequestMessageLimit(),\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imRecentUnread]: [RestMethod.imRecentUnread, {dialog_id: this.controller.application.getDialogId(), action: 'N'}],\n\t\t\t\t[RestMethodHandler.imCallGetCallLimits]: [RestMethod.imCallGetCallLimits, {}],\n\t\t\t};\n\t\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserGet] = [RestMethod.imUserGet, {}];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserListGet] = [RestMethod.imUserListGet, {id: [this.controller.application.getUserId(), this.controller.application.getDialogId()]}];\n\t\t\t}\n\n\t\t\tthis.controller.restClient.callBatch(query, (response) =>\n\t\t\t{\n\t\t\t\tif (!response)\n\t\t\t\t{\n\t\t\t\t\tthis.requestDataSend = null;\n\t\t\t\t\tthis.setError('EMPTY_RESPONSE', 'Server returned an empty response.');\n\n\t\t\t\t\tresolve();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tlet constGet = response[RestMethodHandler.mobileBrowserConstGet];\n\t\t\t\tif (constGet.error())\n\t\t\t\t{\n\t\t\t\t\tconsole.warn('Error load dialog', constGet.error().ex.error, constGet.error().ex.error_description)\n\t\t\t\t\tconsole.warn('Try connect...');\n\t\t\t\t\tsetTimeout(() => this.requestData(), 5000);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.mobileBrowserConstGet, constGet);\n\t\t\t\t}\n\n\t\t\t\tlet callLimits = response[RestMethodHandler.imCallGetCallLimits];\n\t\t\t\tif (callLimits && !callLimits.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imCallGetCallLimits, callLimits);\n\t\t\t\t}\n\n\t\t\t\tlet userGet = response[RestMethodHandler.imUserGet];\n\t\t\t\tif (userGet && !userGet.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imUserGet, userGet);\n\t\t\t\t}\n\n\t\t\t\tlet userListGet = response[RestMethodHandler.imUserListGet];\n\t\t\t\tif (userListGet && !userListGet.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imUserListGet, userListGet);\n\t\t\t\t}\n\n\t\t\t\tlet chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\t\t\t\tthis.redrawHeader();\n\n\t\t\t\tlet dialogMessagesGetResult = response[RestMethodHandler.imDialogMessagesGetInit];\n\t\t\t\tif (dialogMessagesGetResult.error())\n\t\t\t\t{\n\t\t\t\t\t//this.setError(dialogMessagesGetResult.error().ex.error, dialogMessagesGetResult.error().ex.error_description);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tapp.titleAction(\"setParams\", {useProgress: false, useLetterImage: true});\n\t\t\t\t\tthis.timer.stop('data', 'load', true);\n\n\t\t\t\t\tthis.controller.getStore().dispatch('dialogues/saveDialog', {\n\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\t});\n\n\t\t\t\t\tif (this.controller.pullBaseHandler)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controller.pullBaseHandler.option.skip = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.controller.getStore().dispatch('application/set', {dialog: {\n\t\t\t\t\t\tenableReadMessages: true\n\t\t\t\t\t}}).then(() => {\n\t\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDialogMessagesGetInit, dialogMessagesGetResult);\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t}\n\n\t\t\t\tthis.requestDataSend = null;\n\t\t\t\tresolve();\n\n\t\t\t}, false, false, Utils.getLogTrackingParams({name: 'mobile.im.dialog', dialog: this.controller.application.getDialogData()}));\n\t\t});\n\n\t\treturn this.requestDataSend;\n\t}\n\n\texecuteUploaderEvent(eventName, eventData, taskId)\n\t{\n\t\tif (eventName !== BX.MobileUploaderConst.FILE_UPLOAD_PROGRESS)\n\t\t{\n\t\t\tconsole.log(\"ChatDialog.disk.eventRouter: \", eventName, taskId, eventData);\n\t\t}\n\n\t\tif (eventName === BX.MobileUploaderConst.FILE_UPLOAD_PROGRESS)\n\t\t{\n\t\t\tif (eventData.percent > 95)\n\t\t\t{\n\t\t\t\teventData.percent = 95;\n\t\t\t}\n\t\t\tthis.fileUpdateProgress(eventData.file.params.chatId, eventData.file.params.file.id, eventData.percent, eventData.byteTotal);\n\t\t}\n\t\telse if (eventName === BX.MobileUploaderConst.FILE_CREATED)\n\t\t{\n\t\t\tif (eventData.result.status === 'error')\n\t\t\t{\n\t\t\t\t//this.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\t\t\t\tconsole.error('File upload error', eventData.result.errors[0].message);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\t\tchatId: eventData.file.params.chatId,\n\t\t\t\t\tid: eventData.file.params.file.id,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tstatus: FileStatus.wait,\n\t\t\t\t\t\tprogress: 95\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (eventName === 'onimdiskmessageaddsuccess')\n\t\t{\n\t\t\tconsole.info('ChatDialog.disk.eventRouter: DISK_MESSAGE_ADD_SUCCESS: ', eventData, taskId);\n\n\t\t\tlet file = eventData.result.FILES['upload'+eventData.result.DISK_ID[0]];\n\n\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\tchatId: eventData.file.params.chatId,\n\t\t\t\tid: eventData.file.params.file.id,\n\t\t\t\tfields: {\n\t\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\t\tprogress: 100,\n\t\t\t\t\tid: file.id,\n\t\t\t\t\tsize: file.size,\n\t\t\t\t\turlDownload: file.urlDownload,\n\t\t\t\t\turlPreview: file.urlPreview,\n\t\t\t\t\turlShow: file.urlShow,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (eventName === 'onimdiskmessageaddfail')\n\t\t{\n\t\t\tconsole.error('ChatDialog.disk.eventRouter: DISK_MESSAGE_ADD_FAIL: ', eventData, taskId);\n\t\t\t//this.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\t\t}\n\t\telse if (\n\t\t\teventName === BX.MobileUploaderConst.TASK_CANCELLED\n\t\t\t|| eventName === BX.MobileUploaderConst.TASK_NOT_FOUND\n\t\t)\n\t\t{\n\t\t\tthis.cancelUploadFile(eventData.file.params.file.id);\n\t\t}\n\t\telse if (\n\t\t\teventName === BX.MobileUploaderConst.FILE_CREATED_FAILED\n\t\t\t|| eventName === BX.MobileUploaderConst.FILE_UPLOAD_FAILED\n\t\t\t|| eventName === BX.MobileUploaderConst.FILE_READ_ERROR\n\t\t\t|| eventName === BX.MobileUploaderConst.TASK_STARTED_FAILED\n\t\t)\n\t\t{\n\t\t\tconsole.error('ChatDialog.disk.eventRouter: ', eventName, eventData, taskId);\n\t\t\t//this.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tprepareFileData(files)\n\t{\n\t\tlet prepareFunction = (file) =>\n\t\t{\n\t\t\tif (file.urlPreview && file.urlPreview.startsWith('file://'))\n\t\t\t{\n\t\t\t\tfile.urlPreview = 'bx'+file.urlPreview;\n\t\t\t}\n\t\t\tif (file.urlShow && file.urlShow.startsWith('file://'))\n\t\t\t{\n\t\t\t\tfile.urlShow = 'bx'+file.urlShow;\n\t\t\t}\n\n\t\t\tif (file.type !== FileType.image)\n\t\t\t{\n\t\t\t\treturn file;\n\t\t\t}\n\n\t\t\tif (file.urlPreview)\n\t\t\t{\n\t\t\t\tif (file.urlPreview.startsWith('/'))\n\t\t\t\t{\n\t\t\t\t\tfile.urlPreview = currentDomain+file.urlPreview;\n\t\t\t\t}\n\n\t\t\t\tfile.urlPreview = file.urlPreview\n\t\t\t\t\t.replace('http://', 'bxhttp://')\n\t\t\t\t\t.replace('https://', 'bxhttps://');\n\t\t\t}\n\n\t\t\tif (file.urlShow)\n\t\t\t{\n\t\t\t\tif (file.urlShow.startsWith('/'))\n\t\t\t\t{\n\t\t\t\t\tfile.urlShow = currentDomain+file.urlShow;\n\t\t\t\t}\n\n\t\t\t\tfile.urlShow = file.urlShow\n\t\t\t\t\t.replace('http://', 'bxhttp://')\n\t\t\t\t\t.replace('https://', 'bxhttps://');\n\t\t\t}\n\n\t\t\treturn file;\n\t\t};\n\n\t\tif (files instanceof Array)\n\t\t{\n\t\t\treturn files.map(file => prepareFunction(file));\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn prepareFunction(files);\n\t\t}\n\t}\n\n/* endregion 01. Initialize and store data */\n\n/* region 02. Mobile environment methods */\n\tredrawHeader()\n\t{\n\t\tlet headerProperties;\n\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\theaderProperties = this.getChatHeaderParams();\n\t\t\tthis.changeChatKeyboardStatus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\theaderProperties = this.getUserHeaderParams();\n\t\t}\n\n\t\tif (!headerProperties)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.setHeaderButtons();\n\n\t\tif (!this.headerMenuInited)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.params.useLetterImage = true;\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setCallback(() => this.openHeaderMenu());\n\n\t\t\tthis.headerMenuInited = true;\n\t\t}\n\n\t\tif (headerProperties.name)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setText(headerProperties.name);\n\t\t}\n\t\tif (headerProperties.desc)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setDetailText(headerProperties.desc);\n\t\t}\n\t\tif (headerProperties.avatar)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setImage(headerProperties.avatar);\n\t\t}\n\t\telse if (headerProperties.color)\n\t\t{\n\t\t\t//BXMobileApp.UI.Page.TopBar.title.setImageColor(dialog.color);\n\t\t\tBXMobileApp.UI.Page.TopBar.title.params.imageColor = headerProperties.color;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetUserHeaderParams()\n\t{\n\t\tlet user = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId());\n\t\tif (!user || !user.init)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = {\n\t\t\t'name': null,\n\t\t\t'desc': null,\n\t\t\t'avatar': null,\n\t\t\t'color': null,\n\t\t};\n\n\t\tif (user.avatar)\n\t\t{\n\t\t\tresult.avatar = user.avatar;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.color = user.color;\n\t\t}\n\n\t\tresult.name = user.name;\n\n\t\tlet showLastDate = false;\n\n\t\tif (!this.userShowWorkPosition && user.lastActivityDate)\n\t\t{\n\t\t\tshowLastDate = Utils.user.getLastDateText(user, this.getLocalize());\n\t\t}\n\n\t\tif (showLastDate)\n\t\t{\n\t\t\tresult.desc = showLastDate;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (user.workPosition)\n\t\t\t{\n\t\t\t\tresult.desc = user.workPosition;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.desc = this.getLocalize('MOBILE_HEADER_MENU_CHAT_TYPE_USER');\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetChatHeaderParams()\n\t{\n\t\tlet dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (!dialog || !dialog.init)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = {\n\t\t\t'name': null,\n\t\t\t'desc': null,\n\t\t\t'avatar': null,\n\t\t\t'color': null,\n\t\t};\n\n\t\tif (dialog.avatar)\n\t\t{\n\t\t\tresult.avatar = dialog.avatar;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.color = dialog.color;\n\t\t}\n\n\t\tif (dialog.entityType === 'GENERAL')\n\t\t{\n\t\t\tresult.avatar = encodeURI(\n\t\t\t\tthis.controller.getHost() + \"/bitrix/mobileapp/mobile/components/bitrix/im.recent/images/avatar_general_x3.png\"\n\t\t\t);\n\t\t}\n\n\t\tresult.name = dialog.name;\n\n\t\tlet chatTypeTitle = this.getLocalize('MOBILE_HEADER_MENU_CHAT_TYPE_CHAT_NEW');\n\t\tif (this.chatShowUserCounter && this.getLocalize()['MOBILE_HEADER_MENU_CHAT_USER_COUNT'])\n\t\t{\n\t\t\tchatTypeTitle = this.getLocalize('MOBILE_HEADER_MENU_CHAT_USER_COUNT').replace('#COUNT#', dialog.userCounter);\n\t\t}\n\t\telse if (this.getLocalize()['MOBILE_HEADER_MENU_CHAT_TYPE_'+dialog.type.toUpperCase()+'_NEW'])\n\t\t{\n\t\t\tchatTypeTitle = this.getLocalize('MOBILE_HEADER_MENU_CHAT_TYPE_'+dialog.type.toUpperCase()+'_NEW');\n\t\t}\n\t\tresult.desc = chatTypeTitle;\n\n\t\treturn result;\n\t}\n\n\tchangeChatKeyboardStatus()\n\t{\n\t\tlet dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (!dialog || !dialog.init)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.show();\n\t\t\treturn true;\n\t\t}\n\n\t\tlet keyboardShow = true;\n\n\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.application.getUserId()))\n\t\t{\n\t\t\tkeyboardShow = false;\n\t\t}\n\n\t\tif (\n\t\t\ttypeof this.keyboardShowFlag !== 'undefined'\n\t\t\t&& (\n\t\t\t\tthis.keyboardShowFlag && keyboardShow\n\t\t\t\t|| !this.keyboardShowFlag && !keyboardShow\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn this.keyboardShowFlag;\n\t\t}\n\n\t\tif (keyboardShow)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.show();\n\t\t\tthis.keyboardShowFlag = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.hide();\n\t\t\tthis.keyboardShowFlag = false;\n\t\t}\n\n\t\treturn this.keyboardShowFlag;\n\t}\n\n\tsetHeaderButtons()\n\t{\n\t\tif (this.callMenuSetted)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tlet dialogData = this.controller.application.getDialogData();\n\t\t\tif (!dialogData.init)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet isAvailableChatCall = Application.getApiVersion() >= 36;\n\t\t\tlet maxParticipants = this.controller.application.getData().call.maxParticipants;\n\t\t\tif (\n\t\t\t\tdialogData.userCounter > maxParticipants\n\t\t\t\t|| !isAvailableChatCall\n\t\t\t\t|| dialogData.entityType === 'VIDEOCONF' && dialogData.entityData1 === 'BROADCAST'\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (dialogData.type !== DialogType.call && dialogData.restrictions.extend)\n\t\t\t\t{\n\t\t\t\t\tapp.exec(\"setRightButtons\", {items:[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: \"user_plus\",\n\t\t\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatAddUserButton\", {});\n\t\t\t\t\t\t\t\tthis.openAddUserDialog()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tapp.exec(\"setRightButtons\", {items: []});\n\t\t\t\t}\n\n\t\t\t\tthis.callMenuSetted = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\t\t\tif (!userData.init)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!userData\n\t\t\t\t|| userData.bot\n\t\t\t\t|| userData.network\n\t\t\t\t|| this.controller.application.getUserId() === parseInt(this.controller.application.getDialogId())\n\t\t\t)\n\t\t\t{\n\t\t\t\tapp.exec(\"setRightButtons\", {items: []});\n\n\t\t\t\tthis.callMenuSetted = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tapp.exec(\"setRightButtons\", {items: [\n\t\t\t{\n\t\t\t\ttype: \"call_audio\",\n\t\t\t\tcallback: () => {\n\t\t\t\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: false,\n\t\t\t\t\t\t\tchatData: this.controller.application.getDialogData()\n\t\t\t\t\t\t}, \"calls\")\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tlet userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tuserId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: false,\n\t\t\t\t\t\t\tuserData: {[userData.id]: userData}\n\t\t\t\t\t\t}, \"calls\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: \"call_video\",\n\t\t\t\tbadgeCode: \"call_video\",\n\t\t\t\tcallback: () =>\n\t\t\t\t{\n\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatCallVideoButton\", {});\n\n\t\t\t\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: true,\n\t\t\t\t\t\t\tchatData: this.controller.application.getDialogData()\n\t\t\t\t\t\t}, \"calls\")\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: true,\n\t\t\t\t\t\t\tuserData: {\n\t\t\t\t\t\t\t\t[this.controller.application.getDialogId()]: this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, \"calls\")\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t]});\n\n\t\tthis.callMenuSetted = true;\n\t\treturn true;\n\t}\n\n\topenUserList(params = {})\n\t{\n\t\tlet {users = false, title = '', listType = 'LIST', backdrop = true} = params;\n\n\t\tlet settings = {\n\t\t\ttitle,\n\t\t\tobjectName: \"ChatUserListInterface\",\n\t\t};\n\t\tif (backdrop)\n\t\t{\n\t\t\tsettings.backdrop = {};\n\t\t}\n\n\t\tapp.exec(\"openComponent\", {\n\t\t\tname: \"JSStackComponent\",\n\t\t\tcomponentCode: 'im.dialog.list',\n\t\t\tscriptPath: \"/mobileapp/jn/im.chat.user.list/?version=\"+BX.componentParameters.get('WIDGET_CHAT_USERS_VERSION', '1.0.0'),\n\t\t\tparams: {\n\t\t\t\t\"DIALOG_ID\": this.controller.application.getDialogId(),\n\t\t\t\t\"DIALOG_OWNER_ID\": this.controller.application.getDialogData().ownerId,\n\t\t\t\t\"USER_ID\": this.controller.application.getUserId(),\n\t\t\t\t\"LIST_TYPE\": listType,\n\t\t\t\t\"USERS\": users,\n\t\t\t\t\"IS_BACKDROP\": true,\n\t\t\t},\n\t\t\trootWidget: {name: \"list\", settings}\n\t\t}, false);\n\t}\n\n\topenCallMenu()\n\t{\n\t\tfabric.Answers.sendCustomEvent(\"vueChatCallAudioButton\", {});\n\n\t\tlet userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\n\t\tif (\n\t\t\tuserData.phones.personalMobile\n\t\t\t|| userData.phones.workPhone\n\t\t\t|| userData.phones.personalPhone\n\t\t\t|| userData.phones.innerPhone\n\t\t)\n\t\t{\n\t\t\tBackdropMenu\n\t\t\t\t.create('im.dialog.menu.call|'+this.controller.application.getDialogId())\n\t\t\t\t.setItems([\n\t\t\t\t\tBackdropMenuItem.create('audio')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_AUDIO_CALL'))\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('personalMobile')\n\t\t\t\t\t\t.setTitle(userData.phones.personalMobile)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_MOBILE'))\n\t\t\t\t\t\t.skip(!userData.phones.personalMobile)\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('workPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.workPhone)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_WORK'))\n\t\t\t\t\t\t.skip(!userData.phones.workPhone)\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('personalPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.personalPhone)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_PHONE'))\n\t\t\t\t\t\t.skip(!userData.phones.personalPhone)\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('innerPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.innerPhone)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_PHONE'))\n\t\t\t\t\t\t.skip(!userData.phones.innerPhone)\n\t\t\t\t\t,\n\t\t\t\t])\n\t\t\t\t.setVersion(BX.componentParameters.get('WIDGET_BACKDROP_MENU_VERSION', '1.0.0'))\n\t\t\t\t.setEventListener((name, params, user, backdrop) =>\n\t\t\t\t{\n\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (params.id === 'audio')\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tuserId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: false,\n\t\t\t\t\t\t\tuserData: {[user.id]: user}\n\t\t\t\t\t\t}, \"calls\");\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'innerPhone')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.MobileTools.phoneTo(user.phones[params.id], {callMethod: 'telephony'});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.MobileTools.phoneTo(user.phones[params.id], {callMethod: 'device'});\n\n\t\t\t\t\t\t// items options\n\t\t\t\t\t\t//.setType(BackdropMenuItemType.menu)\n\t\t\t\t\t\t//.disableClose(BX.MobileTools.canUseTelephony())\n\t\t\t\t\t\t// if (!BX.MobileTools.canUseTelephony())\n\t\t\t\t\t\t// {\n\t\t\t\t\t\t// \tBX.MobileTools.phoneTo(user.phones[params.id], {callMethod: 'device'});\n\t\t\t\t\t\t// \treturn false\n\t\t\t\t\t\t// }\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// let subMenu = BackdropMenu\n\t\t\t\t\t\t// \t.create('im.dialog.menu.call.submenu|'+this.controller.application.getDialogId())\n\t\t\t\t\t\t// \t.setItems([\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('number')\n\t\t\t\t\t\t// \t\t\t.setType(BackdropMenuItemType.info)\n\t\t\t\t\t\t// \t\t\t.setTitle(this.getLocalize(\"MOBILE_MENU_CALL_TO\")\n\t\t\t\t\t\t// \t\t\t.replace('#PHONE_NUMBER#', user.phones[params.id]))\n\t\t\t\t\t\t// \t\t\t.setHeight(50)\n\t\t\t\t\t\t// \t\t\t.setStyles(BackdropMenuStyle.create().setFont(WidgetListItemFont.create().setFontStyle('bold')))\n\t\t\t\t\t\t// \t\t\t.setDisabled(),\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('telephony').setTitle(this.getLocalize(\"MOBILE_CALL_BY_B24\")),\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('device').setTitle(this.getLocalize(\"MOBILE_CALL_BY_MOBILE\")),\n\t\t\t\t\t\t// \t])\n\t\t\t\t\t\t// \t.setEventListener((name, params, options, backdrop) =>\n\t\t\t\t\t\t// \t{\n\t\t\t\t\t\t// \t\tif (name !== 'selected')\n\t\t\t\t\t\t// \t\t{\n\t\t\t\t\t\t// \t\t\treturn false;\n\t\t\t\t\t\t// \t\t}\n\t\t\t\t\t\t// \t\tBX.MobileTools.phoneTo(options.phone, {callMethod: params.id});\n\t\t\t\t\t\t// \t})\n\t\t\t\t\t\t// \t.setCustomParams({phone: user.phones[params.id]})\n\t\t\t\t\t\t// ;\n\t\t\t\t\t\t// backdrop.showSubMenu(subMenu);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.setCustomParams(userData)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\tuserId: this.controller.application.getDialogId(),\n\t\t\t\tvideo: false,\n\t\t\t\tuserData: {[this.controller.application.getDialogId()]: userData}\n\t\t\t}, \"calls\");\n\t\t}\n\t}\n\n\tleaveChat(confirm = false)\n\t{\n\t\tif (!confirm)\n\t\t{\n\t\t\tapp.confirm({\n\t\t\t\ttitle: this.getLocalize('MOBILE_HEADER_MENU_LEAVE_CONFIRM'),\n\t\t\t\ttext: '',\n\t\t\t\tbuttons: [\n\t\t\t\t\tthis.getLocalize('MOBILE_HEADER_MENU_LEAVE_YES'),\n\t\t\t\t\tthis.getLocalize('MOBILE_HEADER_MENU_LEAVE_NO')\n\t\t\t\t],\n\t\t\t\tcallback: (button) =>\n\t\t\t\t{\n\t\t\t\t\tif (button === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.leaveChat(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn true;\n\t\t}\n\n\t\tlet dialogId = this.controller.application.getDialogId();\n\n\t\tthis.controller.restClient.callMethod(RestMethod.imChatLeave, {DIALOG_ID: dialogId}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imChatLeave,\n\t\t\tdialog: this.controller.application.getDialogData(dialogId)\n\t\t})).then(response => {\n\t\t\tapp.closeController();\n\t\t});\n\t}\n\n\topenAddUserDialog()\n\t{\n\t\tlet listUsers = this.getItemsForAddUserDialog();\n\n\t\tapp.exec(\"openComponent\", {\n\t\t\tname: \"JSStackComponent\",\n\t\t\tcomponentCode: \"im.chat.user.selector\",\n\t\t\tscriptPath: \"/mobileapp/jn/im.chat.user.selector/?version=\"+BX.componentParameters.get('WIDGET_CHAT_RECIPIENTS_VERSION', '1.0.0'),\n\t\t\tparams: {\n\t\t\t\t\"DIALOG_ID\": this.controller.application.getDialogId(),\n\t\t\t\t\"USER_ID\": this.controller.application.getUserId(),\n\n\t\t\t\t\"LIST_USERS\": listUsers,\n\t\t\t\t\"LIST_DEPARTMENTS\": [],\n\t\t\t\t\"SKIP_LIST\": [],\n\n\t\t\t\t\"SEARCH_MIN_SIZE\": BX.componentParameters.get('SEARCH_MIN_TOKEN_SIZE', 3),\n\t\t\t},\n\t\t\trootWidget: {\n\t\t\t\tname: \"chat.recipients\",\n\t\t\t\tsettings: {\n\t\t\t\t\tobjectName: \"ChatUserSelectorInterface\",\n\t\t\t\t\ttitle: BX.message('MOBILE_HEADER_MENU_USER_ADD'),\n\t\t\t\t\tlimit: 100,\n\t\t\t\t\titems: listUsers.map(element => ChatDataConverter.getListElementByUser(element)),\n\t\t\t\t\tscopes: [\n\t\t\t\t\t\t{ title: BX.message('MOBILE_SCOPE_USERS'), id: \"user\" },\n\t\t\t\t\t\t{ title: BX.message('MOBILE_SCOPE_DEPARTMENTS'), id: \"department\" }\n\t\t\t\t\t],\n\t\t\t\t\tbackdrop: {showOnTop: true}\n\t\t\t\t}\n\t\t\t}\n\t\t}, false);\n\t}\n\n\tgetItemsForAddUserDialog()\n\t{\n\t\tlet items = [];\n\t\tlet itemsIndex = {};\n\n\t\tif (this.widgetCache.recentList.length > 0)\n\t\t{\n\t\t\tthis.widgetCache.recentList.map(element =>\n\t\t\t{\n\t\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (element.type !== 'user')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (element.user.network || element.user.connector)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\titems.push(element.user);\n\t\t\t\titemsIndex[element.id] = true;\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\n\t\tthis.widgetCache.colleaguesList.map(element =>\n\t\t{\n\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element.network || element.connector)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\titems.push(element);\n\t\t\titemsIndex[element.id] = true;\n\t\t});\n\n\t\tthis.widgetCache.lastSearchList.map(element =>\n\t\t{\n\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element.type !== 'user')\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element.user.network || element.user.connector)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\titems.push(element.user);\n\t\t\titemsIndex[element.id] = true;\n\n\t\t\treturn true;\n\t\t});\n\n\t\t/*\n\t\tlet skipList = ChatMessengerCommon.getChatUsers();\n\t\tif (skipList.indexOf(this.base.userId) === -1)\n\t\t{\n\t\t\tskipList.push(this.base.userId)\n\t\t}\n\t\titems = items.filter((element) => skipList.indexOf(element.id) === -1);\n\t\t*/\n\n\t\treturn items;\n\t};\n\n/* endregion 02. Mobile environment methods */\n\n/* region 02. Push & Pull */\n\n\teventStoreInteraction(data)\n\t{\n\t\tif (data.type === 'dialogues/update' && data.payload && data.payload.fields)\n\t\t{\n\t\t\tif (data.payload.dialogId !== this.controller.application.getDialogId())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof data.payload.fields.name !== 'undefined'\n\t\t\t\t|| typeof data.payload.fields.userCounter !== 'undefined'\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (typeof data.payload.fields.userCounter !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tthis.callMenuSetted = false;\n\t\t\t\t}\n\t\t\t\tthis.redrawHeader();\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof data.payload.fields.counter !== 'undefined'\n\t\t\t\t&& typeof data.payload.dialogId !== 'undefined'\n\t\t\t)\n\t\t\t{\n\t\t\t\tBXMobileApp.Events.postToComponent(\"chatdialog::counter::change\", [{\n\t\t\t\t\tdialogId: data.payload.dialogId,\n\t\t\t\t\tcounter: data.payload.fields.counter,\n\t\t\t\t}, true], 'im.recent');\n\t\t\t}\n\t\t}\n\t\telse if (data.type === 'dialogues/set')\n\t\t{\n\t\t\tdata.payload.forEach((dialog) => {\n\t\t\t\tif (dialog.dialogId !== this.controller.application.getDialogId())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tBXMobileApp.Events.postToComponent(\"chatdialog::counter::change\", [{\n\t\t\t\t\tdialogId: dialog.dialogId,\n\t\t\t\t\tcounter: dialog.counter,\n\t\t\t\t}, true], 'im.recent');\n\t\t\t});\n\t\t}\n\t}\n\n\teventStatusInteraction(data)\n\t{\n\t\tif (data.status === PullClient.PullStatus.Online)\n\t\t{\n\t\t\t// restart background tasks (messages and files) to resend files after we got connection again\n\t\t\tif (this.messagesSet)\n\t\t\t{\n\t\t\t\tBXMobileApp.Events.postToComponent('chatbackground::task::restart', [], 'background');\n\t\t\t\tBXMobileApp.Events.postToComponent('chatuploader::task::restart', [], 'background');\n\t\t\t}\n\n\t\t\tif (this.pullRequestMessage)\n\t\t\t{\n\t\t\t\tthis.controller.pullBaseHandler.option.skip = true;\n\n\t\t\t\tthis.getDialogUnread().then(() => {\n\t\t\t\t\tthis.controller.pullBaseHandler.option.skip = false;\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.readVisibleMessages, {chatId: this.controller.application.getChatId()});\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollOnStart, {chatId: this.controller.application.getChatId()});\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.controller.pullBaseHandler.option.skip = false;\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t});\n\n\t\t\t\tthis.pullRequestMessage = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.readMessage();\n\t\t\t\tthis.processSendMessages();\n\t\t\t}\n\t\t}\n\t\telse if (data.status === PullClient.PullStatus.Offline)\n\t\t{\n\t\t\tthis.pullRequestMessage = true;\n\t\t}\n\t}\n\n\teventOnlineInteraction(data)\n\t{\n\t\tif (data.command === 'list' || data.command === 'userStatus')\n\t\t{\n\t\t\tfor (let userId in data.params.users)\n\t\t\t{\n\t\t\t\tif (!data.params.users.hasOwnProperty(userId))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.controller.getStore().dispatch('users/update', {\n\t\t\t\t\tid: data.params.users[userId].id,\n\t\t\t\t\tfields: data.params.users[userId]\n\t\t\t\t});\n\n\t\t\t\tif (userId.toString() === this.controller.application.getDialogId())\n\t\t\t\t{\n\t\t\t\t\tthis.redrawHeader();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n/* endregion 02. Push & Pull */\n\n\tgetKeyboardParams()\n\t{\n\t\tlet dialogData = this.controller.application.getDialogData();\n\n\t\tlet siteDir = this.getLocalize('SITE_DIR');\n\n\t\treturn {\n\t\t\ttext: dialogData? dialogData.textareaMessage: '',\n\t\t\tplaceholder: this.getLocalize('MOBILE_CHAT_PANEL_PLACEHOLDER'),\n\t\t\tsmileButton: {},\n\t\t\tuseImageButton:true,\n\t\t\tuseAudioMessages: true,\n\t\t\tmentionDataSource:\n\t\t\t{\n\t\t\t\toutsection: \"NO\",\n\t\t\t\turl: siteDir + \"mobile/index.php?mobile_action=get_user_list&use_name_format=Y&with_bots\"\n\t\t\t},\n\t\t\tattachFileSettings:\n\t\t\t{\n\t\t\t\tpreviewMaxWidth: 640,\n\t\t\t\tpreviewMaxHeight: 640,\n\t\t\t\tresize:\n\t\t\t\t{\n\t\t\t\t\ttargetWidth: -1,\n\t\t\t\t\ttargetHeight: -1,\n\t\t\t\t\tsourceType: 1,\n\t\t\t\t\tencodingType: 0,\n\t\t\t\t\tmediaType: 2,\n\t\t\t\t\tallowsEdit: false,\n\t\t\t\t\tsaveToPhotoAlbum: true,\n\t\t\t\t\tpopoverOptions: false,\n\t\t\t\t\tcameraDirection: 0,\n\t\t\t\t},\n\t\t\t\tsendFileSeparately: true,\n\t\t\t\tshowAttachedFiles: true,\n\t\t\t\teditingMediaFiles:false,\n\t\t\t\tmaxAttachedFilesCount: 100\n\t\t\t},\n\t\t\tattachButton: {items:\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tid:\"disk\",\n\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_DISK\"),\n\t\t\t\t\tdataSource:\n\t\t\t\t\t{\n\t\t\t\t\t\tmultiple:false,\n\t\t\t\t\t\turl: siteDir + \"mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId=\"+this.controller.application.getUserId(),\n\t\t\t\t\t\tTABLE_SETTINGS:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsearchField: true,\n\t\t\t\t\t\t\tshowtitle: true,\n\t\t\t\t\t\t\tmodal: true,\n\t\t\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_DISK_FILES\")\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"mediateka\",\n\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_GALLERY\")\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"camera\",\n\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_CAMERA\")\n\t\t\t\t}\n\t\t\t]},\n\t\t\taction: (data) =>\n\t\t\t{\n\t\t\t\tif (typeof data === \"string\")\n\t\t\t\t{\n\t\t\t\t\tdata = {text: data, attachedFiles: []};\n\t\t\t\t}\n\n\t\t\t\tconst text = data.text.toString().trim();\n\t\t\t\tconst attachedFiles = data.attachedFiles instanceof Array? data.attachedFiles: [];\n\n\t\t\t\tif (attachedFiles.length <= 0)\n\t\t\t\t{\n\t\t\t\t\tthis.clearText();\n\t\t\t\t\tthis.hideSmiles();\n\n\t\t\t\t\tlet editId = this.controller.getStore().getters['dialogues/getEditId'](this.controller.application.getDialogId());\n\t\t\t\t\tif (editId)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateMessage(editId, text);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.addMessage(text);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tattachedFiles.forEach(file => {\n\t\t\t\t\t\t// disk\n\t\t\t\t\t\tif (typeof file.dataAttributes !== 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileDisk\", {});\n\n\t\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\t\tsource: 'disk',\n\t\t\t\t\t\t\t\tname: file.name,\n\t\t\t\t\t\t\t\ttype: file.type.toString().toLowerCase(),\n\t\t\t\t\t\t\t\tpreview: !file.dataAttributes.URL || !file.dataAttributes.URL.PREVIEW? null: {\n\t\t\t\t\t\t\t\t\turl: file.dataAttributes.URL.PREVIEW,\n\t\t\t\t\t\t\t\t\twidth: file.dataAttributes.URL.PREVIEW.match(/(width=(\\d+))/i)[2],\n\t\t\t\t\t\t\t\t\theight: file.dataAttributes.URL.PREVIEW.match(/(height=(\\d+))/i)[2]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuploadLink: parseInt(file.dataAttributes.ID),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// audio\n\t\t\t\t\t\tif (file.type === 'audio/mp4')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileAudio\", {});\n\n\t\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\t\tsource: 'audio',\n\t\t\t\t\t\t\t\tname: 'mobile_audio_'+(new Date).toJSON().slice(0, 19).replace('T', '_').split(':').join('-')+'.mp3',\n\t\t\t\t\t\t\t\ttype: 'mp3',\n\t\t\t\t\t\t\t\tpreview: null,\n\t\t\t\t\t\t\t\tuploadLink: file.url,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet filename = file.name;\n\t\t\t\t\t\tlet fileType = FilesModel.getType(file.name);\n\n\t\t\t\t\t\tif (fileType === FileType.video)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileVideo\", {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (fileType === FileType.image)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileImage\", {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileOther\", {});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tfileType === FileType.image\n\t\t\t\t\t\t\t|| fileType === FileType.video\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet extension = file.name.split('.').slice(-1)[0].toLowerCase();\n\t\t\t\t\t\t\tif (file.type === 'image/heic')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\textension = 'jpg';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfilename = 'mobile_file_'+(new Date).toJSON().slice(0, 19).replace('T', '_').split(':').join('-')+'.'+extension;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// file\n\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\tsource: 'gallery',\n\t\t\t\t\t\t\tname: filename,\n\t\t\t\t\t\t\ttype: file.type.toString().toLowerCase(),\n\t\t\t\t\t\t\tpreview: !file.previewUrl? null: {\n\t\t\t\t\t\t\t\turl: file.previewUrl,\n\t\t\t\t\t\t\t\twidth: file.previewWidth,\n\t\t\t\t\t\t\t\theight: file.previewHeight\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tuploadLink: file.url,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tcallback: (data) =>\n\t\t\t{\n\t\t\t\tconsole.log('Textpanel callback', data);\n\t\t\t\tif (!data.event)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (data.event === \"onKeyPress\")\n\t\t\t\t{\n\t\t\t\t\tlet text = data.text.toString();\n\t\t\t\t\tif (text.trim().length > 2)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controller.application.startWriting();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (text.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTextareaMessage({message: ''});\n\t\t\t\t\t\tthis.controller.application.stopWriting();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTextareaMessage({message: text});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (data.event === \"onSmileSelect\")\n\t\t\t\t{\n\t\t\t\t\tthis.controller.showSmiles();\n\t\t\t\t}\n\t\t\t\telse if (Application.getPlatform() !== \"android\")\n\t\t\t\t{\n\t\t\t\t\tif (data.event === \"getFocus\")\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Utils.platform.isIos() && Utils.platform.getIosVersion() > 12)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.controller.application.getChatId(), duration: 300, cancelIfScrollChange: true})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (data.event === \"removeFocus\")\n\t\t\t\t\t{\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n/* region 04. Rest methods */\n\n\taddMessage(text, file = null, messageTempId = null)\n\t{\n\t\tif (!text && !file)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet quoteId = this.controller.getStore().getters['dialogues/getQuoteId'](this.controller.application.getDialogId());\n\t\tif (quoteId)\n\t\t{\n\t\t\tlet quoteMessage = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), quoteId);\n\t\t\tif (quoteMessage)\n\t\t\t{\n\t\t\t\tlet user = null;\n\t\t\t\tif (quoteMessage.authorId)\n\t\t\t\t{\n\t\t\t\t\tuser = this.controller.getStore().getters['users/get'](quoteMessage.authorId);\n\t\t\t\t}\n\n\t\t\t\tlet files = this.controller.getStore().getters['files/getList'](this.controller.application.getChatId());\n\n\t\t\t\tlet message = [];\n\t\t\t\tmessage.push('-'.repeat(54));\n\t\t\t\tmessage.push((user && user.name? user.name: this.getLocalize('MOBILE_CHAT_SYSTEM_MESSAGE'))+' ['+Utils.date.format(quoteMessage.date, null, this.getLocalize())+']');\n\t\t\t\tmessage.push(Utils.text.quote(quoteMessage.text, quoteMessage.params, files, this.getLocalize()));\n\t\t\t\tmessage.push('-'.repeat(54));\n\t\t\t\tmessage.push(text);\n\t\t\t\ttext = message.join(\"\\n\");\n\n\t\t\t\tthis.quoteMessageClear();\n\t\t\t}\n\t\t}\n\n\t\tconsole.warn('addMessage', text, file, messageTempId);\n\n\t\t// if messageTempId exists, then it is a temporary message and we don't need to send the message, only render.\n\t\tconst isUnsentMessage = !!messageTempId;\n\t\tif (!messageTempId)\n\t\t{\n\t\t\tmessageTempId = ChatUtils.getUuidv4();\n\t\t}\n\n\t\tif (!this.controller.application.isUnreadMessagesLoaded())\n\t\t{\n\t\t\tif (!isUnsentMessage)\n\t\t\t{\n\t\t\t\tthis.sendMessage({\n\t\t\t\t\tid: 0,\n\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\ttext,\n\t\t\t\t\tfile\n\t\t\t\t});\n\t\t\t\tthis.processSendMessages();\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.controller.getStore().commit('application/increaseDialogExtraCount');\n\n\t\tlet params = {};\n\t\tif (file)\n\t\t{\n\t\t\tparams.FILE_ID = [file.id];\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('messages/add', {\n\t\t\tid: messageTempId,\n\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\tauthorId: this.controller.application.getUserId(),\n\t\t\ttext: text,\n\t\t\tparams,\n\t\t\tsending: !file,\n\t\t}).then(messageId => {\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.controller.application.getChatId(), cancelIfScrollChange: true});\n\n\t\t\tthis.messagesQueue.push({\n\t\t\t\tid: messageId,\n\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\ttext,\n\t\t\t\tfile,\n\t\t\t\tsending: isUnsentMessage\n\t\t\t});\n\t\t\tif (isUnsentMessage)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.controller.application.getChatId())\n\t\t\t{\n\t\t\t\tthis.processSendMessages();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.requestData();\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tuploadFile(file, text = '')\n\t{\n\t\tif (!file)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconsole.warn('addFile', file, text);\n\n\t\tif (!this.controller.application.isUnreadMessagesLoaded())\n\t\t{\n\t\t\tif (!file.id)\n\t\t\t{\n\t\t\t\tthis.addMessage(text, {id: 0, source: file}, file.messageTempId);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tif (!file.id)\n\t\t{\n\t\t\tfile.id = ChatUtils.getUuidv4();\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('files/add', this.controller.application.prepareFilesBeforeSave({\n\t\t\tid: file.id,\n\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\tauthorId: this.controller.application.getUserId(),\n\t\t\tname: file.name,\n\t\t\ttype: FilesModel.getType(file.name),\n\t\t\textension: file.name.split('.').splice(-1)[0],\n\t\t\tsize: 0,\n\t\t\timage: !file.preview? false: {\n\t\t\t\twidth: file.preview.width,\n\t\t\t\theight: file.preview.height,\n\t\t\t},\n\t\t\tstatus: file.source === 'disk'? FileStatus.wait: FileStatus.upload,\n\t\t\tprogress: 0,\n\t\t\tauthorName: this.controller.application.getCurrentUser().name,\n\t\t\turlPreview: !file.preview? '': file.preview.url,\n\t\t})).then(fileId => this.addMessage(text, {id: fileId, ...file}, file.messageTempId));\n\n\t\treturn true;\n\t}\n\n\tcancelUploadFile(fileId)\n\t{\n\t\tlet element = this.messagesQueue.find(element => element.file && element.file.id === fileId);\n\t\tif (element)\n\t\t{\n\t\t\tBX.MobileUploadProvider.cancelTasks(['imDialogFileUpload|'+fileId]);\n\n\t\t\tthis.controller.getStore().dispatch('messages/delete', {\n\t\t\t\tchatId: element.chatId,\n\t\t\t\tid: element.id,\n\t\t\t}).then(() => {\n\t\t\t\tthis.controller.getStore().dispatch('files/delete', {\n\t\t\t\t\tchatId: element.chatId,\n\t\t\t\t\tid: element.file.id,\n\t\t\t\t});\n\t\t\t\tthis.messagesQueue = this.messagesQueue.filter(el => el.id !== element.id);\n\t\t\t});\n\t\t}\n\t}\n\n\tretryUploadFile(fileId)\n\t{\n\t\tlet element = this.messagesQueue.find(element => element.file && element.file.id === fileId);\n\t\tif (!element)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('messages/actionStart', {\n\t\t\tchatId: element.chatId,\n\t\t\tid: element.id\n\t\t}).then(() => {\n\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\tchatId: element.chatId,\n\t\t\t\tid: element.file.id,\n\t\t\t\tfields: {\n\t\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\t\tprogress: 0\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\telement.sending = false;\n\t\tthis.processSendMessages();\n\n\t\treturn true;\n\t}\n\n\tprocessSendMessages()\n\t{\n\t\tthis.messagesQueue.filter(element => !element.sending).forEach(element =>\n\t\t{\n\t\t\telement.sending = true;\n\n\t\t\tif (element.file)\n\t\t\t{\n\t\t\t\tif (element.file.source === 'disk')\n\t\t\t\t{\n\t\t\t\t\tthis.fileCommit({\n\t\t\t\t\t\tchatId: element.chatId,\n\t\t\t\t\t\tdialogId: element.dialogId,\n\t\t\t\t\t\tdiskId: element.file.uploadLink,\n\t\t\t\t\t\tmessageText: element.text,\n\t\t\t\t\t\tmessageId: element.id,\n\t\t\t\t\t\tfileId: element.file.id,\n\t\t\t\t\t\tfileType: FilesModel.getType(element.file.name),\n\t\t\t\t\t}, element);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.controller.application.getDiskFolderId())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.sendMessageWithFile(element);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\telement.sending = false;\n\t\t\t\t\t\tthis.requestDiskFolderId();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\telement.sending = true;\n\t\t\t\tthis.sendMessage(element);\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tprocessMarkReadMessages()\n\t{\n\t\tthis.controller.application.readMessageExecute(this.controller.application.getChatId(), true);\n\t\treturn true;\n\t}\n\n\tsendMessage(message)\n\t{\n\t\tmessage.text = message.text.replace(/^([-]{21}\\n)/gm, '-'.repeat(54)+'\\n');\n\n\t\tthis.controller.application.stopWriting(message.dialogId);\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::add', [\n\t\t\t'sendMessage|'+message.id,\n\t\t\t[RestMethod.imMessageAdd, {\n\t\t\t\t'TEMPLATE_ID': message.id,\n\t\t\t\t'DIALOG_ID': message.dialogId,\n\t\t\t\t'MESSAGE': message.text\n\t\t\t}],\n\t\t\tmessage\n\t\t], 'background');\n\t}\n\n\tsendMessageWithFile(message)\n\t{\n\t\tlet fileType = FilesModel.getType(message.file.name);\n\t\tlet fileExtension = message.file.name.toString().toLowerCase().split('.').splice(-1)[0];\n\t\tlet attachPreviewFile = fileType !== FileType.image && message.file.preview;\n\t\tlet needConvert = fileType === FileType.image && message.file.type !== 'image/gif' || fileType === FileType.video;\n\n\t\tBX.MobileUploadProvider.addTasks([{\n\t\t\turl: message.file.uploadLink,\n\t\t\tparams: message,\n\t\t\tname: message.file.name,\n\t\t\ttype: fileExtension,\n\t\t\tmimeType: fileType === FileType.audio? 'audio/mp4': null,\n\t\t\tresize: !needConvert? null: {\n\t\t\t\t\"quality\":80,\n\t\t\t\t\"width\":1920,\n\t\t\t\t\"height\":1080,\n\t\t\t},\n\t\t\tpreviewUrl: attachPreviewFile? message.file.preview.url: '',\n\t\t\tfolderId: this.controller.application.getDiskFolderId(),\n\t\t\ttaskId: 'imDialogFileUpload|'+message.file.id,\n\t\t\tonDestroyEventName: 'onimdiskmessageaddsuccess'\n\t\t}]);\n\t}\n\n\tfileError(chatId, fileId, messageId = 0)\n\t{\n\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\tchatId: chatId,\n\t\t\tid: fileId,\n\t\t\tfields: {\n\t\t\t\tstatus: FileStatus.error,\n\t\t\t\tprogress: 0\n\t\t\t}\n\t\t});\n\t\tif (messageId)\n\t\t{\n\t\t\tthis.controller.getStore().dispatch('messages/actionError', {\n\t\t\t\tchatId: chatId,\n\t\t\t\tid: messageId,\n\t\t\t\tretry: true,\n\t\t\t});\n\t\t}\n\t}\n\n\tfileCommit(params, message)\n\t{\n\t\tconst queryParams = {\n\t\t\tchat_id: params.chatId,\n\t\t\tmessage: params.messageText,\n\t\t\ttemplate_id: params.messageId? params.messageId: 0,\n\t\t\tfile_template_id: params.fileId? params.fileId: 0,\n\t\t};\n\t\tif (params.uploadId)\n\t\t{\n\t\t\tqueryParams.upload_id = params.uploadId;\n\t\t}\n\t\telse if (params.diskId)\n\t\t{\n\t\t\tqueryParams.disk_id = params.diskId;\n\t\t}\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::add', [\n\t\t\t'uploadFileFromDisk|'+message.id,\n\t\t\t[RestMethod.imDiskFileCommit, queryParams],\n\t\t\tmessage\n\t\t], 'background');\n\t}\n\n\trequestDiskFolderId()\n\t{\n\t\tif (this.flagRequestDiskFolderIdSended || this.controller.application.getDiskFolderId())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.flagRequestDiskFolderIdSended = true;\n\n\t\tthis.controller.restClient.callMethod(RestMethod.imDiskFolderGet, {chat_id: this.controller.application.getChatId()}).then(response => {\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDiskFolderGet, response);\n\t\t\tthis.flagRequestDiskFolderIdSended = false;\n\t\t\tthis.processSendMessages();\n\t\t}).catch(error => {\n\t\t\tthis.flagRequestDiskFolderIdSended = false;\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDiskFolderGet, error);\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tgetDialogHistory(lastId, limit = this.controller.application.getRequestMessageLimit())\n\t{\n\t\tthis.controller.restClient.callMethod(RestMethod.imDialogMessagesGet, {\n\t\t\t'CHAT_ID': this.controller.application.getChatId(),\n\t\t\t'LAST_ID': lastId,\n\t\t\t'LIMIT': limit,\n\t\t\t'CONVERT_TEXT': 'Y'\n\t\t}).then(result => {\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDialogMessagesGet, result);\n\t\t\t// this.controller.application.emit(EventType.dialog.requestHistoryResult, {count: result.data().messages.length});\n\t\t}).catch(result => {\n\t\t\t// this.controller.emit(EventType.dialog.requestHistoryResult, {error: result.error().ex});\n\t\t});\n\t}\n\n\tgetDialogUnread(lastId, limit = this.controller.application.getRequestMessageLimit())\n\t{\n\t\tif (this.promiseGetDialogUnreadWait)\n\t\t{\n\t\t\treturn this.promiseGetDialogUnread;\n\t\t}\n\n\t\tthis.promiseGetDialogUnread = new BX.Promise();\n\t\tthis.promiseGetDialogUnreadWait = true;\n\n\t\tif (!lastId)\n\t\t{\n\t\t\tlastId = this.controller.getStore().getters['messages/getLastId'](this.controller.application.getChatId());\n\t\t}\n\n\t\tif (!lastId)\n\t\t{\n\t\t\t// this.controller.application.emit(EventType.dialog.requestUnreadResult, {error: {error: 'LAST_ID_EMPTY', error_description: 'LastId is empty.'}});\n\n\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\treturn this.promiseGetDialogUnread;\n\t\t}\n\n\t\tthis.controller.application.readMessage(lastId, true, true).then(() =>\n\t\t{\n\t\t\tthis.timer.start('data', 'load', .5, () => {\n\t\t\t\tconsole.warn(\"ChatDialog.requestData: slow connection show progress icon\");\n\t\t\t\tapp.titleAction(\"setParams\", {useProgress: true, useLetterImage: false});\n\t\t\t});\n\n\t\t\tlet query = {\n\t\t\t\t[RestMethodHandler.imDialogRead]: [RestMethod.imDialogRead, {\n\t\t\t\t\tdialog_id: this.controller.application.getDialogId(),\n\t\t\t\t\tmessage_id: lastId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {\n\t\t\t\t\tdialog_id: this.controller.application.getDialogId()\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetUnread]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tchat_id: this.controller.application.getChatId(),\n\t\t\t\t\tfirst_id: lastId,\n\t\t\t\t\tlimit: limit,\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}]\n\t\t\t};\n\n\t\t\tthis.controller.restClient.callBatch(query, (response) =>\n\t\t\t{\n\t\t\t\tif (!response)\n\t\t\t\t{\n\t\t\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tlet chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\t\tif (!chatGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\t\t\t\t}\n\n\t\t\t\tlet dialogMessageUnread = response[RestMethodHandler.imDialogMessagesGetUnread];\n\t\t\t\tif (!dialogMessageUnread.error())\n\t\t\t\t{\n\t\t\t\t\tdialogMessageUnread = dialogMessageUnread.data();\n\t\t\t\t\tthis.controller.getStore().dispatch('users/set', dialogMessageUnread.users);\n\t\t\t\t\tthis.controller.getStore().dispatch('files/set', this.controller.application.prepareFilesBeforeSave(dialogMessageUnread.files));\n\t\t\t\t\tthis.controller.getStore().dispatch('messages/setAfter', dialogMessageUnread.messages).then(() => {\n\t\t\t\t\t\tapp.titleAction(\"setParams\", { useProgress: false, useLetterImage: true });\n\t\t\t\t\t\tthis.timer.stop('data', 'load', true);\n\n\t\t\t\t\t\tthis.promiseGetDialogUnread.fulfill(response);\n\t\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t}, false, false, Utils.getLogTrackingParams({name: RestMethodHandler.imDialogMessagesGetUnread, dialog: this.controller.application.getDialogData()}));\n\t\t});\n\n\t\treturn this.promiseGetDialogUnread;\n\t}\n\n\tretrySendMessage(message)\n\t{\n\t\tlet element = this.messagesQueue.find(el => el.id === message.id);\n\t\tif (element)\n\t\t{\n\t\t\tif (element.file && element.file.id)\n\t\t\t{\n\t\t\t\tthis.retryUploadFile(element.file.id)\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.messagesQueue.push({\n\t\t\tid: message.id,\n\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\ttext: message.text,\n\t\t\tsending: false\n\t\t});\n\n\t\tthis.controller.application.setSendingMessageFlag(message.id);\n\n\t\tthis.processSendMessages();\n\t}\n\n\topenProfile(userId)\n\t{\n\t\tBXMobileApp.Events.postToComponent(\"onUserProfileOpen\", [userId, {backdrop: true}], 'communication');\n\t}\n\n\topenDialog(dialogId)\n\t{\n\t\tBXMobileApp.Events.postToComponent(\"onOpenDialog\", [{dialogId}, true], 'im.recent');\n\t}\n\n\topenPhoneMenu(number)\n\t{\n\t\tBX.MobileTools.phoneTo(number);\n\t}\n\n\topenMessageMenu(message)\n\t{\n\t\tif (this.messagesQueue.find(el => el.id === message.id))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('messages/update', {\n\t\t\tid: message.id,\n\t\t\tchatId: message.chatId,\n\t\t\tfields: {\n\t\t\t\tblink: true\n\t\t\t}\n\t\t});\n\n\t\tlet currentUser = this.controller.application.getCurrentUser();\n\t\tlet dialog = this.controller.application.getDialogData();\n\t\tlet messageUser = message.authorId > 0? this.controller.getStore().getters['users/get'](message.authorId, true): null;\n\n\t\tthis.messageMenuInstance = BackdropMenu\n\t\t\t.create('im.dialog.menu.mess|'+this.controller.application.getDialogId())\n\t\t\t.setItems([\n\t\t\t\tBackdropMenuItem.create('reply')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_REPLY'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.reply)\n\t\t\t\t\t.skip((message) => {\n\t\t\t\t\t\tlet dialog = this.controller.application.getDialogData();\n\t\t\t\t\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.application.getUserId()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn !message.authorId || message.authorId === this.controller.application.getUserId()\n\t\t\t\t\t})\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('copy')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_COPY'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.copy)\n\t\t\t\t\t.skip((message) => message.params.IS_DELETED === 'Y')\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('quote')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_QUOTE'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.quote)\n\t\t\t\t\t.skip((message) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tlet dialog = this.controller.application.getDialogData();\n\t\t\t\t\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.application.getUserId()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn message.params.IS_DELETED === 'Y';\n\t\t\t\t\t})\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('unread')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_UNREAD'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.unread)\n\t\t\t\t\t.skip((message) => message.authorId === this.controller.application.getUserId() || message.unread)\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('read')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_READ'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.checked)\n\t\t\t\t\t.skip((message) => !message.unread)\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('edit')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_EDIT'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.edit)\n\t\t\t\t\t.skip((message) => message.authorId !== this.controller.application.getUserId() || message.params.IS_DELETED === 'Y')\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('share')\n\t\t\t\t\t.setType(BackdropMenuItemType.menu)\n\t\t\t\t\t.setIcon(BackdropMenuIcon.circle_plus)\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_MENU'))\n\t\t\t\t\t.disableClose()\n\t\t\t\t\t.skip(currentUser.extranet || dialog.type === 'announcement')\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('profile')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_PROFILE'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.user)\n\t\t\t\t\t.skip((message) => {\n\n\t\t\t\t\t\tif (message.authorId <= 0 || !messageUser)\n\t\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t\tif (message.authorId === this.controller.application.getUserId())\n\t\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tmessageUser.externalAuthId === 'imconnector'\n\t\t\t\t\t\t\t|| messageUser.externalAuthId === 'call'\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn  false;\n\t\t\t\t\t})\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('delete')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_DELETE'))\n\t\t\t\t\t.setStyles(BackdropMenuStyle.create().setFont(WidgetListItemFont.create().setColor('#c50000')))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.trash)\n\t\t\t\t\t.skip((message) => message.authorId !== this.controller.application.getUserId() || message.params.IS_DELETED === 'Y')\n\t\t\t\t,\n\t\t\t])\n\t\t\t.setVersion(BX.componentParameters.get('WIDGET_BACKDROP_MENU_VERSION', '1.0.0'))\n\t\t\t.setEventListener((name, params, message, backdrop) => {\n\t\t\t\tif (name === 'destroyed')\n\t\t\t\t{\n\t\t\t\t\tVue.event.$emit('bitrixmobile:controller:focus');\n\t\t\t\t}\n\n\t\t\t\tif (name !== 'selected')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (params.id === 'reply')\n\t\t\t\t{\n\t\t\t\t\tthis.replyToUser(message.authorId);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'copy')\n\t\t\t\t{\n\t\t\t\t\tthis.copyMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'quote')\n\t\t\t\t{\n\t\t\t\t\tthis.quoteMessageClear();\n\t\t\t\t\tthis.quoteMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'edit')\n\t\t\t\t{\n\t\t\t\t\tthis.quoteMessageClear();\n\t\t\t\t\tthis.editMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'delete')\n\t\t\t\t{\n\t\t\t\t\tthis.deleteMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'unread')\n\t\t\t\t{\n\t\t\t\t\tthis.unreadMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'read')\n\t\t\t\t{\n\t\t\t\t\tthis.readMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'share')\n\t\t\t\t{\n\t\t\t\t\tlet dialog = this.controller.application.getDialogData();\n\t\t\t\t\tlet subMenu = BackdropMenu\n\t\t\t\t\t\t.create('im.dialog.menu.mess.submenu|'+this.controller.application.getDialogId())\n\t\t\t\t\t\t.setItems([\n\t\t\t\t\t\t\tBackdropMenuItem.create('share_task')\n\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.task)\n\t\t\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_TASK'))\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t\tBackdropMenuItem.create('share_post')\n\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.lifefeed)\n\t\t\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_POST_NEWS'))\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t\tBackdropMenuItem.create('share_chat')\n\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.chat)\n\t\t\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_CHAT'))\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t])\n\t\t\t\t\t\t.setEventListener((name, params, options, backdrop) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\tif (params.id === 'share_task')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'TASK');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (params.id === 'share_post')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'POST');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (params.id === 'share_chat')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'CHAT');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t\tbackdrop.showSubMenu(subMenu);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'profile')\n\t\t\t\t{\n\t\t\t\t\tthis.openProfile(message.authorId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.warn('BackdropMenuItem is not implemented', params);\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\tthis.messageMenuInstance.setCustomParams(message).show();\n\n\t\tfabric.Answers.sendCustomEvent(\"vueChatOpenDropdown\", {});\n\t}\n\n\topenHeaderMenu()\n\t{\n\t\tfabric.Answers.sendCustomEvent(\"vueChatOpenHeaderMenu\", {});\n\n\t\tif (!this.headerMenu)\n\t\t{\n\t\t\tthis.headerMenu = HeaderMenu.create()\n\t\t\t\t.setUseNavigationBarColor()\n\t\t\t\t.setEventListener((name, params, customParams) => {\n\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (params.id === 'profile')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openProfile(this.controller.application.getDialogId());\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'user_list')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openUserList({listType: 'USERS', title: this.getLocalize('MOBILE_HEADER_MENU_USER_LIST'), backdrop: true});\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'user_add')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openAddUserDialog();\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'leave')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.leaveChat();\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'notify')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controller.application.muteDialog();\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'call_chat_call')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.MobileTools.phoneTo(this.controller.application.getDialogData().entityId);\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'goto_crm')\n\t\t\t\t\t{\n\t\t\t\t\t\tlet crmData = this.controller.application.getDialogCrmData();\n\t\t\t\t\t\tlet openWidget = BX.MobileTools.resolveOpenFunction('/crm/'+crmData.entityType+'/show/'+crmData.entityId+'/');\n\t\t\t\t\t\tif (openWidget)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\topenWidget();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'reload')\n\t\t\t\t\t{\n\t\t\t\t\t\t(new BXMobileApp.UI.NotificationBar({\n\t\t\t\t\t\t\tmessage: this.getLocalize('MOBILE_HEADER_MENU_RELOAD_WAIT'),\n\t\t\t\t\t\t\tcolor: \"#d920b0ff\",\n\t\t\t\t\t\t\ttextColor: \"#ffffff\",\n\t\t\t\t\t\t\tgroupId: \"refresh\",\n\t\t\t\t\t\t\tuseLoader: true,\n\t\t\t\t\t\t\tmaxLines: 1,\n\t\t\t\t\t\t\talign: \"center\",\n\t\t\t\t\t\t\thideOnTap: true\n\t\t\t\t\t\t}, \"copy\")).show();\n\n\t\t\t\t\t\tthis.controller.getStoreBuilder().clearDatabase();\n\n\t\t\t\t\t\treload();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\n\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tlet dialogData = this.controller.application.getDialogData();\n\t\t\tlet notifyToggleText = !this.controller.application.isDialogMuted()? this.getLocalize('MOBILE_HEADER_MENU_NOTIFY_DISABLE'): this.getLocalize('MOBILE_HEADER_MENU_NOTIFY_ENABLE');\n\t\t\tlet notifyToggleIcon = !this.controller.application.isDialogMuted()? HeaderMenuIcon.notify: HeaderMenuIcon.notify_off;\n\n\t\t\tlet gotoCrmLocalize = '';\n\t\t\tif (\n\t\t\t\tdialogData.type === DialogType.call\n\t\t\t\t|| dialogData.type === DialogType.crm\n\t\t\t)\n\t\t\t{\n\t\t\t\tlet crmData = this.controller.application.getDialogCrmData();\n\t\t\t\tif (crmData.enabled)\n\t\t\t\t{\n\t\t\t\t\tif (crmData.entityType === DialogCrmType.lead)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_LEAD');\n\t\t\t\t\t}\n\t\t\t\t\telse if (crmData.entityType === DialogCrmType.company)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_COMPANY');\n\t\t\t\t\t}\n\t\t\t\t\telse if (crmData.entityType === DialogCrmType.contact)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_CONTACT');\n\t\t\t\t\t}\n\t\t\t\t\telse if (crmData.entityType === DialogCrmType.deal)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_DEAL');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (dialogData.type === DialogType.call)\n\t\t\t{\n\t\t\t\tthis.headerMenu.setItems([\n\t\t\t\t\tHeaderMenuItem.create('call_chat_call')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_AUDIO_CALL'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.phone)\n\t\t\t\t\t\t.skip(dialogData.entityId === 'UNIFY_CALL_CHAT')\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('goto_crm')\n\t\t\t\t\t\t.setTitle(gotoCrmLocalize)\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.lifefeed)\n\t\t\t\t\t\t.skip(dialogData.entityId === 'UNIFY_CALL_CHAT' || !gotoCrmLocalize)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.reload)\n\t\t\t\t\t,\n\t\t\t\t]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet items = [\n\t\t\t\t\tHeaderMenuItem.create('notify')\n\t\t\t\t\t\t.setTitle(notifyToggleText)\n\t\t\t\t\t\t.setIcon(notifyToggleIcon)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('user_list')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_USER_LIST'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.user)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('user_add')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_USER_ADD'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.user_plus)\n\t\t\t\t\t\t.skip(!dialogData.restrictions.extend)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('leave')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_LEAVE'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.cross)\n\t\t\t\t\t\t.skip(!dialogData.restrictions.leave)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.reload)\n\t\t\t\t\t,\n\t\t\t\t];\n\n\t\t\t\titems.push(HeaderMenuItem.create('reload')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t.setIcon(HeaderMenuIcon.reload));\n\n\t\t\t\tif (\n\t\t\t\t\tdialogData.type === DialogType.crm\n\t\t\t\t\t&& gotoCrmLocalize\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\titems.unshift(HeaderMenuItem.create('goto_crm')\n\t\t\t\t\t\t.setTitle(gotoCrmLocalize)\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.lifefeed)\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis.headerMenu.setItems(items);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.headerMenu.setItems([\n\t\t\t\tHeaderMenuItem.create('profile')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_PROFILE'))\n\t\t\t\t\t.setIcon('user')\n\t\t\t\t\t.skip(Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t,\n\t\t\t\tHeaderMenuItem.create('user_add')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_USER_ADD'))\n\t\t\t\t\t.setIcon(HeaderMenuIcon.user_plus)\n\t\t\t\t,\n\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t.setIcon(HeaderMenuIcon.reload)\n\t\t\t\t,\n\t\t\t]);\n\t\t}\n\n\t\tthis.headerMenu.show(true);\n\t}\n\n\tshareMessage(messageId, type)\n\t{\n\t\tif (!this.controller.isOnline())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.controller.application.shareMessage(messageId, type);\n\t}\n\n\treadMessage(messageId)\n\t{\n\t\t// if (this.controller.isOnline())\n\t\t// {\n\t\t// \treturn false;\n\t\t// }\n\n\t\tthis.controller.application.readMessage(messageId, true, true).then((result) =>\n\t\t{\n\t\t\tif (result.lastId <= 0)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tBXMobileApp.Events.postToComponent('chatbackground::task::action', [\n\t\t\t\t'readMessage',\n\t\t\t\t'readMessage|'+result.dialogId,\n\t\t\t\tresult,\n\t\t\t\tfalse,\n\t\t\t\t200\n\t\t\t], 'background');\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tunreadMessage(messageId)\n\t{\n\t\tif (!this.controller.isOnline())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.controller.application.unreadMessage(messageId);\n\t}\n\n\topenReadedList(list)\n\t{\n\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!list || list.length <= 1)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.openUserList({\n\t\t\tusers: list.map(element => element.userId),\n\t\t\ttitle: this.getLocalize('MOBILE_MESSAGE_LIST_VIEW')\n\t\t});\n\t}\n\n\treplyToUser(userId, userData = null)\n\t{\n\t\tif (!this.controller.isOnline())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!userData)\n\t\t{\n\t\t\tuserData = this.controller.getStore().getters['users/get'](userId);\n\t\t}\n\n\t\treturn this.insertText({text: `[USER=${userId}]${userData.firstName}[/USER] `});\n\t}\n\n\tcopyMessage(id)\n\t{\n\t\tlet quoteMessage = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), id);\n\n\t\tlet text = '';\n\n\t\tif (quoteMessage.params.FILE_ID && quoteMessage.params.FILE_ID.length)\n\t\t{\n\t\t\ttext = quoteMessage.params.FILE_ID.map(fileId => '[DISK='+fileId+']').join(\" \");\n\t\t}\n\n\t\tif (quoteMessage.text)\n\t\t{\n\t\t\tif (text)\n\t\t\t{\n\t\t\t\ttext += '\\n';\n\t\t\t}\n\n\t\t\ttext += quoteMessage.text.replace(/^([-]{54}\\n)/gm, '-'.repeat(21)+'\\n');\n\t\t}\n\n\t\tapp.exec(\"copyToClipboard\", {text});\n\n\t\t(new BXMobileApp.UI.NotificationBar({\n\t\t\tmessage: BX.message(\"MOBILE_MESSAGE_MENU_COPY_SUCCESS\"),\n\t\t\tcolor: \"#af000000\",\n\t\t\ttextColor: \"#ffffff\",\n\t\t\tgroupId: \"clipboard\",\n\t\t\tmaxLines: 1,\n\t\t\talign: \"center\",\n\t\t\tisGlobal: true,\n\t\t\tuseCloseButton: true,\n\t\t\tautoHideTimeout: 1500,\n\t\t\thideOnTap: true\n\t\t}, \"copy\")).show();\n\t}\n\n\tquoteMessage(id)\n\t{\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: id\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tif (!this.controller.getStore().state.application.mobile.keyboardShow)\n\t\t\t{\n\t\t\t\tthis.setTextFocus();\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\t\tduration: 300,\n\t\t\t\t\t\tcancelIfScrollChange: false,\n\t\t\t\t\t\tforce: true\n\t\t\t\t\t});\n\t\t\t\t}, 300);\n\t\t\t}\n\t\t});\n\t}\n\n\treactMessage(id, reaction)\n\t{\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::action', [\n\t\t\t'reactMessage',\n\t\t\t'reactMessage|'+id,\n\t\t\t{\n\t\t\t\tmessageId: id,\n\t\t\t\taction: reaction.action === 'auto'? 'auto': (reaction.action === 'set'? 'plus': 'minus')\n\t\t\t},\n\t\t\tfalse,\n\t\t\t1000\n\t\t], 'background');\n\n\t\tif (reaction.action === 'set')\n\t\t{\n\t\t\tsetTimeout(() => app.exec(\"callVibration\"), 200);\n\t\t}\n\t}\n\n\topenMessageReactionList(id, reactions)\n\t{\n\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet users = [];\n\t\tfor (let reaction in reactions)\n\t\t{\n\t\t\tif (!reactions.hasOwnProperty(reaction))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tusers = users.concat(reactions[reaction]);\n\t\t}\n\n\t\tthis.openUserList({\n\t\t\tusers: users,\n\t\t\ttitle: this.getLocalize('MOBILE_MESSAGE_LIST_LIKE')\n\t\t});\n\t}\n\n\tquoteMessageClear()\n\t{\n\t\tthis.setText('');\n\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: 0,\n\t\t\t\teditId: 0\n\t\t\t}\n\t\t});\n\t}\n\n\teditMessage(id)\n\t{\n\t\tlet message = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), id);\n\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: id,\n\t\t\t\teditId: id\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tsetTimeout(() => EventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.controller.application.getChatId(), duration: 300, cancelIfScrollChange: false, force: true}), 300);\n\t\t\tthis.setTextFocus();\n\t\t});\n\n\t\tthis.setText(message.text);\n\t}\n\n\tupdateMessage(id, text)\n\t{\n\t\tthis.quoteMessageClear();\n\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\teditId: 0\n\t\t\t}\n\t\t});\n\n\t\tthis.editMessageSend(id, text);\n\t}\n\n\teditMessageSend(id, text)\n\t{\n\t\tthis.controller.restClient.callMethod(RestMethod.imMessageUpdate, {\n\t\t\t'MESSAGE_ID': id,\n\t\t\t'MESSAGE': text\n\t\t}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imMessageUpdate,\n\t\t\tdata: {timMessageType: 'text'},\n\t\t\tdialog: this.controller.application.getDialogData()\n\t\t}));\n\t}\n\n\tdeleteMessage(id)\n\t{\n\t\tlet message = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), id);\n\t\tlet files = this.controller.getStore().getters['files/getList'](this.controller.application.getChatId());\n\n\t\tlet messageText = Utils.text.purify(message.text, message.params, files, this.getLocalize());\n\t\tmessageText = messageText.length > 50? messageText.substr(0, 47) + '...': messageText;\n\n\t\tapp.confirm({\n\t\t\ttitle: this.getLocalize('MOBILE_MESSAGE_MENU_DELETE_CONFIRM'),\n\t\t\ttext: messageText? '\"' + messageText + '\"': '',\n\t\t\tbuttons: [\n\t\t\t\tthis.getLocalize('MOBILE_MESSAGE_MENU_DELETE_YES'),\n\t\t\t\tthis.getLocalize('MOBILE_MESSAGE_MENU_DELETE_NO')\n\t\t\t],\n\t\t\tcallback: (button) =>\n\t\t\t{\n\t\t\t\tif (button === 1)\n\t\t\t\t{\n\t\t\t\t\tthis.quoteMessageClear();\n\t\t\t\t\tthis.deleteMessageSend(id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tdeleteMessageSend(id)\n\t{\n\t\tthis.controller.restClient.callMethod(RestMethod.imMessageDelete, {\n\t\t\t'MESSAGE_ID': id\n\t\t}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imMessageDelete,\n\t\t\tdata: {},\n\t\t\tdialog: this.controller.application.getDialogData(this.controller.application.getDialogId())\n\t\t}));\n\t}\n\n\tinsertText(params)\n\t{\n\t\tBXMobileApp.UI.Page.TextPanel.getText((text) => {\n\t\t\ttext = text.toString().trim();\n\n\t\t\ttext = text? text+' '+params.text: params.text;\n\n\t\t\tthis.setText(text);\n\t\t\tthis.setTextFocus();\n\t\t});\n\t}\n\n\tsetText(text = '')\n\t{\n\t\ttext = text.toString();\n\n\t\tif (text)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.setText(text);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.clear();\n\t\t}\n\n\t\tthis.setTextareaMessage({message: text});\n\n\t\tconsole.log('Set new text in textarea', text? text: '-- empty --');\n\t}\n\n\tclearText()\n\t{\n\t\tthis.setText();\n\t}\n\n\tsetTextFocus()\n\t{\n\t\tif (!this.controller.getStore().state.application.mobile.keyboardShow)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.focus();\n\t\t}\n\t}\n\n\tisBackground()\n\t{\n\t\tif (typeof BXMobileAppContext !== \"object\")\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\ttypeof BXMobileAppContext.isAppActive === \"function\"\n\t\t\t&& !BXMobileAppContext.isAppActive()\n\t\t)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (typeof BXMobileAppContext.isBackground === \"function\")\n\t\t{\n\t\t\treturn BXMobileAppContext.isBackground();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thideSmiles()\n\t{\n\t\t// this.controller.hideSmiles();\n\t}\n\n/* endregion 05. Templates and template interaction */\n\n/* region 05. Interaction and utils */\n\n\texecuteBackgroundTaskSuccess(action, data)\n\t{\n\t\tlet successObject =\n\t\t{\n\t\t\terror: () => false,\n\t\t\tdata: () => data.result,\n\t\t};\n\n\t\tconsole.log('Dialog.executeBackgroundTaskSuccess', action, data);\n\n\t\tif (action === 'sendMessage')\n\t\t{\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, successObject, data.extra);\n\t\t}\n\t\telse if (action === 'readMessage')\n\t\t{\n\t\t\tthis.processMarkReadMessages();\n\t\t}\n\t\telse if (action === 'uploadFileFromDisk')\n\t\t{\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, successObject, data.extra);\n\t\t}\n\t}\n\n\texecuteBackgroundTaskFailure(action, data)\n\t{\n\t\tlet errorObject =\n\t\t{\n\t\t\terror: () => {\n\t\t\t\treturn {\n\t\t\t\t\terror: data.code,\n\t\t\t\t\terror_description: data.text,\n\t\t\t\t\tex: {\n\t\t\t\t\t\tstatus: data.status,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tdata: () => false,\n\t\t};\n\n\t\tconsole.log('Dialog.executeBackgroundTaskFailure', action, data);\n\n\t\tif (action === 'sendMessage')\n\t\t{\n\t\t\t//this.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, errorObject, data.extra);\n\t\t}\n\t\telse if (action === 'uploadFileFromDisk')\n\t\t{\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, errorObject, data.extra);\n\t\t}\n\t}\n\n/* endregion 05. Interaction and utils */\n\n/* region 06. Interaction and utils */\n\n\tsetError(code = '', description = '')\n\t{\n\t\tconsole.error(`MobileChat.error: ${code} (${description})`);\n\n\t\tlet localizeDescription = '';\n\t\tif (code.endsWith('LOCALIZED'))\n\t\t{\n\t\t\tlocalizeDescription = description;\n\t\t}\n\n\t\tthis.controller.getStore().commit('application/set', {error: {\n\t\t\tactive: true,\n\t\t\tcode,\n\t\t\tdescription: localizeDescription\n\t\t}});\n\t}\n\n\tclearError()\n\t{\n\t\tthis.controller.getStore().commit('application/set', {error: {\n\t\t\tactive: false,\n\t\t\tcode: '',\n\t\t\tdescription: ''}\n\t\t});\n\t}\n\n\taddLocalize(phrases)\n\t{\n\t\treturn this.controller.addLocalize(phrases);\n\t}\n\n\tgetLocalize(name)\n\t{\n\t\treturn this.controller.getLocalize(name);\n\t}\n\n/* endregion 06. Interaction and utils */\n/* region 07. Event handlers */\n\tonMessagesSet()\n\t{\n\t\tthis.renderUnsentMessages();\n\t\tthis.messagesSet = true;\n\t}\n/* endregion 07. Event handlers */\n}\n"],"names":["MobileImCommandHandler","params","controller","store","dialog","extra","command","invited","setTimeout","redrawHeader","currentHeaderName","BXMobileApp","UI","Page","TopBar","title","text","senderId","message","users","name","MobileRestAnswerHandler","context","data","commit","call","serverEnabled","callServerEnabled","maxParticipants","chatId","id","dialogId","dialog_id","diskFolderId","disk_folder_id","restrictions","dispatch","fields","error","ex","app","closeController","disk","enabled","maxFileSize","phpUploadMaxFilesize","addLocalize","BX","LocalStorage","set","getSiteId","messageId","messagesQueue","filter","el","result","BaseRestHandler","LoadingStatus","template","ErrorStatus","computed","Vuex","mapState","application","state","EmptyStatus","MobileSmiles","methods","onSelectSmile","event","$emit","onSelectSet","hideSmiles","BitrixVue","component","mixins","DialogCore","DialogReadMessages","DialogQuoteMessage","DialogClickOnCommand","DialogClickOnMention","DialogClickOnUserName","DialogClickOnMessageMenu","DialogClickOnMessageRetry","DialogClickOnUploadCancel","DialogClickOnReadList","DialogSetMessageReaction","DialogOpenMessageReactionList","DialogClickOnKeyboardButton","DialogClickOnChatTeaser","DialogClickOnDialog","components","dialogState","EventType","localize","getFilteredPhrases","$root","$bitrixMessages","widgetClassName","className","push","Utils","platform","isIos","join","quotePanelData","description","color","showMessageDialog","quoteId","$store","getters","user","authorId","files","editId","$Bitrix","Loc","getMessage","NAME","purify","getMessages","isDialog","isChatId","isGestureQuoteSupported","type","managerList","includes","common","userId","ChatPerformance","isDarkBackground","options","darkBackground","messageCollection","length","timeout","getDialogShowTimeout","clearTimeout","dialogStateTimeout","init","messages","collection","getApplication","Application","get","logEvent","Logger","info","onDialogRequestHistory","getDialogHistory","lastId","onDialogRequestUnread","getDialogUnread","onClickOnUserName","replyToUser","onClickOnUploadCancel","cancelUploadFile","file","onClickOnCommand","insertText","value","addMessage","warn","onClickOnMention","openProfile","openDialog","openPhoneMenu","onClickOnMessageMenu","openMessageMenu","onClickOnMessageRetry","retrySendMessage","onReadMessage","readMessage","onClickOnReadList","openReadedList","list","onQuoteMessage","quoteMessage","onSetMessageReaction","reactMessage","reaction","onOpenMessageReactionList","openMessageReactionList","values","onClickOnKeyboardButton","action","botId","EventEmitter","emit","scrollToBottom","duration","cancelIfScrollChange","exec","NotificationBar","textColor","groupId","maxLines","align","isGlobal","useCloseButton","autoHideTimeout","hideOnTap","show","RestClient","callMethod","RestMethod","imMessageCommand","onClickOnChatTeaser","Data","joinParentChat","CHAT_ID","then","catch","onClickOnDialog","onQuotePanelClose","quoteMessageClear","onSmilesSelectSmile","console","onSmilesSelectSet","setTextFocus","onHideSmiles","immutable","STORAGE_PREFIX","FILES_STORAGE_NAME","MESSAGES_STORAGE_NAME","MobileDialogApplication","inited","initPromise","Promise","rootNode","node","document","createElement","eventBus","VueVendorV2","timer","Timer","windowFocused","uploadTasks","messagesTasks","messagesSet","initCore","subscribeToEvents","initComponentParams","initMobileEntity","initMobileSettings","initComponent","initEnvironment","initMobileEnvironment","loadUnsentFromStorage","initPullClient","initComplete","resolve","reject","Core","ready","subscribe","onMessagesSet","bind","componentParameters","log","DIALOG_ENTITY","JSON","parse","DIALOG_TYPE","getStore","serverVariables","storedEvents","STORED_EVENTS","ApplicationStorage","getObject","quoteEnable","quoteFromRight","autoplayVideo","isAutoPlayVideoSupported","backgroundType","DIALOG_ID","ChatDialogBackground","dark","setPrepareFilesBeforeSaveFunction","prepareFileData","addRestAnswerHandler","create","getDialogId","createVue","vue","setTextareaMessage","debounce","getApiVersion","Scroll","setEnabled","captureKeyboardEvents","addCustomEvent","mobile","keyboardShow","getChatId","clearInterval","keyboardOpeningInterval","checkWindowFocused","isVisible","callback","status","Vue","processSendMessages","readVisibleMessages","scrollOnStart","taskId","toString","split","executeBackgroundTaskSuccess","executeBackgroundTaskFailure","Pull","PullClient","SubscriptionType","Server","moduleId","pullMobileHandler","getModuleId","optionImportant","TextPanel","setParams","getKeyboardParams","changeChatKeyboardStatus","MobileUploadProvider","setListener","executeUploaderEvent","fileUpdateProgress","throttle","fileId","progress","size","FileStatus","upload","userShowWorkPosition","setInterval","chatShowUserCounter","widgetCache","ChatWidgetCache","getUserId","getLanguageId","isUnreadMessagesLoaded","sort","a","b","slice","onCustomEvent","Status","eventStatusInteraction","Online","eventOnlineInteraction","mutation","eventStoreInteraction","Events","postToComponent","requestData","stop","forEach","entry","eventData","messageTempId","uploadFile","filesPromise","loadUnsentFiles","messagesPromise","loadUnsentMessages","all","storageId","Object","promise","requestDataSend","start","titleAction","useProgress","useLetterImage","renderUnsentMessages","query","RestMethodHandler","mobileBrowserConstGet","imChatGet","imDialogMessagesGetInit","imDialogMessagesGet","limit","getRequestMessageLimit","convert_text","imRecentUnread","imCallGetCallLimits","imUserGet","imUserListGet","restClient","callBatch","response","setError","constGet","error_description","executeRestAnswer","callLimits","userGet","userListGet","chatGetResult","dialogMessagesGetResult","pullBaseHandler","option","skip","enableReadMessages","getLogTrackingParams","getDialogData","eventName","MobileUploaderConst","FILE_UPLOAD_PROGRESS","percent","byteTotal","FILE_CREATED","errors","wait","FILES","DISK_ID","urlDownload","urlPreview","urlShow","TASK_CANCELLED","TASK_NOT_FOUND","FILE_CREATED_FAILED","FILE_UPLOAD_FAILED","FILE_READ_ERROR","TASK_STARTED_FAILED","prepareFunction","startsWith","FileType","image","currentDomain","replace","Array","map","headerProperties","getChatHeaderParams","getUserHeaderParams","setHeaderButtons","headerMenuInited","setCallback","openHeaderMenu","setText","desc","setDetailText","avatar","setImage","imageColor","showLastDate","lastActivityDate","getLastDateText","getLocalize","workPosition","entityType","encodeURI","getHost","chatTypeTitle","userCounter","toUpperCase","keyboardShowFlag","hide","callMenuSetted","dialogData","isAvailableChatCall","getData","entityData1","DialogType","extend","items","fabric","Answers","sendCustomEvent","openAddUserDialog","userData","bot","network","parseInt","video","chatData","badgeCode","listType","backdrop","settings","objectName","componentCode","scriptPath","ownerId","rootWidget","phones","personalMobile","workPhone","personalPhone","innerPhone","BackdropMenu","setItems","BackdropMenuItem","setTitle","setSubTitle","setVersion","setEventListener","MobileTools","phoneTo","setCustomParams","confirm","buttons","button","leaveChat","imChatLeave","listUsers","getItemsForAddUserDialog","element","ChatDataConverter","getListElementByUser","scopes","showOnTop","itemsIndex","recentList","connector","colleaguesList","lastSearchList","payload","counter","PullStatus","pullRequestMessage","Offline","hasOwnProperty","siteDir","textareaMessage","placeholder","smileButton","useImageButton","useAudioMessages","mentionDataSource","outsection","url","attachFileSettings","previewMaxWidth","previewMaxHeight","resize","targetWidth","targetHeight","sourceType","encodingType","mediaType","allowsEdit","saveToPhotoAlbum","popoverOptions","cameraDirection","sendFileSeparately","showAttachedFiles","editingMediaFiles","maxAttachedFilesCount","attachButton","dataSource","multiple","TABLE_SETTINGS","searchField","showtitle","modal","attachedFiles","trim","clearText","updateMessage","dataAttributes","source","toLowerCase","preview","URL","PREVIEW","width","match","height","uploadLink","ID","Date","toJSON","filename","fileType","FilesModel","getType","extension","previewUrl","previewWidth","previewHeight","startWriting","stopWriting","showSmiles","getPlatform","getIosVersion","repeat","date","format","quote","isUnsentMessage","ChatUtils","getUuidv4","sendMessage","FILE_ID","sending","prepareFilesBeforeSave","splice","authorName","getCurrentUser","find","cancelTasks","fileCommit","diskId","messageText","getDiskFolderId","sendMessageWithFile","requestDiskFolderId","readMessageExecute","imMessageAdd","fileExtension","attachPreviewFile","needConvert","addTasks","mimeType","audio","folderId","onDestroyEventName","retry","queryParams","chat_id","template_id","file_template_id","uploadId","upload_id","disk_id","imDiskFileCommit","flagRequestDiskFolderIdSended","imDiskFolderGet","promiseGetDialogUnreadWait","promiseGetDialogUnread","imDialogRead","message_id","imDialogMessagesGetUnread","first_id","dialogMessageUnread","fulfill","retryUploadFile","setSendingMessageFlag","number","blink","currentUser","messageUser","messageMenuInstance","setIcon","BackdropMenuIcon","reply","copy","IS_DELETED","unread","checked","edit","setType","BackdropMenuItemType","menu","circle_plus","disableClose","extranet","externalAuthId","setStyles","BackdropMenuStyle","setFont","WidgetListItemFont","setColor","trash","copyMessage","editMessage","deleteMessage","unreadMessage","subMenu","task","lifefeed","chat","shareMessage","showSubMenu","headerMenu","HeaderMenu","setUseNavigationBarColor","customParams","openUserList","muteDialog","entityId","crmData","getDialogCrmData","openWidget","resolveOpenFunction","useLoader","getStoreBuilder","clearDatabase","reload","notifyToggleText","isDialogMuted","notifyToggleIcon","HeaderMenuIcon","notify","notify_off","gotoCrmLocalize","crm","DialogCrmType","lead","company","contact","deal","HeaderMenuItem","phone","user_plus","cross","leave","unshift","isOnline","firstName","force","reactions","concat","editMessageSend","imMessageUpdate","timMessageType","substr","deleteMessageSend","imMessageDelete","getText","clear","focus","BXMobileAppContext","isAppActive","isBackground","successObject","processMarkReadMessages","errorObject","code","localizeDescription","endsWith","active","phrases"],"mappings":";;;;;CAAA;;;;;;;;AASA,KAAaA,sBAAb;CAAA;CAAA;CAAA,6BAGC;CAAA,UADcC,MACd,uEADuB,EACvB;CACC,aAAO,IAAI,IAAJ,CAASA,MAAT,CAAP;CACA;CALF;;CAOC,oCACA;CAAA,QADYA,MACZ,uEADqB,EACrB;CAAA;CACC,SAAKC,UAAL,GAAkBD,MAAM,CAACC,UAAzB;CACA,SAAKC,KAAL,GAAaF,MAAM,CAACE,KAApB;CACA,SAAKC,MAAL,GAAcH,MAAM,CAACG,MAArB;CACA;;CAZF;CAAA;CAAA,kCAeC;CACC,aAAO,IAAP;CACA;CAjBF;CAAA;CAAA,qCAmBkBH,MAnBlB,EAmB0BI,KAnB1B,EAmBiCC,OAnBjC,EAoBC;CAAA;;CACC,UAAI,CAACL,MAAM,CAACM,OAAZ,EACA;CACCC,QAAAA,UAAU,CAAC,YAAM;CAChB,UAAA,KAAI,CAACJ,MAAL,CAAYK,YAAZ;CACA,SAFS,EAEP,GAFO,CAAV;CAGA;CACD;CA3BF;CAAA;CAAA,kCA6BeR,MA7Bf,EA6BuBI,KA7BvB,EA6B8BC,OA7B9B,EA8BC;CACC,UAAII,iBAAiB,GAAGC,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBC,MAApB,CAA2BC,KAA3B,CAAiCd,MAAjC,CAAwCe,IAAhE;CACA,UAAIC,QAAQ,GAAGhB,MAAM,CAACiB,OAAP,CAAeD,QAA9B;;CACA,UAAIhB,MAAM,CAACkB,KAAP,CAAaF,QAAb,EAAuBG,IAAvB,KAAgCV,iBAApC,EACA;CACC,aAAKN,MAAL,CAAYK,YAAZ;CACA;CACD;CArCF;CAAA;CAAA;;CCTA;;;;;;;;AASA,KAKaY,uBAAb;CAAA;;CAEC,mCAAYpB,MAAZ,EACA;CAAA;;CAAA;CACC,yHAAMA,MAAN;;CAEA,QAAI,oBAAOA,MAAM,CAACqB,OAAd,MAA0B,QAA1B,IAAsCrB,MAAM,CAACqB,OAAjD,EACA;CACC,YAAKA,OAAL,GAAerB,MAAM,CAACqB,OAAtB;CACA;;CANF;CAOC;;CAVF;CAAA;CAAA,qDAYkCC,IAZlC,EAaC;CACC,WAAKpB,KAAL,CAAWqB,MAAX,CAAkB,iBAAlB,EAAqC;CAACC,QAAAA,IAAI,EAAE;CAC3CC,UAAAA,aAAa,EAAEH,IAAI,CAACI,iBADuB;CAE3CC,UAAAA,eAAe,EAAEL,IAAI,CAACK;CAFqB;CAAP,OAArC;CAIA;CAlBF;CAAA;CAAA,2CAoBwBL,IApBxB,EAqBC;CACC,WAAKpB,KAAL,CAAWqB,MAAX,CAAkB,iBAAlB,EAAqC;CAACpB,QAAAA,MAAM,EAAE;CAC7CyB,UAAAA,MAAM,EAAEN,IAAI,CAACO,EADgC;CAE7CC,UAAAA,QAAQ,EAAER,IAAI,CAACS,SAF8B;CAG7CC,UAAAA,YAAY,EAAEV,IAAI,CAACW;CAH0B;CAAT,OAArC;;CAMA,UAAIX,IAAI,CAACY,YAAT,EACA;CACC,aAAKhC,KAAL,CAAWiC,QAAX,CAAoB,kBAApB,EAAwC;CACvCL,UAAAA,QAAQ,EAAER,IAAI,CAACS,SADwB;CAEvCK,UAAAA,MAAM,EAAEd,IAAI,CAACY;CAF0B,SAAxC;CAIA;CACD;CAnCF;CAAA;CAAA,yCAoCsBG,KApCtB,EAqCC;CACC,UAAIA,KAAK,CAACC,EAAN,CAASD,KAAT,KAAmB,cAAvB,EACA;CACCE,QAAAA,GAAG,CAACC,eAAJ;CACA;CACD;CA1CF;CAAA;CAAA,uDA4CoClB,IA5CpC,EA6CC;CACC,WAAKpB,KAAL,CAAWqB,MAAX,CAAkB,iBAAlB,EAAqC;CAACkB,QAAAA,IAAI,EAAE;CAC3CC,UAAAA,OAAO,EAAE,IADkC;CAE3CC,UAAAA,WAAW,EAAErB,IAAI,CAACsB;CAFyB;CAAP,OAArC;CAKA,WAAKvB,OAAL,CAAawB,WAAb,CAAyBvB,IAAzB;CACAwB,MAAAA,EAAE,CAAC7B,OAAH,CAAWK,IAAX;CAEAyB,MAAAA,gCAAY,CAACC,GAAb,CAAiB,KAAK/C,UAAL,CAAgBgD,SAAhB,EAAjB,EAA8C,CAA9C,EAAiD,iBAAjD,EAAoE3B,IAAI,IAAI,EAA5E;CACA;CAvDF;CAAA;CAAA,2DA0DC;CAEC;CA5DF;CAAA;CAAA,8CA8D2B4B,SA9D3B,EA8DsCjC,OA9DtC,EA+DC;CACC,WAAKI,OAAL,CAAa8B,aAAb,GAA6B,KAAK9B,OAAL,CAAa8B,aAAb,CAA2BC,MAA3B,CAAkC,UAAAC,EAAE;CAAA,eAAIA,EAAE,CAACxB,EAAH,KAAUZ,OAAO,CAACY,EAAtB;CAAA,OAApC,CAA7B;CACA;CAjEF;CAAA;CAAA,4CAmEyBQ,KAnEzB,EAmEgCpB,OAnEhC,EAoEC;CACC,WAAKI,OAAL,CAAa8B,aAAb,GAA6B,KAAK9B,OAAL,CAAa8B,aAAb,CAA2BC,MAA3B,CAAkC,UAAAC,EAAE;CAAA,eAAIA,EAAE,CAACxB,EAAH,KAAUZ,OAAO,CAACY,EAAtB;CAAA,OAApC,CAA7B;CACA;CAtEF;CAAA;CAAA,kDAwE+ByB,MAxE/B,EAwEuCrC,OAxEvC,EAyEC;CACC,WAAKI,OAAL,CAAa8B,aAAb,GAA6B,KAAK9B,OAAL,CAAa8B,aAAb,CAA2BC,MAA3B,CAAkC,UAAAC,EAAE;CAAA,eAAIA,EAAE,CAACxB,EAAH,KAAUZ,OAAO,CAACY,EAAtB;CAAA,OAApC,CAA7B;CACA;CA3EF;CAAA;CAAA,EAA6C0B,gCAA7C;;CCdO,IAAMC,aAAa,GAAG;CAC5BC,EAAAA,QAAQ;CADoB,CAAtB;;CCEA,IAAMC,WAAW,GAAG;CAC1BC,EAAAA,QAAQ,gCAEJC,gBAAI,CAACC,QAAL,CAAc;CAChBC,IAAAA,WAAW,EAAE,qBAAAC,KAAK;CAAA,aAAIA,KAAK,CAACD,WAAV;CAAA;CADF,GAAd,CAFI,CADkB;CAO1BL,EAAAA,QAAQ;CAPkB,CAApB;;CCFA,IAAMO,WAAW,GAAG;CAC1BP,EAAAA,QAAQ;CADkB,CAApB;;CCEA,IAAMQ,YAAY,GAAG;CAC3BC,EAAAA,OAAO,EACP;CACCC,IAAAA,aADD,yBACeC,KADf,EAEC;CACC,WAAKC,KAAL,CAAW,aAAX,EAA0BD,KAA1B;CACA,KAJF;CAKCE,IAAAA,WALD,uBAKaF,KALb,EAMC;CACC,WAAKC,KAAL,CAAW,WAAX,EAAwBD,KAAxB;CACA,KARF;CASCG,IAAAA,UATD,wBAUC;CACC,WAAKF,KAAL,CAAW,YAAX;CACA;CAZF,GAF2B;CAgB3BZ,EAAAA,QAAQ;CAhBmB,CAArB;;CCFP;;;;;;;;AASA,CAqBA;;;;AAGAe,iBAAS,CAACC,SAAV,CAAoB,+BAApB,EACA;CACCC,EAAAA,MAAM,EAAE,CACPC,mBADO,EACKC,2BADL,EACyBC,2BADzB,EAC6CC,6BAD7C,EACmEC,6BADnE,EACyFC,8BADzF,EAEPC,iCAFO,EAEmBC,kCAFnB,EAE8CC,kCAF9C,EAEyEC,8BAFzE,EAEgGC,iCAFhG,EAGPC,sCAHO,EAGwBC,oCAHxB,EAGqDC,gCAHrD,EAG8EC,4BAH9E,CADT;CAMCC,EAAAA,UAAU,EAAE;CAAClC,IAAAA,aAAa,EAAbA,aAAD;CAAgBE,IAAAA,WAAW,EAAXA,WAAhB;CAA6BM,IAAAA,WAAW,EAAXA,WAA7B;CAA0CC,IAAAA,YAAY,EAAZA;CAA1C,GANb;CAOC3C,EAAAA,IAAI,EAAE,gBACN;CACC,WAAO;CACNqE,MAAAA,WAAW,EAAE;CADP,KAAP;CAGA,GAZF;CAaChC,EAAAA,QAAQ;CAEPiC,IAAAA,SAAS,EAAE;CAAA,aAAMA,kBAAN;CAAA,KAFJ;CAGPC,IAAAA,QAHO,sBAIP;CACC,aAAOrB,gBAAS,CAACsB,kBAAV,CAA6B,CAAC,cAAD,EAAiB,WAAjB,CAA7B,EAA4D,KAAKC,KAAL,CAAWC,eAAvE,CAAP;CACA,KANM;CAOPC,IAAAA,eAPO,6BAQP;CACC,UAAIC,SAAS,GAAG,EAAhB;CAEAA,MAAAA,SAAS,CAACC,IAAV,CAAe,WAAf;;CAEA,UAAIC,kBAAK,CAACC,QAAN,CAAeC,KAAf,EAAJ,EACA;CACCJ,QAAAA,SAAS,CAACC,IAAV,CAAe,eAAf;CACA,OAHD,MAKA;CACCD,QAAAA,SAAS,CAACC,IAAV,CAAe,mBAAf;CACA;;CAED,aAAOD,SAAS,CAACK,IAAV,CAAe,GAAf,CAAP;CACA,KAvBM;CAwBPC,IAAAA,cAxBO,4BAyBP;CACC,UAAIlD,MAAM,GAAG;CACZzB,QAAAA,EAAE,EAAE,CADQ;CAEZf,QAAAA,KAAK,EAAE,EAFK;CAGZ2F,QAAAA,WAAW,EAAE,EAHD;CAIZC,QAAAA,KAAK,EAAE;CAJK,OAAb;;CAOA,UAAI,CAAC,KAAKC,iBAAN,IAA2B,CAAC,KAAKxG,MAAL,CAAYyG,OAA5C,EACA;CACC,eAAOtD,MAAP;CACA;;CAED,UAAIrC,OAAO,GAAG,KAAK4F,MAAL,CAAYC,OAAZ,CAAoB,qBAApB,EAA2C,KAAK3G,MAAL,CAAYyB,MAAvD,EAA+D,KAAKzB,MAAL,CAAYyG,OAA3E,CAAd;;CACA,UAAI,CAAC3F,OAAL,EACA;CACC,eAAOqC,MAAP;CACA;;CAED,UAAIyD,IAAI,GAAG,KAAKF,MAAL,CAAYC,OAAZ,CAAoB,WAApB,EAAiC7F,OAAO,CAAC+F,QAAzC,CAAX;CACA,UAAIC,KAAK,GAAG,KAAKJ,MAAL,CAAYC,OAAZ,CAAoB,eAApB,EAAqC,KAAK3G,MAAL,CAAYyB,MAAjD,CAAZ;CACA,UAAIsF,MAAM,GAAG,KAAKL,MAAL,CAAYC,OAAZ,CAAoB,qBAApB,EAA2C,KAAK3G,MAAL,CAAY2B,QAAvD,CAAb;CAEA,aAAO;CACND,QAAAA,EAAE,EAAE,KAAK1B,MAAL,CAAYyG,OADV;CAEN9F,QAAAA,KAAK,EAAEoG,MAAM,GAAE,KAAKC,OAAL,CAAaC,GAAb,CAAiBC,UAAjB,CAA4B,wBAA5B,CAAF,GAA2DpG,OAAO,CAACjB,MAAR,CAAesH,IAAf,GAAsBrG,OAAO,CAACjB,MAAR,CAAesH,IAArC,GAA6CP,IAAI,GAAGA,IAAI,CAAC5F,IAAR,GAAc,EAFjI;CAGNuF,QAAAA,KAAK,EAAEK,IAAI,GAAEA,IAAI,CAACL,KAAP,GAAc,EAHnB;CAIND,QAAAA,WAAW,EAAEL,kBAAK,CAACrF,IAAN,CAAWwG,MAAX,CAAkBtG,OAAO,CAACF,IAA1B,EAAgCE,OAAO,CAACjB,MAAxC,EAAgDiH,KAAhD,EAAuD,KAAKE,OAAL,CAAaC,GAAb,CAAiBI,WAAjB,EAAvD;CAJP,OAAP;CAMA,KAtDM;CAwDPC,IAAAA,QAxDO,sBAyDP;CACC,aAAOrB,kBAAK,CAACjG,MAAN,CAAauH,QAAb,CAAsB,KAAKvH,MAAL,CAAY2B,QAAlC,CAAP;CACA,KA3DM;CA6DP6F,IAAAA,uBA7DO,qCA8DP;CACC,UAAI,KAAKxH,MAAL,IAAe,KAAKA,MAAL,CAAYyH,IAAZ,KAAqB,cAApC,IAAsD,CAAC,KAAKzH,MAAL,CAAY0H,WAAZ,CAAwBC,QAAxB,CAAiC,KAAKhE,WAAL,CAAiBiE,MAAjB,CAAwBC,MAAzD,CAA3D,EACA;CACC,eAAO,KAAP;CACA;;CAED,aAAOC,eAAe,CAACN,uBAAhB,EAAP;CACA,KArEM;CAsEPO,IAAAA,gBAtEO,8BAuEP;CACC,aAAO,KAAKpE,WAAL,CAAiBqE,OAAjB,CAAyBC,cAAhC;CACA,KAzEM;CA0EPzB,IAAAA,iBA1EO,+BA2EP;CAAA;;CACC,UAAIrD,MAAM,GAAG,KAAK+E,iBAAL,IAA0B,KAAKA,iBAAL,CAAuBC,MAAvB,GAAgC,CAAvE;CACA,UAAIC,OAAO,GAAGN,eAAe,CAACO,oBAAhB,EAAd;;CACA,UAAIlF,MAAJ,EACA;CACC,YAAIiF,OAAO,GAAG,CAAd,EACA;CACCE,UAAAA,YAAY,CAAC,KAAKC,kBAAN,CAAZ;CACA,eAAKA,kBAAL,GAA0BnI,UAAU,CAAC,YAAM;CAC1C,YAAA,KAAI,CAACoF,WAAL,GAAmB,MAAnB;CACA,WAFmC,EAEjC4C,OAFiC,CAApC;CAGA,SAND,MAQA;CACC,eAAK5C,WAAL,GAAmB,MAAnB;CACA;CACD,OAbD,MAcK,IAAI,KAAKxF,MAAL,IAAe,KAAKA,MAAL,CAAYwI,IAA/B,EACL;CACC,YAAIJ,OAAO,GAAG,CAAd,EACA;CACCE,UAAAA,YAAY,CAAC,KAAKC,kBAAN,CAAZ;CACA,eAAKA,kBAAL,GAA0BnI,UAAU,CAAC,YAAM;CAC1C,YAAA,KAAI,CAACoF,WAAL,GAAmB,OAAnB;CACA,WAFmC,EAEjC4C,OAFiC,CAApC;CAGA,SAND,MAQA;CACC,eAAK5C,WAAL,GAAmB,OAAnB;CACA;CACD,OAbI,MAeL;CACC,aAAKA,WAAL,GAAmB,SAAnB;CACA;;CAED,aAAOrC,MAAP;CACA;CAhHM,KAiHJM,gBAAI,CAACC,QAAL,CAAc;CAChBC,IAAAA,WAAW,EAAE,qBAAAC,KAAK;CAAA,aAAIA,KAAK,CAACD,WAAV;CAAA,KADF;CAEhBuE,IAAAA,iBAAiB,EAAE,2BAAAtE,KAAK;CAAA,aAAIA,KAAK,CAAC6E,QAAN,CAAeC,UAAf,CAA0B9E,KAAK,CAACD,WAAN,CAAkB3D,MAAlB,CAAyByB,MAAnD,CAAJ;CAAA;CAFR,GAAd,CAjHI,CAbT;CAmICsC,EAAAA,OAAO,EACP;CACC4E,IAAAA,cADD,4BAEC;CACC,aAAO,KAAK3B,OAAL,CAAa4B,WAAb,CAAyBC,GAAzB,EAAP;CACA,KAJF;CAKCC,IAAAA,QALD,oBAKU9H,IALV,EAMC;CAAA,wCADkBnB,MAClB;CADkBA,QAAAA,MAClB;CAAA;;CACCkJ,MAAAA,oBAAM,CAACC,IAAP,OAAAD,oBAAM,GAAM/H,IAAN,SAAenB,MAAf,EAAN;CACA,KARF;CASCoJ,IAAAA,sBATD,kCASwBhF,KATxB,EAUC;CACC,WAAK0E,cAAL,GAAsBO,gBAAtB,CAAuCjF,KAAK,CAACkF,MAA7C;CACA,KAZF;CAaCC,IAAAA,qBAbD,iCAauBnF,KAbvB,EAcC;CACC,WAAK0E,cAAL,GAAsBU,eAAtB,CAAsCpF,KAAK,CAACkF,MAA5C;CACA,KAhBF;CAiBCG,IAAAA,iBAjBD,mCAkBC;CAAA,UADyBrF,KACzB,QADmB9C,IACnB;CACC,WAAKwH,cAAL,GAAsBY,WAAtB,CAAkCtF,KAAK,CAAC2C,IAAN,CAAWlF,EAA7C,EAAiDuC,KAAK,CAAC2C,IAAvD;CACA,KApBF;CAqBC4C,IAAAA,qBArBD,wCAsBC;CAAA,UAD6BvF,KAC7B,SADuB9C,IACvB;CACC,WAAKwH,cAAL,GAAsBc,gBAAtB,CAAuCxF,KAAK,CAACyF,IAAN,CAAWhI,EAAlD;CACA,KAxBF;CAyBCiI,IAAAA,gBAzBD,mCA0BC;CAAA,UADwB1F,KACxB,SADkB9C,IAClB;;CACC,UAAI8C,KAAK,CAACwD,IAAN,KAAe,KAAnB,EACA;CACC,aAAKkB,cAAL,GAAsBiB,UAAtB,CAAiC;CAAChJ,UAAAA,IAAI,EAAEqD,KAAK,CAAC4F,KAAN,GAAY;CAAnB,SAAjC;CACA,OAHD,MAIK,IAAI5F,KAAK,CAACwD,IAAN,KAAe,MAAnB,EACL;CACC,aAAKkB,cAAL,GAAsBmB,UAAtB,CAAiC7F,KAAK,CAAC4F,KAAvC;CACA,OAHI,MAKL;CACCd,QAAAA,oBAAM,CAACgB,IAAP,CAAY,qBAAZ,EAAmC9F,KAAnC;CACA;CACD,KAvCF;CAwCC+F,IAAAA,gBAxCD,mCAyCC;CAAA,UADwB/F,KACxB,SADkB9C,IAClB;;CACC,UAAI8C,KAAK,CAACwD,IAAN,KAAe,MAAnB,EACA;CACC,aAAKkB,cAAL,GAAsBsB,WAAtB,CAAkChG,KAAK,CAAC4F,KAAxC;CACA,OAHD,MAIK,IAAI5F,KAAK,CAACwD,IAAN,KAAe,MAAnB,EACL;CACC,aAAKkB,cAAL,GAAsBuB,UAAtB,CAAiCjG,KAAK,CAAC4F,KAAvC;CACA,OAHI,MAIA,IAAI5F,KAAK,CAACwD,IAAN,KAAe,MAAnB,EACL;CACC,aAAKkB,cAAL,GAAsBwB,aAAtB,CAAoClG,KAAK,CAAC4F,KAA1C;CACA;CACD,KAtDF;CAuDCO,IAAAA,oBAvDD,uCAwDC;CAAA,UAD4BnG,KAC5B,SADsB9C,IACtB;CACC4H,MAAAA,oBAAM,CAACgB,IAAP,CAAY,eAAZ,EAA6B9F,KAA7B;CACA,WAAK0E,cAAL,GAAsB0B,eAAtB,CAAsCpG,KAAK,CAACnD,OAA5C;CACA,KA3DF;CA4DCwJ,IAAAA,qBA5DD,wCA6DC;CAAA,UAD6BrG,KAC7B,SADuB9C,IACvB;CACC4H,MAAAA,oBAAM,CAACgB,IAAP,CAAY,gBAAZ,EAA8B9F,KAA9B;CACA,WAAK0E,cAAL,GAAsB4B,gBAAtB,CAAuCtG,KAAK,CAACnD,OAA7C;CACA,KAhEF;CAiEC0J,IAAAA,aAjED,gCAkEC;CAAA,UADqBvG,KACrB,SADe9C,IACf;CACC,WAAKwH,cAAL,GAAsB8B,WAAtB,CAAkCxG,KAAK,CAACvC,EAAxC;CACA,KApEF;CAqECgJ,IAAAA,iBArED,oCAsEC;CAAA,UADyBzG,KACzB,SADmB9C,IACnB;CACC,WAAKwH,cAAL,GAAsBgC,cAAtB,CAAqC1G,KAAK,CAAC2G,IAA3C;CACA,KAxEF;CAyECC,IAAAA,cAzED,iCA0EC;CAAA,UADsB5G,KACtB,SADgB9C,IAChB;CACC,WAAKwH,cAAL,GAAsBmC,YAAtB,CAAmC7G,KAAK,CAACnD,OAAN,CAAcY,EAAjD;CACA,KA5EF;CA6ECqJ,IAAAA,oBA7ED,wCA8EC;CAAA,UAD4B9G,KAC5B,UADsB9C,IACtB;CACC,WAAKwH,cAAL,GAAsBqC,YAAtB,CAAmC/G,KAAK,CAACnD,OAAN,CAAcY,EAAjD,EAAqDuC,KAAK,CAACgH,QAA3D;CACA,KAhFF;CAiFCC,IAAAA,yBAjFD,6CAkFC;CAAA,UADiCjH,KACjC,UAD2B9C,IAC3B;CACC,WAAKwH,cAAL,GAAsBwC,uBAAtB,CAA8ClH,KAAK,CAACnD,OAAN,CAAcY,EAA5D,EAAgEuC,KAAK,CAACmH,MAAtE;CACA,KApFF;CAqFCC,IAAAA,uBArFD,2CAsFC;CAAA;;CAAA,UAD+BpH,KAC/B,UADyB9C,IACzB;;CACC,UAAI8C,KAAK,CAACqH,MAAN,KAAiB,QAArB,EACA;CAAA,4BACmDrH,KAAK,CAACpE,MADzD;CAAA,YACM8B,QADN,iBACMA,QADN;CAAA,YACgBoB,SADhB,iBACgBA,SADhB;CAAA,YAC2BwI,KAD3B,iBAC2BA,KAD3B;CAAA,YACkCD,MADlC,iBACkCA,MADlC;CAAA,YAC0CzB,KAD1C,iBAC0CA,KAD1C;;CAGC,YAAIyB,MAAM,KAAK,MAAf,EACA;CACC,eAAK3C,cAAL,GAAsBmB,UAAtB,CAAiCD,KAAjC;CACAzJ,UAAAA,UAAU,CAAC;CAAA,mBAAMoL,6BAAY,CAACC,IAAb,CAAkBhG,kBAAS,CAACzF,MAAV,CAAiB0L,cAAnC,EAAmD;CAACjK,cAAAA,MAAM,EAAE,MAAI,CAACA,MAAd;CAAsBkK,cAAAA,QAAQ,EAAE,GAAhC;CAAqCC,cAAAA,oBAAoB,EAAE;CAA3D,aAAnD,CAAN;CAAA,WAAD,EAA8H,GAA9H,CAAV;CACA,SAJD,MAKK,IAAIN,MAAM,KAAK,KAAf,EACL;CACC,eAAK3C,cAAL,GAAsBiB,UAAtB,CAAiC;CAAChJ,YAAAA,IAAI,EAAEiJ,KAAK,GAAC;CAAb,WAAjC;CACA,SAHI,MAIA,IAAIyB,MAAM,KAAK,MAAf,EACL;CACC,eAAK3C,cAAL,GAAsBwB,aAAtB,CAAoCN,KAApC;CACA,SAHI,MAIA,IAAIyB,MAAM,KAAK,MAAf,EACL;CACClJ,UAAAA,GAAG,CAACyJ,IAAJ,CAAS,iBAAT,EAA4B;CAACjL,YAAAA,IAAI,EAAEiJ;CAAP,WAA5B;CAEC,cAAItJ,WAAW,CAACC,EAAZ,CAAesL,eAAnB,CAAmC;CACnChL,YAAAA,OAAO,EAAE6B,EAAE,CAAC7B,OAAH,CAAW,kCAAX,CAD0B;CAEnCyF,YAAAA,KAAK,EAAE,WAF4B;CAGnCwF,YAAAA,SAAS,EAAE,SAHwB;CAInCC,YAAAA,OAAO,EAAE,WAJ0B;CAKnCC,YAAAA,QAAQ,EAAE,CALyB;CAMnCC,YAAAA,KAAK,EAAE,QAN4B;CAOnCC,YAAAA,QAAQ,EAAE,IAPyB;CAQnCC,YAAAA,cAAc,EAAE,IARmB;CASnCC,YAAAA,eAAe,EAAE,IATkB;CAUnCC,YAAAA,SAAS,EAAE;CAVwB,WAAnC,EAWE,MAXF,CAAD,CAWYC,IAXZ;CAaA,SAjBI,MAkBA,IAAIjB,MAAM,KAAK,QAAf,EACL;CACC,eAAK3C,cAAL,GAAsBuB,UAAtB,CAAiCL,KAAjC;CACA;;CAED,eAAO,IAAP;CACA;;CAED,UAAI5F,KAAK,CAACqH,MAAN,KAAiB,SAArB,EACA;CAAA,6BACqDrH,KAAK,CAACpE,MAD3D;CAAA,YACM8B,SADN,kBACMA,QADN;CAAA,YACgBoB,UADhB,kBACgBA,SADhB;CAAA,YAC2BwI,MAD3B,kBAC2BA,KAD3B;CAAA,YACkCrL,OADlC,kBACkCA,OADlC;CAAA,YAC2CL,MAD3C,kBAC2CA,MAD3C;CAGC,aAAKmH,OAAL,CAAawF,UAAb,CAAwB3D,GAAxB,GAA8B4D,UAA9B,CAAyCC,mBAAU,CAACC,gBAApD,EAAsE;CACrE,wBAAc5J,UADuD;CAErE,uBAAapB,SAFwD;CAGrE,oBAAU4J,MAH2D;CAIrE,qBAAWrL,OAJ0D;CAKrE,4BAAkBL;CALmD,SAAtE;CAQA,eAAO,IAAP;CACA;;CAED,aAAO,KAAP;CACA,KAlJF;CAmJC+M,IAAAA,mBAnJD,uCAoJC;CAAA;;CAAA,UAD2B3I,KAC3B,UADqB9C,IACrB;CACC,WAAK6F,OAAL,CAAa6F,IAAb,CAAkBhE,GAAlB,CAAsB,YAAtB,EAAoClF,WAApC,CAAgDmJ,cAAhD,CAA+D7I,KAAK,CAACnD,OAAN,CAAcY,EAA7E,EAAiF,SAAOuC,KAAK,CAACnD,OAAN,CAAcjB,MAAd,CAAqBkN,OAA7G,EAAsHC,IAAtH,CAA2H,UAACrL,QAAD,EAAc;CACxI,QAAA,MAAI,CAACgH,cAAL,GAAsBuB,UAAtB,CAAiCvI,QAAjC;CACA,OAFD,EAEGsL,KAFH,CAES,YAAM,EAFf;CAGA,KAxJF;CAyJCC,IAAAA,eAzJD,mCA0JC;;CAAA,UADuBjJ,KACvB,UADiB9C,IACjB;CAEC,KA5JF;CA6JCgM,IAAAA,iBA7JD,+BA8JC;CACC,WAAKxE,cAAL,GAAsByE,iBAAtB;CACA,KAhKF;CAiKCC,IAAAA,mBAjKD,+BAiKqBpJ,KAjKrB,EAkKC;CACCqJ,MAAAA,OAAO,CAACvD,IAAR,CAAa,iBAAb,EAAgC9F,KAAhC;CACA,WAAK0E,cAAL,GAAsBiB,UAAtB,CAAiC;CAAChJ,QAAAA,IAAI,EAAEqD,KAAK,CAACrD;CAAb,OAAjC;CACA,KArKF;CAsKC2M,IAAAA,iBAtKD,+BAuKC;CACCD,MAAAA,OAAO,CAACvD,IAAR,CAAa,cAAb;CACA,WAAKpB,cAAL,GAAsB6E,YAAtB;CACA,KA1KF;CA2KCC,IAAAA,YA3KD,0BA4KC;CACC;CACA,WAAK9E,cAAL,GAAsB6E,YAAtB;CACA;CA/KF,GApID;CAqTC;CACAlK,EAAAA,QAAQ;CAtTT,CADA,EA6UG;CAACoK,EAAAA,SAAS,EAAE;CAAZ,CA7UH;;CCjCA;;;;;;;;AASA,CAwCA,IAAMC,cAAc,GAAG,oBAAvB;CACA,IAAMC,kBAAkB,GAAG,aAA3B;CACA,IAAMC,qBAAqB,GAAG,OAA9B;AAEA,KAAaC,uBAAb;CAEC;CAEA,qCACA;CAAA;;CAAA,QADYjO,MACZ,uEADqB,EACrB;CAAA;CACC,SAAKkO,MAAL,GAAc,KAAd;CACA,SAAKC,WAAL,GAAmB,IAAIrL,EAAE,CAACsL,OAAP,EAAnB;CAEA,SAAKpO,MAAL,GAAcA,MAAd;CAEA,SAAKyD,QAAL,GAAgB,IAAhB;CACA,SAAK4K,QAAL,GAAgB,KAAKrO,MAAL,CAAYsO,IAAZ,IAAoBC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAApC;CAEA,SAAKC,QAAL,GAAgB,IAAIC,kBAAJ,EAAhB;CACA,SAAKC,KAAL,GAAa,IAAIC,kBAAJ,EAAb;CAEA,SAAKzL,aAAL,GAAqB,EAArB;CACA,SAAK0L,aAAL,GAAqB,IAArB;CAEA,SAAKC,WAAL,GAAmB,EAAnB;CACA,SAAKC,aAAL,GAAqB,EAArB;CAEA,SAAKC,WAAL,GAAmB,KAAnB,CAlBD;;CAsBC,SAAKC,QAAL,GACE9B,IADF,CACO;CAAA,aAAM,KAAI,CAAC+B,iBAAL,EAAN;CAAA,KADP,EAEE/B,IAFF,CAEO;CAAA,aAAM,KAAI,CAACgC,mBAAL,EAAN;CAAA,KAFP,EAGEhC,IAHF,CAGO,UAAA7J,MAAM;CAAA,aAAI,KAAI,CAAC8L,gBAAL,CAAsB9L,MAAtB,CAAJ;CAAA,KAHb,EAIE6J,IAJF,CAIO,UAAA7J,MAAM;CAAA,aAAI,KAAI,CAAC+L,kBAAL,CAAwB/L,MAAxB,CAAJ;CAAA,KAJb,EAKE6J,IALF,CAKO;CAAA,aAAM,KAAI,CAACmC,aAAL,EAAN;CAAA,KALP,EAMEnC,IANF,CAMO;CAAA,aAAM,KAAI,CAACoC,eAAL,EAAN;CAAA,KANP,EAOEpC,IAPF,CAOO;CAAA,aAAM,KAAI,CAACqC,qBAAL,EAAN;CAAA,KAPP,EAQErC,IARF,CAQO;CAAA,aAAM,KAAI,CAACsC,qBAAL,EAAN;CAAA,KARP,EASEtC,IATF,CASO;CAAA,aAAM,KAAI,CAACuC,cAAL,EAAN;CAAA,KATP,EAUEvC,IAVF,CAUO;CAAA,aAAM,KAAI,CAACwC,YAAL,EAAN;CAAA,KAVP;CAYA;;CAvCF;CAAA;CAAA,+BA0CC;CAAA;;CACC,aAAO,IAAIvB,OAAJ,CAAY,UAACwB,OAAD,EAAUC,MAAV,EAAqB;CACvCC,QAAAA,+BAAI,CAACC,KAAL,GAAa5C,IAAb,CAAkB,UAAAlN,UAAU,EAAI;CAC/B,UAAA,MAAI,CAACA,UAAL,GAAkBA,UAAlB;CACA2P,UAAAA,OAAO;CACP,SAHD;CAIA,OALM,CAAP;CAMA;CAjDF;CAAA;CAAA,wCAoDC;CACCjE,MAAAA,6BAAY,CAACqE,SAAb,CAAuBpK,kBAAS,CAACzF,MAAV,CAAiB6O,WAAxC,EAAqD,KAAKiB,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAArD;CACA;CAtDF;CAAA;CAAA,0CAyDC;CACC,aAAOpN,EAAE,CAACqN,mBAAH,CAAuBxH,IAAvB,EAAP;CACA;CA3DF;CAAA;CAAA,qCA6DkBrH,IA7DlB,EA8DC;CAAA;;CACCmM,MAAAA,OAAO,CAAC2C,GAAR,CAAY,qBAAZ;CAEA,aAAO,IAAIhC,OAAJ,CAAY,UAACwB,OAAD,EAAUC,MAAV,EACnB;CACC,YAAIvO,IAAI,CAAC+O,aAAT,EACA;CACC/O,UAAAA,IAAI,CAAC+O,aAAL,GAAqBC,IAAI,CAACC,KAAL,CAAWjP,IAAI,CAAC+O,aAAhB,CAArB;;CACA,cAAI/O,IAAI,CAACkP,WAAL,KAAqB,MAAzB,EACA;CACC,YAAA,MAAI,CAACvQ,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,WAApC,EAAiDb,IAAI,CAAC+O,aAAtD,EAAqElD,IAArE,CAA0E,YAAM;CAC/EyC,cAAAA,OAAO,CAACtO,IAAD,CAAP;CACA,aAFD;CAGA,WALD,MAMK,IAAIA,IAAI,CAACkP,WAAL,KAAqB,MAAzB,EACL;CACC,YAAA,MAAI,CAACvQ,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,eAApC,EAAqDb,IAAI,CAAC+O,aAA1D,EAAyElD,IAAzE,CAA8E,YAAM;CACnFyC,cAAAA,OAAO,CAACtO,IAAD,CAAP;CACA,aAFD;CAGA;CACD,SAfD,MAiBA;CACCsO,UAAAA,OAAO,CAACtO,IAAD,CAAP;CACA;CACD,OAtBM,CAAP;CAuBA;CAxFF;CAAA;CAAA,uCA0FoBA,IA1FpB,EA2FC;CAAA;;CACCmM,MAAAA,OAAO,CAAC2C,GAAR,CAAY,uBAAZ,EADD;;CAIC,UAAIM,eAAe,GAAG3N,gCAAY,CAACiG,GAAb,CAAiB,KAAK/I,UAAL,CAAgBgD,SAAhB,EAAjB,EAA8C,CAA9C,EAAiD,iBAAjD,EAAoE,KAApE,CAAtB;;CACA,UAAIyN,eAAJ,EACA;CACC,aAAK7N,WAAL,CAAiB6N,eAAjB;CACA;;CAED,WAAKC,YAAL,GAAoBrP,IAAI,CAACsP,aAAL,IAAsB,EAA1C;CAEA,aAAO,IAAIxC,OAAJ,CAAY,UAACwB,OAAD,EAAUC,MAAV,EAAqB;CACvCgB,QAAAA,kBAAkB,CAACC,SAAnB,CAA6B,eAA7B,EAA8C;CAC7CC,UAAAA,WAAW,EAAE9I,eAAe,CAACN,uBAAhB,EADgC;CAE7CqJ,UAAAA,cAAc,EAAE,KAF6B;CAG7CC,UAAAA,aAAa,EAAEhJ,eAAe,CAACiJ,wBAAhB,EAH8B;CAI7CC,UAAAA,cAAc,EAAE;CAJ6B,SAA9C,EAKGhE,IALH,CAKQ,UAAAhF,OAAO,EAAI;CAClB,UAAA,MAAI,CAAClI,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,iBAApC,EAAuD;CACtDhC,YAAAA,MAAM,EAAE;CACP2B,cAAAA,QAAQ,EAAER,IAAI,CAAC8P;CADR,aAD8C;CAItDjJ,YAAAA,OAAO,EAAE;CACR4I,cAAAA,WAAW,EAAE5I,OAAO,CAAC4I,WADb;CAERC,cAAAA,cAAc,EAAE7I,OAAO,CAAC6I,cAFhB;CAGRC,cAAAA,aAAa,EAAE9I,OAAO,CAAC8I,aAHf;CAIR7I,cAAAA,cAAc,EAAEiJ,oBAAoB,IAAIA,oBAAoB,CAAClJ,OAAO,CAACgJ,cAAT,CAA5C,IAAwEE,oBAAoB,CAAClJ,OAAO,CAACgJ,cAAT,CAApB,CAA6CG;CAJ7H;CAJ6C,WAAvD,EAUGnE,IAVH,CAUQ;CAAA,mBAAMyC,OAAO,EAAb;CAAA,WAVR;CAWA,SAjBD;CAkBA,OAnBM,CAAP;CAoBA;CA3HF;CAAA;CAAA,oCA8HC;CAAA;;CACCnC,MAAAA,OAAO,CAAC2C,GAAR,CAAY,kBAAZ;CAEA,WAAKnQ,UAAL,CAAgB6D,WAAhB,CAA4ByN,iCAA5B,CAA8D,KAAKC,eAAL,CAAqBtB,IAArB,CAA0B,IAA1B,CAA9D;CAEA,WAAKjQ,UAAL,CAAgBwR,oBAAhB,CACCrQ,uBAAuB,CAACsQ,MAAxB,CAA+B;CAC9BxR,QAAAA,KAAK,EAAE,KAAKD,UAAL,CAAgBwQ,QAAhB,EADuB;CAE9BxQ,QAAAA,UAAU,EAAE,KAAKA,UAFa;CAG9BoB,QAAAA,OAAO,EAAE;CAHqB,OAA/B,CADD;CAQA,UAAIlB,MAAM,GAAG,KAAKF,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,eAAnC,EAAoD,KAAK7G,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAApD,CAAb;;CACA,UAAIxR,MAAJ,EACA;CACC,aAAKF,UAAL,CAAgBwQ,QAAhB,GAA2BlP,MAA3B,CAAkC,iBAAlC,EAAqD;CAACpB,UAAAA,MAAM,EAAE;CAC7DyB,YAAAA,MAAM,EAAEzB,MAAM,CAACyB,MAD8C;CAE7DI,YAAAA,YAAY,EAAE7B,MAAM,CAAC6B,YAAP,IAAuB;CAFwB;CAAT,SAArD;CAIA;;CAED,aAAO,KAAK/B,UAAL,CAAgB2R,SAAhB,CAA0B,IAA1B,EAAgC;CACtCvO,QAAAA,EAAE,EAAE,KAAKgL,QAD6B;CAEtC5K,QAAAA,QAAQ;CAF8B,OAAhC,EAIN0J,IAJM,CAID,UAAA0E,GAAG,EAAI;CACZ,QAAA,MAAI,CAACpO,QAAL,GAAgBoO,GAAhB;CACA,eAAO,IAAIzD,OAAJ,CAAY,UAACwB,OAAD,EAAUC,MAAV;CAAA,iBAAqBD,OAAO,EAA5B;CAAA,SAAZ,CAAP;CACA,OAPM,CAAP;CAQA;CA5JF;CAAA;CAAA,sCA+JC;CACCnC,MAAAA,OAAO,CAAC2C,GAAR,CAAY,oBAAZ;CAEA,WAAK0B,kBAAL,GAA0B1L,kBAAK,CAAC2L,QAAN,CAAe,KAAK9R,UAAL,CAAgB6D,WAAhB,CAA4BgO,kBAA3C,EAA+D,GAA/D,EAAoE,KAAK7R,UAAL,CAAgB6D,WAApF,CAA1B;;CAEA,UACCsC,kBAAK,CAACC,QAAN,CAAeC,KAAf,MACGyC,WAAW,CAACiJ,aAAZ,MAA+B,EAFnC,EAIA;;CAIA,aAAO,IAAI5D,OAAJ,CAAY,UAACwB,OAAD,EAAUC,MAAV;CAAA,eAAqBD,OAAO,EAA5B;CAAA,OAAZ,CAAP;CACA;CA7KF;CAAA;CAAA,4CAgLC;CAAA;;CACCnC,MAAAA,OAAO,CAAC2C,GAAR,CAAY,0BAAZ;CAEA1P,MAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBqR,MAApB,CAA2BC,UAA3B,CAAsC,KAAtC;CACAxR,MAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBuR,qBAApB,CAA0C,IAA1C;CAEArP,MAAAA,EAAE,CAACsP,cAAH,CAAkB,oBAAlB,EAAwC,YAAM;CAC7C;CACA,QAAA,MAAI,CAACnS,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,iBAApC,EAAuD;CAACkQ,UAAAA,MAAM,EAAE;CAC/DC,YAAAA,YAAY,EAAE;CADiD;CAAT,SAAvD;CAGA,OALD;CAOAxP,MAAAA,EAAE,CAACsP,cAAH,CAAkB,mBAAlB,EAAuC,YAAM;CAC5C3E,QAAAA,OAAO,CAAC2C,GAAR,CAAY,qBAAZ;CACAzE,QAAAA,6BAAY,CAACC,IAAb,CAAkBhG,kBAAS,CAACzF,MAAV,CAAiB0L,cAAnC,EAAmD;CAACjK,UAAAA,MAAM,EAAE,MAAI,CAAC3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAAT;CAAkDzG,UAAAA,QAAQ,EAAE,GAA5D;CAAiEC,UAAAA,oBAAoB,EAAE;CAAvF,SAAnD;CACA,OAHD;CAKAjJ,MAAAA,EAAE,CAACsP,cAAH,CAAkB,oBAAlB,EAAwC,YAAM;CAC7CI,QAAAA,aAAa,CAAC,MAAI,CAACC,uBAAN,CAAb;;CACA,QAAA,MAAI,CAACxS,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,iBAApC,EAAuD;CAACkQ,UAAAA,MAAM,EAAE;CAC/DC,YAAAA,YAAY,EAAE;CADiD;CAAT,SAAvD;CAGA,OALD;;CAOA,UAAMI,kBAAkB,GAAG,SAArBA,kBAAqB,GAC3B;CACChS,QAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoB+R,SAApB,CAA8B;CAACC,UAAAA,QAAQ,EAAE,kBAACtR,IAAD,EACzC;CACC,YAAA,MAAI,CAACuN,aAAL,GAAqBvN,IAAI,CAACuR,MAAL,KAAgB,SAArC;;CACA,gBAAI,MAAI,CAAChE,aAAT,EACA;CACCiE,cAAAA,UAAG,CAAC1O,KAAJ,CAAUC,KAAV,CAAgB,+BAAhB;CACA,aAHD,MAKA;CACCyO,cAAAA,UAAG,CAAC1O,KAAJ,CAAUC,KAAV,CAAgB,8BAAhB;CACA;CACD;CAX6B,SAA9B;CAYA,OAdD;;CAgBA3D,MAAAA,WAAW,CAAC0R,cAAZ,CAA2B,wBAA3B,EAAqD,YAAM;CAC1D3E,QAAAA,OAAO,CAACvD,IAAR,CAAa,sCAAb;CACA4I,QAAAA,UAAG,CAAC1O,KAAJ,CAAUC,KAAV,CAAgB,8BAAhB;CACA,OAHD;CAKA3D,MAAAA,WAAW,CAAC0R,cAAZ,CAA2B,wBAA3B,EAAqD,YAAM;CAC1D3E,QAAAA,OAAO,CAACvD,IAAR,CAAa,qCAAb;CACAwI,QAAAA,kBAAkB;CAClB,OAHD;CAKA5P,MAAAA,EAAE,CAACsP,cAAH,CAAkB,aAAlB,EAAiC,YACjC;CACCM,QAAAA,kBAAkB;CAElBhS,QAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoB+R,SAApB,CAA8B;CAACC,UAAAA,QAAQ,EAAE,kBAACtR,IAAD,EACzC;CACC,gBAAIA,IAAI,CAACuR,MAAL,KAAgB,SAApB,EACA;CACC,qBAAO,KAAP;CACA;;CAED,YAAA,MAAI,CAACrJ,eAAL,GAAuB2D,IAAvB,CAA4B,YAAM;CACjC,cAAA,MAAI,CAAC4F,mBAAL;;CACApH,cAAAA,6BAAY,CAACC,IAAb,CAAkBhG,kBAAS,CAACzF,MAAV,CAAiB6S,mBAAnC,EAAwD;CAACpR,gBAAAA,MAAM,EAAE,MAAI,CAAC3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B;CAAT,eAAxD;CACA5G,cAAAA,6BAAY,CAACC,IAAb,CAAkBhG,kBAAS,CAACzF,MAAV,CAAiB8S,aAAnC,EAAkD;CAACrR,gBAAAA,MAAM,EAAE,MAAI,CAAC3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B;CAAT,eAAlD;CACA,aAJD,EAIGnF,KAJH,CAIS,YAAM;CACd,cAAA,MAAI,CAAC2F,mBAAL;CACA,aAND;CAOA;CAd6B,SAA9B;CAeA,OAnBD;CAqBAjQ,MAAAA,EAAE,CAACsP,cAAH,CAAkB,aAAlB,EAAiC,YAAM;CACtC,QAAA,MAAI,CAACvD,aAAL,GAAqB,KAArB;CACAiE,QAAAA,UAAG,CAAC1O,KAAJ,CAAUC,KAAV,CAAgB,8BAAhB,EAFsC;CAItC,OAJD;CAMAvB,MAAAA,EAAE,CAACsP,cAAH,CAAkB,iBAAlB,EAAqCM,kBAArC;CACA5P,MAAAA,EAAE,CAACsP,cAAH,CAAkB,kBAAlB,EAAsC,YAAM;CAC3C,QAAA,MAAI,CAACvD,aAAL,GAAqB,KAArB;CACAiE,QAAAA,UAAG,CAAC1O,KAAJ,CAAUC,KAAV,CAAgB,8BAAhB;CACA,OAHD;CAKA3D,MAAAA,WAAW,CAAC0R,cAAZ,CAA2B,uCAA3B,EAAoE,UAACpS,MAAD,EAAY;CAC/E,YAAIyL,MAAM,GAAGzL,MAAM,CAACkT,MAAP,CAAcC,QAAd,GAAyBC,KAAzB,CAA+B,GAA/B,EAAoC,CAApC,CAAb;;CACA,QAAA,MAAI,CAACC,4BAAL,CAAkC5H,MAAlC,EAA0CzL,MAA1C;CACA,OAHD;CAIAU,MAAAA,WAAW,CAAC0R,cAAZ,CAA2B,uCAA3B,EAAoE,UAACpS,MAAD,EAAY;CAC/E,YAAIyL,MAAM,GAAGzL,MAAM,CAACkT,MAAP,CAAcC,QAAd,GAAyBC,KAAzB,CAA+B,GAA/B,EAAoC,CAApC,CAAb;;CACA,QAAA,MAAI,CAACE,4BAAL,CAAkC7H,MAAlC,EAA0CzL,MAA1C;CACA,OAHD;CAIAU,MAAAA,WAAW,CAAC0R,cAAZ,CAA2B,uBAA3B,EAAoD,UAACpS,MAAD,EAAY;CAC/DuT,QAAAA,uBAAI,CAAC3H,IAAL,CAAU;CACThE,UAAAA,IAAI,EAAE4L,6BAAU,CAACC,gBAAX,CAA4BC,MADzB;CAETC,UAAAA,QAAQ,EAAE,MAAI,CAACC,iBAAL,CAAuBC,WAAvB,EAFD;CAGTvS,UAAAA,IAAI,EAAE;CAACjB,YAAAA,OAAO,EAAE,YAAV;CAAwBL,YAAAA,MAAM,gCAAMA,MAAN;CAAc8T,cAAAA,eAAe,EAAE;CAA/B;CAA9B;CAHG,SAAV;CAKA,OAND;CAQApT,MAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBmT,SAApB,CAA8BC,SAA9B,CAAwC,KAAKC,iBAAL,EAAxC;CACA,WAAKC,wBAAL;CAEApR,MAAAA,EAAE,CAACqR,oBAAH,CAAwBC,WAAxB,CAAoC,KAAKC,oBAAL,CAA0BnE,IAA1B,CAA+B,IAA/B,CAApC;CAEA,WAAKoE,kBAAL,GAA0BlO,kBAAK,CAACmO,QAAN,CAAe,UAAC3S,MAAD,EAAS4S,MAAT,EAAiBC,QAAjB,EAA2BC,IAA3B,EAAoC;CAC5E,QAAA,MAAI,CAACzU,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,cAApC,EAAoD;CACnDP,UAAAA,MAAM,EAAEA,MAD2C;CAEnDC,UAAAA,EAAE,EAAE2S,MAF+C;CAGnDpS,UAAAA,MAAM,EAAE;CACPyQ,YAAAA,MAAM,EAAE8B,mBAAU,CAACC,MADZ;CAEPF,YAAAA,IAAI,EAAEA,IAFC;CAGPD,YAAAA,QAAQ,EAAEA;CAHH;CAH2C,SAApD;CASA,OAVyB,EAUvB,GAVuB,CAA1B;;CAYA,UAAI,CAACrO,kBAAK,CAACjG,MAAN,CAAauH,QAAb,CAAsB,KAAKzH,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAtB,CAAL,EACA;CACC,aAAKkD,oBAAL,GAA4B,IAA5B;CACAtU,QAAAA,UAAU,CAAC,YAAM;CAChB,UAAA,MAAI,CAACsU,oBAAL,GAA4B,KAA5B;;CACA,UAAA,MAAI,CAACrU,YAAL;CACA,SAHS,EAGP,IAHO,CAAV;CAKAsU,QAAAA,WAAW,CAAC,YAAM;CACjB,UAAA,MAAI,CAACtU,YAAL;CACA,SAFU,EAER,KAFQ,CAAX;CAGA,OAXD,MAaA;CACC,aAAKuU,mBAAL,GAA2B,KAA3B;CACAxU,QAAAA,UAAU,CAAC,YAAM;CAChB,UAAA,MAAI,CAACwU,mBAAL,GAA2B,IAA3B;;CACA,UAAA,MAAI,CAACvU,YAAL;CACA,SAHS,EAGP,IAHO,CAAV;CAIA;;CAED,WAAKA,YAAL;CAEA,WAAKwU,WAAL,GAAmB,IAAIC,eAAJ,CAAoB,KAAKhV,UAAL,CAAgBiV,SAAhB,EAApB,EAAiD,KAAKjV,UAAL,CAAgBkV,aAAhB,EAAjD,CAAnB;CAEA,aAAO,IAAI/G,OAAJ,CAAY,UAACwB,OAAD,EAAUC,MAAV;CAAA,eAAqBD,OAAO,EAA5B;CAAA,OAAZ,CAAP;CACA;CA/TF;CAAA;CAAA,qCAkUC;CAAA;;CACCnC,MAAAA,OAAO,CAAC2C,GAAR,CAAY,mBAAZ;;CAEA,UAAI,KAAKO,YAAL,IAAqB,KAAKA,YAAL,CAAkBrI,MAAlB,GAA2B,CAAhD,IAAqD,KAAKrI,UAAL,CAAgB6D,WAAhB,CAA4BsR,sBAA5B,EAAzD,EACA;CACC;CACA,aAAKzE,YAAL,GAAoB,KAAKA,YAAL,CAAkB0E,IAAlB,CAAuB,UAACC,CAAD,EAAIC,CAAJ,EAAU;CACpD,iBAAOD,CAAC,CAACrU,OAAF,CAAUY,EAAV,GAAe0T,CAAC,CAACtU,OAAF,CAAUY,EAAhC;CACA,SAFmB,CAApB;CAGA,aAAK8O,YAAL,GAAoB,KAAKA,YAAL,CAAkB6E,KAAlB,CAAwB,CAAxB,EAA2B,EAA3B,CAApB;CACAjV,QAAAA,UAAU,CAAC,YAAM;CAChB,UAAA,MAAI,CAACoQ,YAAL,GAAoB,MAAI,CAACA,YAAL,CAAkBvN,MAAlB,CAAyB,UAAAgB,KAAK,EAAI;CACrDtB,YAAAA,EAAE,CAAC2S,aAAH,CAAiB,uBAAjB,EAA0C,CAACrR,KAAD,CAA1C;CACA,mBAAO,KAAP;CACA,WAHmB,CAApB;CAIA,SALS,EAKP,EALO,CAAV;CAMA;;CAEDmP,MAAAA,uBAAI,CAACvD,SAAL,CACC,KAAK4D,iBAAL,GAAyB,IAAI7T,sBAAJ,CAA2B;CACnDG,QAAAA,KAAK,EAAE,KAAKD,UAAL,CAAgBwQ,QAAhB,EAD4C;CAEnDxQ,QAAAA,UAAU,EAAE,KAAKA,UAFkC;CAGnDE,QAAAA,MAAM,EAAE;CAH2C,OAA3B,CAD1B;CAOAoT,MAAAA,uBAAI,CAACvD,SAAL,CAAe;CACdpI,QAAAA,IAAI,EAAE9E,EAAE,CAAC0Q,UAAH,CAAcC,gBAAd,CAA+BC,MADvB;CAEdC,QAAAA,QAAQ,EAAE,IAFI;CAGdtT,QAAAA,OAAO,EAAE,eAHK;CAIduS,QAAAA,QAAQ,EAAE,kBAAC5S,MAAD,EACV;CACC,cACCA,MAAM,CAACgI,MAAP,KAAkB,MAAI,CAAC/H,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAAlB,IACGlV,MAAM,CAAC8B,QAAP,KAAoB,MAAI,CAAC7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAFxB,EAIA;CACCpP,YAAAA,GAAG,CAACC,eAAJ;CACA;CACD;CAba,OAAf;CAgBA+Q,MAAAA,uBAAI,CAACvD,SAAL,CAAe;CACdpI,QAAAA,IAAI,EAAE4L,6BAAU,CAACC,gBAAX,CAA4BiC,MADpB;CAEd9C,QAAAA,QAAQ,EAAE,KAAK+C,sBAAL,CAA4BzF,IAA5B,CAAiC,IAAjC;CAFI,OAAf;;CAKA,UAAI,CAAC9J,kBAAK,CAACjG,MAAN,CAAauH,QAAb,CAAsB,KAAKzH,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAtB,CAAL,EACA;CACC4B,QAAAA,uBAAI,CAACvD,SAAL,CAAe;CACdpI,UAAAA,IAAI,EAAE4L,6BAAU,CAACC,gBAAX,CAA4BmC,MADpB;CAEdhD,UAAAA,QAAQ,EAAE,KAAKiD,sBAAL,CAA4B3F,IAA5B,CAAiC,IAAjC;CAFI,SAAf;CAIA;;CAED,aAAO,IAAI9B,OAAJ,CAAY,UAACwB,OAAD,EAAUC,MAAV;CAAA,eAAqBD,OAAO,EAA5B;CAAA,OAAZ,CAAP;CACA;CAzXF;CAAA;CAAA,mCA4XC;CAAA;;CACCnC,MAAAA,OAAO,CAAC2C,GAAR,CAAY,kBAAZ;CACA,WAAKnQ,UAAL,CAAgBwQ,QAAhB,GAA2BT,SAA3B,CAAqC,UAAA8F,QAAQ;CAAA,eAAI,MAAI,CAACC,qBAAL,CAA2BD,QAA3B,CAAJ;CAAA,OAA7C;CAEA,WAAK5H,MAAL,GAAc,IAAd;CACA,WAAKC,WAAL,CAAiByB,OAAjB,CAAyB,IAAzB;CAEAlP,MAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,4BAAnC,EAAiE,CAAC;CACjEnU,QAAAA,QAAQ,EAAE,KAAK7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B;CADuD,OAAD,EAE9D,IAF8D,CAAjE,EAEU,WAFV;CAIA,aAAO,KAAKuE,WAAL,EAAP;CACA;CAxYF;CAAA;CAAA,2CA2YC;CAAA;;CACCzI,MAAAA,OAAO,CAAC2C,GAAR,CAAY,wBAAZ;CAEA,WAAKzB,KAAL,CAAWwH,IAAX,CAAgB,MAAhB,EAAwB,sBAAxB,EAAgD,IAAhD;;CAEA,UAAI,KAAKnH,WAAT,EACA;CACC;CACA;;CAED,UAAMpN,MAAM,GAAG,KAAK3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAAf;CAEA,WAAKzD,WAAL,CAAiBsH,OAAjB,CAAyB,UAAAC,KAAK,EAAI;CACjC,YAAIzU,MAAM,KAAKyU,KAAK,CAACC,SAAN,CAAgBzM,IAAhB,CAAqB7J,MAArB,CAA4B4B,MAA3C,EACA;CACC,cAAMiI,IAAI,GAAGwM,KAAK,CAACC,SAAN,CAAgBzM,IAAhB,CAAqB7J,MAArB,CAA4B6J,IAAzC;CACAA,UAAAA,IAAI,CAAC0M,aAAL,GAAqBF,KAAK,CAACC,SAAN,CAAgBzM,IAAhB,CAAqB7J,MAArB,CAA4B6B,EAAjD;;CAEA,UAAA,MAAI,CAAC2U,UAAL,CAAgB3M,IAAhB;CACA;CACD,OARD;CAUA,WAAKkF,aAAL,CAAmBqH,OAAnB,CAA2B,UAAAC,KAAK,EAAI;CACnC,YAAIzU,MAAM,KAAKyU,KAAK,CAACjW,KAAN,CAAYwB,MAA3B,EACA;CACC,UAAA,MAAI,CAACqI,UAAL,CAAgBoM,KAAK,CAACjW,KAAN,CAAYW,IAA5B,EAAkC,IAAlC,EAAwCsV,KAAK,CAACjW,KAAN,CAAYyB,EAApD;CACA;CACD,OALD;CAMA;CAvaF;CAAA;CAAA,4CA0aC;CAAA;;CACC4L,MAAAA,OAAO,CAAC2C,GAAR,CAAY,mCAAZ;CAEA,aAAO,IAAIhC,OAAJ,CAAY,UAAAwB,OAAO,EAAI;CAC7B,YAAM6G,YAAY,GAAG,OAAI,CAACC,eAAL,EAArB;;CACA,YAAMC,eAAe,GAAG,OAAI,CAACC,kBAAL,EAAxB;;CAEAxI,QAAAA,OAAO,CAACyI,GAAR,CAAY,CAACJ,YAAD,EAAeE,eAAf,CAAZ,EAA6CxJ,IAA7C,CAAkDyC,OAAlD;CACA,OALM,CAAP;CAOA;CApbF;CAAA;CAAA,yCAubC;CAAA;;CACC,UAAM5H,MAAM,GAAG,KAAK/H,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAAf;CACA,UAAMtT,MAAM,GAAG,KAAK3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAAf;CACA,UAAMuE,SAAS,aAAMhJ,cAAN,cAAwB9F,MAAxB,CAAf;CAEA,aAAO6I,kBAAkB,CAACC,SAAnB,CAA6B9C,qBAA7B,EAAoD,EAApD,EAAwD8I,SAAxD,EACL3J,IADK,CACA,UAAA7J,MAAM,EAAI;CACfyT,QAAAA,MAAM,CAACxL,MAAP,CAAcjI,MAAd,EAAsB8S,OAAtB,CAA8B,UAAAC,KAAK,EAAI;CACtC,cAAIzU,MAAM,KAAKyU,KAAK,CAACjW,KAAN,CAAYwB,MAA3B,EACA;CACC,YAAA,OAAI,CAACmN,aAAL,CAAmB5I,IAAnB,CAAwBkQ,KAAxB;CACA;CACD,SALD;CAMA,OARK,CAAP;CASA;CArcF;CAAA;CAAA,sCAwcC;CAAA;;CACC,UAAMrO,MAAM,GAAG,KAAK/H,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAAf;CACA,UAAMtT,MAAM,GAAG,KAAK3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAAf;CACA,UAAMuE,SAAS,aAAMhJ,cAAN,cAAwB9F,MAAxB,CAAf;CAEA,aAAO6I,kBAAkB,CAACC,SAAnB,CAA6B/C,kBAA7B,EAAiD,EAAjD,EAAqD+I,SAArD,EACL3J,IADK,CACA,UAAA7J,MAAM,EAAI;CACfyT,QAAAA,MAAM,CAACxL,MAAP,CAAcjI,MAAd,EAAsB8S,OAAtB,CAA8B,UAAAC,KAAK,EAAI;CACtC,cACC,OAAOA,KAAK,CAACC,SAAN,CAAgBzM,IAAvB,KAAgC,WAAhC,IACGjI,MAAM,KAAKyU,KAAK,CAACC,SAAN,CAAgBzM,IAAhB,CAAqB7J,MAArB,CAA4B4B,MAF3C,EAIA;CACC,YAAA,OAAI,CAACkN,WAAL,CAAiB3I,IAAjB,CAAsBkQ,KAAtB;CACA;CACD,SARD;CASA,OAXK,CAAP;CAYA;CAzdF;CAAA;CAAA,4BA4dC;CACC,UAAI,KAAKnI,MAAT,EACA;CACC,YAAI8I,OAAO,GAAG,IAAIlU,EAAE,CAACsL,OAAP,EAAd;CACA4I,QAAAA,OAAO,CAACpH,OAAR,CAAgB,IAAhB;CAEA,eAAOoH,OAAP;CACA;;CAED,aAAO,KAAK7I,WAAZ;CACA;CAteF;CAAA;CAAA,kCAyeC;CAAA;;CACCV,MAAAA,OAAO,CAAC2C,GAAR,CAAY,gBAAZ;;CACA,UAAI,KAAK6G,eAAT,EACA;CACC,eAAO,KAAKA,eAAZ;CACA;;CAED,WAAKtI,KAAL,CAAWuI,KAAX,CAAiB,MAAjB,EAAyB,MAAzB,EAAiC,EAAjC,EAAqC,YAAM;CAC1CzJ,QAAAA,OAAO,CAACvD,IAAR,CAAa,4DAAb;CACA3H,QAAAA,GAAG,CAAC4U,WAAJ,CAAgB,WAAhB,EAA6B;CAACC,UAAAA,WAAW,EAAE,IAAd;CAAoBC,UAAAA,cAAc,EAAE;CAApC,SAA7B;CACA,OAHD;CAKA,WAAK1I,KAAL,CAAWuI,KAAX,CAAiB,MAAjB,EAAyB,sBAAzB,EAAiD,CAAjD,EAAoD,YAAM;CACzD,QAAA,OAAI,CAACI,oBAAL;CACA,OAFD;CAIA,WAAKL,eAAL,GAAuB,IAAI7I,OAAJ,CAAY,UAACwB,OAAD,EAAUC,MAAV,EACnC;CAAA;;CACC,YAAI0H,KAAK,qDACPC,0BAAiB,CAACC,qBADX,EACmC,CAAC5K,mBAAU,CAAC4K,qBAAZ,EAAmC,EAAnC,CADnC,uCAEPD,0BAAiB,CAACE,SAFX,EAEuB,CAAC7K,mBAAU,CAAC6K,SAAZ,EAAuB;CAAC3V,UAAAA,SAAS,EAAE,OAAI,CAAC9B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B;CAAZ,SAAvB,CAFvB,uCAGP6F,0BAAiB,CAACG,uBAHX,EAGqC,CAAC9K,mBAAU,CAAC+K,mBAAZ,EAAiC;CAC7E7V,UAAAA,SAAS,EAAE,OAAI,CAAC9B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EADkE;CAE7EkG,UAAAA,KAAK,EAAE,OAAI,CAAC5X,UAAL,CAAgB6D,WAAhB,CAA4BgU,sBAA5B,EAFsE;CAG7EC,UAAAA,YAAY,EAAE;CAH+D,SAAjC,CAHrC,uCAQPP,0BAAiB,CAACQ,cARX,EAQ4B,CAACnL,mBAAU,CAACmL,cAAZ,EAA4B;CAACjW,UAAAA,SAAS,EAAE,OAAI,CAAC9B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAZ;CAAuDlG,UAAAA,MAAM,EAAE;CAA/D,SAA5B,CAR5B,uCASP+L,0BAAiB,CAACS,mBATX,EASiC,CAACpL,mBAAU,CAACoL,mBAAZ,EAAiC,EAAjC,CATjC,UAAT;;CAWA,YAAI7R,kBAAK,CAACjG,MAAN,CAAauH,QAAb,CAAsB,OAAI,CAACzH,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAtB,CAAJ,EACA;CACC4F,UAAAA,KAAK,CAACC,0BAAiB,CAACU,SAAnB,CAAL,GAAqC,CAACrL,mBAAU,CAACqL,SAAZ,EAAuB,EAAvB,CAArC;CACA,SAHD,MAKA;CACCX,UAAAA,KAAK,CAACC,0BAAiB,CAACW,aAAnB,CAAL,GAAyC,CAACtL,mBAAU,CAACsL,aAAZ,EAA2B;CAACtW,YAAAA,EAAE,EAAE,CAAC,OAAI,CAAC5B,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAAD,EAA0C,OAAI,CAACjV,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAA1C;CAAL,WAA3B,CAAzC;CACA;;CAED,QAAA,OAAI,CAAC1R,UAAL,CAAgBmY,UAAhB,CAA2BC,SAA3B,CAAqCd,KAArC,EAA4C,UAACe,QAAD,EAC5C;CACC,cAAI,CAACA,QAAL,EACA;CACC,YAAA,OAAI,CAACrB,eAAL,GAAuB,IAAvB;;CACA,YAAA,OAAI,CAACsB,QAAL,CAAc,gBAAd,EAAgC,oCAAhC;;CAEA3I,YAAAA,OAAO;CACP,mBAAO,KAAP;CACA;;CAED,cAAI4I,QAAQ,GAAGF,QAAQ,CAACd,0BAAiB,CAACC,qBAAnB,CAAvB;;CACA,cAAIe,QAAQ,CAACnW,KAAT,EAAJ,EACA;CACCoL,YAAAA,OAAO,CAACvD,IAAR,CAAa,mBAAb,EAAkCsO,QAAQ,CAACnW,KAAT,GAAiBC,EAAjB,CAAoBD,KAAtD,EAA6DmW,QAAQ,CAACnW,KAAT,GAAiBC,EAAjB,CAAoBmW,iBAAjF;CACAhL,YAAAA,OAAO,CAACvD,IAAR,CAAa,gBAAb;CACA3J,YAAAA,UAAU,CAAC;CAAA,qBAAM,OAAI,CAAC2V,WAAL,EAAN;CAAA,aAAD,EAA2B,IAA3B,CAAV;CACA,WALD,MAOA;CACC,YAAA,OAAI,CAACjW,UAAL,CAAgByY,iBAAhB,CAAkClB,0BAAiB,CAACC,qBAApD,EAA2Ee,QAA3E;CACA;;CAED,cAAIG,UAAU,GAAGL,QAAQ,CAACd,0BAAiB,CAACS,mBAAnB,CAAzB;;CACA,cAAIU,UAAU,IAAI,CAACA,UAAU,CAACtW,KAAX,EAAnB,EACA;CACC,YAAA,OAAI,CAACpC,UAAL,CAAgByY,iBAAhB,CAAkClB,0BAAiB,CAACS,mBAApD,EAAyEU,UAAzE;CACA;;CAED,cAAIC,OAAO,GAAGN,QAAQ,CAACd,0BAAiB,CAACU,SAAnB,CAAtB;;CACA,cAAIU,OAAO,IAAI,CAACA,OAAO,CAACvW,KAAR,EAAhB,EACA;CACC,YAAA,OAAI,CAACpC,UAAL,CAAgByY,iBAAhB,CAAkClB,0BAAiB,CAACU,SAApD,EAA+DU,OAA/D;CACA;;CAED,cAAIC,WAAW,GAAGP,QAAQ,CAACd,0BAAiB,CAACW,aAAnB,CAA1B;;CACA,cAAIU,WAAW,IAAI,CAACA,WAAW,CAACxW,KAAZ,EAApB,EACA;CACC,YAAA,OAAI,CAACpC,UAAL,CAAgByY,iBAAhB,CAAkClB,0BAAiB,CAACW,aAApD,EAAmEU,WAAnE;CACA;;CAED,cAAIC,aAAa,GAAGR,QAAQ,CAACd,0BAAiB,CAACE,SAAnB,CAA5B;;CACA,UAAA,OAAI,CAACzX,UAAL,CAAgByY,iBAAhB,CAAkClB,0BAAiB,CAACE,SAApD,EAA+DoB,aAA/D;;CACA,UAAA,OAAI,CAACtY,YAAL;;CAEA,cAAIuY,uBAAuB,GAAGT,QAAQ,CAACd,0BAAiB,CAACG,uBAAnB,CAAtC;;CACA,cAAIoB,uBAAuB,CAAC1W,KAAxB,EAAJ,EACA,CADA,MAKA;CACCE,YAAAA,GAAG,CAAC4U,WAAJ,CAAgB,WAAhB,EAA6B;CAACC,cAAAA,WAAW,EAAE,KAAd;CAAqBC,cAAAA,cAAc,EAAE;CAArC,aAA7B;;CACA,YAAA,OAAI,CAAC1I,KAAL,CAAWwH,IAAX,CAAgB,MAAhB,EAAwB,MAAxB,EAAgC,IAAhC;;CAEA,YAAA,OAAI,CAAClW,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,sBAApC,EAA4D;CAC3DL,cAAAA,QAAQ,EAAE,OAAI,CAAC7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EADiD;CAE3D/P,cAAAA,MAAM,EAAE,OAAI,CAAC3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B;CAFmD,aAA5D;;CAKA,gBAAI,OAAI,CAACtS,UAAL,CAAgB+Y,eAApB,EACA;CACC,cAAA,OAAI,CAAC/Y,UAAL,CAAgB+Y,eAAhB,CAAgCC,MAAhC,CAAuCC,IAAvC,GAA8C,KAA9C;CACA;;CAED,YAAA,OAAI,CAACjZ,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,iBAApC,EAAuD;CAAChC,cAAAA,MAAM,EAAE;CAC/DgZ,gBAAAA,kBAAkB,EAAE;CAD2C;CAAT,aAAvD,EAEIhM,IAFJ,CAES,YAAM;CACd,cAAA,OAAI,CAAClN,UAAL,CAAgByY,iBAAhB,CAAkClB,0BAAiB,CAACG,uBAApD,EAA6EoB,uBAA7E;CACA,aAJD;;CAMA,YAAA,OAAI,CAAChG,mBAAL;CACA;;CAED,UAAA,OAAI,CAACkE,eAAL,GAAuB,IAAvB;CACArH,UAAAA,OAAO;CAEP,SA7ED,EA6EG,KA7EH,EA6EU,KA7EV,EA6EiBxJ,kBAAK,CAACgT,oBAAN,CAA2B;CAACjY,UAAAA,IAAI,EAAE,kBAAP;CAA2BhB,UAAAA,MAAM,EAAE,OAAI,CAACF,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B;CAAnC,SAA3B,CA7EjB;CA8EA,OApGsB,CAAvB;CAsGA,aAAO,KAAKpC,eAAZ;CACA;CAhmBF;CAAA;CAAA,yCAkmBsBqC,SAlmBtB,EAkmBiChD,SAlmBjC,EAkmB4CpD,MAlmB5C,EAmmBC;CACC,UAAIoG,SAAS,KAAKxW,EAAE,CAACyW,mBAAH,CAAuBC,oBAAzC,EACA;CACC/L,QAAAA,OAAO,CAAC2C,GAAR,CAAY,+BAAZ,EAA6CkJ,SAA7C,EAAwDpG,MAAxD,EAAgEoD,SAAhE;CACA;;CAED,UAAIgD,SAAS,KAAKxW,EAAE,CAACyW,mBAAH,CAAuBC,oBAAzC,EACA;CACC,YAAIlD,SAAS,CAACmD,OAAV,GAAoB,EAAxB,EACA;CACCnD,UAAAA,SAAS,CAACmD,OAAV,GAAoB,EAApB;CACA;;CACD,aAAKnF,kBAAL,CAAwBgC,SAAS,CAACzM,IAAV,CAAe7J,MAAf,CAAsB4B,MAA9C,EAAsD0U,SAAS,CAACzM,IAAV,CAAe7J,MAAf,CAAsB6J,IAAtB,CAA2BhI,EAAjF,EAAqFyU,SAAS,CAACmD,OAA/F,EAAwGnD,SAAS,CAACoD,SAAlH;CACA,OAPD,MAQK,IAAIJ,SAAS,KAAKxW,EAAE,CAACyW,mBAAH,CAAuBI,YAAzC,EACL;CACC,YAAIrD,SAAS,CAAChT,MAAV,CAAiBuP,MAAjB,KAA4B,OAAhC,EACA;CACC;CACApF,UAAAA,OAAO,CAACpL,KAAR,CAAc,mBAAd,EAAmCiU,SAAS,CAAChT,MAAV,CAAiBsW,MAAjB,CAAwB,CAAxB,EAA2B3Y,OAA9D;CACA,SAJD,MAMA;CACC,eAAKhB,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,cAApC,EAAoD;CACnDP,YAAAA,MAAM,EAAE0U,SAAS,CAACzM,IAAV,CAAe7J,MAAf,CAAsB4B,MADqB;CAEnDC,YAAAA,EAAE,EAAEyU,SAAS,CAACzM,IAAV,CAAe7J,MAAf,CAAsB6J,IAAtB,CAA2BhI,EAFoB;CAGnDO,YAAAA,MAAM,EAAE;CACPyQ,cAAAA,MAAM,EAAE8B,mBAAU,CAACkF,IADZ;CAEPpF,cAAAA,QAAQ,EAAE;CAFH;CAH2C,WAApD;CAQA;CACD,OAlBI,MAmBA,IAAI6E,SAAS,KAAK,2BAAlB,EACL;CACC7L,QAAAA,OAAO,CAACtE,IAAR,CAAa,yDAAb,EAAwEmN,SAAxE,EAAmFpD,MAAnF;CAEA,YAAIrJ,IAAI,GAAGyM,SAAS,CAAChT,MAAV,CAAiBwW,KAAjB,CAAuB,WAASxD,SAAS,CAAChT,MAAV,CAAiByW,OAAjB,CAAyB,CAAzB,CAAhC,CAAX;CAEA,aAAK9Z,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,cAApC,EAAoD;CACnDP,UAAAA,MAAM,EAAE0U,SAAS,CAACzM,IAAV,CAAe7J,MAAf,CAAsB4B,MADqB;CAEnDC,UAAAA,EAAE,EAAEyU,SAAS,CAACzM,IAAV,CAAe7J,MAAf,CAAsB6J,IAAtB,CAA2BhI,EAFoB;CAGnDO,UAAAA,MAAM,EAAE;CACPyQ,YAAAA,MAAM,EAAE8B,mBAAU,CAACC,MADZ;CAEPH,YAAAA,QAAQ,EAAE,GAFH;CAGP5S,YAAAA,EAAE,EAAEgI,IAAI,CAAChI,EAHF;CAIP6S,YAAAA,IAAI,EAAE7K,IAAI,CAAC6K,IAJJ;CAKPsF,YAAAA,WAAW,EAAEnQ,IAAI,CAACmQ,WALX;CAMPC,YAAAA,UAAU,EAAEpQ,IAAI,CAACoQ,UANV;CAOPC,YAAAA,OAAO,EAAErQ,IAAI,CAACqQ;CAPP;CAH2C,SAApD;CAaA,OAnBI,MAoBA,IAAIZ,SAAS,KAAK,wBAAlB,EACL;CACC7L,QAAAA,OAAO,CAACpL,KAAR,CAAc,sDAAd,EAAsEiU,SAAtE,EAAiFpD,MAAjF,EADD;CAGC,OAJI,MAKA,IACJoG,SAAS,KAAKxW,EAAE,CAACyW,mBAAH,CAAuBY,cAArC,IACGb,SAAS,KAAKxW,EAAE,CAACyW,mBAAH,CAAuBa,cAFpC,EAIL;CACC,aAAKxQ,gBAAL,CAAsB0M,SAAS,CAACzM,IAAV,CAAe7J,MAAf,CAAsB6J,IAAtB,CAA2BhI,EAAjD;CACA,OANI,MAOA,IACJyX,SAAS,KAAKxW,EAAE,CAACyW,mBAAH,CAAuBc,mBAArC,IACGf,SAAS,KAAKxW,EAAE,CAACyW,mBAAH,CAAuBe,kBADxC,IAEGhB,SAAS,KAAKxW,EAAE,CAACyW,mBAAH,CAAuBgB,eAFxC,IAGGjB,SAAS,KAAKxW,EAAE,CAACyW,mBAAH,CAAuBiB,mBAJpC,EAML;CACC/M,QAAAA,OAAO,CAACpL,KAAR,CAAc,+BAAd,EAA+CiX,SAA/C,EAA0DhD,SAA1D,EAAqEpD,MAArE,EADD;CAGC;;CAED,aAAO,IAAP;CACA;CAhrBF;CAAA;CAAA,oCAkrBiBjM,KAlrBjB,EAmrBC;CACC,UAAIwT,eAAe,GAAG,SAAlBA,eAAkB,CAAC5Q,IAAD,EACtB;CACC,YAAIA,IAAI,CAACoQ,UAAL,IAAmBpQ,IAAI,CAACoQ,UAAL,CAAgBS,UAAhB,CAA2B,SAA3B,CAAvB,EACA;CACC7Q,UAAAA,IAAI,CAACoQ,UAAL,GAAkB,OAAKpQ,IAAI,CAACoQ,UAA5B;CACA;;CACD,YAAIpQ,IAAI,CAACqQ,OAAL,IAAgBrQ,IAAI,CAACqQ,OAAL,CAAaQ,UAAb,CAAwB,SAAxB,CAApB,EACA;CACC7Q,UAAAA,IAAI,CAACqQ,OAAL,GAAe,OAAKrQ,IAAI,CAACqQ,OAAzB;CACA;;CAED,YAAIrQ,IAAI,CAACjC,IAAL,KAAc+S,iBAAQ,CAACC,KAA3B,EACA;CACC,iBAAO/Q,IAAP;CACA;;CAED,YAAIA,IAAI,CAACoQ,UAAT,EACA;CACC,cAAIpQ,IAAI,CAACoQ,UAAL,CAAgBS,UAAhB,CAA2B,GAA3B,CAAJ,EACA;CACC7Q,YAAAA,IAAI,CAACoQ,UAAL,GAAkBY,aAAa,GAAChR,IAAI,CAACoQ,UAArC;CACA;;CAEDpQ,UAAAA,IAAI,CAACoQ,UAAL,GAAkBpQ,IAAI,CAACoQ,UAAL,CAChBa,OADgB,CACR,SADQ,EACG,WADH,EAEhBA,OAFgB,CAER,UAFQ,EAEI,YAFJ,CAAlB;CAGA;;CAED,YAAIjR,IAAI,CAACqQ,OAAT,EACA;CACC,cAAIrQ,IAAI,CAACqQ,OAAL,CAAaQ,UAAb,CAAwB,GAAxB,CAAJ,EACA;CACC7Q,YAAAA,IAAI,CAACqQ,OAAL,GAAeW,aAAa,GAAChR,IAAI,CAACqQ,OAAlC;CACA;;CAEDrQ,UAAAA,IAAI,CAACqQ,OAAL,GAAerQ,IAAI,CAACqQ,OAAL,CACbY,OADa,CACL,SADK,EACM,WADN,EAEbA,OAFa,CAEL,UAFK,EAEO,YAFP,CAAf;CAGA;;CAED,eAAOjR,IAAP;CACA,OAzCD;;CA2CA,UAAI5C,KAAK,YAAY8T,KAArB,EACA;CACC,eAAO9T,KAAK,CAAC+T,GAAN,CAAU,UAAAnR,IAAI;CAAA,iBAAI4Q,eAAe,CAAC5Q,IAAD,CAAnB;CAAA,SAAd,CAAP;CACA,OAHD,MAKA;CACC,eAAO4Q,eAAe,CAACxT,KAAD,CAAtB;CACA;CACD;CAEF;;CAEA;;CA3uBA;CAAA;CAAA,mCA6uBC;CAAA;;CACC,UAAIgU,gBAAJ;;CACA,UAAI7U,kBAAK,CAACjG,MAAN,CAAauH,QAAb,CAAsB,KAAKzH,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAtB,CAAJ,EACA;CACCsJ,QAAAA,gBAAgB,GAAG,KAAKC,mBAAL,EAAnB;CACA,aAAKhH,wBAAL;CACA,OAJD,MAMA;CACC+G,QAAAA,gBAAgB,GAAG,KAAKE,mBAAL,EAAnB;CACA;;CAED,UAAI,CAACF,gBAAL,EACA;CACC,eAAO,KAAP;CACA;;CAED,WAAKG,gBAAL;;CAEA,UAAI,CAAC,KAAKC,gBAAV,EACA;CACC3a,QAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBC,MAApB,CAA2BC,KAA3B,CAAiCd,MAAjC,CAAwCqX,cAAxC,GAAyD,IAAzD;CACA3W,QAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBC,MAApB,CAA2BC,KAA3B,CAAiCwa,WAAjC,CAA6C;CAAA,iBAAM,OAAI,CAACC,cAAL,EAAN;CAAA,SAA7C;CAEA,aAAKF,gBAAL,GAAwB,IAAxB;CACA;;CAED,UAAIJ,gBAAgB,CAAC9Z,IAArB,EACA;CACCT,QAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBC,MAApB,CAA2BC,KAA3B,CAAiC0a,OAAjC,CAAyCP,gBAAgB,CAAC9Z,IAA1D;CACA;;CACD,UAAI8Z,gBAAgB,CAACQ,IAArB,EACA;CACC/a,QAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBC,MAApB,CAA2BC,KAA3B,CAAiC4a,aAAjC,CAA+CT,gBAAgB,CAACQ,IAAhE;CACA;;CACD,UAAIR,gBAAgB,CAACU,MAArB,EACA;CACCjb,QAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBC,MAApB,CAA2BC,KAA3B,CAAiC8a,QAAjC,CAA0CX,gBAAgB,CAACU,MAA3D;CACA,OAHD,MAIK,IAAIV,gBAAgB,CAACvU,KAArB,EACL;CACC;CACAhG,QAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBC,MAApB,CAA2BC,KAA3B,CAAiCd,MAAjC,CAAwC6b,UAAxC,GAAqDZ,gBAAgB,CAACvU,KAAtE;CACA;;CAED,aAAO,IAAP;CACA;CA3xBF;CAAA;CAAA,0CA8xBC;CACC,UAAIK,IAAI,GAAG,KAAK9G,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,WAAnC,EAAgD,KAAK7G,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAhD,CAAX;;CACA,UAAI,CAAC5K,IAAD,IAAS,CAACA,IAAI,CAAC4B,IAAnB,EACA;CACC,eAAO,KAAP;CACA;;CAED,UAAIrF,MAAM,GAAG;CACZ,gBAAQ,IADI;CAEZ,gBAAQ,IAFI;CAGZ,kBAAU,IAHE;CAIZ,iBAAS;CAJG,OAAb;;CAOA,UAAIyD,IAAI,CAAC4U,MAAT,EACA;CACCrY,QAAAA,MAAM,CAACqY,MAAP,GAAgB5U,IAAI,CAAC4U,MAArB;CACA,OAHD,MAKA;CACCrY,QAAAA,MAAM,CAACoD,KAAP,GAAeK,IAAI,CAACL,KAApB;CACA;;CAEDpD,MAAAA,MAAM,CAACnC,IAAP,GAAc4F,IAAI,CAAC5F,IAAnB;CAEA,UAAI2a,YAAY,GAAG,KAAnB;;CAEA,UAAI,CAAC,KAAKjH,oBAAN,IAA8B9N,IAAI,CAACgV,gBAAvC,EACA;CACCD,QAAAA,YAAY,GAAG1V,kBAAK,CAACW,IAAN,CAAWiV,eAAX,CAA2BjV,IAA3B,EAAiC,KAAKkV,WAAL,EAAjC,CAAf;CACA;;CAED,UAAIH,YAAJ,EACA;CACCxY,QAAAA,MAAM,CAACmY,IAAP,GAAcK,YAAd;CACA,OAHD,MAKA;CACC,YAAI/U,IAAI,CAACmV,YAAT,EACA;CACC5Y,UAAAA,MAAM,CAACmY,IAAP,GAAc1U,IAAI,CAACmV,YAAnB;CACA,SAHD,MAKA;CACC5Y,UAAAA,MAAM,CAACmY,IAAP,GAAc,KAAKQ,WAAL,CAAiB,mCAAjB,CAAd;CACA;CACD;;CAED,aAAO3Y,MAAP;CACA;CA/0BF;CAAA;CAAA,0CAk1BC;CACC,UAAInD,MAAM,GAAG,KAAKF,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,eAAnC,EAAoD,KAAK7G,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAApD,CAAb;;CACA,UAAI,CAACxR,MAAD,IAAW,CAACA,MAAM,CAACwI,IAAvB,EACA;CACC,eAAO,KAAP;CACA;;CAED,UAAIrF,MAAM,GAAG;CACZ,gBAAQ,IADI;CAEZ,gBAAQ,IAFI;CAGZ,kBAAU,IAHE;CAIZ,iBAAS;CAJG,OAAb;;CAOA,UAAInD,MAAM,CAACwb,MAAX,EACA;CACCrY,QAAAA,MAAM,CAACqY,MAAP,GAAgBxb,MAAM,CAACwb,MAAvB;CACA,OAHD,MAKA;CACCrY,QAAAA,MAAM,CAACoD,KAAP,GAAevG,MAAM,CAACuG,KAAtB;CACA;;CAED,UAAIvG,MAAM,CAACgc,UAAP,KAAsB,SAA1B,EACA;CACC7Y,QAAAA,MAAM,CAACqY,MAAP,GAAgBS,SAAS,CACxB,KAAKnc,UAAL,CAAgBoc,OAAhB,KAA4B,mFADJ,CAAzB;CAGA;;CAED/Y,MAAAA,MAAM,CAACnC,IAAP,GAAchB,MAAM,CAACgB,IAArB;CAEA,UAAImb,aAAa,GAAG,KAAKL,WAAL,CAAiB,uCAAjB,CAApB;;CACA,UAAI,KAAKlH,mBAAL,IAA4B,KAAKkH,WAAL,GAAmB,oCAAnB,CAAhC,EACA;CACCK,QAAAA,aAAa,GAAG,KAAKL,WAAL,CAAiB,oCAAjB,EAAuDnB,OAAvD,CAA+D,SAA/D,EAA0E3a,MAAM,CAACoc,WAAjF,CAAhB;CACA,OAHD,MAIK,IAAI,KAAKN,WAAL,GAAmB,kCAAgC9b,MAAM,CAACyH,IAAP,CAAY4U,WAAZ,EAAhC,GAA0D,MAA7E,CAAJ,EACL;CACCF,QAAAA,aAAa,GAAG,KAAKL,WAAL,CAAiB,kCAAgC9b,MAAM,CAACyH,IAAP,CAAY4U,WAAZ,EAAhC,GAA0D,MAA3E,CAAhB;CACA;;CACDlZ,MAAAA,MAAM,CAACmY,IAAP,GAAca,aAAd;CAEA,aAAOhZ,MAAP;CACA;CA93BF;CAAA;CAAA,+CAi4BC;CACC,UAAInD,MAAM,GAAG,KAAKF,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,eAAnC,EAAoD,KAAK7G,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAApD,CAAb;;CACA,UAAI,CAACxR,MAAD,IAAW,CAACA,MAAM,CAACwI,IAAvB,EACA;CACCjI,QAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBmT,SAApB,CAA8BrH,IAA9B;CACA,eAAO,IAAP;CACA;;CAED,UAAI4F,YAAY,GAAG,IAAnB;;CAEA,UAAInS,MAAM,CAACyH,IAAP,KAAgB,cAAhB,IAAkC,CAACzH,MAAM,CAAC0H,WAAP,CAAmBC,QAAnB,CAA4B,KAAK7H,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAA5B,CAAvC,EACA;CACC5C,QAAAA,YAAY,GAAG,KAAf;CACA;;CAED,UACC,OAAO,KAAKmK,gBAAZ,KAAiC,WAAjC,KAEC,KAAKA,gBAAL,IAAyBnK,YAAzB,IACG,CAAC,KAAKmK,gBAAN,IAA0B,CAACnK,YAH/B,CADD,EAOA;CACC,eAAO,KAAKmK,gBAAZ;CACA;;CAED,UAAInK,YAAJ,EACA;CACC5R,QAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBmT,SAApB,CAA8BrH,IAA9B;CACA,aAAK+P,gBAAL,GAAwB,IAAxB;CACA,OAJD,MAMA;CACC/b,QAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBmT,SAApB,CAA8B2I,IAA9B;CACA,aAAKD,gBAAL,GAAwB,KAAxB;CACA;;CAED,aAAO,KAAKA,gBAAZ;CACA;CAv6BF;CAAA;CAAA,uCA06BC;CAAA;;CACC,UAAI,KAAKE,cAAT,EACA;CACC,eAAO,IAAP;CACA;;CAED,UAAIvW,kBAAK,CAACjG,MAAN,CAAauH,QAAb,CAAsB,KAAKzH,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAtB,CAAJ,EACA;CACC,YAAIiL,UAAU,GAAG,KAAK3c,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B,EAAjB;;CACA,YAAI,CAACuD,UAAU,CAACjU,IAAhB,EACA;CACC,iBAAO,KAAP;CACA;;CAED,YAAIkU,mBAAmB,GAAG9T,WAAW,CAACiJ,aAAZ,MAA+B,EAAzD;CACA,YAAIrQ,eAAe,GAAG,KAAK1B,UAAL,CAAgB6D,WAAhB,CAA4BgZ,OAA5B,GAAsCtb,IAAtC,CAA2CG,eAAjE;;CACA,YACCib,UAAU,CAACL,WAAX,GAAyB5a,eAAzB,IACG,CAACkb,mBADJ,IAEGD,UAAU,CAACT,UAAX,KAA0B,WAA1B,IAAyCS,UAAU,CAACG,WAAX,KAA2B,WAHxE,EAKA;CACC,cAAIH,UAAU,CAAChV,IAAX,KAAoBoV,mBAAU,CAACxb,IAA/B,IAAuCob,UAAU,CAAC1a,YAAX,CAAwB+a,MAAnE,EACA;CACC1a,YAAAA,GAAG,CAACyJ,IAAJ,CAAS,iBAAT,EAA4B;CAACkR,cAAAA,KAAK,EAAC,CAClC;CACCtV,gBAAAA,IAAI,EAAE,WADP;CAECgL,gBAAAA,QAAQ,EAAE,oBAAM;CACfuK,kBAAAA,MAAM,CAACC,OAAP,CAAeC,eAAf,CAA+B,sBAA/B,EAAuD,EAAvD;;CACA,kBAAA,OAAI,CAACC,iBAAL;CACA;CALF,eADkC;CAAP,aAA5B;CASA,WAXD,MAaA;CACC/a,YAAAA,GAAG,CAACyJ,IAAJ,CAAS,iBAAT,EAA4B;CAACkR,cAAAA,KAAK,EAAE;CAAR,aAA5B;CACA;;CAED,eAAKP,cAAL,GAAsB,IAAtB;CACA,iBAAO,IAAP;CACA;CACD,OApCD,MAsCA;CACC,YAAIY,QAAQ,GAAG,KAAKtd,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,WAAnC,EAAgD,KAAK7G,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAhD,EAA2F,IAA3F,CAAf;;CACA,YAAI,CAAC4L,QAAQ,CAAC5U,IAAd,EACA;CACC,iBAAO,KAAP;CACA;;CAED,YACC,CAAC4U,QAAD,IACGA,QAAQ,CAACC,GADZ,IAEGD,QAAQ,CAACE,OAFZ,IAGG,KAAKxd,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,OAA4CwI,QAAQ,CAAC,KAAKzd,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAD,CAJxD,EAMA;CACCpP,UAAAA,GAAG,CAACyJ,IAAJ,CAAS,iBAAT,EAA4B;CAACkR,YAAAA,KAAK,EAAE;CAAR,WAA5B;CAEA,eAAKP,cAAL,GAAsB,IAAtB;CACA,iBAAO,IAAP;CACA;CACD;;CAEDpa,MAAAA,GAAG,CAACyJ,IAAJ,CAAS,iBAAT,EAA4B;CAACkR,QAAAA,KAAK,EAAE,CACnC;CACCtV,UAAAA,IAAI,EAAE,YADP;CAECgL,UAAAA,QAAQ,EAAE,oBAAM;CACf,gBAAIxM,kBAAK,CAACjG,MAAN,CAAauH,QAAb,CAAsB,OAAI,CAACzH,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAtB,CAAJ,EACA;CACCjR,cAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,cAAnC,EAAmD;CAClDnU,gBAAAA,QAAQ,EAAE,OAAI,CAAC7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EADwC;CAElDgM,gBAAAA,KAAK,EAAE,KAF2C;CAGlDC,gBAAAA,QAAQ,EAAE,OAAI,CAAC3d,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B;CAHwC,eAAnD,EAIG,OAJH;CAKA,aAPD,MASA;CACC,kBAAIkE,SAAQ,GAAG,OAAI,CAACtd,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,WAAnC,EAAgD,OAAI,CAAC7G,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAhD,EAA2F,IAA3F,CAAf;;CACAjR,cAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,cAAnC,EAAmD;CAClDjO,gBAAAA,MAAM,EAAE,OAAI,CAAC/H,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAD0C;CAElDgM,gBAAAA,KAAK,EAAE,KAF2C;CAGlDJ,gBAAAA,QAAQ,kCAAIA,SAAQ,CAAC1b,EAAb,EAAkB0b,SAAlB;CAH0C,eAAnD,EAIG,OAJH;CAKA;CACD;CApBF,SADmC,EAuBnC;CACC3V,UAAAA,IAAI,EAAE,YADP;CAECiW,UAAAA,SAAS,EAAE,YAFZ;CAGCjL,UAAAA,QAAQ,EAAE,oBACV;CACCuK,YAAAA,MAAM,CAACC,OAAP,CAAeC,eAAf,CAA+B,wBAA/B,EAAyD,EAAzD;;CAEA,gBAAIjX,kBAAK,CAACjG,MAAN,CAAauH,QAAb,CAAsB,OAAI,CAACzH,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAtB,CAAJ,EACA;CACCjR,cAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,cAAnC,EAAmD;CAClDnU,gBAAAA,QAAQ,EAAE,OAAI,CAAC7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EADwC;CAElDgM,gBAAAA,KAAK,EAAE,IAF2C;CAGlDC,gBAAAA,QAAQ,EAAE,OAAI,CAAC3d,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B;CAHwC,eAAnD,EAIG,OAJH;CAKA,aAPD,MASA;CACC3Y,cAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,cAAnC,EAAmD;CAClDnU,gBAAAA,QAAQ,EAAE,OAAI,CAAC7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EADwC;CAElDgM,gBAAAA,KAAK,EAAE,IAF2C;CAGlDJ,gBAAAA,QAAQ,kCACN,OAAI,CAACtd,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EADM,EACsC,OAAI,CAAC1R,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,WAAnC,EAAgD,OAAI,CAAC7G,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAhD,EAA2F,IAA3F,CADtC;CAH0C,eAAnD,EAMG,OANH;CAOA;CACD;CAzBF,SAvBmC;CAAR,OAA5B;CAoDA,WAAKgL,cAAL,GAAsB,IAAtB;CACA,aAAO,IAAP;CACA;CAjiCF;CAAA;CAAA,mCAoiCC;CAAA,UADa3c,MACb,uEADsB,EACtB;CAAA,0BACuEA,MADvE,CACMkB,KADN;CAAA,UACMA,KADN,8BACc,KADd;CAAA,0BACuElB,MADvE,CACqBc,KADrB;CAAA,UACqBA,KADrB,8BAC6B,EAD7B;CAAA,6BACuEd,MADvE,CACiC8d,QADjC;CAAA,UACiCA,QADjC,iCAC4C,MAD5C;CAAA,6BACuE9d,MADvE,CACoD+d,QADpD;CAAA,UACoDA,QADpD,iCAC+D,IAD/D;CAGC,UAAIC,QAAQ,GAAG;CACdld,QAAAA,KAAK,EAALA,KADc;CAEdmd,QAAAA,UAAU,EAAE;CAFE,OAAf;;CAIA,UAAIF,QAAJ,EACA;CACCC,QAAAA,QAAQ,CAACD,QAAT,GAAoB,EAApB;CACA;;CAEDxb,MAAAA,GAAG,CAACyJ,IAAJ,CAAS,eAAT,EAA0B;CACzB7K,QAAAA,IAAI,EAAE,kBADmB;CAEzB+c,QAAAA,aAAa,EAAE,gBAFU;CAGzBC,QAAAA,UAAU,EAAE,8CAA4Crb,EAAE,CAACqN,mBAAH,CAAuBnH,GAAvB,CAA2B,2BAA3B,EAAwD,OAAxD,CAH/B;CAIzBhJ,QAAAA,MAAM,EAAE;CACP,uBAAa,KAAKC,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EADN;CAEP,6BAAmB,KAAK1R,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B,GAA4C+E,OAFxD;CAGP,qBAAW,KAAKne,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAHJ;CAIP,uBAAa4I,QAJN;CAKP,mBAAS5c,KALF;CAMP,yBAAe;CANR,SAJiB;CAYzBmd,QAAAA,UAAU,EAAE;CAACld,UAAAA,IAAI,EAAE,MAAP;CAAe6c,UAAAA,QAAQ,EAARA;CAAf;CAZa,OAA1B,EAaG,KAbH;CAcA;CA9jCF;CAAA;CAAA,mCAikCC;CAAA;;CACCb,MAAAA,MAAM,CAACC,OAAP,CAAeC,eAAf,CAA+B,wBAA/B,EAAyD,EAAzD;CAEA,UAAIE,QAAQ,GAAG,KAAKtd,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,WAAnC,EAAgD,KAAK7G,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAhD,EAA2F,IAA3F,CAAf;;CAEA,UACC4L,QAAQ,CAACe,MAAT,CAAgBC,cAAhB,IACGhB,QAAQ,CAACe,MAAT,CAAgBE,SADnB,IAEGjB,QAAQ,CAACe,MAAT,CAAgBG,aAFnB,IAGGlB,QAAQ,CAACe,MAAT,CAAgBI,UAJpB,EAMA;CACCC,QAAAA,YAAY,CACVjN,MADF,CACS,yBAAuB,KAAKzR,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EADhC,EAEEiN,QAFF,CAEW,CACTC,gBAAgB,CAACnN,MAAjB,CAAwB,OAAxB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,+BAAjB,CADX,CADS,EAIT4C,gBAAgB,CAACnN,MAAjB,CAAwB,gBAAxB,EACEoN,QADF,CACWvB,QAAQ,CAACe,MAAT,CAAgBC,cAD3B,EAEEQ,WAFF,CAEc,KAAK9C,WAAL,CAAiB,yBAAjB,CAFd,EAGE/C,IAHF,CAGO,CAACqE,QAAQ,CAACe,MAAT,CAAgBC,cAHxB,CAJS,EASTM,gBAAgB,CAACnN,MAAjB,CAAwB,WAAxB,EACEoN,QADF,CACWvB,QAAQ,CAACe,MAAT,CAAgBE,SAD3B,EAEEO,WAFF,CAEc,KAAK9C,WAAL,CAAiB,uBAAjB,CAFd,EAGE/C,IAHF,CAGO,CAACqE,QAAQ,CAACe,MAAT,CAAgBE,SAHxB,CATS,EAcTK,gBAAgB,CAACnN,MAAjB,CAAwB,eAAxB,EACEoN,QADF,CACWvB,QAAQ,CAACe,MAAT,CAAgBG,aAD3B,EAEEM,WAFF,CAEc,KAAK9C,WAAL,CAAiB,wBAAjB,CAFd,EAGE/C,IAHF,CAGO,CAACqE,QAAQ,CAACe,MAAT,CAAgBG,aAHxB,CAdS,EAmBTI,gBAAgB,CAACnN,MAAjB,CAAwB,YAAxB,EACEoN,QADF,CACWvB,QAAQ,CAACe,MAAT,CAAgBI,UAD3B,EAEEK,WAFF,CAEc,KAAK9C,WAAL,CAAiB,wBAAjB,CAFd,EAGE/C,IAHF,CAGO,CAACqE,QAAQ,CAACe,MAAT,CAAgBI,UAHxB,CAnBS,CAFX,EA2BEM,UA3BF,CA2Balc,EAAE,CAACqN,mBAAH,CAAuBnH,GAAvB,CAA2B,8BAA3B,EAA2D,OAA3D,CA3Bb,EA4BEiW,gBA5BF,CA4BmB,UAAC9d,IAAD,EAAOnB,MAAP,EAAe+G,IAAf,EAAqBgX,QAArB,EAClB;CACC,cAAI5c,IAAI,KAAK,UAAb,EACA;CACC,mBAAO,KAAP;CACA;;CAED,cAAInB,MAAM,CAAC6B,EAAP,KAAc,OAAlB,EACA;CACCnB,YAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,cAAnC,EAAmD;CAClDjO,cAAAA,MAAM,EAAE,OAAI,CAAC/H,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAD0C;CAElDgM,cAAAA,KAAK,EAAE,KAF2C;CAGlDJ,cAAAA,QAAQ,kCAAIxW,IAAI,CAAClF,EAAT,EAAckF,IAAd;CAH0C,aAAnD,EAIG,OAJH;CAKA,WAPD,MAQK,IAAI/G,MAAM,CAAC6B,EAAP,KAAc,YAAlB,EACL;CACCiB,YAAAA,EAAE,CAACoc,WAAH,CAAeC,OAAf,CAAuBpY,IAAI,CAACuX,MAAL,CAAYte,MAAM,CAAC6B,EAAnB,CAAvB,EAA+C;CAAC+K,cAAAA,UAAU,EAAE;CAAb,aAA/C;CACA,WAHI,MAKL;CACC9J,YAAAA,EAAE,CAACoc,WAAH,CAAeC,OAAf,CAAuBpY,IAAI,CAACuX,MAAL,CAAYte,MAAM,CAAC6B,EAAnB,CAAvB,EAA+C;CAAC+K,cAAAA,UAAU,EAAE;CAAb,aAA/C,EADD;CAIC;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACD,SArFF,EAsFEwS,eAtFF,CAsFkB7B,QAtFlB,EAuFE7Q,IAvFF;CAyFA,OAhGD,MAkGA;CACChM,QAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,cAAnC,EAAmD;CAClDjO,UAAAA,MAAM,EAAE,KAAK/H,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAD0C;CAElDgM,UAAAA,KAAK,EAAE,KAF2C;CAGlDJ,UAAAA,QAAQ,kCAAI,KAAKtd,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAJ,EAAgD4L,QAAhD;CAH0C,SAAnD,EAIG,OAJH;CAKA;CACD;CA/qCF;CAAA;CAAA,gCAkrCC;CAAA;;CAAA,UADU8B,OACV,uEADoB,KACpB;;CACC,UAAI,CAACA,OAAL,EACA;CACC9c,QAAAA,GAAG,CAAC8c,OAAJ,CAAY;CACXve,UAAAA,KAAK,EAAE,KAAKmb,WAAL,CAAiB,kCAAjB,CADI;CAEXlb,UAAAA,IAAI,EAAE,EAFK;CAGXue,UAAAA,OAAO,EAAE,CACR,KAAKrD,WAAL,CAAiB,8BAAjB,CADQ,EAER,KAAKA,WAAL,CAAiB,6BAAjB,CAFQ,CAHE;CAOXrJ,UAAAA,QAAQ,EAAE,kBAAC2M,MAAD,EACV;CACC,gBAAIA,MAAM,KAAK,CAAf,EACA;CACC,cAAA,OAAI,CAACC,SAAL,CAAe,IAAf;CACA;CACD;CAbU,SAAZ;CAgBA,eAAO,IAAP;CACA;;CAED,UAAI1d,QAAQ,GAAG,KAAK7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAf;CAEA,WAAK1R,UAAL,CAAgBmY,UAAhB,CAA2BxL,UAA3B,CAAsCC,mBAAU,CAAC4S,WAAjD,EAA8D;CAACrO,QAAAA,SAAS,EAAEtP;CAAZ,OAA9D,EAAqF,IAArF,EAA2F,IAA3F,EAAiGsE,kBAAK,CAACgT,oBAAN,CAA2B;CAC3HjY,QAAAA,IAAI,EAAE0L,mBAAU,CAAC4S,WAD0G;CAE3Htf,QAAAA,MAAM,EAAE,KAAKF,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B,CAA0CvX,QAA1C;CAFmH,OAA3B,CAAjG,EAGIqL,IAHJ,CAGS,UAAAmL,QAAQ,EAAI;CACpB/V,QAAAA,GAAG,CAACC,eAAJ;CACA,OALD;CAMA;CAhtCF;CAAA;CAAA,wCAmtCC;CACC,UAAIkd,SAAS,GAAG,KAAKC,wBAAL,EAAhB;CAEApd,MAAAA,GAAG,CAACyJ,IAAJ,CAAS,eAAT,EAA0B;CACzB7K,QAAAA,IAAI,EAAE,kBADmB;CAEzB+c,QAAAA,aAAa,EAAE,uBAFU;CAGzBC,QAAAA,UAAU,EAAE,kDAAgDrb,EAAE,CAACqN,mBAAH,CAAuBnH,GAAvB,CAA2B,gCAA3B,EAA6D,OAA7D,CAHnC;CAIzBhJ,QAAAA,MAAM,EAAE;CACP,uBAAa,KAAKC,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EADN;CAEP,qBAAW,KAAK1R,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAFJ;CAIP,wBAAcwK,SAJP;CAKP,8BAAoB,EALb;CAMP,uBAAa,EANN;CAQP,6BAAmB5c,EAAE,CAACqN,mBAAH,CAAuBnH,GAAvB,CAA2B,uBAA3B,EAAoD,CAApD;CARZ,SAJiB;CAczBqV,QAAAA,UAAU,EAAE;CACXld,UAAAA,IAAI,EAAE,iBADK;CAEX6c,UAAAA,QAAQ,EAAE;CACTC,YAAAA,UAAU,EAAE,2BADH;CAETnd,YAAAA,KAAK,EAAEgC,EAAE,CAAC7B,OAAH,CAAW,6BAAX,CAFE;CAGT4W,YAAAA,KAAK,EAAE,GAHE;CAITqF,YAAAA,KAAK,EAAEwC,SAAS,CAAC1E,GAAV,CAAc,UAAA4E,OAAO;CAAA,qBAAIC,iBAAiB,CAACC,oBAAlB,CAAuCF,OAAvC,CAAJ;CAAA,aAArB,CAJE;CAKTG,YAAAA,MAAM,EAAE,CACP;CAAEjf,cAAAA,KAAK,EAAEgC,EAAE,CAAC7B,OAAH,CAAW,oBAAX,CAAT;CAA2CY,cAAAA,EAAE,EAAE;CAA/C,aADO,EAEP;CAAEf,cAAAA,KAAK,EAAEgC,EAAE,CAAC7B,OAAH,CAAW,0BAAX,CAAT;CAAiDY,cAAAA,EAAE,EAAE;CAArD,aAFO,CALC;CASTkc,YAAAA,QAAQ,EAAE;CAACiC,cAAAA,SAAS,EAAE;CAAZ;CATD;CAFC;CAda,OAA1B,EA4BG,KA5BH;CA6BA;CAnvCF;CAAA;CAAA,+CAsvCC;CACC,UAAI9C,KAAK,GAAG,EAAZ;CACA,UAAI+C,UAAU,GAAG,EAAjB;;CAEA,UAAI,KAAKjL,WAAL,CAAiBkL,UAAjB,CAA4B5X,MAA5B,GAAqC,CAAzC,EACA;CACC,aAAK0M,WAAL,CAAiBkL,UAAjB,CAA4BlF,GAA5B,CAAgC,UAAA4E,OAAO,EACvC;CACC,cAAI,CAACA,OAAD,IAAYK,UAAU,CAACL,OAAO,CAAC/d,EAAT,CAA1B,EACA;CACC,mBAAO,KAAP;CACA;;CAED,cAAI+d,OAAO,CAAChY,IAAR,KAAiB,MAArB,EACA;CACC,mBAAO,KAAP;CACA;;CAED,cAAIgY,OAAO,CAAC7Y,IAAR,CAAa0W,OAAb,IAAwBmC,OAAO,CAAC7Y,IAAR,CAAaoZ,SAAzC,EACA;CACC,mBAAO,KAAP;CACA;;CAEDjD,UAAAA,KAAK,CAAC/W,IAAN,CAAWyZ,OAAO,CAAC7Y,IAAnB;CACAkZ,UAAAA,UAAU,CAACL,OAAO,CAAC/d,EAAT,CAAV,GAAyB,IAAzB;CAEA,iBAAO,IAAP;CACA,SArBD;CAsBA;;CAED,WAAKmT,WAAL,CAAiBoL,cAAjB,CAAgCpF,GAAhC,CAAoC,UAAA4E,OAAO,EAC3C;CACC,YAAI,CAACA,OAAD,IAAYK,UAAU,CAACL,OAAO,CAAC/d,EAAT,CAA1B,EACA;CACC,iBAAO,KAAP;CACA;;CAED,YAAI+d,OAAO,CAACnC,OAAR,IAAmBmC,OAAO,CAACO,SAA/B,EACA;CACC,iBAAO,KAAP;CACA;;CAEDjD,QAAAA,KAAK,CAAC/W,IAAN,CAAWyZ,OAAX;CACAK,QAAAA,UAAU,CAACL,OAAO,CAAC/d,EAAT,CAAV,GAAyB,IAAzB;CACA,OAdD;CAgBA,WAAKmT,WAAL,CAAiBqL,cAAjB,CAAgCrF,GAAhC,CAAoC,UAAA4E,OAAO,EAC3C;CACC,YAAI,CAACA,OAAD,IAAYK,UAAU,CAACL,OAAO,CAAC/d,EAAT,CAA1B,EACA;CACC,iBAAO,KAAP;CACA;;CAED,YAAI,CAAC+d,OAAL,EACA;CACC,iBAAO,KAAP;CACA;;CAED,YAAIA,OAAO,CAAChY,IAAR,KAAiB,MAArB,EACA;CACC,iBAAO,KAAP;CACA;;CAED,YAAIgY,OAAO,CAAC7Y,IAAR,CAAa0W,OAAb,IAAwBmC,OAAO,CAAC7Y,IAAR,CAAaoZ,SAAzC,EACA;CACC,iBAAO,KAAP;CACA;;CAEDjD,QAAAA,KAAK,CAAC/W,IAAN,CAAWyZ,OAAO,CAAC7Y,IAAnB;CACAkZ,QAAAA,UAAU,CAACL,OAAO,CAAC/d,EAAT,CAAV,GAAyB,IAAzB;CAEA,eAAO,IAAP;CACA,OA1BD;CA4BA;;;;;;;;;CASA,aAAOqb,KAAP;CACA;CA10CF;CAAA;;CA40CA;;CAEA;CA90CA,0CAg1CuB5b,IAh1CvB,EAi1CC;CAAA;;CACC,UAAIA,IAAI,CAACsG,IAAL,KAAc,kBAAd,IAAoCtG,IAAI,CAACgf,OAAzC,IAAoDhf,IAAI,CAACgf,OAAL,CAAale,MAArE,EACA;CACC,YAAId,IAAI,CAACgf,OAAL,CAAaxe,QAAb,KAA0B,KAAK7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAA9B,EACA;CACC;CACA;;CAED,YACC,OAAOrQ,IAAI,CAACgf,OAAL,CAAale,MAAb,CAAoBjB,IAA3B,KAAoC,WAApC,IACG,OAAOG,IAAI,CAACgf,OAAL,CAAale,MAAb,CAAoBma,WAA3B,KAA2C,WAF/C,EAIA;CACC,cAAI,OAAOjb,IAAI,CAACgf,OAAL,CAAale,MAAb,CAAoBma,WAA3B,KAA2C,WAA/C,EACA;CACC,iBAAKI,cAAL,GAAsB,KAAtB;CACA;;CACD,eAAKnc,YAAL;CACA;;CAED,YACC,OAAOc,IAAI,CAACgf,OAAL,CAAale,MAAb,CAAoBme,OAA3B,KAAuC,WAAvC,IACG,OAAOjf,IAAI,CAACgf,OAAL,CAAaxe,QAApB,KAAiC,WAFrC,EAIA;CACCpB,UAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,6BAAnC,EAAkE,CAAC;CAClEnU,YAAAA,QAAQ,EAAER,IAAI,CAACgf,OAAL,CAAaxe,QAD2C;CAElEye,YAAAA,OAAO,EAAEjf,IAAI,CAACgf,OAAL,CAAale,MAAb,CAAoBme;CAFqC,WAAD,EAG/D,IAH+D,CAAlE,EAGU,WAHV;CAIA;CACD,OA7BD,MA8BK,IAAIjf,IAAI,CAACsG,IAAL,KAAc,eAAlB,EACL;CACCtG,QAAAA,IAAI,CAACgf,OAAL,CAAalK,OAAb,CAAqB,UAACjW,MAAD,EAAY;CAChC,cAAIA,MAAM,CAAC2B,QAAP,KAAoB,OAAI,CAAC7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAxB,EACA;CACC;CACA;;CAEDjR,UAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,6BAAnC,EAAkE,CAAC;CAClEnU,YAAAA,QAAQ,EAAE3B,MAAM,CAAC2B,QADiD;CAElEye,YAAAA,OAAO,EAAEpgB,MAAM,CAACogB;CAFkD,WAAD,EAG/D,IAH+D,CAAlE,EAGU,WAHV;CAIA,SAVD;CAWA;CACD;CA93CF;CAAA;CAAA,2CAg4CwBjf,IAh4CxB,EAi4CC;CAAA;;CACC,UAAIA,IAAI,CAACuR,MAAL,KAAgBW,6BAAU,CAACgN,UAAX,CAAsB5K,MAA1C,EACA;CACC;CACA,YAAI,KAAK5G,WAAT,EACA;CACCtO,UAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,+BAAnC,EAAoE,EAApE,EAAwE,YAAxE;CACAvV,UAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,6BAAnC,EAAkE,EAAlE,EAAsE,YAAtE;CACA;;CAED,YAAI,KAAKwK,kBAAT,EACA;CACC,eAAKxgB,UAAL,CAAgB+Y,eAAhB,CAAgCC,MAAhC,CAAuCC,IAAvC,GAA8C,IAA9C;CAEA,eAAK1P,eAAL,GAAuB2D,IAAvB,CAA4B,YAAM;CACjC,YAAA,OAAI,CAAClN,UAAL,CAAgB+Y,eAAhB,CAAgCC,MAAhC,CAAuCC,IAAvC,GAA8C,KAA9C;;CACA,YAAA,OAAI,CAACnG,mBAAL;;CACApH,YAAAA,6BAAY,CAACC,IAAb,CAAkBhG,kBAAS,CAACzF,MAAV,CAAiB6S,mBAAnC,EAAwD;CAACpR,cAAAA,MAAM,EAAE,OAAI,CAAC3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B;CAAT,aAAxD;CACA5G,YAAAA,6BAAY,CAACC,IAAb,CAAkBhG,kBAAS,CAACzF,MAAV,CAAiB8S,aAAnC,EAAkD;CAACrR,cAAAA,MAAM,EAAE,OAAI,CAAC3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B;CAAT,aAAlD;CACA,WALD,EAKGnF,KALH,CAKS,YAAM;CACd,YAAA,OAAI,CAACnN,UAAL,CAAgB+Y,eAAhB,CAAgCC,MAAhC,CAAuCC,IAAvC,GAA8C,KAA9C;;CACA,YAAA,OAAI,CAACnG,mBAAL;CACA,WARD;CAUA,eAAK0N,kBAAL,GAA0B,KAA1B;CACA,SAfD,MAiBA;CACC,eAAK7V,WAAL;CACA,eAAKmI,mBAAL;CACA;CACD,OA9BD,MA+BK,IAAIzR,IAAI,CAACuR,MAAL,KAAgBW,6BAAU,CAACgN,UAAX,CAAsBE,OAA1C,EACL;CACC,aAAKD,kBAAL,GAA0B,IAA1B;CACA;CACD;CAr6CF;CAAA;CAAA,2CAu6CwBnf,IAv6CxB,EAw6CC;CACC,UAAIA,IAAI,CAACjB,OAAL,KAAiB,MAAjB,IAA2BiB,IAAI,CAACjB,OAAL,KAAiB,YAAhD,EACA;CACC,aAAK,IAAI2H,MAAT,IAAmB1G,IAAI,CAACtB,MAAL,CAAYkB,KAA/B,EACA;CACC,cAAI,CAACI,IAAI,CAACtB,MAAL,CAAYkB,KAAZ,CAAkByf,cAAlB,CAAiC3Y,MAAjC,CAAL,EACA;CACC;CACA;;CAED,eAAK/H,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,cAApC,EAAoD;CACnDN,YAAAA,EAAE,EAAEP,IAAI,CAACtB,MAAL,CAAYkB,KAAZ,CAAkB8G,MAAlB,EAA0BnG,EADqB;CAEnDO,YAAAA,MAAM,EAAEd,IAAI,CAACtB,MAAL,CAAYkB,KAAZ,CAAkB8G,MAAlB;CAF2C,WAApD;;CAKA,cAAIA,MAAM,CAACmL,QAAP,OAAsB,KAAKlT,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAA1B,EACA;CACC,iBAAKnR,YAAL;CACA;CACD;CACD;CACD;CAEF;;CA/7CA;CAAA;CAAA,wCAk8CC;CAAA;;CACC,UAAIoc,UAAU,GAAG,KAAK3c,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B,EAAjB;CAEA,UAAIuH,OAAO,GAAG,KAAK3E,WAAL,CAAiB,UAAjB,CAAd;CAEA,aAAO;CACNlb,QAAAA,IAAI,EAAE6b,UAAU,GAAEA,UAAU,CAACiE,eAAb,GAA8B,EADxC;CAENC,QAAAA,WAAW,EAAE,KAAK7E,WAAL,CAAiB,+BAAjB,CAFP;CAGN8E,QAAAA,WAAW,EAAE,EAHP;CAINC,QAAAA,cAAc,EAAC,IAJT;CAKNC,QAAAA,gBAAgB,EAAE,IALZ;CAMNC,QAAAA,iBAAiB,EACjB;CACCC,UAAAA,UAAU,EAAE,IADb;CAECC,UAAAA,GAAG,EAAER,OAAO,GAAG;CAFhB,SAPM;CAWNS,QAAAA,kBAAkB,EAClB;CACCC,UAAAA,eAAe,EAAE,GADlB;CAECC,UAAAA,gBAAgB,EAAE,GAFnB;CAGCC,UAAAA,MAAM,EACN;CACCC,YAAAA,WAAW,EAAE,CAAC,CADf;CAECC,YAAAA,YAAY,EAAE,CAAC,CAFhB;CAGCC,YAAAA,UAAU,EAAE,CAHb;CAICC,YAAAA,YAAY,EAAE,CAJf;CAKCC,YAAAA,SAAS,EAAE,CALZ;CAMCC,YAAAA,UAAU,EAAE,KANb;CAOCC,YAAAA,gBAAgB,EAAE,IAPnB;CAQCC,YAAAA,cAAc,EAAE,KARjB;CASCC,YAAAA,eAAe,EAAE;CATlB,WAJD;CAeCC,UAAAA,kBAAkB,EAAE,IAfrB;CAgBCC,UAAAA,iBAAiB,EAAE,IAhBpB;CAiBCC,UAAAA,iBAAiB,EAAC,KAjBnB;CAkBCC,UAAAA,qBAAqB,EAAE;CAlBxB,SAZM;CAgCNC,QAAAA,YAAY,EAAE;CAACpF,UAAAA,KAAK,EACpB,CACC;CACCrb,YAAAA,EAAE,EAAC,MADJ;CAECV,YAAAA,IAAI,EAAE,KAAK8a,WAAL,CAAiB,+BAAjB,CAFP;CAGCsG,YAAAA,UAAU,EACV;CACCC,cAAAA,QAAQ,EAAC,KADV;CAECpB,cAAAA,GAAG,EAAER,OAAO,GAAG,qEAAV,GAAgF,KAAK3gB,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAFtF;CAGCuN,cAAAA,cAAc,EACd;CACCC,gBAAAA,WAAW,EAAE,IADd;CAECC,gBAAAA,SAAS,EAAE,IAFZ;CAGCC,gBAAAA,KAAK,EAAE,IAHR;CAICzhB,gBAAAA,IAAI,EAAE,KAAK8a,WAAL,CAAiB,qCAAjB;CAJP;CAJD;CAJD,WADD,EAiBC;CACCpa,YAAAA,EAAE,EAAE,WADL;CAECV,YAAAA,IAAI,EAAE,KAAK8a,WAAL,CAAiB,kCAAjB;CAFP,WAjBD,EAqBC;CACCpa,YAAAA,EAAE,EAAE,QADL;CAECV,YAAAA,IAAI,EAAE,KAAK8a,WAAL,CAAiB,iCAAjB;CAFP,WArBD;CADc,SAhCR;CA2DNxQ,QAAAA,MAAM,EAAE,gBAACnK,IAAD,EACR;CACC,cAAI,OAAOA,IAAP,KAAgB,QAApB,EACA;CACCA,YAAAA,IAAI,GAAG;CAACP,cAAAA,IAAI,EAAEO,IAAP;CAAauhB,cAAAA,aAAa,EAAE;CAA5B,aAAP;CACA;;CAED,cAAM9hB,IAAI,GAAGO,IAAI,CAACP,IAAL,CAAUoS,QAAV,GAAqB2P,IAArB,EAAb;CACA,cAAMD,aAAa,GAAGvhB,IAAI,CAACuhB,aAAL,YAA8B9H,KAA9B,GAAqCzZ,IAAI,CAACuhB,aAA1C,GAAyD,EAA/E;;CAEA,cAAIA,aAAa,CAACva,MAAd,IAAwB,CAA5B,EACA;CACC,YAAA,OAAI,CAACya,SAAL;;CACA,YAAA,OAAI,CAACxe,UAAL;;CAEA,gBAAI2C,MAAM,GAAG,OAAI,CAACjH,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,qBAAnC,EAA0D,OAAI,CAAC7G,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAA1D,CAAb;;CACA,gBAAIzK,MAAJ,EACA;CACC,cAAA,OAAI,CAAC8b,aAAL,CAAmB9b,MAAnB,EAA2BnG,IAA3B;CACA,aAHD,MAKA;CACC,cAAA,OAAI,CAACkJ,UAAL,CAAgBlJ,IAAhB;CACA;CACD,WAdD,MAgBA;CACC8hB,YAAAA,aAAa,CAACzM,OAAd,CAAsB,UAAAvM,IAAI,EAAI;CAC7B;CACA,kBAAI,OAAOA,IAAI,CAACoZ,cAAZ,KAA+B,WAAnC,EACA;CACC9F,gBAAAA,MAAM,CAACC,OAAP,CAAeC,eAAf,CAA+B,iBAA/B,EAAkD,EAAlD;CAEA,uBAAO,OAAI,CAAC7G,UAAL,CAAgB;CACtB0M,kBAAAA,MAAM,EAAE,MADc;CAEtB/hB,kBAAAA,IAAI,EAAE0I,IAAI,CAAC1I,IAFW;CAGtByG,kBAAAA,IAAI,EAAEiC,IAAI,CAACjC,IAAL,CAAUuL,QAAV,GAAqBgQ,WAArB,EAHgB;CAItBC,kBAAAA,OAAO,EAAE,CAACvZ,IAAI,CAACoZ,cAAL,CAAoBI,GAArB,IAA4B,CAACxZ,IAAI,CAACoZ,cAAL,CAAoBI,GAApB,CAAwBC,OAArD,GAA8D,IAA9D,GAAoE;CAC5ElC,oBAAAA,GAAG,EAAEvX,IAAI,CAACoZ,cAAL,CAAoBI,GAApB,CAAwBC,OAD+C;CAE5EC,oBAAAA,KAAK,EAAE1Z,IAAI,CAACoZ,cAAL,CAAoBI,GAApB,CAAwBC,OAAxB,CAAgCE,KAAhC,CAAsC,gBAAtC,EAAwD,CAAxD,CAFqE;CAG5EC,oBAAAA,MAAM,EAAE5Z,IAAI,CAACoZ,cAAL,CAAoBI,GAApB,CAAwBC,OAAxB,CAAgCE,KAAhC,CAAsC,iBAAtC,EAAyD,CAAzD;CAHoE,mBAJvD;CAStBE,kBAAAA,UAAU,EAAEhG,QAAQ,CAAC7T,IAAI,CAACoZ,cAAL,CAAoBU,EAArB;CATE,iBAAhB,CAAP;CAWA,eAjB4B;;;CAoB7B,kBAAI9Z,IAAI,CAACjC,IAAL,KAAc,WAAlB,EACA;CACCuV,gBAAAA,MAAM,CAACC,OAAP,CAAeC,eAAf,CAA+B,kBAA/B,EAAmD,EAAnD;CAEA,uBAAO,OAAI,CAAC7G,UAAL,CAAgB;CACtB0M,kBAAAA,MAAM,EAAE,OADc;CAEtB/hB,kBAAAA,IAAI,EAAE,kBAAiB,IAAIyiB,IAAJ,EAAD,CAAWC,MAAX,GAAoBrO,KAApB,CAA0B,CAA1B,EAA6B,EAA7B,EAAiCsF,OAAjC,CAAyC,GAAzC,EAA8C,GAA9C,EAAmD1H,KAAnD,CAAyD,GAAzD,EAA8D7M,IAA9D,CAAmE,GAAnE,CAAhB,GAAwF,MAFxE;CAGtBqB,kBAAAA,IAAI,EAAE,KAHgB;CAItBwb,kBAAAA,OAAO,EAAE,IAJa;CAKtBM,kBAAAA,UAAU,EAAE7Z,IAAI,CAACuX;CALK,iBAAhB,CAAP;CAOA;;CAED,kBAAI0C,QAAQ,GAAGja,IAAI,CAAC1I,IAApB;CACA,kBAAI4iB,QAAQ,GAAGC,mBAAU,CAACC,OAAX,CAAmBpa,IAAI,CAAC1I,IAAxB,CAAf;;CAEA,kBAAI4iB,QAAQ,KAAKpJ,iBAAQ,CAACgD,KAA1B,EACA;CACCR,gBAAAA,MAAM,CAACC,OAAP,CAAeC,eAAf,CAA+B,kBAA/B,EAAmD,EAAnD;CACA,eAHD,MAIK,IAAI0G,QAAQ,KAAKpJ,iBAAQ,CAACC,KAA1B,EACL;CACCuC,gBAAAA,MAAM,CAACC,OAAP,CAAeC,eAAf,CAA+B,kBAA/B,EAAmD,EAAnD;CACA,eAHI,MAKL;CACCF,gBAAAA,MAAM,CAACC,OAAP,CAAeC,eAAf,CAA+B,kBAA/B,EAAmD,EAAnD;CACA;;CAED,kBACC0G,QAAQ,KAAKpJ,iBAAQ,CAACC,KAAtB,IACGmJ,QAAQ,KAAKpJ,iBAAQ,CAACgD,KAF1B,EAIA;CACC,oBAAIuG,SAAS,GAAGra,IAAI,CAAC1I,IAAL,CAAUiS,KAAV,CAAgB,GAAhB,EAAqBoC,KAArB,CAA2B,CAAC,CAA5B,EAA+B,CAA/B,EAAkC2N,WAAlC,EAAhB;;CACA,oBAAItZ,IAAI,CAACjC,IAAL,KAAc,YAAlB,EACA;CACCsc,kBAAAA,SAAS,GAAG,KAAZ;CACA;;CACDJ,gBAAAA,QAAQ,GAAG,iBAAgB,IAAIF,IAAJ,EAAD,CAAWC,MAAX,GAAoBrO,KAApB,CAA0B,CAA1B,EAA6B,EAA7B,EAAiCsF,OAAjC,CAAyC,GAAzC,EAA8C,GAA9C,EAAmD1H,KAAnD,CAAyD,GAAzD,EAA8D7M,IAA9D,CAAmE,GAAnE,CAAf,GAAuF,GAAvF,GAA2F2d,SAAtG;CACA,eA5D4B;;;CA+D7B,qBAAO,OAAI,CAAC1N,UAAL,CAAgB;CACtB0M,gBAAAA,MAAM,EAAE,SADc;CAEtB/hB,gBAAAA,IAAI,EAAE2iB,QAFgB;CAGtBlc,gBAAAA,IAAI,EAAEiC,IAAI,CAACjC,IAAL,CAAUuL,QAAV,GAAqBgQ,WAArB,EAHgB;CAItBC,gBAAAA,OAAO,EAAE,CAACvZ,IAAI,CAACsa,UAAN,GAAkB,IAAlB,GAAwB;CAChC/C,kBAAAA,GAAG,EAAEvX,IAAI,CAACsa,UADsB;CAEhCZ,kBAAAA,KAAK,EAAE1Z,IAAI,CAACua,YAFoB;CAGhCX,kBAAAA,MAAM,EAAE5Z,IAAI,CAACwa;CAHmB,iBAJX;CAStBX,gBAAAA,UAAU,EAAE7Z,IAAI,CAACuX;CATK,eAAhB,CAAP;CAWA,aA1ED;CA2EA;CAED,SAnKK;CAoKNxO,QAAAA,QAAQ,EAAE,kBAACtR,IAAD,EACV;CACCmM,UAAAA,OAAO,CAAC2C,GAAR,CAAY,oBAAZ,EAAkC9O,IAAlC;;CACA,cAAI,CAACA,IAAI,CAAC8C,KAAV,EACA;CACC,mBAAO,KAAP;CACA;;CACD,cAAI9C,IAAI,CAAC8C,KAAL,KAAe,YAAnB,EACA;CACC,gBAAIrD,IAAI,GAAGO,IAAI,CAACP,IAAL,CAAUoS,QAAV,EAAX;;CACA,gBAAIpS,IAAI,CAAC+hB,IAAL,GAAYxa,MAAZ,GAAqB,CAAzB,EACA;CACC,cAAA,OAAI,CAACrI,UAAL,CAAgB6D,WAAhB,CAA4BwgB,YAA5B;CACA;;CAED,gBAAIvjB,IAAI,CAACuH,MAAL,KAAgB,CAApB,EACA;CACC,cAAA,OAAI,CAACwJ,kBAAL,CAAwB;CAAC7Q,gBAAAA,OAAO,EAAE;CAAV,eAAxB;;CACA,cAAA,OAAI,CAAChB,UAAL,CAAgB6D,WAAhB,CAA4BygB,WAA5B;CACA,aAJD,MAMA;CACC,cAAA,OAAI,CAACzS,kBAAL,CAAwB;CAAC7Q,gBAAAA,OAAO,EAAEF;CAAV,eAAxB;CACA;CACD,WAjBD,MAkBK,IAAIO,IAAI,CAAC8C,KAAL,KAAe,eAAnB,EACL;CACC,YAAA,OAAI,CAACnE,UAAL,CAAgBukB,UAAhB;CACA,WAHI,MAIA,IAAIzb,WAAW,CAAC0b,WAAZ,OAA8B,SAAlC,EACL;CACC,gBAAInjB,IAAI,CAAC8C,KAAL,KAAe,UAAnB,EACA;CACC,kBAAIgC,kBAAK,CAACC,QAAN,CAAeC,KAAf,MAA0BF,kBAAK,CAACC,QAAN,CAAeqe,aAAf,KAAiC,EAA/D,EACA;CACC/Y,gBAAAA,6BAAY,CAACC,IAAb,CAAkBhG,kBAAS,CAACzF,MAAV,CAAiB0L,cAAnC,EAAmD;CAACjK,kBAAAA,MAAM,EAAE,OAAI,CAAC3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAAT;CAAkDzG,kBAAAA,QAAQ,EAAE,GAA5D;CAAiEC,kBAAAA,oBAAoB,EAAE;CAAvF,iBAAnD;CACA;CACD,aAND,MAOK,IAAIzK,IAAI,CAAC8C,KAAL,KAAe,aAAnB,EACL;CAGA;CACD;CA/MK,OAAP;CAiNA;CAEF;;CA1pDA;CAAA;CAAA,+BA4pDYrD,IA5pDZ,EA6pDC;CAAA;;CAAA,UADiB8I,IACjB,uEADwB,IACxB;CAAA,UAD8B0M,aAC9B,uEAD8C,IAC9C;;CACC,UAAI,CAACxV,IAAD,IAAS,CAAC8I,IAAd,EACA;CACC,eAAO,KAAP;CACA;;CAED,UAAIjD,OAAO,GAAG,KAAK3G,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,sBAAnC,EAA2D,KAAK7G,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAA3D,CAAd;;CACA,UAAI/K,OAAJ,EACA;CACC,YAAIqE,YAAY,GAAG,KAAKhL,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,qBAAnC,EAA0D,KAAK7G,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAA1D,EAAmG3L,OAAnG,CAAnB;;CACA,YAAIqE,YAAJ,EACA;CACC,cAAIlE,IAAI,GAAG,IAAX;;CACA,cAAIkE,YAAY,CAACjE,QAAjB,EACA;CACCD,YAAAA,IAAI,GAAG,KAAK9G,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,WAAnC,EAAgDmE,YAAY,CAACjE,QAA7D,CAAP;CACA;;CAED,cAAIC,KAAK,GAAG,KAAKhH,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,eAAnC,EAAoD,KAAK7G,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAApD,CAAZ;CAEA,cAAItR,OAAO,GAAG,EAAd;CACAA,UAAAA,OAAO,CAACkF,IAAR,CAAa,IAAIwe,MAAJ,CAAW,EAAX,CAAb;CACA1jB,UAAAA,OAAO,CAACkF,IAAR,CAAa,CAACY,IAAI,IAAIA,IAAI,CAAC5F,IAAb,GAAmB4F,IAAI,CAAC5F,IAAxB,GAA8B,KAAK8a,WAAL,CAAiB,4BAAjB,CAA/B,IAA+E,IAA/E,GAAoF7V,kBAAK,CAACwe,IAAN,CAAWC,MAAX,CAAkB5Z,YAAY,CAAC2Z,IAA/B,EAAqC,IAArC,EAA2C,KAAK3I,WAAL,EAA3C,CAApF,GAAmJ,GAAhK;CACAhb,UAAAA,OAAO,CAACkF,IAAR,CAAaC,kBAAK,CAACrF,IAAN,CAAW+jB,KAAX,CAAiB7Z,YAAY,CAAClK,IAA9B,EAAoCkK,YAAY,CAACjL,MAAjD,EAAyDiH,KAAzD,EAAgE,KAAKgV,WAAL,EAAhE,CAAb;CACAhb,UAAAA,OAAO,CAACkF,IAAR,CAAa,IAAIwe,MAAJ,CAAW,EAAX,CAAb;CACA1jB,UAAAA,OAAO,CAACkF,IAAR,CAAapF,IAAb;CACAA,UAAAA,IAAI,GAAGE,OAAO,CAACsF,IAAR,CAAa,IAAb,CAAP;CAEA,eAAKgH,iBAAL;CACA;CACD;;CAEDE,MAAAA,OAAO,CAACvD,IAAR,CAAa,YAAb,EAA2BnJ,IAA3B,EAAiC8I,IAAjC,EAAuC0M,aAAvC,EAhCD;;CAmCC,UAAMwO,eAAe,GAAG,CAAC,CAACxO,aAA1B;;CACA,UAAI,CAACA,aAAL,EACA;CACCA,QAAAA,aAAa,GAAGyO,SAAS,CAACC,SAAV,EAAhB;CACA;;CAED,UAAI,CAAC,KAAKhlB,UAAL,CAAgB6D,WAAhB,CAA4BsR,sBAA5B,EAAL,EACA;CACC,YAAI,CAAC2P,eAAL,EACA;CACC,eAAKG,WAAL,CAAiB;CAChBrjB,YAAAA,EAAE,EAAE,CADY;CAEhBD,YAAAA,MAAM,EAAE,KAAK3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAFQ;CAGhBzQ,YAAAA,QAAQ,EAAE,KAAK7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAHM;CAIhB5Q,YAAAA,IAAI,EAAJA,IAJgB;CAKhB8I,YAAAA,IAAI,EAAJA;CALgB,WAAjB;CAOA,eAAKkJ,mBAAL;CACA;;CAED,eAAO,IAAP;CACA;;CAED,WAAK9S,UAAL,CAAgBwQ,QAAhB,GAA2BlP,MAA3B,CAAkC,sCAAlC;CAEA,UAAIvB,MAAM,GAAG,EAAb;;CACA,UAAI6J,IAAJ,EACA;CACC7J,QAAAA,MAAM,CAACmlB,OAAP,GAAiB,CAACtb,IAAI,CAAChI,EAAN,CAAjB;CACA;;CAED,WAAK5B,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,cAApC,EAAoD;CACnDN,QAAAA,EAAE,EAAE0U,aAD+C;CAEnD3U,QAAAA,MAAM,EAAE,KAAK3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAF2C;CAGnDvL,QAAAA,QAAQ,EAAE,KAAK/G,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAHyC;CAInDnU,QAAAA,IAAI,EAAEA,IAJ6C;CAKnDf,QAAAA,MAAM,EAANA,MALmD;CAMnDolB,QAAAA,OAAO,EAAE,CAACvb;CANyC,OAApD,EAOGsD,IAPH,CAOQ,UAAAjK,SAAS,EAAI;CACpByI,QAAAA,6BAAY,CAACC,IAAb,CAAkBhG,kBAAS,CAACzF,MAAV,CAAiB0L,cAAnC,EAAmD;CAACjK,UAAAA,MAAM,EAAE,OAAI,CAAC3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAAT;CAAkDxG,UAAAA,oBAAoB,EAAE;CAAxE,SAAnD;;CAEA,QAAA,OAAI,CAAC5I,aAAL,CAAmBgD,IAAnB,CAAwB;CACvBtE,UAAAA,EAAE,EAAEqB,SADmB;CAEvBtB,UAAAA,MAAM,EAAE,OAAI,CAAC3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAFe;CAGvBzQ,UAAAA,QAAQ,EAAE,OAAI,CAAC7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAHa;CAIvB5Q,UAAAA,IAAI,EAAJA,IAJuB;CAKvB8I,UAAAA,IAAI,EAAJA,IALuB;CAMvBub,UAAAA,OAAO,EAAEL;CANc,SAAxB;;CAQA,YAAIA,eAAJ,EACA;CACC,iBAAO,IAAP;CACA;;CAED,YAAI,OAAI,CAAC9kB,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAAJ,EACA;CACC,UAAA,OAAI,CAACQ,mBAAL;CACA,SAHD,MAKA;CACC,UAAA,OAAI,CAACmD,WAAL;CACA;CACD,OA/BD;CAiCA,aAAO,IAAP;CACA;CAjwDF;CAAA;CAAA,+BAmwDYrM,IAnwDZ,EAowDC;CAAA;;CAAA,UADiB9I,IACjB,uEADwB,EACxB;;CACC,UAAI,CAAC8I,IAAL,EACA;CACC,eAAO,KAAP;CACA;;CAED4D,MAAAA,OAAO,CAACvD,IAAR,CAAa,SAAb,EAAwBL,IAAxB,EAA8B9I,IAA9B;;CAEA,UAAI,CAAC,KAAKd,UAAL,CAAgB6D,WAAhB,CAA4BsR,sBAA5B,EAAL,EACA;CACC,YAAI,CAACvL,IAAI,CAAChI,EAAV,EACA;CACC,eAAKoI,UAAL,CAAgBlJ,IAAhB,EAAsB;CAACc,YAAAA,EAAE,EAAE,CAAL;CAAQqhB,YAAAA,MAAM,EAAErZ;CAAhB,WAAtB,EAA6CA,IAAI,CAAC0M,aAAlD;CACA,iBAAO,IAAP;CACA;CACD;;CAED,UAAI,CAAC1M,IAAI,CAAChI,EAAV,EACA;CACCgI,QAAAA,IAAI,CAAChI,EAAL,GAAUmjB,SAAS,CAACC,SAAV,EAAV;CACA;;CAED,WAAKhlB,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,WAApC,EAAiD,KAAKlC,UAAL,CAAgB6D,WAAhB,CAA4BuhB,sBAA5B,CAAmD;CACnGxjB,QAAAA,EAAE,EAAEgI,IAAI,CAAChI,EAD0F;CAEnGD,QAAAA,MAAM,EAAE,KAAK3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAF2F;CAGnGvL,QAAAA,QAAQ,EAAE,KAAK/G,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAHyF;CAInG/T,QAAAA,IAAI,EAAE0I,IAAI,CAAC1I,IAJwF;CAKnGyG,QAAAA,IAAI,EAAEoc,mBAAU,CAACC,OAAX,CAAmBpa,IAAI,CAAC1I,IAAxB,CAL6F;CAMnG+iB,QAAAA,SAAS,EAAEra,IAAI,CAAC1I,IAAL,CAAUiS,KAAV,CAAgB,GAAhB,EAAqBkS,MAArB,CAA4B,CAAC,CAA7B,EAAgC,CAAhC,CANwF;CAOnG5Q,QAAAA,IAAI,EAAE,CAP6F;CAQnGkG,QAAAA,KAAK,EAAE,CAAC/Q,IAAI,CAACuZ,OAAN,GAAe,KAAf,GAAsB;CAC5BG,UAAAA,KAAK,EAAE1Z,IAAI,CAACuZ,OAAL,CAAaG,KADQ;CAE5BE,UAAAA,MAAM,EAAE5Z,IAAI,CAACuZ,OAAL,CAAaK;CAFO,SARsE;CAYnG5Q,QAAAA,MAAM,EAAEhJ,IAAI,CAACqZ,MAAL,KAAgB,MAAhB,GAAwBvO,mBAAU,CAACkF,IAAnC,GAAyClF,mBAAU,CAACC,MAZuC;CAanGH,QAAAA,QAAQ,EAAE,CAbyF;CAcnG8Q,QAAAA,UAAU,EAAE,KAAKtlB,UAAL,CAAgB6D,WAAhB,CAA4B0hB,cAA5B,GAA6CrkB,IAd0C;CAenG8Y,QAAAA,UAAU,EAAE,CAACpQ,IAAI,CAACuZ,OAAN,GAAe,EAAf,GAAmBvZ,IAAI,CAACuZ,OAAL,CAAahC;CAfuD,OAAnD,CAAjD,EAgBIjU,IAhBJ,CAgBS,UAAAqH,MAAM;CAAA,eAAI,OAAI,CAACvK,UAAL,CAAgBlJ,IAAhB;CAAuBc,UAAAA,EAAE,EAAE2S;CAA3B,WAAsC3K,IAAtC,GAA6CA,IAAI,CAAC0M,aAAlD,CAAJ;CAAA,OAhBf;CAkBA,aAAO,IAAP;CACA;CA7yDF;CAAA;CAAA,qCA+yDkB/B,MA/yDlB,EAgzDC;CAAA;;CACC,UAAIoL,OAAO,GAAG,KAAKzc,aAAL,CAAmBsiB,IAAnB,CAAwB,UAAA7F,OAAO;CAAA,eAAIA,OAAO,CAAC/V,IAAR,IAAgB+V,OAAO,CAAC/V,IAAR,CAAahI,EAAb,KAAoB2S,MAAxC;CAAA,OAA/B,CAAd;;CACA,UAAIoL,OAAJ,EACA;CACC9c,QAAAA,EAAE,CAACqR,oBAAH,CAAwBuR,WAAxB,CAAoC,CAAC,wBAAsBlR,MAAvB,CAApC;CAEA,aAAKvU,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,iBAApC,EAAuD;CACtDP,UAAAA,MAAM,EAAEge,OAAO,CAAChe,MADsC;CAEtDC,UAAAA,EAAE,EAAE+d,OAAO,CAAC/d;CAF0C,SAAvD,EAGGsL,IAHH,CAGQ,YAAM;CACb,UAAA,OAAI,CAAClN,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,cAApC,EAAoD;CACnDP,YAAAA,MAAM,EAAEge,OAAO,CAAChe,MADmC;CAEnDC,YAAAA,EAAE,EAAE+d,OAAO,CAAC/V,IAAR,CAAahI;CAFkC,WAApD;;CAIA,UAAA,OAAI,CAACsB,aAAL,GAAqB,OAAI,CAACA,aAAL,CAAmBC,MAAnB,CAA0B,UAAAC,EAAE;CAAA,mBAAIA,EAAE,CAACxB,EAAH,KAAU+d,OAAO,CAAC/d,EAAtB;CAAA,WAA5B,CAArB;CACA,SATD;CAUA;CACD;CAj0DF;CAAA;CAAA,oCAm0DiB2S,MAn0DjB,EAo0DC;CAAA;;CACC,UAAIoL,OAAO,GAAG,KAAKzc,aAAL,CAAmBsiB,IAAnB,CAAwB,UAAA7F,OAAO;CAAA,eAAIA,OAAO,CAAC/V,IAAR,IAAgB+V,OAAO,CAAC/V,IAAR,CAAahI,EAAb,KAAoB2S,MAAxC;CAAA,OAA/B,CAAd;;CACA,UAAI,CAACoL,OAAL,EACA;CACC,eAAO,KAAP;CACA;;CAED,WAAK3f,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,sBAApC,EAA4D;CAC3DP,QAAAA,MAAM,EAAEge,OAAO,CAAChe,MAD2C;CAE3DC,QAAAA,EAAE,EAAE+d,OAAO,CAAC/d;CAF+C,OAA5D,EAGGsL,IAHH,CAGQ,YAAM;CACb,QAAA,OAAI,CAAClN,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,cAApC,EAAoD;CACnDP,UAAAA,MAAM,EAAEge,OAAO,CAAChe,MADmC;CAEnDC,UAAAA,EAAE,EAAE+d,OAAO,CAAC/V,IAAR,CAAahI,EAFkC;CAGnDO,UAAAA,MAAM,EAAE;CACPyQ,YAAAA,MAAM,EAAE8B,mBAAU,CAACC,MADZ;CAEPH,YAAAA,QAAQ,EAAE;CAFH;CAH2C,SAApD;CAQA,OAZD;CAcAmL,MAAAA,OAAO,CAACwF,OAAR,GAAkB,KAAlB;CACA,WAAKrS,mBAAL;CAEA,aAAO,IAAP;CACA;CA71DF;CAAA;CAAA,0CAg2DC;CAAA;;CACC,WAAK5P,aAAL,CAAmBC,MAAnB,CAA0B,UAAAwc,OAAO;CAAA,eAAI,CAACA,OAAO,CAACwF,OAAb;CAAA,OAAjC,EAAuDhP,OAAvD,CAA+D,UAAAwJ,OAAO,EACtE;CACCA,QAAAA,OAAO,CAACwF,OAAR,GAAkB,IAAlB;;CAEA,YAAIxF,OAAO,CAAC/V,IAAZ,EACA;CACC,cAAI+V,OAAO,CAAC/V,IAAR,CAAaqZ,MAAb,KAAwB,MAA5B,EACA;CACC,YAAA,OAAI,CAACyC,UAAL,CAAgB;CACf/jB,cAAAA,MAAM,EAAEge,OAAO,CAAChe,MADD;CAEfE,cAAAA,QAAQ,EAAE8d,OAAO,CAAC9d,QAFH;CAGf8jB,cAAAA,MAAM,EAAEhG,OAAO,CAAC/V,IAAR,CAAa6Z,UAHN;CAIfmC,cAAAA,WAAW,EAAEjG,OAAO,CAAC7e,IAJN;CAKfmC,cAAAA,SAAS,EAAE0c,OAAO,CAAC/d,EALJ;CAMf2S,cAAAA,MAAM,EAAEoL,OAAO,CAAC/V,IAAR,CAAahI,EANN;CAOfkiB,cAAAA,QAAQ,EAAEC,mBAAU,CAACC,OAAX,CAAmBrE,OAAO,CAAC/V,IAAR,CAAa1I,IAAhC;CAPK,aAAhB,EAQGye,OARH;CASA,WAXD,MAaA;CACC,gBAAI,OAAI,CAAC3f,UAAL,CAAgB6D,WAAhB,CAA4BgiB,eAA5B,EAAJ,EACA;CACC,cAAA,OAAI,CAACC,mBAAL,CAAyBnG,OAAzB;CACA,aAHD,MAKA;CACCA,cAAAA,OAAO,CAACwF,OAAR,GAAkB,KAAlB;;CACA,cAAA,OAAI,CAACY,mBAAL;CACA;CACD;CACD,SA1BD,MA4BA;CACCpG,UAAAA,OAAO,CAACwF,OAAR,GAAkB,IAAlB;;CACA,UAAA,OAAI,CAACF,WAAL,CAAiBtF,OAAjB;CACA;CACD,OApCD;CAsCA,aAAO,IAAP;CACA;CAx4DF;CAAA;CAAA,8CA24DC;CACC,WAAK3f,UAAL,CAAgB6D,WAAhB,CAA4BmiB,kBAA5B,CAA+C,KAAKhmB,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAA/C,EAAwF,IAAxF;CACA,aAAO,IAAP;CACA;CA94DF;CAAA;CAAA,gCAg5DatR,OAh5Db,EAi5DC;CACCA,MAAAA,OAAO,CAACF,IAAR,GAAeE,OAAO,CAACF,IAAR,CAAa+Z,OAAb,CAAqB,gBAArB,EAAuC,IAAI6J,MAAJ,CAAW,EAAX,IAAe,IAAtD,CAAf;CAEA,WAAK1kB,UAAL,CAAgB6D,WAAhB,CAA4BygB,WAA5B,CAAwCtjB,OAAO,CAACa,QAAhD;CAEApB,MAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,2BAAnC,EAAgE,CAC/D,iBAAehV,OAAO,CAACY,EADwC,EAE/D,CAACgL,mBAAU,CAACqZ,YAAZ,EAA0B;CACzB,uBAAejlB,OAAO,CAACY,EADE;CAEzB,qBAAaZ,OAAO,CAACa,QAFI;CAGzB,mBAAWb,OAAO,CAACF;CAHM,OAA1B,CAF+D,EAO/DE,OAP+D,CAAhE,EAQG,YARH;CASA;CA/5DF;CAAA;CAAA,wCAi6DqBA,OAj6DrB,EAk6DC;CACC,UAAI8iB,QAAQ,GAAGC,mBAAU,CAACC,OAAX,CAAmBhjB,OAAO,CAAC4I,IAAR,CAAa1I,IAAhC,CAAf;CACA,UAAIglB,aAAa,GAAGllB,OAAO,CAAC4I,IAAR,CAAa1I,IAAb,CAAkBgS,QAAlB,GAA6BgQ,WAA7B,GAA2C/P,KAA3C,CAAiD,GAAjD,EAAsDkS,MAAtD,CAA6D,CAAC,CAA9D,EAAiE,CAAjE,CAApB;CACA,UAAIc,iBAAiB,GAAGrC,QAAQ,KAAKpJ,iBAAQ,CAACC,KAAtB,IAA+B3Z,OAAO,CAAC4I,IAAR,CAAauZ,OAApE;CACA,UAAIiD,WAAW,GAAGtC,QAAQ,KAAKpJ,iBAAQ,CAACC,KAAtB,IAA+B3Z,OAAO,CAAC4I,IAAR,CAAajC,IAAb,KAAsB,WAArD,IAAoEmc,QAAQ,KAAKpJ,iBAAQ,CAACgD,KAA5G;CAEA7a,MAAAA,EAAE,CAACqR,oBAAH,CAAwBmS,QAAxB,CAAiC,CAAC;CACjClF,QAAAA,GAAG,EAAEngB,OAAO,CAAC4I,IAAR,CAAa6Z,UADe;CAEjC1jB,QAAAA,MAAM,EAAEiB,OAFyB;CAGjCE,QAAAA,IAAI,EAAEF,OAAO,CAAC4I,IAAR,CAAa1I,IAHc;CAIjCyG,QAAAA,IAAI,EAAEue,aAJ2B;CAKjCI,QAAAA,QAAQ,EAAExC,QAAQ,KAAKpJ,iBAAQ,CAAC6L,KAAtB,GAA6B,WAA7B,GAA0C,IALnB;CAMjChF,QAAAA,MAAM,EAAE,CAAC6E,WAAD,GAAc,IAAd,GAAoB;CAC3B,qBAAU,EADiB;CAE3B,mBAAQ,IAFmB;CAG3B,oBAAS;CAHkB,SANK;CAWjClC,QAAAA,UAAU,EAAEiC,iBAAiB,GAAEnlB,OAAO,CAAC4I,IAAR,CAAauZ,OAAb,CAAqBhC,GAAvB,GAA4B,EAXxB;CAYjCqF,QAAAA,QAAQ,EAAE,KAAKxmB,UAAL,CAAgB6D,WAAhB,CAA4BgiB,eAA5B,EAZuB;CAajC5S,QAAAA,MAAM,EAAE,wBAAsBjS,OAAO,CAAC4I,IAAR,CAAahI,EAbV;CAcjC6kB,QAAAA,kBAAkB,EAAE;CAda,OAAD,CAAjC;CAgBA;CAx7DF;CAAA;CAAA,8BA07DW9kB,MA17DX,EA07DmB4S,MA17DnB,EA27DC;CAAA,UAD0BtR,SAC1B,uEADsC,CACtC;CACC,WAAKjD,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,cAApC,EAAoD;CACnDP,QAAAA,MAAM,EAAEA,MAD2C;CAEnDC,QAAAA,EAAE,EAAE2S,MAF+C;CAGnDpS,QAAAA,MAAM,EAAE;CACPyQ,UAAAA,MAAM,EAAE8B,mBAAU,CAACtS,KADZ;CAEPoS,UAAAA,QAAQ,EAAE;CAFH;CAH2C,OAApD;;CAQA,UAAIvR,SAAJ,EACA;CACC,aAAKjD,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,sBAApC,EAA4D;CAC3DP,UAAAA,MAAM,EAAEA,MADmD;CAE3DC,UAAAA,EAAE,EAAEqB,SAFuD;CAG3DyjB,UAAAA,KAAK,EAAE;CAHoD,SAA5D;CAKA;CACD;CA58DF;CAAA;CAAA,+BA88DY3mB,MA98DZ,EA88DoBiB,OA98DpB,EA+8DC;CACC,UAAM2lB,WAAW,GAAG;CACnBC,QAAAA,OAAO,EAAE7mB,MAAM,CAAC4B,MADG;CAEnBX,QAAAA,OAAO,EAAEjB,MAAM,CAAC6lB,WAFG;CAGnBiB,QAAAA,WAAW,EAAE9mB,MAAM,CAACkD,SAAP,GAAkBlD,MAAM,CAACkD,SAAzB,GAAoC,CAH9B;CAInB6jB,QAAAA,gBAAgB,EAAE/mB,MAAM,CAACwU,MAAP,GAAexU,MAAM,CAACwU,MAAtB,GAA8B;CAJ7B,OAApB;;CAMA,UAAIxU,MAAM,CAACgnB,QAAX,EACA;CACCJ,QAAAA,WAAW,CAACK,SAAZ,GAAwBjnB,MAAM,CAACgnB,QAA/B;CACA,OAHD,MAIK,IAAIhnB,MAAM,CAAC4lB,MAAX,EACL;CACCgB,QAAAA,WAAW,CAACM,OAAZ,GAAsBlnB,MAAM,CAAC4lB,MAA7B;CACA;;CAEDllB,MAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,2BAAnC,EAAgE,CAC/D,wBAAsBhV,OAAO,CAACY,EADiC,EAE/D,CAACgL,mBAAU,CAACsa,gBAAZ,EAA8BP,WAA9B,CAF+D,EAG/D3lB,OAH+D,CAAhE,EAIG,YAJH;CAKA;CAp+DF;CAAA;CAAA,0CAu+DC;CAAA;;CACC,UAAI,KAAKmmB,6BAAL,IAAsC,KAAKnnB,UAAL,CAAgB6D,WAAhB,CAA4BgiB,eAA5B,EAA1C,EACA;CACC,eAAO,IAAP;CACA;;CAED,WAAKsB,6BAAL,GAAqC,IAArC;CAEA,WAAKnnB,UAAL,CAAgBmY,UAAhB,CAA2BxL,UAA3B,CAAsCC,mBAAU,CAACwa,eAAjD,EAAkE;CAACR,QAAAA,OAAO,EAAE,KAAK5mB,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B;CAAV,OAAlE,EAAsHpF,IAAtH,CAA2H,UAAAmL,QAAQ,EAAI;CACtI,QAAA,OAAI,CAACrY,UAAL,CAAgByY,iBAAhB,CAAkClB,0BAAiB,CAAC6P,eAApD,EAAqE/O,QAArE;;CACA,QAAA,OAAI,CAAC8O,6BAAL,GAAqC,KAArC;;CACA,QAAA,OAAI,CAACrU,mBAAL;CACA,OAJD,EAIG3F,KAJH,CAIS,UAAA/K,KAAK,EAAI;CACjB,QAAA,OAAI,CAAC+kB,6BAAL,GAAqC,KAArC;;CACA,QAAA,OAAI,CAACnnB,UAAL,CAAgByY,iBAAhB,CAAkClB,0BAAiB,CAAC6P,eAApD,EAAqEhlB,KAArE;CACA,OAPD;CASA,aAAO,IAAP;CACA;CAz/DF;CAAA;CAAA,qCA2/DkBiH,MA3/DlB,EA4/DC;CAAA;;CAAA,UADyBuO,KACzB,uEADiC,KAAK5X,UAAL,CAAgB6D,WAAhB,CAA4BgU,sBAA5B,EACjC;CACC,WAAK7X,UAAL,CAAgBmY,UAAhB,CAA2BxL,UAA3B,CAAsCC,mBAAU,CAAC+K,mBAAjD,EAAsE;CACrE,mBAAW,KAAK3X,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAD0D;CAErE,mBAAWjJ,MAF0D;CAGrE,iBAASuO,KAH4D;CAIrE,wBAAgB;CAJqD,OAAtE,EAKG1K,IALH,CAKQ,UAAA7J,MAAM,EAAI;CACjB,QAAA,OAAI,CAACrD,UAAL,CAAgByY,iBAAhB,CAAkClB,0BAAiB,CAACI,mBAApD,EAAyEtU,MAAzE,EADiB;;CAGjB,OARD,EAQG8J,KARH,CAQS,UAAA9J,MAAM,EAAI;CAElB,OAVD;CAWA;CAxgEF;CAAA;CAAA,oCA0gEiBgG,MA1gEjB,EA2gEC;CAAA;;CAAA,UADwBuO,KACxB,uEADgC,KAAK5X,UAAL,CAAgB6D,WAAhB,CAA4BgU,sBAA5B,EAChC;;CACC,UAAI,KAAKwP,0BAAT,EACA;CACC,eAAO,KAAKC,sBAAZ;CACA;;CAED,WAAKA,sBAAL,GAA8B,IAAIzkB,EAAE,CAACsL,OAAP,EAA9B;CACA,WAAKkZ,0BAAL,GAAkC,IAAlC;;CAEA,UAAI,CAAChe,MAAL,EACA;CACCA,QAAAA,MAAM,GAAG,KAAKrJ,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,oBAAnC,EAAyD,KAAK7G,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAAzD,CAAT;CACA;;CAED,UAAI,CAACjJ,MAAL,EACA;CACC;CAEA,aAAKie,sBAAL,CAA4B1X,MAA5B;CACA,aAAKyX,0BAAL,GAAkC,KAAlC;CAEA,eAAO,KAAKC,sBAAZ;CACA;;CAED,WAAKtnB,UAAL,CAAgB6D,WAAhB,CAA4B8G,WAA5B,CAAwCtB,MAAxC,EAAgD,IAAhD,EAAsD,IAAtD,EAA4D6D,IAA5D,CAAiE,YACjE;CAAA;;CACC,QAAA,OAAI,CAACwB,KAAL,CAAWuI,KAAX,CAAiB,MAAjB,EAAyB,MAAzB,EAAiC,EAAjC,EAAqC,YAAM;CAC1CzJ,UAAAA,OAAO,CAACvD,IAAR,CAAa,4DAAb;CACA3H,UAAAA,GAAG,CAAC4U,WAAJ,CAAgB,WAAhB,EAA6B;CAACC,YAAAA,WAAW,EAAE,IAAd;CAAoBC,YAAAA,cAAc,EAAE;CAApC,WAA7B;CACA,SAHD;;CAKA,YAAIE,KAAK,uDACPC,0BAAiB,CAACgQ,YADX,EAC0B,CAAC3a,mBAAU,CAAC2a,YAAZ,EAA0B;CAC3DzlB,UAAAA,SAAS,EAAE,OAAI,CAAC9B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EADgD;CAE3D8V,UAAAA,UAAU,EAAEne;CAF+C,SAA1B,CAD1B,wCAKPkO,0BAAiB,CAACE,SALX,EAKuB,CAAC7K,mBAAU,CAAC6K,SAAZ,EAAuB;CACrD3V,UAAAA,SAAS,EAAE,OAAI,CAAC9B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B;CAD0C,SAAvB,CALvB,wCAQP6F,0BAAiB,CAACkQ,yBARX,EAQuC,CAAC7a,mBAAU,CAAC+K,mBAAZ,EAAiC;CAC/EiP,UAAAA,OAAO,EAAE,OAAI,CAAC5mB,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EADsE;CAE/EoV,UAAAA,QAAQ,EAAEre,MAFqE;CAG/EuO,UAAAA,KAAK,EAAEA,KAHwE;CAI/EE,UAAAA,YAAY,EAAE;CAJiE,SAAjC,CARvC,WAAT;;CAgBA,QAAA,OAAI,CAAC9X,UAAL,CAAgBmY,UAAhB,CAA2BC,SAA3B,CAAqCd,KAArC,EAA4C,UAACe,QAAD,EAC5C;CACC,cAAI,CAACA,QAAL,EACA;CACC,YAAA,OAAI,CAACiP,sBAAL,CAA4B1X,MAA5B;;CACA,YAAA,OAAI,CAACyX,0BAAL,GAAkC,KAAlC;CAEA,mBAAO,KAAP;CACA;;CAED,cAAIxO,aAAa,GAAGR,QAAQ,CAACd,0BAAiB,CAACE,SAAnB,CAA5B;;CACA,cAAI,CAACoB,aAAa,CAACzW,KAAd,EAAL,EACA;CACC,YAAA,OAAI,CAACpC,UAAL,CAAgByY,iBAAhB,CAAkClB,0BAAiB,CAACE,SAApD,EAA+DoB,aAA/D;CACA;;CAED,cAAI8O,mBAAmB,GAAGtP,QAAQ,CAACd,0BAAiB,CAACkQ,yBAAnB,CAAlC;;CACA,cAAI,CAACE,mBAAmB,CAACvlB,KAApB,EAAL,EACA;CACCulB,YAAAA,mBAAmB,GAAGA,mBAAmB,CAACtmB,IAApB,EAAtB;;CACA,YAAA,OAAI,CAACrB,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,WAApC,EAAiDylB,mBAAmB,CAAC1mB,KAArE;;CACA,YAAA,OAAI,CAACjB,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,WAApC,EAAiD,OAAI,CAAClC,UAAL,CAAgB6D,WAAhB,CAA4BuhB,sBAA5B,CAAmDuC,mBAAmB,CAAC3gB,KAAvE,CAAjD;;CACA,YAAA,OAAI,CAAChH,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,mBAApC,EAAyDylB,mBAAmB,CAAChf,QAA7E,EAAuFuE,IAAvF,CAA4F,YAAM;CACjG5K,cAAAA,GAAG,CAAC4U,WAAJ,CAAgB,WAAhB,EAA6B;CAAEC,gBAAAA,WAAW,EAAE,KAAf;CAAsBC,gBAAAA,cAAc,EAAE;CAAtC,eAA7B;;CACA,cAAA,OAAI,CAAC1I,KAAL,CAAWwH,IAAX,CAAgB,MAAhB,EAAwB,MAAxB,EAAgC,IAAhC;;CAEA,cAAA,OAAI,CAACoR,sBAAL,CAA4BM,OAA5B,CAAoCvP,QAApC;;CACA,cAAA,OAAI,CAACgP,0BAAL,GAAkC,KAAlC;CAEA,qBAAO,IAAP;CACA,aARD;CASA,WAdD,MAgBA;CACC,YAAA,OAAI,CAACC,sBAAL,CAA4B1X,MAA5B;;CACA,YAAA,OAAI,CAACyX,0BAAL,GAAkC,KAAlC;CAEA,mBAAO,KAAP;CACA;CAED,SAxCD,EAwCG,KAxCH,EAwCU,KAxCV,EAwCiBlhB,kBAAK,CAACgT,oBAAN,CAA2B;CAACjY,UAAAA,IAAI,EAAEqW,0BAAiB,CAACkQ,yBAAzB;CAAoDvnB,UAAAA,MAAM,EAAE,OAAI,CAACF,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B;CAA5D,SAA3B,CAxCjB;CAyCA,OAhED;CAkEA,aAAO,KAAKkO,sBAAZ;CACA;CAtmEF;CAAA;CAAA,qCAwmEkBtmB,OAxmElB,EAymEC;CACC,UAAI2e,OAAO,GAAG,KAAKzc,aAAL,CAAmBsiB,IAAnB,CAAwB,UAAApiB,EAAE;CAAA,eAAIA,EAAE,CAACxB,EAAH,KAAUZ,OAAO,CAACY,EAAtB;CAAA,OAA1B,CAAd;;CACA,UAAI+d,OAAJ,EACA;CACC,YAAIA,OAAO,CAAC/V,IAAR,IAAgB+V,OAAO,CAAC/V,IAAR,CAAahI,EAAjC,EACA;CACC,eAAKimB,eAAL,CAAqBlI,OAAO,CAAC/V,IAAR,CAAahI,EAAlC;CACA;;CAED,eAAO,KAAP;CACA;;CAED,WAAKsB,aAAL,CAAmBgD,IAAnB,CAAwB;CACvBtE,QAAAA,EAAE,EAAEZ,OAAO,CAACY,EADW;CAEvBD,QAAAA,MAAM,EAAE,KAAK3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAFe;CAGvBzQ,QAAAA,QAAQ,EAAE,KAAK7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAHa;CAIvB5Q,QAAAA,IAAI,EAAEE,OAAO,CAACF,IAJS;CAKvBqkB,QAAAA,OAAO,EAAE;CALc,OAAxB;CAQA,WAAKnlB,UAAL,CAAgB6D,WAAhB,CAA4BikB,qBAA5B,CAAkD9mB,OAAO,CAACY,EAA1D;CAEA,WAAKkR,mBAAL;CACA;CAhoEF;CAAA;CAAA,gCAkoEa/K,MAloEb,EAmoEC;CACCtH,MAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,mBAAnC,EAAwD,CAACjO,MAAD,EAAS;CAAC+V,QAAAA,QAAQ,EAAE;CAAX,OAAT,CAAxD,EAAoF,eAApF;CACA;CAroEF;CAAA;CAAA,+BAuoEYjc,QAvoEZ,EAwoEC;CACCpB,MAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,cAAnC,EAAmD,CAAC;CAACnU,QAAAA,QAAQ,EAARA;CAAD,OAAD,EAAa,IAAb,CAAnD,EAAuE,WAAvE;CACA;CA1oEF;CAAA;CAAA,kCA4oEekmB,MA5oEf,EA6oEC;CACCllB,MAAAA,EAAE,CAACoc,WAAH,CAAeC,OAAf,CAAuB6I,MAAvB;CACA;CA/oEF;CAAA;CAAA,oCAipEiB/mB,OAjpEjB,EAkpEC;CAAA;;CACC,UAAI,KAAKkC,aAAL,CAAmBsiB,IAAnB,CAAwB,UAAApiB,EAAE;CAAA,eAAIA,EAAE,CAACxB,EAAH,KAAUZ,OAAO,CAACY,EAAtB;CAAA,OAA1B,CAAJ,EACA;CACC,eAAO,KAAP;CACA;;CAED,WAAK5B,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,iBAApC,EAAuD;CACtDN,QAAAA,EAAE,EAAEZ,OAAO,CAACY,EAD0C;CAEtDD,QAAAA,MAAM,EAAEX,OAAO,CAACW,MAFsC;CAGtDQ,QAAAA,MAAM,EAAE;CACP6lB,UAAAA,KAAK,EAAE;CADA;CAH8C,OAAvD;CAQA,UAAIC,WAAW,GAAG,KAAKjoB,UAAL,CAAgB6D,WAAhB,CAA4B0hB,cAA5B,EAAlB;CACA,UAAIrlB,MAAM,GAAG,KAAKF,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B,EAAb;CACA,UAAI8O,WAAW,GAAGlnB,OAAO,CAAC+F,QAAR,GAAmB,CAAnB,GAAsB,KAAK/G,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,WAAnC,EAAgD7F,OAAO,CAAC+F,QAAxD,EAAkE,IAAlE,CAAtB,GAA+F,IAAjH;CAEA,WAAKohB,mBAAL,GAA2BzJ,YAAY,CACrCjN,MADyB,CAClB,yBAAuB,KAAKzR,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EADL,EAEzBiN,QAFyB,CAEhB,CACTC,gBAAgB,CAACnN,MAAjB,CAAwB,OAAxB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,2BAAjB,CADX,EAEEoM,OAFF,CAEUC,gBAAgB,CAACC,KAF3B,EAGErP,IAHF,CAGO,UAACjY,OAAD,EAAa;CAClB,YAAId,MAAM,GAAG,OAAI,CAACF,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B,EAAb;;CACA,YAAIlZ,MAAM,CAACyH,IAAP,KAAgB,cAAhB,IAAkC,CAACzH,MAAM,CAAC0H,WAAP,CAAmBC,QAAnB,CAA4B,OAAI,CAAC7H,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAA5B,CAAvC,EACA;CACC,iBAAO,IAAP;CACA;;CAED,eAAO,CAACjU,OAAO,CAAC+F,QAAT,IAAqB/F,OAAO,CAAC+F,QAAR,KAAqB,OAAI,CAAC/G,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAAjD;CACA,OAXF,CADS,EAeT2J,gBAAgB,CAACnN,MAAjB,CAAwB,MAAxB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,0BAAjB,CADX,EAEEoM,OAFF,CAEUC,gBAAgB,CAACE,IAF3B,EAGEtP,IAHF,CAGO,UAACjY,OAAD;CAAA,eAAaA,OAAO,CAACjB,MAAR,CAAeyoB,UAAf,KAA8B,GAA3C;CAAA,OAHP,CAfS,EAqBT5J,gBAAgB,CAACnN,MAAjB,CAAwB,OAAxB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,2BAAjB,CADX,EAEEoM,OAFF,CAEUC,gBAAgB,CAACxD,KAF3B,EAGE5L,IAHF,CAGO,UAACjY,OAAD,EACN;CACC,YAAId,MAAM,GAAG,OAAI,CAACF,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B,EAAb;;CACA,YAAIlZ,MAAM,CAACyH,IAAP,KAAgB,cAAhB,IAAkC,CAACzH,MAAM,CAAC0H,WAAP,CAAmBC,QAAnB,CAA4B,OAAI,CAAC7H,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAA5B,CAAvC,EACA;CACC,iBAAO,IAAP;CACA;;CAED,eAAOjU,OAAO,CAACjB,MAAR,CAAeyoB,UAAf,KAA8B,GAArC;CACA,OAZF,CArBS,EAoCT5J,gBAAgB,CAACnN,MAAjB,CAAwB,QAAxB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,4BAAjB,CADX,EAEEoM,OAFF,CAEUC,gBAAgB,CAACI,MAF3B,EAGExP,IAHF,CAGO,UAACjY,OAAD;CAAA,eAAaA,OAAO,CAAC+F,QAAR,KAAqB,OAAI,CAAC/G,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAArB,IAAgEjU,OAAO,CAACynB,MAArF;CAAA,OAHP,CApCS,EA0CT7J,gBAAgB,CAACnN,MAAjB,CAAwB,MAAxB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,0BAAjB,CADX,EAEEoM,OAFF,CAEUC,gBAAgB,CAACK,OAF3B,EAGEzP,IAHF,CAGO,UAACjY,OAAD;CAAA,eAAa,CAACA,OAAO,CAACynB,MAAtB;CAAA,OAHP,CA1CS,EAgDT7J,gBAAgB,CAACnN,MAAjB,CAAwB,MAAxB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,0BAAjB,CADX,EAEEoM,OAFF,CAEUC,gBAAgB,CAACM,IAF3B,EAGE1P,IAHF,CAGO,UAACjY,OAAD;CAAA,eAAaA,OAAO,CAAC+F,QAAR,KAAqB,OAAI,CAAC/G,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAArB,IAAgEjU,OAAO,CAACjB,MAAR,CAAeyoB,UAAf,KAA8B,GAA3G;CAAA,OAHP,CAhDS,EAsDT5J,gBAAgB,CAACnN,MAAjB,CAAwB,OAAxB,EACEmX,OADF,CACUC,oBAAoB,CAACC,IAD/B,EAEEV,OAFF,CAEUC,gBAAgB,CAACU,WAF3B,EAGElK,QAHF,CAGW,KAAK7C,WAAL,CAAiB,gCAAjB,CAHX,EAIEgN,YAJF,GAKE/P,IALF,CAKOgP,WAAW,CAACgB,QAAZ,IAAwB/oB,MAAM,CAACyH,IAAP,KAAgB,cAL/C,CAtDS,EA8DTiX,gBAAgB,CAACnN,MAAjB,CAAwB,SAAxB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,6BAAjB,CADX,EAEEoM,OAFF,CAEUC,gBAAgB,CAACvhB,IAF3B,EAGEmS,IAHF,CAGO,UAACjY,OAAD,EAAa;CAElB,YAAIA,OAAO,CAAC+F,QAAR,IAAoB,CAApB,IAAyB,CAACmhB,WAA9B,EACC,OAAO,IAAP;CAED,YAAI,CAAC/hB,kBAAK,CAACjG,MAAN,CAAauH,QAAb,CAAsB,OAAI,CAACzH,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAtB,CAAL,EACC,OAAO,IAAP;CAED,YAAI1Q,OAAO,CAAC+F,QAAR,KAAqB,OAAI,CAAC/G,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAAzB,EACC,OAAO,IAAP;;CAED,YACCiT,WAAW,CAACgB,cAAZ,KAA+B,aAA/B,IACGhB,WAAW,CAACgB,cAAZ,KAA+B,MAFnC,EAIA;CACC,iBAAO,IAAP;CACA;;CAED,eAAQ,KAAR;CACA,OAvBF,CA9DS,EAwFTtK,gBAAgB,CAACnN,MAAjB,CAAwB,QAAxB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,4BAAjB,CADX,EAEEmN,SAFF,CAEYC,iBAAiB,CAAC3X,MAAlB,GAA2B4X,OAA3B,CAAmCC,kBAAkB,CAAC7X,MAAnB,GAA4B8X,QAA5B,CAAqC,SAArC,CAAnC,CAFZ,EAGEnB,OAHF,CAGUC,gBAAgB,CAACmB,KAH3B,EAIEvQ,IAJF,CAIO,UAACjY,OAAD;CAAA,eAAaA,OAAO,CAAC+F,QAAR,KAAqB,OAAI,CAAC/G,UAAL,CAAgB6D,WAAhB,CAA4BoR,SAA5B,EAArB,IAAgEjU,OAAO,CAACjB,MAAR,CAAeyoB,UAAf,KAA8B,GAA3G;CAAA,OAJP,CAxFS,CAFgB,EAiGzBzJ,UAjGyB,CAiGdlc,EAAE,CAACqN,mBAAH,CAAuBnH,GAAvB,CAA2B,8BAA3B,EAA2D,OAA3D,CAjGc,EAkGzBiW,gBAlGyB,CAkGR,UAAC9d,IAAD,EAAOnB,MAAP,EAAeiB,OAAf,EAAwB8c,QAAxB,EAAqC;CACtD,YAAI5c,IAAI,KAAK,WAAb,EACA;CACC2R,UAAAA,UAAG,CAAC1O,KAAJ,CAAUC,KAAV,CAAgB,+BAAhB;CACA;;CAED,YAAIlD,IAAI,KAAK,UAAb,EACA;CACC,iBAAO,KAAP;CACA;;CAED,YAAInB,MAAM,CAAC6B,EAAP,KAAc,OAAlB,EACA;CACC,UAAA,OAAI,CAAC6H,WAAL,CAAiBzI,OAAO,CAAC+F,QAAzB;CACA,SAHD,MAIK,IAAIhH,MAAM,CAAC6B,EAAP,KAAc,MAAlB,EACL;CACC,UAAA,OAAI,CAAC6nB,WAAL,CAAiBzoB,OAAO,CAACY,EAAzB;CACA,SAHI,MAIA,IAAI7B,MAAM,CAAC6B,EAAP,KAAc,OAAlB,EACL;CACC,UAAA,OAAI,CAAC0L,iBAAL;;CACA,UAAA,OAAI,CAACtC,YAAL,CAAkBhK,OAAO,CAACY,EAA1B;CACA,SAJI,MAKA,IAAI7B,MAAM,CAAC6B,EAAP,KAAc,MAAlB,EACL;CACC,UAAA,OAAI,CAAC0L,iBAAL;;CACA,UAAA,OAAI,CAACoc,WAAL,CAAiB1oB,OAAO,CAACY,EAAzB;CACA,SAJI,MAKA,IAAI7B,MAAM,CAAC6B,EAAP,KAAc,QAAlB,EACL;CACC,UAAA,OAAI,CAAC+nB,aAAL,CAAmB3oB,OAAO,CAACY,EAA3B;CACA,SAHI,MAIA,IAAI7B,MAAM,CAAC6B,EAAP,KAAc,QAAlB,EACL;CACC,UAAA,OAAI,CAACgoB,aAAL,CAAmB5oB,OAAO,CAACY,EAA3B;CACA,SAHI,MAIA,IAAI7B,MAAM,CAAC6B,EAAP,KAAc,MAAlB,EACL;CACC,UAAA,OAAI,CAAC+I,WAAL,CAAiB3J,OAAO,CAACY,EAAzB;CACA,SAHI,MAIA,IAAI7B,MAAM,CAAC6B,EAAP,KAAc,OAAlB,EACL;CACC,cAAI1B,OAAM,GAAG,OAAI,CAACF,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B,EAAb;;CACA,cAAIyQ,OAAO,GAAGnL,YAAY,CACxBjN,MADY,CACL,iCAA+B,OAAI,CAACzR,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAD1B,EAEZiN,QAFY,CAEH,CACTC,gBAAgB,CAACnN,MAAjB,CAAwB,YAAxB,EACE2W,OADF,CACUC,gBAAgB,CAACyB,IAD3B,EAEEjL,QAFF,CAEW,OAAI,CAAC7C,WAAL,CAAiB,gCAAjB,CAFX,CADS,EAKT4C,gBAAgB,CAACnN,MAAjB,CAAwB,YAAxB,EACE2W,OADF,CACUC,gBAAgB,CAAC0B,QAD3B,EAEElL,QAFF,CAEW,OAAI,CAAC7C,WAAL,CAAiB,qCAAjB,CAFX,CALS,EAST4C,gBAAgB,CAACnN,MAAjB,CAAwB,YAAxB,EACE2W,OADF,CACUC,gBAAgB,CAAC2B,IAD3B,EAEEnL,QAFF,CAEW,OAAI,CAAC7C,WAAL,CAAiB,gCAAjB,CAFX,CATS,CAFG,EAgBZgD,gBAhBY,CAgBK,UAAC9d,IAAD,EAAOnB,MAAP,EAAemI,OAAf,EAAwB4V,QAAxB,EAClB;CACC,gBAAI5c,IAAI,KAAK,UAAb,EACA;CACC,qBAAO,KAAP;CACA;;CAGD,gBAAInB,MAAM,CAAC6B,EAAP,KAAc,YAAlB,EACA;CACC,cAAA,OAAI,CAACqoB,YAAL,CAAkBjpB,OAAO,CAACY,EAA1B,EAA8B,MAA9B;CACA,aAHD,MAIK,IAAI7B,MAAM,CAAC6B,EAAP,KAAc,YAAlB,EACL;CACC,cAAA,OAAI,CAACqoB,YAAL,CAAkBjpB,OAAO,CAACY,EAA1B,EAA8B,MAA9B;CACA,aAHI,MAIA,IAAI7B,MAAM,CAAC6B,EAAP,KAAc,YAAlB,EACL;CACC,cAAA,OAAI,CAACqoB,YAAL,CAAkBjpB,OAAO,CAACY,EAA1B,EAA8B,MAA9B;CACA;CACD,WApCY,CAAd;CAsCAkc,UAAAA,QAAQ,CAACoM,WAAT,CAAqBL,OAArB;CACA,SA1CI,MA2CA,IAAI9pB,MAAM,CAAC6B,EAAP,KAAc,SAAlB,EACL;CACC,UAAA,OAAI,CAACuI,WAAL,CAAiBnJ,OAAO,CAAC+F,QAAzB;CACA,SAHI,MAKL;CACCyG,UAAAA,OAAO,CAACvD,IAAR,CAAa,qCAAb,EAAoDlK,MAApD;CACA;CACD,OA9LyB,CAA3B;CAiMA,WAAKooB,mBAAL,CAAyBhJ,eAAzB,CAAyCne,OAAzC,EAAkDyL,IAAlD;CAEAyQ,MAAAA,MAAM,CAACC,OAAP,CAAeC,eAAf,CAA+B,qBAA/B,EAAsD,EAAtD;CACA;CAx2EF;CAAA;CAAA,qCA22EC;CAAA;;CACCF,MAAAA,MAAM,CAACC,OAAP,CAAeC,eAAf,CAA+B,uBAA/B,EAAwD,EAAxD;;CAEA,UAAI,CAAC,KAAK+M,UAAV,EACA;CACC,aAAKA,UAAL,GAAkBC,UAAU,CAAC3Y,MAAX,GAChB4Y,wBADgB,GAEhBrL,gBAFgB,CAEC,UAAC9d,IAAD,EAAOnB,MAAP,EAAeuqB,YAAf,EAAgC;CACjD,cAAIppB,IAAI,KAAK,UAAb,EACA;CACC,mBAAO,KAAP;CACA;;CAED,cAAInB,MAAM,CAAC6B,EAAP,KAAc,SAAlB,EACA;CACC,YAAA,OAAI,CAACuI,WAAL,CAAiB,OAAI,CAACnK,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAjB;CACA,WAHD,MAIK,IAAI3R,MAAM,CAAC6B,EAAP,KAAc,WAAlB,EACL;CACC,YAAA,OAAI,CAAC2oB,YAAL,CAAkB;CAAC1M,cAAAA,QAAQ,EAAE,OAAX;CAAoBhd,cAAAA,KAAK,EAAE,OAAI,CAACmb,WAAL,CAAiB,8BAAjB,CAA3B;CAA6E8B,cAAAA,QAAQ,EAAE;CAAvF,aAAlB;CACA,WAHI,MAIA,IAAI/d,MAAM,CAAC6B,EAAP,KAAc,UAAlB,EACL;CACC,YAAA,OAAI,CAACyb,iBAAL;CACA,WAHI,MAIA,IAAItd,MAAM,CAAC6B,EAAP,KAAc,OAAlB,EACL;CACC,YAAA,OAAI,CAAC2d,SAAL;CACA,WAHI,MAIA,IAAIxf,MAAM,CAAC6B,EAAP,KAAc,QAAlB,EACL;CACC,YAAA,OAAI,CAAC5B,UAAL,CAAgB6D,WAAhB,CAA4B2mB,UAA5B;CACA,WAHI,MAIA,IAAIzqB,MAAM,CAAC6B,EAAP,KAAc,gBAAlB,EACL;CACCiB,YAAAA,EAAE,CAACoc,WAAH,CAAeC,OAAf,CAAuB,OAAI,CAAClf,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B,GAA4CqR,QAAnE;CACA,WAHI,MAIA,IAAI1qB,MAAM,CAAC6B,EAAP,KAAc,UAAlB,EACL;CACC,gBAAI8oB,OAAO,GAAG,OAAI,CAAC1qB,UAAL,CAAgB6D,WAAhB,CAA4B8mB,gBAA5B,EAAd;;CACA,gBAAIC,UAAU,GAAG/nB,EAAE,CAACoc,WAAH,CAAe4L,mBAAf,CAAmC,UAAQH,OAAO,CAACxO,UAAhB,GAA2B,QAA3B,GAAoCwO,OAAO,CAACD,QAA5C,GAAqD,GAAxF,CAAjB;;CACA,gBAAIG,UAAJ,EACA;CACCA,cAAAA,UAAU;CACV;CACD,WARI,MASA,IAAI7qB,MAAM,CAAC6B,EAAP,KAAc,QAAlB,EACL;CACE,gBAAInB,WAAW,CAACC,EAAZ,CAAesL,eAAnB,CAAmC;CACnChL,cAAAA,OAAO,EAAE,OAAI,CAACgb,WAAL,CAAiB,gCAAjB,CAD0B;CAEnCvV,cAAAA,KAAK,EAAE,WAF4B;CAGnCwF,cAAAA,SAAS,EAAE,SAHwB;CAInCC,cAAAA,OAAO,EAAE,SAJ0B;CAKnC4e,cAAAA,SAAS,EAAE,IALwB;CAMnC3e,cAAAA,QAAQ,EAAE,CANyB;CAOnCC,cAAAA,KAAK,EAAE,QAP4B;CAQnCI,cAAAA,SAAS,EAAE;CARwB,aAAnC,EASE,MATF,CAAD,CASYC,IATZ;;CAWA,YAAA,OAAI,CAACzM,UAAL,CAAgB+qB,eAAhB,GAAkCC,aAAlC;;CAEAC,YAAAA,MAAM;CACN;CACD,SA1DgB,CAAlB;CA4DA;;CAED,UAAI9kB,kBAAK,CAACjG,MAAN,CAAauH,QAAb,CAAsB,KAAKzH,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAtB,CAAJ,EACA;CACC,YAAIiL,UAAU,GAAG,KAAK3c,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B,EAAjB;CACA,YAAI8R,gBAAgB,GAAG,CAAC,KAAKlrB,UAAL,CAAgB6D,WAAhB,CAA4BsnB,aAA5B,EAAD,GAA8C,KAAKnP,WAAL,CAAiB,mCAAjB,CAA9C,GAAqG,KAAKA,WAAL,CAAiB,kCAAjB,CAA5H;CACA,YAAIoP,gBAAgB,GAAG,CAAC,KAAKprB,UAAL,CAAgB6D,WAAhB,CAA4BsnB,aAA5B,EAAD,GAA8CE,cAAc,CAACC,MAA7D,GAAqED,cAAc,CAACE,UAA3G;CAEA,YAAIC,eAAe,GAAG,EAAtB;;CACA,YACC7O,UAAU,CAAChV,IAAX,KAAoBoV,mBAAU,CAACxb,IAA/B,IACGob,UAAU,CAAChV,IAAX,KAAoBoV,mBAAU,CAAC0O,GAFnC,EAIA;CACC,cAAIf,OAAO,GAAG,KAAK1qB,UAAL,CAAgB6D,WAAhB,CAA4B8mB,gBAA5B,EAAd;;CACA,cAAID,OAAO,CAACjoB,OAAZ,EACA;CACC,gBAAIioB,OAAO,CAACxO,UAAR,KAAuBwP,sBAAa,CAACC,IAAzC,EACA;CACCH,cAAAA,eAAe,GAAG,KAAKxP,WAAL,CAAiB,sBAAjB,CAAlB;CACA,aAHD,MAIK,IAAI0O,OAAO,CAACxO,UAAR,KAAuBwP,sBAAa,CAACE,OAAzC,EACL;CACCJ,cAAAA,eAAe,GAAG,KAAKxP,WAAL,CAAiB,yBAAjB,CAAlB;CACA,aAHI,MAIA,IAAI0O,OAAO,CAACxO,UAAR,KAAuBwP,sBAAa,CAACG,OAAzC,EACL;CACCL,cAAAA,eAAe,GAAG,KAAKxP,WAAL,CAAiB,yBAAjB,CAAlB;CACA,aAHI,MAIA,IAAI0O,OAAO,CAACxO,UAAR,KAAuBwP,sBAAa,CAACI,IAAzC,EACL;CACCN,cAAAA,eAAe,GAAG,KAAKxP,WAAL,CAAiB,sBAAjB,CAAlB;CACA,aAHI,MAKL;CACCwP,cAAAA,eAAe,GAAG,KAAKxP,WAAL,CAAiB,iBAAjB,CAAlB;CACA;CACD;CACD;;CAED,YAAIW,UAAU,CAAChV,IAAX,KAAoBoV,mBAAU,CAACxb,IAAnC,EACA;CACC,eAAK4oB,UAAL,CAAgBxL,QAAhB,CAAyB,CACxBoN,cAAc,CAACta,MAAf,CAAsB,gBAAtB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,+BAAjB,CADX,EAEEoM,OAFF,CAEUiD,cAAc,CAACW,KAFzB,EAGE/S,IAHF,CAGO0D,UAAU,CAAC8N,QAAX,KAAwB,iBAH/B,CADwB,EAMxBsB,cAAc,CAACta,MAAf,CAAsB,UAAtB,EACEoN,QADF,CACW2M,eADX,EAEEpD,OAFF,CAEUiD,cAAc,CAACtB,QAFzB,EAGE9Q,IAHF,CAGO0D,UAAU,CAAC8N,QAAX,KAAwB,iBAAxB,IAA6C,CAACe,eAHrD,CANwB,EAWxBO,cAAc,CAACta,MAAf,CAAsB,QAAtB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,2BAAjB,CADX,EAEEoM,OAFF,CAEUiD,cAAc,CAACJ,MAFzB,CAXwB,CAAzB;CAgBA,SAlBD,MAoBA;CACC,cAAIhO,KAAK,GAAG,CACX8O,cAAc,CAACta,MAAf,CAAsB,QAAtB,EACEoN,QADF,CACWqM,gBADX,EAEE9C,OAFF,CAEUgD,gBAFV,CADW,EAKXW,cAAc,CAACta,MAAf,CAAsB,WAAtB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,8BAAjB,CADX,EAEEoM,OAFF,CAEUiD,cAAc,CAACvkB,IAFzB,CALW,EASXilB,cAAc,CAACta,MAAf,CAAsB,UAAtB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,6BAAjB,CADX,EAEEoM,OAFF,CAEUiD,cAAc,CAACY,SAFzB,EAGEhT,IAHF,CAGO,CAAC0D,UAAU,CAAC1a,YAAX,CAAwB+a,MAHhC,CATW,EAcX+O,cAAc,CAACta,MAAf,CAAsB,OAAtB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,0BAAjB,CADX,EAEEoM,OAFF,CAEUiD,cAAc,CAACa,KAFzB,EAGEjT,IAHF,CAGO,CAAC0D,UAAU,CAAC1a,YAAX,CAAwBkqB,KAHhC,CAdW,EAmBXJ,cAAc,CAACta,MAAf,CAAsB,QAAtB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,2BAAjB,CADX,EAEEoM,OAFF,CAEUiD,cAAc,CAACJ,MAFzB,CAnBW,CAAZ;CAyBAhO,UAAAA,KAAK,CAAC/W,IAAN,CAAW6lB,cAAc,CAACta,MAAf,CAAsB,QAAtB,EACToN,QADS,CACA,KAAK7C,WAAL,CAAiB,2BAAjB,CADA,EAEToM,OAFS,CAEDiD,cAAc,CAACJ,MAFd,CAAX;;CAIA,cACCtO,UAAU,CAAChV,IAAX,KAAoBoV,mBAAU,CAAC0O,GAA/B,IACGD,eAFJ,EAIA;CACCvO,YAAAA,KAAK,CAACmP,OAAN,CAAcL,cAAc,CAACta,MAAf,CAAsB,UAAtB,EACZoN,QADY,CACH2M,eADG,EAEZpD,OAFY,CAEJiD,cAAc,CAACtB,QAFX,CAAd;CAIA;;CAED,eAAKI,UAAL,CAAgBxL,QAAhB,CAAyB1B,KAAzB;CACA;CACD,OArGD,MAuGA;CACC,aAAKkN,UAAL,CAAgBxL,QAAhB,CAAyB,CACxBoN,cAAc,CAACta,MAAf,CAAsB,SAAtB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,4BAAjB,CADX,EAEEoM,OAFF,CAEU,MAFV,EAGEnP,IAHF,CAGO9S,kBAAK,CAACjG,MAAN,CAAauH,QAAb,CAAsB,KAAKzH,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAtB,CAHP,CADwB,EAMxBqa,cAAc,CAACta,MAAf,CAAsB,UAAtB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,6BAAjB,CADX,EAEEoM,OAFF,CAEUiD,cAAc,CAACY,SAFzB,CANwB,EAUxBF,cAAc,CAACta,MAAf,CAAsB,QAAtB,EACEoN,QADF,CACW,KAAK7C,WAAL,CAAiB,2BAAjB,CADX,EAEEoM,OAFF,CAEUiD,cAAc,CAACJ,MAFzB,CAVwB,CAAzB;CAeA;;CAED,WAAKd,UAAL,CAAgB1d,IAAhB,CAAqB,IAArB;CACA;CAxiFF;CAAA;CAAA,iCA0iFcxJ,SA1iFd,EA0iFyB0E,IA1iFzB,EA2iFC;CACC,UAAI,CAAC,KAAK3H,UAAL,CAAgBqsB,QAAhB,EAAL,EACA;CACC,eAAO,KAAP;CACA;;CAED,aAAO,KAAKrsB,UAAL,CAAgB6D,WAAhB,CAA4BomB,YAA5B,CAAyChnB,SAAzC,EAAoD0E,IAApD,CAAP;CACA;CAljFF;CAAA;CAAA,gCAojFa1E,SApjFb,EAqjFC;CACC;CACA;CACA;CACA;CAEA,WAAKjD,UAAL,CAAgB6D,WAAhB,CAA4B8G,WAA5B,CAAwC1H,SAAxC,EAAmD,IAAnD,EAAyD,IAAzD,EAA+DiK,IAA/D,CAAoE,UAAC7J,MAAD,EACpE;CACC,YAAIA,MAAM,CAACgG,MAAP,IAAiB,CAArB,EACA;CACC,iBAAO,IAAP;CACA;;CACD5I,QAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,8BAAnC,EAAmE,CAClE,aADkE,EAElE,iBAAe3S,MAAM,CAACxB,QAF4C,EAGlEwB,MAHkE,EAIlE,KAJkE,EAKlE,GALkE,CAAnE,EAMG,YANH;CAOA,OAbD;CAeA,aAAO,IAAP;CACA;CA3kFF;CAAA;CAAA,kCA6kFeJ,SA7kFf,EA8kFC;CACC,UAAI,CAAC,KAAKjD,UAAL,CAAgBqsB,QAAhB,EAAL,EACA;CACC,eAAO,KAAP;CACA;;CAED,aAAO,KAAKrsB,UAAL,CAAgB6D,WAAhB,CAA4B+lB,aAA5B,CAA0C3mB,SAA1C,CAAP;CACA;CArlFF;CAAA;CAAA,mCAulFgB6H,IAvlFhB,EAwlFC;CACC,UAAI,CAAC3E,kBAAK,CAACjG,MAAN,CAAauH,QAAb,CAAsB,KAAKzH,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAtB,CAAL,EACA;CACC,eAAO,KAAP;CACA;;CAED,UAAI,CAAC5G,IAAD,IAASA,IAAI,CAACzC,MAAL,IAAe,CAA5B,EACA;CACC,eAAO,KAAP;CACA;;CAED,WAAKkiB,YAAL,CAAkB;CACjBtpB,QAAAA,KAAK,EAAE6J,IAAI,CAACiQ,GAAL,CAAS,UAAA4E,OAAO;CAAA,iBAAIA,OAAO,CAAC5X,MAAZ;CAAA,SAAhB,CADU;CAEjBlH,QAAAA,KAAK,EAAE,KAAKmb,WAAL,CAAiB,0BAAjB;CAFU,OAAlB;CAIA;CAvmFF;CAAA;CAAA,gCAymFajU,MAzmFb,EA0mFC;CAAA,UADoBuV,QACpB,uEAD+B,IAC/B;;CACC,UAAI,CAAC,KAAKtd,UAAL,CAAgBqsB,QAAhB,EAAL,EACA;CACC,eAAO,KAAP;CACA;;CAED,UAAI,CAAC/O,QAAL,EACA;CACCA,QAAAA,QAAQ,GAAG,KAAKtd,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,WAAnC,EAAgDkB,MAAhD,CAAX;CACA;;CAED,aAAO,KAAK+B,UAAL,CAAgB;CAAChJ,QAAAA,IAAI,kBAAWiH,MAAX,cAAqBuV,QAAQ,CAACgP,SAA9B;CAAL,OAAhB,CAAP;CACA;CAtnFF;CAAA;CAAA,gCAwnFa1qB,EAxnFb,EAynFC;CACC,UAAIoJ,YAAY,GAAG,KAAKhL,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,qBAAnC,EAA0D,KAAK7G,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAA1D,EAAmG1Q,EAAnG,CAAnB;CAEA,UAAId,IAAI,GAAG,EAAX;;CAEA,UAAIkK,YAAY,CAACjL,MAAb,CAAoBmlB,OAApB,IAA+Bla,YAAY,CAACjL,MAAb,CAAoBmlB,OAApB,CAA4B7c,MAA/D,EACA;CACCvH,QAAAA,IAAI,GAAGkK,YAAY,CAACjL,MAAb,CAAoBmlB,OAApB,CAA4BnK,GAA5B,CAAgC,UAAAxG,MAAM;CAAA,iBAAI,WAASA,MAAT,GAAgB,GAApB;CAAA,SAAtC,EAA+DjO,IAA/D,CAAoE,GAApE,CAAP;CACA;;CAED,UAAI0E,YAAY,CAAClK,IAAjB,EACA;CACC,YAAIA,IAAJ,EACA;CACCA,UAAAA,IAAI,IAAI,IAAR;CACA;;CAEDA,QAAAA,IAAI,IAAIkK,YAAY,CAAClK,IAAb,CAAkB+Z,OAAlB,CAA0B,gBAA1B,EAA4C,IAAI6J,MAAJ,CAAW,EAAX,IAAe,IAA3D,CAAR;CACA;;CAEDpiB,MAAAA,GAAG,CAACyJ,IAAJ,CAAS,iBAAT,EAA4B;CAACjL,QAAAA,IAAI,EAAJA;CAAD,OAA5B;CAEC,UAAIL,WAAW,CAACC,EAAZ,CAAesL,eAAnB,CAAmC;CACnChL,QAAAA,OAAO,EAAE6B,EAAE,CAAC7B,OAAH,CAAW,kCAAX,CAD0B;CAEnCyF,QAAAA,KAAK,EAAE,WAF4B;CAGnCwF,QAAAA,SAAS,EAAE,SAHwB;CAInCC,QAAAA,OAAO,EAAE,WAJ0B;CAKnCC,QAAAA,QAAQ,EAAE,CALyB;CAMnCC,QAAAA,KAAK,EAAE,QAN4B;CAOnCC,QAAAA,QAAQ,EAAE,IAPyB;CAQnCC,QAAAA,cAAc,EAAE,IARmB;CASnCC,QAAAA,eAAe,EAAE,IATkB;CAUnCC,QAAAA,SAAS,EAAE;CAVwB,OAAnC,EAWE,MAXF,CAAD,CAWYC,IAXZ;CAYA;CA3pFF;CAAA;CAAA,iCA6pFc7K,EA7pFd,EA8pFC;CAAA;;CACC,WAAK5B,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,kBAApC,EAAwD;CACvDL,QAAAA,QAAQ,EAAE,KAAK7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAD6C;CAEvDvP,QAAAA,MAAM,EAAE;CACPwE,UAAAA,OAAO,EAAE/E;CADF;CAF+C,OAAxD,EAKGsL,IALH,CAKQ,YAAM;CACb,YAAI,CAAC,OAAI,CAAClN,UAAL,CAAgBwQ,QAAhB,GAA2B1M,KAA3B,CAAiCD,WAAjC,CAA6CuO,MAA7C,CAAoDC,YAAzD,EACA;CACC,UAAA,OAAI,CAAC3E,YAAL;;CACApN,UAAAA,UAAU,CAAC,YAAM;CAChBoL,YAAAA,6BAAY,CAACC,IAAb,CAAkBhG,kBAAS,CAACzF,MAAV,CAAiB0L,cAAnC,EAAmD;CAClDjK,cAAAA,MAAM,EAAE,OAAI,CAAC3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAD0C;CAElDzG,cAAAA,QAAQ,EAAE,GAFwC;CAGlDC,cAAAA,oBAAoB,EAAE,KAH4B;CAIlDygB,cAAAA,KAAK,EAAE;CAJ2C,aAAnD;CAMA,WAPS,EAOP,GAPO,CAAV;CAQA;CACD,OAlBD;CAmBA;CAlrFF;CAAA;CAAA,iCAorFc3qB,EAprFd,EAorFkBuJ,QAprFlB,EAqrFC;CACC1K,MAAAA,WAAW,CAACsV,MAAZ,CAAmBC,eAAnB,CAAmC,8BAAnC,EAAmE,CAClE,cADkE,EAElE,kBAAgBpU,EAFkD,EAGlE;CACCqB,QAAAA,SAAS,EAAErB,EADZ;CAEC4J,QAAAA,MAAM,EAAEL,QAAQ,CAACK,MAAT,KAAoB,MAApB,GAA4B,MAA5B,GAAqCL,QAAQ,CAACK,MAAT,KAAoB,KAApB,GAA2B,MAA3B,GAAmC;CAFjF,OAHkE,EAOlE,KAPkE,EAQlE,IARkE,CAAnE,EASG,YATH;;CAWA,UAAIL,QAAQ,CAACK,MAAT,KAAoB,KAAxB,EACA;CACClL,QAAAA,UAAU,CAAC;CAAA,iBAAMgC,GAAG,CAACyJ,IAAJ,CAAS,eAAT,CAAN;CAAA,SAAD,EAAkC,GAAlC,CAAV;CACA;CACD;CArsFF;CAAA;CAAA,4CAusFyBnK,EAvsFzB,EAusF6B4qB,SAvsF7B,EAwsFC;CACC,UAAI,CAACrmB,kBAAK,CAACjG,MAAN,CAAauH,QAAb,CAAsB,KAAKzH,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAAtB,CAAL,EACA;CACC,eAAO,KAAP;CACA;;CAED,UAAIzQ,KAAK,GAAG,EAAZ;;CACA,WAAK,IAAIkK,QAAT,IAAqBqhB,SAArB,EACA;CACC,YAAI,CAACA,SAAS,CAAC9L,cAAV,CAAyBvV,QAAzB,CAAL,EACA;CACC;CACA;;CAEDlK,QAAAA,KAAK,GAAGA,KAAK,CAACwrB,MAAN,CAAaD,SAAS,CAACrhB,QAAD,CAAtB,CAAR;CACA;;CAED,WAAKof,YAAL,CAAkB;CACjBtpB,QAAAA,KAAK,EAAEA,KADU;CAEjBJ,QAAAA,KAAK,EAAE,KAAKmb,WAAL,CAAiB,0BAAjB;CAFU,OAAlB;CAIA;CA7tFF;CAAA;CAAA,wCAguFC;CACC,WAAKT,OAAL,CAAa,EAAb;CAEA,WAAKvb,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,kBAApC,EAAwD;CACvDL,QAAAA,QAAQ,EAAE,KAAK7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAD6C;CAEvDvP,QAAAA,MAAM,EAAE;CACPwE,UAAAA,OAAO,EAAE,CADF;CAEPM,UAAAA,MAAM,EAAE;CAFD;CAF+C,OAAxD;CAOA;CA1uFF;CAAA;CAAA,gCA4uFarF,EA5uFb,EA6uFC;CAAA;;CACC,UAAIZ,OAAO,GAAG,KAAKhB,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,qBAAnC,EAA0D,KAAK7G,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAA1D,EAAmG1Q,EAAnG,CAAd;CAEA,WAAK5B,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,kBAApC,EAAwD;CACvDL,QAAAA,QAAQ,EAAE,KAAK7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAD6C;CAEvDvP,QAAAA,MAAM,EAAE;CACPwE,UAAAA,OAAO,EAAE/E,EADF;CAEPqF,UAAAA,MAAM,EAAErF;CAFD;CAF+C,OAAxD,EAMGsL,IANH,CAMQ,YAAM;CACb5M,QAAAA,UAAU,CAAC;CAAA,iBAAMoL,6BAAY,CAACC,IAAb,CAAkBhG,kBAAS,CAACzF,MAAV,CAAiB0L,cAAnC,EAAmD;CAACjK,YAAAA,MAAM,EAAE,OAAI,CAAC3B,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAAT;CAAkDzG,YAAAA,QAAQ,EAAE,GAA5D;CAAiEC,YAAAA,oBAAoB,EAAE,KAAvF;CAA8FygB,YAAAA,KAAK,EAAE;CAArG,WAAnD,CAAN;CAAA,SAAD,EAAuK,GAAvK,CAAV;;CACA,QAAA,OAAI,CAAC7e,YAAL;CACA,OATD;CAWA,WAAK6N,OAAL,CAAava,OAAO,CAACF,IAArB;CACA;CA5vFF;CAAA;CAAA,kCA8vFec,EA9vFf,EA8vFmBd,IA9vFnB,EA+vFC;CACC,WAAKwM,iBAAL;CAEA,WAAKtN,UAAL,CAAgBwQ,QAAhB,GAA2BtO,QAA3B,CAAoC,kBAApC,EAAwD;CACvDL,QAAAA,QAAQ,EAAE,KAAK7B,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAD6C;CAEvDvP,QAAAA,MAAM,EAAE;CACP8E,UAAAA,MAAM,EAAE;CADD;CAF+C,OAAxD;CAOA,WAAKylB,eAAL,CAAqB9qB,EAArB,EAAyBd,IAAzB;CACA;CA1wFF;CAAA;CAAA,oCA4wFiBc,EA5wFjB,EA4wFqBd,IA5wFrB,EA6wFC;CACC,WAAKd,UAAL,CAAgBmY,UAAhB,CAA2BxL,UAA3B,CAAsCC,mBAAU,CAAC+f,eAAjD,EAAkE;CACjE,sBAAc/qB,EADmD;CAEjE,mBAAWd;CAFsD,OAAlE,EAGG,IAHH,EAGS,IAHT,EAGeqF,kBAAK,CAACgT,oBAAN,CAA2B;CACzCjY,QAAAA,IAAI,EAAE0L,mBAAU,CAAC+f,eADwB;CAEzCtrB,QAAAA,IAAI,EAAE;CAACurB,UAAAA,cAAc,EAAE;CAAjB,SAFmC;CAGzC1sB,QAAAA,MAAM,EAAE,KAAKF,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B;CAHiC,OAA3B,CAHf;CAQA;CAtxFF;CAAA;CAAA,kCAwxFexX,EAxxFf,EAyxFC;CAAA;;CACC,UAAIZ,OAAO,GAAG,KAAKhB,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,qBAAnC,EAA0D,KAAK7G,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAA1D,EAAmG1Q,EAAnG,CAAd;CACA,UAAIoF,KAAK,GAAG,KAAKhH,UAAL,CAAgBwQ,QAAhB,GAA2B3J,OAA3B,CAAmC,eAAnC,EAAoD,KAAK7G,UAAL,CAAgB6D,WAAhB,CAA4ByO,SAA5B,EAApD,CAAZ;CAEA,UAAIsT,WAAW,GAAGzf,kBAAK,CAACrF,IAAN,CAAWwG,MAAX,CAAkBtG,OAAO,CAACF,IAA1B,EAAgCE,OAAO,CAACjB,MAAxC,EAAgDiH,KAAhD,EAAuD,KAAKgV,WAAL,EAAvD,CAAlB;CACA4J,MAAAA,WAAW,GAAGA,WAAW,CAACvd,MAAZ,GAAqB,EAArB,GAAyBud,WAAW,CAACiH,MAAZ,CAAmB,CAAnB,EAAsB,EAAtB,IAA4B,KAArD,GAA4DjH,WAA1E;CAEAtjB,MAAAA,GAAG,CAAC8c,OAAJ,CAAY;CACXve,QAAAA,KAAK,EAAE,KAAKmb,WAAL,CAAiB,oCAAjB,CADI;CAEXlb,QAAAA,IAAI,EAAE8kB,WAAW,GAAE,MAAMA,WAAN,GAAoB,GAAtB,GAA2B,EAFjC;CAGXvG,QAAAA,OAAO,EAAE,CACR,KAAKrD,WAAL,CAAiB,gCAAjB,CADQ,EAER,KAAKA,WAAL,CAAiB,+BAAjB,CAFQ,CAHE;CAOXrJ,QAAAA,QAAQ,EAAE,kBAAC2M,MAAD,EACV;CACC,cAAIA,MAAM,KAAK,CAAf,EACA;CACC,YAAA,OAAI,CAAChS,iBAAL;;CACA,YAAA,OAAI,CAACwf,iBAAL,CAAuBlrB,EAAvB;CACA;CACD;CAdU,OAAZ;CAgBA;CAhzFF;CAAA;CAAA,sCAkzFmBA,EAlzFnB,EAmzFC;CACC,WAAK5B,UAAL,CAAgBmY,UAAhB,CAA2BxL,UAA3B,CAAsCC,mBAAU,CAACmgB,eAAjD,EAAkE;CACjE,sBAAcnrB;CADmD,OAAlE,EAEG,IAFH,EAES,IAFT,EAEeuE,kBAAK,CAACgT,oBAAN,CAA2B;CACzCjY,QAAAA,IAAI,EAAE0L,mBAAU,CAACmgB,eADwB;CAEzC1rB,QAAAA,IAAI,EAAE,EAFmC;CAGzCnB,QAAAA,MAAM,EAAE,KAAKF,UAAL,CAAgB6D,WAAhB,CAA4BuV,aAA5B,CAA0C,KAAKpZ,UAAL,CAAgB6D,WAAhB,CAA4B6N,WAA5B,EAA1C;CAHiC,OAA3B,CAFf;CAOA;CA3zFF;CAAA;CAAA,+BA6zFY3R,MA7zFZ,EA8zFC;CAAA;;CACCU,MAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBmT,SAApB,CAA8BkZ,OAA9B,CAAsC,UAAClsB,IAAD,EAAU;CAC/CA,QAAAA,IAAI,GAAGA,IAAI,CAACoS,QAAL,GAAgB2P,IAAhB,EAAP;CAEA/hB,QAAAA,IAAI,GAAGA,IAAI,GAAEA,IAAI,GAAC,GAAL,GAASf,MAAM,CAACe,IAAlB,GAAwBf,MAAM,CAACe,IAA1C;;CAEA,QAAA,OAAI,CAACya,OAAL,CAAaza,IAAb;;CACA,QAAA,OAAI,CAAC4M,YAAL;CACA,OAPD;CAQA;CAv0FF;CAAA;CAAA,8BA00FC;CAAA,UADQ5M,IACR,uEADe,EACf;CACCA,MAAAA,IAAI,GAAGA,IAAI,CAACoS,QAAL,EAAP;;CAEA,UAAIpS,IAAJ,EACA;CACCL,QAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBmT,SAApB,CAA8ByH,OAA9B,CAAsCza,IAAtC;CACA,OAHD,MAKA;CACCL,QAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBmT,SAApB,CAA8BmZ,KAA9B;CACA;;CAED,WAAKpb,kBAAL,CAAwB;CAAC7Q,QAAAA,OAAO,EAAEF;CAAV,OAAxB;CAEA0M,MAAAA,OAAO,CAAC2C,GAAR,CAAY,0BAAZ,EAAwCrP,IAAI,GAAEA,IAAF,GAAQ,aAApD;CACA;CAz1FF;CAAA;CAAA,gCA41FC;CACC,WAAKya,OAAL;CACA;CA91FF;CAAA;CAAA,mCAi2FC;CACC,UAAI,CAAC,KAAKvb,UAAL,CAAgBwQ,QAAhB,GAA2B1M,KAA3B,CAAiCD,WAAjC,CAA6CuO,MAA7C,CAAoDC,YAAzD,EACA;CACC5R,QAAAA,WAAW,CAACC,EAAZ,CAAeC,IAAf,CAAoBmT,SAApB,CAA8BoZ,KAA9B;CACA;CACD;CAt2FF;CAAA;CAAA,mCAy2FC;CACC,UAAI,QAAOC,kBAAP,qDAAOA,kBAAP,OAA8B,QAAlC,EACA;CACC,eAAO,KAAP;CACA;;CAED,UACC,OAAOA,kBAAkB,CAACC,WAA1B,KAA0C,UAA1C,IACG,CAACD,kBAAkB,CAACC,WAAnB,EAFL,EAIA;CACC,eAAO,IAAP;CACA;;CAED,UAAI,OAAOD,kBAAkB,CAACE,YAA1B,KAA2C,UAA/C,EACA;CACC,eAAOF,kBAAkB,CAACE,YAAnB,EAAP;CACA;;CAED,aAAO,KAAP;CACA;CA73FF;CAAA;CAAA,iCAg4FC;CAEC;CAEF;;CAEA;;CAt4FA;CAAA;CAAA,iDAw4F8B7hB,MAx4F9B,EAw4FsCnK,KAx4FtC,EAy4FC;CACC,UAAIisB,aAAa,GACjB;CACClrB,QAAAA,KAAK,EAAE;CAAA,iBAAM,KAAN;CAAA,SADR;CAECf,QAAAA,IAAI,EAAE;CAAA,iBAAMA,KAAI,CAACgC,MAAX;CAAA;CAFP,OADA;CAMAmK,MAAAA,OAAO,CAAC2C,GAAR,CAAY,qCAAZ,EAAmD3E,MAAnD,EAA2DnK,KAA3D;;CAEA,UAAImK,MAAM,KAAK,aAAf,EACA;CACC,aAAKxL,UAAL,CAAgByY,iBAAhB,CAAkClB,0BAAiB,CAAC0O,YAApD,EAAkEqH,aAAlE,EAAiFjsB,KAAI,CAAClB,KAAtF;CACA,OAHD,MAIK,IAAIqL,MAAM,KAAK,aAAf,EACL;CACC,aAAK+hB,uBAAL;CACA,OAHI,MAIA,IAAI/hB,MAAM,KAAK,oBAAf,EACL;CACC,aAAKxL,UAAL,CAAgByY,iBAAhB,CAAkClB,0BAAiB,CAAC0O,YAApD,EAAkEqH,aAAlE,EAAiFjsB,KAAI,CAAClB,KAAtF;CACA;CACD;CA95FF;CAAA;CAAA,iDAg6F8BqL,MAh6F9B,EAg6FsCnK,IAh6FtC,EAi6FC;CACC,UAAImsB,WAAW,GACf;CACCprB,QAAAA,KAAK,EAAE,iBAAM;CACZ,iBAAO;CACNA,YAAAA,KAAK,EAAEf,IAAI,CAACosB,IADN;CAENjV,YAAAA,iBAAiB,EAAEnX,IAAI,CAACP,IAFlB;CAGNuB,YAAAA,EAAE,EAAE;CACHuQ,cAAAA,MAAM,EAAEvR,IAAI,CAACuR;CADV;CAHE,WAAP;CAOA,SATF;CAUCvR,QAAAA,IAAI,EAAE;CAAA,iBAAM,KAAN;CAAA;CAVP,OADA;CAcAmM,MAAAA,OAAO,CAAC2C,GAAR,CAAY,qCAAZ,EAAmD3E,MAAnD,EAA2DnK,IAA3D;;CAEA,UAAImK,MAAM,KAAK,aAAf,EACA,CADA,MAIK,IAAIA,MAAM,KAAK,oBAAf,EACL;CACC,aAAKxL,UAAL,CAAgByY,iBAAhB,CAAkClB,0BAAiB,CAAC0O,YAApD,EAAkEuH,WAAlE,EAA+EnsB,IAAI,CAAClB,KAApF;CACA;CACD;CAEF;;CAEA;;CA97FA;CAAA;CAAA,+BAi8FC;CAAA,UADSstB,IACT,uEADgB,EAChB;CAAA,UADoBjnB,WACpB,uEADkC,EAClC;CACCgH,MAAAA,OAAO,CAACpL,KAAR,6BAAmCqrB,IAAnC,eAA4CjnB,WAA5C;CAEA,UAAIknB,mBAAmB,GAAG,EAA1B;;CACA,UAAID,IAAI,CAACE,QAAL,CAAc,WAAd,CAAJ,EACA;CACCD,QAAAA,mBAAmB,GAAGlnB,WAAtB;CACA;;CAED,WAAKxG,UAAL,CAAgBwQ,QAAhB,GAA2BlP,MAA3B,CAAkC,iBAAlC,EAAqD;CAACc,QAAAA,KAAK,EAAE;CAC5DwrB,UAAAA,MAAM,EAAE,IADoD;CAE5DH,UAAAA,IAAI,EAAJA,IAF4D;CAG5DjnB,UAAAA,WAAW,EAAEknB;CAH+C;CAAR,OAArD;CAKA;CA/8FF;CAAA;CAAA,iCAk9FC;CACC,WAAK1tB,UAAL,CAAgBwQ,QAAhB,GAA2BlP,MAA3B,CAAkC,iBAAlC,EAAqD;CAACc,QAAAA,KAAK,EAAE;CAC5DwrB,UAAAA,MAAM,EAAE,KADoD;CAE5DH,UAAAA,IAAI,EAAE,EAFsD;CAG5DjnB,UAAAA,WAAW,EAAE;CAH+C;CAAR,OAArD;CAKA;CAx9FF;CAAA;CAAA,gCA09FaqnB,OA19Fb,EA29FC;CACC,aAAO,KAAK7tB,UAAL,CAAgB4C,WAAhB,CAA4BirB,OAA5B,CAAP;CACA;CA79FF;CAAA;CAAA,gCA+9Fa3sB,IA/9Fb,EAg+FC;CACC,aAAO,KAAKlB,UAAL,CAAgBgc,WAAhB,CAA4B9a,IAA5B,CAAP;CACA;CAEF;;CACA;;CAr+FA;CAAA;CAAA,oCAu+FC;CACC,WAAKmW,oBAAL;CACA,WAAKtI,WAAL,GAAmB,IAAnB;CACA;CACF;;CA3+FA;CAAA;CAAA;;;;;;;;"}
