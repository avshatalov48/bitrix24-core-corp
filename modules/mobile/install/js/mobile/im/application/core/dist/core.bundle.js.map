{"version":3,"file":"core.bundle.js","sources":["../src/launcher.js","../src/core.js"],"sourcesContent":["/**\n * Bitrix Im mobile\n * Application Launcher\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2020 Bitrix\n */\n\nexport const ApplicationLauncher = function (name, params = {})\n{\n\tname = name.toString();\n\tname = name.substr(0, 1).toUpperCase()+name.substr(1);\n\n\tif (name === 'Launch' || name === 'Core' || name.endsWith('Application'))\n\t{\n\t\tconsole.error('BX.Messenger.Application.Launch: specified name is forbidden.');\n\t\treturn new Promise((resolve, reject) => reject());\n\t}\n\n\tlet launch = function() {\n\t\tBX.Messenger.Application[name] = new BX.Messenger.Application[name+'Application'](params);\n\t\treturn BX.Messenger.Application[name].ready();\n\t};\n\n\tif (typeof BX.Messenger.Application[name+'Application'] === 'undefined')\n\t{\n\t\tconsole.error('BX.Messenger.Application.Launch: application is not found.');\n\t\treturn new Promise((resolve, reject) => reject());\n\t}\n\n\treturn launch();\n};","/**\n * Bitrix Im mobile\n * Core application\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2020 Bitrix\n */\nimport {Controller} from \"im.controller\";\nimport {ApplicationLauncher} from \"./launcher\";\n\nimport {PULL as Pull, PullClient} from \"mobile.pull.client\";\nimport {VuexBuilder} from \"ui.vue.vuex\";\n\nclass CoreApplication\n{\n\tconstructor()\n\t{\n\t\tthis.inited = false;\n\t\tthis.initPromise = new BX.Promise;\n\n\t\tthis.loadParams();\n\t}\n\n\tloadParams()\n\t{\n\t\tif (typeof BX.componentParameters === 'undefined')\n\t\t{\n\t\t\tsetTimeout(this.loadParams.bind(this), 10);\n\t\t\treturn false;\n\t\t}\n\n\t\tBX.componentParameters.init().then(params => {\n\t\t\tthis.controller = new Controller({\n\t\t\t\thost: currentDomain,\n\t\t\t\tuserId: params.USER_ID,\n\t\t\t\tsiteDir: params.SITE_DIR,\n\t\t\t\tsiteId: params.SITE_ID,\n\t\t\t\tlanguageId: params.LANGUAGE_ID,\n\t\t\t\tpull: {\n\t\t\t\t\tinstance: PullClient,\n\t\t\t\t\tclient: Pull,\n\t\t\t\t},\n\t\t\t\tvuexBuilder: {\n\t\t\t\t\tdatabase: true,\n\t\t\t\t\tdatabaseName: 'mobile/im',\n\t\t\t\t\tdatabaseType: VuexBuilder.DatabaseType.jnSharedStorage,\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.controller.ready().then(core => {\n\t\t\t\tthis.inited = true;\n\t\t\t\tthis.initPromise.resolve(core);\n\t\t\t});\n\t\t});\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\tlet promise = new BX.Promise;\n\t\t\tpromise.resolve(this.controller);\n\n\t\t\treturn promise;\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n}\n\nlet Core = new CoreApplication();\nexport {Core, ApplicationLauncher as Launch};"],"names":["ApplicationLauncher","name","params","toString","substr","toUpperCase","endsWith","console","error","Promise","resolve","reject","launch","BX","Messenger","Application","ready","CoreApplication","inited","initPromise","loadParams","componentParameters","setTimeout","bind","init","then","controller","Controller","host","currentDomain","userId","USER_ID","siteDir","SITE_DIR","siteId","SITE_ID","languageId","LANGUAGE_ID","pull","instance","PullClient","client","Pull","vuexBuilder","database","databaseName","databaseType","VuexBuilder","DatabaseType","jnSharedStorage","core","promise","Core"],"mappings":"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"}