(function(e){"use strict";var t={Online:"online",Offline:"offline",Connecting:"connect"};var n={Server:"server",Client:"client",Online:"online",Status:"status",Revision:"revision"};var i={NORMAL_CLOSURE:1e3,SERVER_DIE:1001,CONFIG_REPLACED:3e3,CHANNEL_EXPIRED:3001,SERVER_RESTARTED:3002,CONFIG_EXPIRED:3003,MANUAL:3004};var o=function(){function e(){babelHelpers.classCallCheck(this,e);this._subscribers={};this._eventListener={};this.context="client"}babelHelpers.createClass(e,[{key:"subscribe",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!i){console.error(s.getDateForLog()+": Pull.subscribe: params for subscribe function is invalid. ");return function(){}}if(!s.isPlainObject(i)){return this.attachCommandHandler(i)}i.type=i.type||n.Server;var o="";var r=i.type;if(r===n.Server||r===n.Client||r===n.Online){if(r===n.Server){o=typeof env!=="undefined"?"onPullEvent-"+i.moduleId:"onPull-"+i.moduleId}else if(r===n.Client){o=typeof env!=="undefined"?"onPullClientEvent-"+i.moduleId:"onPullClient-"+i.moduleId}else if(r===n.Online){o=typeof env!=="undefined"?"onPullOnlineEvent":"onPullOnline"}if(o&&!this._eventListener[o]){this._eventListener[o]=true;if(typeof env!=="undefined"){BX.addCustomEvent(o,function(e,i,o,l){if(r===n.Online){l="online"}t.emit({type:r,moduleId:l,data:{command:e,params:s.clone(i),extra:s.clone(o)}})})}else{this.receiveComponentEvent(o,function(e){if(r===n.Online){e.module_id="online"}t.emit({type:r,moduleId:e.module_id,data:s.clone(e)})})}}}else if(r===n.Status){o="onPullStatus";if(o&&!this._eventListener[o]){this._eventListener[o]=true;if(typeof env!=="undefined"){BX.addCustomEvent(o,function(e){t.emit({type:r,data:{status:e}})})}else{this.receiveComponentEvent(o,function(e){t.emit({type:r,data:s.clone(e)})})}}}i.command=i.command||null;if(i.type===n.Server||i.type===n.Client){if(typeof this._subscribers[i.type]==="undefined"){this._subscribers[i.type]={}}if(typeof this._subscribers[i.type][i.moduleId]==="undefined"){this._subscribers[i.type][i.moduleId]={callbacks:[],commands:{}}}if(i.command){if(typeof this._subscribers[i.type][i.moduleId]["commands"][i.command]==="undefined"){this._subscribers[i.type][i.moduleId]["commands"][i.command]=[]}this._subscribers[i.type][i.moduleId]["commands"][i.command].push(i.callback);return function(){this._subscribers[i.type][i.moduleId]["commands"][i.command]=this._subscribers[i.type][i.moduleId]["commands"][i.command].filter(function(e){return e!==i.callback})}.bind(this)}else{this._subscribers[i.type][i.moduleId]["callbacks"].push(i.callback);return function(){this._subscribers[i.type][i.moduleId]["callbacks"]=this._subscribers[i.type][i.moduleId]["callbacks"].filter(function(e){return e!==i.callback})}.bind(this)}}else{if(typeof this._subscribers[i.type]==="undefined"){this._subscribers[i.type]=[]}this._subscribers[i.type].push(i.callback);return function(){this._subscribers[i.type]=this._subscribers[i.type].filter(function(e){return e!==i.callback})}.bind(this)}}},{key:"extendWatch",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.postComponentEvent("onPullExtendWatch",{id:t,force:n});return true}},{key:"clearWatch",value:function e(t){this.postComponentEvent("onPullClearWatch",{id:t});return true}},{key:"capturePullEvent",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.debug===null){console.warn("PullEvents.capturePullEvent: only commands from subscribed modules are logged.")}this.debug=!!t;console.log("PullEvents.capturePullEvent: logger turn "+(this.debug?"on":"off"))}},{key:"getDebugInfo",value:function e(){this.postComponentEvent("onPullGetDebugInfo");if(!this._eventListener["onPullGetDebugInfoResult"]){this._eventListener["onPullGetDebugInfoResult"]=true;this.receiveComponentEvent("onPullGetDebugInfoResult",function(e){if(typeof e==="string"){console.info(e)}else{console.info(e.text)}})}}},{key:"receiveComponentEvent",value:function e(t,n){if(typeof BXMobileApp!=="undefined"&&typeof BXMobileApp.addCustomEvent!=="undefined"){BXMobileApp.addCustomEvent(t,n)}else{BX.addCustomEvent(t,n)}}},{key:"postComponentEvent",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(typeof BX.postComponentEvent!=="undefined"){BX.postComponentEvent(t,[n],"communication")}else{if(typeof window.app!=="undefined"&&typeof window.app.enableInVersion!=="undefined"&&typeof BXMobileApp!=="undefined"){if(window.app.enableInVersion(25)){BXMobileApp.Events.postToComponent(t,n,"communication")}else{BXMobileApp.onCustomEvent(t,n,true)}}}}},{key:"attachCommandHandler",value:function e(t){if(typeof t.getModuleId!=="function"||typeof t.getModuleId()!=="string"){console.error(s.getDateForLog()+": Pull.attachCommandHandler: result of handler.getModuleId() is not a string.");return function(){}}var i=n.Server;if(typeof t.getSubscriptionType==="function"){i=t.getSubscriptionType()}this.subscribe({type:i,moduleId:t.getModuleId(),callback:function(e){var n=null;if(typeof t.getMap==="function"){var i=t.getMap();if(i&&babelHelpers.typeof(i)==="object"){if(typeof i[e.command]==="function"){n=i[e.command].bind(t)}else if(typeof i[e.command]==="string"&&typeof t[i[e.command]]==="function"){n=t[i[e.command]].bind(t)}}}if(!n){var o="handle"+e.command.charAt(0).toUpperCase()+e.command.slice(1);if(typeof t[o]==="function"){n=t[o].bind(t)}}if(n){if(this.debug&&this.context!=="master"){console.warn(s.getDateForLog()+": Pull.attachCommandHandler: receive command",e)}n(e.params,e.extra,e.command)}}.bind(this)})}},{key:"emit",value:function e(t){t=t||{};if(t.type===n.Server||t.type===n.Client){if(typeof this._subscribers[t.type]==="undefined"){this._subscribers[t.type]={}}if(typeof this._subscribers[t.type][t.moduleId]==="undefined"){this._subscribers[t.type][t.moduleId]={callbacks:[],commands:{}}}if(this._subscribers[t.type][t.moduleId]["callbacks"].length>0){this._subscribers[t.type][t.moduleId]["callbacks"].forEach(function(e){e(t.data,{type:t.type,moduleId:t.moduleId})})}if(this._subscribers[t.type][t.moduleId]["commands"][t.data.command]&&this._subscribers[t.type][t.moduleId]["commands"][t.data.command].length>0){this._subscribers[t.type][t.moduleId]["commands"][t.data.command].forEach(function(e){e(t.data.params,t.data.extra,t.data.command,{type:t.type,moduleId:t.moduleId})})}return true}else{if(typeof this._subscribers[t.type]==="undefined"){this._subscribers[t.type]=[]}if(this._subscribers[t.type].length<=0){return true}this._subscribers[t.type].forEach(function(e){e(t.data,{type:t.type})});return true}}}]);return e}();var s={isArray:function e(t){return t&&Object.prototype.toString.call(t)==="[object Array]"},isDomNode:function e(t){return t&&babelHelpers.typeof(t)=="object"&&"nodeType"in t},isDate:function e(t){return t&&Object.prototype.toString.call(t)==="[object Date]"},clone:function e(t,n){var i,o,s;if(n!==false)n=true;if(t===null)return null;if(this.isDomNode(t)){i=t.cloneNode(n)}else if(babelHelpers.typeof(t)=="object"){if(this.isArray(t)){i=[];for(o=0,s=t.length;o<s;o++){if(babelHelpers.typeof(t[o])=="object"&&n)i[o]=this.clone(t[o],n);else i[o]=t[o]}}else{i={};if(t.constructor){if(this.isDate(t))i=new Date(t);else i=new t.constructor}for(o in t){if(!t.hasOwnProperty(o)){continue}if(babelHelpers.typeof(t[o])=="object"&&n)i[o]=this.clone(t[o],n);else i[o]=t[o]}}}else{i=t}return i},isPlainObject:function e(t){if(!t||babelHelpers.typeof(t)!=="object"||t.nodeType){return false}var n=Object.prototype.hasOwnProperty;try{if(t.constructor&&!n.call(t,"constructor")&&!n.call(t.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}var i;for(i in t){}return typeof i==="undefined"||n.call(t,i)},lpad:function e(t,n,i){t=t.toString();i=i||" ";if(t.length>n){return t}var o="";for(var s=0;s<n-t.length;s++){o+=i}return o+t},getDateForLog:function e(){var t=new Date;return t.getFullYear()+"-"+s.lpad(t.getMonth(),2,"0")+"-"+s.lpad(t.getDate(),2,"0")+" "+s.lpad(t.getHours(),2,"0")+":"+s.lpad(t.getMinutes(),2,"0")}};var r=new o;o.PullStatus=t;o.SubscriptionType=n;o.CloseReasons=i;e.PULL=r;e.PullClient=o;e.PullEvents=o})(this.BX=this.BX||{});
//# sourceMappingURL=client.bundle.map.js