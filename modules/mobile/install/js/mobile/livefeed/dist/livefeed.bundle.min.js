this.BX=this.BX||{};(function(e,t,s,i,n){"use strict";var a=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.initialized=false;this.classes={show:"lenta-notifier-shown"};this.nodeIdList={notifier:"lenta_notifier",notifierCounter:"lenta_notifier_cnt",notifierCounterTitle:"lenta_notifier_cnt_title",refreshNeeded:"lenta_notifier_2",refreshError:"lenta_refresh_error",nextPageError:"lenta_nextpage_error"};this.init();s.EventEmitter.subscribe("onFrameDataProcessed",(function(){t.init()}))}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this.getNotifierNode();if(!t||this.initialized){return}this.initialized=true;this.initEvents()}},{key:"initEvents",value:function e(){var t=this.getNotifierNode();t.addEventListener("click",(function(){Q.refresh(true);return false}));var s=this.getRefreshNeededNode();if(s){s.addEventListener("click",(function(){app.exec("pullDownLoadingStart");Q.refresh(true);return false}))}var i=this.getRefreshErrorNode();if(i){i.addEventListener("click",(function(){Q.requestError("refresh",false)}))}var n=this.getNextPageErrorNode();if(n){n.addEventListener("click",(function(){Q.requestError("nextPage",false)}))}}},{key:"getNotifierNode",value:function e(){return document.getElementById(this.nodeIdList.notifier)}},{key:"getNotifierCounterNode",value:function e(){return document.getElementById(this.nodeIdList.notifierCounter)}},{key:"getNotifierCounterTitleNode",value:function e(){return document.getElementById(this.nodeIdList.notifierCounterTitle)}},{key:"getRefreshNeededNode",value:function e(){return document.getElementById(this.nodeIdList.refreshNeeded)}},{key:"getRefreshErrorNode",value:function e(){return document.getElementById(this.nodeIdList.refreshError)}},{key:"getNextPageErrorNode",value:function e(){return document.getElementById(this.nodeIdList.nextPageError)}},{key:"showRefreshNeededNotifier",value:function e(){var t=this.getRefreshNeededNode();if(t){t.classList.add(this.classes.show)}}},{key:"hideRefreshNeededNotifier",value:function e(){var t=this.getRefreshNeededNode();if(t){t.classList.remove(this.classes.show)}}},{key:"showNotifier",value:function e(s){var i=parseInt(s.counterValue);var n=i%100,a=i%10;var o="";if(n>=10&&n<15){o=3}else if(a==0){o=3}else if(a==1){o=1}else if(a==2||a==3||a==4){o=2}else{o=3}if(N.getRefreshNeeded()){this.getNotifierCounterNode().innerHTML=i?i+"+":"";this.hideRefreshNeededNotifier()}else{this.getNotifierCounterNode().innerHTML=i||""}this.getNotifierCounterTitleNode().innerHTML=t.Loc.getMessage("MOBILE_EXT_LIVEFEED_COUNTER_TITLE_"+o);this.getNotifierNode().classList.add(this.classes.show)}},{key:"hideNotifier",value:function e(){var t=this.getNotifierNode();if(t){t.classList.remove(this.classes.show)}}}]);return e}();var o=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.initialized=false;this.init();s.EventEmitter.subscribe("onFrameDataProcessed",(function(){t.init()}))}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this.getButtonNode();if(!t||this.initialized){return}this.initialized=true;this.initEvents()}},{key:"initEvents",value:function e(){var t=this.getButtonNode();t.addEventListener("click",(function(e){Q.refresh(true);return false}))}},{key:"getButtonNode",value:function e(){return document.getElementById("next_page_refresh_needed_button")}},{key:"startWaiter",value:function e(){var t=this.getButtonNode();if(t){t.classList.add("--loading")}}},{key:"stopWaiter",value:function e(){var t=this.getButtonNode();if(t){t.classList.remove("--loading")}}}]);return e}();var r=function(){function e(){babelHelpers.classCallCheck(this,e);this.repo=[];this.color={background:{error:"#affb0000",info:"#3a3735"},text:{error:"#ffffff",info:"#ffffff"}}}babelHelpers.createClass(e,[{key:"hideAll",value:function e(){this.repo=this.repo.filter((function(e){return e}));this.repo.forEach((function(e){e.hide()}))}},{key:"showError",value:function e(t){var s=new BXMobileApp.UI.NotificationBar({message:t.text?t.text:"",color:this.color.background.error,textColor:this.color.text.error,useLoader:t.useLoader?!!t.useLoader:false,groupId:t.groupId?t.groupId:"",align:t.textAlign?t.textAlign:"center",autoHideTimeout:t.autoHideTimeout?t.autoHideTimeout:3e4,hideOnTap:t.hideOnTap?!!t.hideOnTap:true,onTap:t.onTap?t.onTap:function(){}},t.id?t.id:parseInt(Math.random()*1e5));this.repo.push(s);s.show()}},{key:"showInfo",value:function e(t){var s=new BXMobileApp.UI.NotificationBar({message:t.text?t.text:"",color:this.color.background.info,textColor:this.color.text.info,useLoader:t.useLoader?!!t.useLoader:false,groupId:t.groupId?t.groupId:"",maxLines:t.maxLines?t.maxLines:false,align:t.textAlign?t.textAlign:"center",isGlobal:t.isGlobal?!!t.isGlobal:true,useCloseButton:t.useCloseButton?!!t.useCloseButton:true,autoHideTimeout:t.autoHideTimeout?t.autoHideTimeout:1e3,hideOnTap:t.hideOnTap?!!t.hideOnTap:true},t.id?t.id:parseInt(Math.random()*1e5));this.repo.push(s);s.show()}}]);return e}();var l=function(){function e(s){babelHelpers.classCallCheck(this,e);this.tableName=null;this.keyName=null;this.setTableName(t.Type.isPlainObject(s)&&t.Type.isStringFilled(s.tableName)?s.tableName:"livefeed");this.setKeyName(t.Type.isPlainObject(s)&&t.Type.isStringFilled(s.keyName)?s.keyName:"postUnsent");this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){BXMobileApp.addCustomEvent("Livefeed.Database::clear",this.onClear.bind(this))}},{key:"setTableName",value:function e(t){this.tableName=t}},{key:"getTableName",value:function e(){return this.tableName}},{key:"setKeyName",value:function e(t){this.keyName=t}},{key:"getKeyName",value:function e(){return this.keyName}},{key:"onClear",value:function e(t){this["delete"](t.groupId)}},{key:"delete",value:function e(t){if(parseInt(t)<=0){t=false}app.exec("setStorageValue",{storageId:this.getTableName(),key:this.getKeyName()+(t?"_"+t:""),value:{},callback:function e(t){}})}},{key:"save",value:function e(t,s){if(parseInt(s)<=0){s=false}for(var i in t){if(!t.hasOwnProperty(i)){continue}if(i==="sessid"){delete t[i];break}}app.exec("setStorageValue",{storageId:this.getTableName(),key:this.getKeyName()+(s?"_"+s:""),value:t,callback:function e(t){}})}},{key:"load",value:function e(s,i){if(parseInt(i)<=0){i=false}app.exec("getStorageValue",{storageId:this.getTableName(),key:this.getKeyName()+(i?"_"+i:""),callback:function e(i){i=t.Type.isPlainObject(i)?i:t.Type.isStringFilled(i)?JSON.parse(i):{};if(t.Type.isPlainObject(i)&&Object.keys(i).length>0){s.onLoad(i)}else{s.onEmpty()}}})}}]);return e}();var c;var d=function(e){babelHelpers.inherits(s,e);function s(){var e;babelHelpers.classCallCheck(this,s);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this));e.repo={};e.nodeId={container:"post-balloon-container"};e["class"]={balloonHidden:"post-balloon-hidden",balloonFixed:"post-balloon-box-fixed",balloonPublished:"post-balloon-done",balloonShow:"post-balloon-show",balloonHide:"post-balloon-hide"};e.timeout={show:750};e.init();return e}babelHelpers.createClass(s,[{key:"init",value:function e(){BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterSetItem",this.afterSetItem.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAdd",this.afterPostAdd.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAddError",this.afterPostAddError.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdate",this.afterPostUpdate.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdateError",this.afterPostUpdateError.bind(this));this.setEventNamespace("BX.Mobile.Livefeed");this.subscribe("onFeedReady",this.onFeedLoaded.bind(this));this.subscribe("onPostInserted",this.onPostInserted.bind(this));t.Event.bind(document,"scroll",this.onScroll.bind(this))}},{key:"onScroll",value:function e(){var s=document.getElementById(this.nodeId.container);if(!t.Type.isDomNode(s)){return}if(window.pageYOffset>0){s.classList.add(this["class"].balloonFixed)}else{s.classList.remove(this["class"].balloonFixed)}}},{key:"onFeedLoaded",value:function e(){var s=this;app.exec("getStorageValue",{storageId:"livefeed",key:"publicationQueue",callback:function e(i){i=t.Type.isPlainObject(i)?i:t.Type.isStringFilled(i)?JSON.parse(i):{};if(!t.Type.isPlainObject(i)){return}for(var n in i){if(!i.hasOwnProperty(n)){continue}s.addToTray(n,{})}s.drawList()}})}},{key:"onPostInserted",value:function e(t){this.removeFromTray(t.data.key)}},{key:"addToTray",value:function e(t,s){this.repo[t]=s;this.repo[t].node=this.drawItem();this.repo[t].node.classList.add(this["class"].balloonShow)}},{key:"removeFromTray",value:function e(t,s){var i=this;this.hideItem(t);setTimeout((function(){if(i.repo[t]){delete i.repo[t]}}),3e3)}},{key:"addSuccess",value:function e(s,i){var n=this;if(this.repo[s]&&this.repo[s].node){this.repo[s].node.classList.remove(this["class"].balloonHidden);this.repo[s].node.classList.remove(this["class"].balloonShow);this.repo[s].node.classList.add(this["class"].balloonPublished);this.repo[s].node.lastElementChild.innerHTML=t.Type.isStringFilled(i)?i:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_PUBLICATION_QUEUE_SUCCESS_TITLE")}setTimeout((function(){n.removeFromTray(s)}),5e3)}},{key:"drawItem",value:function e(){var s=t.Loc.getMessage("MOBILE_EXT_LIVEFEED_PUBLICATION_QUEUE_ITEM_TITLE");return t.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="post-balloon-hidden post-balloon post-balloon-active"><span class="post-balloon-icon"></span><span class="post-balloon-text">',"</span></div>\n\t\t\t"])),s)}},{key:"hideItem",value:function e(t,s){if(this.repo[t]){this.repo[t].node.classList.add(this["class"].balloonHide)}}},{key:"drawList",value:function e(){var s=document.getElementById(this.nodeId.container);if(!t.Type.isDomNode(s)){return}t.Dom.clean(s);for(var i in this.repo){if(!this.repo.hasOwnProperty(i)||!t.Type.isDomNode(this.repo[i].node)){continue}t.Dom.append(this.repo[i].node,s)}}},{key:"afterSetItem",value:function e(s){var i=this;var n=s.key?s.key:"",a=s.pageId?s.pageId:"",o=s.contentType?s.contentType:"";if(a!=N.getPageId()||!n||!t.Type.isStringFilled(o)){return}if(o=="post"){this.addToTray(n,{key:n});setTimeout((function(){i.drawList()}),this.timeout.show)}}},{key:"afterPostAdd",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}this.addSuccess(s.key?s.key:"",s.warningText);this.drawList()}},{key:"afterPostUpdate",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}this.addSuccess(s.key?s.key:"");this.drawList()}},{key:"afterPostAddError",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}var i=s.key?s.key:"";this.removeFromTray(i,{key:i});this.drawList()}},{key:"afterPostUpdateError",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}var i=s.key?s.key:"";this.removeFromTray(i,{key:i});this.drawList()}}]);return s}(s.EventEmitter);var u=function(){babelHelpers.createClass(e,null,[{key:"moveBottom",value:function e(){window.scrollTo(0,document.body.scrollHeight)}},{key:"moveTop",value:function e(){window.scrollTo(0,0)}}]);function e(t){babelHelpers.classCallCheck(this,e);this.logId=0;this.entryType="";this.useFollow=false;this.useTasks=false;this.perm="";this.destinations={};this.postId=0;this.url="";this.entityXmlId="";this.readOnly=false;this.contentTypeId="";this.contentId=0;this.showFull=false;this.taskId=0;this.taskData=null;this.calendarEventId=0;this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(s){var i=s.logId,n=s.entryType,a=s.useFollow,o=s.useTasks,r=s.perm,l=s.destinations,c=s.postId,d=s.url,u=s.entityXmlId,p=s.readOnly,f=s.contentTypeId,m=s.contentId,h=s.showFull,g=s.taskId,E=s.taskData,v=s.calendarEventId;i=parseInt(i);if(i<=0){return}this.logId=i;this.postId=parseInt(c);this.contentId=parseInt(m);this.taskId=parseInt(g);this.calendarEventId=parseInt(v);this.useFollow=!!a;this.useTasks=!!o;this.readOnly=!!p;this.showFull=!!h;if(t.Type.isStringFilled(n)){this.entryType=n}if(t.Type.isStringFilled(r)){this.perm=r}if(t.Type.isStringFilled(d)){this.url=d}if(t.Type.isStringFilled(u)){this.entityXmlId=u}if(t.Type.isStringFilled(f)){this.contentTypeId=f}if(t.Type.isStringFilled(E)){try{this.taskData=JSON.parse(E)}catch(e){this.taskData=null}}if(t.Type.isPlainObject(l)){this.destinations=l}}},{key:"setFavorites",value:function e(s){var i=this;if(this.logId<=0){return}var a=s.node,o=s.event;if(!t.Type.isDomNode(a)){a=document.getElementById("log_entry_favorites_"+this.logId)}if(t.Type.isDomNode(a)){var r=a.getAttribute("data-favorites")==="Y"?"Y":"N";var l=r==="Y"?"N":"Y";if(a.classList.contains("lenta-item-fav")){if(r==="Y"){a.classList.remove("lenta-item-fav-active")}else{a.classList.add("lenta-item-fav-active")}}a.setAttribute("data-favorites",l);n.Ajax.runAction("socialnetwork.api.livefeed.changeFavorites",{data:{logId:this.logId,value:l},analyticsLabel:{b24statAction:l==="Y"?"addFavorites":"removeFavorites",b24statContext:"mobile"}}).then((function(e){if(e.data.success){if(l==="Y"){z.setFollow({logId:i.logId,bOnlyOn:true,bRunEvent:true,bAjax:false})}BXMobileApp.onCustomEvent("onLogEntryFavorites",{log_id:i.logId,page_id:t.Loc.getMessage("MSLPageId")},true)}else{a.setAttribute("data-favorites",r)}}),(function(){a.setAttribute("data-favorites",r)}))}if(o instanceof Event){o.preventDefault();o.stopPropagation()}}},{key:"setPinned",value:function e(s){var i=this;if(this.logId<=0){return}var a=s.menuNode,o=s.context;if(t.Type.isDomNode(a)){var r=a.getAttribute("data-pinned")==="Y"?"Y":"N";var l=r==="Y"?"N":"Y";a.setAttribute("data-pinned",l);BXMobileApp.onCustomEvent("Livefeed::showLoader",{},true,true);var c=l==="Y"?"socialnetwork.api.livefeed.logentry.pin":"socialnetwork.api.livefeed.logentry.unpin";n.Ajax.runAction(c,{data:{params:{logId:this.logId}},analyticsLabel:{b24statAction:l==="Y"?"pinLivefeedEntry":"unpinLivefeedEntry",b24statContext:"mobile"}}).then((function(e){BXMobileApp.onCustomEvent("Livefeed::hideLoader",{},true,true);if(e.data.success){BXMobileApp.onCustomEvent("Livefeed.PinnedPanel::change",{logId:i.logId,value:l,postNode:a.closest(".lenta-item"),pinActionContext:o},true,true);BXMobileApp.onCustomEvent("Livefeed.PostDetail::pinChanged",{logId:i.logId,value:l},true,true)}else{a.setAttribute("data-pinned",r)}}),(function(){BXMobileApp.onCustomEvent("Livefeed::hideLoader",{},true,true);a.setAttribute("data-pinned",r)}))}}},{key:"openDetail",value:function e(s){var i=s.pathToEmptyPage,n=s.pathToCalendarEvent,a=s.pathToTasksRouter,o=s.event,r=s.focusComments,l=s.showFull;if(!t.Type.isStringFilled(i)){return}if(this.taskId>0&&BXMobileAppContext.getApiVersion()>=31&&this.taskData){BXMobileApp.Events.postToComponent("taskbackground::task::open",[{id:this.taskId,taskId:this.taskId,title:"TASK",taskInfo:{title:this.taskData.title,creatorIcon:this.taskData.creatorIcon,responsibleIcon:this.taskData.responsibleIcon}},{taskId:this.taskId,getTaskInfo:true}])}else{var c=i;if(this.calendarEventId>0&&!r&&n.length>0){c=n.replace("#EVENT_ID#",this.calendarEventId)}else if(this.taskId>0&&this.taskData&&a.length>0){c=a.replace("__ROUTE_PAGE__","view").replace("#USER_ID#",t.Loc.getMessage("MOBILE_EXT_LIVEFEED_CURRENT_USER_ID"))+"&TASK_ID="+this.taskId}__MSLOpenLogEntryNew({path:c,log_id:this.logId,entry_type:this.entryType,use_follow:this.useFollow?"Y":"N",use_tasks:this.useTasks?"Y":"N",post_perm:this.perm,destinations:this.destinations,post_id:this.postId,post_url:this.url,entity_xml_id:this.entityXmlId,focus_comments:r,focus_form:false,show_full:this.showFull||l,read_only:this.readOnly?"Y":"N",post_content_type_id:this.contentTypeId,post_content_id:this.contentId},o)}}},{key:"initDetailPin",value:function e(){var t=document.getElementById("log-entry-menu-"+this.logId);if(!t){return}var s=t.closest(".post-wrap");if(!s){return}var i=t.getAttribute("data-pinned");if(i==="Y"){s.classList.add("lenta-item-pin-active")}else{s.classList.remove("lenta-item-pin-active")}}},{key:"expandText",value:function e(){oMSL.expandText(this.logId)}}]);return e}();var p=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"delete",value:function e(s){var i=t.Type.isStringFilled(s.context)?s.context:"list";var a=!t.Type.isUndefined(s.postId)?parseInt(s.postId):0;if(a<=0){return false}app.confirm({title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_TITLE"),text:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_DESCRIPTION"),buttons:[t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_BUTTON_OK"),t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_BUTTON_CANCEL")],callback:function e(s){if(parseInt(s)!==1){return false}app.showPopupLoader({text:""});var o=t.Uri.addParam("".concat(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/ajax.php"),{b24statAction:"deleteBlogPost",b24statContext:"mobile"});n.Ajax.wrap({type:"json",method:"POST",url:o,data:{action:"delete_post",mobile_action:"delete_post",sessid:t.Loc.getMessage("bitrix_sessid"),site:t.Loc.getMessage("SITE_ID"),lang:t.Loc.getMessage("LANGUAGE_ID"),post_id:a},processData:true,callback:function e(s){app.hidePopupLoader();if(!t.Type.isStringFilled(s.SUCCESS)||s.SUCCESS!=="Y"){return}BXMobileApp.onCustomEvent("onBlogPostDelete",{},true,true);if(i==="detail"){app.closeController({drop:true})}},callback_failure:function e(){app.hidePopupLoader()}});return false}})}},{key:"edit",value:function e(s){var i=!t.Type.isUndefined(s.postId)?parseInt(s.postId):0;if(i<=0){return}var n=!t.Type.isUndefined(s.pinnedContext)?!!s.pinnedContext:false;if(Application.getApiVersion()>=N.getApiVersion("layoutPostForm")){H.show({pageId:N.getPageId(),postId:i})}else{this.getData({postId:i,callback:function e(s){V.formParams={};if(!t.Type.isUndefined(s.PostPerm)&&s.PostPerm>="W"){var a={a_users:[],b_groups:[]};V.setExtraDataArray({postId:i,postAuthorId:s.post_user_id,logId:s.log_id,pinnedContext:n});if(!t.Type.isUndefined(s.PostDetailText)){V.setParams({messageText:s.PostDetailText})}if(t.Type.isPlainObject(s.PostDestination)){for(var o=0,r=Object.entries(s.PostDestination);o<r.length;o++){var l=babelHelpers.slicedToArray(r[o],2),c=l[0],d=l[1];if(t.Type.isStringFilled(s.PostDestination[c].STYLE)&&s.PostDestination[c].STYLE==="all-users"){V.addDestination(a,{type:"UA"})}else if(t.Type.isStringFilled(s.PostDestination[c].TYPE)&&["U","SG"].includes(s.PostDestination[c].TYPE)){V.addDestination(a,{type:s.PostDestination[c].TYPE,id:s.PostDestination[c].ID,name:t.Text.decode(s.PostDestination[c].TITLE)})}}}if(!t.Type.isUndefined(s.PostDestinationHidden)){V.setExtraData({hiddenRecipients:s.PostDestinationHidden})}V.setParams({selectedRecipients:a});if(!t.Type.isUndefined(s.PostFiles)){V.setParams({messageFiles:s.PostFiles})}if(!t.Type.isUndefined(s.PostUFCode)){V.setExtraData({messageUFCode:s.PostUFCode})}app.exec("showPostForm",V.show())}}})}}},{key:"getData",value:function e(s){var i=!t.Type.isUndefined(s.postId)?parseInt(s.postId):0;if(i<=0){return}var a=t.Type.isFunction(s.callback)?s.callback:null;if(t.Type.isNull(a)){return}var o={};if(i>0){app.showPopupLoader();n.Ajax.wrap({type:"json",method:"POST",url:"".concat(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/ajax.php"),processData:true,data:{action:"get_blog_post_data",mobile_action:"get_blog_post_data",sessid:t.Loc.getMessage("bitrix_sessid"),site:t.Loc.getMessage("SITE_ID"),lang:t.Loc.getMessage("LANGUAGE_ID"),post_id:i,nt:t.Loc.getMessage("MSLNameTemplate"),sl:t.Loc.getMessage("MSLShowLogin")},callback:function e(s){app.hidePopupLoader();o.id=i;if(!t.Type.isUndefined(s.log_id)&&parseInt(s.log_id)>0){o.log_id=s.log_id}if(!t.Type.isUndefined(s.post_user_id)&&parseInt(s.post_user_id)>0){o.post_user_id=s.post_user_id}if(!t.Type.isUndefined(s.PostPerm)){o.PostPerm=s.PostPerm}if(!t.Type.isUndefined(s.PostDestination)){o.PostDestination=s.PostDestination}if(!t.Type.isUndefined(s.PostDestinationHidden)){o.PostDestinationHidden=s.PostDestinationHidden}if(!t.Type.isUndefined(s.PostDetailText)){o.PostDetailText=s.PostDetailText}if(t.Type.isUndefined(s.PostFiles)){o.PostFiles=s.PostFiles}if(!t.Type.isUndefined(s.PostBackgroundCode)){o.PostBackgroundCode=s.PostBackgroundCode}if(!t.Type.isUndefined(s.PostUFCode)){o.PostUFCode=s.PostUFCode}a(o)},callback_failure:function e(){app.hidePopupLoader()}})}}}]);return e}();var f=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"init",value:function e(s){this.iconUrlFolderPath="/bitrix/templates/mobile_app/images/lenta/menu/";this.sectionCode="defaultSection";this.logId=parseInt(s.logId);this.postId=parseInt(s.postId);this.postPerms=t.Type.isStringFilled(s.postPerms)?s.postPerms:"R";this.pageId=s.pageId;this.contentTypeId=t.Type.isStringFilled(s.contentTypeId)?s.contentTypeId:null;this.contentId=t.Type.isInteger(s.contentId)?s.contentId:0;this.useShare=!!s.useShare&&this.postId>0;this.useFavorites=!!s.useFavorites&&this.logId>0;this.useFollow=!!s.useFollow&&this.logId>0;this.usePinned=!!s.usePinned&&this.logId>0;this.useTasks=t.Loc.getMessage("MOBILE_EXT_LIVEFEED_USE_TASKS")==="Y";this.useRefreshComments=!!s.useRefreshComments;this.favoritesValue=!!s.favoritesValue;this.followValue=!!s.followValue;this.pinnedValue=!!s.pinnedValue;this.target=t.Type.isDomNode(s.target)?s.target:null;this.context=t.Type.isStringFilled(s.context)?s.context:"list"}},{key:"getMenuItems",value:function e(){var s=this;var i=[];if(this.usePinned){i.push({id:"pinned",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_PINNED_"+(!!this.pinnedValue?"Y":"N")),iconUrl:this.iconUrlFolderPath+(!!this.pinnedValue?"unpin.png":"pin.png"),sectionCode:this.sectionCode,action:function e(){var t=new u({logId:s.logId});return t.setPinned({menuNode:s.target,context:s.context})}})}if(this.useShare){var n={a_users:[],b_groups:[]};if(n.a_users.length>0||n.b_groups.length>0){i.push({id:"sharePost",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_SHARE"),iconName:"add",iconUrl:this.iconUrlFolderPath+"n_plus.png",sectionCode:this.sectionCode,action:function e(){app.openTable({callback:function e(){oMSL.shareBlogPost()},url:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR")+"mobile/index.php?mobile_action="+(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_CURRENT_EXTRANET_SITE")==="Y"?"get_group_list":"get_usergroup_list")+"&feature=blog",markmode:true,multiple:true,return_full_mode:true,user_all:true,showtitle:true,modal:true,selected:n,alphabet_index:true,okname:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SHARE_TABLE_BUTTON_OK"),cancelname:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SHARE_TABLE_BUTTON_CANCEL"),outsection:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DENIED")!=="Y"})},arrowFlag:false})}}if(this.postId>0&&this.postPerms==="W"){i.push({id:"edit",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_EDIT"),iconUrl:this.iconUrlFolderPath+"pencil.png",sectionCode:this.sectionCode,action:function e(){p.edit({feedId:window.LiveFeedID,postId:s.postId,pinnedContext:!!s.pinnedValue})},arrowFlag:false,feature:"edit"});i.push({id:"delete",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_DELETE"),iconName:"delete",sectionCode:this.sectionCode,action:function e(){p["delete"]({postId:s.postId,context:s.context})},arrowFlag:false})}if(this.useFavorites){i.push({id:"favorites",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_FAVORITES_"+(!!this.favoritesValue?"Y":"N")),iconUrl:this.iconUrlFolderPath+"favorite.png",sectionCode:this.sectionCode,action:function e(){var t=new u({logId:s.logId});return t.setFavorites({node:s.target})},arrowFlag:false,feature:"favorites"})}if(this.useFollow){i.push({id:"follow",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_"+(!!this.followValue?"Y":"N")),iconUrl:this.iconUrlFolderPath+"eye.png",sectionCode:this.sectionCode,action:function e(){z.setFollow({logId:s.logId,menuNode:s.target,pageId:s.pageId,bOnlyOn:false,bAjax:true,bRunEvent:true})},arrowFlag:false})}if(this.useRefreshComments){i.push({id:"refreshPostComments",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_REFRESH_COMMENTS"),iconUrl:this.iconUrlFolderPath+"n_refresh.png",action:function e(){if(oMSL.bDetailEmptyPage){K.getComments({ts:oMSL.iDetailTs,bPullDown:true,obFocus:{form:false}})}else{document.location.reload(true)}},arrowFlag:false})}if(t.Type.isStringFilled(this.contentTypeId)&&this.contentId>0){i.push({id:"getPostLink",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_GET_LINK"),iconUrl:this.iconUrlFolderPath+"link.png",sectionCode:this.sectionCode,action:function e(){oMSL.copyPostLink({contentTypeId:s.contentTypeId,contentId:s.contentId})},arrowFlag:false});if(this.useTasks&&this.logId>0){i.push({id:"createTask",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_CREATE_TASK"),iconUrl:this.iconUrlFolderPath+"n_check.png",sectionCode:this.sectionCode,action:function e(){oMSL.createTask({entityType:s.contentTypeId,entityId:s.contentId,logId:s.logId});return false},arrowFlag:false})}}return i}}]);return e}();var m=function(){function e(){babelHelpers.classCallCheck(this,e);this.type="list";this.listPageMenuItems=[];this.detailPageMenuItems=[]}babelHelpers.createClass(e,[{key:"init",value:function e(s){this.type=s.type==="detail"?"detail":"list";var i=this.getPageMenuItems();var n=this.type==="detail"?t.Type.isStringFilled(t.Loc.getMessage("MSLLogEntryTitle"))?t.Loc.getMessage("MSLLogEntryTitle"):"":t.Type.isStringFilled(t.Loc.getMessage("MSLLogTitle"))?t.Loc.getMessage("MSLLogTitle"):"";if(i.length>0){if(BXMobileAppContext.getApiVersion()>=N.getApiVersion("pageMenu")){this.initPagePopupMenu()}else{app.menuCreate({items:i});BXMobileApp.UI.Page.TopBar.title.setCallback((function(){app.menuShow()}))}}else if(BXMobileAppContext.getApiVersion()<N.getApiVersion("pageMenu")){BXMobileApp.UI.Page.TopBar.title.setCallback("")}BXMobileApp.UI.Page.TopBar.title.setText(n);BXMobileApp.UI.Page.TopBar.title.show()}},{key:"initPagePopupMenu",value:function e(){var t=this;if(BXMobileAppContext.getApiVersion()<N.getApiVersion("pageMenu")){return}var s=[];if(!oMSL.logId){s.push({type:"search",callback:function e(){app.exec("showSearchBar")}})}var i=this.getPageMenuItems(this.type);if(BX.type.isArray(i)&&i.length>0){s.push({type:"more",callback:function e(){t.showPageMenu(t.type)}})}app.exec("setRightButtons",{items:s})}},{key:"showPageMenu",value:function e(){if(this.type==="detail"){this.detailPageMenuItems=this.buildDetailPageMenu(oMSL.menuData)}var s=this.getPageMenuItems();if(s.length<=0){return}var i=[];var n={};s.forEach((function(e){i.push({id:e.id,title:e.name,iconUrl:t.Type.isStringFilled(e.image)?e.image:"",iconName:t.Type.isStringFilled(e.iconName)?e.iconName:"",sectionCode:"defaultSection"});n[e.id]=e.action}));app.exec("setPopupMenuData",{items:i,sections:[{id:"defaultSection"}],callback:function e(s){if(s.eventName==="onDataSet"){app.exec("showPopupMenu")}else if(s.eventName==="onItemSelected"&&t.Type.isPlainObject(s.item)&&t.Type.isStringFilled(s.item.id)&&t.Type.isFunction(n[s.item.id])){n[s.item.id]()}}})}},{key:"getPageMenuItems",value:function e(){return this.type==="detail"?this.detailPageMenuItems:this.listPageMenuItems}},{key:"buildDetailPageMenu",value:function e(t){var s=null;if(BXMobileAppContext.getApiVersion()>=N.getApiVersion("pageMenu")){s=document.getElementById("log-entry-menu-".concat(N.getLogId()))}U.init({logId:N.getLogId(),postId:parseInt(t.post_id),postPerms:t.post_perm,useShare:t.entry_type==="blog",useFavorites:s&&s.getAttribute("data-use-favorites")==="Y",useFollow:t.read_only!=="Y",usePinned:N.getLogId()>0,useRefreshComments:true,favoritesValue:s&&s.getAttribute("data-favorites")==="Y",followValue:z.getFollowValue(),pinnedValue:s&&s.getAttribute("data-pinned")==="Y",contentTypeId:t.post_content_type_id,contentId:parseInt(t.post_content_id),target:s,context:"detail"});return U.getMenuItems().map((function(e){e.name=e.title;e.image=e.iconUrl;delete e.title;delete e.iconUrl;return e}))}}]);return e}();var h=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"show",value:function e(s){var i=this;var n={type:s.type?s.type:"post",groupId:s.groupId?parseInt(s.groupId):0,postId:s.postId?parseInt(s.postId):0,pageId:t.Type.isStringFilled(s.pageId)?s.pageId:""};this.getDatabaseData(n).then((function(e){return i.getWorkgroupData(e)})).then((function(e){return i.getPostData(e)})).then((function(e){return i.processPostData(e)})).then((function(e){app.exec("openComponent",{name:"JSStackComponent",componentCode:"livefeed.postform",scriptPath:BX.message("MOBILE_EXT_LIVEFEED_COMPONENT_URL"),params:{SERVER_NAME:BX.message("MOBILE_EXT_LIVEFEED_SERVER_NAME"),DESTINATION_LIST:N.getOption("destinationList",{}),DESTINATION_TO_ALL_DENY:N.getOption("destinationToAllDeny",false),DESTINATION_TO_ALL_DEFAULT:N.getOption("destinationToAllDefault",true),MODULE_DISK_INSTALLED:BX.message("MOBILE_EXT_LIVEFEED_DISK_INSTALLED")=="Y"?"Y":"N",MODULE_WEBDAV_INSTALLED:BX.message("MOBILE_EXT_LIVEFEED_WEBDAV_INSTALLED")=="Y"?"Y":"N",MODULE_VOTE_INSTALLED:BX.message("MOBILE_EXT_LIVEFEED_VOTE_INSTALLED")=="Y"?"Y":"N",USE_IMPORTANT:BX.message("MOBILE_EXT_LIVEFEED_USE_IMPORTANT")==="N"?"N":"Y",FILE_ATTACH_PATH:BX.message("MOBILE_EXT_LIVEFEED_FILE_ATTACH_PATH"),BACKGROUND_IMAGES_DATA:N.getOption("backgroundImagesData",{}),BACKGROUND_COMMON:N.getOption("backgroundCommon",{}),MEDALS_LIST:N.getOption("medalsList",{}),IMPORTANT_DATA:N.getOption("importantData",{}),USER_FOLDER_FOR_SAVED_FILES:BX.message("MOBILE_EXT_UTILS_USER_FOLDER_FOR_SAVED_FILES"),MAX_UPLOAD_CHUNK_SIZE:BX.message("MOBILE_EXT_UTILS_MAX_UPLOAD_CHUNK_SIZE"),POST_FILE_UF_CODE:BX.message("MOBILE_EXT_LIVEFEED_POST_FILE_UF_CODE"),POST_FORM_DATA:N.getOption("postFormData",{}),POST_DATA:e,DEVICE_WIDTH:BX.message("MOBILE_EXT_LIVEFEED_DEVICE_WIDTH"),DEVICE_HEIGHT:BX.message("MOBILE_EXT_LIVEFEED_DEVICE_HEIGHT"),DEVICE_RATIO:BX.message("MOBILE_EXT_LIVEFEED_DEVICE_RATIO")},rootWidget:{name:"layout",settings:{objectName:"postFormLayoutWidget",modal:true}}},false)}))}},{key:"getDatabaseData",value:function e(s){var i=new Promise((function(e,i){var n=parseInt(s.postId);if(n>0){e(s);return}x.load({onLoad:function i(n){if(n.contentType!==s.type){e(s);return}s.groupId=0;if(!t.Type.isPlainObject(s.post)){s.post={}}if(t.Type.isStringFilled(n.POST_TITLE)){s.post.PostTitle=n.POST_TITLE}if(t.Type.isStringFilled(n.POST_MESSAGE)){s.post.PostDetailText=n.POST_MESSAGE}if(t.Type.isArrayFilled(n.DEST)&&t.Type.isPlainObject(n.DEST_DATA)){s.post.PostDestination=[];var a=[{pattern:/^SG(\d+)$/i,style:"sonetgroups"},{pattern:/^U(\d+|A)$/i,style:"users"},{pattern:/^DR(\d+)$/i,style:"department"}];n.DEST.forEach((function(e){var i=null;var o=null;for(var r=0;r<a.length;r++){var l=e.match(a[r].pattern);if(l){i=l[1];o=e==="UA"?"all-users":a[r].style;break}}if(!t.Type.isNull(i)){s.post.PostDestination.push({STYLE:o,ID:i,TITLE:t.Type.isPlainObject(n.DEST_DATA[e])&&t.Type.isStringFilled(n.DEST_DATA[e].title)?n.DEST_DATA[e].title:""})}}))}if(t.Type.isStringFilled(n.BACKGROUND_CODE)){s.post.PostBackgroundCode=n.BACKGROUND_CODE}if(n.IMPORTANT==="Y"){s.post.PostImportantData={value:"Y"};if(t.Type.isStringFilled(n.IMPORTANT_DATE_END)){s.post.PostImportantData.endDate=Date.parse(n.IMPORTANT_DATE_END)/1e3}}if(t.Type.isStringFilled(n.GRATITUDE_MEDAL)){s.post.PostGratitudeData={gratitude:n.GRATITUDE_MEDAL,employees:[]};if(Array.isArray(n.GRATITUDE_EMPLOYEES)&&t.Type.isPlainObject(n.GRATITUDE_EMPLOYEES_DATA)){n.GRATITUDE_EMPLOYEES.forEach((function(e){var i=n.GRATITUDE_EMPLOYEES_DATA[e];if(!t.Type.isPlainObject(i)){return}s.post.PostGratitudeData.employees.push({id:i.id,imageUrl:t.Type.isStringFilled(i.imageUrl)?i.imageUrl:"",title:t.Type.isStringFilled(i.title)?i.title:"",subtitle:t.Type.isStringFilled(i.subtitle)?i.subtitle:""})}))}}var o="n0";var r="UF_BLOG_POST_VOTE_"+o+"_DATA";if(n.UF_BLOG_POST_VOTE===o&&t.Type.isPlainObject(n[r])&&Array.isArray(n[r].QUESTIONS)){s.post.PostVoteData={questions:n[r].QUESTIONS.map((function(e){var t={value:e.QUESTION,allowMultiSelect:e.FIELD_TYPE==1?"Y":"N",answers:[]};if(Array.isArray(e.ANSWERS)){t.answers=e.ANSWERS.map((function(e){return{value:e.MESSAGE}}))}return t}))}}e(s)},onEmpty:function t(){e(s)}},s.groupId)}));i["catch"]((function(e){console.error(e)}));return i}},{key:"getWorkgroupData",value:function e(t){var s=parseInt(t.groupId);var i=new Promise((function(e,i){if(s<=0){e(t);return}var n={resolve:e,reject:i};var a=new Date;var o="Livefeed::returnWorkgroupData_"+a.getTime();BXMobileApp.addCustomEvent(o,function(e){if(e.success){this.resolve(Object.assign(t,{group:{ID:parseInt(e.groupData.ID),NAME:e.groupData.NAME}}))}else{this.reject()}}.bind(n));BXMobileApp.onCustomEvent("Livefeed::getWorkgroupData",{groupId:s,returnEventName:o},true)}));i["catch"]((function(e){console.error(e)}));return i}},{key:"getPostData",value:function e(t){var s=parseInt(t.postId);var i=new Promise((function(e,i){if(s<=0){e(t);return}var n={resolve:e,reject:i};var a=new Date;var o="Livefeed::returnPostFullData_"+a.getTime();BXMobileApp.addCustomEvent(o,function(e){if(e.success){this.resolve(Object.assign(t,{post:e.postData}))}else{this.reject()}}.bind(n));BXMobileApp.onCustomEvent("Livefeed::getPostFullData",{postId:s,returnEventName:o},true)}));i["catch"]((function(e){console.error(e)}));return i}},{key:"processPostData",value:function e(s){var i=parseInt(s.postId);var n=new Promise((function(e,i){if(t.Type.isPlainObject(s.post)){if(t.Type.isArray(s.post.PostDestination)){s.recipients={};s.post.PostDestination.forEach((function(e){var i=null;var n=null;switch(e.STYLE){case"users":i="users";n=e.ID;break;case"all-users":i="users";n="A";break;case"sonetgroups":i="groups";n=e.ID;break;case"department":i="departments";n=e.ID;break;default:}if(i){if(!t.Type.isArray(s.recipients[i])){s.recipients[i]=[]}s.recipients[i].push({id:n,title:e.TITLE,shortTitle:t.Type.isStringFilled(e.SHORT_TITLE)?e.SHORT_TITLE:e.TITLE,avatar:t.Type.isStringFilled(e.AVATAR)?e.AVATAR:""})}}))}if(t.Type.isArray(s.post.PostDestinationHidden)){s.hiddenRecipients=[];s.post.PostDestinationHidden.forEach((function(e){s.hiddenRecipients.push(e.TYPE+e.ID)}))}}else if(t.Type.isPlainObject(s.group)){s.recipients={groups:[{id:s.group.ID,title:s.group.NAME}]}}e(s)}));n["catch"]((function(e){console.error(e)}));return n}}]);return e}();var g=function(){function e(){babelHelpers.classCallCheck(this,e);this.postFormParams={};this.postFormExtraData={}}babelHelpers.createClass(e,[{key:"setExtraDataArray",value:function e(t){var s=null;for(var i=0,n=Object.entries(t);i<n.length;i++){var a=babelHelpers.slicedToArray(n[i],2),o=a[0],r=a[1];if(t.hasOwnProperty(o)){s={};s[o]=r;this.setExtraData(s)}}}},{key:"setExtraData",value:function e(s){if(!t.Type.isPlainObject(s)){return}for(var i=0,n=Object.entries(s);i<n.length;i++){var a=babelHelpers.slicedToArray(n[i],2),o=a[0],r=a[1];if(o=="hiddenRecipients"||o=="logId"||o=="postId"||o=="postAuthorId"||o=="messageUFCode"||o=="commentId"||o=="commentType"||o=="nodeId"||o=="pinnedContext"){this.postFormExtraData[o]=r}}}},{key:"getExtraData",value:function e(){return this.postFormExtraData}},{key:"setParams",value:function e(s){if(!t.Type.isPlainObject(s)){return}for(var i=0,n=Object.entries(s);i<n.length;i++){var a=babelHelpers.slicedToArray(n[i],2),o=a[0],r=a[1];if(["selectedRecipients","messageText","messageFiles"].indexOf(o)!==-1){this.postFormParams[o]=r}}}},{key:"addDestination",value:function e(s,i){if(!t.Type.isPlainObject(i)||!t.Type.isStringFilled(i.type)){return}var n=null;if(i.type==="UA"){n=s.a_users.some(this.findDestinationCallBack,{value:0});if(!n){s.a_users.push({id:0,name:t.Loc.getMessage("MSLPostDestUA"),bubble_background_color:"#A7F264",bubble_text_color:"#54901E"})}}else if(i.type==="U"){n=s.a_users.some(this.findDestinationCallBack,{value:i.id});if(!n){s.a_users.push({id:i.id,name:i.name,bubble_background_color:"#BCEDFC",bubble_text_color:"#1F6AB5"})}}else if(i.type==="SG"){n=s.b_groups.some(this.findDestinationCallBack,{value:i.id});if(!n){s.b_groups.push({id:i.id,name:i.name,bubble_background_color:"#FFD5D5",bubble_text_color:"#B54827"})}}}},{key:"findDestinationCallBack",value:function e(t,s,i){return t.id==this.value}},{key:"show",value:function e(s){var i=this;if(!t.Type.isPlainObject(s)){s={}}var n=t.Type.isStringFilled(s.entityType)?s.entityType:"post";var a=this.getExtraData();var o={attachButton:this.getAttachButton(),mentionButton:this.getMentionButton(),attachFileSettings:this.getAttachFileSettings(),extraData:a?a:{},smileButton:{},supportLocalFilesInText:n==="post",okButton:{callback:function e(a){if(!t.Type.isStringFilled(a.text)){return}var o=i.buildRequestStub({type:n,extraData:a.extraData,text:i.parseMentions(a.text),pinnedContext:t.Type.isStringFilled(a.extraData.pinnedContext)&&a.extraData.pinnedContext==="YES"});var r=a.extraData.messageUFCode;i.buildFiles(o,a.attachedFiles,{ufCode:r}).then((function(){if(n!=="post"){return}i.buildDestinations(o,a.selectedRecipients,t.Type.isPlainObject(a.extraData)&&!t.Type.isUndefined(a.extraData.hiddenRecipients)?a.extraData.hiddenRecipients:[],{});if(!o.postVirtualId){return}o.ufCode=r;o.contentType="post";oMSL.initPostForm({groupId:s.groupId?s.groupId:null});BXMobileApp.onCustomEvent("Livefeed.PublicationQueue::setItem",{key:o.postVirtualId,pinnedContext:!!o.pinnedContext,item:o,pageId:N.getPageId(),groupId:s.groupId?s.groupId:null},true)}),(function(){}))},name:t.Loc.getMessage("MSLPostFormSend")},cancelButton:{callback:function e(){oMSL.initPostForm({groupId:s.groupId?s.groupId:null})},name:t.Loc.getMessage("MSLPostFormCancel")}};if(!t.Type.isUndefined(this.postFormParams.messageText)){o.message={text:this.postFormParams.messageText}}if(!t.Type.isUndefined(this.postFormParams.messageFiles)){o.attachedFiles=this.postFormParams.messageFiles}if(n==="post"){o.recipients={dataSource:this.getRecipientsDataSource()};if(!t.Type.isUndefined(this.postFormParams.selectedRecipients)){o.recipients.selectedRecipients=this.postFormParams.selectedRecipients}if(!t.Type.isUndefined(this.postFormParams.backgroundCode)){o.backgroundCode=this.postFormParams.backgroundCode}}return o}},{key:"getAttachButton",value:function e(){var s=[];if(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DISK_INSTALLED")==="Y"||t.Loc.getMessage("MOBILE_EXT_LIVEFEED_WEBDAV_INSTALLED")==="Y"){var i={id:"disk",name:t.Loc.getMessage("MSLPostFormDisk"),dataSource:{multiple:"NO",url:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DISK_INSTALLED")==="Y"?"".concat(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId=").concat(t.Loc.getMessage("USER_ID")):"".concat(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/webdav/user/").concat(t.Loc.getMessage("USER_ID"),"/")}};var n={searchField:"YES",showtitle:"YES",modal:"YES",name:t.Loc.getMessage("MSLPostFormDiskTitle")};if(window.platform==="ios"){i.dataSource.table_settings=n}else{i.dataSource.TABLE_SETTINGS=n}s.push(i)}s.push({id:"mediateka",name:t.Loc.getMessage("MSLPostFormPhotoGallery")});s.push({id:"camera",name:t.Loc.getMessage("MSLPostFormPhotoCamera")});return{items:s}}},{key:"getMentionButton",value:function e(){return{dataSource:{return_full_mode:"YES",outsection:"NO",okname:t.Loc.getMessage("MSLPostFormTableOk"),cancelname:t.Loc.getMessage("MSLPostFormTableCancel"),multiple:"NO",alphabet_index:"YES",url:"".concat(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/index.php?mobile_action=get_user_list&use_name_format=Y")}}}},{key:"getAttachFileSettings",value:function e(){return{resize:[40,1,1,1e3,1e3,0,2,false,true,false,null,0],saveToPhotoAlbum:true}}},{key:"buildRequestStub",value:function e(s){var i=null;if(s.type==="post"){i={ACTION:"ADD_POST",AJAX_CALL:"Y",PUBLISH_STATUS:"P",is_sent:"Y",apply:"Y",sessid:t.Loc.getMessage("bitrix_sessid"),POST_MESSAGE:s.text,decode:"Y",SPERM:{},SPERM_NAME:{},MOBILE:"Y",PARSE_PREVIEW:"Y"};if(!t.Type.isUndefined(s.extraData.postId)&&parseInt(s.extraData.postId)>0){i.post_id=parseInt(s.extraData.postId);i.post_user_id=parseInt(s.extraData.postAuthorId);i.pinnedContext=!!s.pinnedContext;i.ACTION="EDIT_POST";if(!t.Type.isUndefined(s.extraData.logId)&&parseInt(s.extraData.logId)>0){i.log_id=parseInt(s.extraData.logId)}}}else if(s.type==="comment"&&!t.Type.isUndefined(s.extraData.commentId)&&parseInt(s.extraData.commentId)>0&&t.Type.isStringFilled(s.extraData.commentType)){i={action:"EDIT_COMMENT",text:this.parseMentions(s.text),commentId:parseInt(s.extraData.commentId),nodeId:s.extraData.nodeId,sessid:t.Loc.getMessage("bitrix_sessid")};if(s.extraData.commentType==="blog"){i.comment_post_id=null}}return i}},{key:"parseMentions",value:function e(t){var s=t;if(typeof oMSL.arMention!="undefined"){for(var i=0,n=Object.entries(oMSL.arMention);i<n.length;i++){var a=babelHelpers.slicedToArray(n[i],2),o=a[0],r=a[1];s=s.replace(new RegExp(o,"g"),r)}oMSL.arMention={};oMSL.commentTextCurrent=""}return s}},{key:"buildFiles",value:function e(s,n,a){var o=this;var r=new Promise((function(e,r){var l=a.ufCode;s.postVirtualId=parseInt(Math.random()*1e5);s.tasksList=[];if(t.Type.isArray(n)&&n.length>0){var c=0;var d=n.length;var u=function t(){c++;if(c>=d){o.postProgressingFiles(s,n,a);e()}};var p=[];n.forEach((function(e){var n=!t.Type.isUndefined(e.VALUE)||!t.Type.isUndefined(e.id)&&parseInt(e.id)>0||t.Type.isPlainObject(e.dataAttributes)&&!t.Type.isUndefined(e.dataAttributes.VALUE)||t.Type.isStringFilled(e.ufCode)&&e.ufCode===l;var a=t.Type.isUndefined(e.url)||!t.Type.isNumber(e.id);if(t.Type.isStringFilled(e.url)&&a&&!n){var o="postTask_".concat(parseInt(Math.random()*1e5));var r=i.MobileUtils.getFileMimeType(e.type);p.push({taskId:o,type:e.type,mimeType:r,folderId:parseInt(t.Loc.getMessage("MOBILE_EXT_UTILS_USER_FOLDER_FOR_SAVED_FILES")),params:{postVirtualId:s.postVirtualId,pinnedContext:!!s.pinnedContext},name:i.MobileUtils.getUploadFilename(e.name,e.type),url:e.url,previewUrl:e.previewUrl?e.previewUrl:null,resize:i.MobileUtils.getResizeOptions(e.type)});s.tasksList.push(o)}else{if(n){if(t.Type.isUndefined(s[l])){s[l]=[]}if(!t.Type.isUndefined(e.VALUE)){s[l].push(e.VALUE)}else if(parseInt(e.id)>0){s[l].push(parseInt(e.id))}else{s[l].push(e.dataAttributes.VALUE)}}u()}}));if(p.length>0){BXMobileApp.onCustomEvent("onFileUploadTaskReceived",{files:p},true)}e()}else{o.postProgressingFiles(s,n,a);e()}}));r["catch"]((function(e){console.error(e)}));return r}},{key:"buildDestinations",value:function e(s,i,n,a){s["DEST"]=[];if(t.Type.isPlainObject(i.a_users)){for(var o=0,r=Object.entries(i.a_users);o<r.length;o++){var l=babelHelpers.slicedToArray(r[o],2),c=l[0],d=l[1];var u="U";if(t.Type.isUndefined(s.SPERM[u])){s.SPERM[u]=[]}if(t.Type.isUndefined(s.SPERM_NAME[u])){s.SPERM_NAME[u]=[]}var p=!t.Type.isUndefined(d.ID)?d.ID:d.id;var f=!t.Type.isUndefined(d.NAME)?d.NAME:d.name;var m=parseInt(p)===0?"UA":"U".concat(p);s.SPERM[u].push(m);s.DEST.push(m);s.SPERM_NAME[u].push(f)}}if(t.Type.isPlainObject(i.b_groups)){for(var h=0,g=Object.entries(i.b_groups);h<g.length;h++){var E=babelHelpers.slicedToArray(g[h],2),v=E[0],I=E[1];var T="SG";if(t.Type.isUndefined(s.SPERM[T])){s.SPERM[T]=[]}if(t.Type.isUndefined(s.SPERM_NAME[T])){s.SPERM_NAME[T]=[]}var y=!t.Type.isUndefined(I.ID)?I.ID:I.id;var b=!t.Type.isUndefined(I.NAME)?I.NAME:I.name;var L="SG".concat(y);s.SPERM[T].push(L);s.DEST.push(L);s.SPERM_NAME[T].push(b)}}for(var P in n){if(!n.hasOwnProperty(P)){continue}var _=n[P].TYPE;if(t.Type.isUndefined(s.SPERM[_])){s.SPERM[_]=[]}var S="".concat(n[P].TYPE).concat(n[P].ID);s.SPERM[_].push(S);s.DEST.push(S)}}},{key:"getRecipientsDataSource",value:function e(){return{return_full_mode:"YES",outsection:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DENIED")!=="Y"?"YES":"NO",okname:t.Loc.getMessage("MSLPostFormTableOk"),cancelname:t.Loc.getMessage("MSLPostFormTableCancel"),multiple:"YES",alphabet_index:"YES",showtitle:"YES",user_all:"YES",url:"".concat(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/index.php?mobile_action=").concat(t.Loc.getmessage("MOBILE_EXT_LIVEFEED_CURRENT_EXTRANET_SITE")==="Y"?"get_group_list":"get_usergroup_list","&feature=blog")}}},{key:"postProgressingFiles",value:function e(s,i,n){var a=n.ufCode;if(t.Type.isUndefined(s[a])){s[a]=[]}if(t.Type.isUndefined(i)){i=[]}for(var o in this.postFormParams.messageFiles){if(!this.postFormParams.messageFiles.hasOwnProperty(o)){continue}for(var r in i){if(!i.hasOwnProperty(r)){continue}if(this.postFormParams.messageFiles[o].id==i[r].id||this.postFormParams.messageFiles[o].id==i[r].ID){s[a].push(this.postFormParams.messageFiles[o].id);break}}}if(s[a].length<=0){s[a].push("empty")}}}]);return e}();var E;var v=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.panelInitialized=false;this["class"]={panel:"lenta-pinned-panel",panelCollapsed:"lenta-pinned-panel-collapsed",panelActive:"lenta-pinned-panel-active",collapsedPanel:"lenta-pinned-collapsed-posts",collapsedPanelPostsValue:"lenta-pinned-collapsed-count-posts",collapsedPanelComments:"lenta-pinned-collapsed-posts-comments",collapsedPanelCommentsShown:"lenta-pinned-collapsed-posts-comments-active",collapsedPanelCommentsValue:"lenta-pinned-collapsed-count-comments",collapsedPanelCommentsValueNew:"post-item-inform-right-new-value",collapsedPanelExpandButton:"lenta-pinned-collapsed-posts-btn",post:"lenta-item",postItemPinned:"lenta-item-pinned",postItemPinActive:"lenta-item-pin-active",postItemPinnedBlock:"post-item-pinned-block",postItemPinnedTitle:"post-item-pinned-title",postItemPinnedTextBox:"post-item-pinned-text-box",postItemPinnedDesc:"post-item-pinned-desc",cancelPanel:"post-pinned-cancel-panel",cancelPanelButton:"post-pinned-cancel-panel-btn"};this.init();s.EventEmitter.subscribe("onFrameDataProcessed",(function(){t.init()}))}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this;var s=document.querySelector(".".concat(this["class"].panel));if(!s||this.panelInitialized){return}this.panelInitialized=true;this.adjustCollapsedPostsPanel();var i=document.querySelector(".".concat(this["class"].collapsedPanel));if(i){i.addEventListener("touchend",(function(e){t.expandCollapsedPostsPanel();e.stopPropagation();return e.preventDefault()}))}}},{key:"resetFlags",value:function e(){this.panelInitialized=false}},{key:"getPinnedPanelNode",value:function e(){return document.querySelector("[data-livefeed-pinned-panel]")}},{key:"recalcPanel",value:function e(t){var s=t.type;if(this.getPostsCount()>0){this.getPinnedPanelNode().classList.add("".concat(this["class"].panelActive))}else{this.getPinnedPanelNode().classList.remove("".concat(this["class"].panelActive))}this.recalcCollapsedPostsPanel({type:s})}},{key:"recalcCollapsedPostsPanel",value:function e(s){var i=s.type;if(this.getPostsCount()>=t.Loc.getMessage("MOBILE_EXT_LIVEFEED_COLLAPSED_PINNED_PANEL_ITEMS_LIMIT")){if(i==="insert"||this.getPinnedPanelNode().classList.contains("".concat(this["class"].panelCollapsed))){this.getPinnedPanelNode().classList.add("".concat(this["class"].panelCollapsed))}}else{this.getPinnedPanelNode().classList.remove("".concat(this["class"].panelCollapsed))}this.adjustCollapsedPostsPanel()}},{key:"expandCollapsedPostsPanel",value:function e(){this.getPinnedPanelNode().classList.remove("".concat(this["class"].panelCollapsed))}},{key:"getPostsCount",value:function e(){return Array.from(this.getPinnedPanelNode().getElementsByClassName("".concat(this["class"].post))).length}},{key:"adjustCollapsedPostsPanel",value:function e(){var t=this.getPostsCount();var s=this.getPinnedPanelNode().querySelector(".".concat(this["class"].collapsedPanelPostsValue));if(s){s.innerHTML=parseInt(t)}var i=this.getPinnedPanelNode().querySelector(".".concat(this["class"].collapsedPanelComments));var n=this.getPinnedPanelNode().querySelector(".".concat(this["class"].collapsedPanelCommentsValue));if(i&&n){var a=Array.from(this.getPinnedPanelNode().querySelectorAll(".".concat(this["class"].collapsedPanelCommentsValueNew))).reduce((function(e,t){return e+parseInt(t.innerHTML)}),0);n.innerHTML="+"+a;if(a>0){i.classList.add("".concat(this["class"].collapsedPanelCommentsShown))}else{i.classList.remove("".concat(this["class"].collapsedPanelCommentsShown))}}}},{key:"getPinnedData",value:function e(s){var i=s.logId?parseInt(s.logId):0;if(i<=0){return Promise.reject()}return new Promise((function(e,a){n.Ajax.runAction("socialnetwork.api.livefeed.logentry.getPinData",{data:{params:{logId:i}},headers:[{name:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_AJAX_ENTITY_HEADER_NAME"),value:s.entityValue||""},{name:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_AJAX_TOKEN_HEADER_NAME"),value:s.tokenValue||""}]}).then((function(t){if(t.status==="success"){e(t.data)}else{a(t.errors)}}),(function(e){a()}))}))}},{key:"insertEntry",value:function e(s){var i=this;var n=s.logId,a=s.postNode,o=s.pinnedContent;var r=this.getPinnedPanelNode();if(!t.Type.isDomNode(a)||!t.Type.isDomNode(r)){return}var l=a.querySelector(".".concat(this["class"].postItemPinnedBlock));if(!t.Type.isDomNode(l)){return}a.classList.add(this["class"].postItemPinned);a.classList.add(this["class"].postItemPinActive);l.innerHTML="".concat(t.Type.isStringFilled(o.TITLE)?'<div class="'.concat(this["class"].postItemPinnedTitle,'">').concat(o.TITLE,"</div>"):"",'<div class="').concat(this["class"].postItemPinnedTextBox,'"><div class="').concat(this["class"].postItemPinnedDesc,'">').concat(o.DESCRIPTION,"</div></div>");var c=t.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['<div class="','" data-livefeed-id="','">\n\t\t\t<div class="post-pinned-cancel-panel-content">\n\t\t\t\t<div class="post-pinned-cancel-panel-label">','</div>\n\t\t\t\t\t<div class="post-pinned-cancel-panel-text">','</div>\n\t\t\t\t</div>\n\t\t\t<div class="ui-btn ui-btn-light-border ui-btn-round ui-btn-sm ','">',"</div>\n\t\t</div>"])),this["class"].cancelPanel,n,t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_PINNED_CANCEL_TITLE"),t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_PINNED_CANCEL_DESCRIPTION"),this["class"].cancelPanelButton,t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_PINNED_CANCEL_BUTTON"));var d=c.querySelector(".".concat(this["class"].cancelPanelButton));d.addEventListener("touchend",(function(e){var t=e.currentTarget.closest(".".concat(i["class"].cancelPanel));if(!t){return}var s=parseInt(t.getAttribute("data-livefeed-id"));if(s<=0){return}var n=document.querySelector(".".concat(i["class"].post,'[data-livefeed-id="').concat(s,'"]'));if(!n){return}var a=n.querySelector('[data-menu-type="post"]');if(!a){return}var o=new u({logId:s});return o.setPinned({menuNode:a,context:"list"})}));a.parentNode.insertBefore(c,a);t.Dom.prepend(a,r);this.recalcPanel({type:"insert"});Q.onScroll()}},{key:"extractEntry",value:function e(s){var i=s.logId,n=s.postNode,a=s.containerNode;var o=this.getPinnedPanelNode();if(!t.Type.isDomNode(n)||!t.Type.isDomNode(a)||!t.Type.isDomNode(o)||n.parentNode!==o||parseInt(i)<=0){return}n.classList.remove(this["class"].postItemPinned);n.classList.remove(this["class"].postItemPinActive);var r=document.querySelector(".".concat(this["class"].cancelPanel,'[data-livefeed-id="').concat(parseInt(i),'"]'));if(r){r.parentNode.insertBefore(n,r);t.Dom.remove(r)}else{t.Dom.prepend(n,a)}this.recalcPanel({type:"extract"})}}]);return e}();var I=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));e.init();return e}babelHelpers.createClass(t,[{key:"init",value:function e(){this.setEventNamespace("BX.Mobile.Livefeed");this.subscribe("onFeedInit",this.onFeedInit.bind(this))}},{key:"onFeedInit",value:function e(){if(!window.BXRL){return}Object.keys(window.BXRL).forEach((function(e){if(e!=="manager"&&e!=="render"){delete window.BXRL[e]}}))}}]);return t}(s.EventEmitter);var T=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"setPostRead",value:function e(s){var i=this;if(!t.Type.isDomNode(s)||s.hasAttribute("done")){return false}var a=parseInt(s.getAttribute("bx-data-post-id"));if(a<=0){return false}this.renderRead({node:s,value:true});n.Ajax.runAction("socialnetwork.api.livefeed.blogpost.important.vote",{data:{params:{POST_ID:a}}}).then((function(e){if(!t.Type.isStringFilled(e.data.success)||e.data.success!=="Y"){i.renderRead({node:s,value:false})}else{BXMobileApp.onCustomEvent("onLogEntryImpPostRead",{postId:a},true)}}),(function(e){i.renderRead({node:s,value:false})}));return true}},{key:"renderRead",value:function e(s){if(!t.Type.isObject(s)||!t.Type.isDomNode(s.node)){return}var i=s.node;var n=!!s.value;if(n){i.checked=true;i.setAttribute("done","Y");t.Event.unbindAll(i)}else{i.checked=false;delete i.checked;i.removeAttribute("done")}var a=i.closest(".post-item-important");if(!a){return}var o=a.querySelector(".post-item-important-list");if(!o){return}o.classList.add("post-item-important-list-read")}}]);return e}();var y=function(e){babelHelpers.inherits(i,e);function i(){var e;babelHelpers.classCallCheck(this,i);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this));e.findTextMode=false;e.ftMinTokenSize=3;e.hideByRefresh=false;return e}babelHelpers.createClass(i,[{key:"init",value:function e(i){var n=this;if(BXMobileAppContext.getApiVersion()<N.getApiVersion("pageMenu")){return}if(t.Type.isPlainObject(i)&&parseInt(i.ftMinTokenSize)>0){this.ftMinTokenSize=parseInt(i.ftMinTokenSize)}this.subscribe("onSearchBarCancelButtonClicked",this.searchBarEventCallback.bind(this));this.subscribe("onSearchBarSearchButtonClicked",this.searchBarEventCallback.bind(this));s.EventEmitter.subscribe("BX.MobileLivefeed.SearchBar::setHideByRefresh",this.setHideByRefresh.bind(this));s.EventEmitter.subscribe("BX.MobileLivefeed.SearchBar::unsetHideByRefresh",this.unsetHideByRefresh.bind(this));BXMobileApp.UI.Page.params.set({useSearchBar:true});app.exec("setParamsSearchBar",{params:{callback:function e(i){if(i.eventName==="onSearchButtonClicked"&&t.Type.isPlainObject(i.data)&&t.Type.isStringFilled(i.data.text)){if(i.data.text.length>=n.ftMinTokenSize){n.findTextMode=true}n.emit("onSearchBarSearchButtonClicked",new s.BaseEvent({data:{text:i.data.text}}))}else if(["onCancelButtonClicked","onSearchHide"].includes(i.eventName)){n.emit("onSearchBarCancelButtonClicked",new s.BaseEvent({data:{}}))}}}})}},{key:"searchBarEventCallback",value:function e(i){var n=this;var a=i.getData();var o=t.Type.isPlainObject(a)&&t.Type.isStringFilled(a.text)?a.text:"";if(o.length>=this.ftMinTokenSize){app.exec("showSearchBarProgress");this.emitRefreshEvent(o)}else{if(this.findTextMode){if(!this.hideByRefresh){s.EventEmitter.emit("BX.MobileLF:onSearchBarRefreshAbort")}if(BX.frameCache){app.exec("hideSearchBarProgress");BX.frameCache.readCacheWithID("framecache-block-feed",(function(e){var s=document.getElementById("bxdynamic_feed_refresh");if(!t.Type.isArray(e.items)||!s){n.emitRefreshEvent();return}var i=e.items.find((function(e){return t.Type.isStringFilled(e.ID)&&e.ID==="framecache-block-feed"}));if(t.Type.isUndefined(i)){return}t.Runtime.html(s,i.CONTENT).then((function(){BX.processHTML(i.CONTENT,true)}));u.moveTop();setTimeout((function(){BitrixMobile.LazyLoad.showImages()}),1e3)}))}else{this.emitRefreshEvent()}}this.findTextMode=false}}},{key:"setHideByRefresh",value:function e(){this.hideByRefresh=true}},{key:"unsetHideByRefresh",value:function e(){this.hideByRefresh=false}},{key:"emitRefreshEvent",value:function e(t){if(Q.refreshXhr){return}t=t||"";var i=new s.BaseEvent({compatData:[{text:t}]});s.EventEmitter.emit("BX.MobileLF:onSearchBarRefreshStart",i)}}]);return i}(s.EventEmitter);var b=function(){function e(){babelHelpers.classCallCheck(this,e);this.canCheckScrollButton=true;this.showScrollButtonTimeout=null;this.showScrollButtonBottom=false;this.showScrollButtonTop=false;this["class"]={scrollButton:"post-comment-block-scroll",scrollButtonTop:"post-comment-block-scroll-top",scrollButtonBottom:"post-comment-block-scroll-bottom",scrollButtonTopActive:"post-comment-block-scroll-top-active",scrollButtonBottomActive:"post-comment-block-scroll-bottom-active"};this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){if(window.platform==="ios"){return}document.addEventListener("scroll",this.onScrollDetail.bind(this))}},{key:"onScrollDetail",value:function e(){var t=this;if(!this.canCheckScrollButton){return}clearTimeout(this.showScrollButtonTimeout);this.showScrollButtonTimeout=setTimeout((function(){N.setLastActivityDate();t.checkScrollButton()}),200)}},{key:"checkScrollButton",value:function e(){var t=window.scrollY;var s=document.documentElement.scrollHeight-window.innerHeight-100;this.showScrollButtonBottom=!(document.documentElement.scrollHeight-window.innerHeight<=0||t>=s&&(t>0||s>0));this.showScrollButtonTop=t>200;this.showHideScrollButton()}},{key:"showHideScrollButton",value:function e(){var t=document.querySelector(".".concat(this["class"].scrollButtonBottom));var s=document.querySelector(".".concat(this["class"].scrollButtonTop));if(t){if(this.showScrollButtonBottom){if(!t.classList.contains("".concat(this["class"].scrollButtonBottomActive))){t.classList.add("".concat(this["class"].scrollButtonBottomActive))}}else{if(t.classList.contains("".concat(this["class"].scrollButtonBottomActive))){t.classList.remove("".concat(this["class"].scrollButtonBottomActive))}}}if(s){if(this.showScrollButtonTop){if(!s.classList.contains("".concat(this["class"].scrollButtonTopActive))){s.classList.add("".concat(this["class"].scrollButtonTopActive))}}else{if(s.classList.contains("".concat(this["class"].scrollButtonTopActive))){s.classList.remove("".concat(this["class"].scrollButtonTopActive))}}}}},{key:"scrollTo",value:function e(t){var s=this;if(t!=="top"){t="bottom"}this.canCheckScrollButton=false;this.showScrollButtonBottom=false;this.showScrollButtonTop=false;this.showHideScrollButton();var i=window.scrollY;var n=t=="bottom"?document.documentElement.scrollHeight:0;BitrixAnimation.animate({duration:500,start:{scroll:i},finish:{scroll:n},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function e(t){window.scrollTo(0,t.scroll)},complete:function e(){s.canCheckScrollButton=true;s.checkScrollButton()}})}}]);return e}();var L=function(){function e(){babelHelpers.classCallCheck(this,e);this.defaultValue=true;this.value=true;this["class"]={postItemFollow:"post-item-follow",postItemFollowActive:"post-item-follow-active"}}babelHelpers.createClass(e,[{key:"init",value:function e(){}},{key:"setFollow",value:function e(s){var i=this;var a=!t.Type.isUndefined(s.logId)?parseInt(s.logId):0;var o=!t.Type.isUndefined(s.pageId)?s.pageId:false;var r=!t.Type.isUndefined(s.bRunEvent)?s.bRunEvent:true;var l=!t.Type.isUndefined(s.bAjax)?s.bAjax:false;var c=typeof s.bOnlyOn!="undefined"?s.bOnlyOn:false;if(c=="NO"){c=false}var d=null;if(t.Type.isDomNode(s.menuNode)){d=s.menuNode}else if(t.Type.isStringFilled(s.menuNode)){d=document.getElementById(s.menuNode)}if(!d){d=document.getElementById("log-entry-menu-".concat(a))}var u=document.getElementById("log_entry_follow_".concat(a));if(!u){u=document.getElementById("log_entry_follow")}var p=document.getElementById("post_item_top_wrap_".concat(a));if(!p){p=document.getElementById("post_item_top_wrap")}var f=null;if(d){f=d.getAttribute("data-follow")==="Y"?"Y":"N"}else if(u){f=u.getAttribute("data-follow")=="Y"?"Y":"N"}else{return false}var m=f==="Y"?"N":"Y";if((!t.Type.isStringFilled(N.getOption("detailPageId"))||N.getOption("detailPageId")!==o)&&(!c||f==="N")){this.drawFollow({value:f!=="Y",followBlock:u,followWrap:p,menuNode:d,runEvent:r,turnOnOnly:c,logId:a})}if(l){n.Ajax.runAction("socialnetwork.api.livefeed.changeFollow",{data:{logId:a,value:m},analyticsLabel:{b24statAction:m==="Y"?"setFollow":"setUnfollow"}}).then((function(e){if(e.data.success){return}i.drawFollow({value:f==="Y",followBlock:u,followWrap:p,menuNode:d,runEvent:true,turnOnOnly:c,logId:a})}),(function(e){i.drawFollow({value:f==="Y",followBlock:u,followWrap:p,menuNode:d,runEvent:false})}))}return false}},{key:"drawFollow",value:function e(s){var i=t.Type.isBoolean(s.value)?s.value:null;if(t.Type.isNull(i)){return}var n=t.Type.isDomNode(s.followBlock)?s.followBlock:null;if(n){n.classList.remove(i?this["class"].postItemFollow:this["class"].postItemFollowActive);n.classList.add(i?this["class"].postItemFollowActive:this["class"].postItemFollow);n.setAttribute("data-follow",i?"Y":"N")}var a=t.Type.isDomNode(s.followWrap)?s.followWrap:null;if(a&&!this.getFollowDefaultValue()){if(i){a.classList.add(this["class"].postItemFollow)}else{a.classList.remove(this["class"].postItemFollow)}}var o=t.Type.isDomNode(s.menuNode)?s.menuNode:null;if(o){o.setAttribute("data-follow",i?"Y":"N")}var r=N.getOption("detailPageId");if(t.Type.isStringFilled(r)){this.setFollowValue(i);this.setFollowMenuItemName()}var l=t.Type.isBoolean(s.runEvent)?s.runEvent:false;var c=!t.Type.isUndefined(s.logId)?parseInt(s.logId):0;var d=t.Type.isBoolean(s.turnOnOnly)?s.turnOnOnly:false;if(l&&c>0){BXMobileApp.onCustomEvent("onLogEntryFollow",{logId:c,pageId:t.Type.isStringFilled(r)?r:"",bOnlyOn:d?"Y":"N"},true)}}},{key:"setFollowDefault",value:function e(s){var i=this;if(t.Type.isUndefined(s.value)){return}var n=!!s.value;if(!t.Type.isStringFilled(N.getOption("detailPageId"))){this.setFollowDefaultValue(n);this.setDefaultFollowMenuItemName()}var a={sessid:BX.bitrix_sessid(),site:t.Loc.getMessage("SITE_ID"),lang:t.Loc.getMessage("LANGUAGE_ID"),value:n?"Y":"N",action:"change_follow_default",mobile_action:"change_follow_default"};oMSL.changeListMode(a,(function(){oMSL.pullDownAndRefresh()}),(function(e){i.setFollowDefaultValue(e.value!=="Y");i.setDefaultFollowMenuItemName()}))}},{key:"setFollowValue",value:function e(t){this.value=!!t}},{key:"getFollowValue",value:function e(){return this.value}},{key:"setFollowDefaultValue",value:function e(t){this.defaultValue=!!t}},{key:"getFollowDefaultValue",value:function e(){return this.defaultValue}},{key:"setFollowMenuItemName",value:function e(){var s=X.detailPageMenuItems.findIndex((function(e){return t.Type.isStringFilled(e.feature)&&e.feature==="follow"}));if(s<0){return}var i=X.detailPageMenuItems[s];i.name=this.getFollowValue()?t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_Y"):t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_N");X.detailPageMenuItems[s]=i;X.init({type:"detail"})}},{key:"setDefaultFollowMenuItemName",value:function e(){var s=X.listPageMenuItems.findIndex((function(e){return t.Type.isStringFilled(e.feature)&&e.feature==="follow"}));if(s<0){return}var i=X.listPageMenuItems[s];i.name=this.getFollowDefaultValue()?t.Loc.getMessage("MSLMenuItemFollowDefaultY"):t.Loc.getMessage("MSLMenuItemFollowDefaultN");X.listPageMenuItems[s]=i;X.init({type:"list"})}}]);return e}();var P,_,S,M;var D=function(){function e(){babelHelpers.classCallCheck(this,e);this.emptyCommentsXhr=null;this.repoLog={};this.mid={};this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){s.EventEmitter.subscribe("OnUCommentWasDeleted",this.deleteHandler.bind(this));s.EventEmitter.subscribe("OnUCommentWasHidden",this.deleteHandler.bind(this));s.EventEmitter.subscribe("OnUCRecordHasDrawn",this.drawHandler.bind(this));s.EventEmitter.subscribe("OnUCFormSubmit",this.submitHandler.bind(this))}},{key:"deleteHandler",value:function e(t){var s=t.getData(),i=babelHelpers.slicedToArray(s,2),n=i[0],a=i[1];var o=N.getLogId();if(this.mid[a.join("-")]!=="hidden"){this.mid[a.join("-")]="hidden";if(this.repoLog[o]){this.repoLog[o]["POST_NUM_COMMENTS"]--;BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:o,num:this.repoLog[o]["POST_NUM_COMMENTS"]},true)}}}},{key:"drawHandler",value:function e(t){var s=t.getData(),i=babelHelpers.slicedToArray(s,2),n=i[0],a=i[1];var o=N.getLogId();this.mid[n]=this.mid[n]||{};if(this.mid[a.join("-")]!=="drawn"){this.mid[a.join("-")]="drawn";var r=false;if(this.repoLog[o]&&(r=document.getElementById("record-".concat(a.join("-"),"-cover")))&&r&&r.parentNode==document.getElementById("record-".concat(n,"-new"))){this.repoLog[o]["POST_NUM_COMMENTS"]++;BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:o,num:this.repoLog[o]["POST_NUM_COMMENTS"]},true)}}}},{key:"submitHandler",value:function e(t){var s=t.getData(),i=babelHelpers.slicedToArray(s,4),n=i[0],a=i[1],o=i[2],r=i[3];if(r&&r.mobile_action&&r.mobile_action==="add_comment"&&a>0){r.mobile_action=r.action="edit_comment";r.edit_id=a}}},{key:"setRepoItem",value:function e(t,s){this.repoLog[t]=s}},{key:"getList",value:function e(i){var a=this;var o=i.ts;var r=!!i.bPullDown;var l=t.Type.isUndefined(i.bPullDownTop)||i.bPullDownTop;var c=t.Type.isUndefined(i.obFocus.form)||i.obFocus.form==="NO"?"NO":"YES";var d=t.Type.isUndefined(i.obFocus.comments)||i.obFocus.comments==="NO"?"NO":"YES";var u=oMSL.logId;var p=document.getElementById("post-comments-wrap");if(!r){if(l){BXMobileApp.UI.Page.Refresh.start()}t.Dom.clean(p);p.appendChild(t.Tag.render(P||(P=babelHelpers.taggedTemplateLiteral(['<span id="post-comment-last-after"></span>']))))}this.showEmptyListWaiter({container:p,enable:true});s.EventEmitter.emit("BX.MobileLF:onCommentsGet");BXMobileApp.UI.Page.TextPanel.hide();this.emptyCommentsXhr=n.Ajax.wrap({type:"json",method:"POST",url:"".concat(t.Loc.getMessage("MSLPathToLogEntry").replace("#log_id#",u),"&empty_get_comments=Y").concat(!t.Type.isNil(o)?"&LAST_LOG_TS=".concat(o):""),data:{},processData:true,callback:function e(i){var n=document.getElementById("post-comments-form-wrap");if(r){app.exec("pullDownLoadingStop")}else if(l){BXMobileApp.UI.Page.Refresh.stop()}a.showEmptyListWaiter({container:p,enable:false});if(t.Type.isStringFilled(i.POST_PERM)){oMSL.menuData.post_perm=i.POST_PERM;X.detailPageMenuItems=X.buildDetailPageMenu(oMSL.menuData);X.init({type:"detail"})}if(t.Type.isStringFilled(i.TEXT)){if(r){t.Dom.clean(p);if(!t.Type.isUndefined(i.POST_NUM_COMMENTS)){BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:u,num:parseInt(i.POST_NUM_COMMENTS)},true)}}a.setRepoItem(u,{POST_NUM_COMMENTS:i.POST_NUM_COMMENTS});var o=BX.processHTML(i.TEXT,true);t.Runtime.html(p,o.HTML).then((function(){setTimeout((function(){BitrixMobile.LazyLoad.showImages()}),1e3)}));p.appendChild(t.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['<span id="post-comment-last-after"></span>']))));var f=0;var m=function e(){f++;if(f<100){if(p.childNodes.length>0){BX.ajax.processScripts(o.SCRIPT)}else{BX.defer(e,a)()}}};BX.defer(m,a)();var h=new s.BaseEvent({compatData:[{mobile:true,ajaxUrl:"".concat(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/ajax.php"),commentsContainerId:"post-comments-wrap",commentsClassName:"post-comment-wrap"}]});s.EventEmitter.emit("BX.UserContentView.onInitCall",h);s.EventEmitter.emit("BX.UserContentView.onClearCall",h);if(!r){if(n){n.innerHTML=""}__MSLDetailPullDownInit(true);if(c==="YES"){a.setFocusOnComments("form")}else if(d=="YES"){a.setFocusOnComments("list")}}N.setLastActivityDate();W.checkScrollButton();var g=document.getElementById("post_log_id");if(!t.Type.isUndefined(i.TS)&&g){g.setAttribute("data-ts",i.TS)}}else{if(!r){a.showEmptyListWaiter({container:p,enable:false})}app.alert({title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_ALERT_ERROR_TITLE"),text:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_ALERT_ERROR_POST_NOT_FOUND_TEXT"),button:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_ALERT_ERROR_BUTTON"),callback:function e(){BXMobileApp.onCustomEvent("Livefeed::onLogEntryDetailNotFound",{logId:u},true);BXMPage.close()}})}},callback_failure:function e(){if(r){app.exec("pullDownLoadingStop")}else{BXMobileApp.UI.Page.Refresh.stop()}a.showEmptyListWaiter({container:p,enable:false});a.showEmptyListFailed({container:p,timestampValue:o,pullDown:r,moveBottom:c})}})}},{key:"showEmptyListWaiter",value:function e(s){var i=s.container;var n=!!s.enable;if(!t.Type.isDomNode(i)){return}var a=i.querySelector(".post-comments-load-btn-wrap");if(a){t.Dom.clean(a);t.Dom.remove(a)}if(!n){return}i.appendChild(t.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['<div class="post-comments-load-btn-wrap"><div class="post-comments-loader"></div><div class="post-comments-load-text">',"</div></div>"])),t.Loc.getMessage("MSLDetailCommentsLoading")))}},{key:"showEmptyListFailed",value:function e(s){var i=this;var n=s.container,a=s.timestampValue,o=s.pullDown,r=s.moveBottom,l=s.data;if(!t.Type.isDomNode(n)){return}var c=t.Type.isObject(l)&&t.Type.isStringFilled(l.ERROR_MESSAGE)?l.ERROR_MESSAGE:t.Loc.getMessage("MSLDetailCommentsFailed");n.appendChild(t.Tag.render(M||(M=babelHelpers.taggedTemplateLiteral(['<div class="post-comments-load-btn-wrap"><div class="post-comments-load-text">','</div><a class="post-comments-load-btn">',"</a></div>"])),c,t.Loc.getMessage("MSLDetailCommentsReload")));var d=n.querySelector(".post-comments-load-btn");if(!d){return}d.addEventListener("click",(function(e){if(t.Type.isDomNode(e.target.parent)){t.Dom.clean(e.target.parent);t.Dom.remove(e.target.parent)}i.getList({ts:a,bPullDown:o,obFocus:{form:false}})}));d.addEventListener("touchstart",(function(e){e.target.classList.add("post-comments-load-btn-active")}));d.addEventListener("touchend",(function(e){e.target.classList.remove("post-comments-load-btn-active")}))}},{key:"abortXhr",value:function e(){if(this.emptyCommentsXhr){this.emptyCommentsXhr.abort()}}},{key:"setFocusOnComments",value:function e(t){t=t==="list"?"list":"form";if(t==="form"){this.setFocusOnCommentForm();u.moveBottom()}else if(t==="list"){var s=document.getElementById("post-comments-wrap");if(!s){return false}var i=s.querySelector(".post-comment-block-new");if(i){window.scrollTo(0,i.offsetTop)}else{var n=BX.findChild(s,{className:"post-comment-block"},true);window.scrollTo(0,n?n.offsetTop:0)}}return false}},{key:"setFocusOnCommentForm",value:function e(){BXMobileApp.UI.Page.TextPanel.focus();return false}},{key:"onLogEntryCommentAdd",value:function e(s,i){var n;var a=!t.Type.isUndefined(i);i=!t.Type.isUndefined(i)?parseInt(i):0;var o=document.getElementById("informer_comments_".concat(s));var r=document.getElementById("informer_comments_new_".concat(s));if(o&&!r){if(i>0){n=i}else if(!a){n=(o.innerHTML.length>0?parseInt(o.innerHTML):0)+1}if(parseInt(n)>0){o.innerHTML=n;o.style.display="inline-block";if(document.getElementById("informer_comments_text2_".concat(s))){document.getElementById("informer_comments_text2_".concat(s)).style.display="inline-block"}if(document.getElementById("informer_comments_text_".concat(s))){document.getElementById("informer_comments_text_".concat(s)).style.display="none"}}}var l=document.getElementById("comcntleave-all");if(l){if(i>0){n=i}else if(!a){n=(l.innerHTML.length>0?parseInt(l.innerHTML):0)+1}l.innerHTML=n}}}]);return e}();var k=function(){function e(){babelHelpers.classCallCheck(this,e);this.isBusyGettingNextPage=false;this.isBusyRefreshing=false;this.pageNumber=1;this.nextPageXhr=null;this.refreshXhr=null;this.nextUrl="";this.requestErrorTimeout={refresh:null,nextPage:null};this["class"]={notifier:"lenta-notifier-waiter",notifierActive:"lenta-notifier-shown"};this.onScroll=this.onScroll.bind(this);this.refreshErrorScroll=this.refreshErrorScroll.bind(this);this.nextPageErrorScroll=this.nextPageErrorScroll.bind(this);this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){this.setPageNumber(1)}},{key:"initScroll",value:function e(t,s){t=!!t;s=!!s;if(t){document.removeEventListener("scroll",this.onScroll);document.addEventListener("scroll",this.onScroll)}else{document.removeEventListener("scroll",this.onScroll)}if(s&&document.getElementById("next_post_more")){document.getElementById("next_post_more").style.display=t?"block":"none"}}},{key:"onScroll",value:function e(){var i=this;var a=N.getMaxScroll();if(!((window.pageYOffset>=a||document.documentElement.scrollHeight<=window.innerHeight)&&(window.pageYOffset>0||a>0)&&!this.isBusyRefreshing&&!this.isBusyGettingNextPage)){return}if(N.getOption("refreshFrameCacheNeeded",false)===true){return}document.removeEventListener("scroll",this.onScroll);this.isBusyGettingNextPage=true;this.nextPageXhr=n.Ajax.wrap({type:"json",method:"POST",url:this.getNextPageUrl(),data:{},callback:function e(n){i.nextPageXhr=null;if(t.Type.isPlainObject(n)&&t.Type.isPlainObject(n.PROPS)&&t.Type.isStringFilled(n.PROPS.CONTENT)){if(t.Type.isUndefined(n.LAST_TS)||parseInt(n.LAST_TS)<=0||parseInt(t.Loc.getMessage("MSLFirstPageLastTS"))<=0||parseInt(n.LAST_TS)<parseInt(t.Loc.getMessage("MSLFirstPageLastTS"))||parseInt(n.LAST_TS)===parseInt(t.Loc.getMessage("MSLFirstPageLastTS"))&&(parseInt(n.LAST_ID)<=0||parseInt(t.Loc.getMessage("MSLFirstPageLastId"))<=0||parseInt(n.LAST_ID)!==parseInt(t.Loc.getMessage("MSLFirstPageLastId")))){i.processAjaxBlock(n.PROPS,{type:"next",callback:function e(){N.recalcMaxScroll();oMSL.registerBlocksToCheck();setTimeout(oMSL.checkNodesHeight.bind(oMSL),100);s.EventEmitter.emit("BX.UserContentView.onRegisterViewAreaListCall",new s.BaseEvent({compatData:[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}]}))}});var a=i.getPageNumber();if(parseInt(t.Loc.getMessage("MSLPageNavNum"))>0&&a>0){i.setPageNumber(a+1);var o=t.Uri.removeParam(i.getNextPageUrl(),["PAGEN_"+t.Loc.getMessage("MSLPageNavNum")]);o=t.Uri.addParam(o,babelHelpers.defineProperty({},"PAGEN_".concat(parseInt(t.Loc.getMessage("MSLPageNavNum"))),i.getPageNumber()+1));i.setNextPageUrl(o)}document.addEventListener("scroll",i.onScroll)}}else{i.requestError("nextPage",true)}i.isBusyGettingNextPage=false},callback_failure:function e(){i.requestError("nextPage",true);i.nextPageXhr=null;i.isBusyGettingNextPage=false}})}},{key:"refresh",value:function e(s,i){var a=this;s=!!s;if(this.isBusyGettingNextPage&&!t.Type.isNull(this.nextPageXhr)){this.nextPageXhr.abort()}var o=document.getElementById("lenta_notifier");if(o){o.classList.add(this["class"].notifier)}N.setRefreshNeeded(false);N.setRefreshStarted(true);w.hideRefreshNeededNotifier();O.startWaiter();F.hideAll();this.isBusyRefreshing=true;var r=t.Uri.removeParam(document.location.href,["RELOAD","RELOAD_JSON","FIND"]);r=t.Uri.addParam(r,{RELOAD:"Y",RELOAD_JSON:"Y"});if(t.Type.isPlainObject(i)&&t.Type.isStringFilled(i.find)){r=t.Uri.addParam(r,{FIND:i.find})}var l=[{name:"BX-ACTION-TYPE",value:"get_dynamic"},{name:"BX-REF",value:document.referrer},{name:"BX-CACHE-MODE",value:"APPCACHE"},{name:"BX-APPCACHE-PARAMS",value:JSON.stringify(window.appCacheVars)},{name:"BX-APPCACHE-URL",value:!t.Type.isUndefined(BX.frameCache)&&t.Type.isPlainObject(BX.frameCache.vars)&&t.Type.isStringFilled(BX.frameCache.vars.PAGE_URL)?BX.frameCache.vars.PAGE_URL:oMSL.curUrl}];this.refreshXhr=n.Ajax.wrap({type:"json",method:"POST",url:r,data:{},headers:l,callback:function e(i){a.refreshXhr=null;a.setPageNumber(1);N.setRefreshStarted(false);N.setRefreshNeeded(false);O.stopWaiter();if(document.getElementById("lenta_notifier")){document.getElementById("lenta_notifier").classList.remove(a["class"].notifier)}app.exec("pullDownLoadingStop");app.exec("hideSearchBarProgress");if(t.Type.isPlainObject(i)&&t.Type.isPlainObject(i.PROPS)&&t.Type.isStringFilled(i.PROPS.CONTENT)){a.setRefreshFrameCacheNeeded(false);BitrixMobile.LazyLoad.clearImages();app.hidePopupLoader();w.hideNotifier();w.hideRefreshNeededNotifier();if(!t.Type.isUndefined(i.COUNTER_TO_CLEAR)){BXMobileApp.onCustomEvent("onClearLFCounter",[i.COUNTER_TO_CLEAR],true);BXMobileApp.Events.postToComponent("onClearLiveFeedCounter",{counterCode:i.COUNTER_TO_CLEAR,serverTime:i.COUNTER_SERVER_TIME,serverTimeUnix:i.COUNTER_SERVER_TIME_UNIX},"communication")}a.processAjaxBlock(i.PROPS,{type:"refresh",callback:function e(){Y.resetFlags();Y.init();if(!t.Type.isUndefined(BX.frameCache)&&document.getElementById("bxdynamic_feed_refresh")&&(t.Type.isUndefined(i.REWRITE_FRAMECACHE)||i.REWRITE_FRAMECACHE!=="N")){var s=!t.Type.isUndefined(i.TS)&&parseInt(i.TS)>0?parseInt(i.TS):0;if(s>0){N.setOptions({frameCacheTs:s})}N.updateFrameCache({timestamp:s})}oMSL.registerBlocksToCheck();setTimeout((function(){BitrixMobile.LazyLoad.showImages()}),1e3);w.initEvents()}});if(s){BitrixAnimation.animate({duration:1e3,start:{scroll:window.pageYOffset},finish:{scroll:0},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function e(t){window.scrollTo(0,t.scroll)},complete:function e(){}})}if(window.applicationCache&&i.isManifestUpdated=="1"&&!oMSL.appCacheDebug&&(window.applicationCache.status==window.applicationCache.IDLE||window.applicationCache.status==window.applicationCache.UPDATEREADY)){window.applicationCache.update()}}else{a.requestError("refresh",true)}a.isBusyRefreshing=false},callback_failure:function e(){a.refreshXhr=null;N.setRefreshStarted(false);N.setRefreshNeeded(false);O.stopWaiter();if(document.getElementById("lenta_notifier")){document.getElementById("lenta_notifier").classList.remove(a["class"].notifier)}app.exec("pullDownLoadingStop");app.exec("hideSearchBarProgress");a.requestError("refresh",true);a.isBusyRefreshing=false}})}},{key:"processAjaxBlock",value:function e(s,i){if(!t.Type.isPlainObject(i)||!t.Type.isStringFilled(i.type)||["refresh","next"].indexOf(i.type)<0){return}var n=false;var a=false;o(r);l(c);function o(e){if(t.Type.isArray(s.CSS)&&s.CSS.length>0){BX.load(s.CSS,e)}else{e()}}function r(){if(i.type==="refresh"){document.getElementById("lenta_wrapper_global").innerHTML=s.CONTENT}else{document.getElementById("lenta_wrapper").insertBefore(t.Dom.create("div",{html:s.CONTENT}),document.getElementById("next_post_more"))}n=true;if(a){c()}}function l(e){if(t.Type.isArray(s.JS)&&s.JS.length>0){BX.load(s.JS,e)}else{e()}}function c(){a=true;if(n){t.ajax.processRequestData(s.CONTENT,{scriptsRunFirst:false,dataType:"HTML",onsuccess:function e(){if(t.Type.isFunction(i.callback)){i.callback()}}})}}}},{key:"requestError",value:function e(t,s){var i=this;if(!["refresh","nextPage"].includes(t)){t="refresh"}s=!!s;var n=document.getElementById("lenta_".concat(t.toLowerCase(),"_error"));if(this.requestErrorTimeout[t]){clearTimeout(this.requestErrorTimeout[t])}if(n){if(s){n.classList.add(this["class"].notifierActive);if(t==="refresh"){document.addEventListener("scroll",this.refreshErrorScroll)}}else{if(t==="refresh"){document.removeEventListener("scroll",this.refreshErrorScroll)}n.classList.remove(this["class"].notifierActive)}}else{this.requestErrorTimeout[t]=setTimeout((function(){i.requestError(t,s)}),500)}if(t==="nextPage"){this.initScroll(!s,true)}}},{key:"refreshErrorScroll",value:function e(){this.requestError("refresh",false)}},{key:"nextPageErrorScroll",value:function e(){this.requestError("nextPage",false)}},{key:"setPageNumber",value:function e(t){this.pageNumber=parseInt(t)}},{key:"getPageNumber",value:function e(){return this.pageNumber}},{key:"setNextPageUrl",value:function e(t){this.nextUrl=t}},{key:"getNextPageUrl",value:function e(){return this.nextUrl}},{key:"setRefreshFrameCacheNeeded",value:function e(t){N.setOptions({refreshFrameCacheNeeded:!!t});var i=document.getElementById("next_page_refresh_needed");var n=document.getElementById("next_post_more");if(i&&n){i.style.display=!!t?"block":"none";n.style.display=!!t?"none":"block"}s.EventEmitter.emit("BX.UserContentView.onSetPreventNextPage",new s.BaseEvent({compatData:[!!t]}))}}]);return e}();var B,C;var A=function(){function e(){babelHelpers.classCallCheck(this,e);this.pageId=null;this.logId=false;this.refreshNeeded=false;this.refreshStarted=false;this.options={};this.nodeId={feedContainer:"lenta_wrapper"};this["class"]={listWrapper:"lenta-list-wrap",postWrapper:"post-wrap",pinnedPanel:"lenta-pinned-panel",pin:"lenta-item-pin",postNewContainerTransformNew:"lenta-item-new-cont",postNewContainerTransform:"lenta-item-transform-cont",postLazyLoadCheck:"lenta-item-lazyload-check",listPost:"lenta-item",detailPost:"post-wrap",postItemTopWrap:"post-item-top-wrap",postItemTop:"post-item-top",postItemPostBlock:"post-item-post-block",postItemPostContentView:"post-item-contentview",postItemDescriptionBlock:"post-item-description",postItemAttachedFileWrap:"post-item-attached-disk-file-wrap",postItemInformWrap:"post-item-inform-wrap",postItemInformWrapTree:"post-item-inform-wrap-tree",postItemInformComments:"post-item-inform-comments",postItemInformMore:"post-item-more",postItemMore:"post-more-block",postItemPinnedBlock:"post-item-pinned-block",postItemPinActive:"lenta-item-pin-active",postItemGratitudeUsersSmallContainer:"lenta-block-grat-users-small-cont",postItemGratitudeUsersSmallHidden:"lenta-block-grat-users-small-hidden",postItemImportantUserList:"post-item-important-list",addPostButton:"feed-add-post-button"};this.newPostContainer=null;this.maxScroll=0;this.lastActivityDate=0;this.availableGroupList={};this.isPullDownEnabled=false;this.isPullDownLocked=false;this.isFrameDataReceived=false;this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this;BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAdd",this.afterPostAdd.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAddError",this.afterPostAddError.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdate",this.afterPostUpdate.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdateError",this.afterPostUpdateError.bind(this));BXMobileApp.addCustomEvent("Livefeed::showLoader",this.showLoader.bind(this));BXMobileApp.addCustomEvent("Livefeed::hideLoader",this.hideLoader.bind(this));BXMobileApp.addCustomEvent("Livefeed::scrollTop",this.scrollTop.bind(this));BXMobileApp.addCustomEvent("Livefeed::onLogEntryDetailNotFound",this.removePost.bind(this));BXMobileApp.addCustomEvent("Livefeed.PinnedPanel::change",this.onPinnedPanelChange.bind(this));BXMobileApp.addCustomEvent("Livefeed.PostDetail::pinChanged",this.onPostPinChanged.bind(this));s.EventEmitter.subscribe("BX.LazyLoad:ImageLoaded",this.onLazyLoadImageLoaded.bind(this));s.EventEmitter.subscribe("MobileBizProc:onRenderLogMessages",this.onMobileBizProcRenderLogMessages.bind(this));s.EventEmitter.subscribe("MobilePlayer:onError",this.onMobilePlayerError);document.addEventListener("DOMContentLoaded",(function(){document.addEventListener("click",t.handleClick.bind(t))}))}},{key:"initListOnce",value:function e(i){var n=this;if(!t.Type.isPlainObject(i)){i={}}if(!t.Type.isUndefined(i.arAvailableGroup)){this.availableGroupList=i.arAvailableGroup}s.EventEmitter.subscribe("onFrameDataReceivedBefore",BitrixMobile.LazyLoad.clearImages);s.EventEmitter.subscribe("BX.LazyLoad:ImageLoaded",(function(){n.recalcMaxScroll()}));s.EventEmitter.subscribe("onFrameDataReceived",(function(){n.isPullDownEnabled=false;n.isPullDownLocked=false;n.isFrameDataReceived=true;app.exec("pullDownLoadingStop");BitrixMobile.LazyLoad.showImages(true)}));s.EventEmitter.subscribe("onFrameDataProcessed",(function(e){var s=e.getCompatData(),i=babelHelpers.slicedToArray(s,2),a=i[0],o=i[1];if(!t.Type.isUndefined(a)&&!t.Type.isUndefined(a[0])&&!t.Type.isUndefined(o)&&!!o){if(!t.Type.isUndefined(a[0].PROPS)&&!t.Type.isUndefined(a[0].PROPS.TS)&&parseInt(a[0].PROPS.TS)>0){n.setOptions({frameCacheTs:parseInt(a[0].PROPS.TS)})}}BitrixMobile.LazyLoad.showImages(true);if(!!o){Q.setRefreshFrameCacheNeeded(true)}}));s.EventEmitter.subscribe("onCacheDataRequestStart",(function(){setTimeout((function(){if(!n.isFrameDataReceived){n.isPullDownLocked=true;app.exec("pullDownLoadingStart")}}),1e3)}));s.EventEmitter.subscribe("onFrameDataReceivedError",(function(){app.BasicAuth({success:function e(){BX.frameCache.update(true)},failture:function e(){n.isPullDownLocked=false;app.exec("pullDownLoadingStop");Q.requestError("refresh",true)}})}));s.EventEmitter.subscribe("onFrameDataRequestFail",(function(e){var s=e.getCompatData(),i=babelHelpers.slicedToArray(s,1),a=i[0];if(!t.Type.isUndefined(a)&&t.Type.isStringFilled(a.reason)&&a.reason==="bad_eval"){n.isPullDownLocked=false;app.exec("pullDownLoadingStop");Q.requestError("refresh",true)}else{app.BasicAuth({success:function e(){BX.frameCache.update(true)},failture:function e(){n.isPullDownLocked=false;app.exec("pullDownLoadingStop");Q.requestError("refresh",true)}})}}));s.EventEmitter.subscribe("onCacheInvokeAfter",(function(e){var t=e.getCompatData(),s=babelHelpers.slicedToArray(t,2),i=s[0],n=s[1];if(n.items.length<=0){BX.frameCache.update(true,true)}}));BXMobileApp.addCustomEvent("onAfterEdit",(function(e){n.afterEdit({responseData:e.postResponseData,logId:e.postData.data.log_id})}));s.EventEmitter.subscribe("onPullDownDisable",(function(){BXMobileApp.UI.Page.Refresh.setEnabled(false)}));s.EventEmitter.subscribe("onPullDownEnable",(function(){BXMobileApp.UI.Page.Refresh.setEnabled(true)}));BXMobileApp.UI.Page.Refresh.setParams({callback:function e(){if(!n.isPullDownLocked){Q.refresh(true)}},backgroundColor:"#E7E9EB"});BXMobileApp.UI.Page.Refresh.setEnabled(true)}},{key:"setPageId",value:function e(t){this.pageId=t}},{key:"getPageId",value:function e(){return this.pageId}},{key:"setLogId",value:function e(t){this.logId=parseInt(t)}},{key:"getLogId",value:function e(){return parseInt(this.logId)}},{key:"setOptions",value:function e(t){for(var s in t){if(!t.hasOwnProperty(s)){continue}this.options[s]=t[s]}}},{key:"getOption",value:function e(s,i){if(t.Type.isUndefined(i)){i=null}if(!t.Type.isStringFilled(s)){return null}return!t.Type.isUndefined(this.options[s])?this.options[s]:i}},{key:"setRefreshNeeded",value:function e(t){this.refreshNeeded=t}},{key:"getRefreshNeeded",value:function e(){return this.refreshNeeded}},{key:"setRefreshStarted",value:function e(t){this.refreshStarted=t}},{key:"getRefreshStarted",value:function e(){return this.refreshStarted}},{key:"setNewPostContainer",value:function e(t){this.newPostContainer=t}},{key:"getNewPostContainer",value:function e(){return this.newPostContainer}},{key:"setMaxScroll",value:function e(t){this.maxScroll=t}},{key:"getMaxScroll",value:function e(){return this.maxScroll}},{key:"afterPostAdd",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}var i=typeof s.postId!="undefined"?parseInt(s.postId):0;var n=typeof s.context!="undefined"?s.context:"";var a=typeof s.pageId!="undefined"?s.pageId:"";var o=typeof s.groupId!="undefined"?s.groupId:null;if(a!==this.pageId){return}x["delete"](o);if(i<=0||t.Type.isStringFilled(s.warningText)){return}this.getEntryContent({entityType:"BLOG_POST",entityId:i,queueKey:s.key,action:"add"})}},{key:"afterPostUpdate",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}var i=typeof s.context!="undefined"?s.context:"";var n=typeof s.pageId!="undefined"?s.pageId:"";var a=typeof s.postId!="undefined"?parseInt(s.postId):0;var o=typeof s.pinned!="undefined"&&!!s.pinned;this.getEntryContent({entityType:"BLOG_POST",entityId:a,queueKey:s.key,action:"update",pinned:o})}},{key:"afterPostAddError",value:function e(s){var i=this;if(!t.Type.isPlainObject(s)){s={}}var n=t.Type.isStringFilled(s.context)?s.context:"";var a=s.groupId?s.groupId:"";var o={a_users:[],b_groups:[]};oMSL.buildSelectedDestinations(s.postData,o);V.setParams({selectedRecipients:o});V.setParams({messageText:s.postData.POST_MESSAGE});x.save(s.postData,a);s.callback=function(){if(BXMobileAppContext.getApiVersion()>=i.getApiVersion("layoutPostForm")){H.show({pageId:i.getPageId(),postId:0})}else{app.exec("showPostForm",V.show())}};this.showPostError(s)}},{key:"afterPostUpdateError",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}var i=t.Type.isStringFilled(s.context)?s.context:"";s.callback=function(){p.edit({postId:parseInt(s.postId)})};this.showPostError(s)}},{key:"showPostError",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}s.callback=t.Type.isFunction(s.callback)?s.callback:function(){};var i=t.Type.isStringFilled(s.errorText)?s.errorText:false;F.showError({text:i?i:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_PUBLICATION_ERROR"),onTap:function e(t){s.callback(t)}})}},{key:"showLoader",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}if(s.pageId&&this.pageId!==null&&s.pageId!=this.pageId){return}app.showPopupLoader({text:t.Type.isStringFilled(s.text)?s.text:""})}},{key:"hideLoader",value:function e(){app.hidePopupLoader()}},{key:"scrollTop",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}if(s.pageId&&this.pageId!==null&&s.pageId!=this.pageId){return}window.scrollTo(0,0)}},{key:"getEntryContent",value:function e(s){var i=this;if(!t.Type.isPlainObject(s)){s={}}var a=s.logId?parseInt(s.logId):0;if(a<=0&&!(t.Type.isStringFilled(s.entityType)&&parseInt(s.entityId)>0)){return}n.Ajax.runComponentAction("bitrix:mobile.socialnetwork.log.ex","getEntryContent",{mode:"class",signedParameters:this.getOption("signedParameters",{}),data:{params:{logId:parseInt(s.logId)>0?parseInt(s.logId):0,pinned:!!s.pinned?"Y":"N",entityType:t.Type.isStringFilled(s.entityType)?s.entityType:"",entityId:parseInt(s.entityId)>0?parseInt(s.entityId):0,siteTemplateId:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_TEMPLATE_ID")}}}).then((function(e){if(a<=0){n.Ajax.runComponentAction("bitrix:mobile.socialnetwork.log.ex","getEntryLogId",{mode:"class",data:{params:{entityType:t.Type.isStringFilled(s.entityType)?s.entityType:"",entityId:parseInt(s.entityId)>0?parseInt(s.entityId):0}}}).then((function(t){if(t.data.logId){i.insertPost({logId:t.data.logId,content:e.data.html,postId:s.postId,queueKey:s.queueKey,action:s.action,serverTimestamp:parseInt(e.data.componentResult.serverTimestamp)})}}))}else{i.insertPost({logId:a,content:e.data.html,postId:s.postId,queueKey:s.queueKey,action:s.action,serverTimestamp:parseInt(e.data.componentResult.serverTimestamp)})}}))}},{key:"processDetailBlock",value:function e(s,i,n){if(!s||!i){return Promise.reject()}var a=i.querySelector(n);var o=s.querySelector(n);if(o&&a){return t.Runtime.html(o,a.innerHTML)}return Promise.reject()}},{key:"insertPost",value:function e(n){var a=this;var o=document.getElementById(this.nodeId.feedContainer);var r=n.content;var l=n.logId;var c=n.queueKey;var d=n.action;if(!t.Type.isDomNode(o)||!t.Type.isStringFilled(r)){return}var u=typeof n.serverTimestamp!="undefined"&&parseInt(n.serverTimestamp)>0?parseInt(n.serverTimestamp):0;if(d==="update"){var p=document.getElementById("lenta_item_"+l);if(!p){p=document.getElementById("lenta_item")}if(!p){return}var f=this.pageId.match(/^detail_(\d+)/i);if(f&&l!=f[1]){return}var m=p.appendChild(document.createElement("div"));m.style.display="none";t.Runtime.html(m,r);if(p.id==="lenta_item"){this.processDetailBlock(p,m,".".concat(this["class"].postItemTop));this.processDetailBlock(p,m,".".concat(this["class"].postItemPostBlock)).then((function(){var e=p.querySelector(".".concat(a["class"].postItemPostBlock));var t=m.querySelector(".".concat(a["class"].postItemPostBlock));if(e||t){var s=a.filterPostBlockClassList(e.classList);var i=a.filterPostBlockClassList(t.classList);s.forEach((function(t){e.classList.remove(t)}));i.forEach((function(t){e.classList.add(t)}))}BitrixMobile.LazyLoad.showImages()}));this.processDetailBlock(p,m,".".concat(this["class"].postItemAttachedFileWrap)).then((function(){BitrixMobile.LazyLoad.showImages()}));this.processDetailBlock(p,m,".".concat(this["class"].postItemInformWrap));this.processDetailBlock(p,m,".".concat(this["class"].postItemInformWrapTree))}else{p=p.querySelector("div.".concat(this["class"].postItemTopWrap));var h=m.querySelector("div.".concat(this["class"].postItemTopWrap));t.Runtime.html(p,h.innerHTML).then((function(){oMSL.checkNodesHeight();BitrixMobile.LazyLoad.showImages();if(document.getElementById("framecache-block-feed")){setTimeout((function(){a.updateFrameCache({timestamp:u})}),750)}}))}m.remove()}else if(d==="add"){this.setNewPostContainer(t.Tag.render(B||(B=babelHelpers.taggedTemplateLiteral(['<div class="'," ",'" ontransitionend="','"></div>'])),this["class"].postNewContainerTransformNew,this["class"].postLazyLoadCheck,this.handleInsertPostTransitionEnd.bind(this)));t.Dom.prepend(this.getNewPostContainer(),o);i.Utils.htmlWithInlineJS(this.getNewPostContainer(),r).then((function(){var e=a.getNewPostContainer().querySelector("div.".concat(a["class"].listPost));t.Dom.style(a.getNewPostContainer(),"height","".concat(e.scrollHeight+12,"px"));if(u>0){a.setOptions({frameCacheTs:u})}oMSL.registerBlocksToCheck();setTimeout((function(){oMSL.checkNodesHeight()}),100);setTimeout((function(){a.updateFrameCache({timestamp:u})}),750)}))}R.emit("onPostInserted",new s.BaseEvent({data:{key:c}}))}},{key:"removePost",value:function e(t){var s=parseInt(t.logId);if(s<=0){return}var i=document.getElementById("lenta_item_"+s);if(!i){return}i.remove()}},{key:"filterPostBlockClassList",value:function e(t){var s=[];Array.from(t).forEach((function(e){if(e==="info-block-background"||e==="info-block-background-with-title"||e==="info-block-gratitude"||e==="info-block-important"||e==="ui-livefeed-background"||e.match(/info-block-gratitude-(.+)/i)||e.match(/ui-livefeed-background-(.+)/i)){s.push(e)}}));return s}},{key:"handleInsertPostTransitionEnd",value:function e(s){if(s.propertyName==="height"){this.getNewPostContainer().classList.remove(this["class"].postNewContainerTransformNew);this.getNewPostContainer().classList.remove(this["class"].postNewContainerTransform);t.Dom.style(this.getNewPostContainer(),"height",null);this.recalcMaxScroll();BitrixMobile.LazyLoad.showImages()}}},{key:"onLazyLoadImageLoaded",value:function e(s){var i=this;this.recalcMaxScroll();var n=s.getData(),a=babelHelpers.slicedToArray(n,1),o=a[0];if(o){var r=o.closest(".".concat(this["class"].postLazyLoadCheck));if(r){var l=r.querySelector("div.".concat(this["class"].listPost));if(l){r.classList.add(this["class"].postNewContainerTransform);t.Dom.style(r,"height","".concat(l.scrollHeight,"px"));setTimeout((function(){r.classList.remove(i["class"].postNewContainerTransform);t.Dom.style(r,"height",null)}),500)}}}}},{key:"recalcMaxScroll",value:function e(){this.setMaxScroll(document.documentElement.scrollHeight-2*window.innerHeight)}},{key:"onMobileBizProcRenderLogMessages",value:function e(){this.recalcMaxScroll()}},{key:"onPinnedPanelChange",value:function e(s){var i=s.logId?parseInt(s.logId):0;var n=["Y","N"].indexOf(s.value)!==-1?s.value:null;if(!i||!n||!Y.getPinnedPanelNode()){return}var a=t.Type.isDomNode(s.postNode)?s.postNode:null;if(!t.Type.isDomNode(s.postNode)){a=document.getElementById("lenta_item_".concat(i))}if(!t.Type.isDomNode(a)){return}if(n==="N"){Y.extractEntry({logId:i,postNode:a,containerNode:document.getElementById(this.nodeId.feedContainer)})}else if(n==="Y"&&t.Type.isDomNode(s.postNode)){app.showPopupLoader({text:""});if(this.getOption("refreshFrameCacheNeeded",false)===true){return}var o=a.getAttribute("data-security-entity-pin");var r=a.getAttribute("data-security-token-pin");Y.getPinnedData({logId:i,entityValue:o,tokenValue:r}).then((function(e){app.hidePopupLoader();Y.insertEntry({logId:i,postNode:s.postNode,pinnedContent:e})}),(function(e){app.hidePopupLoader()}))}}},{key:"onPostPinChanged",value:function e(t){var s=t.logId?parseInt(t.logId):0;var i=["Y","N"].indexOf(t.value)!==-1?t.value:null;if(!s||!i){return}var n=document.getElementById("log-entry-menu-"+s);if(!n){return}var a=n.closest(".".concat(this["class"].detailPost));if(!a){a=n.closest(".".concat(this["class"].listPost))}if(!a){return}if(i==="Y"){a.classList.add(this["class"].postItemPinActive)}else{a.classList.remove(this["class"].postItemPinActive)}}},{key:"handleClick",value:function e(s){if(s.target.classList.contains(this["class"].pin)){var i=null;var n=null;var a="list";var o=s.target.closest(".".concat(this["class"].listPost));if(o){n=o.querySelector('[data-menu-type="post"]');i=this.getPostFromNode(o)}else{a="detail";o=s.target.closest(".".concat(this["class"].detailPost));if(o){n=o.querySelector('[data-menu-type="post"]');if(n){i=this.getPostFromLogId(n.getAttribute("data-log-id"))}}}if(i&&n){return i.setPinned({menuNode:n,context:a})}s.stopPropagation();return s.preventDefault()}else if(s.target.classList.contains(this["class"].addPostButton)){if(BXMobileAppContext.getApiVersion()>=this.getApiVersion("layoutPostForm")){var r=new h;r.show({pageId:this.getPageId(),groupId:this.getOption("groupId",0)})}else{app.exec("showPostForm",V.show())}}else if(s.target.classList.contains(".".concat(W["class"].scrollButton))||s.target.closest(".".concat(W["class"].scrollButton))){if(s.target.classList.contains(".".concat(W["class"].scrollButtonTop))||s.target.closest(".".concat(W["class"].scrollButtonTop))){W.scrollTo("top")}else if(s.target.classList.contains(".".concat(W["class"].scrollButtonBottom))||s.target.closest(".".concat(W["class"].scrollButtonBottom))){W.scrollTo("bottom")}}else if((s.target.closest(".".concat(this["class"].listWrapper))||s.target.closest(".".concat(this["class"].pinnedPanel)))&&!(s.target.tagName.toLowerCase()==="a"&&t.Type.isStringFilled(s.target.getAttribute("target"))&&s.target.getAttribute("target").toLowerCase()==="_blank")){var l=!!(s.target.classList.contains(this["class"].postItemPinnedBlock)||s.target.closest(".".concat(this["class"].postItemPinnedBlock)));var c=!!(!l&&(s.target.classList.contains(this["class"].postItemPostContentView)||s.target.closest(".".concat(this["class"].postItemPostContentView))||s.target.classList.contains(this["class"].postItemDescriptionBlock)||s.target.closest(".".concat(this["class"].postItemDescriptionBlock))));var d=!!(!l&&!c&&(s.target.classList.contains(this["class"].postItemInformComments)||s.target.closest(".".concat(this["class"].postItemInformComments))));var p=!!(!l&&!c&&!d&&(s.target.classList.contains(this["class"].postItemInformMore)||s.target.closest(".".concat(this["class"].postItemInformMore))));if(l||c||d||p){var f=s.target.closest(".".concat(this["class"].listPost));if(f){var m=this.getPostFromNode(f);if(m){m.openDetail({pathToEmptyPage:this.getOption("pathToEmptyPage",""),pathToCalendarEvent:this.getOption("pathToCalendarEvent",""),pathToTasksRouter:this.getOption("pathToTasksRouter",""),event:s,focusComments:d,showFull:p})}}s.stopPropagation();return s.preventDefault()}}else if(s.target.closest(".".concat(this["class"].postWrapper))){var g=!!(s.target.classList.contains(this["class"].postItemInformMore)||s.target.closest(".".concat(this["class"].postItemInformMore))||s.target.classList.contains(this["class"].postItemMore)||s.target.closest(".".concat(this["class"].postItemMore)));var E=null;if(s.target.classList.contains(this["class"].postItemGratitudeUsersSmallContainer)){E=s.target}else{E=s.target.closest(".".concat(this["class"].postItemGratitudeUsersSmallContainer))}if(g||t.Type.isDomNode(E)){if(t.Type.isDomNode(E)){E.style.display="none";var v=E.parentNode.querySelector(".".concat(this["class"].postItemGratitudeUsersSmallHidden));if(v){v.style.display="block"}}var I=this.getOption("logId",0);var T=new u({logId:I});T.expandText();s.stopPropagation();return s.preventDefault()}var y=null;if(s.target.classList.contains(this["class"].postItemImportantUserList)){y=s.target}else{y=s.target.closest(".".concat(this["class"].postItemImportantUserList))}if(y){var b=y.parentNode.querySelector("input");var L=0;if(t.Type.isDomNode(b)){L=parseInt(b.getAttribute("bx-data-post-id"))}if(L>0){app.exec("openComponent",{name:"JSStackComponent",componentCode:"livefeed.important.list",scriptPath:"/mobileapp/jn/livefeed.important.list/?version=1.0.0",params:{POST_ID:L,SETTINGS:this.getOption("importantData",{})},rootWidget:{name:"list",settings:{objectName:"livefeedImportantListWidget",title:BX.message("MOBILE_EXT_LIVEFEED_USERS_LIST_TITLE"),modal:false,backdrop:{mediumPositionPercent:75}}}},false)}}}}},{key:"getPostFromNode",value:function e(s){if(!t.Type.isDomNode(s)){return}var i=parseInt(s.getAttribute("data-livefeed-id"));if(i<=0){return}return new u({logId:i,entryType:s.getAttribute("data-livefeed-post-entry-type"),useFollow:s.getAttribute("data-livefeed-post-use-follow")==="Y",useTasks:s.getAttribute("data-livefeed-post-use-tasks")==="Y",perm:s.getAttribute("data-livefeed-post-perm"),destinations:s.getAttribute("data-livefeed-post-destinations"),postId:parseInt(s.getAttribute("data-livefeed-post-id")),url:s.getAttribute("data-livefeed-post-url"),entityXmlId:s.getAttribute("data-livefeed-post-entity-xml-id"),readOnly:s.getAttribute("data-livefeed-post-read-only")==="Y",contentTypeId:s.getAttribute("data-livefeed-post-content-type-id"),contentId:s.getAttribute("data-livefeed-post-content-id"),showFull:s.getAttribute("data-livefeed-post-show-full")==="Y",taskId:parseInt(s.getAttribute("data-livefeed-task-id")),taskData:s.getAttribute("data-livefeed-task-data"),calendarEventId:parseInt(s.getAttribute("data-livefeed-calendar-event-id"))})}},{key:"getPostFromLogId",value:function e(t){var s=null;t=parseInt(t);if(t<=0){return s}s=new u({logId:t});return s}},{key:"updateFrameCache",value:function e(s){var i=document.getElementById("framecache-block-feed");if(!t.Type.isDomNode(i)){i=document.getElementById("bxdynamic_feed_refresh")}if(!t.Type.isDomNode(i)){return}var n={USE_BROWSER_STORAGE:true,AUTO_UPDATE:true,USE_ANIMATION:false};var a=typeof s.timestamp!="undefined"?parseInt(s.timestamp):0;if(a>0){n.TS=a}BX.frameCache.writeCacheWithID("framecache-block-feed",i.innerHTML,parseInt(Math.random()*1e5),JSON.stringify(n))}},{key:"onMobilePlayerError",value:function e(s){var i=s.getData(),n=babelHelpers.slicedToArray(i,2),a=n[0],o=n[1];if(!t.Type.isDomNode(a)){return}if(!t.Type.isStringFilled(o)){return}var r=a.parentNode;if(r){if(r.querySelector(".disk-mobile-player-error-container")){return}}else{if(a.querySelector(".disk-mobile-player-error-container")){return}}var l=a.getElementsByTagName("source");var c=l.length;Array.from(l).forEach((function(e){if(t.Type.isStringFilled(e.src)&&e.src===o){t.Dom.remove(e);c--}}));if(c>0){return}var d=t.Dom.create("div",{props:{className:"disk-mobile-player-error-container"},children:[t.Dom.create("div",{props:{className:"disk-mobile-player-error-icon"},html:""}),t.Dom.create("div",{props:{className:"disk-mobile-player-error-message"},html:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_PLAYER_ERROR_MESSAGE")})]});var u=d.querySelector(".disk-mobile-player-download");if(u){t.Dom.adjust(u,{events:{click:function e(){app.openDocument({url:o})}}})}if(r){a.style.display="none";r.appendChild(d)}else{t.Dom.adjust(a,{children:[d]})}}},{key:"getApiVersion",value:function e(t){var s=0;switch(t){case"layoutPostForm":s=37;break;case"pageMenu":s=34;break;case"tabs":s=41;break;default:}return s}},{key:"sendErrorEval",value:function e(t){BX.evalGlobal("try { "+t+" } catch (e) { this.sendError(e.message, e.name, e.number); }")}},{key:"sendError",value:function e(t,s,i){n.Ajax.runAction("socialnetwork.api.livefeed.mobileLogError",{data:{message:t,url:s,lineNumber:i}}).then((function(e){}),(function(e){}))}},{key:"setLastActivityDate",value:function e(){this.lastActivityDate=Math.round((new Date).getTime()/1e3)}},{key:"getLastActivityDate",value:function e(){return this.lastActivityDate}},{key:"afterEdit",value:function e(s){var i=s.responseData,n=s.logId;n=!t.Type.isUndefined(n)?parseInt(n):0;var a=t.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(["<div>","</div>"])),i.text);var o=document.getElementById("blog-post-first-after");if(o){o.parentNode.insertBefore(a,o.nextSibling)}var r=a.querySelector(".post-item-post-block");var l=a.querySelector(".post-item-top");var c=a.querySelector(".post-item-attached-file-wrap");if(n>0&&r&&l){var d={detailText:r.innerHTML,topText:l.innerHTML,logID:n};if(c){d.filesBlockText=c.innerHTML}BXMobileApp.onCustomEvent("onEditedPostInserted",d,true,true)}BitrixMobile.LazyLoad.showImages()}}]);return e}();var N=new A;var w=new a;var O=new o;var F=new r;var x=new l;var R=new d;var U=new f;var X=new m;var H=new h;var V=new g;var Y=new v;var j=new I;var G=new T;var q=new y;var W=new b;var z=new L;var K=new D;var Q=new k;e.Post=u;e.BlogPost=p;e.Instance=N;e.BalloonNotifierInstance=w;e.NextPageLoaderInstance=O;e.NotificationBarInstance=F;e.DatabaseUnsentPostInstance=x;e.PublicationQueueInstance=R;e.PostMenuInstance=U;e.PageMenuInstance=X;e.PostFormManagerInstance=H;e.PostFormOldManagerInstance=V;e.PinnedPanelInstance=Y;e.RatingInstance=j;e.ImportantManagerInstance=G;e.SearchBarInstance=q;e.PageScrollInstance=W;e.FollowManagerInstance=z;e.CommentsInstance=K;e.PageInstance=Q})(this.BX.MobileLivefeed=this.BX.MobileLivefeed||{},BX,BX.Event,BX,BX.Mobile);
//# sourceMappingURL=livefeed.bundle.map.js