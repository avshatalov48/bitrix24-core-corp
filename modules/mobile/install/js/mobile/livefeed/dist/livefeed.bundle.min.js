this.BX=this.BX||{};(function(e,t,s,i,n,a){"use strict";var o=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.initialized=false;this.classes={show:"lenta-notifier-shown"};this.nodeIdList={notifier:"lenta_notifier",notifierCounter:"lenta_notifier_cnt",notifierCounterTitle:"lenta_notifier_cnt_title",refreshNeeded:"lenta_notifier_2",refreshError:"lenta_refresh_error",nextPageError:"lenta_nextpage_error"};this.init();i.EventEmitter.subscribe("onFrameDataProcessed",(function(){t.init()}))}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this.getNotifierNode();if(!t||this.initialized){return}this.initialized=true;this.initEvents()}},{key:"initEvents",value:function e(){var t=this.getNotifierNode();t.addEventListener("click",(function(){J.refresh(true);return false}));var s=this.getRefreshNeededNode();if(s){s.addEventListener("click",(function(){app.exec("pullDownLoadingStart");J.refresh(true);return false}))}var i=this.getRefreshErrorNode();if(i){i.addEventListener("click",(function(){J.requestError("refresh",false)}))}var n=this.getNextPageErrorNode();if(n){n.addEventListener("click",(function(){J.requestError("nextPage",false)}))}}},{key:"getNotifierNode",value:function e(){return document.getElementById(this.nodeIdList.notifier)}},{key:"getNotifierCounterNode",value:function e(){return document.getElementById(this.nodeIdList.notifierCounter)}},{key:"getNotifierCounterTitleNode",value:function e(){return document.getElementById(this.nodeIdList.notifierCounterTitle)}},{key:"getRefreshNeededNode",value:function e(){return document.getElementById(this.nodeIdList.refreshNeeded)}},{key:"getRefreshErrorNode",value:function e(){return document.getElementById(this.nodeIdList.refreshError)}},{key:"getNextPageErrorNode",value:function e(){return document.getElementById(this.nodeIdList.nextPageError)}},{key:"showRefreshNeededNotifier",value:function e(){var t=this.getRefreshNeededNode();if(t){t.classList.add(this.classes.show)}}},{key:"hideRefreshNeededNotifier",value:function e(){var t=this.getRefreshNeededNode();if(t){t.classList.remove(this.classes.show)}}},{key:"showNotifier",value:function e(t){var i=parseInt(t.counterValue);var n=i%100,a=i%10;var o="";if(n>=10&&n<15){o=3}else if(a==0){o=3}else if(a==1){o=1}else if(a==2||a==3||a==4){o=2}else{o=3}if(w.getRefreshNeeded()){this.getNotifierCounterNode().innerHTML=i?i+"+":"";this.hideRefreshNeededNotifier()}else{this.getNotifierCounterNode().innerHTML=i||""}this.getNotifierCounterTitleNode().innerHTML=s.Loc.getMessage("MOBILE_EXT_LIVEFEED_COUNTER_TITLE_"+o);this.getNotifierNode().classList.add(this.classes.show)}},{key:"hideNotifier",value:function e(){var t=this.getNotifierNode();if(t){t.classList.remove(this.classes.show)}}}]);return e}();var r=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.initialized=false;this.init();i.EventEmitter.subscribe("onFrameDataProcessed",(function(){t.init()}))}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this.getButtonNode();if(!t||this.initialized){return}this.initialized=true;this.initEvents()}},{key:"initEvents",value:function e(){var t=this.getButtonNode();t.addEventListener("click",(function(e){J.refresh(true);return false}))}},{key:"getButtonNode",value:function e(){return document.getElementById("next_page_refresh_needed_button")}},{key:"startWaiter",value:function e(){var t=this.getButtonNode();if(t){t.classList.add("--loading")}}},{key:"stopWaiter",value:function e(){var t=this.getButtonNode();if(t){t.classList.remove("--loading")}}}]);return e}();var l=function(){function e(){babelHelpers.classCallCheck(this,e);this.repo=[];this.color={background:{error:"#affb0000",info:"#3a3735"},text:{error:"#ffffff",info:"#ffffff"}}}babelHelpers.createClass(e,[{key:"hideAll",value:function e(){this.repo=this.repo.filter((function(e){return e}));this.repo.forEach((function(e){e.hide()}))}},{key:"showError",value:function e(t){var s=new BXMobileApp.UI.NotificationBar({message:t.text?t.text:"",color:this.color.background.error,textColor:this.color.text.error,useLoader:t.useLoader?!!t.useLoader:false,groupId:t.groupId?t.groupId:"",align:t.textAlign?t.textAlign:"center",autoHideTimeout:t.autoHideTimeout?t.autoHideTimeout:3e4,hideOnTap:t.hideOnTap?!!t.hideOnTap:true,onTap:t.onTap?t.onTap:function(){}},t.id?t.id:parseInt(Math.random()*1e5));this.repo.push(s);s.show()}},{key:"showInfo",value:function e(t){var s=new BXMobileApp.UI.NotificationBar({message:t.text?t.text:"",color:this.color.background.info,textColor:this.color.text.info,useLoader:t.useLoader?!!t.useLoader:false,groupId:t.groupId?t.groupId:"",maxLines:t.maxLines?t.maxLines:false,align:t.textAlign?t.textAlign:"center",isGlobal:t.isGlobal?!!t.isGlobal:true,useCloseButton:t.useCloseButton?!!t.useCloseButton:true,autoHideTimeout:t.autoHideTimeout?t.autoHideTimeout:1e3,hideOnTap:t.hideOnTap?!!t.hideOnTap:true},t.id?t.id:parseInt(Math.random()*1e5));this.repo.push(s);s.show()}}]);return e}();var c=function(){function e(t){babelHelpers.classCallCheck(this,e);this.tableName=null;this.keyName=null;this.setTableName(s.Type.isPlainObject(t)&&s.Type.isStringFilled(t.tableName)?t.tableName:"livefeed");this.setKeyName(s.Type.isPlainObject(t)&&s.Type.isStringFilled(t.keyName)?t.keyName:"postUnsent");this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){BXMobileApp.addCustomEvent("Livefeed.Database::clear",this.onClear.bind(this))}},{key:"setTableName",value:function e(t){this.tableName=t}},{key:"getTableName",value:function e(){return this.tableName}},{key:"setKeyName",value:function e(t){this.keyName=t}},{key:"getKeyName",value:function e(){return this.keyName}},{key:"onClear",value:function e(t){this["delete"](t.groupId)}},{key:"delete",value:function e(t){if(parseInt(t)<=0){t=false}app.exec("setStorageValue",{storageId:this.getTableName(),key:this.getKeyName()+(t?"_"+t:""),value:{},callback:function e(t){}})}},{key:"save",value:function e(t,s){if(parseInt(s)<=0){s=false}for(var i in t){if(!t.hasOwnProperty(i)){continue}if(i==="sessid"){delete t[i];break}}app.exec("setStorageValue",{storageId:this.getTableName(),key:this.getKeyName()+(s?"_"+s:""),value:t,callback:function e(t){}})}},{key:"load",value:function e(t,i){if(parseInt(i)<=0){i=false}app.exec("getStorageValue",{storageId:this.getTableName(),key:this.getKeyName()+(i?"_"+i:""),callback:function e(i){i=s.Type.isPlainObject(i)?i:s.Type.isStringFilled(i)?JSON.parse(i):{};if(s.Type.isPlainObject(i)&&Object.keys(i).length>0){t.onLoad(i)}else{t.onEmpty()}}})}}]);return e}();var d;var u=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));e.repo={};e.nodeId={container:"post-balloon-container"};e["class"]={balloonHidden:"post-balloon-hidden",balloonFixed:"post-balloon-box-fixed",balloonPublished:"post-balloon-done",balloonShow:"post-balloon-show",balloonHide:"post-balloon-hide"};e.timeout={show:750};e.init();return e}babelHelpers.createClass(t,[{key:"init",value:function e(){BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterSetItem",this.afterSetItem.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAdd",this.afterPostAdd.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAddError",this.afterPostAddError.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdate",this.afterPostUpdate.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdateError",this.afterPostUpdateError.bind(this));this.setEventNamespace("BX.Mobile.Livefeed");this.subscribe("onFeedReady",this.onFeedLoaded.bind(this));this.subscribe("onPostInserted",this.onPostInserted.bind(this));s.Event.bind(document,"scroll",this.onScroll.bind(this))}},{key:"onScroll",value:function e(){var t=document.getElementById(this.nodeId.container);if(!s.Type.isDomNode(t)){return}if(window.pageYOffset>0){t.classList.add(this["class"].balloonFixed)}else{t.classList.remove(this["class"].balloonFixed)}}},{key:"onFeedLoaded",value:function e(){var t=this;app.exec("getStorageValue",{storageId:"livefeed",key:"publicationQueue",callback:function e(i){i=s.Type.isPlainObject(i)?i:s.Type.isStringFilled(i)?JSON.parse(i):{};if(!s.Type.isPlainObject(i)){return}for(var n in i){if(!i.hasOwnProperty(n)){continue}t.addToTray(n,{})}t.drawList()}})}},{key:"onPostInserted",value:function e(t){this.removeFromTray(t.data.key)}},{key:"addToTray",value:function e(t,s){this.repo[t]=s;this.repo[t].node=this.drawItem();this.repo[t].node.classList.add(this["class"].balloonShow)}},{key:"removeFromTray",value:function e(t,s){var i=this;this.hideItem(t);setTimeout((function(){if(i.repo[t]){delete i.repo[t]}}),3e3)}},{key:"addSuccess",value:function e(t,i){var n=this;if(this.repo[t]&&this.repo[t].node){this.repo[t].node.classList.remove(this["class"].balloonHidden);this.repo[t].node.classList.remove(this["class"].balloonShow);this.repo[t].node.classList.add(this["class"].balloonPublished);this.repo[t].node.lastElementChild.innerHTML=s.Type.isStringFilled(i)?i:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_PUBLICATION_QUEUE_SUCCESS_TITLE")}setTimeout((function(){n.removeFromTray(t)}),5e3)}},{key:"drawItem",value:function e(){var t=s.Loc.getMessage("MOBILE_EXT_LIVEFEED_PUBLICATION_QUEUE_ITEM_TITLE");return s.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="post-balloon-hidden post-balloon post-balloon-active"><span class="post-balloon-icon"></span><span class="post-balloon-text">',"</span></div>\n\t\t\t"])),t)}},{key:"hideItem",value:function e(t,s){if(this.repo[t]){this.repo[t].node.classList.add(this["class"].balloonHide)}}},{key:"drawList",value:function e(){var t=document.getElementById(this.nodeId.container);if(!s.Type.isDomNode(t)){return}s.Dom.clean(t);for(var i in this.repo){if(!this.repo.hasOwnProperty(i)||!s.Type.isDomNode(this.repo[i].node)){continue}s.Dom.append(this.repo[i].node,t)}}},{key:"afterSetItem",value:function e(t){var i=this;var n=t.key?t.key:"",a=t.pageId?t.pageId:"",o=t.contentType?t.contentType:"";if(a!=w.getPageId()||!n||!s.Type.isStringFilled(o)){return}if(o=="post"){this.addToTray(n,{key:n});setTimeout((function(){i.drawList()}),this.timeout.show)}}},{key:"afterPostAdd",value:function e(t){if(!s.Type.isPlainObject(t)){t={}}this.addSuccess(t.key?t.key:"",t.warningText);this.drawList()}},{key:"afterPostUpdate",value:function e(t){if(!s.Type.isPlainObject(t)){t={}}this.addSuccess(t.key?t.key:"");this.drawList()}},{key:"afterPostAddError",value:function e(t){if(!s.Type.isPlainObject(t)){t={}}var i=t.key?t.key:"";this.removeFromTray(i,{key:i});this.drawList()}},{key:"afterPostUpdateError",value:function e(t){if(!s.Type.isPlainObject(t)){t={}}var i=t.key?t.key:"";this.removeFromTray(i,{key:i});this.drawList()}}]);return t}(i.EventEmitter);var p=function(){babelHelpers.createClass(e,null,[{key:"moveBottom",value:function e(){window.scrollTo(0,document.body.scrollHeight)}},{key:"moveTop",value:function e(){window.scrollTo(0,0)}}]);function e(t){babelHelpers.classCallCheck(this,e);this.logId=0;this.entryType="";this.useFollow=false;this.useTasks=false;this.perm="";this.destinations={};this.postId=0;this.url="";this.entityXmlId="";this.readOnly=false;this.contentTypeId="";this.contentId=0;this.showFull=false;this.taskId=0;this.taskData=null;this.calendarEventId=0;this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){var i=t.logId,n=t.entryType,a=t.useFollow,o=t.useTasks,r=t.perm,l=t.destinations,c=t.postId,d=t.url,u=t.entityXmlId,p=t.readOnly,f=t.contentTypeId,m=t.contentId,h=t.showFull,g=t.taskId,E=t.taskData,v=t.calendarEventId;i=parseInt(i);if(i<=0){return}this.logId=i;this.postId=parseInt(c);this.contentId=parseInt(m);this.taskId=parseInt(g);this.calendarEventId=parseInt(v);this.useFollow=!!a;this.useTasks=!!o;this.readOnly=!!p;this.showFull=!!h;if(s.Type.isStringFilled(n)){this.entryType=n}if(s.Type.isStringFilled(r)){this.perm=r}if(s.Type.isStringFilled(d)){this.url=d}if(s.Type.isStringFilled(u)){this.entityXmlId=u}if(s.Type.isStringFilled(f)){this.contentTypeId=f}if(s.Type.isStringFilled(E)){try{this.taskData=JSON.parse(E)}catch(e){this.taskData=null}}if(s.Type.isPlainObject(l)){this.destinations=l}}},{key:"setFavorites",value:function e(t){var i=this;if(this.logId<=0){return}var n=t.node,o=t.event;if(!s.Type.isDomNode(n)){n=document.getElementById("log_entry_favorites_"+this.logId)}if(s.Type.isDomNode(n)){var r=n.getAttribute("data-favorites")==="Y"?"Y":"N";var l=r==="Y"?"N":"Y";if(n.classList.contains("lenta-item-fav")){if(r==="Y"){n.classList.remove("lenta-item-fav-active")}else{n.classList.add("lenta-item-fav-active")}}n.setAttribute("data-favorites",l);a.Ajax.runAction("socialnetwork.api.livefeed.changeFavorites",{data:{logId:this.logId,value:l},analyticsLabel:{b24statAction:l==="Y"?"addFavorites":"removeFavorites",b24statContext:"mobile"}}).then((function(e){if(e.data.success){if(l==="Y"){K.setFollow({logId:i.logId,bOnlyOn:true,bRunEvent:true,bAjax:false})}BXMobileApp.onCustomEvent("onLogEntryFavorites",{log_id:i.logId,page_id:s.Loc.getMessage("MSLPageId")},true)}else{n.setAttribute("data-favorites",r)}}),(function(){n.setAttribute("data-favorites",r)}))}if(o instanceof Event){o.preventDefault();o.stopPropagation()}}},{key:"setPinned",value:function e(t){var i=this;if(this.logId<=0){return}var n=t.menuNode,o=t.context;if(s.Type.isDomNode(n)){var r=n.getAttribute("data-pinned")==="Y"?"Y":"N";var l=r==="Y"?"N":"Y";n.setAttribute("data-pinned",l);BXMobileApp.onCustomEvent("Livefeed::showLoader",{},true,true);var c=l==="Y"?"socialnetwork.api.livefeed.logentry.pin":"socialnetwork.api.livefeed.logentry.unpin";a.Ajax.runAction(c,{data:{params:{logId:this.logId}},analyticsLabel:{b24statAction:l==="Y"?"pinLivefeedEntry":"unpinLivefeedEntry",b24statContext:"mobile"}}).then((function(e){BXMobileApp.onCustomEvent("Livefeed::hideLoader",{},true,true);if(e.data.success){BXMobileApp.onCustomEvent("Livefeed.PinnedPanel::change",{logId:i.logId,value:l,postNode:n.closest(".lenta-item"),pinActionContext:o},true,true);BXMobileApp.onCustomEvent("Livefeed.PostDetail::pinChanged",{logId:i.logId,value:l},true,true)}else{n.setAttribute("data-pinned",r)}}),(function(){BXMobileApp.onCustomEvent("Livefeed::hideLoader",{},true,true);n.setAttribute("data-pinned",r)}))}}},{key:"openDetail",value:function e(t){var i=t.pathToEmptyPage,n=t.pathToCalendarEvent,a=t.pathToTasksRouter,o=t.event,r=t.focusComments,l=t.showFull;if(!s.Type.isStringFilled(i)){return}if(this.taskId>0&&BXMobileAppContext.getApiVersion()>=31&&this.taskData){BXMobileApp.Events.postToComponent("taskbackground::task::open",[{id:this.taskId,taskId:this.taskId,title:"TASK",taskInfo:{title:this.taskData.title,creatorIcon:this.taskData.creatorIcon,responsibleIcon:this.taskData.responsibleIcon}},{taskId:this.taskId,getTaskInfo:true}])}else{var c=i;if(this.calendarEventId>0&&!r&&n.length>0){c=n.replace("#EVENT_ID#",this.calendarEventId)}else if(this.taskId>0&&this.taskData&&a.length>0){c=a.replace("__ROUTE_PAGE__","view").replace("#USER_ID#",s.Loc.getMessage("MOBILE_EXT_LIVEFEED_CURRENT_USER_ID"))+"&TASK_ID="+this.taskId}__MSLOpenLogEntryNew({path:c,log_id:this.logId,entry_type:this.entryType,use_follow:this.useFollow?"Y":"N",use_tasks:this.useTasks?"Y":"N",post_perm:this.perm,destinations:this.destinations,post_id:this.postId,post_url:this.url,entity_xml_id:this.entityXmlId,focus_comments:r,focus_form:false,show_full:this.showFull||l,read_only:this.readOnly?"Y":"N",post_content_type_id:this.contentTypeId,post_content_id:this.contentId},o)}}},{key:"initDetailPin",value:function e(){var t=document.getElementById("log-entry-menu-"+this.logId);if(!t){return}var s=t.closest(".post-wrap");if(!s){return}var i=t.getAttribute("data-pinned");if(i==="Y"){s.classList.add("lenta-item-pin-active")}else{s.classList.remove("lenta-item-pin-active")}}},{key:"expandText",value:function e(){oMSL.expandText(this.logId)}}]);return e}();var f=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"delete",value:function e(t){var i=s.Type.isStringFilled(t.context)?t.context:"list";var n=!s.Type.isUndefined(t.postId)?parseInt(t.postId):0;if(n<=0){return false}app.confirm({title:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_TITLE"),text:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_DESCRIPTION"),buttons:[s.Loc.getMessage("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_BUTTON_OK"),s.Loc.getMessage("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_BUTTON_CANCEL")],callback:function e(t){if(parseInt(t)!==1){return false}app.showPopupLoader({text:""});var o=s.Uri.addParam("".concat(s.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/ajax.php"),{b24statAction:"deleteBlogPost",b24statContext:"mobile"});a.Ajax.wrap({type:"json",method:"POST",url:o,data:{action:"delete_post",mobile_action:"delete_post",sessid:s.Loc.getMessage("bitrix_sessid"),site:s.Loc.getMessage("SITE_ID"),lang:s.Loc.getMessage("LANGUAGE_ID"),post_id:n},processData:true,callback:function e(t){app.hidePopupLoader();if(!s.Type.isStringFilled(t.SUCCESS)||t.SUCCESS!=="Y"){return}BXMobileApp.onCustomEvent("onBlogPostDelete",{},true,true);if(i==="detail"){app.closeController({drop:true})}},callback_failure:function e(){app.hidePopupLoader()}});return false}})}},{key:"edit",value:function e(t){var i=!s.Type.isUndefined(t.postId)?parseInt(t.postId):0;if(i<=0){return}var n=!s.Type.isUndefined(t.pinnedContext)?!!t.pinnedContext:false;if(Application.getApiVersion()>=w.getApiVersion("layoutPostForm")){V.show({pageId:w.getPageId(),postId:i})}else{this.getData({postId:i,callback:function e(t){Y.formParams={};if(!s.Type.isUndefined(t.PostPerm)&&t.PostPerm>="W"){var a={a_users:[],b_groups:[]};Y.setExtraDataArray({postId:i,postAuthorId:t.post_user_id,logId:t.log_id,pinnedContext:n});if(!s.Type.isUndefined(t.PostDetailText)){Y.setParams({messageText:t.PostDetailText})}if(s.Type.isPlainObject(t.PostDestination)){for(var o=0,r=Object.entries(t.PostDestination);o<r.length;o++){var l=babelHelpers.slicedToArray(r[o],2),c=l[0],d=l[1];if(s.Type.isStringFilled(t.PostDestination[c].STYLE)&&t.PostDestination[c].STYLE==="all-users"){Y.addDestination(a,{type:"UA"})}else if(s.Type.isStringFilled(t.PostDestination[c].TYPE)&&["U","SG"].includes(t.PostDestination[c].TYPE)){Y.addDestination(a,{type:t.PostDestination[c].TYPE,id:t.PostDestination[c].ID,name:s.Text.decode(t.PostDestination[c].TITLE)})}}}if(!s.Type.isUndefined(t.PostDestinationHidden)){Y.setExtraData({hiddenRecipients:t.PostDestinationHidden})}Y.setParams({selectedRecipients:a});if(!s.Type.isUndefined(t.PostFiles)){Y.setParams({messageFiles:t.PostFiles})}if(!s.Type.isUndefined(t.PostUFCode)){Y.setExtraData({messageUFCode:t.PostUFCode})}app.exec("showPostForm",Y.show())}}})}}},{key:"getData",value:function e(t){var i=!s.Type.isUndefined(t.postId)?parseInt(t.postId):0;if(i<=0){return}var n=s.Type.isFunction(t.callback)?t.callback:null;if(s.Type.isNull(n)){return}var o={};if(i>0){app.showPopupLoader();a.Ajax.wrap({type:"json",method:"POST",url:"".concat(s.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/ajax.php"),processData:true,data:{action:"get_blog_post_data",mobile_action:"get_blog_post_data",sessid:s.Loc.getMessage("bitrix_sessid"),site:s.Loc.getMessage("SITE_ID"),lang:s.Loc.getMessage("LANGUAGE_ID"),post_id:i,nt:s.Loc.getMessage("MSLNameTemplate"),sl:s.Loc.getMessage("MSLShowLogin")},callback:function e(t){app.hidePopupLoader();o.id=i;if(!s.Type.isUndefined(t.log_id)&&parseInt(t.log_id)>0){o.log_id=t.log_id}if(!s.Type.isUndefined(t.post_user_id)&&parseInt(t.post_user_id)>0){o.post_user_id=t.post_user_id}if(!s.Type.isUndefined(t.PostPerm)){o.PostPerm=t.PostPerm}if(!s.Type.isUndefined(t.PostDestination)){o.PostDestination=t.PostDestination}if(!s.Type.isUndefined(t.PostDestinationHidden)){o.PostDestinationHidden=t.PostDestinationHidden}if(!s.Type.isUndefined(t.PostDetailText)){o.PostDetailText=t.PostDetailText}if(s.Type.isUndefined(t.PostFiles)){o.PostFiles=t.PostFiles}if(!s.Type.isUndefined(t.PostBackgroundCode)){o.PostBackgroundCode=t.PostBackgroundCode}if(!s.Type.isUndefined(t.PostUFCode)){o.PostUFCode=t.PostUFCode}n(o)},callback_failure:function e(){app.hidePopupLoader()}})}}}]);return e}();var m=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.iconUrlFolderPath="/bitrix/templates/mobile_app/images/lenta/menu/";this.sectionCode="defaultSection";this.logId=parseInt(t.logId,10);this.postId=parseInt(t.postId,10);this.postPerms=s.Type.isStringFilled(t.postPerms)?t.postPerms:"R";this.pageId=t.pageId;this.contentTypeId=s.Type.isStringFilled(t.contentTypeId)?t.contentTypeId:null;this.contentId=s.Type.isInteger(t.contentId)?t.contentId:0;this.useShare=Boolean(t.useShare)&&this.postId>0;this.useFavorites=Boolean(t.useFavorites)&&this.logId>0;this.useFollow=Boolean(t.useFollow)&&this.logId>0;this.usePinned=Boolean(t.usePinned)&&this.logId>0;this.useTasks=s.Loc.getMessage("MOBILE_EXT_LIVEFEED_USE_TASKS")==="Y";this.useRefreshComments=Boolean(t.useRefreshComments);this.favoritesValue=Boolean(t.favoritesValue);this.followValue=Boolean(t.followValue);this.pinnedValue=Boolean(t.pinnedValue);this.target=s.Type.isDomNode(t.target)?t.target:null;this.context=s.Type.isStringFilled(t.context)?t.context:"list"}},{key:"getMenuItems",value:function e(){var i=this;var n=[];if(this.usePinned){n.push({id:"pinned",title:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_PINNED_".concat(this.pinnedValue?"Y":"N")),iconUrl:this.iconUrlFolderPath+(this.pinnedValue?"unpin.png":"pin.png"),sectionCode:this.sectionCode,action:function e(){var t=new p({logId:i.logId});return t.setPinned({menuNode:i.target,context:i.context})}})}if(this.useShare){var a={a_users:[],b_groups:[]};if(a.a_users.length>0||a.b_groups.length>0){n.push({id:"sharePost",title:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_SHARE"),iconName:"add",iconUrl:"".concat(this.iconUrlFolderPath,"n_plus.png"),sectionCode:this.sectionCode,action:function e(){app.openTable({callback:function e(){oMSL.shareBlogPost()},url:"".concat(s.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/index.php?mobile_action=").concat(s.Loc.getMessage("MOBILE_EXT_LIVEFEED_CURRENT_EXTRANET_SITE")==="Y"?"get_group_list":"get_usergroup_list","&feature=blog"),markmode:true,multiple:true,return_full_mode:true,user_all:true,showtitle:true,modal:true,selected:a,alphabet_index:true,okname:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_SHARE_TABLE_BUTTON_OK"),cancelname:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_SHARE_TABLE_BUTTON_CANCEL"),outsection:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DENIED")!=="Y"})},arrowFlag:false})}}if(this.postId>0&&this.postPerms==="W"){n.push({id:"edit",title:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_EDIT"),iconUrl:"".concat(this.iconUrlFolderPath,"pencil.png"),sectionCode:this.sectionCode,action:function e(){f.edit({feedId:window.LiveFeedID,postId:i.postId,pinnedContext:Boolean(i.pinnedValue)})},arrowFlag:false,feature:"edit"},{id:"delete",title:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_DELETE"),iconName:"delete",sectionCode:this.sectionCode,action:function e(){f["delete"]({postId:i.postId,context:i.context})},arrowFlag:false})}if(this.useFavorites){n.push({id:"favorites",title:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_FAVORITES_".concat(this.favoritesValue?"Y":"N")),iconUrl:"".concat(this.iconUrlFolderPath,"favorite.png"),sectionCode:this.sectionCode,action:function e(){var t=new p({logId:i.logId});return t.setFavorites({node:i.target})},arrowFlag:false,feature:"favorites"})}if(this.useFollow){n.push({id:"follow",title:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_".concat(this.followValue?"Y":"N")),iconUrl:"".concat(this.iconUrlFolderPath,"eye.png"),sectionCode:this.sectionCode,action:function e(){K.setFollow({logId:i.logId,menuNode:i.target,pageId:i.pageId,bOnlyOn:false,bAjax:true,bRunEvent:true})},arrowFlag:false})}if(this.useRefreshComments){n.push({id:"refreshPostComments",title:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_REFRESH_COMMENTS"),iconUrl:"".concat(this.iconUrlFolderPath,"n_refresh.png"),action:function e(){if(oMSL.bDetailEmptyPage){Q.getComments({ts:oMSL.iDetailTs,bPullDown:true,obFocus:{form:false}})}else{document.location.reload(true)}},arrowFlag:false})}if(s.Type.isStringFilled(this.contentTypeId)&&this.contentId>0){n.push({id:"getPostLink",title:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_GET_LINK"),iconUrl:"".concat(this.iconUrlFolderPath,"link.png"),sectionCode:this.sectionCode,action:function e(){oMSL.copyPostLink({contentTypeId:i.contentTypeId,contentId:i.contentId})},arrowFlag:false});if(this.useTasks&&this.logId>0){n.push({id:"createTask",title:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_CREATE_TASK"),iconUrl:"".concat(this.iconUrlFolderPath,"n_check.png"),sectionCode:this.sectionCode,action:function e(){oMSL.createTask({entityType:i.contentTypeId,entityId:i.contentId,logId:i.logId});t.sendData({tool:"tasks",category:"task_operations",event:"task_create",type:"task",c_section:"feed",c_element:"create_button"});return false},arrowFlag:false})}}return n}}]);return e}();var h=function(){function e(){babelHelpers.classCallCheck(this,e);this.type="list";this.listPageMenuItems=[];this.detailPageMenuItems=[]}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.type=t.type==="detail"?"detail":"list";var i=this.getPageMenuItems();var n=this.type==="detail"?s.Type.isStringFilled(s.Loc.getMessage("MSLLogEntryTitle"))?s.Loc.getMessage("MSLLogEntryTitle"):"":s.Type.isStringFilled(s.Loc.getMessage("MSLLogTitle"))?s.Loc.getMessage("MSLLogTitle"):"";if(i.length>0){if(BXMobileAppContext.getApiVersion()>=w.getApiVersion("pageMenu")){this.initPagePopupMenu()}else{app.menuCreate({items:i});BXMobileApp.UI.Page.TopBar.title.setCallback((function(){app.menuShow()}))}}else if(BXMobileAppContext.getApiVersion()<w.getApiVersion("pageMenu")){BXMobileApp.UI.Page.TopBar.title.setCallback("")}BXMobileApp.UI.Page.TopBar.title.setText(n);BXMobileApp.UI.Page.TopBar.title.show()}},{key:"initPagePopupMenu",value:function e(){var t=this;if(BXMobileAppContext.getApiVersion()<w.getApiVersion("pageMenu")){return}var s=[];if(!oMSL.logId){s.push({type:"search",callback:function e(){app.exec("showSearchBar")}})}var i=this.getPageMenuItems(this.type);if(BX.type.isArray(i)&&i.length>0){s.push({type:"more",callback:function e(){t.showPageMenu(t.type)}})}app.exec("setRightButtons",{items:s})}},{key:"showPageMenu",value:function e(){if(this.type==="detail"){this.detailPageMenuItems=this.buildDetailPageMenu(oMSL.menuData)}var t=this.getPageMenuItems();if(t.length<=0){return}var i=[];var n={};t.forEach((function(e){i.push({id:e.id,title:e.name,iconUrl:s.Type.isStringFilled(e.image)?e.image:"",iconName:s.Type.isStringFilled(e.iconName)?e.iconName:"",sectionCode:"defaultSection"});n[e.id]=e.action}));app.exec("setPopupMenuData",{items:i,sections:[{id:"defaultSection"}],callback:function e(t){if(t.eventName==="onDataSet"){app.exec("showPopupMenu")}else if(t.eventName==="onItemSelected"&&s.Type.isPlainObject(t.item)&&s.Type.isStringFilled(t.item.id)&&s.Type.isFunction(n[t.item.id])){n[t.item.id]()}}})}},{key:"getPageMenuItems",value:function e(){return this.type==="detail"?this.detailPageMenuItems:this.listPageMenuItems}},{key:"buildDetailPageMenu",value:function e(t){var s=null;if(BXMobileAppContext.getApiVersion()>=w.getApiVersion("pageMenu")){s=document.getElementById("log-entry-menu-".concat(w.getLogId()))}X.init({logId:w.getLogId(),postId:parseInt(t.post_id),postPerms:t.post_perm,useShare:t.entry_type==="blog",useFavorites:s&&s.getAttribute("data-use-favorites")==="Y",useFollow:t.read_only!=="Y",usePinned:w.getLogId()>0,useRefreshComments:true,favoritesValue:s&&s.getAttribute("data-favorites")==="Y",followValue:K.getFollowValue(),pinnedValue:s&&s.getAttribute("data-pinned")==="Y",contentTypeId:t.post_content_type_id,contentId:parseInt(t.post_content_id),target:s,context:"detail"});return X.getMenuItems().map((function(e){e.name=e.title;e.image=e.iconUrl;delete e.title;delete e.iconUrl;return e}))}}]);return e}();var g=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"show",value:function e(t){var i=this;var n={type:t.type?t.type:"post",groupId:t.groupId?parseInt(t.groupId):0,postId:t.postId?parseInt(t.postId):0,pageId:s.Type.isStringFilled(t.pageId)?t.pageId:""};this.getDatabaseData(n).then((function(e){return i.getWorkgroupData(e)})).then((function(e){return i.getPostData(e)})).then((function(e){return i.processPostData(e)})).then((function(e){app.exec("openComponent",{name:"JSStackComponent",componentCode:"livefeed.postform",scriptPath:BX.message("MOBILE_EXT_LIVEFEED_COMPONENT_URL"),params:{SERVER_NAME:BX.message("MOBILE_EXT_LIVEFEED_SERVER_NAME"),DESTINATION_LIST:w.getOption("destinationList",{}),DESTINATION_TO_ALL_DENY:w.getOption("destinationToAllDeny",false),DESTINATION_TO_ALL_DEFAULT:w.getOption("destinationToAllDefault",true),MODULE_DISK_INSTALLED:BX.message("MOBILE_EXT_LIVEFEED_DISK_INSTALLED")=="Y"?"Y":"N",MODULE_WEBDAV_INSTALLED:BX.message("MOBILE_EXT_LIVEFEED_WEBDAV_INSTALLED")=="Y"?"Y":"N",MODULE_VOTE_INSTALLED:BX.message("MOBILE_EXT_LIVEFEED_VOTE_INSTALLED")=="Y"?"Y":"N",USE_IMPORTANT:BX.message("MOBILE_EXT_LIVEFEED_USE_IMPORTANT")==="N"?"N":"Y",FILE_ATTACH_PATH:BX.message("MOBILE_EXT_LIVEFEED_FILE_ATTACH_PATH"),BACKGROUND_IMAGES_DATA:w.getOption("backgroundImagesData",{}),BACKGROUND_COMMON:w.getOption("backgroundCommon",{}),MEDALS_LIST:w.getOption("medalsList",{}),IMPORTANT_DATA:w.getOption("importantData",{}),USER_FOLDER_FOR_SAVED_FILES:BX.message("MOBILE_EXT_UTILS_USER_FOLDER_FOR_SAVED_FILES"),MAX_UPLOAD_CHUNK_SIZE:BX.message("MOBILE_EXT_UTILS_MAX_UPLOAD_CHUNK_SIZE"),POST_FILE_UF_CODE:BX.message("MOBILE_EXT_LIVEFEED_POST_FILE_UF_CODE"),POST_FORM_DATA:w.getOption("postFormData",{}),POST_DATA:e,DEVICE_WIDTH:BX.message("MOBILE_EXT_LIVEFEED_DEVICE_WIDTH"),DEVICE_HEIGHT:BX.message("MOBILE_EXT_LIVEFEED_DEVICE_HEIGHT"),DEVICE_RATIO:BX.message("MOBILE_EXT_LIVEFEED_DEVICE_RATIO")},rootWidget:{name:"layout",settings:{objectName:"postFormLayoutWidget",modal:true}}},false)}))}},{key:"getDatabaseData",value:function e(t){var i=new Promise((function(e,i){var n=parseInt(t.postId);if(n>0){e(t);return}R.load({onLoad:function i(n){if(n.contentType!==t.type){e(t);return}t.groupId=0;if(!s.Type.isPlainObject(t.post)){t.post={}}if(s.Type.isStringFilled(n.POST_TITLE)){t.post.PostTitle=n.POST_TITLE}if(s.Type.isStringFilled(n.POST_MESSAGE)){t.post.PostDetailText=n.POST_MESSAGE}if(s.Type.isArrayFilled(n.DEST)&&s.Type.isPlainObject(n.DEST_DATA)){t.post.PostDestination=[];var a=[{pattern:/^SG(\d+)$/i,style:"sonetgroups"},{pattern:/^U(\d+|A)$/i,style:"users"},{pattern:/^DR(\d+)$/i,style:"department"}];n.DEST.forEach((function(e){var i=null;var o=null;for(var r=0;r<a.length;r++){var l=e.match(a[r].pattern);if(l){i=l[1];o=e==="UA"?"all-users":a[r].style;break}}if(!s.Type.isNull(i)){t.post.PostDestination.push({STYLE:o,ID:i,TITLE:s.Type.isPlainObject(n.DEST_DATA[e])&&s.Type.isStringFilled(n.DEST_DATA[e].title)?n.DEST_DATA[e].title:""})}}))}if(s.Type.isStringFilled(n.BACKGROUND_CODE)){t.post.PostBackgroundCode=n.BACKGROUND_CODE}if(n.IMPORTANT==="Y"){t.post.PostImportantData={value:"Y"};if(s.Type.isStringFilled(n.IMPORTANT_DATE_END)){t.post.PostImportantData.endDate=Date.parse(n.IMPORTANT_DATE_END)/1e3}}if(s.Type.isStringFilled(n.GRATITUDE_MEDAL)){t.post.PostGratitudeData={gratitude:n.GRATITUDE_MEDAL,employees:[]};if(Array.isArray(n.GRATITUDE_EMPLOYEES)&&s.Type.isPlainObject(n.GRATITUDE_EMPLOYEES_DATA)){n.GRATITUDE_EMPLOYEES.forEach((function(e){var i=n.GRATITUDE_EMPLOYEES_DATA[e];if(!s.Type.isPlainObject(i)){return}t.post.PostGratitudeData.employees.push({id:i.id,imageUrl:s.Type.isStringFilled(i.imageUrl)?i.imageUrl:"",title:s.Type.isStringFilled(i.title)?i.title:"",subtitle:s.Type.isStringFilled(i.subtitle)?i.subtitle:""})}))}}var o="n0";var r="UF_BLOG_POST_VOTE_"+o+"_DATA";if(n.UF_BLOG_POST_VOTE===o&&s.Type.isPlainObject(n[r])&&Array.isArray(n[r].QUESTIONS)){t.post.PostVoteData={questions:n[r].QUESTIONS.map((function(e){var t={value:e.QUESTION,allowMultiSelect:e.FIELD_TYPE==1?"Y":"N",answers:[]};if(Array.isArray(e.ANSWERS)){t.answers=e.ANSWERS.map((function(e){return{value:e.MESSAGE}}))}return t}))}}e(t)},onEmpty:function s(){e(t)}},t.groupId)}));i["catch"]((function(e){console.error(e)}));return i}},{key:"getWorkgroupData",value:function e(t){var s=parseInt(t.groupId);var i=new Promise((function(e,i){if(s<=0){e(t);return}var n={resolve:e,reject:i};var a=new Date;var o="Livefeed::returnWorkgroupData_"+a.getTime();BXMobileApp.addCustomEvent(o,function(e){if(e.success){this.resolve(Object.assign(t,{group:{ID:parseInt(e.groupData.ID),NAME:e.groupData.NAME}}))}else{this.reject()}}.bind(n));BXMobileApp.onCustomEvent("Livefeed::getWorkgroupData",{groupId:s,returnEventName:o},true)}));i["catch"]((function(e){console.error(e)}));return i}},{key:"getPostData",value:function e(t){var s=parseInt(t.postId);var i=new Promise((function(e,i){if(s<=0){e(t);return}var n={resolve:e,reject:i};var a=new Date;var o="Livefeed::returnPostFullData_"+a.getTime();BXMobileApp.addCustomEvent(o,function(e){if(e.success){this.resolve(Object.assign(t,{post:e.postData}))}else{this.reject()}}.bind(n));BXMobileApp.onCustomEvent("Livefeed::getPostFullData",{postId:s,returnEventName:o},true)}));i["catch"]((function(e){console.error(e)}));return i}},{key:"processPostData",value:function e(t){var i=parseInt(t.postId);var n=new Promise((function(e,i){if(s.Type.isPlainObject(t.post)){if(s.Type.isArray(t.post.PostDestination)){t.recipients={};t.post.PostDestination.forEach((function(e){var i=null;var n=null;switch(e.STYLE){case"users":i="users";n=e.ID;break;case"all-users":i="users";n="A";break;case"sonetgroups":i="groups";n=e.ID;break;case"department":i="departments";n=e.ID;break;default:}if(i){if(!s.Type.isArray(t.recipients[i])){t.recipients[i]=[]}t.recipients[i].push({id:n,title:e.TITLE,shortTitle:s.Type.isStringFilled(e.SHORT_TITLE)?e.SHORT_TITLE:e.TITLE,avatar:s.Type.isStringFilled(e.AVATAR)?e.AVATAR:""})}}))}if(s.Type.isArray(t.post.PostDestinationHidden)){t.hiddenRecipients=[];t.post.PostDestinationHidden.forEach((function(e){t.hiddenRecipients.push(e.TYPE+e.ID)}))}}else if(s.Type.isPlainObject(t.group)){t.recipients={groups:[{id:t.group.ID,title:t.group.NAME}]}}e(t)}));n["catch"]((function(e){console.error(e)}));return n}}]);return e}();var E=function(){function e(){babelHelpers.classCallCheck(this,e);this.postFormParams={};this.postFormExtraData={}}babelHelpers.createClass(e,[{key:"setExtraDataArray",value:function e(t){var s=null;for(var i=0,n=Object.entries(t);i<n.length;i++){var a=babelHelpers.slicedToArray(n[i],2),o=a[0],r=a[1];if(t.hasOwnProperty(o)){s={};s[o]=r;this.setExtraData(s)}}}},{key:"setExtraData",value:function e(t){if(!s.Type.isPlainObject(t)){return}for(var i=0,n=Object.entries(t);i<n.length;i++){var a=babelHelpers.slicedToArray(n[i],2),o=a[0],r=a[1];if(o=="hiddenRecipients"||o=="logId"||o=="postId"||o=="postAuthorId"||o=="messageUFCode"||o=="commentId"||o=="commentType"||o=="nodeId"||o=="pinnedContext"){this.postFormExtraData[o]=r}}}},{key:"getExtraData",value:function e(){return this.postFormExtraData}},{key:"setParams",value:function e(t){if(!s.Type.isPlainObject(t)){return}for(var i=0,n=Object.entries(t);i<n.length;i++){var a=babelHelpers.slicedToArray(n[i],2),o=a[0],r=a[1];if(["selectedRecipients","messageText","messageFiles"].indexOf(o)!==-1){this.postFormParams[o]=r}}}},{key:"addDestination",value:function e(t,i){if(!s.Type.isPlainObject(i)||!s.Type.isStringFilled(i.type)){return}var n=null;if(i.type==="UA"){n=t.a_users.some(this.findDestinationCallBack,{value:0});if(!n){t.a_users.push({id:0,name:s.Loc.getMessage("MSLPostDestUA"),bubble_background_color:"#A7F264",bubble_text_color:"#54901E"})}}else if(i.type==="U"){n=t.a_users.some(this.findDestinationCallBack,{value:i.id});if(!n){t.a_users.push({id:i.id,name:i.name,bubble_background_color:"#BCEDFC",bubble_text_color:"#1F6AB5"})}}else if(i.type==="SG"){n=t.b_groups.some(this.findDestinationCallBack,{value:i.id});if(!n){t.b_groups.push({id:i.id,name:i.name,bubble_background_color:"#FFD5D5",bubble_text_color:"#B54827"})}}}},{key:"findDestinationCallBack",value:function e(t,s,i){return t.id==this.value}},{key:"show",value:function e(t){var i=this;if(!s.Type.isPlainObject(t)){t={}}var n=s.Type.isStringFilled(t.entityType)?t.entityType:"post";var a=this.getExtraData();var o={attachButton:this.getAttachButton(),mentionButton:this.getMentionButton(),attachFileSettings:this.getAttachFileSettings(),extraData:a?a:{},smileButton:{},supportLocalFilesInText:n==="post",okButton:{callback:function e(a){if(!s.Type.isStringFilled(a.text)){return}var o=i.buildRequestStub({type:n,extraData:a.extraData,text:i.parseMentions(a.text),pinnedContext:s.Type.isStringFilled(a.extraData.pinnedContext)&&a.extraData.pinnedContext==="YES"});var r=a.extraData.messageUFCode;i.buildFiles(o,a.attachedFiles,{ufCode:r}).then((function(){if(n!=="post"){return}i.buildDestinations(o,a.selectedRecipients,s.Type.isPlainObject(a.extraData)&&!s.Type.isUndefined(a.extraData.hiddenRecipients)?a.extraData.hiddenRecipients:[],{});if(!o.postVirtualId){return}o.ufCode=r;o.contentType="post";oMSL.initPostForm({groupId:t.groupId?t.groupId:null});BXMobileApp.onCustomEvent("Livefeed.PublicationQueue::setItem",{key:o.postVirtualId,pinnedContext:!!o.pinnedContext,item:o,pageId:w.getPageId(),groupId:t.groupId?t.groupId:null},true)}),(function(){}))},name:s.Loc.getMessage("MSLPostFormSend")},cancelButton:{callback:function e(){oMSL.initPostForm({groupId:t.groupId?t.groupId:null})},name:s.Loc.getMessage("MSLPostFormCancel")}};if(!s.Type.isUndefined(this.postFormParams.messageText)){o.message={text:this.postFormParams.messageText}}if(!s.Type.isUndefined(this.postFormParams.messageFiles)){o.attachedFiles=this.postFormParams.messageFiles}if(n==="post"){o.recipients={dataSource:this.getRecipientsDataSource()};if(!s.Type.isUndefined(this.postFormParams.selectedRecipients)){o.recipients.selectedRecipients=this.postFormParams.selectedRecipients}if(!s.Type.isUndefined(this.postFormParams.backgroundCode)){o.backgroundCode=this.postFormParams.backgroundCode}}return o}},{key:"getAttachButton",value:function e(){var t=[];if(s.Loc.getMessage("MOBILE_EXT_LIVEFEED_DISK_INSTALLED")==="Y"||s.Loc.getMessage("MOBILE_EXT_LIVEFEED_WEBDAV_INSTALLED")==="Y"){var i={id:"disk",name:s.Loc.getMessage("MSLPostFormDisk"),dataSource:{multiple:"NO",url:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_DISK_INSTALLED")==="Y"?"".concat(s.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId=").concat(s.Loc.getMessage("USER_ID")):"".concat(s.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/webdav/user/").concat(s.Loc.getMessage("USER_ID"),"/")}};var n={searchField:"YES",showtitle:"YES",modal:"YES",name:s.Loc.getMessage("MSLPostFormDiskTitle")};if(window.platform==="ios"){i.dataSource.table_settings=n}else{i.dataSource.TABLE_SETTINGS=n}t.push(i)}t.push({id:"mediateka",name:s.Loc.getMessage("MSLPostFormPhotoGallery")});t.push({id:"camera",name:s.Loc.getMessage("MSLPostFormPhotoCamera")});return{items:t}}},{key:"getMentionButton",value:function e(){return{dataSource:{return_full_mode:"YES",outsection:"NO",okname:s.Loc.getMessage("MSLPostFormTableOk"),cancelname:s.Loc.getMessage("MSLPostFormTableCancel"),multiple:"NO",alphabet_index:"YES",url:"".concat(s.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/index.php?mobile_action=get_user_list&use_name_format=Y")}}}},{key:"getAttachFileSettings",value:function e(){return{resize:[40,1,1,1e3,1e3,0,2,false,true,false,null,0],saveToPhotoAlbum:true}}},{key:"buildRequestStub",value:function e(t){var i=null;if(t.type==="post"){i={ACTION:"ADD_POST",AJAX_CALL:"Y",PUBLISH_STATUS:"P",is_sent:"Y",apply:"Y",sessid:s.Loc.getMessage("bitrix_sessid"),POST_MESSAGE:t.text,decode:"Y",SPERM:{},SPERM_NAME:{},MOBILE:"Y",PARSE_PREVIEW:"Y"};if(!s.Type.isUndefined(t.extraData.postId)&&parseInt(t.extraData.postId)>0){i.post_id=parseInt(t.extraData.postId);i.post_user_id=parseInt(t.extraData.postAuthorId);i.pinnedContext=!!t.pinnedContext;i.ACTION="EDIT_POST";if(!s.Type.isUndefined(t.extraData.logId)&&parseInt(t.extraData.logId)>0){i.log_id=parseInt(t.extraData.logId)}}}else if(t.type==="comment"&&!s.Type.isUndefined(t.extraData.commentId)&&parseInt(t.extraData.commentId)>0&&s.Type.isStringFilled(t.extraData.commentType)){i={action:"EDIT_COMMENT",text:this.parseMentions(t.text),commentId:parseInt(t.extraData.commentId),nodeId:t.extraData.nodeId,sessid:s.Loc.getMessage("bitrix_sessid")};if(t.extraData.commentType==="blog"){i.comment_post_id=null}}return i}},{key:"parseMentions",value:function e(t){var s=t;if(typeof oMSL.arMention!="undefined"){for(var i=0,n=Object.entries(oMSL.arMention);i<n.length;i++){var a=babelHelpers.slicedToArray(n[i],2),o=a[0],r=a[1];s=s.replace(new RegExp(o,"g"),r)}oMSL.arMention={};oMSL.commentTextCurrent=""}return s}},{key:"buildFiles",value:function e(t,i,a){var o=this;var r=new Promise((function(e,r){var l=a.ufCode;t.postVirtualId=parseInt(Math.random()*1e5);t.tasksList=[];if(s.Type.isArray(i)&&i.length>0){var c=0;var d=i.length;var u=function s(){c++;if(c>=d){o.postProgressingFiles(t,i,a);e()}};var p=[];i.forEach((function(e){var i=!s.Type.isUndefined(e.VALUE)||!s.Type.isUndefined(e.id)&&parseInt(e.id)>0||s.Type.isPlainObject(e.dataAttributes)&&!s.Type.isUndefined(e.dataAttributes.VALUE)||s.Type.isStringFilled(e.ufCode)&&e.ufCode===l;var a=s.Type.isUndefined(e.url)||!s.Type.isNumber(e.id);if(s.Type.isStringFilled(e.url)&&a&&!i){var o="postTask_".concat(parseInt(Math.random()*1e5));var r=n.MobileUtils.getFileMimeType(e.type);p.push({taskId:o,type:e.type,mimeType:r,folderId:parseInt(s.Loc.getMessage("MOBILE_EXT_UTILS_USER_FOLDER_FOR_SAVED_FILES")),params:{postVirtualId:t.postVirtualId,pinnedContext:!!t.pinnedContext},name:n.MobileUtils.getUploadFilename(e.name,e.type),url:e.url,previewUrl:e.previewUrl?e.previewUrl:null,resize:n.MobileUtils.getResizeOptions(e.type)});t.tasksList.push(o)}else{if(i){if(s.Type.isUndefined(t[l])){t[l]=[]}if(!s.Type.isUndefined(e.VALUE)){t[l].push(e.VALUE)}else if(parseInt(e.id)>0){t[l].push(parseInt(e.id))}else{t[l].push(e.dataAttributes.VALUE)}}u()}}));if(p.length>0){BXMobileApp.onCustomEvent("onFileUploadTaskReceived",{files:p},true)}e()}else{o.postProgressingFiles(t,i,a);e()}}));r["catch"]((function(e){console.error(e)}));return r}},{key:"buildDestinations",value:function e(t,i,n,a){t["DEST"]=[];if(s.Type.isPlainObject(i.a_users)){for(var o=0,r=Object.entries(i.a_users);o<r.length;o++){var l=babelHelpers.slicedToArray(r[o],2),c=l[0],d=l[1];var u="U";if(s.Type.isUndefined(t.SPERM[u])){t.SPERM[u]=[]}if(s.Type.isUndefined(t.SPERM_NAME[u])){t.SPERM_NAME[u]=[]}var p=!s.Type.isUndefined(d.ID)?d.ID:d.id;var f=!s.Type.isUndefined(d.NAME)?d.NAME:d.name;var m=parseInt(p)===0?"UA":"U".concat(p);t.SPERM[u].push(m);t.DEST.push(m);t.SPERM_NAME[u].push(f)}}if(s.Type.isPlainObject(i.b_groups)){for(var h=0,g=Object.entries(i.b_groups);h<g.length;h++){var E=babelHelpers.slicedToArray(g[h],2),v=E[0],I=E[1];var T="SG";if(s.Type.isUndefined(t.SPERM[T])){t.SPERM[T]=[]}if(s.Type.isUndefined(t.SPERM_NAME[T])){t.SPERM_NAME[T]=[]}var y=!s.Type.isUndefined(I.ID)?I.ID:I.id;var b=!s.Type.isUndefined(I.NAME)?I.NAME:I.name;var L="SG".concat(y);t.SPERM[T].push(L);t.DEST.push(L);t.SPERM_NAME[T].push(b)}}for(var _ in n){if(!n.hasOwnProperty(_)){continue}var P=n[_].TYPE;if(s.Type.isUndefined(t.SPERM[P])){t.SPERM[P]=[]}var S="".concat(n[_].TYPE).concat(n[_].ID);t.SPERM[P].push(S);t.DEST.push(S)}}},{key:"getRecipientsDataSource",value:function e(){return{return_full_mode:"YES",outsection:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DENIED")!=="Y"?"YES":"NO",okname:s.Loc.getMessage("MSLPostFormTableOk"),cancelname:s.Loc.getMessage("MSLPostFormTableCancel"),multiple:"YES",alphabet_index:"YES",showtitle:"YES",user_all:"YES",url:"".concat(s.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/index.php?mobile_action=").concat(s.Loc.getmessage("MOBILE_EXT_LIVEFEED_CURRENT_EXTRANET_SITE")==="Y"?"get_group_list":"get_usergroup_list","&feature=blog")}}},{key:"postProgressingFiles",value:function e(t,i,n){var a=n.ufCode;if(s.Type.isUndefined(t[a])){t[a]=[]}if(s.Type.isUndefined(i)){i=[]}for(var o in this.postFormParams.messageFiles){if(!this.postFormParams.messageFiles.hasOwnProperty(o)){continue}for(var r in i){if(!i.hasOwnProperty(r)){continue}if(this.postFormParams.messageFiles[o].id==i[r].id||this.postFormParams.messageFiles[o].id==i[r].ID){t[a].push(this.postFormParams.messageFiles[o].id);break}}}if(t[a].length<=0){t[a].push("empty")}}}]);return e}();var v;var I=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.panelInitialized=false;this["class"]={panel:"lenta-pinned-panel",panelCollapsed:"lenta-pinned-panel-collapsed",panelActive:"lenta-pinned-panel-active",collapsedPanel:"lenta-pinned-collapsed-posts",collapsedPanelPostsValue:"lenta-pinned-collapsed-count-posts",collapsedPanelComments:"lenta-pinned-collapsed-posts-comments",collapsedPanelCommentsShown:"lenta-pinned-collapsed-posts-comments-active",collapsedPanelCommentsValue:"lenta-pinned-collapsed-count-comments",collapsedPanelCommentsValueNew:"post-item-inform-right-new-value",collapsedPanelExpandButton:"lenta-pinned-collapsed-posts-btn",post:"lenta-item",postItemPinned:"lenta-item-pinned",postItemPinActive:"lenta-item-pin-active",postItemPinnedBlock:"post-item-pinned-block",postItemPinnedTitle:"post-item-pinned-title",postItemPinnedTextBox:"post-item-pinned-text-box",postItemPinnedDesc:"post-item-pinned-desc",cancelPanel:"post-pinned-cancel-panel",cancelPanelButton:"post-pinned-cancel-panel-btn"};this.init();i.EventEmitter.subscribe("onFrameDataProcessed",(function(){t.init()}))}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this;var s=document.querySelector(".".concat(this["class"].panel));if(!s||this.panelInitialized){return}this.panelInitialized=true;this.adjustCollapsedPostsPanel();var i=document.querySelector(".".concat(this["class"].collapsedPanel));if(i){i.addEventListener("touchend",(function(e){t.expandCollapsedPostsPanel();e.stopPropagation();return e.preventDefault()}))}}},{key:"resetFlags",value:function e(){this.panelInitialized=false}},{key:"getPinnedPanelNode",value:function e(){return document.querySelector("[data-livefeed-pinned-panel]")}},{key:"recalcPanel",value:function e(t){var s=t.type;if(this.getPostsCount()>0){this.getPinnedPanelNode().classList.add("".concat(this["class"].panelActive))}else{this.getPinnedPanelNode().classList.remove("".concat(this["class"].panelActive))}this.recalcCollapsedPostsPanel({type:s})}},{key:"recalcCollapsedPostsPanel",value:function e(t){var i=t.type;if(this.getPostsCount()>=s.Loc.getMessage("MOBILE_EXT_LIVEFEED_COLLAPSED_PINNED_PANEL_ITEMS_LIMIT")){if(i==="insert"||this.getPinnedPanelNode().classList.contains("".concat(this["class"].panelCollapsed))){this.getPinnedPanelNode().classList.add("".concat(this["class"].panelCollapsed))}}else{this.getPinnedPanelNode().classList.remove("".concat(this["class"].panelCollapsed))}this.adjustCollapsedPostsPanel()}},{key:"expandCollapsedPostsPanel",value:function e(){this.getPinnedPanelNode().classList.remove("".concat(this["class"].panelCollapsed))}},{key:"getPostsCount",value:function e(){return Array.from(this.getPinnedPanelNode().getElementsByClassName("".concat(this["class"].post))).length}},{key:"adjustCollapsedPostsPanel",value:function e(){var t=this.getPostsCount();var s=this.getPinnedPanelNode().querySelector(".".concat(this["class"].collapsedPanelPostsValue));if(s){s.innerHTML=parseInt(t)}var i=this.getPinnedPanelNode().querySelector(".".concat(this["class"].collapsedPanelComments));var n=this.getPinnedPanelNode().querySelector(".".concat(this["class"].collapsedPanelCommentsValue));if(i&&n){var a=Array.from(this.getPinnedPanelNode().querySelectorAll(".".concat(this["class"].collapsedPanelCommentsValueNew))).reduce((function(e,t){return e+parseInt(t.innerHTML)}),0);n.innerHTML="+"+a;if(a>0){i.classList.add("".concat(this["class"].collapsedPanelCommentsShown))}else{i.classList.remove("".concat(this["class"].collapsedPanelCommentsShown))}}}},{key:"getPinnedData",value:function e(t){var i=t.logId?parseInt(t.logId):0;if(i<=0){return Promise.reject()}return new Promise((function(e,n){a.Ajax.runAction("socialnetwork.api.livefeed.logentry.getPinData",{data:{params:{logId:i}},headers:[{name:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_AJAX_ENTITY_HEADER_NAME"),value:t.entityValue||""},{name:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_AJAX_TOKEN_HEADER_NAME"),value:t.tokenValue||""}]}).then((function(t){if(t.status==="success"){e(t.data)}else{n(t.errors)}}),(function(e){n()}))}))}},{key:"insertEntry",value:function e(t){var i=this;var n=t.logId,a=t.postNode,o=t.pinnedContent;var r=this.getPinnedPanelNode();if(!s.Type.isDomNode(a)||!s.Type.isDomNode(r)){return}var l=a.querySelector(".".concat(this["class"].postItemPinnedBlock));if(!s.Type.isDomNode(l)){return}a.classList.add(this["class"].postItemPinned);a.classList.add(this["class"].postItemPinActive);l.innerHTML="".concat(s.Type.isStringFilled(o.TITLE)?'<div class="'.concat(this["class"].postItemPinnedTitle,'">').concat(o.TITLE,"</div>"):"",'<div class="').concat(this["class"].postItemPinnedTextBox,'"><div class="').concat(this["class"].postItemPinnedDesc,'">').concat(o.DESCRIPTION,"</div></div>");var c=s.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['<div class="','" data-livefeed-id="','">\n\t\t\t<div class="post-pinned-cancel-panel-content">\n\t\t\t\t<div class="post-pinned-cancel-panel-label">','</div>\n\t\t\t\t\t<div class="post-pinned-cancel-panel-text">','</div>\n\t\t\t\t</div>\n\t\t\t<div class="ui-btn ui-btn-light-border ui-btn-round ui-btn-sm ','">',"</div>\n\t\t</div>"])),this["class"].cancelPanel,n,s.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_PINNED_CANCEL_TITLE"),s.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_PINNED_CANCEL_DESCRIPTION"),this["class"].cancelPanelButton,s.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_PINNED_CANCEL_BUTTON"));var d=c.querySelector(".".concat(this["class"].cancelPanelButton));d.addEventListener("touchend",(function(e){var t=e.currentTarget.closest(".".concat(i["class"].cancelPanel));if(!t){return}var s=parseInt(t.getAttribute("data-livefeed-id"));if(s<=0){return}var n=document.querySelector(".".concat(i["class"].post,'[data-livefeed-id="').concat(s,'"]'));if(!n){return}var a=n.querySelector('[data-menu-type="post"]');if(!a){return}var o=new p({logId:s});return o.setPinned({menuNode:a,context:"list"})}));a.parentNode.insertBefore(c,a);s.Dom.prepend(a,r);this.recalcPanel({type:"insert"});J.onScroll()}},{key:"extractEntry",value:function e(t){var i=t.logId,n=t.postNode,a=t.containerNode;var o=this.getPinnedPanelNode();if(!s.Type.isDomNode(n)||!s.Type.isDomNode(a)||!s.Type.isDomNode(o)||n.parentNode!==o||parseInt(i)<=0){return}n.classList.remove(this["class"].postItemPinned);n.classList.remove(this["class"].postItemPinActive);var r=document.querySelector(".".concat(this["class"].cancelPanel,'[data-livefeed-id="').concat(parseInt(i),'"]'));if(r){r.parentNode.insertBefore(n,r);s.Dom.remove(r)}else{s.Dom.prepend(n,a)}this.recalcPanel({type:"extract"})}}]);return e}();var T=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));e.init();return e}babelHelpers.createClass(t,[{key:"init",value:function e(){this.setEventNamespace("BX.Mobile.Livefeed");this.subscribe("onFeedInit",this.onFeedInit.bind(this))}},{key:"onFeedInit",value:function e(){if(!window.BXRL){return}Object.keys(window.BXRL).forEach((function(e){if(e!=="manager"&&e!=="render"){delete window.BXRL[e]}}))}}]);return t}(i.EventEmitter);var y=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"setPostRead",value:function e(t){var i=this;if(!s.Type.isDomNode(t)||t.hasAttribute("done")){return false}var n=parseInt(t.getAttribute("bx-data-post-id"));if(n<=0){return false}this.renderRead({node:t,value:true});a.Ajax.runAction("socialnetwork.api.livefeed.blogpost.important.vote",{data:{params:{POST_ID:n}}}).then((function(e){if(!s.Type.isStringFilled(e.data.success)||e.data.success!=="Y"){i.renderRead({node:t,value:false})}else{BXMobileApp.onCustomEvent("onLogEntryImpPostRead",{postId:n},true)}}),(function(e){i.renderRead({node:t,value:false})}));return true}},{key:"renderRead",value:function e(t){if(!s.Type.isObject(t)||!s.Type.isDomNode(t.node)){return}var i=t.node;var n=!!t.value;if(n){i.checked=true;i.setAttribute("done","Y");s.Event.unbindAll(i)}else{i.checked=false;delete i.checked;i.removeAttribute("done")}var a=i.closest(".post-item-important");if(!a){return}var o=a.querySelector(".post-item-important-list");if(!o){return}o.classList.add("post-item-important-list-read")}}]);return e}();var b=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));e.findTextMode=false;e.ftMinTokenSize=3;e.hideByRefresh=false;return e}babelHelpers.createClass(t,[{key:"init",value:function e(t){var n=this;if(BXMobileAppContext.getApiVersion()<w.getApiVersion("pageMenu")){return}if(s.Type.isPlainObject(t)&&parseInt(t.ftMinTokenSize)>0){this.ftMinTokenSize=parseInt(t.ftMinTokenSize)}this.subscribe("onSearchBarCancelButtonClicked",this.searchBarEventCallback.bind(this));this.subscribe("onSearchBarSearchButtonClicked",this.searchBarEventCallback.bind(this));i.EventEmitter.subscribe("BX.MobileLivefeed.SearchBar::setHideByRefresh",this.setHideByRefresh.bind(this));i.EventEmitter.subscribe("BX.MobileLivefeed.SearchBar::unsetHideByRefresh",this.unsetHideByRefresh.bind(this));BXMobileApp.UI.Page.params.set({useSearchBar:true});app.exec("setParamsSearchBar",{params:{callback:function e(t){if(t.eventName==="onSearchButtonClicked"&&s.Type.isPlainObject(t.data)&&s.Type.isStringFilled(t.data.text)){if(t.data.text.length>=n.ftMinTokenSize){n.findTextMode=true}n.emit("onSearchBarSearchButtonClicked",new i.BaseEvent({data:{text:t.data.text}}))}else if(["onCancelButtonClicked","onSearchHide"].includes(t.eventName)){n.emit("onSearchBarCancelButtonClicked",new i.BaseEvent({data:{}}))}}}})}},{key:"searchBarEventCallback",value:function e(t){var n=this;var a=t.getData();var o=s.Type.isPlainObject(a)&&s.Type.isStringFilled(a.text)?a.text:"";if(o.length>=this.ftMinTokenSize){app.exec("showSearchBarProgress");this.emitRefreshEvent(o)}else{if(this.findTextMode){if(!this.hideByRefresh){i.EventEmitter.emit("BX.MobileLF:onSearchBarRefreshAbort")}if(BX.frameCache){app.exec("hideSearchBarProgress");BX.frameCache.readCacheWithID("framecache-block-feed",(function(e){var t=document.getElementById("bxdynamic_feed_refresh");if(!s.Type.isArray(e.items)||!t){n.emitRefreshEvent();return}var i=e.items.find((function(e){return s.Type.isStringFilled(e.ID)&&e.ID==="framecache-block-feed"}));if(s.Type.isUndefined(i)){return}s.Runtime.html(t,i.CONTENT).then((function(){BX.processHTML(i.CONTENT,true)}));p.moveTop();setTimeout((function(){BitrixMobile.LazyLoad.showImages()}),1e3)}))}else{this.emitRefreshEvent()}}this.findTextMode=false}}},{key:"setHideByRefresh",value:function e(){this.hideByRefresh=true}},{key:"unsetHideByRefresh",value:function e(){this.hideByRefresh=false}},{key:"emitRefreshEvent",value:function e(t){if(J.refreshXhr){return}t=t||"";var s=new i.BaseEvent({compatData:[{text:t}]});i.EventEmitter.emit("BX.MobileLF:onSearchBarRefreshStart",s)}}]);return t}(i.EventEmitter);var L=function(){function e(){babelHelpers.classCallCheck(this,e);this.canCheckScrollButton=true;this.showScrollButtonTimeout=null;this.showScrollButtonBottom=false;this.showScrollButtonTop=false;this["class"]={scrollButton:"post-comment-block-scroll",scrollButtonTop:"post-comment-block-scroll-top",scrollButtonBottom:"post-comment-block-scroll-bottom",scrollButtonTopActive:"post-comment-block-scroll-top-active",scrollButtonBottomActive:"post-comment-block-scroll-bottom-active"};this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){if(window.platform==="ios"){return}document.addEventListener("scroll",this.onScrollDetail.bind(this))}},{key:"onScrollDetail",value:function e(){var t=this;if(!this.canCheckScrollButton){return}clearTimeout(this.showScrollButtonTimeout);this.showScrollButtonTimeout=setTimeout((function(){w.setLastActivityDate();t.checkScrollButton()}),200)}},{key:"checkScrollButton",value:function e(){var t=window.scrollY;var s=document.documentElement.scrollHeight-window.innerHeight-100;this.showScrollButtonBottom=!(document.documentElement.scrollHeight-window.innerHeight<=0||t>=s&&(t>0||s>0));this.showScrollButtonTop=t>200;this.showHideScrollButton()}},{key:"showHideScrollButton",value:function e(){var t=document.querySelector(".".concat(this["class"].scrollButtonBottom));var s=document.querySelector(".".concat(this["class"].scrollButtonTop));if(t){if(this.showScrollButtonBottom){if(!t.classList.contains("".concat(this["class"].scrollButtonBottomActive))){t.classList.add("".concat(this["class"].scrollButtonBottomActive))}}else{if(t.classList.contains("".concat(this["class"].scrollButtonBottomActive))){t.classList.remove("".concat(this["class"].scrollButtonBottomActive))}}}if(s){if(this.showScrollButtonTop){if(!s.classList.contains("".concat(this["class"].scrollButtonTopActive))){s.classList.add("".concat(this["class"].scrollButtonTopActive))}}else{if(s.classList.contains("".concat(this["class"].scrollButtonTopActive))){s.classList.remove("".concat(this["class"].scrollButtonTopActive))}}}}},{key:"scrollTo",value:function e(t){var s=this;if(t!=="top"){t="bottom"}this.canCheckScrollButton=false;this.showScrollButtonBottom=false;this.showScrollButtonTop=false;this.showHideScrollButton();var i=window.scrollY;var n=t=="bottom"?document.documentElement.scrollHeight:0;BitrixAnimation.animate({duration:500,start:{scroll:i},finish:{scroll:n},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function e(t){window.scrollTo(0,t.scroll)},complete:function e(){s.canCheckScrollButton=true;s.checkScrollButton()}})}}]);return e}();var _=function(){function e(){babelHelpers.classCallCheck(this,e);this.defaultValue=true;this.value=true;this["class"]={postItemFollow:"post-item-follow",postItemFollowActive:"post-item-follow-active"}}babelHelpers.createClass(e,[{key:"init",value:function e(){}},{key:"setFollow",value:function e(t){var i=this;var n=!s.Type.isUndefined(t.logId)?parseInt(t.logId):0;var o=!s.Type.isUndefined(t.pageId)?t.pageId:false;var r=!s.Type.isUndefined(t.bRunEvent)?t.bRunEvent:true;var l=!s.Type.isUndefined(t.bAjax)?t.bAjax:false;var c=typeof t.bOnlyOn!="undefined"?t.bOnlyOn:false;if(c=="NO"){c=false}var d=null;if(s.Type.isDomNode(t.menuNode)){d=t.menuNode}else if(s.Type.isStringFilled(t.menuNode)){d=document.getElementById(t.menuNode)}if(!d){d=document.getElementById("log-entry-menu-".concat(n))}var u=document.getElementById("log_entry_follow_".concat(n));if(!u){u=document.getElementById("log_entry_follow")}var p=document.getElementById("post_item_top_wrap_".concat(n));if(!p){p=document.getElementById("post_item_top_wrap")}var f=null;if(d){f=d.getAttribute("data-follow")==="Y"?"Y":"N"}else if(u){f=u.getAttribute("data-follow")=="Y"?"Y":"N"}else{return false}var m=f==="Y"?"N":"Y";if((!s.Type.isStringFilled(w.getOption("detailPageId"))||w.getOption("detailPageId")!==o)&&(!c||f==="N")){this.drawFollow({value:f!=="Y",followBlock:u,followWrap:p,menuNode:d,runEvent:r,turnOnOnly:c,logId:n})}if(l){a.Ajax.runAction("socialnetwork.api.livefeed.changeFollow",{data:{logId:n,value:m},analyticsLabel:{b24statAction:m==="Y"?"setFollow":"setUnfollow"}}).then((function(e){if(e.data.success){return}i.drawFollow({value:f==="Y",followBlock:u,followWrap:p,menuNode:d,runEvent:true,turnOnOnly:c,logId:n})}),(function(e){i.drawFollow({value:f==="Y",followBlock:u,followWrap:p,menuNode:d,runEvent:false})}))}return false}},{key:"drawFollow",value:function e(t){var i=s.Type.isBoolean(t.value)?t.value:null;if(s.Type.isNull(i)){return}var n=s.Type.isDomNode(t.followBlock)?t.followBlock:null;if(n){n.classList.remove(i?this["class"].postItemFollow:this["class"].postItemFollowActive);n.classList.add(i?this["class"].postItemFollowActive:this["class"].postItemFollow);n.setAttribute("data-follow",i?"Y":"N")}var a=s.Type.isDomNode(t.followWrap)?t.followWrap:null;if(a&&!this.getFollowDefaultValue()){if(i){a.classList.add(this["class"].postItemFollow)}else{a.classList.remove(this["class"].postItemFollow)}}var o=s.Type.isDomNode(t.menuNode)?t.menuNode:null;if(o){o.setAttribute("data-follow",i?"Y":"N")}var r=w.getOption("detailPageId");if(s.Type.isStringFilled(r)){this.setFollowValue(i);this.setFollowMenuItemName()}var l=s.Type.isBoolean(t.runEvent)?t.runEvent:false;var c=!s.Type.isUndefined(t.logId)?parseInt(t.logId):0;var d=s.Type.isBoolean(t.turnOnOnly)?t.turnOnOnly:false;if(l&&c>0){BXMobileApp.onCustomEvent("onLogEntryFollow",{logId:c,pageId:s.Type.isStringFilled(r)?r:"",bOnlyOn:d?"Y":"N"},true)}}},{key:"setFollowDefault",value:function e(t){var i=this;if(s.Type.isUndefined(t.value)){return}var n=!!t.value;if(!s.Type.isStringFilled(w.getOption("detailPageId"))){this.setFollowDefaultValue(n);this.setDefaultFollowMenuItemName()}var a={sessid:BX.bitrix_sessid(),site:s.Loc.getMessage("SITE_ID"),lang:s.Loc.getMessage("LANGUAGE_ID"),value:n?"Y":"N",action:"change_follow_default",mobile_action:"change_follow_default"};oMSL.changeListMode(a,(function(){oMSL.pullDownAndRefresh()}),(function(e){i.setFollowDefaultValue(e.value!=="Y");i.setDefaultFollowMenuItemName()}))}},{key:"setFollowValue",value:function e(t){this.value=!!t}},{key:"getFollowValue",value:function e(){return this.value}},{key:"setFollowDefaultValue",value:function e(t){this.defaultValue=!!t}},{key:"getFollowDefaultValue",value:function e(){return this.defaultValue}},{key:"setFollowMenuItemName",value:function e(){var t=H.detailPageMenuItems.findIndex((function(e){return s.Type.isStringFilled(e.feature)&&e.feature==="follow"}));if(t<0){return}var i=H.detailPageMenuItems[t];i.name=this.getFollowValue()?s.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_Y"):s.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_N");H.detailPageMenuItems[t]=i;H.init({type:"detail"})}},{key:"setDefaultFollowMenuItemName",value:function e(){var t=H.listPageMenuItems.findIndex((function(e){return s.Type.isStringFilled(e.feature)&&e.feature==="follow"}));if(t<0){return}var i=H.listPageMenuItems[t];i.name=this.getFollowDefaultValue()?s.Loc.getMessage("MSLMenuItemFollowDefaultY"):s.Loc.getMessage("MSLMenuItemFollowDefaultN");H.listPageMenuItems[t]=i;H.init({type:"list"})}}]);return e}();var P,S,M,D;var k=function(){function e(){babelHelpers.classCallCheck(this,e);this.emptyCommentsXhr=null;this.repoLog={};this.mid={};this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){i.EventEmitter.subscribe("OnUCommentWasDeleted",this.deleteHandler.bind(this));i.EventEmitter.subscribe("OnUCommentWasHidden",this.deleteHandler.bind(this));i.EventEmitter.subscribe("OnUCRecordHasDrawn",this.drawHandler.bind(this));i.EventEmitter.subscribe("OnUCFormSubmit",this.submitHandler.bind(this))}},{key:"deleteHandler",value:function e(t){var s=t.getData(),i=babelHelpers.slicedToArray(s,2),n=i[0],a=i[1];var o=w.getLogId();if(this.mid[a.join("-")]!=="hidden"){this.mid[a.join("-")]="hidden";if(this.repoLog[o]){this.repoLog[o]["POST_NUM_COMMENTS"]--;BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:o,num:this.repoLog[o]["POST_NUM_COMMENTS"]},true)}}}},{key:"drawHandler",value:function e(t){var s=t.getData(),i=babelHelpers.slicedToArray(s,2),n=i[0],a=i[1];var o=w.getLogId();this.mid[n]=this.mid[n]||{};if(this.mid[a.join("-")]!=="drawn"){this.mid[a.join("-")]="drawn";var r=false;if(this.repoLog[o]&&(r=document.getElementById("record-".concat(a.join("-"),"-cover")))&&r&&r.parentNode==document.getElementById("record-".concat(n,"-new"))){this.repoLog[o]["POST_NUM_COMMENTS"]++;BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:o,num:this.repoLog[o]["POST_NUM_COMMENTS"]},true)}}}},{key:"submitHandler",value:function e(t){var s=t.getData(),i=babelHelpers.slicedToArray(s,4),n=i[0],a=i[1],o=i[2],r=i[3];if(r&&r.mobile_action&&r.mobile_action==="add_comment"&&a>0){r.mobile_action=r.action="edit_comment";r.edit_id=a}}},{key:"setRepoItem",value:function e(t,s){this.repoLog[t]=s}},{key:"getList",value:function e(t){var n=this;var o=t.ts;var r=!!t.bPullDown;var l=s.Type.isUndefined(t.bPullDownTop)||t.bPullDownTop;var c=s.Type.isUndefined(t.obFocus.form)||t.obFocus.form==="NO"?"NO":"YES";var d=s.Type.isUndefined(t.obFocus.comments)||t.obFocus.comments==="NO"?"NO":"YES";var u=oMSL.logId;var p=document.getElementById("post-comments-wrap");if(!r){if(l){BXMobileApp.UI.Page.Refresh.start()}s.Dom.clean(p);p.appendChild(s.Tag.render(P||(P=babelHelpers.taggedTemplateLiteral(['<span id="post-comment-last-after"></span>']))))}this.showEmptyListWaiter({container:p,enable:true});i.EventEmitter.emit("BX.MobileLF:onCommentsGet");BXMobileApp.UI.Page.TextPanel.hide();this.emptyCommentsXhr=a.Ajax.wrap({type:"json",method:"POST",url:"".concat(s.Loc.getMessage("MSLPathToLogEntry").replace("#log_id#",u),"&empty_get_comments=Y").concat(!s.Type.isNil(o)?"&LAST_LOG_TS=".concat(o):""),data:{},processData:true,callback:function e(t){var a=document.getElementById("post-comments-form-wrap");if(r){app.exec("pullDownLoadingStop")}else if(l){BXMobileApp.UI.Page.Refresh.stop()}n.showEmptyListWaiter({container:p,enable:false});if(s.Type.isStringFilled(t.POST_PERM)){oMSL.menuData.post_perm=t.POST_PERM;H.detailPageMenuItems=H.buildDetailPageMenu(oMSL.menuData);H.init({type:"detail"})}if(s.Type.isStringFilled(t.TEXT)){if(r){s.Dom.clean(p);if(!s.Type.isUndefined(t.POST_NUM_COMMENTS)){BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:u,num:parseInt(t.POST_NUM_COMMENTS)},true)}}n.setRepoItem(u,{POST_NUM_COMMENTS:t.POST_NUM_COMMENTS});var o=BX.processHTML(t.TEXT,true);s.Runtime.html(p,o.HTML).then((function(){setTimeout((function(){BitrixMobile.LazyLoad.showImages()}),1e3)}));p.appendChild(s.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['<span id="post-comment-last-after"></span>']))));var f=0;var m=function e(){f++;if(f<100){if(p.childNodes.length>0){BX.ajax.processScripts(o.SCRIPT)}else{BX.defer(e,n)()}}};BX.defer(m,n)();var h=new i.BaseEvent({compatData:[{mobile:true,ajaxUrl:"".concat(s.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/ajax.php"),commentsContainerId:"post-comments-wrap",commentsClassName:"post-comment-wrap"}]});i.EventEmitter.emit("BX.UserContentView.onInitCall",h);i.EventEmitter.emit("BX.UserContentView.onClearCall",h);if(!r){if(a){a.innerHTML=""}__MSLDetailPullDownInit(true);if(c==="YES"){n.setFocusOnComments("form")}else if(d=="YES"){n.setFocusOnComments("list")}}w.setLastActivityDate();z.checkScrollButton();var g=document.getElementById("post_log_id");if(!s.Type.isUndefined(t.TS)&&g){g.setAttribute("data-ts",t.TS)}}else{if(!r){n.showEmptyListWaiter({container:p,enable:false})}app.alert({title:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_ALERT_ERROR_TITLE"),text:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_ALERT_ERROR_POST_NOT_FOUND_TEXT"),button:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_ALERT_ERROR_BUTTON"),callback:function e(){BXMobileApp.onCustomEvent("Livefeed::onLogEntryDetailNotFound",{logId:u},true);BXMPage.close()}})}},callback_failure:function e(){if(r){app.exec("pullDownLoadingStop")}else{BXMobileApp.UI.Page.Refresh.stop()}n.showEmptyListWaiter({container:p,enable:false});n.showEmptyListFailed({container:p,timestampValue:o,pullDown:r,moveBottom:c})}})}},{key:"showEmptyListWaiter",value:function e(t){var i=t.container;var n=!!t.enable;if(!s.Type.isDomNode(i)){return}var a=i.querySelector(".post-comments-load-btn-wrap");if(a){s.Dom.clean(a);s.Dom.remove(a)}if(!n){return}i.appendChild(s.Tag.render(M||(M=babelHelpers.taggedTemplateLiteral(['<div class="post-comments-load-btn-wrap"><div class="post-comments-loader"></div><div class="post-comments-load-text">',"</div></div>"])),s.Loc.getMessage("MSLDetailCommentsLoading")))}},{key:"showEmptyListFailed",value:function e(t){var i=this;var n=t.container,a=t.timestampValue,o=t.pullDown,r=t.moveBottom,l=t.data;if(!s.Type.isDomNode(n)){return}var c=s.Type.isObject(l)&&s.Type.isStringFilled(l.ERROR_MESSAGE)?l.ERROR_MESSAGE:s.Loc.getMessage("MSLDetailCommentsFailed");n.appendChild(s.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(['<div class="post-comments-load-btn-wrap"><div class="post-comments-load-text">','</div><a class="post-comments-load-btn">',"</a></div>"])),c,s.Loc.getMessage("MSLDetailCommentsReload")));var d=n.querySelector(".post-comments-load-btn");if(!d){return}d.addEventListener("click",(function(e){if(s.Type.isDomNode(e.target.parent)){s.Dom.clean(e.target.parent);s.Dom.remove(e.target.parent)}i.getList({ts:a,bPullDown:o,obFocus:{form:false}})}));d.addEventListener("touchstart",(function(e){e.target.classList.add("post-comments-load-btn-active")}));d.addEventListener("touchend",(function(e){e.target.classList.remove("post-comments-load-btn-active")}))}},{key:"abortXhr",value:function e(){if(this.emptyCommentsXhr){this.emptyCommentsXhr.abort()}}},{key:"setFocusOnComments",value:function e(t){t=t==="list"?"list":"form";if(t==="form"){this.setFocusOnCommentForm();p.moveBottom()}else if(t==="list"){var s=document.getElementById("post-comments-wrap");if(!s){return false}var i=s.querySelector(".post-comment-block-new");if(i){window.scrollTo(0,i.offsetTop)}else{var n=BX.findChild(s,{className:"post-comment-block"},true);window.scrollTo(0,n?n.offsetTop:0)}}return false}},{key:"setFocusOnCommentForm",value:function e(){BXMobileApp.UI.Page.TextPanel.focus();return false}},{key:"onLogEntryCommentAdd",value:function e(t,i){var n;var a=!s.Type.isUndefined(i);i=!s.Type.isUndefined(i)?parseInt(i):0;var o=document.getElementById("informer_comments_".concat(t));var r=document.getElementById("informer_comments_new_".concat(t));if(o&&!r){if(i>0){n=i}else if(!a){n=(o.innerHTML.length>0?parseInt(o.innerHTML):0)+1}if(parseInt(n)>0){o.innerHTML=n;o.style.display="inline-block";if(document.getElementById("informer_comments_text2_".concat(t))){document.getElementById("informer_comments_text2_".concat(t)).style.display="inline-block"}if(document.getElementById("informer_comments_text_".concat(t))){document.getElementById("informer_comments_text_".concat(t)).style.display="none"}}}var l=document.getElementById("comcntleave-all");if(l){if(i>0){n=i}else if(!a){n=(l.innerHTML.length>0?parseInt(l.innerHTML):0)+1}l.innerHTML=n}}}]);return e}();var B=function(){function e(){babelHelpers.classCallCheck(this,e);this.isBusyGettingNextPage=false;this.isBusyRefreshing=false;this.pageNumber=1;this.nextPageXhr=null;this.refreshXhr=null;this.nextUrl="";this.requestErrorTimeout={refresh:null,nextPage:null};this["class"]={notifier:"lenta-notifier-waiter",notifierActive:"lenta-notifier-shown"};this.onScroll=this.onScroll.bind(this);this.refreshErrorScroll=this.refreshErrorScroll.bind(this);this.nextPageErrorScroll=this.nextPageErrorScroll.bind(this);this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){this.setPageNumber(1)}},{key:"initScroll",value:function e(t,s){t=!!t;s=!!s;if(t){document.removeEventListener("scroll",this.onScroll);document.addEventListener("scroll",this.onScroll)}else{document.removeEventListener("scroll",this.onScroll)}if(s&&document.getElementById("next_post_more")){document.getElementById("next_post_more").style.display=t?"block":"none"}}},{key:"onScroll",value:function e(){var t=this;var n=w.getMaxScroll();if(!((window.pageYOffset>=n||document.documentElement.scrollHeight<=window.innerHeight)&&(window.pageYOffset>0||n>0)&&!this.isBusyRefreshing&&!this.isBusyGettingNextPage)){return}if(w.getOption("refreshFrameCacheNeeded",false)===true){return}document.removeEventListener("scroll",this.onScroll);this.isBusyGettingNextPage=true;this.nextPageXhr=a.Ajax.wrap({type:"json",method:"POST",url:this.getNextPageUrl(),data:{},callback:function e(n){t.nextPageXhr=null;if(s.Type.isPlainObject(n)&&s.Type.isPlainObject(n.PROPS)&&s.Type.isStringFilled(n.PROPS.CONTENT)){if(s.Type.isUndefined(n.LAST_TS)||parseInt(n.LAST_TS)<=0||parseInt(s.Loc.getMessage("MSLFirstPageLastTS"))<=0||parseInt(n.LAST_TS)<parseInt(s.Loc.getMessage("MSLFirstPageLastTS"))||parseInt(n.LAST_TS)===parseInt(s.Loc.getMessage("MSLFirstPageLastTS"))&&(parseInt(n.LAST_ID)<=0||parseInt(s.Loc.getMessage("MSLFirstPageLastId"))<=0||parseInt(n.LAST_ID)!==parseInt(s.Loc.getMessage("MSLFirstPageLastId")))){t.processAjaxBlock(n.PROPS,{type:"next",callback:function e(){w.recalcMaxScroll();oMSL.registerBlocksToCheck();setTimeout(oMSL.checkNodesHeight.bind(oMSL),100);i.EventEmitter.emit("BX.UserContentView.onRegisterViewAreaListCall",new i.BaseEvent({compatData:[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}]}))}});var a=t.getPageNumber();if(parseInt(s.Loc.getMessage("MSLPageNavNum"))>0&&a>0){t.setPageNumber(a+1);var o=s.Uri.removeParam(t.getNextPageUrl(),["PAGEN_"+s.Loc.getMessage("MSLPageNavNum")]);o=s.Uri.addParam(o,babelHelpers.defineProperty({},"PAGEN_".concat(parseInt(s.Loc.getMessage("MSLPageNavNum"))),t.getPageNumber()+1));t.setNextPageUrl(o)}document.addEventListener("scroll",t.onScroll)}}else{t.requestError("nextPage",true)}t.isBusyGettingNextPage=false},callback_failure:function e(){t.requestError("nextPage",true);t.nextPageXhr=null;t.isBusyGettingNextPage=false}})}},{key:"refresh",value:function e(t,i){var n=this;t=!!t;if(this.isBusyGettingNextPage&&!s.Type.isNull(this.nextPageXhr)){this.nextPageXhr.abort()}var o=document.getElementById("lenta_notifier");if(o){o.classList.add(this["class"].notifier)}w.setRefreshNeeded(false);w.setRefreshStarted(true);O.hideRefreshNeededNotifier();F.startWaiter();x.hideAll();this.isBusyRefreshing=true;var r=s.Uri.removeParam(document.location.href,["RELOAD","RELOAD_JSON","FIND"]);r=s.Uri.addParam(r,{RELOAD:"Y",RELOAD_JSON:"Y"});if(s.Type.isPlainObject(i)&&s.Type.isStringFilled(i.find)){r=s.Uri.addParam(r,{FIND:i.find})}var l=[{name:"BX-ACTION-TYPE",value:"get_dynamic"},{name:"BX-REF",value:document.referrer},{name:"BX-CACHE-MODE",value:"APPCACHE"},{name:"BX-APPCACHE-PARAMS",value:JSON.stringify(window.appCacheVars)},{name:"BX-APPCACHE-URL",value:!s.Type.isUndefined(BX.frameCache)&&s.Type.isPlainObject(BX.frameCache.vars)&&s.Type.isStringFilled(BX.frameCache.vars.PAGE_URL)?BX.frameCache.vars.PAGE_URL:oMSL.curUrl}];this.refreshXhr=a.Ajax.wrap({type:"json",method:"POST",url:r,data:{},headers:l,callback:function e(i){n.refreshXhr=null;n.setPageNumber(1);w.setRefreshStarted(false);w.setRefreshNeeded(false);F.stopWaiter();if(document.getElementById("lenta_notifier")){document.getElementById("lenta_notifier").classList.remove(n["class"].notifier)}app.exec("pullDownLoadingStop");app.exec("hideSearchBarProgress");if(s.Type.isPlainObject(i)&&s.Type.isPlainObject(i.PROPS)&&s.Type.isStringFilled(i.PROPS.CONTENT)){n.setRefreshFrameCacheNeeded(false);BitrixMobile.LazyLoad.clearImages();app.hidePopupLoader();O.hideNotifier();O.hideRefreshNeededNotifier();if(!s.Type.isUndefined(i.COUNTER_TO_CLEAR)){BXMobileApp.onCustomEvent("onClearLFCounter",[i.COUNTER_TO_CLEAR],true);BXMobileApp.Events.postToComponent("onClearLiveFeedCounter",{counterCode:i.COUNTER_TO_CLEAR,serverTime:i.COUNTER_SERVER_TIME,serverTimeUnix:i.COUNTER_SERVER_TIME_UNIX},"communication")}n.processAjaxBlock(i.PROPS,{type:"refresh",callback:function e(){j.resetFlags();j.init();if(!s.Type.isUndefined(BX.frameCache)&&document.getElementById("bxdynamic_feed_refresh")&&(s.Type.isUndefined(i.REWRITE_FRAMECACHE)||i.REWRITE_FRAMECACHE!=="N")){var t=!s.Type.isUndefined(i.TS)&&parseInt(i.TS)>0?parseInt(i.TS):0;if(t>0){w.setOptions({frameCacheTs:t})}w.updateFrameCache({timestamp:t})}oMSL.registerBlocksToCheck();setTimeout((function(){BitrixMobile.LazyLoad.showImages()}),1e3);O.initEvents()}});if(t){BitrixAnimation.animate({duration:1e3,start:{scroll:window.pageYOffset},finish:{scroll:0},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function e(t){window.scrollTo(0,t.scroll)},complete:function e(){}})}if(window.applicationCache&&i.isManifestUpdated=="1"&&!oMSL.appCacheDebug&&(window.applicationCache.status==window.applicationCache.IDLE||window.applicationCache.status==window.applicationCache.UPDATEREADY)){window.applicationCache.update()}}else{n.requestError("refresh",true)}n.isBusyRefreshing=false},callback_failure:function e(){n.refreshXhr=null;w.setRefreshStarted(false);w.setRefreshNeeded(false);F.stopWaiter();if(document.getElementById("lenta_notifier")){document.getElementById("lenta_notifier").classList.remove(n["class"].notifier)}app.exec("pullDownLoadingStop");app.exec("hideSearchBarProgress");n.requestError("refresh",true);n.isBusyRefreshing=false}})}},{key:"processAjaxBlock",value:function e(t,i){if(!s.Type.isPlainObject(i)||!s.Type.isStringFilled(i.type)||["refresh","next"].indexOf(i.type)<0){return}var n=false;var a=false;o(r);l(c);function o(e){if(s.Type.isArray(t.CSS)&&t.CSS.length>0){BX.load(t.CSS,e)}else{e()}}function r(){if(i.type==="refresh"){document.getElementById("lenta_wrapper_global").innerHTML=t.CONTENT}else{document.getElementById("lenta_wrapper").insertBefore(s.Dom.create("div",{html:t.CONTENT}),document.getElementById("next_post_more"))}n=true;if(a){c()}}function l(e){if(s.Type.isArray(t.JS)&&t.JS.length>0){BX.load(t.JS,e)}else{e()}}function c(){a=true;if(n){s.ajax.processRequestData(t.CONTENT,{scriptsRunFirst:false,dataType:"HTML",onsuccess:function e(){if(s.Type.isFunction(i.callback)){i.callback()}}})}}}},{key:"requestError",value:function e(t,s){var i=this;if(!["refresh","nextPage"].includes(t)){t="refresh"}s=!!s;var n=document.getElementById("lenta_".concat(t.toLowerCase(),"_error"));if(this.requestErrorTimeout[t]){clearTimeout(this.requestErrorTimeout[t])}if(n){if(s){n.classList.add(this["class"].notifierActive);if(t==="refresh"){document.addEventListener("scroll",this.refreshErrorScroll)}}else{if(t==="refresh"){document.removeEventListener("scroll",this.refreshErrorScroll)}n.classList.remove(this["class"].notifierActive)}}else{this.requestErrorTimeout[t]=setTimeout((function(){i.requestError(t,s)}),500)}if(t==="nextPage"){this.initScroll(!s,true)}}},{key:"refreshErrorScroll",value:function e(){this.requestError("refresh",false)}},{key:"nextPageErrorScroll",value:function e(){this.requestError("nextPage",false)}},{key:"setPageNumber",value:function e(t){this.pageNumber=parseInt(t)}},{key:"getPageNumber",value:function e(){return this.pageNumber}},{key:"setNextPageUrl",value:function e(t){this.nextUrl=t}},{key:"getNextPageUrl",value:function e(){return this.nextUrl}},{key:"setRefreshFrameCacheNeeded",value:function e(t){w.setOptions({refreshFrameCacheNeeded:!!t});var s=document.getElementById("next_page_refresh_needed");var n=document.getElementById("next_post_more");if(s&&n){s.style.display=!!t?"block":"none";n.style.display=!!t?"none":"block"}i.EventEmitter.emit("BX.UserContentView.onSetPreventNextPage",new i.BaseEvent({compatData:[!!t]}))}}]);return e}();var C,A;var N=function(){function e(){babelHelpers.classCallCheck(this,e);this.pageId=null;this.logId=false;this.refreshNeeded=false;this.refreshStarted=false;this.options={};this.nodeId={feedContainer:"lenta_wrapper"};this["class"]={listWrapper:"lenta-list-wrap",postWrapper:"post-wrap",pinnedPanel:"lenta-pinned-panel",pin:"lenta-item-pin",postNewContainerTransformNew:"lenta-item-new-cont",postNewContainerTransform:"lenta-item-transform-cont",postLazyLoadCheck:"lenta-item-lazyload-check",listPost:"lenta-item",detailPost:"post-wrap",postItemTopWrap:"post-item-top-wrap",postItemTop:"post-item-top",postItemPostBlock:"post-item-post-block",postItemPostContentView:"post-item-contentview",postItemDescriptionBlock:"post-item-description",postItemAttachedFileWrap:"post-item-attached-disk-file-wrap",postItemInformWrap:"post-item-inform-wrap",postItemInformWrapTree:"post-item-inform-wrap-tree",postItemInformComments:"post-item-inform-comments",postItemInformMore:"post-item-more",postItemMore:"post-more-block",postItemPinnedBlock:"post-item-pinned-block",postItemPinActive:"lenta-item-pin-active",postItemGratitudeUsersSmallContainer:"lenta-block-grat-users-small-cont",postItemGratitudeUsersSmallHidden:"lenta-block-grat-users-small-hidden",postItemImportantUserList:"post-item-important-list",addPostButton:"feed-add-post-button"};this.newPostContainer=null;this.maxScroll=0;this.lastActivityDate=0;this.availableGroupList={};this.isPullDownEnabled=false;this.isPullDownLocked=false;this.isFrameDataReceived=false;this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this;BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAdd",this.afterPostAdd.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAddError",this.afterPostAddError.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdate",this.afterPostUpdate.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdateError",this.afterPostUpdateError.bind(this));BXMobileApp.addCustomEvent("Livefeed::showLoader",this.showLoader.bind(this));BXMobileApp.addCustomEvent("Livefeed::hideLoader",this.hideLoader.bind(this));BXMobileApp.addCustomEvent("Livefeed::scrollTop",this.scrollTop.bind(this));BXMobileApp.addCustomEvent("Livefeed::onLogEntryDetailNotFound",this.removePost.bind(this));BXMobileApp.addCustomEvent("Livefeed.PinnedPanel::change",this.onPinnedPanelChange.bind(this));BXMobileApp.addCustomEvent("Livefeed.PostDetail::pinChanged",this.onPostPinChanged.bind(this));i.EventEmitter.subscribe("BX.LazyLoad:ImageLoaded",this.onLazyLoadImageLoaded.bind(this));i.EventEmitter.subscribe("MobileBizProc:onRenderLogMessages",this.onMobileBizProcRenderLogMessages.bind(this));i.EventEmitter.subscribe("MobilePlayer:onError",this.onMobilePlayerError);document.addEventListener("DOMContentLoaded",(function(){document.addEventListener("click",t.handleClick.bind(t))}))}},{key:"initListOnce",value:function e(t){var n=this;if(!s.Type.isPlainObject(t)){t={}}if(!s.Type.isUndefined(t.arAvailableGroup)){this.availableGroupList=t.arAvailableGroup}i.EventEmitter.subscribe("onFrameDataReceivedBefore",BitrixMobile.LazyLoad.clearImages);i.EventEmitter.subscribe("BX.LazyLoad:ImageLoaded",(function(){n.recalcMaxScroll()}));i.EventEmitter.subscribe("onFrameDataReceived",(function(){n.isPullDownEnabled=false;n.isPullDownLocked=false;n.isFrameDataReceived=true;app.exec("pullDownLoadingStop");BitrixMobile.LazyLoad.showImages(true)}));i.EventEmitter.subscribe("onFrameDataProcessed",(function(e){var t=e.getCompatData(),i=babelHelpers.slicedToArray(t,2),a=i[0],o=i[1];if(!s.Type.isUndefined(a)&&!s.Type.isUndefined(a[0])&&!s.Type.isUndefined(o)&&!!o){if(!s.Type.isUndefined(a[0].PROPS)&&!s.Type.isUndefined(a[0].PROPS.TS)&&parseInt(a[0].PROPS.TS)>0){n.setOptions({frameCacheTs:parseInt(a[0].PROPS.TS)})}}BitrixMobile.LazyLoad.showImages(true);if(!!o){J.setRefreshFrameCacheNeeded(true)}}));i.EventEmitter.subscribe("onCacheDataRequestStart",(function(){setTimeout((function(){if(!n.isFrameDataReceived){n.isPullDownLocked=true;app.exec("pullDownLoadingStart")}}),1e3)}));i.EventEmitter.subscribe("onFrameDataReceivedError",(function(){app.BasicAuth({success:function e(){BX.frameCache.update(true)},failture:function e(){n.isPullDownLocked=false;app.exec("pullDownLoadingStop");J.requestError("refresh",true)}})}));i.EventEmitter.subscribe("onFrameDataRequestFail",(function(e){var t=e.getCompatData(),i=babelHelpers.slicedToArray(t,1),a=i[0];if(!s.Type.isUndefined(a)&&s.Type.isStringFilled(a.reason)&&a.reason==="bad_eval"){n.isPullDownLocked=false;app.exec("pullDownLoadingStop");J.requestError("refresh",true)}else{app.BasicAuth({success:function e(){BX.frameCache.update(true)},failture:function e(){n.isPullDownLocked=false;app.exec("pullDownLoadingStop");J.requestError("refresh",true)}})}}));i.EventEmitter.subscribe("onCacheInvokeAfter",(function(e){var t=e.getCompatData(),s=babelHelpers.slicedToArray(t,2),i=s[0],n=s[1];if(n.items.length<=0){BX.frameCache.update(true,true)}}));BXMobileApp.addCustomEvent("onAfterEdit",(function(e){n.afterEdit({responseData:e.postResponseData,logId:e.postData.data.log_id})}));i.EventEmitter.subscribe("onPullDownDisable",(function(){BXMobileApp.UI.Page.Refresh.setEnabled(false)}));i.EventEmitter.subscribe("onPullDownEnable",(function(){BXMobileApp.UI.Page.Refresh.setEnabled(true)}));BXMobileApp.UI.Page.Refresh.setParams({callback:function e(){if(!n.isPullDownLocked){J.refresh(true)}},backgroundColor:"#E7E9EB"});BXMobileApp.UI.Page.Refresh.setEnabled(true)}},{key:"setPageId",value:function e(t){this.pageId=t}},{key:"getPageId",value:function e(){return this.pageId}},{key:"setLogId",value:function e(t){this.logId=parseInt(t)}},{key:"getLogId",value:function e(){return parseInt(this.logId)}},{key:"setOptions",value:function e(t){for(var s in t){if(!t.hasOwnProperty(s)){continue}this.options[s]=t[s]}}},{key:"getOption",value:function e(t,i){if(s.Type.isUndefined(i)){i=null}if(!s.Type.isStringFilled(t)){return null}return!s.Type.isUndefined(this.options[t])?this.options[t]:i}},{key:"setRefreshNeeded",value:function e(t){this.refreshNeeded=t}},{key:"getRefreshNeeded",value:function e(){return this.refreshNeeded}},{key:"setRefreshStarted",value:function e(t){this.refreshStarted=t}},{key:"getRefreshStarted",value:function e(){return this.refreshStarted}},{key:"setNewPostContainer",value:function e(t){this.newPostContainer=t}},{key:"getNewPostContainer",value:function e(){return this.newPostContainer}},{key:"setMaxScroll",value:function e(t){this.maxScroll=t}},{key:"getMaxScroll",value:function e(){return this.maxScroll}},{key:"afterPostAdd",value:function e(t){if(!s.Type.isPlainObject(t)){t={}}var i=typeof t.postId!="undefined"?parseInt(t.postId):0;var n=typeof t.context!="undefined"?t.context:"";var a=typeof t.pageId!="undefined"?t.pageId:"";var o=typeof t.groupId!="undefined"?t.groupId:null;if(a!==this.pageId){return}R["delete"](o);if(i<=0||s.Type.isStringFilled(t.warningText)){return}this.getEntryContent({entityType:"BLOG_POST",entityId:i,queueKey:t.key,action:"add"})}},{key:"afterPostUpdate",value:function e(t){if(!s.Type.isPlainObject(t)){t={}}var i=typeof t.context!="undefined"?t.context:"";var n=typeof t.pageId!="undefined"?t.pageId:"";var a=typeof t.postId!="undefined"?parseInt(t.postId):0;var o=typeof t.pinned!="undefined"&&!!t.pinned;this.getEntryContent({entityType:"BLOG_POST",entityId:a,queueKey:t.key,action:"update",pinned:o})}},{key:"afterPostAddError",value:function e(t){var i=this;if(!s.Type.isPlainObject(t)){t={}}var n=s.Type.isStringFilled(t.context)?t.context:"";var a=t.groupId?t.groupId:"";var o={a_users:[],b_groups:[]};oMSL.buildSelectedDestinations(t.postData,o);Y.setParams({selectedRecipients:o});Y.setParams({messageText:t.postData.POST_MESSAGE});R.save(t.postData,a);t.callback=function(){if(BXMobileAppContext.getApiVersion()>=i.getApiVersion("layoutPostForm")){V.show({pageId:i.getPageId(),postId:0})}else{app.exec("showPostForm",Y.show())}};this.showPostError(t)}},{key:"afterPostUpdateError",value:function e(t){if(!s.Type.isPlainObject(t)){t={}}var i=s.Type.isStringFilled(t.context)?t.context:"";t.callback=function(){f.edit({postId:parseInt(t.postId)})};this.showPostError(t)}},{key:"showPostError",value:function e(t){if(!s.Type.isPlainObject(t)){t={}}t.callback=s.Type.isFunction(t.callback)?t.callback:function(){};var i=s.Type.isStringFilled(t.errorText)?t.errorText:false;x.showError({text:i?i:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_PUBLICATION_ERROR"),onTap:function e(s){t.callback(s)}})}},{key:"showLoader",value:function e(t){if(!s.Type.isPlainObject(t)){t={}}if(t.pageId&&this.pageId!==null&&t.pageId!=this.pageId){return}app.showPopupLoader({text:s.Type.isStringFilled(t.text)?t.text:""})}},{key:"hideLoader",value:function e(){app.hidePopupLoader()}},{key:"scrollTop",value:function e(t){if(!s.Type.isPlainObject(t)){t={}}if(t.pageId&&this.pageId!==null&&t.pageId!=this.pageId){return}window.scrollTo(0,0)}},{key:"getEntryContent",value:function e(t){var i=this;if(!s.Type.isPlainObject(t)){t={}}var n=t.logId?parseInt(t.logId):0;if(n<=0&&!(s.Type.isStringFilled(t.entityType)&&parseInt(t.entityId)>0)){return}a.Ajax.runComponentAction("bitrix:mobile.socialnetwork.log.ex","getEntryContent",{mode:"class",signedParameters:this.getOption("signedParameters",{}),data:{params:{logId:parseInt(t.logId)>0?parseInt(t.logId):0,pinned:!!t.pinned?"Y":"N",entityType:s.Type.isStringFilled(t.entityType)?t.entityType:"",entityId:parseInt(t.entityId)>0?parseInt(t.entityId):0,siteTemplateId:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_TEMPLATE_ID")}}}).then((function(e){if(n<=0){a.Ajax.runComponentAction("bitrix:mobile.socialnetwork.log.ex","getEntryLogId",{mode:"class",data:{params:{entityType:s.Type.isStringFilled(t.entityType)?t.entityType:"",entityId:parseInt(t.entityId)>0?parseInt(t.entityId):0}}}).then((function(s){if(s.data.logId){i.insertPost({logId:s.data.logId,content:e.data.html,postId:t.postId,queueKey:t.queueKey,action:t.action,serverTimestamp:parseInt(e.data.componentResult.serverTimestamp)})}}))}else{i.insertPost({logId:n,content:e.data.html,postId:t.postId,queueKey:t.queueKey,action:t.action,serverTimestamp:parseInt(e.data.componentResult.serverTimestamp)})}}))}},{key:"processDetailBlock",value:function e(t,i,n){if(!t||!i){return Promise.reject()}var a=i.querySelector(n);var o=t.querySelector(n);if(o&&a){return s.Runtime.html(o,a.innerHTML)}return Promise.reject()}},{key:"insertPost",value:function e(t){var a=this;var o=document.getElementById(this.nodeId.feedContainer);var r=t.content;var l=t.logId;var c=t.queueKey;var d=t.action;if(!s.Type.isDomNode(o)||!s.Type.isStringFilled(r)){return}var u=typeof t.serverTimestamp!="undefined"&&parseInt(t.serverTimestamp)>0?parseInt(t.serverTimestamp):0;if(d==="update"){var p=document.getElementById("lenta_item_"+l);if(!p){p=document.getElementById("lenta_item")}if(!p){return}var f=this.pageId.match(/^detail_(\d+)/i);if(f&&l!=f[1]){return}var m=p.appendChild(document.createElement("div"));m.style.display="none";s.Runtime.html(m,r);if(p.id==="lenta_item"){this.processDetailBlock(p,m,".".concat(this["class"].postItemTop));this.processDetailBlock(p,m,".".concat(this["class"].postItemPostBlock)).then((function(){var e=p.querySelector(".".concat(a["class"].postItemPostBlock));var t=m.querySelector(".".concat(a["class"].postItemPostBlock));if(e||t){var s=a.filterPostBlockClassList(e.classList);var i=a.filterPostBlockClassList(t.classList);s.forEach((function(t){e.classList.remove(t)}));i.forEach((function(t){e.classList.add(t)}))}BitrixMobile.LazyLoad.showImages()}));this.processDetailBlock(p,m,".".concat(this["class"].postItemAttachedFileWrap)).then((function(){BitrixMobile.LazyLoad.showImages()}));this.processDetailBlock(p,m,".".concat(this["class"].postItemInformWrap));this.processDetailBlock(p,m,".".concat(this["class"].postItemInformWrapTree))}else{p=p.querySelector("div.".concat(this["class"].postItemTopWrap));var h=m.querySelector("div.".concat(this["class"].postItemTopWrap));s.Runtime.html(p,h.innerHTML).then((function(){oMSL.checkNodesHeight();BitrixMobile.LazyLoad.showImages();if(document.getElementById("framecache-block-feed")){setTimeout((function(){a.updateFrameCache({timestamp:u})}),750)}}))}m.remove()}else if(d==="add"){this.setNewPostContainer(s.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['<div class="'," ",'" ontransitionend="','"></div>'])),this["class"].postNewContainerTransformNew,this["class"].postLazyLoadCheck,this.handleInsertPostTransitionEnd.bind(this)));s.Dom.prepend(this.getNewPostContainer(),o);n.Utils.htmlWithInlineJS(this.getNewPostContainer(),r).then((function(){var e=a.getNewPostContainer().querySelector("div.".concat(a["class"].listPost));s.Dom.style(a.getNewPostContainer(),"height","".concat(e.scrollHeight+12,"px"));if(u>0){a.setOptions({frameCacheTs:u})}oMSL.registerBlocksToCheck();setTimeout((function(){oMSL.checkNodesHeight()}),100);setTimeout((function(){a.updateFrameCache({timestamp:u})}),750)}))}U.emit("onPostInserted",new i.BaseEvent({data:{key:c}}))}},{key:"removePost",value:function e(t){var s=parseInt(t.logId);if(s<=0){return}var i=document.getElementById("lenta_item_"+s);if(!i){return}i.remove()}},{key:"filterPostBlockClassList",value:function e(t){var s=[];Array.from(t).forEach((function(e){if(e==="info-block-background"||e==="info-block-background-with-title"||e==="info-block-gratitude"||e==="info-block-important"||e==="ui-livefeed-background"||e.match(/info-block-gratitude-(.+)/i)||e.match(/ui-livefeed-background-(.+)/i)){s.push(e)}}));return s}},{key:"handleInsertPostTransitionEnd",value:function e(t){if(t.propertyName==="height"){this.getNewPostContainer().classList.remove(this["class"].postNewContainerTransformNew);this.getNewPostContainer().classList.remove(this["class"].postNewContainerTransform);s.Dom.style(this.getNewPostContainer(),"height",null);this.recalcMaxScroll();BitrixMobile.LazyLoad.showImages()}}},{key:"onLazyLoadImageLoaded",value:function e(t){var i=this;this.recalcMaxScroll();var n=t.getData(),a=babelHelpers.slicedToArray(n,1),o=a[0];if(o){var r=o.closest(".".concat(this["class"].postLazyLoadCheck));if(r){var l=r.querySelector("div.".concat(this["class"].listPost));if(l){r.classList.add(this["class"].postNewContainerTransform);s.Dom.style(r,"height","".concat(l.scrollHeight,"px"));setTimeout((function(){r.classList.remove(i["class"].postNewContainerTransform);s.Dom.style(r,"height",null)}),500)}}}}},{key:"recalcMaxScroll",value:function e(){this.setMaxScroll(document.documentElement.scrollHeight-2*window.innerHeight)}},{key:"onMobileBizProcRenderLogMessages",value:function e(){this.recalcMaxScroll()}},{key:"onPinnedPanelChange",value:function e(t){var i=t.logId?parseInt(t.logId):0;var n=["Y","N"].indexOf(t.value)!==-1?t.value:null;if(!i||!n||!j.getPinnedPanelNode()){return}var a=s.Type.isDomNode(t.postNode)?t.postNode:null;if(!s.Type.isDomNode(t.postNode)){a=document.getElementById("lenta_item_".concat(i))}if(!s.Type.isDomNode(a)){return}if(n==="N"){j.extractEntry({logId:i,postNode:a,containerNode:document.getElementById(this.nodeId.feedContainer)})}else if(n==="Y"&&s.Type.isDomNode(t.postNode)){app.showPopupLoader({text:""});if(this.getOption("refreshFrameCacheNeeded",false)===true){return}var o=a.getAttribute("data-security-entity-pin");var r=a.getAttribute("data-security-token-pin");j.getPinnedData({logId:i,entityValue:o,tokenValue:r}).then((function(e){app.hidePopupLoader();j.insertEntry({logId:i,postNode:t.postNode,pinnedContent:e})}),(function(e){app.hidePopupLoader()}))}}},{key:"onPostPinChanged",value:function e(t){var s=t.logId?parseInt(t.logId):0;var i=["Y","N"].indexOf(t.value)!==-1?t.value:null;if(!s||!i){return}var n=document.getElementById("log-entry-menu-"+s);if(!n){return}var a=n.closest(".".concat(this["class"].detailPost));if(!a){a=n.closest(".".concat(this["class"].listPost))}if(!a){return}if(i==="Y"){a.classList.add(this["class"].postItemPinActive)}else{a.classList.remove(this["class"].postItemPinActive)}}},{key:"handleClick",value:function e(t){if(t.target.classList.contains(this["class"].pin)){var i=null;var n=null;var a="list";var o=t.target.closest(".".concat(this["class"].listPost));if(o){n=o.querySelector('[data-menu-type="post"]');i=this.getPostFromNode(o)}else{a="detail";o=t.target.closest(".".concat(this["class"].detailPost));if(o){n=o.querySelector('[data-menu-type="post"]');if(n){i=this.getPostFromLogId(n.getAttribute("data-log-id"))}}}if(i&&n){return i.setPinned({menuNode:n,context:a})}t.stopPropagation();return t.preventDefault()}else if(t.target.classList.contains(this["class"].addPostButton)){if(BXMobileAppContext.getApiVersion()>=this.getApiVersion("layoutPostForm")){var r=new g;r.show({pageId:this.getPageId(),groupId:this.getOption("groupId",0)})}else{app.exec("showPostForm",Y.show())}}else if(t.target.classList.contains(".".concat(z["class"].scrollButton))||t.target.closest(".".concat(z["class"].scrollButton))){if(t.target.classList.contains(".".concat(z["class"].scrollButtonTop))||t.target.closest(".".concat(z["class"].scrollButtonTop))){z.scrollTo("top")}else if(t.target.classList.contains(".".concat(z["class"].scrollButtonBottom))||t.target.closest(".".concat(z["class"].scrollButtonBottom))){z.scrollTo("bottom")}}else if((t.target.closest(".".concat(this["class"].listWrapper))||t.target.closest(".".concat(this["class"].pinnedPanel)))&&!(t.target.tagName.toLowerCase()==="a"&&s.Type.isStringFilled(t.target.getAttribute("target"))&&t.target.getAttribute("target").toLowerCase()==="_blank")){var l=!!(t.target.classList.contains(this["class"].postItemPinnedBlock)||t.target.closest(".".concat(this["class"].postItemPinnedBlock)));var c=!!(!l&&(t.target.classList.contains(this["class"].postItemPostContentView)||t.target.closest(".".concat(this["class"].postItemPostContentView))||t.target.classList.contains(this["class"].postItemDescriptionBlock)||t.target.closest(".".concat(this["class"].postItemDescriptionBlock))));var d=!!(!l&&!c&&(t.target.classList.contains(this["class"].postItemInformComments)||t.target.closest(".".concat(this["class"].postItemInformComments))));var u=!!(!l&&!c&&!d&&(t.target.classList.contains(this["class"].postItemInformMore)||t.target.closest(".".concat(this["class"].postItemInformMore))));if(l||c||d||u){var f=t.target.closest(".".concat(this["class"].listPost));if(f){var m=this.getPostFromNode(f);if(m){m.openDetail({pathToEmptyPage:this.getOption("pathToEmptyPage",""),pathToCalendarEvent:this.getOption("pathToCalendarEvent",""),pathToTasksRouter:this.getOption("pathToTasksRouter",""),event:t,focusComments:d,showFull:u})}}t.stopPropagation();return t.preventDefault()}}else if(t.target.closest(".".concat(this["class"].postWrapper))){var h=!!(t.target.classList.contains(this["class"].postItemInformMore)||t.target.closest(".".concat(this["class"].postItemInformMore))||t.target.classList.contains(this["class"].postItemMore)||t.target.closest(".".concat(this["class"].postItemMore)));var E=null;if(t.target.classList.contains(this["class"].postItemGratitudeUsersSmallContainer)){E=t.target}else{E=t.target.closest(".".concat(this["class"].postItemGratitudeUsersSmallContainer))}if(h||s.Type.isDomNode(E)){if(s.Type.isDomNode(E)){E.style.display="none";var v=E.parentNode.querySelector(".".concat(this["class"].postItemGratitudeUsersSmallHidden));if(v){v.style.display="block"}}var I=this.getOption("logId",0);var T=new p({logId:I});T.expandText();t.stopPropagation();return t.preventDefault()}var y=null;if(t.target.classList.contains(this["class"].postItemImportantUserList)){y=t.target}else{y=t.target.closest(".".concat(this["class"].postItemImportantUserList))}if(y){var b=y.parentNode.querySelector("input");var L=0;if(s.Type.isDomNode(b)){L=parseInt(b.getAttribute("bx-data-post-id"))}if(L>0){app.exec("openComponent",{name:"JSStackComponent",componentCode:"livefeed.important.list",scriptPath:"/mobileapp/jn/livefeed.important.list/?version=1.0.0",params:{POST_ID:L,SETTINGS:this.getOption("importantData",{})},rootWidget:{name:"list",settings:{objectName:"livefeedImportantListWidget",title:BX.message("MOBILE_EXT_LIVEFEED_USERS_LIST_TITLE"),modal:false,backdrop:{mediumPositionPercent:75}}}},false)}}}}},{key:"getPostFromNode",value:function e(t){if(!s.Type.isDomNode(t)){return}var i=parseInt(t.getAttribute("data-livefeed-id"));if(i<=0){return}return new p({logId:i,entryType:t.getAttribute("data-livefeed-post-entry-type"),useFollow:t.getAttribute("data-livefeed-post-use-follow")==="Y",useTasks:t.getAttribute("data-livefeed-post-use-tasks")==="Y",perm:t.getAttribute("data-livefeed-post-perm"),destinations:t.getAttribute("data-livefeed-post-destinations"),postId:parseInt(t.getAttribute("data-livefeed-post-id")),url:t.getAttribute("data-livefeed-post-url"),entityXmlId:t.getAttribute("data-livefeed-post-entity-xml-id"),readOnly:t.getAttribute("data-livefeed-post-read-only")==="Y",contentTypeId:t.getAttribute("data-livefeed-post-content-type-id"),contentId:t.getAttribute("data-livefeed-post-content-id"),showFull:t.getAttribute("data-livefeed-post-show-full")==="Y",taskId:parseInt(t.getAttribute("data-livefeed-task-id")),taskData:t.getAttribute("data-livefeed-task-data"),calendarEventId:parseInt(t.getAttribute("data-livefeed-calendar-event-id"))})}},{key:"getPostFromLogId",value:function e(t){var s=null;t=parseInt(t);if(t<=0){return s}s=new p({logId:t});return s}},{key:"updateFrameCache",value:function e(t){var i=document.getElementById("framecache-block-feed");if(!s.Type.isDomNode(i)){i=document.getElementById("bxdynamic_feed_refresh")}if(!s.Type.isDomNode(i)){return}var n={USE_BROWSER_STORAGE:true,AUTO_UPDATE:true,USE_ANIMATION:false};var a=typeof t.timestamp!="undefined"?parseInt(t.timestamp):0;if(a>0){n.TS=a}BX.frameCache.writeCacheWithID("framecache-block-feed",i.innerHTML,parseInt(Math.random()*1e5),JSON.stringify(n))}},{key:"onMobilePlayerError",value:function e(t){var i=t.getData(),n=babelHelpers.slicedToArray(i,2),a=n[0],o=n[1];if(!s.Type.isDomNode(a)){return}if(!s.Type.isStringFilled(o)){return}var r=a.parentNode;if(r){if(r.querySelector(".disk-mobile-player-error-container")){return}}else{if(a.querySelector(".disk-mobile-player-error-container")){return}}var l=a.getElementsByTagName("source");var c=l.length;Array.from(l).forEach((function(e){if(s.Type.isStringFilled(e.src)&&e.src===o){s.Dom.remove(e);c--}}));if(c>0){return}var d=s.Dom.create("div",{props:{className:"disk-mobile-player-error-container"},children:[s.Dom.create("div",{props:{className:"disk-mobile-player-error-icon"},html:""}),s.Dom.create("div",{props:{className:"disk-mobile-player-error-message"},html:s.Loc.getMessage("MOBILE_EXT_LIVEFEED_PLAYER_ERROR_MESSAGE")})]});var u=d.querySelector(".disk-mobile-player-download");if(u){s.Dom.adjust(u,{events:{click:function e(){app.openDocument({url:o})}}})}if(r){a.style.display="none";r.appendChild(d)}else{s.Dom.adjust(a,{children:[d]})}}},{key:"getApiVersion",value:function e(t){var s=0;switch(t){case"layoutPostForm":s=37;break;case"pageMenu":s=34;break;case"tabs":s=41;break;default:}return s}},{key:"sendErrorEval",value:function e(t){BX.evalGlobal("try { "+t+" } catch (e) { this.sendError(e.message, e.name, e.number); }")}},{key:"sendError",value:function e(t,s,i){a.Ajax.runAction("socialnetwork.api.livefeed.mobileLogError",{data:{message:t,url:s,lineNumber:i}}).then((function(e){}),(function(e){}))}},{key:"setLastActivityDate",value:function e(){this.lastActivityDate=Math.round((new Date).getTime()/1e3)}},{key:"getLastActivityDate",value:function e(){return this.lastActivityDate}},{key:"afterEdit",value:function e(t){var i=t.responseData,n=t.logId;n=!s.Type.isUndefined(n)?parseInt(n):0;var a=s.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(["<div>","</div>"])),i.text);var o=document.getElementById("blog-post-first-after");if(o){o.parentNode.insertBefore(a,o.nextSibling)}var r=a.querySelector(".post-item-post-block");var l=a.querySelector(".post-item-top");var c=a.querySelector(".post-item-attached-file-wrap");if(n>0&&r&&l){var d={detailText:r.innerHTML,topText:l.innerHTML,logID:n};if(c){d.filesBlockText=c.innerHTML}BXMobileApp.onCustomEvent("onEditedPostInserted",d,true,true)}BitrixMobile.LazyLoad.showImages()}}]);return e}();var w=new N;var O=new o;var F=new r;var x=new l;var R=new c;var U=new u;var X=new m;var H=new h;var V=new g;var Y=new E;var j=new I;var G=new T;var q=new y;var W=new b;var z=new L;var K=new _;var Q=new k;var J=new B;e.Post=p;e.BlogPost=f;e.Instance=w;e.BalloonNotifierInstance=O;e.NextPageLoaderInstance=F;e.NotificationBarInstance=x;e.DatabaseUnsentPostInstance=R;e.PublicationQueueInstance=U;e.PostMenuInstance=X;e.PageMenuInstance=H;e.PostFormManagerInstance=V;e.PostFormOldManagerInstance=Y;e.PinnedPanelInstance=j;e.RatingInstance=G;e.ImportantManagerInstance=q;e.SearchBarInstance=W;e.PageScrollInstance=z;e.FollowManagerInstance=K;e.CommentsInstance=Q;e.PageInstance=J})(this.BX.MobileLivefeed=this.BX.MobileLivefeed||{},BX.UI.Analytics,BX,BX.Event,BX,BX.Mobile);
//# sourceMappingURL=livefeed.bundle.map.js