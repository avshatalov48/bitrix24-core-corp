this.BX=this.BX||{};(function(e,t,s,n,i,o){"use strict";var a=function(){function e(){babelHelpers.classCallCheck(this,e);this.classes={show:"lenta-notifier-shown"};this.nodeIdList={notifier:"lenta_notifier",notifierCounter:"lenta_notifier_cnt",notifierCounterTitle:"lenta_notifier_cnt_title",refreshNeeded:"lenta_notifier_2"}}babelHelpers.createClass(e,[{key:"getNotifierNode",value:function e(){return document.getElementById(this.nodeIdList.notifier)}},{key:"getNotifierCounterNode",value:function e(){return document.getElementById(this.nodeIdList.notifierCounter)}},{key:"getNotifierCounterTitleNode",value:function e(){return document.getElementById(this.nodeIdList.notifierCounterTitle)}},{key:"getRefreshNeededNode",value:function e(){return document.getElementById(this.nodeIdList.refreshNeeded)}},{key:"showRefreshNeededNotifier",value:function e(){var t=this.getRefreshNeededNode();if(t){t.classList.add(this.classes.show)}}},{key:"hideRefreshNeededNotifier",value:function e(){var t=this.getRefreshNeededNode();if(t){t.classList.remove(this.classes.show)}}},{key:"showNotifier",value:function e(s){var n=parseInt(s.counterValue);var i=n%100,o=n%10;var a="";if(i>=10&&i<15){a=3}else if(o==0){a=3}else if(o==1){a=1}else if(o==2||o==3||o==4){a=2}else{a=3}if(g.getRefreshNeeded()){this.getNotifierCounterNode().innerHTML=n?n+"+":"";this.hideRefreshNeededNotifier()}else{this.getNotifierCounterNode().innerHTML=n||""}this.getNotifierCounterTitleNode().innerHTML=t.Loc.getMessage("MOBILE_EXT_LIVEFEED_COUNTER_TITLE_"+a);this.getNotifierNode().classList.add(this.classes.show)}},{key:"hideNotifier",value:function e(){var t=this.getNotifierNode();if(t){t.classList.remove(this.classes.show)}}}]);return e}();var l=function(){function e(){babelHelpers.classCallCheck(this,e);this.repo=[];this.color={background:{error:"#affb0000",info:"#3a3735"},text:{error:"#ffffff",info:"#ffffff"}}}babelHelpers.createClass(e,[{key:"hideAll",value:function e(){this.repo=this.repo.filter(function(e){return e});this.repo.forEach(function(e){e.hide()})}},{key:"showError",value:function e(t){var s=new BXMobileApp.UI.NotificationBar({message:t.text?t.text:"",color:this.color.background.error,textColor:this.color.text.error,useLoader:t.useLoader?!!t.useLoader:false,groupId:t.groupId?t.groupId:"",align:t.textAlign?t.textAlign:"center",autoHideTimeout:t.autoHideTimeout?t.autoHideTimeout:3e4,hideOnTap:t.hideOnTap?!!t.hideOnTap:true,onTap:t.onTap?t.onTap:function(){}},t.id?t.id:parseInt(Math.random()*1e5));this.repo.push(s);s.show()}},{key:"showInfo",value:function e(t){var s=new BXMobileApp.UI.NotificationBar({message:t.text?t.text:"",color:this.color.background.info,textColor:this.color.text.info,useLoader:t.useLoader?!!t.useLoader:false,groupId:t.groupId?t.groupId:"",maxLines:t.maxLines?t.maxLines:false,align:t.textAlign?t.textAlign:"center",isGlobal:t.isGlobal?!!t.isGlobal:true,useCloseButton:t.useCloseButton?!!t.useCloseButton:true,autoHideTimeout:t.autoHideTimeout?t.autoHideTimeout:1e3,hideOnTap:t.hideOnTap?!!t.hideOnTap:true},t.id?t.id:parseInt(Math.random()*1e5));this.repo.push(s);s.show()}}]);return e}();var r=function(){function e(s){babelHelpers.classCallCheck(this,e);this.tableName=null;this.keyName=null;this.setTableName(t.Type.isPlainObject(s)&&t.Type.isStringFilled(s.tableName)?s.tableName:"b_default");this.setKeyName(t.Type.isPlainObject(s)&&t.Type.isStringFilled(s.keyName)?s.keyName:"post_unsent")}babelHelpers.createClass(e,[{key:"setTableName",value:function e(t){this.tableName=t}},{key:"getTableName",value:function e(){return this.tableName}},{key:"setKeyName",value:function e(t){this.keyName=t}},{key:"getKeyName",value:function e(){return this.keyName}},{key:"check",value:function e(s){if(!t.Type.isObject(app.db)){return false}app.db.createTable({tableName:this.getTableName(),fields:[{name:"KEY",unique:true},"VALUE"],success:function e(t){s.success()},fail:function e(t){s.fail()}})}},{key:"delete",value:function e(s){var n=this;if(parseInt(s)<=0){s=false}if(!t.Type.isObject(app.db)){return false}this.check({success:function e(){app.db.deleteRows({tableName:n.getTableName(),filter:{KEY:n.getKeyName()+(s?"_"+s:"")},success:function e(t){},fail:function e(t){}})},fail:function e(){}})}},{key:"save",value:function e(s,n){var i=this;if(parseInt(n)<=0){n=false}for(var o in s){if(!s.hasOwnProperty(o)){continue}if(o==="sessid"){delete s[o];break}}if(!t.Type.isObject(app.db)){return false}this.check({success:function e(){app.db.getRows({tableName:i.getTableName(),filter:{KEY:i.getKeyName()+(n?"_"+n:"")},success:function e(t){var o=JSON.stringify(s);if(t.items.length>0){app.db.updateRows({tableName:i.getTableName(),updateFields:{VALUE:o},filter:{KEY:i.getKeyName()+(n?"_"+n:"")},success:function e(t){},fail:function e(t){}})}else{app.db.addRow({tableName:i.getTableName(),insertFields:{KEY:i.getKeyName()+(n?"_"+n:""),VALUE:o},success:function e(t){},fail:function e(t){}})}},fail:function e(t){}})},fail:function e(){}})}},{key:"load",value:function e(s,n){var i=this;if(parseInt(n)<=0){n=false}if(!t.Type.isObject(app.db)){s.onEmpty();return null}this.check({success:function e(){app.db.getRows({tableName:i.getTableName(),filter:{KEY:i.getKeyName()+(n?"_"+n:"")},success:function e(n){if(n.items.length>0&&n.items[0].VALUE.length>0){var i=JSON.parse(n.items[0].VALUE);if(t.Type.isPlainObject(i)){s.onLoad(i)}else{s.onEmpty()}}else{s.onEmpty()}},fail:function e(t){s.onEmpty()}})},fail:function e(){s.onEmpty()}})}}]);return e}();function d(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="post-balloon-hidden post-balloon post-balloon-active"><span class="post-balloon-icon"></span><span class="post-balloon-text">',"</span></div>\n\t\t\t"]);d=function t(){return e};return e}var c=function(e){babelHelpers.inherits(s,e);function s(){var e;babelHelpers.classCallCheck(this,s);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this));e.repo={};e.nodeId={container:"post-balloon-container"};e.class={balloonHidden:"post-balloon-hidden",balloonFixed:"post-balloon-box-fixed",balloonPublished:"post-balloon-done",balloonShow:"post-balloon-show",balloonHide:"post-balloon-hide"};e.timeout={show:750};e.init();return e}babelHelpers.createClass(s,[{key:"init",value:function e(){BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterSetItem",this.afterSetItem.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAdd",this.afterPostAdd.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAddError",this.afterPostAddError.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdate",this.afterPostUpdate.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdateError",this.afterPostUpdateError.bind(this));this.setEventNamespace("BX.Mobile.Livefeed");this.subscribe("onFeedReady",this.onFeedLoaded.bind(this));this.subscribe("onPostInserted",this.onPostInserted.bind(this));t.Event.bind(document,"scroll",this.onScroll.bind(this))}},{key:"onScroll",value:function e(){var s=document.getElementById(this.nodeId.container);if(!t.Type.isDomNode(s)){return}if(window.pageYOffset>0){s.classList.add(this.class.balloonFixed)}else{s.classList.remove(this.class.balloonFixed)}}},{key:"onFeedLoaded",value:function e(){var s=this;app.exec("getStorageValue",{storageId:"livefeed",key:"publicationQueue",callback:function e(n){n=t.Type.isPlainObject(n)?n:t.Type.isStringFilled(n)?JSON.parse(n):{};if(!t.Type.isPlainObject(n)){return}for(var i in n){if(!n.hasOwnProperty(i)){continue}s.addToTray(i,{})}s.drawList()}})}},{key:"onPostInserted",value:function e(t){this.removeFromTray(t.data.key)}},{key:"addToTray",value:function e(t,s){this.repo[t]=s;this.repo[t].node=this.drawItem();this.repo[t].node.classList.add(this.class.balloonShow)}},{key:"removeFromTray",value:function e(t,s){var n=this;this.hideItem(t);setTimeout(function(){if(n.repo[t]){delete n.repo[t]}},3e3)}},{key:"addSuccess",value:function e(s){var n=this;if(this.repo[s]&&this.repo[s].node){this.repo[s].node.classList.remove(this.class.balloonHidden);this.repo[s].node.classList.remove(this.class.balloonShow);this.repo[s].node.classList.add(this.class.balloonPublished);this.repo[s].node.lastElementChild.innerHTML=t.Loc.getMessage("MOBILE_EXT_LIVEFEED_PUBLICATION_QUEUE_SUCCESS_TITLE")}setTimeout(function(){n.removeFromTray(s)},5e3)}},{key:"drawItem",value:function e(){var s=t.Loc.getMessage("MOBILE_EXT_LIVEFEED_PUBLICATION_QUEUE_ITEM_TITLE");return t.Tag.render(d(),s)}},{key:"hideItem",value:function e(t,s){if(this.repo[t]){this.repo[t].node.classList.add(this.class.balloonHide)}}},{key:"drawList",value:function e(){var s=document.getElementById(this.nodeId.container);if(!t.Type.isDomNode(s)){return}t.Dom.clean(s);for(var n in this.repo){if(!this.repo.hasOwnProperty(n)||!t.Type.isDomNode(this.repo[n].node)){continue}t.Dom.append(this.repo[n].node,s)}}},{key:"afterSetItem",value:function e(s){var n=this;var i=s.key?s.key:"",o=s.pageId?s.pageId:"",a=s.contentType?s.contentType:"";if(o!=g.getPageId()||!i||!t.Type.isStringFilled(a)){return}if(a=="post"){this.addToTray(i,{key:i});setTimeout(function(){n.drawList()},this.timeout.show)}}},{key:"afterPostAdd",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}var n=s.key?s.key:"";this.addSuccess(n);this.drawList()}},{key:"afterPostUpdate",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}var n=s.key?s.key:"";this.addSuccess(n);this.drawList()}},{key:"afterPostAddError",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}var n=s.key?s.key:"";this.removeFromTray(n,{key:n});this.drawList()}},{key:"afterPostUpdateError",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}var n=s.key?s.key:"";this.removeFromTray(n,{key:n});this.drawList()}}]);return s}(s.EventEmitter);var p=function(){function e(t){babelHelpers.classCallCheck(this,e);this.logId=0;this.entryType="";this.useFollow=false;this.useTasks=false;this.perm="";this.destinations={};this.postId=0;this.url="";this.entityXmlId="";this.readOnly=false;this.contentTypeId="";this.contentId=0;this.showFull=false;this.taskId=0;this.taskData=null;this.calendarEventId=0;this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(s){var n=s.logId,i=s.entryType,o=s.useFollow,a=s.useTasks,l=s.perm,r=s.destinations,d=s.postId,c=s.url,p=s.entityXmlId,u=s.readOnly,h=s.contentTypeId,f=s.contentId,m=s.showFull,v=s.taskId,g=s.taskData,I=s.calendarEventId;n=parseInt(n);if(n<=0){return}this.logId=n;this.postId=parseInt(d);this.contentId=parseInt(f);this.taskId=parseInt(v);this.calendarEventId=parseInt(I);this.useFollow=!!o;this.useTasks=!!a;this.readOnly=!!u;this.showFull=!!m;if(t.Type.isStringFilled(i)){this.entryType=i}if(t.Type.isStringFilled(l)){this.perm=l}if(t.Type.isStringFilled(c)){this.url=c}if(t.Type.isStringFilled(p)){this.entityXmlId=p}if(t.Type.isStringFilled(h)){this.contentTypeId=h}if(t.Type.isStringFilled(g)){try{this.taskData=JSON.parse(g)}catch(e){this.taskData=null}}if(t.Type.isPlainObject(r)){this.destinations=r}}},{key:"setFavorites",value:function e(s){var n=this;if(this.logId<=0){return}var i=s.node,a=s.event;if(!t.Type.isDomNode(i)){i=document.getElementById("log_entry_favorites_"+this.logId)}if(t.Type.isDomNode(i)){var l=i.getAttribute("data-favorites")==="Y"?"Y":"N";var r=l==="Y"?"N":"Y";if(i.classList.contains("lenta-item-fav")){if(l==="Y"){i.classList.remove("lenta-item-fav-active")}else{i.classList.add("lenta-item-fav-active")}}i.setAttribute("data-favorites",r);o.Ajax.runAction("socialnetwork.api.livefeed.changeFavorites",{data:{logId:this.logId,value:r},analyticsLabel:{b24statAction:r==="Y"?"addFavorites":"removeFavorites",b24statContext:"mobile"}}).then(function(e){if(e.data.success){if(r==="Y"){oMSL.setFollow({logId:n.logId,bOnlyOn:true,bRunEvent:true,bAjax:false})}BXMobileApp.onCustomEvent("onLogEntryFavorites",{log_id:n.logId,page_id:t.Loc.getMessage("MSLPageId")},true)}else{i.setAttribute("data-favorites",l)}},function(){i.setAttribute("data-favorites",l)})}if(a instanceof Event){a.preventDefault();a.stopPropagation()}}},{key:"setPinned",value:function e(s){var n=this;if(this.logId<=0){return}var i=s.menuNode,a=s.context;if(t.Type.isDomNode(i)){var l=i.getAttribute("data-pinned")==="Y"?"Y":"N";var r=l==="Y"?"N":"Y";i.setAttribute("data-pinned",r);BXMobileApp.onCustomEvent("Livefeed::showLoader",{},true,true);o.Ajax.runAction("socialnetwork.api.livefeed.logentry."+(r==="Y"?"pin":"unpin"),{data:{params:{logId:this.logId}},analyticsLabel:{b24statAction:r==="Y"?"pinLivefeedEntry":"unpinLivefeedEntry",b24statContext:"mobile"}}).then(function(e){BXMobileApp.onCustomEvent("Livefeed::hideLoader",{},true,true);if(e.data.success){BXMobileApp.onCustomEvent("Livefeed.PinnedPanel::change",{logId:n.logId,value:r,postNode:i.closest(".lenta-item"),pinActionContext:a},true,true);BXMobileApp.onCustomEvent("Livefeed.PostDetail::pinChanged",{logId:n.logId,value:r},true,true)}else{i.setAttribute("data-pinned",l)}},function(){BXMobileApp.onCustomEvent("Livefeed::hideLoader",{},true,true);i.setAttribute("data-pinned",l)})}}},{key:"openDetail",value:function e(s){var n=s.pathToEmptyPage,i=s.pathToCalendarEvent,o=s.pathToTasksRouter,a=s.event,l=s.focusComments,r=s.showFull;if(!t.Type.isStringFilled(n)){return}if(this.taskId>0&&BXMobileAppContext.getApiVersion()>=31&&this.taskData){BXMobileApp.Events.postToComponent("taskbackground::task::action",[{id:this.taskId,title:"TASK",taskInfo:{title:this.taskData.title,creatorIcon:this.taskData.creatorIcon,responsibleIcon:this.taskData.responsibleIcon}},this.taskId,{taskId:this.taskId,getTaskInfo:true}])}else{var d=n;if(this.calendarEventId>0&&!l&&i.length>0){d=i.replace("#EVENT_ID#",this.calendarEventId)}else if(this.taskId>0&&this.taskData&&o.length>0){d=o.replace("__ROUTE_PAGE__","view").replace("#USER_ID#",t.Loc.getMessage("MOBILE_EXT_LIVEFEED_CURRENT_USER_ID"))+"&TASK_ID="+this.taskId}__MSLOpenLogEntryNew({path:d,log_id:this.logId,entry_type:this.entryType,use_follow:this.useFollow?"Y":"N",use_tasks:this.useTasks?"Y":"N",post_perm:this.perm,destinations:this.destinations,post_id:this.postId,post_url:this.url,entity_xml_id:this.entityXmlId,focus_comments:l,focus_form:false,show_full:this.showFull||r,read_only:this.readOnly?"Y":"N",post_content_type_id:this.contentTypeId,post_content_id:this.contentId},a)}}},{key:"initDetailPin",value:function e(){var t=document.getElementById("log-entry-menu-"+this.logId);if(!t){return}var s=t.closest(".post-wrap");if(!s){return}var n=t.getAttribute("data-pinned");if(n==="Y"){s.classList.add("lenta-item-pin-active")}else{s.classList.remove("lenta-item-pin-active")}}},{key:"expandText",value:function e(){oMSL.expandText(this.logId)}}]);return e}();var u=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"init",value:function e(s){this.iconUrlFolderPath="/bitrix/templates/mobile_app/images/lenta/menu/";this.sectionCode="defaultSection";this.logId=parseInt(s.logId);this.postId=parseInt(s.postId);this.postPerms=t.Type.isStringFilled(s.postPerms)?s.postPerms:"R";this.pageId=s.pageId;this.contentTypeId=t.Type.isStringFilled(s.contentTypeId)?s.contentTypeId:null;this.contentId=t.Type.isInteger(s.contentId)?s.contentId:0;this.useShare=!!s.useShare&&this.postId>0;this.useFavorites=!!s.useFavorites&&this.logId>0;this.useFollow=!!s.useFollow&&this.logId>0;this.usePinned=!!s.usePinned&&this.logId>0;this.useTasks=t.Loc.getMessage("MOBILE_EXT_LIVEFEED_USE_TASKS")==="Y";this.useRefreshComments=!!s.useRefreshComments;this.favoritesValue=!!s.favoritesValue;this.followValue=!!s.followValue;this.pinnedValue=!!s.pinnedValue;this.target=t.Type.isDomNode(s.target)?s.target:null;this.context=t.Type.isStringFilled(s.context)?s.context:"list"}},{key:"getMenuItems",value:function e(){var s=this;var n=[];if(this.usePinned){n.push({id:"pinned",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_PINNED_"+(!!this.pinnedValue?"Y":"N")),iconUrl:this.iconUrlFolderPath+(!!this.pinnedValue?"unpin.png":"pin.png"),sectionCode:this.sectionCode,action:function e(){var t=new p({logId:s.logId});return t.setPinned({menuNode:s.target,context:s.context})}})}if(this.useShare){var i={a_users:[],b_groups:[]};if(i.a_users.length>0||i.b_groups.length>0){n.push({id:"sharePost",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_SHARE"),iconName:"add",iconUrl:this.iconUrlFolderPath+"n_plus.png",sectionCode:this.sectionCode,action:function e(){app.openTable({callback:function e(){oMSL.shareBlogPost()},url:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR")+"mobile/index.php?mobile_action="+(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_CURRENT_EXTRANET_SITE")==="Y"?"get_group_list":"get_usergroup_list")+"&feature=blog",markmode:true,multiple:true,return_full_mode:true,user_all:true,showtitle:true,modal:true,selected:i,alphabet_index:true,okname:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SHARE_TABLE_BUTTON_OK"),cancelname:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SHARE_TABLE_BUTTON_CANCEL"),outsection:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DENIED")!=="Y"})},arrowFlag:false})}}if(this.postId>0&&this.postPerms==="W"){n.push({id:"edit",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_EDIT"),iconUrl:this.iconUrlFolderPath+"pencil.png",sectionCode:this.sectionCode,action:function e(){oMSL.editBlogPost({feed_id:window.LiveFeedID,post_id:s.postId,pinnedContext:!!s.pinnedValue})},arrowFlag:false,feature:"edit"});n.push({id:"delete",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_DELETE"),iconName:"delete",sectionCode:this.sectionCode,action:function e(){oMSL.deleteBlogPost({post_id:s.postId})},arrowFlag:false})}if(this.useFavorites){n.push({id:"favorites",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_FAVORITES_"+(!!this.favoritesValue?"Y":"N")),iconUrl:this.iconUrlFolderPath+"favorite.png",sectionCode:this.sectionCode,action:function e(){var t=new p({logId:s.logId});return t.setFavorites({node:s.target})},arrowFlag:false,feature:"favorites"})}if(this.useFollow){n.push({id:"follow",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_"+(!!this.followValue?"Y":"N")),iconUrl:this.iconUrlFolderPath+"eye.png",sectionCode:this.sectionCode,action:function e(){oMSL.setFollow({logId:s.logId,menuNode:s.target,pageId:s.pageId,bOnlyOn:false,bAjax:true,bRunEvent:true})},arrowFlag:false})}if(this.useRefreshComments){n.push({id:"refreshPostComments",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_REFRESH_COMMENTS"),iconUrl:this.iconUrlFolderPath+"n_refresh.png",action:function e(){if(oMSL.bDetailEmptyPage){oMSL.getComments({ts:oMSL.iDetailTs,bPullDown:true,obFocus:{form:false}})}else{document.location.reload(true)}},arrowFlag:false})}if(t.Type.isStringFilled(this.contentTypeId)&&this.contentId>0){n.push({id:"getPostLink",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_GET_LINK"),iconUrl:this.iconUrlFolderPath+"link.png",sectionCode:this.sectionCode,action:function e(){oMSL.copyPostLink({contentTypeId:s.contentTypeId,contentId:s.contentId})},arrowFlag:false});if(this.useTasks&&this.logId>0){n.push({id:"createTask",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_CREATE_TASK"),iconUrl:this.iconUrlFolderPath+"n_check.png",sectionCode:this.sectionCode,action:function e(){oMSL.createTask({entityType:s.contentTypeId,entityId:s.contentId,logId:s.logId});return false},arrowFlag:false})}}return n}}]);return e}();function h(){var e=babelHelpers.taggedTemplateLiteral(['<div class="','" data-livefeed-id="','">\n\t\t\t<div class="post-pinned-cancel-panel-content">\n\t\t\t\t<div class="post-pinned-cancel-panel-label">','</div>\n\t\t\t\t\t<div class="post-pinned-cancel-panel-text">','</div>\n\t\t\t\t</div>\n\t\t\t<div class="ui-btn ui-btn-light-border ui-btn-round ui-btn-sm ','">',"</div>\n\t\t</div>"]);h=function t(){return e};return e}var f=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.panelInitialized=false;this.class={panel:"lenta-pinned-panel",panelCollapsed:"lenta-pinned-panel-collapsed",panelActive:"lenta-pinned-panel-active",collapsedPanel:"lenta-pinned-collapsed-posts",collapsedPanelPostsValue:"lenta-pinned-collapsed-count-posts",collapsedPanelComments:"lenta-pinned-collapsed-posts-comments",collapsedPanelCommentsShown:"lenta-pinned-collapsed-posts-comments-active",collapsedPanelCommentsValue:"lenta-pinned-collapsed-count-comments",collapsedPanelCommentsValueNew:"post-item-inform-right-new-value",collapsedPanelExpandButton:"lenta-pinned-collapsed-posts-btn",post:"lenta-item",postItemPinned:"lenta-item-pinned",postItemPinActive:"lenta-item-pin-active",postItemPinnedBlock:"post-item-pinned-block",postItemPinnedTitle:"post-item-pinned-title",postItemPinnedTextBox:"post-item-pinned-text-box",postItemPinnedDesc:"post-item-pinned-desc",cancelPanel:"post-pinned-cancel-panel",cancelPanelButton:"post-pinned-cancel-panel-btn"};this.init();s.EventEmitter.subscribe("onFrameDataProcessed",function(){t.init()})}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this;var s=document.querySelector(".".concat(this.class.panel));if(!s||this.panelInitialized){return}this.panelInitialized=true;this.adjustCollapsedPostsPanel();var n=document.querySelector(".".concat(this.class.collapsedPanel));if(n){n.addEventListener("touchend",function(e){t.expandCollapsedPostsPanel();e.stopPropagation();return e.preventDefault()})}}},{key:"resetFlags",value:function e(){this.panelInitialized=false}},{key:"getPinnedPanelNode",value:function e(){return document.querySelector("[data-livefeed-pinned-panel]")}},{key:"recalcPanel",value:function e(t){var s=t.type;if(this.getPostsCount()>0){this.getPinnedPanelNode().classList.add("".concat(this.class.panelActive))}else{this.getPinnedPanelNode().classList.remove("".concat(this.class.panelActive))}this.recalcCollapsedPostsPanel({type:s})}},{key:"recalcCollapsedPostsPanel",value:function e(s){var n=s.type;if(this.getPostsCount()>=t.Loc.getMessage("MOBILE_EXT_LIVEFEED_COLLAPSED_PINNED_PANEL_ITEMS_LIMIT")){if(n==="insert"||this.getPinnedPanelNode().classList.contains("".concat(this.class.panelCollapsed))){this.getPinnedPanelNode().classList.add("".concat(this.class.panelCollapsed))}}else{this.getPinnedPanelNode().classList.remove("".concat(this.class.panelCollapsed))}this.adjustCollapsedPostsPanel()}},{key:"expandCollapsedPostsPanel",value:function e(){this.getPinnedPanelNode().classList.remove("".concat(this.class.panelCollapsed))}},{key:"getPostsCount",value:function e(){return Array.from(this.getPinnedPanelNode().getElementsByClassName("".concat(this.class.post))).length}},{key:"adjustCollapsedPostsPanel",value:function e(){var t=this.getPostsCount();var s=this.getPinnedPanelNode().querySelector(".".concat(this.class.collapsedPanelPostsValue));if(s){s.innerHTML=parseInt(t)}var n=this.getPinnedPanelNode().querySelector(".".concat(this.class.collapsedPanelComments));var i=this.getPinnedPanelNode().querySelector(".".concat(this.class.collapsedPanelCommentsValue));if(n&&i){var o=Array.from(this.getPinnedPanelNode().querySelectorAll(".".concat(this.class.collapsedPanelCommentsValueNew))).reduce(function(e,t){return e+parseInt(t.innerHTML)},0);i.innerHTML="+"+o;if(o>0){n.classList.add("".concat(this.class.collapsedPanelCommentsShown))}else{n.classList.remove("".concat(this.class.collapsedPanelCommentsShown))}}}},{key:"getPinnedData",value:function e(t){var s=t.logId?parseInt(t.logId):0;if(s<=0){return Promise.reject()}return new Promise(function(e,t){o.Ajax.runAction("socialnetwork.api.livefeed.logentry.getPinData",{data:{params:{logId:s}}}).then(function(s){if(s.status==="success"){e(s.data)}else{t(s.errors)}},function(e){t()})})}},{key:"insertEntry",value:function e(s){var n=this;var i=s.logId,o=s.postNode,a=s.pinnedContent;var l=this.getPinnedPanelNode();if(!t.Type.isDomNode(o)||!t.Type.isDomNode(l)){return}var r=o.querySelector(".".concat(this.class.postItemPinnedBlock));if(!t.Type.isDomNode(r)){return}o.classList.add(this.class.postItemPinned);o.classList.add(this.class.postItemPinActive);r.innerHTML="".concat(t.Type.isStringFilled(a.TITLE)?'<div class="'.concat(this.class.postItemPinnedTitle,'">').concat(a.TITLE,"</div>"):"",'<div class="').concat(this.class.postItemPinnedTextBox,'"><div class="').concat(this.class.postItemPinnedDesc,'">').concat(a.DESCRIPTION,"</div></div>");var d=t.Tag.render(h(),this.class.cancelPanel,i,t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_PINNED_CANCEL_TITLE"),t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_PINNED_CANCEL_DESCRIPTION"),this.class.cancelPanelButton,t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_PINNED_CANCEL_BUTTON"));var c=d.querySelector(".".concat(this.class.cancelPanelButton));c.addEventListener("touchend",function(e){var t=e.currentTarget.closest(".".concat(n.class.cancelPanel));if(!t){return}var s=parseInt(t.getAttribute("data-livefeed-id"));if(s<=0){return}var i=document.querySelector(".".concat(n.class.post,'[data-livefeed-id="').concat(s,'"]'));if(!i){return}var o=i.querySelector('[data-menu-type="post"]');if(!o){return}var a=new p({logId:s});return a.setPinned({menuNode:o,context:"list"})});o.parentNode.insertBefore(d,o);t.Dom.prepend(o,l);this.recalcPanel({type:"insert"});__MSLOnFeedScroll()}},{key:"extractEntry",value:function e(s){var n=s.logId,i=s.postNode,o=s.containerNode;var a=this.getPinnedPanelNode();if(!t.Type.isDomNode(i)||!t.Type.isDomNode(o)||!t.Type.isDomNode(a)||i.parentNode!==a||parseInt(n)<=0){return}i.classList.remove(this.class.postItemPinned);i.classList.remove(this.class.postItemPinActive);var l=document.querySelector(".".concat(this.class.cancelPanel,'[data-livefeed-id="').concat(parseInt(n),'"]'));if(l){l.parentNode.insertBefore(i,l);t.Dom.remove(l)}else{t.Dom.prepend(i,o)}this.recalcPanel({type:"extract"})}}]);return e}();function m(){var e=babelHelpers.taggedTemplateLiteral(['<div class="'," ",'" ontransitionend="','"></div>']);m=function t(){return e};return e}var v=function(){function e(){babelHelpers.classCallCheck(this,e);this.pageId=null;this.refreshNeeded=false;this.refreshStarted=false;this.options={};this.nodeId={feedContainer:"lenta_wrapper"};this.class={listWrapper:"lenta-list-wrap",postWrapper:"post-wrap",pinnedPanel:"lenta-pinned-panel",pin:"lenta-item-pin",postNewContainerTransformNew:"lenta-item-new-cont",postNewContainerTransform:"lenta-item-transform-cont",postLazyLoadCheck:"lenta-item-lazyload-check",listPost:"lenta-item",detailPost:"post-wrap",postItemTopWrap:"post-item-top-wrap",postItemTop:"post-item-top",postItemPostBlock:"post-item-post-block",postItemPostContentView:"post-item-contentview",postItemDescriptionBlock:"post-item-description",postItemAttachedFileWrap:"post-item-attached-disk-file-wrap",postItemInformWrap:"post-item-inform-wrap",postItemInformWrapTree:"post-item-inform-wrap-tree",postItemInformComments:"post-item-inform-comments",postItemInformMore:"post-item-more",postItemMore:"post-more-block",postItemPinnedBlock:"post-item-pinned-block",postItemPinActive:"lenta-item-pin-active"};this.newPostContainer=null;this.maxScroll=0;this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this;BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAdd",this.afterPostAdd.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAddError",this.afterPostAddError.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdate",this.afterPostUpdate.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdateError",this.afterPostUpdateError.bind(this));BXMobileApp.addCustomEvent("Livefeed::showLoader",this.showLoader.bind(this));BXMobileApp.addCustomEvent("Livefeed::hideLoader",this.hideLoader.bind(this));BXMobileApp.addCustomEvent("Livefeed::scrollTop",this.scrollTop.bind(this));BXMobileApp.addCustomEvent("Livefeed::onLogEntryDetailNotFound",this.removePost.bind(this));BXMobileApp.addCustomEvent("Livefeed.PinnedPanel::change",this.onPinnedPanelChange.bind(this));BXMobileApp.addCustomEvent("Livefeed.PostDetail::pinChanged",this.onPostPinChanged.bind(this));s.EventEmitter.subscribe("BX.LazyLoad:ImageLoaded",this.onLazyLoadImageLoaded.bind(this));s.EventEmitter.subscribe("MobilePlayer:onError",this.onMobilePlayerError);document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",t.handleClick.bind(t))})}},{key:"setPageId",value:function e(t){this.pageId=t}},{key:"getPageId",value:function e(){return this.pageId}},{key:"setOptions",value:function e(t){for(var s in t){if(!t.hasOwnProperty(s)){continue}this.options[s]=t[s]}}},{key:"getOption",value:function e(s,n){if(t.Type.isUndefined(n)){n=null}if(!t.Type.isStringFilled(s)){return null}return!t.Type.isUndefined(this.options[s])?this.options[s]:n}},{key:"setRefreshNeeded",value:function e(t){this.refreshNeeded=t}},{key:"getRefreshNeeded",value:function e(){return this.refreshNeeded}},{key:"setRefreshStarted",value:function e(t){this.refreshStarted=t}},{key:"getRefreshStarted",value:function e(){return this.refreshStarted}},{key:"setNewPostContainer",value:function e(t){this.newPostContainer=t}},{key:"getNewPostContainer",value:function e(){return this.newPostContainer}},{key:"setMaxScroll",value:function e(t){this.maxScroll=t}},{key:"getMaxScroll",value:function e(){return this.maxScroll}},{key:"afterPostAdd",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}var n=typeof s.postId!="undefined"?parseInt(s.postId):0;var i=typeof s.context!="undefined"?s.context:"";var o=typeof s.pageId!="undefined"?s.pageId:"";var a=typeof s.groupId!="undefined"?s.groupId:null;if(o!==this.pageId){return}E.delete(a);if(n<=0){return}this.getEntryContent({entityType:"BLOG_POST",entityId:n,queueKey:s.key,action:"add"})}},{key:"afterPostUpdate",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}var n=typeof s.context!="undefined"?s.context:"";var i=typeof s.pageId!="undefined"?s.pageId:"";var o=typeof s.postId!="undefined"?parseInt(s.postId):0;var a=typeof s.pinned!="undefined"&&!!s.pinned;this.getEntryContent({entityType:"BLOG_POST",entityId:o,queueKey:s.key,action:"update",pinned:a})}},{key:"afterPostAddError",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}var n=t.Type.isStringFilled(s.context)?s.context:"";var i=s.groupId?s.groupId:"";var o={a_users:[],b_groups:[]};oMSL.buildSelectedDestinations(s.postData,o);oMSL.setPostFormParams({selectedRecipients:o});oMSL.setPostFormParams({messageText:s.postData.POST_MESSAGE});E.save(s.postData,i);s.callback=function(){app.exec("showPostForm",oMSL.showNewPostForm())};this.showPostError(s)}},{key:"afterPostUpdateError",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}var n=t.Type.isStringFilled(s.context)?s.context:"";s.callback=function(){oMSL.editBlogPost({post_id:parseInt(s.postId)})};this.showPostError(s)}},{key:"showPostError",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}s.callback=t.Type.isFunction(s.callback)?s.callback:function(){};var n=t.Type.isStringFilled(s.errorText)?s.errorText:false;y.showError({text:n?n:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_PUBLICATION_ERROR"),onTap:function e(t){s.callback(t)}})}},{key:"showLoader",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}if(s.pageId&&this.pageId!==null&&s.pageId!=this.pageId){return}app.showPopupLoader({text:t.Type.isStringFilled(s.text)?s.text:""})}},{key:"hideLoader",value:function e(){app.hidePopupLoader()}},{key:"scrollTop",value:function e(s){if(!t.Type.isPlainObject(s)){s={}}if(s.pageId&&this.pageId!==null&&s.pageId!=this.pageId){return}window.scrollTo(0,0)}},{key:"getEntryContent",value:function e(s){var n=this;if(!t.Type.isPlainObject(s)){s={}}var i=s.logId?parseInt(s.logId):0;if(i<=0&&!(t.Type.isStringFilled(s.entityType)&&parseInt(s.entityId)>0)){return}o.Ajax.runComponentAction("bitrix:mobile.socialnetwork.log.ex","getEntryContent",{mode:"class",signedParameters:this.getOption("signedParameters",{}),data:{params:{logId:parseInt(s.logId)>0?parseInt(s.logId):0,pinned:!!s.pinned?"Y":"N",entityType:t.Type.isStringFilled(s.entityType)?s.entityType:"",entityId:parseInt(s.entityId)>0?parseInt(s.entityId):0,siteTemplateId:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_TEMPLATE_ID")}}}).then(function(e){if(i<=0){o.Ajax.runComponentAction("bitrix:mobile.socialnetwork.log.ex","getEntryLogId",{mode:"class",data:{params:{entityType:t.Type.isStringFilled(s.entityType)?s.entityType:"",entityId:parseInt(s.entityId)>0?parseInt(s.entityId):0}}}).then(function(t){if(t.data.logId){n.insertPost({logId:t.data.logId,content:e.data.html,postId:s.postId,queueKey:s.queueKey,action:s.action,serverTimestamp:parseInt(e.data.componentResult.serverTimestamp)})}})}else{n.insertPost({logId:i,content:e.data.html,postId:s.postId,queueKey:s.queueKey,action:s.action,serverTimestamp:parseInt(e.data.componentResult.serverTimestamp)})}})}},{key:"processDetailBlock",value:function e(s,n,i){if(!s||!n){return Promise.reject()}var o=n.querySelector(i);var a=s.querySelector(i);if(a&&o){return t.Runtime.html(a,o.innerHTML)}return Promise.reject()}},{key:"insertPost",value:function e(n){var o=this;var a=document.getElementById(this.nodeId.feedContainer);var l=n.content;var r=n.logId;var d=n.queueKey;var c=n.action;if(!t.Type.isDomNode(a)||!t.Type.isStringFilled(l)){return}if(c==="update"){var p=document.getElementById("lenta_item_"+r);if(!p){p=document.getElementById("lenta_item")}if(!p){return}var u=this.pageId.match(/^detail_(\d+)/i);if(u&&r!=u[1]){return}var h=p.appendChild(document.createElement("div"));h.style.display="none";t.Runtime.html(h,l);if(p.id==="lenta_item"){this.processDetailBlock(p,h,".".concat(this.class.postItemTop));this.processDetailBlock(p,h,".".concat(this.class.postItemPostBlock)).then(function(){BitrixMobile.LazyLoad.showImages()});this.processDetailBlock(p,h,".".concat(this.class.postItemAttachedFileWrap)).then(function(){BitrixMobile.LazyLoad.showImages()});this.processDetailBlock(p,h,".".concat(this.class.postItemInformWrap));this.processDetailBlock(p,h,".".concat(this.class.postItemInformWrapTree))}else{p=p.querySelector("div.".concat(this.class.postItemTopWrap));var f=h.querySelector("div.".concat(this.class.postItemTopWrap));t.Runtime.html(p,f.innerHTML).then(function(){BitrixMobile.LazyLoad.showImages()})}h.remove()}else if(c==="add"){this.setNewPostContainer(t.Tag.render(m(),this.class.postNewContainerTransformNew,this.class.postLazyLoadCheck,this.handleInsertPostTransitionEnd.bind(this)));t.Dom.prepend(this.getNewPostContainer(),a);i.Utils.htmlWithInlineJS(this.getNewPostContainer(),l).then(function(){var e=o.getNewPostContainer().querySelector("div.".concat(o.class.listPost));t.Dom.style(o.getNewPostContainer(),"height","".concat(e.scrollHeight+12,"px"));var s=typeof n.serverTimestamp!="undefined"&&parseInt(n.serverTimestamp)>0?parseInt(n.serverTimestamp):0;if(s>0){o.setOptions({frameCacheTs:s})}o.updateFrameCache({timestamp:s})})}T.emit("onPostInserted",new s.BaseEvent({data:{key:d}}))}},{key:"removePost",value:function e(t){var s=parseInt(t.logId);if(s<=0){return}var n=document.getElementById("lenta_item_"+s);if(!n){return}n.remove()}},{key:"handleInsertPostTransitionEnd",value:function e(s){if(s.propertyName==="height"){this.getNewPostContainer().classList.remove(this.class.postNewContainerTransformNew);this.getNewPostContainer().classList.remove(this.class.postNewContainerTransform);t.Dom.style(this.getNewPostContainer(),"height",null);this.recalcMaxScroll();BitrixMobile.LazyLoad.showImages()}}},{key:"onLazyLoadImageLoaded",value:function e(s){var n=this;this.recalcMaxScroll();var i=s.getData(),o=babelHelpers.slicedToArray(i,1),a=o[0];if(a){var l=a.closest(".".concat(this.class.postLazyLoadCheck));if(l){var r=l.querySelector("div.".concat(this.class.listPost));if(r){l.classList.add(this.class.postNewContainerTransform);t.Dom.style(l,"height","".concat(r.scrollHeight,"px"));setTimeout(function(){l.classList.remove(n.class.postNewContainerTransform);t.Dom.style(l,"height",null)},500)}}}}},{key:"recalcMaxScroll",value:function e(){this.setMaxScroll(document.documentElement.scrollHeight-window.innerHeight-190)}},{key:"setPreventNextPage",value:function e(t){this.setOptions({preventNextPage:!!t});var s=document.getElementById("next_page_refresh_needed");var n=document.getElementById("next_post_more");if(s&&n){s.style.display=!!t?"block":"none";n.style.display=!!t?"none":"block"}}},{key:"onPinnedPanelChange",value:function e(s){var n=s.logId?parseInt(s.logId):0;var i=["Y","N"].indexOf(s.value)!==-1?s.value:null;var o=t.Type.isStringFilled(s.pinActionContext)?s.pinActionContext:"list";if(!n||!i||!b.getPinnedPanelNode()){return}var a=t.Type.isDomNode(s.postNode)?s.postNode:null;if(!t.Type.isDomNode(s.postNode)){a=document.getElementById("lenta_item_".concat(n))}if(!t.Type.isDomNode(a)){return}if(i==="N"){b.extractEntry({logId:n,postNode:a,containerNode:document.getElementById(this.nodeId.feedContainer)})}else if(i==="Y"){if(t.Type.isDomNode(s.postNode)){app.showPopupLoader({text:""});b.getPinnedData({logId:n}).then(function(e){app.hidePopupLoader();b.insertEntry({logId:n,postNode:s.postNode,pinnedContent:e})},function(e){app.hidePopupLoader()})}}}},{key:"onPostPinChanged",value:function e(t){var s=t.logId?parseInt(t.logId):0;var n=["Y","N"].indexOf(t.value)!==-1?t.value:null;if(!s||!n){return}var i=document.getElementById("log-entry-menu-"+s);if(!i){return}var o=i.closest(".".concat(this.class.detailPost));if(!o){o=i.closest(".".concat(this.class.listPost))}if(!o){return}if(n==="Y"){o.classList.add(this.class.postItemPinActive)}else{o.classList.remove(this.class.postItemPinActive)}}},{key:"handleClick",value:function e(s){if(s.target.classList.contains(this.class.pin)){var n=null;var i=null;var o="list";var a=s.target.closest(".".concat(this.class.listPost));if(a){i=a.querySelector('[data-menu-type="post"]');n=this.getPostFromNode(a)}else{o="detail";a=s.target.closest(".".concat(this.class.detailPost));if(a){i=a.querySelector('[data-menu-type="post"]');if(i){n=this.getPostFromLogId(i.getAttribute("data-log-id"))}}}if(n&&i){return n.setPinned({menuNode:i,context:o})}s.stopPropagation();return s.preventDefault()}else if((s.target.closest(".".concat(this.class.listWrapper))||s.target.closest(".".concat(this.class.pinnedPanel)))&&!(s.target.tagName.toLowerCase()==="a"&&t.Type.isStringFilled(s.target.getAttribute("target"))&&s.target.getAttribute("target").toLowerCase()==="_blank")){var l=!!(s.target.classList.contains(this.class.postItemPinnedBlock)||s.target.closest(".".concat(this.class.postItemPinnedBlock)));var r=!!(!l&&(s.target.classList.contains(this.class.postItemPostContentView)||s.target.closest(".".concat(this.class.postItemPostContentView))||s.target.classList.contains(this.class.postItemDescriptionBlock)||s.target.closest(".".concat(this.class.postItemDescriptionBlock))));var d=!!(!l&&!r&&(s.target.classList.contains(this.class.postItemInformComments)||s.target.closest(".".concat(this.class.postItemInformComments))));var c=!!(!l&&!r&&!d&&(s.target.classList.contains(this.class.postItemInformMore)||s.target.closest(".".concat(this.class.postItemInformMore))));if(l||r||d||c){var u=s.target.closest(".".concat(this.class.listPost));if(u){var h=this.getPostFromNode(u);if(h){h.openDetail({pathToEmptyPage:this.getOption("pathToEmptyPage",""),pathToCalendarEvent:this.getOption("pathToCalendarEvent",""),pathToTasksRouter:this.getOption("pathToTasksRouter",""),event:s,focusComments:d,showFull:c})}}s.stopPropagation();return s.preventDefault()}}else if(s.target.closest(".".concat(this.class.postWrapper))){var f=!!(s.target.classList.contains(this.class.postItemInformMore)||s.target.closest(".".concat(this.class.postItemInformMore))||s.target.classList.contains(this.class.postItemMore)||s.target.closest(".".concat(this.class.postItemMore)));if(f){var m=this.getOption("logId",0);var v=new p({logId:m});v.expandText();s.stopPropagation();return s.preventDefault()}}}},{key:"getPostFromNode",value:function e(s){if(!t.Type.isDomNode(s)){return}var n=parseInt(s.getAttribute("data-livefeed-id"));if(n<=0){return}return new p({logId:n,entryType:s.getAttribute("data-livefeed-post-entry-type"),useFollow:s.getAttribute("data-livefeed-post-use-follow")==="Y",useTasks:s.getAttribute("data-livefeed-post-use-tasks")==="Y",perm:s.getAttribute("data-livefeed-post-perm"),destinations:s.getAttribute("data-livefeed-post-destinations"),postId:parseInt(s.getAttribute("data-livefeed-post-id")),url:s.getAttribute("data-livefeed-post-url"),entityXmlId:s.getAttribute("data-livefeed-post-entity-xml-id"),readOnly:s.getAttribute("data-livefeed-post-read-only")==="Y",contentTypeId:s.getAttribute("data-livefeed-post-content-type-id"),contentId:s.getAttribute("data-livefeed-post-content-id"),showFull:s.getAttribute("data-livefeed-post-show-full")==="Y",taskId:parseInt(s.getAttribute("data-livefeed-task-id")),taskData:s.getAttribute("data-livefeed-task-data"),calendarEventId:parseInt(s.getAttribute("data-livefeed-calendar-event-id"))})}},{key:"getPostFromLogId",value:function e(t){var s=null;t=parseInt(t);if(t<=0){return s}s=new p({logId:t});return s}},{key:"updateFrameCache",value:function e(s){var n=document.getElementById("framecache-block-feed");if(!t.Type.isDomNode(n)){n=document.getElementById("bxdynamic_feed_refresh")}if(!t.Type.isDomNode(n)){return}var i={USE_BROWSER_STORAGE:true,AUTO_UPDATE:true,USE_ANIMATION:false};var o=typeof s.timestamp!="undefined"?parseInt(s.timestamp):0;if(o>0){i.TS=o}BX.frameCache.writeCacheWithID("framecache-block-feed",n.innerHTML,parseInt(Math.random()*1e5),JSON.stringify(i))}},{key:"onMobilePlayerError",value:function e(s){var n=s.getData(),i=babelHelpers.slicedToArray(n,2),o=i[0],a=i[1];if(!t.Type.isDomNode(o)){return}if(!t.Type.isStringFilled(a)){return}var l=o.parentNode;if(l){if(l.querySelector(".disk-mobile-player-error-container")){return}}else{if(o.querySelector(".disk-mobile-player-error-container")){return}}var r=o.getElementsByTagName("source");var d=r.length;Array.from(r).forEach(function(e){if(t.Type.isStringFilled(e.src)&&e.src===a){t.Dom.remove(e);d--}});if(d>0){return}var c=t.Dom.create("div",{props:{className:"disk-mobile-player-error-container"},children:[t.Dom.create("div",{props:{className:"disk-mobile-player-error-icon"},html:""}),t.Dom.create("div",{props:{className:"disk-mobile-player-error-message"},html:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_PLAYER_ERROR_MESSAGE")})]});var p=c.querySelector(".disk-mobile-player-download");if(p){t.Dom.adjust(p,{events:{click:function e(){app.openDocument({url:a})}}})}if(l){o.style.display="none";l.appendChild(c)}else{t.Dom.adjust(o,{children:[c]})}}}]);return e}();var g=new v;var I=new a;var y=new l;var E=new r;var T=new c;var P=new u;var b=new f;e.Instance=g;e.BalloonNotifierInstance=I;e.NotificationBarInstance=y;e.DatabaseUnsentPostInstance=E;e.PublicationQueueInstance=T;e.PostMenuInstance=P;e.PinnedPanelInstance=b})(this.BX.MobileLivefeed=this.BX.MobileLivefeed||{},BX,BX.Event,BX,BX,BX.Mobile);
//# sourceMappingURL=livefeed.bundle.map.js