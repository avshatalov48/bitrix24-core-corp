this.BX=this.BX||{};(function(e,t,i,s,n){"use strict";var a=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.initialized=false;this.classes={show:"lenta-notifier-shown"};this.nodeIdList={notifier:"lenta_notifier",notifierCounter:"lenta_notifier_cnt",notifierCounterTitle:"lenta_notifier_cnt_title",refreshNeeded:"lenta_notifier_2",refreshError:"lenta_refresh_error",nextPageError:"lenta_nextpage_error"};this.init();i.EventEmitter.subscribe("onFrameDataProcessed",(function(){t.init()}))}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this.getNotifierNode();if(!t||this.initialized){return}this.initialized=true;this.initEvents()}},{key:"initEvents",value:function e(){var t=this.getNotifierNode();t.addEventListener("click",(function(){Q.refresh(true);return false}));var i=this.getRefreshNeededNode();if(i){i.addEventListener("click",(function(){app.exec("pullDownLoadingStart");Q.refresh(true);return false}))}var s=this.getRefreshErrorNode();if(s){s.addEventListener("click",(function(){Q.requestError("refresh",false)}))}var n=this.getNextPageErrorNode();if(n){n.addEventListener("click",(function(){Q.requestError("nextPage",false)}))}}},{key:"getNotifierNode",value:function e(){return document.getElementById(this.nodeIdList.notifier)}},{key:"getNotifierCounterNode",value:function e(){return document.getElementById(this.nodeIdList.notifierCounter)}},{key:"getNotifierCounterTitleNode",value:function e(){return document.getElementById(this.nodeIdList.notifierCounterTitle)}},{key:"getRefreshNeededNode",value:function e(){return document.getElementById(this.nodeIdList.refreshNeeded)}},{key:"getRefreshErrorNode",value:function e(){return document.getElementById(this.nodeIdList.refreshError)}},{key:"getNextPageErrorNode",value:function e(){return document.getElementById(this.nodeIdList.nextPageError)}},{key:"showRefreshNeededNotifier",value:function e(){var t=this.getRefreshNeededNode();if(t){t.classList.add(this.classes.show)}}},{key:"hideRefreshNeededNotifier",value:function e(){var t=this.getRefreshNeededNode();if(t){t.classList.remove(this.classes.show)}}},{key:"showNotifier",value:function e(i){var s=parseInt(i.counterValue);var n=s%100,a=s%10;var o="";if(n>=10&&n<15){o=3}else if(a==0){o=3}else if(a==1){o=1}else if(a==2||a==3||a==4){o=2}else{o=3}if(A.getRefreshNeeded()){this.getNotifierCounterNode().innerHTML=s?s+"+":"";this.hideRefreshNeededNotifier()}else{this.getNotifierCounterNode().innerHTML=s||""}this.getNotifierCounterTitleNode().innerHTML=t.Loc.getMessage("MOBILE_EXT_LIVEFEED_COUNTER_TITLE_"+o);this.getNotifierNode().classList.add(this.classes.show)}},{key:"hideNotifier",value:function e(){var t=this.getNotifierNode();if(t){t.classList.remove(this.classes.show)}}}]);return e}();var o=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.initialized=false;this.init();i.EventEmitter.subscribe("onFrameDataProcessed",(function(){t.init()}))}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this.getButtonNode();if(!t||this.initialized){return}this.initialized=true;this.initEvents()}},{key:"initEvents",value:function e(){var t=this.getButtonNode();t.addEventListener("click",(function(e){Q.refresh(true);return false}))}},{key:"getButtonNode",value:function e(){return document.getElementById("next_page_refresh_needed_button")}},{key:"startWaiter",value:function e(){var t=this.getButtonNode();if(t){t.classList.add("--loading")}}},{key:"stopWaiter",value:function e(){var t=this.getButtonNode();if(t){t.classList.remove("--loading")}}}]);return e}();var r=function(){function e(){babelHelpers.classCallCheck(this,e);this.repo=[];this.color={background:{error:"#affb0000",info:"#3a3735"},text:{error:"#ffffff",info:"#ffffff"}}}babelHelpers.createClass(e,[{key:"hideAll",value:function e(){this.repo=this.repo.filter((function(e){return e}));this.repo.forEach((function(e){e.hide()}))}},{key:"showError",value:function e(t){var i=new BXMobileApp.UI.NotificationBar({message:t.text?t.text:"",color:this.color.background.error,textColor:this.color.text.error,useLoader:t.useLoader?!!t.useLoader:false,groupId:t.groupId?t.groupId:"",align:t.textAlign?t.textAlign:"center",autoHideTimeout:t.autoHideTimeout?t.autoHideTimeout:3e4,hideOnTap:t.hideOnTap?!!t.hideOnTap:true,onTap:t.onTap?t.onTap:function(){}},t.id?t.id:parseInt(Math.random()*1e5));this.repo.push(i);i.show()}},{key:"showInfo",value:function e(t){var i=new BXMobileApp.UI.NotificationBar({message:t.text?t.text:"",color:this.color.background.info,textColor:this.color.text.info,useLoader:t.useLoader?!!t.useLoader:false,groupId:t.groupId?t.groupId:"",maxLines:t.maxLines?t.maxLines:false,align:t.textAlign?t.textAlign:"center",isGlobal:t.isGlobal?!!t.isGlobal:true,useCloseButton:t.useCloseButton?!!t.useCloseButton:true,autoHideTimeout:t.autoHideTimeout?t.autoHideTimeout:1e3,hideOnTap:t.hideOnTap?!!t.hideOnTap:true},t.id?t.id:parseInt(Math.random()*1e5));this.repo.push(i);i.show()}}]);return e}();var l=function(){function e(i){babelHelpers.classCallCheck(this,e);this.tableName=null;this.keyName=null;this.setTableName(t.Type.isPlainObject(i)&&t.Type.isStringFilled(i.tableName)?i.tableName:"livefeed");this.setKeyName(t.Type.isPlainObject(i)&&t.Type.isStringFilled(i.keyName)?i.keyName:"postUnsent");this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){BXMobileApp.addCustomEvent("Livefeed.Database::clear",this.onClear.bind(this))}},{key:"setTableName",value:function e(t){this.tableName=t}},{key:"getTableName",value:function e(){return this.tableName}},{key:"setKeyName",value:function e(t){this.keyName=t}},{key:"getKeyName",value:function e(){return this.keyName}},{key:"onClear",value:function e(t){this["delete"](t.groupId)}},{key:"delete",value:function e(t){if(parseInt(t)<=0){t=false}app.exec("setStorageValue",{storageId:this.getTableName(),key:this.getKeyName()+(t?"_"+t:""),value:{},callback:function e(t){}})}},{key:"save",value:function e(t,i){if(parseInt(i)<=0){i=false}for(var s in t){if(!t.hasOwnProperty(s)){continue}if(s==="sessid"){delete t[s];break}}app.exec("setStorageValue",{storageId:this.getTableName(),key:this.getKeyName()+(i?"_"+i:""),value:t,callback:function e(t){}})}},{key:"load",value:function e(i,s){if(parseInt(s)<=0){s=false}app.exec("getStorageValue",{storageId:this.getTableName(),key:this.getKeyName()+(s?"_"+s:""),callback:function e(s){s=t.Type.isPlainObject(s)?s:t.Type.isStringFilled(s)?JSON.parse(s):{};if(t.Type.isPlainObject(s)&&Object.keys(s).length>0){i.onLoad(s)}else{i.onEmpty()}}})}}]);return e}();var c;var d=function(e){babelHelpers.inherits(i,e);function i(){var e;babelHelpers.classCallCheck(this,i);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this));e.repo={};e.nodeId={container:"post-balloon-container"};e["class"]={balloonHidden:"post-balloon-hidden",balloonFixed:"post-balloon-box-fixed",balloonPublished:"post-balloon-done",balloonShow:"post-balloon-show",balloonHide:"post-balloon-hide"};e.timeout={show:750};e.init();return e}babelHelpers.createClass(i,[{key:"init",value:function e(){BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterSetItem",this.afterSetItem.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAdd",this.afterPostAdd.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAddError",this.afterPostAddError.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdate",this.afterPostUpdate.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdateError",this.afterPostUpdateError.bind(this));this.setEventNamespace("BX.Mobile.Livefeed");this.subscribe("onFeedReady",this.onFeedLoaded.bind(this));this.subscribe("onPostInserted",this.onPostInserted.bind(this));t.Event.bind(document,"scroll",this.onScroll.bind(this))}},{key:"onScroll",value:function e(){var i=document.getElementById(this.nodeId.container);if(!t.Type.isDomNode(i)){return}if(window.pageYOffset>0){i.classList.add(this["class"].balloonFixed)}else{i.classList.remove(this["class"].balloonFixed)}}},{key:"onFeedLoaded",value:function e(){var i=this;app.exec("getStorageValue",{storageId:"livefeed",key:"publicationQueue",callback:function e(s){s=t.Type.isPlainObject(s)?s:t.Type.isStringFilled(s)?JSON.parse(s):{};if(!t.Type.isPlainObject(s)){return}for(var n in s){if(!s.hasOwnProperty(n)){continue}i.addToTray(n,{})}i.drawList()}})}},{key:"onPostInserted",value:function e(t){this.removeFromTray(t.data.key)}},{key:"addToTray",value:function e(t,i){this.repo[t]=i;this.repo[t].node=this.drawItem();this.repo[t].node.classList.add(this["class"].balloonShow)}},{key:"removeFromTray",value:function e(t,i){var s=this;this.hideItem(t);setTimeout((function(){if(s.repo[t]){delete s.repo[t]}}),3e3)}},{key:"addSuccess",value:function e(i,s){var n=this;if(this.repo[i]&&this.repo[i].node){this.repo[i].node.classList.remove(this["class"].balloonHidden);this.repo[i].node.classList.remove(this["class"].balloonShow);this.repo[i].node.classList.add(this["class"].balloonPublished);this.repo[i].node.lastElementChild.innerHTML=t.Type.isStringFilled(s)?s:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_PUBLICATION_QUEUE_SUCCESS_TITLE")}setTimeout((function(){n.removeFromTray(i)}),5e3)}},{key:"drawItem",value:function e(){var i=t.Loc.getMessage("MOBILE_EXT_LIVEFEED_PUBLICATION_QUEUE_ITEM_TITLE");return t.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="post-balloon-hidden post-balloon post-balloon-active"><span class="post-balloon-icon"></span><span class="post-balloon-text">',"</span></div>\n\t\t\t"])),i)}},{key:"hideItem",value:function e(t,i){if(this.repo[t]){this.repo[t].node.classList.add(this["class"].balloonHide)}}},{key:"drawList",value:function e(){var i=document.getElementById(this.nodeId.container);if(!t.Type.isDomNode(i)){return}t.Dom.clean(i);for(var s in this.repo){if(!this.repo.hasOwnProperty(s)||!t.Type.isDomNode(this.repo[s].node)){continue}t.Dom.append(this.repo[s].node,i)}}},{key:"afterSetItem",value:function e(i){var s=this;var n=i.key?i.key:"",a=i.pageId?i.pageId:"",o=i.contentType?i.contentType:"";if(a!=A.getPageId()||!n||!t.Type.isStringFilled(o)){return}if(o=="post"){this.addToTray(n,{key:n});setTimeout((function(){s.drawList()}),this.timeout.show)}}},{key:"afterPostAdd",value:function e(i){if(!t.Type.isPlainObject(i)){i={}}this.addSuccess(i.key?i.key:"",i.warningText);this.drawList()}},{key:"afterPostUpdate",value:function e(i){if(!t.Type.isPlainObject(i)){i={}}this.addSuccess(i.key?i.key:"");this.drawList()}},{key:"afterPostAddError",value:function e(i){if(!t.Type.isPlainObject(i)){i={}}var s=i.key?i.key:"";this.removeFromTray(s,{key:s});this.drawList()}},{key:"afterPostUpdateError",value:function e(i){if(!t.Type.isPlainObject(i)){i={}}var s=i.key?i.key:"";this.removeFromTray(s,{key:s});this.drawList()}}]);return i}(i.EventEmitter);var u=function(){babelHelpers.createClass(e,null,[{key:"moveBottom",value:function e(){window.scrollTo(0,document.body.scrollHeight)}},{key:"moveTop",value:function e(){window.scrollTo(0,0)}}]);function e(t){babelHelpers.classCallCheck(this,e);this.logId=0;this.entryType="";this.useFollow=false;this.useTasks=false;this.perm="";this.destinations={};this.postId=0;this.url="";this.entityXmlId="";this.readOnly=false;this.contentTypeId="";this.contentId=0;this.showFull=false;this.taskId=0;this.taskData=null;this.calendarEventId=0;this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(i){var s=i.logId,n=i.entryType,a=i.useFollow,o=i.useTasks,r=i.perm,l=i.destinations,c=i.postId,d=i.url,u=i.entityXmlId,p=i.readOnly,f=i.contentTypeId,m=i.contentId,h=i.showFull,g=i.taskId,v=i.taskData,E=i.calendarEventId;s=parseInt(s);if(s<=0){return}this.logId=s;this.postId=parseInt(c);this.contentId=parseInt(m);this.taskId=parseInt(g);this.calendarEventId=parseInt(E);this.useFollow=!!a;this.useTasks=!!o;this.readOnly=!!p;this.showFull=!!h;if(t.Type.isStringFilled(n)){this.entryType=n}if(t.Type.isStringFilled(r)){this.perm=r}if(t.Type.isStringFilled(d)){this.url=d}if(t.Type.isStringFilled(u)){this.entityXmlId=u}if(t.Type.isStringFilled(f)){this.contentTypeId=f}if(t.Type.isStringFilled(v)){try{this.taskData=JSON.parse(v)}catch(e){this.taskData=null}}if(t.Type.isPlainObject(l)){this.destinations=l}}},{key:"setFavorites",value:function e(i){var s=this;if(this.logId<=0){return}var a=i.node,o=i.event;if(!t.Type.isDomNode(a)){a=document.getElementById("log_entry_favorites_"+this.logId)}if(t.Type.isDomNode(a)){var r=a.getAttribute("data-favorites")==="Y"?"Y":"N";var l=r==="Y"?"N":"Y";if(a.classList.contains("lenta-item-fav")){if(r==="Y"){a.classList.remove("lenta-item-fav-active")}else{a.classList.add("lenta-item-fav-active")}}a.setAttribute("data-favorites",l);n.Ajax.runAction("socialnetwork.api.livefeed.changeFavorites",{data:{logId:this.logId,value:l},analyticsLabel:{b24statAction:l==="Y"?"addFavorites":"removeFavorites",b24statContext:"mobile"}}).then((function(e){if(e.data.success){if(l==="Y"){z.setFollow({logId:s.logId,bOnlyOn:true,bRunEvent:true,bAjax:false})}BXMobileApp.onCustomEvent("onLogEntryFavorites",{log_id:s.logId,page_id:t.Loc.getMessage("MSLPageId")},true)}else{a.setAttribute("data-favorites",r)}}),(function(){a.setAttribute("data-favorites",r)}))}if(o instanceof Event){o.preventDefault();o.stopPropagation()}}},{key:"setPinned",value:function e(i){var s=this;if(this.logId<=0){return}var a=i.menuNode,o=i.context;if(t.Type.isDomNode(a)){var r=a.getAttribute("data-pinned")==="Y"?"Y":"N";var l=r==="Y"?"N":"Y";a.setAttribute("data-pinned",l);BXMobileApp.onCustomEvent("Livefeed::showLoader",{},true,true);n.Ajax.runAction("socialnetwork.api.livefeed.logentry."+(l==="Y"?"pin":"unpin"),{data:{params:{logId:this.logId}},analyticsLabel:{b24statAction:l==="Y"?"pinLivefeedEntry":"unpinLivefeedEntry",b24statContext:"mobile"}}).then((function(e){BXMobileApp.onCustomEvent("Livefeed::hideLoader",{},true,true);if(e.data.success){BXMobileApp.onCustomEvent("Livefeed.PinnedPanel::change",{logId:s.logId,value:l,postNode:a.closest(".lenta-item"),pinActionContext:o},true,true);BXMobileApp.onCustomEvent("Livefeed.PostDetail::pinChanged",{logId:s.logId,value:l},true,true)}else{a.setAttribute("data-pinned",r)}}),(function(){BXMobileApp.onCustomEvent("Livefeed::hideLoader",{},true,true);a.setAttribute("data-pinned",r)}))}}},{key:"openDetail",value:function e(i){var s=i.pathToEmptyPage,n=i.pathToCalendarEvent,a=i.pathToTasksRouter,o=i.event,r=i.focusComments,l=i.showFull;if(!t.Type.isStringFilled(s)){return}if(this.taskId>0&&BXMobileAppContext.getApiVersion()>=31&&this.taskData){BXMobileApp.Events.postToComponent("taskbackground::task::action",[{id:this.taskId,title:"TASK",taskInfo:{title:this.taskData.title,creatorIcon:this.taskData.creatorIcon,responsibleIcon:this.taskData.responsibleIcon}},this.taskId,{taskId:this.taskId,getTaskInfo:true}])}else{var c=s;if(this.calendarEventId>0&&!r&&n.length>0){c=n.replace("#EVENT_ID#",this.calendarEventId)}else if(this.taskId>0&&this.taskData&&a.length>0){c=a.replace("__ROUTE_PAGE__","view").replace("#USER_ID#",t.Loc.getMessage("MOBILE_EXT_LIVEFEED_CURRENT_USER_ID"))+"&TASK_ID="+this.taskId}__MSLOpenLogEntryNew({path:c,log_id:this.logId,entry_type:this.entryType,use_follow:this.useFollow?"Y":"N",use_tasks:this.useTasks?"Y":"N",post_perm:this.perm,destinations:this.destinations,post_id:this.postId,post_url:this.url,entity_xml_id:this.entityXmlId,focus_comments:r,focus_form:false,show_full:this.showFull||l,read_only:this.readOnly?"Y":"N",post_content_type_id:this.contentTypeId,post_content_id:this.contentId},o)}}},{key:"initDetailPin",value:function e(){var t=document.getElementById("log-entry-menu-"+this.logId);if(!t){return}var i=t.closest(".post-wrap");if(!i){return}var s=t.getAttribute("data-pinned");if(s==="Y"){i.classList.add("lenta-item-pin-active")}else{i.classList.remove("lenta-item-pin-active")}}},{key:"expandText",value:function e(){oMSL.expandText(this.logId)}}]);return e}();var p=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"delete",value:function e(i){var s=t.Type.isStringFilled(i.context)?i.context:"list";var a=!t.Type.isUndefined(i.postId)?parseInt(i.postId):0;if(a<=0){return false}app.confirm({title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_TITLE"),text:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_DESCRIPTION"),buttons:[t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_BUTTON_OK"),t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_BUTTON_CANCEL")],callback:function e(i){if(parseInt(i)!==1){return false}app.showPopupLoader({text:""});var o=t.Uri.addParam("".concat(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/ajax.php"),{b24statAction:"deleteBlogPost",b24statContext:"mobile"});n.Ajax.wrap({type:"json",method:"POST",url:o,data:{action:"delete_post",mobile_action:"delete_post",sessid:t.Loc.getMessage("bitrix_sessid"),site:t.Loc.getMessage("SITE_ID"),lang:t.Loc.getMessage("LANGUAGE_ID"),post_id:a},processData:true,callback:function e(i){app.hidePopupLoader();if(!t.Type.isStringFilled(i.SUCCESS)||i.SUCCESS!=="Y"){return}BXMobileApp.onCustomEvent("onBlogPostDelete",{},true,true);if(s==="detail"){app.closeController({drop:true})}},callback_failure:function e(){app.hidePopupLoader()}});return false}})}},{key:"edit",value:function e(i){var s=!t.Type.isUndefined(i.postId)?parseInt(i.postId):0;if(s<=0){return}var n=!t.Type.isUndefined(i.pinnedContext)?!!i.pinnedContext:false;if(Application.getApiVersion()>=A.getApiVersion("layoutPostForm")){H.show({pageId:A.getPageId(),postId:s})}else{this.getData({postId:s,callback:function e(i){V.formParams={};if(!t.Type.isUndefined(i.PostPerm)&&i.PostPerm>="W"){var a={a_users:[],b_groups:[]};V.setExtraDataArray({postId:s,postAuthorId:i.post_user_id,logId:i.log_id,pinnedContext:n});if(!t.Type.isUndefined(i.PostDetailText)){V.setParams({messageText:i.PostDetailText})}if(t.Type.isPlainObject(i.PostDestination)){for(var o=0,r=Object.entries(i.PostDestination);o<r.length;o++){var l=babelHelpers.slicedToArray(r[o],2),c=l[0],d=l[1];if(t.Type.isStringFilled(i.PostDestination[c].STYLE)&&i.PostDestination[c].STYLE==="all-users"){V.addDestination(a,{type:"UA"})}else if(t.Type.isStringFilled(i.PostDestination[c].TYPE)&&["U","SG"].includes(i.PostDestination[c].TYPE)){V.addDestination(a,{type:i.PostDestination[c].TYPE,id:i.PostDestination[c].ID,name:t.Text.decode(i.PostDestination[c].TITLE)})}}}if(!t.Type.isUndefined(i.PostDestinationHidden)){V.setExtraData({hiddenRecipients:i.PostDestinationHidden})}V.setParams({selectedRecipients:a});if(!t.Type.isUndefined(i.PostFiles)){V.setParams({messageFiles:i.PostFiles})}if(!t.Type.isUndefined(i.PostUFCode)){V.setExtraData({messageUFCode:i.PostUFCode})}app.exec("showPostForm",V.show())}}})}}},{key:"getData",value:function e(i){var s=!t.Type.isUndefined(i.postId)?parseInt(i.postId):0;if(s<=0){return}var a=t.Type.isFunction(i.callback)?i.callback:null;if(t.Type.isNull(a)){return}var o={};if(s>0){app.showPopupLoader();n.Ajax.wrap({type:"json",method:"POST",url:"".concat(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/ajax.php"),processData:true,data:{action:"get_blog_post_data",mobile_action:"get_blog_post_data",sessid:t.Loc.getMessage("bitrix_sessid"),site:t.Loc.getMessage("SITE_ID"),lang:t.Loc.getMessage("LANGUAGE_ID"),post_id:s,nt:t.Loc.getMessage("MSLNameTemplate"),sl:t.Loc.getMessage("MSLShowLogin")},callback:function e(i){app.hidePopupLoader();o.id=s;if(!t.Type.isUndefined(i.log_id)&&parseInt(i.log_id)>0){o.log_id=i.log_id}if(!t.Type.isUndefined(i.post_user_id)&&parseInt(i.post_user_id)>0){o.post_user_id=i.post_user_id}if(!t.Type.isUndefined(i.PostPerm)){o.PostPerm=i.PostPerm}if(!t.Type.isUndefined(i.PostDestination)){o.PostDestination=i.PostDestination}if(!t.Type.isUndefined(i.PostDestinationHidden)){o.PostDestinationHidden=i.PostDestinationHidden}if(!t.Type.isUndefined(i.PostDetailText)){o.PostDetailText=i.PostDetailText}if(t.Type.isUndefined(i.PostFiles)){o.PostFiles=i.PostFiles}if(!t.Type.isUndefined(i.PostBackgroundCode)){o.PostBackgroundCode=i.PostBackgroundCode}if(!t.Type.isUndefined(i.PostUFCode)){o.PostUFCode=i.PostUFCode}a(o)},callback_failure:function e(){app.hidePopupLoader()}})}}}]);return e}();var f=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"init",value:function e(i){this.iconUrlFolderPath="/bitrix/templates/mobile_app/images/lenta/menu/";this.sectionCode="defaultSection";this.logId=parseInt(i.logId);this.postId=parseInt(i.postId);this.postPerms=t.Type.isStringFilled(i.postPerms)?i.postPerms:"R";this.pageId=i.pageId;this.contentTypeId=t.Type.isStringFilled(i.contentTypeId)?i.contentTypeId:null;this.contentId=t.Type.isInteger(i.contentId)?i.contentId:0;this.useShare=!!i.useShare&&this.postId>0;this.useFavorites=!!i.useFavorites&&this.logId>0;this.useFollow=!!i.useFollow&&this.logId>0;this.usePinned=!!i.usePinned&&this.logId>0;this.useTasks=t.Loc.getMessage("MOBILE_EXT_LIVEFEED_USE_TASKS")==="Y";this.useRefreshComments=!!i.useRefreshComments;this.favoritesValue=!!i.favoritesValue;this.followValue=!!i.followValue;this.pinnedValue=!!i.pinnedValue;this.target=t.Type.isDomNode(i.target)?i.target:null;this.context=t.Type.isStringFilled(i.context)?i.context:"list"}},{key:"getMenuItems",value:function e(){var i=this;var s=[];if(this.usePinned){s.push({id:"pinned",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_PINNED_"+(!!this.pinnedValue?"Y":"N")),iconUrl:this.iconUrlFolderPath+(!!this.pinnedValue?"unpin.png":"pin.png"),sectionCode:this.sectionCode,action:function e(){var t=new u({logId:i.logId});return t.setPinned({menuNode:i.target,context:i.context})}})}if(this.useShare){var n={a_users:[],b_groups:[]};if(n.a_users.length>0||n.b_groups.length>0){s.push({id:"sharePost",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_SHARE"),iconName:"add",iconUrl:this.iconUrlFolderPath+"n_plus.png",sectionCode:this.sectionCode,action:function e(){app.openTable({callback:function e(){oMSL.shareBlogPost()},url:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR")+"mobile/index.php?mobile_action="+(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_CURRENT_EXTRANET_SITE")==="Y"?"get_group_list":"get_usergroup_list")+"&feature=blog",markmode:true,multiple:true,return_full_mode:true,user_all:true,showtitle:true,modal:true,selected:n,alphabet_index:true,okname:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SHARE_TABLE_BUTTON_OK"),cancelname:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SHARE_TABLE_BUTTON_CANCEL"),outsection:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DENIED")!=="Y"})},arrowFlag:false})}}if(this.postId>0&&this.postPerms==="W"){s.push({id:"edit",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_EDIT"),iconUrl:this.iconUrlFolderPath+"pencil.png",sectionCode:this.sectionCode,action:function e(){p.edit({feedId:window.LiveFeedID,postId:i.postId,pinnedContext:!!i.pinnedValue})},arrowFlag:false,feature:"edit"});s.push({id:"delete",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_DELETE"),iconName:"delete",sectionCode:this.sectionCode,action:function e(){p["delete"]({postId:i.postId,context:i.context})},arrowFlag:false})}if(this.useFavorites){s.push({id:"favorites",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_FAVORITES_"+(!!this.favoritesValue?"Y":"N")),iconUrl:this.iconUrlFolderPath+"favorite.png",sectionCode:this.sectionCode,action:function e(){var t=new u({logId:i.logId});return t.setFavorites({node:i.target})},arrowFlag:false,feature:"favorites"})}if(this.useFollow){s.push({id:"follow",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_"+(!!this.followValue?"Y":"N")),iconUrl:this.iconUrlFolderPath+"eye.png",sectionCode:this.sectionCode,action:function e(){z.setFollow({logId:i.logId,menuNode:i.target,pageId:i.pageId,bOnlyOn:false,bAjax:true,bRunEvent:true})},arrowFlag:false})}if(this.useRefreshComments){s.push({id:"refreshPostComments",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_REFRESH_COMMENTS"),iconUrl:this.iconUrlFolderPath+"n_refresh.png",action:function e(){if(oMSL.bDetailEmptyPage){K.getComments({ts:oMSL.iDetailTs,bPullDown:true,obFocus:{form:false}})}else{document.location.reload(true)}},arrowFlag:false})}if(t.Type.isStringFilled(this.contentTypeId)&&this.contentId>0){s.push({id:"getPostLink",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_GET_LINK"),iconUrl:this.iconUrlFolderPath+"link.png",sectionCode:this.sectionCode,action:function e(){oMSL.copyPostLink({contentTypeId:i.contentTypeId,contentId:i.contentId})},arrowFlag:false});if(this.useTasks&&this.logId>0){s.push({id:"createTask",title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_CREATE_TASK"),iconUrl:this.iconUrlFolderPath+"n_check.png",sectionCode:this.sectionCode,action:function e(){oMSL.createTask({entityType:i.contentTypeId,entityId:i.contentId,logId:i.logId});return false},arrowFlag:false})}}return s}}]);return e}();var m=function(){function e(){babelHelpers.classCallCheck(this,e);this.type="list";this.listPageMenuItems=[];this.detailPageMenuItems=[]}babelHelpers.createClass(e,[{key:"init",value:function e(i){this.type=i.type==="detail"?"detail":"list";var s=this.getPageMenuItems();var n=this.type==="detail"?t.Type.isStringFilled(t.Loc.getMessage("MSLLogEntryTitle"))?t.Loc.getMessage("MSLLogEntryTitle"):"":t.Type.isStringFilled(t.Loc.getMessage("MSLLogTitle"))?t.Loc.getMessage("MSLLogTitle"):"";if(s.length>0){if(BXMobileAppContext.getApiVersion()>=A.getApiVersion("pageMenu")){this.initPagePopupMenu()}else{app.menuCreate({items:s});BXMobileApp.UI.Page.TopBar.title.setCallback((function(){app.menuShow()}))}}else if(BXMobileAppContext.getApiVersion()<A.getApiVersion("pageMenu")){BXMobileApp.UI.Page.TopBar.title.setCallback("")}BXMobileApp.UI.Page.TopBar.title.setText(n);BXMobileApp.UI.Page.TopBar.title.show()}},{key:"initPagePopupMenu",value:function e(){var t=this;if(BXMobileAppContext.getApiVersion()<A.getApiVersion("pageMenu")){return}var i=[];if(!oMSL.logId){i.push({type:"search",callback:function e(){app.exec("showSearchBar")}})}var s=this.getPageMenuItems(this.type);if(BX.type.isArray(s)&&s.length>0){i.push({type:"more",callback:function e(){t.showPageMenu(t.type)}})}app.exec("setRightButtons",{items:i})}},{key:"showPageMenu",value:function e(){if(this.type==="detail"){this.detailPageMenuItems=this.buildDetailPageMenu(oMSL.menuData)}var i=this.getPageMenuItems();if(i.length<=0){return}var s=[];var n={};i.forEach((function(e){s.push({id:e.id,title:e.name,iconUrl:t.Type.isStringFilled(e.image)?e.image:"",iconName:t.Type.isStringFilled(e.iconName)?e.iconName:"",sectionCode:"defaultSection"});n[e.id]=e.action}));app.exec("setPopupMenuData",{items:s,sections:[{id:"defaultSection"}],callback:function e(i){if(i.eventName==="onDataSet"){app.exec("showPopupMenu")}else if(i.eventName==="onItemSelected"&&t.Type.isPlainObject(i.item)&&t.Type.isStringFilled(i.item.id)&&t.Type.isFunction(n[i.item.id])){n[i.item.id]()}}})}},{key:"getPageMenuItems",value:function e(){return this.type==="detail"?this.detailPageMenuItems:this.listPageMenuItems}},{key:"buildDetailPageMenu",value:function e(t){var i=null;if(BXMobileAppContext.getApiVersion()>=A.getApiVersion("pageMenu")){i=document.getElementById("log-entry-menu-".concat(A.getLogId()))}U.init({logId:A.getLogId(),postId:parseInt(t.post_id),postPerms:t.post_perm,useShare:t.entry_type==="blog",useFavorites:i&&i.getAttribute("data-use-favorites")==="Y",useFollow:t.read_only!=="Y",usePinned:A.getLogId()>0,useRefreshComments:true,favoritesValue:i&&i.getAttribute("data-favorites")==="Y",followValue:z.getFollowValue(),pinnedValue:i&&i.getAttribute("data-pinned")==="Y",contentTypeId:t.post_content_type_id,contentId:parseInt(t.post_content_id),target:i,context:"detail"});return U.getMenuItems().map((function(e){e.name=e.title;e.image=e.iconUrl;delete e.title;delete e.iconUrl;return e}))}}]);return e}();var h=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"show",value:function e(i){var s=this;var n={type:i.type?i.type:"post",groupId:i.groupId?parseInt(i.groupId):0,postId:i.postId?parseInt(i.postId):0,pageId:t.Type.isStringFilled(i.pageId)?i.pageId:""};this.getDatabaseData(n).then((function(e){return s.getWorkgroupData(e)})).then((function(e){return s.getPostData(e)})).then((function(e){return s.processPostData(e)})).then((function(e){app.exec("openComponent",{name:"JSStackComponent",componentCode:"livefeed.postform",scriptPath:BX.message("MOBILE_EXT_LIVEFEED_COMPONENT_URL"),params:{SERVER_NAME:BX.message("MOBILE_EXT_LIVEFEED_SERVER_NAME"),DESTINATION_LIST:A.getOption("destinationList",{}),DESTINATION_TO_ALL_DENY:A.getOption("destinationToAllDeny",false),DESTINATION_TO_ALL_DEFAULT:A.getOption("destinationToAllDefault",true),MODULE_DISK_INSTALLED:BX.message("MOBILE_EXT_LIVEFEED_DISK_INSTALLED")=="Y"?"Y":"N",MODULE_WEBDAV_INSTALLED:BX.message("MOBILE_EXT_LIVEFEED_WEBDAV_INSTALLED")=="Y"?"Y":"N",MODULE_VOTE_INSTALLED:BX.message("MOBILE_EXT_LIVEFEED_VOTE_INSTALLED")=="Y"?"Y":"N",USE_IMPORTANT:BX.message("MOBILE_EXT_LIVEFEED_USE_IMPORTANT")==="N"?"N":"Y",FILE_ATTACH_PATH:BX.message("MOBILE_EXT_LIVEFEED_FILE_ATTACH_PATH"),BACKGROUND_IMAGES_DATA:A.getOption("backgroundImagesData",{}),BACKGROUND_COMMON:A.getOption("backgroundCommon",{}),MEDALS_LIST:A.getOption("medalsList",{}),IMPORTANT_DATA:A.getOption("importantData",{}),USER_FOLDER_FOR_SAVED_FILES:BX.message("MOBILE_EXT_UTILS_USER_FOLDER_FOR_SAVED_FILES"),MAX_UPLOAD_CHUNK_SIZE:BX.message("MOBILE_EXT_UTILS_MAX_UPLOAD_CHUNK_SIZE"),POST_FILE_UF_CODE:BX.message("MOBILE_EXT_LIVEFEED_POST_FILE_UF_CODE"),POST_FORM_DATA:A.getOption("postFormData",{}),POST_DATA:e,DEVICE_WIDTH:BX.message("MOBILE_EXT_LIVEFEED_DEVICE_WIDTH"),DEVICE_HEIGHT:BX.message("MOBILE_EXT_LIVEFEED_DEVICE_HEIGHT"),DEVICE_RATIO:BX.message("MOBILE_EXT_LIVEFEED_DEVICE_RATIO")},rootWidget:{name:"layout",settings:{objectName:"postFormLayoutWidget",modal:true}}},false)}))}},{key:"getDatabaseData",value:function e(i){var s=new Promise((function(e,s){var n=parseInt(i.postId);if(n>0){e(i);return}x.load({onLoad:function s(n){if(n.contentType!==i.type){e(i);return}i.groupId=0;if(!t.Type.isPlainObject(i.post)){i.post={}}if(t.Type.isStringFilled(n.POST_TITLE)){i.post.PostTitle=n.POST_TITLE}if(t.Type.isStringFilled(n.POST_MESSAGE)){i.post.PostDetailText=n.POST_MESSAGE}if(t.Type.isArrayFilled(n.DEST)&&t.Type.isPlainObject(n.DEST_DATA)){i.post.PostDestination=[];var a=[{pattern:/^SG(\d+)$/i,style:"sonetgroups"},{pattern:/^U(\d+|A)$/i,style:"users"},{pattern:/^DR(\d+)$/i,style:"department"}];n.DEST.forEach((function(e){var s=null;var o=null;for(var r=0;r<a.length;r++){var l=e.match(a[r].pattern);if(l){s=l[1];o=e==="UA"?"all-users":a[r].style;break}}if(!t.Type.isNull(s)){i.post.PostDestination.push({STYLE:o,ID:s,TITLE:t.Type.isPlainObject(n.DEST_DATA[e])&&t.Type.isStringFilled(n.DEST_DATA[e].title)?n.DEST_DATA[e].title:""})}}))}if(t.Type.isStringFilled(n.BACKGROUND_CODE)){i.post.PostBackgroundCode=n.BACKGROUND_CODE}if(n.IMPORTANT==="Y"){i.post.PostImportantData={value:"Y"};if(t.Type.isStringFilled(n.IMPORTANT_DATE_END)){i.post.PostImportantData.endDate=Date.parse(n.IMPORTANT_DATE_END)/1e3}}if(t.Type.isStringFilled(n.GRATITUDE_MEDAL)){i.post.PostGratitudeData={gratitude:n.GRATITUDE_MEDAL,employees:[]};if(Array.isArray(n.GRATITUDE_EMPLOYEES)&&t.Type.isPlainObject(n.GRATITUDE_EMPLOYEES_DATA)){n.GRATITUDE_EMPLOYEES.forEach((function(e){var s=n.GRATITUDE_EMPLOYEES_DATA[e];if(!t.Type.isPlainObject(s)){return}i.post.PostGratitudeData.employees.push({id:s.id,imageUrl:t.Type.isStringFilled(s.imageUrl)?s.imageUrl:"",title:t.Type.isStringFilled(s.title)?s.title:"",subtitle:t.Type.isStringFilled(s.subtitle)?s.subtitle:""})}))}}var o="n0";var r="UF_BLOG_POST_VOTE_"+o+"_DATA";if(n.UF_BLOG_POST_VOTE===o&&t.Type.isPlainObject(n[r])&&Array.isArray(n[r].QUESTIONS)){i.post.PostVoteData={questions:n[r].QUESTIONS.map((function(e){var t={value:e.QUESTION,allowMultiSelect:e.FIELD_TYPE==1?"Y":"N",answers:[]};if(Array.isArray(e.ANSWERS)){t.answers=e.ANSWERS.map((function(e){return{value:e.MESSAGE}}))}return t}))}}e(i)},onEmpty:function t(){e(i)}},i.groupId)}));s["catch"]((function(e){console.error(e)}));return s}},{key:"getWorkgroupData",value:function e(t){var i=parseInt(t.groupId);var s=new Promise((function(e,s){if(i<=0){e(t);return}var n={resolve:e,reject:s};var a=new Date;var o="Livefeed::returnWorkgroupData_"+a.getTime();BXMobileApp.addCustomEvent(o,function(e){if(e.success){this.resolve(Object.assign(t,{group:{ID:parseInt(e.groupData.ID),NAME:e.groupData.NAME}}))}else{this.reject()}}.bind(n));BXMobileApp.onCustomEvent("Livefeed::getWorkgroupData",{groupId:i,returnEventName:o},true)}));s["catch"]((function(e){console.error(e)}));return s}},{key:"getPostData",value:function e(t){var i=parseInt(t.postId);var s=new Promise((function(e,s){if(i<=0){e(t);return}var n={resolve:e,reject:s};var a=new Date;var o="Livefeed::returnPostFullData_"+a.getTime();BXMobileApp.addCustomEvent(o,function(e){if(e.success){this.resolve(Object.assign(t,{post:e.postData}))}else{this.reject()}}.bind(n));BXMobileApp.onCustomEvent("Livefeed::getPostFullData",{postId:i,returnEventName:o},true)}));s["catch"]((function(e){console.error(e)}));return s}},{key:"processPostData",value:function e(i){var s=parseInt(i.postId);var n=new Promise((function(e,s){if(t.Type.isPlainObject(i.post)){if(t.Type.isArray(i.post.PostDestination)){i.recipients={};i.post.PostDestination.forEach((function(e){var s=null;var n=null;switch(e.STYLE){case"users":s="users";n=e.ID;break;case"all-users":s="users";n="A";break;case"sonetgroups":s="groups";n=e.ID;break;case"department":s="departments";n=e.ID;break;default:}if(s){if(!t.Type.isArray(i.recipients[s])){i.recipients[s]=[]}i.recipients[s].push({id:n,title:e.TITLE,shortTitle:t.Type.isStringFilled(e.SHORT_TITLE)?e.SHORT_TITLE:e.TITLE,avatar:t.Type.isStringFilled(e.AVATAR)?e.AVATAR:""})}}))}if(t.Type.isArray(i.post.PostDestinationHidden)){i.hiddenRecipients=[];i.post.PostDestinationHidden.forEach((function(e){i.hiddenRecipients.push(e.TYPE+e.ID)}))}}else if(t.Type.isPlainObject(i.group)){i.recipients={groups:[{id:i.group.ID,title:i.group.NAME}]}}e(i)}));n["catch"]((function(e){console.error(e)}));return n}}]);return e}();var g=function(){function e(){babelHelpers.classCallCheck(this,e);this.postFormParams={};this.postFormExtraData={}}babelHelpers.createClass(e,[{key:"setExtraDataArray",value:function e(t){var i=null;for(var s=0,n=Object.entries(t);s<n.length;s++){var a=babelHelpers.slicedToArray(n[s],2),o=a[0],r=a[1];if(t.hasOwnProperty(o)){i={};i[o]=r;this.setExtraData(i)}}}},{key:"setExtraData",value:function e(i){if(!t.Type.isPlainObject(i)){return}for(var s=0,n=Object.entries(i);s<n.length;s++){var a=babelHelpers.slicedToArray(n[s],2),o=a[0],r=a[1];if(o=="hiddenRecipients"||o=="logId"||o=="postId"||o=="postAuthorId"||o=="messageUFCode"||o=="commentId"||o=="commentType"||o=="nodeId"||o=="pinnedContext"){this.postFormExtraData[o]=r}}}},{key:"getExtraData",value:function e(){return this.postFormExtraData}},{key:"setParams",value:function e(i){if(!t.Type.isPlainObject(i)){return}for(var s=0,n=Object.entries(i);s<n.length;s++){var a=babelHelpers.slicedToArray(n[s],2),o=a[0],r=a[1];if(["selectedRecipients","messageText","messageFiles"].indexOf(o)!==-1){this.postFormParams[o]=r}}}},{key:"addDestination",value:function e(i,s){if(!t.Type.isPlainObject(s)||!t.Type.isStringFilled(s.type)){return}var n=null;if(s.type==="UA"){n=i.a_users.some(this.findDestinationCallBack,{value:0});if(!n){i.a_users.push({id:0,name:t.Loc.getMessage("MSLPostDestUA"),bubble_background_color:"#A7F264",bubble_text_color:"#54901E"})}}else if(s.type==="U"){n=i.a_users.some(this.findDestinationCallBack,{value:s.id});if(!n){i.a_users.push({id:s.id,name:s.name,bubble_background_color:"#BCEDFC",bubble_text_color:"#1F6AB5"})}}else if(s.type==="SG"){n=i.b_groups.some(this.findDestinationCallBack,{value:s.id});if(!n){i.b_groups.push({id:s.id,name:s.name,bubble_background_color:"#FFD5D5",bubble_text_color:"#B54827"})}}}},{key:"findDestinationCallBack",value:function e(t,i,s){return t.id==this.value}},{key:"show",value:function e(i){var s=this;if(!t.Type.isPlainObject(i)){i={}}var n=t.Type.isStringFilled(i.entityType)?i.entityType:"post";var a=this.getExtraData();var o={attachButton:this.getAttachButton(),mentionButton:this.getMentionButton(),attachFileSettings:this.getAttachFileSettings(),extraData:a?a:{},smileButton:{},supportLocalFilesInText:n==="post",okButton:{callback:function e(a){if(!t.Type.isStringFilled(a.text)){return}var o=s.buildRequestStub({type:n,extraData:a.extraData,text:s.parseMentions(a.text),pinnedContext:t.Type.isStringFilled(a.extraData.pinnedContext)&&a.extraData.pinnedContext==="YES"});var r=a.extraData.messageUFCode;s.buildFiles(o,a.attachedFiles,{ufCode:r}).then((function(){if(n!=="post"){return}s.buildDestinations(o,a.selectedRecipients,t.Type.isPlainObject(a.extraData)&&!t.Type.isUndefined(a.extraData.hiddenRecipients)?a.extraData.hiddenRecipients:[],{});if(!o.postVirtualId){return}o.ufCode=r;o.contentType="post";oMSL.initPostForm({groupId:i.groupId?i.groupId:null});BXMobileApp.onCustomEvent("Livefeed.PublicationQueue::setItem",{key:o.postVirtualId,pinnedContext:!!o.pinnedContext,item:o,pageId:A.getPageId(),groupId:i.groupId?i.groupId:null},true)}),(function(){}))},name:t.Loc.getMessage("MSLPostFormSend")},cancelButton:{callback:function e(){oMSL.initPostForm({groupId:i.groupId?i.groupId:null})},name:t.Loc.getMessage("MSLPostFormCancel")}};if(!t.Type.isUndefined(this.postFormParams.messageText)){o.message={text:this.postFormParams.messageText}}if(!t.Type.isUndefined(this.postFormParams.messageFiles)){o.attachedFiles=this.postFormParams.messageFiles}if(n==="post"){o.recipients={dataSource:this.getRecipientsDataSource()};if(!t.Type.isUndefined(this.postFormParams.selectedRecipients)){o.recipients.selectedRecipients=this.postFormParams.selectedRecipients}if(!t.Type.isUndefined(this.postFormParams.backgroundCode)){o.backgroundCode=this.postFormParams.backgroundCode}}return o}},{key:"getAttachButton",value:function e(){var i=[];if(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DISK_INSTALLED")==="Y"||t.Loc.getMessage("MOBILE_EXT_LIVEFEED_WEBDAV_INSTALLED")==="Y"){var s={id:"disk",name:t.Loc.getMessage("MSLPostFormDisk"),dataSource:{multiple:"NO",url:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DISK_INSTALLED")==="Y"?"".concat(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId=").concat(t.Loc.getMessage("USER_ID")):"".concat(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/webdav/user/").concat(t.Loc.getMessage("USER_ID"),"/")}};var n={searchField:"YES",showtitle:"YES",modal:"YES",name:t.Loc.getMessage("MSLPostFormDiskTitle")};if(window.platform==="ios"){s.dataSource.table_settings=n}else{s.dataSource.TABLE_SETTINGS=n}i.push(s)}i.push({id:"mediateka",name:t.Loc.getMessage("MSLPostFormPhotoGallery")});i.push({id:"camera",name:t.Loc.getMessage("MSLPostFormPhotoCamera")});return{items:i}}},{key:"getMentionButton",value:function e(){return{dataSource:{return_full_mode:"YES",outsection:"NO",okname:t.Loc.getMessage("MSLPostFormTableOk"),cancelname:t.Loc.getMessage("MSLPostFormTableCancel"),multiple:"NO",alphabet_index:"YES",url:"".concat(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/index.php?mobile_action=get_user_list&use_name_format=Y")}}}},{key:"getAttachFileSettings",value:function e(){return{resize:[40,1,1,1e3,1e3,0,2,false,true,false,null,0],saveToPhotoAlbum:true}}},{key:"buildRequestStub",value:function e(i){var s=null;if(i.type==="post"){s={ACTION:"ADD_POST",AJAX_CALL:"Y",PUBLISH_STATUS:"P",is_sent:"Y",apply:"Y",sessid:t.Loc.getMessage("bitrix_sessid"),POST_MESSAGE:i.text,decode:"Y",SPERM:{},SPERM_NAME:{},MOBILE:"Y",PARSE_PREVIEW:"Y"};if(!t.Type.isUndefined(i.extraData.postId)&&parseInt(i.extraData.postId)>0){s.post_id=parseInt(i.extraData.postId);s.post_user_id=parseInt(i.extraData.postAuthorId);s.pinnedContext=!!i.pinnedContext;s.ACTION="EDIT_POST";if(!t.Type.isUndefined(i.extraData.logId)&&parseInt(i.extraData.logId)>0){s.log_id=parseInt(i.extraData.logId)}}}else if(i.type==="comment"&&!t.Type.isUndefined(i.extraData.commentId)&&parseInt(i.extraData.commentId)>0&&t.Type.isStringFilled(i.extraData.commentType)){s={action:"EDIT_COMMENT",text:this.parseMentions(i.text),commentId:parseInt(i.extraData.commentId),nodeId:i.extraData.nodeId,sessid:t.Loc.getMessage("bitrix_sessid")};if(i.extraData.commentType==="blog"){s.comment_post_id=null}}return s}},{key:"parseMentions",value:function e(t){var i=t;if(typeof oMSL.arMention!="undefined"){for(var s=0,n=Object.entries(oMSL.arMention);s<n.length;s++){var a=babelHelpers.slicedToArray(n[s],2),o=a[0],r=a[1];i=i.replace(new RegExp(o,"g"),r)}oMSL.arMention={};oMSL.commentTextCurrent=""}return i}},{key:"buildFiles",value:function e(i,n,a){var o=this;var r=new Promise((function(e,r){var l=a.ufCode;i.postVirtualId=parseInt(Math.random()*1e5);i.tasksList=[];if(t.Type.isArray(n)&&n.length>0){var c=0;var d=n.length;var u=function t(){c++;if(c>=d){o.postProgressingFiles(i,n,a);e()}};var p=[];n.forEach((function(e){var n=!t.Type.isUndefined(e.VALUE)||!t.Type.isUndefined(e.id)&&parseInt(e.id)>0||t.Type.isPlainObject(e.dataAttributes)&&!t.Type.isUndefined(e.dataAttributes.VALUE)||t.Type.isStringFilled(e.ufCode)&&e.ufCode===l;var a=t.Type.isUndefined(e.url)||!t.Type.isNumber(e.id);if(t.Type.isStringFilled(e.url)&&a&&!n){var o="postTask_".concat(parseInt(Math.random()*1e5));var r=s.MobileUtils.getFileMimeType(e.type);p.push({taskId:o,type:e.type,mimeType:r,folderId:parseInt(t.Loc.getMessage("MOBILE_EXT_UTILS_USER_FOLDER_FOR_SAVED_FILES")),params:{postVirtualId:i.postVirtualId,pinnedContext:!!i.pinnedContext},name:s.MobileUtils.getUploadFilename(e.name,e.type),url:e.url,previewUrl:e.previewUrl?e.previewUrl:null,resize:s.MobileUtils.getResizeOptions(e.type)});i.tasksList.push(o)}else{if(n){if(t.Type.isUndefined(i[l])){i[l]=[]}if(!t.Type.isUndefined(e.VALUE)){i[l].push(e.VALUE)}else if(parseInt(e.id)>0){i[l].push(parseInt(e.id))}else{i[l].push(e.dataAttributes.VALUE)}}u()}}));if(p.length>0){BXMobileApp.onCustomEvent("onFileUploadTaskReceived",{files:p},true)}e()}else{o.postProgressingFiles(i,n,a);e()}}));r["catch"]((function(e){console.error(e)}));return r}},{key:"buildDestinations",value:function e(i,s,n,a){i["DEST"]=[];if(t.Type.isPlainObject(s.a_users)){for(var o=0,r=Object.entries(s.a_users);o<r.length;o++){var l=babelHelpers.slicedToArray(r[o],2),c=l[0],d=l[1];var u="U";if(t.Type.isUndefined(i.SPERM[u])){i.SPERM[u]=[]}if(t.Type.isUndefined(i.SPERM_NAME[u])){i.SPERM_NAME[u]=[]}var p=!t.Type.isUndefined(d.ID)?d.ID:d.id;var f=!t.Type.isUndefined(d.NAME)?d.NAME:d.name;var m=parseInt(p)===0?"UA":"U".concat(p);i.SPERM[u].push(m);i.DEST.push(m);i.SPERM_NAME[u].push(f)}}if(t.Type.isPlainObject(s.b_groups)){for(var h=0,g=Object.entries(s.b_groups);h<g.length;h++){var v=babelHelpers.slicedToArray(g[h],2),E=v[0],I=v[1];var T="SG";if(t.Type.isUndefined(i.SPERM[T])){i.SPERM[T]=[]}if(t.Type.isUndefined(i.SPERM_NAME[T])){i.SPERM_NAME[T]=[]}var y=!t.Type.isUndefined(I.ID)?I.ID:I.id;var b=!t.Type.isUndefined(I.NAME)?I.NAME:I.name;var L="SG".concat(y);i.SPERM[T].push(L);i.DEST.push(L);i.SPERM_NAME[T].push(b)}}for(var P in n){if(!n.hasOwnProperty(P)){continue}var _=n[P].TYPE;if(t.Type.isUndefined(i.SPERM[_])){i.SPERM[_]=[]}var S="".concat(n[P].TYPE).concat(n[P].ID);i.SPERM[_].push(S);i.DEST.push(S)}}},{key:"getRecipientsDataSource",value:function e(){return{return_full_mode:"YES",outsection:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DENIED")!=="Y"?"YES":"NO",okname:t.Loc.getMessage("MSLPostFormTableOk"),cancelname:t.Loc.getMessage("MSLPostFormTableCancel"),multiple:"YES",alphabet_index:"YES",showtitle:"YES",user_all:"YES",url:"".concat(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/index.php?mobile_action=").concat(t.Loc.getmessage("MOBILE_EXT_LIVEFEED_CURRENT_EXTRANET_SITE")==="Y"?"get_group_list":"get_usergroup_list","&feature=blog")}}},{key:"postProgressingFiles",value:function e(i,s,n){var a=n.ufCode;if(t.Type.isUndefined(i[a])){i[a]=[]}if(t.Type.isUndefined(s)){s=[]}for(var o in this.postFormParams.messageFiles){if(!this.postFormParams.messageFiles.hasOwnProperty(o)){continue}for(var r in s){if(!s.hasOwnProperty(r)){continue}if(this.postFormParams.messageFiles[o].id==s[r].id||this.postFormParams.messageFiles[o].id==s[r].ID){i[a].push(this.postFormParams.messageFiles[o].id);break}}}if(i[a].length<=0){i[a].push("empty")}}}]);return e}();var v;var E=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.panelInitialized=false;this["class"]={panel:"lenta-pinned-panel",panelCollapsed:"lenta-pinned-panel-collapsed",panelActive:"lenta-pinned-panel-active",collapsedPanel:"lenta-pinned-collapsed-posts",collapsedPanelPostsValue:"lenta-pinned-collapsed-count-posts",collapsedPanelComments:"lenta-pinned-collapsed-posts-comments",collapsedPanelCommentsShown:"lenta-pinned-collapsed-posts-comments-active",collapsedPanelCommentsValue:"lenta-pinned-collapsed-count-comments",collapsedPanelCommentsValueNew:"post-item-inform-right-new-value",collapsedPanelExpandButton:"lenta-pinned-collapsed-posts-btn",post:"lenta-item",postItemPinned:"lenta-item-pinned",postItemPinActive:"lenta-item-pin-active",postItemPinnedBlock:"post-item-pinned-block",postItemPinnedTitle:"post-item-pinned-title",postItemPinnedTextBox:"post-item-pinned-text-box",postItemPinnedDesc:"post-item-pinned-desc",cancelPanel:"post-pinned-cancel-panel",cancelPanelButton:"post-pinned-cancel-panel-btn"};this.init();i.EventEmitter.subscribe("onFrameDataProcessed",(function(){t.init()}))}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this;var i=document.querySelector(".".concat(this["class"].panel));if(!i||this.panelInitialized){return}this.panelInitialized=true;this.adjustCollapsedPostsPanel();var s=document.querySelector(".".concat(this["class"].collapsedPanel));if(s){s.addEventListener("touchend",(function(e){t.expandCollapsedPostsPanel();e.stopPropagation();return e.preventDefault()}))}}},{key:"resetFlags",value:function e(){this.panelInitialized=false}},{key:"getPinnedPanelNode",value:function e(){return document.querySelector("[data-livefeed-pinned-panel]")}},{key:"recalcPanel",value:function e(t){var i=t.type;if(this.getPostsCount()>0){this.getPinnedPanelNode().classList.add("".concat(this["class"].panelActive))}else{this.getPinnedPanelNode().classList.remove("".concat(this["class"].panelActive))}this.recalcCollapsedPostsPanel({type:i})}},{key:"recalcCollapsedPostsPanel",value:function e(i){var s=i.type;if(this.getPostsCount()>=t.Loc.getMessage("MOBILE_EXT_LIVEFEED_COLLAPSED_PINNED_PANEL_ITEMS_LIMIT")){if(s==="insert"||this.getPinnedPanelNode().classList.contains("".concat(this["class"].panelCollapsed))){this.getPinnedPanelNode().classList.add("".concat(this["class"].panelCollapsed))}}else{this.getPinnedPanelNode().classList.remove("".concat(this["class"].panelCollapsed))}this.adjustCollapsedPostsPanel()}},{key:"expandCollapsedPostsPanel",value:function e(){this.getPinnedPanelNode().classList.remove("".concat(this["class"].panelCollapsed))}},{key:"getPostsCount",value:function e(){return Array.from(this.getPinnedPanelNode().getElementsByClassName("".concat(this["class"].post))).length}},{key:"adjustCollapsedPostsPanel",value:function e(){var t=this.getPostsCount();var i=this.getPinnedPanelNode().querySelector(".".concat(this["class"].collapsedPanelPostsValue));if(i){i.innerHTML=parseInt(t)}var s=this.getPinnedPanelNode().querySelector(".".concat(this["class"].collapsedPanelComments));var n=this.getPinnedPanelNode().querySelector(".".concat(this["class"].collapsedPanelCommentsValue));if(s&&n){var a=Array.from(this.getPinnedPanelNode().querySelectorAll(".".concat(this["class"].collapsedPanelCommentsValueNew))).reduce((function(e,t){return e+parseInt(t.innerHTML)}),0);n.innerHTML="+"+a;if(a>0){s.classList.add("".concat(this["class"].collapsedPanelCommentsShown))}else{s.classList.remove("".concat(this["class"].collapsedPanelCommentsShown))}}}},{key:"getPinnedData",value:function e(t){var i=t.logId?parseInt(t.logId):0;if(i<=0){return Promise.reject()}return new Promise((function(e,t){n.Ajax.runAction("socialnetwork.api.livefeed.logentry.getPinData",{data:{params:{logId:i}}}).then((function(i){if(i.status==="success"){e(i.data)}else{t(i.errors)}}),(function(e){t()}))}))}},{key:"insertEntry",value:function e(i){var s=this;var n=i.logId,a=i.postNode,o=i.pinnedContent;var r=this.getPinnedPanelNode();if(!t.Type.isDomNode(a)||!t.Type.isDomNode(r)){return}var l=a.querySelector(".".concat(this["class"].postItemPinnedBlock));if(!t.Type.isDomNode(l)){return}a.classList.add(this["class"].postItemPinned);a.classList.add(this["class"].postItemPinActive);l.innerHTML="".concat(t.Type.isStringFilled(o.TITLE)?'<div class="'.concat(this["class"].postItemPinnedTitle,'">').concat(o.TITLE,"</div>"):"",'<div class="').concat(this["class"].postItemPinnedTextBox,'"><div class="').concat(this["class"].postItemPinnedDesc,'">').concat(o.DESCRIPTION,"</div></div>");var c=t.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['<div class="','" data-livefeed-id="','">\n\t\t\t<div class="post-pinned-cancel-panel-content">\n\t\t\t\t<div class="post-pinned-cancel-panel-label">','</div>\n\t\t\t\t\t<div class="post-pinned-cancel-panel-text">','</div>\n\t\t\t\t</div>\n\t\t\t<div class="ui-btn ui-btn-light-border ui-btn-round ui-btn-sm ','">',"</div>\n\t\t</div>"])),this["class"].cancelPanel,n,t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_PINNED_CANCEL_TITLE"),t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_PINNED_CANCEL_DESCRIPTION"),this["class"].cancelPanelButton,t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_PINNED_CANCEL_BUTTON"));var d=c.querySelector(".".concat(this["class"].cancelPanelButton));d.addEventListener("touchend",(function(e){var t=e.currentTarget.closest(".".concat(s["class"].cancelPanel));if(!t){return}var i=parseInt(t.getAttribute("data-livefeed-id"));if(i<=0){return}var n=document.querySelector(".".concat(s["class"].post,'[data-livefeed-id="').concat(i,'"]'));if(!n){return}var a=n.querySelector('[data-menu-type="post"]');if(!a){return}var o=new u({logId:i});return o.setPinned({menuNode:a,context:"list"})}));a.parentNode.insertBefore(c,a);t.Dom.prepend(a,r);this.recalcPanel({type:"insert"});Q.onScroll()}},{key:"extractEntry",value:function e(i){var s=i.logId,n=i.postNode,a=i.containerNode;var o=this.getPinnedPanelNode();if(!t.Type.isDomNode(n)||!t.Type.isDomNode(a)||!t.Type.isDomNode(o)||n.parentNode!==o||parseInt(s)<=0){return}n.classList.remove(this["class"].postItemPinned);n.classList.remove(this["class"].postItemPinActive);var r=document.querySelector(".".concat(this["class"].cancelPanel,'[data-livefeed-id="').concat(parseInt(s),'"]'));if(r){r.parentNode.insertBefore(n,r);t.Dom.remove(r)}else{t.Dom.prepend(n,a)}this.recalcPanel({type:"extract"})}}]);return e}();var I=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));e.init();return e}babelHelpers.createClass(t,[{key:"init",value:function e(){this.setEventNamespace("BX.Mobile.Livefeed");this.subscribe("onFeedInit",this.onFeedInit.bind(this))}},{key:"onFeedInit",value:function e(){if(!window.BXRL){return}Object.keys(window.BXRL).forEach((function(e){if(e!=="manager"&&e!=="render"){delete window.BXRL[e]}}))}}]);return t}(i.EventEmitter);var T=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"setPostRead",value:function e(i){var s=this;if(!t.Type.isDomNode(i)||i.hasAttribute("done")){return false}var a=parseInt(i.getAttribute("bx-data-post-id"));if(a<=0){return false}this.renderRead({node:i,value:true});n.Ajax.runAction("socialnetwork.api.livefeed.blogpost.important.vote",{data:{params:{POST_ID:a}}}).then((function(e){if(!t.Type.isStringFilled(e.data.success)||e.data.success!=="Y"){s.renderRead({node:i,value:false})}else{BXMobileApp.onCustomEvent("onLogEntryImpPostRead",{postId:a},true)}}),(function(e){s.renderRead({node:i,value:false})}));return true}},{key:"renderRead",value:function e(i){if(!t.Type.isObject(i)||!t.Type.isDomNode(i.node)){return}var s=i.node;var n=!!i.value;if(n){s.checked=true;s.setAttribute("done","Y");t.Event.unbindAll(s)}else{s.checked=false;delete s.checked;s.removeAttribute("done")}var a=s.closest(".post-item-important");if(!a){return}var o=a.querySelector(".post-item-important-list");if(!o){return}o.classList.add("post-item-important-list-read")}}]);return e}();var y=function(e){babelHelpers.inherits(s,e);function s(){var e;babelHelpers.classCallCheck(this,s);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this));e.findTextMode=false;e.ftMinTokenSize=3;e.hideByRefresh=false;return e}babelHelpers.createClass(s,[{key:"init",value:function e(s){var n=this;if(BXMobileAppContext.getApiVersion()<A.getApiVersion("pageMenu")){return}if(t.Type.isPlainObject(s)&&parseInt(s.ftMinTokenSize)>0){this.ftMinTokenSize=parseInt(s.ftMinTokenSize)}this.subscribe("onSearchBarCancelButtonClicked",this.searchBarEventCallback.bind(this));this.subscribe("onSearchBarSearchButtonClicked",this.searchBarEventCallback.bind(this));i.EventEmitter.subscribe("BX.MobileLivefeed.SearchBar::setHideByRefresh",this.setHideByRefresh.bind(this));i.EventEmitter.subscribe("BX.MobileLivefeed.SearchBar::unsetHideByRefresh",this.unsetHideByRefresh.bind(this));BXMobileApp.UI.Page.params.set({useSearchBar:true});app.exec("setParamsSearchBar",{params:{callback:function e(s){if(s.eventName==="onSearchButtonClicked"&&t.Type.isPlainObject(s.data)&&t.Type.isStringFilled(s.data.text)){if(s.data.text.length>=n.ftMinTokenSize){n.findTextMode=true}n.emit("onSearchBarSearchButtonClicked",new i.BaseEvent({data:{text:s.data.text}}))}else if(["onCancelButtonClicked","onSearchHide"].includes(s.eventName)){n.emit("onSearchBarCancelButtonClicked",new i.BaseEvent({data:{}}))}}}})}},{key:"searchBarEventCallback",value:function e(s){var n=this;var a=s.getData();var o=t.Type.isPlainObject(a)&&t.Type.isStringFilled(a.text)?a.text:"";if(o.length>=this.ftMinTokenSize){app.exec("showSearchBarProgress");this.emitRefreshEvent(o)}else{if(this.findTextMode){if(!this.hideByRefresh){i.EventEmitter.emit("BX.MobileLF:onSearchBarRefreshAbort")}if(BX.frameCache){app.exec("hideSearchBarProgress");BX.frameCache.readCacheWithID("framecache-block-feed",(function(e){var i=document.getElementById("bxdynamic_feed_refresh");if(!t.Type.isArray(e.items)||!i){n.emitRefreshEvent();return}var s=e.items.find((function(e){return t.Type.isStringFilled(e.ID)&&e.ID==="framecache-block-feed"}));if(t.Type.isUndefined(s)){return}t.Runtime.html(i,s.CONTENT).then((function(){BX.processHTML(s.CONTENT,true)}));u.moveTop();setTimeout((function(){BitrixMobile.LazyLoad.showImages()}),1e3)}))}else{this.emitRefreshEvent()}}this.findTextMode=false}}},{key:"setHideByRefresh",value:function e(){this.hideByRefresh=true}},{key:"unsetHideByRefresh",value:function e(){this.hideByRefresh=false}},{key:"emitRefreshEvent",value:function e(t){if(Q.refreshXhr){return}t=t||"";var s=new i.BaseEvent({compatData:[{text:t}]});i.EventEmitter.emit("BX.MobileLF:onSearchBarRefreshStart",s)}}]);return s}(i.EventEmitter);var b=function(){function e(){babelHelpers.classCallCheck(this,e);this.canCheckScrollButton=true;this.showScrollButtonTimeout=null;this.showScrollButtonBottom=false;this.showScrollButtonTop=false;this["class"]={scrollButton:"post-comment-block-scroll",scrollButtonTop:"post-comment-block-scroll-top",scrollButtonBottom:"post-comment-block-scroll-bottom",scrollButtonTopActive:"post-comment-block-scroll-top-active",scrollButtonBottomActive:"post-comment-block-scroll-bottom-active"};this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){if(window.platform==="ios"){return}document.addEventListener("scroll",this.onScrollDetail.bind(this))}},{key:"onScrollDetail",value:function e(){var t=this;if(!this.canCheckScrollButton){return}clearTimeout(this.showScrollButtonTimeout);this.showScrollButtonTimeout=setTimeout((function(){A.setLastActivityDate();t.checkScrollButton()}),200)}},{key:"checkScrollButton",value:function e(){var t=window.scrollY;var i=document.documentElement.scrollHeight-window.innerHeight-100;this.showScrollButtonBottom=!(document.documentElement.scrollHeight-window.innerHeight<=0||t>=i&&(t>0||i>0));this.showScrollButtonTop=t>200;this.showHideScrollButton()}},{key:"showHideScrollButton",value:function e(){var t=document.querySelector(".".concat(this["class"].scrollButtonBottom));var i=document.querySelector(".".concat(this["class"].scrollButtonTop));if(t){if(this.showScrollButtonBottom){if(!t.classList.contains("".concat(this["class"].scrollButtonBottomActive))){t.classList.add("".concat(this["class"].scrollButtonBottomActive))}}else{if(t.classList.contains("".concat(this["class"].scrollButtonBottomActive))){t.classList.remove("".concat(this["class"].scrollButtonBottomActive))}}}if(i){if(this.showScrollButtonTop){if(!i.classList.contains("".concat(this["class"].scrollButtonTopActive))){i.classList.add("".concat(this["class"].scrollButtonTopActive))}}else{if(i.classList.contains("".concat(this["class"].scrollButtonTopActive))){i.classList.remove("".concat(this["class"].scrollButtonTopActive))}}}}},{key:"scrollTo",value:function e(t){var i=this;if(t!=="top"){t="bottom"}this.canCheckScrollButton=false;this.showScrollButtonBottom=false;this.showScrollButtonTop=false;this.showHideScrollButton();var s=window.scrollY;var n=t=="bottom"?document.documentElement.scrollHeight:0;BitrixAnimation.animate({duration:500,start:{scroll:s},finish:{scroll:n},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function e(t){window.scrollTo(0,t.scroll)},complete:function e(){i.canCheckScrollButton=true;i.checkScrollButton()}})}}]);return e}();var L=function(){function e(){babelHelpers.classCallCheck(this,e);this.defaultValue=true;this.value=true;this["class"]={postItemFollow:"post-item-follow",postItemFollowActive:"post-item-follow-active"}}babelHelpers.createClass(e,[{key:"init",value:function e(){}},{key:"setFollow",value:function e(i){var s=this;var a=!t.Type.isUndefined(i.logId)?parseInt(i.logId):0;var o=!t.Type.isUndefined(i.pageId)?i.pageId:false;var r=!t.Type.isUndefined(i.bRunEvent)?i.bRunEvent:true;var l=!t.Type.isUndefined(i.bAjax)?i.bAjax:false;var c=typeof i.bOnlyOn!="undefined"?i.bOnlyOn:false;if(c=="NO"){c=false}var d=null;if(t.Type.isDomNode(i.menuNode)){d=i.menuNode}else if(t.Type.isStringFilled(i.menuNode)){d=document.getElementById(i.menuNode)}if(!d){d=document.getElementById("log-entry-menu-".concat(a))}var u=document.getElementById("log_entry_follow_".concat(a));if(!u){u=document.getElementById("log_entry_follow")}var p=document.getElementById("post_item_top_wrap_".concat(a));if(!p){p=document.getElementById("post_item_top_wrap")}var f=null;if(d){f=d.getAttribute("data-follow")==="Y"?"Y":"N"}else if(u){f=u.getAttribute("data-follow")=="Y"?"Y":"N"}else{return false}var m=f==="Y"?"N":"Y";if((!t.Type.isStringFilled(A.getOption("detailPageId"))||A.getOption("detailPageId")!==o)&&(!c||f==="N")){this.drawFollow({value:f!=="Y",followBlock:u,followWrap:p,menuNode:d,runEvent:r,turnOnOnly:c,logId:a})}if(l){n.Ajax.runAction("socialnetwork.api.livefeed.changeFollow",{data:{logId:a,value:m},analyticsLabel:{b24statAction:m==="Y"?"setFollow":"setUnfollow"}}).then((function(e){if(e.data.success){return}s.drawFollow({value:f==="Y",followBlock:u,followWrap:p,menuNode:d,runEvent:true,turnOnOnly:c,logId:a})}),(function(e){s.drawFollow({value:f==="Y",followBlock:u,followWrap:p,menuNode:d,runEvent:false})}))}return false}},{key:"drawFollow",value:function e(i){var s=t.Type.isBoolean(i.value)?i.value:null;if(t.Type.isNull(s)){return}var n=t.Type.isDomNode(i.followBlock)?i.followBlock:null;if(n){n.classList.remove(s?this["class"].postItemFollow:this["class"].postItemFollowActive);n.classList.add(s?this["class"].postItemFollowActive:this["class"].postItemFollow);n.setAttribute("data-follow",s?"Y":"N")}var a=t.Type.isDomNode(i.followWrap)?i.followWrap:null;if(a&&!this.getFollowDefaultValue()){if(s){a.classList.add(this["class"].postItemFollow)}else{a.classList.remove(this["class"].postItemFollow)}}var o=t.Type.isDomNode(i.menuNode)?i.menuNode:null;if(o){o.setAttribute("data-follow",s?"Y":"N")}var r=A.getOption("detailPageId");if(t.Type.isStringFilled(r)){this.setFollowValue(s);this.setFollowMenuItemName()}var l=t.Type.isBoolean(i.runEvent)?i.runEvent:false;var c=!t.Type.isUndefined(i.logId)?parseInt(i.logId):0;var d=t.Type.isBoolean(i.turnOnOnly)?i.turnOnOnly:false;if(l&&c>0){BXMobileApp.onCustomEvent("onLogEntryFollow",{logId:c,pageId:t.Type.isStringFilled(r)?r:"",bOnlyOn:d?"Y":"N"},true)}}},{key:"setFollowDefault",value:function e(i){var s=this;if(t.Type.isUndefined(i.value)){return}var n=!!i.value;if(!t.Type.isStringFilled(A.getOption("detailPageId"))){this.setFollowDefaultValue(n);this.setDefaultFollowMenuItemName()}var a={sessid:BX.bitrix_sessid(),site:t.Loc.getMessage("SITE_ID"),lang:t.Loc.getMessage("LANGUAGE_ID"),value:n?"Y":"N",action:"change_follow_default",mobile_action:"change_follow_default"};oMSL.changeListMode(a,(function(){oMSL.pullDownAndRefresh()}),(function(e){s.setFollowDefaultValue(e.value!=="Y");s.setDefaultFollowMenuItemName()}))}},{key:"setFollowValue",value:function e(t){this.value=!!t}},{key:"getFollowValue",value:function e(){return this.value}},{key:"setFollowDefaultValue",value:function e(t){this.defaultValue=!!t}},{key:"getFollowDefaultValue",value:function e(){return this.defaultValue}},{key:"setFollowMenuItemName",value:function e(){var i=X.detailPageMenuItems.findIndex((function(e){return t.Type.isStringFilled(e.feature)&&e.feature==="follow"}));if(i<0){return}var s=X.detailPageMenuItems[i];s.name=this.getFollowValue()?t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_Y"):t.Loc.getMessage("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_N");X.detailPageMenuItems[i]=s;X.init({type:"detail"})}},{key:"setDefaultFollowMenuItemName",value:function e(){var i=X.listPageMenuItems.findIndex((function(e){return t.Type.isStringFilled(e.feature)&&e.feature==="follow"}));if(i<0){return}var s=X.listPageMenuItems[i];s.name=this.getFollowDefaultValue()?t.Loc.getMessage("MSLMenuItemFollowDefaultY"):t.Loc.getMessage("MSLMenuItemFollowDefaultN");X.listPageMenuItems[i]=s;X.init({type:"list"})}}]);return e}();var P,_,S,M;var D=function(){function e(){babelHelpers.classCallCheck(this,e);this.emptyCommentsXhr=null;this.repoLog={};this.mid={};this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){i.EventEmitter.subscribe("OnUCommentWasDeleted",this.deleteHandler.bind(this));i.EventEmitter.subscribe("OnUCommentWasHidden",this.deleteHandler.bind(this));i.EventEmitter.subscribe("OnUCRecordHasDrawn",this.drawHandler.bind(this));i.EventEmitter.subscribe("OnUCFormSubmit",this.submitHandler.bind(this))}},{key:"deleteHandler",value:function e(t){var i=t.getData(),s=babelHelpers.slicedToArray(i,2),n=s[0],a=s[1];var o=A.getLogId();if(this.mid[a.join("-")]!=="hidden"){this.mid[a.join("-")]="hidden";if(this.repoLog[o]){this.repoLog[o]["POST_NUM_COMMENTS"]--;BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:o,num:this.repoLog[o]["POST_NUM_COMMENTS"]},true)}}}},{key:"drawHandler",value:function e(t){var i=t.getData(),s=babelHelpers.slicedToArray(i,2),n=s[0],a=s[1];var o=A.getLogId();this.mid[n]=this.mid[n]||{};if(this.mid[a.join("-")]!=="drawn"){this.mid[a.join("-")]="drawn";var r=false;if(this.repoLog[o]&&(r=document.getElementById("record-".concat(a.join("-"),"-cover")))&&r&&r.parentNode==document.getElementById("record-".concat(n,"-new"))){this.repoLog[o]["POST_NUM_COMMENTS"]++;BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:o,num:this.repoLog[o]["POST_NUM_COMMENTS"]},true)}}}},{key:"submitHandler",value:function e(t){var i=t.getData(),s=babelHelpers.slicedToArray(i,4),n=s[0],a=s[1],o=s[2],r=s[3];if(r&&r.mobile_action&&r.mobile_action==="add_comment"&&a>0){r.mobile_action=r.action="edit_comment";r.edit_id=a}}},{key:"setRepoItem",value:function e(t,i){this.repoLog[t]=i}},{key:"getList",value:function e(s){var a=this;var o=s.ts;var r=!!s.bPullDown;var l=t.Type.isUndefined(s.bPullDownTop)||s.bPullDownTop;var c=t.Type.isUndefined(s.obFocus.form)||s.obFocus.form==="NO"?"NO":"YES";var d=t.Type.isUndefined(s.obFocus.comments)||s.obFocus.comments==="NO"?"NO":"YES";var u=oMSL.logId;var p=document.getElementById("post-comments-wrap");if(!r){if(l){BXMobileApp.UI.Page.Refresh.start()}t.Dom.clean(p);p.appendChild(t.Tag.render(P||(P=babelHelpers.taggedTemplateLiteral(['<span id="post-comment-last-after"></span>']))))}this.showEmptyListWaiter({container:p,enable:true});i.EventEmitter.emit("BX.MobileLF:onCommentsGet");BXMobileApp.UI.Page.TextPanel.hide();this.emptyCommentsXhr=n.Ajax.wrap({type:"json",method:"GET",url:"".concat(t.Loc.getMessage("MSLPathToLogEntry").replace("#log_id#",u),"&empty_get_comments=Y").concat(!t.Type.isNil(o)?"&LAST_LOG_TS=".concat(o):""),data:{},processData:true,callback:function e(s){var n=document.getElementById("post-comments-form-wrap");if(r){app.exec("pullDownLoadingStop")}else if(l){BXMobileApp.UI.Page.Refresh.stop()}a.showEmptyListWaiter({container:p,enable:false});if(t.Type.isStringFilled(s.POST_PERM)){oMSL.menuData.post_perm=s.POST_PERM;X.detailPageMenuItems=X.buildDetailPageMenu(oMSL.menuData);X.init({type:"detail"})}if(t.Type.isStringFilled(s.TEXT)){if(r){t.Dom.clean(p);if(!t.Type.isUndefined(s.POST_NUM_COMMENTS)){BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:u,num:parseInt(s.POST_NUM_COMMENTS)},true)}}a.setRepoItem(u,{POST_NUM_COMMENTS:s.POST_NUM_COMMENTS});var o=BX.processHTML(s.TEXT,true);t.Runtime.html(p,o.HTML).then((function(){setTimeout((function(){BitrixMobile.LazyLoad.showImages()}),1e3)}));p.appendChild(t.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['<span id="post-comment-last-after"></span>']))));var f=0;var m=function e(){f++;if(f<100){if(p.childNodes.length>0){BX.ajax.processScripts(o.SCRIPT)}else{BX.defer(e,a)()}}};BX.defer(m,a)();var h=new i.BaseEvent({compatData:[{mobile:true,ajaxUrl:"".concat(t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_DIR"),"mobile/ajax.php"),commentsContainerId:"post-comments-wrap",commentsClassName:"post-comment-wrap"}]});i.EventEmitter.emit("BX.UserContentView.onInitCall",h);i.EventEmitter.emit("BX.UserContentView.onClearCall",h);if(!r){if(n){n.innerHTML=""}__MSLDetailPullDownInit(true);if(c==="YES"){a.setFocusOnComments("form")}else if(d=="YES"){a.setFocusOnComments("list")}}A.setLastActivityDate();W.checkScrollButton();var g=document.getElementById("post_log_id");if(!t.Type.isUndefined(s.TS)&&g){g.setAttribute("data-ts",s.TS)}}else{if(!r){a.showEmptyListWaiter({container:p,enable:false})}app.alert({title:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_ALERT_ERROR_TITLE"),text:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_ALERT_ERROR_POST_NOT_FOUND_TEXT"),button:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_ALERT_ERROR_BUTTON"),callback:function e(){BXMobileApp.onCustomEvent("Livefeed::onLogEntryDetailNotFound",{logId:u},true);BXMPage.close()}})}},callback_failure:function e(){if(r){app.exec("pullDownLoadingStop")}else{BXMobileApp.UI.Page.Refresh.stop()}a.showEmptyListWaiter({container:p,enable:false});a.showEmptyListFailed({container:p,timestampValue:o,pullDown:r,moveBottom:c})}})}},{key:"showEmptyListWaiter",value:function e(i){var s=i.container;var n=!!i.enable;if(!t.Type.isDomNode(s)){return}var a=s.querySelector(".post-comments-load-btn-wrap");if(a){t.Dom.clean(a);t.Dom.remove(a)}if(!n){return}s.appendChild(t.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['<div class="post-comments-load-btn-wrap"><div class="post-comments-loader"></div><div class="post-comments-load-text">',"</div></div>"])),t.Loc.getMessage("MSLDetailCommentsLoading")))}},{key:"showEmptyListFailed",value:function e(i){var s=this;var n=i.container,a=i.timestampValue,o=i.pullDown,r=i.moveBottom,l=i.data;if(!t.Type.isDomNode(n)){return}var c=t.Type.isObject(l)&&t.Type.isStringFilled(l.ERROR_MESSAGE)?l.ERROR_MESSAGE:t.Loc.getMessage("MSLDetailCommentsFailed");n.appendChild(t.Tag.render(M||(M=babelHelpers.taggedTemplateLiteral(['<div class="post-comments-load-btn-wrap"><div class="post-comments-load-text">','</div><a class="post-comments-load-btn">',"</a></div>"])),c,t.Loc.getMessage("MSLDetailCommentsReload")));var d=n.querySelector(".post-comments-load-btn");if(!d){return}d.addEventListener("click",(function(e){if(t.Type.isDomNode(e.target.parent)){t.Dom.clean(e.target.parent);t.Dom.remove(e.target.parent)}s.getList({ts:a,bPullDown:o,obFocus:{form:false}})}));d.addEventListener("touchstart",(function(e){e.target.classList.add("post-comments-load-btn-active")}));d.addEventListener("touchend",(function(e){e.target.classList.remove("post-comments-load-btn-active")}))}},{key:"abortXhr",value:function e(){if(this.emptyCommentsXhr){this.emptyCommentsXhr.abort()}}},{key:"setFocusOnComments",value:function e(t){t=t==="list"?"list":"form";if(t==="form"){this.setFocusOnCommentForm();u.moveBottom()}else if(t==="list"){var i=document.getElementById("post-comments-wrap");if(!i){return false}var s=i.querySelector(".post-comment-block-new");if(s){window.scrollTo(0,s.offsetTop)}else{var n=BX.findChild(i,{className:"post-comment-block"},true);window.scrollTo(0,n?n.offsetTop:0)}}return false}},{key:"setFocusOnCommentForm",value:function e(){BXMobileApp.UI.Page.TextPanel.focus();return false}},{key:"onLogEntryCommentAdd",value:function e(i,s){var n;var a=!t.Type.isUndefined(s);s=!t.Type.isUndefined(s)?parseInt(s):0;var o=document.getElementById("informer_comments_".concat(i));var r=document.getElementById("informer_comments_new_".concat(i));if(o&&!r){if(s>0){n=s}else if(!a){n=(o.innerHTML.length>0?parseInt(o.innerHTML):0)+1}if(parseInt(n)>0){o.innerHTML=n;o.style.display="inline-block";if(document.getElementById("informer_comments_text2_".concat(i))){document.getElementById("informer_comments_text2_".concat(i)).style.display="inline-block"}if(document.getElementById("informer_comments_text_".concat(i))){document.getElementById("informer_comments_text_".concat(i)).style.display="none"}}}var l=document.getElementById("comcntleave-all");if(l){if(s>0){n=s}else if(!a){n=(l.innerHTML.length>0?parseInt(l.innerHTML):0)+1}l.innerHTML=n}}}]);return e}();var k=function(){function e(){babelHelpers.classCallCheck(this,e);this.isBusyGettingNextPage=false;this.isBusyRefreshing=false;this.pageNumber=1;this.nextPageXhr=null;this.refreshXhr=null;this.nextUrl="";this.requestErrorTimeout={refresh:null,nextPage:null};this["class"]={notifier:"lenta-notifier-waiter",notifierActive:"lenta-notifier-shown"};this.onScroll=this.onScroll.bind(this);this.refreshErrorScroll=this.refreshErrorScroll.bind(this);this.nextPageErrorScroll=this.nextPageErrorScroll.bind(this);this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){this.setPageNumber(1)}},{key:"initScroll",value:function e(t,i){t=!!t;i=!!i;if(t){document.removeEventListener("scroll",this.onScroll);document.addEventListener("scroll",this.onScroll)}else{document.removeEventListener("scroll",this.onScroll)}if(i&&document.getElementById("next_post_more")){document.getElementById("next_post_more").style.display=t?"block":"none"}}},{key:"onScroll",value:function e(){var s=this;var a=A.getMaxScroll();if(!((window.pageYOffset>=a||document.documentElement.scrollHeight<=window.innerHeight)&&(window.pageYOffset>0||a>0)&&!this.isBusyRefreshing&&!this.isBusyGettingNextPage)){return}if(A.getOption("preventNextPage",false)===true){return}document.removeEventListener("scroll",this.onScroll);this.isBusyGettingNextPage=true;this.nextPageXhr=n.Ajax.wrap({type:"json",method:"GET",url:this.getNextPageUrl(),data:"",callback:function e(n){s.nextPageXhr=null;if(t.Type.isPlainObject(n)&&t.Type.isPlainObject(n.PROPS)&&t.Type.isStringFilled(n.PROPS.CONTENT)&&(t.Type.isUndefined(n.LAST_TS)||parseInt(n.LAST_TS)<=0||parseInt(t.Loc.getMessage("MSLFirstPageLastTS"))<=0||parseInt(n.LAST_TS)<parseInt(t.Loc.getMessage("MSLFirstPageLastTS")))){s.processAjaxBlock(n.PROPS,{type:"next",callback:function e(){A.recalcMaxScroll();oMSL.registerBlocksToCheck();setTimeout(oMSL.checkNodesHeight.bind(oMSL),100);i.EventEmitter.emit("BX.UserContentView.onRegisterViewAreaListCall",new i.BaseEvent({compatData:[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}]}))}});var a=s.getPageNumber();if(parseInt(t.Loc.getMessage("MSLPageNavNum"))>0&&a>0){s.setPageNumber(a+1);var o=t.Uri.removeParam(s.getNextPageUrl(),["PAGEN_"+t.Loc.getMessage("MSLPageNavNum")]);o=t.Uri.addParam(o,babelHelpers.defineProperty({},"PAGEN_".concat(parseInt(t.Loc.getMessage("MSLPageNavNum"))),s.getPageNumber()+1));s.setNextPageUrl(o)}document.addEventListener("scroll",s.onScroll)}else{s.requestError("nextPage",true)}s.isBusyGettingNextPage=false},callback_failure:function e(){s.requestError("nextPage",true);s.nextPageXhr=null;s.isBusyGettingNextPage=false}})}},{key:"refresh",value:function e(i,s){var a=this;i=!!i;if(this.isBusyGettingNextPage&&!t.Type.isNull(this.nextPageXhr)){this.nextPageXhr.abort()}var o=document.getElementById("lenta_notifier");if(o){o.classList.add(this["class"].notifier)}A.setRefreshNeeded(false);A.setRefreshStarted(true);w.hideRefreshNeededNotifier();O.startWaiter();F.hideAll();this.isBusyRefreshing=true;var r=t.Uri.removeParam(document.location.href,["RELOAD","RELOAD_JSON","FIND"]);r=t.Uri.addParam(r,{RELOAD:"Y",RELOAD_JSON:"Y"});if(t.Type.isPlainObject(s)&&t.Type.isStringFilled(s.find)){r=t.Uri.addParam(r,{FIND:s.find})}var l=[{name:"BX-ACTION-TYPE",value:"get_dynamic"},{name:"BX-REF",value:document.referrer},{name:"BX-CACHE-MODE",value:"APPCACHE"},{name:"BX-APPCACHE-PARAMS",value:JSON.stringify(window.appCacheVars)},{name:"BX-APPCACHE-URL",value:!t.Type.isUndefined(BX.frameCache)&&t.Type.isPlainObject(BX.frameCache.vars)&&t.Type.isStringFilled(BX.frameCache.vars.PAGE_URL)?BX.frameCache.vars.PAGE_URL:oMSL.curUrl}];this.refreshXhr=n.Ajax.wrap({type:"json",method:"GET",url:r,data:"",headers:l,callback:function e(s){a.refreshXhr=null;a.setPageNumber(1);A.setRefreshStarted(false);A.setRefreshNeeded(false);O.stopWaiter();if(document.getElementById("lenta_notifier")){document.getElementById("lenta_notifier").classList.remove(a["class"].notifier)}app.exec("pullDownLoadingStop");app.exec("hideSearchBarProgress");if(t.Type.isPlainObject(s)&&t.Type.isPlainObject(s.PROPS)&&t.Type.isStringFilled(s.PROPS.CONTENT)){a.setPreventNextPage(false);BitrixMobile.LazyLoad.clearImages();app.hidePopupLoader();w.hideNotifier();w.hideRefreshNeededNotifier();if(!t.Type.isUndefined(s.COUNTER_TO_CLEAR)){BXMobileApp.onCustomEvent("onClearLFCounter",[s.COUNTER_TO_CLEAR],true);BXMobileApp.Events.postToComponent("onClearLiveFeedCounter",{counterCode:s.COUNTER_TO_CLEAR,serverTime:s.COUNTER_SERVER_TIME,serverTimeUnix:s.COUNTER_SERVER_TIME_UNIX},"communication")}a.processAjaxBlock(s.PROPS,{type:"refresh",callback:function e(){Y.resetFlags();Y.init();if(!t.Type.isUndefined(BX.frameCache)&&document.getElementById("bxdynamic_feed_refresh")&&(t.Type.isUndefined(s.REWRITE_FRAMECACHE)||s.REWRITE_FRAMECACHE!=="N")){var i=!t.Type.isUndefined(s.TS)&&parseInt(s.TS)>0?parseInt(s.TS):0;if(i>0){A.setOptions({frameCacheTs:i})}A.updateFrameCache({timestamp:i})}oMSL.registerBlocksToCheck();setTimeout((function(){BitrixMobile.LazyLoad.showImages()}),1e3);w.initEvents()}});if(i){BitrixAnimation.animate({duration:1e3,start:{scroll:window.pageYOffset},finish:{scroll:0},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function e(t){window.scrollTo(0,t.scroll)},complete:function e(){}})}if(window.applicationCache&&s.isManifestUpdated=="1"&&!oMSL.appCacheDebug&&(window.applicationCache.status==window.applicationCache.IDLE||window.applicationCache.status==window.applicationCache.UPDATEREADY)){window.applicationCache.update()}}else{a.requestError("refresh",true)}a.isBusyRefreshing=false},callback_failure:function e(){a.refreshXhr=null;A.setRefreshStarted(false);A.setRefreshNeeded(false);O.stopWaiter();if(document.getElementById("lenta_notifier")){document.getElementById("lenta_notifier").classList.remove(a["class"].notifier)}app.exec("pullDownLoadingStop");app.exec("hideSearchBarProgress");a.requestError("refresh",true);a.isBusyRefreshing=false}})}},{key:"processAjaxBlock",value:function e(i,s){if(!t.Type.isPlainObject(s)||!t.Type.isStringFilled(s.type)||["refresh","next"].indexOf(s.type)<0){return}var n=false;var a=false;o(r);l(c);function o(e){if(t.Type.isArray(i.CSS)&&i.CSS.length>0){BX.load(i.CSS,e)}else{e()}}function r(){if(s.type==="refresh"){document.getElementById("lenta_wrapper_global").innerHTML=i.CONTENT}else{document.getElementById("lenta_wrapper").insertBefore(t.Dom.create("div",{html:i.CONTENT}),document.getElementById("next_post_more"))}n=true;if(a){c()}}function l(e){if(t.Type.isArray(i.JS)&&i.JS.length>0){BX.load(i.JS,e)}else{e()}}function c(){a=true;if(n){t.ajax.processRequestData(i.CONTENT,{scriptsRunFirst:false,dataType:"HTML",onsuccess:function e(){if(t.Type.isFunction(s.callback)){s.callback()}}})}}}},{key:"requestError",value:function e(t,i){var s=this;if(!["refresh","nextPage"].includes(t)){t="refresh"}i=!!i;var n=document.getElementById("lenta_".concat(t.toLowerCase(),"_error"));if(this.requestErrorTimeout[t]){clearTimeout(this.requestErrorTimeout[t])}if(n){if(i){n.classList.add(this["class"].notifierActive);if(t==="refresh"){document.addEventListener("scroll",this.refreshErrorScroll)}}else{if(t==="refresh"){document.removeEventListener("scroll",this.refreshErrorScroll)}n.classList.remove(this["class"].notifierActive)}}else{this.requestErrorTimeout[t]=setTimeout((function(){s.requestError(t,i)}),500)}if(t==="nextPage"){this.initScroll(!i,true)}}},{key:"refreshErrorScroll",value:function e(){this.requestError("refresh",false)}},{key:"nextPageErrorScroll",value:function e(){this.requestError("nextPage",false)}},{key:"setPageNumber",value:function e(t){this.pageNumber=parseInt(t)}},{key:"getPageNumber",value:function e(){return this.pageNumber}},{key:"setNextPageUrl",value:function e(t){this.nextUrl=t}},{key:"getNextPageUrl",value:function e(){return this.nextUrl}},{key:"setPreventNextPage",value:function e(t){A.setOptions({preventNextPage:!!t});var i=document.getElementById("next_page_refresh_needed");var s=document.getElementById("next_post_more");if(i&&s){i.style.display=!!t?"block":"none";s.style.display=!!t?"none":"block"}}}]);return e}();var B,C;var N=function(){function e(){babelHelpers.classCallCheck(this,e);this.pageId=null;this.logId=false;this.refreshNeeded=false;this.refreshStarted=false;this.options={};this.nodeId={feedContainer:"lenta_wrapper"};this["class"]={listWrapper:"lenta-list-wrap",postWrapper:"post-wrap",pinnedPanel:"lenta-pinned-panel",pin:"lenta-item-pin",postNewContainerTransformNew:"lenta-item-new-cont",postNewContainerTransform:"lenta-item-transform-cont",postLazyLoadCheck:"lenta-item-lazyload-check",listPost:"lenta-item",detailPost:"post-wrap",postItemTopWrap:"post-item-top-wrap",postItemTop:"post-item-top",postItemPostBlock:"post-item-post-block",postItemPostContentView:"post-item-contentview",postItemDescriptionBlock:"post-item-description",postItemAttachedFileWrap:"post-item-attached-disk-file-wrap",postItemInformWrap:"post-item-inform-wrap",postItemInformWrapTree:"post-item-inform-wrap-tree",postItemInformComments:"post-item-inform-comments",postItemInformMore:"post-item-more",postItemMore:"post-more-block",postItemPinnedBlock:"post-item-pinned-block",postItemPinActive:"lenta-item-pin-active",postItemGratitudeUsersSmallContainer:"lenta-block-grat-users-small-cont",postItemGratitudeUsersSmallHidden:"lenta-block-grat-users-small-hidden",postItemImportantUserList:"post-item-important-list",addPostButton:"feed-add-post-button"};this.newPostContainer=null;this.maxScroll=0;this.lastActivityDate=0;this.availableGroupList={};this.isPullDownEnabled=false;this.isPullDownLocked=false;this.isFrameDataReceived=false;this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this;BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAdd",this.afterPostAdd.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostAddError",this.afterPostAddError.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdate",this.afterPostUpdate.bind(this));BXMobileApp.addCustomEvent("Livefeed.PublicationQueue::afterPostUpdateError",this.afterPostUpdateError.bind(this));BXMobileApp.addCustomEvent("Livefeed::showLoader",this.showLoader.bind(this));BXMobileApp.addCustomEvent("Livefeed::hideLoader",this.hideLoader.bind(this));BXMobileApp.addCustomEvent("Livefeed::scrollTop",this.scrollTop.bind(this));BXMobileApp.addCustomEvent("Livefeed::onLogEntryDetailNotFound",this.removePost.bind(this));BXMobileApp.addCustomEvent("Livefeed.PinnedPanel::change",this.onPinnedPanelChange.bind(this));BXMobileApp.addCustomEvent("Livefeed.PostDetail::pinChanged",this.onPostPinChanged.bind(this));i.EventEmitter.subscribe("BX.LazyLoad:ImageLoaded",this.onLazyLoadImageLoaded.bind(this));i.EventEmitter.subscribe("MobileBizProc:onRenderLogMessages",this.onMobileBizProcRenderLogMessages.bind(this));i.EventEmitter.subscribe("MobilePlayer:onError",this.onMobilePlayerError);document.addEventListener("DOMContentLoaded",(function(){document.addEventListener("click",t.handleClick.bind(t))}))}},{key:"initListOnce",value:function e(s){var n=this;if(!t.Type.isPlainObject(s)){s={}}if(!t.Type.isUndefined(s.arAvailableGroup)){this.availableGroupList=s.arAvailableGroup}i.EventEmitter.subscribe("onFrameDataReceivedBefore",BitrixMobile.LazyLoad.clearImages);i.EventEmitter.subscribe("BX.LazyLoad:ImageLoaded",(function(){n.recalcMaxScroll()}));i.EventEmitter.subscribe("onFrameDataReceived",(function(){n.isPullDownEnabled=false;n.isPullDownLocked=false;n.isFrameDataReceived=true;app.exec("pullDownLoadingStop");BitrixMobile.LazyLoad.showImages(true)}));i.EventEmitter.subscribe("onFrameDataProcessed",(function(e){var i=e.getCompatData(),s=babelHelpers.slicedToArray(i,2),a=s[0],o=s[1];if(!t.Type.isUndefined(a)&&!t.Type.isUndefined(a[0])&&!t.Type.isUndefined(o)&&!!o){if(!t.Type.isUndefined(a[0].PROPS)&&!t.Type.isUndefined(a[0].PROPS.TS)&&parseInt(a[0].PROPS.TS)>0){n.setOptions({frameCacheTs:parseInt(a[0].PROPS.TS)})}}BitrixMobile.LazyLoad.showImages(true);if(!!o){Q.setPreventNextPage(true)}}));i.EventEmitter.subscribe("onCacheDataRequestStart",(function(){setTimeout((function(){if(!n.isFrameDataReceived){n.isPullDownLocked=true;app.exec("pullDownLoadingStart")}}),1e3)}));i.EventEmitter.subscribe("onFrameDataReceivedError",(function(){app.BasicAuth({success:function e(){BX.frameCache.update(true)},failture:function e(){n.isPullDownLocked=false;app.exec("pullDownLoadingStop");Q.requestError("refresh",true)}})}));i.EventEmitter.subscribe("onFrameDataRequestFail",(function(e){var i=e.getCompatData(),s=babelHelpers.slicedToArray(i,1),a=s[0];if(!t.Type.isUndefined(a)&&t.Type.isStringFilled(a.reason)&&a.reason==="bad_eval"){n.isPullDownLocked=false;app.exec("pullDownLoadingStop");Q.requestError("refresh",true)}else{app.BasicAuth({success:function e(){BX.frameCache.update(true)},failture:function e(){n.isPullDownLocked=false;app.exec("pullDownLoadingStop");Q.requestError("refresh",true)}})}}));i.EventEmitter.subscribe("onCacheInvokeAfter",(function(e){var t=e.getCompatData(),i=babelHelpers.slicedToArray(t,2),s=i[0],n=i[1];if(n.items.length<=0){BX.frameCache.update(true,true)}}));BXMobileApp.addCustomEvent("onAfterEdit",(function(e){n.afterEdit({responseData:e.postResponseData,logId:e.postData.data.log_id})}));i.EventEmitter.subscribe("onPullDownDisable",(function(){BXMobileApp.UI.Page.Refresh.setEnabled(false)}));i.EventEmitter.subscribe("onPullDownEnable",(function(){BXMobileApp.UI.Page.Refresh.setEnabled(true)}));BXMobileApp.UI.Page.Refresh.setParams({callback:function e(){if(!n.isPullDownLocked){Q.refresh(true)}},backgroundColor:"#E7E9EB"});BXMobileApp.UI.Page.Refresh.setEnabled(true)}},{key:"setPageId",value:function e(t){this.pageId=t}},{key:"getPageId",value:function e(){return this.pageId}},{key:"setLogId",value:function e(t){this.logId=parseInt(t)}},{key:"getLogId",value:function e(){return parseInt(this.logId)}},{key:"setOptions",value:function e(t){for(var i in t){if(!t.hasOwnProperty(i)){continue}this.options[i]=t[i]}}},{key:"getOption",value:function e(i,s){if(t.Type.isUndefined(s)){s=null}if(!t.Type.isStringFilled(i)){return null}return!t.Type.isUndefined(this.options[i])?this.options[i]:s}},{key:"setRefreshNeeded",value:function e(t){this.refreshNeeded=t}},{key:"getRefreshNeeded",value:function e(){return this.refreshNeeded}},{key:"setRefreshStarted",value:function e(t){this.refreshStarted=t}},{key:"getRefreshStarted",value:function e(){return this.refreshStarted}},{key:"setNewPostContainer",value:function e(t){this.newPostContainer=t}},{key:"getNewPostContainer",value:function e(){return this.newPostContainer}},{key:"setMaxScroll",value:function e(t){this.maxScroll=t}},{key:"getMaxScroll",value:function e(){return this.maxScroll}},{key:"afterPostAdd",value:function e(i){if(!t.Type.isPlainObject(i)){i={}}var s=typeof i.postId!="undefined"?parseInt(i.postId):0;var n=typeof i.context!="undefined"?i.context:"";var a=typeof i.pageId!="undefined"?i.pageId:"";var o=typeof i.groupId!="undefined"?i.groupId:null;if(a!==this.pageId){return}x["delete"](o);if(s<=0||t.Type.isStringFilled(i.warningText)){return}this.getEntryContent({entityType:"BLOG_POST",entityId:s,queueKey:i.key,action:"add"})}},{key:"afterPostUpdate",value:function e(i){if(!t.Type.isPlainObject(i)){i={}}var s=typeof i.context!="undefined"?i.context:"";var n=typeof i.pageId!="undefined"?i.pageId:"";var a=typeof i.postId!="undefined"?parseInt(i.postId):0;var o=typeof i.pinned!="undefined"&&!!i.pinned;this.getEntryContent({entityType:"BLOG_POST",entityId:a,queueKey:i.key,action:"update",pinned:o})}},{key:"afterPostAddError",value:function e(i){var s=this;if(!t.Type.isPlainObject(i)){i={}}var n=t.Type.isStringFilled(i.context)?i.context:"";var a=i.groupId?i.groupId:"";var o={a_users:[],b_groups:[]};oMSL.buildSelectedDestinations(i.postData,o);V.setParams({selectedRecipients:o});V.setParams({messageText:i.postData.POST_MESSAGE});x.save(i.postData,a);i.callback=function(){if(BXMobileAppContext.getApiVersion()>=s.getApiVersion("layoutPostForm")){H.show({pageId:s.getPageId(),postId:0})}else{app.exec("showPostForm",V.show())}};this.showPostError(i)}},{key:"afterPostUpdateError",value:function e(i){if(!t.Type.isPlainObject(i)){i={}}var s=t.Type.isStringFilled(i.context)?i.context:"";i.callback=function(){p.edit({postId:parseInt(i.postId)})};this.showPostError(i)}},{key:"showPostError",value:function e(i){if(!t.Type.isPlainObject(i)){i={}}i.callback=t.Type.isFunction(i.callback)?i.callback:function(){};var s=t.Type.isStringFilled(i.errorText)?i.errorText:false;F.showError({text:s?s:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_PUBLICATION_ERROR"),onTap:function e(t){i.callback(t)}})}},{key:"showLoader",value:function e(i){if(!t.Type.isPlainObject(i)){i={}}if(i.pageId&&this.pageId!==null&&i.pageId!=this.pageId){return}app.showPopupLoader({text:t.Type.isStringFilled(i.text)?i.text:""})}},{key:"hideLoader",value:function e(){app.hidePopupLoader()}},{key:"scrollTop",value:function e(i){if(!t.Type.isPlainObject(i)){i={}}if(i.pageId&&this.pageId!==null&&i.pageId!=this.pageId){return}window.scrollTo(0,0)}},{key:"getEntryContent",value:function e(i){var s=this;if(!t.Type.isPlainObject(i)){i={}}var a=i.logId?parseInt(i.logId):0;if(a<=0&&!(t.Type.isStringFilled(i.entityType)&&parseInt(i.entityId)>0)){return}n.Ajax.runComponentAction("bitrix:mobile.socialnetwork.log.ex","getEntryContent",{mode:"class",signedParameters:this.getOption("signedParameters",{}),data:{params:{logId:parseInt(i.logId)>0?parseInt(i.logId):0,pinned:!!i.pinned?"Y":"N",entityType:t.Type.isStringFilled(i.entityType)?i.entityType:"",entityId:parseInt(i.entityId)>0?parseInt(i.entityId):0,siteTemplateId:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_SITE_TEMPLATE_ID")}}}).then((function(e){if(a<=0){n.Ajax.runComponentAction("bitrix:mobile.socialnetwork.log.ex","getEntryLogId",{mode:"class",data:{params:{entityType:t.Type.isStringFilled(i.entityType)?i.entityType:"",entityId:parseInt(i.entityId)>0?parseInt(i.entityId):0}}}).then((function(t){if(t.data.logId){s.insertPost({logId:t.data.logId,content:e.data.html,postId:i.postId,queueKey:i.queueKey,action:i.action,serverTimestamp:parseInt(e.data.componentResult.serverTimestamp)})}}))}else{s.insertPost({logId:a,content:e.data.html,postId:i.postId,queueKey:i.queueKey,action:i.action,serverTimestamp:parseInt(e.data.componentResult.serverTimestamp)})}}))}},{key:"processDetailBlock",value:function e(i,s,n){if(!i||!s){return Promise.reject()}var a=s.querySelector(n);var o=i.querySelector(n);if(o&&a){return t.Runtime.html(o,a.innerHTML)}return Promise.reject()}},{key:"insertPost",value:function e(n){var a=this;var o=document.getElementById(this.nodeId.feedContainer);var r=n.content;var l=n.logId;var c=n.queueKey;var d=n.action;if(!t.Type.isDomNode(o)||!t.Type.isStringFilled(r)){return}var u=typeof n.serverTimestamp!="undefined"&&parseInt(n.serverTimestamp)>0?parseInt(n.serverTimestamp):0;if(d==="update"){var p=document.getElementById("lenta_item_"+l);if(!p){p=document.getElementById("lenta_item")}if(!p){return}var f=this.pageId.match(/^detail_(\d+)/i);if(f&&l!=f[1]){return}var m=p.appendChild(document.createElement("div"));m.style.display="none";t.Runtime.html(m,r);if(p.id==="lenta_item"){this.processDetailBlock(p,m,".".concat(this["class"].postItemTop));this.processDetailBlock(p,m,".".concat(this["class"].postItemPostBlock)).then((function(){var e=p.querySelector(".".concat(a["class"].postItemPostBlock));var t=m.querySelector(".".concat(a["class"].postItemPostBlock));if(e||t){var i=a.filterPostBlockClassList(e.classList);var s=a.filterPostBlockClassList(t.classList);i.forEach((function(t){e.classList.remove(t)}));s.forEach((function(t){e.classList.add(t)}))}BitrixMobile.LazyLoad.showImages()}));this.processDetailBlock(p,m,".".concat(this["class"].postItemAttachedFileWrap)).then((function(){BitrixMobile.LazyLoad.showImages()}));this.processDetailBlock(p,m,".".concat(this["class"].postItemInformWrap));this.processDetailBlock(p,m,".".concat(this["class"].postItemInformWrapTree))}else{p=p.querySelector("div.".concat(this["class"].postItemTopWrap));var h=m.querySelector("div.".concat(this["class"].postItemTopWrap));t.Runtime.html(p,h.innerHTML).then((function(){oMSL.checkNodesHeight();BitrixMobile.LazyLoad.showImages();if(document.getElementById("framecache-block-feed")){setTimeout((function(){a.updateFrameCache({timestamp:u})}),750)}}))}m.remove()}else if(d==="add"){this.setNewPostContainer(t.Tag.render(B||(B=babelHelpers.taggedTemplateLiteral(['<div class="'," ",'" ontransitionend="','"></div>'])),this["class"].postNewContainerTransformNew,this["class"].postLazyLoadCheck,this.handleInsertPostTransitionEnd.bind(this)));t.Dom.prepend(this.getNewPostContainer(),o);s.Utils.htmlWithInlineJS(this.getNewPostContainer(),r).then((function(){var e=a.getNewPostContainer().querySelector("div.".concat(a["class"].listPost));t.Dom.style(a.getNewPostContainer(),"height","".concat(e.scrollHeight+12,"px"));if(u>0){a.setOptions({frameCacheTs:u})}oMSL.registerBlocksToCheck();setTimeout((function(){oMSL.checkNodesHeight()}),100);setTimeout((function(){a.updateFrameCache({timestamp:u})}),750)}))}R.emit("onPostInserted",new i.BaseEvent({data:{key:c}}))}},{key:"removePost",value:function e(t){var i=parseInt(t.logId);if(i<=0){return}var s=document.getElementById("lenta_item_"+i);if(!s){return}s.remove()}},{key:"filterPostBlockClassList",value:function e(t){var i=[];Array.from(t).forEach((function(e){if(e==="info-block-background"||e==="info-block-background-with-title"||e==="info-block-gratitude"||e==="info-block-important"||e==="ui-livefeed-background"||e.match(/info-block-gratitude-(.+)/i)||e.match(/ui-livefeed-background-(.+)/i)){i.push(e)}}));return i}},{key:"handleInsertPostTransitionEnd",value:function e(i){if(i.propertyName==="height"){this.getNewPostContainer().classList.remove(this["class"].postNewContainerTransformNew);this.getNewPostContainer().classList.remove(this["class"].postNewContainerTransform);t.Dom.style(this.getNewPostContainer(),"height",null);this.recalcMaxScroll();BitrixMobile.LazyLoad.showImages()}}},{key:"onLazyLoadImageLoaded",value:function e(i){var s=this;this.recalcMaxScroll();var n=i.getData(),a=babelHelpers.slicedToArray(n,1),o=a[0];if(o){var r=o.closest(".".concat(this["class"].postLazyLoadCheck));if(r){var l=r.querySelector("div.".concat(this["class"].listPost));if(l){r.classList.add(this["class"].postNewContainerTransform);t.Dom.style(r,"height","".concat(l.scrollHeight,"px"));setTimeout((function(){r.classList.remove(s["class"].postNewContainerTransform);t.Dom.style(r,"height",null)}),500)}}}}},{key:"recalcMaxScroll",value:function e(){this.setMaxScroll(document.documentElement.scrollHeight-2*window.innerHeight)}},{key:"onMobileBizProcRenderLogMessages",value:function e(){this.recalcMaxScroll()}},{key:"onPinnedPanelChange",value:function e(i){var s=i.logId?parseInt(i.logId):0;var n=["Y","N"].indexOf(i.value)!==-1?i.value:null;var a=t.Type.isStringFilled(i.pinActionContext)?i.pinActionContext:"list";if(!s||!n||!Y.getPinnedPanelNode()){return}var o=t.Type.isDomNode(i.postNode)?i.postNode:null;if(!t.Type.isDomNode(i.postNode)){o=document.getElementById("lenta_item_".concat(s))}if(!t.Type.isDomNode(o)){return}if(n==="N"){Y.extractEntry({logId:s,postNode:o,containerNode:document.getElementById(this.nodeId.feedContainer)})}else if(n==="Y"){if(t.Type.isDomNode(i.postNode)){app.showPopupLoader({text:""});Y.getPinnedData({logId:s}).then((function(e){app.hidePopupLoader();Y.insertEntry({logId:s,postNode:i.postNode,pinnedContent:e})}),(function(e){app.hidePopupLoader()}))}}}},{key:"onPostPinChanged",value:function e(t){var i=t.logId?parseInt(t.logId):0;var s=["Y","N"].indexOf(t.value)!==-1?t.value:null;if(!i||!s){return}var n=document.getElementById("log-entry-menu-"+i);if(!n){return}var a=n.closest(".".concat(this["class"].detailPost));if(!a){a=n.closest(".".concat(this["class"].listPost))}if(!a){return}if(s==="Y"){a.classList.add(this["class"].postItemPinActive)}else{a.classList.remove(this["class"].postItemPinActive)}}},{key:"handleClick",value:function e(i){if(i.target.classList.contains(this["class"].pin)){var s=null;var n=null;var a="list";var o=i.target.closest(".".concat(this["class"].listPost));if(o){n=o.querySelector('[data-menu-type="post"]');s=this.getPostFromNode(o)}else{a="detail";o=i.target.closest(".".concat(this["class"].detailPost));if(o){n=o.querySelector('[data-menu-type="post"]');if(n){s=this.getPostFromLogId(n.getAttribute("data-log-id"))}}}if(s&&n){return s.setPinned({menuNode:n,context:a})}i.stopPropagation();return i.preventDefault()}else if(i.target.classList.contains(this["class"].addPostButton)){if(BXMobileAppContext.getApiVersion()>=this.getApiVersion("layoutPostForm")){var r=new h;r.show({pageId:this.getPageId(),groupId:this.getOption("groupId",0)})}else{app.exec("showPostForm",V.show())}}else if(i.target.classList.contains(".".concat(W["class"].scrollButton))||i.target.closest(".".concat(W["class"].scrollButton))){if(i.target.classList.contains(".".concat(W["class"].scrollButtonTop))||i.target.closest(".".concat(W["class"].scrollButtonTop))){W.scrollTo("top")}else if(i.target.classList.contains(".".concat(W["class"].scrollButtonBottom))||i.target.closest(".".concat(W["class"].scrollButtonBottom))){W.scrollTo("bottom")}}else if((i.target.closest(".".concat(this["class"].listWrapper))||i.target.closest(".".concat(this["class"].pinnedPanel)))&&!(i.target.tagName.toLowerCase()==="a"&&t.Type.isStringFilled(i.target.getAttribute("target"))&&i.target.getAttribute("target").toLowerCase()==="_blank")){var l=!!(i.target.classList.contains(this["class"].postItemPinnedBlock)||i.target.closest(".".concat(this["class"].postItemPinnedBlock)));var c=!!(!l&&(i.target.classList.contains(this["class"].postItemPostContentView)||i.target.closest(".".concat(this["class"].postItemPostContentView))||i.target.classList.contains(this["class"].postItemDescriptionBlock)||i.target.closest(".".concat(this["class"].postItemDescriptionBlock))));var d=!!(!l&&!c&&(i.target.classList.contains(this["class"].postItemInformComments)||i.target.closest(".".concat(this["class"].postItemInformComments))));var p=!!(!l&&!c&&!d&&(i.target.classList.contains(this["class"].postItemInformMore)||i.target.closest(".".concat(this["class"].postItemInformMore))));if(l||c||d||p){var f=i.target.closest(".".concat(this["class"].listPost));if(f){var m=this.getPostFromNode(f);if(m){m.openDetail({pathToEmptyPage:this.getOption("pathToEmptyPage",""),pathToCalendarEvent:this.getOption("pathToCalendarEvent",""),pathToTasksRouter:this.getOption("pathToTasksRouter",""),event:i,focusComments:d,showFull:p})}}i.stopPropagation();return i.preventDefault()}}else if(i.target.closest(".".concat(this["class"].postWrapper))){var g=!!(i.target.classList.contains(this["class"].postItemInformMore)||i.target.closest(".".concat(this["class"].postItemInformMore))||i.target.classList.contains(this["class"].postItemMore)||i.target.closest(".".concat(this["class"].postItemMore)));var v=null;if(i.target.classList.contains(this["class"].postItemGratitudeUsersSmallContainer)){v=i.target}else{v=i.target.closest(".".concat(this["class"].postItemGratitudeUsersSmallContainer))}if(g||t.Type.isDomNode(v)){if(t.Type.isDomNode(v)){v.style.display="none";var E=v.parentNode.querySelector(".".concat(this["class"].postItemGratitudeUsersSmallHidden));if(E){E.style.display="block"}}var I=this.getOption("logId",0);var T=new u({logId:I});T.expandText();i.stopPropagation();return i.preventDefault()}var y=null;if(i.target.classList.contains(this["class"].postItemImportantUserList)){y=i.target}else{y=i.target.closest(".".concat(this["class"].postItemImportantUserList))}if(y){var b=y.parentNode.querySelector("input");var L=0;if(t.Type.isDomNode(b)){L=parseInt(b.getAttribute("bx-data-post-id"))}if(L>0){app.exec("openComponent",{name:"JSStackComponent",componentCode:"livefeed.important.list",scriptPath:"/mobileapp/jn/livefeed.important.list/?version=1.0.0",params:{POST_ID:L,SETTINGS:this.getOption("importantData",{})},rootWidget:{name:"list",settings:{objectName:"livefeedImportantListWidget",title:BX.message("MOBILE_EXT_LIVEFEED_USERS_LIST_TITLE"),modal:false,backdrop:{mediumPositionPercent:75}}}},false)}}}}},{key:"getPostFromNode",value:function e(i){if(!t.Type.isDomNode(i)){return}var s=parseInt(i.getAttribute("data-livefeed-id"));if(s<=0){return}return new u({logId:s,entryType:i.getAttribute("data-livefeed-post-entry-type"),useFollow:i.getAttribute("data-livefeed-post-use-follow")==="Y",useTasks:i.getAttribute("data-livefeed-post-use-tasks")==="Y",perm:i.getAttribute("data-livefeed-post-perm"),destinations:i.getAttribute("data-livefeed-post-destinations"),postId:parseInt(i.getAttribute("data-livefeed-post-id")),url:i.getAttribute("data-livefeed-post-url"),entityXmlId:i.getAttribute("data-livefeed-post-entity-xml-id"),readOnly:i.getAttribute("data-livefeed-post-read-only")==="Y",contentTypeId:i.getAttribute("data-livefeed-post-content-type-id"),contentId:i.getAttribute("data-livefeed-post-content-id"),showFull:i.getAttribute("data-livefeed-post-show-full")==="Y",taskId:parseInt(i.getAttribute("data-livefeed-task-id")),taskData:i.getAttribute("data-livefeed-task-data"),calendarEventId:parseInt(i.getAttribute("data-livefeed-calendar-event-id"))})}},{key:"getPostFromLogId",value:function e(t){var i=null;t=parseInt(t);if(t<=0){return i}i=new u({logId:t});return i}},{key:"updateFrameCache",value:function e(i){var s=document.getElementById("framecache-block-feed");if(!t.Type.isDomNode(s)){s=document.getElementById("bxdynamic_feed_refresh")}if(!t.Type.isDomNode(s)){return}var n={USE_BROWSER_STORAGE:true,AUTO_UPDATE:true,USE_ANIMATION:false};var a=typeof i.timestamp!="undefined"?parseInt(i.timestamp):0;if(a>0){n.TS=a}BX.frameCache.writeCacheWithID("framecache-block-feed",s.innerHTML,parseInt(Math.random()*1e5),JSON.stringify(n))}},{key:"onMobilePlayerError",value:function e(i){var s=i.getData(),n=babelHelpers.slicedToArray(s,2),a=n[0],o=n[1];if(!t.Type.isDomNode(a)){return}if(!t.Type.isStringFilled(o)){return}var r=a.parentNode;if(r){if(r.querySelector(".disk-mobile-player-error-container")){return}}else{if(a.querySelector(".disk-mobile-player-error-container")){return}}var l=a.getElementsByTagName("source");var c=l.length;Array.from(l).forEach((function(e){if(t.Type.isStringFilled(e.src)&&e.src===o){t.Dom.remove(e);c--}}));if(c>0){return}var d=t.Dom.create("div",{props:{className:"disk-mobile-player-error-container"},children:[t.Dom.create("div",{props:{className:"disk-mobile-player-error-icon"},html:""}),t.Dom.create("div",{props:{className:"disk-mobile-player-error-message"},html:t.Loc.getMessage("MOBILE_EXT_LIVEFEED_PLAYER_ERROR_MESSAGE")})]});var u=d.querySelector(".disk-mobile-player-download");if(u){t.Dom.adjust(u,{events:{click:function e(){app.openDocument({url:o})}}})}if(r){a.style.display="none";r.appendChild(d)}else{t.Dom.adjust(a,{children:[d]})}}},{key:"getApiVersion",value:function e(t){var i=0;switch(t){case"layoutPostForm":i=37;break;case"pageMenu":i=34;break;case"tabs":i=41;break;default:}return i}},{key:"sendErrorEval",value:function e(t){BX.evalGlobal("try { "+t+" } catch (e) { this.sendError(e.message, e.name, e.number); }")}},{key:"sendError",value:function e(t,i,s){n.Ajax.runAction("socialnetwork.api.livefeed.mobileLogError",{data:{message:t,url:i,lineNumber:s}}).then((function(e){}),(function(e){}))}},{key:"setLastActivityDate",value:function e(){this.lastActivityDate=Math.round((new Date).getTime()/1e3)}},{key:"getLastActivityDate",value:function e(){return this.lastActivityDate}},{key:"afterEdit",value:function e(i){var s=i.responseData,n=i.logId;n=!t.Type.isUndefined(n)?parseInt(n):0;var a=t.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(["<div>","</div>"])),s.text);var o=document.getElementById("blog-post-first-after");if(o){o.parentNode.insertBefore(a,o.nextSibling)}var r=a.querySelector(".post-item-post-block");var l=a.querySelector(".post-item-top");var c=a.querySelector(".post-item-attached-file-wrap");if(n>0&&r&&l){var d={detailText:r.innerHTML,topText:l.innerHTML,logID:n};if(c){d.filesBlockText=c.innerHTML}BXMobileApp.onCustomEvent("onEditedPostInserted",d,true,true)}BitrixMobile.LazyLoad.showImages()}}]);return e}();var A=new N;var w=new a;var O=new o;var F=new r;var x=new l;var R=new d;var U=new f;var X=new m;var H=new h;var V=new g;var Y=new E;var j=new I;var G=new T;var q=new y;var W=new b;var z=new L;var K=new D;var Q=new k;e.Post=u;e.BlogPost=p;e.Instance=A;e.BalloonNotifierInstance=w;e.NextPageLoaderInstance=O;e.NotificationBarInstance=F;e.DatabaseUnsentPostInstance=x;e.PublicationQueueInstance=R;e.PostMenuInstance=U;e.PageMenuInstance=X;e.PostFormManagerInstance=H;e.PostFormOldManagerInstance=V;e.PinnedPanelInstance=Y;e.RatingInstance=j;e.ImportantManagerInstance=G;e.SearchBarInstance=q;e.PageScrollInstance=W;e.FollowManagerInstance=z;e.CommentsInstance=K;e.PageInstance=Q})(this.BX.MobileLivefeed=this.BX.MobileLivefeed||{},BX,BX.Event,BX,BX.Mobile);
//# sourceMappingURL=livefeed.bundle.map.js