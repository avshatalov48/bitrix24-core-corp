(function(e){if(e.BX.MobileTools)return;BX.MobileTools={getTextBlock:function(e){function o(e){var o=document.createElement("textarea");o.innerHTML=e;return o.value}var i=e.innerHTML.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<br\s*[\/]?>/gi,"~~~---~~~").replace(/~~~---~~~/g,"\n");i=i.replace(/<a\s+href="([^"]+)"[^>]*>([^<]+)<\/a>/gi,function(e,o,i){if(i.match(/^http/gi)){return'<a href="'+o+'">'+o+"</a>"}else{return e}});return o(BX.util.strip_tags(i))},openChat:function(e,o){o=o||false;if(!e)return false;if(typeof Application=="undefined"){Application=BXMobileAppContext}if(Application.getApiVersion()>=25){console.info("BX.MobileTools.openChat: open chat in JSNative component");BXMobileApp.Events.postToComponent("onOpenDialog",{dialogId:e,dialogTitleParams:o?{name:o.name||"",avatar:o.avatar||"",color:o.color||"",description:o.description||""}:false},"im.recent")}else{console.info("BX.MobileTools.openChat: open new browser page (legacy)");BXMobileApp.PageManager.loadPageUnique({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/im/dialog.php"+(!app.enableInVersion(11)?"?id="+e:""),bx24ModernStyle:true,data:{dialogId:e}})}return true},phoneTo:function(e,o){o=typeof o=="object"?o:{};if(!this.canUseTelephony()){o.callMethod="device"}if(o.callMethod=="telephony"){BXMobileApp.onCustomEvent("onPhoneTo",{number:e,params:o},true)}else if(o.callMethod=="device"){document.location.href="tel:"+this.correctNumberForPstn(e)}else{var i=[];i.push({title:BX.message("MOBILE_CALL_BY_B24"),callback:function(){o.callMethod="telephony";this.phoneTo(e,o)}.bind(this)});i.push({title:BX.message("MOBILE_CALL_BY_MOBILE"),callback:function(){o.callMethod="device";this.phoneTo(e,o)}.bind(this)});new BXMobileApp.UI.ActionSheet({buttons:i},"im-phone-menu").show()}},callTo:function(e,o){o=typeof o=="undefined"?false:o;BXMobileApp.onCustomEvent("onCallInvite",{userId:e,video:o},true)},correctNumberForPstn:function(e){if(!BX.type.isNotEmptyString(e)){return e}if(e.length<10){return e}if(e.substr(0,1)==="+"){return e}if(e.substr(0,3)==="011"){return e}if(e.substr(0,2)==="82"){return"+"+e}else if(e.substr(0,1)==="8"){return e}return"+"+e},canUseTelephony:function(){return BX.message("can_perform_calls")==="Y"},getMobileUrlParams:function(e){var o=[{exp:/\/company\/personal\/user\/(\d+)\/calendar\/\?EVENT_ID=(\d+).*/gi,replace:"/mobile/calendar/view_event.php?event_id=$2",useNewStyle:false},{exp:/\/company\/personal\/user\/(\d+)\/tasks\/task\/view\/(\d+)\//gi,replace:"/mobile/tasks/snmrouter/?routePage=view&USER_ID=$1&GROUP_ID=0&TASK_ID=$2",useNewStyle:true},{exp:/\/company\/personal\/user\/(\d+)\/tasks\//gi,replace:"/mobile/tasks/snmrouter/?routePage=list&USER_ID=$1",useNewStyle:true},{exp:/\/workgroups\/group\/(\d+)\/tasks\/task\/view\/(\d+)\//gi,replace:"/mobile/tasks/snmrouter/?routePage=view&GROUP_ID=$1&TASK_ID=$2",useNewStyle:true},{exp:/\/company\/personal\/user\/(\d+)\/blog\/(\d+)\/\?commentId=(\d+)#com(\d+)/gi,replace:"/mobile/log/?ACTION=CONVERT&ENTITY_TYPE_ID=BLOG_POST&ENTITY_ID=$2&commentId=$3#com$4",useNewStyle:true},{exp:/\/company\/personal\/user\/(\d+)\/blog\/(\d+)\//gi,replace:"/mobile/log/?ACTION=CONVERT&ENTITY_TYPE_ID=BLOG_POST&ENTITY_ID=$2",useNewStyle:true},{exp:/\/company\/personal\/log\/(\d+)\//gi,replace:"/mobile/log/?ACTION=CONVERT&ENTITY_TYPE_ID=LOG_ENTRY&ENTITY_ID=$1",useNewStyle:true},{exp:/\/company\/personal\/user\/(\d+)\/$/gi,replace:"/mobile/users/?user_id=$1",useNewStyle:true},{exp:/\/crm\/(deal|lead|company|contact)\/(?:show|details)\/(\d+)\//gi,replace:"/mobile/crm/$1/?page=view&$1_id=$2",useNewStyle:true},{exp:/\/workgroups\/group\/(\d+)\//gi,replace:"/mobile/?group_id=$1",useNewStyle:true}];var i=null;for(var n=0;n<o.length;n++){var t=e.replace(o[n].exp,o[n].replace);if(t!=e){i={url:t,bx24ModernStyle:o[n].useNewStyle};break}}return i},getOpenFunction:function(e){var o=null;var i=[{resolveFunction:BX.MobileTools.userIdFromUrl,openFunction:function(e){BXMobileApp.Events.postToComponent("onUserProfileOpen",[e])}},{resolveFunction:BX.MobileTools.taskIdFromUrl,openFunction:function(e){BXMobileApp.Events.postToComponent("taskbackground::task::action",e,"background")}},{resolveFunction:BX.MobileTools.diskFolderIdFromUrl,openFunction:function(e){BXMobileApp.Events.postToComponent("onDiskFolderOpen",[{folderId:e}],"background")}},{resolveFunction:BX.MobileTools.diskFileIdFromUrl,openFunction:function(e){BXMobileApp.Document.open({url:"/mobile/ajax.php?mobile_action=disk_download_file&action=downloadFile&fileId="+e})}}];var n=null;var t=null;for(var r=0;r<i.length;r++){n=i[r];t=n.resolveFunction.apply(null,[e]);if(t){break}}if(t){o=function(){n.openFunction.apply(this,[t])}}return o},resolveOpenFunction:function(e){var o=BX.MobileTools.getOpenFunction(e);if(!o){var i=BX.MobileTools.getMobileUrlParams(e);if(i){o=function(){BXMobileApp.PageManager.loadPageBlank(i)}}}return o},userIdFromUrl:function(e){var o=[/\/company\/personal\/user\/(\d+)\/($|\?)/i,/\/mobile\/users\/\?.*user_id=(\d+)/i];var i="$1";var n=null;for(var t=0;t<o.length;t++){var r=o[t];var a=e.match(r,i);if(a&&a.length>=2){n=a[1];break}}return n},taskIdFromUrl:function(e){var o=0,i=e.match(/\A?MID=([^#&]+)/);if(i){o=parseInt(i[1])}if(o<=0){i=e.match(/\A?commentId=([^#&]+)/);if(i){o=parseInt(i[1])}}var n=[/\/company\/personal\/user\/(\d+)\/tasks\/task\/view\/(\d+)\//i,/\/workgroups\/group\/(\d+)\/tasks\/task\/view\/(\d+)\//i];for(var t=0;t<n.length;t++){var r=e.match(n[t]);if(r){return{taskId:r[2],messageId:o}}}},diskFolderIdFromUrl:function(e){var o=e.match(/\/bitrix\/tools\/disk\/focus.php\?folderId=(\d+)/i);if(o){return o[1]}return null},diskFileIdFromUrl:function(e){var o=e.match(/\/disk\/showFile\/(\d+)\//i);if(o){return o[1]}return null},createCardScanner:function(e){return new function o(){this.onError=function(e){console.error("Error",e)};this.stripEmptyFields=e.stripEmptyFields||false;this.options=e;this.imageData=null;if(e["onResult"]){this.onResult=e["onResult"]}if(e["onError"]){this.onError=e["onError"]}if(e["onImageGet"]){this.onImageGet=e["onImageGet"]}this.open=function(){app.exec("openBusinessCardScanner",{callback:BX.proxy(function(e){if(e.canceled!=1&&e.url.length>0){this.imageData=e;if(this.options["onImageGet"]){this.onImageGet(e)}this.send()}},this)})};this.send=function(){if(this.options.url){var e=new FileUploadOptions;e.fileKey="card_file";e.fileName="image.jpg";e.mimeType="image/jpeg";e.chunkedMode=false;e.params={image:"Y"};var o=new FileTransfer;o.upload(this.imageData.url,this.options.url,BX.proxy(function(e){try{var o=JSON.parse(e.response);this.UNIQUE_ID=o.UNIQUE_ID;if(o.STATUS!="success"){if(o.ERROR){this.onError(o.ERROR)}return}else{this.options["onImageUploaded"](o)}BXMobileApp.addCustomEvent("onPull-bizcard",this.handler)}catch(e){this.onError(e)}},this),BX.proxy(function(e){this.onError({code:e.code,message:"Can't upload image"})},this),e)}};this.handler=BX.proxy(function(e){var o=e.params.RESULT;if(!o.ERROR&&o.UNIQUE_ID==this.UNIQUE_ID){BX.removeCustomEvent("onPull-bizcard",this.handler);if(typeof this.onResult=="function"){var i=o.DATA;var n={DATA:{},CARD_ID:o.CARD_ID};if(typeof i=="object"){if(this.stripEmptyFields){var t={};for(var r in i){if(i[r]!=""){t[r]=i[r]}}n.DATA=t}else{n.DATA=i}this.onResult(n)}else{this.onError(o)}}}},this)}},requestUserCounters:function(){BXMobileApp.onCustomEvent("requestUserCounters",{web:true},true)}};var o={onLiveFeedFavoriteView:/\/mobile\/index.php\?favorites=Y/gi,onCalendarEventView:/\/mobile\/calendar\/view_event.php\?event_id=(\d+)*/gi,onTaskView:/\/mobile\/tasks\/snmrouter\/\?routePage=view(.*)TASK_ID=/gi,onTaskListView:/\/mobile\/tasks\/snmrouter\/\?routePage=roles/gi,onTaskCreate:/\/mobile\/tasks\/snmrouter\/\?routePage=edit(.*)TASK_ID=0/gi,onTaskEdit:/\/mobile\/tasks\/snmrouter\/\?routePage=edit(.*)TASK_ID=(\d+)/gi,onUserProfileView:/\/mobile\/users\/\?user_id=(.*)/gi,onCRMInvoiceList:/\/mobile\/crm\/invoice/gi,onCRMLeadList:/\/mobile\/crm\/lead/gi,onCRMDealList:/\/mobile\/crm\/deal/gi,onCRMContactList:/\/mobile\/crm\/contact/gi,onCRMActivityList:/\/mobile\/crm\/activity\/list.php/gi,onCRMContactView:/\/mobile\/crm\/contact\/\?page=view&contact_id=/gi,onCRMDealView:/\/mobile\/crm\/deal\/\?page=view&deal_id=/gi,onCRMCompanyView:/\/mobile\/crm\/company\/\?page=view&company_id=/gi,onCRMLeadView:/\/mobile\/crm\/lead\/\?page=view&lead_id=/gi,onCRMQuoteView:/\/mobile\/crm\/quote\/\?page=view&quote_id=/gi,onCRMProductView:/\/mobile\/crm\/product\/\?page=view&product_id=/gi,onGroupView:/\/mobile\/\?group_id=(.*)/gi,onBizProcListView:/\/mobile\/bp\/\?USER_STATUS=0$/gi};var i=function(e){for(var i in o){if(e.match(o[i])){return i}}return null};var n=app.loadPageBlank;var t=app.loadPageStart;var r=app.showModalDialog;if(e.mwebrtc){var a=e.mwebrtc.callInvite;e.mwebrtc.callInvite=function(){var o="Outgoing"+(arguments[1]===true?"Video":"Audio")+"Call";a.apply(e.mwebrtc,arguments);if(o&&typeof fabric!="undefined"){fabric.Answers.sendCustomEvent(o,{})}}}var l=function(e){var o=typeof e=="object"?e.url:e;var n=i(o);if(n&&typeof fabric!="undefined"){fabric.Answers.sendCustomEvent(n,{})}};app.showModalDialog=function(e){BX.proxy(r,app)(e);l(e)};app.loadPageBlank=function(e){BX.proxy(n,app)(e);l(e)};app.loadPageStart=function(e){BX.proxy(t,app)(e);l(e)}})(window);
//# sourceMappingURL=mobile_tools.map.js