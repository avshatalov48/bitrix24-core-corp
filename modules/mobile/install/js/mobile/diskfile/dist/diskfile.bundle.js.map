{"version":3,"file":"diskfile.bundle.js","sources":["../src/imagecontroller.js","../src/files/file.js","../src/files/audio.js","../src/files/image.js","../src/filecontroller.js","../src/index.js"],"sourcesContent":["import {Type,Event,Runtime,Dom} from \"main.core\";\nimport {MobileImageViewer} from \"mobile.imageviewer\";\nimport {Ajax} from \"mobile.ajax\";\n\nexport default class ImageController\n{\n\tconstructor(params)\n\t{\n\t\tconst\n\t\t\timagesNode = (params.imagesNode && Type.isDomNode(params.imagesNode) ? params.imagesNode : null),\n\t\t\tmoreFilesNode = (params.moreFilesNode && Type.isDomNode(params.moreFilesNode) ? params.moreFilesNode : null),\n\t\t\ttoggleViewNode = (params.toggleViewNode && Type.isDomNode(params.toggleViewNode) ? params.toggleViewNode : null),\n\t\t\timagesIdList = (params.imagesIdList && Type.isArray(params.imagesIdList) ? params.imagesIdList : []);\n\n\t\tthis.signedParameters = (params.signedParameters && Type.isStringFilled(params.signedParameters) ? params.signedParameters : '');\n\n\t\tif (imagesIdList.length > 0)\n\t\t{\n\t\t\tBitrixMobile.LazyLoad.registerImages(imagesIdList, (typeof oMSL != 'undefined' ? oMSL.checkVisibility : false));\n\t\t}\n\n\t\tif (imagesNode)\n\t\t{\n\t\t\tthis.initViewer(imagesNode);\n\t\t}\n\n\t\tif (moreFilesNode)\n\t\t{\n\t\t\tEvent.bind(moreFilesNode, 'click', (e) => {\n\t\t\t\tthis.showMoreDiskFiles(e.currentTarget);\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t}\n\n\t\tif (toggleViewNode)\n\t\t{\n\t\t\tEvent.bind(toggleViewNode, 'click', (e) => {\n\t\t\t\tconst\n\t\t\t\t\tviewType = e.currentTarget.getAttribute('data-bx-view-type'),\n\t\t\t\t\tcontainer = e.currentTarget.closest('.disk-ui-file-container');\n\n\t\t\t\tif (container)\n\t\t\t\t{\n\t\t\t\t\tthis.toggleViewType({\n\t\t\t\t\t\tviewType: viewType,\n\t\t\t\t\t\tcontainer: container\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t}\n\t}\n\n\tinitViewer(node)\n\t{\n\t\tif (!Type.isDomNode(node))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tMobileImageViewer.viewImageBind(\n\t\t\tnode,\n\t\t\t'img[data-bx-image]'\n\t\t);\n\t}\n\n\tshowMoreDiskFiles(linkNode)\n\t{\n\t\tif (!Type.isDomNode(linkNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst\n\t\t\tfilesBlock = linkNode.closest('.post-item-attached-file-wrap');\n\n\t\tif (filesBlock)\n\t\t{\n\t\t\tconst\n\t\t\t\tfilesList = filesBlock.querySelectorAll('.post-item-attached-file'),\n\t\t\t\tmoreBlock = filesBlock.querySelector('.post-item-attached-file-more');\n\n\t\t\tfor (let i = 0; i < filesList.length; i++)\n\t\t\t{\n\t\t\t\tfilesList[i].classList.remove('post-item-attached-file-hidden');\n\t\t\t}\n\n\t\t\tif (moreBlock)\n\t\t\t{\n\t\t\t\tmoreBlock.parentNode.removeChild(moreBlock);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggleViewType(params)\n\t{\n\t\tconst container = (params.container && Type.isDomNode(params.container) ? params.container : null);\n\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tapp.showPopupLoader({text: ''});\n\n\t\tAjax.runComponentAction('bitrix:disk.uf.file', 'toggleViewType', {\n\t\t\tmode: 'class',\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tdata: {\n\t\t\t\tparams: {\n\t\t\t\t\tviewType: params.viewType\n\t\t\t\t}\n\t\t\t}\n\t\t}).then((response) => {\n\t\t\tapp.hidePopupLoader();\n\t\t\tDom.clean(container);\n\t\t\tRuntime.html(container, response.data.html).then(() => {\n\t\t\t\tBitrixMobile.LazyLoad.showImages();\n\t\t\t});\n\t\t}, () => {\n\t\t\tapp.hidePopupLoader();\n\t\t});\n\t}\n}","export default class File\n{\n\tstatic checkForPaternity()\n\t{\n\t\treturn true;\n\t}\n\n\tconstructor(data, container, options)\n\t{\n\t\tthis.id = data['id'];\n\t\tthis.data = data;\n\n\t\tthis.container = container;\n\t\tthis.options = options;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetNode()\n\t{\n\t\treturn this.container.querySelector(`#wdif-doc-${this.id}`);\n\t}\n}","import {Cache, Tag, Text, Type, Runtime} from 'main.core';\nimport 'ui.vue.components.audioplayer';\nimport {Vue} from 'ui.vue';\nimport File from './file';\n\nexport default class Audio extends File\n{\n\tstatic checkForPaternity(fileData)\n\t{\n\t\treturn fileData['extension'] === 'mp3';\n\t}\n\n\tconstructor(data, container, options)\n\t{\n\t\tsuper(data, container, options);\n\t\tsetTimeout(this.renderPlayer.bind(this), 10);\n\t}\n\trenderPlayer()\n\t{\n\t\tthis.getNode().classList.add('post-item-attached-audio');\n\t\tthis.getNode().innerHTML = '';\n\n\t\tVue.create({\n\t\t\tel: this.getNode().appendChild(document.createElement('DIV')),\n\t\t\ttemplate: `<bx-audioplayer src=\"${this.data.downloadUrl}\" background=\"dark\"/>`\n\t\t});\n\t}\n}","import {Cache, Tag, Text, Type, Runtime} from 'main.core';\nimport File from './file';\n\nexport default class Image extends File\n{\n\tstatic checkForPaternity(fileData)\n\t{\n\t\treturn fileData['preview'] !== undefined;\n\t}\n\n\tconstructor(fileData, container, options) {\n\t\tsuper(fileData, container, options);\n\t\tBitrixMobile.LazyLoad.registerImages([this.id], (typeof oMSL != 'undefined' ? oMSL.checkVisibility : false));\n\t}\n}","import {Type,Event,Runtime,Dom} from \"main.core\";\nimport File from \"./files/file\";\nimport Audio from \"./files/audio\";\nimport Image from \"./files/image\";\n\nconst fileTypeMappings = [\n\tFile,\n\tImage,\n\tAudio,\n];\n\nexport default class FileController\n{\n\tconstructor({files, container})\n\t{\n\t\tthis.container = container;\n\t\tif (Type.isDomNode(this.container))\n\t\t{\n\t\t\tthis.initFiles(files);\n\t\t\tthis.bindInterface();\n\t\t}\n\t}\n\n\tinitFiles(files: Array)\n\t{\n\t\tif (files && files.length > 0)\n\t\t{\n\t\t\tfiles.forEach((fileData) => {\n\t\t\t\tlet fileTypeClass = File;\n\t\t\t\tfileTypeMappings.forEach((altFileTypeClass) => {\n\t\t\t\t\tif (altFileTypeClass.checkForPaternity(fileData))\n\t\t\t\t\t{\n\t\t\t\t\t\tfileTypeClass = altFileTypeClass;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tnew fileTypeClass(fileData, this.container);\n\t\t\t});\n\t\t}\n\t}\n\n\tbindInterface()\n\t{\n\t\tconst moreBlock = this.container.querySelector('.post-item-attached-file-more');\n\t\tif (Type.isDomNode(moreBlock))\n\t\t{\n\t\t\tEvent.bindOnce(moreBlock, 'click', function(){\n\t\t\t\tthis.container\n\t\t\t\t\t.querySelectorAll('.post-item-attached-file')\n\t\t\t\t\t.forEach((node) => {\n\t\t\t\t\t\tnode.classList.remove('post-item-attached-file-hidden');\n\t\t\t\t\t});\n\n\t\t\t\tmoreBlock.parentNode.removeChild(moreBlock);\n\t\t\t}.bind(this));\n\t\t}\n\t}\n}","import {Type} from \"main.core\";\nimport ImageController from \"./imagecontroller\";\nimport FileController from \"./filecontroller\";\n\nclass DiskFile\n{\n\tconstructor(params)\n\t{\n\t\tthis.signedParameters = (Type.isStringFilled(params.signedParameters) ? params.signedParameters : '');\n\t\tif (params.images)\n\t\t{\n\t\t\tnew ImageController(\n\t\t\t\tObject.assign(\n\t\t\t\t\t{signedParameters: this.signedParameters},\n\t\t\t\t\tparams.images\n\t\t\t\t)\n\t\t\t);\n\t\t\tnew FileController(params.files);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnew ImageController(params);\n\t\t}\n\t}\n}\nexport {DiskFile};"],"names":["ImageController","params","imagesNode","Type","isDomNode","moreFilesNode","toggleViewNode","imagesIdList","isArray","signedParameters","isStringFilled","length","BitrixMobile","LazyLoad","registerImages","oMSL","checkVisibility","initViewer","Event","bind","e","showMoreDiskFiles","currentTarget","preventDefault","viewType","getAttribute","container","closest","toggleViewType","node","MobileImageViewer","viewImageBind","linkNode","filesBlock","filesList","querySelectorAll","moreBlock","querySelector","i","classList","remove","parentNode","removeChild","app","showPopupLoader","text","Ajax","runComponentAction","mode","data","then","response","hidePopupLoader","Dom","clean","Runtime","html","showImages","File","options","id","Audio","fileData","setTimeout","renderPlayer","getNode","add","innerHTML","Vue","create","el","appendChild","document","createElement","template","downloadUrl","Image","undefined","fileTypeMappings","FileController","files","initFiles","bindInterface","forEach","fileTypeClass","altFileTypeClass","checkForPaternity","bindOnce","DiskFile","images","Object","assign"],"mappings":"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"}