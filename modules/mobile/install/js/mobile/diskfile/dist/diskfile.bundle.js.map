{"version":3,"file":"diskfile.bundle.js","sources":["../src/imagecontroller.js","../src/files/file.js","../src/files/audio.js","../src/files/image.js","../src/filecontroller.js","../src/index.js"],"sourcesContent":["import {Type,Event,Runtime,Dom} from \"main.core\";\nimport {MobileImageViewer} from \"mobile.imageviewer\";\nimport {Ajax} from \"mobile.ajax\";\n\nexport default class ImageController\n{\n\tconstructor(params)\n\t{\n\t\tconst\n\t\t\timagesNode = (params.imagesNode && Type.isDomNode(params.imagesNode) ? params.imagesNode : null),\n\t\t\tmoreFilesNode = (params.moreFilesNode && Type.isDomNode(params.moreFilesNode) ? params.moreFilesNode : null),\n\t\t\ttoggleViewNode = (params.toggleViewNode && Type.isDomNode(params.toggleViewNode) ? params.toggleViewNode : null),\n\t\t\timagesIdList = (params.imagesIdList && Type.isArray(params.imagesIdList) ? params.imagesIdList : []);\n\n\t\tthis.signedParameters = (params.signedParameters && Type.isStringFilled(params.signedParameters) ? params.signedParameters : '');\n\n\t\tif (imagesIdList.length > 0)\n\t\t{\n\t\t\tBitrixMobile.LazyLoad.registerImages(imagesIdList, (typeof oMSL != 'undefined' ? oMSL.checkVisibility : false));\n\t\t}\n\n\t\tif (imagesNode)\n\t\t{\n\t\t\tthis.initViewer(imagesNode);\n\t\t}\n\n\t\tif (moreFilesNode)\n\t\t{\n\t\t\tEvent.bind(moreFilesNode, 'click', (e) => {\n\t\t\t\tthis.showMoreDiskFiles(e.currentTarget);\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t}\n\n\t\tif (toggleViewNode)\n\t\t{\n\t\t\tEvent.bind(toggleViewNode, 'click', (e) => {\n\t\t\t\tconst\n\t\t\t\t\tviewType = e.currentTarget.getAttribute('data-bx-view-type'),\n\t\t\t\t\tcontainer = e.currentTarget.closest('.disk-ui-file-container');\n\n\t\t\t\tif (container)\n\t\t\t\t{\n\t\t\t\t\tthis.toggleViewType({\n\t\t\t\t\t\tviewType: viewType,\n\t\t\t\t\t\tcontainer: container\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t}\n\t}\n\n\tinitViewer(node)\n\t{\n\t\tif (!Type.isDomNode(node))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tMobileImageViewer.viewImageBind(\n\t\t\tnode,\n\t\t\t'img[data-bx-image]'\n\t\t);\n\t}\n\n\tshowMoreDiskFiles(linkNode)\n\t{\n\t\tif (!Type.isDomNode(linkNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst\n\t\t\tfilesBlock = linkNode.closest('.post-item-attached-file-wrap');\n\n\t\tif (filesBlock)\n\t\t{\n\t\t\tconst\n\t\t\t\tfilesList = filesBlock.querySelectorAll('.post-item-attached-file'),\n\t\t\t\tmoreBlock = filesBlock.querySelector('.post-item-attached-file-more');\n\n\t\t\tfor (let i = 0; i < filesList.length; i++)\n\t\t\t{\n\t\t\t\tfilesList[i].classList.remove('post-item-attached-file-hidden');\n\t\t\t}\n\n\t\t\tif (moreBlock)\n\t\t\t{\n\t\t\t\tmoreBlock.parentNode.removeChild(moreBlock);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggleViewType(params)\n\t{\n\t\tconst container = (params.container && Type.isDomNode(params.container) ? params.container : null);\n\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tapp.showPopupLoader({text: ''});\n\n\t\tAjax.runComponentAction('bitrix:disk.uf.file', 'toggleViewType', {\n\t\t\tmode: 'class',\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tdata: {\n\t\t\t\tparams: {\n\t\t\t\t\tviewType: params.viewType\n\t\t\t\t}\n\t\t\t}\n\t\t}).then((response) => {\n\t\t\tapp.hidePopupLoader();\n\t\t\tDom.clean(container);\n\t\t\tRuntime.html(container, response.data.html).then(() => {\n\t\t\t\tBitrixMobile.LazyLoad.showImages();\n\t\t\t});\n\t\t}, () => {\n\t\t\tapp.hidePopupLoader();\n\t\t});\n\t}\n}","export default class File\n{\n\tstatic checkForPaternity()\n\t{\n\t\treturn true;\n\t}\n\n\tconstructor(data, container, options)\n\t{\n\t\tthis.id = data['id'];\n\t\tthis.data = data;\n\n\t\tthis.container = container;\n\t\tthis.options = options;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetNode()\n\t{\n\t\treturn this.container.querySelector(`#wdif-doc-${this.id}`);\n\t}\n}","import {Cache, Tag, Text, Type, Runtime} from 'main.core';\nimport 'ui.vue.components.audioplayer';\nimport {Vue} from 'ui.vue';\nimport File from './file';\n\nexport default class Audio extends File\n{\n\tstatic checkForPaternity(fileData)\n\t{\n\t\treturn fileData['extension'] === 'mp3';\n\t}\n\n\tconstructor(data, container, options)\n\t{\n\t\tsuper(data, container, options);\n\t\tsetTimeout(this.renderPlayer.bind(this), 10);\n\t}\n\trenderPlayer()\n\t{\n\t\tthis.getNode().classList.add('post-item-attached-audio');\n\t\tthis.getNode().innerHTML = '';\n\n\t\tVue.create({\n\t\t\tel: this.getNode().appendChild(document.createElement('DIV')),\n\t\t\ttemplate: `<bx-audioplayer src=\"${this.data.downloadUrl}\" background=\"dark\"/>`\n\t\t});\n\t}\n}","import {Cache, Tag, Text, Type, Runtime} from 'main.core';\nimport File from './file';\n\nexport default class Image extends File\n{\n\tstatic checkForPaternity(fileData)\n\t{\n\t\treturn fileData['preview'] !== undefined;\n\t}\n\n\tconstructor(fileData, container, options) {\n\t\tsuper(fileData, container, options);\n\t\tBitrixMobile.LazyLoad.registerImages([this.id], (typeof oMSL != 'undefined' ? oMSL.checkVisibility : false));\n\t}\n}","import {Type,Event,Runtime,Dom} from \"main.core\";\nimport File from \"./files/file\";\nimport Audio from \"./files/audio\";\nimport Image from \"./files/image\";\n\nconst fileTypeMappings = [\n\tFile,\n\tImage,\n\tAudio,\n];\n\nexport default class FileController\n{\n\tconstructor({files, container})\n\t{\n\t\tthis.container = container;\n\t\tif (Type.isDomNode(this.container))\n\t\t{\n\t\t\tthis.initFiles(files);\n\t\t\tthis.bindInterface();\n\t\t}\n\t}\n\n\tinitFiles(files: Array)\n\t{\n\t\tif (files && files.length > 0)\n\t\t{\n\t\t\tfiles.forEach((fileData) => {\n\t\t\t\tlet fileTypeClass = File;\n\t\t\t\tfileTypeMappings.forEach((altFileTypeClass) => {\n\t\t\t\t\tif (altFileTypeClass.checkForPaternity(fileData))\n\t\t\t\t\t{\n\t\t\t\t\t\tfileTypeClass = altFileTypeClass;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tnew fileTypeClass(fileData, this.container);\n\t\t\t});\n\t\t}\n\t}\n\n\tbindInterface()\n\t{\n\t\tconst moreBlock = this.container.querySelector('.post-item-attached-file-more');\n\t\tif (Type.isDomNode(moreBlock))\n\t\t{\n\t\t\tEvent.bindOnce(moreBlock, 'click', function(){\n\t\t\t\tthis.container\n\t\t\t\t\t.querySelectorAll('.post-item-attached-file')\n\t\t\t\t\t.forEach((node) => {\n\t\t\t\t\t\tnode.classList.remove('post-item-attached-file-hidden');\n\t\t\t\t\t});\n\n\t\t\t\tmoreBlock.parentNode.removeChild(moreBlock);\n\t\t\t}.bind(this));\n\t\t}\n\t}\n}","import {Type} from \"main.core\";\nimport ImageController from \"./imagecontroller\";\nimport FileController from \"./filecontroller\";\n\nclass DiskFile\n{\n\tconstructor(params)\n\t{\n\t\tthis.signedParameters = (Type.isStringFilled(params.signedParameters) ? params.signedParameters : '');\n\t\tif (params.images)\n\t\t{\n\t\t\tnew ImageController(\n\t\t\t\tObject.assign(\n\t\t\t\t\t{signedParameters: this.signedParameters},\n\t\t\t\t\tparams.images\n\t\t\t\t)\n\t\t\t);\n\t\t\tnew FileController(params.files);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnew ImageController(params);\n\t\t}\n\t}\n}\nexport {DiskFile};"],"names":["ImageController","params","imagesNode","Type","isDomNode","moreFilesNode","toggleViewNode","imagesIdList","isArray","signedParameters","isStringFilled","length","BitrixMobile","LazyLoad","registerImages","oMSL","checkVisibility","initViewer","Event","bind","e","showMoreDiskFiles","currentTarget","preventDefault","viewType","getAttribute","container","closest","toggleViewType","node","MobileImageViewer","viewImageBind","linkNode","filesBlock","filesList","querySelectorAll","moreBlock","querySelector","i","classList","remove","parentNode","removeChild","app","showPopupLoader","text","Ajax","runComponentAction","mode","data","then","response","hidePopupLoader","Dom","clean","Runtime","html","showImages","File","options","id","Audio","fileData","setTimeout","renderPlayer","getNode","add","innerHTML","Vue","create","el","appendChild","document","createElement","template","downloadUrl","Image","undefined","fileTypeMappings","FileController","files","initFiles","bindInterface","forEach","fileTypeClass","altFileTypeClass","checkForPaternity","bindOnce","DiskFile","images","Object","assign"],"mappings":";;;;;CAEiC,IAEZA,eAAe;GAEnC,yBAAYC,MAAM,EAClB;KAAA;KAAA;KACC,IACCC,UAAU,GAAID,MAAM,CAACC,UAAU,IAAIC,cAAI,CAACC,SAAS,CAACH,MAAM,CAACC,UAAU,CAAC,GAAGD,MAAM,CAACC,UAAU,GAAG,IAAK;OAChGG,aAAa,GAAIJ,MAAM,CAACI,aAAa,IAAIF,cAAI,CAACC,SAAS,CAACH,MAAM,CAACI,aAAa,CAAC,GAAGJ,MAAM,CAACI,aAAa,GAAG,IAAK;OAC5GC,cAAc,GAAIL,MAAM,CAACK,cAAc,IAAIH,cAAI,CAACC,SAAS,CAACH,MAAM,CAACK,cAAc,CAAC,GAAGL,MAAM,CAACK,cAAc,GAAG,IAAK;OAChHC,YAAY,GAAIN,MAAM,CAACM,YAAY,IAAIJ,cAAI,CAACK,OAAO,CAACP,MAAM,CAACM,YAAY,CAAC,GAAGN,MAAM,CAACM,YAAY,GAAG,EAAG;KAErG,IAAI,CAACE,gBAAgB,GAAIR,MAAM,CAACQ,gBAAgB,IAAIN,cAAI,CAACO,cAAc,CAACT,MAAM,CAACQ,gBAAgB,CAAC,GAAGR,MAAM,CAACQ,gBAAgB,GAAG,EAAG;KAEhI,IAAIF,YAAY,CAACI,MAAM,GAAG,CAAC,EAC3B;OACCC,YAAY,CAACC,QAAQ,CAACC,cAAc,CAACP,YAAY,EAAG,OAAOQ,IAAI,IAAI,WAAW,GAAGA,IAAI,CAACC,eAAe,GAAG,KAAK,CAAE;;KAGhH,IAAId,UAAU,EACd;OACC,IAAI,CAACe,UAAU,CAACf,UAAU,CAAC;;KAG5B,IAAIG,aAAa,EACjB;OACCa,eAAK,CAACC,IAAI,CAACd,aAAa,EAAE,OAAO,EAAE,UAACe,CAAC,EAAK;SACzC,KAAI,CAACC,iBAAiB,CAACD,CAAC,CAACE,aAAa,CAAC;SACvCF,CAAC,CAACG,cAAc,EAAE;QAClB,CAAC;;KAGH,IAAIjB,cAAc,EAClB;OACCY,eAAK,CAACC,IAAI,CAACb,cAAc,EAAE,OAAO,EAAE,UAACc,CAAC,EAAK;SAC1C,IACCI,QAAQ,GAAGJ,CAAC,CAACE,aAAa,CAACG,YAAY,CAAC,mBAAmB,CAAC;WAC5DC,SAAS,GAAGN,CAAC,CAACE,aAAa,CAACK,OAAO,CAAC,yBAAyB,CAAC;SAE/D,IAAID,SAAS,EACb;WACC,KAAI,CAACE,cAAc,CAAC;aACnBJ,QAAQ,EAAEA,QAAQ;aAClBE,SAAS,EAAEA;YACX,CAAC;;SAGHN,CAAC,CAACG,cAAc,EAAE;QAClB,CAAC;;;GAEH;KAAA;KAAA,2BAEUM,IAAI,EACf;OACC,IAAI,CAAC1B,cAAI,CAACC,SAAS,CAACyB,IAAI,CAAC,EACzB;SACC;;OAGDC,oCAAiB,CAACC,aAAa,CAC9BF,IAAI,EACJ,oBAAoB,CACpB;;;KACD;KAAA,kCAEiBG,QAAQ,EAC1B;OACC,IAAI,CAAC7B,cAAI,CAACC,SAAS,CAAC4B,QAAQ,CAAC,EAC7B;SACC;;OAGD,IACCC,UAAU,GAAGD,QAAQ,CAACL,OAAO,CAAC,+BAA+B,CAAC;OAE/D,IAAIM,UAAU,EACd;SACC,IACCC,SAAS,GAAGD,UAAU,CAACE,gBAAgB,CAAC,0BAA0B,CAAC;WACnEC,SAAS,GAAGH,UAAU,CAACI,aAAa,CAAC,+BAA+B,CAAC;SAEtE,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGJ,SAAS,CAACvB,MAAM,EAAE2B,CAAC,EAAE,EACzC;WACCJ,SAAS,CAACI,CAAC,CAAC,CAACC,SAAS,CAACC,MAAM,CAAC,gCAAgC,CAAC;;SAGhE,IAAIJ,SAAS,EACb;WACCA,SAAS,CAACK,UAAU,CAACC,WAAW,CAACN,SAAS,CAAC;;;;;KAG7C;KAAA,+BAEcnC,MAAM,EACrB;OACC,IAAMyB,SAAS,GAAIzB,MAAM,CAACyB,SAAS,IAAIvB,cAAI,CAACC,SAAS,CAACH,MAAM,CAACyB,SAAS,CAAC,GAAGzB,MAAM,CAACyB,SAAS,GAAG,IAAK;OAElG,IAAI,CAACA,SAAS,EACd;SACC;;OAGDiB,GAAG,CAACC,eAAe,CAAC;SAACC,IAAI,EAAE;QAAG,CAAC;OAE/BC,gBAAI,CAACC,kBAAkB,CAAC,qBAAqB,EAAE,gBAAgB,EAAE;SAChEC,IAAI,EAAE,OAAO;SACbvC,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;SACvCwC,IAAI,EAAE;WACLhD,MAAM,EAAE;aACPuB,QAAQ,EAAEvB,MAAM,CAACuB;;;QAGnB,CAAC,CAAC0B,IAAI,CAAC,UAACC,QAAQ,EAAK;SACrBR,GAAG,CAACS,eAAe,EAAE;SACrBC,aAAG,CAACC,KAAK,CAAC5B,SAAS,CAAC;SACpB6B,iBAAO,CAACC,IAAI,CAAC9B,SAAS,EAAEyB,QAAQ,CAACF,IAAI,CAACO,IAAI,CAAC,CAACN,IAAI,CAAC,YAAM;WACtDtC,YAAY,CAACC,QAAQ,CAAC4C,UAAU,EAAE;UAClC,CAAC;QACF,EAAE,YAAM;SACRd,GAAG,CAACS,eAAe,EAAE;QACrB,CAAC;;;GACF;CAAA;;KC3HmBM,IAAI;GAAA;KAAA;KAAA,oCAGxB;OACC,OAAO,IAAI;;;GAGZ,cAAYT,IAAI,EAAEvB,SAAS,EAAEiC,OAAO,EACpC;KAAA;KACC,IAAI,CAACC,EAAE,GAAGX,IAAI,CAAC,IAAI,CAAC;KACpB,IAAI,CAACA,IAAI,GAAGA,IAAI;KAEhB,IAAI,CAACvB,SAAS,GAAGA,SAAS;KAC1B,IAAI,CAACiC,OAAO,GAAGA,OAAO;;GACtB;KAAA;KAAA,wBAGD;OACC,OAAO,IAAI,CAACC,EAAE;;;KACd;KAAA,0BAGD;OACC,OAAO,IAAI,CAAClC,SAAS,CAACW,aAAa,qBAAc,IAAI,CAACuB,EAAE,EAAG;;;GAC3D;CAAA;;CCrBwB,IAELC,KAAK;GAAA;GAAA;KAAA;KAAA,kCAEAC,QAAQ,EACjC;OACC,OAAOA,QAAQ,CAAC,WAAW,CAAC,KAAK,KAAK;;;GAGvC,eAAYb,IAAI,EAAEvB,SAAS,EAAEiC,OAAO,EACpC;KAAA;KAAA;KACC,mGAAMV,IAAI,EAAEvB,SAAS,EAAEiC,OAAO;KAC9BI,UAAU,CAAC,MAAKC,YAAY,CAAC7C,IAAI,2CAAM,EAAE,EAAE,CAAC;KAAC;;GAC7C;KAAA;KAAA,+BAED;OACC,IAAI,CAAC8C,OAAO,EAAE,CAAC1B,SAAS,CAAC2B,GAAG,CAAC,0BAA0B,CAAC;OACxD,IAAI,CAACD,OAAO,EAAE,CAACE,SAAS,GAAG,EAAE;OAE7BC,UAAG,CAACC,MAAM,CAAC;SACVC,EAAE,EAAE,IAAI,CAACL,OAAO,EAAE,CAACM,WAAW,CAACC,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC,CAAC;SAC7DC,QAAQ,kCAA0B,IAAI,CAACzB,IAAI,CAAC0B,WAAW;QACvD,CAAC;;;GACF;CAAA,EArBiCjB,IAAI;;CCJb,IAELkB,KAAK;GAAA;GAAA;KAAA;KAAA,kCAEAd,QAAQ,EACjC;OACC,OAAOA,QAAQ,CAAC,SAAS,CAAC,KAAKe,SAAS;;;GAGzC,eAAYf,QAAQ,EAAEpC,SAAS,EAAEiC,OAAO,EAAE;KAAA;KAAA;KACzC,mGAAMG,QAAQ,EAAEpC,SAAS,EAAEiC,OAAO;KAClC/C,YAAY,CAACC,QAAQ,CAACC,cAAc,CAAC,CAAC,MAAK8C,EAAE,CAAC,EAAG,OAAO7C,IAAI,IAAI,WAAW,GAAGA,IAAI,CAACC,eAAe,GAAG,KAAK,CAAE;KAAC;;GAC7G;CAAA,EAViC0C,IAAI;;CCEvC,IAAMoB,gBAAgB,GAAG,CACxBpB,IAAI,EACJkB,KAAK,EACLf,KAAK,CACL;CAAC,IAEmBkB,cAAc;GAElC,8BACA;KAAA,IADaC,KAAK,QAALA,KAAK;OAAEtD,SAAS,QAATA,SAAS;KAAA;KAE5B,IAAI,CAACA,SAAS,GAAGA,SAAS;KAC1B,IAAIvB,cAAI,CAACC,SAAS,CAAC,IAAI,CAACsB,SAAS,CAAC,EAClC;OACC,IAAI,CAACuD,SAAS,CAACD,KAAK,CAAC;OACrB,IAAI,CAACE,aAAa,EAAE;;;GAErB;KAAA;KAAA,0BAESF,KAAY,EACtB;OAAA;OACC,IAAIA,KAAK,IAAIA,KAAK,CAACrE,MAAM,GAAG,CAAC,EAC7B;SACCqE,KAAK,CAACG,OAAO,CAAC,UAACrB,QAAQ,EAAK;WAC3B,IAAIsB,aAAa,GAAG1B,IAAI;WACxBoB,gBAAgB,CAACK,OAAO,CAAC,UAACE,gBAAgB,EAAK;aAC9C,IAAIA,gBAAgB,CAACC,iBAAiB,CAACxB,QAAQ,CAAC,EAChD;eACCsB,aAAa,GAAGC,gBAAgB;;YAEjC,CAAC;WACF,IAAID,aAAa,CAACtB,QAAQ,EAAE,KAAI,CAACpC,SAAS,CAAC;UAC3C,CAAC;;;;KAEH;KAAA,gCAGD;OACC,IAAMU,SAAS,GAAG,IAAI,CAACV,SAAS,CAACW,aAAa,CAAC,+BAA+B,CAAC;OAC/E,IAAIlC,cAAI,CAACC,SAAS,CAACgC,SAAS,CAAC,EAC7B;SACClB,eAAK,CAACqE,QAAQ,CAACnD,SAAS,EAAE,OAAO,EAAE,YAAU;WAC5C,IAAI,CAACV,SAAS,CACZS,gBAAgB,CAAC,0BAA0B,CAAC,CAC5CgD,OAAO,CAAC,UAACtD,IAAI,EAAK;aAClBA,IAAI,CAACU,SAAS,CAACC,MAAM,CAAC,gCAAgC,CAAC;YACvD,CAAC;WAEHJ,SAAS,CAACK,UAAU,CAACC,WAAW,CAACN,SAAS,CAAC;UAC3C,CAACjB,IAAI,CAAC,IAAI,CAAC,CAAC;;;;GAEd;CAAA;;KCnDIqE,QAAQ,GAEb,kBAAYvF,MAAM,EAClB;GAAA;GACC,IAAI,CAACQ,gBAAgB,GAAIN,cAAI,CAACO,cAAc,CAACT,MAAM,CAACQ,gBAAgB,CAAC,GAAGR,MAAM,CAACQ,gBAAgB,GAAG,EAAG;GACrG,IAAIR,MAAM,CAACwF,MAAM,EACjB;KACC,IAAIzF,eAAe,CAClB0F,MAAM,CAACC,MAAM,CACZ;OAAClF,gBAAgB,EAAE,IAAI,CAACA;MAAiB,EACzCR,MAAM,CAACwF,MAAM,CACb,CACD;KACD,IAAIV,cAAc,CAAC9E,MAAM,CAAC+E,KAAK,CAAC;IAChC,MAED;KACC,IAAIhF,eAAe,CAACC,MAAM,CAAC;;CAE7B,CAAC;;;;;;;;"}