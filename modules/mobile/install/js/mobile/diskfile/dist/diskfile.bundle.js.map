{"version":3,"file":"diskfile.bundle.js","sources":["../src/diskfile.js"],"sourcesContent":["import {Type,Event,Runtime,Dom} from \"main.core\";\nimport {MobileImageViewer} from \"mobile.imageviewer\";\nimport {Ajax} from \"mobile.ajax\";\n\nclass DiskFile\n{\n\tconstructor(params)\n\t{\n\t\tconst\n\t\t\timagesNode = (params.imagesNode && Type.isDomNode(params.imagesNode) ? params.imagesNode : null),\n\t\t\tmoreFilesNode = (params.moreFilesNode && Type.isDomNode(params.moreFilesNode) ? params.moreFilesNode : null),\n\t\t\ttoggleViewNode = (params.toggleViewNode && Type.isDomNode(params.toggleViewNode) ? params.toggleViewNode : null),\n\t\t\timagesIdList = (params.imagesIdList && Type.isArray(params.imagesIdList) ? params.imagesIdList : []);\n\n\t\tthis.signedParameters = (params.signedParameters && Type.isStringFilled(params.signedParameters) ? params.signedParameters : '');\n\n\t\tif (imagesIdList.length > 0)\n\t\t{\n\t\t\tBitrixMobile.LazyLoad.registerImages(imagesIdList, (typeof oMSL != 'undefined' ? oMSL.checkVisibility : false));\n\t\t}\n\n\t\tif (imagesNode)\n\t\t{\n\t\t\tthis.initViewer(imagesNode);\n\t\t}\n\n\t\tif (moreFilesNode)\n\t\t{\n\t\t\tEvent.bind(moreFilesNode, 'click', (e) => {\n\t\t\t\tthis.showMoreDiskFiles(e.currentTarget);\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t}\n\n\t\tif (toggleViewNode)\n\t\t{\n\t\t\tEvent.bind(toggleViewNode, 'click', (e) => {\n\t\t\t\tconst\n\t\t\t\t\tviewType = e.currentTarget.getAttribute('data-bx-view-type'),\n\t\t\t\t\tcontainer = e.currentTarget.closest('.disk-ui-file-container');\n\n\t\t\t\tif (container)\n\t\t\t\t{\n\t\t\t\t\tthis.toggleViewType({\n\t\t\t\t\t\tviewType: viewType,\n\t\t\t\t\t\tcontainer: container\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t}\n\t}\n\n\tinitViewer(node)\n\t{\n\t\tif (!Type.isDomNode(node))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tMobileImageViewer.viewImageBind(\n\t\t\tnode,\n\t\t\t'img[data-bx-image]'\n\t\t);\n\t}\n\n\tshowMoreDiskFiles(linkNode)\n\t{\n\t\tif (!Type.isDomNode(linkNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst\n\t\t\tfilesBlock = linkNode.closest('.post-item-attached-file-wrap');\n\n\t\tif (filesBlock)\n\t\t{\n\t\t\tconst\n\t\t\t\tfilesList = filesBlock.querySelectorAll('.post-item-attached-file'),\n\t\t\t\tmoreBlock = filesBlock.querySelector('.post-item-attached-file-more');\n\n\t\t\tfor (let i = 0; i < filesList.length; i++)\n\t\t\t{\n\t\t\t\tfilesList[i].classList.remove('post-item-attached-file-hidden');\n\t\t\t}\n\n\t\t\tif (moreBlock)\n\t\t\t{\n\t\t\t\tmoreBlock.parentNode.removeChild(moreBlock);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggleViewType(params)\n\t{\n\t\tconst container = (params.container && Type.isDomNode(params.container) ? params.container : null);\n\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tapp.showPopupLoader({text: ''});\n\n\t\tAjax.runComponentAction('bitrix:disk.uf.file', 'toggleViewType', {\n\t\t\tmode: 'class',\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tdata: {\n\t\t\t\tparams: {\n\t\t\t\t\tviewType: params.viewType\n\t\t\t\t}\n\t\t\t}\n\t\t}).then((response) => {\n\t\t\tapp.hidePopupLoader();\n\t\t\tDom.clean(container);\n\t\t\tRuntime.html(container, response.data.html).then(() => {\n\t\t\t\tBitrixMobile.LazyLoad.showImages();\n\t\t\t});\n\t\t}, () => {\n\t\t\tapp.hidePopupLoader();\n\t\t});\n\t}\n}\n\nexport {DiskFile};"],"names":["DiskFile","params","imagesNode","Type","isDomNode","moreFilesNode","toggleViewNode","imagesIdList","isArray","signedParameters","isStringFilled","length","BitrixMobile","LazyLoad","registerImages","oMSL","checkVisibility","initViewer","Event","bind","e","showMoreDiskFiles","currentTarget","preventDefault","viewType","getAttribute","container","closest","toggleViewType","node","MobileImageViewer","viewImageBind","linkNode","filesBlock","filesList","querySelectorAll","moreBlock","querySelector","i","classList","remove","parentNode","removeChild","app","showPopupLoader","text","Ajax","runComponentAction","mode","data","then","response","hidePopupLoader","Dom","clean","Runtime","html","showImages"],"mappings":"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"}