this.BX=this.BX||{};(function(t,e){"use strict";var i=function(){function t(){babelHelpers.classCallCheck(this,t);this.type=null;this.method=null;this.url=null;this.callback=function(){};this.failure_callback=function(){};this.progress_callback=null;this.loadstart_callback=null;this.loadend_callback=null;this.offline=null;this.processData=null;this.xhr=null;this.data=null;this.headers=null;this.aborted=null;this.formData=null}babelHelpers.createClass(t,[{key:"instanceWrap",value:function t(i){var a=this;this.init(i);this.xhr=e.ajax({timeout:30,start:this.start,preparePost:this.preparePost,method:this.method,dataType:this.type,url:this.url,data:this.data,headers:this.headers,processData:this.processData,onsuccess:function t(i){var s=false;if(a.xhr.status===0){a.failure_callback();return}else if(a.type=="json"){s=e.Type.isPlainObject(i)&&!e.Type.isNull(i)&&e.Type.isStringFilled(i.status)&&i.status==="failed"}else if(a.type=="html"){s=i=='{"status":"failed"}'}if(s){if(!a.aborted){a.repeatRequest()}}else{a.callback(i)}},onfailure:function t(i,s){if(e.Type.isStringFilled(i)&&i==="status"&&typeof s!=="undefined"&&s==401){a.repeatRequest()}else{a.failure_callback()}}});this.bindHandlers();e.Event.bind(this.xhr,"abort",function(){a.aborted=true});return this.xhr}},{key:"init",value:function t(i){if(!e.Type.isPlainObject(i)){i={}}this.type=i.type!=="json"?"html":"json";this.method=i.method!=="POST"?"GET":"POST";this.url=i.url;this.data=i.data;this.headers=typeof i.headers!=="undefined"?i.headers:[];this.processData=e.Type.isBoolean(i.processData)?i.processData:true;this.start=i.start;this.preparePost=i.preparePost;this.callback=i.callback;if(e.Type.isFunction(i.callback_failure)){this.failure_callback=i.callback_failure}if(e.Type.isFunction(i.callback_progress)){this.progress_callback=i.callback_progress}if(e.Type.isFunction(i.callback_loadstart)){this.loadstart_callback=i.callback_loadstart}if(e.Type.isFunction(i.callback_loadend)){this.loadend_callback=i.callback_loadend}if(typeof i.formData!=="undefined"){this.formData=i.formData}}},{key:"instanceRunComponentAction",value:function t(i,a,s,n){var l=this;if(!e.Type.isPlainObject(n)){n={}}return new Promise(function(t,c){s.onrequeststart=function(t){l.xhr=t};e.ajax.runComponentAction(i,a,s).then(function(i){if(e.Type.isFunction(n.success)){n.success(i)}t(i)},function(t){if(l.xhr.status==401){l.repeatComponentAction(i,a,s,n)}else{if(e.Type.isFunction(n.failure)){n.failure(t)}c(t)}});l.bindHandlers()})}},{key:"repeatComponentAction",value:function t(i,a,s,n){if(!e.Type.isPlainObject(n)){n={}}return new Promise(function(t,l){app.BasicAuth({success:function c(r){e.ajax.runComponentAction(i,a,s).then(function(i){if(e.Type.isFunction(n.success)){n.success(i)}t(i)},function(t){if(e.Type.isFunction(n.failure)){n.failure(t)}l(t)})},failture:function t(){if(e.Type.isFunction(n.failure)){n.failure()}l()}})})}},{key:"instanceRunAction",value:function t(i,a,s){var n=this;if(!e.Type.isPlainObject(s)){s={}}return new Promise(function(t,l){a.onrequeststart=function(t){n.xhr=t};e.ajax.runAction(i,a).then(function(i){if(e.Type.isFunction(s.success)){s.success(i)}t(i)},function(t){if(n.xhr.status==401){return n.repeatAction(i,a,s)}else{if(e.Type.isFunction(s.failure)){s.failure(t)}l(t)}});n.bindHandlers()})}},{key:"repeatAction",value:function t(i,a,s){if(!e.Type.isPlainObject(s)){s={}}return new Promise(function(t,n){app.BasicAuth({success:function l(c){e.ajax.runAction(i,a).then(function(i){if(e.Type.isFunction(s.success)){s.success(i)}t(i)},function(t){if(e.Type.isFunction(s.failure)){s.failure(t)}n(t)})},failture:function t(){if(e.Type.isFunction(s.failure)){s.failure()}n()}})})}},{key:"repeatRequest",value:function t(){var i=this;app.BasicAuth({success:function t(a){i.data.sessid=a.sessid_md5;if(i.formData!==null&&i.formData.get("sessid")!==null){i.formData.set("sessid",a.sessid_md5)}i.xhr=e.ajax({timeout:30,preparePost:i.preparePost,start:i.start,method:i.method,dataType:i.type,url:i.url,data:i.data,onsuccess:function t(a){var s=false;if(i.xhr.status===0){s=true}else if(i.type==="json"){s=e.Type.isPlainObject(a)&&e.Type.isStringFilled(a.status)&&a.status==="failed"}else if(i.type==="html"){s=a=='{"status":"failed"}'}if(s){i.failure_callback()}else{i.callback(a)}},onfailure:function t(e){i.failure_callback()}});if(!i.start&&i.formData!==null){i.xhr.send(i.formData)}},failture:function t(){i.failure_callback()}})}},{key:"bindHandlers",value:function t(){if(e.Type.isFunction(this.progress_callback)){e.Event.bind(this.xhr,"progress",this.progress_callback)}if(e.Type.isFunction(this.load_callback)){e.Event.bind(this.xhr,"load",this.load_callback)}if(e.Type.isFunction(this.loadstart_callback)){e.Event.bind(this.xhr,"loadstart",this.loadstart_callback)}if(e.Type.isFunction(this.loadend_callback)){e.Event.bind(this.xhr,"loadend",this.loadend_callback)}if(e.Type.isFunction(this.error_callback)){e.Event.bind(this.xhr,"error",this.error_callback)}if(e.Type.isFunction(this.abort_callback)){e.Event.bind(this.xhr,"abort",this.abort_callback)}}}],[{key:"wrap",value:function e(i){var a=new t;return a.instanceWrap(i)}},{key:"runComponentAction",value:function e(i,a,s,n){var l=new t;return l.instanceRunComponentAction(i,a,s,n)}},{key:"runAction",value:function e(i,a,s){var n=new t;return n.instanceRunAction(i,a,s)}}]);return t}();t.Ajax=i})(this.BX.Mobile=this.BX.Mobile||{},BX);
//# sourceMappingURL=ajax.bundle.map.js