(function(e){e.ViewEventManager=function(e){this.id=e.id;this.config=e;this.userId=BX.message("USER_ID");BX.ready(BX.proxy(this.Init,this))};e.ViewEventManager.prototype={Init:function(){this.pFrom=BX("feed-event-view-from-"+this.id);var e=this.config.EVENT;if(e.DATE_FROM&&e.DATE_TO){e.dateFrom=BX.parseDate(e.DATE_FROM);e.dateTo=BX.parseDate(e.DATE_TO);e.DT_FROM_TS=e.dateFrom.getTime();e.DT_TO_TS=e.dateTo.getTime();if(e.DT_SKIP_TIME!=="Y"){e.DT_FROM_TS-=e["~USER_OFFSET_FROM"]*1e3;e.DT_TO_TS-=e["~USER_OFFSET_TO"]*1e3}this.pFrom.innerHTML=this.GetFromHtml(e.DT_FROM_TS,e.DT_SKIP_TIME)}else{this.pFrom.innerHTML=this.GetFromHtml(this.config.EVENT.DT_FROM_TS,this.config.EVENT.DT_SKIP_TIME)}var t=null;if(this.config.EVENT.IS_MEETING&&BX.type.isPlainObject(this.config.attendees[this.userId])){t=this.config.attendees[this.userId].STATUS}this.ShowUserStatus(t)},ShowUserStatus:function(e){var t=BX("feed-event-invite-controls-"+this.id);if(e){t.className="calendar-invite-cont"+" calendar-invite-cont-"+e.toLowerCase();if(e=="Q"){BX("feed-event-accept-"+this.id).onclick=BX.proxy(this.Accept,this);BX("feed-event-decline-"+this.id).onclick=BX.proxy(this.Decline,this)}}else{t.style.display="none"}},ShowAttendeesRow:function(e){this.pAttendeesCont=BX("feed-event-attendees-cont-"+this.id);this.pAttendeesWrap=BX("feed-event-attendees-wrap-"+this.id);var t,i="",n=parseInt(e.ACCEPTED_ATTENDEES_COUNT,10),s=parseInt(e.DECLINED_ATTENDEES_COUNT,10);this.pAttendeesCont.style.display=n>0||s>0?"block":"none";if(n>0){t=this.config.ECLFV_INVITE_ATTENDEES_ACC.replace("#ATTENDEES_NUM#",e.ACCEPTED_ATTENDEES_MESSAGE);i+='<span class="calendar-event-text">'+t+"</span>";if(s>0)i+=", "}if(s>0){t=this.config.ECLFV_INVITE_ATTENDEES_DEC.replace("#ATTENDEES_NUM#",e.DECLINED_ATTENDEES_MESSAGE);i+='<span class="calendar-event-text">'+t+"</span>";if(s>0)i+=", "}this.pAttendeesWrap.innerHTML=i},SetStatus:function(t){var i=this;BX.ajax.get(this.config.actionUrl,{mobile_action:"calendar_livefeed_view",event_feed_action:t,sessid:BX.bitrix_sessid(),event_id:this.config.eventId,ajax_params:this.config.AJAX_PARAMS},function(n){setTimeout(function(){if(n.indexOf("#EVENT_FEED_RESULT_OK#")!==-1&&i.config.EVENT.IS_MEETING){i.ShowUserStatus(t=="accept"?"Y":"N");if(e.ViewEventManager.requestResult)i.ShowAttendeesRow(e.ViewEventManager.requestResult)}},150)})},Accept:function(e){this.SetStatus("accept");return BX.PreventDefault(e)},Decline:function(e){this.SetStatus("decline");return BX.PreventDefault(e)},GetFromHtml:function(e,t){var i=new Date(e),n=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE")),s=BX.message("FORMAT_DATETIME"),a=BX.util.trim(s.replace(BX.message("FORMAT_DATE"),"")),o;if(a==n)s="HH:MI";else s=a.replace(/:SS/gi,"");s=BX.date.convertBitrixFormat(s);if(t=="Y"){o=BX.date.format([["today","today"],["tommorow","tommorow"],["yesterday","yesterday"],["",n]],i)}else{o=BX.date.format([["today","today"],["tommorow","tommorow"],["yesterday","yesterday"],["",n]],i);o+=", "+BX.date.format(s,i)}return o}}})(window);
//# sourceMappingURL=script.map.js