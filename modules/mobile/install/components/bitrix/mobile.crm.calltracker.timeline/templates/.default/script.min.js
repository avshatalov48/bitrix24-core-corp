this.BX=this.BX||{};this.BX.Mobile=this.BX.Mobile||{};this.BX.Mobile.Crm=this.BX.Mobile.Crm||{};(function(t,e,n,i,a,r,s,o){"use strict";var l=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"set",value:function e(n){var i=n.componentName,a=n.signedParameters,r=n.currentAuthor;t.componentName=i;t.signedParameters=a;t.currentAuthor=r}}]);return t}();babelHelpers.defineProperty(l,"componentName","bitrix:mobile.crm.calltracker.timeline");babelHelpers.defineProperty(l,"signedParameters","");babelHelpers.defineProperty(l,"currentAuthor",{AUTHOR_ID:0,AUTHOR:{FORMATTED_NAME:"Guest",SHOW_URL:"",IMAGE_URL:""}});var c=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"request",value:function t(e){var n=e.action,i=e.data;return r.ajax.runComponentAction(l.componentName,n,{mode:"class",data:i,signedParameters:l.signedParameters})}},{key:"getItem",value:function e(n,i){return t.request({action:"getItem",data:{id:n,options:i}})}},{key:"createItem",value:function e(n){var i=n.text,a=n.files;return t.request({action:"createItem",data:{text:i,files:a}})}},{key:"getItemsFromPage",value:function t(e,n){return new Promise((function(t,i){r.ajax.runComponentAction(l.componentName,"getItems",{mode:"class",data:{itemId:e},navigation:{page:n},signedParameters:l.signedParameters}).then(t,i)}))}}]);return t}();var d,u;var m=function(){function t(e,n){babelHelpers.classCallCheck(this,t);this.itemId=e;this.callback=n;this.pointer=1;this.busy=false;this.cache=new r.Cache.MemoryCache}babelHelpers.createClass(t,[{key:"getNode",value:function t(){var e=this;return this.cache.remember("mainNode",(function(){return r.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['<div class="crm-phonetracker-detail-comments-btn-container" onclick="','">\n\t\t\t\t<div class="crm-phonetracker-detail-comments-btn">',"</div>\n\t\t\t</div>"])),e.sendPagination.bind(e),r.Loc.getMessage("MPT_PREVIOUS_COMMENTS"))}))}},{key:"getLoader",value:function t(){if(!this.cache.has("PaginationLoader")){var n=this.getNode().appendChild(r.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['<div class="loader"></div>']))));this.cache.set("PaginationLoader",new e.Loader({target:n,size:20}))}return this.cache.get("PaginationLoader")}},{key:"sendPagination",value:function t(){var e=this,n=arguments;if(this.busy===true){return false}this.getLoader().show();this.busy=true;c.getItemsFromPage(this.itemId,++this.pointer).then((function(t){var n=t.data,i=n.items,a=n.paginationHasMore,r=t.errors;e.getLoader().hide();e.callback.call(e,i);if(a!==true){e.destroy()}if(r.length>0){e.showErrors(r)}}),(function(){e.showErrors(n)}))["finally"]((function(){e.busy=false}))}},{key:"destroy",value:function t(){var e=this;if(this.getNode().parentNode){this.getNode().parentNode.removeChild(this.getNode())}this.getNode().style.display="none";this.cache.keys().forEach((function(t){e.cache["delete"](t)}))}},{key:"showErrors",value:function t(e){console.log("Pagination errors: ",e)}}]);return t}();var v,p,h,b,f,g,C;var T;function I(t,e){if(!T){T=new IntersectionObserver((function(t){t.forEach((function(t){if(t.isIntersecting){T.unobserve(t.target);var e=t.target.observedCallback;delete t.target.observedCallback;setTimeout(e)}}))}),{threshold:0})}t.observedCallback=e;T.observe(t)}var E=function(){babelHelpers.createClass(t,null,[{key:"checkForPaternity",value:function t(){return true}}]);function t(e){babelHelpers.classCallCheck(this,t);this.id=e["ID"];this.data=e;this.cache=new r.Cache.MemoryCache;t.renderWithDebounce()}babelHelpers.createClass(t,[{key:"getId",value:function t(){return this.id}},{key:"getOwnerId",value:function t(){return["OWN",this.getId()].join("_")}},{key:"getNode",value:function t(){var e=this;return this.cache.remember("mainNode",(function(){var t=r.Text.encode(e.data["AUTHOR"]&&e.data["AUTHOR"]["IMAGE_URL"]?e.data["AUTHOR"]["IMAGE_URL"]:"");var n=function t(){var n=e.getNode().querySelector('div[data-bx-role="more-button"]');n.parentNode.removeChild(n);var i=e.getTextNode().parentNode;var a=r.pos(i).height;var s=r.pos(e.getTextNode()).height;i.style.maxHeight=a+"px";i.style.overflow="hidden";var o=(s-a)/(2e3-a);o=o<.3?.3:o>.8?.8:o;new BX["easing"]({duration:o*1e3,start:{height:a},finish:{height:s},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function t(e){i.style.maxHeight=e.height+"px"},complete:function t(){i.style.cssText="";i.style.maxHeight="none";BX.LazyLoad.showImages(true)}}).animate()};var i=r.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['<div class="feed-com-block-cover">\n\t\t\t\t<div class="post-comment-block post-comment-block-old post-comment-block-approved mobile-longtap-menu">\n\t\t\t\t\t<div class="ui-icon ui-icon-common-user post-comment-block-avatar">\n\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="post-comment-detail">\n\t\t\t\t\t\t<div class="post-comment-balloon">\n\t\t\t\t\t\t\t<div class="post-comment-cont">\n\t\t\t\t\t\t\t\t<a href="" class="post-comment-author">','</a>\n\t\t\t\t\t\t\t\t<div class="post-comment-time">','</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="post-comment-wrap-outer">\n\t\t\t\t\t\t\t\t<div class="post-comment-wrap">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="post-comment-more" data-bx-role="more-button" onclick="','">\n\t\t\t\t\t\t\t\t\t<div class="post-comment-more-but"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>"])),t?r.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(["<i style=\"background-image:url('","')\"></i>"])),t):r.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(["<i></i>"]))),r.Text.encode(e.data["AUTHOR"]["FORMATTED_NAME"]),e.getDateNode(),e.getTextNode(),n,e.getFilesNode(),e.getActionNode());return i}))}},{key:"getTextNode",value:function t(){var e=this;return this.cache.remember("textNode",(function(){var t=r.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['<div class="post-comment-text"></div>'])));r.Runtime.html(t,e.data["COMMENT"]);return t}))}},{key:"getDateNode",value:function t(){var e=this;return this.cache.remember("dateNode",(function(){if(r.Type.isStringFilled(e.data["CREATED"])){return e.data["CREATED"]}return BX.formatDate()}))}},{key:"getFilesNode",value:function t(){var e=this;return this.cache.remember("filesBlock",(function(){if(e.data["HAS_FILES"]!=="Y"){return""}var t=r.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="post-item-attached-file-wrap">\n\t\t\t<div class="post-item-attached-file-list">\n\t\t\t</div>\n\t\t</div>'])));if(r.Type.isStringFilled(e.data["PARSED_ATTACHMENT"])){r.Runtime.html(t,e.data["PARSED_ATTACHMENT"])}else{setTimeout((function(){I(t,(function(){var n=["GET_FILE_BLOCK"];e.data["HAS_INLINE_ATTACHMENT"]==="Y"?n.push("GET_COMMENT"):null;c.getItem(e.id,n).then((function(n){var i=n.data,a=i.files,s=i.text,o=n.errors;if(r.Type.isStringFilled(a)){r.Runtime.html(t,a)}if(r.Type.isStringFilled(s)){r.Runtime.html(e.getTextNode(),s)}}),(function(t){var e=t.errors;var n=[];e.forEach((function(t){n.push(t.message)}))}))}))}),100)}return r.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['<div class="post-item-attached-file-wrap">',"</div>"])),t)}))}},{key:"getActionNode",value:function t(){return this.cache.remember("actionNode",(function(){return"";return r.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="post-comment-control-box">\n\t\t\t\t\t<div class="post-comment-control-item">Edit</div>\n\t\t\t\t\t<div class="post-comment-control-item">Delete</div>\n\t\t\t\t</div>'])))}))}}]);return t}();babelHelpers.defineProperty(E,"renderWithDebounce",r.Runtime.debounce((function(){BitrixMobile.LazyLoad.showImages()}),500));var y=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,null,[{key:"checkForPaternity",value:function t(e){return e["TYPE_CODE"]==="COMMENT"}}]);return e}(E);var k=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"formatInterval",value:function t(e){var n={DAY:Math.floor(e/86400),HOUR:Math.floor(e%86400/3600),MINUTE:Math.floor(e%86400%3600/60),SECOND:e%86400%3600%60};var i=[];for(var a in n){if(n[a]>0){i.push([n[a],r.Loc.getMessage(["INTERVAL",a,n[a]===1?"SINGLE":"PLURAL"].join("_"))].join(" "))}}if(i.length<=0){i.push(["0",r.Loc.getMessage(["INTERVAL_SECOND_SINGLE"].join("_"))].join(" "))}return i.join(" ")}}]);return t}();var A,L,H,N;var w=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getOwnerId",value:function t(){return[this.data["ASSOCIATED_ENTITY"]["TYPE_ID"],this.data["ASSOCIATED_ENTITY"]["ID"]].join("_")}},{key:"getNode",value:function t(){var e=this;return this.cache.remember("mainNode",(function(){var t=parseInt(e.data["ASSOCIATED_ENTITY"]["DIRECTION"]);var n=parseInt(e.data["ASSOCIATED_ENTITY"]["SETTINGS"]["DURATION"]);var i=n>0;var a=k.formatInterval(n);var s=r.Text.encode(e.data["CREATED"]);var o=r.Loc.getMessage("MPL_CALL_IS_PROCESSED");var l=e.data["ASSOCIATED_ENTITY"]["CALL_INFO"]?e.data["ASSOCIATED_ENTITY"]["CALL_INFO"]["HAS_STATUS"]:false;var c=e.data["ASSOCIATED_ENTITY"]["CALL_INFO"]?e.data["ASSOCIATED_ENTITY"]["CALL_INFO"]["SUCCESSFUL"]:null;var d=[t===BX.CrmActivityDirection.incoming?"ui-icon-service-call-in":t===BX.CrmActivityDirection.outgoing?"ui-icon-service-call-out":"ui-icon-service-callback"];var u=r.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="feed-com-block-cover crm-phonetracker-notification">\n\t\t\t\t<div class="post-comment-block post-comment-block-old post-comment-block-approved  mobile-longtap-menu ">\n\t\t\t\t\t<div class="ui-icon ',' crm-phonetracker-icon">\n\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="post-comment-detail">\n\t\t\t\t\t\t<div class="post-comment-balloon">\n\t\t\t\t\t\t\t<div class="post-comment-cont">\n\t\t\t\t\t\t\t\t<span class="post-comment-author crm-phonetracker-event-name">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<div class="post-comment-time">','</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="post-comment-wrap-outer">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t<div class="post-label-wrap">\n\t\t\t\t\t\t\t\t\t<svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M12.5615 10.4593L14.0291 11.559C14.4726 11.8959 14.507 12.5616 14.0978 12.9414C12.5634 14.4077 10.0067 14.977 6.64094 11.4185C3.27513 7.86011 3.94451 5.31279 5.47892 3.8464C5.88763 3.46681 6.53873 3.52962 6.8498 3.99195L7.87625 5.49314C8.23575 6.04419 8.00868 6.79498 7.45713 7.16309L6.84098 7.57434C6.6994 7.66453 6.65996 7.85351 6.73593 7.99833C7.53276 9.39692 8.68397 10.6226 10.0304 11.5009C10.1646 11.5784 10.3575 11.5383 10.4511 11.4106L10.8862 10.7938C11.2666 10.2563 12.0403 10.0677 12.5615 10.4593Z" fill="white"/>\n\t\t\t\t\t\t\t\t\t\t<path d="M13.8358 4.26291C12.8706 3.2977 11.577 2.7646 10.1993 2.77788C9.9525 2.79346 9.7557 2.99026 9.75345 3.22376C9.76427 3.47033 9.95731 3.66337 10.1908 3.66111C11.3472 3.63671 12.4084 4.0686 13.2193 4.8795C14.0303 5.69041 14.4621 6.75159 14.4372 7.90855C14.436 8.0385 14.4867 8.14155 14.5641 8.21887C14.6415 8.29628 14.7579 8.33373 14.875 8.34529C15.1218 8.32972 15.3186 8.13292 15.3209 7.89942C15.3348 6.52238 14.801 5.22812 13.8358 4.26291Z" fill="white"/>\n\t\t\t\t\t\t\t\t\t\t<path d="M12.5749 5.52404C12.0088 4.95793 11.258 4.65303 10.4524 4.66131C10.2056 4.67688 10.0088 4.87368 10.0065 5.10718C10.0174 5.35375 10.2104 5.54679 10.4439 5.54453C11.0155 5.53902 11.5458 5.7547 11.945 6.15386C12.3436 6.5525 12.5598 7.08336 12.5543 7.65492C12.553 7.78487 12.6038 7.88792 12.6812 7.96534L12.7231 8.00097C12.7976 8.05494 12.8946 8.08326 12.9923 8.0929C13.2391 8.07732 13.4359 7.88052 13.4381 7.64702C13.4459 6.84088 13.141 6.09014 12.5749 5.52404Z" fill="white"/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t<div class="post-label-text">',"</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t"])),d.join(" "),l&&c!==true?'<div class="ui-icon-cross">\n\t\t\t\t\t\t\t\t<svg width="11" height="11" viewBox="0 0 11 11" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M7.19252 5.532L10.7451 9.08457L9.08463 10.745L5.53206 7.19246L1.91046 10.8141L0.25 9.15361L3.87161 5.532L0.319037 1.97943L1.97949 0.318976L5.53206 3.87155L9.15367 0.249939L10.8141 1.91039L7.19252 5.532Z" fill="#767C87"/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>':"",o,s,i?r.Tag.render(L||(L=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t\t\t\t<div class="post-comment-wrap">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="post-comment-text">',"</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>"])),a):"",r.Text.encode(e.data["ASSOCIATED_ENTITY"]["CREATED"]),e.getFilesNode(),e.getActionNode());return u}))}},{key:"getFilesNode",value:function t(){var e=this;return this.cache.remember("filesBlock",(function(){if(!e.data["ASSOCIATED_ENTITY"]["MEDIA_FILE_INFO"]){return""}var t=r.Tag.render(H||(H=babelHelpers.taggedTemplateLiteral(['<div class="post-item-attached-audio"></div>'])));a.Vue.create({el:t.appendChild(document.createElement("DIV")),template:'<bx-audioplayer src="'.concat(e.data["ASSOCIATED_ENTITY"]["MEDIA_FILE_INFO"]["URL"],'" background="dark"/>')});return r.Tag.render(N||(N=babelHelpers.taggedTemplateLiteral(['<div class="post-item-attached-file-wrap">\n\t\t\t\t<div class="post-item-attached-file-wrap">\n\t\t\t\t\t<div class="post-item-attached-file-list">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>"])),t)}))}}],[{key:"checkForPaternity",value:function t(e){return e["TYPE_CODE"]==="CALL_TRACKER"&&!!e["ASSOCIATED_ENTITY"]}}]);return e}(E);var S,O,_;var x=function(t){babelHelpers.inherits(e,t);babelHelpers.createClass(e,null,[{key:"checkForPaternity",value:function t(e){return e.constructor.name==="Comment"}}]);function e(t){var n;babelHelpers.classCallCheck(this,e);var i={ID:"preview_node_"+e.count++,COMMENT:r.Text.encode(t.text),AUTHOR_ID:l.currentAuthor.AUTHOR_ID,AUTHOR:l.currentAuthor.AUTHOR,CREATED:(new Date).getTime()/1e3};n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,i));t.previewObj=babelHelpers.assertThisInitialized(n);return n}babelHelpers.createClass(e,[{key:"getNode",value:function t(){var e=this;return this.cache.remember("mainNode",(function(){var t=r.Text.encode(e.data["AUTHOR"]&&e.data["AUTHOR"]["IMAGE_URL"]?e.data["AUTHOR"]["IMAGE_URL"]:"");var n=r.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['<div class="feed-com-block-cover">\n\t\t\t\t<div class="post-comment-block post-comment-block-old post-comment-block-approved mobile-longtap-menu">\n\t\t\t\t\t<div class="ui-icon ui-icon-common-user post-comment-block-avatar">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="post-comment-detail">\n\t\t\t\t\t\t<div class="post-comment-balloon">\n\t\t\t\t\t\t\t<div class="post-comment-cont">\n\t\t\t\t\t\t\t\t<a href="" class="post-comment-author">','</a>\n\t\t\t\t\t\t\t\t<div class="post-comment-time">','</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="post-comment-wrap-outer">\n\t\t\t\t\t\t\t\t<div class="post-comment-wrap">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="post-comment-more" style="display: none;">\n\t\t\t\t\t\t\t\t\t<div class="post-comment-more-but"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="post-comment-control-box" data-bx-role="loader-block">\n\t\t\t\t\t\t\t<div class="post-comment-control-item">','</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="post-comment-control-box" data-bx-role="error-block">\n\t\t\t\t\t\t\t<div class="post-comment-control-item" data-bx-role="error-text"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>'])),t?r.Tag.render(O||(O=babelHelpers.taggedTemplateLiteral(["<i style=\"background-image:url('","')\"></i>"])),t):r.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(["<i></i>"]))),r.Text.encode(e.data["AUTHOR"]["FORMATTED_NAME"]),e.getDateNode(),e.getTextNode(),r.Loc.getMessage("MPL_MOBILE_PUBLISHING"));return n}))}},{key:"getDateNode",value:function t(){return""}},{key:"setError",value:function t(e){this.getNode().setAttribute("data-bx-status","failed");var n=this.getNode().querySelector('[data-bx-role="error-text"]');n.innerHTML=e.message}}]);return e}(E);babelHelpers.defineProperty(x,"count",0);var M,D;var P=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.id=n.data["ASSOCIATED_ENTITY"]["ID"];console.log("this.data: ",n.data);return n}babelHelpers.createClass(e,[{key:"getOwnerId",value:function t(){return[this.data["ASSOCIATED_ENTITY"]["TYPE_ID"],this.getId()].join("_")}},{key:"getNode",value:function t(){var e=this;return this.cache.remember("mainNode",(function(){var t=parseInt(e.data["ASSOCIATED_ENTITY"]["DIRECTION"]);var n=parseInt(e.data["ASSOCIATED_ENTITY"]["SETTINGS"]["DURATION"]);var i=n>0;var a=k.formatInterval(n);var s=r.Text.encode(e.data["ASSOCIATED_ENTITY"]["DEADLINE"]);var o=t===BX.CrmActivityDirection.incoming?r.Loc.getMessage("MPL_MOBILE_INCOMING_CALL"):t===BX.CrmActivityDirection.outgoing?r.Loc.getMessage("MPL_MOBILE_OUTBOUND_CALL"):r.Loc.getMessage("MPL_MOBILE_CALL");var l=e.data["ASSOCIATED_ENTITY"]["CALL_INFO"]?e.data["ASSOCIATED_ENTITY"]["CALL_INFO"]["HAS_STATUS"]:false;var c=e.data["ASSOCIATED_ENTITY"]["CALL_INFO"]?e.data["ASSOCIATED_ENTITY"]["CALL_INFO"]["SUCCESSFUL"]:null;var d=[t===BX.CrmActivityDirection.incoming?"ui-icon-service-call-in":t===BX.CrmActivityDirection.outgoing?"ui-icon-service-call-out":"ui-icon-service-callback"];var u=r.Tag.render(M||(M=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="feed-com-block-cover crm-calltracker-notification">\n\t\t\t\t<div class="post-comment-block post-comment-block-old post-comment-block-approved  mobile-longtap-menu ">\n\t\t\t\t\t<div class="ui-icon ',' crm-phonetracker-icon">\n\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="ui-icon-counter">1</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="post-comment-detail">\n\t\t\t\t\t\t<div class="post-comment-balloon">\n\t\t\t\t\t\t\t<div class="post-comment-cont">\n\t\t\t\t\t\t\t\t<span class="post-comment-author    crm-phonetracker-event-name">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<div class="post-comment-time">','</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="post-comment-wrap-outer">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t<div class="post-label-wrap">\n\t\t\t\t\t\t\t\t\t<svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t\t\t\t<path d="M8.26297 5.9911H9.76297V8.2411H12.013V9.7411H8.26297V5.9911Z" fill="white"/>\n\t\t\t\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M3.5682 11.4511C4.56845 13.6754 6.81991 15.0688 9.25682 14.9716C12.4898 14.9055 15.0579 12.2327 14.995 8.99971C14.9949 6.56087 13.5128 4.36679 11.2504 3.45607C8.98799 2.54536 6.39916 3.10075 4.70939 4.85933C3.01962 6.61792 2.56795 9.22685 3.5682 11.4511ZM4.95948 10.8255C5.70444 12.4821 7.38125 13.5198 9.19618 13.4475C11.604 13.3982 13.5167 11.4076 13.4698 8.99978C13.4697 7.18341 12.3659 5.54933 10.6809 4.87106C8.99597 4.19279 7.06789 4.60642 5.8094 5.91616C4.55092 7.2259 4.21453 9.16894 4.95948 10.8255Z" fill="white"/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t<div class="post-label-text">',"</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t"])),d.join(" "),l&&c!==true?'<div class="ui-icon-cross">\n\t\t\t\t\t\t\t\t<svg width="11" height="11" viewBox="0 0 11 11" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M7.19252 5.532L10.7451 9.08457L9.08463 10.745L5.53206 7.19246L1.91046 10.8141L0.25 9.15361L3.87161 5.532L0.319037 1.97943L1.97949 0.318976L5.53206 3.87155L9.15367 0.249939L10.8141 1.91039L7.19252 5.532Z" fill="#767C87"/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>':"",o,r.Text.encode(e.data["ASSOCIATED_ENTITY"]["CREATED"]),i?r.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t\t\t<div class="post-comment-wrap">\n\t\t\t\t\t\t\t\t\t\t\t<div class="post-comment-text">',"</div>\n\t\t\t\t\t\t\t\t\t\t</div>"])),a):"",s);return u}))}},{key:"solve",value:function t(){}}],[{key:"checkForPaternity",value:function t(e){return false}}]);return e}(E);var R=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("CRM:Calltracker:");t.status="ready";t.error=null;return t}babelHelpers.createClass(e,[{key:"isReady",value:function t(){return this.status==="ready"}},{key:"isFailed",value:function t(){return this.error!==null}},{key:"execute",value:function t(){var e=this;this.status="busy";this.emit("start");this.prepare().then(this.submit.bind(this)).then(this.succeed.bind(this)).then(this.finalise.bind(this))["catch"]((function(t){e.fail(t);e.finalise()}))}},{key:"prepare",value:function t(){return Promise.resolve()}},{key:"submit",value:function t(){return Promise.resolve()}},{key:"succeed",value:function t(e){var n=e.data;this.emit("success",{entity:this,data:n})}},{key:"fail",value:function t(e){this.error=e;this.emit("error",{entity:this,error:e})}},{key:"finalise",value:function t(){this.status="finished";this.emit("finish",{entity:this})}}]);return e}(o.EventEmitter);var F=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));n.data=t||{};n.file=null;n.id=["crm_timeline_file_comment",e.counter++].join("_");return n}babelHelpers.createClass(e,[{key:"prepare",value:function t(){if(this.data.url&&(/^file:\/\//.test(this.data.url)||this.data.type==="audio/mp4")){return Promise.resolve()}return Promise.reject("Empty file body")}},{key:"submit",value:function t(){var e=this;return new Promise((function(t,n){var i=typeof s.Utils.getUploadFilename==="function"?s.Utils.getUploadFilename(e.data.name,e.data.type):e.data.name;var a={taskId:e.id,type:e.data.type,mimeType:BX.MobileUtils.getFileMimeType(e.data.type),folderId:parseInt(r.Loc.getMessage("MOBILE_EXT_UTILS_USER_FOLDER_FOR_SAVED_FILES")),name:i,url:e.data.url,previewUrl:e.data.previewUrl?e.data.previewUrl:null,resize:BX.MobileUtils.getResizeOptions(e.data.type)};if(e.data.type==="audio/mp4"){a={taskId:e.id,type:"mp3",mimeType:"audio/mp4",folderId:parseInt(r.Loc.getMessage("MOBILE_EXT_UTILS_USER_FOLDER_FOR_SAVED_FILES")),name:"mobile_audio_"+(new Date).toJSON().slice(0,19).replace("T","_").split(":").join("-")+".mp3",url:e.data.url,previewUrl:null}}var o=function(e){var i=e.event,a=e.data,s=e.taskId;if(s!==this.id){return}if(i==="onfilecreated"){BX.removeCustomEvent("onFileUploadStatusChanged",o);if(a.result.status!=="error"){var l=a.result.data.file;this.file={ID:l.id,IMAGE:typeof l.extra.imagePreviewUri!="undefined"?l.extra.imagePreviewUri:"",NAME:l.name,URL:{URL:typeof l.extra.downloadUri!="undefined"?l.extra.downloadUri:"",EXTERNAL:"YES",PREVIEW:typeof l.extra.imagePreviewUri!="undefined"?l.extra.imagePreviewUri:""},VALUE:"n"+l.id};return t({data:this.file})}var c=[];if(r.Type.isArrayFilled(a.result.errors)){a.result.errors.forEach((function(t){var e=t.message,n=t.code;c.push(r.Type.isStringFilled(e)?e:n)}))}a.error={message:c.join(""),code:"Receiver response error."}}if(a&&a.error){BX.removeCustomEvent("onFileUploadStatusChanged",o);var d=r.Type.isStringFilled(a.error.message)?a.error.message:"File uploading error.";var u=r.Type.isStringFilled(a.error.code)?a.error.code:"File uploading code.";return n(new Error(d,u))}}.bind(e);BX.addCustomEvent("onFileUploadStatusChanged",o);BXMobileApp.onCustomEvent("onFileUploadTaskReceived",{files:[a]},true)}))}},{key:"getText",value:function t(){if(this.file!==null){return"[DISK FILE ID="+this.file["VALUE"]+"]"}return"text"}},{key:"getSavedData",value:function t(){return this.file}}]);return e}(R);babelHelpers.defineProperty(F,"counter",0);var U=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,"CRM:Calltracker:"));t.setEventNamespace("CRM:Calltracker:");t.queue=[];t.erroredQueue=[];t.next=t.next.bind(babelHelpers.assertThisInitialized(t));return t}babelHelpers.createClass(e,[{key:"send",value:function t(e){this.queue.push(e);this.check()}},{key:"check",value:function t(){if(this.queue.length>0){return this.execute(this.queue[0])}return this.finish()}},{key:"next",value:function t(e){var n=e.data.entity;if(n.isFailed()){this.erroredQueue.push(n)}if(this.queue[0]===n){this.queue.shift()}else{var i=0;this.queue.forEach((function(t,e){if(t===n){i=e}}));this.queue.splice(i,1)}this.check()}},{key:"execute",value:function t(e){if(e.isReady()){e.subscribe("finish",this.next);e.execute()}}},{key:"finish",value:function t(){if(this.erroredQueue.length>0){this.emit("error")}else{this.emit("success")}this.emit("finish")}}]);return e}(o.EventEmitter);var B=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,null,[{key:"getInstance",value:function t(){if(e.instance===null){e.instance=new e}return e.instance}}]);return e}(U);babelHelpers.defineProperty(B,"instance",null);var X=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"check",value:function t(){if(this.erroredQueue.length<=0&&this.queue.length>0){return this.execute(this.queue[0])}return this.finish()}}]);return e}(U);var Y=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));n.text="";if(r.Type.isStringFilled(t.text)){n.text=t.text}n.files=[];if(r.Type.isArrayFilled(t.files)){n.files=t.files}if(t.events){["start","success","error","finish"].forEach((function(e){if(t.events[e]){n.subscribe(e,t.events[e])}}))}B.getInstance().send(babelHelpers.assertThisInitialized(n));return n}babelHelpers.createClass(e,[{key:"prepare",value:function t(){var e=this;if(r.Type.isArrayFilled(this.files)){return new Promise((function(t,n){var i=new X(true);i.subscribe("success",(function(){if(!r.Type.isStringFilled(e.text)){e.files.forEach((function(t){e.text+=t.getText()}))}t()}));i.subscribe("error",(function(){var t=[];e.files.forEach((function(e){if(e.isFailed()){t.push(e.error.message)}}));n(new Error(t.join(" "),"File upload error."))}));e.files.forEach((function(t,n){e.files[n]=new F(t);i.send(e.files[n])}))}))}if(r.Type.isStringFilled(this.text)){return Promise.resolve()}return Promise.reject("Empty comment data.")}},{key:"submit",value:function t(){return c.createItem({text:this.text,files:this.files.map((function(t){return t.file["VALUE"]}))})["catch"]((function(t){var e=[];if(r.Type.isArrayFilled(t.errors)){t.errors.forEach((function(t){var n=t.message,i=t.code;e.push(r.Type.isStringFilled(n)?n:i)}))}else{e.push("Receiver response error.")}return Promise.reject({message:e.join(""),code:"Receiver response error."})}))}}]);return e}(R);var j=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("CRM:Calltracker:");t.params={useAudioMessages:true,placeholder:"",onSend:t.onSendButtonPressed.bind(babelHelpers.assertThisInitialized(t))};window.BX.MobileUI.TextField.show(t.params);t.showCommentStart=t.showCommentStart.bind(babelHelpers.assertThisInitialized(t));t.showCommentError=t.showCommentError.bind(babelHelpers.assertThisInitialized(t));t.showCommentSucceed=t.showCommentSucceed.bind(babelHelpers.assertThisInitialized(t));return t}babelHelpers.createClass(e,[{key:"show",value:function t(){window.BXMobileApp.UI.Page.TextPanel.setText("");window.BXMobileApp.UI.Page.TextPanel.focus()}},{key:"onFormIsActive",value:function t(e){console.log("event: ",e)}},{key:"onSendButtonPressed",value:function t(e){var n=e.text,i=e.attachedFiles;window.BXMPage.TextPanel.clear();var a=String(n).trim();if(a.length>0||i&&i.length>0){var r=new Y({text:a,files:i,events:{start:this.showCommentStart,error:this.showCommentError,success:this.showCommentSucceed}});this.emit("onNewComment",{comment:r})}}},{key:"showCommentStart",value:function t(e){var n=e.data.entity}},{key:"showCommentError",value:function t(e){var n=e.data,i=n.entity,a=n.error;this.emit("onFailedComment",{comment:i,error:a})}},{key:"showCommentSucceed",value:function t(e){var n=e.data,i=n.entity,a=n.data,r=a.item,s=a.items;this.emit("onSucceedComment",{comment:i,commentData:r,comments:s})}},{key:"showWait",value:function t(){window.BXMobileApp.UI.Page.TextPanel.showLoading(true)}},{key:"closeWait",value:function t(){window.BXMobileApp.UI.Page.TextPanel.showLoading(false)}}]);return e}(o.EventEmitter);var q=[E,y,w];function z(t){var e=E;q.forEach((function(n){if(n.checkForPaternity(t)){e=n}}));return new e(t)}window.app.exec("enableCaptureKeyboard",true);var G=false;r.addCustomEvent("onKeyboardWillShow",(function(){G=true}));r.addCustomEvent("onKeyboardDidHide",(function(){G=false}));var V=function(t){babelHelpers.inherits(e,t);function e(t){var n;var i=t.entity,a=t.containerScheduleItems,r=t.scheduleItems,s=t.containerHistoryItems,o=t.historyItems;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));n.setEventNamespace("CRM:Calltracker:");n.activities=new Map;n.items=new Map;n.entity=i;n.addScheduleItems(r,a);n.container=s;n.addItems(o);n.pagination=null;n.form=new j;n.form.subscribe("onNewComment",n.onNewComment.bind(babelHelpers.assertThisInitialized(n)));n.form.subscribe("onFailedComment",n.onFailedComment.bind(babelHelpers.assertThisInitialized(n)));n.form.subscribe("onSucceedComment",n.onSucceedComment.bind(babelHelpers.assertThisInitialized(n)));return n}babelHelpers.createClass(e,[{key:"addScheduleItems",value:function t(e,n){var i=this;e.forEach((function(t){var e=new P(t);i.activities.set(e.getOwnerId(),e);n.appendChild(e.getNode())}))}},{key:"addItems",value:function t(e){var n=this;var i=this.container.firstChild;e.forEach((function(t){var e=z(t);n.items.set(e.getId(),e);if(n.activities.has(e.getOwnerId())){var a=n.activities.get(e.getOwnerId());a.getNode().parentNode.removeChild(a.getNode());a.solve();n.activities["delete"](a.getOwnerId())}n.container.insertBefore(e.getNode(),i)}))}},{key:"onNewComment",value:function t(e){var n=e.data.comment;var i=new x(n);this.container.appendChild(i.getNode());n.item=i;n.node=i.getNode();var a=false;if(r.Browser.isIOS()){var s=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);var o=parseInt(s[1],10);a=o>=11&&G}var l=a?260:0;var c=r.pos(i.getNode());var d=r.GetWindowInnerSize().innerHeight-l;if(a===false||c.top>d){window.scrollTo(0,c.top-l)}}},{key:"onFailedComment",value:function t(e){var n=e.data.comment;if(n.item){n.item.setError(n.error)}}},{key:"onSucceedComment",value:function t(e){var n=this;var i=e.data,a=i.comment,r=i.commentData,s=i.comments;console.log("commentData: ",r,s);s.forEach((function(t){var e=z(t);n.items.set(e.getId(),e);if(n.activities.has(e.getOwnerId())){var i=n.activities.get(e.getOwnerId());i.getNode().parentNode.removeChild(i.getNode());i.solve();n.activities["delete"](i.getOwnerId())}if(e.getId()<r["ID"]){n.container.insertBefore(e.getNode(),a.node)}else if(e.getId()>r["ID"]){n.container.insertBefore(e.getNode(),a.node.nextSibling)}else{a.node.parentNode.replaceChild(e.getNode(),a.node);delete a.node;delete a.item}}));if(BXMobileApp&&this.entity){BXMobileApp.Events.postToComponent("onCrmCallTrackerItemCommentAdded",{ID:this.entity.ID});BX.onCustomEvent("onCrmCallTrackerItemCommentAdded",{ID:this.entity.ID})}}},{key:"initPagination",value:function t(e){this.pagination=new m(e,this.addItems.bind(this));this.container.parentNode.insertBefore(this.pagination.getNode(),this.container)}}]);return e}(o.EventEmitter);t.Configuration=l;t.Timeline=V})(this.BX.Mobile.Crm.Calltracker=this.BX.Mobile.Crm.Calltracker||{},BX,BX,window,BX,BX,BX,BX.Event);
//# sourceMappingURL=script.map.js