{"version":3,"file":"script.js","sources":["src/configuration.js","src/backend.js","src/pagination.js","src/item.js","src/itemcomment.js","src/utils.js","src/itemcalltracker.js","src/itempreview.js","src/itemactivity.js","src/form/entity.js","src/form/file.js","src/form/queue.js","src/form/commentsender.js","src/form/filesender.js","src/form/comment.js","src/form/form.js","src/timeline.js"],"sourcesContent":["export default class Configuration\n{\n\tstatic componentName: string = 'bitrix:mobile.crm.calltracker.timeline';\n\tstatic signedParameters: string = '';\n\tstatic currentAuthor = {\n\t\t'AUTHOR_ID': 0,\n\t\t'AUTHOR': {\n\t\t\t'FORMATTED_NAME': 'Guest',\n\t\t\t'SHOW_URL': '',\n\t\t\t'IMAGE_URL': ''\n\t\t}\n\t};\n\n\tstatic set({componentName, signedParameters, currentAuthor}) {\n\t\tConfiguration.componentName = componentName;\n\t\tConfiguration.signedParameters = signedParameters;\n\t\tConfiguration.currentAuthor = currentAuthor;\n\t}\n}","import {ajax} from 'main.core';\nimport Configuration from './configuration';\n\nexport default class Backend\n{\n\tstatic request({action, data}): Promise<RequestResponse>\n\t{\n\t\treturn ajax\n\t\t\t.runComponentAction(\n\t\t\t\tConfiguration.componentName,\n\t\t\t\taction,\n\t\t\t\t{\n\t\t\t\t\tmode: 'class',\n\t\t\t\t\tdata: data,\n\t\t\t\t\tsignedParameters: Configuration.signedParameters\n\t\t\t\t},\n\t\t\t);\n\t}\n\n\tstatic getItem(id, options): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'getItem',\n\t\t\tdata: {id, options},\n\t\t});\n\t}\n\tstatic createItem({text, files})\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'createItem',\n\t\t\tdata: {text, files},\n\t\t});\n\t}\n\n\tstatic getItemsFromPage(itemId: number, pageNumber: number)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tajax.runComponentAction(\n\t\t\t\t\tConfiguration.componentName,\n\t\t\t\t\t'getItems',\n\t\t\t\t\t{\n\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\titemId: itemId\n\t\t\t\t\t\t},\n\t\t\t\t\t\tnavigation: {\n\t\t\t\t\t\t\tpage: pageNumber\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsignedParameters: Configuration.signedParameters\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.then(resolve, reject);\n\t\t});\n\t}\n}","import Backend from './backend';\nimport {Tag, Loc, Cache} from 'main.core';\nimport {Loader} from 'main.loader';\n\nexport class Pagination\n{\n\tconstructor(itemId, callback) {\n\t\tthis.itemId = itemId;\n\t\tthis.callback = callback;\n\t\tthis.pointer = 1;\n\t\tthis.busy = false;\n\t\tthis.cache = new Cache.MemoryCache();\n\t}\n\tgetNode()\n\t{\n\t\treturn this.cache.remember('mainNode', () => {\n\t\t\treturn Tag.render`<div class=\"crm-phonetracker-detail-comments-btn-container\" onclick=\"${this.sendPagination.bind(this)}\">\n\t\t\t\t<div class=\"crm-phonetracker-detail-comments-btn\">${Loc.getMessage('MPT_PREVIOUS_COMMENTS')}</div>\n\t\t\t</div>`;\n\t\t});\n\t}\n\tgetLoader(): Loader\n\t{\n\t\tif (!this.cache.has('PaginationLoader'))\n\t\t{\n\t\t\tconst target = this.getNode().appendChild(Tag.render`<div class=\"loader\"></div>`);\n\t\t\tthis.cache.set('PaginationLoader', new Loader({target: target, size: 20}));\n\t\t}\n\t\treturn this.cache.get('PaginationLoader');\n\t}\n\tsendPagination(): boolean\n\t{\n\t\tif (this.busy === true)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tthis.getLoader().show();\n\n\t\tthis.busy = true;\n\n\t\tBackend.getItemsFromPage(this.itemId, ++this.pointer)\n\t\t\t.then(({data: {items, paginationHasMore}, errors}) => {\n\t\t\t\tthis.getLoader().hide();\n\t\t\t\tthis.callback.call(this, items)\n\n\t\t\t\tif (paginationHasMore !== true)\n\t\t\t\t{\n\t\t\t\t\tthis.destroy();\n\t\t\t\t}\n\t\t\t\tif (errors.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.showErrors(errors);\n\t\t\t\t}\n\t\t\t}, () => {\n\t\t\t\tthis.showErrors(arguments);\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis.busy = false;\n\t\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.getNode().parentNode)\n\t\t{\n\t\t\tthis.getNode().parentNode.removeChild(this.getNode());\n\t\t}\n\t\tthis.getNode().style.display = 'none';\n\t\tthis.cache.keys().forEach((key) => {\n\t\t\tthis.cache.delete(key);\n\t\t});\n\t}\n\tshowErrors(errors)\n\t{\n\t\tconsole.log('Pagination errors: ', errors);\n\t}\n}","import {Cache, Tag, Text, Type, Runtime, pos} from 'main.core';\nimport 'main.polyfill.intersectionobserver';\nimport Backend from \"./backend\";\n\nlet intersectionObserver;\nfunction observeIntersection(entity, callback)\n{\n\tif (!intersectionObserver)\n\t{\n\t\tintersectionObserver = new IntersectionObserver(function(entries) {\n\t\t\tentries.forEach((entry) => {\n\t\t\t\tif (entry.isIntersecting)\n\t\t\t\t{\n\t\t\t\t\tintersectionObserver.unobserve(entry.target);\n\t\t\t\t\tconst observedCallback = entry.target.observedCallback;\n\t\t\t\t\tdelete entry.target.observedCallback;\n\t\t\t\t\tsetTimeout(observedCallback);\n\t\t\t\t}\n\t\t\t});\n\t\t}, {\n\t\t\tthreshold: 0\n\t\t});\n\t}\n\tentity.observedCallback = callback;\n\n\tintersectionObserver.observe(entity);\n}\n\nexport default class Item\n{\n\tstatic checkForPaternity()\n\t{\n\t\treturn true;\n\t}\n\tstatic renderWithDebounce = Runtime.debounce(function() {\n\t\tBitrixMobile.LazyLoad.showImages();\n\t}, 500);\n\n\n\tconstructor(data)\n\t{\n\t\tthis.id = data['ID'];\n\t\tthis.data = data;\n\n\t\tthis.cache = new Cache.MemoryCache();\n\n\t\tItem.renderWithDebounce();\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\tgetOwnerId()\n\t{\n\t\treturn ['OWN', this.getId()].join('_');\n\t}\n\tgetNode()\n\t{\n\t\treturn this.cache.remember('mainNode', () => {\n\t\t\tconst avatarUrl = Text.encode(\n\t\t\t\tthis.data['AUTHOR'] && this.data['AUTHOR']['IMAGE_URL']\n\t\t\t\t? this.data['AUTHOR']['IMAGE_URL']\n\t\t\t\t: ''\n\t\t\t);\n\t\t\tconst expand = () => {\n\t\t\t\tconst node = this.getNode().querySelector('div[data-bx-role=\"more-button\"]');\n\t\t\t\tnode.parentNode.removeChild(node);\n\n\t\t\t\tconst wrapper = this.getTextNode().parentNode;\n\t\t\t\tconst startHeight = pos(wrapper).height;\n\t\t\t\tconst endHeight = pos(this.getTextNode()).height;\n\n\t\t\t\twrapper.style.maxHeight = startHeight + 'px';\n\t\t\t\twrapper.style.overflow = 'hidden';\n\n\t\t\t\tlet time = (endHeight - startHeight) / (2000 - startHeight);\n\t\t\t\ttime = (time < 0.3 ? 0.3 : (time > 0.8 ? 0.8 : time));\n\n\t\t\t\t(new BX[\"easing\"]({\n\t\t\t\t\tduration: time * 1000,\n\t\t\t\t\tstart: { height: startHeight},\n\t\t\t\t\tfinish: { height: endHeight},\n\t\t\t\t\ttransition: BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\t\tstep: function(state){\n\t\t\t\t\t\twrapper.style.maxHeight = state.height + \"px\";\n\t\t\t\t\t},\n\t\t\t\t\tcomplete : function(){\n\t\t\t\t\t\twrapper.style.cssText = '';\n\t\t\t\t\t\twrapper.style.maxHeight = 'none';\n\t\t\t\t\t\tBX.LazyLoad.showImages(true);\n\t\t\t\t\t}\n\t\t\t\t})).animate();\n\t\t\t};\n\t\t\tlet render = Tag.render`<div class=\"feed-com-block-cover\">\n\t\t\t\t<div class=\"post-comment-block post-comment-block-old post-comment-block-approved mobile-longtap-menu\">\n\t\t\t\t\t<div class=\"ui-icon ui-icon-common-user post-comment-block-avatar\">\n\t\t\t\t\t${\n\t\t\t\t\t\tavatarUrl \n\t\t\t\t\t\t? Tag.render`<i style=\"background-image:url('${avatarUrl}')\"></i>`\n\t\t\t\t\t\t: Tag.render`<i></i>`\n\t\t\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"post-comment-detail\">\n\t\t\t\t\t\t<div class=\"post-comment-balloon\">\n\t\t\t\t\t\t\t<div class=\"post-comment-cont\">\n\t\t\t\t\t\t\t\t<a href=\"\" class=\"post-comment-author\">${Text.encode(this.data['AUTHOR']['FORMATTED_NAME'])}</a>\n\t\t\t\t\t\t\t\t<div class=\"post-comment-time\">${this.getDateNode()}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"post-comment-wrap-outer\">\n\t\t\t\t\t\t\t\t<div class=\"post-comment-wrap\">\n\t\t\t\t\t\t\t\t\t${this.getTextNode()}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"post-comment-more\" data-bx-role=\"more-button\" onclick=\"${expand}\">\n\t\t\t\t\t\t\t\t\t<div class=\"post-comment-more-but\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${this.getFilesNode()}\n\t\t\t\t\t\t${this.getActionNode()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t\treturn render;\n\t\t});\n\t}\n\n\tgetTextNode()\n\t{\n\t\treturn this.cache.remember('textNode', () => {\n\t\t\tconst renderTag = Tag.render`<div class=\"post-comment-text\"></div>`\n\t\t\tRuntime.html(renderTag, this.data['COMMENT']);\n\n\t\t\treturn renderTag;\n\t\t});\n\t}\n\n\tgetDateNode()\n\t{\n\t\treturn this.cache.remember('dateNode', () => {\n\t\t\tif (Type.isStringFilled(this.data['CREATED']))\n\t\t\t{\n\t\t\t\treturn this.data['CREATED'];\n\t\t\t}\n\t\t\treturn BX.formatDate();\n\t\t});\n\t}\n\n\tgetFilesNode()\n\t{\n\t\treturn this.cache.remember('filesBlock', () => {\n\t\t\tif (this.data['HAS_FILES'] !== 'Y')\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tconst renderTag = Tag.render`\n\t\t<div class=\"post-item-attached-file-wrap\">\n\t\t\t<div class=\"post-item-attached-file-list\">\n\t\t\t</div>\n\t\t</div>`;\n\n\t\t\tif (Type.isStringFilled(this.data['PARSED_ATTACHMENT']))\n\t\t\t{\n\t\t\t\tRuntime.html(renderTag, this.data['PARSED_ATTACHMENT']);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tobserveIntersection(renderTag, () => {\n\t\t\t\t\t\tconst options = ['GET_FILE_BLOCK'];\n\t\t\t\t\t\tthis.data['HAS_INLINE_ATTACHMENT'] === 'Y' ? options.push('GET_COMMENT') : null;\n\t\t\t\t\t\tBackend\n\t\t\t\t\t\t\t.getItem(this.id, options)\n\t\t\t\t\t\t\t.then(({data: {files, text}, errors}) => {\n\t\t\t\t\t\t\t\tif (Type.isStringFilled(files))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tRuntime.html(renderTag, files);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (Type.isStringFilled(text))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tRuntime.html(this.getTextNode(), text);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, ({errors}) => {\n\t\t\t\t\t\t\t\tconst errorMessages = [];\n\t\t\t\t\t\t\t\terrors.forEach((error) => {\n\t\t\t\t\t\t\t\t\terrorMessages.push(error.message);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}, 100);\n\t\t\t}\n\n\t\t\treturn Tag.render`<div class=\"post-item-attached-file-wrap\">${renderTag}</div>`;\n\t\t});\n\t}\n\n\tgetActionNode()\n\t{\n\t\treturn this.cache.remember('actionNode', () => {\n\t\t\treturn '';\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"post-comment-control-box\">\n\t\t\t\t\t<div class=\"post-comment-control-item\">Edit</div>\n\t\t\t\t\t<div class=\"post-comment-control-item\">Delete</div>\n\t\t\t\t</div>`;\n\t\t});\n\t}\n}","import Item from './item';\nexport default class ItemComment extends Item\n{\n\tstatic checkForPaternity(data)\n\t{\n\t\treturn data['TYPE_CODE'] === 'COMMENT';\n\t}\n}","import {Loc} from 'main.core';\nexport default class Utils {\n\tstatic formatInterval(timestamp: Number)\n\t{\n\t\tconst item = {\n\t\t\tDAY: Math.floor(timestamp / 86400),\n\t\t\tHOUR: Math.floor(timestamp % 86400 / 3600),\n\t\t\tMINUTE: Math.floor(timestamp % 86400 % 3600 / 60),\n\t\t\tSECOND: timestamp % 86400 % 3600 % 60,\n\t\t};\n\t\tconst result = [];\n\t\tfor (let ii in item)\n\t\t{\n\t\t\tif (item[ii] > 0)\n\t\t\t{\n\t\t\t\tresult.push([\n\t\t\t\t\titem[ii],\n\t\t\t\t\tLoc.getMessage(['INTERVAL', ii, (item[ii] === 1 ? 'SINGLE' : 'PLURAL')].join('_'))\n\t\t\t\t].join(' '));\n\t\t\t}\n\t\t}\n\t\tif (result.length <= 0)\n\t\t{\n\t\t\tresult.push([\n\t\t\t\t'0',\n\t\t\t\tLoc.getMessage(['INTERVAL_SECOND_SINGLE'].join('_'))\n\t\t\t].join(' '));\n\t\t}\n\t\treturn result.join(' ');\n\t}\n}","import Item from './item';\nimport {Loc, Runtime, Tag, Text, Type} from \"main.core\";\nimport Utils from \"./utils\";\nimport 'ui.vue.components.audioplayer';\nimport {Vue} from 'ui.vue';\n\nfunction formatDuration(timestamp) {\n\treturn timestamp;\n}\n\nexport default class ItemCalltracker extends Item\n{\n\tgetOwnerId()\n\t{\n\t\treturn [this.data['ASSOCIATED_ENTITY']['TYPE_ID'], this.data['ASSOCIATED_ENTITY']['ID']].join('_');\n\t}\n\tgetNode()\n\t{\n\t\treturn this.cache.remember('mainNode', () => {\n\t\t\tconst direction = parseInt(this.data['ASSOCIATED_ENTITY']['DIRECTION']);\n\t\t\tconst rawDuration = parseInt(this.data['ASSOCIATED_ENTITY']['SETTINGS']['DURATION']);\n\t\t\tconst hasDuration = (rawDuration > 0);\n\t\t\tconst duration = Utils.formatInterval(rawDuration);\n\n\t\t\tconst created = Text.encode(this.data['CREATED']);\n\t\t\tconst comment = Loc.getMessage('MPL_CALL_IS_PROCESSED');\n\n\t\t\tconst hasStatus = this.data['ASSOCIATED_ENTITY']['CALL_INFO'] ? this.data['ASSOCIATED_ENTITY']['CALL_INFO']['HAS_STATUS'] : false;\n\t\t\tconst status = this.data['ASSOCIATED_ENTITY']['CALL_INFO'] ? this.data['ASSOCIATED_ENTITY']['CALL_INFO']['SUCCESSFUL'] : null;\n\t\t\tconst iconClasses = [\n\t\t\t\t(direction === BX.CrmActivityDirection.incoming\n\t\t\t\t\t? 'ui-icon-service-call-in' : (\n\t\t\t\t\t\tdirection === BX.CrmActivityDirection.outgoing\n\t\t\t\t\t\t\t? 'ui-icon-service-call-out' : 'ui-icon-service-callback')),\n\t\t\t];\n\n\t\t\tconst render = Tag.render`\n\t\t\t<div class=\"feed-com-block-cover crm-phonetracker-notification\">\n\t\t\t\t<div class=\"post-comment-block post-comment-block-old post-comment-block-approved  mobile-longtap-menu \">\n\t\t\t\t\t<div class=\"ui-icon ${iconClasses.join(' ')} crm-phonetracker-icon\">\n\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t${(hasStatus && status !== true) ?\n\t\t\t\t\t\t\t`<div class=\"ui-icon-cross\">\n\t\t\t\t\t\t\t\t<svg width=\"11\" height=\"11\" viewBox=\"0 0 11 11\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7.19252 5.532L10.7451 9.08457L9.08463 10.745L5.53206 7.19246L1.91046 10.8141L0.25 9.15361L3.87161 5.532L0.319037 1.97943L1.97949 0.318976L5.53206 3.87155L9.15367 0.249939L10.8141 1.91039L7.19252 5.532Z\" fill=\"#767C87\"/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>` : ''\n\t\t\t\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"post-comment-detail\">\n\t\t\t\t\t\t<div class=\"post-comment-balloon\">\n\t\t\t\t\t\t\t<div class=\"post-comment-cont\">\n\t\t\t\t\t\t\t\t<span class=\"post-comment-author crm-phonetracker-event-name\">\n\t\t\t\t\t\t\t\t\t${comment}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<div class=\"post-comment-time\">${created}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"post-comment-wrap-outer\">\n\t\t\t\t\t\t\t\t${\n\t\t\t\t\t\t\t\t\thasDuration\n\t\t\t\t\t\t\t\t\t\t? Tag.render`\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"post-comment-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"post-comment-text\">${duration}</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>`\n\t\t\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t<div class=\"post-label-wrap\">\n\t\t\t\t\t\t\t\t\t<svg width=\"19\" height=\"18\" viewBox=\"0 0 19 18\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M12.5615 10.4593L14.0291 11.559C14.4726 11.8959 14.507 12.5616 14.0978 12.9414C12.5634 14.4077 10.0067 14.977 6.64094 11.4185C3.27513 7.86011 3.94451 5.31279 5.47892 3.8464C5.88763 3.46681 6.53873 3.52962 6.8498 3.99195L7.87625 5.49314C8.23575 6.04419 8.00868 6.79498 7.45713 7.16309L6.84098 7.57434C6.6994 7.66453 6.65996 7.85351 6.73593 7.99833C7.53276 9.39692 8.68397 10.6226 10.0304 11.5009C10.1646 11.5784 10.3575 11.5383 10.4511 11.4106L10.8862 10.7938C11.2666 10.2563 12.0403 10.0677 12.5615 10.4593Z\" fill=\"white\"/>\n\t\t\t\t\t\t\t\t\t\t<path d=\"M13.8358 4.26291C12.8706 3.2977 11.577 2.7646 10.1993 2.77788C9.9525 2.79346 9.7557 2.99026 9.75345 3.22376C9.76427 3.47033 9.95731 3.66337 10.1908 3.66111C11.3472 3.63671 12.4084 4.0686 13.2193 4.8795C14.0303 5.69041 14.4621 6.75159 14.4372 7.90855C14.436 8.0385 14.4867 8.14155 14.5641 8.21887C14.6415 8.29628 14.7579 8.33373 14.875 8.34529C15.1218 8.32972 15.3186 8.13292 15.3209 7.89942C15.3348 6.52238 14.801 5.22812 13.8358 4.26291Z\" fill=\"white\"/>\n\t\t\t\t\t\t\t\t\t\t<path d=\"M12.5749 5.52404C12.0088 4.95793 11.258 4.65303 10.4524 4.66131C10.2056 4.67688 10.0088 4.87368 10.0065 5.10718C10.0174 5.35375 10.2104 5.54679 10.4439 5.54453C11.0155 5.53902 11.5458 5.7547 11.945 6.15386C12.3436 6.5525 12.5598 7.08336 12.5543 7.65492C12.553 7.78487 12.6038 7.88792 12.6812 7.96534L12.7231 8.00097C12.7976 8.05494 12.8946 8.08326 12.9923 8.0929C13.2391 8.07732 13.4359 7.88052 13.4381 7.64702C13.4459 6.84088 13.141 6.09014 12.5749 5.52404Z\" fill=\"white\"/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t<div class=\"post-label-text\">${Text.encode(this.data['ASSOCIATED_ENTITY']['CREATED'])}</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${this.getFilesNode()}\n\t\t\t\t\t\t${this.getActionNode()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t`;\n\t\t\treturn render;\n\t\t});\n\t}\n\tgetFilesNode() {\n\t\treturn this.cache.remember('filesBlock', () => {\n\t\t\tif (!this.data['ASSOCIATED_ENTITY']['MEDIA_FILE_INFO'])\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tconst renderTag = Tag.render`<div class=\"post-item-attached-audio\"></div>`;\n\n\t\t\tVue.create({\n\t\t\t\tel: renderTag.appendChild(document.createElement('DIV')),\n\t\t\t\ttemplate: `<bx-audioplayer src=\"${this.data['ASSOCIATED_ENTITY']['MEDIA_FILE_INFO']['URL']}\" background=\"dark\"/>`\n\t\t\t});\n\n\t\t\treturn Tag.render`<div class=\"post-item-attached-file-wrap\">\n\t\t\t\t<div class=\"post-item-attached-file-wrap\">\n\t\t\t\t\t<div class=\"post-item-attached-file-list\">\n\t\t\t\t\t\t${renderTag}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t});\n\t}\n\n\tstatic checkForPaternity(data)\n\t{\n\t\treturn data['TYPE_CODE'] === 'CALL_TRACKER' && !!data['ASSOCIATED_ENTITY'];\n\t}\n}","import Item from './item';\nimport {Tag, Text, Loc} from \"main.core\";\nimport Configuration from './configuration';\n\nexport default class ItemPreview extends Item\n{\n\tstatic checkForPaternity(data)\n\t{\n\t\treturn data.constructor.name === 'Comment';\n\t}\n\n\tstatic count = 0;\n\tconstructor(data)\n\t{\n\t\tconst itemData = {\n\t\t\t'ID': 'preview_node_' + (ItemPreview.count++),\n\t\t\t'COMMENT': Text.encode(data.text),\n\t\t\t'AUTHOR_ID': Configuration.currentAuthor.AUTHOR_ID,\n\t\t\t'AUTHOR': Configuration.currentAuthor.AUTHOR,\n\t\t\t'CREATED': (new Date().getTime() / 1000)\n\t\t};\n\t\tsuper(itemData);\n\t\tdata.previewObj = this;\n\t}\n\n\tgetNode()\n\t{\n\t\treturn this.cache.remember('mainNode', () => {\n\t\t\tconst avatarUrl = Text.encode(\n\t\t\t\tthis.data['AUTHOR'] && this.data['AUTHOR']['IMAGE_URL']\n\t\t\t\t\t? this.data['AUTHOR']['IMAGE_URL']\n\t\t\t\t\t: ''\n\t\t\t);\n\t\t\tlet render = Tag.render`<div class=\"feed-com-block-cover\">\n\t\t\t\t<div class=\"post-comment-block post-comment-block-old post-comment-block-approved mobile-longtap-menu\">\n\t\t\t\t\t<div class=\"ui-icon ui-icon-common-user post-comment-block-avatar\">\n\t\t\t\t\t\t${\n\t\t\t\t\t\t\tavatarUrl\n\t\t\t\t\t\t\t\t? Tag.render`<i style=\"background-image:url('${avatarUrl}')\"></i>`\n\t\t\t\t\t\t\t\t: Tag.render`<i></i>`\n\t\t\t\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"post-comment-detail\">\n\t\t\t\t\t\t<div class=\"post-comment-balloon\">\n\t\t\t\t\t\t\t<div class=\"post-comment-cont\">\n\t\t\t\t\t\t\t\t<a href=\"\" class=\"post-comment-author\">${Text.encode(this.data['AUTHOR']['FORMATTED_NAME'])}</a>\n\t\t\t\t\t\t\t\t<div class=\"post-comment-time\">${this.getDateNode()}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"post-comment-wrap-outer\">\n\t\t\t\t\t\t\t\t<div class=\"post-comment-wrap\">\n\t\t\t\t\t\t\t\t\t${this.getTextNode()}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"post-comment-more\" style=\"display: none;\">\n\t\t\t\t\t\t\t\t\t<div class=\"post-comment-more-but\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"post-comment-control-box\" data-bx-role=\"loader-block\">\n\t\t\t\t\t\t\t<div class=\"post-comment-control-item\">${Loc.getMessage('MPL_MOBILE_PUBLISHING')}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"post-comment-control-box\" data-bx-role=\"error-block\">\n\t\t\t\t\t\t\t<div class=\"post-comment-control-item\" data-bx-role=\"error-text\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t\treturn render;\n\t\t});\n\t}\n\n\tgetDateNode()\n\t{\n\t\treturn '';\n\t}\n\n\tsetError(error: Error) {\n\t\tthis.getNode().setAttribute('data-bx-status', 'failed');\n\t\tconst errorNode = this.getNode().querySelector('[data-bx-role=\"error-text\"]');\n\t\terrorNode.innerHTML = error.message;\n\t}\n}","import Item from './item';\nimport {Tag, Text, Loc} from \"main.core\";\nimport Utils from './utils';\n\nexport default class ItemActivity extends Item\n{\n\tconstructor(data) {\n\t\tsuper(data);\n\t\tthis.id = this.data['ASSOCIATED_ENTITY']['ID'];\n\t\tconsole.log('this.data: ', this.data);\n\n\t}\n\tgetOwnerId()\n\t{\n\t\treturn [this.data['ASSOCIATED_ENTITY']['TYPE_ID'], this.getId()].join('_');\n\t}\n\tgetNode()\n\t{\n\t\treturn this.cache.remember('mainNode', () => {\n\t\t\tconst direction = parseInt(this.data['ASSOCIATED_ENTITY']['DIRECTION']);\n\t\t\tconst rawDuration = parseInt(this.data['ASSOCIATED_ENTITY']['SETTINGS']['DURATION']);\n\t\t\tconst hasDuration = (rawDuration > 0);\n\t\t\tconst duration = Utils.formatInterval(rawDuration);\n\n\t\t\tconst deadline = Text.encode(this.data['ASSOCIATED_ENTITY']['DEADLINE']);\n\t\t\tconst comment = direction === BX.CrmActivityDirection.incoming ?\n\t\t\t\tLoc.getMessage('MPL_MOBILE_INCOMING_CALL') : (direction === BX.CrmActivityDirection.outgoing ?\n\t\t\t\t\tLoc.getMessage('MPL_MOBILE_OUTBOUND_CALL') :\n\t\t\t\t\tLoc.getMessage('MPL_MOBILE_CALL'));\n\t\t\tconst hasStatus = this.data['ASSOCIATED_ENTITY']['CALL_INFO'] ? this.data['ASSOCIATED_ENTITY']['CALL_INFO']['HAS_STATUS'] : false;\n\t\t\tconst status = this.data['ASSOCIATED_ENTITY']['CALL_INFO'] ? this.data['ASSOCIATED_ENTITY']['CALL_INFO']['SUCCESSFUL'] : null;\n\n\t\t\tconst iconClasses = [\n\t\t\t\t(direction === BX.CrmActivityDirection.incoming\n\t\t\t\t\t? 'ui-icon-service-call-in' : (\n\t\t\t\t\t\tdirection === BX.CrmActivityDirection.outgoing\n\t\t\t\t\t\t\t? 'ui-icon-service-call-out' : 'ui-icon-service-callback')),\n\t\t\t];\n\t\t\tconst render = Tag.render`\n\t\t\t<div class=\"feed-com-block-cover crm-calltracker-notification\">\n\t\t\t\t<div class=\"post-comment-block post-comment-block-old post-comment-block-approved  mobile-longtap-menu \">\n\t\t\t\t\t<div class=\"ui-icon ${iconClasses.join(' ')} crm-phonetracker-icon\">\n\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t${(hasStatus && status !== true) ? \n\t\t\t\t\t\t\t`<div class=\"ui-icon-cross\">\n\t\t\t\t\t\t\t\t<svg width=\"11\" height=\"11\" viewBox=\"0 0 11 11\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7.19252 5.532L10.7451 9.08457L9.08463 10.745L5.53206 7.19246L1.91046 10.8141L0.25 9.15361L3.87161 5.532L0.319037 1.97943L1.97949 0.318976L5.53206 3.87155L9.15367 0.249939L10.8141 1.91039L7.19252 5.532Z\" fill=\"#767C87\"/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>` : ''\n\t\t\t\t\t\t}\n\t\t\t\t\t\t<div class=\"ui-icon-counter\">1</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"post-comment-detail\">\n\t\t\t\t\t\t<div class=\"post-comment-balloon\">\n\t\t\t\t\t\t\t<div class=\"post-comment-cont\">\n\t\t\t\t\t\t\t\t<span class=\"post-comment-author    crm-phonetracker-event-name\">\n\t\t\t\t\t\t\t\t\t${comment}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<div class=\"post-comment-time\">${Text.encode(this.data['ASSOCIATED_ENTITY']['CREATED'])}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"post-comment-wrap-outer\">\n\t\t\t\t\t\t\t\t${\n\t\t\t\t\t\t\t\t\thasDuration\n\t\t\t\t\t\t\t\t\t? Tag.render`\n\t\t\t\t\t\t\t\t\t\t<div class=\"post-comment-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"post-comment-text\">${duration}</div>\n\t\t\t\t\t\t\t\t\t\t</div>`\n\t\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t<div class=\"post-label-wrap\">\n\t\t\t\t\t\t\t\t\t<svg width=\"19\" height=\"18\" viewBox=\"0 0 19 18\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t\t\t\t\t\t<path d=\"M8.26297 5.9911H9.76297V8.2411H12.013V9.7411H8.26297V5.9911Z\" fill=\"white\"/>\n\t\t\t\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M3.5682 11.4511C4.56845 13.6754 6.81991 15.0688 9.25682 14.9716C12.4898 14.9055 15.0579 12.2327 14.995 8.99971C14.9949 6.56087 13.5128 4.36679 11.2504 3.45607C8.98799 2.54536 6.39916 3.10075 4.70939 4.85933C3.01962 6.61792 2.56795 9.22685 3.5682 11.4511ZM4.95948 10.8255C5.70444 12.4821 7.38125 13.5198 9.19618 13.4475C11.604 13.3982 13.5167 11.4076 13.4698 8.99978C13.4697 7.18341 12.3659 5.54933 10.6809 4.87106C8.99597 4.19279 7.06789 4.60642 5.8094 5.91616C4.55092 7.2259 4.21453 9.16894 4.95948 10.8255Z\" fill=\"white\"/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t<div class=\"post-label-text\">${deadline}</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t`;\n\t\t\treturn render;\n\t\t});\n\t}\n\tsolve()\n\t{\n\n\t}\n\n\tstatic checkForPaternity(data)\n\t{\n\t\treturn false;\n\t}\n}","import {EventEmitter} from 'main.core.events';\n\nexport default class Entity extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('CRM:Calltracker:');\n\t\tthis.status = 'ready';\n\t\tthis.error = null;\n\t}\n\n\tisReady()\n\t{\n\t\treturn this.status === 'ready';\n\t}\n\n\tisFailed()\n\t{\n\t\treturn this.error !== null;\n\t}\n\n\texecute()\n\t{\n\t\tthis.status = 'busy';\n\n\t\tthis.emit('start');\n\n\t\tthis\n\t\t\t.prepare()\n\t\t\t.then(this.submit.bind(this))\n\t\t\t.then(this.succeed.bind(this))\n\t\t\t.then(this.finalise.bind(this))\n\t\t\t.catch((err) => {\n\t\t\t\tthis.fail(err);\n\t\t\t\tthis.finalise();\n\t\t\t})\n\t\t;\n\t}\n\n\tprepare()\n\t{\n\t\treturn Promise.resolve();\n\t}\n\n\tsubmit()\n\t{\n\t\treturn Promise.resolve();\n\t}\n\n\tsucceed({data})\n\t{\n\t\tthis.emit('success', {entity: this, data: data});\n\t}\n\n\tfail(error: Error)\n\t{\n\t\tthis.error = error;\n\t\tthis.emit('error', {entity: this, error: error});\n\t}\n\n\tfinalise()\n\t{\n\t\tthis.status = 'finished';\n\t\tthis.emit('finish', {entity: this});\n\t}\n}","import Entity from './entity';\nimport {Loc, Type} from 'main.core';\nimport {Utils} from 'mobile.utils';\n\nexport default class File extends Entity\n{\n\tstatic counter = 0;\n\tconstructor(data)\n\t{\n\t\tsuper();\n\t\tthis.data = data || {};\n\t\tthis.file = null;\n\n\t\tthis.id = ['crm_timeline_file_comment', File.counter++].join('_');\n\t}\n\n\tprepare()\n\t{\n\t\tif (this.data.url && (/^file:\\/\\//.test(this.data.url) || this.data.type === 'audio/mp4'))\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\treturn Promise.reject('Empty file body');\n\t}\n\n\tsubmit()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst name = (typeof Utils.getUploadFilename === 'function'\n\t\t\t\t\t? Utils.getUploadFilename(this.data.name, this.data.type)\n\t\t\t\t\t: this.data.name\n\t\t\t);\n\t\t\tlet uploadTask = {\n\t\t\t\ttaskId: this.id,\n\t\t\t\ttype: this.data.type,\n\t\t\t\tmimeType: BX.MobileUtils.getFileMimeType(this.data.type),\n\t\t\t\tfolderId: parseInt(Loc.getMessage('MOBILE_EXT_UTILS_USER_FOLDER_FOR_SAVED_FILES')),\n\t\t\t\tname: name,\n\t\t\t\turl: this.data.url,\n\t\t\t\tpreviewUrl: (this.data.previewUrl ? this.data.previewUrl : null),\n\t\t\t\tresize: BX.MobileUtils.getResizeOptions(this.data.type)\n\t\t\t};\n\t\t\tif (this.data.type === 'audio/mp4')\n\t\t\t{\n\t\t\t\tuploadTask = {\n\t\t\t\t\ttaskId: this.id,\n\t\t\t\t\ttype: 'mp3',\n\t\t\t\t\tmimeType: 'audio/mp4',\n\t\t\t\t\tfolderId: parseInt(Loc.getMessage('MOBILE_EXT_UTILS_USER_FOLDER_FOR_SAVED_FILES')),\n\t\t\t\t\tname: 'mobile_audio_'+(new Date).toJSON().slice(0, 19).replace('T', '_').split(':').join('-')+'.mp3',\n\t\t\t\t\turl: this.data.url,\n\t\t\t\t\tpreviewUrl: null,\n\t\t\t\t};\n\t\t\t}\n\t\t\tconst fileReceive = function({event, data, taskId}) {\n\t\t\t\tif (taskId !== this.id)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (event === 'onfilecreated')\n\t\t\t\t{\n\t\t\t\t\tBX.removeCustomEvent('onFileUploadStatusChanged', fileReceive);\n\t\t\t\t\tif (data.result.status !== 'error')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst file = data.result.data.file;\n\t\t\t\t\t\tthis.file = {\n\t\t\t\t\t\t\tID: file.id,\n\t\t\t\t\t\t\tIMAGE: typeof file.extra.imagePreviewUri != 'undefined' ? file.extra.imagePreviewUri : '',\n\t\t\t\t\t\t\tNAME: file.name,\n\t\t\t\t\t\t\tURL: {\n\t\t\t\t\t\t\t\tURL: typeof file.extra.downloadUri != 'undefined' ? file.extra.downloadUri : '',\n\t\t\t\t\t\t\t\tEXTERNAL: 'YES',\n\t\t\t\t\t\t\t\tPREVIEW: typeof file.extra.imagePreviewUri != 'undefined' ? file.extra.imagePreviewUri : ''\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tVALUE: 'n' + file.id\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn resolve({data: this.file});\n\t\t\t\t\t}\n\t\t\t\t\tconst errors = [];\n\t\t\t\t\tif (Type.isArrayFilled(data.result.errors))\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.result.errors.forEach(({message, code}) => {\n\t\t\t\t\t\t\terrors.push(Type.isStringFilled(message) ? message : code);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tdata.error = {message: errors.join(''), code: 'Receiver response error.'};\n\t\t\t\t}\n\t\t\t\tif (data && data.error)\n\t\t\t\t{\n\t\t\t\t\tBX.removeCustomEvent('onFileUploadStatusChanged', fileReceive);\n\t\t\t\t\tconst errorMessage = Type.isStringFilled(data.error.message) ? data.error.message : 'File uploading error.';\n\t\t\t\t\tconst errorCode = Type.isStringFilled(data.error.code) ? data.error.code : 'File uploading code.';\n\t\t\t\t\treturn reject(new Error(errorMessage, errorCode));\n\t\t\t\t}\n\t\t\t}.bind(this);\n\t\t\tBX.addCustomEvent('onFileUploadStatusChanged', fileReceive);\n\t\t\tBXMobileApp.onCustomEvent('onFileUploadTaskReceived', {files: [uploadTask]}, true);\n\t\t});\n\t}\n\tgetText()\n\t{\n\t\tif (this.file !== null)\n\t\t{\n\t\t\treturn '[DISK FILE ID=' + this.file['VALUE'] + ']'\n\t\t}\n\t\treturn 'text';\n\t}\n\tgetSavedData()\n\t{\n\t\treturn this.file;\n\t}\n}","import {BaseEvent, EventEmitter} from 'main.core.events';\n\nexport default class Queue extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper('CRM:Calltracker:');\n\t\tthis.setEventNamespace('CRM:Calltracker:');\n\t\tthis.queue = [];\n\t\tthis.erroredQueue = [];\n\t\tthis.next = this.next.bind(this);\n\t}\n\n\tsend(entity: Entity)\n\t{\n\t\tthis.queue.push(entity);\n\t\tthis.check();\n\t}\n\n\tcheck()\n\t{\n\t\tif (this.queue.length > 0)\n\t\t{\n\t\t\treturn this.execute(this.queue[0]);\n\t\t}\n\n\t\treturn this.finish();\n\t}\n\n\tnext({data:{entity}}: BaseEvent)\n\t{\n\t\tif (entity.isFailed())\n\t\t{\n\t\t\tthis.erroredQueue.push(entity);\n\t\t}\n\n\t\tif (this.queue[0] === entity)\n\t\t{\n\t\t\tthis.queue.shift();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet index = 0;\n\t\t\tthis.queue.forEach((ent, ind) => {\n\t\t\t\tif (ent === entity)\n\t\t\t\t{\n\t\t\t\t\tindex = ind;\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.queue.splice(index, 1);\n\t\t}\n\t\tthis.check();\n\t}\n\n\texecute(entity: Entity)\n\t{\n\t\tif (entity.isReady())\n\t\t{\n\t\t\tentity.subscribe('finish', this.next);\n\t\t\tentity.execute();\n\t\t}\n\t}\n\n\tfinish()\n\t{\n\t\tif (this.erroredQueue.length > 0)\n\t\t{\n\t\t\tthis.emit('error');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit('success');\n\t\t}\n\t\tthis.emit('finish');\n\t}\n}","import Queue from './queue';\n\nexport default class CommentSender extends Queue\n{\n\tstatic instance = null;\n\n\tstatic getInstance()\n\t{\n\t\tif (CommentSender.instance === null)\n\t\t{\n\t\t\tCommentSender.instance = new CommentSender();\n\t\t}\n\t\treturn CommentSender.instance;\n\t}\n}","import Queue from './queue';\n\nexport default class FileSender extends Queue\n{\n\tcheck()\n\t{\n\t\tif (this.erroredQueue.length <= 0 && this.queue.length > 0)\n\t\t{\n\t\t\treturn this.execute(this.queue[0]);\n\t\t}\n\n\t\treturn this.finish();\n\t}\n}\n","import {Type} from 'main.core';\nimport Entity from './entity';\nimport File from './file';\nimport CommentSender from './commentsender';\nimport FileSender from './filesender';\nimport Backend from './../backend';\n\nexport default class Comment extends Entity\n{\n\tconstructor(data)\n\t{\n\t\tsuper();\n\n\t\tthis.text = '';\n\t\tif (Type.isStringFilled(data.text))\n\t\t{\n\t\t\tthis.text = data.text;\n\t\t}\n\t\tthis.files = [];\n\t\tif (Type.isArrayFilled(data.files))\n\t\t{\n\t\t\tthis.files = data.files\n\t\t}\n\n\t\tif (data.events)\n\t\t{\n\t\t\t['start', 'success', 'error', 'finish'].forEach((eventName) => {\n\t\t\t\tif (data.events[eventName])\n\t\t\t\t{\n\t\t\t\t\tthis.subscribe(eventName, data.events[eventName]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tCommentSender.getInstance().send(this);\n\t}\n\n\tprepare()\n\t{\n\t\tif (Type.isArrayFilled(this.files))\n\t\t{\n\t\t\treturn new Promise((resolve, reject) =>\n\t\t\t{\n\t\t\t\tconst fileSender = new FileSender(true);\n\t\t\t\tfileSender.subscribe('success', () => {\n\t\t\t\t\tif (!Type.isStringFilled(this.text))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.files.forEach((file) => {\n\t\t\t\t\t\t\tthis.text += file.getText();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t\tfileSender.subscribe('error', () => {\n\t\t\t\t\tconst errors = [];\n\t\t\t\t\tthis.files.forEach((file) => {\n\t\t\t\t\t\tif (file.isFailed())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\terrors.push(file.error.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treject(new Error(errors.join(' '), 'File upload error.'))\n\t\t\t\t});\n\n\t\t\t\tthis.files.forEach((fileData, index) => {\n\t\t\t\t\tthis.files[index] = new File(fileData);\n\t\t\t\t\tfileSender.send(this.files[index]);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isStringFilled(this.text))\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn Promise.reject('Empty comment data.');\n\t}\n\n\tsubmit()\n\t{\n\t\treturn Backend.createItem({\n\t\t\ttext: this.text,\n\t\t\tfiles: this.files.map((file) => {\n\t\t\t\treturn file.file['VALUE'];\n\t\t\t}),\n\t\t}).catch((result) => {\n\t\t\tconst errors = [];\n\t\t\tif (Type.isArrayFilled(result.errors))\n\t\t\t{\n\t\t\t\tresult.errors.forEach(({message, code}) => {\n\t\t\t\t\terrors.push(Type.isStringFilled(message) ? message : code);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\terrors.push('Receiver response error.');\n\t\t\t}\n\t\t\treturn Promise.reject({message: errors.join(''), code: 'Receiver response error.'});\n\t\t});\n\t}\n}","import {BaseEvent, EventEmitter} from 'main.core.events';\nimport Comment from './comment';\nexport default class Form extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('CRM:Calltracker:');\n\t\tthis.params = {\n\t\t\tuseAudioMessages: true,\n\t\t\tplaceholder: '',\n\t\t\t//onEvent: this.onFormIsActive.bind(this),\n\t\t\tonSend: this.onSendButtonPressed.bind(this)\n\t\t};\n\n\t\twindow.BX.MobileUI.TextField.show(this.params);\n\n\t\tthis.showCommentStart = this.showCommentStart.bind(this);\n\t\tthis.showCommentError = this.showCommentError.bind(this);\n\t\tthis.showCommentSucceed = this.showCommentSucceed.bind(this);\n\t}\n\n\tshow()\n\t{\n\t\twindow.BXMobileApp.UI.Page.TextPanel.setText('');\n\t\twindow.BXMobileApp.UI.Page.TextPanel.focus();\n\t}\n\tonFormIsActive(event)\n\t{\n\t\tconsole.log('event: ', event);\n\t}\n\tonSendButtonPressed({text, attachedFiles})\n\t{\n\t\twindow.BXMPage.TextPanel.clear();\n\n\t\tconst cleanText = String(text).trim();\n\t\tif (cleanText.length > 0 || (attachedFiles && attachedFiles.length > 0))\n\t\t{\n\t\t\tconst entity = new Comment({\n\t\t\t\ttext: cleanText,\n\t\t\t\tfiles: attachedFiles,\n\t\t\t\tevents: {\n\t\t\t\t\tstart: this.showCommentStart,\n\t\t\t\t\terror: this.showCommentError,\n\t\t\t\t\tsuccess: this.showCommentSucceed\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.emit('onNewComment', {comment: entity});\n\t\t}\n\t}\n\n\tshowCommentStart({data:{entity}}: BaseEvent) {\n\t}\n\tshowCommentError({data:{entity, error}}: BaseEvent) {\n\t\tthis.emit('onFailedComment', {comment: entity, error});\n\t}\n\tshowCommentSucceed({data:{entity, data: {item, items}}}: BaseEvent) {\n\t\tthis.emit('onSucceedComment', {comment: entity, commentData: item, comments: items});\n\t}\n\tshowWait()\n\t{\n\t\twindow.BXMobileApp.UI.Page.TextPanel.showLoading(true);\n\t}\n\tcloseWait()\n\t{\n\t\twindow.BXMobileApp.UI.Page.TextPanel.showLoading(false);\n\t}\n}","import {pos, GetWindowInnerSize, Browser, addCustomEvent, removeCustomEvent} from 'main.core';\nimport {Pagination} from './pagination';\nimport Item from './item';\nimport ItemComment from './itemcomment';\nimport ItemCalltracker from './itemcalltracker';\nimport ItemPreview from './itempreview';\nimport ItemActivity from './itemactivity';\nimport Form from './form/form';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nconst itemMappings = [\n\tItem,\n\tItemComment,\n\tItemCalltracker,\n];\nfunction getItemByData(itemData)\n{\n\tlet itemClassName = Item;\n\titemMappings.forEach((itemClass) => {\n\t\tif (itemClass.checkForPaternity(itemData))\n\t\t{\n\t\t\titemClassName = itemClass;\n\t\t}\n\t});\n\treturn new itemClassName(itemData);\n}\n\nwindow.app.exec(\"enableCaptureKeyboard\", true);\nlet keyBoardIsShown = false;\naddCustomEvent(\"onKeyboardWillShow\", function() { keyBoardIsShown = true; });\naddCustomEvent(\"onKeyboardDidHide\", function() { keyBoardIsShown = false; });\n\nexport default class Timeline extends EventEmitter {\n\tconstructor({\n\t\tentity,\n\t\tcontainerScheduleItems,\n\t\tscheduleItems,\n\t\tcontainerHistoryItems,\n\t\thistoryItems\n\t}) {\n\t\tsuper();\n\t\tthis.setEventNamespace('CRM:Calltracker:');\n\t\tthis.activities = new Map();\n\t\tthis.items = new Map();\n\t\tthis.entity = entity;\n\t\tthis.addScheduleItems(scheduleItems, containerScheduleItems);\n\n\t\tthis.container = containerHistoryItems;\n\t\tthis.addItems(historyItems);\n\n\t\tthis.pagination = null;\n\t\tthis.form = new Form();\n\t\tthis.form.subscribe('onNewComment', this.onNewComment.bind(this));\n\t\tthis.form.subscribe('onFailedComment', this.onFailedComment.bind(this));\n\t\tthis.form.subscribe('onSucceedComment', this.onSucceedComment.bind(this));\n\n\t\t//@todo remove this test\n/*\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tconst previewItem = new ItemPreview({text: 'Text for test error'});\n\t\t\t\t\tpreviewItem.setError(new Error('Just error to check template.'));\n\n\t\t\t\t\tthis.container.appendChild(previewItem.getNode());\n\t\t\t\t\tconst previewItemAnoterOne = new ItemPreview({text: 'Text for preview test'});\n\t\t\t\t\tthis.container.appendChild(previewItemAnoterOne.getNode());\n\t\t\t\t}, 100);\n*/\t}\n\n\taddScheduleItems(items, containerScheduleItems) {\n\t\titems.forEach((itemData) => {\n\t\t\tconst item = new ItemActivity(itemData);\n\n\t\t\tthis.activities.set(item.getOwnerId(), item);\n\t\t\tcontainerScheduleItems.appendChild(item.getNode());\n\t\t});\n\t}\n\n\taddItems(items) {\n\t\tlet pointerNode = this.container.firstChild;\n\t\titems.forEach((itemData) => {\n\t\t\tconst item = getItemByData(itemData);\n\t\t\tthis.items.set(item.getId(), item);\n\t\t\tif (this.activities.has(item.getOwnerId())) {\n\t\t\t\tconst activity = this.activities.get(item.getOwnerId());\n\t\t\t\tactivity.getNode().parentNode.removeChild(activity.getNode());\n\t\t\t\tactivity.solve();\n\t\t\t\tthis.activities.delete(activity.getOwnerId());\n\t\t\t}\n\t\t\tthis.container.insertBefore(item.getNode(), pointerNode);\n\t\t});\n\t}\n\n\tonNewComment({data:{comment}}: BaseEvent)\n\t{\n\t\tconst previewItem = new ItemPreview(comment);\n\t\tthis.container.appendChild(previewItem.getNode());\n\t\tcomment.item = previewItem;\n\t\tcomment.node = previewItem.getNode();\n\n\t\tlet iosPatchNeeded = false;\n\t\tif (Browser.isIOS())\n\t\t{\n\t\t\tconst res = (navigator.appVersion).match(/OS (\\d+)_(\\d+)_?(\\d+)?/);\n\t\t\tconst iOSVersion = parseInt(res[1], 10);\n\t\t\tiosPatchNeeded = (iOSVersion >= 11 && keyBoardIsShown);\n\t\t}\n\t\tconst iosPatchDelta = iosPatchNeeded ? 260 : 0;\n\n\t\tconst thumbPos = pos(previewItem.getNode());\n\t\tconst visibleTop = GetWindowInnerSize().innerHeight - iosPatchDelta;\n\n\t\tif (iosPatchNeeded === false || thumbPos.top > visibleTop)\n\t\t{\n\t\t\twindow.scrollTo(0, thumbPos.top - iosPatchDelta);\n\t\t}\n\t}\n\n\tonFailedComment({data:{comment}}: BaseEvent)\n\t{\n\t\tif (comment.item)\n\t\t{\n\t\t\tcomment.item.setError(comment.error);\n\t\t}\n\t}\n\tonSucceedComment({data:{comment, commentData, comments}}: BaseEvent)\n\t{\n\t\tconsole.log('commentData: ', commentData, comments);\n\n\t\tcomments.forEach((itemData) => {\n\t\t\tconst item = getItemByData(itemData);\n\t\t\tthis.items.set(item.getId(), item);\n\t\t\tif (this.activities.has(item.getOwnerId())) {\n\t\t\t\tconst activity = this.activities.get(item.getOwnerId());\n\t\t\t\tactivity.getNode().parentNode.removeChild(activity.getNode());\n\t\t\t\tactivity.solve();\n\t\t\t\tthis.activities.delete(activity.getOwnerId());\n\t\t\t}\n\t\t\tif (item.getId() < commentData['ID'])\n\t\t\t{\n\t\t\t\tthis.container.insertBefore(item.getNode(), comment.node);\n\t\t\t}\n\t\t\telse if (item.getId() > commentData['ID'])\n\t\t\t{\n\t\t\t\tthis.container.insertBefore(item.getNode(), comment.node.nextSibling);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcomment.node.parentNode.replaceChild(item.getNode(), comment.node);\n\t\t\t\tdelete comment.node;\n\t\t\t\tdelete comment.item;\n\t\t\t}\n\t\t});\n\n\t\tif (BXMobileApp && this.entity)\n\t\t{\n\t\t\tBXMobileApp.Events.postToComponent('onCrmCallTrackerItemCommentAdded', {\n\t\t\t\tID: this.entity.ID\n\t\t\t});\n\t\t\tBX.onCustomEvent('onCrmCallTrackerItemCommentAdded', {\n\t\t\t\tID: this.entity.ID\n\t\t\t});\n\t\t}\n\t}\n\n\tinitPagination(itemId)\n\t{\n\t\tthis.pagination = new Pagination(itemId, this.addItems.bind(this));\n\t\tthis.container.parentNode.insertBefore(this.pagination.getNode(), this.container);\n\t}\n}"],"names":["Configuration","componentName","signedParameters","currentAuthor","Backend","action","data","ajax","runComponentAction","mode","id","options","request","text","files","itemId","pageNumber","Promise","resolve","reject","navigation","page","then","Pagination","callback","pointer","busy","cache","Cache","MemoryCache","remember","Tag","render","sendPagination","bind","Loc","getMessage","has","target","getNode","appendChild","set","Loader","size","get","getLoader","show","getItemsFromPage","items","paginationHasMore","errors","hide","call","destroy","length","showErrors","arguments","finally","parentNode","removeChild","style","display","keys","forEach","key","delete","console","log","intersectionObserver","observeIntersection","entity","IntersectionObserver","entries","entry","isIntersecting","unobserve","observedCallback","setTimeout","threshold","observe","Item","renderWithDebounce","getId","join","avatarUrl","Text","encode","expand","node","querySelector","wrapper","getTextNode","startHeight","pos","height","endHeight","maxHeight","overflow","time","BX","duration","start","finish","transition","easing","makeEaseOut","transitions","quart","step","state","complete","cssText","LazyLoad","showImages","animate","getDateNode","getFilesNode","getActionNode","renderTag","Runtime","html","Type","isStringFilled","formatDate","push","getItem","errorMessages","error","message","debounce","BitrixMobile","ItemComment","Utils","timestamp","item","DAY","Math","floor","HOUR","MINUTE","SECOND","result","ii","ItemCalltracker","direction","parseInt","rawDuration","hasDuration","formatInterval","created","comment","hasStatus","status","iconClasses","CrmActivityDirection","incoming","outgoing","Vue","create","el","document","createElement","template","ItemPreview","constructor","name","itemData","count","AUTHOR_ID","AUTHOR","Date","getTime","previewObj","setAttribute","errorNode","innerHTML","ItemActivity","deadline","Entity","setEventNamespace","emit","prepare","submit","succeed","finalise","catch","err","fail","EventEmitter","File","file","counter","url","test","type","getUploadFilename","uploadTask","taskId","mimeType","MobileUtils","getFileMimeType","folderId","previewUrl","resize","getResizeOptions","toJSON","slice","replace","split","fileReceive","event","removeCustomEvent","ID","IMAGE","extra","imagePreviewUri","NAME","URL","downloadUri","EXTERNAL","PREVIEW","VALUE","isArrayFilled","code","errorMessage","errorCode","Error","addCustomEvent","BXMobileApp","onCustomEvent","Queue","queue","erroredQueue","next","check","execute","isFailed","shift","index","ent","ind","splice","isReady","subscribe","CommentSender","instance","FileSender","Comment","events","eventName","getInstance","send","fileSender","getText","fileData","createItem","map","Form","params","useAudioMessages","placeholder","onSend","onSendButtonPressed","window","MobileUI","TextField","showCommentStart","showCommentError","showCommentSucceed","UI","Page","TextPanel","setText","focus","attachedFiles","BXMPage","clear","cleanText","String","trim","success","commentData","comments","showLoading","itemMappings","getItemByData","itemClassName","itemClass","checkForPaternity","app","exec","keyBoardIsShown","Timeline","containerScheduleItems","scheduleItems","containerHistoryItems","historyItems","activities","Map","addScheduleItems","container","addItems","pagination","form","onNewComment","onFailedComment","onSucceedComment","getOwnerId","pointerNode","firstChild","activity","solve","insertBefore","previewItem","iosPatchNeeded","Browser","isIOS","res","navigator","appVersion","match","iOSVersion","iosPatchDelta","thumbPos","visibleTop","GetWindowInnerSize","innerHeight","top","scrollTo","setError","nextSibling","replaceChild","Events","postToComponent"],"mappings":"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"}