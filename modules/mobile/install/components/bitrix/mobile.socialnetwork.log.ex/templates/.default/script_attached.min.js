(function(){if(window["oMSL"])return;var e={},t={},o=function(o,i){var n=oMSL.getLogId();if(t[i.join("-")]!=="hidden"){t[i.join("-")]="hidden";if(e[n]){e[n]["POST_NUM_COMMENTS"]--;BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:n,num:e[n]["POST_NUM_COMMENTS"]},true)}}};BX.addCustomEvent(window,"OnUCommentWasDeleted",o);BX.addCustomEvent(window,"OnUCommentWasHidden",o);BX.addCustomEvent(window,"OnUCRecordHasDrawn",function(o,i){var n=oMSL.getLogId();t[o]=t[o]||{};if(t[i.join("-")]!=="drawn"){t[i.join("-")]="drawn";var a;if(e[n]&&(a=BX("record-"+i.join("-")+"-cover"))&&a&&a.parentNode==BX("record-"+o+"-new")){e[n]["POST_NUM_COMMENTS"]++;BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:n,num:e[n]["POST_NUM_COMMENTS"]},true)}}});BX.addCustomEvent(window,"OnUCFormSubmit",function(e,t,o,i){if(i&&i["mobile_action"]&&i["mobile_action"]=="add_comment"&&t>0){i["mobile_action"]=i["action"]="edit_comment";i["edit_id"]=t}});window.__MSLRepositLog=function(t,o){e[t]=o}})();function __MSLOnPostRead(e,t){if((e=BX(e))&&e&&!e.hasAttribute("done")){oMSL.setLogEntryImpPostRead({node:e,value:true});var o={mobile_action:"read_post",action:"read_post",post_id:e.getAttribute("bx-data-post-id"),options:[{post_id:e.getAttribute("bx-data-post-id"),name:"BLOG_POST_IMPRTNT",value:"Y"}],sessid:BX.bitrix_sessid()};BX.ajax({method:"GET",url:BX.message("SITE_DIR")+"mobile/index.php?"+BX.ajax.prepareData(o),dataType:"json",onsuccess:BX.delegate(function(t){if(typeof t.SUCCESS!="undefined"&&t.SUCCESS=="Y"){BXMobileApp.onCustomEvent("onLogEntryImpPostRead",{postId:o.post_id},true)}else{oMSL.setLogEntryImpPostRead({node:e,value:false})}},this),onfailure:function(){oMSL.setLogEntryImpPostRead({node:e,value:false})}});return true}return false}function __MSLOnFeedPreInit(e){if(typeof e.arAvailableGroup!="undefined"){window.arAvailableGroup=e.arAvailableGroup}BX.addCustomEvent("onFrameDataReceivedBefore",function(e){BitrixMobile.LazyLoad.clearImages()});BX.addCustomEvent("BX.LazyLoad:ImageLoaded",function(){var e=BX.GetWindowSize();window.maxScroll=e.scrollHeight-e.innerHeight-190});BX.addCustomEvent("onFrameDataReceived",function(e){window.isPullDownEnabled=false;window.isPullDownLocked=false;window.isFrameDataReceived=true;app.pullDownLoadingStop();BitrixMobile.LazyLoad.showImages(true)});BX.addCustomEvent("onFrameDataProcessed",function(e,t){if(typeof e!="undefined"&&typeof e[0]!="undefined"&&typeof t!="undefined"&&t){if(typeof e[0]["PROPS"]!="undefined"&&typeof e[0]["PROPS"]["TS"]!="undefined"&&parseInt(e[0]["PROPS"]["TS"])>0){oMSL.iframeCacheTs=parseInt(e[0]["PROPS"]["TS"])}}BitrixMobile.LazyLoad.showImages(true)});BX.addCustomEvent("onCacheDataRequestStart",function(){setTimeout(function(){if(typeof window.isFrameDataReceived=="undefined"||!window.isFrameDataReceived){window.isPullDownLocked=true;app.exec("pullDownLoadingStart")}},1e3)});BX.addCustomEvent("onFrameDataReceivedError",function(){app.BasicAuth({success:BX.delegate(function(){BX.frameCache.update(true)}),failture:BX.delegate(function(){window.isPullDownLocked=false;app.pullDownLoadingStop();__MSLRefreshError(true)})})});BX.addCustomEvent("onFrameDataRequestFail",function(e){if(typeof e!="undefined"&&typeof e.reason!="undefined"&&e.reason=="bad_eval"){window.isPullDownLocked=false;app.pullDownLoadingStop();__MSLRefreshError(true)}else{app.BasicAuth({success:BX.delegate(function(){BX.frameCache.update(true)}),failture:BX.delegate(function(){window.isPullDownLocked=false;app.pullDownLoadingStop();__MSLRefreshError(true)})})}});BX.addCustomEvent("onCacheInvokeAfter",function(e,t){var o=t.items;if(o.length<=0){BX.frameCache.update(true,true)}});BXMobileApp.addCustomEvent("onAfterEdit",function(e){oMSL.afterEdit(e.postResponseData,e.postData.data.log_id)});BX.addCustomEvent("onPullDownDisable",function(){BXMobileApp.UI.Page.Refresh.setEnabled(false)});BX.addCustomEvent("onPullDownEnable",function(){BXMobileApp.UI.Page.Refresh.setEnabled(true)});BXMobileApp.UI.Page.Refresh.setParams({callback:function(){if(!window.isPullDownLocked){__MSLRefresh(true)}},backgroundColor:"#E7E9EB"});BXMobileApp.UI.Page.Refresh.setEnabled(true)}function __MSLOnFeedInit(e){logID=parseInt(e.logID);bAjaxCall=!!e.bAjaxCall;bReload=!!e.bReload;bEmptyPage=!!e.bEmptyPage;bFiltered=!!e.bFiltered;bEmptyGetComments=!!e.bEmptyGetComments;groupID=parseInt(e.groupID);tmstmp=parseInt(e.tmstmp);strCounterType=e.strCounterType;oMSL.bFollowDefault=!!e.bFollowDefault;oMSL.groupID=parseInt(e.groupID);oMSL.ftMinTokenSize=parseInt(e.ftMinTokenSize);oMSL.bShowExpertMode=!!e.bShowExpertMode;oMSL.bExpertMode=!!e.bExpertMode;oMSL.bDetailEmptyPage=bEmptyPage;oMSL.curUrl=e.curUrl;oMSL.appCacheDebug=!!e.appCacheDebug;oMSL.pageType=logID<=0&&!bEmptyPage?"list":"detail";if(!bAjaxCall){}if(logID<=0&&!bEmptyPage&&!bAjaxCall){if(!bReload){oMSL.initSearchBar()}oMSL.listPageMenuItems=[];if(groupID>0){BX.ready(function(){oMSL.listPageMenuItems.push({id:"addPost",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_ADD_POST"),image:"/bitrix/templates/mobile_app/images/lenta/menu/pencil.png",action:function(){oMSL.initPostForm({groupId:groupID,callback:function(){app.exec("showPostForm",oMSL.showNewPostForm({groupId:groupID}))}})},arrowFlag:false});oMSL.listPageMenuItems.push({id:"groupTasks",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_GROUP_TASKS"),image:"/bitrix/templates/mobile_app/images/lenta/menu/n_check.png",icon:"checkbox",arrowFlag:true,action:function(){if(Application.getApiVersion()>=31){BXMobileApp.Events.postToComponent("taskbackground::task::action",[{groupId:groupID}],"background")}else{var e=BX.message("MSLPathToTasksRouter");e=e.replace("__ROUTE_PAGE__","list").replace("#USER_ID#",BX.message("USER_ID"));window.BXMobileApp.PageManager.loadPageUnique({url:e,bx24ModernStyle:true})}}});oMSL.listPageMenuItems.push({id:"groupFiles",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_GROUP_FILES"),image:"/bitrix/templates/mobile_app/images/lenta/menu/files.png",action:function(){app.openBXTable({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/?mobile_action=disk_folder_list&type=group&path=/&entityId="+groupID,TABLE_SETTINGS:{type:"files",useTagsInSearch:false}})},arrowFlag:true,icon:"file"});if(BX.message("MSLPathToKnowledgeGroup")){oMSL.listPageMenuItems.push({id:"knowledge",name:BX.message("MSLTitleKnowledgeGroup"),image:"/bitrix/templates/mobile_app/images/lenta/menu/knowledge_base.png",action:function(){window.BXMobileApp.PageManager.loadPageUnique({url:BX.message("MSLPathToKnowledgeGroup"),bx24ModernStyle:true,cache:false})}})}oMSL.initPageMenu("list")});setTimeout(function(){BX.MobileLivefeed.Instance.setPageId("list_group_"+groupID);BX.MobileLivefeed.Instance.setOptions({groupId:groupID})},0)}else{BX.ready(function(){setTimeout(function(){if(!bFiltered){oMSL.listPageMenuItems.push({id:"addPost",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_ADD_POST"),image:"/bitrix/templates/mobile_app/images/lenta/menu/pencil.png",action:function(){oMSL.initPostForm({groupId:groupID,callback:function(){app.exec("showPostForm",oMSL.showNewPostForm())}})},arrowFlag:false});if(BX.message("MOBILE_EXT_LIVEFEED_TASKS_INSTALLED")=="Y"||BX.message("MOBILE_EXT_LIVEFEED_TIMEMAN_INSTALLED")=="Y"){oMSL.listPageMenuItems.push({id:"presetWork",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_WORK"),image:"/bitrix/templates/mobile_app/images/lenta/menu/work.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?work=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}})}oMSL.listPageMenuItems.push({id:"presetFavorites",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_FAVORITES"),image:"/bitrix/templates/mobile_app/images/lenta/menu/favorite.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?favorites=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}});oMSL.listPageMenuItems.push({id:"presetMy",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_MY"),image:"/bitrix/templates/mobile_app/images/lenta/menu/mine.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?my=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}});oMSL.listPageMenuItems.push({id:"presetImportant",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_IMPORTANT"),image:"/bitrix/templates/mobile_app/images/lenta/menu/important.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?important=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}});if(BX.message("MOBILE_EXT_LIVEFEED_LISTS_INSTALLED")=="Y"){oMSL.listPageMenuItems.push({id:"presetBizproc",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_BIZPROC"),image:"/bitrix/templates/mobile_app/images/lenta/menu/workflow.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?bizproc=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}})}oMSL.listPageMenuItems.push({id:"refresh",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_REFRESH"),image:"/bitrix/templates/mobile_app/images/lenta/menu/n_refresh.png",arrowFlag:false,action:function(){oMSL.pullDownAndRefresh()}});if(oMSL.bUseFollow){oMSL.listPageMenuItems.push({id:"followDefault",name:oMSL.getFollowDefaultValue()?BX.message("MSLMenuItemFollowDefaultY"):BX.message("MSLMenuItemFollowDefaultN"),image:"/bitrix/templates/mobile_app/images/lenta/menu/glasses.png",arrowFlag:false,feature:"follow",action:function(){oMSL.setFollowDefault({value:!oMSL.getFollowDefaultValue()})}})}if(oMSL.bShowExpertMode){oMSL.listPageMenuItems.push({id:"expertMode",name:oMSL.bExpertMode?BX.message("MSLMenuItemExpertModeY"):BX.message("MSLMenuItemExpertModeN"),image:"/bitrix/templates/mobile_app/images/lenta/menu/expert.png",arrowFlag:false,feature:"expert",action:function(){oMSL.setExpertMode({value:!oMSL.bExpertMode})}})}oMSL.initPageMenu("list")}},1e3);BX.MobileLivefeed.Instance.setPageId("list")})}setTimeout(function(){BX.MobileLivefeed.Instance.setOptions({signedParameters:BX.type.isNotEmptyString(e.signedParameters)?e.signedParameters:{}})},0);if(!bReload){setTimeout(function(){BX.MobileLivefeed.PublicationQueueInstance.emit("onFeedReady")},0);oMSL.registerBlocksToCheck();if(typeof window.bFeedInitialized!="undefined"&&window.bFeedInitialized){BX.ready(function(){BX.MobileLivefeed.Instance.recalcMaxScroll();setTimeout(function(){oMSL.checkNodesHeight();BX.onCustomEvent(window,"BX.UserContentView.onRegisterViewAreaListCall",[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}])},1e3)});return}else{BX.ready(function(){BX.onCustomEvent(window,"BX.UserContentView.onInitCall",[{mobile:true,ajaxUrl:BX.message("MSLSiteDir")+"mobile/ajax.php",commentsContainerId:"post-comments-wrap",commentsClassName:"post-comment-wrap"}])});window.bFeedInitialized=true}window.arLikeRandomID={};window.LiveFeedID=parseInt(Math.random()*1e5);if(groupID<=0){BX.ready(function(){setTimeout(function(){if(!bFiltered){}else{BXMobileApp.UI.Page.TopBar.title.setText(BX.message("MSLLogTitle"));BXMobileApp.UI.Page.TopBar.title.setCallback("");BXMobileApp.UI.Page.TopBar.title.show()}},1e3)})}oMSL.initPostForm({groupId:groupID});BXMobileApp.addCustomEvent("onBlogPostDelete",function(e){oMSL.pullDownAndRefresh()});BX.ready(function(){if(bFiltered&&window.platform=="android"){BX.addCustomEvent("onOpenPageBefore",function(){oMSL.pullDownAndRefresh()})}});BXMobileApp.addCustomEvent("onLogEntryRead",function(e){__MSLLogEntryRead(e.log_id,e.ts,e.bPull===true||e.bPull==="YES")});BXMobileApp.addCustomEvent("onCommentsGet",function(e){if(typeof window.arLogTs["entry_"+e.log_id]!="undefined"&&window.arLogTs["entry_"+e.log_id]!=null){arLogTs["entry_"+e.log_id]=e.ts}});BXMobileApp.addCustomEvent("onLogEntryCommentAdd",function(e){oMSL.onLogEntryCommentAdd(e.log_id)});BXMobileApp.addCustomEvent("onLogEntryRatingLike",function(e){oMSL.onLogEntryRatingLike({ratingId:e.rating_id,voteAction:e.voteAction,logId:e.logId})});BXMobileApp.addCustomEvent("onLogEntryImpPostRead",function(e){if(BX("important_post_"+e.postId)){oMSL.onLogEntryImpPostRead({node:BX("important_post_"+e.postId)})}});BXMobileApp.addCustomEvent("onLogEntryFollow",function(e){oMSL.setFollow({logId:e.logId,pageId:e.pageId,bOnlyOn:typeof e.bOnlyOn!="undefined"&&e.bOnlyOn=="Y",bRunEvent:false})});BXMobileApp.addCustomEvent("onLogEntryFavorites",function(e){oMSL.onLogEntryFavorites(e.log_id,e.page_id)});BXMobileApp.addCustomEvent("onLogEntryCommentsNumRefresh",function(e){oMSL.onLogEntryCommentAdd(e.log_id,e.num)});BXMobileApp.addCustomEvent("onLogEntryPostUpdated",function(e){oMSL.onLogEntryPostUpdated(e)});BX.MobileUI.addLivefeedLongTapHandler(BX("lenta_wrapper_global"),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}}else if(bEmptyPage){window.isDetailPullDownEnabled=false;oMSL.registerEmptyBlockToCheck();BX.ready(function(){__MSLDrawDetailPage();BX.addCustomEvent("onOpenPageBefore",function(){__MSLDrawDetailPage()});BXMobileApp.addCustomEvent("onEditedPostFailed",function(){app.hidePopupLoader()});BX.MobileImageViewer.viewImageBind("post_item_top_wrap","img[data-bx-image]")});BX.MobileUI.addLivefeedLongTapHandler(BX("post_item_top_wrap"),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"});BX.MobileUI.addLivefeedLongTapHandler(BX("post-comments-wrap"),{likeNodeClass:"post-comment-control-item-like",copyItemClass:"post-comment-block",copyTextClass:"post-comment-text"})}else if(logID>0&&!bEmptyGetComments){window.isDetailPullDownEnabled=false;window.arCanUserComment={};BXMobileApp.onCustomEvent("onLogEntryRead",{log_id:logID,ts:tmstmp,bPull:false},true);BX.ready(function(){BX.MobileLivefeed.Instance.setPageId("detail_"+logID);oMSL.registerBlocksToCheck();setTimeout(function(){oMSL.checkNodesHeight()},100)});if(BX("post_item_top_wrap_"+logID)){BX.MobileUI.addLivefeedLongTapHandler(BX("post_item_top_wrap_"+logID),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}else if(BX("post_item_top_wrap")){BX.MobileUI.addLivefeedLongTapHandler(BX("post_item_top_wrap"),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}BX.MobileUI.addLivefeedLongTapHandler(BX("post-comments-wrap"),{likeNodeClass:"post-comment-control-item-like",copyItemClass:"post-comment-block",copyTextClass:"post-comment-text"})}if(!bAjaxCall&&!bReload){BX.ready(function(){BXMobileApp.addCustomEvent("onEditedPostInserted",function(e){app.hidePopupLoader();oMSL.drawDetailPageText(e);BXMobileApp.onCustomEvent("onLogEntryPostUpdated",e,true)})})}if(!bAjaxCall){BX.ready(function(){if(logID<=0&&!bEmptyPage){setTimeout(function(){BX.MobileLivefeed.Instance.recalcMaxScroll()},0);oMSL.initScroll(true);if(!bReload){BX.addCustomEvent("UIApplicationDidBecomeActiveNotification",function(e){var t=navigator.network.connection.type;if(t==Connection.UNKNOWN||t==Connection.NONE){app.pullDownLoadingStop();oMSL.initScroll(false,true)}else{__MSLPullDownInit(true,false);oMSL.initScroll(true,true)}})}if(!bFiltered&&!bReload){BXMobileApp.addCustomEvent("onUpdateSocnetCounters",oMSL.onUpdateSocnetCountersHandler);BXMobileApp.addCustomEvent("onImUpdateCounter",oMSL.onImUpdateCounterHandler);BXMobileApp.addCustomEvent("onUpdateUserCounters",oMSL.onUpdateCounterHandler)}}if(bEmptyPage||logID>0){if(window.platform!="ios"){BX.bind(window,"scroll",oMSL.onScrollDetail)}BX.addCustomEvent("UIApplicationDidBecomeActiveNotification",function(e){var t=navigator.network.connection.type;if(t==Connection.UNKNOWN||t==Connection.NONE){app.pullDownLoadingStop()}else{if(oMSL.iLastActivityDate>0){var o=Math.round((new Date).getTime()/1e3);if(o-oMSL.iLastActivityDate>1740){if(bEmptyPage){BXMobileApp.UI.Page.isVisible({callback:function(e){if(e.status=="visible"){app.getPageParams({callback:function(e){if(parseInt(e.log_id)>0){oMSL.setLogId(parseInt(e.log_id))}oMSL.getComments({ts:oMSL.iDetailTs,bPullDown:false,obFocus:{form:"NO",comments:"NO"}})}})}else{oMSL.emptyRefreshCommentsFlag=true}}})}else{document.location.reload(true)}}}}});__MSLDetailPullDownInit(true)}else{setTimeout(function(){oMSL.checkNodesHeight();BX.onCustomEvent(window,"BX.UserContentView.onRegisterViewAreaListCall",[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}])},1e3);if(logID<=0){__MSLPullDownInit(true)}}})}BXMobileApp.addCustomEvent("onHidePageBefore",function(){var e=document.getElementsByTagName("video"),t=null;for(t=0;t<e.length;t++){if(!e[t].paused){e[t].pause()}}var o=document.querySelectorAll("iframe.bx-mobile-video-frame");for(t=0;t<o.length;t++){var i=o[t].getAttribute("src");if(i){o[t].src=o[t].src}}});BX.Event.EventEmitter.subscribe("MobilePlayer:onError",oMSL.onMobilePlayerError)}function __MSLOnFeedScroll(){var e=BX.GetWindowScrollPos();if(e.scrollTop>=BX.MobileLivefeed.Instance.getMaxScroll()&&(e.scrollTop>0||BX.MobileLivefeed.Instance.getMaxScroll()>0)&&!window.bRefreshing){BX.unbind(window,"scroll",__MSLOnFeedScroll);bGettingNextPage=true;var t=new MobileAjaxWrapper;t.Wrap({type:"json",method:"GET",url:url_next,data:"",callback:function(e){nextPageXHR=null;if(typeof e!="undefined"&&typeof e.PROPS!="undefined"&&typeof e.PROPS.CONTENT!="undefined"&&e.PROPS.CONTENT.length>0&&(typeof e.LAST_TS=="undefined"||parseInt(e.LAST_TS)<=0||parseInt(BX.message("MSLFirstPageLastTS"))<=0||parseInt(e.LAST_TS)<parseInt(BX.message("MSLFirstPageLastTS")))){oMSL.processAjaxBlock(e.PROPS,{type:"next",callback:function(){BX.MobileLivefeed.Instance.recalcMaxScroll();oMSL.registerBlocksToCheck();setTimeout(BX.delegate(oMSL.checkNodesHeight,oMSL),100);BX.onCustomEvent(window,"BX.UserContentView.onRegisterViewAreaListCall",[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}])}});if(parseInt(BX.message("MSLPageNavNum"))>0&&parseInt(window.iPageNumber)>0){iPageNumber++;url_next=BX.util.remove_url_param(url_next,["PAGEN_"+BX.message("MSLPageNavNum")]);url_next+=(url_next.indexOf("?")>=0?"&":"?")+"PAGEN_"+parseInt(BX.message("MSLPageNavNum"))+"="+(iPageNumber+1)}}BX.bind(window,"scroll",__MSLOnFeedScroll);bGettingNextPage=false},callback_failure:function(){nextPageXHR=null;bGettingNextPage=false}});nextPageXHR=t.xhr}}function __MSLOpenLogEntryNew(e,t){var o=typeof e.show_full!="undefined"?!!e.show_full:false;if(typeof e.path=="undefined"||e.path==null||e.path.length<=0){return false}else{var i=e.path}if(typeof e.log_id=="undefined"||e.log_id==null||parseInt(e.log_id)<=0){return false}e.follow=BX("log_entry_follow_"+e.log_id)?BX("log_entry_follow_"+e.log_id).getAttribute("data-follow"):"Y";e.fav=BX("log_entry_favorites_"+e.log_id)&&BX("log_entry_favorites_"+e.log_id).classList.contains("lenta-item-fav-active")?"Y":"N";e.feed_id=typeof window.LiveFeedID!="undefined"?window.LiveFeedID:"";e.can_user_comment=typeof arCanUserComment!="undefined"&&typeof arCanUserComment[e.log_id]!="undefined"&&arCanUserComment[e.log_id];if(typeof t!="undefined"&&t!=null&&t&&typeof t.target!="undefined"&&t.target!=null){if(typeof t.target.tagName!="undefined"&&t.target.tagName.toLowerCase()=="a"&&!BX.hasClass(t.target,"post-item-more")){return false}var n=BX.findParent(t.target,{tag:"A"},{tag:"div",className:"post-item-post-block"});if(n){return false}}e.RandomID=typeof arLikeRandomID["entry_"+e.log_id]!="undefined"&&arLikeRandomID["entry_"+e.log_id]!=null?arLikeRandomID["entry_"+e.log_id]:false;if(BX("post_block_check_cont_"+e.log_id)){e.detailText=BX("post_block_check_cont_"+e.log_id).innerHTML;e.bIsPhoto=BX.hasClass(BX("post_block_check_cont_"+e.log_id),"post-item-post-img-block");e.bIsImportant=BX.hasClass(BX("post_block_check_cont_"+e.log_id),"info-block-important")&&BX.hasClass(BX("post_block_check_cont_"+e.log_id),"lenta-info-block")}var a=document.getElementById("lenta_item_"+e.log_id);if(a){var s=a.parentNode.querySelector("span[data-type='inline-script']");if(s){e.inlineScript=s.innerHTML}}if(BX("post_block_files_"+e.log_id)){e.filesBlockText=BX("post_block_files_"+e.log_id).innerHTML}if(BX("post_more_limiter_"+e.log_id)){e.showMoreButton=BX("post_more_limiter_"+e.log_id).style.display!="none"}if(BX("post_item_top_"+e.log_id)){e.topText=BX("post_item_top_"+e.log_id).innerHTML}if(BX("informer_comments_all_"+e.log_id)){e.commentsNumAll=BX("informer_comments_all_"+e.log_id).innerHTML;if(BX("informer_comments_new_"+e.log_id)){e.commentsNumNew=BX.findChild(BX("informer_comments_new_"+e.log_id),{className:"post-item-inform-right-new-value"},true,false).innerHTML}}else if(BX("informer_comments_"+e.log_id)){e.commentsNum=BX("informer_comments_"+e.log_id).innerHTML}if(BX("comments_control_"+e.log_id)){e.commentsControl=!!BX("comments_control_"+e.log_id)}if(BX("rating_block_"+e.log_id)){e.ratingText=BX("rating_block_"+e.log_id).innerHTML;e.ratingCounter=parseInt(BX("rating_block_"+e.log_id).getAttribute("data-counter"))}if(BX("rating-footer-wrap_"+e.log_id)){e.ratingFooter=BX("rating-footer-wrap_"+e.log_id).innerHTML}e.bShowFull=o;if(typeof window.arLogTs["entry_"+e.log_id]!="undefined"&&window.arLogTs["entry_"+e.log_id]!=null){e.TS=arLogTs["entry_"+e.log_id]}e.bSetFocusOnCommentForm=typeof e.focus_form!="undefined"?!!e.focus_form:false;e.bSetFocusOnCommentsList=typeof e.focus_comments!="undefined"?!!e.focus_comments:false;app.loadPageBlank({url:i,bx24ModernStyle:true,data:e});return typeof t!="undefined"&&t!=null&&t?t.preventDefault():false}function __MSLDrawDetailPage(){app.getPageParams({callback:function(e){BXMobileApp.onCustomEvent("onLogEntryRead",{log_id:e.log_id,ts:BX.message("MSLCurrentTime"),bPull:false},true);oMSL.drawDetailPage(e)}})}function __MSLDetailMoveBottom(){window.scrollTo(0,document.body.scrollHeight)}function __MSLDetailMoveTop(){window.scrollTo(0,0)}function __MSLLogEntryRead(e,t,o){o=!!o;if(typeof window.arLogTs["entry_"+e]!="undefined"&&window.arLogTs["entry_"+e]!=null){arLogTs["entry_"+e]=t;if(BX("informer_comments_"+e)&&BX("informer_comments_new_"+e)&&!o){var i=BX("informer_comments_all_"+e).innerHTML.length>0?parseInt(BX("informer_comments_all_"+e).innerHTML):0;var n=i+parseInt(BX.findChild(BX("informer_comments_new_"+e),{className:"post-item-inform-right-new-value"},true,false).innerHTML);BX.remove(BX("informer_comments_new_"+e));BX.remove(BX("informer_comments_all_"+e));BX("informer_comments_"+e).innerHTML=n;var a=BX("informer_comments_"+e).closest(".post-item-informers");if(a){a.classList.remove("post-item-inform-likes-active")}}}if(BX("lenta_item_"+e)){BX.removeClass(BX("lenta_item_"+e),"lenta-item-new")}}function __MSLGetHiddenDestinations(e,t,o){var i={sessid:BX.message("MSLSessid"),site:BX.message("SITE_ID"),lang:BX.message("MSLLangId"),dlim:BX.message("MSLDestinationLimit"),log_id:parseInt(e),nt:BX.message("MSLNameTemplate"),sl:BX.message("MSLShowLogin"),p_user:BX.message("MSLPathToUser"),p_group:BX.message("MSLPathToGroup"),p_crmlead:BX.message("MSLPathToCrmLead"),p_crmdeal:BX.message("MSLPathToCrmDeal"),p_crmcontact:BX.message("MSLPathToCrmContact"),p_crmcompany:BX.message("MSLPathToCrmCompany"),action:"get_more_destination",mobile_action:"get_more_destination",author_id:parseInt(t)};var n=new MobileAjaxWrapper;n.Wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",data:i,callback:function(e){if(typeof e["arDestinations"]!="undefined"){var t=e["arDestinations"];if(typeof t=="object"){if(BX(o)){var i=o.parentNode;i.removeChild(o);for(var n=0;n<t.length;n++){if(typeof t[n]["TITLE"]!="undefined"&&t[n]["TITLE"].length>0){i.appendChild(BX.create("SPAN",{html:",&nbsp;"}));if(typeof t[n]["CRM_PREFIX"]!="undefined"&&t[n]["CRM_PREFIX"].length>0){i.appendChild(BX.create("SPAN",{props:{className:"post-item-dest-crm-prefix"},html:t[n]["CRM_PREFIX"]+":&nbsp;"}))}if(typeof t[n]["URL"]!="undefined"&&t[n]["URL"].length>0){i.appendChild(BX.create("A",{props:{className:"post-item-destination"+(typeof t[n]["STYLE"]!="undefined"&&t[n]["STYLE"].length>0?" post-item-dest-"+t[n]["STYLE"]:""),href:t[n]["URL"]},html:t[n]["TITLE"]}))}else{i.appendChild(BX.create("SPAN",{props:{className:"post-item-destination"+(typeof t[n]["STYLE"]!="undefined"&&t[n]["STYLE"].length>0?" post-item-dest-"+t[n]["STYLE"]:"")},html:t[n]["TITLE"]}))}}}if(typeof e["iDestinationsHidden"]!="undefined"&&parseInt(e["iDestinationsHidden"])>0){e["iDestinationsHidden"]=parseInt(e["iDestinationsHidden"]);var a=e["iDestinationsHidden"]%100>10&&e["iDestinationsHidden"]%100<20?5:e["iDestinationsHidden"]%10;i.appendChild(BX.create("SPAN",{html:"&nbsp;"+BX.message("MSLDestinationHidden"+a).replace("#COUNT#",e["iDestinationsHidden"])}))}oMSL.checkNodesHeight()}}}},callback_failure:function(){}})}function __MSLGetNewPosts(){}function __MSLRefresh(e,t){e=!!e;if(window.bGettingNextPage&&window.nextPageXHR!=null){nextPageXHR.abort()}BX.addClass(BX("lenta_notifier"),"lenta-notifier-waiter");BX.MobileLivefeed.Instance.setRefreshNeeded(false);BX.MobileLivefeed.Instance.setRefreshStarted(true);BX.MobileLivefeed.BalloonNotifierInstance.hideRefreshNeededNotifier();BX.MobileLivefeed.NotificationBarInstance.hideAll();bRefreshing=true;var o=document.location.href;o=BX.util.remove_url_param(o,["RELOAD","RELOAD_JSON","FIND"]);o=BX.util.add_url_param(o,{RELOAD:"Y",RELOAD_JSON:"Y"});if(BX.type.isPlainObject(t)&&BX.type.isNotEmptyString(t.find)){o=BX.util.add_url_param(o,{FIND:t.find})}var i=[{name:"BX-ACTION-TYPE",value:"get_dynamic"},{name:"BX-REF",value:document.referrer},{name:"BX-CACHE-MODE",value:"APPCACHE"},{name:"BX-APPCACHE-PARAMS",value:JSON.stringify(window.appCacheVars)},{name:"BX-APPCACHE-URL",value:typeof BX.frameCache!="undefined"&&typeof BX.frameCache.vars!="undefined"&&typeof BX.frameCache.vars.PAGE_URL!="undefined"?BX.frameCache.vars.PAGE_URL:oMSL.curUrl}];var n=new MobileAjaxWrapper;n.Wrap({type:"json",method:"GET",url:o,data:"",headers:i,callback:function(t){oMSL.xhr.refresh=null;BX.MobileLivefeed.Instance.setRefreshStarted(false);BX.MobileLivefeed.Instance.setRefreshNeeded(false);BX.removeClass(BX("lenta_notifier"),"lenta-notifier-waiter");app.pullDownLoadingStop();app.exec("hideSearchBarProgress");if(typeof t!="undefined"&&typeof t.PROPS!="undefined"&&typeof t.PROPS.CONTENT!="undefined"&&t.PROPS.CONTENT.length>0){BitrixMobile.LazyLoad.clearImages();BX.clearNodeCache();app.hidePopupLoader();BX.MobileLivefeed.BalloonNotifierInstance.hideNotifier();BX.MobileLivefeed.BalloonNotifierInstance.hideRefreshNeededNotifier();if(typeof t.COUNTER_TO_CLEAR!="undefined"){BXMobileApp.onCustomEvent("onClearLFCounter",[t.COUNTER_TO_CLEAR],true);var o={counterCode:t.COUNTER_TO_CLEAR,serverTime:t.COUNTER_SERVER_TIME,serverTimeUnix:t.COUNTER_SERVER_TIME_UNIX};BXMobileApp.Events.postToComponent("onClearLiveFeedCounter",o,"communication")}oMSL.processAjaxBlock(t.PROPS,{type:"refresh",callback:function(){if(typeof BX.frameCache!="undefined"&&BX("bxdynamic_feed_refresh")&&(typeof t.REWRITE_FRAMECACHE=="undefined"||t.REWRITE_FRAMECACHE!="N")){var e={USE_BROWSER_STORAGE:true,AUTO_UPDATE:true,USE_ANIMATION:false};if(typeof t.TS!="undefined"&&parseInt(t.TS)>0){e.TS=parseInt(t.TS);oMSL.iframeCacheTs=e.TS}BX.frameCache.writeCacheWithID("framecache-block-feed",BX("bxdynamic_feed_refresh").innerHTML,parseInt(Math.random()*1e5),JSON.stringify(e))}oMSL.registerBlocksToCheck();setTimeout(function(){BitrixMobile.LazyLoad.showImages()},1e3)}});if(e){BitrixAnimation.animate({duration:1e3,start:{scroll:document.body.scrollTop},finish:{scroll:0},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function(e){window.scrollTo(0,e.scroll)},complete:function(){}})}if(t.isManifestUpdated=="1"&&!oMSL.appCacheDebug&&(window.applicationCache.status==window.applicationCache.IDLE||window.applicationCache.status==window.applicationCache.UPDATEREADY)){window.applicationCache.update()}}else{__MSLRefreshError(true)}bRefreshing=false},callback_failure:function(){oMSL.xhr.refresh=null;BX.MobileLivefeed.Instance.setRefreshStarted(false);BX.MobileLivefeed.Instance.setRefreshNeeded(false);BX.removeClass(BX("lenta_notifier"),"lenta-notifier-waiter");app.pullDownLoadingStop();app.exec("hideSearchBarProgress");__MSLRefreshError(true);bRefreshing=false}});oMSL.xhr.refresh=n.xhr}function __MSLPullDownInit(e,t){if(typeof t=="undefined"){t=true}e=!!e;if(e){if(!window.isPullDownEnabled&&t){BXMobileApp.UI.Page.Refresh.setParams({pulltext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL"),backgroundColor:"#E7E9EB",downtext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL_RELEASE"),loadtext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL_LOADING"),callback:function(){if(!window.isPullDownLocked){app.exec("hideSearchBar");__MSLRefresh(true)}}});BXMobileApp.UI.Page.Refresh.setEnabled(true)}isPullDownEnabled=true}else{BXMobileApp.UI.Page.Refresh.setEnabled(false);isPullDownEnabled=false}}function __MSLDetailPullDownInit(e){e=!!e;if(e){if(!isDetailPullDownEnabled){var t=function(){var e=true;if(e){var t=null;var o=null;if(BX("post_log_id")){t=parseInt(BX("post_log_id").getAttribute("data-log-id"));o=parseInt(BX("post_log_id").getAttribute("data-ts"))}else if(BX("lenta_wrapper")){var i=BX.findChild(BX("lenta_wrapper"),{className:"post-wrap"},true,false);if(i&&i.id.length>0){var n=i.id.match(/^lenta_item_([\d]+)$/i);if(n!=null){document.location.replace(document.location.href);isDetailPullDownEnabled=true;return}}}if(BX("post-comments-wrap")&&typeof t!=="undefined"&&t!=null){oMSL.getComments({ts:o,bPullDown:true,obFocus:{form:false}});oMSL.refreshPostDetail()}}};BXMobileApp.UI.Page.Refresh.setParams({pulltext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL"),backgroundColor:"#E7E9EB",downtext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL_RELEASE"),loadtext:BX.message("MOBILE_EXT_LIVEFEED_DETAIL_NEW_PULL_LOADING"),callback:t});BXMobileApp.UI.Page.Refresh.setEnabled(true)}isDetailPullDownEnabled=true}else{BXMobileApp.UI.Page.Refresh.setEnabled(false);isDetailPullDownEnabled=false}}function __MSLRefreshError(e){e=!!e;var t=BX("lenta_refresh_error");if(parseInt(window.refreshErrorTimeout)>0){clearTimeout(window.refreshErrorTimeout)}if(t){if(e){BX.addClass(t,"lenta-notifier-shown");BX.bind(window,"scroll",__MSLRefreshErrorScroll)}else{BX.unbind(window,"scroll",__MSLRefreshErrorScroll);BX.removeClass(t,"lenta-notifier-shown")}}else{window.refreshErrorTimeout=setTimeout(function(){__MSLRefreshError(e)},500)}}function __MSLRefreshErrorScroll(){__MSLRefreshError(false)}function __MSLSetFavorites(e,t){if(!t){t=BX("log_entry_favorites_"+e)}if(!BX(t)){return}var o=t.getAttribute("data-favorites")=="Y"?"Y":"N";var i=o=="Y"?"N":"Y";if(t.classList.contains("lenta-item-fav")){if(o=="Y"){BX.removeClass(t,"lenta-item-fav-active")}else{BX.addClass(t,"lenta-item-fav-active")}}t.setAttribute("data-favorites",i);var n=new MobileAjaxWrapper;n.runAction("socialnetwork.api.livefeed.changeFavorites",{data:{logId:e,value:i},analyticsLabel:{b24statAction:i=="Y"?"addFavorites":"removeFavorites",b24statContext:"mobile"}}).then(function(t){if(t.data.success){if(i=="Y"){oMSL.setFollow({logId:e,bOnlyOn:true,bRunEvent:true,bAjax:false})}BXMobileApp.onCustomEvent("onLogEntryFavorites",{log_id:e,page_id:BX.message("MSLPageId")!=undefined?BX.message("MSLPageId"):""},true)}},function(e){});return false}function showHiddenDestination(e,t){BX.hide(t);BX("blog-destination-hidden-"+e).style.display="inline"}function commonNativeInputCallback(e,t){if(window.entryType=="blog"){blogCommentsNativeInputCallback({text:e,oPreviewComment:null,commentId:t})}else if(window.entryType=="non-blog"&&typeof t=="undefined"){commentsNativeInputCallback({text:e})}}function blogCommentsNativeInputCallback(e){var t=typeof e.text!="undefined"?BX.util.htmlspecialchars(e.text):"";var o=typeof e.oPreviewComment!="undefined"?e.oPreviewComment:null;var i=typeof e.commentId!="undefined"?e.commentId:0;var n=typeof e.nodeId!="undefined"?e.nodeId:"";var a=typeof e.ufCode!="undefined"?e.ufCode:false;var s=typeof e.attachedFiles!="undefined"?e.attachedFiles:false;var r=typeof e.attachedFilesRaw!="undefined"?e.attachedFilesRaw:false;if(t.length==0){return}var l={sessid:BX.bitrix_sessid(),comment_post_id:commentVarBlogPostID,act:"add",post:"Y",comment:oMSL.parseMentions(t),decode:"Y"};if(commentVarAction){l.ACTION=commentVarAction}if(commentVarEntityTypeID){l.ENTITY_TYPE_ID=commentVarEntityTypeID}if(commentVarEntityID){l.ENTITY_ID=commentVarEntityID}if(a&&s){l[a]=s}if(r){l.attachedFilesRaw=r}if(typeof i!="undefined"&&parseInt(i)>0){l.act="edit";l.edit_id=parseInt(i);n=typeof n!="undefined"?n:""}if(l.act=="add"&&(typeof o=="undefined"||o===null)){o=oMSL.showPreviewComment(t);app.clearInput()}else if(l.act=="edit"&&BX(n)){oMSL.showCommentWait({nodeId:n,status:true});var d=BX.findChild(BX(n),{className:"post-comment-text"},true,false);if(d){d.innerHTML=t.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(e,t,o){return o})}app.clearInput()}var p=new MobileAjaxWrapper;p.Wrap({type:"json",method:"POST",url:commentVarURL,data:l,processData:true,callback:function(e){if(typeof e=="object"&&typeof e.TEXT!="undefined"){response=e.TEXT}if(typeof response!="undefined"&&response!="*"&&response.length>0){if(l.act=="add"){oMSL.showNewComment({commentId:typeof e.COMMENT_ID!="undefined"?parseInt(e.COMMENT_ID):0,text:response,bClearForm:false,oPreviewComment:o,bShowImages:false});oMSL.parseAndExecCode(response);__MSLDetailMoveBottom();oMSL.setFollow({logId:oMSL.getLogId(),bOnlyOn:true})}else{oMSL.showNewComment({text:response,bClearForm:false,oPreviewComment:BX(n),bReplace:true,bIncrementCounters:false,bShowImages:false});oMSL.parseAndExecCode(response)}}else{oMSL.showCommentAlert({nodeId:l.act=="add"?o:n,action:l.act,text:t,commentType:"blog",callback:function(){blogCommentsNativeInputCallback({text:t,oPreviewComment:l.act=="add"?o:n,commentId:l.act=="add"?false:i})}})}},callback_failure:function(){oMSL.showCommentAlert({nodeId:l.act=="add"?o:n,action:l.act,text:t,commentType:"blog",callback:function(){blogCommentsNativeInputCallback({text:t,oPreviewComment:l.act=="add"?o:n,commentId:l.act=="add"?false:i})}})}})}function commentsNativeInputCallback(e){var t=typeof e.text!="undefined"?BX.util.htmlspecialchars(e.text):"";var o=typeof e.oPreviewComment!="undefined"?e.oPreviewComment:null;var i=typeof e.commentId!="undefined"?e.commentId:0;var n=typeof e.nodeId!="undefined"?e.nodeId:"";var a=typeof e.ufCode!="undefined"?e.ufCode:false;var s=typeof e.attachedFiles!="undefined"?e.attachedFiles:false;var r=typeof e.attachedFilesRaw!="undefined"?e.attachedFilesRaw:false;if(t.length==0){return}var l={sessid:BX.bitrix_sessid(),site:commentVarSiteID,lang:commentVarLanguageID,log_id:commentVarLogID,message:oMSL.parseMentions(t),as:commentVarAvatarSize,nt:commentVarNameTemplate,sl:commentVarShowLogin,dtf:commentVarDateTimeFormat,p_user:commentVarPathToUser,rt:commentVarRatingType,action:"add_comment",mobile_action:"add_comment",sr:BX.message("MSLShowRating")};if(a&&s){l[a]=s}if(r){l.attachedFilesRaw=r}if(typeof i!="undefined"&&parseInt(i)>0){l.action="edit_comment";l.mobile_action="edit_comment";l.edit_id=parseInt(i);n=typeof n!="undefined"?n:""}if(l.action=="add_comment"&&(typeof o=="undefined"||o===null)){o=oMSL.showPreviewComment(t);app.clearInput()}else if(l.action=="edit_comment"&&BX(n)){oMSL.showCommentWait({nodeId:n,status:true});var d=BX.findChild(BX(n),{className:"post-comment-text"},true,false);if(d){d.innerHTML=t.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(e,t,o){return o})}app.clearInput()}var p=new MobileAjaxWrapper;p.Wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",data:l,callback:function(e){if(typeof e["arCommentFormatted"]!="undefined"){if(l.action=="add_comment"){oMSL.showNewComment({commentId:parseInt(e["commentID"]),arComment:e["arCommentFormatted"],oPreviewComment:o,bClearForm:true});__MSLDetailMoveBottom();oMSL.setFollow({logId:l.log_id,bOnlyOn:true})}else{oMSL.showNewComment({arComment:e["arCommentFormatted"],oPreviewComment:BX(n),bIncrementCounters:false,bReplace:true})}}else{oMSL.alertPreviewComment({nodeId:o?o:n,text:t,commentType:"log",commentId:i,action:l.action,callback:function(){commentsNativeInputCallback({text:t,oPreviewComment:o,commentId:i,nodeId:n})}})}},callback_failure:function(){oMSL.alertPreviewComment({nodeId:o?o:n,text:t,commentType:"log",commentId:i,action:l.action,callback:function(){commentsNativeInputCallback({text:t,oPreviewComment:o,commentId:i,nodeId:n})}})}})}__MSLSendError=function(e,t,o){var i=new MobileAjaxWrapper;i.runAction("socialnetwork.api.livefeed.mobileLogError",{data:{message:e,url:t,lineNumber:o}}).then(function(e){},function(e){})};__MSLSendErrorEval=function(e){BX.evalGlobal("try { "+e+" } catch (e) { __MSLSendError(e.message, e.name, e.number); }")};BitrixMSL=function(){this.scriptsAttached=[];this.counterTimeout=null;this.detailPageId="";this.logId=false;this.commentsType=false;this.entityXMLId="";this.commentTextCurrent="";this.arMention=[];this.bUseFollow=true;this.bFollow=true;this.bFollowDefault=true;this.bShowExpertMode=true;this.bExpertMode=false;this.detailPageMenuItems=[];this.listPageMenuItems=[];this.bKeyboardCaptureEnabled=false;this.keyboardShown=null;this.arBlockToCheck={};this.iLastActivityDate=null;this.iDetailTs=0;this.iframeCacheTs=0;this.newPostFormParams={};this.newPostFormExtraData={};this.arRatingLikeProcess={};this.bDetailEmptyPage=null;this.bCounterReceived=false;this.counterValue=0;this.blocksToCheckRegisteredList=[];this.menuData={};this.showScrollButtonTimeout=null;this.showScrollButtonBottom=false;this.showScrollButtonTop=false;this.canCheckScrollButton=true;this.windowSize=null;this.emptyRefreshCommentsFlag=false;this.detailPageFocus=null;this.emptyCommentsXhr=null;this.classes={postItemBlockFull:"post-item-post-block-full"};this.findTextMode=false;this.xhr={refresh:null}};BitrixMSL.prototype.setLogId=function(e){this.logId=parseInt(data.log_id)};BitrixMSL.prototype.getLogId=function(){return parseInt(this.logId)};BitrixMSL.prototype.setFollowValue=function(e){this.bFollow=!!e};BitrixMSL.prototype.getFollowValue=function(){return this.bFollow};BitrixMSL.prototype.setFollowDefaultValue=function(e){this.bFollowDefault=!!e};BitrixMSL.prototype.getFollowDefaultValue=function(){return this.bFollowDefault};BitrixMSL.prototype.registerScripts=function(e){if(!BX.util.in_array(e,this.scriptsAttached)){this.scriptsAttached.push(e)}};BitrixMSL.prototype.loadScripts=function(){for(var e=0;e<this.scriptsAttached.length;e++){BX.loadScript(this.scriptsAttached[e]+"?"+parseInt(Math.random()*1e5))}};BitrixMSL.prototype.pullDownAndRefresh=function(e){app.exec("pullDownLoadingStart");window.isPullDownLocked=true;__MSLRefresh(true,e)};BitrixMSL.prototype.shareBlogPost=function(e){};BitrixMSL.prototype.deleteBlogPost=function(e){app.confirm({title:BX.message("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_TITLE"),text:BX.message("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_DESCRIPTION"),buttons:[BX.message("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_BUTTON_OK"),BX.message("MOBILE_EXT_LIVEFEED_DELETE_CONFIRM_BUTTON_CANCEL")],callback:function(t){if(t==1){app.showPopupLoader({text:""});var o=BX.message("MSLSiteDir")+"mobile/ajax.php";o=BX.util.add_url_param(o,{b24statAction:"deleteBlogPost",b24statContext:"mobile"});var i=new MobileAjaxWrapper;i.Wrap({type:"json",method:"POST",url:o,data:{action:"delete_post",mobile_action:"delete_post",sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("LANGUAGE_ID"),post_id:e.post_id},processData:true,callback:function(e){app.hidePopupLoader();if(BX.type.isNotEmptyString(e.SUCCESS)&&e.SUCCESS=="Y"){BXMobileApp.onCustomEvent("onBlogPostDelete",{},true,true);app.closeController({drop:true})}},callback_failure:function(){app.hidePopupLoader()}});return false}}})};BitrixMSL.prototype.getBlogPostData=function(e,t){e=parseInt(e);var o={};if(e>0){app.showPopupLoader();var i=new MobileAjaxWrapper;i.Wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",processData:true,data:{action:"get_blog_post_data",mobile_action:"get_blog_post_data",sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("LANGUAGE_ID"),post_id:e,nt:BX.message("MSLNameTemplate"),sl:BX.message("MSLShowLogin")},callback:function(i){app.hidePopupLoader();o.id=e;if(typeof i.log_id!="undefined"&&parseInt(i.log_id)>0){o.log_id=i.log_id}if(typeof i.post_user_id!="undefined"&&parseInt(i.post_user_id)>0){o.post_user_id=i.post_user_id}if(typeof i.PostPerm!="undefined"){o.PostPerm=i.PostPerm}if(typeof i.PostDestination!="undefined"){o.PostDestination=i.PostDestination}if(typeof i.PostDestinationHidden!="undefined"){o.PostDestinationHidden=i.PostDestinationHidden}if(typeof i.PostDetailText!="undefined"){o.PostDetailText=i.PostDetailText}if(typeof i.PostFiles!="undefined"){o.PostFiles=i.PostFiles}if(typeof i.PostUFCode!="undefined"){o.PostUFCode=i.PostUFCode}t(o)},callback_failure:function(){app.hidePopupLoader()}})}};BitrixMSL.prototype.getCommentData=function(e,t){var o=typeof e.commentType!="undefined"&&e.commentType=="blog"?"blog":"log";var i=typeof e.commentId!="undefined"?parseInt(e.commentId):0;var n={};if(i>0&&typeof e.postId!="undefined"&&parseInt(e.postId)>0){app.showPopupLoader();var a={action:"get_comment_data",sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("LANGUAGE_ID")};if(o=="blog"){a.mobile_action="get_blog_comment_data";a.comment_id=i;a.post_id=parseInt(e.postId)}else{a.mobile_action="get_log_comment_data";a.cid=i;a.log_id=parseInt(e.postId)}var s=new MobileAjaxWrapper;s.Wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",processData:true,data:a,callback:function(e){app.hidePopupLoader();n.id=i;if(typeof e.CommentCanEdit!="undefined"){n.CommentCanEdit=e.CommentCanEdit}if(typeof e.CommentDetailText!="undefined"){n.CommentDetailText=e.CommentDetailText}if(typeof e.CommentFiles!="undefined"){n.CommentFiles=e.CommentFiles}if(typeof e.CommentUFCode!="undefined"){n.CommentUFCode=e.CommentUFCode}t(n)},callback_failure:function(){app.hidePopupLoader()}})}};BitrixMSL.prototype.editBlogPost=function(e){this.getBlogPostData(e.post_id,function(t){oMSL.newPostFormParams={};if(typeof t.PostPerm!="undefined"&&t.PostPerm>="W"){var o={a_users:[],b_groups:[]};oMSL.setPostFormExtraDataArray({postId:e.post_id,postAuthorId:t.post_user_id,logId:t.log_id});if(typeof t.PostDetailText!="undefined"){oMSL.setPostFormParams({messageText:t.PostDetailText})}if(typeof t.PostDestination!="undefined"){for(var i in t.PostDestination){if(t.PostDestination.hasOwnProperty(i)){if(t.PostDestination[i]["STYLE"]!="undefined"&&t.PostDestination[i]["STYLE"]=="all-users"){oMSL.addPostFormDestination(o,{type:"UA"})}else if(t.PostDestination[i]["TYPE"]!="undefined"&&t.PostDestination[i]["TYPE"]=="U"){oMSL.addPostFormDestination(o,{type:"U",id:t.PostDestination[i]["ID"],name:BX.util.htmlspecialcharsback(t.PostDestination[i]["TITLE"])})}else if(t.PostDestination[i]["TYPE"]!="undefined"&&t.PostDestination[i]["TYPE"]=="SG"){oMSL.addPostFormDestination(o,{type:"SG",id:t.PostDestination[i]["ID"],name:BX.util.htmlspecialcharsback(t.PostDestination[i]["TITLE"])})}}}}if(typeof t.PostDestinationHidden!="undefined"){oMSL.setPostFormExtraData({hiddenRecipients:t.PostDestinationHidden})}oMSL.setPostFormParams({selectedRecipients:o});if(typeof t.PostFiles!="undefined"){oMSL.setPostFormParams({messageFiles:t.PostFiles})}if(typeof t.PostUFCode!="undefined"){oMSL.setPostFormExtraData({messageUFCode:t.PostUFCode})}app.exec("showPostForm",oMSL.showNewPostForm())}})};BitrixMSL.prototype.drawDetailPage=function(e){var t=false;BX.MobileLivefeed.Instance.setPageId("detail_"+e.log_id);if(BX("post_log_id")){var o=parseInt(BX("post_log_id").getAttribute("data-log-id"))}if(typeof o==="undefined"||o!=e.log_id){app.clearInput()}if(BX("post_log_id")){if(typeof o!=="undefined"&&o==e.log_id){t=true}else{BX("post_log_id").setAttribute("data-log-id",e.log_id);BX("post_log_id").setAttribute("data-ts",e.TS);BX.message({MSLLogId:e.log_id})}}var i=false;window.entryType=e.entry_type;oMSL.InitDetail({commentsType:e.entry_type=="blog"?"blog":"log",detailPageId:(e.entry_type=="blog"?"blog":"log")+"_"+(e.entry_type=="blog"?e.post_id:e.log_id),logId:e.log_id,entityXMLId:e.entity_xml_id,bUseFollow:typeof e.use_follow=="undefined"||e.use_follow!="NO",bFollow:typeof e.follow=="undefined"||e.follow!="N",feed_id:typeof e.feed_id!="undefined"?e.feed_id:null,entryParams:{destinations:typeof e.destinations!="undefined"?e.destinations:null,post_perm:typeof e.post_perm!="undefined"?e.post_perm:null,post_id:typeof e.post_id!="undefined"?e.post_id:null,post_content_type_id:BX.type.isNotEmptyString(e.post_content_type_id)?e.post_content_type_id:null,post_content_id:BX.type.isNotEmptyString(e.post_content_id)?e.post_content_id:null},TS:typeof e.TS!="undefined"?e.TS:null,readOnly:e.read_only!="undefined"?e.read_only:"N"});if(oMSL.emptyCommentsXhr){oMSL.emptyCommentsXhr.abort()}if(typeof e.commentsNumAll!="undefined"||typeof e.commentsNum!="undefined"){i=true}if(BX("comments_control")){BX("comments_control").style.display=typeof e.commentsControl!="undefined"&&e.commentsControl=="YES"?"inline-block":"none"}if(!t){if(typeof e.ratingText!="undefined"){if(BX("rating-footer-wrap")){if(typeof e.ratingFooter!="undefined"){oMSL.drawRatingFooter(e.ratingFooter)}else{BX("rating-footer-wrap").innerHTML=""}BX("rating-footer-wrap").style.display="block"}if(BX("rating_text")){if(typeof e.ratingCounter!="undefined"){BX("rating_text").setAttribute("data-counter",parseInt(e.ratingCounter))}if(BX.type.isNotEmptyString(e.ratingText)){BX("rating_text").innerHTML=e.ratingText;BX("rating_text").style.display="inline-block"}else{BX("rating_text").style.display="none"}}i=true;oMSL.parseAndExecCode(e.ratingText,0);BX.message({RVRunEvent:"Y"})}else{if(BX("rating-footer-wrap")){if(typeof e.ratingFooter!="undefined"){oMSL.drawRatingFooter(e.ratingFooter)}else{BX("rating-footer-wrap").innerHTML=""}BX("rating-footer-wrap").style.display="none"}if(BX("rating_button_cont")){BX("rating_button_cont").style.display="none"}if(BX("rating_text")){BX("rating_text").style.display="none"}}}if(BX("log_entry_follow")){if(typeof e.use_follow!="undefined"&&e.use_follow=="N"||typeof e.follow=="undefined"){BX.unbindAll(BX("log_entry_follow"));BX("log_entry_follow").style.display="none"}else{i=true;BX.removeClass(BX("log_entry_follow"),e.follow=="N"?"post-item-follow-active":"post-item-follow");BX.addClass(BX("log_entry_follow"),e.follow=="N"?"post-item-follow":"post-item-follow-active");BX("log_entry_follow").setAttribute("data-follow",e.follow=="N"?"N":"Y");BX.unbindAll(BX("log_entry_follow"));BX.bind(BX("log_entry_follow"),"click",function(){oMSL.setFollow({logId:e.log_id,bAjax:true,bRunEvent:false})})}}if(i){BX.removeClass(BX("lenta_item"),"post-without-informers")}else{BX.addClass(BX("lenta_item"),"post-without-informers")}if(BX("post_item_top_wrap")&&!this.getFollowDefaultValue()){if(typeof e.follow!="undefined"&&e.follow=="Y"){BX.addClass(BX("post_item_top_wrap"),"post-item-follow")}else{BX.removeClass(BX("post_item_top_wrap"),"post-item-follow")}}if(t&&BX.type.isNotEmptyString(e.fav)&&BX("log_entry_favorites_"+e.log_id)){if(e.fav=="Y"){BX("log_entry_favorites_"+e.log_id).classList.add("lenta-item-fav-active")}else{BX("log_entry_favorites_"+e.log_id).classList.remove("lenta-item-fav-active")}}if(!t){if(BX("post-comments-wrap")){BX.cleanNode(BX("post-comments-wrap"))}this.drawDetailPageText(e);var n=BX.findChild(BX("post_block_check_cont"),{className:"post-more-block"},true,false);if(n&&BX("post_more_limiter")){if(typeof e.showMoreButton!="undefined"&&e.showMoreButton=="YES"){BX("post_more_limiter").style.display="block";BX.bind(BX("post_more_limiter"),"click",function(){oMSL.expandText(e.log_id)})}else{BX("post_more_limiter").style.display="none"}}if(e.bShowFull==="YES"){BX("post_block_check_cont").className=oMSL.classes.postItemBlockFull;if(BX("post_more_block_"+e.log_id)){BX("post_more_block_"+e.log_id).style.display="none"}if(BX("post_block_check_more_"+e.log_id)){BX("post_block_check_more_"+e.log_id).style.display="none"}BX("post_more_limiter").style.display="none";BitrixMobile.LazyLoad.showImages(false)}else{BX("post_block_check_cont").className=e.bIsPhoto=="YES"?"post-item-post-img-block":"post-item-post-block"}if(e.bIsImportant=="YES"){BX.addClass(BX("post_block_check_cont"),"lenta-info-block");BX.addClass(BX("post_block_check_cont"),"info-block-important")}else{BX.removeClass(BX("post_block_check_cont"),"lenta-info-block");BX.removeClass(BX("post_block_check_cont"),"info-block-important")}if(e.bSetFocusOnCommentForm!="YES"&&e.bSetFocusOnCommentsList!="YES"){__MSLDetailMoveTop()}if(BX("post-comments-form-wrap")){if(e.can_user_comment!=="YES"){if(BX("empty_page_bottom_margin")){BX("empty_page_bottom_margin").style.display="none"}app.hideInput()}}}if(e.bSetFocusOnCommentForm=="YES"){oMSL.detailPageFocus="form"}else if(e.bSetFocusOnCommentsList=="YES"){oMSL.detailPageFocus="list"}else if(e.bSetFocusOnCommentsList=="YES"){oMSL.detailPageFocus=null}if(BX("post-comments-wrap")&&(!t||oMSL.emptyRefreshCommentsFlag)){oMSL.getComments({ts:e.TS,bPullDown:false,bPullDownTop:false,obFocus:{form:e.bSetFocusOnCommentForm,comments:e.bSetFocusOnCommentsList}});oMSL.emptyRefreshCommentsFlag=false}oMSL.adjustDetailPageFocus();BX.removeAllCustomEvents("main.post.form/mobile_simple");BX.addCustomEvent("main.post.form/mobile_simple",function(){setTimeout(oMSL.adjustDetailPageFocus,150)})};BitrixMSL.prototype.adjustDetailPageFocus=function(){if(oMSL.detailPageFocus){oMSL.setFocusOnComments(oMSL.detailPageFocus)}};BitrixMSL.prototype.drawDetailPageText=function(e){var t="";var o=typeof e.logID!="undefined"?parseInt(e.logID):0;var i=o&&BX("post_block_check_cont_"+o)?BX("post_block_check_cont_"+o):BX("post_block_check_cont");var n=o&&BX("post_item_top_"+o)?BX("post_item_top_"+o):BX("post_item_top");var a=o&&BX("post_block_files_"+o)?BX("post_block_files_"+o):BX("post_block_files");if(i||a){BitrixMobile.LazyLoad.clearImages()}if(i){i.innerHTML="";if(BX.type.isNotEmptyString(e.detailText)){i.innerHTML=e.detailText;if(BX.type.isNotEmptyString(e.inlineScript)){i.innerHTML+=e.inlineScript}t+=oMSL.parseAndExecCode(i.innerHTML,0,false,true)}}if(a){a.innerHTML="";if(BX.type.isNotEmptyString(e.filesBlockText)){a.innerHTML=e.filesBlockText;t+=oMSL.parseAndExecCode(e.filesBlockText,0,false,true)}}if(n){n.innerHTML="";if(typeof e.topText!=="undefined"){n.innerHTML=e.topText;t+=oMSL.parseAndExecCode(e.topText,0,false,true)}}setTimeout(function(){__MSLSendErrorEval(t);BitrixMobile.LazyLoad.showImages();if(BX.message("MSLLoadScriptsNeeded")=="Y"&&typeof oMSL==="object"){oMSL.loadScripts()}},0)};BitrixMSL.prototype.onLogEntryPostUpdated=function(e){var t="";if(typeof e.logID!=="undefined"){if(typeof e.detailText!=="undefined"&&BX("post_block_check_cont_"+parseInt(e.logID))){BX("post_block_check_cont_"+parseInt(e.logID)).innerHTML=e.detailText;t+=oMSL.parseAndExecCode(e.detailText,0,false,true)}if(typeof e.filesBlockText!=="undefined"&&BX("post_block_files_"+parseInt(e.logID))){BX("post_block_files_"+parseInt(e.logID)).innerHTML=e.filesBlockText;t+=oMSL.parseAndExecCode(e.filesBlockText,0,false,true)}if(typeof e.topText!=="undefined"&&BX("post_item_top_"+parseInt(e.logID))){BX("post_item_top_"+parseInt(e.logID)).innerHTML=e.topText;t+=oMSL.parseAndExecCode(e.topText,0,false,true)}setTimeout(function(){__MSLSendErrorEval(t);BitrixMobile.LazyLoad.showImages();if(BX.message("MSLLoadScriptsNeeded")=="Y"&&typeof oMSL==="object"){oMSL.loadScripts()}},0)}};BitrixMSL.prototype.changeCounter=function(e,t,o){if(this.counterTimeout!==null){clearTimeout(this.counterTimeout);this.counterTimeout=null}t=typeof t!="undefined"?parseInt(t):0;o=typeof o!="undefined"?parseInt(o):0;var i=t>0?t:o>0?o:0;this.counterValue=e;if(parseInt(oMSL.counterValue)>0){BX.MobileLivefeed.BalloonNotifierInstance.showNotifier({counterValue:oMSL.counterValue})}else{this.counterTimeout=setTimeout(function(){if(i>oMSL.iframeCacheTs){BX.MobileLivefeed.Instance.setRefreshNeeded(true)}if(BX.MobileLivefeed.Instance.getRefreshNeeded()&&!BX.MobileLivefeed.Instance.getRefreshStarted()){BX.MobileLivefeed.BalloonNotifierInstance.showRefreshNeededNotifier()}else{BX.MobileLivefeed.BalloonNotifierInstance.hideNotifier()}clearTimeout(oMSL.counterTimeout)},2e3)}};BitrixMSL.prototype.editComment=function(e){commentType=typeof e.commentType=="undefined"?"log":e.commentType;postId=typeof e.postId=="undefined"?0:parseInt(e.postId);nodeId=typeof e.nodeId=="undefined"?"":e.nodeId;if(typeof e.commentText!="string"&&typeof e.commentText!="number"||e.commentText.length<=0||parseInt(e.commentId)<=0){return}this.getCommentData({commentType:commentType,commentId:e.commentId,postId:postId},function(t){oMSL.newPostFormParams={};if(typeof t.CommentCanEdit!="undefined"&&t.CommentCanEdit=="Y"){oMSL.setPostFormExtraDataArray({commentId:e.commentId,commentType:commentType,postId:postId,nodeId:nodeId});if(typeof t.CommentDetailText!="undefined"){oMSL.setPostFormParams({messageText:t.CommentDetailText})}if(typeof t.CommentFiles!="undefined"){oMSL.setPostFormParams({messageFiles:t.CommentFiles})}if(typeof t.CommentUFCode!="undefined"){oMSL.setPostFormExtraData({messageUFCode:t.CommentUFCode})}app.exec("showPostForm",oMSL.showNewPostForm({entityType:"comment"}))}})};BitrixMSL.prototype.deleteComment=function(e){if(parseInt(e.commentId)<=0){return}var t=typeof e.commentType=="undefined"?"log":e.commentType,o=typeof e.nodeId=="undefined"?"":e.nodeId;oMSL.showCommentWait({nodeId:o,status:true});BXMobileApp.UI.Page.TextPanel.clear();var i=false;if(t=="blog"){i=new MobileAjaxWrapper;i.Wrap({type:"html",method:"GET",url:commentVarURL+"&sessid="+BX.bitrix_sessid()+"&delete_comment_id="+e.commentId,data:"",callback:function(i){if(i!="*"&&i.length>0){oMSL.hideComment(BX(o),t)}else{oMSL.showCommentAlert({nodeId:o,action:"delete",commentType:t,callback:function(){oMSL.deleteComment({commentId:e.commentId,commentType:t,nodeId:o})}})}},callback_failure:function(){oMSL.showCommentAlert({nodeId:o,action:"delete",commentType:t,callback:function(){oMSL.deleteComment({commentId:e.commentId,commentType:t,nodeId:o})}})}})}else{var n={sessid:BX.bitrix_sessid(),site:commentVarSiteID,lang:commentVarLanguageID,log_id:oMSL.getLogId(),delete_id:e.commentId,action:"delete_comment",mobile_action:"delete_comment"};i=new MobileAjaxWrapper;i.Wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",data:n,callback:function(i){if(i["commentID"]!="undefined"&&parseInt(i["commentID"])>0&&parseInt(i["commentID"])==e.commentId){oMSL.hideComment(BX(o),t)}else{oMSL.showCommentAlert({nodeId:o,action:"delete",commentType:t,callback:function(){oMSL.deleteComment({commentId:e.commentId,commentType:t,nodeId:o})}})}},callback_failure:function(){oMSL.showCommentAlert({nodeId:o,action:"delete",commentType:t,callback:function(){oMSL.deleteComment({commentId:e.commentId,commentType:t,nodeId:o})}})}})}};BitrixMSL.prototype.hideComment=function(e,t){t=typeof t=="undefined"?"log":t;BX.cleanNode(e,true);var o=t=="blog"?BX.message("SBPClogID"):0;var i=0;var n=false;if(BX("informer_comments_"+o)){i=BX("informer_comments_"+o).innerHTML.length>0?parseInt(BX("informer_comments_"+o).innerHTML):0;if(i>0){n=i-1;BX("informer_comments_"+o).innerHTML=n>0?n:""}}else if(BX("informer_comments_common")){i=BX("informer_comments_common").innerHTML.length>0?parseInt(BX("informer_comments_common").innerHTML):0;if(i>0){n=i-1;BX("informer_comments_common").innerHTML=n>0?n:""}}else if(BX("informer_comments")){i=BX("informer_comments").innerHTML.length>0?parseInt(BX("informer_comments").innerHTML):0;if(i>0){n=i-1;BX("informer_comments").innerHTML=n>0?n:""}}if(BX("comcntleave-all")){i=BX("comcntleave-all").innerHTML.length>0?parseInt(BX("comcntleave-all").innerHTML):0;if(i>0){n=i-1;if(n>0){BX("comcntleave-all").innerHTML=n}else{BX("comcntleave-all").style.dusplay="none"}}}if(BX("comcntleave-old")){i=BX("comcntleave-old").innerHTML.length>0?parseInt(BX("comcntleave-old").innerHTML):0;if(i>0){n=i-1;if(n>0){BX("comcntleave-old").innerHTML=n}else{BX("comcntleave-old").style.dusplay="none"}}}if(n!==false){BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:o,num:n},true)}};BitrixMSL.prototype.createCommentInputForm=function(e){BXMobileApp.UI.Page.TextPanel.setParams(e);BXMobileApp.UI.Page.TextPanel.clear();BXMobileApp.UI.Page.TextPanel.show()};BitrixMSL.prototype.parseAndExecCode=function(e,t,o,i){if(typeof e!="string"||e.length<=0){return}t=typeof t=="undefined"?500:parseInt(t);o=typeof o=="undefined"?true:!!o;i=!!i;var n=BX.processHTML(e);var a="";if(n!=null&&n.SCRIPT!=null&&typeof n.SCRIPT!="undefined"){for(var s=0;s<n.SCRIPT.length;s++){if(n.SCRIPT[s].isInternal){a+=";"+n.SCRIPT[s].JS}}if(o&&a.length>0){setTimeout(function(){__MSLSendErrorEval(a)},t)}}return i?a:false};BitrixMSL.prototype.replaceUserPath=function(e){if(typeof e!="string"||e.length<=0){return}if(BX("MSLIsExtranetSite")=="Y"){e=e.replace("/mobile/users/?user_id=",BX.message("MSLExtranetSiteDir")+"mobile/users/?user_id=")}else{e=e.replace(BX.message("MSLExtranetSiteDir")+"mobile/users/?user_id=","/mobile/users/?user_id=")}e=e.replace(new RegExp('[\\w/]+/personal/user/(\\d+)/"',"igm"),BX("MSLIsExtranetSite")=="Y"?BX.message("MSLExtranetSiteDir")+'mobile/users/?user_id=$1"':'/mobile/users/?user_id=$1"');return e};BitrixMSL.prototype.createCommentMenu=function(e,t,o){BX.bind(e,"click",function(i){i=i||window.event;if(i.target.tagName.toUpperCase()=="A"){return false}var n=BX.findParent(i.target,{tag:"A"},{tag:"DIV",className:"post-comment-text"});if(n){return false}var a=[];a.push({title:BX.message("MSLReply"),callback:function(){oMSL.replyToComment(t["EVENT"]["USER_ID"],BX.util.htmlspecialcharsback(t["CREATED_BY"]["FORMATTED"]))}});if(typeof t["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"]!="undefined"&&parseInt(t["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])>0&&typeof o!="undefined"&&o){a.push({title:BX.message("MSLLikesList"),callback:function(){RatingLikeComments.List(o)}})}if(BX.type.isNotEmptyObject(t["EVENT_FORMATTED"])&&BX.type.isNotEmptyString(t["EVENT_FORMATTED"]["CAN_EDIT"])&&t["EVENT_FORMATTED"]["CAN_EDIT"]=="Y"){a.push({title:BX.message("MSLCommentMenuEdit"),callback:function(){oMSL.editComment({commentId:t["EVENT"]["ID"],commentText:t["EVENT"]["MESSAGE"],commentType:"log",postId:t["EVENT"]["LOG_ID"],nodeId:e.id})}})}if(typeof t["EVENT_FORMATTED"]!="undefined"&&typeof t["EVENT_FORMATTED"]["CAN_DELETE"]!="undefined"&&t["EVENT_FORMATTED"]["CAN_DELETE"]=="Y"){a.push({title:BX.message("MSLCommentMenuDelete"),callback:function(){oMSL.deleteComment({commentId:t["EVENT"]["ID"],commentType:"log",nodeId:e.id})}})}oMSL.showCommentMenu(a)})};BitrixMSL.prototype.showCommentMenu=function(e){var t=new BXMobileApp.UI.ActionSheet({buttons:e},"commentSheet");t.show()};BitrixMSL.prototype.InitDetail=function(e){this.commentsType=typeof e.commentsType!="undefined"&&e.commentsType=="blog"?"blog":"log";this.entityXMLId=typeof e.entityXMLId!="undefined"?e.entityXMLId:"";this.bFollow=!(typeof e.bFollow!="undefined"&&!e.bFollow);this.commentTextCurrent="";this.arMention=[];this.iDetailTs=typeof e.TS!="undefined"?e.TS:0;if(!this.bKeyboardCaptureEnabled){app.enableCaptureKeyboard(true);this.bKeyboardCaptureEnabled=true;BX.addCustomEvent("onKeyboardWillShow",BX.delegate(function(){this.keyboardShown=true},this));BX.addCustomEvent("onKeyboardDidHide",BX.delegate(function(){this.keyboardShown=false},this))}if(BX.type.isNotEmptyString(e.detailPageId)&&this.detailPageId!=e.detailPageId){this.detailPageId=e.detailPageId;if(typeof e.logId!="undefined"&&parseInt(e.logId)>0){this.logId=parseInt(e.logId)}BXMobileApp.addCustomEvent("onMPFCommentSent",BX.proxy(function(e){if(e.detailPageId==this.detailPageId&&e.data.action=="EDIT_COMMENT"&&e.data.text.length>0&&parseInt(e.data.commentId)>0){if(this.commentsType=="blog"){blogCommentsNativeInputCallback({text:e.data.text,oPreviewComment:null,commentId:e.data.commentId,nodeId:e.nodeId,ufCode:e.ufCode,attachedFiles:e.data[ufCode],attachedFilesRaw:e.data.attachedFilesRaw})}else{commentsNativeInputCallback({text:e.data.text,oPreviewComment:null,commentId:e.data.commentId,nodeId:e.nodeId,ufCode:e.ufCode,attachedFiles:e.data[ufCode],attachedFilesRaw:e.data.attachedFilesRaw})}}},this))}this.menuData={entry_type:this.commentsType,destinations:typeof e.entryParams!="undefined"&&e.entryParams.destinations!="undefined"?e.entryParams.destinations:{},post_perm:typeof e.entryParams!="undefined"&&e.entryParams.post_perm!="undefined"?e.entryParams.post_perm:null,post_id:typeof e.entryParams!="undefined"&&e.entryParams.post_id!="undefined"?e.entryParams.post_id:null,feed_id:typeof e.feed_id!="undefined"?e.feed_id:null,read_only:typeof e.readOnly!="undefined"&&e.readOnly=="Y"?"Y":"N",post_content_type_id:typeof e.entryParams!="undefined"&&BX.type.isNotEmptyString(e.entryParams.post_content_type_id)?e.entryParams.post_content_type_id:null,post_content_id:typeof e.entryParams!="undefined"&&typeof e.entryParams.post_content_id!="undefined"?parseInt(e.entryParams.post_content_id):null};this.detailPageMenuItems=this.buildDetailPageMenu(this.menuData);this.initPageMenu("detail")};BitrixMSL.prototype.showNewComment=function(e){var t=typeof e.text!="undefined"?e.text:"";var o=typeof e.arComment!="undefined"?e.arComment:false;var i=typeof e.oPreviewComment!="undefined"?e.oPreviewComment:false;var n=typeof e.bClearForm!="undefined"?!!e.bClearForm:false;var a=typeof e.bReplace!="undefined"?!!e.bReplace:false;var s=typeof e.bIncrementCounters!="undefined"?!!e.bIncrementCounters:true;var r=typeof e.bShowImages!="undefined"?!!e.bShowImages:true;if(!!i&&typeof oMSL.entityXMLId!="undefined"&&BX("entry-comment-"+oMSL.entityXMLId+"-"+e.commentId)){BX.cleanNode(BX(e.oPreviewComment),true);return}var l=null;if(o){if(!a&&BX("entry-comment-"+oMSL.entityXMLId+"-"+o["SOURCE_ID"])){return}var d=o["AVATAR_SRC"]&&typeof o["AVATAR_SRC"]!="undefined"?BX.create("DIV",{props:{className:"avatar"},style:{backgroundImage:"url('"+o["AVATAR_SRC"]+"')",backgroundRepeat:"no-repeat"}}):BX.create("DIV",{props:{className:"avatar"}});var p=Math.floor(Math.random()*1e5)+1;var m=typeof o["EVENT"]!="undefined"&&typeof o["EVENT"]["RATING_TYPE_ID"]!="undefined"&&o["EVENT"]["RATING_TYPE_ID"].length>0&&typeof o["EVENT"]["RATING_ENTITY_ID"]!="undefined"&&parseInt(o["EVENT"]["RATING_ENTITY_ID"])>0&&typeof o["EVENT"]["RATING_USER_VOTE_VALUE"]!="undefined"?oMSL.buildCommentRatingNode(o,p):null;var f=oMSL.buildCommentReplyNode({EVENT:{USER_ID:o.USER_ID},CREATED_BY:{FORMATTED:BX.util.htmlspecialcharsback(o.CREATED_BY.FORMATTED)}});UFNode=typeof o["UF_FORMATTED"]!="undefined"&&o["UF_FORMATTED"].length>0?BX.create("div",{props:{className:"post-item-attached-file-wrap",id:"entry-comment-"+oMSL.entityXMLId+"-"+o["SOURCE_ID"]+"-files"},html:o["UF_FORMATTED"]}):null;l=BX.create("DIV",{attrs:{id:"entry-comment-"+oMSL.entityXMLId+"-"+o["SOURCE_ID"]},props:{className:"post-comment-block"},children:[BX.create("DIV",{props:{className:"post-user-wrap"},children:[d,BX.create("DIV",{props:{className:"post-comment-cont"},children:[BX.create("A",{props:{className:"post-comment-author"},attrs:{href:o["CREATED_BY"]["URL"]},html:o["CREATED_BY"]["FORMATTED"]}),BX.create("DIV",{props:{className:"post-comment-time"},html:o["LOG_TIME_FORMAT"]})]})]}),BX.create("DIV",{props:{className:"post-comment-text"},html:typeof o["MESSAGE_FORMAT_MOBILE"]!="undefined"&&o["MESSAGE_FORMAT_MOBILE"].length>0?o["MESSAGE_FORMAT_MOBILE"]:o["MESSAGE_FORMAT"]}),UFNode,m,f]})}else{l=BX.create("DIV",{html:t})}if(!!i){if(a){i.parentNode.insertBefore(l,i)}BX.cleanNode(BX(i),true)}if(!a){BX("post-comment-last-after").parentNode.insertBefore(l,BX("post-comment-last-after"))}var c=false;if(o&&m){if(!window.RatingLikeComments&&top.RatingLikeComments){RatingLikeComments=top.RatingLikeComments}c=o["EVENT"]["RATING_TYPE_ID"]+"-"+o["EVENT"]["RATING_ENTITY_ID"]+"-"+p;RatingLikeComments.Set(c,o["EVENT"]["RATING_TYPE_ID"],o["EVENT"]["RATING_ENTITY_ID"],"Y")}if(o){var u={EVENT:{ID:o.EVENT.ID,LOG_ID:o.EVENT.LOG_ID,USER_ID:o.USER_ID,MESSAGE:o.MESSAGE,RATING_TOTAL_POSITIVE_VOTES:o.EVENT.RATING_TOTAL_POSITIVE_VOTES},EVENT_FORMATTED:{CAN_EDIT:o.CAN_EDIT,CAN_DELETE:o.CAN_DELETE},CREATED_BY:o.CREATED_BY};oMSL.createCommentMenu(l,u,c)}if(n&&BX("comment_send_form_comment")){BX("comment_send_form_comment").value=""}if(s){oMSL.incrementCounters(oMSL.getLogId())}if(typeof o["UF_FORMATTED"]!="undefined"){oMSL.parseAndExecCode(o["UF_FORMATTED"],0)}if(r){setTimeout(function(){BitrixMobile.LazyLoad.showImages()},500)}};BitrixMSL.prototype.showPreviewComment=function(e){if(!e)return false;var t=BX("empty_comment",true);var o=Math.floor(Math.random()*1e5)+1;var i=BX("post-comment-last-after");if(t&&i){var n=BX.clone(t,true);BX.adjust(BX(n),{attrs:{id:"new_comment_"+o}});var a=BX.findChild(n,{className:"post-comment-text"},true,false);a.innerHTML=e.replace(/\n/g,"<br />");i.parentNode.insertBefore(n,i);BX(n).style.display="block";var s=document.body;var r=s.scrollHeight-s.offsetHeight;var l=window.platform=="android"?600:120;if(s&&s.scrollTop>=r-l){BitrixAnimation.animate({duration:1e3,start:{scroll:s.scrollTop},finish:{scroll:s.scrollTop+l+20},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function(e){window.scrollTo(0,e.scroll)},complete:function(){}})}}return!!n?BX(n):false};BitrixMSL.prototype.showCommentWait=function(e){if(typeof e.nodeId!="undefined"){var t=BX.findChild(BX(e.nodeId),{className:"post-comment-cont"},true,false);var o=false;var i=false;if(t){o=BX.findChild(t,{className:"post-comment-preview-wait"},true,false);i=BX.findChild(t,{className:"post-comment-preview-undelivered"},true,false)}if(e.status){if(!o){t.appendChild(BX.create("DIV",{props:{id:e.nodeId+"-status",className:"post-comment-preview-wait"}}))}if(!i){t.appendChild(BX.create("DIV",{props:{className:"post-comment-preview-undelivered"}}))}}}};BitrixMSL.prototype.showCommentAlert=function(e){var t=typeof e.commentType!="undefined"&&e.commentType=="blog"?"blog":"log";var o=typeof e.commentId!="undefined"&&e.commentId?e.commentId:0;var i=typeof e.text!="undefined"&&e.text?e.text:"";var n=typeof e.callback!="undefined"?e.callback:false;var a=typeof e.action!="undefined"?e.action:false;if(typeof e.nodeId!="undefined"){if(a=="add"){this.alertPreviewComment({nodeId:e.nodeId,text:i,commentType:t,commentId:o,action:a,callback:n})}else{var s=BX.findChild(BX(e.nodeId),{className:"post-comment-cont"},true,false);if(s){var r=BX.findChild(s,{className:"post-comment-preview-undelivered"},true,false);if(!r){s.appendChild(BX.create("DIV",{props:{id:e.nodeId+"-status",className:"post-comment-preview-undelivered"},style:{display:"block"}}))}this.alertPreviewComment({nodeId:e.nodeId,text:i,commentType:t,commentId:o,action:a,callback:n})}}}};BitrixMSL.prototype.alertPreviewComment=function(e){var t=typeof e.commentId!="undefined"&&e.commentId?e.commentId:0;var o=typeof e.commentType!="undefined"&&e.commentType=="blog"?"blog":"log";var i=typeof e.text!="undefined"&&e.text?e.text:"";var n=typeof e.callback!="undefined"?e.callback:false;if(typeof e.nodeId!="undefined"){var a=BX.findChild(BX(e.nodeId),{className:"post-comment-preview-wait"},true,false);var s=BX.findChild(BX(e.nodeId),{className:"post-comment-preview-undelivered"},true,false);if(!!a&&!!s){BX(a).style.display="none";BX(s).style.display="block";BX.bind(BX(s),"click",function(){BX.unbindAll(BX(s));BX(a).style.display="block";BX(s).style.display="none";if(n){n()}})}}};BitrixMSL.prototype.setFollow=function(e){var t=typeof e.logId!="undefined"?parseInt(e.logId):0,o=typeof e.pageId!="undefined"?e.pageId:false,i=typeof e.bOnlyOn!="undefined"?e.bOnlyOn:false,n=typeof e.bRunEvent!="undefined"?e.bRunEvent:true,a=typeof e.bAjax!="undefined"?e.bAjax:false,s=typeof e.menuNode!="undefined"&&BX(e.menuNode)?BX(e.menuNode):null;if(!s){s=BX("log-entry-menu-"+t)}if(i=="NO"){i=false}var r=BX("log_entry_follow_"+t);if(!r){r=BX("log_entry_follow")}var l=BX("post_item_top_wrap_"+t);if(!l){l=BX("post_item_top_wrap")}var d=null;if(s){d=s.getAttribute("data-follow")=="Y"?"Y":"N"}else if(r){d=r.getAttribute("data-follow")=="Y"?"Y":"N"}if(!d){return false}var p=d=="Y"?"N":"Y";if((!BX.type.isNotEmptyString(this.detailPageId)||this.detailPageId!=o)&&(!i||d=="N")){if(r){BX.removeClass(r,d=="Y"?"post-item-follow-active":"post-item-follow");BX.addClass(r,d=="Y"?"post-item-follow":"post-item-follow-active");r.setAttribute("data-follow",p)}if(s){s.setAttribute("data-follow",p)}if(n){BXMobileApp.onCustomEvent("onLogEntryFollow",{logId:t,pageId:BX.type.isNotEmptyString(oMSL.detailPageId)?oMSL.detailPageId:"",bOnlyOn:i?"Y":"N"},true)}if(!this.getFollowDefaultValue()&&l){if(d=="Y"){BX.removeClass(l,"post-item-follow")}else{BX.addClass(l,"post-item-follow")}}if(BX.type.isNotEmptyString(this.detailPageId)){this.setFollowValue(p=="Y");this.setFollowMenuItemName()}}if(a){var m=new MobileAjaxWrapper;m.runAction("socialnetwork.api.livefeed.changeFollow",{data:{logId:t,value:p},analyticsLabel:{b24statAction:p=="Y"?"setFollow":"setUnfollow"}}).then(function(e){if(!e.data.success){if(r){BX.removeClass(r,d=="Y"?"post-item-follow":"post-item-follow-active");BX.addClass(r,d=="Y"?"post-item-follow-active":"post-item-follow");r.setAttribute("data-follow",d)}if(s){s.setAttribute("data-follow",d)}if(BX.type.isNotEmptyString(this.detailPageId)){this.setFollowValue(d=="Y");this.setFollowMenuItemName()}if(!this.getFollowDefaultValue()&&l){if(d=="Y"){BX.addClass(l,"post-item-follow")}else{BX.removeClass(l,"post-item-follow")}}if(this.getLogId()>0){BXMobileApp.onCustomEvent("onLogEntryFollow",{logId:t,pageId:BX.type.isNotEmptyString(this.detailPageId)?this.detailPageId:"",bOnlyOn:i?"Y":"N"},true)}}}.bind(this),function(e){if(r){BX.removeClass(r,d=="Y"?"post-item-follow":"post-item-follow-active");BX.addClass(r,d=="Y"?"post-item-follow-active":"post-item-follow");r.setAttribute("data-follow",d)}if(s){s.setAttribute("data-follow",d)}if(!this.getFollowDefaultValue()&&l){if(d=="Y"){BX.addClass(l,"post-item-follow")}else{BX.removeClass(l,"post-item-follow")}}if(BX.type.isNotEmptyString(this.detailPageId)){this.setFollowValue(d=="Y");this.setFollowMenuItemName()}}.bind(this))}return false};BitrixMSL.prototype.setFollowDefault=function(e){if(typeof e.value=="undefined"){return}var t=!!e.value;if(!BX.type.isNotEmptyString(oMSL.detailPageId)){this.setFollowDefaultValue(t);this.setDefaultFollowMenuItemName()}var o={sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("MSLLangId"),value:t?"Y":"N",action:"change_follow_default",mobile_action:"change_follow_default"};this.changeListMode(o,function(e){oMSL.pullDownAndRefresh()},function(e){oMSL.setFollowDefaultValue(e.value!="Y");oMSL.setDefaultFollowMenuItemName()})};BitrixMSL.prototype.setExpertMode=function(e){if(typeof e.value=="undefined"){return}var t=!!e.value;if(!BX.type.isNotEmptyString(oMSL.detailPageId)){oMSL.bExpertMode=t;this.setExpertModeMenuItemName()}var o={sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("MSLLangId"),value:t?"Y":"N",action:"change_expert_mode",mobile_action:"change_expert_mode"};this.changeListMode(o,function(e){oMSL.pullDownAndRefresh()},function(e){oMSL.bExpertMode=!(e.value=="Y");oMSL.setExpertModeMenuItemName()})};BitrixMSL.prototype.changeListMode=function(e,t,o){app.showPopupLoader({text:""});var i=false,n="";if(e.action=="change_follow_default"){i="socialnetwork.api.livefeed.changeFollowDefault";n=e.value=="Y"?"setFollowType":"unsetFollowType"}else if(e.action=="change_expert_mode"){i="socialnetwork.api.livefeed.changeExpertMode";n=e.value=="Y"?"setExpertMode":"unsetExpertMode"}if(!i){return}var a=new MobileAjaxWrapper;a.runAction(i,{data:{value:e.value},analyticsLabel:{b24statAction:n,b24statContext:"mobile"}}).then(function(i){app.hidePopupLoader();if(i.data.success){t(e)}else{if(!BX.type.isNotEmptyString(this.detailPageId)){o(e)}}}.bind(this),function(t){app.hidePopupLoader();if(!BX.type.isNotEmptyString(this.detailPageId)){o(e)}}.bind(this))};BitrixMSL.prototype.incrementCounters=function(e){e=parseInt(e);if(e>0){var t=0;var o=0;if(BX("informer_comments_"+e)&&!BX("informer_comments_new_"+e)){t=BX("informer_comments_"+e).innerHTML.length>0?parseInt(BX("informer_comments_"+e).innerHTML):0;o=t+1;BX("informer_comments_"+e).innerHTML=o}else if(BX("informer_comments_common")){t=BX("informer_comments_common").innerHTML.length>0?parseInt(BX("informer_comments_common").innerHTML):0;o=t+1;BX("informer_comments_common").innerHTML=o}if(BX("comcntleave-all")){t=BX("comcntleave-all").innerHTML.length>0?parseInt(BX("comcntleave-all").innerHTML):0;o=t+1;BX("comcntleave-all").innerHTML=o}BXMobileApp.onCustomEvent("onLogEntryCommentAdd",{log_id:e},true)}};BitrixMSL.prototype.getComment=function(e){var t="";if(e.commentType=="blog"){if(!!e.oPreviewComment&&typeof oMSL.entityXMLId!="undefined"&&BX("entry-comment-"+oMSL.entityXMLId+"-"+e.commentId)){BX.cleanNode(BX(e.oPreviewComment),true);return}t=BX.message("SBPCurlToNew").replace(/#post_id#/,e.entryId).replace(/#comment_id#/,e.commentId)}if(t.length>0){var o=new MobileAjaxWrapper;o.Wrap({type:"json",method:"GET",url:t,data:"",processData:true,callback:function(t){if(typeof t.TEXT!="undefined"){oMSL.showNewComment({commentType:e.commentType,commentId:e.commentId,text:t.TEXT,bClearForm:false,oPreviewComment:e.oPreviewComment,bReplace:false,bIncrementCounters:true,bShowImages:false});oMSL.parseAndExecCode(t.TEXT);__MSLDetailMoveBottom();oMSL.setFollow({logId:oMSL.getLogId(),bOnlyOn:true})}else{oMSL.showCommentAlert({nodeId:e.oPreviewComment,commentType:e.commentType,callback:function(){oMSL.getComment(e)}})}},callback_failure:function(){oMSL.showCommentAlert({nodeId:e.oPreviewComment,commentType:e.commentType,callback:function(){oMSL.getComment(e)}})}})}};BitrixMSL.prototype.setFocusOnComments=function(e){e=e=="list"?"list":"form";if(e=="form"){this.setFocusOnCommentForm();__MSLDetailMoveBottom()}else if(e=="list"){if(BX("post-comments-wrap")){var t=BX.findChild(BX("post-comments-wrap"),{className:"post-comment-block-new"},true);if(t){window.scrollTo(0,t.offsetTop)}else{var o=BX.findChild(BX("post-comments-wrap"),{className:"post-comment-block"},true);window.scrollTo(0,o?o.offsetTop:0)}}}return false};BitrixMSL.prototype.setFocusOnCommentForm=function(){BXMobileApp.UI.Page.TextPanel.focus();return false};BitrixMSL.prototype.buildDetailPageMenu=function(e){var t=[],o=null;if(Application.getApiVersion()>=34){o=document.getElementById("log-entry-menu-"+this.getLogId())}if(e.entry_type=="blog"){var i=null;var n={a_users:[],b_groups:[]};if(n.a_users.length>0||n.b_groups.length>0){t.push({id:"sharePost",name:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_SHARE"),action:function(){app.openTable({callback:function(){oMSL.shareBlogPost()},url:BX.message("MSLSiteDir")+"mobile/index.php?mobile_action="+(BX.message("MSLIsExtranetSite")=="Y"?"get_group_list":"get_usergroup_list")+"&feature=blog",markmode:true,multiple:true,return_full_mode:true,user_all:true,showtitle:true,modal:true,selected:n,alphabet_index:true,okname:BX.message("MOBILE_EXT_LIVEFEED_SHARE_TABLE_BUTTON_OK"),cancelname:BX.message("MOBILE_EXT_LIVEFEED_SHARE_TABLE_BUTTON_CANCEL"),outsection:BX.message("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DENIED")!="Y"})},arrowFlag:false,icon:"add",image:"/bitrix/templates/mobile_app/images/lenta/menu/n_plus.png"})}if(typeof e.post_perm!="undefined"&&e.post_perm=="W"){t.push({id:"editPost",name:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_EDIT"),action:function(){oMSL.editBlogPost({feed_id:e.feed_id,post_id:parseInt(e.post_id)})},arrowFlag:false,icon:"edit",feature:"edit",image:"/bitrix/templates/mobile_app/images/lenta/menu/pencil.png"});t.push({id:"deletePost",name:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_DELETE"),action:function(){oMSL.deleteBlogPost({post_id:parseInt(e.post_id)})},arrowFlag:false,icon:"delete",iconName:"delete"})}}if(o&&o.getAttribute("data-use-favorites")=="Y"){t.push({id:"favoritesPost",name:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_FAVORITES_"+o.getAttribute("data-favorites")),image:"/bitrix/templates/mobile_app/images/lenta/menu/favorite.png",action:function(){__MSLSetFavorites(this.getLogId(),o)}.bind(this),arrowFlag:false,feature:"favorites"})}if(oMSL.bUseFollow&&(!BX.type.isNotEmptyString(e.read_only)||e.read_only!="Y")){t.push({id:"followPost",name:oMSL.getFollowValue()?BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_Y"):BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_N"),image:"/bitrix/templates/mobile_app/images/lenta/menu/eye.png",action:function(){oMSL.setFollow({logId:oMSL.getLogId(),pageId:oMSL.pageId,bOnlyOn:false,bAjax:true,bRunEvent:true})},arrowFlag:false,feature:"follow"})}t.push({id:"refreshPostComments",name:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_REFRESH_COMMENTS"),image:"/bitrix/templates/mobile_app/images/lenta/menu/n_refresh.png",action:function(){if(oMSL.bDetailEmptyPage){oMSL.getComments({ts:oMSL.iDetailTs,bPullDown:true,obFocus:{form:false}})}else{document.location.reload(true)}},arrowFlag:false});if(BX.type.isNotEmptyString(e.post_content_type_id)&&BX.type.isNumber(e.post_content_id)&&e.post_content_id>0){t.push({id:"getPostLink",name:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_GET_LINK"),image:"/bitrix/templates/mobile_app/images/lenta/menu/link.png",action:function(){this.copyPostLink({contentTypeId:e.post_content_type_id,contentId:parseInt(e.post_content_id)})}.bind(this),arrowFlag:false})}if(BX.message("MOBILE_EXT_LIVEFEED_USE_TASKS")=="Y"&&BX.type.isNotEmptyString(e.post_content_type_id)&&BX.type.isNumber(e.post_content_id)&&e.post_content_id>0){t.push({id:"createTask",name:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_CREATE_TASK"),image:"/bitrix/templates/mobile_app/images/lenta/menu/n_check.png",action:function(){oMSL.createTask({entityType:e.post_content_type_id,entityId:parseInt(e.post_content_id),logId:oMSL.getLogId()});return false},arrowFlag:false})}return t};BitrixMSL.prototype.getPageMenuItems=function(e){e=e=="detail"?"detail":"list";return e=="detail"?this.detailPageMenuItems:this.listPageMenuItems};BitrixMSL.prototype.showPageMenu=function(){if(this.pageType=="detail"){this.detailPageMenuItems=this.buildDetailPageMenu(this.menuData)}var e=this.getPageMenuItems(this.pageType);if(e.length>0){var t=[],o={};for(var i=0;i<e.length;i++){t.push({id:e[i].id,title:e[i].name,iconUrl:BX.type.isNotEmptyString(e[i].image)?e[i].image:"",iconName:BX.type.isNotEmptyString(e[i].iconName)?e[i].iconName:"",sectionCode:"defaultSection"});o[e[i].id]=e[i].action}app.exec("setPopupMenuData",{items:t,sections:[{id:"defaultSection"}],callback:function(e){if(e.eventName=="onDataSet"){app.exec("showPopupMenu")}else if(e.eventName=="onItemSelected"&&BX.type.isNotEmptyObject(e.item)&&BX.type.isNotEmptyString(e.item.id)&&typeof o[e.item.id]!="undefined"){o[e.item.id]()}}})}};BitrixMSL.prototype.initPageMenu=function(e){e=e=="detail"?"detail":"list";var t=this.getPageMenuItems(e),o=e=="detail"?BX.message("MSLLogEntryTitle")!=null?BX.message("MSLLogEntryTitle"):"":BX.message("MSLLogTitle")!=null?BX.message("MSLLogTitle"):"";if(t.length>0){if(Application.getApiVersion()>=34){BXMobileApp.UI.Page.TopBar.title.params.largeMode=true;BXMobileApp.UI.Page.TopBar.title._applyParams();oMSL.initPagePopupMenu()}else{app.menuCreate({items:t});BXMobileApp.UI.Page.TopBar.title.setCallback(function(){app.menuShow()})}}else{if(Application.getApiVersion()>=34){}else{BXMobileApp.UI.Page.TopBar.title.setCallback("")}}BXMobileApp.UI.Page.TopBar.title.setText(o);BXMobileApp.UI.Page.TopBar.title.show()};BitrixMSL.prototype.showPostMenu=function(e){var t=null;if(BX.type.isString(e.target.getAttribute("data-menu-type"))&&e.target.getAttribute("data-menu-type")=="post"){t=e.target}else{t=BX.findParent(e.target,{className:"lenta-menu"},{className:"post-item-top"})}if(!BX(t)){return e.preventDefault()}var o=[],i={},n=BX.type.isString(t.getAttribute("data-use-favorites"))&&t.getAttribute("data-use-favorites")=="Y"?"Y":"N",a=n=="Y"&&BX.type.isString(t.getAttribute("data-favorites"))&&t.getAttribute("data-favorites")=="Y"?"Y":"N",s=BX.type.isString(t.getAttribute("data-use-follow"))&&t.getAttribute("data-use-follow")=="Y"?"Y":"N",r=n=="Y"&&BX.type.isString(t.getAttribute("data-follow"))&&t.getAttribute("data-follow")=="Y"?"Y":"N",l=BX.type.isString(t.getAttribute("data-log-id"))&&parseInt(t.getAttribute("data-log-id"))>0?parseInt(t.getAttribute("data-log-id")):0,d=BX.type.isString(t.getAttribute("data-post-id"))&&parseInt(t.getAttribute("data-post-id"))>0?parseInt(t.getAttribute("data-post-id")):0,p=BX.type.isString(t.getAttribute("data-post-perm"))?t.getAttribute("data-post-perm"):"R",m=BX.type.isString(t.getAttribute("data-content-type-id"))?t.getAttribute("data-content-type-id"):null,f=BX.type.isString(t.getAttribute("data-content-id"))?parseInt(t.getAttribute("data-content-id")):0;if(d>0&&p=="W"){o.push({id:"edit",title:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_EDIT"),iconUrl:"/bitrix/templates/mobile_app/images/lenta/menu/pencil.png",sectionCode:"defaultSection",action:function(){this.editBlogPost({feed_id:window.LiveFeedID,post_id:d})}.bind(this)});o.push({id:"delete",title:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_DELETE"),iconName:"delete",sectionCode:"defaultSection",action:function(){this.deleteBlogPost({post_id:d})}.bind(this)})}if(n=="Y"&&l>0){o.push({id:"favorites",title:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_FAVORITES_"+a),iconUrl:"/bitrix/templates/mobile_app/images/lenta/menu/favorite.png",sectionCode:"defaultSection",action:function(){__MSLSetFavorites(l,t)}})}if(s&&l>0){o.push({id:"follow",title:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_"+r),iconUrl:"/bitrix/templates/mobile_app/images/lenta/menu/eye.png",sectionCode:"defaultSection",action:function(){this.setFollow({logId:l,menuNode:t,pageId:this.pageId,bOnlyOn:false,bAjax:true,bRunEvent:true})}.bind(this)})}if(BX.type.isNotEmptyString(m)&&f>0){o.push({id:"getPostLink",title:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_GET_LINK"),iconUrl:"/bitrix/templates/mobile_app/images/lenta/menu/link.png",sectionCode:"defaultSection",action:function(){this.copyPostLink({contentTypeId:m,contentId:f})}.bind(this)})}if(BX.message("MOBILE_EXT_LIVEFEED_USE_TASKS")=="Y"&&BX.type.isNotEmptyString(m)&&f>0&&l>0){o.push({id:"createTask",title:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_CREATE_TASK"),iconUrl:"/bitrix/templates/mobile_app/images/lenta/menu/n_check.png",sectionCode:"defaultSection",action:function(){this.createTask({entityType:m,entityId:f,logId:l});return false}.bind(this)})}if(o.length<=0){return e.preventDefault()}for(var c=0;c<o.length;c++){i[o[c].id]=o[c].action}app.exec("setPopupMenuData",{position:"center",items:o,sections:[{id:"defaultSection"}],callback:function(e){if(e.eventName=="onDataSet"){app.exec("showPopupMenu")}else if(e.eventName=="onItemSelected"&&BX.type.isNotEmptyObject(e.item)&&BX.type.isNotEmptyString(e.item.id)&&typeof i[e.item.id]!="undefined"){i[e.item.id]()}}});return e.preventDefault()};BitrixMSL.prototype.copyPostLink=function(e){var t=BX.type.isNotEmptyString(e.contentTypeId)?e.contentTypeId:"",o=BX.type.isNumber(e.contentId)&&e.contentId>0?e.contentId:0;if(!BX.type.isNotEmptyString(t)||o<=0){return}var i=new MobileAjaxWrapper;i.runAction("socialnetwork.api.livefeed.getRawEntryData",{data:{params:{entityType:t,entityId:o,logId:this.getLogId(),additionalParams:{getLivefeedUrl:"Y",absoluteUrl:"Y",returnFields:["LIVEFEED_URL"]}}}}).then(function(e){this.copyLinkSuccess(e.data)}.bind(this),function(e){})};BitrixMSL.prototype.setFollowMenuItemName=function(){var e=false;for(var t=0;t<this.detailPageMenuItems.length;t++){e=this.detailPageMenuItems[t];if(typeof e.feature!="undefined"&&e.feature=="follow"){e.name=oMSL.getFollowValue()?BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_Y"):BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_FOLLOW_N");this.detailPageMenuItems[t]=e;this.initPageMenu("detail");break}}};BitrixMSL.prototype.setDefaultFollowMenuItemName=function(){var e=false;for(var t=0;t<this.listPageMenuItems.length;t++){e=this.listPageMenuItems[t];if(typeof e.feature!="undefined"&&e.feature=="follow"){e.name=oMSL.getFollowDefaultValue()?BX.message("MSLMenuItemFollowDefaultY"):BX.message("MSLMenuItemFollowDefaultN");this.listPageMenuItems[t]=e;this.initPageMenu("list");break}}};BitrixMSL.prototype.setExpertModeMenuItemName=function(){var e=false;for(var t=0;t<this.listPageMenuItems.length;t++){e=this.listPageMenuItems[t];if(typeof e.feature!="undefined"&&e.feature=="expert"){e.name=oMSL.bExpertMode?BX.message("MSLMenuItemExpertModeY"):BX.message("MSLMenuItemExpertModeN");this.listPageMenuItems[t]=e;this.initPageMenu("list");break}}};BitrixMSL.prototype.replyToComment=function(e,t,o){e=parseInt(e);var i=typeof this.commentTextCurrent!="undefined"?this.commentTextCurrent:"";this.arMention[t]="[USER="+e+"]"+t+"[/USER]";i=i+" "+t+", ";if(typeof this.commentTextCurrent!="undefined"){this.commentTextCurrent=i}BXMobileApp.UI.Page.TextPanel.setText(i);BXMobileApp.UI.Page.TextPanel.focus();return typeof o!="undefined"?o.preventDefault():false};BitrixMSL.prototype.buildCommentRatingNode=function(e,t){var o=e["EVENT"]["RATING_USER_VOTE_VALUE"]>0?"post-comment-likes-liked":"post-comment-likes";var i=parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])>1||parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])==1&&e["EVENT"]["RATING_USER_VOTE_VALUE"]<=0;return BX.create("DIV",{props:{id:"bx-ilike-button-"+e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t,className:o},children:[BX.create("DIV",{props:{className:"post-comment-likes-text"},html:i?BX.message("MSLLike2"):BX.message("MSLLike")}),BX.create("DIV",{props:{id:"bx-ilike-count-"+e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t,className:"post-comment-likes-counter"},style:{display:i?"inner-block":"none"},events:{click:function(o){RatingLikeComments.List(e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t);o.preventDefault()}},html:""+parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])+""})]})};BitrixMSL.prototype.buildCommentReplyNode=function(e){return BX.create("DIV",{props:{className:"post-comment-reply"},children:[BX.create("DIV",{props:{className:"post-comment-reply-text"},events:{click:function(t){oMSL.replyToComment(e["EVENT"]["USER_ID"],e["CREATED_BY"]["FORMATTED"],t||window.event)}},html:BX.message("MSLReply")})]})};BitrixMSL.prototype.drawRatingFooter=function(e){if(BX("rating-footer-wrap")){BX("rating-footer-wrap").innerHTML=e;this.parseAndExecCode(e,0)}};BitrixMSL.prototype.parseMentions=function(e){var t=e;if(typeof this.arMention!="undefined"){for(var o in this.arMention){t=t.replace(new RegExp(o,"g"),this.arMention[o])}this.arMention=[];this.commentTextCurrent=""}return t};BitrixMSL.prototype.unParseMentions=function(e){var t=e;t=t.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(e,t,o){oMSL.arMention[o]=e;return o});return t};BitrixMSL.prototype.expandText=function(e){if(!document.body.classList.contains("post-card")){return}var t=typeof e=="undefined"||e==null||!BX("post_block_check_cont_"+e)?BX("post_block_check_cont"):BX("post_block_check_cont_"+e);if(!t){return}if(BX.hasClass(t,"post-item-post-block")){BX.addClass(t,this.classes.postItemBlockFull);BX.removeClass(t,"post-item-post-block")}else if(BX.hasClass(t,"lenta-info-block-wrapp")){BX.addClass(t,"lenta-info-block-wrapp-full");BX.removeClass(t,"lenta-info-block-wrapp")}var o=t.querySelector(".post-more-block");if(o){o.style.display="none"}if(BX("post_more_limiter_"+e)){BX("post_more_limiter_"+e).style.display="none"}else if(BX("post_more_limiter")){BX("post_more_limiter").style.display="none"}var i=BX.findChildren(t,{tagName:"img"},true);if(BX.type.isArray(i)){for(var n=0;n<i.length;n++){if(BX.type.isString(i[n].getAttribute("data-src"))&&i[n].getAttribute("data-src").length>0&&!!i[n].id){BitrixMobile.LazyLoad.registerImage(i[n].id)}}BitrixMobile.LazyLoad.showImages(false)}};BitrixMSL.prototype.showEmptyCommentsBlockWaiter=function(e,t){t=!!t;if(!BX(e)){return}var o=BX.findChild(BX(e),{className:"post-comments-load-btn-wrap"},true,false);if(o){BX.cleanNode(o,true)}if(t){BX(e).appendChild(BX.create("DIV",{props:{className:"post-comments-load-btn-wrap"},children:[BX.create("DIV",{props:{className:"post-comments-loader"}}),BX.create("DIV",{props:{className:"post-comments-load-text"},text:BX.message("MSLDetailCommentsLoading")})]}))}};BitrixMSL.prototype.showEmptyCommentsBlockFailed=function(e,t,o,i,n){if(!BX(e)){return}var a=typeof n!="undefined"&&typeof n.ERROR_MESSAGE!="undefined"&&n.ERROR_MESSAGE.length>0?n.ERROR_MESSAGE:BX.message("MSLDetailCommentsFailed");BX(e).appendChild(BX.create("DIV",{props:{className:"post-comments-load-btn-wrap"},children:[BX.create("DIV",{props:{className:"post-comments-load-text"},text:a}),BX.create("A",{props:{className:"post-comments-load-btn"},events:{click:function(){BX.cleanNode(this.parentNode,true);oMSL.getComments({ts:t,bPullDown:o,obFocus:{form:false}})},touchstart:function(){this.classList.add("post-comments-load-btn-active")},touchend:function(){this.classList.remove("post-comments-load-btn-active")}},text:BX.message("MSLDetailCommentsReload")})]}))};BitrixMSL.prototype.afterEdit=function(e,t){t=typeof t!="undefined"?parseInt(t):0;var o=BX.create("DIV",{html:e.text});BX("blog-post-first-after").parentNode.insertBefore(o,BX("blog-post-first-after").nextSibling);var i=BX.findChild(o,{className:"post-item-post-block"},true),n=BX.findChild(o,{className:"post-item-top"},true),a=BX.findChild(o,{className:"post-item-attached-file-wrap"},true);if(t>0&&i&&n){var s={detailText:i.innerHTML,topText:n.innerHTML,logID:t};if(a){s.filesBlockText=a.innerHTML}BXMobileApp.onCustomEvent("onEditedPostInserted",s,true,true)}BitrixMobile.LazyLoad.showImages()};BitrixMSL.prototype.onLogEntryFavorites=function(e,t){var o=BX("log_entry_favorites_"+e);if(o&&(BX.message("MSLPageId")==undefined||BX.message("MSLPageId")!=t)){var i=o.getAttribute("data-favorites")=="Y"?"Y":"N";var n=i=="Y"?"N":"Y";if(i=="Y"){BX.removeClass(o,"lenta-item-fav-active")}else{BX.addClass(o,"lenta-item-fav-active")}o.setAttribute("data-favorites",n)}};BitrixMSL.prototype.onLogEntryCommentAdd=function(e,t){var o,i;var n=typeof t!="undefined";if(typeof t=="undefined"){t=0}if(BX("informer_comments_"+e)&&!BX("informer_comments_new_"+e)){if(parseInt(t)>0){o=parseInt(t)}else if(!n){i=BX("informer_comments_"+e).innerHTML.length>0?parseInt(BX("informer_comments_"+e).innerHTML):0;o=i+1}if(parseInt(o)>0){BX("informer_comments_"+e).innerHTML=o;BX("informer_comments_"+e).style.display="inline-block";BX("informer_comments_text2_"+e).style.display="inline-block";BX("informer_comments_text_"+e).style.display="none"}}if(BX("comcntleave-all")){if(parseInt(t)>0){o=parseInt(t)}else if(!n){i=BX("comcntleave-all").innerHTML.length>0?parseInt(BX("comcntleave-all").innerHTML):0;o=i+1}BX("comcntleave-all").innerHTML=o}};BitrixMSL.prototype.onLogEntryRatingLike=function(e){var t=e.ratingId;if(typeof this.arRatingLikeProcess[t]!="undefined"){setTimeout(function(){oMSL.onLogEntryRatingLike(e)},100);return}this.arRatingLikeProcess[t]=true;var o=e.voteAction;var i=parseInt(e.logId);var n=typeof e.userId!="undefined"?parseInt(e.userId):BX.message("USER_ID");if(i<=0&&this.isUserCurrent(n)){delete this.arRatingLikeProcess[t];return}var a=BX("bx-ilike-box-"+t);if(!a){delete this.arRatingLikeProcess[t];return}var s=BX("bx-ilike-button-"+t);if(!s){s=BX("rating_button")}if(!s||!BX.hasClass(s,"post-item-inform-likes")&&!BX.hasClass(s,"post-item-inform-likes-active")){delete this.arRatingLikeProcess[t];return}var r=null;var l=0;var d=0;var p=null;var m=i>0&&BX("rating_block_"+i)?BX("rating_block_"+i):BX("rating_button_cont");if(!m&&a){m=BX.findParent(a,{tag:"SPAN",className:"bx-ilike-block"})}if(a){r=BX.findChild(a,{className:"post-item-inform-right-text"},true,false);if(r&&m){l=parseInt(m.getAttribute("data-counter"));d=o=="plus"?l+1:l-1;r.innerHTML=d}if(this.isUserCurrent(n)){BX.removeClass(s,o=="plus"?"post-item-inform-likes":"post-item-inform-likes-active");BX.addClass(s,o=="plus"?"post-item-inform-likes-active":"post-item-inform-likes")}var f=BX.hasClass(s,"post-item-inform-likes-active")&&d>1||!BX.hasClass(s,"post-item-inform-likes-active")&&d>0;r=BX.findChild(s,{className:"post-item-inform-right"},true,false);if(r){r.innerHTML=d;r.style.display=f?"inline-block":"none";r=BX.findChild(s,{className:"post-item-inform-left"},true,false);r.innerHTML=f?BX.message("MSLLike2"):BX.message("MSLLike")}}if(m){m.setAttribute("data-counter",parseInt(d))}if(i>0&&BX("rating-footer_"+i)){p=BX("rating-footer-wrap_"+i)}else if(m){p=BX("rating-footer-wrap")}if(!p&&m&&typeof m.id!="undefined"){var c=m.id.match(/^rating_block_([\d]+)$/i);if(c!=null){p=BX("rating-footer-wrap_"+c[1])}}if(this.isUserCurrent(n)&&typeof BXRL!="undefined"&&typeof BXRL[t]!="undefined"){BXRL[t].lastVote=o=="plus"?"plus":"cancel"}delete this.arRatingLikeProcess[t]};BitrixMSL.prototype.onLogEntryImpPostRead=function(e){if(typeof e=="undefined"||typeof e.node=="undefined"||!BX(e.node)){return}oMSL.setLogEntryImpPostRead({node:BX(e.node),value:true})};BitrixMSL.prototype.setLogEntryImpPostRead=function(e){if(typeof e=="undefined"||typeof e.node=="undefined"||!BX(e.node)){return}var t=BX(e.node);var o=!!e.value;if(o){t.checked=true;t.setAttribute("done","Y");BX.unbindAll(t)}else{t.checked=false;delete t.checked;t.removeAttribute("done")}};BitrixMSL.prototype.onLogCommentRatingLike=function(e){var t=e.ratingId;if(typeof this.arRatingLikeProcess[t]!="undefined"){setTimeout(function(){oMSL.onLogCommentRatingLike(e)},100);return}this.arRatingLikeProcess[t]=true;var o=e.voteAction;var i=typeof e.userId!="undefined"?parseInt(e.userId):BX.message("USER_ID");var n=BX("bx-ilike-count-"+t);if(!n){delete this.arRatingLikeProcess[t];return}var a=parseInt(n.innerHTML);var s=o=="plus"?a+1:a-1;if(this.isUserCurrent(i)){delete this.arRatingLikeProcess[t];return}var r=BX("bx-ilike-button-"+t);if(!r||!BX.hasClass(r,"post-comment-likes")&&!BX.hasClass(r,"post-comment-likes-liked")){delete this.arRatingLikeProcess[t];return}if(n){var l=BX.hasClass(r,"post-comment-likes-liked")&&s>1||!BX.hasClass(r,"post-comment-likes-liked")&&s>0;n.innerHTML=s;n.style.display=l?"inline-block":"none";var d=BX.findChild(r,{className:"post-comment-likes-text"},true,false);d.innerHTML=l?BX.message("MSLLike2"):BX.message("MSLLike")}delete this.arRatingLikeProcess[t]};BitrixMSL.prototype.checkVisibility=function(e){var t=e.node;if(BX.hasClass(document.body,"lenta-page")){var o=oMSL.checkImageOffset(t);if(o===false){e.status=BitrixMobile.LazyLoad.status.hidden}return o}else if(!oMSL.isPostFull()&&oMSL.isImageFromPost(e)){return oMSL.checkImageOffset(t)}return true};BitrixMSL.prototype.checkImageOffset=function(e){if(!BX.hasClass(e.parentNode,"post-item-attached-img-block")){return e.offsetTop<315}return true};BitrixMSL.prototype.isPostFull=function(){var e=BX("post_block_check_cont_"+this.logId)?BX("post_block_check_cont_"+this.logId):BX("post_block_check_cont",true);return BX.hasClass(e,this.classes.postItemBlockFull)||BX.hasClass(e,"lenta-info-block-wrapp-full")};BitrixMSL.prototype.isImageFromPost=function(e){if(typeof e.fromPost!="undefined"){return e.fromPost}var t=5;var o=e.node;while(o=o.parentNode){if(BX.hasClass(o,"post-item-post-block")){e.fromPost=true;return true}if(t<=0){e.fromPost=false;return false}t--}};BitrixMSL.prototype.isUserCurrent=function(e){return e==BX.message("USER_ID")};BitrixMSL.prototype.checkNodesHeight=function(){var e=false,t=null,o=null;for(var i in this.arBlockToCheck){t=this.arBlockToCheck[i];o=BX(t.lenta_item_id)?BX(t.lenta_item_id).querySelector(".post-more-block"):false;if(o&&BX(t.text_block_id)){e=BX(t.text_block_id).offsetHeight;if(BX(t.title_block_id)){e+=BX(t.title_block_id).offsetHeight}if(BX(t.files_block_id)){e+=BX(t.files_block_id).offsetHeight}if(e>=320&&!BX.hasClass(t.text_block_id,this.classes.postItemBlockFull)){o.style.display="block";if(BX(t.lenta_item_id)){BX.removeClass(BX(t.lenta_item_id),"post-without-informers")}if(BX(t.more_button_id)){BX(t.more_button_id).style.display="block"}}else{if(o){o.style.display="none"}if(BX(t.more_button_id)){BX(t.more_button_id).style.display="none"}}}}};BitrixMSL.prototype.initScroll=function(e,t){e=!!e;t=!!t;if(e){BX.unbind(window,"scroll",__MSLOnFeedScroll);BX.bind(window,"scroll",__MSLOnFeedScroll)}else{BX.unbind(window,"scroll",__MSLOnFeedScroll)}if(t&&BX("next_post_more")){BX("next_post_more").style.display=e?"block":"none"}};BitrixMSL.prototype.onScrollDetail=function(){if(!oMSL.canCheckScrollButton){return}clearTimeout(oMSL.showScrollButtonTimeout);oMSL.showScrollButtonTimeout=setTimeout(function(){oMSL.iLastActivityDate=Math.round((new Date).getTime()/1e3);oMSL.checkScrollButton()},200)};BitrixMSL.prototype.checkScrollButton=function(){oMSL.windowSize=BX.GetWindowSize();var e=window.scrollY,t=oMSL.windowSize.scrollHeight-oMSL.windowSize.innerHeight-100;oMSL.showScrollButtonBottom=!(oMSL.windowSize.scrollHeight-oMSL.windowSize.innerHeight<=0||e>=t&&(e>0||t>0));oMSL.showScrollButtonTop=e>200;oMSL.showHideScrollButton()};BitrixMSL.prototype.showHideScrollButton=function(){var e=BX("post-scroll-button-bottom");if(e){if(oMSL.showScrollButtonBottom){if(!e.classList.contains("post-comment-block-scroll-bottom-active")){e.classList.add("post-comment-block-scroll-bottom-active")}}else{if(e.classList.contains("post-comment-block-scroll-bottom-active")){e.classList.remove("post-comment-block-scroll-bottom-active")}}}var t=BX("post-scroll-button-top");if(t){if(oMSL.showScrollButtonTop){if(!t.classList.contains("post-comment-block-scroll-top-active")){t.classList.add("post-comment-block-scroll-top-active")}}else{if(t.classList.contains("post-comment-block-scroll-top-active")){t.classList.remove("post-comment-block-scroll-top-active")}}}};BitrixMSL.prototype.scrollTo=function(e){if(e!="top"){e="bottom"}oMSL.canCheckScrollButton=false;oMSL.showScrollButtonBottom=false;oMSL.showScrollButtonTop=false;oMSL.showHideScrollButton();var t=window.scrollY,o=null;if(e=="bottom"){o=oMSL.windowSize.scrollHeight}else{o=0}BitrixAnimation.animate({duration:500,start:{scroll:t},finish:{scroll:o},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function(e){window.scrollTo(0,e.scroll)},complete:function(){oMSL.canCheckScrollButton=true;oMSL.checkScrollButton()}})};BitrixMSL.prototype.getComments=function(e){var t=e.ts;var o=!!e.bPullDown;var i=typeof e.obFocus.form=="undefined"||e.obFocus.form=="NO"?"NO":"YES";var n=typeof e.obFocus.comments=="undefined"||e.obFocus.comments=="NO"?"NO":"YES";var a=this.logId;if(!o){if(typeof e.bPullDownTop=="undefined"||e.bPullDownTop){BXMobileApp.UI.Page.Refresh.start()}BX.cleanNode(BX("post-comments-wrap"));BX("post-comments-wrap").appendChild(BX.create("SPAN",{props:{id:"post-comment-last-after"}}))}oMSL.showEmptyCommentsBlockWaiter(BX("post-comments-wrap"),true);var s=document.querySelector(".feed-post-emoji-popup-container");if(s){s.style.top=0;s.style.left=0;s.classList.remove("feed-post-emoji-popup-active");s.classList.remove("feed-post-emoji-popup-active-final");s.classList.remove("feed-post-emoji-popup-active-final-item");s.classList.add("feed-post-emoji-popup-invisible-final");s.classList.add("feed-post-emoji-popup-invisible-final-mobile")}var r=new MobileAjaxWrapper;oMSL.emptyCommentsXhr=r.Wrap({type:"json",method:"GET",url:BX.message("MSLPathToLogEntry").replace("#log_id#",a)+"&empty_get_comments=Y"+(typeof t!="undefined"&&t!=null?"&LAST_LOG_TS="+t:""),data:"",processData:true,callback:function(s){var r=BX("post-comments-form-wrap");var l=BX("post-comments-wrap");if(o){app.pullDownLoadingStop()}else if(typeof e.bPullDownTop=="undefined"||e.bPullDownTop){BXMobileApp.UI.Page.Refresh.stop()}oMSL.showEmptyCommentsBlockWaiter(l,false);if(BX.type.isNotEmptyString(s.POST_PERM)){oMSL.menuData.post_perm=s.POST_PERM;oMSL.detailPageMenuItems=oMSL.buildDetailPageMenu(oMSL.menuData);oMSL.initPageMenu("detail")}if(BX.type.isNotEmptyString(s.TEXT)){if(o){BX.cleanNode(l);if(typeof s.POST_NUM_COMMENTS!="undefined"){if(BX("informer_comments_common")){BX("informer_comments_common").style.display="inline";BX("informer_comments_common").innerHTML=parseInt(s.POST_NUM_COMMENTS);if(BX("informer_comments_all")){BX("informer_comments_all").style.display="none"}if(BX("informer_comments_new")){BX("informer_comments_new").style.display="none"}}BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:a,num:parseInt(s.POST_NUM_COMMENTS)},true)}}BX.clearNodeCache();__MSLRepositLog(a,{POST_NUM_COMMENTS:s.POST_NUM_COMMENTS});var d=BX.processHTML(s.TEXT,true);l.innerHTML=d.HTML;l.appendChild(BX.create("SPAN",{props:{id:"post-comment-last-after"}}));var p=0,m=function(){p++;if(p<100){if(BX("post-comments-wrap").childNodes.length>0){BX.ajax.processScripts(d.SCRIPT)}else{BX.defer(m,this)()}}};BX.defer(m,this)();BX.onCustomEvent(window,"BX.UserContentView.onInitCall",[{mobile:true,ajaxUrl:BX.message("MSLSiteDir")+"mobile/ajax.php",commentsContainerId:"post-comments-wrap",commentsClassName:"post-comment-wrap"}]);BX.onCustomEvent(window,"BX.UserContentView.onClearCall",[]);if(!o){if(r){r.innerHTML=""}__MSLDetailPullDownInit(true);if(i=="YES"){oMSL.setFocusOnComments("form")}else if(n=="YES"){oMSL.setFocusOnComments("list")}}oMSL.iLastActivityDate=Math.round((new Date).getTime()/1e3);oMSL.checkScrollButton()}else{if(!o){oMSL.showEmptyCommentsBlockWaiter(l,false)}oMSL.showEmptyCommentsBlockFailed(l,t,o,i,s)}},callback_failure:function(){var e=BX("post-comments-wrap");if(o){app.pullDownLoadingStop();bReload=false}else{BXMobileApp.UI.Page.Refresh.stop()}oMSL.showEmptyCommentsBlockWaiter(e,false);oMSL.showEmptyCommentsBlockFailed(e,t,o,i)}})};BitrixMSL.prototype.refreshPostDetail=function(){var e=new MobileAjaxWrapper;e.runAction("socialnetwork.api.livefeed.mobileGetDetail",{data:{logId:this.getLogId()}}).then(function(e){if(BX.type.isPlainObject(e.data)&&BX.type.isNotEmptyString(e.data.html)&&BX("post_block_check_cont")){BX.html(BX("post_block_check_cont"),e.data.html);this.registerEmptyBlockToCheck();setTimeout(function(){this.checkNodesHeight();BitrixMobile.LazyLoad.showImages()}.bind(this),500)}}.bind(this),function(e){})};BitrixMSL.prototype.formatTaskDescription=function(e,t,o,i){var n=e;i=BX.type.isNotEmptyString(i)?"_"+i:"";if(!!t&&!!o&&t.length>0){n+="<br><br>"+BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_"+o+i).replace("#A_BEGIN#","[URL="+t+"]").replace("#A_END#","[/URL]")}return n};BitrixMSL.prototype.createTask=function(e){app.showPopupLoader();BMAjaxWrapper.runAction("socialnetwork.api.livefeed.getRawEntryData",{data:{params:{entityType:e.entityType,entityId:e.entityId,logId:BX.type.isNumber(e.logId)?e.logId:null,additionalParams:{getSonetGroupAvailable:"Y",getLivefeedUrl:"Y",checkPermissions:{feature:"tasks",operation:"create_tasks"}}}}}).then(function(t){var o=t.data;if(typeof o.TITLE!="undefined"&&typeof o.DESCRIPTION!="undefined"&&typeof o.DISK_OBJECTS!="undefined"&&(BX.type.isNotEmptyString(o.TITLE)||BX.type.isNotEmptyString(o.DESCRIPTION))&&BX.type.isNotEmptyString(o.LIVEFEED_URL)){var i=this.formatTaskDescription(o.DESCRIPTION,o.LIVEFEED_URL,e.entityType,BX.type.isNotEmptyString(o.SUFFIX)?o.SUFFIX:"");var n={TITLE:o.TITLE,DESCRIPTION:i,RESPONSIBLE_ID:BX.message("USER_ID"),CREATED_BY:BX.message("USER_ID"),UF_TASK_WEBDAV_FILES:o.DISK_OBJECTS};var a=[];if(typeof o.GROUPS_AVAILABLE!="undefined"){for(var s in o.GROUPS_AVAILABLE){if(o.GROUPS_AVAILABLE.hasOwnProperty(s)){a.push(o.GROUPS_AVAILABLE[s])}}}if(a.length==1){n.GROUP_ID=parseInt(a[0])}new BX.Tasks.Util.Query({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir")+"mobile/":"/mobile/")+"?mobile_action=task_ajax"}).add("task.add",{data:n},{},{onExecuted:BX.proxy(function(t,o){app.hidePopupLoader();if(typeof o!="undefined"&&typeof o.RESULT!="undefined"&&typeof o.RESULT.DATA!="undefined"&&typeof o.RESULT.DATA.ID!="undefined"&&parseInt(o.RESULT.DATA.ID)>0){this.createTaskSetContentSuccess(o.RESULT.DATA.ID);BMAjaxWrapper.runAction("socialnetwork.api.livefeed.createTaskComment",{data:{params:{postEntityType:BX.type.isNotEmptyString(e.postEntityType)?e.postEntityType:e.entityType,entityType:e.entityType,entityId:e.entityId,taskId:o.RESULT.DATA.ID,logId:BX.type.isNumber(e.logId)?e.logId:null}}}).then(function(e){},function(e){})}else{this.createTaskSetContentFailure(t.getMessages())}},this)}).execute()}else{app.hidePopupLoader();this.createTaskSetContentFailure([BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_ERROR_GET_DATA")])}}.bind(this),function(e){app.hidePopupLoader();this.createTaskSetContentFailure([BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_ERROR_GET_DATA")])}.bind(this))};BitrixMSL.prototype.createTaskSetContentSuccess=function(e){app.confirm({title:BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_TITLE"),text:BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_DESCRIPTION"),buttons:[BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_BUTTON_CANCEL"),BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_BUTTON_OK")],callback:function(t){if(t==2){app.loadPageBlank({url:BX.message("MOBILE_EXT_LIVEFEED_TASK_PATH").replace("#user_id#",BX.message("USER_ID")).replace("#task_id#",e),bx24ModernStyle:true})}}})};BitrixMSL.prototype.createTaskSetContentFailure=function(e){app.alert({title:BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_FAILURE_TITLE"),text:e.join(". ")})};BitrixMSL.prototype.copyLink=function(e){var t=BX.type.isNotEmptyString(e.entityType)?e.entityType:"",o=parseInt(e.entityId)>0?parseInt(e.entityId):0;if(!BX.type.isNotEmptyString(t)||o<=0){return}var i=new MobileAjaxWrapper;i.runAction("socialnetwork.api.livefeed.getRawEntryData",{data:{params:{entityType:t,entityId:o,additionalParams:{getLivefeedUrl:"Y",absoluteUrl:"Y",returnFields:["LIVEFEED_URL"]}}}}).then(function(e){this.copyLinkSuccess(e.data)}.bind(this),function(e){})};BitrixMSL.prototype.copyLinkSuccess=function(e){if(!BX.type.isNotEmptyString(e.LIVEFEED_URL)){return}app.exec("copyToClipboard",{text:e.LIVEFEED_URL});BX.MobileLivefeed.NotificationBarInstance.showInfo({id:"copy",text:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_GET_LINK_SUCCESS"),groupId:"clipboard",maxLines:1})};BitrixMSL.prototype.setPostFormParams=function(e){if(typeof e=="object"){for(var t in e){if((t=="selectedRecipients"||t=="messageText"||t=="messageFiles")&&e.hasOwnProperty(t)){oMSL.newPostFormParams[t]=e[t]}}}};BitrixMSL.prototype.setPostFormExtraData=function(e){if(typeof e=="object"){for(var t in e){if((t=="hiddenRecipients"||t=="logId"||t=="postId"||t=="postAuthorId"||t=="messageUFCode"||t=="commentId"||t=="commentType"||t=="nodeId")&&e.hasOwnProperty(t)){oMSL.newPostFormExtraData[t]=e[t]}}}};BitrixMSL.prototype.setPostFormExtraDataArray=function(e){var t=null;for(var o in e){if(e.hasOwnProperty(o)){t={};t[o]=e[o];this.setPostFormExtraData(t)}}};BitrixMSL.prototype.getPostFormExtraData=function(){return oMSL.newPostFormExtraData};BitrixMSL.prototype.showNewPostForm=function(e){if(!BX.type.isNotEmptyObject(e)){e={}}var t=BX.type.isNotEmptyString(e.entityType)?e.entityType:"post";var o=this.getPostFormExtraData();var i={attachButton:this.getPostFormAttachButton(),mentionButton:this.getPostFormMentionButton(),attachFileSettings:this.getPostFormAttachFileSettings(),extraData:o?o:{},smileButton:{},supportLocalFilesInText:t=="post",okButton:{callback:function(o){if(o.text.length>0){var i=oMSL.buildPostFormRequestStub({type:t,extraData:o.extraData,text:oMSL.parseMentions(o.text)});var n=o.extraData.messageUFCode;oMSL.buildPostFormFiles(i,o.attachedFiles,{ufCode:n}).then(function(){if(t=="post"){oMSL.buildPostFormDestinations(i,o.selectedRecipients,typeof o.extraData!="undefined"&&typeof o.extraData.hiddenRecipients!="undefined"?o.extraData.hiddenRecipients:[],{});if(i.postVirtualId){i.ufCode=n;i.contentType="post";oMSL.initPostForm({groupId:e.groupId?e.groupId:null});BXMobileApp.onCustomEvent("Livefeed.PublicationQueue::setItem",{key:i.postVirtualId,item:i,pageId:BX.MobileLivefeed.Instance.getPageId(),groupId:e.groupId?e.groupId:null},true)}}},function(){})}},name:BX.message("MSLPostFormSend")}};if(typeof oMSL.newPostFormParams.messageText!="undefined"){i.message={text:oMSL.newPostFormParams.messageText}}if(typeof oMSL.newPostFormParams.messageFiles!="undefined"){i.attachedFiles=oMSL.newPostFormParams.messageFiles}if(t=="post"){i.recipients={dataSource:oMSL.getPostFormRecipientsDataSource()};if(typeof oMSL.newPostFormParams.selectedRecipients!="undefined"){i.recipients.selectedRecipients=oMSL.newPostFormParams.selectedRecipients}}return i};BitrixMSL.prototype.findDestinationCallBack=function(e,t,o){return e.id==this.value};BitrixMSL.prototype.addPostFormDestination=function(e,t){if(typeof t=="undefined"||typeof t.type=="undefined"){return}var o=null;if(t.type=="UA"){o=e.a_users.some(this.findDestinationCallBack,{value:0});if(!o){e.a_users.push({id:0,name:BX.message("MSLPostDestUA"),bubble_background_color:"#A7F264",bubble_text_color:"#54901E"})}}else if(t.type=="U"){o=e.a_users.some(this.findDestinationCallBack,{value:t.id});if(!o){e.a_users.push({id:t.id,name:t.name,bubble_background_color:"#BCEDFC",bubble_text_color:"#1F6AB5"})}}else if(t.type=="SG"){o=e.b_groups.some(this.findDestinationCallBack,{value:t.id});if(!o){e.b_groups.push({id:t.id,name:t.name,bubble_background_color:"#FFD5D5",bubble_text_color:"#B54827"})}}};BitrixMSL.prototype.getPostFormAttachButton=function(){var e=[];if(BX.message("MSLbDiskInstalled")=="Y"||BX.message("MSLbWebDavInstalled")=="Y"){var t={id:"disk",name:BX.message("MSLPostFormDisk"),dataSource:{multiple:"NO",url:BX.message("MSLbDiskInstalled")=="Y"?BX.message("MSLSiteDir")+"mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId="+BX.message("USER_ID"):BX.message("MSLSiteDir")+"mobile/webdav/user/"+BX.message("USER_ID")+"/"}};var o={searchField:"YES",showtitle:"YES",modal:"YES",name:BX.message("MSLPostFormDiskTitle")};if(platform=="ios"){t.dataSource.table_settings=o}else{t.dataSource.TABLE_SETTINGS=o}e.push(t)}e.push({id:"mediateka",name:BX.message("MSLPostFormPhotoGallery")});e.push({id:"camera",name:BX.message("MSLPostFormPhotoCamera")});return{items:e}};BitrixMSL.prototype.getPostFormMentionButton=function(){return{dataSource:{return_full_mode:"YES",outsection:"NO",okname:BX.message("MSLPostFormTableOk"),cancelname:BX.message("MSLPostFormTableCancel"),multiple:"NO",alphabet_index:"YES",url:BX.message("MSLSiteDir")+"mobile/index.php?mobile_action=get_user_list&use_name_format=Y"}}};BitrixMSL.prototype.getPostFormAttachFileSettings=function(){return{resize:[40,1,1,1e3,1e3,0,2,false,true,false,null,0],saveToPhotoAlbum:true}};BitrixMSL.prototype.getPostFormRecipientsDataSource=function(){return{return_full_mode:"YES",outsection:BX.message("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DENIED")!="Y"?"YES":"NO",okname:BX.message("MSLPostFormTableOk"),cancelname:BX.message("MSLPostFormTableCancel"),multiple:"YES",alphabet_index:"YES",showtitle:"YES",user_all:"YES",url:BX.message("MSLSiteDir")+"mobile/index.php?mobile_action="+(BX.message("MSLIsExtranetSite")=="Y"?"get_group_list":"get_usergroup_list")+"&feature=blog"}};BitrixMSL.prototype.getDiskUploadFolder=function(){};BitrixMSL.prototype.buildPostFormFiles=function(e,t,o){var i=new Promise(function(i,n){var a=o.ufCode;e.postVirtualId=parseInt(Math.random()*1e5);e.tasksList=[];if(typeof t!="undefined"&&t.length>0){var s=0;var r=t.length;var l=function(){s++;if(s>=r){this.postProgressingFiles(e,t,o);i()}}.bind(this);var d=[],p=null,m=null,f=null,c=null;t.forEach(function(t){f=typeof t.VALUE!="undefined"||typeof t.id!="undefined"&&parseInt(t.id)>0||BX.type.isNotEmptyObject(t.dataAttributes)&&typeof t.dataAttributes.VALUE!="undefined"||BX.type.isNotEmptyString(t.ufCode)&&t.ufCode==a;m=typeof t.url=="undefined"||typeof t.id!="number";if(t.url&&m&&!f){p="postTask_"+parseInt(Math.random()*1e5);c=BX.MobileUtils.getFileMimeType(t.type);d.push({taskId:p,type:t.type,mimeType:c,folderId:parseInt(BX.message("MOBILE_EXT_UTILS_USER_FOLDER_FOR_SAVED_FILES")),chunk:parseInt(BX.message("MOBILE_EXT_UTILS_MAX_UPLOAD_CHUNK_SIZE")),params:{postVirtualId:e.postVirtualId},name:t.name,url:t.url,previewUrl:t.previewUrl?t.previewUrl:null,resize:BX.MobileUtils.getResizeOptions(t.type)});e.tasksList.push(p)}else{if(f){if(typeof e[a]=="undefined"){e[a]=[]}if(typeof t.VALUE!="undefined"){e[a].push(t.VALUE)}else if(parseInt(t.id)>0){e[a].push(parseInt(t.id))}else{e[a].push(t.dataAttributes.VALUE)}}l()}}.bind(this));if(d.length>0){BXMobileApp.onCustomEvent("onFileUploadTaskReceived",{files:d},true)}i()}else{this.postProgressingFiles(e,t,o);i()}}.bind(this));i.catch(function(e){console.error(e)});return i};BitrixMSL.prototype.postProgressingFiles=function(e,t,o){var i=o.ufCode;if(typeof e[i]=="undefined"){e[i]=[]}if(typeof t=="undefined"){t=[]}for(var n in oMSL.newPostFormParams.messageFiles){if(oMSL.newPostFormParams.messageFiles.hasOwnProperty(n)){for(var a in t){if(t.hasOwnProperty(a)&&(oMSL.newPostFormParams.messageFiles[n]["id"]==t[a]["id"]||oMSL.newPostFormParams.messageFiles[n]["id"]==t[a]["ID"])){e[i].push(oMSL.newPostFormParams.messageFiles[n]["id"]);break}}}}if(e[i].length<=0){e[i].push("empty")}};BitrixMSL.prototype.buildPostFormDestinations=function(e,t,o,i){var n=null,a=null,s=null,r=null,l=null;e["DEST"]=[];if(typeof t.a_users!="undefined"){for(r in t.a_users){if(t.a_users.hasOwnProperty(r)){n="U";if(typeof e.SPERM[n]=="undefined"){e.SPERM[n]=[]}if(typeof e.SPERM_NAME[n]=="undefined"){e.SPERM_NAME[n]=[]}a=typeof t.a_users[r].ID!="undefined"?t.a_users[r].ID:t.a_users[r].id;s=typeof t.a_users[r].NAME!="undefined"?t.a_users[r].NAME:t.a_users[r].name;l=a==0?"UA":"U"+a;e.SPERM[n].push(l);e.DEST.push(l);e.SPERM_NAME[n].push(s)}}}if(typeof t.b_groups!="undefined"){for(r in t.b_groups){if(t.b_groups.hasOwnProperty(r)){n="SG";if(typeof e.SPERM[n]=="undefined"){e.SPERM[n]=[]}if(typeof e.SPERM_NAME[n]=="undefined"){e.SPERM_NAME[n]=[]}a=typeof t.b_groups[r].ID!="undefined"?t.b_groups[r].ID:t.b_groups[r].id;s=typeof t.b_groups[r].NAME!="undefined"?t.b_groups[r].NAME:t.b_groups[r].name;l="SG"+a;e.SPERM[n].push(l);e.DEST.push(l);e.SPERM_NAME[n].push(s)}}}for(r in o){if(o.hasOwnProperty(r)){n=o[r]["TYPE"];if(typeof e.SPERM[n]=="undefined"){e.SPERM[n]=[]}l=o[r]["TYPE"]+o[r]["ID"];e.SPERM[n].push(l);e.DEST.push(l)}}};BitrixMSL.prototype.buildSelectedDestinations=function(e,t){if(typeof e.SPERM=="undefined"||typeof e.SPERM_NAME=="undefined"){return}var o=key=null;if(typeof e.SPERM.U!="undefined"){for(key in e.SPERM.U){if(e.SPERM.U.hasOwnProperty(key)){if(e.SPERM.U[key]=="UA"){this.addPostFormDestination(t,{type:"UA"})}else{o=e.SPERM.U[key].match(/^U([\d]+)$/);if(o!=null){this.addPostFormDestination(t,{type:"U",id:o[1],name:e.SPERM_NAME.U[key]})}}}}}if(typeof e.SPERM.SG!="undefined"){for(key in e.SPERM.SG){if(e.SPERM.SG.hasOwnProperty(key)){o=e.SPERM.SG[key].match(/^SG([\d]+)$/);if(o!=null){this.addPostFormDestination(t,{type:"SG",id:o[1],name:e.SPERM_NAME.SG[key]})}}}}};BitrixMSL.prototype.buildPostFormRequestStub=function(e){var t=null;if(e.type=="post"){t={ACTION:"ADD_POST",AJAX_CALL:"Y",PUBLISH_STATUS:"P",is_sent:"Y",apply:"Y",sessid:BX.bitrix_sessid(),POST_MESSAGE:e.text,decode:"Y",SPERM:{},SPERM_NAME:{},MOBILE:"Y",PARSE_PREVIEW:"Y"};if(typeof e.extraData.postId!="undefined"&&parseInt(e.extraData.postId)>0){t.post_id=parseInt(e.extraData.postId);t.post_user_id=parseInt(e.extraData.postAuthorId);t.ACTION="EDIT_POST";if(typeof e.extraData.logId!="undefined"&&parseInt(e.extraData.logId)>0){t.log_id=parseInt(e.extraData.logId)}}}else if(e.type=="comment"&&typeof e.extraData.commentId!="undefined"&&parseInt(e.extraData.commentId)>0&&typeof e.extraData.commentType!="undefined"&&e.extraData.commentType.length>0){t={action:"EDIT_COMMENT",text:oMSL.parseMentions(e.text),commentId:parseInt(e.extraData.commentId),nodeId:e.extraData.nodeId,sessid:BX.bitrix_sessid()};if(e.extraData.commentType=="blog"){t.comment_post_id=commentVarBlogPostID}else{}}return t};BitrixMSL.prototype.initPostForm=function(e){if(!BX.type.isNotEmptyObject(e)){e={}}var t=e.groupId?e.groupId:false,o=e.callback?e.callback:function(){},i={a_users:[],b_groups:[]};oMSL.clearPostFormDestination(i,t);oMSL.setPostFormExtraDataArray({postId:false,postAuthorId:false,logId:false,messageUFCode:BX.message("MOBILE_EXT_LIVEFEED_POST_UF_CODE")});oMSL.setPostFormParams({selectedRecipients:i,messageText:"",messageFiles:[]});setTimeout(function(){BX.MobileLivefeed.DatabaseUnsentPostInstance.load({onLoad:function(e){var t=null;i={a_users:[],b_groups:[]};if(typeof e.SPERM!="undefined"&&typeof e.SPERM.U!="undefined"&&e.SPERM.U!=null){for(t=0;t<e.SPERM.U.length;t++){if(e.SPERM.U[t]=="UA"){if(BX.message("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DENIED")!="Y"){oMSL.addPostFormDestination(i,{type:"UA"})}}else{oMSL.addPostFormDestination(i,{type:"U",id:e.SPERM.U[t].replace("U",""),name:typeof e.SPERM_NAME!="undefined"&&typeof e.SPERM_NAME.U!="undefined"&&typeof e.SPERM_NAME.U[t]!="undefined"&&e.SPERM_NAME.U[t]!=null?e.SPERM_NAME.U[t]:""})}}}if(typeof e.SPERM!="undefined"&&typeof e.SPERM.SG!="undefined"&&e.SPERM.SG!=null){for(t=0;t<e.SPERM.SG.length;t++){oMSL.addPostFormDestination(i,{type:"SG",id:e.SPERM.SG[t].replace("SG",""),name:typeof e.SPERM_NAME.SG[t]!="undefined"&&typeof e.SPERM_NAME.SG!="undefined"&&typeof e.SPERM_NAME.SG[t]!="undefined"&&e.SPERM_NAME.SG[t]!=null?e.SPERM_NAME.SG[t]:""})}}oMSL.setPostFormParams({selectedRecipients:i});if(typeof e.POST_MESSAGE!="undefined"&&e.POST_MESSAGE!=null){oMSL.setPostFormParams({messageText:oMSL.unParseMentions(e.POST_MESSAGE)})}o()},onEmpty:function(e){i={a_users:[],b_groups:[]};oMSL.clearPostFormDestination(i,t);o()}},t)},0)};BitrixMSL.prototype.clearPostFormDestination=function(e,t){if(typeof t!="undefined"&&parseInt(t)>0){oMSL.addPostFormDestination(e,{type:"SG",id:parseInt(t),name:BX.message("MSLGroupName")})}else if(window.arAvailableGroup!==false){for(key in window.arAvailableGroup){if(window.arAvailableGroup.hasOwnProperty(key)){oMSL.addPostFormDestination(e,{type:"SG",id:parseInt(window.arAvailableGroup[key]["entityId"]),name:window.arAvailableGroup[key]["name"]})}}}else if(BX.message("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DEFAULT")=="Y"){oMSL.addPostFormDestination(e,{type:"UA"})}};BitrixMSL.prototype.processAjaxBlock=function(e,t){if(!t||typeof t.type=="undefined"||!BX.util.in_array(t.type,["refresh","next"])){return}var o=false;var i=false;n(a);s(r);function n(t){if(BX.type.isArray(e.CSS)&&e.CSS.length>0){BX.load(e.CSS,t)}else{t()}}function a(){if(t.type=="refresh"){BX("lenta_wrapper_global").innerHTML=e.CONTENT}else{BX("lenta_wrapper").insertBefore(BX.create("DIV",{html:e.CONTENT}),BX("next_post_more"))}o=true;if(i){r()}}function s(t){if(BX.type.isArray(e.JS)&&e.JS.length>0){BX.load(e.JS,t)}else{t()}}function r(){i=true;if(o){BX.ajax.processRequestData(e.CONTENT,{scriptsRunFirst:false,dataType:"HTML",onsuccess:function(){if(typeof t.callback=="function"){t.callback()}}})}}};BitrixMSL.prototype.onUpdateSocnetCountersHandler=function(e){oMSL.bCounterReceived=true;oMSL.changeCounter(parseInt(e[strCounterType]))};BitrixMSL.prototype.onUpdateCounterHandler=function(e){if(typeof e[BX.message("SITE_ID")]!="undefined"){oMSL.onImUpdateCounterHandler(e[BX.message("SITE_ID")])}};BitrixMSL.prototype.onImUpdateCounterHandler=function(e){oMSL.bCounterReceived=true;if(typeof e.obZeroDate!="undefined"){var t=e.obZeroDate;delete e.obZeroDate}oMSL.changeCounter(parseInt(e[strCounterType]),typeof t!="undefined"&&t[strCounterType]!="undefined"?parseInt(t[strCounterType]):null)};BitrixMSL.prototype.registerBlocksToCheck=function(){var e=null;var t=null;var o=null;var i=null;if(BX("post-card-wrap")){e=BX("post-card-wrap")}else if(BX("lenta_wrapper")){e=BX("lenta_wrapper")}if(e){t=e.querySelectorAll(".post-wrap");if(t.length<=0){t=e.querySelectorAll(".lenta-item")}}if(t!=null){for(var n=0;n<t.length;n++){if(BX.type.isNotEmptyString(t[n].id)){i=t[n].id.match(/^lenta_item_([\d]+)$/i);if(i!=null){o=i[1];if(!BX.util.in_array(o,this.blocksToCheckRegisteredList)){this.arBlockToCheck[o]={lenta_item_id:"lenta_item_"+o,text_block_id:"post_block_check_"+o,title_block_id:"post_block_check_title_"+o,files_block_id:"post_block_check_files_"+o,more_button_id:"post_more_limiter_"+o};this.blocksToCheckRegisteredList.push(o)}}}}}};BitrixMSL.prototype.registerEmptyBlockToCheck=function(){oMSL.arBlockToCheck={0:{lenta_item_id:"lenta_item",text_block_id:"post_block_check_cont",title_block_id:"post_block_check_title",more_button_id:"post_more_limiter"}}};BitrixMSL.prototype.onMobilePlayerError=function(e){var t=e.getData(),o=t[0],i=t[1];if(!BX.type.isDomNode(o)){return}if(!i){return}var n=o.parentNode;if(n){if(BX.findChildByClassName(n,"disk-mobile-player-error-container")){return}}else{if(BX.findChildByClassName(o,"disk-mobile-player-error-container")){return}}var a=o.getElementsByTagName("source");var s=a.length;for(var r=0;r<a.length;r++){if(a[r].src&&a[r].src==i){BX.remove(a[r]);s--}}if(s>0){return}var l=BX.create("div",{props:{className:"disk-mobile-player-error-container"},children:[BX.create("div",{props:{className:"disk-mobile-player-error-icon"},html:""}),BX.create("div",{props:{className:"disk-mobile-player-error-message"},html:BX.message("MSLMobilePlayerErrorMessage")})]});var d=BX.findChildByClassName(l,"disk-mobile-player-download");if(d){BX.adjust(d,{events:{click:function(){app.openDocument({url:i})}}})}if(n){BX.hide(o);BX.append(l,n)}else{BX.adjust(o,{children:[l]})}};BitrixMSL.prototype.getCopyText=function(e){function t(e){var t=document.createElement("textarea");t.innerHTML=e;return t.value}var o=e.innerHTML.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<br\s*[\/]?>/gi,"~~~---~~~").replace(/~~~---~~~/g,"\n");o=o.replace(/<a\s+href="([^"]+)"[^>]*>([^<]+)<\/a>/gi,function(e,t,o){if(o.match(/^http/gi)){return'<a href="'+t+'">'+t+"</a>"}else{return e}});return t(BX.util.strip_tags(o))};BitrixMSL.prototype.initPagePopupMenu=function(){if(Application.getApiVersion()>=34){var e=[];if(!oMSL.logId){e.push({type:"search",callback:function(){app.exec("showSearchBar")}})}var t=this.getPageMenuItems(this.pageType);if(BX.type.isArray(t)&&t.length>0){e.push({type:"more",callback:function(){this.showPageMenu(this.pageType)}.bind(this)})}app.exec("setRightButtons",{items:e})}};BitrixMSL.prototype.initSearchBar=function(){if(Application.getApiVersion()>=34){BX.addCustomEvent(window,"BX.MobileLF:onSearchBarTextChanged",BX.debounce(this.searchBarEventCallback,1500,this));BX.addCustomEvent(window,"BX.MobileLF:onSearchBarCancelButtonClicked",this.searchBarEventCallback.bind(this));BX.addCustomEvent(window,"BX.MobileLF:onSearchBarSearchButtonClicked",this.searchBarEventCallback.bind(this));BXMobileApp.UI.Page.params.set({useSearchBar:true});app.exec("setParamsSearchBar",{params:{callback:function(e){if(BX.util.in_array(e.eventName,["onSearchButtonClicked"])&&BX.type.isPlainObject(e.data)&&BX.type.isString(e.data.text)){if(e.data.text.length>=this.ftMinTokenSize){this.findTextMode=true}var t=null;switch(e.eventName){case"onSearchButtonClicked":t="BX.MobileLF:onSearchBarSearchButtonClicked";break;default:}if(t){BX.onCustomEvent(window,t,[{text:e.data.text}])}}else if(BX.util.in_array(e.eventName,["onCancelButtonClicked","onSearchHide"])){BX.onCustomEvent(window,"BX.MobileLF:onSearchBarCancelButtonClicked",[])}}.bind(this)}})}};BitrixMSL.prototype.searchBarEventCallback=function(e){var t=BX.type.isPlainObject(e)&&BX.type.isNotEmptyString(e.text)?e.text:"";if(t.length>=this.ftMinTokenSize){app.exec("showSearchBarProgress");__MSLRefresh(true,{find:t})}else if(this.findTextMode){if(this.xhr.refresh!=null){this.xhr.refresh.abort()}app.exec("hideSearchBarProgress");BX.frameCache.readCacheWithID("framecache-block-feed",function(e){if(!BX.type.isArray(e.items)||!BX("bxdynamic_feed_refresh")){return}for(var t=0;t<e.items.length;t++){if(BX.type.isNotEmptyString(e.items[t].ID)&&e.items[t].ID=="framecache-block-feed"){BX.html(BX("bxdynamic_feed_refresh"),e.items[t].CONTENT);__MSLDetailMoveTop();setTimeout(function(){BitrixMobile.LazyLoad.showImages()},1e3);break}}}.bind(this))}if(t.length<this.ftMinTokenSize){this.findTextMode=false}};if(!window.oMSL){oMSL=new BitrixMSL;window.oMSL=oMSL}function openTaskComponentByTaskId(e,t,o){o=o||{};o.selectedTab=o.selectedTab||"taskTab";BXMobileApp.Events.postToComponent("taskbackground::task::action",[{taskId:t,data:o}],"background");e.preventDefault();e.stopPropagation();return false}
//# sourceMappingURL=script_attached.map.js