(function(){if(window["oMSL"])return;var e={},t={},o=function(o,n){var i=oMSL.getLogId();if(t[n.join("-")]!=="hidden"){t[n.join("-")]="hidden";if(e[i]){e[i]["POST_NUM_COMMENTS"]--;BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:i,num:e[i]["POST_NUM_COMMENTS"]},true)}}};BX.addCustomEvent(window,"OnUCommentWasDeleted",o);BX.addCustomEvent(window,"OnUCommentWasHidden",o);BX.addCustomEvent(window,"OnUCRecordHasDrawn",function(o,n){var i=oMSL.getLogId();t[o]=t[o]||{};if(t[n.join("-")]!=="drawn"){t[n.join("-")]="drawn";var a;if(e[i]&&(a=BX("record-"+n.join("-")+"-cover"))&&a&&a.parentNode==BX("record-"+o+"-new")){e[i]["POST_NUM_COMMENTS"]++;BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:i,num:e[i]["POST_NUM_COMMENTS"]},true)}}});BX.addCustomEvent(window,"OnUCFormSubmit",function(e,t,o,n){if(n&&n["mobile_action"]&&n["mobile_action"]=="add_comment"&&t>0){n["mobile_action"]=n["action"]="edit_comment";n["edit_id"]=t}});window.__MSLRepositLog=function(t,o){e[t]=o}})();function __MSLOnPostRead(e,t){if((e=BX(e))&&e&&!e.hasAttribute("done")){oMSL.setLogEntryImpPostRead({node:e,value:true});var o={mobile_action:"read_post",action:"read_post",post_id:e.getAttribute("bx-data-post-id"),options:[{post_id:e.getAttribute("bx-data-post-id"),name:"BLOG_POST_IMPRTNT",value:"Y"}],sessid:BX.bitrix_sessid()};BX.ajax({method:"GET",url:BX.message("SITE_DIR")+"mobile/index.php?"+BX.ajax.prepareData(o),dataType:"json",onsuccess:BX.delegate(function(t){if(typeof t.SUCCESS!="undefined"&&t.SUCCESS=="Y"){BXMobileApp.onCustomEvent("onLogEntryImpPostRead",{postId:o.post_id},true)}else{oMSL.setLogEntryImpPostRead({node:e,value:false})}},this),onfailure:function(){oMSL.setLogEntryImpPostRead({node:e,value:false})}});return true}return false}function __MSLOnFeedPreInit(e){if(typeof e.arAvailableGroup!="undefined"){window.arAvailableGroup=e.arAvailableGroup}BX.addCustomEvent("onFrameDataReceivedBefore",function(e){BitrixMobile.LazyLoad.clearImages()});BX.addCustomEvent("onFrameDataReceived",function(e){window.isPullDownEnabled=false;window.isPullDownLocked=false;window.isFrameDataReceived=true;app.pullDownLoadingStop();BitrixMobile.LazyLoad.showImages(true);BX.localStorage.set("mobileLivefeedRefreshTS",Math.round((new Date).getTime()/1e3),86400*30)});BX.addCustomEvent("onFrameDataProcessed",function(e,t){if(typeof e!="undefined"&&typeof e[0]!="undefined"&&typeof t!="undefined"&&t){if(typeof e[0]["PROPS"]!="undefined"&&typeof e[0]["PROPS"]["TS"]!="undefined"&&parseInt(e[0]["PROPS"]["TS"])>0){oMSL.iframeCacheTs=parseInt(e[0]["PROPS"]["TS"])}}BitrixMobile.LazyLoad.showImages(true)});BX.addCustomEvent("onCacheDataRequestStart",function(){setTimeout(function(){if(typeof window.isFrameDataReceived=="undefined"||!window.isFrameDataReceived){window.isPullDownLocked=true;app.exec("pullDownLoadingStart")}},1e3)});BX.addCustomEvent("onFrameDataReceivedError",function(){app.BasicAuth({success:BX.delegate(function(){BX.frameCache.update(true)}),failture:BX.delegate(function(){window.isPullDownLocked=false;app.pullDownLoadingStop();__MSLRefreshError(true)})})});BX.addCustomEvent("onFrameDataRequestFail",function(e){if(typeof e!="undefined"&&typeof e.reason!="undefined"&&e.reason=="bad_eval"){window.isPullDownLocked=false;app.pullDownLoadingStop();__MSLRefreshError(true)}else{app.BasicAuth({success:BX.delegate(function(){BX.frameCache.update(true)}),failture:BX.delegate(function(){window.isPullDownLocked=false;app.pullDownLoadingStop();__MSLRefreshError(true)})})}});BX.addCustomEvent("onCacheInvokeAfter",function(e,t){var o=t.items;if(o.length<=0){BX.frameCache.update(true,true)}});BXMobileApp.addCustomEvent("onAfterEdit",function(e){oMSL.afterEdit(e.postResponseData,e.postData.data.log_id)});BX.addCustomEvent("onPullDownDisable",function(){BXMobileApp.UI.Page.Refresh.setEnabled(false)});BX.addCustomEvent("onPullDownEnable",function(){BXMobileApp.UI.Page.Refresh.setEnabled(true)});BXMobileApp.UI.Page.Refresh.setParams({callback:function(){if(!window.isPullDownLocked){__MSLRefresh(true)}},backgroundColor:"#E7E9EB"});BXMobileApp.UI.Page.Refresh.setEnabled(true)}function __MSLOnFeedInit(e){logID=parseInt(e.logID);bAjaxCall=!!e.bAjaxCall;bReload=!!e.bReload;bEmptyPage=!!e.bEmptyPage;bFiltered=!!e.bFiltered;bEmptyGetComments=!!e.bEmptyGetComments;groupID=parseInt(e.groupID);tmstmp=parseInt(e.tmstmp);strCounterType=e.strCounterType;oMSL.bFollowDefault=!!e.bFollowDefault;oMSL.groupID=parseInt(e.groupID);oMSL.bShowExpertMode=!!e.bShowExpertMode;oMSL.bExpertMode=!!e.bExpertMode;oMSL.bDetailEmptyPage=bEmptyPage;oMSL.curUrl=e.curUrl;oMSL.appCacheDebug=!!e.appCacheDebug;if(!bAjaxCall){}if(logID<=0&&!bEmptyPage&&!bAjaxCall&&!bReload){oMSL.registerBlocksToCheck();if(typeof window.bFeedInitialized!="undefined"&&window.bFeedInitialized){if(!bAjaxCall){BX.ready(function(){var e=BX.GetWindowSize();window.maxScroll=e.scrollHeight-e.innerHeight-190;setTimeout(function(){oMSL.checkNodesHeight();BX.onCustomEvent(window,"BX.UserContentView.onRegisterViewAreaListCall",[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}])},1e3)})}return}else{BX.ready(function(){BX.onCustomEvent(window,"BX.UserContentView.onInitCall",[{mobile:true,ajaxUrl:BX.message("MSLSiteDir")+"mobile/ajax.php",commentsContainerId:"post-comments-wrap",commentsClassName:"post-comment-wrap"}])});window.bFeedInitialized=true}window.arLikeRandomID={};window.LiveFeedID=parseInt(Math.random()*1e5);oMSL.listPageMenuItems=[];if(groupID>0){BX.ready(function(){oMSL.listPageMenuItems.push({name:BX.message("MSLAddPost"),image:"/bitrix/templates/mobile_app/images/lenta/menu/pencil.png",action:function(){app.exec("showPostForm",oMSL.showNewPostForm())},arrowFlag:false});oMSL.listPageMenuItems.push({name:BX.message("MSLMenuItemGroupTasks"),icon:"checkbox",arrowFlag:true,action:function(){if(Application.getApiVersion()>=31){BXMobileApp.Events.postToComponent("taskbackground::task::action",[{groupId:groupID}],"background")}else{var e=BX.message("MSLPathToTasksRouter");e=e.replace("__ROUTE_PAGE__","list").replace("#USER_ID#",BX.message("USER_ID"));window.BXMobileApp.PageManager.loadPageUnique({url:e,bx24ModernStyle:true})}}});oMSL.listPageMenuItems.push({name:BX.message("MSLMenuItemGroupFiles"),action:function(){app.openBXTable({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/?mobile_action=disk_folder_list&type=group&path=/&entityId="+groupID,TABLE_SETTINGS:{type:"files",useTagsInSearch:false}})},arrowFlag:true,icon:"file"});if(BX.message("MSLPathToKnowledgeGroup")){oMSL.listPageMenuItems.push({name:BX.message("MSLTitleKnowledgeGroup"),image:"/bitrix/templates/mobile_app/images/lenta/menu/knowledge_base.png",action:function(){window.BXMobileApp.PageManager.loadPageUnique({url:BX.message("MSLPathToKnowledgeGroup"),bx24ModernStyle:true,cache:false})}})}oMSL.showPageMenu("list")})}else{BX.ready(function(){setTimeout(function(){if(!bFiltered){oMSL.listPageMenuItems.push({name:BX.message("MSLAddPost"),image:"/bitrix/templates/mobile_app/images/lenta/menu/pencil.png",action:function(){app.exec("showPostForm",oMSL.showNewPostForm())},arrowFlag:false});if(BX.message("MSLMenuItemWork")){oMSL.listPageMenuItems.push({name:BX.message("MSLMenuItemWork"),image:"/bitrix/templates/mobile_app/images/lenta/menu/work.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?work=Y",cache:false,bx24ModernStyle:true})}})}oMSL.listPageMenuItems.push({name:BX.message("MSLMenuItemFavorites"),image:"/bitrix/templates/mobile_app/images/lenta/menu/favorite.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?favorites=Y",cache:false,bx24ModernStyle:true})}});oMSL.listPageMenuItems.push({name:BX.message("MSLMenuItemMy"),image:"/bitrix/templates/mobile_app/images/lenta/menu/mine.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?my=Y",cache:false,bx24ModernStyle:true})}});oMSL.listPageMenuItems.push({name:BX.message("MSLMenuItemImportant"),image:"/bitrix/templates/mobile_app/images/lenta/menu/important.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?important=Y",cache:false,bx24ModernStyle:true})}});if(BX.message("MSLMenuItemBizproc")){oMSL.listPageMenuItems.push({name:BX.message("MSLMenuItemBizproc"),image:"/bitrix/templates/mobile_app/images/lenta/menu/workflow.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?bizproc=Y",cache:false,bx24ModernStyle:true})}})}oMSL.listPageMenuItems.push({name:BX.message("MSLMenuItemRefresh"),image:"/bitrix/templates/mobile_app/images/lenta/menu/n_refresh.png",arrowFlag:false,action:function(){oMSL.pullDownAndRefresh()}});if(oMSL.bUseFollow){oMSL.listPageMenuItems.push({name:oMSL.getFollowDefaultValue()?BX.message("MSLMenuItemFollowDefaultY"):BX.message("MSLMenuItemFollowDefaultN"),image:"/bitrix/templates/mobile_app/images/lenta/menu/glasses.png",arrowFlag:false,feature:"follow",action:function(){oMSL.setFollowDefault({value:!oMSL.getFollowDefaultValue()})}})}if(oMSL.bShowExpertMode){oMSL.listPageMenuItems.push({name:oMSL.bExpertMode?BX.message("MSLMenuItemExpertModeY"):BX.message("MSLMenuItemExpertModeN"),image:"/bitrix/templates/mobile_app/images/lenta/menu/expert.png",arrowFlag:false,feature:"expert",action:function(){oMSL.setExpertMode({value:!oMSL.bExpertMode})}})}oMSL.showPageMenu("list");app.addButtons({addPostButton:{type:"edit",style:"custom",callback:function(){app.exec("showPostForm",oMSL.showNewPostForm())}}})}else{BXMobileApp.UI.Page.TopBar.title.setText(BX.message("MSLLogTitle"));BXMobileApp.UI.Page.TopBar.title.setCallback("");BXMobileApp.UI.Page.TopBar.title.show()}},1e3)})}var t={a_users:[],b_groups:[]};oMSL.clearPostFormDestination(t,groupID);BX.MSL.DBLoad({onLoad:function(e){var o=null;t={a_users:[],b_groups:[]};if(typeof e.SPERM!="undefined"&&typeof e.SPERM.U!="undefined"&&e.SPERM.U!=null){for(o=0;o<e.SPERM.U.length;o++){if(e.SPERM.U[o]=="UA"){if(BX.message("MSLIsDenyToAll")!="Y"){oMSL.addPostFormDestination(t,{type:"UA"})}}else{oMSL.addPostFormDestination(t,{type:"U",id:e.SPERM.U[o].replace("U",""),name:typeof e.SPERM_NAME!="undefined"&&typeof e.SPERM_NAME.U!="undefined"&&typeof e.SPERM_NAME.U[o]!="undefined"&&e.SPERM_NAME.U[o]!=null?e.SPERM_NAME.U[o]:""})}}}if(typeof e.SPERM!="undefined"&&typeof e.SPERM.SG!="undefined"&&e.SPERM.SG!=null){for(o=0;o<e.SPERM.SG.length;o++){oMSL.addPostFormDestination(t,{type:"SG",id:e.SPERM.SG[o].replace("SG",""),name:typeof e.SPERM_NAME.SG[o]!="undefined"&&typeof e.SPERM_NAME.SG!="undefined"&&typeof e.SPERM_NAME.SG[o]!="undefined"&&e.SPERM_NAME.SG[o]!=null?e.SPERM_NAME.SG[o]:""})}}if(typeof e.POST_MESSAGE!="undefined"&&e.POST_MESSAGE!=null){oMSL.setPostFormParams({messageText:oMSL.unParseMentions(e.POST_MESSAGE)})}},onEmpty:function(e){t={a_users:[],b_groups:[]};oMSL.clearPostFormDestination(t,groupID)}},groupID>0?groupID:false);oMSL.setPostFormParams({selectedRecipients:t});oMSL.setPostFormExtraData({messageUFCode:BX.message("MSLPostFormUFCode")});BXMobileApp.addCustomEvent("onMPFSent",function(e){oMSL.onMPFSent(e,groupID)});BXMobileApp.addCustomEvent("onBlogPostDelete",function(e){oMSL.pullDownAndRefresh()});BX.ready(function(){if(bFiltered&&window.platform=="android"){BX.addCustomEvent("onOpenPageBefore",function(){oMSL.pullDownAndRefresh()})}});BX.addCustomEvent("onStreamRefresh",function(e){document.location.replace(document.location.href)});BXMobileApp.addCustomEvent("onLogEntryRead",function(e){__MSLLogEntryRead(e.log_id,e.ts,e.bPull===true||e.bPull==="YES")});BXMobileApp.addCustomEvent("onCommentsGet",function(e){if(typeof window.arLogTs["entry_"+e.log_id]!="undefined"&&window.arLogTs["entry_"+e.log_id]!=null){arLogTs["entry_"+e.log_id]=e.ts}});BXMobileApp.addCustomEvent("onLogEntryCommentAdd",function(e){oMSL.onLogEntryCommentAdd(e.log_id)});BXMobileApp.addCustomEvent("onLogEntryRatingLike",function(e){oMSL.onLogEntryRatingLike({ratingId:e.rating_id,voteAction:e.voteAction,logId:e.logId})});BXMobileApp.addCustomEvent("onLogEntryImpPostRead",function(e){if(BX("important_post_"+e.postId)){oMSL.onLogEntryImpPostRead({node:BX("important_post_"+e.postId)})}});BXMobileApp.addCustomEvent("onLogEntryFollow",function(e){oMSL.setFollow({logId:e.logId,pageId:e.pageId,bOnlyOn:typeof e.bOnlyOn!="undefined"&&e.bOnlyOn=="Y",bRunEvent:false})});BXMobileApp.addCustomEvent("onLogEntryFavorites",function(e){oMSL.onLogEntryFavorites(e.log_id,e.page_id)});BXMobileApp.addCustomEvent("onLogEntryCommentsNumRefresh",function(e){oMSL.onLogEntryCommentAdd(e.log_id,e.num)});BXMobileApp.addCustomEvent("onLogEntryPostUpdated",function(e){oMSL.onLogEntryPostUpdated(e)});BX.MobileUI.addLivefeedLongTapHandler(BX("lenta_wrapper_global"),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}else if(bEmptyPage){window.isDetailPullDownEnabled=false;oMSL.registerEmptyBlockToCheck();BX.ready(function(){BX.addCustomEvent("onMPFSentEditStart",function(){app.showPopupLoader({text:""})});__MSLDrawDetailPage();BX.addCustomEvent("onOpenPageBefore",function(){__MSLDrawDetailPage()});BXMobileApp.addCustomEvent("onEditedPostInserted",function(e){app.hidePopupLoader();oMSL.drawDetailPageText(e);BXMobileApp.onCustomEvent("onLogEntryPostUpdated",e,true)});BXMobileApp.addCustomEvent("onEditedPostFailed",function(){app.hidePopupLoader()});BX.MSL.viewImageBind("post_block_check_cont",{tag:"IMG",attr:"data-bx-image"})});BX.MobileUI.addLivefeedLongTapHandler(BX("post_item_top_wrap"),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"});BX.MobileUI.addLivefeedLongTapHandler(BX("post-comments-wrap"),{likeNodeClass:"post-comment-control-item-like",copyItemClass:"post-comment-block",copyTextClass:"post-comment-text"})}else if(logID>0&&!bEmptyGetComments){window.isDetailPullDownEnabled=false;window.arCanUserComment={};BXMobileApp.onCustomEvent("onLogEntryRead",{log_id:logID,ts:tmstmp,bPull:false},true);BX.ready(function(){oMSL.registerBlocksToCheck();setTimeout(function(){oMSL.checkNodesHeight()},100);BX.addCustomEvent("onMPFSentEditStart",function(){app.showPopupLoader({text:""})});BXMobileApp.addCustomEvent("onEditedPostInserted",function(e){app.hidePopupLoader();oMSL.drawDetailPageText(e);BXMobileApp.onCustomEvent("onLogEntryPostUpdated",e,true)})});if(BX("post_item_top_wrap_"+logID)){BX.MobileUI.addLivefeedLongTapHandler(BX("post_item_top_wrap_"+logID),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}else if(BX("post_item_top_wrap")){BX.MobileUI.addLivefeedLongTapHandler(BX("post_item_top_wrap"),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}BX.MobileUI.addLivefeedLongTapHandler(BX("post-comments-wrap"),{likeNodeClass:"post-comment-control-item-like",copyItemClass:"post-comment-block",copyTextClass:"post-comment-text"})}if(!bAjaxCall){BX.ready(function(){if(logID<=0&&!bEmptyPage){var e=BX.GetWindowSize();window.maxScroll=e.scrollHeight-e.innerHeight-190;oMSL.initScroll(true);if(!bReload){BX.addCustomEvent("UIApplicationDidBecomeActiveNotification",function(e){var t=navigator.network.connection.type;if(t==Connection.UNKNOWN||t==Connection.NONE){app.pullDownLoadingStop();oMSL.initScroll(false,true)}else{__MSLPullDownInit(true,false);oMSL.initScroll(true,true)}})}if(!bFiltered&&!bReload){BXMobileApp.addCustomEvent("onUpdateSocnetCounters",oMSL.onUpdateSocnetCountersHandler);BXMobileApp.addCustomEvent("onImUpdateCounter",oMSL.onImUpdateCounterHandler);BXMobileApp.addCustomEvent("onUpdateUserCounters",oMSL.onUpdateCounterHandler)}}if(bEmptyPage||logID>0){if(window.platform!="ios"){BX.bind(window,"scroll",oMSL.onScrollDetail)}BX.addCustomEvent("UIApplicationDidBecomeActiveNotification",function(e){var t=navigator.network.connection.type;if(t==Connection.UNKNOWN||t==Connection.NONE){app.pullDownLoadingStop()}else{if(oMSL.iLastActivityDate>0){var o=Math.round((new Date).getTime()/1e3);if(o-oMSL.iLastActivityDate>1740){if(bEmptyPage){BXMobileApp.UI.Page.isVisible({callback:function(e){if(e.status=="visible"){app.getPageParams({callback:function(e){if(parseInt(e.log_id)>0){oMSL.setLogId(parseInt(e.log_id))}oMSL.getComments({ts:oMSL.iDetailTs,bPullDown:false,obFocus:{form:"NO",comments:"NO"}})}})}else{oMSL.emptyRefreshCommentsFlag=true}}})}else{document.location.reload(true)}}}}});__MSLDetailPullDownInit(true)}else{setTimeout(function(){oMSL.checkNodesHeight();BX.onCustomEvent(window,"BX.UserContentView.onRegisterViewAreaListCall",[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}])},1e3);if(logID<=0){__MSLPullDownInit(true)}}})}BXMobileApp.addCustomEvent("onHidePageBefore",function(){var e=document.getElementsByTagName("video"),t=null;for(t=0;t<e.length;t++){if(!e[t].paused){e[t].pause()}}var o=document.querySelectorAll("iframe.bx-mobile-video-frame");for(t=0;t<o.length;t++){var n=o[t].getAttribute("src");if(n){o[t].src=o[t].src}}});BX.addCustomEvent("MobilePlayer:onError",oMSL.onMobilePlayerError)}function __MSLOnFeedScroll(){var e=BX.GetWindowScrollPos();if(e.scrollTop>=window.maxScroll&&(e.scrollTop>0||window.maxScroll>0)&&!window.bRefreshing){BX.unbind(window,"scroll",__MSLOnFeedScroll);bGettingNextPage=true;var t=new MobileAjaxWrapper;t.Wrap({type:"json",method:"GET",url:url_next,data:"",callback:function(e){nextPageXHR=null;if(typeof e!="undefined"&&typeof e.PROPS!="undefined"&&typeof e.PROPS.CONTENT!="undefined"&&e.PROPS.CONTENT.length>0&&(typeof e.LAST_TS=="undefined"||parseInt(e.LAST_TS)<=0||parseInt(BX.message("MSLFirstPageLastTS"))<=0||parseInt(e.LAST_TS)<parseInt(BX.message("MSLFirstPageLastTS")))){oMSL.processAjaxBlock(e.PROPS,{type:"next",callback:function(){var e=BX.GetWindowSize();window.maxScroll=e.scrollHeight-e.innerHeight-190;oMSL.registerBlocksToCheck();setTimeout(BX.delegate(oMSL.checkNodesHeight,oMSL),100);BX.onCustomEvent(window,"BX.UserContentView.onRegisterViewAreaListCall",[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}])}});if(parseInt(BX.message("MSLPageNavNum"))>0&&parseInt(window.iPageNumber)>0){iPageNumber++;url_next=BX.util.remove_url_param(url_next,["PAGEN_"+BX.message("MSLPageNavNum")]);url_next+=(url_next.indexOf("?")>=0?"&":"?")+"PAGEN_"+parseInt(BX.message("MSLPageNavNum"))+"="+(iPageNumber+1)}}BX.bind(window,"scroll",__MSLOnFeedScroll);bGettingNextPage=false},callback_failure:function(){nextPageXHR=null;bGettingNextPage=false}});nextPageXHR=t.xhr}}function __MSLOpenLogEntryNew(e,t){var o=typeof e.show_full!="undefined"?!!e.show_full:false;if(typeof e.path=="undefined"||e.path==null||e.path.length<=0){return false}else{var n=e.path}if(typeof e.log_id=="undefined"||e.log_id==null||parseInt(e.log_id)<=0){return false}e.follow=BX("log_entry_follow_"+e.log_id)?BX("log_entry_follow_"+e.log_id).getAttribute("data-follow"):"Y";e.fav=BX("log_entry_favorites_"+e.log_id)&&BX("log_entry_favorites_"+e.log_id).classList.contains("lenta-item-fav-active")?"Y":"N";e.feed_id=typeof window.LiveFeedID!="undefined"?window.LiveFeedID:"";e.can_user_comment=typeof arCanUserComment!="undefined"&&typeof arCanUserComment[e.log_id]!="undefined"&&arCanUserComment[e.log_id];if(typeof t!="undefined"&&t!=null&&t&&typeof t.target!="undefined"&&t.target!=null){if(typeof t.target.tagName!="undefined"&&t.target.tagName.toLowerCase()=="a"&&!BX.hasClass(t.target,"post-item-more")){return false}var i=BX.findParent(t.target,{tag:"A"},{tag:"div",className:"post-item-post-block"});if(i){return false}}e.RandomID=typeof arLikeRandomID["entry_"+e.log_id]!="undefined"&&arLikeRandomID["entry_"+e.log_id]!=null?arLikeRandomID["entry_"+e.log_id]:false;if(BX("post_block_check_cont_"+e.log_id)){e.detailText=BX("post_block_check_cont_"+e.log_id).innerHTML;e.bIsPhoto=BX.hasClass(BX("post_block_check_cont_"+e.log_id),"post-item-post-img-block");e.bIsImportant=BX.hasClass(BX("post_block_check_cont_"+e.log_id),"info-block-important")&&BX.hasClass(BX("post_block_check_cont_"+e.log_id),"lenta-info-block")}if(BX("post_more_limiter_"+e.log_id)){e.showMoreButton=BX("post_more_limiter_"+e.log_id).style.display!="none"}if(BX("post_item_top_"+e.log_id)){e.topText=BX("post_item_top_"+e.log_id).innerHTML}if(BX("informer_comments_all_"+e.log_id)){e.commentsNumAll=BX("informer_comments_all_"+e.log_id).innerHTML;if(BX("informer_comments_new_"+e.log_id)){e.commentsNumNew=BX.findChild(BX("informer_comments_new_"+e.log_id),{className:"post-item-inform-right-new-value"},true,false).innerHTML}}else if(BX("informer_comments_"+e.log_id)){e.commentsNum=BX("informer_comments_"+e.log_id).innerHTML}if(BX("comments_control_"+e.log_id)){e.commentsControl=!!BX("comments_control_"+e.log_id)}if(BX("rating_block_"+e.log_id)){e.ratingText=BX("rating_block_"+e.log_id).innerHTML;e.ratingCounter=parseInt(BX("rating_block_"+e.log_id).getAttribute("data-counter"))}if(BX("rating-footer-wrap_"+e.log_id)){e.ratingFooter=BX("rating-footer-wrap_"+e.log_id).innerHTML}e.bShowFull=o;if(typeof window.arLogTs["entry_"+e.log_id]!="undefined"&&window.arLogTs["entry_"+e.log_id]!=null){e.TS=arLogTs["entry_"+e.log_id]}e.bSetFocusOnCommentForm=typeof e.focus_form!="undefined"?!!e.focus_form:false;e.bSetFocusOnCommentsList=typeof e.focus_comments!="undefined"?!!e.focus_comments:false;app.loadPageBlank({url:n,bx24ModernStyle:true,data:e});return typeof t!="undefined"&&t!=null&&t?t.preventDefault():false}function __MSLDrawDetailPage(){app.getPageParams({callback:function(e){BXMobileApp.onCustomEvent("onLogEntryRead",{log_id:e.log_id,ts:BX.message("MSLCurrentTime"),bPull:false},true);oMSL.drawDetailPage(e)}})}function __MSLDetailMoveBottom(){document.body.scrollTop=document.body.scrollHeight}function __MSLDetailMoveTop(){document.body.scrollTop=0}function __MSLLogEntryRead(e,t,o){o=!!o;if(typeof window.arLogTs["entry_"+e]!="undefined"&&window.arLogTs["entry_"+e]!=null){arLogTs["entry_"+e]=t;if(BX("informer_comments_"+e)&&BX("informer_comments_new_"+e)&&!o){var n=BX("informer_comments_all_"+e).innerHTML.length>0?parseInt(BX("informer_comments_all_"+e).innerHTML):0;var i=n+parseInt(BX.findChild(BX("informer_comments_new_"+e),{className:"post-item-inform-right-new-value"},true,false).innerHTML);BX.remove(BX("informer_comments_new_"+e));BX.remove(BX("informer_comments_all_"+e));BX("informer_comments_"+e).innerHTML=i}}if(BX("lenta_item_"+e)){BX.removeClass(BX("lenta_item_"+e),"lenta-item-new")}}function __MSLGetHiddenDestinations(e,t,o){var n={sessid:BX.message("MSLSessid"),site:BX.message("SITE_ID"),lang:BX.message("MSLLangId"),dlim:BX.message("MSLDestinationLimit"),log_id:parseInt(e),nt:BX.message("MSLNameTemplate"),sl:BX.message("MSLShowLogin"),p_user:BX.message("MSLPathToUser"),p_group:BX.message("MSLPathToGroup"),p_crmlead:BX.message("MSLPathToCrmLead"),p_crmdeal:BX.message("MSLPathToCrmDeal"),p_crmcontact:BX.message("MSLPathToCrmContact"),p_crmcompany:BX.message("MSLPathToCrmCompany"),action:"get_more_destination",mobile_action:"get_more_destination",author_id:parseInt(t)};var i=new MobileAjaxWrapper;i.Wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",data:n,callback:function(e){if(typeof e["arDestinations"]!="undefined"){var t=e["arDestinations"];if(typeof t=="object"){if(BX(o)){var n=o.parentNode;n.removeChild(o);for(var i=0;i<t.length;i++){if(typeof t[i]["TITLE"]!="undefined"&&t[i]["TITLE"].length>0){n.appendChild(BX.create("SPAN",{html:",&nbsp;"}));if(typeof t[i]["CRM_PREFIX"]!="undefined"&&t[i]["CRM_PREFIX"].length>0){n.appendChild(BX.create("SPAN",{props:{className:"post-item-dest-crm-prefix"},html:t[i]["CRM_PREFIX"]+":&nbsp;"}))}if(typeof t[i]["URL"]!="undefined"&&t[i]["URL"].length>0){n.appendChild(BX.create("A",{props:{className:"post-item-destination"+(typeof t[i]["STYLE"]!="undefined"&&t[i]["STYLE"].length>0?" post-item-dest-"+t[i]["STYLE"]:""),href:t[i]["URL"]},html:t[i]["TITLE"]}))}else{n.appendChild(BX.create("SPAN",{props:{className:"post-item-destination"+(typeof t[i]["STYLE"]!="undefined"&&t[i]["STYLE"].length>0?" post-item-dest-"+t[i]["STYLE"]:"")},html:t[i]["TITLE"]}))}}}if(typeof e["iDestinationsHidden"]!="undefined"&&parseInt(e["iDestinationsHidden"])>0){e["iDestinationsHidden"]=parseInt(e["iDestinationsHidden"]);var a=e["iDestinationsHidden"]%100>10&&e["iDestinationsHidden"]%100<20?5:e["iDestinationsHidden"]%10;n.appendChild(BX.create("SPAN",{html:"&nbsp;"+BX.message("MSLDestinationHidden"+a).replace("#COUNT#",e["iDestinationsHidden"])}))}oMSL.checkNodesHeight()}}}},callback_failure:function(){}})}function __MSLGetNewPosts(){}function __MSLRefresh(e){e=!!e;if(window.bGettingNextPage&&window.nextPageXHR!=null){nextPageXHR.abort()}BX.addClass(BX("lenta_notifier"),"lenta-notifier-waiter");BX.onCustomEvent("onBeforeMobileLivefeedRefresh",[{}]);oMSL.refreshNeeded=false;oMSL.refreshStarted=true;oMSL.hideRefreshNeededNotifier();bRefreshing=true;var t=document.location.href;t=t.replace("&RELOAD=Y","").replace("RELOAD=Y&","").replace("RELOAD=Y","").replace("&RELOAD_JSON=Y","").replace("RELOAD_JSON=Y&","").replace("RELOAD_JSON=Y","");t+=(t.indexOf("?")!==-1?"&":"?")+"RELOAD=Y&RELOAD_JSON=Y";var o=[{name:"BX-ACTION-TYPE",value:"get_dynamic"},{name:"BX-REF",value:document.referrer},{name:"BX-CACHE-MODE",value:"APPCACHE"},{name:"BX-APPCACHE-PARAMS",value:JSON.stringify(window.appCacheVars)},{name:"BX-APPCACHE-URL",value:typeof BX.frameCache!="undefined"&&typeof BX.frameCache.vars!="undefined"&&typeof BX.frameCache.vars.PAGE_URL!="undefined"?BX.frameCache.vars.PAGE_URL:oMSL.curUrl}];var n=new MobileAjaxWrapper;n.Wrap({type:"json",method:"GET",url:t,data:"",headers:o,callback:function(t){oMSL.refreshStarted=false;oMSL.refreshNeeded=false;BX.removeClass(BX("lenta_notifier"),"lenta-notifier-waiter");if(typeof t!="undefined"&&typeof t.PROPS!="undefined"&&typeof t.PROPS.CONTENT!="undefined"&&t.PROPS.CONTENT.length>0){BitrixMobile.LazyLoad.clearImages();BX.clearNodeCache();app.pullDownLoadingStop();app.hidePopupLoader();oMSL.hideNotifier();oMSL.hideRefreshNeededNotifier();if(typeof t.COUNTER_TO_CLEAR!="undefined"){BXMobileApp.onCustomEvent("onClearLFCounter",[t.COUNTER_TO_CLEAR],true);var o={counterCode:t.COUNTER_TO_CLEAR,serverTime:t.COUNTER_SERVER_TIME,serverTimeUnix:t.COUNTER_SERVER_TIME_UNIX};BXMobileApp.Events.postToComponent("onClearLiveFeedCounter",o,"communication")}oMSL.processAjaxBlock(t.PROPS,{type:"refresh",callback:function(){if(typeof BX.frameCache!="undefined"&&BX("bxdynamic_feed_refresh")&&(typeof t.REWRITE_FRAMECACHE=="undefined"||t.REWRITE_FRAMECACHE!="N")){var e={USE_BROWSER_STORAGE:true,AUTO_UPDATE:true,USE_ANIMATION:false};if(typeof t.TS!="undefined"&&parseInt(t.TS)>0){e.TS=parseInt(t.TS);oMSL.iframeCacheTs=e.TS}BX.frameCache.writeCacheWithID("framecache-block-feed",BX("bxdynamic_feed_refresh").innerHTML,parseInt(Math.random()*1e5),JSON.stringify(e))}oMSL.registerBlocksToCheck();setTimeout(function(){BitrixMobile.LazyLoad.showImages()},1e3)}});BX.localStorage.set("mobileLivefeedRefreshTS",Math.round((new Date).getTime()/1e3),86400*30);if(e){BitrixAnimation.animate({duration:1e3,start:{scroll:document.body.scrollTop},finish:{scroll:0},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function(e){document.body.scrollTop=e.scroll},complete:function(){}})}if(t.isManifestUpdated=="1"&&!oMSL.appCacheDebug&&(window.applicationCache.status==window.applicationCache.IDLE||window.applicationCache.status==window.applicationCache.UPDATEREADY)){window.applicationCache.update()}}else{app.pullDownLoadingStop();__MSLRefreshError(true)}bRefreshing=false},callback_failure:function(){oMSL.refreshStarted=false;oMSL.refreshNeeded=false;BX.removeClass(BX("lenta_notifier"),"lenta-notifier-waiter");app.pullDownLoadingStop();__MSLRefreshError(true);bRefreshing=false}})}function __MSLPullDownInit(e,t){if(typeof t=="undefined"){t=true}e=!!e;if(e){if(!window.isPullDownEnabled&&t){BXMobileApp.UI.Page.Refresh.setParams({pulltext:BX.message("MSLPullDownText1"),backgroundColor:"#E7E9EB",downtext:BX.message("MSLPullDownText2"),loadtext:BX.message("MSLPullDownText3"),callback:function(){if(!window.isPullDownLocked){__MSLRefresh(true)}}});BXMobileApp.UI.Page.Refresh.setEnabled(true)}isPullDownEnabled=true}else{BXMobileApp.UI.Page.Refresh.setEnabled(false);isPullDownEnabled=false}}function __MSLDetailPullDownInit(e){e=!!e;if(e){if(!isDetailPullDownEnabled){var t=function(){var e=true;if(e){var t=null;var o=null;if(BX("post_log_id")){t=parseInt(BX("post_log_id").getAttribute("data-log-id"));o=parseInt(BX("post_log_id").getAttribute("data-ts"))}else if(BX("lenta_wrapper")){var n=BX.findChild(BX("lenta_wrapper"),{className:"post-wrap"},true,false);if(n&&n.id.length>0){var i=n.id.match(/^lenta_item_([\d]+)$/i);if(i!=null){document.location.replace(document.location.href);isDetailPullDownEnabled=true;return}}}if(BX("post-comments-wrap")&&typeof t!=="undefined"&&t!=null){var a=BX.findChild(BX("post-comments-wrap"),{className:"post-comments-failed-outer"},true,false);if(!!a){BX.cleanNode(a,true)}oMSL.getComments({ts:o,bPullDown:true,obFocus:{form:false}});oMSL.refreshPostDetail()}}};BXMobileApp.UI.Page.Refresh.setParams({pulltext:BX.message("MSLDetailPullDownText1"),backgroundColor:"#E7E9EB",downtext:BX.message("MSLDetailPullDownText2"),loadtext:BX.message("MSLDetailPullDownText3"),callback:t});BXMobileApp.UI.Page.Refresh.setEnabled(true)}isDetailPullDownEnabled=true}else{BXMobileApp.UI.Page.Refresh.setEnabled(false);isDetailPullDownEnabled=false}}function __MSLRefreshError(e){e=!!e;var t=BX("lenta_refresh_error");if(parseInt(window.refreshErrorTimeout)>0){clearTimeout(window.refreshErrorTimeout)}if(t){if(e){BX.addClass(t,"lenta-notifier-shown");BX.bind(window,"scroll",__MSLRefreshErrorScroll)}else{BX.unbind(window,"scroll",__MSLRefreshErrorScroll);BX.removeClass(t,"lenta-notifier-shown")}}else{window.refreshErrorTimeout=setTimeout(function(){__MSLRefreshError(e)},500)}}function __MSLRefreshErrorScroll(){__MSLRefreshError(false)}function __MSLSetFavorites(e){var t=BX("log_entry_favorites_"+e);if(!t){return}var o=t.getAttribute("data-favorites")=="Y"?"Y":"N";var n=o=="Y"?"N":"Y";if(o=="Y"){BX.removeClass(t,"lenta-item-fav-active")}else{BX.addClass(t,"lenta-item-fav-active")}t.setAttribute("data-favorites",n);var i=new MobileAjaxWrapper;i.runAction("socialnetwork.api.livefeed.changeFavorites",{data:{logId:e,value:n},analyticsLabel:{b24statAction:n=="Y"?"addFavorites":"removeFavorites",b24statContext:"mobile"}},{success:function(t){if(t.data.success){if(n=="Y"){oMSL.setFollow({logId:e,bOnlyOn:true,bRunEvent:true,bAjax:false})}BXMobileApp.onCustomEvent("onLogEntryFavorites",{log_id:e,page_id:BX.message("MSLPageId")!=undefined?BX.message("MSLPageId"):""},true)}},failure:function(e){}});return false}function showHiddenDestination(e,t){BX.hide(t);BX("blog-destination-hidden-"+e).style.display="inline"}function commonNativeInputCallback(e,t){if(window.entryType=="blog"){blogCommentsNativeInputCallback({text:e,oPreviewComment:null,commentId:t})}else if(window.entryType=="non-blog"&&typeof t=="undefined"){commentsNativeInputCallback({text:e})}}function blogCommentsNativeInputCallback(e){var t=typeof e.text!="undefined"?BX.util.htmlspecialchars(e.text):"";var o=typeof e.oPreviewComment!="undefined"?e.oPreviewComment:null;var n=typeof e.commentId!="undefined"?e.commentId:0;var i=typeof e.nodeId!="undefined"?e.nodeId:"";var a=typeof e.ufCode!="undefined"?e.ufCode:false;var s=typeof e.attachedFiles!="undefined"?e.attachedFiles:false;var r=typeof e.attachedFilesRaw!="undefined"?e.attachedFilesRaw:false;if(t.length==0){return}var l={sessid:BX.bitrix_sessid(),comment_post_id:commentVarBlogPostID,act:"add",post:"Y",comment:oMSL.parseMentions(t),decode:"Y"};if(commentVarAction){l.ACTION=commentVarAction}if(commentVarEntityTypeID){l.ENTITY_TYPE_ID=commentVarEntityTypeID}if(commentVarEntityID){l.ENTITY_ID=commentVarEntityID}if(a&&s){l[a]=s}if(r){l.attachedFilesRaw=r}if(typeof n!="undefined"&&parseInt(n)>0){l.act="edit";l.edit_id=parseInt(n);i=typeof i!="undefined"?i:""}if(l.act=="add"&&(typeof o=="undefined"||o===null)){bLockCommentSending=true;o=oMSL.showPreviewComment(t);app.clearInput()}else if(l.act=="edit"&&BX(i)){oMSL.showCommentWait({nodeId:i,status:true});var d=BX.findChild(BX(i),{className:"post-comment-text"},true,false);if(d){d.innerHTML=t.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(e,t,o){return o})}app.clearInput()}var m=new MobileAjaxWrapper;m.Wrap({type:"json",method:"POST",url:commentVarURL,data:l,processData:true,callback:function(e){bLockCommentSending=false;if(typeof e=="object"&&typeof e.TEXT!="undefined"){response=e.TEXT}if(typeof response!="undefined"&&response!="*"&&response.length>0){if(l.act=="add"){oMSL.showNewComment({commentId:typeof e.COMMENT_ID!="undefined"?parseInt(e.COMMENT_ID):0,text:response,bClearForm:false,oPreviewComment:o,bShowImages:false});oMSL.parseAndExecCode(response);__MSLDetailMoveBottom();oMSL.setFollow({logId:oMSL.getLogId(),bOnlyOn:true})}else{oMSL.showNewComment({text:response,bClearForm:false,oPreviewComment:BX(i),bReplace:true,bIncrementCounters:false,bShowImages:false});oMSL.parseAndExecCode(response)}}else{oMSL.showCommentAlert({nodeId:l.act=="add"?o:i,action:l.act,text:t,commentType:"blog",callback:function(){blogCommentsNativeInputCallback({text:t,oPreviewComment:l.act=="add"?o:i,commentId:l.act=="add"?false:n})}})}},callback_failure:function(){bLockCommentSending=false;oMSL.showCommentAlert({nodeId:l.act=="add"?o:i,action:l.act,text:t,commentType:"blog",callback:function(){blogCommentsNativeInputCallback({text:t,oPreviewComment:l.act=="add"?o:i,commentId:l.act=="add"?false:n})}})}})}function commentsNativeInputCallback(e){var t=typeof e.text!="undefined"?BX.util.htmlspecialchars(e.text):"";var o=typeof e.oPreviewComment!="undefined"?e.oPreviewComment:null;var n=typeof e.commentId!="undefined"?e.commentId:0;var i=typeof e.nodeId!="undefined"?e.nodeId:"";var a=typeof e.ufCode!="undefined"?e.ufCode:false;var s=typeof e.attachedFiles!="undefined"?e.attachedFiles:false;var r=typeof e.attachedFilesRaw!="undefined"?e.attachedFilesRaw:false;if(t.length==0){return}var l={sessid:BX.bitrix_sessid(),site:commentVarSiteID,lang:commentVarLanguageID,log_id:commentVarLogID,message:oMSL.parseMentions(t),as:commentVarAvatarSize,nt:commentVarNameTemplate,sl:commentVarShowLogin,dtf:commentVarDateTimeFormat,p_user:commentVarPathToUser,rt:commentVarRatingType,action:"add_comment",mobile_action:"add_comment",sr:BX.message("MSLShowRating")};if(a&&s){l[a]=s}if(r){l.attachedFilesRaw=r}if(typeof n!="undefined"&&parseInt(n)>0){l.action="edit_comment";l.mobile_action="edit_comment";l.edit_id=parseInt(n);i=typeof i!="undefined"?i:""}if(l.action=="add_comment"&&(typeof o=="undefined"||o===null)){o=oMSL.showPreviewComment(t);app.clearInput()}else if(l.action=="edit_comment"&&BX(i)){oMSL.showCommentWait({nodeId:i,status:true});var d=BX.findChild(BX(i),{className:"post-comment-text"},true,false);if(d){d.innerHTML=t.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(e,t,o){return o})}app.clearInput()}var m=new MobileAjaxWrapper;m.Wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",data:l,callback:function(e){if(typeof e["arCommentFormatted"]!="undefined"){if(l.action=="add_comment"){oMSL.showNewComment({commentId:parseInt(e["commentID"]),arComment:e["arCommentFormatted"],oPreviewComment:o,bClearForm:true});__MSLDetailMoveBottom();oMSL.setFollow({logId:l.log_id,bOnlyOn:true})}else{oMSL.showNewComment({arComment:e["arCommentFormatted"],oPreviewComment:BX(i),bIncrementCounters:false,bReplace:true})}}else{oMSL.alertPreviewComment({nodeId:o?o:i,text:t,commentType:"log",commentId:n,action:l.action,callback:function(){commentsNativeInputCallback({text:t,oPreviewComment:o,commentId:n,nodeId:i})}})}},callback_failure:function(){oMSL.alertPreviewComment({nodeId:o?o:i,text:t,commentType:"log",commentId:n,action:l.action,callback:function(){commentsNativeInputCallback({text:t,oPreviewComment:o,commentId:n,nodeId:i})}})}})}__MSLSendError=function(e,t,o){var n=new MobileAjaxWrapper;n.runAction("socialnetwork.api.livefeed.mobileLogError",{data:{message:e,url:t,lineNumber:o}},{success:function(e){},failure:function(e){}})};__MSLSendErrorEval=function(e){BX.evalGlobal("try { "+e+" } catch (e) { __MSLSendError(e.message, e.name, e.number); }")};BitrixMSL=function(){this.scriptsAttached=[];this.refreshNeeded=false;this.refreshStarted=false;this.counterTimeout=null;this.detailPageId="";this.logId=false;this.commentsType=false;this.entityXMLId="";this.commentLoadingFilesStack=false;this.commentProgressBarAnimation=false;this.commentProgressBarState=0;this.sendCommentWritingList=[];this.sendCommentWritingListTimeout=[];this.commentTextCurrent="";this.arMention=[];this.bUseFollow=true;this.bFollow=true;this.bFollowDefault=true;this.bUseTasks=false;this.bShowExpertMode=true;this.bExpertMode=false;this.detailPageMenuItems=[];this.listPageMenuItems=[];this.bKeyboardCaptureEnabled=false;this.keyboardShown=null;this.arBlockToCheck={};this.iLastActivityDate=null;this.iDetailTs=0;this.iframeCacheTs=0;this.newPostFormParams={};this.newPostFormExtraData={};this.arRatingLikeProcess={};this.bDetailEmptyPage=null;this.bCounterReceived=false;this.counterValue=0;this.blocksToCheckRegisteredList=[];this.menuData={};this.showScrollButtonTimeout=null;this.showScrollButtonBottom=false;this.showScrollButtonTop=false;this.canCheckScrollButton=true;this.windowSize=null;this.emptyRefreshCommentsFlag=false;this.detailPageFocus=null;this.emptyCommentsXhr=null;this.classes={postItemBlockFull:"post-item-post-block-full"}};BitrixMSL.prototype.setLogId=function(e){this.logId=parseInt(data.log_id)};BitrixMSL.prototype.getLogId=function(){return parseInt(this.logId)};BitrixMSL.prototype.setFollowValue=function(e){this.bFollow=!!e};BitrixMSL.prototype.getFollowValue=function(){return this.bFollow};BitrixMSL.prototype.setFollowDefaultValue=function(e){this.bFollowDefault=!!e};BitrixMSL.prototype.getFollowDefaultValue=function(){return this.bFollowDefault};BitrixMSL.prototype.registerScripts=function(e){if(!BX.util.in_array(e,this.scriptsAttached)){this.scriptsAttached.push(e)}};BitrixMSL.prototype.loadScripts=function(){for(var e=0;e<this.scriptsAttached.length;e++){BX.loadScript(this.scriptsAttached[e]+"?"+parseInt(Math.random()*1e5))}};BitrixMSL.prototype.pullDownAndRefresh=function(){app.exec("pullDownLoadingStart");window.isPullDownLocked=true;__MSLRefresh(true)};BitrixMSL.prototype.shareBlogPost=function(e){};BitrixMSL.prototype.deleteBlogPost=function(e){app.confirm({title:BX.message("MSLDeletePost"),text:BX.message("MSLDeletePostDescription"),buttons:[BX.message("MSLDeletePostButtonOk"),BX.message("MSLDeletePostButtonCancel")],callback:function(t){if(t==1){app.showPopupLoader({text:""});var o=BX.message("MSLSiteDir")+"mobile/ajax.php";o=BX.util.add_url_param(o,{b24statAction:"deleteBlogPost",b24statContext:"mobile"});var n=new MobileAjaxWrapper;n.Wrap({type:"json",method:"POST",url:o,data:{action:"delete_post",mobile_action:"delete_post",sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("LANGUAGE_ID"),post_id:e.post_id},processData:true,callback:function(e){app.hidePopupLoader();if(typeof e.SUCCESS!="undefined"&&e.SUCCESS=="Y"){BXMobileApp.onCustomEvent("onBlogPostDelete",{},true);app.closeController({drop:true})}},callback_failure:function(){app.hidePopupLoader()}});return false}}})};BitrixMSL.prototype.getBlogPostData=function(e,t){e=parseInt(e);var o={};if(e>0){app.showPopupLoader();var n=new MobileAjaxWrapper;n.Wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",processData:true,data:{action:"get_blog_post_data",mobile_action:"get_blog_post_data",sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("LANGUAGE_ID"),post_id:e,nt:BX.message("MSLNameTemplate"),sl:BX.message("MSLShowLogin")},callback:function(n){app.hidePopupLoader();o.id=e;if(typeof n.log_id!="undefined"&&parseInt(n.log_id)>0){o.log_id=n.log_id}if(typeof n.post_user_id!="undefined"&&parseInt(n.post_user_id)>0){o.post_user_id=n.post_user_id}if(typeof n.PostPerm!="undefined"){o.PostPerm=n.PostPerm}if(typeof n.PostDestination!="undefined"){o.PostDestination=n.PostDestination}if(typeof n.PostDestinationHidden!="undefined"){o.PostDestinationHidden=n.PostDestinationHidden}if(typeof n.PostDetailText!="undefined"){o.PostDetailText=n.PostDetailText}if(typeof n.PostFiles!="undefined"){o.PostFiles=n.PostFiles}if(typeof n.PostUFCode!="undefined"){o.PostUFCode=n.PostUFCode}t(o)},callback_failure:function(){app.hidePopupLoader()}})}};BitrixMSL.prototype.getCommentData=function(e,t){var o=typeof e.commentType!="undefined"&&e.commentType=="blog"?"blog":"log";var n=typeof e.commentId!="undefined"?parseInt(e.commentId):0;var i={};if(n>0&&typeof e.postId!="undefined"&&parseInt(e.postId)>0){app.showPopupLoader();var a={action:"get_comment_data",sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("LANGUAGE_ID")};if(o=="blog"){a.mobile_action="get_blog_comment_data";a.comment_id=n;a.post_id=parseInt(e.postId)}else{a.mobile_action="get_log_comment_data";a.cid=n;a.log_id=parseInt(e.postId)}var s=new MobileAjaxWrapper;s.Wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",processData:true,data:a,callback:function(e){app.hidePopupLoader();i.id=n;if(typeof e.CommentCanEdit!="undefined"){i.CommentCanEdit=e.CommentCanEdit}if(typeof e.CommentDetailText!="undefined"){i.CommentDetailText=e.CommentDetailText}if(typeof e.CommentFiles!="undefined"){i.CommentFiles=e.CommentFiles}if(typeof e.CommentUFCode!="undefined"){i.CommentUFCode=e.CommentUFCode}t(i)},callback_failure:function(){app.hidePopupLoader()}})}};BitrixMSL.prototype.editBlogPost=function(e){this.getBlogPostData(e.post_id,function(t){oMSL.newPostFormParams={};if(typeof t.PostPerm!="undefined"&&t.PostPerm>="W"){var o={a_users:[],b_groups:[]};oMSL.setPostFormExtraDataArray({postId:e.post_id,postAuthorId:t.post_user_id,logId:t.log_id});if(typeof t.PostDetailText!="undefined"){oMSL.setPostFormParams({messageText:t.PostDetailText})}if(typeof t.PostDestination!="undefined"){for(var n in t.PostDestination){if(t.PostDestination.hasOwnProperty(n)){if(t.PostDestination[n]["STYLE"]!="undefined"&&t.PostDestination[n]["STYLE"]=="all-users"){oMSL.addPostFormDestination(o,{type:"UA"})}else if(t.PostDestination[n]["TYPE"]!="undefined"&&t.PostDestination[n]["TYPE"]=="U"){oMSL.addPostFormDestination(o,{type:"U",id:t.PostDestination[n]["ID"],name:BX.util.htmlspecialcharsback(t.PostDestination[n]["TITLE"])})}else if(t.PostDestination[n]["TYPE"]!="undefined"&&t.PostDestination[n]["TYPE"]=="SG"){oMSL.addPostFormDestination(o,{type:"SG",id:t.PostDestination[n]["ID"],name:BX.util.htmlspecialcharsback(t.PostDestination[n]["TITLE"])})}}}}if(typeof t.PostDestinationHidden!="undefined"){oMSL.setPostFormExtraData({hiddenRecipients:t.PostDestinationHidden})}oMSL.setPostFormParams({selectedRecipients:o});if(typeof t.PostFiles!="undefined"){oMSL.setPostFormParams({messageFiles:t.PostFiles})}if(typeof t.PostUFCode!="undefined"){oMSL.setPostFormExtraData({messageUFCode:t.PostUFCode})}app.exec("showPostForm",oMSL.showNewPostForm())}})};BitrixMSL.prototype.drawDetailPage=function(e){var t=false;if(BX("post_log_id")){var o=parseInt(BX("post_log_id").getAttribute("data-log-id"))}if(typeof o==="undefined"||o!=e.log_id){app.clearInput()}if(BX("post_log_id")){if(typeof o!=="undefined"&&o==e.log_id){t=true}else{BX("post_log_id").setAttribute("data-log-id",e.log_id);BX("post_log_id").setAttribute("data-ts",e.TS);BX.message({MSLLogId:e.log_id})}}var n=false;window.entryType=e.entry_type;oMSL.InitDetail({commentsType:e.entry_type=="blog"?"blog":"log",detailPageId:(e.entry_type=="blog"?"blog":"log")+"_"+(e.entry_type=="blog"?e.post_id:e.log_id),logId:e.log_id,entityXMLId:e.entity_xml_id,bUseFollow:typeof e.use_follow=="undefined"||e.use_follow!="NO",bFollow:typeof e.follow=="undefined"||e.follow!="N",feed_id:typeof e.feed_id!="undefined"?e.feed_id:null,bUseTasks:typeof e.use_tasks!="undefined"&&e.use_tasks=="Y",entryParams:{destinations:typeof e.destinations!="undefined"?e.destinations:null,post_perm:typeof e.post_perm!="undefined"?e.post_perm:null,post_id:typeof e.post_id!="undefined"?e.post_id:null,post_content_type_id:BX.type.isNotEmptyString(e.post_content_type_id)?e.post_content_type_id:null,post_content_id:BX.type.isNotEmptyString(e.post_content_id)?e.post_content_id:null},TS:typeof e.TS!="undefined"?e.TS:null,readOnly:e.read_only!="undefined"?e.read_only:"N"});if(oMSL.emptyCommentsXhr){oMSL.emptyCommentsXhr.abort()}if(typeof e.commentsNumAll!="undefined"||typeof e.commentsNum!="undefined"){n=true}if(BX("comments_control")){BX("comments_control").style.display=typeof e.commentsControl!="undefined"&&e.commentsControl=="YES"?"inline-block":"none"}if(!t){if(typeof e.ratingText!="undefined"){if(BX("rating-footer-wrap")){if(typeof e.ratingFooter!="undefined"){oMSL.drawRatingFooter(e.ratingFooter)}else{BX("rating-footer-wrap").innerHTML=""}BX("rating-footer-wrap").style.display="block"}if(BX("rating_text")){if(typeof e.ratingCounter!="undefined"){BX("rating_text").setAttribute("data-counter",parseInt(e.ratingCounter))}if(BX.type.isNotEmptyString(e.ratingText)){BX("rating_text").innerHTML=e.ratingText;BX("rating_text").style.display="inline-block"}else{BX("rating_text").style.display="none"}}n=true;oMSL.parseAndExecCode(e.ratingText,0);BX.message({RVRunEvent:"Y"})}else{if(BX("rating-footer-wrap")){if(typeof e.ratingFooter!="undefined"){oMSL.drawRatingFooter(e.ratingFooter)}else{BX("rating-footer-wrap").innerHTML=""}BX("rating-footer-wrap").style.display="none"}if(BX("rating_button_cont")){BX("rating_button_cont").style.display="none"}if(BX("rating_text")){BX("rating_text").style.display="none"}}}if(BX("log_entry_follow")){if(typeof e.use_follow!="undefined"&&e.use_follow=="N"||typeof e.follow=="undefined"){BX.unbindAll(BX("log_entry_follow"));BX("log_entry_follow").style.display="none"}else{n=true;BX.removeClass(BX("log_entry_follow"),e.follow=="N"?"post-item-follow-active":"post-item-follow");BX.addClass(BX("log_entry_follow"),e.follow=="N"?"post-item-follow":"post-item-follow-active");BX("log_entry_follow").setAttribute("data-follow",e.follow=="N"?"N":"Y");BX.unbindAll(BX("log_entry_follow"));BX.bind(BX("log_entry_follow"),"click",function(){oMSL.setFollow({logId:e.log_id,bAjax:true,bRunEvent:false})})}}if(n){BX.removeClass(BX("lenta_item"),"post-without-informers")}else{BX.addClass(BX("lenta_item"),"post-without-informers")}if(BX("post_item_top_wrap")&&!this.getFollowDefaultValue()){if(typeof e.follow!="undefined"&&e.follow=="Y"){BX.addClass(BX("post_item_top_wrap"),"post-item-follow")}else{BX.removeClass(BX("post_item_top_wrap"),"post-item-follow")}}if(t&&BX.type.isNotEmptyString(e.fav)&&BX("log_entry_favorites_"+e.log_id)){if(e.fav=="Y"){BX("log_entry_favorites_"+e.log_id).classList.add("lenta-item-fav-active")}else{BX("log_entry_favorites_"+e.log_id).classList.remove("lenta-item-fav-active")}}if(!t){if(BX("post-comments-wrap")){BX.cleanNode(BX("post-comments-wrap"))}this.drawDetailPageText(e);var i=BX.findChild(BX("post_block_check_cont"),{className:"post-more-block"},true,false);if(i&&BX("post_more_limiter")){if(typeof e.showMoreButton!="undefined"&&e.showMoreButton=="YES"){BX("post_more_limiter").style.display="block";BX.bind(BX("post_more_limiter"),"click",function(){oMSL.expandText(e.log_id)})}else{BX("post_more_limiter").style.display="none"}}if(e.bShowFull==="YES"){BX("post_block_check_cont").className=oMSL.classes.postItemBlockFull;if(BX("post_more_block_"+e.log_id)){BX("post_more_block_"+e.log_id).style.display="none"}if(BX("post_block_check_more_"+e.log_id)){BX("post_block_check_more_"+e.log_id).style.display="none"}BX("post_more_limiter").style.display="none";BitrixMobile.LazyLoad.showImages(false)}else{BX("post_block_check_cont").className=e.bIsPhoto=="YES"?"post-item-post-img-block":"post-item-post-block"}if(e.bIsImportant=="YES"){BX.addClass(BX("post_block_check_cont"),"lenta-info-block");BX.addClass(BX("post_block_check_cont"),"info-block-important")}else{BX.removeClass(BX("post_block_check_cont"),"lenta-info-block");BX.removeClass(BX("post_block_check_cont"),"info-block-important")}if(e.bSetFocusOnCommentForm!="YES"&&e.bSetFocusOnCommentsList!="YES"){__MSLDetailMoveTop()}if(BX("post-comments-form-wrap")){if(e.can_user_comment!=="YES"){if(BX("empty_page_bottom_margin")){BX("empty_page_bottom_margin").style.display="none"}app.hideInput()}}}if(e.bSetFocusOnCommentForm=="YES"){oMSL.detailPageFocus="form"}else if(e.bSetFocusOnCommentsList=="YES"){oMSL.detailPageFocus="list"}else if(e.bSetFocusOnCommentsList=="YES"){oMSL.detailPageFocus=null}if(BX("post-comments-wrap")&&(!t||oMSL.emptyRefreshCommentsFlag)){oMSL.getComments({ts:e.TS,bPullDown:false,bPullDownTop:false,obFocus:{form:e.bSetFocusOnCommentForm,comments:e.bSetFocusOnCommentsList}});oMSL.emptyRefreshCommentsFlag=false}oMSL.adjustDetailPageFocus();BX.removeAllCustomEvents("main.post.form/mobile_simple");BX.addCustomEvent("main.post.form/mobile_simple",function(){setTimeout(oMSL.adjustDetailPageFocus,150)})};BitrixMSL.prototype.adjustDetailPageFocus=function(){if(oMSL.detailPageFocus){oMSL.setFocusOnComments(oMSL.detailPageFocus)}};BitrixMSL.prototype.drawDetailPageText=function(e){var t="";var o=typeof e.logID!="undefined"?parseInt(e.logID):0;var n=o&&BX("post_block_check_cont_"+o)?BX("post_block_check_cont_"+o):BX("post_block_check_cont");var i=o&&BX("post_item_top_"+o)?BX("post_item_top_"+o):BX("post_item_top");if(n){n.innerHTML="";BitrixMobile.LazyLoad.clearImages();if(typeof e.detailText!="undefined"){n.innerHTML=e.detailText;t+=oMSL.parseAndExecCode(e.detailText,0,false,true)}}if(i){i.innerHTML="";if(typeof e.topText!=="undefined"){i.innerHTML=e.topText;t+=oMSL.parseAndExecCode(e.topText,0,false,true)}}setTimeout(function(){__MSLSendErrorEval(t);BitrixMobile.LazyLoad.showImages();if(BX.message("MSLLoadScriptsNeeded")=="Y"&&typeof oMSL==="object"){oMSL.loadScripts()}},0)};BitrixMSL.prototype.onLogEntryPostUpdated=function(e){var t="";if(typeof e.logID!=="undefined"){if(typeof e.detailText!=="undefined"&&BX("post_block_check_cont_"+parseInt(e.logID))){BX("post_block_check_cont_"+parseInt(e.logID)).innerHTML=e.detailText;t+=oMSL.parseAndExecCode(e.detailText,0,false,true)}if(typeof e.topText!=="undefined"&&BX("post_item_top_"+parseInt(e.logID))){BX("post_item_top_"+parseInt(e.logID)).innerHTML=e.topText;t+=oMSL.parseAndExecCode(e.topText,0,false,true)}setTimeout(function(){__MSLSendErrorEval(t);BitrixMobile.LazyLoad.showImages();if(BX.message("MSLLoadScriptsNeeded")=="Y"&&typeof oMSL==="object"){oMSL.loadScripts()}},0)}};BitrixMSL.prototype.changeCounter=function(e,t,o){if(this.counterTimeout!==null){clearTimeout(this.counterTimeout);this.counterTimeout=null}t=typeof t!="undefined"?parseInt(t):0;o=typeof o!="undefined"?parseInt(o):0;var n=t>0?t:o>0?o:0;this.counterValue=e;if(parseInt(oMSL.counterValue)>0){oMSL.showNotifier(oMSL.counterValue)}else{this.counterTimeout=setTimeout(function(){if(n>oMSL.iframeCacheTs){oMSL.refreshNeeded=true}if(oMSL.refreshNeeded&&!oMSL.refreshStarted){oMSL.showRefreshNeededNotifier()}else{oMSL.hideNotifier()}clearTimeout(oMSL.counterTimeout)},2e3)}};BitrixMSL.prototype.editComment=function(e){commentType=typeof e.commentType=="undefined"?"log":e.commentType;postId=typeof e.postId=="undefined"?0:parseInt(e.postId);nodeId=typeof e.nodeId=="undefined"?"":e.nodeId;if(typeof e.commentText!="string"&&typeof e.commentText!="number"||e.commentText.length<=0||parseInt(e.commentId)<=0){return}this.getCommentData({commentType:commentType,commentId:e.commentId,postId:postId},function(t){oMSL.newPostFormParams={};if(typeof t.CommentCanEdit!="undefined"&&t.CommentCanEdit=="Y"){oMSL.setPostFormExtraDataArray({commentId:e.commentId,commentType:commentType,postId:postId,nodeId:nodeId});if(typeof t.CommentDetailText!="undefined"){oMSL.setPostFormParams({messageText:t.CommentDetailText})}if(typeof t.CommentFiles!="undefined"){oMSL.setPostFormParams({messageFiles:t.CommentFiles})}if(typeof t.CommentUFCode!="undefined"){oMSL.setPostFormExtraData({messageUFCode:t.CommentUFCode})}app.exec("showPostForm",oMSL.showNewPostForm({entityType:"comment"}))}})};BitrixMSL.prototype.deleteComment=function(e){if(parseInt(e.commentId)<=0){return}commentType=typeof e.commentType=="undefined"?"log":e.commentType;nodeId=typeof e.nodeId=="undefined"?"":e.nodeId;oMSL.showCommentWait({nodeId:nodeId,status:true});BXMobileApp.UI.Page.TextPanel.clear();var t=false;if(commentType=="blog"){t=new MobileAjaxWrapper;t.Wrap({type:"html",method:"GET",url:commentVarURL+"&sessid="+BX.bitrix_sessid()+"&delete_comment_id="+e.commentId,data:"",callback:function(t){bLockCommentSending=false;if(t!="*"&&t.length>0){oMSL.hideComment(BX(nodeId),commentType)}else{oMSL.showCommentAlert({nodeId:nodeId,action:"delete",commentType:commentType,callback:function(){oMSL.deleteComment({commentId:e.commentId,commentType:commentType,nodeId:nodeId})}})}},callback_failure:function(){bLockCommentSending=false;oMSL.showCommentAlert({nodeId:nodeId,action:"delete",commentType:commentType,callback:function(){oMSL.deleteComment({commentId:e.commentId,commentType:commentType,nodeId:nodeId})}})}})}else{var o={sessid:BX.bitrix_sessid(),site:commentVarSiteID,lang:commentVarLanguageID,log_id:oMSL.getLogId(),delete_id:e.commentId,action:"delete_comment",mobile_action:"delete_comment"};t=new MobileAjaxWrapper;t.Wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",data:o,callback:function(t){if(t["commentID"]!="undefined"&&parseInt(t["commentID"])>0&&parseInt(t["commentID"])==e.commentId){oMSL.hideComment(BX(nodeId),commentType)}else{oMSL.showCommentAlert({nodeId:nodeId,action:"delete",commentType:commentType,callback:function(){oMSL.deleteComment({commentId:e.commentId,commentType:commentType,nodeId:nodeId})}})}},callback_failure:function(){oMSL.showCommentAlert({nodeId:nodeId,action:"delete",commentType:commentType,callback:function(){oMSL.deleteComment({commentId:e.commentId,commentType:commentType,nodeId:nodeId})}})}})}};BitrixMSL.prototype.hideComment=function(e,t){t=typeof t=="undefined"?"log":t;BX.cleanNode(e,true);var o=t=="blog"?BX.message("SBPClogID"):0;var n=0;var i=false;if(BX("informer_comments_"+o)){n=BX("informer_comments_"+o).innerHTML.length>0?parseInt(BX("informer_comments_"+o).innerHTML):0;if(n>0){i=n-1;BX("informer_comments_"+o).innerHTML=i>0?i:""}}else if(BX("informer_comments_common")){n=BX("informer_comments_common").innerHTML.length>0?parseInt(BX("informer_comments_common").innerHTML):0;if(n>0){i=n-1;BX("informer_comments_common").innerHTML=i>0?i:""}}else if(BX("informer_comments")){n=BX("informer_comments").innerHTML.length>0?parseInt(BX("informer_comments").innerHTML):0;if(n>0){i=n-1;BX("informer_comments").innerHTML=i>0?i:""}}if(BX("comcntleave-all")){n=BX("comcntleave-all").innerHTML.length>0?parseInt(BX("comcntleave-all").innerHTML):0;if(n>0){i=n-1;if(i>0){BX("comcntleave-all").innerHTML=i}else{BX("comcntleave-all").style.dusplay="none"}}}if(BX("comcntleave-old")){n=BX("comcntleave-old").innerHTML.length>0?parseInt(BX("comcntleave-old").innerHTML):0;if(n>0){i=n-1;if(i>0){BX("comcntleave-old").innerHTML=i}else{BX("comcntleave-old").style.dusplay="none"}}}if(i!==false){BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:o,num:i},true)}};BitrixMSL.prototype.createCommentInputForm=function(e){BXMobileApp.UI.Page.TextPanel.setParams(e);BXMobileApp.UI.Page.TextPanel.clear();BXMobileApp.UI.Page.TextPanel.show()};BitrixMSL.prototype.drawPullComment=function(e){this.showNewPullComment(e,"entry-comment-"+e["FULL_ID"].join("-"));BXMobileApp.onCustomEvent("onLogEntryRead",{log_id:tmp_log_id,ts:e["POST_TIMESTAMP"],bPull:true},true)};BitrixMSL.prototype.showNewPullComment=function(e,t){if(!BX(t)){var o=document.body;e["POST_TIMESTAMP"]=parseInt(e["POST_TIMESTAMP"])+parseInt(BX.message("USER_TZ_OFFSET"))+parseInt(BX.message("SERVER_TZ_OFFSET"));e["POST_DATETIME_FORMATTED"]=BX.date.format("d F Y",e["POST_TIMESTAMP"])==BX.date.format("d F Y")?BX.date.format(BX.message("MSLDateTimeFormat").indexOf("a")>=0?"g:i a":"G:i",e["POST_TIMESTAMP"],false,true):BX.date.format(BX.message("MSLDateTimeFormat"),e["POST_TIMESTAMP"],false,true);var n=null,i=null;if(typeof e["POST_MESSAGE_TEXT_MOBILE"]!="undefined"&&e["POST_MESSAGE_TEXT_MOBILE"].length>0&&e["POST_MESSAGE_TEXT_MOBILE"]!="NO"){this.parseAndExecCode(e["POST_MESSAGE_TEXT_MOBILE"])}if(typeof e["AFTER_MOBILE"]!="undefined"&&e["AFTER_MOBILE"].length>0&&e["AFTER_MOBILE"]!="NO"){n=BX.create("DIV",{props:{className:"post-item-attached-file-wrap",id:t+"-files"},html:e["AFTER_MOBILE"]});this.parseAndExecCode(e["AFTER_MOBILE"])}if(typeof e["BEFORE_ACTIONS_MOBILE"]!="undefined"&&e["BEFORE_ACTIONS_MOBILE"].length>0&&e["BEFORE_ACTIONS_MOBILE"]!="NO"){i=BX.create("SPAN",{html:e["BEFORE_ACTIONS_MOBILE"]});this.parseAndExecCode(e["BEFORE_ACTIONS_MOBILE"])}var a=oMSL.buildCommentReplyNode({EVENT:{USER_ID:e.AUTHOR.ID},CREATED_BY:{FORMATTED:e.AUTHOR.NAME}});BX("post-comment-last-after").parentNode.insertBefore(BX.create("DIV",{attrs:{id:t},props:{className:"post-comment-block"},children:[BX.create("DIV",{props:{className:"post-user-wrap"},children:[BX.create("DIV",{props:{className:"avatar"},style:{backgroundImage:typeof e["AUTHOR"]["AVATAR"]!="undefined"&&e["AUTHOR"]["AVATAR"].length>0&&e["AUTHOR"]["AVATAR"]!="NO"?"url('"+e["AUTHOR"]["AVATAR"]+"')":""},children:[]}),BX.create("DIV",{props:{className:"post-comment-cont"},children:[BX.create("A",{attrs:{href:oMSL.replaceUserPath(e["AUTHOR"]["URL"])},props:{className:"post-comment-author"},html:e["AUTHOR"]["NAME"]}),BX.create("DIV",{props:{className:"post-comment-time"},html:e["POST_DATETIME_FORMATTED"]})]})]}),BX.create("DIV",{props:{className:"post-comment-text",id:t+"-text"},html:typeof e["POST_MESSAGE_TEXT_MOBILE"]!="undefined"&&e["POST_MESSAGE_TEXT_MOBILE"].length>0&&e["POST_MESSAGE_TEXT_MOBILE"]!="NO"?oMSL.replaceUserPath(e["POST_MESSAGE_TEXT_MOBILE"]):e["POST_MESSAGE_TEXT"]}),n,i,a]}),BX("post-comment-last-after"));var s=o.scrollHeight-o.offsetHeight;setTimeout(function(){if(o.scrollTop>=s-120&&o){BitrixAnimation.animate({duration:1e3,start:{scroll:o.scrollTop},finish:{scroll:o.scrollTop+140},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function(e){o.scrollTop=e.scroll},complete:function(){}})}BX.addClass(BX(t),"post-comment-new-transition")},0);setTimeout(function(){BitrixMobile.LazyLoad.showImages();BX.MSL.viewImageBind(t+"-text",{tag:"IMG",attr:"data-bx-image"});if(n!=null){BX.MSL.viewImageBind(t+"-files",{tag:"IMG",attr:"data-bx-image"})}},500);var r=BX.message("MSLLogId");var l=0;var d=0;if(BX("informer_comments_"+r)&&!BX("informer_comments_new_"+r)){l=BX("informer_comments_"+r).innerHTML.length>0?parseInt(BX("informer_comments_"+r).innerHTML):0;d=l+1;BX("informer_comments_"+r).innerHTML=d}else if(BX("informer_comments_common")){l=BX("informer_comments_common").innerHTML.length>0?parseInt(BX("informer_comments_common").innerHTML):0;d=l+1;BX("informer_comments_common").innerHTML=d}if(BX("comcntleave-all")){l=BX("comcntleave-all").innerHTML.length>0?parseInt(BX("comcntleave-all").innerHTML):0;d=l+1;BX("comcntleave-all").innerHTML=d}if(typeof tmp_log_id!="undefined"&&parseInt(tmp_log_id)>0){BXMobileApp.onCustomEvent("onLogEntryCommentAdd",{log_id:tmp_log_id},true)}}};BitrixMSL.prototype.parseAndExecCode=function(e,t,o,n){if(typeof e!="string"||e.length<=0){return}t=typeof t=="undefined"?500:parseInt(t);o=typeof o=="undefined"?true:!!o;n=!!n;var i=BX.processHTML(e);var a="";if(i!=null&&i.SCRIPT!=null&&typeof i.SCRIPT!="undefined"){for(var s=0;s<i.SCRIPT.length;s++){if(i.SCRIPT[s].isInternal){a+=";"+i.SCRIPT[s].JS}}if(o&&a.length>0){setTimeout(function(){__MSLSendErrorEval(a)},t)}}return n?a:false};BitrixMSL.prototype.replaceUserPath=function(e){if(typeof e!="string"||e.length<=0){return}if(BX("MSLIsExtranetSite")=="Y"){e=e.replace("/mobile/users/?user_id=",BX.message("MSLExtranetSiteDir")+"mobile/users/?user_id=")}else{e=e.replace(BX.message("MSLExtranetSiteDir")+"mobile/users/?user_id=","/mobile/users/?user_id=")}e=e.replace(new RegExp('[\\w/]+/personal/user/(\\d+)/"',"igm"),BX("MSLIsExtranetSite")=="Y"?BX.message("MSLExtranetSiteDir")+'mobile/users/?user_id=$1"':'/mobile/users/?user_id=$1"');return e};BitrixMSL.prototype.createCommentMenu=function(e,t,o){BX.bind(e,"click",function(n){n=n||window.event;if(n.target.tagName.toUpperCase()=="A"){return false}var i=BX.findParent(n.target,{tag:"A"},{tag:"DIV",className:"post-comment-text"});if(i){return false}var a=[];a.push({title:BX.message("MSLReply"),callback:function(){oMSL.replyToComment(t["EVENT"]["USER_ID"],BX.util.htmlspecialcharsback(t["CREATED_BY"]["FORMATTED"]))}});if(typeof t["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"]!="undefined"&&parseInt(t["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])>0&&typeof o!="undefined"&&o){a.push({title:BX.message("MSLLikesList"),callback:function(){RatingLikeComments.List(o)}})}if(BX.type.isNotEmptyObject(t["EVENT_FORMATTED"])&&BX.type.isNotEmptyString(t["EVENT_FORMATTED"]["CAN_EDIT"])&&t["EVENT_FORMATTED"]["CAN_EDIT"]=="Y"){a.push({title:BX.message("MSLCommentMenuEdit"),callback:function(){oMSL.editComment({commentId:t["EVENT"]["ID"],commentText:t["EVENT"]["MESSAGE"],commentType:"log",postId:t["EVENT"]["LOG_ID"],nodeId:e.id})}})}if(typeof t["EVENT_FORMATTED"]!="undefined"&&typeof t["EVENT_FORMATTED"]["CAN_DELETE"]!="undefined"&&t["EVENT_FORMATTED"]["CAN_DELETE"]=="Y"){a.push({title:BX.message("MSLCommentMenuDelete"),callback:function(){oMSL.deleteComment({commentId:t["EVENT"]["ID"],commentType:"log",nodeId:e.id})}})}oMSL.showCommentMenu(a)})};BitrixMSL.prototype.showCommentMenu=function(e){var t=new BXMobileApp.UI.ActionSheet({buttons:e},"commentSheet");t.show()};BitrixMSL.prototype.showTextPanelMenu=function(){var e=new BXMobileApp.UI.ActionSheet({buttons:[{title:BX.message("MSLTextPanelMenuPhoto"),callback:function(){app.takePhoto({source:1,correctOrientation:true,targetWidth:1e3,targetHeight:1e3,callback:function(e){oMSL.uploadCommentFile(e)}})}},{title:BX.message("MSLTextPanelMenuGallery"),callback:function(){app.takePhoto({targetWidth:1e3,targetHeight:1e3,callback:function(e){oMSL.uploadCommentFile(e)}})}}]},"textPanelSheet");e.show()};BitrixMSL.prototype.InitDetail=function(e){this.commentLoadingFilesStack=[];this.commentsType=typeof e.commentsType!="undefined"&&e.commentsType=="blog"?"blog":"log";this.entityXMLId=typeof e.entityXMLId!="undefined"?e.entityXMLId:"";this.bFollow=!(typeof e.bFollow!="undefined"&&!e.bFollow);this.bUseTasks=typeof e.bUseTasks!="undefined"&&e.bUseTasks;this.commentTextCurrent="";this.arMention=[];this.iDetailTs=typeof e.TS!="undefined"?e.TS:0;if(!this.bKeyboardCaptureEnabled){app.enableCaptureKeyboard(true);this.bKeyboardCaptureEnabled=true;BX.addCustomEvent("onKeyboardWillShow",BX.delegate(function(){this.keyboardShown=true},this));BX.addCustomEvent("onKeyboardDidHide",BX.delegate(function(){this.keyboardShown=false},this))}if(BX.type.isNotEmptyString(e.detailPageId)&&this.detailPageId!=e.detailPageId){this.detailPageId=e.detailPageId;if(typeof e.logId!="undefined"&&parseInt(e.logId)>0){this.logId=parseInt(e.logId)}BXMobileApp.addCustomEvent("onMPFCommentSent",BX.proxy(function(e){if(e.detailPageId==this.detailPageId&&e.data.action=="EDIT_COMMENT"&&e.data.text.length>0&&parseInt(e.data.commentId)>0){if(this.commentsType=="blog"){blogCommentsNativeInputCallback({text:e.data.text,oPreviewComment:null,commentId:e.data.commentId,nodeId:e.nodeId,ufCode:e.ufCode,attachedFiles:e.data[ufCode],attachedFilesRaw:e.data.attachedFilesRaw})}else{commentsNativeInputCallback({text:e.data.text,oPreviewComment:null,commentId:e.data.commentId,nodeId:e.nodeId,ufCode:e.ufCode,attachedFiles:e.data[ufCode],attachedFilesRaw:e.data.attachedFilesRaw})}}},this))}this.menuData={entry_type:this.commentsType,destinations:typeof e.entryParams!="undefined"&&e.entryParams.destinations!="undefined"?e.entryParams.destinations:{},post_perm:typeof e.entryParams!="undefined"&&e.entryParams.post_perm!="undefined"?e.entryParams.post_perm:null,post_id:typeof e.entryParams!="undefined"&&e.entryParams.post_id!="undefined"?e.entryParams.post_id:null,feed_id:typeof e.feed_id!="undefined"?e.feed_id:null,read_only:typeof e.readOnly!="undefined"&&e.readOnly=="Y"?"Y":"N",post_content_type_id:typeof e.entryParams!="undefined"&&BX.type.isNotEmptyString(e.entryParams.post_content_type_id)?e.entryParams.post_content_type_id:null,post_content_id:typeof e.entryParams!="undefined"&&typeof e.entryParams.post_content_id!="undefined"?parseInt(e.entryParams.post_content_id):null};this.detailPageMenuItems=this.buildDetailPageMenu(this.menuData);this.showPageMenu("detail")};BitrixMSL.prototype.showNewComment=function(e){var t=typeof e.text!="undefined"?e.text:"";var o=typeof e.arComment!="undefined"?e.arComment:false;var n=typeof e.oPreviewComment!="undefined"?e.oPreviewComment:false;var i=typeof e.bClearForm!="undefined"?!!e.bClearForm:false;var a=typeof e.bReplace!="undefined"?!!e.bReplace:false;var s=typeof e.bIncrementCounters!="undefined"?!!e.bIncrementCounters:true;var r=typeof e.bShowImages!="undefined"?!!e.bShowImages:true;if(!!n&&typeof oMSL.entityXMLId!="undefined"&&BX("entry-comment-"+oMSL.entityXMLId+"-"+e.commentId)){BX.cleanNode(BX(e.oPreviewComment),true);return}var l=null;if(o){if(!a&&BX("entry-comment-"+oMSL.entityXMLId+"-"+o["SOURCE_ID"])){return}var d=o["AVATAR_SRC"]&&typeof o["AVATAR_SRC"]!="undefined"?BX.create("DIV",{props:{className:"avatar"},style:{backgroundImage:"url('"+o["AVATAR_SRC"]+"')",backgroundRepeat:"no-repeat"}}):BX.create("DIV",{props:{className:"avatar"}});var m=Math.floor(Math.random()*1e5)+1;var p=typeof o["EVENT"]!="undefined"&&typeof o["EVENT"]["RATING_TYPE_ID"]!="undefined"&&o["EVENT"]["RATING_TYPE_ID"].length>0&&typeof o["EVENT"]["RATING_ENTITY_ID"]!="undefined"&&parseInt(o["EVENT"]["RATING_ENTITY_ID"])>0&&typeof o["EVENT"]["RATING_USER_VOTE_VALUE"]!="undefined"?oMSL.buildCommentRatingNode(o,m):null;var f=oMSL.buildCommentReplyNode({EVENT:{USER_ID:o.USER_ID},CREATED_BY:{FORMATTED:BX.util.htmlspecialcharsback(o.CREATED_BY.FORMATTED)}});UFNode=typeof o["UF_FORMATTED"]!="undefined"&&o["UF_FORMATTED"].length>0?BX.create("div",{props:{className:"post-item-attached-file-wrap",id:"entry-comment-"+oMSL.entityXMLId+"-"+o["SOURCE_ID"]+"-files"},html:o["UF_FORMATTED"]}):null;l=BX.create("DIV",{attrs:{id:"entry-comment-"+oMSL.entityXMLId+"-"+o["SOURCE_ID"]},props:{className:"post-comment-block"},children:[BX.create("DIV",{props:{className:"post-user-wrap"},children:[d,BX.create("DIV",{props:{className:"post-comment-cont"},children:[BX.create("A",{props:{className:"post-comment-author"},attrs:{href:o["CREATED_BY"]["URL"]},html:o["CREATED_BY"]["FORMATTED"]}),BX.create("DIV",{props:{className:"post-comment-time"},html:o["LOG_TIME_FORMAT"]})]})]}),BX.create("DIV",{props:{className:"post-comment-text"},html:typeof o["MESSAGE_FORMAT_MOBILE"]!="undefined"&&o["MESSAGE_FORMAT_MOBILE"].length>0?o["MESSAGE_FORMAT_MOBILE"]:o["MESSAGE_FORMAT"]}),UFNode,p,f]})}else{l=BX.create("DIV",{html:t})}if(!!n){if(a){n.parentNode.insertBefore(l,n)}BX.cleanNode(BX(n),true)}if(!a){BX("post-comment-last-after").parentNode.insertBefore(l,BX("post-comment-last-after"))}var c=false;if(o&&p){if(!window.RatingLikeComments&&top.RatingLikeComments){RatingLikeComments=top.RatingLikeComments}c=o["EVENT"]["RATING_TYPE_ID"]+"-"+o["EVENT"]["RATING_ENTITY_ID"]+"-"+m;RatingLikeComments.Set(c,o["EVENT"]["RATING_TYPE_ID"],o["EVENT"]["RATING_ENTITY_ID"],"Y")}if(o){var u={EVENT:{ID:o.EVENT.ID,LOG_ID:o.EVENT.LOG_ID,USER_ID:o.USER_ID,MESSAGE:o.MESSAGE,RATING_TOTAL_POSITIVE_VOTES:o.EVENT.RATING_TOTAL_POSITIVE_VOTES},EVENT_FORMATTED:{CAN_EDIT:o.CAN_EDIT,CAN_DELETE:o.CAN_DELETE},CREATED_BY:o.CREATED_BY};oMSL.createCommentMenu(l,u,c)}if(i&&BX("comment_send_form_comment")){BX("comment_send_form_comment").value=""}if(s){oMSL.incrementCounters(oMSL.getLogId())}if(typeof o["UF_FORMATTED"]!="undefined"){oMSL.parseAndExecCode(o["UF_FORMATTED"],0)}if(r){setTimeout(function(){BitrixMobile.LazyLoad.showImages()},500)}};BitrixMSL.prototype.showPreviewComment=function(e){if(!e)return false;var t=BX("empty_comment",true);var o=Math.floor(Math.random()*1e5)+1;var n=BX("post-comment-last-after");if(t&&n){var i=BX.clone(t,true);BX.adjust(BX(i),{attrs:{id:"new_comment_"+o}});var a=BX.findChild(i,{className:"post-comment-text"},true,false);a.innerHTML=e.replace(/\n/g,"<br />");n.parentNode.insertBefore(i,n);BX(i).style.display="block";var s=document.body;var r=s.scrollHeight-s.offsetHeight;var l=window.platform=="android"?600:120;if(s&&s.scrollTop>=r-l){BitrixAnimation.animate({duration:1e3,start:{scroll:s.scrollTop},finish:{scroll:s.scrollTop+l+20},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function(e){s.scrollTop=e.scroll},complete:function(){}})}}return!!i?BX(i):false};BitrixMSL.prototype.showCommentWait=function(e){if(typeof e.nodeId!="undefined"){var t=BX.findChild(BX(e.nodeId),{className:"post-comment-cont"},true,false);var o=false;var n=false;if(t){o=BX.findChild(t,{className:"post-comment-preview-wait"},true,false);n=BX.findChild(t,{className:"post-comment-preview-undelivered"},true,false)}if(e.status){if(!o){t.appendChild(BX.create("DIV",{props:{id:e.nodeId+"-status",className:"post-comment-preview-wait"}}))}if(!n){t.appendChild(BX.create("DIV",{props:{className:"post-comment-preview-undelivered"}}))}}}};BitrixMSL.prototype.showCommentAlert=function(e){var t=typeof e.commentType!="undefined"&&e.commentType=="blog"?"blog":"log";var o=typeof e.commentId!="undefined"&&e.commentId?e.commentId:0;var n=typeof e.text!="undefined"&&e.text?e.text:"";var i=typeof e.callback!="undefined"?e.callback:false;var a=typeof e.action!="undefined"?e.action:false;if(typeof e.nodeId!="undefined"){if(a=="add"){this.alertPreviewComment({nodeId:e.nodeId,text:n,commentType:t,commentId:o,action:a,callback:i})}else{var s=BX.findChild(BX(e.nodeId),{className:"post-comment-cont"},true,false);if(s){var r=BX.findChild(s,{className:"post-comment-preview-undelivered"},true,false);if(!r){s.appendChild(BX.create("DIV",{props:{id:e.nodeId+"-status",className:"post-comment-preview-undelivered"},style:{display:"block"}}))}this.alertPreviewComment({nodeId:e.nodeId,text:n,commentType:t,commentId:o,action:a,callback:i})}}}};BitrixMSL.prototype.alertPreviewComment=function(e){var t=typeof e.commentId!="undefined"&&e.commentId?e.commentId:0;var o=typeof e.commentType!="undefined"&&e.commentType=="blog"?"blog":"log";var n=typeof e.text!="undefined"&&e.text?e.text:"";var i=typeof e.callback!="undefined"?e.callback:false;if(typeof e.nodeId!="undefined"){var a=BX.findChild(BX(e.nodeId),{className:"post-comment-preview-wait"},true,false);var s=BX.findChild(BX(e.nodeId),{className:"post-comment-preview-undelivered"},true,false);if(!!a&&!!s){BX(a).style.display="none";BX(s).style.display="block";BX.bind(BX(s),"click",function(){BX.unbindAll(BX(s));BX(a).style.display="block";BX(s).style.display="none";if(i){i()}})}}};BitrixMSL.prototype.showCommentProgressBar=function(e){if(typeof e=="undefined"||!BX(e)){return}BX.findChild(e,{className:"post-comment-text"},true,false).appendChild(BX.create("DIV",{props:{id:e.id+"-progressbar-cont",className:"comment-loading"},style:{display:"none"},children:[BX.create("DIV",{props:{id:e.id+"-progressbar-label",className:"newpost-progress-label"}}),BX.create("DIV",{props:{id:e.id+"-progressbar-ind",className:"newpost-progress-indicator"}})]}));BX(e.id+"-progressbar-cont").style.display="block";var t=Math.floor(Math.random()*1e5)+1;oMSL.commentLoadingFilesStack[oMSL.commentLoadingFilesStack.length]=t;clearInterval(oMSL.commentProgressBarAnimation);oMSL.commentProgressBarAnimation=BitrixAnimation.animate({duration:oMSL.commentLoadingFilesStack.length*5e3,start:{width:parseInt(oMSL.commentProgressBarState/oMSL.commentLoadingFilesStack.length)+10},finish:{width:90},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.linear),step:function(t){BX(e.id+"-progressbar-ind").style.width=t.width+"%";oMSL.commentProgressBarState=t.width},complete:function(){oMSL.commentProgressBarState=0}});return t};BitrixMSL.prototype.hideCommentProgressBar=function(e,t){if(typeof t=="undefined"||!BX(t)){return}var o=[];for(var n=0;n<this.commentLoadingFilesStack.length;n++){if(this.commentLoadingFilesStack[n]!=e){o[o.length]=this.commentLoadingFilesStack[n]}}this.commentLoadingFilesStack=o;if(this.commentLoadingFilesStack.length==0){clearInterval(this.commentProgressBarAnimation);this.commentProgressBarState=0;BX(t.id+"-progressbar-ind").style.width="100%";setTimeout(function(){if(BX(t.id+"-progressbar-cont")){BX(t.id+"-progressbar-cont").style.display="none"}},2e3)}};BitrixMSL.prototype.setFollow=function(e){var t=typeof e.logId!="undefined"?parseInt(e.logId):0;var o=typeof e.pageId!="undefined"?e.pageId:false;var n=typeof e.bOnlyOn!="undefined"?e.bOnlyOn:false;if(n=="NO"){n=false}var i=typeof e.bRunEvent!="undefined"?e.bRunEvent:true;var a=typeof e.bAjax!="undefined"?e.bAjax:false;var s=BX("log_entry_follow_"+t);if(!s){s=BX("log_entry_follow")}var r=BX("post_item_top_wrap_"+t);if(!r){r=BX("post_item_top_wrap")}if(s&&(!BX.type.isNotEmptyString(this.detailPageId)||this.detailPageId!=o)){var l=s.getAttribute("data-follow")=="Y"?"Y":"N";var d=l=="Y"?"N":"Y";if(!n||l=="N"){BX.removeClass(s,l=="Y"?"post-item-follow-active":"post-item-follow");BX.addClass(s,l=="Y"?"post-item-follow":"post-item-follow-active");s.setAttribute("data-follow",d);if(i){BXMobileApp.onCustomEvent("onLogEntryFollow",{logId:t,pageId:BX.type.isNotEmptyString(oMSL.detailPageId)?oMSL.detailPageId:"",bOnlyOn:n?"Y":"N"},true)}if(!this.getFollowDefaultValue()&&r){if(l=="Y"){BX.removeClass(r,"post-item-follow")}else{BX.addClass(r,"post-item-follow")}}if(BX.type.isNotEmptyString(this.detailPageId)){this.setFollowValue(d=="Y");this.setFollowMenuItemName()}}}if(a){var m=new MobileAjaxWrapper;m.runAction("socialnetwork.api.livefeed.changeFollow",{data:{logId:t,value:d},analyticsLabel:{b24statAction:d=="Y"?"setFollow":"setUnfollow"}},{success:function(e){if(!e.data.success){if(s){BX.removeClass(s,l=="Y"?"post-item-follow":"post-item-follow-active");BX.addClass(s,l=="Y"?"post-item-follow-active":"post-item-follow");s.setAttribute("data-follow",l)}if(BX.type.isNotEmptyString(this.detailPageId)){this.setFollowValue(l=="Y");this.setFollowMenuItemName()}if(!this.getFollowDefaultValue()&&r){if(l=="Y"){BX.addClass(r,"post-item-follow")}else{BX.removeClass(r,"post-item-follow")}}if(this.getLogId()>0){BXMobileApp.onCustomEvent("onLogEntryFollow",{logId:t,pageId:BX.type.isNotEmptyString(this.detailPageId)?this.detailPageId:"",bOnlyOn:n?"Y":"N"},true)}}}.bind(this),failure:function(e){if(s){BX.removeClass(s,l=="Y"?"post-item-follow":"post-item-follow-active");BX.addClass(s,l=="Y"?"post-item-follow-active":"post-item-follow");s.setAttribute("data-follow",l)}if(!this.getFollowDefaultValue()&&r){if(l=="Y"){BX.addClass(r,"post-item-follow")}else{BX.removeClass(r,"post-item-follow")}}if(BX.type.isNotEmptyString(this.detailPageId)){this.setFollowValue(l=="Y");this.setFollowMenuItemName()}}.bind(this)})}return false};BitrixMSL.prototype.setFollowDefault=function(e){if(typeof e.value=="undefined"){return}var t=!!e.value;if(!BX.type.isNotEmptyString(oMSL.detailPageId)){this.setFollowDefaultValue(t);this.setDefaultFollowMenuItemName()}var o={sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("MSLLangId"),value:t?"Y":"N",action:"change_follow_default",mobile_action:"change_follow_default"};this.changeListMode(o,function(e){oMSL.pullDownAndRefresh()},function(e){oMSL.setFollowDefaultValue(e.value!="Y");oMSL.setDefaultFollowMenuItemName()})};BitrixMSL.prototype.setExpertMode=function(e){if(typeof e.value=="undefined"){return}var t=!!e.value;if(!BX.type.isNotEmptyString(oMSL.detailPageId)){oMSL.bExpertMode=t;this.setExpertModeMenuItemName()}var o={sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("MSLLangId"),value:t?"Y":"N",action:"change_expert_mode",mobile_action:"change_expert_mode"};this.changeListMode(o,function(e){oMSL.pullDownAndRefresh()},function(e){oMSL.bExpertMode=!(e.value=="Y");oMSL.setExpertModeMenuItemName()})};BitrixMSL.prototype.changeListMode=function(e,t,o){app.showPopupLoader({text:""});var n=false,i="";if(e.action=="change_follow_default"){n="socialnetwork.api.livefeed.changeFollowDefault";i=e.value=="Y"?"setFollowType":"unsetFollowType"}else if(e.action=="change_expert_mode"){n="socialnetwork.api.livefeed.changeExpertMode";i=e.value=="Y"?"setExpertMode":"unsetExpertMode"}if(!n){return}var a=new MobileAjaxWrapper;a.runAction(n,{data:{value:e.value},analyticsLabel:{b24statAction:i,b24statContext:"mobile"}},{success:function(n){app.hidePopupLoader();if(n.data.success){t(e)}else{if(!BX.type.isNotEmptyString(oMSL.detailPageId)){o(e)}}}.bind(this),failure:function(t){app.hidePopupLoader();if(!BX.type.isNotEmptyString(oMSL.detailPageId)){o(e)}}})};BitrixMSL.prototype.incrementCounters=function(e){e=parseInt(e);if(e>0){var t=0;var o=0;if(BX("informer_comments_"+e)&&!BX("informer_comments_new_"+e)){t=BX("informer_comments_"+e).innerHTML.length>0?parseInt(BX("informer_comments_"+e).innerHTML):0;o=t+1;BX("informer_comments_"+e).innerHTML=o}else if(BX("informer_comments_common")){t=BX("informer_comments_common").innerHTML.length>0?parseInt(BX("informer_comments_common").innerHTML):0;o=t+1;BX("informer_comments_common").innerHTML=o}if(BX("comcntleave-all")){t=BX("comcntleave-all").innerHTML.length>0?parseInt(BX("comcntleave-all").innerHTML):0;o=t+1;BX("comcntleave-all").innerHTML=o}BXMobileApp.onCustomEvent("onLogEntryCommentAdd",{log_id:e},true)}};BitrixMSL.prototype.getComment=function(e){var t="";if(e.commentType=="blog"){if(!!e.oPreviewComment&&typeof oMSL.entityXMLId!="undefined"&&BX("entry-comment-"+oMSL.entityXMLId+"-"+e.commentId)){BX.cleanNode(BX(e.oPreviewComment),true);return}t=BX.message("SBPCurlToNew").replace(/#post_id#/,e.entryId).replace(/#comment_id#/,e.commentId)}if(t.length>0){var o=new MobileAjaxWrapper;o.Wrap({type:"json",method:"GET",url:t,data:"",processData:true,callback:function(t){if(typeof t.TEXT!="undefined"){oMSL.showNewComment({commentType:e.commentType,commentId:e.commentId,text:t.TEXT,bClearForm:false,oPreviewComment:e.oPreviewComment,bReplace:false,bIncrementCounters:true,bShowImages:false});oMSL.parseAndExecCode(t.TEXT);__MSLDetailMoveBottom();oMSL.setFollow({logId:oMSL.getLogId(),bOnlyOn:true})}else{oMSL.showCommentAlert({nodeId:e.oPreviewComment,commentType:e.commentType,callback:function(){oMSL.getComment(e)}})}},callback_failure:function(){oMSL.showCommentAlert({nodeId:e.oPreviewComment,commentType:e.commentType,callback:function(){oMSL.getComment(e)}})}})}};BitrixMSL.prototype.uploadCommentFile=function(e){var t=oMSL.showPreviewComment("");var o=oMSL.showCommentProgressBar(t);function n(e){var n=JSON.parse(e.response);if(typeof n.SUCCESS=="undefined"||n.SUCCESS!="Y"){i()}else{oMSL.hideCommentProgressBar(o,t);if(oMSL.commentsType=="blog"&&(typeof n.BLOG_COMMENT_ID!="undefined"||parseInt(n.BLOG_COMMENT_ID)>0)){oMSL.getComment({oPreviewComment:t,commentId:oMSL.commentsType=="blog"?n.BLOG_COMMENT_ID:false,entryId:oMSL.commentsType=="blog"?commentVarBlogPostID:false,commentType:oMSL.commentsType})}else if(oMSL.commentsType=="log"&&(typeof n.commentID!="undefined"||parseInt(n.commentID)>0)){oMSL.showNewComment({arComment:n["arCommentFormatted"],bIncrementCounters:true,oPreviewComment:t,bShowImages:true,bClearForm:false});__MSLDetailMoveBottom();oMSL.setFollow({logId:oMSL.getLogId(),bOnlyOn:true})}}}function i(i){app.BasicAuth({success:function(t){s.params.sessid=t.sessid_md5;r.upload(e,BX.message("MSLAjaxInterfaceFullURI"),n,a,s)},failture:function(){oMSL.hideCommentProgressBar(o,t);oMSL.showCommentAlert({nodeId:t,action:"upload_comment_photo",commentType:"blog",callback:function(){oMSL.uploadCommentFile(e)}})}})}function a(n){oMSL.hideCommentProgressBar(o,t);oMSL.showCommentAlert({nodeId:t,action:"upload_comment_photo",commentType:"blog",callback:function(){oMSL.uploadCommentFile(e)}})}var s=new FileUploadOptions;s.fileKey="file";s.fileName=e.substr(e.lastIndexOf("/")+1);s.mimeType="image/jpeg";s.params={mobile_action:"file_upload_"+oMSL.commentsType,action:"file_comment_upload",commentsType:oMSL.commentsType,sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("MSLLangId"),nt:BX.message("MSLNameTemplate"),sl:BX.message("MSLShowLogin"),p_user:BX.message("MSLPathToUser"),p_bpost:commentVarPathToBlogPost,as:commentVarAvatarSize,dtf:commentVarDateTimeFormat,sr:BX.message("MSLShowRating")};if(oMSL.commentsType=="blog"){s.params.post_id=commentVarBlogPostID}else{s.params.log_id=oMSL.getLogId()}s.chunkedMode=false;var r=new FileTransfer;r.upload(e,BX.message("MSLAjaxInterfaceFullURI"),n,i,s)};BitrixMSL.prototype.sendCommentWriting=function(e,t){e=typeof e!="undefined"?e:"";t=typeof t!="undefined"?t:"";if(e.length<=0){return}if(this.sendCommentWritingList[e]){return}clearTimeout(this.sendCommentWritingListTimeout[e]);this.sendCommentWritingList[e]=true;var o=new MobileAjaxWrapper;o.Wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",data:{sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("MSLLangId"),nt:BX.message("MSLNameTemplate"),sl:BX.message("MSLShowLogin"),as:commentVarAvatarSize,action:"send_comment_writing",mobile_action:"send_comment_writing",ENTITY_XML_ID:e},callback:function(e){},callback_failure:function(e){}});this.sendCommentWritingListTimeout[e]=setTimeout(BX.delegate(function(){this.endCommentWriting(e)},this),3e4)};BitrixMSL.prototype.endCommentWriting=function(e){e=typeof e!="undefined"?e:"";if(e.length<=0){return}clearTimeout(this.sendCommentWritingListTimeout[e]);this.sendCommentWritingList[e]=false};BitrixMSL.prototype.setFocusOnComments=function(e){e=e=="list"?"list":"form";if(e=="form"){this.setFocusOnCommentForm();__MSLDetailMoveBottom()}else if(e=="list"){if(BX("post-comments-wrap")){var t=BX.findChild(BX("post-comments-wrap"),{className:"post-comment-block-new"},true);if(t){document.body.scrollTop=t.offsetTop}else{var o=BX.findChild(BX("post-comments-wrap"),{className:"post-comment-block"},true);document.body.scrollTop=o?o.offsetTop:0}}}return false};BitrixMSL.prototype.setFocusOnCommentForm=function(){BXMobileApp.UI.Page.TextPanel.focus();return false};BitrixMSL.prototype.buildDetailPageMenu=function(e){var t=[];if(e.entry_type=="blog"){var o=null;var n={a_users:[],b_groups:[]};if(false&&typeof e.destinations!="undefined"){if(typeof e.destinations.U!="undefined"){for(o in e.destinations.U){if(e.destinations.U.hasOwnProperty(o)){var i=e.destinations.U[o];if(typeof i.ID!="undefined"){n.a_users.push(parseInt(i.ID)>0?parseInt(i.ID):0)}}}}if(typeof e.destinations.SG!="undefined"){for(o in e.destinations.SG){if(e.destinations.SG.hasOwnProperty(o)&&parseInt(o)>0){n.b_groups.push(parseInt(o))}}}}if(n.a_users.length>0||n.b_groups.length>0){t.push({name:BX.message("MSLSharePost"),action:function(){app.openTable({callback:function(){oMSL.shareBlogPost()},url:BX.message("MSLSiteDir")+"mobile/index.php?mobile_action="+(BX.message("MSLIsExtranetSite")=="Y"?"get_group_list":"get_usergroup_list")+"&feature=blog",markmode:true,multiple:true,return_full_mode:true,user_all:true,showtitle:true,modal:true,selected:n,alphabet_index:true,okname:BX.message("MSLShareTableOk"),cancelname:BX.message("MSLShareTableCancel"),outsection:BX.message("MSLIsDenyToAll")!="Y"})},arrowFlag:false,icon:"add"})}if(typeof e.post_perm!="undefined"&&e.post_perm=="W"){t.push({name:BX.message("MSLEditPost"),action:function(){oMSL.editBlogPost({feed_id:e.feed_id,post_id:parseInt(e.post_id)})},arrowFlag:false,icon:"edit",feature:"edit"});t.push({name:BX.message("MSLDeletePost"),action:function(){oMSL.deleteBlogPost({post_id:parseInt(e.post_id)})},arrowFlag:false,icon:"delete"})}}if(oMSL.bUseFollow&&(typeof e.read_only=="undefined"||e.read_only!="Y")){t.push({name:oMSL.getFollowValue()?BX.message("MSLFollowY"):BX.message("MSLFollowN"),image:"/bitrix/templates/mobile_app/images/lenta/menu/eye.png",action:function(){oMSL.setFollow({logId:oMSL.getLogId(),pageId:oMSL.pageId,bOnlyOn:false,bAjax:true,bRunEvent:true})},arrowFlag:false,feature:"follow"})}t.push({name:BX.message("MSLRefreshComments"),image:"/bitrix/templates/mobile_app/images/lenta/menu/n_refresh.png",action:function(){if(oMSL.bDetailEmptyPage){oMSL.getComments({ts:oMSL.iDetailTs,bPullDown:true,obFocus:{form:false}})}else{document.location.reload(true)}},arrowFlag:false});if(oMSL.bUseTasks&&BX.type.isNotEmptyString(e.post_content_type_id)&&BX.type.isNumber(e.post_content_id)&&e.post_content_id>0){t.push({name:BX.message("MSLCreateTask"),image:"/bitrix/templates/mobile_app/images/lenta/menu/n_check.png",action:function(){oMSL.createTask({entityType:e.post_content_type_id,entityId:parseInt(e.post_content_id)});return false},arrowFlag:false})}return t};BitrixMSL.prototype.showPageMenu=function(e){e=e=="detail"?"detail":"list";var t=e=="detail"?this.detailPageMenuItems:this.listPageMenuItems;var o=e=="detail"?BX.message("MSLLogEntryTitle")!=null?BX.message("MSLLogEntryTitle"):"":BX.message("MSLLogTitle")!=null?BX.message("MSLLogTitle"):"";if(t.length>0){app.menuCreate({items:t});BXMobileApp.UI.Page.TopBar.title.setText(o);BXMobileApp.UI.Page.TopBar.title.setCallback(function(){app.menuShow()});BXMobileApp.UI.Page.TopBar.title.show()}else{BXMobileApp.UI.Page.TopBar.title.setText(o);BXMobileApp.UI.Page.TopBar.title.setCallback("");BXMobileApp.UI.Page.TopBar.title.show()}};BitrixMSL.prototype.setFollowMenuItemName=function(){var e=false;for(var t=0;t<this.detailPageMenuItems.length;t++){e=this.detailPageMenuItems[t];if(typeof e.feature!="undefined"&&e.feature=="follow"){e.name=oMSL.getFollowValue()?BX.message("MSLFollowY"):BX.message("MSLFollowN");this.detailPageMenuItems[t]=e;this.showPageMenu("detail");break}}};BitrixMSL.prototype.setDefaultFollowMenuItemName=function(){var e=false;for(var t=0;t<this.listPageMenuItems.length;t++){e=this.listPageMenuItems[t];if(typeof e.feature!="undefined"&&e.feature=="follow"){e.name=oMSL.getFollowDefaultValue()?BX.message("MSLMenuItemFollowDefaultY"):BX.message("MSLMenuItemFollowDefaultN");this.listPageMenuItems[t]=e;this.showPageMenu("list");break}}};BitrixMSL.prototype.setExpertModeMenuItemName=function(){var e=false;for(var t=0;t<this.listPageMenuItems.length;t++){e=this.listPageMenuItems[t];if(typeof e.feature!="undefined"&&e.feature=="expert"){e.name=oMSL.bExpertMode?BX.message("MSLMenuItemExpertModeY"):BX.message("MSLMenuItemExpertModeN");this.listPageMenuItems[t]=e;this.showPageMenu("list");break}}};BitrixMSL.prototype.replyToComment=function(e,t,o){e=parseInt(e);var n=typeof this.commentTextCurrent!="undefined"?this.commentTextCurrent:"";this.arMention[t]="[USER="+e+"]"+t+"[/USER]";n=n+" "+t+", ";if(typeof this.commentTextCurrent!="undefined"){this.commentTextCurrent=n}BXMobileApp.UI.Page.TextPanel.setText(n);BXMobileApp.UI.Page.TextPanel.focus();return typeof o!="undefined"?o.preventDefault():false};BitrixMSL.prototype.buildCommentRatingNode=function(e,t){var o=e["EVENT"]["RATING_USER_VOTE_VALUE"]>0?"post-comment-likes-liked":"post-comment-likes";var n=parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])>1||parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])==1&&e["EVENT"]["RATING_USER_VOTE_VALUE"]<=0;return BX.create("DIV",{props:{id:"bx-ilike-button-"+e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t,className:o},children:[BX.create("DIV",{props:{className:"post-comment-likes-text"},html:n?BX.message("MSLLike2"):BX.message("MSLLike")}),BX.create("DIV",{props:{id:"bx-ilike-count-"+e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t,className:"post-comment-likes-counter"},style:{display:n?"inner-block":"none"},events:{click:function(o){RatingLikeComments.List(e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t);o.preventDefault()}},html:""+parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])+""})]})};BitrixMSL.prototype.buildCommentReplyNode=function(e){return BX.create("DIV",{props:{className:"post-comment-reply"},children:[BX.create("DIV",{props:{className:"post-comment-reply-text"},events:{click:function(t){oMSL.replyToComment(e["EVENT"]["USER_ID"],e["CREATED_BY"]["FORMATTED"],t||window.event)}},html:BX.message("MSLReply")})]})};BitrixMSL.prototype.drawRatingFooter=function(e){if(BX("rating-footer-wrap")){BX("rating-footer-wrap").innerHTML=e;this.parseAndExecCode(e,0)}};BitrixMSL.prototype.parseMentions=function(e){var t=e;if(typeof this.arMention!="undefined"){for(var o in this.arMention){t=t.replace(new RegExp(o,"g"),this.arMention[o])}this.arMention=[];this.commentTextCurrent=""}return t};BitrixMSL.prototype.unParseMentions=function(e){var t=e;t=t.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(e,t,o){oMSL.arMention[o]=e;return o});return t};BitrixMSL.prototype.expandText=function(e){var t=typeof e=="undefined"||e==null||!BX("post_block_check_cont_"+e)?BX("post_block_check_cont"):BX("post_block_check_cont_"+e);if(t){if(BX.hasClass(t,"post-item-post-block")){BX.addClass(t,this.classes.postItemBlockFull);BX.removeClass(t,"post-item-post-block")}else if(BX.hasClass(t,"lenta-info-block-wrapp")){BX.addClass(t,"lenta-info-block-wrapp-full");BX.removeClass(t,"lenta-info-block-wrapp")}var o=t.querySelector(".post-more-block");if(o){o.style.display="none"}if(BX("post_more_limiter_"+e)){BX("post_more_limiter_"+e).style.display="none"}else if(BX("post_more_limiter")){BX("post_more_limiter").style.display="none"}var n=BX.findChildren(t,{tagName:"img"},true);if(BX.type.isArray(n)){for(var i=0;i<n.length;i++){if(BX.type.isString(n[i].getAttribute("data-src"))&&n[i].getAttribute("data-src").length>0&&!!n[i].id){BitrixMobile.LazyLoad.registerImage(n[i].id)}}BitrixMobile.LazyLoad.showImages(false)}}};BitrixMSL.prototype.showEmptyCommentsBlockWaiter=function(e,t){t=!!t;if(!BX(e)){return}var o=BX.findChild(BX(e),{className:"post-comments-load-btn-wrap"},true,false);if(o){BX.cleanNode(o,true)}if(t){BX(e).appendChild(BX.create("DIV",{props:{className:"post-comments-load-btn-wrap"},children:[BX.create("DIV",{props:{className:"post-comments-loader"}}),BX.create("DIV",{props:{className:"post-comments-load-text"},text:BX.message("MSLDetailCommentsLoading")})]}))}};BitrixMSL.prototype.showEmptyCommentsBlockFailed=function(e,t,o,n,i){if(!BX(e)){return}var a=typeof i!="undefined"&&typeof i.ERROR_MESSAGE!="undefined"&&i.ERROR_MESSAGE.length>0?i.ERROR_MESSAGE:BX.message("MSLDetailCommentsFailed");BX(e).appendChild(BX.create("DIV",{props:{className:"post-comments-load-btn-wrap"},children:[BX.create("DIV",{props:{className:"post-comments-load-text"},text:a}),BX.create("A",{props:{className:"post-comments-load-btn"},events:{click:function(){BX.cleanNode(this.parentNode,true);oMSL.getComments({ts:t,bPullDown:o,obFocus:{form:false}})},touchstart:function(){this.classList.add("post-comments-load-btn-active")},touchend:function(){this.classList.remove("post-comments-load-btn-active")}},text:BX.message("MSLDetailCommentsReload")})]}))};BitrixMSL.prototype.afterEdit=function(e,t){t=typeof t!="undefined"?parseInt(t):0;var o="new_post_ajax_"+Math.random();var n=BX.create("DIV",{props:{id:o},html:e.text});BX("blog-post-first-after").parentNode.insertBefore(n,BX("blog-post-first-after").nextSibling);if(t>0&&BX("post_block_check_cont_"+t)&&BX("post_item_top_"+t)){BXMobileApp.onCustomEvent("onEditedPostInserted",{detailText:BX("post_block_check_cont_"+t).innerHTML,topText:BX("post_item_top_"+t).innerHTML,nodeID:o,logID:t},true)}BX.cleanNode(n,true);BitrixMobile.LazyLoad.showImages()};BitrixMSL.prototype.onMPFSent=function(e,t){var o=typeof e.data.post_id!="undefined"?parseInt(e.data.post_id):0;if(e.LiveFeedID!=window.LiveFeedID&&o<=0){return}window.scrollTo(0,0);if(o<=0){app.showPopupLoader({text:""})}e.data.response_type="json";var n=typeof e.ajaxUrl!="undefined"?e.ajaxUrl:oMSL.curUrl;n=BX.util.add_url_param(n,{b24statAction:o>0?"editLogEntry":"addLogEntry",b24statContext:"mobile"});var i=new MobileAjaxWrapper;i.Wrap({type:"json",method:"POST",url:n,data:e.data,processData:true,callback:function(n){app.hidePopupLoader();var i={a_users:[],b_groups:[]};if(o<=0&&(typeof n.error=="undefined"||n.error.length<=0)&&n.text.length>0){BX.localStorage.set("mobileLivefeedRefreshTS",Math.round((new Date).getTime()/1e3),86400*30);oMSL.refreshNeeded=false;oMSL.counterValue=0;oMSL.hideRefreshNeededNotifier();oMSL.hideNotifier();BX.MSL.DBDelete(t);oMSL.clearPostFormDestination(i,t);oMSL.setPostFormParams({selectedRecipients:i});oMSL.setPostFormParams({messageText:""});app.showPopupLoader({text:""});__MSLRefresh(true)}else if(o>0&&(typeof n.error=="undefined"||n.error.length<=0)){BXMobileApp.onCustomEvent("onAfterEdit",{postResponseData:n,postData:e},true)}else{if(o<=0){BX.MSL.DBSave(e.data,t);oMSL.buildSelectedDestinations(e.data,i);oMSL.setPostFormParams({selectedRecipients:i});oMSL.setPostFormParams({messageText:e.data.POST_MESSAGE})}oMSL.showPostError({errorText:n.error,feedId:window.LiveFeedID})}},callback_failure:function(){app.hidePopupLoader();if(o<=0){BX.MSL.DBSave(e.data,t);var n={a_users:[],b_groups:[]};oMSL.buildSelectedDestinations(e.data,n);oMSL.setPostFormParams({selectedRecipients:n});oMSL.setPostFormParams({messageText:e.data.POST_MESSAGE})}oMSL.showPostError({errorText:"",feedId:window.LiveFeedID});BXMobileApp.onCustomEvent("onEditedPostFailed",{},true)}})};BitrixMSL.prototype.onLogEntryFavorites=function(e,t){var o=BX("log_entry_favorites_"+e);if(o&&(BX.message("MSLPageId")==undefined||BX.message("MSLPageId")!=t)){var n=o.getAttribute("data-favorites")=="Y"?"Y":"N";var i=n=="Y"?"N":"Y";if(n=="Y"){BX.removeClass(o,"lenta-item-fav-active")}else{BX.addClass(o,"lenta-item-fav-active")}o.setAttribute("data-favorites",i)}};BitrixMSL.prototype.onLogEntryCommentAdd=function(e,t){var o,n;var i=typeof t!="undefined";if(typeof t=="undefined"){t=0}if(BX("informer_comments_"+e)&&!BX("informer_comments_new_"+e)){if(parseInt(t)>0){o=parseInt(t)}else if(!i){n=BX("informer_comments_"+e).innerHTML.length>0?parseInt(BX("informer_comments_"+e).innerHTML):0;o=n+1}if(parseInt(o)>0){BX("informer_comments_"+e).innerHTML=o;BX("informer_comments_"+e).style.display="inline-block";BX("informer_comments_text2_"+e).style.display="inline-block";BX("informer_comments_text_"+e).style.display="none"}}if(BX("comcntleave-all")){if(parseInt(t)>0){o=parseInt(t)}else if(!i){n=BX("comcntleave-all").innerHTML.length>0?parseInt(BX("comcntleave-all").innerHTML):0;o=n+1}BX("comcntleave-all").innerHTML=o}};BitrixMSL.prototype.onLogEntryRatingLike=function(e){var t=e.ratingId;if(typeof this.arRatingLikeProcess[t]!="undefined"){setTimeout(function(){oMSL.onLogEntryRatingLike(e)},100);return}this.arRatingLikeProcess[t]=true;var o=e.voteAction;var n=parseInt(e.logId);var i=typeof e.userId!="undefined"?parseInt(e.userId):BX.message("USER_ID");if(n<=0&&this.isUserCurrent(i)){delete this.arRatingLikeProcess[t];return}var a=BX("bx-ilike-box-"+t);if(!a){delete this.arRatingLikeProcess[t];return}var s=BX("bx-ilike-button-"+t);if(!s){s=BX("rating_button")}if(!s||!BX.hasClass(s,"post-item-inform-likes")&&!BX.hasClass(s,"post-item-inform-likes-active")){delete this.arRatingLikeProcess[t];return}var r=null;var l=0;var d=0;var m=null;var p=n>0&&BX("rating_block_"+n)?BX("rating_block_"+n):BX("rating_button_cont");if(!p&&a){p=BX.findParent(a,{tag:"SPAN",className:"bx-ilike-block"})}if(a){r=BX.findChild(a,{className:"post-item-inform-right-text"},true,false);if(r&&p){l=parseInt(p.getAttribute("data-counter"));d=o=="plus"?l+1:l-1;r.innerHTML=d}if(this.isUserCurrent(i)){BX.removeClass(s,o=="plus"?"post-item-inform-likes":"post-item-inform-likes-active");BX.addClass(s,o=="plus"?"post-item-inform-likes-active":"post-item-inform-likes")}var f=BX.hasClass(s,"post-item-inform-likes-active")&&d>1||!BX.hasClass(s,"post-item-inform-likes-active")&&d>0;r=BX.findChild(s,{className:"post-item-inform-right"},true,false);if(r){r.innerHTML=d;r.style.display=f?"inline-block":"none";r=BX.findChild(s,{className:"post-item-inform-left"},true,false);r.innerHTML=f?BX.message("MSLLike2"):BX.message("MSLLike")}}if(p){p.setAttribute("data-counter",parseInt(d))}if(n>0&&BX("rating-footer_"+n)){m=BX("rating-footer-wrap_"+n)}else if(p){m=BX("rating-footer-wrap")}if(!m&&p&&typeof p.id!="undefined"){var c=p.id.match(/^rating_block_([\d]+)$/i);if(c!=null){m=BX("rating-footer-wrap_"+c[1])}}if(this.isUserCurrent(i)&&typeof BXRL!="undefined"&&typeof BXRL[t]!="undefined"){BXRL[t].lastVote=o=="plus"?"plus":"cancel"}delete this.arRatingLikeProcess[t]};BitrixMSL.prototype.onLogEntryImpPostRead=function(e){if(typeof e=="undefined"||typeof e.node=="undefined"||!BX(e.node)){return}oMSL.setLogEntryImpPostRead({node:BX(e.node),value:true})};BitrixMSL.prototype.setLogEntryImpPostRead=function(e){if(typeof e=="undefined"||typeof e.node=="undefined"||!BX(e.node)){return}var t=BX(e.node);var o=!!e.value;if(o){t.checked=true;t.setAttribute("done","Y");BX.unbindAll(t)}else{t.checked=false;delete t.checked;t.removeAttribute("done")}};BitrixMSL.prototype.onLogCommentRatingLike=function(e){var t=e.ratingId;if(typeof this.arRatingLikeProcess[t]!="undefined"){setTimeout(function(){oMSL.onLogCommentRatingLike(e)},100);return}this.arRatingLikeProcess[t]=true;var o=e.voteAction;var n=typeof e.userId!="undefined"?parseInt(e.userId):BX.message("USER_ID");var i=BX("bx-ilike-count-"+t);if(!i){delete this.arRatingLikeProcess[t];return}var a=parseInt(i.innerHTML);var s=o=="plus"?a+1:a-1;if(this.isUserCurrent(n)){delete this.arRatingLikeProcess[t];return}var r=BX("bx-ilike-button-"+t);if(!r||!BX.hasClass(r,"post-comment-likes")&&!BX.hasClass(r,"post-comment-likes-liked")){delete this.arRatingLikeProcess[t];return}if(i){var l=BX.hasClass(r,"post-comment-likes-liked")&&s>1||!BX.hasClass(r,"post-comment-likes-liked")&&s>0;i.innerHTML=s;i.style.display=l?"inline-block":"none";var d=BX.findChild(r,{className:"post-comment-likes-text"},true,false);d.innerHTML=l?BX.message("MSLLike2"):BX.message("MSLLike")}delete this.arRatingLikeProcess[t]};BitrixMSL.prototype.checkVisibility=function(e){var t=e.node;if(BX.hasClass(document.body,"lenta-page")){var o=oMSL.checkImageOffset(t);if(o===false){e.status=BitrixMobile.LazyLoad.status.hidden}return o}else if(!oMSL.isPostFull()&&oMSL.isImageFromPost(e)){return oMSL.checkImageOffset(t)}return true};BitrixMSL.prototype.checkImageOffset=function(e){if(BX.hasClass(e.parentNode,"post-item-attached-img-block")){return e.parentNode.parentNode.offsetTop<315}else{return e.offsetTop<315}};BitrixMSL.prototype.isPostFull=function(){var e=BX("post_block_check_cont_"+this.logId)?BX("post_block_check_cont_"+this.logId):BX("post_block_check_cont",true);return BX.hasClass(e,this.classes.postItemBlockFull)||BX.hasClass(e,"lenta-info-block-wrapp-full")};BitrixMSL.prototype.isImageFromPost=function(e){if(typeof e.fromPost!="undefined"){return e.fromPost}var t=5;var o=e.node;while(o=o.parentNode){if(BX.hasClass(o,"post-item-post-block")){e.fromPost=true;return true}if(t<=0){e.fromPost=false;return false}t--}};BitrixMSL.prototype.isUserCurrent=function(e){return e==BX.message("USER_ID")};BitrixMSL.prototype.checkNodesHeight=function(){var e=false,t=null,o=null;for(var n in this.arBlockToCheck){t=this.arBlockToCheck[n];o=BX(t.lenta_item_id)?BX(t.lenta_item_id).querySelector(".post-more-block"):false;if(o&&BX(t.text_block_id)){e=BX(t.text_block_id).offsetHeight;if(BX(t.title_block_id)){e+=BX(t.title_block_id).offsetHeight}if(BX(t.files_block_id)){e+=BX(t.files_block_id).offsetHeight}if(e>=320&&!BX.hasClass(t.text_block_id,this.classes.postItemBlockFull)){o.style.display="block";if(BX(t.lenta_item_id)){BX.removeClass(BX(t.lenta_item_id),"post-without-informers")}if(BX(t.more_button_id)){BX(t.more_button_id).style.display="block"}}else{if(o){o.style.display="none"}if(BX(t.more_button_id)){BX(t.more_button_id).style.display="none"}}}}};BitrixMSL.prototype.initScroll=function(e,t){e=!!e;t=!!t;if(e){BX.unbind(window,"scroll",__MSLOnFeedScroll);BX.bind(window,"scroll",__MSLOnFeedScroll)}else{BX.unbind(window,"scroll",__MSLOnFeedScroll)}if(t&&BX("next_post_more")){BX("next_post_more").style.display=e?"block":"none"}};BitrixMSL.prototype.onScrollDetail=function(){if(!oMSL.canCheckScrollButton){return}clearTimeout(oMSL.showScrollButtonTimeout);oMSL.showScrollButtonTimeout=setTimeout(function(){oMSL.iLastActivityDate=Math.round((new Date).getTime()/1e3);oMSL.checkScrollButton()},200)};BitrixMSL.prototype.checkScrollButton=function(){oMSL.windowSize=BX.GetWindowSize();var e=oMSL.windowSize.scrollHeight-oMSL.windowSize.innerHeight-100;oMSL.showScrollButtonBottom=!(oMSL.windowSize.scrollHeight-oMSL.windowSize.innerHeight<=0||document.body.scrollTop>=e&&(document.body.scrollTop>0||e>0));oMSL.showScrollButtonTop=document.body.scrollTop>200;oMSL.showHideScrollButton()};BitrixMSL.prototype.showHideScrollButton=function(){var e=BX("post-scroll-button-bottom");if(e){if(oMSL.showScrollButtonBottom){if(!e.classList.contains("post-comment-block-scroll-bottom-active")){e.classList.add("post-comment-block-scroll-bottom-active")}}else{if(e.classList.contains("post-comment-block-scroll-bottom-active")){e.classList.remove("post-comment-block-scroll-bottom-active")}}}var t=BX("post-scroll-button-top");if(t){if(oMSL.showScrollButtonTop){if(!t.classList.contains("post-comment-block-scroll-top-active")){t.classList.add("post-comment-block-scroll-top-active")}}else{if(t.classList.contains("post-comment-block-scroll-top-active")){t.classList.remove("post-comment-block-scroll-top-active")}}}};BitrixMSL.prototype.scrollTo=function(e){if(e!="top"){e="bottom"}oMSL.canCheckScrollButton=false;oMSL.showScrollButtonBottom=false;oMSL.showScrollButtonTop=false;oMSL.showHideScrollButton();var t=null;if(e=="bottom"){t=oMSL.windowSize.scrollHeight}else{t=0}BitrixAnimation.animate({duration:500,start:{scroll:document.body.scrollTop},finish:{scroll:t},transition:BitrixAnimation.makeEaseOut(BitrixAnimation.transitions.quart),step:function(e){document.body.scrollTop=e.scroll},complete:function(){oMSL.canCheckScrollButton=true;oMSL.checkScrollButton()}})};BitrixMSL.prototype.getComments=function(e){var t=e.ts;var o=!!e.bPullDown;var n=typeof e.obFocus.form=="undefined"||e.obFocus.form=="NO"?"NO":"YES";var i=typeof e.obFocus.comments=="undefined"||e.obFocus.comments=="NO"?"NO":"YES";var a=this.logId;if(!o){if(typeof e.bPullDownTop=="undefined"||e.bPullDownTop){BXMobileApp.UI.Page.Refresh.start()}BX.cleanNode(BX("post-comments-wrap"));BX("post-comments-wrap").appendChild(BX.create("SPAN",{props:{id:"post-comment-last-after"}}))}oMSL.showEmptyCommentsBlockWaiter(BX("post-comments-wrap"),true);var s=new MobileAjaxWrapper;oMSL.emptyCommentsXhr=s.Wrap({type:"json",method:"GET",url:BX.message("MSLPathToLogEntry").replace("#log_id#",a)+"&empty_get_comments=Y"+(typeof t!="undefined"&&t!=null?"&LAST_LOG_TS="+t:""),data:"",processData:true,callback:function(s){var r=BX("post-comments-form-wrap");var l=BX("post-comments-wrap");if(o){app.pullDownLoadingStop()}else if(typeof e.bPullDownTop=="undefined"||e.bPullDownTop){BXMobileApp.UI.Page.Refresh.stop()}oMSL.showEmptyCommentsBlockWaiter(l,false);if(BX.type.isNotEmptyString(s.POST_PERM)){oMSL.menuData.post_perm=s.POST_PERM;oMSL.detailPageMenuItems=oMSL.buildDetailPageMenu(oMSL.menuData);oMSL.showPageMenu("detail")}if(BX.type.isNotEmptyString(s.TEXT)){if(o){BX.cleanNode(l);if(typeof s.POST_NUM_COMMENTS!="undefined"){if(BX("informer_comments_common")){BX("informer_comments_common").style.display="inline";BX("informer_comments_common").innerHTML=parseInt(s.POST_NUM_COMMENTS);if(BX("informer_comments_all")){BX("informer_comments_all").style.display="none"}if(BX("informer_comments_new")){BX("informer_comments_new").style.display="none"}}BXMobileApp.onCustomEvent("onLogEntryCommentsNumRefresh",{log_id:a,num:parseInt(s.POST_NUM_COMMENTS)},true)}}BX.clearNodeCache();__MSLRepositLog(a,{POST_NUM_COMMENTS:s.POST_NUM_COMMENTS});var d=BX.processHTML(s.TEXT,true);l.innerHTML=d.HTML;l.appendChild(BX.create("SPAN",{props:{id:"post-comment-last-after"}}));var m=0,p=function(){m++;if(m<100){if(BX("post-comments-wrap").childNodes.length>0){BX.ajax.processScripts(d.SCRIPT)}else{BX.defer(p,this)()}}};BX.defer(p,this)();BX.onCustomEvent(window,"BX.UserContentView.onInitCall",[{mobile:true,ajaxUrl:BX.message("MSLSiteDir")+"mobile/ajax.php",commentsContainerId:"post-comments-wrap",commentsClassName:"post-comment-wrap"}]);BX.onCustomEvent(window,"BX.UserContentView.onClearCall",[]);if(!o){if(r){r.innerHTML=""}__MSLDetailPullDownInit(true);if(n=="YES"){oMSL.setFocusOnComments("form")}else if(i=="YES"){oMSL.setFocusOnComments("list")}}oMSL.iLastActivityDate=Math.round((new Date).getTime()/1e3);oMSL.checkScrollButton()}else{if(!o){oMSL.showEmptyCommentsBlockWaiter(l,false)}oMSL.showEmptyCommentsBlockFailed(l,t,o,n,s)}},callback_failure:function(){var e=BX("post-comments-wrap");if(o){app.pullDownLoadingStop();bReload=false}else{BXMobileApp.UI.Page.Refresh.stop()}oMSL.showEmptyCommentsBlockWaiter(e,false);oMSL.showEmptyCommentsBlockFailed(e,t,o,n)}})};BitrixMSL.prototype.refreshPostDetail=function(){var e=new MobileAjaxWrapper;var t=e.runAction("socialnetwork.api.livefeed.mobileGetDetail",{data:{logId:this.getLogId()}},{success:function(e){if(BX.type.isPlainObject(e.data)&&BX.type.isNotEmptyString(e.data.html)&&BX("post_block_check_cont")){BX.html(BX("post_block_check_cont"),e.data.html);this.registerEmptyBlockToCheck();setTimeout(function(){this.checkNodesHeight();BitrixMobile.LazyLoad.showImages()}.bind(this),500)}}.bind(this),failure:function(e){}})};BitrixMSL.prototype.formatTaskDescription=function(e,t,o,n){var i=e;n=BX.type.isNotEmptyString(n)?"_"+n:"";if(!!t&&!!o&&t.length>0){i+="<br><br>"+BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_"+o+n).replace("#A_BEGIN#","[URL="+t+"]").replace("#A_END#","[/URL]")}return i};BitrixMSL.prototype.createTask=function(e){app.showPopupLoader();BX.ajax({url:BX.message("MobileSiteDir")?BX.message("MobileSiteDir")+"mobile/":"/mobile/",method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),ENTITY_TYPE:e.entityType,ENTITY_ID:e.entityId,action:"get_raw_data",mobile_action:"get_raw_data",params:{getSonetGroupAvailableList:true,getLivefeedUrl:true,checkParams:{feature:"tasks",operation:"create_tasks"}}},onsuccess:BX.proxy(function(t){if(typeof t.TITLE!="undefined"&&typeof t.DESCRIPTION!="undefined"&&typeof t.DISK_OBJECTS!="undefined"&&(BX.type.isNotEmptyString(t.TITLE)||BX.type.isNotEmptyString(t.DESCRIPTION))&&BX.type.isNotEmptyString(t.LIVEFEED_URL)){var o=oMSL.formatTaskDescription(t.DESCRIPTION,t.LIVEFEED_URL,e.entityType,BX.type.isNotEmptyString(t.SUFFIX)?t.SUFFIX:"");var n={TITLE:t.TITLE,DESCRIPTION:o,RESPONSIBLE_ID:BX.message("USER_ID"),CREATED_BY:BX.message("USER_ID"),UF_TASK_WEBDAV_FILES:t.DISK_OBJECTS};var i=[];if(typeof t.GROUPS_AVAILABLE!="undefined"){for(var a in t.GROUPS_AVAILABLE){if(t.GROUPS_AVAILABLE.hasOwnProperty(a)){i.push(t.GROUPS_AVAILABLE[a])}}}if(i.length==1){n.GROUP_ID=parseInt(i[0])}new BX.Tasks.Util.Query({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir")+"mobile/":"/mobile/")+"?mobile_action=task_ajax"}).add("task.add",{data:n},{},{onExecuted:BX.proxy(function(t,o){app.hidePopupLoader();if(typeof o!="undefined"&&typeof o.RESULT!="undefined"&&typeof o.RESULT.DATA!="undefined"&&typeof o.RESULT.DATA.ID!="undefined"&&parseInt(o.RESULT.DATA.ID)>0){oMSL.createTaskSetContentSuccess(o.RESULT.DATA.ID);BX.ajax({url:BX.message("MobileSiteDir")?BX.message("MobileSiteDir")+"mobile/":"/mobile/",method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),POST_ENTITY_TYPE:BX.type.isNotEmptyString(e.postEntityType)?e.postEntityType:e.entityType,ENTITY_TYPE:e.entityType,ENTITY_ID:e.entityId,TASK_ID:o.RESULT.DATA.ID,action:"create_task_comment",mobile_action:"create_task_comment"}})}else{oMSL.createTaskSetContentFailure(t.getMessages())}},this)}).execute()}else{app.hidePopupLoader();oMSL.createTaskSetContentFailure([BX.message("MSLCreateTaskErrorGetData")])}},this),onfailure:function(e){app.hidePopupLoader();oMSL.createTaskSetContentFailure([BX.message("MSLCreateTaskErrorGetData")])}})};BitrixMSL.prototype.createTaskSetContentSuccess=function(e){app.confirm({title:BX.message("MSLCreateTaskSuccessTitle"),text:BX.message("MSLCreateTaskSuccessDescription"),buttons:[BX.message("MSLCreateTaskSuccessButtonCancelTitle"),BX.message("MSLCreateTaskSuccessButtonOkTitle")],callback:function(t){if(t==2){app.loadPageBlank({url:BX.message("MSLCreateTaskTaskPath").replace("#user_id#",BX.message("USER_ID")).replace("#task_id#",e),bx24ModernStyle:true})}}})};BitrixMSL.prototype.createTaskSetContentFailure=function(e){app.alert({title:BX.message("MSLCreateTaskFailureTitle"),text:e.join(". ")})};BitrixMSL.prototype.setPostFormParams=function(e){if(typeof e=="object"){for(var t in e){if((t=="selectedRecipients"||t=="messageText"||t=="messageFiles")&&e.hasOwnProperty(t)){oMSL.newPostFormParams[t]=e[t]}}}};BitrixMSL.prototype.setPostFormExtraData=function(e){if(typeof e=="object"){for(var t in e){if((t=="hiddenRecipients"||t=="logId"||t=="postId"||t=="postAuthorId"||t=="messageUFCode"||t=="commentId"||t=="commentType"||t=="nodeId")&&e.hasOwnProperty(t)){oMSL.newPostFormExtraData[t]=e[t]}}}};BitrixMSL.prototype.setPostFormExtraDataArray=function(e){var t=null;for(var o in e){if(e.hasOwnProperty(o)){t={};t[o]=e[o];this.setPostFormExtraData(t)}}};BitrixMSL.prototype.getPostFormExtraData=function(){return oMSL.newPostFormExtraData};BitrixMSL.prototype.showNewPostForm=function(e){var t=typeof e!="undefined"&&typeof e.entityType!="undefined"?e.entityType:"post";var o=this.getPostFormExtraData();var n={attachButton:this.getPostFormAttachButton(),mentionButton:this.getPostFormMentionButton(),attachFileSettings:this.getPostFormAttachFileSettings(),extraData:o?o:{},smileButton:{},supportLocalFilesInText:t=="post",okButton:{callback:function(e){if(e.text.length>0){var o=oMSL.buildPostFormRequestStub({type:t,extraData:e.extraData,text:oMSL.parseMentions(e.text)});var n=e.extraData.messageUFCode;oMSL.buildPostFormFiles(o,e.attachedFiles,{ufCode:n}).then(function(){if(t=="post"){oMSL.buildPostFormDestinations(o,e.selectedRecipients,typeof e.extraData!="undefined"&&typeof e.extraData.hiddenRecipients!="undefined"?e.extraData.hiddenRecipients:[],{});var i=!(typeof o.post_id!="undefined"&&parseInt(o.post_id)>0);if(!i){BX.onCustomEvent("onMPFSentEditStart",{});oMSL.onMPFSent({ajaxUrl:BX.message("MSLSiteDir")+"mobile/index.php",data:o,LiveFeedID:null},0)}else{BXMobileApp.onCustomEvent("onMPFSent",{data:o,LiveFeedID:window.LiveFeedID},true,i)}}else if(t=="comment"){BXMobileApp.onCustomEvent("onMPFCommentSent",{data:o,detailPageId:e.extraData.commentType+"_"+parseInt(e.extraData.postId),nodeId:e.extraData.nodeId,ufCode:n},true)}})}},name:BX.message("MSLPostFormSend")}};if(typeof oMSL.newPostFormParams.messageText!="undefined"){n.message={text:oMSL.newPostFormParams.messageText}}if(typeof oMSL.newPostFormParams.messageFiles!="undefined"){n.attachedFiles=oMSL.newPostFormParams.messageFiles}if(t=="post"){n.recipients={dataSource:oMSL.getPostFormRecipientsDataSource()};if(typeof oMSL.newPostFormParams.selectedRecipients!="undefined"){n.recipients.selectedRecipients=oMSL.newPostFormParams.selectedRecipients}}return n};BitrixMSL.prototype.findDestinationCallBack=function(e,t,o){return e.id==this.value};BitrixMSL.prototype.addPostFormDestination=function(e,t){if(typeof t=="undefined"||typeof t.type=="undefined"){return}var o=null;if(t.type=="UA"){o=e.a_users.some(this.findDestinationCallBack,{value:0});if(!o){e.a_users.push({id:0,name:BX.message("MSLPostDestUA"),bubble_background_color:"#A7F264",bubble_text_color:"#54901E"})}}else if(t.type=="U"){o=e.a_users.some(this.findDestinationCallBack,{value:t.id});if(!o){e.a_users.push({id:t.id,name:t.name,bubble_background_color:"#BCEDFC",bubble_text_color:"#1F6AB5"})}}else if(t.type=="SG"){o=e.b_groups.some(this.findDestinationCallBack,{value:t.id});if(!o){e.b_groups.push({id:t.id,name:t.name,bubble_background_color:"#FFD5D5",bubble_text_color:"#B54827"})}}};BitrixMSL.prototype.getPostFormAttachButton=function(){var e=[];if(BX.message("MSLbDiskInstalled")=="Y"||BX.message("MSLbWebDavInstalled")=="Y"){var t={id:"disk",name:BX.message("MSLPostFormDisk"),dataSource:{multiple:"NO",url:BX.message("MSLbDiskInstalled")=="Y"?BX.message("MSLSiteDir")+"mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId="+BX.message("USER_ID"):BX.message("MSLSiteDir")+"mobile/webdav/user/"+BX.message("USER_ID")+"/"}};var o={searchField:"YES",showtitle:"YES",modal:"YES",name:BX.message("MSLPostFormDiskTitle")};if(platform=="ios"){t.dataSource.table_settings=o}else{t.dataSource.TABLE_SETTINGS=o}e.push(t)}e.push({id:"mediateka",name:BX.message("MSLPostFormPhotoGallery")});e.push({id:"camera",name:BX.message("MSLPostFormPhotoCamera")});return{items:e}};BitrixMSL.prototype.getPostFormMentionButton=function(){return{dataSource:{return_full_mode:"YES",outsection:"NO",okname:BX.message("MSLPostFormTableOk"),cancelname:BX.message("MSLPostFormTableCancel"),multiple:"NO",alphabet_index:"YES",url:BX.message("MSLSiteDir")+"mobile/index.php?mobile_action=get_user_list&use_name_format=Y"}}};BitrixMSL.prototype.getPostFormAttachFileSettings=function(){return{resize:[40,1,1,1e3,1e3,0,2,false,true,false,null,0],saveToPhotoAlbum:true}};BitrixMSL.prototype.getPostFormRecipientsDataSource=function(){return{return_full_mode:"YES",outsection:BX.message("MSLIsDenyToAll")!="Y"?"YES":"NO",okname:BX.message("MSLPostFormTableOk"),cancelname:BX.message("MSLPostFormTableCancel"),multiple:"YES",alphabet_index:"YES",showtitle:"YES",user_all:"YES",url:BX.message("MSLSiteDir")+"mobile/index.php?mobile_action="+(BX.message("MSLIsExtranetSite")=="Y"?"get_group_list":"get_usergroup_list")+"&feature=blog"}};BitrixMSL.prototype.buildPostFormFiles=function(e,t,o){var n=new Promise(function(n,i){ufCode=o.ufCode;if(typeof t!="undefined"&&t.length>0){var a=0;var s=t.length;var r=function(){a++;if(a>=s){this.postProgressingFiles(e,t,o);n()}}.bind(this);t.forEach(function(t){var o=typeof t["VALUE"]!="undefined"||typeof t["dataAttributes"]!="undefined"&&typeof t["dataAttributes"]["VALUE"]!="undefined";var n=typeof t["id"]=="undefined"||typeof t["id"]!="number";if(t["url"]&&n&&!o){BX.FileUtils.readFileByPath(t["url"],"readAsDataURL").then(function(o){if(typeof e.attachedFilesRaw=="undefined"){e.attachedFilesRaw=[]}var n=t;n["base64"]=o.substring(o.indexOf(";base64,")+8,o.length);e.attachedFilesRaw.push(n);r()}).catch(function(e){console.log(e);r()})}else{if(o){if(typeof e[ufCode]=="undefined"){e[ufCode]=[]}if(typeof t["VALUE"]!="undefined"){e[ufCode].push(t["VALUE"])}else{e[ufCode].push(t["dataAttributes"]["VALUE"])}}r()}})}else{this.postProgressingFiles(e,t,o);n()}}.bind(this));n.catch(function(e){console.error(e)});return n};BitrixMSL.prototype.postProgressingFiles=function(e,t,o){if(typeof e[ufCode]=="undefined"){e[ufCode]=[]}if(typeof t=="undefined"){t=[]}for(var n in oMSL.newPostFormParams.messageFiles){if(oMSL.newPostFormParams.messageFiles.hasOwnProperty(n)){for(var i in t){if(t.hasOwnProperty(i)&&(oMSL.newPostFormParams.messageFiles[n]["id"]==t[i]["id"]||oMSL.newPostFormParams.messageFiles[n]["id"]==t[i]["ID"])){e[ufCode].push(oMSL.newPostFormParams.messageFiles[n]["id"]);break}}}}if(e[ufCode].length<=0){e[ufCode].push("empty")}};BitrixMSL.prototype.buildPostFormDestinations=function(e,t,o,n){var i=null,a=null,s=null,r=null;if(typeof t.a_users!="undefined"){for(r in t.a_users){if(t.a_users.hasOwnProperty(r)){i="U";if(typeof e.SPERM[i]=="undefined"){e.SPERM[i]=[]}if(typeof e.SPERM_NAME[i]=="undefined"){e.SPERM_NAME[i]=[]}a=typeof t.a_users[r].ID!="undefined"?t.a_users[r].ID:t.a_users[r].id;s=typeof t.a_users[r].NAME!="undefined"?t.a_users[r].NAME:t.a_users[r].name;e.SPERM[i].push(a==0?"UA":"U"+a);e.SPERM_NAME[i].push(s)}}}if(typeof t.b_groups!="undefined"){for(r in t.b_groups){if(t.b_groups.hasOwnProperty(r)){i="SG";if(typeof e.SPERM[i]=="undefined"){e.SPERM[i]=[]}if(typeof e.SPERM_NAME[i]=="undefined"){e.SPERM_NAME[i]=[]}a=typeof t.b_groups[r].ID!="undefined"?t.b_groups[r].ID:t.b_groups[r].id;s=typeof t.b_groups[r].NAME!="undefined"?t.b_groups[r].NAME:t.b_groups[r].name;e.SPERM[i].push("SG"+a);e.SPERM_NAME[i].push(s)}}}for(r in o){if(o.hasOwnProperty(r)){i=o[r]["TYPE"];if(typeof e.SPERM[i]=="undefined"){e.SPERM[i]=[]}e.SPERM[i].push(o[r]["TYPE"]+o[r]["ID"])}}};BitrixMSL.prototype.buildSelectedDestinations=function(e,t){if(typeof e.SPERM=="undefined"||typeof e.SPERM_NAME=="undefined"){return}var o=key=null;if(typeof e.SPERM.U!="undefined"){for(key in e.SPERM.U){if(e.SPERM.U.hasOwnProperty(key)){if(e.SPERM.U[key]=="UA"){this.addPostFormDestination(t,{type:"UA"})}else{o=e.SPERM.U[key].match(/^U([\d]+)$/);if(o!=null){this.addPostFormDestination(t,{type:"U",id:o[1],name:e.SPERM_NAME.U[key]})}}}}}if(typeof e.SPERM.SG!="undefined"){for(key in e.SPERM.SG){if(e.SPERM.SG.hasOwnProperty(key)){o=e.SPERM.SG[key].match(/^SG([\d]+)$/);if(o!=null){this.addPostFormDestination(t,{type:"SG",id:o[1],name:e.SPERM_NAME.SG[key]})}}}}};BitrixMSL.prototype.buildPostFormRequestStub=function(e){var t=null;if(e.type=="post"){t={ACTION:"ADD_POST",AJAX_CALL:"Y",PUBLISH_STATUS:"P",is_sent:"Y",apply:"Y",sessid:BX.bitrix_sessid(),POST_MESSAGE:e.text,decode:"Y",SPERM:{},SPERM_NAME:{},MOBILE:"Y"};if(typeof e.extraData.postId!="undefined"&&parseInt(e.extraData.postId)>0){t.post_id=parseInt(e.extraData.postId);t.post_user_id=parseInt(e.extraData.postAuthorId);t.ACTION="EDIT_POST";if(typeof e.extraData.logId!="undefined"&&parseInt(e.extraData.logId)>0){t.log_id=parseInt(e.extraData.logId)}}}else if(e.type=="comment"&&typeof e.extraData.commentId!="undefined"&&parseInt(e.extraData.commentId)>0&&typeof e.extraData.commentType!="undefined"&&e.extraData.commentType.length>0){t={action:"EDIT_COMMENT",text:oMSL.parseMentions(e.text),commentId:parseInt(e.extraData.commentId),nodeId:e.extraData.nodeId,sessid:BX.bitrix_sessid()};if(e.extraData.commentType=="blog"){t.comment_post_id=commentVarBlogPostID}else{}}return t};BitrixMSL.prototype.showPostError=function(e){var t=typeof e.errorText!="undefined"&&e.errorText.length>0?e.errorText:false;var o=new BXMobileApp.UI.NotificationBar({message:t?t:BX.message("MOBILE_LOG_NEW_ERROR"),color:"#affb0000",textColor:"#ffffff",useLoader:false,align:"center",autoHideTimeout:3e4,hideOnTap:true,onTap:function(e){app.exec("showPostForm",oMSL.showNewPostForm())},id:parseInt(Math.random()*1e5)});o.show()};BitrixMSL.prototype.clearPostFormDestination=function(e,t){if(typeof t!="undefined"&&parseInt(t)>0){oMSL.addPostFormDestination(e,{type:"SG",id:parseInt(t),name:BX.message("MSLGroupName")})}else if(window.arAvailableGroup!==false){for(key in window.arAvailableGroup){if(window.arAvailableGroup.hasOwnProperty(key)){oMSL.addPostFormDestination(e,{type:"SG",id:parseInt(window.arAvailableGroup[key]["entityId"]),name:window.arAvailableGroup[key]["name"]})}}}else if(BX.message("MSLIsDefaultToAll")=="Y"){oMSL.addPostFormDestination(e,{type:"UA"})}};BitrixMSL.prototype.processAjaxBlock=function(e,t){if(!t||typeof t.type=="undefined"||!BX.util.in_array(t.type,["refresh","next"])){return}var o=false;var n=false;i(a);s(r);function i(t){if(BX.type.isArray(e.CSS)&&e.CSS.length>0){BX.load(e.CSS,t)}else{t()}}function a(){if(t.type=="refresh"){BX("lenta_wrapper_global").innerHTML=e.CONTENT}else{BX("lenta_wrapper").insertBefore(BX.create("DIV",{html:e.CONTENT}),BX("next_post_more"))}o=true;if(n){r()}}function s(t){if(BX.type.isArray(e.JS)&&e.JS.length>0){BX.load(e.JS,t)}else{t()}}function r(){n=true;if(o){BX.ajax.processRequestData(e.CONTENT,{scriptsRunFirst:false,dataType:"HTML",onsuccess:function(){if(typeof t.callback=="function"){t.callback()}}})}}};BitrixMSL.prototype.showNotifier=function(e){e=parseInt(e);cnt_cent=e%100;var t=e%10;var o="";if(cnt_cent>=10&&cnt_cent<15){o=3}else if(t==0){o=3}else if(t==1){o=1}else if(t==2||t==3||t==4){o=2}else{o=3}if(oMSL.refreshNeeded){BX("lenta_notifier_cnt").innerHTML=e?e+"+":"";oMSL.hideRefreshNeededNotifier()}else{BX("lenta_notifier_cnt").innerHTML=e||""}BX("lenta_notifier_cnt_title").innerHTML=BX.message("MSLLogCounter"+o);BX.addClass(BX("lenta_notifier"),"lenta-notifier-shown")};BitrixMSL.prototype.hideNotifier=function(){if(BX.hasClass(BX("lenta_notifier"),"lenta-notifier-shown")){BX.removeClass(BX("lenta_notifier"),"lenta-notifier-shown")}};BitrixMSL.prototype.showRefreshNeededNotifier=function(){BX.removeClass(BX("lenta_notifier"),"lenta-notifier-shown");var e=BX("lenta_notifier_2");if(e){BX.addClass(e,"lenta-notifier-shown")}};BitrixMSL.prototype.hideRefreshNeededNotifier=function(){var e=BX("lenta_notifier_2");if(e){BX.removeClass(e,"lenta-notifier-shown")}};BitrixMSL.prototype.onUpdateSocnetCountersHandler=function(e){oMSL.bCounterReceived=true;oMSL.changeCounter(parseInt(e[strCounterType]))};BitrixMSL.prototype.onUpdateCounterHandler=function(e){if(typeof e[BX.message("SITE_ID")]!="undefined"){oMSL.onImUpdateCounterHandler(e[BX.message("SITE_ID")])}};BitrixMSL.prototype.onImUpdateCounterHandler=function(e){oMSL.bCounterReceived=true;if(typeof e.obZeroDate!="undefined"){var t=e.obZeroDate;delete e.obZeroDate}oMSL.changeCounter(parseInt(e[strCounterType]),typeof t!="undefined"&&t[strCounterType]!="undefined"?parseInt(t[strCounterType]):null)};BitrixMSL.prototype.registerBlocksToCheck=function(){var e=null;var t=null;var o=null;var n=null;if(BX("post-card-wrap")){e=BX("post-card-wrap")}else if(BX("lenta_wrapper")){e=BX("lenta_wrapper")}if(e){t=BX.findChildren(e,{className:"post-wrap"},true);if(t===null||t.length<=0){t=BX.findChildren(e,{className:"lenta-item"},true)}}if(t!=null){for(var i=0;i<t.length;i++){if(BX.type.isNotEmptyString(t[i].id)){n=t[i].id.match(/^lenta_item_([\d]+)$/i);if(n!=null){o=n[1];if(!BX.util.in_array(o,this.blocksToCheckRegisteredList)){this.arBlockToCheck[o]={lenta_item_id:"lenta_item_"+o,text_block_id:"post_block_check_"+o,title_block_id:"post_block_check_title_"+o,files_block_id:"post_block_check_files_"+o,more_button_id:"post_more_limiter_"+o};this.blocksToCheckRegisteredList.push(o)}}}}}};BitrixMSL.prototype.registerEmptyBlockToCheck=function(){oMSL.arBlockToCheck={0:{lenta_item_id:"lenta_item",text_block_id:"post_block_check_cont",title_block_id:"post_block_check_title",more_button_id:"post_more_limiter"}}};BitrixMSL.prototype.onMobilePlayerError=function(e,t){if(!BX.type.isDomNode(e)){return}if(!t){return}var o=e.parentNode;if(o){if(BX.findChildByClassName(o,"disk-mobile-player-error-container")){return}}else{if(BX.findChildByClassName(e,"disk-mobile-player-error-container")){return}}var n=e.getElementsByTagName("source");var i=n.length;for(var a=0;a<n.length;a++){if(n[a].src&&n[a].src==t){BX.remove(n[a]);i--}}if(i>0){return}var s=BX.create("div",{props:{className:"disk-mobile-player-error-container"},children:[BX.create("div",{props:{className:"disk-mobile-player-error-icon"},html:""}),BX.create("div",{props:{className:"disk-mobile-player-error-message"},html:BX.message("MSLMobilePlayerErrorMessage")})]});var r=BX.findChildByClassName(s,"disk-mobile-player-download");if(r){BX.adjust(r,{events:{click:function(){app.openDocument({url:t})}}})}if(o){BX.hide(e);BX.append(s,o)}else{BX.adjust(e,{children:[s]})}};BitrixMSL.prototype.getCopyText=function(e){function t(e){var t=document.createElement("textarea");t.innerHTML=e;return t.value}var o=e.innerHTML.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<br\s*[\/]?>/gi,"~~~---~~~").replace(/~~~---~~~/g,"\n");o=o.replace(/<a\s+href="([^"]+)"[^>]*>([^<]+)<\/a>/gi,function(e,t,o){if(o.match(/^http/gi)){return'<a href="'+t+'">'+t+"</a>"}else{return e}});return t(BX.util.strip_tags(o))};oMSL=new BitrixMSL;window.oMSL=oMSL;function openTaskComponentByTaskId(e,t,o){o=o||{};o.selectedTab=o.selectedTab||"taskTab";BXMobileApp.Events.postToComponent("taskbackground::task::action",[{taskId:t,data:o}],"background");e.preventDefault();e.stopPropagation();return false}
//# sourceMappingURL=script_attached.map.js