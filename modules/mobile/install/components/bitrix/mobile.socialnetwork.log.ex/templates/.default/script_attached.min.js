function __MSLOnFeedPreInit(e){}function __MSLOnFeedInit(e){logID=parseInt(e.logID);bAjaxCall=!!e.bAjaxCall;bReload=!!e.bReload;bEmptyPage=!!e.bEmptyPage;bFiltered=!!e.bFiltered;groupID=parseInt(e.groupID);groupImage=e.groupImage;tmstmp=parseInt(e.tmstmp);strCounterType=e.strCounterType;var t=!BX.type.isUndefined(e.canAddPost)?!!e.canAddPost:true;oMSL.groupID=parseInt(e.groupID);oMSL.ftMinTokenSize=parseInt(e.ftMinTokenSize);oMSL.bShowExpertMode=!!e.bShowExpertMode;oMSL.bExpertMode=!!e.bExpertMode;oMSL.bDetailEmptyPage=bEmptyPage;oMSL.curUrl=e.curUrl;oMSL.appCacheDebug=!!e.appCacheDebug;oMSL.pageType=logID<=0&&!bEmptyPage?"list":"detail";if(logID<=0&&!bEmptyPage&&!bAjaxCall){if(!bReload){BX.addCustomEvent("BX.MobileLF:onSearchBarRefreshStart",(function(e){BX.MobileLivefeed.PageInstance.refresh(true,{find:e.text})}));BX.addCustomEvent("BX.MobileLF:onSearchBarRefreshAbort",(function(){if(!BX.type.isNull(BX.MobileLivefeed.PageInstance.refreshXhr)){BX.MobileLivefeed.PageInstance.refreshXhr.abort()}}));BX.MobileLivefeed.SearchBarInstance.init({ftMinTokenSize:oMSL.ftMinTokenSize})}BX.MobileLivefeed.PageMenuInstance.listPageMenuItems=[];if(groupID>0){BX.ready((function(){if(t){BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"addPost",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_ADD_POST"),image:"/bitrix/templates/mobile_app/images/lenta/menu/pencil.png",action:function(){if(Application.getApiVersion()>=BX.MobileLivefeed.Instance.getApiVersion("layoutPostForm")){BX.MobileLivefeed.PostFormManagerInstance.show({pageId:BX.MobileLivefeed.Instance.getPageId(),groupId:groupID,postId:0})}else{oMSL.initPostForm({groupId:groupID,callback:function(){app.exec("showPostForm",BX.MobileLivefeed.PostFormOldManagerInstance.show({groupId:groupID}))}})}},arrowFlag:false})}if(Application.getApiVersion()<BX.MobileLivefeed.Instance.getApiVersion("tabs")){BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"groupTasks",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_GROUP_TASKS"),image:"/bitrix/templates/mobile_app/images/lenta/menu/n_check.png",icon:"checkbox",arrowFlag:true,action:function(){if(Application.getApiVersion()>=31){BXMobileApp.Events.postToComponent("taskbackground::taskList::open",[{groupId:groupID,groupName:BX.message("MSLLogTitle"),groupImageUrl:groupImage,ownerId:BX.message("USER_ID")}],"background")}else{var e=BX.message("MSLPathToTasksRouter");e=e.replace("__ROUTE_PAGE__","list").replace("#USER_ID#",BX.message("USER_ID"));window.BXMobileApp.PageManager.loadPageUnique({url:e,bx24ModernStyle:true})}}});BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"groupFiles",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_GROUP_FILES"),image:"/bitrix/templates/mobile_app/images/lenta/menu/files.png",action:function(){app.openBXTable({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/?mobile_action=disk_folder_list&type=group&path=/&entityId="+groupID,TABLE_SETTINGS:{type:"files",name:BX.message("MSLLogTitle"),useTagsInSearch:false}})},arrowFlag:true,icon:"file"})}if(BX.message("MSLPathToKnowledgeGroup")){BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"knowledge",name:BX.message("MSLTitleKnowledgeGroup"),image:"/bitrix/templates/mobile_app/images/lenta/menu/knowledge_base.png",action:function(){window.BXMobileApp.PageManager.loadPageUnique({url:BX.message("MSLPathToKnowledgeGroup").replace(/ /g,"%20"),bx24ModernStyle:true,cache:false})}})}BX.MobileLivefeed.PageMenuInstance.init({type:"list"})}));setTimeout((function(){BX.MobileLivefeed.Instance.setPageId("list_group_"+groupID);BX.MobileLivefeed.Instance.setOptions({groupId:groupID})}),0)}else{BX.ready((function(){setTimeout((function(){if(!bFiltered){BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"addPost",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_ADD_POST"),image:"/bitrix/templates/mobile_app/images/lenta/menu/pencil.png",action:function(){if(Application.getApiVersion()>=BX.MobileLivefeed.Instance.getApiVersion("layoutPostForm")){BX.MobileLivefeed.PostFormManagerInstance.show({pageId:BX.MobileLivefeed.Instance.getPageId(),postId:0})}else{oMSL.initPostForm({groupId:groupID,callback:function(){app.exec("showPostForm",BX.MobileLivefeed.PostFormOldManagerInstance.show())}})}},arrowFlag:false});if(BX.message("MOBILE_EXT_LIVEFEED_TASKS_INSTALLED")=="Y"||BX.message("MOBILE_EXT_LIVEFEED_TIMEMAN_INSTALLED")=="Y"){BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"presetWork",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_WORK"),image:"/bitrix/templates/mobile_app/images/lenta/menu/work.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?work=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}})}BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"presetFavorites",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_FAVORITES"),image:"/bitrix/templates/mobile_app/images/lenta/menu/favorite.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?favorites=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}});BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"presetMy",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_MY"),image:"/bitrix/templates/mobile_app/images/lenta/menu/mine.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?my=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}});BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"presetImportant",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_IMPORTANT"),image:"/bitrix/templates/mobile_app/images/lenta/menu/important.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?important=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}});if(BX.message("MOBILE_EXT_LIVEFEED_LISTS_INSTALLED")=="Y"){BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"presetBizproc",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_BIZPROC"),image:"/bitrix/templates/mobile_app/images/lenta/menu/workflow.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?bizproc=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}})}BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"refresh",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_REFRESH"),image:"/bitrix/templates/mobile_app/images/lenta/menu/n_refresh.png",arrowFlag:false,action:function(){oMSL.pullDownAndRefresh()}});BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"followDefault",name:BX.MobileLivefeed.FollowManagerInstance.getFollowDefaultValue()?BX.message("MSLMenuItemFollowDefaultY"):BX.message("MSLMenuItemFollowDefaultN"),image:"/bitrix/templates/mobile_app/images/lenta/menu/glasses.png",arrowFlag:false,feature:"follow",action:function(){BX.MobileLivefeed.FollowManagerInstance.setFollowDefault({value:!BX.MobileLivefeed.FollowManagerInstance.getFollowDefaultValue()})}});if(oMSL.bShowExpertMode){BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"expertMode",name:oMSL.bExpertMode?BX.message("MSLMenuItemExpertModeY"):BX.message("MSLMenuItemExpertModeN"),image:"/bitrix/templates/mobile_app/images/lenta/menu/expert.png",arrowFlag:false,feature:"expert",action:function(){oMSL.setExpertMode({value:!oMSL.bExpertMode})}})}BX.MobileLivefeed.PageMenuInstance.init({type:"list"})}}),1e3);BX.MobileLivefeed.Instance.setPageId("list")}))}setTimeout((function(){BX.MobileLivefeed.Instance.setOptions({signedParameters:BX.type.isNotEmptyString(e.signedParameters)?e.signedParameters:{},pathToEmptyPage:BX.type.isNotEmptyString(e.pathToEmptyPage)?e.pathToEmptyPage:"",pathToCalendarEvent:"/mobile/calendar/view_event.php?event_id=#EVENT_ID#",pathToTasksRouter:BX.type.isNotEmptyString(e.pathToTasksRouter)?e.pathToTasksRouter:"",destinationToAllDeny:BX.type.isBoolean(e.destinationToAllDeny)&&e.destinationToAllDeny,destinationToAllDefault:!BX.type.isBoolean(e.destinationToAllDefault)||e.destinationToAllDefault,backgroundImagesData:BX.type.isNotEmptyObject(e.backgroundImagesData)?e.backgroundImagesData:{},backgroundCommon:BX.type.isNotEmptyObject(e.backgroundCommon)?e.backgroundCommon:{},medalsList:BX.type.isNotEmptyObject(e.medalsList)?e.medalsList:{},importantData:BX.type.isNotEmptyObject(e.importantData)?e.importantData:{},postFormData:BX.type.isNotEmptyObject(e.postFormData)?e.postFormData:{}});BX.MobileLivefeed.FollowManagerInstance.setFollowDefaultValue(BX.type.isBoolean(e.bFollowDefault)?e.bFollowDefault:true)}),0);if(!bReload){setTimeout((function(){BX.MobileLivefeed.PublicationQueueInstance.emit("onFeedReady")}),0);oMSL.registerBlocksToCheck();if(typeof window.bFeedInitialized!="undefined"&&window.bFeedInitialized){BX.ready((function(){BX.MobileLivefeed.Instance.recalcMaxScroll();setTimeout((function(){oMSL.checkNodesHeight();BX.onCustomEvent(window,"BX.UserContentView.onRegisterViewAreaListCall",[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}])}),1e3)}));return}else{BX.ready((function(){BX.onCustomEvent(window,"BX.UserContentView.onInitCall",[{mobile:true,ajaxUrl:BX.message("MSLSiteDir")+"mobile/ajax.php",commentsContainerId:"post-comments-wrap",commentsClassName:"post-comment-wrap"}])}));window.bFeedInitialized=true}window.arLikeRandomID={};window.LiveFeedID=parseInt(Math.random()*1e5);if(groupID<=0){BX.ready((function(){setTimeout((function(){if(!bFiltered){}else{BXMobileApp.UI.Page.TopBar.title.setText(BX.message("MSLLogTitle"));BXMobileApp.UI.Page.TopBar.title.setCallback("");BXMobileApp.UI.Page.TopBar.title.show()}}),1e3)}))}oMSL.initPostForm({groupId:groupID});BXMobileApp.addCustomEvent("onBlogPostDelete",(function(e){oMSL.pullDownAndRefresh()}));BX.ready((function(){if(bFiltered&&window.platform=="android"){BX.addCustomEvent("onOpenPageBefore",(function(){oMSL.pullDownAndRefresh()}))}}));BXMobileApp.addCustomEvent("onLogEntryRead",(function(e){__MSLLogEntryRead(e.log_id,e.ts,e.bPull===true||e.bPull==="YES")}));BXMobileApp.addCustomEvent("onCommentsGet",(function(e){if(typeof window.arLogTs["entry_"+e.log_id]!="undefined"&&window.arLogTs["entry_"+e.log_id]!=null){arLogTs["entry_"+e.log_id]=e.ts}}));BXMobileApp.addCustomEvent("onLogEntryCommentAdd",(function(e){BX.MobileLivefeed.CommentsInstance.onLogEntryCommentAdd(e.log_id)}));BXMobileApp.addCustomEvent("onLogEntryRatingLike",(function(e){oMSL.onLogEntryRatingLike({ratingId:e.rating_id,voteAction:e.voteAction,logId:e.logId})}));BXMobileApp.addCustomEvent("onLogEntryImpPostRead",(function(e){BX.MobileLivefeed.ImportantManagerInstance.renderRead({node:BX("important_post_"+e.postId),value:true})}));BXMobileApp.addCustomEvent("onLogEntryFollow",(function(e){BX.MobileLivefeed.FollowManagerInstance.setFollow({logId:e.logId,pageId:e.pageId,bOnlyOn:typeof e.bOnlyOn!="undefined"&&e.bOnlyOn=="Y",bRunEvent:false})}));BXMobileApp.addCustomEvent("onLogEntryFavorites",(function(e){oMSL.onLogEntryFavorites(e.log_id,e.page_id)}));BXMobileApp.addCustomEvent("onLogEntryCommentsNumRefresh",(function(e){BX.MobileLivefeed.CommentsInstance.onLogEntryCommentAdd(e.log_id,e.num)}));BXMobileApp.addCustomEvent("onLogEntryPostUpdated",(function(e){oMSL.onLogEntryPostUpdated(e)}));BX.MobileUI.addLivefeedLongTapHandler(BX("lenta_wrapper_global"),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}BX.MobileLivefeed.RatingInstance.emit("onFeedInit")}else if(bEmptyPage){window.isDetailPullDownEnabled=false;oMSL.registerEmptyBlockToCheck();BX.ready((function(){__MSLDrawDetailPage();BX.addCustomEvent("onOpenPageBefore",(function(){__MSLDrawDetailPage()}));BXMobileApp.addCustomEvent("onEditedPostFailed",(function(){app.hidePopupLoader()}));BX.MobileImageViewer.viewImageBind("post_item_top_wrap","img[data-bx-image]")}))}else if(logID>0){window.isDetailPullDownEnabled=false;window.arCanUserComment={};BXMobileApp.onCustomEvent("onLogEntryRead",{log_id:logID,ts:tmstmp,bPull:false},true);BX.ready((function(){BX.MobileLivefeed.Instance.setPageId("detail_"+logID);BX.MobileLivefeed.Instance.setOptions({logId:logID});oMSL.registerBlocksToCheck();setTimeout((function(){oMSL.checkNodesHeight()}),100)}))}if(bEmptyPage||logID>0){if(logID>0&&BX("post_item_top_wrap_"+logID)){BX.MobileUI.addLivefeedLongTapHandler(BX("post_item_top_wrap_"+logID),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}else if(BX("post_item_top_wrap")){BX.MobileUI.addLivefeedLongTapHandler(BX("post_item_top_wrap"),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}if(BX("post-comments-wrap")){BX.MobileUI.addLivefeedLongTapHandler(BX("post-comments-wrap"),{likeNodeClass:"post-comment-control-item-like",copyItemClass:"post-comment-block",copyTextClass:"post-comment-text"})}BX.ready((function(){BX.MobileLivefeed.Instance.setOptions({destinationToAllDeny:BX.type.isBoolean(e.destinationToAllDeny)&&e.destinationToAllDeny,destinationToAllDefault:!BX.type.isBoolean(e.destinationToAllDefault)||e.destinationToAllDefault,backgroundImagesData:BX.type.isNotEmptyObject(e.backgroundImagesData)?e.backgroundImagesData:{},backgroundCommon:BX.type.isNotEmptyObject(e.backgroundCommon)?e.backgroundCommon:{},medalsList:BX.type.isNotEmptyObject(e.medalsList)?e.medalsList:{},importantData:BX.type.isNotEmptyObject(e.importantData)?e.importantData:{},postFormData:BX.type.isNotEmptyObject(e.postFormData)?e.postFormData:{}})}))}if(!bAjaxCall&&!bReload){BX.ready((function(){BXMobileApp.addCustomEvent("onEditedPostInserted",(function(e){app.hidePopupLoader();oMSL.drawDetailPageText(e);BXMobileApp.onCustomEvent("onLogEntryPostUpdated",e,true)}))}))}if(!bAjaxCall){BX.ready((function(){if(logID<=0&&!bEmptyPage){setTimeout((function(){BX.MobileLivefeed.Instance.recalcMaxScroll();BX.MobileLivefeed.PageInstance.initScroll(true)}),0);if(!bReload){BX.addCustomEvent("UIApplicationDidBecomeActiveNotification",(function(){var e=navigator.network.connection.type;if(e==Connection.UNKNOWN||e==Connection.NONE){app.exec("pullDownLoadingStop");BX.MobileLivefeed.PageInstance.initScroll(false,true)}else{__MSLPullDownInit(true,false);BX.MobileLivefeed.PageInstance.initScroll(true,true)}}))}if(!bFiltered&&!bReload){BXMobileApp.addCustomEvent("onUpdateSocnetCounters",oMSL.onUpdateSocnetCountersHandler);BXMobileApp.addCustomEvent("onImUpdateCounter",oMSL.onImUpdateCounterHandler);BXMobileApp.addCustomEvent("onUpdateUserCounters",oMSL.onUpdateCounterHandler);BX.MobileTools.requestUserCounters()}}if(bEmptyPage||logID>0){BX.MobileLivefeed.PageScrollInstance.init();setTimeout((function(){BX.MobileLivefeed.Instance.setOptions({importantData:BX.type.isNotEmptyObject(e.importantData)?e.importantData:{}})}),0);BX.addCustomEvent("UIApplicationDidBecomeActiveNotification",(function(e){var t=navigator.network.connection.type;if(t==Connection.UNKNOWN||t==Connection.NONE){app.exec("pullDownLoadingStop")}else{var o=BX.MobileLivefeed.Instance.getLastActivityDate();if(o>0){var i=Math.round((new Date).getTime()/1e3);if(i-o>1740){if(bEmptyPage){BXMobileApp.UI.Page.isVisible({callback:function(e){if(e.status=="visible"){app.getPageParams({callback:function(e){if(parseInt(e.log_id)>0){BX.MobileLivefeed.Instance.setLogId(e.log_id)}BX.MobileLivefeed.CommentsInstance.getList({ts:oMSL.iDetailTs,bPullDown:false,obFocus:{form:"NO",comments:"NO"}})}})}else{oMSL.emptyRefreshCommentsFlag=true}}})}else{document.location.reload(true)}}}}}));__MSLDetailPullDownInit(true)}else{setTimeout((function(){oMSL.checkNodesHeight();BX.onCustomEvent(window,"BX.UserContentView.onRegisterViewAreaListCall",[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}])}),1e3);if(logID<=0){__MSLPullDownInit(true)}}}))}BXMobileApp.addCustomEvent("onHidePageBefore",(function(){var e=document.getElementsByTagName("video"),t=null;for(t=0;t<e.length;t++){if(!e[t].paused){e[t].pause()}}var o=document.querySelectorAll("iframe.bx-mobile-video-frame");for(t=0;t<o.length;t++){var i=o[t].getAttribute("src");if(i){o[t].src=o[t].src}}}))}function __MSLOpenLogEntryNew(e,t){var o=typeof e.show_full!="undefined"?!!e.show_full:false;if(typeof e.path=="undefined"||e.path==null||e.path.length<=0){return false}else{var i=e.path}if(typeof e.log_id=="undefined"||e.log_id==null||parseInt(e.log_id)<=0){return false}e.follow=BX("log_entry_follow_"+e.log_id)?BX("log_entry_follow_"+e.log_id).getAttribute("data-follow"):"Y";e.fav=BX("log_entry_favorites_"+e.log_id)&&BX("log_entry_favorites_"+e.log_id).classList.contains("lenta-item-fav-active")?"Y":"N";e.feed_id=typeof window.LiveFeedID!="undefined"?window.LiveFeedID:"";e.can_user_comment=typeof arCanUserComment!="undefined"&&typeof arCanUserComment[e.log_id]!="undefined"&&arCanUserComment[e.log_id];if(typeof t!="undefined"&&t!=null&&t&&typeof t.target!="undefined"&&t.target!=null){if(typeof t.target.tagName!="undefined"&&t.target.tagName.toLowerCase()=="a"&&!BX.hasClass(t.target,"post-item-more")){return false}var n=BX.findParent(t.target,{tag:"A"},{tag:"div",className:"post-item-post-block"});if(n){return false}}e.RandomID=typeof arLikeRandomID["entry_"+e.log_id]!="undefined"&&arLikeRandomID["entry_"+e.log_id]!=null?arLikeRandomID["entry_"+e.log_id]:false;var a=document.getElementById("post_block_check_cont_"+e.log_id);if(BX.type.isDomNode(a)){var s=null;var l=null;e.detailText=a.innerHTML;e.hasTitle=a.getAttribute("bx-data-has-title")==="Y";e.bIsPhoto=a.classList.contains("post-item-post-img-block");e.bIsImportant=a.classList.contains("info-block-important");e.medal=false;if(a.classList.contains("info-block-gratitude")){s=null;for(l=0;l<a.classList.length;l++){s=a.classList[l].match(/info-block-gratitude-(.+)/i);if(s){e.medal=s[1];break}}}e.backgroundCode=false;if(a.classList.contains("ui-livefeed-background")){s=null;for(l=0;l<a.classList.length;l++){s=a.classList[l].match(/ui-livefeed-background-(.+)/i);if(s){e.backgroundCode=s[1];break}}}}var r=document.getElementById("lenta_item_"+e.log_id);if(r){var d=r.parentNode.querySelector("span[data-type='inline-script']");if(d){e.inlineScript=d.innerHTML}}if(BX("post_block_files_"+e.log_id)){e.filesBlockText=BX("post_block_files_"+e.log_id).innerHTML}if(BX("post_more_limiter_"+e.log_id)){e.showMoreButton=BX("post_more_limiter_"+e.log_id).style.visibility!="hidden"}if(BX("post_item_top_"+e.log_id)){e.topText=BX("post_item_top_"+e.log_id).innerHTML}if(BX("informer_comments_all_"+e.log_id)){e.commentsNumAll=BX("informer_comments_all_"+e.log_id).innerHTML;if(BX("informer_comments_new_"+e.log_id)){e.commentsNumNew=BX.findChild(BX("informer_comments_new_"+e.log_id),{className:"post-item-inform-right-new-value"},true,false).innerHTML}}else if(BX("informer_comments_"+e.log_id)){e.commentsNum=BX("informer_comments_"+e.log_id).innerHTML}if(BX("comments_control_"+e.log_id)){e.commentsControl=!!BX("comments_control_"+e.log_id)}if(BX("rating_block_"+e.log_id)){e.ratingText=BX("rating_block_"+e.log_id).innerHTML;e.ratingCounter=parseInt(BX("rating_block_"+e.log_id).getAttribute("data-counter"))}if(BX("rating-footer-wrap_"+e.log_id)){e.ratingFooter=BX("rating-footer-wrap_"+e.log_id).innerHTML}e.bShowFull=o;if(typeof window.arLogTs["entry_"+e.log_id]!="undefined"&&window.arLogTs["entry_"+e.log_id]!=null){e.TS=arLogTs["entry_"+e.log_id]}e.bSetFocusOnCommentForm=typeof e.focus_form!="undefined"?!!e.focus_form:false;e.bSetFocusOnCommentsList=typeof e.focus_comments!="undefined"?!!e.focus_comments:false;app.loadPageBlank({url:i,bx24ModernStyle:true,data:e});return typeof t!="undefined"&&t!=null&&t?t.preventDefault():false}function __MSLDrawDetailPage(){app.getPageParams({callback:function(e){if(parseInt(e.log_id)>0){BX.MobileLivefeed.Instance.setLogId(e.log_id)}BXMobileApp.onCustomEvent("onLogEntryRead",{log_id:e.log_id,ts:BX.message("MSLCurrentTime"),bPull:false},true);oMSL.drawDetailPage(e)}})}function __MSLLogEntryRead(e,t,o){o=!!o;if(typeof window.arLogTs["entry_"+e]!="undefined"&&window.arLogTs["entry_"+e]!=null){arLogTs["entry_"+e]=t;if(BX("informer_comments_"+e)&&BX("informer_comments_new_"+e)&&!o){var i=BX("informer_comments_all_"+e).innerHTML.length>0?parseInt(BX("informer_comments_all_"+e).innerHTML):0;var n=i+parseInt(BX.findChild(BX("informer_comments_new_"+e),{className:"post-item-inform-right-new-value"},true,false).innerHTML);BX.remove(BX("informer_comments_new_"+e));BX.remove(BX("informer_comments_all_"+e));BX("informer_comments_"+e).innerHTML=n;var a=BX("informer_comments_"+e).closest(".post-item-informers");if(a){a.classList.remove("post-item-inform-likes-active")}BX.MobileLivefeed.PinnedPanelInstance.adjustCollapsedPostsPanel()}}if(BX("lenta_item_"+e)){BX.removeClass(BX("lenta_item_"+e),"lenta-item-new")}}function __MSLGetHiddenDestinations(e,t,o){var i={sessid:BX.message("MSLSessid"),site:BX.message("SITE_ID"),lang:BX.message("LANGUAGE_ID"),dlim:BX.message("MSLDestinationLimit"),log_id:parseInt(e),nt:BX.message("MSLNameTemplate"),sl:BX.message("MSLShowLogin"),p_user:BX.message("MSLPathToUser"),p_group:BX.message("MSLPathToGroup"),p_crmlead:BX.message("MSLPathToCrmLead"),p_crmdeal:BX.message("MSLPathToCrmDeal"),p_crmcontact:BX.message("MSLPathToCrmContact"),p_crmcompany:BX.message("MSLPathToCrmCompany"),action:"get_more_destination",mobile_action:"get_more_destination",author_id:parseInt(t)};BX.Mobile.Ajax.wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",data:i,callback:function(e){if(typeof e["arDestinations"]!="undefined"){var t=e["arDestinations"];if(typeof t=="object"){if(BX(o)){var i=o.parentNode;i.removeChild(o);for(var n=0;n<t.length;n++){if(typeof t[n]["TITLE"]!="undefined"&&t[n]["TITLE"].length>0){i.appendChild(BX.create("SPAN",{html:",&nbsp;"}));if(typeof t[n]["CRM_PREFIX"]!="undefined"&&t[n]["CRM_PREFIX"].length>0){i.appendChild(BX.create("SPAN",{props:{className:"post-item-dest-crm-prefix"},html:t[n]["CRM_PREFIX"]+":&nbsp;"}))}if(typeof t[n]["URL"]!="undefined"&&t[n]["URL"].length>0){i.appendChild(BX.create("A",{props:{className:"post-item-destination"+(typeof t[n]["STYLE"]!="undefined"&&t[n]["STYLE"].length>0?" post-item-dest-"+t[n]["STYLE"]:""),href:t[n]["URL"]},html:t[n]["TITLE"]}))}else{i.appendChild(BX.create("SPAN",{props:{className:"post-item-destination"+(typeof t[n]["STYLE"]!="undefined"&&t[n]["STYLE"].length>0?" post-item-dest-"+t[n]["STYLE"]:"")},html:t[n]["TITLE"]}))}}}if(typeof e["iDestinationsHidden"]!="undefined"&&parseInt(e["iDestinationsHidden"])>0){e["iDestinationsHidden"]=parseInt(e["iDestinationsHidden"]);var a=e["iDestinationsHidden"]%100>10&&e["iDestinationsHidden"]%100<20?5:e["iDestinationsHidden"]%10;i.appendChild(BX.create("SPAN",{html:"&nbsp;"+BX.message("MSLDestinationHidden"+a).replace("#COUNT#",e["iDestinationsHidden"])}))}oMSL.checkNodesHeight()}}}},callback_failure:function(){}})}function __MSLPullDownInit(e,t){if(typeof t=="undefined"){t=true}e=!!e;if(e){if(!BX.MobileLivefeed.Instance.isPullDownEnabled&&t){BXMobileApp.UI.Page.Refresh.setParams({pulltext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL"),backgroundColor:"#E7E9EB",downtext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL_RELEASE"),loadtext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL_LOADING"),callback:function(){if(!window.isPullDownLocked){BX.MobileLivefeed.PageInstance.refresh(true);BX.onCustomEvent("BX.MobileLivefeed.SearchBar::setHideByRefresh");app.exec("hideSearchBar");setTimeout((function(){BX.onCustomEvent("BX.MobileLivefeed.SearchBar::unsetHideByRefresh")}),1e3)}}});BXMobileApp.UI.Page.Refresh.setEnabled(true)}BX.MobileLivefeed.Instance.isPullDownEnabled=true}else{BXMobileApp.UI.Page.Refresh.setEnabled(false);BX.MobileLivefeed.Instance.isPullDownEnabled=false}}function __MSLDetailPullDownInit(e){e=!!e;if(e){if(!isDetailPullDownEnabled){var t=function(){var e=true;if(e){var t=null;var o=null;if(BX("post_log_id")){t=parseInt(BX("post_log_id").getAttribute("data-log-id"));o=parseInt(BX("post_log_id").getAttribute("data-ts"))}else if(BX("lenta_wrapper")){var i=BX.findChild(BX("lenta_wrapper"),{className:"post-wrap"},true,false);if(i&&i.id.length>0){var n=i.id.match(/^lenta_item_([\d]+)$/i);if(n!=null){document.location.replace(document.location.href);isDetailPullDownEnabled=true;return}}}if(BX("post-comments-wrap")&&typeof t!=="undefined"&&t!=null){BX.MobileLivefeed.CommentsInstance.getList({ts:o,bPullDown:true,obFocus:{form:false}});oMSL.refreshPostDetail()}}};BXMobileApp.UI.Page.Refresh.setParams({pulltext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL"),backgroundColor:"#E7E9EB",downtext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL_RELEASE"),loadtext:BX.message("MOBILE_EXT_LIVEFEED_DETAIL_NEW_PULL_LOADING"),callback:t});BXMobileApp.UI.Page.Refresh.setEnabled(true)}isDetailPullDownEnabled=true}else{BXMobileApp.UI.Page.Refresh.setEnabled(false);isDetailPullDownEnabled=false}}function __MSLSetFavorites(e,t,o){var i=BX.MobileLivefeed.Instance.getPostFromLogId(e);if(!i){return}return i.setFavorites({node:t,event:o})}function showHiddenDestination(e,t){BX.hide(t);BX("blog-destination-hidden-"+e).style.display="inline"}BitrixMSL=function(){this.scriptsAttached=[];this.counterTimeout=null;this.commentsType=false;this.entityXMLId="";this.commentTextCurrent="";this.arMention={};this.bShowExpertMode=true;this.bExpertMode=false;this.bKeyboardCaptureEnabled=false;this.keyboardShown=null;this.arBlockToCheck={};this.iDetailTs=0;this.arRatingLikeProcess={};this.bDetailEmptyPage=null;this.bCounterReceived=false;this.counterValue=0;this.blocksToCheckRegisteredList=[];this.menuData={};this.emptyRefreshCommentsFlag=false;this.detailPageFocus=null;this.classes={postItemBlockFull:"post-item-post-block-full"};this.xhr={refresh:null}};BitrixMSL.prototype.loadScripts=function(){for(var e=0;e<this.scriptsAttached.length;e++){BX.loadScript(this.scriptsAttached[e]+"?"+parseInt(Math.random()*1e5))}};BitrixMSL.prototype.pullDownAndRefresh=function(e){app.exec("pullDownLoadingStart");window.isPullDownLocked=true;BX.MobileLivefeed.PageInstance.refresh(true,e)};BitrixMSL.prototype.shareBlogPost=function(e){};BitrixMSL.prototype.drawDetailPage=function(e){var t=false;BX.MobileLivefeed.Instance.setPageId("detail_"+e.log_id);BX.MobileLivefeed.Instance.setOptions({logId:e.log_id});if(BX("post_log_id")){var o=parseInt(BX("post_log_id").getAttribute("data-log-id"))}if(typeof o==="undefined"||o!=e.log_id){app.clearInput()}if(BX("post_log_id")){if(typeof o!=="undefined"&&o==e.log_id){t=true}else{BX("post_log_id").setAttribute("data-log-id",e.log_id);BX("post_log_id").setAttribute("data-ts",e.TS);BX.message({MSLLogId:e.log_id})}}var i=false;window.entryType=e.entry_type;oMSL.InitDetail({commentsType:e.entry_type=="blog"?"blog":"log",detailPageId:(e.entry_type=="blog"?"blog":"log")+"_"+(e.entry_type=="blog"?e.post_id:e.log_id),logId:e.log_id,entityXMLId:e.entity_xml_id,bFollow:typeof e.follow=="undefined"||e.follow!="N",feed_id:typeof e.feed_id!="undefined"?e.feed_id:null,entryParams:{destinations:typeof e.destinations!="undefined"?e.destinations:null,post_perm:typeof e.post_perm!="undefined"?e.post_perm:null,post_id:typeof e.post_id!="undefined"?e.post_id:null,post_content_type_id:BX.type.isNotEmptyString(e.post_content_type_id)?e.post_content_type_id:null,post_content_id:!BX.type.isUndefined(e.post_content_id)?e.post_content_id:null},TS:typeof e.TS!="undefined"?e.TS:null,readOnly:e.read_only!="undefined"?e.read_only:"N"});BX.MobileLivefeed.CommentsInstance.abortXhr();if(typeof e.commentsNumAll!="undefined"||typeof e.commentsNum!="undefined"){i=true}if(BX("comments_control")){BX("comments_control").style.display=typeof e.commentsControl!="undefined"&&e.commentsControl=="YES"?"inline-block":"none";BX("comments_control").removeEventListener("click",BX.MobileLivefeed.CommentsInstance.setFocusOnCommentForm);if(e.can_user_comment!=="NO"){BX("comments_control").addEventListener("click",BX.MobileLivefeed.CommentsInstance.setFocusOnCommentForm)}}if(!t){var n=document.getElementById("rating_text");if(typeof e.ratingText!="undefined"){if(BX("rating-footer-wrap")){if(typeof e.ratingFooter!="undefined"){oMSL.drawRatingFooter(e.ratingFooter)}else{BX("rating-footer-wrap").innerHTML=""}BX("rating-footer-wrap").style.display="block"}if(n){if(typeof e.ratingCounter!="undefined"){n.setAttribute("data-counter",parseInt(e.ratingCounter))}if(BX.type.isNotEmptyString(e.ratingText)&&typeof RatingLike!=="undefined"){n.innerHTML=e.ratingText;n.style.display="inline-block";var a=n.querySelector("[data-rating-vote-id]");if(a){var s=a.getAttribute("data-rating-vote-id");var l=a.getAttribute("data-rating-entity-type-id");var r=parseInt(a.getAttribute("data-rating-entity-id"));if(BX.type.isNotEmptyString(s)&&BX.type.isNotEmptyString(l)&&r>0){RatingLike.Set({likeId:s,entityTypeId:l,entityId:r,available:"Y",userId:BX.message("USER_ID"),localize:{LIKE_Y:BX.message("MOBILE_EXT_LIVEFEED_RATING_TEXT_LIKE_Y"),LIKE_N:BX.message("MOBILE_EXT_LIVEFEED_RATING_TEXT_LIKE_Y"),LIKE_D:BX.message("MOBILE_EXT_LIVEFEED_RATING_TEXT_LIKE_D")},template:"like_react",pathToUserProfile:BX.message("MSLPathToUser"),mobile:true})}}}else{n.style.display="none"}}i=true;oMSL.parseAndExecCode(e.ratingText,0);BX.message({RVRunEvent:"Y"})}else{if(BX("rating-footer-wrap")){if(typeof e.ratingFooter!="undefined"){oMSL.drawRatingFooter(e.ratingFooter)}else{BX("rating-footer-wrap").innerHTML=""}BX("rating-footer-wrap").style.display="none"}if(BX("rating_button_cont")){BX("rating_button_cont").style.display="none"}if(n){n.style.display="none"}}}if(BX("log_entry_follow")){if(typeof e.use_follow!="undefined"&&e.use_follow=="N"||typeof e.follow=="undefined"){BX.unbindAll(BX("log_entry_follow"));BX("log_entry_follow").style.display="none"}else{i=true;BX.removeClass(BX("log_entry_follow"),e.follow=="N"?"post-item-follow-active":"post-item-follow");BX.addClass(BX("log_entry_follow"),e.follow=="N"?"post-item-follow":"post-item-follow-active");BX("log_entry_follow").setAttribute("data-follow",e.follow=="N"?"N":"Y");BX.unbindAll(BX("log_entry_follow"));BX.bind(BX("log_entry_follow"),"click",(function(){BX.MobileLivefeed.FollowManagerInstance.setFollow({logId:e.log_id,bAjax:true,bRunEvent:false})}))}}if(i){BX.removeClass(BX("lenta_item"),"post-without-informers")}else{BX.addClass(BX("lenta_item"),"post-without-informers")}if(BX("post_item_top_wrap")&&!BX.MobileLivefeed.FollowManagerInstance.getFollowDefaultValue()){if(typeof e.follow!="undefined"&&e.follow=="Y"){BX.addClass(BX("post_item_top_wrap"),"post-item-follow")}else{BX.removeClass(BX("post_item_top_wrap"),"post-item-follow")}}if(t&&BX.type.isNotEmptyString(e.fav)&&BX("log_entry_favorites_"+e.log_id)){if(e.fav=="Y"){BX("log_entry_favorites_"+e.log_id).classList.add("lenta-item-fav-active")}else{BX("log_entry_favorites_"+e.log_id).classList.remove("lenta-item-fav-active")}}var d=BX("post_block_check_cont");if(!t){if(BX("post-comments-wrap")){BX.cleanNode(BX("post-comments-wrap"))}this.drawDetailPageText(e);var p=BX.findChild(d,{className:"post-more-block"},true,false);if(p&&BX("post_more_limiter")){if(typeof e.showMoreButton!="undefined"&&e.showMoreButton=="YES"){BX("post_more_limiter").style.visibility="visible";BX.bind(BX("post_more_limiter"),"click",(function(){oMSL.expandText(e.log_id)}))}else{BX("post_more_limiter").style.visibility="hidden"}}if(e.bShowFull==="YES"){d.className=oMSL.classes.postItemBlockFull;if(BX("post_more_block_"+e.log_id)){BX("post_more_block_"+e.log_id).style.display="none"}if(BX("post_block_check_more_"+e.log_id)){BX("post_block_check_more_"+e.log_id).style.display="none"}BX("post_more_limiter").style.visibility="hidden";BitrixMobile.LazyLoad.showImages(false)}else{d.className=e.bIsPhoto=="YES"?"post-item-post-img-block":"post-item-post-block"}if(e.bIsImportant==="YES"||BX.type.isNotEmptyString(e.medal)&&e.medal!=="NO"){d.classList.add("info-block-background");if(e.hasTitle==="YES"){d.classList.add("info-block-background-with-title")}else{d.classList.remove("info-block-background-with-title")}if(e.bIsImportant==="YES"){d.classList.add("info-block-important")}else{d.classList.remove("info-block-important")}if(BX.type.isNotEmptyString(e.medal)&&e.medal!=="NO"){d.classList.add("info-block-gratitude");d.classList.add("info-block-gratitude-"+e.medal)}else{d.classList.remove("info-block-gratitude")}}else{d.classList.remove("info-block-background")}Array.from(d.classList).forEach((function(e){if(e.indexOf("ui-livefeed-background")>-1){d.classList.remove(e)}}));if(BX.type.isNotEmptyString(e.backgroundCode)&&e.backgroundCode!=="NO"){d.classList.add("ui-livefeed-background");d.classList.add("ui-livefeed-background-"+e.backgroundCode)}if(e.bSetFocusOnCommentForm!="YES"&&e.bSetFocusOnCommentsList!="YES"){BX.MobileLivefeed.Post.moveTop()}if(BX("post-comments-form-wrap")){if(e.can_user_comment!=="YES"){if(BX("empty_page_bottom_margin")){BX("empty_page_bottom_margin").style.display="none"}app.hideInput()}}}else{var f=BX("post_item_top");if(f){if(typeof e.topText!=="undefined"){f.innerHTML=e.topText;var m=oMSL.parseAndExecCode(e.topText,0,false,true);setTimeout((function(){BX.MobileLivefeed.Instance.sendErrorEval(m)}),0)}}}if(BX("post-comments-wrap")&&(!t||oMSL.emptyRefreshCommentsFlag)){BX.MobileLivefeed.CommentsInstance.getList({ts:e.TS,bPullDown:false,bPullDownTop:false,obFocus:{form:e.bSetFocusOnCommentForm,comments:e.bSetFocusOnCommentsList}});oMSL.emptyRefreshCommentsFlag=false}if(!t){if(e.bSetFocusOnCommentForm=="YES"){oMSL.detailPageFocus="form"}else if(e.bSetFocusOnCommentsList=="YES"){oMSL.detailPageFocus="list"}else if(e.bSetFocusOnCommentsList=="YES"){oMSL.detailPageFocus=null}oMSL.adjustDetailPageFocus()}else{if(!BX.type.isUndefined(e.commentsNumNew)&&parseInt(e.commentsNumNew)>0){BX.MobileLivefeed.CommentsInstance.setFocusOnComments("list")}}BX.removeAllCustomEvents("main.post.form/mobile_simple");BX.addCustomEvent("main.post.form/mobile_simple",(function(){setTimeout(oMSL.adjustDetailPageFocus,150)}))};BitrixMSL.prototype.adjustDetailPageFocus=function(){if(!oMSL.detailPageFocus){return}BX.MobileLivefeed.CommentsInstance.setFocusOnComments(oMSL.detailPageFocus)};BitrixMSL.prototype.drawDetailPageText=function(e){var t="";var o=typeof e.logID!="undefined"?parseInt(e.logID):0;var i=o&&BX("post_block_check_cont_"+o)?BX("post_block_check_cont_"+o):BX("post_block_check_cont");var n=o&&BX("post_item_top_"+o)?BX("post_item_top_"+o):BX("post_item_top");var a=o&&BX("post_block_files_"+o)?BX("post_block_files_"+o):BX("post_block_files");if(i||a){BitrixMobile.LazyLoad.clearImages()}if(i){i.innerHTML="";if(BX.type.isNotEmptyString(e.detailText)){i.innerHTML=e.detailText;if(BX.type.isNotEmptyString(e.inlineScript)){i.innerHTML+=e.inlineScript}t+=oMSL.parseAndExecCode(i.innerHTML,0,false,true)}}if(a){a.innerHTML="";if(BX.type.isNotEmptyString(e.filesBlockText)){a.innerHTML=e.filesBlockText;t+=oMSL.parseAndExecCode(e.filesBlockText,0,false,true)}}if(n){n.innerHTML="";if(typeof e.topText!=="undefined"){n.innerHTML=e.topText;t+=oMSL.parseAndExecCode(e.topText,0,false,true)}}setTimeout((function(){BX.MobileLivefeed.Instance.sendErrorEval(t);BitrixMobile.LazyLoad.showImages();if(BX.message("MSLLoadScriptsNeeded")=="Y"&&typeof oMSL==="object"){oMSL.loadScripts()}}),0)};BitrixMSL.prototype.onLogEntryPostUpdated=function(e){var t="";if(typeof e.logID!=="undefined"){if(typeof e.detailText!=="undefined"&&BX("post_block_check_cont_"+parseInt(e.logID))){BX("post_block_check_cont_"+parseInt(e.logID)).innerHTML=e.detailText;t+=oMSL.parseAndExecCode(e.detailText,0,false,true)}if(typeof e.filesBlockText!=="undefined"&&BX("post_block_files_"+parseInt(e.logID))){BX("post_block_files_"+parseInt(e.logID)).innerHTML=e.filesBlockText;t+=oMSL.parseAndExecCode(e.filesBlockText,0,false,true)}if(typeof e.topText!=="undefined"&&BX("post_item_top_"+parseInt(e.logID))){BX("post_item_top_"+parseInt(e.logID)).innerHTML=e.topText;t+=oMSL.parseAndExecCode(e.topText,0,false,true)}setTimeout((function(){BX.MobileLivefeed.Instance.sendErrorEval(t);BitrixMobile.LazyLoad.showImages();if(BX.message("MSLLoadScriptsNeeded")=="Y"&&typeof oMSL==="object"){oMSL.loadScripts()}}),0)}};BitrixMSL.prototype.changeCounter=function(e,t,o){if(this.counterTimeout!==null){clearTimeout(this.counterTimeout);this.counterTimeout=null}t=typeof t!="undefined"?parseInt(t):0;o=typeof o!="undefined"?parseInt(o):0;var i=t>0?t:o>0?o:0;this.counterValue=e;if(parseInt(oMSL.counterValue)>0){BX.MobileLivefeed.BalloonNotifierInstance.showNotifier({counterValue:oMSL.counterValue})}else{this.counterTimeout=setTimeout((function(){if(i>BX.MobileLivefeed.Instance.getOption("frameCacheTs",0)){BX.MobileLivefeed.Instance.setRefreshNeeded(true)}if(BX.MobileLivefeed.Instance.getRefreshNeeded()&&!BX.MobileLivefeed.Instance.getRefreshStarted()){BX.MobileLivefeed.BalloonNotifierInstance.showRefreshNeededNotifier()}else{BX.MobileLivefeed.BalloonNotifierInstance.hideNotifier()}clearTimeout(oMSL.counterTimeout)}),2e3)}};BitrixMSL.prototype.parseAndExecCode=function(e,t,o,i){if(typeof e!="string"||e.length<=0){return}t=typeof t=="undefined"?500:parseInt(t);o=typeof o=="undefined"?true:!!o;i=!!i;var n=BX.processHTML(e);var a="";if(n!=null&&n.SCRIPT!=null&&typeof n.SCRIPT!="undefined"){for(var s=0;s<n.SCRIPT.length;s++){if(n.SCRIPT[s].isInternal){a+=";"+n.SCRIPT[s].JS}}if(o&&a.length>0){setTimeout((function(){BX.MobileLivefeed.Instance.sendErrorEval(a)}),t)}}return i?a:false};BitrixMSL.prototype.replaceUserPath=function(e){if(typeof e!="string"||e.length<=0){return}if(BX("MSLIsExtranetSite")=="Y"){e=e.replace("/mobile/users/?user_id=",BX.message("MSLExtranetSiteDir")+"mobile/users/?user_id=")}else{e=e.replace(BX.message("MSLExtranetSiteDir")+"mobile/users/?user_id=","/mobile/users/?user_id=")}e=e.replace(new RegExp('[\\w/]+/personal/user/(\\d+)/"',"igm"),BX("MSLIsExtranetSite")=="Y"?BX.message("MSLExtranetSiteDir")+'mobile/users/?user_id=$1"':'/mobile/users/?user_id=$1"');return e};BitrixMSL.prototype.InitDetail=function(e){this.commentsType=typeof e.commentsType!="undefined"&&e.commentsType=="blog"?"blog":"log";this.entityXMLId=typeof e.entityXMLId!="undefined"?e.entityXMLId:"";this.commentTextCurrent="";this.arMention={};this.iDetailTs=typeof e.TS!="undefined"?e.TS:0;BX.MobileLivefeed.FollowManagerInstance.setFollowValue(!(!BX.Type.isUndefined(e.bFollow)&&!e.bFollow));if(!this.bKeyboardCaptureEnabled){app.enableCaptureKeyboard(true);this.bKeyboardCaptureEnabled=true;BX.addCustomEvent("onKeyboardWillShow",BX.delegate((function(){this.keyboardShown=true}),this));BX.addCustomEvent("onKeyboardDidHide",BX.delegate((function(){this.keyboardShown=false}),this))}if(BX.type.isNotEmptyString(e.detailPageId)&&BX.MobileLivefeed.Instance.getOption("detailPageId")!=e.detailPageId){BX.MobileLivefeed.Instance.setOptions({detailPageId:e.detailPageId});if(typeof e.logId!="undefined"&&parseInt(e.logId)>0){this.logId=parseInt(e.logId)}}this.menuData={entry_type:this.commentsType,destinations:typeof e.entryParams!="undefined"&&e.entryParams.destinations!="undefined"?e.entryParams.destinations:{},post_perm:typeof e.entryParams!="undefined"&&e.entryParams.post_perm!="undefined"?e.entryParams.post_perm:null,post_id:typeof e.entryParams!="undefined"&&e.entryParams.post_id!="undefined"?e.entryParams.post_id:null,feed_id:typeof e.feed_id!="undefined"?e.feed_id:null,read_only:typeof e.readOnly!="undefined"&&e.readOnly=="Y"?"Y":"N",post_content_type_id:typeof e.entryParams!="undefined"&&BX.type.isNotEmptyString(e.entryParams.post_content_type_id)?e.entryParams.post_content_type_id:null,post_content_id:typeof e.entryParams!="undefined"&&typeof e.entryParams.post_content_id!="undefined"?parseInt(e.entryParams.post_content_id):null};BX.MobileLivefeed.PageMenuInstance.detailPageMenuItems=BX.MobileLivefeed.PageMenuInstance.buildDetailPageMenu(this.menuData);BX.MobileLivefeed.PageMenuInstance.init({type:"detail"});if(Application.getApiVersion()>=34){setTimeout(function(){var e=BX.MobileLivefeed.Instance.getPostFromLogId(BX.MobileLivefeed.Instance.getLogId());if(e){e.initDetailPin()}}.bind(this),0)}};BitrixMSL.prototype.setExpertMode=function(e){if(typeof e.value=="undefined"){return}var t=!!e.value;if(!BX.type.isNotEmptyString(BX.MobileLivefeed.Instance.getOption("detailPageId"))){oMSL.bExpertMode=t;this.setExpertModeMenuItemName()}var o={sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("LANGUAGE_ID"),value:t?"Y":"N",action:"change_expert_mode",mobile_action:"change_expert_mode"};this.changeListMode(o,(function(e){oMSL.pullDownAndRefresh()}),(function(e){oMSL.bExpertMode=!(e.value=="Y");oMSL.setExpertModeMenuItemName()}))};BitrixMSL.prototype.changeListMode=function(e,t,o){app.showPopupLoader({text:""});var i=false,n="";if(e.action=="change_follow_default"){i="socialnetwork.api.livefeed.changeFollowDefault";n=e.value=="Y"?"setFollowType":"unsetFollowType"}else if(e.action=="change_expert_mode"){i="socialnetwork.api.livefeed.changeExpertMode";n=e.value=="Y"?"setExpertMode":"unsetExpertMode"}if(!i){return}BX.Mobile.Ajax.runAction(i,{data:{value:e.value},analyticsLabel:{b24statAction:n,b24statContext:"mobile"}}).then(function(i){app.hidePopupLoader();if(i.data.success){t(e)}else{if(!BX.type.isNotEmptyString(BX.MobileLivefeed.Instance.getOption("detailPageId"))){o(e)}}}.bind(this),function(t){app.hidePopupLoader();if(!BX.type.isNotEmptyString(BX.MobileLivefeed.Instance.getOption("detailPageId"))){o(e)}}.bind(this))};BitrixMSL.prototype.incrementCounters=function(e){e=parseInt(e);if(e>0){var t=0;var o=0;if(BX("informer_comments_"+e)&&!BX("informer_comments_new_"+e)){t=BX("informer_comments_"+e).innerHTML.length>0?parseInt(BX("informer_comments_"+e).innerHTML):0;o=t+1;BX("informer_comments_"+e).innerHTML=o}if(BX("comcntleave-all")){t=BX("comcntleave-all").innerHTML.length>0?parseInt(BX("comcntleave-all").innerHTML):0;o=t+1;BX("comcntleave-all").innerHTML=o}BXMobileApp.onCustomEvent("onLogEntryCommentAdd",{logId:e},true)}};BitrixMSL.prototype.showPostMenu=function(e){var t=null;if(BX.type.isString(e.target.getAttribute("data-menu-type"))&&e.target.getAttribute("data-menu-type")=="post"){t=e.target}else{t=BX.findParent(e.target,{className:"lenta-menu"},{className:"post-item-top"})}if(!BX(t)){return e.preventDefault()}BX.MobileLivefeed.PostMenuInstance.init({logId:parseInt(t.getAttribute("data-log-id")),postId:parseInt(t.getAttribute("data-post-id")),postPerms:t.getAttribute("data-post-perm"),useFavorites:t.getAttribute("data-use-favorites")==="Y",useFollow:t.getAttribute("data-use-follow")==="Y",usePinned:t.getAttribute("data-use-pinned")==="Y",favoritesValue:t.getAttribute("data-favorites")==="Y",followValue:t.getAttribute("data-follow")==="Y",pinnedValue:t.getAttribute("data-pinned")==="Y",contentTypeId:t.getAttribute("data-content-type-id"),contentId:parseInt(t.getAttribute("data-content-id")),target:t,context:"list"});var o=BX.MobileLivefeed.PostMenuInstance.getMenuItems();if(o.length<=0){return e.preventDefault()}var i={};for(var n=0;n<o.length;n++){i[o[n].id]=o[n].action}app.exec("setPopupMenuData",{position:"center",items:o,sections:[{id:"defaultSection"}],callback:function(e){if(e.eventName=="onDataSet"){app.exec("showPopupMenu")}else if(e.eventName=="onItemSelected"&&BX.type.isNotEmptyObject(e.item)&&BX.type.isNotEmptyString(e.item.id)&&typeof i[e.item.id]!="undefined"){i[e.item.id]()}}});return e.preventDefault()};BitrixMSL.prototype.copyPostLink=function(e){var t=BX.type.isNotEmptyString(e.contentTypeId)?e.contentTypeId:"";var o=BX.type.isNumber(e.contentId)&&e.contentId>0?e.contentId:0;if(!BX.type.isNotEmptyString(t)||o<=0){return}BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.getRawEntryData",{data:{params:{entityType:t,entityId:o,logId:BX.MobileLivefeed.Instance.getLogId(),additionalParams:{getLivefeedUrl:"Y",absoluteUrl:"Y",returnFields:["LIVEFEED_URL"]}}}}).then(function(e){this.copyLinkSuccess(e.data)}.bind(this),(function(e){}))};BitrixMSL.prototype.setExpertModeMenuItemName=function(){var e=false;for(var t=0;t<BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.length;t++){e=BX.MobileLivefeed.PageMenuInstance.listPageMenuItems[t];if(typeof e.feature!="undefined"&&e.feature=="expert"){e.name=oMSL.bExpertMode?BX.message("MSLMenuItemExpertModeY"):BX.message("MSLMenuItemExpertModeN");BX.MobileLivefeed.PageMenuInstance.listPageMenuItems[t]=e;BX.MobileLivefeed.PageMenuInstance.init({type:"list"});break}}};BitrixMSL.prototype.replyToComment=function(e,t,o){e=parseInt(e);var i=typeof this.commentTextCurrent!="undefined"?this.commentTextCurrent:"";this.arMention[t]="[USER="+e+"]"+t+"[/USER]";i=i+" "+t+", ";if(typeof this.commentTextCurrent!="undefined"){this.commentTextCurrent=i}BXMobileApp.UI.Page.TextPanel.setText(i);BXMobileApp.UI.Page.TextPanel.focus();return typeof o!="undefined"?o.preventDefault():false};BitrixMSL.prototype.buildCommentRatingNode=function(e,t){var o=e["EVENT"]["RATING_USER_VOTE_VALUE"]>0?"post-comment-likes-liked":"post-comment-likes";var i=parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])>1||parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])==1&&e["EVENT"]["RATING_USER_VOTE_VALUE"]<=0;return BX.create("DIV",{props:{id:"bx-ilike-button-"+e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t,className:o},children:[BX.create("DIV",{props:{className:"post-comment-likes-text"},html:i?BX.message("MSLLike2"):BX.message("MSLLike")}),BX.create("DIV",{props:{id:"bx-ilike-count-"+e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t,className:"post-comment-likes-counter"},style:{display:i?"inner-block":"none"},events:{click:function(o){RatingLikeComments.List(e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t);o.preventDefault()}},html:""+parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])+""})]})};BitrixMSL.prototype.buildCommentReplyNode=function(e){return BX.create("DIV",{props:{className:"post-comment-reply"},children:[BX.create("DIV",{props:{className:"post-comment-reply-text"},events:{click:function(t){oMSL.replyToComment(e["EVENT"]["USER_ID"],e["CREATED_BY"]["FORMATTED"],t||window.event)}},html:BX.message("MSLReply")})]})};BitrixMSL.prototype.drawRatingFooter=function(e){if(BX("rating-footer-wrap")){BX("rating-footer-wrap").innerHTML=e;this.parseAndExecCode(e,0)}};BitrixMSL.prototype.unParseMentions=function(e){var t=e;t=t.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,(function(e,t,o){oMSL.arMention[o]=e;return o}));return t};BitrixMSL.prototype.expandText=function(e){if(!document.body.classList.contains("post-card")){return}var t=typeof e=="undefined"||e==null||!BX("post_block_check_cont_"+e)?BX("post_block_check_cont"):BX("post_block_check_cont_"+e);if(!t){return}if(BX.hasClass(t,"post-item-post-block")){BX.addClass(t,this.classes.postItemBlockFull);BX.removeClass(t,"post-item-post-block")}else if(BX.hasClass(t,"lenta-info-block-wrapp")){BX.addClass(t,"lenta-info-block-wrapp-full");BX.removeClass(t,"lenta-info-block-wrapp")}var o=t.querySelector(".post-more-block");if(o){o.style.display="none"}if(BX("post_more_limiter_"+e)){BX("post_more_limiter_"+e).style.visibility="hidden"}else if(BX("post_more_limiter")){BX("post_more_limiter").style.visibility="hidden"}var i=BX.findChildren(t,{tagName:"img"},true);if(BX.type.isArray(i)){for(var n=0;n<i.length;n++){if(BX.type.isString(i[n].getAttribute("data-src"))&&i[n].getAttribute("data-src").length>0&&!!i[n].id){BitrixMobile.LazyLoad.registerImage(i[n].id)}}BitrixMobile.LazyLoad.showImages(false)}};BitrixMSL.prototype.onLogEntryFavorites=function(e,t){var o=BX("log_entry_favorites_"+e);if(o&&(BX.message("MSLPageId")==undefined||BX.message("MSLPageId")!=t)){var i=o.getAttribute("data-favorites")=="Y"?"Y":"N";var n=i=="Y"?"N":"Y";if(i=="Y"){BX.removeClass(o,"lenta-item-fav-active")}else{BX.addClass(o,"lenta-item-fav-active")}o.setAttribute("data-favorites",n)}};BitrixMSL.prototype.onLogEntryRatingLike=function(e){var t=e.ratingId;if(typeof this.arRatingLikeProcess[t]!="undefined"){setTimeout((function(){oMSL.onLogEntryRatingLike(e)}),100);return}this.arRatingLikeProcess[t]=true;var o=e.voteAction;var i=parseInt(e.logId);var n=typeof e.userId!="undefined"?parseInt(e.userId):BX.message("USER_ID");if(i<=0&&this.isUserCurrent(n)){delete this.arRatingLikeProcess[t];return}var a=BX("bx-ilike-box-"+t);if(!a){delete this.arRatingLikeProcess[t];return}var s=BX("bx-ilike-button-"+t);if(!s){s=BX("rating_button")}if(!s||!BX.hasClass(s,"post-item-inform-likes")&&!BX.hasClass(s,"post-item-inform-likes-active")){delete this.arRatingLikeProcess[t];return}var l=null;var r=0;var d=0;var p=null;var f=i>0&&BX("rating_block_"+i)?BX("rating_block_"+i):BX("rating_button_cont");if(!f&&a){f=BX.findParent(a,{tag:"SPAN",className:"bx-ilike-block"})}if(a){l=BX.findChild(a,{className:"post-item-inform-right-text"},true,false);if(l&&f){r=parseInt(f.getAttribute("data-counter"));d=o=="plus"?r+1:r-1;l.innerHTML=d}if(this.isUserCurrent(n)){BX.removeClass(s,o=="plus"?"post-item-inform-likes":"post-item-inform-likes-active");BX.addClass(s,o=="plus"?"post-item-inform-likes-active":"post-item-inform-likes")}var m=BX.hasClass(s,"post-item-inform-likes-active")&&d>1||!BX.hasClass(s,"post-item-inform-likes-active")&&d>0;l=BX.findChild(s,{className:"post-item-inform-right"},true,false);if(l){l.innerHTML=d;l.style.display=m?"inline-block":"none";l=BX.findChild(s,{className:"post-item-inform-left"},true,false);l.innerHTML=m?BX.message("MSLLike2"):BX.message("MSLLike")}}if(f){f.setAttribute("data-counter",parseInt(d))}if(i>0&&BX("rating-footer_"+i)){p=BX("rating-footer-wrap_"+i)}else if(f){p=BX("rating-footer-wrap")}if(!p&&f&&typeof f.id!="undefined"){var c=f.id.match(/^rating_block_([\d]+)$/i);if(c!=null){p=BX("rating-footer-wrap_"+c[1])}}if(this.isUserCurrent(n)&&typeof BXRL!="undefined"&&typeof BXRL[t]!="undefined"){BXRL[t].lastVote=o=="plus"?"plus":"cancel"}delete this.arRatingLikeProcess[t]};BitrixMSL.prototype.onLogCommentRatingLike=function(e){var t=e.ratingId;if(typeof this.arRatingLikeProcess[t]!="undefined"){setTimeout((function(){oMSL.onLogCommentRatingLike(e)}),100);return}this.arRatingLikeProcess[t]=true;var o=e.voteAction;var i=typeof e.userId!="undefined"?parseInt(e.userId):BX.message("USER_ID");var n=BX("bx-ilike-count-"+t);if(!n){delete this.arRatingLikeProcess[t];return}var a=parseInt(n.innerHTML);var s=o=="plus"?a+1:a-1;if(this.isUserCurrent(i)){delete this.arRatingLikeProcess[t];return}var l=BX("bx-ilike-button-"+t);if(!l||!BX.hasClass(l,"post-comment-likes")&&!BX.hasClass(l,"post-comment-likes-liked")){delete this.arRatingLikeProcess[t];return}if(n){var r=BX.hasClass(l,"post-comment-likes-liked")&&s>1||!BX.hasClass(l,"post-comment-likes-liked")&&s>0;n.innerHTML=s;n.style.display=r?"inline-block":"none";var d=BX.findChild(l,{className:"post-comment-likes-text"},true,false);d.innerHTML=r?BX.message("MSLLike2"):BX.message("MSLLike")}delete this.arRatingLikeProcess[t]};BitrixMSL.prototype.checkVisibility=function(e){var t=e.node;if(BX.hasClass(document.body,"lenta-page")){var o=oMSL.checkImageOffset(t);if(o===false){e.status=BitrixMobile.LazyLoad.status.hidden}return o}else if(!oMSL.isPostFull()&&oMSL.isImageFromPost(e)){return oMSL.checkImageOffset(t)}return true};BitrixMSL.prototype.checkImageOffset=function(e){if(!BX.hasClass(e.parentNode,"post-item-attached-img-block")){return e.offsetTop<315}return true};BitrixMSL.prototype.isPostFull=function(){var e=BX("post_block_check_cont_"+this.logId)?BX("post_block_check_cont_"+this.logId):BX("post_block_check_cont",true);return BX.hasClass(e,this.classes.postItemBlockFull)||BX.hasClass(e,"lenta-info-block-wrapp-full")};BitrixMSL.prototype.isImageFromPost=function(e){if(typeof e.fromPost!="undefined"){return e.fromPost}var t=5;var o=e.node;while(o=o.parentNode){if(BX.hasClass(o,"post-item-post-block")){e.fromPost=true;return true}if(t<=0){e.fromPost=false;return false}t--}};BitrixMSL.prototype.isUserCurrent=function(e){return e==BX.message("USER_ID")};BitrixMSL.prototype.checkNodesHeight=function(){var e=false;var t=null;var o=null;for(var i in this.arBlockToCheck){if(!this.arBlockToCheck.hasOwnProperty(i)){continue}t=this.arBlockToCheck[i];o=BX(t.lenta_item_id)?BX(t.lenta_item_id).querySelector(".post-more-block"):false;if(o&&BX(t.text_block_id)){e=BX(t.text_block_id).offsetHeight;if(BX(t.title_block_id)){e+=BX(t.title_block_id).offsetHeight}if(t.title2_block_id&&BX(t.title2_block_id)){e+=BX(t.title2_block_id).offsetHeight}if(BX(t.files_block_id)){e+=BX(t.files_block_id).offsetHeight}var n=BX(t.text_block_id).parentNode.querySelector(".post-item-important");if(n){e+=n.offsetHeight}if(BX(t.more_button_id)&&BX(t.more_button_id).closest("[data-livefeed-pinned-panel]")){BX(t.more_button_id).style.visibility="visible"}else if(e>=320&&!BX.hasClass(t.text_block_id,this.classes.postItemBlockFull)){o.style.display="block";if(BX(t.lenta_item_id)){BX.removeClass(BX(t.lenta_item_id),"post-without-informers")}if(BX(t.more_button_id)){BX(t.more_button_id).style.visibility="visible"}}else{if(o){o.style.display="none"}if(BX(t.more_button_id)){BX(t.more_button_id).style.visibility="hidden"}}}}};BitrixMSL.prototype.refreshPostDetail=function(){BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.mobileGetDetail",{data:{logId:BX.MobileLivefeed.Instance.getLogId()}}).then(function(e){if(BX.type.isPlainObject(e.data)&&BX.type.isNotEmptyString(e.data.html)&&BX("post_block_check_cont")){BX.html(BX("post_block_check_cont"),e.data.html);this.registerEmptyBlockToCheck();setTimeout(function(){this.checkNodesHeight();BitrixMobile.LazyLoad.showImages()}.bind(this),500)}}.bind(this),(function(e){}))};BitrixMSL.prototype.formatTaskDescription=function(e,t,o,i){var n=e;i=BX.type.isNotEmptyString(i)?"_"+i:"";if(!!t&&!!o&&t.length>0){n+="<br><br>"+BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_"+o+i).replace("#A_BEGIN#","[URL="+t+"]").replace("#A_END#","[/URL]")}return n};BitrixMSL.prototype.createTask=function(e){app.showPopupLoader();BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.getRawEntryData",{data:{params:{entityType:e.entityType,entityId:e.entityId,logId:BX.type.isNumber(e.logId)?e.logId:null,additionalParams:{getSonetGroupAvailable:"Y",getLivefeedUrl:"Y",checkPermissions:{feature:"tasks",operation:"create_tasks"}}}}}).then(function(t){var o=t.data;if(typeof o.TITLE!="undefined"&&typeof o.DESCRIPTION!="undefined"&&typeof o.DISK_OBJECTS!="undefined"&&(BX.type.isNotEmptyString(o.TITLE)||BX.type.isNotEmptyString(o.DESCRIPTION))&&BX.type.isNotEmptyString(o.LIVEFEED_URL)){var i=this.formatTaskDescription(o.DESCRIPTION,o.LIVEFEED_URL,e.entityType,BX.type.isNotEmptyString(o.SUFFIX)?o.SUFFIX:"");var n={TITLE:o.TITLE,DESCRIPTION:i,RESPONSIBLE_ID:BX.message("USER_ID"),CREATED_BY:BX.message("USER_ID"),UF_TASK_WEBDAV_FILES:o.DISK_OBJECTS};var a=[];if(typeof o.GROUPS_AVAILABLE!="undefined"){for(var s in o.GROUPS_AVAILABLE){if(o.GROUPS_AVAILABLE.hasOwnProperty(s)){a.push(o.GROUPS_AVAILABLE[s])}}}if(a.length==1){n.GROUP_ID=parseInt(a[0])}BX.Mobile.Ajax.runComponentAction("bitrix:tasks.task","legacyAdd",{mode:"class",data:{data:n,parameters:{RETURN_ENTITY:true,PLATFORM:"mobile"}},onrequeststart:function(e){this.xhr=e}.bind(this)}).then(function(t){app.hidePopupLoader();if(typeof t.data!="undefined"&&typeof t.data.DATA!="undefined"&&typeof t.data.DATA.ID!="undefined"&&parseInt(t.data.DATA.ID)>0){this.createTaskSetContentSuccess(t.data.DATA.ID);BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.createTaskComment",{data:{params:{postEntityType:BX.type.isNotEmptyString(e.postEntityType)?e.postEntityType:e.entityType,entityType:e.entityType,entityId:e.entityId,taskId:t.data.DATA.ID,logId:BX.type.isNumber(e.logId)?e.logId:null}}}).then((function(e){}),(function(e){}))}}.bind(this),function(e){if(e.errors&&e.errors.length){var t=[];for(var o=0;o<e.errors.length;o++){t.push(e.errors[o]["message"])}this.createTaskSetContentFailure(t)}}.bind(this))}else{app.hidePopupLoader();this.createTaskSetContentFailure([BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_ERROR_GET_DATA")])}}.bind(this),function(e){app.hidePopupLoader();this.createTaskSetContentFailure([BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_ERROR_GET_DATA")])}.bind(this))};BitrixMSL.prototype.createTaskSetContentSuccess=function(e){app.confirm({title:BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_TITLE"),text:BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_DESCRIPTION"),buttons:[BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_BUTTON_CANCEL"),BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_BUTTON_OK")],callback:function(t){if(t==2){BXMobileApp.Events.postToComponent("taskbackground::task::open",[{taskId:e}])}}})};BitrixMSL.prototype.createTaskSetContentFailure=function(e){app.alert({title:BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_FAILURE_TITLE"),text:e.join(". ")})};BitrixMSL.prototype.copyLink=function(e){var t=BX.type.isNotEmptyString(e.entityType)?e.entityType:"",o=parseInt(e.entityId)>0?parseInt(e.entityId):0;if(!BX.type.isNotEmptyString(t)||o<=0){return}BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.getRawEntryData",{data:{params:{entityType:t,entityId:o,additionalParams:{getLivefeedUrl:"Y",absoluteUrl:"Y",returnFields:["LIVEFEED_URL"]}}}}).then(function(e){this.copyLinkSuccess(e.data)}.bind(this),(function(e){}))};BitrixMSL.prototype.copyLinkSuccess=function(e){if(!BX.type.isNotEmptyString(e.LIVEFEED_URL)){return}app.exec("copyToClipboard",{text:e.LIVEFEED_URL});BX.MobileLivefeed.NotificationBarInstance.showInfo({id:"copy",text:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_GET_LINK_SUCCESS"),groupId:"clipboard",maxLines:1})};BitrixMSL.prototype.getDiskUploadFolder=function(){};BitrixMSL.prototype.buildSelectedDestinations=function(e,t){if(typeof e.SPERM=="undefined"||typeof e.SPERM_NAME=="undefined"){return}var o=key=null;if(typeof e.SPERM.U!="undefined"){for(key in e.SPERM.U){if(!e.SPERM.U.hasOwnProperty(key)){continue}if(e.SPERM.U[key]=="UA"){BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(t,{type:"UA"})}else{o=e.SPERM.U[key].match(/^U([\d]+)$/);if(o!=null){BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(t,{type:"U",id:o[1],name:e.SPERM_NAME.U[key]})}}}}if(typeof e.SPERM.SG!="undefined"){for(key in e.SPERM.SG){if(!e.SPERM.SG.hasOwnProperty(key)){continue}o=e.SPERM.SG[key].match(/^SG([\d]+)$/);if(o!=null){BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(t,{type:"SG",id:o[1],name:e.SPERM_NAME.SG[key]})}}}};BitrixMSL.prototype.initPostForm=function(e){if(!BX.type.isNotEmptyObject(e)){e={}}var t=e.groupId?e.groupId:false,o=e.callback?e.callback:function(){},i={a_users:[],b_groups:[]};oMSL.clearPostFormDestination(i,t);BX.MobileLivefeed.PostFormOldManagerInstance.setExtraDataArray({postId:false,postAuthorId:false,logId:false,messageUFCode:BX.message("MOBILE_EXT_LIVEFEED_POST_FILE_UF_CODE")});BX.MobileLivefeed.PostFormOldManagerInstance.setParams({selectedRecipients:i,messageText:"",messageFiles:[]});setTimeout((function(){BX.MobileLivefeed.DatabaseUnsentPostInstance.load({onLoad:function(e){var t=null;i={a_users:[],b_groups:[]};if(typeof e.SPERM!="undefined"&&typeof e.SPERM.U!="undefined"&&e.SPERM.U!=null){for(t=0;t<e.SPERM.U.length;t++){if(e.SPERM.U[t]=="UA"){if(BX.message("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DENIED")!="Y"){BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(i,{type:"UA"})}}else{BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(i,{type:"U",id:e.SPERM.U[t].replace("U",""),name:typeof e.SPERM_NAME!="undefined"&&typeof e.SPERM_NAME.U!="undefined"&&typeof e.SPERM_NAME.U[t]!="undefined"&&e.SPERM_NAME.U[t]!=null?e.SPERM_NAME.U[t]:""})}}}if(typeof e.SPERM!="undefined"&&typeof e.SPERM.SG!="undefined"&&e.SPERM.SG!=null){for(t=0;t<e.SPERM.SG.length;t++){BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(i,{type:"SG",id:e.SPERM.SG[t].replace("SG",""),name:typeof e.SPERM_NAME.SG[t]!="undefined"&&typeof e.SPERM_NAME.SG!="undefined"&&typeof e.SPERM_NAME.SG[t]!="undefined"&&e.SPERM_NAME.SG[t]!=null?e.SPERM_NAME.SG[t]:""})}}BX.MobileLivefeed.PostFormOldManagerInstance.setParams({selectedRecipients:i});if(typeof e.POST_MESSAGE!="undefined"&&e.POST_MESSAGE!=null){BX.MobileLivefeed.PostFormOldManagerInstance.setParams({messageText:oMSL.unParseMentions(e.POST_MESSAGE)})}o()},onEmpty:function(e){i={a_users:[],b_groups:[]};oMSL.clearPostFormDestination(i,t);o()}},t)}),0)};BitrixMSL.prototype.clearPostFormDestination=function(e,t){if(typeof t!="undefined"&&parseInt(t)>0){BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(e,{type:"SG",id:parseInt(t),name:BX.message("MSLGroupName")})}else if(BX.MobileLivefeed.Instance.availableGroupList!==false){for(key in BX.MobileLivefeed.Instance.availableGroupList){if(!BX.MobileLivefeed.Instance.availableGroupList.hasOwnProperty(key)){continue}BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(e,{type:"SG",id:parseInt(BX.MobileLivefeed.Instance.availableGroupList[key]["entityId"]),name:BX.MobileLivefeed.Instance.availableGroupList[key]["name"]})}}else if(BX.message("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DEFAULT")=="Y"){BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(e,{type:"UA"})}};BitrixMSL.prototype.onUpdateSocnetCountersHandler=function(e){oMSL.bCounterReceived=true;oMSL.changeCounter(parseInt(e[strCounterType]))};BitrixMSL.prototype.onUpdateCounterHandler=function(e){if(typeof e[BX.message("SITE_ID")]!="undefined"){oMSL.onImUpdateCounterHandler(e[BX.message("SITE_ID")])}};BitrixMSL.prototype.onImUpdateCounterHandler=function(e){oMSL.bCounterReceived=true;if(typeof e.obZeroDate!="undefined"){var t=e.obZeroDate;delete e.obZeroDate}oMSL.changeCounter(parseInt(e[strCounterType]),typeof t!="undefined"&&t[strCounterType]!="undefined"?parseInt(t[strCounterType]):null)};BitrixMSL.prototype.registerBlocksToCheck=function(){var e=null;var t=null;var o=null;e=document.querySelectorAll(".post-wrap");if(e.length<=0){e=document.querySelectorAll(".lenta-item")}if(e!=null){for(var i=0;i<e.length;i++){if(BX.type.isNotEmptyString(e[i].id)){o=e[i].id.match(/^lenta_item_([\d]+)$/i);if(o!=null){t=o[1];if(!BX.util.in_array(t,this.blocksToCheckRegisteredList)){this.arBlockToCheck[t]={lenta_item_id:"lenta_item_"+t,text_block_id:"post_block_check_"+t,title_block_id:"post_block_check_title_"+t,title2_block_id:"post_text_title_"+t,files_block_id:"post_block_check_files_"+t,more_button_id:"post_more_limiter_"+t};this.blocksToCheckRegisteredList.push(t)}}}}}};BitrixMSL.prototype.registerEmptyBlockToCheck=function(){oMSL.arBlockToCheck={0:{lenta_item_id:"lenta_item",text_block_id:"post_block_check_cont",title_block_id:"post_block_check_title",more_button_id:"post_more_limiter"}}};BitrixMSL.prototype.getCopyText=function(e){function t(e){var t=document.createElement("textarea");t.innerHTML=e;return t.value}var o=e.innerHTML.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<br\s*[\/]?>/gi,"~~~---~~~").replace(/~~~---~~~/g,"\n");o=o.replace(/<a\s+href="([^"]+)"[^>]*>([^<]+)<\/a>/gi,(function(e,t,o){if(o.match(/^http/gi)){return'<a href="'+t+'">'+t+"</a>"}else{return e}}));return t(BX.util.strip_tags(o))};if(!window.oMSL){oMSL=new BitrixMSL;window.oMSL=oMSL}function openTaskComponentByTaskId(e,t,o){o=o||{};o.selectedTab=o.selectedTab||"taskTab";BXMobileApp.Events.postToComponent("taskbackground::task::open",[{taskId:t,data:o}],"background");e.preventDefault();e.stopPropagation();return false}
//# sourceMappingURL=script_attached.map.js