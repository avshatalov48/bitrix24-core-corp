BX.namespace("BX.Mobile.Crm.ProductEditor");BX.Mobile.Crm.ProductEditor={products:[],productsContainerNode:"",isEditMode:false,eventName:"",init:function(t){if(typeof t==="object"){this.products=t.products||[];this.productsContainerNode=t.productsContainerNode||"";this.eventName=t.eventName||"";this.isEditMode=t.isEditMode=="Y"?true:false}if(this.products){for(var e=0;e<this.products.length;e++){if(!this.products[e].DATA_ROLE)this.products[e].DATA_ROLE=this.products[e].ID;this.generateProductHtml(this.products[e])}}BX.addCustomEvent("onProductSelect",BX.proxy(function(t){this.addProduct(t)},this))},addProduct:function(t){if(typeof t!=="object")return;if(t.ID){var e={PRODUCT_ID:t.ID,PRODUCT_NAME:t.NAME,FORMATTED_PRICE:t.FORMATTED_PRICE,QUANTITY:1,DATA_ROLE:t.ID+"_"+Math.random()};this.products.push(e);this.generateProductHtml(e);app.onCustomEvent(this.eventName,{})}},generateProductHtml:function(t){var e=[];if(this.isEditMode){e.push(BX.create("i",{attrs:{className:"mobile-grid-menu"},events:{click:function(){BX.Mobile.Crm.ProductEditor.showProductActionMenu(this)}}}))}e.push(BX.create("span",{attrs:{className:"mobile-grid-field-textarea-photo"},children:[BX.create("img",{attrs:{src:"/bitrix/js/mobile/images/icon-product.png"}})]}),BX.create("span",{html:t.PRODUCT_NAME,attrs:{className:"mobile-grid-field-textarea-name-title"}}),BX.create("span",{html:t.FORMATTED_PRICE,attrs:{className:"mobile-grid-field-textarea-price"}}));var i=BX.create("div",{attrs:{className:"mobile-grid-field-textarea mobile-grid-field-textarea-name","data-role":t.DATA_ROLE},children:e});if(this.productsContainerNode)this.productsContainerNode.appendChild(i)},showProductActionMenu:function(t){new BXMobileApp.UI.ActionSheet({buttons:[{title:BX.message("CRM_JS_EDIT"),callback:function(){BX.Mobile.Crm.ProductEditor.editProduct(t)}},{title:BX.message("CRM_JS_DELETE"),callback:function(){BX.Mobile.Crm.ProductEditor.deleteProduct(t)}}]},"actionSheetStatus").show()},deleteProduct:function(t){var e=t.parentNode;var i=e.getAttribute("data-role");for(var o=0;o<this.products.length;o++){if(this.products[o].DATA_ROLE==i){this.products.splice(o,1);break}}BX.remove(e);app.onCustomEvent(this.eventName,{})}};
//# sourceMappingURL=script.map.js