if(typeof BX.CrmActivityListView==="undefined"){BX.CrmActivityListView=function(){this._isDirty=false;this._pageAfterOpenHandler=BX.delegate(this._onAfterPageOpen,this)};BX.extend(BX.CrmActivityListView,BX.CrmEntityListView);BX.CrmActivityListView.prototype.doInitialize=function(){this._stub=BX(this.getSetting("stubId"));BX.addCustomEvent("onOpenPageAfter",this._pageAfterOpenHandler);var t=this.getSetting("permissions",{});if(t["CREATE"]){BX.CrmMobileContext.getCurrent().createButtons({menuButton:{type:"context-menu",style:"custom",callback:BX.delegate(this._onMenuButtonClick,this)}})}};BX.CrmActivityListView.prototype.getContainer=function(){return this._container?this._container:BX.findChild(this._wrapper,{className:"crm_company_list"},true,false)};BX.CrmActivityListView.prototype.getItemContainers=function(){return BX.findChild(this.getContainer(),{className:"crm_company_list_item"},true,true)};BX.CrmActivityListView.prototype.getWaiterClassName=function(){return"crm_company_list_item_wait"};BX.CrmActivityListView.prototype.createModel=function(t,e){var i=this.getDispatcher();return i?i.createEntityModel(t,"ACTIVITY",e):null};BX.CrmActivityListView.prototype.createItemView=function(t){return BX.CrmActivityListItemView.create(t)};BX.CrmActivityListView.prototype.createSearchParams=function(t){return{SUBJECT:t}};BX.CrmActivityListView.prototype.getMessage=function(t,e){var i=BX.CrmActivityListView.messages;return i.hasOwnProperty(t)?i[t]:e};BX.CrmActivityListView.prototype._onMenuButtonClick=function(){var t=this.getSetting("permissions",{});if(t["CREATE"]){var e=BX.CrmMobileContext.getCurrent();var i=[{icon:"add",name:this.getMessage("menuCreateCall"),action:BX.delegate(this._onCallCreate,this)},{icon:"add",name:this.getMessage("menuCreateMeeting"),action:BX.delegate(this._onMeetingCreate,this)},{icon:"add",name:this.getMessage("menuCreateEmail"),action:BX.delegate(this._onEmailCreate,this)}];e.createMenu(i);e.showMenu()}};BX.CrmActivityListView.prototype._onSearchRequestCompleted=function(){this._postLayout()};BX.CrmActivityListView.prototype._onAfterVisibilityChange=function(){this._postLayout()};BX.CrmActivityListView.prototype._postLayout=function(){if(!this.isVisible()){return}if(this.hasItems()){this._stub.style.display="none";this._container.style.display=""}else{this._container.style.display="none";this._stub.style.display=""}};BX.CrmActivityListView.prototype._onCallCreate=function(){var t=this.getSetting("callEditUrl","");if(t!==""){BX.CrmMobileContext.getCurrent().open({url:t,cache:false})}};BX.CrmActivityListView.prototype._onMeetingCreate=function(){var t=this.getSetting("meetingEditUrl","");if(t!==""){BX.CrmMobileContext.getCurrent().open({url:t,cache:false})}};BX.CrmActivityListView.prototype._onEmailCreate=function(){var t=this.getSetting("emailEditUrl","");if(t!==""){BX.CrmMobileContext.getCurrent().open({url:t,cache:false})}};BX.CrmActivityListView.prototype._processClearSearchClick=function(){if(this.isFiltered()){this.applyFilterPreset(this.findFilterPreset("clear_filter"))}return true};BX.CrmActivityListView.prototype._processExternalCreate=function(t){this._isDirty=true};BX.CrmActivityListView.prototype._onAfterPageOpen=function(){if(this._isDirty&&this.reload(this.getSetting("reloadUrl",true))){this._isDirty=false}};BX.CrmActivityListView.create=function(t,e){var i=new BX.CrmActivityListView;i.initialize(t,e);return i};if(typeof BX.CrmActivityListView.messages==="undefined"){BX.CrmActivityListView.messages={}}}if(typeof BX.CrmActivityListItemView==="undefined"){BX.CrmActivityListItemView=function(){this._list=this._dispatcher=this._model=this._container=null};BX.extend(BX.CrmActivityListItemView,BX.CrmEntityView);BX.CrmActivityListItemView.prototype.doInitialize=function(){this._list=this.getSetting("list",null);this._dispatcher=this.getSetting("dispatcher",null);this._model=this.getSetting("model",null);this._container=this.getSetting("container",null);if(!this._model&&this._container){var t=this._container.getAttribute("data-entity-id");if(BX.type.isNotEmptyString(t)){this._model=this._dispatcher.getModelById(t)}}if(this._model){this._model.addView(this)}};BX.CrmActivityListItemView.prototype.layout=function(){if(this._container){BX.cleanNode(this._container)}else{this._container=BX.create("LI",{attrs:{"class":"crm_company_list_item"},events:{click:BX.delegate(this._onContainerClick,this)}});this._list.addItemView(this)}var t=this._model;if(!t){return}var e=t.getBoolParam("IS_EXPIRED",false);var i=t.getBoolParam("IS_IMPORTANT",false);var r=t.getBoolParam("COMPLETED",false);if(r){this._container.style.backgroundColor="#f5f6f8"}else if(e){this._container.style.backgroundColor="#fae9e7"}var n=t.getStringParam("LIST_IMAGE_URL");if(n!==""){this._container.appendChild(BX.create("IMG",{attrs:{src:n},style:{width:"28px",padding:"10px 7px 0 8px","float":"left"}}))}var s=BX.create("A",{attrs:{className:"crm_company_title"},text:t.getStringParam("SUBJECT")});if(i){s.appendChild(BX.create("SPAN",{attrs:{className:"crm_important"},text:this._list.getMessage("important")}))}if(r){s.style.color="#7c8182";s.style.textDecoration="line-through"}this._container.appendChild(s);var o=BX.create("DIV",{attrs:{className:"crm_company_company"}});var a=t.getStringParam("END_TIME");if(a===""){a=this._list.getMessage("emptyTime")}if(e){var c={attrs:{className:"fwb"},style:{color:"#e20707"},text:a};o.appendChild(BX.create("SPAN",c))}else{o.appendChild(document.createTextNode(a))}var l=t.getStringParam("OWNER_TITLE");if(l!==""){o.appendChild(document.createTextNode(" - "));o.appendChild(BX.create("SPAN",{attrs:{className:"fwb"},text:l}))}this._container.appendChild(o);var m={attrs:{className:"clb"}};if(i){m.style={marginBottom:"10px"}}this._container.appendChild(BX.create("DIV",m))};BX.CrmActivityListItemView.prototype.clearLayout=function(){this._list.removeItemView(this);this._container=null};BX.CrmActivityListItemView.prototype.scrollInToView=function(){if(this._container){BX.scrollToNode(this._container)}};BX.CrmActivityListItemView.prototype.getContainer=function(){return this._container};BX.CrmActivityListItemView.prototype.getModel=function(){return this._model};BX.CrmActivityListItemView.prototype.getModelKey=function(){return this._model?this._model.getKey():""};BX.CrmActivityListItemView.prototype.redirectToView=function(){var t=this._model;if(!t){return}var e=t.getDataParam("SHOW_URL","");if(e===""){return}var i={url:e};if(t.getIntParam("TYPE_ID",0)===3){i["bx24ModernStyle"]=true}BX.CrmMobileContext.redirect(i)};BX.CrmActivityListItemView.prototype._onContainerClick=function(t){this.redirectToView()};BX.CrmActivityListItemView.prototype._onImageClick=function(t){this.redirectToView();return BX.PreventDefault(t)};BX.CrmActivityListItemView.prototype._onTitleClick=function(t){this.redirectToView();return BX.PreventDefault(t)};BX.CrmActivityListItemView.prototype.handleModelUpdate=function(t){if(this._model!==t){return}this.layout();if(this._list){this._list.handleItemUpdate(this)}};BX.CrmActivityListItemView.prototype.handleModelDelete=function(t){if(this._model!==t){return}this.clearLayout();if(this._list){this._list.handleItemDelete(this)}};BX.CrmActivityListItemView.create=function(t){var e=new BX.CrmActivityListItemView;e.initialize(t);return e}}
//# sourceMappingURL=script.map.js