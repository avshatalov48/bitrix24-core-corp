BX.namespace("BX.Mobile.Grid.Fields");BX.Mobile.Grid.Fields={gridId:"",eventName:"",init:function(e){if(typeof e==="object"){this.gridId=e.gridId||"";this.eventName=e.eventName||""}var i=BX("bx-mobile-interface-fields-block").querySelectorAll("[data-role='mobile-grid-field-item']");if(i){for(var t=0;t<i.length;t++){if(BX.hasClass(i[t],"mobile-grid-field-selected"))this.selectedFields[i[t].getAttribute("data-id")]=true;new FastButton(i[t],BX.proxy(function(){BX.Mobile.Grid.Fields.selectField(this.item)},{item:i[t]}))}}},selectField:function(e){var i=e.getAttribute("data-id");if(BX.hasClass(e,"mobile-grid-field-selected")){BX.removeClass(e,"mobile-grid-field-selected");delete this.changes[i]}else{if(!this.selectedFields[i]){this.changes[i]=true}BX.addClass(e,"mobile-grid-field-selected")}},changes:{},selectedFields:{},apply:function(){BXMobileApp.UI.Page.LoadingScreen.show();var e=[],i;var t=BX.findChildren(BX("bx-mobile-interface-fields-block"),{className:"mobile-grid-field-selected"},true);if(t){for(var s=0;s<t.length;s++){i=t[s].getAttribute("data-id");e.push(i)}}BX.ajax.post("/mobile/?mobile_action=mobile_grid_fields",{sessid:BX.bitrix_sessid(),fields:e,action:"fields",gridId:this.gridId},BX.proxy(function(){BXMobileApp.UI.Page.LoadingScreen.hide();try{Object.keys(this.changes).forEach(function(e){fabric.Answers.sendCustomEvent("TASK/VISIBLE_FIELD/"+e,{})}.bind(this))}catch(e){}BXMobileApp.onCustomEvent(this.eventName,{},true);app.closeModalDialog()},this))}};