(function(){if(BX.MenuTimeman)return;BX.MenuTimeman=function(){var t=function(t){this.params=t;BX.addCustomEvent(window,"onMobileTimeManStatusHasBeenChanged",BX.proxy(this.onMobileTimeManStatusHasBeenChanged,this));BX.addCustomEvent("onPull-timeman",BX.delegate(this.onPull,this));this.date=new Date;this.notificationBar={start:null,expired:null};this.timemanUrl=BX.message("SITE_DIR")+"mobile/timeman/";setTimeout(function(){BXMobileApp.UI.Page.reload()},(this.date.getHours()*3600+(this.date.getMinutes()+1)*60+this.date.getSeconds())*1e3);app.onCustomEvent("onPullExtendWatch",{id:"TIMEMANWORKINGDAY_"+BX.message("USER_ID")});this.destroy=BX.proxy(this.destroy,this);if(BX.browser.IsIOS())window.addEventListener("pagehide",this.destroy);else BX.bind(window,"beforeunload",this.destroy);this.init()};t.prototype={init:function(){this.node=BX("menu-user-timeman");setTimeout(BX.proxy(this.checkNotification,this),500)},destroy:function(){if(this.notificationBar["expired"])this.notificationBar["expired"].hide();if(this.notificationBar["start"])this.notificationBar["start"].hide()},checkNotification:function(){var t=this.node.getAttribute("data-bx-timeman-status"),i=new Date,e=i.getHours()*60*60+i.getMinutes()*60+i.getSeconds();if(t=="start"){if(BX.localStorage.get("timemanNSS")!=="hidden"){this.notificationBar["start"]=new BXMobileApp.UI.NotificationBar({message:BX.message("TM_NOTIF_START"),color:"#bb50c119",textColor:"#ffffff",maxLines:2,align:"center",indicatorHeight:30,isGlobal:true,groupId:"timeman",useCloseButton:true,hideOnTap:true,onTap:BX.proxy(function(){this.tapNotificationStart=true},this),onHideAfter:BX.proxy(this.onHideAfterStart,this)},"timemanStart");this.notificationBar["start"].show()}else{if(this.notificationBar["expired"])this.notificationBar["expired"].hide();if(this.params["UF_TM_MAX_START"]>0&&this.params["UF_TM_MAX_START"]>e)setTimeout(BX.proxy(this.checkNotification,this),(this.params["UF_TM_MAX_START"]-e+1)*1e3)}}else if(t=="expired"){if(BX.localStorage.get("timemanNSE")!=="hidden"){this.notificationBar["expired"]=new BXMobileApp.UI.NotificationBar({message:BX.message("TM_NOTIF_EXPIRED"),color:"#bbf23b3b",textColor:"#ffffff",maxLines:2,align:"center",indicatorHeight:30,isGlobal:true,groupId:"timeman",useCloseButton:true,hideOnTap:true,onTap:BX.proxy(function(){this.tapNotificationExpired=true},this),onHideAfter:BX.proxy(this.onHideAfterExpired,this)},"timemanExpired");this.notificationBar["expired"].show()}else{if(this.notificationBar["start"])this.notificationBar["start"].hide();setTimeout(BX.proxy(this.checkNotification,this),30*1e3)}}else{if(this.notificationBar["expired"])this.notificationBar["expired"].hide();if(this.notificationBar["start"])this.notificationBar["start"].hide()}},onHideAfterStart:function(t){this.notificationBar["start"]=null;if(t&&t["isAutoHide"]==true)return;var i=new Date,e=i.getHours()*60*60+i.getMinutes()*60+i.getSeconds(),a=86400-e;if(this.params["UF_TM_MAX_START"]>0&&this.params["UF_TM_MAX_START"]>e){a=this.params["UF_TM_MAX_START"]-e;setTimeout(BX.proxy(this.checkNotification,this),(a+1)*1e3)}BX.localStorage.set("timemanNSS","hidden",a);if(this.tapNotificationStart===true){delete this.tapNotificationStart;BXMobileApp.PageManager.loadPageStart({url:this.timemanUrl,bx24ModernStyle:true})}},onHideAfterExpired:function(t){this.notificationBar["expired"]=null;if(t&&t["isAutoHide"]==true)return;var i=30*60;BX.localStorage.set("timemanNSE","hidden",i);if(this.tapNotificationExpired===true){delete this.tapNotificationExpired;BXMobileApp.PageManager.loadPageStart({url:this.timemanUrl,bx24ModernStyle:true})}setTimeout(BX.proxy(this.checkNotification,this),(i+1)*1e3)},onMobileTimeManStatusHasBeenChanged:function(t){t=BX.type.isArray(t)?t[0]:t;var i=this.node,e=this.node.getAttribute("data-bx-timeman-status");if(e==t)return;if(e=="expired"&&BX.type.isPlainObject(this.notificationBar.expired))this.notificationBar.expired.hide();else if(e=="start"&&BX.type.isPlainObject(this.notificationBar.start))this.notificationBar.start.hide();BX.removeClass(i,"menu-user-timeman-status-opened menu-user-timeman-status-completed menu-user-timeman-status-start menu-user-timeman-status-paused menu-user-timeman-status-expired");BX.addClass(i,"menu-user-timeman-status-"+t);this.node.setAttribute("data-bx-timeman-status",t);this.checkNotification()},onPull:function(t){var i=t["command"];t=t["params"];var e="ready";if(t["STATE"]=="OPENED"){e="opened"}else if(t["STATE"]=="CLOSED"){if(t["CAN_OPEN"]=="REOPEN"||!t["CAN_OPEN"]){e="completed"}else{e="start"}}else if(t["STATE"]=="PAUSED"){e="paused"}else if(t["STATE"]=="EXPIRED"){e="expired"}this.onMobileTimeManStatusHasBeenChanged(e)}};return t}();var t=null;BX.MenuTimeman.instance=function(i){if(t===null)t=new BX.MenuTimeman(i);else t.init()}})();
//# sourceMappingURL=script.map.js