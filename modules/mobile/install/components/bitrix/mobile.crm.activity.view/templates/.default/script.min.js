if(typeof BX.CrmActivityView==="undefined"){BX.CrmActivityView=function(){this._id="";this._settings={};this._dispatcher=null;this._isDirty=false;this._enableForcedReloading=false;this._prefix=""};if(typeof BX.CrmActivityView.messages==="undefined"){BX.CrmActivityView.messages={}}BX.CrmActivityView.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:{};this._dispatcher=this.getSetting("dispatcher",null);this._prefix=this.getSetting("prefix");var i=BX.CrmMobileContext.getCurrent();BX.addCustomEvent(window,"onCrmEntityUpdate",BX.delegate(this._onExternalUpdate,this));BX.addCustomEvent(window,"onCrmEntityDelete",BX.delegate(this._onExternalDelete,this));BX.addCustomEvent(window,"onOpenPageAfter",BX.delegate(this._onAfterPageOpen,this));var n=this.getSetting("permissions",{});if(n["EDIT"]||n["DELETE"]){var s=[];if(n["CAN_COMPLETE"]){var o=this._dispatcher.getModelById(this.getEntityId());var r=o&&o.getDataParam("COMPLETED",false);if(!r){s.push({icon:"finish",name:this.getMessage("menuSetCompleted"),action:BX.delegate(this._onSetCompleted,this)})}else{s.push({icon:"play",name:this.getMessage("menuSetNotCompleted"),action:BX.delegate(this._onSetNotCompleted,this)})}}if(n["EDIT"]){s.push({icon:"edit",name:this.getMessage("menuEdit"),action:BX.delegate(this._onEdit,this)})}if(n["DELETE"]){s.push({icon:"delete",name:this.getMessage("menuDelete"),action:BX.delegate(this._onDelete,this)})}i.prepareMenu(s)}},getId:function(){return this._id},getSettings:function(){return this._settings},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},setSetting:function(e,t){this._settings[e]=t},getMessage:function(e){var t=BX.CrmActivityView.messages;return BX.type.isNotEmptyString(t[e])?t[e]:""},getEntityId:function(){return parseInt(this.getSetting("entityId",0))},prepareElementId:function(e){e=e.toLowerCase();return this._prefix!==""?this._prefix+"_"+e:e},resolveElement:function(e){return BX(this.prepareElementId(e))},reloadAsync:function(){var e=this;window.setTimeout(function(){var t=BX.CrmMobileContext.getCurrent();t.showPopupLoader();t.reload();e._isDirty=false;t.hidePopupLoader()},0)},_onEdit:function(){var e=this.getSetting("editUrl","");if(e===""){return}BX.CrmMobileContext.getCurrent().open({url:e,cache:false})},_onSetCompleted:function(){var e=this;this._dispatcher.execUpdateAction("complete",{ID:this.getEntityId(),COMPLETED:1},function(){e._enableForcedReloading=true})},_onSetNotCompleted:function(){var e=this;this._dispatcher.execUpdateAction("complete",{ID:this.getEntityId(),COMPLETED:0},function(){e._enableForcedReloading=true})},_onDelete:function(){BX.CrmMobileContext.getCurrent().confirm(this.getMessage("deletionTitle"),this.getMessage("deletionConfirmation"),["OK",BX.message["JS_CORE_WINDOW_CANCEL"]],BX.delegate(function(e){if(e===1)this._dispatcher.deleteEntity(this.getEntityId())},this))},_onExternalUpdate:function(e){var t=typeof e["typeName"]!=="undefined"?e["typeName"]:"";var i=typeof e["id"]!=="undefined"?parseInt(e["id"]):0;if(t===BX.CrmActivityModel.typeName&&i===this.getEntityId()){if(!this._enableForcedReloading){this._isDirty=true}else{this._enableForcedReloading=false;this.reloadAsync()}}},_onExternalDelete:function(e){var t=typeof e["typeName"]!=="undefined"?e["typeName"]:"";var i=typeof e["id"]!=="undefined"?parseInt(e["id"]):0;if(t===BX.CrmActivityModel.typeName&&i===this.getEntityId()){BX.CrmMobileContext.getCurrent().close()}},_onAfterPageOpen:function(){if(this._isDirty){this._isDirty=false;this.reloadAsync()}}};BX.CrmActivityView.items={};BX.CrmActivityView.create=function(e,t){var i=new BX.CrmActivityView;i.initialize(e,t);this.items[e]=i;return i}}
//# sourceMappingURL=script.map.js