{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["/**\n * @package bitrix\n * @subpackage vote\n * @copyright 2001-2019 Bitrix\n */\nimport 'main.polyfill.core';\n\nBX.namespace('BX.Vote');\n\nclass answer {\n\tconstructor(id, data)\n\t{\n\t\tthis.id = null;\n\t\tthis.params = {\n\t\t\tisNew : true,\n\t\t\tisSaved : false\n\t\t};\n\t\tif (id > 0)\n\t\t{\n\t\t\tthis.params.isNew = false;\n\t\t\tthis.id = id;\n\t\t}\n\t\telse if (id !== 0)\n\t\t{\n\t\t\tthis.id = id;\n\t\t}\n\n\t\tthis.data =  {\n\t\t\tMESSAGE : \"\",\n\t\t\tMESSAGE_TYPE : \"text\",\n\t//\t\tIMAGE_ID : \"\",\n\t//\t\tFIELD_TYPE : 0,\n\t//\t\tFIELD_WIDTH : 0, //out of date\n\t//\t\tFIELD_HEIGHT : 0, //out of date\n\t//\t\tFIELD_PARAM : \"\", //out of date\n\t//\t\tACTIVE : \"Y\",\n\t//\t\tC_SORT : 0,\n\t//\t\tCOLOR : \"\" //out of date\n\t\t};\n\n\t\tthis.adjust(data);\n\t\tthis.__apply = BX.delegate(this.apply, this);\n\t\tthis.__delete = BX.delegate(this.delete, this);\n\t\tBX.addCustomEvent(this, \"onApply\", this.__apply);\n\t\tBX.addCustomEvent(this, \"onDelete\", this.__delete);\n\t}\n\tadjust(data)\n\t{\n\t\tlet i, d = BX.type.isPlainObject(data) ? data : {};\n\t\tfor (i in this.data)\n\t\t{\n\t\t\tif (this.data.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (d[i])\n\t\t\t\t\tthis.data[i] = d[i];\n\t\t\t}\n\t\t}\n\t}\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\tgetData()\n\t{\n\t\treturn this.data;\n\t}\n\tapply(fromData)\n\t{\n\t\tthis.adjust(fromData);\n\t\treturn this;\n\t}\n\tdelete()\n\t{\n\t\treturn this;\n\t}\n}\n\nanswer.repo = {};\nanswer.getItem = function(id, data) {\n\tconst item = new answer(id, BX.type.isPlainObject(data) ? data : {});\n\tif (id !== 0 && answer.repo[id])\n\t{\n\t\tanswer.repo[id] = null;\n\t\tdelete answer.repo[id];\n\t\tanswer.repo[id] = item;\n\t}\n\treturn item;\n};\n\nclass entityType {\n\tconstructor (values)\n\t{\n\t\tthis.values = [];\n\t\tthis.valuesById = {};\n\t\tthis.valuesByCode = {};\n\t\tvalues.forEach(BX.proxy(function(current) {\n\t\t\tthis.values.push(current);\n\t\t\tthis.valuesById[current[\"ID\"].toLowerCase()] = current;\n\t\t\tthis.valuesByCode[current[\"CODE\"].toLowerCase()] = current;\n\t\t}, this));\n\t}\n\tgetByCode(code)\n\t{\n\t\treturn this.valuesByCode[code];\n\t}\n\tgetById(id)\n\t{\n\t\treturn this.valuesById[id];\n\t}\n\tgetIdByCode(code)\n\t{\n\t\tif (this.valuesByCode.hasOwnProperty(code))\n\t\t{\n\t\t\treturn this.valuesByCode[code][\"ID\"];\n\t\t}\n\t\treturn null;\n\t}\n}\n\nconst answerTypes = {\n\tsetTypes : function(values) {\n\t\tanswerTypes.obj = new entityType(values);\n\t},\n\tgetValues : function() {\n\t\treturn answerTypes.obj.values;\n\t},\n\tisTextType : function(id) {\n\t\tlet item = answerTypes.obj.getById(id);\n\t\tif (BX.type.isPlainObject(item))\n\t\t{\n\t\t\treturn (item[\"CODE\"].toUpperCase().substr(0, 4) === \"TEXT\");\n\t\t}\n\t\treturn false;\n\t}\n};\nconst questionTypes = {\n\tsetTypes : function(values) {\n\t\tquestionTypes.obj = new entityType(values);\n\t},\n\tisCompatibilityMode : function() {\n\t\tlet val = BX('FIELD_TYPE').value;\n\t\treturn (String(val).toLowerCase() === questionTypes.obj.getIdByCode(\"compatibility\"));\n\t},\n\tgetActive : function() {\n\t\treturn String(BX('FIELD_TYPE').value).toUpperCase();\n\t}\n};\n\nclass answerEditor {\n\tconstructor()\n\t{\n\t\tthis.id = 'Editor';\n\t\tthis.popup = null;\n\t\tthis.reset();\n\n\t\tthis.debug = true;\n\n\t\treturn this;\n\t}\n\tonApply(formData)\n\t{\n\t\tBX.onCustomEvent(this.answer, \"onApply\", [formData]);\n\t\tBX.onCustomEvent(this, \"onApply\", [this.answer.getId(), this.answer.getData(), this.gridData]);\n\t\tthis.reset();\n\t}\n\tonCancel()\n\t{\n\t\tBX.onCustomEvent(this.answer, \"onCancel\", []);\n\t\tthis.reset();\n\t}\n\tonDelete()\n\t{\n\t\tBX.onCustomEvent(this.answer, \"onDelete\", []);\n\t\tthis.reset();\n\t}\n\tsetGridData(gridData)\n\t{\n\t\tthis.gridData = {\n\t\t\tgridInstanceId : gridData[\"gridInstanceId\"],\n\t\t\tgridId : gridData[\"gridId\"],\n\t\t\tmaxSort : gridData[\"maxSort\"],\n\t\t};\n\t\treturn this;\n\t}\n\tgetGridId()\n\t{\n\t\treturn this.gridData.gridId;\n\t}\n\tsetAnswer(id, data)\n\t{\n\t\tconst item = answer.getItem(id, data);\n\t\tif (this.answer !== null && this.answer !== item)\n\t\t\tthis.onCancel();\n\t\tthis.answer = item;\n\t\treturn this;\n\t}\n\treset()\n\t{\n\t\tdelete this.answer;\n\t\tthis.answer = null;\n\t\tdelete this.gridData;\n\t\tthis.gridData = {\n\t\t\tid : null,\n\t\t\tgridId : null,\n\t\t\tmaxSort : null\n\t\t};\n\t}\n\tshow()\n\t{\n\t\tthis.showEditor(this.answer.getData());\n\t}\n\tshowEditor(data)\n\t{\n\t\tif (this.popup !== null)\n\t\t\tthis.popup.close();\n\t\tlet isTextMode = false;\n\t\tlet fieldType = String(data[\"FIELD_TYPE\"]);\n\t\tlet htmlReg = '';\n\t\tanswerTypes.getValues().forEach(function(current){\n\t\t\thtmlReg += ['<option value=\"' + current[\"ID\"] + '\"' + (fieldType === current[\"ID\"] ? ' selected' : '') + '>', current[\"TITLE\"], '</option>'].join('');\n\t\t});\n\t\thtmlReg = [\n\t\t\t\t'<div class=\"ui-form-block ui-form-block-html-text\">\\\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-radio ui-ctl-wa ui-ctl-xs\"> \\\n\t\t\t\t\t\t<input type=\"radio\" name=\"answer[MESSAGE_TYPE]\" ' + (data[\"MESSAGE_TYPE\"] === \"html\" ? \"\" : \"checked\" ) + ' class=\"ui-ctl-element\" value=\"text\"> \\\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">text</div> \\\n\t\t\t\t\t</label>\\\n\t\t\t\t\t<label className=\"ui-ctl ui-ctl-wa ui-ctl-xs\"><div class=\"ui-ctl-label-text\">&nbsp;/&nbsp;</div></label> \\\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-radio ui-ctl-wa ui-ctl-xs\"> \\\n\t\t\t\t\t\t<input type=\"radio\" name=\"answer[MESSAGE_TYPE]\" ' + (data[\"MESSAGE_TYPE\"] === \"html\" ? \"checked\" : \"\" ) + ' class=\"ui-ctl-element\" value=\"html\"> \\\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">html</div> \\\n\t\t\t\t\t</label>\\\n\t\t\t\t</div>\\\n\t\t\t\t<div class=\"ui-form-block\">\\\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textarea\" id=\"answer_MESSAGE_block\">\\\n\t\t\t\t\t\t<textarea name=\"answer[MESSAGE]\" class=\"ui-ctl-element\" id=\"ANSWER_MESSAGE\" placeholder=\"' + BX.message(\"VOTE_ANSWER_PLACEHOLDER\") + '\">' + BX.util.htmlspecialchars(data[\"MESSAGE\"]) +'</textarea>\\\n\t\t\t\t\t</div>\\\n\t\t\t\t</div>\\\n\t\t\t\t<input id=\"answer_FIELD_TYPE\" name=\"answer[FIELD_TYPE]\" type=\"hidden\" value=\"\" class=\"ui-ctl-element\"> ' +\n\t\t\t\t(questionTypes.isCompatibilityMode() === true ?\n\t\t\t\t'<div class=\"ui-form-block\">\\\n\t\t\t\t\t<label for=\"id1\" class=\"ui-ctl-label-text\">' + BX.message(\"VOTE_ANSWER_FIELD_TYPE\") + '</label>\\\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown\">\\\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\\\n\t\t\t\t\t\t<select name=\"answer[FIELD_TYPE]\" class=\"ui-ctl-element\">' + htmlReg + '</select>\\\n\t\t\t\t\t</div>\\\n\t\t\t\t</div> ' : '<input  name=\"answer[FIELD_TYPE]\" type=\"hidden\" value=\"' + questionTypes.getActive() + '\">')].join();\n\t\tlet htmlText = '';\n\t\tanswerTypes.getValues().forEach(function(current){\n\t\t\tif (current[\"CODE\"].substring(0, 4).toUpperCase() === \"TEXT\")\n\t\t\t{\n\t\t\t\tisTextMode = isTextMode || (fieldType === current[\"ID\"]);\n\t\t\t\thtmlText += ['<option value=\"' + current[\"ID\"] + '\"' + (fieldType === current[\"ID\"] ? ' selected' : '') + '>', current[\"TITLE\"], '</option>'].join(\"\");\n\t\t\t}\n\t\t});\n\t\thtmlText = [\n\t\t\t\t'<div class=\"ui-form-block ui-form-block-html-text\">\\\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-radio ui-ctl-wa ui-ctl-xs\"> \\\n\t\t\t\t\t\t<input type=\"radio\" name=\"answer[MESSAGE_TYPE]\" ' + (data[\"MESSAGE_TYPE\"] === \"html\" ? \"\" : \"checked\" ) + ' class=\"ui-ctl-element\" value=\"text\"> \\\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">text</div> \\\n\t\t\t\t\t</label>\\\n\t\t\t\t\t<label className=\"ui-ctl ui-ctl-wa ui-ctl-xs\"><div class=\"ui-ctl-label-text\">&nbsp;/&nbsp;</div></label> \\\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-radio ui-ctl-wa ui-ctl-xs\"> \\\n\t\t\t\t\t\t<input type=\"radio\" name=\"answer[MESSAGE_TYPE]\" ' + (data[\"MESSAGE_TYPE\"] === \"html\" ? \"checked\" : \"\" ) + ' class=\"ui-ctl-element\" value=\"html\"> \\\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">html</div> \\\n\t\t\t\t\t</label>\\\n\t\t\t\t</div>\\\n\t\t\t\t<div class=\"ui-form-block\"> \\\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textarea\" id=\"answer_MESSAGE_block\">\\\n\t\t\t\t\t\t<textarea name=\"answer[MESSAGE]\" class=\"ui-ctl-element\" id=\"ANSWER_MESSAGE\" placeholder=\"' + BX.message(\"VOTE_ANSWER_PLACEHOLDER1\") + '\">'\n\t\t\t\t\t\t\t+ BX.util.htmlspecialchars(data[\"MESSAGE\"] || BX.message(\"VOTE_ANSWER_TEXT_OTHER\")) +\n\t\t\t\t\t\t'</textarea>\\\n\t\t\t\t\t</div>\\\n\t\t\t\t</div>\\\n\t\t\t\t<div class=\"ui-form-block\">\\\n\t\t\t\t\t<label for=\"id1\" class=\"ui-ctl-label-text\">' + BX.message(\"VOTE_ANSWER_FIELD_TYPE\") + '</label>\\\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown\">\\\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\\\n\t\t\t\t\t\t<select name=\"answer[FIELD_TYPE]\" class=\"ui-ctl-element\">', htmlText, '</select>\\\n\t\t\t\t\t</div>\\\n\t\t\t\t</div> '\n\t\t\t].join();\n\t\tlet editorNode = BX.create(\"DIV\", {\n\t\t\tattrs : {\n\t\t\t\tid : this.id + 'Proper',\n\t\t\t\tclassName : \"vote-edit-popup\"\n\t\t\t},\n\t\t\thtml : [\n\t\t\t\t'<div class=\"vote-edit-inp-wrap\">\\\n\t\t\t\t\t<form onsubmit=\"return false;\" id=\"', this.id , '_form\">\\\n\t\t\t\t\t\t',\n\t\t\t\t(isTextMode ? htmlText : htmlReg),\n\t\t\t\t\t'</form>\\\n\t\t\t\t</div>'].join(\"\")\n\t\t});\n\t\tconst onApply = BX.delegate(function() {\n\t\t\tconst d = BX.ajax.prepareForm(BX(this.id + '_form'));\n\t\t\tif (BX.type.isNotEmptyString(d.data.answer.MESSAGE))\n\t\t\t{\n\t\t\t\tthis.onApply(d.data.answer);\n\t\t\t\tthis.popup.fired = true;\n\t\t\t\tthis.popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.addClass(BX('answer_MESSAGE_block'), 'ui-ctl-danger');\n\t\t\t}\n\t\t}, this);\n\n\t\tthis.popup = BX.PopupWindowManager.create(\n\t\t\t'popup' + this.id,\n\t\t\tnull,\n\t\t\t{\n\t\t\t\ttitleBar: BX.message(\"VOTE_ANSWER_MESSAGE\"),\n\t\t\t\tclassName : \"vote-answer\",\n\t\t\t\tautoHide : false,\n\t\t\t\tlightShadow : true,\n\t\t\t\tcloseIcon : true,\n\t\t\t\tcloseByEsc : true,\n\t\t\t\tzIndex : 1,\n\t\t\t\tcontent : editorNode,\n\t\t\t\toverlay : {},\n\t\t\t\tevents : {\n\t\t\t\t\tonPopupShow : BX.delegate(function() {\n\n\t\t\t\t\t}, this),\n\t\t\t\t\tonPopupClose : BX.delegate(\n\t\t\t\t\t\tfunction(){\n\t\t\t\t\t\t\tif (this.popup.fired !== true)\n\t\t\t\t\t\t\t\tBX.onCustomEvent(this, \"onCancel\", [this]);\n\t\t\t\t\t\t\tthis.popup.destroy();\n\t\t\t\t\t\t\tthis.popup = null;\n\t\t\t\t\t\t}, this\n\t\t\t\t\t),\n\t\t\t\t\tonAfterPopupShow : BX.defer(function() {\n\t\t\t\t\t\tif (BX(this.id + '_form'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tBX.focus(BX(this.id + '_form').elements[\"ANSWER_MESSAGE\"]);\n\t\t\t\t\t\t\tBX.bind(BX(this.id + '_form').elements[\"ANSWER_MESSAGE\"], \"keydown\", BX.proxy(function(e){\n\t\t\t\t\t\t\t\tif ((e.ctrlKey === true || e.altKey === true) && e.keyCode === 13)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tonApply();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, this));\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this)\n\t\t\t\t},\n\t\t\t\tbuttons : [\n\t\t\t\t\tnew BX.PopupWindowButton(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext : BX.message(\"VOTE_SAVE\"),\n\t\t\t\t\t\t\tclassName : \"\",\n\t\t\t\t\t\t\tevents : {\n\t\t\t\t\t\t\t\tclick : onApply\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t),\n\t\t\t\t\tnew BX.PopupWindowButton(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext : BX.message(\"VOTE_CANCEL\"),\n\t\t\t\t\t\t\tclassName : \"\",\n\t\t\t\t\t\t\tevents : { click : BX.delegate(function(){\n\t\t\t\t\t\t\t\tthis.onCancel();\n\t\t\t\t\t\t\t\tthis.popup.fired = true;\n\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t}, this) } } )\n\t\t\t\t]\n\t\t\t}\n\t\t);\n\t\tthis.popup.show();\n\t\tthis.popup.adjustPosition();\n\t}\n}\n\nBX.Vote.addTextAnswer = function(gridInstanceId) { initEditor(gridInstanceId, 0, {FIELD_TYPE : 4}); };\nBX.Vote.addAnswer = function(gridInstanceId, answerData) { initEditor(gridInstanceId, 0, answerData); };\nBX.Vote.editAnswer = function(gridInstanceId, rowId) {\n\tconst grid = BX.Main.gridManager.getInstanceById(answerPopupParams[gridInstanceId][\"gridId\"]);\n\tlet data = (grid !== null ? grid.getRows().getById(rowId).getEditData() : {});\n\tinitEditor(gridInstanceId, rowId, data);\n};\nBX.Vote.setTypes = function(types) {\n\tquestionTypes.setTypes(types.questionTypes);\n\tanswerTypes.setTypes(types.answerTypes);\n};\nBX.Vote.setParams = function(gridInstanceId, params) {\n\tBX.defer(function(){\n\t\tbindForm(params['formId'], params.gridId, gridInstanceId);\n\t\tBX.bind(document, \"keydown\", function(e) {\n\t\t\tif (e.keyCode === 45 &&\n\t\t\t\t(e.ctrlKey === false && e.metaKey === false && e.altKey === false) &&\n\t\t\t\t(!BX(e.target) || BX(e.target).tagName === 'BODY'))\n\t\t\t{\n\t\t\t\tBX.Vote.addAnswer(gridInstanceId, {});\n\t\t\t}\n\t\t});\n\t})();\n\tanswerPopupParams[gridInstanceId] = {\n\t\tgridInstanceId : gridInstanceId,\n\t\tgridId : params.gridId,\n\t\tmaxSort : (params[\"maxSort\"] || 100)\n\t};\n};\n\nlet answerPopup = null;\nlet answerPopupParams = {};\nconst initEditor = function(gridInstanceId, id, data) {\n\tif (answerPopup === null)\n\t{\n\t\tanswerPopup = new answerEditor();\n\t\tBX.addCustomEvent(\n\t\t\tanswerPopup,\n\t\t\t\"onApply\",\n\t\t\tfunction(answerId, data, gridData)\n\t\t\t{\n\t\t\t\tconst gridId = gridData[\"gridId\"];\n\t\t\t\tconst grid = BX.Main.gridManager.getInstanceById(gridId);\n\t\t\t\tif (grid instanceof BX.Main.grid)\n\t\t\t\t{\n\t\t\t\t\tlet newRowData = BX.clone(data);\n\t\t\t\t\tif (answerId !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tgrid.updateRow(answerId, newRowData, null, function(){});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tanswerPopupParams[gridData[\"gridInstanceId\"]][\"maxSort\"] += 100;\n\t\t\t\t\t\tnewRowData[\"C_SORT\"] = answerPopupParams[gridData[\"gridInstanceId\"]][\"maxSort\"];\n\t\t\t\t\t\tgrid.addRow(newRowData, null, function(){});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\tanswerPopup.\n\t\tsetGridData(answerPopupParams[gridInstanceId]).\n\t\tsetAnswer(id, data).\n\t\tshow();\n};\nBX.addCustomEvent(\n\twindow,\n\t\"Grid::beforeRequest\",\n\tfunction(gridData, args)\n\t{\n\t\tlet i;\n\t\tfor (i in answerPopupParams)\n\t\t{\n\t\t\tif (answerPopupParams.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (answerPopupParams[i][\"gridId\"] === args.gridId)\n\t\t\t\t{\n\t\t\t\t\targs.data.gridId = args.gridId;\n\t\t\t\t\targs.data.gridInstanceId = answerPopupParams[i][\"gridInstanceId\"];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\nconst bindForm = function(formId, gridId, gridInstanceId) {\n\tlet form = BX(formId, true);\n\tlet controlName = \"save\";\n\tlet func = (function(event) {\n\t\tBX.unbind(form, \"submit\", func);\n\t\tlet grid = BX.Main.gridManager.getInstanceById(gridId);\n\t\tif (!grid.getRows().hasEditable())\n\t\t{\n\t\t\tprepareForm(form, gridId, gridInstanceId);\n\t\t\treturn true;\n\t\t}\n\t\tlet func1 = (function(someGrid) { if (someGrid === grid) {\n\t\t\tBX.removeCustomEvent(window, \"Grid::updated\", func1);\n\t\t\tform.appendChild(BX.create(\"INPUT\", { \"props\": { \"type\": \"hidden\", \"name\": controlName, \"value\":  \"Y\" } } ));\n\t\t\tprepareForm(form, gridId, gridInstanceId);\n\t\t\tform.submit();\n\t\t} });\n\t\tBX.addCustomEvent(window, \"Grid::updated\", func1);\n\t\tgrid.editSelectedSave();\n\t\treturn BX.PreventDefault(event);\n\t});\n\n\tBX.bind(form, \"submit\", func);\n\tif (form.elements[\"apply\"])\n\t{\n\t\tBX.bind(form.elements[\"apply\"], \"mousedown\", function () { controlName = \"apply\"; });\n\t}\n\n\tconst f = function(e) {\n\t\tconst el = e.target;\n\t\tconst rows = BX.Main.gridManager.getInstanceById(gridId).getRows();\n\t\tif (!questionTypes.isCompatibilityMode() && rows)\n\t\t{\n\t\t\tlet ids = [];\n\t\t\trows.getRows().forEach(function(current){\n\t\t\t\tconst attrs = BX.parseJSON(BX.data(current.getNode(), \"item\"), current);\n\t\t\t\tif (attrs &&\n\t\t\t\t\tBX.type.isPlainObject(attrs) &&\n\t\t\t\t\tattrs.hasOwnProperty(\"field_type\") &&\n\t\t\t\t\tString(attrs[\"field_type\"]) !== String(el.value) &&\n\t\t\t\t\t!answerTypes.isTextType(attrs[\"field_type\"]))\n\t\t\t\t{\n\t\t\t\t\tcurrent.select();\n\t\t\t\t\tids.push(current.getId());\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (ids.length > 0)\n\t\t\t{\n\t\t\t\tBX.Main.gridManager.getInstanceById(gridId).reloadTable(\n\t\t\t\t\t\"POST\",\n\t\t\t\t\t{\n\t\t\t\t\t\tID: ids,\n\t\t\t\t\t\taction_button_grid_vote_answer: \"change_answer_type\",\n\t\t\t\t\t\tFIELD_TYPE : this.value\n\t\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\tBX.findChildren(BX(formId, true), {props: { name : 'FIELD_TYPE'}}, true).forEach(function(current) {\n\t\tBX.bind(current, 'change', f);\n\t});\n};\nconst prepareForm = function(form, gridId/*, gridInstanceId*/) {\n\tconst grid = BX.Main.gridManager.getInstanceById(gridId);\n\tif (grid)\n\t{\n\t\tconst rows = grid.getRows().getRows();\n\t\tlet attrs, id;\n\t\trows.forEach(function(current) {\n\t\t\tif (current.getIndex() < 1)\n\t\t\t\treturn;\n\t\t\tid = current.getId();\n\t\t\tform.appendChild(BX.create('INPUT', {\n\t\t\t\t\tprops : {\n\t\t\t\t\t\ttype : \"hidden\",\n\t\t\t\t\t\tname : \"ANSWER[\" + id.toLowerCase() + \"][ID]\",\n\t\t\t\t\t\tvalue : id\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t));\n\t\t\tattrs = BX.parseJSON(BX.data(current.getNode(), \"item\"), current);\n\t\t\tvar func = function(prefix, params, depth)\n\t\t\t{\n\t\t\t\tvar key;\n\t\t\t\tfor (var j in params)\n\t\t\t\t{\n\t\t\t\t\tif (params.hasOwnProperty(j))\n\t\t\t\t\t{\n\t\t\t\t\t\tkey = \"[\" + (depth > 0 ? j : String(j).toUpperCase()) + \"]\";\n\t\t\t\t\t\tif (BX.type.isPlainObject(params[j]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfunc(prefix + key, params[j], depth + 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tform.appendChild(BX.create('INPUT', {\n\t\t\t\t\t\t\t\t\tprops : {\n\t\t\t\t\t\t\t\t\t\ttype : \"hidden\",\n\t\t\t\t\t\t\t\t\t\tname : prefix + key,\n\t\t\t\t\t\t\t\t\t\tvalue : params[j]\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (BX.type.isPlainObject(attrs))\n\t\t\t{\n\t\t\t\tfunc(\"ANSWER[\" + id + \"]\", attrs, 0);\n\t\t\t}\n\t\t});\n\t}\n};\nlet picker = null;\nBX.Vote.showColorPicker = function(input)\n{\n\tif (picker === null)\n\t{\n\t\tpicker = new BX.ColorPicker({\n\t\t\tbindElement: null,\n\t\t\tpopupOptions: {\n\t\t\t\tangle: true,\n\t\t\t}\n\t\t})\n\t}\n\tpicker.open({\n\t\tselectedColor: BX.type.isNotEmptyString(input.value) ? input.value : null,\n\t\tbindElement: input,\n\t\tonColorSelected: function (color) { input.value = color; }\n\t});\n}\n"],"names":["BX","namespace","answer","id","data","params","isNew","isSaved","MESSAGE","MESSAGE_TYPE","adjust","__apply","delegate","apply","__delete","delete","addCustomEvent","i","d","type","isPlainObject","hasOwnProperty","fromData","repo","getItem","item","entityType","values","valuesById","valuesByCode","forEach","proxy","current","push","toLowerCase","code","answerTypes","setTypes","obj","getValues","isTextType","getById","toUpperCase","substr","questionTypes","isCompatibilityMode","val","value","String","getIdByCode","getActive","answerEditor","popup","reset","debug","formData","onCustomEvent","getId","getData","gridData","gridInstanceId","gridId","maxSort","onCancel","showEditor","close","isTextMode","fieldType","htmlReg","join","message","util","htmlspecialchars","htmlText","substring","editorNode","create","attrs","className","html","onApply","ajax","prepareForm","isNotEmptyString","fired","addClass","PopupWindowManager","titleBar","autoHide","lightShadow","closeIcon","closeByEsc","zIndex","content","overlay","events","onPopupShow","onPopupClose","destroy","onAfterPopupShow","defer","focus","elements","bind","e","ctrlKey","altKey","keyCode","buttons","PopupWindowButton","text","click","show","adjustPosition","Vote","addTextAnswer","initEditor","FIELD_TYPE","addAnswer","answerData","editAnswer","rowId","grid","Main","gridManager","getInstanceById","answerPopupParams","getRows","getEditData","types","setParams","bindForm","document","metaKey","target","tagName","answerPopup","answerId","newRowData","clone","updateRow","addRow","setGridData","setAnswer","window","args","formId","form","controlName","func","event","unbind","hasEditable","func1","someGrid","removeCustomEvent","appendChild","submit","editSelectedSave","PreventDefault","f","el","rows","ids","parseJSON","getNode","select","length","reloadTable","ID","action_button_grid_vote_answer","findChildren","props","name","getIndex","prefix","depth","key","j","picker","showColorPicker","input","ColorPicker","bindElement","popupOptions","angle","open","selectedColor","onColorSelected","color"],"mappings":"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"}