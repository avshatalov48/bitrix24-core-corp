{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["/**\n * @package bitrix\n * @subpackage vote\n * @copyright 2001-2019 Bitrix\n */\nimport 'main.polyfill.core';\n\nBX.namespace('BX.Vote');\n\nclass answer {\n\tconstructor(id, data)\n\t{\n\t\tthis.id = null;\n\t\tthis.params = {\n\t\t\tisNew : true,\n\t\t\tisSaved : false\n\t\t};\n\t\tif (id > 0)\n\t\t{\n\t\t\tthis.params.isNew = false;\n\t\t\tthis.id = id;\n\t\t}\n\n\t\tthis.data =  {\n\t\t\tMESSAGE : \"\",\n\t\t\tMESSAGE_TYPE : \"text\",\n\t\t\tFIELD_TYPE : 0,\n\t\t\tFIELD_WIDTH : 0, //out of date\n\t\t\tFIELD_HEIGHT : 0, //out of date\n\t\t\tFIELD_PARAM : \"\", //out of date\n\t\t\tACTIVE : \"Y\",\n\t\t\tC_SORT : 0,\n\t\t\tCOLOR : \"\" //out of date\n\t\t};\n\n\t\tthis.adjust(data);\n\t\tthis.__apply = BX.delegate(this.apply, this);\n\t\tthis.__delete = BX.delegate(this.delete, this);\n\t\tBX.addCustomEvent(this, \"onApply\", this.__apply);\n\t\tBX.addCustomEvent(this, \"onDelete\", this.__delete);\n\t}\n\tadjust(data)\n\t{\n\t\tlet i, d = BX.type.isPlainObject(data) ? data : {};\n\t\tfor (i in this.data)\n\t\t{\n\t\t\tif (this.data.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (d[i])\n\t\t\t\t\tthis.data[i] = d[i];\n\t\t\t}\n\t\t}\n\t}\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\tgetData()\n\t{\n\t\treturn this.data;\n\t}\n\tapply(fromData)\n\t{\n\t\tthis.adjust(fromData);\n\t\treturn this;\n\t}\n\tdelete()\n\t{\n\t\treturn this;\n\t}\n}\n\nanswer.repo = {};\nanswer.getItem = function(id, data) {\n\tconst item = new answer(id, BX.type.isPlainObject(data) ? data : {});\n\tif (id > 0 && answer.repo[id])\n\t{\n\t\tanswer.repo[id] = null;\n\t\tdelete answer.repo[id];\n\t\tanswer.repo[id] = item;\n\t}\n\treturn item;\n};\n\nclass entityType {\n\tconstructor (values)\n\t{\n\t\tthis.values = [];\n\t\tthis.valuesById = {};\n\t\tthis.valuesByCode = {};\n\t\tvalues.forEach(BX.proxy(function(current) {\n\t\t\tthis.values.push(current);\n\t\t\tthis.valuesById[current[\"ID\"].toLowerCase()] = current;\n\t\t\tthis.valuesByCode[current[\"CODE\"].toLowerCase()] = current;\n\t\t}, this));\n\t}\n\tgetByCode(code)\n\t{\n\t\treturn this.valuesByCode[code];\n\t}\n\tgetById(id)\n\t{\n\t\treturn this.valuesById[id];\n\t}\n\tgetIdByCode(code)\n\t{\n\t\tif (this.valuesByCode.hasOwnProperty(code))\n\t\t{\n\t\t\treturn this.valuesByCode[code][\"ID\"];\n\t\t}\n\t\treturn null;\n\t}\n}\n\nconst answerTypes = {\n\tsetTypes : function(values) {\n\t\tanswerTypes.obj = new entityType(values);\n\t},\n\tgetValues : function() {\n\t\treturn answerTypes.obj.values;\n\t},\n\tisTextType : function(id) {\n\t\tlet item = answerTypes.obj.getById(id);\n\t\tif (BX.type.isPlainObject(item))\n\t\t{\n\t\t\treturn (item[\"CODE\"].toUpperCase().substr(0, 4) === \"TEXT\");\n\t\t}\n\t\treturn false;\n\t}\n};\nconst questionTypes = {\n\tsetTypes : function(values) {\n\t\tquestionTypes.obj = new entityType(values);\n\t},\n\tisCompatibilityMode : function() {\n\t\tlet val = BX('FIELD_TYPE').value;\n\t\treturn (String(val).toLowerCase() === questionTypes.obj.getIdByCode(\"compatibility\"));\n\t},\n\tgetActive : function() {\n\t\treturn String(BX('FIELD_TYPE').value).toUpperCase();\n\t}\n};\n\nclass answerEditor {\n\tconstructor()\n\t{\n\t\tthis.id = 'Editor';\n\t\tthis.popup = null;\n\t\tthis.reset();\n\n\t\tthis.debug = true;\n\n\t\treturn this;\n\t}\n\tonApply(formData)\n\t{\n\t\tBX.onCustomEvent(this.answer, \"onApply\", [formData]);\n\t\tBX.onCustomEvent(this, \"onApply\", [this.answer.getId(), this.answer.getData(), this.gridData]);\n\t\tthis.reset();\n\t}\n\tonCancel()\n\t{\n\t\tBX.onCustomEvent(this.answer, \"onCancel\", []);\n\t\tthis.reset();\n\t}\n\tonDelete()\n\t{\n\t\tBX.onCustomEvent(this.answer, \"onDelete\", []);\n\t\tthis.reset();\n\t}\n\tsetGridData(gridData)\n\t{\n\t\tthis.gridData = {\n\t\t\tgridInstanceId : gridData[\"gridInstanceId\"],\n\t\t\tgridId : gridData[\"gridId\"],\n\t\t\tmaxSort : gridData[\"maxSort\"],\n\t\t};\n\t\treturn this;\n\t}\n\tgetGridId()\n\t{\n\t\treturn this.gridData.gridId;\n\t}\n\tsetAnswer(id, data)\n\t{\n\t\tconst item = answer.getItem(id, data);\n\t\tif (this.answer !== null && this.answer !== item)\n\t\t\tthis.onCancel();\n\t\tthis.answer = item;\n\t\treturn this;\n\t}\n\treset()\n\t{\n\t\tdelete this.answer;\n\t\tthis.answer = null;\n\t\tdelete this.gridData;\n\t\tthis.gridData = {\n\t\t\tid : null,\n\t\t\tgridId : null,\n\t\t\tmaxSort : null\n\t\t};\n\t}\n\tshow()\n\t{\n\t\tthis.showEditor(this.answer.getData());\n\t}\n\tshowEditor(data)\n\t{\n\t\tif (this.popup !== null)\n\t\t\tthis.popup.close();\n\t\tlet isTextMode = false;\n\t\tlet fieldType = String(data[\"FIELD_TYPE\"]);\n\t\tlet htmlReg = '';\n\t\tanswerTypes.getValues().forEach(function(current){\n\t\t\thtmlReg += ['<option value=\"' + current[\"ID\"] + '\"' + (fieldType === current[\"ID\"] ? ' selected' : '') + '>', current[\"TITLE\"], '</option>'].join('');\n\t\t});\n\t\thtmlReg = [\n\t\t\t\t'<div class=\"ui-form-block ui-form-block-html-text\">\\\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-radio ui-ctl-wa ui-ctl-xs\"> \\\n\t\t\t\t\t\t<input type=\"radio\" name=\"answer[MESSAGE_TYPE]\" ' + (data[\"MESSAGE_TYPE\"] === \"html\" ? \"\" : \"checked\" ) + ' class=\"ui-ctl-element\" value=\"text\"> \\\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">text</div> \\\n\t\t\t\t\t</label>\\\n\t\t\t\t\t<label className=\"ui-ctl ui-ctl-wa ui-ctl-xs\"><div class=\"ui-ctl-label-text\">&nbsp;/&nbsp;</div></label> \\\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-radio ui-ctl-wa ui-ctl-xs\"> \\\n\t\t\t\t\t\t<input type=\"radio\" name=\"answer[MESSAGE_TYPE]\" ' + (data[\"MESSAGE_TYPE\"] === \"html\" ? \"checked\" : \"\" ) + ' class=\"ui-ctl-element\" value=\"html\"> \\\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">html</div> \\\n\t\t\t\t\t</label>\\\n\t\t\t\t</div>\\\n\t\t\t\t<div class=\"ui-form-block\">\\\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textarea\" id=\"answer_MESSAGE_block\">\\\n\t\t\t\t\t\t<textarea name=\"answer[MESSAGE]\" class=\"ui-ctl-element\" id=\"ANSWER_MESSAGE\" placeholder=\"' + BX.message(\"VOTE_ANSWER_PLACEHOLDER\") + '\">' + BX.util.htmlspecialchars(data[\"MESSAGE\"]) +'</textarea>\\\n\t\t\t\t\t</div>\\\n\t\t\t\t</div>\\\n\t\t\t\t<input id=\"answer_FIELD_TYPE\" name=\"answer[FIELD_TYPE]\" type=\"hidden\" value=\"\" class=\"ui-ctl-element\"> ' +\n\t\t\t\t(questionTypes.isCompatibilityMode() === true ?\n\t\t\t\t'<div class=\"ui-form-block\">\\\n\t\t\t\t\t<label for=\"id1\" class=\"ui-ctl-label-text\">' + BX.message(\"VOTE_ANSWER_FIELD_TYPE\") + '</label>\\\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown\">\\\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\\\n\t\t\t\t\t\t<select name=\"answer[FIELD_TYPE]\" class=\"ui-ctl-element\">' + htmlReg + '</select>\\\n\t\t\t\t\t</div>\\\n\t\t\t\t</div> ' : '<input  name=\"answer[FIELD_TYPE]\" type=\"hidden\" value=\"' + questionTypes.getActive() + '\">')].join();\n\t\tlet htmlText = '';\n\t\tanswerTypes.getValues().forEach(function(current){\n\t\t\tif (current[\"CODE\"].substring(0, 4).toUpperCase() === \"TEXT\")\n\t\t\t{\n\t\t\t\tisTextMode = isTextMode || (fieldType === current[\"ID\"]);\n\t\t\t\thtmlText += ['<option value=\"' + current[\"ID\"] + '\"' + (fieldType === current[\"ID\"] ? ' selected' : '') + '>', current[\"TITLE\"], '</option>'].join(\"\");\n\t\t\t}\n\t\t});\n\t\thtmlText = [\n\t\t\t\t'<div class=\"ui-form-block ui-form-block-html-text\">\\\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-radio ui-ctl-wa ui-ctl-xs\"> \\\n\t\t\t\t\t\t<input type=\"radio\" name=\"answer[MESSAGE_TYPE]\" ' + (data[\"MESSAGE_TYPE\"] === \"html\" ? \"\" : \"checked\" ) + ' class=\"ui-ctl-element\" value=\"text\"> \\\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">text</div> \\\n\t\t\t\t\t</label>\\\n\t\t\t\t\t<label className=\"ui-ctl ui-ctl-wa ui-ctl-xs\"><div class=\"ui-ctl-label-text\">&nbsp;/&nbsp;</div></label> \\\n\t\t\t\t\t<label class=\"ui-ctl ui-ctl-radio ui-ctl-wa ui-ctl-xs\"> \\\n\t\t\t\t\t\t<input type=\"radio\" name=\"answer[MESSAGE_TYPE]\" ' + (data[\"MESSAGE_TYPE\"] === \"html\" ? \"checked\" : \"\" ) + ' class=\"ui-ctl-element\" value=\"html\"> \\\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">html</div> \\\n\t\t\t\t\t</label>\\\n\t\t\t\t</div>\\\n\t\t\t\t<div class=\"ui-form-block\"> \\\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textarea\" id=\"answer_MESSAGE_block\">\\\n\t\t\t\t\t\t<textarea name=\"answer[MESSAGE]\" class=\"ui-ctl-element\" id=\"ANSWER_MESSAGE\" placeholder=\"' + BX.message(\"VOTE_ANSWER_PLACEHOLDER1\") + '\">'\n\t\t\t\t\t\t\t+ BX.util.htmlspecialchars(data[\"MESSAGE\"] || BX.message(\"VOTE_ANSWER_TEXT_OTHER\")) +\n\t\t\t\t\t\t'</textarea>\\\n\t\t\t\t\t</div>\\\n\t\t\t\t</div>\\\n\t\t\t\t<div class=\"ui-form-block\">\\\n\t\t\t\t\t<label for=\"id1\" class=\"ui-ctl-label-text\">' + BX.message(\"VOTE_ANSWER_FIELD_TYPE\") + '</label>\\\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown\">\\\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\\\n\t\t\t\t\t\t<select name=\"answer[FIELD_TYPE]\" class=\"ui-ctl-element\">', htmlText, '</select>\\\n\t\t\t\t\t</div>\\\n\t\t\t\t</div> '\n\t\t\t].join();\n\t\tlet editorNode = BX.create(\"DIV\", {\n\t\t\tattrs : {\n\t\t\t\tid : this.id + 'Proper',\n\t\t\t\tclassName : \"vote-edit-popup\"\n\t\t\t},\n\t\t\thtml : [\n\t\t\t\t'<div class=\"vote-edit-inp-wrap\">\\\n\t\t\t\t\t<form onsubmit=\"return false;\" id=\"', this.id , '_form\">\\\n\t\t\t\t\t\t',\n\t\t\t\t(isTextMode ? htmlText : htmlReg),\n\t\t\t\t\t'</form>\\\n\t\t\t\t</div>'].join(\"\")\n\t\t});\n\t\tconst onApply = BX.delegate(function() {\n\t\t\tconst d = BX.ajax.prepareForm(BX(this.id + '_form'));\n\t\t\tif (BX.type.isNotEmptyString(d.data.answer.MESSAGE))\n\t\t\t{\n\t\t\t\tthis.onApply(d.data.answer);\n\t\t\t\tthis.popup.fired = true;\n\t\t\t\tthis.popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.addClass(BX('answer_MESSAGE_block'), 'ui-ctl-danger');\n\t\t\t}\n\t\t}, this);\n\n\t\tthis.popup = BX.PopupWindowManager.create(\n\t\t\t'popup' + this.id,\n\t\t\tnull,\n\t\t\t{\n\t\t\t\ttitleBar: BX.message(\"VOTE_ANSWER_MESSAGE\"),\n\t\t\t\tclassName : \"vote-answer\",\n\t\t\t\tautoHide : false,\n\t\t\t\tlightShadow : true,\n\t\t\t\tcloseIcon : true,\n\t\t\t\tcloseByEsc : true,\n\t\t\t\tzIndex : 1,\n\t\t\t\tcontent : editorNode,\n\t\t\t\toverlay : {},\n\t\t\t\tevents : {\n\t\t\t\t\tonPopupShow : BX.delegate(function() {\n\n\t\t\t\t\t}, this),\n\t\t\t\t\tonPopupClose : BX.delegate(\n\t\t\t\t\t\tfunction(){\n\t\t\t\t\t\t\tif (this.popup.fired !== true)\n\t\t\t\t\t\t\t\tBX.onCustomEvent(this, \"onCancel\", [this]);\n\t\t\t\t\t\t\tthis.popup.destroy();\n\t\t\t\t\t\t\tthis.popup = null;\n\t\t\t\t\t\t}, this\n\t\t\t\t\t),\n\t\t\t\t\tonAfterPopupShow : BX.defer(function() {\n\t\t\t\t\t\tif (BX(this.id + '_form'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tBX.focus(BX(this.id + '_form').elements[\"ANSWER_MESSAGE\"]);\n\t\t\t\t\t\t\tBX.bind(BX(this.id + '_form').elements[\"ANSWER_MESSAGE\"], \"keydown\", BX.proxy(function(e){\n\t\t\t\t\t\t\t\tif ((e.ctrlKey === true || e.altKey === true) && e.keyCode === 13)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tonApply();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, this));\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this)\n\t\t\t\t},\n\t\t\t\tbuttons : [\n\t\t\t\t\tnew BX.PopupWindowButton(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext : BX.message(\"VOTE_SAVE\"),\n\t\t\t\t\t\t\tclassName : \"\",\n\t\t\t\t\t\t\tevents : {\n\t\t\t\t\t\t\t\tclick : onApply\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t),\n\t\t\t\t\tnew BX.PopupWindowButton(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext : BX.message(\"VOTE_CANCEL\"),\n\t\t\t\t\t\t\tclassName : \"\",\n\t\t\t\t\t\t\tevents : { click : BX.delegate(function(){\n\t\t\t\t\t\t\t\tthis.onCancel();\n\t\t\t\t\t\t\t\tthis.popup.fired = true;\n\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t}, this) } } )\n\t\t\t\t]\n\t\t\t}\n\t\t);\n\t\tthis.popup.show();\n\t\tthis.popup.adjustPosition();\n\t}\n}\n\nBX.Vote.addTextAnswer = function(gridInstanceId) { initEditor(gridInstanceId, 0, {FIELD_TYPE : 4}); };\nBX.Vote.addAnswer = function(gridInstanceId, answerData) { initEditor(gridInstanceId, 0, answerData); };\nBX.Vote.editAnswer = function(gridInstanceId, rowId) {\n\tconst grid = BX.Main.gridManager.getInstanceById(answerPopupParams[gridInstanceId][\"gridId\"]);\n\tlet data = (grid !== null ? grid.getRows().getById(rowId).getEditData() : {});\n\tinitEditor(gridInstanceId, rowId, data);\n};\nBX.Vote.setTypes = function(types) {\n\tquestionTypes.setTypes(types.questionTypes);\n\tanswerTypes.setTypes(types.answerTypes);\n};\nBX.Vote.setParams = function(gridInstanceId, params) {\n\tBX.defer(function(){\n\t\tbindForm(params['formId'], params.gridId, gridInstanceId);\n\t\tBX.bind(document, \"keydown\", function(e) {\n\t\t\tif (e.keyCode === 45 &&\n\t\t\t\t(e.ctrlKey === false && e.metaKey === false && e.altKey === false) &&\n\t\t\t\t(!BX(e.target) || BX(e.target).tagName === 'BODY'))\n\t\t\t{\n\t\t\t\tBX.Vote.addAnswer(gridInstanceId, {});\n\t\t\t}\n\t\t});\n\t})();\n\tanswerPopupParams[gridInstanceId] = {\n\t\tgridInstanceId : gridInstanceId,\n\t\tgridId : params.gridId,\n\t\tmaxSort : (params[\"maxSort\"] || 100)\n\t};\n};\n\nlet answerPopup = null;\nlet answerPopupParams = {};\nconst initEditor = function(gridInstanceId, id, data) {\n\tif (answerPopup === null)\n\t{\n\t\tanswerPopup = new answerEditor();\n\t\tBX.addCustomEvent(\n\t\t\tanswerPopup,\n\t\t\t\"onApply\",\n\t\t\tfunction(answerId, data, gridData)\n\t\t\t{\n\t\t\t\tconst gridId = gridData[\"gridId\"];\n\t\t\t\tconst grid = BX.Main.gridManager.getInstanceById(gridId);\n\t\t\t\tif (grid instanceof BX.Main.grid)\n\t\t\t\t{\n\t\t\t\t\tlet newRowData = BX.clone(data);\n\t\t\t\t\tif (answerId !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tgrid.updateRow(answerId, newRowData, null, function(){});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tanswerPopupParams[gridData[\"gridInstanceId\"]][\"maxSort\"] += 100;\n\t\t\t\t\t\tnewRowData[\"C_SORT\"] = answerPopupParams[gridData[\"gridInstanceId\"]][\"maxSort\"];\n\t\t\t\t\t\tgrid.addRow(newRowData, null, function(){});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\tanswerPopup.\n\t\tsetGridData(answerPopupParams[gridInstanceId]).\n\t\tsetAnswer(id, data).\n\t\tshow();\n};\nBX.addCustomEvent(\n\twindow,\n\t\"Grid::beforeRequest\",\n\tfunction(gridData, args)\n\t{\n\t\tlet i;\n\t\tfor (i in answerPopupParams)\n\t\t{\n\t\t\tif (answerPopupParams.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (answerPopupParams[i][\"gridId\"] === args.gridId)\n\t\t\t\t{\n\t\t\t\t\targs.data.gridId = args.gridId;\n\t\t\t\t\targs.data.gridInstanceId = answerPopupParams[i][\"gridInstanceId\"];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\nconst bindForm = function(formId, gridId, gridInstanceId) {\n\tBX.bind(BX(formId, true), \"submit\", function() {\n\t\tprepareForm(BX(formId), gridId, gridInstanceId);\n\t\treturn false;\n\t});\n\tconst f = function(e) {\n\t\tconst el = e.target;\n\t\tconst rows = BX.Main.gridManager.getInstanceById(gridId).getRows();\n\t\tif (!questionTypes.isCompatibilityMode() && rows)\n\t\t{\n\t\t\tlet ids = [];\n\t\t\trows.getRows().forEach(function(current){\n\t\t\t\tconst attrs = BX.parseJSON(BX.data(current.getNode(), \"item\"), current);\n\t\t\t\tif (attrs &&\n\t\t\t\t\tBX.type.isPlainObject(attrs) &&\n\t\t\t\t\tattrs.hasOwnProperty(\"field_type\") &&\n\t\t\t\t\tString(attrs[\"field_type\"]) !== String(el.value) &&\n\t\t\t\t\t!answerTypes.isTextType(attrs[\"field_type\"]))\n\t\t\t\t{\n\t\t\t\t\tcurrent.select();\n\t\t\t\t\tids.push(current.getId());\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (ids.length > 0)\n\t\t\t{\n\t\t\t\tBX.Main.gridManager.getInstanceById(gridId).reloadTable(\n\t\t\t\t\t\"POST\",\n\t\t\t\t\t{\n\t\t\t\t\t\tID: ids,\n\t\t\t\t\t\taction_button_grid_vote_answer: \"change_answer_type\",\n\t\t\t\t\t\tFIELD_TYPE : this.value\n\t\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\tBX.findChildren(BX(formId, true), {props: { name : 'FIELD_TYPE'}}, true).forEach(function(current) {\n\t\tBX.bind(current, 'change', f);\n\t});\n};\nconst prepareForm = function(form, gridId/*, gridInstanceId*/) {\n\tconst grid = BX.Main.gridManager.getInstanceById(gridId);\n\tif (grid)\n\t{\n\t\tconst rows = grid.getRows().getRows();\n\t\tlet attrs, j, id;\n\t\trows.forEach(function(current) {\n\t\t\tif (current.getIndex() < 1)\n\t\t\t\treturn;\n\t\t\tid = current.getId();\n\t\t\tform.appendChild(BX.create('INPUT', {\n\t\t\t\t\tprops : {\n\t\t\t\t\t\ttype : \"hidden\",\n\t\t\t\t\t\tname : \"ANSWER[\" + id.toLowerCase() + \"][ID]\",\n\t\t\t\t\t\tvalue : id\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t));\n\t\t\tattrs = BX.parseJSON(BX.data(current.getNode(), \"item\"), current);\n\t\t\tif (BX.type.isPlainObject(attrs))\n\t\t\t{\n\t\t\t\tfor (j in attrs)\n\t\t\t\t{\n\t\t\t\t\tif (attrs.hasOwnProperty(j))\n\t\t\t\t\t{\n\t\t\t\t\t\tform.appendChild(BX.create('INPUT', {\n\t\t\t\t\t\t\t\tprops : {\n\t\t\t\t\t\t\t\t\ttype : \"hidden\",\n\t\t\t\t\t\t\t\t\tname : \"ANSWER[\" + id + \"][\" + String(j).toUpperCase() + \"]\",\n\t\t\t\t\t\t\t\t\tvalue : attrs[j]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\nlet picker = null;\nBX.Vote.showColorPicker = function(input)\n{\n\tif (picker === null)\n\t{\n\t\tpicker = new BX.ColorPicker({\n\t\t\tbindElement: null,\n\t\t\tpopupOptions: {\n\t\t\t\tangle: true,\n\t\t\t}\n\t\t})\n\t}\n\tpicker.open({\n\t\tselectedColor: BX.type.isNotEmptyString(input.value) ? input.value : null,\n\t\tbindElement: input,\n\t\tonColorSelected: function (color) { input.value = color; }\n\t});\n}\n"],"names":["BX","namespace","answer","id","data","params","isNew","isSaved","MESSAGE","MESSAGE_TYPE","FIELD_TYPE","FIELD_WIDTH","FIELD_HEIGHT","FIELD_PARAM","ACTIVE","C_SORT","COLOR","adjust","__apply","delegate","apply","__delete","delete","addCustomEvent","i","d","type","isPlainObject","hasOwnProperty","fromData","repo","getItem","item","entityType","values","valuesById","valuesByCode","forEach","proxy","current","push","toLowerCase","code","answerTypes","setTypes","obj","getValues","isTextType","getById","toUpperCase","substr","questionTypes","isCompatibilityMode","val","value","String","getIdByCode","getActive","answerEditor","popup","reset","debug","formData","onCustomEvent","getId","getData","gridData","gridInstanceId","gridId","maxSort","onCancel","showEditor","close","isTextMode","fieldType","htmlReg","join","message","util","htmlspecialchars","htmlText","substring","editorNode","create","attrs","className","html","onApply","ajax","prepareForm","isNotEmptyString","fired","addClass","PopupWindowManager","titleBar","autoHide","lightShadow","closeIcon","closeByEsc","zIndex","content","overlay","events","onPopupShow","onPopupClose","destroy","onAfterPopupShow","defer","focus","elements","bind","e","ctrlKey","altKey","keyCode","buttons","PopupWindowButton","text","click","show","adjustPosition","Vote","addTextAnswer","initEditor","addAnswer","answerData","editAnswer","rowId","grid","Main","gridManager","getInstanceById","answerPopupParams","getRows","getEditData","types","setParams","bindForm","document","metaKey","target","tagName","answerPopup","answerId","newRowData","clone","updateRow","addRow","setGridData","setAnswer","window","args","formId","f","el","rows","ids","parseJSON","getNode","select","length","reloadTable","ID","action_button_grid_vote_answer","findChildren","props","name","form","j","getIndex","appendChild","picker","showColorPicker","input","ColorPicker","bindElement","popupOptions","angle","open","selectedColor","onColorSelected","color"],"mappings":"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"}