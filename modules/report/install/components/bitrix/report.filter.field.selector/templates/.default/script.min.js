BX.namespace("BX.Report");if(typeof BX.Report.setSelectValue==="undefined"){BX.Report.setSelectValue=function(e,t){var i,s;var r=false;var n=!!e.getAttribute("multiple");if(!(t instanceof Array))t=[t];for(i=0;i<e.options.length;i++){for(s in t){if(e.options[i].value==t[s]){if(!r){r=true;e.selectedIndex=i}e.options[i].selected=true;break}}if(!n&&r)break}}}if(typeof BX.Report.rebuildSelect==="undefined"){BX.Report.rebuildSelect=function(e,t,i){var s,r,n,l;var a=false;var o;if(!(i instanceof Array))i=[i];if(e){o=!!e.getAttribute("multiple");while(s=e.lastChild)e.removeChild(s);for(n=0;n<t.length;n++){r=document.createElement("option");r.value=t[n]["id"];r.innerText=t[n]["title"];try{e.add(r,e.options[null])}catch(i){r=document.createElement("option");r.text=t[n]["title"];e.add(r,null)}if(!a||o){for(l=0;l<i.length;l++){if(t[n]["id"]==i[l]){r.selected=true;if(!a){a=true;e.selectedIndex=n}break}}}}}}}if(typeof BX.Report.FilterFieldSelectorManagerClass==="undefined"){BX.Report.FilterFieldSelectorManagerClass=function(){var e=function(e){this._selectors={}};e.prototype={addSelector:function(e){var t=null,i="",s="",r="";if(e["USER_TYPE_ID"])i=e["USER_TYPE_ID"];if(e["ENTITY_ID"])s=e["ENTITY_ID"];if(e["FIELD_NAME"])r=e["FIELD_NAME"];if(i&&s&&r&&(!this._selectors[s]||!this._selectors[s][r])){switch(i){case"enumeration":t=new BX.Report.EnumerationFilterFieldSelectorClass(e);if(t){if(!this._selectors[s])this._selectors[s]={};this._selectors[s][r]=t}break;case"crm":t=new BX.Report.CrmFilterFieldSelectorClass(e);if(t){if(!this._selectors[s])this._selectors[s]={};this._selectors[s][r]=t}break;case"crm_status":t=new BX.Report.CrmStatusFilterFieldSelectorClass(e);if(t){if(!this._selectors[s])this._selectors[s]={};this._selectors[s][r]=t}break;case"iblock_element":t=new BX.Report.IblockElementFilterFieldSelectorClass(e);if(t){if(!this._selectors[s])this._selectors[s]={};this._selectors[s][r]=t}break;case"iblock_section":t=new BX.Report.IblockSectionFilterFieldSelectorClass(e);if(t){if(!this._selectors[s])this._selectors[s]={};this._selectors[s][r]=t}break;case"money":t=new BX.Report.MoneyFilterFieldSelectorClass(e);if(t){if(!this._selectors[s])this._selectors[s]={};this._selectors[s][r]=t}break}}return t},getSelector:function(e,t){var i=null;if(this._selectors[e]&&this._selectors[e][t])i=this._selectors[e][t];return i}};return e}()}if(typeof BX.Report.EnumerationFilterFieldSelectorClass==="undefined"){BX.Report.EnumerationFilterFieldSelectorClass=function(){var e=function(e){this._settings=e;this.entityType=e["USER_TYPE_ID"]||"";this.entityId=e["ENTITY_ID"]||"";this.fieldName=e["FIELD_NAME"]||"";this.selectId=[];this.currentValue=[];this.ajaxUrl="/bitrix/components/bitrix/report.filter.field.selector/ajax.php";this.valuesLoading=false;this.valuesLoaded=false};e.prototype={getSetting:function(e,t){return typeof this._settings[e]!=="undefined"?this._settings[e]:t},setSetting:function(e,t){this._settings[e]=t},getMessage:function(e){var t="";if(BX.type.isString(e)&&e.length>0&&this._settings["messages"]&&this._settings["messages"][e]){t=this._settings["messages"][e]}return t},makeFilterField:function(e,t,i){var s,r,n,l;if(!this.entityType||!this.entityId||!this.fieldName||!e||!BX.type.isDomNode(e)){return null}l=this.selectId.length;n=this.entityId+"_"+this.fieldName+"["+l+"]";if(!BX.type.isString(i)||i.length<=0)i=n;r=BX.create("SPAN",{attrs:{name:"report-filter-value-control-"+n,class:"report-filter-vcc",ufSelectorIndex:l.toString()},children:[s=BX.create("SELECT",{attrs:{id:n,class:"reports-filter-select-small",name:i+"[]",multiple:"multiple",size:this.getSetting("LIST_HEIGHT",3),style:"width: 225px;"}})]});if(s)BX.Report.rebuildSelect(s,this.getSetting("ITEMS"),"");if(BX.type.isDomNode(t)&&t.parentNode===e)e.insertBefore(r,t);else e.appendChild(r);this.selectId.push(n);if(!this.valuesLoaded&&!this.valuesLoading){this.startLoadValues()}return r},getFilterValue:function(e){var t,i,s,r,n=BX(this.selectId[e]),l="";if(n){if(n.tagName==="SELECT"&&n.getAttribute("multiple")==="multiple"){t=n.options;s=[];r=0;for(i=0;i<t.length;i++){if(t[i].selected)s[r++]=t[i].value}l=s.length>0?s:""}else{l=n.value}}return l},setFilterValue:function(e,t){this.currentValue[e]=t;if(this.valuesLoaded){var i=BX(this.selectId[e]);if(i)BX.Report.setSelectValue(i,t)}},startLoadValues:function(){this.valuesLoading=true;BX.ajax({url:BX.util.add_url_param(this.ajaxUrl,{sessid:BX.bitrix_sessid(),action:"LoadEnumerationValues"}),method:"POST",dataType:"json",data:{entityId:this.entityId,fieldName:this.fieldName},onsuccess:BX.delegate(this.onLoadValues,this)})},onLoadValues:function(e){if(BX.type.isPlainObject(e)&&e.hasOwnProperty("status")&&e["status"]==="success"&&e.hasOwnProperty("ITEMS")&&BX.type.isArray(e["ITEMS"])){var t,i,s;var r=this.getSetting("ITEMS",[]);if(BX.type.isArray(r)&&r.hasOwnProperty(0)&&r[0].hasOwnProperty("id")&&r[0].hasOwnProperty("title")&&r[0]["id"]===""){e["ITEMS"].unshift(r[0]);this.setSetting("ITEMS",e["ITEMS"]);for(t=0;t<this.selectId.length;t++){i=BX(this.selectId[t]);if(i){s="";if(this.currentValue.hasOwnProperty(t)){s=this.currentValue[t]}BX.Report.rebuildSelect(i,this.getSetting("ITEMS"),s)}}}}this.valuesLoaded=true;this.valuesLoading=false}};return e}()}if(typeof BX.Report.CrmFilterFieldSelectorClass==="undefined"){BX.Report.CrmFilterFieldSelectorClass=function(){var e=function(e){this._settings=e;this.entityType=e["USER_TYPE_ID"]||"";this.entityId=e["ENTITY_ID"]||"";this.fieldName=e["FIELD_NAME"]||"";this.crmId=[];this.crmName=[];this.ajaxUrl="/bitrix/components/bitrix/report.filter.field.selector/ajax.php";this.searchResultHandlerStub=function(){};this.searchHandler=function(e,t,i){if(!t||!BX.Type.isFunction(t)){t=this.searchResultHandlerStub}if(!i||!BX.Type.isFunction(i)){i=this.searchResultHandlerStub}BX.ajax({url:BX.util.add_url_param(this.ajaxUrl,{sessid:BX.bitrix_sessid(),action:"CrmElementSearch"}),method:"POST",dataType:"json",data:e,onsuccess:t,onfailure:i})}.bind(this)};e.prototype={getSetting:function(e,t){return typeof this._settings[e]!=="undefined"?this._settings[e]:t},getMessage:function(e){var t="";if(BX.type.isString(e)&&e.length>0&&this._settings["messages"]&&this._settings["messages"][e]){t=this._settings["messages"][e]}return t},makeFilterField:function(e,t,i){var s,r,n,l,a;if(!this.entityType||!this.entityId||!this.fieldName||!e||!BX.type.isDomNode(e)){return null}a=this.crmId.length;l=this.entityId+"_"+this.fieldName+"["+a+"]";s=BX.create("A",{attrs:{id:"crm-"+l+"-open",class:"report-select-popup-link",style:"cursor: pointer;",href:""},text:this.getMessage("choice")});r=BX.create("SPAN",{attrs:{id:"crm-"+l+"-box",name:"report-filter-value-control-crm",ufSelectorIndex:a.toString()},children:[BX.create("DIV",{attrs:{class:"crm-button-open"},children:[s]})]});if(BX.type.isDomNode(t)&&t.parentNode===e)e.insertBefore(r,t);else e.appendChild(r);if(!BX.type.isString(i)||i.length<=0)i=l;n=CRM.Set(s,i,"",this.getSetting("ELEMENT",[]),this.getSetting("PREFIX","Y")==="Y",this.getSetting("MULTIPLE","N")==="Y",this.getSetting("ENTITY_TYPE",{}),this.getSetting("MESSAGES",{}),false,{entityTypeAbbr:this.getSetting("ENTITY_TYPE_ABBR",[]),customSearchHandler:this.searchHandler});this.crmId.push(n);this.crmName.push(l);BX.bind(s,"click",BX.delegate(obCrm[n].Open,obCrm[n]));return r},getFilterValue:function(e){var t,i,s,r,n;t=[];i=this.crmId[e];s=this.crmName[e];r=BX("crm-"+i+"_"+s+"-input-box");if(r){n=BX.findChildren(r,{tag:"input",attr:{type:"text"}});if(n instanceof Array&&n.length>0){for(var l in n){if(n.hasOwnProperty(l))t.push(n[l].value)}}}switch(t.length){case 0:t="";break;case 1:t=t[0];break}return t},setFilterValue:function(e,t){var i,s,r;i=this.crmId[e];s=obCrm[i];if(s){if(BX.type.isArray(t)){for(r=0;r<t.length;r++)s.PopupSetItem(t[r])}else{s.PopupSetItem(t)}}}};return e}()}if(typeof BX.Report.CrmStatusFilterFieldSelectorClass==="undefined"){BX.Report.CrmStatusFilterFieldSelectorClass=function(){var e=function(e){this._settings=e;this.entityType=e["USER_TYPE_ID"]||"";this.entityId=e["ENTITY_ID"]||"";this.fieldName=e["FIELD_NAME"]||"";this.selectId=[]};e.prototype={getSetting:function(e,t){return typeof this._settings[e]!=="undefined"?this._settings[e]:t},getMessage:function(e){var t="";if(BX.type.isString(e)&&e.length>0&&this._settings["messages"]&&this._settings["messages"][e]){t=this._settings["messages"][e]}return t},makeFilterField:function(e,t,i){var s,r,n,l;if(!this.entityType||!this.entityId||!this.fieldName||!e||!BX.type.isDomNode(e)){return null}l=this.selectId.length;n=this.entityId+"_"+this.fieldName+"["+l+"]";if(!BX.type.isString(i)||i.length<=0)i=n;r=BX.create("SPAN",{attrs:{name:"report-filter-value-control-"+n,class:"report-filter-vcc",ufSelectorIndex:l.toString()},children:[s=BX.create("SELECT",{attrs:{id:n,class:"reports-filter-select-small",name:i+"[]",multiple:"multiple",size:this.getSetting("LIST_HEIGHT",3),style:"width: 225px;"}})]});if(s)BX.Report.rebuildSelect(s,this.getSetting("ITEMS"),"");if(BX.type.isDomNode(t)&&t.parentNode===e)e.insertBefore(r,t);else e.appendChild(r);this.selectId.push(n);return r},getFilterValue:function(e){var t,i,s,r,n=BX(this.selectId[e]),l="";if(n){if(n.tagName==="SELECT"&&n.getAttribute("multiple")==="multiple"){t=n.options;s=[];r=0;for(i=0;i<t.length;i++){if(t[i].selected)s[r++]=t[i].value}l=s.length>0?s:""}else{l=n.value}}return l},setFilterValue:function(e,t){var i=BX(this.selectId[e]);if(i)BX.Report.setSelectValue(i,t)}};return e}()}if(typeof BX.Report.IblockElementFilterFieldSelectorClass==="undefined"){BX.Report.IblockElementFilterFieldSelectorClass=function(){var e=function(e){this._settings=e;this.entityType=e["USER_TYPE_ID"]||"";this.entityId=e["ENTITY_ID"]||"";this.fieldName=e["FIELD_NAME"]||"";this.selectId=[]};e.prototype={getSetting:function(e,t){return typeof this._settings[e]!=="undefined"?this._settings[e]:t},getMessage:function(e){var t="";if(BX.type.isString(e)&&e.length>0&&this._settings["messages"]&&this._settings["messages"][e]){t=this._settings["messages"][e]}return t},makeFilterField:function(e,t,i){var s,r,n,l;if(!this.entityType||!this.entityId||!this.fieldName||!e||!BX.type.isDomNode(e)){return null}l=this.selectId.length;n=this.entityId+"_"+this.fieldName+"["+l+"]";if(!BX.type.isString(i)||i.length<=0)i=n;r=BX.create("SPAN",{attrs:{name:"report-filter-value-control-"+n,class:"report-filter-vcc",ufSelectorIndex:l.toString()},children:[s=BX.create("SELECT",{attrs:{id:n,class:"reports-filter-select-small",name:i+"[]",multiple:"multiple",size:this.getSetting("LIST_HEIGHT",3),style:"width: 225px;"}})]});if(s)BX.Report.rebuildSelect(s,this.getSetting("ITEMS"),"");if(BX.type.isDomNode(t)&&t.parentNode===e)e.insertBefore(r,t);else e.appendChild(r);this.selectId.push(n);return r},getFilterValue:function(e){var t,i,s,r,n=BX(this.selectId[e]),l="";if(n){if(n.tagName==="SELECT"&&n.getAttribute("multiple")==="multiple"){t=n.options;s=[];r=0;for(i=0;i<t.length;i++){if(t[i].selected)s[r++]=t[i].value}l=s.length>0?s:""}else{l=n.value}}return l},setFilterValue:function(e,t){var i=BX(this.selectId[e]);if(i)BX.Report.setSelectValue(i,t)}};return e}()}if(typeof BX.Report.IblockSectionFilterFieldSelectorClass==="undefined"){BX.Report.IblockSectionFilterFieldSelectorClass=function(){var e=function(e){this._settings=e;this.entityType=e["USER_TYPE_ID"]||"";this.entityId=e["ENTITY_ID"]||"";this.fieldName=e["FIELD_NAME"]||"";this.selectId=[]};e.prototype={getSetting:function(e,t){return typeof this._settings[e]!=="undefined"?this._settings[e]:t},getMessage:function(e){var t="";if(BX.type.isString(e)&&e.length>0&&this._settings["messages"]&&this._settings["messages"][e]){t=this._settings["messages"][e]}return t},makeFilterField:function(e,t,i){var s,r,n,l;if(!this.entityType||!this.entityId||!this.fieldName||!e||!BX.type.isDomNode(e)){return null}l=this.selectId.length;n=this.entityId+"_"+this.fieldName+"["+l+"]";if(!BX.type.isString(i)||i.length<=0)i=n;r=BX.create("SPAN",{attrs:{name:"report-filter-value-control-"+n,class:"report-filter-vcc",ufSelectorIndex:l.toString()},children:[s=BX.create("SELECT",{attrs:{id:n,class:"reports-filter-select-small",name:i+"[]",multiple:"multiple",size:this.getSetting("LIST_HEIGHT",3),style:"width: 225px;"}})]});if(s)BX.Report.rebuildSelect(s,this.getSetting("ITEMS"),"");if(BX.type.isDomNode(t)&&t.parentNode===e)e.insertBefore(r,t);else e.appendChild(r);this.selectId.push(n);return r},getFilterValue:function(e){var t,i,s,r,n=BX(this.selectId[e]),l="";if(n){if(n.tagName==="SELECT"&&n.getAttribute("multiple")==="multiple"){t=n.options;s=[];r=0;for(i=0;i<t.length;i++){if(t[i].selected)s[r++]=t[i].value}l=s.length>0?s:""}else{l=n.value}}return l},setFilterValue:function(e,t){var i=BX(this.selectId[e]);if(i)BX.Report.setSelectValue(i,t)}};return e}()}if(typeof BX.Report.MoneyFilterFieldSelectorClass==="undefined"){BX.Report.MoneyFilterFieldSelectorClass=function(){var e=function(e){this._settings=e;this.entityType=e["USER_TYPE_ID"]||"";this.entityId=e["ENTITY_ID"]||"";this.fieldName=e["FIELD_NAME"]||"";this.currencyValue="";this.currencyList=BX.type.isArray(e["CURRENCY_LIST"])?e["CURRENCY_LIST"]:[];this.currencyValue=BX.type.isNotEmptyString(e["DEFAULT_CURRENCY_VALUE"])?e["DEFAULT_CURRENCY_VALUE"]:"";this.currencyIndex=parseInt(e["DEFAULT_CURRENCY_INDEX"]);if(BX.type.isNumber(e["DEFAULT_NUMBER_VALUE"])){this.numberValue=e["DEFAULT_NUMBER_VALUE"].toString()}else if(BX.type.isNotEmptyString(e["DEFAULT_NUMBER_VALUE"])){this.numberValue=e["DEFAULT_NUMBER_VALUE"]}else{this.numberValue=""}this.controlId=[]};e.prototype={getSetting:function(e,t){return typeof this._settings[e]!=="undefined"?this._settings[e]:t},getMessage:function(e){var t="";if(BX.type.isString(e)&&e.length>0&&this._settings["messages"]&&this._settings["messages"][e]){t=this._settings["messages"][e]}return t},makeFilterField:function(e,t,i){var s,r,n,l,a,o,c,u;if(!this.entityType||!this.entityId||!this.fieldName||!e||!BX.type.isDomNode(e)){return null}a=this.controlId.length;n=this.entityId+"_"+this.fieldName+"["+a+"]";l=BX.util.htmlspecialchars(n);if(!BX.type.isString(i)||i.length<=0)i=n;s=BX.util.htmlspecialchars(i);r=BX.create("SPAN",{attrs:{name:"report-filter-value-control-"+n,class:"report-filter-vcc",ufSelectorIndex:a.toString()},children:[BX.create("DIV",{attrs:{class:"money-editor",id:l+"_wrap"},children:[u=BX.create("INPUT",{attrs:{type:"hidden",id:l+"_value",name:s,value:BX.type.isNotEmptyString(this.numberValue)||BX.type.isNumber(this.numberValue)?BX.util.htmlspecialchars(this.numberValue+"|"+this.currencyValue):""}}),c=BX.create("INPUT",{attrs:{type:"text",tabindex:"0",id:l+"_number",value:BX.util.htmlspecialchars(this.numberValue)}}),o=BX.create("SELECT",{attrs:{tabindex:"0",id:l+"_currency",onchange:'BX.Currency.MoneyInput.get("'+BX.util.jsencode(n)+'").setCurrency(this.value)'}})]})]});BX.Report.rebuildSelect(o,this.currencyList,this.currencyValue);new BX.Currency.MoneyInput({controlId:n,input:c,resultInput:u,currency:this.currencyValue});if(BX.type.isDomNode(t)&&t.parentNode===e)e.insertBefore(r,t);else e.appendChild(r);this.controlId.push(n);return r},getFilterValue:function(e){var t,i,s,r,n=BX(this.controlId[e]+"_value"),l="";if(BX.type.isDomNode(n)){l=n.value}return l},setFilterValue:function(e,t){var i,s,r,n,l;s=this.controlId[e];l=BX.Currency.MoneyInput.get(s);if(l&&BX.type.isNotEmptyString(t)){i=t.split("|");if(BX.type.isNotEmptyString(i[0])&&BX.type.isString(i[1])){n=BX(s+"_currency");r=BX(s+"_number");if(BX.type.isDomNode(n)&&BX.type.isDomNode(r)){BX.Report.setSelectValue(n,i[1]);r.value=i[0];l.setCurrency(i[1]);l.setValue(i[0])}}}}};return e}()}
//# sourceMappingURL=script.map.js