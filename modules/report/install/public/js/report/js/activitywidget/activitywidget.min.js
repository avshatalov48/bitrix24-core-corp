(function(){"use strict";BX.namespace("BX.ActivityTileWidget");BX.ActivityTileWidget=function(t){this.container=t.renderTo;this.options=t;this.items=t.items;this.days=t.labelY;this.hours=t.labelX;this.popup=null;this.item=null;this.scaleVertical=null;this.scaleHorizontal=null;this.handlerHybridWidget=null;this.handlerHoryzontalWidget=null;this.handlerVerticalWidget=null};BX.ActivityTileWidget.prototype={getMaxActivity:function(t){var i=this.items;if(t!==undefined){i=t}var e=0;for(var a in i){if(i.hasOwnProperty(a)){i[a].active>e?e=i[a].active:null}}return e},getDayScale:function(){var t=document.createDocumentFragment();var i="reports-activity-day";var e;for(var a in this.days){if(this.days.hasOwnProperty(a)){e="";this.days[a].light?e=" reports-activity-day-light":null;t.appendChild(BX.create("div",{attrs:{className:i+e},children:[BX.create("div",{attrs:{className:"reports-activity-scale-item"},text:this.days[a].name})]}))}}return t},getHourScale:function(){var t=document.createDocumentFragment();var i="reports-activity-hour";var e;var a;for(var r in this.hours){if(this.hours.hasOwnProperty(r)){e="";a="";this.hours[r].show?a=" reports-activity-hour-show":null;this.hours[r].active?e=" reports-activity-hour-work-time":null;t.appendChild(BX.create("div",{attrs:{className:i+a+e},children:[BX.create("div",{attrs:{className:"reports-activity-scale-item"},text:this.hours[r].name===0?"0":this.hours[r].name})]}))}}return t},getActivityScale:function(){var t=document.createDocumentFragment();var i=0;for(var e=1;e<=3;e++){e===2?i=Math.round(this.getMaxActivityArray()/2):null;e===3?i=this.getMaxActivityArray():null;t.appendChild(BX.create("div",{attrs:{className:"reports-activity-active"},children:[BX.create("div",{attrs:{className:"reports-activity-scale-item"},text:i===0?"0":i})]}))}return t},getActivityDayScale:function(t){var i=document.createDocumentFragment();var e=0;for(var a=1;a<=3;a++){a===2?e=Math.round(this.getMaxActivity(this.getMaxDayActivity())/2):null;a===3?e=this.getMaxActivity(this.getMaxDayActivity()):null;i.appendChild(BX.create("div",{attrs:{className:"reports-activity-active"},children:[BX.create("div",{attrs:{className:"reports-activity-scale-item"},text:e===0?"0":e})]}))}return i},getMaxDayActivity:function(){var t=[];for(var i in this.days){if(this.days.hasOwnProperty(i)){t.push({active:this.getDayTotalActivity(this.days[i])})}}return t},getMaxHourActivity:function(){var t=[];for(var i in this.hours){if(this.days.hasOwnProperty(i)){t.push({active:this.getHourTotalActivity(this.hours[i])})}}return t},getTotalActivityGraph:function(){var t=BX.create("div",{attrs:{className:"reports-activity-table"}});for(var i in this.days){if(this.days.hasOwnProperty(i)){var e=BX.create("div",{attrs:{className:"reports-activity-table-row"}});for(var a in this.hours){if(this.hours.hasOwnProperty(a)){var r=BX.create("div",{attrs:{className:"reports-activity-table-cell"},style:{animationDelay:Math.random().toFixed(2)+"s"}});r.appendChild(this.getTotalActivityItem(this.days[i],this.hours[a]));e.appendChild(r)}}t.appendChild(e)}}return t},getTotalActivityItem:function(t,i){var e=BX.create("div",{attrs:{className:"reports-activity-table-item"}});var a=BX.create("div",{attrs:{className:"reports-activity-table-item-bind"}});e.appendChild(a);var r={};for(var s in this.items){if(this.items.hasOwnProperty(s)){if(t.id===this.items[s].labelYid&&i.id===this.items[s].labelXid){r=this.items[s];BX.style(e,"opacity",this.getOpacity(this.items[s].active));BX.bind(e,"mouseenter",function(){this.showPopup(a,r)}.bind(this));BX.bind(e,"mouseleave",this.destroyPopup.bind(this))}}}return e},showPopup:function(t,i){var e=i.labelXid-1+":00 - "+i.labelXid+":00";if(i.labelYid){e=this.days[i.labelYid-1].name}if(i.labelYid&&i.labelXid){e=this.days[i.labelYid-1].name+", "+(i.labelXid-1)+":00 - "+i.labelXid+":00"}var a=BX.create("div",{attrs:{className:"reports-activity-popup"},children:[BX.create("div",{attrs:{className:"reports-activity-popup-work-time"},text:e}),BX.create("div",{attrs:{className:"reports-activity-popup-active"},children:[BX.create("span",{attrs:{className:"reports-activity-popup-active-marker"}}),BX.create("span",{attrs:{className:"reports-activity-popup-active-value"},text:i.active}),BX.create("span",{attrs:{className:"reports-activity-popup-active-value-text"},text:BX.message("ACTIVITY_WIDGET_VALUE_COMMENT")})]})]});this.popup=new BX.PopupWindow("reports-activity-popup",t,{className:"reports-activity-popup-pointer-events",content:a,angle:{position:"bottom",offset:20},offsetTop:-9,zIndex:9999,bindOptions:{position:"top"}});this.popup.show()},destroyPopup:function(){this.popup.destroy();this.popup=null},getOpacity:function(t){var i=Math.round(100/this.getMaxActivity(this.items)*t);var e="."+i;i<=20?e=".15":null;i>20&&i<=40?e=".3":null;i>40&&i<=60?e=".5":null;i>60&&i<=80?e=".7":null;i>80&&i<=100?e=".9":null;i>100?e="1":null;return e},getHourTotalActivity:function(t){var i=0;for(var e in this.items){if(this.items.hasOwnProperty(e)){if(this.items[e].labelXid===t.id){i+=this.items[e].active}}}return i},getDayTotalActivity:function(t){var i=0;for(var e in this.items){if(this.items.hasOwnProperty(e)){if(this.items[e].labelYid===t.id){i+=this.items[e].active}}}return i},getHorizontalWidget:function(){var t=BX.create("div",{attrs:{className:"reports-activity-horizontal-widget"}});for(var i in this.hours){if(this.hours.hasOwnProperty(i)){t.appendChild(this.getHorizontalWidgetItem(this.hours[i]))}}return t},getMaxActivityArray:function(){var t=0;for(var i in this.hours){if(this.hours.hasOwnProperty(i)){t<this.getHourTotalActivity(this.hours[i])?t=this.getHourTotalActivity(this.hours[i]):null}}return t},getHorizontalWidgetItem:function(t){var i=100/this.getMaxActivityArray()*this.getHourTotalActivity(t);var e=BX.create("div",{attrs:{className:"reports-activity-horizontal-widget-item-bind"}});var a={mouseenter:function(){this.showPopup(e,{labelXid:t.id,active:this.getHourTotalActivity(t)})}.bind(this),mouseleave:this.destroyPopup.bind(this)};return BX.create("div",{attrs:{className:i===0?"reports-activity-horizontal-widget-item-empty":"reports-activity-horizontal-widget-item"},style:{maxHeight:i+"%",animationDelay:Math.random().toFixed(2)+"s"},children:[e],events:i===0?null:a})},getVerticalWidget:function(){var t=BX.create("div",{attrs:{className:"reports-activity-vertical-widget"}});for(var i in this.days){if(this.days.hasOwnProperty(i)){t.appendChild(this.getVerticalWidgetItem(this.days[i],this.getMaxActivity(this.getMaxDayActivity())))}}return t},getVerticalWidgetItem:function(t,i){var e=100/i*this.getDayTotalActivity(t);var a=BX.create("div",{attrs:{className:"reports-activity-vertical-widget-item-bind"}});var r={mouseenter:function(){this.showPopup(a,{labelYid:t.id,active:this.getDayTotalActivity(t)})}.bind(this),mouseleave:this.destroyPopup.bind(this)};return BX.create("div",{attrs:{className:e===0?"reports-activity-vertical-widget-item-empty":"reports-activity-vertical-widget-item"},style:{maxWidth:e+"%",animationDelay:Math.random().toFixed(2)+"s"},children:[a],events:e===0?null:r})},getHandler:function(){var t=BX.create("div",{attrs:{className:"reports-activity-handler"}});this.handlerHybridWidget=BX.create("div",{attrs:{className:"reports-activity-handler-item reports-activity-handler-item-active"},text:BX.message("ACTIVITY_WIDGET_DAY_AND_HOUR_TITLE"),events:{click:function(){if(this.handlerHybridWidget.classList.contains("reports-activity-handler-item-active")){return}BX.removeClass(this.handlerVerticalWidget,"reports-activity-handler-item-active");BX.removeClass(this.handlerHoryzontalWidget,"reports-activity-handler-item-active");BX.addClass(this.handlerHybridWidget,"reports-activity-handler-item-active");BX.cleanNode(this.widgetContainer);BX.cleanNode(this.scaleVertical);BX.cleanNode(this.scaleHorizontal);BX.removeClass(this.scaleVertical,"reports-activity-widget-left-reverse");this.scaleHorizontal.appendChild(this.getHourScale());this.scaleVertical.appendChild(this.getDayScale());this.widgetContainer.appendChild(this.getTotalActivityGraph())}.bind(this)}});this.handlerVerticalWidget=BX.create("div",{attrs:{className:"reports-activity-handler-item"},text:BX.message("ACTIVITY_WIDGET_HOUR_TITLE"),events:{click:function(){if(this.handlerVerticalWidget.classList.contains("reports-activity-handler-item-active")){return}BX.removeClass(this.handlerHybridWidget,"reports-activity-handler-item-active");BX.removeClass(this.handlerHoryzontalWidget,"reports-activity-handler-item-active");BX.addClass(this.handlerVerticalWidget,"reports-activity-handler-item-active");BX.cleanNode(this.widgetContainer);BX.cleanNode(this.scaleVertical);BX.cleanNode(this.scaleHorizontal);BX.addClass(this.scaleVertical,"reports-activity-widget-left-reverse");this.scaleVertical.appendChild(this.getActivityScale());this.scaleHorizontal.appendChild(this.getHourScale());this.widgetContainer.appendChild(this.getHorizontalWidget())}.bind(this)}});this.handlerHoryzontalWidget=BX.create("div",{attrs:{className:"reports-activity-handler-item"},text:BX.message("ACTIVITY_WIDGET_DAY_TITLE"),events:{click:function(){if(this.handlerHoryzontalWidget.classList.contains("reports-activity-handler-item-active")){return}BX.removeClass(this.handlerHybridWidget,"reports-activity-handler-item-active");BX.removeClass(this.handlerVerticalWidget,"reports-activity-handler-item-active");BX.addClass(this.handlerHoryzontalWidget,"reports-activity-handler-item-active");BX.cleanNode(this.widgetContainer);BX.cleanNode(this.scaleHorizontal);BX.cleanNode(this.scaleVertical);BX.removeClass(this.scaleVertical,"reports-activity-widget-left-reverse");this.scaleHorizontal.appendChild(this.getActivityDayScale());this.scaleVertical.appendChild(this.getDayScale());this.widgetContainer.appendChild(this.getVerticalWidget())}.bind(this)}});t.appendChild(this.handlerHybridWidget);t.appendChild(this.handlerVerticalWidget);t.appendChild(this.handlerHoryzontalWidget);return t},getWorkTimeBlock:function(){var t=[];for(var i in this.hours){if(this.hours.hasOwnProperty(i)){this.hours[i].active?t.push(this.hours[i].name):null}}return BX.create("div",{attrs:{className:"reports-activity-work-time"},html:BX.message("ACTIVITY_WIDGET_WORK_HOURS_TITLE")+t[0]+":00"+" - "+t[t.length-1]+":00"})},render:function(){this.container.appendChild(BX.create("div",{attrs:{className:"reports-activity"},children:[this.getHandler(),BX.create("div",{attrs:{className:"reports-activity-widget"},children:[this.scaleVertical=BX.create("div",{attrs:{className:"reports-activity-widget-left"}}),BX.create("div",{attrs:{className:"reports-activity-widget-right"},children:[this.widgetContainer=BX.create("div",{attrs:{className:"reports-activity-widget-container"}}),this.scaleHorizontal=BX.create("div",{attrs:{className:"reports-activity-widget-horizontal-scale"}})]})]}),this.getWorkTimeBlock()]}));this.scaleVertical.appendChild(this.getDayScale());this.scaleHorizontal.appendChild(this.getHourScale());this.widgetContainer.appendChild(this.getTotalActivityGraph())}}})();