var GLOBAL_BX_REPORT_USING_CHARTS=false;BX.namespace("BX.Report");if(typeof BX.Report.rebuildSelect==="undefined"){BX.Report.rebuildSelect=function(e,t,r){var l,i,n,a;var s=false;var o;if(!(r instanceof Array)){r=[r]}if(e){o=!!e.getAttribute("multiple");while(l=e.lastChild){e.removeChild(l)}for(n=0;n<t.length;n++){i=document.createElement("option");i.value=t[n]["id"];i.innerText=t[n]["title"];try{e.add(i,e.options[null])}catch(r){i=document.createElement("option");i.text=t[n]["title"];e.add(i,null)}if(!s||o){for(a=0;a<r.length;a++){if(t[n]["id"]==r[a]){i.selected=true;if(!s){s=true;e.selectedIndex=n}break}}}}}}}function OnTaskIntervalChange(e){var t=BX.findNextSibling(e,{tag:"span",className:"filter-date-interval"});var r=BX.findNextSibling(e,{tag:"span",className:"filter-day-interval"});BX.removeClass(t,"filter-date-interval-after filter-date-interval-before");BX.removeClass(r,"filter-day-interval-selected");if(e.value==="interval")BX.addClass(t,"filter-date-interval-after filter-date-interval-before");else if(e.value==="before")BX.addClass(t,"filter-date-interval-before");else if(e.value==="after")BX.addClass(t,"filter-date-interval-after");else if(e.value==="days")BX.addClass(r,"filter-day-interval-selected")}function initIntervalFilter(){BX.ready(function(){BX.prompt=function(e,t){BX.bind(e,"focus",function(){if(e.value==t){e.value="";e.style.color="#000000"}});BX.bind(e,"blur",function(){if(e.value==""){e.value=t;e.style.color="#999999"}});BX.fireEvent(e,"blur")};BX.prompt(BX("reports-new-title"),BX.message("REPORT_DEFAULT_TITLE"));BX.bind(BX("filter-date-interval-calendar-from"),"click",function(e){if(!e)e=window.event;var t=new Date;var r=Math.round(t/1e3)-t.getTimezoneOffset()*60;BX.calendar({node:this,field:BX("REPORT_INTERVAL_F_DATE_FROM"),bTime:false});BX.PreventDefault(e)});BX.bind(BX("filter-date-interval-calendar-to"),"click",function(e){if(!e)e=window.event;var t=new Date;var r=Math.round(t/1e3)-t.getTimezoneOffset()*60;BX.calendar({node:this,field:BX("REPORT_INTERVAL_F_DATE_TO"),bTime:false});BX.PreventDefault(e)});OnTaskIntervalChange(BX("task-interval-filter"))})}function show_add_filcol_popup(e,t){var r=e;if(e==null){r=this}var l=Math.random();var i=BX.PopupWindowManager.create("reports-add_col-popup"+l,r,{content:t,offsetTop:2,closeIcon:{},offsetLeft:-7});i.show();var n=BX.findChildren(t,{tagName:"span",className:"reports-add-popup-arrow"},true);if(n){for(var a=0;a<n.length;a++){BX.bind(n[a].parentNode,"click",open_close)}}}var LAST_FILCOL_CALLED=null;function show_add_col_popup(e,t){var r=e,l;if(e==null){r=this}var i=Math.random();var n=BX.PopupWindowManager.create("reports-add_col-popup"+i,r,{content:t,offsetTop:2,closeIcon:{},offsetLeft:-7,buttons:[new BX.PopupWindowButton({text:BX.message("REPORT_ADD"),className:"popup-window-button-accept",events:{click:function(){var e=BX.findChildren(t,{tag:"input",attr:{type:"checkbox"},property:"checked"},true);for(var r in e){if(!e.hasOwnProperty(r))continue;var l=e[r];addSelectColumn(l);l.checked=false;BX.toggleClass(l.parentNode.parentNode,"reports-add-popup-checked")}this.popupWindow.close(BX.MSLEFT)}}}),new BX.PopupWindowButtonLink({text:BX.message("REPORT_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){var e=BX.findChildren(t,{tag:"input",attr:{type:"checkbox"},property:"checked"},true);for(var r in e){if(!e.hasOwnProperty(r))continue;var l=e[r];l.checked=false;BX.toggleClass(l.parentNode.parentNode,"reports-add-popup-checked")}this.popupWindow.close()}}})]});n.show();var a=BX.findChildren(t,{tagName:"span",className:"reports-add-popup-checkbox-block"},true);for(l=0;l<a.length;l++){BX.bind(a[l].parentNode,"click",check_uncheck)}var s=BX.findChildren(t,{tagName:"span",className:"reports-add-popup-arrow"},true);if(s){for(l=0;l<s.length;l++){BX.bind(s[l].parentNode,"click",open_close)}}}function check_uncheck(){var e=BX.findChild(this,{tagName:"input",className:"reports-add-popup-checkbox"},true,false);if(!BX.hasClass(this,"reports-add-popup-checked")&&e.checked){e.checked=true;BX.toggleClass(this,"reports-add-popup-checked");return false}BX.toggleClass(this,"reports-add-popup-checked");e.checked=BX.toggle(e.checked,[true,false])}function open_close(){BX.toggleClass(this,"reports-add-popup-arrow-open");var e=BX.findNextSibling(this,{tagName:"div"});if(BX.hasClass(e,"reports-add-popup-it-children"))BX.toggleClass(e,"reports-child-opened")}function addSelectColumn(e,t,r,l,i,n){if(!e){return}var a;if(l!=null){a=l;if(l>GLOBAL_REPORT_SELECT_COLUMN_COUNT){GLOBAL_REPORT_SELECT_COLUMN_COUNT=l}}else{a=GLOBAL_REPORT_SELECT_COLUMN_COUNT}var s=BX.clone(BX("reports-forming-column-example"),true);var o=BX("reports-add-columns-block");var c=BX("reports-add-column-block");s.style.display="";s.setAttribute("id","");BX.addClass(s,"reports-forming-column");var d=BX.findChild(s,{className:"reports-add-col-tit-text"},true);d.innerHTML=BX.util.htmlspecialchars(e.title);if(parseInt(e.getAttribute("isUF"))===1)BX.addClass(d,"uf");var p;p=BX.findChild(s,{attr:{name:"report_select_columns[%s][name]"}},true);p.name=p.name.replace("%s",a);p.value=e.name;p.title=e.title;p=BX.findChild(s,{attr:{name:"report_select_columns[%s][alias]"}},true);p.name=p.name.replace("%s",a);if(r&&r.length>0){p.value=r;p.parentNode.style.display="inline-block"}var f=parseInt(e.getAttribute("isMultiple"))===1;if(f){p=BX.create("SELECT")}else{p=BX.clone(BX("report-select-calc-"+e.name)||BX("report-select-calc-"+e.getAttribute("fieldType")),true)}p.id="";p.name="report_select_columns["+a+"][calc]";BX.addClass(p,"reports-add-col-select");BX.addClass(p,"reports-add-col-select-calc");var u,B;u=BX.findChild(s,{className:"reports-add-col-title"});B=BX.findChild(u,{className:"reports-add-col-input"});if(t>""){BX.findChild(s,{tag:"input",attr:{type:"checkbox"}},true).checked=true;p.style.display="inline-block";p.disabled=false;setSelectValue(p,t)}u.insertBefore(p,B);if(p.options.length<1){BX.findChild(s,{tag:"input",attr:{type:"checkbox"}},true).disabled=true}var h=BX.findChild(BX.findChild(s,{tag:"span",className:"reports-grouping-checkbox"}),{tag:"input",attr:{type:"checkbox"}});if(h){h.name="report_select_columns["+a+"][grouping]";if(!!i){h.checked=true;GLOBAL_REPORT_GROUPING_COLUMNS_COUNT++}}var m=BX.findChild(BX.findChild(s,{tag:"span",className:"reports-grouping-subtotal-checkbox"}),{tag:"input",attr:{type:"checkbox"}});if(m){m.name="report_select_columns["+a+"][grouping_subtotal]";if(!!n)m.checked=true}var b=BX.clone(BX.findChild(BX("report-select-prcnt-examples"),{className:"reports-add-col-select-prcnt"}));var v=BX.clone(BX.findChild(BX("report-select-prcnt-examples"),{className:"reports-add-col-select-prcnt-by"}));b.name="report_select_columns["+a+"][prcnt]";v.name="report_select_columns["+a+"][prcnt]";u=BX.findChild(s,{className:"reports-add-col-title"});B=BX.findChild(u,{className:"reports-add-col-input"});u.insertBefore(b,B);u.insertBefore(v,B);BX.bind(b,"change",function(e){var t=s;var r=this.parentNode;var l=BX.findChild(r,{className:"reports-add-col-select-prcnt-by"});if(this.value==="self_column"){l.style.display="none"}else{l.style.display="inline-block";l.disabled=false}rebuildPercentView(t);rebuildSortSelect()});BX.bind(v,"change",function(e){rebuildSortSelect()});BX.bind(BX.findChild(s,{className:"reports-add-col-button-up"},true),"click",function(e){var t=s;var r=this.parentNode.parentNode.parentNode;var l=BX.findChildren(r,{className:"reports-forming-column"});var i=this.parentNode.parentNode;var n=null;for(var a in l){if(!l.hasOwnProperty(a))continue;if(l[a]===i){var o=l[a];if(n!=null){r.insertBefore(o,n)}}n=l[a]}rebuildPercentView(t);rebuildSortSelect()});BX.bind(BX.findChild(s,{className:"reports-add-col-button-down"},true),"click",function(e){var t=s;var r=this.parentNode.parentNode;var l=BX.findNextSibling(r,{className:r.getAttribute("class")});if(l){BX.fireEvent(BX.findChild(l,{className:"reports-add-col-button-up"},true),"click")}rebuildPercentView(t);rebuildSortSelect();return false});BX.bind(BX.findChild(s,{className:"reports-add-col-tit-prcnt"},true),"click",function(e){var t=s;var r=BX.hasClass(this,"reports-add-col-tit-prcnt-close");var l=BX.findChild(s,{className:"reports-add-col-select-prcnt"},true);var i=BX.findChild(s,{className:"reports-add-col-select-prcnt-by"},true);var n=false;if(r){disablePrcntView(s);n=true}else{var a=BX.Report.Construct.PercentViewManager.getDefault();if(a.isColumnCanBePercent(s)){l.style.display="inline-block";l.disabled=false;BX.addClass(this,"reports-add-col-tit-prcnt-close");BX.removeClass(this,"reports-add-col-tit-prcnt");if(l.value==="other_field"){l.options[1].disabled=false;i.style.display="inline-block";i.disabled=false}else{l.options[0].disabled=false}n=true}else{alert(BX.message("REPORT_PRCNT_VIEW_IS_NOT_AVAILABLE"))}}if(n){rebuildPercentView(t);rebuildSortSelect()}return false});BX.bind(BX.findChild(s,{className:"reports-add-col-tit-remove"},true),"click",function(e){var t=s;var r=this.parentNode.parentNode;var l=BX.findChild(BX.findChild(s,{tag:"span",className:"reports-grouping-checkbox"}),{tag:"input",attr:{type:"checkbox"}});BX.remove(r);rebuildPercentView();rebuildSortSelect();if(l){if(l.checked){if(--GLOBAL_REPORT_GROUPING_COLUMNS_COUNT===0)enableReportLimit(true)}}return false});BX.bind(BX.findChild(s,{className:"reports-add-col-tit-edit"},true),"click",function(e){var t=this.parentNode.parentNode;var r=BX.findChild(t,{tag:"input",attr:{type:"text"}},true);r.parentNode.style.display="inline-block";BX.focus(r);return false});BX.bind(BX.findChild(s,{tag:"input",attr:{type:"text"}},true),"blur",hideAliasInput);BX.bind(BX.findChild(s,{tag:"input",attr:{type:"text"}},true),"change",hideAliasInput);var X=BX.findChild(s,{tag:"span",className:"reports-add-col-checkbox"},true);BX.bind(BX.findChild(X,{tag:"input",attr:{type:"checkbox"}},true),"click",function(e){var t=s;var r=this.parentNode.parentNode;var l=BX.findChild(r,{className:"reports-add-col-select-calc"},true);l.style.display=this.checked?"inline-block":"none";l.disabled=!this.checked;rebuildPercentView(t);rebuildSortSelect()});BX.bind(BX.findChild(s,{className:"reports-add-col-select-calc"},true),"change",function(e){var t=s;rebuildPercentView(t);rebuildSortSelect()});if(h){BX.bind(h,"click",function(e){if(h.checked){if(++GLOBAL_REPORT_GROUPING_COLUMNS_COUNT===1)enableReportLimit(false)}else{if(--GLOBAL_REPORT_GROUPING_COLUMNS_COUNT===0)enableReportLimit(true)}})}o.insertBefore(s,c);rebuildPercentView(s);rebuildSortSelect();GLOBAL_REPORT_SELECT_COLUMN_COUNT++}function hideAliasInput(e){var t=this.parentNode.parentNode.parentNode;if(BX.util.trim(this.value)==""){this.value="";BX.hide(this.parentNode)}rebuildPercentView();rebuildSortSelect()}function rebuildSortSelect(){var e=BX("reports-sort-select");var t=e.value;var r=null,l;var i=[];var n=[];while(e.options.length>0){e.remove(0)}if(GLOBAL_BX_REPORT_USING_CHARTS){var a=BX("report-chart-config");i=chartGetYColTypes();if(a){r=BX.findChildren(a,{tag:"select",className:"report-chart-select-col"},true);for(l in r){if(r.hasOwnProperty(l)){n[l]=r[l].value;while(r[l].options.length>0)r[l].remove(0)}}}}var s=[];var o=BX.findChildren(BX("reports-add-columns-block"),{tag:"input",attr:{type:"hidden"}},true);var c=0;for(l in o){if(!o.hasOwnProperty(l))continue;if(o[l].value!=""){var d=o[l].parentNode;var p=o[l].name.match(/report_select_columns\[(\d+)\]\[name\]/);var f=p[1];var u,B;u=null;B=parseSelectColumnInfo(d);if(GLOBAL_BX_REPORT_USING_CHARTS){u=getFullColumnTitle(d);var h,m,b,v;var X=BX("report-chart-type");if(r){for(var C in r){if(!r.hasOwnProperty(C))continue;if(c===0)r[C].selectedIndex=0;h=new Option(u,f);b=B.column_type;h.setAttribute("data_type",B.column_type);v=true;if(X){v=false;m=X.value;if(i[m])v=!B.ismultiple&&i[m].indexOf(B.column_type)>=0}if(r[C].name==="chart_x"||v){try{r[C].add(h,null)}catch(e){r[C].add(h)}if(n[C]==f){r[C].selectedIndex=r[C].options.length-1}}}}c++}var g=["file","employee","crm_status","iblock_section","iblock_element","crm","money"];if(B.calc_enabled&&B.calc=="GROUP_CONCAT"||B.isuf&&(B.ismultiple||g.indexOf(B.column_type)>=0)){continue}if(u===null)u=getFullColumnTitle(d);var y=new Option(u,f);try{e.add(y,null)}catch(t){e.add(y)}if(t==f){e.selectedIndex=e.options.length-1}}}rebuildReportPreviewTable()}function rebuildHtmlSelect(e,t){var r=e.value;while(e.options.length>0){e.remove(0)}var l,i;for(l in t){if(!t.hasOwnProperty(l))continue;i=new Option(t[l],l);try{e.add(i,null)}catch(t){e.add(i)}if(r==l){e.selectedIndex=e.options.length-1}}}function getFullColumnTitle(e){var t="";var r=BX.findChild(e,{tag:"input",attr:{type:"hidden"},name:/report_select_columns\[\d+\]\[name\]/});var l=/\[(\d+)\]/.exec(r.name);var i=l[1];var n=BX.findChild(e,{attr:{name:"report_select_columns["+i+"][alias]"}},true);if(n.value!=""){t=n.value}else{t=r.title;var a=null;var s=BX.findChild(e,{tag:"span",className:"reports-add-col-checkbox"},true);if(s){a=BX.findChild(s,{tag:"input",attr:{type:"checkbox"},property:"checked"},true)}if(a!=null){var o=BX.findChild(e,{className:"reports-add-col-select-calc"},true);if(o.value!==""){t+=" ("+o.options[o.selectedIndex].text+")"}}var c=!!BX.findChild(e,{className:"reports-add-col-tit-prcnt-close"},true);var d=BX.findChild(e,{className:"reports-add-col-select-prcnt"},true);if(c&&!d.disabled){if(d.value==="self_column"){t+=" (%)"}else if(d.value==="other_field"){var p=BX.findChild(e,{className:"reports-add-col-select-prcnt-by"},true);if(p.selectedIndex>=0){var f=p.options[p.selectedIndex].innerHTML;t+=" ("+BX.message("REPORT_PRCNT_BUTTON_TITLE")+" "+f+")"}}}}return t}function parseSelectColumnType(e){var t,r,l;var i,n,a,s;var o,c,d;l=null;t=BX.findChild(e,{tag:"input",attr:{type:"hidden"},name:/report_select_columns\[\d+\]\[name\]/});r=BX.findChild(BX("reports-add_col-popup-cont"),{attr:{type:"checkbox",name:t.value}},true);l=r.getAttribute("fieldType");i=BX.findChild(e,{className:"reports-checkbox",attr:{type:"checkbox"}},true);n=i.checked;a=BX.findChild(e,{className:"reports-add-col-select-calc"},true);s=null;if(a.value!="")s=a.value;o=BX.findChild(e,{className:"reports-add-col-select-prcnt"},true);d=null;if(o.disabled==false){if(o.value=="self_column")d=o.value;else{c=BX.findChild(e,{className:"reports-add-col-select-prcnt-by"},true);if(c.selectedIndex>=0)d=c.value}}if(d)l="float";else if(n){if(s=="COUNT_DISTINCT")l="integer";else if(s=="GROUP_CONCAT")l="string";else if(l=="boolean"){if(s=="MIN"||s=="AVG"||s=="MAX"||s=="SUM"||s=="COUNT_DISTINCT"){l="integer"}}}return l}function parseSelectColumnInfo(e){var t={num:null,name:null,title:null,data_type:null,calc_enabled:null,calc:null,prcnt:null,column_type:null,isgrc:null,isuf:null,ufid:null,ismultiple:null,ufname:null};var r=BX.findChild(e,{tag:"input",attr:{type:"hidden"},name:/report_select_columns\[\d+\]\[name\]/});var l=/\[(\d+)\]/.exec(r.name);t.num=l[1];t.name=r.value;var i=BX.findChild(BX("reports-add_col-popup-cont"),{attr:{type:"checkbox",name:t.name}},true);t.column_type=t.data_type=i.getAttribute("fieldType");t.title=getFullColumnTitle(e);var n=BX.findChild(e,{tag:"input",attr:{type:"checkbox"},property:"checked"},true);if(n!=null){var a=BX.findChild(e,{className:"reports-add-col-select-calc"},true);if(a.value!=""){t.calc=a.value}t.calc_enabled=n.checked}var s=BX.findChild(e,{className:"reports-add-col-select-prcnt"},true);if(s.disabled==false){if(s.value=="self_column"){t.prcnt=s.value}else{var o=BX.findChild(e,{className:"reports-add-col-select-prcnt-by"},true);if(o.selectedIndex>=0){t.prcnt=o.value}}}if(t.prcnt){t.column_type="float"}else if(t.calc_enabled){if(t.calc=="COUNT_DISTINCT"){t.column_type="integer"}else if(t.calc=="GROUP_CONCAT"){t.column_type="string"}else if(t.column_type=="boolean"){if(t.calc=="MIN"||t.calc=="AVG"||t.calc=="MAX"||t.calc=="SUM"||t.calc=="COUNT_DISTINCT"){t.column_type="integer"}}}t.isuf=parseInt(i.getAttribute("isuf"))===1;if(t.isuf){t.ufid=i.getAttribute("ufid");t.ismultiple=parseInt(i.getAttribute("ismultiple"))===1;t.ufname=i.getAttribute("ufname")}return t}function isColumnPercentable(e){var t;var r=BX.findChild(e,{attr:{name:/report_select_columns\[\d+\]\[name\]/}}).value;var l=BX.findChild(BX("reports-add_col-popup-cont"),{attr:{type:"checkbox",name:r}},true);var i=l.getAttribute("fieldType");var n=parseInt(l.getAttribute("isUF"))===1;var a=parseInt(l.getAttribute("isMultiple"))===1;var s=null;var o=BX.findChild(e,{className:"reports-add-col-select-calc"},true);if(!o.disabled){s=o.value}if(s==="GROUP_CONCAT"){t=false}else{t=(i==="integer"||i==="float")&&(!n||!a)||i==="boolean"&&s!=null||s==="COUNT_DISTINCT"}return t}BX.namespace("BX.Report.Construct");if(typeof BX.Report.Construct.PercentViewManager==="undefined"){BX.Report.Construct.PercentViewManager=function(){this._id="";this._settings={};this.context=null};BX.Report.Construct.PercentViewManager.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(4);this._settings=BX.type.isPlainObject(t)?t:{};this.context=null},getId:function(){return this._id},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getColumnContext:function(e){var t;t={el:null,elAlias:null,elButton:null,elCheckbox:null,elCalcCheckbox:null,elCalc:null,elPrcnt:null,elPrcntRel:null,elId:null,id:"",name:"",type:"",uf:false,multiple:false,aggr:false,aggrType:"",prcnt:false,modifyMap:{modified:false,rel:false,prcntByList:false,prcntVisible:false,prcntEnabled:false,prcntSelfEnabled:false,prcntByEnabled:false,prcntType:false,prcntRel:false},prcntVisible:false,prcntEnabled:false,prcntSelfEnabled:false,prcntByEnabled:false,prcntType:"",prcntRel:""};t.el=e;t.elId=BX.findChild(t.el,{attr:{name:/report_select_columns\[\d+\]\[name\]/}});match=/\[(\d+)\]/.exec(t.elId.name);t.id=match[1];t.name=t.elId.value;t.elAlias=BX.findChild(t.el,{attr:{name:"report_select_columns["+t.id+"][alias]"}},true);t.elCheckbox=BX.findChild(BX("reports-add_col-popup-cont"),{attr:{type:"checkbox",name:t.name}},true);t.type=t.elCheckbox.getAttribute("fieldType");t.uf=parseInt(t.elCheckbox.getAttribute("isUF"))===1;t.multiple=parseInt(t.elCheckbox.getAttribute("isMultiple"))===1;t.elCalcCheckbox=BX.findChild(t.el,{className:"reports-checkbox",attr:{type:"checkbox"}},true);t.elCalc=BX.findChild(t.el,{className:"reports-add-col-select-calc"},true);t.elPrcnt=BX.findChild(t.el,{className:"reports-add-col-select-prcnt"},true);t.prcntEnabled=!t.elPrcnt.disabled;if(t.prcntEnabled){t.prcntSelfEnabled=!t.elPrcnt.options[0].disabled;t.prcntByEnabled=!t.elPrcnt.options[1].disabled}t.elButton=BX.findChild(t.el,{className:"reports-add-col-tit-prcnt-close"},true);t.prcntVisible=!!t.elButton;if(!t.elButton){t.elButton=BX.findChild(t.el,{className:"reports-add-col-tit-prcnt"},true)}t.elPrcntRel=BX.findChild(t.el,{className:"reports-add-col-select-prcnt-by"},true);if(!t.elCalc.disabled){t.aggr=true;t.aggrType=t.elCalc.value}t.prcnt=this.isColumnPercentable(t);if(t.elPrcnt.value==="self_column"){t.prcntType="self"}else{t.prcntType="rel"}t.prcntRel=t.elPrcntRel.value;return t},getContext:function(e){var t,r=[],l;var i={},n={},a=[];var s,o;if(this.context===null||!!e){t=BX.findChildren(BX("reports-add-columns-block"),{className:"reports-forming-column"});for(s=0;s<t.length;s++){l=this.getColumnContext(t[s]);r[s]=l;n[l.id]=s;if(l.prcntEnabled&&l.prcntVisible&&l.prcntType==="rel"&&BX.type.isNotEmptyString(l.prcntRel)){i[l.id]=l.prcntRel}if(l.prcnt&&!l.prcntVisible){a.push(l.id)}}this.context={cols:r,rel:i,index:n,firstIndex:-1,prcntByList:a,level:0}}return this.context},isColumnPercentable:function(e){var t;if(e.aggr&&e.aggrType==="GROUP_CONCAT"){t=false}else{t=(e.type==="integer"||e.type==="float")&&(!e.uf||!e.multiple)||e.aggr&&(e.type==="boolean"||e.aggrType==="COUNT_DISTINCT")}return t},isColumnCanBePercent:function(e){var t=this.getColumnContext(e);return t.prcnt&&t.prcntEnabled&&(t.prcntSelfEnabled||t.prcntByEnabled)},getFullColumnTitle:function(e){var t="";if(BX.type.isNotEmptyString(e.elAlias.value)){t=e.elAlias.value}else{t=e.elId.title;if(e.elCalcCheckbox.checked&&BX.type.isNotEmptyString(e.elCalc.value)){t+=" ("+e.elCalc.options[e.elCalc.selectedIndex].text+")"}if(e.prcntVisible&&e.prcntEnabled){if(e.prcntType==="self"){t+=" (%)"}else{if(e.prcntRel>=0){var r=e.elPrcnt.options[e.elPrcnt.selectedIndex].innerHTML;t+=" ("+BX.message("REPORT_PRCNT_BUTTON_TITLE")+" "+r+")"}}}}return t},addToPrcntByList:function(e,t){var r,l,i,n,a,s,o;r=false;if(e.prcntByList.length<=0||e.prcntByList.indexOf(t)<0){n=-1;l=[];for(i in e.index){if(e.index.hasOwnProperty(i)){if(e.firstIndex>=0){if(e.index[i]===0){o=e.firstIndex;l[o]=i}else{o=e.index[i];if(e.index[i]<=e.firstIndex){o--}l[o]=i}}else{o=e.index[i];l[o]=i}if(i===t){n=o}}}if(n>=0){a=-1;if(n>0&&e.prcntByList.length>0){for(o=n-1;o>=0;o--){s=e.prcntByList.indexOf(l[o]);if(s>=0){a=s;break}}}if(a<0){e.prcntByList.unshift(l[n])}else{e.prcntByList.splice(a,1,e.prcntByList[a],l[n])}r=true}}return r},rebuildPercentView:function(e,t){var r,l,i,n,a,s;var o,c,d,p,f;if(!BX.type.isPlainObject(t)){t=this.getContext(true);t["level"]=0}t["level"]++;r=t["cols"];a=-1;if(t["level"]===1&&BX.type.isDomNode(e)){for(i=0;i<r.length;i++){if(r[i].el===e){a=i;break}}}if(a>=0){r.unshift(r.splice(a,1)[0]);for(i in t.index){if(t.index.hasOwnProperty(i)&&i!=="length"){if(t.index[i]===a){t.index[i]=0}else if(t.index[i]<a){t.index[i]++}}}t.firstIndex=a}for(i=0;i<r.length;i++){l=r[i];o=false;c=false;d=false;p={prcntVisible:l.prcntVisible,prcntEnabled:l.prcntEnabled,prcntType:l.prcntType,prcntSelfEnabled:l.prcntSelfEnabled,prcntByEnabled:l.prcntByEnabled,prcntRel:l.prcntRel};if(l.prcnt){if(!l.aggr||l.aggrType==="SUM"||l.aggrType==="COUNT_DISTINCT"){if(!l.prcntSelfEnabled){l.prcntSelfEnabled=true}}else{if(l.prcntSelfEnabled){l.prcntSelfEnabled=false}}s=t.prcntByList.length;if(s>0&&t.prcntByList.indexOf(l.id)>=0){s--}if(s>0){if(!l.prcntByEnabled){l.prcntByEnabled=true}}else{if(l.prcntByEnabled){l.prcntByEnabled=false}}if(l.prcntSelfEnabled||l.prcntByEnabled){if(!l.prcntEnabled){l.prcntEnabled=true}}else{if(l.prcntEnabled){l.prcntEnabled=false}}if(l.prcntType==="self"){if(!l.prcntSelfEnabled){l.prcntType="rel";l.prcntByEnabled=true}}if(l.prcntType==="rel"){if(l.prcntByEnabled&&BX.type.isNotEmptyString(l.prcntRel)){if(t.prcntByList.indexOf(l.prcntRel)<0){if(t.rel.hasOwnProperty(l.id)){delete t.rel[l.id];d=true}if(l.prcntSelfEnabled){l.prcntType="self"}else{l.prcntType="";l.modifyMap.prcntType=true;if(l.prcntRel!==""){l.prcntRel=""}}if(l.prcntVisible){l.prcntVisible=false;if(this.addToPrcntByList(t,l.id)){c=true}}}}else{if(l.prcntSelfEnabled){l.prcntType="self"}else{l.prcntType="";if(l.prcntRel!==""){l.prcntRel=""}}if(l.prcntVisible){l.prcntVisible=false;if(this.addToPrcntByList(t,l.id)){c=true}}}}if(l.prcntType!=="self"&&l.prcntType!=="rel"){if(l.prcntType!==""){l.prcntType=""}if(l.prcntVisible){l.prcntVisible=false;if(this.addToPrcntByList(t,l.id)){c=true}}}}else{if(l.prcntVisible){l.prcntVisible=false}if(l.prcntEnabled){l.prcntEnabled=false}if(l.prcntSelfEnabled){l.prcntSelfEnabled=false}if(l.prcntByEnabled){l.prcntByEnabled=false}if(l.prcntType!=="self"){l.prcntType="self"}if(BX.type.isNotEmptyString(l.prcntRel)){if(t.rel.hasOwnProperty(l.prcntRel)){delete t.rel[l.prcntRel];d=true}l.prcntRel=""}n=t.prcntByList.indexOf(l.id);if(n>=0){t.prcntByList.splice(n,1);c=true}}for(f in p){if(p.hasOwnProperty(f)){if(p[f]!==l[f]){l.modifyMap[f]=true;l.modifyMap.modified=true;o=true}}}if(d){l.modifyMap.rel=true;l.modifyMap.modified=true;o=true}if(c){l.modifyMap.prcntByList=true;l.modifyMap.modified=true;o=true}if(o){this.rebuildPercentView(null,t);break}}if(t["level"]===1){this.applyCols(t)}t["level"]--},applyCols:function(e){var t,r,l,i,n,a,s;var o,c,d;t=BX.type.isPlainObject(e)&&e.hasOwnProperty("cols")?e["cols"]:null;if(BX.type.isArray(t)){a=["prcntRel","prcntType","prcntByEnabled","prcntSelfEnabled","prcntEnabled","prcntVisible"];o=[];for(l=0;l<e.prcntByList.length;l++){n=e.prcntByList[l];o.push({id:n,title:this.getFullColumnTitle(t[e.index[n]])})}for(l=0;l<t.length;l++){r=t[l];c=[];d="";if(r.prcntByEnabled){for(i=0;i<o.length;i++){if(o[i].id!==r.id){c.push(o[i])}}if(r.prcntVisible&&r.prcntType==="rel"){d=r.elPrcntRel.value}}BX.Report.rebuildSelect(r.elPrcntRel,c,d);c=null;d=null;if(r.modifyMap.modified){for(i=0;i<a.length;i++){if(r.modifyMap[a[i]]){s=r[a[i]];switch(a[i]){case"prcntRel":if(BX.type.isNotEmptyString(s)){setSelectValue(r.elPrcntRel,s)}break;case"prcntType":setSelectValue(r.elPrcnt,s==="rel"?"other_field":"self_column");break;case"prcntSelfEnabled":r.elPrcnt.options[0].disabled=!s;break;case"prcntByEnabled":r.elPrcnt.options[1].disabled=!s;r.elPrcntRel.disabled=!s;break;case"prcntEnabled":r.elPrcnt.disabled=!s;break;case"prcntVisible":if(s){BX.removeClass(r.elButton,"reports-add-col-tit-prcnt");BX.addClass(r.elButton,"reports-add-col-tit-prcnt-close")}else{BX.removeClass(r.elButton,"reports-add-col-tit-prcnt-close");BX.addClass(r.elButton,"reports-add-col-tit-prcnt")}break}}}if(r.prcntVisible&&r.prcntEnabled){r.elPrcnt.style.display="inline-block";if(r.prcntByEnabled&&r.prcntType==="rel"){r.elPrcntRel.style.display="inline-block"}else{r.elPrcntRel.style.display="none"}}else{r.elPrcnt.style.display="none";r.elPrcntRel.style.display="none"}}}}},prepareColsToSave:function(){var e,t,r;e=this.getContext();t=BX.type.isPlainObject(e)&&e.hasOwnProperty("cols")?e["cols"]:null;for(i=0;i<t.length;i++){r=t[i];if(!r.prcntVisible){r.elPrcnt.disabled=true;r.elPrcnt.options[0].disabled=true;r.elPrcnt.options[1].disabled=true;r.elPrcntRel.disabled=true}else if(r.prcntType==="self"){r.elPrcnt.options[1].disabled=true;r.elPrcntRel.disabled=true}}},destroy:function(){this._id="";this._settings={};this.context=null}};if(typeof BX.Report.Construct.PercentViewManager.items==="undefined"){BX.Report.Construct.PercentViewManager.items={}}BX.Report.Construct.PercentViewManager.create=function(e,t){var r=new BX.Report.Construct.PercentViewManager;r.initialize(e,t);BX.Report.Construct.PercentViewManager.items[e]=r;return r};BX.Report.Construct.PercentViewManager.delete=function(e){if(BX.Report.Construct.PercentViewManager.items.hasOwnProperty(e)){BX.Report.Construct.PercentViewManager.items[e].destroy();delete BX.Report.Construct.PercentViewManager.items[e]}};BX.Report.Construct.PercentViewManager.getDefault=function(){var e;if(!BX.Report.Construct.PercentViewManager.items.hasOwnProperty("default")){BX.Report.Construct.PercentViewManager.create("default")}return BX.Report.Construct.PercentViewManager.items["default"]}}function rebuildPercentView(e){var t=BX.Report.Construct.PercentViewManager.getDefault();t.rebuildPercentView(e)}function disablePrcntView(e){var t=BX.findChild(e,{className:"reports-add-col-tit-prcnt"},true)||BX.findChild(e,{className:"reports-add-col-tit-prcnt-close"},true);var r=BX.hasClass(t,"reports-add-col-tit-prcnt-close");var l=BX.findChild(e,{className:"reports-add-col-select-prcnt"},true);var i=BX.findChild(e,{className:"reports-add-col-select-prcnt-by"},true);BX.removeClass(t,"reports-add-col-tit-prcnt-close");BX.addClass(t,"reports-add-col-tit-prcnt");l.style.display="none";l.disabled=true;i.style.display="none";i.disabled=true}function rebuildReportPreviewTable(){var e=BX.findChild(BX("reports-preview-table-report"),{tag:"table"},true);var t=BX("reports-sort-select").options;var r=BX.create("TABLE");r.cellSpacing=0;BX.addClass(r,"reports-list-table");var l=r.createTHead().insertRow(-1);var i,n,a;for(i=0;i<t.length;i++){n=t[i].innerHTML;a=BX.create("TH");if(i==0){BX.addClass(a,"reports-first-column");BX.addClass(a,"reports-head-cell-top")}else if(i==t.length-1){BX.addClass(a,"reports-last-column")}a.innerHTML='<div class="reports-head-cell">'+'<span class="reports-head-cell-title">'+n+"</span></div>";l.appendChild(a)}e.parentNode.replaceChild(r,e)}function setSelectValue(e,t){var r=false;var l,i;var n=false;var a=!!e.getAttribute("multiple");if(!(t instanceof Array))t=[t];for(l=0;l<e.options.length;l++){for(i in t){if(!t.hasOwnProperty(i))continue;if(e.options[l].value==t[i]){if(!n){n=true;e.selectedIndex=l}e.options[l].selected=true;r=true;break}}if(!a&&n)break}return r}function setPrcntView(e,t){var r=BX.findChild(BX("reports-add-columns-block"),{attr:{name:"report_select_columns["+e+"][name]"}},true).parentNode;if(BX.type.isNotEmptyString(t)){var l=BX.findChild(r,{className:"reports-add-col-tit-prcnt"},true);BX.addClass(l,"reports-add-col-tit-prcnt-close");BX.removeClass(l,"reports-add-col-tit-prcnt");var i=BX.findChild(r,{className:"reports-add-col-select-prcnt"},true);i.style.display="inline-block";i.disabled=false;if(t==="self_column"){if(i.options[0].disabled){disablePrcntView(r)}}else{if(i.options[1].disabled){disablePrcntView(r)}else{var n=BX.findChild(r,{className:"reports-add-col-select-prcnt-by"},true);n.style.display="inline-block";n.disabled=false;setSelectValue(i,"other_field");if(!setSelectValue(n,t)){disablePrcntView(r)}}}rebuildPercentView(r);rebuildSortSelect()}}function initSelectColumnButton(){BX.ready(function(){BX.bind(BX("reports-add-select-column-button"),"click",function(){show_add_col_popup(this,BX("reports-add_col-popup-cont"))})})}function addFilterColumn(e,t){var r=BX.clone(BX("reports-filter-item-example"),true);r.style.display="";r.setAttribute("id","");BX.addClass(r,"reports-filter-item");var l=e.getAttribute("level")-0+1;if(l>2){BX.addClass(r,"reports-filter-sub-lev");BX.addClass(r,"reports-filter-"+(l-1)+"-lev")}if(l==2){var i=BX.findChildren(BX("reports-filter-columns-container"));if(i){BX.show(BX("reports-filter-base-andor-selector"))}}var n=BX.findChild(r,{className:"reports-filter-item-name"},true);BX.bind(n,"click",function(e){show_add_filcol_popup(this,BX("reports-add_filcol-popup-cont"));LAST_FILCOL_CALLED=this});var a=BX.findChild(r,{className:"reports-filter-add-item"},true);BX.bind(a,"click",function(e){var t=this.parentNode.parentNode;if(t.parentNode.getAttribute("level")=="1"){BX.show(BX("reports-filter-base-andor-selector"))}var r=t.parentNode;addFilterColumn(r,t)});var s=BX.findChild(r,{className:"reports-filter-del-item"},true);BX.bind(s,"click",function(e){var t=this.parentNode.parentNode;if(t.parentNode.getAttribute("level")=="1"&&t.parentNode.childNodes.length==1){addFilterColumn(BX("reports-filter-columns-container"))}if(t.parentNode.getAttribute("level")=="1"&&t.parentNode.childNodes.length==2){BX.hide(BX("reports-filter-base-andor-selector"))}var r=BX.findChildren(t.parentNode,{tag:"div",className:"reports-filter-item"}).length;if(t.parentNode.getAttribute("level")!="1"&&r==1){var l=BX.findChild(t.parentNode,{className:"reports-filter-del-item"},true);BX.fireEvent(l,"click");return false}BX.remove(t)});var o=BX.findChild(r,{className:"reports-filter-and-or"},true);if(l>4){BX.addClass(o,"reports-filter-and-or-disable")}else{BX.bind(o,"click",function(e){var t=this.parentNode.parentNode;if(t.parentNode.getAttribute("level")=="1"){BX.show(BX("reports-filter-base-andor-selector"))}addFilterAndor(t,2)})}if(t==null){e.appendChild(r)}else{BX.insertAfter(e,r,t)}return r}function addFilterAndor(e,t){var r=BX.clone(BX("reports-filter-andor-container-example"),true);var l=e?e.parentNode:BX("reports-filter-columns-container");var i=l.getAttribute("level")-0+1;if(BX.type.isDomNode(e)&&e.tagName==="SPAN"&&BX.hasClass(e,"report-filter-stub")){BX.remove(e);e=null}if(i>4){alert("too much");return false}r.style.display="";r.setAttribute("id","");r.setAttribute("level",i);if(i>2){BX.addClass(r,"reports-filter-sub-lev");BX.addClass(r,"reports-filter-"+(i-1)+"-lev")}if(i==2){BX.show(BX("reports-filter-base-andor-selector"))}var n=BX.findChild(r,{className:"reports-filter-add-item"},true);BX.bind(n,"click",function(e){var t=this.parentNode.parentNode.parentNode;var r=t.parentNode;addFilterColumn(r,t)});var a=BX.findChild(r,{className:"reports-filter-del-item"},true);BX.bind(a,"click",function(e){var t=this.parentNode.parentNode;var r=t.parentNode;if(r.parentNode.getAttribute("level")=="1"&&r.parentNode.childNodes.length==1){return false}if(r.parentNode.getAttribute("level")=="1"&&r.parentNode.childNodes.length==2){BX.hide(BX("reports-filter-base-andor-selector"))}BX.remove(r)});var s=BX.findChild(r,{className:"reports-filter-and-or"},true);if(i>3){BX.addClass(s,"reports-filter-and-or-disable")}else{BX.bind(s,"click",function(e){var t=this.parentNode.parentNode.parentNode;addFilterAndor(t,2)})}var o=BX.findChild(r,{tag:"select"},true);BX.bind(o,"change",function(){BX.findNextSibling(this,{className:"reports-limit-res-select-lable-or"}).style.display=this.value=="OR"?"inline-block":"none";BX.findNextSibling(this,{className:"reports-limit-res-select-lable-and"}).style.display=this.value=="AND"?"inline-block":"none"});o.setAttribute("filterId",GLOBAL_REPORT_FILTER_COUNT++);BX.insertAfter(l,r,e);var c;for(c=0;c<t;c++){addFilterColumn(n.parentNode.parentNode.parentNode,n.parentNode.parentNode)}return r}function baseSelectorChangeEvent(e,t){var r=t||this;BX("reports-filter-base-andor-selector-text-or").style.display=r.value=="OR"?"inline-block":"none";BX("reports-filter-base-andor-selector-text-and").style.display=r.value=="AND"?"inline-block":"none"}function restoreSubFilter(e,t){var r=GLOBAL_PRE_FILTERS;var l=e||BX("reports-filter-columns-container");var i=e?BX.findChild(l,{className:"reports-filter-andor-item"}):BX("reports-filter-base-andor-selector");setSelectValue(BX.findChild(i,{tag:"select"}),t["LOGIC"]);var n=null;var a=null;var s;for(s in t){if(!t.hasOwnProperty(s))continue;if(s==="LOGIC"){continue}var o=t[s];if(o.type==="field"){a=addFilterColumn(l);var c=BX.findChild(BX("reports-add_filcol-popup-cont"),{attr:{type:"checkbox",name:o.name}},true);if(c){var d=BX.findChild(c.parentNode.parentNode,{className:"reports-add-popup-it-text"},true);LAST_FILCOL_CALLED=BX.findChild(a,{className:"reports-filter-item-name"},true);fillFilterColumnEvent(null,d);var p=BX.findChild(a,{attr:{name:"compare"}});setSelectValue(p,o.compare);var f=BX.findChild(a,{attr:{name:"value"}},true);if(f){if(f.getAttribute("type")==="hidden"){f=f.parentNode}switch(f.nodeName.toLowerCase()){case"input":f.value=o.value;break;case"select":setSelectValue(f,o.value);break;default:if(f.getAttribute("callback")!=null){var u=f.getAttribute("callback");var B=u+"_LAST_CALLER";var h=u+"Catch";var m=BX.findChild(f,{attr:"caller"},true);window[B]=m;window[h](o.value)}}}else{var b,v,X,C,g,y;if(BX.hasClass(a,"reports-filter-item")){b=BX.findChild(a,{className:"reports-dashed"},true);v=null;X=b&&parseInt(b.getAttribute("isUF"))===1;if(X){C=b.getAttribute("ufId");g=b.getAttribute("ufName");y=parseInt(b.getAttribute("ufSelectorIndex"));if(C&&g){if(BX.Report&&BX.Report.FilterFieldSelectorManager)v=BX.Report.FilterFieldSelectorManager.getSelector(C,g);if(v)v.setFilterValue(y,o.value)}}}}BX.findChild(a,{attr:{name:"changeable"}},true).checked=!!parseInt(o.changeable);n=a}}else if(o.type=="filter"){if(n===null){n=BX.create("SPAN",{attrs:{className:"report-filter-stub"}});l.appendChild(n)}a=addFilterAndor(n);restoreSubFilter(a,r[o.name]);n=a}}}function startSubFilterRestore(){if(GLOBAL_PRE_FILTERS!=null){var e=GLOBAL_PRE_FILTERS;restoreSubFilter(null,e[0])}else{addFilterColumn(BX("reports-filter-columns-container"))}}function setReportLimit(e,t){var r=BX("report-filter-limit-checkbox");var l=BX("report-filter-limit-input");if(arguments.length>0){r.checked=!!e;if(arguments.length===2)l.value=parseInt(t)}if(r.checked){l.disabled=false;l.style.backgroundColor="#ffffff"}else{l.disabled=true;l.style.backgroundColor="#eeeeee"}}function enableReportLimit(e){var t=BX("report-filter-limit-checkbox");var r=BX("report-filter-limit-input");t.disabled=!e;r.disabled=!e}function initFilterControls(){BX.ready(function(){BX.insertAfter=function(e,t,r){var l=null;var i=false;for(var n=0;n<=e.childNodes.length;n++){if(i){l=e.childNodes[n];break}if(e.childNodes[n]==r){i=true}}if(l!=null){e.insertBefore(t,l)}else if(i){e.appendChild(t)}return t};BX("reports-filter-columns-container").setAttribute("level",1);var e=BX.findChild(BX("reports-filter-base-andor-selector"),{tag:"select"},true);BX.bind(e,"change",baseSelectorChangeEvent);BX.bind(BX("report-filter-limit-checkbox"),"click",function(e){setReportLimit();BX.focus(BX("report-filter-limit-input"))})})}function createHiddenInput(e,t){return BX.create("input",{props:{type:"hidden",name:e,value:t}})}function parseFilterElems(e,t,r){var l=BX.findChildren(e,{tag:"div"});var i=0;var n=null,a=null;var s,o,c,d,p;var f,u,B;for(f in l){if(!l.hasOwnProperty(f))continue;u={};if(BX.hasClass(l[f],"reports-filter-item")){u.type="field";a=BX.findChild(l[f],{className:"reports-dashed"},true);u.name=a.getAttribute("fieldDefinition");if(u.name==null){continue}d=null;s=parseInt(a.getAttribute("isUF"))===1;if(s){o=a.getAttribute("ufId");c=a.getAttribute("ufName");p=parseInt(a.getAttribute("ufSelectorIndex"));if(o&&c){if(BX.Report&&BX.Report.FilterFieldSelectorManager)d=BX.Report.FilterFieldSelectorManager.getSelector(o,c)}}B=BX.findChild(l[f],{attr:{name:"compare"}},true);if(!B){continue}u.compare=B.value;n=BX.findChild(l[f],{attr:{name:"value"}},true);if(n){if(n.tagName==="SELECT"&&n.getAttribute("multiple")==="multiple"){var h=n.options;var m=[];var b=0;for(var v=0;v<h.length;v++){if(h[v].selected)m[b++]=h[v].value}u.value=m.length>0?m:""}else u.value=n.value}else if(d){u.value=d.getFilterValue(p)}u.changeable=BX.findChild(l[f],{attr:{name:"changeable"}},true).checked?"1":"0"}else if(BX.hasClass(l[f],"reports-filter-andor-container")){u.type="filter";u.name=BX.findChild(l[f],{tag:"select"},true).getAttribute("filterId");t[u.name]={};var X=BX.findChild(l[f],{className:"reports-filter-andor-item"});t[u.name]["logic"]=BX.findChild(X,{tag:"select"}).value;parseFilterElems(l[f],t,u.name)}else{continue}t[r][i++]=u}}function initSaveButton(){BX.ready(function(){BX.bind(BX("report-save-button"),"click",function(e){BX.PreventDefault(e);var t=BX.Report.Construct.PercentViewManager.getDefault();t.prepareColsToSave();var r={};var l=BX("reports-filter-columns-container");r[0]={};r[0]["logic"]=BX.findChild(BX("reports-filter-base-andor-selector"),{tag:"select"}).value;parseFilterElems(l,r,0);var i=BX("task-filter-form");var n,a,s,o;var c,d,p,f;for(n in r){if(!r.hasOwnProperty(n))continue;c=n;d=r[n];for(a in d){if(!d.hasOwnProperty(a))continue;p=d[a];if(a==="logic"){i.appendChild(createHiddenInput("filters["+n+"]["+a+"]",p))}else{for(s in p){if(!p.hasOwnProperty(s))continue;if(p[s]instanceof Array){f=p[s];for(o in f){if(f.hasOwnProperty(o)){i.appendChild(createHiddenInput("filters["+n+"]["+a+"]["+s+"]["+o+"]",f[o]))}}}else i.appendChild(createHiddenInput("filters["+n+"]["+a+"]["+s+"]",p[s]))}}}}BX("task-filter-form").submit()})})}function fillFilterColumnEvent(e,t){var r=t||this;var l,i,n,a;var s=BX.findChild(r.parentNode,{tag:"input",attr:{type:"checkbox"}},true);l=parseInt(s.getAttribute("isUF"))===1;i=s.getAttribute("fieldType");if(l){n=s.getAttribute("ufId");a=s.getAttribute("ufName")}var o=BX.findChild(LAST_FILCOL_CALLED,{className:"reports-dashed"});o.innerHTML=BX.util.htmlspecialchars(s.title);o.title=s.title;o.setAttribute("fieldDefinition",s.name);o.setAttribute("fieldType",i);if(l&&n){o.setAttribute("isUF","1");o.setAttribute("ufId",n);o.setAttribute("ufName",a)}var c=LAST_FILCOL_CALLED.parentNode;var d=BX.findChildren(c,{className:"reports-filter-column-helper"});for(var p in d){if(d.hasOwnProperty(p))BX.remove(d[p])}var f=BX.clone(BX("report-filter-compare-"+s.name)||BX("report-filter-compare-"+s.getAttribute("fieldType")),true);if(!f){return}f.id="";f.name="compare";BX.addClass(f,"reports-filter-column-helper");var u=BX.findChild(c,{className:"reports-filter-butt-wrap"});c.insertBefore(f,u);var B=null;var h=true;if(l&&(i==="enum"||i==="crm"||i==="crm_status"||i==="iblock_element"||i==="iblock_section"||i==="money")){var m=null;if(BX.Report&&BX.Report.FilterFieldSelectorManager)m=BX.Report.FilterFieldSelectorManager.getSelector(n,a);if(m){B=m.makeFilterField(c,u);if(B){h=false;var b=B.getAttribute("ufSelectorIndex");if(b.length>0)o.setAttribute("ufSelectorIndex",b)}}}if(!B){B=BX.clone(BX.findChild(BX("report-filter-value-control-examples-custom"),{attr:{name:"report-filter-value-control-"+s.name}})||BX.findChild(BX("report-filter-value-control-examples-custom"),{attr:{name:"report-filter-value-control-"+i}})||BX.findChild(BX("report-filter-value-control-examples"),{attr:{name:"report-filter-value-control-"+i}}),true)}BX.addClass(B,"reports-filter-column-helper");if(B.getAttribute("callback")!=null){var v=B.getAttribute("callback");window[v](B)}if(s.getAttribute("fieldType")=="datetime"){var X=BX.findChild(B,{tag:"img"});BX.bind(X,"click",function(e){if(!e)e=window.event;var t=BX.findChild(this.parentNode,{attr:{name:"value"}});var r=new Date;var l=Math.round(r/1e3)-r.getTimezoneOffset()*60;BX.calendar({node:this,field:t,bTime:false});BX.PreventDefault(e)})}if(h)c.insertBefore(B,u);var C=BX.findParent(r,{callback:function(e){return e.id.substr(0,21)=="reports-add_col-popup"}});var g=BX.findChild(C,{className:"popup-window-close-icon"});try{BX.fireEvent(g,"click")}catch(e){}}function initFilterPopupItems(){BX.ready(function(){var e=BX.findChildren(BX("reports-add_filcol-popup-cont"),{className:"reports-add-popup-it-text"},true);var t,r,l=true;for(var i in e){if(!e.hasOwnProperty(i))continue;if(BX.hasClass(e[i].parentNode,"reports-add-popup-it-node")){continue}l=true;t=BX.findChild(e[i].parentNode,{tag:"input",attr:{type:"checkbox"}},true);if(t){r=BX.clone(BX("report-filter-compare-"+t.name)||BX("report-filter-compare-"+t.getAttribute("fieldType")),true);if(r){l=false;BX.bind(e[i],"click",fillFilterColumnEvent)}}if(l){e[i].parentNode.style.display="none"}}})}function initReportControls(){initIntervalFilter();initSelectColumnButton();initFilterControls();initSaveButton();initFilterPopupItems()}
//# sourceMappingURL=construct.map.js