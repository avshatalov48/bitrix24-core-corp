(function(){"use strict";if(!BX.Sale)BX.Sale={};if(BX.Sale.Authorize)return;BX.Sale.Authorize={init:function(t){this.formNode=BX(t.formId);this.paysystemBlockNode=BX(t.paysystemBlockId);this.ajaxUrl=t.ajaxUrl;this.paymentId=t.paymentId;this.paySystemId=t.paySystemId;this.isAllowedSubmitting=true;this.bindEvents()},bindEvents:function(){BX.bind(this.formNode,"submit",BX.proxy(this.sendRequest,this))},sendRequest:function(t){t.preventDefault();if(!this.isAllowedSubmitting){return}var e,s=this.getAllFormData(),i=this.formNode.querySelector('input[type="submit"]'),a;if(i){i.disabled=true}this.isAllowedSubmitting=false;e={sessid:BX.bitrix_sessid(),PAYMENT_ID:this.paymentId,PAYSYSTEM_ID:this.paySystemId};for(a in s){if(s.hasOwnProperty(a)){e[a]=s[a]}}BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:e,onsuccess:BX.proxy(function(t){if(t.status==="success"){this.isAllowedSubmitting=true;this.updateTemplateHtml(t.template)}else if(t.status==="error"){this.isAllowedSubmitting=true;this.showErrorTemplate(t.buyerErrors);BX.onCustomEvent("onPaySystemAjaxError",[t.buyerErrors])}},this)})},getAllFormData:function(){var t=BX.ajax.prepareForm(this.formNode),e;for(e in t.data){if(t.data.hasOwnProperty(e)&&e===""){delete t.data[e]}}return!!t&&t.data?t.data:{}},updateTemplateHtml:function(t){BX.html(this.paysystemBlockNode,t).then(function(){BX.onCustomEvent("onPaySystemUpdateTemplate")}.bind(this))},showErrorTemplate:function(t){var e=[BX.message("SALE_HPS_AUTHORIZE_ERROR_MESSAGE_HEADER")];if(t){for(var s in t){if(t.hasOwnProperty(s)){e.push(t[s])}}}e.push(BX.message("SALE_HPS_AUTHORIZE_ERROR_MESSAGE_FOOTER"));var i=BX.create("div",{props:{className:"alert alert-danger"},html:e.join("<br />")});this.paysystemBlockNode.innerHTML="";this.paysystemBlockNode.appendChild(i)}}})();
//# sourceMappingURL=script.map.js