{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Type, Event} from 'main.core';\nimport {EventEmitter} from \"main.core.events\";\n\nconst namespace = Reflection.namespace('BX.Sale.Component');\n\nclass RegistrationRobokassa\n{\n\t#rkReg = true;\n\n\t#originUrl = 'https://reg.robokassa.ru';\n\t#url = 'https://reg.robokassa.ru/form_register_merch_bitrix.php';\n\n\t#robokassaWindow = null;\n\t#button = null;\n\n\t#siteUrl = '';\n\t#resultUrl = '';\n\t#successUrl = '';\n\t#failUrl = '';\n\t#callbackUrl = '';\n\n\tconstructor(options: {\n\t\tbuttonId: string,\n\t\tsiteUrl: string,\n\t\tresultUrl: string,\n\t\tsuccessUrl: string,\n\t\tfailUrl: string,\n\t\tcallbackUrl: string,\n\t})\n\t{\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.#siteUrl = options.siteUrl;\n\t\t\tthis.#resultUrl = options.resultUrl;\n\t\t\tthis.#successUrl = options.successUrl;\n\t\t\tthis.#failUrl = options.failUrl;\n\t\t\tthis.#callbackUrl = options.callbackUrl;\n\n\t\t\tthis.#button = BX(options.buttonId);\n\t\t}\n\t}\n\n\trun()\n\t{\n\t\tRegistrationRobokassa.#subscribeToEvent();\n\n\t\tEvent.ready(() => {\n\t\t\twindow.addEventListener('message', event => {\n\t\t\t\tif (\n\t\t\t\t\tevent.origin === this.#originUrl\n\t\t\t\t\t&& event.data.rk_reg_ready === true\n\t\t\t\t\t&& this.#robokassaWindow\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.#sendData(this.#robokassaWindow);\n\t\t\t\t}\n\t\t\t}, false);\n\n\n\t\t\tif (this.#button)\n\t\t\t{\n\t\t\t\tthis.#button.onclick = () => this.#openForm();\n\t\t\t}\n\t\t});\n\t}\n\n\t#openForm()\n\t{\n\t\tthis.#robokassaWindow = BX.util.popup(this.#url, 800, 600);\n\t\tthis.#robokassaWindow.focus({ preventScroll: true });\n\t}\n\n\t#sendData(robokassaWindow)\n\t{\n\t\tconst data = {\n\t\t\trk_reg: this.#rkReg,\n\t\t\tsite_url: this.#siteUrl,\n\t\t\tresult_url: this.#resultUrl,\n\t\t\tsuccess_url: this.#successUrl,\n\t\t\tfail_url: this.#failUrl,\n\t\t\tcallback_url: this.#callbackUrl,\n\t\t};\n\t\trobokassaWindow.postMessage(data, '*');\n\t}\n\n\tstatic #subscribeToEvent()\n\t{\n\t\tconst inCompatMode = {compatMode: true};\n\n\t\tEventEmitter.subscribe('onPullEvent-sale', (command, params) => {\n\t\t\tif (command !== 'on_add_paysystem_settings_robokassa')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(window, 'BX.Sale.PaySystem.Registration.Robokassa:onAddSettings', params);\n\t\t}, inCompatMode);\n\t}\n}\n\nnamespace.RegistrationRobokassa = RegistrationRobokassa;"],"names":["namespace","Reflection","RegistrationRobokassa","options","Type","isPlainObject","siteUrl","resultUrl","successUrl","failUrl","callbackUrl","BX","buttonId","Event","ready","window","addEventListener","event","origin","data","rk_reg_ready","onclick","util","popup","focus","preventScroll","robokassaWindow","rk_reg","site_url","result_url","success_url","fail_url","callback_url","postMessage","inCompatMode","compatMode","EventEmitter","subscribe","command","params","emit"],"mappings":";;;;;;;;;;;;;;CAGA,IAAMA,SAAS,GAAGC,oBAAU,CAACD,SAAX,CAAqB,mBAArB,CAAlB;;;;;;;;;;;;;;;;;;;;;;;;;;KAEME;GAgBL,+BAAYC,OAAZ,EAQA;KAAA;;KAAA;;KAAA;;KAAA;OAAA;OAAA,OAtBS;;;KAsBT;OAAA;OAAA,OApBa;;;KAoBb;OAAA;OAAA,OAnBO;;;KAmBP;OAAA;OAAA,OAjBmB;;;KAiBnB;OAAA;OAAA,OAhBU;;;KAgBV;OAAA;OAAA,OAdW;;;KAcX;OAAA;OAAA,OAba;;;KAab;OAAA;OAAA,OAZc;;;KAYd;OAAA;OAAA,OAXW;;;KAWX;OAAA;OAAA,OAVe;;;KAWd,IAAIC,cAAI,CAACC,aAAL,CAAmBF,OAAnB,CAAJ,EACA;OACC,kDAAgBA,OAAO,CAACG,OAAxB;OACA,oDAAkBH,OAAO,CAACI,SAA1B;OACA,qDAAmBJ,OAAO,CAACK,UAA3B;OACA,kDAAgBL,OAAO,CAACM,OAAxB;OACA,sDAAoBN,OAAO,CAACO,WAA5B;OAEA,iDAAeC,EAAE,CAACR,OAAO,CAACS,QAAT,CAAjB;;;;;;2BAKF;OAAA;;OACC,6BAAAV,qBAAqB,EAvCjBA,qBAuCiB,oBAArB,MAAAA,qBAAqB;;OAErBW,eAAK,CAACC,KAAN,CAAY,YAAM;SACjBC,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmC,UAAAC,KAAK,EAAI;WAC3C,IACCA,KAAK,CAACC,MAAN,uCAAiB,KAAjB,iBACGD,KAAK,CAACE,IAAN,CAAWC,YAAX,KAA4B,IAD/B,sCAEG,KAFH,mBADD,EAKA;aACC,4BAAI,wBAAJ,WAAI,oCAAW,KAAX,oBAAJ;;UAPF,EASG,KATH;;SAYA,sCAAI,KAAJ,YACA;WACC,uCAAI,UAAJ,CAAaC,OAAb,GAAuB;aAAA,8BAAM,KAAN,8BAAM,KAAN;YAAvB;;QAfF;;;;;;uBAqBD;GACC,0DAAwBV,EAAE,CAACW,IAAH,CAAQC,KAAR,mCAAc,IAAd,SAAyB,GAAzB,EAA8B,GAA9B,CAAxB;GACA,0DAAsBC,KAAtB,CAA4B;KAAEC,aAAa,EAAE;IAA7C;CACA;;qBAESC,iBACV;GACC,IAAMP,IAAI,GAAG;KACZQ,MAAM,oCAAE,IAAF,SADM;KAEZC,QAAQ,oCAAE,IAAF,WAFI;KAGZC,UAAU,oCAAE,IAAF,aAHE;KAIZC,WAAW,oCAAE,IAAF,cAJC;KAKZC,QAAQ,oCAAE,IAAF,WALI;KAMZC,YAAY,oCAAE,IAAF;IANb;GAQAN,eAAe,CAACO,WAAhB,CAA4Bd,IAA5B,EAAkC,GAAlC;CACA;;8BAGD;GACC,IAAMe,YAAY,GAAG;KAACC,UAAU,EAAE;IAAlC;GAEAC,6BAAY,CAACC,SAAb,CAAuB,kBAAvB,EAA2C,UAACC,OAAD,EAAUC,MAAV,EAAqB;KAC/D,IAAID,OAAO,KAAK,qCAAhB,EACA;OACC;;;KAGDF,6BAAY,CAACI,IAAb,CAAkBzB,MAAlB,EAA0B,wDAA1B,EAAoFwB,MAApF;IAND,EAOGL,YAPH;CAQA;;CAGFlC,SAAS,CAACE,qBAAV,GAAkCA,qBAAlC;;;;"}