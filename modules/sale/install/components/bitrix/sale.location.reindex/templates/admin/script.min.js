BX.namespace("BX.Sale.component.location");if(typeof BX.Sale.component.location.reindex=="undefined"&&typeof BX.ui!="undefined"&&typeof BX.ui.widget!="undefined"){BX.Sale.component.location.reindex=function(t,e){this.parentConstruct(BX.Sale.component.location.reindex,t);BX.merge(this,{opts:{url:"/somewhere.php",ajaxFlag:"AJAX_MODE",progressWidth:500},vars:{stage:false,state:"remote",awaitInterruption:false},ctrls:{buttons:{}},sys:{code:"loc-ri"}});this.handleInitStack(e,BX.Sale.component.location.reindex,t)};BX.extend(BX.Sale.component.location.reindex,BX.ui.widget);BX.merge(BX.Sale.component.location.reindex.prototype,{init:function(){var t=this.opts,e=this.vars,s=this.ctrls,n=this;e.iterator=new BX.iterator({source:t.url,interval:100,waitAjaxOnStop:true,whenHit:function(t){n.setPercent(t.data.PERCENT);var s=t.data.NEXT_STAGE;if(BX.type.isNotEmptyString(s)&&e.stage!=t.data.NEXT_STAGE)n.setStage(t.data.NEXT_STAGE);return t.data.PERCENT<100}});e.iterator.bindEvent("set-status",function(a){if(a=="R"){s.buttons.startStop.value=t.messages.stop;n.setCSSState("running")}else if(a=="I"){s.buttons.startStop.value=t.messages.stopping;s.buttons.startStop.setAttribute("disabled","disabled");n.setStage("INTERRUPTING");e.awaitInterruption=true}else if(a=="S"){s.buttons.startStop.value=t.messages.start;n.dropCSSState("running");s.buttons.startStop.removeAttribute("disabled");n.setStage(e.awaitInterruption?"INTERRUPTED":"COMPLETE");e.awaitInterruption=false}});s.buttons.startStop=this.getControl("button-start");s.percentIndicator=this.getControl("percents",false,false,true);s.percentGrade=this.getControl("adm-progress-bar-inner");s.statusText=this.getControl("status-text");this.pushFuncStack("bindEvents",BX.Sale.component.location.reindex)},bindEvents:function(){var t=this.ctrls,e=this.vars,s=this.opts,n=this;BX.bind(t.buttons.startStop,"click",function(){if(e.iterator.getIsRunning()){e.iterator.stop()}else{var t={ACT:"REINDEX",ACT_DATA:n.getFormControlValues("option")};t[s.ajaxFlag]=1;if(n.askReindex()){n.setPercent(0);n.setStage("CLEANUP");BX.show(n.getControl("progressbar"));e.iterator.start(t)}}});var a=function(e){BX.debug(e);t.buttons.startStop.value=s.messages.start;var a=[];n.setStatusText(s.messages.error_occured,true)};e.iterator.bindEvent("server-error",a);e.iterator.bindEvent("ajax-error",a);var r=function(s,a){t.scope.className="";n.setCSSState("mode-"+s);e.state=s}},askReindex:function(){return confirm(this.opts.messages.sure_reindex)},setPercent:function(t){var e=this.ctrls,s=this.opts;t=parseInt(t);if(t<0)t=0;if(t>100)t=100;if(e.percentIndicator!=null){for(var n in e.percentIndicator){e.percentIndicator[n].innerHTML=t}}t=t*(s.progressWidth/100)-4;if(t<0)t=0;BX.style(e.percentGrade,"width",t+"px")},setStatusText:function(t,e){this.ctrls.statusText.innerHTML=BX.util.htmlspecialchars(t);BX.style(this.ctrls.statusText,"color",e?"red":"inherit")},setStage:function(t){var e=this.opts,s=this.vars;if(typeof e.messages["stage_"+t]=="undefined"){this.setStatusText(BX.util.htmlspecialchars(t),true);s.stage=false;return}this.setStatusText(this.opts.messages["stage_"+t],false);s.stage=t},getFormControlValues:function(t){var e={};var s=this.getControl(t,true,false,true);for(var n=0;n<s.length;n++){var a=s[n];if("name"in a){var r=a.name;if(!("type"in a))continue;if(a.nodeName=="INPUT"&&(a.type=="checkbox"||a.type=="radio")&&!a.checked)continue;var i="";if(a.nodeName=="SELECT"&&a.multiple){i=[];for(var o=0;o<a.length;o++){if(a[o].selected)i.push(a[o].value)}}else i=a.value;e[r]=i}}return e},setTab:function(t){BX[t=="tab_cleanup"?"hide":"show"](this.ctrls.buttons.startStop)}})}
//# sourceMappingURL=script.map.js