BX.namespace("BX.Sale.Location.Map");BX.Sale.Location.Map={ajaxUrl:"",interruptFlag:false,requestFlag:false,serviceLocationClass:"",sendRequest:function(e,a){if(!e)return;var s=e,r=this;s.sessid=BX.bitrix_sessid();this.requestFlag=true;BX.ajax({timeout:300,method:"POST",dataType:"json",url:this.ajaxUrl,data:s,onsuccess:function(e){r.requestFlag=false;if(r.interruptFlag){r.closeProgressDialog();return}if(e){if(a&&typeof a=="function")a.call(null,e)}else{r.pb.showError(BX.message("SALE_DLVRS_ADD_LOC_COMP_AJAX_ERROR"))}if(e&&e.ERROR){r.pb.showError(e.ERROR)}},onfailure:function(e){r.requestFlag=false;r.pb.showError("ajax onfailure");r.pb.showError("status: "+e);if(r.interruptFlag)r.closeProgressDialog()}})},startLocationsCompare:function(e){this.showProgressDialog();this.sendRequest({action:"locations_map","class":BX.Sale.Location.Map.serviceLocationClass,needToDeleteExist:e||false},BX.Sale.Location.Map.processLocationsCompareAnswer)},processLocationsCompareAnswer:function(e){if(!e||!e.stage||!e.action){BX.Sale.Location.Map.pb.showError(BX.message("SALE_DLVRS_ADD_LOC_COMP_AJAX_ERROR"));return}if(e.message)BX.Sale.Location.Map.pb.showMessage(e.message);if(e.progress)BX.Sale.Location.Map.pb.Update(e.progress);if(e.error){BX.Sale.Location.Map.pb.showError(e.error);return}if(e.stage&&e.stage=="finish"){BX("progress_cancel").value=BX.message("SALE_LOCATION_MAP_CLOSE");return}BX.Sale.Location.Map.sendRequest({action:e.action,stage:e.stage,step:e.step?e.step:"",progress:e.progress?e.progress:0,"class":BX.Sale.Location.Map.serviceLocationClass},BX.Sale.Location.Map.processLocationsCompareAnswer)},closeProgressDialog:function(){if(!this.interruptFlag)this.interruptFlag=true;if(this.requestFlag)return;BX.WindowManager.Get().Close();if(this.interruptFlag)this.interruptFlag=false},showProgressDialog:function(){var e=new BX.CDialog({content:BX.Sale.Location.Map.pb.getNode(),width:530,height:200,draggable:true,resizable:true,title:BX.message("SALE_LOCATION_MAP_LOC_MAPPING"),buttons:[{title:BX.message("SALE_LOCATION_MAP_CANCEL"),id:"progress_cancel",name:"progress_cancel",action:function(){window.location.reload();BX.Sale.Location.Map.closeProgressDialog()}}]});BX.Sale.Location.Map.pb.Init();e.adjustSizeEx();e.Show();BX.Sale.Location.Map.pb.showError("");BX.Sale.Location.Map.pb.showMessage(BX.message("SALE_LOCATION_MAP_PREPARING"))},pb:{width:0,obContainer:false,obIndicator:false,obIndicator2:false,Init:function(){this.obContainer=BX("install-load-block");this.obIndicator=BX("install-progress-bar-inner-text");this.obIndicator2=BX("install-progress-bar-span");this.obIndicator3=BX("install-progress-bar-inner");this.obContainer.style.display="";this.width=this.obContainer.clientWidth||this.obContainer.offsetWidth},Update:function(e){this.obIndicator.innerHTML=this.obIndicator3.style.width=e+"%";this.obIndicator2.innerHTML=e+"%"},showError:function(e){var a=BX("install-load-error");a.innerHTML=e;a.style.display=!!e?"":"none";BX.WindowManager.Get().adjustSizeEx()},showMessage:function(e,a){var s=BX("install-load-label"),r=s.innerHTML;s.innerHTML=(a?r+"<br>":"")+e;s.style.display=!!e?"":"none";BX.WindowManager.Get().adjustSizeEx()},getNode:function(){var e=BX("install-load-block");if(!e){e=BX.create("div",{props:{className:"install-load-block",id:"install-load-block"},children:[BX.create("div",{props:{className:"install-load-label",id:"install-load-label"}}),BX.create("div",{props:{className:"install-load-error",id:"install-load-error"}}),BX.create("div",{props:{className:"install-progress-bar-outer",id:"install-progress-bar-outer"},style:{width:"500px"},children:[BX.create("div",{props:{className:"install-progress-bar-alignment"},children:[BX.create("div",{props:{className:"install-progress-bar-inner",id:"install-progress-bar-inner"},style:{width:"0%"},children:[BX.create("div",{props:{className:"install-progress-bar-inner-text",id:"install-progress-bar-inner-text"},style:{width:"500px"},html:"0%"})]}),BX.create("div",{props:{className:"install-progress-bar-span",id:"install-progress-bar-span"},html:"0%"})]})]})]})}return e}}};
//# sourceMappingURL=script.map.js