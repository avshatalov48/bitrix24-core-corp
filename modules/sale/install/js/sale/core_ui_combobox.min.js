if(typeof BX.ui!="object")BX.ui={};BX.ui.combobox=function(e,t){this.parentConstruct(BX.ui.combobox,e);BX.merge(this,{opts:{pageSize:5,selectedItem:false,knownItems:[],selectByClick:true,chooseUsingArrows:true,selectOnEnter:true,openDdByAltArrow:true,closeDdByEscape:true,scrollToVariantOnArrow:true,closePopupOnOuterClick:true,messages:{nothingFound:"Sorry, nothing found",notSelected:"-- Not selected",error:"Error occured",clearSelection:"Deselect"},arrowScrollAdditional:0,pageUpWardOffset:0,wrapTagName:"span",dropdownHConstraint:0,dropdownHConstraintType:"max-height",inputDebounceTimeout:500,scrollThrottleTimeout:300,selectByClickTimeout:200,startSearchLen:2,bindEvents:{init:function(){this.setInitialValue()}}},vars:{opened:false,eventLock:false,displayPageMutex:false,keyboardMutex:false,allEventMutex:false,cache:{nodes:{},search:{origin:false}},applyFilter:false,filtered:[],lastSource:false,pager:false,selector:false,value:false,outSideClickScope:null},ctrls:{},sys:{code:"combobox"}});this.handleInitStack(t,BX.ui.combobox,e)};BX.extend(BX.ui.combobox,BX.ui.widget);BX.merge(BX.ui.combobox.prototype,{init:function(){var e=this,t=this.opts,i=this.vars,s=this.ctrls;var n=this.getControl("input",true);if(n==null)n=s.scope.querySelector('input[type="text"]');if(n==null)n=s.scope.querySelector("select");if(n==null)throw new Error("Input control still not found");s.inputs={origin:n==null?s.scope:n};i.loader=new BX.ui.loader({timeout:500});i.loader.bindEvent("toggle",BX.proxy(this.whenLoaderToggle,e));if(typeof t.knownItems=="object")this.fillCache(t.knownItems,false);this.pushFuncStack("buildUpDOM",BX.ui.combobox);this.pushFuncStack("bindEvents",BX.ui.combobox)},buildUpDOM:function(){var e=this.opts,t=this.ctrls,i=this.vars,s=this,n=this.sys.code;t.container=this.getControl("container",true);if(!BX.type.isElementNode(t.container)){t.container=BX.create("div",{props:{className:"bx-ui-"+n+"-container"},style:{margin:0,padding:0,border:"none",position:"relative"}});BX.insertAfter(t.container,t.inputs.origin)}t.inputs.fake=this.getControl("fake",true);if(!BX.type.isElementNode(t.container)){var r=BX.clone(t.inputs.origin);r.removeAttribute("name");BX.adjust(r,{props:{className:"bx-ui-"+n+"-fake"}});t.container.appendChild(r);t.inputs.fake=r}BX.hide(t.inputs.origin);if(BX.browser.IsIE8()){BX.bind(t.inputs.fake,"click",function(e){BX.eventCancelBubble(e)});BX.bind(t.container,"click",function(){t.inputs.fake.focus()})}t.toggle=this.getControl("toggle",true);if(!BX.type.isElementNode(t.toggle)){t.toggle=BX.create("div",{props:{className:"bx-ui-"+n+"-toggle"},style:{position:"absolute",top:"0px",right:"0px"}});t.container.appendChild(t.toggle)}t.dropdown=this.getControl("dropdown",true);if(!BX.type.isElementNode(t.dropdown)){t.dropdown=BX.create("div",{props:{className:"bx-ui-"+n+"-dropdown"},style:{display:"none",position:"absolute"}});t.container.appendChild(t.dropdown)}if(e.dropdownHConstraint>0&&e.dropdownHConstraintType!="")BX.style(t.dropdown,e.dropdownHConstraintType,e.dropdownHConstraint+"px");i.pager=new BX.ui.scrollablePager({scope:t.dropdown,setTopReachedOnPage:0,eventTimeout:e.scrollThrottleTimeout,parent:s});i.selector=new BX.ui.itemSelectManager;t.nothingFound=this.getControl("nothing-found",true)},bindEvents:function(){var e=this.ctrls,t=this.opts,i=this.vars,s=this,n=this.sys.code;this.bindEventsMouse();this.bindEventsKeyboard();i.pager.bindEvent("scroll-to-top",BX.semaphore(function(){if(!this.vars.opened)return;var e=i.pager.getFreePageNumber(0);if(this.checkPageIsOutOfRange(e))return;s.displayPage(e)},this,{limit:1,dup:"drop"}));i.pager.bindEvent("scroll-to-bottom",BX.semaphore(function(){if(!this.vars.opened)return;var e=i.pager.getFreePageNumber(1);if(this.checkPageIsOutOfRange(e))return;s.displayPage(e)},this,{limit:1,dup:"drop"}));i.selector.bindEvent("item-select",function(e,t){s.whenToggleItemGlow(t,true)});i.selector.bindEvent("item-deselect",function(e,t){s.whenToggleItemGlow(t,false)})},bindEventsMouse:function(){var e=this.ctrls,t=this.opts,i=this.vars,s=this,n=this.sys.code;if(t.selectByClick){BX.bindDelegate(e.dropdown,"click",{className:"bx-ui-"+n+"-variant"},function(){if(i.allEventMutex)return;var r=BX.data(this,"bx-"+n+"-item-value");var a=this;if(r==s.vars.value){s.hideDropdown();return}if(typeof r!="undefined"&&typeof i.cache.nodes[r]!="undefined"){s.vars.selector.selectById(r);s.setValue(r);if(t.focusOnMouseSelect)e.inputs.fake.focus();s.fireEvent("item-selected-by-mouse",[r,a])}else s.setValue("")})}if(t.closePopupOnOuterClick){if(i.allEventMutex)return;i.outSideClickScope=e.container;BX.bind(document,"click",function(e){e=e||window.event;if(!BX.isParentForNode(i.outSideClickScope,e.target||e.srcElement)){s.hideDropdown()}})}BX.bind(e.toggle,"click",function(){s.toggleDropDown()});if("value"in e.inputs.fake){BX.bind(e.inputs.fake,"click",function(){if(!i.opened&&i.value===false&&this.value.length>0)s.tryDisplayPage("search")})}},bindEventsKeyboard:function(){var e=this.ctrls,t=this.opts,i=this.vars,s=this;if("value"in e.inputs.fake){BX.bindDebouncedChange(e.inputs.fake,function(e){if(i.allEventMutex)return;if(e.length>=t.startSearchLen){s.tryDisplayPage("search")}else s.hideDropdown()},function(){if(i.allEventMutex)return;if(i.value!=false&&i.value!="")s.deselectItem()},t.inputDebounceTimeout,e.inputs.fake);BX.bind(e.inputs.fake,"keydown",function(n){if(i.allEventMutex)return;if(i.keyboardMutex)return;var r=n.keyCode||n.which;var a=r==38||r==40;if(t.chooseUsingArrows){if(a&&i.opened){i.selector[r==38?"selectPrevious":"selectNext"](n.shiftKey?5:1);if(t.scrollToVariantOnArrow){var o=i.selector.getSelected();if(typeof o!="undefined"){var l=o.data.node;var c=BX.pos(l,e.dropdown);var h=c.top;var u=c.height;var d=e.dropdown.clientHeight;var f=e.dropdown.scrollTop;var p=t.arrowScrollAdditional;var g=false;if(h+u>d+f)g=h+u-(d+f)+p;else if(h<f)g=-(f-h+p);if(g!=false)i.pager.scrollTo(g,false,1)}}BX.PreventDefault(n)}}if(t.openDdByAltArrow&&n.altKey&&a&&!i.opened)s.tryDisplayPage("toggle");if(t.closeDdByEscape&&r==27&&i.opened)s.hideDropdown();if(r==13&&t.selectOnEnter&&i.opened){var v=i.selector.getSelected();if(typeof v!="undefined"){if(v.id==s.vars.value){s.hideDropdown();return}s.setValue(v.id)}}if(r==13)BX.PreventDefault(n)})}},addItems2Cache:function(e){this.fillCache(e)},clearCache:function(){this.vars.cache={nodes:{},search:{origin:false}}},focus:function(){this.ctrls.inputs.fake.focus()},checkDisabled:function(){},disable:function(){},enable:function(){},setValue:function(e){this.hideDropdown();this.hideNothingFound();this.setFakeInputValue("");if(e==null||typeof e=="undefined"||e.toString().length==0){this.deselectItem();return}else if(e==this.vars.value)return;else this.setCurrentValue("");var t=this.vars,i=this.ctrls,s=this;this.discoverItems(function(){if(typeof t.cache.nodes[e]=="undefined")s.displayNothingFound();else s.selectItem(e)})},getValue:function(){return this.vars.value},clearSelected:function(){this.setValue("")},getNodeByValue:function(e){return this.vars.cache.nodes[e]},setTabIndex:function(e){this.ctrls.inputs.fake.setAttribute("tabindex",e)},setTargetInputName:function(e){this.ctrls.inputs.origin.setAttribute("name",e)},cancelRequest:function(){},setTargetInputValue:function(e){this.vars.eventLock=true;this.ctrls.inputs.origin.value=e;BX.fireEvent(this.ctrls.inputs.origin,"change");this.vars.eventLock=false},setFakeInputValue:function(e){var t=this.ctrls;if("value"in t.inputs.fake){BX.data(t.inputs.fake,"bx-dc-previous-value",e);t.inputs.fake.value=e}else{if(e=="")e=this.opts.messages.notSelected;t.inputs.fake.innerHTML=BX.util.htmlspecialchars(e)}},setValueVariable:function(e){this.vars.value=e},fillCache:function(e,t){var i=this.vars;if(!e.length)return;if(!BX.type.isPlainObject(t))t={};t.modifyOrigin=t.modifyOrigin||i.cache.search.origin===false;var s=t.modifyOriginPosition=="prepend"?"unshift":"push";if(i.cache.search.origin===false)i.cache.search.origin=[];for(var n in e){if(!e.hasOwnProperty(n))continue;if(t.modifyOrigin){i.cache.search.origin[s](e[n].VALUE)}i.cache.nodes[e[n].VALUE]=e[n]}this.fireEvent("after-cache-filled",[])},getLastSource:function(){return this.vars.lastSource},toggleDropDown:function(){if(this.vars.allEventMutex)return;if(this.vars.opened)this.hideDropdown();else this.tryDisplayPage("toggle")},remove:function(){if(BX.type.isDomNode(this.ctrls.scope))this.ctrls.scope.innerHTML="";BX.unbindAll(this);if(this.vars.pager!=null){this.vars.pager.remove();this.vars.pager=null}if(this.vars.selector!=null){this.vars.selector.remove();this.vars.selector=null}},getLastPageIndex:function(){return Math.ceil(this.vars.filtered.length/this.opts.pageSize)-1},checkPageIsFirst:function(e){return e==0},checkPageIsLast:function(e){return e==this.getLastPageIndex()},checkPageIsOutOfRange:function(e){return e<0||e>this.getLastPageIndex()},setInitialValue:function(){var e=false;if(this.opts.selectedItem!==false)e=this.opts.selectedItem;else if(this.ctrls.inputs.origin.value.length>0)e=this.ctrls.inputs.origin.value;if(e!==false&&typeof e!="undefined")this.setValue(e)},discoverItems:function(e){var t=this.vars,i=this;var s=new BX.deferred;s.done(function(s){if(typeof s!="undefined")i.fillCache(s.items);t.loader.hide();t.allEventMutex=false;e.call(this)});s.fail(function(){t.loader.hide();t.allEventMutex=false;i.displayNothingFound()});if(BX.util.getObjectLength(t.cache.nodes)==0){t.loader.show();t.allEventMutex=true;s.startRace(1e3,false);this.fireEvent("item-list-discover",[s])}else s.resolve()},tryDisplayPage:function(e){var t=this.vars,i=this,s=this.ctrls.inputs.fake.value;t.applyFilter=e=="search"&&BX.type.isNotEmptyString(s);t.lastSource=e;this.discoverItems(function(){i.fireEvent("before-display-page",[]);var e=t.applyFilter?0:i.getPageNumberOfSelected();t.filtered=[];if(t.applyFilter){var n=s.toLowerCase();for(var r in t.cache.search.origin){if(!t.cache.search.origin.hasOwnProperty(r))continue;var a=t.cache.search.origin[r];if(t.cache.nodes[a].DISPLAY.toLowerCase().indexOf(n)==0){t.filtered.push(a)}}}else t.filtered=t.cache.search.origin;if(t.filtered==false)t.filtered=[];t.pager.cleanUp();t.selector.cleanUp();i.displayPage(e)})},displayPage:function(e){var t=this.getPage(e);if(t.length==0)this.displayNothingFound();else{this.displayVariants(t,e)}},getPage:function(e){var t=this.vars,i=this.opts;return t.filtered.slice(e*i.pageSize,(e+1)*i.pageSize)},getPageNumberOfSelected:function(){if(this.vars.value==false)return 0;var e=this.vars;var t=0;for(var i in e.cache.search.origin){if(!e.cache.search.origin.hasOwnProperty(i))continue;if(e.cache.search.origin[i]==this.vars.value)break;t++}if(t>e.cache.search.origin.length)return 0;return Math.floor(t/this.opts.pageSize)},displayNothingFound:function(){BX.cleanNode(this.ctrls.vars);if(BX.type.isElementNode(this.ctrls.nothingFound))this.whenNothingFoundToggle(true);else{var e=this.vars.pager;e.cleanUp();this.vars.selector.cleanUp();e.setTopReached();e.setBottomReached();e.appendPage(this.whenRenderNothingFound(this.opts.messages.nothingFound));this.showDropdown()}this.fireEvent("nothing-found")},displayVariants:function(e,t){var i=this.ctrls,s=this.vars,n=this.opts,r=this.sys.code;this.hideNothingFound();var a=[];var o=[];if(s.lastSource=="toggle"&&t==0&&s.value!==false){var l=this.createItemForPage("",{DISPLAY:n.messages.clearSelection},a,o);BX.addClass(l,"bx-ui-"+r+"-deselect-item")}var c={};for(var h in e){if(!e.hasOwnProperty(h))continue;this.createItemForPage(e[h],s.cache.nodes[e[h]],a,o);c[s.cache.nodes[e[h]].VALUE]=a[h]}this.fireEvent("after-page-built",[t,a,o]);this.showDropdown();s.selector.addPage(o,t);if(this.checkPageIsLast(t))s.pager.setBottomReached();var u=this.vars.pager.getPageCount();s.pager.lockScrollEvents();s.pager.addPage(a,t);if(u==0){var d=false;if(s.value!==false){this.vars.selector.selectById(s.value);d=s.value}else{this.vars.selector.selectFirst();d=this.vars.selector.getSelected().id}if(d!==false&&typeof c[d]!="undefined"){this.vars.pager.scrollToNode(c[d])}}s.pager.unLockScrollEvents();s.pager.dispatchScrollEvents();this.fireEvent("after-page-display",[s.cache.nodes,t])},createItemForPage:function(e,t,i,s,n){var r=this.whenRenderVariant(t)[0];BX.data(r,"bx-"+this.sys.code+"-item-value",e);this.fireEvent("after-item-append",[r]);i[n?"unshift":"push"](r);s[n?"unshift":"push"]({id:e,data:{node:r}});return r},hideNothingFound:function(){if(BX.type.isElementNode(this.ctrls.nothingFound))this.whenNothingFoundToggle(false)},showDropdown:function(){if(this.vars.opened)return;if(this.vars.opened)return;var e=!this.vars.opened;this.vars.opened=true;BX.show(this.ctrls.dropdown);var t=BX.height(this.ctrls.dropdown);BX.hide(this.ctrls.dropdown);var i=this.ctrls.inputs.fake;var s=BX.pos(i);var n=BX.scrollTop(window)+BX.height(window)-(Math.ceil(s.top)+s.height);this.whenDropdownToggle.apply(this,[true,n-t<-20,s.height,e])},hideDropdown:function(){this.vars.opened=false;this.whenDropdownToggle.apply(this,[false,false,0,true])},deselectItem:function(){var e=this.vars,t=this.ctrls,i=this.opts;this.setCurrentValue("");this.fireEvent("after-deselect-item")},selectItem:function(e){var t=this.vars,i=this.ctrls,s=this.opts;t.value=e;i.inputs.origin.value=t.cache.nodes[e].VALUE;this.setFakeInputValue(this.whenItemSelect.apply(this,[e]));this.setCurrentValue(e);this.hideDropdown();this.fireEvent("after-select-item",[t.value])},setCurrentValue:function(e){var t=this.opts,i=this.vars;i.value=e==""?false:e;this.setTargetInputValue(e)},whenItemSelect:function(e){return this.vars.cache.nodes[e]["DISPLAY"]},whenToggleItemGlow:function(e,t){BX[t?"addClass":"removeClass"](e.node,"bx-ui-"+this.sys.code+"-variant-active")},whenDropdownToggle:function(e,t,i,s){if(e){if(s)this.whenDecideDropdownOrient(t,i,s);BX.show(this.ctrls.dropdown)}else BX.hide(this.ctrls.dropdown);this.fireEvent("after-popup-toggled",[e])},whenDecideDropdownOrient:function(e,t){var i=this.ctrls;if(e){var s=BX.style(i.dropdown,"top");if(s!="auto"){BX.data(i.dropdown,"pane-top",s)}BX.style(i.dropdown,"top","auto");BX.style(i.dropdown,"bottom",t+this.opts.pageUpWardOffset+"px")}else{var s=BX.data(i.dropdown,"pane-top");if(typeof s!="undefined")BX.style(i.dropdown,"top",s);BX.style(i.dropdown,"bottom","auto")}},whenNothingFoundToggle:function(e){BX[e?"show":"hide"](this.ctrls.nothingFound)},whenRenderError:function(e){if(typeof this.tmpls["error"]=="string")return this.createNodesByTemplate("error",{message:e},true)[0];return BX.create("div",{props:{className:"bx-ui-"+this.sys.code+"-error"},text:e})},whenRenderNothingFound:function(e){if(typeof this.tmpls["nothing-found"]=="string")return this.createNodesByTemplate("nothing-found",{message:e},true)[0];return this.whenRenderError(e)},whenLoaderToggle:function(e){this[e?"setCSSState":"dropCSSState"]("items-discover-in-progress")},whenRenderVariant:function(e){this.fireEvent("before-render-variant",[e]);if(typeof this.tmpls["dropdown-item"]=="string")return this.createNodesByTemplate("dropdown-item",e,true);return[BX.create("div",{props:{className:"bx-ui-"+this.sys.code+"-variant"},text:e.DISPLAY})]}});BX.ui.itemSelectManager=function(){this.selectFirst=function(){if(this.head!=null)this.selectById(this.head.id)};this.selectNext=function(e){this.jumpToDistance(true,e)};this.selectPrevious=function(e){this.jumpToDistance(false,e)};this.selectById=function(e){var t=this.data[e];if(typeof t=="undefined")return;if(this.current!=null)this.fireEvent("item-deselect",[this.current.id,this.current.data]);this.fireEvent("item-select",[e,t.data]);this.current=t};this.getSelected=function(){if(this.current==null)return undefined;return{id:this.current.id,data:this.current.data}};this.addPage=function(e,t){if(this.range==false){this.appendData(e);this.range=[t,t]}else if(t>this.range[1]){this.appendData(e);this.range[1]++}else if(t<this.range[0]){this.prependData(e);this.range[0]--}};this.cleanUp=function(){this.data={};this.head=null;this.tail=null;this.current=null;this.range=false};this.remove=function(){this.cleanUp()};this.fireEvent=function(e,t,i){i=i||this;t=t||[];BX.onCustomEvent(i,"bx-ui-item-select-manager-"+e,t)},this.bindEvent=function(e,t){BX.addCustomEvent(this,"bx-ui-item-select-manager-"+e,t)},this.jumpToDistance=function(e,t){if(this.current!=null){if(!t)t=1;var i=this.current;for(var s=0;s<t;s++){if(i[e?"next":"previous"]==null)break;i=i[e?"next":"previous"]}if(i!=null)this.selectById(i.id)}};this.appendData=function(e){for(var t=0;t<e.length;t++)this.append(e[t])};this.prependData=function(e){for(var t=e.length-1;t>=0;t--)this.prepend(e[t])};this.append=function(e){var t=this.tail;this.data[e.id]={id:e.id,data:e.data,next:null,previous:t};if(this.tail!=null)this.tail.next=this.data[e.id];if(this.head==null)this.head=this.data[e.id];this.tail=this.data[e.id];if(this.current==null)this.current=this.data[e.id]};this.prepend=function(e){var t=this.head;this.data[e.id]={id:e.id,data:e.data,next:t,previous:null};if(this.head!=null)this.head.previous=this.data[e.id];if(this.tail==null)this.tail=this.data[e.id];this.head=this.data[e.id];if(this.current==null)this.current=this.data[e.id]};this.cleanUp();return this};
//# sourceMappingURL=core_ui_combobox.map.js