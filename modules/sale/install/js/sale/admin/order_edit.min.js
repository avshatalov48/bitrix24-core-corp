BX.namespace("BX.Sale.Admin.OrderEditPage");BX.Sale.Admin.OrderEditPage={formId:"",fieldsUpdaters:{},fieldsUpdatersContexts:{},statusesNames:{},orderId:0,languageId:"",siteId:"",currency:"",currencyLang:"",form:null,adminTabControlId:"",discountRefreshTimeoutId:0,autoPriceChange:true,runningCheckTimeout:{},tailsLoaded:false,rollbackMethods:[],connectedB24Portal:"",getForm:function(){if(!BX.Sale.Admin.OrderEditPage.form)BX.Sale.Admin.OrderEditPage.form=BX(BX.Sale.Admin.OrderEditPage.formId);return BX.Sale.Admin.OrderEditPage.form},toggleFix:function(e,t){var a=BX(t),i=BX(e);if(!a||!i)return;var r=!BX.hasClass(a,"adm-detail-tabs-block-pin");if(r){BX.addClass(a,"adm-detail-tabs-block-pin");i.title=BX.message("SALE_ORDEREDIT_FIX");BX.UnFix(a)}else{BX.removeClass(a,"adm-detail-tabs-block-pin");i.title=BX.message("SALE_ORDEREDIT_UNFIX");BX.Fix(a,{type:"top"})}r=!r;BX.userOptions.save("sale_admin","sale_order_edit","fix_"+t,r?"Y":"N")},setFixHashCorrection:function(){BX.bind(window,"hashchange",function(){var e=0;if(BX.adminPanel&&BX.adminPanel.isFixed()){var t=BX.pos(BX.adminPanel.panel.parentElement);e+=t.height}if(BX.FixOffsets&&BX.FixOffsets.top)e+=BX.FixOffsets.top;if(e>0)window.scrollBy(0,-e)})},disableSavingButtons:function(e){var t,a,i=["apply","save"];for(t in i){if(!i.hasOwnProperty(t))continue;a=BX.findChild(document,{attr:{name:i[t]}},true);if(a)a.disabled=e}},showDialog:function(e,t){var a=new BX.PopupWindow("adm-sale-order-alert-dialog",null,{autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:true,titleBar:t||BX.message("SALE_ORDEREDIT_MESSAGE"),contentColor:"white",content:BX.create("span",{html:BX.util.htmlspecialchars(e).replace(/\n/g,"<br>\n"),style:{backgroundColor:"white"}})});a.setButtons([new BX.PopupWindowButton({text:BX.message("SALE_ORDEREDIT_CLOSE"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(function(){a.close();a.destroy()},a)}})]);a.show()},showConfirmDialog:function(e,t,a,i){var r=new BX.PopupWindow("adm-sale-order-alert-dialog",null,{autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:true,titleBar:t||BX.message("SALE_ORDEREDIT_CONFIRM"),contentColor:"white",content:BX.create("span",{html:e,style:{backgroundColor:"white"}})});r.setButtons([new BX.PopupWindowButton({text:BX.message("SALE_ORDEREDIT_CONFIRM_CONTINUE"),className:"popup-window-button-accept",events:{click:function(){if(a&&typeof a=="function")a.call(null);r.close();r.destroy()}}}),new BX.PopupWindowButton({text:BX.message("SALE_ORDEREDIT_CONFIRM_ABORT"),className:"popup-window-button-decline",events:{click:function(){if(i&&typeof i=="function")i.call(null);r.close();r.destroy()}}})]);r.show()},onSaveStatusButton:function(e,t){BX.Sale.Admin.OrderAjaxer.sendRequest(this.ajaxRequests.saveStatus(e,t))},onCancelStatusButton:function(e,t){this.toggleCancelDialog();BX.Sale.Admin.OrderAjaxer.sendRequest(this.ajaxRequests.cancelOrder(e,t,BX("FORM_REASON_CANCELED").value))},getElementValue:function(e){var t=BX(e);if(t&&typeof t.value!="undefined")return t.value;return""},getAllFormData:function(){var e=this.getForm();if(!e)return{};var t=BX.ajax.prepareForm(e);return!!t&&t.data?t.data:{}},unRegisterFieldUpdater:function(e,t){if(!this.fieldsUpdaters[e])return;for(var a=this.fieldsUpdaters[e].length-1;a>=0;a--)if(this.fieldsUpdaters[e][a]==t)delete this.fieldsUpdaters[e][a]},unRegisterProductFieldsUpdaters:function(e){for(var t in this.fieldsUpdaters)if(this.fieldsUpdaters.hasOwnProperty(t))if(t.indexOf("PRODUCT["+e+"]")!=-1)delete this.fieldsUpdaters[t]},unRegisterFieldsUpdaters:function(e){for(var t in e)if(e.hasOwnProperty(t))if(this.fieldsUpdaters[e[t]])delete this.fieldsUpdaters[e[t]]},registerFieldsUpdaters:function(e){for(var t in e){if(!e.hasOwnProperty(t))continue;if(typeof this.fieldsUpdaters[t]=="undefined")this.fieldsUpdaters[t]=[];this.fieldsUpdaters[t].push(e[t])}},callFieldsUpdaters:function(e){var t=["DISCOUNTS_LIST","DELIVERY_PRICE","PROPERTIES_ARRAY","BUYER_PROFILES_LIST","BUYER_PROFILES_DATA","DELIVERY_WEIGHT"],a={};for(var i=0,r=t.length-1;i<=r;i++){var n=t[i];if(typeof e[n]!=="undefined")this.callConcreteFieldUpdater(n,e[n]);a[n]=true}for(i in e){if(!e.hasOwnProperty(i))continue;if(a[i])continue;this.callConcreteFieldUpdater(i,e[i])}},callConcreteFieldUpdater:function(e,t){var a=null,i=null;for(var r in this.fieldsUpdaters[e]){if(!this.fieldsUpdaters[e].hasOwnProperty(r))continue;var n=this.fieldsUpdaters[e][r];if(n.context&&n.callback){a=n.context;i=n.callback}else{a=null;i=this.fieldsUpdaters[e][r]}if(i&&typeof i=="function")i.call(a,t)}},currencyFormat:function(e,t){if(BX.Currency&&BX.Currency.currencyFormat){e=BX.Currency.currencyFormat(e,this.currency,t?false:true)}return e},restoreFormData:function(e){var t=this.getForm();if(!t){BX.debug("BX.Sale.Admin.OrderEditPage:restoreFormData() can't find form");return false}for(var a in e)if(e.hasOwnProperty(a))if(typeof t.elements[a]!="undefined")t.elements[a].value=e[a];return true},createFormBlocker:function(){var e=document.documentElement.scrollHeight,t=document.documentElement.clientHeight,a=Math.max(e,t);return BX.create("div",{props:{className:"bx-core-dialog-overlay",id:"sale-adm-order-form-blocker"},style:{zIndex:"10001",width:"100%",height:a+"px",backgroundColor:"rgba(57,60,67,0.1)"},children:[BX.create("span",{style:{zIndex:"10002",top:"5%",left:"85%",position:"fixed",background:'url("/bitrix/panel/main/images/submenu-bg.png") repeat 0 0',padding:"15px",borderRadius:"5px",fontSize:"14px",border:"4px solid rgb(230, 230, 230)"},html:BX.message("SALE_ORDEREDIT_REFRESHING_DATA")})]})},blockForm:function(){if(BX("sale-adm-order-form-blocker"))return;document.body.appendChild(this.createFormBlocker())},unBlockForm:function(){var e=BX("sale-adm-order-form-blocker");if(e)e.parentNode.removeChild(e)},toggleCancelDialog:function(){var e=BX("sale-adm-status-cancel-dialog");if(e)BX.toggleClass(e,"active")},setStatus:function(e){var t=BX("STATUS_ID");if(t)t.value=e},desktopMakeCall:function(e){e=encodeURIComponent(e);BX.Sale.Admin.OrderEditPage.desktopRunningCheck(function(){if(BX.Sale.Admin.OrderEditPage.connectedB24Portal!==""){BX.Sale.Admin.OrderEditPage.desktopCall(e,BX.Sale.Admin.OrderEditPage.connectedB24Portal)}else{BX.Sale.Admin.OrderEditPage.browserCall(e)}},function(){BX.Sale.Admin.OrderEditPage.browserCall(e)})},desktopCall:function(e,t){location.href="bx://v2/"+t+"/callto/phone/"+e},browserCall:function(e){var t=BX.browser.IsMobile();location.href=(t?"tel:":"callto:")+e},desktopRunningCheck:function(e,t){if(typeof e=="undefined"){return false}if(typeof t=="undefined"){t=function(){}}var a=+new Date;var i="http://127.0.0.1:20141/";var r=BX.create("img",{attrs:{src:i+"icon.png?"+a,"data-id":a,style:"position:absolute; left: -100px; opacity: 0; width: 1px; height: 1px"},props:{className:"bx-messenger-out-of-view"},events:{error:function(){var e=this.getAttribute("data-id");t(false,e);clearTimeout(BX.Sale.Admin.OrderEditPage.runningCheckTimeout[e]);BX.remove(this)},load:function(){var t=this.getAttribute("data-id");e(true,t);clearTimeout(BX.Sale.Admin.OrderEditPage.runningCheckTimeout[t]);BX.remove(this)}}});document.body.appendChild(r);BX.Sale.Admin.OrderEditPage.runningCheckTimeout[a]=setTimeout(function(){t(false,a);clearTimeout(BX.Sale.Admin.OrderEditPage.runningCheckTimeout[a]);BX.remove(this)},500);return true},changeCancelBlock:function(e,t){var a=BX("sale-adm-status-cancel-blocktext"),i=BX("FORM_REASON_CANCELED"),r=BX("sale-adm-status-cancel-dialog-btn"),n="";if(t.CANCELED=="Y"){n='<div class="adm-s-select-popup-element-selected-bad">'+"<span>"+BX.message("SALE_ORDER_STATUS_CANCELED")+"</span>"+t.DATE_CANCELED+BX.Sale.Admin.OrderEditPage.getUserEditLink(t)+"</div>";a.style.textAlign="start";i.disabled=true;r.innerHTML=BX.message("SALE_ORDER_STATUS_CANCEL_CANCEL");r.onclick=function(){BX.Sale.Admin.OrderEditPage.onCancelStatusButton(e,"Y")}}else{n='<a href="javascript:void(0);" onclick="BX.Sale.Admin.OrderEditPage.toggleCancelDialog();">'+BX.message("SALE_ORDER_STATUS_CANCELING")+"</a>";a.style.textAlign="center";i.disabled=false;r.innerHTML=BX.message("SALE_ORDER_STATUS_CANCEL");r.onclick=function(){BX.Sale.Admin.OrderEditPage.onCancelStatusButton(e,"N")}}a.innerHTML=n},getUserEditLink:function(e){return'<a href="/bitrix/admin/user_edit.php?lang='+BX.Sale.Admin.OrderEditPage.languageId+"&ID="+e.EMP_CANCELED_ID+'">'+BX.util.htmlspecialchars(e.EMP_CANCELED_NAME)+"</a>"},onRefreshOrderDataAndSave:function(){BX.Sale.Admin.OrderEditPage.blockForm();var e=this.getForm();e.appendChild(BX.create("input",{props:{name:"refresh_data_and_save",type:"hidden",value:"Y"}}));if(BX.Sale.Admin.OrderEditPage.tailsLoaded){e.submit()}else{BX.addCustomEvent("onAfterSaleOrderTailsLoaded",function(){e.submit()})}},onOrderCopy:function(e){BX.Sale.Admin.OrderEditPage.blockForm();var t=this.getForm();t.action=e;t.submit()},createDiscountsNode:function(e,t,a,i,r){var n=null,d,s,o;if(a&&i&&i.DISCOUNT_LIST){s=a.length;if(s>0){n=BX.create("div",{props:{className:"sale_order_basketsale-order-basket-product-n3-discount-description"}});for(d=0,s;d<s;d++){if(!a[d])continue;o=a[d].DISCOUNT_ID;if(i.DISCOUNT_LIST[o]){this.addDiscountItemRow(e,t,a[d],i.DISCOUNT_LIST[o],n,r)}}}}else{n=BX.create("span",{html:"&nbsp;"})}return BX.create("div",{children:[n]})},addDiscountItemRow:function(e,t,a,i,r,n){var d=BX.create("div",{props:{className:"sale_order_basketsale-order-basket-product-n3-discount-description-row"}}),s={"data-discount-id":i.DISCOUNT_ID},o,l;r.appendChild(d);if(t==="DISCOUNT_LIST"){s["data-discount"]="Y";s["data-use-coupons"]=i.USE_COUPONS}if(t==="BASKET"||t==="DELIVERY"){s["data-coupon-id"]=a.COUPON_ID?a.COUPON_ID:"-";s["data-discount-target"]="Y"}o="DISCOUNTS["+t+"]"+(e!=""?"["+e+"]":"")+"["+i.DISCOUNT_ID+"]";l=BX.create("input",{props:{type:"checkbox",name:o,checked:a.APPLY==="Y",value:"Y",disabled:n==="VIEW"},attrs:s});d.appendChild(BX.create("div",{props:{className:"sale_order_basketsale-order-basket-product-n3-discount-input"},children:[BX.create("input",{props:{type:"hidden",name:o,value:"N"}}),l]}));if(n==="EDIT"){BX.bind(l,"click",function(e){BX.Sale.Admin.OrderEditPage.setDiscountCheckbox(e);BX.Sale.Admin.OrderEditPage.refreshDiscounts()})}var c="";if(typeof a.DESCR==="object"){if(a.DESCR){for(var u in a.DESCR)if(a.DESCR.hasOwnProperty(u))c+=a.DESCR[u]}else{c=BX.message("SALE_ORDEREDIT_DISCOUNT_UNKNOWN")+" %"}}else{c=a.DESCR}var f="_self";if(i.EDIT_PAGE_URL_PARAMS){if(i.EDIT_PAGE_URL_PARAMS.target){f=i.EDIT_PAGE_URL_PARAMS.target}}if(i.EDIT_PAGE_URL){d.appendChild(BX.create("div",{props:{className:"sale_order_basketsale-order-basket-product-n3-discount-name"},children:[BX.create("a",{props:{href:i.EDIT_PAGE_URL,className:"adm-s-detail-content-sale-link",target:f},html:BX.util.htmlspecialchars(i.NAME)})]}))}else{d.appendChild(BX.create("td",{children:[BX.create("span",{html:BX.util.htmlspecialchars(i.NAME)})]}))}var E=BX.create("div",{props:{className:"sale_order_basketsale-order-basket-product-n3-discount-list-container"},html:'<div class="sale_order_basketsale-order-basket-product-n3-discount-list">'+c+"</div>"});d.appendChild(E);if(c.length>500){E.appendChild(BX.create("div",{props:{className:"sale_order_basketsale-order-basket-product-n3-discount-expand-btn"},events:{click:function(e){E.classList.toggle("expand")}}}))}return d},setDiscountCheckbox:function(e){var t=e.target,a,i,r,n;if(!!t&&t.hasAttribute("data-discount-id")){if(t.hasAttribute("data-coupon")){a=BX.findChild(BX.Sale.Admin.OrderEditPage.getForm(),{attribute:{"data-discount-id":t.getAttribute("data-discount-id"),"data-coupon-id":t.getAttribute("data-discount-coupon")}},true,true);if(a.length>0){for(i=0;i<a.length;i++)a[i].checked=t.checked}r=false;a=BX.findChild(BX.Sale.Admin.OrderEditPage.getForm(),{attribute:{"data-discount-id":t.getAttribute("data-discount-id"),"data-coupon":"Y"}},true,true);if(a.length>0){for(i=0;i<a.length;i++){if(a[i].checked)r=true}}a=BX.findChild(BX.Sale.Admin.OrderEditPage.getForm(),{attribute:{"data-discount-id":t.getAttribute("data-discount-id"),"data-discount":"Y","data-use-coupons":"Y"}},true,false);if(a)a.checked=r;a=null}else if(t.hasAttribute("data-discount")){a=BX.findChild(BX.Sale.Admin.OrderEditPage.getForm(),{attribute:{"data-discount-id":t.getAttribute("data-discount-id")}},true,true);if(a.length>0){for(i=0;i<a.length;i++)a[i].checked=t.checked}a=null}else if(t.hasAttribute("data-discount-target")){if(t.checked){a=BX.findChild(BX.Sale.Admin.OrderEditPage.getForm(),{attribute:{"data-discount-id":t.getAttribute("data-discount-id"),"data-discount":"Y"}},true,false);if(a)a.checked=true;if(t.hasAttribute("data-coupon-id")){n=t.getAttribute("data-coupon-id");if(n!=""&&n!="-"){a=BX.findChild(BX.Sale.Admin.OrderEditPage.getForm(),{attribute:{"data-discount-id":t.getAttribute("data-discount-id"),"data-discount-coupon":n}},true,false);if(a)a.checked=true}}a=null}}}},onProblemCloseClick:function(e,t){BX.Sale.Admin.OrderAjaxer.sendRequest(this.ajaxRequests.unmarkOrder(e,t))},onMarkerCloseClick:function(e,t,a,i,r){BX.Sale.Admin.OrderAjaxer.sendRequest(this.ajaxRequests.deleteMarker(e,t,a,i,r))},onMarkerFixErrorClick:function(e,t,a,i,r){BX.Sale.Admin.OrderAjaxer.sendRequest(this.ajaxRequests.fixMarker(e,t,a,i,r))},refreshDiscounts:function(){if(this.discountRefreshTimeoutId>0)return;this.discountRefreshTimeoutId=setInterval(function(){BX.Sale.Admin.OrderAjaxer.sendRequest(BX.Sale.Admin.OrderEditPage.ajaxRequests.refreshOrderData({operation:"DISCOUNTS_REFRESH"}));clearInterval(BX.Sale.Admin.OrderEditPage.discountRefreshTimeoutId);BX.Sale.Admin.OrderEditPage.discountRefreshTimeoutId=0},500)},rollBack:function(){for(var e in BX.Sale.Admin.OrderEditPage.rollbackMethods){if(!BX.Sale.Admin.OrderEditPage.rollbackMethods.hasOwnProperty(e))continue;var t=BX.Sale.Admin.OrderEditPage.rollbackMethods[e];if(typeof t!=="function")continue;t.call(t);delete BX.Sale.Admin.OrderEditPage.rollbackMethods[e]}},addRollbackMethod:function(e){BX.Sale.Admin.OrderEditPage.rollbackMethods.push(e)},resetRollbackMethods:function(){BX.Sale.Admin.OrderEditPage.rollbackMethods=[]},enableFormButtons:function(e){var t=BX.findChild(BX(e),{tag:"input",attribute:{name:"apply",type:"submit"}},true),a=BX.findChild(BX(e),{tag:"input",attribute:{name:"save",type:"submit"}},true);if(t)t.disabled=false;if(a)a.disabled=false},ajaxRequests:{addProductToBasket:function(e,t,a,i,r){var n={action:"addProductToBasket",productId:e,quantity:t,replaceBasketCode:a?a:"",columns:i,callback:BX.Sale.Admin.OrderAjaxer.refreshOrderData.callback};if(r!==false)n.customPrice=r;return BX.Sale.Admin.OrderAjaxer.refreshOrderData.modifyParams(n)},getProductIdBySkuProps:function(e){return{action:"getProductIdBySkuProps",productId:e.productId,iBlockId:e.iBlockId,skuProps:e.skuProps,skuOrder:e.skuOrder,changedSkuId:e.changedSkuId,callback:e.callback}},cancelOrder:function(e,t,a){return{action:"cancelOrder",orderId:e,canceled:t,comment:a,callback:function(t){BX.Sale.Admin.OrderEditPage.unBlockForm();if(t&&!t.ERROR)BX.Sale.Admin.OrderEditPage.changeCancelBlock(e,t);else if(t&&t.ERROR)BX.Sale.Admin.OrderEditPage.showDialog(BX.message("SALE_ORDER_STATUS_CANCEL_ERROR")+": "+t.ERROR);else BX.debug(BX.message("SALE_ORDER_STATUS_CANCEL_ERROR"))}}},saveStatus:function(e,t){var a=BX(t);if(!a)BX.debug("Error getting select object with id: "+t);if(typeof a.value=="undefined")BX.debug("Error getting select value id: "+t);BX("save_status_result_ok").style.display="none";return{action:"saveStatus",orderId:e,statusId:a.value,callback:function(e){var t;e.CAN_USER_EDIT="Y";if(e&&e.CAN_USER_EDIT&&!e.ERROR){BX.Sale.Admin.OrderEditPage.callFieldsUpdaters({STATUS_ID:a.value});BX.Sale.Admin.OrderEditPage.disableSavingButtons(e.CAN_USER_EDIT!="Y");BX("save_status_result_ok").style.display=""}else if(e&&e.ERROR){t=BX.message("SALE_ORDER_STATUS_CHANGE_ERROR")+": "+e.ERROR}else{t=BX.message("SALE_ORDER_STATUS_CHANGE_ERROR")}if(t)BX.Sale.Admin.OrderEditPage.showDialog(t)}}},getOrderFields:function(e,t){return{action:"getOrderFields",givenFields:e.givenFields,demandFields:e.demandFields,callback:function(e){if(e&&e.RESULT_FIELDS&&!e.ERROR){BX.Sale.Admin.OrderEditPage.callFieldsUpdaters(e.RESULT_FIELDS);if(t){BX.Sale.Admin.OrderAjaxer.sendRequest(BX.Sale.Admin.OrderEditPage.ajaxRequests.refreshOrderData())}}else if(e&&e.ERROR){BX.debug("Error receiving fields: "+e.ERROR)}else{BX.debug("Error receiving fields!")}}}},refreshOrderData:function(e){if(!BX.Sale.Admin.OrderAjaxer.refreshOrderData.getFlag()){return BX.Sale.Admin.OrderAjaxer.refreshOrderData.modifyParams({action:"refreshOrderData",additional:e,callback:BX.Sale.Admin.OrderAjaxer.refreshOrderData.callback})}},unmarkOrder:function(e,t){return{action:"unmarkOrder",orderId:e,callback:function(e){BX.Sale.Admin.OrderEditPage.unBlockForm();if(e&&!e.ERROR)BX(t).style.display="none";else if(e&&e.ERROR)BX.Sale.Admin.OrderEditPage.showDialog(BX.message("SALE_ORDEREDIT_UNMARK_ERROR")+": "+e.ERROR);else BX.debug(BX.message("SALE_ORDEREDIT_UNMARK_ERROR"))}}},getOrderTails:function(e,t,a){return{action:"getOrderTails",orderId:e,formType:t,idPrefix:a,lang:BX.Sale.Admin.OrderEditPage.languageId,callback:function(e){if(e&&!e.ERROR){BX.Sale.Admin.OrderEditPage.callFieldsUpdaters(e);var t;if(typeof e.ANALYSIS!="undefined"){t=BX("sale-adm-order-analysis-content");if(t)t.innerHTML=e.ANALYSIS}if(typeof e.SHIPMENTS!="undefined"){t=BX("sale-adm-order-shipments-content");if(t){var a=BX.processHTML(e.SHIPMENTS);BX.loadCSS(a["STYLE"]);t.innerHTML=a["HTML"];for(var i in a["SCRIPT"])BX.evalGlobal(a["SCRIPT"][i]["JS"])}}}else if(e&&e.ERROR){BX.Sale.Admin.OrderEditPage.showDialog(e.ERROR)}else{BX.debug("Can't order view tails")}BX.Sale.Admin.OrderEditPage.tailsLoaded=true;BX.onCustomEvent("onAfterSaleOrderTailsLoaded",[e])}}},deleteMarker:function(e,t,a,i,r){return{action:"deleteMarker",markerId:e,orderId:t,entityId:i,forEntity:r?"Y":"N",callback:function(e){BX.Sale.Admin.OrderEditPage.unBlockForm();if(e&&!e.ERROR){if(e.WARNING&&e.WARNING.length>0){BX.Sale.Admin.OrderEditPage.showDialog(e.WARNING)}else{BX(a).style.display="none"}if(typeof e.MARKERS!="undefined"){var t=BX("sale-adm-order-problem-block");if(t)t.innerHTML=e.MARKERS}}else if(e&&e.ERROR){BX.Sale.Admin.OrderEditPage.showDialog(BX.message("SALE_ORDEREDIT_UNMARK_ERROR")+": "+e.ERROR)}else{BX.debug(BX.message("SALE_ORDEREDIT_UNMARK_ERROR"))}}}},fixMarker:function(e,t,a,i,r){return{action:"fixMarker",markerId:e,orderId:t,entityId:i,forEntity:r?"Y":"N",callback:function(e){BX.Sale.Admin.OrderEditPage.unBlockForm();if(e&&!e.ERROR){if(e.WARNING&&e.WARNING.length>0){BX.Sale.Admin.OrderEditPage.showDialog(e.WARNING)}else{BX(a).style.display="none"}if(typeof e.MARKERS!="undefined"){var t=BX("sale-adm-order-problem-block");if(t)t.innerHTML=e.MARKERS}}else if(e&&e.ERROR){BX.Sale.Admin.OrderEditPage.showDialog(BX.message("SALE_ORDEREDIT_UNMARK_ERROR")+": "+e.ERROR)}else{BX.debug(BX.message("SALE_ORDEREDIT_UNMARK_ERROR"))}}}}},fastNavigation:{lastMarkedItemId:null,onClickItem:function(formId,tabId,locationHash){eval(formId+".SelectTab('"+tabId+"')");setTimeout(function(){window.location.hash=locationHash},500);setTimeout(function(){window.scrollBy(0,-100)},900)},markItem:function(){if(!BX.Sale.Admin.OrderEditPage.fastNavigation.isFixed())return;var e=100;var t=BX.GetWindowScrollPos().scrollTop+BX.FixOffsets.top+e,a=BX.findChildren(BX("adm-workarea"),{className:"adm-sale-fastnav-anchor"},true),i=false;for(var r in a){if(!a.hasOwnProperty(r))continue;var n=BX.pos(a[r].nextElementSibling);if(n.top<=t&&n.bottom>=t){if(this.lastMarkedItemId!=a[r].id){BX.addClass(BX("nav_"+a[r].id),"selected");this.lastMarkedItemId=a[r].id;i=true}}else{if(i||this.lastMarkedItemId==a[r].id){BX.removeClass(BX("nav_"+a[r].id),"selected");if(this.lastMarkedItemId==a[r].id)this.lastMarkedItemId=null}}}},isFixed:function(){return!BX.hasClass("sale-order-edit-block-fast-nav","adm-detail-tabs-block-pin")}}};BX.Sale.Admin.Integration=function(){};BX.Sale.Admin.Integration.OrderEditPage=function(){};BX.Sale.Admin.Integration.OrderEditPage.toggleCancelDialog=function(){var e=BX("sale-adm-status-cancel-dialog");if(e)BX.toggleClass(e,"active")};BX.Sale.Admin.Integration.OrderEditPage.onCancelStatusButton=function(e,t){this.toggleCancelDialog();BX.Sale.Admin.OrderAjaxer.sendRequest(this.ajaxRequests.cancelOrder(e,t,BX("FORM_REASON_CANCELED").value))};BX.Sale.Admin.Integration.OrderEditPage.getUserEditLink=function(e){return'<a href="/bitrix/admin/user_edit.php?lang='+BX.Sale.Admin.OrderEditPage.languageId+"&ID="+e.EMP_CANCELED_ID+'" target="_blank">'+BX.util.htmlspecialchars(e.EMP_CANCELED_NAME)+"</a>"};BX.Sale.Admin.Integration.OrderEditPage.changeCancelBlock=function(e,t){var a=BX("sale-adm-status-cancel-blocktext"),i=BX("FORM_REASON_CANCELED"),r=BX("sale-adm-status-cancel-dialog-btn"),n="";if(t.CANCELED=="Y"){n='<div class="adm-s-select-popup-element-selected-bad">'+"<span>"+BX.message("SALE_ORDER_STATUS_CANCELED")+"</span>"+t.DATE_CANCELED+BX.Sale.Admin.Integration.OrderEditPage.getUserEditLink(t)+"</div>";a.style.textAlign="start";i.disabled=true;r.innerHTML=BX.message("SALE_ORDER_STATUS_CANCEL_CANCEL");r.onclick=function(){BX.Sale.Admin.Integration.OrderEditPage.onCancelStatusButton(e,"Y")}}else{n='<a href="javascript:void(0);" onclick="BX.Sale.Admin.OrderEditPage.toggleCancelDialog();">'+BX.message("SALE_ORDER_STATUS_CANCELING")+"</a>";a.style.textAlign="center";i.disabled=false;r.innerHTML=BX.message("SALE_ORDER_STATUS_CANCEL");r.onclick=function(){BX.Sale.Admin.Integration.OrderEditPage.onCancelStatusButton(e,"N")}}a.innerHTML=n};BX.Sale.Admin.Integration.OrderEditPage.ajaxRequests=function(){};BX.Sale.Admin.Integration.OrderEditPage.ajaxRequests.cancelOrder=function(e,t,a){return{action:"cancelOrder",orderId:e,canceled:t,comment:a,callback:function(t){BX.Sale.Admin.OrderEditPage.unBlockForm();if(t&&!t.ERROR)BX.Sale.Admin.Integration.OrderEditPage.changeCancelBlock(e,t);else if(t&&t.ERROR)BX.Sale.Admin.OrderEditPage.showDialog(BX.message("SALE_ORDER_STATUS_CANCEL_ERROR")+": "+t.ERROR);else BX.debug(BX.message("SALE_ORDER_STATUS_CANCEL_ERROR"))}}};
//# sourceMappingURL=order_edit.map.js