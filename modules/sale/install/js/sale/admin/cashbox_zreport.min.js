(function(e){if(!BX.Sale)BX.Sale={};if(BX.Sale.CashboxReport)return;BX.Sale.CashboxReport={ajaxUrl:"/bitrix/admin/sale_order_ajax.php",onClearFilter:function(){var e=BX("filter_cashbox_id");if(e!==undefined&&e!==null){var a=e.children;if(a[0]!==undefined&&a[0]!==null)a[0].selected=true}this.changeCashboxBlocks()},changeCashboxBlocks:function(){var e=BX("filter_cashbox_id");if(e!==undefined&&e!==null){var a={sessid:BX.bitrix_sessid(),cashboxId:e.value,action:"loadCashboxCheckInfo"};BX.proxy(BX.ajax({method:"post",dataType:"json",url:this.ajaxUrl,data:a,onsuccess:BX.proxy(function(e){if(e.ERROR&&e.ERROR.length>0){alert(e.ERROR)}else{if(e.CASH){cashNow=BX("adm-zreport-cash-now");if(cashNow){cashNow.innerHTML=e.CASH.FORMATED_SUM}cashReturn=BX("adm-zreport-cash-return");if(cashReturn){cashReturn.innerHTML=e.CASH.FORMATED_RETURN_SUM}}if(e.CASHLESS){cashlessNow=BX("adm-zreport-cashless-now");if(cashlessNow){cashlessNow.innerHTML=e.CASHLESS.FORMATED_SUM}cashlessReturn=BX("adm-zreport-cashless-return");if(cashlessReturn){cashlessReturn.innerHTML=e.CASHLESS.FORMATED_RETURN_SUM}}if(e.CUMULATIVE){cumulative=BX("adm-zreport-cumulative");if(cumulative){cumulative.innerHTML=e.CUMULATIVE.FORMATED_SUM}}}},this),onfailure:function(){BX.debug("Set filter error. Can't reload cashbox info")}}),this)}},createZReport:function(){var e=BX("filter_cashbox_id");if(e==undefined||e==null){return}var a=e.children;var s="<div class='adm-info-message'>"+BX.message("CASHBOX_CREATE_ZREPORT_WINDOW_INFO")+"</div>";s+="<table><tbody><tr><td><label>"+BX.message("SALE_F_CASHBOX")+":</label></td><td>";s+="<select id='cashboxListAddReport' class='sale-discount-bus-select'>";for(var t in a){if(a[t].value!=undefined){s+="<option value='"+a[t].value+"'>"+a[t].innerHTML+"</option>"}}s+="</select></td></tr></tbody></table>";var n=new BX.CAdminDialog({title:BX.message("CASHBOX_CREATE_ZREPORT_WINDOW_TITLE"),content:s,resizable:false,draggable:true,height:"170",width:"387",buttons:[{title:BX.message("JS_CORE_WINDOW_SAVE"),id:"saveCheckBtn",name:"savebtn",className:top.BX.browser.IsIE()&&top.BX.browser.IsDoctype()&&!top.BX.browser.IsIE10()?"":"adm-btn-save"},{title:top.BX.message("JS_CORE_WINDOW_CANCEL"),id:"cancelCheckBtn",name:"cancel"}]});BX.bind(BX("cancelCheckBtn"),"click",BX.delegate(function(){n.Close();n.DIV.parentNode.removeChild(n.DIV)}),this);BX.bind(BX("saveCheckBtn"),"click",BX.delegate(function(){var e={sessid:BX.bitrix_sessid(),cashboxId:BX("cashboxListAddReport").value,action:"addZReport"};BX.ajax({method:"post",dataType:"json",url:BX.Sale.CashboxReport.ajaxUrl,data:e,onsuccess:function(e){if(e.ERROR&&e.ERROR.length>0){alert(e.ERROR)}else{n.Close();location.reload()}},onfailure:function(){BX.debug("Select params error")}})}),this);n.Show()}};BX.addCustomEvent(e,"onBeforeAdminFilterSet",function(){BX.Sale.CashboxReport.changeCashboxBlocks()});BX.addCustomEvent(e,"onBeforeAdminFilterClear",function(){BX.Sale.CashboxReport.onClearFilter()})})(window);