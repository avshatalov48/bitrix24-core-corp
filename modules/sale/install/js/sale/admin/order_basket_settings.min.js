BX.namespace("BX.Sale.Admin.OrderBasket.SettingsDialog");BX.Sale.Admin.OrderBasket.SettingsDialog=function(e){this.basket=e.basket;this.idPrefix=this.basket.idPrefix||"sale_order_basket";this.formId=this.idPrefix+"_settings_dialog_form";this.contentId=this.idPrefix+"columns_form";this.dialog=this.create();this.form=null;this.columnsLimit=21};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.getForm=function(){if(!this.form)this.form=BX(this.formId);return this.form};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.unselectExcessFields=function(e){if(!e||!e.options||e.options.length<=this.columnsLimit)return false;var t=this.columnsLimit-e.form.columns.options.length;var i=0;for(var s=0,o=e.options.length;s<o;s++){if(!e.options[s].selected)continue;e.options[s].selected=t>=i++}return false};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.unselectUnRemovableFields=function(e){if(this.basket.unRemovableFields.length<=0)return false;for(var t=0,i=e.options.length;t<i;t++){if(!e.options[t].selected)continue;for(var s=0,o=this.basket.unRemovableFields.length;s<o;s++)if(e.options[t].value==this.basket.unRemovableFields[s])e.options[t].selected=false}return false};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.isUnRemovableFieldSelected=function(e){if(this.basket.unRemovableFields.length<=0)return false;for(var t=0,i=e.options.length;t<i;t++){if(!e.options[t].selected)continue;for(var s=0,o=this.basket.unRemovableFields.length;s<o;s++)if(e.options[t].value==this.basket.unRemovableFields[s])return true}return false};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.onSelectedChange=function(e){if(e.selectedIndex==-1){e.form.up_btn.disabled=true;e.form.down_btn.disabled=true;e.form.del_btn.disabled=true}else{this.unselectUnRemovableFields(e);e.form.up_btn.disabled=false;e.form.down_btn.disabled=false;e.form.del_btn.disabled=false}};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.onAvailableChange=function(e){if(e.selectedIndex==-1){e.form.add_btn.disabled=true}else{this.unselectExcessFields(e);e.form.add_btn.disabled=false}};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.create=function(){var e=new BX.CDialog({content:'<form id="'+this.formId+'" name="'+this.formId+'"></form>',title:BX.message("SALE_ORDER_BASKET_JS_SETTINGS_TITLE"),width:850,height:350,resizable:false});this.setButtons(e);var t=BX(this.formId),i=BX(this.contentId);if(t&&i)t.appendChild(i);return e};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.show=function(){var e=BX("adm-sale-basket-sett-all-cols"),t;BX.bind(e,"mousedown",function(){t=BX.GetWindowScrollPos()});BX.bind(e,"focus",function(){window.scrollTo(t.scrollLeft,t.scrollTop)});this.dialog.Show()};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.setButtons=function(e){var t=this;e.ClearButtons();e.SetButtons([{title:BX.message("SALE_ORDER_BASKET_JS_SETTINGS_APPLY"),name:"apply",action:function(){BX.showWait();t.save(t.getVisibleColumns());this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel])};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.changeColumns=function(){console.log("changeColumns");BX.closeWait()};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.onAddColumn=function(){console.log("addColumn");jsSelectUtils.addSelectedOptions(this.form.allColumns,this.form.columns,false);jsSelectUtils.deleteSelectedOptions(this.form.allColumns)};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.save=function(e){BX.Sale.Admin.OrderEditPage.blockForm();BX.Sale.Admin.OrderAjaxer.sendRequest({action:"saveBasketVisibleColumns",columns:e,idPrefix:this.idPrefix,callback:function(e){if(e&&e.RESULT&&e.RESULT=="OK"){var t=BX.Sale.Admin.OrderEditPage.getForm();t.submit()}else if(e&&e.ERROR){BX.debug("Error saving settings: "+e.ERROR)}else{BX.debug("Error saving settings!")}}})};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.getVisibleColumns=function(){var e=this.getForm(),t=[],i=e.elements.columns;for(var s=0,o=i.options.length;s<o;s++)t.push(i.options[s].value);return t};
//# sourceMappingURL=order_basket_settings.map.js