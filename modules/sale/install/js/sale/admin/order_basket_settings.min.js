BX.namespace("BX.Sale.Admin.OrderBasket.SettingsDialog");BX.Sale.Admin.OrderBasket.SettingsDialog=function(e){this.basket=e.basket;this.showProps=e.showProps||false;this.idPrefix=this.basket.idPrefix||"sale_order_basket";this.formId=this.idPrefix+"_settings_dialog_form";this.contentId=this.idPrefix+"columns_form";this.dialog=this.create();this.form=null;this.columnsLimit=21};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.getForm=function(){if(!this.form)this.form=BX(this.formId);return this.form};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.unselectExcessFields=function(e){if(!e||!e.options||e.options.length<=this.columnsLimit)return false;var t=this.columnsLimit-e.form.columns.options.length;var s=0;for(var i=0,o=e.options.length;i<o;i++){if(!e.options[i].selected)continue;e.options[i].selected=t>=s++}return false};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.unselectUnRemovableFields=function(e){if(this.basket.unRemovableFields.length<=0)return false;for(var t=0,s=e.options.length;t<s;t++){if(!e.options[t].selected)continue;for(var i=0,o=this.basket.unRemovableFields.length;i<o;i++)if(e.options[t].value==this.basket.unRemovableFields[i])e.options[t].selected=false}return false};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.isUnRemovableFieldSelected=function(e){if(this.basket.unRemovableFields.length<=0)return false;for(var t=0,s=e.options.length;t<s;t++){if(!e.options[t].selected)continue;for(var i=0,o=this.basket.unRemovableFields.length;i<o;i++)if(e.options[t].value==this.basket.unRemovableFields[i])return true}return false};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.onSelectedChange=function(e){if(e.selectedIndex==-1){e.form.up_btn.disabled=true;e.form.down_btn.disabled=true;e.form.del_btn.disabled=true}else{this.unselectUnRemovableFields(e);e.form.up_btn.disabled=false;e.form.down_btn.disabled=false;e.form.del_btn.disabled=false}};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.onAvailableChange=function(e){if(e.selectedIndex==-1){e.form.add_btn.disabled=true}else{this.unselectExcessFields(e);e.form.add_btn.disabled=false}};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.create=function(){var e=new BX.CDialog({content:'<form id="'+this.formId+'" name="'+this.formId+'"></form>',title:BX.message("SALE_ORDER_BASKET_JS_SETTINGS_TITLE"),width:850,height:350,resizable:false});this.setButtons(e);var t=BX(this.formId),s=BX(this.contentId);if(t&&s)t.appendChild(s);return e};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.show=function(){var e=BX("adm-sale-basket-sett-all-cols"),t;BX.bind(e,"mousedown",function(){t=BX.GetWindowScrollPos()});BX.bind(e,"focus",function(){window.scrollTo(t.scrollLeft,t.scrollTop)});this.dialog.Show()};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.setButtons=function(e){var t=this;e.ClearButtons();e.SetButtons([{title:BX.message("SALE_ORDER_BASKET_JS_SETTINGS_APPLY"),name:"apply",action:function(){BX.showWait();t.save(t.getVisibleColumns(),t.getShowProperties());this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel])};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.changeColumns=function(){BX.closeWait()};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.onAddColumn=function(){console.log("addColumn");jsSelectUtils.addSelectedOptions(this.form.allColumns,this.form.columns,false);jsSelectUtils.deleteSelectedOptions(this.form.allColumns)};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.save=function(e,t){BX.Sale.Admin.OrderEditPage.blockForm();var s={action:"saveBasketVisibleColumns",columns:e,idPrefix:this.idPrefix,callback:function(e){if(e&&e.RESULT&&e.RESULT==="OK"){var t=BX.Sale.Admin.OrderEditPage.getForm();t.submit()}else if(e&&e.ERROR){BX.debug("Error saving settings: "+e.ERROR)}else{BX.debug("Error saving settings!")}}};if(t){s.showProperties=t}BX.Sale.Admin.OrderAjaxer.sendRequest(s)};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.getVisibleColumns=function(){var e=this.getForm(),t=[],s=e.elements.columns;for(var i=0,o=s.options.length;i<o;i++)t.push(s.options[i].value);return t};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.getShowProperties=function(){var e=this.getForm();var t=e.elements.show_properties?e.elements.show_properties:null;if(!t){return null}return t.checked?"Y":"N"};
//# sourceMappingURL=order_basket_settings.map.js