this.BX=this.BX||{};this.BX.Sale=this.BX.Sale||{};(function(e,t){"use strict";var i=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"isBarcodeExist",value:function e(t,i,n,a){return BX.ajax.runAction("sale.barcode.isBarcodeExist",{data:{barcode:t,basketId:i,orderId:n,storeId:a}}).then(function(e){if(e.data&&typeof e.data.RESULT!=="undefined"){return e.data.RESULT}throw new Error("Result is unknown")})}}]);return e}();function n(){var e=babelHelpers.taggedTemplateLiteral(['<div class="sale-order-shipment-barcode">',"</div>"]);n=function t(){return e};return e}function a(){var e=babelHelpers.taggedTemplateLiteral(['<input type="text" onchange="','"',">"]);a=function t(){return e};return e}var r=function(){function e(i){babelHelpers.classCallCheck(this,e);this._id=i.id||0;this._value=i.value||"";this._readonly=i.readonly;this._node=null;this._inputNode=null;this._isExist=null;this._eventEmitter=new t.Event.EventEmitter}babelHelpers.createClass(e,[{key:"render",value:function e(){var i=this._readonly?' readonly="readonly"':"";this._inputNode=t.Tag.render(a(),this.onChange.bind(this),i);this._inputNode.value=this._value;this._node=t.Tag.render(n(),this._inputNode);return this._node}},{key:"onChange",value:function e(){this._value=this._inputNode.value;this._eventEmitter.emit("onChange",this)}},{key:"onChangeSubscribe",value:function e(t){this._eventEmitter.subscribe("onChange",t)}},{key:"showExistence",value:function e(t){if(t===false){this._node.classList.remove("exists");this._node.classList.add("not-exists")}else if(t===true){this._node.classList.remove("not-exists");this._node.classList.add("exists")}else if(t===null){this._node.classList.remove("not-exists");this._node.classList.remove("exists")}}},{key:"id",get:function e(){return this._id}},{key:"value",get:function e(){return this._value},set:function e(t){this._value=t;this._inputNode.value=t}},{key:"isExist",set:function e(t){this._isExist=t;this.showExistence(t)},get:function e(){return this._isExist}}]);return e}();function s(){var e=babelHelpers.taggedTemplateLiteral(['<input type="text" onchange="','"',">"]);s=function t(){return e};return e}var o=function(){function e(i){babelHelpers.classCallCheck(this,e);this._id=i.id||0;this._value=i.value||"";this._readonly=i.readonly;this._eventEmitter=new t.Event.EventEmitter}babelHelpers.createClass(e,[{key:"render",value:function e(){var i=this._readonly?' readonly="readonly"':"",n=t.Tag.render(s(),this.onChange.bind(this),i);n.value=this._value;return n}},{key:"onChange",value:function e(t){this._value=t.target.value;this._eventEmitter.emit("onChange",this)}},{key:"onChangeSubscribe",value:function e(t){this._eventEmitter.subscribe("onChange",t)}},{key:"id",get:function e(){return this._id}},{key:"value",get:function e(){return this._value}}]);return e}();function d(){var e=babelHelpers.taggedTemplateLiteral(["<table></table>"]);d=function t(){return e};return e}var u=function(){function e(i){babelHelpers.classCallCheck(this,e);this._headData=i.headData;this._orderId=i.orderId;this._basketId=i.basketId;this._storeId=i.storeId;this._isBarcodeMulti=i.isBarcodeMulti;this._readonly=i.readonly;this._items=this.createItems(i.rowData,i.rowsCount);this._eventEmitter=new t.Event.EventEmitter}babelHelpers.createClass(e,[{key:"createItems",value:function e(t,i){var n=this;var a=[];t.forEach(function(e){a.push(n.createItemsRow(e))});if(t.length<i){for(var r=0,s=i-t.length;r<s;r++){a.push(this.createEmptyRow())}}return a}},{key:"createEmptyRow",value:function t(){var i={id:0};if(this.isBarcodeNeeded()){var n=new r({});n.onChangeSubscribe(this.onBarcodeItemChange.bind(this));i[e.COLUMN_TYPE_BARCODE]=n}if(this.isMarkingCodeNeeded){var a=new o({});a.onChangeSubscribe(this.onMarkingCodeItemChange.bind(this));i[e.COLUMN_TYPE_MARKING_CODE]=a}return i}},{key:"onBarcodeItemChange",value:function e(t){var i=this;var n=t.data.value;this.isBarcodeExist(n.value).then(function(e){n.isExist=e;if(!i._isBarcodeMulti){i.synchronizeBarcodes(n.value,n.isExist)}i.onChange()}).catch(function(e){BX.debug(e)})}},{key:"onMarkingCodeItemChange",value:function e(){this.onChange()}},{key:"onChange",value:function e(){this._eventEmitter.emit("onChange",this)}},{key:"onChangeSubscribe",value:function e(t){this._eventEmitter.subscribe("onChange",t)}},{key:"synchronizeBarcodes",value:function t(i,n){this._items.forEach(function(t){if(t[e.COLUMN_TYPE_BARCODE]){t[e.COLUMN_TYPE_BARCODE].value=i;t[e.COLUMN_TYPE_BARCODE].isExist=n}})}},{key:"isBarcodeExist",value:function e(t){if(t.length>0){var i=this._isBarcodeMulti?this.storeId:0;return BX.Sale.Barcode.Checker.isBarcodeExist(t,this.basketId,this.orderId,i)}else{return new Promise(function(e){e(null)})}}},{key:"createItemsRow",value:function t(i){var n={id:i.id};if(this.isBarcodeNeeded()){var a=new r({id:i.id,value:i.barcode,widget:this,readonly:this._readonly});a.onChangeSubscribe(this.onBarcodeItemChange.bind(this));n[e.COLUMN_TYPE_BARCODE]=a}if(this.isMarkingCodeNeeded()){var s=new o({id:i.id,value:i.markingCode,readonly:this._readonly});s.onChangeSubscribe(this.onMarkingCodeItemChange.bind(this));n[e.COLUMN_TYPE_MARKING_CODE]=s}return n}},{key:"isBarcodeNeeded",value:function t(){return typeof this._headData[e.COLUMN_TYPE_BARCODE]!=="undefined"}},{key:"isMarkingCodeNeeded",value:function t(){return typeof this._headData[e.COLUMN_TYPE_MARKING_CODE]!=="undefined"}},{key:"createTh",value:function e(t){var i=document.createElement("th");i.innerHTML=this._headData[t].title;return i}},{key:"render",value:function i(){var n=this;var a=t.Tag.render(d());var r=a.insertRow();if(this.isBarcodeNeeded()){r.appendChild(this.createTh(e.COLUMN_TYPE_BARCODE))}if(this.isMarkingCodeNeeded()){r.appendChild(this.createTh(e.COLUMN_TYPE_MARKING_CODE))}this._items.forEach(function(t){var i=a.insertRow(-1);if(n.isBarcodeNeeded()){var r=i.insertCell();r.appendChild(t[e.COLUMN_TYPE_BARCODE].render())}if(n.isMarkingCodeNeeded()){var s=i.insertCell();s.appendChild(t[e.COLUMN_TYPE_MARKING_CODE].render())}});return a}},{key:"getItemsData",value:function t(){var i=[];this._items.forEach(function(t){i.push({id:t.id,barcode:{value:t[e.COLUMN_TYPE_BARCODE]?t[e.COLUMN_TYPE_BARCODE].value:"",isExist:t[e.COLUMN_TYPE_BARCODE]?t[e.COLUMN_TYPE_BARCODE].isExist:false},markingCode:{value:t[e.COLUMN_TYPE_MARKING_CODE]?t[e.COLUMN_TYPE_MARKING_CODE].value:""}})});return i}},{key:"orderId",get:function e(){return this._orderId}},{key:"basketId",get:function e(){return this._basketId}},{key:"storeId",get:function e(){return this._storeId}}]);return e}();babelHelpers.defineProperty(u,"COLUMN_TYPE_BARCODE","barcode");babelHelpers.defineProperty(u,"COLUMN_TYPE_MARKING_CODE","markingCode");e.Checker=i;e.Widget=u})(this.BX.Sale.Barcode=this.BX.Sale.Barcode||{},BX);
//# sourceMappingURL=barcode.bundle.map.js