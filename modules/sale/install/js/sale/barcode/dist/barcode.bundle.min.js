this.BX=this.BX||{};this.BX.Sale=this.BX.Sale||{};(function(e,t){"use strict";var i=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"isBarcodeExist",value:function e(t,i,n,s){return BX.ajax.runAction("sale.barcode.isBarcodeExist",{data:{barcode:t,basketId:i,orderId:n,storeId:s}}).then(function(e){if(e.data&&typeof e.data.RESULT!=="undefined"){return e.data.RESULT}throw new Error("Result is unknown")})}}]);return e}();function n(){var e=babelHelpers.taggedTemplateLiteral(['<div class="sale-order-shipment-barcode">',"</div>"]);n=function t(){return e};return e}function s(){var e=babelHelpers.taggedTemplateLiteral(['<input type="text" value="','" onchange="','">']);s=function t(){return e};return e}var a=function(){function e(i){babelHelpers.classCallCheck(this,e);this._id=i.id||0;this._value=i.value||"";this._node=null;this._inputNode=null;this._isExist=null;this._eventEmitter=new t.Event.EventEmitter}babelHelpers.createClass(e,[{key:"render",value:function e(){this._inputNode=t.Tag.render(s(),this._value,this.onChange.bind(this));this._node=t.Tag.render(n(),this._inputNode);return this._node}},{key:"onChange",value:function e(){this._value=this._inputNode.value;this._eventEmitter.emit("onChange",this)}},{key:"onChangeSubscribe",value:function e(t){this._eventEmitter.subscribe("onChange",t)}},{key:"showExistence",value:function e(t){if(t===false){this._node.classList.remove("exists");this._node.classList.add("not-exists")}else if(t===true){this._node.classList.remove("not-exists");this._node.classList.add("exists")}else if(t===null){this._node.classList.remove("not-exists");this._node.classList.remove("exists")}}},{key:"id",get:function e(){return this._id}},{key:"value",get:function e(){return this._value},set:function e(t){this._value=t;this._inputNode.value=t}},{key:"isExist",set:function e(t){this._isExist=t;this.showExistence(t)},get:function e(){return this._isExist}}]);return e}();function r(){var e=babelHelpers.taggedTemplateLiteral(['<input type="text" value="','" onchange="','">']);r=function t(){return e};return e}var u=function(){function e(t){babelHelpers.classCallCheck(this,e);this._id=t.id||0;this._value=t.value||""}babelHelpers.createClass(e,[{key:"render",value:function e(){return t.Tag.render(r(),this._value,this.onChange.bind(this))}},{key:"onChange",value:function e(t){this._value=t.target.value}},{key:"id",get:function e(){return this._id}},{key:"value",get:function e(){return this._value}}]);return e}();function o(){var e=babelHelpers.taggedTemplateLiteral(["<table></table>"]);o=function t(){return e};return e}var d=function(){function e(t){babelHelpers.classCallCheck(this,e);this._headData=t.headData;this._orderId=t.orderId;this._basketId=t.basketId;this._storeId=t.storeId;this._isBarcodeMulti=t.isBarcodeMulti;this._items=this.createItems(t.rowData,t.rowsCount)}babelHelpers.createClass(e,[{key:"createItems",value:function e(t,i){var n=this;var s=[];t.forEach(function(e){s.push(n.createItemsRow(e))});if(t.length<i){for(var a=0,r=i-t.length;a<r;a++){s.push(this.createEmptyRow())}}return s}},{key:"createEmptyRow",value:function t(){var i={id:0};if(this.isBarcodeNeeded()){var n=new a({});n.onChangeSubscribe(this.onBarcodeItemChange.bind(this));i[e.COLUMN_TYPE_BARCODE]=n}if(this.isMarkingCodeNeeded){i[e.COLUMN_TYPE_MARKING_CODE]=new u({})}return i}},{key:"onBarcodeItemChange",value:function e(t){var i=this;var n=t.data.value;this.isBarcodeExist(n.value).then(function(e){n.isExist=e;if(!i._isBarcodeMulti){i.synchronizeBarcodes(n.value,n.isExist)}}).catch(function(e){BX.debug(e)})}},{key:"synchronizeBarcodes",value:function t(i,n){this._items.forEach(function(t){if(t[e.COLUMN_TYPE_BARCODE]){t[e.COLUMN_TYPE_BARCODE].value=i;t[e.COLUMN_TYPE_BARCODE].isExist=n}})}},{key:"isBarcodeExist",value:function e(t){if(t.length>0){var i=this._isBarcodeMulti?this.storeId:0;return BX.Sale.Barcode.Checker.isBarcodeExist(t,this.basketId,this.orderId,i)}else{return new Promise(function(e){e(null)})}}},{key:"createItemsRow",value:function t(i){var n={id:i.id};if(this.isBarcodeNeeded()){var s=new a({id:i.id,value:i.barcode,widget:this});s.onChangeSubscribe(this.onBarcodeItemChange.bind(this));n[e.COLUMN_TYPE_BARCODE]=s}if(this.isMarkingCodeNeeded()){n[e.COLUMN_TYPE_MARKING_CODE]=new u({id:i.id,value:i.markingCode})}return n}},{key:"isBarcodeNeeded",value:function t(){return typeof this._headData[e.COLUMN_TYPE_BARCODE]!=="undefined"}},{key:"isMarkingCodeNeeded",value:function t(){return typeof this._headData[e.COLUMN_TYPE_MARKING_CODE]!=="undefined"}},{key:"createTh",value:function e(t){var i=document.createElement("th");i.innerHTML=this._headData[t].title;return i}},{key:"render",value:function i(){var n=this;var s=t.Tag.render(o());var a=s.insertRow();if(this.isBarcodeNeeded()){a.appendChild(this.createTh(e.COLUMN_TYPE_BARCODE))}if(this.isMarkingCodeNeeded()){a.appendChild(this.createTh(e.COLUMN_TYPE_MARKING_CODE))}this._items.forEach(function(t){var i=s.insertRow(-1);if(n.isBarcodeNeeded()){var a=i.insertCell();a.appendChild(t[e.COLUMN_TYPE_BARCODE].render())}if(n.isMarkingCodeNeeded()){var r=i.insertCell();r.appendChild(t[e.COLUMN_TYPE_MARKING_CODE].render())}});return s}},{key:"getItemsData",value:function t(){var i=[];this._items.forEach(function(t){i.push({id:t.id,barcode:{value:t[e.COLUMN_TYPE_BARCODE]?t[e.COLUMN_TYPE_BARCODE].value:"",isExist:t[e.COLUMN_TYPE_BARCODE]?t[e.COLUMN_TYPE_BARCODE].isExist:false},markingCode:{value:t[e.COLUMN_TYPE_MARKING_CODE]?t[e.COLUMN_TYPE_MARKING_CODE].value:""}})});return i}},{key:"orderId",get:function e(){return this._orderId}},{key:"basketId",get:function e(){return this._basketId}},{key:"storeId",get:function e(){return this._storeId}}]);return e}();babelHelpers.defineProperty(d,"COLUMN_TYPE_BARCODE","barcode");babelHelpers.defineProperty(d,"COLUMN_TYPE_MARKING_CODE","markingCode");e.Checker=i;e.Widget=d})(this.BX.Sale.Barcode=this.BX.Sale.Barcode||{},BX);
//# sourceMappingURL=barcode.bundle.map.js