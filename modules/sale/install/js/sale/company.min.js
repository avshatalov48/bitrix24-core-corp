(function(e){if(!BX.Sale)BX.Sale={};if(BX.Sale.Company)return;BX.Sale.Company={ajaxUrl:"/bitrix/admin/sale_company_ajax.php",getRuleParamsHtml:function(a){if(!a.class)return;a.params=a.params||{};a.ruleId=a.ruleId||0;a.sort=a.sort||100;ShowWaitWindow();var t={action:"get_rule_params_html",className:a.class,params:a.params,companyId:a.companyId,sort:a.sort,lang:a.lang,sessid:BX.bitrix_sessid()};BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.ajaxUrl,data:t,onsuccess:function(t){CloseWaitWindow();if(t&&t.RULE_HTML&&!t.ERROR){var o=BX.processHTML(t.RULE_HTML);BX.Sale.Company.showRuleParamsDialog(o["HTML"],a);e["companyGetRuleHtmlScriptsLoadingStarted"]=false;var r=function(a){if(!a)BX.removeCustomEvent("companyGetRuleHtmlScriptsReady",r);for(var t in o["SCRIPT"]){BX.evalGlobal(o["SCRIPT"][t]["JS"]);delete o["SCRIPT"][t];if(a&&e["companyGetRuleHtmlScriptsLoadingStarted"])return}};BX.addCustomEvent("companyGetRuleHtmlScriptsReady",r);r(true);BX.loadCSS(o["STYLE"])}else if(t&&t.ERROR){BX.debug("Error receiving rule params html: "+t.ERROR)}else{BX.debug("Error receiving rule params html!")}},onfailure:function(){CloseWaitWindow();BX.debug("Error adding rule!")}})},showRuleParamsDialog:function(e,a){if(a.class=="\\Bitrix\\Sale\\Services\\Company\\Restrictions\\Location")var t=1030;else t=400;var o=new BX.CDialog({content:'<form id="sale-company_rule-edit-form">'+e+"</form>",title:BX.message("SALE_COMPANY_RULE_TITLE")+": "+a.title,width:t,height:500,resizable:true});o.ClearButtons();o.SetButtons([{title:BX.message("SALE_COMPANY_RULE_SAVE"),action:function(){var e=BX("sale-company_rule-edit-form"),t=BX.ajax.prepareForm(e),o=!!t&&t.data?t.data:{};BX.Sale.Company.saveRule(a,o);this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]);BX.addCustomEvent(o,"onWindowClose",function(e){e.DIV.parentNode.removeChild(e.DIV)});o.Show();o.adjustSizeEx()},saveRule:function(e,a){ShowWaitWindow();var t=a.RULE||{},o={action:"save_rule",params:t,sort:a.SORT,className:e.class,companyId:e.companyId,ruleId:e.ruleId,sessid:BX.bitrix_sessid(),lang:BX.message("LANGUAGE_ID")};BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.ajaxUrl,data:o,onsuccess:function(e){CloseWaitWindow();if(e&&!e.ERROR){if(e.HTML)BX.Sale.Company.insertAjaxRuleHtml(e.HTML)}else{alert(e.ERROR)}},onfailure:function(){CloseWaitWindow()}})},deleteRule:function(e,a){if(!e)return;ShowWaitWindow();var t={action:"delete_rule",ruleId:e,companyId:a,sessid:BX.bitrix_sessid(),lang:BX.message("LANGUAGE_ID")};BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.ajaxUrl,data:t,onsuccess:function(e){CloseWaitWindow();if(e&&!e.ERROR){if(e.HTML)BX.Sale.Company.insertAjaxRuleHtml(e.HTML);if(e.ERROR)BX.debug("Error deleting rule: "+e.ERROR)}else{BX.debug("Error deleting rule!")}},onfailure:function(){CloseWaitWindow();BX.debug("Error refreshing rule!")}})},insertAjaxRuleHtml:function(e){var a=BX.processHTML(e),t=BX("sale-company-rules-container");if(!t)return;BX.loadCSS(a["STYLE"]);t.innerHTML=a["HTML"];for(var o in a["SCRIPT"])BX.evalGlobal(a["SCRIPT"][o]["JS"])}}})(window);
//# sourceMappingURL=company.map.js