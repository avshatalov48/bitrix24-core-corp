BX.ui.fileAsyncLoader=function(e,t){this.parentConstruct(BX.ui.fileAsyncLoader,e);BX.merge(this,{opts:{timeout:800,url:"/somewhere.php",fileUploadTag:"FILE_UPLOAD"},vars:{prevValue:""},ctrls:{},sys:{code:"file-async-loader"}});this.handleInitStack(t,BX.ui.fileAsyncLoader,e)};BX.extend(BX.ui.fileAsyncLoader,BX.ui.widget);BX.merge(BX.ui.fileAsyncLoader.prototype,{init:function(){var e=this.ctrls,t=this.vars;e.success=this.getControl("success");e.fail=this.getControl("fail");e.inProgress=this.getControl("in-progress");e.inputContainer=this.getControl("input");e.input=e.scope.querySelector('input[type="file"]');t.randomTag=this.getRandom();this.pushFuncStack("bindEvents",BX.ui.fileAsyncLoader)},bindEvents:function(){var e=this;this.startMonitor();BX.bindDelegate(this.ctrls.scope,"click",{className:e.getControlClassName("retry")},function(){e.upload()})},startMonitor:function(){var e=this.ctrls,t=this.vars,i=this.opts,s=this;if(e.input.value!=t.prevValue){t.prevValue=e.input.value;if(t.prevValue.length>0){this.upload();return}}setTimeout(BX.proxy(this.startMonitor,this),i.timeout)},hideMessages:function(){var e=this.ctrls;BX.hide(e.success);BX.hide(e.fail);BX.hide(e.inProgress)},deSelect:function(){var e=this.ctrls;this.hideMessages();var t=BX.clone(e.input);BX.insertAfter(t,e.input);BX.remove(e.input);e.input=t},upload:function(){var e=this.opts,t=this.vars,i=this.ctrls;if(i.input.value.length==0)return;var s=BX.create("form",{props:{enctype:"multipart/form-data",action:e.url,method:"post",target:t.randomTag},style:{display:"none"}});var r=BX.create("input",{props:{type:"hidden",name:e.fileUploadTag,value:t.randomTag}});s.appendChild(r);var n=document.querySelector("body");n.appendChild(s);var a=BX.create("iframe",{props:{name:t.randomTag},style:{display:"none"}});n.appendChild(a);s.appendChild(i.input);if(typeof BX[this.sys.code]=="undefined")BX[this.sys.code]={};BX[this.sys.code][t.randomTag]=this;i.form=s;i.iframe=a;BX.hide(i.success);BX.hide(i.fail);BX.show(i.inProgress);s.submit()},uploadSuccess:function(){var e=this.ctrls;this.cleanUp();BX.show(e.success);BX.hide(e.fail);this.fireEvent("upload-success")},uploadFail:function(e){var t=this.ctrls;this.cleanUp();BX.show(t.fail);BX.hide(t.success);this.fireEvent("upload-fail")},cleanUp:function(){var e=this.ctrls;BX.hide(e.inProgress);BX.remove(e.iframe);e.inputContainer.appendChild(e.input);BX.remove(e.form);this.startMonitor()}});
//# sourceMappingURL=core_ui_fileasyncloader.map.js