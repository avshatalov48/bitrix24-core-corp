this.BX=this.BX||{};this.BX.Sale=this.BX.Sale||{};(function(t,e,s,r,o,n,i,a,c){"use strict";n.BitrixVue.component("sale-checkout-form",{data:function t(){return{stage:c.Application.stage,mode:c.Application.mode,status:c.Loader.status,totalIsShow:"N"}},computed:{checkoutButtonEnabled:function t(){var e=[];var s=this.$store.getters["property/getProperty"];for(var r in s){if(!a.Type.isStringFilled(s[r].value)&&s[r].required==="Y"){return false}if(!a.Type.isStringFilled(s[r].value)){continue}if(s[r].type===c.Property.type.checkbox&&s[r].required==="Y"&&s[r].value!=="Y"){return false}if(s[r].type===c.Property.type.checkbox){continue}e.push(s[r].value)}return e.length>0},hasPS:function t(){var e=[];var s=this.$store.getters["pay-system/getPaySystem"];s.forEach((function(t){if(t.type!==c.PaySystem.type.cash){e.push(t)}}));return e.length>0},needCheckConsent:function t(){return this.getConsent.id>0},getBasket:function t(){return this.$store.getters["basket/getBasket"]},getBasketErrors:function t(){return this.$store.getters["basket/getErrors"]},getOrder:function t(){return this.$store.getters["order/getOrder"]},getProperty:function t(){return this.$store.getters["property/getProperty"]},getVariant:function t(){return this.$store.getters["property-variant/getVariant"]},getPropertyErrors:function t(){return this.$store.getters["property/getErrors"]},getTotal:function t(){var e=this.$store.getters["basket/getTotal"];return{price:e.price,basePrice:e.basePrice,discount:this.$store.getters["basket/getDiscount"],currency:this.$store.getters["basket/getCurrency"]}},getConsent:function t(){return this.$store.getters["consent/get"]},getStage:function t(){return this.$store.getters["application/getStage"]},getStatus:function t(){return this.$store.getters["application/getStatus"]},getBasketConfig:function t(){return{status:this.$store.getters["basket/getStatus"]}},getPaySystem:function t(){return this.$store.getters["pay-system/getPaySystem"]},getCheck:function t(){return this.$store.getters["check/getCheck"]},getPayment:function t(){return this.$store.getters["payment/getPayment"]},getPaymentConfig:function t(){return{status:this.$store.getters["pay-system/getStatus"],returnUrl:this.$store.getters["application/getPathLocation"],mainPage:this.$store.getters["application/getPathMainPage"]}},getSuccessfulConfig:function t(){return{mainPage:this.$store.getters["application/getPathMainPage"]}},getEmptyCartConfig:function t(){return{path:this.$store.getters["application/getPath"]}},getTitleCheckoutButton:function t(){return{title:this.$store.getters["application/getTitleCheckoutButton"]}},getErrors:function t(){return this.$store.getters["application/getErrors"]}},created:function t(){var e=this;i.EventEmitter.subscribe(c.EventType.basket.backdropTotalOpen,(function(t){e.totalIsShow="Y"}));i.EventEmitter.subscribe(c.EventType.basket.backdropTotalClose,(function(t){e.totalIsShow="N"}))},beforeDestroy:function t(){i.EventEmitter.unsubscribe(c.EventType.basket.backdropTotalOpen);i.EventEmitter.unsubscribe(c.EventType.basket.backdropTotalClose)},template:'\n      <div class="checkout-container-wrapper">\n\t\t  <div class="checkout-basket-container">\n\t\t\t<template v-if="getStage === stage.edit">\n\t\t\t  <sale-checkout-view-product :items="getBasket" :total="getTotal" :mode="mode.edit" :errors="getBasketErrors" :config="getBasketConfig"/>\n\t\t\t  <sale-checkout-view-property :items="getProperty" :mode="mode.edit" :errors="getPropertyErrors" :propertyVariants="getVariant"/>\n\t\t\t  <sale-checkout-view-alert-list :errors="getErrors"/>\n\t\t\t  <sale-checkout-view-user_consent :item="getConsent" v-if="needCheckConsent"/>\n\t\t\t  <template v-if="checkoutButtonEnabled">\n\t\t\t\t<sale-checkout-view-element-button-checkout :title="getTitleCheckoutButton.title" :wait="getStatus === status.wait"/>\n\t\t\t  </template>\n\t\t\t  <template v-else>\n\t\t\t\t<sale-checkout-view-element-button-checkout_disabled :title="getTitleCheckoutButton.title"/>\n\t\t\t  </template>\n\t\t\t</template>\n\t\t\t<template v-else-if="getStage === stage.success">\n\t\t\t  <template v-if="hasPS">\n\t\t\t\t<sale-checkout-view-successful :items="getProperty" :order="getOrder" :config="getSuccessfulConfig"/>\n\t\t\t  </template>\n\t\t\t  <template v-else>\n\t\t\t\t<sale-checkout-view-successful-without-ps :items="getProperty" :order="getOrder" :config="getSuccessfulConfig"/>\n\t\t\t  </template>\n\t\t\t</template>\n\t\t\t<template v-else-if="getStage === stage.payed">\n              <sale-checkout-view-successful_ps_return :items="getProperty" :order="getOrder" :total="getTotal" :config="getSuccessfulConfig"/>\n\t\t\t</template>\n\t\t\t<template v-else-if="getStage === stage.view">\n\t\t\t  <sale-checkout-view-product :items="getBasket" :total="getTotal" :mode="mode.view" :errors="getBasketErrors" :config="getBasketConfig"/>\n\t\t\t  <sale-checkout-view-property :items="getProperty" :mode="mode.view" :order="getOrder" :propertyVariants="getVariant"/>\n\t\t\t  <sale-checkout-view-product-summary :total="getTotal" :mode="mode.view"/>\n              <sale-checkout-view-payment :order="getOrder" :payments="getPayment" :paySystems="getPaySystem" :check="getCheck" :config="getPaymentConfig"/>\n\t\t\t</template>\n\t\t\t<template v-else-if="getStage === stage.empty">\n\t\t\t  <sale-checkout-view-empty_cart :config="getEmptyCartConfig"/>\n\t\t\t</template>\n\t\t  </div>\n\t\t  <template v-if="getStage === stage.view">\n\t\t\t<sale-checkout-view-total :total="getTotal" :showBackdrop="totalIsShow"/>\n\t\t  </template>\n      </div>\n\t'});var p;var u=function(){function t(){var e=this;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);this.wrapper=a.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['<div class=""></div>'])));this.init().then((function(){return e.prepareParams({options:s})})).then((function(){e.initStore().then((function(t){e.setStore(t);e.initController().then((function(){}));e.initTemplate().then((function(){}))}))["catch"]((function(e){return t.showError(e)}))}))}babelHelpers.createClass(t,[{key:"init",value:function t(){return Promise.resolve()}},{key:"prepareParams",value:function t(e){this.options=e.options;return Promise.resolve()}},{key:"initStore",value:function t(){var r=new s.VuexBuilder;var n={product:this.options.product};var i={path:this.options.path,common:this.options.common,option:this.options.option,messages:this.options.messages};i.path.location=e.Url.getCurrentUrl();return r.addModel(o.Order.create()).addModel(o.Basket.create().setVariables(n)).addModel(o.Property.create()).addModel(o.Variant.create()).addModel(o.Payment.create()).addModel(o.Check.create()).addModel(o.PaySystem.create()).addModel(o.Application.create().setVariables(i)).addModel(o.Consent.create()).build()}},{key:"layout",value:function t(){return this.wrapper}},{key:"initController",value:function t(){this.controller=new r.Application({store:this.store});return new Promise((function(t){return t()}))}},{key:"initTemplate",value:function t(){var e=this;return new Promise((function(t){var s=e;e.templateEngine=n.BitrixVue.createApp({store:e.store,data:{options:e.options},beforeCreate:function t(){this.$bitrix.Application.set(s)},created:function t(){var e={};if(s.options.basket.length>0){e={order:this.options.order,basket:this.options.basket,paySystem:this.options.paySystem,payment:this.options.payment,check:this.options.check,total:this.options.total,currency:this.options.currency,discount:this.options.discount,property:this.options.property,variant:this.options.variant,consent:this.options.consent,consentStatus:this.options.consentStatus}}e.stage=this.options.stage;s.setModelData(e)},mounted:function e(){t()},template:"<sale-checkout-form/>"}).mount(e.wrapper)}))}},{key:"setStore",value:function t(e){this.store=e.store}},{key:"setModelData",value:function t(e){var s=this;if(a.Type.isString(e.stage)){this.store.dispatch("application/setStage",{stage:e.stage})}if(a.Type.isObject(e.order)){this.store.dispatch("order/set",e.order)}if(a.Type.isObject(e.basket)){e.basket.forEach((function(t,e){s.store.dispatch("basket/changeItem",{index:e,fields:t})}))}if(a.Type.isString(e.currency)){this.store.dispatch("basket/setCurrency",{currency:e.currency})}if(a.Type.isObject(e.discount)){this.store.dispatch("basket/setDiscount",e.discount)}if(a.Type.isObject(e.total)){this.store.dispatch("basket/setTotal",e.total)}if(a.Type.isObject(e.property)){e.property.forEach((function(t,e){s.store.dispatch("property/changeItem",{index:e,fields:t})}))}if(a.Type.isObject(e.variant)){e.variant.forEach((function(t,e){s.store.dispatch("property-variant/changeItem",{index:e,fields:t})}))}if(a.Type.isObject(e.payment)){e.payment.forEach((function(t,e){s.store.dispatch("payment/changeItem",{index:e,fields:t})}))}if(a.Type.isObject(e.check)){e.check.forEach((function(t,e){s.store.dispatch("check/changeItem",{index:e,fields:t})}))}if(a.Type.isObject(e.paySystem)){e.paySystem.forEach((function(t,e){s.store.dispatch("pay-system/changeItem",{index:e,fields:t})}))}if(a.Type.isString(e.consentStatus)){this.store.dispatch("consent/setStatus",e.consentStatus)}if(a.Type.isObject(e.consent)){this.store.dispatch("consent/set",e.consent)}if(a.Type.isObject(e.errors)){this.store.commit("basket/setErrors",e.errors)}}}],[{key:"showError",value:function t(e){console.error(e)}}]);return t}();t.Application=u})(this.BX.Sale.Checkout=this.BX.Sale.Checkout||{},BX.Sale.Checkout.Lib,BX,BX.Sale.Checkout.Controller,BX.Sale.Checkout.Model,BX,BX.Event,BX,BX.Sale.Checkout.Const);
//# sourceMappingURL=application.bundle.map.js