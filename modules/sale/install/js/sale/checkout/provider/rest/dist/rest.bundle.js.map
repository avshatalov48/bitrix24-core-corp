{"version":3,"file":"rest.bundle.js","sources":["../src/base.js","../src/basket.js"],"sourcesContent":["class BaseRestHandler\r\n{\r\n    static create(params = {})\r\n    {\r\n        return new this(params);\r\n    }\r\n\r\n    constructor(params = {})\r\n    {\r\n        if (typeof params.store === 'object' && params.store)\r\n        {\r\n            this.store = params.store;\r\n        }\r\n    }\r\n\r\n    execute(command, result, extra = {})\r\n    {\r\n        command = 'handle'+command.split('.').map(element => {\r\n            return element.charAt(0).toUpperCase() + element.slice(1);\r\n        }).join('');\r\n\r\n        if (result.error)\r\n        {\r\n            if (typeof this[command+'Error'] === 'function')\r\n            {\r\n                return this[command+'Error'](result.error, extra);\r\n            }\r\n        }\r\n        else\r\n        {\r\n            if (typeof this[command+'Success'] === 'function')\r\n            {\r\n                return this[command+'Success'](result.data, extra);\r\n            }\r\n        }\r\n\r\n        return typeof this[command] === 'function'? this[command](result, extra): null;\r\n    }\r\n}\r\n\r\nexport {BaseRestHandler};","import { BaseRestHandler } from \"./base\";\r\nimport { Type, Event } from 'main.core';\r\nimport { EventType } from 'sale.checkout.const';\r\nimport {\r\n    Application as ApplicationConst,\r\n    Property as PropertyConst,\r\n    Loader as LoaderConst,\r\n    Pool as PoolConst\r\n} from 'sale.checkout.const';\r\n\r\nexport class BasketRestHandler extends BaseRestHandler\r\n{\r\n    handleRecalculateBasket(response, pool)\r\n    {\r\n        return new Promise((resolve, reject) =>\r\n        {\r\n            this.#setModelBasketForAction(response.data, pool)\r\n                .then(() => resolve());\r\n        });\r\n    }\r\n\r\n    #setModelBasketForAction(data, pool)\r\n    {\r\n        return new Promise((resolve, reject) =>\r\n        {\r\n            if(Type.isObject(data) && Type.isArray(data.basketItems))\r\n            {\r\n                const items = data.basketItems;\r\n                const actions = data.actions;\r\n                const collection = this.store.getters['basket/getBasket'];\r\n\r\n                collection.forEach((fields, index) =>\r\n                {\r\n                    let item;\r\n                    let action = this.#getTypeAction(actions, index);\r\n\r\n                    if(Type.isString(action))\r\n                    {\r\n                        if(action === PoolConst.action.quantity)\r\n                        {\r\n                            item = null; //not refresh\r\n\r\n                            let exists = this.#hasActionInPool(index, PoolConst.action.quantity, pool);\r\n                            if(exists === false)\r\n                            {\r\n                                item = this.#findItemById(fields.id, items)\r\n                            }\r\n                        }\r\n                        else if(action === PoolConst.action.restore)\r\n                        {\r\n                            item = this.#findItemById(actions[index].fields.id, items)\r\n                        }\r\n                        else if(action === PoolConst.action.delete)\r\n                        {\r\n                            fields.status = LoaderConst.status.none;\r\n                            this.#changeBasketItem(fields, index)\r\n                                .then(()=> Event.EventEmitter.emit(EventType.basket.removeProduct, {index}));\r\n                        }\r\n                        else // for example: offer\r\n                        {\r\n                            // item = this.#findItemById(fields.id, items)\r\n                        }\r\n\r\n                        if(Type.isObject(item))\r\n                        {\r\n                            let fields = this.#prepareBasketItemFields(item);\r\n\r\n                            fields.status = LoaderConst.status.none;\r\n                            this.#changeBasketItem(fields, index);\r\n                        }\r\n                    }\r\n                });\r\n\r\n                if(Type.isObject(data) && Type.isObject(data.orderPriceTotal))\r\n                {\r\n                    this.#refreshModelBasketTotal(data);\r\n                    this.#refreshModelBasketDiscount(data);\r\n                }\r\n            }\r\n\r\n            resolve();\r\n        });\r\n    }\r\n\r\n    #getTypeAction(actions, index)\r\n    {\r\n        const types = Object.values(PoolConst.action);\r\n\r\n        if(actions.hasOwnProperty(index))\r\n        {\r\n            let type = actions[index].type.toString();\r\n            return types.includes(type) ? type : null;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    #hasActionInPool(index, type, pool)\r\n    {\r\n        let item = pool.hasOwnProperty(index) ? pool[index]:null;\r\n        if(Type.isArray(item))\r\n        {\r\n            return this.#hasActionInPoolItem(item, type);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    #hasActionInPoolItem(item, type)\r\n    {\r\n        return item.some((item)=>item.hasOwnProperty(type))\r\n    }\r\n\r\n    #findItemById(id, items)\r\n    {\r\n        id = parseInt(id);\r\n\r\n        for (let index in items)\r\n        {\r\n            if (!items.hasOwnProperty(index))\r\n            {\r\n                continue;\r\n            }\r\n\r\n            items[index].id = parseInt(items[index].id);\r\n\r\n            if(items[index].id === id)\r\n            {\r\n                return items[index];\r\n            }\r\n        }\r\n\r\n        return null\r\n    }\r\n\r\n    #changeBasketItem(fields, index)\r\n    {\r\n        return this.store.dispatch('basket/changeItem', {index, fields});\r\n    }\r\n\r\n    #prepareBasketItemFields(item)\r\n    {\r\n        return {\r\n            id: item.id,\r\n            name: item.name,\r\n            quantity: item.quantity,\r\n            measureText: item.measureText,\r\n            sum: item.sum,\r\n            price: item.price,\r\n            module: item.module,\r\n            productProviderClass: item.productProviderClass,\r\n            baseSum: item.sumBase,\r\n            basePrice: item.basePrice,\r\n            currency: item.currency,\r\n            discount: {\r\n                sum: item.sumDiscountDiff,\r\n                price: item.discountPrice\r\n            },\r\n            props: item.props,\r\n            product: {\r\n                id: item.catalogProduct.id,\r\n                detailPageUrl: item.detailPageUrl,\r\n                picture: Type.isObject(item.catalogProduct.frontImage) ? item.catalogProduct.frontImage.src:null,\r\n                ratio: item.catalogProduct.ratio,\r\n                availableQuantity: item.catalogProduct.availableQuantity\r\n            }\r\n        };\r\n    }\r\n\r\n    #refreshModelBasketTotal(data)\r\n    {\r\n        let total = data.orderPriceTotal;\r\n\r\n        this.store.dispatch('basket/setTotal', {\r\n            price : total.orderPrice,\r\n            basePrice : total.priceWithoutDiscountValue,\r\n        });\r\n    }\r\n\r\n    #refreshModelBasketDiscount(data)\r\n    {\r\n        let total = data.orderPriceTotal;\r\n\r\n        this.store.dispatch('basket/setDiscount', {\r\n            sum: total.basketPriceDiscountDiffValue\r\n        });\r\n    }\r\n\r\n    handleSaveOrderSuccess(data)\r\n    {\r\n        Event.EventEmitter.emit(EventType.order.success);\r\n\r\n        this.store.dispatch('application/setStage', {stage: ApplicationConst.stage.success});\r\n        this.store.dispatch('order/set', {\r\n            id: data.order.id,\r\n            hash: data.hash,\r\n            accountNumber: data.order.accountNumber\r\n        });\r\n\r\n        return this.#refreshModelBasket(data)\r\n            .then(()=>this.#refreshModelProperty(data))\r\n    }\r\n\r\n    #refreshModelProperty(data)\r\n    {\r\n        this.store.commit('property/clearProperty');\r\n\r\n        if(Type.isObject(data) && Type.isArray(data.properties))\r\n        {\r\n            data.properties.forEach((item, index) => {\r\n                let fields = {\r\n                    id : item.id,\r\n                    name : item.name,\r\n                    type : item.type,\r\n                    value : item.value[0],//TODO\r\n                };\r\n\r\n                this.store.dispatch('property/changeItem', {index, fields});\r\n            });\r\n        }\r\n    }\r\n\r\n    #refreshModelBasket(data)\r\n    {\r\n        return new Promise((resolve, reject) => {\r\n\r\n            this.store.commit('basket/clearBasket');\r\n\r\n            if(Type.isObject(data) && Type.isArray(data.basketItems))\r\n            {\r\n                const items = data.basketItems;\r\n                items.forEach((item, index) => {\r\n                    let fields = this.#prepareBasketItemFields(item);\r\n                    this.#changeBasketItem(fields, index)});\r\n            }\r\n\r\n            if(Type.isObject(data) && Type.isObject(data.orderPriceTotal))\r\n            {\r\n                this.#refreshModelBasketTotal(data)\r\n                this.#refreshModelBasketDiscount(data)\r\n            }\r\n\r\n            resolve();\r\n        });\r\n    }\r\n\r\n    handleSaveOrderError(errors)\r\n    {\r\n        return new Promise((resolve, reject) => {\r\n            if (Type.isArrayFilled(errors))\r\n            {\r\n                let general = this.#prepareGeneralErrors(errors)\r\n                let properties = this.#preparePropertyErrors(errors);\r\n\r\n                if(general.length > 0)\r\n                {\r\n                    this.store.commit('application/setErrors', general);\r\n                }\r\n                else\r\n                {\r\n                    this.store.commit('application/clearErrors');\r\n                }\r\n\r\n                if(properties.length > 0)\r\n                {\r\n                    this.store.commit('property/setErrors', properties);\r\n\r\n                    this.store.getters['property/getProperty']\r\n                        .forEach((fields, index)=>\r\n                        {\r\n                            if(typeof properties.find(item => item.propertyId === fields.id) !== 'undefined')\r\n                            {\r\n                                fields.validated = PropertyConst.validate.failure\r\n                            }\r\n                            else\r\n                            {\r\n                                if(fields.validated !== PropertyConst.validate.unvalidated)\r\n                                {\r\n                                    fields.validated = PropertyConst.validate.successful\r\n                                }\r\n                            }\r\n                            this.store.dispatch('property/changeItem', {index, fields});\r\n                        })\r\n                }\r\n                else\r\n                {\r\n                    this.store.commit('property/clearErrors');\r\n\r\n                    this.store.getters['property/getProperty']\r\n                        .forEach((fields, index)=>\r\n                        {\r\n                            if(fields.validated !== PropertyConst.validate.unvalidated)\r\n                            {\r\n                                fields.validated = PropertyConst.validate.successful\r\n                            }\r\n                            this.store.dispatch('property/changeItem', {index, fields});\r\n                        })\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    #preparePropertyErrors(errors)\r\n    {\r\n        const result = [];\r\n\r\n        errors.forEach((fields)=>{\r\n            if(fields.code === 'PROPERTIES')\r\n            {\r\n                if (fields.hasOwnProperty('customData'))\r\n                {\r\n                    let id = parseInt(fields.customData.id)\r\n                    result.push({message: fields.message, propertyId: id});\r\n                }\r\n            }\r\n        })\r\n        return result;\r\n    }\r\n\r\n    #prepareGeneralErrors(errors)\r\n    {\r\n        const result = [];\r\n\r\n        errors.forEach((fields)=>{\r\n            if(parseInt(fields.code) === 0 || fields.code === 'ORDER')\r\n            {\r\n                result.push({message: fields.message})\r\n            }\r\n        })\r\n        return result;\r\n    }\r\n}"],"names":["BaseRestHandler","params","store","command","result","extra","split","map","element","charAt","toUpperCase","slice","join","error","data","BasketRestHandler","response","pool","Promise","resolve","reject","then","Event","EventEmitter","emit","EventType","order","success","dispatch","stage","ApplicationConst","id","hash","accountNumber","errors","Type","isArrayFilled","general","properties","length","commit","getters","forEach","fields","index","find","item","propertyId","validated","PropertyConst","validate","failure","unvalidated","successful","isObject","isArray","basketItems","items","actions","collection","action","isString","PoolConst","quantity","exists","restore","delete","status","LoaderConst","none","basket","removeProduct","orderPriceTotal","types","Object","values","hasOwnProperty","type","toString","includes","some","parseInt","name","measureText","sum","price","module","productProviderClass","baseSum","sumBase","basePrice","currency","discount","sumDiscountDiff","discountPrice","props","product","catalogProduct","detailPageUrl","picture","frontImage","src","ratio","availableQuantity","total","orderPrice","priceWithoutDiscountValue","basketPriceDiscountDiffValue","value","code","customData","push","message"],"mappings":"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"}