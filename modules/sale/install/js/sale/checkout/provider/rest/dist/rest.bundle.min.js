this.BX=this.BX||{};this.BX.Sale=this.BX.Sale||{};this.BX.Sale.Checkout=this.BX.Sale.Checkout||{};(function(e,t,r){"use strict";var a=function(){babelHelpers.createClass(e,null,[{key:"create",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(t)}}]);function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);if(babelHelpers.typeof(t.store)==="object"&&t.store){this.store=t.store}}babelHelpers.createClass(e,[{key:"execute",value:function e(t,r){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};t="handle"+t.split(".").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("");if(r.error){if(typeof this[t+"Error"]==="function"){return this[t+"Error"](r.error,a)}}else{if(typeof this[t+"Success"]==="function"){return this[t+"Success"](r.data,a)}}return typeof this[t]==="function"?this[t](r,a):null}}]);return e}();function i(e,t,r){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return r}var s=new WeakSet;var n=new WeakSet;var o=new WeakSet;var l=new WeakSet;var c=new WeakSet;var u=new WeakSet;var d=new WeakSet;var p=new WeakSet;var f=new WeakSet;var h=new WeakSet;var v=new WeakSet;var b=new WeakSet;var y=new WeakSet;var m=function(e){babelHelpers.inherits(a,e);function a(){var e;var t;babelHelpers.classCallCheck(this,a);for(var r=arguments.length,i=new Array(r),m=0;m<r;m++){i[m]=arguments[m]}t=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(a)).call.apply(e,[this].concat(i)));y.add(babelHelpers.assertThisInitialized(t));b.add(babelHelpers.assertThisInitialized(t));v.add(babelHelpers.assertThisInitialized(t));h.add(babelHelpers.assertThisInitialized(t));f.add(babelHelpers.assertThisInitialized(t));p.add(babelHelpers.assertThisInitialized(t));d.add(babelHelpers.assertThisInitialized(t));u.add(babelHelpers.assertThisInitialized(t));c.add(babelHelpers.assertThisInitialized(t));l.add(babelHelpers.assertThisInitialized(t));o.add(babelHelpers.assertThisInitialized(t));n.add(babelHelpers.assertThisInitialized(t));s.add(babelHelpers.assertThisInitialized(t));return t}babelHelpers.createClass(a,[{key:"handleRecalculateBasket",value:function e(t,r){var a=this;return new Promise(function(e,n){i(a,s,P).call(a,t.data,r).then(function(){return e()})})}},{key:"handleSaveOrderSuccess",value:function e(a){var s=this;t.Event.EventEmitter.emit(r.EventType.order.success);this.store.dispatch("application/setStage",{stage:r.Application.stage.success});this.store.dispatch("order/set",{id:a.order.id,hash:a.hash,accountNumber:a.order.accountNumber});return i(this,v,C).call(this,a).then(function(){return i(s,h,O).call(s,a)})}},{key:"handleSaveOrderError",value:function e(a){var s=this;return new Promise(function(e,n){if(t.Type.isArrayFilled(a)){var o=i(s,y,W).call(s,a);var l=i(s,b,B).call(s,a);if(o.length>0){s.store.commit("application/setErrors",o)}else{s.store.commit("application/clearErrors")}if(l.length>0){s.store.commit("property/setErrors",l);s.store.getters["property/getProperty"].forEach(function(e,t){if(typeof l.find(function(t){return t.propertyId===e.id})!=="undefined"){e.validated=r.Property.validate.failure}else{if(e.validated!==r.Property.validate.unvalidated){e.validated=r.Property.validate.successful}}s.store.dispatch("property/changeItem",{index:t,fields:e})})}else{s.store.commit("property/clearErrors");s.store.getters["property/getProperty"].forEach(function(e,t){if(e.validated!==r.Property.validate.unvalidated){e.validated=r.Property.validate.successful}s.store.dispatch("property/changeItem",{index:t,fields:e})})}}})}}]);return a}(a);var P=function e(a,s){var l=this;return new Promise(function(e,h){if(t.Type.isObject(a)&&t.Type.isArray(a.basketItems)){var v=a.basketItems;var b=a.actions;var y=l.store.getters["basket/getBasket"];y.forEach(function(e,a){var p;var f=i(l,n,k).call(l,b,a);if(t.Type.isString(f)){if(f===r.Pool.action.quantity){p=null;var h=i(l,o,T).call(l,a,r.Pool.action.quantity,s);if(h===false){p=i(l,c,I).call(l,e.id,v)}}else if(f===r.Pool.action.restore){p=i(l,c,I).call(l,b[a].fields.id,v)}else if(f===r.Pool.action.delete){e.status=r.Loader.status.none;i(l,u,S).call(l,e,a).then(function(){return t.Event.EventEmitter.emit(r.EventType.basket.removeProduct,{index:a})})}if(t.Type.isObject(p)){var y=i(l,d,w).call(l,p);y.status=r.Loader.status.none;i(l,u,S).call(l,y,a)}}});if(t.Type.isObject(a)&&t.Type.isObject(a.orderPriceTotal)){i(l,p,E).call(l,a);i(l,f,H).call(l,a)}}e()})};var k=function e(t,a){var i=Object.values(r.Pool.action);if(t.hasOwnProperty(a)){var s=t[a].type.toString();return i.includes(s)?s:null}return null};var T=function e(r,a,s){var n=s.hasOwnProperty(r)?s[r]:null;if(t.Type.isArray(n)){return i(this,l,g).call(this,n,a)}return false};var g=function e(t,r){return t.some(function(e){return e.hasOwnProperty(r)})};var I=function e(t,r){t=parseInt(t);for(var a in r){if(!r.hasOwnProperty(a)){continue}r[a].id=parseInt(r[a].id);if(r[a].id===t){return r[a]}}return null};var S=function e(t,r){return this.store.dispatch("basket/changeItem",{index:r,fields:t})};var w=function e(r){return{id:r.id,name:r.name,quantity:r.quantity,measureText:r.measureText,sum:r.sum,price:r.price,module:r.module,productProviderClass:r.productProviderClass,baseSum:r.sumBase,basePrice:r.basePrice,currency:r.currency,discount:{sum:r.sumDiscountDiff,price:r.discountPrice},props:r.props,product:{id:r.catalogProduct.id,detailPageUrl:r.detailPageUrl,picture:t.Type.isObject(r.catalogProduct.frontImage)?r.catalogProduct.frontImage.src:null,ratio:r.catalogProduct.ratio,availableQuantity:r.catalogProduct.availableQuantity}}};var E=function e(t){var r=t.orderPriceTotal;this.store.dispatch("basket/setTotal",{price:r.orderPrice,basePrice:r.priceWithoutDiscountValue})};var H=function e(t){var r=t.orderPriceTotal;this.store.dispatch("basket/setDiscount",{sum:r.basketPriceDiscountDiffValue})};var O=function e(r){var a=this;this.store.commit("property/clearProperty");if(t.Type.isObject(r)&&t.Type.isArray(r.properties)){r.properties.forEach(function(e,t){var r={id:e.id,name:e.name,type:e.type,value:e.value[0]};a.store.dispatch("property/changeItem",{index:t,fields:r})})}};var C=function e(r){var a=this;return new Promise(function(e,s){a.store.commit("basket/clearBasket");if(t.Type.isObject(r)&&t.Type.isArray(r.basketItems)){var n=r.basketItems;n.forEach(function(e,t){var r=i(a,d,w).call(a,e);i(a,u,S).call(a,r,t)})}if(t.Type.isObject(r)&&t.Type.isObject(r.orderPriceTotal)){i(a,p,E).call(a,r);i(a,f,H).call(a,r)}e()})};var B=function e(t){var r=[];t.forEach(function(e){if(e.code==="PROPERTIES"){if(e.hasOwnProperty("customData")){var t=parseInt(e.customData.id);r.push({message:e.message,propertyId:t})}}});return r};var W=function e(t){var r=[];t.forEach(function(e){if(parseInt(e.code)===0||e.code==="ORDER"){r.push({message:e.message})}});return r};e.BasketRestHandler=m})(this.BX.Sale.Checkout.Provider=this.BX.Sale.Checkout.Provider||{},BX,BX.Sale.Checkout.Const);
//# sourceMappingURL=rest.bundle.map.js