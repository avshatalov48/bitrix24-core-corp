this.BX=this.BX||{};this.BX.Sale=this.BX.Sale||{};this.BX.Sale.Checkout=this.BX.Sale.Checkout||{};(function(e,t,r,a){"use strict";var i=function(){babelHelpers.createClass(e,null,[{key:"create",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(t)}}]);function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);if(babelHelpers["typeof"](t.store)==="object"&&t.store){this.store=t.store}}babelHelpers.createClass(e,[{key:"execute",value:function e(t,r){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};t="handle"+t.split(".").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join("");if(r.error){if(typeof this[t+"Error"]==="function"){return this[t+"Error"](r.error,a)}}else{if(typeof this[t+"Success"]==="function"){return this[t+"Success"](r.data,a)}}return typeof this[t]==="function"?this[t](r,a):null}}]);return e}();function s(e,t){n(e,t);t.add(e)}function n(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function l(e,t,r){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return r}var o=new WeakSet;var c=new WeakSet;var u=new WeakSet;var p=new WeakSet;var f=new WeakSet;var d=new WeakSet;var h=new WeakSet;var v=new WeakSet;var b=new WeakSet;var y=new WeakSet;var m=new WeakSet;var k=new WeakSet;var T=new WeakSet;var P=new WeakSet;var g=new WeakSet;var E=new WeakSet;var w=new WeakSet;var I=new WeakSet;var S=new WeakSet;var H=function(e){babelHelpers.inherits(i,e);function i(){var e;var t;babelHelpers.classCallCheck(this,i);for(var r=arguments.length,a=new Array(r),n=0;n<r;n++){a[n]=arguments[n]}t=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(i)).call.apply(e,[this].concat(a)));s(babelHelpers.assertThisInitialized(t),S);s(babelHelpers.assertThisInitialized(t),I);s(babelHelpers.assertThisInitialized(t),w);s(babelHelpers.assertThisInitialized(t),E);s(babelHelpers.assertThisInitialized(t),g);s(babelHelpers.assertThisInitialized(t),P);s(babelHelpers.assertThisInitialized(t),T);s(babelHelpers.assertThisInitialized(t),k);s(babelHelpers.assertThisInitialized(t),m);s(babelHelpers.assertThisInitialized(t),y);s(babelHelpers.assertThisInitialized(t),b);s(babelHelpers.assertThisInitialized(t),v);s(babelHelpers.assertThisInitialized(t),h);s(babelHelpers.assertThisInitialized(t),d);s(babelHelpers.assertThisInitialized(t),f);s(babelHelpers.assertThisInitialized(t),p);s(babelHelpers.assertThisInitialized(t),u);s(babelHelpers.assertThisInitialized(t),c);s(babelHelpers.assertThisInitialized(t),o);return t}babelHelpers.createClass(i,[{key:"handleRecalculateBasket",value:function e(t,i){var s=this;return new Promise((function(e,n){if(t.data.needFullRecalculation==="Y"){r.EventEmitter.emit(a.EventType.basket.needRefresh,{})}var p=s.store.getters["basket/getNeedRefresh"];l(s,u,W).call(s,t.data,i).then((function(){return e()}));l(s,c,z).call(s,t.data).then((function(){return e()}));if(p==="Y"){if(i.isEmpty()){l(s,o,O).call(s,t.data,i);r.EventEmitter.emit(a.EventType.basket.refreshAfter,{})}}}))}},{key:"handleSaveOrderSuccess",value:function e(t){var i=this;r.EventEmitter.emit(a.EventType.order.success);this.store.dispatch("application/setStage",{stage:a.Application.stage.success});this.store.dispatch("order/set",{id:t.order.id,hash:t.hash,accountNumber:t.order.accountNumber});return l(this,E,F).call(this,t).then((function(){return l(i,g,Q).call(i,t)}))}},{key:"setModelPropertyError",value:function e(r){var i=this;if(t.Type.isArrayFilled(r)){this.store.commit("property/setErrors",r);this.store.getters["property/getProperty"].forEach((function(e,t){if(typeof r.find((function(t){return t.propertyId===e.id}))!=="undefined"){e.validated=a.Property.validate.failure}else{e.validated=a.Property.validate.unvalidated}i.store.dispatch("property/changeItem",{index:t,fields:e})}))}else{this.store.commit("property/clearErrors");this.store.getters["property/getProperty"].forEach((function(e,t){e.validated=a.Property.validate.unvalidated;i.store.dispatch("property/changeItem",{index:t,fields:e})}))}}},{key:"handleSaveOrderError",value:function e(r){var a=this;return new Promise((function(e,i){if(t.Type.isArrayFilled(r)){var s=l(a,S,L).call(a,r);var n=l(a,I,U).call(a,r);if(s.length>0){a.store.commit("application/setErrors",s)}else{a.store.commit("application/clearErrors")}a.setModelPropertyError(n)}}))}}]);return i}(i);function O(e,r){var a=this;return new Promise((function(r,i){if(t.Type.isObject(e)&&t.Type.isArray(e.basketItems)){var s=e.basketItems;var n=a.store.getters["basket/getBasket"];n.forEach((function(e,r){var i=l(a,y,X).call(a,e.id,s);if(t.Type.isObject(i)){var n=l(a,k,D).call(a,i);l(a,m,R).call(a,n,r)}}));if(t.Type.isObject(e)&&t.Type.isObject(e.orderPriceTotal)){l(a,T,q).call(a,e);l(a,P,M).call(a,e)}}r()}))}function z(e){var r=this;return new Promise((function(a,i){if(t.Type.isObject(e)&&t.Type.isObject(e.actions)){var s=e.actions;var n=r.store.getters["basket/getBasket"];var o=l(r,w,N).call(r,n,s);if(o.length>0){r.store.commit("basket/setErrors",o)}else{r.store.commit("basket/clearErrors")}}a()}))}function W(e,i){var s=this;return new Promise((function(n,o){if(t.Type.isObject(e)&&t.Type.isArray(e.basketItems)){var c=e.basketItems;var u=e.actions;var p=s.store.getters["basket/getBasket"];var f=i.get();p.forEach((function(e,i){var n;var o=l(s,h,C).call(s,u,i);if(t.Type.isString(o)){if(o===a.Pool.action.quantity){n=null;var p=l(s,v,x).call(s,i,a.Pool.action.quantity,f);if(p===false){n=l(s,y,X).call(s,e.id,c)}}else if(o===a.Pool.action.restore){n=l(s,y,X).call(s,u[i].fields.id,c)}else if(o===a.Pool.action["delete"]){e.status=a.Loader.status.none;l(s,m,R).call(s,e,i).then((function(){return r.EventEmitter.emit(a.EventType.basket.removeProduct,{index:i})}))}else if(o===a.Pool.action.offer){n=null;var d=l(s,v,x).call(s,i,a.Pool.action.offer,f);if(d===false){n=l(s,y,X).call(s,e.id,c)}}if(t.Type.isObject(n)){var b=l(s,k,D).call(s,n);b.status=a.Loader.status.none;l(s,m,R).call(s,b,i).then((function(){if(o===a.Pool.action.restore){r.EventEmitter.emit(a.EventType.basket.restoreProduct,{index:i})}}))}}}));if(t.Type.isObject(e)&&t.Type.isObject(e.orderPriceTotal)){l(s,T,q).call(s,e);l(s,P,M).call(s,e)}}n()}))}function j(e,t){return e.hasOwnProperty(t)?e[t]:null}function B(e,t){var r=l(this,f,j).call(this,e,t);if(r!==null){return r.hasOwnProperty("errors")?r.errors:null}else{return null}}function C(e,t){var r=Object.values(a.Pool.action);var i=l(this,f,j).call(this,e,t);if(i!==null){var s=i.type.toString();return r.includes(s)?s:null}return null}function x(e,r,a){var i=a.hasOwnProperty(e)?a[e]:null;if(t.Type.isArray(i)){return l(this,b,A).call(this,i,r)}return false}function A(e,t){return e.some((function(e){return e.hasOwnProperty(t)}))}function X(e,t){e=parseInt(e);for(var r in t){if(!t.hasOwnProperty(r)){continue}t[r].id=parseInt(t[r].id);if(t[r].id===e){return t[r]}}return null}function R(e,t){return this.store.dispatch("basket/changeItem",{index:t,fields:e})}function D(e){return{id:e.id,name:e.name,quantity:e.quantity,measureText:e.measureText,sum:e.sum,price:e.price,module:e.module,productProviderClass:e.productProviderClass,baseSum:e.sumBase,basePrice:e.basePrice,currency:e.currency,discount:{sum:e.sumDiscountDiff,price:e.discountPrice},props:e.props,sku:e.sku,product:{id:e.catalogProduct.id,detailPageUrl:e.detailPageUrl,picture:t.Type.isObject(e.catalogProduct.frontImage)?e.catalogProduct.frontImage.src:null,ratio:e.catalogProduct.ratio,availableQuantity:e.catalogProduct.availableQuantity,type:e.catalogProduct.type,checkMaxQuantity:e.catalogProduct.checkMaxQuantity}}}function q(e){var t=e.orderPriceTotal;this.store.dispatch("basket/setTotal",{price:t.orderPrice,basePrice:t.priceWithoutDiscountValue})}function M(e){var t=e.orderPriceTotal;this.store.dispatch("basket/setDiscount",{sum:t.basketPriceDiscountDiffValue})}function Q(e){var r=this;this.store.commit("property/clearProperty");if(t.Type.isObject(e)&&t.Type.isArray(e.properties)){e.properties.forEach((function(e,t){var a={id:e.id,name:e.name,type:e.type,value:e.value[0]};r.store.dispatch("property/changeItem",{index:t,fields:a})}))}}function F(e){var r=this;return new Promise((function(a,i){r.store.commit("basket/clearBasket");if(t.Type.isObject(e)&&t.Type.isArray(e.basketItems)){var s=e.basketItems;s.forEach((function(e,t){var a=l(r,k,D).call(r,e);l(r,m,R).call(r,a,t)}))}if(t.Type.isObject(e)&&t.Type.isObject(e.orderPriceTotal)){l(r,T,q).call(r,e);l(r,P,M).call(r,e)}a()}))}function N(e,t){var r=this;var a=[];e.forEach((function(e,i){var s=l(r,d,B).call(r,t,i);if(s!==null){a.push({list:s,index:i})}}));return a}function U(e){var t=[];e.forEach((function(e){if(e.code==="PROPERTIES"){if(e.hasOwnProperty("customData")){var r=parseInt(e.customData.id);t.push({message:e.message,propertyId:r})}}}));return t}function L(e){var t=[];e.forEach((function(e){if(parseInt(e.code)===0||e.code==="ORDER"){t.push({message:e.message})}}));return t}e.BasketRestHandler=H})(this.BX.Sale.Checkout.Provider=this.BX.Sale.Checkout.Provider||{},BX,BX.Event,BX.Sale.Checkout.Const);
//# sourceMappingURL=rest.bundle.map.js