this.BX=this.BX||{};this.BX.Sale=this.BX.Sale||{};this.BX.Sale.Checkout=this.BX.Sale.Checkout||{};(function(e,t,r){"use strict";var a=function(){babelHelpers.createClass(e,null,[{key:"create",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(t)}}]);function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);if(babelHelpers.typeof(t.store)==="object"&&t.store){this.store=t.store}}babelHelpers.createClass(e,[{key:"execute",value:function e(t,r){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};t="handle"+t.split(".").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("");if(r.error){if(typeof this[t+"Error"]==="function"){return this[t+"Error"](r.error,a)}}else{if(typeof this[t+"Success"]==="function"){return this[t+"Success"](r.data,a)}}return typeof this[t]==="function"?this[t](r,a):null}}]);return e}();function i(e,t,r){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return r}var s=new WeakSet;var n=new WeakSet;var l=new WeakSet;var o=new WeakSet;var c=new WeakSet;var u=new WeakSet;var d=new WeakSet;var p=new WeakSet;var f=new WeakSet;var v=new WeakSet;var h=new WeakSet;var b=new WeakSet;var y=new WeakSet;var m=new WeakSet;var P=function(e){babelHelpers.inherits(a,e);function a(){var e;var t;babelHelpers.classCallCheck(this,a);for(var r=arguments.length,i=new Array(r),P=0;P<r;P++){i[P]=arguments[P]}t=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(a)).call.apply(e,[this].concat(i)));m.add(babelHelpers.assertThisInitialized(t));y.add(babelHelpers.assertThisInitialized(t));b.add(babelHelpers.assertThisInitialized(t));h.add(babelHelpers.assertThisInitialized(t));v.add(babelHelpers.assertThisInitialized(t));f.add(babelHelpers.assertThisInitialized(t));p.add(babelHelpers.assertThisInitialized(t));d.add(babelHelpers.assertThisInitialized(t));u.add(babelHelpers.assertThisInitialized(t));c.add(babelHelpers.assertThisInitialized(t));o.add(babelHelpers.assertThisInitialized(t));l.add(babelHelpers.assertThisInitialized(t));n.add(babelHelpers.assertThisInitialized(t));s.add(babelHelpers.assertThisInitialized(t));return t}babelHelpers.createClass(a,[{key:"handleRecalculateBasket",value:function e(a,l){var o=this;return new Promise(function(e,c){if(a.data.needFullRecalculation==="Y"){t.Event.EventEmitter.emit(r.EventType.basket.needRefresh,{})}var u=o.store.getters["basket/getNeedRefresh"];i(o,n,T).call(o,a.data,l).then(function(){return e()});if(u==="Y"){if(l.isEmpty()){i(o,s,k).call(o,a.data,l);t.Event.EventEmitter.emit(r.EventType.basket.refreshAfter,{})}}})}},{key:"handleSaveOrderSuccess",value:function e(a){var s=this;t.Event.EventEmitter.emit(r.EventType.order.success);this.store.dispatch("application/setStage",{stage:r.Application.stage.success});this.store.dispatch("order/set",{id:a.order.id,hash:a.hash,accountNumber:a.order.accountNumber});return i(this,b,B).call(this,a).then(function(){return i(s,h,j).call(s,a)})}},{key:"handleSaveOrderError",value:function e(a){var s=this;return new Promise(function(e,n){if(t.Type.isArrayFilled(a)){var l=i(s,m,z).call(s,a);var o=i(s,y,W).call(s,a);if(l.length>0){s.store.commit("application/setErrors",l)}else{s.store.commit("application/clearErrors")}if(o.length>0){s.store.commit("property/setErrors",o);s.store.getters["property/getProperty"].forEach(function(e,t){if(typeof o.find(function(t){return t.propertyId===e.id})!=="undefined"){e.validated=r.Property.validate.failure}else{if(e.validated!==r.Property.validate.unvalidated){e.validated=r.Property.validate.successful}}s.store.dispatch("property/changeItem",{index:t,fields:e})})}else{s.store.commit("property/clearErrors");s.store.getters["property/getProperty"].forEach(function(e,t){if(e.validated!==r.Property.validate.unvalidated){e.validated=r.Property.validate.successful}s.store.dispatch("property/changeItem",{index:t,fields:e})})}}})}}]);return a}(a);var k=function e(r,a){var s=this;return new Promise(function(e,a){if(t.Type.isObject(r)&&t.Type.isArray(r.basketItems)){var n=r.basketItems;var l=s.store.getters["basket/getBasket"];l.forEach(function(e,r){var a=i(s,u,S).call(s,e.id,n);if(t.Type.isObject(a)){var l=i(s,p,H).call(s,a);i(s,d,w).call(s,l,r)}});if(t.Type.isObject(r)&&t.Type.isObject(r.orderPriceTotal)){i(s,f,O).call(s,r);i(s,v,C).call(s,r)}}e()})};var T=function e(a,s){var n=this;return new Promise(function(e,c){if(t.Type.isObject(a)&&t.Type.isArray(a.basketItems)){var h=a.basketItems;var b=a.actions;var y=n.store.getters["basket/getBasket"];var m=s.get();y.forEach(function(e,a){var s;var c=i(n,l,g).call(n,b,a);if(t.Type.isString(c)){if(c===r.Pool.action.quantity){s=null;var f=i(n,o,E).call(n,a,r.Pool.action.quantity,m);if(f===false){s=i(n,u,S).call(n,e.id,h)}}else if(c===r.Pool.action.restore){s=i(n,u,S).call(n,b[a].fields.id,h)}else if(c===r.Pool.action.delete){e.status=r.Loader.status.none;i(n,d,w).call(n,e,a).then(function(){return t.Event.EventEmitter.emit(r.EventType.basket.removeProduct,{index:a})})}if(t.Type.isObject(s)){var v=i(n,p,H).call(n,s);v.status=r.Loader.status.none;i(n,d,w).call(n,v,a)}}});if(t.Type.isObject(a)&&t.Type.isObject(a.orderPriceTotal)){i(n,f,O).call(n,a);i(n,v,C).call(n,a)}}e()})};var g=function e(t,a){var i=Object.values(r.Pool.action);if(t.hasOwnProperty(a)){var s=t[a].type.toString();return i.includes(s)?s:null}return null};var E=function e(r,a,s){var n=s.hasOwnProperty(r)?s[r]:null;if(t.Type.isArray(n)){return i(this,c,I).call(this,n,a)}return false};var I=function e(t,r){return t.some(function(e){return e.hasOwnProperty(r)})};var S=function e(t,r){t=parseInt(t);for(var a in r){if(!r.hasOwnProperty(a)){continue}r[a].id=parseInt(r[a].id);if(r[a].id===t){return r[a]}}return null};var w=function e(t,r){return this.store.dispatch("basket/changeItem",{index:r,fields:t})};var H=function e(r){return{id:r.id,name:r.name,quantity:r.quantity,measureText:r.measureText,sum:r.sum,price:r.price,module:r.module,productProviderClass:r.productProviderClass,baseSum:r.sumBase,basePrice:r.basePrice,currency:r.currency,discount:{sum:r.sumDiscountDiff,price:r.discountPrice},props:r.props,product:{id:r.catalogProduct.id,detailPageUrl:r.detailPageUrl,picture:t.Type.isObject(r.catalogProduct.frontImage)?r.catalogProduct.frontImage.src:null,ratio:r.catalogProduct.ratio,availableQuantity:r.catalogProduct.availableQuantity}}};var O=function e(t){var r=t.orderPriceTotal;this.store.dispatch("basket/setTotal",{price:r.orderPrice,basePrice:r.priceWithoutDiscountValue})};var C=function e(t){var r=t.orderPriceTotal;this.store.dispatch("basket/setDiscount",{sum:r.basketPriceDiscountDiffValue})};var j=function e(r){var a=this;this.store.commit("property/clearProperty");if(t.Type.isObject(r)&&t.Type.isArray(r.properties)){r.properties.forEach(function(e,t){var r={id:e.id,name:e.name,type:e.type,value:e.value[0]};a.store.dispatch("property/changeItem",{index:t,fields:r})})}};var B=function e(r){var a=this;return new Promise(function(e,s){a.store.commit("basket/clearBasket");if(t.Type.isObject(r)&&t.Type.isArray(r.basketItems)){var n=r.basketItems;n.forEach(function(e,t){var r=i(a,p,H).call(a,e);i(a,d,w).call(a,r,t)})}if(t.Type.isObject(r)&&t.Type.isObject(r.orderPriceTotal)){i(a,f,O).call(a,r);i(a,v,C).call(a,r)}e()})};var W=function e(t){var r=[];t.forEach(function(e){if(e.code==="PROPERTIES"){if(e.hasOwnProperty("customData")){var t=parseInt(e.customData.id);r.push({message:e.message,propertyId:t})}}});return r};var z=function e(t){var r=[];t.forEach(function(e){if(parseInt(e.code)===0||e.code==="ORDER"){r.push({message:e.message})}});return r};e.BasketRestHandler=P})(this.BX.Sale.Checkout.Provider=this.BX.Sale.Checkout.Provider||{},BX,BX.Sale.Checkout.Const);
//# sourceMappingURL=rest.bundle.map.js