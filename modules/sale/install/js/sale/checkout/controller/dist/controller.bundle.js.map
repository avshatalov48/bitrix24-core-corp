{"version":3,"file":"controller.bundle.js","sources":["../src/basket.js","../src/application.js"],"sourcesContent":["import { ajax } from 'main.core';\nimport { Pool, Timer, Basket as Lib } from 'sale.checkout.lib'\nimport {\n    Application as ApplicationConst,\n    RestMethod as RestMethodConst,\n    Component as ComponentConst,\n    Loader as LoaderConst,\n    Pool as PoolConst,\n} from 'sale.checkout.const';\n\nexport class Basket\n{\n    constructor()\n    {\n        this.pool = new Pool();\n        this.timer = new Timer();\n        this.running = 'N';\n    }\n\n    /**\n     * @private\n     */\n    isRunning()\n    {\n        return this.running === 'Y';\n    }\n\n    /**\n     * @private\n     */\n    setRunningY()\n    {\n        this.running = 'Y'\n    }\n\n    /**\n     * @private\n     */\n    setRunningN()\n    {\n        this.running = 'N'\n    }\n\n    /**\n     * @private\n     */\n    setStore(store)\n    {\n        this.store = store;\n        return this;\n    }\n\n    /**\n     * @private\n     */\n    setProvider(provider)\n    {\n        this.provider = provider;\n        return this;\n    }\n\n    /**\n     * @private\n     */\n    executeRestAnswer(command, result, extra)\n    {\n        return this.provider.execute(command, result, extra);\n    }\n\n    /**\n     * @private\n     */\n    getItem(index)\n    {\n        return this.store.getters['basket/get'](index);\n    }\n\n    /**\n     * @private\n     */\n    getBasket()\n    {\n        return this.store.getters['basket/getBasket'];\n    }\n\n    /**\n     * @private\n     */\n    changeItem(product)\n    {\n        this.store.dispatch('basket/changeItem', {\n            index: product.index,\n            fields: product.fields\n        });\n    }\n\n    /**\n     * @private\n     */\n    setQuantity(index, quantity)\n    {\n        let fields = this.getItem(index);\n\n        fields.quantity = quantity;\n        fields.baseSum = this.round(fields.basePrice * fields.quantity);\n        fields.sum = this.round(fields.price * fields.quantity);\n        fields.discount.sum = this.round(fields.discount.price * fields.quantity);\n\n        this.pool.add(PoolConst.action.quantity, index, {id: fields.id, value: fields.quantity});\n        this.changeItem({index, fields});\n        this.shelveCommit();\n    }\n\n    /**\n     * @private\n     */\n    removeItem(product)\n    {\n        return this.store.dispatch('basket/removeItem', {\n            index: product.index\n        });\n    }\n\n    /**\n     * @private\n     */\n    round(value, precision = 10)\n    {\n        const factor = Math.pow(10, precision);\n\n        return Math.round(value * factor) / factor;\n    }\n\n    /**\n     * @private\n     */\n    handlerOrderSuccess()\n    {\n        BX.onCustomEvent('OnBasketChange');\n    }\n\n    /**\n     * @private\n     */\n    handlerRemove(event)\n    {\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n\n        fields.deleted = 'Y';\n        fields.status = LoaderConst.status.wait;\n\n        this.pool.add(PoolConst.action.delete, index, {id: fields.id, fields: {value: 'Y'}});\n        this.changeItem({index, fields});\n        this.shelveCommit();\n    }\n\n    /**\n     * @private\n     */\n    handlerSuccessRemove(event)\n    {\n        let index = event.getData().index;\n\n        this.timer.create(5000, index + '_DELETE', () =>\n            this.removeItem({index})\n                .then(() =>\n                {\n                    if(this.getBasket().length === 0)\n                    {\n                        this.store.dispatch('application/setStage', {stage: ApplicationConst.stage.empty})\n                    }\n                })\n        )\n    }\n\n    /**\n     * @private\n     */\n    handlerRestore(event)\n    {\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n\n        this.timer.clean({\n            index: index + '_DELETE'\n        });\n\n        fields.deleted = 'N';\n        fields.status = LoaderConst.status.wait;\n\n        //todo: send all fields ?\n        this.pool.add(PoolConst.action.restore, index, {\n            basePrice:fields.basePrice,\n            baseSum:fields.baseSum,\n            currency:fields.currency,\n            discount:fields.discount,\n            id:fields.id,\n            measureText:fields.measureText,\n            module:fields.module,\n            name:fields.name,\n            price:fields.price,\n            product:fields.product,\n            productProviderClass:fields.productProviderClass,\n            props:fields.props,\n            quantity:fields.quantity,\n            sum:fields.sum,\n        });\n        this.changeItem({index, fields});\n        this.shelveCommit();\n    }\n\n    /**\n     * @private\n     */\n    handlerQuantityPlus(event)\n    {\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n        let quantity = fields.quantity;\n        let ratio = fields.product.ratio;\n        let available = fields.product.availableQuantity;\n\n        quantity = Lib.roundValue(quantity)\n        ratio = Lib.roundValue(ratio)\n\n        // let basket = new Lib();\n\n        // if(basket.isRatioFloat(ratio))\n        // {\n        //\n        //     quantity = parseFloat(quantity)\n        // }\n        // else\n        // {\n        //     quantity = parseInt(quantity, 10);\n        // }\n        //\n        // if(basket.isRatioFloat(ratio))\n        // {\n        //\n        //     ratio = Math.round(parseFloat(ratio) * basket.precisionFactor) / basket.precisionFactor;\n        // }\n        // else\n        // {\n        //     ratio =  parseInt(ratio, 10)\n        // }\n\n        quantity = quantity + ratio;\n\n        if(Lib.isValueFloat(quantity))\n        {\n            quantity = Lib.roundFloatValue(quantity)\n        }\n\n        if (available > 0 && quantity > available)\n        {\n            quantity = available;\n        }\n\n        quantity = Lib.toFixed(quantity, ratio, available)\n        \n        if(fields.quantity < quantity)\n        {\n            this.setQuantity(index, quantity)\n        }\n    }\n\n    /**\n     * @private\n     */\n    handlerQuantityMinus(event)\n    {\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n        let quantity = fields.quantity;\n        let ratio = fields.product.ratio;\n        let available = fields.product.availableQuantity;\n\n        quantity = Lib.roundValue(quantity)\n        ratio = Lib.roundValue(ratio)\n\n        quantity = quantity - ratio;\n\n        if(Lib.isValueFloat(quantity))\n        {\n            quantity = Lib.roundFloatValue(quantity)\n        }\n\n        if (ratio > 0 && quantity < ratio)\n        {\n            quantity = ratio;\n        }\n        \n        if (available > 0 && quantity > available)\n        {\n            quantity = available;\n        }\n    \n        quantity = Lib.toFixed(quantity, ratio, available)\n    \n        if(quantity >= ratio)\n        {\n            this.setQuantity(index, quantity)\n        }\n    }\n\n    /**\n     * @private\n     */\n    commit()\n    {\n        return new Promise((resolve, reject) =>\n        {\n            let fields = {};\n            \n            if(this.pool.isEmpty() === false)\n            {\n                fields = this.pool.get();\n                this.pool.clean();\n\n                const component = ComponentConst.bitrixSaleOrderCheckout;\n                const cmd = RestMethodConst.saleEntityRecalculateBasket;\n\n                ajax.runComponentAction(\n                    component,\n                    cmd,\n                    {\n                        data: {\n                            actions: fields\n                        },\n                        signedParameters: this.store.getters['application/getSignedParameters']\n                    }\n                )\n                .then((result) => this.executeRestAnswer(cmd, result, this.pool)\n                    .then(() => this.commit()\n                        .then(() => resolve())))\n                .catch()\n            }\n            else\n            {\n                resolve();\n            }\n        });\n    }\n\n    /**\n     * @private\n     */\n    shelveCommit(index = 'BASKET')\n    {\n        if(this.isRunning() === false)\n        {\n            this.timer.create(300, index,\n                () => {\n                    this.setRunningY();\n                    this.commit()\n                        .then(()=>this.setRunningN())\n                }\n            );\n        }\n    }\n\n    /**\n     * @private\n     */\n    getStatus()\n    {\n        return this.store.getters['basket/getStatus'];\n    }\n\n    /**\n     * @private\n     */\n    setStatusWait()\n    {\n        let app = {status: LoaderConst.status.wait};\n        return this.store.dispatch('basket/setStatus', app);\n    }\n\n    /**\n     * @private\n     */\n    setStatusNone()\n    {\n        let app = {status: LoaderConst.status.none};\n        return this.store.dispatch('basket/setStatus', app);\n    }\n\n    /**\n     * @private\n     */\n    handlerNeedRefreshY()\n    {\n        this.setNeedRefreshY();\n        this.setStatusWait();\n    }\n\n    /**\n     * @private\n     */\n    handlerNeedRefreshN()\n    {\n        this.setNeedRefreshN();\n        this.setStatusNone();\n    }\n\n    /**\n     * @private\n     */\n    setNeedRefreshY()\n    {\n        let app = {needRefresh: 'Y'};\n        return this.store.dispatch('basket/setNeedRefresh', app);\n    }\n\n    /**\n     * @private\n     */\n    setNeedRefreshN()\n    {\n        let app = {needRefresh: 'N'};\n        return this.store.dispatch('basket/setNeedRefresh', app);\n    }\n\n    /**\n     * @private\n     */\n    handlerChangeSku(event)\n    {\n        let offerId = event.getData().data[0].ID;\n\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n\n        fields.status = LoaderConst.status.wait;\n\n        this.pool.add(PoolConst.action.offer, index, {id: fields.id, fields: {offerId: offerId}});\n        this.changeItem({index, fields});\n        this.shelveCommit();\n    }\n}","import {Runtime, Event, ajax} from 'main.core';\r\nimport {BasketRestHandler} from 'sale.checkout.provider.rest'\r\nimport {\r\n    Application as ApplicationConst,\r\n    RestMethod as RestMethodConst,\r\n    Component as ComponentConst,\r\n    Consent as ConsentConst,\r\n    Loader as LoaderConst,\r\n    EventType\r\n} from 'sale.checkout.const';\r\n\r\nimport {Timer} from 'sale.checkout.lib';\r\nimport {History} from 'sale.checkout.lib';\r\n\r\nimport {Basket} from \"./basket\";\r\n\r\nexport class Application\r\n{\r\n    constructor(option)\r\n    {\r\n        this.init(option)\r\n            .then(() => this.initProvider())\r\n            .then(() => this.iniController())\r\n            .then(() => this.subscribeToEvents())\r\n            .then(() => this.subscribeToStoreChanges())\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    init(option)\r\n    {\r\n        this.store = option.store;\r\n        this.timer = new Timer();\r\n        return new Promise((resolve, reject) => resolve());\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    initProvider()\r\n    {\r\n        this.provider = BasketRestHandler.create({store: this.store})\r\n        return new Promise((resolve, reject) => resolve());\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    iniController()\r\n    {\r\n        this.basket = new Basket().setStore(this.store).setProvider(this.provider);\r\n        return new Promise((resolve, reject) => resolve());\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    executeRestAnswer(command, result, extra)\r\n    {\r\n        return this.provider.execute(command, result, extra);\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    subscribeToEvents()\r\n    {\r\n        Event.EventEmitter.subscribe(EventType.order.success, (e)=>this.basket.handlerOrderSuccess(e));\r\n    \r\n        Event.EventEmitter.subscribe(EventType.basket.buttonRemoveProduct, Runtime.debounce((e)=>this.basket.handlerRemove(e), 500, this));\r\n        Event.EventEmitter.subscribe(EventType.basket.buttonPlusProduct, (e) => this.basket.handlerQuantityPlus(e));\r\n        Event.EventEmitter.subscribe(EventType.basket.buttonMinusProduct, (e) => this.basket.handlerQuantityMinus(e));\r\n        Event.EventEmitter.subscribe(EventType.basket.buttonRestoreProduct, Runtime.debounce((e) => this.basket.handlerRestore(e), 500, this));\r\n        Event.EventEmitter.subscribe(EventType.basket.needRefresh, (e) => this.basket.handlerNeedRefreshY(e));\r\n        Event.EventEmitter.subscribe(EventType.basket.refreshAfter, (e) => this.basket.handlerNeedRefreshN(e));\r\n    \r\n        Event.EventEmitter.subscribe(EventType.basket.changeSku, (e) => this.basket.handlerChangeSku(e));\r\n        \r\n        Event.EventEmitter.subscribe(EventType.consent.refused, () => this.handlerConsentRefused());\r\n        Event.EventEmitter.subscribe(EventType.consent.accepted, () => this.handlerConsentAccepted());\r\n    \r\n        Event.EventEmitter.subscribe(EventType.element.buttonCheckout, Runtime.debounce(() => this.handlerCheckout(), 1000, this));\r\n        Event.EventEmitter.subscribe(EventType.element.buttonShipping, Runtime.debounce(() => this.handlerShipping(), 1000, this));\r\n    \r\n        Event.EventEmitter.subscribe(EventType.paysystem.beforeInitList, () => this.paySystemSetStatusWait());\r\n        Event.EventEmitter.subscribe(EventType.paysystem.afterInitList, () => this.paySystemSetStatusNone());\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    subscribeToStoreChanges()\r\n    {\r\n        // this.store.subscribe((mutation, state) => {\r\n        //     const { payload, type } = mutation;\r\n        //     if (type === 'basket/setNeedRefresh')\r\n        //     {\r\n        //     \talert('@@');\r\n        //     \tthis.getData();\r\n        //     }\r\n        // });\r\n\r\n        return new Promise((resolve, reject) => resolve());\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    paySystemSetStatusWait()\r\n    {\r\n        let paySystem = { status: LoaderConst.status.wait};\r\n        return this.store.dispatch('pay-system/setStatus', paySystem);\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    paySystemSetStatusNone()\r\n    {\r\n        let paySystem = { status: LoaderConst.status.none};\r\n        return this.store.dispatch('pay-system/setStatus', paySystem);\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    appSetStatusWait()\r\n    {\r\n        let app = { status: LoaderConst.status.wait};\r\n        return this.store.dispatch('application/setStatus', app);\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    appSetStatusNone()\r\n    {\r\n        let app = { status: LoaderConst.status.none};\r\n        return this.store.dispatch('application/setStatus', app);\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    handlerConsentAccepted()\r\n    {\r\n        this.store.dispatch('consent/setStatus', ConsentConst.status.accepted);\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    handlerConsentRefused()\r\n    {\r\n        this.store.dispatch('consent/setStatus', ConsentConst.status.refused);\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    handlerCheckout()\r\n    {\r\n        BX.onCustomEvent(ConsentConst.validate.submit, []);\r\n\r\n        const consent = this.store.getters['consent/get'];\r\n        const consentStatus = this.store.getters['consent/getStatus'];\r\n        const allowed = consent.id > 0 ?  consentStatus === ConsentConst.status.accepted:true;\r\n\r\n        if(allowed)\r\n        {\r\n            // this.propertiesValidate();\r\n            // this.propertiesIsValid() ? alert('propsSuccess'):alert('propsError')\r\n \r\n            this.appSetStatusWait();\r\n\r\n            this.saveOrder()\r\n                .then(() => {\r\n                        this.appSetStatusNone()\r\n                            .then(()=>\r\n                            {\r\n                                let order = this.store.getters['order/getOrder'];\r\n\r\n                                if(order.id>0)\r\n                                {\r\n                                    const url = History.pushState(\r\n                                        this.store.getters['application/getPathLocation'],\r\n                                        {\r\n                                            accountNumber: order.accountNumber,\r\n                                            access: order.hash\r\n                                        })\r\n\r\n                                    this.store.dispatch('application/setPathLocation', url);\r\n                                }\r\n                            })\r\n                    }\r\n                )\r\n                .catch(() => this.appSetStatusNone())\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    handlerShipping()\r\n    {\r\n        this.store.dispatch('application/setStage', {stage: ApplicationConst.stage.view});\r\n        // todo\r\n        delete BX.UserConsent;\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    saveOrder()\r\n    {\r\n        const component = ComponentConst.bitrixSaleOrderCheckout;\r\n        const cmd = RestMethodConst.saleEntitySaveOrder;\r\n        return ajax.runComponentAction(\r\n            component,\r\n            cmd,\r\n            {\r\n                data: {\r\n                    fields: {\r\n                        siteId: this.store.getters['application/getSiteId'],\r\n                        personTypeId: this.store.getters['application/getPersonTypeId'],\r\n                        tradingPlatformId: this.store.getters['application/getTradingPlatformId'],\r\n                        properties: this.preparePropertyFields(\r\n                            this.getPropertyList()\r\n                        ),\r\n                    }\r\n                },\r\n                signedParameters: this.store.getters['application/getSignedParameters']\r\n            }\r\n        )\r\n            .then((result) => this.executeRestAnswer(cmd, result))\r\n            .catch((result) => this.executeRestAnswer(cmd, {error: result.errors}));\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    getPropertyList()\r\n    {\r\n        const result = [];\r\n        let list = this.store.getters['property/getProperty'];\r\n        try\r\n        {\r\n            for (let key in list)\r\n            {\r\n                if (!list.hasOwnProperty(key))\r\n                {\r\n                    continue;\r\n                }\r\n\r\n                result[list[key].id] = list[key];\r\n            }\r\n        }\r\n        catch (e) {}\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    preparePropertyFields(list)\r\n    {\r\n        let fields = {};\r\n        list.forEach((property, inx)=>\r\n        {\r\n            fields[inx] = property.value\r\n        })\r\n        return fields;\r\n    }\r\n}"],"names":["Basket","pool","Pool","timer","Timer","running","store","provider","command","result","extra","execute","index","getters","product","dispatch","fields","quantity","getItem","baseSum","round","basePrice","sum","price","discount","add","PoolConst","action","id","value","changeItem","shelveCommit","precision","factor","Math","pow","BX","onCustomEvent","event","getData","deleted","status","LoaderConst","wait","delete","create","removeItem","then","getBasket","length","stage","ApplicationConst","empty","clean","restore","currency","measureText","module","name","productProviderClass","props","ratio","available","availableQuantity","Lib","roundValue","isValueFloat","roundFloatValue","toFixed","setQuantity","Promise","resolve","reject","isEmpty","get","component","ComponentConst","bitrixSaleOrderCheckout","cmd","RestMethodConst","saleEntityRecalculateBasket","ajax","runComponentAction","data","actions","signedParameters","executeRestAnswer","commit","catch","isRunning","setRunningY","setRunningN","app","none","setNeedRefreshY","setStatusWait","setNeedRefreshN","setStatusNone","needRefresh","offerId","ID","offer","Application","option","init","initProvider","iniController","subscribeToEvents","subscribeToStoreChanges","BasketRestHandler","basket","setStore","setProvider","Event","EventEmitter","subscribe","EventType","order","success","e","handlerOrderSuccess","buttonRemoveProduct","Runtime","debounce","handlerRemove","buttonPlusProduct","handlerQuantityPlus","buttonMinusProduct","handlerQuantityMinus","buttonRestoreProduct","handlerRestore","handlerNeedRefreshY","refreshAfter","handlerNeedRefreshN","changeSku","handlerChangeSku","consent","refused","handlerConsentRefused","accepted","handlerConsentAccepted","element","buttonCheckout","handlerCheckout","buttonShipping","handlerShipping","paysystem","beforeInitList","paySystemSetStatusWait","afterInitList","paySystemSetStatusNone","paySystem","ConsentConst","validate","submit","consentStatus","allowed","appSetStatusWait","saveOrder","appSetStatusNone","url","History","pushState","accountNumber","access","hash","view","UserConsent","saleEntitySaveOrder","siteId","personTypeId","tradingPlatformId","properties","preparePropertyFields","getPropertyList","error","errors","list","key","hasOwnProperty","forEach","property","inx"],"mappings":"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"}