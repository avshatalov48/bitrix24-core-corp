{"version":3,"file":"controller.bundle.js","sources":["../src/basket.js","../src/application.js"],"sourcesContent":["import { ajax } from 'main.core';\nimport { Pool, Timer, Basket as Lib } from 'sale.checkout.lib'\nimport {\n    Application as ApplicationConst,\n    RestMethod as RestMethodConst,\n    Component as ComponentConst,\n    Loader as LoaderConst,\n    Pool as PoolConst,\n} from 'sale.checkout.const';\n\nexport class Basket\n{\n    constructor()\n    {\n        this.pool = this.getPool();\n        this.timer = this.getTimer();\n\n        this.running = 'N';\n    }\n\n    /**\n     * @private\n     */\n    getPool()\n    {\n        return new Pool();\n    }\n\n    /**\n     * @private\n     */\n    getTimer()\n    {\n        return new Timer();\n    }\n\n    /**\n     * @private\n     */\n    isRunning()\n    {\n        return this.running === 'Y';\n    }\n\n    /**\n     * @private\n     */\n    setRunningY()\n    {\n        this.running = 'Y'\n    }\n\n    /**\n     * @private\n     */\n    setRunningN()\n    {\n        this.running = 'N'\n    }\n\n    /**\n     * @private\n     */\n    setStore(store)\n    {\n        this.store = store;\n        return this;\n    }\n\n    /**\n     * @private\n     */\n    setProvider(provider)\n    {\n        this.provider = provider;\n        return this;\n    }\n\n    /**\n     * @private\n     */\n    executeRestAnswer(command, result, extra)\n    {\n        return this.provider.execute(command, result, extra);\n    }\n\n    /**\n     * @private\n     */\n    getItem(index)\n    {\n        return this.store.getters['basket/get'](index);\n    }\n\n    /**\n     * @private\n     */\n    getBasket()\n    {\n        return this.store.getters['basket/getBasket'];\n    }\n\n\t/**\n\t * @private\n\t */\n\tgetBasketCollection()\n\t{\n\t\treturn this.getBasket().filter(item => item.deleted === 'N');\n\t}\n\n    /**\n     * @private\n     */\n    changeItem(product)\n    {\n        this.store.dispatch('basket/changeItem', {\n            index: product.index,\n            fields: product.fields\n        });\n    }\n\n    /**\n     * @private\n     */\n    setQuantity(index, quantity)\n    {\n        let fields = this.getItem(index);\n\n        fields.quantity = quantity;\n        fields.baseSum = this.round(fields.basePrice * fields.quantity);\n        fields.sum = this.round(fields.price * fields.quantity);\n        fields.discount.sum = this.round(fields.discount.price * fields.quantity);\n\n        this.refreshDiscount();\n        this.refreshTotal();\n\n        this.pool.add(PoolConst.action.quantity, index, {id: fields.id, value: fields.quantity});\n        this.changeItem({index, fields});\n        this.shelveCommit();\n    }\n\n    refreshDiscount()\n    {\n        let basket = this.getBasket();\n        if(basket.length > 0)\n        {\n            this.store.dispatch('basket/setDiscount', {\n                sum: basket.reduce((result, value) => result + value.discount.sum, 0),\n            });\n        }\n    }\n\n    refreshTotal()\n    {\n        let basket = this.getBasketCollection();\n        if(basket.length > 0)\n        {\n            this.store.dispatch('basket/setTotal', {\n                price: basket.reduce((result, value) => result + value.sum, 0),\n                basePrice: basket.reduce((result, value) => result + value.baseSum, 0)\n            });\n        }\n    }\n\n    /**\n     * @private\n     */\n    removeItem(product)\n    {\n        return this.store.dispatch('basket/removeItem', {\n            index: product.index\n        });\n    }\n\n    /**\n     * @private\n     */\n    round(value, precision = 10)\n    {\n        const factor = Math.pow(10, precision);\n\n        return Math.round(value * factor) / factor;\n    }\n\n    emitOnBasketChange()\n    {\n        BX.onCustomEvent('OnBasketChange');\n    }\n\n    /**\n     * @private\n     */\n    handlerOrderSuccess()\n    {\n        this.emitOnBasketChange()\n    }\n\n    /**\n     * @private\n     */\n    handlerRemoveProductSuccess()\n    {\n        this.emitOnBasketChange()\n    }\n\n    /**\n     * @private\n     */\n    handlerRestoreProductSuccess()\n    {\n        this.emitOnBasketChange()\n    }\n\n    /**\n     * @private\n     */\n    handlerRemove(event)\n    {\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n\n        fields.deleted = 'Y';\n        fields.status = LoaderConst.status.wait;\n\n        this.pool.add(PoolConst.action.delete, index, {id: fields.id, fields: {value: 'Y'}});\n        this.changeItem({index, fields});\n        this.shelveCommit();\n    }\n\n    /**\n     * @private\n     */\n    handlerSuccessRemove(event)\n    {\n        let index = event.getData().index;\n\n        this.timer.create(5000, index + '_DELETE', () =>\n            this.removeItem({index})\n                .then(() =>\n                {\n                    if(this.getBasket().length === 0)\n                    {\n                        this.store.dispatch('application/setStage', {stage: ApplicationConst.stage.empty})\n                    }\n                })\n        )\n    }\n\n    /**\n     * @private\n     */\n    handlerRestore(event)\n    {\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n\n        this.timer.clean({\n            index: index + '_DELETE'\n        });\n\n        fields.deleted = 'N';\n        fields.status = LoaderConst.status.wait;\n\n        //todo: send all fields ?\n        this.pool.add(PoolConst.action.restore, index, {\n            basePrice:fields.basePrice,\n            baseSum:fields.baseSum,\n            currency:fields.currency,\n            discount:fields.discount,\n            id:fields.id,\n            measureText:fields.measureText,\n            module:fields.module,\n            name:fields.name,\n            price:fields.price,\n            product:fields.product,\n            productProviderClass:fields.productProviderClass,\n            props:fields.props,\n            quantity:fields.quantity,\n            sum:fields.sum,\n        });\n        this.changeItem({index, fields});\n        this.shelveCommit();\n    }\n\n    /**\n     * @private\n     */\n    handlerChangeQuantity(event)\n    {\n        // let data = event.getData().data;\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n\n        let quantity = fields.quantity;\n        let ratio = fields.product.ratio;\n        let available = fields.product.availableQuantity;\n\n        quantity = Lib.roundValue(quantity)\n        ratio = Lib.roundValue(ratio)\n\n        quantity = isNaN(quantity) ? 0:quantity\n\n        if (ratio > 0 && quantity < ratio)\n        {\n            quantity = ratio;\n        }\n\n        if (available > 0 && quantity > available)\n        {\n            quantity = available;\n        }\n\n        quantity = Lib.toFixed(quantity, ratio, available)\n\n        if(fields.quantity !== quantity)\n        {\n            this.setQuantity(index, quantity)\n        }\n    }\n\n    /**\n     * @private\n     */\n    handlerQuantityPlus(event)\n    {\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n        let quantity = fields.quantity;\n        let ratio = fields.product.ratio;\n        let available = fields.product.availableQuantity;\n\n        quantity = Lib.roundValue(quantity)\n        ratio = Lib.roundValue(ratio)\n\n        quantity = quantity + ratio;\n\n        if(Lib.isValueFloat(quantity))\n        {\n            quantity = Lib.roundFloatValue(quantity)\n        }\n\n        if (available > 0 && quantity > available)\n        {\n            quantity = available;\n        }\n\n        quantity = Lib.toFixed(quantity, ratio, available)\n\n        if(fields.quantity < quantity)\n        {\n            this.setQuantity(index, quantity)\n        }\n    }\n\n    /**\n     * @private\n     */\n    handlerQuantityMinus(event)\n    {\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n        let quantity = fields.quantity;\n        let ratio = fields.product.ratio;\n        let available = fields.product.availableQuantity;\n\n        quantity = Lib.roundValue(quantity)\n        ratio = Lib.roundValue(ratio)\n\n        let delta = quantity = quantity - ratio;\n\n        if(Lib.isValueFloat(quantity))\n        {\n            quantity = Lib.roundFloatValue(quantity)\n\t\t\tdelta = Lib.roundFloatValue(delta)\n        }\n\n        if (ratio > 0 && quantity < ratio)\n        {\n            quantity = ratio;\n        }\n\n        if (available > 0 && quantity > available)\n        {\n            quantity = available;\n        }\n\n        quantity = Lib.toFixed(quantity, ratio, available)\n\n        if(delta >= ratio)\n        {\n            this.setQuantity(index, quantity)\n        }\n    }\n\n    /**\n     * @private\n     */\n    commit()\n    {\n        return new Promise((resolve, reject) =>\n        {\n            let fields = {};\n\n            if(this.pool.isEmpty() === false)\n            {\n                fields = this.pool.get();\n                this.pool.clean();\n\n                const component = ComponentConst.bitrixSaleOrderCheckout;\n                const cmd = RestMethodConst.saleEntityRecalculateBasket;\n\n                ajax.runComponentAction(\n                    component,\n                    cmd,\n                    {\n                        data: {\n                            actions: fields\n                        },\n                        signedParameters: this.store.getters['application/getSignedParameters']\n                    }\n                )\n                .then((result) => this.executeRestAnswer(cmd, result, this.pool)\n                    .then(() => this.commit()\n                        .then(() => resolve())))\n                .catch()\n            }\n            else\n            {\n                resolve();\n            }\n        });\n    }\n\n    /**\n     * @private\n     */\n    shelveCommit(index = 'BASKET')\n    {\n        if(this.isRunning() === false)\n        {\n            this.timer.create(300, index,\n                () => {\n                    this.setRunningY();\n                    this.commit()\n                        .then(()=>this.setRunningN())\n                }\n            );\n        }\n    }\n\n    /**\n     * @private\n     */\n    getStatus()\n    {\n        return this.store.getters['basket/getStatus'];\n    }\n\n    /**\n     * @private\n     */\n    setStatusWait()\n    {\n        let app = {status: LoaderConst.status.wait};\n        return this.store.dispatch('basket/setStatus', app);\n    }\n\n    /**\n     * @private\n     */\n    setStatusNone()\n    {\n        let app = {status: LoaderConst.status.none};\n        return this.store.dispatch('basket/setStatus', app);\n    }\n\n    /**\n     * @private\n     */\n    handlerNeedRefreshY()\n    {\n        this.setNeedRefreshY();\n        this.setStatusWait();\n    }\n\n    /**\n     * @private\n     */\n    handlerNeedRefreshN()\n    {\n        this.setNeedRefreshN();\n        this.setStatusNone();\n    }\n\n    /**\n     * @private\n     */\n    setNeedRefreshY()\n    {\n        let app = {needRefresh: 'Y'};\n        return this.store.dispatch('basket/setNeedRefresh', app);\n    }\n\n    /**\n     * @private\n     */\n    setNeedRefreshN()\n    {\n        let app = {needRefresh: 'N'};\n        return this.store.dispatch('basket/setNeedRefresh', app);\n    }\n\n    /**\n     * @private\n     */\n    handlerChangeSku(event)\n    {\n        let offerId = event.getData().data[0].ID;\n\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n\n        fields.status = LoaderConst.status.wait;\n\n        this.pool.add(PoolConst.action.offer, index, {id: fields.id, fields: {offerId: offerId}});\n        this.changeItem({index, fields});\n        this.shelveCommit();\n    }\n}\n","import { Runtime, ajax } from 'main.core';\r\nimport { EventEmitter } from 'main.core.events'\r\nimport { BasketRestHandler } from 'sale.checkout.provider.rest'\r\nimport {\r\n\tApplication as ApplicationConst,\r\n\tRestMethod as RestMethodConst,\r\n\tComponent as ComponentConst,\r\n\tConsent as ConsentConst,\r\n\tLoader as LoaderConst,\r\n\tEventType\r\n} from 'sale.checkout.const';\r\n\r\nimport { History } from 'sale.checkout.lib';\r\n\r\nimport { Basket } from \"./basket\";\r\n\r\nexport class Application\r\n{\r\n\tconstructor(option)\r\n\t{\r\n\t\tthis.init(option)\r\n\t\t\t.then(() => this.initProvider())\r\n\t\t\t.then(() => this.iniController())\r\n\t\t\t.then(() => this.subscribeToEvents())\r\n\t\t\t.then(() => this.subscribeToStoreChanges())\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tinit(option)\r\n\t{\r\n\t\tthis.store = option.store;\r\n\t\treturn new Promise((resolve, reject) => resolve());\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tinitProvider()\r\n\t{\r\n\t\tthis.provider = BasketRestHandler.create({store: this.store})\r\n\t\treturn new Promise((resolve, reject) => resolve());\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tiniController()\r\n\t{\r\n\t\tthis.basket = new Basket().setStore(this.store).setProvider(this.provider);\r\n\t\treturn new Promise((resolve, reject) => resolve());\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\texecuteRestAnswer(command, result, extra)\r\n\t{\r\n\t\treturn this.provider.execute(command, result, extra);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tsubscribeToEvents()\r\n\t{\r\n\t\tEventEmitter.subscribe(EventType.order.success, (e)=>this.basket.handlerOrderSuccess(e));\r\n\r\n\t\tEventEmitter.subscribe(EventType.basket.removeProduct, (e)=>this.basket.handlerRemoveProductSuccess(e));\r\n\t\tEventEmitter.subscribe(EventType.basket.restoreProduct, (e)=>this.basket.handlerRestoreProductSuccess(e));\r\n\r\n\t\tEventEmitter.subscribe(EventType.basket.buttonRemoveProduct, Runtime.debounce((e)=>this.basket.handlerRemove(e), 500, this));\r\n\t\tEventEmitter.subscribe(EventType.basket.buttonPlusProduct, (e) => this.basket.handlerQuantityPlus(e));\r\n\t\tEventEmitter.subscribe(EventType.basket.buttonMinusProduct, (e) => this.basket.handlerQuantityMinus(e));\r\n\t\tEventEmitter.subscribe(EventType.basket.inputChangeQuantityProduct, (e) => this.basket.handlerChangeQuantity(e));\r\n\t\tEventEmitter.subscribe(EventType.basket.buttonRestoreProduct, Runtime.debounce((e) => this.basket.handlerRestore(e), 500, this));\r\n\t\tEventEmitter.subscribe(EventType.basket.needRefresh, (e) => this.basket.handlerNeedRefreshY(e));\r\n\t\tEventEmitter.subscribe(EventType.basket.refreshAfter, (e) => this.basket.handlerNeedRefreshN(e));\r\n\t\r\n\t\tEventEmitter.subscribe(EventType.basket.changeSku, (e) => this.basket.handlerChangeSku(e));\r\n\t\t\r\n\t\tEventEmitter.subscribe(EventType.consent.refused, () => this.handlerConsentRefused());\r\n\t\tEventEmitter.subscribe(EventType.consent.accepted, () => this.handlerConsentAccepted());\r\n\t\r\n\t\tEventEmitter.subscribe(EventType.element.buttonCheckout, Runtime.debounce(() => this.handlerCheckout(), 1000, this));\r\n\t\tEventEmitter.subscribe(EventType.element.buttonShipping, Runtime.debounce(() => this.handlerShipping(), 1000, this));\r\n\t\r\n\t\tEventEmitter.subscribe(EventType.paysystem.beforeInitList, () => this.paySystemSetStatusWait());\r\n\t\tEventEmitter.subscribe(EventType.paysystem.afterInitList, () => this.paySystemSetStatusNone());\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tsubscribeToStoreChanges()\r\n\t{\r\n\t\t// this.store.subscribe((mutation, state) => {\r\n\t\t//\t const { payload, type } = mutation;\r\n\t\t//\t if (type === 'basket/setNeedRefresh')\r\n\t\t//\t {\r\n\t\t//\t \talert('@@');\r\n\t\t//\t \tthis.getData();\r\n\t\t//\t }\r\n\t\t// });\r\n\r\n\t\treturn new Promise((resolve, reject) => resolve());\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tpaySystemSetStatusWait()\r\n\t{\r\n\t\tlet paySystem = { status: LoaderConst.status.wait};\r\n\t\treturn this.store.dispatch('pay-system/setStatus', paySystem);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tpaySystemSetStatusNone()\r\n\t{\r\n\t\tlet paySystem = { status: LoaderConst.status.none};\r\n\t\treturn this.store.dispatch('pay-system/setStatus', paySystem);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tappSetStatusWait()\r\n\t{\r\n\t\tlet app = { status: LoaderConst.status.wait};\r\n\t\treturn this.store.dispatch('application/setStatus', app);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tappSetStatusNone()\r\n\t{\r\n\t\tlet app = { status: LoaderConst.status.none};\r\n\t\treturn this.store.dispatch('application/setStatus', app);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\thandlerConsentAccepted()\r\n\t{\r\n\t\tthis.store.dispatch('consent/setStatus', ConsentConst.status.accepted);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\thandlerConsentRefused()\r\n\t{\r\n\t\tthis.store.dispatch('consent/setStatus', ConsentConst.status.refused);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\thandlerCheckout()\r\n\t{\r\n\t\tBX.onCustomEvent(ConsentConst.validate.submit, []);\r\n\r\n\t\tconst consent = this.store.getters['consent/get'];\r\n\t\tconst consentStatus = this.store.getters['consent/getStatus'];\r\n\t\tconst allowed = consent.id > 0 ?  consentStatus === ConsentConst.status.accepted:true;\r\n\r\n\t\tif(allowed)\r\n\t\t{\r\n\t\t\t// this.propertiesValidate();\r\n\t\t\t// this.propertiesIsValid() ? alert('propsSuccess'):alert('propsError')\r\n \r\n\t\t\tthis.appSetStatusWait();\r\n\r\n\t\t\tthis.saveOrder()\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tthis.appSetStatusNone()\r\n\t\t\t\t\t\t\t.then(()=>\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlet order = this.store.getters['order/getOrder'];\r\n\r\n\t\t\t\t\t\t\t\tif(order.id>0)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tconst url = History.pushState(\r\n\t\t\t\t\t\t\t\t\t\tthis.store.getters['application/getPathLocation'],\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\taccountNumber: order.accountNumber,\r\n\t\t\t\t\t\t\t\t\t\t\taccess: order.hash\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\t\t\tthis.store.dispatch('application/setPathLocation', url);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t)\r\n\t\t\t\t.catch(() => this.appSetStatusNone())\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\thandlerShipping()\r\n\t{\r\n\t\tthis.store.dispatch('application/setStage', {stage: ApplicationConst.stage.view});\r\n\t\t// todo\r\n\t\tdelete BX.UserConsent;\r\n\t\t\r\n\t\tlet order = this.store.getters['order/getOrder'];\r\n\t\tif(order.id>0)\r\n\t\t{\r\n\t\t\tconst component = ComponentConst.bitrixSaleOrderCheckout;\r\n\t\t\tconst cmd = RestMethodConst.saleEntityPaymentPay;\r\n\t\t\treturn ajax.runComponentAction(\r\n\t\t\t\tcomponent,\r\n\t\t\t\tcmd,\r\n\t\t\t\t{\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tfields: {\r\n\t\t\t\t\t\t\torderId: order.id,\r\n\t\t\t\t\t\t\taccessCode: order.hash\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsignedParameters: this.store.getters['application/getSignedParameters']\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tsaveOrder()\r\n\t{\r\n\t\tconst component = ComponentConst.bitrixSaleOrderCheckout;\r\n\t\tconst cmd = RestMethodConst.saleEntitySaveOrder;\r\n\t\treturn ajax.runComponentAction(\r\n\t\t\tcomponent,\r\n\t\t\tcmd,\r\n\t\t\t{\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tfields: {\r\n\t\t\t\t\t\tsiteId: this.store.getters['application/getSiteId'],\r\n\t\t\t\t\t\tpersonTypeId: this.store.getters['application/getPersonTypeId'],\r\n\t\t\t\t\t\ttradingPlatformId: this.store.getters['application/getTradingPlatformId'],\r\n\t\t\t\t\t\tproperties: this.preparePropertyFields(\r\n\t\t\t\t\t\t\tthis.getPropertyList()\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsignedParameters: this.store.getters['application/getSignedParameters']\r\n\t\t\t}\r\n\t\t)\r\n\t\t\t.then((result) => this.executeRestAnswer(cmd, result))\r\n\t\t\t.catch((result) => this.executeRestAnswer(cmd, {error: result.errors}));\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tgetPropertyList()\r\n\t{\r\n\t\tconst result = [];\r\n\t\tlet list = this.store.getters['property/getProperty'];\r\n\t\ttry\r\n\t\t{\r\n\t\t\tfor (let key in list)\r\n\t\t\t{\r\n\t\t\t\tif (!list.hasOwnProperty(key))\r\n\t\t\t\t{\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresult[list[key].id] = list[key];\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (e) {}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tpreparePropertyFields(list)\r\n\t{\r\n\t\tlet fields = {};\r\n\t\tlist.forEach((property, inx)=>\r\n\t\t{\r\n\t\t\tfields[inx] = property.value\r\n\t\t})\r\n\t\treturn fields;\r\n\t}\r\n}"],"names":["Basket","pool","getPool","timer","getTimer","running","Pool","Timer","store","provider","command","result","extra","execute","index","getters","getBasket","filter","item","deleted","product","dispatch","fields","quantity","getItem","baseSum","round","basePrice","sum","price","discount","refreshDiscount","refreshTotal","add","PoolConst","action","id","value","changeItem","shelveCommit","basket","length","reduce","getBasketCollection","precision","factor","Math","pow","BX","onCustomEvent","emitOnBasketChange","event","getData","status","LoaderConst","wait","create","removeItem","then","stage","ApplicationConst","empty","clean","restore","currency","measureText","module","name","productProviderClass","props","ratio","available","availableQuantity","Lib","roundValue","isNaN","toFixed","setQuantity","isValueFloat","roundFloatValue","delta","Promise","resolve","reject","isEmpty","get","component","ComponentConst","bitrixSaleOrderCheckout","cmd","RestMethodConst","saleEntityRecalculateBasket","ajax","runComponentAction","data","actions","signedParameters","executeRestAnswer","commit","isRunning","setRunningY","setRunningN","app","none","setNeedRefreshY","setStatusWait","setNeedRefreshN","setStatusNone","needRefresh","offerId","ID","offer","Application","option","init","initProvider","iniController","subscribeToEvents","subscribeToStoreChanges","BasketRestHandler","setStore","setProvider","EventEmitter","subscribe","EventType","order","success","e","handlerOrderSuccess","removeProduct","handlerRemoveProductSuccess","restoreProduct","handlerRestoreProductSuccess","buttonRemoveProduct","Runtime","debounce","handlerRemove","buttonPlusProduct","handlerQuantityPlus","buttonMinusProduct","handlerQuantityMinus","inputChangeQuantityProduct","handlerChangeQuantity","buttonRestoreProduct","handlerRestore","handlerNeedRefreshY","refreshAfter","handlerNeedRefreshN","changeSku","handlerChangeSku","consent","refused","handlerConsentRefused","accepted","handlerConsentAccepted","element","buttonCheckout","handlerCheckout","buttonShipping","handlerShipping","paysystem","beforeInitList","paySystemSetStatusWait","afterInitList","paySystemSetStatusNone","paySystem","ConsentConst","validate","submit","consentStatus","allowed","appSetStatusWait","saveOrder","appSetStatusNone","url","History","pushState","accountNumber","access","hash","view","UserConsent","saleEntityPaymentPay","orderId","accessCode","saleEntitySaveOrder","siteId","personTypeId","tradingPlatformId","properties","preparePropertyFields","getPropertyList","error","errors","list","key","hasOwnProperty","forEach","property","inx"],"mappings":"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"}