{"version":3,"file":"registry.bundle.js","sources":["../src/methods.js"],"sourcesContent":["import { EventType } from 'sale.payment-pay.const';\nimport { EventEmitter } from 'main.core.events';\nimport { VirtualForm, PaymentProcess } from 'sale.payment-pay.lib';\nimport { StageType } from 'sale.payment-pay.const';\n\nexport default {\n\tmethods:\n\t{\n\t\t//region payment-process\n\t\tprepareParamsPaymentInfo(settings)\n\t\t{\n\t\t\treturn {\n\t\t\t\tpaySystem: settings.get('app.paySystems', [])[0],\n\t\t\t\ttitle: settings.get('app.title'),\n\t\t\t\tsum: settings.get('payment.sumFormatted'),\n\t\t\t\tpaid: settings.get('payment.paid'),\n\t\t\t\tchecks: settings.get('payment.checks', []),\n\t\t\t}\n\t\t},\n\t\tprepareParamsPaymentProcess(settings)\n\t\t{\n\t\t\treturn {\n\t\t\t\treturnUrl: settings.get('paymentProcess.returnUrl'),\n\t\t\t\torderId: settings.get('paymentProcess.orderId'),\n\t\t\t\tpaymentId: settings.get('paymentProcess.paymentId'),\n\t\t\t\taccessCode: settings.get('paymentProcess.accessCode'),\n\t\t\t\tallowPaymentRedirect: settings.get('paymentProcess.allowPaymentRedirect'),\n\t\t\t}\n\t\t},\n\t\tstartPayment(paySystemId)\n\t\t{\n\t\t\tif (this.loading)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.loading = true;\n\t\t\tthis.stages.paySystemList.selectedPaySystem = paySystemId;\n\t\t\tthis.backendProvider.paySystemId = paySystemId;\n\t\t\tthis.paymentProcess.start();\n\t\t},\n\t\tinitPayment()\n\t\t{\n\t\t\tthis.initBackendProvider();\n\t\t\tthis.initPaymentProcess();\n\t\t},\n\t\tinitBackendProvider()\n\t\t{\n\t\t\tthrow new Error(\"Method 'initBackendProvider' must be overloaded\");\n\t\t},\n\t\tinitPaymentProcess()\n\t\t{\n\t\t\tthis.paymentProcess = new PaymentProcess({\n\t\t\t\tbackendProvider: this.backendProvider,\n\t\t\t\tallowPaymentRedirect: this.paymentProcess.allowPaymentRedirect,\n\t\t\t});\n\t\t},\n\t\t//endregion\n\n\t\t//region pay-system\n\t\tsubscribeToGlobalEvents()\n\t\t{\n\t\t\tEventEmitter.subscribe(EventType.payment.reset, (e) => { this.resetView(this.props) });\n\t\t\tEventEmitter.subscribe(EventType.payment.error, (e) => { this.handlePaymentError(e.getData()) });\n\t\t\tEventEmitter.subscribe(EventType.payment.success, (e) => { this.handlePaymentSuccess(e.getData()) });\n\t\t\tEventEmitter.subscribe(EventType.global.paySystemAjaxError, (e) => { this.handlePaySystemAjaxError(e.getData()) });\n\t\t\tEventEmitter.subscribe(EventType.global.paySystemUpdateTemplate, (e) => { this.handlePaySystemUpdateTemplate(e.getData()) });\n\t\t},\n\t\thandlePaymentError(response)\n\t\t{\n\t\t\tthis.stages.paySystemErrors.errors = response.errors || [];\n\t\t\tthis.stage = StageType.errors;\n\t\t},\n\t\thandlePaymentSuccess(response)\n\t\t{\n\t\t\tthis.stages.paySystemResult.html = response.data.html || null;\n\t\t\tthis.stages.paySystemResult.fields = response.data.fields || null;\n\t\t\tthis.stage = StageType.result;\n\t\t},\n\t\thandlePaySystemAjaxError(data)\n\t\t{\n\t\t\tthis.stages.paySystemErrors.errors = data || [];\n\t\t\tthis.stage = StageType.errors;\n\t\t},\n\t\thandlePaySystemUpdateTemplate(data)\n\t\t{\n\t\t\tVirtualForm.createFromNode(this.$el).submit();\n\t\t},\n\t\tresetView(props)\n\t\t{\n\t\t\tthis.stages = this.prepareParamsStages(props);\n\t\t\tthis.stage = this.setStageType(props);\n\t\t\tthis.loading = false;\n\t\t},\n\t\tcurrentPS(selected, list)\n\t\t{\n\t\t\treturn list.find(ps => ps.ID === selected);\n\t\t},\n\t\tprepareParamsStages(props)\n\t\t{\n\t\t\tthrow new Error(\"Method 'initStages' must be overloaded\")\n\t\t},\n\t\tsetStageType(props)\n\t\t{\n\t\t\tthrow new Error(\"Method 'setStageType' must be overloaded\")\n\t\t}\n\t\t//endregion\n\t},\n};"],"names":["methods","prepareParamsPaymentInfo","settings","paySystem","get","title","sum","paid","checks","prepareParamsPaymentProcess","returnUrl","orderId","paymentId","accessCode","allowPaymentRedirect","startPayment","paySystemId","loading","stages","paySystemList","selectedPaySystem","backendProvider","paymentProcess","start","initPayment","initBackendProvider","initPaymentProcess","Error","PaymentProcess","subscribeToGlobalEvents","EventEmitter","subscribe","EventType","payment","reset","e","resetView","props","error","handlePaymentError","getData","success","handlePaymentSuccess","global","paySystemAjaxError","handlePaySystemAjaxError","paySystemUpdateTemplate","handlePaySystemUpdateTemplate","response","paySystemErrors","errors","stage","StageType","paySystemResult","html","data","fields","result","VirtualForm","createFromNode","$el","submit","prepareParamsStages","setStageType","currentPS","selected","list","find","ps","ID"],"mappings":";;;;;;;AAKA,eAAe;CACdA,EAAAA,OAAO,EACP;CACC;CACAC,IAAAA,wBAFD,oCAE0BC,QAF1B,EAGC;CACC,aAAO;CACNC,QAAAA,SAAS,EAAED,QAAQ,CAACE,GAAT,CAAa,gBAAb,EAA+B,EAA/B,EAAmC,CAAnC,CADL;CAENC,QAAAA,KAAK,EAAEH,QAAQ,CAACE,GAAT,CAAa,WAAb,CAFD;CAGNE,QAAAA,GAAG,EAAEJ,QAAQ,CAACE,GAAT,CAAa,sBAAb,CAHC;CAING,QAAAA,IAAI,EAAEL,QAAQ,CAACE,GAAT,CAAa,cAAb,CAJA;CAKNI,QAAAA,MAAM,EAAEN,QAAQ,CAACE,GAAT,CAAa,gBAAb,EAA+B,EAA/B;CALF,OAAP;CAOA,KAXF;CAYCK,IAAAA,2BAZD,uCAY6BP,QAZ7B,EAaC;CACC,aAAO;CACNQ,QAAAA,SAAS,EAAER,QAAQ,CAACE,GAAT,CAAa,0BAAb,CADL;CAENO,QAAAA,OAAO,EAAET,QAAQ,CAACE,GAAT,CAAa,wBAAb,CAFH;CAGNQ,QAAAA,SAAS,EAAEV,QAAQ,CAACE,GAAT,CAAa,0BAAb,CAHL;CAINS,QAAAA,UAAU,EAAEX,QAAQ,CAACE,GAAT,CAAa,2BAAb,CAJN;CAKNU,QAAAA,oBAAoB,EAAEZ,QAAQ,CAACE,GAAT,CAAa,qCAAb;CALhB,OAAP;CAOA,KArBF;CAsBCW,IAAAA,YAtBD,wBAsBcC,WAtBd,EAuBC;CACC,UAAI,KAAKC,OAAT,EACA;CACC,eAAO,KAAP;CACA;;CAED,WAAKA,OAAL,GAAe,IAAf;CACA,WAAKC,MAAL,CAAYC,aAAZ,CAA0BC,iBAA1B,GAA8CJ,WAA9C;CACA,WAAKK,eAAL,CAAqBL,WAArB,GAAmCA,WAAnC;CACA,WAAKM,cAAL,CAAoBC,KAApB;CACA,KAjCF;CAkCCC,IAAAA,WAlCD,yBAmCC;CACC,WAAKC,mBAAL;CACA,WAAKC,kBAAL;CACA,KAtCF;CAuCCD,IAAAA,mBAvCD,iCAwCC;CACC,YAAM,IAAIE,KAAJ,CAAU,iDAAV,CAAN;CACA,KA1CF;CA2CCD,IAAAA,kBA3CD,gCA4CC;CACC,WAAKJ,cAAL,GAAsB,IAAIM,kCAAJ,CAAmB;CACxCP,QAAAA,eAAe,EAAE,KAAKA,eADkB;CAExCP,QAAAA,oBAAoB,EAAE,KAAKQ,cAAL,CAAoBR;CAFF,OAAnB,CAAtB;CAIA,KAjDF;CAkDC;CAEA;CACAe,IAAAA,uBArDD,qCAsDC;CAAA;;CACCC,MAAAA,6BAAY,CAACC,SAAb,CAAuBC,+BAAS,CAACC,OAAV,CAAkBC,KAAzC,EAAgD,UAACC,CAAD,EAAO;CAAE,QAAA,KAAI,CAACC,SAAL,CAAe,KAAI,CAACC,KAApB;CAA4B,OAArF;CACAP,MAAAA,6BAAY,CAACC,SAAb,CAAuBC,+BAAS,CAACC,OAAV,CAAkBK,KAAzC,EAAgD,UAACH,CAAD,EAAO;CAAE,QAAA,KAAI,CAACI,kBAAL,CAAwBJ,CAAC,CAACK,OAAF,EAAxB;CAAsC,OAA/F;CACAV,MAAAA,6BAAY,CAACC,SAAb,CAAuBC,+BAAS,CAACC,OAAV,CAAkBQ,OAAzC,EAAkD,UAACN,CAAD,EAAO;CAAE,QAAA,KAAI,CAACO,oBAAL,CAA0BP,CAAC,CAACK,OAAF,EAA1B;CAAwC,OAAnG;CACAV,MAAAA,6BAAY,CAACC,SAAb,CAAuBC,+BAAS,CAACW,MAAV,CAAiBC,kBAAxC,EAA4D,UAACT,CAAD,EAAO;CAAE,QAAA,KAAI,CAACU,wBAAL,CAA8BV,CAAC,CAACK,OAAF,EAA9B;CAA4C,OAAjH;CACAV,MAAAA,6BAAY,CAACC,SAAb,CAAuBC,+BAAS,CAACW,MAAV,CAAiBG,uBAAxC,EAAiE,UAACX,CAAD,EAAO;CAAE,QAAA,KAAI,CAACY,6BAAL,CAAmCZ,CAAC,CAACK,OAAF,EAAnC;CAAiD,OAA3H;CACA,KA5DF;CA6DCD,IAAAA,kBA7DD,8BA6DoBS,QA7DpB,EA8DC;CACC,WAAK9B,MAAL,CAAY+B,eAAZ,CAA4BC,MAA5B,GAAqCF,QAAQ,CAACE,MAAT,IAAmB,EAAxD;CACA,WAAKC,KAAL,GAAaC,+BAAS,CAACF,MAAvB;CACA,KAjEF;CAkECR,IAAAA,oBAlED,gCAkEsBM,QAlEtB,EAmEC;CACC,WAAK9B,MAAL,CAAYmC,eAAZ,CAA4BC,IAA5B,GAAmCN,QAAQ,CAACO,IAAT,CAAcD,IAAd,IAAsB,IAAzD;CACA,WAAKpC,MAAL,CAAYmC,eAAZ,CAA4BG,MAA5B,GAAqCR,QAAQ,CAACO,IAAT,CAAcC,MAAd,IAAwB,IAA7D;CACA,WAAKL,KAAL,GAAaC,+BAAS,CAACK,MAAvB;CACA,KAvEF;CAwECZ,IAAAA,wBAxED,oCAwE0BU,IAxE1B,EAyEC;CACC,WAAKrC,MAAL,CAAY+B,eAAZ,CAA4BC,MAA5B,GAAqCK,IAAI,IAAI,EAA7C;CACA,WAAKJ,KAAL,GAAaC,+BAAS,CAACF,MAAvB;CACA,KA5EF;CA6ECH,IAAAA,6BA7ED,yCA6E+BQ,IA7E/B,EA8EC;CACCG,MAAAA,+BAAW,CAACC,cAAZ,CAA2B,KAAKC,GAAhC,EAAqCC,MAArC;CACA,KAhFF;CAiFCzB,IAAAA,SAjFD,qBAiFWC,KAjFX,EAkFC;CACC,WAAKnB,MAAL,GAAc,KAAK4C,mBAAL,CAAyBzB,KAAzB,CAAd;CACA,WAAKc,KAAL,GAAa,KAAKY,YAAL,CAAkB1B,KAAlB,CAAb;CACA,WAAKpB,OAAL,GAAe,KAAf;CACA,KAtFF;CAuFC+C,IAAAA,SAvFD,qBAuFWC,QAvFX,EAuFqBC,IAvFrB,EAwFC;CACC,aAAOA,IAAI,CAACC,IAAL,CAAU,UAAAC,EAAE;CAAA,eAAIA,EAAE,CAACC,EAAH,KAAUJ,QAAd;CAAA,OAAZ,CAAP;CACA,KA1FF;CA2FCH,IAAAA,mBA3FD,+BA2FqBzB,KA3FrB,EA4FC;CACC,YAAM,IAAIV,KAAJ,CAAU,wCAAV,CAAN;CACA,KA9FF;CA+FCoC,IAAAA,YA/FD,wBA+Fc1B,KA/Fd,EAgGC;CACC,YAAM,IAAIV,KAAJ,CAAU,0CAAV,CAAN;CACA,KAlGF;;CAAA;CAFc,CAAf;;;;;;;;"}