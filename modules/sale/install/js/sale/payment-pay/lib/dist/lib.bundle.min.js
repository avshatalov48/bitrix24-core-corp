this.BX=this.BX||{};this.BX.Sale=this.BX.Sale||{};this.BX.Sale.PaymentPay=this.BX.Sale.PaymentPay||{};(function(e,t,n){"use strict";var i=function(){function e(t){babelHelpers.classCallCheck(this,e);this.options=t||{}}babelHelpers.createClass(e,[{key:"initiatePayment",value:function e(){}},{key:"getResponse",value:function e(){}},{key:"isResponseSucceed",value:function e(){}},{key:"getPaymentGateUrl",value:function e(){}},{key:"getPaymentFormHtml",value:function e(){}},{key:"option",value:function e(t,n){return this.options.hasOwnProperty(t)?this.options[t]:n}}]);return e}();var r=function(){function e(t){babelHelpers.classCallCheck(this,e);this.form=t||null}babelHelpers.createClass(e,[{key:"submit",value:function e(){if(!this.canSubmit()){return}if(this.isVirtual()){document.body.appendChild(this.form.parentNode)}HTMLFormElement.prototype.submit.call(this.form)}},{key:"canSubmit",value:function e(){return this.isValidFormObject()&&this.containsAllowedInputTypesOnly()}},{key:"isValidFormObject",value:function e(){return this.form instanceof HTMLFormElement}},{key:"containsAllowedInputTypesOnly",value:function t(){if(!this.form||!this.form.elements){return false}for(var n=0;n<this.form.elements.length;n++){if(!e.elementAllowed(this.form.elements[n])){return false}}return true}},{key:"isVirtual",value:function e(){if(this.form){return!document.body.contains(this.form)}return true}}],[{key:"createFromHtml",value:function t(n){var i=document.createElement("div");i.innerHTML=n;i.style.display="none";var r=i.querySelector("form");return new e(r)}},{key:"createFromNode",value:function t(n){if(n instanceof HTMLFormElement){return new e(n)}var i=n.querySelector("form");return new e(i)}},{key:"elementAllowed",value:function t(n){var i=e.getAllowedInputTypes();if(n instanceof HTMLInputElement){return i.indexOf(n.type)!==-1}return true}},{key:"getAllowedInputTypes",value:function e(){return["hidden","submit"]}}]);return e}();var o=function(){function e(t){babelHelpers.classCallCheck(this,e);this.options=t||{};this.backendProvider=this.option("backendProvider",null);if(!this.backendProvider||!this.backendProvider instanceof i){throw new Error("Invalid backend provider")}this.allowPaymentRedirect=this.option("allowPaymentRedirect",true)}babelHelpers.createClass(e,[{key:"start",value:function e(){var t=this;this.backendProvider.initiatePayment().then(function(){t.handleResponse()})}},{key:"handleResponse",value:function e(){if(this.backendProvider.isResponseSucceed()){this.tryToRedirectUserOnPaymentGate();t.EventEmitter.emit(n.EventType.payment.success,this.backendProvider.getResponse())}else{t.EventEmitter.emit(n.EventType.payment.error,this.backendProvider.getResponse())}}},{key:"tryToRedirectUserOnPaymentGate",value:function e(){var t=this.backendProvider.getPaymentGateUrl();var n=this.backendProvider.getPaymentFormHtml();if(this.allowPaymentRedirect){if(t){window.location.href=t}else if(n){this.tryToAutoSubmitHtmlChunk(n)}}}},{key:"tryToAutoSubmitHtmlChunk",value:function e(t){r.createFromHtml(t).submit()}},{key:"option",value:function e(t,n){return this.options.hasOwnProperty(t)?this.options[t]:n}}]);return e}();e.AbstractBackendProvider=i;e.PaymentProcess=o;e.VirtualForm=r})(this.BX.Sale.PaymentPay.Lib=this.BX.Sale.PaymentPay.Lib||{},BX.Event,BX.Sale.PaymentPay.Const);
//# sourceMappingURL=lib.bundle.map.js