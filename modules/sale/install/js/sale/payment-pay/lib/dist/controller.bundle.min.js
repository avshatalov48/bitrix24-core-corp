this.BX=this.BX||{};this.BX.Sale=this.BX.Sale||{};(function(e,t,n){"use strict";var r=function(){function e(t){babelHelpers.classCallCheck(this,e);this.form=t||null}babelHelpers.createClass(e,[{key:"submit",value:function e(){if(!this.canSubmit()){return}if(this.isVirtual()){document.body.appendChild(this.form.parentNode)}HTMLFormElement.prototype.submit.call(this.form)}},{key:"canSubmit",value:function e(){return this.isValidFormObject()&&this.containsAllowedInputTypesOnly()}},{key:"isValidFormObject",value:function e(){return this.form instanceof HTMLFormElement}},{key:"containsAllowedInputTypesOnly",value:function t(){if(!this.form||!this.form.elements){return false}for(var n=0;n<this.form.elements.length;n++){if(!e.elementAllowed(this.form.elements[n])){return false}}return true}},{key:"isVirtual",value:function e(){if(this.form){return!document.body.contains(this.form)}return true}}],[{key:"createFromHtml",value:function t(n){var r=document.createElement("div");r.innerHTML=n;r.style.display="none";var s=r.querySelector("form");return new e(s)}},{key:"createFromNode",value:function t(n){if(n instanceof HTMLFormElement){return new e(n)}var r=n.querySelector("form");return new e(r)}},{key:"elementAllowed",value:function t(n){var r=e.getAllowedInputTypes();if(n instanceof HTMLInputElement){return r.indexOf(n.type)!==-1}return true}},{key:"getAllowedInputTypes",value:function e(){return["hidden","submit"]}}]);return e}();var s=function(){function e(t){babelHelpers.classCallCheck(this,e);this.options=t||{};this.url=this.option("url",this.getDefaultAjaxController());this.allowPaymentRedirect=this.option("allowPaymentRedirect",true);this.returnUrl=this.option("returnUrl",this.getCurrentUrl());this.orderId=this.option("orderId",null);this.paymentId=this.option("paymentId",null);this.accessCode=this.option("accessCode",null);this.response=null}babelHelpers.createClass(e,[{key:"initPayment",value:function e(t){var n=this;if(!t.paySystemId){throw new Error("Payment system undefined")}BX.ajax({method:"POST",dataType:"json",url:this.url,data:{sessid:BX.bitrix_sessid(),paysystemId:t.paySystemId,returnUrl:this.returnUrl,orderId:this.orderId,paymentId:this.paymentId,access:this.accessCode},onsuccess:function e(t){n.response=t;n.handleResponse()}})}},{key:"handleResponse",value:function e(){if(this.isResponseSucceed()){this.tryToRedirectUserOnPaymentGate();t.EventEmitter.emit(n.EventType.payment.success,this.response)}else{t.EventEmitter.emit(n.EventType.payment.error,this.response)}}},{key:"isResponseSucceed",value:function e(){return BX.type.isObject(this.response)&&this.response.status==="success"}},{key:"tryToRedirectUserOnPaymentGate",value:function e(){var t=BX.type.isString(this.response.url)?this.response.url:"";var n=BX.type.isString(this.response.html)?this.response.html:"";if(this.allowPaymentRedirect){if(t.length>0){window.location.href=t}else if(n.length>0){this.tryToAutoSubmitHtmlChunk(n)}}}},{key:"tryToAutoSubmitHtmlChunk",value:function e(t){r.createFromHtml(t).submit()}},{key:"tryToAutoSubmitDomNode",value:function e(t){r.createFromNode(t).submit()}},{key:"getDefaultAjaxController",value:function e(){return n.Api.controller.initPayment}},{key:"getCurrentUrl",value:function e(){return window.location.href}},{key:"option",value:function e(t,n){return this.options.hasOwnProperty(t)?this.options[t]:n}}]);return e}();e.Controller=s})(this.BX.Sale.PaymentPay=this.BX.Sale.PaymentPay||{},BX.Event,BX.Sale.PaymentPay.Const);
//# sourceMappingURL=controller.bundle.map.js