this.BX=this.BX||{};this.BX.Sale=this.BX.Sale||{};this.BX.Sale.Admin=this.BX.Sale.Admin||{};(function(e,t,r){"use strict";var i=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"createWidget",value:function r(i){var a=i.items.slice(0,i.rowsCount);return new t.Widget({rowData:e._createBarcodeWidgetRows(a,i.isSupportedMarkingCode),headData:e._createBarcodeWidgetHead(i.isSupportedMarkingCode,i.useStoreControl),rowsCount:i.rowsCount,orderId:i.orderId,basketId:i.basketId,storeId:i.storeId,isBarcodeMulti:i.isBarcodeMulti,readonly:i.readonly})}},{key:"_createBarcodeWidgetHead",value:function e(t,r){var i={};if(r){i["barcode"]={title:BX.message("SALE_JS_ADMIN_ORDER_CONF_BARCODE")}}if(t){i["markingCode"]={title:BX.message("SALE_JS_ADMIN_ORDER_CONF_MARKING_CODE")}}return i}},{key:"_createBarcodeWidgetRows",value:function e(t,r){var i=[];t.forEach(function(e){var t={id:e.id};t.barcode=e.barcode;if(r){t.markingCode=e.markingCode}i.push(t)});return i}}]);return e}();function a(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="sale-shipment-basket-barcodes-dialog">\n\t\t\t\t<div class="sale-shipment-basket-barcodes-dialog-product-name">',"</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>"]);a=function t(){return e};return e}function n(){var e=babelHelpers.taggedTemplateLiteral(['<div class="sale-shipment-basket-barcodes-dialog-store-name">',"</div>"]);n=function t(){return e};return e}var o=function(){function e(t){babelHelpers.classCallCheck(this,e);this._onClose=t.onClose||null;this._columnsCount=t.columnsCount;this._dialog=this._create(t.widget,t.productName,t.storeName)}babelHelpers.createClass(e,[{key:"show",value:function e(){this._dialog.Show();this._dialog.adjustSizeEx()}},{key:"_getWidth",value:function e(){return this._columnsCount===1?280:400}},{key:"_createStoreRow",value:function e(t){var i="";if(t.length>0){i=r.Tag.render(n(),BX.util.htmlspecialchars(t))}return i}},{key:"_create",value:function e(t,i,n){var o=this;var s=r.Tag.render(a(),BX.util.htmlspecialchars(i),this._createStoreRow(n),t.render());var d=new BX.CDialog({content:s,title:BX.message("SALE_JS_ADMIN_ORDER_CONF_INPUT_BARCODES"),width:this._getWidth(),height:400,resizable:false,buttons:[new BX.CWindowButton({title:BX.message("SALE_JS_ADMIN_ORDER_CONF_CLOSE"),action:function e(){if(o._onClose){o._onClose(t)}BX.WindowManager.Get().Close()},className:"btnCloseBarcodeDialog"})]});BX.addCustomEvent(d,"onWindowClose",function(e){e.DIV.parentNode.removeChild(e.DIV)});return d}}]);return e}();function s(){var e=babelHelpers.taggedTemplateLiteral(["",""]);s=function t(){return e};return e}function d(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t\t<div>\t\t\t\t\t\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>"]);d=function t(){return e};return e}function l(){var e=babelHelpers.taggedTemplateLiteral(['<span style="cursor: pointer; border-bottom: 1px dashed;" onclick="','">',"</span>"]);l=function t(){return e};return e}function u(){var e=babelHelpers.taggedTemplateLiteral(['<input type="button" value="','" onclick="','">']);u=function t(){return e};return e}function c(){var e=babelHelpers.taggedTemplateLiteral(["<div>","","</div>"]);c=function t(){return e};return e}function _(){var e=babelHelpers.taggedTemplateLiteral(["<div></div>"]);_=function t(){return e};return e}var h=function(){function e(t){babelHelpers.classCallCheck(this,e);this._basketId=t.basketId;this._product=t.product;this._index=t.index;this._orderId=t.orderId;this._type=t.type;this._useStoreControl=t.useStoreControl;this._dataFieldTemplate=t.dataFieldTemplate||"";this._itemNode=null;this._hiddensContainer=null;this._initialStoreId=0;var r=[];if(this._product.BARCODE_INFO){var i=Object.keys(this._product.BARCODE_INFO);this._initialStoreId=i[this._index-1];if(this._initialStoreId){r=this._product.BARCODE_INFO[this._initialStoreId]}}this._items=this._initItems(r)}babelHelpers.createClass(e,[{key:"_initItems",value:function e(t){if(t.length<=0){return[]}var r=[];if(this._isSupportedMarkingCode()||this._isBarcodeMulti()){t.forEach(function(e){r.push({id:e.ID,barcode:e.BARCODE,markingCode:e.MARKING_CODE})})}else{var i=t[0];r=[{id:i.ID,barcode:i.BARCODE,markingCode:i.MARKING_CODE}]}return r}},{key:"render",value:function e(){this._itemNode=this._renderItemNode();this._hiddensContainer=r.Tag.render(_());this._renderHiddens();return r.Tag.render(c(),this._itemNode,this._hiddensContainer)}},{key:"_renderItemNode",value:function t(){var i=null;if(this._type===e.TYPE_BUTTON){i=r.Tag.render(u(),BX.message("SALE_JS_ADMIN_ORDER_CONF_BARCODES"),this._onClick.bind(this))}else if(this._type===e.TYPE_LINK){i=r.Tag.render(l(),this._onClick.bind(this),BX.message("SALE_JS_ADMIN_ORDER_CONF_BARCODE"))}else if(this._type===e.TYPE_INPUT){var a=this._createWidget(1);i=a.render()}else{throw new Error("Wrong BarcodeView type")}return i}},{key:"_getActualBarcodesQuantity",value:function e(){return this._items.length}},{key:"_getActualStoreId",value:function e(){return this._initialStoreId}},{key:"_onClick",value:function e(){var t=new o({widget:this._createWidget(),productName:this._product.NAME,storeName:this._getStoreName(this._getActualStoreId()),columnsCount:this._getColumnsCount()});t.show()}},{key:"_getColumnsCount",value:function e(){return this._isSupportedMarkingCode()&&this._useStoreControl?2:1}},{key:"_getStoreName",value:function e(t){if(this._product.STORES&&Array.isArray(this._product.STORES)){var r=this._product.STORES;for(var i=0,a=r.length;i<a;i++){if(parseInt(r[i].STORE_ID)===parseInt(t)){return r[i].STORE_NAME}}}return""}},{key:"_isBarcodeMulti",value:function e(){return this._product.BARCODE_MULTI==="Y"}},{key:"_isSupportedMarkingCode",value:function e(){return this._product.IS_SUPPORTED_MARKING_CODE==="Y"}},{key:"_createWidget",value:function e(t){return i.createWidget({items:this._items,rowsCount:t,orderId:this._orderId,basketId:this._basketId,readonly:true,useStoreControl:this._useStoreControl,storeId:this._getActualStoreId(),isBarcodeMulti:this._isBarcodeMulti(),isSupportedMarkingCode:this._isSupportedMarkingCode()})}},{key:"_renderHiddens",value:function e(){var t=this;if(!this._dataFieldTemplate){return}this._hiddensContainer.innerHTML="";var i=0;this._items.forEach(function(e){t._hiddensContainer.appendChild(r.Tag.render(d(),t._createHiddenInput("VALUE",i,e.barcode),t._createHiddenInput("ID",i,e.id),t._createHiddenInput("MARKING_CODE",i,e.markingCode)));i++})}},{key:"_createHiddenInput",value:function e(t,i,a){var n=this._dataFieldTemplate.replace("#ITERATOR#",i).replace("#DATA_TYPE#",t).replace("#DATA_TYPE_LOWER#",t.toLowerCase());var o=r.Tag.render(s(),n);o.setAttribute("value",a);return o}}]);return e}();babelHelpers.defineProperty(h,"TYPE_BUTTON","button");babelHelpers.defineProperty(h,"TYPE_LINK","link");babelHelpers.defineProperty(h,"TYPE_INPUT","input");var g=function(e){babelHelpers.inherits(t,e);function t(e){var r;babelHelpers.classCallCheck(this,t);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));r._dataFieldTemplate=e.dataFieldTemplate;r._useStoreControl=e.useStoreControl;r._getActualBarcodeQuantityMethod=e.getActualBarcodeQuantityMethod;r._getActualStoreIdByIndexMethod=e.getActualStoreIdByIndexMethod;return r}babelHelpers.createClass(t,[{key:"_getActualBarcodesQuantity",value:function e(){var t=1;if(this._isBarcodeMulti()||this._isSupportedMarkingCode()){t=this._getActualBarcodeQuantityMethod(this._basketId,this._index)}return t}},{key:"_getActualStoreId",value:function e(){return this._getActualStoreIdByIndexMethod(this._basketId,this._index)}},{key:"_onClick",value:function e(){var t=new o({widget:this._createWidget(this._getActualBarcodesQuantity()),productName:this._product.NAME,storeName:this._getStoreName(this._getActualStoreId()),onClose:this._onDialogClose.bind(this),columnsCount:this._getColumnsCount()});t.show()}},{key:"_createWidget",value:function e(t){var r=i.createWidget({items:this._items,rowsCount:t,orderId:this._orderId,basketId:this._basketId,readonly:false,useStoreControl:this._useStoreControl,storeId:this._getActualStoreId(),isBarcodeMulti:this._isBarcodeMulti(),isSupportedMarkingCode:this._isSupportedMarkingCode()});r.onChangeSubscribe(this._onWidgetChanged.bind(this));return r}},{key:"_onWidgetChanged",value:function e(t){var r=t.data;this._getWidgetData(r)}},{key:"_getWidgetData",value:function e(t){var r=this;this._items=[];t.getItemsData().forEach(function(e){r._items.push({id:e.id,barcode:e.barcode.value,markingCode:e.markingCode.value})});this._renderHiddens(this._items)}},{key:"_onDialogClose",value:function e(t){this._getWidgetData(t)}}]);return t}(h);e.ShipmentBasketBarcodeView=h;e.ShipmentBasketBarcodeEdit=g})(this.BX.Sale.Admin.Order=this.BX.Sale.Admin.Order||{},BX.Sale.Barcode,BX);
//# sourceMappingURL=admin_order.bundle.map.js