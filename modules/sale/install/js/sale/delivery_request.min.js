BX.namespace("BX.Sale.Delivery.Request");(function(e){BX.Sale.Delivery.Request={ajaxUrl:"/bitrix/admin/sale_delivery_request_ajax.php",timeout:120,showShipmentContent:function(e,t){var i=new BX.CDialog({title:BX.message("SALE_DELIVERY_REQ_DIALOG_CONTENT")+' "'+t+'"',content_url:this.ajaxUrl,content_post:"requestId="+e+"&shipmentId="+t+"&action=getShipmentContent&lang="+BX.message("LANGUAGE_ID")+"&sessid="+BX.bitrix_sessid(),width:500,height:550});var n=[{title:BX.message("SALE_DELIVERY_REQ_DIALOG_CLOSE"),id:"close",name:"close",action:function(){this.parentWindow.Close()}}];i.ClearButtons();i.SetButtons(n);i.Show()},processRequest:function(t,i){ShowWaitWindow();var n=t;n["sessid"]=BX.bitrix_sessid();n["lang"]=BX.message("LANGUAGE_ID");BX.ajax({timeout:this.timeout,method:"POST",dataType:"json",url:this.ajaxUrl,data:n,onsuccess:function(t){CloseWaitWindow();if(t){if(t.RESULT!="ERROR"){if(t.FILE_NAME&&t.FILE_PATH){e.location.href=BX.Sale.Delivery.Request.ajaxUrl+"?action=downloadFile&fileName="+encodeURI(t.FILE_NAME)+"&filePath="+encodeURI(t.FILE_PATH)+"&sessid="+BX.bitrix_sessid()}else if(t.DAILOG_PARAMS){BX.Sale.Delivery.Request.showRequestDialog(t.DAILOG_PARAMS,i)}}else{var n=BX.message("SALE_DELIVERY_REQ_ERROR")+"\n";if(t.ERRORS)for(var s in t.ERRORS)if(t.ERRORS.hasOwnProperty(s))n+=t.ERRORS[s]+"\n";alert(n)}if(t.WARNINGS&&t.WARNINGS.length>0){n+="\n"+BX.message("SALE_DELIVERY_REQ_WARNING")+"\n";for(s in t.WARNINGS)if(t.WARNINGS.hasOwnProperty(s))n+=t.WARNINGS[s]+"\n"}if(t.MESSAGES&&t.MESSAGES.length>0)for(s in t.MESSAGES)if(t.MESSAGES.hasOwnProperty(s))n+=t.MESSAGES[s]+"\n"}else{alert(BX.message("SALE_DELIVERY_REQ_ERROR_RECEIVING"))}},onfailure:function(){CloseWaitWindow();alert(BX.message("SALE_DELIVERY_REQ_ERROR_PROCESSING"))}})},showRequestDialog:function(t,i){var n=new BX.CDialog({title:t.TITLE,content:'<form id="dailogContentForm">'+t.CONTENT+"</form>",width:500,height:550});var s=[{title:BX.message("SALE_DELIVERY_REQ_DIALOG_CLOSE"),id:"close",name:"close",action:function(){if(i)e.location.reload(true);this.parentWindow.Close()}}];if(t.IS_FINAL!=true){s.push({title:BX.message("SALE_DELIVERY_REQ_DIALOG_NEXT"),id:"next",name:"next",action:function(){var e=BX("dailogContentForm"),t={},n=/\[\]$/g;for(var s=0,o=e.elements.length;s<o;s++){var a=e.elements[s].name;if(a.search(n)==-1){t[a]=e.elements[s].value}else{a=a.replace(n,"");if(typeof t[a]=="undefined")t[a]=[];t[a].push(e.elements[s].value)}}BX.Sale.Delivery.Request.processRequest(t,i);this.parentWindow.Close()}})}BX.addCustomEvent(n,"onWindowClose",function(e){e.DIV.parentNode.removeChild(e.DIV);BX.proxy(function(){this.Register()},this)});n.ClearButtons();n.SetButtons(s);n.Show();n.adjustSizeEx()}}})(window);