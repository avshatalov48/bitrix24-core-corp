BX.namespace("BX.Sale.PaymentApplePay");(function(){"use strict";BX.Sale.PaymentApplePay={STATUS_SUCCESS:"success",STATUS_FAILURE:"fail",init:function(e){this.ajaxUrl=e.ajaxUrl;this.salePaySystemWrapperNode=BX(e.salePaySystemWrapperId);this.paymentButtonNode=BX(e.paymentButtonId);this.paymentButtonWrapperNode=BX(e.paymentButtonWrapperId);this.params=e.params;this.message=e.message;if(this.isApplePayAvailable()){this.showApplePayButton();this.initApplePayPayment()}else{this.showNotAvailableMessage()}},bindEvents:function(){BX.bind(this.paymentButtonNode,"click",BX.proxy(this.makePayment,this))},createPaymentRequest:function(){var e=[{supportedMethods:[this.params.SUPPORTED_METHOD],data:{version:3,merchantIdentifier:this.params.MERCHANT_ID,merchantCapabilities:this.params.MERCHANT_CAPABILITIES,supportedNetworks:["amex","discover","masterCard","visa"],countryCode:this.params.COUNTRY_CODE,currencyCode:this.params.CURRENCY}}];var a={total:{label:this.params.DISPLAY_NAME,amount:{value:this.params.TOTAL_SUM,currency:this.params.CURRENCY}},displayItems:[{label:this.message.ORDER_TITLE+" "+this.params.ORDER_ID,amount:{value:this.params.TOTAL_SUM,currency:this.params.CURRENCY}}]};var t={requestPayerName:false,requestPayerEmail:false,requestPayerPhone:false,requestShipping:false};return new PaymentRequest(e,a,t)},isApplePayAvailable:function(){return!!(window.PaymentRequest&&window.ApplePaySession&&ApplePaySession.canMakePayments())},initApplePayPayment:function(){var e;if(!window.PaymentRequest)return;e=this.createPaymentRequest();e.canMakePayment().then(function(e){if(e||this.isApplePayAvailable()){this.bindEvents()}}.bind(this)).catch(function(){this.showNotAvailableMessage()}.bind(this))},showApplePayButton:function(){this.paymentButtonNode.style.display="inline-block"},showNotAvailableMessage:function(){var e=document.createElement("div");e.innerHTML=this.message.PAY_SYSTEM_NOT_AVAILABLE;e.classList.add("alert");e.classList.add("alert-danger");this.paymentButtonWrapperNode.appendChild(e)},makePayment:function(){var e=this.createPaymentRequest();e.onmerchantvalidation=function(e){var a=this.fetchPaymentSession(e.validationURL);e.complete(a)}.bind(this);try{e.show().then(function(e){this.processPayment(e)}.bind(this))}catch(e){alert(this.message.ERROR_MESSAGE)}},fetchPaymentSession:function(e){var a={PAYMENT_ID:this.params.PAYMENT_ID,PAYSYSTEM_ID:this.params.PAYSYSTEM_ID,action:this.params.GET_SESSION_ACTION,url:e,merchantIdentifier:this.params.MERCHANT_ID,displayName:this.params.DISPLAY_NAME,initiativeContext:this.params.DOMAIN_NAME};return this.send(a)},processPayment:function(e){var a={PAYMENT_ID:this.params.PAYMENT_ID,PAYSYSTEM_ID:this.params.PAYSYSTEM_ID,action:this.params.MAKE_PAYMENT_ACTION,paymentData:JSON.stringify(e.details.token.paymentData)};this.send(a).then(function(){e.complete(this.STATUS_SUCCESS);this.showSuccessfulTemplate()}.bind(this)).catch(function(a){e.complete(this.STATUS_FAILURE);this.showErrorTemplate(a.message)}.bind(this))},send:function(e){return new Promise(function(a,t){BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:e,onsuccess:BX.proxy(function(e){if(e.status==="success"){a(e.data)}else if(e.status==="error"){t(new Error(e.errors.join("<br>")))}}),onfailure:BX.proxy(function(){t(new Error(this.message.ERROR_MESSAGE))})})}.bind(this))},showSuccessfulTemplate:function(){var e=document.createElement("div");e.innerHTML=this.message.PAYMENT_APPROVED;e.innerHTML=e.innerHTML+"<br>";e.innerHTML=e.innerHTML+this.message.PAID_MESSAGE;e.classList.add("alert");e.classList.add("alert-success");this.salePaySystemWrapperNode.innerHTML="";this.salePaySystemWrapperNode.appendChild(e)},showErrorTemplate:function(e){var a=document.createElement("div");a.innerHTML=e;a.classList.add("alert");a.classList.add("alert-danger");this.salePaySystemWrapperNode.innerHTML="";this.salePaySystemWrapperNode.appendChild(a)}}})();
//# sourceMappingURL=applepay.map.js