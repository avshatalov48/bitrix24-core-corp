this.BX=this.BX||{};this.BX.Sale=this.BX.Sale||{};(function(t,e,n,r){"use strict";function i(t,e){var n;if(typeof Symbol==="undefined"||t[Symbol.iterator]==null){if(Array.isArray(t)||(n=a(t))||e&&t&&typeof t.length==="number"){if(n)t=n;var r=0;var i=function t(){};return{s:i,n:function e(){if(r>=t.length)return{done:true};return{done:false,value:t[r++]}},e:function t(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,o=false,l;return{s:function e(){n=t[Symbol.iterator]()},n:function t(){var e=n.next();s=e.done;return e},e:function t(e){o=true;l=e},f:function t(){try{if(!s&&n.return!=null)n.return()}finally{if(o)throw l}}}}function a(t,e){if(!t)return;if(typeof t==="string")return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(t,e)}function s(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,r=new Array(e);n<e;n++){r[n]=t[n]}return r}var o=function(){function t(e){babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"fields",null);babelHelpers.defineProperty(this,"originalFields",null);this.initFields(e)}babelHelpers.createClass(t,[{key:"initFields",value:function t(e){this.fields=new Map(Object.entries(e));this.originalFields=new Map(Object.entries(e))}},{key:"hasField",value:function t(e){return this.fields.has(e)}},{key:"getFields",value:function t(){var e={};var n=i(this.fields),r;try{for(n.s();!(r=n.n()).done;){var a=babelHelpers.slicedToArray(r.value,2),s=a[0],o=a[1];e[s]=o}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"getField",value:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this.fields.has(e)?this.fields.get(e):n}},{key:"getOriginalField",value:function t(e){return this.originalFields.has(e)?this.originalFields.get(e):null}},{key:"setField",value:function t(e,n){this.fields.set(e,n);return this.getOriginalField(e)===n}}]);return t}();function l(){var t=babelHelpers.taggedTemplateLiteral(["<div></div>"]);l=function e(){return t};return t}var c=function(t){babelHelpers.inherits(e,t);function e(t){var r;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,e);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"form",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"settings",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"cache",new n.Cache.MemoryCache);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"mode",e.EDIT_MODE);r.setEventNamespace("BX.Sale.CheckoutForm.Block");r.form=t;r.settings=i;return r}babelHelpers.createClass(e,[{key:"getForm",value:function t(){return this.form}},{key:"getModel",value:function t(){return this.getForm().getModel()}},{key:"getCache",value:function t(){return this.cache}},{key:"getWrapper",value:function t(){var e=this;return this.getCache().remember("wrapper",function(){var t;if(e.hasSetting("wrapperId")){t=document.getElementById(e.getSetting("wrapperId"));if(!n.Type.isDomNode(t)){throw new Error("Can't find block wrapper with id '".concat(e.getSetting("wrapperId"),"'."))}}else{t=n.Tag.render(l());e.getForm().getContainer().appendChild(t)}return t})}},{key:"hasSetting",value:function t(e){return e in this.settings}},{key:"getSetting",value:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this.settings[e]||n}},{key:"getMode",value:function t(){return this.mode}},{key:"setMode",value:function t(e){this.mode=e}},{key:"getType",value:function t(){return this.getSetting("type")}},{key:"getStage",value:function t(){return this.getSetting("stage",$.INITIAL)}},{key:"isSuccess",value:function t(){return this.getSetting("type")===W.SUCCESS}},{key:"refreshLayout",value:function t(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var i;var a=this.getForm().getStage();var s=this.getStage();if(n.Type.isPlainObject(s)){var o=s.view,l=s.edit,c=s.hide;var u=0;while(u<=a){if(u===c){i=undefined}else if(u===l){i=e.EDIT_MODE}else if(u===o){i=e.VIEW_MODE}u++}}else if(n.Type.isNumber(s)){if(s<=a){i=e.EDIT_MODE}}this.clearLayout();if(i||r){if(i){this.setMode(i)}this.layout()}}},{key:"clearLayout",value:function t(){if(this.getCache().has("wrapper")){var e=this.getWrapper();if(n.Type.isDomNode(e)){n.Event.unbindAll(e);if(this.hasSetting("wrapperId")){n.Dom.clean(e)}else{n.Dom.remove(e)}this.getCache().delete("wrapper")}}}},{key:"layout",value:function t(){throw new Error("Not implemented method.")}}]);return e}(r.EventEmitter);babelHelpers.defineProperty(c,"VIEW_MODE","view");babelHelpers.defineProperty(c,"EDIT_MODE","edit");function u(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checkout-item-price-discount-container d-flex justify-content-between align-items-center">\n\t\t\t\t<span class="checkout-item-price-discount">','</span>\n\t\t\t\t<span class="checkout-item-price-discount-diff">-',"</span>\n\t\t\t</div>\n\t\t"]);u=function e(){return t};return t}function d(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<table>\n\t\t\t\t<tr class="checkout-item-summary">\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class="checkout-summary">\n\t\t\t\t\t\t\t<span>','</span>\n\x3c!--\t\t\t\t\t\t\t<span class="checkout-icon-helper"></span>--\x3e\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class="checkout-item-price-block">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t<span class="checkout-item-price">',"</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t"]);d=function e(){return t};return t}function h(){var t=babelHelpers.taggedTemplateLiteral(['<div class="checkout-item-props">',": ","</div>"]);h=function e(){return t};return t}function p(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checkout-item-price-discount-container d-flex justify-content-between align-items-center">\n\t\t\t\t<span class="checkout-item-price-discount">','</span>\n\t\t\t\t<span class="checkout-item-price-discount-diff">-',"</span>\n\t\t\t</div>\n\t\t"]);p=function e(){return t};return t}function f(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<table>\n\t\t\t\t\t<tr class="checkout-item">\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<div class="checkout-item-info">\n\t\t\t\t\t\t\t\t<div class="checkout-item-image-block">\n\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\tclass="checkout-item-remove-btn" \n\t\t\t\t\t\t\t\t\t\tdata-item-id="','"\n\t\t\t\t\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<svg class="checkout-item-remove-btn-icon"  width="8" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M1.18631 0.79834L0.0958433 1.88881L2.70705 4.50001L0.0957031 7.11136L1.18617 8.20182L3.79752 5.59048L6.40848 8.20145L7.49895 7.11098L4.88798 4.50001L7.49881 1.88918L6.40834 0.798718L3.79752 3.40955L1.18631 0.79834Z" fill="#C4C4C4"/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<img src="','" alt="" class="checkout-item-image">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<div class="checkout-item-name-block">\n\t\t\t\t\t\t\t\t\t<h2 class="checkout-item-name">',"</h2>\n\t\t\t\t\t\t\t\t\t<div>",'</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<div class="checkout-item-quantity-block">\n\t\t\t\t\t\t\t\t\t<div class="checkout-item-quantity-field-container">\n\x3c!--\t\t\t\t\t\t\t\t\t\t<div class="checkout-item-quantity-btn-minus no-select"></div>--\x3e\n\t\t\t\t\t\t\t\t\t\t<div class="checkout-item-quantity-field-block">\n\t\t\t\t\t\t\t\t\t\t<input class="checkout-item-quantity-field" type="text" inputmode="numeric" value="','">\n\t\t\t\t\t\t\t\t\t\t</div>\n\x3c!--\t\t\t\t\t\t\t\t\t\t<div class="checkout-item-quantity-btn-plus no-select"></div>--\x3e\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<span class="checkout-item-quantity-description">\n\t\t\t\t\t\t\t\t\t\t<span class="checkout-item-quantity-description-text">','</span>\n\t\t\t\t\t\t\t\t\t\t<span class="checkout-item-quantity-description-price"></span>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<div class="checkout-item-price-block">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t<span class="checkout-item-price">',"</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t"]);f=function e(){return t};return t}var v=function(t){babelHelpers.inherits(e,t);function e(t){var n;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t,r));n.deleteItemHandler=n.delete.bind(babelHelpers.assertThisInitialized(n));return n}babelHelpers.createClass(e,[{key:"delete",value:function t(e){var r=this;var i=e.target;if(!n.Type.isDomNode(i)){return}var a=i.getAttribute("data-item-id");n.ajax.runAction("sale.entity.deletebasketitem",{data:{id:a}}).then(function(t){var e=r.getForm().getParameter("currentPage");if(n.Type.isStringFilled(e)){document.location.href=e}})}},{key:"layout",value:function t(){this.getWrapper().appendChild(n.Dom.create("table",{attrs:{className:"checkout-item-list"},children:[].concat(babelHelpers.toConsumableArray(this.getProducts()),[this.getTotalNode()])}))}},{key:"getBasketItems",value:function t(){return this.getForm().getSchemeField("basketItems",[])}},{key:"getBasketPositionsCount",value:function t(){return this.getBasketItems().length}},{key:"getProducts",value:function t(){var e=this;var r=[];this.getBasketItems().forEach(function(t){var i=e.getItemDiscountNode(t);var a=e.getItemPropsNode(t);var s=t.catalogProduct.frontImage?t.catalogProduct.frontImage.src:"";var o=n.Tag.render(f(),t.id,e.deleteItemHandler,s,n.Text.encode(t.name),a,t.quantity,n.Text.encode(t.measureText),i,t.sum);r.push(e.getFirstRowFromTable(o))});return r}},{key:"getItemDiscountNode",value:function t(e){if(e.sumDiscountDiff===0){return""}return n.Tag.render(p(),e.sumBaseFormated,e.sumDiscountDiffFormated)}},{key:"getItemPropsNode",value:function t(e){if(e.props===0){return""}var r={};var i=[];e.props.forEach(function(t){r[t]={name:t.name,value:t.value};var e=n.Tag.render(h(),r[t].name,r[t].value);i.push(e)});return i}},{key:"getTotalData",value:function t(){return this.getForm().getSchemeField("orderPriceTotal",{})}},{key:"getTotalNode",value:function t(){var e=this.getTotalData();var r=this.getTotalDiscountNode(e);var i=n.Tag.render(d(),n.Loc.getMessage("SALE_BLOCKS_BASKET_ITEMS"),r,e.orderPriceFormated);return this.getFirstRowFromTable(i)}},{key:"getTotalDiscountNode",value:function t(e){if(e.basketPriceDiscountDiffValue===0){return""}return n.Tag.render(u(),e.priceWithoutDiscount,e.basketPriceDiscountDiff)}},{key:"getFirstRowFromTable",value:function t(e){return e.rows[0]}}]);return e}(c);function m(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<table>\n\t\t\t\t<tr class="checkout-summary-item checkout-summary-item-total">\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class="checkout-summary">\n\t\t\t\t\t\t\t<span>','</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class="checkout-item-price-block">\n\x3c!--\t\t\t\t\t\t\t<span class="checkout-item-price">','</span>--\x3e\n\t\t\t\t\t\t\t<span class="checkout-item-price">',"</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t"]);m=function e(){return t};return t}function g(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<table>\n\t\t\t\t<tr class="checkout-summary-item">\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class="checkout-summary">\n\t\t\t\t\t\t\t<span>','</span>\n\t\t\t\t\t\t\t<span class="checkout-icon-helper"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class="checkout-item-price-block">\n\t\t\t\t\t\t\t<span class="checkout-item-price">$13.99</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t']);g=function e(){return t};return t}function b(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<table>\n\t\t\t\t<tr class="checkout-summary-item">\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class="checkout-summary">\n\t\t\t\t\t\t\t<span>','</span>\n\x3c!--\t\t\t\t\t\t\t<span class="checkout-icon-helper"></span>--\x3e\n\t\t\t\t\t\t\t<div class="checkout-summary-item-description">','</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class="checkout-item-price-block">\n\t\t\t\t\t\t\t<span class="checkout-item-price">$10.55</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t']);b=function e(){return t};return t}function y(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<table>\n\t\t\t\t<tr class="checkout-summary-item checkout-summary-item-discount">\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class="checkout-summary">\n\t\t\t\t\t\t\t<span>','</span>\n\x3c!--\t\t\t\t\t\t\t<span class="checkout-icon-helper"></span>--\x3e\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class="checkout-item-price-block">\n\t\t\t\t\t\t\t<span class="checkout-summary-item-price-discount">-',"</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t"]);y=function e(){return t};return t}function k(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<table>\n\t\t\t\t<tr class="checkout-summary-item checkout-summary-item-subtotal">\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class="checkout-summary">\n\t\t\t\t\t\t\t<span>','</span>\n\x3c!--\t\t\t\t\t\t\t<span class="checkout-icon-helper"></span>--\x3e\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class="checkout-item-price-block">\n\t\t\t\t\t\t\t<span class="checkout-item-price">',"</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t"]);k=function e(){return t};return t}var S=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"layout",value:function t(){var e=this.getForm().getSchemeField("orderPriceTotal");this.getWrapper().appendChild(n.Dom.create("table",{attrs:{className:"checkout-summary-list"},children:[this.getBasketTotalNode(e),this.getDiscountNode(e),this.getShippingNode(e),this.getTaxesNode(e),this.getSummaryNode(e)]}))}},{key:"getBasketPositionsCount",value:function t(){return this.getForm().getSchemeField("basketItems",[]).length}},{key:"getBasketTotalNode",value:function t(e){return this.getFirstRowFromTable(n.Tag.render(k(),n.Loc.getMessage("SALE_BLOCKS_TOTAL_ITEMS"),e.priceWithoutDiscount))}},{key:"getDiscountNode",value:function t(e){if(e.discountPrice===0){return""}return this.getFirstRowFromTable(n.Tag.render(y(),n.Loc.getMessage("SALE_BLOCKS_TOTAL_DISCOUNT"),e.discountPriceFormated))}},{key:"getShippingNode",value:function t(e){{return""}return this.getFirstRowFromTable(n.Tag.render(b(),n.Loc.getMessage("SALE_BLOCKS_TOTAL_NAME"),n.Loc.getMessage("SALE_BLOCKS_TOTAL_DESCRIPTION")))}},{key:"getTaxesNode",value:function t(e){{return""}return this.getFirstRowFromTable(n.Tag.render(g(),n.Loc.getMessage("SALE_BLOCKS_TOTAL_TAXES")))}},{key:"getSummaryNode",value:function t(e){return this.getFirstRowFromTable(n.Tag.render(m(),n.Loc.getMessage("SALE_BLOCKS_TOTAL_TOTAL"),e.orderTotalPriceFormated,e.orderPriceFormated))}},{key:"getFirstRowFromTable",value:function t(e){return e.rows[0]}}]);return e}(c);var C=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"layout",value:function t(){this.getWrapper();this.clearLayout()}}]);return e}(c);function T(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checkout-checkout-method-list">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);T=function e(){return t};return t}function E(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="checkout-checkout-method">\n\t\t\t\t\t<div class="checkout-checkout-method-image-block">\n\t\t\t\t\t\t<img src="','" alt="" class="checkout-checkout-method-img">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="checkout-checkout-method-name-block">\n\t\t\t\t\t\t<div class="checkout-checkout-method-name">','</div>\n\t\t\t\t\t\t<div class="checkout-checkout-method-description">','</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="checkout-checkout-method-btn-block">\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\tclass="btn btn-primary checkout-checkout-btn btn-sm rounded-pill"\n\t\t\t\t\t\t\tdata-paysystem-id="','"\n\t\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t>Checkout</button>\n\x3c!--\t\t\t\t\t\t<button class="checkout-checkout-btn checkout-checkout-btn-selected btn btn-sm rounded-pill">Selected</button>--\x3e\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t']);E=function e(){return t};return t}var L=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"refreshLayout",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var r;var i=this.getForm().getStage();var a=this.getStage();if(n.Type.isPlainObject(a)){var s=a.view,o=a.edit,l=a.hide;var u=0;while(u<=i){if(u===l){r=undefined}else if(u===o){r=c.EDIT_MODE}else if(u===s){r=c.VIEW_MODE}u++}}else if(n.Type.isNumber(a)){if(a<=i){r=c.EDIT_MODE}}this.clearLayout();if(r||e){if(r){this.setMode(r)}this.layout()}}},{key:"layout",value:function t(){var e=this.getForm().getSchemeField("hash");var r=this.getForm().getParameter("paySystemReturnUrl");var i=this.getForm().getField("payments");var a=0;Object.keys(i).forEach(function(t){a=t;return false});n.ajax.runAction("sale.entity.paymentpay",{data:{fields:{paymentId:a,accessCode:e,returnUrl:r}}}).then(this.getPaySystemsList.bind(this))}},{key:"getPaySystemsList",value:function t(e){var n=this;var r=this.getWrapper();if(BX.type.isPlainObject(e.data)&&BX.type.isNotEmptyString(e.data.html)){BX.html(r,e.data.html);BX.addCustomEvent("onChangePaySystems",function(){n.getForm().refreshLayout()})}}},{key:"getPaySystems",value:function t(){return this.getForm().getSchemeField("paySystems",[])}},{key:"getPaySystemNodes",value:function t(){var e=this;var r=[];this.getPaySystems().forEach(function(t){r.push(n.Tag.render(E(),t.logotipSrc,n.Text.encode(t.name),n.Text.encode(t.description),t.id,e.handleCheckoutClick.bind(e)))});return n.Tag.render(T(),r)}},{key:"handleCheckoutClick",value:function t(e){var r=n.Text.toNumber(e.target.getAttribute("data-paysystem-id"));this.getForm().setFieldNoDemand("paySystemId",r);e.target.setAttribute("disabled","disabled");n.Dom.addClass(e.target,"checkout-checkout-btn-selected");e.target.innerHTML='<span class="spinner-border spinner-border-sm mr-2"></span>'+e.target.innerHTML;var i=this.getForm().getField("payments");var a=0;Object.keys(i).forEach(function(t){a=t;return false});n.ajax.runAction("sale.entity.paymentpay",{data:{fields:{ID:a}}}).then(function(t){if(BX.type.isPlainObject(t.data)&&BX.type.isNotEmptyString(t.data.html)){BX.html(e.target,t.data.html)}})}}]);return e}(c);function F(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="checkout-btn-container">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass="btn btn-primary product-item-detail-buy-button btn-md rounded-pill"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t>',"</button>\n\t\t\t\t</div>\n\t\t\t"]);F=function e(){return t};return t}function P(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t \t<label class="checkout-agreement-container">\n\t\t \t\t<div class="checkout-agreement-block">\n\t\t \t\t\t<input type="checkbox" class="checkout-agreement-input" checked="checked">\n\t\t \t\t</div>\n\t\t \t\t<div class="checkout-agreement-block">\n\t\t \t\t\t<div class="checkout-agreement-text">',"</div>\n\t\t \t\t</div>\n\t\t \t</label>\n\t\t "]);P=function e(){return t};return t}function H(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t</div>\n\t\t\t\t\t"]);H=function e(){return t};return t}function O(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t</div>\n\t\t\t\t\t"]);O=function e(){return t};return t}var w=function(t){babelHelpers.inherits(e,t);function e(t){var r;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,e);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t,i));r.saveOrderHandler=r.saveOrder.bind(babelHelpers.assertThisInitialized(r));var a=r.getForm().getParameter("userConsentPropertyData");r.userConsent={id:1,title:n.Loc.getMessage("SALE_BLOCKS_PLACE_ORDER_NOW"),isLoaded:"Y",autoSave:"Y",isChecked:"Y",submitEventName:"onUserConsent",fields:n.Type.isArrayFilled(a)?JSON.stringify(a):[]};r.isAllowedSubmitting=r.userConsent.isChecked==="Y";return r}babelHelpers.createClass(e,[{key:"layout_",value:function t(){this.getWrapper().appendChild(n.Tag.render(O(),this.getConsent(),this.getSaveButton()))}},{key:"layout",value:function t(){var e=this;var r=this.getWrapper();n.ajax.runAction("sale.entity.userconsentrequest",{data:{fields:this.userConsent}}).then(function(t){if(BX.type.isPlainObject(t.data)&&BX.type.isNotEmptyString(t.data.html)){var i=t.data.html;r.appendChild(n.Tag.render(H(),i,e.getSaveButton()));if(BX.UserConsent!==undefined){var a=BX.UserConsent.load(r);BX.addCustomEvent(a,BX.UserConsent.events.accepted,function(){return e.isAllowedSubmitting=true});BX.addCustomEvent(a,BX.UserConsent.events.refused,function(){return e.isAllowedSubmitting=false})}}})}},{key:"getConsent",value:function t(){return n.Tag.render(P(),n.Loc.getMessage("SALE_BLOCKS_PLACE_ORDER_TEXT"))}},{key:"getSaveButton",value:function t(){var e=this;return this.getCache().remember("save-button",function(){return n.Tag.render(F(),e.saveOrderHandler,n.Loc.getMessage("SALE_BLOCKS_PLACE_ORDER_NOW"))})}},{key:"saveOrder",value:function t(){BX.onCustomEvent(this.userConsent.submitEventName,[]);if(this.isAllowedSubmitting){this.getSaveButton().disabled=true;this.getForm().requestSave()}}}]);return e}(c);function I(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<input \n\t\t\t\t\t\ttype="','"\n\t\t\t\t\t\tclass="form-control form-control-lg"\n\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\tdata-property-id="','"\n\t\t\t\t\t\tonchange="','"\n\t\t\t\t\t\tonfocusout="','">\n\t\t\t']);I=function e(){return t};return t}function _(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checkout-form-container">\n\t\t\t\t<div class="checkout-form-header">\n\t\t\t\t\t<div class="checkout-form-title">','</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="checkout-form-block">\n\t\t\t\t\t<form>\n\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);_=function e(){return t};return t}function B(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div style="border-bottom: 1px solid #cecece;">\n\t\t\t\t<tr class="checkout-summary-item">\n\t\t\t\t\t<td colspan="2">\n\t\t\t\t\t\t<div class="checkout-item-personal-order-info">\n\t\t\t\t\t\t\t<div class="checkout-item-personal-order-payment">\n\t\t\t\t\t\t\t\t<strong>',"</strong>\n\t\t\t\t\t\t\t\t<div>",'</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="checkout-item-personal-order-shipping">\n\t\t\t\t\t\t\t\t<strong>',"</strong>\n\t\t\t\t\t\t\t\t<div>","</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</div>\n\t\t"]);B=function e(){return t};return t}var R=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"layout",value:function t(){this.getWrapper().appendChild(this.getMode()===c.VIEW_MODE?this.getViewLayout():this.getEditLayout())}},{key:"getPropertiesShort",value:function t(){var e=this.getForm().getField("properties");var r=[];for(var i in e){if(e.hasOwnProperty(i)&&n.Type.isStringFilled(e[i])){r.push(e[i])}}return r.join(", ")}},{key:"getViewLayout",value:function t(){var e=this.getForm().getSchemeField("accountNumber");var r=this.getPropertiesShort();return n.Tag.render(B(),n.Loc.getMessage("SALE_BLOCKS_PROPERTIES_ORDER_TITLE").replace("#ORDER_NUMBER#",e),r,n.Loc.getMessage("SALE_BLOCKS_PROPERTIES_SHIPPING_METHOD"),n.Loc.getMessage("SALE_BLOCKS_PROPERTIES_SHIPPING_METHOD_DESCRIPTION"))}},{key:"getEditLayout",value:function t(){return n.Tag.render(_(),n.Loc.getMessage("SALE_BLOCKS_PROPERTIES_TITLE"),this.getProperties())}},{key:"getProperties",value:function t(){var e=this;var r=[];this.getForm().getSchemeField("properties",[]).forEach(function(t){if(t.type==="STRING"){var i=e.getForm().getField("properties",{})[t.id]||"";var a=t.isPhone==="Y"?"tel":"text";var s=n.Tag.render(I(),a,n.Text.encode(t.name),n.Text.encode(i),t.id,e.onChangeHandler.bind(e),e.onFocusOutHandler.bind(e));BX.addCustomEvent("BX.Sale.Checkout.Property.Error:onSave_"+t.id,function(){n.Dom.addClass(s,"border-danger");n.Dom.removeClass(s,"border-success")});r.push(s)}});return r}},{key:"onChangeHandler",value:function t(e){var r=e.target;if(!n.Type.isDomNode(r)){return}var i=r.getAttribute("data-property-id");var a=this.getForm().getField("properties");a[i]=r.value;this.getForm().setFieldNoDemand("properties",a)}},{key:"onFocusOutHandler",value:function t(e){var r=e.target;if(!n.Type.isDomNode(r)){return}if(n.Type.isStringFilled(r.value)){n.Dom.addClass(r,"border-success");n.Dom.removeClass(r,"border-danger")}else{n.Dom.addClass(r,"border-danger");n.Dom.removeClass(r,"border-success")}}}]);return e}(c);function A(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checkout-order-status-btn-container">\n\t\t\t\t<button\n\t\t\t\t\tclass="btn btn-checkout-order-status btn-md rounded-pill"\n\t\t\t\t\tonclick="','"\n\t\t\t\t>',"</button>\n\t\t\t</div>\n\t\t"]);A=function e(){return t};return t}function D(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checkout-order-status-btn-container">\n\t\t\t\t<button\n\t\t\t\t\tclass="btn btn-checkout-order-status btn-md rounded-pill"\n\t\t\t\t\tonclick="','"\n\t\t\t\t>',"</button>\n\t\t\t</div>\n\t\t"]);D=function e(){return t};return t}function M(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checkout-order-section-separator">',"</div>\n\t\t"]);M=function e(){return t};return t}function N(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checkout-order-common-container">\n\t\t\t\t<div class="checkout-order-common-row">\n\t\t\t\t\t<svg class="checkout-order-common-row-icon" width="26" height="27" viewBox="0 0 26 27" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M12.9124 26.6569C20.0093 26.6569 25.7624 20.9038 25.7624 13.807C25.7624 6.71014 20.0093 0.957031 12.9124 0.957031C5.81561 0.957031 0.0625 6.71014 0.0625 13.807C0.0625 20.9038 5.81561 26.6569 12.9124 26.6569Z" fill="white"/>\n\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M10.8218 19.498L5.72461 14.5304L7.50861 12.7918L10.8218 16.0207L18.3182 8.71484L20.1022 10.4535L10.8218 19.498Z" fill="#65A90F"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<div>','</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="checkout-order-common-row">\n\t\t\t\t\t<div>',"</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);N=function e(){return t};return t}function x(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checkout-order-common-container">\n\t\t\t\t<div class="checkout-order-common-row">\n\t\t\t\t\t<svg class="checkout-order-common-row-icon" width="26" height="27" viewBox="0 0 26 27" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M12.9124 26.6569C20.0093 26.6569 25.7624 20.9038 25.7624 13.807C25.7624 6.71014 20.0093 0.957031 12.9124 0.957031C5.81561 0.957031 0.0625 6.71014 0.0625 13.807C0.0625 20.9038 5.81561 26.6569 12.9124 26.6569Z" fill="white"/>\n\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M10.8218 19.498L5.72461 14.5304L7.50861 12.7918L10.8218 16.0207L18.3182 8.71484L20.1022 10.4535L10.8218 19.498Z" fill="#65A90F"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<div>',"</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);x=function e(){return t};return t}function X(){var t=babelHelpers.taggedTemplateLiteral(['\t\t\t\n\t\t\t<div class="checkout-order-status-text">\n\t\t\t\t<strong>'," #","</strong>\n\t\t\t</div>\n\t\t"]);X=function e(){return t};return t}function U(){var t=babelHelpers.taggedTemplateLiteral(['\t\t\t\n\t\t\t<div class="checkout-order-status-text">\n\t\t\t\t<strong>'," #","</strong> ","\n\t\t\t</div>\n\t\t"]);U=function e(){return t};return t}function K(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checkout-order-status-successful">\n\t\t\t\t<svg class="checkout-order-status-icon" width="105" height="106" viewBox="0 0 105 106" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path opacity="0.6" stroke="#fff" stroke-width="3" fill-rule="evenodd" clip-rule="evenodd" d="M52.5 104C80.6665 104 103.5 81.1665 103.5 53C103.5 24.8335 80.6665 2 52.5 2C24.3335 2 1.5 24.8335 1.5 53C1.5 81.1665 24.3335 104 52.5 104Z"/>\n\t\t\t\t\t<path fill="#fff" fill-rule="evenodd" clip-rule="evenodd" d="M45.517 72L28.5 55.4156L34.4559 49.611L45.517 60.3909L70.5441 36L76.5 41.8046L45.517 72Z"/>\n\t\t\t\t</svg>\t\t\t\t\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);K=function e(){return t};return t}var j=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"layout",value:function t(){this.getWrapper().appendChild(n.Tag.render(K(),this.showBeforePayment(),this.showAfterPayment()));n.Dom.addClass(document.body,"container-overflow-hidden")}},{key:"clearLayout",value:function t(){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"clearLayout",this).call(this);n.Dom.removeClass(document.body,"container-overflow-hidden")}},{key:"showOrderStatus",value:function t(){var e=this.getForm().getSchemeField("ACCOUNT_NUMBER");return n.Tag.render(U(),n.Loc.getMessage("SALE_BLOCKS_SUCCESS_ORDER"),n.Text.encode(e),n.Loc.getMessage("SALE_BLOCKS_SUCCESS_ORDER_CREATED"))}},{key:"showPaymentStatus",value:function t(){var e=this.getForm().getSchemeField("ACCOUNT_NUMBER");return n.Tag.render(X(),n.Loc.getMessage("SALE_BLOCKS_SUCCESS_ORDER"),n.Text.encode(e))}},{key:"showManagerWillCall",value:function t(){return n.Tag.render(x(),n.Loc.getMessage("SALE_BLOCKS_SUCCESS_CALL"))}},{key:"showPaymentSum",value:function t(){var e=this.getForm().getSchemeField("ORDER_PRICE_TOTAL");return n.Tag.render(N(),n.Loc.getMessage("SALE_BLOCKS_SUCCESS_TO_PAID").replace("#PAID#",e.orderTotalPriceFormated),n.Loc.getMessage("SALE_BLOCKS_SUCCESS_DELIVERY"))}},{key:"showSeparator",value:function t(){return n.Tag.render(M(),n.Loc.getMessage("SALE_BLOCKS_SUCCESS_OR"))}},{key:"showContinueProcessing",value:function t(){return n.Tag.render(D(),this.onContinueProcessingHandler.bind(this),n.Loc.getMessage("SALE_BLOCKS_SUCCESS_CHECKOUT"))}},{key:"onContinueProcessingHandler",value:function t(e){var n=this.getForm().parameters["paySystemReturnUrl"];n=this.addLinkParam(n,"orderId",this.getForm().getSchemeField("orderId"));n=this.addLinkParam(n,"access",this.getForm().getSchemeField("hash"));this.getForm().parameters["paySystemReturnUrl"]=n;this.getForm().refreshLayout();delete BX.UserConsent;this.pushState({orderId:this.getForm().getSchemeField("orderId"),access:this.getForm().getSchemeField("hash")})}},{key:"getCurrentUrl",value:function t(){return window.location.protocol+"//"+window.location.hostname+(window.location.port!=""?":"+window.location.port:"")+window.location.pathname+window.location.search}},{key:"addLinkParam",value:function t(e,n,r){if(!e.length){return"?"+n+"="+r}e=BX.Uri.removeParam(e,n);if(e.indexOf("?")!=-1){return e+"&"+n+"="+r}return e+"?"+n+"="+r}},{key:"pushState",value:function t(e){var n="";n=this.getCurrentUrl();n=this.addLinkParam(n,"orderId",e.orderId);n=this.addLinkParam(n,"access",e.access);window.history.pushState(null,null,n)}},{key:"showContinueShopping",value:function t(){return n.Tag.render(A(),this.onContinueShoppingHandler.bind(this),n.Loc.getMessage("SALE_BLOCKS_SUCCESS_CONTINUE"))}},{key:"onContinueShoppingHandler",value:function t(e){e.target.disable=true;var r=this.getForm().getParameter("emptyBasketHintPath");if(n.Type.isStringFilled(r)){document.location.href=r}}},{key:"isContinueProcessingEnabled",value:function t(){return this.getForm().getParameter("showContinueProcessing",false)}},{key:"isPaymentSelected",value:function t(){return this.getForm().getField("paySystemId",0)>0}},{key:"hasPaySystems",value:function t(){return this.getForm().getSchemeField("paySystems",[]).length>0}},{key:"showBeforePayment",value:function t(){if(!this.isContinueProcessingEnabled||this.isPaymentSelected()){return""}if(this.hasPaySystems()){return[this.showOrderStatus(),this.showManagerWillCall(),this.showSeparator(),this.showContinueProcessing()]}else{return[this.showOrderStatus(),this.showManagerWillCall()]}}},{key:"showAfterPayment",value:function t(){if(!this.isPaymentSelected()){return""}return[this.showPaymentStatus(),this.showPaymentSum(),this.showContinueShopping()]}}]);return e}(c);var W=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(W,"BASKET","basket");babelHelpers.defineProperty(W,"LOADER","loader");babelHelpers.defineProperty(W,"PAYMENTS","payments");babelHelpers.defineProperty(W,"PLACE_ORDER","place-order");babelHelpers.defineProperty(W,"PROPERTIES","properties");babelHelpers.defineProperty(W,"SUCCESS","success");babelHelpers.defineProperty(W,"TOTAL","total");var q=[{type:W.BASKET,entity:v},{type:W.LOADER,entity:C},{type:W.PAYMENTS,entity:L},{type:W.PLACE_ORDER,entity:w},{type:W.PROPERTIES,entity:R},{type:W.SUCCESS,entity:j},{type:W.TOTAL,entity:S}];var z=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,null,[{key:"create",value:function t(e,r){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};this.emit("BX.Sale.Checkout.Factory:onBeforeCreateBlock",q);var a=q.find(function(t){return t.type===e})["entity"];if(!a){var s={};this.emit("BX.Sale.Checkout.Factory:onCreate",s);if(s[e]){a=s[e]}}if(n.Type.isFunction(a)){return new a(r,i)}return null}}]);return e}(r.EventEmitter);function V(t,e){var n;if(typeof Symbol==="undefined"||t[Symbol.iterator]==null){if(Array.isArray(t)||(n=Y(t))||e&&t&&typeof t.length==="number"){if(n)t=n;var r=0;var i=function t(){};return{s:i,n:function e(){if(r>=t.length)return{done:true};return{done:false,value:t[r++]}},e:function t(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,s=false,o;return{s:function e(){n=t[Symbol.iterator]()},n:function t(){var e=n.next();a=e.done;return e},e:function t(e){s=true;o=e},f:function t(){try{if(!a&&n.return!=null)n.return()}finally{if(s)throw o}}}}function Y(t,e){if(!t)return;if(typeof t==="string")return Z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Z(t,e)}function Z(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,r=new Array(e);n<e;n++){r[n]=t[n]}return r}var G=function(){function t(e){babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"fields",null);this.initFields(e)}babelHelpers.createClass(t,[{key:"initFields",value:function t(e){this.fields=new Map(Object.entries(e))}},{key:"hasField",value:function t(e){return this.fields.has(e)}},{key:"getFields",value:function t(){var e={};var n=V(this.fields),r;try{for(n.s();!(r=n.n()).done;){var i=babelHelpers.slicedToArray(r.value,2),a=i[0],s=i[1];e[a]=s}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"getField",value:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this.fields.has(e)?this.fields.get(e):n}}]);return t}();var $=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty($,"INITIAL",1);babelHelpers.defineProperty($,"VIEW",2);var J=function(t){babelHelpers.inherits(e,t);function e(t,n){var r;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};babelHelpers.classCallCheck(this,e);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"model",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"scheme",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"parameters",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"stage",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"container",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"blocks",null);r.setEventNamespace("BX.Sale.CheckoutForm");r.model=t;r.scheme=n;r.parameters=i;return r}babelHelpers.createClass(e,[{key:"setStage",value:function t(e){this.stage=e;return this}},{key:"setModel",value:function t(e){this.model.initFields(e)}},{key:"hasField",value:function t(e){return this.model.hasField(e)}},{key:"getField",value:function t(e,n){return this.model.getField(e,n)}},{key:"setField",value:function t(e,n){var r=this.setFieldNoDemand(e,n);if(r){this.requestRefresh()}return r}},{key:"setFieldNoDemand",value:function t(e,n){return this.model.setField(e,n)}},{key:"setScheme",value:function t(e){for(var n in e){if(e.hasOwnProperty(n)){this.scheme.fields.set(n,e[n])}}}},{key:"getSchemeField",value:function t(e,n){return this.scheme.getField(e,n)}},{key:"getParameter",value:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this.parameters[e]||n}},{key:"getStage",value:function t(){return this.stage}},{key:"getContainer",value:function t(){return this.container}},{key:"setContainer",value:function t(e){if(!n.Type.isDomNode(e)){throw new Error("Wrong target node to render")}var r=this.getContainer();if(n.Type.isDomNode(r)){this.clearContainer(r)}this.container=e}},{key:"clearContainer",value:function t(e){n.Event.unbindAll(e);n.Dom.clean(e)}},{key:"buildBlocks",value:function t(){var e=this;var n=[];this.getParameter("blocks",[]).forEach(function(t){n.push(z.create(t.type,e,t))});return n}},{key:"getBlocks",value:function t(){if(this.blocks===null){this.blocks=this.buildBlocks()}return this.blocks}},{key:"refreshLayout",value:function t(){this.getBlocks().forEach(function(t){t.refreshLayout()})}},{key:"renderTo",value:function t(e){if(n.Type.isString(e)){e=document.getElementById(e)}this.setContainer(e);this.refreshLayout()}},{key:"layoutSuccessBlock",value:function t(){var e=this.getBlocks().find(function(t){return t.isSuccess()});if(e){e.refreshLayout(true)}}},{key:"requestRefresh",value:function t(){n.ajax.runAction("sale.entity.refreshorder",{data:{fields:this.prepareFields()}}).then(this.handleRefreshResponse.bind(this))}},{key:"handleRefreshResponse",value:function t(e){if(e.status==="success"){var n=this.extractModelFields(e.data);this.setModel(n);var r=this.extractSchemeFields(e.data);this.setModel(r);this.refreshLayout()}}},{key:"getPropertyErrorCollection",value:function t(){var e=this.getField("ERROR_COLLECTION",{});return e.hasOwnProperty("PROPERTIES")&&n.Type.isArrayFilled(e.PROPERTIES)?e.PROPERTIES:[]}},{key:"verify",value:function t(){return this.verifyProperty()}},{key:"verifyProperty",value:function t(){var e=[];var r=this.getField("properties");this.getSchemeField("properties",[]).forEach(function(t){if(t.type==="STRING"&&t.required==="Y"){if(n.Type.isStringFilled(r[t.id])===false){e.push({id:t.id,message:""})}}});this.setFieldNoDemand("ERROR_COLLECTION",{PROPERTIES:e});return n.Type.isArrayFilled(e)===false}},{key:"requestSave",value:function t(){var e=this;if(this.verify()){n.ajax.runAction("sale.entity.saveorder",{data:{fields:this.prepareFields()}}).then(this.handleSaveResponse.bind(this),function(t){if(t.status==="error"){e.fillErrorCollection(t.errors);e.getPropertyErrorCollection().forEach(function(t){BX.onCustomEvent("BX.Sale.Checkout.Property.Error:onSave_"+t.id)})}})}else{this.getPropertyErrorCollection().forEach(function(t){BX.onCustomEvent("BX.Sale.Checkout.Property.Error:onSave_"+t.id)})}}},{key:"handleSaveResponse",value:function t(e){if(e.status==="success"){var n=this.extractModelFields(e.data);this.setModel(n);var r=this.extractSchemeFields(e.data);this.setScheme(r);this.layoutSuccessBlock();this.stage++}}},{key:"fillErrorCollection",value:function t(e){var r=[];if(n.Type.isArrayFilled(e)){e.forEach(function(t){if(t.code==="properties"){r.push({id:t.customData.id,message:t.customData.message})}});this.setFieldNoDemand("ERROR_COLLECTION",{PROPERTIES:r})}}},{key:"prepareFields",value:function t(){var e={siteId:this.getSchemeField("siteId"),products:this.getField("basketItems"),properties:this.getField("properties")};var n=this.getSchemeField("userId");if(n){e["userId"]=n}return e}},{key:"extractModelFields",value:function t(e){var n={};e.basketItems.forEach(function(t){n[t.id]={productId:t.productId,quantity:t.quantity,props:t.props}});var r={};e.properties.forEach(function(t){r[t.orderPropsId]=t.value});var i={};e.payments.forEach(function(t){i[t.id]={id:t.id,sum:t.sum}});return{basketItems:n,properties:r,payments:i}}},{key:"extractSchemeFields",value:function t(e){return{siteId:e.lid,userId:e.userId,accountNumber:e.accountNumber,orderId:e.id,paySystems:e.paySystems,hash:e.hash}}}]);return e}(r.EventEmitter);var Q=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(Q,"FORM","form");babelHelpers.defineProperty(Q,"MODEL","model");babelHelpers.defineProperty(Q,"SCHEME","scheme");var tt=[{type:Q.FORM,entity:J},{type:Q.MODEL,entity:o},{type:Q.SCHEME,entity:G}];var et=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,null,[{key:"createForm",value:function t(e,n,r){var i=this.create(Q.MODEL,e);var a=this.create(Q.SCHEME,n);return this.create(Q.FORM,i,a,r)}},{key:"create",value:function t(e){this.emit("BX.Sale.Checkout.Factory:onBeforeCreate",tt);var r=tt.find(function(t){return t.type===e})["entity"];if(!r){var i={};this.emit("BX.Sale.Checkout.Factory:onCreate",i);if(i[e]){r=i[e]}}if(n.Type.isFunction(r)){for(var a=arguments.length,s=new Array(a>1?a-1:0),o=1;o<a;o++){s[o-1]=arguments[o]}return babelHelpers.construct(r,s)}return null}}]);return e}(r.EventEmitter);t.Factory=et;t.EntityType=Q;t.Stage=$})(this.BX.Sale.CheckoutForm=this.BX.Sale.CheckoutForm||{},BX,BX,BX.Event);
//# sourceMappingURL=checkout-form.bundle.map.js