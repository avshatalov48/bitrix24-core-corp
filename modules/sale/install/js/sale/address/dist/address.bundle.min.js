this.BX=this.BX||{};(function(t,e,n,r){"use strict";var i;var a={bind:function t(e,n,r){i=function t(i){i.stopPropagation();var a=n.value,s=a.handler,o=a.exclude;var u=false;o.forEach(function(t){if(!u){var e=r.context.$refs[t];u=e.contains(i.target)}});if(!e.contains(i.target)&&!u){r.context[s]()}};document.addEventListener("click",i);document.addEventListener("touchstart",i)},unbind:function t(){document.removeEventListener("click",i);document.removeEventListener("touchstart",i)}};function s(t){if(typeof Symbol==="undefined"||t[Symbol.iterator]==null){if(Array.isArray(t)||(t=o(t))){var e=0;var n=function t(){};return{s:n,n:function n(){if(e>=t.length)return{done:true};return{done:false,value:t[e++]}},e:function t(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=true,a=false,s;return{s:function e(){r=t[Symbol.iterator]()},n:function t(){var e=r.next();i=e.done;return e},e:function t(e){a=true;s=e},f:function t(){try{if(!i&&r.return!=null)r.return()}finally{if(a)throw s}}}}function o(t,e){if(!t)return;if(typeof t==="string")return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(t,e)}function u(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,r=new Array(e);n<e;n++){r[n]=t[n]}return r}var l=e.Vue.extend({directives:{closable:a},props:{name:{type:String,required:true},initValue:{required:false},onChangeCallback:{type:Function,required:false}},data:function t(){return{id:null,isEditMode:null,value:null,addressWidget:null}},methods:{startOver:function t(){this.addressWidget.address=null;this.changeValue(null);this.closeMap()},changeValue:function t(e){this.$emit("change",e);this.value=e;if(this.onChangeCallback){setTimeout(this.onChangeCallback,0)}},buildAddress:function t(e){try{return new BX.Location.Core.Address(JSON.parse(e))}catch(t){return null}},getMap:function t(){if(!this.addressWidget){return null}var e=s(this.addressWidget.features),n;try{for(e.s();!(n=e.n()).done;){var r=n.value;if(r instanceof BX.Location.Widget.MapFeature){return r}}}catch(t){e.e(t)}finally{e.f()}return null},showMap:function t(){var e=this.getMap();if(e){e.showMap()}},closeMap:function t(){var e=this.getMap();if(e){e.closeMap()}this.isEditMode=false},onInputControlClicked:function t(){if(this.value){this.showMap()}else{this.closeMap()}}},computed:{wrapperClass:function t(){return{"ui-ctl":true,"ui-ctl-w100":true,"ui-ctl-after-icon":true}},addressFormatted:function t(){if(!this.value||!this.addressWidget){return""}var e=this.buildAddress(this.value);if(!e){return""}return e.toString(this.addressWidget.addressFormat,n.AddressStringConverter.STRATEGY_TYPE_FIELD_SORT)}},mounted:function t(){var e=this;if(this.initValue){this.value=this.initValue}var i=new BX.Location.Widget.Factory;this.addressWidget=i.createAddressWidget({address:this.initValue?this.buildAddress(this.initValue):null,mapBehavior:"manual",popupBindOptions:{position:"right"},mode:n.ControlMode.edit,useFeatures:{fields:false,map:true,autocomplete:true}});this.addressWidget.subscribeOnAddressChangedEvent(function(t){var n=t.getData();e.isEditMode=true;var r=n.address;if(!r.latitude||!r.longitude){e.changeValue(null);e.closeMap()}else{e.changeValue(r.toJson());e.showMap()}});this.addressWidget.subscribeOnStateChangedEvent(function(t){var n=t.getData();if(n.state===r.State.DATA_INPUTTING){e.changeValue(null);e.closeMap()}});this.addressWidget.render({inputNode:this.$refs["input-node"],mapBindElement:this.$refs["input-node"],controlWrapper:this.$refs["control-wrapper"]})},template:'\n\t\t<div\n\t\t\tv-closable="{\n\t\t\t  exclude: [\'input-node\'],\n\t\t\t  handler: \'closeMap\'\n\t\t\t}"\n\t\t\tclass="ui-ctl-w100"\n\t\t>\n\t\t\t<div :class="wrapperClass" ref="control-wrapper">\n\t\t\t\t<div\n\t\t\t\t\t@click="startOver"\n\t\t\t\t\tclass="ui-ctl-after ui-ctl-icon-btn ui-ctl-icon-clear"\n\t\t\t\t></div>\n\t\t\t\t<input\n\t\t\t\t\t@click="onInputControlClicked"\n\t\t\t\t\tref="input-node"\n\t\t\t\t\ttype="text"\n\t\t\t\t\tclass="ui-ctl-element ui-ctl-textbox"\n\t\t\t\t\tv-html="addressFormatted"\n\t\t\t\t/>\n\t\t\t\t<input v-model="value" type="hidden" :name="name" />\n\t\t\t</div>\t\t\t\t\n\t\t</div>\n\t'});t.AddressControlConstructor=l})(this.BX.Sale=this.BX.Sale||{},BX,BX.Location.Core,BX.Location.Widget);
//# sourceMappingURL=address.bundle.map.js