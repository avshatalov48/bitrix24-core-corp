{"version":3,"file":"address.bundle.js","sources":["../src/closabledirective.js","../src/address.js"],"sourcesContent":["let handleOutsideClick;\n\nexport const ClosableDirective = {\n\tbind (el, binding, vnode) {\n\t\thandleOutsideClick = (e) => {\n\t\t\te.stopPropagation();\n\t\t\tconst { handler, exclude } = binding.value;\n\t\t\tlet clickedOnExcludedEl = false;\n\t\t\texclude.forEach(refName => {\n\t\t\t\tif (!clickedOnExcludedEl) {\n\t\t\t\t\tconst excludedEl = vnode.context.$refs[refName];\n\t\t\t\t\tclickedOnExcludedEl = excludedEl.contains(e.target);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (!el.contains(e.target) && !clickedOnExcludedEl) {\n\t\t\t\tvnode.context[handler]()\n\t\t\t}\n\t\t};\n\t\tdocument.addEventListener('click', handleOutsideClick);\n\t\tdocument.addEventListener('touchstart', handleOutsideClick);\n\t},\n\n\tunbind () {\n\t\tdocument.removeEventListener('click', handleOutsideClick);\n\t\tdocument.removeEventListener('touchstart', handleOutsideClick);\n\t}\n};\n","import {Vue} from 'ui.vue';\nimport {ControlMode, AddressStringConverter} from 'location.core';\nimport {Factory, State} from 'location.widget';\nimport {ClosableDirective} from './closabledirective';\nimport './css/address.css';\n\nexport const AddressControlConstructor = Vue.extend({\n\tdirectives: {\n\t\tclosable: ClosableDirective\n\t},\n\tprops: {\n\t\tname: {type: String, required: true},\n\t\tinitValue: {required: false},\n\t\tonChangeCallback: {type: Function, required: false}\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tid: null,\n\t\t\tisEditMode: null,\n\t\t\tvalue: null,\n\t\t\taddressWidget: null,\n\t\t}\n\t},\n\tmethods: {\n\t\tstartOver()\n\t\t{\n\t\t\tthis.addressWidget.address = null;\n\t\t\tthis.changeValue(null);\n\t\t\tthis.closeMap();\n\t\t},\n\t\tchangeValue(newValue)\n\t\t{\n\t\t\tthis.$emit('change', newValue);\n\t\t\tthis.value = newValue;\n\n\t\t\tif (this.onChangeCallback)\n\t\t\t{\n\t\t\t\tsetTimeout(this.onChangeCallback, 0);\n\t\t\t}\n\t\t},\n\t\tbuildAddress(value)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\treturn new BX.Location.Core.Address(JSON.parse(value));\n\t\t\t}\n\t\t\tcatch(e)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tgetMap()\n\t\t{\n\t\t\tif (!this.addressWidget)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tfor( let feature of this.addressWidget.features)\n\t\t\t{\n\t\t\t\tif(feature instanceof BX.Location.Widget.MapFeature)\n\t\t\t\t{\n\t\t\t\t\treturn feature;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t\tshowMap()\n\t\t{\n\t\t\tlet map = this.getMap();\n\n\t\t\tif (map)\n\t\t\t{\n\t\t\t\tmap.showMap();\n\t\t\t}\n\t\t},\n\t\tcloseMap()\n\t\t{\n\t\t\tlet map = this.getMap();\n\n\t\t\tif (map)\n\t\t\t{\n\t\t\t\tmap.closeMap();\n\t\t\t}\n\n\t\t\tthis.isEditMode = false;\n\t\t},\n\t\tonInputControlClicked()\n\t\t{\n\t\t\tif (this.value)\n\t\t\t{\n\t\t\t\tthis.showMap();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.closeMap();\n\t\t\t}\n\t\t}\n\t},\n\tcomputed: {\n\t\twrapperClass()\n\t\t{\n\t\t\treturn {\n\t\t\t\t'ui-ctl': true,\n\t\t\t\t'ui-ctl-w100': true,\n\t\t\t\t'ui-ctl-after-icon': true,\n\t\t\t}\n\t\t},\n\t\taddressFormatted()\n\t\t{\n\t\t\tif(!this.value || !this.addressWidget)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\tlet address = this.buildAddress(this.value);\n\n\t\t\tif (!address)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn address.toString(\n\t\t\t\tthis.addressWidget.addressFormat,\n\t\t\t\tAddressStringConverter.STRATEGY_TYPE_FIELD_SORT\n\t\t\t);\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tif (this.initValue)\n\t\t{\n\t\t\tthis.value = this.initValue;\n\t\t}\n\n\t\tlet factory = new BX.Location.Widget.Factory;\n\n\t\tthis.addressWidget = factory.createAddressWidget({\n\t\t\taddress: this.initValue ? this.buildAddress(this.initValue) : null,\n\t\t\tmapBehavior: 'manual',\n\t\t\tpopupBindOptions: {\n\t\t\t\tposition: 'right'\n\t\t\t},\n\t\t\tmode: ControlMode.edit,\n\t\t\tuseFeatures:\n\t\t\t\t{\n\t\t\t\t\tfields: false,\n\t\t\t\t\tmap: true,\n\t\t\t\t\tautocomplete: true\n\t\t\t\t}\n\t\t});\n\n\t\tthis.addressWidget.subscribeOnAddressChangedEvent((event) => {\n\t\t\tlet data = event.getData();\n\n\t\t\tthis.isEditMode = true;\n\n\t\t\tlet address = data.address;\n\n\t\t\tif (!address.latitude || !address.longitude)\n\t\t\t{\n\t\t\t\tthis.changeValue(null);\n\t\t\t\tthis.closeMap();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.changeValue(address.toJson());\n\t\t\t\tthis.showMap();\n\t\t\t}\n\t\t});\n\n\t\tthis.addressWidget.subscribeOnStateChangedEvent((event) => {\n\t\t\tlet data = event.getData();\n\n\t\t\tif (data.state === State.DATA_INPUTTING)\n\t\t\t{\n\t\t\t\tthis.changeValue(null);\n\t\t\t\tthis.closeMap();\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Render widget\n\t\t */\n\t\tthis.addressWidget.render({\n\t\t\tinputNode: this.$refs['input-node'],\n\t\t\tmapBindElement: this.$refs['input-node'],\n\t\t\tcontrolWrapper: this.$refs['control-wrapper'],\n\t\t});\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-closable=\"{\n\t\t\t  exclude: ['input-node'],\n\t\t\t  handler: 'closeMap'\n\t\t\t}\"\n\t\t\tclass=\"ui-ctl-w100\"\n\t\t>\n\t\t\t<div :class=\"wrapperClass\" ref=\"control-wrapper\">\n\t\t\t\t<div\n\t\t\t\t\t@click=\"startOver\"\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-btn ui-ctl-icon-clear\"\n\t\t\t\t></div>\n\t\t\t\t<input\n\t\t\t\t\t@click=\"onInputControlClicked\"\n\t\t\t\t\tref=\"input-node\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox\"\n\t\t\t\t\tv-html=\"addressFormatted\"\n\t\t\t\t/>\n\t\t\t\t<input v-model=\"value\" type=\"hidden\" :name=\"name\" />\n\t\t\t</div>\t\t\t\t\n\t\t</div>\n\t`\n});\n"],"names":["handleOutsideClick","ClosableDirective","bind","el","binding","vnode","e","stopPropagation","value","handler","exclude","clickedOnExcludedEl","forEach","refName","excludedEl","context","$refs","contains","target","document","addEventListener","unbind","removeEventListener","AddressControlConstructor","Vue","extend","directives","closable","props","name","type","String","required","initValue","onChangeCallback","Function","data","id","isEditMode","addressWidget","methods","startOver","address","changeValue","closeMap","newValue","$emit","setTimeout","buildAddress","BX","Location","Core","Address","JSON","parse","getMap","features","feature","Widget","MapFeature","showMap","map","onInputControlClicked","computed","wrapperClass","addressFormatted","toString","addressFormat","AddressStringConverter","STRATEGY_TYPE_FIELD_SORT","mounted","factory","Factory","createAddressWidget","mapBehavior","popupBindOptions","position","mode","ControlMode","edit","useFeatures","fields","autocomplete","subscribeOnAddressChangedEvent","event","getData","latitude","longitude","toJson","subscribeOnStateChangedEvent","state","State","DATA_INPUTTING","render","inputNode","mapBindElement","controlWrapper","template"],"mappings":"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"}