{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Event, Text, Reflection, Type, ajax as Ajax, Loc, Uri} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Loader} from 'main.loader';\n\nimport {StageFlow} from 'ui.stageflow';\nimport {Manager} from 'rpa.manager';\nimport {Timeline as RpaTimeline} from 'rpa.timeline';\n\nimport {Timeline} from 'ui.timeline';\nimport 'ui.notification';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\n\nconst namespace = Reflection.namespace('BX.Rpa');\n\nconst reloadTasksTimeout = 1000;\n\nclass ItemDetailComponent\n{\n\titem: {};\n\tstages: [];\n\tcontainer: Element;\n\toverlay: Element;\n\tcurrentUrl: Uri;\n\tid: number;\n\ttypeId: number;\n\teventIds: Set;\n\titemUpdatedPullTag: ?string;\n\teditorId: string;\n\teditor;\n\tstream: Timeline.Stream;\n\ttaskCountersPullTag: ?string;\n\tcompletedTasks: Set;\n\treloadTasksTimeoutId: ?number;\n\n\tconstructor(params)\n\t{\n\t\tthis.eventIds = new Set();\n\t\tthis.completedTasks = new Set();\n\t\tthis.overlay = BX.create(\"div\", { attrs: { className: \"rpa-entity-overlay\" } });\n\t\tthis.currentUrl = new Uri(location.href);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.id = Text.toInteger(params.id);\n\t\t\tthis.typeId = Text.toInteger(params.typeId);\n\t\t\tif(Type.isString(params.containerId))\n\t\t\t{\n\t\t\t\tthis.container = document.getElementById(params.containerId);\n\t\t\t}\n\t\t\tif(Type.isArray(params.stages))\n\t\t\t{\n\t\t\t\tthis.stages = params.stages;\n\t\t\t}\n\t\t\tif(Type.isPlainObject(params.item))\n\t\t\t{\n\t\t\t\tthis.item = params.item;\n\t\t\t}\n\t\t\tif(Type.isString(params.itemUpdatedPullTag))\n\t\t\t{\n\t\t\t\tthis.itemUpdatedPullTag = params.itemUpdatedPullTag;\n\t\t\t}\n\t\t\tif(Type.isString(params.timelinePullTag))\n\t\t\t{\n\t\t\t\tthis.timelinePullTag = params.timelinePullTag;\n\t\t\t}\n\t\t\tif(Type.isString(params.taskCountersPullTag))\n\t\t\t{\n\t\t\t\tthis.taskCountersPullTag = params.taskCountersPullTag;\n\t\t\t}\n\n\t\t\tif(Type.isString(params.editorId))\n\t\t\t{\n\t\t\t\tthis.editorId = params.editorId;\n\t\t\t\tthis.editor = BX.UI.EntityEditor.get(this.editorId);\n\t\t\t}\n\t\t\tif(params.stream instanceof Timeline.Stream)\n\t\t\t{\n\t\t\t\tthis.stream = params.stream;\n\t\t\t}\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tthis.initStageFlow();\n\t\tthis.initTabs();\n\t\tthis.initPull();\n\t\tthis.bindEvents();\n\n\t\tif(this.id <= 0)\n\t\t{\n\t\t\tthis.container.appendChild(this.overlay);\n\t\t}\n\t}\n\n\tinitStageFlow()\n\t{\n\t\tif(this.container && this.stages && this.item)\n\t\t{\n\t\t\tconst stageFlowContainer = this.container.querySelector('[data-role=\"stageflow-wrap\"]');\n\t\t\tif(stageFlowContainer)\n\t\t\t{\n\t\t\t\tthis.stageflowChart = new StageFlow.Chart({\n\t\t\t\t\tbackgroundColor: 'd3d7dc',\n\t\t\t\t\tcurrentStage: this.item.stageId,\n\t\t\t\t\tisActive: (this.item.id > 0 && this.item.permissions.draggable),\n\t\t\t\t\tonStageChange: this.handleStageChange.bind(this),\n\t\t\t\t\tlabels: {\n\t\t\t\t\t\tfinalStageName: Loc.getMessage('RPA_ITEM_DETAIL_FINAL_STAGE_NAME'),\n\t\t\t\t\t\tfinalStagePopupTitle: Loc.getMessage('RPA_ITEM_DETAIL_FINAL_STAGE_POPUP_TITLE'),\n\t\t\t\t\t\tfinalStagePopupFail: Loc.getMessage('RPA_ITEM_DETAIL_FINAL_STAGE_POPUP_FAIL'),\n\t\t\t\t\t\tfinalStageSelectorTitle: Loc.getMessage('RPA_ITEM_DETAIL_FINAL_STAGE_SELECTOR_TITLE'),\n\t\t\t\t\t},\n\t\t\t\t}, this.stages);\n\t\t\t\tstageFlowContainer.appendChild(this.stageflowChart.render());\n\t\t\t}\n\t\t}\n\t}\n\n\tinitTabs()\n\t{\n\t\tif(this.container)\n\t\t{\n\t\t\tconst tabMenu = this.container.querySelector('[data-role=\"tab-menu\"]');\n\t\t\tif(tabMenu)\n\t\t\t{\n\t\t\t\tconst tabs = tabMenu.querySelectorAll('.rpa-item-detail-tabs-item');\n\t\t\t\tif(tabs)\n\t\t\t\t{\n\t\t\t\t\ttabs.forEach((tab) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tEvent.bind(tab, 'click', () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.handleTabClick(tab);\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tinitPull()\n\t{\n\t\tEvent.ready(() =>\n\t\t{\n\t\t\tconst Pull = BX.PULL;\n\t\t\tif(!Pull)\n\t\t\t{\n\t\t\t\tconsole.error('pull is not initialized');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(this.itemUpdatedPullTag)\n\t\t\t{\n\t\t\t\tPull.subscribe({\n\t\t\t\t\tmoduleId: 'rpa',\n\t\t\t\t\tcommand: this.itemUpdatedPullTag,\n\t\t\t\t\tcallback: this.handlePullItemUpdated.bind(this)\n\t\t\t\t});\n\n\t\t\t\tPull.extendWatch(this.itemUpdatedPullTag);\n\t\t\t}\n\t\t\tif(this.timelinePullTag)\n\t\t\t{\n\t\t\t\tPull.subscribe({\n\t\t\t\t\tmoduleId: 'rpa',\n\t\t\t\t\tcommand: this.timelinePullTag,\n\t\t\t\t\tcallback: this.handlePullTimelineEvent.bind(this),\n\t\t\t\t});\n\n\t\t\t\tPull.extendWatch(this.timelinePullTag);\n\t\t\t}\n\t\t\tif(this.taskCountersPullTag)\n\t\t\t{\n\t\t\t\tPull.subscribe({\n\t\t\t\t\tmoduleId: 'rpa',\n\t\t\t\t\tcommand: this.taskCountersPullTag,\n\t\t\t\t\tcallback: this.handlePullTasksCounters.bind(this),\n\t\t\t\t});\n\n\t\t\t\tPull.extendWatch(this.taskCountersPullTag);\n\t\t\t}\n\t\t});\n\t}\n\n\thandlePullItemUpdated(params: {\n\t\teventId: ?string,\n\t\titem: ?Object,\n\t\titemChangedUserFieldNames: ?Array\n\t})\n\t{\n\t\tif(Type.isString(params.eventId) && params.eventId.length > 0 && this.eventIds.has(params.eventId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(Type.isPlainObject(params.item))\n\t\t{\n\t\t\tif(params.item.stageId !== this.item.stageId)\n\t\t\t{\n\t\t\t\tthis.item.stageId = params.item.stageId;\n\t\t\t\tthis.stageflowChart.setCurrentStageId(this.item.stageId);\n\n\t\t\t\tthis.reloadTasks();\n\t\t\t}\n\t\t}\n\n\t\tif (Type.isArray(params.itemChangedUserFieldNames) && params.itemChangedUserFieldNames.length)\n\t\t{\n\t\t\tthis.handleItemExternalUpdate();\n\t\t}\n\t}\n\n\thandleItemExternalUpdate()\n\t{\n\t\tconst slider = BX.getClass('BX.SidePanel.Instance');\n\t\tif (!this.editor || !slider)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst thisSlider = slider.getSliderByWindow(window);\n\t\t//TODO: reload only editor data & layout :)\n\n\t\tif (this.editor.getMode() === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tMessageBox.show({\n\t\t\t\tmessage: Loc.getMessage('RPA_ITEM_DETAIL_ITEM_EXTERNAL_UPDATE_NOTIFY'),\n\t\t\t\tmodal: true,\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tonOk: function(messageBox) {\n\t\t\t\t\tthisSlider.reload();\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthisSlider.reload();\n\t\t}\n\t}\n\n\thandleTabClick(tab: Element)\n\t{\n\t\tif(!tab.classList.contains('rpa-item-detail-tabs-item-current'))\n\t\t{\n\t\t\tconst tabs = this.container.querySelectorAll('.rpa-item-detail-tabs-item');\n\t\t\tif(tabs)\n\t\t\t{\n\t\t\t\ttabs.forEach((tab) =>\n\t\t\t\t{\n\t\t\t\t\ttab.classList.remove('rpa-item-detail-tabs-item-current');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttab.classList.add('rpa-item-detail-tabs-item-current');\n\t\t\tconst tabId = tab.dataset.tabId;\n\t\t\tconst contents = this.container.querySelectorAll('.rpa-item-detail-tab-content');\n\t\t\tcontents.forEach((content) =>\n\t\t\t{\n\t\t\t\tif(tabId && content.dataset.tabContent && content.dataset.tabContent === tabId)\n\t\t\t\t{\n\t\t\t\t\tcontent.classList.remove('rpa-item-detail-tab-content-hidden');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcontent.classList.add('rpa-item-detail-tab-content-hidden');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\thandleStageChange(stage: StageFlow.Stage)\n\t{\n\t\tif(this.isProgress())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.startProgress();\n\t\tthis.progress = false;\n\t\tconst eventId = Text.getRandom();\n\t\tthis.eventIds.add(eventId);\n\t\tAjax.runAction('rpa.item.update', {\n\t\t\tanalyticsLabel: 'rpaItemDetailUpdateStage',\n\t\t\tdata: {\n\t\t\t\tid: this.item.id,\n\t\t\t\ttypeId: this.item.typeId,\n\t\t\t\tfields: {\n\t\t\t\t\tstageId: stage.getId(),\n\t\t\t\t},\n\t\t\t\teventId\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tthis.item = response.data.item;\n\t\t\tthis.stageflowChart.setCurrentStageId(response.data.item.stageId);\n\t\t\tthis.stageflowChart.render();\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tlet isShowTasks = false;\n\t\t\tresponse.errors.forEach((error) =>\n\t\t\t{\n\t\t\t\tif(error.code && error.code === 'RPA_ITEM_USER_HAS_TASKS')\n\t\t\t\t{\n\t\t\t\t\tisShowTasks = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: error.message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif(isShowTasks)\n\t\t\t{\n\t\t\t\tManager.Instance.openTasks(this.item.typeId, this.item.id);\n\t\t\t}\n\t\t})\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\tsize: 200,\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.progress = true;\n\t\tif(!this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().show(this.container);\n\t\t}\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.progress = false;\n\t\tif(this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().hide();\n\t\t}\n\t}\n\n\tisProgress(): boolean\n\t{\n\t\treturn (this.progress === true);\n\t}\n\n\tshowErrors(errors: Array|string)\n\t{\n\n\t}\n\n\thandlePullTimelineEvent(params: {\n\t\tcommand: string,\n\t\ttimeline: ?Object,\n\t\teventId: ?string,\n\t})\n\t{\n\t\tif(!Type.isPlainObject(params))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(Type.isString(params.eventId) && params.eventId.length > 0 && this.eventIds.has(params.eventId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(params.command === 'add')\n\t\t{\n\t\t\tthis.handlePullTimelineAdd(params);\n\t\t}\n\t\telse if(params.command === 'update')\n\t\t{\n\t\t\tthis.handlePullTimelineUpdate(params);\n\t\t}\n\t\telse if(params.command === 'pin')\n\t\t{\n\t\t\tthis.handlePullTimelinePin(params);\n\t\t}\n\t\telse if(params.command === 'delete')\n\t\t{\n\t\t\tthis.handlePullTimelineDelete(params);\n\t\t}\n\t}\n\n\thandlePullTimelineAdd(params: {\n\t\ttimeline: ?Object,\n\t\tcomment: ?Object,\n\t})\n\t{\n\t\tlet timeline = params.timeline;\n\t\tif(!timeline)\n\t\t{\n\t\t\ttimeline = params.comment;\n\t\t}\n\t\tif(Type.isPlainObject(timeline))\n\t\t{\n\t\t\tthis.stream.addUsers(timeline.users);\n\t\t\tconst item = this.stream.createItem(timeline);\n\t\t\tif(item instanceof RpaTimeline.TaskComplete)\n\t\t\t{\n\t\t\t\tif(this.completedTasks.has(item.data.task.ID))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.reloadTasks();\n\t\t\t}\n\t\t\tif(item)\n\t\t\t{\n\t\t\t\tthis.stream.insertItem(item);\n\t\t\t}\n\t\t}\n\t}\n\n\thandlePullTimelinePin(params: {\n\t\ttimeline: ?Object,\n\t})\n\t{\n\t\tif(Type.isPlainObject(params.timeline))\n\t\t{\n\t\t\tconst item = this.stream.getItem(params.timeline.id);\n\t\t\titem.isFixed = params.timeline.isFixed;\n\t\t\titem.renderPin();\n\t\t\tif(item.isFixed)\n\t\t\t{\n\t\t\t\tthis.stream.pinItem(item);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.stream.unPinItem(item);\n\t\t\t}\n\t\t}\n\t}\n\n\thandlePullTimelineDelete(params: {\n\t\ttimeline: ?{\n\t\t\tid: ?number,\n\t\t}\n\t})\n\t{\n\t\tif(params && params.timeline && params.timeline.id > 0)\n\t\t{\n\t\t\tconst item = this.stream.getItem(params.timeline.id);\n\t\t\tif(item)\n\t\t\t{\n\t\t\t\tthis.stream.deleteItem(item);\n\t\t\t}\n\t\t}\n\t}\n\n\thandlePullTimelineUpdate(params: {\n\t\ttimeline: ?{\n\t\t\tid: number,\n\t\t\tdescription: string\n\t\t}\n\t})\n\t{\n\t\tif(params && params.timeline && params.timeline.id > 0)\n\t\t{\n\t\t\tlet item = this.stream.getItem(params.timeline.id);\n\t\t\tif(item)\n\t\t\t{\n\t\t\t\titem.update(params.timeline);\n\t\t\t}\n\t\t\titem = this.stream.getPinnedItem(params.timeline.id);\n\t\t\tif(item)\n\t\t\t{\n\t\t\t\titem.update(params.timeline);\n\t\t\t}\n\t\t}\n\t}\n\n\thandlePullTasksCounters(params: {\n\t\ttypeId: ?number,\n\t\titemId: ?number,\n\t})\n\t{\n\t\tif (params.typeId === this.typeId && params.itemId === this.id)\n\t\t{\n\t\t\tthis.reloadTasks()\n\t\t}\n\t}\n\n\treloadTasks()\n\t{\n\t\tif(this.isProgress())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.reloadTasksTimeoutId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.reloadTasksTimeoutId = setTimeout(() =>\n\t\t{\n\t\t\tthis.startProgress();\n\t\t\tAjax.runAction('rpa.item.getTasks', {\n\t\t\t\tanalyticsLabel: 'rpaItemTimelineGetTasks',\n\t\t\t\tdata: {\n\t\t\t\t\ttypeId: this.typeId,\n\t\t\t\t\tid: this.id,\n\t\t\t\t}\n\t\t\t}).then((response) => {\n\t\t\t\tthis.stopProgress();\n\t\t\t\tthis.reloadTasksTimeoutId = null;\n\t\t\t\tif (Type.isArray(response.data.tasks))\n\t\t\t\t{\n\t\t\t\t\tthis.stream.updateTasks(response.data.tasks);\n\t\t\t\t}\n\t\t\t}).catch(() => {\n\t\t\t\tthis.reloadTasksTimeoutId = null;\n\t\t\t\tthis.stopProgress();\n\t\t\t});\n\t\t}, reloadTasksTimeout);\n\t}\n\n\tbindEvents()\n\t{\n\t\tEvent.ready(() =>\n\t\t{\n\t\t\tEventEmitter.subscribe('BX.UI.EntityEditor:onSave', (event: BaseEvent) => {\n\t\t\t\tif(Type.isArray(event.getData()))\n\t\t\t\t{\n\t\t\t\t\tconst editor = event.getData()[0];\n\t\t\t\t\tif(editor._ajaxForm && Type.isFunction(editor._ajaxForm.addUrlParams))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst eventId = Text.getRandom();\n\t\t\t\t\t\tthis.eventIds.add(eventId);\n\t\t\t\t\t\teditor._ajaxForm.addUrlParams({\n\t\t\t\t\t\t\teventId\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif(!this.item.id)\n\t\t\t{\n\t\t\t\tEventEmitter.subscribe('BX.UI.EntityEditorAjax:onSubmit', (event: BaseEvent) => {\n\t\t\t\t\tconst data = event.getData();\n\t\t\t\t\tif(Type.isArray(data))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst response = data[1];\n\t\t\t\t\t\tif(response && response.data && response.data.item)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst url = Manager.Instance.getItemDetailUrl(this.typeId, response.data.item.id);\n\t\t\t\t\t\t\tif(url)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst {IFRAME: iframe, IFRAME_TYPE: iframeType} = this.currentUrl.getQueryParams();\n\t\t\t\t\t\t\t\tconst isSlider = (iframe === 'Y') && (iframeType === 'SIDE_SLIDER');\n\t\t\t\t\t\t\t\tif (isSlider)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\turl.setQueryParams({ IFRAME: 'Y', IFRAME_TYPE: 'SIDE_SLIDER' });\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlocation.href = url.toString();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.stream.subscribe('onScrollToTheBottom', this.loadItems.bind(this));\n\t\t\tthis.stream.subscribe('onPinClick', this.handleItemPinClick.bind(this));\n\n\t\t\tEventEmitter.subscribe('BX.UI.Timeline.CommentEditor:onLoadVisualEditor', (event: BaseEvent) => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tAjax.runAction('rpa.comment.getVisualEditor', {\n\t\t\t\t\t\tanalyticsLabel: 'rpaTimelineCommentLoadVisualEditor',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tname: event.getData().name,\n\t\t\t\t\t\t\tcommentId: event.getData().commentId,\n\t\t\t\t\t\t}\n\t\t\t\t\t}).then((response) => {\n\t\t\t\t\t\tevent.getData().html = response.data.html;\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}).catch(() => {\n\t\t\t\t\t\treject();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe('BX.UI.Timeline.CommentEditor:onSave', (event: BaseEvent) => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst eventId = Text.getRandom();\n\t\t\t\t\tthis.eventIds.add(eventId);\n\t\t\t\t\tlet analyticsLabel = 'rpaTimelineCommentAdd';\n\t\t\t\t\tlet action = 'rpa.comment.add';\n\t\t\t\t\tlet data = {\n\t\t\t\t\t\ttypeId: this.typeId,\n\t\t\t\t\t\titemId: this.id,\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tdescription: event.getData().description,\n\t\t\t\t\t\t\tfiles: event.getData().files,\n\t\t\t\t\t\t},\n\t\t\t\t\t\teventId,\n\t\t\t\t\t};\n\t\t\t\t\tconst commentId = Text.toInteger(event.getData().commentId);\n\t\t\t\t\tif(commentId > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\taction = 'rpa.comment.update';\n\t\t\t\t\t\tdata.id = commentId;\n\t\t\t\t\t\tanalyticsLabel = 'rpaTimelineCommentUpdate';\n\t\t\t\t\t}\n\t\t\t\t\tAjax.runAction(action, {\n\t\t\t\t\t\tanalyticsLabel,\n\t\t\t\t\t\tdata,\n\t\t\t\t\t}).then((response) => {\n\t\t\t\t\t\tevent.getData().comment = response.data.comment;\n\t\t\t\t\t\tif(commentId <= 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(response.data && response.data.comment)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.stream.addUsers(response.data.comment.users);\n\t\t\t\t\t\t\t\tconst item = this.stream.createItem(response.data.comment);\n\t\t\t\t\t\t\t\tif(item)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.stream.insertItem(item);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst comment = this.stream.createItem(response.data.comment);\n\t\t\t\t\t\t\tconst commonComment = this.stream.getItem(comment.getId());\n\t\t\t\t\t\t\tif(commonComment)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcommonComment.update(response.data.comment);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst pinnedComment = this.stream.getPinnedItem(comment.getId());\n\t\t\t\t\t\t\tif(pinnedComment)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tpinnedComment.update(response.data.comment);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}).catch((response) => {\n\t\t\t\t\t\tevent.getData().message = response.errors.map(({message}) => {\n\t\t\t\t\t\t\treturn message;\n\t\t\t\t\t\t}).join(\"; \");\n\t\t\t\t\t\treject();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe('BX.UI.Timeline.Comment:onLoadContent', (event: BaseEvent) => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst commentId = Text.toInteger(event.getData().commentId);\n\t\t\t\t\tif(!commentId)\n\t\t\t\t\t{\n\t\t\t\t\t\treject();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tAjax.runAction('rpa.comment.get', {\n\t\t\t\t\t\tanalyticsLabel: 'rpaTimelineCommentGetContent',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid: commentId,\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tif(response.data && response.data.comment)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.getData().comment = response.data.comment;\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tevent.getData().message = response.errors.map(({message}) => {\n\t\t\t\t\t\t\treturn message;\n\t\t\t\t\t\t}).join(\"; \");\n\t\t\t\t\t\treject();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe('BX.UI.Timeline.Comment:onLoadFilesContent', (event: BaseEvent) => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst commentId = Text.toInteger(event.getData().commentId);\n\t\t\t\t\tif(!commentId)\n\t\t\t\t\t{\n\t\t\t\t\t\treject();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tAjax.runAction('rpa.comment.getFilesContent', {\n\t\t\t\t\t\tanalyticsLabel: 'rpaTimelineCommentGetFilesContent',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid: commentId,\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tif(response.data && Type.isString(response.data.html) && response.data.html.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.getData().html = response.data.html;\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tevent.getData().message = response.errors.map(({message}) => {\n\t\t\t\t\t\t\treturn message;\n\t\t\t\t\t\t}).join(\"; \");\n\t\t\t\t\t\treject();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\n\t\t\tEventEmitter.subscribe('BX.UI.Timeline.Comment:onDelete', (event: BaseEvent) => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst commentId = Text.toInteger(event.getData().commentId);\n\t\t\t\t\tif(!commentId)\n\t\t\t\t\t{\n\t\t\t\t\t\treject();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst eventId = Text.getRandom();\n\t\t\t\t\tthis.eventIds.add(eventId);\n\t\t\t\t\tAjax.runAction('rpa.comment.delete', {\n\t\t\t\t\t\tanalyticsLabel: 'rpaTimelineCommentDelete',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid: commentId,\n\t\t\t\t\t\t\teventId,\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tevent.getData().message = response.errors.map(({message}) => {\n\t\t\t\t\t\t\treturn message;\n\t\t\t\t\t\t}).join(\"; \");\n\t\t\t\t\t\treject();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe('BX.Rpa.Timeline.Task:onBeforeCompleteTask', (event: BaseEvent) => {\n\t\t\t\tthis.completedTasks.add(event.getData().taskId);\n\t\t\t});\n\t\t});\n\t}\n\n\tloadItems()\n\t{\n\t\tif(this.isProgress())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.startProgress();\n\t\tthis.stream.currentPage++;\n\t\tAjax.runAction('rpa.timeline.listForItem', {\n\t\t\tanalyticsLabel: 'rpaItemDetailTimelineLoadOnScroll',\n\t\t\tdata: {\n\t\t\t\ttypeId: this.typeId,\n\t\t\t\titemId: this.id,\n\t\t\t},\n\t\t\tnavigation: {\n\t\t\t\tpage: this.stream.currentPage,\n\t\t\t\tsize: this.stream.pageSize,\n\t\t\t}\n\t\t}).then((response) => {\n\t\t\tthis.stopProgress();\n\t\t\tconst items = response.data.timeline;\n\t\t\tif(Type.isArray(items))\n\t\t\t{\n\t\t\t\tif(items.length <= 0)\n\t\t\t\t{\n\t\t\t\t\tthis.stream.disableLoadOnScroll();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\titems.forEach((itemData) => {\n\t\t\t\t\t\tconst item = this.stream.createItem(itemData);\n\t\t\t\t\t\tif(item)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.stream.addItem(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.stream.renderItems();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.stream.disableLoadOnScroll();\n\t\t\t}\n\t\t}).catch(() => {\n\t\t\tthis.stopProgress();\n\t\t\tthis.stream.disableLoadOnScroll();\n\t\t});\n\t}\n\n\thandleItemPinClick(event: BaseEvent)\n\t{\n\t\tconst item = event.getData().item;\n\t\tif(item instanceof Timeline.Item)\n\t\t{\n\t\t\tAjax.runAction('rpa.timeline.updateIsFixed', {\n\t\t\t\tanalyticsLabel: 'rpaTimelinePinClick',\n\t\t\t\tdata: {\n\t\t\t\t\tid: item.getId(),\n\t\t\t\t\tisFixed: item.isFixed ? 'y' : 'n',\n\t\t\t\t\teventId: this.registerRandomEventId(),\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tregisterRandomEventId(): string\n\t{\n\t\tconst eventId = Text.getRandom();\n\t\tthis.eventIds.add(eventId);\n\t\treturn eventId;\n\t}\n}\n\nnamespace.ItemDetailComponent = ItemDetailComponent;"],"names":["namespace","Reflection","reloadTasksTimeout","ItemDetailComponent","params","eventIds","Set","completedTasks","overlay","BX","create","attrs","className","currentUrl","Uri","location","href","Type","isPlainObject","id","Text","toInteger","typeId","isString","containerId","container","document","getElementById","isArray","stages","item","itemUpdatedPullTag","timelinePullTag","taskCountersPullTag","editorId","editor","UI","EntityEditor","get","stream","Timeline","Stream","initStageFlow","initTabs","initPull","bindEvents","appendChild","stageFlowContainer","querySelector","stageflowChart","StageFlow","Chart","backgroundColor","currentStage","stageId","isActive","permissions","draggable","onStageChange","handleStageChange","bind","labels","finalStageName","Loc","getMessage","finalStagePopupTitle","finalStagePopupFail","finalStageSelectorTitle","render","tabMenu","tabs","querySelectorAll","forEach","tab","Event","handleTabClick","ready","Pull","PULL","console","error","subscribe","moduleId","command","callback","handlePullItemUpdated","extendWatch","handlePullTimelineEvent","handlePullTasksCounters","eventId","length","has","setCurrentStageId","reloadTasks","itemChangedUserFieldNames","handleItemExternalUpdate","slider","getClass","thisSlider","getSliderByWindow","window","getMode","EntityEditorMode","edit","MessageBox","show","message","modal","buttons","MessageBoxButtons","OK_CANCEL","onOk","messageBox","reload","close","classList","contains","remove","add","tabId","dataset","contents","content","tabContent","stage","isProgress","startProgress","progress","getRandom","Ajax","runAction","analyticsLabel","data","fields","getId","then","response","stopProgress","catch","isShowTasks","errors","code","Notification","Center","notify","Manager","Instance","openTasks","loader","Loader","size","getLoader","isShown","hide","handlePullTimelineAdd","handlePullTimelineUpdate","handlePullTimelinePin","handlePullTimelineDelete","timeline","comment","addUsers","users","createItem","RpaTimeline","TaskComplete","task","ID","insertItem","getItem","isFixed","renderPin","pinItem","unPinItem","deleteItem","update","getPinnedItem","itemId","reloadTasksTimeoutId","setTimeout","tasks","updateTasks","EventEmitter","event","getData","_ajaxForm","isFunction","addUrlParams","url","getItemDetailUrl","getQueryParams","iframe","IFRAME","iframeType","IFRAME_TYPE","isSlider","setQueryParams","toString","loadItems","handleItemPinClick","Promise","resolve","reject","name","commentId","html","action","description","files","commonComment","pinnedComment","map","join","taskId","currentPage","navigation","page","pageSize","items","disableLoadOnScroll","itemData","addItem","renderItems","Item","registerRandomEventId"],"mappings":"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"}