{"version":3,"file":"kanban.bundle.js","sources":["../src/pullmanager.js","../src/column.js","../src/item.js","../src/grid.js","../src/kanban.js"],"sourcesContent":["import {Text, Event, Type} from 'main.core';\nimport {Kanban as RpaKanban} from 'rpa.kanban';\n\nexport class PullManager\n{\n\tgrid;\n\n\tconstructor(grid)\n\t{\n\t\tthis.eventIds = new Set();\n\t\tif(grid instanceof RpaKanban.Grid)\n\t\t{\n\t\t\tthis.grid = grid;\n\t\t\tif(Type.isArray(this.grid.getData().eventIds))\n\t\t\t{\n\t\t\t\tthis.grid.getData().eventIds.forEach((eventId) =>\n\t\t\t\t{\n\t\t\t\t\tthis.eventIds.add(eventId);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif(Type.isString(grid.getData().pullTag) && Type.isString(grid.getData().moduleId) && grid.getData().userId > 0)\n\t\t\t{\n\t\t\t\tthis.init();\n\t\t\t}\n\t\t}\n\t}\n\n\tregisterEventId(eventId: string)\n\t{\n\t\tthis.eventIds.add(eventId);\n\t}\n\n\tregisterRandomEventId(): string\n\t{\n\t\tconst eventId = Text.getRandom();\n\t\tthis.registerEventId(eventId);\n\t\treturn eventId;\n\t}\n\n\tinit()\n\t{\n\t\tEvent.ready(() =>\n\t\t{\n\t\t\tconst Pull = BX.PULL;\n\t\t\tif(!Pull)\n\t\t\t{\n\t\t\t\tconsole.error('pull is not initialized');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(Type.isString(this.grid.getData().pullTag))\n\t\t\t{\n\t\t\t\tPull.subscribe({\n\t\t\t\t\tmoduleId: this.grid.getData().moduleId,\n\t\t\t\t\tcommand: this.grid.getData().pullTag,\n\t\t\t\t\tcallback: (params) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif(Type.isString(params.eventName))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(Type.isString(params.eventId))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif(this.eventIds.has(params.eventId))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(params.eventName.indexOf('ITEMUPDATED' + this.grid.getTypeId()) === 0 && Type.isPlainObject(params.item))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullItemUpdated(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName === ('ITEMADDED' + this.grid.getTypeId()) && Type.isPlainObject(params.item))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullItemAdded(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName.indexOf('ITEMDELETED' + this.grid.getTypeId()) === 0 && Type.isPlainObject(params.item))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullItemDeleted(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName === ('STAGEADDED' + this.grid.getTypeId()) && Type.isPlainObject(params.stage))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullStageAdded(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName.indexOf('STAGEUPDATED' + this.grid.getTypeId()) === 0 && Type.isPlainObject(params.stage))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullStageUpdated(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName.indexOf('STAGEDELETED' + this.grid.getTypeId()) === 0 && Type.isPlainObject(params.stage))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullStageDeleted(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName === ('ROBOTADDED' + this.grid.getTypeId()) && Type.isPlainObject(params.robot))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullRobotAdded(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName.indexOf('ROBOTUPDATED' + this.grid.getTypeId()) === 0 && Type.isPlainObject(params.robot))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullRobotUpdated(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName.indexOf('ROBOTDELETED' + this.grid.getTypeId()) === 0 && Type.isPlainObject(params.robot))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullRobotDeleted(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName.indexOf('TYPEUPDATED' + this.grid.getTypeId()) === 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullTypeUpdated();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tPull.extendWatch(this.grid.getData().pullTag);\n\t\t\t}\n\n\t\t\tif(Type.isString(this.grid.getData().taskCountersPullTag))\n\t\t\t{\n\t\t\t\tPull.subscribe({\n\t\t\t\t\tmoduleId: this.grid.getData().moduleId,\n\t\t\t\t\tcommand: this.grid.getData().taskCountersPullTag,\n\t\t\t\t\tcallback: (params) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif(Type.isString(params.eventId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(this.eventIds.has(params.eventId))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(this.grid.getTypeId() === Text.toInteger(params.typeId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullCounters(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tPull.extendWatch(this.grid.getData().taskCountersPullTag);\n\t\t\t}\n\t\t});\n\t}\n\n\tonPullItemUpdated(params)\n\t{\n\t\tthis.grid.addUsers(params.item.users);\n\t\tconst item = this.grid.getItem(params.item.id);\n\t\tif(item)\n\t\t{\n\t\t\titem.setData(params.item);\n\t\t\tthis.grid.insertItem(item);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst column = this.grid.getColumn(params.item.stageId);\n\t\t\tif(column && (column.isCanMoveFrom() || column.canAddItems()))\n\t\t\t{\n\t\t\t\tthis.onPullItemAdded(params);\n\t\t\t}\n\t\t}\n\t}\n\n\tonPullItemAdded(params)\n\t{\n\t\tconst itemData = params.item;\n\t\tthis.grid.addUsers(itemData.users);\n\n\t\tconst oldItem = this.grid.getItem(itemData.id);\n\t\tif(oldItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst item = new RpaKanban.Item({\n\t\t\tid: itemData.id,\n\t\t\tcolumnId: itemData.stageId,\n\t\t\tname: itemData.name,\n\t\t\tdata: itemData,\n\t\t});\n\t\titem.setGrid(this.grid);\n\t\tthis.grid.items[item.getId()] = item;\n\n\t\tconst column = this.grid.getColumn(item.getStageId());\n\t\tif(\n\t\t\tcolumn\n\t\t\t//&& this.grid.getFirstColumn() !== column\n\t\t\t&& (column.isCanMoveFrom() || column.canAddItems()))\n\t\t{\n\t\t\tcolumn.addItem(item, column.getFirstItem());\n\t\t}\n\t}\n\n\tonPullItemDeleted(params: Object)\n\t{\n\t\tif(!Type.isPlainObject(params.item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.grid.removeItem(params.item.id);\n\t}\n\n\tonPullStageAdded(params)\n\t{\n\t\tthis.grid.onApplyFilter();\n\t}\n\n\tonPullStageUpdated(params)\n\t{\n\t\tconst column = this.grid.getColumn(params.stage.id);\n\t\tif(column)\n\t\t{\n\t\t\tcolumn.update(params);\n\t\t}\n\t}\n\n\tonPullStageDeleted(params)\n\t{\n\t\tthis.grid.removeColumn(params.stage.id);\n\t}\n\n\tonPullRobotAdded(params: Object)\n\t{\n\t\tthis.onPullRobotChanged(params.robot.stageId);\n\t}\n\n\tonPullRobotUpdated(params: Object)\n\t{\n\t\tthis.onPullRobotChanged(params.robot.stageId);\n\t}\n\n\tonPullRobotDeleted(params: Object)\n\t{\n\t\tif(Type.isPlainObject(params.robot) && Type.isString(params.robot.robotName))\n\t\t{\n\t\t\tconst column = this.grid.getColumn(params.robot.stageId);\n\t\t\tif(column)\n\t\t\t{\n\t\t\t\tcolumn.setTasks(column.getTasks().filter((filteredTask) =>\n\t\t\t\t{\n\t\t\t\t\treturn (filteredTask.robotName !== params.robot.robotName);\n\t\t\t\t}));\n\t\t\t\tcolumn.rerenderSubtitle();\n\t\t\t}\n\t\t}\n\t}\n\n\tonPullRobotChanged(stageId: number)\n\t{\n\t\tconst column = this.grid.getColumn(stageId);\n\t\tif(column)\n\t\t{\n\t\t\tcolumn.loadTasks().then(() =>\n\t\t\t{\n\t\t\t\tcolumn.rerenderSubtitle();\n\t\t\t}).catch(() =>\n\t\t\t{\n\n\t\t\t});\n\t\t}\n\t}\n\n\tonPullCounters(params: {\n\t\ttypeId: number,\n\t\titemId: number,\n\t\tcounter: string,\n\t\ttasksFaces: ?{\n\t\t\tcompleted: [],\n\t\t\trunning: [],\n\t\t\tall: [],\n\t\t},\n\t})\n\t{\n\t\tlet typeId = Text.toInteger(params.typeId);\n\t\tlet itemId = Text.toInteger(params.itemId);\n\t\tif(typeId !== this.grid.getTypeId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst item = this.grid.getItem(itemId);\n\t\tif(item)\n\t\t{\n\t\t\tlet currentCounter = item.getTasksCounter();\n\t\t\tif(params.counter === '+1')\n\t\t\t{\n\t\t\t\tcurrentCounter++;\n\t\t\t}\n\t\t\telse if(params.counter === '-1')\n\t\t\t{\n\t\t\t\tcurrentCounter--;\n\t\t\t}\n\t\t\titem.setTasksCounter(currentCounter);\n\t\t\tif(Type.isPlainObject(params.tasksFaces))\n\t\t\t{\n\t\t\t\titem.setTasksParticipants(params.tasksFaces);\n\t\t\t}\n\t\t\titem.render();\n\t\t}\n\t}\n\n\tonPullTypeUpdated()\n\t{\n\t\tthis.grid.onApplyFilter();\n\t}\n}","import {Kanban} from 'main.kanban';\nimport {Kanban as RpaKanban} from 'rpa.kanban';\nimport {Tag, Uri, Type, ajax as Ajax, Runtime, Loc, Dom, Event, Text} from 'main.core';\nimport {Manager} from 'rpa.manager';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\n\nimport {Popup} from 'main.popup';\n\nexport default class Column extends Kanban.Column\n{\n\tcanMoveFrom;\n\n\tgetId()\n\t{\n\t\treturn parseInt(super.getId());\n\t}\n\n\tsetOptions(options)\n\t{\n\t\tsuper.setOptions(options);\n\t\tthis.canMoveFrom = !!options.canMoveFrom;\n\t\tthis.setPermissionProperties();\n\t}\n\n\tisDroppable(): boolean\n\t{\n\t\treturn super.isDroppable() || this.canMoveTo();\n\t}\n\n\tisFirstColumn()\n\t{\n\t\treturn (this.data.isFirst === true);\n\t}\n\n\tsetIsFirstColumn(isFirst: boolean = false): Column\n\t{\n\t\tthis.data.isFirst = isFirst;\n\n\t\treturn this;\n\t}\n\n\tonAfterRender()\n\t{\n\t\tif(!this.isDroppable())\n\t\t{\n\t\t\tthis.getContainer().style.backgroundColor = 'rgba(204, 204, 204, 0.2)';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getContainer().style.backgroundColor = 'transparent';\n\t\t}\n\t}\n\n\trerenderSubtitle()\n\t{\n\t\tconst nodeNames = [\n\t\t\t'responsible',\n\t\t\t'subTitleTasksButton',\n\t\t\t'subTitleTasks',\n\t\t\t'subTitleAddTaskButton',\n\t\t\t'subTitleSettingsButton',\n\t\t\t'subTitleAddButton',\n\t\t];\n\t\tnodeNames.forEach((nodeName) =>\n\t\t{\n\t\t\tDom.clean(this.layout[nodeName]);\n\t\t\tthis.layout[nodeName] = null;\n\t\t});\n\t\tDom.clean(this.layout.subtitleNode);\n\t\tif(this.tasksPopup)\n\t\t{\n\t\t\tthis.tasksPopup.destroy();\n\t\t}\n\t\tthis.renderSubTitle();\n\t}\n\n\trenderSubTitle(): HTMLElement\n\t{\n\t\tconst subTitleNode = this.getSubTitleNode();\n\t\tif(this.isEditable())\n\t\t{\n\t\t\tconst tasks = this.getTasks();\n\t\t\tconst robotsCnt = this.getData()['robotsCount'];\n\t\t\tif (tasks && tasks.length > 0)\n\t\t\t{\n\t\t\t\tsubTitleNode.appendChild(this.renderSubTitleTasks(tasks));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!this.isFirstColumn() || this.isFirstColumn() && !robotsCnt)\n\t\t\t\t{\n\t\t\t\t\tsubTitleNode.appendChild(this.renderSubTitleAddTaskButton());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(this.isFirstColumn() && this.canAddItems())\n\t\t{\n\t\t\tsubTitleNode.appendChild(this.renderSubTitleAddButton());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(this.layout.subTitleAddButton)\n\t\t\t{\n\t\t\t\tDom.remove(this.layout.subTitleAddButton);\n\t\t\t\tthis.layout.subTitleAddButton = null;\n\t\t\t}\n\t\t}\n\n\t\treturn subTitleNode;\n\t}\n\n\tgetSubTitleNode()\n\t{\n\t\tif(!this.layout.subtitleNode)\n\t\t{\n\t\t\tthis.layout.subtitleNode = Tag.render`<div class=\"main-kanban-column-subtitle-box\"></div>`;\n\t\t}\n\n\t\treturn this.layout.subtitleNode;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\tconst container = super.getContainer();\n\n\t\tif(this.isFirstColumn() && this.canAddItems())\n\t\t{\n\t\t\tconst quickFormContainer = this.renderQuickFormContainer();\n\t\t\tconst itemsContainer = this.getItemsContainer();\n\t\t\tif(quickFormContainer && itemsContainer)\n\t\t\t{\n\t\t\t\tif(quickFormContainer.parentNode !== itemsContainer)\n\t\t\t\t{\n\t\t\t\t\tDom.prepend(quickFormContainer, itemsContainer);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn container;\n\t}\n\n\t//region quick form\n\trenderSubTitleAddButton()\n\t{\n\t\tif(!this.layout.subTitleAddButton)\n\t\t{\n\t\t\tthis.layout.subTitleAddButton = Tag.render`<div class=\"main-kanban-column-add-item-button\" onclick=\"${this.handleAddItemButtonClick.bind(this)}\"></div>`\n\t\t}\n\n\t\treturn this.layout.subTitleAddButton;\n\t}\n\n\trenderQuickFormContainer()\n\t{\n\t\tif(!this.layout.quickFormContainer)\n\t\t{\n\t\t\tlet className = 'rpa-kanban-form';\n\t\t\tif(this.getGrid().canAddColumns())\n\t\t\t{\n\t\t\t\tclassName += ' rpa-kanban-form-with-settings';\n\t\t\t}\n\t\t\tthis.layout.quickFormContainer = Tag.render`<div class=\"${className}\"></div>`\n\t\t}\n\n\t\treturn this.layout.quickFormContainer;\n\t}\n\n \trenderQuickFormButtons()\n\t{\n\t\tif(!this.layout.quickFormButtons)\n\t\t{\n\t\t\tthis.layout.quickFormButtons = Tag.render`<div class=\"rpa-kanban-form-buttons\">\n\t\t\t\t<button class=\"ui-btn ui-btn-sm ui-btn-primary\" onclick=\"${this.handleFormSaveButtonClick.bind(this)}\">${Loc.getMessage('RPA_KANBAN_QUICK_FORM_SAVE_BUTTON')}</button>\n\t\t\t\t<button class=\"ui-btn ui-btn-sm ui-btn-link\" onclick=\"${this.handleFormCancelButtonClick.bind(this)}\">${Loc.getMessage('RPA_KANBAN_QUICK_FORM_CANCEL_BUTTON')}</button>\n\t\t\t</div>`\n\t\t}\n\n\t\treturn this.layout.quickFormButtons;\n\t}\n\n\thandleAddItemButtonClick()\n\t{\n\t\tif(this.getGrid().isProgress())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(this.getGrid().isCreateItemRestricted())\n\t\t{\n\t\t\tManager.Instance.showFeatureSlider();\n\t\t\treturn;\n\t\t}\n\t\tif(this.isFormVisible())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.getGrid().startProgress();\n\t\tAjax.runAction('rpa.item.getEditor', {\n\t\t\tanalyticsLabel: 'rpaItemOpenQuickForm',\n\t\t\tdata: {\n\t\t\t\ttypeId: this.getGrid().getTypeId(),\n\t\t\t\tid: 0,\n\t\t\t\tstageId: this.getId(),\n\t\t\t\teventId: this.getGrid().pullManager.registerRandomEventId(),\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tthis.getGrid().stopProgress();\n\t\t\tRuntime.html(this.layout.quickFormContainer, response.data.html).then(() =>\n\t\t\t{\n\t\t\t\tthis.addSelectButtonToEditor();\n\t\t\t\tDom.append(this.renderQuickFormButtons(), this.layout.quickFormContainer);\n\t\t\t\tthis.showForm();\n\t\t\t\tthis.bindKeyDownEvents();\n\t\t\t});\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.getGrid().stopProgress();\n\t\t\tthis.getGrid().showErrorFromResponse(response);\n\t\t});\n\t}\n\n\tshowForm()\n\t{\n\t\tthis.getBody().scrollTop = 0;\n\t\tthis.layout.quickFormContainer.style.display = 'block';\n\t\tthis.layout.quickFormButtons.style.display = 'block';\n\t}\n\n\thideForm()\n\t{\n\t\tthis.layout.quickFormContainer.style.display = 'none';\n\t\tthis.layout.quickFormButtons.style.display = 'none';\n\t}\n\n\tisFormVisible()\n\t{\n\t\treturn (\n\t\t\tthis.layout.quickFormContainer.style.display === 'block' &&\n\t\t\tthis.layout.quickFormButtons.style.display === 'block'\n\t\t);\n\t}\n\n\tgetEditor()\n\t{\n\t\treturn Manager.getEditor(this.getGrid().getTypeId(), 0);\n\t}\n\n\thandleFormCancelButtonClick()\n\t{\n\t\tconst editor = this.getEditor();\n\t\tif(editor)\n\t\t{\n\t\t\teditor.rollback();\n\t\t\teditor.refreshLayout();\n\t\t}\n\t\tthis.hideForm();\n\t}\n\n\thandleFormSaveButtonClick()\n\t{\n\t\tconst editor = this.getEditor();\n\t\tif(editor)\n\t\t{\n\t\t\teditor.save();\n\t\t\tthis.bindEditorEvents();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideForm();\n\t\t}\n\t}\n\n\tonEditorSubmit(entityData, response)\n\t{\n\t\tif(this.isFormVisible())\n\t\t{\n\t\t\tthis.hideForm();\n\t\t\tconst itemData = response.data.item;\n\t\t\tthis.getGrid().addUsers(response.data.item.users);\n\n\t\t\tconst oldItem = this.getGrid().getItem(itemData.id);\n\t\t\tif(oldItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst item = new RpaKanban.Item({\n\t\t\t\tid: itemData.id,\n\t\t\t\tcolumnId: itemData.stageId,\n\t\t\t\tname: itemData.name,\n\t\t\t\tdata: itemData,\n\t\t\t});\n\t\t\titem.setGrid(this.getGrid());\n\t\t\tthis.getGrid().items[item.getId()] = item;\n\n\t\t\tconst column = this.getGrid().getColumn(item.getStageId());\n\t\t\tif(column)\n\t\t\t{\n\t\t\t\tcolumn.addItem(item, column.getFirstItem());\n\t\t\t}\n\t\t}\n\t}\n\n\tonEditorErrors(errors)\n\t{\n\t\tif(this.isFormVisible())\n\t\t{\n\t\t\tthis.hideForm();\n\n\t\t\tthis.getGrid().showErrorFromResponse(errors);\n\t\t}\n\t}\n\n\tbindEditorEvents()\n\t{\n\t\tif(!this.isEditorEventsBinded)\n\t\t{\n\t\t\tthis.isEditorEventsBinded = true;\n\n\t\t\tBX.addCustomEvent(window, 'BX.UI.EntityEditorAjax:onSubmitFailure', this.onEditorErrors.bind(this));\n\t\t\tBX.addCustomEvent(window, 'BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit.bind(this));\n\t\t}\n\t}\n\n\tbindKeyDownEvents()\n\t{\n\t\tif(!this.isKeyDownEventsBinded)\n\t\t{\n\t\t\tthis.isKeyDownEventsBinded = true;\n\n\t\t\tconst onEnterKeyDown = (event) =>\n\t\t\t{\n\t\t\t\tif(\n\t\t\t\t\t(event.code === 'Enter' || event.code === 'NumpadEnter') &&\n\t\t\t\t\tthis.isFormVisible()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.handleFormSaveButtonClick();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst isCtrlKey = function(code: string)\n\t\t\t{\n\t\t\t\treturn (\n\t\t\t\t\tcode === 'MetaRight' ||\n\t\t\t\t\tcode === 'MetaLeft' ||\n\t\t\t\t\tcode === 'ControlRight' ||\n\t\t\t\t\tcode === 'ControlLeft'\n\t\t\t\t);\n\t\t\t};\n\n\t\t\tEvent.bind(window, 'keydown', (event) =>\n\t\t\t{\n\t\t\t\tif(isCtrlKey(event.code))\n\t\t\t\t{\n\t\t\t\t\tEvent.bind(window, 'keydown', onEnterKeyDown);\n\t\t\t\t}\n\t\t\t\telse if(event.code === 'Escape')\n\t\t\t\t{\n\t\t\t\t\tthis.handleFormCancelButtonClick();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tEvent.bind(window, 'keyup', (event) =>\n\t\t\t{\n\t\t\t\tif(isCtrlKey(event.code))\n\t\t\t\t{\n\t\t\t\t\tEvent.unbind(window, 'keydown', onEnterKeyDown);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t//endregion\n\n\t//region settings\n\trenderSubTitleSettingsButton()\n\t{\n\t\tif(!this.layout.subTitleSettingsButton)\n\t\t{\n\t\t\tthis.layout.subTitleSettingsButton = Tag.render`\n\t\t\t<div class=\"main-kanban-column-settings-button\" onclick=\"${this.openSettings.bind(this)}\">\n\t\t\t\t<button class=\"ui-btn ui-btn-xs ui-btn-link ui-btn-icon-setting\"></button>\n\t\t\t</div>`\n\t\t}\n\n\t\treturn this.layout.subTitleSettingsButton;\n\t}\n\n\topenSettings()\n\t{\n\t\tconst url = this.data.settingsUrl;\n\t\tif(url)\n\t\t{\n\t\t\tManager.openSlider(url).then((slider) =>\n\t\t\t{\n\t\t\t\tconst response = slider.getData().get('response');\n\t\t\t\tif(response)\n\t\t\t\t{\n\t\t\t\t\tthis.update(response.data);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\t//endregion\n\n\t//region task\n\trenderSubTitleAddTaskButton()\n\t{\n\t\tif(!this.layout.subTitleAddTaskButton)\n\t\t{\n\t\t\tconst url = this.buildAddRobotUrl();\n\t\t\tthis.layout.subTitleAddTaskButton =\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"main-kanban-column-settings-button\">\n\t\t\t\t\t\t<a class=\"ui-btn ui-btn-xs ui-btn-light-border ui-btn-no-caps ui-btn-round ui-btn-themes main-kanban-column-settings-button-rpa\" href=\"${url}\">\n\t\t\t\t\t\t\t${Loc.getMessage('RPA_KANBAN_COLUMN_ADD_TASK_BTN')}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.subTitleAddTaskButton;\n\t}\n\n\trenderSubTitleTasks(tasks): Element\n\t{\n\t\tif(!this.layout.subTitleTasks)\n\t\t{\n\t\t\tthis.layout.subTitleTasks =\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"rpa-kanban-column-task-block\">\n\t\t\t\t\t\t<div class=\"rpa-kanban-column-task-inner\">\n\t\t\t\t\t\t\t${this.renderSubTitleResponsible(tasks, true)}\n\t\t\t\t\t\t\t${this.renderSubTitleTasksButton(tasks)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.subTitleTasks;\n\t}\n\n\trenderSubTitleTasksButton(tasks): Element\n\t{\n\t\tif(!this.layout.subTitleTasksButton)\n\t\t{\n\t\t\tthis.layout.subTitleTasksButton =\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"rpa-kanban-column-task-btn\" onclick=\"${this.showTasks.bind(this, tasks)}\">\n\t\t\t\t\t\t<span class=\"rpa-kanban-column-task-btn-title\">${Loc.getMessage('RPA_KANBAN_TASKS')}</span>\n\t\t\t\t\t\t<span class=\"rpa-kanban-column-task-btn-counter\">${tasks.length}</span>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.subTitleTasksButton;\n\t}\n\n\trenderSubTitleResponsible(tasks, showTaskListMenu): Element\n\t{\n\t\tlet responsibleElements = [];\n\t\tconst plusHandler = this.showTasks.bind(this, tasks);\n\n\t\ttasks.forEach((task) => {\n\t\t\ttask.users.forEach((user) => {\n\t\t\t\tlet style = 'border-color: #' + this.getColor() + ';';\n\t\t\t\tif (user.photoSrc)\n\t\t\t\t{\n\n\t\t\t\t\tstyle += ' background-image: url(\\'' + Text.encode(encodeURI(user.photoSrc)) + '\\');';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tstyle += ' background-size: 60%;';\n\t\t\t\t}\n\t\t\t\tresponsibleElements.push(Tag.render`<span class=\"rpa-kanban-column-task-responsible-item\" title=\"${user.name}\">\n\t\t\t\t\t<span class=\"rpa-kanban-column-task-responsible-img\" style=\"${style}\">\n\t\t\t\t\t</span>\n\t\t\t\t</span>`);\n\t\t\t});\n\t\t});\n\n\t\tresponsibleElements = this.sliceResponsibleListElements(responsibleElements);\n\n\t\tlet plusNode = Tag.render`<span class=\"rpa-kanban-column-task-responsible-add\"></span>`;\n\t\tif (showTaskListMenu)\n\t\t{\n\t\t\tBX.bind(plusNode, 'click', plusHandler);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet task = tasks[0];\n\n\t\t\tif (task.canAppendResponsibles)\n\t\t\t{\n\t\t\t\tBX.Bizproc.UserSelector.decorateNode(plusNode, {\n\t\t\t\t\tisOnlyDialogMode: true,\n\t\t\t\t\tcallbacks: {\n\t\t\t\t\t\tselect: this.addTaskUserHandler.bind(this, task)\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tplusNode = Tag.render`<a href=\"${this.buildEditRobotUrl(task['robotName'])}\" class=\"rpa-kanban-column-task-responsible-add\"></a>`;\n\t\t\t}\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"rpa-kanban-column-task-responsible\">\n\t\t\t\t\t<div class=\"rpa-kanban-column-task-responsible-list\" style=\"background-color: ${\"#\" + this.getColor()}\" onclick=\"${plusHandler}\">\n\t\t\t\t\t\t${responsibleElements}\n\t\t\t\t\t</div>\n\t\t\t\t\t${plusNode}\n\t\t\t\t</div>\n\t\t\t`;\n\t}\n\n\tsliceResponsibleListElements(elements: Array): Array\n\t{\n\t\tif (elements.length > 4)\n\t\t{\n\t\t\tlet counter = elements.length - 4;\n\t\t\telements = elements.slice(0, 4);\n\n\t\t\telements.push(\n\t\t\t\tTag.render`<span class=\"rpa-kanban-column-task-responsible-item rpa-kanban-column-task-responsible-item-other\">\n\t\t\t\t\t\t<span class=\"rpa-kanban-column-task-responsible-other-text\">+${counter}</span>\n\t\t\t\t\t</span>`\n\t\t\t);\n\t\t}\n\t\treturn elements;\n\t}\n\n\tshowTasks(tasks)\n\t{\n\t\tthis.getTasksPopup(tasks).show();\n\t}\n\n\taddTaskUserHandler(task, value, selector)\n\t{\n\t\tAjax.runAction('rpa.task.addUser', {\n\t\t\tanalyticsLabel: 'rpaTaskAddUser',\n\t\t\tdata: {\n\t\t\t\ttypeId: this.getGrid().getData().typeId,\n\t\t\t\tstageId: this.getId(),\n\t\t\t\trobotName: task.robotName,\n\t\t\t\tuserValue: value,\n\t\t\t},\n\t\t\tgetParameters: {\n\t\t\t\tcontext: 'kanban',\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\n\t\t});\n\t}\n\n\tgetTasksPopup(tasks): Popup\n\t{\n\t\tif(!this.tasksPopup)\n\t\t{\n\t\t\tlet button = this.layout.subTitleTasksButton;\n\t\t\tif(!button)\n\t\t\t{\n\t\t\t\tbutton = this.renderSubTitleTasksButton(this.getTasks());\n\t\t\t}\n\t\t\tthis.tasksPopup = new Popup('rpa-tasks-' + this.getId(), button, {\n\t\t\t\tautoHide: true,\n\t\t\t\tdraggable: false,\n\t\t\t\toffsetTop: -5,\n\t\t\t\toffsetLeft: 30,\n\t\t\t\tnoAllPaddings: true,\n\t\t\t\tbindOptions: { forceBindPosition: true },\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcacheable: false,\n\t\t\t\tangle: {\n\t\t\t\t\toffset: 81,\n\t\t\t\t\tposition: 'top',\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.tasksPopup = null;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\toverlay: { backgroundColor: 'transparent' },\n\t\t\t\tcontent: this.renderTasksPopup(tasks)\n\t\t\t});\n\t\t}\n\n\t\treturn this.tasksPopup;\n\t}\n\n\trenderTasksPopup(tasks): Element\n\t{\n\t\tconst elements = tasks.map((task) => {\n\t\t\treturn Tag.render`<div class=\"rpa-kanban-tasks-popup-item\">\n\t\t\t\t\t\t<a href=\"${this.buildEditRobotUrl(task['robotName'])}\" class=\"rpa-kanban-tasks-popup-name\">${Text.encode(task['title'])}</a>\n\t\t\t\t\t\t<div class=\"rpa-kanban-tasks-popup-desc\">\n\t\t\t\t\t\t\t${this.renderSubTitleResponsible([task])}\n\t\t\t\t\t\t\t<span class=\"rpa-kanban-tasks-popup-delete\" onclick=\"${this.deleteTaskHandler.bind(this, task)}\">${Loc.getMessage('RPA_KANBAN_COLUMN_DELETE_TASK_BTN')}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"rpa-kanban-tasks-popup-inner\" data-role=\"rpa-kanban-column-tasks-item\">\n\t\t\t\t<div class=\"rpa-kanban-tasks-popup-list\">\n\t\t\t\t\t${elements}\n\t\t\t\t</div>\n\t\t\t\t<a href=\"${this.buildAddRobotUrl()}\" class=\"rpa-kanban-tasks-popup-add\">${Loc.getMessage('RPA_KANBAN_COLUMN_ADD_TASK_BTN')}</a>\n\t\t\t</div>`;\n\t}\n\n\tdeleteTaskHandler(task, event)\n\t{\n\t\tMessageBox.show({\n\t\t\tmessage: Loc.getMessage('RPA_KANBAN_COLUMN_DELETE_TASK_CONFIRM'),\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tonOk: () => {\n\t\t\t\tif (this.getGrid().isProgress())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.getGrid().startProgress();\n\t\t\t\tconst promise = new BX.Promise();\n\t\t\t\tAjax.runAction('rpa.task.delete', {\n\t\t\t\t\tanalyticsLabel: 'rpaKanbanTaskDelete',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\ttypeId: this.getGrid().getData().typeId,\n\t\t\t\t\t\tstageId: this.getId(),\n\t\t\t\t\t\trobotName: task['robotName'],\n\t\t\t\t\t\teventId: this.getGrid().pullManager.registerRandomEventId(),\n\t\t\t\t\t},\n\t\t\t\t\tgetParameters: {\n\t\t\t\t\t\tcontext: 'kanban',\n\t\t\t\t\t}\n\t\t\t\t}).then(() =>\n\t\t\t\t{\n\t\t\t\t\tif(this.tasksPopup)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.tasksPopup.destroy();\n\t\t\t\t\t}\n\t\t\t\t\tthis.setTasks(this.getTasks().filter((filteredTask) =>\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (filteredTask.robotName !== task.robotName);\n\t\t\t\t\t}));\n\t\t\t\t\tthis.rerenderSubtitle();\n\t\t\t\t\tthis.getGrid().stopProgress();\n\t\t\t\t\tpromise.fulfill();\n\t\t\t\t}).catch((response) =>\n\t\t\t\t{\n\t\t\t\t\tthis.getGrid().stopProgress();\n\t\t\t\t\tpromise.reject();\n\t\t\t\t});\n\n\t\t\t\treturn promise;\n\t\t\t},\n\t\t\tpopupOptions: {\n\t\t\t\tzIndexAbsolute: 1200\n\t\t\t}\n\t\t});\n\t}\n\n\tbuildAddRobotUrl()\n\t{\n\t\tconst typeId = this.getGrid().getData().typeId;\n\t\tconst url = new Uri(`/rpa/automation/${typeId}/addrobot/`); //TODO use URI from urlManager\n\n\t\turl.setQueryParams({\n\t\t\tstage: this.getId()\n\t\t});\n\t\treturn url;\n\t}\n\tbuildEditRobotUrl(robotName)\n\t{\n\t\tconst typeId = this.getGrid().getData().typeId;\n\t\tconst url = new Uri(`/rpa/automation/${typeId}/editrobot/`); //TODO use URI from urlManager\n\n\t\turl.setQueryParams({\n\t\t\tstage: this.getId(),\n\t\t\trobotName\n\t\t});\n\t\treturn url;\n\t}\n\t//endregion\n\n\tgetFields(): Object\n\t{\n\t\tlet fields = this.getData().userFields;\n\t\tif(!fields || !Type.isPlainObject(fields))\n\t\t{\n\t\t\tfields = this.getGrid().getFields();\n\t\t}\n\t\tif(!fields || !Type.isPlainObject(fields))\n\t\t{\n\t\t\tfields = {};\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tgetPossibleNextStages()\n\t{\n\t\treturn this.getData().possibleNextStages;\n\t}\n\n\tgetSort()\n\t{\n\t\treturn parseInt(this.getData().sort);\n\t}\n\n\tisCanMoveFrom()\n\t{\n\t\treturn !!this.canMoveFrom;\n\t}\n\n\tcanMoveTo()\n\t{\n\t\tlet result = false;\n\t\tthis.getGrid().getColumns().forEach((column) =>\n\t\t{\n\t\t\tif(column.isCanMoveFrom() && column.getPossibleNextStages().includes(this.getId()))\n\t\t\t{\n\t\t\t\tresult = true;\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tupdate(data)\n\t{\n\t\tif(\n\t\t\tType.isPlainObject(data) &&\n\t\t\tdata.stage &&\n\t\t\tType.isPlainObject(data.stage) &&\n\t\t\tparseInt(data.stage.id) === this.getId()\n\t\t)\n\t\t{\n\t\t\tconst stageData = data.stage;\n\t\t\tthis.setName(stageData.name);\n\t\t\tthis.setColor(stageData.color);\n\t\t\tthis.setData(stageData);\n\t\t\tthis.processPermissions(stageData);\n\n\t\t\tthis.getGrid().moveColumn(this, this.getTargetColumn());\n\t\t\tthis.render();\n\n\t\t\tthis.getGrid().getColumns().forEach((column) =>\n\t\t\t{\n\t\t\t\tif(column !== this)\n\t\t\t\t{\n\t\t\t\t\tcolumn.processPermissions();\n\t\t\t\t\tcolumn.onAfterRender();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetTargetColumn()\n\t{\n\t\tconst columns = this.getGrid().getColumns();\n\t\tlet targetColumn = null;\n\t\tcolumns.forEach((gridColumn) =>\n\t\t{\n\t\t\tif(\n\t\t\t\tgridColumn.getId() !== this.getId() &&\n\t\t\t\tgridColumn.getSort() >= this.getSort() &&\n\t\t\t\t((!targetColumn) || (targetColumn.getSort() > gridColumn.getSort()))\n\t\t\t)\n\t\t\t{\n\t\t\t\ttargetColumn = gridColumn;\n\t\t\t}\n\t\t});\n\n\t\treturn targetColumn;\n\t}\n\n\tprocessPermissions()\n\t{\n\t\tthis.setPermissionProperties();\n\t\tthis.processDraggingOptions();\n\t}\n\n\tsetPermissionProperties()\n\t{\n\t\tconst data = this.getData();\n\t\tlet permissions = {};\n\t\tif(data.permissions && Type.isPlainObject(data.permissions))\n\t\t{\n\t\t\tpermissions = data.permissions;\n\t\t}\n\n\t\tObject.keys(permissions).forEach((name) =>\n\t\t{\n\t\t\tthis[name] = permissions[name];\n\t\t});\n\t}\n\n\tprocessDraggingOptions()\n\t{\n\t\tif(this.isDraggable())\n\t\t{\n\t\t\tthis.makeDraggable();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.disableDragging();\n\t\t}\n\t\tif(this.isDroppable())\n\t\t{\n\t\t\tthis.makeDroppable();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.disableDropping();\n\t\t}\n\n\t\tthis.getItems().forEach((item) =>\n\t\t{\n\t\t\titem.processPermissions();\n\t\t});\n\t}\n\n\tloadTasks(): Promise<null, null>\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getGrid().startProgress();\n\t\t\tAjax.runAction('rpa.stage.getTasks', {\n\t\t\t\tdata: {\n\t\t\t\t\tid: this.getId(),\n\t\t\t\t}\n\t\t\t}).then((response) =>\n\t\t\t{\n\t\t\t\tthis.getGrid().stopProgress();\n\t\t\t\tthis.setTasks(response.data.tasks);\n\t\t\t\tresolve();\n\t\t\t}).catch((response) =>\n\t\t\t{\n\t\t\t\tthis.getGrid().stopProgress().showErrorFromResponse(response);\n\t\t\t\treject();\n\t\t\t});\n\t\t});\n\t}\n\n\tgetTasks(): Array\n\t{\n\t\tif(!this.data)\n\t\t{\n\t\t\tthis.data = {};\n\t\t}\n\t\tif(!this.data.tasks || !Type.isArray(this.data.tasks))\n\t\t{\n\t\t\tthis.data.tasks = [];\n\t\t}\n\t\treturn Array.from(this.data.tasks);\n\t}\n\n\tsetTasks(tasks: Array): Column\n\t{\n\t\tif(!Type.isArray(tasks))\n\t\t{\n\t\t\ttasks = [];\n\t\t}\n\n\t\tthis.data.tasks = tasks;\n\n\t\treturn this;\n\t}\n\n\taddSelectButtonToEditor()\n\t{\n\t\tconst editor = this.getEditor();\n\t\tif(!editor)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet editorMainSection = this.getGrid().getEditorMainSection(editor);\n\t\tif(!editorMainSection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(editorMainSection._addChildButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\teditorMainSection.ensureButtonPanelCreated();\n\t\teditorMainSection._addChildButton = BX.create(\"span\",\n\t\t\t{\n\t\t\t\tprops: { className: \"ui-entity-editor-content-add-lnk\" },\n\t\t\t\ttext: BX.message(\"UI_ENTITY_EDITOR_SELECT_FIELD\"),\n\t\t\t\tevents: { click: BX.delegate(editorMainSection.onAddChildBtnClick, editorMainSection) }\n\t\t\t});\n\t\teditorMainSection.addButtonElement(editorMainSection._addChildButton, { position: \"left\" });\n\t}\n}","import {Kanban} from 'main.kanban';\nimport {ajax as Ajax, Dom, Type, Loc, Runtime, Tag, Text, Event} from 'main.core';\nimport {Manager} from 'rpa.manager';\nimport {PopupWindowManager, PopupWindow} from 'main.popup';\nimport Column from './column';\n\nexport default class Item extends Kanban.Item\n{\n\teditorResolve;\n\teditorReject;\n\tcurrentState = {};\n\n\tsetOptions(options: { droppable?: boolean; draggable?: boolean; countable?: boolean; visible?: boolean; data?: object })\n\t{\n\t\tsuper.setOptions(options);\n\t\tthis.setPermissionProperties();\n\t}\n\n\trender()\n\t{\n\t\tthis.layout.title = null;\n\t\tthis.renderDescription();\n\t\tthis.renderFieldsList();\n\t\tthis.renderShadow();\n\n\t\tif (!this.layout.content)\n\t\t{\n\t\t\tthis.layout.content = Tag.render`<div ondblclick=\"${this.onDoubleClick.bind(this)}\" class=\"rpa-kanban-item\"></div>`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.clean(this.layout.content);\n\t\t}\n\n\t\tif (this.layout.title)\n\t\t{\n\t\t\tthis.layout.content.appendChild(this.layout.title);\n\t\t}\n\t\tif (this.layout.fieldList)\n\t\t{\n\t\t\tthis.layout.content.appendChild(this.layout.fieldList);\n\t\t}\n\t\tif (this.layout.description)\n\t\t{\n\t\t\tthis.layout.content.appendChild(this.layout.description);\n\t\t}\n\n\t\tthis.layout.content.appendChild(this.renderShadow());\n\t\t//this.layout.content.appendChild(this.renderContact());\n\t\tthis.layout.description.appendChild(this.renderTasksParticipants());\n\t\tthis.layout.description.appendChild(this.renderTasksCounter());\n\n\t\tthis.layout.content.appendChild(BX.Tag.render`<div class=\"rpa-kanban-item-line\"></div>`);\n\t\tthis.layout.content.style.setProperty(\"--rpa-kanban-item-color\", \"#\" + this.getColumn().getColor());\n\n\t\tif(this.isDraggable())\n\t\t{\n\t\t\tthis.layout.content.style.backgroundColor = \"#fff\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.content.style.backgroundColor = \"#aaa\";\n\t\t}\n\n\t\tEvent.bindOnce(this.layout.content, \"animationend\", () => {\n\t\t\tBX.removeClass(this.layout.container, \"main-kanban-item-new\")\n\t\t});\n\n\t\treturn this.layout.content;\n\t}\n\n\tsetTasksParticipants(tasksFaces: {\n\t\tcompleted: [],\n\t\trunning: [],\n\t\tall: [],\n\t}): this\n\t{\n\t\tthis.data.tasksFaces = tasksFaces;\n\n\t\treturn this;\n\t}\n\n\tgetTasksCounter(): number\n\t{\n\t\treturn Text.toInteger(this.data.tasksCounter);\n\t}\n\n\tgetTasksParticipants()\n\t{\n\t\tconst userId = Text.toInteger(this.getData()['createdBy']);\n\t\tconst currentUserId = this.getGrid().getUserId();\n\t\tconst startedBy = this.getGrid().getUser(userId);\n\t\tconst faces = this.data.tasksFaces;\n\t\tconst completedById = faces.completed[0];\n\t\tconst waitingForId = faces.running.includes(currentUserId) ? currentUserId : faces.running[0];\n\t\tconst completedCnt = faces.completed.length;\n\t\tconst waitingForCnt = faces.running.length;\n\n\t\tlet completedBy = null;\n\t\tlet waitingFor = null;\n\n\t\tif (completedById)\n\t\t{\n\t\t\tcompletedBy = this.getGrid().getUser(Text.toInteger(completedById))\n\t\t}\n\t\tif (waitingForId)\n\t\t{\n\t\t\twaitingFor = this.getGrid().getUser(Text.toInteger(waitingForId))\n\t\t}\n\n\t\treturn {startedBy, completedBy, waitingFor, completedCnt, waitingForCnt};\n\t}\n\n\tsetTasksCounter(counter: number): Item\n\t{\n\t\tthis.data.tasksCounter = counter;\n\t\treturn this;\n\t}\n\n\tbindEditorEvents()\n\t{\n\t\tif(!this.isEditorEventsBinded)\n\t\t{\n\t\t\tthis.isEditorEventsBinded = true;\n\n\t\t\tBX.addCustomEvent(window, 'BX.UI.EntityEditorAjax:onSubmitFailure', this.onEditorErrors.bind(this));\n\t\t\tBX.addCustomEvent(window, 'BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit.bind(this));\n\t\t}\n\t}\n\n\tshowEditor(columnId: number): Promise<Object, Object>\n\t{\n\t\tDom.addClass(this.layout.container, 'main-kanban-item-waiting');\n\t\tthis.bindEditorEvents();\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tAjax.runAction('rpa.item.getEditor', {\n\t\t\t\tanalyticsLabel: 'rpaItemMovedMandatoryFieldsPopupOpen',\n\t\t\t\tdata: {\n\t\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\t\tid: this.getId(),\n\t\t\t\t\tstageId: columnId > 0 ? columnId : null,\n\t\t\t\t\teventId: this.getGrid().pullManager.registerRandomEventId(),\n\t\t\t\t}\n\t\t\t}).then((response) =>\n\t\t\t{\n\t\t\t\tconst popup = this.getPopup();\n\t\t\t\tif(popup)\n\t\t\t\t{\n\t\t\t\t\tRuntime.html(popup.getContentContainer(), response.data.html).then(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tpopup.show();\n\t\t\t\t\t\tthis.editorResolve = resolve;\n\t\t\t\t\t\tthis.editorReject = reject;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}).catch((response) =>\n\t\t\t{\n\t\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\t\treject(response.errors);\n\t\t\t});\n\t\t});\n\t}\n\n\tonEditorSaveClick()\n\t{\n\t\tconst editor = this.getEditor();\n\t\tif(!editor)\n\t\t{\n\t\t\tthis.getPopup().close();\n\t\t\tif(Type.isFunction(this.editorReject))\n\t\t\t{\n\t\t\t\tthis.editorReject('Editor not found');\n\t\t\t\tthis.editorResolve = null;\n\t\t\t\tthis.editorReject = null;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\teditor.save();\n\t\t}\n\t}\n\n\tonEditorCancelClick()\n\t{\n\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\tthis.getPopup().close();\n\t\tif(Type.isFunction(this.editorResolve))\n\t\t{\n\t\t\tthis.editorResolve({\n\t\t\t\tcancel: true,\n\t\t\t});\n\t\t\tthis.editorResolve = null;\n\t\t\tthis.editorReject = null;\n\t\t}\n\t}\n\n\tonEditorSubmit(entityData, response)\n\t{\n\t\tif(this.getPopup().isShown())\n\t\t{\n\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\tthis.getPopup().close();\n\t\t\tthis.setData(response.data.item);\n\t\t\tthis.saveCurrentState();\n\t\t\tthis.render();\n\t\t}\n\t}\n\n\tonEditorErrors(errors)\n\t{\n\t\tif(this.getPopup().isShown())\n\t\t{\n\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\tthis.getPopup().close();\n\n\t\t\tif(Type.isFunction(this.editorReject))\n\t\t\t{\n\t\t\t\tthis.editorReject({errors}, false);\n\t\t\t\tthis.editorResolve = null;\n\t\t\t\tthis.editorReject = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tgetPopup(): PopupWindow\n\t{\n\t\tconst popupId = 'rpa-kanban-item-popup-' + this.getId();\n\t\tlet popup = PopupWindowManager.getPopupById(popupId);\n\n\t\tif(!popup)\n\t\t{\n\t\t\tpopup = new PopupWindow(popupId, null, {\n\t\t\t\tzIndex: 200,\n\t\t\t\tclassName: \"\",\n\t\t\t\tautoHide: false,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcloseIcon: false,\n\t\t\t\twidth: 600,\n\t\t\t\toverlay: true,\n\t\t\t\tlightShadow: false,\n\t\t\t\tbuttons: this.getItemPopupButtons(),\n\t\t\t});\n\t\t}\n\n\t\treturn popup;\n\t}\n\n\tgetEditor()\n\t{\n\t\treturn Manager.getEditor(this.getTypeId(), parseInt(this.getId()));\n\t}\n\n\tgetItemPopupButtons(): Array\n\t{\n\t\treturn [\n\t\t\tnew BX.PopupWindowButton({\n\t\t\t\ttext : Loc.getMessage('RPA_KANBAN_POPUP_SAVE'),\n\t\t\t\tclassName : \"ui-btn ui-btn-md ui-btn-primary\",\n\t\t\t\tevents : {\n\t\t\t\t\tclick : this.onEditorSaveClick.bind(this),\n\t\t\t\t}\n\t\t\t}),\n\t\t\tnew BX.PopupWindowButton({\n\t\t\t\ttext : Loc.getMessage('RPA_KANBAN_POPUP_CANCEL'),\n\t\t\t\tclassName : \"ui-btn ui-btn-md\",\n\t\t\t\tevents : {\n\t\t\t\t\tclick : this.onEditorCancelClick.bind(this),\n\t\t\t\t}\n\t\t\t})\n\t\t];\n\t}\n\n\tshowTasks(): Promise<Object>\n\t{\n\t\tDom.addClass(this.layout.container, 'main-kanban-item-waiting');\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tManager.Instance.openTasks(this.getTypeId(), this.getId()).then((result) =>\n\t\t\t{\n\t\t\t\tresolve(result);\n\t\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\t});\n\t\t});\n\t}\n\n\tgetStageId(): number\n\t{\n\t\treturn Text.toInteger(this.getData().stageId);\n\t}\n\n\tsetStageId(stageId: number): Item\n\t{\n\t\tthis.data.stageId = stageId;\n\t\treturn this;\n\t}\n\n\tgetTypeId(): number\n\t{\n\t\treturn Text.toInteger(this.getData().typeId);\n\t}\n\n\tsaveCurrentState(): Item\n\t{\n\t\tconst column = this.getColumn();\n\t\tconst nextItem = column.getNextItemSibling(this);\n\t\tconst previousItem = column.getPreviousItemSibling(this);\n\t\tthis.data.stageId = this.getColumnId();\n\n\t\tthis.currentState.nextItemId = nextItem ? nextItem.getId() : 0;\n\t\tthis.currentState.previousItemId = previousItem ? previousItem.getId() : 0;\n\t\tthis.currentState.stageId = this.data.stageId;\n\n\t\treturn this;\n\t}\n\n\tsavePosition(): Promise<Object, Object>\n\t{\n\t\tconst data = {\n\t\t\tid: this.getId(),\n\t\t\ttypeId: this.getTypeId(),\n\t\t\tfields: {\n\t\t\t\tstageId: this.getStageId(),\n\t\t\t\tpreviousItemId: this.currentState.previousItemId || null,\n\t\t\t},\n\t\t\teventId: this.getGrid().pullManager.registerRandomEventId(),\n\t\t};\n\n\t\tDom.addClass(this.layout.container, 'main-kanban-item-waiting');\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tAjax.runAction('rpa.item.update', {\n\t\t\t\tanalyticsLabel: 'rpaItemMoved',\n\t\t\t\tdata: data\n\t\t\t}).then((response) =>\n\t\t\t{\n\t\t\t\tthis.data = response.data.item;\n\t\t\t\tif(!this.moveToActualColumn())\n\t\t\t\t{\n\t\t\t\t\tthis.render();\n\t\t\t\t}\n\t\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\t\tresolve(response);\n\t\t\t}).catch((response) =>\n\t\t\t{\n\t\t\t\treject(response);\n\t\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\t});\n\t\t});\n\t}\n\n\tmoveToActualColumn(): boolean\n\t{\n\t\tif(this.getStageId() !== this.getColumn().getId())\n\t\t{\n\t\t\tconst column = this.getGrid().getColumn(this.getStageId());\n\t\t\tif(column)\n\t\t\t{\n\t\t\t\tthis.getGrid().moveItem(this, column, column.getFirstItem());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getGrid().moveItem(this, this.getStageId());\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tsaveSort(): Promise<Object, Object>\n\t{\n\t\tconst data = {\n\t\t\tid: this.getId(),\n\t\t\ttypeId: this.getTypeId(),\n\t\t\tpreviousItemId: this.currentState.previousItemId,\n\t\t};\n\n\t\tDom.addClass(this.layout.container, 'main-kanban-item-waiting');\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tAjax.runAction('rpa.item.sort', {\n\t\t\t\tanalyticsLabel: 'rpaItemSorted',\n\t\t\t\tdata: data\n\t\t\t}).then((response) =>\n\t\t\t{\n\t\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\t\tresolve(response);\n\t\t\t}).catch((response) =>\n\t\t\t{\n\t\t\t\treject(response);\n\t\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\t});\n\t\t});\n\t}\n\n\tgetCurrentState(): Object\n\t{\n\t\treturn Object.assign({}, this.currentState);\n\t}\n\n\trestoreState(previousState): Item\n\t{\n\t\tthis.currentState = previousState;\n\t\tthis.data.stageId = this.currentState.stageId;\n\n\t\treturn this;\n\t}\n\n\tonDoubleClick()\n\t{\n\t\tif(this.data.detailUrl)\n\t\t{\n\t\t\tManager.openSlider(this.data.detailUrl);\n\t\t}\n\t}\n\n\tgetMovedBy(): number\n\t{\n\t\treturn Text.toInteger(this.getData().movedBy);\n\t}\n\n\tgetUpdatedBy(): number\n\t{\n\t\treturn Text.toInteger(this.getData().updatedBy);\n\t}\n\n\tgetCreatedBy(): number\n\t{\n\t\treturn Text.toInteger(this.getData().createdBy);\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.data.name;\n\t}\n\n\trenderTitle(title: string): Element\n\t{\n\t\tif (Type.isArray(title))\n\t\t{\n\t\t\ttitle = title[0];\n\t\t}\n\t\ttitle = Text.encode(title);\n\t\tlet href = 'javascript:void(0);';\n\t\tif(this.data.detailUrl)\n\t\t{\n\t\t\thref = this.data.detailUrl;\n\t\t}\n\t\tif (!this.layout.title)\n\t\t{\n\t\t\tthis.layout.title = Tag.render`<a class=\"rpa-kanban-item-title\" href=\"${href}\">${title}</a>`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.title.innerText = title;\n\t\t}\n\n\t\treturn this.layout.title;\n\t}\n\n\trenderFieldsList(): Element\n\t{\n\t\tif (!this.layout.fieldList)\n\t\t{\n\t\t\tthis.layout.fieldList = Tag.render`<div class=\"rpa-kanban-item-field-list\"></div>`;\n\t\t}\n\t\tthis.layout.fieldList.innerHTML = '';\n\n\t\tconst fields = this.getGrid().getFields();\n\t\tObject.keys(fields).forEach((fieldName) =>\n\t\t{\n\t\t\tif(fields[fieldName]['isVisibleOnKanban'] && !this.isEmptyValue(this.getData()[fieldName]))\n\t\t\t{\n\t\t\t\tif(fields[fieldName]['isTitle'])\n\t\t\t\t{\n\t\t\t\t\tthis.renderTitle(this.getData()[fieldName]);\n\t\t\t\t}\n\t\t\t\telse if(fieldName === 'createdBy' || fieldName === 'updatedBy' || fieldName === 'movedBy')\n\t\t\t\t{\n\t\t\t\t\tconst renderedUser = this.renderUser(fieldName);\n\t\t\t\t\tif(renderedUser)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.layout.fieldList.appendChild(Tag.render`\n\t\t\t\t\t\t\t<div class=\"rpa-kanban-item-field-item\">\n\t\t\t\t\t\t\t\t<span class=\"rpa-kanban-item-field-item-name\">${Text.encode(fields[fieldName].title)}</span>\n\t\t\t\t\t\t\t\t${renderedUser}\n\t\t\t\t\t\t\t</div>`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.layout.fieldList.appendChild(Tag.render`\n\t\t\t\t\t\t<div class=\"rpa-kanban-item-field-item\">\n\t\t\t\t\t\t\t<span class=\"rpa-kanban-item-field-item-name\">${Text.encode(fields[fieldName].title)}</span>\n\t\t\t\t\t\t\t<span class=\"rpa-kanban-item-field-item-value\">${this.getDisplayableValue(fieldName)}</span>\n\t\t\t\t\t\t</div>`\n\t\t\t\t\t);\n\n\t\t\t\t\t// field with link\n\t\t\t\t\t/*this.layout.fieldList.appendChild(Tag.render`\n\t\t\t\t\t\t<div class=\"rpa-kanban-item-field-item\">\n\t\t\t\t\t\t\t<span class=\"rpa-kanban-item-field-item-name\">Link</span>\n\t\t\t\t\t\t\t<a class=\"rpa-kanban-item-field-item-value-link\" href=\"#\">Bitrix Inc.</a>\n\t\t\t\t\t\t</div>`\n\t\t\t\t\t);*/\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this.layout.fieldList;\n\t}\n\n\trenderShadow(): Element\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"rpa-kanban-item-shadow\"></div>\n\t\t`;\n\t}\n\n\trenderDescription(): Element\n\t{\n\t\tthis.layout.description = Tag.render`\n\t\t\t<div class=\"rpa-kanban-item-description\"></div>\n\t\t`;\n\t}\n\n\trenderUserPhoto({\n\t\tlink,\n\t\tphoto,\n\t}): ?Element\n\t{\n\t\tif(Type.isString(link) && Type.isString(photo))\n\t\t{\n\t\t\treturn Tag.render`<a class=\"rpa-kanban-item-user-photo\" href=\"${Text.encode(link)}\" style=\"background-image: url(${Text.encode(photo)})\"></a>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenderUser(fieldName: string): ?Element\n\t{\n\t\tconst userId = Text.toInteger(this.getData()[fieldName]);\n\t\tconst userInfo = this.getGrid().getUser(userId);\n\n\t\tif(userInfo)\n\t\t{\n\t\t\tconst photo = this.renderUserPhoto(userInfo);\n\n\t\t\treturn Tag.render`<div class=\"rpa-kanban-item-user\">\n\t\t\t\t${(photo) ? photo : ''}\n\t\t\t\t<a class=\"rpa-kanban-item-user-name rpa-kanban-item-field-item-value\" href=\"${Text.encode(userInfo.link)}\">${Text.encode(userInfo.fullName)}</a>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenderContact(): Element\n\t{\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"rpa-kanban-item-contact\">\n\t\t\t\t\t<span class=\"rpa-kanban-item-contact-im\"></span>\n\t\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderTasksParticipants(): Element\n\t{\n\t\tconst {startedBy, completedBy, waitingFor, completedCnt, waitingForCnt} = this.getTasksParticipants();\n\t\tconst elements = [];\n\n\t\tif (startedBy)\n\t\t{\n\t\t\telements.push(this.renderTaskParticipant(startedBy));\n\t\t}\n\t\tif (completedBy)\n\t\t{\n\t\t\telements.push(this.renderTaskParticipant(completedBy, completedCnt > 1));\n\t\t}\n\t\tif (waitingFor)\n\t\t{\n\t\t\telements.push(this.renderTaskParticipant(waitingFor, waitingForCnt > 1));\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"rpa-kanban-column-task-responsible-list\">\n\t\t\t\t\t${elements}\n\t\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderTaskParticipant({link, photo, fullName}, isMore): Element\n\t{\n\t\treturn Tag.render`\n\t\t\t<a class=\"rpa-kanban-column-task-responsible-item ${isMore? 'rpa-kanban-column-task-responsible-item-more':''}\" \n\t\t\t href=\"${Text.encode(link)}\" title=\"${Text.encode(fullName)}\">\n\t\t\t\t<span class=\"rpa-kanban-column-task-responsible-img\" ${photo ? 'style=\"background-image: url(\\'' + Text.encode(encodeURI(photo)) + '\\')\"' : ''}>\t\n\t\t\t\t</span>\n\t\t\t</a>\n\t\t`;\n\t}\n\n\trenderTasksCounter(): Element\n\t{\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"rpa-kanban-item-counter\" onclick=\"${this.showTasks.bind(this)}\" ${(this.getTasksCounter() <= 0 ? 'style=\"display: none;\"' : '')}>\n\t\t\t\t\t<div class=\"rpa-kanban-item-counter-text\">${Loc.getMessage('RPA_KANBAN_TASKS')}</div>\n\t\t\t\t\t<div class=\"rpa-kanban-item-counter-value\">${this.getTasksCounter()}</div>\n\t\t\t\t</div>\n\t\t`;\n\t}\n\n\thasEmptyMandatoryFields(column: Column): boolean\n\t{\n\t\tlet result = false;\n\t\tif(!column)\n\t\t{\n\t\t\tcolumn = this.getStageId();\n\t\t}\n\t\tcolumn = this.getGrid().getColumn(column);\n\t\tif(!column)\n\t\t{\n\t\t\tthrow new Error(\"Column not found\");\n\t\t}\n\t\tconst fields = column.getFields();\n\t\tObject.keys(fields).forEach((fieldName) =>\n\t\t{\n\t\t\tif(fields[fieldName].mandatory && this.isEmptyValue(this.getData()[fieldName]))\n\t\t\t{\n\t\t\t\tresult = true;\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tisEmptyValue(value): boolean\n\t{\n\t\treturn (\n\t\t\tType.isNil(value) ||\n\t\t\tvalue === false ||\n\t\t\t((Type.isString(value) || Type.isArray(value)) && value.length <= 0) ||\n\t\t\t(Type.isNumber(value) && value === 0)\n\t\t);\n\t}\n\n\tupdate(data: Object): Item\n\t{\n\t\tif(\n\t\t\tType.isPlainObject(data) &&\n\t\t\tdata.item &&\n\t\t\tType.isPlainObject(data.item) &&\n\t\t\tparseInt(data.item.id) === this.getId()\n\t\t)\n\t\t{\n\t\t\tthis.data = data.item;\n\t\t\tthis.processPermissions();\n\t\t\tthis.render();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tprocessPermissions(): Item\n\t{\n\t\tthis.setPermissionProperties();\n\t\tthis.processDraggingOptions();\n\n\t\treturn this;\n\t}\n\n\tsetPermissionProperties(): Item\n\t{\n\t\tconst data = this.getData();\n\t\tlet permissions = {};\n\t\tif(data.permissions && Type.isPlainObject(data.permissions))\n\t\t{\n\t\t\tpermissions = data.permissions;\n\t\t}\n\n\t\tObject.keys(permissions).forEach((name) =>\n\t\t{\n\t\t\tthis[name] = permissions[name];\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tprocessDraggingOptions(): Item\n\t{\n\t\tif(this.isDraggable())\n\t\t{\n\t\t\tthis.makeDraggable();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.disableDragging();\n\t\t}\n\t\tthis.render();\n\n\t\treturn this;\n\t}\n\n\tgetDisplayableValue(fieldName: string): ?string\n\t{\n\t\tlet result = null;\n\t\tif(this.data.display && this.data.display[fieldName])\n\t\t{\n\t\t\tresult = this.data.display[fieldName];\n\t\t}\n\t\telse if(this.data[fieldName])\n\t\t{\n\t\t\tresult = this.data[fieldName];\n\t\t}\n\n\t\tif(Type.isArray(result))\n\t\t{\n\t\t\tresult = result.join(', ');\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tisDeletable(): boolean\n\t{\n\t\treturn (this.canDelete !== false);\n\t}\n}","import {Kanban} from 'main.kanban';\nimport {Type, ajax as Ajax, Loc, Text, Event} from 'main.core';\nimport 'ui.buttons';\nimport 'ui.notification';\nimport 'ui.fonts.opensans';\nimport {PullManager} from './pullmanager';\nimport Item from './item';\nimport Column from './column';\nimport {PopupWindowManager, PopupMenuWindow} from 'main.popup';\nimport {FieldsPopup} from 'rpa.fieldspopup';\n\nexport default class Grid extends Kanban.Grid\n{\n\tgetTypeId(): number\n\t{\n\t\treturn Text.toInteger(this.getData().typeId);\n\t}\n\n\tgetUserId(): number\n\t{\n\t\treturn Text.toInteger(this.getData().userId);\n\t}\n\n\tisCreateItemRestricted(): boolean\n\t{\n\t\treturn (this.getData().isCreateItemRestricted === true);\n\t}\n\n\tbindEvents()\n\t{\n\t\tBX.addCustomEvent(this, \"Kanban.DropZone:onBeforeItemCaptured\", this.onBeforeItemCaptured.bind(this));\n\t\tBX.addCustomEvent(this, \"Kanban.DropZone:onBeforeItemRestored\", this.onBeforeItemRestored.bind(this));\n\n\t\tBX.addCustomEvent(\"Kanban.Column:render\", (column) =>\n\t\t{\n\t\t\tif(column.getGrid() === this && column instanceof Column)\n\t\t\t{\n\t\t\t\tcolumn.onAfterRender.apply(column);\n\t\t\t}\n\t\t});\n\n\t\tBX.addCustomEvent(\"BX.Main.Filter:apply\", this.onApplyFilter.bind(this));\n\n\t\tBX.addCustomEvent(this, \"Kanban.Grid:onColumnLoadAsync\", (promises) =>\n\t\t{\n\t\t\tpromises.push((column) =>\n\t\t\t{\n\t\t\t\treturn this.getColumnItems(column);\n\t\t\t});\n\t\t});\n\t\tBX.addCustomEvent(this, \"Kanban.Grid:onBeforeItemMoved\", this.saveItemState);\n\t\tBX.addCustomEvent(this, \"Kanban.Grid:onItemMoved\", this.onItemMoved);\n\t\tBX.addCustomEvent(this, \"Kanban.Grid:onColumnUpdated\", this.onColumnUpdated);\n\t\tBX.addCustomEvent(this, \"Kanban.Grid:onColumnMoved\", this.onColumnMoved);\n\t\tBX.addCustomEvent(this, \"Kanban.Grid:onColumnAddedAsync\", (promises) =>\n\t\t{\n\t\t\tpromises.push((column) =>\n\t\t\t{\n\t\t\t\treturn this.addStage(column);\n\t\t\t});\n\t\t});\n\t\tBX.addCustomEvent(this, \"Kanban.Grid:onColumnRemovedAsync\", (promises) =>\n\t\t{\n\t\t\tpromises.push((column) =>\n\t\t\t{\n\t\t\t\treturn this.removeStage(column);\n\t\t\t});\n\t\t});\n\n\t\tBX.addCustomEvent(window, 'BX.UI.EntityEditorSection:onOpenChildMenu', this.onOpenSelectFieldMenu.bind(this));\n\n\t\tBX.addCustomEvent('SidePanel.Slider:onMessage', (message) => {\n\t\t\tif(message.getEventId() === 'userfield-list-update')\n\t\t\t{\n\t\t\t\tthis.onApplyFilter();\n\t\t\t}\n\t\t});\n\n\t\tthis.pullManager = new PullManager(this);\n\t}\n\n\tonBeforeItemCaptured(dropZoneEvent: BX.Kanban.DropZoneEvent)\n\t{\n\t\tEvent.EventEmitter.emit('BX.Rpa.Kanban.Grid:onBeforeItemCapturedStart', [this, dropZoneEvent]);\n\t\tconst item = dropZoneEvent.getItem();\n\t\tif(!(item instanceof Item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(!dropZoneEvent.isActionAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst dropZone = dropZoneEvent.getDropZone();\n\t\tif(dropZone.getId() === 'delete')\n\t\t{\n\t\t\tif(!item.isDeletable())\n\t\t\t{\n\t\t\t\tdropZoneEvent.denyAction();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(this.deleteCommand && !this.deleteCommand.isCompleted())\n\t\t\t{\n\t\t\t\tthis.deleteCommand.run();\n\t\t\t}\n\t\t\tthis.deleteCommand = new Command(item, (commandItem) =>\n\t\t\t{\n\t\t\t\tthis.deleteItem(commandItem);\n\t\t\t}, (commandItem) =>\n\t\t\t{\n\t\t\t\tthis.unhideItem(commandItem);\n\t\t\t});\n\t\t\tthis.deleteCommand.start(dropZone.getDropZoneArea().getDropZoneTimeout());\n\t\t}\n\t\telse if(dropZone.getData().isColumn === true)\n\t\t{\n\t\t\tdropZoneEvent.denyAction();\n\t\t\tconst targetColumn = this.getColumn(dropZone.getId());\n\t\t\tif(!targetColumn)\n\t\t\t{\n\t\t\t\titem.saveCurrentState();\n\t\t\t\tthis.hideItem(item);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.moveItem(item, targetColumn);\n\t\t\t}\n\t\t\tthis.moveItemToStage(item, dropZone.getId(), item.getColumn());\n\t\t}\n\t}\n\n\tonBeforeItemRestored(dropZoneEvent: BX.Kanban.DropZoneEvent)\n\t{\n\t\tconst item = dropZoneEvent.getItem();\n\t\tif(!(item instanceof Item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst dropZone = dropZoneEvent.getDropZone();\n\t\tif(dropZone.getId() === 'delete')\n\t\t{\n\t\t\tif(this.deleteCommand)\n\t\t\t{\n\t\t\t\tthis.deleteCommand.cancel();\n\t\t\t\tthis.deleteCommand = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tsaveItemState(dropEvent)\n\t{\n\t\tdropEvent.getItem().saveCurrentState();\n\t}\n\n\tgetFirstColumn(): ?Column\n\t{\n\t\tconst columns = this.getColumns();\n\t\tif(columns.length > 0)\n\t\t{\n\t\t\treturn columns[0];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tonItemMoved(item: Item, targetColumn: Column, beforeItem: Item, skipHandler)\n\t{\n\t\tconst itemPreviousState = item.getCurrentState();\n\t\t// moving in the same column\n\t\tif(parseInt(item.getStageId()) === parseInt(targetColumn.getId()))\n\t\t{\n\t\t\tif(\n\t\t\t\t(!beforeItem && item.getCurrentState().nextItemId === 0) ||\n\t\t\t\t(beforeItem && parseInt(beforeItem.getId()) === parseInt(item.getCurrentState().nextItemId))\n\t\t\t)\n\t\t\t{\n\t\t\t\t// skip moving on the same place\n\t\t\t\tthis.moveItem(item, item.getStageId(), item.getCurrentState().nextItemId);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// save sorting\n\t\t\titem.saveCurrentState().saveSort().catch((response) =>\n\t\t\t{\n\t\t\t\tthis.onItemMoveError(item, response, itemPreviousState);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\t// check permissions and next stage\n\t\tconst previousColumn = this.getColumn(item.getStageId());\n\t\t//const isPossibleNextStagesIncludesTargetColumn = previousColumn.getPossibleNextStages().includes(targetColumn.getId());\n\t\t//sorry but for now we do not check possible next stages\n\t\tconst isPossibleNextStagesIncludesTargetColumn = true;\n\t\t/*if(!isPossibleNextStagesIncludesTargetColumn && previousColumn.canMoveTo() && item.getMovedBy() === this.getUserId() && targetColumn.getPossibleNextStages().includes(previousColumn.getId()))\n\t\t{\n\t\t\t// item is moving back - no editor just moving\n\t\t\titem.saveCurrentState().savePosition().catch((response) =>\n\t\t\t{\n\t\t\t\tthis.onItemMoveError(item, response, itemPreviousState);\n\t\t\t});\n\t\t}\n\t\telse */if(previousColumn.isCanMoveFrom() && isPossibleNextStagesIncludesTargetColumn)\n\t\t{\n\t\t\tthis.moveItemToStage(item, targetColumn.getId(), previousColumn);\n\t\t}\n\t\telse if(!previousColumn.isCanMoveFrom() && isPossibleNextStagesIncludesTargetColumn)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('RPA_KANBAN_MOVE_PERMISSION_NOTIFY').replace('#STAGE#', Text.encode(previousColumn.getName()))\n\t\t\t});\n\t\t\tthis.moveItem(item, item.getStageId(), item.getCurrentState().nextItemId);\n\t\t}\n\t\telse if(previousColumn.isCanMoveFrom() && !isPossibleNextStagesIncludesTargetColumn)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('RPA_KANBAN_MOVE_WRONG_STAGE_NOTIFY').replace('#STAGE_FROM#', Text.encode(previousColumn.getName())).replace('#STAGE_TO#', Text.encode(targetColumn.getName()))\n\t\t\t});\n\t\t\tthis.moveItem(item, item.getStageId(), item.getCurrentState().nextItemId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('RPA_KANBAN_MOVE_ITEM_PERMISSION_NOTIFY').replace('#ITEM#', Text.encode(item.getName())).replace('#STAGE#', Text.encode(previousColumn.getName()))\n\t\t\t});\n\t\t\tthis.moveItem(item, item.getStageId(), item.getCurrentState().nextItemId);\n\t\t}\n\t}\n\n\tmoveItemToStage(item: Item, targetColumnId: number, previousColumn: Column)\n\t{\n\t\tconst itemPreviousState = item.getCurrentState();\n\t\tif(item.hasEmptyMandatoryFields(previousColumn))\n\t\t{\n\t\t\tif(!previousColumn.canAddItems())\n\t\t\t{\n\t\t\t\tthis.moveItem(item, item.getStageId(), item.getCurrentState().nextItemId);\n\t\t\t\tKanban.Utils.showErrorDialog(Loc.getMessage('RPA_KANBAN_MOVE_EMPTY_MANDATORY_FIELDS_ERROR'), false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\titem.showEditor(targetColumnId).then((response) =>\n\t\t\t{\n\t\t\t\tthis.onEditorSave(item, response);\n\t\t\t}).catch((response) =>\n\t\t\t{\n\t\t\t\tthis.onItemMoveError(item, response, itemPreviousState);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst targetColumn = this.getColumn(targetColumnId);\n\t\t\tif(targetColumn)\n\t\t\t{\n\t\t\t\titem.saveCurrentState();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titem.setStageId(targetColumnId);\n\t\t\t}\n\t\t\titem.savePosition().catch((response) =>\n\t\t\t{\n\t\t\t\tlet isShowEditor = false;\n\t\t\t\tlet isShowTasks = false;\n\t\t\t\tlet isTasksError = false;\n\t\t\t\tresponse.errors.forEach((error) =>\n\t\t\t\t{\n\t\t\t\t\tif(error.code && error.code === 'RPA_MANDATORY_FIELD_EMPTY')\n\t\t\t\t\t{\n\t\t\t\t\t\t// show editor in case we missed some empty mandatory field\n\t\t\t\t\t\tisShowEditor = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if(error.code && error.code === 'RPA_ITEM_USER_HAS_TASKS')\n\t\t\t\t\t{\n\t\t\t\t\t\tisShowTasks = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if(error.code && error.code === 'RPA_ITEM_TASKS_NOT_COMPLETED')\n\t\t\t\t\t{\n\t\t\t\t\t\tisTasksError = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif(isShowEditor)\n\t\t\t\t{\n\t\t\t\t\tif(!previousColumn.canAddItems())\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('RPA_KANBAN_MOVE_ITEM_PERMISSION_NOTIFY').replace('#ITEM#', Text.encode(item.getName())).replace('#STAGE#', Text.encode(previousColumn.getName()))\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.onItemMoveError(item, null, itemPreviousState);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\titem.showEditor(targetColumnId).then((response) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif(response.cancel === true)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onItemMoveError(item, null, itemPreviousState);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch((response) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onItemMoveError(item, response, itemPreviousState);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse if(isShowTasks)\n\t\t\t\t{\n\t\t\t\t\titem.showTasks().then((response) =>\n\t\t\t\t\t{\n\t\t\t\t\t\t// move back\n\t\t\t\t\t\tif(response.isCompleted !== true)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onItemMoveError(item, null, itemPreviousState);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem.update(response);\n\t\t\t\t\t\t\tif(!item.moveToActualColumn())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.render();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch((response) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onItemMoveError(item, response, itemPreviousState);\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse if(isTasksError)\n\t\t\t\t{\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('RPA_KANBAN_MOVE_ITEM_HAS_TASKS_ERROR')\n\t\t\t\t\t});\n\t\t\t\t\tthis.onItemMoveError(item, null, itemPreviousState);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.onItemMoveError(item, response, itemPreviousState);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tonItemMoveError(item: Item, response: Object = null, previousState: Object = null)\n\t{\n\t\tif(previousState)\n\t\t{\n\t\t\titem.restoreState(previousState);\n\t\t\tif(!item.isVisible())\n\t\t\t{\n\t\t\t\tthis.unhideItem(item);\n\t\t\t}\n\t\t\tthis.moveItem(item, item.getStageId(), item.getCurrentState().nextItemId);\n\t\t}\n\t\tif(response)\n\t\t{\n\t\t\tthis.showErrorFromResponse(response);\n\t\t}\n\t}\n\n\tonEditorSave(item: Item, response: Object)\n\t{\n\t\tif(response.cancel === true)\n\t\t{\n\t\t\tthis.moveItem(item, item.getStageId(), item.getCurrentState().nextItemId);\n\t\t}\n\t\telse\n\t\t{\n\n\t\t}\n\t}\n\n\tshowErrorFromResponse(response: Object, fatal = false)\n\t{\n\t\tlet errors = null;\n\t\tif(Type.isPlainObject(response) && response.errors && Type.isArray(response.errors))\n\t\t{\n\t\t\terrors = response.errors;\n\t\t}\n\t\telse if(Type.isArray(response))\n\t\t{\n\t\t\terrors = response;\n\t\t}\n\t\tlet message = '';\n\t\tif(Type.isArray(errors))\n\t\t{\n\t\t\terrors.forEach((error) =>\n\t\t\t{\n\t\t\t\tmessage += Text.encode(error.message) + \"\\n\";\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmessage = 'Unknown error';\n\t\t}\n\t\tKanban.Utils.showErrorDialog(message, fatal);\n\t}\n\n\tonColumnUpdated(column: Column)\n\t{\n\t\tthis.startProgress();\n\t\tAjax.runAction('rpa.stage.update', {\n\t\t\tanalyticsLabel: 'rpaKanbanStageUpdate',\n\t\t\tdata: {\n\t\t\t\tid: column.getId(),\n\t\t\t\tfields: {\n\t\t\t\t\tname: column.getName(),\n\t\t\t\t\tcolor: column.getColor(),\n\t\t\t\t},\n\t\t\t\teventId: this.pullManager.registerRandomEventId(),\n\t\t\t},\n\t\t\tgetParameters: {\n\t\t\t\tcontext: 'kanban',\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tcolumn.update(response.data);\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tthis.showErrorFromResponse(response, true);\n\t\t});\n\t}\n\n\taddStage(column: Column): BX.Promise\n\t{\n\t\tthis.startProgress();\n\t\tconst previousColumn = this.getPreviousColumnSibling(column);\n\t\tconst previousColumnId = previousColumn ? previousColumn.getId() : 0;\n\n\t\tconst promise = new BX.Promise();\n\t\tAjax.runAction('rpa.stage.add', {\n\t\t\tanalyticsLabel: 'rpaKanbanStageAdd',\n\t\t\tdata: {\n\t\t\t\tfields: {\n\t\t\t\t\tname: column.getName(),\n\t\t\t\t\tcolor: column.getColor(),\n\t\t\t\t\tpreviousStageId: previousColumnId,\n\t\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\t},\n\t\t\t\teventId: this.pullManager.registerRandomEventId(),\n\t\t\t},\n\t\t\tgetParameters: {\n\t\t\t\tcontext: 'kanban',\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tpromise.fulfill(this.transformColumnActionResponseToColumnOptions(response));\n\t\t\tthis.stopProgress();\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tconst error = response.errors.pop().message;\n\t\t\tpromise.reject(error);\n\t\t\tthis.stopProgress();\n\t\t});\n\n\t\treturn promise;\n\t}\n\n\tremoveStage(column: Column): BX.promise\n\t{\n\t\tconst promise = new BX.Promise();\n\t\tthis.startProgress();\n\t\tAjax.runAction('rpa.stage.delete', {\n\t\t\tanalyticsLabel: 'rpaKanbanStageDelete',\n\t\t\tdata: {\n\t\t\t\tid: column.getId(),\n\t\t\t},\n\t\t\tgetParameters: {\n\t\t\t\tcontext: 'kanban',\n\t\t\t}\n\t\t}).then(() =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tpromise.fulfill();\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tconst error = response.errors.pop().message;\n\t\t\tcolumn.enableDragging();\n\t\t\tcolumn.getContainer().classList.remove(\"main-kanban-column-edit-mode\");\n\t\t\tpromise.reject(error);\n\t\t});\n\n\t\treturn promise;\n\t}\n\n\tonColumnMoved(column: Column)\n\t{\n\t\tconst previousColumn = this.getPreviousColumnSibling(column);\n\t\tconst previousColumnId = previousColumn ? previousColumn.getId() : 0;\n\n\t\tAjax.runAction('rpa.stage.update', {\n\t\t\tanalyticsLabel: 'rpaKanbanStageMove',\n\t\t\tdata: {\n\t\t\t\tid: column.getId(),\n\t\t\t\tfields: {\n\t\t\t\t\tpreviousStageId: previousColumnId,\n\t\t\t\t},\n\t\t\t\teventId: this.pullManager.registerRandomEventId(),\n\t\t\t},\n\t\t\tgetParameters: {\n\t\t\t\tcontext: 'kanban',\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tconst wasFirst = column.isFirstColumn();\n\t\t\tlet isFirst = true;\n\t\t\tcolumn.update(response.data);\n\t\t\tif(column.isFirstColumn() && wasFirst)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(column.isFirstColumn() || wasFirst)\n\t\t\t{\n\t\t\t\tthis.getColumns().forEach((renderedColumn) =>\n\t\t\t\t{\n\t\t\t\t\tif(renderedColumn !== column)\n\t\t\t\t\t{\n\t\t\t\t\t\trenderedColumn.setIsFirstColumn((wasFirst && isFirst));\n\t\t\t\t\t\tisFirst = false;\n\t\t\t\t\t}\n\t\t\t\t\trenderedColumn.rerenderSubtitle();\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.getFirstColumn().rerenderSubtitle();\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.showErrorFromResponse(response, true);\n\t\t});\n\t}\n\n\ttransformColumnActionResponseToColumnOptions(response: Object): Object\n\t{\n\t\treturn {\n\t\t\tid: response.data.stage.id,\n\t\t\tname: response.data.stage.name,\n\t\t\tcolor: response.data.stage.color,\n\t\t\ttotal: response.data.stage.total,\n\t\t\tdata: response.data.stage,\n\t\t};\n\t}\n\n\tgetColumnItems(column: Column): BX.Promise\n\t{\n\t\tconst page = column.getPagination().page + 1;\n\t\tconst size = this.getData().pageSize;\n\t\tconst promise = new BX.Promise();\n\t\tAjax.runComponentAction('bitrix:rpa.kanban', 'getColumn', {\n\t\t\tmode: 'class',\n\t\t\tanalyticsLabel: 'rpaKanbanPagination',\n\t\t\tsignedParameters: this.getData().signedParameters,\n\t\t\tdata: {\n\t\t\t\tstageId: column.getId(),\n\t\t\t},\n\t\t\tnavigation: {page, size},\n\t\t}).then((response) =>\n\t\t{\n\t\t\tlet items = [];\n\t\t\tresponse.data.items.forEach((itemData) =>\n\t\t\t{\n\t\t\t\titems.push({\n\t\t\t\t\tid: itemData.id,\n\t\t\t\t\tcolumnId: itemData.stageId,\n\t\t\t\t\tname: itemData.name,\n\t\t\t\t\tdata: itemData,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tpromise.fulfill(items);\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tconst error = response.errors.pop().message;\n\t\t\tpromise.reject(error);\n\t\t});\n\n\t\treturn promise;\n\t}\n\n\tinsertItem(item: Item)\n\t{\n\t\tif(!(item instanceof Item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet beforeItem = null;\n\t\tconst newColumn = this.getColumn(item.getStageId());\n\t\tif(newColumn)\n\t\t{\n\t\t\tbeforeItem = newColumn.getFirstItem();\n\t\t\tthis.moveItem(item, item.getStageId(), beforeItem);\n\t\t\titem.processPermissions();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.removeItem(item);\n\t\t}\n\t}\n\n\tonApplyFilter(filterId, values, filterInstance, promise, params)\n\t{\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tparams.autoResolve = false;\n\t\t}\n\n\t\tthis.startProgress();\n\t\tAjax.runComponentAction('bitrix:rpa.kanban', 'get', {\n\t\t\tanalyticsLabel: 'rpaKanbanApplyFilter',\n\t\t\tsignedParameters: this.getData().signedParameters,\n\t\t\tmode: 'class',\n\t\t}).then((response) =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tthis.getColumns().forEach((column) =>\n\t\t\t{\n\t\t\t\tconst pagination = column.getPagination();\n\t\t\t\tif(pagination)\n\t\t\t\t{\n\t\t\t\t\tpagination.page = 1;\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.getColumns().forEach((column) =>\n\t\t\t{\n\t\t\t\tthis.removeColumn(column);\n\t\t\t});\n\t\t\tthis.removeItems();\n\t\t\tthis.loadData(response.data.kanban);\n\t\t\tif(!Type.isNil(promise))\n\t\t\t{\n\t\t\t\tpromise.fulfill();\n\t\t\t}\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tthis.showErrorFromResponse(response);\n\t\t\tif(!Type.isNil(promise))\n\t\t\t{\n\t\t\t\tpromise.reject();\n\t\t\t}\n\t\t});\n\t}\n\n\tloadData(json: {\n\t\tcolumns: Array<Column>;\n\t\titems: Array<Item>;\n\t\tdropZones: Array<Kanban.DropZone>;\n\t\tdata: {\n\t\t\tusers: ?Object\n\t\t}\n\t})\n\t{\n\t\tif(Type.isPlainObject(json.data))\n\t\t{\n\t\t\tthis.addUsers(json.data.users);\n\t\t\tthis.data.fields = json.data.fields;\n\t\t}\n\n\t\tsuper.loadData(json);\n\t}\n\n\taddUsers(users: Object)\n\t{\n\t\tif(Type.isPlainObject(users))\n\t\t{\n\t\t\tif(!this.users)\n\t\t\t{\n\t\t\t\tthis.users = new Map();\n\t\t\t}\n\t\t\tObject.keys(users).forEach((userId) =>\n\t\t\t{\n\t\t\t\tuserId = Text.toInteger(userId);\n\t\t\t\tif(userId > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.users.set(userId, users[userId]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetUser(userId: number): ?{\n\t\tid: number,\n\t\tfullName: ?string,\n\t\tlink: ?string,\n\t\tphoto: ?string\n\t}\n\t{\n\t\tif(!this.users)\n\t\t{\n\t\t\tthis.users = new Map();\n\t\t}\n\n\t\treturn this.users.get(userId);\n\t}\n\n\tgetFields(): Object\n\t{\n\t\tlet fields = this.getData().fields;\n\t\tif(!fields || !Type.isPlainObject(fields))\n\t\t{\n\t\t\tfields = {};\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tonOpenSelectFieldMenu(editor, params: Object)\n\t{\n\t\tparams.cancel = true;\n\n\t\tconst popupId = 'rpa-kanban-column-select-fields-menu-' + this.getTypeId();\n\t\tlet popup = PopupWindowManager.getPopupById(popupId);\n\t\tif(!popup)\n\t\t{\n\t\t\tpopup = new PopupMenuWindow({\n\t\t\t\tid: 'rpa-kanban-column-select-fields-menu-' + this.getTypeId(),\n\t\t\t\tbindElement: params.button,\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('RPA_KANBAN_FIELDS_VIEW_SETTINGS'),\n\t\t\t\t\t\tonclick: this.onSelectFieldsViewSettingsClick.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('RPA_KANBAN_FIELDS_MODIFY_SETTINGS'),\n\t\t\t\t\t\tonclick: this.onSelectFieldsModifySettingsClick.bind(this),\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcacheable: false,\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpopup.setBindElement(params.button);\n\t\t}\n\n\t\tpopup.show();\n\t}\n\n\tonSelectFieldsViewSettingsClick()\n\t{\n\t\tif(!this.canAddColumns())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst fields = this.getFields();\n\t\tconst data = [];\n\t\tObject.keys(fields).forEach((fieldName) =>\n\t\t{\n\t\t\tdata.push({\n\t\t\t\ttitle: fields[fieldName].title,\n\t\t\t\tname: fieldName,\n\t\t\t\tchecked: fields[fieldName].isVisibleOnKanban,\n\t\t\t});\n\t\t});\n\t\tconst fieldsPopup = new FieldsPopup('rpa-kanban-view-' + this.getTypeId(), data, Loc.getMessage('RPA_KANBAN_FIELDS_VIEW_SETTINGS'));\n\t\tfieldsPopup.show().then((result: Set|false) =>\n\t\t{\n\t\t\tif(result !== false)\n\t\t\t{\n\t\t\t\tif(this.isProgress())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.startProgress();\n\t\t\t\tAjax.runAction('rpa.fields.setVisibilitySettings', {\n\t\t\t\t\tanalyticsLabel: 'rpaKanbanSaveVisibleFields',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\t\t\tfields: Array.from(result),\n\t\t\t\t\t\tvisibility: 'kanban',\n\t\t\t\t\t}\n\t\t\t\t}).then((response) =>\n\t\t\t\t{\n\t\t\t\t\tthis.stopProgress();\n\t\t\t\t\tObject.keys(this.getFields()).forEach((fieldName) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.data.fields[fieldName]['isVisibleOnKanban'] = result.has(fieldName);\n\t\t\t\t\t});\n\t\t\t\t\tthis.getColumns().forEach((column) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tcolumn.getItems().forEach((item) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem.render();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}).catch((response) =>\n\t\t\t\t{\n\t\t\t\t\tthis.stopProgress();\n\t\t\t\t\tthis.showErrorFromResponse(response);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tonSelectFieldsModifySettingsClick()\n\t{\n\t\tif(!this.canAddColumns())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst firstColumn = this.getFirstColumn();\n\t\tif(!firstColumn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst editor = firstColumn.getEditor();\n\t\tif(!editor)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst fields = this.getFields();\n\t\tconst data = [];\n\t\tObject.keys(fields).forEach((fieldName) =>\n\t\t{\n\t\t\tif(fields[fieldName].canBeEdited)\n\t\t\t{\n\t\t\t\tdata.push({\n\t\t\t\t\ttitle: fields[fieldName].title,\n\t\t\t\t\tname: fieldName,\n\t\t\t\t\tchecked: !!editor.getControlById(fieldName),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tconst fieldsPopup = new FieldsPopup('rpa-kanban-edit-' + this.getTypeId(), data, Loc.getMessage('RPA_KANBAN_FIELDS_MODIFY_SETTINGS'));\n\t\tfieldsPopup.show().then((result) =>\n\t\t{\n\t\t\tif(!result)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(this.isProgress())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.startProgress();\n\t\t\tAjax.runAction('rpa.fields.setVisibilitySettings', {\n\t\t\t\tdata: {\n\t\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\t\tfields: Array.from(result),\n\t\t\t\t\tvisibility: 'create',\n\t\t\t\t},\n\t\t\t\tanalyticsLabel: 'rpaKanbanSaveCreateFields',\n\t\t\t}).then((response) =>\n\t\t\t{\n\t\t\t\tthis.stopProgress();\n\t\t\t\tthis.syncEditorFields(editor, result);\n\n\t\t\t}).catch((response) =>\n\t\t\t{\n\t\t\t\tthis.stopProgress();\n\t\t\t\tthis.showErrorFromResponse(response);\n\t\t\t});\n\t\t});\n\t}\n\n\tsyncEditorFields(editor: BX.UI.EntityEditor, availableFields: Set)\n\t{\n\t\tconst fields = this.getFields();\n\t\tconst editorMainSection = this.getEditorMainSection(editor);\n\t\tif(!editorMainSection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tObject.keys(fields).forEach((fieldName) =>\n\t\t{\n\t\t\tlet control = editor.getControlById(fieldName);\n\t\t\tif(control && !availableFields.has(fieldName))\n\t\t\t{\n\t\t\t\teditorMainSection.removeChild(control, { enableSaving: false });\n\t\t\t}\n\t\t\telse if(!control && availableFields.has(fieldName))\n\t\t\t{\n\t\t\t\tlet element = editor.getAvailableSchemeElementByName(fieldName);\n\t\t\t\tif(element)\n\t\t\t\t{\n\t\t\t\t\tlet field = editor.createControl(element.getType(), element.getName(), {\n\t\t\t\t\t\tschemeElement: element,\n\t\t\t\t\t\tmodel: editor._model,\n\t\t\t\t\t\tmode: editor._mode\n\t\t\t\t\t});\n\t\t\t\t\tif(field)\n\t\t\t\t\t{\n\t\t\t\t\t\teditorMainSection.addChild(\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlayout: { forceDisplay: true },\n\t\t\t\t\t\t\t\tenableSaving: false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tgetEditorMainSection(editor)\n\t{\n\t\tlet editorMainSection = editor.getControlById('main');\n\t\tif(editorMainSection instanceof BX.UI.EntityEditorColumn)\n\t\t{\n\t\t\teditorMainSection = editorMainSection.getChildById('main');\n\t\t}\n\n\t\treturn editorMainSection;\n\t}\n\n\tisProgress(): boolean\n\t{\n\t\treturn (this.progress === true);\n\t}\n\n\tstartProgress(): Grid\n\t{\n\t\tthis.progress = true;\n\t\tthis.showLoader().fadeOut();\n\n\t\treturn this;\n\t}\n\n\tstopProgress(): Grid\n\t{\n\t\tthis.progress = false;\n\t\tthis.hideLoader().fadeIn();\n\n\t\treturn this;\n\t}\n\n\tshowLoader(): Grid\n\t{\n\t\tthis.getLoader().style.display = 'block';\n\n\t\treturn this;\n\t}\n\n\thideLoader(): Grid\n\t{\n\t\tthis.getLoader().style.display = 'none';\n\n\t\treturn this;\n\t}\n\n\tdeleteItem(item: Item)\n\t{\n\t\tif(this.isProgress())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.startProgress();\n\t\tAjax.runAction('rpa.item.delete', {\n\t\t\tanalyticsLabel: 'rpaKanbanItemDelete',\n\t\t\tdata: {\n\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\tid: item.getId(),\n\t\t\t}\n\t\t}).then(() =>\n\t\t{\n\t\t\tif(this.getItem(item))\n\t\t\t{\n\t\t\t\titem.getColumn().removeItem(item);\n\t\t\t}\n\t\t\tthis.stopProgress();\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tthis.showErrorFromResponse(response);\n\t\t});\n\t}\n}\n\nclass Command\n{\n\tconstructor(item: Item, action: Function, restore: ?Function)\n\t{\n\t\tthis.item = item;\n\t\tthis.action = action;\n\t\tthis.restore = restore;\n\t\tthis.timeoutId = null;\n\t}\n\n\tstart(timeout: number)\n\t{\n\t\tthis.timeoutId = setTimeout(this.run.bind(this), timeout);\n\t}\n\n\trun()\n\t{\n\t\tclearTimeout(this.timeoutId);\n\t\tthis.timeoutId = null;\n\t\tif(Type.isFunction(this.action))\n\t\t{\n\t\t\tthis.action(this.item);\n\t\t}\n\t}\n\n\tcancel()\n\t{\n\t\tclearTimeout(this.timeoutId);\n\t\tthis.timeoutId = null;\n\t\tif(Type.isFunction(this.restore))\n\t\t{\n\t\t\tthis.restore(this.item);\n\t\t}\n\t}\n\n\tisCompleted(): boolean\n\t{\n\t\treturn (!(this.timeoutId > 0));\n\t}\n}","import 'ui.design-tokens';\n\nimport Grid from './grid';\nimport Item from './item';\nimport Column from './column';\n\nexport const Kanban = {\n\tGrid,\n\tItem,\n\tColumn,\n};"],"names":["PullManager","grid","eventIds","Set","RpaKanban","Grid","Type","isArray","getData","forEach","eventId","add","isString","pullTag","moduleId","userId","init","Text","getRandom","registerEventId","Event","ready","Pull","BX","PULL","console","error","subscribe","command","callback","params","eventName","has","indexOf","getTypeId","isPlainObject","item","onPullItemUpdated","onPullItemAdded","onPullItemDeleted","stage","onPullStageAdded","onPullStageUpdated","onPullStageDeleted","robot","onPullRobotAdded","onPullRobotUpdated","onPullRobotDeleted","onPullTypeUpdated","extendWatch","taskCountersPullTag","toInteger","typeId","onPullCounters","addUsers","users","getItem","id","setData","insertItem","column","getColumn","stageId","isCanMoveFrom","canAddItems","itemData","oldItem","Item","columnId","name","data","setGrid","items","getId","getStageId","addItem","getFirstItem","removeItem","onApplyFilter","update","removeColumn","onPullRobotChanged","robotName","setTasks","getTasks","filter","filteredTask","rerenderSubtitle","loadTasks","then","itemId","currentCounter","getTasksCounter","counter","setTasksCounter","tasksFaces","setTasksParticipants","render","Column","parseInt","options","canMoveFrom","setPermissionProperties","canMoveTo","isFirst","isDroppable","getContainer","style","backgroundColor","nodeNames","nodeName","Dom","clean","layout","subtitleNode","tasksPopup","destroy","renderSubTitle","subTitleNode","getSubTitleNode","isEditable","tasks","robotsCnt","length","appendChild","renderSubTitleTasks","isFirstColumn","renderSubTitleAddTaskButton","renderSubTitleAddButton","subTitleAddButton","remove","Tag","container","quickFormContainer","renderQuickFormContainer","itemsContainer","getItemsContainer","parentNode","prepend","handleAddItemButtonClick","bind","className","getGrid","canAddColumns","quickFormButtons","handleFormSaveButtonClick","Loc","getMessage","handleFormCancelButtonClick","isProgress","isCreateItemRestricted","Manager","Instance","showFeatureSlider","isFormVisible","startProgress","Ajax","runAction","analyticsLabel","pullManager","registerRandomEventId","response","stopProgress","Runtime","html","addSelectButtonToEditor","append","renderQuickFormButtons","showForm","bindKeyDownEvents","showErrorFromResponse","getBody","scrollTop","display","getEditor","editor","rollback","refreshLayout","hideForm","save","bindEditorEvents","entityData","errors","isEditorEventsBinded","addCustomEvent","window","onEditorErrors","onEditorSubmit","isKeyDownEventsBinded","onEnterKeyDown","event","code","isCtrlKey","unbind","subTitleSettingsButton","openSettings","url","settingsUrl","openSlider","slider","get","subTitleAddTaskButton","buildAddRobotUrl","subTitleTasks","renderSubTitleResponsible","renderSubTitleTasksButton","subTitleTasksButton","showTasks","showTaskListMenu","responsibleElements","plusHandler","task","user","getColor","photoSrc","encode","encodeURI","push","sliceResponsibleListElements","plusNode","canAppendResponsibles","Bizproc","UserSelector","decorateNode","isOnlyDialogMode","callbacks","select","addTaskUserHandler","buildEditRobotUrl","elements","slice","getTasksPopup","show","value","selector","userValue","getParameters","context","button","Popup","autoHide","draggable","offsetTop","offsetLeft","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","cacheable","angle","offset","position","events","onPopupDestroy","overlay","content","renderTasksPopup","map","deleteTaskHandler","MessageBox","message","buttons","MessageBoxButtons","OK_CANCEL","onOk","promise","Promise","fulfill","reject","popupOptions","zIndexAbsolute","Uri","setQueryParams","fields","userFields","getFields","possibleNextStages","sort","result","getColumns","getPossibleNextStages","includes","stageData","setName","setColor","color","processPermissions","moveColumn","getTargetColumn","onAfterRender","columns","targetColumn","gridColumn","getSort","processDraggingOptions","permissions","Object","keys","isDraggable","makeDraggable","disableDragging","makeDroppable","disableDropping","getItems","resolve","Array","from","editorMainSection","getEditorMainSection","_addChildButton","ensureButtonPanelCreated","create","props","text","click","delegate","onAddChildBtnClick","addButtonElement","Kanban","title","renderDescription","renderFieldsList","renderShadow","onDoubleClick","fieldList","description","renderTasksParticipants","renderTasksCounter","setProperty","bindOnce","removeClass","tasksCounter","currentUserId","getUserId","startedBy","getUser","faces","completedById","completed","waitingForId","running","completedCnt","waitingForCnt","completedBy","waitingFor","addClass","popup","getPopup","getContentContainer","editorResolve","editorReject","close","isFunction","cancel","isShown","saveCurrentState","popupId","PopupWindowManager","getPopupById","PopupWindow","zIndex","closeIcon","width","lightShadow","getItemPopupButtons","PopupWindowButton","onEditorSaveClick","onEditorCancelClick","openTasks","nextItem","getNextItemSibling","previousItem","getPreviousItemSibling","getColumnId","currentState","nextItemId","previousItemId","moveToActualColumn","moveItem","assign","previousState","detailUrl","movedBy","updatedBy","createdBy","href","innerText","innerHTML","fieldName","isEmptyValue","renderTitle","renderedUser","renderUser","getDisplayableValue","link","photo","userInfo","renderUserPhoto","fullName","getTasksParticipants","renderTaskParticipant","isMore","Error","mandatory","isNil","isNumber","join","canDelete","onBeforeItemCaptured","onBeforeItemRestored","apply","promises","getColumnItems","saveItemState","onItemMoved","onColumnUpdated","onColumnMoved","addStage","removeStage","onOpenSelectFieldMenu","getEventId","dropZoneEvent","EventEmitter","emit","isActionAllowed","dropZone","getDropZone","isDeletable","denyAction","deleteCommand","isCompleted","run","Command","commandItem","deleteItem","unhideItem","start","getDropZoneArea","getDropZoneTimeout","isColumn","hideItem","moveItemToStage","dropEvent","beforeItem","skipHandler","itemPreviousState","getCurrentState","saveSort","onItemMoveError","previousColumn","isPossibleNextStagesIncludesTargetColumn","UI","Notification","Center","notify","replace","getName","targetColumnId","hasEmptyMandatoryFields","Utils","showErrorDialog","showEditor","onEditorSave","setStageId","savePosition","isShowEditor","isShowTasks","isTasksError","restoreState","isVisible","fatal","getPreviousColumnSibling","previousColumnId","previousStageId","transformColumnActionResponseToColumnOptions","pop","enableDragging","classList","wasFirst","renderedColumn","setIsFirstColumn","getFirstColumn","total","page","getPagination","size","pageSize","runComponentAction","mode","signedParameters","navigation","newColumn","filterId","values","filterInstance","autoResolve","pagination","removeItems","loadData","kanban","json","Map","set","PopupMenuWindow","bindElement","onclick","onSelectFieldsViewSettingsClick","onSelectFieldsModifySettingsClick","setBindElement","checked","isVisibleOnKanban","fieldsPopup","FieldsPopup","visibility","firstColumn","canBeEdited","getControlById","syncEditorFields","availableFields","control","removeChild","enableSaving","element","getAvailableSchemeElementByName","field","createControl","getType","schemeElement","model","_model","_mode","addChild","forceDisplay","EntityEditorColumn","getChildById","progress","showLoader","fadeOut","hideLoader","fadeIn","getLoader","action","restore","timeoutId","timeout","setTimeout","clearTimeout"],"mappings":"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"}