{"version":3,"file":"kanban.bundle.js","sources":["../src/pullmanager.js","../src/column.js","../src/item.js","../src/grid.js","../src/kanban.js"],"sourcesContent":["import {Text, Event, Type} from 'main.core';\nimport {Kanban as RpaKanban} from 'rpa.kanban';\n\nexport class PullManager\n{\n\tgrid;\n\n\tconstructor(grid)\n\t{\n\t\tthis.eventIds = new Set();\n\t\tif(grid instanceof RpaKanban.Grid)\n\t\t{\n\t\t\tthis.grid = grid;\n\t\t\tif(Type.isArray(this.grid.getData().eventIds))\n\t\t\t{\n\t\t\t\tthis.grid.getData().eventIds.forEach((eventId) =>\n\t\t\t\t{\n\t\t\t\t\tthis.eventIds.add(eventId);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif(Type.isString(grid.getData().pullTag) && Type.isString(grid.getData().moduleId) && grid.getData().userId > 0)\n\t\t\t{\n\t\t\t\tthis.init();\n\t\t\t}\n\t\t}\n\t}\n\n\tregisterEventId(eventId: string)\n\t{\n\t\tthis.eventIds.add(eventId);\n\t}\n\n\tregisterRandomEventId(): string\n\t{\n\t\tconst eventId = Text.getRandom();\n\t\tthis.registerEventId(eventId);\n\t\treturn eventId;\n\t}\n\n\tinit()\n\t{\n\t\tEvent.ready(() =>\n\t\t{\n\t\t\tconst Pull = BX.PULL;\n\t\t\tif(!Pull)\n\t\t\t{\n\t\t\t\tconsole.error('pull is not initialized');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(Type.isString(this.grid.getData().pullTag))\n\t\t\t{\n\t\t\t\tPull.subscribe({\n\t\t\t\t\tmoduleId: this.grid.getData().moduleId,\n\t\t\t\t\tcommand: this.grid.getData().pullTag,\n\t\t\t\t\tcallback: (params) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif(Type.isString(params.eventName))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(Type.isString(params.eventId))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif(this.eventIds.has(params.eventId))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(params.eventName.indexOf('ITEMUPDATED' + this.grid.getTypeId()) === 0 && Type.isPlainObject(params.item))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullItemUpdated(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName === ('ITEMADDED' + this.grid.getTypeId()) && Type.isPlainObject(params.item))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullItemAdded(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName.indexOf('ITEMDELETED' + this.grid.getTypeId()) === 0 && Type.isPlainObject(params.item))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullItemDeleted(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName === ('STAGEADDED' + this.grid.getTypeId()) && Type.isPlainObject(params.stage))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullStageAdded(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName.indexOf('STAGEUPDATED' + this.grid.getTypeId()) === 0 && Type.isPlainObject(params.stage))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullStageUpdated(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName.indexOf('STAGEDELETED' + this.grid.getTypeId()) === 0 && Type.isPlainObject(params.stage))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullStageDeleted(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName === ('ROBOTADDED' + this.grid.getTypeId()) && Type.isPlainObject(params.robot))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullRobotAdded(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName.indexOf('ROBOTUPDATED' + this.grid.getTypeId()) === 0 && Type.isPlainObject(params.robot))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullRobotUpdated(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName.indexOf('ROBOTDELETED' + this.grid.getTypeId()) === 0 && Type.isPlainObject(params.robot))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullRobotDeleted(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(params.eventName.indexOf('TYPEUPDATED' + this.grid.getTypeId()) === 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onPullTypeUpdated();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tPull.extendWatch(this.grid.getData().pullTag);\n\t\t\t}\n\n\t\t\tif(Type.isString(this.grid.getData().taskCountersPullTag))\n\t\t\t{\n\t\t\t\tPull.subscribe({\n\t\t\t\t\tmoduleId: this.grid.getData().moduleId,\n\t\t\t\t\tcommand: this.grid.getData().taskCountersPullTag,\n\t\t\t\t\tcallback: (params) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif(Type.isString(params.eventId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(this.eventIds.has(params.eventId))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(this.grid.getTypeId() === Text.toInteger(params.typeId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onPullCounters(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tPull.extendWatch(this.grid.getData().taskCountersPullTag);\n\t\t\t}\n\t\t});\n\t}\n\n\tonPullItemUpdated(params)\n\t{\n\t\tthis.grid.addUsers(params.item.users);\n\t\tconst item = this.grid.getItem(params.item.id);\n\t\tif(item)\n\t\t{\n\t\t\titem.setData(params.item);\n\t\t\tthis.grid.insertItem(item);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst column = this.grid.getColumn(params.item.stageId);\n\t\t\tif(column && (column.isCanMoveFrom() || column.canAddItems()))\n\t\t\t{\n\t\t\t\tthis.onPullItemAdded(params);\n\t\t\t}\n\t\t}\n\t}\n\n\tonPullItemAdded(params)\n\t{\n\t\tconst itemData = params.item;\n\t\tthis.grid.addUsers(itemData.users);\n\n\t\tconst oldItem = this.grid.getItem(itemData.id);\n\t\tif(oldItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst item = new RpaKanban.Item({\n\t\t\tid: itemData.id,\n\t\t\tcolumnId: itemData.stageId,\n\t\t\tname: itemData.name,\n\t\t\tdata: itemData,\n\t\t});\n\t\titem.setGrid(this.grid);\n\t\tthis.grid.items[item.getId()] = item;\n\n\t\tconst column = this.grid.getColumn(item.getStageId());\n\t\tif(\n\t\t\tcolumn\n\t\t\t//&& this.grid.getFirstColumn() !== column\n\t\t\t&& (column.isCanMoveFrom() || column.canAddItems()))\n\t\t{\n\t\t\tcolumn.addItem(item, column.getFirstItem());\n\t\t}\n\t}\n\n\tonPullItemDeleted(params: Object)\n\t{\n\t\tif(!Type.isPlainObject(params.item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.grid.removeItem(params.item.id);\n\t}\n\n\tonPullStageAdded(params)\n\t{\n\t\tthis.grid.onApplyFilter();\n\t}\n\n\tonPullStageUpdated(params)\n\t{\n\t\tconst column = this.grid.getColumn(params.stage.id);\n\t\tif(column)\n\t\t{\n\t\t\tcolumn.update(params);\n\t\t}\n\t}\n\n\tonPullStageDeleted(params)\n\t{\n\t\tthis.grid.removeColumn(params.stage.id);\n\t}\n\n\tonPullRobotAdded(params: Object)\n\t{\n\t\tthis.onPullRobotChanged(params.robot.stageId);\n\t}\n\n\tonPullRobotUpdated(params: Object)\n\t{\n\t\tthis.onPullRobotChanged(params.robot.stageId);\n\t}\n\n\tonPullRobotDeleted(params: Object)\n\t{\n\t\tif(Type.isPlainObject(params.robot) && Type.isString(params.robot.robotName))\n\t\t{\n\t\t\tconst column = this.grid.getColumn(params.robot.stageId);\n\t\t\tif(column)\n\t\t\t{\n\t\t\t\tcolumn.setTasks(column.getTasks().filter((filteredTask) =>\n\t\t\t\t{\n\t\t\t\t\treturn (filteredTask.robotName !== params.robot.robotName);\n\t\t\t\t}));\n\t\t\t\tcolumn.rerenderSubtitle();\n\t\t\t}\n\t\t}\n\t}\n\n\tonPullRobotChanged(stageId: number)\n\t{\n\t\tconst column = this.grid.getColumn(stageId);\n\t\tif(column)\n\t\t{\n\t\t\tcolumn.loadTasks().then(() =>\n\t\t\t{\n\t\t\t\tcolumn.rerenderSubtitle();\n\t\t\t}).catch(() =>\n\t\t\t{\n\n\t\t\t});\n\t\t}\n\t}\n\n\tonPullCounters(params: {\n\t\ttypeId: number,\n\t\titemId: number,\n\t\tcounter: string,\n\t\ttasksFaces: ?{\n\t\t\tcompleted: [],\n\t\t\trunning: [],\n\t\t\tall: [],\n\t\t},\n\t})\n\t{\n\t\tlet typeId = Text.toInteger(params.typeId);\n\t\tlet itemId = Text.toInteger(params.itemId);\n\t\tif(typeId !== this.grid.getTypeId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst item = this.grid.getItem(itemId);\n\t\tif(item)\n\t\t{\n\t\t\tlet currentCounter = item.getTasksCounter();\n\t\t\tif(params.counter === '+1')\n\t\t\t{\n\t\t\t\tcurrentCounter++;\n\t\t\t}\n\t\t\telse if(params.counter === '-1')\n\t\t\t{\n\t\t\t\tcurrentCounter--;\n\t\t\t}\n\t\t\titem.setTasksCounter(currentCounter);\n\t\t\tif(Type.isPlainObject(params.tasksFaces))\n\t\t\t{\n\t\t\t\titem.setTasksParticipants(params.tasksFaces);\n\t\t\t}\n\t\t\titem.render();\n\t\t}\n\t}\n\n\tonPullTypeUpdated()\n\t{\n\t\tthis.grid.onApplyFilter();\n\t}\n}","import {Kanban} from 'main.kanban';\nimport {Kanban as RpaKanban} from 'rpa.kanban';\nimport {Tag, Uri, Type, ajax as Ajax, Runtime, Loc, Dom, Event, Text} from 'main.core';\nimport {Manager} from 'rpa.manager';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\n\nimport {Popup} from 'main.popup';\n\nexport default class Column extends Kanban.Column\n{\n\tcanMoveFrom;\n\n\tgetId()\n\t{\n\t\treturn parseInt(super.getId());\n\t}\n\n\tsetOptions(options)\n\t{\n\t\tsuper.setOptions(options);\n\t\tthis.canMoveFrom = !!options.canMoveFrom;\n\t\tthis.setPermissionProperties();\n\t}\n\n\tisDroppable(): boolean\n\t{\n\t\treturn super.isDroppable() || this.canMoveTo();\n\t}\n\n\tisFirstColumn()\n\t{\n\t\treturn (this.data.isFirst === true);\n\t}\n\n\tsetIsFirstColumn(isFirst: boolean = false): Column\n\t{\n\t\tthis.data.isFirst = isFirst;\n\n\t\treturn this;\n\t}\n\n\tonAfterRender()\n\t{\n\t\tif(!this.isDroppable())\n\t\t{\n\t\t\tthis.getContainer().style.backgroundColor = 'rgba(204, 204, 204, 0.2)';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getContainer().style.backgroundColor = 'transparent';\n\t\t}\n\t}\n\n\trerenderSubtitle()\n\t{\n\t\tconst nodeNames = [\n\t\t\t'responsible',\n\t\t\t'subTitleTasksButton',\n\t\t\t'subTitleTasks',\n\t\t\t'subTitleAddTaskButton',\n\t\t\t'subTitleSettingsButton',\n\t\t\t'subTitleAddButton',\n\t\t];\n\t\tnodeNames.forEach((nodeName) =>\n\t\t{\n\t\t\tDom.clean(this.layout[nodeName]);\n\t\t\tthis.layout[nodeName] = null;\n\t\t});\n\t\tDom.clean(this.layout.subtitleNode);\n\t\tif(this.tasksPopup)\n\t\t{\n\t\t\tthis.tasksPopup.destroy();\n\t\t}\n\t\tthis.renderSubTitle();\n\t}\n\n\trenderSubTitle(): HTMLElement\n\t{\n\t\tconst subTitleNode = this.getSubTitleNode();\n\t\tif(this.isEditable())\n\t\t{\n\t\t\tconst tasks = this.getTasks();\n\t\t\tconst robotsCnt = this.getData()['robotsCount'];\n\t\t\tif (tasks && tasks.length > 0)\n\t\t\t{\n\t\t\t\tsubTitleNode.appendChild(this.renderSubTitleTasks(tasks));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!this.isFirstColumn() || this.isFirstColumn() && !robotsCnt)\n\t\t\t\t{\n\t\t\t\t\tsubTitleNode.appendChild(this.renderSubTitleAddTaskButton());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(this.isFirstColumn() && this.canAddItems())\n\t\t{\n\t\t\tsubTitleNode.appendChild(this.renderSubTitleAddButton());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(this.layout.subTitleAddButton)\n\t\t\t{\n\t\t\t\tDom.remove(this.layout.subTitleAddButton);\n\t\t\t\tthis.layout.subTitleAddButton = null;\n\t\t\t}\n\t\t}\n\n\t\treturn subTitleNode;\n\t}\n\n\tgetSubTitleNode()\n\t{\n\t\tif(!this.layout.subtitleNode)\n\t\t{\n\t\t\tthis.layout.subtitleNode = Tag.render`<div class=\"main-kanban-column-subtitle-box\"></div>`;\n\t\t}\n\n\t\treturn this.layout.subtitleNode;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\tconst container = super.getContainer();\n\n\t\tif(this.isFirstColumn() && this.canAddItems())\n\t\t{\n\t\t\tconst quickFormContainer = this.renderQuickFormContainer();\n\t\t\tconst itemsContainer = this.getItemsContainer();\n\t\t\tif(quickFormContainer && itemsContainer)\n\t\t\t{\n\t\t\t\tif(quickFormContainer.parentNode !== itemsContainer)\n\t\t\t\t{\n\t\t\t\t\tDom.prepend(quickFormContainer, itemsContainer);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn container;\n\t}\n\n\t//region quick form\n\trenderSubTitleAddButton()\n\t{\n\t\tif(!this.layout.subTitleAddButton)\n\t\t{\n\t\t\tthis.layout.subTitleAddButton = Tag.render`<div class=\"main-kanban-column-add-item-button\" onclick=\"${this.handleAddItemButtonClick.bind(this)}\"></div>`\n\t\t}\n\n\t\treturn this.layout.subTitleAddButton;\n\t}\n\n\trenderQuickFormContainer()\n\t{\n\t\tif(!this.layout.quickFormContainer)\n\t\t{\n\t\t\tlet className = 'rpa-kanban-form';\n\t\t\tif(this.getGrid().canAddColumns())\n\t\t\t{\n\t\t\t\tclassName += ' rpa-kanban-form-with-settings';\n\t\t\t}\n\t\t\tthis.layout.quickFormContainer = Tag.render`<div class=\"${className}\"></div>`\n\t\t}\n\n\t\treturn this.layout.quickFormContainer;\n\t}\n\n \trenderQuickFormButtons()\n\t{\n\t\tif(!this.layout.quickFormButtons)\n\t\t{\n\t\t\tthis.layout.quickFormButtons = Tag.render`<div class=\"rpa-kanban-form-buttons\">\n\t\t\t\t<button class=\"ui-btn ui-btn-sm ui-btn-primary\" onclick=\"${this.handleFormSaveButtonClick.bind(this)}\">${Loc.getMessage('RPA_KANBAN_QUICK_FORM_SAVE_BUTTON')}</button>\n\t\t\t\t<button class=\"ui-btn ui-btn-sm ui-btn-link\" onclick=\"${this.handleFormCancelButtonClick.bind(this)}\">${Loc.getMessage('RPA_KANBAN_QUICK_FORM_CANCEL_BUTTON')}</button>\n\t\t\t</div>`\n\t\t}\n\n\t\treturn this.layout.quickFormButtons;\n\t}\n\n\thandleAddItemButtonClick()\n\t{\n\t\tif(this.getGrid().isProgress())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(this.getGrid().isCreateItemRestricted())\n\t\t{\n\t\t\tManager.Instance.showFeatureSlider();\n\t\t\treturn;\n\t\t}\n\t\tif(this.isFormVisible())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.getGrid().startProgress();\n\t\tAjax.runAction('rpa.item.getEditor', {\n\t\t\tanalyticsLabel: 'rpaItemOpenQuickForm',\n\t\t\tdata: {\n\t\t\t\ttypeId: this.getGrid().getTypeId(),\n\t\t\t\tid: 0,\n\t\t\t\tstageId: this.getId(),\n\t\t\t\teventId: this.getGrid().pullManager.registerRandomEventId(),\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tthis.getGrid().stopProgress();\n\t\t\tRuntime.html(this.layout.quickFormContainer, response.data.html).then(() =>\n\t\t\t{\n\t\t\t\tthis.addSelectButtonToEditor();\n\t\t\t\tDom.append(this.renderQuickFormButtons(), this.layout.quickFormContainer);\n\t\t\t\tthis.showForm();\n\t\t\t\tthis.bindKeyDownEvents();\n\t\t\t});\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.getGrid().stopProgress();\n\t\t\tthis.getGrid().showErrorFromResponse(response);\n\t\t});\n\t}\n\n\tshowForm()\n\t{\n\t\tthis.getBody().scrollTop = 0;\n\t\tthis.layout.quickFormContainer.style.display = 'block';\n\t\tthis.layout.quickFormButtons.style.display = 'block';\n\t}\n\n\thideForm()\n\t{\n\t\tthis.layout.quickFormContainer.style.display = 'none';\n\t\tthis.layout.quickFormButtons.style.display = 'none';\n\t}\n\n\tisFormVisible()\n\t{\n\t\treturn (\n\t\t\tthis.layout.quickFormContainer.style.display === 'block' &&\n\t\t\tthis.layout.quickFormButtons.style.display === 'block'\n\t\t);\n\t}\n\n\tgetEditor()\n\t{\n\t\treturn Manager.getEditor(this.getGrid().getTypeId(), 0);\n\t}\n\n\thandleFormCancelButtonClick()\n\t{\n\t\tconst editor = this.getEditor();\n\t\tif(editor)\n\t\t{\n\t\t\teditor.rollback();\n\t\t\teditor.refreshLayout();\n\t\t}\n\t\tthis.hideForm();\n\t}\n\n\thandleFormSaveButtonClick()\n\t{\n\t\tconst editor = this.getEditor();\n\t\tif(editor)\n\t\t{\n\t\t\teditor.save();\n\t\t\tthis.bindEditorEvents();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideForm();\n\t\t}\n\t}\n\n\tonEditorSubmit(entityData, response)\n\t{\n\t\tif(this.isFormVisible())\n\t\t{\n\t\t\tthis.hideForm();\n\t\t\tconst itemData = response.data.item;\n\t\t\tthis.getGrid().addUsers(response.data.item.users);\n\n\t\t\tconst oldItem = this.getGrid().getItem(itemData.id);\n\t\t\tif(oldItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst item = new RpaKanban.Item({\n\t\t\t\tid: itemData.id,\n\t\t\t\tcolumnId: itemData.stageId,\n\t\t\t\tname: itemData.name,\n\t\t\t\tdata: itemData,\n\t\t\t});\n\t\t\titem.setGrid(this.getGrid());\n\t\t\tthis.getGrid().items[item.getId()] = item;\n\n\t\t\tconst column = this.getGrid().getColumn(item.getStageId());\n\t\t\tif(column)\n\t\t\t{\n\t\t\t\tcolumn.addItem(item, column.getFirstItem());\n\t\t\t}\n\t\t}\n\t}\n\n\tonEditorErrors(errors)\n\t{\n\t\tif(this.isFormVisible())\n\t\t{\n\t\t\tthis.hideForm();\n\n\t\t\tthis.getGrid().showErrorFromResponse(errors);\n\t\t}\n\t}\n\n\tbindEditorEvents()\n\t{\n\t\tif(!this.isEditorEventsBinded)\n\t\t{\n\t\t\tthis.isEditorEventsBinded = true;\n\n\t\t\tBX.addCustomEvent(window, 'BX.UI.EntityEditorAjax:onSubmitFailure', this.onEditorErrors.bind(this));\n\t\t\tBX.addCustomEvent(window, 'BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit.bind(this));\n\t\t}\n\t}\n\n\tbindKeyDownEvents()\n\t{\n\t\tif(!this.isKeyDownEventsBinded)\n\t\t{\n\t\t\tthis.isKeyDownEventsBinded = true;\n\n\t\t\tconst onEnterKeyDown = (event) =>\n\t\t\t{\n\t\t\t\tif(\n\t\t\t\t\t(event.code === 'Enter' || event.code === 'NumpadEnter') &&\n\t\t\t\t\tthis.isFormVisible()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.handleFormSaveButtonClick();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst isCtrlKey = function(code: string)\n\t\t\t{\n\t\t\t\treturn (\n\t\t\t\t\tcode === 'MetaRight' ||\n\t\t\t\t\tcode === 'MetaLeft' ||\n\t\t\t\t\tcode === 'ControlRight' ||\n\t\t\t\t\tcode === 'ControlLeft'\n\t\t\t\t);\n\t\t\t};\n\n\t\t\tEvent.bind(window, 'keydown', (event) =>\n\t\t\t{\n\t\t\t\tif(isCtrlKey(event.code))\n\t\t\t\t{\n\t\t\t\t\tEvent.bind(window, 'keydown', onEnterKeyDown);\n\t\t\t\t}\n\t\t\t\telse if(event.code === 'Escape')\n\t\t\t\t{\n\t\t\t\t\tthis.handleFormCancelButtonClick();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tEvent.bind(window, 'keyup', (event) =>\n\t\t\t{\n\t\t\t\tif(isCtrlKey(event.code))\n\t\t\t\t{\n\t\t\t\t\tEvent.unbind(window, 'keydown', onEnterKeyDown);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t//endregion\n\n\t//region settings\n\trenderSubTitleSettingsButton()\n\t{\n\t\tif(!this.layout.subTitleSettingsButton)\n\t\t{\n\t\t\tthis.layout.subTitleSettingsButton = Tag.render`\n\t\t\t<div class=\"main-kanban-column-settings-button\" onclick=\"${this.openSettings.bind(this)}\">\n\t\t\t\t<button class=\"ui-btn ui-btn-xs ui-btn-link ui-btn-icon-setting\"></button>\n\t\t\t</div>`\n\t\t}\n\n\t\treturn this.layout.subTitleSettingsButton;\n\t}\n\n\topenSettings()\n\t{\n\t\tconst url = this.data.settingsUrl;\n\t\tif(url)\n\t\t{\n\t\t\tManager.openSlider(url).then((slider) =>\n\t\t\t{\n\t\t\t\tconst response = slider.getData().get('response');\n\t\t\t\tif(response)\n\t\t\t\t{\n\t\t\t\t\tthis.update(response.data);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\t//endregion\n\n\t//region task\n\trenderSubTitleAddTaskButton()\n\t{\n\t\tif(!this.layout.subTitleAddTaskButton)\n\t\t{\n\t\t\tconst url = this.buildAddRobotUrl();\n\t\t\tthis.layout.subTitleAddTaskButton =\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"main-kanban-column-settings-button\">\n\t\t\t\t\t\t<a class=\"ui-btn ui-btn-xs ui-btn-light-border ui-btn-no-caps ui-btn-round ui-btn-themes main-kanban-column-settings-button-rpa\" href=\"${url}\">\n\t\t\t\t\t\t\t${Loc.getMessage('RPA_KANBAN_COLUMN_ADD_TASK_BTN')}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.subTitleAddTaskButton;\n\t}\n\n\trenderSubTitleTasks(tasks): Element\n\t{\n\t\tif(!this.layout.subTitleTasks)\n\t\t{\n\t\t\tthis.layout.subTitleTasks =\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"rpa-kanban-column-task-block\">\n\t\t\t\t\t\t<div class=\"rpa-kanban-column-task-inner\">\n\t\t\t\t\t\t\t${this.renderSubTitleResponsible(tasks, true)}\n\t\t\t\t\t\t\t${this.renderSubTitleTasksButton(tasks)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.subTitleTasks;\n\t}\n\n\trenderSubTitleTasksButton(tasks): Element\n\t{\n\t\tif(!this.layout.subTitleTasksButton)\n\t\t{\n\t\t\tthis.layout.subTitleTasksButton =\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"rpa-kanban-column-task-btn\" onclick=\"${this.showTasks.bind(this, tasks)}\">\n\t\t\t\t\t\t<span class=\"rpa-kanban-column-task-btn-title\">${Loc.getMessage('RPA_KANBAN_TASKS')}</span>\n\t\t\t\t\t\t<span class=\"rpa-kanban-column-task-btn-counter\">${tasks.length}</span>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.subTitleTasksButton;\n\t}\n\n\trenderSubTitleResponsible(tasks, showTaskListMenu): Element\n\t{\n\t\tlet responsibleElements = [];\n\t\tconst plusHandler = this.showTasks.bind(this, tasks);\n\n\t\ttasks.forEach((task) => {\n\t\t\ttask.users.forEach((user) => {\n\t\t\t\tlet style = 'border-color: #' + this.getColor() + ';';\n\t\t\t\tif (user.photoSrc)\n\t\t\t\t{\n\t\t\t\t\tstyle += ' background-image: url(' + Text.encode(user.photoSrc) + ');';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tstyle += ' background-size: 60%;';\n\t\t\t\t}\n\t\t\t\tresponsibleElements.push(Tag.render`<span class=\"rpa-kanban-column-task-responsible-item\" title=\"${user.name}\">\n\t\t\t\t\t<span class=\"rpa-kanban-column-task-responsible-img\" style=\"${style}\">\n\t\t\t\t\t</span>\n\t\t\t\t</span>`);\n\t\t\t});\n\t\t});\n\n\t\tresponsibleElements = this.sliceResponsibleListElements(responsibleElements);\n\n\t\tlet plusNode = Tag.render`<span class=\"rpa-kanban-column-task-responsible-add\"></span>`;\n\t\tif (showTaskListMenu)\n\t\t{\n\t\t\tBX.bind(plusNode, 'click', plusHandler);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet task = tasks[0];\n\n\t\t\tif (task.canAppendResponsibles)\n\t\t\t{\n\t\t\t\tBX.Bizproc.UserSelector.decorateNode(plusNode, {\n\t\t\t\t\tisOnlyDialogMode: true,\n\t\t\t\t\tcallbacks: {\n\t\t\t\t\t\tselect: this.addTaskUserHandler.bind(this, task)\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tplusNode = Tag.render`<a href=\"${this.buildEditRobotUrl(task['robotName'])}\" class=\"rpa-kanban-column-task-responsible-add\"></a>`;\n\t\t\t}\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"rpa-kanban-column-task-responsible\">\n\t\t\t\t\t<div class=\"rpa-kanban-column-task-responsible-list\" style=\"background-color: ${\"#\" + this.getColor()}\" onclick=\"${plusHandler}\">\n\t\t\t\t\t\t${responsibleElements}\n\t\t\t\t\t</div>\n\t\t\t\t\t${plusNode}\n\t\t\t\t</div>\n\t\t\t`;\n\t}\n\n\tsliceResponsibleListElements(elements: Array): Array\n\t{\n\t\tif (elements.length > 4)\n\t\t{\n\t\t\tlet counter = elements.length - 4;\n\t\t\telements = elements.slice(0, 4);\n\n\t\t\telements.push(\n\t\t\t\tTag.render`<span class=\"rpa-kanban-column-task-responsible-item rpa-kanban-column-task-responsible-item-other\">\n\t\t\t\t\t\t<span class=\"rpa-kanban-column-task-responsible-other-text\">+${counter}</span>\n\t\t\t\t\t</span>`\n\t\t\t);\n\t\t}\n\t\treturn elements;\n\t}\n\n\tshowTasks(tasks)\n\t{\n\t\tthis.getTasksPopup(tasks).show();\n\t}\n\n\taddTaskUserHandler(task, value, selector)\n\t{\n\t\tAjax.runAction('rpa.task.addUser', {\n\t\t\tanalyticsLabel: 'rpaTaskAddUser',\n\t\t\tdata: {\n\t\t\t\ttypeId: this.getGrid().getData().typeId,\n\t\t\t\tstageId: this.getId(),\n\t\t\t\trobotName: task.robotName,\n\t\t\t\tuserValue: value,\n\t\t\t},\n\t\t\tgetParameters: {\n\t\t\t\tcontext: 'kanban',\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\n\t\t});\n\t}\n\n\tgetTasksPopup(tasks): Popup\n\t{\n\t\tif(!this.tasksPopup)\n\t\t{\n\t\t\tlet button = this.layout.subTitleTasksButton;\n\t\t\tif(!button)\n\t\t\t{\n\t\t\t\tbutton = this.renderSubTitleTasksButton(this.getTasks());\n\t\t\t}\n\t\t\tthis.tasksPopup = new Popup('rpa-tasks-' + this.getId(), button, {\n\t\t\t\tautoHide: true,\n\t\t\t\tdraggable: false,\n\t\t\t\toffsetTop: -5,\n\t\t\t\toffsetLeft: 30,\n\t\t\t\tnoAllPaddings: true,\n\t\t\t\tbindOptions: { forceBindPosition: true },\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcacheable: false,\n\t\t\t\tangle: {\n\t\t\t\t\toffset: 81,\n\t\t\t\t\tposition: 'top',\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.tasksPopup = null;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\toverlay: { backgroundColor: 'transparent' },\n\t\t\t\tcontent: this.renderTasksPopup(tasks)\n\t\t\t});\n\t\t}\n\n\t\treturn this.tasksPopup;\n\t}\n\n\trenderTasksPopup(tasks): Element\n\t{\n\t\tconst elements = tasks.map((task) => {\n\t\t\treturn Tag.render`<div class=\"rpa-kanban-tasks-popup-item\">\n\t\t\t\t\t\t<a href=\"${this.buildEditRobotUrl(task['robotName'])}\" class=\"rpa-kanban-tasks-popup-name\">${Text.encode(task['title'])}</a>\n\t\t\t\t\t\t<div class=\"rpa-kanban-tasks-popup-desc\">\n\t\t\t\t\t\t\t${this.renderSubTitleResponsible([task])}\n\t\t\t\t\t\t\t<span class=\"rpa-kanban-tasks-popup-delete\" onclick=\"${this.deleteTaskHandler.bind(this, task)}\">${Loc.getMessage('RPA_KANBAN_COLUMN_DELETE_TASK_BTN')}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"rpa-kanban-tasks-popup-inner\" data-role=\"rpa-kanban-column-tasks-item\">\n\t\t\t\t<div class=\"rpa-kanban-tasks-popup-list\">\n\t\t\t\t\t${elements}\n\t\t\t\t</div>\n\t\t\t\t<a href=\"${this.buildAddRobotUrl()}\" class=\"rpa-kanban-tasks-popup-add\">${Loc.getMessage('RPA_KANBAN_COLUMN_ADD_TASK_BTN')}</a>\n\t\t\t</div>`;\n\t}\n\n\tdeleteTaskHandler(task, event)\n\t{\n\t\tMessageBox.show({\n\t\t\tmessage: Loc.getMessage('RPA_KANBAN_COLUMN_DELETE_TASK_CONFIRM'),\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tonOk: () => {\n\t\t\t\tif (this.getGrid().isProgress())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.getGrid().startProgress();\n\t\t\t\tconst promise = new BX.Promise();\n\t\t\t\tAjax.runAction('rpa.task.delete', {\n\t\t\t\t\tanalyticsLabel: 'rpaKanbanTaskDelete',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\ttypeId: this.getGrid().getData().typeId,\n\t\t\t\t\t\tstageId: this.getId(),\n\t\t\t\t\t\trobotName: task['robotName'],\n\t\t\t\t\t\teventId: this.getGrid().pullManager.registerRandomEventId(),\n\t\t\t\t\t},\n\t\t\t\t\tgetParameters: {\n\t\t\t\t\t\tcontext: 'kanban',\n\t\t\t\t\t}\n\t\t\t\t}).then(() =>\n\t\t\t\t{\n\t\t\t\t\tif(this.tasksPopup)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.tasksPopup.destroy();\n\t\t\t\t\t}\n\t\t\t\t\tthis.setTasks(this.getTasks().filter((filteredTask) =>\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (filteredTask.robotName !== task.robotName);\n\t\t\t\t\t}));\n\t\t\t\t\tthis.rerenderSubtitle();\n\t\t\t\t\tthis.getGrid().stopProgress();\n\t\t\t\t\tpromise.fulfill();\n\t\t\t\t}).catch((response) =>\n\t\t\t\t{\n\t\t\t\t\tthis.getGrid().stopProgress();\n\t\t\t\t\tpromise.reject();\n\t\t\t\t});\n\n\t\t\t\treturn promise;\n\t\t\t},\n\t\t\tpopupOptions: {\n\t\t\t\tzIndexAbsolute: 1200\n\t\t\t}\n\t\t});\n\t}\n\n\tbuildAddRobotUrl()\n\t{\n\t\tconst typeId = this.getGrid().getData().typeId;\n\t\tconst url = new Uri(`/rpa/automation/${typeId}/addrobot/`); //TODO use URI from urlManager\n\n\t\turl.setQueryParams({\n\t\t\tstage: this.getId()\n\t\t});\n\t\treturn url;\n\t}\n\tbuildEditRobotUrl(robotName)\n\t{\n\t\tconst typeId = this.getGrid().getData().typeId;\n\t\tconst url = new Uri(`/rpa/automation/${typeId}/editrobot/`); //TODO use URI from urlManager\n\n\t\turl.setQueryParams({\n\t\t\tstage: this.getId(),\n\t\t\trobotName\n\t\t});\n\t\treturn url;\n\t}\n\t//endregion\n\n\tgetFields(): Object\n\t{\n\t\tlet fields = this.getData().userFields;\n\t\tif(!fields || !Type.isPlainObject(fields))\n\t\t{\n\t\t\tfields = this.getGrid().getFields();\n\t\t}\n\t\tif(!fields || !Type.isPlainObject(fields))\n\t\t{\n\t\t\tfields = {};\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tgetPossibleNextStages()\n\t{\n\t\treturn this.getData().possibleNextStages;\n\t}\n\n\tgetSort()\n\t{\n\t\treturn parseInt(this.getData().sort);\n\t}\n\n\tisCanMoveFrom()\n\t{\n\t\treturn !!this.canMoveFrom;\n\t}\n\n\tcanMoveTo()\n\t{\n\t\tlet result = false;\n\t\tthis.getGrid().getColumns().forEach((column) =>\n\t\t{\n\t\t\tif(column.isCanMoveFrom() && column.getPossibleNextStages().includes(this.getId()))\n\t\t\t{\n\t\t\t\tresult = true;\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tupdate(data)\n\t{\n\t\tif(\n\t\t\tType.isPlainObject(data) &&\n\t\t\tdata.stage &&\n\t\t\tType.isPlainObject(data.stage) &&\n\t\t\tparseInt(data.stage.id) === this.getId()\n\t\t)\n\t\t{\n\t\t\tconst stageData = data.stage;\n\t\t\tthis.setName(stageData.name);\n\t\t\tthis.setColor(stageData.color);\n\t\t\tthis.setData(stageData);\n\t\t\tthis.processPermissions(stageData);\n\n\t\t\tthis.getGrid().moveColumn(this, this.getTargetColumn());\n\t\t\tthis.render();\n\n\t\t\tthis.getGrid().getColumns().forEach((column) =>\n\t\t\t{\n\t\t\t\tif(column !== this)\n\t\t\t\t{\n\t\t\t\t\tcolumn.processPermissions();\n\t\t\t\t\tcolumn.onAfterRender();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetTargetColumn()\n\t{\n\t\tconst columns = this.getGrid().getColumns();\n\t\tlet targetColumn = null;\n\t\tcolumns.forEach((gridColumn) =>\n\t\t{\n\t\t\tif(\n\t\t\t\tgridColumn.getId() !== this.getId() &&\n\t\t\t\tgridColumn.getSort() >= this.getSort() &&\n\t\t\t\t((!targetColumn) || (targetColumn.getSort() > gridColumn.getSort()))\n\t\t\t)\n\t\t\t{\n\t\t\t\ttargetColumn = gridColumn;\n\t\t\t}\n\t\t});\n\n\t\treturn targetColumn;\n\t}\n\n\tprocessPermissions()\n\t{\n\t\tthis.setPermissionProperties();\n\t\tthis.processDraggingOptions();\n\t}\n\n\tsetPermissionProperties()\n\t{\n\t\tconst data = this.getData();\n\t\tlet permissions = {};\n\t\tif(data.permissions && Type.isPlainObject(data.permissions))\n\t\t{\n\t\t\tpermissions = data.permissions;\n\t\t}\n\n\t\tObject.keys(permissions).forEach((name) =>\n\t\t{\n\t\t\tthis[name] = permissions[name];\n\t\t});\n\t}\n\n\tprocessDraggingOptions()\n\t{\n\t\tif(this.isDraggable())\n\t\t{\n\t\t\tthis.makeDraggable();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.disableDragging();\n\t\t}\n\t\tif(this.isDroppable())\n\t\t{\n\t\t\tthis.makeDroppable();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.disableDropping();\n\t\t}\n\n\t\tthis.getItems().forEach((item) =>\n\t\t{\n\t\t\titem.processPermissions();\n\t\t});\n\t}\n\n\tloadTasks(): Promise<null, null>\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getGrid().startProgress();\n\t\t\tAjax.runAction('rpa.stage.getTasks', {\n\t\t\t\tdata: {\n\t\t\t\t\tid: this.getId(),\n\t\t\t\t}\n\t\t\t}).then((response) =>\n\t\t\t{\n\t\t\t\tthis.getGrid().stopProgress();\n\t\t\t\tthis.setTasks(response.data.tasks);\n\t\t\t\tresolve();\n\t\t\t}).catch((response) =>\n\t\t\t{\n\t\t\t\tthis.getGrid().stopProgress().showErrorFromResponse(response);\n\t\t\t\treject();\n\t\t\t});\n\t\t});\n\t}\n\n\tgetTasks(): Array\n\t{\n\t\tif(!this.data)\n\t\t{\n\t\t\tthis.data = {};\n\t\t}\n\t\tif(!this.data.tasks || !Type.isArray(this.data.tasks))\n\t\t{\n\t\t\tthis.data.tasks = [];\n\t\t}\n\t\treturn Array.from(this.data.tasks);\n\t}\n\n\tsetTasks(tasks: Array): Column\n\t{\n\t\tif(!Type.isArray(tasks))\n\t\t{\n\t\t\ttasks = [];\n\t\t}\n\n\t\tthis.data.tasks = tasks;\n\n\t\treturn this;\n\t}\n\n\taddSelectButtonToEditor()\n\t{\n\t\tconst editor = this.getEditor();\n\t\tif(!editor)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet editorMainSection = this.getGrid().getEditorMainSection(editor);\n\t\tif(!editorMainSection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(editorMainSection._addChildButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\teditorMainSection.ensureButtonPanelCreated();\n\t\teditorMainSection._addChildButton = BX.create(\"span\",\n\t\t\t{\n\t\t\t\tprops: { className: \"ui-entity-editor-content-add-lnk\" },\n\t\t\t\ttext: BX.message(\"UI_ENTITY_EDITOR_SELECT_FIELD\"),\n\t\t\t\tevents: { click: BX.delegate(editorMainSection.onAddChildBtnClick, editorMainSection) }\n\t\t\t});\n\t\teditorMainSection.addButtonElement(editorMainSection._addChildButton, { position: \"left\" });\n\t}\n}","import {Kanban} from 'main.kanban';\nimport {ajax as Ajax, Dom, Type, Loc, Runtime, Tag, Text, Event} from 'main.core';\nimport {Manager} from 'rpa.manager';\nimport {PopupWindowManager, PopupWindow} from 'main.popup';\nimport Column from './column';\n\nexport default class Item extends Kanban.Item\n{\n\teditorResolve;\n\teditorReject;\n\tcurrentState = {};\n\n\tsetOptions(options: { droppable?: boolean; draggable?: boolean; countable?: boolean; visible?: boolean; data?: object })\n\t{\n\t\tsuper.setOptions(options);\n\t\tthis.setPermissionProperties();\n\t}\n\n\trender()\n\t{\n\t\tthis.layout.title = null;\n\t\tthis.renderDescription();\n\t\tthis.renderFieldsList();\n\t\tthis.renderShadow();\n\n\t\tif (!this.layout.content)\n\t\t{\n\t\t\tthis.layout.content = Tag.render`<div ondblclick=\"${this.onDoubleClick.bind(this)}\" class=\"rpa-kanban-item\"></div>`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.clean(this.layout.content);\n\t\t}\n\n\t\tif (this.layout.title)\n\t\t{\n\t\t\tthis.layout.content.appendChild(this.layout.title);\n\t\t}\n\t\tif (this.layout.fieldList)\n\t\t{\n\t\t\tthis.layout.content.appendChild(this.layout.fieldList);\n\t\t}\n\t\tif (this.layout.description)\n\t\t{\n\t\t\tthis.layout.content.appendChild(this.layout.description);\n\t\t}\n\n\t\tthis.layout.content.appendChild(this.renderShadow());\n\t\t//this.layout.content.appendChild(this.renderContact());\n\t\tthis.layout.description.appendChild(this.renderTasksParticipants());\n\t\tthis.layout.description.appendChild(this.renderTasksCounter());\n\n\t\tthis.layout.content.appendChild(BX.Tag.render`<div class=\"rpa-kanban-item-line\"></div>`);\n\t\tthis.layout.content.style.setProperty(\"--rpa-kanban-item-color\", \"#\" + this.getColumn().getColor());\n\n\t\tif(this.isDraggable())\n\t\t{\n\t\t\tthis.layout.content.style.backgroundColor = \"#fff\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.content.style.backgroundColor = \"#aaa\";\n\t\t}\n\n\t\tEvent.bindOnce(this.layout.content, \"animationend\", () => {\n\t\t\tBX.removeClass(this.layout.container, \"main-kanban-item-new\")\n\t\t});\n\n\t\treturn this.layout.content;\n\t}\n\n\tsetTasksParticipants(tasksFaces: {\n\t\tcompleted: [],\n\t\trunning: [],\n\t\tall: [],\n\t}): this\n\t{\n\t\tthis.data.tasksFaces = tasksFaces;\n\n\t\treturn this;\n\t}\n\n\tgetTasksCounter(): number\n\t{\n\t\treturn Text.toInteger(this.data.tasksCounter);\n\t}\n\n\tgetTasksParticipants()\n\t{\n\t\tconst userId = Text.toInteger(this.getData()['createdBy']);\n\t\tconst currentUserId = this.getGrid().getUserId();\n\t\tconst startedBy = this.getGrid().getUser(userId);\n\t\tconst faces = this.data.tasksFaces;\n\t\tconst completedById = faces.completed[0];\n\t\tconst waitingForId = faces.running.includes(currentUserId) ? currentUserId : faces.running[0];\n\t\tconst completedCnt = faces.completed.length;\n\t\tconst waitingForCnt = faces.running.length;\n\n\t\tlet completedBy = null;\n\t\tlet waitingFor = null;\n\n\t\tif (completedById)\n\t\t{\n\t\t\tcompletedBy = this.getGrid().getUser(Text.toInteger(completedById))\n\t\t}\n\t\tif (waitingForId)\n\t\t{\n\t\t\twaitingFor = this.getGrid().getUser(Text.toInteger(waitingForId))\n\t\t}\n\n\t\treturn {startedBy, completedBy, waitingFor, completedCnt, waitingForCnt};\n\t}\n\n\tsetTasksCounter(counter: number): Item\n\t{\n\t\tthis.data.tasksCounter = counter;\n\t\treturn this;\n\t}\n\n\tbindEditorEvents()\n\t{\n\t\tif(!this.isEditorEventsBinded)\n\t\t{\n\t\t\tthis.isEditorEventsBinded = true;\n\n\t\t\tBX.addCustomEvent(window, 'BX.UI.EntityEditorAjax:onSubmitFailure', this.onEditorErrors.bind(this));\n\t\t\tBX.addCustomEvent(window, 'BX.UI.EntityEditorAjax:onSubmit', this.onEditorSubmit.bind(this));\n\t\t}\n\t}\n\n\tshowEditor(columnId: number): Promise<Object, Object>\n\t{\n\t\tDom.addClass(this.layout.container, 'main-kanban-item-waiting');\n\t\tthis.bindEditorEvents();\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tAjax.runAction('rpa.item.getEditor', {\n\t\t\t\tanalyticsLabel: 'rpaItemMovedMandatoryFieldsPopupOpen',\n\t\t\t\tdata: {\n\t\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\t\tid: this.getId(),\n\t\t\t\t\tstageId: columnId > 0 ? columnId : null,\n\t\t\t\t\teventId: this.getGrid().pullManager.registerRandomEventId(),\n\t\t\t\t}\n\t\t\t}).then((response) =>\n\t\t\t{\n\t\t\t\tconst popup = this.getPopup();\n\t\t\t\tif(popup)\n\t\t\t\t{\n\t\t\t\t\tRuntime.html(popup.getContentContainer(), response.data.html).then(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tpopup.show();\n\t\t\t\t\t\tthis.editorResolve = resolve;\n\t\t\t\t\t\tthis.editorReject = reject;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}).catch((response) =>\n\t\t\t{\n\t\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\t\treject(response.errors);\n\t\t\t});\n\t\t});\n\t}\n\n\tonEditorSaveClick()\n\t{\n\t\tconst editor = this.getEditor();\n\t\tif(!editor)\n\t\t{\n\t\t\tthis.getPopup().close();\n\t\t\tif(Type.isFunction(this.editorReject))\n\t\t\t{\n\t\t\t\tthis.editorReject('Editor not found');\n\t\t\t\tthis.editorResolve = null;\n\t\t\t\tthis.editorReject = null;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\teditor.save();\n\t\t}\n\t}\n\n\tonEditorCancelClick()\n\t{\n\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\tthis.getPopup().close();\n\t\tif(Type.isFunction(this.editorResolve))\n\t\t{\n\t\t\tthis.editorResolve({\n\t\t\t\tcancel: true,\n\t\t\t});\n\t\t\tthis.editorResolve = null;\n\t\t\tthis.editorReject = null;\n\t\t}\n\t}\n\n\tonEditorSubmit(entityData, response)\n\t{\n\t\tif(this.getPopup().isShown())\n\t\t{\n\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\tthis.getPopup().close();\n\t\t\tthis.setData(response.data.item);\n\t\t\tthis.saveCurrentState();\n\t\t\tthis.render();\n\t\t}\n\t}\n\n\tonEditorErrors(errors)\n\t{\n\t\tif(this.getPopup().isShown())\n\t\t{\n\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\tthis.getPopup().close();\n\n\t\t\tif(Type.isFunction(this.editorReject))\n\t\t\t{\n\t\t\t\tthis.editorReject({errors}, false);\n\t\t\t\tthis.editorResolve = null;\n\t\t\t\tthis.editorReject = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tgetPopup(): PopupWindow\n\t{\n\t\tconst popupId = 'rpa-kanban-item-popup-' + this.getId();\n\t\tlet popup = PopupWindowManager.getPopupById(popupId);\n\n\t\tif(!popup)\n\t\t{\n\t\t\tpopup = new PopupWindow(popupId, null, {\n\t\t\t\tzIndex: 200,\n\t\t\t\tclassName: \"\",\n\t\t\t\tautoHide: false,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcloseIcon: false,\n\t\t\t\twidth: 600,\n\t\t\t\toverlay: true,\n\t\t\t\tlightShadow: false,\n\t\t\t\tbuttons: this.getItemPopupButtons(),\n\t\t\t});\n\t\t}\n\n\t\treturn popup;\n\t}\n\n\tgetEditor()\n\t{\n\t\treturn Manager.getEditor(this.getTypeId(), parseInt(this.getId()));\n\t}\n\n\tgetItemPopupButtons(): Array\n\t{\n\t\treturn [\n\t\t\tnew BX.PopupWindowButton({\n\t\t\t\ttext : Loc.getMessage('RPA_KANBAN_POPUP_SAVE'),\n\t\t\t\tclassName : \"ui-btn ui-btn-md ui-btn-primary\",\n\t\t\t\tevents : {\n\t\t\t\t\tclick : this.onEditorSaveClick.bind(this),\n\t\t\t\t}\n\t\t\t}),\n\t\t\tnew BX.PopupWindowButton({\n\t\t\t\ttext : Loc.getMessage('RPA_KANBAN_POPUP_CANCEL'),\n\t\t\t\tclassName : \"ui-btn ui-btn-md\",\n\t\t\t\tevents : {\n\t\t\t\t\tclick : this.onEditorCancelClick.bind(this),\n\t\t\t\t}\n\t\t\t})\n\t\t];\n\t}\n\n\tshowTasks(): Promise<Object>\n\t{\n\t\tDom.addClass(this.layout.container, 'main-kanban-item-waiting');\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tManager.Instance.openTasks(this.getTypeId(), this.getId()).then((result) =>\n\t\t\t{\n\t\t\t\tresolve(result);\n\t\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\t});\n\t\t});\n\t}\n\n\tgetStageId(): number\n\t{\n\t\treturn Text.toInteger(this.getData().stageId);\n\t}\n\n\tsetStageId(stageId: number): Item\n\t{\n\t\tthis.data.stageId = stageId;\n\t\treturn this;\n\t}\n\n\tgetTypeId(): number\n\t{\n\t\treturn Text.toInteger(this.getData().typeId);\n\t}\n\n\tsaveCurrentState(): Item\n\t{\n\t\tconst column = this.getColumn();\n\t\tconst nextItem = column.getNextItemSibling(this);\n\t\tconst previousItem = column.getPreviousItemSibling(this);\n\t\tthis.data.stageId = this.getColumnId();\n\n\t\tthis.currentState.nextItemId = nextItem ? nextItem.getId() : 0;\n\t\tthis.currentState.previousItemId = previousItem ? previousItem.getId() : 0;\n\t\tthis.currentState.stageId = this.data.stageId;\n\n\t\treturn this;\n\t}\n\n\tsavePosition(): Promise<Object, Object>\n\t{\n\t\tconst data = {\n\t\t\tid: this.getId(),\n\t\t\ttypeId: this.getTypeId(),\n\t\t\tfields: {\n\t\t\t\tstageId: this.getStageId(),\n\t\t\t\tpreviousItemId: this.currentState.previousItemId || null,\n\t\t\t},\n\t\t\teventId: this.getGrid().pullManager.registerRandomEventId(),\n\t\t};\n\n\t\tDom.addClass(this.layout.container, 'main-kanban-item-waiting');\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tAjax.runAction('rpa.item.update', {\n\t\t\t\tanalyticsLabel: 'rpaItemMoved',\n\t\t\t\tdata: data\n\t\t\t}).then((response) =>\n\t\t\t{\n\t\t\t\tthis.data = response.data.item;\n\t\t\t\tif(!this.moveToActualColumn())\n\t\t\t\t{\n\t\t\t\t\tthis.render();\n\t\t\t\t}\n\t\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\t\tresolve(response);\n\t\t\t}).catch((response) =>\n\t\t\t{\n\t\t\t\treject(response);\n\t\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\t});\n\t\t});\n\t}\n\n\tmoveToActualColumn(): boolean\n\t{\n\t\tif(this.getStageId() !== this.getColumn().getId())\n\t\t{\n\t\t\tconst column = this.getGrid().getColumn(this.getStageId());\n\t\t\tif(column)\n\t\t\t{\n\t\t\t\tthis.getGrid().moveItem(this, column, column.getFirstItem());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getGrid().moveItem(this, this.getStageId());\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tsaveSort(): Promise<Object, Object>\n\t{\n\t\tconst data = {\n\t\t\tid: this.getId(),\n\t\t\ttypeId: this.getTypeId(),\n\t\t\tpreviousItemId: this.currentState.previousItemId,\n\t\t};\n\n\t\tDom.addClass(this.layout.container, 'main-kanban-item-waiting');\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tAjax.runAction('rpa.item.sort', {\n\t\t\t\tanalyticsLabel: 'rpaItemSorted',\n\t\t\t\tdata: data\n\t\t\t}).then((response) =>\n\t\t\t{\n\t\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\t\tresolve(response);\n\t\t\t}).catch((response) =>\n\t\t\t{\n\t\t\t\treject(response);\n\t\t\t\tDom.removeClass(this.layout.container, 'main-kanban-item-waiting');\n\t\t\t});\n\t\t});\n\t}\n\n\tgetCurrentState(): Object\n\t{\n\t\treturn Object.assign({}, this.currentState);\n\t}\n\n\trestoreState(previousState): Item\n\t{\n\t\tthis.currentState = previousState;\n\t\tthis.data.stageId = this.currentState.stageId;\n\n\t\treturn this;\n\t}\n\n\tonDoubleClick()\n\t{\n\t\tif(this.data.detailUrl)\n\t\t{\n\t\t\tManager.openSlider(this.data.detailUrl);\n\t\t}\n\t}\n\n\tgetMovedBy(): number\n\t{\n\t\treturn Text.toInteger(this.getData().movedBy);\n\t}\n\n\tgetUpdatedBy(): number\n\t{\n\t\treturn Text.toInteger(this.getData().updatedBy);\n\t}\n\n\tgetCreatedBy(): number\n\t{\n\t\treturn Text.toInteger(this.getData().createdBy);\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.data.name;\n\t}\n\n\trenderTitle(title: string): Element\n\t{\n\t\tif (Type.isArray(title))\n\t\t{\n\t\t\ttitle = title[0];\n\t\t}\n\t\ttitle = Text.encode(title);\n\t\tlet href = 'javascript:void(0);';\n\t\tif(this.data.detailUrl)\n\t\t{\n\t\t\thref = this.data.detailUrl;\n\t\t}\n\t\tif (!this.layout.title)\n\t\t{\n\t\t\tthis.layout.title = Tag.render`<a class=\"rpa-kanban-item-title\" href=\"${href}\">${title}</a>`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.title.innerText = title;\n\t\t}\n\n\t\treturn this.layout.title;\n\t}\n\n\trenderFieldsList(): Element\n\t{\n\t\tif (!this.layout.fieldList)\n\t\t{\n\t\t\tthis.layout.fieldList = Tag.render`<div class=\"rpa-kanban-item-field-list\"></div>`;\n\t\t}\n\t\tthis.layout.fieldList.innerHTML = '';\n\n\t\tconst fields = this.getGrid().getFields();\n\t\tObject.keys(fields).forEach((fieldName) =>\n\t\t{\n\t\t\tif(fields[fieldName]['isVisibleOnKanban'] && !this.isEmptyValue(this.getData()[fieldName]))\n\t\t\t{\n\t\t\t\tif(fields[fieldName]['isTitle'])\n\t\t\t\t{\n\t\t\t\t\tthis.renderTitle(this.getData()[fieldName]);\n\t\t\t\t}\n\t\t\t\telse if(fieldName === 'createdBy' || fieldName === 'updatedBy' || fieldName === 'movedBy')\n\t\t\t\t{\n\t\t\t\t\tconst renderedUser = this.renderUser(fieldName);\n\t\t\t\t\tif(renderedUser)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.layout.fieldList.appendChild(Tag.render`\n\t\t\t\t\t\t\t<div class=\"rpa-kanban-item-field-item\">\n\t\t\t\t\t\t\t\t<span class=\"rpa-kanban-item-field-item-name\">${Text.encode(fields[fieldName].title)}</span>\n\t\t\t\t\t\t\t\t${renderedUser}\n\t\t\t\t\t\t\t</div>`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.layout.fieldList.appendChild(Tag.render`\n\t\t\t\t\t\t<div class=\"rpa-kanban-item-field-item\">\n\t\t\t\t\t\t\t<span class=\"rpa-kanban-item-field-item-name\">${Text.encode(fields[fieldName].title)}</span>\n\t\t\t\t\t\t\t<span class=\"rpa-kanban-item-field-item-value\">${this.getDisplayableValue(fieldName)}</span>\n\t\t\t\t\t\t</div>`\n\t\t\t\t\t);\n\n\t\t\t\t\t// field with link\n\t\t\t\t\t/*this.layout.fieldList.appendChild(Tag.render`\n\t\t\t\t\t\t<div class=\"rpa-kanban-item-field-item\">\n\t\t\t\t\t\t\t<span class=\"rpa-kanban-item-field-item-name\">Link</span>\n\t\t\t\t\t\t\t<a class=\"rpa-kanban-item-field-item-value-link\" href=\"#\">Bitrix Inc.</a>\n\t\t\t\t\t\t</div>`\n\t\t\t\t\t);*/\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this.layout.fieldList;\n\t}\n\n\trenderShadow(): Element\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"rpa-kanban-item-shadow\"></div>\n\t\t`;\n\t}\n\n\trenderDescription(): Element\n\t{\n\t\tthis.layout.description = Tag.render`\n\t\t\t<div class=\"rpa-kanban-item-description\"></div>\n\t\t`;\n\t}\n\n\trenderUserPhoto({\n\t\tlink,\n\t\tphoto,\n\t}): ?Element\n\t{\n\t\tif(Type.isString(link) && Type.isString(photo))\n\t\t{\n\t\t\treturn Tag.render`<a class=\"rpa-kanban-item-user-photo\" href=\"${Text.encode(link)}\" style=\"background-image: url(${Text.encode(photo)})\"></a>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenderUser(fieldName: string): ?Element\n\t{\n\t\tconst userId = Text.toInteger(this.getData()[fieldName]);\n\t\tconst userInfo = this.getGrid().getUser(userId);\n\n\t\tif(userInfo)\n\t\t{\n\t\t\tconst photo = this.renderUserPhoto(userInfo);\n\n\t\t\treturn Tag.render`<div class=\"rpa-kanban-item-user\">\n\t\t\t\t${(photo) ? photo : ''}\n\t\t\t\t<a class=\"rpa-kanban-item-user-name rpa-kanban-item-field-item-value\" href=\"${Text.encode(userInfo.link)}\">${Text.encode(userInfo.fullName)}</a>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenderContact(): Element\n\t{\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"rpa-kanban-item-contact\">\n\t\t\t\t\t<span class=\"rpa-kanban-item-contact-im\"></span>\n\t\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderTasksParticipants(): Element\n\t{\n\t\tconst {startedBy, completedBy, waitingFor, completedCnt, waitingForCnt} = this.getTasksParticipants();\n\t\tconst elements = [];\n\n\t\tif (startedBy)\n\t\t{\n\t\t\telements.push(this.renderTaskParticipant(startedBy));\n\t\t}\n\t\tif (completedBy)\n\t\t{\n\t\t\telements.push(this.renderTaskParticipant(completedBy, completedCnt > 1));\n\t\t}\n\t\tif (waitingFor)\n\t\t{\n\t\t\telements.push(this.renderTaskParticipant(waitingFor, waitingForCnt > 1));\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"rpa-kanban-column-task-responsible-list\">\n\t\t\t\t\t${elements}\n\t\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderTaskParticipant({link, photo, fullName}, isMore): Element\n\t{\n\t\treturn Tag.render`\n\t\t\t<a class=\"rpa-kanban-column-task-responsible-item ${isMore? 'rpa-kanban-column-task-responsible-item-more':''}\" \n\t\t\t href=\"${Text.encode(link)}\" title=\"${Text.encode(fullName)}\">\n\t\t\t\t<span class=\"rpa-kanban-column-task-responsible-img\" ${photo ? 'style=\"background-image: url(' + Text.encode(photo) + '\"' : ''}>\t\n\t\t\t\t</span>\n\t\t\t</a>\n\t\t`;\n\t}\n\n\trenderTasksCounter(): Element\n\t{\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"rpa-kanban-item-counter\" onclick=\"${this.showTasks.bind(this)}\" ${(this.getTasksCounter() <= 0 ? 'style=\"display: none;\"' : '')}>\n\t\t\t\t\t<div class=\"rpa-kanban-item-counter-text\">${Loc.getMessage('RPA_KANBAN_TASKS')}</div>\n\t\t\t\t\t<div class=\"rpa-kanban-item-counter-value\">${this.getTasksCounter()}</div>\n\t\t\t\t</div>\n\t\t`;\n\t}\n\n\thasEmptyMandatoryFields(column: Column): boolean\n\t{\n\t\tlet result = false;\n\t\tif(!column)\n\t\t{\n\t\t\tcolumn = this.getStageId();\n\t\t}\n\t\tcolumn = this.getGrid().getColumn(column);\n\t\tif(!column)\n\t\t{\n\t\t\tthrow new Error(\"Column not found\");\n\t\t}\n\t\tconst fields = column.getFields();\n\t\tObject.keys(fields).forEach((fieldName) =>\n\t\t{\n\t\t\tif(fields[fieldName].mandatory && this.isEmptyValue(this.getData()[fieldName]))\n\t\t\t{\n\t\t\t\tresult = true;\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tisEmptyValue(value): boolean\n\t{\n\t\treturn (\n\t\t\tType.isNil(value) ||\n\t\t\tvalue === false ||\n\t\t\t((Type.isString(value) || Type.isArray(value)) && value.length <= 0) ||\n\t\t\t(Type.isNumber(value) && value === 0)\n\t\t);\n\t}\n\n\tupdate(data: Object): Item\n\t{\n\t\tif(\n\t\t\tType.isPlainObject(data) &&\n\t\t\tdata.item &&\n\t\t\tType.isPlainObject(data.item) &&\n\t\t\tparseInt(data.item.id) === this.getId()\n\t\t)\n\t\t{\n\t\t\tthis.data = data.item;\n\t\t\tthis.processPermissions();\n\t\t\tthis.render();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tprocessPermissions(): Item\n\t{\n\t\tthis.setPermissionProperties();\n\t\tthis.processDraggingOptions();\n\n\t\treturn this;\n\t}\n\n\tsetPermissionProperties(): Item\n\t{\n\t\tconst data = this.getData();\n\t\tlet permissions = {};\n\t\tif(data.permissions && Type.isPlainObject(data.permissions))\n\t\t{\n\t\t\tpermissions = data.permissions;\n\t\t}\n\n\t\tObject.keys(permissions).forEach((name) =>\n\t\t{\n\t\t\tthis[name] = permissions[name];\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tprocessDraggingOptions(): Item\n\t{\n\t\tif(this.isDraggable())\n\t\t{\n\t\t\tthis.makeDraggable();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.disableDragging();\n\t\t}\n\t\tthis.render();\n\n\t\treturn this;\n\t}\n\n\tgetDisplayableValue(fieldName: string): ?string\n\t{\n\t\tlet result = null;\n\t\tif(this.data.display && this.data.display[fieldName])\n\t\t{\n\t\t\tresult = this.data.display[fieldName];\n\t\t}\n\t\telse if(this.data[fieldName])\n\t\t{\n\t\t\tresult = this.data[fieldName];\n\t\t}\n\n\t\tif(Type.isArray(result))\n\t\t{\n\t\t\tresult = result.join(', ');\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tisDeletable(): boolean\n\t{\n\t\treturn (this.canDelete !== false);\n\t}\n}","import {Kanban} from 'main.kanban';\nimport {Type, ajax as Ajax, Loc, Text, Event} from 'main.core';\nimport 'ui.buttons';\nimport 'ui.notification';\nimport 'ui.fonts.opensans';\nimport {PullManager} from './pullmanager';\nimport Item from './item';\nimport Column from './column';\nimport {PopupWindowManager, PopupMenuWindow} from 'main.popup';\nimport {FieldsPopup} from 'rpa.fieldspopup';\n\nexport default class Grid extends Kanban.Grid\n{\n\tgetTypeId(): number\n\t{\n\t\treturn Text.toInteger(this.getData().typeId);\n\t}\n\n\tgetUserId(): number\n\t{\n\t\treturn Text.toInteger(this.getData().userId);\n\t}\n\n\tisCreateItemRestricted(): boolean\n\t{\n\t\treturn (this.getData().isCreateItemRestricted === true);\n\t}\n\n\tbindEvents()\n\t{\n\t\tBX.addCustomEvent(this, \"Kanban.DropZone:onBeforeItemCaptured\", this.onBeforeItemCaptured.bind(this));\n\t\tBX.addCustomEvent(this, \"Kanban.DropZone:onBeforeItemRestored\", this.onBeforeItemRestored.bind(this));\n\n\t\tBX.addCustomEvent(\"Kanban.Column:render\", (column) =>\n\t\t{\n\t\t\tif(column.getGrid() === this && column instanceof Column)\n\t\t\t{\n\t\t\t\tcolumn.onAfterRender.apply(column);\n\t\t\t}\n\t\t});\n\n\t\tBX.addCustomEvent(\"BX.Main.Filter:apply\", this.onApplyFilter.bind(this));\n\n\t\tBX.addCustomEvent(this, \"Kanban.Grid:onColumnLoadAsync\", (promises) =>\n\t\t{\n\t\t\tpromises.push((column) =>\n\t\t\t{\n\t\t\t\treturn this.getColumnItems(column);\n\t\t\t});\n\t\t});\n\t\tBX.addCustomEvent(this, \"Kanban.Grid:onBeforeItemMoved\", this.saveItemState);\n\t\tBX.addCustomEvent(this, \"Kanban.Grid:onItemMoved\", this.onItemMoved);\n\t\tBX.addCustomEvent(this, \"Kanban.Grid:onColumnUpdated\", this.onColumnUpdated);\n\t\tBX.addCustomEvent(this, \"Kanban.Grid:onColumnMoved\", this.onColumnMoved);\n\t\tBX.addCustomEvent(this, \"Kanban.Grid:onColumnAddedAsync\", (promises) =>\n\t\t{\n\t\t\tpromises.push((column) =>\n\t\t\t{\n\t\t\t\treturn this.addStage(column);\n\t\t\t});\n\t\t});\n\t\tBX.addCustomEvent(this, \"Kanban.Grid:onColumnRemovedAsync\", (promises) =>\n\t\t{\n\t\t\tpromises.push((column) =>\n\t\t\t{\n\t\t\t\treturn this.removeStage(column);\n\t\t\t});\n\t\t});\n\n\t\tBX.addCustomEvent(window, 'BX.UI.EntityEditorSection:onOpenChildMenu', this.onOpenSelectFieldMenu.bind(this));\n\n\t\tBX.addCustomEvent('SidePanel.Slider:onMessage', (message) => {\n\t\t\tif(message.getEventId() === 'userfield-list-update')\n\t\t\t{\n\t\t\t\tthis.onApplyFilter();\n\t\t\t}\n\t\t});\n\n\t\tthis.pullManager = new PullManager(this);\n\t}\n\n\tonBeforeItemCaptured(dropZoneEvent: BX.Kanban.DropZoneEvent)\n\t{\n\t\tEvent.EventEmitter.emit('BX.Rpa.Kanban.Grid:onBeforeItemCapturedStart', [this, dropZoneEvent]);\n\t\tconst item = dropZoneEvent.getItem();\n\t\tif(!(item instanceof Item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(!dropZoneEvent.isActionAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst dropZone = dropZoneEvent.getDropZone();\n\t\tif(dropZone.getId() === 'delete')\n\t\t{\n\t\t\tif(!item.isDeletable())\n\t\t\t{\n\t\t\t\tdropZoneEvent.denyAction();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(this.deleteCommand && !this.deleteCommand.isCompleted())\n\t\t\t{\n\t\t\t\tthis.deleteCommand.run();\n\t\t\t}\n\t\t\tthis.deleteCommand = new Command(item, (commandItem) =>\n\t\t\t{\n\t\t\t\tthis.deleteItem(commandItem);\n\t\t\t}, (commandItem) =>\n\t\t\t{\n\t\t\t\tthis.unhideItem(commandItem);\n\t\t\t});\n\t\t\tthis.deleteCommand.start(dropZone.getDropZoneArea().getDropZoneTimeout());\n\t\t}\n\t\telse if(dropZone.getData().isColumn === true)\n\t\t{\n\t\t\tdropZoneEvent.denyAction();\n\t\t\tconst targetColumn = this.getColumn(dropZone.getId());\n\t\t\tif(!targetColumn)\n\t\t\t{\n\t\t\t\titem.saveCurrentState();\n\t\t\t\tthis.hideItem(item);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.moveItem(item, targetColumn);\n\t\t\t}\n\t\t\tthis.moveItemToStage(item, dropZone.getId(), item.getColumn());\n\t\t}\n\t}\n\n\tonBeforeItemRestored(dropZoneEvent: BX.Kanban.DropZoneEvent)\n\t{\n\t\tconst item = dropZoneEvent.getItem();\n\t\tif(!(item instanceof Item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst dropZone = dropZoneEvent.getDropZone();\n\t\tif(dropZone.getId() === 'delete')\n\t\t{\n\t\t\tif(this.deleteCommand)\n\t\t\t{\n\t\t\t\tthis.deleteCommand.cancel();\n\t\t\t\tthis.deleteCommand = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tsaveItemState(dropEvent)\n\t{\n\t\tdropEvent.getItem().saveCurrentState();\n\t}\n\n\tgetFirstColumn(): ?Column\n\t{\n\t\tconst columns = this.getColumns();\n\t\tif(columns.length > 0)\n\t\t{\n\t\t\treturn columns[0];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tonItemMoved(item: Item, targetColumn: Column, beforeItem: Item, skipHandler)\n\t{\n\t\tconst itemPreviousState = item.getCurrentState();\n\t\t// moving in the same column\n\t\tif(parseInt(item.getStageId()) === parseInt(targetColumn.getId()))\n\t\t{\n\t\t\tif(\n\t\t\t\t(!beforeItem && item.getCurrentState().nextItemId === 0) ||\n\t\t\t\t(beforeItem && parseInt(beforeItem.getId()) === parseInt(item.getCurrentState().nextItemId))\n\t\t\t)\n\t\t\t{\n\t\t\t\t// skip moving on the same place\n\t\t\t\tthis.moveItem(item, item.getStageId(), item.getCurrentState().nextItemId);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// save sorting\n\t\t\titem.saveCurrentState().saveSort().catch((response) =>\n\t\t\t{\n\t\t\t\tthis.onItemMoveError(item, response, itemPreviousState);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\t// check permissions and next stage\n\t\tconst previousColumn = this.getColumn(item.getStageId());\n\t\t//const isPossibleNextStagesIncludesTargetColumn = previousColumn.getPossibleNextStages().includes(targetColumn.getId());\n\t\t//sorry but for now we do not check possible next stages\n\t\tconst isPossibleNextStagesIncludesTargetColumn = true;\n\t\t/*if(!isPossibleNextStagesIncludesTargetColumn && previousColumn.canMoveTo() && item.getMovedBy() === this.getUserId() && targetColumn.getPossibleNextStages().includes(previousColumn.getId()))\n\t\t{\n\t\t\t// item is moving back - no editor just moving\n\t\t\titem.saveCurrentState().savePosition().catch((response) =>\n\t\t\t{\n\t\t\t\tthis.onItemMoveError(item, response, itemPreviousState);\n\t\t\t});\n\t\t}\n\t\telse */if(previousColumn.isCanMoveFrom() && isPossibleNextStagesIncludesTargetColumn)\n\t\t{\n\t\t\tthis.moveItemToStage(item, targetColumn.getId(), previousColumn);\n\t\t}\n\t\telse if(!previousColumn.isCanMoveFrom() && isPossibleNextStagesIncludesTargetColumn)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('RPA_KANBAN_MOVE_PERMISSION_NOTIFY').replace('#STAGE#', Text.encode(previousColumn.getName()))\n\t\t\t});\n\t\t\tthis.moveItem(item, item.getStageId(), item.getCurrentState().nextItemId);\n\t\t}\n\t\telse if(previousColumn.isCanMoveFrom() && !isPossibleNextStagesIncludesTargetColumn)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('RPA_KANBAN_MOVE_WRONG_STAGE_NOTIFY').replace('#STAGE_FROM#', Text.encode(previousColumn.getName())).replace('#STAGE_TO#', Text.encode(targetColumn.getName()))\n\t\t\t});\n\t\t\tthis.moveItem(item, item.getStageId(), item.getCurrentState().nextItemId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('RPA_KANBAN_MOVE_ITEM_PERMISSION_NOTIFY').replace('#ITEM#', Text.encode(item.getName())).replace('#STAGE#', Text.encode(previousColumn.getName()))\n\t\t\t});\n\t\t\tthis.moveItem(item, item.getStageId(), item.getCurrentState().nextItemId);\n\t\t}\n\t}\n\n\tmoveItemToStage(item: Item, targetColumnId: number, previousColumn: Column)\n\t{\n\t\tconst itemPreviousState = item.getCurrentState();\n\t\tif(item.hasEmptyMandatoryFields(previousColumn))\n\t\t{\n\t\t\tif(!previousColumn.canAddItems())\n\t\t\t{\n\t\t\t\tthis.moveItem(item, item.getStageId(), item.getCurrentState().nextItemId);\n\t\t\t\tKanban.Utils.showErrorDialog(Loc.getMessage('RPA_KANBAN_MOVE_EMPTY_MANDATORY_FIELDS_ERROR'), false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\titem.showEditor(targetColumnId).then((response) =>\n\t\t\t{\n\t\t\t\tthis.onEditorSave(item, response);\n\t\t\t}).catch((response) =>\n\t\t\t{\n\t\t\t\tthis.onItemMoveError(item, response, itemPreviousState);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst targetColumn = this.getColumn(targetColumnId);\n\t\t\tif(targetColumn)\n\t\t\t{\n\t\t\t\titem.saveCurrentState();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titem.setStageId(targetColumnId);\n\t\t\t}\n\t\t\titem.savePosition().catch((response) =>\n\t\t\t{\n\t\t\t\tlet isShowEditor = false;\n\t\t\t\tlet isShowTasks = false;\n\t\t\t\tlet isTasksError = false;\n\t\t\t\tresponse.errors.forEach((error) =>\n\t\t\t\t{\n\t\t\t\t\tif(error.code && error.code === 'RPA_MANDATORY_FIELD_EMPTY')\n\t\t\t\t\t{\n\t\t\t\t\t\t// show editor in case we missed some empty mandatory field\n\t\t\t\t\t\tisShowEditor = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if(error.code && error.code === 'RPA_ITEM_USER_HAS_TASKS')\n\t\t\t\t\t{\n\t\t\t\t\t\tisShowTasks = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if(error.code && error.code === 'RPA_ITEM_TASKS_NOT_COMPLETED')\n\t\t\t\t\t{\n\t\t\t\t\t\tisTasksError = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif(isShowEditor)\n\t\t\t\t{\n\t\t\t\t\tif(!previousColumn.canAddItems())\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('RPA_KANBAN_MOVE_ITEM_PERMISSION_NOTIFY').replace('#ITEM#', Text.encode(item.getName())).replace('#STAGE#', Text.encode(previousColumn.getName()))\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.onItemMoveError(item, null, itemPreviousState);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\titem.showEditor(targetColumnId).then((response) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif(response.cancel === true)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onItemMoveError(item, null, itemPreviousState);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch((response) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onItemMoveError(item, response, itemPreviousState);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse if(isShowTasks)\n\t\t\t\t{\n\t\t\t\t\titem.showTasks().then((response) =>\n\t\t\t\t\t{\n\t\t\t\t\t\t// move back\n\t\t\t\t\t\tif(response.isCompleted !== true)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onItemMoveError(item, null, itemPreviousState);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem.update(response);\n\t\t\t\t\t\t\tif(!item.moveToActualColumn())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.render();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch((response) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onItemMoveError(item, response, itemPreviousState);\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse if(isTasksError)\n\t\t\t\t{\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('RPA_KANBAN_MOVE_ITEM_HAS_TASKS_ERROR')\n\t\t\t\t\t});\n\t\t\t\t\tthis.onItemMoveError(item, null, itemPreviousState);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.onItemMoveError(item, response, itemPreviousState);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tonItemMoveError(item: Item, response: Object = null, previousState: Object = null)\n\t{\n\t\tif(previousState)\n\t\t{\n\t\t\titem.restoreState(previousState);\n\t\t\tif(!item.isVisible())\n\t\t\t{\n\t\t\t\tthis.unhideItem(item);\n\t\t\t}\n\t\t\tthis.moveItem(item, item.getStageId(), item.getCurrentState().nextItemId);\n\t\t}\n\t\tif(response)\n\t\t{\n\t\t\tthis.showErrorFromResponse(response);\n\t\t}\n\t}\n\n\tonEditorSave(item: Item, response: Object)\n\t{\n\t\tif(response.cancel === true)\n\t\t{\n\t\t\tthis.moveItem(item, item.getStageId(), item.getCurrentState().nextItemId);\n\t\t}\n\t\telse\n\t\t{\n\n\t\t}\n\t}\n\n\tshowErrorFromResponse(response: Object, fatal = false)\n\t{\n\t\tlet errors = null;\n\t\tif(Type.isPlainObject(response) && response.errors && Type.isArray(response.errors))\n\t\t{\n\t\t\terrors = response.errors;\n\t\t}\n\t\telse if(Type.isArray(response))\n\t\t{\n\t\t\terrors = response;\n\t\t}\n\t\tlet message = '';\n\t\tif(Type.isArray(errors))\n\t\t{\n\t\t\terrors.forEach((error) =>\n\t\t\t{\n\t\t\t\tmessage += Text.encode(error.message) + \"\\n\";\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmessage = 'Unknown error';\n\t\t}\n\t\tKanban.Utils.showErrorDialog(message, fatal);\n\t}\n\n\tonColumnUpdated(column: Column)\n\t{\n\t\tthis.startProgress();\n\t\tAjax.runAction('rpa.stage.update', {\n\t\t\tanalyticsLabel: 'rpaKanbanStageUpdate',\n\t\t\tdata: {\n\t\t\t\tid: column.getId(),\n\t\t\t\tfields: {\n\t\t\t\t\tname: column.getName(),\n\t\t\t\t\tcolor: column.getColor(),\n\t\t\t\t},\n\t\t\t\teventId: this.pullManager.registerRandomEventId(),\n\t\t\t},\n\t\t\tgetParameters: {\n\t\t\t\tcontext: 'kanban',\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tcolumn.update(response.data);\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tthis.showErrorFromResponse(response, true);\n\t\t});\n\t}\n\n\taddStage(column: Column): BX.Promise\n\t{\n\t\tthis.startProgress();\n\t\tconst previousColumn = this.getPreviousColumnSibling(column);\n\t\tconst previousColumnId = previousColumn ? previousColumn.getId() : 0;\n\n\t\tconst promise = new BX.Promise();\n\t\tAjax.runAction('rpa.stage.add', {\n\t\t\tanalyticsLabel: 'rpaKanbanStageAdd',\n\t\t\tdata: {\n\t\t\t\tfields: {\n\t\t\t\t\tname: column.getName(),\n\t\t\t\t\tcolor: column.getColor(),\n\t\t\t\t\tpreviousStageId: previousColumnId,\n\t\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\t},\n\t\t\t\teventId: this.pullManager.registerRandomEventId(),\n\t\t\t},\n\t\t\tgetParameters: {\n\t\t\t\tcontext: 'kanban',\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tpromise.fulfill(this.transformColumnActionResponseToColumnOptions(response));\n\t\t\tthis.stopProgress();\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tconst error = response.errors.pop().message;\n\t\t\tpromise.reject(error);\n\t\t\tthis.stopProgress();\n\t\t});\n\n\t\treturn promise;\n\t}\n\n\tremoveStage(column: Column): BX.promise\n\t{\n\t\tconst promise = new BX.Promise();\n\t\tthis.startProgress();\n\t\tAjax.runAction('rpa.stage.delete', {\n\t\t\tanalyticsLabel: 'rpaKanbanStageDelete',\n\t\t\tdata: {\n\t\t\t\tid: column.getId(),\n\t\t\t},\n\t\t\tgetParameters: {\n\t\t\t\tcontext: 'kanban',\n\t\t\t}\n\t\t}).then(() =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tpromise.fulfill();\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tconst error = response.errors.pop().message;\n\t\t\tcolumn.enableDragging();\n\t\t\tcolumn.getContainer().classList.remove(\"main-kanban-column-edit-mode\");\n\t\t\tpromise.reject(error);\n\t\t});\n\n\t\treturn promise;\n\t}\n\n\tonColumnMoved(column: Column)\n\t{\n\t\tconst previousColumn = this.getPreviousColumnSibling(column);\n\t\tconst previousColumnId = previousColumn ? previousColumn.getId() : 0;\n\n\t\tAjax.runAction('rpa.stage.update', {\n\t\t\tanalyticsLabel: 'rpaKanbanStageMove',\n\t\t\tdata: {\n\t\t\t\tid: column.getId(),\n\t\t\t\tfields: {\n\t\t\t\t\tpreviousStageId: previousColumnId,\n\t\t\t\t},\n\t\t\t\teventId: this.pullManager.registerRandomEventId(),\n\t\t\t},\n\t\t\tgetParameters: {\n\t\t\t\tcontext: 'kanban',\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tconst wasFirst = column.isFirstColumn();\n\t\t\tlet isFirst = true;\n\t\t\tcolumn.update(response.data);\n\t\t\tif(column.isFirstColumn() && wasFirst)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(column.isFirstColumn() || wasFirst)\n\t\t\t{\n\t\t\t\tthis.getColumns().forEach((renderedColumn) =>\n\t\t\t\t{\n\t\t\t\t\tif(renderedColumn !== column)\n\t\t\t\t\t{\n\t\t\t\t\t\trenderedColumn.setIsFirstColumn((wasFirst && isFirst));\n\t\t\t\t\t\tisFirst = false;\n\t\t\t\t\t}\n\t\t\t\t\trenderedColumn.rerenderSubtitle();\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.getFirstColumn().rerenderSubtitle();\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.showErrorFromResponse(response, true);\n\t\t});\n\t}\n\n\ttransformColumnActionResponseToColumnOptions(response: Object): Object\n\t{\n\t\treturn {\n\t\t\tid: response.data.stage.id,\n\t\t\tname: response.data.stage.name,\n\t\t\tcolor: response.data.stage.color,\n\t\t\ttotal: response.data.stage.total,\n\t\t\tdata: response.data.stage,\n\t\t};\n\t}\n\n\tgetColumnItems(column: Column): BX.Promise\n\t{\n\t\tconst page = column.getPagination().page + 1;\n\t\tconst size = this.getData().pageSize;\n\t\tconst promise = new BX.Promise();\n\t\tAjax.runComponentAction('bitrix:rpa.kanban', 'getColumn', {\n\t\t\tmode: 'class',\n\t\t\tanalyticsLabel: 'rpaKanbanPagination',\n\t\t\tsignedParameters: this.getData().signedParameters,\n\t\t\tdata: {\n\t\t\t\tstageId: column.getId(),\n\t\t\t},\n\t\t\tnavigation: {page, size},\n\t\t}).then((response) =>\n\t\t{\n\t\t\tlet items = [];\n\t\t\tresponse.data.items.forEach((itemData) =>\n\t\t\t{\n\t\t\t\titems.push({\n\t\t\t\t\tid: itemData.id,\n\t\t\t\t\tcolumnId: itemData.stageId,\n\t\t\t\t\tname: itemData.name,\n\t\t\t\t\tdata: itemData,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tpromise.fulfill(items);\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tconst error = response.errors.pop().message;\n\t\t\tpromise.reject(error);\n\t\t});\n\n\t\treturn promise;\n\t}\n\n\tinsertItem(item: Item)\n\t{\n\t\tif(!(item instanceof Item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet beforeItem = null;\n\t\tconst newColumn = this.getColumn(item.getStageId());\n\t\tif(newColumn)\n\t\t{\n\t\t\tbeforeItem = newColumn.getFirstItem();\n\t\t\tthis.moveItem(item, item.getStageId(), beforeItem);\n\t\t\titem.processPermissions();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.removeItem(item);\n\t\t}\n\t}\n\n\tonApplyFilter(filterId, values, filterInstance, promise, params)\n\t{\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tparams.autoResolve = false;\n\t\t}\n\n\t\tthis.startProgress();\n\t\tAjax.runComponentAction('bitrix:rpa.kanban', 'get', {\n\t\t\tanalyticsLabel: 'rpaKanbanApplyFilter',\n\t\t\tsignedParameters: this.getData().signedParameters,\n\t\t\tmode: 'class',\n\t\t}).then((response) =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tthis.getColumns().forEach((column) =>\n\t\t\t{\n\t\t\t\tconst pagination = column.getPagination();\n\t\t\t\tif(pagination)\n\t\t\t\t{\n\t\t\t\t\tpagination.page = 1;\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.getColumns().forEach((column) =>\n\t\t\t{\n\t\t\t\tthis.removeColumn(column);\n\t\t\t});\n\t\t\tthis.removeItems();\n\t\t\tthis.loadData(response.data.kanban);\n\t\t\tif(!Type.isNil(promise))\n\t\t\t{\n\t\t\t\tpromise.fulfill();\n\t\t\t}\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tthis.showErrorFromResponse(response);\n\t\t\tif(!Type.isNil(promise))\n\t\t\t{\n\t\t\t\tpromise.reject();\n\t\t\t}\n\t\t});\n\t}\n\n\tloadData(json: {\n\t\tcolumns: Array<Column>;\n\t\titems: Array<Item>;\n\t\tdropZones: Array<Kanban.DropZone>;\n\t\tdata: {\n\t\t\tusers: ?Object\n\t\t}\n\t})\n\t{\n\t\tif(Type.isPlainObject(json.data))\n\t\t{\n\t\t\tthis.addUsers(json.data.users);\n\t\t\tthis.data.fields = json.data.fields;\n\t\t}\n\n\t\tsuper.loadData(json);\n\t}\n\n\taddUsers(users: Object)\n\t{\n\t\tif(Type.isPlainObject(users))\n\t\t{\n\t\t\tif(!this.users)\n\t\t\t{\n\t\t\t\tthis.users = new Map();\n\t\t\t}\n\t\t\tObject.keys(users).forEach((userId) =>\n\t\t\t{\n\t\t\t\tuserId = Text.toInteger(userId);\n\t\t\t\tif(userId > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.users.set(userId, users[userId]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetUser(userId: number): ?{\n\t\tid: number,\n\t\tfullName: ?string,\n\t\tlink: ?string,\n\t\tphoto: ?string\n\t}\n\t{\n\t\tif(!this.users)\n\t\t{\n\t\t\tthis.users = new Map();\n\t\t}\n\n\t\treturn this.users.get(userId);\n\t}\n\n\tgetFields(): Object\n\t{\n\t\tlet fields = this.getData().fields;\n\t\tif(!fields || !Type.isPlainObject(fields))\n\t\t{\n\t\t\tfields = {};\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tonOpenSelectFieldMenu(editor, params: Object)\n\t{\n\t\tparams.cancel = true;\n\n\t\tconst popupId = 'rpa-kanban-column-select-fields-menu-' + this.getTypeId();\n\t\tlet popup = PopupWindowManager.getPopupById(popupId);\n\t\tif(!popup)\n\t\t{\n\t\t\tpopup = new PopupMenuWindow({\n\t\t\t\tid: 'rpa-kanban-column-select-fields-menu-' + this.getTypeId(),\n\t\t\t\tbindElement: params.button,\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('RPA_KANBAN_FIELDS_VIEW_SETTINGS'),\n\t\t\t\t\t\tonclick: this.onSelectFieldsViewSettingsClick.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('RPA_KANBAN_FIELDS_MODIFY_SETTINGS'),\n\t\t\t\t\t\tonclick: this.onSelectFieldsModifySettingsClick.bind(this),\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcacheable: false,\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpopup.setBindElement(params.button);\n\t\t}\n\n\t\tpopup.show();\n\t}\n\n\tonSelectFieldsViewSettingsClick()\n\t{\n\t\tif(!this.canAddColumns())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst fields = this.getFields();\n\t\tconst data = [];\n\t\tObject.keys(fields).forEach((fieldName) =>\n\t\t{\n\t\t\tdata.push({\n\t\t\t\ttitle: fields[fieldName].title,\n\t\t\t\tname: fieldName,\n\t\t\t\tchecked: fields[fieldName].isVisibleOnKanban,\n\t\t\t});\n\t\t});\n\t\tconst fieldsPopup = new FieldsPopup('rpa-kanban-view-' + this.getTypeId(), data, Loc.getMessage('RPA_KANBAN_FIELDS_VIEW_SETTINGS'));\n\t\tfieldsPopup.show().then((result: Set|false) =>\n\t\t{\n\t\t\tif(result !== false)\n\t\t\t{\n\t\t\t\tif(this.isProgress())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.startProgress();\n\t\t\t\tAjax.runAction('rpa.fields.setVisibilitySettings', {\n\t\t\t\t\tanalyticsLabel: 'rpaKanbanSaveVisibleFields',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\t\t\tfields: Array.from(result),\n\t\t\t\t\t\tvisibility: 'kanban',\n\t\t\t\t\t}\n\t\t\t\t}).then((response) =>\n\t\t\t\t{\n\t\t\t\t\tthis.stopProgress();\n\t\t\t\t\tObject.keys(this.getFields()).forEach((fieldName) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.data.fields[fieldName]['isVisibleOnKanban'] = result.has(fieldName);\n\t\t\t\t\t});\n\t\t\t\t\tthis.getColumns().forEach((column) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tcolumn.getItems().forEach((item) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem.render();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}).catch((response) =>\n\t\t\t\t{\n\t\t\t\t\tthis.stopProgress();\n\t\t\t\t\tthis.showErrorFromResponse(response);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tonSelectFieldsModifySettingsClick()\n\t{\n\t\tif(!this.canAddColumns())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst firstColumn = this.getFirstColumn();\n\t\tif(!firstColumn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst editor = firstColumn.getEditor();\n\t\tif(!editor)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst fields = this.getFields();\n\t\tconst data = [];\n\t\tObject.keys(fields).forEach((fieldName) =>\n\t\t{\n\t\t\tif(fields[fieldName].canBeEdited)\n\t\t\t{\n\t\t\t\tdata.push({\n\t\t\t\t\ttitle: fields[fieldName].title,\n\t\t\t\t\tname: fieldName,\n\t\t\t\t\tchecked: !!editor.getControlById(fieldName),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tconst fieldsPopup = new FieldsPopup('rpa-kanban-edit-' + this.getTypeId(), data, Loc.getMessage('RPA_KANBAN_FIELDS_MODIFY_SETTINGS'));\n\t\tfieldsPopup.show().then((result) =>\n\t\t{\n\t\t\tif(!result)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(this.isProgress())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.startProgress();\n\t\t\tAjax.runAction('rpa.fields.setVisibilitySettings', {\n\t\t\t\tdata: {\n\t\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\t\tfields: Array.from(result),\n\t\t\t\t\tvisibility: 'create',\n\t\t\t\t},\n\t\t\t\tanalyticsLabel: 'rpaKanbanSaveCreateFields',\n\t\t\t}).then((response) =>\n\t\t\t{\n\t\t\t\tthis.stopProgress();\n\t\t\t\tthis.syncEditorFields(editor, result);\n\n\t\t\t}).catch((response) =>\n\t\t\t{\n\t\t\t\tthis.stopProgress();\n\t\t\t\tthis.showErrorFromResponse(response);\n\t\t\t});\n\t\t});\n\t}\n\n\tsyncEditorFields(editor: BX.UI.EntityEditor, availableFields: Set)\n\t{\n\t\tconst fields = this.getFields();\n\t\tconst editorMainSection = this.getEditorMainSection(editor);\n\t\tif(!editorMainSection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tObject.keys(fields).forEach((fieldName) =>\n\t\t{\n\t\t\tlet control = editor.getControlById(fieldName);\n\t\t\tif(control && !availableFields.has(fieldName))\n\t\t\t{\n\t\t\t\teditorMainSection.removeChild(control, { enableSaving: false });\n\t\t\t}\n\t\t\telse if(!control && availableFields.has(fieldName))\n\t\t\t{\n\t\t\t\tlet element = editor.getAvailableSchemeElementByName(fieldName);\n\t\t\t\tif(element)\n\t\t\t\t{\n\t\t\t\t\tlet field = editor.createControl(element.getType(), element.getName(), {\n\t\t\t\t\t\tschemeElement: element,\n\t\t\t\t\t\tmodel: editor._model,\n\t\t\t\t\t\tmode: editor._mode\n\t\t\t\t\t});\n\t\t\t\t\tif(field)\n\t\t\t\t\t{\n\t\t\t\t\t\teditorMainSection.addChild(\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlayout: { forceDisplay: true },\n\t\t\t\t\t\t\t\tenableSaving: false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tgetEditorMainSection(editor)\n\t{\n\t\tlet editorMainSection = editor.getControlById('main');\n\t\tif(editorMainSection instanceof BX.UI.EntityEditorColumn)\n\t\t{\n\t\t\teditorMainSection = editorMainSection.getChildById('main');\n\t\t}\n\n\t\treturn editorMainSection;\n\t}\n\n\tisProgress(): boolean\n\t{\n\t\treturn (this.progress === true);\n\t}\n\n\tstartProgress(): Grid\n\t{\n\t\tthis.progress = true;\n\t\tthis.showLoader().fadeOut();\n\n\t\treturn this;\n\t}\n\n\tstopProgress(): Grid\n\t{\n\t\tthis.progress = false;\n\t\tthis.hideLoader().fadeIn();\n\n\t\treturn this;\n\t}\n\n\tshowLoader(): Grid\n\t{\n\t\tthis.getLoader().style.display = 'block';\n\n\t\treturn this;\n\t}\n\n\thideLoader(): Grid\n\t{\n\t\tthis.getLoader().style.display = 'none';\n\n\t\treturn this;\n\t}\n\n\tdeleteItem(item: Item)\n\t{\n\t\tif(this.isProgress())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.startProgress();\n\t\tAjax.runAction('rpa.item.delete', {\n\t\t\tanalyticsLabel: 'rpaKanbanItemDelete',\n\t\t\tdata: {\n\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\tid: item.getId(),\n\t\t\t}\n\t\t}).then(() =>\n\t\t{\n\t\t\tif(this.getItem(item))\n\t\t\t{\n\t\t\t\titem.getColumn().removeItem(item);\n\t\t\t}\n\t\t\tthis.stopProgress();\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.stopProgress();\n\t\t\tthis.showErrorFromResponse(response);\n\t\t});\n\t}\n}\n\nclass Command\n{\n\tconstructor(item: Item, action: Function, restore: ?Function)\n\t{\n\t\tthis.item = item;\n\t\tthis.action = action;\n\t\tthis.restore = restore;\n\t\tthis.timeoutId = null;\n\t}\n\n\tstart(timeout: number)\n\t{\n\t\tthis.timeoutId = setTimeout(this.run.bind(this), timeout);\n\t}\n\n\trun()\n\t{\n\t\tclearTimeout(this.timeoutId);\n\t\tthis.timeoutId = null;\n\t\tif(Type.isFunction(this.action))\n\t\t{\n\t\t\tthis.action(this.item);\n\t\t}\n\t}\n\n\tcancel()\n\t{\n\t\tclearTimeout(this.timeoutId);\n\t\tthis.timeoutId = null;\n\t\tif(Type.isFunction(this.restore))\n\t\t{\n\t\t\tthis.restore(this.item);\n\t\t}\n\t}\n\n\tisCompleted(): boolean\n\t{\n\t\treturn (!(this.timeoutId > 0));\n\t}\n}","import 'ui.design-tokens';\n\nimport Grid from './grid';\nimport Item from './item';\nimport Column from './column';\n\nexport const Kanban = {\n\tGrid,\n\tItem,\n\tColumn,\n};"],"names":["PullManager","grid","eventIds","Set","RpaKanban","Grid","Type","isArray","getData","forEach","eventId","add","isString","pullTag","moduleId","userId","init","Text","getRandom","registerEventId","Event","ready","Pull","BX","PULL","console","error","subscribe","command","callback","params","eventName","has","indexOf","getTypeId","isPlainObject","item","onPullItemUpdated","onPullItemAdded","onPullItemDeleted","stage","onPullStageAdded","onPullStageUpdated","onPullStageDeleted","robot","onPullRobotAdded","onPullRobotUpdated","onPullRobotDeleted","onPullTypeUpdated","extendWatch","taskCountersPullTag","toInteger","typeId","onPullCounters","addUsers","users","getItem","id","setData","insertItem","column","getColumn","stageId","isCanMoveFrom","canAddItems","itemData","oldItem","Item","columnId","name","data","setGrid","items","getId","getStageId","addItem","getFirstItem","removeItem","onApplyFilter","update","removeColumn","onPullRobotChanged","robotName","setTasks","getTasks","filter","filteredTask","rerenderSubtitle","loadTasks","then","itemId","currentCounter","getTasksCounter","counter","setTasksCounter","tasksFaces","setTasksParticipants","render","Column","parseInt","options","canMoveFrom","setPermissionProperties","canMoveTo","isFirst","isDroppable","getContainer","style","backgroundColor","nodeNames","nodeName","Dom","clean","layout","subtitleNode","tasksPopup","destroy","renderSubTitle","subTitleNode","getSubTitleNode","isEditable","tasks","robotsCnt","length","appendChild","renderSubTitleTasks","isFirstColumn","renderSubTitleAddTaskButton","renderSubTitleAddButton","subTitleAddButton","remove","Tag","container","quickFormContainer","renderQuickFormContainer","itemsContainer","getItemsContainer","parentNode","prepend","handleAddItemButtonClick","bind","className","getGrid","canAddColumns","quickFormButtons","handleFormSaveButtonClick","Loc","getMessage","handleFormCancelButtonClick","isProgress","isCreateItemRestricted","Manager","Instance","showFeatureSlider","isFormVisible","startProgress","Ajax","runAction","analyticsLabel","pullManager","registerRandomEventId","response","stopProgress","Runtime","html","addSelectButtonToEditor","append","renderQuickFormButtons","showForm","bindKeyDownEvents","showErrorFromResponse","getBody","scrollTop","display","getEditor","editor","rollback","refreshLayout","hideForm","save","bindEditorEvents","entityData","errors","isEditorEventsBinded","addCustomEvent","window","onEditorErrors","onEditorSubmit","isKeyDownEventsBinded","onEnterKeyDown","event","code","isCtrlKey","unbind","subTitleSettingsButton","openSettings","url","settingsUrl","openSlider","slider","get","subTitleAddTaskButton","buildAddRobotUrl","subTitleTasks","renderSubTitleResponsible","renderSubTitleTasksButton","subTitleTasksButton","showTasks","showTaskListMenu","responsibleElements","plusHandler","task","user","getColor","photoSrc","encode","push","sliceResponsibleListElements","plusNode","canAppendResponsibles","Bizproc","UserSelector","decorateNode","isOnlyDialogMode","callbacks","select","addTaskUserHandler","buildEditRobotUrl","elements","slice","getTasksPopup","show","value","selector","userValue","getParameters","context","button","Popup","autoHide","draggable","offsetTop","offsetLeft","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","cacheable","angle","offset","position","events","onPopupDestroy","overlay","content","renderTasksPopup","map","deleteTaskHandler","MessageBox","message","buttons","MessageBoxButtons","OK_CANCEL","onOk","promise","Promise","fulfill","reject","popupOptions","zIndexAbsolute","Uri","setQueryParams","fields","userFields","getFields","possibleNextStages","sort","result","getColumns","getPossibleNextStages","includes","stageData","setName","setColor","color","processPermissions","moveColumn","getTargetColumn","onAfterRender","columns","targetColumn","gridColumn","getSort","processDraggingOptions","permissions","Object","keys","isDraggable","makeDraggable","disableDragging","makeDroppable","disableDropping","getItems","resolve","Array","from","editorMainSection","getEditorMainSection","_addChildButton","ensureButtonPanelCreated","create","props","text","click","delegate","onAddChildBtnClick","addButtonElement","Kanban","title","renderDescription","renderFieldsList","renderShadow","onDoubleClick","fieldList","description","renderTasksParticipants","renderTasksCounter","setProperty","bindOnce","removeClass","tasksCounter","currentUserId","getUserId","startedBy","getUser","faces","completedById","completed","waitingForId","running","completedCnt","waitingForCnt","completedBy","waitingFor","addClass","popup","getPopup","getContentContainer","editorResolve","editorReject","close","isFunction","cancel","isShown","saveCurrentState","popupId","PopupWindowManager","getPopupById","PopupWindow","zIndex","closeIcon","width","lightShadow","getItemPopupButtons","PopupWindowButton","onEditorSaveClick","onEditorCancelClick","openTasks","nextItem","getNextItemSibling","previousItem","getPreviousItemSibling","getColumnId","currentState","nextItemId","previousItemId","moveToActualColumn","moveItem","assign","previousState","detailUrl","movedBy","updatedBy","createdBy","href","innerText","innerHTML","fieldName","isEmptyValue","renderTitle","renderedUser","renderUser","getDisplayableValue","link","photo","userInfo","renderUserPhoto","fullName","getTasksParticipants","renderTaskParticipant","isMore","Error","mandatory","isNil","isNumber","join","canDelete","onBeforeItemCaptured","onBeforeItemRestored","apply","promises","getColumnItems","saveItemState","onItemMoved","onColumnUpdated","onColumnMoved","addStage","removeStage","onOpenSelectFieldMenu","getEventId","dropZoneEvent","EventEmitter","emit","isActionAllowed","dropZone","getDropZone","isDeletable","denyAction","deleteCommand","isCompleted","run","Command","commandItem","deleteItem","unhideItem","start","getDropZoneArea","getDropZoneTimeout","isColumn","hideItem","moveItemToStage","dropEvent","beforeItem","skipHandler","itemPreviousState","getCurrentState","saveSort","onItemMoveError","previousColumn","isPossibleNextStagesIncludesTargetColumn","UI","Notification","Center","notify","replace","getName","targetColumnId","hasEmptyMandatoryFields","Utils","showErrorDialog","showEditor","onEditorSave","setStageId","savePosition","isShowEditor","isShowTasks","isTasksError","restoreState","isVisible","fatal","getPreviousColumnSibling","previousColumnId","previousStageId","transformColumnActionResponseToColumnOptions","pop","enableDragging","classList","wasFirst","renderedColumn","setIsFirstColumn","getFirstColumn","total","page","getPagination","size","pageSize","runComponentAction","mode","signedParameters","navigation","newColumn","filterId","values","filterInstance","autoResolve","pagination","removeItems","loadData","kanban","json","Map","set","PopupMenuWindow","bindElement","onclick","onSelectFieldsViewSettingsClick","onSelectFieldsModifySettingsClick","setBindElement","checked","isVisibleOnKanban","fieldsPopup","FieldsPopup","visibility","firstColumn","canBeEdited","getControlById","syncEditorFields","availableFields","control","removeChild","enableSaving","element","getAvailableSchemeElementByName","field","createControl","getType","schemeElement","model","_model","_mode","addChild","forceDisplay","EntityEditorColumn","getChildById","progress","showLoader","fadeOut","hideLoader","fadeIn","getLoader","action","restore","timeoutId","timeout","setTimeout","clearTimeout"],"mappings":"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"}