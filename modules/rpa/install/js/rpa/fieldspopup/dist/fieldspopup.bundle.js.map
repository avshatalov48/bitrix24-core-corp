{"version":3,"file":"fieldspopup.bundle.js","sources":["../src/fieldspopup.js"],"sourcesContent":["import {Tag, Loc, Type, Text} from \"main.core\";\nimport {PopupWindowManager, Popup, PopupWindowButton} from \"main.popup\";\n\nexport class FieldsPopup\n{\n\tconstructor(id: string, fields: Array, title: string)\n\t{\n\t\tthis.selectedFields = new Set();\n\t\tthis.fields = new Map();\n\t\tif(Type.isString(id))\n\t\t{\n\t\t\tthis.title = title;\n\t\t\tthis.id = id;\n\t\t\tif(Type.isArray(fields))\n\t\t\t{\n\t\t\t\tfields.forEach((field) =>\n\t\t\t\t{\n\t\t\t\t\tthis.fields.set(field.name, field);\n\t\t\t\t});\n\t\t\t\tthis.save();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetPopup(onSave: Function): Popup\n\t{\n\t\tlet popup = PopupWindowManager.getPopupById(this.id);\n\n\t\tif(!popup)\n\t\t{\n\t\t\tpopup = new BX.PopupWindow(this.id, null, {\n\t\t\t\ttitleBar: this.title,\n\t\t\t\tzIndex: 200,\n\t\t\t\tclassName: \"rpa-fields-popup\",\n\t\t\t\tautoHide: false,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcloseIcon: false,\n\t\t\t\tcontent : this.getContent(),\n\t\t\t\twidth: 500,\n\t\t\t\toverlay: true,\n\t\t\t\tlightShadow: false,\n\t\t\t\tbuttons: this.getButtons(),\n\t\t\t\tcacheable: false,\n\t\t\t});\n\t\t}\n\n\t\tif(Type.isFunction(onSave))\n\t\t{\n\t\t\tpopup.setButtons(this.getButtons(onSave));\n\t\t}\n\n\t\treturn popup;\n\t}\n\n\tgetButtons(onSave: Function): Array\n\t{\n\t\treturn [\n\t\t\tnew PopupWindowButton({\n\t\t\t\ttext : Loc.getMessage('RPA_POPUP_SAVE_BUTTON'),\n\t\t\t\tclassName : \"ui-btn ui-btn-md ui-btn-primary\",\n\t\t\t\tevents : {\n\t\t\t\t\tclick : () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.save();\n\t\t\t\t\t\tif(Type.isFunction(onSave))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonSave(this.getSelectedFields());\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.getPopup().close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}),\n\t\t\tnew PopupWindowButton({\n\t\t\t\ttext : Loc.getMessage('RPA_POPUP_CANCEL_BUTTON'),\n\t\t\t\tclassName : \"ui-btn ui-btn-md\",\n\t\t\t\tevents : {\n\t\t\t\t\tclick : () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif(Type.isFunction(onSave))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonSave(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.getPopup().close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t];\n\t}\n\n\tgetContent(): Element\n\t{\n\t\tlet content = '';\n\t\tthis.fields.forEach((field) =>\n\t\t{\n\t\t\tcontent += this.renderField(field);\n\t\t});\n\t\treturn Tag.render`<div class=\"rpa-fields-popup-wrapper\">\n\t\t\t\t\t\t\t<div class=\"rpa-fields-popup-inner\">${content}</div>\n\t\t\t\t\t\t</div>`;\n\t}\n\n\trenderField({title, name, checked}): string\n\t{\n\t\tlet checkedString = (checked === true ? 'checked=\"checked\"': '');\n\n\t\treturn `\n\t\t<label class=\"ui-ctl ui-ctl-checkbox\">\n\t\t\t<input data-role=\"field-checkbox\" type=\"checkbox\" class=\"ui-ctl-element\" name=\"${Text.encode(name)}\" value=\"y\" ${checkedString}>\n\t\t\t<div class=\"ui-ctl-label-text\">${Text.encode(title)}</div>\n\t\t</label>`;\n\t}\n\n\tshow(): Promise\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tthis.getPopup(resolve).show();\n\t\t});\n\t}\n\n\tgetSelectedFields(): Set\n\t{\n\t\treturn this.selectedFields;\n\t}\n\n\tsave()\n\t{\n\t\tthis.selectedFields.clear();\n\t\tlet container = this.getPopup().getContentContainer();\n\t\tif(container)\n\t\t{\n\t\t\tlet inputs = Array.from(container.querySelectorAll('[data-role=\"field-checkbox\"]'));\n\t\t\tinputs.forEach((input) =>\n\t\t\t{\n\t\t\t\tif(input.checked)\n\t\t\t\t{\n\t\t\t\t\tthis.selectedFields.add(input.name);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tthis.getPopup().close();\n\t}\n}"],"names":["FieldsPopup","id","fields","title","selectedFields","Set","Map","Type","isString","isArray","forEach","field","set","name","save","onSave","popup","PopupWindowManager","getPopupById","BX","PopupWindow","titleBar","zIndex","className","autoHide","closeByEsc","closeIcon","content","getContent","width","overlay","lightShadow","buttons","getButtons","cacheable","isFunction","setButtons","PopupWindowButton","text","Loc","getMessage","events","click","getSelectedFields","getPopup","close","renderField","Tag","render","checked","checkedString","Text","encode","Promise","resolve","show","clear","container","getContentContainer","inputs","Array","from","querySelectorAll","input","add"],"mappings":"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"}