{"version":3,"file":"fieldspopup.bundle.js","sources":["../src/fieldspopup.js"],"sourcesContent":["import {Tag, Loc, Type, Text} from \"main.core\";\nimport {PopupWindowManager, Popup, PopupWindowButton} from \"main.popup\";\n\nexport class FieldsPopup\n{\n\tconstructor(id: string, fields: Array, title: string)\n\t{\n\t\tthis.selectedFields = new Set();\n\t\tthis.fields = new Map();\n\t\tif(Type.isString(id))\n\t\t{\n\t\t\tthis.title = title;\n\t\t\tthis.id = id;\n\t\t\tif(Type.isArray(fields))\n\t\t\t{\n\t\t\t\tfields.forEach((field) =>\n\t\t\t\t{\n\t\t\t\t\tthis.fields.set(field.name, field);\n\t\t\t\t});\n\t\t\t\tthis.save();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetPopup(onSave: Function): Popup\n\t{\n\t\tlet popup = PopupWindowManager.getPopupById(this.id);\n\n\t\tif(!popup)\n\t\t{\n\t\t\tpopup = new BX.PopupWindow(this.id, null, {\n\t\t\t\ttitleBar: this.title,\n\t\t\t\tzIndex: 200,\n\t\t\t\tclassName: \"rpa-fields-popup\",\n\t\t\t\tautoHide: false,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcloseIcon: false,\n\t\t\t\tcontent : this.getContent(),\n\t\t\t\twidth: 500,\n\t\t\t\toverlay: true,\n\t\t\t\tlightShadow: false,\n\t\t\t\tbuttons: this.getButtons(),\n\t\t\t\tcacheable: false,\n\t\t\t});\n\t\t}\n\n\t\tif(Type.isFunction(onSave))\n\t\t{\n\t\t\tpopup.setButtons(this.getButtons(onSave));\n\t\t}\n\n\t\treturn popup;\n\t}\n\n\tgetButtons(onSave: Function): Array\n\t{\n\t\treturn [\n\t\t\tnew PopupWindowButton({\n\t\t\t\ttext : Loc.getMessage('RPA_POPUP_SAVE_BUTTON'),\n\t\t\t\tclassName : \"ui-btn ui-btn-md ui-btn-primary\",\n\t\t\t\tevents : {\n\t\t\t\t\tclick : () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.save();\n\t\t\t\t\t\tif(Type.isFunction(onSave))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonSave(this.getSelectedFields());\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.getPopup().close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}),\n\t\t\tnew PopupWindowButton({\n\t\t\t\ttext : Loc.getMessage('RPA_POPUP_CANCEL_BUTTON'),\n\t\t\t\tclassName : \"ui-btn ui-btn-md\",\n\t\t\t\tevents : {\n\t\t\t\t\tclick : () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif(Type.isFunction(onSave))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonSave(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.getPopup().close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t];\n\t}\n\n\tgetContent(): Element\n\t{\n\t\tlet content = '';\n\t\tthis.fields.forEach((field) =>\n\t\t{\n\t\t\tcontent += this.renderField(field);\n\t\t});\n\t\treturn Tag.render`<div class=\"rpa-fields-popup-wrapper\">\n\t\t\t\t\t\t\t<div class=\"rpa-fields-popup-inner\">${content}</div>\n\t\t\t\t\t\t</div>`;\n\t}\n\n\trenderField({title, name, checked}): string\n\t{\n\t\tlet checkedString = (checked === true ? 'checked=\"checked\"': '');\n\n\t\treturn `\n\t\t<label class=\"ui-ctl ui-ctl-checkbox\">\n\t\t\t<input data-role=\"field-checkbox\" type=\"checkbox\" class=\"ui-ctl-element\" name=\"${Text.encode(name)}\" value=\"y\" ${checkedString}>\n\t\t\t<div class=\"ui-ctl-label-text\">${Text.encode(title)}</div>\n\t\t</label>`;\n\t}\n\n\tshow(): Promise\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tthis.getPopup(resolve).show();\n\t\t});\n\t}\n\n\tgetSelectedFields(): Set\n\t{\n\t\treturn this.selectedFields;\n\t}\n\n\tsave()\n\t{\n\t\tthis.selectedFields.clear();\n\t\tlet container = this.getPopup().getContentContainer();\n\t\tif(container)\n\t\t{\n\t\t\tlet inputs = Array.from(container.querySelectorAll('[data-role=\"field-checkbox\"]'));\n\t\t\tinputs.forEach((input) =>\n\t\t\t{\n\t\t\t\tif(input.checked)\n\t\t\t\t{\n\t\t\t\t\tthis.selectedFields.add(input.name);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tthis.getPopup().close();\n\t}\n}"],"names":["FieldsPopup","id","fields","title","selectedFields","Set","Map","Type","isString","isArray","forEach","field","set","name","save","onSave","popup","PopupWindowManager","getPopupById","BX","PopupWindow","titleBar","zIndex","className","autoHide","closeByEsc","closeIcon","content","getContent","width","overlay","lightShadow","buttons","getButtons","cacheable","isFunction","setButtons","PopupWindowButton","text","Loc","getMessage","events","click","getSelectedFields","getPopup","close","renderField","Tag","render","checked","checkedString","Text","encode","Promise","resolve","show","clear","container","getContentContainer","inputs","Array","from","querySelectorAll","input","add"],"mappings":"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"}