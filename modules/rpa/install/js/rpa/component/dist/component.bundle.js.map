{"version":3,"file":"component.bundle.js","sources":["../src/component.js"],"sourcesContent":["import {Dom, Type, ajax as Ajax, Event, Reflection} from \"main.core\";\nimport {Loader} from \"main.loader\";\n\nexport class Component\n{\n\tanalyticsLabel = '';\n\terrorsContainer;\n\tparams;\n\n\tconstructor(form, params)\n\t{\n\t\tthis.params = params;\n\t\tthis.form = form;\n\t\tthis.saveButton = document.getElementById('ui-button-panel-save');\n\t\tthis.cancelButton = document.getElementById('ui-button-panel-cancel');\n\t\tthis.deleteButton = document.getElementById('ui-button-panel-remove');\n\n\t\tif(Type.isString(params.analyticsLabel))\n\t\t{\n\t\t\tthis.analyticsLabel = params.analyticsLabel;\n\t\t}\n\t\tif(Type.isString(params.method))\n\t\t{\n\t\t\tthis.method = params.method;\n\t\t}\n\t\tif(Type.isDomNode(params.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer = params.errorsContainer;\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEvent.bind(this.saveButton, 'click', (event) =>\n\t\t\t{\n\t\t\t\tthis.save(event);\n\t\t\t}, {\n\t\t\t\tpassive: false\n\t\t\t}\n\t\t);\n\n\t\tif(this.deleteButton)\n\t\t{\n\t\t\tEvent.bind(this.deleteButton, 'click', (event) =>\n\t\t\t{\n\t\t\t\tthis.delete(event);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetLoader()\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({size: 150});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.isProgress = true;\n\t\tif(!this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().show(this.form);\n\t\t}\n\t\tthis.hideErrors();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tthis.getLoader().hide();\n\t\tsetTimeout(() =>\n\t\t{\n\t\t\tDom.removeClass(this.saveButton, 'ui-btn-wait');\n\t\t\tDom.removeClass(this.closeButton, 'ui-btn-wait');\n\t\t\tif(this.deleteButton)\n\t\t\t{\n\t\t\t\tDom.removeClass(this.deleteButton, 'ui-btn-wait');\n\t\t\t}\n\t\t}, 200);\n\t}\n\n\tprepareData()\n\t{\n\n\t}\n\n\tsave(event)\n\t{\n\t\tevent.preventDefault();\n\t\tif(!this.form)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(!this.method)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.startProgress();\n\t\tlet data = this.prepareData();\n\n\t\tAjax.runAction(this.method, {\n\t\t\tanalyticsLabel: this.analyticsLabel,\n\t\t\tdata: data\n\t\t}).then((response) =>\n\t\t{\n\t\t\tthis.afterSave(response);\n\t\t\tthis.stopProgress();\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.showErrors(response.errors);\n\t\t\tthis.stopProgress();\n\t\t});\n\t}\n\n\tafterSave(response)\n\t{\n\t\tthis.addDataToSlider('response', response);\n\t}\n\n\tgetSlider()\n\t{\n\t\tif(Reflection.getClass('BX.SidePanel'))\n\t\t{\n\t\t\treturn BX.SidePanel.Instance.getSliderByWindow(window);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddDataToSlider(key, data)\n\t{\n\t\tif(Type.isString(key) && Type.isPlainObject(data))\n\t\t{\n\t\t\tlet slider = this.getSlider();\n\t\t\tif(slider)\n\t\t\t{\n\t\t\t\tslider.data.set(key, data);\n\t\t\t}\n\t\t}\n\t}\n\n\tshowErrors(errors)\n\t{\n\t\tlet text = '';\n\t\terrors.forEach(({message}) =>\n\t\t{\n\t\t\ttext += message;\n\t\t});\n\t\tif(Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer.innerText = text;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n\thideErrors()\n\t{\n\t\tif(Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer.innerText = '';\n\t\t}\n\t}\n\n\tdelete(event)\n\t{\n\t\tevent.preventDefault();\n\t}\n\n\tgetPermissionSelectors()\n\t{\n\t\treturn [];\n\t}\n\n\tgetPermissions()\n\t{\n\t\tlet permissions = [];\n\n\t\tthis.getPermissionSelectors().forEach((permission) =>\n\t\t{\n\t\t\tlet node = this.form.querySelector(permission.selector);\n\t\t\tif(node)\n\t\t\t{\n\t\t\t\tpermissions = [...permissions, ...this.getPermission(node, permission.action)];\n\t\t\t}\n\t\t});\n\n\t\tif(permissions.length <= 0)\n\t\t{\n\t\t\tpermissions = false;\n\t\t}\n\n\t\treturn permissions;\n\t}\n\n\tgetPermission(node, action)\n\t{\n\t\tlet permissions = [];\n\t\tconst inputs = Array.from(node.querySelectorAll('input[type=\"hidden\"]'));\n\t\tconst select = node.querySelector('select');\n\t\tinputs.forEach((input) =>\n\t\t{\n\t\t\tif(input.value && Type.isString(input.value) && input.value.length > 0)\n\t\t\t{\n\t\t\t\tpermissions.push({\n\t\t\t\t\taccessCode: input.value,\n\t\t\t\t\tpermission: select.value,\n\t\t\t\t\taction: action\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn permissions;\n\t}\n}"],"names":["Component","form","params","saveButton","document","getElementById","cancelButton","deleteButton","Type","isString","analyticsLabel","method","isDomNode","errorsContainer","bindEvents","Event","bind","event","save","passive","loader","Loader","size","isProgress","getLoader","isShown","show","hideErrors","hide","setTimeout","Dom","removeClass","closeButton","preventDefault","startProgress","data","prepareData","Ajax","runAction","then","response","afterSave","stopProgress","showErrors","errors","addDataToSlider","Reflection","getClass","BX","SidePanel","Instance","getSliderByWindow","window","key","isPlainObject","slider","getSlider","set","text","forEach","message","innerText","console","error","permissions","getPermissionSelectors","permission","node","querySelector","selector","getPermission","action","length","inputs","Array","from","querySelectorAll","select","input","value","push","accessCode"],"mappings":"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"}