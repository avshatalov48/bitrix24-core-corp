{"version":3,"file":"component.bundle.js","sources":["../src/component.js"],"sourcesContent":["import {Dom, Type, ajax as Ajax, Event, Reflection} from \"main.core\";\nimport {Loader} from \"main.loader\";\n\nexport class Component\n{\n\tanalyticsLabel = '';\n\terrorsContainer;\n\tparams;\n\n\tconstructor(form, params)\n\t{\n\t\tthis.params = params;\n\t\tthis.form = form;\n\t\tthis.saveButton = document.getElementById('ui-button-panel-save');\n\t\tthis.cancelButton = document.getElementById('ui-button-panel-cancel');\n\t\tthis.deleteButton = document.getElementById('ui-button-panel-remove');\n\n\t\tif(Type.isString(params.analyticsLabel))\n\t\t{\n\t\t\tthis.analyticsLabel = params.analyticsLabel;\n\t\t}\n\t\tif(Type.isString(params.method))\n\t\t{\n\t\t\tthis.method = params.method;\n\t\t}\n\t\tif(Type.isDomNode(params.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer = params.errorsContainer;\n\t\t}\n\t}\n\n\tinit()\n\t{\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEvent.bind(this.saveButton, 'click', (event) =>\n\t\t\t{\n\t\t\t\tthis.save(event);\n\t\t\t}, {\n\t\t\t\tpassive: false\n\t\t\t}\n\t\t);\n\n\t\tif(this.deleteButton)\n\t\t{\n\t\t\tEvent.bind(this.deleteButton, 'click', (event) =>\n\t\t\t{\n\t\t\t\tthis.delete(event);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetLoader()\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({size: 150});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.isProgress = true;\n\t\tif(!this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().show(this.form);\n\t\t}\n\t\tthis.hideErrors();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tthis.getLoader().hide();\n\t\tsetTimeout(() =>\n\t\t{\n\t\t\tDom.removeClass(this.saveButton, 'ui-btn-wait');\n\t\t\tDom.removeClass(this.closeButton, 'ui-btn-wait');\n\t\t\tif(this.deleteButton)\n\t\t\t{\n\t\t\t\tDom.removeClass(this.deleteButton, 'ui-btn-wait');\n\t\t\t}\n\t\t}, 200);\n\t}\n\n\tprepareData()\n\t{\n\n\t}\n\n\tsave(event)\n\t{\n\t\tevent.preventDefault();\n\t\tif(!this.form)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(!this.method)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.startProgress();\n\t\tlet data = this.prepareData();\n\n\t\tAjax.runAction(this.method, {\n\t\t\tanalyticsLabel: this.analyticsLabel,\n\t\t\tdata: data\n\t\t}).then((response) =>\n\t\t{\n\t\t\tthis.afterSave(response);\n\t\t\tthis.stopProgress();\n\t\t}).catch((response) =>\n\t\t{\n\t\t\tthis.showErrors(response.errors);\n\t\t\tthis.stopProgress();\n\t\t});\n\t}\n\n\tafterSave(response)\n\t{\n\t\tthis.addDataToSlider('response', response);\n\t}\n\n\tgetSlider()\n\t{\n\t\tif(Reflection.getClass('BX.SidePanel'))\n\t\t{\n\t\t\treturn BX.SidePanel.Instance.getSliderByWindow(window);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddDataToSlider(key, data)\n\t{\n\t\tif(Type.isString(key) && Type.isPlainObject(data))\n\t\t{\n\t\t\tlet slider = this.getSlider();\n\t\t\tif(slider)\n\t\t\t{\n\t\t\t\tslider.data.set(key, data);\n\t\t\t}\n\t\t}\n\t}\n\n\tshowErrors(errors)\n\t{\n\t\tlet text = '';\n\t\terrors.forEach(({message}) =>\n\t\t{\n\t\t\ttext += message;\n\t\t});\n\t\tif(Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer.innerText = text;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n\thideErrors()\n\t{\n\t\tif(Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer.innerText = '';\n\t\t}\n\t}\n\n\tdelete(event)\n\t{\n\t\tevent.preventDefault();\n\t}\n\n\tgetPermissionSelectors()\n\t{\n\t\treturn [];\n\t}\n\n\tgetPermissions()\n\t{\n\t\tlet permissions = [];\n\n\t\tthis.getPermissionSelectors().forEach((permission) =>\n\t\t{\n\t\t\tlet node = this.form.querySelector(permission.selector);\n\t\t\tif(node)\n\t\t\t{\n\t\t\t\tpermissions = [...permissions, ...this.getPermission(node, permission.action)];\n\t\t\t}\n\t\t});\n\n\t\tif(permissions.length <= 0)\n\t\t{\n\t\t\tpermissions = false;\n\t\t}\n\n\t\treturn permissions;\n\t}\n\n\tgetPermission(node, action)\n\t{\n\t\tlet permissions = [];\n\t\tconst inputs = Array.from(node.querySelectorAll('input[type=\"hidden\"]'));\n\t\tconst select = node.querySelector('select');\n\t\tinputs.forEach((input) =>\n\t\t{\n\t\t\tif(input.value && Type.isString(input.value) && input.value.length > 0)\n\t\t\t{\n\t\t\t\tpermissions.push({\n\t\t\t\t\taccessCode: input.value,\n\t\t\t\t\tpermission: select.value,\n\t\t\t\t\taction: action\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn permissions;\n\t}\n}"],"names":["Component","form","params","saveButton","document","getElementById","cancelButton","deleteButton","Type","isString","analyticsLabel","method","isDomNode","errorsContainer","bindEvents","Event","bind","event","save","passive","delete","loader","Loader","size","isProgress","getLoader","isShown","show","hideErrors","hide","setTimeout","Dom","removeClass","closeButton","preventDefault","startProgress","data","prepareData","Ajax","runAction","then","response","afterSave","stopProgress","catch","showErrors","errors","addDataToSlider","Reflection","getClass","BX","SidePanel","Instance","getSliderByWindow","window","key","isPlainObject","slider","getSlider","set","text","forEach","message","innerText","console","error","permissions","getPermissionSelectors","permission","node","querySelector","selector","getPermission","action","length","inputs","Array","from","querySelectorAll","select","input","value","push","accessCode"],"mappings":"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"}