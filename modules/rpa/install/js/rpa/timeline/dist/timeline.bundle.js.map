{"version":3,"file":"timeline.bundle.js","sources":["../src/task.js","../src/taskcomplete.js","../src/timeline.js"],"sourcesContent":["import {ajax, Tag, Text, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Timeline} from 'ui.timeline';\nimport {Manager} from \"rpa.manager\";\nimport {Popup} from \"main.popup\";\n\n/**\n * @memberOf BX.Rpa.Timeline\n * @mixes EventEmitter\n */\nexport class Task extends Timeline.Item\n{\n\tstatusWait = 0;\n\tstatusYes = 1;\n\tstatusNo = 2;\n\tstatusOk = 3;\n\tstatusCancel = 4;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.Rpa.Timeline.Task');\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn 'task-' + this.id;\n\t}\n\n\tgetTaskUsers(): Array\n\t{\n\t\treturn this.data.users;\n\t}\n\n\trender(): Element\n\t{\n\t\tthis.layout.container = this.renderContainer();\n\n\t\tthis.layout.container.appendChild(this.renderIcon());\n\t\tthis.layout.container.appendChild(this.renderContent());\n\n\t\treturn this.layout.container;\n\t}\n\n\trenderContainer(): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-task ${(this.isLast ? 'ui-item-detail-stream-section-last' : '')}\"></div>`;\n\t}\n\n\trenderHeader(): Element\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-item-detail-stream-content-header\">\n\t\t\t\t<div class=\"ui-item-detail-stream-content-title\">\n\t\t\t\t\t<span class=\"ui-item-detail-stream-content-title-text\">${Loc.getMessage('RPA_TIMELINE_TASKS_TITLE')}</span>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t}\n\n\trenderMain(): Element\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-item-detail-stream-content-detail\">\n\t\t\t\t<div class=\"ui-item-detail-stream-content-detail-subject\">\n\t\t\t\t\t${this.renderParticipants()}\n\t\t\t\t\t<div class=\"ui-item-detail-stream-content-detail-subject-inner\">\n\t\t\t\t\t\t<a class=\"ui-item-detail-stream-content-detail-subject-text\" href=\"${Text.encode(this.data.url)}\">${Text.encode(this.getTitle())}</a>\n\t\t\t\t\t\t${this.renderParticipantsLine()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-item-detail-stream-content-detail-main\">\n\t\t\t\t\t<span class=\"ui-item-detail-stream-content-detail-main-text\">${Text.encode(this.description)}</span>\n\t\t\t\t</div>\n\t\t\t\t${this.renderTaskFields()}\n\t\t\t\t${this.renderTaskButtons()}\n\t\t\t</div>`;\n\t}\n\n\trenderParticipants(): Element\n\t{\n\t\tlet photos = this.getTaskUsers().map(({id, status}) => {\n\t\t\treturn this.renderParticipantPhoto(id)\n\t\t});\n\n\t\tif (photos.length > 4)\n\t\t{\n\t\t\tlet counter = photos.length - 4;\n\t\t\tphotos = photos.slice(0, 4);\n\n\t\t\tphotos.push(\n\t\t\t\tTag.render`<span class=\"ui-item-detail-stream-content-other\">\n\t\t\t\t\t\t<span class=\"ui-item-detail-stream-content-other-text\">+${counter}</span>\n\t\t\t\t\t</span>`\n\t\t\t);\n\t\t}\n\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-employee-wrap\" onclick=\"${this.showParticipants.bind(this)}\">\n\t\t\t\t${photos}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderParticipantsLine(): Element\n\t{\n\t\tlet elements = [];\n\t\tlet taskUsers = this.getTaskUsers();\n\n\t\ttaskUsers.forEach(({id, status}, i) => {\n\t\t\tlet node = Tag.render`<span class=\"ui-item-detail-stream-content-detail-subject-resp\">${Text.encode(this.getTaskUserName(id))}</span>`;\n\n\t\t\tif (status > this.statusWait)\n\t\t\t{\n\t\t\t\tnode.classList.add('ui-item-detail-stream-content-detail-subject-resp-past');\n\t\t\t}\n\t\t\telse if (id === this.getUserId())\n\t\t\t{\n\t\t\t\tnode.classList.add('ui-item-detail-stream-content-detail-subject-resp-current');\n\t\t\t}\n\n\t\t\telements.push(node);\n\n\t\t\tif (this.data.participantJoint !== 'queue' && taskUsers.length - 1 !== i)\n\t\t\t{\n\t\t\t\tlet msg = this.data.participantJoint === 'and' ? 'RPA_TIMELINE_TASKS_SEPARATOR_AND' : 'RPA_TIMELINE_TASKS_SEPARATOR_OR';\n\t\t\t\telements.push(Tag.render`<span class=\"ui-item-detail-stream-content-detail-subject-separator\">${Loc.getMessage(msg)}</span>`);\n\t\t\t}\n\t\t});\n\n\t\tlet queueCls = (\n\t\t\tthis.data.participantJoint === 'queue'? 'ui-item-detail-stream-content-detail-subject-resp-wrap-queue' : ''\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-item-detail-stream-content-detail-subject-resp-wrap ${queueCls}\">\n\t\t\t\t${elements}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tshowParticipants(event): void\n\t{\n\t\tlet taskUsers = this.getTaskUsers();\n\t\tlet users = taskUsers.map(({id, status}, i) => {\n\n\t\t\tlet user = this.users.get(id);\n\t\t\tlet sep = (taskUsers.length -1 !== i) ?\n\t\t\t\tTag.render`<span class=\"ui-item-detail-popup-item-separator\">\n\t\t\t\t\t${Loc.getMessage(this.data.participantJoint === 'and'\n\t\t\t\t\t? 'RPA_TIMELINE_TASKS_SEPARATOR_AND' : 'RPA_TIMELINE_TASKS_SEPARATOR_OR')}\n\t\t\t\t\t</span>`\n\t\t\t\t: '';\n\n\t\t\tlet node = Tag.render`<div class=\"ui-item-detail-popup-item\">\n\t\t\t\t\t<a class=\"ui-item-detail-stream-content-employee\"\n\t\t\t\t\t   ${user.link? `href=\"${user.link}\"`:''}\n\t\t\t\t\t   target=\"_blank\"\n\t\t\t\t\t   title=\"${Text.encode(user.fullName)}\"\n\t\t\t\t\t   ${user.photo? `style=\"background-image: url('${user.photo}'); background-size: 100%;\"`:''}></a>\n\t\t\t\t\t<div class=\"ui-item-detail-popup-item-inner\">\n\t\t\t\t\t\t<span class=\"ui-item-detail-popup-item-name\">${Text.encode(user.fullName)}</span>\n\t\t\t\t\t\t<span class=\"ui-item-detail-popup-item-position\">${user.workPosition}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${sep}\n\t\t\t\t</div>`;\n\n\t\t\tif (status > this.statusWait)\n\t\t\t{\n\t\t\t\tnode.classList.add('ui-item-detail-popup-item-'\n\t\t\t\t\t+ (status === this.statusOk || status === this.statusYes ? 'success' : 'fail')\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnode.classList.add('ui-item-detail-popup-item-'\n\t\t\t\t\t+ (id === this.getUserId() ? 'current' : 'wait')\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn node;\n\t\t});\n\n\t\tlet content = Tag.render`\n\t\t\t\t\t<div class=\"ui-item-detail-popup\">\n\t\t\t\t\t\t${users}\n\t\t\t\t\t</div>`;\n\n\t\tif (this.data.participantJoint !== 'queue')\n\t\t{\n\t\t\tcontent.classList.add('ui-item-detail-popup-option');\n\t\t}\n\n\t\tlet popup = new Popup('rpa-detail-task-participant-' + this.getId(), event.target, {\n\t\t\tautoHide: true,\n\t\t\tdraggable: false,\n\t\t\tbindOptions: { forceBindPosition: true },\n\t\t\tnoAllPaddings: true,\n\t\t\tcloseByEsc: true,\n\t\t\tcacheable: false,\n\t\t\twidth: 280,\n\t\t\tangle: {\n\t\t\t\tposition: 'top',\n\t\t\t},\n\t\t\toverlay: { backgroundColor: 'transparent' },\n\t\t\tcontent: content\n\t\t});\n\n\t\tpopup.show();\n\t}\n\n\trenderTaskButtons(): Element|string\n\t{\n\t\tconst controls = this.data.controls;\n\n\t\tif (!controls)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst elements = this.data.type === 'RpaRequestActivity'\n\t\t\t? this.getLinkButtonElements(controls.BUTTONS)\n\t\t\t: this.getActionButtonElements(controls.BUTTONS);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-item-detail-stream-content-detail-status-block\">\n\t\t\t\t${elements}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetActionButtonElements(buttons: Array)\n\t{\n\t\treturn buttons.map(\n\t\t\t(button) => {\n\t\t\t\tlet bgColor = button.COLOR;\n\t\t\t\tlet fgColor = Manager.calculateTextColor(button.COLOR);\n\n\t\t\t\treturn Tag.render`<button class=\"ui-btn ui-btn-sm ui-btn-default\" \n\t\t\t\t\tname=\"${button.NAME}\"\n\t\t\t\t\tvalue=\"${button.VALUE}\"\n\t\t\t\t\tstyle=\"background-color: #${bgColor};border-color: #${bgColor};color:${fgColor}\"\n\t\t\t\t\tonclick=\"${this.doTaskHandler.bind(this, button)}\"\n\t\t\t\t\t>${Text.encode(button.TEXT)}</button>\n\t\t\t\t`;\n\t\t\t}\n\t\t)\n\t}\n\n\tgetLinkButtonElements(buttons: Array)\n\t{\n\t\treturn [\n\t\t\tTag.render`<a class=\"ui-btn ui-btn-sm ui-btn-default ui-btn-primary\" \n\t\t\t\t\thref=\"${Text.encode(this.data.url)}\"\n\t\t\t\t\t>${Loc.getMessage('RPA_TIMELINE_TASKS_OPEN_TASK')}</a>\n\t\t\t`\n\t\t];\n\t}\n\n\trenderTaskFields(): Element\n\t{\n\t\tif (!this.data.fieldsToSet)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst elements = this.data.fieldsToSet.map(\n\t\t\t(field) => {\n\t\t\t\treturn Tag.render`\n\t\t\t\t\t<div class=\"ui-item-detail-stream-content-detail-main-field-value\">&ndash; ${Text.encode(field)}</div>\n\t\t\t\t`;\n\t\t\t}\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-item-detail-stream-content-detail-main-field\">\n\t\t\t\t<div class=\"ui-item-detail-stream-content-detail-main-field-title\">${Loc.getMessage('RPA_TIMELINE_TASKS_FIELDS_TO_SET')}</div>\n\t\t\t\t<div class=\"ui-item-detail-stream-content-detail-main-field-value-block\">\n\t\t\t\t\t${elements}\n\t\t\t\t</div>\n\t\t\t</div>\t\t\n\t\t`;\n\t}\n\n\tgetTaskUserName(id): string\n\t{\n\t\tif (!id)\n\t\t{\n\t\t\tid = this.getUserId();\n\t\t}\n\n\t\tlet userData = this.users.get(Text.toInteger(id));\n\t\treturn userData ? userData.fullName : '-?-';\n\t}\n\n\trenderParticipantPhoto(userId: ?number): Element\n\t{\n\t\tuserId = Text.toInteger(userId);\n\t\tlet userData = {\n\t\t\tfullName: '',\n\t\t\tphoto: null,\n\t\t};\n\t\tif(userId > 0)\n\t\t{\n\t\t\tuserData = this.users.get(userId);\n\t\t}\n\t\tif(!userData)\n\t\t{\n\t\t\treturn Tag.render`<span></span>`;\n\t\t}\n\n\t\tconst safeFullName = Text.encode(userData.fullName);\n\t\treturn Tag.render`<span class=\"ui-item-detail-stream-content-employee\" title=\"${safeFullName}\" ${userData.photo ? 'style=\"background-image: url(\\'' + userData.photo + '\\'); background-size: 100%;\"' : ''}></span>`;\n\t}\n\n\tdoTaskHandler(button)\n\t{\n\t\tconst ajaxData = {};\n\t\tajaxData[button.NAME] = button.VALUE;\n\t\tajaxData['taskId'] = this.id;\n\n\t\tthis.emit('onBeforeCompleteTask', {\n\t\t\ttaskId: this.id,\n\t\t});\n\n\t\tajax.runAction('rpa.task.do', {\n\t\t\tanalyticsLabel: 'rpaTaskDo',\n\t\t\tdata: ajaxData,\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (response.data.completed)\n\t\t\t{\n\t\t\t\tif(response.data.timeline)\n\t\t\t\t{\n\t\t\t\t\tthis.completedData = response.data.timeline;\n\t\t\t\t}\n\t\t\t\tthis.onDelete();\n\t\t\t\tthis.emit('onCompleteTask', {\n\t\t\t\t\ttaskId: this.id,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n}","import {Tag, Text, Type} from 'main.core';\nimport {Timeline} from 'ui.timeline';\n\nexport class TaskComplete extends Timeline.History\n{\n\trenderContainer(): Element\n\t{\n\t\tconst container = super.renderContainer();\n\t\tcontainer.classList.add('ui-item-detail-stream-section-history');\n\n\t\treturn container;\n\t}\n\n\trenderTaskInfo(): Element\n\t{\n\t\tlet taskName = this.renderTaskName();\n\t\tif(!taskName)\n\t\t{\n\t\t\ttaskName = '';\n\t\t}\n\n\t\tlet taskResponsible = this.renderTaskResponsible();\n\t\tif(!taskResponsible)\n\t\t{\n\t\t\ttaskResponsible = '';\n\t\t}\n\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail-subject\">\n\t\t\t${this.renderHeaderUser(this.getUserId(), 30)}\n\t\t\t<div class=\"ui-item-detail-stream-content-detail-subject-inner\">\n\t\t\t\t${taskName}\n\t\t\t\t${taskResponsible}\n\t\t\t</div>\n\t\t</div>`;\n\t}\n\n\trenderTaskName(): ?Element\n\t{\n\t\tconst task = this.getTask();\n\t\tif(task)\n\t\t{\n\t\t\treturn Tag.render`<a class=\"ui-item-detail-stream-content-detail-subject-text\">${Text.encode(task.NAME)}</a>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenderTaskResponsible(): ?Element\n\t{\n\t\tlet user = this.users.get(Text.toInteger(this.getUserId()));\n\t\tif(user)\n\t\t{\n\t\t\treturn Tag.render`<span class=\"ui-item-detail-stream-content-detail-subject-resp\">${Text.encode(user.fullName)}</span>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenderMain(): Element\n\t{\n\t\tlet taskInfo = this.renderTaskInfo();\n\t\tlet detailMain = this.renderDetailMain();\n\t\tif(!detailMain)\n\t\t{\n\t\t\ttaskInfo.classList.add('rpa-item-detail-stream-content-detail-no-main');\n\t\t}\n\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail\">\n\t\t\t${taskInfo}\n\t\t\t${detailMain || ''}\n\t\t</div>`;\n\t}\n\n\tgetTask(): ?{NAME: ?string, DESCRIPTION: ?string, USERS: ?Array}\n\t{\n\t\tif(Type.isPlainObject(this.data.task))\n\t\t{\n\t\t\treturn this.data.task;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenderDetailMain(): Element\n\t{\n\t\tconst task = this.getTask();\n\t\tlet taskDescription = '';\n\t\tif(task && task.DESCRIPTION)\n\t\t{\n\t\t\ttaskDescription = Tag.render`<span class=\"ui-item-detail-stream-content-detail-main-text\">${Text.encode(task.DESCRIPTION)}</span>`;\n\t\t}\n\n\t\tlet stageChange = this.renderStageChange();\n\t\tlet fieldsChange = this.renderFieldsChange();\n\t\tif(taskDescription || stageChange || fieldsChange)\n\t\t{\n\t\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail-main\">\n\t\t\t\t${taskDescription}\n\t\t\t\t${(fieldsChange ? [this.renderFieldsChangeTitle(), fieldsChange] : '')}\n\t\t\t\t${(stageChange ? [this.renderStageChangeTitle(), stageChange] : '')}\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn null;\n\t}\n}","import {Task} from './task';\nimport {TaskComplete} from './taskcomplete';\n\n/**\n * @memberOf BX.Rpa\n */\nexport const Timeline = {\n\tTask,\n\tTaskComplete,\n};"],"names":["Task","props","setEventNamespace","id","data","users","layout","container","renderContainer","appendChild","renderIcon","renderContent","Tag","render","isLast","Loc","getMessage","renderParticipants","Text","encode","url","getTitle","renderParticipantsLine","description","renderTaskFields","renderTaskButtons","photos","getTaskUsers","map","status","renderParticipantPhoto","length","counter","slice","push","showParticipants","bind","elements","taskUsers","forEach","i","node","getTaskUserName","statusWait","classList","add","getUserId","participantJoint","msg","queueCls","event","user","get","sep","link","fullName","photo","workPosition","statusOk","statusYes","content","popup","Popup","getId","target","autoHide","draggable","bindOptions","forceBindPosition","noAllPaddings","closeByEsc","cacheable","width","angle","position","overlay","backgroundColor","show","controls","type","getLinkButtonElements","BUTTONS","getActionButtonElements","buttons","button","bgColor","COLOR","fgColor","Manager","calculateTextColor","NAME","VALUE","doTaskHandler","TEXT","fieldsToSet","field","userData","toInteger","userId","safeFullName","ajaxData","emit","taskId","ajax","runAction","analyticsLabel","then","response","completed","timeline","completedData","onDelete","Timeline","Item","TaskComplete","taskName","renderTaskName","taskResponsible","renderTaskResponsible","renderHeaderUser","task","getTask","taskInfo","renderTaskInfo","detailMain","renderDetailMain","Type","isPlainObject","taskDescription","DESCRIPTION","stageChange","renderStageChange","fieldsChange","renderFieldsChange","renderFieldsChangeTitle","renderStageChangeTitle","History"],"mappings":"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"}