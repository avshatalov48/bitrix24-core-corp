this.BX=this.BX||{};(function(t,e,a,n,i,r){"use strict";function s(){var t=babelHelpers.taggedTemplateLiteral(['<span class="ui-item-detail-stream-content-employee" title="','" ',"></span>"]);s=function e(){return t};return t}function l(){var t=babelHelpers.taggedTemplateLiteral(["<span></span>"]);l=function e(){return t};return t}function u(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-item-detail-stream-content-detail-main-field">\n\t\t\t\t<div class="ui-item-detail-stream-content-detail-main-field-title">','</div>\n\t\t\t\t<div class="ui-item-detail-stream-content-detail-main-field-value-block">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\t\t\n\t\t"]);u=function e(){return t};return t}function d(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="ui-item-detail-stream-content-detail-main-field-value">&ndash; ',"</div>\n\t\t\t\t"]);d=function e(){return t};return t}function o(){var t=babelHelpers.taggedTemplateLiteral(['<a class="ui-btn ui-btn-sm ui-btn-default ui-btn-primary" \n\t\t\t\t\thref="','"\n\t\t\t\t\t>',"</a>\n\t\t\t"]);o=function e(){return t};return t}function c(){var t=babelHelpers.taggedTemplateLiteral(['<button class="ui-btn ui-btn-sm ui-btn-default" \n\t\t\t\t\tname="','"\n\t\t\t\t\tvalue="','"\n\t\t\t\t\tstyle="background-color: #',";border-color: #",";color:",'"\n\t\t\t\t\tonclick="','"\n\t\t\t\t\t>',"</button>\n\t\t\t\t"]);c=function e(){return t};return t}function p(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-item-detail-stream-content-detail-status-block">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);p=function e(){return t};return t}function m(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="ui-item-detail-popup">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>"]);m=function e(){return t};return t}function v(){var t=babelHelpers.taggedTemplateLiteral(['<div class="ui-item-detail-popup-item">\n\t\t\t\t\t<a class="ui-item-detail-stream-content-employee"\n\t\t\t\t\t   ','\n\t\t\t\t\t   target="_blank"\n\t\t\t\t\t   title="','"\n\t\t\t\t\t   ','></a>\n\t\t\t\t\t<div class="ui-item-detail-popup-item-inner">\n\t\t\t\t\t\t<span class="ui-item-detail-popup-item-name">','</span>\n\t\t\t\t\t\t<span class="ui-item-detail-popup-item-position">',"</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>"]);v=function e(){return t};return t}function g(){var t=babelHelpers.taggedTemplateLiteral(['<span class="ui-item-detail-popup-item-separator">\n\t\t\t\t\t',"\n\t\t\t\t\t</span>"]);g=function e(){return t};return t}function T(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-item-detail-stream-content-detail-subject-resp-wrap ','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);T=function e(){return t};return t}function f(){var t=babelHelpers.taggedTemplateLiteral(['<span class="ui-item-detail-stream-content-detail-subject-separator">',"</span>"]);f=function e(){return t};return t}function b(){var t=babelHelpers.taggedTemplateLiteral(['<span class="ui-item-detail-stream-content-detail-subject-resp">',"</span>"]);b=function e(){return t};return t}function h(){var t=babelHelpers.taggedTemplateLiteral(['<div class="ui-item-detail-stream-content-employee-wrap" onclick="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);h=function e(){return t};return t}function k(){var t=babelHelpers.taggedTemplateLiteral(['<span class="ui-item-detail-stream-content-other">\n\t\t\t\t\t\t<span class="ui-item-detail-stream-content-other-text">+',"</span>\n\t\t\t\t\t</span>"]);k=function e(){return t};return t}function L(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-item-detail-stream-content-detail">\n\t\t\t\t<div class="ui-item-detail-stream-content-detail-subject">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-item-detail-stream-content-detail-subject-inner">\n\t\t\t\t\t\t<a class="ui-item-detail-stream-content-detail-subject-text" href="','">',"</a>\n\t\t\t\t\t\t",'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-item-detail-stream-content-detail-main">\n\t\t\t\t\t<span class="ui-item-detail-stream-content-detail-main-text">',"</span>\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>"]);L=function e(){return t};return t}function y(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-item-detail-stream-content-header">\n\t\t\t\t<div class="ui-item-detail-stream-content-title">\n\t\t\t\t\t<span class="ui-item-detail-stream-content-title-text">',"</span>\n\t\t\t\t</div>\n\t\t\t</div>"]);y=function e(){return t};return t}function H(){var t=babelHelpers.taggedTemplateLiteral(['<div class="ui-item-detail-stream-section ui-item-detail-stream-section-task ','"></div>']);H=function e(){return t};return t}var I=function(t){babelHelpers.inherits(e,t);function e(t){var a;babelHelpers.classCallCheck(this,e);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"statusWait",0);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"statusYes",1);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"statusNo",2);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"statusOk",3);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"statusCancel",4);a.setEventNamespace("BX.Rpa.Timeline.Task");return a}babelHelpers.createClass(e,[{key:"getId",value:function t(){return"task-"+this.id}},{key:"getTaskUsers",value:function t(){return this.data.users}},{key:"render",value:function t(){this.layout.container=this.renderContainer();this.layout.container.appendChild(this.renderIcon());this.layout.container.appendChild(this.renderContent());return this.layout.container}},{key:"renderContainer",value:function t(){return i.Tag.render(H(),this.isLast?"ui-item-detail-stream-section-last":"")}},{key:"renderHeader",value:function t(){return i.Tag.render(y(),i.Loc.getMessage("RPA_TIMELINE_TASKS_TITLE"))}},{key:"renderMain",value:function t(){return i.Tag.render(L(),this.renderParticipants(),i.Text.encode(this.data.url),i.Text.encode(this.getTitle()),this.renderParticipantsLine(),i.Text.encode(this.description),this.renderTaskFields(),this.renderTaskButtons())}},{key:"renderParticipants",value:function t(){var e=this;var a=this.getTaskUsers().map(function(t){var a=t.id,n=t.status;return e.renderParticipantPhoto(a)});if(a.length>4){var n=a.length-4;a=a.slice(0,4);a.push(i.Tag.render(k(),n))}return i.Tag.render(h(),this.showParticipants.bind(this),a)}},{key:"renderParticipantsLine",value:function t(){var e=this;var a=[];var n=this.getTaskUsers();n.forEach(function(t,r){var s=t.id,l=t.status;var u=i.Tag.render(b(),i.Text.encode(e.getTaskUserName(s)));if(l>e.statusWait){u.classList.add("ui-item-detail-stream-content-detail-subject-resp-past")}else if(s===e.getUserId()){u.classList.add("ui-item-detail-stream-content-detail-subject-resp-current")}a.push(u);if(e.data.participantJoint!=="queue"&&n.length-1!==r){var d=e.data.participantJoint==="and"?"RPA_TIMELINE_TASKS_SEPARATOR_AND":"RPA_TIMELINE_TASKS_SEPARATOR_OR";a.push(i.Tag.render(f(),i.Loc.getMessage(d)))}});var r=this.data.participantJoint==="queue"?"ui-item-detail-stream-content-detail-subject-resp-wrap-queue":"";return i.Tag.render(T(),r,a)}},{key:"showParticipants",value:function t(e){var a=this;var r=this.getTaskUsers();var s=r.map(function(t,e){var n=t.id,s=t.status;var l=a.users.get(n);var u=r.length-1!==e?i.Tag.render(g(),i.Loc.getMessage(a.data.participantJoint==="and"?"RPA_TIMELINE_TASKS_SEPARATOR_AND":"RPA_TIMELINE_TASKS_SEPARATOR_OR")):"";var d=i.Tag.render(v(),l.link?'href="'.concat(l.link,'"'):"",i.Text.encode(l.fullName),l.photo?"style=\"background-image: url('".concat(l.photo,"'); background-size: 100%;\""):"",i.Text.encode(l.fullName),l.workPosition,u);if(s>a.statusWait){d.classList.add("ui-item-detail-popup-item-"+(s===a.statusOk||s===a.statusYes?"success":"fail"))}else{d.classList.add("ui-item-detail-popup-item-"+(n===a.getUserId()?"current":"wait"))}return d});var l=i.Tag.render(m(),s);if(this.data.participantJoint!=="queue"){l.classList.add("ui-item-detail-popup-option")}var u=new n.Popup("rpa-detail-task-participant-"+this.getId(),e.target,{autoHide:true,draggable:false,bindOptions:{forceBindPosition:true},noAllPaddings:true,closeByEsc:true,cacheable:false,width:280,angle:{position:"top"},overlay:{backgroundColor:"transparent"},content:l});u.show()}},{key:"renderTaskButtons",value:function t(){var e=this.data.controls;if(!e){return""}var a=this.data.type==="RpaRequestActivity"?this.getLinkButtonElements(e.BUTTONS):this.getActionButtonElements(e.BUTTONS);return i.Tag.render(p(),a)}},{key:"getActionButtonElements",value:function t(e){var n=this;return e.map(function(t){var e=t.COLOR;var r=a.Manager.calculateTextColor(t.COLOR);return i.Tag.render(c(),t.NAME,t.VALUE,e,e,r,n.doTaskHandler.bind(n,t),i.Text.encode(t.TEXT))})}},{key:"getLinkButtonElements",value:function t(e){return[i.Tag.render(o(),i.Text.encode(this.data.url),i.Loc.getMessage("RPA_TIMELINE_TASKS_OPEN_TASK"))]}},{key:"renderTaskFields",value:function t(){if(!this.data.fieldsToSet){return""}var e=this.data.fieldsToSet.map(function(t){return i.Tag.render(d(),i.Text.encode(t))});return i.Tag.render(u(),i.Loc.getMessage("RPA_TIMELINE_TASKS_FIELDS_TO_SET"),e)}},{key:"getTaskUserName",value:function t(e){if(!e){e=this.getUserId()}var a=this.users.get(i.Text.toInteger(e));return a?a.fullName:"-?-"}},{key:"renderParticipantPhoto",value:function t(e){e=i.Text.toInteger(e);var a={fullName:"",photo:null};if(e>0){a=this.users.get(e)}if(!a){return i.Tag.render(l())}var n=i.Text.encode(a.fullName);return i.Tag.render(s(),n,a.photo?"style=\"background-image: url('"+a.photo+"'); background-size: 100%;\"":"")}},{key:"doTaskHandler",value:function t(e){var a=this;var n={};n[e.NAME]=e.VALUE;n["taskId"]=this.id;this.emit("onBeforeCompleteTask",{taskId:this.id});i.ajax.runAction("rpa.task.do",{analyticsLabel:"rpaTaskDo",data:n}).then(function(t){if(t.data.completed){if(t.data.timeline){a.completedData=t.data.timeline}a.onDelete();a.emit("onCompleteTask",{taskId:a.id})}})}}]);return e}(r.Timeline.Item);function E(){var t=babelHelpers.taggedTemplateLiteral(['<div class="ui-item-detail-stream-content-detail-main">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>"]);E=function e(){return t};return t}function P(){var t=babelHelpers.taggedTemplateLiteral(['<span class="ui-item-detail-stream-content-detail-main-text">',"</span>"]);P=function e(){return t};return t}function A(){var t=babelHelpers.taggedTemplateLiteral(['<div class="ui-item-detail-stream-content-detail">\n\t\t\t',"\n\t\t\t","\n\t\t</div>"]);A=function e(){return t};return t}function R(){var t=babelHelpers.taggedTemplateLiteral(['<span class="ui-item-detail-stream-content-detail-subject-resp">',"</span>"]);R=function e(){return t};return t}function C(){var t=babelHelpers.taggedTemplateLiteral(['<a class="ui-item-detail-stream-content-detail-subject-text">',"</a>"]);C=function e(){return t};return t}function N(){var t=babelHelpers.taggedTemplateLiteral(['<div class="ui-item-detail-stream-content-detail-subject">\n\t\t\t','\n\t\t\t<div class="ui-item-detail-stream-content-detail-subject-inner">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t</div>"]);N=function e(){return t};return t}var S=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"renderContainer",value:function t(){var a=babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"renderContainer",this).call(this);a.classList.add("ui-item-detail-stream-section-history");return a}},{key:"renderTaskInfo",value:function t(){var e=this.renderTaskName();if(!e){e=""}var a=this.renderTaskResponsible();if(!a){a=""}return i.Tag.render(N(),this.renderHeaderUser(this.getUserId(),30),e,a)}},{key:"renderTaskName",value:function t(){var e=this.getTask();if(e){return i.Tag.render(C(),i.Text.encode(e.NAME))}return null}},{key:"renderTaskResponsible",value:function t(){var e=this.users.get(i.Text.toInteger(this.getUserId()));if(e){return i.Tag.render(R(),i.Text.encode(e.fullName))}return null}},{key:"renderMain",value:function t(){var e=this.renderTaskInfo();var a=this.renderDetailMain();if(!a){e.classList.add("rpa-item-detail-stream-content-detail-no-main")}return i.Tag.render(A(),e,a||"")}},{key:"getTask",value:function t(){if(i.Type.isPlainObject(this.data.task)){return this.data.task}return null}},{key:"renderDetailMain",value:function t(){var e=this.getTask();var a="";if(e&&e.DESCRIPTION){a=i.Tag.render(P(),i.Text.encode(e.DESCRIPTION))}var n=this.renderStageChange();var r=this.renderFieldsChange();if(a||n||r){return i.Tag.render(E(),a,r?[this.renderFieldsChangeTitle(),r]:"",n?[this.renderStageChangeTitle(),n]:"")}return null}}]);return e}(r.Timeline.History);var _={Task:I,TaskComplete:S};t.Timeline=_})(this.BX.Rpa=this.BX.Rpa||{},BX.Event,BX.Rpa,BX.Main,BX,BX.UI);
//# sourceMappingURL=timeline.bundle.map.js