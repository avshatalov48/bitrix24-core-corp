this.BX=this.BX||{};(function(t,e,a,i,n,s){"use strict";var r,l,d,u,o,c,p,m,g,T,b,v,h,f,k,L,y,H;var I=function(t){babelHelpers.inherits(e,t);function e(t){var a;babelHelpers.classCallCheck(this,e);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"statusWait",0);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"statusYes",1);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"statusNo",2);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"statusOk",3);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"statusCancel",4);a.setEventNamespace("BX.Rpa.Timeline.Task");return a}babelHelpers.createClass(e,[{key:"getId",value:function t(){return"task-"+this.id}},{key:"getTaskUsers",value:function t(){return this.data.users}},{key:"render",value:function t(){this.layout.container=this.renderContainer();this.layout.container.appendChild(this.renderIcon());this.layout.container.appendChild(this.renderContent());return this.layout.container}},{key:"renderContainer",value:function t(){return n.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['<div class="ui-item-detail-stream-section ui-item-detail-stream-section-task ','"></div>'])),this.isLast?"ui-item-detail-stream-section-last":"")}},{key:"renderHeader",value:function t(){return n.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-item-detail-stream-content-header">\n\t\t\t\t<div class="ui-item-detail-stream-content-title">\n\t\t\t\t\t<span class="ui-item-detail-stream-content-title-text">',"</span>\n\t\t\t\t</div>\n\t\t\t</div>"])),n.Loc.getMessage("RPA_TIMELINE_TASKS_TITLE"))}},{key:"renderMain",value:function t(){return n.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-item-detail-stream-content-detail">\n\t\t\t\t<div class="ui-item-detail-stream-content-detail-subject">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-item-detail-stream-content-detail-subject-inner">\n\t\t\t\t\t\t<a class="ui-item-detail-stream-content-detail-subject-text" href="','">',"</a>\n\t\t\t\t\t\t",'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-item-detail-stream-content-detail-main">\n\t\t\t\t\t<span class="ui-item-detail-stream-content-detail-main-text">',"</span>\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>"])),this.renderParticipants(),n.Text.encode(this.data.url),n.Text.encode(this.getTitle()),this.renderParticipantsLine(),n.Text.encode(this.description),this.renderTaskFields(),this.renderTaskButtons())}},{key:"renderParticipants",value:function t(){var e=this;var a=this.getTaskUsers().map(function(t){var a=t.id,i=t.status;return e.renderParticipantPhoto(a)});if(a.length>4){var i=a.length-4;a=a.slice(0,4);a.push(n.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['<span class="ui-item-detail-stream-content-other">\n\t\t\t\t\t\t<span class="ui-item-detail-stream-content-other-text">+',"</span>\n\t\t\t\t\t</span>"])),i))}return n.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['<div class="ui-item-detail-stream-content-employee-wrap" onclick="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),this.showParticipants.bind(this),a)}},{key:"renderParticipantsLine",value:function t(){var e=this;var a=[];var i=this.getTaskUsers();i.forEach(function(t,s){var r=t.id,l=t.status;var d=n.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['<span class="ui-item-detail-stream-content-detail-subject-resp">',"</span>"])),n.Text.encode(e.getTaskUserName(r)));if(l>e.statusWait){d.classList.add("ui-item-detail-stream-content-detail-subject-resp-past")}else if(r===e.getUserId()){d.classList.add("ui-item-detail-stream-content-detail-subject-resp-current")}a.push(d);if(e.data.participantJoint!=="queue"&&i.length-1!==s){var u=e.data.participantJoint==="and"?"RPA_TIMELINE_TASKS_SEPARATOR_AND":"RPA_TIMELINE_TASKS_SEPARATOR_OR";a.push(n.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['<span class="ui-item-detail-stream-content-detail-subject-separator">',"</span>"])),n.Loc.getMessage(u)))}});var s=this.data.participantJoint==="queue"?"ui-item-detail-stream-content-detail-subject-resp-wrap-queue":"";return n.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-item-detail-stream-content-detail-subject-resp-wrap ','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),s,a)}},{key:"showParticipants",value:function t(e){var a=this;var s=this.getTaskUsers();var r=s.map(function(t,e){var i=t.id,r=t.status;var l=a.users.get(i);var d=s.length-1!==e?n.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['<span class="ui-item-detail-popup-item-separator">\n\t\t\t\t\t',"\n\t\t\t\t\t</span>"])),n.Loc.getMessage(a.data.participantJoint==="and"?"RPA_TIMELINE_TASKS_SEPARATOR_AND":"RPA_TIMELINE_TASKS_SEPARATOR_OR")):"";var u=n.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['<div class="ui-item-detail-popup-item">\n\t\t\t\t\t<a class="ui-item-detail-stream-content-employee"\n\t\t\t\t\t   ','\n\t\t\t\t\t   target="_blank"\n\t\t\t\t\t   title="','"\n\t\t\t\t\t   ','></a>\n\t\t\t\t\t<div class="ui-item-detail-popup-item-inner">\n\t\t\t\t\t\t<span class="ui-item-detail-popup-item-name">','</span>\n\t\t\t\t\t\t<span class="ui-item-detail-popup-item-position">',"</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>"])),l.link?'href="'.concat(l.link,'"'):"",n.Text.encode(l.fullName),l.photo?"style=\"background-image: url('".concat(l.photo,"'); background-size: 100%;\""):"",n.Text.encode(l.fullName),l.workPosition,d);if(r>a.statusWait){u.classList.add("ui-item-detail-popup-item-"+(r===a.statusOk||r===a.statusYes?"success":"fail"))}else{u.classList.add("ui-item-detail-popup-item-"+(i===a.getUserId()?"current":"wait"))}return u});var l=n.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="ui-item-detail-popup">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>"])),r);if(this.data.participantJoint!=="queue"){l.classList.add("ui-item-detail-popup-option")}var d=new i.Popup("rpa-detail-task-participant-"+this.getId(),e.target,{autoHide:true,draggable:false,bindOptions:{forceBindPosition:true},noAllPaddings:true,closeByEsc:true,cacheable:false,width:280,angle:{position:"top"},overlay:{backgroundColor:"transparent"},content:l});d.show()}},{key:"renderTaskButtons",value:function t(){var e=this.data.controls;if(!e){return""}var a=this.data.type==="RpaRequestActivity"?this.getLinkButtonElements(e.BUTTONS):this.getActionButtonElements(e.BUTTONS);return n.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-item-detail-stream-content-detail-status-block">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),a)}},{key:"getActionButtonElements",value:function t(e){var i=this;return e.map(function(t){var e=t.COLOR;var s=a.Manager.calculateTextColor(t.COLOR);return n.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['<button class="ui-btn ui-btn-sm ui-btn-default" \n\t\t\t\t\tname="','"\n\t\t\t\t\tvalue="','"\n\t\t\t\t\tstyle="background-color: #',";border-color: #",";color:",'"\n\t\t\t\t\tonclick="','"\n\t\t\t\t\t>',"</button>\n\t\t\t\t"])),t.NAME,t.VALUE,e,e,s,i.doTaskHandler.bind(i,t),n.Text.encode(t.TEXT))})}},{key:"getLinkButtonElements",value:function t(e){return[n.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['<a class="ui-btn ui-btn-sm ui-btn-default ui-btn-primary" \n\t\t\t\t\thref="','"\n\t\t\t\t\t>',"</a>\n\t\t\t"])),n.Text.encode(this.data.url),n.Loc.getMessage("RPA_TIMELINE_TASKS_OPEN_TASK"))]}},{key:"renderTaskFields",value:function t(){if(!this.data.fieldsToSet){return""}var e=this.data.fieldsToSet.map(function(t){return n.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="ui-item-detail-stream-content-detail-main-field-value">&ndash; ',"</div>\n\t\t\t\t"])),n.Text.encode(t))});return n.Tag.render(L||(L=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-item-detail-stream-content-detail-main-field">\n\t\t\t\t<div class="ui-item-detail-stream-content-detail-main-field-title">','</div>\n\t\t\t\t<div class="ui-item-detail-stream-content-detail-main-field-value-block">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\t\t\n\t\t"])),n.Loc.getMessage("RPA_TIMELINE_TASKS_FIELDS_TO_SET"),e)}},{key:"getTaskUserName",value:function t(e){if(!e){e=this.getUserId()}var a=this.users.get(n.Text.toInteger(e));return a?a.fullName:"-?-"}},{key:"renderParticipantPhoto",value:function t(e){e=n.Text.toInteger(e);var a={fullName:"",photo:null};if(e>0){a=this.users.get(e)}if(!a){return n.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(["<span></span>"])))}var i=n.Text.encode(a.fullName);return n.Tag.render(H||(H=babelHelpers.taggedTemplateLiteral(['<span class="ui-item-detail-stream-content-employee" title="','" ',"></span>"])),i,a.photo?"style=\"background-image: url('".concat(a.photo,"'); background-size: 100%;\""):"")}},{key:"doTaskHandler",value:function t(e){var a=this;var i={};i[e.NAME]=e.VALUE;i["taskId"]=this.id;this.emit("onBeforeCompleteTask",{taskId:this.id});n.ajax.runAction("rpa.task.do",{analyticsLabel:"rpaTaskDo",data:i}).then(function(t){if(t.data.completed){if(t.data.timeline){a.completedData=t.data.timeline}a.onDelete();a.emit("onCompleteTask",{taskId:a.id})}})}}]);return e}(s.Timeline.Item);var E,P,A,R,C,N;var S=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"renderContainer",value:function t(){var a=babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"renderContainer",this).call(this);a.classList.add("ui-item-detail-stream-section-history");return a}},{key:"renderTaskInfo",value:function t(){var e=this.renderTaskName();if(!e){e=""}var a=this.renderTaskResponsible();if(!a){a=""}return n.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['<div class="ui-item-detail-stream-content-detail-subject">\n\t\t\t','\n\t\t\t<div class="ui-item-detail-stream-content-detail-subject-inner">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t</div>"])),this.renderHeaderUser(this.getUserId(),30),e,a)}},{key:"renderTaskName",value:function t(){var e=this.getTask();if(e){return n.Tag.render(P||(P=babelHelpers.taggedTemplateLiteral(['<a class="ui-item-detail-stream-content-detail-subject-text">',"</a>"])),n.Text.encode(e.NAME))}return null}},{key:"renderTaskResponsible",value:function t(){var e=this.users.get(n.Text.toInteger(this.getUserId()));if(e){return n.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(['<span class="ui-item-detail-stream-content-detail-subject-resp">',"</span>"])),n.Text.encode(e.fullName))}return null}},{key:"renderMain",value:function t(){var e=this.renderTaskInfo();var a=this.renderDetailMain();if(!a){e.classList.add("rpa-item-detail-stream-content-detail-no-main")}return n.Tag.render(R||(R=babelHelpers.taggedTemplateLiteral(['<div class="ui-item-detail-stream-content-detail">\n\t\t\t',"\n\t\t\t","\n\t\t</div>"])),e,a||"")}},{key:"getTask",value:function t(){if(n.Type.isPlainObject(this.data.task)){return this.data.task}return null}},{key:"renderDetailMain",value:function t(){var e=this.getTask();var a="";if(e&&e.DESCRIPTION){a=n.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['<span class="ui-item-detail-stream-content-detail-main-text">',"</span>"])),n.Text.encode(e.DESCRIPTION))}var i=this.renderStageChange();var s=this.renderFieldsChange();if(a||i||s){return n.Tag.render(N||(N=babelHelpers.taggedTemplateLiteral(['<div class="ui-item-detail-stream-content-detail-main">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>"])),a,s?[this.renderFieldsChangeTitle(),s]:"",i?[this.renderStageChangeTitle(),i]:"")}return null}}]);return e}(s.Timeline.History);var _={Task:I,TaskComplete:S};t.Timeline=_})(this.BX.Rpa=this.BX.Rpa||{},BX.Event,BX.Rpa,BX.Main,BX,BX.UI);
//# sourceMappingURL=timeline.bundle.map.js