(function(){"use strict";BX.namespace("BX.Voximplant");var t={gridId:"",numbers:{},users:{},isPhoneAllowed:false,lastGridUrl:null};BX.Voximplant.UserEditor=function(e){this.userId=e.userId;this.popup=null;this.loader=null;this.lastGridUrl=null;this.passwordEdit=false;this.elements={deviceSettings:null,deviceOverlay:null,server:null,login:null,passwordBox:null,passwordInput:null,passwordSpan:null};Object.defineProperty(this,"defaults",{get:function(){return t}})};BX.Voximplant.UserEditor.setDefaults=function(e){t.numbers=BX.prop.getObject(e,"numbers",t.numbers);t.gridId=BX.prop.getString(e,"gridId",t.gridId);t.users=BX.prop.getObject(e,"users",t.users);t.isPhoneAllowed=BX.prop.getBoolean(e,"isPhoneAllowed",t.isPhoneAllowed);t.lastGridUrl=BX.prop.getString(e,"lastGridUrl",t.lastGridUrl)};BX.Voximplant.UserEditor.prototype={show:function(){BX.ajax.runComponentAction("bitrix:voximplant.numbers","getUserOptions",{data:{userId:this.userId}}).then(function(t){this.data=t.data;this.popup=this.createPopup();this.popup.show()}.bind(this))},createPopup:function(){return new BX.PopupWindow("voximplant-user-settings",null,{autoHide:true,closeByEsc:true,closeIcon:false,contentNoPaddings:true,contentColor:"white",events:{onPopupClose:function(){this.destroy()},onPopupDestroy:function(){this.popup=null}.bind(this)},content:this.render(),buttons:[new BX.PopupWindowCustomButton({id:"save",text:BX.message("VI_NUMBERS_SAVE"),className:"ui-btn ui-btn-md ui-btn-primary",events:{click:this.onSaveButtonClick.bind(this)}})]})},render:function(){return BX.create("div",{props:{className:"voximplant-options-popup"},events:{click:this.onPopupBodyClick.bind(this)},children:[BX.create("div",{props:{className:"voximplant-control-row"},children:[BX.create("div",{props:{className:"voximplant-control-subtitle"},text:BX.message("VI_NUMBERS_GRID_CODE")}),BX.create("input",{props:{className:"voximplant-control-input"},attrs:{type:"text",value:BX.type.isNotEmptyString(this.data.extension)?BX.util.htmlspecialchars(this.data.extension):""},events:{bxchange:function(t){this.data.extension=t.currentTarget.value}.bind(this)}})]}),BX.create("div",{props:{className:"voximplant-control-row"},children:[BX.create("div",{props:{className:"voximplant-control-subtitle"},text:BX.message("VI_NUMBERS_GRID_PHONE")}),BX.create("select",{props:{className:"voximplant-control-select"},children:this.renderLineOptions(this.data.userLine),events:{bxchange:function(t){this.data.userLine=t.currentTarget.value}.bind(this)}})]}),BX.create("div",{props:{className:"voximplant-control-row"},children:[BX.create("div",{props:{className:"voximplant-control-subtitle"},text:BX.message("VI_NUMBERS_GRID_PHONE_DEVICE")}),BX.create("select",{props:{className:"voximplant-control-select"},children:[BX.create("option",{attrs:{value:"N",selected:this.data.phoneEnabled==="N"},text:BX.message("VI_NUMBERS_PHONE_DEVICE_DISABLE")}),BX.create("option",{attrs:{value:"Y",selected:this.data.phoneEnabled==="Y"},text:BX.message("VI_NUMBERS_PHONE_DEVICE_ENABLE")})],events:{bxchange:this.onDeviceEnabledChange.bind(this)}})]}),BX.create("div",{props:{className:"voximplant-control-row"},children:[this.elements.deviceSettings=BX.create("div",{props:{className:"voximplant-control-settings"},style:{maxHeight:this.data.phoneEnabled==="Y"?"200px":0},children:[BX.create("div",{props:{className:"voximplant-control-subtitle"},text:BX.message("VI_NUMBERS_PHONE_CONNECT_INFO")+":"}),BX.create("div",{props:{className:"voximplant-control-settings-row"},children:[BX.create("div",{props:{className:"voximplant-control-settings-name"},text:BX.message("VI_NUMBERS_PHONE_CONNECT_SERVER")+":"}),this.elements.server=BX.create("div",{props:{className:"voximplant-control-settings-value-box"},text:this.data.phoneServer})]}),BX.create("div",{props:{className:"voximplant-control-settings-row"},children:[BX.create("div",{props:{className:"voximplant-control-settings-name"},text:BX.message("VI_NUMBERS_PHONE_CONNECT_LOGIN")+":"}),this.elements.login=BX.create("div",{props:{className:"voximplant-control-settings-value-box"},text:this.data.phoneLogin})]}),BX.create("div",{props:{className:"voximplant-control-settings-row"},children:[BX.create("div",{props:{className:"voximplant-control-settings-name"},text:BX.message("VI_NUMBERS_PHONE_CONNECT_PASSWORD")+":"}),this.elements.passwordBox=BX.create("div",{props:{className:"voximplant-control-settings-value-box"},children:[this.elements.passwordInput=BX.create("input",{attrs:{type:"text"},props:{className:"voximplant-control-settings-input"},events:{bxchange:function(t){this.data.phonePassword=t.currentTarget.value;this.elements.passwordSpan.innerText=this.data.phonePassword}.bind(this)}}),this.elements.passwordSpan=BX.create("span",{props:{className:"voximplant-control-settings-value"},text:this.data.phonePassword}),BX.create("span",{props:{className:"voximplant-control-settings-btn"},events:{click:this.onEditPasswordClick.bind(this)}})]})]}),this.elements.deviceOverlay=BX.create("div",{props:{className:"voximplant-control-settings-overlay"}})]})]})]})},renderLineOptions:function(e){var s=[];for(var n in t.numbers){if(!t.numbers.hasOwnProperty(n)){continue}var a=BX.create("option",{attrs:{value:n},html:t.numbers[n]});if(n===e){a.selected=true}s.push(a)}return s},showLoader:function(t){this.elements.deviceOverlay.classList.add("active");if(!this.loader){this.loader=new BX.Loader({target:this.elements.deviceOverlay})}this.loader.show()},hideLoader:function(t){this.elements.deviceOverlay.classList.remove("active");this.loader.hide()},onDeviceEnabledChange:function(t){this.data.phoneEnabled=t.currentTarget.value;if(this.data.phoneEnabled==="Y"){this.elements.deviceSettings.style.maxHeight="200px";if(true||!this.data.phonePassword){this.showLoader();BX.ajax.runComponentAction("bitrix:voximplant.numbers","getPhoneAuth",{data:{userId:this.userId}}).then(function(t){this.hideLoader();this.data.phonePassword=t.data.phonePassword;this.elements.passwordSpan.innerText=this.data.phonePassword?this.data.phonePassword:"";this.elements.passwordInput.value=this.data.phonePassword}.bind(this))}}else{this.elements.deviceSettings.style.maxHeight="0"}},onEditPasswordClick:function(t){if(this.passwordEdit){this.passwordEdit=false;this.elements.passwordBox.classList.remove("voximplant-control-settings-active")}else{this.passwordEdit=true;this.elements.passwordInput.value=this.data.phonePassword;this.elements.passwordBox.classList.add("voximplant-control-settings-active");this.elements.passwordInput.focus()}t.stopPropagation()},onPopupBodyClick:function(t){if(this.passwordEdit&&t.target!==this.elements.passwordInput){this.passwordEdit=false;this.elements.passwordBox.classList.remove("voximplant-control-settings-active")}},onSaveButtonClick:function(){var e=this.popup.getButton("save");e.buttonNode.classList.add("ui-btn-wait");BX.ajax.runComponentAction("bitrix:voximplant.numbers","saveUserOptions",{data:{userId:this.userId,options:this.data}}).then(function(){var s=BX.Main.gridManager.getInstanceById(t.gridId);if(s){s.reload(t.lastGridUrl)}e.buttonNode.classList.remove("ui-btn-wait");this.popup.close()}.bind(this)).catch(function(t){var s=t.errors[0];BX.Voximplant.alert(BX.message("VI_NUMBERS_ERROR"),BX.util.htmlspecialchars(s.message));e.buttonNode.classList.remove("ui-btn-wait")})}}})();
//# sourceMappingURL=script.map.js