(function(e){BX.namespace("BX.Voximplant");var t=null;var n="/bitrix/components/bitrix/voximplant.queue.list/ajax.php";var a="voximplant_queue_list";var o={canCreateGroup:false,createUrl:""};BX.Voximplant.QueueList=function(){this.bindEvents()};BX.Voximplant.QueueList.getInstance=function(){if(t===null){t=new BX.Voximplant.QueueList}return t};BX.Voximplant.QueueList.setDefaults=function(e){for(var t in e){if(e.hasOwnProperty(t)&&o.hasOwnProperty(t)){o[t]=e[t]}}};BX.Voximplant.QueueList.prototype.bindEvents=function(){BX.addCustomEvent("SidePanel.Slider:onMessage",this._onSidePanelMessage.bind(this));BX.bind(BX("add-queue"),"click",this._onAddGroupButtonClick.bind(this))};BX.Voximplant.QueueList.prototype.edit=function(e){BX.SidePanel.Instance.open(e,{cacheable:false})};BX.Voximplant.QueueList.prototype.delete=function(t){var o=this;t=parseInt(t);var i={action:"delete",sessid:BX.bitrix_sessid(),id:t};var s=BX.showWait();BX.ajax({url:n,method:"POST",data:i,dataType:"json",onsuccess:function(e){BX.closeWait(null,s);if(!e.SUCCESS&&e.USAGES){o.showUsages(e.USAGES)}else{var t=BX.Main.gridManager.getInstanceById(a);if(t)t.reload()}},onfailure:function(){BX.closeWait(null,s);e.alert("Network error")}})};BX.Voximplant.QueueList.prototype.showUsages=function(e){var t=new BX.PopupWindow("vi-queue-usage",null,{closeIcon:true,closeByEsc:true,autoHide:false,titleBar:BX.message("VOX_QUEUE_DELETE_ERROR"),content:this.renderUsagePopup(e),overlay:{color:"gray",opacity:30},buttons:[new BX.PopupWindowButton({id:"close",text:BX.message("VOX_QUEUE_CLOSE"),events:{click:function(){t.close()}}})],events:{onPopupClose:function(){this.destroy()},onPopupDestroy:function(){t=null}}});t.show()};BX.Voximplant.QueueList.prototype.renderUsagePopup=function(e){return BX.create("div",{children:[BX.create("div",{props:{className:"vi-queue-popup-header"},text:BX.message("VOX_QUEUE_IS_USED")}),BX.create("table",{children:this.renderUsages(e)})]})};BX.Voximplant.QueueList.prototype.renderUsages=function(e){var t=[];var n;for(var a=0;a<e.length;a++){n=e[a];t.push(BX.create("tr",{children:[BX.create("td",{children:[BX.create("span",{props:{className:"vi-queue-popup-usage-item"},text:(n.TYPE==="CONFIG"?BX.message("VOX_QUEUE_NUMBER"):BX.message("VOX_QUEUE_IVR"))+": "})]}),BX.create("td",{children:[BX.create("a",{text:n.TITLE,attrs:{href:n.URL,target:"_blank"}})]})]}))}return t};BX.Voximplant.QueueList.prototype._onSidePanelMessage=function(e){if(e.getEventId()==="QueueEditor::onSave"){var t=BX.Main.gridManager.getInstanceById(a);if(t){t.reload()}}};BX.Voximplant.QueueList.prototype._onAddGroupButtonClick=function(e){if(o.canCreateGroup){BX.SidePanel.Instance.open(o.createUrl,{cacheable:false})}else{BX.Voximplant.showLicensePopup("groups")}}})(window);
//# sourceMappingURL=script.map.js