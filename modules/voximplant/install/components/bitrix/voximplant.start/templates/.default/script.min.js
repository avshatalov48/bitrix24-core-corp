"use strict";BX.namespace("BX.Voximplant");BX.Voximplant.Start={mainGrid:null,mainMenuItems:null,settingsMenuItems:null,partnersMenuItems:null,settingsGrid:null,partnersGrid:null,applicationUrlTemplate:"",tariffsUrl:"",isRestOnly:null,balanceMenu:null,isTelephonyAvailable:null,balanceElements:[],lines:[],init:function(e){this.isTelephonyAvailable=BX.prop.getString(e,"isTelephonyAvailable","Y")==="Y";this.linkToBuySip=BX.prop.getString(e,"linkToBuySip","");var t=BX.prop.getArray(e,"mainMenuItems",[]);var i=BX.prop.getArray(e,"settingsMenuItems",[]);var n=BX.prop.getArray(e,"partnersMenuItems",[]);this.mainMenuItems=t.map(this.parseMenuItem,this);this.settingsMenuItems=i.map(this.parseMenuItem,this);this.partnersMenuItems=n.map(this.parseMenuItem,this);this.lines=e.lines;this.applicationUrlTemplate=e.applicationUrlTemplate||"";this.tariffsUrl=e.tariffsUrl||"";this.isRestOnly=e.isRestOnly==="Y";if(this.mainMenuItems.length>0){this.mainGrid=new BX.TileGrid.Grid({id:"voximplant_grid_tile",container:BX("voximplant-grid-block"),items:this.mainMenuItems,itemHeight:98,itemMinWidth:179,itemType:"BX.Voximplant.Start.TileGridItem3"});this.mainGrid.draw()}if(this.settingsMenuItems.length>0){this.settingsGrid=new BX.TileGrid.Grid({id:"voximplant_settings_tile",container:BX("voximplant-grid-settings-block"),items:this.settingsMenuItems,itemHeight:98,itemMinWidth:179,itemType:"BX.Voximplant.Start.TileGridItem3"});this.settingsGrid.draw()}if(this.partnersMenuItems.length>0){this.partnersGrid=new BX.TileGrid.Grid({id:"marketplace_grid_tile",container:BX("marketplace-grid-block"),items:this.partnersMenuItems,itemHeight:100,itemMinWidth:225,itemType:"BX.Voximplant.Start.TileGridItem2"});this.partnersGrid.draw()}this.drawLines();BX.bind(BX("balance-type"),"change",function(e){this.onBalanceTypeChange(e.currentTarget.value)}.bind(this));document.querySelectorAll("[data-for-balance-type]").forEach(function(e){this.balanceElements.push(e)},this);if(BX("balance-type")){this.onBalanceTypeChange(BX("balance-type").value)}BX.bind(BX("balance-top-up"),"click",this.onTopUpButtonClick.bind(this));BX.bind(BX("balance-menu"),"click",this.onBalanceMenuButtonClick.bind(this));BX.bind(BX("sip-buy"),"click",this.onBuySipButtonClick.bind(this));if(BX.PULL){BX.PULL.subscribe({moduleId:"voximplant",command:"balanceUpdate",callback:this.onBalanceUpdate.bind(this)});BX.PULL.extendWatch("vi_balance_change")}BX.ajax.UpdatePageData=function(){}},drawLines:function(){var e=document.getElementById("my-numbers-list");if(e){BX.cleanNode(e);e.appendChild(this.renderLines())}},renderLines:function(){var e=BX.createFragment();e.appendChild(BX.create("div",{props:{className:"voximplant-start-head-box-title"},children:[BX.create("div",{props:{className:"voximplant-title-dark"},text:BX.message("VOX_START_MY_NUMBERS")+(this.lines.length>0?" ("+this.lines.length+")":"")}),this.lines.length>0?BX.create("div",{props:{className:"ui-btn ui-btn-sm ui-btn-light-border"},text:BX.message("VOX_START_SET_UP"),events:{click:this.onMyNumbersButtonClick.bind(this)}}):null]}));var t=BX.create("div",{props:{className:"voximplant-start-head-box-content"}});e.appendChild(t);if(this.lines.length===0){t.appendChild(BX.create("div",{props:{className:"voximplant-start-head-box-info"},text:BX.message("VOX_START_RENT_OR_LINK_NUMBER")}))}else{var i=false;var n;for(var a=0;a<Math.min(this.lines.length,3);a++){var s=this.lines[a];switch(s["TYPE"]){case"RENT":n="voximplant-start-payment voximplant-start-payment-rented-number";i=true;break;case"LINK":n="voximplant-start-payment voximplant-start-payment-anchored-number";break;case"SIP":n="voximplant-start-payment voximplant-start-payment-sip-connector";break;default:n="voximplant-start-payment"}var l=BX.create("div",{props:{className:n},children:[BX.create("div",{props:{className:"voximplant-start-payment-icon"}}),BX.create("div",{props:{className:"voximplant-start-text-dark-bold"},text:s["NAME"]}),BX.create("div",{props:{className:"voximplant-start-division"}}),BX.create("div",{props:{className:"voximplant-start-text-darkgrey"},text:this.decodeHtmlEntities(s["DESCRIPTION"])})]});t.appendChild(l)}if(i){t.appendChild(BX.create("div",{props:{className:"voximplant-start-payment-btn-box"},children:[BX.create("div",{props:{className:"voximplant-start-text-darkgrey"},text:BX.message("VOX_START_AUTO_PROLONG")})]}))}}return e},parseMenuItem:function(e){var t={};for(var i in e){if(!e.hasOwnProperty(i)){return}if(i==="onclick"){t.events={click:new Function("",e.onclick)}}else{t[i]=e[i]}}return t},showConfigEditor:function(e){e=parseInt(e);BX.SidePanel.Instance.open("/telephony/edit.php?ID="+e,{cacheable:false,allowChangeHistory:false,events:{onCloseComplete:this.reload.bind(this)}})},showRestApplication:function(e){var t=this.applicationUrlTemplate.replace("#app#",encodeURIComponent(e));BX.SidePanel.Instance.open(t,{allowChangeHistory:false,events:{onCloseComplete:this.reload.bind(this)}})},openRestAppLayout:function(e,t){BX.ajax.runComponentAction("bitrix:voximplant.start","getRestApp",{data:{code:t}}).then(function(i){var n=i.data;if(n.TYPE==="A"){this.showRestApplication(t)}else{BX.rest.AppLayout.openApplication(e)}}.bind(this)).catch(function(e){BX.Voximplant.alert(" ",e.errors.pop().message)})},onMyNumbersButtonClick:function(){BX.SidePanel.Instance.open("/telephony/lines.php",{cacheable:false,allowChangeHistory:false,events:{onCloseComplete:this.reload.bind(this)}})},onTopUpButtonClick:function(){var e=document.getElementById("balance-top-up");e.parentElement.classList.add("ui-btn-wait");BX.Voximplant.openBilling().then(function(){e.parentElement.classList.remove("ui-btn-wait")})},onBuySipButtonClick:function(){if(!this.isTelephonyAvailable){BX.Voximplant.openLimitSlider("limit_contact_center_telephony_SIP_connector");return}if(this.linkToBuySip){window.open(this.linkToBuySip)}},onBalanceMenuButtonClick:function(){if(!this.balanceMenu){this.balanceMenu=new BX.PopupMenuWindow("telephony-balance-menu",BX("balance-menu"),[{text:BX.message("VOX_START_TARIFFS"),onclick:this.onTariffsButtonClick.bind(this)}])}this.balanceMenu.toggle()},onTariffsButtonClick:function(){this.balanceMenu.close();window.open(this.tariffsUrl)},onBalanceTypeChange:function(e){BX.userOptions.save("voximplant","start","balance_type",e);this.balanceElements.forEach(function(t){if(e===t.dataset.forBalanceType){t.style.removeProperty("display")}else{t.style.display="none"}})},onBalanceUpdate:function(e){if(!BX.Currency){return}var t=document.getElementById("voximplant-balance");if(!t){return}t.innerText=e.balanceFormatted;t.title=e.balanceFormatted},onRentButtonClick:function(e){if(!this.isTelephonyAvailable){BX.Voximplant.openLimitSlider("limit_contact_center_telephony_number_rent");return}e=parseInt(e)||1;BX.Voximplant.NumberRent.create({packetSize:e}).show()},onSipButtonClick:function(e){var t=e==="cloud"?"/telephony/sip_cloud.php":"/telephony/sip_office.php";BX.SidePanel.Instance.open(t,{cacheable:false,allowChangeHistory:false,events:{onCloseComplete:this.reload.bind(this)}})},onAddCallerIdButtonClick:function(e){if(!this.isTelephonyAvailable){BX.Voximplant.openLimitSlider();return}var t=new BX.Voximplant.CallerIdSlider({onClose:this.reload.bind(this)});t.show()},onShowInvoicesButtonClick:function(e){var t="/telephony/invoices.php";BX.SidePanel.Instance.open(t,{cacheable:false,allowChangeHistory:false})},onConfigureNumbersButtonClick:function(){if(this.menuConfigurations){this.menuConfigurations.close();return}var e=BX.Voximplant.Start.settingsGrid.getItem("numberSettings").getContainer();BX.ajax.runComponentAction("bitrix:voximplant.start","getConfigurations").then(function(t){var i=t.data;var n=this.buildConfigurationsMenu(i);this.menuConfigurations=new BX.PopupMenuWindow("telephony-show-configurations",e,n,{events:{onClose:function(){this.menuConfigurations.destroy()}.bind(this),onDestroy:function(){this.menuConfigurations=null}.bind(this)}});this.menuConfigurations.show()}.bind(this))},onConfigureTelephonyButtonClick:function(e){if(this.isRestOnly){BX.SidePanel.Instance.open("/telephony/configs.php",{allowChangeHistory:false})}else{if(this.menuConfigure){this.menuConfigure.close();return}var t=BX.Voximplant.Start.settingsGrid.getItem("telephonySettings").getContainer();this.menuConfigure=new BX.PopupMenuWindow("telephony-configure",t,[{text:BX.message("VOX_START_COMMON_SETTINGS"),onclick:this.onShowCommonSettingsButtonClick.bind(this)},{text:BX.message("VOX_START_CONFIGURE_USERS"),onclick:this.onConfigureUsersClick.bind(this)},{text:BX.message("VOX_START_CONFIGURE_GROUPS"),onclick:this.onConfigureGroupsClick.bind(this)},{text:BX.message("VOX_START_CONFIGURE_IVR"),onclick:this.onConfigureIvrClick.bind(this)},{text:BX.message("VOX_START_CONFIGURE_BLACK_LIST"),onclick:this.onConfigureBlackListClick.bind(this)}],{events:{onClose:function(){this.menuConfigure.destroy()}.bind(this),onDestroy:function(){this.menuConfigure=null}.bind(this)}});this.menuConfigure.show()}},onUploadDocumentsButtonClick:function(e){BX.SidePanel.Instance.open("/telephony/documents.php",{allowChangeHistory:false})},onAccessControlButtonClick:function(e){BX.SidePanel.Instance.open("/telephony/permissions.php",{allowChangeHistory:false,cacheable:false})},onSipPhonesButtonClick:function(e){BX.Helper.show("redirect=detail&code=12932720")},onConfigureUsersClick:function(e){BX.SidePanel.Instance.open("/telephony/users.php",{allowChangeHistory:false})},onShowCommonSettingsButtonClick:function(e){BX.SidePanel.Instance.open("/telephony/configs.php",{allowChangeHistory:false})},onConfigureGroupsClick:function(e){BX.SidePanel.Instance.open("/telephony/groups.php",{allowChangeHistory:false})},onConfigureIvrClick:function(e){BX.SidePanel.Instance.open("/telephony/ivr.php",{allowChangeHistory:false})},onConfigureBlackListClick:function(e){BX.SidePanel.Instance.open("/telephony/blacklist.php",{allowChangeHistory:false,cacheable:false})},buildConfigurationsMenu:function(e){var t=[];var i=[];var n=[];for(var a in e){var s=e[a];switch(s["TYPE"]){case"GROUP":case"RENT":t.push(s);break;case"SIP":i.push(s);break;case"LINK":n.push(s)}}var l=[];var o=function(e){l.push({text:BX.util.htmlspecialchars(e["NAME"]),onclick:this.showConfigEditor.bind(this,e["ID"])})};if(t.length>0){l.push({text:BX.message("VOX_START_NUMBERS"),delimiter:true})}t.forEach(o,this);if(i.length>0){l.push({text:"SIP",delimiter:true})}i.forEach(o,this);if(n.length>0){l.push({text:BX.message("VOX_START_CALLER_IDS"),delimiter:true})}n.forEach(o,this);return l},reload:function(){BX.ajax.runComponentAction("bitrix:voximplant.start","getComponentResult").then(function(e){var t=e.data;this.mainMenuItems=t.mainMenuItems.map(this.parseMenuItem,this);this.settingsMenuItems=t.settingsMenuItems.map(this.parseMenuItem,this);this.partnersMenuItems=t.partnersMenuItems.map(this.parseMenuItem,this);this.lines=t.lines;this.drawLines();if(this.mainGrid){this.mainGrid.redraw(this.mainMenuItems)}if(this.settingsGrid){this.settingsGrid.redraw(this.settingsMenuItems)}if(this.partnersGrid){this.partnersGrid.redraw(this.partnersMenuItems)}}.bind(this))},decodeHtmlEntities:function(e){var t=document.createElement("p");t.innerHTML=e;return t.innerText}};BX.Voximplant.Start.TileGridItem=function(e){BX.TileGrid.Item.apply(this,arguments);this.title=e.title;this.image=e.image;this.className=e.className;this.selected=e.selected;this.events=e.events||{};this.badge=e.badge};BX.Voximplant.Start.TileGridItem.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,getContent:function(){return BX.create("div",{props:{className:"voximplant-tile-item"+" "+this.className+" "+(this.selected?this.selected:"")},children:[BX.create("div",{props:{className:BX.type.isNotEmptyString(this.badge)?"voximplant-marketplace-tile-badge voximplant-marketplace-tile-badge-show":"voximplant-marketplace-tile-badge"},text:this.badge}),BX.create("div",{props:{className:"voximplant-tile-img"},style:{backgroundImage:this.image?'url("'+this.image+'")':null}}),BX.create("div",{props:{className:"voximplant-tile-name"},children:[BX.create("span",{props:{className:"voximplant-tile-text"},text:this.title?this.title:"No title, sorry"}),BX.create("span",{props:{className:"voximplant-tile-lock"}})]})],events:this.events})}};BX.Voximplant.Start.TileGridItem2=function(e){BX.TileGrid.Item.apply(this,arguments);this.title=e.title;this.image=e.image;this.description=e.description;this.className=e.className;this.events=e.events||{};this.badge=e.badge;this.counter=e.counter;this.count=e.count;this.integration=e.integration;this.restItem=e.restItem;this.defaultImage="data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2021%2022%22%3E%3Cpath%20fill%3D%22%23FFF%22%20d%3D%22M10.415.008c-.022.006-.044.02-.067.03l-10%203.959c-.25.117-.34.373-.348.673v12.743c.003.285.152.556.349.632l9.902%203.916a.651.651%200%200%200%20.416.01l9.991-3.947c.197-.08.344-.356.342-.642V4.752c.005-.388-.091-.616-.35-.735L10.6.04c-.068-.035-.122-.05-.185-.031zm.059%201.357l8.299%203.294-8.299%203.274L2.168%204.65l8.306-3.284z%22/%3E%3C/svg%3E"};BX.Voximplant.Start.TileGridItem2.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,getItemCounter:function(){return BX.create("div",{props:{className:"voximplant-marketplace-tile-item voximplant-marketplace-tile-counter"},children:[BX.create("div",{props:{className:"voximplant-marketplace-tile-counter-head"},children:[BX.create("div",{props:{className:"voximplant-marketplace-tile-counter-name"},text:this.title}),BX.create("div",{props:{className:"voximplant-marketplace-tile-counter-value"},text:this.count})]}),BX.create("div",{props:{className:"voximplant-marketplace-tile-counter-link-box"},children:[BX.create("div",{props:{className:"voximplant-marketplace-tile-counter-link"},text:this.description})]})],events:this.events})},getItemIntegration:function(){return BX.create("div",{props:{className:"voximplant-marketplace-tile-item voximplant-marketplace-tile-integration"},children:[BX.create("div",{props:{className:"voximplant-marketplace-tile-integration-inner"},children:[BX.create("div",{props:{className:"voximplant-marketplace-tile-integration-logo"}}),BX.create("div",{props:{className:"voximplant-marketplace-tile-integration-text"},text:this.description})]})],events:this.events})},afterRender:function(){if(this.description){this.clipTitle()}},clipTitle:function(){if(!this.layout.description){return}BX.cleanNode(this.layout.description);this.layout.descriptionWrapper=BX.create("span",{text:this.description});this.layout.description.appendChild(this.layout.descriptionWrapper);var e=this.layout.description.offsetHeight;var t=this.description;var i=0;while(e<=this.layout.descriptionWrapper.offsetHeight&&t.length>i){i=i+2;this.layout.descriptionWrapper.innerText=t.slice(0,-i)+"..."}},getContent:function(){if(this.counter){return this.getItemCounter()}if(this.integration){return this.getItemIntegration()}return BX.create("div",{props:{className:!this.image||this.restItem?"voximplant-marketplace-tile-item"+" voximplant-marketplace-default-icon":"voximplant-marketplace-tile-item"},children:[BX.create("div",{props:{className:BX.type.isNotEmptyString(this.badge)?"voximplant-marketplace-tile-badge voximplant-marketplace-tile-badge-show":"voximplant-marketplace-tile-badge"},text:this.badge}),BX.create("div",{props:{className:"voximplant-marketplace-tile-img"},children:[BX.create("div",{props:{className:"voximplant-marketplace-tile-img-item"},style:{backgroundImage:this.image?'url("'+this.image+'")':null}})]}),BX.create("div",{props:{className:"voximplant-marketplace-content"},children:[BX.create("div",{props:{className:this.title?"voximplant-marketplace-tile-name":"voximplant-marketplace-tile-name voximplant-hide"},text:this.title?this.title:""}),this.layout.description=BX.create("div",{props:{className:this.description?"voximplant-marketplace-tile-desc":"voximplant-marketplace-tile-desc voximplant-hide"},text:this.description?this.description:""})]})],events:this.events})}};BX.Voximplant.Start.TileGridItem3=function(e){BX.TileGrid.Item.apply(this,arguments);this.title=e.title;this.image=e.image;this.className=e.className;this.selected=e.selected;this.events=e.events||{};this.badge=e.badge};BX.Voximplant.Start.TileGridItem3.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,getContent:function(){return BX.create("div",{props:{className:"voximplant-tile-item"+" "+this.className+" "+(this.selected?this.selected:"")},children:[BX.create("div",{props:{className:BX.type.isNotEmptyString(this.badge)?"voximplant-marketplace-tile-badge voximplant-marketplace-tile-badge-show":"voximplant-marketplace-tile-badge"},text:this.badge}),BX.create("div",{props:{className:"voximplant-tile-img"},style:{backgroundImage:this.image?'url("'+this.image+'")':null}}),BX.create("div",{props:{className:"voximplant-tile-name"},children:[BX.create("span",{props:{className:"voximplant-tile-text"},text:this.title?this.title:"No title, sorry"}),BX.create("span",{props:{className:"voximplant-tile-lock"}})]})],events:this.events})}};
//# sourceMappingURL=script.map.js