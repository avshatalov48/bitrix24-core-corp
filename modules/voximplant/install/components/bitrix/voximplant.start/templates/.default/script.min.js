"use strict";BX.namespace("BX.Voximplant");BX.Voximplant.Start={mainGrid:null,mainMenuItems:null,settingsMenuItems:null,partnersMenuItems:null,settingsGrid:null,partnersGrid:null,applicationUrlTemplate:"",tariffsUrl:"",crmFormCreateUrl:"",crmFormListUrl:"",isRestOnly:null,balanceMenu:null,isTelephonyAvailable:null,box:null,balanceElements:[],lines:[],crmIntegrationMenuItems:[],init:function(t){this.isTelephonyAvailable=BX.prop.getString(t,"isTelephonyAvailable","Y")==="Y";this.linkToBuySip=BX.prop.getString(t,"linkToBuySip","");var e=BX.prop.getArray(t,"mainMenuItems",[]);var i=BX.prop.getArray(t,"settingsMenuItems",[]);var n=BX.prop.getArray(t,"partnersMenuItems",[]);var a=BX.prop.getArray(t,"crmIntegrationMenuItems",[]);this.mainMenuItems=e.map(this.parseMenuItem,this);this.settingsMenuItems=i.map(this.parseMenuItem,this);this.crmIntegrationMenuItems=a.map(this.parseMenuItem,this);this.partnersMenuItems=n.map(this.parseMenuItem,this);this.lines=t.lines;this.applicationUrlTemplate=t.applicationUrlTemplate||"";this.tariffsUrl=t.tariffsUrl||"";this.isRestOnly=t.isRestOnly==="Y";this.crmFormListUrl=t.crmFormListUrl||"";this.crmFormCreateUrl=t.crmFormCreateUrl||"";this.isShownPrivacyPolicy=t.isShownPrivacyPolicy==="Y";if(this.mainMenuItems.length>0){this.mainGrid=new BX.TileGrid.Grid({id:"voximplant_grid_tile",container:BX("voximplant-grid-block"),items:this.mainMenuItems,itemHeight:98,itemMinWidth:179,itemType:"BX.Voximplant.Start.TileGridItem3"});this.mainGrid.draw()}if(this.settingsMenuItems.length>0){this.settingsGrid=new BX.TileGrid.Grid({id:"voximplant_settings_tile",container:BX("voximplant-grid-settings-block"),items:this.settingsMenuItems,itemHeight:98,itemMinWidth:179,itemType:"BX.Voximplant.Start.TileGridItem3"});this.settingsGrid.draw()}if(this.crmIntegrationMenuItems.length>0){this.crmIntegrationGrid=new BX.TileGrid.Grid({id:"voximplant_grid_tile",container:BX("voximplant-grid-crm-block"),items:this.crmIntegrationMenuItems,itemHeight:98,itemMinWidth:179,itemType:"BX.Voximplant.Start.TileGridItem3"});this.crmIntegrationGrid.draw()}if(this.partnersMenuItems.length>0){this.partnersGrid=new BX.TileGrid.Grid({id:"marketplace_grid_tile",container:BX("marketplace-grid-block"),items:this.partnersMenuItems,itemHeight:100,itemMinWidth:225,itemType:"BX.Voximplant.Start.TileGridItem2"});this.partnersGrid.draw()}this.drawLines();BX.bind(BX("balance-type"),"change",function(t){this.onBalanceTypeChange(t.currentTarget.value)}.bind(this));document.querySelectorAll("[data-for-balance-type]").forEach((function(t){this.balanceElements.push(t)}),this);if(BX("balance-type")){this.onBalanceTypeChange(BX("balance-type").value)}if(this.isShownPrivacyPolicy){BX.bind(BX("sip-buy"),"click",this.onBuySipButtonClickWithPopup.bind(this))}else{BX.bind(BX("sip-buy"),"click",this.onBuySipButtonClick.bind(this))}BX.bind(BX("balance-top-up"),"click",this.onTopUpButtonClick.bind(this));BX.bind(BX("balance-menu"),"click",this.onBalanceMenuButtonClick.bind(this));if(BX.PULL){BX.PULL.subscribe({moduleId:"voximplant",command:"balanceUpdate",callback:this.onBalanceUpdate.bind(this)});BX.PULL.extendWatch("vi_balance_change")}BX.ajax.UpdatePageData=function(){}},drawLines:function(){var t=document.getElementById("my-numbers-list");if(t){BX.cleanNode(t);t.appendChild(this.renderLines())}},renderLines:function(){var t=BX.createFragment();t.appendChild(BX.create("div",{props:{className:"voximplant-start-head-box-title"},children:[BX.create("div",{props:{className:"voximplant-title-dark"},text:BX.message("VOX_START_MY_NUMBERS")+(this.lines.length>0?" ("+this.lines.length+")":"")}),this.lines.length>0?BX.create("div",{props:{className:"ui-btn ui-btn-sm ui-btn-light-border"},text:BX.message("VOX_START_SET_UP"),events:{click:this.onMyNumbersButtonClick.bind(this)}}):null]}));var e=BX.create("div",{props:{className:"voximplant-start-head-box-content"}});t.appendChild(e);if(this.lines.length===0){e.appendChild(BX.create("div",{props:{className:"voximplant-start-head-box-info"},text:BX.message("VOX_START_RENT_OR_LINK_NUMBER")}))}else{var i=false;var n;for(var a=0;a<Math.min(this.lines.length,3);a++){var s=this.lines[a];switch(s["TYPE"]){case"RENT":n="voximplant-start-payment voximplant-start-payment-rented-number";i=true;break;case"LINK":n="voximplant-start-payment voximplant-start-payment-anchored-number";break;case"SIP":n="voximplant-start-payment voximplant-start-payment-sip-connector";break;default:n="voximplant-start-payment"}var o=BX.create("div",{props:{className:n},children:[BX.create("div",{props:{className:"voximplant-start-payment-icon"}}),BX.create("div",{props:{className:"voximplant-start-text-dark-bold"},text:s["NAME"]}),BX.create("div",{props:{className:"voximplant-start-division"}}),BX.create("div",{props:{className:"voximplant-start-text-darkgrey"},text:this.decodeHtmlEntities(s["DESCRIPTION"])})]});e.appendChild(o)}if(i){e.appendChild(BX.create("div",{props:{className:"voximplant-start-payment-btn-box"},children:[BX.create("div",{props:{className:"voximplant-start-text-darkgrey"},text:BX.message("VOX_START_AUTO_PROLONG")})]}))}}return t},parseMenuItem:function(t){var e={};for(var i in t){if(!t.hasOwnProperty(i)){return}if(i==="onclick"){e.events={click:new Function("",t.onclick)}}else{e[i]=t[i]}}return e},showConfigEditor:function(t){t=parseInt(t);BX.SidePanel.Instance.open("/telephony/edit.php?ID="+t,{cacheable:false,allowChangeHistory:false,events:{onCloseComplete:this.reload.bind(this)}})},showRestApplication:function(t){var e=this.applicationUrlTemplate.replace("#app#",encodeURIComponent(t));BX.SidePanel.Instance.open(e,{allowChangeHistory:false,events:{onCloseComplete:this.reload.bind(this)}})},openRestAppLayout:function(t,e){BX.ajax.runComponentAction("bitrix:voximplant.start","getRestApp",{data:{code:e}}).then(function(i){var n=i.data;if(n.TYPE==="A"){this.showRestApplication(e)}else{BX.rest.AppLayout.openApplication(t)}}.bind(this)).catch((function(t){BX.Voximplant.alert(" ",t.errors.pop().message)}))},onMyNumbersButtonClick:function(){BX.SidePanel.Instance.open("/telephony/lines.php",{cacheable:false,allowChangeHistory:false,events:{onCloseComplete:this.reload.bind(this)}})},onTopUpButtonClick:function(){var t=document.getElementById("balance-top-up");t.parentElement.classList.add("ui-btn-wait");BX.Voximplant.openBilling().then((function(){t.parentElement.classList.remove("ui-btn-wait")}))},onBuySipButtonClickWithPopup:function(){this.sipBuyPopup=new BX.PopupWindow("connecting-to-sip",null,{closeIcon:true,closeByEsc:true,autoHide:false,content:BX.message("VOX_START_SIP_BUY_POPUP_TEXT").replace("#LINK1START#",'<a target="_blank" href="https://voximplant.com/legal/privacy">').replace("#LINK1END#","</a>").replace("#LINK2START#",'<a target="_blank" href="https://cdn.voximplant.com/data-processing-addendum-new.pdf">').replace("#LINK2END#","</a>"),zIndex:16e3,maxWidth:800,overlay:{color:"gray",opacity:30},buttons:[new BX.UI.Button({text:BX.message("VOX_START_POPUP_BUTTON_I_AGREE"),size:BX.UI.Button.Size.MEDIUM,tag:BX.UI.Button.Tag.BUTTON,color:BX.UI.Button.Color.LIGHT_BORDER,onclick:function(){this.onBuySipButtonClick();this.sipBuyPopup.destroy()}.bind(this)}),new BX.UI.Button({text:BX.message("VOX_START_POPUP_BUTTON_CANCEL"),size:BX.UI.Button.Size.MEDIUM,tag:BX.UI.Button.Tag.BUTTON,color:BX.UI.Button.Color.LIGHT,onclick:function(){this.sipBuyPopup.destroy()}.bind(this)})],events:{onPopupClose:function(){this.destroy()},onPopupDestroy:function(){this.sipBuyPopup=null}.bind(this)}});this.sipBuyPopup.show()},onBuySipButtonClick:function(){if(!this.isTelephonyAvailable){BX.Voximplant.openLimitSlider("limit_contact_center_telephony_SIP_connector");return}if(this.linkToBuySip){window.open(this.linkToBuySip)}},onBalanceMenuButtonClick:function(){if(!this.balanceMenu){this.balanceMenu=new BX.PopupMenuWindow("telephony-balance-menu",BX("balance-menu"),[{text:BX.message("VOX_START_TARIFFS"),onclick:this.onTariffsButtonClick.bind(this)}])}this.balanceMenu.toggle()},onTariffsButtonClick:function(){this.balanceMenu.close();window.open(this.tariffsUrl)},onBalanceTypeChange:function(t){BX.userOptions.save("voximplant","start","balance_type",t);this.balanceElements.forEach((function(e){if(t===e.dataset.forBalanceType){e.style.removeProperty("display")}else{e.style.display="none"}}))},onBalanceUpdate:function(t){if(!BX.Currency){return}var e=document.getElementById("voximplant-balance");if(!e){return}e.innerText=t.balanceFormatted;e.title=t.balanceFormatted},onRentButtonClick:function(t){if(!this.isTelephonyAvailable){BX.Voximplant.openLimitSlider("limit_contact_center_telephony_number_rent");return}t=parseInt(t)||1;BX.Voximplant.NumberRent.create({packetSize:t}).show()},onSipButtonClick:function(t){var e=t==="cloud"?"/telephony/sip_cloud.php":"/telephony/sip_office.php";BX.SidePanel.Instance.open(e,{cacheable:false,allowChangeHistory:false,events:{onCloseComplete:this.reload.bind(this)}})},onAddCallerIdButtonClick:function(t){if(!this.isTelephonyAvailable){BX.Voximplant.openLimitSlider();return}var e=new BX.Voximplant.CallerIdSlider({onClose:this.reload.bind(this)});e.show()},onShowInvoicesButtonClick:function(t){var e="/telephony/invoices.php";BX.SidePanel.Instance.open(e,{cacheable:false,allowChangeHistory:false})},onConfigureNumbersButtonClick:function(){if(this.menuConfigurations){this.menuConfigurations.close();return}var t=BX.Voximplant.Start.settingsGrid.getItem("numberSettings").getContainer();BX.ajax.runComponentAction("bitrix:voximplant.start","getConfigurations").then(function(e){var i=e.data;var n=this.buildConfigurationsMenu(i);this.menuConfigurations=new BX.PopupMenuWindow("telephony-show-configurations",t,n,{events:{onClose:function(){this.menuConfigurations.destroy()}.bind(this),onDestroy:function(){this.menuConfigurations=null}.bind(this)}});this.menuConfigurations.show()}.bind(this))},onConfigureTelephonyButtonClick:function(t){if(this.isRestOnly){BX.SidePanel.Instance.open("/telephony/configs.php",{allowChangeHistory:false})}else{if(this.menuConfigure){this.menuConfigure.close();return}var e=BX.Voximplant.Start.settingsGrid.getItem("telephonySettings").getContainer();this.menuConfigure=new BX.PopupMenuWindow("telephony-configure",e,[{text:BX.message("VOX_START_COMMON_SETTINGS"),onclick:this.onShowCommonSettingsButtonClick.bind(this)},{text:BX.message("VOX_START_CONFIGURE_USERS"),onclick:this.onConfigureUsersClick.bind(this)},{text:BX.message("VOX_START_CONFIGURE_GROUPS"),onclick:this.onConfigureGroupsClick.bind(this)},{text:BX.message("VOX_START_CONFIGURE_IVR"),onclick:this.onConfigureIvrClick.bind(this)},{text:BX.message("VOX_START_CONFIGURE_BLACK_LIST"),onclick:this.onConfigureBlackListClick.bind(this)}],{events:{onClose:function(){this.menuConfigure.destroy()}.bind(this),onDestroy:function(){this.menuConfigure=null}.bind(this)}});this.menuConfigure.show()}},onUploadDocumentsButtonClick:function(t){BX.SidePanel.Instance.open("/telephony/documents.php",{allowChangeHistory:false})},onAccessControlButtonClick:function(t){BX.SidePanel.Instance.open("/telephony/permissions.php",{allowChangeHistory:false,cacheable:false})},onCrmCallbackFormClick:function(t){if(this.integrationConfigure){this.integrationConfigure.close();return}var e=BX.Voximplant.Start.crmIntegrationGrid.getItem("crmFormCallback").getContainer();this.integrationConfigure=new BX.PopupMenuWindow("crm-form-integration",e,[{text:BX.message("VOX_START_CRM_INTEGRATION_FORM_CREATE"),onclick:this.onCrmCallbackFormCreateClick.bind(this)},{text:BX.message("VOX_START_CRM_INTEGRATION_FORM_LIST"),onclick:this.onCrmCallbackFormListClick.bind(this)},{text:BX.message("VOX_START_CRM_INTEGRATION_FORM_HELP"),onclick:this.onCrmCallbackFormHelpClick.bind(this)}],{events:{onClose:function(){this.integrationConfigure.destroy()}.bind(this),onDestroy:function(){this.integrationConfigure=null}.bind(this)}});this.integrationConfigure.show()},onCrmCallbackFormCreateClick:function(t){top.location.href=this.crmFormCreateUrl},onCrmCallbackFormListClick:function(t){BX.SidePanel.Instance.open(this.crmFormListUrl,{allowChangeHistory:false})},onCrmCallbackFormHelpClick:function(t){top.BX.Helper.show("redirect=detail&code=6875449")},onCrmEmptyCallbackFormHelpClick:function(t){top.BX.Helper.show("redirect=detail&code=6875449")},onSipPhonesButtonClick:function(t){top.BX.Helper.show("redirect=detail&code=12932720")},onConfigureUsersClick:function(t){BX.SidePanel.Instance.open("/telephony/users.php",{allowChangeHistory:false})},onShowCommonSettingsButtonClick:function(t){BX.SidePanel.Instance.open("/telephony/configs.php",{allowChangeHistory:false})},onConfigureGroupsClick:function(t){BX.SidePanel.Instance.open("/telephony/groups.php",{allowChangeHistory:false})},onConfigureIvrClick:function(t){BX.SidePanel.Instance.open("/telephony/ivr.php",{allowChangeHistory:false})},onConfigureBlackListClick:function(t){BX.SidePanel.Instance.open("/telephony/blacklist.php",{allowChangeHistory:false,cacheable:false})},buildConfigurationsMenu:function(t){var e=[];var i=[];var n=[];for(var a in t){var s=t[a];switch(s["TYPE"]){case"GROUP":case"RENT":e.push(s);break;case"SIP":i.push(s);break;case"LINK":n.push(s)}}var o=[];var l=function(t){o.push({text:BX.util.htmlspecialchars(t["NAME"]),onclick:this.showConfigEditor.bind(this,t["ID"])})};if(e.length>0){o.push({text:BX.message("VOX_START_NUMBERS"),delimiter:true})}e.forEach(l,this);if(i.length>0){o.push({text:"SIP",delimiter:true})}i.forEach(l,this);if(n.length>0){o.push({text:BX.message("VOX_START_CALLER_IDS"),delimiter:true})}n.forEach(l,this);return o},reload:function(){BX.ajax.runComponentAction("bitrix:voximplant.start","getComponentResult").then(function(t){var e=t.data;this.mainMenuItems=e.mainMenuItems.map(this.parseMenuItem,this);this.settingsMenuItems=e.settingsMenuItems.map(this.parseMenuItem,this);this.partnersMenuItems=e.partnersMenuItems.map(this.parseMenuItem,this);this.lines=e.lines;this.drawLines();if(this.mainGrid){this.mainGrid.redraw(this.mainMenuItems)}if(this.settingsGrid){this.settingsGrid.redraw(this.settingsMenuItems)}if(this.partnersGrid){this.partnersGrid.redraw(this.partnersMenuItems)}}.bind(this))},decodeHtmlEntities:function(t){var e=document.createElement("p");e.innerHTML=t;return e.innerText}};BX.Voximplant.Start.TileGridItem=function(t){BX.TileGrid.Item.apply(this,arguments);this.title=t.title;this.image=t.image;this.className=t.className;this.selected=t.selected;this.events=t.events||{};this.badge=t.badge};BX.Voximplant.Start.TileGridItem.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,getContent:function(){return BX.create("div",{props:{className:"voximplant-tile-item"+" "+this.className+" "+(this.selected?this.selected:"")},children:[BX.create("div",{props:{className:BX.type.isNotEmptyString(this.badge)?"voximplant-marketplace-tile-badge voximplant-marketplace-tile-badge-show":"voximplant-marketplace-tile-badge"},text:this.badge}),BX.create("div",{props:{className:"voximplant-tile-img"},style:{backgroundImage:this.image?'url("'+this.image+'")':null}}),BX.create("div",{props:{className:"voximplant-tile-name"},children:[BX.create("span",{props:{className:"voximplant-tile-text"},text:this.title?this.title:"No title, sorry"}),BX.create("span",{props:{className:"voximplant-tile-lock"}})]})],events:this.events})}};BX.Voximplant.Start.TileGridItem2=function(t){BX.TileGrid.Item.apply(this,arguments);this.title=t.title;this.image=t.image;this.description=t.description;this.className=t.className;this.events=t.events||{};this.badge=t.badge;this.counter=t.counter;this.count=t.count;this.integration=t.integration;this.restItem=t.restItem;this.defaultImage="data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2021%2022%22%3E%3Cpath%20fill%3D%22%23FFF%22%20d%3D%22M10.415.008c-.022.006-.044.02-.067.03l-10%203.959c-.25.117-.34.373-.348.673v12.743c.003.285.152.556.349.632l9.902%203.916a.651.651%200%200%200%20.416.01l9.991-3.947c.197-.08.344-.356.342-.642V4.752c.005-.388-.091-.616-.35-.735L10.6.04c-.068-.035-.122-.05-.185-.031zm.059%201.357l8.299%203.294-8.299%203.274L2.168%204.65l8.306-3.284z%22/%3E%3C/svg%3E"};BX.Voximplant.Start.TileGridItem2.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,getItemCounter:function(){return BX.create("div",{props:{className:"voximplant-marketplace-tile-item voximplant-marketplace-tile-counter"},children:[BX.create("div",{props:{className:"voximplant-marketplace-tile-counter-head"},children:[BX.create("div",{props:{className:"voximplant-marketplace-tile-counter-name"},text:this.title}),BX.create("div",{props:{className:"voximplant-marketplace-tile-counter-value"},text:this.count})]}),BX.create("div",{props:{className:"voximplant-marketplace-tile-counter-link-box"},children:[BX.create("div",{props:{className:"voximplant-marketplace-tile-counter-link"},text:this.description})]})],events:this.events})},getItemIntegration:function(){return BX.create("div",{props:{className:"voximplant-marketplace-tile-item voximplant-marketplace-tile-integration"},children:[BX.create("div",{props:{className:"voximplant-marketplace-tile-integration-inner"},children:[BX.create("div",{props:{className:"voximplant-marketplace-tile-integration-logo"}}),BX.create("div",{props:{className:"voximplant-marketplace-tile-integration-text"},text:this.description})]})],events:this.events})},afterRender:function(){if(this.description){this.clipTitle()}},clipTitle:function(){if(!this.layout.description){return}BX.cleanNode(this.layout.description);this.layout.descriptionWrapper=BX.create("span",{text:this.description});this.layout.description.appendChild(this.layout.descriptionWrapper);var t=this.layout.description.offsetHeight;var e=this.description;var i=0;while(t<=this.layout.descriptionWrapper.offsetHeight&&e.length>i){i=i+2;this.layout.descriptionWrapper.innerText=e.slice(0,-i)+"..."}},getContent:function(){if(this.counter){return this.getItemCounter()}if(this.integration){return this.getItemIntegration()}return BX.create("div",{props:{className:!this.image||this.restItem?"voximplant-marketplace-tile-item"+" voximplant-marketplace-default-icon":"voximplant-marketplace-tile-item"},children:[BX.create("div",{props:{className:BX.type.isNotEmptyString(this.badge)?"voximplant-marketplace-tile-badge voximplant-marketplace-tile-badge-show":"voximplant-marketplace-tile-badge"},text:this.badge}),BX.create("div",{props:{className:"voximplant-marketplace-tile-img"},children:[BX.create("div",{props:{className:"voximplant-marketplace-tile-img-item"},style:{backgroundImage:this.image?'url("'+this.image+'")':null}})]}),BX.create("div",{props:{className:"voximplant-marketplace-content"},children:[BX.create("div",{props:{className:this.title?"voximplant-marketplace-tile-name":"voximplant-marketplace-tile-name voximplant-hide"},text:this.title?this.title:""}),this.layout.description=BX.create("div",{props:{className:this.description?"voximplant-marketplace-tile-desc":"voximplant-marketplace-tile-desc voximplant-hide"},text:this.description?this.description:""})]})],events:this.events})}};BX.Voximplant.Start.TileGridItem3=function(t){BX.TileGrid.Item.apply(this,arguments);this.title=t.title;this.image=t.image;this.className=t.className;this.selected=t.selected;this.events=t.events||{};this.badge=t.badge};BX.Voximplant.Start.TileGridItem3.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,getContent:function(){return BX.create("div",{props:{className:"voximplant-tile-item"+" "+this.className+" "+(this.selected?this.selected:"")},children:[BX.create("div",{props:{className:BX.type.isNotEmptyString(this.badge)?"voximplant-marketplace-tile-badge voximplant-marketplace-tile-badge-show":"voximplant-marketplace-tile-badge"},text:this.badge}),BX.create("div",{props:{className:"voximplant-tile-img"},style:{backgroundImage:this.image?'url("'+this.image+'")':null}}),BX.create("div",{props:{className:"voximplant-tile-name"},children:[BX.create("span",{props:{className:"voximplant-tile-text"},text:this.title?this.title:"No title, sorry"}),BX.create("span",{props:{className:"voximplant-tile-lock"}})]})],events:this.events})}};
//# sourceMappingURL=script.map.js