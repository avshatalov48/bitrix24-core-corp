BX.ViPermissionEdit=function(e){this.elements={main:e,accessTable:null,accessTableBody:null,accessTableLastRow:null};this.ajaxUrl="/bitrix/components/bitrix/voximplant.settings.perms/ajax.php";this.init()};BX.ViPermissionEdit.prototype={init:function(){this.elements.accessTable=this.elements.main.querySelector("table.bx-vi-js-role-access-table");this.elements.accessTableBody=this.elements.accessTable.querySelector("tbody");this.elements.accessTableLastRow=this.elements.main.querySelector("tr.bx-vi-js-access-table-last-row");this.bindHandlers();BX.Access.Init({other:{disabled:true}})},bindHandlers:function(){var e=this.elements.main.querySelectorAll(".bx-vi-js-delete-role");var t=this.elements.main.querySelectorAll(".bx-vi-js-delete-access");var s=this.elements.main.querySelectorAll(".bx-vi-js-add-access");var a=this.elements.main.querySelectorAll(".bx-vi-js-select-role");for(var i=0;i<e.length;i++){e[i].removeEventListener("click",this.handleDeleteRoleClick.bind(this));e[i].addEventListener("click",this.handleDeleteRoleClick.bind(this))}for(i=0;i<t.length;i++){t[i].removeEventListener("click",this.handleDeleteAccessClick.bind(this));t[i].addEventListener("click",this.handleDeleteAccessClick.bind(this))}for(i=0;i<s.length;i++){s[i].removeEventListener("click",this.handleAddAccessClick.bind(this));s[i].addEventListener("click",this.handleAddAccessClick.bind(this))}for(i=0;i<a.length;i++){a[i].removeEventListener("change",this.handleSelectRoleChange.bind(this));a[i].addEventListener("change",this.handleSelectRoleChange.bind(this))}},handleDeleteRoleClick:function(e){e.preventDefault();e.stopPropagation();var t=e.target;var s=t.dataset.roleId;var a=this;var i=document.querySelectorAll('*[data-role-id="'+s+'"]');a.confirm(BX.message("VOXIMPLANT_PERM_ROLE_DELETE"),BX.message("VOXIMPLANT_PERM_ROLE_DELETE_CONFIRM"),function(e){BX.showWait();BX.ajax({url:a.ajaxUrl,method:"POST",dataType:"json",data:{action:"deleteRole",roleId:s,sessid:BX.bitrix_sessid()},onsuccess:function(e){BX.closeWait();if(!e||e.ERROR){a.notify(BX.message("VOXIMPLANT_PERM_ERROR"),BX.message("VOXIMPLANT_PERM_ROLE_DELETE_ERROR"));return}for(var t=0;t<i.length;t++){BX.remove(i[t])}},onfailure:function(){BX.closeWait();a.notify(BX.message("VOXIMPLANT_PERM_ERROR"),BX.message("VOXIMPLANT_PERM_ROLE_DELETE_ERROR"))}})})},handleAddAccessClick:function(){var e=this;var t={};var s=this.elements.accessTable.rows.length;for(var a=0;a<s;a++){if(this.elements.accessTable.rows[a].dataset.accessCode){t[this.elements.accessTable.rows[a].dataset.accessCode]=true}}BX.Access.SetSelected(t,"voximplantPerms");BX.Access.ShowForm({bind:"voximplantPerms",callback:function(t){var s;var a;for(var i in t){for(var n in t[i]){s=BX.Access.GetProviderName(t[i][n].provider);a=t[i][n].name;e.renderNewAccessCode(n,s,a,1)}}e.bindHandlers()}})},handleDeleteAccessClick:function(e){e.preventDefault();e.stopPropagation();var t=e.target;var s=t.dataset.accessCode;var a=this.elements.accessTable.querySelectorAll('tr[data-access-code="'+s+'"]');for(var i=0;i<a.length;i++){BX.remove(a[i])}},handleSelectRoleChange:function(e){var t=e.target;var s=t.value;var a=t.dataset.accessCode;var i=this.elements.main.querySelector("tr[data-access-code="+a+"]");if(i){i.dataset.roleId=s}},renderNewAccessCode:function(e,t,s,a){var i=BX("bx-vi-new-access-row").innerHTML;i=this.__replaceAll(i,{PROVIDER:BX.util.htmlspecialchars(t),NAME:BX.util.htmlspecialchars(s),ACCESS_CODE:BX.util.htmlspecialchars(e)});var n=BX.create("tr",{html:i});n.dataset.roleId=a;n.dataset.accessCode=e;n.querySelector("select").value=a;this.elements.accessTableBody.insertBefore(n,this.elements.accessTableLastRow)},confirm:function(e,t,s){BX.UI.Dialogs.MessageBox.confirm(t,e,function(e){e.close();s(true)}.bind(this))},notify:function(e,t,s){var a=this.elements.main.id+"-notify-popup";var i=new BX.PopupWindow(a,null,{content:t,titleBar:e,closeByEsc:true,buttons:[new BX.PopupWindowButton({text:"Ok",className:"popup-window-button-accept",events:{click:function(){i.close();if(BX.type.isFunction(s)){s({})}}}})]});i.show()},__replaceAll:function(e,t){if(!BX.type.isPlainObject(t))return e;var s=e.replace(/#(\w+?)#/g,function(e,s,a){if(t.hasOwnProperty(s))return t[s];else return e});return s}};
//# sourceMappingURL=script.map.js