(function(){var t=null;BX.VoximplantStatisticDetail=function(e){t=this;this.gridContainer=e.gridContainer;this.exportButton=e.exportButton;this.exportUrl=e.exportUrl;this.exportRequestCookieName=e.exportRequestCookieName;this.exportAllowed=e.exportAllowed;this.exporting=false;this.init()};Object.defineProperty(BX.VoximplantStatisticDetail,"Instance",{get:function(){return t}});BX.VoximplantStatisticDetail.prototype.init=function(){this.exportButton.addEventListener("click",this.startExport.bind(this));this.initPlayer()};BX.VoximplantStatisticDetail.prototype.initPlayer=function(){var t=new BX.Fileman.Player("vi_records_player",{width:10,height:10,onInit:function(t){t.vjsPlayer.on("pause",function(){var t=BX.findChildrenByClassName(this.gridContainer,"vi-player-pause");for(var e in t){BX.removeClass(t[e],"vi-player-pause")}}.bind(this))}});t.isAudio=true;var e=t.createElement();e.style.display="none";BX.insertAfter(e,this.gridContainer);t.init();BX.bindDelegate(this.gridContainer,"click",{className:"vi-player-button"},function(e){var i=BX.findChildrenByClassName(this.gridContainer,"vi-player-pause");for(var n in i){BX.removeClass(i[n],"vi-player-pause")}var r=e.srcElement||e.target;var a=r.getAttribute("data-bx-record");if(a){a={src:a,type:"audio/mp3"};var o=t.getSource();if(o&&o.indexOf(a.src)!==-1&&t.isPlaying()){t.pause()}else{t.setSource(a);t.play();BX.addClass(r,"vi-player-pause")}e.preventDefault();return false}}.bind(this))};BX.VoximplantStatisticDetail.prototype.onShowTotalClick=function(t){var e=BX.create("span",{props:{className:"main-grid-panel-content-text"}});var i=t.currentTarget;this.showTotal(e).then(function(t){i.parentElement.appendChild(e);e.innerText=t;BX.cleanNode(i,true)});t.stopPropagation();t.preventDefault()};BX.VoximplantStatisticDetail.prototype.showTotal=function(){return new Promise(function(t){BX.ajax.runComponentAction("bitrix:voximplant.statistic.detail","getRowsCount",{mode:"class"}).then(function(e){var i=e.data;t(i.rowsCount)}).catch(function(t){if(t.errors){t.errors.forEach(function(t){console.error(t.message)})}})})};BX.VoximplantStatisticDetail.prototype.startExport=function(){if(this.exporting){return}if(!this.exportAllowed){viOpenTrialPopup("excel-export");return}var t=BX.util.getRandomString(16);this.exportButton.classList.add("ui-btn-wait");this.exportButton.classList.add("ui-btn-disabled");window.location.href=BX.util.add_url_param(this.exportUrl,{exportRequest:t});this.waitForExportFinish(t).then(function(){this.exportButton.classList.remove("ui-btn-wait");this.exportButton.classList.remove("ui-btn-disabled");this.exporting=false}.bind(this))};BX.VoximplantStatisticDetail.prototype.waitForExportFinish=function(t){var e=new BX.Promise;var i=setInterval(function(){if(BX.getCookie(this.exportRequestCookieName)===t){clearInterval(i);e.resolve()}}.bind(this),1e3);return e}})();
//# sourceMappingURL=script.map.js