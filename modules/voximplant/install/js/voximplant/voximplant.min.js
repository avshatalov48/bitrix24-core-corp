var VoxImplant=function(e){var t={};function n(r){if(t[r]){return t[r].exports}var i=t[r]={i:r,l:false,exports:{}};e[r].call(i.exports,i,i.exports,n);i.l=true;return i.exports}n.m=e;n.c=t;n.d=function(e,t,r){if(!n.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:r})}};n.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="/build";return n(n.s=46)}([function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o;(function(e){e[e["NONE"]=0]="NONE";e[e["ERROR"]=1]="ERROR";e[e["WARNING"]=2]="WARNING";e[e["INFO"]=3]="INFO";e[e["TRACE"]=4]="TRACE"})(o=t.LogLevel||(t.LogLevel={}));var s;(function(e){e[e["SIGNALING"]=0]="SIGNALING";e[e["RTC"]=1]="RTC";e[e["USERMEDIA"]=2]="USERMEDIA";e[e["CALL"]=3]="CALL";e[e["CALLEXP2P"]=4]="CALLEXP2P";e[e["CALLEXSERVER"]=5]="CALLEXSERVER";e[e["CALLMANAGER"]=6]="CALLMANAGER";e[e["CLIENT"]=7]="CLIENT";e[e["AUTHENTICATOR"]=8]="AUTHENTICATOR";e[e["PCFACTORY"]=9]="PCFACTORY";e[e["UTILS"]=10]="UTILS";e[e["ORTC"]=11]="ORTC";e[e["MESSAGING"]=12]="MESSAGING";e[e["REINVITEQ"]=13]="REINVITEQ";e[e["HARDWARE"]=14]="HARDWARE";e[e["ENDPOINT"]=15]="ENDPOINT";e[e["EVENTTARGET"]=16]="EVENTTARGET"})(s=t.LogCategory||(t.LogCategory={}));var c;(function(e){e[e["DISCONNECTED"]="DISCONNECTED"]="DISCONNECTED";e[e["CONNECTING"]="CONNECTING"]="CONNECTING";e[e["CONNECTED"]="CONNECTED"]="CONNECTED";e[e["LOGGING_IN"]="LOGGING_IN"]="LOGGING_IN";e[e["LOGGED_IN"]="LOGGED_IN"]="LOGGED_IN"})(c=t.ClientState||(t.ClientState={}));var l=function(){function e(t,n,r){a(this,e);this.category=t;this.label=n;this.provider=r}r(e,[{key:"log",value:function e(t,n){this.provider.writeMessage(this.category,this.label,t,n)}},{key:"error",value:function e(t){this.log(o.ERROR,t)}},{key:"warning",value:function e(t){this.log(o.WARNING,t)}},{key:"info",value:function e(t){this.log(o.INFO,t)}},{key:"trace",value:function e(t){this.log(o.TRACE,t)}}]);return e}();t.Logger=l;var u=function(){function e(){a(this,e);this.timeOriginGap=0;this.isFirstPrint=true;this.levels={};this.showTrace=false;this._shadowLogging=false}r(e,[{key:"getSLog",value:function e(){return this._shadowLog}},{key:"clearSilentLog",value:function e(){this._shadowLog=[]}},{key:"setLoggerCallback",value:function e(t){this._outerCallback=t}},{key:"setPrettyPrint",value:function e(t){this.prettyPrint=t}},{key:"setLogLevel",value:function e(t,n){if(n===o.TRACE)this.showTrace=true;else this.levels[s[t]]=n}},{key:"writeMessage",value:function t(n,r,a,c){if(a===o.TRACE)e.traceTick++;else e.logTick++;if(!this.timeOriginGap)this.timeOriginGap=performance.now();var l=typeof c=="string"?c:JSON.stringify(c);var u=this.isFirstPrint?this.prettyPrint?(new Date).toUTCString():(new Date).toString():parseInt(""+(performance.now()-this.timeOriginGap)/1e3);var d=a===o.TRACE?"VIWSTR "+e.traceTick:"VIWSLR "+e.logTick;var f=d+" "+u+" "+o[a]+" "+r+": "+l;var g=typeof this.levels[s[n]]!="undefined"?this.levels[s[n]]:o.NONE;if(a<=g||a===o.TRACE&&this.showTrace){if(typeof console.debug!="undefined"&&typeof console.info!="undefined"&&typeof console.error!="undefined"&&typeof console.warn!="undefined"){if(this.prettyPrint){var p;var v="%c"+d+" "+u+" ["+o[a]+"] %c"+r+": %c"+l;var h=(p={},i(p,o.ERROR,"color:#fab005"),i(p,o.WARNING,"color:#af2a2a"),i(p,o.INFO,"color:#0ca678"),i(p,o.TRACE,"color:#8f66ff"),p);if(a===o.ERROR)console.error(f);else if(a===o.WARNING)console.warn(v,h[a],"color:#2375a2","color:#000");else if(a===o.INFO)console.info(v,h[a],"color:#2375a2","color:#000");else if(a===o.TRACE)console.debug(v,h[a],"color:#2375a2","color:#000");else console.log(v,h[a],"color:#2375a2","color:#000")}else{if(a===o.ERROR)console.error(f);else if(a===o.WARNING)console.warn(f);else if(a===o.INFO)console.info(f);else if(a===o.TRACE)console.debug(f);else console.log(f)}}else{console.log(f)}if(this.isFirstPrint)this.isFirstPrint=false}if(this.shadowLogging&&(a!==o.TRACE||this.showTrace)){this._shadowLog.push(f)}if(typeof this._outerCallback==="function"&&(a!==o.TRACE||this.showTrace)){this._outerCallback({formattedText:f,category:n,label:r,level:a,message:l})}}},{key:"createLogger",value:function e(t,n){return new l(t,n,this)}},{key:"_traceName",value:function e(){return"Logger"}},{key:"shadowLogging",get:function e(){return this._shadowLogging},set:function e(t){if(!this._shadowLogging)this._shadowLog=[];this._shadowLogging=t}}],[{key:"get",value:function t(){if(typeof this.inst=="undefined"){this.inst=new e;this.inst.prettyPrint=false}return this.inst}},{key:"d_trace",value:function t(n){return function(t,r,i){return{value:function a(){for(var s=arguments.length,c=Array(s),l=0;l<s;l++){c[l]=arguments[l]}var u=r==="login"||r==="basicLogin"||r==="sendWSMessage"&&c[0]==="login";var d=r==="sendWSMessage"?2:1;var f=t._traceName?""+t._traceName()+(this&&this.settings?" "+this.settings.id:this&&this.id&&typeof this.id!="function"?" "+this.id:""):"";var g="";try{g=c.map(function(e,t){return u&&t===d?'"********"':JSON.stringify(e)}).join()}catch(e){g="circular structure"}e.get().writeMessage(n,f,o.TRACE,r+"("+g+")");return i.value.apply(this,c)}}}}}]);return e}();u.logTick=0;u.traceTick=0;t.LogManager=u},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,n,r)}}else if("value"in i){return i.value}else{var o=i.get;if(o===undefined){return undefined}return o.call(r)}};var a=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,o=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":a(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o}return i>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var u=n(28);var d=n(14);var f=n(20);var g=n(2);var p=n(11);var v=n(7);var h=n(0);var m=n(8);var y=n(6);var C=n(15);var _=n(3);var S=n(13);var E=n(17);var L=n(64);var M=n(65);var b=n(33);var R=n(4);var T=n(42);var k=function(e){c(t,e);function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._connected=false;e.progressToneScript={US:"440@-19,480@-19;*(2/4/1+2)",RU:"425@-19;*(1/3/1)"};e.playingNow=false;e.serversList=[];e.level=100;e.micRequired=false;e.videoConstraints=null;e.progressToneCountry="US";e.progressTone=true;e.enableTrace=false;e.showDebugInfo=false;e.showWarnings=false;e.RTCsupported=false;e._deviceEnumAPI=false;e._h264first=false;e._VP8first=false;e.depLastDevices={ai:[],ao:[],vi:[]};e._alreadyInitialized=false;if(t.instance){throw new Error("Error - use VoxImplant.getInstance()")}t.instance=e;e._promises={};v.default.init();var n=m.PCFactory.get();n.requireMedia=false;e.voxSignaling=g.VoxSignaling.get();e.voxCallManager=y.CallManager.get();e.setLogLevelAll(h.LogLevel.NONE);g.VoxSignaling.get().setRPCHandler(S.RemoteEvent.onPCStats,function(t,n){if(m.PCFactory.get().getPeerConnect(t))e.dispatchEvent({name:"NetStatsReceived",stats:n})});e.logger=h.LogManager.get().createLogger(h.LogCategory.CLIENT,e._traceName());e._defaultSinkId=null;e.loginState=0;return e}r(t,[{key:"playProgressTone",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!t||t&&this.progressTone){if(this.progressToneScript[this.progressToneCountry]!==null){if(!this.playingNow)this.playToneScript(this.progressToneScript[this.progressToneCountry]);this.playingNow=true}}}},{key:"stopProgressTone",value:function e(){if(this.playingNow){this.stopPlayback();this.playingNow=false}}},{key:"onIncomingCall",value:function e(t,n,r,i,a){this.dispatchEvent({name:d.Events.IncomingCall,call:y.CallManager.get().calls[t],headers:i,video:a})}},{key:"init",value:function e(n){var r=this;return new Promise(function(e,i){if(r.alreadyInitialized)i(new Error("WebSDK already initialized"));r._alreadyInitialized=true;r._config=typeof n!=="undefined"?n:{};if(r._config.progressToneCountry!==undefined)r.progressToneCountry=r._config.progressToneCountry;if(r._config.progressTone!==true)r.progressTone=false;if(r._config.serverIp!==undefined)r.serverIp=r._config.serverIp;if(r._config.enableTrace!==undefined)r.enableTrace=r._config.enableTrace;if(r._config.showDebugInfo!==undefined)r.showDebugInfo=r._config.showDebugInfo;if(r._config.showWarnings!==false)r.showWarnings=true;if(typeof r._config.videoContainerId==="string")r.remoteVideoContainerId=r._config.videoContainerId;if(typeof r._config.remoteVideoContainerId==="string")r.remoteVideoContainerId=r._config.remoteVideoContainerId;if(typeof r._config.localVideoContainerId==="string")r.localVideoContainerId=r._config.localVideoContainerId;if(r._config.micRequired!==false)r.micRequired=true;if(typeof r._config.videoSupport!="undefined")r.videoSupport=r._config.videoSupport;else r.videoSupport=false;if(typeof r._config.H264first!="undefined"){r._h264first=r._config.H264first;y.CallManager.get()._h264first=r._h264first}if(typeof r._config.VP8first!="undefined")r._VP8first=r._config.VP8first;if(typeof r._config.rtcStatsCollectionInterval!="undefined")y.CallManager.get().rtcStatsCollectionInterval=r._config.rtcStatsCollectionInterval;else y.CallManager.get().rtcStatsCollectionInterval=1e4;if(typeof t.getInstance().config().experiments!=="undefined"&&typeof t.getInstance().config().experiments.rtcStatsInquiryInterval!=="undefined")y.CallManager.get().rtcStatsInquiryInterval=t.getInstance().config().experiments.rtcStatsInquiryInterval;else y.CallManager.get().rtcStatsInquiryInterval=500;if(r._config.protocolVersion&&(r._config.protocolVersion==="2"||r._config.protocolVersion==="3")){r._callProtocolVersion=r._config.protocolVersion;y.CallManager.get().setProtocolVersion(r._callProtocolVersion)}else r._callProtocolVersion="3";if(r._config.callstatsIoParams)E.CallstatsIo.get(r._config.callstatsIoParams);if(r._config.prettyPrint)h.LogManager.get().setPrettyPrint(r._config.prettyPrint);if(r.showWarnings)r.setLogLevelAll(h.LogLevel.WARNING);if(r.showDebugInfo)r.setLogLevelAll(h.LogLevel.INFO);if(r.enableTrace)r.setLogLevelAll(h.LogLevel.TRACE);r.logger.info("SDK version: "+r.version);r.logger.info("init("+JSON.stringify(r._config)+")");if(r._config.videoConstraints!==undefined){r.videoConstraints=r._config.videoConstraints;var a=R.default.CameraManager.legacyParamConverter(r._config.videoConstraints);R.default.CameraManager.get().setDefaultVideoSettings(a)}R.default.CameraManager.get().getInputDevices().then(function(e){return r.depLastDevices.vi=e});R.default.AudioDeviceManager.get().getInputDevices().then(function(e){return r.depLastDevices.ai=e});R.default.AudioDeviceManager.get().getOutputDevices().then(function(e){return r.depLastDevices.ao=e});if(window.location.hostname!="127.0.0.1"&&window.location.hostname!="localhost"&&window.location.protocol!="https:"){if(typeof console.error!="undefined"&&r.showWarnings)r.logger.warning("WARNING: getUserMedia() is deprecated on insecure origins, and support will be removed in the future. You should consider switching your application to a secure origin, such as HTTPS. See https://goo.gl/rStTGz for more details.")}if(r._config.experiments&&r._config.experiments.ignorewebrtc){r.RTCsupported=true}else{if(typeof webkitRTCPeerConnection!="undefined"||typeof mozRTCPeerConnection!="undefined"||typeof RTCPeerConnection!="undefined"||typeof RTCIceGatherer!="undefined"){if(typeof mozRTCPeerConnection!="undefined"){try{new mozRTCPeerConnection({iceServers:[]});r.RTCsupported=true}catch(e){}}else r.RTCsupported=true}}if(r.RTCsupported){var o;if(window.location.href.match(/^file\:\/{3}.*$/g)!=null){if(typeof console.error!="undefined"&&r.showWarnings)console.error("WebRTC requires application to be loaded from a web server")}r.voxAuth=p.Authenticator.get();r.voxAuth.setHandler({onLoginSuccessful:function e(t,n){r.loginState=2;var i={name:d.Events.AuthResult,displayName:t,result:true,tokens:n};r._resolvePromise("login",i);r.dispatchEvent(i)},onLoginFailed:function e(t){r.loginState=0;var n={name:d.Events.AuthResult,code:t,result:false};r._rejectPromise("login",n);r.dispatchEvent(n)},onSecondStageInitiated:function e(){var t={name:d.Events.AuthResult,code:301,result:false};r._rejectPromise("login",t);r.dispatchEvent(t)},onOneTimeKeyGenerated:function e(t){var n={name:d.Events.AuthResult,key:t,code:302,result:false};r._resolvePromise("loginkey",n);r.dispatchEvent(n)},onRefreshTokenFailed:function e(t){var n={name:d.Events.RefreshTokenResult,code:t,result:false};r.dispatchEvent(n)},onRefreshTokenSuccess:function e(t){var n={name:d.Events.RefreshTokenResult,tokens:t,result:true};r.dispatchEvent(n)}});r.voxSignaling.addHandler(r);o=setInterval(function(){if(typeof document!="undefined"){clearInterval(o);r.dispatchEvent({name:d.Events.SDKReady,version:r.version});e({name:d.Events.SDKReady,version:r.version})}},100)}else{i(new Error("NO_WEBRTC_SUPPORT"));throw new Error("NO_WEBRTC_SUPPORT")}g.VoxSignaling.get().setRPCHandler(S.RemoteEvent.sipRegisterSuccessful,function(e,t){r.dispatchEvent({name:"SIPRegistrationSuccessful",id:e,sipuri:t})});g.VoxSignaling.get().setRPCHandler(S.RemoteEvent.onACDStatus,function(e,t,n){if(r._config.experiments&&r._config.experiments.cleverACD){T.default.onStatusUpdated(t,n)}else{r.dispatchEvent({name:d.Events.ACDStatusUpdated,id:e,status:t})}});g.VoxSignaling.get().setRPCHandler(S.RemoteEvent.sipRegisterFailed,function(e,t,n,i){r.dispatchEvent({name:"SIPRegistrationFailed",id:e,sipuri:t,status:n,reason:i})})})}},{key:"call",value:function e(t,n,r,i){this.logger.info("call("+t+", "+JSON.stringify(n)+")");f.Utils.checkCA();var o={H264first:this._h264first,VP8first:this._VP8first};if(typeof t==="string"||typeof t==="number"){o={number:t,video:n,customData:r,extraHeaders:i}}else{o=t}switch(a(o.video)){case"boolean":o.video={sendVideo:o.video,receiveVideo:o.video};break;case"undefined":o.video={sendVideo:false,receiveVideo:true};break}var s=this.voxCallManager.call(o);return s}},{key:"callConference",value:function e(t,n,r,i){this.logger.info("callConference("+t+", "+JSON.stringify(n)+")");f.Utils.checkCA();var o={H264first:this._h264first,VP8first:this._VP8first};if(typeof t==="string"||typeof t==="number"){o={number:t,video:n,customData:r,extraHeaders:i}}else{o=t}switch(a(o.video)){case"boolean":o.video={sendVideo:o.video,receiveVideo:o.video};break;case"undefined":o.video={sendVideo:false,receiveVideo:true};break}o.isConference=true;var s=this.voxCallManager.callConference(o);return s}},{key:"config",value:function e(){return this._config}},{key:"connect",value:function e(t){var n=this;this.logger.info("connect("+t+")");if(typeof this._config==="undefined")this.logger.warning("Please, run VoxImplant init before connect.");if(typeof t==="undefined"&&this._config.micRequired===false)t=false;var r=null;return new Promise(function(e,i){var o=function i(a){if(!r)r=a;if(a.length===0){n.logger.info("We can't connect to the Voximplant cloud. Please, check UDP connection to Voximplant servers: "+r.join(", "))}var o=a.shift();n.logger.info("Trying "+o);n.connectTo(o,null,t).then(function(t){e(t)}).catch(function(){n.logger.info("Connection to the "+o+" falled");setTimeout(function(){return i(a)},0)})};if(n._config.serverIp&&a(n._config.serverIp)==="object"){o(n.serverIp)}else if(n._config.serverIp){o(n.serverIp.split(";"))}else{f.Utils.getServers().then(function(e){return setTimeout(function(){return o(e.split(";"))},0)}).catch(function(){return n.dispatchEvent({name:"ConnectionFailed",message:"VoxImplant Cloud is unavailable"})})}})}},{key:"connectTo",value:function e(t,n,r){var i=this;return new Promise(function(e,n){if(i._connected)n(new Error("ALREADY_CONNECTED_TO_VOXIMPLANT"));i._promises["connect"]={resolve:e,reject:n};i.host=t;i.voxSignaling.connectTo(t,true,true,r,i._callProtocolVersion)})}},{key:"disconnect",value:function e(){this.logger.info("disconnect()");this.checkConnection();this.voxSignaling.disconnect();R.default.StreamManager.get().clear();this.voxSignaling.removeRPCHandler(S.RemoteEvent.onCallRemoteFunctionError);this.voxSignaling.removeRPCHandler(S.RemoteEvent.handleError)}},{key:"setOperatorACDStatus",value:function e(t){var n=this;this.logger.info("setOperatorACDStatus("+t+")");if(this._config.experiments&&this._config.experiments.cleverACD){return T.default.setStatus(t)}else{return new Promise(function(e,r){f.Utils.checkCA();if(!Object.values(u.OperatorACDStatuses).includes(t)){r(new Error("Wrong ACD status name "+t))}n.voxSignaling.callRemoteFunction(_.RemoteFunction.setOperatorACDStatus,t,(new b.default).toString());e()})}}},{key:"getOperatorACDStatus",value:function e(){var t=this;if(this._config.experiments&&this._config.experiments.cleverACD){return T.default.getStatus()}else{return new Promise(function(e,n){f.Utils.checkCA();t.voxSignaling.callRemoteFunction(_.RemoteFunction.getOperatorACDStatus,(new b.default).toString());var r=function n(r){e(r.status);t.off(d.Events.ACDStatusUpdated,n)};setTimeout(function(){n();t.off(d.Events.ACDStatusUpdated,r)},5e3);t.on(d.Events.ACDStatusUpdated,r)})}}},{key:"login",value:function e(t,n,r){var i=this;this.logger.info("login("+t+", "+(n?"***":undefined)+", {receiveCalls: "+(r&&r.receiveCalls)+"})");this.loginState=1;return new Promise(function(e,a){i._promises["login"]={resolve:e,reject:a};r=typeof r!=="undefined"?r:{};i.checkConnection();if(i._config.experiments&&i._config.experiments.mediaServer){r.mediaServer=i._config.experiments.mediaServer}i.voxAuth.basicLogin(t,n,r)})}},{key:"loginWithCode",value:function e(t,n,r){var i=this;this.loginState=1;return new Promise(function(e,a){i._promises["login"]={resolve:e,reject:a};r=typeof r!=="undefined"?r:{};r=Object.assign({},r,{serverPresenceControl:false});i.checkConnection();i.voxAuth.loginStage2(t,n,r)})}},{key:"loginWithToken",value:function e(t,n,r){var i=this;this.logger.info("loginWithToken("+t+", '***', {receiveCalls: "+(r&&r.receiveCalls)+"})");this.loginState=1;return new Promise(function(e,a){i._promises["login"]={resolve:e,reject:a};r=typeof r!=="undefined"?r:{};r=Object.assign({},r,{serverPresenceControl:false});r.accessToken=n;i.checkConnection();i.voxAuth.tokenLogin(t,r)})}},{key:"tokenRefresh",value:function e(t,n,r){var i=this;this.logger.info("tokenRefresh("+t+")");return new Promise(function(e,a){var o=function t(n){if(n.result)e(n);else a(n);i.off(d.Events.RefreshTokenResult,t)};i.on(d.Events.RefreshTokenResult,o);i.voxAuth.tokenRefresh(t,n,r)})}},{key:"requestOneTimeLoginKey",value:function e(t){var n=this;return new Promise(function(e,r){n._promises["loginkey"]={resolve:e,reject:r};n.checkConnection();n.voxAuth.generateOneTimeKey(t)})}},{key:"loginWithOneTimeKey",value:function e(t,n,r){var i=this;this.logger.info("loginWithOneTimeKey("+t+", '***' , {receiveCalls: "+(r&&r.receiveCalls)+"})");this.loginState=1;return new Promise(function(e,a){i._promises["login"]={resolve:e,reject:a};r=typeof r!=="undefined"?r:{};r=Object.assign({},r,{serverPresenceControl:false});i.checkConnection();i.voxAuth.loginUsingOneTimeKey(t,n,r)})}},{key:"connected",value:function e(){return this._connected}},{key:"showLocalVideo",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;this.logger.info("showLocalVideo("+t+", "+n+", "+r+")");if(t)return R.default.StreamManager.get().showLocalVideo();else return R.default.StreamManager.get().hideLocalVideo()}},{key:"setLocalVideoPosition",value:function e(t,n){throw new Error("Deprecated: please use CSS to position '#voximplantlocalvideo' element")}},{key:"setLocalVideoSize",value:function e(t,n){throw new Error("Deprecated: please use CSS to set size of '#voximplantlocalvideo' element")}},{key:"setVideoSettings",value:function e(t,n,r){R.default.CameraManager.get().setDefaultVideoSettings(R.default.CameraManager.legacyParamConverter(t));y.CallManager.get().setVideoSettings(t).then(function(){if(n)n(null)},function(e){if(r)r(null)})}},{key:"setVideoBandwidth",value:function e(t){this.logger.info("setVideoBandwidth("+t+")");this.checkConnection();m.PCFactory.get().setBandwidthParams(t);this.voxSignaling.callRemoteFunction(_.RemoteFunction.setDesiredVideoBandwidth,t)}},{key:"playToneScript",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.logger.info("playToneScript('***', "+n+")");f.Utils.playToneScript(t,n)}},{key:"stopPlayback",value:function e(){this.logger.info("stopPlayback()");if(f.Utils.stopPlayback())this.dispatchEvent({name:d.Events.PlaybackFinished})}},{key:"volume",value:function e(t){if(typeof t!=="undefined"){if(t>100)t=100;if(t<0)t=0;y.CallManager.get().setAllCallsVolume(t);this.level=t}return this.level}},{key:"audioSources",value:function e(){return this.depLastDevices.ai}},{key:"videoSources",value:function e(){return this.depLastDevices.vi}},{key:"audioOutputs",value:function e(){return this.depLastDevices.ao}},{key:"useAudioSource",value:function e(t,n,r){var i=R.default.AudioDeviceManager.get().getDefaultAudioSettings();R.default.AudioDeviceManager.get().setDefaultAudioSettings(Object.assign({},i,{inputId:t}));return new Promise(function(e,i){return y.CallManager.get().useAudioSource(t).then(function(){if(n)n(null);e(null)},function(e){if(r)r(e);i(e)})})}},{key:"useVideoSource",value:function e(t,n,r){var i=R.default.CameraManager.get().getDefaultVideoSettings();R.default.CameraManager.get().setDefaultVideoSettings(Object.assign({},i,{cameraId:t}));return new Promise(function(e,i){return y.CallManager.get().useVideoSource(t).then(function(){if(n)n(null);e(null)},function(e){if(r)r(e);i(e)})})}},{key:"useAudioOutput",value:function e(t){var n=this;return new Promise(function(e,r){if(v.default.getWSVendor(true)!=="chrome")r(new Error("Unsupported browser. Only Google Chrome 49 and above."));n._defaultSinkId=t;e()})}},{key:"attachRecordingDevice",value:function e(t,n){h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"DEPRECATED",h.LogLevel.ERROR,"Now all media connection on demand. There is no reason do it by hand.");if(t)t(null);return}},{key:"detachRecordingDevice",value:function e(){R.default.StreamManager.get().clear()}},{key:"setCallActive",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return t.setActive(n)}},{key:"sendVideo",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"DEPRECATED",h.LogLevel.ERROR,"This function deprecated. Use Call.sendVideo() instead.")}},{key:"isRTCsupported",value:function e(){if(typeof webkitRTCPeerConnection!="undefined"||typeof mozRTCPeerConnection!="undefined"||typeof RTCPeerConnection!="undefined"||typeof RTCIceGatherer!="undefined"){if(typeof mozRTCPeerConnection!="undefined"){try{new mozRTCPeerConnection({iceServers:[]});return true}catch(e){return false}}else{return true}}}},{key:"transferCall",value:function e(t,n){this.logger.info("transferCall("+t+", "+t+")");f.Utils.checkCA();this.voxCallManager.transferCall(t,n)}},{key:"setLogLevel",value:function e(t,n){h.LogManager.get().setLogLevel(t,n)}},{key:"onSignalingConnected",value:function e(){this._connected=true;var t={name:d.Events.ConnectionEstablished};this._resolvePromise("connect",t);this.dispatchEvent(t)}},{key:"onSignalingClosed",value:function e(){this._connected=false;this.dispatchEvent({name:d.Events.ConnectionClosed});if(this.progressTone)this.stopProgressTone()}},{key:"onSignalingConnectionFailed",value:function e(t){this._connected=false;this._rejectPromise("connect",event)}},{key:"onMediaConnectionFailed",value:function e(){}},{key:"getCall",value:function e(t){return y.CallManager.get().calls[t]}},{key:"removeCall",value:function e(t){y.CallManager.get().removeCall(t)}},{key:"screenSharingSupported",value:function e(){return v.default.screenSharingSupported()}},{key:"addEventListener",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addEventListener",this).call(this,n,r)}},{key:"removeEventListener",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeEventListener",this).call(this,n,r)}},{key:"on",value:function e(n,r,a){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,n,r)}},{key:"off",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"off",this).call(this,n,r)}},{key:"getZingayaAPI",value:function e(){return new L.ZingayaAPI(this)}},{key:"registerForPushNotificatuons",value:function e(t){this.logger.info("Deprecated registerForPushNotificatuons()");return M.PushService.register(t)}},{key:"registerForPushNotifications",value:function e(t){this.logger.info("registerForPushNotifications()");return M.PushService.register(t)}},{key:"unregisterForPushNotificatuons",value:function e(t){this.logger.info("Deprecated unregisterForPushNotificatuons()");return M.PushService.unregister(t)}},{key:"unregisterForPushNotifications",value:function e(t){this.logger.info("unregisterForPushNotifications()");return M.PushService.unregister(t)}},{key:"handlePushNotification",value:function e(t){this.logger.info("handlePushNotification()");return M.PushService.incomingPush(t)}},{key:"getGUID",value:function e(){return(new b.default).toString()}},{key:"enableSilentLogging",value:function e(t){h.LogManager.get().shadowLogging=t}},{key:"clearSilentLog",value:function e(){h.LogManager.get().clearSilentLog()}},{key:"getSilentLog",value:function e(){return h.LogManager.get().getSLog()}},{key:"setLoggerCallback",value:function e(t){h.LogManager.get().setLoggerCallback(t)}},{key:"getClientState",value:function e(){var t=this.voxSignaling.currentState;if(t==g.VoxSignalingState.CONNECTING||t==g.VoxSignalingState.WSCONNECTED){return h.ClientState.CONNECTING}else if(t==g.VoxSignalingState.CLOSING||t==g.VoxSignalingState.IDLE)return h.ClientState.DISCONNECTED;else if(t==g.VoxSignalingState.CONNECTED){if(this.loginState==1){return h.ClientState.LOGGING_IN}else if(this.loginState==2){return h.ClientState.LOGGED_IN}return h.ClientState.CONNECTED}}},{key:"setSwfColor",value:function e(){h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"NOT SUPPORTED",h.LogLevel.ERROR,"setSwfColor deprecated, and not supported!")}},{key:"_traceName",value:function e(){return"Client"}},{key:"checkConnection",value:function e(){if(!this._connected)throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")}},{key:"_resolvePromise",value:function e(t,n){var r=this._promises[t];if(r){r.resolve(n);this._promises[t]=undefined}}},{key:"_rejectPromise",value:function e(t,n){var r=this._promises[t];if(r){r.reject(n);this._promises[t]=undefined}}},{key:"setLogLevelAll",value:function e(t){var n=h.LogManager.get();Object.keys(h.LogCategory).forEach(function(e){n.setLogLevel(h.LogCategory[e],t)})}},{key:"version",get:function e(){return"4.3.71854-1569232096"}},{key:"alreadyInitialized",get:function e(){return this._alreadyInitialized}}],[{key:"getInstance",value:function e(){if(typeof t.instance=="undefined")t.instance=new t;return t.instance}}]);return t}(C.EventTarget);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"playProgressTone",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"stopProgressTone",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"onIncomingCall",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"init",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"call",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"callConference",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"connect",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"connectTo",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"disconnect",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"setOperatorACDStatus",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"getOperatorACDStatus",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"login",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"loginWithCode",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"loginWithToken",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"tokenRefresh",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"requestOneTimeLoginKey",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"loginWithOneTimeKey",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"connected",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"showLocalVideo",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"setLocalVideoPosition",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"setLocalVideoSize",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"setVideoSettings",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"setVideoBandwidth",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"playToneScript",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"stopPlayback",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"volume",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"audioSources",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"videoSources",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"audioOutputs",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"useAudioSource",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"useVideoSource",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"useAudioOutput",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"attachRecordingDevice",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"detachRecordingDevice",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"setCallActive",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"sendVideo",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"isRTCsupported",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"transferCall",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"setLogLevel",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"onSignalingConnected",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"onSignalingClosed",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"onSignalingConnectionFailed",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"onMediaConnectionFailed",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"getCall",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"removeCall",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"addEventListener",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"removeEventListener",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"on",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"off",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"checkConnection",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],k.prototype,"setLogLevelAll",null);t.Client=k},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=n(7);var l=n(8);var u=n(6);var d=n(3);var f=n(13);var g=n(18);var p=n(1);var v;(function(e){e[e["IDLE"]=0]="IDLE";e[e["CONNECTING"]=1]="CONNECTING";e[e["WSCONNECTED"]=2]="WSCONNECTED";e[e["CONNECTED"]=3]="CONNECTED";e[e["CLOSING"]=4]="CLOSING"})(v=t.VoxSignalingState||(t.VoxSignalingState={}));var h=function(){function e(){var t=this;a(this,e);this.ver="3";this.handlers=[];this.rpcHandlers={};this.pingTimer=null;this.pongTimer=null;this.manualDisconnect=false;this.platform="platform";this.referrer="platform";this.extra="";this.closing=false;this.writeLog=false;this._opLog=[];this.token="";this.logger=s.LogManager.get().createLogger(s.LogCategory.SIGNALING,this._traceName());this.currentState=v.IDLE;this.setRPCHandler(f.RemoteEvent.connectionSuccessful,function(e){t.onConnectionSuccessfulRPC(e)});this.setRPCHandler(f.RemoteEvent.connectionFailed,function(){t.onConnectionFailedRPC()});this.setRPCHandler(f.RemoteEvent.createConnection,function(e){t.onConnectionSuccessfulRPC(e)})}r(e,[{key:"addHandler",value:function e(t){this.handlers.push(t)}},{key:"close",value:function e(){this.closing=true;if(this.ws){this.ws.onclose=null;this.ws.close();this.onWSClosed(null)}else{this.logger.warning("Try close unused WS in state "+v[this.currentState])}}},{key:"cleanup",value:function e(){l.PCFactory.get().closeAll();if(this.pingTimer)clearTimeout(this.pingTimer);if(this.pongTimer)clearTimeout(this.pongTimer)}},{key:"onConnectionSuccessfulRPC",value:function e(t){if(this.currentState!=v.WSCONNECTED){this.logger.error("Can't handle __connectionSuccessful while in state "+v[this.currentState]);return}if(t)this.token=t;this.currentState=v.CONNECTED;if(this.handlers.length>0){for(var n=0;n<this.handlers.length;++n){try{this.handlers[n].onSignalingConnected()}catch(e){this.logger.warning("Error in onSignalingConnected callback: "+e)}}}else{this.logger.warning("No VoxSignaling handler specified")}}},{key:"onConnectionFailedRPC",value:function e(){if(this.currentState!=v.WSCONNECTED){this.logger.error("Can't handle __connectionSuccessful while in state "+v[this.currentState]);return}this.ws.onerror=null;this.ws.close();this.ws=null;this.currentState=v.IDLE;p.Client.getInstance().loginState=0;if(this.handlers.length>0){for(var t=0;t<this.handlers.length;++t){try{this.handlers[t].onMediaConnectionFailed()}catch(e){this.logger.warning("Error in onMediaConnectionFailed callback: "+e)}}}else{this.logger.warning("No VoxSignaling handler specified")}}},{key:"connectTo",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var i=this;var a=arguments[3];var o=arguments[4];this.manualDisconnect=false;this.ver=o;if(this.currentState!=v.IDLE){this.logger.error("Can't establish connection while in state "+v[this.currentState]);return}this.currentState=v.CONNECTING;var s=c.default.getWSVendor();this.ws=new WebSocket("ws"+(r?"s":"")+"://"+t+"/"+this.platform+"?version="+this.ver+"&client="+s+"&ccheck="+(typeof a==="undefined"?true:a)+"&referrer=&extra="+this.extra+"&video="+(n?"true":"false")+"&client_version="+p.Client.getInstance().version+"&client_platform="+s+"&im_version=2");this.ws.onopen=function(e){return i.onWSConnected()};this.ws.onclose=function(e){return i.onWSClosed(e)};this.ws.onerror=function(e){return i.onWSError()};this.ws.onmessage=function(e){return i.onWSData(e.data)}}},{key:"setRPCHandler",value:function e(t,n){if(typeof this.rpcHandlers[t]!="undefined"){this.logger.warning("Overwriting RPC handler for function "+t)}this.rpcHandlers[t]=n}},{key:"removeRPCHandler",value:function e(t){if(typeof this.rpcHandlers[t]=="undefined"&&!this.closing){this.logger.warning("There is no RPC handler for function "+t)}delete this.rpcHandlers[t]}},{key:"callRemoteFunction",value:function e(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++){r[i-1]=arguments[i]}if(t!==d.RemoteFunction.ping)this.logger.trace("callRemoteFunction("+t+")");if(this.currentState!=v.CONNECTED&&this.currentState!=v.WSCONNECTED){if(!this.closing)this.logger.error("Can't make a RPC call in state "+v[this.currentState]);return false}if(typeof this.ws!="undefined"){if(this.writeLog)this._opLog.push("send:"+JSON.stringify({name:t,params:r}));var a=JSON.stringify({name:t,params:r});this.ws.send(a);return true}}},{key:"onWSData",value:function e(t){if(this.writeLog)this._opLog.push("recv:"+t);var n=void 0;try{n=JSON.parse(t)}catch(e){this.logger.error("Can't parse JSON data: "+t);return}if(typeof n["service"]!="undefined")this.onWSMessData(n);else this.onWSVoipData(n)}},{key:"onWSMessData",value:function e(t){g.MsgSignaling.get().handleWsData(t)}},{key:"onWSVoipData",value:function e(t){var n=t["name"];var r=t["params"];if(typeof this.rpcHandlers[n]!="undefined"){try{this.rpcHandlers[n].apply(null,r)}catch(e){this.logger.warning("Error in '"+n+"' handler : "+e)}}else{this.logger.warning("No handler for "+n)}}},{key:"disconnect",value:function e(){this.closing=true;this.manualDisconnect=true;this.onWSClosed(null);this.cleanup()}},{key:"onWSClosed",value:function e(t){if(this.currentState!=v.CONNECTED&&this.currentState!=v.CONNECTING&&this.currentState!=v.CLOSING){if(!this.closing)this.logger.warning("onWSClosed in state "+v[this.currentState]);else return}if(this.ws){this.ws.close();this.ws=undefined}var n=this.currentState;if(this.pingTimer){clearTimeout(this.pingTimer)}if(this.pongTimer){clearTimeout(this.pongTimer)}this.cleanup();this.currentState=v.IDLE;p.Client.getInstance().loginState=0;if(this.handlers.length>0){for(var r=0;r<this.handlers.length;++r){if((n==v.CONNECTING||n==v.WSCONNECTED||n==v.IDLE)&&!this.manualDisconnect){try{this.handlers[r].onSignalingConnectionFailed(t.reason)}catch(t){this.logger.warning("Error in onSignalingConnectionFailed callback: "+t)}}else{try{this.handlers[r].onSignalingClosed()}catch(t){this.logger.warning("Error in onSignalingClosed callback: "+t)}}}}else{this.logger.warning("No VoxSignaling handler specified")}}},{key:"onWSConnected",value:function t(){var n=this;this.closing=false;if(this.currentState!=v.CONNECTING){this.logger.warning("onWSConnected in state "+v[this.currentState])}this.currentState=v.WSCONNECTED;this.pingTimer=window.setTimeout(function(){return n.doPing()},e.PING_DELAY);this.setRPCHandler(f.RemoteEvent.pong,function(){return n.pongReceived()});this.setRPCHandler(f.RemoteEvent.increaseGain,function(){n.logger.info("Deprecated increaseGain")})}},{key:"onWSError",value:function e(){if(this.currentState!=v.CONNECTING){this.logger.warning("onWSError in state "+this.currentState)}this.ws.close();this.ws=undefined;if(this.pingTimer){clearTimeout(this.pingTimer)}if(this.pongTimer){clearTimeout(this.pongTimer)}this.cleanup();this.currentState=v.IDLE;p.Client.getInstance().loginState=0;if(typeof this.handlers!="undefined"){for(var t=0;t<this.handlers.length;++t){try{this.handlers[t].onSignalingConnectionFailed("Error connecting to VoxImplant server")}catch(e){this.logger.warning("Error in onSignalingConnectionFailed callback: "+e)}}}else{this.logger.warning("No VoxSignaling handler specified")}}},{key:"doPing",value:function t(){var n=this;this.pingTimer=null;this.callRemoteFunction(d.RemoteFunction.ping,[]);this.pongTimer=window.setTimeout(function(){if(u.CallManager.get().numCalls>0){n.pongReceived();return}n.pongTimer=null;for(var e=0;e<n.handlers.length;++e){if(n.currentState==v.CONNECTED){try{n.handlers[e].onSignalingClosed()}catch(e){n.logger.warning("Error in onSignalingClosed callback: "+e)}}else{try{n.handlers[e].onSignalingConnectionFailed("Connection closed")}catch(e){n.logger.warning("Error in onSignalingConnectionFailed callback: "+e)}}}n.ws.close();n.currentState=v.IDLE;p.Client.getInstance().loginState=0},e.PONG_DELAY)}},{key:"pongReceived",value:function t(){var n=this;if(this.pongTimer){clearTimeout(this.pongTimer);this.pongTimer=null;this.pingTimer=window.setTimeout(function(){return n.doPing()},e.PING_DELAY)}}},{key:"sendRaw",value:function e(t){if(this.writeLog)this._opLog.push("send:"+JSON.stringify(t));var n=JSON.stringify(t);this.ws.send(n);s.LogManager.get().writeMessage(s.LogCategory.SIGNALING,"[wsdataout]",s.LogLevel.INFO,n);return true}},{key:"getLog",value:function e(){return this._opLog}},{key:"lagacyConnectTo",value:function e(t,n,r,i){this.ver="2";this.platform=i;this.referrer=n;this.connectTo(t,false,true,true,"2")}},{key:"_traceName",value:function e(){return"VoxSignaling"}}],[{key:"get",value:function t(){if(typeof this.inst=="undefined"){this.inst=new e}return this.inst}}]);return e}();h.PING_DELAY=1e4;h.PONG_DELAY=1e4;o([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"addHandler",null);o([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"close",null);o([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"cleanup",null);o([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"onConnectionSuccessfulRPC",null);o([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"onConnectionFailedRPC",null);o([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"connectTo",null);o([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"setRPCHandler",null);o([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"removeRPCHandler",null);o([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"disconnect",null);o([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"onWSClosed",null);o([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"onWSConnected",null);o([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"onWSError",null);o([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"sendRaw",null);t.VoxSignaling=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e[e["ping"]="__ping"]="ping";e[e["login"]="login"]="login";e[e["loginGenerateOneTimeKey"]="loginGenerateOneTimeKey"]="loginGenerateOneTimeKey";e[e["loginStage2"]="loginStage2"]="loginStage2";e[e["setOperatorACDStatus"]="setOperatorACDStatus"]="setOperatorACDStatus";e[e["getOperatorACDStatus"]="getOperatorACDStatus"]="getOperatorACDStatus";e[e["setDesiredVideoBandwidth"]="setDesiredVideoBandwidth"]="setDesiredVideoBandwidth";e[e["rejectCall"]="rejectCall"]="rejectCall";e[e["disconnectCall"]="disconnectCall"]="disconnectCall";e[e["sendDTMF"]="sendDTMF"]="sendDTMF";e[e["sendSIPInfo"]="sendSIPInfo"]="sendSIPInfo";e[e["hold"]="hold"]="hold";e[e["unhold"]="unhold"]="unhold";e[e["acceptCall"]="acceptCall"]="acceptCall";e[e["createCall"]="createCall"]="createCall";e[e["callConference"]="callConference"]="callConference";e[e["transferCall"]="transferCall"]="transferCall";e[e["muteLocal"]="__muteLocal"]="muteLocal";e[e["reInvite"]="ReInvite"]="reInvite";e[e["acceptReInvite"]="AcceptReInvite"]="acceptReInvite";e[e["rejectReInvite"]="RejectReInvite"]="rejectReInvite";e[e["confirmPC"]="__confirmPC"]="confirmPC";e[e["addCandidate"]="__addCandidate"]="addCandidate";e[e["loginUsingOneTimeKey"]="loginUsingOneTimeKey"]="loginUsingOneTimeKey";e[e["refreshOauthToken"]="refreshOauthToken"]="refreshOauthToken";e[e["zPromptFinished"]="promptFinished"]="zPromptFinished";e[e["zStartPreFlightCheck"]="__startPreFlightCheck"]="zStartPreFlightCheck";e[e["registerPushToken"]="registerPushToken"]="registerPushToken";e[e["unregisterPushToken"]="unregisterPushToken"]="unregisterPushToken";e[e["pushFeedback"]="pushFeedback"]="pushFeedback";e[e["refreshIceConfig"]="refreshIceConfig"]="refreshIceConfig"})(r=t.RemoteFunction||(t.RemoteFunction={}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function a(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}Object.defineProperty(t,"__esModule",{value:true});var o=n(50);var s;(function(e){var t=void 0;(function(e){e[e["DevicesUpdated"]="DevicesUpdated"]="DevicesUpdated";e[e["MediaRendererAdded"]="MediaRendererAdded"]="MediaRendererAdded";e[e["MediaRendererRemoved"]="MediaRendererRemoved"]="MediaRendererRemoved";e[e["BeforeMediaRendererRemoved"]="BeforeMediaRendererRemoved"]="BeforeMediaRendererRemoved"})(t=e.HardwareEvents||(e.HardwareEvents={}));var n=void 0;(function(e){e[e["VIDEO_QUALITY_HIGH"]="video_quality_high"]="VIDEO_QUALITY_HIGH";e[e["VIDEO_QUALITY_LOW"]="video_quality_low"]="VIDEO_QUALITY_LOW";e[e["VIDEO_QUALITY_MEDIUM"]="video_quality_medium"]="VIDEO_QUALITY_MEDIUM";e[e["VIDEO_SIZE_QQVGA"]="video_size_qqvga"]="VIDEO_SIZE_QQVGA";e[e["VIDEO_SIZE_QCIF"]="video_size_qcif"]="VIDEO_SIZE_QCIF";e[e["VIDEO_SIZE_QVGA"]="video_size_qvga"]="VIDEO_SIZE_QVGA";e[e["VIDEO_SIZE_CIF"]="video_size_cif"]="VIDEO_SIZE_CIF";e[e["VIDEO_SIZE_nHD"]="video_size_nhd"]="VIDEO_SIZE_nHD";e[e["VIDEO_SIZE_VGA"]="video_size_vga"]="VIDEO_SIZE_VGA";e[e["VIDEO_SIZE_SVGA"]="video_size_svga"]="VIDEO_SIZE_SVGA";e[e["VIDEO_SIZE_HD"]="video_size_hd"]="VIDEO_SIZE_HD";e[e["VIDEO_SIZE_UXGA"]="video_size_uxga"]="VIDEO_SIZE_UXGA";e[e["VIDEO_SIZE_FHD"]="video_size_fhd"]="VIDEO_SIZE_FHD";e[e["VIDEO_SIZE_UHD"]="video_size_uhd"]="VIDEO_SIZE_UHD"})(n=e.VideoQuality||(e.VideoQuality={}));var s=function(e){a(t,e);function t(){r(this,t);return i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return t}(o.AudioDeviceManager);e.AudioDeviceManager=s;var c=function(e){a(t,e);function t(){r(this,t);return i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return t}(o.CameraManager);e.CameraManager=c;var l=function(e){a(t,e);function t(){r(this,t);return i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return t}(o.StreamManager);e.StreamManager=l;var u=function(e){a(t,e);function t(){r(this,t);return i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return t}(o.IOSCacheManager);e.IOSCacheManager=u})(s=t.Hardware||(t.Hardware={}));t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e[e["Connected"]="Connected"]="Connected";e[e["Disconnected"]="Disconnected"]="Disconnected";e[e["Failed"]="Failed"]="Failed";e[e["ProgressToneStart"]="ProgressToneStart"]="ProgressToneStart";e[e["ProgressToneStop"]="ProgressToneStop"]="ProgressToneStop";e[e["MessageReceived"]="onSendMessage"]="MessageReceived";e[e["InfoReceived"]="InfoReceived"]="InfoReceived";e[e["TransferComplete"]="TransferComplete"]="TransferComplete";e[e["TransferFailed"]="TransferFailed"]="TransferFailed";e[e["ICETimeout"]="ICETimeout"]="ICETimeout";e[e["RTCStatsReceived"]="RTCStatsReceived"]="RTCStatsReceived";e[e["CallStatsReceived"]="CallStatsReceived"]="CallStatsReceived";e[e["MediaElementCreated"]="MediaElementCreated"]="MediaElementCreated";e[e["MediaElementRemoved"]="MediaElementRemoved"]="MediaElementRemoved";e[e["ICECompleted"]="ICECompleted"]="ICECompleted";e[e["Updated"]="Updated"]="Updated";e[e["PendingUpdate"]="PendingUpdate"]="PendingUpdate";e[e["UpdateFailed"]="UpdateFailed"]="UpdateFailed";e[e["LocalVideoStreamAdded"]="LocalVideoStreamAdded"]="LocalVideoStreamAdded";e[e["EndpointAdded"]="EndpointAdded"]="EndpointAdded";e[e["StateUpdated"]="StateUpdated"]="StateUpdated";e[e["ActiveUpdated"]="ActiveUpdated"]="ActiveUpdated";e[e["QualityIssueCodecMismatch"]="QualityIssueCodecMismatch"]="QualityIssueCodecMismatch";e[e["QualityIssueHighMediaLatency"]="QualityIssueHighMediaLatency"]="QualityIssueHighMediaLatency";e[e["QualityIssueICEDisconnected"]="QualityIssueICEDisconnected"]="QualityIssueICEDisconnected";e[e["QualityIssueLocalVideoDegradation"]="QualityIssueLocalVideoDegradation"]="QualityIssueLocalVideoDegradation";e[e["QualityIssueLowBandwidth"]="QualityIssueLowBandwidth"]="QualityIssueLowBandwidth";e[e["QualityIssueNoAudioSignal"]="QualityIssueNoAudioSignal"]="QualityIssueNoAudioSignal";e[e["QualityIssuePacketLoss"]="QualityIssuePacketLoss"]="QualityIssuePacketLoss"})(r=t.CallEvents||(t.CallEvents={}))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(12);var c=n(5);var l=n(2);var u=n(20);var d=n(11);var f=n(10);var g=n(0);var p=n(8);var v=n(1);var h=n(22);var m=n(54);var y=n(3);var C=n(13);var _=n(55);var S=n(17);var E=n(56);var L=n(16);var M=n(23);var b=n(4);var R=n(57);var T=function(){function e(){var t=this;a(this,e);this.protocolVersion="3";this._h264first=false;this.iceServers={};this._calls={};this.callStats=R.CallStatsManager.get();this.voxSignaling=l.VoxSignaling.get();this.logger=g.LogManager.get().createLogger(g.LogCategory.SIGNALING,this._traceName());this.voxSignaling.addHandler(this);this.voxSignaling.setRPCHandler(C.RemoteEvent.handleIncomingConnection,function(e,n,r,i,a){t.handleIncomingConnection(e,n,r,i,a)});this.voxSignaling.setRPCHandler(C.RemoteEvent.onICEConfig,function(e,n){t.onICEResult(e,true,n)});this.voxSignaling.setRPCHandler(C.RemoteEvent.onICEConfigFailed,function(e){t.onICEResult(e,false)});this.voxSignaling.setRPCHandler(C.RemoteEvent.handleConnectionConnected,function(e,n,r,i){t.handleConnectionConnected(e,n,r)});this.voxSignaling.setRPCHandler(C.RemoteEvent.handleConnectionDisconnected,function(e,n,r){t.handleConnectionDisconnected(e,n,r)});this.voxSignaling.setRPCHandler(C.RemoteEvent.handleRingOut,function(e){t.handleRingOut(e)});this.voxSignaling.setRPCHandler(C.RemoteEvent.stopRinging,function(e){t.stopRinging(e)});this.voxSignaling.setRPCHandler(C.RemoteEvent.handleConnectionFailed,function(e,n,r,i){t.handleConnectionFailed(e,n,r,i)});this.voxSignaling.setRPCHandler(C.RemoteEvent.handleSIPInfo,function(e,n,r,i,a){t.handleSIPInfo(e,n,r,i,a)});this.voxSignaling.setRPCHandler(C.RemoteEvent.handleSipEvent,function(e){t.handleSipEvent(e)});this.voxSignaling.setRPCHandler(C.RemoteEvent.handleTransferStarted,function(e){t.handleTransferStarted(e)});this.voxSignaling.setRPCHandler(C.RemoteEvent.handleTransferComplete,function(e){t.handleTransferComplete(e)});this.voxSignaling.setRPCHandler(C.RemoteEvent.handleTransferFailed,function(e){t.handleTransferFailed(e)});this.voxSignaling.setRPCHandler(C.RemoteEvent.handleReInvite,function(e,n,r,i){var a=JSON.parse(i);t.handleInReinvite(e,n,r,a)});this.voxSignaling.setRPCHandler(C.RemoteEvent.handleAcceptReinvite,function(e,n,r){t.handleReinvite(e,n,r)});this.voxSignaling.setRPCHandler(C.RemoteEvent.handleRejectReinvite,function(e,n,r){t.handleRejectReinvite(e,n,r)});this.voxSignaling.setRPCHandler(C.RemoteEvent.startEarlyMedia,function(e,n,r){t.startEarlyMedia(e,n,r)})}r(e,[{key:"call",value:function t(n){var r=this;var i={number:null,video:{sendVideo:false,receiveVideo:false},customData:null,extraHeaders:{},wiredLocal:true,wiredRemote:true,H264first:this._h264first,VP8first:false,forceActive:false,extraParams:{}};var a=u.Utils.mixObjectToLeft(i,n);a=e.addCustomDataToHeaders(a);var o=u.Utils.generateUUID();if(this._calls[o]){this.logger.error("Call "+o+" already exists");throw new Error("Internal error")}var t=this.getCallInstance(o,d.Authenticator.get().displayName,false,a);if(S.CallstatsIo.isModuleEnabled()){a.extraHeaders[f.Constants.CALLSTATSIOID_HEADER]=o}if(a.VP8first)t.rearangeCodecs=E.CodecSorterHelpers.VP8Sorter;if(a.H264first)t.rearangeCodecs=E.CodecSorterHelpers.H264Sorter;var s=false;t.settings.active=true;if(Object.keys(this._calls).length>1&&!a.forceActive){t.setActiveForce(false);s=true}if(typeof a.extraHeaders[f.Constants.DIRECT_CALL_HEADER]==="undefined"&&this.protocolVersion=="2"){this.voxSignaling.callRemoteFunction(y.RemoteFunction.createCall,-1,a.number,a.video,o,null,null,a.extraHeaders,a.extraParams)}else{p.PCFactory.get().setupDirectPC(o,h.PeerConnectionMode.P2P,n.video,s).then(function(e){t.peerConnection=p.PCFactory.get().peerConnections[o];var n={tracks:t.peerConnection.getTrackKind()};r.voxSignaling.callRemoteFunction(y.RemoteFunction.createCall,-1,a.number,true,o,null,null,a.extraHeaders,"",e.sdp,n)}).catch(function(e){r.handleConnectionFailed(t.id(),403,"Media access denied",{})})}t.sendVideo(a.video.sendVideo);return t}},{key:"callConference",value:function t(n){var r=this;var i={number:null,video:{sendVideo:false,receiveVideo:false},customData:null,extraHeaders:{},wiredLocal:true,wiredRemote:true,H264first:this._h264first,VP8first:false,forceActive:false,extraParams:{}};var a=u.Utils.mixObjectToLeft(i,n);a=e.addCustomDataToHeaders(a);var o=u.Utils.generateUUID();if(this._calls[o]){this.logger.error("Call "+o+" already exists");throw new Error("Internal error")}var s=this.getCallInstance(o,d.Authenticator.get().displayName,false,a);if(S.CallstatsIo.isModuleEnabled()){a.extraHeaders[f.Constants.CALLSTATSIOID_HEADER]=o}if(a.VP8first)s.rearangeCodecs=E.CodecSorterHelpers.VP8Sorter;if(a.H264first)s.rearangeCodecs=E.CodecSorterHelpers.H264Sorter;var c=false;s.settings.active=true;s.settings.isConference=true;if(Object.keys(this._calls).length>1&&!a.forceActive){s.setActiveForce(false);c=true}p.PCFactory.get().setupDirectPC(o,h.PeerConnectionMode.CONFERENCE,n.video,c).then(function(e){s.peerConnection=p.PCFactory.get().peerConnections[o];var t={tracks:s.peerConnection.getTrackKind()};r.voxSignaling.callRemoteFunction(y.RemoteFunction.callConference,-1,a.number,true,o,null,null,a.extraHeaders,"",e.sdp,t)}).catch(function(e){r.handleConnectionFailed(s.id(),403,"Media access denied",{})});s.sendVideo(a.video.sendVideo);return s}},{key:"isSDPHasVideo",value:function e(t){var n=t.indexOf("m=video");if(n===-1)return false;var r=t.indexOf("a=sendrecv",n);var i=t.indexOf("a=sendonly",n);var a=t.indexOf("m=",n);if(r!==-1&&(r<a||a===-1)||i!==-1&&(i<a||a===-1))return true;return false}},{key:"handleConnectionFailed",value:function e(t,n,r,i){var a=this.findCall(t,"handleConnectionFailed");if(typeof a=="undefined")return;this.removeCall(t);v.Client.getInstance().stopProgressTone();a.onFailed(n,r,i)}},{key:"onSignalingConnected",value:function e(){}},{key:"onSignalingClosed",value:function e(){for(var t in this._calls){if(this._calls.hasOwnProperty(t)){this._calls[t].hangup();this._calls[t].onFailed(409,"Connection Closed",{})}}}},{key:"onSignalingConnectionFailed",value:function e(t){}},{key:"onMediaConnectionFailed",value:function e(){}},{key:"transferCall",value:function e(t,n){var r=[t,n];for(var i=0;i<r.length;i++){var a=this._calls[r[i].id()];if(a){if(a.stateValue!=s.CallState.CONNECTED){this.logger.error("trying to transfer call "+a.id()+" in state "+a.state());return}}else{this.logger.error("trying to transfer unknown call "+a.id());return}}this.voxSignaling.callRemoteFunction(y.RemoteFunction.transferCall,t.id(),n.id())}},{key:"removeCall",value:function e(t){this.callStats.deleteCall(this._calls[t]);delete this._calls[t]}},{key:"setProtocolVersion",value:function e(t){this.protocolVersion=t}},{key:"setAllCallsVolume",value:function e(t){for(var n in this._calls){if(this._calls.hasOwnProperty(n)){M.EndpointManager.get().setCallVolume(this._calls[n],t)}}}},{key:"useVideoSource",value:function e(t){var n=this;var r=Object.keys(this._calls).length;return new Promise(function(e,i){for(var a in n._calls){if(n._calls.hasOwnProperty(a)){var o=n._calls[a];b.default.CameraManager.get().setCallVideoSettings(o,Object.assign({},b.default.CameraManager.get().getCallVideoSettings(o),{cameraId:t}));b.default.StreamManager.get().updateCallStream(o).then(function(t){r--;if(r<=0)e()},function(e){i(e)})}}})}},{key:"setVideoSettings",value:function e(t){var n=this;var r=Object.keys(this._calls).length;return new Promise(function(e,i){if(r===0){e()}for(var a in n._calls){if(n._calls.hasOwnProperty(a)){var o=n._calls[a];b.default.CameraManager.get().setCallVideoSettings(o,b.default.CameraManager.legacyParamConverter(t)).then(function(t){r--;if(r<=0)e()},function(e){i(e)})}}})}},{key:"useAudioSource",value:function e(t){var n=this;var r=Object.keys(this._calls).length;return new Promise(function(e,i){if(r===0)e();for(var a in n._calls){if(n._calls.hasOwnProperty(a)){var o=n._calls[a];b.default.AudioDeviceManager.get().setCallAudioSettings(o,Object.assign({},b.default.AudioDeviceManager.get().getCallAudioSettings(o),{inputId:t})).then(function(t){r--;if(r<=0)e()},function(e){i(e)})}}})}},{key:"handleIncomingConnection",value:function e(t,n,r,i,a){if(this._calls[t]){this.logger.error("Call "+t+" already exists");throw new Error("Internal error")}var o=L.SDPMuggle.detectDirections(a);var s=o.some(function(e){return e.type==="video"&&(e.direction==="sendonly"||e.direction==="sendrecv")});var c={number:n,extraHeaders:i,video:s,wiredLocal:true,wiredRemote:true,forceActive:false};var l=this.getCallInstance(t,r,true,c);if(this._h264first)l.rearangeCodecs=E.CodecSorterHelpers.H264Sorter;var u=false;l.settings.active=true;if(Object.keys(this._calls).length>1){l.setActiveForce(false);u=true}v.Client.getInstance().onIncomingCall(t,n,r,i,this.isSDPHasVideo(a));if(typeof c.extraHeaders[f.Constants.DIRECT_CALL_HEADER]==="undefined"&&this.protocolVersion=="2"){l.peerConnection=p.PCFactory.get().getPeerConnect(t)}else{var d=[];if(a.indexOf("VIMS")===-1){d=this.iceServers[t]}p.PCFactory.get().incomeDirectPC(t,{receiveVideo:true,sendVideo:true},a,u,d).then(function(e){l.peerConnection=e})}}},{key:"getCallInstance",value:function e(t,n,r,i){var a=void 0;if(this.protocolVersion=="3"){a=new _.CallExMedia(t,n,r,i)}else if(typeof i.extraHeaders[f.Constants.DIRECT_CALL_HEADER]!="undefined")a=new _.CallExMedia(t,n,r,i);else a=new m.CallExServer(t,n,r,i);this._calls[t]=a;this.callStats.addCall(a);M.EndpointManager.get().registerCall(a);return a}},{key:"findCall",value:function e(t,n){var r=this._calls[t];if(t==="")r=this._calls[Object.keys(this._calls)[0]];if(typeof r=="undefined"){if(n!=="onICEResult")this.logger.warning("Received "+n+" for unknown call "+t);return null}return r}},{key:"handleRingOut",value:function e(t){var n=this.findCall(t,"handleRingOut");if(typeof n=="undefined")return;v.Client.getInstance().playProgressTone(true);n.onRingOut();n.canStartSendingCandidates()}},{key:"handleConnectionConnected",value:function e(t,n,r){this.logger.info("handleConnectionConnected(), received SDP: \n"+r);var i=this.findCall(t,"handleConnectionConnected");i.signalingConnected=true;i.canStartSendingCandidates();if(typeof i=="undefined"){return}i.onConnected(n,r);if(typeof r!="undefined"&&r.length>0){var a=r.indexOf("m=video");if(a!==-1){var o=r.indexOf("a=sendrecv",a);var s=r.indexOf("a=sendonly",a);var c=r.indexOf("a=recvonly",a);var l=r.indexOf("a=inactive",a);if(o===-1&&s===-1&&c===-1&&l===-1)r+="a=inactive\r\n"}i.peerConnection.processRemoteAnswer(n,r)}}},{key:"onICEResult",value:function e(t,n,r){if(n){this.iceServers[t]=r;var i=this.findCall(t,"onICEResult");if(i){i.peerConnection.setConfiguration(Object.assign({},i.peerConnection.getConfiguration(),{iceServers:r}))}}}},{key:"startEarlyMedia",value:function e(t,n,r){this.logger.info("startEarlyMedia(), received SDP: \n"+r);var i=this.findCall(t,"startEarlyMedia");i.settings.hasEarlyMedia=true;if(typeof r!="undefined"){i.peerConnection.processRemoteAnswer(n,r)}v.Client.getInstance().stopProgressTone()}},{key:"handleConnectionDisconnected",value:function e(t,n,r){var i=this;var a=this.findCall(t,"handleConnectionDisconnected");if(!a)return;v.Client.getInstance().stopProgressTone();a.onDisconnected(n,r).then(function(){return i.removeCall(t)}).catch(function(e){i.logger.error("Can't remove the call "+t+": "+e.message)})}},{key:"handleSIPInfo",value:function e(t,n,r,i,a){var o=this.findCall(t,"handleSIPInfo");if(typeof o=="undefined")return;o.onInfo(o,n,r,i,a)}},{key:"stopRinging",value:function e(t){var n=this.findCall(t,"stopRinging");n.canStartSendingCandidates();if(typeof n=="undefined")return;v.Client.getInstance().stopProgressTone();n.onStopRinging()}},{key:"handleSipEvent",value:function e(t){}},{key:"handleTransferStarted",value:function e(t){}},{key:"handleTransferComplete",value:function e(t){var n=this.findCall(t,"handleTransferComplete");if(typeof n=="undefined")return;n.onTransferComplete()}},{key:"handleTransferFailed",value:function e(t){var n=this.findCall(t,"handleTransferFailed");if(typeof n=="undefined")return;n.onTransferFailed()}},{key:"handleReinvite",value:function e(t,n,r){var i=this.findCall(t,"handleReinvite");if(typeof i=="undefined")return;var a=this.isSDPHasVideo(r);i.peerConnection.handleReinvite(n,r,a)}},{key:"handleRejectReinvite",value:function e(t,n,r){var i=this.findCall(t,"handleReinvite");if(typeof i=="undefined")return;i.dispatchEvent({code:20,call:i})}},{key:"handleInReinvite",value:function e(t,n,r,i){var a=this.findCall(t,"handleReinvite");if(typeof a=="undefined")return;M.EndpointManager.get().setEndpointDescription(a,i);this.logger.info("handleInReinvite(), received SDP: \n"+r);a.runIncomingReInvite(n,r);a.dispatchEvent({name:c.CallEvents.PendingUpdate,result:true,call:a})}},{key:"recalculateNumCalls",value:function e(){this._numCalls=0;for(var t in this._calls){if(this._calls.hasOwnProperty(t)){this._numCalls++}}}},{key:"_traceName",value:function e(){return"CallManager"}},{key:"calls",get:function e(){return this._calls}},{key:"numCalls",get:function e(){return this._numCalls}}],[{key:"get",value:function t(){if(typeof this.inst=="undefined"){this.inst=new e}return this.inst}},{key:"cleanHeaders",value:function e(t){var n={};for(var r in t){if(r.substring(0,2)=="X-"||r==f.Constants.CALL_DATA_HEADER){n[r]=t[r]}}return n}},{key:"addCustomDataToHeaders",value:function e(t){if(typeof t.customData!="undefined"){if(typeof t.extraHeaders=="undefined")t.extraHeaders={};t.extraHeaders["VI-CallData"]=t.customData}return t}}]);return e}();o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"call",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"handleConnectionFailed",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"onSignalingConnected",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"onSignalingClosed",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"onSignalingConnectionFailed",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"removeCall",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"setAllCallsVolume",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"useVideoSource",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"setVideoSettings",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"useAudioSource",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"handleIncomingConnection",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"findCall",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"handleRingOut",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"handleConnectionConnected",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"onICEResult",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"handleConnectionDisconnected",null);o([g.LogManager.d_trace(g.LogCategory.CALLEXSERVER)],T.prototype,"handleSIPInfo",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"stopRinging",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"handleSipEvent",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"handleTransferStarted",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"handleTransferComplete",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"handleTransferFailed",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"handleReinvite",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"handleRejectReinvite",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T.prototype,"handleInReinvite",null);o([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],T,"addCustomDataToHeaders",null);t.CallManager=T},function(e,t,n){"use strict";var r=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:true});var i=n(0);var a=n(47);var o=n(48);var s=n(49);var c=n(60);var l=n(21);var u=n(61);var d=n(1);var f=n(62);var g=n(63);var p;(function(e){var t=void 0;(function(e){e[e["Firefox"]=1]="Firefox";e[e["Webkit"]=2]="Webkit";e[e["Edge"]=3]="Edge";e[e["Safari"]=4]="Safari"})(t||(t={}));var n=void 0;function p(e,t,n){var i=e;if((typeof i==="undefined"?"undefined":r(i))!="object"){i={}}i[t]={ideal:n};return i}var v=f.getParser(window.navigator.userAgent);function h(e,r,a,o){i.LogManager.get().writeMessage(i.LogCategory.RTC,"Core",i.LogLevel.INFO,"Create WebRTC on the "+JSON.stringify(v));switch(n){case t.Firefox:return new s.WebRTCPC(e,r,a,o);case t.Webkit:var c=v.getBrowserVersion().split(".");var l=parseInt(c[0]);if(!isNaN(l)&&l>=72){return new g.TransreceiverPC(e,r,a,o)}else{return new s.WebRTCPC(e,r,a,o)}case t.Safari:return new s.WebRTCPC(e,r,a,o);case t.Edge:return new s.WebRTCPC(e,r,a,o);default:i.LogManager.get().writeMessage(i.LogCategory.RTC,"Core",i.LogLevel.INFO,"Unsupported browser "+navigator.userAgent);return null}}e.peerConnectionFactory=h;function m(){if(d.Client.getInstance().config().experiments&&d.Client.getInstance().config().experiments.emulate_ios)return true;return navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)}e.isIphone=m;function y(){return n===t.Firefox||n===t.Webkit}e.isScreenSharingSupported=y;function C(e){this.logger.info("[constraints]: "+JSON.stringify(e));return navigator.mediaDevices.getUserMedia(e)}function _(e,t){return new l.SignalingDTMFSender(t)}function S(){return new Promise(function(e){e(false)})}function E(e){var t=false;var n=false;if(e.audioEnabled){t=true;if(e.audioInputId)t=p(t,"deviceId",e.audioInputId)}if(e.videoEnabled){n=true;if(e.videoSettings){n=e.videoSettings}if(e.videoInputId)n=p(n,"deviceId",e.videoInputId)}return{peerIdentity:null,audio:t,video:n}}function L(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(e===false){return"voxmobile"}if(!n){M()}switch(n){case t.Firefox:return"firefox";case t.Webkit:return"chrome";case t.Safari:return"safari";case t.Edge:return"edge";default:return""}}e.getWSVendor=L;function M(){if(navigator["mozGetUserMedia"]){n=t.Firefox}else if(navigator["webkitGetUserMedia"]){n=t.Webkit}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)){n=t.Edge}else if(navigator["getUserMedia"]){n=t.Safari}}function b(){}function R(){if(!n){M()}if(n){i.LogManager.get().writeMessage(i.LogCategory.RTC,"Core",i.LogLevel.INFO,"Detected browser "+t[n])}e.getUserMedia=C;e.getDTMFSender=_;e.screenSharingSupported=S;switch(n){case t.Firefox:e.attachMedia=a.FF.attachStream;e.detachMedia=a.FF.detachStream;e.getScreenMedia=a.FF.getScreenMedia;e.getRTCStats=a.FF.getRTCStats;e.getUserMedia=a.FF.getUserMedia;e.screenSharingSupported=a.FF.screenSharingSupported;e.getDTMFSender=a.FF.getDTMFSender;break;case t.Webkit:e.attachMedia=o.Webkit.attachStream;e.detachMedia=o.Webkit.detachStream;e.getScreenMedia=o.Webkit.getScreenMedia;e.getRTCStats=o.Webkit.getRTCStats;e.getUserMedia=o.Webkit.getUserMedia;e.screenSharingSupported=o.Webkit.screenSharingSupported;e.getDTMFSender=o.Webkit.getDTMFSender;break;case t.Safari:e.attachMedia=u.Safari.attachStream;e.detachMedia=u.Safari.detachStream;e.getScreenMedia=u.Safari.getScreenMedia;e.getRTCStats=u.Safari.getRTCStats;e.getUserMedia=a.FF.getUserMedia;e.getDTMFSender=u.Safari.getDTMFSender;break;case t.Edge:e.attachMedia=c.Edge.attachStream;e.detachMedia=c.Edge.detachStream;e.getScreenMedia=c.Edge.getScreenMedia;e.screenSharingSupported=c.Edge.screenSharingSupported;e.getRTCStats=c.Edge.getRTCStats;break;default:i.LogManager.get().writeMessage(i.LogCategory.RTC,"Core",i.LogLevel.INFO,"Unsupported browser "+navigator.userAgent)}e.composeConstraints=E}e.init=R})(p||(p={}));t.default=p},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(22);var c=n(2);var l=n(0);var u=n(6);var d=n(12);var f=n(7);var g=n(3);var p=n(13);var v=n(1);var h=n(4);var m=n(16);var y=function(){function e(){var t=this;a(this,e);this.iceConfig=null;this._peerConnections={};this.waitingPeerConnections={};this.logger=l.LogManager.get().createLogger(l.LogCategory.RTC,this._traceName());this._requireMedia=true;if(f.default.getWSVendor()==="firefox")e.hasTransceivers=true;c.VoxSignaling.get().setRPCHandler(p.RemoteEvent.createPC,function(e,n){t.rpcHandlerCreatePC(e,n)});c.VoxSignaling.get().setRPCHandler(p.RemoteEvent.destroyPC,function(e){t.rpcHandlerDestroyPC(e)});c.VoxSignaling.get().addHandler(this)}r(e,[{key:"setupDirectPC",value:function e(t,n,r,i){var a=this;var o=f.default.peerConnectionFactory(t,n,r);o.setHoldKey(i);var s=v.Client.getInstance().config();var c=h.default.StreamManager.get();var l=u.CallManager.get().calls[t];return c.getCallStream(l).then(function(e){if(e!==null){o.fastAddCustomMedia(e)}a._peerConnections[t]=o;return o.getLocalOffer()})}},{key:"incomeDirectPC",value:function e(t,n,r,i,a){var o=this;var c=f.default.peerConnectionFactory(t,s.PeerConnectionMode.P2P,n,a);c.setHoldKey(i);return c._setRemoteDescription(r).then(function(){if(u.CallManager.get().calls[t]){o._peerConnections[t]=c;return c}else{c.close()}})}},{key:"getPeerConnect",value:function e(t){return this._peerConnections[t]}},{key:"onSignalingConnected",value:function e(){}},{key:"onSignalingClosed",value:function e(){this.logger.info("Closing all peer connections because signaling connection has closed");this.waitingPeerConnections={};for(var t in this._peerConnections){this._peerConnections[t].close()}this._peerConnections={}}},{key:"onSignalingConnectionFailed",value:function e(t){}},{key:"onMediaConnectionFailed",value:function e(){}},{key:"closeAll",value:function e(){for(var t in this._peerConnections){this._peerConnections[t].close()}this._peerConnections={}}},{key:"setBandwidthParams",value:function e(t){this._bandwidthParams=t}},{key:"addBandwidthParams",value:function e(t){if(this._bandwidthParams)t.sdp=t.sdp.replace(/(a=mid:video.*\r\n)/g,"$1b=AS:"+this._bandwidthParams+"\r\n");return t}},{key:"rpcHandlerCreatePC",value:function t(n,r){this.logger.info("rpcHandlerCreatePC(), received SDP: \n"+r.replace("<br>","\n\r"));r=m.SDPMuggle.addSetupAttribute(r);var i=e.sdpOffersVideo(r);var a=s.PeerConnectionMode.CLIENT_SERVER_V1;c.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.muteLocal,n,false);var o=f.default.peerConnectionFactory(n,a,i);this._peerConnections[n]=o;var l=u.CallManager.get().calls[n];h.default.StreamManager.get().getCallStream(l).then(function(e){if(n==="__default")r=r.replace("a=sendrecv","a=recvonly");o.fastAddCustomMedia(e);o.processRemoteOffer(r).then(function(e){if(typeof l==="undefined"||l.checkCallMode(d.CallMode.SERVER))c.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.confirmPC,n,e);else c.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.acceptCall,[n,u.CallManager.cleanHeaders(l.headers()),e]);if(n!=="__default"&&typeof u.CallManager.get().calls[n]!=="undefined"){u.CallManager.get().calls[n].peerConnection=o}})}).catch(function(e){if(typeof l!=="undefined"){u.CallManager.get().handleConnectionFailed(l.id(),403,"Media access denied",{})}else{c.VoxSignaling.get().onConnectionFailedRPC()}})}},{key:"rpcHandlerDestroyPC",value:function e(t){var n=this;if(this._peerConnections[t]){if(t==="__default"){setTimeout(function(){n._peerConnections[t].close();delete n._peerConnections[t]},200)}else{this._peerConnections[t].close();delete this._peerConnections[t]}}delete this.waitingPeerConnections[t]}},{key:"_traceName",value:function e(){return"PCFactory"}},{key:"peerConnections",get:function e(){return this._peerConnections}},{key:"requireMedia",get:function e(){return this._requireMedia},set:function e(t){this._requireMedia=t}}],[{key:"get",value:function t(){if(this.inst===null){this.inst=new e}return this.inst}},{key:"sdpOffersVideo",value:function e(t){return{receiveVideo:t.indexOf("m=video")!==-1,sendVideo:true}}}]);return e}();y.inst=null;y.hasTransceivers=false;o([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"setupDirectPC",null);o([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"incomeDirectPC",null);o([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"getPeerConnect",null);o([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"onSignalingConnected",null);o([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"onSignalingClosed",null);o([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"onSignalingConnectionFailed",null);o([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"onMediaConnectionFailed",null);o([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"closeAll",null);o([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"setBandwidthParams",null);o([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"addBandwidthParams",null);o([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"rpcHandlerCreatePC",null);o([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"rpcHandlerDestroyPC",null);o([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y,"sdpOffersVideo",null);t.PCFactory=y},function(e,t,n){"use strict";var r=true;var i=true;var a={disableLog:function(e){if(typeof e!=="boolean"){return new Error("Argument type: "+typeof e+". Please use a boolean.")}r=e;return e?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(e){if(typeof e!=="boolean"){return new Error("Argument type: "+typeof e+". Please use a boolean.")}i=!e;return"adapter.js deprecation warnings "+(e?"disabled":"enabled")},log:function(){if(typeof window==="object"){if(r){return}if(typeof console!=="undefined"&&typeof console.log==="function"){console.log.apply(console,arguments)}}},deprecated:function(e,t){if(!i){return}console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(e){var t=e&&e.navigator;var n={};n.browser=null;n.version=null;if(typeof e==="undefined"||!e.navigator){n.browser="Not a browser.";return n}if(t.mozGetUserMedia){n.browser="firefox";n.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1)}else if(t.webkitGetUserMedia){if(e.webkitRTCPeerConnection){n.browser="chrome";n.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2)}else{if(t.userAgent.match(/Version\/(\d+).(\d+)/)){n.browser="safari";n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else{n.browser="Unsupported webkit-based browser "+"with GUM support but no WebRTC support.";return n}}}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/)){n.browser="edge";n.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2)}else if(t.mediaDevices&&t.userAgent.match(/AppleWebKit\/(\d+)\./)){n.browser="safari";n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else{n.browser="Not a supported browser.";return n}return n}};e.exports={log:a.log,deprecated:a.deprecated,disableLog:a.disableLog,disableWarnings:a.disableWarnings,extractVersion:a.extractVersion,shimCreateObjectURL:a.shimCreateObjectURL,detectBrowser:a.detectBrowser.bind(a)}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var i=function e(){r(this,e)};i.DIRECT_CALL_HEADER="X-DirectCall";i.VIAMEDIA_CALL_HEADER="X-ViaMedia";i.CALLSTATSIOID_HEADER="X-CallstatsIOID";i.CALL_DATA_HEADER="VI-CallData";i.ZINGAYA_IM_MIME_TYPE="application/zingaya-im";i.P2P_SPD_FRAG_MIME_TYPE="voximplant/sdpfrag";i.VI_HOLD_EMUL="vi/holdemul";i.VI_SPD_OFFER_MIME_TYPE="vi/sdpoffer";i.VI_SPD_ANSWER_MIME_TYPE="vi/sdpanswer";i.VI_CONF_PARTICIPANT_INFO_ADDED="vi/conf-info-added";i.VI_CONF_PARTICIPANT_INFO_REMOVED="vi/conf-info-removed";i.VI_CONF_PARTICIPANT_INFO_UPDATED="vi/conf-info-updated";t.Constants=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(2);var c=n(0);var l=n(8);var u=n(3);var d=n(13);var f=n(17);var g=n(1);var p=n(42);var v;(function(e){e[e["IDLE"]=0]="IDLE";e[e["IN_PROGRESS"]=1]="IN_PROGRESS"})(v=t.AuthenticatorState||(t.AuthenticatorState={}));var h=function(){function e(){var t=this;a(this,e);this.FAIL_CODE_SECOND_STAGE=301;this.FAIL_CODE_ONE_TIME_KEY=302;this._displayName=null;this._username=null;this._authorized=false;this.signaling=s.VoxSignaling.get();this.currentState=v.IDLE;this.logger=c.LogManager.get().createLogger(c.LogCategory.SIGNALING,this._traceName());this.signaling.setRPCHandler(d.RemoteEvent.loginFailed,function(e,n){t.onLoginFailed(e,n)});this.signaling.setRPCHandler(d.RemoteEvent.loginSuccessful,function(e,n){t.onLoginSuccesful(e,n)});this.signaling.setRPCHandler(d.RemoteEvent.refreshOauthTokenFailed,function(e){t.handler.onRefreshTokenFailed(e)});this.signaling.setRPCHandler(d.RemoteEvent.refreshOauthTokenSuccessful,function(e){t.handler.onRefreshTokenSuccess(e.OAuth)});this.signaling.addHandler(this)}r(e,[{key:"setHandler",value:function e(t){this.handler=t}},{key:"onLoginFailed",value:function e(t,n){this.currentState=v.IDLE;switch(t){case this.FAIL_CODE_ONE_TIME_KEY:this.handler.onOneTimeKeyGenerated(n);break;case this.FAIL_CODE_SECOND_STAGE:this.handler.onSecondStageInitiated();break;default:this.handler.onLoginFailed(t);break}}},{key:"onLoginSuccesful",value:function e(t,n){this.currentState=v.IDLE;this._authorized=true;l.PCFactory.get().iceConfig=n.iceConfig;if(g.Client.getInstance()&&g.Client.getInstance().config()&&g.Client.getInstance().config().experiments&&g.Client.getInstance().config().experiments.cleverACD){p.default.setConnectionId(n.connectionId)}this._displayName=t;f.CallstatsIo.get().init({userName:this._username,aliasName:this._displayName});this.handler.onLoginSuccessful(t,n.OAuth)}},{key:"basicLogin",value:function e(t,n,r){if(this.currentState!=v.IDLE){this.logger.error("Login operation already in progress");return}this._username=t;this.currentState=v.IN_PROGRESS;this.signaling.callRemoteFunction(u.RemoteFunction.login,t,n,r)}},{key:"tokenLogin",value:function e(t,n){if(this.currentState!=v.IDLE){this.logger.error("Login operation already in progress");return}this._username=t;this.currentState=v.IN_PROGRESS;this.signaling.callRemoteFunction(u.RemoteFunction.login,t,"",n)}},{key:"tokenRefresh",value:function e(t,n,r){if(r)this.signaling.callRemoteFunction(u.RemoteFunction.refreshOauthToken,t,{refreshToken:n,deviceToken:r});else this.signaling.callRemoteFunction(u.RemoteFunction.refreshOauthToken,t,n)}},{key:"loginUsingOneTimeKey",value:function e(t,n,r){if(this.currentState!=v.IDLE){this.logger.error("Login operation already in progress");return}this._username=t;this.currentState=v.IN_PROGRESS;this.signaling.callRemoteFunction(u.RemoteFunction.loginUsingOneTimeKey,t,n,r)}},{key:"loginStage2",value:function e(t,n,r){if(this.currentState!=v.IDLE){this.logger.error("Login operation already in progress");return}this._username=t;this.currentState=v.IN_PROGRESS;this.signaling.callRemoteFunction(u.RemoteFunction.loginStage2,t,n,r)}},{key:"generateOneTimeKey",value:function e(t){if(this.currentState!=v.IDLE){this.logger.error("Login operation already in progress");return}this.currentState=v.IN_PROGRESS;this.signaling.callRemoteFunction(u.RemoteFunction.loginGenerateOneTimeKey,t)}},{key:"username",value:function e(){return this._username}},{key:"authorized",value:function e(){return this._authorized}},{key:"onSignalingConnected",value:function e(){}},{key:"onSignalingConnectionFailed",value:function e(t){}},{key:"onSignalingClosed",value:function e(){this._authorized=false;this._displayName=null;this._username=null}},{key:"onMediaConnectionFailed",value:function e(){}},{key:"ziAuthorized",value:function e(t){this._authorized=t}},{key:"_traceName",value:function e(){return"Authenticator"}},{key:"displayName",get:function e(){return this._displayName}}],[{key:"get",value:function t(){if(typeof this.inst=="undefined"){this.inst=new e}return this.inst}}]);return e}();o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"setHandler",null);o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"onLoginFailed",null);o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"onLoginSuccesful",null);o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"basicLogin",null);o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"tokenLogin",null);o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"tokenRefresh",null);o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"loginUsingOneTimeKey",null);o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"loginStage2",null);o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"generateOneTimeKey",null);o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"username",null);o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"authorized",null);o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"onSignalingConnected",null);o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"onSignalingConnectionFailed",null);o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"onSignalingClosed",null);o([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],h.prototype,"onMediaConnectionFailed",null);t.Authenticator=h},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,n,r)}}else if("value"in i){return i.value}else{var o=i.get;if(o===undefined){return undefined}return o.call(r)}};var a=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,o=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":a(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o}return i>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var u=n(5);var d=n(2);var f=n(10);var g=n(0);var p=n(8);var v=n(6);var h=n(7);var m=n(3);var y=n(1);var C=n(15);var _=n(23);var S=n(4);var E;(function(e){e[e["ALERTING"]="ALERTING"]="ALERTING";e[e["PROGRESSING"]="PROGRESSING"]="PROGRESSING";e[e["CONNECTED"]="CONNECTED"]="CONNECTED";e[e["UPDATING"]="UPDATING"]="UPDATING";e[e["ENDED"]="ENDED"]="ENDED"})(E=t.CallState||(t.CallState={}));var L;(function(e){e[e["P2P"]=0]="P2P";e[e["SERVER"]=1]="SERVER"})(L=t.CallMode||(t.CallMode={}));var M=function(e){c(t,e);function t(e,n,r,i){o(this,t);var a=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));a.remoteMuteState=true;a.signalingConnected=false;a.settings=i;a.settings.id=e;a.settings.displayName=n;a.settings.mode=L.P2P;a.settings.active=true;a.settings.usedSinkId=null;a.settings.incoming=r;a.settings.state=r?E.ALERTING:E.PROGRESSING;var c=y.Client.getInstance().config();a.settings.audioDirections={sendAudio:true};a.settings.videoDirections=typeof i.video==="boolean"?{sendVideo:i.video,receiveVideo:true}:i.video;a.settings.hasEarlyMedia=false;a.logger=g.LogManager.get().createLogger(g.LogCategory.CALL,"Call "+e);a._callManager=v.CallManager.get();return a}r(t,[{key:"id",value:function e(){if(this.settings)return this.settings.id;else return"new"}},{key:"number",value:function e(){return this.settings.number}},{key:"displayName",value:function e(){return this.settings.displayName}},{key:"headers",value:function e(){return this.settings.extraHeaders}},{key:"active",value:function e(){return this.settings.active}},{key:"_setActive",value:function e(t){var n={call:this,old:this.settings.active,new:t,name:u.CallEvents.ActiveUpdated};this.settings.active=t;this.dispatchEvent(n);this.muteIncomingStreams(t);return t}},{key:"muteIncomingStreams",value:function e(t){this.getEndpoints().forEach(function(e){e.mediaRenderers.forEach(function(e){e.stream.getTracks().forEach(function(e){e.enabled=t})})})}},{key:"state",value:function e(){return E[this.settings.state]}},{key:"_setState",value:function e(t){var n={call:this,old:this.settings.state,new:t,name:u.CallEvents.StateUpdated};this.settings.state=t;this.dispatchEvent(n);return t}},{key:"answer",value:function e(t,n,r){this.logger.info("answer("+JSON.stringify(r)+")");if(typeof t!="undefined"){if(typeof n=="undefined"||(typeof n==="undefined"?"undefined":a(n))!=="object")n={};n[f.Constants.CALL_DATA_HEADER]=t}if(typeof r!=="undefined")r={sendVideo:y.Client.getInstance().config().videoSupport,receiveVideo:y.Client.getInstance().config().videoSupport};if(this.settings.state!=E.ALERTING)throw new Error("WRONG_CALL_STATE");if(typeof r!="undefined")this._peerConnection.setVideoFlags(r)}},{key:"decline",value:function e(t){this.logger.info("decline()");if(this.settings.state!=E.ALERTING)throw new Error("WRONG_CALL_STATE");d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.rejectCall,this.settings.id,false,v.CallManager.cleanHeaders(t))}},{key:"reject",value:function e(t){this.logger.info("reject()");if(this.settings.state!=E.ALERTING)throw new Error("WRONG_CALL_STATE");d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.rejectCall,this.settings.id,true,v.CallManager.cleanHeaders(t))}},{key:"hangup",value:function e(t){this.logger.info("hangup()");if(this.settings.state==E.CONNECTED||this.settings.state==E.UPDATING||this.settings.state==E.PROGRESSING)d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.disconnectCall,this.settings.id,v.CallManager.cleanHeaders(t));else if(this.settings.state==E.ALERTING)d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.rejectCall,this.settings.id,true,v.CallManager.cleanHeaders(t));else throw new Error("WRONG_CALL_STATE")}},{key:"sendTone",value:function e(t){this.logger.info("sendTone("+t+")");if(this.settings.active)this._peerConnection.sendDTMF(t)}},{key:"mutePlayback",value:function e(){this.logger.info("mutePlayback()");this.remoteMuteState=false;_.EndpointManager.get().getEndpoints(this).forEach(function(e){e.mediaRenderers.forEach(function(e){e.setVolume(0)})})}},{key:"unmutePlayback",value:function e(){this.logger.info("unmutePlayback()");this.remoteMuteState=true;_.EndpointManager.get().getEndpoints(this).forEach(function(e){e.mediaRenderers.forEach(function(e){e.setVolume(1)})})}},{key:"restoreRMute",value:function e(){var t=this;if(this.settings.active){_.EndpointManager.get().getEndpoints(this).forEach(function(e){e.mediaRenderers.forEach(function(e){e.setVolume(t.remoteMuteState?1:0)})})}}},{key:"muteMicrophone",value:function e(){this.logger.info("muteMicrophone()");this.peerConnection.muteMicrophone(true)}},{key:"unmuteMicrophone",value:function e(){this.logger.info("unmuteMicrophone()");this.peerConnection.muteMicrophone(false)}},{key:"showRemoteVideo",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(typeof t=="undefined")t=true;var n=_.EndpointManager.get().getEndpoints(this);if(n){n.forEach(function(e){if(e.mediaRenderers){e.mediaRenderers.forEach(function(e){if(e.element)e.element.style.display=t?"block":"none"})}})}}},{key:"setRemoteVideoPosition",value:function e(t,n){throw new Error("Deprecated: please use CSS to position '#voximplantcontainer' element")}},{key:"setRemoteVideoSize",value:function e(t,n){throw new Error("Deprecated: please use CSS to set size of '#voximplantcontainer' element")}},{key:"sendInfo",value:function e(t,n,r){this.logger.info("sendInfo("+t+", "+JSON.stringify(n)+")");var i,a,o=t.indexOf("/");if(o==-1){i="application";a=t}else{i=t.substring(0,o);a=t.substring(o+1)}d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.sendSIPInfo,this.settings.id,i,a,n,v.CallManager.cleanHeaders(r))}},{key:"sendMessage",value:function e(t){this.logger.info("sendMessage()");this.sendInfo(f.Constants.ZINGAYA_IM_MIME_TYPE,t,{})}},{key:"setVideoSettings",value:function e(t,n,r){this.logger.info("Setting call "+this.id()+" video settings: "+JSON.stringify(t));S.default.CameraManager.get().setCallVideoSettings(this,S.default.CameraManager.legacyParamConverter(t));S.default.StreamManager.get().updateCallStream(this).then(function(e){if(n)n(e)},function(e){if(r)r()})}},{key:"getVideoElementId",value:function e(){var t=_.EndpointManager.get().getEndpoints(this);if(typeof t!=="undefined")t.forEach(function(e){e.mediaRenderers.forEach(function(e){if(e.stream){var t=e.stream.getVideoTracks();if(t.length)return e.stream.getTracks()[0].id}})});return""}},{key:"addEventListener",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addEventListener",this).call(this,n,r)}},{key:"on",value:function e(n,r,a){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,n,r)}},{key:"removeEventListener",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeEventListener",this).call(this,n,r)}},{key:"off",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"off",this).call(this,n,r)}},{key:"dispatchEvent",value:function e(n){if(n.name===u.CallEvents.Updated||n.name===u.CallEvents.UpdateFailed){this._setState(E.CONNECTED)}i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispatchEvent",this).call(this,n)}},{key:"onConnected",value:function e(t,n){if(this.signalingConnected){if(!this.checkState([E.PROGRESSING,E.ALERTING],"onConnected"))return false;this._setState(E.CONNECTED);this.startTime=Date.now();this.dispatchEvent({name:"Connected",call:this,headers:t});return true}}},{key:"onDisconnected",value:function e(t,n){var r=this;return new Promise(function(e,i){r.stopSharingScreen();if(!r.checkState([E.CONNECTED,E.ALERTING,E.PROGRESSING,E.UPDATING],"onDisconnected")){i(new Error("Call in the wrong state "+r.state()));return false}r._setState(E.ENDED);_.EndpointManager.get().clear(r).then(function(){e(true);r.dispatchEvent({name:"Disconnected",call:r,headers:t,params:n})}).catch(function(e){i(new Error("Endpoint manager got some error: "+e.message))})})}},{key:"onFailed",value:function e(t,n,r){this.dispatchEvent({name:"Failed",call:this,headers:r,code:t,reason:n});this._setState(E.ENDED);_.EndpointManager.get().clear(this);return true}},{key:"onStopRinging",value:function e(){if(!this.checkState([E.PROGRESSING,E.CONNECTED],"onStopRinging"))return false;this.dispatchEvent({name:"ProgressToneStop",call:this});return true}},{key:"onRingOut",value:function e(){if(!this.checkState(E.PROGRESSING,"onRingOut"))return false;this.dispatchEvent({name:"ProgressToneStart",call:this});return true}},{key:"onTransferComplete",value:function e(){if(!this.checkState(E.CONNECTED,"onTransferComplete"))return false;this.dispatchEvent({name:"TransferComplete",call:this});return true}},{key:"onTransferFailed",value:function e(){if(!this.checkState(E.CONNECTED,"onTransferFailed"))return false;this.dispatchEvent({name:"TransferFailed",call:this});return true}},{key:"onInfo",value:function e(t,n,r,i,a){if(t.stateValue==E.CONNECTED||t.stateValue==E.PROGRESSING||t.stateValue==E.ALERTING||t.stateValue==E.UPDATING){var o=n+"/"+r;if(o==f.Constants.ZINGAYA_IM_MIME_TYPE){this.dispatchEvent({name:"onSendMessage",call:this,text:i})}else if(o==f.Constants.P2P_SPD_FRAG_MIME_TYPE){var s=JSON.parse(i);for(var c in s){if(typeof t!=="undefined"&&typeof t.peerConnection!=="undefined")t.peerConnection.addRemoteCandidate(s[c][1],s[c][0]);else this.logger.info("Candidate skipped. Connection not created yet.")}}else if(o===f.Constants.VI_CONF_PARTICIPANT_INFO_ADDED||o===f.Constants.VI_CONF_PARTICIPANT_INFO_REMOVED||o===f.Constants.VI_CONF_PARTICIPANT_INFO_UPDATED){var l=JSON.parse(i);if(l){_.EndpointManager.get().endpointInfoUpdated(this,o,l)}else{this.logger.warning("Wrong endpoint info")}}else{this.dispatchEvent({name:"InfoReceived",call:this,body:i,headers:a,mimeType:o})}return true}else{this.logger.warning("received handleSIPInfo for call: "+t.id()+" in invalid state: "+t.state())}}},{key:"setActive",value:function e(t){var n=this;this.logger.info("setActive("+t+")");return new Promise(function(e,r){if(t===n.settings.active){e({name:u.CallEvents["Updated"],result:false,call:n});return}if(h.default.getWSVendor()==="firefox"){n.sendInfo(f.Constants.VI_HOLD_EMUL,JSON.stringify({hold:!t}));e({name:u.CallEvents["Updated"],call:n,result:true});return}if(n.settings.state==E.CONNECTED){n._setState(E.UPDATING);n._setActive(t);if(!t)d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.hold,n.settings.id);else d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.unhold,n.settings.id);e({name:u.CallEvents["Updated"],result:true,call:n})}else{r({name:u.CallEvents.UpdateFailed,code:11,call:n})}})}},{key:"checkCallMode",value:function e(t){return this.settings.mode==t}},{key:"canStartSendingCandidates",value:function e(){if(typeof this._peerConnection=="undefined")this._peerConnection=p.PCFactory.get().peerConnections[this.settings.id];this._peerConnection.canStartSendingCandidates()}},{key:"notifyICETimeout",value:function e(){this.dispatchEvent({name:"ICETimeout",call:this})}},{key:"sendVideo",value:function e(t){var n=this;this.logger.info("sendVideo("+t+")");if(!this.peerConnection){return new Promise(function(e,t){e({call:n,name:u.CallEvents[u.CallEvents.Updated],result:true})})}var r=this.settings.videoDirections.sendVideo;this.settings.videoDirections.sendVideo=t;if(this.peerConnection.hasLocalVideo()){if(!t&&!r){return new Promise(function(e,t){S.default.StreamManager.get().updateCallStream(n).then(function(){return e({call:n,name:u.CallEvents[u.CallEvents.Updated],result:true})}).catch(t)})}else{this.peerConnection.enableVideo(t);return new Promise(function(e,t){e({call:n,name:u.CallEvents[u.CallEvents.Updated],result:true})})}}else if(t){return new Promise(function(e,t){S.default.StreamManager.get().updateCallStream(n).then(function(){return e({call:n,name:u.CallEvents[u.CallEvents.Updated],result:true})}).catch(t)})}}},{key:"receiveVideo",value:function e(){var t=this;this._setState(E.UPDATING);return new Promise(function(e,n){if(t.settings.videoDirections.receiveVideo===true){n();return}t.settings.videoDirections.receiveVideo=true;t._peerConnection.hdnFRS().then(e,n)})}},{key:"sendMedia",value:function e(t,n){var r=this;this._setState(E.UPDATING);if(typeof t==="undefined"||t===null)t=this.settings.audioDirections.sendAudio;if(typeof n==="undefined"||n===null)n=this.settings.videoDirections.sendVideo;return this.peerConnection.sendMedia(t,n).then(function(e){if(typeof n!=="undefined"&&n!==null){r.settings.videoDirections.sendVideo=n}if(typeof t!=="undefined"&&t!==null){r.settings.audioDirections.sendAudio=t}return e})}},{key:"sendAudio",value:function e(t){var n=this;var r=y.Client.getInstance().config();this.settings.audioDirections.sendAudio=t;if(this.peerConnection.hasLocalAudio()){this.peerConnection.muteMicrophone(!t);return new Promise(function(e,t){e({call:n,name:u.CallEvents[u.CallEvents.Updated],result:true})})}else if(t){return this.sendMedia(null,t)}}},{key:"getLocalStream",value:function e(){return S.default.StreamManager.get().getCallStream(this)}},{key:"setLocalStream",value:function e(t){return new Promise(function(e,t){t(new Error("Not implemented"))})}},{key:"shareScreen",value:function e(){var t=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.logger.info("shareScreen("+n+")");return new Promise(function(e,r){var i=S.default.StreamManager.get()._getScreenSharing(t);if(i.length){t.logger.warning("Screen sharing already active.");r(new Error("Screen sharing already active."))}if(h.default.isScreenSharingSupported){S.default.StreamManager.get()._newScreenSharing(t,n).then(function(n){if(n.renderer){t.dispatchEvent({name:u.CallEvents.LocalVideoStreamAdded,type:n.renderer.kind,element:n.renderer.element,videoStream:n.renderer.stream})}t.peerConnection.addCustomMedia(n.stream).then(function(){e({name:u.CallEvents.Updated,result:true,call:t})})}).catch(function(e){t.logger.warning(e.message);r(e)})}else{t.logger.warning("Sorry, this browser does not support screen sharing.");r(new Error("Sorry, this browser does not support screen sharing."))}})}},{key:"stopSharingScreen",value:function e(){var t=this;this.logger.info("stopSharingScreen()");return new Promise(function(e,n){var r=S.default.StreamManager.get()._getScreenSharing(t);if(r){var i=r.length;if(i===0)e({name:u.CallEvents.Updated,result:true,call:t});r.forEach(function(r){var a=!r.renderer;S.default.StreamManager.get()._clearScreenSharing(t,r).then(function(){if(a){return t.peerConnection.removeCustomMedia(r.stream)}}).then(function(){r.stream=undefined;i--;if(i<=0){e({name:u.CallEvents.Updated,result:true,call:t});return}}).catch(function(e){t.logger.warning(e.message);n(e);return})})}else{t.logger.warning("Sorry, screen sharing not started yet.");n(new Error("Sorry, screen sharing not started yet."))}})}},{key:"wireRemoteStream",value:function e(){return new Promise(function(e,t){e()})}},{key:"getRemoteAudioStreams",value:function e(){var t=this;return new Promise(function(e,n){if(t.peerConnection){t.peerConnection.remoteStreams.forEach(function(t){if(t.getAudioTracks().length){e(new MediaStream(t.getAudioTracks()));return}});n(new Error("We have no remote MediaStream for this call yet"))}else n(new Error("We have no PC for this call yet"))})}},{key:"getRemoteVideoStreams",value:function e(){var t=this;return new Promise(function(e,n){if(t.peerConnection){if(typeof t.peerConnection.remoteStreams[0]!="undefined"&&t.peerConnection.remoteStreams[0].getVideoTracks().length!=0)e(new MediaStream(t.peerConnection.remoteStreams[0].getVideoTracks()));else n(new Error("We have no remote MediaStream for this call yet"))}else n(new Error("We have no PC for this call yet"))})}},{key:"getRemoteWiredState",value:function e(){return this.settings.wiredRemote}},{key:"getLocalWiredState",value:function e(){return this.settings.wiredLocal}},{key:"useAudioOutput",value:function e(t){_.EndpointManager.get().useAudioOutput(this,t);return}},{key:"getAudioElementId",value:function e(){if(this._peerConnection.remoteStreams.length=0)return null;if(this._peerConnection.remoteStreams[0].getAudioTracks().length=0)return null;return this._peerConnection.remoteStreams[0].getAudioTracks()[0].id}},{key:"getDirections",value:function e(){if(typeof this.peerConnection!=="undefined")return this.peerConnection.getDirections()}},{key:"getStreamActivity",value:function e(){return{}}},{key:"hdnFRS",value:function e(){this.peerConnection._hdnFRS()}},{key:"hdnFRSPrep",value:function e(){var t=this;if(typeof this.peerConnection!=="undefined")this.peerConnection._hdnFRSPrep();else setTimeout(function(){t.hdnFRSPrep()},1e3)}},{key:"runIncomingReInvite",value:function e(t,n){var r=this;if(this.settings.state===E.UPDATING){d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.rejectReInvite,this.settings.id,{})}else{this._setState(E.UPDATING);var i=v.CallManager.get().isSDPHasVideo(n);this.peerConnection.handleReinvite(t,n,i).then(function(){r.peerConnection.restoreMute();r.peerConnection.restoreVideoSending()})}}},{key:"setActiveForce",value:function e(t){this._setActive(t)}},{key:"getCallDuration",value:function e(){return Date.now()-this.startTime}},{key:"getEndpoints",value:function e(){return _.EndpointManager.get().getEndpoints(this)}},{key:"checkState",value:function e(t,n){if(t){if(typeof t!="string"){var r=false;var i=t;for(var a=0;a<i.length;a++){if(i[a]==this.settings.state){r=true}}if(!r){this.logger.warning("Received "+n+" in invalid state "+this.settings.state);return false}}else if(this.settings.state!=t){this.logger.warning("Received "+n+" in invalid state "+this.settings.state);return false}}return true}},{key:"_traceName",value:function e(){return"Call"}},{key:"promise",get:function e(){return this._promise}},{key:"peerConnection",get:function e(){return this._peerConnection},set:function e(t){this._peerConnection=t}},{key:"stateValue",get:function e(){return this.settings.state}}]);return t}(C.EventTarget);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"number",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"displayName",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"headers",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"active",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"_setActive",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"_setState",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"answer",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"decline",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"reject",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"hangup",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"sendTone",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"mutePlayback",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"unmutePlayback",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"restoreRMute",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"muteMicrophone",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"unmuteMicrophone",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"showRemoteVideo",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"setRemoteVideoPosition",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"setRemoteVideoSize",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"sendInfo",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"sendMessage",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"setVideoSettings",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"getVideoElementId",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"addEventListener",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"on",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"removeEventListener",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"off",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"dispatchEvent",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onConnected",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onDisconnected",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onFailed",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onStopRinging",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onRingOut",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onTransferComplete",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onTransferFailed",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onInfo",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"setActive",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"checkCallMode",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"canStartSendingCandidates",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"notifyICETimeout",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"sendVideo",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"receiveVideo",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"sendAudio",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"getLocalStream",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"setLocalStream",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"shareScreen",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"stopSharingScreen",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"wireRemoteStream",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"getRemoteAudioStreams",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"getRemoteVideoStreams",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"getRemoteWiredState",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"getLocalWiredState",null);l([g.LogManager.d_trace(g.LogCategory.CLIENT)],M.prototype,"useAudioOutput",null);l([g.LogManager.d_trace(g.LogCategory.CLIENT)],M.prototype,"getAudioElementId",null);l([g.LogManager.d_trace(g.LogCategory.CLIENT)],M.prototype,"getStreamActivity",null);l([g.LogManager.d_trace(g.LogCategory.CLIENT)],M.prototype,"hdnFRS",null);l([g.LogManager.d_trace(g.LogCategory.CLIENT)],M.prototype,"hdnFRSPrep",null);l([g.LogManager.d_trace(g.LogCategory.CLIENT)],M.prototype,"runIncomingReInvite",null);l([g.LogManager.d_trace(g.LogCategory.CLIENT)],M.prototype,"setActiveForce",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"checkState",null);t.Call=M},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e[e["loginFailed"]="loginFailed"]="loginFailed";e[e["loginSuccessful"]="loginSuccessful"]="loginSuccessful";e[e["handleError"]="handleError"]="handleError";e[e["onPCStats"]="__onPCStats"]="onPCStats";e[e["handleIncomingConnection"]="handleIncomingConnection"]="handleIncomingConnection";e[e["handleConnectionConnected"]="handleConnectionConnected"]="handleConnectionConnected";e[e["handleConnectionDisconnected"]="handleConnectionDisconnected"]="handleConnectionDisconnected";e[e["handleRingOut"]="handleRingOut"]="handleRingOut";e[e["startEarlyMedia"]="startEarlyMedia"]="startEarlyMedia";e[e["stopRinging"]="stopRinging"]="stopRinging";e[e["handleConnectionFailed"]="handleConnectionFailed"]="handleConnectionFailed";e[e["handleSIPInfo"]="handleSIPInfo"]="handleSIPInfo";e[e["handleSipEvent"]="handleSipEvent"]="handleSipEvent";e[e["handleTransferStarted"]="handleTransferStarted"]="handleTransferStarted";e[e["handleTransferComplete"]="handleTransferComplete"]="handleTransferComplete";e[e["handleTransferFailed"]="handleTransferFailed"]="handleTransferFailed";e[e["handleReInvite"]="handleReInvite"]="handleReInvite";e[e["handleAcceptReinvite"]="handleAcceptReinvite"]="handleAcceptReinvite";e[e["handleRejectReinvite"]="handleRejectReinvite"]="handleRejectReinvite";e[e["createPC"]="__createPC"]="createPC";e[e["destroyPC"]="__destroyPC"]="destroyPC";e[e["connectionSuccessful"]="__connectionSuccessful"]="connectionSuccessful";e[e["connectionFailed"]="__connectionFailed"]="connectionFailed";e[e["createConnection"]="__createConnection"]="createConnection";e[e["pong"]="__pong"]="pong";e[e["increaseGain"]="increaseGain"]="increaseGain";e[e["handlePreFlightCheckResult"]="handlePreFlightCheckResult"]="handlePreFlightCheckResult";e[e["handleVoicemail"]="handleVoicemail"]="handleVoicemail";e[e["onCallRemoteFunctionError"]="onCallRemoteFunctionError"]="onCallRemoteFunctionError";e[e["refreshOauthTokenFailed"]="refreshOauthTokenFailed"]="refreshOauthTokenFailed";e[e["refreshOauthTokenSuccessful"]="refreshOauthTokenSuccessful"]="refreshOauthTokenSuccessful";e[e["sipRegisterSuccessful"]="sipRegisterSuccessful"]="sipRegisterSuccessful";e[e["sipRegisterFailed"]="sipRegisterFailed"]="sipRegisterFailed";e[e["onACDStatus"]="onACDStatus"]="onACDStatus";e[e["onICEConfig"]="onICEConfig"]="onICEConfig";e[e["onICEConfigFailed"]="onICEConfigFailed"]="onICEConfigFailed"})(r=t.RemoteEvent||(t.RemoteEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e[e["SDKReady"]="SDKReady"]="SDKReady";e[e["ConnectionEstablished"]="ConnectionEstablished"]="ConnectionEstablished";e[e["ConnectionFailed"]="ConnectionFailed"]="ConnectionFailed";e[e["ConnectionClosed"]="ConnectionClosed"]="ConnectionClosed";e[e["AuthResult"]="AuthResult"]="AuthResult";e[e["RefreshTokenResult"]="RefreshTokenResult"]="RefreshTokenResult";e[e["PlaybackFinished"]="PlaybackFinished"]="PlaybackFinished";e[e["MicAccessResult"]="MicAccessResult"]="MicAccessResult";e[e["IncomingCall"]="IncomingCall"]="IncomingCall";e[e["SourcesInfoUpdated"]="SourcesInfoUpdated"]="SourcesInfoUpdated";e[e["NetStatsReceived"]="NetStatsReceived"]="NetStatsReceived";e[e["SIPRegistrationSuccessful"]="SIPRegistrationSuccessful"]="SIPRegistrationSuccessful";e[e["SIPRegistrationFailed"]="SIPRegistrationFailed"]="SIPRegistrationFailed";e[e["ACDStatusUpdated"]="ACDStatusUpdated"]="ACDStatusUpdated";e[e["ACDError"]="ACDError"]="ACDError"})(r=t.Events||(t.Events={}))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=function(){function e(){a(this,e)}r(e,[{key:"sysOn",value:function e(t,n,r){this._ETonTo("system",t,n,r)}},{key:"sysOff",value:function e(t,n){this._EToffTo("system",t,n)}},{key:"on",value:function e(t,n,r){this._ETonTo("user",t,n,r)}},{key:"off",value:function e(t,n){this._EToffTo("user",t,n)}},{key:"_ETonTo",value:function e(t,n,r,i){if(typeof this.eventListeners=="undefined")this.eventListeners={};var a=this.eventListeners;if(typeof a[n]=="undefined")a[n]=[];var o={listener:r,options:i,_triggered:false,_namespace:t};if(i&&i.capture)a[n].unshift(o);else a[n].push(o)}},{key:"_EToffTo",value:function e(t,n,r){var i=this.eventListeners;if(typeof i=="undefined"||typeof i[n]=="undefined")return;if(typeof r==="function"){for(var a=0;a<i[n].length;a++){if(i[n][a].listener==r&&i[n][a]._namespace===t){i[n].splice(a,1);break}}}else i[n]=i[n].filter(function(e){return e._namespace!==t})}},{key:"dispatchEvent",value:function e(t){if(typeof this.eventListeners!="undefined"&&typeof this.eventListeners[t.name]!="undefined"){var n=this.eventListeners[t.name].filter(function(e){return e._namespace==="user"});s.LogManager.get().writeMessage(s.LogCategory.UTILS,"[event]",s.LogLevel.INFO,""+t.name+(t.name.includes("QualityIssue")?" "+t.level:"")+", listeners: "+n.length);for(var r=0;r<this.eventListeners[t.name].length;r++){try{if((!this.eventListeners[t.name][r].options||!this.eventListeners[t.name][r].options.once||!this.eventListeners[t.name][r]._triggered)&&(this.eventListeners[t.name][r]._namespace==="system"||this.eventListeners[t.name][r]._namespace==="user"||this.eventListeners[t.name][r]._namespace==="default"&&!n.length)){var i=this.eventListeners[t.name][r].listener(t);if(i)s.LogManager.get().writeMessage(s.LogCategory.CLIENT,t.name+": ",s.LogLevel.WARNING,"The handler returned `false`. As of August 12, 2019, this will break the handler chain. See the details here: https://voximplant.com/blog/web-sdk-api-events-changes");if(this.eventListeners[t.name][r])this.eventListeners[t.name][r]._triggered=true}}catch(t){console.error(t)}}}else{s.LogManager.get().writeMessage(s.LogCategory.UTILS,"[event]",s.LogLevel.INFO,""+t.name+(t.name.includes("QualityIssue")?" "+t.level:"")+", listeners: 0")}}},{key:"removeEventListener",value:function e(t,n){this.off(t,n)}},{key:"addEventListener",value:function e(t,n,r){this.on(t,n,r)}},{key:"addDefaultEventListener",value:function e(t,n){this._ETonTo("default",t,n,{})}},{key:"removeDefaultEventListener",value:function e(t){this._EToffTo("default",t)}},{key:"_traceName",value:function e(){return"EventTarget"}}]);return e}();o([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"sysOn",null);o([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"sysOff",null);o([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"on",null);o([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"off",null);o([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"removeEventListener",null);o([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"addEventListener",null);o([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"addDefaultEventListener",null);o([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"removeDefaultEventListener",null);t.EventTarget=c},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var a=n(1);var o=function(){function e(){i(this,e)}r(e,[{key:"_traceName",value:function e(){return"SDPMuggle"}}],[{key:"detectDirections",value:function t(n){var r=[];var i=n.split(/(\r\n|\r|\n)/).filter(e.validLine);var a="";i.forEach(function(e){if(e.indexOf("m=")===0){var t=e.substr(2);a=t.split(" ")[0]}if(a!==""&&(e==="a=sendrecv"||e==="a=sendonly"||e==="a=recvonly"||e==="a=inactive")){r.push({type:a,direction:e.substr(2)});a=""}});return r}},{key:"removeTelephoneEvents",value:function t(n){if(n.sdp.indexOf("a=rtpmap:127 telephone-event/8000")!==-1){var r=n.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var i=-1;for(var a=0;a<r.length;a++){if(r[a].indexOf("m=audio")!==-1){var o=r[a];if(typeof o==="string")r[a]=o.replace(" 127","")}if(r[a].indexOf("a=rtpmap:127 telephone-event/8000")!==-1)i=a}r.splice(i,1);return new RTCSessionDescription({sdp:r.join("\r\n")+"\r\n",type:n.type})}return n}},{key:"removeDoubleOpus",value:function t(n){if(n.sdp.indexOf("a=rtpmap:109 opus")!==-1&&n.sdp.indexOf("a=rtpmap:111 opus")!==-1){var r=n.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var i=-1;for(var a=0;a<r.length;a++){if(r[a].indexOf("m=audio")!==-1){var o=r[a];if(typeof o==="string")r[a]=o.replace(" 109","")}if(r[a].indexOf("a=rtpmap:109 opus")!==-1)i=a}r.splice(i,1);return new RTCSessionDescription({sdp:r.join("\r\n")+"\r\n",type:n.type})}return n}},{key:"removeDoublePT",value:function t(n){var r=n.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var i=[];for(var a=0;a<r.length;a++){var o=r[a];if(o.indexOf("m=video")===0){i=o.split(" ");r[a]=i.filter(function(e,t){if(t===0)return true;for(var n=t-1;n>=2;n--){if(i[n]===e)return false}return true}).join(" ")}}return new RTCSessionDescription({sdp:r.join("\r\n")+"\r\n",type:n.type})}},{key:"removeTransportCC",value:function t(n){if(n.sdp.indexOf("http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")!==-1){var r=n.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var i=[];r.forEach(function(e,t){if(e.indexOf("http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")!==-1)i.unshift(t)});i.forEach(function(e){return r.splice(e,1)});return new RTCSessionDescription({sdp:r.join("\r\n")+"\r\n",type:n.type})}return n}},{key:"removeTIAS",value:function t(n){if(n.sdp.indexOf("b=TIAS:13888000")!==-1||n.sdp.indexOf("b=AS:13888")!==-1){var r=n.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var i=[];r.forEach(function(e,t){if(e.indexOf("b=TIAS:13888000")!==-1||e.indexOf("b=AS:13888")!==-1)i.unshift(t)});i.forEach(function(e){return r.splice(e,1)});n={type:n.type,sdp:r.join("\r\n")+"\r\n"}}return n}},{key:"fixVideoRecieve",value:function t(n,r){var i=n.sdp.indexOf("m=video");if(i!==-1&&!r){var a=n.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var o=null;a=a.map(function(e,t){if(o===null){if(e.indexOf("m=video")!==-1)o=t}else{if(e==="a=sendrecv")e="a=sendonly";else if(e==="a=recvonly")e="a=inactive"}return e});return new RTCSessionDescription({sdp:a.join("\r\n")+"\r\n",type:n.type})}return n}},{key:"addSetupAttribute",value:function e(t){var n=t.indexOf("a=setup:");if(n==-1){t+="a=setup:actpass\r\n"}return t}},{key:"findTrackByMid",value:function t(n,r){var i=n.split(/(\r\n|\r|\n)/).filter(e.validLine);var a=-1;for(var o=0;o<i.length;o++){if(i[o].indexOf("a=mid:")!==-1&&a!==-1){break}if(i[o].indexOf("a=mid:"+r)!==-1){a=o}if(i[o].indexOf("msid:")!==-1&&a!==-1){return i[o].split(" ").slice(-1).pop()}}return""}},{key:"addXAS",value:function e(t){if(a.Client.getInstance().config().experiments.xas&&a.Client.getInstance().config().experiments.xas){var n=t.sdp;var r=a.Client.getInstance().config().experiments.xas;if(typeof r.as!="undefined"&&r.as!==-1){n=n.replace(/(a=mid:video.*\r\n)/g,"$1b=AS:"+r.as+"\r\n")}if(typeof r.tias!="undefined"&&r.tias!==-1){n=n.replace(/(a=mid:video.*\r\n)/g,"$1b=TIAS:"+r.as+"\r\n")}return new RTCSessionDescription({sdp:n,type:t.type})}return t}},{key:"fixFFMIDBug",value:function e(t){if(t.sdp.indexOf("a=mid")==-1){var n=t.sdp.replace(/(m=audio.*\r\n)/g,"$1a=mid:0\r\n");return new RTCSessionDescription({sdp:n,type:t.type})}else{return t}}},{key:"fixFMTP",value:function t(n){var r=n.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var i=[];r=r.filter(function(e){if(e.indexOf("a=fmtp")==0){var t=e.split(" ")[1];var r=t.replace("apt=","");if(n.sdp.indexOf("a=rtpmap:"+r)!==-1)return true;else{i.push(t[0].replace("a=fmtp:",""));return false}}else return true}).filter(function(e){if(e.indexOf("a=rtpmap:")!==-1){return i.indexOf(e.split(" ")[0].replace("a=rtpmap:",""))===-1}else return true}).map(function(e){if(e.indexOf("m=")!==-1){var t=e.split(" ");return t.filter(function(e){return i.indexOf(e)===-1}).join(" ")}else return e});return{sdp:r.join("\r\n")+"\r\n",type:n.type}}}]);return e}();o.validLine=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.SDPMuggle=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var a=n(0);var o;(function(e){e[e["multiplex"]="multiplex"]="multiplex";e[e["audio"]="audio"]="audio";e[e["video"]="video"]="video";e[e["screen"]="screen"]="screen";e[e["data"]="data"]="data";e[e["unbundled"]="unbundled"]="unbundled"})(o=t.CallstatsIoFabricUsage||(t.CallstatsIoFabricUsage={}));var s;(function(e){e[e["fabricHold"]="fabricHold"]="fabricHold";e[e["fabricResume"]="fabricResume"]="fabricResume";e[e["audioMute"]="audioMute"]="audioMute";e[e["audioUnmute"]="audioUnmute"]="audioUnmute";e[e["videoPause"]="videoPause"]="videoPause";e[e["videoResume"]="videoResume"]="videoResume";e[e["fabricTerminated"]="fabricTerminated"]="fabricTerminated";e[e["screenShareStart"]="screenShareStart"]="screenShareStart";e[e["screenShareStop"]="screenShareStop"]="screenShareStop";e[e["dominantSpeaker"]="dominantSpeaker"]="dominantSpeaker";e[e["activeDeviceList"]="activeDeviceList"]="activeDeviceList"})(s=t.CallstatsIoFabricEvent||(t.CallstatsIoFabricEvent={}));var c;(function(e){e[e["getUserMedia"]="getUserMedia"]="getUserMedia";e[e["createOffer"]="createOffer"]="createOffer";e[e["createAnswer"]="createAnswer"]="createAnswer";e[e["setLocalDescription"]="setLocalDescription"]="setLocalDescription";e[e["setRemoteDescription"]="setRemoteDescription"]="setRemoteDescription";e[e["addIceCandidate"]="addIceCandidate"]="addIceCandidate";e[e["iceConnectionFailure"]="iceConnectionFailure"]="iceConnectionFailure";e[e["signalingError"]="signalingError"]="signalingError";e[e["applicationLog"]="applicationLog"]="applicationLog"})(c=t.CallstatsioWrtcFuncNames||(t.CallstatsioWrtcFuncNames={}));var l=function(){function e(t){i(this,e);this._params=t;this.inited=false;this.pendingFabric=[];var n=window;if(typeof n.callstats!="undefined")this.callstats=new n.callstats(null,n.io)}r(e,[{key:"init",value:function t(n){var r=this;if(!e.moduleEnabled)return false;a.LogManager.get().writeMessage(a.LogCategory.UTILS,"[CallstatsIo]",a.LogLevel.INFO," Callstats.io SDK initialization start");this.callstats.initialize(this._params.AppID,this._params.AppSecret,n,function(){a.LogManager.get().writeMessage(a.LogCategory.UTILS,"[CallstatsIo]",a.LogLevel.INFO," Callstats.io SDK initialization successful");r.inited=true;r.pendingFabric.map(function(e){r.callstats.addNewFabric(e.pc,e.remoteUser,e.fabricUsage,e.callID)})},function(){},this.packParams());return true}},{key:"packParams",value:function e(){var t={};if(this._params.disableBeforeUnloadHandler)t["disableBeforeUnloadHandler"]=this._params.disableBeforeUnloadHandler;if(this._params.applicationVersion)t["applicationVersion"]=this._params.applicationVersion;return t}},{key:"addNewFabric",value:function t(n,r,i,o){if(!e.moduleEnabled)return false;if(this.inited){a.LogManager.get().writeMessage(a.LogCategory.UTILS,"[CallstatsIo]",a.LogLevel.INFO," Callstats.io addNewFabric");this.callstats.addNewFabric(n,r,i,o)}else{this.pendingFabric.push({pc:n,remoteUser:r,fabricUsage:i,callID:o})}}},{key:"sendFabricEvent",value:function t(n,r,i){if(!e.moduleEnabled)return false;this.callstats.sendFabricEvent(n,r,i)}},{key:"reportError",value:function t(n,r,i,a,o,s){if(!e.moduleEnabled)return false;this.callstats.reportError(n,r,i,a,o,s)}},{key:"_traceName",value:function e(){return"CallstatsIo"}}],[{key:"isModuleEnabled",value:function t(){return e.moduleEnabled}},{key:"get",value:function t(n){var r=window;if(typeof r.callstats!="undefined")e.moduleEnabled=true;if(typeof e.instance=="undefined"){e.instance=new e(n)}if(typeof n!="undefined"){e.instance._params=n}return e.instance}}]);return e}();l.moduleEnabled=false;t.CallstatsIo=l},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,n,r)}}else if("value"in i){return i.value}else{var o=i.get;if(o===undefined){return undefined}return o.call(r)}};var a=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,o=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":a(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o}return i>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var u=n(0);var d=n(24);var f=n(2);var g=n(15);var p=n(41);var v=n(33);var h=function(e){c(t,e);function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(t.instance){throw new Error("Error - use Client.getMessagingInstance()")}e.query=[];setInterval(function(){e.updateQuery()},220);return e}r(t,[{key:"capitalize",value:function e(t){return t.toString()[0].toUpperCase()+t.toString().slice(1)}},{key:"updateQuery",value:function e(){if(this.query.length){var t=this.query.splice(0,1);f.VoxSignaling.get().sendRaw(t[0])}}},{key:"addEventListener",value:function e(n,r,a){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addEventListener",this).call(this,n,r,a)}},{key:"dispatchMsgEvent",value:function e(t,n){if(typeof this.eventListeners[t]!="undefined")for(var r=0;r<this.eventListeners[t].length;r++){if(this.eventListeners[t][r]&&typeof this.eventListeners[t][r].listener=="function"){this.eventListeners[t][r].listener(n.payload,n.request_uuid)}}}},{key:"handleWsData",value:function e(t){if(Object.values(d.MsgEvent).indexOf(t.event)!=-1)this.dispatchMsgEvent(t.event,t);else throw new Error("Unknown messaging event "+t.event+" with payload "+JSON.stringify(t.payload))}},{key:"sendWsMessage",value:function e(t,n){var r=["subscribe","unsubscribe","typingMessage","isRead","setStatus"].includes(t)?"CommonNamespace":"IncomingNamespace";var i={setStatus:"PresenceMessage",isRead:"StatusMessage",typingMessage:"TypingMessage",subscribe:"ManageSubscribes",unsubscribe:"ManageSubscribes",addParticipants:"ManageParticipants",editParticipants:"ManageParticipants",manageNotification:"ManageNotifications",getPublicConversations:"GetConversations",retransmitEvents:"RetransmitRequest"};var a=(new v.default).toString();var o={service:p.MsgService.Chat,event:t,payload:Object.assign(n,{"@type":"type/vox.store."+r+"."+(i[t]||this.capitalize(t))}),request_uuid:a};this.query.push(o);return a}},{key:"_traceName",value:function e(){return"MsgSignaling"}}],[{key:"get",value:function e(){t.instance=t.instance||new t;return t.instance}}]);return t}(g.EventTarget);l([u.LogManager.d_trace(u.LogCategory.MESSAGING)],h.prototype,"handleWsData",null);l([u.LogManager.d_trace(u.LogCategory.MESSAGING)],h.prototype,"sendWsMessage",null);t.MsgSignaling=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function a(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}Object.defineProperty(t,"__esModule",{value:true});var o=n(25);var s=n(34);var c=n(26);var l;(function(e){function t(){return n.getInstance()}e.get=t;var n=function(e){a(t,e);function t(){r(this,t);return i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return t}(o.Messenger);e.Messenger=n;var l=function(e){a(t,e);function t(){r(this,t);return i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return t}(s.Conversation);e.Conversation=l;var u=function(e){a(t,e);function t(){r(this,t);return i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return t}(c.Message);e.Message=u;var d=void 0;(function(e){e["UNKNOWN"]="UNKNOWN";e["createConversation"]="createConversation";e["editConversation"]="editConversation";e["removeConversation"]="removeConversation";e["joinConversation"]="joinConversation";e["leaveConversation"]="leaveConversation";e["getConversation"]="getConversation";e["getConversations"]="getConversations";e["getPublicConversations"]="getPublicConversations";e["searchConversations"]="searchConversations";e["removeEmptyConversation"]="removeEmptyConversation";e["addParticipants"]="addParticipants";e["editParticipants"]="editParticipants";e["removeParticipants"]="removeParticipants";e["getUser"]="getUser";e["getUsers"]="getUsers";e["editUser"]="editUser";e["setStatus"]="setStatus";e["sendMessage"]="sendMessage";e["editMessage"]="editMessage";e["removeMessage"]="removeMessage";e["typingMessage"]="typingMessage";e["isRead"]="isRead";e["subscribe"]="subscribe";e["unsubscribe"]="unsubscribe";e["manageNotification"]="manageNotification";e["getSubscriptionList"]="getSubscriptionList";e["createBot"]="createBot";e["removeBot"]="removeBot";e["retransmitEvents"]="retransmitEvents"})(d=e.MessengerAction||(e.MessengerAction={}));var f=void 0;(function(e){e["CreateConversation"]="CreateConversation";e["EditConversation"]="EditConversation";e["RemoveConversation"]="RemoveConversation";e["GetConversation"]="GetConversation";e["GetPublicConversations"]="GetPublicConversations";e["SendMessage"]="SendMessage";e["EditMessage"]="EditMessage";e["RemoveMessage"]="RemoveMessage";e["Typing"]="Typing";e["EditUser"]="EditUser";e["GetUser"]="GetUser";e["Error"]="Error";e["RetransmitEvents"]="RetransmitEvents";e["Read"]="Read";e["Subscribe"]="Subscribe";e["Unsubscribe"]="Unsubscribe";e["SetStatus"]="SetStatus";e["GetSubscriptionList"]="GetSubscriptionList";e["CreateBot"]="CreateBot";e["RemoveBot"]="RemoveBot"})(f=e.MessengerEvents||(e.MessengerEvents={}));var g=void 0;(function(e){e[e["Error_0"]=0]="Error_0";e[e["Error_1"]=1]="Error_1";e[e["Error_2"]=2]="Error_2";e[e["Error_3"]=3]="Error_3";e[e["Error_8"]=8]="Error_8";e[e["Error_10"]=10]="Error_10";e[e["Error_11"]=11]="Error_11";e[e["Error_12"]=12]="Error_12";e[e["Error_13"]=13]="Error_13";e[e["Error_15"]=15]="Error_15";e[e["Error_16"]=16]="Error_16";e[e["Error_18"]=18]="Error_18";e[e["Error_19"]=19]="Error_19";e[e["Error_21"]=21]="Error_21";e[e["Error_22"]=22]="Error_22";e[e["Error_23"]=23]="Error_23";e[e["Error_24"]=24]="Error_24";e[e["Error_25"]=25]="Error_25";e[e["Error_26"]=26]="Error_26";e[e["Error_28"]=28]="Error_28";e[e["Error_30"]=30]="Error_30";e[e["Error_32"]=32]="Error_32";e[e["Error_33"]=33]="Error_33";e[e["Error_34"]=34]="Error_34";e[e["Error_35"]=35]="Error_35";e[e["Error_36"]=36]="Error_36";e[e["Error_37"]=37]="Error_37";e[e["Error_38"]=38]="Error_38";e[e["Error_39"]=39]="Error_39";e[e["Error_40"]=40]="Error_40";e[e["Error_41"]=41]="Error_41";e[e["Error_42"]=42]="Error_42";e[e["Error_43"]=43]="Error_43";e[e["Error_500"]=500]="Error_500"})(g=e.MessengerError||(e.MessengerError={}))})(l=t.Messaging||(t.Messaging={}));t.default=l},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=n(1);var l=n(11);var u=n(4);var d=function(){function e(){a(this,e)}r(e,[{key:"_traceName",value:function e(){return"Logger"}}],[{key:"cadScript",value:function e(t){var n=t.split(";");return n.map(function(e){if(e.length===0){return}var t=e.match(/\([0-9\/\.,\*\+]*\)$/),n=e.substring(0,t.index),r=t.pop();if(t.length){throw new Error("cadence script should be of the form `%f(%f/%f[,%f/%f])`")}n=n==="*"?Infinity:parseFloat(n);if(isNaN(n)){throw new Error("cadence length should be of the form `%f`")}r=r.slice(1,r.length-1).split(",").map(function(e){try{var t=e.split("/");if(t.length>3){throw new Error}t=t.map(function(e,t){if(t===2){var n=e.split("+").map(function(e){var t=parseInt(e,10);if(isNaN(t)){throw new Error}return t-1});return n}var r;if(e=="*"){r=Infinity}r=r?r:parseFloat(e);if(isNaN(r)){throw new Error}return r});return{on:t[0],off:t[1],frequencies:t[2]}}catch(e){throw new Error("cadence segments should be of the form `%f/%f[%d[+%d]]`")}});return{duration:n,sections:r}})}},{key:"freqScript",value:function e(t){var n=t.split(",");return n.map(function(e){try{var t=e.split("@"),n=parseInt(t.shift()),r=parseFloat(t.shift());if(t.length){throw Error()}return{frequency:n,decibels:r}}catch(e){throw new Error("freqScript pairs are expected to be of the form `%d@%f[,%d@%f]`")}})}},{key:"toneScript",value:function e(t){var n=t.split(";"),r=this.freqScript(n.shift()),i=this.cadScript(n.join(";"));return{frequencies:r,cadences:i}}},{key:"playToneScript",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(typeof window["AudioContext"]!="undefined"||typeof window["webkitAudioContext"]!="undefined"){var r=u.default.AudioDeviceManager.get().getAudioContext();if(r===null)return;var i=this.toneScript(t),a=[],o=0;var s=function e(t){for(var n=0;n<r.sampleRate*t;n++){a.push(0)}};var c=function e(t,n){for(var o=0;o<r.sampleRate*n;o++){var s=0;for(var c=0;c<t.length;c++){s+=Math.pow(10,i.frequencies[t[c]].decibels/20)*Math.sin((a.length+o)*(3.14159265359/r.sampleRate)*i.frequencies[t[c]].frequency);if(o<10)s*=o/10;if(o>r.sampleRate*n-10)s*=(r.sampleRate*n-o)/10}a.push(s)}};var l=function e(t,n){if(n!=Infinity)var r=n;else r=n=20;if(t.off!==0&&t.off!=Infinity){while(r>0){c(t.frequencies,t.on);r-=t.on;s(t.off);r-=t.off;var i=r*10;r=parseInt(String(r*10))/10}}else{c(t.frequencies,n)}};var d=function e(t){if(t.duration!=Infinity)o+=t.duration;else o+=20;for(var n=0;n<t.sections.length;n++){l(t.sections[n],t.duration)}};this.source=r.createBufferSource();for(var f=0;f<i.cadences.length;f++){if(i.cadences[f].duration==Infinity)this.source.loop=true;d(i.cadences[f])}this.source.connect(r.destination);var g=r.createBuffer(1,o*r.sampleRate,r.sampleRate);var p=g.getChannelData(0);for(var v=0;v<o*r.sampleRate;v++){p[v]=a[v]}a=null;this.source.buffer=g;if(n===true)this.source.loop=true;this.source.start(0)}}},{key:"stopPlayback",value:function e(){if(typeof this.source!=="undefined"&&this.source!==null){this.source.stop(0);this.source=null;return true}return false}},{key:"getServers",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var n="https://balancer.voximplant.com/getNearestHost";return fetch(n).then(function(e){return e.text()})}},{key:"generateUUID",value:function e(){var t=this._gri,n=this._ha;return n(t(32),8)+"-"+n(t(16),4)+"-"+n(16384|t(12),4)+"-"+n(32768|t(14),4)+"-"+n(t(48),12)}},{key:"_gri",value:function e(t){if(t<0)return NaN;if(t<=30)return 0|Math.random()*(1<<t);if(t<=53)return(0|Math.random()*(1<<30))+(0|Math.random()*(1<<t-30))*(1<<30);return NaN}},{key:"_ha",value:function e(t,n){var r=t.toString(16),i=n-r.length,a="0";for(;i>0;i>>>=1,a+=a){if(i&1)r=a+r}return r}},{key:"checkCA",value:function e(){if(!c.Client.getInstance().connected())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(!l.Authenticator.get().authorized())throw new Error("NOT_AUTHORIZED")}},{key:"mixObjectToLeft",value:function e(t,n){for(var r in t){if(typeof n[r]=="undefined")continue;t[r]=n[r]}return t}},{key:"strFormat",value:function e(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++){r[i-1]=arguments[i]}return t.replace(/{(\d+)}/g,function(e,t){return typeof r[t]!="undefined"?r[t]:e})}}]);return e}();d.source=null;o([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"cadScript",null);o([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"freqScript",null);o([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"toneScript",null);o([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"playToneScript",null);o([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"stopPlayback",null);o([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"getServers",null);t.Utils=d},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var a=n(2);var o=n(3);var s=function(){function e(t){i(this,e);this._id=t}r(e,[{key:"insertDTMF",value:function e(t,n,r){var i=this;t.split("").forEach(function(e){return i.sendKey(e)})}},{key:"sendKey",value:function e(t){var n=void 0;if(t=="*")n=10;else if(t=="#")n=11;else{n=parseInt(t)}if(n>=0||n<=11)a.VoxSignaling.get().callRemoteFunction(o.RemoteFunction.sendDTMF,this._id,n)}},{key:"_traceName",value:function e(){return"SignalingDTMFSender"}}]);return e}();t.SignalingDTMFSender=s},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=n(2);var l=n(6);var u=n(12);var d=n(10);var f=n(3);var g=n(32);var p=n(1);var v=n(4);var h;(function(e){e[e["IDLE"]=0]="IDLE";e[e["REMOTEOFFER"]=1]="REMOTEOFFER";e[e["LOCALOFFER"]=2]="LOCALOFFER";e[e["ESTABLISHING"]=3]="ESTABLISHING";e[e["ESTABLISHED"]=4]="ESTABLISHED";e[e["CLOSED"]=5]="CLOSED"})(h=t.PeerConnectionState||(t.PeerConnectionState={}));var m;(function(e){e[e["CLIENT_SERVER_V1"]=0]="CLIENT_SERVER_V1";e[e["P2P"]=1]="P2P";e[e["CONFERENCE"]=2]="CONFERENCE"})(m=t.PeerConnectionMode||(t.PeerConnectionMode={}));var y=function(){function e(t,n,r){a(this,e);this.id=t;this.mode=n;this.videoEnabled=r;this.onHold=false;this.muteMicState=false;this.SEND_CANDIDATE_DELAY=1e3;this.mediaRepository=[];this.candidateList=[];this.localCandidateTimer=-1;this.logger=s.LogManager.get().createLogger(s.LogCategory.RTC,this._traceName()+" "+t);this.logger.info("PC created");this.state=h.IDLE;this.pendingCandidates=[];if(t!=="_default"&&l.CallManager.get().calls[t])this.reInviteQ=new g.ReInviteQ(l.CallManager.get().calls[t],this._canReInvite)}r(e,[{key:"getId",value:function e(){return this.id}},{key:"getState",value:function e(){return this.state}},{key:"processRemoteAnswer",value:function e(t,n){this.state=h.ESTABLISHING;return this._processRemoteAnswer(t,n)}},{key:"getLocalOffer",value:function e(){if(this.state===h.IDLE||this.state===h.ESTABLISHED||h.LOCALOFFER){this.logger.info("getLocalOffer()");this.state=h.LOCALOFFER;return this._getLocalOffer()}else{this.logger.error("getLocalOffer() in state "+h[this.state]);return new Promise(function(e,t){t("Invalid state")})}}},{key:"getLocalAnswer",value:function e(){return this._getLocalAnswer()}},{key:"processRemoteOffer",value:function e(t){if(this.state===h.IDLE||this.state===h.ESTABLISHED){this.state=h.ESTABLISHING;return this._processRemoteOffer(t)}else{this.logger.error("processRemoteOffer() in state "+h[this.state]);return new Promise(function(e,t){t("Invalid state")})}}},{key:"close",value:function e(){this.logger.info("close()");this._close()}},{key:"addRemoteCandidate",value:function e(t,n){this.logger.info("addRemoteCandidate("+t+", "+n+")");return this._addRemoteCandidate(t,n)}},{key:"handleReinvite",value:function e(t,n,r){return this._handleReinvite(t,n,r)}},{key:"addCandidateToSend",value:function e(t,n){this.pendingCandidates.push([n,t]);if(this.canSendCandidates)this.startCandidateSendTimer()}},{key:"canStartSendingCandidates",value:function e(){this.canSendCandidates=true;this.startCandidateSendTimer()}},{key:"sendDTMF",value:function e(t){var n=500;var r=50;this._sendDTMF(t,n,r)}},{key:"setVideoEnabled",value:function e(t){var n=this.videoEnabled.receiveVideo;this.videoEnabled=t;if(n!=t.receiveVideo){this._hold(this.onHold)}}},{key:"setVideoFlags",value:function e(t){this.videoEnabled=t}},{key:"getDirections",value:function e(){return this._getDirections()}},{key:"setHoldKey",value:function e(t){this.onHold=t}},{key:"getTrackKind",value:function e(){if(this._call){return v.default.StreamManager.get()._getTracksKind(this._call)}else return{}}},{key:"sendMedia",value:function e(t,n){var r=this;return new Promise(function(e,t){if(r.onHold){t({result:false,call:r._call});return}r.reInviteQ.add({fx:function e(){var t=p.Client.getInstance().config();v.default.StreamManager.get().updateCallStream(r._call)},reject:t,resolve:function t(n){r.restoreMute();e(n)}})})}},{key:"hold",value:function e(t){var n=this;return new Promise(function(e,r){if(n.onHold===t)e({call:n._call,name:"Updated",result:true});n.reInviteQ.add({fx:function e(){n._hold(t)},reject:r,resolve:function t(r){n.restoreMute();e(r)}})})}},{key:"hdnFRS",value:function e(){var t=this;return new Promise(function(e,n){if(t.onHold){n({result:false,call:t._call});return}t.reInviteQ.add({fx:function e(){t._hdnFRS()},reject:n,resolve:function n(r){t.restoreMute();e(r)}})})}},{key:"muteMicrophone",value:function e(t){var n=this;if(this.muteMicState===t)return;this.muteMicState=t;v.default.StreamManager.get().getCallStream(this._call).then(function(e){e.getAudioTracks().forEach(function(e){e.enabled=!n.muteMicState})})}},{key:"restoreMute",value:function e(){var t=this;if(this._call.settings.active){var n=this;setTimeout(function(){if(t._call.settings.state!==u.CallState.ENDED){t._call.restoreRMute();v.default.StreamManager.get().getCallStream(t._call).then(function(e){e.getAudioTracks().forEach(function(e){e.enabled=!n.muteMicState})})}},300)}}},{key:"restoreVideoSending",value:function e(){var t=this;if(this._call.settings.active){setTimeout(function(){if(t._call.settings.state!==u.CallState.ENDED){t.enableVideo(t._call.settings.videoDirections.sendVideo)}},0)}}},{key:"addCustomMedia",value:function e(t){var n=this;return new Promise(function(e,r){n.reInviteQ.add({fx:function e(){n._addCustomMedia(t)},reject:r,resolve:function t(r){n.restoreMute();e()}})})}},{key:"fastAddCustomMedia",value:function e(t){this._addCustomMedia(t)}},{key:"fastRemoveCustomMedia",value:function e(t){this._removeCustomMedia(t)}},{key:"removeCustomMedia",value:function e(t){var n=this;return new Promise(function(e,r){n.reInviteQ.add({fx:function e(){n._removeCustomMedia(t)},reject:r,resolve:function t(r){n.restoreMute();e()}})})}},{key:"updateCustomMedia",value:function e(t){this._updateCustomMedia(t)}},{key:"setState",value:function e(t){this.logger.info("Transmitting from "+h[this.state]+" to "+h[t]);this.state=t}},{key:"sendLocalCandidateToPeer",value:function e(t,n){var r=this;this._call=l.CallManager.get().calls[this.id];if(this.mode===m.CLIENT_SERVER_V1){c.VoxSignaling.get().callRemoteFunction(f.RemoteFunction.addCandidate,this.id,t,n)}else{this.candidateList.push([n,t]);if(this.localCandidateTimer<=0){this.localCandidateTimer=window.setTimeout(function(){window.clearTimeout(r.localCandidateTimer);r.localCandidateTimer=-1;if(l.CallManager.get().calls[r.id])l.CallManager.get().calls[r.id].sendInfo(d.Constants.P2P_SPD_FRAG_MIME_TYPE,JSON.stringify(r.candidateList),{});r.candidateList=[]},200)}}}},{key:"startCandidateSendTimer",value:function e(){var t=this;if(this.candidateSendTimer===null||typeof this.candidateSendTimer==="undefined"){this.candidateSendTimer=setTimeout(function(){t.candidateSendTimer=null;if(t.pendingCandidates.length>0){if(l.CallManager.get().calls[t.id])l.CallManager.get().calls[t.id].sendInfo(d.Constants.P2P_SPD_FRAG_MIME_TYPE,JSON.stringify(t.pendingCandidates),{})}t.pendingCandidates=[]},this.SEND_CANDIDATE_DELAY)}}},{key:"_traceName",value:function e(){return"PeerConnection"}},{key:"remoteStreams",get:function e(){return this._remoteStreams}}]);return e}();o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"getState",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"processRemoteAnswer",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"getLocalOffer",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"getLocalAnswer",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"processRemoteOffer",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"close",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"addRemoteCandidate",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"handleReinvite",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"addCandidateToSend",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"canStartSendingCandidates",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"sendDTMF",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"setVideoEnabled",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"setVideoFlags",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"setHoldKey",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"getTrackKind",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"sendMedia",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"hold",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"hdnFRS",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"muteMicrophone",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"restoreMute",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"restoreVideoSending",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"addCustomMedia",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"fastAddCustomMedia",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"fastRemoveCustomMedia",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"removeCustomMedia",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"updateCustomMedia",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"setState",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"sendLocalCandidateToPeer",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],y.prototype,"startCandidateSendTimer",null);t.PeerConnection=y},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var a=n(8);var o=n(52);var s=n(53);var c=function(){function e(){i(this,e);throw new Error("Please, use the EndpointManager.get() instead create new object")}r(e,null,[{key:"get",value:function t(){if(typeof this.instance=="undefined"){if(a.PCFactory.hasTransceivers)e.instance=new o.TransceiversEndpointManager;else e.instance=new s.PlainEndpointManager}return this.instance}}]);return e}();t.EndpointManager=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e["onError"]="onError";e["onCreateConversation"]="onCreateConversation";e["onEditConversation"]="onEditConversation";e["onRemoveConversation"]="onRemoveConversation";e["onGetConversation"]="onGetConversation";e["onGetPublicConversations"]="onGetPublicConversations";e["onGetUser"]="onGetUser";e["onEditUser"]="onEditUser";e["onSetStatus"]="onSetStatus";e["onSendMessage"]="onSendMessage";e["onEditMessage"]="onEditMessage";e["onRemoveMessage"]="onRemoveMessage";e["isRead"]="isRead";e["onTyping"]="onTyping";e["onSubscribe"]="onSubscribe";e["onUnsubscribe"]="onUnsubscribe";e["onGetSubscriptionList"]="onGetSubscriptionList";e["onCreateBot"]="onCreateBot";e["onRemoveBot"]="onRemoveBot";e["onRetransmitEvents"]="onRetransmitEvents"})(r=t.MsgEvent||(t.MsgEvent={}))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=n(18);var l=n(24);var u=n(44);var d=n(34);var f=n(26);var g=n(19);var p=n(11);var v=n(45);var h=n(27);var m={0:"Something went wrong. Please check your input or required parameters."};var y=function(){function e(){var t=this;a(this,e);if(e.instance)throw new Error(v.MESSAGING_ERR_1);this.eventListeners={};this.awaitPromiseList={};this.cm=u.default.get();this.signalling=c.MsgSignaling.get();this.signalling.addEventListener(l.MsgEvent.onError,function(e,n){t._dispatchEvent(g.default.MessengerEvents.Error,{initiator:t.currentUserId,code:e.code,description:e.description,messengerAction:g.default.MessengerAction[e.on_incoming_event],timestamp:typeof e.timestamp=="number"?e.timestamp*1e3:undefined,requestUuid:n},n)});this.signalling.addEventListener(l.MsgEvent.onEditUser,function(e,n){t._dispatchEvent(g.default.MessengerEvents.EditUser,{user:{userId:Number(e.object.user_id),userName:e.object.user_name,displayName:e.object.display_name,conversationsList:e.object.conversations_list,notificationEvents:e.object.notification_events?e.object.notification_events.map(t.msgEventToMessengerEvent):undefined,customData:e.object.custom_data,privateCustomData:e.object.private_custom_data},initiator:Number(e.initiator),messengerAction:g.default.MessengerAction[e.on_incoming_event],timestamp:typeof e.timestamp=="number"?e.timestamp*1e3:undefined,requestUuid:n},n)});this.signalling.addEventListener(l.MsgEvent.onGetUser,function(e,n){t._dispatchEvent(g.default.MessengerEvents.GetUser,{user:{userId:Number(e.object.user_id),userName:e.object.user_name,displayName:e.object.display_name,conversationsList:e.object.conversations_list,notificationEvents:e.object.notification_events?e.object.notification_events.map(t.msgEventToMessengerEvent):undefined,customData:e.object.custom_data,privateCustomData:e.object.private_custom_data},initiator:Number(e.initiator),messengerAction:g.default.MessengerAction[e.on_incoming_event],requestUuid:n},n)});this.signalling.addEventListener(l.MsgEvent.onSetStatus,function(e,n){t._dispatchEvent(g.default.MessengerEvents.SetStatus,{online:e.object.online,initiator:Number(e.initiator),messengerAction:g.default.MessengerAction[e.on_incoming_event],timestamp:typeof e.timestamp=="number"?e.timestamp*1e3:undefined,requestUuid:n},n)});this.signalling.addEventListener(l.MsgEvent.onSubscribe,function(e,n){t._dispatchEvent(g.default.MessengerEvents.Subscribe,{users:e.object.user_id,initiator:Number(e.initiator),messengerAction:g.default.MessengerAction[e.on_incoming_event],requestUuid:n},n)});this.signalling.addEventListener(l.MsgEvent.onUnsubscribe,function(e,n){t._dispatchEvent(g.default.MessengerEvents.Unsubscribe,{users:e.object.user_id,initiator:Number(e.initiator),messengerAction:g.default.MessengerAction[e.on_incoming_event],requestUuid:n},n)});this.signalling.addEventListener(l.MsgEvent.onGetSubscriptionList,function(e,n){t._dispatchEvent(g.default.MessengerEvents.GetSubscriptionList,{users:e.object.subscriptions,initiator:Number(e.initiator),messengerAction:g.default.MessengerAction[e.on_incoming_event],requestUuid:n},n)})}r(e,[{key:"addEventListener",value:function e(t,n){if(typeof this.eventListeners[t]==="undefined")this.eventListeners[t]=[];this.eventListeners[t].push(n)}},{key:"removeEventListener",value:function e(t,n){if(typeof this.eventListeners[t]==="undefined")return;if(typeof n==="function"){for(var r=0;r<this.eventListeners[t].length;r++){if(this.eventListeners[t][r]===n){this.eventListeners[t].splice(r,1);break}}}else{this.eventListeners[t]=[]}}},{key:"on",value:function e(t,n){this.addEventListener(t,n)}},{key:"off",value:function e(t,n){this.removeEventListener(t,n)}},{key:"_dispatchEvent",value:function e(t,n,r){if(typeof this.eventListeners[t]!=="undefined")this.eventListeners[t].forEach(function(e){if(typeof e==="function")e(n)});if(r&&typeof this.awaitPromiseList[r]!=="undefined"){if(t===g.default.MessengerEvents.Error&&typeof this.awaitPromiseList[r].reject==="function")this.awaitPromiseList[r].reject(n);if(typeof this.awaitPromiseList[r].resolve==="function")this.awaitPromiseList[r].resolve(n);window.clearTimeout(this.awaitPromiseList[r].expire)}if(typeof this.eventListeners[t]==="undefined"||this.eventListeners[t].length==0){s.LogManager.get().writeMessage(s.LogCategory.MESSAGING,"",s.LogLevel.INFO,"The "+t+" event dispatched, but no handler registered for this event type.")}}},{key:"_registerPromise",value:function t(n,r,i){this.awaitPromiseList[n]={resolve:r,reject:i,expire:window.setTimeout(i,e.rejectTimeout)}}},{key:"getConversation",value:function e(t){return this.cm.getConversation(t)}},{key:"getConversations",value:function e(t){if(Array.isArray(t)&&t.length>30){s.LogManager.get().writeMessage(s.LogCategory.MESSAGING,"Rate limit",s.LogLevel.ERROR,"you can get maximum 30 conversation in a single getConversations call");return}return this.cm.getConversations(t)}},{key:"getPublicConversations",value:function e(){return this.cm.getPublicConversations()}},{key:"getRawConversations",value:function e(t){return this.cm.getConversations(t)}},{key:"createConversation",value:function e(t,n,r,i,a,o){return this.cm.createConversation(t,n,r,i,a,o)}},{key:"createConversationFromCache",value:function e(t){if(!t||(typeof t==="undefined"?"undefined":i(t))!=="object")return null;return d.Conversation.createFromCache(t)}},{key:"joinConversation",value:function t(n){var r=this;return new Promise(function(t,i){var a=r.signalling.sendWsMessage(h.MsgAction.joinConversation,{uuid:n});e.getInstance()._registerPromise(a,t,i)})}},{key:"leaveConversation",value:function t(n){var r=this;return new Promise(function(t,i){var a=r.signalling.sendWsMessage(h.MsgAction.leaveConversation,{uuid:n});e.getInstance()._registerPromise(a,t,i)})}},{key:"getMe",value:function e(){return u.default.extractUserName(p.Authenticator.get().username())}},{key:"getMyId",value:function e(){if(this.currentUserId){return Promise.resolve(this.currentUserId)}else{return this.getUser(this.getMe()).then(function(e){return e.user.userId})}}},{key:"getUser",value:function t(n){var r=this;return new Promise(function(t,i){var a=void 0;var o=function e(n){if(n.requestUuid===a){clearTimeout(c);r.off(g.default.MessengerEvents.GetUser,e);r.off(g.default.MessengerEvents.Error,s);if(n.user.userName===r.getMe()){r.currentUserId=Number(n.user.userId)}t(n)}};var s=function e(t){if(t.requestUuid===a){clearTimeout(c);r.off(g.default.MessengerEvents.GetUser,o);r.off(g.default.MessengerEvents.Error,e);i(t)}};var c=setTimeout(function(){e.getInstance().off(g.default.MessengerEvents.GetUser,o);e.getInstance().off(g.default.MessengerEvents.Error,s);e.getInstance().reject(g.default.MessengerError.Error_0,g.default.MessengerAction.getUser).catch(i)},e.rejectTimeout);r.on(g.default.MessengerEvents.GetUser,o);r.on(g.default.MessengerEvents.Error,s);a=r.signalling.sendWsMessage(h.MsgAction.getUser,{user_name:n})})}},{key:"getUserById",value:function t(n){var r=this;return new Promise(function(t,i){var a=r.signalling.sendWsMessage(h.MsgAction.getUser,{user_id:n});e.getInstance()._registerPromise(a,t,i)})}},{key:"getUsers",value:function t(n){if(!Array.isArray(n))return e.getInstance().reject(g.default.MessengerError.Error_0,g.default.MessengerAction.getUsers);var r=void 0;var i=Promise.all(n.map(function(t){return new Promise(function(n,i){var a=function i(a){if(a.requestUuid===r&&a.user.userName===t){clearTimeout(s);e.getInstance().off(g.default.MessengerEvents.GetUser,i);e.getInstance().off(g.default.MessengerEvents.Error,o);n(a)}};var o=function t(n){if(n.requestUuid===r){clearTimeout(s);e.getInstance().off(g.default.MessengerEvents.GetUser,a);e.getInstance().off(g.default.MessengerEvents.Error,t);i(n)}};var s=setTimeout(function(){e.getInstance().off(g.default.MessengerEvents.GetUser,a);e.getInstance().off(g.default.MessengerEvents.Error,o);e.getInstance().reject(g.default.MessengerError.Error_0,g.default.MessengerAction.getUsers).catch(i)},e.rejectTimeout);e.getInstance().on(g.default.MessengerEvents.GetUser,a);e.getInstance().on(g.default.MessengerEvents.Error,o)})}));r=this.signalling.sendWsMessage(h.MsgAction.getUsers,{users:n.map(function(e){return{user_name:e}})});return i}},{key:"getUsersById",value:function t(n){if(!Array.isArray(n))return e.getInstance().reject(g.default.MessengerError.Error_0,g.default.MessengerAction.getUsers);var r=void 0;var i=Promise.all(n.map(function(t){return new Promise(function(n,i){var a=function i(a){if(a.requestUuid===r&&a.user.userId===t){clearTimeout(s);e.getInstance().off(g.default.MessengerEvents.GetUser,i);e.getInstance().off(g.default.MessengerEvents.Error,o);n(a)}};var o=function t(n){if(n.requestUuid===r){clearTimeout(s);e.getInstance().off(g.default.MessengerEvents.GetUser,a);e.getInstance().off(g.default.MessengerEvents.Error,t);i(n)}};var s=setTimeout(function(){e.getInstance().off(g.default.MessengerEvents.GetUser,a);e.getInstance().off(g.default.MessengerEvents.Error,o);e.getInstance().reject(g.default.MessengerError.Error_0,g.default.MessengerAction.getUsers).catch(i)},e.rejectTimeout);e.getInstance().on(g.default.MessengerEvents.GetUser,a);e.getInstance().on(g.default.MessengerEvents.Error,o)})}));r=this.signalling.sendWsMessage(h.MsgAction.getUsers,{users:n.map(function(e){return{user_id:e}})});return i}},{key:"editUser",value:function t(n,r){var i=this;var a={};if(n)a.custom_data=n;if(r)a.private_custom_data=r;return new Promise(function(t,n){var r=i.signalling.sendWsMessage(h.MsgAction.editUser,a);e.getInstance()._registerPromise(r,t,n)})}},{key:"setStatus",value:function t(n){var r=this;return new Promise(function(t,i){var a=r.signalling.sendWsMessage(h.MsgAction.setStatus,{online:n});e.getInstance()._registerPromise(a,t,i)})}},{key:"subscribe",value:function t(n){var r=this;return new Promise(function(t,i){var a=r.signalling.sendWsMessage(h.MsgAction.subscribe,{user_id:n});e.getInstance()._registerPromise(a,t,i)})}},{key:"unsubscribe",value:function t(n,r){var i=this;return new Promise(function(t,a){var o=i.signalling.sendWsMessage(h.MsgAction.unsubscribe,{user_id:n,all:r});e.getInstance()._registerPromise(o,t,a)})}},{key:"getSubscriptionList",value:function t(){var n=this;return new Promise(function(t,r){var i=n.signalling.sendWsMessage(h.MsgAction.getSubscriptionList,{});e.getInstance()._registerPromise(i,t,r)})}},{key:"manageNotification",value:function t(n){var r=this;return new Promise(function(t,i){var a=r.signalling.sendWsMessage(h.MsgAction.manageNotification,{notifications:n.map(function(e){return e===g.default.MessengerEvents.CreateConversation?l.MsgEvent.onCreateConversation:e===g.default.MessengerEvents.SendMessage?l.MsgEvent.onSendMessage:e===g.default.MessengerEvents.EditMessage?l.MsgEvent.onEditMessage:undefined})});e.getInstance()._registerPromise(a,t,i)})}},{key:"createMessageFromCache",value:function e(t){if(!t||(typeof t==="undefined"?"undefined":i(t))!=="object")return null;return f.Message.createFromCache(t)}},{key:"reject",value:function e(t,n){var r={code:t,description:m[t],initiator:this.currentUserId,messengerAction:n};this._dispatchEvent(g.default.MessengerEvents.Error,r);return Promise.reject(r)}},{key:"msgEventToMessengerEvent",value:function e(t){return t===l.MsgEvent.onCreateConversation?g.default.MessengerEvents.CreateConversation:t===l.MsgEvent.onSendMessage?g.default.MessengerEvents.SendMessage:t===l.MsgEvent.onEditMessage?g.default.MessengerEvents.EditMessage:t}},{key:"_traceName",value:function e(){return"Messenger"}}],[{key:"getInstance",value:function t(){e.instance=e.instance||new e;return e.instance}}]);return e}();y.rejectTimeout=2e4;o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"addEventListener",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"removeEventListener",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"on",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"off",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"_dispatchEvent",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"_registerPromise",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getConversation",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getConversations",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getPublicConversations",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getRawConversations",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"createConversation",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"createConversationFromCache",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"joinConversation",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"leaveConversation",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getMe",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getMyId",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getUser",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getUserById",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getUsers",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getUsersById",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"editUser",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"setStatus",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"subscribe",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"unsubscribe",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getSubscriptionList",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"manageNotification",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"createMessageFromCache",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y,"getInstance",null);t.Messenger=y},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=n(18);var l=n(27);var u=n(25);var d=function(){function e(t,n){a(this,e);this._text=t;if(typeof n!=="undefined"&&Array.isArray(n)&&n.every(function(e){return e&&(typeof e==="undefined"?"undefined":i(e))==="object"}))this._payload=n;else this._payload=[]}r(e,[{key:"toCache",value:function e(){return{uuid:this._uuid,text:this._text,payload:this._payload,conversation:this._conversation,sender:this._sender}}},{key:"getPayload",value:function e(){var t={text:this._text,conversation:this._conversation};if(typeof this._payload!=="undefined"&&Array.isArray(this._payload)&&this._payload.every(function(e){return(typeof e==="undefined"?"undefined":i(e))==="object"}))t.payload=this._payload;else t.payload=[];return t}},{key:"sendTo",value:function e(t){var n=this;this._conversation=t.uuid;return new Promise(function(e,t){var r=c.MsgSignaling.get().sendWsMessage(l.MsgAction.sendMessage,n.getPayload());u.Messenger.getInstance()._registerPromise(r,e,t)})}},{key:"update",value:function e(){var t=this;return new Promise(function(e,n){var r=c.MsgSignaling.get().sendWsMessage(l.MsgAction.editMessage,Object.assign(t.getPayload(),{uuid:t._uuid}));u.Messenger.getInstance()._registerPromise(r,e,n)})}},{key:"remove",value:function e(){var t=this;return new Promise(function(e,n){var r=c.MsgSignaling.get().sendWsMessage(l.MsgAction.removeMessage,{uuid:t._uuid,conversation:t.conversation});u.Messenger.getInstance()._registerPromise(r,e,n)})}},{key:"_traceName",value:function e(){return"Message"}},{key:"uuid",get:function e(){return this._uuid}},{key:"conversation",get:function e(){return this._conversation}},{key:"text",get:function e(){return this._text},set:function e(t){this._text=t}},{key:"payload",get:function e(){return this._payload},set:function e(t){this._payload=t}},{key:"sender",get:function e(){return this._sender}}],[{key:"_createFromBus",value:function t(n,r){var i=new e(n.text,n.payload);i._uuid=n.uuid;i._conversation=n.conversation;i._sender=r;return i}},{key:"createFromCache",value:function t(n){var r=new e(n.text,n.payload);r._uuid=n.uuid;r._conversation=n.conversation;r._sender=Number(n.sender);return r}}]);return e}();o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],d.prototype,"toCache",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],d.prototype,"getPayload",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],d.prototype,"sendTo",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],d.prototype,"update",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],d.prototype,"remove",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],d,"_createFromBus",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],d,"createFromCache",null);t.Message=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e["UNKNOWN"]="UNKNOWN";e["createConversation"]="createConversation";e["editConversation"]="editConversation";e["removeConversation"]="removeConversation";e["joinConversation"]="joinConversation";e["leaveConversation"]="leaveConversation";e["getConversation"]="getConversation";e["getConversations"]="getConversations";e["getPublicConversations"]="getPublicConversations";e["searchConversations"]="searchConversations";e["removeEmptyConversation"]="removeEmptyConversation";e["addParticipants"]="addParticipants";e["editParticipants"]="editParticipants";e["removeParticipants"]="removeParticipants";e["getUser"]="getUser";e["getUsers"]="getUsers";e["editUser"]="editUser";e["setStatus"]="setStatus";e["sendMessage"]="sendMessage";e["editMessage"]="editMessage";e["removeMessage"]="removeMessage";e["typingMessage"]="typingMessage";e["isRead"]="isRead";e["subscribe"]="subscribe";e["unsubscribe"]="unsubscribe";e["manageNotification"]="manageNotification";e["getSubscriptionList"]="getSubscriptionList";e["createBot"]="createBot";e["removeBot"]="removeBot";e["retransmitEvents"]="retransmitEvents"})(r=t.MsgAction||(t.MsgAction={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e[e["Offline"]="OFFLINE"]="Offline";e[e["Online"]="ONLINE"]="Online";e[e["Ready"]="READY"]="Ready";e[e["InService"]="IN_SERVICE"]="InService";e[e["AfterService"]="AFTER_SERVICE"]="AfterService";e[e["Timeout"]="TIMEOUT"]="Timeout";e[e["DND"]="DND"]="DND"})(r=t.OperatorACDStatuses||(t.OperatorACDStatuses={}))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,n,r)}}else if("value"in i){return i.value}else{var o=i.get;if(o===undefined){return undefined}return o.call(r)}};var a=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,o=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":a(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o}return i>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var u=n(0);var d=n(4);var f=n(15);var g=n(36);var p=n(7);var v=n(14);var h=n(1);var m=n(35);var y=n(37);var C=function(e){c(t,e);function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(typeof t.instance!=="undefined")throw new Error("Error - use StreamManager.get()");e._callStreams={};e._localMediaRenderers=[];e._sharingStreams={};e.logger=u.LogManager.get().createLogger(u.LogCategory.HARDWARE,e._traceName());return e}r(t,[{key:"getMirrorStream",value:function e(){var t=this;if(h.Client.getInstance().config().experiments&&h.Client.getInstance().config().experiments.customMirrorMedia){return new Promise(function(e,n){h.Client.getInstance().config().experiments.customMirrorMedia({videoSettings:g.CameraManager.get().getDefaultVideoSettings()}).then(function(n){t._mirrorStream=n;t._mirrorStream.getTracks().forEach(function(e){e.onended=function(){t.onMirrorEnded()};e.onmute=function(){t.onMirrorEnded}});e(n)}).catch(function(e){n(e)})})}return new Promise(function(e,n){if(typeof t._mirrorStream!=="undefined"){if(t._mirrorStream.active){e(t._mirrorStream);return}}if(p.default.isIphone()){return d.default.IOSCacheManager.get().getStream({video:g.CameraManager.get().getCallConstraints("__local__"),audio:m.AudioDeviceManager.get().getCallConstraints("__local__")}).then(function(n){t._mirrorStream=n;t._mirrorStream.getTracks().forEach(function(e){e.onended=function(){t.onMirrorEnded()};e.onmute=function(){t.onMirrorEnded}});e(n)},n)}else{return navigator.mediaDevices.getUserMedia({video:g.CameraManager.get().getCallConstraints("__local__")}).then(function(n){t.logger.info("Media access granted");t._mirrorStream=n;t._mirrorStream.getTracks().forEach(function(e){e.onended=function(){t.onMirrorEnded()};e.onmute=function(){t.onMirrorEnded}});e(n)}).catch(function(e){t.logger.error("Media access denied: "+(e?e.message||e.name||e:"unknown"))})}})}},{key:"remMirrorStream",value:function e(){if(!p.default.isIphone()){if(typeof this._mirrorStream==="undefined")return;this._mirrorStream.getTracks().forEach(function(e){e.onended=undefined;e.onmute=undefined;e.stop()});this._mirrorStream=undefined}}},{key:"getCallStream",value:function e(t){var n=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(h.Client.getInstance().config().experiments&&h.Client.getInstance().config().experiments.customCallMedia){return new Promise(function(e,r){var i=false;var a=m.AudioDeviceManager.get().getDefaultAudioSettings();if(t){i=t.settings.videoDirections&&t.settings.videoDirections.sendVideo?g.CameraManager.get().getCallVideoSettings(t):false;a=m.AudioDeviceManager.get().getCallAudioSettings(t)}var o={call:t,audioSettings:a,videoSettings:i};n.logger.info("[constraints]: "+JSON.stringify(o));h.Client.getInstance().config().experiments.customCallMedia(o).then(function(t){n.logger.info("Media access granted");h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:true,stream:t});e(t)}).catch(function(e){n.logger.error("Media access denied: "+(e?e.message||e.name||e:"unknown"));h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:false,stream:null});r(e)})})}return new Promise(function(e,i){var a=typeof t==="undefined"?"__default":t.id();if(n._callStreams[a]&&!r){e(n._callStreams[a])}else{var o=n._composeConstraints(t);n.logger.info("[constraints]: "+JSON.stringify(o));if(!o.audio&&!o.video&&a!=="__default"){e(null);return}if(p.default.getWSVendor()!=="firefox"){if(p.default.isIphone()){d.default.IOSCacheManager.get().getStream(o).then(function(t){n._callStreams[a]=t;t.getTracks().forEach(function(e){e.onended=n.onCallEnded;e.onmute=n.onCallEnded});h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:true,stream:t});e(t)})}else{navigator.mediaDevices.getUserMedia(o).then(function(t){n.logger.info("Media access granted");n._callStreams[a]=t;t.getTracks().forEach(function(e){e.onended=n.onCallEnded;e.onmute=n.onCallEnded});h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:true,stream:t});e(t)},function(r){if(r.name==="NotFoundError"){var s={audio:true};n.logger.info("[backup constraints]: "+JSON.stringify(o));if(typeof t!=="undefined"){t.settings.videoDirections.sendVideo=false;s=n._composeConstraints(t)}navigator.mediaDevices.getUserMedia(s).then(function(t){n.logger.info("Media access granted");n._callStreams[a]=t;t.getTracks().forEach(function(e){e.onended=n.onCallEnded;e.onmute=n.onCallEnded});h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:true,stream:t});e(t)},function(e){n.logger.error("Media access denied: "+(e?e.message||e.name||e:"unknown"));h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:false,stream:null});i(e)})}else{n.logger.error("Media access denied: "+(r?r.message||r.name||r:"unknown"));h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:false,stream:null});i(r)}})}}else{var s=null;var c=null;if(o.audio){s={audio:o.audio}}if(o.video){c={video:o.video}}navigator.mediaDevices.getUserMedia(s).then(function(t){n.logger.info("Audio access granted");if(!c){n._callStreams[a]=t;t.getTracks().forEach(function(e){e.onended=n.onCallEnded;e.onmute=n.onCallEnded});h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:true,stream:t});e(t)}else{navigator.mediaDevices.getUserMedia(c).then(function(r){n.logger.info("Video access granted");var i=new MediaStream;t.getTracks().forEach(function(e){i.addTrack(e)});r.getTracks().forEach(function(e){i.addTrack(e)});n._callStreams[a]=i;i.getTracks().forEach(function(e){e.onended=n.onCallEnded;e.onmute=n.onCallEnded});h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:true,stream:i});e(i)},function(r){n.logger.error("Video access denied: "+(r?r.message||r.name||r:"unknown"));n._callStreams[a]=t;t.getTracks().forEach(function(e){e.onended=n.onCallEnded;e.onmute=n.onCallEnded});h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:true,stream:t});e(t)})}},function(e){n.logger.error("Audio access denied: "+(e?e.message||e.name||e:"unknown"));h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:false,stream:null});i(e)})}}})}},{key:"_updateCallStream",value:function e(t){this.remCallStream(t);return this.getCallStream(t)}},{key:"updateCallStream",value:function e(t){var n=this;this.logger.info("Updating call "+t.id()+" stream");return new Promise(function(e,r){var i=n._callStreams[t.id()];n.getCallStream(t,true).then(function(e){var r=i.getTracks();var a=e.getTracks();var o=r.map(function(e){return e.kind}).sort();var s=a.map(function(e){return e.kind}).sort();if(r.length===a.length&&o.every(function(e,t){return e===s[t]}))return t.peerConnection.updateCustomMedia(e);else{t.peerConnection.fastRemoveCustomMedia(i);n._remCallStream(i);return t.peerConnection.addCustomMedia(e)}}).then(e).catch(r)})}},{key:"remCallStream",value:function e(t){var n=typeof t==="undefined"?"__default":t.id();if(this._callStreams[n]){this._remCallStream(this._callStreams[n]);this._callStreams[n]=undefined;delete this._callStreams[n]}}},{key:"_remCallStream",value:function e(t){if(!t)return;if(p.default.isIphone())return;t.getTracks().forEach(function(e){e.onended=undefined;e.onmute=undefined;e.stop();t.removeTrack(e)})}},{key:"clear",value:function e(){if(this._mirrorStream){this._mirrorStream.getTracks().forEach(function(e){e.onended=undefined;e.onmute=undefined;e.stop()})}this._mirrorStream=undefined;for(var t in this._callStreams){if(this._callStreams.hasOwnProperty(t)){var n=this._callStreams[t];if(n){n.getTracks().forEach(function(e){e.onended=undefined;e.onmute=undefined;e.stop()})}}}this._callStreams={}}},{key:"getLocalMediaRenderers",value:function e(){return this._localMediaRenderers}},{key:"showLocalVideo",value:function e(){var t=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this._mirrorMediaRendererId)throw new Error("Local video already displayed. Please, use Hardware.StreamManager.get().hideLocalVideo "+"before request a new one.");else{return new Promise(function(e,r){d.default.StreamManager.get().getMirrorStream().then(function(r){var i=new y.MediaRenderer(r,"video",n,true,"voximplantlocalvideo");t._localMediaRenderers.push(i);t._mirrorMediaRendererId=i.id;e(i);t.dispatchEvent({name:d.default.HardwareEvents.MediaRendererAdded,renderer:i})}).catch(r)})}}},{key:"hideLocalVideo",value:function e(){var t=this;if(!this._mirrorMediaRendererId)throw new Error("Local video not displayed yet. Please, use Hardware.StreamManager.get().showLocalVideo "+"to request a new one.");else{return new Promise(function(e,n){var r=t._localMediaRenderers.filter(function(e){return e.id===t._mirrorMediaRendererId});if(r)r.forEach(function(e){e.clear()});t.remMirrorStream();t._localMediaRenderers=t._localMediaRenderers.filter(function(e){return e.id!==t._mirrorMediaRendererId});t._mirrorMediaRendererId=undefined;e()})}}},{key:"on",value:function e(n,r,a){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,n,r)}},{key:"off",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"off",this).call(this,n,r)}},{key:"_newScreenSharing",value:function e(t,n){var r=this;if(h.Client.getInstance().config().experiments&&h.Client.getInstance().config().experiments.customScreenMedia){return new Promise(function(e,i){h.Client.getInstance().config().experiments.customScreenMedia({call:t}).then(function(i){var a={stream:i,renderer:null};if(n){var o=new y.MediaRenderer(i,"sharing",true,true);a.renderer=o;r.dispatchEvent({name:d.default.HardwareEvents.MediaRendererAdded,renderer:o});o.onBeforeDestroy=function(){a.renderer=null;r._sharingStreams[t.id()]=r._sharingStreams[t.id()].filter(function(e){return e.stream.id!==i.id});t.peerConnection.removeCustomMedia(a.stream).then(function(){a.stream=undefined})}}else{i.getTracks().forEach(function(e){e.onended=function(){if(!i.getTracks().some(function(e){return e.readyState==="live"})){r._sharingStreams[t.id()]=r._sharingStreams[t.id()].filter(function(e){return e.stream.id!==i.id});t.peerConnection.removeCustomMedia(a.stream).then(function(){a.stream=undefined})}}})}if(typeof r._sharingStreams[t.id()]==="undefined"){r._sharingStreams[t.id()]=[]}r._sharingStreams[t.id()].push(a);e(a)}).catch(function(e){i(e)})})}return new Promise(function(e,i){p.default.getScreenMedia().then(function(i){r.logger.info("Media access granted");var a={stream:i,renderer:null};if(n){var o=new y.MediaRenderer(i,"sharing",true,true);a.renderer=o;r.dispatchEvent({name:d.default.HardwareEvents.MediaRendererAdded,renderer:o});o.onBeforeDestroy=function(){a.renderer=null;r._sharingStreams[t.id()]=r._sharingStreams[t.id()].filter(function(e){return e.stream.id!==i.id});t.peerConnection.removeCustomMedia(a.stream).then(function(){a.stream=undefined})}}else{i.getTracks().forEach(function(e){e.onended=function(){if(!i.getTracks().some(function(e){return e.readyState==="live"})){r._sharingStreams[t.id()]=r._sharingStreams[t.id()].filter(function(e){return e.stream.id!==i.id});t.peerConnection.removeCustomMedia(a.stream).then(function(){a.stream=undefined})}}})}if(typeof r._sharingStreams[t.id()]==="undefined"){r._sharingStreams[t.id()]=[]}r._sharingStreams[t.id()].push(a);e(a)}).catch(function(e){r.logger.error("Media access denied: "+(e?e.message||e.name||e:"unknown"));i(e)})})}},{key:"_getScreenSharing",value:function e(t){if(typeof this._sharingStreams[t.id()]!=="undefined")return this._sharingStreams[t.id()];else return[]}},{key:"_clearScreenSharing",value:function e(t,n){var r=this;return new Promise(function(e,i){r._sharingStreams[t.id()]=r._sharingStreams[t.id()].filter(function(e){return e.stream.id!==n.stream.id});if(n.renderer){r.dispatchEvent({name:d.default.HardwareEvents.BeforeMediaRendererRemoved,renderer:n.renderer});n.renderer.clear();r.dispatchEvent({name:d.default.HardwareEvents.MediaRendererRemoved,renderer:n.renderer});n.renderer=undefined}var a=n.stream.getTracks();a.forEach(function(e){e.stop()});e()})}},{key:"_getTracksKind",value:function e(t){var n={};var r=this._callStreams[t.id()];if(typeof r!=="undefined"){r.getTracks().forEach(function(e){return n[e.id]=e.kind})}var i=this._sharingStreams[t.id()];if(typeof i!=="undefined"){i.forEach(function(e){e.stream.getTracks().forEach(function(e){return n[e.id]="sharing"})})}return n}},{key:"_traceName",value:function e(){return"StreamManager"}},{key:"onMirrorEnded",value:function e(){var t=this;this.remMirrorStream();this.getMirrorStream().then(function(e){t.dispatchEvent({name:d.default.HardwareEvents.BeforeMediaRendererRemoved,renderer:e});t.dispatchEvent({name:d.default.HardwareEvents.MediaRendererRemoved,renderer:null})})}},{key:"onCallEnded",value:function e(){}},{key:"_composeConstraints",value:function e(t){var n=typeof t==="undefined"?"__default":t.id();var r={};if(n!=="__default"&&typeof t!=="undefined"&&t.settings.videoDirections.sendVideo){r.video=g.CameraManager.get().getCallConstraints(n)}else{r.video=false}if(n==="__default"||t.settings.audioDirections.sendAudio){r.audio=m.AudioDeviceManager.get().getCallConstraints(n)}else{r.audio=false}return r}}],[{key:"get",value:function e(){if(typeof t.instance==="undefined")t.instance=new t;return t.instance}}]);return t}(f.EventTarget);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"getMirrorStream",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"remMirrorStream",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"getCallStream",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"_updateCallStream",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"updateCallStream",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"remCallStream",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"_remCallStream",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"clear",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"getLocalMediaRenderers",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"showLocalVideo",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"hideLocalVideo",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"on",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"off",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"_newScreenSharing",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"_getScreenSharing",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"_clearScreenSharing",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"_getTracksKind",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"onMirrorEnded",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"onCallEnded",null);l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],C.prototype,"_composeConstraints",null);t.StreamManager=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e[e["InfoUpdated"]="InfoUpdated"]="InfoUpdated";e[e["Removed"]="Removed"]="Removed";e[e["RemoteMediaAdded"]="RemoteMediaAdded"]="RemoteMediaAdded";e[e["RemoteMediaRemoved"]="RemoteMediaRemoved"]="RemoteMediaRemoved";e[e["RTCStatsReceived"]="RTCStatsReceived"]="RTCStatsReceived"})(r=t.EndpointEvents||(t.EndpointEvents={}))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++){n[t]=e[t]}return n}else{return Array.from(e)}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var l=n(0);var u=n(12);var d=n(1);var f=n(5);var g=n(4);var p=n(58);var v=n(59);var h=function(){function e(){s(this,e);this._calls=new WeakMap;this.preferredVideoCodec="";this.preferredVideoCodec=d.Client.getInstance().config().H264first?"video/H264":d.Client.getInstance().config().VP8first?"video/VP8":""}r(e,[{key:"addCall",value:function e(t){if(t&&(typeof t==="undefined"?"undefined":i(t))==="object"){this._calls.set(t,{codecMismatch:{audioLevel:v.Statistic.QualityIssueLevel.None,videoLevel:v.Statistic.QualityIssueLevel.None,sharingLevel:v.Statistic.QualityIssueLevel.None,audioChecks:0,videoChecks:0,sharingChecks:0},highMediaLatency:{levels:[],latencies:[],lastJitterBuffers:{},prevLevel:v.Statistic.QualityIssueLevel.None},ICEDisconnected:{level:v.Statistic.QualityIssueLevel.None},localVideoDegradation:{videoLevel:v.Statistic.QualityIssueLevel.None,sharingLevel:v.Statistic.QualityIssueLevel.None},noAudioSignal:{level:v.Statistic.QualityIssueLevel.None},packetLoss:{level:v.Statistic.QualityIssueLevel.None,lastLost:0,lastTotal:0,checks:0}})}}},{key:"deleteCall",value:function e(t){if(t&&(typeof t==="undefined"?"undefined":i(t))==="object"&&this._calls.has(t)){this._calls.delete(t)}}},{key:"analyzeCallStats",value:function e(t,n){if(t&&(typeof t==="undefined"?"undefined":i(t))==="object"&&this._calls.has(t)){var r=this._calls.get(t);var a=g.default.StreamManager.get()._getTracksKind(t);var o=t.state()===u.CallState.ALERTING||t.state()===u.CallState.PROGRESSING||t.state()===u.CallState.ENDED;if(!o){r.codecMismatch=this.checkCodecMismatch(t,n,a,r.codecMismatch);r.highMediaLatency=this.checkMediaLatency(t,n,a,r.highMediaLatency);r.localVideoDegradation=this.checkLocalVideoDegradation(t,n,a,r.localVideoDegradation);r.packetLoss=this.checkPacketLoss(t,n,r.packetLoss)}this._calls.set(t,r)}}},{key:"checkICEConnection",value:function e(t,n){if(t&&(typeof t==="undefined"?"undefined":i(t))==="object"&&this._calls.has(t)){var r=this._calls.get(t);if(n==="failed"&&r.ICEDisconnected.level!==v.Statistic.QualityIssueLevel.Critical){t.dispatchEvent({call:t,name:f.CallEvents.QualityIssueICEDisconnected,level:v.Statistic.QualityIssueLevel.Critical});r.ICEDisconnected.level=v.Statistic.QualityIssueLevel.Critical;this._calls.set(t,r)}else if(n!=="failed"&&r.ICEDisconnected.level===v.Statistic.QualityIssueLevel.Critical){t.dispatchEvent({call:t,name:f.CallEvents.QualityIssueICEDisconnected,level:v.Statistic.QualityIssueLevel.None});r.ICEDisconnected.level=v.Statistic.QualityIssueLevel.None;this._calls.set(t,r)}}}},{key:"checkCodecMismatch",value:function t(n,r,i,a){var o=r.filter(function(e){return e.type==="codec"});if(o.length){var s=Object.keys(i).find(function(e){return i[e]===p.TrackType.video});var c=Object.keys(i).find(function(e){return i[e]===p.TrackType.audio});var l=Object.keys(i).find(function(e){return i[e]===p.TrackType.sharing});var u=r.filter(function(e){return e.type==="track"});var d=r.filter(function(e){return e.type==="outbound-rtp"});var g=(u.find(function(e){return e.trackIdentifier===s})||{id:undefined}).id;var h=(u.find(function(e){return e.trackIdentifier===c})||{id:undefined}).id;var m=(u.find(function(e){return e.trackIdentifier===l})||{id:undefined}).id;var y=d.find(function(e){return e.trackId===g});var C=d.find(function(e){return e.trackId===h});var _=d.find(function(e){return e.trackId===m});var S=y&&y.codecId?y.codecId:undefined;var E=C&&C.codecId?C.codecId:undefined;var L=_&&_.codecId?_.codecId:undefined;var M=(o.find(function(e){return e.id===S})||{mimeType:undefined}).mimeType;var b=(o.find(function(e){return e.id===E})||{mimeType:undefined}).mimeType;var R=(o.find(function(e){return e.id===L})||{mimeType:undefined}).mimeType;var T=n.settings.H264first?"video/H264":n.settings.VP8first?"video/VP8":this.preferredVideoCodec;var k=M===undefined;var I=M===undefined;var P=M===undefined;if(C){}if(y&&y.bytesSent){if(k){if(a.videoLevel===v.Statistic.QualityIssueLevel.Critical&&a.videoChecks>e.MAX_STATS_CHECKS){n.dispatchEvent({call:n,name:f.CallEvents.QualityIssueCodecMismatch,level:v.Statistic.QualityIssueLevel.Critical,kind:p.TrackType.video,sendCodec:M});a.videoLevel=v.Statistic.QualityIssueLevel.Critical;a.videoChecks=0}else{a.videoLevel=v.Statistic.QualityIssueLevel.Critical;a.videoChecks=a.videoChecks+1}}else if(T&&T!==M){n.dispatchEvent({call:n,name:f.CallEvents.QualityIssueCodecMismatch,level:v.Statistic.QualityIssueLevel.Major,kind:p.TrackType.video,sendCodec:M});a.videoLevel=v.Statistic.QualityIssueLevel.Major;a.videoChecks=0}}if(_&&_.bytesSent){if(P){if(a.sharingLevel===v.Statistic.QualityIssueLevel.Critical&&a.sharingChecks>e.MAX_STATS_CHECKS){n.dispatchEvent({call:n,name:f.CallEvents.QualityIssueCodecMismatch,level:v.Statistic.QualityIssueLevel.Critical,kind:p.TrackType.sharing,sendCodec:R});a.sharingLevel=v.Statistic.QualityIssueLevel.Critical;a.sharingChecks=0}else{a.sharingLevel=v.Statistic.QualityIssueLevel.Critical;a.sharingChecks=a.videoChecks+1}}else if(T&&T!==R){n.dispatchEvent({call:n,name:f.CallEvents.QualityIssueCodecMismatch,level:v.Statistic.QualityIssueLevel.Major,kind:p.TrackType.sharing,sendCodec:R});a.sharingLevel=v.Statistic.QualityIssueLevel.Major;a.sharingChecks=0}}}return a}},{key:"checkMediaLatency",value:function e(t,n,r,i){var s=n.find(function(e){return e.type==="candidate-pair"&&(e.selected||e.nominated&&e.state==="succeeded")});var c=n.filter(function(e){return e.type==="inbound-rtp"});var l=n.filter(function(e){return e.type==="track"&&c.some(function(t){return t.trackId===e.id})});var u=l.reduce(function(e,t){var n=t.jitterBufferDelay!==undefined?t.jitterBufferDelay-(i.lastJitterBuffers[t.id]||{delay:0}).delay:undefined;var r=t.jitterBufferEmittedCount!==undefined?t.jitterBufferEmittedCount-(i.lastJitterBuffers[t.id]||{emittedCount:0}).emittedCount:undefined;var a=n!==undefined&&r?n*1e3/r:0;return a>e?a:e},0);var d=(s&&s.currentRoundTripTime||0)*1e3;var g=Math.round(d/2+u);i.latencies.push(g);if(g>300){i.levels.push(v.Statistic.QualityIssueLevel.Critical)}else if(g>200){i.levels.push(v.Statistic.QualityIssueLevel.Major)}else if(g>100){i.levels.push(v.Statistic.QualityIssueLevel.Minor)}else{i.levels.push(v.Statistic.QualityIssueLevel.None)}if(i.levels.length===5){var p=[v.Statistic.QualityIssueLevel.Critical,v.Statistic.QualityIssueLevel.Major,v.Statistic.QualityIssueLevel.Minor,v.Statistic.QualityIssueLevel.None];var h=i.levels.reduce(function(e,t){e[p.indexOf(t)]++;return e},[0,0,0,0]);if(h.includes(5)){var m=p[h.indexOf(5)];if(m!==v.Statistic.QualityIssueLevel.None||i.prevLevel!==v.Statistic.QualityIssueLevel.None){t.dispatchEvent({call:t,name:f.CallEvents.QualityIssueHighMediaLatency,level:m,latency:g})}i.prevLevel=m}else{var y=h.reduce(function(e,t,n){if(e.length!==2&&t){e.push(n)}return e},[]);var C=Math.log1p(h[y[0]])-Math.log1p(h[y[1]]);var _=p[C>.5?y[0]:y[1]];var S=i.levels.map(function(e,t){return e===_?i.latencies[t]:0});if(_!==v.Statistic.QualityIssueLevel.None||i.prevLevel!==v.Statistic.QualityIssueLevel.None){t.dispatchEvent({call:t,name:f.CallEvents.QualityIssueHighMediaLatency,level:_,latency:Math.max.apply(Math,o(S))})}i.prevLevel=_}i.levels=[];i.latencies=[]}i.lastJitterBuffers=l.reduce(function(e,t){return Object.assign(e,a({},t.id,{delay:t.jitterBufferDelay,emittedCount:t.jitterBufferEmittedCount}))},{});return i}},{key:"checkLocalVideoDegradation",value:function e(t,n,r,i){var a=r?Object.keys(r).find(function(e){return r[e]===p.TrackType.video}):undefined;var o=r?Object.keys(r).find(function(e){return r[e]===p.TrackType.sharing}):undefined;if(a){var s=n.filter(function(e){return e.type==="track"}).find(function(e){return e.trackIdentifier===a});if(s&&s.frameHeight&&s.frameWidth){var c=g.default.CameraManager.get().getCallVideoSettings(t);var l=Math.min(s.frameWidth,s.frameHeight)/Math.min(c.frameWidth||320,c.frameHeight||240);var u=v.Statistic.QualityIssueLevel.None;if(l<.5){u=v.Statistic.QualityIssueLevel.Critical}else if(l<=.7){u=v.Statistic.QualityIssueLevel.Major}else if(l<=.85){u=v.Statistic.QualityIssueLevel.Minor}else{u=v.Statistic.QualityIssueLevel.None}if(i.videoLevel!==u){t.dispatchEvent({call:t,name:f.CallEvents.QualityIssueLocalVideoDegradation,level:u,kind:p.TrackType.video,targetWidth:c.frameWidth||320,targetHeight:c.frameHeight||240,actualWidth:s.frameWidth,actualHeight:s.frameHeight});i.videoLevel=u}}}if(o){var d=n.filter(function(e){return e.type==="track"}).find(function(e){return e.trackIdentifier===o});if(d&&d.framesPerSecond!==undefined){var h=v.Statistic.QualityIssueLevel.None;if(d.framesPerSecond<4){h=v.Statistic.QualityIssueLevel.Critical}else if(d.framesPerSecond<8){h=v.Statistic.QualityIssueLevel.Major}else if(d.framesPerSecond<15){h=v.Statistic.QualityIssueLevel.Minor}else{h=v.Statistic.QualityIssueLevel.None}if(i.sharingLevel!==h){t.dispatchEvent({call:t,name:f.CallEvents.QualityIssueLocalVideoDegradation,level:h,kind:p.TrackType.sharing,fps:d.framesPerSecond});i.sharingLevel=h}}}return i}},{key:"checkAudioSignal",value:function e(t,n,r,i){var a=r?Object.keys(r).find(function(e){return r[e]===p.TrackType.audio}):undefined;if(a){var o=n.filter(function(e){return e.type==="track"}).find(function(e){return e.trackIdentifier===a});if(o&&o.audioLevel!==undefined&&o.audioLevel>0&&i.level===v.Statistic.QualityIssueLevel.Critical){t.dispatchEvent({call:t,name:f.CallEvents.QualityIssueNoAudioSignal,level:v.Statistic.QualityIssueLevel.None});i.level=v.Statistic.QualityIssueLevel.None}if(o&&o.audioLevel!==undefined&&o.audioLevel===0){t.dispatchEvent({call:t,name:f.CallEvents.QualityIssueNoAudioSignal,level:v.Statistic.QualityIssueLevel.Critical});i.level=v.Statistic.QualityIssueLevel.Critical}}return i}},{key:"checkPacketLoss",value:function e(t,n,r){var i=n.filter(function(e){return e.type==="inbound-rtp"});r.checks=r.checks+1;if(r.checks===5){var a=i.length?i.reduce(function(e,t){return{lost:e.lost+(t.packetsLost||0),total:e.total+(t.packetsLost||0)+(t.packetsReceived||0)}},{lost:0,total:0}):{lost:0,total:0};var o=a.total-r.lastTotal?(a.lost-r.lastLost)/(a.total-r.lastTotal):0;var s=v.Statistic.QualityIssueLevel.None;if(o>=.15){s=v.Statistic.QualityIssueLevel.Critical}else if(o>=.1){s=v.Statistic.QualityIssueLevel.Major}else if(o>=.05){s=v.Statistic.QualityIssueLevel.Minor}else{s=v.Statistic.QualityIssueLevel.None}if(r.level!==s){t.dispatchEvent({call:t,name:f.CallEvents.QualityIssuePacketLoss,level:s,packetLoss:o});r.level=s}r.lastLost=a.lost;r.lastTotal=a.total;r.checks=0}return r}},{key:"checkLowBandwidth",value:function e(){}}],[{key:"get",value:function t(){if(typeof this.inst=="undefined"){this.inst=new e}return this.inst}}]);return e}();h.MAX_STATS_CHECKS=4;c([l.LogManager.d_trace(l.LogCategory.RTC)],h.prototype,"addCall",null);c([l.LogManager.d_trace(l.LogCategory.RTC)],h.prototype,"deleteCall",null);t.CallStatsAnalyzer=h},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(5);var c=n(0);var l=function(){function e(t,n){var r=this;a(this,e);this._pcStatus=n;this._q=[];t.on(s.CallEvents.Updated,function(t){c.LogManager.get().writeMessage(c.LogCategory.REINVITEQ,"CallEvent",c.LogLevel.TRACE,"Updated with result "+t.result);if(e._currentReinvite){var n=e._currentReinvite;if(t.result)n.resolve(t);else n.reject(t);e._currentReinvite=undefined}r.runNext()});t.on(s.CallEvents.PendingUpdate,function(t){c.LogManager.get().writeMessage(c.LogCategory.REINVITEQ,"CallEvent",c.LogLevel.TRACE,"IncomingUpdate. Local RI=="+i(e._currentReinvite));if(e._currentReinvite){e._currentReinvite.reject();e._currentReinvite=undefined}});t.on(s.CallEvents.UpdateFailed,function(t){c.LogManager.get().writeMessage(c.LogCategory.REINVITEQ,"CallEvent",c.LogLevel.TRACE,"UpdateFailed");if(e._currentReinvite){e._currentReinvite.reject();e._currentReinvite=undefined}})}r(e,[{key:"runNext",value:function t(){if(typeof e._currentReinvite==="undefined"&&this._q.length>0&&this._pcStatus()){e._currentReinvite=this._q.splice(0,1)[0];e._currentReinvite.fx()}}},{key:"add",value:function e(t){this._q.push(t);this.runNext()}},{key:"clear",value:function e(){this._q.forEach(function(e){e.reject()})}},{key:"_traceName",value:function e(){return"ReInviteQ"}}]);return e}();o([c.LogManager.d_trace(c.LogCategory.REINVITEQ)],l.prototype,"runNext",null);o([c.LogManager.d_trace(c.LogCategory.REINVITEQ)],l.prototype,"add",null);o([c.LogManager.d_trace(c.LogCategory.REINVITEQ)],l.prototype,"clear",null);t.ReInviteQ=l},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var a=function(){function e(t){i(this,e);this.str=t||e.getNewGUIDString()}r(e,[{key:"toString",value:function e(){return this.str}},{key:"_traceName",value:function e(){return"GUID"}}],[{key:"getNewGUIDString",value:function e(){var t=(new Date).getTime();if(window.performance&&typeof window.performance.now==="function"){t+=performance.now()}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+Math.random()*16)%16|0;t=Math.floor(t/16);return(e=="x"?n:n&3|8).toString(16)})}}]);return e}();t.default=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=n(25);var l=n(44);var u=n(26);var d=n(18);var f=n(27);var g=n(41);var p=n(19);var v=function(){function e(t){a(this,e);this._backup={};this._uuid=t.uuid;this._participants=t.participants;this._title=t.title;this._direct=t.direct;this._publicJoin=t.publicJoin;this._uberConversation=t.uberConversation;this._customData=t.customData;this._createdAt=t.createdAt;this._lastUpdate=t.lastUpdate;this._lastSeq=Number(t.lastSeq)}r(e,[{key:"updateSeq",value:function e(t){if(typeof t=="number"&&t>this._lastSeq){this._lastSeq=t}this._lastUpdate=Date.now()/1e3|0}},{key:"toCache",value:function e(){return{uuid:this._uuid,title:this._title,participants:this._participants,direct:this._direct,publicJoin:this._publicJoin,uberConversation:this._uberConversation,createdAt:this._createdAt,lastUpdate:this._lastUpdate,customData:this._customData,lastSeq:this._lastSeq}}},{key:"_getCreatePayload",value:function e(){return{participants:this._prepareParticipants(this._participants).map(function(e){return Object.assign(e,{flags:e.flags?e.flags:7})}),title:typeof this._title=="string"?this._title:"",direct:typeof this._direct=="boolean"?this._direct:false,enable_public_join:typeof this._publicJoin=="boolean"?this._publicJoin:false,uber_conversation:typeof this._uberConversation=="boolean"?this._uberConversation:undefined,custom_data:i(this._customData)=="object"?this._customData:{}}}},{key:"_getEditPayload",value:function e(){if(typeof this._uuid=="undefined")throw Error("You must get conversation UUID with MessengetAction.getConversation() action!");return{uuid:this._uuid,title:typeof this._title=="string"?this._title:"",enable_public_join:typeof this._publicJoin=="boolean"?this._publicJoin:false,custom_data:i(this._customData)=="object"?this._customData:{}}}},{key:"_getUserPermissions",value:function e(t){var n=(t.isOwner?"1000000000":"")+[t.canRemoveAll,t.canEditAll,t.canManageParticipants,t.canRemove,t.canEdit,t.canWrite].map(function(e){return e?1:0}).join("");return parseInt(n,2)}},{key:"_prepareParticipants",value:function e(t){var n=this;return t.map(function(e){return{user_id:e.userId,flags:n._getUserPermissions(e),last_read:e.lastRead}})}},{key:"_revertChanges",value:function e(){var t=this;Object.keys(this._backup).forEach(function(e){t[e]=t._backup[e]});this._backup={}}},{key:"update",value:function e(){return l.default.get().editConversation(this)}},{key:"setTitle",value:function e(t){if(typeof t!="string")return c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.editConversation);this._backup.title=this._title;this._title=t;return l.default.get().editConversation(this)}},{key:"setPublicJoin",value:function e(t){if(typeof t!="boolean")return c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.editConversation);this._backup.publicJoin=this._publicJoin;this._publicJoin=t;return l.default.get().editConversation(this)}},{key:"setCustomData",value:function e(t){if(!t||Array.isArray(t)||(typeof t==="undefined"?"undefined":i(t))!="object")return c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.editConversation);this._backup.customData=this._customData;this._customData=t;return l.default.get().editConversation(this)}},{key:"addParticipants",value:function e(t){var n=this;if(!Array.isArray(t)||t.length==0)return c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.addParticipants);return new Promise(function(e,r){var i=d.MsgSignaling.get().sendWsMessage(f.MsgAction.addParticipants,{uuid:n._uuid,participants:n._prepareParticipants(t)});c.Messenger.getInstance()._registerPromise(i,e,r)})}},{key:"editParticipants",value:function e(t){var n=this;if(!Array.isArray(t)||t.length==0)return c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.editParticipants);return new Promise(function(e,r){var i=d.MsgSignaling.get().sendWsMessage(f.MsgAction.editParticipants,{uuid:n._uuid,participants:n._prepareParticipants(t)});c.Messenger.getInstance()._registerPromise(i,e,r)})}},{key:"removeParticipants",value:function e(t){var n=this;if(!Array.isArray(t)||t.length==0)return c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.removeParticipants);return new Promise(function(e,r){var i=d.MsgSignaling.get().sendWsMessage(f.MsgAction.removeParticipants,{uuid:n._uuid,participants:t.filter(function(e){return typeof e.userId!=="undefined"}).map(function(e){return e.userId})});c.Messenger.getInstance()._registerPromise(i,e,r)})}},{key:"sendMessage",value:function e(t,n){if(typeof t!="string"||!(typeof n!=="undefined"&&Array.isArray(n)&&n.every(function(e){return e&&(typeof e==="undefined"?"undefined":i(e))==="object"})))return c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.sendMessage);var r=new u.Message(t,n);return r.sendTo(this)}},{key:"typing",value:function e(){var t=this;if(this._debounceLock)return Promise.resolve(false);setTimeout(function(){t._debounceLock=false},1e4);this._debounceLock=true;return new Promise(function(e,n){var r=d.MsgSignaling.get().sendWsMessage(f.MsgAction.typingMessage,{conversation:t._uuid});c.Messenger.getInstance()._registerPromise(r,e,n)})}},{key:"markAsRead",value:function e(t){var n=this;return new Promise(function(e,r){var i=d.MsgSignaling.get().sendWsMessage(f.MsgAction.isRead,{conversation:n._uuid,seq:t});c.Messenger.getInstance()._registerPromise(i,e,r)})}},{key:"retransmitEvents",value:function e(t,n,r){var i=this;if(typeof n!="number"||typeof t!="number")return c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.retransmitEvents);return new Promise(function(e,a){var o=void 0;var s=void 0;var l=void 0;Promise.all(Array(n-t+1).fill(0).map(function(e,n){return n+t}).map(function(e){return new Promise(function(t,n){var r=function n(r){if(r.events&&r.events[0]&&Number(r.events[0].seq)===e){clearTimeout(a);c.Messenger.getInstance().off(p.default.MessengerEvents.RetransmitEvents,n);c.Messenger.getInstance().off(p.default.MessengerEvents.Error,i);if(!s){s=r.initiator}if(!l){l=r.messengerAction}t(r.events[0])}};var i=function t(i){if(i.messengerAction==p.default.MessengerAction.retransmitEvents&&i.events&&i.events[0]&&Number(i.events[0].seq)===e){clearTimeout(a);c.Messenger.getInstance().off(p.default.MessengerEvents.RetransmitEvents,r);c.Messenger.getInstance().off(p.default.MessengerEvents.Error,t);n(i)}};var a=setTimeout(function(){c.Messenger.getInstance().off(p.default.MessengerEvents.RetransmitEvents,r);c.Messenger.getInstance().off(p.default.MessengerEvents.Error,i);c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.retransmitEvents).catch(n)},c.Messenger.rejectTimeout);c.Messenger.getInstance().on(p.default.MessengerEvents.RetransmitEvents,r);c.Messenger.getInstance().on(p.default.MessengerEvents.Error,i)})})).then(function(t){return e({initiator:s,messengerAction:l,events:t,requestUuid:o})}).catch(a);o=d.MsgSignaling.get().sendWsMessage(f.MsgAction.retransmitEvents,{conversation:i._uuid,events_from:t|0,events_to:n|0,count:r})})}},{key:"_traceName",value:function e(){return"Conversation"}},{key:"uuid",get:function e(){return this._uuid}},{key:"title",get:function e(){return this._title},set:function e(t){this._backup.title=this._title;this._title=t}},{key:"createdAt",get:function e(){return this._createdAt}},{key:"lastUpdate",get:function e(){return this._lastUpdate}},{key:"direct",get:function e(){return this._direct}},{key:"uberConversation",get:function e(){return this._uberConversation}},{key:"publicJoin",get:function e(){return this._publicJoin},set:function e(t){this._backup.publicJoin=this._publicJoin;this._publicJoin=t}},{key:"participants",get:function e(){return this._participants}},{key:"customData",get:function e(){return this._customData},set:function e(t){this._backup.customData=this._customData;this._customData=t}},{key:"lastSeq",get:function e(){return this._lastSeq}}],[{key:"_createFromBus",value:function t(n,r){return new e({participants:n.participants&&Array.isArray(n.participants)?n.participants.map(function(e){var t=Number(e.flags)===g.MsgPermissions.all;var n=Number(e.flags)>g.MsgPermissions.is_owner&&e.flags<g.MsgPermissions.all;var r=Number(e.flags).toString(2).slice(-6).split("").reverse();return{userId:Number(e.user_id),lastRead:e.last_read,isOwner:t||n,canWrite:t||r[0]==="1",canEdit:t||r[1]==="1",canRemove:t||r[2]==="1",canManageParticipants:t||r[3]==="1",canEditAll:t||r[4]==="1",canRemoveAll:t||r[5]==="1"}}):[],title:n.title,uuid:n.uuid,direct:n.direct,publicJoin:n.enable_public_join,uberConversation:n.uber_conversation,createdAt:n.created_at,lastUpdate:n.last_update,lastSeq:r,customData:n.custom_data&&i(n.custom_data)==="object"?n.custom_data:undefined})}},{key:"createFromCache",value:function t(n){return new e({uuid:n.uuid,title:n.title,participants:n.participants||[],direct:n.direct,publicJoin:n.publicJoin,uberConversation:n.uberConversation,createdAt:n.createdAt,lastUpdate:n.lastUpdate,customData:n.customData})}}]);return e}();o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"updateSeq",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"toCache",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"_getCreatePayload",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"_getEditPayload",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"_prepareParticipants",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"_revertChanges",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"update",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"addParticipants",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"editParticipants",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"removeParticipants",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"typing",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"markAsRead",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"retransmitEvents",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v,"_createFromBus",null);o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v,"createFromCache",null);t.Conversation=v},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=n(29);var l=function(){function e(){a(this,e);if(typeof e.instance!=="undefined")throw new Error("Error - use StreamManager.get()");if(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints)this._supportedConstraints=navigator.mediaDevices.getSupportedConstraints();else this._supportedConstraints={};this.__defaultParams={};this._lastAudioInputDevices=[];this._lastAudioOutputDevices=[];this._callParams={};this.logger=s.LogManager.get().createLogger(s.LogCategory.USERMEDIA,this._traceName())}r(e,[{key:"getAudioContext",value:function e(){if(this.audioContext)return this.audioContext;if(typeof window.AudioContext!="undefined"||typeof window.webkitAudioContext!="undefined"){window.AudioContext=window.AudioContext||window.webkitAudioContext;try{this.audioContext=new AudioContext;return this.audioContext}catch(e){this.audioContext=null;return null}}}},{key:"prepareAudioContext",value:function e(){this.getAudioContext()}},{key:"getInputDevices",value:function e(){var t=this;return navigator.mediaDevices.enumerateDevices().then(function(e){t.logger.info("Got input devices: "+JSON.stringify(e));t._lastAudioInputDevices=e.map(function(e){if(e.kind==="audio"||e.kind==="audioinput"){return{id:e.deviceId,name:e.label,group:e.groupId}}}).filter(function(e){return typeof e!=="undefined"});return t._lastAudioInputDevices})}},{key:"getOutputDevices",value:function e(){var t=this;return navigator.mediaDevices.enumerateDevices().then(function(e){t.logger.info("Got output devices: "+JSON.stringify(e));t._lastAudioOutputDevices=e.map(function(e){if(e.kind==="audiooutput"){return{id:e.deviceId,name:e.label,group:e.groupId}}}).filter(function(e){return typeof e!=="undefined"});return t._lastAudioOutputDevices})}},{key:"getDefaultAudioSettings",value:function e(){return this.__defaultParams}},{key:"setDefaultAudioSettings",value:function e(t){this.logger.info("Set default audio settings: "+JSON.stringify(t));this.__defaultParams=t}},{key:"setCallAudioSettings",value:function e(t,n){var r=this;this.logger.info("Setting call "+t.id+" audio settings: "+JSON.stringify(n));return new Promise(function(e,i){if(r._callParams[t.id()]===n)e();var a=r._callParams[t.id()].outputId!==n.outputId;var o=r._callParams[t.id()].inputId!==n.inputId||r._callParams[t.id()].noiseSuppression!==n.noiseSuppression||r._callParams[t.id()].echoCancellation!==n.echoCancellation||r._callParams[t.id()].disableAudio!==n.disableAudio;r.logger.info("Must update renderers: "+a+", must update source: "+o);r._callParams[t.id()]=n;if(a){t.getEndpoints().forEach(function(e){e.mediaRenderers.forEach(function(e){return e.useAudioOutput(n.outputId)})})}if(o){c.StreamManager.get().updateCallStream(t).then(function(){e()}).catch(function(e){r.logger.warning("Failed to update call "+t.id()+" stream: "+e);i(e)})}else{e()}})}},{key:"getCallAudioSettings",value:function e(t){return this._callParams[t.id()]}},{key:"getCallConstraints",value:function e(t){if(this._callParams[t])return this._getAudioConstraints(this._callParams[t]);else{this._callParams[t]=this.__defaultParams;return this._getAudioConstraints(this.__defaultParams)}}},{key:"_getAudioConstraints",value:function e(t){if(t.disableAudio)return false;var n="ideal";if(t.strict)n="exact";var r={};if(t.inputId){if(this._lastAudioInputDevices){if(this._lastAudioInputDevices.some(function(e){return e.id===t.inputId})){r["deviceId"]={};r["deviceId"][n]=t.inputId}else this.logger.warning("There is no audio input device with id "+t.inputId)}else this.logger.warning("There is no audio input device with id "+t.inputId)}if(t.echoCancellation&&this._supportedConstraints["echoCancellation"]){r["echoCancellation"]=t.echoCancellation}if(t.noiseSuppression&&this._supportedConstraints["noiseSuppression"]){r["noiseSuppression"]=t.echoCancellation}if(t.autoGainControl&&this._supportedConstraints["autoGainControl"]){r["autoGainControl"]=t.autoGainControl}if(Object.keys(r))return r;else return true}},{key:"_traceName",value:function e(){return"AudioDeviceManager"}}],[{key:"get",value:function t(){if(typeof e.instance==="undefined")e.instance=new e;return e.instance}}]);return e}();o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"getInputDevices",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"getOutputDevices",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"getDefaultAudioSettings",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"setDefaultAudioSettings",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"setCallAudioSettings",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"getCallAudioSettings",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"getCallConstraints",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"_getAudioConstraints",null);t.AudioDeviceManager=l},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=n(29);var l=n(4);var u=function(){function e(){a(this,e);if(typeof e.instance!=="undefined")throw new Error("Error - use StreamManager.get()");if(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints)this._supportedConstraints=navigator.mediaDevices.getSupportedConstraints();else this._supportedConstraints={};this._callParams={};this._lastCameraDevices=[];this.__defaultParams={};this.logger=s.LogManager.get().createLogger(s.LogCategory.USERMEDIA,this._traceName())}r(e,[{key:"setDefaultVideoSettings",value:function e(t){var n=this;return new Promise(function(e){var r=n._validateCameraParams(t);n.logger.info("Setting  default video settings, params: "+JSON.stringify(t)+", valid params: "+JSON.stringify(r));n.__defaultParams=r;e(null)})}},{key:"getDefaultVideoSettings",value:function e(){return this.__defaultParams}},{key:"setCallVideoSettings",value:function e(t,n){var r=this;var i=this._validateCameraParams(n);this.logger.info("Setting call "+t.id()+" video settings, params: "+JSON.stringify(n)+", valid params: "+JSON.stringify(i));this._callParams[t.id()]=i;return new Promise(function(e,n){c.StreamManager.get().updateCallStream(t).then(function(){e()}).catch(function(e){r.logger.warning("Failed to set call "+t.id()+" video settings: "+e);n(e)})})}},{key:"getCallVideoSettings",value:function e(t){return this._callParams[t.id()]}},{key:"getCallConstraints",value:function e(t){if(this._callParams[t])return this._getVideoConstraints(this._callParams[t]);else{this._callParams[t]=this.__defaultParams;return this._getVideoConstraints(this.__defaultParams)}}},{key:"getInputDevices",value:function e(){var t=this;return navigator.mediaDevices.enumerateDevices().then(function(e){t.logger.info("Got input devices: "+JSON.stringify(e));t._lastCameraDevices=e.map(function(e){if(e.kind==="video"||e.kind==="videoinput"){return{id:e.deviceId,name:e.label,group:e.groupId}}}).filter(function(e){return typeof e!=="undefined"});return t._lastCameraDevices})}},{key:"_getVideoConstraints",value:function e(t){var n="ideal";var r={};if(t.cameraId){if(this._lastCameraDevices){if(this._lastCameraDevices.some(function(e){return e.id===t.cameraId})){r["deviceId"]={};r["deviceId"][n]=t.cameraId}else this.logger.warning("There is no video device with id "+t.cameraId)}else this.logger.warning("There is no video device with id "+t.cameraId)}else if(typeof t.facingMode!=="undefined"){if(t.facingMode===false){r["facingMode"]="environment"}else{r["facingMode"]="user"}}if(t.frameHeight){r["height"]={};if(t.strict){r["height"]["min"]=t.frameHeight}else r["height"][n]=t.frameHeight}if(t.frameWidth){r["width"]={};if(t.strict){r["width"]["min"]=t.frameWidth}else r["width"][n]=t.frameWidth}if(t.frameRate&&t.frameRate>0&&this._supportedConstraints["frameRate"]){r["frameRate"]=t.frameRate+""}if(Object.keys(r))return r;else return true}},{key:"_validateCameraParams",value:function e(t){if(t.videoQuality){if(t.frameHeight||t.frameWidth)this.logger.warning('"videoQuality" parameter detected. The "frameHeight" and the "frameWidth" params will be ignored');var n=this._videoQualityToSize(t.videoQuality);t.frameWidth=n.w;t.frameHeight=n.h}return t}},{key:"_videoQualityToSize",value:function e(t){switch(t){case l.Hardware.VideoQuality.VIDEO_QUALITY_HIGH:return{w:1280,h:720};case l.Hardware.VideoQuality.VIDEO_QUALITY_MEDIUM:return{w:640,h:480};case l.Hardware.VideoQuality.VIDEO_QUALITY_LOW:return{w:320,h:240};case l.Hardware.VideoQuality.VIDEO_SIZE_QQVGA:return{w:160,h:120};case l.Hardware.VideoQuality.VIDEO_SIZE_QCIF:return{w:176,h:144};case l.Hardware.VideoQuality.VIDEO_SIZE_QVGA:return{w:320,h:240};case l.Hardware.VideoQuality.VIDEO_SIZE_CIF:return{w:352,h:288};case l.Hardware.VideoQuality.VIDEO_SIZE_nHD:return{w:640,h:360};case l.Hardware.VideoQuality.VIDEO_SIZE_VGA:return{w:640,h:480};case l.Hardware.VideoQuality.VIDEO_SIZE_SVGA:return{w:800,h:600};case l.Hardware.VideoQuality.VIDEO_SIZE_HD:return{w:1280,h:720};case l.Hardware.VideoQuality.VIDEO_SIZE_UXGA:return{w:1600,h:1200};case l.Hardware.VideoQuality.VIDEO_SIZE_FHD:return{w:1920,h:1080};case l.Hardware.VideoQuality.VIDEO_SIZE_UHD:return{w:3840,h:2160};default:return{w:320,h:240}}}},{key:"testResolutions",value:function e(t){var n=this;var r=[l.Hardware.VideoQuality.VIDEO_SIZE_QQVGA,l.Hardware.VideoQuality.VIDEO_SIZE_QCIF,l.Hardware.VideoQuality.VIDEO_SIZE_QVGA,l.Hardware.VideoQuality.VIDEO_SIZE_CIF,l.Hardware.VideoQuality.VIDEO_SIZE_nHD,l.Hardware.VideoQuality.VIDEO_SIZE_VGA,l.Hardware.VideoQuality.VIDEO_SIZE_SVGA,l.Hardware.VideoQuality.VIDEO_SIZE_HD,l.Hardware.VideoQuality.VIDEO_SIZE_UXGA,l.Hardware.VideoQuality.VIDEO_SIZE_FHD,l.Hardware.VideoQuality.VIDEO_SIZE_UHD];if(this._lastResolutionTestResult){return new Promise(function(e,t){e(n._lastResolutionTestResult)})}else{return this._testResolutions(r,{},t)}}},{key:"_testResolutions",value:function e(t,n,r){var i=this;if(t.length){var a=t.shift();var o={strict:true};var s=this._videoQualityToSize(a);o.frameWidth=s.w;o.frameHeight=s.h;if(r){o.cameraId=r}var c={video:this._getVideoConstraints(o)};return navigator.mediaDevices.getUserMedia(c).then(function(e){i.logger.info("_testResolutions(): Media access granted");e.getTracks().forEach(function(e){return e.stop()});n[l.Hardware.VideoQuality[a]]=true;return i._testResolutions(t,n,r)},function(e){i.logger.error("_testResolutions(): Media access denied: "+(e?e.message||e.name||e:"unknown"));n[l.Hardware.VideoQuality[a]]=false;return i._testResolutions(t,n,r)})}else{this._lastResolutionTestResult=n;return n}}},{key:"loadResolutionTestResult",value:function e(t){var n=[l.Hardware.VideoQuality.VIDEO_SIZE_QQVGA,l.Hardware.VideoQuality.VIDEO_SIZE_QCIF,l.Hardware.VideoQuality.VIDEO_SIZE_QVGA,l.Hardware.VideoQuality.VIDEO_SIZE_CIF,l.Hardware.VideoQuality.VIDEO_SIZE_nHD,l.Hardware.VideoQuality.VIDEO_SIZE_VGA,l.Hardware.VideoQuality.VIDEO_SIZE_SVGA,l.Hardware.VideoQuality.VIDEO_SIZE_HD,l.Hardware.VideoQuality.VIDEO_SIZE_UXGA,l.Hardware.VideoQuality.VIDEO_SIZE_FHD,l.Hardware.VideoQuality.VIDEO_SIZE_UHD];if(!n.every(function(e){return typeof t[l.Hardware.VideoQuality[e]]!=="undefined"})){return false}else{this._lastResolutionTestResult=t;return true}}},{key:"_traceName",value:function e(){return"CameraManager"}}],[{key:"get",value:function t(){if(typeof e.instance==="undefined")e.instance=new e;return e.instance}},{key:"legacyParamConverter",value:function e(t){var n={videoQuality:l.Hardware.VideoQuality.VIDEO_QUALITY_MEDIUM};if(t.width){if(typeof t.width==="string"||typeof t.width==="number"){delete n.videoQuality;n.frameWidth=t.width}else if(typeof t.width.exact==="string"||typeof t.width.exact==="number"){delete n.videoQuality;n.frameWidth=t.width.exact;n.strict=true}else if(typeof t.width.min==="string"||typeof t.width.min==="number"){delete n.videoQuality;n.frameWidth=t.width.min}else if(typeof t.width.max==="string"||typeof t.width.max==="number"){delete n.videoQuality;n.frameWidth=t.width.max}else if(typeof t.width.ideal==="string"||typeof t.width.ideal==="number"){delete n.videoQuality;n.frameWidth=t.width.ideal}}if(t.height){if(typeof t.height==="string"||typeof t.height==="number"){delete n.videoQuality;n.frameHeight=t.height}else if(typeof t.height.exact==="string"||typeof t.height.exact==="number"){delete n.videoQuality;n.frameHeight=t.height.exact;n.strict=true}else if(typeof t.height.min==="string"||typeof t.height.min==="number"){delete n.videoQuality;n.frameHeight=t.height.min}else if(typeof t.height.max==="string"||typeof t.height.max==="number"){delete n.videoQuality;n.frameHeight=t.height.max}else if(typeof t.height.ideal==="string"||typeof t.height.ideal==="number"){delete n.videoQuality;n.frameHeight=t.height.ideal}}return n}}]);return e}();o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"setDefaultVideoSettings",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"getDefaultVideoSettings",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"setCallVideoSettings",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"getCallVideoSettings",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"getCallConstraints",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"getInputDevices",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"_getVideoConstraints",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"_validateCameraParams",null);o([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u,"legacyParamConverter",null);t.CameraManager=u},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(7);var c=n(1);var l=n(0);var u=n(20);var d=function(){function e(t,n){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var o=this;var c=arguments[4];var d=arguments[5];a(this,e);this.stream=t;this.kind=n;this.placeOnDom=r;this.isLocal=i;this.isRemoving=false;if(typeof this.kind==="undefined"){this.kind=t.getVideoTracks().length?"video":"audio"}this._id=u.Utils.generateUUID();this.logger=l.LogManager.get().createLogger(l.LogCategory.USERMEDIA,this._traceName());this.stream.getTracks().forEach(function(e){e.onended=function(){o.checkStreamActive(t)}});if(this.stream.getTracks().length){this.element=document.getElementById(this.stream.getTracks()[0].id)||document.createElement(this.kind==="sharing"?"video":this.kind);this.element.autoplay=true;if(this.isLocal)this.element.muted=true;this.element.setAttribute("playsinline",null);if(c){if(document.getElementById("voximplantlocalvideo"))this.element.id=this.stream.getTracks()[0].id;else this.element.id="voximplantlocalvideo"}else{this.element.id=this.stream.getTracks()[0].id}if(n!=="audio"){this.element.width=400;this.element.height=300}s.default.attachMedia(this.stream,this.element);if(this.placeOnDom){this.renderDefault()}}}r(e,[{key:"checkStreamActive",value:function e(t){if(!t.getTracks().some(function(e){return e.readyState==="live"})){this.clear()}}},{key:"renderDefault",value:function e(){var t=c.Client.getInstance();var n=this.isLocal?t.config().localVideoContainerId:t.config().remoteVideoContainerId;var r=document.getElementById(n);this.render(r)}},{key:"render",value:function e(t){var n=this;this.logger.info("render()");if(c.Client.getInstance().config()&&c.Client.getInstance().config().experiments&&c.Client.getInstance().config().experiments.preventRendering){return}var r=t||document.body;if(typeof this.element.parentElement!="undefined"&&this.element.parentElement!==null){if(this.element.parentElement)this.element.parentElement.removeChild(this.element)}else if(this.element.parentNode){if(this.element.parentNode)this.element.parentNode.removeChild(this.element)}r.appendChild(this.element);this.element.play().then(function(){},function(e){setTimeout(function(){n.element.play().then(function(){},function(e){n.logger.warning("Can't start playing MediaRenderer ID:"+n._id)})},400)})}},{key:"clear",value:function e(){if(this.isRemoving){this.logger.info("MediaRendered ID: already removing "+this._id+". Ignored.");return}this.isRemoving=true;if(this.onBeforeDestroy)this.onBeforeDestroy();if(this.element){s.default.detachMedia(this.element);this.element.id="";if(typeof this.element.parentElement!="undefined"&&this.element.parentElement!==null){if(this.element.parentElement)this.element.parentElement.removeChild(this.element)}else if(this.element.parentNode){if(this.element.parentNode)this.element.parentNode.removeChild(this.element)}}if(this.onDestroy)this.onDestroy()}},{key:"setVolume",value:function e(t){this.logger.info("setVolume("+t+")");if(this.element){this.element.volume=t}}},{key:"useAudioOutput",value:function e(t){this.logger.info("useAudioOutput("+t+")");try{this.element.setSinkId(t)}catch(e){this.logger.warning("Set audio output is impossible. Browser not support this option.")}}},{key:"_traceName",value:function e(){return"MediaRenderer"}},{key:"id",get:function e(){return this._id}}]);return e}();o([l.LogManager.d_trace(l.LogCategory.USERMEDIA)],d.prototype,"checkStreamActive",null);o([l.LogManager.d_trace(l.LogCategory.USERMEDIA)],d.prototype,"renderDefault",null);o([l.LogManager.d_trace(l.LogCategory.USERMEDIA)],d.prototype,"render",null);o([l.LogManager.d_trace(l.LogCategory.USERMEDIA)],d.prototype,"clear",null);o([l.LogManager.d_trace(l.LogCategory.USERMEDIA)],d.prototype,"setVolume",null);o([l.LogManager.d_trace(l.LogCategory.USERMEDIA)],d.prototype,"useAudioOutput",null);t.MediaRenderer=d},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=n(39);var l=n(37);var u=n(30);var d=n(5);var f=n(10);var g=function(){function e(){a(this,e);this._endpointList={};this._trackListMap={};this._trackKindMap={};this._endpointInfo={};this._mediaRendererList={};this.logger=s.LogManager.get().createLogger(s.LogCategory.ENDPOINT,"EndpointManager")}r(e,[{key:"setCallVolume",value:function e(t,n){var r=this._endpointList[t.id()]||{};Object.values(r).forEach(function(e){(e.mediaRenderers||[]).forEach(function(e){return e.setVolume(n)})})}},{key:"_getEndpointByTrackId",value:function e(t,n){var r=this._trackListMap[t.id()]||{};var i=this._endpointList[t.id()]||{};if(r[n]&&i[r[n]])return i[r[n]];else return this.getDefaultEndPoint(t)}},{key:"_getMediaTypeTrack",value:function e(t,n){var r=this._trackKindMap[t.id()]||{};return r[n.id]||n.kind}},{key:"addEndPoint",value:function e(t,n){var r=this._endpointInfo[t.id()];if(r){this._endpointList[t.id()][n.id]=n;if(r[n.id]){n.displayName=r[n.id].displayName;n.place=r[n.id].place;n.sipUri=r[n.id].sipURI;n.userName=r[n.id].username;t.dispatchEvent({name:d.CallEvents.EndpointAdded,call:t,endpoint:n})}else if(n.isDefault){t.dispatchEvent({name:d.CallEvents.EndpointAdded,call:t,endpoint:n})}}return n}},{key:"getDefaultEndPoint",value:function e(t){var n=this._endpointList[t.id()]||{};if(n[t.id()])return n[t.id()];var r=new c.Endpoint(true);r.id=t.id();this.addEndPoint(t,r);return r}},{key:"deleteEndpoint",value:function e(t,n){var r=this._endpointList[t.id()]||{};if(r[n.id]){n.mediaRenderers.forEach(function(e){e.clear()});n.dispatchEvent({name:u.EndpointEvents.Removed,call:t,endpoint:n});delete this._endpointList[t.id()][n.id]}else this.logger.error("Trying remove non existing endpoint with id:"+n.id+" on the call: "+t.id())}},{key:"addStreamToEndpoint",value:function e(t,n,r){var i=this;var a="video";if(r.getTracks().length===1)a=this.getMediaTypeTrack(t,r.getTracks()[0]);var o=new l.MediaRenderer(r,a,false,false,undefined,t.settings.isConference);if(!this._mediaRendererList[t.id()])this._mediaRendererList[t.id()]=[];this._mediaRendererList[t.id()].push(o);n.mediaRenderers.push(o);n.dispatchEvent({name:u.EndpointEvents.RemoteMediaAdded,call:t,endpoint:n,mediaRenderer:o});t.dispatchEvent({name:d.CallEvents.MediaElementCreated,call:t,stream:o.stream,element:o.element,type:o.kind});o.onBeforeDestroy=function(){if(n&&n.mediaRenderers)n.mediaRenderers=n.mediaRenderers.filter(function(e){return e.id!==o.id});if(i._mediaRendererList&&i._mediaRendererList[t.id()])i._mediaRendererList[t.id()]=i._mediaRendererList[t.id()].filter(function(e){return e.id!==o.id});n.dispatchEvent({name:u.EndpointEvents.RemoteMediaRemoved,call:t,endpoint:n,mediaRenderer:o});t.dispatchEvent({name:d.CallEvents.MediaElementRemoved,call:t,stream:o.stream,element:o.element,type:o.kind})}}},{key:"_traceName",value:function e(){return"AbstractEndpointManager"}},{key:"addStream",value:function e(t,n){var r=n.getTracks();var i=void 0;for(var a in r){i=i||this.getEndpointByTrack(t,r[a])}if(i)this.addStreamToEndpoint(t,i,n)}},{key:"addTrack",value:function e(t,n){var r=this;if(t.settings.isConference){if(!n.muted)this.addStream(t,new MediaStream([n]));else n.onunmute=function(){n.onunmute=void 0;r.addStream(t,new MediaStream([n]))}}else this.addStream(t,new MediaStream([n]))}},{key:"clear",value:function e(t){var n=this;delete this._mediaRendererList[t.id()];delete this._endpointInfo[t.id()];delete this._trackListMap[t.id()];return new Promise(function(e,r){var i=n._endpointList[t.id()]||{};var a=true;var o=false;var s=undefined;try{for(var c=Object.values(i)[Symbol.iterator](),l;!(a=(l=c.next()).done);a=true){var d=l.value;d.mediaRenderers.forEach(function(e){e.clear()});d.dispatchEvent({name:u.EndpointEvents.Removed,call:t,endpoint:d})}}catch(e){o=true;s=e}finally{try{if(!a&&c.return){c.return()}}finally{if(o){throw s}}}delete n._endpointList[t.id()];e()})}},{key:"endpointInfoUpdated",value:function e(t,n,r){var i=this._endpointInfo[t.id()]||{};var a=this._endpointList[t.id()]||{};i[r.id]=r;var o=a[r.id];if(o&&(n==f.Constants.VI_CONF_PARTICIPANT_INFO_ADDED||n===f.Constants.VI_CONF_PARTICIPANT_INFO_UPDATED)){var s=!o.sipUri;o.displayName=r.displayName;o.place=r.place;o.sipUri=r.sipURI;o.userName=r.username;if(s){t.dispatchEvent({name:d.CallEvents.EndpointAdded,call:t,endpoint:o})}else{o.dispatchEvent({name:u.EndpointEvents.InfoUpdated,call:t,endpoint:o})}}this._endpointInfo[t.id()]=i}},{key:"setEndpointDescription",value:function e(t,n){var r=this;if(!n)return;if(!n.endpoints)return;var i=this._endpointList[t.id()];var a=[];for(var o in i){if(i.hasOwnProperty(o)){if(!n.endpoints[o]&&o!==t.id())a.push(i[o])}}a.forEach(function(e){return r.deleteEndpoint(t,e)});var s={};var l={};for(var u in n.endpoints){if(n.endpoints.hasOwnProperty(u)){if(u==="")this.getDefaultEndPoint(t);else if(!i[u]){var d=new c.Endpoint(false);d.id=u;d.place=n.endpoints[u].place;this.addEndPoint(t,d)}if(n.endpoints[u].tracks){for(var f in n.endpoints[u].tracks){if(n.endpoints[u].tracks.hasOwnProperty(f)){s[f]=u;l[f]=n.endpoints[u].tracks[f]}}}}}this._trackListMap[t.id()]=s;this._trackKindMap[t.id()]=l}},{key:"useAudioOutput",value:function e(t,n){var r=this._endpointList[t.id()];if(r)Object.values(r).forEach(function(e){return e.useAudioOutput(n)})}},{key:"getEndpoints",value:function e(t){return Object.values(this._endpointList[t.id()]||{})}},{key:"registerCall",value:function e(t){this._endpointList[t.id()]={};this._trackListMap[t.id()]={};this._trackKindMap[t.id()]={};this._endpointInfo[t.id()]={};this._mediaRendererList[t.id()]=[]}}]);return e}();o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"setCallVolume",null);o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"_getEndpointByTrackId",null);o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"_getMediaTypeTrack",null);o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"addEndPoint",null);o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"getDefaultEndPoint",null);o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"deleteEndpoint",null);o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"addStreamToEndpoint",null);o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"addStream",null);o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"addTrack",null);o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"clear",null);o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"endpointInfoUpdated",null);o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"setEndpointDescription",null);o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"useAudioOutput",null);o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"getEndpoints",null);o([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"registerCall",null);t.AbstractEndpointManager=g},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,n,r)}}else if("value"in i){return i.value}else{var o=i.get;if(o===undefined){return undefined}return o.call(r)}};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function s(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}Object.defineProperty(t,"__esModule",{value:true});var c=n(15);var l=n(30);var u=n(0);var d=function(e){s(t,e);function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));n.isDefault=e;n.sipUri="";n.displayName="";n.userName="";n.mediaRenderers=[];n.addDefaultEventListener(l.EndpointEvents.RemoteMediaAdded,function(e){e.mediaRenderer.renderDefault()});n.logger=u.LogManager.get().createLogger(u.LogCategory.ENDPOINT,n._traceName()+" "+n.id);return n}r(t,[{key:"useAudioOutput",value:function e(t){this.logger.info("useAudioOutput("+t+")");if(this.mediaRenderers)this.mediaRenderers.forEach(function(e){return e.useAudioOutput(t)})}},{key:"updateInfo",value:function e(t){this.place=t.place;this.sipUri=t.sipURI;this.displayName=t.displayName;this.userName=t.username}},{key:"on",value:function e(n,r,a){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,n,r)}},{key:"off",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"off",this).call(this,n,r)}},{key:"_traceName",value:function e(){return"Endpoint"}}]);return t}(c.EventTarget);t.Endpoint=d},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var a=function(){function e(t){i(this,e);this.originalSDP=t}r(e,[{key:"getCodecList",value:function t(){this.originalCodecList={prefix:"",sections:[],sufix:""};var n=RegExp.prototype.test.bind(/^([a-z])=(.*)/);var r=e.splitSections(this.originalSDP);this.originalCodecList.prefix=r[0];for(var i=1;i<r.length;i++){var a={kind:"audio",firstLine:"",prefix:"",sufix:"",codec:[]};var o=r[i].split("\na=rtpmap");o=o.map(function(e,t){return(t>0?"a=rtpmap"+e:e).trim()+"\r\n"});a.prefix=o.shift();var s=o.pop();s=s.split(/(\r\n|\r|\n)/).filter(n);var c=true;o.push("");while(c){c=false;if(s.length!==0){var l=s.shift();if(l.indexOf("a=rtpmap")===0||l.indexOf("a=rtcp-fb")===0||l.indexOf("a=fmtp")===0||l.indexOf("a=x-caps")===0||l.indexOf("a=maxptime")===0){o[o.length-1]+=l+"\r\n";c=true}else s.unshift(l)}}for(var u=0;u<o.length;u++){a.codec.push(o[u].split(/(\r\n|\r|\n)/).filter(n))}var d=a.prefix.split(/(\r\n|\r|\n)/).filter(n);a.firstLine=d.shift();var f=a.firstLine.split(" ");f.splice(-1*a.codec.length,a.codec.length);a.kind=f[0].substring(2);a.prefix=d.join("\r\n")+"\r\n";a.firstLine=f.join(" ");if(s.length>0)a.sufix=s.join("\r\n")+"\r\n";this.originalCodecList.sections.push(a)}return this.originalCodecList}},{key:"getUserCodecList",value:function t(){if(typeof this.originalCodecList==="undefined")this.getCodecList();var n={sections:[]};n.sections=this.originalCodecList.sections.filter(function(e){return e.kind==="video"||e.kind==="audio"}).map(function(t,n,r){var i={kind:t.kind,codec:t.codec.map(function(t){return e.codecToUserCodec(t)})};var a=[];var o=true;var s=false;var c=undefined;try{for(var l=i.codec[Symbol.iterator](),u;!(o=(u=l.next()).done);o=true){var d=u.value;if(a.indexOf(d)===-1)a.push(d)}}catch(e){s=true;c=e}finally{try{if(!o&&l.return){l.return()}}finally{if(s){throw c}}}i.codec=a;return i});return n}},{key:"setUserCodecList",value:function t(n){if(typeof this.originalCodecList==="undefined")this.getCodecList();for(var r=0;r<n.sections.length;r++){if(n.sections[r].kind===this.originalCodecList.sections[r].kind){this.originalCodecList.sections[r].codec=e.resortSection(n.sections[r].codec,this.originalCodecList.sections[r].codec)}}}},{key:"getSDP",value:function e(){var t=this.originalCodecList.prefix;for(var n=0;n<this.originalCodecList.sections.length;n++){var r="";var i=[];for(var a=0;a<this.originalCodecList.sections[n].codec.length;a++){i.push(this.originalCodecList.sections[n].codec[a][0].split(" ")[0].substring(9));r+=this.originalCodecList.sections[n].codec[a].join("\r\n")+"\r\n"}t+=this.originalCodecList.sections[n].firstLine+" "+i.join(" ")+"\r\n";t+=this.originalCodecList.sections[n].prefix;t+=r;t+=this.originalCodecList.sections[n].sufix}return t}},{key:"_traceName",value:function e(){return"CodecSorter"}}],[{key:"splitSections",value:function e(t){var n=t.split("\nm=");return n.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})}},{key:"codecToUserCodec",value:function e(t){var n=t[0].split(" ");n.shift();return n.join(" ")}},{key:"resortSection",value:function t(n,r){var i=[];for(var a=0;a<n.length;a++){for(var o=0;o<r.length;o++){if(n[a]===e.codecToUserCodec(r[o])){i.push(r[o])}}}return i}},{key:"downOpusBandwidth",value:function e(t){return new Promise(function(e,n){var r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);var i=t.sdp.split(/(\r\n|\r|\n)/).filter(r);var a=false;for(var o=0;o<i.length;o++){if(i[o].indexOf("a=fmtp:114")!==-1){i[o]="a=fmtp:114 minptime=10; useinbandfec=1; sprop-maxcapturerate=8000";a=true}if(i[o].indexOf("a=fmtp:111")!==-1){i[o]="a=fmtp:111 minptime=10; useinbandfec=1; sprop-maxcapturerate=8000";a=true}}if(!a){n(t)}e(new RTCSessionDescription({sdp:i.join("\r\n")+"\r\n",type:t.type}))})}}]);return e}();t.CodecSorter=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=n(24);var i;(function(e){e[e["Chat"]="chat"]="Chat"})(i=t.MsgService||(t.MsgService={}));var a;(function(e){e[e["none"]=0]="none";e[e["can_write"]=1]="can_write";e[e["can_edit"]=2]="can_edit";e[e["can_remove"]=4]="can_remove";e[e["can_manage_participants"]=8]="can_manage_participants";e[e["can_edit_all"]=16]="can_edit_all";e[e["can_remove_all"]=32]="can_remove_all";e[e["is_owner"]=32768]="is_owner";e[e["all"]=65535]="all"})(a=t.MsgPermissions||(t.MsgPermissions={}))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var a=n(33);var o=n(28);var s=n(0);var c=n(3);var l=n(2);var u=n(20);var d=n(14);var f=n(1);var g="You can't set an operator status before login.";var p="The {0} status is not acceptable for the current operator state. The operator is {1} now. Please, check the ACD module documentation for details.";var v="The {0} status is set in your code after {1}. The {0} status is ignored.";var h="The operator status update failed by timeout.";var m="You try to perform multiple ACD operations at the same time. This can lead to an unexpected behavior of your application.";var y="You probably use the same credentials in the different browsers or multiple browser's windows. This can cause conflicts between instances.";var C="Wrong ACD status name {0}";var _=58e3;var S=function(){function e(){i(this,e)}r(e,null,[{key:"setConnectionId",value:function e(t){this._connectionId=t}},{key:"removeConnectionId",value:function e(){this._connectionId=void 0}},{key:"setStatus",value:function t(n){var r=this;return new Promise(function(t,i){e._checkBeforeRun(o.OperatorACDStatuses[n],i);var a=e.newUUID;l.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.setOperatorACDStatus,n,a);r._acdRequests.push({resolve:t,reject:i,timer:window.setTimeout(function(){e._acdRequests=e._acdRequests.filter(function(e){return e.uuid!==a});i(h)},_),uuid:a,status:n})})}},{key:"getStatus",value:function t(){var n=this;return new Promise(function(t,r){e._checkBeforeRun(void 0,r);var i=e.newUUID;l.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.getOperatorACDStatus,i);n._acdRequests.push({resolve:t,reject:r,timer:window.setTimeout(function(){e._acdRequests=e._acdRequests.filter(function(e){return e.uuid!==i});r(h)},_),uuid:i})})}},{key:"onStatusUpdated",value:function t(n,r){e._checkConnectionId(r);var i=e._getActorByUUID(r),a=i.actor,o=i.actorIdx;if(a){clearTimeout(a.timer);if(o!==0){for(var s=0;s<o;s++){clearTimeout(e._acdRequests[s].timer);e._acdRequests[s].reject(new Error(u.Utils.strFormat(v,a.status||"get operation",n)))}}if(typeof a.status==="undefined"||a.status===n){a.resolve(n)}else{a.reject(new Error(u.Utils.strFormat(p,a.status,n)))}e._acdRequests.splice(0,o+1)}f.Client.getInstance().dispatchEvent({name:d.Events.ACDStatusUpdated,id:e._getConnectonIdFromUUID(r),status:n})}},{key:"_checkBeforeRun",value:function t(n,r){if(!e._connectionId)r(new Error(g));if(e._acdRequests.length>0){s.LogManager.get().writeMessage(s.LogCategory.CLIENT,"ACD",s.LogLevel.WARNING,m);f.Client.getInstance().dispatchEvent({name:d.Events.ACDError,code:5,message:m})}if(typeof n!=="undefined"&&!Object.values(o.OperatorACDStatuses).includes(n))r(new Error(u.Utils.strFormat(C,n)))}},{key:"_getActorByUUID",value:function e(t){var n=-1;var r=this._acdRequests.find(function(e,r){if(e.uuid===t){n=r;return true}});return{actor:r,actorIdx:n}}},{key:"_getConnectonIdFromUUID",value:function t(n){var r=n.split("_");if(r.length===1||r[1]==="gw")return e._connectionId;return r[1]}},{key:"_checkConnectionId",value:function t(n){var r=n.split("_");if(r.length===1||r[1]!==e._connectionId){f.Client.getInstance().dispatchEvent({name:d.Events.ACDError,code:6,message:y});s.LogManager.get().writeMessage(s.LogCategory.CLIENT,"ACD",s.LogLevel.WARNING,y)}}},{key:"newUUID",get:function t(){return(new a.default).toString()+"_"+e._connectionId}}]);return e}();S._acdRequests=[];t.default=S},function(e,t,n){"use strict";var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)};r.localCName=r.generateIdentifier();r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})};r.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})};r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]};r.getMediaSections=function(e){var t=r.splitSections(e);t.shift();return t};r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return e.indexOf(t)===0})};r.parseCandidate=function(e){var t;if(e.indexOf("a=candidate:")===0){t=e.substring(12).split(" ")}else{t=e.substring(10).split(" ")}var n={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]};for(var r=8;r<t.length;r+=2){switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1];n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1];break}}return n};r.writeCandidate=function(e){var t=[];t.push(e.foundation);t.push(e.component);t.push(e.protocol.toUpperCase());t.push(e.priority);t.push(e.ip);t.push(e.port);var n=e.type;t.push("typ");t.push(n);if(n!=="host"&&e.relatedAddress&&e.relatedPort){t.push("raddr");t.push(e.relatedAddress);t.push("rport");t.push(e.relatedPort)}if(e.tcpType&&e.protocol.toLowerCase()==="tcp"){t.push("tcptype");t.push(e.tcpType)}if(e.usernameFragment||e.ufrag){t.push("ufrag");t.push(e.usernameFragment||e.ufrag)}return"candidate:"+t.join(" ")};r.parseIceOptions=function(e){return e.substr(14).split(" ")};r.parseRtpMap=function(e){var t=e.substr(9).split(" ");var n={payloadType:parseInt(t.shift(),10)};t=t[0].split("/");n.name=t[0];n.clockRate=parseInt(t[1],10);n.channels=t.length===3?parseInt(t[2],10):1;n.numChannels=n.channels;return n};r.writeRtpMap=function(e){var t=e.payloadType;if(e.preferredPayloadType!==undefined){t=e.preferredPayloadType}var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(n!==1?"/"+n:"")+"\r\n"};r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}};r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+"\r\n"};r.parseFmtp=function(e){var t={};var n;var r=e.substr(e.indexOf(" ")+1).split(";");for(var i=0;i<r.length;i++){n=r[i].trim().split("=");t[n[0].trim()]=n[1]}return t};r.writeFmtp=function(e){var t="";var n=e.payloadType;if(e.preferredPayloadType!==undefined){n=e.preferredPayloadType}if(e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){if(e.parameters[t]){r.push(t+"="+e.parameters[t])}else{r.push(t)}});t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t};r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}};r.writeRtcpFb=function(e){var t="";var n=e.payloadType;if(e.preferredPayloadType!==undefined){n=e.preferredPayloadType}if(e.rtcpFeedback&&e.rtcpFeedback.length){e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})}return t};r.parseSsrcMedia=function(e){var t=e.indexOf(" ");var n={ssrc:parseInt(e.substr(7,t-7),10)};var r=e.indexOf(":",t);if(r>-1){n.attribute=e.substr(t+1,r-t-1);n.value=e.substr(r+1)}else{n.attribute=e.substr(t+1)}return n};r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t){return t.substr(6)}};r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}};r.getDtlsParameters=function(e,t){var n=r.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:n.map(r.parseFingerprint)}};r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"});return n};r.getIceParameters=function(e,t){var n=r.splitLines(e);n=n.concat(r.splitLines(t));var i={usernameFragment:n.filter(function(e){return e.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:n.filter(function(e){return e.indexOf("a=ice-pwd:")===0})[0].substr(10)};return i};r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\n"+"a=ice-pwd:"+e.password+"\r\n"};r.parseRtpParameters=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]};var n=r.splitLines(e);var i=n[0].split(" ");for(var a=3;a<i.length;a++){var o=i[a];var s=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){var c=r.parseRtpMap(s);var l=r.matchPrefix(e,"a=fmtp:"+o+" ");c.parameters=l.length?r.parseFmtp(l[0]):{};c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb);t.codecs.push(c);switch(c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase());break;default:break}}}r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))});return t};r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ";n+=t.codecs.length>0?"9":"0";n+=" UDP/TLS/RTP/SAVPF ";n+=t.codecs.map(function(e){if(e.preferredPayloadType!==undefined){return e.preferredPayloadType}return e.payloadType}).join(" ")+"\r\n";n+="c=IN IP4 0.0.0.0\r\n";n+="a=rtcp:9 IN IP4 0.0.0.0\r\n";t.codecs.forEach(function(e){n+=r.writeRtpMap(e);n+=r.writeFmtp(e);n+=r.writeRtcpFb(e)});var i=0;t.codecs.forEach(function(e){if(e.maxptime>i){i=e.maxptime}});if(i>0){n+="a=maxptime:"+i+"\r\n"}n+="a=rtcp-mux\r\n";if(t.headerExtensions){t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)})}return n};r.parseRtpEncodingParameters=function(e){var t=[];var n=r.parseRtpParameters(e);var i=n.fecMechanisms.indexOf("RED")!==-1;var a=n.fecMechanisms.indexOf("ULPFEC")!==-1;var o=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="cname"});var s=o.length>0&&o[0].ssrc;var c;var l=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.substr(17).split(" ");return t.map(function(e){return parseInt(e,10)})});if(l.length>0&&l[0].length>1&&l[0][0]===s){c=l[0][1]}n.codecs.forEach(function(e){if(e.name.toUpperCase()==="RTX"&&e.parameters.apt){var n={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};if(s&&c){n.rtx={ssrc:c}}t.push(n);if(i){n=JSON.parse(JSON.stringify(n));n.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"};t.push(n)}}});if(t.length===0&&s){t.push({ssrc:s})}var u=r.matchPrefix(e,"b=");if(u.length){if(u[0].indexOf("b=TIAS:")===0){u=parseInt(u[0].substr(7),10)}else if(u[0].indexOf("b=AS:")===0){u=parseInt(u[0].substr(5),10)*1e3*.95-50*40*8}else{u=undefined}t.forEach(function(e){e.maxBitrate=u})}return t};r.parseRtcpParameters=function(e){var t={};var n;var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="cname"})[0];if(i){t.cname=i.value;t.ssrc=i.ssrc}var a=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=a.length>0;t.compound=a.length===0;var o=r.matchPrefix(e,"a=rtcp-mux");t.mux=o.length>0;return t};r.parseMsid=function(e){var t;var n=r.matchPrefix(e,"a=msid:");if(n.length===1){t=n[0].substr(7).split(" ");return{stream:t[0],track:t[1]}}var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="msid"});if(i.length>0){t=i[0].value.split(" ");return{stream:t[0],track:t[1]}}};r.generateSessionId=function(){return Math.random().toString().substr(2,21)};r.writeSessionBoilerplate=function(e,t){var n;var i=t!==undefined?t:2;if(e){n=e}else{n=r.generateSessionId()}return"v=0\r\n"+"o=thisisadapterortc "+n+" "+i+" IN IP4 127.0.0.1\r\n"+"s=-\r\n"+"t=0 0\r\n"};r.writeMediaSection=function(e,t,n,i){var a=r.writeRtpDescription(e.kind,t);a+=r.writeIceParameters(e.iceGatherer.getLocalParameters());a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),n==="offer"?"actpass":"active");a+="a=mid:"+e.mid+"\r\n";if(e.direction){a+="a="+e.direction+"\r\n"}else if(e.rtpSender&&e.rtpReceiver){a+="a=sendrecv\r\n"}else if(e.rtpSender){a+="a=sendonly\r\n"}else if(e.rtpReceiver){a+="a=recvonly\r\n"}else{a+="a=inactive\r\n"}if(e.rtpSender){var o="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+o;a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o;if(e.sendEncodingParameters[0].rtx){a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o;a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n";if(e.rtpSender&&e.sendEncodingParameters[0].rtx){a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"}return a};r.getDirection=function(e,t){var n=r.splitLines(e);for(var i=0;i<n.length;i++){switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2);default:}}if(t){return r.getDirection(t)}return"sendrecv"};r.getKind=function(e){var t=r.splitLines(e);var n=t[0].split(" ");return n[0].substr(2)};r.isRejected=function(e){return e.split(" ",2)[1]==="0"};r.parseMLine=function(e){var t=r.splitLines(e);var n=t[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}};r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0];var n=t.substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}};if(true){e.exports=r}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(18);var c=n(25);var l=n(34);var u=n(26);var d=n(0);var f=n(19);var g=n(24);var p=n(45);var v=n(27);var h=function(){function e(){var t=this;a(this,e);if(e.instance)throw new Error(p.MESSAGING_ERR_2);this.signalling=s.MsgSignaling.get();this.signalling.addEventListener(g.MsgEvent.onCreateConversation,function(e,n){t.resolveEvent(e,f.default.MessengerEvents.CreateConversation,n)});this.signalling.addEventListener(g.MsgEvent.onEditConversation,function(e,n){t.resolveEvent(e,f.default.MessengerEvents.EditConversation,n)});this.signalling.addEventListener(g.MsgEvent.onRemoveConversation,function(e,t){c.Messenger.getInstance()._dispatchEvent(f.default.MessengerEvents.RemoveConversation,{uuid:e.object.uuid,seq:e.seq,messengerAction:f.default.MessengerAction[e.on_incoming_event],initiator:Number(e.initiator),timestamp:typeof e.timestamp=="number"?e.timestamp*1e3:undefined,requestUuid:t},t)});this.signalling.addEventListener(g.MsgEvent.onGetConversation,function(e,n){t.resolveEvent(e,f.default.MessengerEvents.GetConversation,n)});this.signalling.addEventListener(g.MsgEvent.onGetPublicConversations,function(e,t){c.Messenger.getInstance()._dispatchEvent(f.default.MessengerEvents.GetPublicConversations,{conversations:e.object.uuid,initiator:Number(e.initiator),messengerAction:f.default.MessengerAction[e.on_incoming_event],requestUuid:t},t)});this.signalling.addEventListener(g.MsgEvent.onSendMessage,function(e,n){t.resolveMessageEvent(e,f.default.MessengerEvents.SendMessage,n)});this.signalling.addEventListener(g.MsgEvent.onEditMessage,function(e,n){t.resolveMessageEvent(e,f.default.MessengerEvents.EditMessage,n)});this.signalling.addEventListener(g.MsgEvent.onRemoveMessage,function(e,n){t.resolveMessageEvent(e,f.default.MessengerEvents.RemoveMessage,n)});this.signalling.addEventListener(g.MsgEvent.isRead,function(e,t){c.Messenger.getInstance()._dispatchEvent(f.default.MessengerEvents.Read,{conversation:e.object.conversation,seq:e.object.seq,initiator:Number(e.initiator),messengerAction:f.default.MessengerAction[e.on_incoming_event],requestUuid:t},t)});this.signalling.addEventListener(g.MsgEvent.onTyping,function(e,t){c.Messenger.getInstance()._dispatchEvent(f.default.MessengerEvents.Typing,{conversation:e.object.conversation,initiator:Number(e.initiator),messengerAction:f.default.MessengerAction[e.on_incoming_event],requestUuid:t},t)});this.signalling.addEventListener(g.MsgEvent.onRetransmitEvents,function(e,t){c.Messenger.getInstance()._dispatchEvent(f.default.MessengerEvents.RetransmitEvents,{events:[e.object&&e.object.event?e.object.event.indexOf("Message")==-1&&e.object.payload?{conversation:l.Conversation._createFromBus(e.object.payload.object,e.object.payload.seq),initiator:Number(e.object.payload.initiator),seq:e.object.payload.seq,messengerAction:f.default.MessengerAction[e.object.payload.on_incoming_event],timestamp:typeof e.object.payload.timestamp=="number"?e.object.payload.timestamp*1e3:undefined}:{message:u.Message._createFromBus(e.object.payload.object,Number(e.object.payload.initiator)),initiator:Number(e.object.payload.initiator),seq:e.object.payload.seq,timestamp:typeof e.object.payload.timestamp=="number"?e.object.payload.timestamp*1e3:undefined,messengerAction:f.default.MessengerAction[e.object.payload.on_incoming_event]}:undefined],initiator:Number(e.initiator),messengerAction:f.default.MessengerAction[e.on_incoming_event],requestUuid:t},t)})}r(e,[{key:"resolveEvent",value:function e(t,n,r){var i=l.Conversation._createFromBus(t.object,t.seq);if(typeof i!="undefined")i.updateSeq(t.seq);c.Messenger.getInstance()._dispatchEvent(n,{conversation:i,initiator:Number(t.initiator),seq:t.seq,messengerAction:f.default.MessengerAction[t.on_incoming_event],timestamp:typeof t.timestamp=="number"?t.timestamp*1e3:undefined,requestUuid:r},r)}},{key:"resolveMessageEvent",value:function e(t,n,r){var i=u.Message._createFromBus(t.object,Number(t.initiator));c.Messenger.getInstance()._dispatchEvent(n,{message:i,initiator:Number(t.initiator),seq:t.seq,messengerAction:f.default.MessengerAction[t.on_incoming_event],timestamp:typeof t.timestamp=="number"?t.timestamp*1e3:undefined},r)}},{key:"createConversation",value:function e(t,n,r,i,a,o){var s=this;return new Promise(function(e,u){var d=s.signalling.sendWsMessage(v.MsgAction.createConversation,new l.Conversation({participants:t,title:n,direct:r,publicJoin:i,customData:o,uberConversation:a})._getCreatePayload());c.Messenger.getInstance()._registerPromise(d,e,u)})}},{key:"editConversation",value:function e(t){var n=this;return new Promise(function(e,r){var i=void 0;var a=function t(n){if(n.requestUuid===i){clearTimeout(s);c.Messenger.getInstance().off(f.default.MessengerEvents.EditConversation,t);c.Messenger.getInstance().off(f.default.MessengerEvents.Error,o);e(n)}};var o=function e(n){if(n.requestUuid===i){clearTimeout(s);c.Messenger.getInstance().off(f.default.MessengerEvents.EditConversation,a);c.Messenger.getInstance().off(f.default.MessengerEvents.Error,e);t._revertChanges();r(n)}};var s=setTimeout(function(){c.Messenger.getInstance().off(f.default.MessengerEvents.EditConversation,a);c.Messenger.getInstance().off(f.default.MessengerEvents.Error,o);c.Messenger.getInstance().reject(f.default.MessengerError.Error_0,f.default.MessengerAction.editConversation).catch(r)},c.Messenger.rejectTimeout);c.Messenger.getInstance().on(f.default.MessengerEvents.EditConversation,a);c.Messenger.getInstance().on(f.default.MessengerEvents.Error,o);i=n.signalling.sendWsMessage(v.MsgAction.editConversation,t._getEditPayload())})}},{key:"getConversation",value:function e(t){var n=this;return new Promise(function(e,r){var i=n.signalling.sendWsMessage(v.MsgAction.getConversation,{uuid:t});c.Messenger.getInstance()._registerPromise(i,e,r)})}},{key:"getConversations",value:function e(t){if(!Array.isArray(t))return c.Messenger.getInstance().reject(f.default.MessengerError.Error_0,f.default.MessengerAction.getConversations);var n=void 0;var r=Promise.all(t.map(function(e){return new Promise(function(t,r){var i=function r(i){if(i.requestUuid===n&&i.conversation.uuid===e){clearTimeout(o);c.Messenger.getInstance().off(f.default.MessengerEvents.GetConversation,r);c.Messenger.getInstance().off(f.default.MessengerEvents.Error,a);t(i)}};var a=function e(t){if(t.requestUuid===n){clearTimeout(o);c.Messenger.getInstance().off(f.default.MessengerEvents.GetConversation,i);c.Messenger.getInstance().off(f.default.MessengerEvents.Error,e);r(t)}};var o=setTimeout(function(){c.Messenger.getInstance().off(f.default.MessengerEvents.GetConversation,i);c.Messenger.getInstance().off(f.default.MessengerEvents.Error,a);c.Messenger.getInstance().reject(f.default.MessengerError.Error_0,f.default.MessengerAction.getConversation).catch(r)},c.Messenger.rejectTimeout);c.Messenger.getInstance().on(f.default.MessengerEvents.GetConversation,i);c.Messenger.getInstance().on(f.default.MessengerEvents.Error,a)})}));n=this.signalling.sendWsMessage(v.MsgAction.getConversations,{uuid:t});return r}},{key:"getPublicConversations",value:function e(){var t=this;return new Promise(function(e,n){var r=t.signalling.sendWsMessage(v.MsgAction.getPublicConversations,{});c.Messenger.getInstance()._registerPromise(r,e,n)})}},{key:"_traceName",value:function e(){return"ConversationManager"}}],[{key:"get",value:function t(){e.instance=e.instance||new e;return e.instance}},{key:"deserialize",value:function e(t){return l.Conversation.createFromCache(t)}},{key:"serialize",value:function e(t){return t.toCache()}},{key:"extractUserName",value:function e(t){if(t.indexOf("@")===-1){return t}else{var n=t.split("@");n[1]=n[1].split(".").splice(0,2).join(".");return n.join("@")}}}]);return e}();o([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h.prototype,"resolveEvent",null);o([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h.prototype,"resolveMessageEvent",null);o([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h.prototype,"createConversation",null);o([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h.prototype,"editConversation",null);o([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h.prototype,"getConversation",null);o([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h.prototype,"getConversations",null);o([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h.prototype,"getPublicConversations",null);o([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h,"get",null);o([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h,"deserialize",null);o([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h,"serialize",null);o([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h,"extractUserName",null);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MESSAGING_ERR_1="Error - use Client.getIM()";t.MESSAGING_ERR_2="Error - use ConversationManager.get()"},function(e,t,n){"use strict";function r(e){for(var n in e){if(!t.hasOwnProperty(n))t[n]=e[n]}}Object.defineProperty(t,"__esModule",{value:true});var i=n(1);n(66);var a=n(11);var o=n(19);var s=n(19);t.Messaging=s.Messaging;var c=n(14);t.Events=c.Events;var l=n(5);t.CallEvents=l.CallEvents;var u=n(39);t.Endpoint=u.Endpoint;var d=n(30);t.EndpointEvents=d.EndpointEvents;var f=n(28);t.OperatorACDStatuses=f.OperatorACDStatuses;var g=n(0);t.LogCategory=g.LogCategory;t.LogLevel=g.LogLevel;t.ClientState=g.ClientState;r(n(4));function p(){return i.Client.getInstance()}t.getInstance=p;t.version=i.Client.getInstance().version;function v(){if(!a.Authenticator.get().authorized())throw new Error("NOT_AUTHORIZED");return o.default.Messenger.getInstance()}t.getMessenger=v},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var a=n(21);var o=n(0);var s=function(){function e(){i(this,e)}r(e,[{key:"_traceName",value:function e(){return"FF"}}],[{key:"attachStream",value:function e(t,n){if(typeof n.srcObject==="undefined"){n["mozSrcObject"]=t}else{n.srcObject=t}n.load();n.play()}},{key:"detachStream",value:function e(t){if(typeof t.srcObject==="undefined"){t["mozSrcObject"]=null}else{t.srcObject=null}t.load();t.src=""}},{key:"screenSharingSupported",value:function e(){return new Promise(function(e,t){if(window.location.protocol!="https:"){e(false);return}e(true)})}},{key:"getScreenMedia",value:function e(){var t={audio:false,video:{mediaSource:"window"||"screen"}};o.LogManager.get().writeMessage(o.LogCategory.USERMEDIA,"[constraints]",o.LogLevel.TRACE,JSON.stringify(t));return navigator.mediaDevices.getUserMedia(t)}},{key:"getRTCStats",value:function t(n){return new Promise(function(t,r){n.getStats(null).then(function(n){var r=[];n.forEach(function(e){if(e.type=="inbound-rtp"||e.type=="outbound-rtp")r.push(e)});t({raw:r,formatted:e.prepareRTCStats(n)})}).catch(r)})}},{key:"prepareRTCStats",value:function e(t){var n=[];t.forEach(function(e){if(e.type==="outbound-rtp"||e.isRemote){n.push(Object.assign(e,{framesPerSecond:e.framesPerSecond?e.framesPerSecond:e.framerateMean,encoderBitrate:e.bitrateMean}))}else{n.push(e)}});return n}},{key:"getUserMedia",value:function e(t){return navigator.mediaDevices.getUserMedia(t)}},{key:"getDTMFSender",value:function e(t,n){var r=/Firefox\/([0-9\.]+)(?:\s|$)/;var i=navigator.userAgent;if(r.test(i)){var o=r.exec(i);var s=o[1].split(".");if(+s[0]>=53){var c=t.getSenders().map(function(e){if(e.track&&e.track.kind==="audio"&&!!e.dtmf)return e.dtmf});if(c.length>0)return c[0]}}return new a.SignalingDTMFSender(n)}}]);return e}();t.FF=s},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var a=n(21);var o=n(1);var s=n(0);var c=function(){function e(){i(this,e)}r(e,[{key:"_traceName",value:function e(){return"Webkit"}}],[{key:"attachStream",value:function e(t,n){try{n.srcObject=t;n.load();if(n instanceof HTMLVideoElement)n.play().catch(function(e){});else{n.play().catch(function(e){});var r=o.Client.getInstance()._defaultSinkId;if(r!=null)n.setSinkId(r)}}catch(e){s.LogManager.get().writeMessage(s.LogCategory.USERMEDIA,"Webkit: ",s.LogLevel.WARNING,JSON.stringify(e))}}},{key:"detachStream",value:function e(t){t.srcObject=null;if(t instanceof HTMLVideoElement){var n=t.pause();if(typeof n!=="undefined")n.catch(function(e){})}else t.pause();t.src=""}},{key:"getDTMFSender",value:function e(t,n){if(!!t.createDTMFSender){var r=[];t["getLocalStreams"]().forEach(function(e){e.getAudioTracks().forEach(function(e){r.push(e)})});if(r.length){return t.createDTMFSender(r[0])}}else return new a.SignalingDTMFSender(n)}},{key:"getUserMedia",value:function e(t){return navigator.mediaDevices.getUserMedia(t)}},{key:"screenSharingSupported",value:function e(){return new Promise(function(e,t){if(navigator["getDisplayMedia"]){e(true)}else if(navigator.mediaDevices&&navigator.mediaDevices["getDisplayMedia"]){e(true)}else{var n=function t(n){if(n.origin===window.location.origin&&n.data==="VoximplantWebsdkExtensionLoaded"){window.removeEventListener("message",t);clearTimeout(r);e(true)}};window.addEventListener("message",n);window.postMessage("VoximplantWebsdkCheckExtension","*");var r=setTimeout(function(){window.removeEventListener("message",n);e(false)},800)}})}},{key:"getScreenMedia",value:function e(){if(navigator["getDisplayMedia"]){return navigator.getDisplayMedia({video:true})}else if(navigator.mediaDevices&&navigator.mediaDevices["getDisplayMedia"]){return navigator.mediaDevices["getDisplayMedia"]({video:true})}else{return new Promise(function(e,t){window.postMessage("voximplantWebsdkGetSourceId","*");var n=function n(r){if(!r.data||r.origin!==window.location.origin)return;if(!r.data.result)return;if(r.data.result==="err")return t(new Error(r.data.reason));if(r.data.result==="ok"&&typeof r.data.sourceId!=="undefined"){window.removeEventListener("message",n);var i={audio:false,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080,chromeMediaSourceId:r.data.sourceId},optional:[{googTemporalLayeredScreencast:true}]}};s.LogManager.get().writeMessage(s.LogCategory.USERMEDIA,"[constraints]",s.LogLevel.INFO,JSON.stringify(i));navigator.mediaDevices.getUserMedia(i).then(function(t){e(t)},function(e){t(e)})}};window.addEventListener("message",n)})}}},{key:"getRTCStats",value:function t(n){return new Promise(function(t,r){var i=[];n.getStats(null).then(function(n){n.forEach(function(e){if(e.type=="outbound-rtp"||e.type=="inbound-rtp"){i.push(e)}});t({raw:i,formatted:e.prepareRTCStats(n)});return}).catch(r)})}},{key:"prepareRTCStats",value:function e(t){var n=[];t.forEach(function(e){if(e.type==="inbound-rtp"&&e.isRemote){n.push(Object.assign(e,{type:"remote-inbound-rtp"}))}else if(e.type==="outbound-rtp"&&e.isRemote){n.push(Object.assign(e,{type:"remote-outbound-rtp"}))}else{n.push(e)}});return n}}]);return e}();t.Webkit=c},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function s(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var l=n(22);var u=n(7);var d=n(8);var f=n(0);var g=n(2);var p=n(6);var v=n(3);var h=n(40);var m=n(5);var y=n(17);var C=n(10);var _=n(16);var S=n(1);var E=n(32);var L=n(4);var M=n(23);var b=n(31);var R;(function(e){e[e["offer"]="offer"]="offer";e[e["answer"]="answer"]="answer";e[e["pranswer"]="pranswer"]="pranswer";e[e["rollback"]="rollback"]="rollback"})(R||(R={}));var T;(function(e){e[e["controlling"]="controlling"]="controlling";e[e["controlled"]="controlled"]="controlled"})(T||(T={}));var k=function(e){s(t,e);function t(e,n,r,i){a(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));s.iceTimer=null;s.needTransportRestart=true;s.ICE_TIMEOUT=2e4;s.RENEGOTIATION_TIMEOUT=15e3;s.canDeliverStats=true;s._canReInvite=function(){return s.impl.iceConnectionState==="connected"||s.impl.iceConnectionState==="completed"};s._needIceRestart=false;var c=d.PCFactory.get().iceConfig;var l=c;if(typeof l==="undefined"||l===null){l={gatherPolicy:"all",iceServers:[]}}if(i){l.iceServers=i}l.bundlePolicy="max-compat";if(u.default.getWSVendor()==="chrome"&&S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.unifiedPlan)l.sdpSemantics="unified-plan";s._createImpl(l);return s}r(t,[{key:"_createImpl",value:function e(t){var n=this;if(this.mode===l.PeerConnectionMode.CONFERENCE&&u.default.getWSVendor()==="chrome"){var r={mandatory:{},optional:[{googHighStartBitrate:true},{googHighBitrate:true},{googSkipEncodingUnusedStreams:true},{googScreencastMinBitrate:400},{googVeryHighBitrate:true},{googCpuOveruseDetection:true},{googCpuOveruseEncodeUsage:true},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85}]};var i=RTCPeerConnection;this.impl=new i(t,r)}else{this.impl=new RTCPeerConnection(t)}if(this.impl.getTransceivers&&u.default.getWSVendor()==="firefox")d.PCFactory.hasTransceivers=true;if(typeof this.impl.ontrack!=="undefined"){this.impl.ontrack=function(e){return n.onAddTrack(e)}}else if(typeof this.impl["onaddtrack"]!=="undefined"){this.impl["onaddtrack"]=function(e){return n.onAddTrack(e)}}else{this.impl["onaddstream"]=function(e){return n.onAddStream(e)}}this.impl.onicecandidate=function(e){n.onICECandidate(e["candidate"])};this.impl.oniceconnectionstatechange=function(e){if(n.impl.iceConnectionState==="completed"||n.impl.iceConnectionState==="connected"){n.iceTimer&&clearTimeout(n.iceTimer);n.iceTimer=null;if(n.reInviteQ)n.reInviteQ.runNext()}if(n.impl.iceConnectionState==="failed"){n.renegotiationInProgress=false;n._runReinvite(true)}};this.rtpSenders=[];this.renegotiationInProgress=false;this.impl.onnegotiationneeded=function(e){return n.onRenegotiation()};this.impl.onsignalingstatechange=function(e){return n.onSignalingStateChange()};this.impl.oniceconnectionstatechange=function(e){return n.onConnectionChange()};this.iceRole=T.controlling;this._remoteStreams=[];this.banReinviteAnswer=false;this._call=p.CallManager.get().calls[this.id];if(typeof this._call!="undefined")this.onHold=!this._call.active();else this.onHold=false;this.rtcCollectingCycle=setInterval(function(){n.getPCStats()},p.CallManager.get().rtcStatsInquiryInterval);if(typeof this._call!=="undefined"){var a=this._call.headers()[C.Constants.CALLSTATSIOID_HEADER];if(typeof a==="undefined")a=this._call.id();y.CallstatsIo.get().addNewFabric(this.impl,this._call.number(),this.videoEnabled?y.CallstatsIoFabricUsage.multiplex:y.CallstatsIoFabricUsage.audio,a)}this.needTransportRestart=false;if(this.id!=="_default"&&p.CallManager.get().calls[this.id])this.reInviteQ=new E.ReInviteQ(p.CallManager.get().calls[this.id],this._canReInvite)}},{key:"onSignalingStateChange",value:function e(){this.logger.info("Signal state changed to "+this.impl.signalingState+" for PC: "+this.id);if(this.impl.signalingState==="stable"){}}},{key:"getPCStats",value:function e(){var t=this;u.default.getRTCStats(this.impl).then(function(e){return p.CallManager.get().callStats.sendStatistics(t._call,e)})}},{key:"onConnectionChange",value:function e(){if(this.impl.iceConnectionState==="completed"){if(typeof this._call!=="undefined"){this._call.dispatchEvent({name:"ICECompleted",call:this._call})}}if(this.impl.iceConnectionState==="completed"||this.impl.iceConnectionState==="connected"){this.iceTimer&&clearTimeout(this.iceTimer);this.iceTimer=null;if(this.reInviteQ)this.reInviteQ.runNext()}b.CallStatsAnalyzer.get().checkICEConnection(this._call,this.impl.iceConnectionState)}},{key:"onRenegotiation",value:function e(){if(typeof this.impl==="undefined")return;if(this.impl.connectionState==="disconnected"||this.impl.connectionState==="failed"){this.logger.info("Renegotiation requested on closed PeerConnection");return}if(this.impl.localDescription===null){this.logger.info("Renegotiation needed, but no local SD. Skipping");return}if(this.impl.iceConnectionState!=="connected"&&this.impl.iceConnectionState!=="completed"){this.logger.info("Renegotiation requested while ice state is "+this.impl.iceConnectionState+". Postponing");setTimeout(this.onRenegotiation,100);return}if(this.renegotiationInProgress){this.logger.info("Renegotiation in progress. Queueing");return}else{this.logger.info("Renegotiation started")}this._runReinvite()}},{key:"_getLocalOfferRegular",value:function e(){var t=this;this.iceRole=T.controlling;return new Promise(function(e,n){var r=t.getReceiveOptions();t.impl.createOffer(r).then(function(e){t.logger.info("_getLocalOfferRegular(), created local SDP: \n"+e.sdp);var n={type:e.type,sdp:e.sdp};n=d.PCFactory.get().addBandwidthParams(n);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){n=_.SDPMuggle.removeTransportCC(n)}n=_.SDPMuggle.removeDoublePT(n);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.xas){n=_.SDPMuggle.addXAS(n)}return t.codecRearrange(n)}).then(function(e){t.srcLocalSDP=e.sdp;t.logger.info("_getLocalOfferRegular(), set local SDP: \n"+e.sdp);return t.impl.setLocalDescription(e)}).then(function(){e(t.impl.localDescription)}).catch(function(e){n(e)})})}},{key:"getReceiveOptions",value:function e(){return{offerToReceiveAudio:!this.onHold,offerToReceiveVideo:this.videoEnabled.receiveVideo&&!this.onHold}}},{key:"updateHoldState",value:function e(){var t=this;this.impl["getLocalStreams"]().forEach(function(e){e.getTracks().forEach(function(e){e.enabled=!t.onHold})});this.impl["getRemoteStreams"]().forEach(function(e){e.getTracks().forEach(function(e){e.enabled=!t.onHold})})}},{key:"onICECandidate",value:function e(t){if(t&&t!==null){this.sendLocalCandidateToPeer("a="+t.candidate,t.sdpMLineIndex)}else{this.logger.info("End of candidates")}}},{key:"onAddTrack",value:function e(t){if(this._call){M.EndpointManager.get().addTrack(this._call,t.track)}}},{key:"onAddStream",value:function e(t){if(this._call){M.EndpointManager.get().addStream(this._call,t.stream)}}},{key:"_processRemoteAnswer",value:function e(t,n){var r=this;if(this._pendingOffer){return new Promise(function(e,i){r.logger.info("_processRemoteAnswer(), set local SDP: \n"+r._pendingOffer.sdp);r.impl.setLocalDescription(r._pendingOffer).then(function(){e(r._processRemoteAnswer(t,n))});r._pendingOffer=void 0})}else{if(n.length===0&&this._call){this.logger.error("Empty SDP from server. Call will be terminated.");this._call.hangup({"X-WebRTCError":"no sdp"});return}this.iceTimer=setTimeout(function(){r._call.notifyICETimeout()},this.ICE_TIMEOUT);this.pendingEvent=[t,n];if(this.impl.remoteDescription!==null)if(this.impl.remoteDescription.sdp!="")return;var i={sdp:n,type:R.answer};this.srcRemoteSDP=n;i=_.SDPMuggle.removeTIAS(i);this.logger.info("_processRemoteAnswer(), set remote SDP: \n"+i.sdp);return this.impl.setRemoteDescription(i).then(function(e){if(r._needIceRestart){r._runReinvite(true)}})}}},{key:"_getLocalOffer",value:function e(){if(u.default.getWSVendor()==="firefox"&&this.impl.remoteDescription&&this.impl.remoteDescription.sdp&&this.impl.remoteDescription.sdp.indexOf("VIMS")===-1){return this._getLocalOfferFF()}else{return this._getLocalOfferRegular()}}},{key:"_getLocalOfferFF",value:function e(){var t=this;this.iceRole=T.controlling;return new Promise(function(e,n){var r=t.getReceiveOptions();t.impl.createOffer(r).then(function(e){t.logger.info("_getLocalOfferFF(), created local SDP: \n"+e.sdp);var n={type:e.type,sdp:e.sdp};n=_.SDPMuggle.removeDoublePT(n);n=d.PCFactory.get().addBandwidthParams(n);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){n=_.SDPMuggle.removeTransportCC(n)}if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.xas){n=_.SDPMuggle.addXAS(n)}return t.codecRearrange(n)}).then(function(n){t.srcLocalSDP=n.sdp;t._pendingOffer=n;e(n)}).catch(function(e){n(e)})})}},{key:"_getLocalAnswer",value:function e(){var t=this;this.iceRole=T.controlled;return new Promise(function(e,n){var r={mandatory:t.getReceiveOptions()};t.impl.createAnswer(r).then(function(e){t.logger.info("_getLocalAnswer(), created local SDP: \n"+e.sdp);var n={type:e.type,sdp:e.sdp};n=d.PCFactory.get().addBandwidthParams(n);n=_.SDPMuggle.removeDoublePT(n);n=_.SDPMuggle.fixVideoRecieve(n,t._call.settings.videoDirections.receiveVideo);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){n=_.SDPMuggle.removeTransportCC(n)}if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.xas){n=_.SDPMuggle.addXAS(n)}return t.codecRearrange(n)}).then(function(e){t.srcLocalSDP=e.sdp;t.logger.info("_getLocalAnswer(), set local SDP: \n"+e.sdp);return t.impl.setLocalDescription(e)}).then(function(){e({type:R.answer,sdp:t.impl.localDescription.sdp})}).catch(function(e){n(e)})})}},{key:"_processRemoteOffer",value:function e(t){var n=this;if(t.length===0&&this._call){this.logger.error("Empty SDP from server. Call will be terminated.");this._call.hangup({"X-WebRTCError":"no sdp"});return}this.iceRole=T.controlled;return new Promise(function(e,r){var i=new RTCSessionDescription({sdp:t,type:R.offer});if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){i=_.SDPMuggle.removeTransportCC(i)}n.srcRemoteSDP=t;i=_.SDPMuggle.removeTIAS(i);i=_.SDPMuggle.fixFFMIDBug(i);n.logger.info("_processRemoteOffer(), set remote SDP: \n"+i.sdp);n.impl.setRemoteDescription(i).then(function(){var e={mandatory:n.getReceiveOptions()};return n.impl.createAnswer(e)}).then(function(e){n.logger.info("_processRemoteOffer(), created local SDP: \n"+e.sdp);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){e=_.SDPMuggle.removeTransportCC(e)}e=_.SDPMuggle.removeDoublePT(e);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.xas){e=_.SDPMuggle.addXAS(e)}return n.codecRearrange(e)}).then(function(e){n.srcLocalSDP=e.sdp;n.logger.info("_processRemoteOffer(), set local SDP: \n"+e.sdp);return n.impl.setLocalDescription(e)}).then(function(){e(n.impl.localDescription.sdp)}).catch(function(e){r(e)})})}},{key:"_setRemoteDescription",value:function e(t){if(t.length===0&&this._call){this.logger.error("Empty SDP from server. Call will be terminated.");this._call.hangup({"X-WebRTCError":"no sdp"});return}var n=new RTCSessionDescription({sdp:t,type:R.offer});n=_.SDPMuggle.removeTIAS(n);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){n=_.SDPMuggle.removeTransportCC(n)}this.srcRemoteSDP=t;this.logger.info("_setRemoteDescription(), set remote SDP: \n"+n.sdp);return this.impl.setRemoteDescription(n)}},{key:"_handleReinvite",value:function e(t,n){var r=this;if(n.length===0&&this._call){this.logger.error("Empty SDP from server. Call will be terminated.");this._call.hangup({"X-WebRTCError":"no sdp"});return}return new Promise(function(e,i){if(r.banReinviteAnswer){i(new Error)}if(r.renegotiationInProgress===false){r.renegotiationInProgress=true;var a={sdp:n,type:R.offer};if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){a=_.SDPMuggle.removeTransportCC(a)}r.srcRemoteSDP=n;a=_.SDPMuggle.removeTIAS(a);r.logger.info("_handleReinvite(), set remote SDP: \n"+a.sdp);r.impl.setRemoteDescription(a).then(function(){var n={mandatory:r.getReceiveOptions()};r.impl.createAnswer(n).then(function(n){r.logger.info("_handleReinvite(), created local SDP: \n"+n.sdp);var a={type:n.type,sdp:n.sdp};a=_.SDPMuggle.fixVideoRecieve(a,r.videoEnabled.receiveVideo);a=_.SDPMuggle.removeDoublePT(a);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){a=_.SDPMuggle.removeTransportCC(a)}if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.xas){a=_.SDPMuggle.addXAS(a)}r.srcLocalSDP=a.sdp;try{r.logger.info("_handleReinvite(), set local SDP: \n"+a.sdp);r.impl.setLocalDescription(a).then(function(){var n={tracks:r.getTrackKind()};g.VoxSignaling.get().callRemoteFunction(v.RemoteFunction.acceptReInvite,r._call.id(),t,r.impl.localDescription.sdp,n);r.renegotiationInProgress=false;r._call.dispatchEvent({name:m.CallEvents.Updated,result:true,call:r._call});r.updateHoldState();setTimeout(function(e){return r._fixTransreceiver()},0);e()})}catch(e){r.renegotiationInProgress=false;setTimeout(function(e){return r._fixTransreceiver()},0);i(e)}})})}else if(r.renegotiationInProgress===true){var o={sdp:n,type:R.answer};r.renegotiationInProgress=false;if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){o=_.SDPMuggle.removeTransportCC(o)}if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.xas){o=_.SDPMuggle.addXAS(o)}r.srcRemoteSDP=n;o=_.SDPMuggle.removeTIAS(o);r.logger.info("_handleReinvite(), set local SDP: \n"+r.pendingOffer.sdp);r.impl.setLocalDescription(r.pendingOffer).then(function(){try{r.logger.info("_handleReinvite(), set remote SDP: \n"+o.sdp);r.impl.setRemoteDescription(o).then(function(){r._call.dispatchEvent({name:m.CallEvents.Updated,result:true,call:r._call});r.updateHoldState();setTimeout(function(e){return r._fixTransreceiver()},0);e()})}catch(e){r._call.dispatchEvent({name:m.CallEvents.Updated,result:false,call:r._call});r.renegotiationInProgress=false;r.logger.error(JSON.stringify(e));setTimeout(function(e){return r._fixTransreceiver()},0);i(e)}clearTimeout(r.renegotiationTimer)})}else{i(new Error("Universe was broken!"))}})}},{key:"_close",value:function e(){var t=this;clearInterval(this.rtcCollectingCycle);this.impl.onnegotiationneeded=null;var n=S.Client.getInstance().config();if(this.impl.removeTrack){this.rtpSenders.forEach(function(e){t.impl.removeTrack(e)});L.default.StreamManager.get().remCallStream(this._call)}else{L.default.StreamManager.get().remCallStream(this._call);this.impl["getLocalStreams"]().forEach(function(e){t.impl["removeStream"](e)})}this.impl.close();if(typeof this._call!=="undefined")y.CallstatsIo.get().sendFabricEvent(this.impl,y.CallstatsIoFabricEvent.fabricTerminated,this._call.id());this._localStream=null;this._remoteStreams=null}},{key:"_addRemoteCandidate",value:function e(t,n){var r=this;return new Promise(function(e,i){try{r.impl.addIceCandidate(new RTCIceCandidate({candidate:t.substring(2),sdpMLineIndex:n})).then(function(){e()}).catch(function(){e()})}catch(t){e()}})}},{key:"setConfiguration",value:function e(t){var n=this;if(this.impl){setTimeout(function(){if(n.srcRemoteSDP&&n.srcRemoteSDP.indexOf("VIMS")===-1){if(n.impl&&n.impl.setConfiguration){n.impl.setConfiguration(t);n.renegotiationInProgress=false;n._runReinvite(true)}else{if(n._pendingOffer){var e=[];n.impl.getTransceivers().map(function(t){if(t.sender.track)e.push(t.sender.track)});n._createImpl(t);e.forEach(function(e){n.impl.addTrack(e,new MediaStream([e]))});n.impl.createOffer().then(function(e){n.logger.info("setConfiguration(), created local SDP: \n"+e.sdp);n._needIceRestart=true;n.logger.info("setConfiguration(), set local SDP: \n"+n._pendingOffer.sdp);return n.impl.setLocalDescription(n._pendingOffer)}).then(function(){n._pendingOffer=void 0}).catch(function(e){console.error(e)})}}}else{}},800)}}},{key:"_fixTransreceiver",value:function e(){if(this.impl&&this.impl.getTransceivers){this.impl.getTransceivers().forEach(function(e){if(e.currentDirection==="inactive"&&e.receiver.track&&!e.sender.track){if(e.receiver.track.onended){e.receiver.track.stop();e.receiver.track.onended(null)}}})}}},{key:"codecRearrange",value:function e(t){var n=this;return new Promise(function(e,r){var i=p.CallManager.get().calls[n.id];if(typeof i!=="undefined"){var a=new h.CodecSorter(t.sdp);var o=a.getUserCodecList();if(typeof i.rearangeCodecs!=="undefined"){i.rearangeCodecs(o,i.settings.incoming).then(function(n){a.setUserCodecList(n);e({type:t.type,sdp:a.getSDP()})},function(e){n.logger.error(JSON.stringify(e));r(e)})}else{n.logger.info("No sdp transformer registered");a.setUserCodecList(o);e({type:t.type,sdp:a.getSDP()})}}else{e(t)}})}},{key:"_sendDTMF",value:function e(t,n,r){if(typeof this.dtmfSender!=="undefined"){this.dtmfSender.insertDTMF(t,n,r)}}},{key:"_hold",value:function e(t){var n=this;y.CallstatsIo.get().sendFabricEvent(this.impl,t?y.CallstatsIoFabricEvent.fabricHold:y.CallstatsIoFabricEvent.fabricResume,this._call.id());this.onHold=t;setTimeout(function(){if(n.impl.getTransceivers&&u.default.getWSVendor()==="firefox"){n.impl.getTransceivers().forEach(function(e){if(t)e.direction="sendonly";else e.direction="sendrecv"})}else{n.onRenegotiation()}},0)}},{key:"_getDirections",value:function e(){var t={};t["local"]=_.SDPMuggle.detectDirections(this.impl.localDescription.sdp);t["remote"]=_.SDPMuggle.detectDirections(this.impl.remoteDescription.sdp);return t}},{key:"_getStreamActivity",value:function e(){var t={};t["local"]=this.getMediaActivity(this.impl["getLocalStreams"]());t["remote"]=this.getMediaActivity(this.impl["getRemoteStreams"]());return t}},{key:"getMediaActivity",value:function e(t){return t.map(function(e){return e.getTracks().map(function(e){return{id:e.id,kind:e.kind,mutted:e.muted,active:e.enabled,label:e.label}})})}},{key:"_hdnFRSPrep",value:function e(){this.banReinviteAnswer=true}},{key:"_hdnFRS",value:function e(){this.renegotiationInProgress=false;this.onRenegotiation()}},{key:"_traceName",value:function e(){return"WebRTCPC"}},{key:"hasLocalAudio",value:function e(){return this.impl["getLocalStreams"]().some(function(e){if(e.getAudioTracks().length)return true;else return false})}},{key:"hasLocalVideo",value:function e(){var t=this;return this.impl["getLocalStreams"]().some(function(e){return e.getVideoTracks().some(function(e){if(!t.shareScreenMedia||!t.shareScreenMedia.some(function(t){return t.getTracks().some(function(t){return t.id===e.id})})){return true}else{return false}})})}},{key:"enableVideo",value:function e(t){var n=[];if(this._call)n=L.default.StreamManager.get()._getScreenSharing(this._call)||[];var r=[];n.forEach(function(e){return e.stream.getTracks().forEach(function(e){return r.push(e.id)})});this.impl["getLocalStreams"]().forEach(function(e){e.getVideoTracks().forEach(function(e){if(!r.some(function(t){return e.id===t})){e.enabled=t}})})}},{key:"getTransceivers",value:function e(){if(this.impl.getTransceivers)return this.impl.getTransceivers();else return[]}},{key:"getRemoteDescription",value:function e(){if(this.impl.remoteDescription&&this.impl.remoteDescription.sdp)return this.impl.remoteDescription.sdp;else return""}},{key:"_addCustomMedia",value:function e(t){var n=this;if(!t)return;if(u.default.getWSVendor()==="firefox"){t.getTracks().forEach(function(e){var t=new MediaStream([e]);n.rtpSenders.push(n.impl.addTrack(e,t));n.onRenegotiation()})}else{this.impl["addStream"](t)}if(!this.dtmfSender&&this._call){var r=u.default.getDTMFSender(this.impl,this._call.id());if(r)this.dtmfSender=r}}},{key:"_removeCustomMedia",value:function e(t){var n=this;if(!t)return;if(u.default.getWSVendor()==="firefox"){if(this.impl.getTransceivers){var r=this.impl.getTransceivers();r.forEach(function(e){if(t.getTracks().find(function(t){return t.id===e.sender.track.id})){e.stop()}})}else{this.impl.getSenders().forEach(function(e){if(t.getTracks().indexOf(e.track)!==-1)n.impl.removeTrack(e)})}}else{this.impl["removeStream"](t)}}},{key:"_updateCustomMedia",value:function e(t){var n=this;if(!t||this.impl.signalingState==="closed")return;t.getTracks().forEach(function(e){var t=n.impl.getSenders().find(function(t){return t.track&&t.track.kind===e.kind});if(t)t.replaceTrack(e)})}},{key:"_fixFFSoundBug",value:function e(){var t=this;if(u.default.getWSVendor()==="firefox"&&d.PCFactory.hasTransceivers){setTimeout(function(){if(t.impl.getSenders){var e=t.impl.getSenders();e.forEach(function(e){if(e.replaceTrack){var t=e.track;e.replaceTrack(t)}})}},1e3)}}},{key:"getConfiguration",value:function e(){if(this.impl)return this.impl.getConfiguration();return null}},{key:"_runReinvite",value:function e(){var t=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.renegotiationInProgress===false){this.renegotiationInProgress=true;var r={};if(!(this.impl.getTransceivers&&u.default.getWSVendor()==="firefox"))r=this.getReceiveOptions();if(n){r.iceRestart=true}this.logger.trace(JSON.stringify(r));this.updateHoldState();this.impl.createOffer(r).then(function(e){t.logger.info("_runReinvite(), created local SDP: \n"+e.sdp);return t.codecRearrange(e)}).then(function(e){var n={type:e.type,sdp:e.sdp};n=d.PCFactory.get().addBandwidthParams(n);n=_.SDPMuggle.removeDoublePT(n);n=_.SDPMuggle.removeTelephoneEvents(n);n=_.SDPMuggle.fixVideoRecieve(n,t.videoEnabled.receiveVideo);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){n=_.SDPMuggle.removeTransportCC(n)}if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.xas){n=_.SDPMuggle.addXAS(n)}return n}).then(function(e){t.srcLocalSDP=e.sdp;t.pendingOffer=e;return e}).then(function(){var e={tracks:t.getTrackKind()};g.VoxSignaling.get().callRemoteFunction(v.RemoteFunction.reInvite,t._call.id(),{},t.pendingOffer.sdp,e)}).catch(function(e){t.logger.error("Error when renegatiation start "+e.message)})}else{this.logger.error("Another renegatiation in progress")}}}]);return t}(l.PeerConnection);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_createImpl",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"onSignalingStateChange",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"getPCStats",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"onConnectionChange",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"onRenegotiation",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_getLocalOfferRegular",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"getReceiveOptions",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"updateHoldState",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"onICECandidate",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"onAddTrack",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"onAddStream",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_processRemoteAnswer",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_getLocalOffer",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_getLocalOfferFF",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_getLocalAnswer",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_setRemoteDescription",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_handleReinvite",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_close",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_addRemoteCandidate",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"setConfiguration",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"codecRearrange",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_sendDTMF",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_hold",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_getStreamActivity",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"getMediaActivity",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_hdnFRSPrep",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_hdnFRS",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"hasLocalAudio",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"hasLocalVideo",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"enableVideo",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_addCustomMedia",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_removeCustomMedia",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_updateCustomMedia",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_fixFFSoundBug",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"getConfiguration",null);t.WebRTCPC=k},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=n(35);t.AudioDeviceManager=r.AudioDeviceManager;var i=n(36);t.CameraManager=i.CameraManager;var a=n(29);t.StreamManager=a.StreamManager;var o=n(51);t.IOSCacheManager=o.IOSCacheManager},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var a=n(0);var o=function(){function e(){i(this,e);this._cachedChecksum=0;this._lastCameraParams={};this._lastAudioParams={};if(typeof e.instance!=="undefined")throw new Error("Error - use StreamManager.get()")}r(e,[{key:"getStream",value:function e(t){var n=this;return new Promise(function(e,r){if(n._localMedia&&n._localMedia.active&&n._cachedChecksum===n.getChecksumm(t)){e(n._localMedia);return}navigator.mediaDevices.getUserMedia(t).then(function(r){a.LogManager.get().writeMessage(a.LogCategory.USERMEDIA,"IOSCacheManager",a.LogLevel.INFO,"Media access granted");n._cachedChecksum=n.getChecksumm(t);n._localMedia=r;e(r)}).catch(function(e){a.LogManager.get().writeMessage(a.LogCategory.USERMEDIA,"IOSCacheManager",a.LogLevel.ERROR,"Media access denied: "+(e?e.message||e.name||e:"unknown"));r(e)})})}},{key:"getChecksumm",value:function e(t){var n=0;if(t.audio)n++;if(t.video)n++;return n}},{key:"clear",value:function e(t){for(var n in this._callRendererList[t.id()]){if(this._callRendererList[t.id()].hasOwnProperty(n))delete this._callRendererList[t.id()][n]}delete this._callRendererList[t.id()]}},{key:"registerMediaRenderer",value:function e(t,n){}},{key:"diffCameraParams",value:function e(t){return this.fastDiffObjects(this._lastCameraParams,t)}},{key:"diffAudioParams",value:function e(t){return this.fastDiffObjects(this._lastAudioParams,t)}},{key:"fastDiffObjects",value:function e(t,n){return Object.keys(t).length!==Object.keys(n).length?false:Object.keys(t).every(function(e){return t[e]===n[e]})}}],[{key:"get",value:function t(){if(typeof e.instance==="undefined")e.instance=new e;return e.instance}}]);return e}();t.IOSCacheManager=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function s(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var l=n(38);var u=n(0);var d=n(16);var f=function(e){s(t,e);function t(){a(this,t);return o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}r(t,[{key:"getEndpointByTrack",value:function e(t,n){var r=this.getRtrackId(t,n.id);return this._getEndpointByTrackId(t,r)}},{key:"getRtrackId",value:function e(t,n){if(typeof t.peerConnection!=="undefined"){var r=t.peerConnection.getTransceivers();for(var i=0;i<r.length;i++){if(r[i].mid!==null&&r[i].receiver.track.id===n){var a=d.SDPMuggle.findTrackByMid(t.peerConnection.getRemoteDescription(),r[i].mid);if(a)return a}}}else{return""}}},{key:"getMediaTypeTrack",value:function e(t,n){var r=this.getRtrackId(t,n.id);return this._getMediaTypeTrack(t,{id:r,kind:n.kind})}},{key:"_traceName",value:function e(){return"TransceiversEndpointManager"}}]);return t}(l.AbstractEndpointManager);c([u.LogManager.d_trace(u.LogCategory.ENDPOINT)],f.prototype,"getEndpointByTrack",null);c([u.LogManager.d_trace(u.LogCategory.ENDPOINT)],f.prototype,"getMediaTypeTrack",null);t.TransceiversEndpointManager=f},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}Object.defineProperty(t,"__esModule",{value:true});var s=n(38);var c=function(e){o(t,e);function t(){i(this,t);return a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}r(t,[{key:"_traceName",value:function e(){return"PlainEndpointManager"}},{key:"getEndpointByTrack",value:function e(t,n){return this._getEndpointByTrackId(t,n.id)}},{key:"getMediaTypeTrack",value:function e(t,n){return this._getMediaTypeTrack(t,n)}}]);return t}(s.AbstractEndpointManager);t.PlainEndpointManager=c},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,n,r)}}else if("value"in i){return i.value}else{var o=i.get;if(o===undefined){return undefined}return o.call(r)}};var a=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,o=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":a(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o}return i>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var u=n(12);var d=n(2);var f=n(6);var g=n(0);var p=n(3);var v=function(e){c(t,e);function t(e,n,r,i){o(this,t);var a=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,i));a.settings.mode=u.CallMode.SERVER;return a}r(t,[{key:"answer",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"answer",this).call(this,n,r);var a={tracks:this.peerConnection.getTrackKind()};d.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.acceptCall,this.settings.id,f.CallManager.cleanHeaders(r),a)}},{key:"_traceName",value:function e(){return"CallExServer"}}]);return t}(u.Call);l([g.LogManager.d_trace(g.LogCategory.CALLEXSERVER)],v.prototype,"answer",null);t.CallExServer=v},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,n,r)}}else if("value"in i){return i.value}else{var o=i.get;if(o===undefined){return undefined}return o.call(r)}};var a=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,o=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":a(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o}return i>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var u=n(12);var d=n(2);var f=n(0);var g=n(3);var p=n(10);var v=n(1);var h=n(4);var m=n(5);var y=function(e){c(t,e);function t(){o(this,t);return s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}r(t,[{key:"answer",value:function e(n,r,o){var s=this;i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"answer",this).call(this,n,r);if(typeof n!="undefined"){if(typeof r=="undefined"||(typeof r==="undefined"?"undefined":a(r))!=="object")r={};r[p.Constants.CALL_DATA_HEADER]=n}this._answerHeaders=r;var c=v.Client.getInstance().config();return new Promise(function(e,t){s._answerPromise=e;if((typeof o==="undefined"?"undefined":a(o))==="object")s.settings.videoDirections=o;var n=function e(){h.default.StreamManager.get().getCallStream(s).then(function(e){s._peerConnection.fastAddCustomMedia(e);s._peerConnection.getLocalAnswer().then(function(e){var t={tracks:s.peerConnection.getTrackKind()};d.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.acceptCall,s.id(),s._answerHeaders,e.sdp,t);s._peerConnection._fixFFSoundBug();s._answerPromise()}).catch(function(){})}).catch(function(e){return t(e)})};if(s._peerConnection){n()}else{setTimeout(n,600)}})}},{key:"setActive",value:function e(t){var n=this;if(t===this.settings.active){return new Promise(function(e,t){t({name:m.CallEvents["Updated"],result:false,call:n})})}this._setActive(t);return this.peerConnection.hold(!t)}},{key:"_traceName",value:function e(){return"CallExMedia"}}]);return t}(u.Call);l([f.LogManager.d_trace(f.LogCategory.CALL)],y.prototype,"answer",null);l([f.LogManager.d_trace(f.LogCategory.CALL)],y.prototype,"setActive",null);t.CallExMedia=y},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=function(){function e(){a(this,e)}r(e,[{key:"_traceName",value:function e(){return"CodecSorterHelpers"}}],[{key:"H264Sorter",value:function e(t,n){if(!n)return new Promise(function(e){for(var n=0;n<t.sections.length;n++){if(t.sections[n].kind.toLowerCase()=="video"){t.sections[n].codec.sort(function(e,t){if(e.toLowerCase().indexOf("h264")!=-1&&e.toLowerCase().indexOf("uc")==-1)return-1;if(t.toLowerCase().indexOf("h264")!=-1&&t.toLowerCase().indexOf("uc")==-1)return 1;return 0})}}e(t)});else return new Promise(function(e){for(var n=0;n<t.sections.length;n++){if(t.sections[n].kind.toLowerCase()=="video"){var r=t.sections[n].codec.filter(function(e){return e.toLowerCase().indexOf("h264")!=-1&&e.toLowerCase().indexOf("uc")==-1});if(r.length)t.sections[n].codec=r}}e(t)})}},{key:"VP8Sorter",value:function e(t,n){return new Promise(function(e,n){for(var r=0;r<t.sections.length;r++){if(t.sections[r].kind.toLowerCase()=="video"){t.sections[r].codec.sort(function(e,t){if(e.toLowerCase().indexOf("vp8")!=-1)return-1;if(t.toLowerCase().indexOf("vp8")!=-1)return 1;return 0})}}e(t)})}}]);return e}();o([s.LogManager.d_trace(s.LogCategory.RTC)],c,"H264Sorter",null);o([s.LogManager.d_trace(s.LogCategory.RTC)],c,"VP8Sorter",null);t.CodecSorterHelpers=c},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var c=n(5);var l=n(6);var u=n(0);var d=n(31);var f=function(){function e(){o(this,e);this._calls=new WeakMap}r(e,[{key:"addCall",value:function e(t){if(t&&(typeof t==="undefined"?"undefined":i(t))==="object"){this._calls.set(t,{});d.CallStatsAnalyzer.get().addCall(t)}}},{key:"deleteCall",value:function e(t){if(t&&(typeof t==="undefined"?"undefined":i(t))==="object"&&this._calls.has(t)){this._calls.get(t).nextDeliveryTimer&&clearTimeout(this._calls.get(t).nextDeliveryTimer);this._calls.delete(t)}d.CallStatsAnalyzer.get().deleteCall(t);return Promise.resolve(true)}},{key:"sendStatistics",value:function e(t,n){var r=this;if(t&&(typeof t==="undefined"?"undefined":i(t))==="object"){if(!this._calls.has(t)){this.addCall(t)}var o=this._calls.get(t);if(!o.nextDeliveryTimer){var s=n.formatted.filter(function(e){return e.type==="inbound-rtp"});var u=n.formatted.filter(function(e){return e.type==="track"&&s.some(function(t){return t.trackId===e.id})});var f={jitterBuffer:u.reduce(function(e,t){return Object.assign(e,a({},t.id,{delay:t.jitterBufferDelay,emittedCount:t.jitterBufferEmittedCount}))},{})};var g=window.setTimeout(function(){return r._calls.set(t,{prevStats:f})},l.CallManager.get().rtcStatsCollectionInterval);t.dispatchEvent({name:c.CallEvents.RTCStatsReceived,stats:n.raw});t.dispatchEvent({name:c.CallEvents.CallStatsReceived,stats:this.getCallStats(t,n.formatted,o.prevStats)});this._calls.set(t,{nextDeliveryTimer:g})}d.CallStatsAnalyzer.get().analyzeCallStats(t,n.formatted)}}},{key:"getCallStats",value:function e(t){var n=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var o=r.find(function(e){return e.type==="candidate-pair"&&(e.selected||e.nominated&&e.state==="succeeded")});var s=o&&r.find(function(e){return e.type==="local-candidate"&&e.id===o.localCandidateId});var c=o?o.timestamp:r[0]&&r[0].timestamp;var l=r.filter(function(e){return e.type==="track"});var u=r.filter(function(e){return e.type==="codec"});var d=r.filter(function(e){return e.type==="inbound-rtp"});var f=d.filter(function(e){return e.mediaType==="audio"});var g=d.filter(function(e){return e.mediaType==="video"});var p=r.filter(function(e){return e.type==="outbound-rtp"});var v=p.filter(function(e){return e.mediaType==="audio"});var h=p.filter(function(e){return e.mediaType==="video"});var m=t.getEndpoints();var y=function e(t){var r=t.reduce(function(e,t){var r=l.find(function(e){return e.kind===t.kind&&e.trackIdentifier===t.id})||{};var a=r&&d.find(function(e){return e.trackId===r.id})||{};var o=i.jitterBuffer&&i.jitterBuffer[r.id]&&i.jitterBuffer[r.id].delay?i.jitterBuffer[r.id].delay:0;var s=i.jitterBuffer&&i.jitterBuffer[r.id]&&i.jitterBuffer[r.id].emittedCount?i.jitterBuffer[r.id].emittedCount:0;var f={bytesReceived:(a.bytesReceived||0)+(e.bytesReceived||0),packetsReceived:(a.packetsReceived||0)+(e.packetsReceived||0),packetsLost:(a.packetsLost||0)+(e.packetsLost||0),loss:n.getLoss(a),jitterBufferMs:r.jitterBufferDelay!==undefined&&r.jitterBufferEmittedCount!==undefined?r.jitterBufferEmittedCount-s?(r.jitterBufferDelay-o)*1e3/(r.jitterBufferEmittedCount-s)+(e.jitterBufferMs||0):0:undefined,codec:(a&&a.codecId&&u.find(function(e){return e.id===a.codecId})||{mimeType:undefined}).mimeType,timestamp:c};if(t.kind==="video"){return Object.assign(f,{frameHeight:r&&r.frameHeight,frameWidth:r&&r.frameWidth})}return f},{});if(t.length>1&&r.jitterBufferMs){r.jitterBufferMs=r.jitterBufferMs/t.length}return r};return{availableOutgoingBitrate:o&&o.availableOutgoingBitrate,localCandidateType:s&&s.candidateType,networkType:s&&s.networkType,remoteCandidateType:o&&(r.find(function(e){return e.type==="remote-candidate"&&e.id===o.remoteCandidateId})||{}).candidateType,rtt:o&&o.currentRoundTripTime,timestamp:c,totalBytesReceived:this.sumByProp(d,"bytesReceived"),totalBytesSent:this.sumByProp(p,"bytesSent"),totalLoss:this.getLoss(d),totalPacketsLost:this.sumByProp(d,"packetsLost"),totalPacketsReceived:this.sumByProp(d,"packetsReceived"),totalPacketsSent:this.sumByProp(p,"packetsSent"),audioBytesReceived:this.sumByProp(f,"bytesReceived"),audioBytesSent:this.sumByProp(v,"bytesSent"),audioLoss:this.getLoss(f),audioPacketsLost:this.sumByProp(f,"packetsLost"),audioPacketsReceived:this.sumByProp(f,"packetsReceived"),audioPacketsSent:this.sumByProp(v,"packetsSent"),videoBytesReceived:this.sumByProp(g,"bytesReceived"),videoBytesSent:this.sumByProp(h,"bytesSent"),videoLoss:this.getLoss(g),videoPacketsLost:this.sumByProp(g,"packetsLost"),videoPacketsReceived:this.sumByProp(g,"packetsReceived"),videoPacketsSent:this.sumByProp(h,"packetsSent"),localAudioStats:v.length?v.reduce(function(e,t){return e.set(t.id,{bytesSent:t.bytesSent,packetsSent:t.packetsSent,timestamp:t.timestamp,audioLevel:(l.find(function(e){return e.id===t.trackId})||{audioLevel:undefined}).audioLevel,codec:(u.find(function(e){return e.id===t.codecId})||{mimeType:undefined}).mimeType})},new Map):new Map,localVideoStats:h.length?h.reduce(function(e,t){return e.set(t.id,{bytesSent:t.bytesSent,packetsSent:t.packetsSent,timestamp:t.timestamp,frameHeight:(l.find(function(e){return e.id===t.trackId})||{frameHeight:undefined}).frameHeight,frameWidth:(l.find(function(e){return e.id===t.trackId})||{frameWidth:undefined}).frameWidth,encoderBitrate:t.encoderBitrate,targetBitrate:t.targetBitrate,fps:t.framesPerSecond,codec:(u.find(function(e){return e.id===t.codecId})||{mimeType:undefined}).mimeType})},new Map):new Map,endpointStats:m.length?m.reduce(function(e,t){var r=t.mediaRenderers.reduce(function(e,t){return t.stream&&t.stream.getTracks().filter(function(e){return e.kind==="audio"}).length?Object.assign(e,a({},t.stream.id,y(t.stream.getTracks().filter(function(e){return e.kind==="audio"})))):e},{});var i=t.mediaRenderers.reduce(function(e,t){return t.stream&&t.stream.getTracks().filter(function(e){return e.kind==="video"}).length?Object.assign(e,a({},t.stream.id,y(t.stream.getTracks().filter(function(e){return e.kind==="video"})))):e},{});var o=Object.values(r).concat(Object.values(i));return e.set(t.id,{audioBytesReceived:n.sumByProp(Object.values(r),"bytesReceived"),audioPacketsLost:n.sumByProp(Object.values(r),"packetsLost"),audioPacketsReceived:n.sumByProp(Object.values(r),"packetsReceived"),videoBytesReceived:n.sumByProp(Object.values(i),"bytesReceived"),videoPacketsLost:n.sumByProp(Object.values(i),"packetsLost"),videoPacketsReceived:n.sumByProp(Object.values(i),"packetsReceived"),totalBytesReceived:n.sumByProp(o,"bytesReceived"),totalPacketsReceived:n.sumByProp(o,"packetsReceived"),remoteAudioStats:r,remoteVideoStats:i,timestamp:c})},new Map):new Map}}},{key:"getLoss",value:function e(t){if(!t.length){return 0}var n=t.reduce(function(e,t){return{lost:e.lost+(t.packetsLost||0),total:e.total+(t.packetsLost||0)+(t.packetsReceived||0)}},{lost:0,total:0});return n.total?n.lost/n.total:0}},{key:"sumByProp",value:function e(t,n){return t.length?t.map(function(e){return e[n]}).reduce(function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return e+t},0):0}},{key:"_traceName",value:function e(){return"CallStatsManager"}},{key:"calls",get:function e(){return this._calls}}],[{key:"get",value:function t(){if(typeof this.inst=="undefined"){this.inst=new e}return this.inst}}]);return e}();s([u.LogManager.d_trace(u.LogCategory.RTC)],f.prototype,"addCall",null);s([u.LogManager.d_trace(u.LogCategory.RTC)],f.prototype,"deleteCall",null);t.CallStatsManager=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e[e["Firefox"]=0]="Firefox";e[e["Chrome"]=1]="Chrome"})(r=t.BrowserMode||(t.BrowserMode={}));var i;(function(e){e[e["audio"]="audio"]="audio";e[e["video"]="video"]="video";e[e["sharing"]="sharing"]="sharing"})(i=t.TrackType||(t.TrackType={}));var a;(function(e){e[e["ALREADY_IN_THIS_STATE"]=0]="ALREADY_IN_THIS_STATE";e[e["FUNCTIONALITY_IS_DISABLED"]=1]="FUNCTIONALITY_IS_DISABLED";e[e["INCORRECT_OPERATION"]=2]="INCORRECT_OPERATION";e[e["INTERNAL_ERROR"]=3]="INTERNAL_ERROR";e[e["MEDIA_IS_ON_HOLD"]=4]="MEDIA_IS_ON_HOLD";e[e["REJECTED"]=5]="REJECTED";e[e["TIMEOUT"]=6]="TIMEOUT"})(a=t.CallError||(t.CallError={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){var t=void 0;(function(e){e[e["Critical"]="CRITICAL"]="Critical";e[e["Major"]="MAJOR"]="Major";e[e["Minor"]="MINOR"]="Minor";e[e["None"]="NONE"]="None"})(t=e.QualityIssueLevel||(e.QualityIssueLevel={}))})(r=t.Statistic||(t.Statistic={}))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var a=function(){function e(){i(this,e)}r(e,[{key:"_traceName",value:function e(){return"Edge"}}],[{key:"attachStream",value:function e(t,n){n.srcObject=t;n.play()}},{key:"detachStream",value:function e(t){t.pause();t.src=""}},{key:"getScreenMedia",value:function e(){if(navigator.getDisplayMedia){return navigator.getDisplayMedia()}return new Promise(function(e,t){t(new Error("Screen sharing not allowed for you platform"))})}},{key:"getRTCStats",value:function e(t){return new Promise(function(e,t){t(new Error("RTCStats sharing not allowed for you platform"))})}},{key:"screenSharingSupported",value:function e(){return new Promise(function(e,t){if(navigator.getDisplayMedia){e(true);return}e(false)})}}]);return e}();t.Edge=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var a=n(21);var o=n(0);var s=function(){function e(){i(this,e)}r(e,[{key:"_traceName",value:function e(){return"Safari"}}],[{key:"attachStream",value:function e(t,n){n.srcObject=t}},{key:"detachStream",value:function e(t){if(t instanceof HTMLVideoElement){var n=t.pause();if(typeof n!="undefined")n.catch(function(e){})}else t.pause();t.src=""}},{key:"getDTMFSender",value:function e(t,n){return new a.SignalingDTMFSender(n)}},{key:"getScreenMedia",value:function e(){return new Promise(function(e,t){window.postMessage("get-sourceId","*");window.addEventListener("message",function(n){if(n.origin==window.location.origin){if(n.data=="PermissionDeniedError"){t(new Error("PermissionDeniedError"))}if(typeof n.data!="string"&&typeof n.data.sourceId!="undefined"){var r={audio:false,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080,chromeMediaSourceId:n.data.sourceId},optional:[{googTemporalLayeredScreencast:true}]}};o.LogManager.get().writeMessage(o.LogCategory.USERMEDIA,"[constraints]",o.LogLevel.INFO,JSON.stringify(r));navigator.mediaDevices.getUserMedia(r).then(function(t){e(t)}).catch(function(e){t(e)})}}})})}},{key:"getRTCStats",value:function t(n){return new Promise(function(t,r){var i=[];n.getStats(null).then(function(n){n.forEach(function(e){if(e.type=="ssrc"){var t={};t.id=e.id;t.type=e.type;t.timestamp=e.timestamp;i.push(t)}});t({raw:i,formatted:e.prepareRTCStats(n)})}).catch(r)})}},{key:"prepareRTCStats",value:function e(t){var n=[];t.forEach(function(e){if(e.type==="track"&&!e.kind){n.push(Object.assign(e,{kind:e.id.includes("audio")?"audio":e.id.includes("video")?"video":undefined}))}else if(e.type==="outbound-rtp"||e.type==="inbound-rtp"){n.push(Object.assign(e,{trackId:e.mediaTrackId}))}else{n.push(e)}});return n}}]);return e}();t.Safari=s},function(e,t,n){!function(n,r){true?e.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof t?t.bowser=r():n.bowser=r()}(this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=86)}({17:function(e,t,n){var r,i,a;i=[t],void 0===(a="function"==typeof(r=function(n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t=e,i=[{key:"getFirstMatch",value:function(e,t){var n=t.match(e);return n&&n.length>0&&n[1]||""}},{key:"getSecondMatch",value:function(e,t){var n=t.match(e);return n&&n.length>1&&n[2]||""}},{key:"matchAndReturnConst",value:function(e,t,n){if(e.test(t))return n}},{key:"getWindowsVersionName",value:function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}},{key:"getAndroidVersionName",value:function(e){var t=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":void 0}},{key:"getVersionPrecision",value:function(e){return e.split(".").length}},{key:"compareVersions",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.getVersionPrecision(t),a=e.getVersionPrecision(n),o=Math.max(i,a),s=0,c=e.map([t,n],function(t){var n=o-e.getVersionPrecision(t),r=t+new Array(n+1).join(".0");return e.map(r.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});for(r&&(s=o-Math.min(i,a)),o-=1;o>=s;){if(c[0][o]>c[1][o])return 1;if(c[0][o]===c[1][o]){if(o===s)return 0;o-=1}else if(c[0][o]<c[1][o])return-1}}},{key:"map",value:function(e,t){var n,r=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n+=1)r.push(t(e[n]));return r}}],(n=null)&&r(t.prototype,n),i&&r(t,i),e;var t,n,i}();n.default=i,e.exports=t.default})?r.apply(t,i):r)||(e.exports=a)},86:function(e,t,n){var r,i,a;i=[t,n(87)],void 0===(a="function"==typeof(r=function(n,r){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,r=(a=r)&&a.__esModule?a:{default:a};var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t=e,a=[{key:"getParser",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("string"!=typeof e)throw new Error("UserAgent should be a string");return new r.default(e,t)}},{key:"parse",value:function(e){return new r.default(e).getResult()}}],(n=null)&&i(t.prototype,n),a&&i(t,a),e;var t,n,a}();n.default=o,e.exports=t.default})?r.apply(t,i):r)||(e.exports=a)},87:function(e,t,n){var r,i,a;i=[t,n(88),n(89),n(90),n(91),n(17)],void 0===(a="function"==typeof(r=function(n,r,i,a,o,s){"use strict";function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,r=c(r),i=c(i),a=c(a),o=c(o),s=c(s);var d=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),null==t||""===t)throw new Error("UserAgent parameter can't be empty");this._ua=t,this.parsedResult={},!0!==n&&this.parse()}return t=e,(n=[{key:"getUA",value:function(){return this._ua}},{key:"test",value:function(e){return e.test(this._ua)}},{key:"parseBrowser",value:function(){var e=this;this.parsedResult.browser={};var t=r.default.find(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser}},{key:"getBrowser",value:function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}},{key:"getBrowserName",value:function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}},{key:"getBrowserVersion",value:function(){return this.getBrowser().version}},{key:"getOS",value:function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}},{key:"parseOS",value:function(){var e=this;this.parsedResult.os={};var t=i.default.find(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os}},{key:"getOSName",value:function(e){var t=this.getOS(),n=t.name;return e?String(n).toLowerCase()||"":n||""}},{key:"getOSVersion",value:function(){return this.getOS().version}},{key:"getPlatform",value:function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}},{key:"getPlatformType",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getPlatform(),n=t.type;return e?String(n).toLowerCase()||"":n||""}},{key:"parsePlatform",value:function(){var e=this;this.parsedResult.platform={};var t=a.default.find(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform}},{key:"getEngine",value:function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}},{key:"getEngineName",value:function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}},{key:"parseEngine",value:function(){var e=this;this.parsedResult.engine={};var t=o.default.find(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine}},{key:"parse",value:function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}},{key:"getResult",value:function(){return Object.assign({},this.parsedResult)}},{key:"satisfies",value:function(e){var t=this,n={},r=0,i={},a=0,o=Object.keys(e);if(o.forEach(function(t){var o=e[t];"string"==typeof o?(i[t]=o,a+=1):"object"===l(o)&&(n[t]=o,r+=1)}),r>0){var s=Object.keys(n),c=s.find(function(e){return t.isOS(e)});if(c){var u=this.satisfies(n[c]);if(void 0!==u)return u}var d=s.find(function(e){return t.isPlatform(e)});if(d){var f=this.satisfies(n[d]);if(void 0!==f)return f}}if(a>0){var g=Object.keys(i),p=g.find(function(e){return t.isBrowser(e)});if(void 0!==p)return this.compareVersion(i[p])}}},{key:"isBrowser",value:function(e){return this.getBrowserName(!0)===String(e).toLowerCase()}},{key:"compareVersion",value:function(e){var t=[0],n=e,r=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(n=e.substr(1),"="===e[1]?(r=!0,n=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?n=e.substr(1):"~"===e[0]&&(r=!0,n=e.substr(1)),t.indexOf(s.default.compareVersions(i,n,r))>-1}},{key:"isOS",value:function(e){return this.getOSName(!0)===String(e).toLowerCase()}},{key:"isPlatform",value:function(e){return this.getPlatformType(!0)===String(e).toLowerCase()}},{key:"isEngine",value:function(e){return this.getEngineName(!0)===String(e).toLowerCase()}},{key:"is",value:function(e){return this.isBrowser(e)||this.isOS(e)||this.isPlatform(e)}},{key:"some",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.some(function(t){return e.is(t)})}}])&&u(t.prototype,n),c&&u(t,c),e;var t,n,c}();n.default=d,e.exports=t.default})?r.apply(t,i):r)||(e.exports=a)},88:function(e,t,n){var r,i,a;i=[t,n(17)],void 0===(a="function"==typeof(r=function(n,r){"use strict";var i;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,r=(i=r)&&i.__esModule?i:{default:i};var a=/version\/(\d+(\.?_?\d+)+)/i,o=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},n=r.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||r.default.getFirstMatch(a,e);return n&&(t.version=n),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},n=r.default.getFirstMatch(a,e)||r.default.getFirstMatch(/(?:opera)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},n=r.default.getFirstMatch(/(?:opr|opios)[\s\/](\S+)/i,e)||r.default.getFirstMatch(a,e);return n&&(t.version=n),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},n=r.default.getFirstMatch(a,e)||r.default.getFirstMatch(/(?:SamsungBrowser)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},n=r.default.getFirstMatch(a,e)||r.default.getFirstMatch(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},n=r.default.getFirstMatch(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i,e)||r.default.getFirstMatch(a,e);return n&&(t.version=n),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},n=r.default.getFirstMatch(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i,e)||r.default.getFirstMatch(a,e);return n&&(t.version=n),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},n=r.default.getFirstMatch(/(?:swing)[\s\/](\d+(?:\.\d+)+)/i,e)||r.default.getFirstMatch(a,e);return n&&(t.version=n),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},n=r.default.getFirstMatch(a,e)||r.default.getFirstMatch(/(?:coast)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},n=r.default.getFirstMatch(a,e)||r.default.getFirstMatch(/(?:yabrowser)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},n=r.default.getFirstMatch(a,e)||r.default.getFirstMatch(/(?:ucbrowser)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},n=r.default.getFirstMatch(a,e)||r.default.getFirstMatch(/(?:Maxthon|mxios)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},n=r.default.getFirstMatch(a,e)||r.default.getFirstMatch(/(?:epiphany)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},n=r.default.getFirstMatch(a,e)||r.default.getFirstMatch(/(?:puffin)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},n=r.default.getFirstMatch(a,e)||r.default.getFirstMatch(/(?:sleipnir)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},n=r.default.getFirstMatch(a,e)||r.default.getFirstMatch(/(?:k-meleon)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},n=r.default.getFirstMatch(/(?:micromessenger)[\s\/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(a,e);return n&&(t.version=n),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},n=r.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},n=r.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},n=r.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},n=r.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},n=r.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return n&&(t.version=n),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},n=r.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},n=r.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},n=r.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},n=r.default.getFirstMatch(a,e)||r.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},n=r.default.getFirstMatch(a,e)||r.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},n=r.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},n=r.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(a,e);return n&&(t.version=n),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},n=r.default.getFirstMatch(/(?:qupzilla)[\s\/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(a,e);return n&&(t.version=n),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},n=r.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},n=r.default.getFirstMatch(/(?:chromium)[\s\/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(a,e);return n&&(t.version=n),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},n=r.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t={name:"Android Browser"},n=r.default.getFirstMatch(a,e);return n&&(t.version=n),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},n=r.default.getFirstMatch(a,e);return n&&(t.version=n),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},n=r.default.getFirstMatch(a,e);return n&&(t.version=n),t}},{test:[/.*/i],describe:function(e){return{name:r.default.getFirstMatch(/^(.*)\/(.*) /,e),version:r.default.getSecondMatch(/^(.*)\/(.*) /,e)}}}];n.default=o,e.exports=t.default})?r.apply(t,i):r)||(e.exports=a)},89:function(e,t,n){var r,i,a;i=[t,n(17)],void 0===(a="function"==typeof(r=function(n,r){"use strict";var i;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,r=(i=r)&&i.__esModule?i:{default:i};var a=[{test:[/windows phone/i],describe:function(e){var t=r.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:"Windows Phone",version:t}}},{test:[/windows/i],describe:function(e){var t=r.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),n=r.default.getWindowsVersionName(t);return{name:"Windows",version:t,versionName:n}}},{test:[/macintosh/i],describe:function(e){var t=r.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,".");return{name:"macOS",version:t}}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=r.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:"iOS",version:t}}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t=r.default.getFirstMatch(/android[\s\/-](\d+(\.\d+)*)/i,e),n=r.default.getAndroidVersionName(t),i={name:"Android",version:t};return n&&(i.versionName=n),i}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=r.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),n={name:"WebOS"};return t&&t.length&&(n.version=t),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=r.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||r.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||r.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:"BlackBerry",version:t}}},{test:[/bada/i],describe:function(e){var t=r.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:"Bada",version:t}}},{test:[/tizen/i],describe:function(e){var t=r.default.getFirstMatch(/tizen[\/\s](\d+(\.\d+)*)/i,e);return{name:"Tizen",version:t}}},{test:[/linux/i],describe:function(){return{name:"Linux"}}},{test:[/CrOS/],describe:function(){return{name:"Chrome OS"}}},{test:[/PlayStation 4/],describe:function(e){var t=r.default.getFirstMatch(/PlayStation 4[\/\s](\d+(\.\d+)*)/i,e);return{name:"PlayStation 4",version:t}}}];n.default=a,e.exports=t.default})?r.apply(t,i):r)||(e.exports=a)},90:function(e,t,n){var r,i,a;i=[t,n(17)],void 0===(a="function"==typeof(r=function(n,r){"use strict";var i;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,r=(i=r)&&i.__esModule?i:{default:i};var a={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},o=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=r.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",n={type:a.mobile,vendor:"Huawei"};return t&&(n.model=t),n}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:a.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:a.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:a.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:a.tablet,vendor:"Amazon"}}},{test:[/tablet/i],describe:function(){return{type:a.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),n=e.test(/like (ipod|iphone)/i);return t&&!n},describe:function(e){var t=r.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:a.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:a.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:a.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:a.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:a.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:a.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:a.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:a.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:a.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:a.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:a.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:a.tv}}}];n.default=o,e.exports=t.default})?r.apply(t,i):r)||(e.exports=a)},91:function(e,t,n){var r,i,a;i=[t,n(17)],void 0===(a="function"==typeof(r=function(n,r){"use strict";var i;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,r=(i=r)&&i.__esModule?i:{default:i};var a=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){var t=r.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:"EdgeHTML",version:t}}},{test:[/trident/i],describe:function(e){var t={name:"Trident"},n=r.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:"Presto"},n=r.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=e.test(/gecko/i),n=e.test(/like gecko/i);return t&&!n},describe:function(e){var t={name:"Gecko"},n=r.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:"Blink"}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:"WebKit"},n=r.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}}];n.default=a,e.exports=t.default})?r.apply(t,i):r)||(e.exports=a)}})})},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function s(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=undefined&&undefined.__decorate||function(e,t,n,r){var a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])o=(a<3?s(o):a>3?s(t,n,o):s(t,n))||o}return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:true});var l=n(22);var u=n(7);var d=n(8);var f=n(0);var g=n(2);var p=n(6);var v=n(3);var h=n(40);var m=n(5);var y=n(17);var C=n(10);var _=n(16);var S=n(1);var E=n(32);var L=n(4);var M=n(23);var b=n(31);var R;(function(e){e[e["offer"]="offer"]="offer";e[e["answer"]="answer"]="answer";e[e["pranswer"]="pranswer"]="pranswer";e[e["rollback"]="rollback"]="rollback"})(R||(R={}));var T;(function(e){e[e["controlling"]="controlling"]="controlling";e[e["controlled"]="controlled"]="controlled"})(T||(T={}));var k=function(e){s(t,e);function t(e,n,r,i){a(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));s.iceTimer=null;s.needTransportRestart=true;s.ICE_TIMEOUT=2e4;s.RENEGOTIATION_TIMEOUT=15e3;s.canDeliverStats=true;s._canReInvite=function(){return s.impl.iceConnectionState==="connected"||s.impl.iceConnectionState==="completed"};s._needIceRestart=false;var c=d.PCFactory.get().iceConfig;var l=c;if(typeof l==="undefined"||l===null){l={gatherPolicy:"all",iceServers:[]}}if(i){l.iceServers=i}l.bundlePolicy="max-compat";if(u.default.getWSVendor()==="chrome"&&S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.unifiedPlan)l.sdpSemantics="unified-plan";s._createImpl(l);return s}r(t,[{key:"_createImpl",value:function e(t){var n=this;if(this.mode===l.PeerConnectionMode.CONFERENCE&&u.default.getWSVendor()==="chrome"){var r={mandatory:{},optional:[{googHighStartBitrate:true},{googHighBitrate:true},{googSkipEncodingUnusedStreams:true},{googScreencastMinBitrate:400},{googVeryHighBitrate:true},{googCpuOveruseDetection:true},{googCpuOveruseEncodeUsage:true},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85}]};var i=RTCPeerConnection;this.impl=new i(t,r)}else{this.impl=new RTCPeerConnection(t)}if(this.impl.getTransceivers&&u.default.getWSVendor()==="firefox")d.PCFactory.hasTransceivers=true;if(typeof this.impl.ontrack!=="undefined"){this.impl.ontrack=function(e){return n.onAddTrack(e)}}else if(typeof this.impl["onaddtrack"]!=="undefined"){this.impl["onaddtrack"]=function(e){return n.onAddTrack(e)}}else{this.impl["onaddstream"]=function(e){return n.onAddStream(e)}}this.impl.onicecandidate=function(e){n.onICECandidate(e["candidate"])};this.impl.oniceconnectionstatechange=function(e){if(n.impl.iceConnectionState==="completed"||n.impl.iceConnectionState==="connected"){n.iceTimer&&clearTimeout(n.iceTimer);n.iceTimer=null;if(n.reInviteQ)n.reInviteQ.runNext()}if(n.impl.iceConnectionState==="failed"){n.renegotiationInProgress=false;n._runReinvite(true)}};this.rtpSenders=[];this.renegotiationInProgress=false;this.impl.onnegotiationneeded=function(e){return n.onRenegotiation()};this.impl.onsignalingstatechange=function(e){return n.onSignalingStateChange()};this.impl.oniceconnectionstatechange=function(e){return n.onConnectionChange()};this.iceRole=T.controlling;this._remoteStreams=[];this.banReinviteAnswer=false;this._call=p.CallManager.get().calls[this.id];if(typeof this._call!="undefined")this.onHold=!this._call.active();else this.onHold=false;this.rtcCollectingCycle=setInterval(function(){n.getPCStats()},p.CallManager.get().rtcStatsInquiryInterval);if(typeof this._call!=="undefined"){var a=this._call.headers()[C.Constants.CALLSTATSIOID_HEADER];if(typeof a==="undefined")a=this._call.id();y.CallstatsIo.get().addNewFabric(this.impl,this._call.number(),this.videoEnabled?y.CallstatsIoFabricUsage.multiplex:y.CallstatsIoFabricUsage.audio,a)}this.needTransportRestart=false;if(this.id!=="_default"&&p.CallManager.get().calls[this.id])this.reInviteQ=new E.ReInviteQ(p.CallManager.get().calls[this.id],this._canReInvite)}},{key:"onSignalingStateChange",value:function e(){this.logger.info("Signal state changed to "+this.impl.signalingState+" for PC: "+this.id);if(this.impl.signalingState==="stable"){}}},{key:"getPCStats",value:function e(){var t=this;u.default.getRTCStats(this.impl).then(function(e){return p.CallManager.get().callStats.sendStatistics(t._call,e)})}},{key:"onConnectionChange",value:function e(){if(this.impl.iceConnectionState==="completed"){if(typeof this._call!=="undefined"){this._call.dispatchEvent({name:"ICECompleted",call:this._call})}}if(this.impl.iceConnectionState==="completed"||this.impl.iceConnectionState==="connected"){this.iceTimer&&clearTimeout(this.iceTimer);this.iceTimer=null;if(this.reInviteQ)this.reInviteQ.runNext()}b.CallStatsAnalyzer.get().checkICEConnection(this._call,this.impl.iceConnectionState)}},{key:"onRenegotiation",value:function e(){if(typeof this.impl==="undefined")return;if(this.impl.connectionState==="disconnected"||this.impl.connectionState==="failed"){this.logger.info("Renegotiation requested on closed PeerConnection");return}if(this.impl.localDescription===null){this.logger.info("Renegotiation needed, but no local SD. Skipping");return}if(this.impl.iceConnectionState!=="connected"&&this.impl.iceConnectionState!=="completed"){this.logger.info("Renegotiation requested while ice state is "+this.impl.iceConnectionState+". Postponing");setTimeout(this.onRenegotiation,100);return}if(this.renegotiationInProgress){this.logger.info("Renegotiation in progress. Queueing");return}else{this.logger.info("Renegotiation started")}this._runReinvite()}},{key:"_getLocalOfferRegular",value:function e(){var t=this;this.iceRole=T.controlling;return new Promise(function(e,n){var r=t.getReceiveOptions();t.impl.createOffer(r).then(function(e){t.logger.info("_getLocalOfferRegular(), created local SDP: \n"+e.sdp);var n={type:e.type,sdp:e.sdp};n=d.PCFactory.get().addBandwidthParams(n);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){n=_.SDPMuggle.removeTransportCC(n)}n=_.SDPMuggle.removeDoublePT(n);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.xas){n=_.SDPMuggle.addXAS(n)}return t.codecRearrange(n)}).then(function(e){t.srcLocalSDP=e.sdp;t.logger.info("_getLocalOfferRegular(), set local SDP: \n"+e.sdp);return t.impl.setLocalDescription(e)}).then(function(){e(t.impl.localDescription)}).catch(function(e){n(e)})})}},{key:"getReceiveOptions",value:function e(){return{offerToReceiveAudio:!this.onHold,offerToReceiveVideo:this.videoEnabled.receiveVideo&&!this.onHold}}},{key:"updateHoldState",value:function e(){var t=this;this.impl.getTransceivers().forEach(function(e){if(e.sender.track){if(e.sender.track.kind==="audio")e.sender.track.enabled=!t.onHold&&!t.muteMicState;else e.sender.track.enabled=!t.onHold}})}},{key:"onICECandidate",value:function e(t){if(t&&t!==null){this.sendLocalCandidateToPeer("a="+t.candidate,t.sdpMLineIndex)}else{this.logger.info("End of candidates")}}},{key:"onAddTrack",value:function e(t){if(this._call){M.EndpointManager.get().addTrack(this._call,t.track)}}},{key:"onAddStream",value:function e(t){if(this._call){M.EndpointManager.get().addStream(this._call,t.stream)}}},{key:"_processRemoteAnswer",value:function e(t,n){var r=this;if(this._pendingOffer){return new Promise(function(e,i){r.logger.info("_processRemoteAnswer(), set local SDP: \n"+r._pendingOffer.sdp);r.impl.setLocalDescription(r._pendingOffer).then(function(){e(r._processRemoteAnswer(t,n))});r._pendingOffer=void 0})}else{if(n.length===0&&this._call){this.logger.error("Empty SDP from server. Call will be terminated.");this._call.hangup({"X-WebRTCError":"no sdp"});return}this.iceTimer=setTimeout(function(){r._call.notifyICETimeout()},this.ICE_TIMEOUT);this.pendingEvent=[t,n];if(this.impl.remoteDescription!==null)if(this.impl.remoteDescription.sdp!="")return;var i={sdp:n,type:R.answer};this.srcRemoteSDP=n;i=_.SDPMuggle.removeTIAS(i);this.logger.info("_processRemoteAnswer(), set remote SDP: \n"+i.sdp);return this.impl.setRemoteDescription(i).then(function(e){if(r._needIceRestart){r._runReinvite(true)}})}}},{key:"_getLocalOffer",value:function e(){if(u.default.getWSVendor()==="firefox"&&this.impl.remoteDescription&&this.impl.remoteDescription.sdp&&this.impl.remoteDescription.sdp.indexOf("VIMS")===-1){return this._getLocalOfferFF()}else{return this._getLocalOfferRegular()}}},{key:"_getLocalOfferFF",value:function e(){var t=this;this.iceRole=T.controlling;return new Promise(function(e,n){var r=t.getReceiveOptions();t.impl.createOffer(r).then(function(e){t.logger.info("_getLocalOfferFF(), created local SDP: \n"+e.sdp);var n={type:e.type,sdp:e.sdp};n=d.PCFactory.get().addBandwidthParams(n);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){n=_.SDPMuggle.removeTransportCC(n)}n=_.SDPMuggle.removeDoublePT(n);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.xas){n=_.SDPMuggle.addXAS(n)}return t.codecRearrange(n)}).then(function(n){t.srcLocalSDP=n.sdp;t._pendingOffer=n;e(n)}).catch(function(e){n(e)})})}},{key:"_runReinvite",value:function e(){var t=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.renegotiationInProgress===false){this.renegotiationInProgress=true;var r={};if(!(this.impl.getTransceivers&&u.default.getWSVendor()==="firefox"))r=this.getReceiveOptions();if(n){r.iceRestart=true}this.logger.trace(JSON.stringify(r));this.updateHoldState();this.impl.createOffer(r).then(function(e){t.logger.info("_runReinvite(), created local SDP: \n"+e.sdp);return t.codecRearrange(e)}).then(function(e){var n={type:e.type,sdp:e.sdp};n=d.PCFactory.get().addBandwidthParams(n);n=_.SDPMuggle.removeTelephoneEvents(n);n=_.SDPMuggle.removeDoubleOpus(n);n=_.SDPMuggle.removeDoublePT(n);n=_.SDPMuggle.fixVideoRecieve(n,t.videoEnabled.receiveVideo);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){n=_.SDPMuggle.removeTransportCC(n)}if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.xas){n=_.SDPMuggle.addXAS(n)}return n}).then(function(e){t.srcLocalSDP=e.sdp;t.pendingOffer=e;return e}).then(function(){var e={tracks:t.getTrackKind()};g.VoxSignaling.get().callRemoteFunction(v.RemoteFunction.reInvite,t._call.id(),{},t.pendingOffer.sdp,e)}).catch(function(e){t.logger.error("Error when renegatiation start "+e.message)})}else{this.logger.error("Another renegatiation in progress")}}},{key:"_getLocalAnswer",value:function e(){var t=this;this.iceRole=T.controlled;return new Promise(function(e,n){var r={mandatory:t.getReceiveOptions()};t.impl.createAnswer(r).then(function(e){t.logger.info("_getLocalAnswer(), created local SDP: \n"+e.sdp);var n={type:e.type,sdp:e.sdp};n=d.PCFactory.get().addBandwidthParams(n);n=_.SDPMuggle.removeDoublePT(n);n=_.SDPMuggle.fixVideoRecieve(n,t._call.settings.videoDirections.receiveVideo);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){n=_.SDPMuggle.removeTransportCC(n)}if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.xas){n=_.SDPMuggle.addXAS(n)}return t.codecRearrange(n)}).then(function(e){t.srcLocalSDP=e.sdp;t.logger.info("_getLocalAnswer(), set local SDP: \n"+e.sdp);return t.impl.setLocalDescription(e)}).then(function(){e({type:R.answer,sdp:t.impl.localDescription.sdp})}).catch(function(e){n(e)})})}},{key:"_setRemoteDescription",value:function e(t){if(t.length===0&&this._call){this.logger.error("Empty SDP from server. Call will be terminated.");this._call.hangup({"X-WebRTCError":"no sdp"});return}var n=new RTCSessionDescription({sdp:t,type:R.offer});n=_.SDPMuggle.removeTIAS(n);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){n=_.SDPMuggle.removeTransportCC(n)}this.srcRemoteSDP=t;this.logger.info("_setRemoteDescription(), set remote SDP: \n"+n.sdp);return this.impl.setRemoteDescription(n)}},{key:"_processRemoteOffer",value:function e(t){var n=this;if(t.length===0&&this._call){this.logger.error("Empty SDP from server. Call will be terminated.");this._call.hangup({"X-WebRTCError":"no sdp"});return}this.iceRole=T.controlled;return new Promise(function(e,r){var i=new RTCSessionDescription({sdp:t,type:R.offer});if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){i=_.SDPMuggle.removeTransportCC(i)}n.srcRemoteSDP=t;i=_.SDPMuggle.removeTIAS(i);i=_.SDPMuggle.fixFFMIDBug(i);n.logger.info("_processRemoteOffer(), set remote SDP: \n"+i.sdp);n.impl.setRemoteDescription(i).then(function(){var e={mandatory:n.getReceiveOptions()};return n.impl.createAnswer(e)}).then(function(e){n.logger.info("_processRemoteOffer(), created local SDP: \n"+e.sdp);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){e=_.SDPMuggle.removeTransportCC(e)}e=_.SDPMuggle.removeDoublePT(e);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.xas){e=_.SDPMuggle.addXAS(e)}return n.codecRearrange(e)}).then(function(e){n.srcLocalSDP=e.sdp;n.logger.info("_processRemoteOffer(), set local SDP: \n"+e.sdp);return n.impl.setLocalDescription(e)}).then(function(){e(n.impl.localDescription.sdp)}).catch(function(e){r(e)})})}},{key:"_close",value:function e(){var t=this;clearInterval(this.rtcCollectingCycle);this.impl.onnegotiationneeded=null;var n=S.Client.getInstance().config();if(this.impl.removeTrack){this.rtpSenders.forEach(function(e){t.impl.removeTrack(e)});L.default.StreamManager.get().remCallStream(this._call)}else{L.default.StreamManager.get().remCallStream(this._call);this.impl["getLocalStreams"]().forEach(function(e){t.impl["removeStream"](e)})}this.impl.close();if(typeof this._call!=="undefined")y.CallstatsIo.get().sendFabricEvent(this.impl,y.CallstatsIoFabricEvent.fabricTerminated,this._call.id());this._localStream=null;this._remoteStreams=null}},{key:"_addRemoteCandidate",value:function e(t,n){var r=this;return new Promise(function(e,i){try{r.impl.addIceCandidate(new RTCIceCandidate({candidate:t.substring(2),sdpMLineIndex:n})).then(function(){e()}).catch(function(){e()})}catch(t){e()}})}},{key:"_handleReinvite",value:function e(t,n){var r=this;if(n.length===0&&this._call){this.logger.error("Empty SDP from server. Call will be terminated.");this._call.hangup({"X-WebRTCError":"no sdp"});return}return new Promise(function(e,i){if(r.banReinviteAnswer){i(new Error)}if(r.renegotiationInProgress===false){r.renegotiationInProgress=true;var a={sdp:n,type:R.offer};if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){a=_.SDPMuggle.removeTransportCC(a)}r.srcRemoteSDP=n;a=_.SDPMuggle.removeTIAS(a);r.logger.info("_handleReinvite(), set remote SDP: \n"+a.sdp);r.impl.setRemoteDescription(a).then(function(){var n={mandatory:r.getReceiveOptions()};r.impl.createAnswer(n).then(function(n){r.logger.info("_handleReinvite(), created local SDP: \n"+n.sdp);var a={type:n.type,sdp:n.sdp};a=_.SDPMuggle.removeDoubleOpus(a);a=_.SDPMuggle.removeDoublePT(a);a=_.SDPMuggle.fixVideoRecieve(a,r.videoEnabled.receiveVideo);if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){a=_.SDPMuggle.removeTransportCC(a)}if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.xas){a=_.SDPMuggle.addXAS(a)}r.srcLocalSDP=a.sdp;try{r.logger.info("_handleReinvite(), set local SDP: \n"+a.sdp);r.impl.setLocalDescription(a).then(function(){var n={tracks:r.getTrackKind()};g.VoxSignaling.get().callRemoteFunction(v.RemoteFunction.acceptReInvite,r._call.id(),t,r.impl.localDescription.sdp,n);r.renegotiationInProgress=false;r._call.dispatchEvent({name:m.CallEvents.Updated,result:true,call:r._call});r.updateHoldState();setTimeout(function(e){return r._fixTransreceiver()},0);e()})}catch(e){r.renegotiationInProgress=false;setTimeout(function(e){return r._fixTransreceiver()},0);i(e)}})})}else if(r.renegotiationInProgress===true){var o={sdp:n,type:R.answer};r.renegotiationInProgress=false;if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.removeTransportCC){o=_.SDPMuggle.removeTransportCC(o)}if(S.Client.getInstance().config().experiments&&S.Client.getInstance().config().experiments.xas){o=_.SDPMuggle.addXAS(o)}r.srcRemoteSDP=n;o=_.SDPMuggle.removeTIAS(o);r.logger.info("_handleReinvite(), set local SDP: \n"+r.pendingOffer.sdp);r.impl.setLocalDescription(r.pendingOffer).then(function(){try{r.logger.info("_handleReinvite(), set remote SDP: \n"+o.sdp);r.impl.setRemoteDescription(o).then(function(){r._call.dispatchEvent({name:m.CallEvents.Updated,result:true,call:r._call});r.updateHoldState();setTimeout(function(e){return r._fixTransreceiver()},0);e()})}catch(e){r._call.dispatchEvent({name:m.CallEvents.Updated,result:false,call:r._call});r.renegotiationInProgress=false;r.logger.error(JSON.stringify(e));setTimeout(function(e){return r._fixTransreceiver()},0);i(e)}clearTimeout(r.renegotiationTimer)})}else{i(new Error("Universe was broken!"))}})}},{key:"_fixTransreceiver",value:function e(){if(this.impl&&this.impl.getTransceivers){this.impl.getTransceivers().forEach(function(e){if(e.currentDirection==="inactive"&&e.receiver.track&&!e.sender.track){if(e.receiver.track.onended){e.receiver.track.stop();e.receiver.track.onended(null)}}})}}},{key:"codecRearrange",value:function e(t){var n=this;return new Promise(function(e,r){var i=p.CallManager.get().calls[n.id];if(typeof i!=="undefined"){var a=new h.CodecSorter(t.sdp);var o=a.getUserCodecList();if(typeof i.rearangeCodecs!=="undefined"){i.rearangeCodecs(o,i.settings.incoming).then(function(n){a.setUserCodecList(n);e({type:t.type,sdp:a.getSDP()})},function(e){n.logger.error(JSON.stringify(e));r(e)})}else{a.setUserCodecList(o);n.logger.info("No sdp codecs transformer registered");e({type:t.type,sdp:a.getSDP()})}}else{e(t)}})}},{key:"_sendDTMF",value:function e(t,n,r){if(typeof this.dtmfSender!=="undefined"){this.dtmfSender.insertDTMF(t,n,r)}}},{key:"_hold",value:function e(t){y.CallstatsIo.get().sendFabricEvent(this.impl,t?y.CallstatsIoFabricEvent.fabricHold:y.CallstatsIoFabricEvent.fabricResume,this._call.id());this.onHold=t;this.impl.getTransceivers().forEach(function(e){if(t)e.direction="sendonly";else e.direction="sendrecv"})}},{key:"_getDirections",value:function e(){var t={};t["local"]=_.SDPMuggle.detectDirections(this.impl.localDescription.sdp);t["remote"]=_.SDPMuggle.detectDirections(this.impl.remoteDescription.sdp);return t}},{key:"_getStreamActivity",value:function e(){var t={};t["local"]=this.getMediaActivity(this.impl["getLocalStreams"]());t["remote"]=this.getMediaActivity(this.impl["getRemoteStreams"]());return t}},{key:"getMediaActivity",value:function e(t){return t.map(function(e){return e.getTracks().map(function(e){return{id:e.id,kind:e.kind,mutted:e.muted,active:e.enabled,label:e.label}})})}},{key:"_hdnFRSPrep",value:function e(){this.banReinviteAnswer=true}},{key:"_hdnFRS",value:function e(){this.renegotiationInProgress=false;this.onRenegotiation()}},{key:"_traceName",value:function e(){return"TransreceiverPC"}},{key:"hasLocalAudio",value:function e(){return this.impl["getLocalStreams"]().some(function(e){if(e.getAudioTracks().length)return true;else return false})}},{key:"hasLocalVideo",value:function e(){var t=this;return this.impl["getLocalStreams"]().some(function(e){return e.getVideoTracks().some(function(e){if(!t.shareScreenMedia||!t.shareScreenMedia.some(function(t){return t.getTracks().some(function(t){return t.id===e.id})})){return true}else{return false}})})}},{key:"enableVideo",value:function e(t){var n=[];if(this._call)n=L.default.StreamManager.get()._getScreenSharing(this._call)||[];var r=[];n.forEach(function(e){return e.stream.getTracks().forEach(function(e){return r.push(e.id)})});this.impl["getLocalStreams"]().forEach(function(e){e.getVideoTracks().forEach(function(e){if(!r.some(function(t){return e.id===t})){e.enabled=t}})})}},{key:"getTransceivers",value:function e(){if(this.impl.getTransceivers)return this.impl.getTransceivers();else return[]}},{key:"getRemoteDescription",value:function e(){if(this.impl.remoteDescription&&this.impl.remoteDescription.sdp)return this.impl.remoteDescription.sdp;else return""}},{key:"_addCustomMedia",value:function e(t){var n=this;if(!t||this.impl.signalingState==="closed")return;if(u.default.getWSVendor()==="firefox"){t.getTracks().forEach(function(e){var t=new MediaStream([e]);n.rtpSenders.push(n.impl.addTrack(e,t));n.onRenegotiation()})}else{this.impl["addStream"](t)}if(!this.dtmfSender&&this._call){var r=u.default.getDTMFSender(this.impl,this._call.id());if(r)this.dtmfSender=r}}},{key:"_removeCustomMedia",value:function e(t){var n=this;if(!t)return;if(u.default.getWSVendor()==="firefox"){if(this.impl.getTransceivers){var r=this.impl.getTransceivers();r.forEach(function(e){if(t.getTracks().find(function(t){return t.id===e.sender.track.id})){e.stop()}})}else{this.impl.getSenders().forEach(function(e){if(t.getTracks().indexOf(e.track)!==-1)n.impl.removeTrack(e)})}}else{this.impl["removeStream"](t)}}},{key:"_updateCustomMedia",value:function e(t){var n=this;if(!t||this.impl.signalingState==="closed")return;t.getTracks().forEach(function(e){var t=n.impl.getSenders().find(function(t){return t.track&&t.track.kind===e.kind});if(t)t.replaceTrack(e)})}},{key:"_fixFFSoundBug",value:function e(){var t=this;if(u.default.getWSVendor()==="firefox"&&d.PCFactory.hasTransceivers){setTimeout(function(){if(t.impl.getSenders){var e=t.impl.getSenders();e.forEach(function(e){if(e.replaceTrack){var t=e.track;e.replaceTrack(t)}})}},1e3)}}},{key:"getConfiguration",value:function e(){if(this.impl)return this.impl.getConfiguration();return null}},{key:"setConfiguration",value:function e(t){var n=this;if(this.impl){setTimeout(function(){if(n.srcRemoteSDP&&n.srcRemoteSDP.indexOf("VIMS")===-1){if(n.impl&&n.impl.setConfiguration){n.impl.setConfiguration(t);n.renegotiationInProgress=false;n._runReinvite(true)}else{if(n._pendingOffer){var e=[];n.impl.getTransceivers().map(function(t){if(t.sender.track)e.push(t.sender.track)});n._createImpl(t);e.forEach(function(e){n.impl.addTrack(e,new MediaStream([e]))});n.impl.createOffer().then(function(e){n.logger.info("setConfiguration(), created local SDP: \n"+e.sdp);n._needIceRestart=true;n.logger.info("setConfiguration(), set local SDP: \n"+n._pendingOffer.sdp);return n.impl.setLocalDescription(n._pendingOffer)}).then(function(){n._pendingOffer=void 0}).catch(function(e){console.error(e)})}}}else{}},800)}}}]);return t}(l.PeerConnection);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_createImpl",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"onSignalingStateChange",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"getPCStats",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"onConnectionChange",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"onRenegotiation",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_getLocalOfferRegular",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"getReceiveOptions",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"updateHoldState",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"onICECandidate",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"onAddTrack",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"onAddStream",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_processRemoteAnswer",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_getLocalOffer",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_getLocalOfferFF",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_getLocalAnswer",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_setRemoteDescription",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_close",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_addRemoteCandidate",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_handleReinvite",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"codecRearrange",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_sendDTMF",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_hold",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_getStreamActivity",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"getMediaActivity",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_hdnFRSPrep",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_hdnFRS",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"hasLocalAudio",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"hasLocalVideo",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"enableVideo",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_addCustomMedia",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_removeCustomMedia",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_updateCustomMedia",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"_fixFFSoundBug",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"getConfiguration",null);c([f.LogManager.d_trace(f.LogCategory.RTC)],k.prototype,"setConfiguration",null);t.TransreceiverPC=k},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var a=n(14);var o=n(6);var s=n(2);var c=n(3);var l=n(13);var u=n(11);var d=n(5);var f=n(4);var g=function(){function e(t){var n=this;i(this,e);this.client=t;this.currentCall=null;this.onConnectionFailed=null;this.onConnectionEstablished=null;this.onCheckComplete=null;this.onCallFailed=null;this.onCallConnected=null;this.onCallEnded=null;this.onCallRinging=null;this.onCallMediaStarted=null;this.onVoicemail=null;this.onNetStatsReceived=null;o.CallManager.get().protocolVersion=="2";t.on(a.Events.ConnectionFailed,function(e){return n.runLegacyCallback(n.onConnectionFailed,e)});t.on(a.Events.ConnectionEstablished,function(e){return n.runLegacyCallback(n.onConnectionEstablished,e)});s.VoxSignaling.get().setRPCHandler(l.RemoteEvent.handlePreFlightCheckResult,function(e,t,r){return n.onCheckComplete(e,t,r)});s.VoxSignaling.get().setRPCHandler(l.RemoteEvent.handleVoicemail,function(e){return n.runLegacyCallback(n.onVoicemail,e)})}r(e,[{key:"connectTo",value:function e(t,n,r,i){var a=s.VoxSignaling.get();u.Authenticator.get().ziAuthorized(true);a.lagacyConnectTo(t,n,r,i)}},{key:"connect",value:function e(){}},{key:"requestMedia",value:function e(t,n,r,i){f.default.StreamManager.get().getCallStream(void 0).then(function(e){if(n)n(e)}).catch(function(e){if(r)r(e)})}},{key:"hangupCall",value:function e(t,n){o.CallManager.get().calls[t].hangup(n);s.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.disconnectCall,t,{})}},{key:"callTo",value:function e(t,n,r,i){this.currentCall=this.client.call({number:t,video:n,extraHeaders:r,extraParams:i});this.bindCurrentCall();return this.currentCall.id()}},{key:"voicemailPromptFinished",value:function e(t){s.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.zPromptFinished,t)}},{key:"makeid",value:function e(t){var n="";var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var i=0;i<t;i++){n+=r.charAt(Math.floor(Math.random()*r.length))}return n}},{key:"muteMicrophone",value:function e(t){var n=o.CallManager.get();for(var r in n.calls){if(n.calls.hasOwnProperty(r)){if(t)n.calls[r].muteMicrophone();else n.calls[r].unmuteMicrophone()}}}},{key:"sendDigit",value:function e(t,n){s.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.sendDTMF,t,n)}},{key:"startPreFlightCheck",value:function e(t,n){if(this.onCheckComplete)this.onCheckComplete(true,true,true)}},{key:"runLegacyCallback",value:function e(t,n){if(typeof t!=="undefined"&&t!==null){t(n)}}},{key:"bindCurrentCall",value:function e(){var t=this;window["currentCall"]=this.currentCall;this.currentCall.on(d.CallEvents.Failed,function(e){t.runLegacyCallback(t.onCallFailed,e);t.unbindCurrentCall()});this.currentCall.on(d.CallEvents.Connected,function(e){t.runLegacyCallback(t.onCallConnected,e);t.runLegacyCallback(t.onCallMediaStarted,e);var n=o.CallManager.get();setTimeout(function(){var e=document.getElementById(window["currentCall"].peerConnection.impl.getRemoteStreams()[0].getTracks()[0].id);e.srcObject=window["currentCall"].peerConnection.impl.getRemoteStreams()[0];e.load();e.play()},1e3)});this.currentCall.on(d.CallEvents.Disconnected,function(e){t.runLegacyCallback(t.onCallEnded,e);t.unbindCurrentCall()});this.client.on(a.Events.NetStatsReceived,function(e){return t.onNetStatsReceived(e)})}},{key:"unbindCurrentCall",value:function e(){this.currentCall.off(d.CallEvents.Failed);this.currentCall.off(d.CallEvents.Connected);this.currentCall.off(d.CallEvents.Disconnected);this.currentCall.off(d.CallEvents.ProgressToneStart);this.currentCall.off(d.CallEvents.Connected);this.client.off(a.Events.NetStatsReceived)}},{key:"_traceName",value:function e(){return"ZingayaAPI"}}]);return e}();t.ZingayaAPI=g},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var a=n(2);var o=n(3);var s=function(){function e(){i(this,e)}r(e,[{key:"_traceName",value:function e(){return"PushService"}}],[{key:"register",value:function e(t){return new Promise(function(e,n){var r=a.VoxSignaling.get().callRemoteFunction(o.RemoteFunction.registerPushToken,t);if(r)e();else n()})}},{key:"unregister",value:function e(t){return new Promise(function(e,n){var r=a.VoxSignaling.get().callRemoteFunction(o.RemoteFunction.unregisterPushToken,t);if(r)e();else n()})}},{key:"incomingPush",value:function e(t){return new Promise(function(e,n){var r=a.VoxSignaling.get().callRemoteFunction(o.RemoteFunction.pushFeedback,t);if(r)e();else n()})}}]);return e}();t.PushService=s},function(e,t,n){"use strict";(function(t){var r=n(68);e.exports=r({window:t.window})}).call(t,n(67))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(1,eval)("this")}catch(e){if(typeof window==="object")n=window}e.exports=n},function(e,t,n){"use strict";var r=n(9);e.exports=function(e,t){var i=e&&e.window;var a={shimChrome:true,shimFirefox:true,shimEdge:true,shimSafari:true};for(var o in t){if(hasOwnProperty.call(t,o)){a[o]=t[o]}}var s=r.log;var c=r.detectBrowser(i);var l={browserDetails:c,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};var u=n(69)||null;var d=n(71)||null;var f=n(74)||null;var g=n(76)||null;var p=n(77)||null;switch(c.browser){case"chrome":if(!u||!u.shimPeerConnection||!a.shimChrome){s("Chrome shim is not included in this adapter release.");return l}s("adapter.js shimming chrome.");l.browserShim=u;u.shimGetUserMedia(i);u.shimMediaStream(i);u.shimSourceObject(i);u.shimPeerConnection(i);u.shimOnTrack(i);u.shimAddTrackRemoveTrack(i);u.shimGetSendersWithDtmf(i);p.shimRTCIceCandidate(i);break;case"firefox":if(!f||!f.shimPeerConnection||!a.shimFirefox){s("Firefox shim is not included in this adapter release.");return l}s("adapter.js shimming firefox.");l.browserShim=f;p.shimCreateObjectURL(i);f.shimGetUserMedia(i);f.shimSourceObject(i);f.shimPeerConnection(i);f.shimOnTrack(i);f.shimRemoveStream(i);p.shimRTCIceCandidate(i);break;case"edge":if(!d||!d.shimPeerConnection||!a.shimEdge){s("MS edge shim is not included in this adapter release.");return l}s("adapter.js shimming edge.");l.browserShim=d;p.shimCreateObjectURL(i);d.shimGetUserMedia(i);d.shimPeerConnection(i);d.shimReplaceTrack(i);break;case"safari":if(!g||!a.shimSafari){s("Safari shim is not included in this adapter release.");return l}s("adapter.js shimming safari.");l.browserShim=g;p.shimCreateObjectURL(i);g.shimRTCIceServerUrls(i);g.shimCallbacksAPI(i);g.shimLocalStreamsAPI(i);g.shimRemoteStreamsAPI(i);g.shimTrackEventTransceiver(i);g.shimGetUserMedia(i);g.shimCreateOfferLegacy(i);p.shimRTCIceCandidate(i);break;default:s("Unsupported browser!");break}return l}},function(e,t,n){"use strict";var r=n(9);var i=r.log;var a={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){if(this._ontrack){this.removeEventListener("track",this._ontrack)}this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;if(!n._ontrackpoly){n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var i;if(e.RTCPeerConnection.prototype.getReceivers){i=n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id})}else{i={track:r.track}}var a=new Event("track");a.track=r.track;a.receiver=i;a.transceiver={receiver:i};a.streams=[t.stream];n.dispatchEvent(a)});t.stream.getTracks().forEach(function(r){var i;if(e.RTCPeerConnection.prototype.getReceivers){i=n.getReceivers().find(function(e){return e.track&&e.track.id===r.id})}else{i={track:r}}var a=new Event("track");a.track=r;a.receiver=i;a.transceiver={receiver:i};a.streams=[t.stream];n.dispatchEvent(a)})};n.addEventListener("addstream",n._ontrackpoly)}return t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){if(this._dtmf===undefined){if(t.kind==="audio"){this._dtmf=e.createDTMFSender(t)}else{this._dtmf=null}}return this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=this;var a=n.apply(i,arguments);if(!a){a=t(i,e);i._senders.push(a)}return a};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;r.apply(t,arguments);var n=t._senders.indexOf(e);if(n!==-1){t._senders.splice(n,1)}}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[];i.apply(n,[e]);e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[];a.apply(t,[e]);e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});if(n){t._senders.splice(t._senders.indexOf(n),1)}})}}else if(typeof e==="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this;var t=o.apply(e,[]);t.forEach(function(t){t._pc=e});return t};Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){if(this._dtmf===undefined){if(this.track.kind==="audio"){this._dtmf=this._pc.createDTMFSender(this.track)}else{this._dtmf=null}}return this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;if(typeof e==="object"){if(e.HTMLMediaElement&&!("srcObject"in e.HTMLMediaElement.prototype)){Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;this._srcObject=e;if(this.src){t.revokeObjectURL(this.src)}if(!e){this.src="";return undefined}this.src=t.createObjectURL(e);e.addEventListener("addtrack",function(){if(n.src){t.revokeObjectURL(n.src)}n.src=t.createObjectURL(e)});e.addEventListener("removetrack",function(){if(n.src){t.revokeObjectURL(n.src)}n.src=t.createObjectURL(e)})}})}}},shimAddTrackRemoveTrack:function(e){var t=r.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=64){return}var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;var t=n.apply(this);e._reverseStreams=e._reverseStreams||{};return t.map(function(t){return e._reverseStreams[t.id]})};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;n._streams=n._streams||{};n._reverseStreams=n._reverseStreams||{};t.getTracks().forEach(function(e){var t=n.getSenders().find(function(t){return t.track===e});if(t){throw new DOMException("Track already exists.","InvalidAccessError")}});if(!n._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());n._streams[t.id]=r;n._reverseStreams[r.id]=t;t=r}i.apply(n,[t])};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{};t._reverseStreams=t._reverseStreams||{};a.apply(t,[t._streams[e.id]||e]);delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id];delete t._streams[e.id]};e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if(r.signalingState==="closed"){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}var i=[].slice.call(arguments,1);if(i.length!==1||!i[0].getTracks().find(function(e){return e===t})){throw new DOMException("The adapter.js addTrack polyfill only supports a single "+" stream which is associated with the specified track.","NotSupportedError")}var a=r.getSenders().find(function(e){return e.track===t});if(a){throw new DOMException("Track already exists.","InvalidAccessError")}r._streams=r._streams||{};r._reverseStreams=r._reverseStreams||{};var o=r._streams[n.id];if(o){o.addTrack(t);Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))})}else{var s=new e.MediaStream([t]);r._streams[n.id]=s;r._reverseStreams[s.id]=n;r.addStream(s)}return r.getSenders().find(function(e){return e.track===t})};function o(e,t){var n=t.sdp;Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t];var i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)});return new RTCSessionDescription({type:t.type,sdp:n})}function s(e,t){var n=t.sdp;Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t];var i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)});return new RTCSessionDescription({type:t.type,sdp:n})}["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;var t=arguments;var r=arguments.length&&typeof arguments[0]==="function";if(r){return n.apply(e,[function(n){var r=o(e,n);t[0].apply(null,[r])},function(e){if(t[1]){t[1].apply(null,e)}},arguments[2]])}return n.apply(e,arguments).then(function(t){return o(e,t)})}});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;if(!arguments.length||!arguments[0].type){return c.apply(e,arguments)}arguments[0]=s(e,arguments[0]);return c.apply(e,arguments)};var l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this;var t=l.get.apply(this);if(t.type===""){return t}return o(e,t)}});e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if(t.signalingState==="closed"){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}if(!e._pc){throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack "+"does not implement interface RTCRtpSender.","TypeError")}var n=e._pc===t;if(!n){throw new DOMException("Sender was not created by this connection.","InvalidAccessError")}t._streams=t._streams||{};var r;Object.keys(t._streams).forEach(function(n){var i=t._streams[n].getTracks().find(function(t){return e.track===t});if(i){r=t._streams[n]}});if(r){if(r.getTracks().length===1){t.removeStream(t._reverseStreams[r.id])}else{r.removeTrack(e.track)}t.dispatchEvent(new Event("negotiationneeded"))}}},shimPeerConnection:function(e){var t=r.detectBrowser(e);if(!e.RTCPeerConnection){e.RTCPeerConnection=function(t,n){i("PeerConnection");if(t&&t.iceTransportPolicy){t.iceTransports=t.iceTransportPolicy}return new e.webkitRTCPeerConnection(t,n)};e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype;if(e.webkitRTCPeerConnection.generateCertificate){Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}})}}else{var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){var i=[];for(var a=0;a<e.iceServers.length;a++){var o=e.iceServers[a];if(!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")){r.deprecated("RTCIceServer.url","RTCIceServer.urls");o=JSON.parse(JSON.stringify(o));o.urls=o.url;i.push(o)}else{i.push(e.iceServers[a])}}e.iceServers=i}return new n(e,t)};e.RTCPeerConnection.prototype=n.prototype;Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var r=this;var i=arguments;if(arguments.length>0&&typeof e==="function"){return a.apply(this,arguments)}if(a.length===0&&(arguments.length===0||typeof arguments[0]!=="function")){return a.apply(this,[])}var o=function(e){var t={};var n=e.result();n.forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)});t[n.id]=n});return t};var s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){i[1](s(o(e)))};return a.apply(this,[c,arguments[0]])}return new Promise(function(e,t){a.apply(r,[function(t){e(s(o(t)))},t])}).then(t,n)};if(t.version<51){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments;var t=this;var r=new Promise(function(r,i){n.apply(t,[e[0],r,i])});if(e.length<2){return r}return r.then(function(){e[1].apply(null,[])},function(t){if(e.length>=3){e[2].apply(null,[t])}})}})}if(t.version<52){["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||arguments.length===1&&typeof arguments[0]==="object"){var t=arguments.length===1?arguments[0]:undefined;return new Promise(function(r,i){n.apply(e,[r,i,t])})}return n.apply(this,arguments)}})}["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){arguments[0]=new(t==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]);return n.apply(this,arguments)}});var o=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}return o.apply(this,arguments)}}};e.exports={shimMediaStream:a.shimMediaStream,shimOnTrack:a.shimOnTrack,shimAddTrackRemoveTrack:a.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:a.shimGetSendersWithDtmf,shimSourceObject:a.shimSourceObject,shimPeerConnection:a.shimPeerConnection,shimGetUserMedia:n(70)}},function(e,t,n){"use strict";var r=n(9);var i=r.log;e.exports=function(e){var t=r.detectBrowser(e);var n=e&&e.navigator;var a=function(e){if(typeof e!=="object"||e.mandatory||e.optional){return e}var t={};Object.keys(e).forEach(function(n){if(n==="require"||n==="advanced"||n==="mediaSource"){return}var r=typeof e[n]==="object"?e[n]:{ideal:e[n]};if(r.exact!==undefined&&typeof r.exact==="number"){r.min=r.max=r.exact}var i=function(e,t){if(e){return e+t.charAt(0).toUpperCase()+t.slice(1)}return t==="deviceId"?"sourceId":t};if(r.ideal!==undefined){t.optional=t.optional||[];var a={};if(typeof r.ideal==="number"){a[i("min",n)]=r.ideal;t.optional.push(a);a={};a[i("max",n)]=r.ideal;t.optional.push(a)}else{a[i("",n)]=r.ideal;t.optional.push(a)}}if(r.exact!==undefined&&typeof r.exact!=="number"){t.mandatory=t.mandatory||{};t.mandatory[i("",n)]=r.exact}else{["min","max"].forEach(function(e){if(r[e]!==undefined){t.mandatory=t.mandatory||{};t.mandatory[i(e,n)]=r[e]}})}});if(e.advanced){t.optional=(t.optional||[]).concat(e.advanced)}return t};var o=function(e,r){if(t.version>=61){return r(e)}e=JSON.parse(JSON.stringify(e));if(e&&typeof e.audio==="object"){var o=function(e,t,n){if(t in e&&!(n in e)){e[n]=e[t];delete e[t]}};e=JSON.parse(JSON.stringify(e));o(e.audio,"autoGainControl","googAutoGainControl");o(e.audio,"noiseSuppression","googNoiseSuppression");e.audio=a(e.audio)}if(e&&typeof e.video==="object"){var s=e.video.facingMode;s=s&&(typeof s==="object"?s:{ideal:s});var c=t.version<66;if(s&&(s.exact==="user"||s.exact==="environment"||s.ideal==="user"||s.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!c)){delete e.video.facingMode;var l;if(s.exact==="environment"||s.ideal==="environment"){l=["back","rear"]}else if(s.exact==="user"||s.ideal==="user"){l=["front"]}if(l){return n.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return e.kind==="videoinput"});var n=t.find(function(e){return l.some(function(t){return e.label.toLowerCase().indexOf(t)!==-1})});if(!n&&t.length&&l.indexOf("back")!==-1){n=t[t.length-1]}if(n){e.video.deviceId=s.exact?{exact:n.deviceId}:{ideal:n.deviceId}}e.video=a(e.video);i("chrome: "+JSON.stringify(e));return r(e)})}}e.video=a(e.video)}i("chrome: "+JSON.stringify(e));return r(e)};var s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};var c=function(e,t,r){o(e,function(e){n.webkitGetUserMedia(e,t,function(e){if(r){r(s(e))}})})};n.getUserMedia=c;var l=function(e){return new Promise(function(t,r){n.getUserMedia(e,t,r)})};if(!n.mediaDevices){n.mediaDevices={getUserMedia:l,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:true,echoCancellation:true,facingMode:true,frameRate:true,height:true,width:true}}}}if(!n.mediaDevices.getUserMedia){n.mediaDevices.getUserMedia=function(e){return l(e)}}else{var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return o(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length){t.getTracks().forEach(function(e){e.stop()});throw new DOMException("","NotFoundError")}return t},function(e){return Promise.reject(s(e))})})}}if(typeof n.mediaDevices.addEventListener==="undefined"){n.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}}if(typeof n.mediaDevices.removeEventListener==="undefined"){n.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")}}}},function(e,t,n){"use strict";var r=n(9);var i=n(72);e.exports={shimGetUserMedia:n(73),shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCIceGatherer){if(!e.RTCIceCandidate){e.RTCIceCandidate=function(e){return e}}if(!e.RTCSessionDescription){e.RTCSessionDescription=function(e){return e}}if(t.version<15025){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e;this.dispatchEvent(t)}})}}if(e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){if(this._dtmf===undefined){if(this.track.kind==="audio"){this._dtmf=new e.RTCDtmfSender(this)}else if(this.track.kind==="video"){this._dtmf=null}}return this._dtmf}})}e.RTCPeerConnection=i(e,t.version)},shimReplaceTrack:function(e){if(e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)){e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack}}}},function(e,t,n){"use strict";var r=n(43);function i(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}function a(e,t,n,i,a){var o=r.writeRtpDescription(e.kind,t);o+=r.writeIceParameters(e.iceGatherer.getLocalParameters());o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),n==="offer"?"actpass":a||"active");o+="a=mid:"+e.mid+"\r\n";if(e.rtpSender&&e.rtpReceiver){o+="a=sendrecv\r\n"}else if(e.rtpSender){o+="a=sendonly\r\n"}else if(e.rtpReceiver){o+="a=recvonly\r\n"}else{o+="a=inactive\r\n"}if(e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";o+="a="+c;o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c;if(e.sendEncodingParameters[0].rtx){o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c;o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n";if(e.rtpSender&&e.sendEncodingParameters[0].rtx){o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"}return o}function o(e,t){var n=false;e=JSON.parse(JSON.stringify(e));return e.filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;if(e.url&&!e.urls){console.warn("RTCIceServer.url is deprecated! Use urls instead.")}var i=typeof r==="string";if(i){r=[r]}r=r.filter(function(e){var r=e.indexOf("turn:")===0&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1&&!n;if(r){n=true;return true}return e.indexOf("stun:")===0&&t>=14393&&e.indexOf("?transport=udp")===-1});delete e.url;e.urls=i?r[0]:r;return!!r.length}})}function s(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};var r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++){if(t[n].payloadType===e||t[n].preferredPayloadType===e){return t[n]}}};var i=function(e,t,n,i){var a=r(e.parameters.apt,n);var o=r(t.parameters.apt,i);return a&&o&&a.name.toLowerCase()===o.name.toLowerCase()};e.codecs.forEach(function(r){for(var a=0;a<t.codecs.length;a++){var o=t.codecs[a];if(r.name.toLowerCase()===o.name.toLowerCase()&&r.clockRate===o.clockRate){if(r.name.toLowerCase()==="rtx"&&r.parameters&&o.parameters.apt){if(!i(r,o,e.codecs,t.codecs)){continue}}o=JSON.parse(JSON.stringify(o));o.numChannels=Math.min(r.numChannels,o.numChannels);n.codecs.push(o);o.rtcpFeedback=o.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++){if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter){return true}}return false});break}}});e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}});return n}function c(e,t,n){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)!==-1}function l(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});if(!n){e.addRemoteCandidate(t)}return!n}function u(e,t){var n=new Error(t);n.name=e;n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:undefined,OperationError:undefined}[e];return n}e.exports=function(e,t){function n(t,n){n.addTrack(t);n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function d(t,n){n.removeTrack(t);n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}function f(t,n,r,i){var a=new Event("track");a.track=n;a.receiver=r;a.transceiver={receiver:r};a.streams=i;e.setTimeout(function(){t._dispatchEvent("track",a)})}var g=function(n){var i=this;var a=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=a[e].bind(a)});this.canTrickleIceCandidates=null;this.needNegotiation=false;this.localStreams=[];this.remoteStreams=[];this.localDescription=null;this.remoteDescription=null;this.signalingState="stable";this.iceConnectionState="new";this.connectionState="new";this.iceGatheringState="new";n=JSON.parse(JSON.stringify(n||{}));this.usingBundle=n.bundlePolicy==="max-bundle";if(n.rtcpMuxPolicy==="negotiate"){throw u("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported")}else if(!n.rtcpMuxPolicy){n.rtcpMuxPolicy="require"}switch(n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all";break}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced";break}n.iceServers=o(n.iceServers||[],t);this._iceGatherers=[];if(n.iceCandidatePoolSize){for(var s=n.iceCandidatePoolSize;s>0;s--){this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}))}}else{n.iceCandidatePoolSize=0}this._config=n;this.transceivers=[];this._sdpSessionId=r.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=undefined;this._isClosed=false};g.prototype.onicecandidate=null;g.prototype.onaddstream=null;g.prototype.ontrack=null;g.prototype.onremovestream=null;g.prototype.onsignalingstatechange=null;g.prototype.oniceconnectionstatechange=null;g.prototype.onconnectionstatechange=null;g.prototype.onicegatheringstatechange=null;g.prototype.onnegotiationneeded=null;g.prototype.ondatachannel=null;g.prototype._dispatchEvent=function(e,t){if(this._isClosed){return}this.dispatchEvent(t);if(typeof this["on"+e]==="function"){this["on"+e](t)}};g.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)};g.prototype.getConfiguration=function(){return this._config};g.prototype.getLocalStreams=function(){return this.localStreams};g.prototype.getRemoteStreams=function(){return this.remoteStreams};g.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0;var r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:true};if(this.usingBundle&&n){r.iceTransport=this.transceivers[0].iceTransport;r.dtlsTransport=this.transceivers[0].dtlsTransport}else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport;r.dtlsTransport=i.dtlsTransport}if(!t){this.transceivers.push(r)}return r};g.prototype.addTrack=function(t,n){if(this._isClosed){throw u("InvalidStateError","Attempted to call addTrack on a closed peerconnection.")}var r=this.transceivers.find(function(e){return e.track===t});if(r){throw u("InvalidAccessError","Track already exists.")}var i;for(var a=0;a<this.transceivers.length;a++){if(!this.transceivers[a].track&&this.transceivers[a].kind===t.kind){i=this.transceivers[a]}}if(!i){i=this._createTransceiver(t.kind)}this._maybeFireNegotiationNeeded();if(this.localStreams.indexOf(n)===-1){this.localStreams.push(n)}i.track=t;i.stream=n;i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport);return i.rtpSender};g.prototype.addStream=function(e){var n=this;if(t>=15025){e.getTracks().forEach(function(t){n.addTrack(t,e)})}else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})});r.getTracks().forEach(function(e){n.addTrack(e,r)})}};g.prototype.removeTrack=function(t){if(this._isClosed){throw u("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.")}if(!(t instanceof e.RTCRtpSender)){throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack "+"does not implement interface RTCRtpSender.")}var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n){throw u("InvalidAccessError","Sender was not created by this connection.")}var r=n.stream;n.rtpSender.stop();n.rtpSender=null;n.track=null;n.stream=null;var i=this.transceivers.map(function(e){return e.stream});if(i.indexOf(r)===-1&&this.localStreams.indexOf(r)>-1){this.localStreams.splice(this.localStreams.indexOf(r),1)}this._maybeFireNegotiationNeeded()};g.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});if(n){t.removeTrack(n)}})};g.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})};g.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})};g.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0){return this.transceivers[0].iceGatherer}else if(this._iceGatherers.length){return this._iceGatherers.shift()}var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(i,"state",{value:"new",writable:true});this.transceivers[t].bufferedCandidateEvents=[];this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||Object.keys(e.candidate).length===0;i.state=n?"completed":"gathering";if(r.transceivers[t].bufferedCandidateEvents!==null){r.transceivers[t].bufferedCandidateEvents.push(e)}};i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates);return i};g.prototype._gather=function(t,n){var i=this;var a=this.transceivers[n].iceGatherer;if(a.onlocalcandidate){return}var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null;a.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates);a.onlocalcandidate=function(e){if(i.usingBundle&&n>0){return}var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate;var c=!s||Object.keys(s).length===0;if(c){if(a.state==="new"||a.state==="gathering"){a.state="completed"}}else{if(a.state==="new"){a.state="gathering"}s.component=1;s.ufrag=a.getLocalParameters().usernameFragment;var l=r.writeCandidate(s);o.candidate=Object.assign(o.candidate,r.parseCandidate(l));o.candidate.candidate=l;o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var u=r.getMediaSections(i.localDescription.sdp);if(!c){u[o.candidate.sdpMLineIndex]+="a="+o.candidate.candidate+"\r\n"}else{u[o.candidate.sdpMLineIndex]+="a=end-of-candidates\r\n"}i.localDescription.sdp=r.getDescription(i.localDescription.sdp)+u.join("");var d=i.transceivers.every(function(e){return e.iceGatherer&&e.iceGatherer.state==="completed"});if(i.iceGatheringState!=="gathering"){i.iceGatheringState="gathering";i._emitGatheringStateChange()}if(!c){i._dispatchEvent("icecandidate",o)}if(d){i._dispatchEvent("icecandidate",new Event("icecandidate"));i.iceGatheringState="complete";i._emitGatheringStateChange()}};e.setTimeout(function(){o.forEach(function(e){a.onlocalcandidate(e)})},0)};g.prototype._createIceAndDtlsTransports=function(){var t=this;var n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState();t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);r.ondtlsstatechange=function(){t._updateConnectionState()};r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:true});t._updateConnectionState()};return{iceTransport:n,dtlsTransport:r}};g.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;if(t){delete t.onlocalcandidate;delete this.transceivers[e].iceGatherer}var n=this.transceivers[e].iceTransport;if(n){delete n.onicestatechange;delete this.transceivers[e].iceTransport}var r=this.transceivers[e].dtlsTransport;if(r){delete r.ondtlsstatechange;delete r.onerror;delete this.transceivers[e].dtlsTransport}};g.prototype._transceive=function(e,n,i){var a=s(e.localCapabilities,e.remoteCapabilities);if(n&&e.rtpSender){a.encodings=e.sendEncodingParameters;a.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound};if(e.recvEncodingParameters.length){a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc}e.rtpSender.send(a)}if(i&&e.rtpReceiver&&a.codecs.length>0){if(e.kind==="video"&&e.recvEncodingParameters&&t<15019){e.recvEncodingParameters.forEach(function(e){delete e.rtx})}if(e.recvEncodingParameters.length){a.encodings=e.recvEncodingParameters}else{a.encodings=[{}]}a.rtcp={compound:e.rtcpParameters.compound};if(e.rtcpParameters.cname){a.rtcp.cname=e.rtcpParameters.cname}if(e.sendEncodingParameters.length){a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc}e.rtpReceiver.receive(a)}};g.prototype.setLocalDescription=function(e){var t=this;if(["offer","answer"].indexOf(e.type)===-1){return Promise.reject(u("TypeError",'Unsupported type "'+e.type+'"'))}if(!c("setLocalDescription",e.type,t.signalingState)||t._isClosed){return Promise.reject(u("InvalidStateError","Can not set local "+e.type+" in state "+t.signalingState))}var n;var i;if(e.type==="offer"){n=r.splitSections(e.sdp);i=n.shift();n.forEach(function(e,n){var i=r.parseRtpParameters(e);t.transceivers[n].localCapabilities=i});t.transceivers.forEach(function(e,n){t._gather(e.mid,n)})}else if(e.type==="answer"){n=r.splitSections(t.remoteDescription.sdp);i=n.shift();var a=r.matchPrefix(i,"a=ice-lite").length>0;n.forEach(function(e,n){var o=t.transceivers[n];var c=o.iceGatherer;var l=o.iceTransport;var u=o.dtlsTransport;var d=o.localCapabilities;var f=o.remoteCapabilities;var g=r.isRejected(e)&&r.matchPrefix(e,"a=bundle-only").length===0;if(!g&&!o.rejected){var p=r.getIceParameters(e,i);var v=r.getDtlsParameters(e,i);if(a){v.role="server"}if(!t.usingBundle||n===0){t._gather(o.mid,n);if(l.state==="new"){l.start(c,p,a?"controlling":"controlled")}if(u.state==="new"){u.start(v)}}var h=s(d,f);t._transceive(o,h.codecs.length>0,false)}})}t.localDescription={type:e.type,sdp:e.sdp};if(e.type==="offer"){t._updateSignalingState("have-local-offer")}else{t._updateSignalingState("stable")}return Promise.resolve()};g.prototype.setRemoteDescription=function(i){var a=this;if(["offer","answer"].indexOf(i.type)===-1){return Promise.reject(u("TypeError",'Unsupported type "'+i.type+'"'))}if(!c("setRemoteDescription",i.type,a.signalingState)||a._isClosed){return Promise.reject(u("InvalidStateError","Can not set remote "+i.type+" in state "+a.signalingState))}var o={};a.remoteStreams.forEach(function(e){o[e.id]=e});var s=[];var g=r.splitSections(i.sdp);var p=g.shift();var v=r.matchPrefix(p,"a=ice-lite").length>0;var h=r.matchPrefix(p,"a=group:BUNDLE ").length>0;a.usingBundle=h;var m=r.matchPrefix(p,"a=ice-options:")[0];if(m){a.canTrickleIceCandidates=m.substr(14).split(" ").indexOf("trickle")>=0}else{a.canTrickleIceCandidates=false}g.forEach(function(c,u){var f=r.splitLines(c);var g=r.getKind(c);var m=r.isRejected(c)&&r.matchPrefix(c,"a=bundle-only").length===0;var y=f[0].substr(2).split(" ")[2];var C=r.getDirection(c,p);var _=r.parseMsid(c);var S=r.getMid(c)||r.generateIdentifier();if(g==="application"&&y==="DTLS/SCTP"||m){a.transceivers[u]={mid:S,kind:g,rejected:true};return}if(!m&&a.transceivers[u]&&a.transceivers[u].rejected){a.transceivers[u]=a._createTransceiver(g,true)}var E;var L;var M;var b;var R;var T;var k;var I;var P;var w=r.parseRtpParameters(c);var O;var A;if(!m){O=r.getIceParameters(c,p);A=r.getDtlsParameters(c,p);A.role="client"}k=r.parseRtpEncodingParameters(c);var D=r.parseRtcpParameters(c);var N=r.matchPrefix(c,"a=end-of-candidates",p).length>0;var x=r.matchPrefix(c,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return e.component===1});if((i.type==="offer"||i.type==="answer")&&!m&&h&&u>0&&a.transceivers[u]){a._disposeIceAndDtlsTransports(u);a.transceivers[u].iceGatherer=a.transceivers[0].iceGatherer;a.transceivers[u].iceTransport=a.transceivers[0].iceTransport;a.transceivers[u].dtlsTransport=a.transceivers[0].dtlsTransport;if(a.transceivers[u].rtpSender){a.transceivers[u].rtpSender.setTransport(a.transceivers[0].dtlsTransport)}if(a.transceivers[u].rtpReceiver){a.transceivers[u].rtpReceiver.setTransport(a.transceivers[0].dtlsTransport)}}if(i.type==="offer"&&!m){E=a.transceivers[u]||a._createTransceiver(g);E.mid=S;if(!E.iceGatherer){E.iceGatherer=a._createIceGatherer(u,h)}if(x.length&&E.iceTransport.state==="new"){if(N&&(!h||u===0)){E.iceTransport.setRemoteCandidates(x)}else{x.forEach(function(e){l(E.iceTransport,e)})}}I=e.RTCRtpReceiver.getCapabilities(g);if(t<15019){I.codecs=I.codecs.filter(function(e){return e.name!=="rtx"})}T=E.sendEncodingParameters||[{ssrc:(2*u+2)*1001}];var j=false;if(C==="sendrecv"||C==="sendonly"){j=!E.rtpReceiver;R=E.rtpReceiver||new e.RTCRtpReceiver(E.dtlsTransport,g);if(j){var F;P=R.track;if(_&&_.stream==="-"){}else if(_){if(!o[_.stream]){o[_.stream]=new e.MediaStream;Object.defineProperty(o[_.stream],"id",{get:function(){return _.stream}})}Object.defineProperty(P,"id",{get:function(){return _.track}});F=o[_.stream]}else{if(!o.default){o.default=new e.MediaStream}F=o.default}if(F){n(P,F);E.associatedRemoteMediaStreams.push(F)}s.push([P,R,F])}}else if(E.rtpReceiver&&E.rtpReceiver.track){E.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===E.rtpReceiver.track.id});if(t){d(t,e)}});E.associatedRemoteMediaStreams=[]}E.localCapabilities=I;E.remoteCapabilities=w;E.rtpReceiver=R;E.rtcpParameters=D;E.sendEncodingParameters=T;E.recvEncodingParameters=k;a._transceive(a.transceivers[u],false,j)}else if(i.type==="answer"&&!m){E=a.transceivers[u];L=E.iceGatherer;M=E.iceTransport;b=E.dtlsTransport;R=E.rtpReceiver;T=E.sendEncodingParameters;I=E.localCapabilities;a.transceivers[u].recvEncodingParameters=k;a.transceivers[u].remoteCapabilities=w;a.transceivers[u].rtcpParameters=D;if(x.length&&M.state==="new"){if((v||N)&&(!h||u===0)){M.setRemoteCandidates(x)}else{x.forEach(function(e){l(E.iceTransport,e)})}}if(!h||u===0){if(M.state==="new"){M.start(L,O,"controlling")}if(b.state==="new"){b.start(A)}}a._transceive(E,C==="sendrecv"||C==="recvonly",C==="sendrecv"||C==="sendonly");if(R&&(C==="sendrecv"||C==="sendonly")){P=R.track;if(_){if(!o[_.stream]){o[_.stream]=new e.MediaStream}n(P,o[_.stream]);s.push([P,R,o[_.stream]])}else{if(!o.default){o.default=new e.MediaStream}n(P,o.default);s.push([P,R,o.default])}}else{delete E.rtpReceiver}}});if(a._dtlsRole===undefined){a._dtlsRole=i.type==="offer"?"active":"passive"}a.remoteDescription={type:i.type,sdp:i.sdp};if(i.type==="offer"){a._updateSignalingState("have-remote-offer")}else{a._updateSignalingState("stable")}Object.keys(o).forEach(function(t){var n=o[t];if(n.getTracks().length){if(a.remoteStreams.indexOf(n)===-1){a.remoteStreams.push(n);var r=new Event("addstream");r.stream=n;e.setTimeout(function(){a._dispatchEvent("addstream",r)})}s.forEach(function(e){var t=e[0];var r=e[1];if(n.id!==e[2].id){return}f(a,t,r,[n])})}});s.forEach(function(e){if(e[2]){return}f(a,e[0],e[1],[])});e.setTimeout(function(){if(!(a&&a.transceivers)){return}a.transceivers.forEach(function(e){if(e.iceTransport&&e.iceTransport.state==="new"&&e.iceTransport.getRemoteCandidates().length>0){console.warn("Timeout for addRemoteCandidate. Consider sending "+"an end-of-candidates notification");e.iceTransport.addRemoteCandidate({})}})},4e3);return Promise.resolve()};g.prototype.close=function(){this.transceivers.forEach(function(e){if(e.iceTransport){e.iceTransport.stop()}if(e.dtlsTransport){e.dtlsTransport.stop()}if(e.rtpSender){e.rtpSender.stop()}if(e.rtpReceiver){e.rtpReceiver.stop()}});this._isClosed=true;this._updateSignalingState("closed")};g.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)};g.prototype._maybeFireNegotiationNeeded=function(){var t=this;if(this.signalingState!=="stable"||this.needNegotiation===true){return}this.needNegotiation=true;e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=false;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0)};g.prototype._updateIceConnectionState=function(){var e;var t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){t[e.iceTransport.state]++});e="new";if(t.failed>0){e="failed"}else if(t.checking>0){e="checking"}else if(t.disconnected>0){e="disconnected"}else if(t.new>0){e="new"}else if(t.connected>0){e="connected"}else if(t.completed>0){e="completed"}if(e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}};g.prototype._updateConnectionState=function(){var e;var t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){t[e.iceTransport.state]++;t[e.dtlsTransport.state]++});t.connected+=t.completed;e="new";if(t.failed>0){e="failed"}else if(t.connecting>0){e="connecting"}else if(t.disconnected>0){e="disconnected"}else if(t.new>0){e="new"}else if(t.connected>0){e="connected"}if(e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}};g.prototype.createOffer=function(){var n=this;if(n._isClosed){return Promise.reject(u("InvalidStateError","Can not call createOffer after close"))}var i=n.transceivers.filter(function(e){return e.kind==="audio"}).length;var o=n.transceivers.filter(function(e){return e.kind==="video"}).length;var s=arguments[0];if(s){if(s.mandatory||s.optional){throw new TypeError("Legacy mandatory/optional constraints not supported.")}if(s.offerToReceiveAudio!==undefined){if(s.offerToReceiveAudio===true){i=1}else if(s.offerToReceiveAudio===false){i=0}else{i=s.offerToReceiveAudio}}if(s.offerToReceiveVideo!==undefined){if(s.offerToReceiveVideo===true){o=1}else if(s.offerToReceiveVideo===false){o=0}else{o=s.offerToReceiveVideo}}}n.transceivers.forEach(function(e){if(e.kind==="audio"){i--;if(i<0){e.wantReceive=false}}else if(e.kind==="video"){o--;if(o<0){e.wantReceive=false}}});while(i>0||o>0){if(i>0){n._createTransceiver("audio");i--}if(o>0){n._createTransceiver("video");o--}}var c=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(i,a){var o=i.track;var s=i.kind;var c=i.mid||r.generateIdentifier();i.mid=c;if(!i.iceGatherer){i.iceGatherer=n._createIceGatherer(a,n.usingBundle)}var l=e.RTCRtpSender.getCapabilities(s);if(t<15019){l.codecs=l.codecs.filter(function(e){return e.name!=="rtx"})}l.codecs.forEach(function(e){if(e.name==="H264"&&e.parameters["level-asymmetry-allowed"]===undefined){e.parameters["level-asymmetry-allowed"]="1"}if(i.remoteCapabilities&&i.remoteCapabilities.codecs){i.remoteCapabilities.codecs.forEach(function(t){if(e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate){e.preferredPayloadType=t.payloadType}})}});l.headerExtensions.forEach(function(e){var t=i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[];t.forEach(function(t){if(e.uri===t.uri){e.id=t.id}})});var u=i.sendEncodingParameters||[{ssrc:(2*a+1)*1001}];if(o){if(t>=15019&&s==="video"&&!u[0].rtx){u[0].rtx={ssrc:u[0].ssrc+1}}}if(i.wantReceive){i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)}i.localCapabilities=l;i.sendEncodingParameters=u});if(n._config.bundlePolicy!=="max-compat"){c+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"}c+="a=ice-options:trickle\r\n";n.transceivers.forEach(function(e,t){c+=a(e,e.localCapabilities,"offer",e.stream,n._dtlsRole);c+="a=rtcp-rsize\r\n";if(e.iceGatherer&&n.iceGatheringState!=="new"&&(t===0||!n.usingBundle)){e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1;c+="a="+r.writeCandidate(e)+"\r\n"});if(e.iceGatherer.state==="completed"){c+="a=end-of-candidates\r\n"}}});var l=new e.RTCSessionDescription({type:"offer",sdp:c});return Promise.resolve(l)};g.prototype.createAnswer=function(){var n=this;if(n._isClosed){return Promise.reject(u("InvalidStateError","Can not call createAnswer after close"))}if(!(n.signalingState==="have-remote-offer"||n.signalingState==="have-local-pranswer")){return Promise.reject(u("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState))}var i=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);if(n.usingBundle){i+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"}var o=r.getMediaSections(n.remoteDescription.sdp).length;n.transceivers.forEach(function(e,r){if(r+1>o){return}if(e.rejected){if(e.kind==="application"){i+="m=application 0 DTLS/SCTP 5000\r\n"}else if(e.kind==="audio"){i+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\n"+"a=rtpmap:0 PCMU/8000\r\n"}else if(e.kind==="video"){i+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\n"+"a=rtpmap:120 VP8/90000\r\n"}i+="c=IN IP4 0.0.0.0\r\n"+"a=inactive\r\n"+"a=mid:"+e.mid+"\r\n";return}if(e.stream){var c;if(e.kind==="audio"){c=e.stream.getAudioTracks()[0]}else if(e.kind==="video"){c=e.stream.getVideoTracks()[0]}if(c){if(t>=15019&&e.kind==="video"&&!e.sendEncodingParameters[0].rtx){e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}}}}var l=s(e.localCapabilities,e.remoteCapabilities);var u=l.codecs.filter(function(e){return e.name.toLowerCase()==="rtx"}).length;if(!u&&e.sendEncodingParameters[0].rtx){delete e.sendEncodingParameters[0].rtx}i+=a(e,l,"answer",e.stream,n._dtlsRole);if(e.rtcpParameters&&e.rtcpParameters.reducedSize){i+="a=rtcp-rsize\r\n"}});var c=new e.RTCSessionDescription({type:"answer",sdp:i});return Promise.resolve(c)};g.prototype.addIceCandidate=function(e){var t=this;var n;if(e&&!(e.sdpMLineIndex!==undefined||e.sdpMid)){return Promise.reject(new TypeError("sdpMLineIndex or sdpMid required"))}return new Promise(function(i,a){if(!t.remoteDescription){return a(u("InvalidStateError","Can not add ICE candidate without a remote description"))}else if(!e||e.candidate===""){for(var o=0;o<t.transceivers.length;o++){if(t.transceivers[o].rejected){continue}t.transceivers[o].iceTransport.addRemoteCandidate({});n=r.getMediaSections(t.remoteDescription.sdp);n[o]+="a=end-of-candidates\r\n";t.remoteDescription.sdp=r.getDescription(t.remoteDescription.sdp)+n.join("");if(t.usingBundle){break}}}else{var s=e.sdpMLineIndex;if(e.sdpMid){for(var c=0;c<t.transceivers.length;c++){if(t.transceivers[c].mid===e.sdpMid){s=c;break}}}var d=t.transceivers[s];if(d){if(d.rejected){return i()}var f=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if(f.protocol==="tcp"&&(f.port===0||f.port===9)){return i()}if(f.component&&f.component!==1){return i()}if(s===0||s>0&&d.iceTransport!==t.transceivers[0].iceTransport){if(!l(d.iceTransport,f)){return a(u("OperationError","Can not add ICE candidate"))}}var g=e.candidate.trim();if(g.indexOf("a=")===0){g=g.substr(2)}n=r.getMediaSections(t.remoteDescription.sdp);n[s]+="a="+(f.type?g:"end-of-candidates")+"\r\n";t.remoteDescription.sdp=r.getDescription(t.remoteDescription.sdp)+n.join("")}else{return a(u("OperationError","Can not add ICE candidate"))}}i()})};g.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;this.transceivers.forEach(function(e){if(e.rtpSender&&e.rtpSender.track===t){n=e.rtpSender}else if(e.rtpReceiver&&e.rtpReceiver.track===t){n=e.rtpReceiver}});if(!n){throw u("InvalidAccessError","Invalid selector.")}return n.getStats()}var r=[];this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){if(e[t]){r.push(e[t].getStats())}})});return Promise.all(r).then(function(e){var t=new Map;e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})});return t})};var p=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];p.forEach(function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then(function(e){var t=new Map;Object.keys(e).forEach(function(n){e[n].type=i(e[n]);t.set(n,e[n])});return t})}}});var v=["createOffer","createAnswer"];v.forEach(function(e){var t=g.prototype[e];g.prototype[e]=function(){var e=arguments;if(typeof e[0]==="function"||typeof e[1]==="function"){return t.apply(this,[arguments[2]]).then(function(t){if(typeof e[0]==="function"){e[0].apply(null,[t])}},function(t){if(typeof e[1]==="function"){e[1].apply(null,[t])}})}return t.apply(this,arguments)}});v=["setLocalDescription","setRemoteDescription","addIceCandidate"];v.forEach(function(e){var t=g.prototype[e];g.prototype[e]=function(){var e=arguments;if(typeof e[1]==="function"||typeof e[2]==="function"){return t.apply(this,arguments).then(function(){if(typeof e[1]==="function"){e[1].apply(null)}},function(t){if(typeof e[2]==="function"){e[2].apply(null,[t])}})}return t.apply(this,arguments)}});["getStats"].forEach(function(e){var t=g.prototype[e];g.prototype[e]=function(){var e=arguments;if(typeof e[1]==="function"){return t.apply(this,arguments).then(function(){if(typeof e[1]==="function"){e[1].apply(null)}})}return t.apply(this,arguments)}});return g}},function(e,t,n){"use strict";e.exports=function(e){var t=e&&e.navigator;var n=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}};var r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(n(e))})}}},function(e,t,n){"use strict";var r=n(9);var i={shimOnTrack:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){if(this._ontrack){this.removeEventListener("track",this._ontrack);this.removeEventListener("addstream",this._ontrackpoly)}this.addEventListener("track",this._ontrack=e);this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t;n.receiver={track:t};n.transceiver={receiver:n.receiver};n.streams=[e.stream];this.dispatchEvent(n)}.bind(this))}.bind(this))}})}if(typeof e==="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)){Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}},shimSourceObject:function(e){if(typeof e==="object"){if(e.HTMLMediaElement&&!("srcObject"in e.HTMLMediaElement.prototype)){Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}})}}},shimPeerConnection:function(e){var t=r.detectBrowser(e);if(typeof e!=="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection)){return}if(!e.RTCPeerConnection){e.RTCPeerConnection=function(n,r){if(t.version<38){if(n&&n.iceServers){var i=[];for(var a=0;a<n.iceServers.length;a++){var o=n.iceServers[a];if(o.hasOwnProperty("urls")){for(var s=0;s<o.urls.length;s++){var c={url:o.urls[s]};if(o.urls[s].indexOf("turn")===0){c.username=o.username;c.credential=o.credential}i.push(c)}}else{i.push(n.iceServers[a])}}n.iceServers=i}}return new e.mozRTCPeerConnection(n,r)};e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype;if(e.mozRTCPeerConnection.generateCertificate){Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}})}e.RTCSessionDescription=e.mozRTCSessionDescription;e.RTCIceCandidate=e.mozRTCIceCandidate}["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){arguments[0]=new(t==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]);return n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}return n.apply(this,arguments)};var i=function(e){var t=new Map;Object.keys(e).forEach(function(n){t.set(n,e[n]);t[n]=e[n]});return t};var a={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"};var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return o.apply(this,[e||null]).then(function(e){if(t.version<48){e=i(e)}if(t.version<53&&!n){try{e.forEach(function(e){e.type=a[e.type]||e.type})}catch(t){if(t.name!=="TypeError"){throw t}e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:a[t.type]||t.type}))})}}return e}).then(n,r)}},shimRemoveStream:function(e){if("removeStream"in e.RTCPeerConnection.prototype){return}e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;r.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(n){if(n.track&&e.getTracks().indexOf(n.track)!==-1){t.removeTrack(n)}})}}};e.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimRemoveStream:i.shimRemoveStream,shimGetUserMedia:n(75)}},function(e,t,n){"use strict";var r=n(9);var i=r.log;e.exports=function(e){var t=r.detectBrowser(e);var n=e&&e.navigator;var a=e&&e.MediaStreamTrack;var o=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the "+"user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}};var s=function(e,r,a){var s=function(e){if(typeof e!=="object"||e.require){return e}var t=[];Object.keys(e).forEach(function(n){if(n==="require"||n==="advanced"||n==="mediaSource"){return}var r=e[n]=typeof e[n]==="object"?e[n]:{ideal:e[n]};if(r.min!==undefined||r.max!==undefined||r.exact!==undefined){t.push(n)}if(r.exact!==undefined){if(typeof r.exact==="number"){r.min=r.max=r.exact}else{e[n]=r.exact}delete r.exact}if(r.ideal!==undefined){e.advanced=e.advanced||[];var i={};if(typeof r.ideal==="number"){i[n]={min:r.ideal,max:r.ideal}}else{i[n]=r.ideal}e.advanced.push(i);delete r.ideal;if(!Object.keys(r).length){delete e[n]}}});if(t.length){e.require=t}return e};e=JSON.parse(JSON.stringify(e));if(t.version<38){i("spec: "+JSON.stringify(e));if(e.audio){e.audio=s(e.audio)}if(e.video){e.video=s(e.video)}i("ff37: "+JSON.stringify(e))}return n.mozGetUserMedia(e,r,function(e){a(o(e))})};var c=function(e){return new Promise(function(t,n){s(e,t,n)})};if(!n.mediaDevices){n.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}}n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})};if(t.version<41){var l=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return l().then(undefined,function(e){if(e.name==="NotFoundError"){return[]}throw e})}}if(t.version<49){var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length){t.getTracks().forEach(function(e){e.stop()});throw new DOMException("The object can not be found here.","NotFoundError")}return t},function(e){return Promise.reject(o(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var d=function(e,t,n){if(t in e&&!(n in e)){e[n]=e[t];delete e[t]}};var f=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){if(typeof e==="object"&&typeof e.audio==="object"){e=JSON.parse(JSON.stringify(e));d(e.audio,"autoGainControl","mozAutoGainControl");d(e.audio,"noiseSuppression","mozNoiseSuppression")}return f(e)};if(a&&a.prototype.getSettings){var g=a.prototype.getSettings;a.prototype.getSettings=function(){var e=g.apply(this,arguments);d(e,"mozAutoGainControl","autoGainControl");d(e,"mozNoiseSuppression","noiseSuppression");return e}}if(a&&a.prototype.applyConstraints){var p=a.prototype.applyConstraints;a.prototype.applyConstraints=function(e){if(this.kind==="audio"&&typeof e==="object"){e=JSON.parse(JSON.stringify(e));d(e,"autoGainControl","mozAutoGainControl");d(e,"noiseSuppression","mozNoiseSuppression")}return p.apply(this,[e])}}}n.getUserMedia=function(e,i,a){if(t.version<44){return s(e,i,a)}r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");n.mediaDevices.getUserMedia(e).then(i,a)}}},function(e,t,n){"use strict";var r=n(9);var i={shimLocalStreamsAPI:function(e){if(typeof e!=="object"||!e.RTCPeerConnection){return}if(!("getLocalStreams"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.getLocalStreams=function(){if(!this._localStreams){this._localStreams=[]}return this._localStreams}}if(!("getStreamById"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;if(this._localStreams){this._localStreams.forEach(function(n){if(n.id===e){t=n}})}if(this._remoteStreams){this._remoteStreams.forEach(function(n){if(n.id===e){t=n}})}return t}}if(!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){if(!this._localStreams){this._localStreams=[]}if(this._localStreams.indexOf(e)===-1){this._localStreams.push(e)}var n=this;e.getTracks().forEach(function(r){t.call(n,r,e)})};e.RTCPeerConnection.prototype.addTrack=function(e,n){if(n){if(!this._localStreams){this._localStreams=[n]}else if(this._localStreams.indexOf(n)===-1){this._localStreams.push(n)}}t.call(this,e,n)}}if(!("removeStream"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.removeStream=function(e){if(!this._localStreams){this._localStreams=[]}var t=this._localStreams.indexOf(e);if(t===-1){return}this._localStreams.splice(t,1);var n=this;var r=e.getTracks();this.getSenders().forEach(function(e){if(r.indexOf(e.track)!==-1){n.removeTrack(e)}})}}},shimRemoteStreamsAPI:function(e){if(typeof e!=="object"||!e.RTCPeerConnection){return}if(!("getRemoteStreams"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}}if(!("onaddstream"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){if(this._onaddstream){this.removeEventListener("addstream",this._onaddstream);this.removeEventListener("track",this._onaddstreampoly)}this.addEventListener("addstream",this._onaddstream=e);this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(!this._remoteStreams){this._remoteStreams=[]}if(this._remoteStreams.indexOf(t)>=0){return}this._remoteStreams.push(t);var n=new Event("addstream");n.stream=e.streams[0];this.dispatchEvent(n)}.bind(this))}})}},shimCallbacksAPI:function(e){if(typeof e!=="object"||!e.RTCPeerConnection){return}var t=e.RTCPeerConnection.prototype;var n=t.createOffer;var r=t.createAnswer;var i=t.setLocalDescription;var a=t.setRemoteDescription;var o=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0];var i=n.apply(this,[r]);if(!t){return i}i.then(e,t);return Promise.resolve()};t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0];var i=r.apply(this,[n]);if(!t){return i}i.then(e,t);return Promise.resolve()};var s=function(e,t,n){var r=i.apply(this,[e]);if(!n){return r}r.then(t,n);return Promise.resolve()};t.setLocalDescription=s;s=function(e,t,n){var r=a.apply(this,[e]);if(!n){return r}r.then(t,n);return Promise.resolve()};t.setRemoteDescription=s;s=function(e,t,n){var r=o.apply(this,[e]);if(!n){return r}r.then(t,n);return Promise.resolve()};t.addIceCandidate=s},shimGetUserMedia:function(e){var t=e&&e.navigator;if(!t.getUserMedia){if(t.webkitGetUserMedia){t.getUserMedia=t.webkitGetUserMedia.bind(t)}else if(t.mediaDevices&&t.mediaDevices.getUserMedia){t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)}}},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){var i=[];for(var a=0;a<e.iceServers.length;a++){var o=e.iceServers[a];if(!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")){r.deprecated("RTCIceServer.url","RTCIceServer.urls");o=JSON.parse(JSON.stringify(o));o.urls=o.url;delete o.url;i.push(o)}else{i.push(e.iceServers[a])}}e.iceServers=i}return new t(e,n)};e.RTCPeerConnection.prototype=t.prototype;if("generateCertificate"in e.RTCPeerConnection){Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}},shimTrackEventTransceiver:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver){Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){var r=n.getTransceivers().find(function(e){return e.sender.track&&e.sender.track.kind==="audio"});if(e.offerToReceiveAudio===false&&r){if(r.direction==="sendrecv"){r.setDirection("sendonly")}else if(r.direction==="recvonly"){r.setDirection("inactive")}}else if(e.offerToReceiveAudio===true&&!r){n.addTransceiver("audio")}var i=n.getTransceivers().find(function(e){return e.sender.track&&e.sender.track.kind==="video"});if(e.offerToReceiveVideo===false&&i){if(i.direction==="sendrecv"){i.setDirection("sendonly")}else if(i.direction==="recvonly"){i.setDirection("inactive")}}else if(e.offerToReceiveVideo===true&&!i){n.addTransceiver("video")}}return t.apply(n,arguments)}}};e.exports={shimCallbacksAPI:i.shimCallbacksAPI,shimLocalStreamsAPI:i.shimLocalStreamsAPI,shimRemoteStreamsAPI:i.shimRemoteStreamsAPI,shimGetUserMedia:i.shimGetUserMedia,shimRTCIceServerUrls:i.shimRTCIceServerUrls,shimTrackEventTransceiver:i.shimTrackEventTransceiver,shimCreateOfferLegacy:i.shimCreateOfferLegacy}},function(e,t,n){"use strict";var r=n(43);var i=n(9);function a(e,t,n){if(!e.RTCPeerConnection){return}var r=e.RTCPeerConnection.prototype;var i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t){return i.apply(this,arguments)}var a=function(e){r(n(e))};this._eventMap=this._eventMap||{};this._eventMap[r]=a;return i.apply(this,[e,a])};var a=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n]){return a.apply(this,arguments)}var r=this._eventMap[n];delete this._eventMap[n];return a.apply(this,[e,r])};Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){if(this["_on"+t]){this.removeEventListener(t,this["_on"+t]);delete this["_on"+t]}if(e){this.addEventListener(t,this["_on"+t]=e)}}})}e.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype){return}var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if(typeof e==="object"&&e.candidate&&e.candidate.indexOf("a=")===0){e=JSON.parse(JSON.stringify(e));e.candidate=e.candidate.substr(2)}var n=new t(e);var i=r.parseCandidate(e.candidate);var a=Object.assign(n,i);a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}};return a};a(e,"icecandidate",function(t){if(t.candidate){Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"})}return t})},shimCreateObjectURL:function(e){var t=e&&e.URL;if(!(typeof e==="object"&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL)){return undefined}var n=t.createObjectURL.bind(t);var r=t.revokeObjectURL.bind(t);var a=new Map,o=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++o;a.set(t,e);i.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream");return t}return n(e)};t.revokeObjectURL=function(e){r(e);a.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){this.srcObject=a.get(e)||null;return s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){if(arguments.length===2&&(""+arguments[0]).toLowerCase()==="src"){this.srcObject=a.get(arguments[1])||null}return c.apply(this,arguments)}}}}]);
//# sourceMappingURL=voximplant.map.js