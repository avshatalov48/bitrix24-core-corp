(function(){BX.namespace("BX.Voximplant");var t={};BX.Voximplant.alert=function(t,e){var n=new BX.PopupWindow("voximplant-alert",null,{closeIcon:true,closeByEsc:true,autoHide:false,titleBar:t,content:e,overlay:{color:"gray",opacity:30},buttons:[new BX.PopupWindowButton({id:"close",text:BX.message("VOX_JS_COMMON_CLOSE"),events:{click:function(){n.close()}}})],events:{onPopupClose:function(){this.destroy()},onPopupDestroy:function(){n=null}}});n.show()};BX.Voximplant.setLicensePopup=function(e,n,i){t[e]={title:n,content:i}};BX.Voximplant.showLicensePopup=function(e){if(B24&&B24.licenseInfoPopup&&t.hasOwnProperty(e)){B24.licenseInfoPopup.show(e,t[e].title,t[e].content)}};if(typeof BX.Voximplant.UserSelector=="undefined"){BX.Voximplant.UserSelector=function(){this._id="";this._settings={};this._fieldId="";this._control=null;this._currentUser=null;this._componentName=null;this._componentObj=null;this._componentContainer=null;this._serviceContainer=null;this._zIndex=1100;this._isDialogDisplayed=false;this._dialog=null;this._inputKeyPressHandler=BX.delegate(this.onInputKeyPress,this)};BX.Voximplant.UserSelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._fieldId=this.getSetting("fieldId","");this._componentName=this.getSetting("componentName","");this._componentContainer=BX(this._componentName+"_selector_content");this._serviceContainer=this.getSetting("serviceContainer",null);if(!BX.type.isDomNode(this._serviceContainer)){this._serviceContainer=document.body}BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this))},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getSearchInput:function(){return this._control?this._control.getLabelNode():null},isOpened:function(){return this._isDialogDisplayed},open:function(){if(this._componentObj===null){var t="O_"+this._componentName;if(!window[t]){throw"BX.Voximplant.UserSelector: Could not find '"+t+"' user selector."}this._componentObj=window[t]}var e=this.getSearchInput();if(this._componentObj.searchInput){BX.unbind(this._componentObj.searchInput,"keyup",BX.proxy(this._componentObj.search,this._componentObj))}this._componentObj.searchInput=e;BX.bind(this._componentObj.searchInput,"keyup",BX.proxy(this._componentObj.search,this._componentObj));this._componentObj.onSelect=BX.delegate(this.onSelect,this);BX.bind(e,"keyup",this._inputKeyPressHandler);if(this._currentUser){this._componentObj.setSelected([this._currentUser])}else{var n=this._componentObj.getSelected();if(n){for(var i in n){if(n.hasOwnProperty(i)){this._componentObj.unselect(i)}}}}if(this._dialog===null){this._componentContainer.style.display="";this._dialog=new BX.PopupWindow(this._id,this.getSearchInput(),{autoHide:false,draggable:false,closeByEsc:true,offsetLeft:0,offsetTop:0,zIndex:this._zIndex,bindOptions:{forceBindPosition:true},content:this._componentContainer,events:{onPopupShow:BX.delegate(this.onDialogShow,this),onPopupClose:BX.delegate(this.onDialogClose,this),onPopupDestroy:BX.delegate(this.onDialogDestroy,this)}})}this._dialog.show();this._componentObj._onFocus();if(this._control){this._control.setPopupContainer(this._componentContainer)}},close:function(){var t=this.getSearchInput();if(t){BX.unbind(t,"keyup",this._inputKeyPressHandler)}if(this._dialog){this._dialog.close()}if(this._control){this._control.setPopupContainer(null)}},closeSiblings:function(){var t=BX.Voximplant.UserSelector.items;for(var e in t){if(t.hasOwnProperty(e)&&t[e]!==this){t[e].close()}}},onCustomEntitySelectorOpen:function(t){var e=t.getId();if(this._fieldId!==e){this._control=null;this.close()}else{this._control=t;if(this._control){var n=this._control.getCurrentValues();this._currentUser={id:n["value"]}}this.closeSiblings();this.open()}},onCustomEntitySelectorClose:function(t){if(this._fieldId===t.getId()){this._control=null;this.close()}},onDialogShow:function(){this._isDialogDisplayed=true},onDialogClose:function(){this._componentContainer.parentNode.removeChild(this._componentContainer);this._serviceContainer.appendChild(this._componentContainer);this._componentContainer.style.display="none";this._dialog.destroy();this._isDialogDisplayed=false},onDialogDestroy:function(){this._dialog=null},onInputKeyPress:function(t){if(!this._dialog||!this._isDialogDisplayed){this.open()}if(this._componentObj){this._componentObj.search()}},onSelect:function(t){this._currentUser=t;if(this._control){var e=this._control.getLabelNode();e.value="";this._control.setData(t["name"],t["id"])}this.close()}};BX.Voximplant.UserSelector.closeAll=function(){for(var t in this.items){if(this.items.hasOwnProperty(t)){this.items[t].close()}}};BX.Voximplant.UserSelector.items={};BX.Voximplant.UserSelector.create=function(t,e){var n=new BX.Voximplant.UserSelector(t,e);n.initialize(t,e);this.items[n.getId()]=n;return n}}})();