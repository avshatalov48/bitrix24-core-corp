(function(){BX.namespace("BX.Voximplant");var t={};var n=null;var e=null;var o=function(){return new Promise((function(t){if(BX.Loader){return t()}BX.loadExt("main.loader").then((function(){t()}))}))};BX.Voximplant.showLoader=function(){return new Promise((function(t){o().then((function(){if(!e){e=BX.create("div",{props:{className:"voximplant-loader-overlay"}});document.body.appendChild(e)}if(!n){n=new BX.Loader({target:e})}BX.addClass(e,"active");n.show();t()}))}))};BX.Voximplant.hideLoader=function(){if(!n){return}n.hide();BX.removeClass(e,"active")};BX.Voximplant.alert=function(t,n){return new Promise((function(e){var o=new BX.PopupWindow("voximplant-alert",null,{closeIcon:true,closeByEsc:true,autoHide:false,titleBar:t,content:n,zIndex:16e3,maxWidth:800,overlay:{color:"gray",opacity:30},buttons:[new BX.PopupWindowButton({id:"close",text:BX.message("VOX_JS_COMMON_CLOSE"),events:{click:function(){o.close()}}})],events:{onPopupClose:function(){this.destroy();e()},onPopupDestroy:function(){o=null}}});o.show()}))};BX.Voximplant.confirm=function(t,n,e){return new Promise((function(o){var i=false;var s=new BX.PopupWindow("voximplant-confirm",null,{closeIcon:BX.prop.getBoolean(e,"closeIcon",true),closeByEsc:BX.prop.getBoolean(e,"closeByEsc",true),autoHide:false,titleBar:t,content:n,overlay:{color:"gray",opacity:30},maxWidth:BX.prop.getInteger(e,"maxWidth",800),buttons:[new BX.PopupWindowButton({id:"ok",text:BX.prop.getString(e,"ok",BX.message("VOX_JS_COMMON_OK")),events:{click:function(){i=true;s.close()}}}),new BX.PopupWindowButtonLink({id:"cancel",text:BX.prop.getString(e,"cancel",BX.message("VOX_JS_COMMON_CANCEL")),events:{click:function(){s.close()}}})],events:{onPopupClose:function(){this.destroy();o(i)},onPopupDestroy:function(){s=null}}});s.show()}))};BX.Voximplant.setLicensePopup=function(n,e,o){t[n]={title:e,content:o}};BX.Voximplant.showLicensePopup=function(n){if(B24&&B24.licenseInfoPopup&&t.hasOwnProperty(n)){B24.licenseInfoPopup.show(n,t[n].title,t[n].content)}};BX.Voximplant.openLimitSlider=function(t){t=t||"limit_contact_center_telephony";BX.loadExt("ui.info-helper").then((function(){BX.UI.InfoHelper.show(t)}))};BX.Voximplant.openBilling=function(){var t=function(t,n){return new Promise((function(e){if(n==""){return e()}BX.Voximplant.alert(t,n).then((function(){e()}))}))};var n=function(t){return new Promise((function(n,e){if(t==""){return n(true)}BX.Voximplant.confirm("",t,{ok:BX.message("VOX_JS_COMMON_AGREE"),maxWidth:800}).then((function(t){if(!t){return n(false)}BX.ajax.runAction("voximplant.consent.saveTOSConsent",{}).then((function(t){n(true)})).catch((function(t){e(t)}))}))}))};var e=function(){return new Promise((function(t,n){BX.ajax.runAction("voximplant.urlmanager.getBillingUrl",{}).then(t).catch(n)}))};return new Promise((function(o){var i;e().then((function(n){i=n.data;return t(i.demoWarningTitle,i.demoWarning)})).then((function(){return n(i.disclaimerText)})).then((function(t){if(t){if(BX.browser.isIPhone()){document.location.href=i.billingUrl}else{window.open(i.billingUrl)}}o()})).catch((function(t){console.error(t);var n=t.errors;if(n&&n.length>0&&n[0].code==="paid_plan_required"){BX.Voximplant.openLimitSlider("limit_contact_center_telephony_top_up_balance");return o()}var e=n.map((function(t){return t.message})).join("\n");BX.Voximplant.alert(BX.message("VOX_JS_COMMON_ERROR"),e);o()}))}))};if(typeof BX.Voximplant.UserSelector=="undefined"){BX.Voximplant.UserSelector=function(){this._id="";this._settings={};this._fieldId="";this._control=null;this._currentUser=null;this._componentName=null;this._componentObj=null;this._componentContainer=null;this._serviceContainer=null;this._zIndex=1100;this._isDialogDisplayed=false;this._dialog=null;this._inputKeyPressHandler=BX.delegate(this.onInputKeyPress,this)};BX.Voximplant.UserSelector.prototype={initialize:function(t,n){this._id=t;this._settings=n?n:{};this._fieldId=this.getSetting("fieldId","");this._componentName=this.getSetting("componentName","");this._componentContainer=BX(this._componentName+"_selector_content");this._serviceContainer=this.getSetting("serviceContainer",null);if(!BX.type.isDomNode(this._serviceContainer)){this._serviceContainer=document.body}BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this))},getId:function(){return this._id},getSetting:function(t,n){return this._settings.hasOwnProperty(t)?this._settings[t]:n},getSearchInput:function(){return this._control?this._control.getLabelNode():null},isOpened:function(){return this._isDialogDisplayed},open:function(){if(this._componentObj===null){var t="O_"+this._componentName;if(!window[t]){throw"BX.Voximplant.UserSelector: Could not find '"+t+"' user selector."}this._componentObj=window[t]}var n=this.getSearchInput();if(this._componentObj.searchInput){BX.unbind(this._componentObj.searchInput,"keyup",BX.proxy(this._componentObj.search,this._componentObj))}this._componentObj.searchInput=n;BX.bind(this._componentObj.searchInput,"keyup",BX.proxy(this._componentObj.search,this._componentObj));this._componentObj.onSelect=BX.delegate(this.onSelect,this);BX.bind(n,"keyup",this._inputKeyPressHandler);if(this._currentUser){this._componentObj.setSelected([this._currentUser])}else{var e=this._componentObj.getSelected();if(e){for(var o in e){if(e.hasOwnProperty(o)){this._componentObj.unselect(o)}}}}if(this._dialog===null){this._componentContainer.style.display="";this._dialog=new BX.PopupWindow(this._id,this.getSearchInput(),{autoHide:false,draggable:false,closeByEsc:true,offsetLeft:0,offsetTop:0,zIndex:this._zIndex,bindOptions:{forceBindPosition:true},content:this._componentContainer,events:{onPopupShow:BX.delegate(this.onDialogShow,this),onPopupClose:BX.delegate(this.onDialogClose,this),onPopupDestroy:BX.delegate(this.onDialogDestroy,this)}})}this._dialog.show();this._componentObj._onFocus();if(this._control){this._control.setPopupContainer(this._componentContainer)}},close:function(){var t=this.getSearchInput();if(t){BX.unbind(t,"keyup",this._inputKeyPressHandler)}if(this._dialog){this._dialog.close()}if(this._control){this._control.setPopupContainer(null)}},closeSiblings:function(){var t=BX.Voximplant.UserSelector.items;for(var n in t){if(t.hasOwnProperty(n)&&t[n]!==this){t[n].close()}}},onCustomEntitySelectorOpen:function(t){var n=t.getId();if(this._fieldId!==n){this._control=null;this.close()}else{this._control=t;if(this._control){var e=this._control.getCurrentValues();this._currentUser={id:e["value"]}}this.closeSiblings();this.open()}},onCustomEntitySelectorClose:function(t){if(this._fieldId===t.getId()){this._control=null;this.close()}},onDialogShow:function(){this._isDialogDisplayed=true},onDialogClose:function(){this._componentContainer.parentNode.removeChild(this._componentContainer);this._serviceContainer.appendChild(this._componentContainer);this._componentContainer.style.display="none";this._dialog.destroy();this._isDialogDisplayed=false},onDialogDestroy:function(){this._dialog=null},onInputKeyPress:function(t){if(!this._dialog||!this._isDialogDisplayed){this.open()}if(this._componentObj){this._componentObj.search()}},onSelect:function(t){this._currentUser=t;if(this._control){var n=this._control.getLabelNode();n.value="";this._control.setData(t["name"],t["id"])}this.close()}};BX.Voximplant.UserSelector.closeAll=function(){for(var t in this.items){if(this.items.hasOwnProperty(t)){this.items[t].close()}}};BX.Voximplant.UserSelector.items={};BX.Voximplant.UserSelector.create=function(t,n){var e=new BX.Voximplant.UserSelector(t,n);e.initialize(t,n);this.items[e.getId()]=e;return e}}})();
//# sourceMappingURL=common.map.js