(function(){"use strict";BX.namespace("BX.Voximplant.Report.Dashboard.Content");BX.Voximplant.Report.Dashboard.Content.PeriodCompare={filter:null,timePeriodField:null,previousPeriodField:null,init:function(e){setTimeout(function(){this.filter=BX.Main.filterManager.getById(e);if(this.filter){this.filter.getEmitter().subscribe("BX.Filter.Field:init",this.onFilterFieldInit.bind(this))}else{console.error("Filter "+e+" is not found")}}.bind(this),500)},renderBalloon:function(e,t){var r=e.dataContext.balloon;r.count["value_1"]=r.count["value_1"]||"&mdash;";r.count["value_2"]=r.count["value_2"]||"&mdash;";e.category=e.category.replace("<br>"," / ");return'<div class="telephony-report-period-compare-modal" style="border-color: #F7CC00">'+'<div class="telephony-report-period-compare-modal-title">'+e.category+"</div>"+'<div class="telephony-report-period-compare-modal-main">'+'<div class="telephony-report-period-compare-modal-subtitle-primary">'+r.callType+"<br><br>"+"</div>"+'<div class="telephony-report-period-compare-modal-subtitle-secondary">'+BX.message("TELEPHONY_REPORT_GRAPH_PERIOD_COMPARE_CURRENT")+"</div>"+'<div class="telephony-report-period-compare-modal-content">'+'<div class="telephony-report-period-compare-modal-value">'+r.count["value_1"]+"</div>"+this.renderPercentBlock(r.compare)+"</div>"+'<div class="telephony-report-period-compare-modal-subtitle-secondary">'+BX.message("TELEPHONY_REPORT_GRAPH_PERIOD_COMPARE_PREVIOUS")+"</div>"+'<div class="telephony-report-period-compare-modal-content">'+'<div class="telephony-report-period-compare-modal-value">'+r.count["value_2"]+"</div>"+"</div>"+"</div>"+"</div>"},renderPercentBlock:function(e){if(e===null||e==0){return'<div style="color:grey;">&mdash;</div>'}var t="telephony-report-period-compare-modal-percent-value";if(e>0){t+=" green"}else{t+=" red"}if(e%1===0){e=Math.round(e)}e=(e>0?"+":"")+e.toString();return'<div class="'+t+'">'+e+"%</div>"},onFilterFieldInit:function(e){var t=e.data.field;if(t.id==="TIME_PERIOD"){this.timePeriodField=t;t.subscribe("BX.Filter.Field:change",this.onTimePeriodChange.bind(this))}else if(t.id==="PREVIOUS_TIME_PERIOD"){this.previousPeriodField=t}},onTimePeriodChange:function(e){var t=this.preparePreviousPeriodValue(e.data.value);this.previousPeriodField.setValue(t)},preparePreviousPeriodValue:function(e){var t={_datesel:"",_from:"",_to:""};var r=new Date;var a=[1,1,1,2,2,2,3,3,3,4,4,4];var o=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));switch(e._datesel){case"CURRENT_WEEK":t._datesel="LAST_WEEK";break;case"CURRENT_MONTH":t._datesel="LAST_MONTH";break;case"CURRENT_QUARTER":t._datesel="QUARTER";var i=a[r.getMonth()];if(i==1){t._quarter=4;t._year=r.getFullYear()-1}else{t._quarter=3;t._year=r.getFullYear()}break;case"QUARTER":t._datesel="QUARTER";if(e._quarter==1){t._quarter=4;t._year=e._year-1}else{t._quarter=e._quarter-1;t._year=e._year}break;case"LAST_7_DAYS":t._datesel="RANGE";this.setPreviousPeriodDates(7,t);break;case"LAST_30_DAYS":t._datesel="RANGE";this.setPreviousPeriodDates(30,t);break;case"LAST_60_DAYS":t._datesel="RANGE";this.setPreviousPeriodDates(60,t);break;case"LAST_90_DAYS":t._datesel="RANGE";this.setPreviousPeriodDates(90,t);break;case"LAST_WEEK":t._datesel="RANGE";var l=new Date;l.setDate(l.getDate()-l.getDay()+1-14);var s=new Date(l.valueOf());s.setDate(s.getDate()+6);t._from=BX.date.format(o,l);t._to=BX.date.format(o,s);break;case"LAST_MONTH":t._datesel="MONTH";if(r.getMonth()<=1){t._month=10+r.getMonth();t._year=r.getFullYear()-1}else{t._month=r.getMonth()-1;t._year=r.getFullYear()}break;case"MONTH":t._datesel="MONTH";t._month=r.getMonth()===0?11:r.getMonth();t._year=r.getMonth()===0?r.getFullYear()-1:r.getFullYear();break;case"YEAR":t._datesel="YEAR";t._year=r.getFullYear()-1;break;case"RANGE":t._datesel="RANGE";break}for(var d in t){if(t.hasOwnProperty(d)){t[d]=t[d].toString()}}return t},setPreviousPeriodDates:function(e,t){var r=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));var a=new Date;a.setDate(a.getDate()-e*2+1);t._from=BX.date.format(r,a);var o=new Date;o.setDate(o.getDate()-e+1);t._to=BX.date.format(r,o)}}})();
//# sourceMappingURL=view.map.js