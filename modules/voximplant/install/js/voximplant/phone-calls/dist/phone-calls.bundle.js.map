{"version":3,"file":"phone-calls.bundle.js","sources":["../src/view/common.js","../src/view/keypad.js","../src/view/background-worker/base-worker.js","../src/view/background-worker/desktop-worker.js","../src/view/background-worker/browser-worker.js","../src/view/background-worker.js","../src/view/form-manager.js","../src/view/call-list.js","../src/view/folded-view.js","../src/view/desktop.js","../src/view/view.js","../src/controller.js","../src/index.js"],"sourcesContent":["export const baseZIndex = 15000;\nexport const nop = function() {};\n","import {Dom, Type, Text, Loc} from 'main.core';\nimport {Popup, Menu} from 'main.popup';\nimport {baseZIndex, nop} from './common';\n\nconst digits = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '*', '0', '#']\n\ntype KeypadParams = {\n\tbindElement: ?HTMLElement,\n\toffsetTop: ?number,\n\toffsetLeft: ?number,\n\tanglePosition: ?string,\n\tangleOffset: ?number,\n\thistory: string[],\n\tdefaultLineId: string,\n\tlines: Object,\n\tavailableLines: string[],\n\tcallInterceptAllowed: boolean,\n\thideDial: boolean,\n\tonButtonClick: () => void,\n\tonDial: () => void,\n\tonIntercept: () => void,\n\tonClose: () => void,\n}\n\nexport class Keypad\n{\n\tconstructor(params: KeypadParams)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {}\n\t\t}\n\n\t\tthis.bindElement = params.bindElement || null;\n\t\tthis.offsetTop = params.offsetTop || 0;\n\t\tthis.offsetLeft = params.offsetLeft || 0;\n\t\tthis.anglePosition = params.anglePosition || '';\n\t\tthis.angleOffset = params.angleOffset || 0;\n\t\tthis.history = params.history || [];\n\n\t\tthis.selectedLineId = params.defaultLineId;\n\t\tthis.lines = params.lines || {}\n\t\tthis.availableLines = params.availableLines || [];\n\n\t\tthis.callInterceptAllowed = params.callInterceptAllowed === true;\n\n\t\tthis.zIndex = baseZIndex + 200;\n\n\t\t//flags\n\t\tthis.hideDial = (params.hideDial === true);\n\t\tthis.plusEntered = false;\n\n\t\tthis.callbacks = {\n\t\t\tonButtonClick: Type.isFunction(params.onButtonClick) ? params.onButtonClick : nop,\n\t\t\tonDial: Type.isFunction(params.onDial) ? params.onDial : nop,\n\t\t\tonIntercept: Type.isFunction(params.onIntercept) ? params.onIntercept : nop,\n\t\t\tonClose: Type.isFunction(params.onClose) ? params.onClose : nop\n\t\t}\n\n\t\tthis.elements = {\n\t\t\tinputContainer: null,\n\t\t\tinput: null,\n\t\t\tlineSelector: null,\n\t\t\tlineName: null,\n\t\t\tinterceptButton: null,\n\t\t\thistoryButton: null\n\t\t}\n\t\tthis.plusKeyTimeout = null;\n\n\t\tthis.popup = this.createPopup();\n\t}\n\n\tcreatePopup()\n\t{\n\t\tlet popupOptions = {\n\t\t\tid: 'phone-call-view-popup-keypad',\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tdarkMode: true,\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\tcontent: this.render(),\n\t\t\tnoAllPaddings: true,\n\n\t\t\toffsetTop: this.offsetTop,\n\t\t\toffsetLeft: this.offsetLeft,\n\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: this.onPopupClose.bind(this)\n\t\t\t}\n\t\t}\n\n\t\tif (this.anglePosition !== '')\n\t\t{\n\t\t\tpopupOptions.angle = {\n\t\t\t\tposition: this.anglePosition,\n\t\t\t\toffset: this.angleOffset\n\t\t\t}\n\t\t}\n\n\t\treturn new Popup(popupOptions);\n\t}\n\n\tonPopupClose()\n\t{\n\t\tthis.callbacks.onClose();\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\t}\n\n\tcanSelectLine()\n\t{\n\t\treturn this.availableLines.length > 1;\n\t}\n\n\tsetSelectedLineId(lineId)\n\t{\n\t\tthis.selectedLineId = lineId;\n\n\t\tif (this.elements.lineName)\n\t\t{\n\t\t\tthis.elements.lineName.innerText = this.getLineName(lineId)\n\t\t}\n\t}\n\n\tgetLineName(lineId)\n\t{\n\t\treturn this.lines.hasOwnProperty(lineId) ? this.lines[lineId].SHORT_NAME : '';\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-calc-wrap\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-calc-body\"}, children: [\n\t\t\t\t\t\tthis.elements.inputContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-calc-panel'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-calc-panel-delete\"}, events: {\n\t\t\t\t\t\t\t\t\t\tclick: this._onDeleteButtonClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.input = Dom.create(\"input\", {\n\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\t'readonly': this.hideDial,\n\t\t\t\t\t\t\t\t\t\ttype: \"text\",\n\t\t\t\t\t\t\t\t\t\tvalue: '',\n\t\t\t\t\t\t\t\t\t\tplaceholder: Loc.getMessage(this.hideDial ? 'IM_PHONE_PUT_DIGIT' : 'IM_PHONE_PUT_NUMBER')\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-calc-panel-input\"},\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tkeydown: this._onInputKeydown.bind(this),\n\t\t\t\t\t\t\t\t\t\tkeyup: () => this._onAfterNumberChanged()\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-calc-btns-block\"},\n\t\t\t\t\t\t\tchildren: digits.map(\n\t\t\t\t\t\t\t\tdigit => renderNumber(digit, this._onKeyMouseDown.bind(this), this._onKeyMouseUp.bind(this))\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.hideDial ? null : Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-btn-wrap\"}, children: [\n\t\t\t\t\t\tthis.elements.lineSelector = !this.canSelectLine() ? null : Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"im-phone-select-line\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.lineName = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"im-phone-select-line-name\"},\n\t\t\t\t\t\t\t\t\ttext: this.getLineName(this.selectedLineId)\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"span\", {props: {className: \"im-phone-select-line-select\"}})\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onLineSelectClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-btn-separate\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-btn\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-btn-text\"},\n\t\t\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL')\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this._onDialButtonClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.historyButton = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-btn-arrow\"},\n\t\t\t\t\t\t\t\t\tevents: {click: this._onShowHistoryButtonClick.bind(this)}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.interceptButton = Dom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"im-phone-intercept-button\" + (this.callInterceptAllowed ? \"\" : \" im-phone-intercept-button-locked\")},\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"IM_PHONE_CALL_VIEW_INTERCEPT\"),\n\t\t\t\t\t\t\tevents: {click: this._onInterceptButtonClick.bind(this)}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t}\n\n\t_onInputKeydown(e: KeyboardEvent)\n\t{\n\t\tif (e.keyCode == 13)\n\t\t{\n\t\t\tthis.callbacks.onDial({\n\t\t\t\tphoneNumber: this.elements.input.value,\n\t\t\t\tlineId: this.selectedLineId\n\t\t\t});\n\t\t}\n\t\telse if (e.keyCode == 37 || e.keyCode == 39 || e.keyCode == 8 || e.keyCode == 107 || e.keyCode == 46 || e.keyCode == 35 || e.keyCode == 36) // left, right, backspace, num plus, home, end\n\t\t{}\n\t\telse if (e.key === '+' || e.key === '#' || e.key === '*') // +\n\t\t{}\n\t\telse if ((e.keyCode == 67 || e.keyCode == 86 || e.keyCode == 65 || e.keyCode == 88) && (e.metaKey || e.ctrlKey)) // ctrl+v/c/a/x\n\t\t{}\n\t\telse if (e.keyCode >= 48 && e.keyCode <= 57 && !e.shiftKey) // 0-9\n\t\t{\n\t\t\tinsertAtCursor(this.elements.input, e.key);\n\n\t\t\te.preventDefault();\n\t\t\tthis.callbacks.onButtonClick({\n\t\t\t\tkey: e.key\n\t\t\t});\n\t\t}\n\t\telse if (e.keyCode >= 96 && e.keyCode <= 105 && !e.shiftKey) // extra 0-9\n\t\t{\n\t\t\tinsertAtCursor(this.elements.input, e.key);\n\n\t\t\te.preventDefault();\n\t\t\tthis.callbacks.onButtonClick({\n\t\t\t\tkey: e.key\n\t\t\t});\n\t\t}\n\t\telse if (!e.ctrlKey && !e.metaKey && !e.altKey)\n\t\t{\n\t\t\te.preventDefault();\n\t\t}\n\t}\n\n\t_onAfterNumberChanged()\n\t{\n\t\tthis.elements.inputContainer.classList.toggle('bx-messenger-calc-panel-active', this.elements.input.value.length > 0);\n\n\t\tthis.elements.input.focus();\n\t}\n\n\t_onDeleteButtonClick()\n\t{\n\t\tthis.elements.input.value = this.elements.input.value.substr(0, this.elements.input.value.length - 1);\n\t\tthis._onAfterNumberChanged();\n\t}\n\n\t_onDialButtonClick()\n\t{\n\t\tthis.callbacks.onDial({\n\t\t\tphoneNumber: this.elements.input.value,\n\t\t\tlineId: this.selectedLineId\n\t\t});\n\t}\n\n\t_onInterceptButtonClick()\n\t{\n\t\tthis.callbacks.onIntercept({\n\t\t\tinterceptButton: this.elements.interceptButton\n\t\t})\n\t}\n\n\t_onKeyMouseDown(key)\n\t{\n\t\tif (key === '0')\n\t\t{\n\t\t\tthis.plusEntered = false;\n\t\t\tthis.plusKeyTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (!this.elements.input.value.startsWith('+'))\n\t\t\t\t{\n\t\t\t\t\tthis.plusEntered = true;\n\t\t\t\t\tthis.elements.input.value = '+' + this.elements.input.value;\n\t\t\t\t}\n\t\t\t}, 500);\n\t\t}\n\t}\n\n\t_onKeyMouseUp(key)\n\t{\n\t\tif (key === '0')\n\t\t{\n\t\t\tclearTimeout(this.plusKeyTimeout);\n\t\t\tif (!this.plusEntered)\n\t\t\t{\n\t\t\t\tinsertAtCursor(this.elements.input, '0');\n\t\t\t}\n\n\t\t\tthis.plusEntered = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tinsertAtCursor(this.elements.input, key);\n\t\t}\n\t\tthis._onAfterNumberChanged();\n\t\tthis.callbacks.onButtonClick({\n\t\t\tkey: key\n\t\t});\n\t}\n\n\t_onShowHistoryButtonClick()\n\t{\n\t\tlet menuItems = [];\n\n\t\tif (!Type.isArray(this.history) || this.history.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.history.forEach((phoneNumber, index) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: \"history_\" + index,\n\t\t\t\ttext: Text.encode(phoneNumber),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.historySelectMenu.close();\n\t\t\t\t\tthis.callbacks.onDial({\n\t\t\t\t\t\tphoneNumber: phoneNumber,\n\t\t\t\t\t\tlineId: this.selectedLineId\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.historySelectMenu = new Menu(\n\t\t\t'phoneCallViewDialHistory',\n\t\t\tthis.elements.historyButton,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tzIndex: baseZIndex + 300,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'top'\n\t\t\t\t},\n\t\t\t\tangle: {\n\t\t\t\t\toffset: 33\n\t\t\t\t},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\toverlay: {\n\t\t\t\t\tbackgroundColor: 'white',\n\t\t\t\t\topacity: 0\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.historySelectMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.historySelectMenu = null,\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.historySelectMenu.show();\n\t}\n\n\t_onLineSelectClick(e)\n\t{\n\t\tlet menuItems = [];\n\t\tthis.availableLines.forEach((lineId) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: \"selectLine_\" + lineId,\n\t\t\t\ttext: Text.encode(this.getLineName(lineId)),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.lineSelectMenu.close();\n\t\t\t\t\tthis.setSelectedLineId(lineId);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.lineSelectMenu = new Menu(\n\t\t\t'phoneCallViewSelectLine',\n\t\t\tthis.elements.lineSelector,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\tzIndex: this.zIndex + 100,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'top'\n\t\t\t\t},\n\t\t\t\toffsetLeft: 35,\n\t\t\t\tangle: {\n\t\t\t\t\toffset: 33\n\t\t\t\t},\n\t\t\t\toverlay: {\n\t\t\t\t\tbackgroundColor: 'white',\n\t\t\t\t\topacity: 0\n\t\t\t\t},\n\t\t\t\tmaxHeight: 600,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.lineSelectMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.lineSelectMenu = null\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.lineSelectMenu.show();\n\t}\n\n\tshow()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\tthis.elements.input.focus();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.lineSelectMenu)\n\t\t{\n\t\t\tthis.lineSelectMenu.destroy();\n\t\t}\n\n\t\tif (this.historySelectMenu)\n\t\t{\n\t\t\tthis.historySelectMenu.destroy();\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.lineSelectMenu)\n\t\t{\n\t\t\tthis.lineSelectMenu.destroy();\n\t\t}\n\n\t\tif (this.historySelectMenu)\n\t\t{\n\t\t\tthis.historySelectMenu.destroy();\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\n\t\tthis.popup = null;\n\t}\n}\n\nfunction renderNumber(number: string, onMouseDown, onMouseUp)\n{\n\tlet classSuffix;\n\tif (number == '*')\n\t{\n\t\tclassSuffix = '10';\n\t}\n\telse if (number == '#')\n\t{\n\t\tclassSuffix = '11';\n\t}\n\telse\n\t{\n\t\tclassSuffix = number;\n\t}\n\treturn Dom.create(\"span\", {\n\t\tdataset: {'digit': number},\n\t\tprops: {className: \"bx-messenger-calc-btn bx-messenger-calc-btn-\" + classSuffix},\n\t\tchildren: [\n\t\t\tDom.create(\"span\", {props: {className: 'bx-messenger-calc-btn-num'}})\n\t\t],\n\t\tevents: {\n\t\t\tmousedown: (e) => onMouseDown(e.currentTarget.dataset.digit),\n\t\t\tmouseup: (e) => onMouseUp(e.currentTarget.dataset.digit)\n\t\t}\n\t});\n}\n\nfunction insertAtCursor(inputElement, value)\n{\n\tif (inputElement.selectionStart || inputElement.selectionStart == '0')\n\t{\n\t\tvar startPos = inputElement.selectionStart;\n\t\tvar endPos = inputElement.selectionEnd;\n\t\tinputElement.value = inputElement.value.substring(0, startPos)\n\t\t\t+ value\n\t\t\t+ inputElement.value.substring(endPos, inputElement.value.length);\n\t\tinputElement.selectionStart = startPos + value.length;\n\t\tinputElement.selectionEnd = startPos + value.length;\n\t}\n\telse\n\t{\n\t\tinputElement.value += value;\n\t}\n}","import {UiState, PhoneCallView, desktopEvents} from \"../view\";\n\n\nexport const callCardEvents = {\n\taddCommentButtonClick: 'addCommentButtonClick',\n\tmuteButtonClick: 'muteButtonClick',\n\tholdButtonClick: 'holdButtonClick',\n\ttransferButtonClick: 'transferButtonClick',\n\tcancelTransferButtonClick: 'cancelTransferButtonClick',\n\tcompleteTransferButtonClick: 'completeTransferButtonClick',\n\thangupButtonClick: 'hangupButtonClick',\n\tnextButtonClick: 'nextButtonClick',\n\tskipButtonClick: 'skipButtonClick',\n\tanswerButtonClick: 'answerButtonClick',\n\tentityChanged: 'entityChanged',\n\tqualityMeterClick: 'qualityMeterClick',\n\tdialpadButtonClick: 'dialpadButtonClick',\n\tmakeCallButtonClick: 'makeCallButtonClick',\n\tnotifyAdminButtonClick: 'notifyAdminButtonClick',\n\tcloseButtonClick: 'closeButtonClick',\n};\n\nconst UndefinedCallCard = {\n\tresult: 'error',\n\terrorCode: 'Call card is undefined'\n}\n\n/** @abstract */\nexport class BaseWorker\n{\n\n\tisExternalCall: boolean = false;\n\tused: boolean = false;\n\tCallCard: ?PhoneCallView;\n\n\n\n\t/** @abstract */\n\tinitializePlacement(): BaseWorker\n\t{\n\t\tthrow new Error('You have to implement the method initializePlacement!');\n\t}\n\n\t/** @abstract */\n\tinitializeInterface(placement: Object): BaseWorker\n\t{\n\t\tthrow new Error('You have to implement the method initializeInterface!');\n\t}\n\n\t/** @abstract */\n\temitInitializeEvent(params)\n\t{\n\t\tthrow new Error('You have to implement the method emitInitializeEvent!');\n\t}\n\n\t/** @abstract */\n\temitEvent(name: string, params)\n\t{\n\t\tthrow new Error('You have to implement the method emitEvent!');\n\t};\n\n\tsetCallCard(callCard: ?PhoneCallView): BaseWorker\n\t{\n\t\tthis.CallCard = callCard;\n\n\t\treturn this;\n\t}\n\n\tsetIsExternalCall(isExternalCall: boolean): BaseWorker\n\t{\n\t\tthis.isExternalCall = isExternalCall;\n\n\t\treturn this;\n\t}\n\n\tisCardActive(): boolean\n\t{\n\t\treturn this.CallCard instanceof PhoneCallView;\n\t}\n\n\tisUsed(): boolean\n\t{\n\t\treturn this.used;\n\t}\n\n\tinitializeInterfaceEvents(placement: Object): BaseWorker\n\t{\n\t\tplacement.prototype.events.push('BackgroundCallCard::initialized');\n\t\tplacement.prototype.events.push('BackgroundCallCard::addCommentButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::muteButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::holdButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::closeButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::transferButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::cancelTransferButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::completeTransferButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::hangupButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::nextButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::skipButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::answerButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::entityChanged');\n\t\tplacement.prototype.events.push('BackgroundCallCard::qualityMeterClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::dialpadButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::makeCallButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::notifyAdminButtonClick');\n\n\t\treturn this;\n\t}\n\n\tgetEvents()\n\t{\n\t\treturn callCardEvents;\n\t}\n\n\tgetListUiStates(params: {}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tcallback(Object.keys(UiState).filter((state) =>\n\t\t{\n\t\t\tswitch (state)\n\t\t\t{\n\t\t\t\tcase 'sipPhoneError':\n\t\t\t\t\treturn false;\n\t\t\t\tcase 'idle':\n\t\t\t\t\treturn false;\n\t\t\t\tcase 'externalCard':\n\t\t\t\t\treturn false;\n\t\t\t\tdefault:\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t}));\n\t}\n\n\tsetUiState(params: {uiState: string, disableAutoStartTimer: ?boolean}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (params && params.uiState && UiState[params.uiState])\n\t\t{\n\t\t\tthis.CallCard.setUiState(UiState[params.uiState]);\n\t\t\t// BX.onCustomEvent(window, \"CallCard::CallStateChanged\", [callState, additionalParams]);\n\t\t\t// this.setOnSlave(desktopEvents.setCallState, [callState, additionalParams]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'Invalid ui state'\n\t\t\t}]);\n\n\t\t\treturn;\n\t\t}\n\t\tif (params.uiState === 'connected')\n\t\t{\n\t\t\tif (params.disableAutoStartTimer)\n\t\t\t{\n\t\t\t\tthis.CallCard.stopTimer();\n\t\t\t\tthis.hideTimer();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showTimer();\n\t\t\t}\n\t\t}\n\n\t\tif (params.uiState !== 'connected' && !this.CallCard.isTimerStarted())\n\t\t{\n\t\t\tthis.hideTimer();\n\t\t}\n\n\t\tcallback([]);\n\t}\n\n\tsetMute(params: {muted: boolean}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.CallCard.isMuted() === !!params.muted)\n\t\t{\n\t\t\tcallback([]);\n\n\t\t\treturn;\n\t\t}\n\t\tif (params.muted)\n\t\t{\n\t\t\tthis.CallCard.setMuted(params.muted)\n\t\t\tBX.addClass(this.CallCard.elements.buttons.mute, 'active');\n\t\t\tif (this.CallCard.isDesktop() && this.CallCard.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onMute, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.CallCard.callbacks.mute();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.CallCard.setMuted(params.muted)\n\t\t\tBX.removeClass(this.CallCard.elements.buttons.mute, 'active');\n\t\t\tif (this.CallCard.isDesktop() && this.CallCard.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onUnMute, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.CallCard.callbacks.unmute();\n\t\t\t}\n\t\t}\n\t\tcallback([]);\n\t}\n\n\tsetHold(params: {held: boolean}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.CallCard.isHeld() === !!params.held)\n\t\t{\n\t\t\tcallback([]);\n\n\t\t\treturn;\n\t\t}\n\t\tif (params.held)\n\t\t{\n\t\t\tthis.CallCard.setHeld(params.held)\n\t\t\tBX.addClass(this.CallCard.elements.buttons.hold, 'active');\n\t\t\tif (this.CallCard.isDesktop() && this.CallCard.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onHold, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.CallCard.callbacks.hold();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.CallCard.setHeld(params.held);\n\t\t\tBX.removeClass(this.CallCard.elements.buttons.hold, 'active');\n\t\t\tif (this.CallCard.isDesktop() && this.CallCard.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onUnHold, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.CallCard.callbacks.unhold();\n\t\t\t}\n\t\t}\n\t\tcallback([]);\n\t}\n\n\tstartTimer(params: {}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showTimer();\n\t\tthis.CallCard.startTimer();\n\t}\n\n\tstopTimer(params: {}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.CallCard.stopTimer();\n\t}\n\n\tclose(params: {}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.CallCard.close();\n\t\tcallback([]);\n\n\t\tthis.CallCard = false;\n\t}\n\n\tsetCardTitle(params: {title: string}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\t\tthis.CallCard.setTitle(params.title);\n\t\tcallback([]);\n\t}\n\n\tsetStatusText(params: {statusText: string}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\t\tthis.CallCard.setStatusText(params.statusText);\n\t\tcallback([]);\n\t}\n\n\tshowTimer(): void\n\t{\n\t\tif (!this.CallCard.elements.timer.visible)\n\t\t{\n\t\t\tthis.CallCard.sections.timer.visible = true;\n\t\t\tthis.CallCard.elements.timer.style.display = '';\n\t\t\tif(this.CallCard.isFolded())\n\t\t\t{\n\t\t\t\tthis.CallCard.unfoldedElements.timer.style.display = '';\n\t\t\t}\n\t\t}\n\t}\n\n\thideTimer(): void\n\t{\n\t\tif (this.CallCard.sections.timer)\n\t\t{\n\t\t\tthis.CallCard.sections.timer.visible = false;\n\t\t}\n\t\tif (this.CallCard.elements.timer)\n\t\t{\n\t\t\tthis.CallCard.elements.timer.style.display = 'none';\n\t\t}\n\t\tthis.CallCard.initialTimestamp = 0;\n\t}\n\n\tgetUndefinedCallCardError()\n\t{\n\t\treturn UndefinedCallCard;\n\t}\n}","import {BaseWorker} from \"./base-worker\";\nimport {UiState} from \"../view\";\n\nconst desktopMethodEvents = {\n\tsetUiState: 'DesktopCallCardSetUiState',\n\tsetMute: 'DesktopCallCardSetMute',\n\tsetHold: 'DesktopCallCardSetHold',\n\tgetListUiState: 'DesktopCallCardGetListUiState',\n\tsetCardTitle: 'DesktopCallCardSetCardTitle',\n\tsetStatusText: 'DesktopCallCardSetStatusText',\n\tclose: 'DesktopCallCardClose',\n\tstartTimer: 'DesktopCallCardStartTimer',\n\tstopTimer: 'DesktopCallCardStopTimer',\n};\n\nconst corporatePortalPageEvents = {\n\taddCommentButtonClick: 'DesktopCallCardAddCommentButtonClick',\n\tmuteButtonClick: 'DesktopCallCardMuteButtonClick',\n\tholdButtonClick: 'DesktopCallCardHoldButtonClick',\n\ttransferButtonClick: 'DesktopCallCardTransferButtonClick',\n\tcancelTransferButtonClick: 'DesktopCallCardCancelTransferButtonClick',\n\tcompleteTransferButtonClick: 'DesktopCallCardCompleteTransferButtonClick',\n\thangupButtonClick: 'DesktopCallCardHangupButtonClick',\n\tnextButtonClick: 'DesktopCallCardNextButtonClick',\n\tskipButtonClick: 'DesktopCallCardSkipButtonClick',\n\tanswerButtonClick: 'DesktopCallCardAnswerButtonClick',\n\tentityChanged: 'DesktopCallCardEntityChanged',\n\tqualityMeterClick: 'DesktopCallCardQualityMeterClick',\n\tdialpadButtonClick: 'DesktopCallCardDialpadButtonClick',\n\tmakeCallButtonClick: 'DesktopCallCardMakeCallButtonClick',\n\tnotifyAdminButtonClick: 'DesktopCallCardNotifyAdminButtonClick',\n};\n\nexport class DesktopWorker extends BaseWorker\n{\n\n\teventHandlers: Array;\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.eventHandlers = [];\n\t}\n\n\tisCardActive(): boolean\n\t{\n\t\treturn super.isCardActive() || this.CallCard !== null;\n\t}\n\n\tinitializePlacement()\n\t{\n\t\tconst placement = BX.rest.AppLayout.initializePlacement('PAGE_BACKGROUND_WORKER');\n\n\t\tthis.initializeInterfaceMethods(placement);\n\t\tthis.initializeInterfaceEvents(placement);\n\t\tthis.addEventHandlersForEventsFromCallCard();\n\t}\n\n\tinitializeInterface(placement)\n\t{\n\n\t\tthis.initializeInterfaceMethods(placement);\n\t\tthis.addTransmitEventHandlers();\n\n\t}\n\tinitializeInterfaceMethods(placement)\n\t{\n\t\tplacement.prototype.CallCardGetListUiStates = (params, callback) => this.getListUiStates(params, callback);\n\n\t\tplacement.prototype.CallCardSetMute = (params, callback) => this.transmitSetMute(params, callback);\n\t\tplacement.prototype.CallCardSetHold = (params, callback) => this.transmitSetHold(params, callback);\n\t\tplacement.prototype.CallCardSetUiState = (params, callback) => this.transmitSetUiState(params, callback);\n\t\tplacement.prototype.CallCardSetCardTitle = (params, callback) => this.transmitSetCardTitle(params, callback);\n\t\tplacement.prototype.CallCardSetStatusText = (params, callback) => this.transmitSetStatusText(params, callback);\n\t\tplacement.prototype.CallCardClose = (params, callback) => this.transmitClose(params, callback);\n\t\tplacement.prototype.CallCardStartTimer = (params, callback) => this.transmitStartTimer(params, callback);\n\t\tplacement.prototype.CallCardStopTimer = (params, callback) => this.transmitStopTimer(params, callback);\n\t}\n\n\temitInitializeEvent(params)\n\t{\n\t\tif (!this.isExternalCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isCallCardPage())\n\t\t{\n\t\t\tBXDesktopSystem.BroadcastEvent('DesktopCallCardInitialized', [params]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tBX.onCustomEvent(window, \"BackgroundCallCard::initialized\", [params]);\n\t}\n\n\temitEvent(name: string, params)\n\t{\n\t\tif (!this.isExternalCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isCallCardPage())\n\t\t{\n\t\t\tconst desktopEventName = 'DesktopCallCard' + (name[0].toUpperCase() + name.slice(1));\n\t\t\tBXDesktopSystem.BroadcastEvent(desktopEventName, [params]);\n\t\t}\n\n\t\tBX.onCustomEvent(window, 'BackgroundCallCard::' + name, [params]);\n\t}\n\n\tremoveDesktopEventHandlers()\n\t{\n\t\tfor (const event in this.getEvents())\n\t\t{\n\t\t\tthis.removeCustomEvents('DesktopCallCard' + (event[0].toUpperCase() + event.slice(1)));\n\t\t}\n\t\tthis.removeCustomEvents('DesktopCallCardInitialized');\n\t\tthis.removeCustomEvents('DesktopCallCardCloseButtonClick');\n\t}\n\t/*\n\t Transmit an event about changing the call card by calling methods\n\t from the rest application from the corporate portal window\n\t */\n\t//region Transmit events\n\n\taddTransmitEventHandlers()\n\t{\n\t\tthis\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.getListUiState,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getListUiStates)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setUiState,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setUiState)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setMute,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setMute)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setHold,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setHold)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setCardTitle,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setCardTitle)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setStatusText,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setStatusText)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.close,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().close)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.startTimer,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().startTimer)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.stopTimer,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().stopTimer)\n\t\t\t);\n\t}\n\n\tonTransmitHandler(params: any, callback: Function, handler: Function)\n\t{\n\t\tif (this.isCorporatePortalPage())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.used = true;\n\t\tcallback = typeof (callback) === 'function' ? callback : BX.DoNothing;\n\n\t\thandler(params, callback);\n\t}\n\n\ttransmitSetUiState(params: {uiState: string, disableAutoStartTimer?: boolean}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\t\tif (!params.hasOwnProperty('uiState') || !UiState[params.uiState])\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'Invalid ui state'\n\t\t\t}]);\n\n\t\t\treturn;\n\t\t}\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setUiState, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitSetMute(params: {muted: boolean}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\t\tif (!params.hasOwnProperty('muted'))\n\t\t{\n\t\t\tcallback({\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'missing field muted'\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setMute, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitSetHold(params: {held: boolean}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!params.hasOwnProperty('held'))\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'missing field held'\n\t\t\t}]);\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setHold, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitStartTimer(params: {}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.startTimer, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitStopTimer(params: {}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.stopTimer, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitClose(params: {}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.CallCard = null;\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.close, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitSetCardTitle(params: {title: string}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\t\tif (!params.hasOwnProperty('title'))\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'missing field title'\n\t\t\t}]);\n\n\t\t\treturn\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setCardTitle, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitSetStatusText(params: {statusText: string}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\t\tif (!params.hasOwnProperty('statusText'))\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'missing field statusText'\n\t\t\t}]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setStatusText, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\t//endregion\n\n\taddEventHandlersForEventsFromCallCard()\n\t{\n\t\tif (!this.isCorporatePortalPage())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tfor (const event in this.getEvents())\n\t\t{\n\t\t\tthis.addCustomEvent(corporatePortalPageEvents[event], (params, callback) =>\n\t\t\t{\n\t\t\t\tBX.onCustomEvent(window, 'BackgroundCallCard::' + event, [params, callback]);\n\t\t\t})\n\t\t}\n\n\t\tthis.addCustomEvent('DesktopCallCardInitialized', (params, callback) =>\n\t\t{\n\t\t\tif (!this.CallCard)\n\t\t\t{\n\t\t\t\tthis.CallCard = true;\n\t\t\t}\n\t\t\tBX.onCustomEvent(window, 'BackgroundCallCard::initialized', [params, callback]);\n\t\t});\n\n\t\tthis.addCustomEvent('DesktopCallCardCloseButtonClick', (params, callback) =>\n\t\t{\n\t\t\tthis.CallCard = null;\n\t\t\tBX.onCustomEvent(window, 'BackgroundCallCard::closeButtonClick', [params, callback]);\n\t\t});\n\t}\n\taddCustomEvent(eventName: string, eventHandler: Function)\n\t{\n\t\tconst realHandler = function (e)\n\t\t{\n\t\t\tconst arEventParams = [];\n\t\t\tfor (const i in e.detail)\n\t\t\t{\n\t\t\t\tarEventParams.push(e.detail[i]);\n\t\t\t}\n\n\t\t\teventHandler.apply(window, arEventParams);\n\t\t};\n\n\t\tif (!this.eventHandlers[eventName])\n\t\t{\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\t}\n\n\t\tthis.eventHandlers[eventName].push(realHandler);\n\t\twindow.addEventListener(eventName, realHandler);\n\n\t\treturn this;\n\t}\n\n\tremoveCustomEvents(eventName)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.eventHandlers[eventName].forEach(eventHandler => window.removeEventListener(eventName, eventHandler));\n\t\tthis.eventHandlers[eventName] = [];\n\t}\n\n\tisCallCardPage(): boolean\n\t{\n\t\treturn BXDesktopWindow.GetWindowId() !== BXDesktopSystem.GetMainWindow().GetWindowId()\n\t}\n\n\tisCorporatePortalPage(): boolean\n\t{\n\t\treturn typeof(BXDesktopSystem) == \"undefined\" && typeof(BXDesktopWindow) == \"undefined\";\n\t}\n\n\tgetCallCardWindow(): window\n\t{\n\t\treturn BXWindows.find(element => element.name === 'callWindow');\n\t}\n\n\tgetCallCardPlatformWorker(): BaseWorker\n\t{\n\t\tconst callWindow = this.getCallCardWindow();\n\n\t\treturn callWindow.PCW.backgroundWorker.platformWorker;\n\t}\n}","import {BaseWorker} from \"./base-worker\";\n\n\nexport class BrowserWorker extends BaseWorker\n{\n\n\tinitializePlacement()\n\t{\n\t\tconst placement = BX.rest.AppLayout.initializePlacement('PAGE_BACKGROUND_WORKER');\n\n\t\tthis.initializeInterface(placement);\n\t\tthis.initializeInterfaceEvents(placement)\n\t}\n\n\tinitializeInterface(placement)\n\t{\n\t\tplacement.prototype.CallCardSetMute = (params, callback) => this.setMute(params, callback);\n\t\tplacement.prototype.CallCardSetHold = (params, callback) => this.setHold(params, callback);\n\t\tplacement.prototype.CallCardSetUiState = (params, callback) => this.setUiState(params, callback);\n\t\tplacement.prototype.CallCardGetListUiStates = (params, callback) => this.getListUiStates(params, callback);\n\t\tplacement.prototype.CallCardSetCardTitle = (params, callback) => this.setCardTitle(params, callback);\n\t\tplacement.prototype.CallCardSetStatusText = (params, callback) => this.setStatusText(params, callback);\n\t\tplacement.prototype.CallCardClose = (params, callback) => this.close(params, callback);\n\t\tplacement.prototype.CallCardStartTimer = (params, callback) => this.startTimer(params, callback);\n\t\tplacement.prototype.CallCardStopTimer = (params, callback) => this.stopTimer(params, callback);\n\t}\n\temitEvent(name: string, params)\n\t{\n\t\tif (!this.isExternalCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.onCustomEvent(window, 'BackgroundCallCard::' + name, [params]);\n\t}\n\n\temitInitializeEvent(params)\n\t{\n\t\tif (!this.isExternalCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.onCustomEvent(window, \"BackgroundCallCard::initialized\", [params]);\n\t}\n}","import {PhoneCallView} from './view'\nimport {BaseWorker, callCardEvents} from \"./background-worker/base-worker\";\nimport {DesktopWorker} from \"./background-worker/desktop-worker\";\nimport {BrowserWorker} from \"./background-worker/browser-worker\";\n\nexport const backgroundWorkerEvents = callCardEvents;\n\nexport class BackgroundWorker\n{\n\tplatformWorker: BaseWorker;\n\n\tconstructor()\n\t{\n\t\tthis.initializePlacement();\n\t}\n\n\tsetCallCard(callCard: ?PhoneCallView)\n\t{\n\t\tthis.platformWorker.CallCard = callCard;\n\t}\n\n\tinitializePlacement()\n\t{\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\tthis.platformWorker = new DesktopWorker();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.platformWorker = new BrowserWorker();\n\t\t}\n\n\t\tthis.platformWorker.initializePlacement();\n\t}\n\n\temitEvent(name: string, params)\n\t{\n\t\tthis.platformWorker.emitEvent(name, params);\n\t}\n\n\tremoveDesktopEventHandlers()\n\t{\n\t\tthis.platformWorker.removeDesktopEventHandlers();\n\t}\n\tisDesktop()\n\t{\n\t\treturn typeof (BXDesktopSystem) !== 'undefined';\n\t}\n\n\tisUsed()\n\t{\n\t\treturn this.platformWorker.isUsed();\n\t}\n\n\tisActiveIntoCurrentCall()\n\t{\n\t\treturn this.isExternalCall && this.isUsed();\n\t}\n\n\tsetExternalCall(isExternalCall: boolean)\n\t{\n\t\tthis.platformWorker.setIsExternalCall(isExternalCall);\n\t}\n}\n","import {Type} from 'main.core';\n\nconst nop = function(){}\n\nexport class FormManager\n{\n\tconstructor(params)\n\t{\n\t\tthis.node = params.node;\n\t\tthis.currentForm = null;\n\t\tthis.callbacks = {\n\t\t\tonFormLoad: Type.isFunction(params.onFormLoad) ? params.onFormLoad : nop,\n\t\t\tonFormUnLoad: Type.isFunction(params.onFormUnLoad) ? params.onFormUnLoad : nop,\n\t\t\tonFormSend: Type.isFunction(params.onFormSend) ? params.onFormSend : nop\n\t\t}\n\t}\n\n\t/**\n\t * @param {object} params\n\t * @param {int} params.id\n\t * @param {string} params.secCode\n\t */\n\tload(params)\n\t{\n\t\tlet formData = this.getFormData(params);\n\t\twindow.Bitrix24FormLoader.load(formData);\n\t\tthis.currentForm = formData;\n\t};\n\n\tunload()\n\t{\n\t\tif (this.currentForm)\n\t\t{\n\t\t\twindow.Bitrix24FormLoader.unload(this.currentForm);\n\t\t\tthis.currentForm = null;\n\t\t}\n\t};\n\n\t/**\n\t * @param {object} params\n\t * @param {int} params.id\n\t * @param {string} params.secCode\n\t * @returns {object}\n\t */\n\tgetFormData(params)\n\t{\n\t\treturn {\n\t\t\tid: params.id,\n\t\t\tsec: params.secCode,\n\t\t\ttype: 'inline',\n\t\t\tlang: 'ru',\n\t\t\tref: window.location.href,\n\t\t\tnode: this.node,\n\t\t\thandlers:\n\t\t\t\t{\n\t\t\t\t\t'load': this._onFormLoad.bind(this),\n\t\t\t\t\t'unload': this._onFormUnLoad.bind(this),\n\t\t\t\t\t'send': this.onFormSend.bind(this)\n\t\t\t\t},\n\t\t\toptions:\n\t\t\t\t{\n\t\t\t\t\t'borders': false,\n\t\t\t\t\t'logo': false\n\t\t\t\t}\n\t\t}\n\t};\n\n\t_onFormLoad(form)\n\t{\n\t\tthis.callbacks.onFormLoad(form);\n\t}\n\n\t_onFormUnLoad(form)\n\t{\n\t\tthis.callbacks.onFormUnLoad(form);\n\t}\n\n\tonFormSend(form)\n\t{\n\t\tthis.callbacks.onFormSend(form);\n\t}\n}","import {Dom, Type, Text, Loc} from 'main.core';\nimport {Menu} from 'main.popup'\nimport {baseZIndex, nop} from './common'\n\nexport class CallList\n{\n\tconstructor(params)\n\t{\n\t\tthis.node = params.node;\n\t\tthis.id = params.id;\n\t\tthis.isDesktop = params.isDesktop;\n\n\t\tthis.entityType = '';\n\t\tthis.statuses = new Map(); // {STATUS_ID (string): { STATUS_NAME; string, CLASS: string, ITEMS: []}\n\t\tthis.elements = {};\n\t\tthis.currentStatusId = params.callListStatusId || 'IN_WORK';\n\t\tthis.currentItemIndex = params.itemIndex || 0;\n\t\tthis.callingStatusId = null;\n\t\tthis.callingItemIndex = null;\n\t\tthis.selectionLocked = false;\n\n\t\t// this.itemActionMenu = null;\n\t\tthis.callbacks = {\n\t\t\tonError: Type.isFunction(params.onError) ? params.onError : nop,\n\t\t\tonSelectedItem: Type.isFunction(params.onSelectedItem) ? params.onSelectedItem : nop\n\t\t};\n\n\t\tthis.showLimit = 10;\n\t\tthis.showDelta = 10;\n\t}\n\n\tinit(next)\n\t{\n\t\tif (!Type.isFunction(next))\n\t\t{\n\t\t\tnext = nop;\n\t\t}\n\n\t\tthis.load(() =>\n\t\t{\n\t\t\tconst currentStatus = this.statuses.get(this.currentStatusId)\n\t\t\tif (currentStatus && currentStatus.ITEMS.length > 0)\n\t\t\t{\n\t\t\t\tthis.update();\n\t\t\t\tthis.selectItem(this.currentStatusId, this.currentItemIndex);\n\t\t\t\tnext();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.debug('empty call list. don\\'t know what to do');\n\t\t\t}\n\t\t})\n\t};\n\n\t/**\n\t * @param {object} params\n\t * @param {Node} params.node DOM node to render call list.\n\t */\n\treinit(params)\n\t{\n\t\tif (Type.isDomNode(params.node))\n\t\t{\n\t\t\tthis.node = params.node;\n\t\t}\n\n\t\tthis.update();\n\t\tthis.selectItem(this.currentStatusId, this.currentItemIndex);\n\t\tif (this.callingStatusId !== null && this.callingItemIndex !== null)\n\t\t{\n\t\t\tthis.setCallingElement(this.callingStatusId, this.callingItemIndex);\n\t\t}\n\n\t};\n\n\tload(next)\n\t{\n\t\tconst params = {\n\t\t\t'sessid': BX.bitrix_sessid(),\n\t\t\t'ajax_action': 'GET_CALL_LIST',\n\t\t\t'callListId': this.id\n\t\t};\n\n\t\tBX.ajax({\n\t\t\turl: CallList.getAjaxUrl(),\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\tdata: params,\n\t\t\tonsuccess: (data) =>\n\t\t\t{\n\t\t\t\tif (!data.ERROR)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isArray(data.STATUSES))\n\t\t\t\t\t{\n\t\t\t\t\t\t//this.statuses = data.STATUSES;\n\t\t\t\t\t\tdata.STATUSES.forEach((statusRecord) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstatusRecord.ITEMS = [];\n\t\t\t\t\t\t\tthis.statuses.set(statusRecord.STATUS_ID, statusRecord);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tdata.ITEMS.forEach((item) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet itemStatus = this.statuses.get(item.STATUS_ID);\n\t\t\t\t\t\t\tif (itemStatus)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titemStatus.ITEMS.push(item);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.entityType = data.ENTITY_TYPE;\n\t\t\t\t\tlet currentStatus = this.statuses.get(this.currentStatusId);\n\t\t\t\t\tif (currentStatus && currentStatus.ITEMS.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentStatusId = this.getNonEmptyStatusId();\n\t\t\t\t\t\tthis.currentItemIndex = 0;\n\t\t\t\t\t}\n\t\t\t\t\tnext();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.log(data);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\tselectItem(statusId, newIndex)\n\t{\n\t\tlet currentNode = this.statuses.get(this.currentStatusId).ITEMS[this.currentItemIndex]._node;\n\t\tBX.removeClass(currentNode, 'im-phone-call-list-customer-block-active');\n\n\t\tif (this.itemActionMenu)\n\t\t{\n\t\t\tthis.itemActionMenu.close();\n\t\t}\n\n\t\tthis.currentStatusId = statusId;\n\t\tthis.currentItemIndex = newIndex;\n\n\t\tcurrentNode = this.statuses.get(this.currentStatusId).ITEMS[this.currentItemIndex]._node;\n\t\tBX.addClass(currentNode, 'im-phone-call-list-customer-block-active');\n\n\t\tconst newEntity = this.statuses.get(statusId).ITEMS[newIndex];\n\n\t\tif ((this.entityType == 'DEAL' || this.entityType == 'QUOTE' || this.entityType == 'INVOICE') && newEntity.ASSOCIATED_ENTITY)\n\t\t{\n\t\t\tthis.callbacks.onSelectedItem({\n\t\t\t\ttype: newEntity.ASSOCIATED_ENTITY.TYPE,\n\t\t\t\tid: newEntity.ASSOCIATED_ENTITY.ID,\n\t\t\t\tbindings: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: this.entityType,\n\t\t\t\t\t\tid: newEntity.ELEMENT_ID\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tphones: newEntity.ASSOCIATED_ENTITY.PHONES,\n\t\t\t\tstatusId: statusId,\n\t\t\t\tindex: newIndex\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.onSelectedItem({\n\t\t\t\ttype: this.entityType,\n\t\t\t\tid: newEntity.ELEMENT_ID,\n\t\t\t\tphones: newEntity.PHONES,\n\t\t\t\tstatusId: statusId,\n\t\t\t\tindex: newIndex\n\t\t\t});\n\t\t}\n\t};\n\n\tmoveToNextItem()\n\t{\n\t\tvar newIndex = this.currentItemIndex + 1;\n\t\tif (newIndex >= this.statuses.get(this.currentStatusId).ITEMS.length)\n\t\t{\n\t\t\tnewIndex = 0;\n\t\t}\n\n\t\tthis.selectItem(this.currentStatusId, newIndex);\n\t};\n\n\tsetCallingElement(statusId, index)\n\t{\n\t\tthis.callingStatusId = statusId;\n\t\tthis.callingItemIndex = index;\n\t\tconst currentNode = this.statuses.get(this.callingStatusId).ITEMS[this.callingItemIndex]._node;\n\t\tBX.addClass(currentNode, 'im-phone-call-list-customer-block-calling');\n\t\tthis.selectionLocked = true;\n\t};\n\n\tresetCallingElement()\n\t{\n\t\tif (this.callingStatusId === null || this.callingItemIndex === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentNode = this.statuses.get(this.callingStatusId).ITEMS[this.callingItemIndex]._node;\n\t\tBX.removeClass(currentNode, 'im-phone-call-list-customer-block-calling');\n\t\tthis.callingStatusId = null;\n\t\tthis.callingItemIndex = null;\n\t\tthis.selectionLocked = false;\n\t};\n\n\tupdate()\n\t{\n\t\tDom.clean(this.node)\n\t\tthis.node.append(this.render())\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-list-container'},\n\t\t\tchildren: this.renderStatusBlocks()\n\t\t});\n\t};\n\n\trenderStatusBlocks(): HTMLElement[]\n\t{\n\t\tlet result = [];\n\n\t\tfor (let [statusId, status] of this.statuses)\n\t\t{\n\t\t\tif (!status || status.ITEMS.length === 0)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tstatus._node = this.renderStatusBlock(status);\n\t\t\tresult.push(status._node);\n\t\t}\n\t\treturn result;\n\t};\n\n\trenderCallListItems(statusId): HTMLElement[]\n\t{\n\t\tlet result = [];\n\t\tconst status = this.statuses.get(statusId);\n\n\t\tif (status._shownCount > 0)\n\t\t{\n\t\t\tif (status._shownCount > status.ITEMS.length)\n\t\t\t{\n\t\t\t\tstatus._shownCount = status.ITEMS.length;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstatus._shownCount = Math.min(this.showLimit, status.ITEMS.length);\n\t\t}\n\n\t\tfor (let i = 0; i < status._shownCount; i++)\n\t\t{\n\t\t\tresult.push(this.renderCallListItem(status.ITEMS[i], statusId, i));\n\t\t}\n\n\t\tif (status.ITEMS.length > status._shownCount)\n\t\t{\n\t\t\tstatus._showMoreNode = Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-call-list-show-more-wrap'}, children: [\n\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-call-list-show-more-button'},\n\t\t\t\t\t\tdataset: {statusId: statusId},\n\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_LIST_MORE').replace('#COUNT#', (status.ITEMS.length - status._shownCount)),\n\t\t\t\t\t\tevents: {click: this.onShowMoreClick.bind(this)}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t});\n\t\t\tresult.push(status._showMoreNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstatus._showMoreNode = null;\n\t\t}\n\n\t\treturn result;\n\t};\n\n\trenderCallListItem(itemDescriptor, statusId, itemIndex)\n\t{\n\t\tconst statusName = this.statuses.get(statusId).NAME;\n\n\t\tlet phonesText = '';\n\t\tif (Type.isArray(itemDescriptor.PHONES))\n\t\t{\n\t\t\titemDescriptor.PHONES.forEach((phone, index) =>\n\t\t\t{\n\t\t\t\tif (index !== 0)\n\t\t\t\t{\n\t\t\t\t\tphonesText += '; ';\n\t\t\t\t}\n\n\t\t\t\tphonesText += Text.encode(phone.VALUE);\n\t\t\t})\n\t\t}\n\n\t\titemDescriptor._node = Dom.create(\"div\", {\n\t\t\tprops: {className: (this.currentStatusId == statusId && this.currentItemIndex == itemIndex ? 'im-phone-call-list-customer-block im-phone-call-list-customer-block-active' : 'im-phone-call-list-customer-block')},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-customer-block-action'},\n\t\t\t\t\tchildren: [Dom.create(\"span\", {text: statusName})],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tif (this.itemActionMenu)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.itemActionMenu.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.showItemMenu(itemDescriptor, e.target);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-name' + (itemDescriptor.ASSOCIATED_ENTITY ? ' im-phone-call-list-connection-line' : '')},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"a\", {\n\t\t\t\t\t\t\tattrs: {href: itemDescriptor.EDIT_URL, target: '_blank'},\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-link'},\n\t\t\t\t\t\t\ttext: itemDescriptor.NAME,\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: (e) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\twindow.open(itemDescriptor.EDIT_URL);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\n\t\t\t\t(itemDescriptor.POST ? Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: itemDescriptor.POST\n\t\t\t\t}) : null),\n\t\t\t\t(itemDescriptor.COMPANY_TITLE ? Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: itemDescriptor.COMPANY_TITLE\n\t\t\t\t}) : null),\n\t\t\t\t(phonesText ? Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: phonesText\n\t\t\t\t}) : null),\n\t\t\t\t(itemDescriptor.ASSOCIATED_ENTITY ? this.renderAssociatedEntity(itemDescriptor.ASSOCIATED_ENTITY) : null)\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: () =>\n\t\t\t\t{\n\t\t\t\t\tif (!this.selectionLocked && (this.currentStatusId != itemDescriptor.STATUS_ID || this.currentItemIndex != itemIndex))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selectItem(itemDescriptor.STATUS_ID, itemIndex);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn itemDescriptor._node;\n\t};\n\n\trenderAssociatedEntity(associatedEntity)\n\t{\n\t\tlet phonesText = '';\n\t\tif (Type.isArray(associatedEntity.PHONES))\n\t\t{\n\t\t\tassociatedEntity.PHONES.forEach((phone, index) =>\n\t\t\t{\n\t\t\t\tif (index !== 0)\n\t\t\t\t{\n\t\t\t\t\tphonesText += '; ';\n\t\t\t\t}\n\n\t\t\t\tphonesText += Text.encode(phone.VALUE);\n\t\t\t})\n\t\t}\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-list-item-customer-entity im-phone-call-list-connection-line-item'},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"a\", {\n\t\t\t\t\tattrs: {href: associatedEntity.EDIT_URL, target: '_blank'},\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-link'},\n\t\t\t\t\ttext: associatedEntity.NAME,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\twindow.open(associatedEntity.EDIT_URL);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: associatedEntity.POST\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: associatedEntity.COMPANY_TITLE\n\t\t\t\t}),\n\t\t\t\t(phonesText ? Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: phonesText\n\t\t\t\t}) : null)\n\t\t\t]\n\t\t});\n\t};\n\n\tonShowMoreClick(e)\n\t{\n\t\tvar statusId = e.target.dataset.statusId;\n\t\tvar status = this.statuses.get(statusId);\n\n\t\tstatus._shownCount += this.showDelta;\n\t\tif (status._shownCount > status.ITEMS.length)\n\t\t{\n\t\t\tstatus._shownCount = status.ITEMS.length;\n\t\t}\n\n\t\tconst newStatusNode = this.renderStatusBlock(status);\n\t\tstatus._node.parentNode.replaceChild(newStatusNode, status._node);\n\t\tstatus._node = newStatusNode;\n\t};\n\n\tshowItemMenu(callListItem, node)\n\t{\n\t\tlet menuItems = [];\n\t\tlet menuItem;\n\t\tfor (let [statusId, status] of this.statuses)\n\t\t{\n\t\t\tmenuItem = {\n\t\t\t\tid: \"setStatus_\" + statusId,\n\t\t\t\ttext: status.NAME,\n\t\t\t\tonclick: this.actionMenuItemClickHandler(callListItem.ELEMENT_ID, statusId).bind(this)\n\t\t\t};\n\t\t\tmenuItems.push(menuItem);\n\t\t}\n\t\tmenuItems.push({\n\t\t\tid: 'callListItemActionMenu_delimiter',\n\t\t\tdelimiter: true\n\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: \"defer15min\",\n\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_CALL_LIST_DEFER_15_MIN'),\n\t\t\tonclick: () =>\n\t\t\t{\n\t\t\t\tthis.itemActionMenu.close();\n\t\t\t\tthis.setElementRank(callListItem.ELEMENT_ID, callListItem.RANK + 35);\n\t\t\t}\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: \"defer1hour\",\n\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_CALL_LIST_DEFER_HOUR'),\n\t\t\tonclick: () =>\n\t\t\t{\n\t\t\t\tthis.itemActionMenu.close();\n\t\t\t\tthis.setElementRank(callListItem.ELEMENT_ID, callListItem.RANK + 185);\n\t\t\t}\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: \"moveToEnd\",\n\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_CALL_LIST_TO_END'),\n\t\t\tonclick: () =>\n\t\t\t{\n\t\t\t\tthis.itemActionMenu.close();\n\t\t\t\tthis.setElementRank(callListItem.ELEMENT_ID, callListItem.RANK + 5100);\n\t\t\t}\n\t\t});\n\n\t\tthis.itemActionMenu = new Menu(\n\t\t\t'callListItemActionMenu',\n\t\t\tnode,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tangle: {position: \"top\"},\n\t\t\t\tzIndex: baseZIndex + 200,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.itemActionMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.itemActionMenu = null\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.itemActionMenu.show();\n\t};\n\n\tactionMenuItemClickHandler(elementId, statusId)\n\t{\n\t\treturn () =>\n\t\t{\n\t\t\tthis.itemActionMenu.close();\n\t\t\tthis.setElementStatus(elementId, statusId);\n\t\t}\n\t};\n\n\tsetElementRank(elementId, rank)\n\t{\n\t\tthis.executeItemAction({\n\t\t\taction: 'SET_ELEMENT_RANK',\n\t\t\tparameters: {\n\t\t\t\tcallListId: this.id,\n\t\t\t\telementId: elementId,\n\t\t\t\trank: rank\n\t\t\t},\n\t\t\tsuccessCallback: (data) =>\n\t\t\t{\n\t\t\t\tif (data.ITEMS)\n\t\t\t\t{\n\t\t\t\t\tthis.repopulateItems(data.ITEMS);\n\t\t\t\t\tthis.update();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\tsetElementStatus(elementId, statusId)\n\t{\n\t\tthis.executeItemAction({\n\t\t\taction: 'SET_ELEMENT_STATUS',\n\t\t\tparameters: {\n\t\t\t\tcallListId: this.id,\n\t\t\t\telementId: elementId,\n\t\t\t\tstatusId: statusId\n\t\t\t},\n\t\t\tsuccessCallback: (data) =>\n\t\t\t{\n\t\t\t\tthis.repopulateItems(data.ITEMS);\n\t\t\t\tthis.update();\n\t\t\t}\n\t\t})\n\t};\n\n\t/**\n\t * @param {int} elementId\n\t * @param {int} webformResultId\n\t */\n\tsetWebformResult(elementId, webformResultId)\n\t{\n\t\tthis.executeItemAction({\n\t\t\taction: 'SET_WEBFORM_RESULT',\n\t\t\tparameters: {\n\t\t\t\tcallListId: this.id,\n\t\t\t\telementId: elementId,\n\t\t\t\twebformResultId: webformResultId\n\t\t\t}\n\t\t})\n\t};\n\n\texecuteItemAction(params)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tif (!Type.isFunction(params.successCallback))\n\t\t{\n\t\t\tparams.successCallback = nop;\n\t\t}\n\n\t\tvar requestParams = {\n\t\t\t'sessid': BX.bitrix_sessid(),\n\t\t\t'ajax_action': params.action,\n\t\t\t'parameters': params.parameters\n\t\t};\n\n\t\tBX.ajax({\n\t\t\turl: CallList.getAjaxUrl(),\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\tdata: requestParams,\n\t\t\tonsuccess: (data) => params.successCallback(data)\n\t\t});\n\t};\n\n\trepopulateItems(items)\n\t{\n\t\tfor (let [statusId, status] of this.statuses)\n\t\t{\n\t\t\tstatus.ITEMS = [];\n\t\t}\n\n\t\titems.forEach((item) => this.statuses.get(item.STATUS_ID).ITEMS.push(item));\n\n\t\tif (this.statuses.get(this.currentStatusId).ITEMS.length === 0)\n\t\t{\n\t\t\tthis.currentStatusId = this.getNonEmptyStatusId();\n\t\t\tthis.currentItemIndex = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.currentItemIndex >= this.statuses.get(this.currentStatusId).ITEMS.length)\n\t\t\t{\n\t\t\t\tthis.currentItemIndex = 0;\n\t\t\t}\n\t\t}\n\n\t\tthis.selectItem(this.currentStatusId, this.currentItemIndex);\n\t};\n\n\tgetNonEmptyStatusId()\n\t{\n\t\tlet foundStatusId = false;\n\n\t\tfor (let [statusId, status] of this.statuses)\n\t\t{\n\t\t\tif (status.ITEMS.length > 0)\n\t\t\t{\n\t\t\t\tfoundStatusId = statusId;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn foundStatusId;\n\t};\n\n\tgetCurrentElement()\n\t{\n\t\treturn this.statuses.get(this.currentStatusId).ITEMS[this.currentItemIndex];\n\t};\n\n\tgetStatusTitle(statusId)\n\t{\n\t\tconst count = this.statuses.get(statusId).ITEMS.length;\n\n\t\treturn Text.encode(this.statuses.get(statusId).NAME) + ' (' + count.toString() + ')';\n\t};\n\n\trenderStatusBlock(status)\n\t{\n\t\tlet animationTimeout;\n\t\tlet itemsNode;\n\t\tlet measuringNode;\n\t\tconst statusId = status.STATUS_ID;\n\n\t\tif (!status.hasOwnProperty('_folded'))\n\t\t{\n\t\t\tstatus._folded = false;\n\t\t}\n\n\t\tlet className = 'im-phone-call-list-block';\n\n\t\tif (status.CLASS != '')\n\t\t{\n\t\t\tclassName = className + ' ' + status.CLASS;\n\t\t}\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: className}, children: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-block-title' + (status._folded ? '' : ' active')},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"span\", {text: this.getStatusTitle(statusId)}),\n\t\t\t\t\t\tDom.create(\"div\", {props: {className: 'im-phone-call-list-block-title-arrow'}})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (e: Event) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault()\n\t\t\t\t\t\t\tclearTimeout(animationTimeout);\n\t\t\t\t\t\t\tstatus._folded = !status._folded;\n\t\t\t\t\t\t\tif (status._folded)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.removeClass(e.target, 'active');\n\t\t\t\t\t\t\t\titemsNode.style.height = measuringNode.clientHeight.toString() + 'px';\n\t\t\t\t\t\t\t\tanimationTimeout = setTimeout(function ()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\titemsNode.style.height = 0;\n\t\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.addClass(e.target, 'active');\n\t\t\t\t\t\t\t\titemsNode.style.height = 0;\n\t\t\t\t\t\t\t\tanimationTimeout = setTimeout(function ()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\titemsNode.style.height = measuringNode.clientHeight + 'px';\n\t\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\titemsNode = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-items-block'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tmeasuringNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-list-items-measuring'},\n\t\t\t\t\t\t\tchildren: this.renderCallListItems(statusId)\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\ttransitionend: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!status._folded)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titemsNode.style.removeProperty('height');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t}\n\n\tstatic getAjaxUrl(): string\n\t{\n\t\treturn (this.isDesktop ? '/desktop_app/call_list.ajax.php' : '/bitrix/components/bitrix/crm.activity.call_list/ajax.php')\n\t}\n}\n","import {Dom, Loc, Text, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {CallList} from './call-list'\n\nlet avatars = {};\n\nconst Events = {\n\tonUnfold: \"onUnfold\"\n}\n\nexport class FoldedCallView extends EventEmitter\n{\n\tconstructor(params)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(\"BX.VoxImplant.FoldedCallView\");\n\t\tthis.subscribeFromOptions(params.events)\n\n\t\tthis.currentItem = {};\n\t\tthis.callListParams = {\n\t\t\tid: 0,\n\t\t\twebformId: 0,\n\t\t\twebformSecCode: '',\n\t\t\titemIndex: 0,\n\t\t\titemStatusId: '',\n\t\t\tstatusList: {},\n\t\t\tentityType: ''\n\t\t};\n\t\tthis.node = null;\n\t\tthis.elements = {\n\t\t\tavatar: null,\n\t\t\tcallButton: null,\n\t\t\tnextButton: null,\n\t\t\tunfoldButton: null\n\t\t};\n\t\tthis._lsKey = 'bx-im-folded-call-view-data';\n\t\tthis._lsTtl = 86400;\n\t\tthis.init();\n\t}\n\n\tinit()\n\t{\n\t\tthis.load();\n\t\tif (this.callListParams.id > 0)\n\t\t{\n\t\t\tthis.currentItem = this.callListParams.statusList[this.callListParams.itemStatusId].ITEMS[this.callListParams.itemIndex];\n\t\t\tthis.render();\n\t\t}\n\t};\n\n\tload()\n\t{\n\t\tvar savedData = BX.localStorage.get(this._lsKey);\n\t\tif (Type.isPlainObject(savedData))\n\t\t{\n\t\t\tthis.callListParams = savedData;\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.node)\n\t\t{\n\t\t\tDom.remove(this.node);\n\t\t\tthis.node = null;\n\t\t}\n\n\t\tBX.localStorage.remove(this._lsKey);\n\t};\n\n\tstore()\n\t{\n\t\tBX.localStorage.set(this._lsKey, this.callListParams, this._lsTtl);\n\t};\n\n\tfold(params, animation)\n\t{\n\t\tanimation = (animation === true);\n\t\tthis.callListParams.id = params.callListId;\n\t\tthis.callListParams.webformId = params.webformId;\n\t\tthis.callListParams.webformSecCode = params.webformSecCode;\n\t\tthis.callListParams.itemIndex = params.currentItemIndex;\n\t\tthis.callListParams.itemStatusId = params.currentItemStatusId;\n\t\tthis.callListParams.statusList = Object.fromEntries(params.statusList);\n\t\tthis.callListParams.entityType = params.entityType;\n\t\tthis.currentItem = this.callListParams.statusList[this.callListParams.itemStatusId].ITEMS[this.callListParams.itemIndex];\n\t\tthis.store();\n\t\tthis.render(animation);\n\t};\n\n\tunfold(makeCall: ?boolean)\n\t{\n\t\tDom.addClass(this.node, \"im-phone-folded-call-view-unfold\");\n\t\tthis.node.addEventListener('animationend', () =>\n\t\t{\n\t\t\tif (this.node)\n\t\t\t{\n\t\t\t\tDom.remove(this.node);\n\t\t\t\tthis.node = null;\n\t\t\t}\n\n\t\t\tBX.localStorage.remove(this._lsKey);\n\t\t\tif (this.callListParams.id === 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet restoredParams = {};\n\t\t\tif (this.callListParams.webformId > 0 && this.callListParams.webformSecCode !== '')\n\t\t\t{\n\t\t\t\trestoredParams.webformId = this.callListParams.webformId;\n\t\t\t\trestoredParams.webformSecCode = this.callListParams.webformSecCode;\n\t\t\t}\n\t\t\trestoredParams.callListStatusId = this.callListParams.itemStatusId;\n\t\t\trestoredParams.callListItemIndex = this.callListParams.itemIndex;\n\t\t\trestoredParams.makeCall = makeCall;\n\n\t\t\tthis.emit(Events.onUnfold, {\n\t\t\t\tcallListId: this.callListParams.id,\n\t\t\t\tcallListParams: restoredParams\n\t\t\t})\n\t\t});\n\t};\n\n\tmoveToNext()\n\t{\n\t\tthis.callListParams.itemIndex++;\n\t\tif (this.callListParams.itemIndex >= this.callListParams.statusList[this.callListParams.itemStatusId].ITEMS.length)\n\t\t{\n\t\t\tthis.callListParams.itemIndex = 0;\n\t\t}\n\n\t\tthis.currentItem = this.callListParams.statusList[this.callListParams.itemStatusId].ITEMS[this.callListParams.itemIndex];\n\t\tthis.store();\n\t\tthis.render();\n\t};\n\n\trender(animation)\n\t{\n\t\tanimation = (animation === true);\n\t\tif (this.node === null)\n\t\t{\n\t\t\tthis.node = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tid: 'im-phone-folded-call-view',\n\t\t\t\t\tclassName: 'im-phone-call-wrapper im-phone-call-wrapper-fixed im-phone-call-panel'\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tdblclick: this._onViewDblClick.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t\tdocument.body.appendChild(this.node);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.clean(this.node);\n\t\t}\n\n\t\tthis.node.appendChild(Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-left'},\n\t\t\tstyle: (animation ? {bottom: '-90px'} : {}),\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user'}, children: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-image'}, children: [\n\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {props: {className: 'im-phone-call-wrapper-fixed-user-image-item'}})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-info'},\n\t\t\t\t\t\t\tchildren: this.renderUserInfo()\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t}));\n\n\t\tthis.node.appendChild(Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-right'}, children: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-btn-container'}, children: [\n\t\t\t\t\t\tthis.elements.callButton = Dom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-btn im-phone-call-btn-green'},\n\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_FOLDED_BUTTON_CALL'),\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onDialButtonClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.nextButton = Dom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-btn im-phone-call-btn-gray im-phone-call-btn-arrow'},\n\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_FOLDED_BUTTON_NEXT'),\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onNextButtonClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t}));\n\n\t\tthis.node.appendChild(Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-btn-block'}, children: [\n\t\t\t\t\tthis.elements.unfoldButton = Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-btn-arrow'},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: 'im-phone-btn-arrow-inner'},\n\t\t\t\t\t\t\t\ttext: Loc.getMessage(\"IM_PHONE_CALL_VIEW_UNFOLD\")\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t],\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: this._onUnfoldButtonClick.bind(this)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t})\n\t\t);\n\n\t\tif (avatars[this.currentItem.ELEMENT_ID])\n\t\t{\n\t\t\tthis.elements.avatar.style.backgroundImage = 'url(\\'' + Text.encode(avatars[this.currentItem.ELEMENT_ID]) + '\\')';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.loadAvatar(this.callListParams.entityType, this.currentItem.ELEMENT_ID);\n\t\t}\n\n\t\tif (animation)\n\t\t{\n\t\t\tDom.addClass(this.node, 'im-phone-folded-call-view-fold');\n\t\t\tthis.node.addEventListener('animationend', function ()\n\t\t\t{\n\t\t\t\tBX.removeClass(this.node, 'im-phone-folded-call-view-fold');\n\t\t\t})\n\t\t}\n\t};\n\n\trenderUserInfo()\n\t{\n\t\tvar result = [];\n\n\t\tresult.push(Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-name'},\n\t\t\ttext: this.currentItem.NAME\n\t\t}));\n\t\tif (this.currentItem.POST)\n\t\t{\n\t\t\tresult.push(Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-item'},\n\t\t\t\ttext: this.currentItem.POST\n\t\t\t}));\n\t\t}\n\t\tif (this.currentItem.COMPANY_TITLE)\n\t\t{\n\t\t\tresult.push(Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-item'},\n\t\t\t\ttext: this.currentItem.COMPANY_TITLE\n\t\t\t}));\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tloadAvatar(entityType, entityId)\n\t{\n\t\tBX.ajax({\n\t\t\turl: CallList.getAjaxUrl(),\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\t'sessid': BX.bitrix_sessid(),\n\t\t\t\t'ajax_action': 'GET_AVATAR',\n\t\t\t\t'entityType': entityType,\n\t\t\t\t'entityId': entityId\n\t\t\t},\n\t\t\tonsuccess: (data) =>\n\t\t\t{\n\t\t\t\tif (!data.avatar)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tavatars[entityId] = data.avatar;\n\t\t\t\tif (this.currentItem.ELEMENT_ID == entityId && this.elements.avatar)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.avatar.style.backgroundImage = 'url(\\'' + Text.encode(data.avatar) + '\\')';\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\t_onViewDblClick(e)\n\t{\n\t\te.preventDefault();\n\t\tthis.unfold(false);\n\t};\n\n\t_onDialButtonClick(e)\n\t{\n\t\te.preventDefault();\n\t\tthis.unfold(true);\n\t};\n\n\t_onNextButtonClick(e)\n\t{\n\t\te.preventDefault();\n\t\tthis.moveToNext();\n\t};\n\n\t_onUnfoldButtonClick(e)\n\t{\n\t\te.preventDefault();\n\t\tthis.unfold(false);\n\t};\n\n\tstatic Events = Events;\n}","import {Type} from 'main.core';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\nimport type {MessengerFacade} from '../controller';\n\nconst desktopFeatureMap = {\n\t'iframe': 39\n};\n\nexport class Desktop\n{\n\tconstructor(params)\n\t{\n\t\tthis.parentPhoneCallView = params.parentPhoneCallView;\n\t\tthis.closable = params.closable;\n\t\tthis.title = params.title || '';\n\t\tthis.window = null;\n\t}\n\n\topenCallWindow(content, js, params)\n\t{\n\t\tparams = params || {};\n\n\t\tif (params.minSettingsWidth)\n\t\t{\n\t\t\tthis.minSettingsWidth = params.minSettingsWidth;\n\t\t}\n\n\t\tif (params.minSettingsHeight)\n\t\t{\n\t\t\tthis.minSettingsHeight = params.minSettingsHeight;\n\t\t}\n\n\t\tparams.resizable = (params.resizable === true);\n\n\t\tDesktopApi.createWindow(\"callWindow\", (callWindow) =>\n\t\t{\n\t\t\tcallWindow.SetProperty(\"clientSize\", {Width: params.width, Height: params.height});\n\t\t\tcallWindow.SetProperty(\"resizable\", params.resizable);\n\t\t\tif (params.resizable && params.hasOwnProperty('minWidth') && params.hasOwnProperty('minHeight'))\n\t\t\t{\n\t\t\t\tcallWindow.SetProperty(\"minClientSize\", {Width: params.minWidth, Height: params.minHeight});\n\t\t\t}\n\t\t\tcallWindow.SetProperty(\"title\", this.title);\n\t\t\tcallWindow.SetProperty(\"closable\", true);\n\n\t\t\t//callWindow.OpenDeveloperTools();\n\t\t\tlet html = this.#getHtmlPage(content, js, {});\n\t\t\tcallWindow.ExecuteCommand(\"html.load\", html);\n\t\t\tthis.window = callWindow;\n\t\t});\n\t};\n\n\tsetClosable(closable: boolean)\n\t{\n\t\tthis.closable = (closable === true);\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.SetProperty(\"closable\", this.closable);\n\t\t}\n\t};\n\n\tsetTitle(title)\n\t{\n\t\tthis.title = title;\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.SetProperty(\"title\", title)\n\t\t}\n\t};\n\n\t#getHtmlPage(content, jsContent, initImJs, bodyClass)\n\t{\n\t\tcontent = content || '';\n\t\tjsContent = jsContent || '';\n\t\tbodyClass = bodyClass || '';\n\n\t\tif (this.htmlWrapperHead == null)\n\t\t{\n\t\t\tthis.htmlWrapperHead = document.head.outerHTML.replace(/BX\\.PULL\\.start\\([^)]*\\);/g, '');\n\t\t}\n\n\t\tif (Type.isDomNode(content))\n\t\t{\n\t\t\tcontent = content.outerHTML;\n\t\t}\n\n\t\tif (Type.isDomNode(jsContent))\n\t\t{\n\t\t\tjsContent = jsContent.outerHTML;\n\t\t}\n\n\t\tif (Type.isStringFilled(jsContent))\n\t\t{\n\t\t\tjsContent =\n\t\t\t\t`<script>\n\t\t\t\t\tBX.ready(function() {\n\t\t\t\t\t\t${jsContent}\n\t\t\t\t\t});\n\t\t\t\t</script>`;\n\t\t}\n\n\t\tlet initJs = '';\n\t\tif (initImJs)\n\t\t{\n\t\t\tinitJs = `\n\t\t\t\t<script>\n\t\t\t\t\tBX.ready(function() {\n\t\t\t\t\t\t\tconst backgroundWorker = new BX.Voximplant.BackgroundWorker();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\twindow.PCW = new BX.Voximplant.PhoneCallView({\n\t\t\t\t\t\t\t\tisDesktop: true,\n\t\t\t\t\t\t\t\tslave: true, \n\t\t\t\t\t\t\t\tskipOnResize: true, \n\t\t\t\t\t\t\t\tcallId: '${this.parentPhoneCallView.callId}',\n\t\t\t\t\t\t\t\tuiState: ${this.parentPhoneCallView._uiState},\n\t\t\t\t\t\t\t\tphoneNumber: '${this.parentPhoneCallView.phoneNumber}',\n\t\t\t\t\t\t\t\tcompanyPhoneNumber: '${this.parentPhoneCallView.companyPhoneNumber}',\n\t\t\t\t\t\t\t\tdirection: '${this.parentPhoneCallView.direction}',\n\t\t\t\t\t\t\t\tfromUserId: '${this.parentPhoneCallView.fromUserId}',\n\t\t\t\t\t\t\t\ttoUserId: '${this.parentPhoneCallView.toUserId}',\n\t\t\t\t\t\t\t\tcrm: ${this.parentPhoneCallView.crm},\n\t\t\t\t\t\t\t\thasSipPhone: ${this.parentPhoneCallView.hasSipPhone},\n\t\t\t\t\t\t\t\tdeviceCall: ${this.parentPhoneCallView.deviceCall},\n\t\t\t\t\t\t\t\ttransfer: ${this.parentPhoneCallView.transfer},\n\t\t\t\t\t\t\t\tcrmEntityType: '${this.parentPhoneCallView.crmEntityType}',\n\t\t\t\t\t\t\t\tcrmEntityId: '${this.parentPhoneCallView.crmEntityId}',\n\t\t\t\t\t\t\t\tcrmActivityId: '${this.parentPhoneCallView.crmActivityId}',\n\t\t\t\t\t\t\t\tcrmActivityEditUrl: '${this.parentPhoneCallView.crmActivityEditUrl}',\n\t\t\t\t\t\t\t\tcallListId: ${this.parentPhoneCallView.callListId},\n\t\t\t\t\t\t\t\tcallListStatusId: '${this.parentPhoneCallView.callListStatusId}',\n\t\t\t\t\t\t\t\tcallListItemIndex: ${this.parentPhoneCallView.callListItemIndex},\n\t\t\t\t\t\t\t\tconfig: ${this.parentPhoneCallView.config ? JSON.stringify(this.parentPhoneCallView.config) : '{}'},\n\t\t\t\t\t\t\t\tportalCall: ${this.parentPhoneCallView.portalCall ? 'true' : 'false'},\n\t\t\t\t\t\t\t\tportalCallData: ${this.parentPhoneCallView.portalCallData ? JSON.stringify(this.parentPhoneCallView.portalCallData) : '{}'},\n\t\t\t\t\t\t\t\tportalCallUserId: ${this.parentPhoneCallView.portalCallUserId},\n\t\t\t\t\t\t\t\twebformId: ${this.parentPhoneCallView.webformId},\n\t\t\t\t\t\t\t\twebformSecCode: '${this.parentPhoneCallView.webformSecCode}',\n\t\t\t\t\t\t\t\tbackgroundWorker: backgroundWorker,\n\t\t\t\t\t\t\t\trestApps: ${this.parentPhoneCallView.restApps ? JSON.stringify(this.parentPhoneCallView.restApps) : '[]'},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t</script>`;\n\t\t}\n\t\treturn `\n\t\t\t<!DOCTYPE html>\n\t\t\t<html lang=\"${document.documentElement.lang}\">\n\t\t\t\t${this.htmlWrapperHead}\n\t\t\t\t<body class=\"im-desktop im-desktop-popup ${bodyClass}\">\n\t\t\t\t\t<div id=\"placeholder-messanger\">${content}</div>\n\t\t\t\t\t${initJs}\n\t\t\t\t\t${jsContent}\n\t\t\t\t</body>\n\t\t\t</html>\n\t\t`;\n\t};\n\n\taddCustomEvent(eventName, eventHandler)\n\t{\n\t\tBX.desktop.addCustomEvent(eventName, eventHandler);\n\t};\n\n\tonCustomEvent(windowTarget, eventName, arEventParams)\n\t{\n\t\tBX.desktop.onCustomEvent(windowTarget, eventName, arEventParams);\n\t};\n\n\tresize(width, height)\n\t{\n\t\tBXDesktopWindow.SetProperty(\"clientSize\", {Width: width, Height: height});\n\t};\n\n\tsetResizable(resizable)\n\t{\n\t\tresizable = (resizable === true);\n\t\tBXDesktopWindow.SetProperty(\"resizable\", resizable);\n\t};\n\n\tsetMinSize(width, height)\n\t{\n\t\tBXDesktopWindow.SetProperty(\"minClientSize\", {Width: width, Height: height});\n\t};\n\n\tsetWindowPosition(params)\n\t{\n\t\tBXDesktopWindow.SetProperty(\"position\", params);\n\t};\n\n\tcenter()\n\t{\n\t\tBXDesktopWindow.ExecuteCommand(\"center\");\n\t};\n\n\tgetVersion(full)\n\t{\n\t\tif (typeof (BXDesktopSystem) == 'undefined')\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (!this.clientVersion)\n\t\t{\n\t\t\tthis.clientVersion = BXDesktopSystem.GetProperty('versionParts');\n\t\t}\n\n\t\treturn full ? this.clientVersion.join('.') : this.clientVersion[3];\n\t};\n\n\tisFeatureSupported(featureName)\n\t{\n\t\tif (!desktopFeatureMap.hasOwnProperty(featureName))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.getVersion() >= desktopFeatureMap[featureName];\n\t};\n}","/**\n * @bxjs_lang_path js_phone_call_view.php\n */\n\nimport {Dom, Type, Text, Runtime, Loc, Uri} from 'main.core';\nimport {Popup, Menu} from 'main.popup';\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport {BackgroundWorker, backgroundWorkerEvents} from './background-worker';\nimport {FormManager} from './form-manager';\nimport {CallList} from './call-list';\nimport {FoldedCallView} from './folded-view';\nimport {Desktop} from './desktop';\nimport {Keypad} from './keypad';\nimport type {Dialog} from 'ui.entity-selector';\nimport {baseZIndex, nop} from './common';\n\nimport type {MessengerFacade} from '../controller';\n\nexport const Direction = {\n\tincoming: 'incoming',\n\toutgoing: 'outgoing',\n\tcallback: 'callback',\n}\n\nexport const UiState = {\n\tincoming: 1,\n\ttransferIncoming: 2,\n\toutgoing: 3,\n\tconnectingIncoming: 4,\n\tconnectingOutgoing: 5,\n\tconnected: 6,\n\ttransferring: 7,\n\ttransferFailed: 8,\n\ttransferConnected: 9,\n\tidle: 10,\n\terror: 11,\n\tmoneyError: 12,\n\tsipPhoneError: 13,\n\tredial: 14,\n\texternalCard: 15,\n}\n\nexport const CallState = {\n\tidle: 'idle',\n\tconnecting: 'connecting',\n\tconnected: 'connected',\n}\n\nexport const CallProgress = {\n\tconnect: 'connect',\n\terror: 'error',\n\toffline: 'offline',\n\tonline: 'online',\n\twait: 'wait'\n}\n\nconst ButtonLayouts = {\n\tcentered: 'centered',\n\tspaced: 'spaced'\n};\n\n/* Phone Call UI */\nconst layouts = {\n\tsimple: 'simple',\n\tcrm: 'crm'\n}\n\nconst initialSize = {\n\tsimple: {\n\t\twidth: 550,\n\t\theight: 492\n\t},\n\tcrm: {\n\t\twidth: 550,\n\t\theight: 650\n\t}\n};\n\nconst lsKeys = {\n\theight: 'im-phone-call-view-height',\n\twidth: 'im-phone-call-view-width',\n\tcallView: 'bx-vox-call-view',\n\tcallInited: 'viInitedCall',\n\texternalCall: 'viExternalCard',\n\tcurrentCall: 'bx-vox-current-call',\n};\n\nexport const desktopEvents = {\n\tsetTitle: 'phoneCallViewSetTitle',\n\tsetStatus: 'phoneCallViewSetStatus',\n\tsetUiState: 'phoneCallViewSetUiState',\n\tsetDeviceCall: 'phoneCallViewSetDeviceCall',\n\tsetCrmEntity: 'phoneCallViewSetCrmEntity',\n\tsetPortalCall: 'phoneCallViewSetPortalCall',\n\tsetPortalCallUserId: 'phoneCallViewSetPortalCallUserId',\n\tsetPortalCallQueueName: 'phoneCallViewSetPortalCallQueueName',\n\tsetPortalCallData: 'phoneCallViewSetPortalCallData',\n\tsetConfig: 'phoneCallViewSetConfig',\n\tsetCallState: 'phoneCallViewSetCallState',\n\treloadCrmCard: 'phoneCallViewReloadCrmCard',\n\tsetCallId: 'phoneCallViewSetCallId',\n\tsetLineNumber: 'phoneCallViewSetLineNumber',\n\tsetPhoneNumber: 'phoneCallViewSetPhoneNumber',\n\tsetCompanyPhoneNumber: 'phoneCallViewSetCompanyPhoneNumber',\n\tsetTransfer: 'phoneCallViewSetTransfer',\n\tcloseWindow: 'phoneCallViewCloseWindow',\n\n\tonHold: 'phoneCallViewOnHold',\n\tonUnHold: 'phoneCallViewOnUnHold',\n\tonMute: 'phoneCallViewOnMute',\n\tonUnMute: 'phoneCallViewOnUnMute',\n\tonMakeCall: 'phoneCallViewOnMakeCall',\n\tonCallListMakeCall: 'phoneCallViewOnCallListMakeCall',\n\tonAnswer: 'phoneCallViewOnAnswer',\n\tonSkip: 'phoneCallViewOnSkip',\n\tonHangup: 'phoneCallViewOnHangup',\n\tonClose: 'phoneCallViewOnClose',\n\tonStartTransfer: 'phoneCallViewOnStartTransfer',\n\tonCompleteTransfer: 'phoneCallViewOnCompleteTransfer',\n\tonCancelTransfer: 'phoneCallViewOnCancelTransfer',\n\tonBeforeUnload: 'phoneCallViewOnBeforeUnload',\n\tonSwitchDevice: 'phoneCallViewOnSwitchDevice',\n\tonQualityGraded: 'phoneCallViewOnQualityGraded',\n\tonDialpadButtonClicked: 'phoneCallViewOnDialpadButtonClicked',\n\tonCommentShown: 'phoneCallViewOnCommentShown',\n\tonSaveComment: 'phoneCallViewOnSaveComment',\n\tonSetAutoClose: 'phoneCallViewOnSetAutoClose',\n};\n\nconst blankAvatar = '/bitrix/js/im/images/blank.gif';\n\nexport type PhoneCallViewParams = {\n\tdarkMode: boolean,\n\tphoneNumber: ?string,\n\tlineNumber: ?string,\n\tcompanyPhoneNumber: ?string,\n\tdirection: string, /** @see Direction */\n\tuiState: number, /** @see UiState */\n\tbackgroundWorker: BackgroundWorker,\n\tfoldedCallView: FoldedCallView,\n\n\tfromUserId: ?number,\n\ttoUserId: ?number,\n\tconfig: Object,\n\tcallId: ?string,\n\tcrmEntityType: ?string,\n\tcrmEntityId: ?number,\n\tcrmActivityId: ?number,\n\tcrmActivityEditUrl: ?string,\n\tcrmData: ?Object,\n\tcrmBindings: Array,\n\n\tportalCallData: ?Object,\n\tportalCallUserId: ?number,\n\tportalCallQueueName: ?string,\n\n\thasSipPhone: ?boolean,\n\tdeviceCall: ?boolean,\n\tportalCall: ?boolean,\n\tcrm: ?boolean,\n\trecording: ?boolean,\n\tmakeCall: ?boolean,\n\tfolded: ?boolean,\n\tautoFold: ?boolean,\n\ttransfer: ?boolean,\n\n\tstatusText: ?string,\n\tinitialTimestamp: ?number,\n\tevents: EventHandlers,\n\n\tcallListId: ?number,\n\tcallListStatusId: ?number,\n\tcallListItemIndex: ?number,\n\twebformId: ?string,\n\twebformSecCode: ?string,\n\tslave: ?boolean,\n\tskipOnResize: ?boolean,\n\n\tisExternalCall: ?boolean,\n\tisDesktop: ?boolean,\n\n\trestApps: RestApp[],\n}\n\ntype EventHandlers = {\n\thold: () => void,\n\tunhold: () => void,\n\tmute: () => void,\n\tunmute: () => void,\n\tmakeCall: () => void,\n\tcallListMakeCall: () => void,\n\tanswer: () => void,\n\tskip: () => void,\n\thangup: () => void,\n\tclose: () => void,\n\ttransfer: (TransferTarget) => void,\n\tcompleteTransfer: () => void,\n\tcancelTransfer: () => void,\n\tswitchDevice: () => void,\n\tqualityGraded: () => void,\n\tdialpadButtonClicked: () => void,\n\tsaveComment: () => void,\n\tnotifyAdmin: () => void\n}\n\ntype RestApp = {\n\tid: number,\n\tname: string\n}\n\nexport class PhoneCallView\n{\n\tpopup: ?Popup\n\trestApps: RestApp[]\n\tformManager: ?FormManager\n\tfoldedCallView: FoldedCallView\n\tmessengerFacade: ?MessengerFacade\n\tbackgroundWorker: BackgroundWorker\n\n\tconstructor(params: PhoneCallViewParams)\n\t{\n\t\tthis.id = 'im-phone-call-view';\n\t\tthis.darkMode = params.darkMode === true;\n\n\t\t//params\n\t\tthis.phoneNumber = params.phoneNumber || 'hidden';\n\t\tthis.lineNumber = params.lineNumber || '';\n\t\tthis.companyPhoneNumber = params.companyPhoneNumber || '';\n\t\tthis.direction = params.direction || Direction.incoming;\n\t\tthis.fromUserId = params.fromUserId;\n\t\tthis.toUserId = params.toUserId;\n\t\tthis.config = params.config || {};\n\t\tthis.callId = params.callId || '';\n\t\tthis.callState = CallState.idle;\n\n\t\t//associated crm entities\n\t\tthis.crmEntityType = BX.prop.getString(params, 'crmEntityType', '');\n\t\tthis.crmEntityId = BX.prop.getInteger(params, 'crmEntityId', 0);\n\t\tthis.crmActivityId = BX.prop.getInteger(params, 'crmActivityId', 0);\n\t\tthis.crmActivityEditUrl = BX.prop.getString(params, 'crmActivityEditUrl', '');\n\t\tthis.crmData = BX.prop.getObject(params, 'crmData', {});\n\t\tthis.crmBindings = BX.prop.getArray(params, 'crmBindings', []);\n\t\tthis.externalRequests = {};\n\n\t\t//portal call\n\t\tthis.portalCallData = params.portalCallData;\n\t\tthis.portalCallUserId = params.portalCallUserId;\n\t\tthis.portalCallQueueName = params.portalCallQueueName;\n\n\t\t//flags\n\t\tthis.hasSipPhone = (params.hasSipPhone === true);\n\t\tthis.deviceCall = (params.deviceCall === true);\n\t\tthis.portalCall = (params.portalCall === true);\n\t\tthis.crm = (params.crm === true);\n\t\tthis.held = false;\n\t\tthis.muted = false;\n\t\tthis.recording = (params.recording === true);\n\t\tthis.makeCall = (params.makeCall === true); // emulate pressing on \"dial\" button right after showing call view\n\t\tthis.closable = false;\n\t\tthis.allowAutoClose = true;\n\t\tthis.folded = (params.folded === true);\n\t\tthis.autoFold = (params.autoFold === true);\n\t\tthis.transfer = (params.transfer === true);\n\n\t\tthis.title = '';\n\t\tthis._uiState = params.uiState || UiState.idle;\n\t\tthis.statusText = params.statusText || '';\n\t\tthis.progress = '';\n\t\tthis.quality = 0;\n\t\tthis.qualityPopup = null;\n\t\tthis.qualityGrade = 0;\n\t\tthis.comment = '';\n\t\tthis.commentShown = false;\n\n\t\t//timer\n\t\tthis.initialTimestamp = params.initialTimestamp || 0;\n\t\tthis.timerInterval = null;\n\t\tthis.autoCloseTimer = null;\n\t\tthis.autoCloseTimeout = 65000;\n\n\t\tthis.elements = this.getInitialElements();\n\t\tthis.sections = this.getInitialSections();\n\n\t\tvar uiStateButtons = this.getUiStateButtons(this._uiState);\n\t\tthis.buttonLayout = uiStateButtons.layout;\n\t\tthis.buttons = uiStateButtons.buttons;\n\n\t\tthis.restApps = params.restApps || [];\n\n\t\tif (!Type.isPlainObject(params.events))\n\t\t{\n\t\t\tparams.events = {};\n\t\t}\n\n\t\tthis.callbacks = {\n\t\t\thold: Type.isFunction(params.events.hold) ? params.events.hold : nop,\n\t\t\tunhold: Type.isFunction(params.events.unhold) ? params.events.unhold : nop,\n\t\t\tmute: Type.isFunction(params.events.mute) ? params.events.mute : nop,\n\t\t\tunmute: Type.isFunction(params.events.unmute) ? params.events.unmute : nop,\n\t\t\tmakeCall: Type.isFunction(params.events.makeCall) ? params.events.makeCall : nop,\n\t\t\tcallListMakeCall: Type.isFunction(params.events.callListMakeCall) ? params.events.callListMakeCall : nop,\n\t\t\tanswer: Type.isFunction(params.events.answer) ? params.events.answer : nop,\n\t\t\tskip: Type.isFunction(params.events.skip) ? params.events.skip : nop,\n\t\t\thangup: Type.isFunction(params.events.hangup) ? params.events.hangup : nop,\n\t\t\tclose: Type.isFunction(params.events.close) ? params.events.close : nop,\n\t\t\ttransfer: Type.isFunction(params.events.transfer) ? params.events.transfer : nop,\n\t\t\tcompleteTransfer: Type.isFunction(params.events.completeTransfer) ? params.events.completeTransfer : nop,\n\t\t\tcancelTransfer: Type.isFunction(params.events.cancelTransfer) ? params.events.cancelTransfer : nop,\n\t\t\tswitchDevice: Type.isFunction(params.events.switchDevice) ? params.events.switchDevice : nop,\n\t\t\tqualityGraded: Type.isFunction(params.events.qualityGraded) ? params.events.qualityGraded : nop,\n\t\t\tdialpadButtonClicked: Type.isFunction(params.events.dialpadButtonClicked) ? params.events.dialpadButtonClicked : nop,\n\t\t\tsaveComment: Type.isFunction(params.events.saveComment) ? params.events.saveComment : nop,\n\t\t\tnotifyAdmin: Type.isFunction(params.events.notifyAdmin) ? params.events.notifyAdmin : nop,\n\t\t};\n\n\t\tthis.popup = null;\n\n\t\t// event handlers\n\t\tthis._onBeforeUnloadHandler = this._onBeforeUnload.bind(this);\n\t\tthis._onDblClickHandler = this._onDblClick.bind(this);\n\t\tthis._onHoldButtonClickHandler = this._onHoldButtonClick.bind(this);\n\t\tthis._onMuteButtonClickHandler = this._onMuteButtonClick.bind(this);\n\t\tthis._onTransferButtonClickHandler = this._onTransferButtonClick.bind(this);\n\t\tthis._onTransferCompleteButtonClickHandler = this._onTransferCompleteButtonClick.bind(this);\n\t\tthis._onTransferCancelButtonClickHandler = this._onTransferCancelButtonClick.bind(this);\n\t\tthis._onDialpadButtonClickHandler = this._onDialpadButtonClick.bind(this);\n\t\tthis._onHangupButtonClickHandler = this._onHangupButtonClick.bind(this);\n\t\tthis._onCloseButtonClickHandler = this._onCloseButtonClick.bind(this);\n\t\tthis._onMakeCallButtonClickHandler = this._onMakeCallButtonClick.bind(this);\n\t\tthis._onNextButtonClickHandler = this._onNextButtonClick.bind(this);\n\t\tthis._onRedialButtonClickHandler = this._onRedialButtonClick.bind(this);\n\t\tthis._onFoldButtonClickHandler = this._onFoldButtonClick.bind(this);\n\t\tthis._onAnswerButtonClickHandler = this._onAnswerButtonClick.bind(this);\n\t\tthis._onSkipButtonClickHandler = this._onSkipButtonClick.bind(this);\n\t\tthis._onSwitchDeviceButtonClickHandler = this._onSwitchDeviceButtonClick.bind(this);\n\t\tthis._onQualityMeterClickHandler = this._onQualityMeterClick.bind(this);\n\t\tthis._onPullEventCrmHandler = this._onPullEventCrm.bind(this);\n\n\t\t// tabs\n\t\tthis.hiddenTabs = [];\n\t\tthis.currentTabName = '';\n\t\tthis.moreTabsMenu = null;\n\n\t\t// callList\n\t\tthis.callListId = params.callListId || 0;\n\t\tthis.callListStatusId = params.callListStatusId || null;\n\t\tthis.callListItemIndex = params.callListItemIndex || null;\n\t\tthis.callListView = null;\n\t\tthis.currentEntity = null;\n\t\tthis.callingEntity = null;\n\t\tthis.numberSelectMenu = null;\n\n\t\t// webform\n\t\tthis.webformId = params.webformId || 0;\n\t\tthis.webformSecCode = params.webformSecCode || '';\n\t\tthis.webformLoaded = false;\n\n\t\t// partner data\n\t\tthis.restAppLayoutLoaded = false;\n\t\tthis.restAppLayoutLoading = false;\n\t\tthis.restAppInterface = null;\n\n\t\t// desktop integration\n\t\tthis.callWindow = null;\n\t\tthis.slave = params.slave === true;\n\t\tthis.skipOnResize = params.skipOnResize === true;\n\t\tthis.desktop = new Desktop({\n\t\t\tparentPhoneCallView: this,\n\t\t\tclosable: (this.callListId > 0 ? true : this.closable),\n\t\t});\n\n\t\tthis.currentLayout = (this.callListId > 0 ? layouts.crm : layouts.simple);\n\n\t\tthis.backgroundWorker = params.backgroundWorker;\n\t\tthis.backgroundWorker.setCallCard(this);\n\t\tthis.backgroundWorker.setExternalCall(!!params.isExternalCall);\n\n\t\tthis._isDesktop = params.messengerFacade ? params.messengerFacade.isDesktop() : params.isDesktop === true;\n\t\tthis.messengerFacade = params.messengerFacade;\n\t\tthis.foldedCallView = params.foldedCallView;\n\n\t\tthis.init();\n\n\t\tif (this.backgroundWorker.isDesktop())\n\t\t{\n\t\t\tthis.backgroundWorker.removeDesktopEventHandlers();\n\t\t}\n\t\tthis.backgroundWorker.platformWorker.emitInitializeEvent(this.getPlacementOptions());\n\t\tthis.createTitle().then(title => this.setTitle(title));\n\t\tif (params.hasOwnProperty('uiState'))\n\t\t{\n\t\t\tthis.setUiState(params['uiState']);\n\t\t}\n\t}\n\n\tgetInitialElements()\n\t{\n\t\treturn {\n\t\t\tmain: null,\n\t\t\ttitle: null,\n\t\t\tsections: {\n\t\t\t\tstatus: null,\n\t\t\t\ttimer: null,\n\t\t\t\tcrmButtons: null,\n\t\t\t},\n\t\t\tavatar: null,\n\t\t\tprogress: null,\n\t\t\ttimer: null,\n\t\t\tstatus: null,\n\t\t\tcommentEditorContainer: null,\n\t\t\tcommentEditor: null,\n\t\t\tqualityMeter: null,\n\t\t\tcrmCard: null,\n\t\t\tcrmButtonsContainer: null,\n\t\t\tcrmButtons: {},\n\t\t\tbuttonsContainer: null,\n\t\t\ttopLevelButtonsContainer: null,\n\t\t\ttopButtonsContainer: null, //well..\n\t\t\tbuttons: {},\n\t\t\tsidebarContainer: null,\n\t\t\ttabsContainer: null,\n\t\t\ttabsBodyContainer: null,\n\t\t\ttabs: {\n\t\t\t\tcallList: null,\n\t\t\t\twebform: null,\n\t\t\t\tapp: null\n\t\t\t},\n\t\t\ttabsBody: {\n\t\t\t\tcallList: null,\n\t\t\t\twebform: null,\n\t\t\t\tapp: null\n\t\t\t},\n\t\t\tmoreTabs: null\n\t\t};\n\t};\n\n\tgetInitialSections()\n\t{\n\t\treturn {\n\t\t\tstatus: {visible: false},\n\t\t\ttimer: {visible: false},\n\t\t\tcrmButtons: {visible: false},\n\t\t\tcommentEditor: {visible: false}\n\t\t}\n\t};\n\n\tinit()\n\t{\n\t\tif (DesktopApi.isChatWindow() && !this.slave)\n\t\t{\n\t\t\tconsole.log('Init phone call view window:', location.href);\n\t\t\tthis.desktop.openCallWindow('', null, {\n\t\t\t\twidth: this.getInitialWidth(),\n\t\t\t\theight: this.getInitialHeight(),\n\t\t\t\tresizable: (this.currentLayout == layouts.crm),\n\t\t\t\tminWidth: this.elements.sidebarContainer ? 950 : 550,\n\t\t\t\tminHeight: 650\n\t\t\t});\n\t\t\tthis.bindMasterDesktopEvents();\n\n\t\t\twindow.addEventListener('beforeunload', this.#onWindowUnload); //master window unload\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.main = this.createLayout();\n\t\tthis.updateView();\n\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tdocument.body.appendChild(this.elements.main);\n\t\t\tthis.bindSlaveDesktopEvents();\n\t\t}\n\t\telse if (!this.isDesktop() && this.isFolded())\n\t\t{\n\t\t\tdocument.body.appendChild(this.elements.main);\n\t\t}\n\t\telse if (!this.isDesktop())\n\t\t{\n\t\t\tthis.popup = this.createPopup();\n\t\t\tBX.addCustomEvent(window, \"onLocalStorageSet\", this.#onExternalEvent);\n\t\t}\n\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\tif (this.callListView)\n\t\t\t{\n\t\t\t\tthis.callListView.reinit({\n\t\t\t\t\tnode: this.elements.tabsBody.callList\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callListView = new CallList({\n\t\t\t\t\tnode: this.elements.tabsBody.callList,\n\t\t\t\t\tid: this.callListId,\n\t\t\t\t\tstatusId: this.callListStatusId,\n\t\t\t\t\titemIndex: this.callListItemIndex,\n\t\t\t\t\tmakeCall: this.makeCall,\n\t\t\t\t\tisDesktop: this.isDesktop,\n\t\t\t\t\tonSelectedItem: this.onCallListSelectedItem.bind(this)\n\t\t\t\t});\n\n\t\t\t\tthis.callListView.init(() =>\n\t\t\t\t{\n\t\t\t\t\tif (this.makeCall)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._onMakeCallButtonClick();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.setUiState(UiState.outgoing);\n\t\t\t}\n\t\t}\n\t\telse if (this.crm && !this.isFolded())\n\t\t{\n\t\t\tthis.loadCrmCard(this.crmEntityType, this.crmEntityId);\n\t\t}\n\n\t\tBX.addCustomEvent(\"onPullEvent-crm\", this._onPullEventCrmHandler);\n\t\tif (!this.isDesktop())\n\t\t{\n\t\t\twindow.addEventListener('beforeunload', this._onBeforeUnloadHandler);\n\t\t}\n\t};\n\n\treinit()\n\t{\n\t\tthis.elements = this.getInitialElements();\n\n\t\tlet unloadHandler = this.isDesktop() ? this.#onWindowUnload : this._onBeforeUnloadHandler;\n\t\twindow.removeEventListener('beforeunload', unloadHandler);\n\t\tBX.removeCustomEvent(window, \"onLocalStorageSet\", this.#onExternalEvent);\n\t\tBX.removeCustomEvent(\"onPullEvent-crm\", this._onPullEventCrmHandler);\n\n\t\tthis.init();\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.popup && this.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.reinit();\n\t\t}\n\n\t\tif (!this.isDesktop() && !this.isFolded())\n\t\t{\n\t\t\tthis.disableDocumentScroll();\n\t\t}\n\n\t\tthis.popup.show();\n\t\tBX.localStorage.set(lsKeys.callView, this.callId, 86400);\n\n\t\treturn this;\n\t};\n\n\tcreatePopup(): Popup\n\t{\n\t\treturn new Popup({\n\t\t\tid: this.getId(),\n\t\t\tbindElement: null,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.elements.main,\n\t\t\tcloseIcon: false,\n\t\t\tnoAllPaddings: true,\n\t\t\tzIndex: baseZIndex,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: false,\n\t\t\tdraggable: {restrict: false},\n\t\t\toverlay: {backgroundColor: 'black', opacity: 30},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () =>\n\t\t\t\t{\n\t\t\t\t\tif (this.isFolded())\n\t\t\t\t\t{\n\t\t\t\t\t\t// this.destroy();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callbacks.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () => this.popup = null\n\t\t\t}\n\t\t});\n\t};\n\n\tcreateLayout()\n\t{\n\t\tif (this.isFolded())\n\t\t{\n\t\t\treturn this.createLayoutFolded();\n\t\t}\n\t\telse if (this.currentLayout == layouts.crm)\n\t\t{\n\t\t\treturn this.createLayoutCrm();\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.createLayoutSimple();\n\t\t}\n\t};\n\n\tcreateLayoutCrm()\n\t{\n\t\tvar result = Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-top-level'},\n\t\t\tevents: {\n\t\t\t\tdblclick: this._onDblClickHandler\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.topLevelButtonsContainer = Dom.create(\"div\"),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-wrapper' + (this.hasSideBar() ? '' : ' im-phone-call-wrapper-without-sidebar')},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-container' + (this.hasSideBar() ? '' : ' im-phone-call-container-without-sidebar')},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-header-container'}, children: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-header'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.title = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-title-text'},\n\t\t\t\t\t\t\t\t\t\t\t\t\thtml: this.renderTitle()\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.crmCard = Dom.create(\"div\", {props: {className: 'im-phone-call-crm-card'}}),\n\t\t\t\t\t\t\t\tthis.elements.sections.status = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'},\n\t\t\t\t\t\t\t\t\tstyle: this.sections.status.visible ? {} : {display: 'none'},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-status-description'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.status = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-status-description-item'},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: this.statusText\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.sections.timer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'},\n\t\t\t\t\t\t\t\t\tstyle: this.sections.timer.visible ? {} : {display: 'none'},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-status-timer'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-status-timer-item'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.timer = Dom.create(\"span\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.commentEditorContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'},\n\t\t\t\t\t\t\t\t\tstyle: this.commentShown ? {} : {display: 'none'},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-comments'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.commentEditor = Dom.create(\"textarea\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'im-phone-call-comments-textarea',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: this.comment,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder: Loc.getMessage('IM_PHONE_CALL_COMMENT_PLACEHOLDER')\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbxchange: this._onCommentChanged.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.sections.crmButtons = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'},\n\t\t\t\t\t\t\t\t\tstyle: this.sections.crmButtons.visible ? {} : {display: 'none'},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.crmButtonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-crm-buttons'}})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.buttonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-buttons-container'}}),\n\t\t\t\t\t\t\t\tthis.elements.topButtonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-buttons-container-top'}})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.hasSideBar())\n\t\t{\n\t\t\tthis.createSidebarLayout();\n\t\t\tif (this.elements.sidebarContainer)\n\t\t\t{\n\t\t\t\tresult.appendChild(this.elements.sidebarContainer);\n\t\t\t}\n\n\t\t\tsetTimeout(() => this.checkMoreButton(), 0);\n\t\t}\n\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\tresult.style.position = 'fixed';\n\t\t\tresult.style.top = 0;\n\t\t\tresult.style.bottom = 0;\n\t\t\tresult.style.left = 0;\n\t\t\tresult.style.right = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.style.width = this.getInitialWidth() + 'px';\n\t\t\tresult.style.height = this.getInitialHeight() + 'px';\n\t\t}\n\n\t\treturn result;\n\t};\n\n\t/**\n\t * @return boolean\n\t */\n\thasSideBar()\n\t{\n\t\tif (this.isDesktop() && !this.desktop.isFeatureSupported('iframe'))\n\t\t{\n\t\t\treturn this.callListId > 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn (this.callListId > 0 || this.webformId > 0 || this.restApps.length > 0);\n\t\t}\n\t};\n\n\tgetInitialWidth()\n\t{\n\t\tconst storedWidth = (window.localStorage) ? parseInt(window.localStorage.getItem(lsKeys.width)) : 0;\n\n\t\tif (this.currentLayout == layouts.simple)\n\t\t{\n\t\t\treturn initialSize.simple.width;\n\t\t}\n\t\telse if (this.hasSideBar())\n\t\t{\n\t\t\tif (storedWidth > 0)\n\t\t\t{\n\t\t\t\treturn storedWidth;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Math.min(Math.floor(screen.width * 0.8), 1200);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn initialSize.crm.width;\n\t\t}\n\t};\n\n\tgetInitialHeight()\n\t{\n\t\tconst storedHeight = (window.localStorage) ? parseInt(window.localStorage.getItem(lsKeys.height)) : 0;\n\n\t\tif (this.currentLayout == layouts.simple)\n\t\t{\n\t\t\treturn initialSize.simple.height\n\t\t}\n\t\telse if (storedHeight > 0)\n\t\t{\n\t\t\treturn storedHeight;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn initialSize.crm.height;\n\t\t}\n\t};\n\n\tsaveInitialSize(width, height)\n\t{\n\t\tif (!window.localStorage)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.currentLayout == layouts.crm)\n\t\t{\n\t\t\twindow.localStorage.setItem(lsKeys.height, height.toString());\n\t\t\tif (this.hasSideBar())\n\t\t\t{\n\t\t\t\twindow.localStorage.setItem(lsKeys.width, width);\n\t\t\t}\n\t\t}\n\t};\n\n\tshowSections(sections)\n\t{\n\t\tif (!Type.isArray(sections))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tsections.forEach((sectionName) =>\n\t\t{\n\t\t\tif (this.elements.sections[sectionName])\n\t\t\t{\n\t\t\t\tthis.elements.sections[sectionName].style.removeProperty('display');\n\t\t\t}\n\n\t\t\tif (this.sections[sectionName])\n\t\t\t{\n\t\t\t\tthis.sections[sectionName].visible = true;\n\t\t\t}\n\t\t});\n\t};\n\n\thideSections(sections)\n\t{\n\t\tif (!Type.isArray(sections))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tsections.forEach((sectionName) =>\n\t\t{\n\t\t\tif (this.elements.sections[sectionName])\n\t\t\t{\n\t\t\t\tthis.elements.sections[sectionName].style.display = 'none';\n\t\t\t}\n\n\t\t\tif (this.sections[sectionName])\n\t\t\t{\n\t\t\t\tthis.sections[sectionName].visible = false;\n\t\t\t}\n\t\t});\n\t};\n\n\tshowOnlySections(sections)\n\t{\n\t\tif (!Type.isArray(sections))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet sectionsIndex = {};\n\t\tsections.forEach(sectionName => sectionsIndex[sectionName] = true);\n\n\t\tfor (var sectionName in this.elements.sections)\n\t\t{\n\t\t\tif (!this.elements.sections.hasOwnProperty(sectionName) || !Type.isDomNode(this.elements.sections[sectionName]))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (sectionsIndex[sectionName])\n\t\t\t{\n\t\t\t\tthis.elements.sections[sectionName].style.removeProperty('display');\n\t\t\t\tif (this.sections.hasOwnProperty(sectionName))\n\t\t\t\t{\n\t\t\t\t\tthis.sections[sectionName].visible = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.sections[sectionName].style.display = 'none';\n\t\t\t\tif (this.sections.hasOwnProperty(sectionName))\n\t\t\t\t{\n\t\t\t\t\tthis.sections[sectionName].visible = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tcreateSidebarLayout()\n\t{\n\t\tlet tabs = [];\n\t\tlet tabsBody = [];\n\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\tthis.elements.tabs.callList = Dom.create(\"span\", {\n\t\t\t\tprops: {className: 'im-phone-sidebar-tab'},\n\t\t\t\tdataset: {tabId: 'callList', tabBodyId: 'callList'},\n\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_CALL_LIST_TITLE'),\n\t\t\t\tevents: {click: this._onTabHeaderClick.bind(this)}\n\t\t\t});\n\t\t\ttabs.push(this.elements.tabs.callList);\n\t\t\tthis.elements.tabsBody.callList = Dom.create('div');\n\t\t\ttabsBody.push(this.elements.tabsBody.callList);\n\t\t}\n\n\t\tif (this.webformId > 0 && this.isWebformSupported())\n\t\t{\n\t\t\tthis.elements.tabs.webform = Dom.create(\"span\", {\n\t\t\t\tprops: {className: 'im-phone-sidebar-tab'},\n\t\t\t\tdataset: {tabId: 'webform', tabBodyId: 'webform'},\n\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_WEBFORM_TITLE'),\n\t\t\t\tevents: {click: this._onTabHeaderClick.bind(this)}\n\t\t\t});\n\t\t\ttabs.push(this.elements.tabs.webform);\n\t\t\tthis.elements.tabsBody.webform = Dom.create('div', {props: {className: 'im-phone-call-form-container'}});\n\t\t\ttabsBody.push(this.elements.tabsBody.webform);\n\n\t\t\tthis.formManager = new FormManager({\n\t\t\t\tnode: this.elements.tabsBody.webform,\n\t\t\t\tonFormSend: this._onFormSend.bind(this)\n\t\t\t})\n\t\t}\n\n\t\tif (this.restApps.length > 0 && this.isRestAppsSupported())\n\t\t{\n\t\t\tthis.restApps.forEach((restApp) =>\n\t\t\t{\n\t\t\t\tconst restAppId = restApp.id;\n\t\t\t\tconst tabId = 'restApp' + restAppId;\n\t\t\t\tthis.elements.tabs[tabId] = Dom.create(\"span\", {\n\t\t\t\t\tprops: {className: 'im-phone-sidebar-tab'},\n\t\t\t\t\tdataset: {tabId: tabId, tabBodyId: 'app', restAppId: restAppId},\n\t\t\t\t\ttext: Text.encode(restApp.name),\n\t\t\t\t\tevents: {click: this._onTabHeaderClick.bind(this)}\n\t\t\t\t});\n\t\t\t\ttabs.push(this.elements.tabs[tabId]);\n\n\t\t\t});\n\t\t\tthis.elements.tabsBody.app = Dom.create('div', {props: {className: 'im-phone-call-app-container'}});\n\t\t\ttabsBody.push(this.elements.tabsBody.app);\n\t\t}\n\n\t\tthis.elements.sidebarContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-sidebar-wrap'}, children: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-sidebar-tabs-container'}, children: [\n\t\t\t\t\t\tthis.elements.tabsContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-sidebar-tabs-left'},\n\t\t\t\t\t\t\tchildren: tabs\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-sidebar-tabs-right'}, children: [\n\t\t\t\t\t\t\t\tthis.elements.moreTabs = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-sidebar-tab im-phone-sidebar-tab-more'},\n\t\t\t\t\t\t\t\t\tstyle: {display: 'none'},\n\t\t\t\t\t\t\t\t\tdataset: {},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_MORE'),\n\t\t\t\t\t\t\t\t\tevents: {click: this._onTabMoreClick.bind(this)}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.elements.tabsBodyContainer = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-sidebar-tabs-body-container'},\n\t\t\t\t\tchildren: tabsBody\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\tthis.setActiveTab({tabId: 'callList', tabBodyId: 'callList'});\n\t\t}\n\t\telse if (this.webformId > 0 && this.isWebformSupported())\n\t\t{\n\t\t\tthis.setActiveTab({tabId: 'webform', tabBodyId: 'webform'});\n\t\t}\n\t\telse if (this.restApps.length > 0 && this.isRestAppsSupported())\n\t\t{\n\t\t\tthis.setActiveTab({\n\t\t\t\ttabId: 'restApp' + this.restApps[0].id,\n\t\t\t\ttabBodyId: 'app',\n\t\t\t\trestAppId: this.restApps[0].id\n\t\t\t});\n\t\t}\n\t};\n\n\tcreateLayoutSimple()\n\t{\n\t\tvar portalCallUserImage = '';\n\t\tif (this.isPortalCall()\n\t\t\t&& this.portalCallData.hrphoto\n\t\t\t&& this.portalCallData.hrphoto[this.portalCallUserId]\n\t\t\t&& this.portalCallData.hrphoto[this.portalCallUserId] != blankAvatar\n\t\t)\n\t\t{\n\t\t\tportalCallUserImage = this.portalCallData.hrphoto[this.portalCallUserId];\n\t\t}\n\t\tvar result = Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-wrapper'}, children: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-container'}, children: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-section'}, children: [\n\t\t\t\t\t\t\t\tthis.elements.title = Dom.create(\"div\", {props: {className: 'im-phone-calling-text'}})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section im-phone-calling-progress-section'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-progress-container'}, children: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-progress-container-block-l'},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {props: {className: 'im-phone-calling-progress-phone'}})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.progress = Dom.create(\"div\", {props: {className: 'im-phone-calling-progress-container-block-c'}}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-progress-container-block-r'},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-progress-customer'},\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: Type.isStringFilled(portalCallUserImage) ? {'background-image': 'url(\\'' + portalCallUserImage + '\\')'} : {}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'}, children: [\n\t\t\t\t\t\t\t\tthis.elements.status = Dom.create(\"div\", {props: {className: 'im-phone-calling-process-status'}})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.buttonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-buttons-container'}}),\n\t\t\t\t\t\tthis.elements.topButtonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-buttons-container-top'}})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tresult.style.width = this.getInitialWidth() + 'px';\n\t\tresult.style.height = this.getInitialHeight() + 'px';\n\n\t\treturn result;\n\t};\n\n\tcreateLayoutFolded()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"im-phone-call-panel-mini\"},\n\t\t\tstyle: {zIndex: baseZIndex},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.sections.timer = this.elements.timer = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"im-phone-call-panel-mini-time\"},\n\t\t\t\t\tstyle: this.sections.timer.visible ? {} : {display: 'none'}\n\t\t\t\t}),\n\t\t\t\tthis.elements.buttonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-panel-mini-buttons'}}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"im-phone-call-panel-mini-expand\"},\n\t\t\t\t\tevents: {click: () => this.unfold()}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\tsetActiveTab(params)\n\t{\n\t\tconst tabId = params.tabId;\n\t\tconst tabBodyId = params.tabBodyId;\n\t\tconst restAppId = params.restAppId || '';\n\t\tparams.hidden = params.hidden === true;\n\t\tfor (let tab in this.elements.tabs)\n\t\t{\n\t\t\tif (this.elements.tabs.hasOwnProperty(tab) && Type.isDomNode(this.elements.tabs[tab]))\n\t\t\t{\n\t\t\t\tthis.elements.tabs[tab].classList.toggle('im-phone-sidebar-tab-active', tab == tabId)\n\t\t\t}\n\t\t}\n\n\t\tthis.elements.moreTabs.classList.toggle('im-phone-sidebar-tab-active', params.hidden);\n\n\t\tfor (let tab in this.elements.tabsBody)\n\t\t{\n\t\t\tif (this.elements.tabsBody.hasOwnProperty(tab) && Type.isDomNode(this.elements.tabsBody[tab]))\n\t\t\t{\n\t\t\t\tif (tab == tabBodyId)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.tabsBody[tab].style.removeProperty('display');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.elements.tabsBody[tab].style.display = 'none';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.currentTabName = tabId;\n\n\t\tif (tabId === 'webform' && !this.webformLoaded)\n\t\t{\n\t\t\tthis.loadForm({\n\t\t\t\tid: this.webformId,\n\t\t\t\tsecCode: this.webformSecCode\n\t\t\t})\n\t\t}\n\n\t\tif (restAppId !== '')\n\t\t{\n\t\t\tthis.loadRestApp({\n\t\t\t\tid: restAppId,\n\t\t\t\tcallId: this.callId,\n\t\t\t\tnode: this.elements.tabsBody.app\n\t\t\t});\n\t\t}\n\t};\n\n\tisCurrentTabHidden()\n\t{\n\t\tlet result = false;\n\t\tfor (let i = 0; i < this.hiddenTabs.length; i++)\n\t\t{\n\t\t\tif (this.hiddenTabs[i].dataset.tabId == this.currentTabName)\n\t\t\t{\n\t\t\t\tresult = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tcheckMoreButton()\n\t{\n\t\tif (!this.elements.tabsContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar tabs = this.elements.tabsContainer.children;\n\t\tvar currentTab;\n\t\tthis.hiddenTabs = [];\n\n\t\tfor (var i = 0; i < tabs.length; i++)\n\t\t{\n\t\t\tcurrentTab = tabs.item(i);\n\t\t\tif (currentTab.offsetTop > 7)\n\t\t\t{\n\t\t\t\tthis.hiddenTabs.push(currentTab);\n\t\t\t}\n\t\t}\n\t\tif (this.hiddenTabs.length > 0)\n\t\t{\n\t\t\tthis.elements.moreTabs.style.removeProperty('display');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.moreTabs.style.display = 'none';\n\t\t}\n\n\t\tif (this.isCurrentTabHidden())\n\t\t{\n\t\t\tDom.addClass(this.elements.moreTabs, 'im-phone-sidebar-tab-active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.elements.moreTabs, 'im-phone-sidebar-tab-active');\n\t\t}\n\t};\n\n\t_onTabHeaderClick(e)\n\t{\n\t\tif (this.moreTabsMenu)\n\t\t{\n\t\t\tthis.moreTabsMenu.close();\n\t\t}\n\n\t\tthis.setActiveTab({\n\t\t\ttabId: e.target.dataset.tabId,\n\t\t\ttabBodyId: e.target.dataset.tabBodyId,\n\t\t\trestAppId: e.target.dataset.restAppId || '',\n\t\t\thidden: false\n\t\t});\n\t};\n\n\t_onTabMoreClick()\n\t{\n\t\tif (this.hiddenTabs.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.moreTabsMenu)\n\t\t{\n\t\t\tthis.moreTabsMenu.close();\n\t\t\treturn;\n\t\t}\n\n\t\tvar menuItems = [];\n\t\tthis.hiddenTabs.forEach((tabElement) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: \"selectTab_\" + tabElement.dataset.tabId,\n\t\t\t\ttext: tabElement.innerText,\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.moreTabsMenu.close();\n\t\t\t\t\tthis.setActiveTab({\n\t\t\t\t\t\ttabId: tabElement.dataset.tabId,\n\t\t\t\t\t\ttabBodyId: tabElement.dataset.tabBodyId,\n\t\t\t\t\t\trestAppId: tabElement.dataset.restAppId || '',\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.moreTabsMenu = new Menu(\n\t\t\t'phoneCallViewMoreTabs',\n\t\t\tthis.elements.moreTabs,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tangle: {position: \"top\"},\n\t\t\t\tzIndex: baseZIndex + 100,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.moreTabsMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.moreTabsMenu = null\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.moreTabsMenu.show();\n\t};\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t};\n\n\tcreateTitle()\n\t{\n\t\tlet callTitle = '';\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tBX.PhoneNumberParser.getInstance().parse(this.phoneNumber).then((parsedNumber) =>\n\t\t\t{\n\t\t\t\tif (this.phoneNumber == 'unknown')\n\t\t\t\t{\n\t\t\t\t\tresolve(Loc.getMessage('IM_PHONE_CALL_VIEW_NUMBER_UNKNOWN'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (this.phoneNumber == 'hidden')\n\t\t\t\t{\n\t\t\t\t\tcallTitle = Loc.getMessage('IM_PHONE_HIDDEN_NUMBER');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcallTitle = this.phoneNumber.toString();\n\n\t\t\t\t\tif (parsedNumber.isValid())\n\t\t\t\t\t{\n\t\t\t\t\t\tcallTitle = parsedNumber.format();\n\n\t\t\t\t\t\tif (parsedNumber.isInternational() && callTitle.charAt(0) != '+')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcallTitle = '+' + callTitle;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcallTitle = this.phoneNumber.toString();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (this.isCallback())\n\t\t\t\t{\n\t\t\t\t\tcallTitle = Loc.getMessage('IM_PHONE_CALLBACK_TO').replace('#PHONE#', callTitle);\n\t\t\t\t}\n\t\t\t\telse if (this.isPortalCall())\n\t\t\t\t{\n\t\t\t\t\tswitch (this.direction)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase Direction.incoming:\n\t\t\t\t\t\t\tif (this.portalCallUserId)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcallTitle = Loc.getMessage(\"IM_M_CALL_VOICE_FROM\").replace('#USER#', this.portalCallData.users[this.portalCallUserId].name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase Direction.outgoing:\n\t\t\t\t\t\t\tif (this.portalCallUserId)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcallTitle = Loc.getMessage(\"IM_M_CALL_VOICE_TO\").replace('#USER#', this.portalCallData.users[this.portalCallUserId].name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcallTitle = Loc.getMessage(\"IM_M_CALL_VOICE_TO\").replace('#USER#', this.portalCallQueueName) + ' (' + this.phoneNumber + ')';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcallTitle = Loc.getMessage(this.direction === Direction.incoming ? 'IM_PHONE_CALL_VOICE_FROM' : 'IM_PHONE_CALL_VOICE_TO').replace('#PHONE#', callTitle);\n\n\t\t\t\t\tif (this.direction === Direction.incoming && this.companyPhoneNumber)\n\t\t\t\t\t{\n\t\t\t\t\t\tcallTitle = callTitle + ', ' + Loc.getMessage('IM_PHONE_CALL_TO_PHONE').replace('#PHONE#', this.companyPhoneNumber);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isTransfer())\n\t\t\t\t\t{\n\t\t\t\t\t\tcallTitle = callTitle + ' ' + Loc.getMessage('IM_PHONE_CALL_TRANSFERED');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresolve(callTitle);\n\t\t\t});\n\t\t})\n\t};\n\n\trenderTitle()\n\t{\n\t\treturn Text.encode(this.title);\n\t};\n\n\trenderAvatar()\n\t{\n\t\tlet portalCallUserImage = '';\n\t\tif (this.isPortalCall()\n\t\t\t&& this.elements.avatar\n\t\t\t&& this.portalCallData.hrphoto\n\t\t\t&& this.portalCallData.hrphoto[this.portalCallUserId]\n\t\t\t&& this.portalCallData.hrphoto[this.portalCallUserId] != blankAvatar\n\t\t)\n\t\t{\n\t\t\tportalCallUserImage = this.portalCallData.hrphoto[this.portalCallUserId];\n\n\t\t\tDom.adjust(this.elements.avatar, {\n\t\t\t\tstyle: portalCallUserImage === '' ? {} : {'background-image': 'url(\\'' + portalCallUserImage + '\\')'}\n\t\t\t});\n\t\t}\n\t};\n\n\t_getCrmEditUrl(entityTypeName, entityId)\n\t{\n\t\tif (!Type.isStringFilled(entityTypeName))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tentityId = Number(entityId);\n\n\t\treturn '/crm/' + entityTypeName.toLowerCase() + '/edit/' + entityId.toString() + '/';\n\t};\n\n\t_generateExternalContext()\n\t{\n\t\treturn this._getRandomString(16);\n\t};\n\n\t_getRandomString(len)\n\t{\n\t\tconst charSet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\t\tlet randomString = '';\n\t\tfor (let i = 0; i < len; i++)\n\t\t{\n\t\t\tconst randomPoz = Math.floor(Math.random() * charSet.length);\n\t\t\trandomString += charSet.substring(randomPoz, randomPoz + 1);\n\t\t}\n\t\treturn randomString;\n\t};\n\n\tsetPhoneNumber(phoneNumber)\n\t{\n\t\tthis.phoneNumber = phoneNumber;\n\t\tthis.setOnSlave(desktopEvents.setPhoneNumber, [phoneNumber]);\n\t};\n\n\tsetTitle(title)\n\t{\n\t\tthis.title = title;\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\tif (this.slave)\n\t\t\t{\n\t\t\t\tBXDesktopWindow.SetProperty('title', title);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.setTitle, [title]);\n\t\t\t}\n\t\t}\n\n\t\tif (this.elements.title)\n\t\t{\n\t\t\tthis.elements.title.innerHTML = this.renderTitle();\n\t\t}\n\t};\n\n\tgetTitle()\n\t{\n\t\treturn this.title;\n\t};\n\n\tsetQuality(quality)\n\t{\n\t\tthis.quality = quality;\n\n\t\tif (this.elements.qualityMeter)\n\t\t{\n\t\t\tthis.elements.qualityMeter.style.width = this.getQualityMeterWidth();\n\t\t}\n\t};\n\n\tgetQualityMeterWidth(): string\n\t{\n\t\tif (this.quality > 0 && this.quality <= 5)\n\t\t{\n\t\t\treturn this.quality * 20 + '%';\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn '0';\n\t\t}\n\t};\n\n\tsetProgress(progress: $Keys<typeof CallProgress>)\n\t{\n\t\tif (this.progress === progress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.progress = progress;\n\n\t\tif (!this.elements.progress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.clean(this.elements.progress);\n\t\tthis.elements.progress.appendChild(this.renderProgress(this.progress));\n\t};\n\n\tsetStatusText(statusText)\n\t{\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.setStatus, [statusText]);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.statusText = statusText;\n\t\tif (this.elements.status)\n\t\t{\n\t\t\tthis.elements.status.innerText = this.statusText;\n\t\t}\n\t};\n\n\tsetConfig(config)\n\t{\n\t\tif (!Type.isPlainObject(config))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.config = config;\n\t\tif (!this.isDesktop() || this.slave)\n\t\t{\n\t\t\tthis.renderCrmButtons();\n\t\t}\n\t\tthis.setOnSlave(desktopEvents.setConfig, [config]);\n\t};\n\n\tsetCallId(callId)\n\t{\n\t\tthis.callId = callId;\n\t\tthis.setOnSlave(desktopEvents.setCallId, [callId]);\n\t};\n\n\tsetLineNumber(lineNumber)\n\t{\n\t\tthis.lineNumber = lineNumber;\n\t\tthis.setOnSlave(desktopEvents.setLineNumber, [lineNumber]);\n\t};\n\n\tsetCompanyPhoneNumber(companyPhoneNumber)\n\t{\n\t\tthis.companyPhoneNumber = companyPhoneNumber;\n\t\tthis.setOnSlave(desktopEvents.setCompanyPhoneNumber, [companyPhoneNumber]);\n\t};\n\n\tsetButtons(buttons, layout)\n\t{\n\t\tif (!ButtonLayouts[layout])\n\t\t{\n\t\t\tlayout = ButtonLayouts.centered;\n\t\t}\n\n\t\tthis.buttonLayout = layout;\n\t\tthis.buttons = buttons;\n\t\tthis.renderButtons();\n\t};\n\n\tsetUiState(uiState)\n\t{\n\t\tthis._uiState = uiState;\n\n\t\tvar stateButtons = this.getUiStateButtons(uiState);\n\t\tthis.buttons = stateButtons.buttons;\n\t\tthis.buttonLayout = stateButtons.layout;\n\n\t\tswitch (uiState)\n\t\t{\n\t\t\tcase UiState.incoming:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferIncoming:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.outgoing:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t\tcase UiState.connectingIncoming:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.connectingOutgoing:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.showCallIcon();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.connected:\n\t\t\t\tif (this.deviceCall)\n\t\t\t\t{\n\t\t\t\t\tthis.setClosable(true);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setClosable(false);\n\t\t\t\t}\n\n\t\t\t\tthis.showSections(['status', 'timer']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.showCallIcon();\n\t\t\t\tthis.startTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferring:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showSections(['status', 'timer']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tbreak;\n\t\t\tcase UiState.idle:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tbreak;\n\t\t\tcase UiState.error:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t\tcase UiState.moneyError:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t\tcase UiState.sipPhoneError:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t\tcase UiState.redial:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.setUiState, [uiState]);\n\t\t\treturn;\n\t\t}\n\t\tthis.renderButtons();\n\t};\n\n\t/**\n\t * @param {string} callState\n\t * @param {object} additionalParams\n\t * @see CallState\n\t */\n\tsetCallState(callState, additionalParams)\n\t{\n\t\tif (this.callState === callState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callState = callState;\n\n\t\tif (!Type.isPlainObject(additionalParams))\n\t\t{\n\t\t\tadditionalParams = {};\n\t\t}\n\n\t\tthis.renderButtons();\n\t\tif (callState === CallState.connected && this.isAutoFoldAllowed())\n\t\t{\n\t\t\tthis.fold();\n\t\t}\n\n\t\tBX.onCustomEvent(window, \"CallCard::CallStateChanged\", [callState, additionalParams]);\n\t\tthis.setOnSlave(desktopEvents.setCallState, [callState, additionalParams]);\n\t};\n\n\tisAutoFoldAllowed()\n\t{\n\t\treturn (this.autoFold === true && !this.isDesktop() && !this.isFolded() && this.restApps.length === 0);\n\t};\n\n\tisHeld()\n\t{\n\t\treturn this.held;\n\t};\n\n\tsetHeld(held)\n\t{\n\t\tthis.held = held;\n\t};\n\n\tsetRecording(recording)\n\t{\n\t\tthis.recording = recording;\n\t};\n\n\tisRecording()\n\t{\n\t\treturn this.recording;\n\t};\n\n\tisMuted()\n\t{\n\t\treturn this.muted;\n\t};\n\n\tsetMuted(muted)\n\t{\n\t\tthis.muted = muted;\n\t};\n\n\tisTransfer()\n\t{\n\t\treturn this.transfer;\n\t};\n\n\tsetTransfer(transfer)\n\t{\n\t\ttransfer = (transfer === true);\n\t\tif (this.transfer == transfer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.transfer = transfer;\n\t\tthis.setOnSlave(desktopEvents.setTransfer, [transfer]);\n\t\tthis.setUiState(this._uiState);\n\t};\n\n\tisCallback()\n\t{\n\t\treturn (this.direction === Direction.callback);\n\t};\n\n\tisPortalCall()\n\t{\n\t\treturn this.portalCall;\n\t};\n\n\tsetCallback(eventName, callback)\n\t{\n\t\tif (!this.callbacks.hasOwnProperty(eventName))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.callbacks[eventName] = Type.isFunction(callback) ? callback : nop;\n\t};\n\n\tsetDeviceCall(deviceCall)\n\t{\n\t\tthis.deviceCall = deviceCall;\n\n\t\tif (this.elements.buttons.sipPhone)\n\t\t{\n\t\t\tif (deviceCall)\n\t\t\t{\n\t\t\t\tDom.addClass(this.elements.buttons.sipPhone, 'active');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(this.elements.buttons.sipPhone, 'active');\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.setDeviceCall, [deviceCall]);\n\t\t}\n\t};\n\n\tsetCrmEntity(params)\n\t{\n\t\tthis.crmEntityType = params.type;\n\t\tthis.crmEntityId = params.id;\n\t\tthis.crmActivityId = params.activityId || '';\n\t\tthis.crmActivityEditUrl = params.activityEditUrl || '';\n\t\tthis.crmBindings = Type.isArray(params.bindings) ? params.bindings : [];\n\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.setCrmEntity, [params]);\n\t\t}\n\t};\n\n\tsetCrmData(crmData)\n\t{\n\t\tif (!Type.isPlainObject(crmData))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.crm = true;\n\t\tthis.crmData = crmData;\n\t};\n\n\tloadCrmCard(entityType, entityId)\n\t{\n\t\tBX.onCustomEvent(window, 'CallCard::EntityChanged', [{\n\t\t\t'CRM_ENTITY_TYPE': entityType,\n\t\t\t'CRM_ENTITY_ID': entityId,\n\t\t\t'PHONE_NUMBER': this.phoneNumber\n\t\t}]);\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.entityChanged, {\n\t\t\t'CRM_ENTITY_TYPE': entityType,\n\t\t\t'CRM_ENTITY_ID': entityId,\n\t\t\t'PHONE_NUMBER': this.phoneNumber\n\t\t});\n\n\t\tBX.ajax.runAction(\"voximplant.callview.getCrmCard\", {\n\t\t\tdata: {\n\t\t\t\tentityType: entityType,\n\t\t\t\tentityId: entityId\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (this.currentLayout == layouts.simple)\n\t\t\t{\n\t\t\t\tthis.currentLayout = layouts.crm;\n\t\t\t\tthis.crm = true;\n\t\t\t\tvar newMainElement = this.createLayoutCrm();\n\n\t\t\t\tthis.elements.main.parentNode.replaceChild(newMainElement, this.elements.main);\n\t\t\t\tthis.elements.main = newMainElement;\n\t\t\t\tthis.setUiState(this._uiState);\n\t\t\t\tthis.setStatusText(this.statusText);\n\t\t\t}\n\n\t\t\tif (this.elements.crmCard)\n\t\t\t{\n\t\t\t\tBX.html(this.elements.crmCard, response.data.html);\n\t\t\t\tsetTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tif (this.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.resizeWindow(this.getInitialWidth(), this.getInitialHeight());\n\t\t\t\t\t}\n\t\t\t\t\tthis.adjust();\n\t\t\t\t\tthis.bindCrmCardEvents();\n\t\t\t\t}, 100);\n\t\t\t}\n\n\t\t\tthis.renderCrmButtons();\n\t\t}).catch((response) => console.error(\"Could not load crm card: \", response.errors[0]));\n\t};\n\n\treloadCrmCard()\n\t{\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.reloadCrmCard, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.loadCrmCard(this.crmEntityType, this.crmEntityId);\n\t\t}\n\t};\n\n\tbindCrmCardEvents()\n\t{\n\t\tif (!this.elements.crmCard)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!BX.Crm || !BX.Crm.Page)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar anchors = this.elements.crmCard.querySelectorAll('a[data-use-slider=Y]');\n\t\tfor (var i = 0; i < anchors.length; i++)\n\t\t{\n\t\t\tBX.bind(anchors[i], 'click', this.onCrmAnchorClick.bind(this));\n\t\t}\n\t};\n\n\tonCrmAnchorClick(e)\n\t{\n\t\tif (BX.Crm.Page.isSliderEnabled(e.currentTarget.href))\n\t\t{\n\t\t\tif (!this.isFolded())\n\t\t\t{\n\t\t\t\tthis.fold();\n\t\t\t}\n\t\t}\n\t};\n\n\tsetPortalCallUserId(userId)\n\t{\n\t\tthis.portalCallUserId = userId;\n\t\tthis.setOnSlave(desktopEvents.setPortalCallUserId, [userId]);\n\n\t\tif (this.portalCallData && this.portalCallData.users[this.portalCallUserId])\n\t\t{\n\t\t\tthis.renderAvatar();\n\t\t\tthis.createTitle().then(title => this.setTitle(title));\n\t\t}\n\t};\n\n\tsetPortalCallQueueName(queueName)\n\t{\n\t\tthis.portalCallQueueName = queueName;\n\t\tthis.setOnSlave(desktopEvents.setPortalCallQueueName, [queueName]);\n\n\t\tthis.createTitle().then(title => this.setTitle(title));\n\t};\n\n\tsetPortalCall(portalCall)\n\t{\n\t\tthis.portalCall = (portalCall === true);\n\t\tthis.setOnSlave(desktopEvents.setPortalCall, [portalCall]);\n\t};\n\n\tsetPortalCallData(data)\n\t{\n\t\tthis.portalCallData = data;\n\t\tthis.setOnSlave(desktopEvents.setPortalCallData, [data]);\n\t};\n\n\tsetOnSlave(message, parameters)\n\t{\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(message, parameters);\n\t\t}\n\t};\n\n\tupdateView()\n\t{\n\t\tif (this.elements.title)\n\t\t{\n\t\t\tthis.elements.title.innerHTML = this.renderTitle();\n\t\t}\n\n\t\tif (this.elements.progress)\n\t\t{\n\t\t\tDom.clean(this.elements.progress);\n\t\t\tthis.elements.progress.appendChild(this.renderProgress(this.progress));\n\t\t}\n\n\t\tif (this.elements.status)\n\t\t{\n\t\t\tthis.elements.status.innerText = this.statusText;\n\t\t}\n\n\t\tthis.renderButtons();\n\t\tthis.renderTimer();\n\t};\n\n\trenderProgress(progress: $Keys<typeof CallProgress>): HTMLElement\n\t{\n\t\tlet result;\n\t\tswitch (progress)\n\t\t{\n\t\t\tcase CallProgress.connect:\n\t\t\t\tresult = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-call-overlay-progress'}, children: [\n\t\t\t\t\t\tDom.create(\"img\", {props: {className: 'bx-messenger-call-overlay-progress-status bx-messenger-call-overlay-progress-status-anim-1'}}),\n\t\t\t\t\t\tDom.create(\"img\", {props: {className: 'bx-messenger-call-overlay-progress-status bx-messenger-call-overlay-progress-status-anim-2'}})\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase CallProgress.online:\n\t\t\t\tresult = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-call-overlay-progress bx-messenger-call-overlay-progress-online'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"img\", {props: {className: 'bx-messenger-call-overlay-progress-status bx-messenger-call-overlay-progress-status-anim-3'}})\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase CallProgress.error:\n\t\t\t\tprogress = CallProgress.offline;\n\t\t\t// fallthrough to default\n\t\t\tdefault:\n\t\t\t\tresult = Dom.create(\"div\", {props: {className: 'bx-messenger-call-overlay-progress bx-messenger-call-overlay-progress-' + progress}});\n\t\t}\n\n\t\treturn result;\n\t};\n\n\t/**\n\t * @param uiState UiState\n\t * @returns object {buttons: string[], layout: string}\n\t */\n\tgetUiStateButtons(uiState)\n\t{\n\t\tvar result = {\n\t\t\tbuttons: [],\n\t\t\tlayout: ButtonLayouts.centered\n\t\t};\n\t\tswitch (uiState)\n\t\t{\n\t\t\tcase UiState.incoming:\n\t\t\t\tresult.buttons = ['answer', 'skip'];\n\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferIncoming:\n\t\t\t\tresult.buttons = ['answer', 'skip'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.outgoing:\n\t\t\t\tresult.buttons = ['call'];\n\n\t\t\t\tif (this.callListId > 0)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('next');\n\t\t\t\t\tresult.buttons.push('fold');\n\n\t\t\t\t\tif (!this.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.buttons.push('topClose');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UiState.connectingIncoming:\n\t\t\t\tresult.buttons = ['hangup'];\n\n\t\t\t\tbreak;\n\t\t\tcase UiState.connectingOutgoing:\n\t\t\t\tif (this.hasSipPhone)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('sipPhone');\n\t\t\t\t}\n\t\t\t\tresult.buttons.push('hangup');\n\t\t\t\tbreak;\n\t\t\tcase UiState.error:\n\t\t\t\tif (this.hasSipPhone)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('sipPhone');\n\t\t\t\t}\n\t\t\t\tif (this.callListId > 0)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('redial', 'next', 'topClose');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('close');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UiState.moneyError:\n\t\t\t\tresult.buttons = ['notifyAdmin', 'close'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.sipPhoneError:\n\t\t\t\tresult.buttons = ['sipPhone', 'close'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.connected:\n\t\t\t\tresult.buttons = this.isTransfer() ? [] : ['hold'];\n\t\t\t\tif (!this.deviceCall)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('mute', 'qualityMeter');\n\t\t\t\t}\n\t\t\t\tresult.buttons.push('fold');\n\n\t\t\t\tif (!this.callListId && !this.isTransfer())\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('transfer');\n\t\t\t\t}\n\n\t\t\t\tif (this.deviceCall)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('close');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('dialpad', 'hangup');\n\t\t\t\t}\n\n\t\t\t\tresult.layout = ButtonLayouts.spaced;\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferring:\n\t\t\t\tresult.buttons = ['transferComplete', 'transferCancel'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferFailed:\n\t\t\t\tresult.buttons = ['transferCancel'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferConnected:\n\t\t\t\tresult.buttons = ['hangup'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.idle:\n\t\t\t\tif (this.hasSipPhone)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons = ['close'];\n\t\t\t\t}\n\t\t\t\telse if (this.direction == Direction.incoming)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons = ['close'];\n\t\t\t\t}\n\t\t\t\telse if (this.direction == Direction.outgoing)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons = ['redial'];\n\t\t\t\t\tif (this.callListId > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.buttons.push('next');\n\t\t\t\t\t\tresult.buttons.push('fold');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.buttons.push('close');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.callListId > 0 && !this.isDesktop())\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('topClose');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UiState.redial:\n\t\t\t\tresult.buttons = ['redial'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.externalCard:\n\t\t\t\tresult.buttons = ['close'];\n\t\t\t\tresult.buttons.push('fold');\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t};\n\n\trenderButtons()\n\t{\n\t\tif (this.isFolded())\n\t\t{\n\t\t\tthis.renderButtonsFolded();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renderButtonsDefault();\n\t\t}\n\t};\n\n\trenderButtonsDefault()\n\t{\n\t\tvar buttonsFragment = document.createDocumentFragment();\n\t\tvar topButtonsFragment = document.createDocumentFragment();\n\t\tvar topLevelButtonsFragment = document.createDocumentFragment();\n\t\tvar subContainers = {\n\t\t\tleft: null,\n\t\t\tright: null\n\t\t};\n\t\tthis.elements.buttons = {};\n\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t{\n\t\t\tsubContainers.left = Dom.create('div', {props: {className: 'im-phone-call-buttons-container-left'}});\n\t\t\tsubContainers.right = Dom.create('div', {props: {className: 'im-phone-call-buttons-container-right'}});\n\t\t\tbuttonsFragment.appendChild(subContainers.left);\n\t\t\tbuttonsFragment.appendChild(subContainers.right);\n\t\t}\n\n\t\tthis.buttons.forEach((buttonName) =>\n\t\t{\n\t\t\tlet buttonNode;\n\n\t\t\tswitch (buttonName)\n\t\t\t{\n\t\t\t\tcase 'hold':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', 'im-phone-call-btn-hold', this._onHoldButtonClickHandler);\n\t\t\t\t\tif (this.isHeld())\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(buttonNode, 'active');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'mute':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', 'im-phone-call-btn-mute', this._onMuteButtonClickHandler);\n\t\t\t\t\tif (this.isMuted())\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(buttonNode, 'active');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'transfer':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', 'im-phone-call-btn-transfer', this._onTransferButtonClickHandler);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'transferComplete':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_TRANSFER'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-blue im-phone-call-btn-arrow',\n\t\t\t\t\t\tthis._onTransferCompleteButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'transferCancel':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_RETURN'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-red',\n\t\t\t\t\t\tthis._onTransferCancelButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'dialpad':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', 'im-phone-call-btn-dialpad', this._onDialpadButtonClickHandler);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'call':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_PHONE_CALL'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-green',\n\t\t\t\t\t\tthis._onMakeCallButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'answer':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_PHONE_BTN_ANSWER'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-green',\n\t\t\t\t\t\tthis._onAnswerButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'skip':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_PHONE_BTN_BUSY'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-red',\n\t\t\t\t\t\tthis._onSkipButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'hangup':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_HANGUP'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-red  im-phone-call-btn-tube',\n\t\t\t\t\t\tthis._onHangupButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.right.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'close':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_CLOSE'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-red',\n\t\t\t\t\t\tthis._onCloseButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.right.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'topClose':\n\t\t\t\t\tif (!this.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-top-close-btn'},\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onCloseButtonClickHandler\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttopLevelButtonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'notifyAdmin':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_NOTIFY_ADMIN'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-blue im-phone-call-btn-arrow',\n\t\t\t\t\t\t() =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.backgroundWorker.isUsed\n\t\t\t\t\t\t\t\t? this.backgroundWorker.emitEvent(backgroundWorkerEvents.notifyAdminButtonClick)\n\t\t\t\t\t\t\t\t: this.callbacks.notifyAdmin()\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'sipPhone':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', (this.deviceCall ? 'im-phone-call-btn-phone active' : 'im-phone-call-btn-phone'), this._onSwitchDeviceButtonClickHandler);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'qualityMeter':\n\t\t\t\t\tbuttonNode = Dom.create(\"span\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-call-btn-signal'},\n\t\t\t\t\t\tevents: {click: this._onQualityMeterClickHandler},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-btn-signal-icon-container'}, children: [\n\t\t\t\t\t\t\t\t\tDom.create(\"span\", {props: {className: 'im-phone-call-btn-signal-background'}}),\n\t\t\t\t\t\t\t\t\tthis.elements.qualityMeter = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-btn-signal-active'},\n\t\t\t\t\t\t\t\t\t\tstyle: {width: this.getQualityMeterWidth()}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t]\n\t\t\t\t\t});\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'settings':\n\t\t\t\t\t// todo\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'next':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_NEXT'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-gray im-phone-call-btn-arrow',\n\t\t\t\t\t\tthis._onNextButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'redial':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_RECALL'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-green',\n\t\t\t\t\t\tthis._onMakeCallButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'fold':\n\t\t\t\t\tif (!this.isDesktop() && this.canBeFolded())\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-btn-arrow'},\n\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_FOLD'),\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onFoldButtonClickHandler\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttopButtonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow \"Unknown button \" + buttonName;\n\t\t\t}\n\n\t\t\tif (buttonNode)\n\t\t\t{\n\t\t\t\tthis.elements.buttons[buttonName] = buttonNode;\n\t\t\t}\n\t\t});\n\t\tif (this.elements.buttonsContainer)\n\t\t{\n\t\t\tDom.clean(this.elements.buttonsContainer);\n\t\t\tthis.elements.buttonsContainer.appendChild(buttonsFragment);\n\t\t}\n\t\tif (this.elements.topButtonsContainer)\n\t\t{\n\t\t\tDom.clean(this.elements.topButtonsContainer);\n\t\t\tthis.elements.topButtonsContainer.appendChild(topButtonsFragment);\n\t\t}\n\t\tif (this.elements.topLevelButtonsContainer)\n\t\t{\n\t\t\tDom.clean(this.elements.topLevelButtonsContainer);\n\t\t\tthis.elements.topLevelButtonsContainer.appendChild(topLevelButtonsFragment);\n\t\t}\n\t};\n\n\trenderButtonsFolded()\n\t{\n\t\tlet buttonsFragment = document.createDocumentFragment();\n\t\tlet buttonNode;\n\t\tthis.elements.buttons = {};\n\n\t\tthis.buttons.forEach((buttonName) =>\n\t\t{\n\t\t\tswitch (buttonName)\n\t\t\t{\n\t\t\t\tcase 'hangup':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_HANGUP'),\n\t\t\t\t\t\t'im-phone-call-panel-mini-cancel',\n\t\t\t\t\t\tthis._onHangupButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'close':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_CLOSE'),\n\t\t\t\t\t\t'im-phone-call-panel-mini-cancel',\n\t\t\t\t\t\tthis._onCloseButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tif (this.elements.buttonsContainer)\n\t\t{\n\t\t\tDom.clean(this.elements.buttonsContainer);\n\t\t\tthis.elements.buttonsContainer.appendChild(buttonsFragment);\n\t\t}\n\t};\n\n\trenderCrmButtons()\n\t{\n\t\tlet buttonsFragment = document.createDocumentFragment();\n\t\tthis.elements.crmButtons = {};\n\n\t\tif (!this.elements.crmButtonsContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet buttons = ['addComment'];\n\n\t\tif (this.crmEntityType == 'CONTACT')\n\t\t{\n\t\t\tbuttons.push('addDeal');\n\t\t\tbuttons.push('addInvoice');\n\t\t}\n\t\telse if (this.crmEntityType == 'COMPANY')\n\t\t{\n\t\t\tbuttons.push('addDeal');\n\t\t\tbuttons.push('addInvoice');\n\t\t}\n\t\telse if (!this.crmEntityType && this.config.CRM_CREATE == 'none')\n\t\t{\n\t\t\tbuttons.push('addLead');\n\t\t\tbuttons.push('addContact');\n\t\t}\n\n\t\tif (buttons.length > 0)\n\t\t{\n\t\t\tbuttons.forEach((buttonName) =>\n\t\t\t{\n\t\t\t\tlet buttonNode;\n\t\t\t\tswitch (buttonName)\n\t\t\t\t{\n\t\t\t\t\tcase 'addComment':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button im-phone-call-crm-button-comment' + (this.commentShown ? ' im-phone-call-crm-button-active' : '')},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.crmButtons.addCommentLabel = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: this.commentShown ? Loc.getMessage('IM_PHONE_CALL_VIEW_SAVE') : Loc.getMessage('IM_PHONE_ACTION_CRM_COMMENT')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddCommentButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'addDeal':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_ACTION_CRM_DEAL')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddDealButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'addInvoice':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_ACTION_CRM_INVOICE')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddInvoiceButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'addLead':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_CRM_BTN_NEW_LEAD')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddLeadButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'addContact':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_CRM_BTN_NEW_CONTACT')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddContactButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (buttonNode)\n\t\t\t\t{\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tthis.elements.crmButtons[buttonName] = buttonNode;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tDom.clean(this.elements.crmButtonsContainer);\n\t\t\tthis.elements.crmButtonsContainer.appendChild(buttonsFragment);\n\t\t\tthis.showSections(['crmButtons']);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.clean(this.elements.crmButtonsContainer);\n\t\t\tthis.hideSections(['crmButtons']);\n\t\t}\n\t};\n\n\tloadForm(params)\n\t{\n\t\tif (!this.formManager)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.formManager.load({\n\t\t\tid: params.id,\n\t\t\tsecCode: params.secCode\n\t\t})\n\t};\n\n\tunloadForm()\n\t{\n\t\tif (!this.formManager)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.formManager.unload();\n\t\tDom.clean(this.elements.tabsBody.webform);\n\t};\n\n\t_onFormSend(e)\n\t{\n\t\tif (!this.callListView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar currentElement = this.callListView.getCurrentElement();\n\t\tthis.callListView.setWebformResult(currentElement.ELEMENT_ID, e.resultId);\n\t};\n\n\tloadRestApp(params)\n\t{\n\t\tvar restAppId = params.id;\n\t\tvar node = params.node;\n\n\t\tif (this.restAppLayoutLoaded)\n\t\t{\n\t\t\tBX.rest.AppLayout.getPlacement('CALL_CARD').load(restAppId, this.getPlacementOptions());\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.restAppLayoutLoading)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.restAppLayoutLoading = true;\n\n\t\tBX.ajax.runAction(\"voximplant.callView.loadRestApp\", {\n\t\t\tdata: {\n\t\t\t\t'appId': restAppId,\n\t\t\t\t'placementOptions': this.getPlacementOptions()\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (!this.popup && !this.isDesktop())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tRuntime.html(node, response.data.html);\n\t\t\tthis.restAppLayoutLoaded = true;\n\t\t\tthis.restAppLayoutLoading = false;\n\t\t\tthis.restAppInterface = BX.rest.AppLayout.initializePlacement('CALL_CARD');\n\t\t\tthis.initializeAppInterface(this.restAppInterface);\n\t\t});\n\t};\n\n\tunloadRestApps()\n\t{\n\t\tif (!BX.rest || !BX.rest.AppLayout)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tvar placement = BX.rest.AppLayout.getPlacement('CALL_CARD');\n\t\tif (this.restAppLayoutLoaded && placement)\n\t\t{\n\t\t\tplacement.destroy();\n\t\t\tthis.restAppLayoutLoaded = false;\n\t\t}\n\t};\n\n\tinitializeAppInterface(appInterface)\n\t{\n\t\tappInterface.prototype.events.push('CallCard::EntityChanged');\n\t\tappInterface.prototype.events.push('CallCard::BeforeClose');\n\t\tappInterface.prototype.events.push('CallCard::CallStateChanged');\n\t\tappInterface.prototype.getStatus = (params, cb) =>\n\t\t{\n\t\t\tcb(this.getPlacementOptions());\n\t\t};\n\n\t\tappInterface.prototype.disableAutoClose = (params, cb) =>\n\t\t{\n\t\t\tthis.disableAutoClose();\n\t\t\tcb([]);\n\t\t};\n\n\t\tappInterface.prototype.enableAutoClose = (params, cb) =>\n\t\t{\n\t\t\tthis.enableAutoClose();\n\t\t\tcb([]);\n\t\t};\n\t};\n\n\tgetPlacementOptions()\n\t{\n\t\treturn {\n\t\t\t'CALL_ID': this.callId,\n\t\t\t'PHONE_NUMBER': this.phoneNumber === \"unknown\" ? undefined : this.phoneNumber,\n\t\t\t'LINE_NUMBER': this.lineNumber,\n\t\t\t'LINE_NAME': this.companyPhoneNumber,\n\t\t\t'CRM_ENTITY_TYPE': this.crmEntityType,\n\t\t\t'CRM_ENTITY_ID': this.crmEntityId,\n\t\t\t'CRM_ACTIVITY_ID': this.crmActivityId === 0 ? undefined : this.crmActivityId,\n\t\t\t'CRM_BINDINGS': this.crmBindings,\n\t\t\t'CALL_DIRECTION': this.direction,\n\t\t\t'CALL_STATE': this.callState,\n\t\t\t'CALL_LIST_MODE': this.callListId > 0\n\t\t}\n\t};\n\n\tisUnloadAllowed()\n\t{\n\t\tif (this.backgroundWorker.isActiveIntoCurrentCall())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.folded &&\n\t\t\t(\n\t\t\t\tthis.deviceCall ||\n\t\t\t\tthis._uiState === UiState.idle ||\n\t\t\t\tthis._uiState === UiState.error ||\n\t\t\t\tthis._uiState === UiState.externalCard\n\t\t\t);\n\t};\n\n\t_onBeforeUnload(e)\n\t{\n\t\tif (!this.isUnloadAllowed())\n\t\t{\n\t\t\te.returnValue = Loc.getMessage('IM_PHONE_CALL_VIEW_DONT_LEAVE');\n\t\t\treturn Loc.getMessage('IM_PHONE_CALL_VIEW_DONT_LEAVE');\n\t\t}\n\t};\n\n\t_onDblClick(e: Event)\n\t{\n\t\te.preventDefault()\n\t\tif (!this.isFolded() && this.canBeFolded())\n\t\t{\n\t\t\tthis.fold();\n\t\t}\n\t};\n\n\t_onHoldButtonClick()\n\t{\n\t\tif (this.isHeld())\n\t\t{\n\t\t\tthis.held = false;\n\t\t\tDom.removeClass(this.elements.buttons.hold, 'active');\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onUnHold, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.unhold();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.held = true;\n\t\t\tDom.addClass(this.elements.buttons.hold, 'active');\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onHold, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.hold();\n\t\t\t}\n\t\t}\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.holdButtonClick, this.isHeld())\n\t};\n\n\t_onMuteButtonClick()\n\t{\n\t\tif (this.isMuted())\n\t\t{\n\t\t\tthis.muted = false;\n\t\t\tDom.removeClass(this.elements.buttons.mute, 'active');\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onUnMute, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.unmute();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.muted = true;\n\t\t\tDom.addClass(this.elements.buttons.mute, 'active');\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onMute, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.mute();\n\t\t\t}\n\t\t}\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.muteButtonClick, this.isMuted());\n\t};\n\n\t_onTransferButtonClick()\n\t{\n\t\tthis.selectTransferTarget((result) =>\n\t\t{\n\t\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.transferButtonClick, result)\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onStartTransfer, [result]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.transfer(result);\n\t\t\t}\n\t\t});\n\t};\n\n\t_onTransferCompleteButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.completeTransferButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onCompleteTransfer, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.completeTransfer();\n\t\t}\n\t};\n\n\t_onTransferCancelButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.cancelTransferButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onCancelTransfer, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.cancelTransfer();\n\t\t}\n\t};\n\n\t_onDialpadButtonClick()\n\t{\n\t\tthis.keypad = new Keypad({\n\t\t\tbindElement: this.elements.buttons.dialpad,\n\t\t\thideDial: true,\n\t\t\tonButtonClick: (e) =>\n\t\t\t{\n\t\t\t\tvar key = e.key;\n\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t{\n\t\t\t\t\tDesktopApi.emit(desktopEvents.onDialpadButtonClicked, [key]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.dialpadButtonClicked(key);\n\t\t\t\t}\n\t\t\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.dialpadButtonClick, key);\n\t\t\t},\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.keypad.destroy();\n\t\t\t\tthis.keypad = null;\n\t\t\t}\n\t\t});\n\t\tthis.keypad.show();\n\t};\n\n\t_onHangupButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.hangupButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onHangup, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.hangup();\n\t\t}\n\t};\n\n\t_onCloseButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.closeButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onClose, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t};\n\n\t_onMakeCallButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.makeCallButtonClick);\n\t\tvar event = {};\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\tthis.callingEntity = this.currentEntity;\n\n\t\t\tif (this.currentEntity.phones.length === 0)\n\t\t\t{\n\t\t\t\t// show keypad and dial entered number\n\t\t\t\tthis.keypad = new Keypad({\n\t\t\t\t\tbindElement: this.elements.buttons.call ? this.elements.buttons.call : null,\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keypad.destroy();\n\t\t\t\t\t\tthis.keypad = null;\n\t\t\t\t\t},\n\t\t\t\t\tonDial: (e) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keypad.close();\n\t\t\t\t\t\tthis.phoneNumber = e.phoneNumber;\n\t\t\t\t\t\tthis.createTitle().then(title => this.setTitle(title));\n\n\t\t\t\t\t\tevent = {\n\t\t\t\t\t\t\tphoneNumber: e.phoneNumber,\n\t\t\t\t\t\t\tcrmEntityType: this.crmEntityType,\n\t\t\t\t\t\t\tcrmEntityId: this.crmEntityId,\n\t\t\t\t\t\t\tcallListId: this.callListId\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDesktopApi.emit(desktopEvents.onCallListMakeCall, [event]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.callbacks.callListMakeCall(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.keypad.show();\n\t\t\t}\n\t\t\telse if (this.currentEntity.phones.length == 1)\n\t\t\t{\n\t\t\t\t// just dial the number\n\t\t\t\tevent.phoneNumber = this.currentEntity.phones[0].VALUE;\n\t\t\t\tevent.crmEntityType = this.crmEntityType;\n\t\t\t\tevent.crmEntityId = this.crmEntityId;\n\t\t\t\tevent.callListId = this.callListId;\n\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t{\n\t\t\t\t\tDesktopApi.emit(desktopEvents.onCallListMakeCall, [event]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.callListMakeCall(event);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// allow user to select the number\n\t\t\t\tthis.showNumberSelectMenu({\n\t\t\t\t\tbindElement: this.elements.buttons.call ? this.elements.buttons.call : null,\n\t\t\t\t\tphoneNumbers: this.currentEntity.phones,\n\t\t\t\t\tonSelect: (e) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.closeNumberSelectMenu();\n\t\t\t\t\t\tthis.phoneNumber = e.phoneNumber;\n\t\t\t\t\t\tthis.createTitle().then(title => this.setTitle(title));\n\n\t\t\t\t\t\tevent = {\n\t\t\t\t\t\t\tphoneNumber: e.phoneNumber,\n\t\t\t\t\t\t\tcrmEntityType: this.crmEntityType,\n\t\t\t\t\t\t\tcrmEntityId: this.crmEntityId,\n\t\t\t\t\t\t\tcallListId: this.callListId\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDesktopApi.emit(desktopEvents.onCallListMakeCall, [event]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.callbacks.callListMakeCall(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onMakeCall, [this.phoneNumber]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.makeCall(this.phoneNumber);\n\t\t\t}\n\t\t}\n\t};\n\n\t_onNextButtonClick()\n\t{\n\t\tif (!this.callListView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.nextButtonClick);\n\t\tthis.setUiState(UiState.outgoing);\n\t\tthis.callListView.moveToNextItem();\n\t\tthis.setStatusText('');\n\t};\n\n\t_onRedialButtonClick(e)\n\t{\n\n\t};\n\n\t_onCommentChanged()\n\t{\n\t\tthis.comment = this.elements.commentEditor.value;\n\t\t//Update callView close timer when printing a comment\n\t\tthis.updateAutoCloseTimer();\n\t};\n\n\t_onAddCommentButtonClick()\n\t{\n\t\tthis.commentShown = !this.commentShown;\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onCommentShown, [this.commentShown]);\n\t\t}\n\n\t\tif (this.commentShown)\n\t\t{\n\t\t\tif (this.elements.crmButtons.addComment)\n\t\t\t{\n\t\t\t\tDom.addClass(this.elements.crmButtons.addComment, 'im-phone-call-crm-button-active');\n\t\t\t\tthis.elements.crmButtons.addCommentLabel.innerText = Loc.getMessage('IM_PHONE_CALL_VIEW_SAVE');\n\t\t\t}\n\t\t\tif (this.elements.commentEditor)\n\t\t\t{\n\t\t\t\tthis.elements.commentEditor.value = this.comment;\n\t\t\t\tthis.elements.commentEditor.focus();\n\t\t\t}\n\n\t\t\tif (this.elements.commentEditorContainer)\n\t\t\t{\n\t\t\t\tthis.elements.commentEditorContainer.style.removeProperty('display');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\n\t\t\tif (this.elements.crmButtons.addComment)\n\t\t\t{\n\t\t\t\tDom.removeClass(this.elements.crmButtons.addComment, 'im-phone-call-crm-button-active');\n\t\t\t\tthis.elements.crmButtons.addCommentLabel.innerText = Loc.getMessage('IM_PHONE_ACTION_CRM_COMMENT');\n\t\t\t}\n\n\t\t\tif (this.elements.commentEditorContainer)\n\t\t\t{\n\t\t\t\tthis.elements.commentEditorContainer.style.display = 'none';\n\t\t\t}\n\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onSaveComment, [this.comment]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.saveComment();\n\t\t\t}\n\n\t\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.addCommentButtonClick, this.comment);\n\t\t}\n\t};\n\n\t_onAddDealButtonClick()\n\t{\n\t\tvar url = this._getCrmEditUrl('DEAL', 0);\n\t\tvar externalContext = this._generateExternalContext();\n\t\tif (this.crmEntityType === 'CONTACT')\n\t\t{\n\t\t\turl = Uri.addParam(url, {contact_id: this.crmEntityId});\n\t\t}\n\t\telse if (this.crmEntityType === 'COMPANY')\n\t\t{\n\t\t\turl = Uri.addParam(url, {company_id: this.crmEntityId});\n\t\t}\n\n\t\turl = Uri.addParam(url, {external_context: externalContext});\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\turl = Uri.addParam(url, {call_list_id: this.callListId});\n\t\t\turl = Uri.addParam(url, {call_list_element: this.currentEntity.id});\n\t\t}\n\n\t\tthis.externalRequests[externalContext] = {\n\t\t\ttype: 'add',\n\t\t\tcontext: externalContext,\n\t\t\twindow: window.open(url)\n\t\t};\n\t};\n\n\t_onAddInvoiceButtonClick()\n\t{\n\t\tlet url = this._getCrmEditUrl('INVOICE', 0);\n\t\tconst externalContext = this._generateExternalContext();\n\n\t\turl = Uri.addParam(url, {redirect: \"y\"});\n\t\tif (this.crmEntityType === 'CONTACT')\n\t\t{\n\t\t\turl = Uri.addParam(url, {contact: this.crmEntityId});\n\t\t}\n\t\telse if (this.crmEntityType === 'COMPANY')\n\t\t{\n\t\t\turl = Uri.addParam(url, {company: this.crmEntityId});\n\t\t}\n\n\t\turl = Uri.addParam(url, {external_context: externalContext});\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\turl = Uri.addParam(url, {call_list_id: this.callListId});\n\t\t\turl = Uri.addParam(url, {call_list_element: this.currentEntity.id});\n\t\t}\n\n\t\tthis.externalRequests[externalContext] = {\n\t\t\ttype: 'add',\n\t\t\tcontext: externalContext,\n\t\t\twindow: window.open(url)\n\t\t};\n\t};\n\n\t_onAddLeadButtonClick()\n\t{\n\t\tlet url = this._getCrmEditUrl('LEAD', 0);\n\t\turl = Uri.addParam(url, {\n\t\t\tphone: this.phoneNumber,\n\t\t\torigin_id: 'VI_' + this.callId\n\t\t});\n\t\twindow.open(url);\n\t};\n\n\t_onAddContactButtonClick()\n\t{\n\t\tlet url = this._getCrmEditUrl('CONTACT', 0);\n\t\turl = Uri.addParam(url, {\n\t\t\tphone: this.phoneNumber,\n\t\t\torigin_id: 'VI_' + this.callId\n\t\t});\n\t\twindow.open(url);\n\t};\n\n\t_onFoldButtonClick()\n\t{\n\t\tthis.fold();\n\t};\n\n\t_onAnswerButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.answerButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onAnswer, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.answer();\n\t\t}\n\t};\n\n\t_onSkipButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.skipButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onSkip, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.skip();\n\t\t}\n\t};\n\n\t_onSwitchDeviceButtonClick()\n\t{\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onSwitchDevice, [{\n\t\t\t\tphoneNumber: this.phoneNumber\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.switchDevice({\n\t\t\t\tphoneNumber: this.phoneNumber\n\t\t\t});\n\t\t}\n\t};\n\n\t_onQualityMeterClick()\n\t{\n\t\tthis.showQualityPopup({\n\t\t\tonSelect: (qualityGrade) =>\n\t\t\t{\n\t\t\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.qualityMeterClick, qualityGrade);\n\t\t\t\tthis.qualityGrade = qualityGrade;\n\t\t\t\tthis.closeQualityPopup();\n\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t{\n\t\t\t\t\tDesktopApi.emit(desktopEvents.onQualityGraded, [qualityGrade]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.qualityGraded(qualityGrade);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\t#onExternalEvent = (params) =>\n\t{\n\t\tconsole.warn('#onExternalEvent', params)\n\t\treturn\n\t\tparams = Type.isPlainObject(params) ? params : {};\n\t\tparams.key = params.key || '';\n\n\t\tvar value = params.value || {};\n\t\tvalue.entityTypeName = value.entityTypeName || '';\n\t\tvalue.context = value.context || '';\n\t\tvalue.isCanceled = Type.isBoolean(value.isCanceled) ? value.isCanceled : false;\n\n\t\tif (value.isCanceled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.key === \"onCrmEntityCreate\" && this.externalRequests[value.context])\n\t\t{\n\t\t\tif (this.externalRequests[value.context])\n\t\t\t{\n\t\t\t\tif (this.externalRequests[value.context]['type'] == 'create')\n\t\t\t\t{\n\t\t\t\t\tthis.crmEntityType = value.entityTypeName;\n\t\t\t\t\tthis.crmEntityId = value.entityInfo.id;\n\t\t\t\t\tthis.loadCrmCard(this.crmEntityType, this.crmEntityId);\n\t\t\t\t}\n\t\t\t\telse if (this.externalRequests[value.context]['type'] == 'add')\n\t\t\t\t{\n\t\t\t\t\t// reload crm card\n\t\t\t\t\tthis.loadCrmCard(this.crmEntityType, this.crmEntityId);\n\t\t\t\t}\n\n\t\t\t\tif (this.externalRequests[value.context]['window'])\n\t\t\t\t{\n\t\t\t\t\tthis.externalRequests[value.context]['window'].close();\n\t\t\t\t}\n\n\t\t\t\tdelete this.externalRequests[value.context];\n\t\t\t}\n\t\t}\n\t};\n\n\t_onPullEventCrm(command, params)\n\t{\n\t\tif (command === 'external_event')\n\t\t{\n\t\t\tif (params.NAME === 'onCrmEntityCreate' && params.IS_CANCELED == false)\n\t\t\t{\n\t\t\t\tvar eventParams = params.PARAMS;\n\t\t\t\tif (this.externalRequests[eventParams.context])\n\t\t\t\t{\n\t\t\t\t\tvar crmEntityType = eventParams.entityTypeName;\n\t\t\t\t\tvar crmEntityId = eventParams.entityInfo.id;\n\n\t\t\t\t\tif (this.callListView)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar currentElement = this.callListView.getCurrentElement();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tonCallListSelectedItem(entity)\n\t{\n\t\tthis.currentEntity = entity;\n\t\tthis.crmEntityType = entity.type;\n\t\tthis.crmEntityId = entity.id;\n\t\tthis.comment = \"\";\n\n\t\tif (Type.isArray(entity.bindings))\n\t\t{\n\t\t\tthis.crmBindings = entity.bindings.map((value) =>\n\t\t\t\t{\n\t\t\t\t\treturn {'ENTITY_TYPE': value.type, 'ENTITY_ID': value.id}\n\t\t\t\t}\n\t\t\t)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.crmBindings = [];\n\t\t}\n\n\t\tif (entity.phones.length > 0)\n\t\t{\n\t\t\tthis.phoneNumber = entity.phones[0].VALUE;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.phoneNumber = 'unknown';\n\t\t}\n\n\t\tthis.createTitle().then(title => this.setTitle(title));\n\t\tthis.loadCrmCard(entity.type, entity.id);\n\t\tif (this.currentTabName === 'webform')\n\t\t{\n\t\t\tthis.formManager.unload();\n\t\t\tthis.formManager.load({\n\t\t\t\tid: this.webformId,\n\t\t\t\tsecCode: this.webformSecCode,\n\t\t\t\tlang: Loc.getMessage(\"LANGUAGE_ID\"),\n\t\t\t})\n\t\t}\n\t\tif (this._uiState === UiState.redial)\n\t\t{\n\t\t\tthis.setUiState(UiState.outgoing);\n\t\t}\n\n\t\tthis.updateView();\n\t};\n\n\t#onWindowUnload = () =>\n\t{\n\t\tconsole.log('onWindowUnload call view event', location.href, DesktopApi.isChatWindow());\n\t\tthis.close();\n\t}\n\n\tshowCallIcon()\n\t{\n\t\tif (!this.callListView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.callingEntity)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callListView.setCallingElement(this.callingEntity.statusId, this.callingEntity.index);\n\t};\n\n\thideCallIcon()\n\t{\n\t\tif (!this.callListView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callListView.resetCallingElement();\n\t};\n\n\tisTimerStarted()\n\t{\n\t\treturn !!this.timerInterval;\n\t}\n\n\tstartTimer()\n\t{\n\t\tif (this.isTimerStarted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.initialTimestamp === 0)\n\t\t{\n\t\t\tthis.initialTimestamp = (new Date()).getTime();\n\t\t}\n\t\tthis.timerInterval = setInterval(this.renderTimer.bind(this), 1000);\n\t\tthis.renderTimer();\n\t};\n\n\trenderTimer()\n\t{\n\t\tif (!this.elements.timer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet currentTimestamp = (new Date()).getTime();\n\t\tlet elapsedMilliSeconds = (currentTimestamp - this.initialTimestamp);\n\n\t\tlet elapsedSeconds = Math.floor(elapsedMilliSeconds / 1000);\n\t\tlet minutes = Math.floor(elapsedSeconds / 60).toString();\n\t\tif (minutes.length < 2)\n\t\t{\n\t\t\tminutes = '0' + minutes;\n\t\t}\n\t\tlet seconds = (elapsedSeconds % 60).toString();\n\t\tif (seconds.length < 2)\n\t\t{\n\t\t\tseconds = '0' + seconds;\n\t\t}\n\t\tconst template = (this.isRecording() ? Loc.getMessage('IM_PHONE_TIMER_WITH_RECORD') : Loc.getMessage('IM_PHONE_TIMER_WITHOUT_RECORD'));\n\n\t\tif (this.isFolded())\n\t\t{\n\t\t\tthis.elements.timer.innerText = minutes + ':' + seconds;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.timer.innerText = template.replace('#MIN#', minutes).replace('#SEC#', seconds);\n\t\t}\n\t};\n\n\tstopTimer()\n\t{\n\t\tif (!this.isTimerStarted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearInterval(this.timerInterval);\n\t\tthis.timerInterval = null;\n\t};\n\n\tshowQualityPopup(params)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tif (!Type.isFunction(params.onSelect))\n\t\t{\n\t\t\tparams.onSelect = nop;\n\t\t}\n\n\t\tconst elements = {\n\t\t\t'1': null,\n\t\t\t'2': null,\n\t\t\t'3': null,\n\t\t\t'4': null,\n\t\t\t'5': null\n\t\t};\n\n\t\tthis.qualityPopup = new Popup({\n\t\t\tid: 'PhoneCallViewQualityGrade',\n\t\t\tbindElement: this.elements.qualityMeter,\n\t\t\ttargetContainer: document.body,\n\t\t\tdarkMode: true,\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: true,\n\t\t\tzIndex: baseZIndex + 200,\n\t\t\tnoAllPaddings: true,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top'\n\t\t\t},\n\t\t\tangle: {\n\t\t\t\tposition: 'bottom',\n\t\t\t\toffset: 30\n\t\t\t},\n\t\t\tcacheable: false,\n\t\t\tcontent: Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-popup-rating'}, children: [\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-popup-rating-title'},\n\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_RATE_QUALITY')\n\t\t\t\t\t}),\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-popup-rating-stars'}, children: [\n\t\t\t\t\t\t\telements['1'] = createStar(1, this.qualityGrade == '1', params.onSelect),\n\t\t\t\t\t\t\telements['2'] = createStar(2, this.qualityGrade == '2', params.onSelect),\n\t\t\t\t\t\t\telements['3'] = createStar(3, this.qualityGrade == '3', params.onSelect),\n\t\t\t\t\t\t\telements['4'] = createStar(4, this.qualityGrade == '4', params.onSelect),\n\t\t\t\t\t\t\telements['5'] = createStar(5, this.qualityGrade == '5', params.onSelect)\n\t\t\t\t\t\t], events: {\n\t\t\t\t\t\t\tmouseover: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (elements[this.qualityGrade])\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tDom.removeClass(elements[this.qualityGrade], 'im-phone-popup-rating-stars-item-active');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmouseout: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (elements[this.qualityGrade])\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tDom.addClass(elements[this.qualityGrade], 'im-phone-popup-rating-stars-item-active');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t}),\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => this.qualityPopup = null,\n\t\t\t}\n\t\t});\n\n\t\tthis.qualityPopup.show();\n\t};\n\n\tcloseQualityPopup()\n\t{\n\t\tif (this.qualityPopup)\n\t\t{\n\t\t\tthis.qualityPopup.close();\n\t\t}\n\t};\n\n\tsaveComment()\n\t{\n\t\tthis.callbacks.saveComment({\n\t\t\tcallId: this.callId,\n\t\t\tcomment: this.comment\n\t\t})\n\t};\n\n\tshowNumberSelectMenu(params)\n\t{\n\t\tvar menuItems = [];\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tif (!Type.isArray(params.phoneNumbers))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tparams.onSelect = Type.isFunction(params.onSelect) ? params.onSelect : BX.DoNothing;\n\t\tparams.phoneNumbers.forEach((phoneNumber) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: 'number-select-' + BX.util.getRandomString(10),\n\t\t\t\ttext: phoneNumber.VALUE,\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tparams.onSelect({\n\t\t\t\t\t\tphoneNumber: phoneNumber.VALUE\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.numberSelectMenu = new Menu(\n\t\t\t'im-phone-call-view-number-select',\n\t\t\tparams.bindElement,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 40,\n\t\t\t\tangle: {position: \"top\"},\n\t\t\t\tzIndex: baseZIndex + 200,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\toverlay: {\n\t\t\t\t\tbackgroundColor: 'white',\n\t\t\t\t\topacity: 0\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.numberSelectMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.numberSelectMenu = null\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.numberSelectMenu.show();\n\t};\n\n\tcloseNumberSelectMenu()\n\t{\n\t\tif (this.numberSelectMenu)\n\t\t{\n\t\t\tthis.numberSelectMenu.close();\n\t\t}\n\t};\n\n\tfold()\n\t{\n\t\tif (!this.canBeFolded())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.callListId > 0 && this.callState === CallState.idle)\n\t\t{\n\t\t\tthis.foldCallView();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.foldCall();\n\t\t}\n\t};\n\n\tunfold()\n\t{\n\t\tif (!this.isDesktop() && this.isFolded())\n\t\t{\n\t\t\tDom.remove(this.elements.main);\n\t\t\tthis.folded = false;\n\t\t\tthis.elements = this.unfoldedElements;\n\t\t\tthis.show();\n\t\t}\n\t};\n\n\tfoldCall()\n\t{\n\t\tif (this.isDesktop() || !this.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet popupNode = this.popup.getPopupContainer();\n\t\tlet overlayNode = this.popup.overlay.element;\n\n\t\tDom.addClass(popupNode, 'im-phone-call-view-folding');\n\t\tDom.addClass(overlayNode, 'popup-window-overlay-im-phone-call-view-folding');\n\t\tsetTimeout(() =>\n\t\t{\n\t\t\tthis.folded = true;\n\t\t\tthis.popup.close();\n\t\t\tthis.unfoldedElements = this.elements;\n\t\t\tDom.removeClass(popupNode, 'im-phone-call-view-folding');\n\t\t\tDom.removeClass(overlayNode, 'popup-window-overlay-im-phone-call-view-folding');\n\t\t\tthis.reinit();\n\t\t\tthis.enableDocumentScroll();\n\t\t}, 300);\n\t};\n\n\tfoldCallView()\n\t{\n\t\tconst popupNode = this.popup.getPopupContainer();\n\t\tconst overlayNode = this.popup.overlay.element;\n\n\t\tDom.addClass(popupNode, 'im-phone-call-view-folding');\n\t\tDom.addClass(overlayNode, 'popup-window-overlay-im-phone-call-view-folding');\n\t\tsetTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tthis.close();\n\t\t\t\tthis.foldedCallView.fold({\n\t\t\t\t\tcallListId: this.callListId,\n\t\t\t\t\twebformId: this.webformId,\n\t\t\t\t\twebformSecCode: this.webformSecCode,\n\t\t\t\t\tcurrentItemIndex: this.callListView.currentItemIndex,\n\t\t\t\t\tcurrentItemStatusId: this.callListView.currentStatusId,\n\t\t\t\t\tstatusList: this.callListView.statuses,\n\t\t\t\t\tentityType: this.callListView.entityType\n\t\t\t\t}, true);\n\t\t\t},\n\t\t\t300\n\t\t);\n\t};\n\n\tbindSlaveDesktopEvents()\n\t{\n\t\tDesktopApi.subscribe(desktopEvents.setTitle, this.setTitle.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setStatus, this.setStatusText.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setUiState, this.setUiState.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setDeviceCall, this.setDeviceCall.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setCrmEntity, this.setCrmEntity.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.reloadCrmCard, this.reloadCrmCard.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setPortalCall, this.setPortalCall.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setPortalCallUserId, this.setPortalCallUserId.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setPortalCallQueueName, this.setPortalCallQueueName.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setPortalCallData, this.setPortalCallData.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setConfig, this.setConfig.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setCallId, this.setCallId.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setLineNumber, this.setLineNumber.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setCompanyPhoneNumber, this.setCompanyPhoneNumber.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setPhoneNumber, this.setPhoneNumber.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setTransfer, this.setTransfer.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setCallState, this.setCallState.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.closeWindow, () => window.close());\n\n\t\tBX.bind(window, \"beforeunload\", () =>\n\t\t{\n\t\t\tBX.unbindAll(window, \"beforeunload\");\n\t\t\tDesktopApi.emit(desktopEvents.onBeforeUnload, []);\n\t\t});\n\n\t\tBX.bind(window, \"resize\", Runtime.debounce(() =>\n\t\t{\n\t\t\tif (this.skipOnResize)\n\t\t\t{\n\t\t\t\tthis.skipOnResize = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.saveInitialSize(window.innerWidth, window.innerHeight)\n\t\t}, 100));\n\n\t\tBX.addCustomEvent(\"SidePanel.Slider:onOpen\", (event) =>\n\t\t{\n\t\t\tif (!event.getSlider().isSelfContained())\n\t\t\t{\n\t\t\t\tevent.denyAction();\n\t\t\t\twindow.open(event.slider.url);\n\t\t\t}\n\t\t});\n\n\t\t/*BX.bind(window, \"keydown\", function(e)\n\t\t{\n\t\t\tif(e.keyCode === 27)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onBeforeUnload, []);\n\t\t\t}\n\t\t}.bind(this));*/\n\t};\n\n\tbindMasterDesktopEvents()\n\t{\n\t\tDesktopApi.subscribe(desktopEvents.onHold, () => this.callbacks.hold());\n\t\tDesktopApi.subscribe(desktopEvents.onUnHold, () => this.callbacks.unhold());\n\t\tDesktopApi.subscribe(desktopEvents.onMute, () => this.callbacks.mute());\n\t\tDesktopApi.subscribe(desktopEvents.onUnMute, () => this.callbacks.unmute());\n\t\tDesktopApi.subscribe(desktopEvents.onMakeCall, (phoneNumber) => this.callbacks.makeCall(phoneNumber));\n\t\tDesktopApi.subscribe(desktopEvents.onCallListMakeCall, (e) => this.callbacks.callListMakeCall(e));\n\t\tDesktopApi.subscribe(desktopEvents.onAnswer, () => this.callbacks.answer());\n\t\tDesktopApi.subscribe(desktopEvents.onSkip, () => this.callbacks.skip());\n\t\tDesktopApi.subscribe(desktopEvents.onHangup, () => this.callbacks.hangup());\n\t\tDesktopApi.subscribe(desktopEvents.onClose, () => this.close());\n\t\tDesktopApi.subscribe(desktopEvents.onStartTransfer, (e) => this.callbacks.transfer(e));\n\t\tDesktopApi.subscribe(desktopEvents.onCompleteTransfer, () => this.callbacks.completeTransfer());\n\t\tDesktopApi.subscribe(desktopEvents.onCancelTransfer, () => this.callbacks.cancelTransfer());\n\t\tDesktopApi.subscribe(desktopEvents.onSwitchDevice, (e) => this.callbacks.switchDevice(e));\n\t\tDesktopApi.subscribe(desktopEvents.onBeforeUnload, () =>\n\t\t{\n\t\t\tthis.desktop.window = null;\n\t\t\tthis.callbacks.hangup();\n\t\t\tthis.callbacks.close();\n\t\t}); //slave window unload\n\t\tDesktopApi.subscribe(desktopEvents.onQualityGraded, (grade) => this.callbacks.qualityGraded(grade));\n\t\tDesktopApi.subscribe(desktopEvents.onDialpadButtonClicked, (grade) => this.callbacks.dialpadButtonClicked(grade));\n\t\tDesktopApi.subscribe(desktopEvents.onCommentShown, (commentShown) => this.commentShown = commentShown);\n\t\tDesktopApi.subscribe(desktopEvents.onSaveComment, (comment) =>\n\t\t{\n\t\t\tthis.comment = comment;\n\t\t\tthis.saveComment();\n\t\t});\n\t\tDesktopApi.subscribe(desktopEvents.onSetAutoClose, (autoClose) => this.autoClose = autoClose);\n\n\t};\n\n\tunbindDesktopEvents()\n\t{\n\t\tfor (let eventId in desktopEvents)\n\t\t{\n\t\t\tif (desktopEvents.hasOwnProperty(eventId))\n\t\t\t{\n\t\t\t\tDesktopApi.unsubscribe(desktopEvents[eventId]);\n\t\t\t}\n\t\t}\n\t};\n\n\tisDesktop()\n\t{\n\t\treturn this._isDesktop;\n\t};\n\n\tisFolded()\n\t{\n\t\treturn this.folded;\n\t};\n\n\tcanBeFolded()\n\t{\n\t\treturn this.allowAutoClose && (this.callState === CallState.connected || (this.callState === CallState.idle && this.callListId > 0));\n\t};\n\n\tgetFoldedHeight()\n\t{\n\t\tif (!this.folded)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (!this.elements.main)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn this.elements.main.clientHeight + (this.elements.sections.status ? this.elements.sections.status.clientHeight : 0);\n\t};\n\n\tisWebformSupported()\n\t{\n\t\treturn (!this.isDesktop() || this.desktop.isFeatureSupported('iframe'));\n\t};\n\n\tisRestAppsSupported()\n\t{\n\t\treturn (!this.isDesktop() || this.desktop.isFeatureSupported('iframe'));\n\t};\n\n\tsetClosable(closable)\n\t{\n\t\tclosable = (closable === true);\n\t\tthis.closable = closable;\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\t//this.desktop.setClosable(closable);\n\t\t}\n\t\telse if (this.popup)\n\t\t{\n\t\t\tthis.popup.setClosingByEsc(closable);\n\t\t\t//this.popup.setAutoHide(closable);\n\t\t}\n\t};\n\n\tisClosable()\n\t{\n\t\treturn this.closable;\n\t};\n\n\tadjust()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.adjustPosition();\n\t\t}\n\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tif (this.currentLayout == layouts.simple)\n\t\t\t{\n\t\t\t\tthis.desktop.setResizable(false);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.desktop.setResizable(true);\n\t\t\t\tthis.desktop.setMinSize((this.elements.sidebarContainer ? 900 : 550), 650);\n\t\t\t}\n\t\t\tthis.desktop.center();\n\t\t}\n\t};\n\n\tresizeWindow(width, height)\n\t{\n\t\tif (!this.isDesktop() || !this.slave)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.skipOnResize = true;\n\t\tthis.desktop.resize(width, height);\n\t};\n\n\tclose()\n\t{\n\t\tBX.onCustomEvent(window, 'CallCard::BeforeClose', []);\n\n\t\tif (this.isFolded() && this.elements.main)\n\t\t{\n\t\t\tDom.addClass(this.elements.main, 'im-phone-call-panel-mini-closing');\n\t\t\tsetTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tDom.remove(this.elements.main);\n\t\t\t\t\tthis.elements = this.getInitialElements();\n\t\t\t\t},\n\t\t\t\t300\n\t\t\t);\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\n\t\tif (this.desktop.window)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.closeWindow, []);\n\t\t\t//this.desktop.window.ExecuteCommand('close');\n\t\t\t//this.desktop.window = null;\n\t\t}\n\n\t\tthis.enableDocumentScroll();\n\n\t\tthis.callbacks.close();\n\t\tBX.onCustomEvent(window, 'CallCard::AfterClose', []);\n\t};\n\n\tdisableAutoClose()\n\t{\n\t\tthis.allowAutoClose = false;\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onSetAutoClose, [this.allowAutoClose]);\n\t\t}\n\t\tthis.renderButtons();\n\n\t\t//Update callView close timer on every call disableAutoClose()\n\t\tthis.updateAutoCloseTimer();\n\t};\n\n\tenableAutoClose()\n\t{\n\t\tthis.allowAutoClose = true;\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onSetAutoClose, [this.allowAutoClose]);\n\t\t}\n\t\tthis.renderButtons();\n\n\t\tif (this.autoCloseTimer)\n\t\t{\n\t\t\tclearTimeout(this.autoCloseTimer);\n\t\t\tthis.autoCloseTimer = null;\n\t\t\tthis.autoCloseAfterTimeout();\n\t\t}\n\t};\n\n\tautoClose()\n\t{\n\t\tif (this.allowAutoClose && !this.commentShown)\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.onCustomEvent(window, 'CallCard::BeforeClose', []);\n\t\t\tthis.autoCloseTimer = setTimeout(() => this.autoCloseAfterTimeout(), this.autoCloseTimeout);\n\t\t}\n\t};\n\n\tautoCloseAfterTimeout()\n\t{\n\t\tconsole.log('Auto close after timeout', this.commentShown, this.autoCloseTimer, BX.localStorage.get(lsKeys.currentCall));\n\t\tif (this.commentShown)\n\t\t{\n\t\t\tthis._onAddCommentButtonClick();\n\t\t}\n\n\t\tif (!BX.localStorage.get(lsKeys.currentCall))\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\n\t\tthis.autoCloseTimer = null;\n\t};\n\n\tupdateAutoCloseTimer()\n\t{\n\t\tif (this.autoCloseTimer)\n\t\t{\n\t\t\tclearTimeout(this.autoCloseTimer);\n\t\t\tthis.autoCloseTimer = setTimeout(() => this.autoCloseAfterTimeout(), this.autoCloseTimeout);\n\t\t}\n\t}\n\n\tdisableDocumentScroll()\n\t{\n\t\tconst scrollWidth = window.innerWidth - document.documentElement.clientWidth;\n\t\tdocument.body.style.setProperty('padding-right', scrollWidth + \"px\");\n\t\tdocument.body.classList.add('im-phone-call-disable-scroll');\n\t\tconst imBar = document.getElementById('bx-im-bar');\n\t\tif (imBar)\n\t\t{\n\t\t\timBar.style.setProperty('right', scrollWidth + \"px\");\n\t\t}\n\t};\n\n\tenableDocumentScroll()\n\t{\n\t\tdocument.body.classList.remove('im-phone-call-disable-scroll');\n\t\tdocument.body.style.removeProperty('padding-right');\n\t\tconst imBar = document.getElementById('bx-im-bar');\n\t\tif (imBar)\n\t\t{\n\t\t\timBar.style.removeProperty('right');\n\t\t}\n\t};\n\n\tdispose()\n\t{\n\t\twindow.removeEventListener('beforeunload', this._onBeforeUnloadHandler);\n\t\tBX.removeCustomEvent(\"onPullEvent-crm\", this._onPullEventCrmHandler);\n\t\tthis.unloadRestApps();\n\t\tthis.unloadForm();\n\n\t\tif (this.isFolded() && this.elements.main)\n\t\t{\n\t\t\tDom.addClass(this.elements.main, 'im-phone-call-panel-mini-closing');\n\t\t\tsetTimeout(() => Dom.remove(this.elements.main), 300);\n\t\t}\n\n\t\tif (this.backgroundWorker)\n\t\t{\n\t\t\tthis.backgroundWorker.setCallCard(null);\n\t\t\tthis.backgroundWorker = null;\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t\tthis.popup = null;\n\t\t}\n\n\t\tif (this.qualityPopup)\n\t\t{\n\t\t\tthis.qualityPopup.close();\n\t\t}\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\n\t\tif (this.numberSelectMenu)\n\t\t{\n\t\t\tthis.closeNumberSelectMenu();\n\t\t}\n\n\t\tthis.enableDocumentScroll();\n\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\tthis.unbindDesktopEvents();\n\t\t\tif (this.desktop.window)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.closeWindow, []);\n\t\t\t\t//this.desktop.window.ExecuteCommand('close');\n\t\t\t\tthis.desktop.window = null;\n\t\t\t}\n\t\t\tif (!this.slave)\n\t\t\t{\n\t\t\t\twindow.removeEventListener('beforeunload', this.#onWindowUnload); //master window unload\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\twindow.removeEventListener('beforeunload', this._onBeforeUnloadHandler);\n\t\t}\n\n\t\tif (!BX.localStorage.get(lsKeys.callInited) && !BX.localStorage.get(lsKeys.externalCall))\n\t\t{\n\t\t\tBX.localStorage.remove(lsKeys.callView);\n\t\t}\n\t};\n\n\tcanBeUnloaded()\n\t{\n\t\tif (this.backgroundWorker.isUsed())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.allowAutoClose && this.isFolded();\n\t};\n\n\tisCallListMode()\n\t{\n\t\treturn (this.callListId > 0);\n\t};\n\n\tgetState()\n\t{\n\t\treturn {\n\t\t\tcallId: this.callId,\n\t\t\tfolded: this.folded,\n\t\t\tuiState: this._uiState,\n\t\t\tphoneNumber: this.phoneNumber,\n\t\t\tcompanyPhoneNumber: this.companyPhoneNumber,\n\t\t\tdirection: this.direction,\n\t\t\tfromUserId: this.fromUserId,\n\t\t\ttoUserId: this.toUserId,\n\t\t\tstatusText: this.statusText,\n\t\t\tcrm: this.crm,\n\t\t\thasSipPhone: this.hasSipPhone,\n\t\t\tdeviceCall: this.deviceCall,\n\t\t\ttransfer: this.transfer,\n\t\t\tcrmEntityType: this.crmEntityType,\n\t\t\tcrmEntityId: this.crmEntityId,\n\t\t\tcrmActivityId: this.crmActivityId,\n\t\t\tcrmActivityEditUrl: this.crmActivityEditUrl,\n\t\t\tcallListId: this.callListId,\n\t\t\tcallListStatusId: this.callListStatusId,\n\t\t\tcallListItemIndex: this.callListItemIndex,\n\t\t\tconfig: (this.config ? this.config : '{}'),\n\t\t\tportalCall: (this.portalCall ? 'true' : 'false'),\n\t\t\tportalCallData: (this.portalCallData ? this.portalCallData : '{}'),\n\t\t\tportalCallUserId: this.portalCallUserId,\n\t\t\twebformId: this.webformId,\n\t\t\twebformSecCode: this.webformSecCode,\n\t\t\tinitialTimestamp: this.initialTimestamp,\n\t\t\tcrmData: this.crmData\n\t\t};\n\t};\n\n\tselectTransferTarget(resultCallback: (TransferTarget) => void)\n\t{\n\t\tresultCallback = Type.isFunction(resultCallback) ? resultCallback : BX.DoNothing;\n\n\t\tRuntime.loadExtension('ui.entity-selector').then((exports: EntitySelector) =>\n\t\t{\n\t\t\tconst config =\n\t\t\t\tthis.backgroundWorker.isUsed()\n\t\t\t\t\t? this.getDialogConfigForBackgroundApp(resultCallback)\n\t\t\t\t\t: this.getDefaultDialogConfig(resultCallback)\n\t\t\t;\n\t\t\tconst Dialog: Dialog = exports.Dialog;\n\t\t\tconst transferDialog = new Dialog(config);\n\n\t\t\ttransferDialog.show();\n\t\t});\n\t};\n\n\tgetDialogConfigForBackgroundApp(resultCallback)\n\t{\n\t\treturn {\n\t\t\ttargetNode: this.elements.buttons.transfer,\n\t\t\tmultiple: false,\n\t\t\tcacheable: false,\n\t\t\thideOnSelect: false,\n\t\t\tenableSearch: true,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'user',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\tselectFields: ['personalPhone', 'personalMobile', 'workPhone']\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'department'\n\t\t\t\t},\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (event) =>\n\t\t\t\t{\n\t\t\t\t\tevent.target.deselectAll();\n\n\t\t\t\t\tconst item = event.data.item;\n\n\t\t\t\t\tif (item.getEntityId() === 'user')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar customData = item.getCustomData();\n\t\t\t\t\t\tif (customData.get('personalPhone') || customData.get('personalMobile') || customData.get('workPhone'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showTransferToUserMenu({\n\t\t\t\t\t\t\t\tuserId: item.getId(),\n\t\t\t\t\t\t\t\tcustomData: Object.fromEntries(customData),\n\t\t\t\t\t\t\t\tdarkMode: this.darkMode,\n\t\t\t\t\t\t\t\tonSelect: (result: TransferTarget) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\t\t\t\tresultCallback({\n\t\t\t\t\t\t\t\t\t\tphoneNumber: this.phoneNumber,\n\t\t\t\t\t\t\t\t\t\ttarget: result.target\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\t\tresultCallback({\n\t\t\t\t\t\t\t\tphoneNumber: this.phoneNumber,\n\t\t\t\t\t\t\t\ttarget: item.getId()\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetDefaultDialogConfig(resultCallback: (TransferTarget) => void)\n\t{\n\t\treturn {\n\t\t\ttargetNode: this.elements.buttons.transfer,\n\t\t\tmultiple: false,\n\t\t\tcacheable: false,\n\t\t\thideOnSelect: false,\n\t\t\tenableSearch: true,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'user',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\tselectFields: ['personalPhone', 'personalMobile', 'workPhone']\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'department'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'voximplant_group'\n\t\t\t\t},\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (event) =>\n\t\t\t\t{\n\t\t\t\t\tevent.target.deselectAll();\n\n\t\t\t\t\tvar item = event.data.item;\n\n\t\t\t\t\tif (item.getEntityId() === 'user')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar customData = item.getCustomData();\n\t\t\t\t\t\tif (customData.get('personalPhone') || customData.get('personalMobile') || customData.get('workPhone'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showTransferToUserMenu({\n\t\t\t\t\t\t\t\tuserId: item.getId(),\n\t\t\t\t\t\t\t\tcustomData: Object.fromEntries(customData),\n\t\t\t\t\t\t\t\tdarkMode: this.darkMode,\n\t\t\t\t\t\t\t\tonSelect: (result: TransferTarget) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\t\t\t\tresultCallback(result)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\t\tresultCallback({\n\t\t\t\t\t\t\t\ttype: 'user',\n\t\t\t\t\t\t\t\ttarget: item.getId()\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (item.getEntityId() === 'voximplant_group')\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\tresultCallback({\n\t\t\t\t\t\t\ttype: 'queue',\n\t\t\t\t\t\t\ttarget: item.getId()\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tshowTransferToUserMenu(options: TransferOptions = {})\n\t{\n\t\tconst userId = Type.isInteger(options.userId) ? options.userId : 0;\n\t\tconst userCustomData = Type.isPlainObject(options.customData) ? options.customData : {};\n\t\tconst darkMode = options.darkMode === true;\n\t\tconst onSelect = Type.isFunction(options.onSelect) ? options.onSelect : nop;\n\t\tlet popup;\n\n\t\tconst onMenuItemClick = (e) =>\n\t\t{\n\t\t\tconst type = e.currentTarget.dataset[\"type\"];\n\t\t\tconst target = e.currentTarget.dataset[\"target\"];\n\t\t\tonSelect({\n\t\t\t\ttype: type,\n\t\t\t\ttarget: target,\n\t\t\t});\n\t\t\tpopup.close();\n\t\t};\n\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\ticon: 'bx-messenger-menu-call-voice',\n\t\t\t\ttext: Loc.getMessage('IM_PHONE_INNER_CALL'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'user',\n\t\t\t\t\ttarget: userId\n\t\t\t\t},\n\t\t\t\tonclick: onMenuItemClick\n\t\t\t},\n\t\t\t{\n\t\t\t\tdelimiter: true\n\t\t\t},\n\t\t];\n\n\t\tif (userCustomData[\"personalMobile\"])\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\thtml: renderTransferMenuItem(Loc.getMessage(\"IM_PHONE_PERSONAL_MOBILE\"), Text.encode(userCustomData[\"personalMobile\"])),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'pstn',\n\t\t\t\t\ttarget: userCustomData[\"personalMobile\"]\n\t\t\t\t},\n\t\t\t\tonclick: onMenuItemClick,\n\t\t\t});\n\t\t}\n\t\tif (userCustomData[\"personalPhone\"])\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttype: \"call\",\n\t\t\t\thtml: renderTransferMenuItem(Loc.getMessage(\"IM_PHONE_PERSONAL_PHONE\"), Text.encode(userCustomData[\"personalPhone\"])),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'pstn',\n\t\t\t\t\ttarget: userCustomData[\"personalPhone\"]\n\t\t\t\t},\n\t\t\t\tonclick: onMenuItemClick,\n\t\t\t});\n\t\t}\n\t\tif (userCustomData[\"workPhone\"])\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\thtml: renderTransferMenuItem(Loc.getMessage(\"IM_PHONE_WORK_PHONE\"), Text.encode(userCustomData[\"workPhone\"])),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'pstn',\n\t\t\t\t\ttarget: userCustomData[\"workPhone\"]\n\t\t\t\t},\n\t\t\t\tonclick: onMenuItemClick,\n\t\t\t});\n\t\t}\n\n\t\tpopup = new Menu({\n\t\t\tid: \"bx-messenger-phone-transfer-menu\",\n\t\t\tbindElement: null,\n\t\t\ttargetContainer: document.body,\n\t\t\tdarkMode: darkMode,\n\t\t\tlightShadow: true,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tcacheable: false,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: '#FFFFFF',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t});\n\t\tpopup.show();\n\t}\n}\n\nfunction renderTransferMenuItem(surTitle: string, text: string): string\n{\n\treturn `<div class=\"transfer-menu-item-surtitle\">${Text.encode(surTitle)}</div><div class=\"transfer-menu-item-text\">${Text.encode(text)}</div>`\n}\n\nfunction renderSimpleButton(text, className, clickCallback)\n{\n\tlet params = {};\n\tif (Type.isStringFilled(text))\n\t{\n\t\tparams.text = text;\n\t}\n\n\tif (Type.isStringFilled(className))\n\t{\n\t\tparams.props = {className: className};\n\t}\n\n\tif (Type.isFunction(clickCallback))\n\t{\n\t\tparams.events = {click: clickCallback};\n\t}\n\n\treturn Dom.create('span', params);\n}\n\nfunction createStar(grade, active, onSelect)\n{\n\treturn Dom.create(\"div\", {\n\t\tprops: {className: 'im-phone-popup-rating-stars-item ' + (active ? 'im-phone-popup-rating-stars-item-active' : '')},\n\t\tdataset: {grade: grade},\n\t\tevents: {\n\t\t\tclick: (e) =>\n\t\t\t{\n\t\t\t\te.preventDefault();\n\t\t\t\tconst grade = e.currentTarget.dataset.grade;\n\t\t\t\tonSelect(grade);\n\t\t\t}\n\t\t}\n\t})\n}\n\ntype TransferOptions = {\n\tuserId: number,\n\tcustomData: Object,\n\tdarkMode: boolean,\n\tonSelect: (TransferTarget) => void,\n}\n\ntype TransferTarget = {\n\ttype: string,\n\ttarget: string,\n}","import { Browser, Type, Text, Runtime, Loc, Reflection } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\nimport { DesktopDownload } from 'intranet.desktop-download';\n\nimport { Keypad } from './view/keypad'\nimport { PhoneCallView, Direction, UiState, CallState, CallProgress } from './view/view'\nimport { BackgroundWorker } from './view/background-worker';\nimport { FoldedCallView } from './view/folded-view';\nimport { Popup } from 'main.popup';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\n\nconst lsKeys = {\n\tcallInited: 'viInitedCall',\n\texternalCall: 'viExternalCard',\n\tvite: 'vite',\n\tdialHistory: 'vox-dial-history',\n\tfoldedView: 'vox-folded-call-card',\n\tcallView: 'bx-vox-call-view',\n\tcurrentCall: 'bx-vox-current-call',\n}\n\nconst Events = {\n\tonCallCreated: 'onCallCreated',\n\tonCallConnected: 'onCallConnected',\n\tonCallDestroyed: 'onCallDestroyed',\n\tonDeviceCallStarted: 'onDeviceCallStarted',\n};\n\nexport type MessengerFacade = {\n\tisThemeDark: () => boolean,\n\tisDesktop: () => boolean,\n\thasActiveCall: () => boolean,\n\n\trepeatSound: (string, number, boolean) => void,\n\tstopRepeatSound: (name: string) => void,\n\tplaySound: (name: string, force: boolean) => void,\n\n\tsetLocalConfig: (key: string, value: any, ttl: ?number) => void,\n\tgetLocalConfig: (key: string) => any,\n\n\tgetAvatar: (userId: number) => ?string,\n}\n\ntype PhoneCallsControllerOptions = {\n\tphoneEnabled: boolean,\n\tuserId: number,\n\tuserEmail: string,\n\tisAdmin: boolean,\n\tcallCardRestApps: Array,\n\tcanInterceptCall: boolean,\n\trestApps: Array,\n\n\tdeviceActive: boolean,\n\tdeviceCall: boolean, //?\n\tdefaultLineId: string,\n\tavailableLines: Array,\n\n\tmessengerFacade: MessengerFacade,\n\tevents: { [key: string]: () => {} },\n}\n\nconst DeviceType = {\n\tWebrtc: 'WEBRTC',\n\tPhone: 'PHONE',\n}\n\nexport class PhoneCallsController extends EventEmitter\n{\n\tmessengerFacade: MessengerFacade\n\tuserEmail: string\n\n\tcallView: ?PhoneCallView\n\tfoldedCallView: FoldedCallView\n\tbackgroundWorker: BackgroundWorker\n\tkeypad: ?Keypad\n\tdefaultLineId: string\n\n\t_currentCall: ?VoxImplant.Call\n\tvoximplantClient: ?VoxImplant.Client\n\n\tcallId: string\n\tisCallHold: boolean\n\tisMuted: boolean\n\tisCallTransfer: boolean\n\n\thasSipPhone: boolean\n\tdeviceType: ?string\n\t/** @see DeviceType */\n\n\thasExternalCall: boolean\n\n\tphoneTransferTargetId: number\n\tphoneTransferTargetType: string\n\tphoneTransferCallId: string\n\tphoneTransferEnabled: boolean\n\tphoneCrm: Object\n\n\tinitiator: boolean\n\tcallInitUserId: number\n\tcallActive: boolean\n\tcallUserId: number\n\tphoneNumber: string\n\n\tdebug: boolean\n\n\tconstructor(options: PhoneCallsControllerOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Voximplant.PhoneCallsControllerOptions');\n\t\tthis.subscribeFromOptions(options.events)\n\n\t\tthis.debug = false;\n\n\t\tthis.phoneEnabled = Type.isBoolean(options.phoneEnabled) ? options.phoneEnabled : false;\n\n\t\tthis.userId = options.userId;\n\t\tthis.userEmail = options.userEmail;\n\t\tthis.isAdmin = options.isAdmin;\n\n\t\tconst history = BX.localStorage.get(lsKeys.dialHistory);\n\t\tthis.dialHistory = Type.isArray(history) ? history : [];\n\n\t\tthis.availableLines = Type.isArray(options.availableLines) ? options.availableLines : [];\n\t\tthis.defaultLineId = Type.isString(options.defaultLineId) ? options.defaultLineId : '';\n\t\tthis.callInterceptAllowed = options.canInterceptCall || false;\n\t\tthis.restApps = options.restApps;\n\n\t\tthis.hasSipPhone = options.deviceActive === true;\n\n\t\tthis.skipIncomingCallTimer = null;\n\n\t\tthis.hasActiveCallView = false;\n\n\t\tthis.readDefaults();\n\n\t\tif (Browser.isLocalStorageSupported())\n\t\t{\n\t\t\tBX.addCustomEvent(window, \"onLocalStorageSet\", this.storageSet.bind(this));\n\t\t}\n\t\tBX.addCustomEvent(\"onPullEvent-voximplant\", this.#onPullEvent.bind(this));\n\n\t\t// call event handlers\n\t\tthis.onCallConnectedHandler = this.#onCallConnected.bind(this);\n\t\tthis.onCallDisconnectedHandler = this.#onCallDisconnected.bind(this);\n\t\tthis.onCallFailedHandler = this.#onCallFailed.bind(this);\n\t\tthis.onProgressToneStartHandler = this.#onProgressToneStart.bind(this);\n\t\tthis.onProgressToneStopHandler = this.#onProgressToneStop.bind(this);\n\n\t\tthis.messengerFacade = options.messengerFacade;\n\t\tthis.backgroundWorker = new BackgroundWorker();\n\t\tthis.foldedCallView = new FoldedCallView({\n\t\t\tevents: {\n\t\t\t\t[FoldedCallView.Events.onUnfold]: (event) => {\n\t\t\t\t\tconst data = event.getData();\n\t\t\t\t\tthis.startCallList(data.callListId, data.callListParams)\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.restoreFoldedCallView();\n\t\tBX.garbage(() =>\n\t\t{\n\t\t\tif (this.hasActiveCall() && this.callView && this.callView.canBeUnloaded() && (this.hasExternalCall || this.deviceType === 'PHONE'))\n\t\t\t{\n\t\t\t\tBX.localStorage.set(lsKeys.foldedView, {\n\t\t\t\t\tcallId: this.callId,\n\t\t\t\t\tphoneCrm: this.phoneCrm,\n\t\t\t\t\tdeviceType: this.deviceType,\n\t\t\t\t\thasExternalCall: this.hasExternalCall,\n\t\t\t\t\tcallView: this.callView.getState()\n\t\t\t\t}, 15);\n\t\t\t}\n\t\t})\n\t}\n\n\thasActiveCall(): boolean\n\t{\n\t\treturn Boolean(this._currentCall || this.callView)\n\t}\n\n\tget currentCall(): ?VoxImplant.Call\n\t{\n\t\treturn this._currentCall\n\t}\n\n\tset currentCall(call: ?VoxImplant.Call)\n\t{\n\t\tif (this._currentCall)\n\t\t{\n\t\t\tthis.#removeCallEventListeners(this._currentCall);\n\n\t\t\tthis.emit(Events.onCallDestroyed, {\n\t\t\t\tcall: this._currentCall\n\t\t\t});\n\t\t}\n\t\tcall?.id()\n\t\t\t? BX.localStorage.set(lsKeys.currentCall, call?.id(), 86400)\n\t\t\t: BX.localStorage.remove(lsKeys.currentCall)\n\t\t;\n\n\t\tthis._currentCall = call;\n\t\tthis.hasActiveCallView = Boolean(this._currentCall);\n\n\t\tif (this._currentCall)\n\t\t{\n\t\t\tthis.#setCallEventListeners(call);\n\t\t\tthis.emit(Events.onCallCreated, {\n\t\t\t\tcall: call\n\t\t\t});\n\t\t}\n\t}\n\n\t#setCallEventListeners(call: VoxImplant.Call)\n\t{\n\t\tcall.addEventListener(VoxImplant.CallEvents.Connected, this.onCallConnectedHandler);\n\t\tcall.addEventListener(VoxImplant.CallEvents.Disconnected, this.onCallDisconnectedHandler);\n\t\tcall.addEventListener(VoxImplant.CallEvents.Failed, this.onCallFailedHandler);\n\t\tcall.addEventListener(VoxImplant.CallEvents.ProgressToneStart, this.onProgressToneStartHandler);\n\t\tcall.addEventListener(VoxImplant.CallEvents.ProgressToneStop, this.onProgressToneStopHandler);\n\t}\n\n\t#removeCallEventListeners(call: VoximplantCall)\n\t{\n\t\tcall.removeEventListener(VoxImplant.CallEvents.Connected, this.onCallConnectedHandler);\n\t\tcall.removeEventListener(VoxImplant.CallEvents.Disconnected, this.onCallDisconnectedHandler);\n\t\tcall.removeEventListener(VoxImplant.CallEvents.Failed, this.onCallFailedHandler);\n\t\tcall.removeEventListener(VoxImplant.CallEvents.ProgressToneStart, this.onProgressToneStartHandler);\n\t\tcall.removeEventListener(VoxImplant.CallEvents.ProgressToneStop, this.onProgressToneStopHandler);\n\t}\n\n\tready()\n\t{\n\t\treturn true; // TODO ??\n\t}\n\n\tasync readDefaults()\n\t{\n\t\tif (!localStorage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.defaultMicrophone = localStorage.getItem('bx-im-settings-default-microphone');\n\t\tthis.defaultCamera = localStorage.getItem('bx-im-settings-default-camera');\n\t\tthis.defaultSpeaker = localStorage.getItem('bx-im-settings-default-speaker');\n\t\tthis.enableMicAutoParameters = (localStorage.getItem('bx-im-settings-enable-mic-auto-parameters') !== 'N');\n\n\t\tif (\n\t\t\t!navigator.mediaDevices\n\t\t\t|| !navigator.mediaDevices.enumerateDevices\n\t\t\t|| !this.defaultMicrophone\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst deviceList = await navigator.mediaDevices.enumerateDevices();\n\t\tconst result = deviceList.filter(device => device.kind === 'audioinput' && device.deviceId === this.defaultMicrophone);\n\t\tthis.defaultMicrophone = result.length ? this.defaultMicrophone : null;\n\t}\n\n\t#onPullEvent(command, params)\n\t{\n\t\tconst handlers = {\n\t\t\t'invite': this.#onPullInvite,\n\t\t\t'answer_self': this.#onPullAnswerSelf,\n\t\t\t'timeout': this.#onPullTimeout,\n\t\t\t'outgoing': this.#onPullOutgoing,\n\t\t\t'start': this.#onPullStart,\n\t\t\t'hold': this.#onPullHold,\n\t\t\t'unhold': this.#onPullUnhold,\n\t\t\t'update_crm': this.#onPullUpdateCrm,\n\t\t\t'updatePortalUser': this.#onPullUpdatePortalUser,\n\t\t\t'completeTransfer': this.#onPullCompleteTransfer,\n\t\t\t'phoneDeviceActive': this.#onPullPhoneDeviceActive,\n\t\t\t'changeDefaultLineId': this.#onPullChangeDefaultLineId,\n\t\t\t'replaceCallerId': this.#onPullReplaceCallerId,\n\t\t\t'showExternalCall': this.#onPullShowExternalCall,\n\t\t\t'hideExternalCall': this.#onPullHideExternalCall,\n\t\t}\n\n\t\tif (handlers.hasOwnProperty(command))\n\t\t{\n\t\t\thandlers[command].apply(this, [params]);\n\t\t}\n\t}\n\n\t#onPullInvite(params)\n\t{\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst popupConditions = this.callView?.popup\n\t\t\t&& !this.callView?.commentShown\n\t\t\t&& !this.callView?.autoCloseTimer\n\t\t\t&& !this.hasActiveCallView\n\t\t;\n\n\t\tif (\n\t\t\t(this.callView && !this.callView?.popup && !this.currentCall)\n\t\t\t|| (popupConditions && !this.currentCall)\n\t\t\t|| (this.callView && this.callView?.isFolded() && !this.currentCall)\n\t\t\t|| this.callView && !this.voximplantClient\n\t\t\t|| (this.callView && this.voximplantClient && !this.voximplantClient.connected())\n\t\t)\n\t\t{\n\t\t\tconsole.log('Close a stuck call view');\n\t\t\tthis.#onCallViewClose();\n\t\t}\n\n\t\tif (\n\t\t\tBX.localStorage.get(lsKeys.callView)\n\t\t\t&& this.callView?.popup\n\t\t\t&& !Boolean(this._currentCall)\n\t\t\t&& !this.isCallListMode()\n\t\t\t&& !this.messengerFacade.hasActiveCall()\n\t\t)\n\t\t{\n\t\t\tthis.showCallViewBalloon();\n\t\t}\n\n\t\tif (this.hasActiveCall() || this.isCallListMode() || this.messengerFacade.hasActiveCall())\n\t\t{\n\t\t\tBX.rest.callMethod('voximplant.call.busy', {\n\t\t\t\tCALL_ID: params.callId,\n\t\t\t\tDEBUG_INFO: this.getDebugInfo(),\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\tBX.localStorage.get(lsKeys.callInited)\n\t\t\t|| BX.localStorage.get(lsKeys.externalCall)\n\t\t)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.checkDesktop().then(() => {\n\t\t\tif (params.CRM && params.CRM.FOUND)\n\t\t\t{\n\t\t\t\tthis.phoneCrm = params.CRM;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.phoneCrm = {};\n\t\t\t}\n\n\t\t\tthis.phonePortalCall = !!params.portalCall;\n\t\t\tif (this.phonePortalCall && params.portalCallData)\n\t\t\t{\n\t\t\t\tconst userData = params.portalCallData[params.portalCallUserId];\n\t\t\t\tif (userData)\n\t\t\t\t{\n\t\t\t\t\tparams.callerId = userData.name;\n\t\t\t\t}\n\n\t\t\t\tparams.phoneNumber = '';\n\t\t\t}\n\n\t\t\tthis.phoneCallConfig = params.config ? params.config : {};\n\t\t\tthis.phoneCallTime = 0;\n\n\t\t\tthis.messengerFacade.repeatSound('ringtone', 5000, true);\n\n\t\t\tBX.rest.callMethod('voximplant.call.sendWait', {\n\t\t\t\t'CALL_ID': params.callId,\n\t\t\t\t'DEBUG_INFO': this.getDebugInfo()\n\t\t\t})\n\n\t\t\tthis.isCallTransfer = !!params.isTransfer;\n\n\t\t\tthis.displayIncomingCall({\n\t\t\t\tchatId: params.chatId,\n\t\t\t\tcallId: params.callId,\n\t\t\t\tcallerId: params.callerId,\n\t\t\t\tlineNumber: params.lineNumber,\n\t\t\t\tcompanyPhoneNumber: params.phoneNumber,\n\t\t\t\tisCallback: params.isCallback,\n\t\t\t\tshowCrmCard: params.showCrmCard,\n\t\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\t\tcrmActivityId: params.crmActivityId,\n\t\t\t\tcrmActivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\tportalCall: params.portalCall,\n\t\t\t\tportalCallUserId: params.portalCallUserId,\n\t\t\t\tportalCallData: params.portalCallData,\n\t\t\t\tconfig: params.config\n\t\t\t});\n\t\t}).catch(() => {});\n\t}\n\n\t#onPullAnswerSelf(params)\n\t{\n\t\tthis.clearSkipIncomingCallTimer();\n\t\tif (this.callSelfDisabled || this.callId != params.callId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort();\n\t\tthis.callView.close();\n\n\t\tthis.callId = params.callId;\n\t}\n\n\t#onPullTimeout(params)\n\t{\n\t\tthis.clearSkipIncomingCallTimer();\n\n\t\tif (this.phoneTransferCallId === params.callId)\n\t\t{\n\t\t\treturn this.errorInviteTransfer(params.failedCode, params.failedReason);\n\t\t}\n\t\telse if (this.callId != params.callId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tclearInterval(this.phoneConnectedInterval);\n\t\tBX.localStorage.remove(lsKeys.callInited);\n\n\t\tvar external = this.hasExternalCall;\n\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort();\n\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn\n\t\t}\n\n\t\tthis.showCallViewBalloon();\n\t\tthis.callView.setCallState(CallState.idle, {failedCode: params.failedCode});\n\t\tif (external && params.failedCode == 486)\n\t\t{\n\t\t\tthis.callView.setProgress(CallProgress.offline);\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_ERROR_BUSY_PHONE'));\n\t\t\tthis.callView.setUiState(UiState.sipPhoneError);\n\t\t}\n\t\telse if (external && params.failedCode == 480)\n\t\t{\n\t\t\tthis.callView.setProgress(CallProgress.error);\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_ERROR_NA_PHONE'));\n\t\t\tthis.callView.setUiState(UiState.sipPhoneError);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.isCallListMode())\n\t\t\t{\n\t\t\t\tthis.callView.setStatusText('');\n\t\t\t\tthis.callView.setUiState(UiState.outgoing);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_END'));\n\t\t\t\tthis.callView.setUiState(UiState.idle);\n\t\t\t\tthis.callView.autoClose();\n\t\t\t}\n\t\t}\n\t}\n\n\t#onPullOutgoing(params)\n\t{\n\t\tif (this.phoneNumber && (this.phoneNumber === params.phoneNumber || params.phoneNumber.indexOf(this.phoneNumber) >= 0))\n\t\t{\n\t\t\tthis.deviceType = params.callDevice == DeviceType.Phone ? DeviceType.Phone : DeviceType.Webrtc;\n\t\t\tthis.phonePortalCall = !!params.portalCall;\n\n\t\t\tthis.phoneNumber = params.phoneNumber;\n\n\t\t\tif (this.hasExternalCall && this.deviceType == DeviceType.Phone)\n\t\t\t{\n\t\t\t\tthis.callView.setProgress(CallProgress.connect);\n\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_WAIT_ANSWER'));\n\t\t\t}\n\n\t\t\tthis.phoneCallConfig = params.config ? params.config : {};\n\t\t\tthis.callId = params.callId;\n\t\t\tthis.phoneCallTime = 0;\n\t\t\tthis.phoneCrm = params.CRM;\n\t\t\tif (this.callView && params.showCrmCard)\n\t\t\t{\n\t\t\t\tthis.callView.setCrmData(params.CRM);\n\t\t\t\tthis.callView.setCrmEntity({\n\t\t\t\t\ttype: params.crmEntityType,\n\t\t\t\t\tid: params.crmEntityId,\n\t\t\t\t\tactivityId: params.crmActivityId,\n\t\t\t\t\tactivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\t\tbindings: params.crmBindings\n\t\t\t\t});\n\t\t\t\tthis.callView.setConfig(params.config);\n\t\t\t\tthis.callView.setCallId(params.callId);\n\t\t\t\tif (params.lineNumber)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setLineNumber(params.lineNumber);\n\t\t\t\t}\n\n\t\t\t\tif (params.lineName)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setCompanyPhoneNumber(params.lineName);\n\t\t\t\t}\n\n\t\t\t\tthis.callView.reloadCrmCard();\n\t\t\t}\n\n\t\t\tif (this.callView && this.phonePortalCall)\n\t\t\t{\n\t\t\t\tthis.callView.setPortalCall(true);\n\t\t\t\tthis.callView.setPortalCallData(params.portalCallData);\n\t\t\t\tthis.callView.setPortalCallUserId(params.portalCallUserId);\n\t\t\t\tthis.callView.setPortalCallQueueName(params.portalCallQueueName);\n\t\t\t}\n\t\t}\n\t\telse if (!this.hasActiveCall() && params.callDevice === DeviceType.Phone)\n\t\t{\n\t\t\tthis.checkDesktop().then(() =>\n\t\t\t{\n\t\t\t\tthis.deviceType = params.callDevice === DeviceType.Phone ? DeviceType.Phone : DeviceType.Webrtc;\n\t\t\t\tthis.phonePortalCall = !!params.portalCall;\n\t\t\t\tthis.callId = params.callId;\n\t\t\t\tthis.phoneCallTime = 0;\n\t\t\t\tthis.phoneCallConfig = params.config ? params.config : {};\n\t\t\t\tthis.phoneCrm = params.CRM;\n\n\t\t\t\tthis.phoneDisplayExternal({\n\t\t\t\t\tcallId: params.callId,\n\t\t\t\t\tconfig: params.config ? params.config : {},\n\t\t\t\t\tphoneNumber: params.phoneNumber,\n\t\t\t\t\tportalCall: params.portalCall,\n\t\t\t\t\tportalCallUserId: params.portalCallUserId,\n\t\t\t\t\tportalCallData: params.portalCallData,\n\t\t\t\t\tportalCallQueueName: params.portalCallQueueName,\n\t\t\t\t\tshowCrmCard: params.showCrmCard,\n\t\t\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\t\t\tcrmEntityId: params.crmEntityId\n\t\t\t\t});\n\t\t\t}).catch(() => {});\n\t\t}\n\t}\n\n\t#onPullStart(params)\n\t{\n\t\tthis.clearSkipIncomingCallTimer();\n\n\t\tif (this.phoneTransferCallId === params.callId)\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_TRANSFER_CONNECTED'));\n\t\t\treturn;\n\t\t}\n\t\tif (this.callId != params.callId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callOverlayTimer('start');\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\t\tif (this.callId == params.callId && this.deviceType == DeviceType.Phone && (this.deviceType == params.callDevice || this.phonePortalCall))\n\t\t{\n\t\t\tthis.#onCallConnected();\n\t\t}\n\t\telse if (this.callId == params.callId && params.callDevice == DeviceType.Phone && this.phoneIncoming)\n\t\t{\n\t\t\tthis.deviceType = DeviceType.Phone;\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setDeviceCall(true);\n\t\t\t}\n\t\t\tthis.#onCallConnected();\n\t\t}\n\t\tif (params.CRM)\n\t\t{\n\t\t\tthis.phoneCrm = params.CRM;\n\t\t}\n\n\t\tif (this.phoneNumber !== '')\n\t\t{\n\t\t\tthis.phoneNumberLast = this.phoneNumber;\n\t\t\tthis.messengerFacade.setLocalConfig('phone_last', this.phoneNumber);\n\t\t}\n\t}\n\n\t#onPullHold(params)\n\t{\n\t\tif (this.callId == params.callId)\n\t\t{\n\t\t\tthis.isCallHold = true;\n\t\t}\n\t}\n\n\t#onPullUnhold(params)\n\t{\n\t\tif (this.callId == params.callId)\n\t\t{\n\t\t\tthis.isCallHold = false;\n\t\t}\n\t}\n\n\t#onPullUpdateCrm(params)\n\t{\n\t\tif (this.callId == params.callId && params.CRM && params.CRM.FOUND)\n\t\t{\n\t\t\tthis.phoneCrm = params.CRM;\n\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setCrmData(params.CRM);\n\t\t\t\tif (params.showCrmCard)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setCrmEntity({\n\t\t\t\t\t\ttype: params.crmEntityType,\n\t\t\t\t\t\tid: params.crmEntityId,\n\t\t\t\t\t\tactivityId: params.crmActivityId,\n\t\t\t\t\t\tactivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\t\t\tbindings: params.crmBindings\n\t\t\t\t\t});\n\t\t\t\t\tthis.callView.reloadCrmCard();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#onPullUpdatePortalUser(params)\n\t{\n\t\tif (this.callId == params.callId && this.callView)\n\t\t{\n\t\t\tthis.callView.setPortalCall(true);\n\t\t\tthis.callView.setPortalCallData(params.portalCallData);\n\t\t\tthis.callView.setPortalCallUserId(params.portalCallUserId);\n\t\t}\n\t}\n\n\t#onPullCompleteTransfer(params)\n\t{\n\t\tif (this.callId != params.callId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.callId = params.newCallId;\n\n\t\tthis.phoneTransferTargetId = 0;\n\t\tthis.phoneTransferTargetType = '';\n\t\tthis.phoneTransferCallId = '';\n\t\tthis.phoneTransferEnabled = false;\n\t\tBX.localStorage.set(lsKeys.vite, false, 1);\n\n\t\tthis.deviceType = params.callDevice == DeviceType.Phone ? DeviceType.Phone : DeviceType.Webrtc;\n\t\tif (this.deviceType == DeviceType.Phone)\n\t\t{\n\t\t\tthis.callView.setDeviceCall(true);\n\t\t}\n\t\tthis.callView.setTransfer(false);\n\t\tthis.#onCallConnected();\n\t}\n\n\t#onPullPhoneDeviceActive(params)\n\t{\n\t\tthis.hasSipPhone = params.active == 'Y';\n\t}\n\n\t#onPullChangeDefaultLineId(params)\n\t{\n\t\tthis.defaultLineId = params.defaultLineId;\n\t}\n\n\t#onPullReplaceCallerId(params)\n\t{\n\t\tvar callTitle = Loc.getMessage('IM_PHONE_CALL_TRANSFER').replace('#PHONE#', params.callerId);\n\t\tthis.setCallOverlayTitle(callTitle);\n\t\tthis.callView.setPhoneNumber(params.callerId);\n\t\tif (params.CRM)\n\t\t{\n\t\t\tthis.phoneCrm = params.CRM;\n\t\t\tthis.callView.setCrmData(params.CRM);\n\t\t\tif (params.showCrmCard)\n\t\t\t{\n\t\t\t\tthis.callView.setCrmEntity({\n\t\t\t\t\ttype: params.crmEntityType,\n\t\t\t\t\tid: params.crmEntityId,\n\t\t\t\t\tactivityId: params.crmActivityId,\n\t\t\t\t\tactivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\t\tbindings: params.crmBindings\n\t\t\t\t});\n\t\t\t\tthis.callView.reloadCrmCard();\n\t\t\t}\n\t\t}\n\t}\n\n\t#onPullShowExternalCall(params)\n\t{\n\t\tif (this.messengerFacade.hasActiveCall())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (BX.localStorage.get(lsKeys.callInited) || BX.localStorage.get(lsKeys.externalCall))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.checkDesktop().then(() =>\n\t\t{\n\t\t\tif (params.CRM && params.CRM.FOUND)\n\t\t\t{\n\t\t\t\tthis.phoneCrm = params.CRM;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.phoneCrm = {};\n\t\t\t}\n\n\t\t\tthis.showExternalCall({\n\t\t\t\tcallId: params.callId,\n\t\t\t\tfromUserId: params.fromUserId,\n\t\t\t\ttoUserId: params.toUserId,\n\t\t\t\tisCallback: params.isCallback,\n\t\t\t\tphoneNumber: params.phoneNumber,\n\t\t\t\tlineNumber: params.lineNumber,\n\t\t\t\tcompanyPhoneNumber: params.companyPhoneNumber,\n\t\t\t\tshowCrmCard: params.showCrmCard,\n\t\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\t\tcrmBindings: params.crmBindings,\n\t\t\t\tcrmActivityId: params.crmActivityId,\n\t\t\t\tcrmActivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\tconfig: params.config,\n\t\t\t\tportalCall: params.portalCall,\n\t\t\t\tportalCallData: params.portalCallData,\n\t\t\t\tportalCallUserId: params.portalCallUserId\n\t\t\t});\n\t\t}).catch(() => {});\n\t}\n\n\t#onPullHideExternalCall(params)\n\t{\n\t\tif (this.hasActiveCall() && this.hasExternalCall && this.callId == params.callId)\n\t\t{\n\t\t\tthis.hideExternalCall();\n\t\t}\n\t}\n\n\tcorrectPhoneNumber(number)\n\t{\n\t\treturn number.toString().replace(/[^0-9+#*;,]/g, '');\n\t}\n\n\t#onIncomingCall(params)\n\t{\n\t\t// we can't use hasActiveCall here because the call view is open\n\t\tif (this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.currentCall = params.call;\n\t\tthis.currentCall.answer();\n\t}\n\n\tgetCallParams()\n\t{\n\t\tlet result = Type.isPlainObject(this.phoneParams) ? Runtime.clone(this.phoneParams) : {};\n\t\tif (this.phoneFullNumber != this.phoneNumber)\n\t\t{\n\t\t\tresult['FULL_NUMBER'] = this.phoneFullNumber;\n\t\t}\n\t\treturn JSON.stringify(result);\n\t}\n\n\t#startCall()\n\t{\n\t\tthis.phoneParams['CALLER_ID'] = '';\n\t\tthis.phoneParams['USER_ID'] = this.userId;\n\t\tthis.phoneLog('Call params: ', this.phoneNumber, this.phoneParams);\n\t\tif (!this.voximplantClient.connected())\n\t\t{\n\t\t\tthis.#phoneOnSDKReady();\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.currentCall = this.voximplantClient.call(this.phoneNumber, false, this.getCallParams());\n\n\t\tconst initParams = {\n\t\t\t'NUMBER': this.phoneNumber,\n\t\t\t'NUMBER_USER': Text.decode(this.phoneNumberUser),\n\t\t\t'IM_AJAX_CALL': 'Y',\n\t\t}\n\t\tBX.rest.callMethod('voximplant.call.init', initParams).then((response) =>\n\t\t{\n\t\t\tconst data = response.data();\n\t\t\tif (!(data.HR_PHOTO.length === 0))\n\t\t\t{\n\t\t\t\tthis.callOverlayUserId = data.DIALOG_ID;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callOverlayChatId = data.DIALOG_ID.substring(4);\n\t\t\t}\n\t\t})\n\t}\n\n\tphoneCallFinish()\n\t{\n\t\tclearInterval(this.phoneConnectedInterval);\n\t\tclearInterval(this.phoneCallTimeInterval);\n\t\tBX.localStorage.remove(lsKeys.callInited);\n\n\t\tthis.callOverlayTimer('pause');\n\t\tthis.showCallViewBalloon();\n\n\t\tif (this.currentCall)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.currentCall.hangup({\n\t\t\t\t\t\"X-Disconnect-Code\": 200,\n\t\t\t\t\t\"X-Disconnect-Reason\": \"Normal hangup\"\n\t\t\t\t});\n\t\t\t} catch (e)\n\t\t\t{}\n\t\t\tthis.currentCall = null;\n\t\t\tthis.phoneLog('Call hangup call');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.scheduleApiDisconnect();\n\t\t}\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\n\t\tBX.localStorage.set(lsKeys.vite, false, 1);\n\n\t\tthis.phoneRinging = 0;\n\t\tthis.phoneIncoming = false;\n\t\tthis.callActive = false;\n\t\tthis.callId = '';\n\t\tthis.hasExternalCall = false;\n\t\tthis.deviceType = DeviceType.Webrtc;\n\t\t//this.phonePortalCall = false;\n\t\tthis.phoneNumber = '';\n\t\tthis.phoneNumberUser = '';\n\t\tthis.phoneParams = {};\n\t\tthis.callOverlayOptions = {};\n\t\tthis.callSelfDisabled = false;\n\t\t//this.phoneCrm = {};\n\t\tthis.isMuted = false;\n\t\tthis.isCallHold = false;\n\t\tthis.isCallTransfer = false;\n\t\tthis.phoneMicAccess = false;\n\t\tthis.phoneTransferTargetType = '';\n\t\tthis.phoneTransferTargetId = 0;\n\t\tthis.phoneTransferCallId = '';\n\t\tthis.phoneTransferEnabled = false;\n\t}\n\n\tphoneOnAuthResult()\n\t{\n\t\tif (this.deviceType == DeviceType.Phone)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.phoneIncoming)\n\t\t{\n\t\t\tBX.rest.callMethod('voximplant.call.sendReady', {'CALL_ID': this.callId});\n\t\t}\n\t\telse if (this.callInitUserId == this.userId)\n\t\t{\n\t\t\tthis.#startCall();\n\t\t}\n\t}\n\n\t#onCallFailed(e)\n\t{\n\t\tconst headers = e.headers || {};\n\t\tthis.phoneLog('Call failed', e.code, e.reason);\n\n\t\tvar reason = Loc.getMessage('IM_PHONE_END');\n\t\tif (e.code == 603)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_DECLINE');\n\t\t}\n\t\telse if (e.code == 380)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERR_SIP_LICENSE');\n\t\t}\n\t\telse if (e.code == 436)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERR_NEED_RENT');\n\t\t}\n\t\telse if (e.code == 438)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERR_BLOCK_RENT');\n\t\t}\n\t\telse if (e.code == 400)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERR_LICENSE');\n\t\t}\n\t\telse if (e.code == 401)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_401');\n\t\t}\n\t\telse if (e.code == 480 || e.code == 503)\n\t\t{\n\t\t\tif (this.phoneNumber == 911 || this.phoneNumber == 112)\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_NO_EMERGENCY');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_UNAVAILABLE');\n\t\t\t}\n\t\t}\n\t\telse if (e.code == 484 || e.code == 404)\n\t\t{\n\t\t\tif (this.phoneNumber == 911 || this.phoneNumber == 112)\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_NO_EMERGENCY');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_INCOMPLETED');\n\t\t\t}\n\t\t}\n\t\telse if (e.code == 402)\n\t\t{\n\t\t\tif (headers.hasOwnProperty('X-Reason') && headers['X-Reason'] === \"SIP_PAYMENT_REQUIRED\")\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_ERR_SIP_LICENSE');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_NO_MONEY') + (this.isAdmin ? ' ' + Loc.getMessage('IM_PHONE_PAY_URL_NEW') : '');\n\t\t\t}\n\t\t}\n\t\telse if (e.code == 486 && this.phoneRinging > 1)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_M_CALL_ST_DECLINE');\n\t\t}\n\t\telse if (e.code == 486)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERROR_BUSY');\n\t\t}\n\t\telse if (e.code == 403)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_403');\n\t\t\tthis.phoneServer = '';\n\t\t\tthis.phoneLogin = '';\n\t\t\tthis.phoneCheckBalance = true;\n\t\t}\n\t\telse if (e.code == 504)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERROR_CONNECT');\n\t\t}\n\t\telse\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERROR');\n\t\t}\n\n\t\tif (e.code == 408 || e.code == 403)\n\t\t{\n\t\t\tthis.scheduleApiDisconnect();\n\t\t}\n\t\tthis.callOverlayProgress('offline');\n\t\tthis.callAbort(reason);\n\n\t\tthis.callView.setUiState(UiState.error);\n\t\tthis.callView.setCallState(CallState.idle);\n\t}\n\n\tscheduleApiDisconnect()\n\t{\n\t\tif (this.voximplantClient && this.voximplantClient.connected())\n\t\t{\n\t\t\tsetTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.voximplantClient && this.voximplantClient.connected())\n\t\t\t\t{\n\t\t\t\t\tthis.voximplantClient.disconnect();\n\t\t\t\t}\n\t\t\t}, 500);\n\t\t}\n\t}\n\n\t#onCallDisconnected(e)\n\t{\n\t\tthis.phoneLog('Call disconnected', this.currentCall ? this.currentCall.id() : '-', this.currentCall ? this.currentCall.state() : '-');\n\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.phoneCallFinish();\n\t\t\tthis.callOverlayDeleteEvents();\n\t\t\tthis.callOverlayStatus(Loc.getMessage('IM_M_CALL_ST_END'));\n\n\t\t\tthis.messengerFacade.playSound('stop');\n\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t\tif (this.isCallListMode())\n\t\t\t{\n\t\t\t\tthis.callView.setUiState(UiState.outgoing);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_END'));\n\t\t\t\tthis.callView.setUiState(UiState.idle);\n\t\t\t\tthis.callView.autoClose();\n\t\t\t}\n\t\t}\n\n\t\tthis.scheduleApiDisconnect();\n\t}\n\n\t#onProgressToneStart(e)\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.phoneLog('Progress tone start', this.currentCall.id());\n\t\tthis.phoneRinging++;\n\t\tthis.callOverlayStatus(Loc.getMessage('IM_PHONE_WAIT_ANSWER'));\n\t}\n\n\t#onProgressToneStop(e)\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tthis.phoneLog('Progress tone stop', this.currentCall.id());\n\t}\n\n\t#onConnectionEstablished(e)\n\t{\n\t\tthis.phoneLog('Connection established', this.voximplantClient.connected());\n\t}\n\n\t#onConnectionFailed(e)\n\t{\n\t\tthis.phoneLog('Connection failed');\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort(Loc.getMessage('IM_M_CALL_ERR'));\n\t}\n\n\t#onConnectionClosed(e)\n\t{\n\t\tthis.phoneLog('Connection closed');\n\t}\n\n\t#onMicResult(e)\n\t{\n\t\tthis.phoneMicAccess = e.result;\n\t\tthis.phoneLog('Mic Access Allowed', e.result);\n\n\t\tif (e.result)\n\t\t{\n\t\t\tthis.callOverlayProgress('connect');\n\t\t\tthis.callOverlayStatus(Loc.getMessage('IM_M_CALL_ST_CONNECT'));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.phoneCallFinish();\n\t\t\tthis.callOverlayProgress('offline');\n\t\t\tthis.callAbort(Loc.getMessage('IM_M_CALL_ST_NO_ACCESS'));\n\n\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t}\n\t}\n\n\t#onNetStatsReceived(e)\n\t{\n\t\tif (!this.currentCall || this.currentCall.state() != \"CONNECTED\")\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst percent = (100 - parseInt(e.stats.packetLoss));\n\t\tconst grade = this.displayCallQuality(percent);\n\n\t\tthis.currentCall.sendMessage(JSON.stringify({\n\t\t\t'COMMAND': 'meter',\n\t\t\t'PACKETLOSS': e.stats.packetLoss,\n\t\t\t'PERCENT': percent,\n\t\t\t'GRADE': grade\n\t\t}));\n\t}\n\n\tholdCall()\n\t{\n\t\tthis.toggleCallHold(true);\n\t}\n\n\tunholdCall()\n\t{\n\t\tthis.toggleCallHold(false);\n\t}\n\n\ttoggleCallHold(state)\n\t{\n\t\tif (!this.currentCall && this.deviceType == DeviceType.Webrtc)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (typeof (state) != 'undefined')\n\t\t{\n\t\t\tthis.isCallHold = !state;\n\t\t}\n\n\t\tif (this.isCallHold)\n\t\t{\n\t\t\tif (this.deviceType === DeviceType.Webrtc)\n\t\t\t{\n\t\t\t\tthis.currentCall.sendMessage(JSON.stringify({'COMMAND': 'unhold'}));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.rest.callMethod('voximplant.call.unhold', {'CALL_ID': this.callId});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.deviceType === DeviceType.Webrtc)\n\t\t\t{\n\t\t\t\tthis.currentCall.sendMessage(JSON.stringify({'COMMAND': 'hold'}));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.rest.callMethod('voximplant.call.hold', {'CALL_ID': this.callId});\n\t\t\t}\n\t\t}\n\t\tthis.isCallHold = !this.isCallHold;\n\t}\n\n\tsendDTMF(key)\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.phoneLog('Send DTMF code', this.currentCall.id(), key);\n\n\t\tthis.currentCall.sendTone(key);\n\t}\n\n\tstartCallViaRestApp(number, lineId, params)\n\t{\n\t\tBX.rest.callMethod(\n\t\t\t'voximplant.call.startViaRest',\n\t\t\t{\n\t\t\t\t'NUMBER': number,\n\t\t\t\t'LINE_ID': lineId,\n\t\t\t\t'PARAMS': params,\n\t\t\t\t'SHOW': 'Y'\n\t\t\t}\n\t\t);\n\t}\n\n\tphoneSupport()\n\t{\n\t\treturn this.phoneEnabled && (this.hasSipPhone || this.ready());\n\t}\n\n\tmuteCall()\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.isMuted = true;\n\t\tthis.currentCall.muteMicrophone();\n\t}\n\n\tunmuteCall()\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.isMuted = false;\n\t\tthis.currentCall.unmuteMicrophone();\n\t}\n\n\ttoggleCallAudio()\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.isMuted)\n\t\t{\n\t\t\tthis.currentCall.unmuteMicrophone();\n\t\t\tthis.callView.setMuted(false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.currentCall.muteMicrophone();\n\t\t}\n\t\tthis.isMuted = !this.isMuted;\n\t}\n\n\tphoneDeviceCall(status)\n\t{\n\t\tlet result = true;\n\t\tif (typeof (status) == 'boolean')\n\t\t{\n\t\t\tthis.messengerFacade.setLocalConfig('viDeviceCallBlock', !status);\n\t\t\tBX.localStorage.set('viDeviceCallBlock', !status, 86400);\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setDeviceCall(status);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet deviceCallBlock = this.messengerFacade.getLocalConfig('viDeviceCallBlock');\n\t\t\tif (!deviceCallBlock)\n\t\t\t{\n\t\t\t\tdeviceCallBlock = BX.localStorage.get('viDeviceCallBlock');\n\t\t\t}\n\t\t\tresult = this.hasSipPhone && !deviceCallBlock;\n\t\t}\n\t\treturn result;\n\n\t}\n\n\topenKeyPad(e = {})\n\t{\n\t\tif (Loc.getMessage[\"voximplantCanMakeCalls\"] == \"N\")\n\t\t{\n\t\t\tRuntime.loadExtension(\"voximplant.common\").then(() => BX.Voximplant.openLimitSlider());\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loadPhoneLines().then(() => this.#doOpenKeyPad(e));\n\t}\n\n\t#doOpenKeyPad(e)\n\t{\n\t\tif (!this.phoneSupport() && !this.isRestLine(this.defaultLineId))\n\t\t{\n\t\t\tthis.showUnsupported();\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.hasActiveCall() || BX.localStorage.get(lsKeys.callInited) || BX.localStorage.get(lsKeys.externalCall))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.keypad = new Keypad({\n\t\t\tbindElement: e.bindElement,\n\t\t\toffsetTop: e.offsetTop,\n\t\t\toffsetLeft: e.offsetLeft,\n\t\t\tanglePosition: e.anglePosition,\n\t\t\tangleOffset: e.angleOffset,\n\t\t\tdefaultLineId: this.defaultLineId,\n\t\t\tlines: this.phoneLines,\n\t\t\tavailableLines: this.availableLines,\n\t\t\thistory: this.dialHistory,\n\t\t\tcallInterceptAllowed: this.callInterceptAllowed,\n\n\t\t\tonDial: this.onKeyPadDial.bind(this),\n\t\t\tonIntercept: this.onKeyPadIntercept.bind(this),\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.onKeyPadClose();\n\t\t\t\tif (Type.isFunction(e.onClose))\n\t\t\t\t{\n\t\t\t\t\te.onClose()\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.keypad.show();\n\t}\n\n\tonKeyPadDial(e)\n\t{\n\t\tlet params = {};\n\t\tthis.closeKeyPad()\n\n\t\tif (e.lineId)\n\t\t{\n\t\t\tparams['LINE_ID'] = e.lineId;\n\t\t}\n\n\t\tthis.phoneCall(e.phoneNumber, params);\n\t}\n\n\tonKeyPadIntercept(e)\n\t{\n\t\tif (!this.callInterceptAllowed)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t\tif ('UI' in BX && 'InfoHelper' in BX.UI)\n\t\t\t{\n\t\t\t\tBX.UI.InfoHelper.show('limit_contact_center_telephony_intercept');\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tBX.rest.callMethod('voximplant.call.intercept').then((response) =>\n\t\t{\n\t\t\tconst data = response.data();\n\n\t\t\tif (!data.FOUND || data.FOUND == 'Y')\n\t\t\t{\n\t\t\t\tthis.keypad.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (data.ERROR)\n\t\t\t\t{\n\t\t\t\t\tthis.interceptErrorPopup = new Popup({\n\t\t\t\t\t\tid: 'intercept-call-error',\n\t\t\t\t\t\tbindElement: e.interceptButton,\n\t\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t\t\tcontent: Text.encode(data.ERROR),\n\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\t\tcacheable: false,\n\t\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\t\tposition: 'bottom'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tangle: {\n\t\t\t\t\t\t\toffset: 40\n\t\t\t\t\t\t},\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonPopupClose: (e) => this.interceptErrorPopup = null,\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tthis.interceptErrorPopup.show();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tonKeyPadClose()\n\t{\n\t\tthis.keypad = null;\n\t}\n\n\tcloseKeyPad()\n\t{\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\t}\n\n\tphoneDisplayExternal(params)\n\t{\n\t\tvar number = params.phoneNumber;\n\t\tthis.phoneLog(number, params);\n\n\t\tthis.phoneNumberUser = Text.encode(number);\n\n\t\tnumber = this.correctPhoneNumber(number);\n\t\tif (typeof (params) != 'object')\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tif (this.callActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.initiator = true;\n\t\tthis.callInitUserId = this.userId;\n\t\tthis.callActive = false;\n\t\tthis.callUserId = 0;\n\t\tthis.phoneNumber = number;\n\n\t\tthis.callView = new PhoneCallView({\n\t\t\tcallId: params.callId,\n\t\t\tconfig: params.config,\n\t\t\tdirection: Direction.outgoing,\n\t\t\tphoneNumber: this.phoneNumber,\n\t\t\tstatusText: Loc.getMessage('IM_M_CALL_ST_CONNECT'),\n\t\t\thasSipPhone: true,\n\t\t\tdeviceCall: true,\n\t\t\tportalCall: params.portalCall,\n\t\t\tportalCallUserId: params.portalCallUserId,\n\t\t\tportalCallData: params.portalCallData,\n\t\t\tportalCallQueueName: params.portalCallQueueName,\n\t\t\tcrm: params.showCrmCard,\n\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\tcrmData: this.phoneCrm,\n\t\t\tfoldedCallView: this.foldedCallView,\n\t\t\tbackgroundWorker: this.backgroundWorker,\n\t\t\tmessengerFacade: this.messengerFacade,\n\t\t\trestApps: this.restApps,\n\t\t});\n\t\tthis.#bindPhoneViewCallbacks(this.callView);\n\t\tthis.callView.setUiState(UiState.idle);\n\t\tthis.callView.setCallState(CallState.connected);\n\t\tthis.callView.show();\n\t}\n\n\tloadPhoneLines()\n\t{\n\t\tconst cachedLines = BX.localStorage.get('bx-im-phone-lines');\n\t\tif (cachedLines)\n\t\t{\n\t\t\tthis.phoneLines = cachedLines;\n\t\t\treturn Promise.resolve(cachedLines);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (this.phoneLines)\n\t\t\t{\n\t\t\t\treturn resolve(this.phoneLines);\n\t\t\t}\n\n\t\t\tBX.ajax.runAction(\"voximplant.callView.getLines\").then((response) =>\n\t\t\t{\n\t\t\t\tthis.phoneLines = response.data;\n\t\t\t\tBX.localStorage.set('bx-im-phone-lines', this.phoneLines, 86400);\n\t\t\t\t{\n\t\t\t\t\tresolve(this.phoneLines);\n\t\t\t\t}\n\t\t\t}).catch((err) =>\n\t\t\t{\n\t\t\t\tconsole.error(err);\n\t\t\t\treject(err)\n\t\t\t})\n\t\t})\n\t}\n\n\tisRestLine(lineId)\n\t{\n\t\tif (!this.phoneLines)\n\t\t{\n\t\t\tthrow new Error(\"Phone lines are not loaded. Call PhoneCallsController.loadPhoneLines prior to using this method\")\n\t\t}\n\n\t\tif (this.phoneLines.hasOwnProperty(lineId))\n\t\t{\n\t\t\treturn this.phoneLines[lineId].TYPE === 'REST';\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tsetPhoneNumber(phoneNumber)\n\t{\n\t\tconst matches = /(\\+?\\d+)([;#]*)([\\d,]*)/.exec(phoneNumber);\n\t\tthis.phoneFullNumber = phoneNumber;\n\t\tif (matches)\n\t\t{\n\t\t\tthis.phoneNumber = matches[1];\n\t\t}\n\t}\n\n\tphoneCall(number, params)\n\t{\n\t\tthis.loadPhoneLines().then(() => this.#doPhoneCall(number, params));\n\t}\n\n\t#doPhoneCall(number, params = {})\n\t{\n\t\tif (BX.localStorage.get(lsKeys.callInited) || this.callView || this.hasActiveCall())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\tthis.showUnsupported();\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\n\t\tif (Type.isStringFilled(number))\n\t\t{\n\t\t\tthis.addToHistory(number);\n\t\t}\n\n\t\tconst lineId = Type.isStringFilled(params['LINE_ID']) ? params['LINE_ID'] : this.defaultLineId;\n\t\tif (this.isRestLine(lineId))\n\t\t{\n\t\t\tthis.startCallViaRestApp(number, lineId, params);\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.phoneLog(number, params);\n\n\t\tthis.phoneNumberUser = Text.encode(number);\n\t\tlet numberOriginal = number;\n\n\t\tif (typeof (params) != 'object')\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tconst internationalNumber = this.correctPhoneNumber(number);\n\n\t\tif (internationalNumber.length <= 0)\n\t\t{\n\t\t\tMessageBox.alert(Loc.getMessage('IM_PHONE_WRONG_NUMBER_DESC'), Loc.getMessage('IM_PHONE_WRONG_NUMBER'))\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.setPhoneNumber(internationalNumber);\n\n\t\tthis.initiator = true;\n\t\tthis.callInitUserId = this.userId;\n\t\tthis.callActive = false;\n\t\tthis.callUserId = 0;\n\t\tthis.hasExternalCall = this.phoneDeviceCall();\n\t\tthis.phoneParams = params;\n\n\t\tthis.callView = new PhoneCallView({\n\t\t\tdarkMode: this.messengerFacade.isThemeDark(),\n\n\t\t\tphoneNumber: this.phoneFullNumber,\n\t\t\tcallTitle: this.phoneNumberUser,\n\t\t\tfromUserId: this.userId,\n\t\t\tdirection: Direction.outgoing,\n\t\t\tuiState: UiState.connectingOutgoing,\n\t\t\tstatus: Loc.getMessage('IM_M_CALL_ST_CONNECT'),\n\t\t\thasSipPhone: this.hasSipPhone,\n\t\t\tdeviceCall: this.hasExternalCall,\n\t\t\tcrmData: this.phoneCrm,\n\t\t\tautoFold: (params['AUTO_FOLD'] === true),\n\t\t\tfoldedCallView: this.foldedCallView,\n\t\t\tbackgroundWorker: this.backgroundWorker,\n\t\t\tmessengerFacade: this.messengerFacade,\n\t\t\trestApps: this.restApps,\n\t\t});\n\t\tthis.#bindPhoneViewCallbacks(this.callView);\n\t\tthis.callView.show();\n\n\t\tthis.messengerFacade.playSound(\"start\");\n\n\t\tif (this.hasExternalCall)\n\t\t{\n\t\t\tthis.deviceType = DeviceType.Phone;\n\t\t\tthis.callView.setProgress(CallProgress.wait);\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_PHONE_NOTICE'));\n\n\t\t\tconst callStartParams = {\n\t\t\t\t'NUMBER': numberOriginal.toString().replace(/[^0-9+*#,;]/g, ''),\n\t\t\t\t'PARAMS': params,\n\t\t\t};\n\n\t\t\tBX.rest.callMethod('voximplant.call.startWithDevice', callStartParams)\n\t\t\t\t.then((response) =>\n\t\t\t\t{\n\t\t\t\t\tconst data = response.data();\n\t\t\t\t\tthis.callId = data.CALL_ID;\n\t\t\t\t\tthis.hasExternalCall = (data.EXTERNAL === true);\n\t\t\t\t\tthis.phoneCallConfig = data.CONFIG;\n\t\t\t\t\tthis.callView.setProgress(CallProgress.wait);\n\t\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_WAIT_PHONE'));\n\t\t\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t\t\t\tthis.callView.setCallState(CallState.connecting);\n\n\t\t\t\t\tthis.emit(Events.onDeviceCallStarted, {\n\t\t\t\t\t\tcallId: data.CALL_ID,\n\t\t\t\t\t\tconfig: data.CONFIG\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(err =>\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setProgress(CallProgress.error);\n\t\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_PHONE_ERROR'));\n\t\t\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_CALL_INIT'));\n\n\t\t\tthis.phoneApiInit().then(() => this.#phoneOnSDKReady());\n\t\t}\n\t}\n\n\tshowUnsupported()\n\t{\n\t\tconst messageBox = new MessageBox({\n\t\t\tmessage: Loc.getMessage('IM_CALL_NO_WEBRT'),\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tokCaption: Loc.getMessage('IM_M_CALL_BTN_DOWNLOAD'),\n\t\t\tcancelCaption: Loc.getMessage('IM_NOTIFY_CONFIRM_CLOSE'),\n\t\t\tonOk: () =>\n\t\t\t{\n\t\t\t\tconst url = DesktopDownload.getLinkForCurrentUser();\n\t\t\t\twindow.open(url, \"desktopApp\");\n\t\t\t\treturn true;\n\t\t\t},\n\t\t})\n\t\tmessageBox.show();\n\t}\n\n\taddToHistory(phoneNumber: string)\n\t{\n\t\tlet oldHistory = this.dialHistory;\n\t\tconst phoneIndex = oldHistory.indexOf(phoneNumber);\n\n\t\tif (phoneIndex === 0)\n\t\t{\n\t\t\t//it's the first element already, nothing to do\n\t\t}\n\t\telse if (phoneIndex > 0)\n\t\t{\n\t\t\t//moving number to the top\n\t\t\toldHistory.splice(phoneIndex, phoneIndex);\n\t\t\tthis.dialHistory = [phoneNumber].concat(oldHistory);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//adding as the top element of history\n\t\t\tthis.dialHistory = [phoneNumber].concat(oldHistory.slice(0, 4));\n\t\t}\n\n\t\tBX.localStorage.set(lsKeys.dialHistory, this.dialHistory, 31536000)\n\t\tthis.messengerFacade.setLocalConfig('phone-history', this.dialHistory);\n\t}\n\n\tstartCallList(callListId, params)\n\t{\n\t\tcallListId = Number(callListId);\n\t\tif (callListId === 0 || this.currentCall || this.callView || this.isCallListMode())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tthis.foldedCallView.destroy();\n\n\t\tthis.callListId = callListId;\n\t\tthis.callView = new PhoneCallView({\n\t\t\tcrm: true,\n\t\t\tcallListId: callListId,\n\t\t\tcallListStatusId: params.callListStatusId,\n\t\t\tcallListItemIndex: params.callListItemIndex,\n\t\t\tdirection: Direction.outgoing,\n\t\t\tmakeCall: (params.makeCall === true),\n\t\t\tuiState: UiState.outgoing,\n\t\t\twebformId: params.webformId || 0,\n\t\t\twebformSecCode: params.webformSecCode || '',\n\t\t\thasSipPhone: this.hasSipPhone,\n\t\t\tdeviceCall: this.phoneDeviceCall(),\n\t\t\tcrmData: this.phoneCrm,\n\t\t\tfoldedCallView: this.foldedCallView,\n\t\t\tbackgroundWorker: this.backgroundWorker,\n\t\t\tmessengerFacade: this.messengerFacade,\n\t\t\trestApps: this.restApps,\n\t\t});\n\n\t\tthis.#bindPhoneViewCallbacks(this.callView);\n\t\tthis.callView.show();\n\n\t\treturn true;\n\t}\n\n\tisCallListMode()\n\t{\n\t\treturn (this.callListId > 0);\n\t}\n\n\tcallListMakeCall(e)\n\t{\n\t\tthis.loadPhoneLines().then(() => this.#doCallListMakeCall(e));\n\t}\n\n\t#doCallListMakeCall(e)\n\t{\n\t\tif (this.isRestLine(this.defaultLineId))\n\t\t{\n\t\t\tthis.startCallViaRestApp(\n\t\t\t\te.phoneNumber,\n\t\t\t\tthis.defaultLineId,\n\t\t\t\t{\n\t\t\t\t\t'ENTITY_TYPE': 'CRM_' + e.crmEntityType,\n\t\t\t\t\t'ENTITY_ID': e.crmEntityId,\n\t\t\t\t\t'CALL_LIST_ID': e.callListId\n\t\t\t\t}\n\t\t\t);\n\t\t\treturn true;\n\t\t}\n\n\t\tif (BX.localStorage.get(lsKeys.callInited))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.callActive)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.lastCallListCallParams = e;\n\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_CALL_NO_WEBRT'));\n\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t\treturn false;\n\t\t}\n\n\t\tconst number = e.phoneNumber;\n\t\tconst numberOriginal = number;\n\t\tconst internationalNumber = this.correctPhoneNumber(number);\n\n\t\tif (internationalNumber.length <= 0)\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_WRONG_NUMBER_DESC').replace(\"<br/>\", \"\\n\"));\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.initiator = true;\n\t\tthis.callInitUserId = this.userId;\n\t\tthis.callActive = false;\n\t\tthis.callUserId = 0;\n\t\tthis.hasExternalCall = this.phoneDeviceCall();\n\t\tthis.setPhoneNumber(internationalNumber);\n\t\tthis.phoneParams = {\n\t\t\t'ENTITY_TYPE': 'CRM_' + e.crmEntityType,\n\t\t\t'ENTITY_ID': e.crmEntityId,\n\t\t\t'CALL_LIST_ID': e.callListId\n\t\t};\n\n\t\tthis.messengerFacade.playSound(\"start\");\n\n\t\tif (this.hasExternalCall)\n\t\t{\n\t\t\tthis.deviceType = DeviceType.Phone;\n\t\t\tthis.callView.setProgress(CallProgress.wait);\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_PHONE_NOTICE'));\n\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t\tthis.callView.setCallState(CallState.connecting);\n\t\t\tconst callStartParams = {\n\t\t\t\t'NUMBER': numberOriginal.toString().replace(/[^0-9+*#,;]/g, ''),\n\t\t\t\t'PARAMS': this.phoneParams\n\t\t\t};\n\t\t\tBX.rest.callMethod('voximplant.call.startWithDevice', callStartParams)\n\t\t\t\t.then((response) =>\n\t\t\t\t{\n\t\t\t\t\tconst data = response.data();\n\t\t\t\t\tthis.callId = data.CALL_ID;\n\n\t\t\t\t\t// TODO: is this necessary? It did not work previously\n\t\t\t\t\tthis.hasExternalCall = (data.EXTERNAL === true);\n\t\t\t\t\tthis.phoneCallConfig = data.CONFIG;\n\n\t\t\t\t\tthis.callView.setProgress(CallProgress.wait);\n\t\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_WAIT_PHONE'));\n\t\t\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t\t\t\tthis.callView.setCallState(CallState.connecting);\n\n\t\t\t\t\tthis.emit(Events.onDeviceCallStarted, {\n\t\t\t\t\t\tcallId: data.CALL_ID,\n\t\t\t\t\t\tconfig: data.CONFIG\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(err =>\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setProgress(CallProgress.error);\n\t\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_PHONE_ERROR'));\n\t\t\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_CALL_INIT'));\n\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t\tthis.callView.setCallState(CallState.connecting);\n\t\t\tthis.phoneApiInit().then(() => this.#phoneOnSDKReady());\n\t\t}\n\t}\n\n\tphoneIncomingAnswer()\n\t{\n\t\tthis.clearSkipIncomingCallTimer();\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\t\tthis.callSelfDisabled = true;\n\t\tBX.rest.callMethod('voximplant.call.answer', {'CALL_ID': this.callId});\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\n\t\tthis.callView.setUiState(UiState.connectingIncoming);\n\t\tthis.callView.setCallState(CallState.connecting);\n\n\t\tthis.phoneApiInit().then(\n\t\t\t() => BX.rest.callMethod('voximplant.call.sendReady', {'CALL_ID': this.callId})\n\t\t);\n\t}\n\n\tphoneApiInit()\n\t{\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\treturn Promise.reject('Telephony is not supported');\n\t\t}\n\n\t\tif (this.voximplantClient && this.voximplantClient.connected())\n\t\t{\n\t\t\tif (this.defaultMicrophone)\n\t\t\t{\n\t\t\t\tthis.voximplantClient.useAudioSource(this.defaultMicrophone);\n\t\t\t}\n\t\t\tif (this.defaultSpeaker)\n\t\t\t{\n\t\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().setDefaultAudioSettings({\n\t\t\t\t\toutputId: this.defaultSpeaker\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tlet phoneApiParameters = {\n\t\t\tuseRTCOnly: true,\n\t\t\tmicRequired: true,\n\t\t\tvideoSupport: false,\n\t\t\tprogressTone: false\n\t\t};\n\n\t\tif (this.enableMicAutoParameters === false)\n\t\t{\n\t\t\tphoneApiParameters.audioConstraints = {\n\t\t\t\toptional: [\n\t\t\t\t\t{echoCancellation: false},\n\t\t\t\t\t{googEchoCancellation: false},\n\t\t\t\t\t{googEchoCancellation2: false},\n\t\t\t\t\t{googDAEchoCancellation: false},\n\t\t\t\t\t{googAutoGainControl: false},\n\t\t\t\t\t{googAutoGainControl2: false},\n\t\t\t\t\t{mozAutoGainControl: false},\n\t\t\t\t\t{googNoiseSuppression: false},\n\t\t\t\t\t{googNoiseSuppression2: false},\n\t\t\t\t\t{googHighpassFilter: false},\n\t\t\t\t\t{googTypingNoiseDetection: false},\n\t\t\t\t\t{googAudioMirroring: false}\n\t\t\t\t]\n\t\t\t};\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tBX.Voximplant.getClient({\n\t\t\t\tdebug: this.debug,\n\t\t\t\tapiParameters: phoneApiParameters\n\t\t\t}).then((client) =>\n\t\t\t{\n\t\t\t\tthis.voximplantClient = client;\n\n\t\t\t\tif (this.defaultMicrophone)\n\t\t\t\t{\n\t\t\t\t\tthis.voximplantClient.useAudioSource(this.defaultMicrophone);\n\t\t\t\t}\n\t\t\t\tif (this.defaultSpeaker)\n\t\t\t\t{\n\t\t\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().setDefaultAudioSettings({\n\t\t\t\t\t\toutputId: this.defaultSpeaker\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (this.messengerFacade.isDesktop() && Type.isFunction(this.voximplantClient.setLoggerCallback))\n\t\t\t\t{\n\t\t\t\t\tthis.voximplantClient.enableSilentLogging();\n\t\t\t\t\tthis.voximplantClient.setLoggerCallback(e => this.phoneLog(e.label + \": \" + e.message))\n\t\t\t\t}\n\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.ConnectionFailed, this.#onConnectionFailed.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.ConnectionClosed, this.#onConnectionClosed.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.IncomingCall, this.#onIncomingCall.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.MicAccessResult, this.#onMicResult.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.SourcesInfoUpdated, this.phoneOnInfoUpdated.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.NetStatsReceived, this.#onNetStatsReceived.bind(this));\n\t\t\t\tresolve();\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tBX.rest.callMethod('voximplant.call.onConnectionError', {\n\t\t\t\t\t'CALL_ID': this.callId,\n\t\t\t\t\t'ERROR': e\n\t\t\t\t})\n\n\t\t\t\tthis.phoneCallFinish();\n\t\t\t\tthis.messengerFacade.playSound('error');\n\t\t\t\tthis.callOverlayProgress('offline');\n\t\t\t\tthis.callAbort(Loc.getMessage('IM_PHONE_ERROR'));\n\t\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\t\tthis.callView.setCallState(CallState.idle);\n\n\t\t\t\treject('Could not connect to Voximplant cloud');\n\t\t\t});\n\t\t})\n\t}\n\n\t#phoneOnSDKReady(params)\n\t{\n\t\tthis.phoneLog('SDK ready');\n\n\t\tparams = params || {};\n\t\tparams.delay = params.delay || false;\n\n\t\tif (!params.delay && this.hasSipPhone)\n\t\t{\n\t\t\tif (!this.phoneIncoming && !this.phoneDeviceCall())\n\t\t\t{\n\t\t\t\tthis.callOverlayProgress('wait');\n\t\t\t\tthis.callDialogAllowTimeout = setTimeout(() => this.#phoneOnSDKReady({delay: true}), 5000);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tthis.phoneLog('Connection exists');\n\n\t\tthis.callView.setProgress(CallProgress.connect);\n\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_CONNECT'));\n\t\tthis.phoneOnAuthResult({result: true});\n\t\tthis.callView.setCallState(CallState.connecting);\n\t\tif (this.phoneIncoming)\n\t\t{\n\t\t\tthis.callView.setUiState(UiState.connectingIncoming);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t}\n\t}\n\n\tphoneOnInfoUpdated(e)\n\t{\n\t\tthis.phoneLog('Info updated', this.voximplantClient.audioSources(), this.voximplantClient.videoSources());\n\t}\n\n\t#onCallConnected(e)\n\t{\n\t\tthis.clearSkipIncomingCallTimer();\n\t\tthis.messengerFacade.stopRepeatSound('ringtone', 5000);\n\n\t\tBX.localStorage.set(lsKeys.callInited, true, 7);\n\t\tclearInterval(this.phoneConnectedInterval);\n\t\tthis.phoneConnectedInterval = setInterval(\n\t\t\t() => BX.localStorage.set(lsKeys.callInited, true, 7),\n\t\t\t5000\n\t\t);\n\n\t\t// this.desktop.closeTopmostWindow();\n\n\t\tthis.phoneLog('Call connected', e);\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tBX.localStorage.set(lsKeys.callView, this.callView.callId, 86400);\n\t\t\tthis.callView.setUiState(UiState.connected);\n\t\t\tthis.callView.setCallState(CallState.connected);\n\t\t\tthis.callView.setProgress(CallProgress.online);\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_ONLINE'));\n\t\t}\n\n\t\tthis.callActive = true;\n\n\t\tthis.emit(Events.onCallConnected, {\n\t\t\tcall: this.currentCall,\n\t\t    isIncoming: this.phoneIncoming,\n\t\t\tisDeviceCall: this.phoneDeviceCall(),\n\t\t})\n\t}\n\n\t#bindPhoneViewCallbacks(callView)\n\t{\n\t\tif (!callView instanceof PhoneCallView)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tcallView.setCallback('mute', this.#onCallViewMute.bind(this));\n\t\tcallView.setCallback('unmute', this.#onCallViewUnmute.bind(this));\n\t\tcallView.setCallback('hold', this.#onCallViewHold.bind(this));\n\t\tcallView.setCallback('unhold', this.#onCallViewUnhold.bind(this));\n\t\tcallView.setCallback('answer', this.#onCallViewAnswer.bind(this));\n\t\tcallView.setCallback('skip', this.#onCallViewSkip.bind(this));\n\t\tcallView.setCallback('hangup', this.#onCallViewHangup.bind(this));\n\t\tcallView.setCallback('transfer', this.#onCallViewTransfer.bind(this));\n\t\tcallView.setCallback('cancelTransfer', this.#onCallViewCancelTransfer.bind(this));\n\t\tcallView.setCallback('completeTransfer', this.#onCallViewCompleteTransfer.bind(this));\n\t\tcallView.setCallback('callListMakeCall', this.#onCallViewCallListMakeCall.bind(this));\n\t\tcallView.setCallback('close', this.#onCallViewClose.bind(this));\n\t\tcallView.setCallback('switchDevice', this.#onCallViewSwitchDevice.bind(this));\n\t\tcallView.setCallback('qualityGraded', this.#onCallViewQualityGraded.bind(this));\n\t\tcallView.setCallback('dialpadButtonClicked', this.#onCallViewDialpadButtonClicked.bind(this));\n\t\tcallView.setCallback('saveComment', this.#onCallViewSaveComment.bind(this));\n\t}\n\n\t#onCallViewMute()\n\t{\n\t\tthis.muteCall();\n\t}\n\n\t#onCallViewUnmute()\n\t{\n\t\tthis.unmuteCall();\n\t}\n\n\t#onCallViewHold()\n\t{\n\t\tthis.holdCall();\n\t}\n\n\t#onCallViewUnhold()\n\t{\n\t\tthis.unholdCall();\n\t}\n\n\t#onCallViewAnswer()\n\t{\n\t\tthis.phoneIncomingAnswer();\n\t}\n\n\t#onCallViewSkip()\n\t{\n\t\tBX.rest.callMethod('voximplant.call.skip', {'CALL_ID': this.callId});\n\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort();\n\t\tthis.callView.close();\n\t}\n\n\t#onCallViewHangup()\n\t{\n\t\tif (this.hasExternalCall && this.callId)\n\t\t{\n\t\t\tBX.rest.callMethod('voximplant.call.hangupDevice', {'CALL_ID': this.callId});\n\t\t}\n\n\t\tthis.phoneCallFinish();\n\t\tthis.messengerFacade.playSound('stop');\n\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_FINISHED'));\n\t\tthis.callView.setCallState(CallState.idle);\n\t\tif (this.isCallListMode())\n\t\t{\n\t\t\tthis.callView.setUiState(UiState.outgoing);\n\t\t\tif (this.callView.isFolded())\n\t\t\t{\n\t\t\t\tthis.callView.unfold();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\t}\n\n\t#onCallViewTransfer(e)\n\t{\n\t\tif (e.type == 'user' || e.type == 'pstn' || e.type == 'queue')\n\t\t{\n\t\t\tthis.phoneTransferTargetType = e.type;\n\t\t\tthis.phoneTransferTargetId = e.target;\n\t\t\tthis.sendInviteTransfer();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error('Unknown transfer type', e);\n\t\t}\n\t}\n\n\t#onCallViewCancelTransfer(e)\n\t{\n\t\tthis.cancelInviteTransfer(e);\n\t}\n\n\t#onCallViewCompleteTransfer(e)\n\t{\n\t\tthis.completeTransfer(e)\n\t}\n\n\t#onCallViewCallListMakeCall(e)\n\t{\n\t\tthis.callListMakeCall(e)\n\t}\n\n\t#onCallViewClose()\n\t{\n\t\tthis.clearSkipIncomingCallTimer();\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\n\t\tthis.callListId = 0;\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.dispose();\n\t\t\tthis.closeCallViewBalloon();\n\t\t\tthis.callView = null;\n\t\t}\n\t\tthis.hasActiveCallView = false;\n\n\t\tif (this.deviceType == DeviceType.Phone)\n\t\t{\n\t\t\tthis.callId = '';\n\t\t\tthis.callActive = false;\n\t\t\tthis.hasExternalCall = false;\n\t\t\tthis.callSelfDisabled = false;\n\t\t\tclearInterval(this.phoneConnectedInterval);\n\n\t\t\tBX.localStorage.set(lsKeys.externalCall, false);\n\t\t}\n\t}\n\n\t#onCallViewSwitchDevice(e)\n\t{\n\t\tvar phoneNumber = e.phoneNumber;\n\t\tvar lastCallListCallParams = this.lastCallListCallParams;\n\t\tif (this.hasExternalCall && this.callId)\n\t\t{\n\t\t\tBX.rest.callMethod('voximplant.call.hangupDevice', {'CALL_ID': this.callId});\n\t\t}\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort();\n\t\tthis.phoneDeviceCall(!this.phoneDeviceCall());\n\t\tthis.callView.setDeviceCall(this.phoneDeviceCall());\n\t\tif (this.isCallListMode())\n\t\t{\n\t\t\tthis.callListMakeCall(lastCallListCallParams);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.close();\n\t\t\tthis.phoneCall(phoneNumber);\n\t\t}\n\t}\n\n\t#onCallViewQualityGraded(grade)\n\t{\n\t\tvar message = {\n\t\t\tCOMMAND: 'gradeQuality',\n\t\t\tgrade: grade\n\t\t};\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.sendMessage(JSON.stringify(message));\n\t\t}\n\t}\n\n\t#onCallViewDialpadButtonClicked(key)\n\t{\n\t\tthis.sendDTMF(key);\n\t}\n\n\t#onCallViewSaveComment(e)\n\t{\n\t\tBX.rest.callMethod(\"voximplant.call.saveComment\", {\n\t\t\t'CALL_ID': e.callId,\n\t\t\t'COMMENT': e.comment\n\t\t})\n\t}\n\n\tdisplayIncomingCall(params)\n\t{\n\t\t/*chatId, callId, callerId, lineNumber, companyPhoneNumber, isCallback*/\n\t\tparams.isCallback = !!params.isCallback;\n\t\tthis.phoneLog('incoming call', params);\n\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\tthis.showUnsupported();\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.phoneNumberUser = Text.encode(params.callerId);\n\t\tparams.callerId = params.callerId.replace(/[^a-zA-Z0-9\\.]/g, '');\n\n\t\tif (this.callActive)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.initiator = true;\n\t\tthis.callInitUserId = 0;\n\t\tthis.callActive = false;\n\t\tthis.callUserId = 0;\n\t\tthis.phoneIncoming = true;\n\t\tthis.callId = params.callId;\n\t\tthis.phoneNumber = params.callerId;\n\t\tthis.phoneParams = {};\n\n\t\tconst direction = params.isCallback ? Direction.callback : Direction.incoming;\n\n\t\tthis.callView = new PhoneCallView({\n\t\t\tuserId: this.userId,\n\t\t\tphoneNumber: this.phoneNumber,\n\t\t\tlineNumber: params.lineNumber,\n\t\t\tcompanyPhoneNumber: params.companyPhoneNumber,\n\t\t\tcallTitle: this.phoneNumberUser,\n\t\t\tdirection: direction,\n\t\t\ttransfer: this.isCallTransfer,\n\t\t\tstatusText: (params.isCallback ? Loc.getMessage('IM_PHONE_INVITE_CALLBACK') : Loc.getMessage('IM_PHONE_INVITE')),\n\t\t\tcrm: params.showCrmCard,\n\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\tcrmActivityId: params.crmActivityId,\n\t\t\tcrmActivityEditUrl: params.crmActivityEditUrl,\n\t\t\tcallId: this.callId,\n\t\t\tcrmData: this.phoneCrm,\n\t\t\tfoldedCallView: this.foldedCallView,\n\t\t\tbackgroundWorker: this.backgroundWorker,\n\t\t\tmessengerFacade: this.messengerFacade,\n\t\t\trestApps: this.restApps,\n\t\t});\n\t\tthis.#bindPhoneViewCallbacks(this.callView);\n\t\tthis.callView.setUiState(UiState.incoming);\n\t\tthis.callView.setCallState(CallState.connecting);\n\t\tif (params.config)\n\t\t{\n\t\t\tthis.callView.setConfig(params.config);\n\t\t}\n\n\t\tthis.callView.show();\n\n\t\tif (params.portalCall)\n\t\t{\n\t\t\tthis.callView.setPortalCall(true);\n\t\t\tthis.callView.setPortalCallData(params.portalCallData);\n\t\t\tthis.callView.setPortalCallUserId(params.portalCallUserId);\n\t\t}\n\n\t\tthis.hasActiveCallView = true;\n\t\tthis.skipIncomingCallTimer = setTimeout(() => {\n\t\t\tconsole.log('Skip phone call by timer');\n\t\t\tif (!this.currentCall)\n\t\t\t{\n\t\t\t\tthis.callView?._onSkipButtonClick();\n\t\t\t}\n\t\t\tthis.skipIncomingCallTimer = null;\n\t\t}, 40000);\n\t}\n\n\tsendInviteTransfer()\n\t{\n\t\tif (!this.currentCall && this.deviceType == DeviceType.Webrtc)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.phoneTransferTargetType || !this.phoneTransferTargetId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst transferParams = {\n\t\t\t'CALL_ID': this.callId,\n\t\t\t'TARGET_TYPE': this.phoneTransferTargetType,\n\t\t\t'TARGET_ID': this.phoneTransferTargetId\n\t\t};\n\n\t\tBX.rest.callMethod('voximplant.call.startTransfer', transferParams).then((response) =>\n\t\t{\n\t\t\tconst data = response.data();\n\n\t\t\tif (data.SUCCESS == 'Y')\n\t\t\t{\n\t\t\t\tthis.phoneTransferEnabled = true;\n\t\t\t\tBX.localStorage.set(lsKeys.vite, true, 1);\n\n\t\t\t\tthis.phoneTransferCallId = data.DATA.CALL.CALL_ID;\n\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_TRANSFER'));\n\t\t\t\tthis.callView.setUiState(UiState.transferring);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.error(\"Could not start call transfer. Error: \", data.ERRORS);\n\t\t\t}\n\t\t});\n\t}\n\n\tcancelInviteTransfer()\n\t{\n\t\tif (!this.currentCall && this.deviceType == DeviceType.Webrtc)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_ONLINE'));\n\t\tthis.callView.setUiState(UiState.connected);\n\n\t\tif (this.phoneTransferCallId !== '')\n\t\t{\n\t\t\tBX.rest.callMethod('voximplant.call.cancelTransfer', {'CALL_ID': this.phoneTransferCallId});\n\t\t}\n\n\t\tthis.phoneTransferTargetId = 0;\n\t\tthis.phoneTransferTargetType = '';\n\t\tthis.phoneTransferCallId = '';\n\t\tthis.phoneTransferEnabled = false;\n\t\tBX.localStorage.set(lsKeys.vite, false, 1);\n\t}\n\n\terrorInviteTransfer(code, reason)\n\t{\n\t\tif (code == '403' || code == '410' || code == '486')\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_TRANSFER_' + code));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_TRANSFER_1'));\n\t\t}\n\t\tthis.messengerFacade.playSound('error', true);\n\t\tthis.callView.setUiState(UiState.transferFailed);\n\n\t\tthis.phoneTransferTargetId = 0;\n\t\tthis.phoneTransferTargetType = '';\n\t\tthis.phoneTransferCallId = '';\n\t\tthis.phoneTransferEnabled = false;\n\t\tBX.localStorage.set(lsKeys.vite, false, 1);\n\t}\n\n\tcompleteTransfer()\n\t{\n\t\tBX.rest.callMethod('voximplant.call.completeTransfer', {'CALL_ID': this.phoneTransferCallId});\n\t}\n\n\tshowExternalCall(params)\n\t{\n\t\tvar direction;\n\t\tif (this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tsetTimeout(() => BX.localStorage.set(lsKeys.externalCall, true, 5), 100);\n\t\tclearInterval(this.phoneConnectedInterval);\n\t\tthis.phoneConnectedInterval = setInterval(() =>\n\t\t{\n\t\t\tif (this.hasExternalCall)\n\t\t\t{\n\t\t\t\tBX.localStorage.set(lsKeys.externalCall, true, 5);\n\t\t\t}\n\t\t}, 5000);\n\n\t\tthis.callId = params.callId;\n\t\tthis.callActive = true;\n\t\tthis.hasExternalCall = true;\n\n\t\tif (params.isCallback)\n\t\t{\n\t\t\tdirection = Direction.callback;\n\t\t}\n\t\telse if (params.fromUserId > 0)\n\t\t{\n\t\t\tdirection = Direction.outgoing;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdirection = Direction.incoming;\n\t\t}\n\n\t\tthis.callView = new PhoneCallView({\n\t\t\tcallId: params.callId,\n\t\t\tdirection: direction,\n\t\t\tphoneNumber: params.phoneNumber,\n\t\t\tlineNumber: params.lineNumber,\n\t\t\tcompanyPhoneNumber: params.companyPhoneNumber,\n\t\t\tfromUserId: params.fromUserId,\n\t\t\ttoUserId: params.toUserId,\n\t\t\tcrm: params.showCrmCard,\n\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\tcrmBindings: params.crmBindings,\n\t\t\tcrmActivityId: params.crmActivityId,\n\t\t\tcrmActivityEditUrl: params.crmActivityEditUrl,\n\t\t\tcrmData: this.phoneCrm,\n\t\t\tisExternalCall: true,\n\t\t\tfoldedCallView: this.foldedCallView,\n\t\t\tbackgroundWorker: this.backgroundWorker,\n\t\t\tmessengerFacade: this.messengerFacade,\n\t\t\trestApps: this.restApps,\n\t\t});\n\t\tthis.bindPhoneViewCallbacksExternalCall(this.callView);\n\t\tthis.callView.setUiState(UiState.externalCard);\n\t\tthis.callView.setCallState(CallState.connected);\n\t\tthis.callView.setConfig(params.config);\n\t\tthis.callView.show();\n\n\t\tif (params.portalCall)\n\t\t{\n\t\t\tthis.callView.setPortalCall(true);\n\t\t\tthis.callView.setPortalCallData(params.portalCallData);\n\t\t\tthis.callView.setPortalCallUserId(params.portalCallUserId);\n\t\t}\n\t}\n\n\tbindPhoneViewCallbacksExternalCall(callView)\n\t{\n\t\tcallView.setCallback('close', () =>\n\t\t{\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.dispose();\n\t\t\t\tthis.closeCallViewBalloon();\n\t\t\t\tthis.callView = null;\n\t\t\t}\n\t\t\tthis.hasActiveCallView = false;\n\n\t\t\tthis.callId = '';\n\t\t\tthis.callActive = false;\n\t\t\tthis.hasExternalCall = false;\n\t\t\tthis.callSelfDisabled = false;\n\t\t\tclearInterval(this.phoneConnectedInterval);\n\t\t\tBX.localStorage.set(lsKeys.externalCall, false);\n\t\t});\n\t\tcallView.setCallback('saveComment', this.#onCallViewSaveComment.bind(this));\n\t}\n\n\thideExternalCall(clearFlag)\n\t{\n\t\tif (this.callView && !this.callView.isCallListMode())\n\t\t{\n\t\t\tthis.callView.autoClose();\n\t\t}\n\t}\n\n\tphoneLog()\n\t{\n\t\tif (this.messengerFacade.isDesktop())\n\t\t{\n\t\t\tlet text = '';\n\t\t\tfor (let i = 0; i < arguments.length; i++)\n\t\t\t{\n\t\t\t\tif (BX.type.isPlainObject(arguments[i]))\n\t\t\t\t{\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\ttext = text + ' | ' + JSON.stringify(arguments[i]);\n\t\t\t\t\t} catch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\ttext = text + ' | (circular structure)';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttext = text + ' | ' + arguments[i];\n\t\t\t\t}\n\t\t\t}\n\t\t\tDesktopApi.writeToLogFile('phone.' + this.userEmail + '.log', text.substring(3));\n\t\t}\n\t\tif (this.debug)\n\t\t{\n\t\t\tif (console)\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tconsole.log('Phone Log', JSON.stringify(arguments));\n\t\t\t\t} catch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.log('Phone Log', arguments[0]);\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns promise which will be resolved if\n\t *  - either Bitrix Desktop is found and this code is running inside it\n\t *  - or no Bitrix Desktop found\n\t * @returns {Promise}\n\t */\n\tcheckDesktop()\n\t{\n\t\tif (Reflection.getClass('BX.Messenger.v2.Lib.DesktopManager'))\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst desktop = BX.Messenger.v2.Lib.DesktopManager.getInstance();\n\t\t\t\tdesktop.checkStatusInDifferentContext()\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tif (result === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (Reflection.getClass('BX.desktopUtils'))\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tBX.desktopUtils.runningCheck(\n\t\t\t\t\t() => {},\n\t\t\t\t\t() => resolve()\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\trestoreFoldedCallView()\n\t{\n\t\tconst callProperties = BX.localStorage.get(lsKeys.foldedView);\n\n\t\tif (!Type.isPlainObject(callProperties))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callActive = true;\n\t\tthis.callId = callProperties.callId;\n\t\tthis.phoneCrm = callProperties.phoneCrm;\n\t\tthis.deviceType = callProperties.phoneCallDevice;\n\t\tthis.hasExternalCall = callProperties.hasExternalCall;\n\n\t\tlet callViewProperties = callProperties.callView;\n\t\tcallViewProperties.foldedCallView = this.foldedCallView;\n\t\tcallViewProperties.backgroundWorker = this.backgroundWorker;\n\t\tcallViewProperties.messengerFacade = this.messengerFacade;\n\t\tthis.callView = new PhoneCallView(callProperties.callView);\n\t\tif (this.hasExternalCall)\n\t\t{\n\t\t\tthis.callView.setUiState(UiState.externalCard);\n\t\t\tthis.callView.setCallState(CallState.connected);\n\t\t\tthis.bindPhoneViewCallbacksExternalCall(this.callView);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#bindPhoneViewCallbacks(this.callView);\n\t\t}\n\n\t\tif (this.hasExternalCall)\n\t\t{\n\t\t\tBX.localStorage.set(lsKeys.externalCall, true, 5);\n\t\t\tthis.phoneConnectedInterval = setInterval(\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tif (this.hasExternalCall)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.localStorage.set(lsKeys.externalCall, true, 5);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t5000\n\t\t\t);\n\t\t}\n\n\t\tBX.rest.callMethod('voximplant.call.get', {'CALL_ID': this.callId}).catch(() =>\n\t\t{\n\t\t\t// call is not found\n\n\t\t\tthis.callId = '';\n\t\t\tthis.callActive = false;\n\t\t\tthis.hasExternalCall = false;\n\t\t\tthis.callSelfDisabled = false;\n\t\t\tclearInterval(this.phoneConnectedInterval);\n\t\t\tBX.localStorage.set(lsKeys.externalCall, false);\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.dispose();\n\t\t\t\tthis.closeCallViewBalloon();\n\t\t\t\tthis.callView = null;\n\t\t\t}\n\t\t\tthis.hasActiveCallView = false;\n\t\t});\n\t}\n\n\tdisplayCallQuality(percent)\n\t{\n\t\tif (!this.currentCall || this.currentCall.state() != \"CONNECTED\")\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet grade = 5;\n\t\tif (100 == percent)\n\t\t{\n\t\t\tgrade = 5;\n\t\t}\n\t\telse if (percent >= 99)\n\t\t{\n\t\t\tgrade = 4;\n\t\t}\n\t\telse if (percent >= 97)\n\t\t{\n\t\t\tgrade = 3;\n\t\t}\n\t\telse if (percent >= 95)\n\t\t{\n\t\t\tgrade = 2;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgrade = 1;\n\t\t}\n\n\t\tthis.callView.setQuality(grade);\n\t\treturn grade;\n\t}\n\n\tcallOverlayProgress(progress)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setProgress(progress);\n\t\t\tif (progress === 'offline')\n\t\t\t{\n\t\t\t\tthis.messengerFacade.playSound('error');\n\t\t\t}\n\t\t}\n\t}\n\n\tcallOverlayStatus(status)\n\t{\n\t\tif (!Type.isStringFilled(status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setStatusText(status);\n\t\t}\n\t}\n\n\tsetCallOverlayTitle(title)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setTitle(title);\n\t\t}\n\t}\n\n\tcallOverlayTimer(state) // TODO not ready yet\n\t{\n\t\tstate = typeof (state) == 'undefined' ? 'start' : state;\n\n\t\tif (state == 'start')\n\t\t{\n\t\t\tthis.phoneCallTimeInterval = setInterval(() => this.phoneCallTime++, 1000);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclearInterval(this.phoneCallTimeInterval);\n\t\t}\n\t}\n\n\tcallAbort(reason)\n\t{\n\t\tthis.callOverlayDeleteEvents();\n\n\t\tif (reason && this.callView)\n\t\t{\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setStatusText(reason);\n\t\t\t}\n\t\t}\n\t}\n\n\tcallOverlayDeleteEvents()\n\t{\n\t\t// this.desktop.closeTopmostWindow();\n\n\t\tthis.phoneCallFinish();\n\n\t\tthis.clearSkipIncomingCallTimer();\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\n\t\tclearTimeout(this.callDialogAllowTimeout);\n\t\tif (this.callDialogAllow)\n\t\t{\n\t\t\tthis.callDialogAllow.close();\n\t\t}\n\n\t}\n\n\tstorageSet(params)\n\t{\n\t\tif (params.key == lsKeys.vite)\n\t\t{\n\t\t\tif (params.value === true || !this.callSelfDisabled)\n\t\t\t{\n\t\t\t\tthis.phoneTransferEnabled = params.value;\n\t\t\t}\n\t\t}\n\t\telse if (params.key == lsKeys.externalCall)\n\t\t{\n\t\t\tif (params.value === false)\n\t\t\t{\n\t\t\t\tthis.hideExternalCall();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetDebugInfo()\n\t{\n\t\treturn {\n\t\t\tvInitedCall: BX.localStorage.get('vInitedCall') ? 'Y' : 'N',\n\t\t\tisDesktop: this.messengerFacade.isDesktop() ? 'Y' : 'N',\n\t\t\tappVersion: navigator.appVersion,\n\t\t\thasActiveCall: this.messengerFacade.hasActiveCall() ? 'Y' : 'N',\n\t\t\tisCallListMode: this.isCallListMode() ? this.callListId : 'N',\n\t\t\tcurrentCall: this.currentCall ? this.currentCall.id() : 'N',\n\t\t\tcallView: this.callView ? this.callView.callId : 'N',\n\t\t\tcallViewPopup: this.callView?.popup ? 'Y' : 'N',\n\t\t\thasActiveCallView: this.hasActiveCallView ? 'Y' : 'N',\n\t\t\tisFoldedCallView: this.callView?.isFolded() ? 'Y' : 'N',\n\t\t\tvoximplantClient: this.voximplantClient ? this.voximplantClient?.connected() : 'N',\n\t\t};\n\t}\n\n\tshowNotification(notificationText, actions, params = {})\n\t{\n\t\tif (!actions)\n\t\t{\n\t\t\tactions = [];\n\t\t}\n\n\t\tconst options = {\n\t\t\tcontent: Text.encode(notificationText),\n\t\t\tposition: \"top-right\",\n\t\t\tcloseButton: true,\n\t\t\tactions: actions\n\t\t};\n\n\t\tif (params.autoHideDelay)\n\t\t{\n\t\t\toptions.autoHideDelay = params.autoHideDelay;\n\t\t}\n\t\telse\n\t\t{\n\t\t\toptions.autoHide = false;\n\t\t}\n\n\t\treturn BX.UI.Notification.Center.notify(options);\n\t}\n\n\tshowCallViewBalloon()\n\t{\n\t\tif (!this.openedCallViewBalloon && this.callView)\n\t\t{\n\t\t\tthis.openedCallViewBalloon = this.showNotification(Loc.getMessage('VOXIMPLANT_WARN_CLOSE_CALL_VIEW'));\n\t\t}\n\t}\n\n\tcloseCallViewBalloon()\n\t{\n\t\tif (this.openedCallViewBalloon)\n\t\t{\n\t\t\tthis.openedCallViewBalloon.close();\n\t\t\tthis.openedCallViewBalloon = null;\n\t\t}\n\t}\n\n\tclearSkipIncomingCallTimer()\n\t{\n\t\tif (this.skipIncomingCallTimer)\n\t\t{\n\t\t\tconsole.log('Clear skip incoming call timer: ' + this.skipIncomingCallTimer);\n\t\t\tclearTimeout(this.skipIncomingCallTimer);\n\t\t\tthis.skipIncomingCallTimer = null;\n\t\t}\n\t}\n\n\ttestSimple()\n\t{\n\t\tconst callId = 'test-call'\n\t\tthis.callView = new PhoneCallView({\n\t\t\tcallId,\n\t\t\trestApps: this.restApps,\n\t\t\tfoldedCallView: this.foldedCallView,\n\t\t\tbackgroundWorker: this.backgroundWorker,\n\t\t\tmessengerFacade: this.messengerFacade,\n\t\t\tdarkMode: this.messengerFacade.isThemeDark(),\n\t\t\tevents: {\n\t\t\t\tclose: () =>\n\t\t\t\t{\n\t\t\t\t\tconsole.trace('close')\n\t\t\t\t\tthis.callView?.dispose();\n\t\t\t\t\tthis.callView = null;\n\t\t\t\t},\n\t\t\t\thangup: () => this.callView.close(),\n\t\t\t\ttransfer: (e) => console.log('transfer', e),\n\t\t\t\tdialpadButtonClicked: (e) => console.log('dialpadButtonClicked', e),\n\t\t\t\thold: () => console.log('hold'),\n\t\t\t\tunhold: () => console.log('unhold'),\n\t\t\t\tmute: () => console.log('mute'),\n\t\t\t\tunmute: () => console.log('unmute'),\n\t\t\t}\n\t\t})\n\t\tthis.callView.show();\n\t}\n\n\ttestCrm()\n\t{\n\n\t}\n\n\ttestUser()\n\t{\n\t\tthis.callView = new PhoneCallView({\n\t\t\tmessengerFacade: this.messengerFacade,\n\t\t})\n\t}\n\n\tstatic Events = Events;\n}","import { PhoneCallsController } from './controller';\nimport { PhoneCallView } from './view/view';\nimport { FoldedCallView } from './view/folded-view';\nimport {BackgroundWorker} from './view/background-worker';\n\nimport './css/view.css';\n\nimport 'applayout';\nimport 'crm_form_loader';\nimport 'phone_number';\n\nexport {\n\tPhoneCallsController,\n\tPhoneCallView,\n\tBackgroundWorker,\n}\n\n// legacy compat\nBX.FoldedCallView = FoldedCallView;"],"names":["baseZIndex","nop","digits","Keypad","params","Type","isPlainObject","bindElement","offsetTop","offsetLeft","anglePosition","angleOffset","history","selectedLineId","defaultLineId","lines","availableLines","callInterceptAllowed","zIndex","hideDial","plusEntered","callbacks","onButtonClick","isFunction","onDial","onIntercept","onClose","elements","inputContainer","input","lineSelector","lineName","interceptButton","historyButton","plusKeyTimeout","popup","createPopup","popupOptions","id","targetContainer","document","body","darkMode","closeByEsc","autoHide","content","render","noAllPaddings","overlay","backgroundColor","opacity","events","onPopupClose","bind","angle","position","offset","Popup","destroy","length","lineId","innerText","getLineName","hasOwnProperty","SHORT_NAME","Dom","create","props","className","children","click","_onDeleteButtonClick","attrs","type","value","placeholder","Loc","getMessage","keydown","_onInputKeydown","keyup","_onAfterNumberChanged","map","digit","renderNumber","_onKeyMouseDown","_onKeyMouseUp","canSelectLine","text","_onLineSelectClick","_onDialButtonClick","_onShowHistoryButtonClick","_onInterceptButtonClick","e","keyCode","phoneNumber","key","metaKey","ctrlKey","shiftKey","insertAtCursor","preventDefault","altKey","classList","toggle","focus","substr","setTimeout","startsWith","clearTimeout","menuItems","isArray","forEach","index","push","Text","encode","onclick","historySelectMenu","close","Menu","bindOptions","onPopupDestroy","show","lineSelectMenu","setSelectedLineId","maxHeight","number","onMouseDown","onMouseUp","classSuffix","dataset","mousedown","currentTarget","mouseup","inputElement","selectionStart","startPos","endPos","selectionEnd","substring","callCardEvents","addCommentButtonClick","muteButtonClick","holdButtonClick","transferButtonClick","cancelTransferButtonClick","completeTransferButtonClick","hangupButtonClick","nextButtonClick","skipButtonClick","answerButtonClick","entityChanged","qualityMeterClick","dialpadButtonClick","makeCallButtonClick","notifyAdminButtonClick","closeButtonClick","UndefinedCallCard","result","errorCode","BaseWorker","Error","placement","name","callCard","CallCard","isExternalCall","PhoneCallView","used","prototype","callback","Object","keys","UiState","filter","state","isCardActive","getUndefinedCallCardError","uiState","setUiState","disableAutoStartTimer","stopTimer","hideTimer","showTimer","isTimerStarted","isMuted","muted","setMuted","BX","addClass","buttons","mute","isDesktop","slave","desktop","onCustomEvent","desktopEvents","onMute","removeClass","onUnMute","unmute","isHeld","held","setHeld","hold","onHold","onUnHold","unhold","startTimer","setTitle","title","setStatusText","statusText","timer","visible","sections","style","display","isFolded","unfoldedElements","initialTimestamp","desktopMethodEvents","setMute","setHold","getListUiState","setCardTitle","corporatePortalPageEvents","DesktopWorker","eventHandlers","rest","AppLayout","initializePlacement","initializeInterfaceMethods","initializeInterfaceEvents","addEventHandlersForEventsFromCallCard","addTransmitEventHandlers","CallCardGetListUiStates","getListUiStates","CallCardSetMute","transmitSetMute","CallCardSetHold","transmitSetHold","CallCardSetUiState","transmitSetUiState","CallCardSetCardTitle","transmitSetCardTitle","CallCardSetStatusText","transmitSetStatusText","CallCardClose","transmitClose","CallCardStartTimer","transmitStartTimer","CallCardStopTimer","transmitStopTimer","isCallCardPage","BXDesktopSystem","BroadcastEvent","window","desktopEventName","toUpperCase","slice","event","getEvents","removeCustomEvents","addCustomEvent","onTransmitHandler","getCallCardPlatformWorker","handler","isCorporatePortalPage","DoNothing","eventName","eventHandler","realHandler","arEventParams","i","detail","apply","addEventListener","removeEventListener","BXDesktopWindow","GetWindowId","GetMainWindow","BXWindows","find","element","callWindow","getCallCardWindow","PCW","backgroundWorker","platformWorker","BrowserWorker","initializeInterface","backgroundWorkerEvents","BackgroundWorker","emitEvent","removeDesktopEventHandlers","isUsed","setIsExternalCall","FormManager","node","currentForm","onFormLoad","onFormUnLoad","onFormSend","formData","getFormData","Bitrix24FormLoader","load","unload","sec","secCode","lang","ref","location","href","handlers","_onFormLoad","_onFormUnLoad","options","form","CallList","entityType","statuses","Map","currentStatusId","callListStatusId","currentItemIndex","itemIndex","callingStatusId","callingItemIndex","selectionLocked","onError","onSelectedItem","showLimit","showDelta","next","currentStatus","get","ITEMS","update","selectItem","debug","isDomNode","setCallingElement","bitrix_sessid","ajax","url","getAjaxUrl","method","dataType","data","onsuccess","ERROR","STATUSES","statusRecord","set","STATUS_ID","item","itemStatus","ENTITY_TYPE","getNonEmptyStatusId","console","log","statusId","newIndex","currentNode","_node","itemActionMenu","newEntity","ASSOCIATED_ENTITY","TYPE","ID","bindings","ELEMENT_ID","phones","PHONES","clean","append","renderStatusBlocks","status","renderStatusBlock","_shownCount","Math","min","renderCallListItem","_showMoreNode","replace","onShowMoreClick","itemDescriptor","statusName","NAME","phonesText","phone","VALUE","showItemMenu","target","EDIT_URL","open","POST","COMPANY_TITLE","renderAssociatedEntity","associatedEntity","newStatusNode","parentNode","replaceChild","callListItem","menuItem","actionMenuItemClickHandler","delimiter","setElementRank","RANK","elementId","setElementStatus","rank","executeItemAction","action","parameters","callListId","successCallback","repopulateItems","webformResultId","requestParams","items","foundStatusId","count","toString","animationTimeout","itemsNode","measuringNode","_folded","CLASS","getStatusTitle","height","clientHeight","renderCallListItems","transitionend","removeProperty","avatars","Events","onUnfold","FoldedCallView","setEventNamespace","subscribeFromOptions","currentItem","callListParams","webformId","webformSecCode","itemStatusId","statusList","avatar","callButton","nextButton","unfoldButton","_lsKey","_lsTtl","init","savedData","localStorage","remove","animation","currentItemStatusId","fromEntries","store","makeCall","restoredParams","callListItemIndex","emit","dblclick","_onViewDblClick","appendChild","bottom","renderUserInfo","_onNextButtonClick","_onUnfoldButtonClick","backgroundImage","loadAvatar","entityId","unfold","moveToNext","EventEmitter","desktopFeatureMap","Desktop","parentPhoneCallView","closable","js","minSettingsWidth","minSettingsHeight","resizable","DesktopApi","createWindow","SetProperty","Width","width","Height","minWidth","minHeight","html","ExecuteCommand","windowTarget","full","clientVersion","GetProperty","join","featureName","getVersion","jsContent","initImJs","bodyClass","htmlWrapperHead","head","outerHTML","isStringFilled","initJs","callId","_uiState","companyPhoneNumber","direction","fromUserId","toUserId","crm","hasSipPhone","deviceCall","transfer","crmEntityType","crmEntityId","crmActivityId","crmActivityEditUrl","config","JSON","stringify","portalCall","portalCallData","portalCallUserId","restApps","documentElement","Direction","incoming","outgoing","transferIncoming","connectingIncoming","connectingOutgoing","connected","transferring","transferFailed","transferConnected","idle","error","moneyError","sipPhoneError","redial","externalCard","CallState","connecting","CallProgress","connect","offline","online","wait","ButtonLayouts","centered","spaced","layouts","simple","initialSize","lsKeys","callView","callInited","externalCall","currentCall","setStatus","setDeviceCall","setCrmEntity","setPortalCall","setPortalCallUserId","setPortalCallQueueName","setPortalCallData","setConfig","setCallState","reloadCrmCard","setCallId","setLineNumber","setPhoneNumber","setCompanyPhoneNumber","setTransfer","closeWindow","onMakeCall","onCallListMakeCall","onAnswer","onSkip","onHangup","onStartTransfer","onCompleteTransfer","onCancelTransfer","onBeforeUnload","onSwitchDevice","onQualityGraded","onDialpadButtonClicked","onCommentShown","onSaveComment","onSetAutoClose","blankAvatar","warn","entityTypeName","context","isCanceled","isBoolean","externalRequests","entityInfo","loadCrmCard","isChatWindow","lineNumber","callState","prop","getString","getInteger","crmData","getObject","crmBindings","getArray","portalCallQueueName","recording","allowAutoClose","folded","autoFold","progress","quality","qualityPopup","qualityGrade","comment","commentShown","timerInterval","autoCloseTimer","autoCloseTimeout","getInitialElements","getInitialSections","uiStateButtons","getUiStateButtons","buttonLayout","layout","callListMakeCall","answer","skip","hangup","completeTransfer","cancelTransfer","switchDevice","qualityGraded","dialpadButtonClicked","saveComment","notifyAdmin","_onBeforeUnloadHandler","_onBeforeUnload","_onDblClickHandler","_onDblClick","_onHoldButtonClickHandler","_onHoldButtonClick","_onMuteButtonClickHandler","_onMuteButtonClick","_onTransferButtonClickHandler","_onTransferButtonClick","_onTransferCompleteButtonClickHandler","_onTransferCompleteButtonClick","_onTransferCancelButtonClickHandler","_onTransferCancelButtonClick","_onDialpadButtonClickHandler","_onDialpadButtonClick","_onHangupButtonClickHandler","_onHangupButtonClick","_onCloseButtonClickHandler","_onCloseButtonClick","_onMakeCallButtonClickHandler","_onMakeCallButtonClick","_onNextButtonClickHandler","_onRedialButtonClickHandler","_onRedialButtonClick","_onFoldButtonClickHandler","_onFoldButtonClick","_onAnswerButtonClickHandler","_onAnswerButtonClick","_onSkipButtonClickHandler","_onSkipButtonClick","_onSwitchDeviceButtonClickHandler","_onSwitchDeviceButtonClick","_onQualityMeterClickHandler","_onQualityMeterClick","_onPullEventCrmHandler","_onPullEventCrm","hiddenTabs","currentTabName","moreTabsMenu","callListView","currentEntity","callingEntity","numberSelectMenu","webformLoaded","restAppLayoutLoaded","restAppLayoutLoading","restAppInterface","skipOnResize","currentLayout","setCallCard","setExternalCall","_isDesktop","messengerFacade","foldedCallView","emitInitializeEvent","getPlacementOptions","createTitle","then","main","crmButtons","commentEditorContainer","commentEditor","qualityMeter","crmCard","crmButtonsContainer","buttonsContainer","topLevelButtonsContainer","topButtonsContainer","sidebarContainer","tabsContainer","tabsBodyContainer","tabs","callList","webform","app","tabsBody","moreTabs","openCallWindow","getInitialWidth","getInitialHeight","bindMasterDesktopEvents","createLayout","updateView","bindSlaveDesktopEvents","reinit","onCallListSelectedItem","unloadHandler","removeCustomEvent","disableDocumentScroll","getId","closeIcon","draggable","restrict","createLayoutFolded","createLayoutCrm","createLayoutSimple","hasSideBar","renderTitle","bxchange","_onCommentChanged","createSidebarLayout","checkMoreButton","top","left","right","isFeatureSupported","storedWidth","parseInt","getItem","floor","screen","storedHeight","setItem","sectionName","sectionsIndex","tabId","tabBodyId","_onTabHeaderClick","isWebformSupported","formManager","_onFormSend","isRestAppsSupported","restApp","restAppId","_onTabMoreClick","setActiveTab","portalCallUserImage","isPortalCall","hrphoto","hidden","tab","loadForm","loadRestApp","currentTab","isCurrentTabHidden","tabElement","callTitle","Promise","resolve","PhoneNumberParser","getInstance","parse","parsedNumber","isValid","format","isInternational","charAt","isCallback","users","isTransfer","adjust","Number","toLowerCase","_getRandomString","len","charSet","randomString","randomPoz","random","setOnSlave","innerHTML","getQualityMeterWidth","renderProgress","renderCrmButtons","renderButtons","stateButtons","setClosable","showOnlySections","hideCallIcon","showCallIcon","showSections","additionalParams","isAutoFoldAllowed","fold","sipPhone","activityId","activityEditUrl","runAction","response","newMainElement","resizeWindow","bindCrmCardEvents","errors","Crm","Page","anchors","querySelectorAll","onCrmAnchorClick","isSliderEnabled","userId","renderAvatar","queueName","message","renderTimer","renderButtonsFolded","renderButtonsDefault","buttonsFragment","createDocumentFragment","topButtonsFragment","topLevelButtonsFragment","subContainers","buttonName","buttonNode","renderSimpleButton","canBeFolded","CRM_CREATE","addCommentLabel","_onAddCommentButtonClick","_onAddDealButtonClick","_onAddInvoiceButtonClick","_onAddLeadButtonClick","_onAddContactButtonClick","hideSections","currentElement","getCurrentElement","setWebformResult","resultId","getPlacement","Runtime","initializeAppInterface","appInterface","getStatus","cb","disableAutoClose","enableAutoClose","undefined","isActiveIntoCurrentCall","isUnloadAllowed","returnValue","selectTransferTarget","keypad","dialpad","call","showNumberSelectMenu","phoneNumbers","onSelect","closeNumberSelectMenu","moveToNextItem","updateAutoCloseTimer","addComment","_getCrmEditUrl","externalContext","_generateExternalContext","Uri","addParam","contact_id","company_id","external_context","call_list_id","call_list_element","redirect","contact","company","origin_id","showQualityPopup","closeQualityPopup","command","IS_CANCELED","eventParams","PARAMS","entity","resetCallingElement","Date","getTime","setInterval","currentTimestamp","elapsedMilliSeconds","elapsedSeconds","minutes","seconds","template","isRecording","clearInterval","cacheable","createStar","mouseover","mouseout","util","getRandomString","foldCallView","foldCall","popupNode","getPopupContainer","overlayNode","enableDocumentScroll","subscribe","unbindAll","debounce","saveInitialSize","innerWidth","innerHeight","getSlider","isSelfContained","denyAction","slider","grade","autoClose","eventId","unsubscribe","setClosingByEsc","adjustPosition","setResizable","setMinSize","center","resize","autoCloseAfterTimeout","scrollWidth","clientWidth","setProperty","add","imBar","getElementById","unloadRestApps","unloadForm","unbindDesktopEvents","resultCallback","loadExtension","exports","getDialogConfigForBackgroundApp","getDefaultDialogConfig","Dialog","transferDialog","targetNode","multiple","hideOnSelect","enableSearch","entities","inviteEmployeeLink","selectFields","deselectAll","getEntityId","customData","getCustomData","showTransferToUserMenu","hide","isInteger","userCustomData","onMenuItemClick","icon","renderTransferMenuItem","lightShadow","surTitle","clickCallback","active","vite","dialHistory","foldedView","onCallCreated","onCallConnected","onCallDestroyed","onDeviceCallStarted","DeviceType","Webrtc","Phone","PhoneCallsController","_classPrivateMethodInitSpec","phoneEnabled","userEmail","isAdmin","isString","canInterceptCall","deviceActive","skipIncomingCallTimer","hasActiveCallView","readDefaults","Browser","isLocalStorageSupported","storageSet","_classPrivateMethodGet","onCallConnectedHandler","onCallDisconnectedHandler","onCallFailedHandler","onProgressToneStartHandler","onProgressToneStopHandler","getData","startCallList","restoreFoldedCallView","garbage","hasActiveCall","canBeUnloaded","hasExternalCall","deviceType","phoneCrm","getState","Boolean","_currentCall","defaultMicrophone","defaultCamera","defaultSpeaker","enableMicAutoParameters","navigator","mediaDevices","enumerateDevices","deviceList","device","kind","deviceId","phoneParams","clone","phoneFullNumber","phoneConnectedInterval","phoneCallTimeInterval","callOverlayTimer","showCallViewBalloon","phoneLog","scheduleApiDisconnect","phoneRinging","phoneIncoming","callActive","phoneNumberUser","callOverlayOptions","callSelfDisabled","isCallHold","isCallTransfer","phoneMicAccess","phoneTransferTargetType","phoneTransferTargetId","phoneTransferCallId","phoneTransferEnabled","callMethod","callInitUserId","voximplantClient","disconnect","toggleCallHold","sendMessage","sendTone","ready","muteMicrophone","unmuteMicrophone","setLocalConfig","deviceCallBlock","getLocalConfig","Voximplant","openLimitSlider","loadPhoneLines","closeKeyPad","phoneCall","UI","InfoHelper","FOUND","interceptErrorPopup","correctPhoneNumber","initiator","callUserId","showCrmCard","cachedLines","phoneLines","reject","err","matches","exec","messageBox","MessageBox","MessageBoxButtons","OK_CANCEL","okCaption","cancelCaption","onOk","DesktopDownload","getLinkForCurrentUser","oldHistory","phoneIndex","indexOf","splice","concat","isCallListMode","phoneDeviceCall","clearSkipIncomingCallTimer","stopRepeatSound","phoneApiInit","phoneSupport","useAudioSource","VoxImplant","Hardware","AudioDeviceManager","setDefaultAudioSettings","outputId","phoneApiParameters","useRTCOnly","micRequired","videoSupport","progressTone","audioConstraints","optional","echoCancellation","googEchoCancellation","googEchoCancellation2","googDAEchoCancellation","googAutoGainControl","googAutoGainControl2","mozAutoGainControl","googNoiseSuppression","googNoiseSuppression2","googHighpassFilter","googTypingNoiseDetection","googAudioMirroring","getClient","apiParameters","client","setLoggerCallback","enableSilentLogging","label","ConnectionFailed","ConnectionClosed","IncomingCall","MicAccessResult","SourcesInfoUpdated","phoneOnInfoUpdated","NetStatsReceived","phoneCallFinish","playSound","callOverlayProgress","callAbort","audioSources","videoSources","showUnsupported","callerId","transferParams","SUCCESS","DATA","CALL","CALL_ID","ERRORS","code","reason","bindPhoneViewCallbacksExternalCall","setCallback","dispose","closeCallViewBalloon","clearFlag","arguments","writeToLogFile","Reflection","getClass","Messenger","v2","Lib","DesktopManager","checkStatusInDifferentContext","desktopUtils","runningCheck","callProperties","phoneCallDevice","callViewProperties","percent","setQuality","setProgress","phoneCallTime","callOverlayDeleteEvents","callDialogAllowTimeout","callDialogAllow","hideExternalCall","vInitedCall","appVersion","callViewPopup","isFoldedCallView","notificationText","actions","closeButton","autoHideDelay","Notification","Center","notify","openedCallViewBalloon","showNotification","isThemeDark","trace","CallEvents","Connected","Disconnected","Failed","ProgressToneStart","ProgressToneStop","popupConditions","DEBUG_INFO","getDebugInfo","checkDesktop","CRM","phonePortalCall","userData","phoneCallConfig","repeatSound","displayIncomingCall","chatId","errorInviteTransfer","failedCode","failedReason","external","callDevice","setCrmData","phoneDisplayExternal","phoneNumberLast","newCallId","setCallOverlayTitle","showExternalCall","getCallParams","initParams","decode","HR_PHOTO","callOverlayUserId","DIALOG_ID","callOverlayChatId","headers","phoneServer","phoneLogin","phoneCheckBalance","callOverlayStatus","stats","packetLoss","displayCallQuality","isRestLine","onKeyPadDial","onKeyPadIntercept","onKeyPadClose","addToHistory","startCallViaRestApp","numberOriginal","internationalNumber","alert","callStartParams","EXTERNAL","CONFIG","lastCallListCallParams","delay","phoneOnAuthResult","isIncoming","isDeviceCall","muteCall","unmuteCall","holdCall","unholdCall","phoneIncomingAnswer","sendInviteTransfer","cancelInviteTransfer","COMMAND","sendDTMF"],"mappings":";;;;;CAAO,IAAMA,UAAU,GAAG,KAAK;AAC/B,CAAO,IAAMC,GAAG,GAAG,SAANA,GAAG,GAAc,EAAE;;CCGhC,IAAMC,MAAM,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;AAoB3E,KAAaC,MAAM;GAElB,gBAAYC,MAAoB,EAChC;KAAA;KACC,IAAI,CAACC,cAAI,CAACC,aAAa,CAACF,MAAM,CAAC,EAC/B;OACCA,MAAM,GAAG,EAAE;;KAGZ,IAAI,CAACG,WAAW,GAAGH,MAAM,CAACG,WAAW,IAAI,IAAI;KAC7C,IAAI,CAACC,SAAS,GAAGJ,MAAM,CAACI,SAAS,IAAI,CAAC;KACtC,IAAI,CAACC,UAAU,GAAGL,MAAM,CAACK,UAAU,IAAI,CAAC;KACxC,IAAI,CAACC,aAAa,GAAGN,MAAM,CAACM,aAAa,IAAI,EAAE;KAC/C,IAAI,CAACC,WAAW,GAAGP,MAAM,CAACO,WAAW,IAAI,CAAC;KAC1C,IAAI,CAACC,OAAO,GAAGR,MAAM,CAACQ,OAAO,IAAI,EAAE;KAEnC,IAAI,CAACC,cAAc,GAAGT,MAAM,CAACU,aAAa;KAC1C,IAAI,CAACC,KAAK,GAAGX,MAAM,CAACW,KAAK,IAAI,EAAE;KAC/B,IAAI,CAACC,cAAc,GAAGZ,MAAM,CAACY,cAAc,IAAI,EAAE;KAEjD,IAAI,CAACC,oBAAoB,GAAGb,MAAM,CAACa,oBAAoB,KAAK,IAAI;KAEhE,IAAI,CAACC,MAAM,GAAGlB,UAAU,GAAG,GAAG;;;KAG9B,IAAI,CAACmB,QAAQ,GAAIf,MAAM,CAACe,QAAQ,KAAK,IAAK;KAC1C,IAAI,CAACC,WAAW,GAAG,KAAK;KAExB,IAAI,CAACC,SAAS,GAAG;OAChBC,aAAa,EAAEjB,cAAI,CAACkB,UAAU,CAACnB,MAAM,CAACkB,aAAa,CAAC,GAAGlB,MAAM,CAACkB,aAAa,GAAGrB,GAAG;OACjFuB,MAAM,EAAEnB,cAAI,CAACkB,UAAU,CAACnB,MAAM,CAACoB,MAAM,CAAC,GAAGpB,MAAM,CAACoB,MAAM,GAAGvB,GAAG;OAC5DwB,WAAW,EAAEpB,cAAI,CAACkB,UAAU,CAACnB,MAAM,CAACqB,WAAW,CAAC,GAAGrB,MAAM,CAACqB,WAAW,GAAGxB,GAAG;OAC3EyB,OAAO,EAAErB,cAAI,CAACkB,UAAU,CAACnB,MAAM,CAACsB,OAAO,CAAC,GAAGtB,MAAM,CAACsB,OAAO,GAAGzB;MAC5D;KAED,IAAI,CAAC0B,QAAQ,GAAG;OACfC,cAAc,EAAE,IAAI;OACpBC,KAAK,EAAE,IAAI;OACXC,YAAY,EAAE,IAAI;OAClBC,QAAQ,EAAE,IAAI;OACdC,eAAe,EAAE,IAAI;OACrBC,aAAa,EAAE;MACf;KACD,IAAI,CAACC,cAAc,GAAG,IAAI;KAE1B,IAAI,CAACC,KAAK,GAAG,IAAI,CAACC,WAAW,EAAE;;GAC/B;KAAA;KAAA,8BAGD;OACC,IAAIC,YAAY,GAAG;SAClBC,EAAE,EAAE,8BAA8B;SAClC/B,WAAW,EAAE,IAAI,CAACA,WAAW;SAC7BgC,eAAe,EAAEC,QAAQ,CAACC,IAAI;SAC9BC,QAAQ,EAAE,IAAI;SACdC,UAAU,EAAE,IAAI;SAChBC,QAAQ,EAAE,IAAI;SACd1B,MAAM,EAAE,IAAI,CAACA,MAAM;SACnB2B,OAAO,EAAE,IAAI,CAACC,MAAM,EAAE;SACtBC,aAAa,EAAE,IAAI;SAEnBvC,SAAS,EAAE,IAAI,CAACA,SAAS;SACzBC,UAAU,EAAE,IAAI,CAACA,UAAU;SAE3BuC,OAAO,EAAE;WACRC,eAAe,EAAE,OAAO;WACxBC,OAAO,EAAE;UACT;SACDC,MAAM,EAAE;WACPC,YAAY,EAAE,IAAI,CAACA,YAAY,CAACC,IAAI,CAAC,IAAI;;QAE1C;OAED,IAAI,IAAI,CAAC3C,aAAa,KAAK,EAAE,EAC7B;SACC2B,YAAY,CAACiB,KAAK,GAAG;WACpBC,QAAQ,EAAE,IAAI,CAAC7C,aAAa;WAC5B8C,MAAM,EAAE,IAAI,CAAC7C;UACb;;OAGF,OAAO,IAAI8C,gBAAK,CAACpB,YAAY,CAAC;;;KAC9B;KAAA,+BAGD;OACC,IAAI,CAAChB,SAAS,CAACK,OAAO,EAAE;OACxB,IAAI,IAAI,CAACS,KAAK,EACd;SACC,IAAI,CAACA,KAAK,CAACuB,OAAO,EAAE;;;;KAErB;KAAA,gCAGD;OACC,OAAO,IAAI,CAAC1C,cAAc,CAAC2C,MAAM,GAAG,CAAC;;;KACrC;KAAA,kCAEiBC,MAAM,EACxB;OACC,IAAI,CAAC/C,cAAc,GAAG+C,MAAM;OAE5B,IAAI,IAAI,CAACjC,QAAQ,CAACI,QAAQ,EAC1B;SACC,IAAI,CAACJ,QAAQ,CAACI,QAAQ,CAAC8B,SAAS,GAAG,IAAI,CAACC,WAAW,CAACF,MAAM,CAAC;;;;KAE5D;KAAA,4BAEWA,MAAM,EAClB;OACC,OAAO,IAAI,CAAC7C,KAAK,CAACgD,cAAc,CAACH,MAAM,CAAC,GAAG,IAAI,CAAC7C,KAAK,CAAC6C,MAAM,CAAC,CAACI,UAAU,GAAG,EAAE;;;KAC7E;KAAA,yBAGD;OAAA;OACC,OAAOC,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACxBC,KAAK,EAAE;WAACC,SAAS,EAAE;UAAyB;SAC5CC,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAyB;WAAEC,QAAQ,EAAE,CACvD,IAAI,CAAC1C,QAAQ,CAACC,cAAc,GAAGqC,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aAChDC,KAAK,EAAE;eAACC,SAAS,EAAE;cAA0B;aAAEC,QAAQ,EAAE,CACxDJ,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;eAClBC,KAAK,EAAE;iBAACC,SAAS,EAAE;gBAAiC;eAAEjB,MAAM,EAAE;iBAC7DmB,KAAK,EAAE,IAAI,CAACC,oBAAoB,CAAClB,IAAI,CAAC,IAAI;;cAE3C,CAAC,EACF,IAAI,CAAC1B,QAAQ,CAACE,KAAK,GAAGoC,aAAG,CAACC,MAAM,CAAC,OAAO,EAAE;eACzCM,KAAK,EAAE;iBACN,UAAU,EAAE,IAAI,CAACrD,QAAQ;iBACzBsD,IAAI,EAAE,MAAM;iBACZC,KAAK,EAAE,EAAE;iBACTC,WAAW,EAAEC,aAAG,CAACC,UAAU,CAAC,IAAI,CAAC1D,QAAQ,GAAG,oBAAoB,GAAG,qBAAqB;gBACxF;eACDgD,KAAK,EAAE;iBAACC,SAAS,EAAE;gBAAgC;eACnDjB,MAAM,EAAE;iBACP2B,OAAO,EAAE,IAAI,CAACC,eAAe,CAAC1B,IAAI,CAAC,IAAI,CAAC;iBACxC2B,KAAK,EAAE;mBAAA,OAAM,KAAI,CAACC,qBAAqB,EAAE;;;cAE1C,CAAC;YAEH,CAAC,EACFhB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAACC,SAAS,EAAE;cAA+B;aAClDC,QAAQ,EAAEnE,MAAM,CAACgF,GAAG,CACnB,UAAAC,KAAK;eAAA,OAAIC,YAAY,CAACD,KAAK,EAAE,KAAI,CAACE,eAAe,CAAChC,IAAI,CAAC,KAAI,CAAC,EAAE,KAAI,CAACiC,aAAa,CAACjC,IAAI,CAAC,KAAI,CAAC,CAAC;;YAE7F,CAAC;UAEH,CAAC,EACF,IAAI,CAAClC,QAAQ,GAAG,IAAI,GAAG8C,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACxCC,KAAK,EAAE;aAACC,SAAS,EAAE;YAA6B;WAAEC,QAAQ,EAAE,CAC3D,IAAI,CAAC1C,QAAQ,CAACG,YAAY,GAAG,CAAC,IAAI,CAACyD,aAAa,EAAE,GAAG,IAAI,GAAGtB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aAC7EC,KAAK,EAAE;eAACC,SAAS,EAAE;cAAuB;aAC1CC,QAAQ,EAAE,CACT,IAAI,CAAC1C,QAAQ,CAACI,QAAQ,GAAGkC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;eAC3CC,KAAK,EAAE;iBAACC,SAAS,EAAE;gBAA4B;eAC/CoB,IAAI,EAAE,IAAI,CAAC1B,WAAW,CAAC,IAAI,CAACjD,cAAc;cAC1C,CAAC,EACFoD,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;eAACC,KAAK,EAAE;iBAACC,SAAS,EAAE;;cAA+B,CAAC,CACvE;aACDjB,MAAM,EAAE;eACPmB,KAAK,EAAE,IAAI,CAACmB,kBAAkB,CAACpC,IAAI,CAAC,IAAI;;YAEzC,CAAC,EACFY,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;aAClBC,KAAK,EAAE;eAACC,SAAS,EAAE;cAAiC;aACpDC,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;eAClBC,KAAK,EAAE;iBAACC,SAAS,EAAE;gBAAwB;eAC3CC,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;iBAClBC,KAAK,EAAE;mBAACC,SAAS,EAAE;kBAA6B;iBAChDoB,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,eAAe;gBACpC,CAAC,CACF;eACD1B,MAAM,EAAE;iBACPmB,KAAK,EAAE,IAAI,CAACoB,kBAAkB,CAACrC,IAAI,CAAC,IAAI;;cAEzC,CAAC,EACF,IAAI,CAAC1B,QAAQ,CAACM,aAAa,GAAGgC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;eAChDC,KAAK,EAAE;iBAACC,SAAS,EAAE;gBAA8B;eACjDjB,MAAM,EAAE;iBAACmB,KAAK,EAAE,IAAI,CAACqB,yBAAyB,CAACtC,IAAI,CAAC,IAAI;;cACxD,CAAC;YAEH,CAAC,EACF,IAAI,CAAC1B,QAAQ,CAACK,eAAe,GAAGiC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;aAClDC,KAAK,EAAE;eAACC,SAAS,EAAE,2BAA2B,IAAI,IAAI,CAACnD,oBAAoB,GAAG,EAAE,GAAG,mCAAmC;cAAE;aACxHuE,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,8BAA8B,CAAC;aACpD1B,MAAM,EAAE;eAACmB,KAAK,EAAE,IAAI,CAACsB,uBAAuB,CAACvC,IAAI,CAAC,IAAI;;YACtD,CAAC;UAEH,CAAC;QAEH,CAAC;;;KACF;KAAA,gCAEewC,CAAgB,EAChC;OACC,IAAIA,CAAC,CAACC,OAAO,IAAI,EAAE,EACnB;SACC,IAAI,CAACzE,SAAS,CAACG,MAAM,CAAC;WACrBuE,WAAW,EAAE,IAAI,CAACpE,QAAQ,CAACE,KAAK,CAAC6C,KAAK;WACtCd,MAAM,EAAE,IAAI,CAAC/C;UACb,CAAC;QACF,MACI,IAAIgF,CAAC,CAACC,OAAO,IAAI,EAAE,IAAID,CAAC,CAACC,OAAO,IAAI,EAAE,IAAID,CAAC,CAACC,OAAO,IAAI,CAAC,IAAID,CAAC,CAACC,OAAO,IAAI,GAAG,IAAID,CAAC,CAACC,OAAO,IAAI,EAAE,IAAID,CAAC,CAACC,OAAO,IAAI,EAAE,IAAID,CAAC,CAACC,OAAO,IAAI,EAAE;;SAC1I,CAAE,MACG,IAAID,CAAC,CAACG,GAAG,KAAK,GAAG,IAAIH,CAAC,CAACG,GAAG,KAAK,GAAG,IAAIH,CAAC,CAACG,GAAG,KAAK,GAAG;;SACxD,CAAE,MACG,IAAI,CAACH,CAAC,CAACC,OAAO,IAAI,EAAE,IAAID,CAAC,CAACC,OAAO,IAAI,EAAE,IAAID,CAAC,CAACC,OAAO,IAAI,EAAE,IAAID,CAAC,CAACC,OAAO,IAAI,EAAE,MAAMD,CAAC,CAACI,OAAO,IAAIJ,CAAC,CAACK,OAAO,CAAC;;SAC/G,CAAE,MACG,IAAIL,CAAC,CAACC,OAAO,IAAI,EAAE,IAAID,CAAC,CAACC,OAAO,IAAI,EAAE,IAAI,CAACD,CAAC,CAACM,QAAQ;;SAC1D;WACCC,cAAc,CAAC,IAAI,CAACzE,QAAQ,CAACE,KAAK,EAAEgE,CAAC,CAACG,GAAG,CAAC;WAE1CH,CAAC,CAACQ,cAAc,EAAE;WAClB,IAAI,CAAChF,SAAS,CAACC,aAAa,CAAC;aAC5B0E,GAAG,EAAEH,CAAC,CAACG;YACP,CAAC;UACF,MACI,IAAIH,CAAC,CAACC,OAAO,IAAI,EAAE,IAAID,CAAC,CAACC,OAAO,IAAI,GAAG,IAAI,CAACD,CAAC,CAACM,QAAQ;;SAC3D;WACCC,cAAc,CAAC,IAAI,CAACzE,QAAQ,CAACE,KAAK,EAAEgE,CAAC,CAACG,GAAG,CAAC;WAE1CH,CAAC,CAACQ,cAAc,EAAE;WAClB,IAAI,CAAChF,SAAS,CAACC,aAAa,CAAC;aAC5B0E,GAAG,EAAEH,CAAC,CAACG;YACP,CAAC;UACF,MACI,IAAI,CAACH,CAAC,CAACK,OAAO,IAAI,CAACL,CAAC,CAACI,OAAO,IAAI,CAACJ,CAAC,CAACS,MAAM,EAC9C;SACCT,CAAC,CAACQ,cAAc,EAAE;;;;KAEnB;KAAA,wCAGD;OACC,IAAI,CAAC1E,QAAQ,CAACC,cAAc,CAAC2E,SAAS,CAACC,MAAM,CAAC,gCAAgC,EAAE,IAAI,CAAC7E,QAAQ,CAACE,KAAK,CAAC6C,KAAK,CAACf,MAAM,GAAG,CAAC,CAAC;OAErH,IAAI,CAAChC,QAAQ,CAACE,KAAK,CAAC4E,KAAK,EAAE;;;KAC3B;KAAA,uCAGD;OACC,IAAI,CAAC9E,QAAQ,CAACE,KAAK,CAAC6C,KAAK,GAAG,IAAI,CAAC/C,QAAQ,CAACE,KAAK,CAAC6C,KAAK,CAACgC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC/E,QAAQ,CAACE,KAAK,CAAC6C,KAAK,CAACf,MAAM,GAAG,CAAC,CAAC;OACrG,IAAI,CAACsB,qBAAqB,EAAE;;;KAC5B;KAAA,qCAGD;OACC,IAAI,CAAC5D,SAAS,CAACG,MAAM,CAAC;SACrBuE,WAAW,EAAE,IAAI,CAACpE,QAAQ,CAACE,KAAK,CAAC6C,KAAK;SACtCd,MAAM,EAAE,IAAI,CAAC/C;QACb,CAAC;;;KACF;KAAA,0CAGD;OACC,IAAI,CAACQ,SAAS,CAACI,WAAW,CAAC;SAC1BO,eAAe,EAAE,IAAI,CAACL,QAAQ,CAACK;QAC/B,CAAC;;;KACF;KAAA,gCAEegE,GAAG,EACnB;OAAA;OACC,IAAIA,GAAG,KAAK,GAAG,EACf;SACC,IAAI,CAAC5E,WAAW,GAAG,KAAK;SACxB,IAAI,CAACc,cAAc,GAAGyE,UAAU,CAAC,YACjC;WACC,IAAI,CAAC,MAAI,CAAChF,QAAQ,CAACE,KAAK,CAAC6C,KAAK,CAACkC,UAAU,CAAC,GAAG,CAAC,EAC9C;aACC,MAAI,CAACxF,WAAW,GAAG,IAAI;aACvB,MAAI,CAACO,QAAQ,CAACE,KAAK,CAAC6C,KAAK,GAAG,GAAG,GAAG,MAAI,CAAC/C,QAAQ,CAACE,KAAK,CAAC6C,KAAK;;UAE5D,EAAE,GAAG,CAAC;;;;KAER;KAAA,8BAEasB,GAAG,EACjB;OACC,IAAIA,GAAG,KAAK,GAAG,EACf;SACCa,YAAY,CAAC,IAAI,CAAC3E,cAAc,CAAC;SACjC,IAAI,CAAC,IAAI,CAACd,WAAW,EACrB;WACCgF,cAAc,CAAC,IAAI,CAACzE,QAAQ,CAACE,KAAK,EAAE,GAAG,CAAC;;SAGzC,IAAI,CAACT,WAAW,GAAG,KAAK;QACxB,MAED;SACCgF,cAAc,CAAC,IAAI,CAACzE,QAAQ,CAACE,KAAK,EAAEmE,GAAG,CAAC;;OAEzC,IAAI,CAACf,qBAAqB,EAAE;OAC5B,IAAI,CAAC5D,SAAS,CAACC,aAAa,CAAC;SAC5B0E,GAAG,EAAEA;QACL,CAAC;;;KACF;KAAA,4CAGD;OAAA;OACC,IAAIc,SAAS,GAAG,EAAE;OAElB,IAAI,CAACzG,cAAI,CAAC0G,OAAO,CAAC,IAAI,CAACnG,OAAO,CAAC,IAAI,IAAI,CAACA,OAAO,CAAC+C,MAAM,KAAK,CAAC,EAC5D;SACC;;OAGD,IAAI,CAAC/C,OAAO,CAACoG,OAAO,CAAC,UAACjB,WAAW,EAAEkB,KAAK,EACxC;SACCH,SAAS,CAACI,IAAI,CAAC;WACd5E,EAAE,EAAE,UAAU,GAAG2E,KAAK;WACtBzB,IAAI,EAAE2B,cAAI,CAACC,MAAM,CAACrB,WAAW,CAAC;WAC9BsB,OAAO,EAAE,mBACT;aACC,MAAI,CAACC,iBAAiB,CAACC,KAAK,EAAE;aAC9B,MAAI,CAAClG,SAAS,CAACG,MAAM,CAAC;eACrBuE,WAAW,EAAEA,WAAW;eACxBnC,MAAM,EAAE,MAAI,CAAC/C;cACb,CAAC;;UAEH,CAAC;QACF,CAAC;OAEF,IAAI,CAACyG,iBAAiB,GAAG,IAAIE,eAAI,CAChC,0BAA0B,EAC1B,IAAI,CAAC7F,QAAQ,CAACM,aAAa,EAC3B6E,SAAS,EACT;SACClE,QAAQ,EAAE,IAAI;SACdpC,SAAS,EAAE,CAAC;SACZC,UAAU,EAAE,CAAC;SACbS,MAAM,EAAElB,UAAU,GAAG,GAAG;SACxByH,WAAW,EAAE;WACZlE,QAAQ,EAAE;UACV;SACDD,KAAK,EAAE;WACNE,MAAM,EAAE;UACR;SACDb,UAAU,EAAE,IAAI;SAChBK,OAAO,EAAE;WACRC,eAAe,EAAE,OAAO;WACxBC,OAAO,EAAE;UACT;SACDC,MAAM,EAAE;WACPC,YAAY,EAAE;aAAA,OAAM,MAAI,CAACkE,iBAAiB,CAAC5D,OAAO,EAAE;;WACpDgE,cAAc,EAAE;aAAA,OAAM,MAAI,CAACJ,iBAAiB,GAAG,IAAI;;;QAEpD,CACD;OACD,IAAI,CAACA,iBAAiB,CAACK,IAAI,EAAE;;;KAC7B;KAAA,mCAEkB9B,CAAC,EACpB;OAAA;OACC,IAAIiB,SAAS,GAAG,EAAE;OAClB,IAAI,CAAC9F,cAAc,CAACgG,OAAO,CAAC,UAACpD,MAAM,EACnC;SACCkD,SAAS,CAACI,IAAI,CAAC;WACd5E,EAAE,EAAE,aAAa,GAAGsB,MAAM;WAC1B4B,IAAI,EAAE2B,cAAI,CAACC,MAAM,CAAC,MAAI,CAACtD,WAAW,CAACF,MAAM,CAAC,CAAC;WAC3CyD,OAAO,EAAE,mBACT;aACC,MAAI,CAACO,cAAc,CAACL,KAAK,EAAE;aAC3B,MAAI,CAACM,iBAAiB,CAACjE,MAAM,CAAC;;UAE/B,CAAC;QACF,CAAC;OAEF,IAAI,CAACgE,cAAc,GAAG,IAAIJ,eAAI,CAC7B,yBAAyB,EACzB,IAAI,CAAC7F,QAAQ,CAACG,YAAY,EAC1BgF,SAAS,EACT;SACClE,QAAQ,EAAE,IAAI;SACd1B,MAAM,EAAE,IAAI,CAACA,MAAM,GAAG,GAAG;SACzByB,UAAU,EAAE,IAAI;SAChB8E,WAAW,EAAE;WACZlE,QAAQ,EAAE;UACV;SACD9C,UAAU,EAAE,EAAE;SACd6C,KAAK,EAAE;WACNE,MAAM,EAAE;UACR;SACDR,OAAO,EAAE;WACRC,eAAe,EAAE,OAAO;WACxBC,OAAO,EAAE;UACT;SACD4E,SAAS,EAAE,GAAG;SACd3E,MAAM,EAAE;WACPC,YAAY,EAAE;aAAA,OAAM,MAAI,CAACwE,cAAc,CAAClE,OAAO,EAAE;;WACjDgE,cAAc,EAAE;aAAA,OAAM,MAAI,CAACE,cAAc,GAAG,IAAI;;;QAEjD,CACD;OACD,IAAI,CAACA,cAAc,CAACD,IAAI,EAAE;;;KAC1B;KAAA,uBAGD;OACC,IAAI,IAAI,CAACxF,KAAK,EACd;SACC,IAAI,CAACA,KAAK,CAACwF,IAAI,EAAE;SACjB,IAAI,CAAChG,QAAQ,CAACE,KAAK,CAAC4E,KAAK,EAAE;;;;KAE5B;KAAA,wBAGD;OACC,IAAI,IAAI,CAACmB,cAAc,EACvB;SACC,IAAI,CAACA,cAAc,CAAClE,OAAO,EAAE;;OAG9B,IAAI,IAAI,CAAC4D,iBAAiB,EAC1B;SACC,IAAI,CAACA,iBAAiB,CAAC5D,OAAO,EAAE;;OAGjC,IAAI,IAAI,CAACvB,KAAK,EACd;SACC,IAAI,CAACA,KAAK,CAACoF,KAAK,EAAE;;;;KAEnB;KAAA,0BAGD;OACC,IAAI,IAAI,CAACK,cAAc,EACvB;SACC,IAAI,CAACA,cAAc,CAAClE,OAAO,EAAE;;OAG9B,IAAI,IAAI,CAAC4D,iBAAiB,EAC1B;SACC,IAAI,CAACA,iBAAiB,CAAC5D,OAAO,EAAE;;OAGjC,IAAI,IAAI,CAACvB,KAAK,EACd;SACC,IAAI,CAACA,KAAK,CAACuB,OAAO,EAAE;;OAGrB,IAAI,CAACvB,KAAK,GAAG,IAAI;;;GACjB;CAAA;CAGF,SAASiD,YAAY,CAAC2C,MAAc,EAAEC,WAAW,EAAEC,SAAS,EAC5D;GACC,IAAIC,WAAW;GACf,IAAIH,MAAM,IAAI,GAAG,EACjB;KACCG,WAAW,GAAG,IAAI;IAClB,MACI,IAAIH,MAAM,IAAI,GAAG,EACtB;KACCG,WAAW,GAAG,IAAI;IAClB,MAED;KACCA,WAAW,GAAGH,MAAM;;GAErB,OAAO9D,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;KACzBiE,OAAO,EAAE;OAAC,OAAO,EAAEJ;MAAO;KAC1B5D,KAAK,EAAE;OAACC,SAAS,EAAE,8CAA8C,GAAG8D;MAAY;KAChF7D,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;OAACC,KAAK,EAAE;SAACC,SAAS,EAAE;;MAA6B,CAAC,CACrE;KACDjB,MAAM,EAAE;OACPiF,SAAS,EAAE,mBAACvC,CAAC;SAAA,OAAKmC,WAAW,CAACnC,CAAC,CAACwC,aAAa,CAACF,OAAO,CAAChD,KAAK,CAAC;;OAC5DmD,OAAO,EAAE,iBAACzC,CAAC;SAAA,OAAKoC,SAAS,CAACpC,CAAC,CAACwC,aAAa,CAACF,OAAO,CAAChD,KAAK,CAAC;;;IAEzD,CAAC;CACH;CAEA,SAASiB,cAAc,CAACmC,YAAY,EAAE7D,KAAK,EAC3C;GACC,IAAI6D,YAAY,CAACC,cAAc,IAAID,YAAY,CAACC,cAAc,IAAI,GAAG,EACrE;KACC,IAAIC,QAAQ,GAAGF,YAAY,CAACC,cAAc;KAC1C,IAAIE,MAAM,GAAGH,YAAY,CAACI,YAAY;KACtCJ,YAAY,CAAC7D,KAAK,GAAG6D,YAAY,CAAC7D,KAAK,CAACkE,SAAS,CAAC,CAAC,EAAEH,QAAQ,CAAC,GAC3D/D,KAAK,GACL6D,YAAY,CAAC7D,KAAK,CAACkE,SAAS,CAACF,MAAM,EAAEH,YAAY,CAAC7D,KAAK,CAACf,MAAM,CAAC;KAClE4E,YAAY,CAACC,cAAc,GAAGC,QAAQ,GAAG/D,KAAK,CAACf,MAAM;KACrD4E,YAAY,CAACI,YAAY,GAAGF,QAAQ,GAAG/D,KAAK,CAACf,MAAM;IACnD,MAED;KACC4E,YAAY,CAAC7D,KAAK,IAAIA,KAAK;;CAE7B;;CClgBO,IAAMmE,cAAc,GAAG;GAC7BC,qBAAqB,EAAE,uBAAuB;GAC9CC,eAAe,EAAE,iBAAiB;GAClCC,eAAe,EAAE,iBAAiB;GAClCC,mBAAmB,EAAE,qBAAqB;GAC1CC,yBAAyB,EAAE,2BAA2B;GACtDC,2BAA2B,EAAE,6BAA6B;GAC1DC,iBAAiB,EAAE,mBAAmB;GACtCC,eAAe,EAAE,iBAAiB;GAClCC,eAAe,EAAE,iBAAiB;GAClCC,iBAAiB,EAAE,mBAAmB;GACtCC,aAAa,EAAE,eAAe;GAC9BC,iBAAiB,EAAE,mBAAmB;GACtCC,kBAAkB,EAAE,oBAAoB;GACxCC,mBAAmB,EAAE,qBAAqB;GAC1CC,sBAAsB,EAAE,wBAAwB;GAChDC,gBAAgB,EAAE;CACnB,CAAC;CAED,IAAMC,iBAAiB,GAAG;GACzBC,MAAM,EAAE,OAAO;GACfC,SAAS,EAAE;CACZ,CAAC;;CAED;AACA,KAAaC,UAAU;GAAA;KAAA;KAAA,oDAGI,KAAK;KAAA,0CACf,KAAK;;GAAA;KAAA;2DAOrB;OACC,MAAM,IAAIC,KAAK,CAAC,uDAAuD,CAAC;MACxE;;KAED;KAAA,oCACoBC,SAAiB,EACrC;OACC,MAAM,IAAID,KAAK,CAAC,uDAAuD,CAAC;MACxE;;KAED;KAAA,oCACoB9J,MAAM,EAC1B;OACC,MAAM,IAAI8J,KAAK,CAAC,uDAAuD,CAAC;MACxE;;KAED;KAAA,0BACUE,IAAY,EAAEhK,MAAM,EAC9B;OACC,MAAM,IAAI8J,KAAK,CAAC,6CAA6C,CAAC;;;KAC9D;KAAA,4BAEWG,QAAwB,EACpC;OACC,IAAI,CAACC,QAAQ,GAAGD,QAAQ;OAExB,OAAO,IAAI;;;KACX;KAAA,kCAEiBE,cAAuB,EACzC;OACC,IAAI,CAACA,cAAc,GAAGA,cAAc;OAEpC,OAAO,IAAI;;;KACX;KAAA,+BAGD;OACC,OAAO,IAAI,CAACD,QAAQ,YAAYE,aAAa;;;KAC7C;KAAA,yBAGD;OACC,OAAO,IAAI,CAACC,IAAI;;;KAChB;KAAA,0CAEyBN,SAAiB,EAC3C;OACCA,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,iCAAiC,CAAC;OAClEiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,2CAA2C,CAAC;OAC5EiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,qCAAqC,CAAC;OACtEiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,qCAAqC,CAAC;OACtEiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,sCAAsC,CAAC;OACvEiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,yCAAyC,CAAC;OAC1EiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,+CAA+C,CAAC;OAChFiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,iDAAiD,CAAC;OAClFiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,uCAAuC,CAAC;OACxEiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,qCAAqC,CAAC;OACtEiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,qCAAqC,CAAC;OACtEiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,uCAAuC,CAAC;OACxEiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,mCAAmC,CAAC;OACpEiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,uCAAuC,CAAC;OACxEiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,wCAAwC,CAAC;OACzEiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,yCAAyC,CAAC;OAC1EiD,SAAS,CAACO,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,4CAA4C,CAAC;OAE7E,OAAO,IAAI;;;KACX;KAAA,4BAGD;OACC,OAAO2B,cAAc;;;KACrB;KAAA,gCAEezI,MAAU,EAAEuK,QAAkB,EAC9C;OACC,IAAI,CAACF,IAAI,GAAG,IAAI;OAChBE,QAAQ,CAACC,MAAM,CAACC,IAAI,CAACC,OAAO,CAAC,CAACC,MAAM,CAAC,UAACC,KAAK,EAC3C;SACC,QAAQA,KAAK;WAEZ,KAAK,eAAe;aACnB,OAAO,KAAK;WACb,KAAK,MAAM;aACV,OAAO,KAAK;WACb,KAAK,cAAc;aAClB,OAAO,KAAK;WACb;aACC,OAAO,IAAI;;QAEb,CAAC,CAAC;;;KACH;KAAA,2BAEU5K,MAA0D,EAAEuK,QAAkB,EACzF;OACC,IAAI,CAACF,IAAI,GAAG,IAAI;OAChB,IAAI,CAAC,IAAI,CAACQ,YAAY,EAAE,IAAI,CAAC,IAAI,CAACV,cAAc,EAChD;SACCI,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAE5C;;OAGD,IAAI9K,MAAM,IAAIA,MAAM,CAAC+K,OAAO,IAAIL,OAAO,CAAC1K,MAAM,CAAC+K,OAAO,CAAC,EACvD;SACC,IAAI,CAACb,QAAQ,CAACc,UAAU,CAACN,OAAO,CAAC1K,MAAM,CAAC+K,OAAO,CAAC,CAAC;;;QAGjD,MAED;SACCR,QAAQ,CAAC,CAAC;WACTZ,MAAM,EAAE,OAAO;WACfC,SAAS,EAAE;UACX,CAAC,CAAC;SAEH;;OAED,IAAI5J,MAAM,CAAC+K,OAAO,KAAK,WAAW,EAClC;SACC,IAAI/K,MAAM,CAACiL,qBAAqB,EAChC;WACC,IAAI,CAACf,QAAQ,CAACgB,SAAS,EAAE;WACzB,IAAI,CAACC,SAAS,EAAE;UAChB,MAED;WACC,IAAI,CAACC,SAAS,EAAE;;;OAIlB,IAAIpL,MAAM,CAAC+K,OAAO,KAAK,WAAW,IAAI,CAAC,IAAI,CAACb,QAAQ,CAACmB,cAAc,EAAE,EACrE;SACC,IAAI,CAACF,SAAS,EAAE;;OAGjBZ,QAAQ,CAAC,EAAE,CAAC;;;KACZ;KAAA,wBAEOvK,MAAwB,EAAEuK,QAAkB,EACpD;OACC,IAAI,CAACF,IAAI,GAAG,IAAI;OAChB,IAAI,CAAC,IAAI,CAACQ,YAAY,EAAE,IAAI,CAAC,IAAI,CAACV,cAAc,EAChD;SACCI,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAE5C;;OAGD,IAAI,IAAI,CAACZ,QAAQ,CAACoB,OAAO,EAAE,KAAK,CAAC,CAACtL,MAAM,CAACuL,KAAK,EAC9C;SACChB,QAAQ,CAAC,EAAE,CAAC;SAEZ;;OAED,IAAIvK,MAAM,CAACuL,KAAK,EAChB;SACC,IAAI,CAACrB,QAAQ,CAACsB,QAAQ,CAACxL,MAAM,CAACuL,KAAK,CAAC;SACpCE,EAAE,CAACC,QAAQ,CAAC,IAAI,CAACxB,QAAQ,CAAC3I,QAAQ,CAACoK,OAAO,CAACC,IAAI,EAAE,QAAQ,CAAC;SAC1D,IAAI,IAAI,CAAC1B,QAAQ,CAAC2B,SAAS,EAAE,IAAI,IAAI,CAAC3B,QAAQ,CAAC4B,KAAK,EACpD;WACCL,EAAE,CAACM,OAAO,CAACC,aAAa,CAACC,aAAa,CAACC,MAAM,EAAE,EAAE,CAAC;UAClD,MAED;WACC,IAAI,CAAChC,QAAQ,CAACjJ,SAAS,CAAC2K,IAAI,EAAE;;QAE/B,MAED;SACC,IAAI,CAAC1B,QAAQ,CAACsB,QAAQ,CAACxL,MAAM,CAACuL,KAAK,CAAC;SACpCE,EAAE,CAACU,WAAW,CAAC,IAAI,CAACjC,QAAQ,CAAC3I,QAAQ,CAACoK,OAAO,CAACC,IAAI,EAAE,QAAQ,CAAC;SAC7D,IAAI,IAAI,CAAC1B,QAAQ,CAAC2B,SAAS,EAAE,IAAI,IAAI,CAAC3B,QAAQ,CAAC4B,KAAK,EACpD;WACCL,EAAE,CAACM,OAAO,CAACC,aAAa,CAACC,aAAa,CAACG,QAAQ,EAAE,EAAE,CAAC;UACpD,MAED;WACC,IAAI,CAAClC,QAAQ,CAACjJ,SAAS,CAACoL,MAAM,EAAE;;;OAGlC9B,QAAQ,CAAC,EAAE,CAAC;;;KACZ;KAAA,wBAEOvK,MAAuB,EAAEuK,QAAkB,EACnD;OACC,IAAI,CAACF,IAAI,GAAG,IAAI;OAChB,IAAI,CAAC,IAAI,CAACQ,YAAY,EAAE,IAAI,CAAC,IAAI,CAACV,cAAc,EAChD;SACCI,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAE5C;;OAGD,IAAI,IAAI,CAACZ,QAAQ,CAACoC,MAAM,EAAE,KAAK,CAAC,CAACtM,MAAM,CAACuM,IAAI,EAC5C;SACChC,QAAQ,CAAC,EAAE,CAAC;SAEZ;;OAED,IAAIvK,MAAM,CAACuM,IAAI,EACf;SACC,IAAI,CAACrC,QAAQ,CAACsC,OAAO,CAACxM,MAAM,CAACuM,IAAI,CAAC;SAClCd,EAAE,CAACC,QAAQ,CAAC,IAAI,CAACxB,QAAQ,CAAC3I,QAAQ,CAACoK,OAAO,CAACc,IAAI,EAAE,QAAQ,CAAC;SAC1D,IAAI,IAAI,CAACvC,QAAQ,CAAC2B,SAAS,EAAE,IAAI,IAAI,CAAC3B,QAAQ,CAAC4B,KAAK,EACpD;WACCL,EAAE,CAACM,OAAO,CAACC,aAAa,CAACC,aAAa,CAACS,MAAM,EAAE,EAAE,CAAC;UAClD,MAED;WACC,IAAI,CAACxC,QAAQ,CAACjJ,SAAS,CAACwL,IAAI,EAAE;;QAE/B,MAED;SACC,IAAI,CAACvC,QAAQ,CAACsC,OAAO,CAACxM,MAAM,CAACuM,IAAI,CAAC;SAClCd,EAAE,CAACU,WAAW,CAAC,IAAI,CAACjC,QAAQ,CAAC3I,QAAQ,CAACoK,OAAO,CAACc,IAAI,EAAE,QAAQ,CAAC;SAC7D,IAAI,IAAI,CAACvC,QAAQ,CAAC2B,SAAS,EAAE,IAAI,IAAI,CAAC3B,QAAQ,CAAC4B,KAAK,EACpD;WACCL,EAAE,CAACM,OAAO,CAACC,aAAa,CAACC,aAAa,CAACU,QAAQ,EAAE,EAAE,CAAC;UACpD,MAED;WACC,IAAI,CAACzC,QAAQ,CAACjJ,SAAS,CAAC2L,MAAM,EAAE;;;OAGlCrC,QAAQ,CAAC,EAAE,CAAC;;;KACZ;KAAA,2BAEUvK,MAAU,EAAEuK,QAAkB,EACzC;OACC,IAAI,CAACF,IAAI,GAAG,IAAI;OAChB,IAAI,CAAC,IAAI,CAACQ,YAAY,EAAE,IAAI,CAAC,IAAI,CAACV,cAAc,EAChD;SACCI,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAE5C;;OAGD,IAAI,CAACM,SAAS,EAAE;OAChB,IAAI,CAAClB,QAAQ,CAAC2C,UAAU,EAAE;;;KAC1B;KAAA,0BAES7M,MAAU,EAAEuK,QAAkB,EACxC;OACC,IAAI,CAACF,IAAI,GAAG,IAAI;OAChB,IAAI,CAAC,IAAI,CAACQ,YAAY,EAAE,IAAI,CAAC,IAAI,CAACV,cAAc,EAChD;SACCI,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAE5C;;OAGD,IAAI,CAACZ,QAAQ,CAACgB,SAAS,EAAE;;;KACzB;KAAA,sBAEKlL,MAAU,EAAEuK,QAAkB,EACpC;OACC,IAAI,CAACF,IAAI,GAAG,IAAI;OAChB,IAAI,CAAC,IAAI,CAACQ,YAAY,EAAE,IAAI,CAAC,IAAI,CAACV,cAAc,EAChD;SACCI,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAE5C;;OAGD,IAAI,CAACZ,QAAQ,CAAC/C,KAAK,EAAE;OACrBoD,QAAQ,CAAC,EAAE,CAAC;OAEZ,IAAI,CAACL,QAAQ,GAAG,KAAK;;;KACrB;KAAA,6BAEYlK,MAAuB,EAAEuK,QAAkB,EACxD;OACC,IAAI,CAACF,IAAI,GAAG,IAAI;OAChB,IAAI,CAAC,IAAI,CAACQ,YAAY,EAAE,IAAI,CAAC,IAAI,CAACV,cAAc,EAChD;SACCI,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAE5C;;OAED,IAAI,CAACZ,QAAQ,CAAC4C,QAAQ,CAAC9M,MAAM,CAAC+M,KAAK,CAAC;OACpCxC,QAAQ,CAAC,EAAE,CAAC;;;KACZ;KAAA,8BAEavK,MAA4B,EAAEuK,QAAkB,EAC9D;OACC,IAAI,CAACF,IAAI,GAAG,IAAI;OAChB,IAAI,CAAC,IAAI,CAACQ,YAAY,EAAE,IAAI,CAAC,IAAI,CAACV,cAAc,EAChD;SACCI,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAE5C;;OAED,IAAI,CAACZ,QAAQ,CAAC8C,aAAa,CAAChN,MAAM,CAACiN,UAAU,CAAC;OAC9C1C,QAAQ,CAAC,EAAE,CAAC;;;KACZ;KAAA,4BAGD;OACC,IAAI,CAAC,IAAI,CAACL,QAAQ,CAAC3I,QAAQ,CAAC2L,KAAK,CAACC,OAAO,EACzC;SACC,IAAI,CAACjD,QAAQ,CAACkD,QAAQ,CAACF,KAAK,CAACC,OAAO,GAAG,IAAI;SAC3C,IAAI,CAACjD,QAAQ,CAAC3I,QAAQ,CAAC2L,KAAK,CAACG,KAAK,CAACC,OAAO,GAAG,EAAE;SAC/C,IAAG,IAAI,CAACpD,QAAQ,CAACqD,QAAQ,EAAE,EAC3B;WACC,IAAI,CAACrD,QAAQ,CAACsD,gBAAgB,CAACN,KAAK,CAACG,KAAK,CAACC,OAAO,GAAG,EAAE;;;;;KAGzD;KAAA,4BAGD;OACC,IAAI,IAAI,CAACpD,QAAQ,CAACkD,QAAQ,CAACF,KAAK,EAChC;SACC,IAAI,CAAChD,QAAQ,CAACkD,QAAQ,CAACF,KAAK,CAACC,OAAO,GAAG,KAAK;;OAE7C,IAAI,IAAI,CAACjD,QAAQ,CAAC3I,QAAQ,CAAC2L,KAAK,EAChC;SACC,IAAI,CAAChD,QAAQ,CAAC3I,QAAQ,CAAC2L,KAAK,CAACG,KAAK,CAACC,OAAO,GAAG,MAAM;;OAEpD,IAAI,CAACpD,QAAQ,CAACuD,gBAAgB,GAAG,CAAC;;;KAClC;KAAA,4CAGD;OACC,OAAO/D,iBAAiB;;;GACxB;CAAA;;CC3WF,IAAMgE,mBAAmB,GAAG;GAC3B1C,UAAU,EAAE,2BAA2B;GACvC2C,OAAO,EAAE,wBAAwB;GACjCC,OAAO,EAAE,wBAAwB;GACjCC,cAAc,EAAE,+BAA+B;GAC/CC,YAAY,EAAE,6BAA6B;GAC3Cd,aAAa,EAAE,8BAA8B;GAC7C7F,KAAK,EAAE,sBAAsB;GAC7B0F,UAAU,EAAE,2BAA2B;GACvC3B,SAAS,EAAE;CACZ,CAAC;CAED,IAAM6C,yBAAyB,GAAG;GACjCrF,qBAAqB,EAAE,sCAAsC;GAC7DC,eAAe,EAAE,gCAAgC;GACjDC,eAAe,EAAE,gCAAgC;GACjDC,mBAAmB,EAAE,oCAAoC;GACzDC,yBAAyB,EAAE,0CAA0C;GACrEC,2BAA2B,EAAE,4CAA4C;GACzEC,iBAAiB,EAAE,kCAAkC;GACrDC,eAAe,EAAE,gCAAgC;GACjDC,eAAe,EAAE,gCAAgC;GACjDC,iBAAiB,EAAE,kCAAkC;GACrDC,aAAa,EAAE,8BAA8B;GAC7CC,iBAAiB,EAAE,kCAAkC;GACrDC,kBAAkB,EAAE,mCAAmC;GACvDC,mBAAmB,EAAE,oCAAoC;GACzDC,sBAAsB,EAAE;CACzB,CAAC;AAED,KAAawE,aAAa;GAAA;GAIzB,yBAAc;KAAA;KAAA;KACb;KAEA,MAAKC,aAAa,GAAG,EAAE;KAAC;;GACxB;KAAA;KAAA,+BAGD;OACC,OAAO,2GAAwB,IAAI,CAAC/D,QAAQ,KAAK,IAAI;;;KACrD;KAAA,sCAGD;OACC,IAAMH,SAAS,GAAG0B,EAAE,CAACyC,IAAI,CAACC,SAAS,CAACC,mBAAmB,CAAC,wBAAwB,CAAC;OAEjF,IAAI,CAACC,0BAA0B,CAACtE,SAAS,CAAC;OAC1C,IAAI,CAACuE,yBAAyB,CAACvE,SAAS,CAAC;OACzC,IAAI,CAACwE,qCAAqC,EAAE;;;KAC5C;KAAA,oCAEmBxE,SAAS,EAC7B;OAEC,IAAI,CAACsE,0BAA0B,CAACtE,SAAS,CAAC;OAC1C,IAAI,CAACyE,wBAAwB,EAAE;;;KAE/B;KAAA,2CAC0BzE,SAAS,EACpC;OAAA;OACCA,SAAS,CAACO,SAAS,CAACmE,uBAAuB,GAAG,UAACzO,MAAM,EAAEuK,QAAQ;SAAA,OAAK,MAAI,CAACmE,eAAe,CAAC1O,MAAM,EAAEuK,QAAQ,CAAC;;OAE1GR,SAAS,CAACO,SAAS,CAACqE,eAAe,GAAG,UAAC3O,MAAM,EAAEuK,QAAQ;SAAA,OAAK,MAAI,CAACqE,eAAe,CAAC5O,MAAM,EAAEuK,QAAQ,CAAC;;OAClGR,SAAS,CAACO,SAAS,CAACuE,eAAe,GAAG,UAAC7O,MAAM,EAAEuK,QAAQ;SAAA,OAAK,MAAI,CAACuE,eAAe,CAAC9O,MAAM,EAAEuK,QAAQ,CAAC;;OAClGR,SAAS,CAACO,SAAS,CAACyE,kBAAkB,GAAG,UAAC/O,MAAM,EAAEuK,QAAQ;SAAA,OAAK,MAAI,CAACyE,kBAAkB,CAAChP,MAAM,EAAEuK,QAAQ,CAAC;;OACxGR,SAAS,CAACO,SAAS,CAAC2E,oBAAoB,GAAG,UAACjP,MAAM,EAAEuK,QAAQ;SAAA,OAAK,MAAI,CAAC2E,oBAAoB,CAAClP,MAAM,EAAEuK,QAAQ,CAAC;;OAC5GR,SAAS,CAACO,SAAS,CAAC6E,qBAAqB,GAAG,UAACnP,MAAM,EAAEuK,QAAQ;SAAA,OAAK,MAAI,CAAC6E,qBAAqB,CAACpP,MAAM,EAAEuK,QAAQ,CAAC;;OAC9GR,SAAS,CAACO,SAAS,CAAC+E,aAAa,GAAG,UAACrP,MAAM,EAAEuK,QAAQ;SAAA,OAAK,MAAI,CAAC+E,aAAa,CAACtP,MAAM,EAAEuK,QAAQ,CAAC;;OAC9FR,SAAS,CAACO,SAAS,CAACiF,kBAAkB,GAAG,UAACvP,MAAM,EAAEuK,QAAQ;SAAA,OAAK,MAAI,CAACiF,kBAAkB,CAACxP,MAAM,EAAEuK,QAAQ,CAAC;;OACxGR,SAAS,CAACO,SAAS,CAACmF,iBAAiB,GAAG,UAACzP,MAAM,EAAEuK,QAAQ;SAAA,OAAK,MAAI,CAACmF,iBAAiB,CAAC1P,MAAM,EAAEuK,QAAQ,CAAC;;;;KACtG;KAAA,oCAEmBvK,MAAM,EAC1B;OACC,IAAI,CAAC,IAAI,CAACmK,cAAc,EACxB;SACC;;OAGD,IAAI,IAAI,CAACwF,cAAc,EAAE,EACzB;SACCC,eAAe,CAACC,cAAc,CAAC,4BAA4B,EAAE,CAAC7P,MAAM,CAAC,CAAC;SAEtE;;OAGDyL,EAAE,CAACO,aAAa,CAAC8D,MAAM,EAAE,iCAAiC,EAAE,CAAC9P,MAAM,CAAC,CAAC;;;KACrE;KAAA,0BAESgK,IAAY,EAAEhK,MAAM,EAC9B;OACC,IAAI,CAAC,IAAI,CAACmK,cAAc,EACxB;SACC;;OAGD,IAAI,IAAI,CAACwF,cAAc,EAAE,EACzB;SACC,IAAMI,gBAAgB,GAAG,iBAAiB,IAAI/F,IAAI,CAAC,CAAC,CAAC,CAACgG,WAAW,EAAE,GAAGhG,IAAI,CAACiG,KAAK,CAAC,CAAC,CAAC,CAAC;SACpFL,eAAe,CAACC,cAAc,CAACE,gBAAgB,EAAE,CAAC/P,MAAM,CAAC,CAAC;;OAG3DyL,EAAE,CAACO,aAAa,CAAC8D,MAAM,EAAE,sBAAsB,GAAG9F,IAAI,EAAE,CAAChK,MAAM,CAAC,CAAC;;;KACjE;KAAA,6CAGD;OACC,KAAK,IAAMkQ,KAAK,IAAI,IAAI,CAACC,SAAS,EAAE,EACpC;SACC,IAAI,CAACC,kBAAkB,CAAC,iBAAiB,IAAIF,KAAK,CAAC,CAAC,CAAC,CAACF,WAAW,EAAE,GAAGE,KAAK,CAACD,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;;OAEvF,IAAI,CAACG,kBAAkB,CAAC,4BAA4B,CAAC;OACrD,IAAI,CAACA,kBAAkB,CAAC,iCAAiC,CAAC;;;CAG5D;CACA;CACA;;;KACC;KAAA,2CAGA;OAAA;OACC,IAAI,CACFC,cAAc,CACd3C,mBAAmB,CAACG,cAAc,EAClC,UAAC7N,MAAM,EAAEuK,QAAQ;SAAA,OAChB,MAAI,CAAC+F,iBAAiB,CAACtQ,MAAM,EAAEuK,QAAQ,EAAE,MAAI,CAACmE,eAAe,CAAC;SAC/D,CACA2B,cAAc,CACd3C,mBAAmB,CAAC1C,UAAU,EAC9B,UAAChL,MAAM,EAAEuK,QAAQ;SAAA,OAChB,MAAI,CAAC+F,iBAAiB,CAACtQ,MAAM,EAAEuK,QAAQ,EAAE,MAAI,CAACgG,yBAAyB,EAAE,CAACvF,UAAU,CAAC;SACtF,CACAqF,cAAc,CACd3C,mBAAmB,CAACC,OAAO,EAC3B,UAAC3N,MAAM,EAAEuK,QAAQ;SAAA,OAChB,MAAI,CAAC+F,iBAAiB,CAACtQ,MAAM,EAAEuK,QAAQ,EAAE,MAAI,CAACgG,yBAAyB,EAAE,CAAC5C,OAAO,CAAC;SACnF,CACA0C,cAAc,CACd3C,mBAAmB,CAACE,OAAO,EAC3B,UAAC5N,MAAM,EAAEuK,QAAQ;SAAA,OAChB,MAAI,CAAC+F,iBAAiB,CAACtQ,MAAM,EAAEuK,QAAQ,EAAE,MAAI,CAACgG,yBAAyB,EAAE,CAAC3C,OAAO,CAAC;SACnF,CACAyC,cAAc,CACd3C,mBAAmB,CAACI,YAAY,EAChC,UAAC9N,MAAM,EAAEuK,QAAQ;SAAA,OAChB,MAAI,CAAC+F,iBAAiB,CAACtQ,MAAM,EAAEuK,QAAQ,EAAE,MAAI,CAACgG,yBAAyB,EAAE,CAACzC,YAAY,CAAC;SACxF,CACAuC,cAAc,CACd3C,mBAAmB,CAACV,aAAa,EACjC,UAAChN,MAAM,EAAEuK,QAAQ;SAAA,OAChB,MAAI,CAAC+F,iBAAiB,CAACtQ,MAAM,EAAEuK,QAAQ,EAAE,MAAI,CAACgG,yBAAyB,EAAE,CAACvD,aAAa,CAAC;SACzF,CACAqD,cAAc,CACd3C,mBAAmB,CAACvG,KAAK,EACzB,UAACnH,MAAM,EAAEuK,QAAQ;SAAA,OAChB,MAAI,CAAC+F,iBAAiB,CAACtQ,MAAM,EAAEuK,QAAQ,EAAE,MAAI,CAACgG,yBAAyB,EAAE,CAACpJ,KAAK,CAAC;SACjF,CACAkJ,cAAc,CACd3C,mBAAmB,CAACb,UAAU,EAC9B,UAAC7M,MAAM,EAAEuK,QAAQ;SAAA,OAChB,MAAI,CAAC+F,iBAAiB,CAACtQ,MAAM,EAAEuK,QAAQ,EAAE,MAAI,CAACgG,yBAAyB,EAAE,CAAC1D,UAAU,CAAC;SACtF,CACAwD,cAAc,CACd3C,mBAAmB,CAACxC,SAAS,EAC7B,UAAClL,MAAM,EAAEuK,QAAQ;SAAA,OAChB,MAAI,CAAC+F,iBAAiB,CAACtQ,MAAM,EAAEuK,QAAQ,EAAE,MAAI,CAACgG,yBAAyB,EAAE,CAACrF,SAAS,CAAC;SACrF;;;KACF;KAAA,kCAEiBlL,MAAW,EAAEuK,QAAkB,EAAEiG,OAAiB,EACpE;OACC,IAAI,IAAI,CAACC,qBAAqB,EAAE,EAChC;SACC;;OAED,IAAI,CAACpG,IAAI,GAAG,IAAI;OAChBE,QAAQ,GAAG,OAAQA,QAAS,KAAK,UAAU,GAAGA,QAAQ,GAAGkB,EAAE,CAACiF,SAAS;OAErEF,OAAO,CAACxQ,MAAM,EAAEuK,QAAQ,CAAC;;;KACzB;KAAA,mCAEkBvK,MAA0D,EAAEuK,QAAkB,EACjG;OACC,IAAI,CAAC,IAAI,CAACM,YAAY,EAAE,EACxB;SACCN,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAC5C;;OAED,IAAI,CAAC9K,MAAM,CAAC2D,cAAc,CAAC,SAAS,CAAC,IAAI,CAAC+G,OAAO,CAAC1K,MAAM,CAAC+K,OAAO,CAAC,EACjE;SACCR,QAAQ,CAAC,CAAC;WACTZ,MAAM,EAAE,OAAO;WACfC,SAAS,EAAE;UACX,CAAC,CAAC;SAEH;;OAEDgG,eAAe,CAACC,cAAc,CAACnC,mBAAmB,CAAC1C,UAAU,EAAE,CAAChL,MAAM,EAAEyL,EAAE,CAACiF,SAAS,CAAC,CAAC;OACtFnG,QAAQ,CAAC,EAAE,CAAC;;;KACZ;KAAA,gCAEevK,MAAwB,EAAEuK,QAAkB,EAC5D;OACC,IAAI,CAAC,IAAI,CAACM,YAAY,EAAE,EACxB;SACCN,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAC5C;;OAED,IAAI,CAAC9K,MAAM,CAAC2D,cAAc,CAAC,OAAO,CAAC,EACnC;SACC4G,QAAQ,CAAC;WACRZ,MAAM,EAAE,OAAO;WACfC,SAAS,EAAE;UACX,CAAC;SAEF;;OAGDgG,eAAe,CAACC,cAAc,CAACnC,mBAAmB,CAACC,OAAO,EAAE,CAAC3N,MAAM,EAAEyL,EAAE,CAACiF,SAAS,CAAC,CAAC;OACnFnG,QAAQ,CAAC,EAAE,CAAC;;;KACZ;KAAA,gCAEevK,MAAuB,EAAEuK,QAAkB,EAC3D;OACC,IAAI,CAAC,IAAI,CAACM,YAAY,EAAE,EACxB;SACCN,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAC5C;;OAGD,IAAI,CAAC9K,MAAM,CAAC2D,cAAc,CAAC,MAAM,CAAC,EAClC;SACC4G,QAAQ,CAAC,CAAC;WACTZ,MAAM,EAAE,OAAO;WACfC,SAAS,EAAE;UACX,CAAC,CAAC;;OAGJgG,eAAe,CAACC,cAAc,CAACnC,mBAAmB,CAACE,OAAO,EAAE,CAAC5N,MAAM,EAAEyL,EAAE,CAACiF,SAAS,CAAC,CAAC;OACnFnG,QAAQ,CAAC,EAAE,CAAC;;;KACZ;KAAA,mCAEkBvK,MAAU,EAAEuK,QAAkB,EACjD;OACC,IAAI,CAAC,IAAI,CAACM,YAAY,EAAE,EACxB;SACCN,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAC5C;;OAGD8E,eAAe,CAACC,cAAc,CAACnC,mBAAmB,CAACb,UAAU,EAAE,CAAC7M,MAAM,EAAEyL,EAAE,CAACiF,SAAS,CAAC,CAAC;OACtFnG,QAAQ,CAAC,EAAE,CAAC;;;KACZ;KAAA,kCAEiBvK,MAAU,EAAEuK,QAAkB,EAChD;OACC,IAAI,CAAC,IAAI,CAACM,YAAY,EAAE,EACxB;SACCN,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAC5C;;OAGD8E,eAAe,CAACC,cAAc,CAACnC,mBAAmB,CAACxC,SAAS,EAAE,CAAClL,MAAM,EAAEyL,EAAE,CAACiF,SAAS,CAAC,CAAC;OACrFnG,QAAQ,CAAC,EAAE,CAAC;;;KACZ;KAAA,8BAEavK,MAAU,EAAEuK,QAAkB,EAC5C;OACC,IAAI,CAAC,IAAI,CAACM,YAAY,EAAE,EACxB;SACCN,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAC5C;;OAGD,IAAI,CAACZ,QAAQ,GAAG,IAAI;OACpB0F,eAAe,CAACC,cAAc,CAACnC,mBAAmB,CAACvG,KAAK,EAAE,CAACnH,MAAM,EAAEyL,EAAE,CAACiF,SAAS,CAAC,CAAC;OACjFnG,QAAQ,CAAC,EAAE,CAAC;;;KACZ;KAAA,qCAEoBvK,MAAuB,EAAEuK,QAAkB,EAChE;OACC,IAAI,CAAC,IAAI,CAACM,YAAY,EAAE,EACxB;SACCN,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAC5C;;OAED,IAAI,CAAC9K,MAAM,CAAC2D,cAAc,CAAC,OAAO,CAAC,EACnC;SACC4G,QAAQ,CAAC,CAAC;WACTZ,MAAM,EAAE,OAAO;WACfC,SAAS,EAAE;UACX,CAAC,CAAC;SAEH;;OAGDgG,eAAe,CAACC,cAAc,CAACnC,mBAAmB,CAACI,YAAY,EAAE,CAAC9N,MAAM,EAAEyL,EAAE,CAACiF,SAAS,CAAC,CAAC;OACxFnG,QAAQ,CAAC,EAAE,CAAC;;;KACZ;KAAA,sCAEqBvK,MAA4B,EAAEuK,QAAkB,EACtE;OACC,IAAI,CAAC,IAAI,CAACM,YAAY,EAAE,EACxB;SACCN,QAAQ,CAAC,CAAC,IAAI,CAACO,yBAAyB,EAAE,CAAC,CAAC;SAC5C;;OAED,IAAI,CAAC9K,MAAM,CAAC2D,cAAc,CAAC,YAAY,CAAC,EACxC;SACC4G,QAAQ,CAAC,CAAC;WACTZ,MAAM,EAAE,OAAO;WACfC,SAAS,EAAE;UACX,CAAC,CAAC;SAEH;;OAGDgG,eAAe,CAACC,cAAc,CAACnC,mBAAmB,CAACV,aAAa,EAAE,CAAChN,MAAM,EAAEyL,EAAE,CAACiF,SAAS,CAAC,CAAC;OACzFnG,QAAQ,CAAC,EAAE,CAAC;MACZ;;KACD;KAAA,wDAGA;OAAA;OACC,IAAI,CAAC,IAAI,CAACkG,qBAAqB,EAAE,EACjC;SACC;;OACA,kCAED;SACC,MAAI,CAACJ,cAAc,CAACtC,yBAAyB,CAACmC,KAAK,CAAC,EAAE,UAAClQ,MAAM,EAAEuK,QAAQ,EACvE;WACCkB,EAAE,CAACO,aAAa,CAAC8D,MAAM,EAAE,sBAAsB,GAAGI,KAAK,EAAE,CAAClQ,MAAM,EAAEuK,QAAQ,CAAC,CAAC;UAC5E,CAAC;QACF;OAND,KAAK,IAAM2F,KAAK,IAAI,IAAI,CAACC,SAAS,EAAE;SAAA;;OAQpC,IAAI,CAACE,cAAc,CAAC,4BAA4B,EAAE,UAACrQ,MAAM,EAAEuK,QAAQ,EACnE;SACC,IAAI,CAAC,MAAI,CAACL,QAAQ,EAClB;WACC,MAAI,CAACA,QAAQ,GAAG,IAAI;;SAErBuB,EAAE,CAACO,aAAa,CAAC8D,MAAM,EAAE,iCAAiC,EAAE,CAAC9P,MAAM,EAAEuK,QAAQ,CAAC,CAAC;QAC/E,CAAC;OAEF,IAAI,CAAC8F,cAAc,CAAC,iCAAiC,EAAE,UAACrQ,MAAM,EAAEuK,QAAQ,EACxE;SACC,MAAI,CAACL,QAAQ,GAAG,IAAI;SACpBuB,EAAE,CAACO,aAAa,CAAC8D,MAAM,EAAE,sCAAsC,EAAE,CAAC9P,MAAM,EAAEuK,QAAQ,CAAC,CAAC;QACpF,CAAC;;;KACF;KAAA,+BACcoG,SAAiB,EAAEC,YAAsB,EACxD;OACC,IAAMC,WAAW,GAAG,SAAdA,WAAW,CAAapL,CAAC,EAC/B;SACC,IAAMqL,aAAa,GAAG,EAAE;SACxB,KAAK,IAAMC,CAAC,IAAItL,CAAC,CAACuL,MAAM,EACxB;WACCF,aAAa,CAAChK,IAAI,CAACrB,CAAC,CAACuL,MAAM,CAACD,CAAC,CAAC,CAAC;;SAGhCH,YAAY,CAACK,KAAK,CAACnB,MAAM,EAAEgB,aAAa,CAAC;QACzC;OAED,IAAI,CAAC,IAAI,CAAC7C,aAAa,CAAC0C,SAAS,CAAC,EAClC;SACC,IAAI,CAAC1C,aAAa,CAAC0C,SAAS,CAAC,GAAG,EAAE;;OAGnC,IAAI,CAAC1C,aAAa,CAAC0C,SAAS,CAAC,CAAC7J,IAAI,CAAC+J,WAAW,CAAC;OAC/Cf,MAAM,CAACoB,gBAAgB,CAACP,SAAS,EAAEE,WAAW,CAAC;OAE/C,OAAO,IAAI;;;KACX;KAAA,mCAEkBF,SAAS,EAC5B;OACC,IAAI,CAAC,IAAI,CAAC1C,aAAa,CAAC0C,SAAS,CAAC,EAClC;SACC,OAAO,KAAK;;OAGb,IAAI,CAAC1C,aAAa,CAAC0C,SAAS,CAAC,CAAC/J,OAAO,CAAC,UAAAgK,YAAY;SAAA,OAAId,MAAM,CAACqB,mBAAmB,CAACR,SAAS,EAAEC,YAAY,CAAC;SAAC;OAC1G,IAAI,CAAC3C,aAAa,CAAC0C,SAAS,CAAC,GAAG,EAAE;;;KAClC;KAAA,iCAGD;OACC,OAAOS,eAAe,CAACC,WAAW,EAAE,KAAKzB,eAAe,CAAC0B,aAAa,EAAE,CAACD,WAAW,EAAE;;;KACtF;KAAA,wCAGD;OACC,OAAO,OAAOzB,eAAgB,IAAI,WAAW,IAAI,OAAOwB,eAAgB,IAAI,WAAW;;;KACvF;KAAA,oCAGD;OACC,OAAOG,SAAS,CAACC,IAAI,CAAC,UAAAC,OAAO;SAAA,OAAIA,OAAO,CAACzH,IAAI,KAAK,YAAY;SAAC;;;KAC/D;KAAA,4CAGD;OACC,IAAM0H,UAAU,GAAG,IAAI,CAACC,iBAAiB,EAAE;OAE3C,OAAOD,UAAU,CAACE,GAAG,CAACC,gBAAgB,CAACC,cAAc;;;GACrD;CAAA,EA5XiCjI,UAAU;;KC9BhCkI,aAAa;GAAA;GAAA;KAAA;KAAA;;GAAA;KAAA;KAAA,sCAIzB;OACC,IAAMhI,SAAS,GAAG0B,EAAE,CAACyC,IAAI,CAACC,SAAS,CAACC,mBAAmB,CAAC,wBAAwB,CAAC;OAEjF,IAAI,CAAC4D,mBAAmB,CAACjI,SAAS,CAAC;OACnC,IAAI,CAACuE,yBAAyB,CAACvE,SAAS,CAAC;;;KACzC;KAAA,oCAEmBA,SAAS,EAC7B;OAAA;OACCA,SAAS,CAACO,SAAS,CAACqE,eAAe,GAAG,UAAC3O,MAAM,EAAEuK,QAAQ;SAAA,OAAK,KAAI,CAACoD,OAAO,CAAC3N,MAAM,EAAEuK,QAAQ,CAAC;;OAC1FR,SAAS,CAACO,SAAS,CAACuE,eAAe,GAAG,UAAC7O,MAAM,EAAEuK,QAAQ;SAAA,OAAK,KAAI,CAACqD,OAAO,CAAC5N,MAAM,EAAEuK,QAAQ,CAAC;;OAC1FR,SAAS,CAACO,SAAS,CAACyE,kBAAkB,GAAG,UAAC/O,MAAM,EAAEuK,QAAQ;SAAA,OAAK,KAAI,CAACS,UAAU,CAAChL,MAAM,EAAEuK,QAAQ,CAAC;;OAChGR,SAAS,CAACO,SAAS,CAACmE,uBAAuB,GAAG,UAACzO,MAAM,EAAEuK,QAAQ;SAAA,OAAK,KAAI,CAACmE,eAAe,CAAC1O,MAAM,EAAEuK,QAAQ,CAAC;;OAC1GR,SAAS,CAACO,SAAS,CAAC2E,oBAAoB,GAAG,UAACjP,MAAM,EAAEuK,QAAQ;SAAA,OAAK,KAAI,CAACuD,YAAY,CAAC9N,MAAM,EAAEuK,QAAQ,CAAC;;OACpGR,SAAS,CAACO,SAAS,CAAC6E,qBAAqB,GAAG,UAACnP,MAAM,EAAEuK,QAAQ;SAAA,OAAK,KAAI,CAACyC,aAAa,CAAChN,MAAM,EAAEuK,QAAQ,CAAC;;OACtGR,SAAS,CAACO,SAAS,CAAC+E,aAAa,GAAG,UAACrP,MAAM,EAAEuK,QAAQ;SAAA,OAAK,KAAI,CAACpD,KAAK,CAACnH,MAAM,EAAEuK,QAAQ,CAAC;;OACtFR,SAAS,CAACO,SAAS,CAACiF,kBAAkB,GAAG,UAACvP,MAAM,EAAEuK,QAAQ;SAAA,OAAK,KAAI,CAACsC,UAAU,CAAC7M,MAAM,EAAEuK,QAAQ,CAAC;;OAChGR,SAAS,CAACO,SAAS,CAACmF,iBAAiB,GAAG,UAACzP,MAAM,EAAEuK,QAAQ;SAAA,OAAK,KAAI,CAACW,SAAS,CAAClL,MAAM,EAAEuK,QAAQ,CAAC;;;;KAC9F;KAAA,0BACSP,IAAY,EAAEhK,MAAM,EAC9B;OACC,IAAI,CAAC,IAAI,CAACmK,cAAc,EACxB;SACC;;OAGDsB,EAAE,CAACO,aAAa,CAAC8D,MAAM,EAAE,sBAAsB,GAAG9F,IAAI,EAAE,CAAChK,MAAM,CAAC,CAAC;;;KACjE;KAAA,oCAEmBA,MAAM,EAC1B;OACC,IAAI,CAAC,IAAI,CAACmK,cAAc,EACxB;SACC;;OAGDsB,EAAE,CAACO,aAAa,CAAC8D,MAAM,EAAE,iCAAiC,EAAE,CAAC9P,MAAM,CAAC,CAAC;;;GACrE;CAAA,EAzCiC6J,UAAU;;CCEtC,IAAMoI,sBAAsB,GAAGxJ,cAAc;AAEpD,KAAayJ,gBAAgB;GAI5B,4BACA;KAAA;KACC,IAAI,CAAC9D,mBAAmB,EAAE;;GAC1B;KAAA;KAAA,4BAEWnE,QAAwB,EACpC;OACC,IAAI,CAAC6H,cAAc,CAAC5H,QAAQ,GAAGD,QAAQ;;;KACvC;KAAA,sCAGD;OACC,IAAI,IAAI,CAAC4B,SAAS,EAAE,EACpB;SACC,IAAI,CAACiG,cAAc,GAAG,IAAI9D,aAAa,EAAE;QACzC,MAED;SACC,IAAI,CAAC8D,cAAc,GAAG,IAAIC,aAAa,EAAE;;OAG1C,IAAI,CAACD,cAAc,CAAC1D,mBAAmB,EAAE;;;KACzC;KAAA,0BAESpE,IAAY,EAAEhK,MAAM,EAC9B;OACC,IAAI,CAAC8R,cAAc,CAACK,SAAS,CAACnI,IAAI,EAAEhK,MAAM,CAAC;;;KAC3C;KAAA,6CAGD;OACC,IAAI,CAAC8R,cAAc,CAACM,0BAA0B,EAAE;;;KAChD;KAAA,4BAED;OACC,OAAO,OAAQxC,eAAgB,KAAK,WAAW;;;KAC/C;KAAA,yBAGD;OACC,OAAO,IAAI,CAACkC,cAAc,CAACO,MAAM,EAAE;;;KACnC;KAAA,0CAGD;OACC,OAAO,IAAI,CAAClI,cAAc,IAAI,IAAI,CAACkI,MAAM,EAAE;;;KAC3C;KAAA,gCAEelI,cAAuB,EACvC;OACC,IAAI,CAAC2H,cAAc,CAACQ,iBAAiB,CAACnI,cAAc,CAAC;;;GACrD;CAAA;;CC5DF,IAAMtK,KAAG,GAAG,SAANA,GAAG,GAAa,EAAE;AAExB,KAAa0S,WAAW;GAEvB,qBAAYvS,MAAM,EAClB;KAAA;KACC,IAAI,CAACwS,IAAI,GAAGxS,MAAM,CAACwS,IAAI;KACvB,IAAI,CAACC,WAAW,GAAG,IAAI;KACvB,IAAI,CAACxR,SAAS,GAAG;OAChByR,UAAU,EAAEzS,cAAI,CAACkB,UAAU,CAACnB,MAAM,CAAC0S,UAAU,CAAC,GAAG1S,MAAM,CAAC0S,UAAU,GAAG7S,KAAG;OACxE8S,YAAY,EAAE1S,cAAI,CAACkB,UAAU,CAACnB,MAAM,CAAC2S,YAAY,CAAC,GAAG3S,MAAM,CAAC2S,YAAY,GAAG9S,KAAG;OAC9E+S,UAAU,EAAE3S,cAAI,CAACkB,UAAU,CAACnB,MAAM,CAAC4S,UAAU,CAAC,GAAG5S,MAAM,CAAC4S,UAAU,GAAG/S;MACrE;;;;CAIH;CACA;CACA;CACA;GAJC;KAAA;KAAA,qBAKKG,MAAM,EACX;OACC,IAAI6S,QAAQ,GAAG,IAAI,CAACC,WAAW,CAAC9S,MAAM,CAAC;OACvC8P,MAAM,CAACiD,kBAAkB,CAACC,IAAI,CAACH,QAAQ,CAAC;OACxC,IAAI,CAACJ,WAAW,GAAGI,QAAQ;;;KAC3B;KAAA,yBAGD;OACC,IAAI,IAAI,CAACJ,WAAW,EACpB;SACC3C,MAAM,CAACiD,kBAAkB,CAACE,MAAM,CAAC,IAAI,CAACR,WAAW,CAAC;SAClD,IAAI,CAACA,WAAW,GAAG,IAAI;;;;KAExB;;CAGF;CACA;CACA;CACA;CACA;KALC,4BAMYzS,MAAM,EAClB;OACC,OAAO;SACNkC,EAAE,EAAElC,MAAM,CAACkC,EAAE;SACbgR,GAAG,EAAElT,MAAM,CAACmT,OAAO;SACnB9O,IAAI,EAAE,QAAQ;SACd+O,IAAI,EAAE,IAAI;SACVC,GAAG,EAAEvD,MAAM,CAACwD,QAAQ,CAACC,IAAI;SACzBf,IAAI,EAAE,IAAI,CAACA,IAAI;SACfgB,QAAQ,EACP;WACC,MAAM,EAAE,IAAI,CAACC,WAAW,CAACxQ,IAAI,CAAC,IAAI,CAAC;WACnC,QAAQ,EAAE,IAAI,CAACyQ,aAAa,CAACzQ,IAAI,CAAC,IAAI,CAAC;WACvC,MAAM,EAAE,IAAI,CAAC2P,UAAU,CAAC3P,IAAI,CAAC,IAAI;UACjC;SACF0Q,OAAO,EACN;WACC,SAAS,EAAE,KAAK;WAChB,MAAM,EAAE;;QAEV;;;KACD;KAAA,4BAEWC,IAAI,EAChB;OACC,IAAI,CAAC3S,SAAS,CAACyR,UAAU,CAACkB,IAAI,CAAC;;;KAC/B;KAAA,8BAEaA,IAAI,EAClB;OACC,IAAI,CAAC3S,SAAS,CAAC0R,YAAY,CAACiB,IAAI,CAAC;;;KACjC;KAAA,2BAEUA,IAAI,EACf;OACC,IAAI,CAAC3S,SAAS,CAAC2R,UAAU,CAACgB,IAAI,CAAC;;;GAC/B;CAAA;;;;;AChFF,KAIaC,QAAQ;GAEpB,kBAAY7T,MAAM,EAClB;KAAA;KACC,IAAI,CAACwS,IAAI,GAAGxS,MAAM,CAACwS,IAAI;KACvB,IAAI,CAACtQ,EAAE,GAAGlC,MAAM,CAACkC,EAAE;KACnB,IAAI,CAAC2J,SAAS,GAAG7L,MAAM,CAAC6L,SAAS;KAEjC,IAAI,CAACiI,UAAU,GAAG,EAAE;KACpB,IAAI,CAACC,QAAQ,GAAG,IAAIC,GAAG,EAAE,CAAC;KAC1B,IAAI,CAACzS,QAAQ,GAAG,EAAE;KAClB,IAAI,CAAC0S,eAAe,GAAGjU,MAAM,CAACkU,gBAAgB,IAAI,SAAS;KAC3D,IAAI,CAACC,gBAAgB,GAAGnU,MAAM,CAACoU,SAAS,IAAI,CAAC;KAC7C,IAAI,CAACC,eAAe,GAAG,IAAI;KAC3B,IAAI,CAACC,gBAAgB,GAAG,IAAI;KAC5B,IAAI,CAACC,eAAe,GAAG,KAAK;;;KAG5B,IAAI,CAACtT,SAAS,GAAG;OAChBuT,OAAO,EAAEvU,cAAI,CAACkB,UAAU,CAACnB,MAAM,CAACwU,OAAO,CAAC,GAAGxU,MAAM,CAACwU,OAAO,GAAG3U,GAAG;OAC/D4U,cAAc,EAAExU,cAAI,CAACkB,UAAU,CAACnB,MAAM,CAACyU,cAAc,CAAC,GAAGzU,MAAM,CAACyU,cAAc,GAAG5U;MACjF;KAED,IAAI,CAAC6U,SAAS,GAAG,EAAE;KACnB,IAAI,CAACC,SAAS,GAAG,EAAE;;GACnB;KAAA;KAAA,qBAEIC,IAAI,EACT;OAAA;OACC,IAAI,CAAC3U,cAAI,CAACkB,UAAU,CAACyT,IAAI,CAAC,EAC1B;SACCA,IAAI,GAAG/U,GAAG;;OAGX,IAAI,CAACmT,IAAI,CAAC,YACV;SACC,IAAM6B,aAAa,GAAG,KAAI,CAACd,QAAQ,CAACe,GAAG,CAAC,KAAI,CAACb,eAAe,CAAC;SAC7D,IAAIY,aAAa,IAAIA,aAAa,CAACE,KAAK,CAACxR,MAAM,GAAG,CAAC,EACnD;WACC,KAAI,CAACyR,MAAM,EAAE;WACb,KAAI,CAACC,UAAU,CAAC,KAAI,CAAChB,eAAe,EAAE,KAAI,CAACE,gBAAgB,CAAC;WAC5DS,IAAI,EAAE;UACN,MAED;WACCnJ,EAAE,CAACyJ,KAAK,CAAC,yCAAyC,CAAC;;QAEpD,CAAC;;;KACF;;CAGF;CACA;CACA;KAHC,uBAIOlV,MAAM,EACb;OACC,IAAIC,cAAI,CAACkV,SAAS,CAACnV,MAAM,CAACwS,IAAI,CAAC,EAC/B;SACC,IAAI,CAACA,IAAI,GAAGxS,MAAM,CAACwS,IAAI;;OAGxB,IAAI,CAACwC,MAAM,EAAE;OACb,IAAI,CAACC,UAAU,CAAC,IAAI,CAAChB,eAAe,EAAE,IAAI,CAACE,gBAAgB,CAAC;OAC5D,IAAI,IAAI,CAACE,eAAe,KAAK,IAAI,IAAI,IAAI,CAACC,gBAAgB,KAAK,IAAI,EACnE;SACC,IAAI,CAACc,iBAAiB,CAAC,IAAI,CAACf,eAAe,EAAE,IAAI,CAACC,gBAAgB,CAAC;;;;KAGpE;KAAA,qBAEIM,IAAI,EACT;OAAA;OACC,IAAM5U,MAAM,GAAG;SACd,QAAQ,EAAEyL,EAAE,CAAC4J,aAAa,EAAE;SAC5B,aAAa,EAAE,eAAe;SAC9B,YAAY,EAAE,IAAI,CAACnT;QACnB;OAEDuJ,EAAE,CAAC6J,IAAI,CAAC;SACPC,GAAG,EAAE1B,QAAQ,CAAC2B,UAAU,EAAE;SAC1BC,MAAM,EAAE,MAAM;SACdC,QAAQ,EAAE,MAAM;SAChBC,IAAI,EAAE3V,MAAM;SACZ4V,SAAS,EAAE,mBAACD,IAAI,EAChB;WACC,IAAI,CAACA,IAAI,CAACE,KAAK,EACf;aACC,IAAI5V,cAAI,CAAC0G,OAAO,CAACgP,IAAI,CAACG,QAAQ,CAAC,EAC/B;;eAECH,IAAI,CAACG,QAAQ,CAAClP,OAAO,CAAC,UAACmP,YAAY,EACnC;iBACCA,YAAY,CAAChB,KAAK,GAAG,EAAE;iBACvB,MAAI,CAAChB,QAAQ,CAACiC,GAAG,CAACD,YAAY,CAACE,SAAS,EAAEF,YAAY,CAAC;gBACvD,CAAC;eAEFJ,IAAI,CAACZ,KAAK,CAACnO,OAAO,CAAC,UAACsP,IAAI,EACxB;iBACC,IAAIC,UAAU,GAAG,MAAI,CAACpC,QAAQ,CAACe,GAAG,CAACoB,IAAI,CAACD,SAAS,CAAC;iBAClD,IAAIE,UAAU,EACd;mBACCA,UAAU,CAACpB,KAAK,CAACjO,IAAI,CAACoP,IAAI,CAAC;;gBAE5B,CAAC;;aAEH,MAAI,CAACpC,UAAU,GAAG6B,IAAI,CAACS,WAAW;aAClC,IAAIvB,aAAa,GAAG,MAAI,CAACd,QAAQ,CAACe,GAAG,CAAC,MAAI,CAACb,eAAe,CAAC;aAC3D,IAAIY,aAAa,IAAIA,aAAa,CAACE,KAAK,CAACxR,MAAM,KAAK,CAAC,EACrD;eACC,MAAI,CAAC0Q,eAAe,GAAG,MAAI,CAACoC,mBAAmB,EAAE;eACjD,MAAI,CAAClC,gBAAgB,GAAG,CAAC;;aAE1BS,IAAI,EAAE;YACN,MAED;aACC0B,OAAO,CAACC,GAAG,CAACZ,IAAI,CAAC;;;QAGnB,CAAC;;;KACF;KAAA,2BAEUa,QAAQ,EAAEC,QAAQ,EAC7B;OACC,IAAIC,WAAW,GAAG,IAAI,CAAC3C,QAAQ,CAACe,GAAG,CAAC,IAAI,CAACb,eAAe,CAAC,CAACc,KAAK,CAAC,IAAI,CAACZ,gBAAgB,CAAC,CAACwC,KAAK;OAC5FlL,EAAE,CAACU,WAAW,CAACuK,WAAW,EAAE,0CAA0C,CAAC;OAEvE,IAAI,IAAI,CAACE,cAAc,EACvB;SACC,IAAI,CAACA,cAAc,CAACzP,KAAK,EAAE;;OAG5B,IAAI,CAAC8M,eAAe,GAAGuC,QAAQ;OAC/B,IAAI,CAACrC,gBAAgB,GAAGsC,QAAQ;OAEhCC,WAAW,GAAG,IAAI,CAAC3C,QAAQ,CAACe,GAAG,CAAC,IAAI,CAACb,eAAe,CAAC,CAACc,KAAK,CAAC,IAAI,CAACZ,gBAAgB,CAAC,CAACwC,KAAK;OACxFlL,EAAE,CAACC,QAAQ,CAACgL,WAAW,EAAE,0CAA0C,CAAC;OAEpE,IAAMG,SAAS,GAAG,IAAI,CAAC9C,QAAQ,CAACe,GAAG,CAAC0B,QAAQ,CAAC,CAACzB,KAAK,CAAC0B,QAAQ,CAAC;OAE7D,IAAI,CAAC,IAAI,CAAC3C,UAAU,IAAI,MAAM,IAAI,IAAI,CAACA,UAAU,IAAI,OAAO,IAAI,IAAI,CAACA,UAAU,IAAI,SAAS,KAAK+C,SAAS,CAACC,iBAAiB,EAC5H;SACC,IAAI,CAAC7V,SAAS,CAACwT,cAAc,CAAC;WAC7BpQ,IAAI,EAAEwS,SAAS,CAACC,iBAAiB,CAACC,IAAI;WACtC7U,EAAE,EAAE2U,SAAS,CAACC,iBAAiB,CAACE,EAAE;WAClCC,QAAQ,EAAE,CACT;aACC5S,IAAI,EAAE,IAAI,CAACyP,UAAU;aACrB5R,EAAE,EAAE2U,SAAS,CAACK;YACd,CACD;WACDC,MAAM,EAAEN,SAAS,CAACC,iBAAiB,CAACM,MAAM;WAC1CZ,QAAQ,EAAEA,QAAQ;WAClB3P,KAAK,EAAE4P;UACP,CAAC;QACF,MAED;SACC,IAAI,CAACxV,SAAS,CAACwT,cAAc,CAAC;WAC7BpQ,IAAI,EAAE,IAAI,CAACyP,UAAU;WACrB5R,EAAE,EAAE2U,SAAS,CAACK,UAAU;WACxBC,MAAM,EAAEN,SAAS,CAACO,MAAM;WACxBZ,QAAQ,EAAEA,QAAQ;WAClB3P,KAAK,EAAE4P;UACP,CAAC;;;;KAEH;KAAA,iCAGD;OACC,IAAIA,QAAQ,GAAG,IAAI,CAACtC,gBAAgB,GAAG,CAAC;OACxC,IAAIsC,QAAQ,IAAI,IAAI,CAAC1C,QAAQ,CAACe,GAAG,CAAC,IAAI,CAACb,eAAe,CAAC,CAACc,KAAK,CAACxR,MAAM,EACpE;SACCkT,QAAQ,GAAG,CAAC;;OAGb,IAAI,CAACxB,UAAU,CAAC,IAAI,CAAChB,eAAe,EAAEwC,QAAQ,CAAC;;;KAC/C;KAAA,kCAEiBD,QAAQ,EAAE3P,KAAK,EACjC;OACC,IAAI,CAACwN,eAAe,GAAGmC,QAAQ;OAC/B,IAAI,CAAClC,gBAAgB,GAAGzN,KAAK;OAC7B,IAAM6P,WAAW,GAAG,IAAI,CAAC3C,QAAQ,CAACe,GAAG,CAAC,IAAI,CAACT,eAAe,CAAC,CAACU,KAAK,CAAC,IAAI,CAACT,gBAAgB,CAAC,CAACqC,KAAK;OAC9FlL,EAAE,CAACC,QAAQ,CAACgL,WAAW,EAAE,2CAA2C,CAAC;OACrE,IAAI,CAACnC,eAAe,GAAG,IAAI;;;KAC3B;KAAA,sCAGD;OACC,IAAI,IAAI,CAACF,eAAe,KAAK,IAAI,IAAI,IAAI,CAACC,gBAAgB,KAAK,IAAI,EACnE;SACC;;OAGD,IAAMoC,WAAW,GAAG,IAAI,CAAC3C,QAAQ,CAACe,GAAG,CAAC,IAAI,CAACT,eAAe,CAAC,CAACU,KAAK,CAAC,IAAI,CAACT,gBAAgB,CAAC,CAACqC,KAAK;OAC9FlL,EAAE,CAACU,WAAW,CAACuK,WAAW,EAAE,2CAA2C,CAAC;OACxE,IAAI,CAACrC,eAAe,GAAG,IAAI;OAC3B,IAAI,CAACC,gBAAgB,GAAG,IAAI;OAC5B,IAAI,CAACC,eAAe,GAAG,KAAK;;;KAC5B;KAAA,yBAGD;OACC1Q,aAAG,CAACwT,KAAK,CAAC,IAAI,CAAC7E,IAAI,CAAC;OACpB,IAAI,CAACA,IAAI,CAAC8E,MAAM,CAAC,IAAI,CAAC5U,MAAM,EAAE,CAAC;;;KAC/B;KAAA,yBAGD;OACC,OAAOmB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACxBC,KAAK,EAAE;WAACC,SAAS,EAAE;UAA+B;SAClDC,QAAQ,EAAE,IAAI,CAACsT,kBAAkB;QACjC,CAAC;;;KACF;KAAA,qCAGD;OACC,IAAI5N,MAAM,GAAG,EAAE;OAAC,2CAEe,IAAI,CAACoK,QAAQ;SAAA;OAAA;SAA5C,oDACA;WAAA;aADUyC,QAAQ;aAAEgB,MAAM;WAEzB,IAAI,CAACA,MAAM,IAAIA,MAAM,CAACzC,KAAK,CAACxR,MAAM,KAAK,CAAC,EACxC;aACC;;WAGDiU,MAAM,CAACb,KAAK,GAAG,IAAI,CAACc,iBAAiB,CAACD,MAAM,CAAC;WAC7C7N,MAAM,CAAC7C,IAAI,CAAC0Q,MAAM,CAACb,KAAK,CAAC;;;SACzB;;SAAA;;OACD,OAAOhN,MAAM;;;KACb;KAAA,oCAEmB6M,QAAQ,EAC5B;OACC,IAAI7M,MAAM,GAAG,EAAE;OACf,IAAM6N,MAAM,GAAG,IAAI,CAACzD,QAAQ,CAACe,GAAG,CAAC0B,QAAQ,CAAC;OAE1C,IAAIgB,MAAM,CAACE,WAAW,GAAG,CAAC,EAC1B;SACC,IAAIF,MAAM,CAACE,WAAW,GAAGF,MAAM,CAACzC,KAAK,CAACxR,MAAM,EAC5C;WACCiU,MAAM,CAACE,WAAW,GAAGF,MAAM,CAACzC,KAAK,CAACxR,MAAM;;QAEzC,MAED;SACCiU,MAAM,CAACE,WAAW,GAAGC,IAAI,CAACC,GAAG,CAAC,IAAI,CAAClD,SAAS,EAAE8C,MAAM,CAACzC,KAAK,CAACxR,MAAM,CAAC;;OAGnE,KAAK,IAAIwN,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGyG,MAAM,CAACE,WAAW,EAAE3G,CAAC,EAAE,EAC3C;SACCpH,MAAM,CAAC7C,IAAI,CAAC,IAAI,CAAC+Q,kBAAkB,CAACL,MAAM,CAACzC,KAAK,CAAChE,CAAC,CAAC,EAAEyF,QAAQ,EAAEzF,CAAC,CAAC,CAAC;;OAGnE,IAAIyG,MAAM,CAACzC,KAAK,CAACxR,MAAM,GAAGiU,MAAM,CAACE,WAAW,EAC5C;SACCF,MAAM,CAACM,aAAa,GAAGjU,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACxCC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAoC;WAAEC,QAAQ,EAAE,CAClEJ,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;aAClBC,KAAK,EAAE;eAACC,SAAS,EAAE;cAAsC;aACzD+D,OAAO,EAAE;eAACyO,QAAQ,EAAEA;cAAS;aAC7BpR,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC,CAACsT,OAAO,CAAC,SAAS,EAAGP,MAAM,CAACzC,KAAK,CAACxR,MAAM,GAAGiU,MAAM,CAACE,WAAW,CAAE;aAC9G3U,MAAM,EAAE;eAACmB,KAAK,EAAE,IAAI,CAAC8T,eAAe,CAAC/U,IAAI,CAAC,IAAI;;YAC9C,CAAC;UAEH,CAAC;SACF0G,MAAM,CAAC7C,IAAI,CAAC0Q,MAAM,CAACM,aAAa,CAAC;QACjC,MAED;SACCN,MAAM,CAACM,aAAa,GAAG,IAAI;;OAG5B,OAAOnO,MAAM;;;KACb;KAAA,mCAEkBsO,cAAc,EAAEzB,QAAQ,EAAEpC,SAAS,EACtD;OAAA;OACC,IAAM8D,UAAU,GAAG,IAAI,CAACnE,QAAQ,CAACe,GAAG,CAAC0B,QAAQ,CAAC,CAAC2B,IAAI;OAEnD,IAAIC,UAAU,GAAG,EAAE;OACnB,IAAInY,cAAI,CAAC0G,OAAO,CAACsR,cAAc,CAACb,MAAM,CAAC,EACvC;SACCa,cAAc,CAACb,MAAM,CAACxQ,OAAO,CAAC,UAACyR,KAAK,EAAExR,KAAK,EAC3C;WACC,IAAIA,KAAK,KAAK,CAAC,EACf;aACCuR,UAAU,IAAI,IAAI;;WAGnBA,UAAU,IAAIrR,cAAI,CAACC,MAAM,CAACqR,KAAK,CAACC,KAAK,CAAC;UACtC,CAAC;;OAGHL,cAAc,CAACtB,KAAK,GAAG9S,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACxCC,KAAK,EAAE;WAACC,SAAS,EAAG,IAAI,CAACiQ,eAAe,IAAIuC,QAAQ,IAAI,IAAI,CAACrC,gBAAgB,IAAIC,SAAS,GAAG,4EAA4E,GAAG;UAAqC;SACjNnQ,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAACC,SAAS,EAAE;YAA2C;WAC9DC,QAAQ,EAAE,CAACJ,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;aAACsB,IAAI,EAAE8S;YAAW,CAAC,CAAC;WAClDnV,MAAM,EAAE;aACPmB,KAAK,EAAE,eAACuB,CAAC,EACT;eACCA,CAAC,CAACQ,cAAc,EAAE;eAClB,IAAI,MAAI,CAAC2Q,cAAc,EACvB;iBACC,MAAI,CAACA,cAAc,CAACzP,KAAK,EAAE;gBAC3B,MAED;iBACC,MAAI,CAACoR,YAAY,CAACN,cAAc,EAAExS,CAAC,CAAC+S,MAAM,CAAC;;;;UAI9C,CAAC,EACF3U,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAACC,SAAS,EAAE,uCAAuC,IAAIiU,cAAc,CAACnB,iBAAiB,GAAG,qCAAqC,GAAG,EAAE;YAAE;WAC7I7S,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,GAAG,EAAE;aACfM,KAAK,EAAE;eAACmP,IAAI,EAAE0E,cAAc,CAACQ,QAAQ;eAAED,MAAM,EAAE;cAAS;aACxDzU,KAAK,EAAE;eAACC,SAAS,EAAE;cAAwC;aAC3DoB,IAAI,EAAE6S,cAAc,CAACE,IAAI;aACzBpV,MAAM,EAAE;eACPmB,KAAK,EAAE,eAACuB,CAAC,EACT;iBACCA,CAAC,CAACQ,cAAc,EAAE;iBAClB6J,MAAM,CAAC4I,IAAI,CAACT,cAAc,CAACQ,QAAQ,CAAC;;;YAGtC,CAAC;UAEH,CAAC,EAEDR,cAAc,CAACU,IAAI,GAAG9U,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACxCC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAwC;WAC3DoB,IAAI,EAAE6S,cAAc,CAACU;UACrB,CAAC,GAAG,IAAI,EACRV,cAAc,CAACW,aAAa,GAAG/U,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjDC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAwC;WAC3DoB,IAAI,EAAE6S,cAAc,CAACW;UACrB,CAAC,GAAG,IAAI,EACRR,UAAU,GAAGvU,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAC/BC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAwC;WAC3DoB,IAAI,EAAEgT;UACN,CAAC,GAAG,IAAI,EACRH,cAAc,CAACnB,iBAAiB,GAAG,IAAI,CAAC+B,sBAAsB,CAACZ,cAAc,CAACnB,iBAAiB,CAAC,GAAG,IAAI,CACxG;SACD/T,MAAM,EAAE;WACPmB,KAAK,EAAE,iBACP;aACC,IAAI,CAAC,MAAI,CAACqQ,eAAe,KAAK,MAAI,CAACN,eAAe,IAAIgE,cAAc,CAAChC,SAAS,IAAI,MAAI,CAAC9B,gBAAgB,IAAIC,SAAS,CAAC,EACrH;eACC,MAAI,CAACa,UAAU,CAACgD,cAAc,CAAChC,SAAS,EAAE7B,SAAS,CAAC;;;;QAIvD,CAAC;OAEF,OAAO6D,cAAc,CAACtB,KAAK;;;KAC3B;KAAA,uCAEsBmC,gBAAgB,EACvC;OACC,IAAIV,UAAU,GAAG,EAAE;OACnB,IAAInY,cAAI,CAAC0G,OAAO,CAACmS,gBAAgB,CAAC1B,MAAM,CAAC,EACzC;SACC0B,gBAAgB,CAAC1B,MAAM,CAACxQ,OAAO,CAAC,UAACyR,KAAK,EAAExR,KAAK,EAC7C;WACC,IAAIA,KAAK,KAAK,CAAC,EACf;aACCuR,UAAU,IAAI,IAAI;;WAGnBA,UAAU,IAAIrR,cAAI,CAACC,MAAM,CAACqR,KAAK,CAACC,KAAK,CAAC;UACtC,CAAC;;OAGH,OAAOzU,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACxBC,KAAK,EAAE;WAACC,SAAS,EAAE;UAAkF;SACrGC,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,GAAG,EAAE;WACfM,KAAK,EAAE;aAACmP,IAAI,EAAEuF,gBAAgB,CAACL,QAAQ;aAAED,MAAM,EAAE;YAAS;WAC1DzU,KAAK,EAAE;aAACC,SAAS,EAAE;YAAwC;WAC3DoB,IAAI,EAAE0T,gBAAgB,CAACX,IAAI;WAC3BpV,MAAM,EAAE;aACPmB,KAAK,EAAE,eAACuB,CAAC,EACT;eACCA,CAAC,CAACQ,cAAc,EAAE;eAClB6J,MAAM,CAAC4I,IAAI,CAACI,gBAAgB,CAACL,QAAQ,CAAC;;;UAGxC,CAAC,EACF5U,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAwC;WAC3DoB,IAAI,EAAE0T,gBAAgB,CAACH;UACvB,CAAC,EACF9U,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAwC;WAC3DoB,IAAI,EAAE0T,gBAAgB,CAACF;UACvB,CAAC,EACDR,UAAU,GAAGvU,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAC/BC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAwC;WAC3DoB,IAAI,EAAEgT;UACN,CAAC,GAAG,IAAI;QAEV,CAAC;;;KACF;KAAA,gCAEe3S,CAAC,EACjB;OACC,IAAI+Q,QAAQ,GAAG/Q,CAAC,CAAC+S,MAAM,CAACzQ,OAAO,CAACyO,QAAQ;OACxC,IAAIgB,MAAM,GAAG,IAAI,CAACzD,QAAQ,CAACe,GAAG,CAAC0B,QAAQ,CAAC;OAExCgB,MAAM,CAACE,WAAW,IAAI,IAAI,CAAC/C,SAAS;OACpC,IAAI6C,MAAM,CAACE,WAAW,GAAGF,MAAM,CAACzC,KAAK,CAACxR,MAAM,EAC5C;SACCiU,MAAM,CAACE,WAAW,GAAGF,MAAM,CAACzC,KAAK,CAACxR,MAAM;;OAGzC,IAAMwV,aAAa,GAAG,IAAI,CAACtB,iBAAiB,CAACD,MAAM,CAAC;OACpDA,MAAM,CAACb,KAAK,CAACqC,UAAU,CAACC,YAAY,CAACF,aAAa,EAAEvB,MAAM,CAACb,KAAK,CAAC;OACjEa,MAAM,CAACb,KAAK,GAAGoC,aAAa;;;KAC5B;KAAA,6BAEYG,YAAY,EAAE1G,IAAI,EAC/B;OAAA;OACC,IAAI9L,SAAS,GAAG,EAAE;OAClB,IAAIyS,QAAQ;OAAC,4CACkB,IAAI,CAACpF,QAAQ;SAAA;OAAA;SAA5C,uDACA;WAAA;aADUyC,QAAQ;aAAEgB,MAAM;WAEzB2B,QAAQ,GAAG;aACVjX,EAAE,EAAE,YAAY,GAAGsU,QAAQ;aAC3BpR,IAAI,EAAEoS,MAAM,CAACW,IAAI;aACjBlR,OAAO,EAAE,IAAI,CAACmS,0BAA0B,CAACF,YAAY,CAAChC,UAAU,EAAEV,QAAQ,CAAC,CAACvT,IAAI,CAAC,IAAI;YACrF;WACDyD,SAAS,CAACI,IAAI,CAACqS,QAAQ,CAAC;;;SACxB;;SAAA;;OACDzS,SAAS,CAACI,IAAI,CAAC;SACd5E,EAAE,EAAE,kCAAkC;SACtCmX,SAAS,EAAE;QAEX,CAAC;OACF3S,SAAS,CAACI,IAAI,CAAC;SACd5E,EAAE,EAAE,YAAY;SAChBkD,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;SACjEwC,OAAO,EAAE,mBACT;WACC,MAAI,CAAC2P,cAAc,CAACzP,KAAK,EAAE;WAC3B,MAAI,CAACmS,cAAc,CAACJ,YAAY,CAAChC,UAAU,EAAEgC,YAAY,CAACK,IAAI,GAAG,EAAE,CAAC;;QAErE,CAAC;OACF7S,SAAS,CAACI,IAAI,CAAC;SACd5E,EAAE,EAAE,YAAY;SAChBkD,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;SAC/DwC,OAAO,EAAE,mBACT;WACC,MAAI,CAAC2P,cAAc,CAACzP,KAAK,EAAE;WAC3B,MAAI,CAACmS,cAAc,CAACJ,YAAY,CAAChC,UAAU,EAAEgC,YAAY,CAACK,IAAI,GAAG,GAAG,CAAC;;QAEtE,CAAC;OACF7S,SAAS,CAACI,IAAI,CAAC;SACd5E,EAAE,EAAE,WAAW;SACfkD,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;SAC3DwC,OAAO,EAAE,mBACT;WACC,MAAI,CAAC2P,cAAc,CAACzP,KAAK,EAAE;WAC3B,MAAI,CAACmS,cAAc,CAACJ,YAAY,CAAChC,UAAU,EAAEgC,YAAY,CAACK,IAAI,GAAG,IAAI,CAAC;;QAEvE,CAAC;OAEF,IAAI,CAAC3C,cAAc,GAAG,IAAIxP,eAAI,CAC7B,wBAAwB,EACxBoL,IAAI,EACJ9L,SAAS,EACT;SACClE,QAAQ,EAAE,IAAI;SACdpC,SAAS,EAAE,CAAC;SACZC,UAAU,EAAE,CAAC;SACb6C,KAAK,EAAE;WAACC,QAAQ,EAAE;UAAM;SACxBrC,MAAM,EAAElB,UAAU,GAAG,GAAG;SACxBmD,MAAM,EAAE;WACPC,YAAY,EAAE;aAAA,OAAM,MAAI,CAAC4T,cAAc,CAACtT,OAAO,EAAE;;WACjDgE,cAAc,EAAE;aAAA,OAAM,MAAI,CAACsP,cAAc,GAAG,IAAI;;;QAEjD,CACD;OACD,IAAI,CAACA,cAAc,CAACrP,IAAI,EAAE;;;KAC1B;KAAA,2CAE0BiS,SAAS,EAAEhD,QAAQ,EAC9C;OAAA;OACC,OAAO,YACP;SACC,MAAI,CAACI,cAAc,CAACzP,KAAK,EAAE;SAC3B,MAAI,CAACsS,gBAAgB,CAACD,SAAS,EAAEhD,QAAQ,CAAC;QAC1C;;;KACD;KAAA,+BAEcgD,SAAS,EAAEE,IAAI,EAC9B;OAAA;OACC,IAAI,CAACC,iBAAiB,CAAC;SACtBC,MAAM,EAAE,kBAAkB;SAC1BC,UAAU,EAAE;WACXC,UAAU,EAAE,IAAI,CAAC5X,EAAE;WACnBsX,SAAS,EAAEA,SAAS;WACpBE,IAAI,EAAEA;UACN;SACDK,eAAe,EAAE,yBAACpE,IAAI,EACtB;WACC,IAAIA,IAAI,CAACZ,KAAK,EACd;aACC,MAAI,CAACiF,eAAe,CAACrE,IAAI,CAACZ,KAAK,CAAC;aAChC,MAAI,CAACC,MAAM,EAAE;;;QAGf,CAAC;;;KACF;KAAA,iCAEgBwE,SAAS,EAAEhD,QAAQ,EACpC;OAAA;OACC,IAAI,CAACmD,iBAAiB,CAAC;SACtBC,MAAM,EAAE,oBAAoB;SAC5BC,UAAU,EAAE;WACXC,UAAU,EAAE,IAAI,CAAC5X,EAAE;WACnBsX,SAAS,EAAEA,SAAS;WACpBhD,QAAQ,EAAEA;UACV;SACDuD,eAAe,EAAE,yBAACpE,IAAI,EACtB;WACC,MAAI,CAACqE,eAAe,CAACrE,IAAI,CAACZ,KAAK,CAAC;WAChC,MAAI,CAACC,MAAM,EAAE;;QAEd,CAAC;;;KACF;;CAGF;CACA;CACA;KAHC,iCAIiBwE,SAAS,EAAES,eAAe,EAC3C;OACC,IAAI,CAACN,iBAAiB,CAAC;SACtBC,MAAM,EAAE,oBAAoB;SAC5BC,UAAU,EAAE;WACXC,UAAU,EAAE,IAAI,CAAC5X,EAAE;WACnBsX,SAAS,EAAEA,SAAS;WACpBS,eAAe,EAAEA;;QAElB,CAAC;;;KACF;KAAA,kCAEiBja,MAAM,EACxB;OACC,IAAI,CAACC,cAAI,CAACC,aAAa,CAACF,MAAM,CAAC,EAC/B;SACCA,MAAM,GAAG,EAAE;;OAGZ,IAAI,CAACC,cAAI,CAACkB,UAAU,CAACnB,MAAM,CAAC+Z,eAAe,CAAC,EAC5C;SACC/Z,MAAM,CAAC+Z,eAAe,GAAGla,GAAG;;OAG7B,IAAIqa,aAAa,GAAG;SACnB,QAAQ,EAAEzO,EAAE,CAAC4J,aAAa,EAAE;SAC5B,aAAa,EAAErV,MAAM,CAAC4Z,MAAM;SAC5B,YAAY,EAAE5Z,MAAM,CAAC6Z;QACrB;OAEDpO,EAAE,CAAC6J,IAAI,CAAC;SACPC,GAAG,EAAE1B,QAAQ,CAAC2B,UAAU,EAAE;SAC1BC,MAAM,EAAE,MAAM;SACdC,QAAQ,EAAE,MAAM;SAChBC,IAAI,EAAEuE,aAAa;SACnBtE,SAAS,EAAE,mBAACD,IAAI;WAAA,OAAK3V,MAAM,CAAC+Z,eAAe,CAACpE,IAAI,CAAC;;QACjD,CAAC;;;KACF;KAAA,gCAEewE,KAAK,EACrB;OAAA;OAAA,4CACgC,IAAI,CAACpG,QAAQ;SAAA;OAAA;SAA5C,uDACA;WAAA;aADUyC,QAAQ;aAAEgB,MAAM;WAEzBA,MAAM,CAACzC,KAAK,GAAG,EAAE;;;SACjB;;SAAA;;OAEDoF,KAAK,CAACvT,OAAO,CAAC,UAACsP,IAAI;SAAA,OAAK,MAAI,CAACnC,QAAQ,CAACe,GAAG,CAACoB,IAAI,CAACD,SAAS,CAAC,CAAClB,KAAK,CAACjO,IAAI,CAACoP,IAAI,CAAC;SAAC;OAE3E,IAAI,IAAI,CAACnC,QAAQ,CAACe,GAAG,CAAC,IAAI,CAACb,eAAe,CAAC,CAACc,KAAK,CAACxR,MAAM,KAAK,CAAC,EAC9D;SACC,IAAI,CAAC0Q,eAAe,GAAG,IAAI,CAACoC,mBAAmB,EAAE;SACjD,IAAI,CAAClC,gBAAgB,GAAG,CAAC;QACzB,MAED;SACC,IAAI,IAAI,CAACA,gBAAgB,IAAI,IAAI,CAACJ,QAAQ,CAACe,GAAG,CAAC,IAAI,CAACb,eAAe,CAAC,CAACc,KAAK,CAACxR,MAAM,EACjF;WACC,IAAI,CAAC4Q,gBAAgB,GAAG,CAAC;;;OAI3B,IAAI,CAACc,UAAU,CAAC,IAAI,CAAChB,eAAe,EAAE,IAAI,CAACE,gBAAgB,CAAC;;;KAC5D;KAAA,sCAGD;OACC,IAAIiG,aAAa,GAAG,KAAK;OAAC,4CAEK,IAAI,CAACrG,QAAQ;SAAA;OAAA;SAA5C,uDACA;WAAA;aADUyC,QAAQ;aAAEgB,MAAM;WAEzB,IAAIA,MAAM,CAACzC,KAAK,CAACxR,MAAM,GAAG,CAAC,EAC3B;aACC6W,aAAa,GAAG5D,QAAQ;aACxB;;;;SAED;;SAAA;;OACD,OAAO4D,aAAa;;;KACpB;KAAA,oCAGD;OACC,OAAO,IAAI,CAACrG,QAAQ,CAACe,GAAG,CAAC,IAAI,CAACb,eAAe,CAAC,CAACc,KAAK,CAAC,IAAI,CAACZ,gBAAgB,CAAC;;;KAC3E;KAAA,+BAEcqC,QAAQ,EACvB;OACC,IAAM6D,KAAK,GAAG,IAAI,CAACtG,QAAQ,CAACe,GAAG,CAAC0B,QAAQ,CAAC,CAACzB,KAAK,CAACxR,MAAM;OAEtD,OAAOwD,cAAI,CAACC,MAAM,CAAC,IAAI,CAAC+M,QAAQ,CAACe,GAAG,CAAC0B,QAAQ,CAAC,CAAC2B,IAAI,CAAC,GAAG,IAAI,GAAGkC,KAAK,CAACC,QAAQ,EAAE,GAAG,GAAG;;;KACpF;KAAA,kCAEiB9C,MAAM,EACxB;OACC,IAAI+C,gBAAgB;OACpB,IAAIC,SAAS;OACb,IAAIC,aAAa;OACjB,IAAMjE,QAAQ,GAAGgB,MAAM,CAACvB,SAAS;OAEjC,IAAI,CAACuB,MAAM,CAAC7T,cAAc,CAAC,SAAS,CAAC,EACrC;SACC6T,MAAM,CAACkD,OAAO,GAAG,KAAK;;OAGvB,IAAI1W,SAAS,GAAG,0BAA0B;OAE1C,IAAIwT,MAAM,CAACmD,KAAK,IAAI,EAAE,EACtB;SACC3W,SAAS,GAAGA,SAAS,GAAG,GAAG,GAAGwT,MAAM,CAACmD,KAAK;;OAG3C,OAAO9W,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACxBC,KAAK,EAAE;WAACC,SAAS,EAAEA;UAAU;SAAEC,QAAQ,EAAE,CACxCJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAACC,SAAS,EAAE,gCAAgC,IAAIwT,MAAM,CAACkD,OAAO,GAAG,EAAE,GAAG,SAAS;YAAE;WACxFzW,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;aAACsB,IAAI,EAAE,IAAI,CAACwV,cAAc,CAACpE,QAAQ;YAAE,CAAC,EACzD3S,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aAACC,KAAK,EAAE;eAACC,SAAS,EAAE;;YAAwC,CAAC,CAC/E;WACDjB,MAAM,EAAE;aACPmB,KAAK,EAAE,eAACuB,CAAQ,EAChB;eACCA,CAAC,CAACQ,cAAc,EAAE;eAClBQ,YAAY,CAAC8T,gBAAgB,CAAC;eAC9B/C,MAAM,CAACkD,OAAO,GAAG,CAAClD,MAAM,CAACkD,OAAO;eAChC,IAAIlD,MAAM,CAACkD,OAAO,EAClB;iBACCjP,EAAE,CAACU,WAAW,CAAC1G,CAAC,CAAC+S,MAAM,EAAE,QAAQ,CAAC;iBAClCgC,SAAS,CAACnN,KAAK,CAACwN,MAAM,GAAGJ,aAAa,CAACK,YAAY,CAACR,QAAQ,EAAE,GAAG,IAAI;iBACrEC,gBAAgB,GAAGhU,UAAU,CAAC,YAC9B;mBACCiU,SAAS,CAACnN,KAAK,CAACwN,MAAM,GAAG,CAAC;kBAC1B,EAAE,EAAE,CAAC;gBACN,MAED;iBACCpP,EAAE,CAACC,QAAQ,CAACjG,CAAC,CAAC+S,MAAM,EAAE,QAAQ,CAAC;iBAC/BgC,SAAS,CAACnN,KAAK,CAACwN,MAAM,GAAG,CAAC;iBAC1BN,gBAAgB,GAAGhU,UAAU,CAAC,YAC9B;mBACCiU,SAAS,CAACnN,KAAK,CAACwN,MAAM,GAAGJ,aAAa,CAACK,YAAY,GAAG,IAAI;kBAC1D,EAAE,EAAE,CAAC;;;;UAIT,CAAC,EACFN,SAAS,GAAG3W,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAC7BC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAiC;WACpDC,QAAQ,EAAE,CACTwW,aAAa,GAAG5W,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjCC,KAAK,EAAE;eAACC,SAAS,EAAE;cAAqC;aACxDC,QAAQ,EAAE,IAAI,CAAC8W,mBAAmB,CAACvE,QAAQ;YAC3C,CAAC,CACF;WACDzT,MAAM,EAAE;aACPiY,aAAa,EAAE,yBACf;eACC,IAAI,CAACxD,MAAM,CAACkD,OAAO,EACnB;iBACCF,SAAS,CAACnN,KAAK,CAAC4N,cAAc,CAAC,QAAQ,CAAC;;;;UAI3C,CAAC;QAEH,CAAC;;;KACF;KAAA,6BAGD;OACC,OAAQ,IAAI,CAACpP,SAAS,GAAG,iCAAiC,GAAG,2DAA2D;;;GACxH;CAAA;;CCrsBF,IAAIqP,OAAO,GAAG,EAAE;CAEhB,IAAMC,MAAM,GAAG;GACdC,QAAQ,EAAE;CACX,CAAC;AAED,KAAaC,cAAc;GAAA;GAE1B,wBAAYrb,MAAM,EAClB;KAAA;KAAA;KACC;KACA,MAAKsb,iBAAiB,CAAC,8BAA8B,CAAC;KACtD,MAAKC,oBAAoB,CAACvb,MAAM,CAAC+C,MAAM,CAAC;KAExC,MAAKyY,WAAW,GAAG,EAAE;KACrB,MAAKC,cAAc,GAAG;OACrBvZ,EAAE,EAAE,CAAC;OACLwZ,SAAS,EAAE,CAAC;OACZC,cAAc,EAAE,EAAE;OAClBvH,SAAS,EAAE,CAAC;OACZwH,YAAY,EAAE,EAAE;OAChBC,UAAU,EAAE,EAAE;OACd/H,UAAU,EAAE;MACZ;KACD,MAAKtB,IAAI,GAAG,IAAI;KAChB,MAAKjR,QAAQ,GAAG;OACfua,MAAM,EAAE,IAAI;OACZC,UAAU,EAAE,IAAI;OAChBC,UAAU,EAAE,IAAI;OAChBC,YAAY,EAAE;MACd;KACD,MAAKC,MAAM,GAAG,6BAA6B;KAC3C,MAAKC,MAAM,GAAG,KAAK;KACnB,MAAKC,IAAI,EAAE;KAAC;;GACZ;KAAA;KAAA,uBAGD;OACC,IAAI,CAACpJ,IAAI,EAAE;OACX,IAAI,IAAI,CAACyI,cAAc,CAACvZ,EAAE,GAAG,CAAC,EAC9B;SACC,IAAI,CAACsZ,WAAW,GAAG,IAAI,CAACC,cAAc,CAACI,UAAU,CAAC,IAAI,CAACJ,cAAc,CAACG,YAAY,CAAC,CAAC7G,KAAK,CAAC,IAAI,CAAC0G,cAAc,CAACrH,SAAS,CAAC;SACxH,IAAI,CAAC1R,MAAM,EAAE;;;;KAEd;KAAA,uBAGD;OACC,IAAI2Z,SAAS,GAAG5Q,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAAC,IAAI,CAACoH,MAAM,CAAC;OAChD,IAAIjc,cAAI,CAACC,aAAa,CAACmc,SAAS,CAAC,EACjC;SACC,IAAI,CAACZ,cAAc,GAAGY,SAAS;;;;KAEhC;KAAA,0BAGD;OACC,IAAI,IAAI,CAAC7J,IAAI,EACb;SACC3O,aAAG,CAAC0Y,MAAM,CAAC,IAAI,CAAC/J,IAAI,CAAC;SACrB,IAAI,CAACA,IAAI,GAAG,IAAI;;OAGjB/G,EAAE,CAAC6Q,YAAY,CAACC,MAAM,CAAC,IAAI,CAACL,MAAM,CAAC;;;KACnC;KAAA,wBAGD;OACCzQ,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAAC,IAAI,CAACkG,MAAM,EAAE,IAAI,CAACT,cAAc,EAAE,IAAI,CAACU,MAAM,CAAC;;;KAClE;KAAA,qBAEInc,MAAM,EAAEwc,SAAS,EACtB;OACCA,SAAS,GAAIA,SAAS,KAAK,IAAK;OAChC,IAAI,CAACf,cAAc,CAACvZ,EAAE,GAAGlC,MAAM,CAAC8Z,UAAU;OAC1C,IAAI,CAAC2B,cAAc,CAACC,SAAS,GAAG1b,MAAM,CAAC0b,SAAS;OAChD,IAAI,CAACD,cAAc,CAACE,cAAc,GAAG3b,MAAM,CAAC2b,cAAc;OAC1D,IAAI,CAACF,cAAc,CAACrH,SAAS,GAAGpU,MAAM,CAACmU,gBAAgB;OACvD,IAAI,CAACsH,cAAc,CAACG,YAAY,GAAG5b,MAAM,CAACyc,mBAAmB;OAC7D,IAAI,CAAChB,cAAc,CAACI,UAAU,GAAGrR,MAAM,CAACkS,WAAW,CAAC1c,MAAM,CAAC6b,UAAU,CAAC;OACtE,IAAI,CAACJ,cAAc,CAAC3H,UAAU,GAAG9T,MAAM,CAAC8T,UAAU;OAClD,IAAI,CAAC0H,WAAW,GAAG,IAAI,CAACC,cAAc,CAACI,UAAU,CAAC,IAAI,CAACJ,cAAc,CAACG,YAAY,CAAC,CAAC7G,KAAK,CAAC,IAAI,CAAC0G,cAAc,CAACrH,SAAS,CAAC;OACxH,IAAI,CAACuI,KAAK,EAAE;OACZ,IAAI,CAACja,MAAM,CAAC8Z,SAAS,CAAC;;;KACtB;KAAA,uBAEMI,QAAkB,EACzB;OAAA;OACC/Y,aAAG,CAAC6H,QAAQ,CAAC,IAAI,CAAC8G,IAAI,EAAE,kCAAkC,CAAC;OAC3D,IAAI,CAACA,IAAI,CAACtB,gBAAgB,CAAC,cAAc,EAAE,YAC3C;SACC,IAAI,MAAI,CAACsB,IAAI,EACb;WACC3O,aAAG,CAAC0Y,MAAM,CAAC,MAAI,CAAC/J,IAAI,CAAC;WACrB,MAAI,CAACA,IAAI,GAAG,IAAI;;SAGjB/G,EAAE,CAAC6Q,YAAY,CAACC,MAAM,CAAC,MAAI,CAACL,MAAM,CAAC;SACnC,IAAI,MAAI,CAACT,cAAc,CAACvZ,EAAE,KAAK,CAAC,EAChC;WACC,OAAO,KAAK;;SAGb,IAAI2a,cAAc,GAAG,EAAE;SACvB,IAAI,MAAI,CAACpB,cAAc,CAACC,SAAS,GAAG,CAAC,IAAI,MAAI,CAACD,cAAc,CAACE,cAAc,KAAK,EAAE,EAClF;WACCkB,cAAc,CAACnB,SAAS,GAAG,MAAI,CAACD,cAAc,CAACC,SAAS;WACxDmB,cAAc,CAAClB,cAAc,GAAG,MAAI,CAACF,cAAc,CAACE,cAAc;;SAEnEkB,cAAc,CAAC3I,gBAAgB,GAAG,MAAI,CAACuH,cAAc,CAACG,YAAY;SAClEiB,cAAc,CAACC,iBAAiB,GAAG,MAAI,CAACrB,cAAc,CAACrH,SAAS;SAChEyI,cAAc,CAACD,QAAQ,GAAGA,QAAQ;SAElC,MAAI,CAACG,IAAI,CAAC5B,MAAM,CAACC,QAAQ,EAAE;WAC1BtB,UAAU,EAAE,MAAI,CAAC2B,cAAc,CAACvZ,EAAE;WAClCuZ,cAAc,EAAEoB;UAChB,CAAC;QACF,CAAC;;;KACF;KAAA,6BAGD;OACC,IAAI,CAACpB,cAAc,CAACrH,SAAS,EAAE;OAC/B,IAAI,IAAI,CAACqH,cAAc,CAACrH,SAAS,IAAI,IAAI,CAACqH,cAAc,CAACI,UAAU,CAAC,IAAI,CAACJ,cAAc,CAACG,YAAY,CAAC,CAAC7G,KAAK,CAACxR,MAAM,EAClH;SACC,IAAI,CAACkY,cAAc,CAACrH,SAAS,GAAG,CAAC;;OAGlC,IAAI,CAACoH,WAAW,GAAG,IAAI,CAACC,cAAc,CAACI,UAAU,CAAC,IAAI,CAACJ,cAAc,CAACG,YAAY,CAAC,CAAC7G,KAAK,CAAC,IAAI,CAAC0G,cAAc,CAACrH,SAAS,CAAC;OACxH,IAAI,CAACuI,KAAK,EAAE;OACZ,IAAI,CAACja,MAAM,EAAE;;;KACb;KAAA,uBAEM8Z,SAAS,EAChB;OACCA,SAAS,GAAIA,SAAS,KAAK,IAAK;OAChC,IAAI,IAAI,CAAChK,IAAI,KAAK,IAAI,EACtB;SACC,IAAI,CAACA,IAAI,GAAG3O,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAC7BC,KAAK,EAAE;aACN7B,EAAE,EAAE,2BAA2B;aAC/B8B,SAAS,EAAE;YACX;WACDjB,MAAM,EAAE;aACPia,QAAQ,EAAE,IAAI,CAACC,eAAe,CAACha,IAAI,CAAC,IAAI;;UAEzC,CAAC;SACFb,QAAQ,CAACC,IAAI,CAAC6a,WAAW,CAAC,IAAI,CAAC1K,IAAI,CAAC;QACpC,MAED;SACC3O,aAAG,CAACwT,KAAK,CAAC,IAAI,CAAC7E,IAAI,CAAC;;OAGrB,IAAI,CAACA,IAAI,CAAC0K,WAAW,CAACrZ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACvCC,KAAK,EAAE;WAACC,SAAS,EAAE;UAAmC;SACtDqJ,KAAK,EAAGmP,SAAS,GAAG;WAACW,MAAM,EAAE;UAAQ,GAAG,EAAG;SAC3ClZ,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAmC;WAAEC,QAAQ,EAAE,CACjEJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAACC,SAAS,EAAE;cAAyC;aAAEC,QAAQ,EAAE,CACvE,IAAI,CAAC1C,QAAQ,CAACua,MAAM,GAAGjY,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eAACC,KAAK,EAAE;iBAACC,SAAS,EAAE;;cAA+C,CAAC;YAE9G,CAAC,EACFH,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAACC,SAAS,EAAE;cAAwC;aAC3DC,QAAQ,EAAE,IAAI,CAACmZ,cAAc;YAC7B,CAAC;UAEH,CAAC;QAEH,CAAC,CAAC;OAEH,IAAI,CAAC5K,IAAI,CAAC0K,WAAW,CAACrZ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACvCC,KAAK,EAAE;WAACC,SAAS,EAAE;UAAoC;SAAEC,QAAQ,EAAE,CAClEJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAACC,SAAS,EAAE;YAA4C;WAAEC,QAAQ,EAAE,CAC1E,IAAI,CAAC1C,QAAQ,CAACwa,UAAU,GAAGlY,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;aAC7CC,KAAK,EAAE;eAACC,SAAS,EAAE;cAA4C;aAC/DoB,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;aAC7D1B,MAAM,EAAE;eACPmB,KAAK,EAAE,IAAI,CAACoB,kBAAkB,CAACrC,IAAI,CAAC,IAAI;;YAEzC,CAAC,EACF,IAAI,CAAC1B,QAAQ,CAACya,UAAU,GAAGnY,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;aAC7CC,KAAK,EAAE;eAACC,SAAS,EAAE;cAAmE;aACtFoB,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;aAC7D1B,MAAM,EAAE;eACPmB,KAAK,EAAE,IAAI,CAACmZ,kBAAkB,CAACpa,IAAI,CAAC,IAAI;;YAEzC,CAAC;UAEH,CAAC;QAEH,CAAC,CAAC;OAEH,IAAI,CAACuP,IAAI,CAAC0K,WAAW,CAACrZ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACtCC,KAAK,EAAE;WAACC,SAAS,EAAE;UAAqB;SAAEC,QAAQ,EAAE,CACnD,IAAI,CAAC1C,QAAQ,CAAC0a,YAAY,GAAGpY,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAC9CC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAqB;WACxCC,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAACC,SAAS,EAAE;cAA2B;aAC9CoB,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,2BAA2B;YAChD,CAAC,CACF;WACD1B,MAAM,EAAE;aACPmB,KAAK,EAAE,IAAI,CAACoZ,oBAAoB,CAACra,IAAI,CAAC,IAAI;;UAE3C,CAAC;QAEH,CAAC,CACF;OAED,IAAIiY,OAAO,CAAC,IAAI,CAACM,WAAW,CAACtE,UAAU,CAAC,EACxC;SACC,IAAI,CAAC3V,QAAQ,CAACua,MAAM,CAACzO,KAAK,CAACkQ,eAAe,GAAG,QAAQ,GAAGxW,cAAI,CAACC,MAAM,CAACkU,OAAO,CAAC,IAAI,CAACM,WAAW,CAACtE,UAAU,CAAC,CAAC,GAAG,KAAK;QACjH,MAED;SACC,IAAI,CAACsG,UAAU,CAAC,IAAI,CAAC/B,cAAc,CAAC3H,UAAU,EAAE,IAAI,CAAC0H,WAAW,CAACtE,UAAU,CAAC;;OAG7E,IAAIsF,SAAS,EACb;SACC3Y,aAAG,CAAC6H,QAAQ,CAAC,IAAI,CAAC8G,IAAI,EAAE,gCAAgC,CAAC;SACzD,IAAI,CAACA,IAAI,CAACtB,gBAAgB,CAAC,cAAc,EAAE,YAC3C;WACCzF,EAAE,CAACU,WAAW,CAAC,IAAI,CAACqG,IAAI,EAAE,gCAAgC,CAAC;UAC3D,CAAC;;;;KAEH;KAAA,iCAGD;OACC,IAAI7I,MAAM,GAAG,EAAE;OAEfA,MAAM,CAAC7C,IAAI,CAACjD,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAC7BC,KAAK,EAAE;WAACC,SAAS,EAAE;UAAwC;SAC3DoB,IAAI,EAAE,IAAI,CAACoW,WAAW,CAACrD;QACvB,CAAC,CAAC;OACH,IAAI,IAAI,CAACqD,WAAW,CAAC7C,IAAI,EACzB;SACChP,MAAM,CAAC7C,IAAI,CAACjD,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAC7BC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAwC;WAC3DoB,IAAI,EAAE,IAAI,CAACoW,WAAW,CAAC7C;UACvB,CAAC,CAAC;;OAEJ,IAAI,IAAI,CAAC6C,WAAW,CAAC5C,aAAa,EAClC;SACCjP,MAAM,CAAC7C,IAAI,CAACjD,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAC7BC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAwC;WAC3DoB,IAAI,EAAE,IAAI,CAACoW,WAAW,CAAC5C;UACvB,CAAC,CAAC;;OAGJ,OAAOjP,MAAM;;;KACb;KAAA,2BAEUmK,UAAU,EAAE2J,QAAQ,EAC/B;OAAA;OACChS,EAAE,CAAC6J,IAAI,CAAC;SACPC,GAAG,EAAE1B,QAAQ,CAAC2B,UAAU,EAAE;SAC1BC,MAAM,EAAE,MAAM;SACdC,QAAQ,EAAE,MAAM;SAChBC,IAAI,EAAE;WACL,QAAQ,EAAElK,EAAE,CAAC4J,aAAa,EAAE;WAC5B,aAAa,EAAE,YAAY;WAC3B,YAAY,EAAEvB,UAAU;WACxB,UAAU,EAAE2J;UACZ;SACD7H,SAAS,EAAE,mBAACD,IAAI,EAChB;WACC,IAAI,CAACA,IAAI,CAACmG,MAAM,EAChB;aACC;;WAGDZ,OAAO,CAACuC,QAAQ,CAAC,GAAG9H,IAAI,CAACmG,MAAM;WAC/B,IAAI,MAAI,CAACN,WAAW,CAACtE,UAAU,IAAIuG,QAAQ,IAAI,MAAI,CAAClc,QAAQ,CAACua,MAAM,EACnE;aACC,MAAI,CAACva,QAAQ,CAACua,MAAM,CAACzO,KAAK,CAACkQ,eAAe,GAAG,QAAQ,GAAGxW,cAAI,CAACC,MAAM,CAAC2O,IAAI,CAACmG,MAAM,CAAC,GAAG,KAAK;;;QAG1F,CAAC;;;KACF;KAAA,gCAEerW,CAAC,EACjB;OACCA,CAAC,CAACQ,cAAc,EAAE;OAClB,IAAI,CAACyX,MAAM,CAAC,KAAK,CAAC;;;KAClB;KAAA,mCAEkBjY,CAAC,EACpB;OACCA,CAAC,CAACQ,cAAc,EAAE;OAClB,IAAI,CAACyX,MAAM,CAAC,IAAI,CAAC;;;KACjB;KAAA,mCAEkBjY,CAAC,EACpB;OACCA,CAAC,CAACQ,cAAc,EAAE;OAClB,IAAI,CAAC0X,UAAU,EAAE;;;KACjB;KAAA,qCAEoBlY,CAAC,EACtB;OACCA,CAAC,CAACQ,cAAc,EAAE;OAClB,IAAI,CAACyX,MAAM,CAAC,KAAK,CAAC;;;GAClB;CAAA,EAhTkCE,6BAAY;CAmT/C,4BAnTYvC,cAAc,YAkTVF,MAAM;;;;;AC7TvB,CAIA,IAAM0C,iBAAiB,GAAG;GACzB,QAAQ,EAAE;CACX,CAAC;CAAC;AAEF,KAAaC,OAAO;GAEnB,iBAAY9d,MAAM,EAClB;KAAA;KAAA;KACC,IAAI,CAAC+d,mBAAmB,GAAG/d,MAAM,CAAC+d,mBAAmB;KACrD,IAAI,CAACC,QAAQ,GAAGhe,MAAM,CAACge,QAAQ;KAC/B,IAAI,CAACjR,KAAK,GAAG/M,MAAM,CAAC+M,KAAK,IAAI,EAAE;KAC/B,IAAI,CAAC+C,MAAM,GAAG,IAAI;;GAClB;KAAA;KAAA,+BAEcrN,OAAO,EAAEwb,EAAE,EAAEje,MAAM,EAClC;OAAA;OACCA,MAAM,GAAGA,MAAM,IAAI,EAAE;OAErB,IAAIA,MAAM,CAACke,gBAAgB,EAC3B;SACC,IAAI,CAACA,gBAAgB,GAAGle,MAAM,CAACke,gBAAgB;;OAGhD,IAAIle,MAAM,CAACme,iBAAiB,EAC5B;SACC,IAAI,CAACA,iBAAiB,GAAGne,MAAM,CAACme,iBAAiB;;OAGlDne,MAAM,CAACoe,SAAS,GAAIpe,MAAM,CAACoe,SAAS,KAAK,IAAK;OAE9CC,+BAAU,CAACC,YAAY,CAAC,YAAY,EAAE,UAAC5M,UAAU,EACjD;SACCA,UAAU,CAAC6M,WAAW,CAAC,YAAY,EAAE;WAACC,KAAK,EAAExe,MAAM,CAACye,KAAK;WAAEC,MAAM,EAAE1e,MAAM,CAAC6a;UAAO,CAAC;SAClFnJ,UAAU,CAAC6M,WAAW,CAAC,WAAW,EAAEve,MAAM,CAACoe,SAAS,CAAC;SACrD,IAAIpe,MAAM,CAACoe,SAAS,IAAIpe,MAAM,CAAC2D,cAAc,CAAC,UAAU,CAAC,IAAI3D,MAAM,CAAC2D,cAAc,CAAC,WAAW,CAAC,EAC/F;WACC+N,UAAU,CAAC6M,WAAW,CAAC,eAAe,EAAE;aAACC,KAAK,EAAExe,MAAM,CAAC2e,QAAQ;aAAED,MAAM,EAAE1e,MAAM,CAAC4e;YAAU,CAAC;;SAE5FlN,UAAU,CAAC6M,WAAW,CAAC,OAAO,EAAE,KAAI,CAACxR,KAAK,CAAC;SAC3C2E,UAAU,CAAC6M,WAAW,CAAC,UAAU,EAAE,IAAI,CAAC;;;SAGxC,IAAIM,IAAI,0BAAG,KAAI,oCAAJ,KAAI,EAAcpc,OAAO,EAAEwb,EAAE,EAAE,EAAE,CAAC;SAC7CvM,UAAU,CAACoN,cAAc,CAAC,WAAW,EAAED,IAAI,CAAC;SAC5C,KAAI,CAAC/O,MAAM,GAAG4B,UAAU;QACxB,CAAC;;;KACF;KAAA,4BAEWsM,QAAiB,EAC7B;OACC,IAAI,CAACA,QAAQ,GAAIA,QAAQ,KAAK,IAAK;OACnC,IAAI,IAAI,CAAClO,MAAM,EACf;SACC,IAAI,CAACA,MAAM,CAACyO,WAAW,CAAC,UAAU,EAAE,IAAI,CAACP,QAAQ,CAAC;;;;KAEnD;KAAA,yBAEQjR,KAAK,EACd;OACC,IAAI,CAACA,KAAK,GAAGA,KAAK;OAClB,IAAI,IAAI,CAAC+C,MAAM,EACf;SACC,IAAI,CAACA,MAAM,CAACyO,WAAW,CAAC,OAAO,EAAExR,KAAK,CAAC;;;;KAExC;KAAA,+BAwFc4D,SAAS,EAAEC,YAAY,EACtC;OACCnF,EAAE,CAACM,OAAO,CAACsE,cAAc,CAACM,SAAS,EAAEC,YAAY,CAAC;;;KAClD;KAAA,8BAEamO,YAAY,EAAEpO,SAAS,EAAEG,aAAa,EACpD;OACCrF,EAAE,CAACM,OAAO,CAACC,aAAa,CAAC+S,YAAY,EAAEpO,SAAS,EAAEG,aAAa,CAAC;;;KAChE;KAAA,uBAEM2N,KAAK,EAAE5D,MAAM,EACpB;OACCzJ,eAAe,CAACmN,WAAW,CAAC,YAAY,EAAE;SAACC,KAAK,EAAEC,KAAK;SAAEC,MAAM,EAAE7D;QAAO,CAAC;;;KACzE;KAAA,6BAEYuD,SAAS,EACtB;OACCA,SAAS,GAAIA,SAAS,KAAK,IAAK;OAChChN,eAAe,CAACmN,WAAW,CAAC,WAAW,EAAEH,SAAS,CAAC;;;KACnD;KAAA,2BAEUK,KAAK,EAAE5D,MAAM,EACxB;OACCzJ,eAAe,CAACmN,WAAW,CAAC,eAAe,EAAE;SAACC,KAAK,EAAEC,KAAK;SAAEC,MAAM,EAAE7D;QAAO,CAAC;;;KAC5E;KAAA,kCAEiB7a,MAAM,EACxB;OACCoR,eAAe,CAACmN,WAAW,CAAC,UAAU,EAAEve,MAAM,CAAC;;;KAC/C;KAAA,yBAGD;OACCoR,eAAe,CAAC0N,cAAc,CAAC,QAAQ,CAAC;;;KACxC;KAAA,2BAEUE,IAAI,EACf;OACC,IAAI,OAAQpP,eAAgB,IAAI,WAAW,EAC3C;SACC,OAAO,CAAC;;OAGT,IAAI,CAAC,IAAI,CAACqP,aAAa,EACvB;SACC,IAAI,CAACA,aAAa,GAAGrP,eAAe,CAACsP,WAAW,CAAC,cAAc,CAAC;;OAGjE,OAAOF,IAAI,GAAG,IAAI,CAACC,aAAa,CAACE,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAACF,aAAa,CAAC,CAAC,CAAC;;;KAClE;KAAA,mCAEkBG,WAAW,EAC9B;OACC,IAAI,CAACvB,iBAAiB,CAACla,cAAc,CAACyb,WAAW,CAAC,EAClD;SACC,OAAO,KAAK;;OAGb,OAAO,IAAI,CAACC,UAAU,EAAE,IAAIxB,iBAAiB,CAACuB,WAAW,CAAC;;;GAC1D;CAAA;CACD,uBAlJa3c,OAAO,EAAE6c,SAAS,EAAEC,QAAQ,EAAEC,SAAS,EACpD;GACC/c,OAAO,GAAGA,OAAO,IAAI,EAAE;GACvB6c,SAAS,GAAGA,SAAS,IAAI,EAAE;GAC3BE,SAAS,GAAGA,SAAS,IAAI,EAAE;GAE3B,IAAI,IAAI,CAACC,eAAe,IAAI,IAAI,EAChC;KACC,IAAI,CAACA,eAAe,GAAGrd,QAAQ,CAACsd,IAAI,CAACC,SAAS,CAAC5H,OAAO,CAAC,4BAA4B,EAAE,EAAE,CAAC;;GAGzF,IAAI9X,cAAI,CAACkV,SAAS,CAAC1S,OAAO,CAAC,EAC3B;KACCA,OAAO,GAAGA,OAAO,CAACkd,SAAS;;GAG5B,IAAI1f,cAAI,CAACkV,SAAS,CAACmK,SAAS,CAAC,EAC7B;KACCA,SAAS,GAAGA,SAAS,CAACK,SAAS;;GAGhC,IAAI1f,cAAI,CAAC2f,cAAc,CAACN,SAAS,CAAC,EAClC;KACCA,SAAS,oEAGJA,SAAS,uCAEH;;GAGZ,IAAIO,MAAM,GAAG,EAAE;GACf,IAAIN,QAAQ,EACZ;KACCM,MAAM,8VASU,IAAI,CAAC9B,mBAAmB,CAAC+B,MAAM,0CAC/B,IAAI,CAAC/B,mBAAmB,CAACgC,QAAQ,8CAC5B,IAAI,CAAChC,mBAAmB,CAACpY,WAAW,sDAC7B,IAAI,CAACoY,mBAAmB,CAACiC,kBAAkB,6CACpD,IAAI,CAACjC,mBAAmB,CAACkC,SAAS,8CACjC,IAAI,CAAClC,mBAAmB,CAACmC,UAAU,4CACrC,IAAI,CAACnC,mBAAmB,CAACoC,QAAQ,sCACvC,IAAI,CAACpC,mBAAmB,CAACqC,GAAG,6CACpB,IAAI,CAACrC,mBAAmB,CAACsC,WAAW,4CACrC,IAAI,CAACtC,mBAAmB,CAACuC,UAAU,0CACrC,IAAI,CAACvC,mBAAmB,CAACwC,QAAQ,gDAC3B,IAAI,CAACxC,mBAAmB,CAACyC,aAAa,+CACxC,IAAI,CAACzC,mBAAmB,CAAC0C,WAAW,iDAClC,IAAI,CAAC1C,mBAAmB,CAAC2C,aAAa,sDACjC,IAAI,CAAC3C,mBAAmB,CAAC4C,kBAAkB,6CACpD,IAAI,CAAC5C,mBAAmB,CAACjE,UAAU,mDAC5B,IAAI,CAACiE,mBAAmB,CAAC7J,gBAAgB,oDACzC,IAAI,CAAC6J,mBAAmB,CAACjB,iBAAiB,wCACrD,IAAI,CAACiB,mBAAmB,CAAC6C,MAAM,GAAGC,IAAI,CAACC,SAAS,CAAC,IAAI,CAAC/C,mBAAmB,CAAC6C,MAAM,CAAC,GAAG,IAAI,4CACpF,IAAI,CAAC7C,mBAAmB,CAACgD,UAAU,GAAG,MAAM,GAAG,OAAO,gDAClD,IAAI,CAAChD,mBAAmB,CAACiD,cAAc,GAAGH,IAAI,CAACC,SAAS,CAAC,IAAI,CAAC/C,mBAAmB,CAACiD,cAAc,CAAC,GAAG,IAAI,kDACtG,IAAI,CAACjD,mBAAmB,CAACkD,gBAAgB,2CAChD,IAAI,CAAClD,mBAAmB,CAACrC,SAAS,iDAC5B,IAAI,CAACqC,mBAAmB,CAACpC,cAAc,gGAE9C,IAAI,CAACoC,mBAAmB,CAACmD,QAAQ,GAAGL,IAAI,CAACC,SAAS,CAAC,IAAI,CAAC/C,mBAAmB,CAACmD,QAAQ,CAAC,GAAG,IAAI,2DAGlG;;GAEZ,6DAEe9e,QAAQ,CAAC+e,eAAe,CAAC/N,IAAI,0BACxC,IAAI,CAACqM,eAAe,iEACqBD,SAAS,8DACjB/c,OAAO,+BACvCod,MAAM,yBACNP,SAAS;CAIf;;;;AC1JD,CAkBO,IAAM8B,SAAS,GAAG;GACxBC,QAAQ,EAAE,UAAU;GACpBC,QAAQ,EAAE,UAAU;GACpB/W,QAAQ,EAAE;CACX,CAAC;AAED,CAAO,IAAMG,OAAO,GAAG;GACtB2W,QAAQ,EAAE,CAAC;GACXE,gBAAgB,EAAE,CAAC;GACnBD,QAAQ,EAAE,CAAC;GACXE,kBAAkB,EAAE,CAAC;GACrBC,kBAAkB,EAAE,CAAC;GACrBC,SAAS,EAAE,CAAC;GACZC,YAAY,EAAE,CAAC;GACfC,cAAc,EAAE,CAAC;GACjBC,iBAAiB,EAAE,CAAC;GACpBC,IAAI,EAAE,EAAE;GACRC,KAAK,EAAE,EAAE;GACTC,UAAU,EAAE,EAAE;GACdC,aAAa,EAAE,EAAE;GACjBC,MAAM,EAAE,EAAE;GACVC,YAAY,EAAE;CACf,CAAC;AAED,CAAO,IAAMC,SAAS,GAAG;GACxBN,IAAI,EAAE,MAAM;GACZO,UAAU,EAAE,YAAY;GACxBX,SAAS,EAAE;CACZ,CAAC;AAED,CAAO,IAAMY,YAAY,GAAG;GAC3BC,OAAO,EAAE,SAAS;GAClBR,KAAK,EAAE,OAAO;GACdS,OAAO,EAAE,SAAS;GAClBC,MAAM,EAAE,QAAQ;GAChBC,IAAI,EAAE;CACP,CAAC;CAED,IAAMC,aAAa,GAAG;GACrBC,QAAQ,EAAE,UAAU;GACpBC,MAAM,EAAE;CACT,CAAC;;CAED;CACA,IAAMC,OAAO,GAAG;GACfC,MAAM,EAAE,QAAQ;GAChB3C,GAAG,EAAE;CACN,CAAC;CAED,IAAM4C,WAAW,GAAG;GACnBD,MAAM,EAAE;KACPtE,KAAK,EAAE,GAAG;KACV5D,MAAM,EAAE;IACR;GACDuF,GAAG,EAAE;KACJ3B,KAAK,EAAE,GAAG;KACV5D,MAAM,EAAE;;CAEV,CAAC;CAED,IAAMoI,MAAM,GAAG;GACdpI,MAAM,EAAE,2BAA2B;GACnC4D,KAAK,EAAE,0BAA0B;GACjCyE,QAAQ,EAAE,kBAAkB;GAC5BC,UAAU,EAAE,cAAc;GAC1BC,YAAY,EAAE,gBAAgB;GAC9BC,WAAW,EAAE;CACd,CAAC;AAED,CAAO,IAAMpX,aAAa,GAAG;GAC5Ba,QAAQ,EAAE,uBAAuB;GACjCwW,SAAS,EAAE,wBAAwB;GACnCtY,UAAU,EAAE,yBAAyB;GACrCuY,aAAa,EAAE,4BAA4B;GAC3CC,YAAY,EAAE,2BAA2B;GACzCC,aAAa,EAAE,4BAA4B;GAC3CC,mBAAmB,EAAE,kCAAkC;GACvDC,sBAAsB,EAAE,qCAAqC;GAC7DC,iBAAiB,EAAE,gCAAgC;GACnDC,SAAS,EAAE,wBAAwB;GACnCC,YAAY,EAAE,2BAA2B;GACzCC,aAAa,EAAE,4BAA4B;GAC3CC,SAAS,EAAE,wBAAwB;GACnCC,aAAa,EAAE,4BAA4B;GAC3CC,cAAc,EAAE,6BAA6B;GAC7CC,qBAAqB,EAAE,oCAAoC;GAC3DC,WAAW,EAAE,0BAA0B;GACvCC,WAAW,EAAE,0BAA0B;GAEvC3X,MAAM,EAAE,qBAAqB;GAC7BC,QAAQ,EAAE,uBAAuB;GACjCT,MAAM,EAAE,qBAAqB;GAC7BE,QAAQ,EAAE,uBAAuB;GACjCkY,UAAU,EAAE,yBAAyB;GACrCC,kBAAkB,EAAE,iCAAiC;GACrDC,QAAQ,EAAE,uBAAuB;GACjCC,MAAM,EAAE,qBAAqB;GAC7BC,QAAQ,EAAE,uBAAuB;GACjCpjB,OAAO,EAAE,sBAAsB;GAC/BqjB,eAAe,EAAE,8BAA8B;GAC/CC,kBAAkB,EAAE,iCAAiC;GACrDC,gBAAgB,EAAE,+BAA+B;GACjDC,cAAc,EAAE,6BAA6B;GAC7CC,cAAc,EAAE,6BAA6B;GAC7CC,eAAe,EAAE,8BAA8B;GAC/CC,sBAAsB,EAAE,qCAAqC;GAC7DC,cAAc,EAAE,6BAA6B;GAC7CC,aAAa,EAAE,4BAA4B;GAC3CC,cAAc,EAAE;CACjB,CAAC;CAED,IAAMC,WAAW,GAAG,gCAAgC;CAAC;CAAA;AAiFrD,KAAajb,aAAa;GASzB,uBAAYpK,OAA2B,EACvC;KAAA;KAAA;KAAA;OAAA;OAAA,OAi2FmB,eAACA,MAAM,EAC1B;SACCsW,OAAO,CAACgP,IAAI,CAAC,kBAAkB,EAAEtlB,MAAM,CAAC;SACxC;SACAA,MAAM,GAAGC,cAAI,CAACC,aAAa,CAACF,MAAM,CAAC,GAAGA,MAAM,GAAG,EAAE;SACjDA,MAAM,CAAC4F,GAAG,GAAG5F,MAAM,CAAC4F,GAAG,IAAI,EAAE;SAE7B,IAAItB,KAAK,GAAGtE,MAAM,CAACsE,KAAK,IAAI,EAAE;SAC9BA,KAAK,CAACihB,cAAc,GAAGjhB,KAAK,CAACihB,cAAc,IAAI,EAAE;SACjDjhB,KAAK,CAACkhB,OAAO,GAAGlhB,KAAK,CAACkhB,OAAO,IAAI,EAAE;SACnClhB,KAAK,CAACmhB,UAAU,GAAGxlB,cAAI,CAACylB,SAAS,CAACphB,KAAK,CAACmhB,UAAU,CAAC,GAAGnhB,KAAK,CAACmhB,UAAU,GAAG,KAAK;SAE9E,IAAInhB,KAAK,CAACmhB,UAAU,EACpB;WACC;;SAGD,IAAIzlB,MAAM,CAAC4F,GAAG,KAAK,mBAAmB,IAAI,KAAI,CAAC+f,gBAAgB,CAACrhB,KAAK,CAACkhB,OAAO,CAAC,EAC9E;WACC,IAAI,KAAI,CAACG,gBAAgB,CAACrhB,KAAK,CAACkhB,OAAO,CAAC,EACxC;aACC,IAAI,KAAI,CAACG,gBAAgB,CAACrhB,KAAK,CAACkhB,OAAO,CAAC,CAAC,MAAM,CAAC,IAAI,QAAQ,EAC5D;eACC,KAAI,CAAChF,aAAa,GAAGlc,KAAK,CAACihB,cAAc;eACzC,KAAI,CAAC9E,WAAW,GAAGnc,KAAK,CAACshB,UAAU,CAAC1jB,EAAE;eACtC,KAAI,CAAC2jB,WAAW,CAAC,KAAI,CAACrF,aAAa,EAAE,KAAI,CAACC,WAAW,CAAC;cACtD,MACI,IAAI,KAAI,CAACkF,gBAAgB,CAACrhB,KAAK,CAACkhB,OAAO,CAAC,CAAC,MAAM,CAAC,IAAI,KAAK,EAC9D;;eAEC,KAAI,CAACK,WAAW,CAAC,KAAI,CAACrF,aAAa,EAAE,KAAI,CAACC,WAAW,CAAC;;aAGvD,IAAI,KAAI,CAACkF,gBAAgB,CAACrhB,KAAK,CAACkhB,OAAO,CAAC,CAAC,QAAQ,CAAC,EAClD;eACC,KAAI,CAACG,gBAAgB,CAACrhB,KAAK,CAACkhB,OAAO,CAAC,CAAC,QAAQ,CAAC,CAACre,KAAK,EAAE;;aAGvD,OAAO,KAAI,CAACwe,gBAAgB,CAACrhB,KAAK,CAACkhB,OAAO,CAAC;;;;;KAG7C;OAAA;OAAA,OAuEiB,iBAClB;SACClP,OAAO,CAACC,GAAG,CAAC,gCAAgC,EAAEjD,QAAQ,CAACC,IAAI,EAAE8K,+BAAU,CAACyH,YAAY,EAAE,CAAC;SACvF,KAAI,CAAC3e,KAAK,EAAE;;;KAn9FZ,IAAI,CAACjF,EAAE,GAAG,oBAAoB;KAC9B,IAAI,CAACI,QAAQ,GAAGtC,OAAM,CAACsC,QAAQ,KAAK,IAAI;;;KAGxC,IAAI,CAACqD,WAAW,GAAG3F,OAAM,CAAC2F,WAAW,IAAI,QAAQ;KACjD,IAAI,CAACogB,UAAU,GAAG/lB,OAAM,CAAC+lB,UAAU,IAAI,EAAE;KACzC,IAAI,CAAC/F,kBAAkB,GAAGhgB,OAAM,CAACggB,kBAAkB,IAAI,EAAE;KACzD,IAAI,CAACC,SAAS,GAAGjgB,OAAM,CAACigB,SAAS,IAAImB,SAAS,CAACC,QAAQ;KACvD,IAAI,CAACnB,UAAU,GAAGlgB,OAAM,CAACkgB,UAAU;KACnC,IAAI,CAACC,QAAQ,GAAGngB,OAAM,CAACmgB,QAAQ;KAC/B,IAAI,CAACS,MAAM,GAAG5gB,OAAM,CAAC4gB,MAAM,IAAI,EAAE;KACjC,IAAI,CAACd,MAAM,GAAG9f,OAAM,CAAC8f,MAAM,IAAI,EAAE;KACjC,IAAI,CAACkG,SAAS,GAAG5D,SAAS,CAACN,IAAI;;;KAG/B,IAAI,CAACtB,aAAa,GAAG/U,EAAE,CAACwa,IAAI,CAACC,SAAS,CAAClmB,OAAM,EAAE,eAAe,EAAE,EAAE,CAAC;KACnE,IAAI,CAACygB,WAAW,GAAGhV,EAAE,CAACwa,IAAI,CAACE,UAAU,CAACnmB,OAAM,EAAE,aAAa,EAAE,CAAC,CAAC;KAC/D,IAAI,CAAC0gB,aAAa,GAAGjV,EAAE,CAACwa,IAAI,CAACE,UAAU,CAACnmB,OAAM,EAAE,eAAe,EAAE,CAAC,CAAC;KACnE,IAAI,CAAC2gB,kBAAkB,GAAGlV,EAAE,CAACwa,IAAI,CAACC,SAAS,CAAClmB,OAAM,EAAE,oBAAoB,EAAE,EAAE,CAAC;KAC7E,IAAI,CAAComB,OAAO,GAAG3a,EAAE,CAACwa,IAAI,CAACI,SAAS,CAACrmB,OAAM,EAAE,SAAS,EAAE,EAAE,CAAC;KACvD,IAAI,CAACsmB,WAAW,GAAG7a,EAAE,CAACwa,IAAI,CAACM,QAAQ,CAACvmB,OAAM,EAAE,aAAa,EAAE,EAAE,CAAC;KAC9D,IAAI,CAAC2lB,gBAAgB,GAAG,EAAE;;;KAG1B,IAAI,CAAC3E,cAAc,GAAGhhB,OAAM,CAACghB,cAAc;KAC3C,IAAI,CAACC,gBAAgB,GAAGjhB,OAAM,CAACihB,gBAAgB;KAC/C,IAAI,CAACuF,mBAAmB,GAAGxmB,OAAM,CAACwmB,mBAAmB;;;KAGrD,IAAI,CAACnG,WAAW,GAAIrgB,OAAM,CAACqgB,WAAW,KAAK,IAAK;KAChD,IAAI,CAACC,UAAU,GAAItgB,OAAM,CAACsgB,UAAU,KAAK,IAAK;KAC9C,IAAI,CAACS,UAAU,GAAI/gB,OAAM,CAAC+gB,UAAU,KAAK,IAAK;KAC9C,IAAI,CAACX,GAAG,GAAIpgB,OAAM,CAACogB,GAAG,KAAK,IAAK;KAChC,IAAI,CAAC7T,IAAI,GAAG,KAAK;KACjB,IAAI,CAAChB,KAAK,GAAG,KAAK;KAClB,IAAI,CAACkb,SAAS,GAAIzmB,OAAM,CAACymB,SAAS,KAAK,IAAK;KAC5C,IAAI,CAAC7J,QAAQ,GAAI5c,OAAM,CAAC4c,QAAQ,KAAK,IAAK,CAAC;KAC3C,IAAI,CAACoB,QAAQ,GAAG,KAAK;KACrB,IAAI,CAAC0I,cAAc,GAAG,IAAI;KAC1B,IAAI,CAACC,MAAM,GAAI3mB,OAAM,CAAC2mB,MAAM,KAAK,IAAK;KACtC,IAAI,CAACC,QAAQ,GAAI5mB,OAAM,CAAC4mB,QAAQ,KAAK,IAAK;KAC1C,IAAI,CAACrG,QAAQ,GAAIvgB,OAAM,CAACugB,QAAQ,KAAK,IAAK;KAE1C,IAAI,CAACxT,KAAK,GAAG,EAAE;KACf,IAAI,CAACgT,QAAQ,GAAG/f,OAAM,CAAC+K,OAAO,IAAIL,OAAO,CAACoX,IAAI;KAC9C,IAAI,CAAC7U,UAAU,GAAGjN,OAAM,CAACiN,UAAU,IAAI,EAAE;KACzC,IAAI,CAAC4Z,QAAQ,GAAG,EAAE;KAClB,IAAI,CAACC,OAAO,GAAG,CAAC;KAChB,IAAI,CAACC,YAAY,GAAG,IAAI;KACxB,IAAI,CAACC,YAAY,GAAG,CAAC;KACrB,IAAI,CAACC,OAAO,GAAG,EAAE;KACjB,IAAI,CAACC,YAAY,GAAG,KAAK;;;KAGzB,IAAI,CAACzZ,gBAAgB,GAAGzN,OAAM,CAACyN,gBAAgB,IAAI,CAAC;KACpD,IAAI,CAAC0Z,aAAa,GAAG,IAAI;KACzB,IAAI,CAACC,cAAc,GAAG,IAAI;KAC1B,IAAI,CAACC,gBAAgB,GAAG,KAAK;KAE7B,IAAI,CAAC9lB,QAAQ,GAAG,IAAI,CAAC+lB,kBAAkB,EAAE;KACzC,IAAI,CAACla,QAAQ,GAAG,IAAI,CAACma,kBAAkB,EAAE;KAEzC,IAAIC,cAAc,GAAG,IAAI,CAACC,iBAAiB,CAAC,IAAI,CAAC1H,QAAQ,CAAC;KAC1D,IAAI,CAAC2H,YAAY,GAAGF,cAAc,CAACG,MAAM;KACzC,IAAI,CAAChc,OAAO,GAAG6b,cAAc,CAAC7b,OAAO;KAErC,IAAI,CAACuV,QAAQ,GAAGlhB,OAAM,CAACkhB,QAAQ,IAAI,EAAE;KAErC,IAAI,CAACjhB,cAAI,CAACC,aAAa,CAACF,OAAM,CAAC+C,MAAM,CAAC,EACtC;OACC/C,OAAM,CAAC+C,MAAM,GAAG,EAAE;;KAGnB,IAAI,CAAC9B,SAAS,GAAG;OAChBwL,IAAI,EAAExM,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAAC0J,IAAI,CAAC,GAAGzM,OAAM,CAAC+C,MAAM,CAAC0J,IAAI,GAAG5M,GAAG;OACpE+M,MAAM,EAAE3M,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAAC6J,MAAM,CAAC,GAAG5M,OAAM,CAAC+C,MAAM,CAAC6J,MAAM,GAAG/M,GAAG;OAC1E+L,IAAI,EAAE3L,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAAC6I,IAAI,CAAC,GAAG5L,OAAM,CAAC+C,MAAM,CAAC6I,IAAI,GAAG/L,GAAG;OACpEwM,MAAM,EAAEpM,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAACsJ,MAAM,CAAC,GAAGrM,OAAM,CAAC+C,MAAM,CAACsJ,MAAM,GAAGxM,GAAG;OAC1E+c,QAAQ,EAAE3c,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAAC6Z,QAAQ,CAAC,GAAG5c,OAAM,CAAC+C,MAAM,CAAC6Z,QAAQ,GAAG/c,GAAG;OAChF+nB,gBAAgB,EAAE3nB,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAAC6kB,gBAAgB,CAAC,GAAG5nB,OAAM,CAAC+C,MAAM,CAAC6kB,gBAAgB,GAAG/nB,GAAG;OACxGgoB,MAAM,EAAE5nB,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAAC8kB,MAAM,CAAC,GAAG7nB,OAAM,CAAC+C,MAAM,CAAC8kB,MAAM,GAAGhoB,GAAG;OAC1EioB,IAAI,EAAE7nB,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAAC+kB,IAAI,CAAC,GAAG9nB,OAAM,CAAC+C,MAAM,CAAC+kB,IAAI,GAAGjoB,GAAG;OACpEkoB,MAAM,EAAE9nB,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAACglB,MAAM,CAAC,GAAG/nB,OAAM,CAAC+C,MAAM,CAACglB,MAAM,GAAGloB,GAAG;OAC1EsH,KAAK,EAAElH,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAACoE,KAAK,CAAC,GAAGnH,OAAM,CAAC+C,MAAM,CAACoE,KAAK,GAAGtH,GAAG;OACvE0gB,QAAQ,EAAEtgB,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAACwd,QAAQ,CAAC,GAAGvgB,OAAM,CAAC+C,MAAM,CAACwd,QAAQ,GAAG1gB,GAAG;OAChFmoB,gBAAgB,EAAE/nB,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAACilB,gBAAgB,CAAC,GAAGhoB,OAAM,CAAC+C,MAAM,CAACilB,gBAAgB,GAAGnoB,GAAG;OACxGooB,cAAc,EAAEhoB,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAACklB,cAAc,CAAC,GAAGjoB,OAAM,CAAC+C,MAAM,CAACklB,cAAc,GAAGpoB,GAAG;OAClGqoB,YAAY,EAAEjoB,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAACmlB,YAAY,CAAC,GAAGloB,OAAM,CAAC+C,MAAM,CAACmlB,YAAY,GAAGroB,GAAG;OAC5FsoB,aAAa,EAAEloB,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAAColB,aAAa,CAAC,GAAGnoB,OAAM,CAAC+C,MAAM,CAAColB,aAAa,GAAGtoB,GAAG;OAC/FuoB,oBAAoB,EAAEnoB,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAACqlB,oBAAoB,CAAC,GAAGpoB,OAAM,CAAC+C,MAAM,CAACqlB,oBAAoB,GAAGvoB,GAAG;OACpHwoB,WAAW,EAAEpoB,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAACslB,WAAW,CAAC,GAAGroB,OAAM,CAAC+C,MAAM,CAACslB,WAAW,GAAGxoB,GAAG;OACzFyoB,WAAW,EAAEroB,cAAI,CAACkB,UAAU,CAACnB,OAAM,CAAC+C,MAAM,CAACulB,WAAW,CAAC,GAAGtoB,OAAM,CAAC+C,MAAM,CAACulB,WAAW,GAAGzoB;MACtF;KAED,IAAI,CAACkC,KAAK,GAAG,IAAI;;;KAGjB,IAAI,CAACwmB,sBAAsB,GAAG,IAAI,CAACC,eAAe,CAACvlB,IAAI,CAAC,IAAI,CAAC;KAC7D,IAAI,CAACwlB,kBAAkB,GAAG,IAAI,CAACC,WAAW,CAACzlB,IAAI,CAAC,IAAI,CAAC;KACrD,IAAI,CAAC0lB,yBAAyB,GAAG,IAAI,CAACC,kBAAkB,CAAC3lB,IAAI,CAAC,IAAI,CAAC;KACnE,IAAI,CAAC4lB,yBAAyB,GAAG,IAAI,CAACC,kBAAkB,CAAC7lB,IAAI,CAAC,IAAI,CAAC;KACnE,IAAI,CAAC8lB,6BAA6B,GAAG,IAAI,CAACC,sBAAsB,CAAC/lB,IAAI,CAAC,IAAI,CAAC;KAC3E,IAAI,CAACgmB,qCAAqC,GAAG,IAAI,CAACC,8BAA8B,CAACjmB,IAAI,CAAC,IAAI,CAAC;KAC3F,IAAI,CAACkmB,mCAAmC,GAAG,IAAI,CAACC,4BAA4B,CAACnmB,IAAI,CAAC,IAAI,CAAC;KACvF,IAAI,CAAComB,4BAA4B,GAAG,IAAI,CAACC,qBAAqB,CAACrmB,IAAI,CAAC,IAAI,CAAC;KACzE,IAAI,CAACsmB,2BAA2B,GAAG,IAAI,CAACC,oBAAoB,CAACvmB,IAAI,CAAC,IAAI,CAAC;KACvE,IAAI,CAACwmB,0BAA0B,GAAG,IAAI,CAACC,mBAAmB,CAACzmB,IAAI,CAAC,IAAI,CAAC;KACrE,IAAI,CAAC0mB,6BAA6B,GAAG,IAAI,CAACC,sBAAsB,CAAC3mB,IAAI,CAAC,IAAI,CAAC;KAC3E,IAAI,CAAC4mB,yBAAyB,GAAG,IAAI,CAACxM,kBAAkB,CAACpa,IAAI,CAAC,IAAI,CAAC;KACnE,IAAI,CAAC6mB,2BAA2B,GAAG,IAAI,CAACC,oBAAoB,CAAC9mB,IAAI,CAAC,IAAI,CAAC;KACvE,IAAI,CAAC+mB,yBAAyB,GAAG,IAAI,CAACC,kBAAkB,CAAChnB,IAAI,CAAC,IAAI,CAAC;KACnE,IAAI,CAACinB,2BAA2B,GAAG,IAAI,CAACC,oBAAoB,CAAClnB,IAAI,CAAC,IAAI,CAAC;KACvE,IAAI,CAACmnB,yBAAyB,GAAG,IAAI,CAACC,kBAAkB,CAACpnB,IAAI,CAAC,IAAI,CAAC;KACnE,IAAI,CAACqnB,iCAAiC,GAAG,IAAI,CAACC,0BAA0B,CAACtnB,IAAI,CAAC,IAAI,CAAC;KACnF,IAAI,CAACunB,2BAA2B,GAAG,IAAI,CAACC,oBAAoB,CAACxnB,IAAI,CAAC,IAAI,CAAC;KACvE,IAAI,CAACynB,sBAAsB,GAAG,IAAI,CAACC,eAAe,CAAC1nB,IAAI,CAAC,IAAI,CAAC;;;KAG7D,IAAI,CAAC2nB,UAAU,GAAG,EAAE;KACpB,IAAI,CAACC,cAAc,GAAG,EAAE;KACxB,IAAI,CAACC,YAAY,GAAG,IAAI;;;KAGxB,IAAI,CAAChR,UAAU,GAAG9Z,OAAM,CAAC8Z,UAAU,IAAI,CAAC;KACxC,IAAI,CAAC5F,gBAAgB,GAAGlU,OAAM,CAACkU,gBAAgB,IAAI,IAAI;KACvD,IAAI,CAAC4I,iBAAiB,GAAG9c,OAAM,CAAC8c,iBAAiB,IAAI,IAAI;KACzD,IAAI,CAACiO,YAAY,GAAG,IAAI;KACxB,IAAI,CAACC,aAAa,GAAG,IAAI;KACzB,IAAI,CAACC,aAAa,GAAG,IAAI;KACzB,IAAI,CAACC,gBAAgB,GAAG,IAAI;;;KAG5B,IAAI,CAACxP,SAAS,GAAG1b,OAAM,CAAC0b,SAAS,IAAI,CAAC;KACtC,IAAI,CAACC,cAAc,GAAG3b,OAAM,CAAC2b,cAAc,IAAI,EAAE;KACjD,IAAI,CAACwP,aAAa,GAAG,KAAK;;;KAG1B,IAAI,CAACC,mBAAmB,GAAG,KAAK;KAChC,IAAI,CAACC,oBAAoB,GAAG,KAAK;KACjC,IAAI,CAACC,gBAAgB,GAAG,IAAI;;;KAG5B,IAAI,CAAC5Z,UAAU,GAAG,IAAI;KACtB,IAAI,CAAC5F,KAAK,GAAG9L,OAAM,CAAC8L,KAAK,KAAK,IAAI;KAClC,IAAI,CAACyf,YAAY,GAAGvrB,OAAM,CAACurB,YAAY,KAAK,IAAI;KAChD,IAAI,CAACxf,OAAO,GAAG,IAAI+R,OAAO,CAAC;OAC1BC,mBAAmB,EAAE,IAAI;OACzBC,QAAQ,EAAG,IAAI,CAAClE,UAAU,GAAG,CAAC,GAAG,IAAI,GAAG,IAAI,CAACkE;MAC7C,CAAC;KAEF,IAAI,CAACwN,aAAa,GAAI,IAAI,CAAC1R,UAAU,GAAG,CAAC,GAAGgJ,OAAO,CAAC1C,GAAG,GAAG0C,OAAO,CAACC,MAAO;KAEzE,IAAI,CAAClR,gBAAgB,GAAG7R,OAAM,CAAC6R,gBAAgB;KAC/C,IAAI,CAACA,gBAAgB,CAAC4Z,WAAW,CAAC,IAAI,CAAC;KACvC,IAAI,CAAC5Z,gBAAgB,CAAC6Z,eAAe,CAAC,CAAC,CAAC1rB,OAAM,CAACmK,cAAc,CAAC;KAE9D,IAAI,CAACwhB,UAAU,GAAG3rB,OAAM,CAAC4rB,eAAe,GAAG5rB,OAAM,CAAC4rB,eAAe,CAAC/f,SAAS,EAAE,GAAG7L,OAAM,CAAC6L,SAAS,KAAK,IAAI;KACzG,IAAI,CAAC+f,eAAe,GAAG5rB,OAAM,CAAC4rB,eAAe;KAC7C,IAAI,CAACC,cAAc,GAAG7rB,OAAM,CAAC6rB,cAAc;KAE3C,IAAI,CAACzP,IAAI,EAAE;KAEX,IAAI,IAAI,CAACvK,gBAAgB,CAAChG,SAAS,EAAE,EACrC;OACC,IAAI,CAACgG,gBAAgB,CAACO,0BAA0B,EAAE;;KAEnD,IAAI,CAACP,gBAAgB,CAACC,cAAc,CAACga,mBAAmB,CAAC,IAAI,CAACC,mBAAmB,EAAE,CAAC;KACpF,IAAI,CAACC,WAAW,EAAE,CAACC,IAAI,CAAC,UAAAlf,KAAK;OAAA,OAAI,KAAI,CAACD,QAAQ,CAACC,KAAK,CAAC;OAAC;KACtD,IAAI/M,OAAM,CAAC2D,cAAc,CAAC,SAAS,CAAC,EACpC;OACC,IAAI,CAACqH,UAAU,CAAChL,OAAM,CAAC,SAAS,CAAC,CAAC;;;GAEnC;KAAA;KAAA,qCAGD;OACC,OAAO;SACNksB,IAAI,EAAE,IAAI;SACVnf,KAAK,EAAE,IAAI;SACXK,QAAQ,EAAE;WACToK,MAAM,EAAE,IAAI;WACZtK,KAAK,EAAE,IAAI;WACXif,UAAU,EAAE;UACZ;SACDrQ,MAAM,EAAE,IAAI;SACZ+K,QAAQ,EAAE,IAAI;SACd3Z,KAAK,EAAE,IAAI;SACXsK,MAAM,EAAE,IAAI;SACZ4U,sBAAsB,EAAE,IAAI;SAC5BC,aAAa,EAAE,IAAI;SACnBC,YAAY,EAAE,IAAI;SAClBC,OAAO,EAAE,IAAI;SACbC,mBAAmB,EAAE,IAAI;SACzBL,UAAU,EAAE,EAAE;SACdM,gBAAgB,EAAE,IAAI;SACtBC,wBAAwB,EAAE,IAAI;SAC9BC,mBAAmB,EAAE,IAAI;;SACzBhhB,OAAO,EAAE,EAAE;SACXihB,gBAAgB,EAAE,IAAI;SACtBC,aAAa,EAAE,IAAI;SACnBC,iBAAiB,EAAE,IAAI;SACvBC,IAAI,EAAE;WACLC,QAAQ,EAAE,IAAI;WACdC,OAAO,EAAE,IAAI;WACbC,GAAG,EAAE;UACL;SACDC,QAAQ,EAAE;WACTH,QAAQ,EAAE,IAAI;WACdC,OAAO,EAAE,IAAI;WACbC,GAAG,EAAE;UACL;SACDE,QAAQ,EAAE;QACV;;;KACD;KAAA,qCAGD;OACC,OAAO;SACN5V,MAAM,EAAE;WAACrK,OAAO,EAAE;UAAM;SACxBD,KAAK,EAAE;WAACC,OAAO,EAAE;UAAM;SACvBgf,UAAU,EAAE;WAAChf,OAAO,EAAE;UAAM;SAC5Bkf,aAAa,EAAE;WAAClf,OAAO,EAAE;;QACzB;;;KACD;KAAA,uBAGD;OAAA;OACC,IAAIkR,+BAAU,CAACyH,YAAY,EAAE,IAAI,CAAC,IAAI,CAACha,KAAK,EAC5C;SACCwK,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAEjD,QAAQ,CAACC,IAAI,CAAC;SAC1D,IAAI,CAACxH,OAAO,CAACshB,cAAc,CAAC,EAAE,EAAE,IAAI,EAAE;WACrC5O,KAAK,EAAE,IAAI,CAAC6O,eAAe,EAAE;WAC7BzS,MAAM,EAAE,IAAI,CAAC0S,gBAAgB,EAAE;WAC/BnP,SAAS,EAAG,IAAI,CAACoN,aAAa,IAAI1I,OAAO,CAAC1C,GAAI;WAC9CzB,QAAQ,EAAE,IAAI,CAACpd,QAAQ,CAACqrB,gBAAgB,GAAG,GAAG,GAAG,GAAG;WACpDhO,SAAS,EAAE;UACX,CAAC;SACF,IAAI,CAAC4O,uBAAuB,EAAE;SAE9B1d,MAAM,CAACoB,gBAAgB,CAAC,cAAc,oCAAE,IAAI,mBAAiB,CAAC;SAC9D;;OAGD,IAAI,CAAC3P,QAAQ,CAAC2qB,IAAI,GAAG,IAAI,CAACuB,YAAY,EAAE;OACxC,IAAI,CAACC,UAAU,EAAE;OAEjB,IAAI,IAAI,CAAC7hB,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;SACC1J,QAAQ,CAACC,IAAI,CAAC6a,WAAW,CAAC,IAAI,CAAC3b,QAAQ,CAAC2qB,IAAI,CAAC;SAC7C,IAAI,CAACyB,sBAAsB,EAAE;QAC7B,MACI,IAAI,CAAC,IAAI,CAAC9hB,SAAS,EAAE,IAAI,IAAI,CAAC0B,QAAQ,EAAE,EAC7C;SACCnL,QAAQ,CAACC,IAAI,CAAC6a,WAAW,CAAC,IAAI,CAAC3b,QAAQ,CAAC2qB,IAAI,CAAC;QAC7C,MACI,IAAI,CAAC,IAAI,CAACrgB,SAAS,EAAE,EAC1B;SACC,IAAI,CAAC9J,KAAK,GAAG,IAAI,CAACC,WAAW,EAAE;SAC/ByJ,EAAE,CAAC4E,cAAc,CAACP,MAAM,EAAE,mBAAmB,oCAAE,IAAI,oBAAkB;;OAGtE,IAAI,IAAI,CAACgK,UAAU,GAAG,CAAC,EACvB;SACC,IAAI,IAAI,CAACiR,YAAY,EACrB;WACC,IAAI,CAACA,YAAY,CAAC6C,MAAM,CAAC;aACxBpb,IAAI,EAAE,IAAI,CAACjR,QAAQ,CAAC4rB,QAAQ,CAACH;YAC7B,CAAC;UACF,MAED;WACC,IAAI,CAACjC,YAAY,GAAG,IAAIlX,QAAQ,CAAC;aAChCrB,IAAI,EAAE,IAAI,CAACjR,QAAQ,CAAC4rB,QAAQ,CAACH,QAAQ;aACrC9qB,EAAE,EAAE,IAAI,CAAC4X,UAAU;aACnBtD,QAAQ,EAAE,IAAI,CAACtC,gBAAgB;aAC/BE,SAAS,EAAE,IAAI,CAAC0I,iBAAiB;aACjCF,QAAQ,EAAE,IAAI,CAACA,QAAQ;aACvB/Q,SAAS,EAAE,IAAI,CAACA,SAAS;aACzB4I,cAAc,EAAE,IAAI,CAACoZ,sBAAsB,CAAC5qB,IAAI,CAAC,IAAI;YACrD,CAAC;WAEF,IAAI,CAAC8nB,YAAY,CAAC3O,IAAI,CAAC,YACvB;aACC,IAAI,MAAI,CAACQ,QAAQ,EACjB;eACC,MAAI,CAACgN,sBAAsB,EAAE;;YAE9B,CAAC;WACF,IAAI,CAAC5e,UAAU,CAACN,OAAO,CAAC4W,QAAQ,CAAC;;QAElC,MACI,IAAI,IAAI,CAAClB,GAAG,IAAI,CAAC,IAAI,CAAC7S,QAAQ,EAAE,EACrC;SACC,IAAI,CAACsY,WAAW,CAAC,IAAI,CAACrF,aAAa,EAAE,IAAI,CAACC,WAAW,CAAC;;OAGvDhV,EAAE,CAAC4E,cAAc,CAAC,iBAAiB,EAAE,IAAI,CAACqa,sBAAsB,CAAC;OACjE,IAAI,CAAC,IAAI,CAAC7e,SAAS,EAAE,EACrB;SACCiE,MAAM,CAACoB,gBAAgB,CAAC,cAAc,EAAE,IAAI,CAACqX,sBAAsB,CAAC;;;;KAErE;KAAA,yBAGD;OACC,IAAI,CAAChnB,QAAQ,GAAG,IAAI,CAAC+lB,kBAAkB,EAAE;OAEzC,IAAIwG,aAAa,GAAG,IAAI,CAACjiB,SAAS,EAAE,qCAAG,IAAI,qBAAmB,IAAI,CAAC0c,sBAAsB;OACzFzY,MAAM,CAACqB,mBAAmB,CAAC,cAAc,EAAE2c,aAAa,CAAC;OACzDriB,EAAE,CAACsiB,iBAAiB,CAACje,MAAM,EAAE,mBAAmB,oCAAE,IAAI,oBAAkB;OACxErE,EAAE,CAACsiB,iBAAiB,CAAC,iBAAiB,EAAE,IAAI,CAACrD,sBAAsB,CAAC;OAEpE,IAAI,CAACtO,IAAI,EAAE;;;KACX;KAAA,uBAGD;OACC,IAAI,CAAC,IAAI,CAACra,KAAK,IAAI,IAAI,CAAC8J,SAAS,EAAE,EACnC;SACC;;OAED,IAAI,CAAC,IAAI,CAAC9J,KAAK,EACf;SACC,IAAI,CAAC6rB,MAAM,EAAE;;OAGd,IAAI,CAAC,IAAI,CAAC/hB,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC0B,QAAQ,EAAE,EACzC;SACC,IAAI,CAACygB,qBAAqB,EAAE;;OAG7B,IAAI,CAACjsB,KAAK,CAACwF,IAAI,EAAE;OACjBkE,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,MAAM,CAACC,QAAQ,EAAE,IAAI,CAACpD,MAAM,EAAE,KAAK,CAAC;OAExD,OAAO,IAAI;;;KACX;KAAA,8BAGD;OAAA;OACC,OAAO,IAAIzc,gBAAK,CAAC;SAChBnB,EAAE,EAAE,IAAI,CAAC+rB,KAAK,EAAE;SAChB9tB,WAAW,EAAE,IAAI;SACjBgC,eAAe,EAAEC,QAAQ,CAACC,IAAI;SAC9BI,OAAO,EAAE,IAAI,CAAClB,QAAQ,CAAC2qB,IAAI;SAC3BgC,SAAS,EAAE,KAAK;SAChBvrB,aAAa,EAAE,IAAI;SACnB7B,MAAM,EAAElB,UAAU;SAClBS,UAAU,EAAE,CAAC;SACbD,SAAS,EAAE,CAAC;SACZmC,UAAU,EAAE,KAAK;SACjB4rB,SAAS,EAAE;WAACC,QAAQ,EAAE;UAAM;SAC5BxrB,OAAO,EAAE;WAACC,eAAe,EAAE,OAAO;WAAEC,OAAO,EAAE;UAAG;SAChDC,MAAM,EAAE;WACPC,YAAY,EAAE,wBACd;aACC,IAAI,MAAI,CAACuK,QAAQ,EAAE,EACnB,CAEC,MAED;eACC,MAAI,CAACtM,SAAS,CAACkG,KAAK,EAAE;;YAEvB;WACDG,cAAc,EAAE;aAAA,OAAM,MAAI,CAACvF,KAAK,GAAG,IAAI;;;QAExC,CAAC;;;KACF;KAAA,+BAGD;OACC,IAAI,IAAI,CAACwL,QAAQ,EAAE,EACnB;SACC,OAAO,IAAI,CAAC8gB,kBAAkB,EAAE;QAChC,MACI,IAAI,IAAI,CAAC7C,aAAa,IAAI1I,OAAO,CAAC1C,GAAG,EAC1C;SACC,OAAO,IAAI,CAACkO,eAAe,EAAE;QAC7B,MAED;SACC,OAAO,IAAI,CAACC,kBAAkB,EAAE;;;;KAEjC;KAAA,kCAGD;OAAA;OACC,IAAI5kB,MAAM,GAAG9F,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAC9BC,KAAK,EAAE;WAACC,SAAS,EAAE;UAA0B;SAC7CjB,MAAM,EAAE;WACPia,QAAQ,EAAE,IAAI,CAACyL;UACf;SACDxkB,QAAQ,EAAE,CACT,IAAI,CAAC1C,QAAQ,CAACmrB,wBAAwB,GAAG7oB,aAAG,CAACC,MAAM,CAAC,KAAK,CAAC,EAC1DD,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAACC,SAAS,EAAE,uBAAuB,IAAI,IAAI,CAACwqB,UAAU,EAAE,GAAG,EAAE,GAAG,wCAAwC;YAAE;WACjHvqB,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAACC,SAAS,EAAE,yBAAyB,IAAI,IAAI,CAACwqB,UAAU,EAAE,GAAG,EAAE,GAAG,0CAA0C;cAAE;aACrHvqB,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eACjBC,KAAK,EAAE;iBAACC,SAAS,EAAE;gBAAiC;eAAEC,QAAQ,EAAE,CAC/DJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBACjBC,KAAK,EAAE;mBAACC,SAAS,EAAE;kBAAuB;iBAAEC,QAAQ,EAAE,CACrD,IAAI,CAAC1C,QAAQ,CAACwL,KAAK,GAAGlJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;mBACvCC,KAAK,EAAE;qBAACC,SAAS,EAAE;oBAA2B;mBAC9C6a,IAAI,EAAE,IAAI,CAAC4P,WAAW;kBACtB,CAAC;gBAEH,CAAC;cAEH,CAAC,EACF,IAAI,CAACltB,QAAQ,CAACgrB,OAAO,GAAG1oB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eAACC,KAAK,EAAE;iBAACC,SAAS,EAAE;;cAA0B,CAAC,EACzF,IAAI,CAACzC,QAAQ,CAAC6L,QAAQ,CAACoK,MAAM,GAAG3T,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eACjDC,KAAK,EAAE;iBAACC,SAAS,EAAE;gBAAwB;eAC3CqJ,KAAK,EAAE,IAAI,CAACD,QAAQ,CAACoK,MAAM,CAACrK,OAAO,GAAG,EAAE,GAAG;iBAACG,OAAO,EAAE;gBAAO;eAC5DrJ,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBACjBC,KAAK,EAAE;mBAACC,SAAS,EAAE;kBAAmC;iBAAEC,QAAQ,EAAE,CACjE,IAAI,CAAC1C,QAAQ,CAACiW,MAAM,GAAG3T,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;mBACxCC,KAAK,EAAE;qBAACC,SAAS,EAAE;oBAAwC;mBAC3DoB,IAAI,EAAE,IAAI,CAAC6H;kBACX,CAAC;gBAEH,CAAC;cAEH,CAAC,EACF,IAAI,CAAC1L,QAAQ,CAAC6L,QAAQ,CAACF,KAAK,GAAGrJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eAChDC,KAAK,EAAE;iBAACC,SAAS,EAAE;gBAAwB;eAC3CqJ,KAAK,EAAE,IAAI,CAACD,QAAQ,CAACF,KAAK,CAACC,OAAO,GAAG,EAAE,GAAG;iBAACG,OAAO,EAAE;gBAAO;eAC3DrJ,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBACjBC,KAAK,EAAE;mBAACC,SAAS,EAAE;kBAA6B;iBAAEC,QAAQ,EAAE,CAC3DJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;mBACjBC,KAAK,EAAE;qBAACC,SAAS,EAAE;oBAAkC;mBAAEC,QAAQ,EAAE,CAChE,IAAI,CAAC1C,QAAQ,CAAC2L,KAAK,GAAGrJ,aAAG,CAACC,MAAM,CAAC,MAAM,CAAC;kBAEzC,CAAC;gBAEH,CAAC;cAEH,CAAC,EACF,IAAI,CAACvC,QAAQ,CAAC6qB,sBAAsB,GAAGvoB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eACxDC,KAAK,EAAE;iBAACC,SAAS,EAAE;gBAAwB;eAC3CqJ,KAAK,EAAE,IAAI,CAAC6Z,YAAY,GAAG,EAAE,GAAG;iBAAC5Z,OAAO,EAAE;gBAAO;eACjDrJ,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBACjBC,KAAK,EAAE;mBAACC,SAAS,EAAE;kBAAyB;iBAAEC,QAAQ,EAAE,CACvD,IAAI,CAAC1C,QAAQ,CAAC8qB,aAAa,GAAGxoB,aAAG,CAACC,MAAM,CAAC,UAAU,EAAE;mBACpDC,KAAK,EAAE;qBACNC,SAAS,EAAE,iCAAiC;qBAC5CM,KAAK,EAAE,IAAI,CAAC2iB,OAAO;qBACnB1iB,WAAW,EAAEC,aAAG,CAACC,UAAU,CAAC,mCAAmC;oBAC/D;mBACD1B,MAAM,EAAE;qBACP2rB,QAAQ,EAAE,IAAI,CAACC,iBAAiB,CAAC1rB,IAAI,CAAC,IAAI;;kBAE3C,CAAC;gBAEH,CAAC;cAEH,CAAC,EACF,IAAI,CAAC1B,QAAQ,CAAC6L,QAAQ,CAAC+e,UAAU,GAAGtoB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eACrDC,KAAK,EAAE;iBAACC,SAAS,EAAE;gBAAwB;eAC3CqJ,KAAK,EAAE,IAAI,CAACD,QAAQ,CAAC+e,UAAU,CAAChf,OAAO,GAAG,EAAE,GAAG;iBAACG,OAAO,EAAE;gBAAO;eAChErJ,QAAQ,EAAE,CACT,IAAI,CAAC1C,QAAQ,CAACirB,mBAAmB,GAAG3oB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBAACC,KAAK,EAAE;mBAACC,SAAS,EAAE;;gBAA6B,CAAC;cAEzG,CAAC,EACF,IAAI,CAACzC,QAAQ,CAACkrB,gBAAgB,GAAG5oB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eAACC,KAAK,EAAE;iBAACC,SAAS,EAAE;;cAAmC,CAAC,EAC3G,IAAI,CAACzC,QAAQ,CAACorB,mBAAmB,GAAG9oB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eAACC,KAAK,EAAE;iBAACC,SAAS,EAAE;;cAAuC,CAAC;YAEnH,CAAC;UAEH,CAAC;QAEH,CAAC;OAEF,IAAI,IAAI,CAACwqB,UAAU,EAAE,EACrB;SACC,IAAI,CAACI,mBAAmB,EAAE;SAC1B,IAAI,IAAI,CAACrtB,QAAQ,CAACqrB,gBAAgB,EAClC;WACCjjB,MAAM,CAACuT,WAAW,CAAC,IAAI,CAAC3b,QAAQ,CAACqrB,gBAAgB,CAAC;;SAGnDrmB,UAAU,CAAC;WAAA,OAAM,MAAI,CAACsoB,eAAe,EAAE;YAAE,CAAC,CAAC;;OAG5C,IAAI,IAAI,CAAChjB,SAAS,EAAE,EACpB;SACClC,MAAM,CAAC0D,KAAK,CAAClK,QAAQ,GAAG,OAAO;SAC/BwG,MAAM,CAAC0D,KAAK,CAACyhB,GAAG,GAAG,CAAC;SACpBnlB,MAAM,CAAC0D,KAAK,CAAC8P,MAAM,GAAG,CAAC;SACvBxT,MAAM,CAAC0D,KAAK,CAAC0hB,IAAI,GAAG,CAAC;SACrBplB,MAAM,CAAC0D,KAAK,CAAC2hB,KAAK,GAAG,CAAC;QACtB,MAED;SACCrlB,MAAM,CAAC0D,KAAK,CAACoR,KAAK,GAAG,IAAI,CAAC6O,eAAe,EAAE,GAAG,IAAI;SAClD3jB,MAAM,CAAC0D,KAAK,CAACwN,MAAM,GAAG,IAAI,CAAC0S,gBAAgB,EAAE,GAAG,IAAI;;OAGrD,OAAO5jB,MAAM;;;KACb;;CAGF;CACA;KAFC,6BAIA;OACC,IAAI,IAAI,CAACkC,SAAS,EAAE,IAAI,CAAC,IAAI,CAACE,OAAO,CAACkjB,kBAAkB,CAAC,QAAQ,CAAC,EAClE;SACC,OAAO,IAAI,CAACnV,UAAU,GAAG,CAAC;QAC1B,MAED;SACC,OAAQ,IAAI,CAACA,UAAU,GAAG,CAAC,IAAI,IAAI,CAAC4B,SAAS,GAAG,CAAC,IAAI,IAAI,CAACwF,QAAQ,CAAC3d,MAAM,GAAG,CAAC;;;;KAE9E;KAAA,kCAGD;OACC,IAAM2rB,WAAW,GAAIpf,MAAM,CAACwM,YAAY,GAAI6S,QAAQ,CAACrf,MAAM,CAACwM,YAAY,CAAC8S,OAAO,CAACnM,MAAM,CAACxE,KAAK,CAAC,CAAC,GAAG,CAAC;OAEnG,IAAI,IAAI,CAAC+M,aAAa,IAAI1I,OAAO,CAACC,MAAM,EACxC;SACC,OAAOC,WAAW,CAACD,MAAM,CAACtE,KAAK;QAC/B,MACI,IAAI,IAAI,CAAC+P,UAAU,EAAE,EAC1B;SACC,IAAIU,WAAW,GAAG,CAAC,EACnB;WACC,OAAOA,WAAW;UAClB,MAED;WACC,OAAOvX,IAAI,CAACC,GAAG,CAACD,IAAI,CAAC0X,KAAK,CAACC,MAAM,CAAC7Q,KAAK,GAAG,GAAG,CAAC,EAAE,IAAI,CAAC;;QAEtD,MAED;SACC,OAAOuE,WAAW,CAAC5C,GAAG,CAAC3B,KAAK;;;;KAE7B;KAAA,mCAGD;OACC,IAAM8Q,YAAY,GAAIzf,MAAM,CAACwM,YAAY,GAAI6S,QAAQ,CAACrf,MAAM,CAACwM,YAAY,CAAC8S,OAAO,CAACnM,MAAM,CAACpI,MAAM,CAAC,CAAC,GAAG,CAAC;OAErG,IAAI,IAAI,CAAC2Q,aAAa,IAAI1I,OAAO,CAACC,MAAM,EACxC;SACC,OAAOC,WAAW,CAACD,MAAM,CAAClI,MAAM;QAChC,MACI,IAAI0U,YAAY,GAAG,CAAC,EACzB;SACC,OAAOA,YAAY;QACnB,MAED;SACC,OAAOvM,WAAW,CAAC5C,GAAG,CAACvF,MAAM;;;;KAE9B;KAAA,gCAEe4D,KAAK,EAAE5D,MAAM,EAC7B;OACC,IAAI,CAAC/K,MAAM,CAACwM,YAAY,EACxB;SACC,OAAO,KAAK;;OAGb,IAAI,IAAI,CAACkP,aAAa,IAAI1I,OAAO,CAAC1C,GAAG,EACrC;SACCtQ,MAAM,CAACwM,YAAY,CAACkT,OAAO,CAACvM,MAAM,CAACpI,MAAM,EAAEA,MAAM,CAACP,QAAQ,EAAE,CAAC;SAC7D,IAAI,IAAI,CAACkU,UAAU,EAAE,EACrB;WACC1e,MAAM,CAACwM,YAAY,CAACkT,OAAO,CAACvM,MAAM,CAACxE,KAAK,EAAEA,KAAK,CAAC;;;;;KAGlD;KAAA,6BAEYrR,QAAQ,EACrB;OAAA;OACC,IAAI,CAACnN,cAAI,CAAC0G,OAAO,CAACyG,QAAQ,CAAC,EAC3B;SACC;;OAGDA,QAAQ,CAACxG,OAAO,CAAC,UAAC6oB,WAAW,EAC7B;SACC,IAAI,MAAI,CAACluB,QAAQ,CAAC6L,QAAQ,CAACqiB,WAAW,CAAC,EACvC;WACC,MAAI,CAACluB,QAAQ,CAAC6L,QAAQ,CAACqiB,WAAW,CAAC,CAACpiB,KAAK,CAAC4N,cAAc,CAAC,SAAS,CAAC;;SAGpE,IAAI,MAAI,CAAC7N,QAAQ,CAACqiB,WAAW,CAAC,EAC9B;WACC,MAAI,CAACriB,QAAQ,CAACqiB,WAAW,CAAC,CAACtiB,OAAO,GAAG,IAAI;;QAE1C,CAAC;;;KACF;KAAA,6BAEYC,QAAQ,EACrB;OAAA;OACC,IAAI,CAACnN,cAAI,CAAC0G,OAAO,CAACyG,QAAQ,CAAC,EAC3B;SACC;;OAGDA,QAAQ,CAACxG,OAAO,CAAC,UAAC6oB,WAAW,EAC7B;SACC,IAAI,MAAI,CAACluB,QAAQ,CAAC6L,QAAQ,CAACqiB,WAAW,CAAC,EACvC;WACC,MAAI,CAACluB,QAAQ,CAAC6L,QAAQ,CAACqiB,WAAW,CAAC,CAACpiB,KAAK,CAACC,OAAO,GAAG,MAAM;;SAG3D,IAAI,MAAI,CAACF,QAAQ,CAACqiB,WAAW,CAAC,EAC9B;WACC,MAAI,CAACriB,QAAQ,CAACqiB,WAAW,CAAC,CAACtiB,OAAO,GAAG,KAAK;;QAE3C,CAAC;;;KACF;KAAA,iCAEgBC,QAAQ,EACzB;OACC,IAAI,CAACnN,cAAI,CAAC0G,OAAO,CAACyG,QAAQ,CAAC,EAC3B;SACC;;OAGD,IAAIsiB,aAAa,GAAG,EAAE;OACtBtiB,QAAQ,CAACxG,OAAO,CAAC,UAAA6oB,WAAW;SAAA,OAAIC,aAAa,CAACD,WAAW,CAAC,GAAG,IAAI;SAAC;OAElE,KAAK,IAAIA,WAAW,IAAI,IAAI,CAACluB,QAAQ,CAAC6L,QAAQ,EAC9C;SACC,IAAI,CAAC,IAAI,CAAC7L,QAAQ,CAAC6L,QAAQ,CAACzJ,cAAc,CAAC8rB,WAAW,CAAC,IAAI,CAACxvB,cAAI,CAACkV,SAAS,CAAC,IAAI,CAAC5T,QAAQ,CAAC6L,QAAQ,CAACqiB,WAAW,CAAC,CAAC,EAC/G;WACC;;SAGD,IAAIC,aAAa,CAACD,WAAW,CAAC,EAC9B;WACC,IAAI,CAACluB,QAAQ,CAAC6L,QAAQ,CAACqiB,WAAW,CAAC,CAACpiB,KAAK,CAAC4N,cAAc,CAAC,SAAS,CAAC;WACnE,IAAI,IAAI,CAAC7N,QAAQ,CAACzJ,cAAc,CAAC8rB,WAAW,CAAC,EAC7C;aACC,IAAI,CAACriB,QAAQ,CAACqiB,WAAW,CAAC,CAACtiB,OAAO,GAAG,IAAI;;UAE1C,MAED;WACC,IAAI,CAAC5L,QAAQ,CAAC6L,QAAQ,CAACqiB,WAAW,CAAC,CAACpiB,KAAK,CAACC,OAAO,GAAG,MAAM;WAC1D,IAAI,IAAI,CAACF,QAAQ,CAACzJ,cAAc,CAAC8rB,WAAW,CAAC,EAC7C;aACC,IAAI,CAACriB,QAAQ,CAACqiB,WAAW,CAAC,CAACtiB,OAAO,GAAG,KAAK;;;;;;KAI7C;KAAA,sCAGD;OAAA;OACC,IAAI4f,IAAI,GAAG,EAAE;OACb,IAAII,QAAQ,GAAG,EAAE;OAEjB,IAAI,IAAI,CAACrT,UAAU,GAAG,CAAC,EACvB;SACC,IAAI,CAACvY,QAAQ,CAACwrB,IAAI,CAACC,QAAQ,GAAGnpB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WAChDC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAuB;WAC1C+D,OAAO,EAAE;aAAC4nB,KAAK,EAAE,UAAU;aAAEC,SAAS,EAAE;YAAW;WACnDxqB,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;WAC1D1B,MAAM,EAAE;aAACmB,KAAK,EAAE,IAAI,CAAC2rB,iBAAiB,CAAC5sB,IAAI,CAAC,IAAI;;UAChD,CAAC;SACF8pB,IAAI,CAACjmB,IAAI,CAAC,IAAI,CAACvF,QAAQ,CAACwrB,IAAI,CAACC,QAAQ,CAAC;SACtC,IAAI,CAACzrB,QAAQ,CAAC4rB,QAAQ,CAACH,QAAQ,GAAGnpB,aAAG,CAACC,MAAM,CAAC,KAAK,CAAC;SACnDqpB,QAAQ,CAACrmB,IAAI,CAAC,IAAI,CAACvF,QAAQ,CAAC4rB,QAAQ,CAACH,QAAQ,CAAC;;OAG/C,IAAI,IAAI,CAACtR,SAAS,GAAG,CAAC,IAAI,IAAI,CAACoU,kBAAkB,EAAE,EACnD;SACC,IAAI,CAACvuB,QAAQ,CAACwrB,IAAI,CAACE,OAAO,GAAGppB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WAC/CC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAuB;WAC1C+D,OAAO,EAAE;aAAC4nB,KAAK,EAAE,SAAS;aAAEC,SAAS,EAAE;YAAU;WACjDxqB,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,kCAAkC,CAAC;WACxD1B,MAAM,EAAE;aAACmB,KAAK,EAAE,IAAI,CAAC2rB,iBAAiB,CAAC5sB,IAAI,CAAC,IAAI;;UAChD,CAAC;SACF8pB,IAAI,CAACjmB,IAAI,CAAC,IAAI,CAACvF,QAAQ,CAACwrB,IAAI,CAACE,OAAO,CAAC;SACrC,IAAI,CAAC1rB,QAAQ,CAAC4rB,QAAQ,CAACF,OAAO,GAAGppB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAACC,KAAK,EAAE;aAACC,SAAS,EAAE;;UAAgC,CAAC;SACxGmpB,QAAQ,CAACrmB,IAAI,CAAC,IAAI,CAACvF,QAAQ,CAAC4rB,QAAQ,CAACF,OAAO,CAAC;SAE7C,IAAI,CAAC8C,WAAW,GAAG,IAAIxd,WAAW,CAAC;WAClCC,IAAI,EAAE,IAAI,CAACjR,QAAQ,CAAC4rB,QAAQ,CAACF,OAAO;WACpCra,UAAU,EAAE,IAAI,CAACod,WAAW,CAAC/sB,IAAI,CAAC,IAAI;UACtC,CAAC;;OAGH,IAAI,IAAI,CAACie,QAAQ,CAAC3d,MAAM,GAAG,CAAC,IAAI,IAAI,CAAC0sB,mBAAmB,EAAE,EAC1D;SACC,IAAI,CAAC/O,QAAQ,CAACta,OAAO,CAAC,UAACspB,OAAO,EAC9B;WACC,IAAMC,SAAS,GAAGD,OAAO,CAAChuB,EAAE;WAC5B,IAAMytB,KAAK,GAAG,SAAS,GAAGQ,SAAS;WACnC,MAAI,CAAC5uB,QAAQ,CAACwrB,IAAI,CAAC4C,KAAK,CAAC,GAAG9rB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;aAC9CC,KAAK,EAAE;eAACC,SAAS,EAAE;cAAuB;aAC1C+D,OAAO,EAAE;eAAC4nB,KAAK,EAAEA,KAAK;eAAEC,SAAS,EAAE,KAAK;eAAEO,SAAS,EAAEA;cAAU;aAC/D/qB,IAAI,EAAE2B,cAAI,CAACC,MAAM,CAACkpB,OAAO,CAAClmB,IAAI,CAAC;aAC/BjH,MAAM,EAAE;eAACmB,KAAK,EAAE,MAAI,CAAC2rB,iBAAiB,CAAC5sB,IAAI,CAAC,MAAI;;YAChD,CAAC;WACF8pB,IAAI,CAACjmB,IAAI,CAAC,MAAI,CAACvF,QAAQ,CAACwrB,IAAI,CAAC4C,KAAK,CAAC,CAAC;UAEpC,CAAC;SACF,IAAI,CAACpuB,QAAQ,CAAC4rB,QAAQ,CAACD,GAAG,GAAGrpB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAACC,KAAK,EAAE;aAACC,SAAS,EAAE;;UAA+B,CAAC;SACnGmpB,QAAQ,CAACrmB,IAAI,CAAC,IAAI,CAACvF,QAAQ,CAAC4rB,QAAQ,CAACD,GAAG,CAAC;;OAG1C,IAAI,CAAC3rB,QAAQ,CAACqrB,gBAAgB,GAAG/oB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAClDC,KAAK,EAAE;WAACC,SAAS,EAAE;UAAwB;SAAEC,QAAQ,EAAE,CACtDJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAkC;WAAEC,QAAQ,EAAE,CAChE,IAAI,CAAC1C,QAAQ,CAACsrB,aAAa,GAAGhpB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aAC/CC,KAAK,EAAE;eAACC,SAAS,EAAE;cAA6B;aAChDC,QAAQ,EAAE8oB;YACV,CAAC,EACFlpB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAACC,SAAS,EAAE;cAA8B;aAAEC,QAAQ,EAAE,CAC5D,IAAI,CAAC1C,QAAQ,CAAC6rB,QAAQ,GAAGvpB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;eAC3CC,KAAK,EAAE;iBAACC,SAAS,EAAE;gBAAiD;eACpEqJ,KAAK,EAAE;iBAACC,OAAO,EAAE;gBAAO;eACxBvF,OAAO,EAAE,EAAE;eACX3C,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC;eAC/C1B,MAAM,EAAE;iBAACmB,KAAK,EAAE,IAAI,CAACksB,eAAe,CAACntB,IAAI,CAAC,IAAI;;cAC9C,CAAC;YAEH,CAAC;UAEH,CAAC,EACF,IAAI,CAAC1B,QAAQ,CAACurB,iBAAiB,GAAGjpB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACnDC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAuC;WAC1DC,QAAQ,EAAEkpB;UACV,CAAC;QAEH,CAAC;OAEF,IAAI,IAAI,CAACrT,UAAU,GAAG,CAAC,EACvB;SACC,IAAI,CAACuW,YAAY,CAAC;WAACV,KAAK,EAAE,UAAU;WAAEC,SAAS,EAAE;UAAW,CAAC;QAC7D,MACI,IAAI,IAAI,CAAClU,SAAS,GAAG,CAAC,IAAI,IAAI,CAACoU,kBAAkB,EAAE,EACxD;SACC,IAAI,CAACO,YAAY,CAAC;WAACV,KAAK,EAAE,SAAS;WAAEC,SAAS,EAAE;UAAU,CAAC;QAC3D,MACI,IAAI,IAAI,CAAC1O,QAAQ,CAAC3d,MAAM,GAAG,CAAC,IAAI,IAAI,CAAC0sB,mBAAmB,EAAE,EAC/D;SACC,IAAI,CAACI,YAAY,CAAC;WACjBV,KAAK,EAAE,SAAS,GAAG,IAAI,CAACzO,QAAQ,CAAC,CAAC,CAAC,CAAChf,EAAE;WACtC0tB,SAAS,EAAE,KAAK;WAChBO,SAAS,EAAE,IAAI,CAACjP,QAAQ,CAAC,CAAC,CAAC,CAAChf;UAC5B,CAAC;;;;KAEH;KAAA,qCAGD;OACC,IAAIouB,mBAAmB,GAAG,EAAE;OAC5B,IAAI,IAAI,CAACC,YAAY,EAAE,IACnB,IAAI,CAACvP,cAAc,CAACwP,OAAO,IAC3B,IAAI,CAACxP,cAAc,CAACwP,OAAO,CAAC,IAAI,CAACvP,gBAAgB,CAAC,IAClD,IAAI,CAACD,cAAc,CAACwP,OAAO,CAAC,IAAI,CAACvP,gBAAgB,CAAC,IAAIoE,WAAW,EAErE;SACCiL,mBAAmB,GAAG,IAAI,CAACtP,cAAc,CAACwP,OAAO,CAAC,IAAI,CAACvP,gBAAgB,CAAC;;OAEzE,IAAItX,MAAM,GAAG9F,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SAC9BC,KAAK,EAAE;WAACC,SAAS,EAAE;UAAwB;SAAEC,QAAQ,EAAE,CACtDJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAACC,SAAS,EAAE;YAA0B;WAAEC,QAAQ,EAAE,CACxDJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAACC,SAAS,EAAE;cAA2B;aAAEC,QAAQ,EAAE,CACzD,IAAI,CAAC1C,QAAQ,CAACwL,KAAK,GAAGlJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eAACC,KAAK,EAAE;iBAACC,SAAS,EAAE;;cAAyB,CAAC;YAEvF,CAAC,EACFH,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAACC,SAAS,EAAE;cAA0D;aAAEC,QAAQ,EAAE,CACxFJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eACjBC,KAAK,EAAE;iBAACC,SAAS,EAAE;gBAAsC;eAAEC,QAAQ,EAAE,CACpEJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBACjBC,KAAK,EAAE;mBAACC,SAAS,EAAE;kBAA8C;iBACjEC,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;mBAACC,KAAK,EAAE;qBAACC,SAAS,EAAE;;kBAAmC,CAAC;gBAE3E,CAAC,EACF,IAAI,CAACzC,QAAQ,CAACslB,QAAQ,GAAGhjB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBAACC,KAAK,EAAE;mBAACC,SAAS,EAAE;;gBAA+C,CAAC,EAC/GH,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBACjBC,KAAK,EAAE;mBAACC,SAAS,EAAE;kBAA8C;iBACjEC,QAAQ,EAAE,CACT,IAAI,CAAC1C,QAAQ,CAACua,MAAM,GAAGjY,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;mBACxCC,KAAK,EAAE;qBAACC,SAAS,EAAE;oBAAqC;mBACxDqJ,KAAK,EAAEpN,cAAI,CAAC2f,cAAc,CAAC0Q,mBAAmB,CAAC,GAAG;qBAAC,kBAAkB,EAAE,QAAQ,GAAGA,mBAAmB,GAAG;oBAAM,GAAG;kBACjH,CAAC;gBAEH,CAAC;cAEH,CAAC;YAEH,CAAC,EACFzsB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAACC,SAAS,EAAE;cAAwB;aAAEC,QAAQ,EAAE,CACtD,IAAI,CAAC1C,QAAQ,CAACiW,MAAM,GAAG3T,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eAACC,KAAK,EAAE;iBAACC,SAAS,EAAE;;cAAmC,CAAC;YAElG,CAAC,EACF,IAAI,CAACzC,QAAQ,CAACkrB,gBAAgB,GAAG5oB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aAACC,KAAK,EAAE;eAACC,SAAS,EAAE;;YAAmC,CAAC,EAC3G,IAAI,CAACzC,QAAQ,CAACorB,mBAAmB,GAAG9oB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aAACC,KAAK,EAAE;eAACC,SAAS,EAAE;;YAAuC,CAAC;UAEnH,CAAC;QAEH,CAAC;OAEF2F,MAAM,CAAC0D,KAAK,CAACoR,KAAK,GAAG,IAAI,CAAC6O,eAAe,EAAE,GAAG,IAAI;OAClD3jB,MAAM,CAAC0D,KAAK,CAACwN,MAAM,GAAG,IAAI,CAAC0S,gBAAgB,EAAE,GAAG,IAAI;OAEpD,OAAO5jB,MAAM;;;KACb;KAAA,qCAGD;OAAA;OACC,OAAO9F,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;SACxBC,KAAK,EAAE;WAACC,SAAS,EAAE;UAA2B;SAC9CqJ,KAAK,EAAE;WAACvM,MAAM,EAAElB;UAAW;SAC3BqE,QAAQ,EAAE,CACT,IAAI,CAAC1C,QAAQ,CAAC6L,QAAQ,CAACF,KAAK,GAAG,IAAI,CAAC3L,QAAQ,CAAC2L,KAAK,GAAGrJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACtEC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAgC;WACnDqJ,KAAK,EAAE,IAAI,CAACD,QAAQ,CAACF,KAAK,CAACC,OAAO,GAAG,EAAE,GAAG;aAACG,OAAO,EAAE;;UACpD,CAAC,EACF,IAAI,CAAC/L,QAAQ,CAACkrB,gBAAgB,GAAG5oB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAACC,KAAK,EAAE;aAACC,SAAS,EAAE;;UAAoC,CAAC,EAC5GH,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WACjBC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAkC;WACrDjB,MAAM,EAAE;aAACmB,KAAK,EAAE;eAAA,OAAM,MAAI,CAACwZ,MAAM,EAAE;;;UACnC,CAAC;QAEH,CAAC;;;KACF;KAAA,6BAEY1d,MAAM,EACnB;OACC,IAAM2vB,KAAK,GAAG3vB,MAAM,CAAC2vB,KAAK;OAC1B,IAAMC,SAAS,GAAG5vB,MAAM,CAAC4vB,SAAS;OAClC,IAAMO,SAAS,GAAGnwB,MAAM,CAACmwB,SAAS,IAAI,EAAE;OACxCnwB,MAAM,CAACywB,MAAM,GAAGzwB,MAAM,CAACywB,MAAM,KAAK,IAAI;OACtC,KAAK,IAAIC,GAAG,IAAI,IAAI,CAACnvB,QAAQ,CAACwrB,IAAI,EAClC;SACC,IAAI,IAAI,CAACxrB,QAAQ,CAACwrB,IAAI,CAACppB,cAAc,CAAC+sB,GAAG,CAAC,IAAIzwB,cAAI,CAACkV,SAAS,CAAC,IAAI,CAAC5T,QAAQ,CAACwrB,IAAI,CAAC2D,GAAG,CAAC,CAAC,EACrF;WACC,IAAI,CAACnvB,QAAQ,CAACwrB,IAAI,CAAC2D,GAAG,CAAC,CAACvqB,SAAS,CAACC,MAAM,CAAC,6BAA6B,EAAEsqB,GAAG,IAAIf,KAAK,CAAC;;;OAIvF,IAAI,CAACpuB,QAAQ,CAAC6rB,QAAQ,CAACjnB,SAAS,CAACC,MAAM,CAAC,6BAA6B,EAAEpG,MAAM,CAACywB,MAAM,CAAC;OAErF,KAAK,IAAIC,IAAG,IAAI,IAAI,CAACnvB,QAAQ,CAAC4rB,QAAQ,EACtC;SACC,IAAI,IAAI,CAAC5rB,QAAQ,CAAC4rB,QAAQ,CAACxpB,cAAc,CAAC+sB,IAAG,CAAC,IAAIzwB,cAAI,CAACkV,SAAS,CAAC,IAAI,CAAC5T,QAAQ,CAAC4rB,QAAQ,CAACuD,IAAG,CAAC,CAAC,EAC7F;WACC,IAAIA,IAAG,IAAId,SAAS,EACpB;aACC,IAAI,CAACruB,QAAQ,CAAC4rB,QAAQ,CAACuD,IAAG,CAAC,CAACrjB,KAAK,CAAC4N,cAAc,CAAC,SAAS,CAAC;YAC3D,MAED;aACC,IAAI,CAAC1Z,QAAQ,CAAC4rB,QAAQ,CAACuD,IAAG,CAAC,CAACrjB,KAAK,CAACC,OAAO,GAAG,MAAM;;;;OAKrD,IAAI,CAACud,cAAc,GAAG8E,KAAK;OAE3B,IAAIA,KAAK,KAAK,SAAS,IAAI,CAAC,IAAI,CAACxE,aAAa,EAC9C;SACC,IAAI,CAACwF,QAAQ,CAAC;WACbzuB,EAAE,EAAE,IAAI,CAACwZ,SAAS;WAClBvI,OAAO,EAAE,IAAI,CAACwI;UACd,CAAC;;OAGH,IAAIwU,SAAS,KAAK,EAAE,EACpB;SACC,IAAI,CAACS,WAAW,CAAC;WAChB1uB,EAAE,EAAEiuB,SAAS;WACbrQ,MAAM,EAAE,IAAI,CAACA,MAAM;WACnBtN,IAAI,EAAE,IAAI,CAACjR,QAAQ,CAAC4rB,QAAQ,CAACD;UAC7B,CAAC;;;;KAEH;KAAA,qCAGD;OACC,IAAIvjB,MAAM,GAAG,KAAK;OAClB,KAAK,IAAIoH,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAAC6Z,UAAU,CAACrnB,MAAM,EAAEwN,CAAC,EAAE,EAC/C;SACC,IAAI,IAAI,CAAC6Z,UAAU,CAAC7Z,CAAC,CAAC,CAAChJ,OAAO,CAAC4nB,KAAK,IAAI,IAAI,CAAC9E,cAAc,EAC3D;WACClhB,MAAM,GAAG,IAAI;WACb;;;OAGF,OAAOA,MAAM;;;KACb;KAAA,kCAGD;OACC,IAAI,CAAC,IAAI,CAACpI,QAAQ,CAACsrB,aAAa,EAChC;SACC;;OAGD,IAAIE,IAAI,GAAG,IAAI,CAACxrB,QAAQ,CAACsrB,aAAa,CAAC5oB,QAAQ;OAC/C,IAAI4sB,UAAU;OACd,IAAI,CAACjG,UAAU,GAAG,EAAE;OAEpB,KAAK,IAAI7Z,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgc,IAAI,CAACxpB,MAAM,EAAEwN,CAAC,EAAE,EACpC;SACC8f,UAAU,GAAG9D,IAAI,CAAC7W,IAAI,CAACnF,CAAC,CAAC;SACzB,IAAI8f,UAAU,CAACzwB,SAAS,GAAG,CAAC,EAC5B;WACC,IAAI,CAACwqB,UAAU,CAAC9jB,IAAI,CAAC+pB,UAAU,CAAC;;;OAGlC,IAAI,IAAI,CAACjG,UAAU,CAACrnB,MAAM,GAAG,CAAC,EAC9B;SACC,IAAI,CAAChC,QAAQ,CAAC6rB,QAAQ,CAAC/f,KAAK,CAAC4N,cAAc,CAAC,SAAS,CAAC;QACtD,MAED;SACC,IAAI,CAAC1Z,QAAQ,CAAC6rB,QAAQ,CAAC/f,KAAK,CAACC,OAAO,GAAG,MAAM;;OAG9C,IAAI,IAAI,CAACwjB,kBAAkB,EAAE,EAC7B;SACCjtB,aAAG,CAAC6H,QAAQ,CAAC,IAAI,CAACnK,QAAQ,CAAC6rB,QAAQ,EAAE,6BAA6B,CAAC;QACnE,MAED;SACCvpB,aAAG,CAACsI,WAAW,CAAC,IAAI,CAAC5K,QAAQ,CAAC6rB,QAAQ,EAAE,6BAA6B,CAAC;;;;KAEvE;KAAA,kCAEiB3nB,CAAC,EACnB;OACC,IAAI,IAAI,CAACqlB,YAAY,EACrB;SACC,IAAI,CAACA,YAAY,CAAC3jB,KAAK,EAAE;;OAG1B,IAAI,CAACkpB,YAAY,CAAC;SACjBV,KAAK,EAAElqB,CAAC,CAAC+S,MAAM,CAACzQ,OAAO,CAAC4nB,KAAK;SAC7BC,SAAS,EAAEnqB,CAAC,CAAC+S,MAAM,CAACzQ,OAAO,CAAC6nB,SAAS;SACrCO,SAAS,EAAE1qB,CAAC,CAAC+S,MAAM,CAACzQ,OAAO,CAACooB,SAAS,IAAI,EAAE;SAC3CM,MAAM,EAAE;QACR,CAAC;;;KACF;KAAA,kCAGD;OAAA;OACC,IAAI,IAAI,CAAC7F,UAAU,CAACrnB,MAAM,KAAK,CAAC,EAChC;SACC;;OAGD,IAAI,IAAI,CAACunB,YAAY,EACrB;SACC,IAAI,CAACA,YAAY,CAAC3jB,KAAK,EAAE;SACzB;;OAGD,IAAIT,SAAS,GAAG,EAAE;OAClB,IAAI,CAACkkB,UAAU,CAAChkB,OAAO,CAAC,UAACmqB,UAAU,EACnC;SACCrqB,SAAS,CAACI,IAAI,CAAC;WACd5E,EAAE,EAAE,YAAY,GAAG6uB,UAAU,CAAChpB,OAAO,CAAC4nB,KAAK;WAC3CvqB,IAAI,EAAE2rB,UAAU,CAACttB,SAAS;WAC1BwD,OAAO,EAAE,mBACT;aACC,MAAI,CAAC6jB,YAAY,CAAC3jB,KAAK,EAAE;aACzB,MAAI,CAACkpB,YAAY,CAAC;eACjBV,KAAK,EAAEoB,UAAU,CAAChpB,OAAO,CAAC4nB,KAAK;eAC/BC,SAAS,EAAEmB,UAAU,CAAChpB,OAAO,CAAC6nB,SAAS;eACvCO,SAAS,EAAEY,UAAU,CAAChpB,OAAO,CAACooB,SAAS,IAAI,EAAE;eAC7CM,MAAM,EAAE;cACR,CAAC;;UAEH,CAAC;QACF,CAAC;OAEF,IAAI,CAAC3F,YAAY,GAAG,IAAI1jB,eAAI,CAC3B,uBAAuB,EACvB,IAAI,CAAC7F,QAAQ,CAAC6rB,QAAQ,EACtB1mB,SAAS,EACT;SACClE,QAAQ,EAAE,IAAI;SACdpC,SAAS,EAAE,CAAC;SACZC,UAAU,EAAE,CAAC;SACb6C,KAAK,EAAE;WAACC,QAAQ,EAAE;UAAM;SACxBrC,MAAM,EAAElB,UAAU,GAAG,GAAG;SACxBmD,MAAM,EAAE;WACPC,YAAY,EAAE;aAAA,OAAM,MAAI,CAAC8nB,YAAY,CAACxnB,OAAO,EAAE;;WAC/CgE,cAAc,EAAE;aAAA,OAAM,MAAI,CAACwjB,YAAY,GAAG,IAAI;;;QAE/C,CACD;OACD,IAAI,CAACA,YAAY,CAACvjB,IAAI,EAAE;;;KACxB;KAAA,wBAGD;OACC,OAAO,IAAI,CAACrF,EAAE;;;KACd;KAAA,8BAGD;OAAA;OACC,IAAI8uB,SAAS,GAAG,EAAE;OAElB,OAAO,IAAIC,OAAO,CAAC,UAACC,OAAO,EAC3B;SACCzlB,EAAE,CAAC0lB,iBAAiB,CAACC,WAAW,EAAE,CAACC,KAAK,CAAC,OAAI,CAAC1rB,WAAW,CAAC,CAACsmB,IAAI,CAAC,UAACqF,YAAY,EAC7E;WACC,IAAI,OAAI,CAAC3rB,WAAW,IAAI,SAAS,EACjC;aACCurB,OAAO,CAAC1sB,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC,CAAC;aAC5D;;WAED,IAAI,OAAI,CAACkB,WAAW,IAAI,QAAQ,EAChC;aACCqrB,SAAS,GAAGxsB,aAAG,CAACC,UAAU,CAAC,wBAAwB,CAAC;YACpD,MAED;aACCusB,SAAS,GAAG,OAAI,CAACrrB,WAAW,CAAC2U,QAAQ,EAAE;aAEvC,IAAIgX,YAAY,CAACC,OAAO,EAAE,EAC1B;eACCP,SAAS,GAAGM,YAAY,CAACE,MAAM,EAAE;eAEjC,IAAIF,YAAY,CAACG,eAAe,EAAE,IAAIT,SAAS,CAACU,MAAM,CAAC,CAAC,CAAC,IAAI,GAAG,EAChE;iBACCV,SAAS,GAAG,GAAG,GAAGA,SAAS;;cAE5B,MAED;eACCA,SAAS,GAAG,OAAI,CAACrrB,WAAW,CAAC2U,QAAQ,EAAE;;;WAIzC,IAAI,OAAI,CAACqX,UAAU,EAAE,EACrB;aACCX,SAAS,GAAGxsB,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC,CAACsT,OAAO,CAAC,SAAS,EAAEiZ,SAAS,CAAC;YAChF,MACI,IAAI,OAAI,CAACT,YAAY,EAAE,EAC5B;aACC,QAAQ,OAAI,CAACtQ,SAAS;eAErB,KAAKmB,SAAS,CAACC,QAAQ;iBACtB,IAAI,OAAI,CAACJ,gBAAgB,EACzB;mBACC+P,SAAS,GAAGxsB,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC,CAACsT,OAAO,CAAC,QAAQ,EAAE,OAAI,CAACiJ,cAAc,CAAC4Q,KAAK,CAAC,OAAI,CAAC3Q,gBAAgB,CAAC,CAACjX,IAAI,CAAC;;iBAE5H;eACD,KAAKoX,SAAS,CAACE,QAAQ;iBACtB,IAAI,OAAI,CAACL,gBAAgB,EACzB;mBACC+P,SAAS,GAAGxsB,aAAG,CAACC,UAAU,CAAC,oBAAoB,CAAC,CAACsT,OAAO,CAAC,QAAQ,EAAE,OAAI,CAACiJ,cAAc,CAAC4Q,KAAK,CAAC,OAAI,CAAC3Q,gBAAgB,CAAC,CAACjX,IAAI,CAAC;kBACzH,MAED;mBACCgnB,SAAS,GAAGxsB,aAAG,CAACC,UAAU,CAAC,oBAAoB,CAAC,CAACsT,OAAO,CAAC,QAAQ,EAAE,OAAI,CAACyO,mBAAmB,CAAC,GAAG,IAAI,GAAG,OAAI,CAAC7gB,WAAW,GAAG,GAAG;;iBAE7H;;YAEF,MAED;aACCqrB,SAAS,GAAGxsB,aAAG,CAACC,UAAU,CAAC,OAAI,CAACwb,SAAS,KAAKmB,SAAS,CAACC,QAAQ,GAAG,0BAA0B,GAAG,wBAAwB,CAAC,CAACtJ,OAAO,CAAC,SAAS,EAAEiZ,SAAS,CAAC;aAEvJ,IAAI,OAAI,CAAC/Q,SAAS,KAAKmB,SAAS,CAACC,QAAQ,IAAI,OAAI,CAACrB,kBAAkB,EACpE;eACCgR,SAAS,GAAGA,SAAS,GAAG,IAAI,GAAGxsB,aAAG,CAACC,UAAU,CAAC,wBAAwB,CAAC,CAACsT,OAAO,CAAC,SAAS,EAAE,OAAI,CAACiI,kBAAkB,CAAC;;aAGpH,IAAI,OAAI,CAAC6R,UAAU,EAAE,EACrB;eACCb,SAAS,GAAGA,SAAS,GAAG,GAAG,GAAGxsB,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC;;;WAI1EysB,OAAO,CAACF,SAAS,CAAC;UAClB,CAAC;QACF,CAAC;;;KACF;KAAA,8BAGD;OACC,OAAOjqB,cAAI,CAACC,MAAM,CAAC,IAAI,CAAC+F,KAAK,CAAC;;;KAC9B;KAAA,+BAGD;OACC,IAAIujB,mBAAmB,GAAG,EAAE;OAC5B,IAAI,IAAI,CAACC,YAAY,EAAE,IACnB,IAAI,CAAChvB,QAAQ,CAACua,MAAM,IACpB,IAAI,CAACkF,cAAc,CAACwP,OAAO,IAC3B,IAAI,CAACxP,cAAc,CAACwP,OAAO,CAAC,IAAI,CAACvP,gBAAgB,CAAC,IAClD,IAAI,CAACD,cAAc,CAACwP,OAAO,CAAC,IAAI,CAACvP,gBAAgB,CAAC,IAAIoE,WAAW,EAErE;SACCiL,mBAAmB,GAAG,IAAI,CAACtP,cAAc,CAACwP,OAAO,CAAC,IAAI,CAACvP,gBAAgB,CAAC;SAExEpd,aAAG,CAACiuB,MAAM,CAAC,IAAI,CAACvwB,QAAQ,CAACua,MAAM,EAAE;WAChCzO,KAAK,EAAEijB,mBAAmB,KAAK,EAAE,GAAG,EAAE,GAAG;aAAC,kBAAkB,EAAE,QAAQ,GAAGA,mBAAmB,GAAG;;UAC/F,CAAC;;;;KAEH;KAAA,+BAEc/K,cAAc,EAAE9H,QAAQ,EACvC;OACC,IAAI,CAACxd,cAAI,CAAC2f,cAAc,CAAC2F,cAAc,CAAC,EACxC;SACC,OAAO,EAAE;;OAGV9H,QAAQ,GAAGsU,MAAM,CAACtU,QAAQ,CAAC;OAE3B,OAAO,OAAO,GAAG8H,cAAc,CAACyM,WAAW,EAAE,GAAG,QAAQ,GAAGvU,QAAQ,CAACnD,QAAQ,EAAE,GAAG,GAAG;;;KACpF;KAAA,2CAGD;OACC,OAAO,IAAI,CAAC2X,gBAAgB,CAAC,EAAE,CAAC;;;KAChC;KAAA,iCAEgBC,GAAG,EACpB;OACC,IAAMC,OAAO,GAAG,gEAAgE;OAChF,IAAIC,YAAY,GAAG,EAAE;OACrB,KAAK,IAAIrhB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGmhB,GAAG,EAAEnhB,CAAC,EAAE,EAC5B;SACC,IAAMshB,SAAS,GAAG1a,IAAI,CAAC0X,KAAK,CAAC1X,IAAI,CAAC2a,MAAM,EAAE,GAAGH,OAAO,CAAC5uB,MAAM,CAAC;SAC5D6uB,YAAY,IAAID,OAAO,CAAC3pB,SAAS,CAAC6pB,SAAS,EAAEA,SAAS,GAAG,CAAC,CAAC;;OAE5D,OAAOD,YAAY;;;KACnB;KAAA,+BAEczsB,WAAW,EAC1B;OACC,IAAI,CAACA,WAAW,GAAGA,WAAW;OAC9B,IAAI,CAAC4sB,UAAU,CAACtmB,aAAa,CAACiY,cAAc,EAAE,CAACve,WAAW,CAAC,CAAC;;;KAC5D;KAAA,yBAEQoH,KAAK,EACd;OACC,IAAI,CAACA,KAAK,GAAGA,KAAK;OAClB,IAAI,IAAI,CAAClB,SAAS,EAAE,EACpB;SACC,IAAI,IAAI,CAACC,KAAK,EACd;WACCsF,eAAe,CAACmN,WAAW,CAAC,OAAO,EAAExR,KAAK,CAAC;UAC3C,MAED;WACCsR,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACa,QAAQ,EAAE,CAACC,KAAK,CAAC,CAAC;;;OAIlD,IAAI,IAAI,CAACxL,QAAQ,CAACwL,KAAK,EACvB;SACC,IAAI,CAACxL,QAAQ,CAACwL,KAAK,CAACylB,SAAS,GAAG,IAAI,CAAC/D,WAAW,EAAE;;;;KAEnD;KAAA,2BAGD;OACC,OAAO,IAAI,CAAC1hB,KAAK;;;KACjB;KAAA,2BAEU+Z,OAAO,EAClB;OACC,IAAI,CAACA,OAAO,GAAGA,OAAO;OAEtB,IAAI,IAAI,CAACvlB,QAAQ,CAAC+qB,YAAY,EAC9B;SACC,IAAI,CAAC/qB,QAAQ,CAAC+qB,YAAY,CAACjf,KAAK,CAACoR,KAAK,GAAG,IAAI,CAACgU,oBAAoB,EAAE;;;;KAErE;KAAA,uCAGD;OACC,IAAI,IAAI,CAAC3L,OAAO,GAAG,CAAC,IAAI,IAAI,CAACA,OAAO,IAAI,CAAC,EACzC;SACC,OAAO,IAAI,CAACA,OAAO,GAAG,EAAE,GAAG,GAAG;QAC9B,MAED;SACC,OAAO,GAAG;;;;KAEX;KAAA,4BAEWD,QAAoC,EAChD;OACC,IAAI,IAAI,CAACA,QAAQ,KAAKA,QAAQ,EAC9B;SACC;;OAED,IAAI,CAACA,QAAQ,GAAGA,QAAQ;OAExB,IAAI,CAAC,IAAI,CAACtlB,QAAQ,CAACslB,QAAQ,EAC3B;SACC;;OAGDhjB,aAAG,CAACwT,KAAK,CAAC,IAAI,CAAC9V,QAAQ,CAACslB,QAAQ,CAAC;OACjC,IAAI,CAACtlB,QAAQ,CAACslB,QAAQ,CAAC3J,WAAW,CAAC,IAAI,CAACwV,cAAc,CAAC,IAAI,CAAC7L,QAAQ,CAAC,CAAC;;;KACtE;KAAA,8BAEa5Z,UAAU,EACxB;OACC,IAAI,IAAI,CAACpB,SAAS,EAAE,IAAI,CAAC,IAAI,CAACC,KAAK,EACnC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACqX,SAAS,EAAE,CAACrW,UAAU,CAAC,CAAC;SACtD;;OAGD,IAAI,CAACA,UAAU,GAAGA,UAAU;OAC5B,IAAI,IAAI,CAAC1L,QAAQ,CAACiW,MAAM,EACxB;SACC,IAAI,CAACjW,QAAQ,CAACiW,MAAM,CAAC/T,SAAS,GAAG,IAAI,CAACwJ,UAAU;;;;KAEjD;KAAA,0BAES2T,MAAM,EAChB;OACC,IAAI,CAAC3gB,cAAI,CAACC,aAAa,CAAC0gB,MAAM,CAAC,EAC/B;SACC;;OAGD,IAAI,CAACA,MAAM,GAAGA,MAAM;OACpB,IAAI,CAAC,IAAI,CAAC/U,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EACnC;SACC,IAAI,CAAC6mB,gBAAgB,EAAE;;OAExB,IAAI,CAACJ,UAAU,CAACtmB,aAAa,CAAC4X,SAAS,EAAE,CAACjD,MAAM,CAAC,CAAC;;;KAClD;KAAA,0BAESd,MAAM,EAChB;OACC,IAAI,CAACA,MAAM,GAAGA,MAAM;OACpB,IAAI,CAACyS,UAAU,CAACtmB,aAAa,CAAC+X,SAAS,EAAE,CAAClE,MAAM,CAAC,CAAC;;;KAClD;KAAA,8BAEaiG,UAAU,EACxB;OACC,IAAI,CAACA,UAAU,GAAGA,UAAU;OAC5B,IAAI,CAACwM,UAAU,CAACtmB,aAAa,CAACgY,aAAa,EAAE,CAAC8B,UAAU,CAAC,CAAC;;;KAC1D;KAAA,sCAEqB/F,kBAAkB,EACxC;OACC,IAAI,CAACA,kBAAkB,GAAGA,kBAAkB;OAC5C,IAAI,CAACuS,UAAU,CAACtmB,aAAa,CAACkY,qBAAqB,EAAE,CAACnE,kBAAkB,CAAC,CAAC;;;KAC1E;KAAA,2BAEUrU,OAAO,EAAEgc,MAAM,EAC1B;OACC,IAAI,CAAChF,aAAa,CAACgF,MAAM,CAAC,EAC1B;SACCA,MAAM,GAAGhF,aAAa,CAACC,QAAQ;;OAGhC,IAAI,CAAC8E,YAAY,GAAGC,MAAM;OAC1B,IAAI,CAAChc,OAAO,GAAGA,OAAO;OACtB,IAAI,CAACinB,aAAa,EAAE;;;KACpB;KAAA,2BAEU7nB,OAAO,EAClB;OACC,IAAI,CAACgV,QAAQ,GAAGhV,OAAO;OAEvB,IAAI8nB,YAAY,GAAG,IAAI,CAACpL,iBAAiB,CAAC1c,OAAO,CAAC;OAClD,IAAI,CAACY,OAAO,GAAGknB,YAAY,CAAClnB,OAAO;OACnC,IAAI,CAAC+b,YAAY,GAAGmL,YAAY,CAAClL,MAAM;OAEvC,QAAQ5c,OAAO;SAEd,KAAKL,OAAO,CAAC2W,QAAQ;WACpB,IAAI,CAACyR,WAAW,CAAC,KAAK,CAAC;WACvB,IAAI,CAACC,gBAAgB,CAAC,CAAC,QAAQ,CAAC,CAAC;WACjC,IAAI,CAACJ,gBAAgB,EAAE;WACvB,IAAI,CAACznB,SAAS,EAAE;WAChB;SACD,KAAKR,OAAO,CAAC6W,gBAAgB;WAC5B,IAAI,CAACuR,WAAW,CAAC,KAAK,CAAC;WACvB,IAAI,CAACC,gBAAgB,CAAC,CAAC,QAAQ,CAAC,CAAC;WACjC,IAAI,CAACJ,gBAAgB,EAAE;WACvB,IAAI,CAACznB,SAAS,EAAE;WAChB;SACD,KAAKR,OAAO,CAAC4W,QAAQ;WACpB,IAAI,CAACwR,WAAW,CAAC,IAAI,CAAC;WACtB,IAAI,CAACC,gBAAgB,CAAC,CAAC,QAAQ,CAAC,CAAC;WACjC,IAAI,CAACJ,gBAAgB,EAAE;WACvB,IAAI,CAACznB,SAAS,EAAE;WAChB,IAAI,CAAC8nB,YAAY,EAAE;WACnB;SACD,KAAKtoB,OAAO,CAAC8W,kBAAkB;WAC9B,IAAI,CAACsR,WAAW,CAAC,KAAK,CAAC;WACvB,IAAI,CAACC,gBAAgB,CAAC,CAAC,QAAQ,CAAC,CAAC;WACjC,IAAI,CAACJ,gBAAgB,EAAE;WACvB,IAAI,CAACznB,SAAS,EAAE;WAChB;SACD,KAAKR,OAAO,CAAC+W,kBAAkB;WAC9B,IAAI,CAACqR,WAAW,CAAC,KAAK,CAAC;WACvB,IAAI,CAACC,gBAAgB,CAAC,CAAC,QAAQ,CAAC,CAAC;WACjC,IAAI,CAACJ,gBAAgB,EAAE;WACvB,IAAI,CAACM,YAAY,EAAE;WACnB,IAAI,CAAC/nB,SAAS,EAAE;WAChB;SACD,KAAKR,OAAO,CAACgX,SAAS;WACrB,IAAI,IAAI,CAACpB,UAAU,EACnB;aACC,IAAI,CAACwS,WAAW,CAAC,IAAI,CAAC;YACtB,MAED;aACC,IAAI,CAACA,WAAW,CAAC,KAAK,CAAC;;WAGxB,IAAI,CAACI,YAAY,CAAC,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;WACtC,IAAI,CAACP,gBAAgB,EAAE;WACvB,IAAI,CAACM,YAAY,EAAE;WACnB,IAAI,CAACpmB,UAAU,EAAE;WACjB;SACD,KAAKnC,OAAO,CAACiX,YAAY;WACxB,IAAI,CAACmR,WAAW,CAAC,KAAK,CAAC;WACvB,IAAI,CAACI,YAAY,CAAC,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;WACtC,IAAI,CAACP,gBAAgB,EAAE;WACvB;SACD,KAAKjoB,OAAO,CAACoX,IAAI;WAChB,IAAI,CAACgR,WAAW,CAAC,IAAI,CAAC;WACtB,IAAI,CAAC5nB,SAAS,EAAE;WAChB,IAAI,CAAC8nB,YAAY,EAAE;WACnB,IAAI,CAACD,gBAAgB,CAAC,CAAC,QAAQ,CAAC,CAAC;WACjC,IAAI,CAACJ,gBAAgB,EAAE;WACvB;SACD,KAAKjoB,OAAO,CAACqX,KAAK;WACjB,IAAI,CAAC+Q,WAAW,CAAC,IAAI,CAAC;WACtB,IAAI,CAAC5nB,SAAS,EAAE;WAChB,IAAI,CAAC8nB,YAAY,EAAE;WACnB;SACD,KAAKtoB,OAAO,CAACsX,UAAU;WACtB,IAAI,CAAC8Q,WAAW,CAAC,IAAI,CAAC;WACtB,IAAI,CAAC5nB,SAAS,EAAE;WAChB,IAAI,CAAC8nB,YAAY,EAAE;WACnB;SACD,KAAKtoB,OAAO,CAACuX,aAAa;WACzB,IAAI,CAAC6Q,WAAW,CAAC,IAAI,CAAC;WACtB,IAAI,CAAC5nB,SAAS,EAAE;WAChB,IAAI,CAAC8nB,YAAY,EAAE;WACnB;SACD,KAAKtoB,OAAO,CAACwX,MAAM;WAClB,IAAI,CAAC4Q,WAAW,CAAC,IAAI,CAAC;WACtB,IAAI,CAAC5nB,SAAS,EAAE;WAChB,IAAI,CAAC8nB,YAAY,EAAE;WACnB;;OAGF,IAAI,IAAI,CAACnnB,SAAS,EAAE,IAAI,CAAC,IAAI,CAACC,KAAK,EACnC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACjB,UAAU,EAAE,CAACD,OAAO,CAAC,CAAC;SACpD;;OAED,IAAI,CAAC6nB,aAAa,EAAE;;;KACpB;;CAGF;CACA;CACA;CACA;KAJC,6BAKa5M,SAAS,EAAEmN,gBAAgB,EACxC;OACC,IAAI,IAAI,CAACnN,SAAS,KAAKA,SAAS,EAChC;SACC;;OAGD,IAAI,CAACA,SAAS,GAAGA,SAAS;OAE1B,IAAI,CAAC/lB,cAAI,CAACC,aAAa,CAACizB,gBAAgB,CAAC,EACzC;SACCA,gBAAgB,GAAG,EAAE;;OAGtB,IAAI,CAACP,aAAa,EAAE;OACpB,IAAI5M,SAAS,KAAK5D,SAAS,CAACV,SAAS,IAAI,IAAI,CAAC0R,iBAAiB,EAAE,EACjE;SACC,IAAI,CAACC,IAAI,EAAE;;OAGZ5nB,EAAE,CAACO,aAAa,CAAC8D,MAAM,EAAE,4BAA4B,EAAE,CAACkW,SAAS,EAAEmN,gBAAgB,CAAC,CAAC;OACrF,IAAI,CAACZ,UAAU,CAACtmB,aAAa,CAAC6X,YAAY,EAAE,CAACkC,SAAS,EAAEmN,gBAAgB,CAAC,CAAC;;;KAC1E;KAAA,oCAGD;OACC,OAAQ,IAAI,CAACvM,QAAQ,KAAK,IAAI,IAAI,CAAC,IAAI,CAAC/a,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC0B,QAAQ,EAAE,IAAI,IAAI,CAAC2T,QAAQ,CAAC3d,MAAM,KAAK,CAAC;;;KACrG;KAAA,yBAGD;OACC,OAAO,IAAI,CAACgJ,IAAI;;;KAChB;KAAA,wBAEOA,IAAI,EACZ;OACC,IAAI,CAACA,IAAI,GAAGA,IAAI;;;KAChB;KAAA,6BAEYka,SAAS,EACtB;OACC,IAAI,CAACA,SAAS,GAAGA,SAAS;;;KAC1B;KAAA,8BAGD;OACC,OAAO,IAAI,CAACA,SAAS;;;KACrB;KAAA,0BAGD;OACC,OAAO,IAAI,CAAClb,KAAK;;;KACjB;KAAA,yBAEQA,KAAK,EACd;OACC,IAAI,CAACA,KAAK,GAAGA,KAAK;;;KAClB;KAAA,6BAGD;OACC,OAAO,IAAI,CAACgV,QAAQ;;;KACpB;KAAA,4BAEWA,QAAQ,EACpB;OACCA,QAAQ,GAAIA,QAAQ,KAAK,IAAK;OAC9B,IAAI,IAAI,CAACA,QAAQ,IAAIA,QAAQ,EAC7B;SACC;;OAGD,IAAI,CAACA,QAAQ,GAAGA,QAAQ;OACxB,IAAI,CAACgS,UAAU,CAACtmB,aAAa,CAACmY,WAAW,EAAE,CAAC7D,QAAQ,CAAC,CAAC;OACtD,IAAI,CAACvV,UAAU,CAAC,IAAI,CAAC+U,QAAQ,CAAC;;;KAC9B;KAAA,6BAGD;OACC,OAAQ,IAAI,CAACE,SAAS,KAAKmB,SAAS,CAAC7W,QAAQ;;;KAC7C;KAAA,+BAGD;OACC,OAAO,IAAI,CAACwW,UAAU;;;KACtB;KAAA,4BAEWpQ,SAAS,EAAEpG,QAAQ,EAC/B;OACC,IAAI,CAAC,IAAI,CAACtJ,SAAS,CAAC0C,cAAc,CAACgN,SAAS,CAAC,EAC7C;SACC,OAAO,KAAK;;OAGb,IAAI,CAAC1P,SAAS,CAAC0P,SAAS,CAAC,GAAG1Q,cAAI,CAACkB,UAAU,CAACoJ,QAAQ,CAAC,GAAGA,QAAQ,GAAG1K,GAAG;;;KACtE;KAAA,8BAEaygB,UAAU,EACxB;OACC,IAAI,CAACA,UAAU,GAAGA,UAAU;OAE5B,IAAI,IAAI,CAAC/e,QAAQ,CAACoK,OAAO,CAAC2nB,QAAQ,EAClC;SACC,IAAIhT,UAAU,EACd;WACCzc,aAAG,CAAC6H,QAAQ,CAAC,IAAI,CAACnK,QAAQ,CAACoK,OAAO,CAAC2nB,QAAQ,EAAE,QAAQ,CAAC;UACtD,MAED;WACCzvB,aAAG,CAACsI,WAAW,CAAC,IAAI,CAAC5K,QAAQ,CAACoK,OAAO,CAAC2nB,QAAQ,EAAE,QAAQ,CAAC;;;OAI3D,IAAI,IAAI,CAACznB,SAAS,EAAE,IAAI,CAAC,IAAI,CAACC,KAAK,EACnC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACsX,aAAa,EAAE,CAACjD,UAAU,CAAC,CAAC;;;;KAE3D;KAAA,6BAEYtgB,MAAM,EACnB;OACC,IAAI,CAACwgB,aAAa,GAAGxgB,MAAM,CAACqE,IAAI;OAChC,IAAI,CAACoc,WAAW,GAAGzgB,MAAM,CAACkC,EAAE;OAC5B,IAAI,CAACwe,aAAa,GAAG1gB,MAAM,CAACuzB,UAAU,IAAI,EAAE;OAC5C,IAAI,CAAC5S,kBAAkB,GAAG3gB,MAAM,CAACwzB,eAAe,IAAI,EAAE;OACtD,IAAI,CAAClN,WAAW,GAAGrmB,cAAI,CAAC0G,OAAO,CAAC3G,MAAM,CAACiX,QAAQ,CAAC,GAAGjX,MAAM,CAACiX,QAAQ,GAAG,EAAE;OAEvE,IAAI,IAAI,CAACpL,SAAS,EAAE,IAAI,CAAC,IAAI,CAACC,KAAK,EACnC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACuX,YAAY,EAAE,CAACxjB,MAAM,CAAC,CAAC;;;;KAEtD;KAAA,2BAEUomB,OAAO,EAClB;OACC,IAAI,CAACnmB,cAAI,CAACC,aAAa,CAACkmB,OAAO,CAAC,EAChC;SACC;;OAGD,IAAI,CAAChG,GAAG,GAAG,IAAI;OACf,IAAI,CAACgG,OAAO,GAAGA,OAAO;;;KACtB;KAAA,4BAEWtS,UAAU,EAAE2J,QAAQ,EAChC;OAAA;OACChS,EAAE,CAACO,aAAa,CAAC8D,MAAM,EAAE,yBAAyB,EAAE,CAAC;SACpD,iBAAiB,EAAEgE,UAAU;SAC7B,eAAe,EAAE2J,QAAQ;SACzB,cAAc,EAAE,IAAI,CAAC9X;QACrB,CAAC,CAAC;OACH,IAAI,CAACkM,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAAC7I,aAAa,EAAE;SACrE,iBAAiB,EAAE0K,UAAU;SAC7B,eAAe,EAAE2J,QAAQ;SACzB,cAAc,EAAE,IAAI,CAAC9X;QACrB,CAAC;OAEF8F,EAAE,CAAC6J,IAAI,CAACme,SAAS,CAAC,gCAAgC,EAAE;SACnD9d,IAAI,EAAE;WACL7B,UAAU,EAAEA,UAAU;WACtB2J,QAAQ,EAAEA;;QAEX,CAAC,CAACwO,IAAI,CAAC,UAACyH,QAAQ,EACjB;SACC,IAAI,OAAI,CAAClI,aAAa,IAAI1I,OAAO,CAACC,MAAM,EACxC;WACC,OAAI,CAACyI,aAAa,GAAG1I,OAAO,CAAC1C,GAAG;WAChC,OAAI,CAACA,GAAG,GAAG,IAAI;WACf,IAAIuT,cAAc,GAAG,OAAI,CAACrF,eAAe,EAAE;WAE3C,OAAI,CAAC/sB,QAAQ,CAAC2qB,IAAI,CAAClT,UAAU,CAACC,YAAY,CAAC0a,cAAc,EAAE,OAAI,CAACpyB,QAAQ,CAAC2qB,IAAI,CAAC;WAC9E,OAAI,CAAC3qB,QAAQ,CAAC2qB,IAAI,GAAGyH,cAAc;WACnC,OAAI,CAAC3oB,UAAU,CAAC,OAAI,CAAC+U,QAAQ,CAAC;WAC9B,OAAI,CAAC/S,aAAa,CAAC,OAAI,CAACC,UAAU,CAAC;;SAGpC,IAAI,OAAI,CAAC1L,QAAQ,CAACgrB,OAAO,EACzB;WACC9gB,EAAE,CAACoT,IAAI,CAAC,OAAI,CAACtd,QAAQ,CAACgrB,OAAO,EAAEmH,QAAQ,CAAC/d,IAAI,CAACkJ,IAAI,CAAC;WAClDtY,UAAU,CAAC,YACX;aACC,IAAI,OAAI,CAACsF,SAAS,EAAE,EACpB;eACC,OAAI,CAAC+nB,YAAY,CAAC,OAAI,CAACtG,eAAe,EAAE,EAAE,OAAI,CAACC,gBAAgB,EAAE,CAAC;;aAEnE,OAAI,CAACuE,MAAM,EAAE;aACb,OAAI,CAAC+B,iBAAiB,EAAE;YACxB,EAAE,GAAG,CAAC;;SAGR,OAAI,CAAClB,gBAAgB,EAAE;QACvB,CAAC,SAAM,CAAC,UAACe,QAAQ;SAAA,OAAKpd,OAAO,CAACyL,KAAK,CAAC,2BAA2B,EAAE2R,QAAQ,CAACI,MAAM,CAAC,CAAC,CAAC,CAAC;SAAC;;;KACtF;KAAA,gCAGD;OACC,IAAI,IAAI,CAACjoB,SAAS,EAAE,IAAI,CAAC,IAAI,CAACC,KAAK,EACnC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAAC8X,aAAa,EAAE,EAAE,CAAC;QAChD,MAED;SACC,IAAI,CAAC8B,WAAW,CAAC,IAAI,CAACrF,aAAa,EAAE,IAAI,CAACC,WAAW,CAAC;;;;KAEvD;KAAA,oCAGD;OACC,IAAI,CAAC,IAAI,CAAClf,QAAQ,CAACgrB,OAAO,EAC1B;SACC;;OAGD,IAAI,CAAC9gB,EAAE,CAACsoB,GAAG,IAAI,CAACtoB,EAAE,CAACsoB,GAAG,CAACC,IAAI,EAC3B;SACC;;OAGD,IAAIC,OAAO,GAAG,IAAI,CAAC1yB,QAAQ,CAACgrB,OAAO,CAAC2H,gBAAgB,CAAC,sBAAsB,CAAC;OAC5E,KAAK,IAAInjB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGkjB,OAAO,CAAC1wB,MAAM,EAAEwN,CAAC,EAAE,EACvC;SACCtF,EAAE,CAACxI,IAAI,CAACgxB,OAAO,CAACljB,CAAC,CAAC,EAAE,OAAO,EAAE,IAAI,CAACojB,gBAAgB,CAAClxB,IAAI,CAAC,IAAI,CAAC,CAAC;;;;KAE/D;KAAA,iCAEgBwC,CAAC,EAClB;OACC,IAAIgG,EAAE,CAACsoB,GAAG,CAACC,IAAI,CAACI,eAAe,CAAC3uB,CAAC,CAACwC,aAAa,CAACsL,IAAI,CAAC,EACrD;SACC,IAAI,CAAC,IAAI,CAAChG,QAAQ,EAAE,EACpB;WACC,IAAI,CAAC8lB,IAAI,EAAE;;;;;KAGb;KAAA,oCAEmBgB,MAAM,EAC1B;OAAA;OACC,IAAI,CAACpT,gBAAgB,GAAGoT,MAAM;OAC9B,IAAI,CAAC9B,UAAU,CAACtmB,aAAa,CAACyX,mBAAmB,EAAE,CAAC2Q,MAAM,CAAC,CAAC;OAE5D,IAAI,IAAI,CAACrT,cAAc,IAAI,IAAI,CAACA,cAAc,CAAC4Q,KAAK,CAAC,IAAI,CAAC3Q,gBAAgB,CAAC,EAC3E;SACC,IAAI,CAACqT,YAAY,EAAE;SACnB,IAAI,CAACtI,WAAW,EAAE,CAACC,IAAI,CAAC,UAAAlf,KAAK;WAAA,OAAI,OAAI,CAACD,QAAQ,CAACC,KAAK,CAAC;WAAC;;;;KAEvD;KAAA,uCAEsBwnB,SAAS,EAChC;OAAA;OACC,IAAI,CAAC/N,mBAAmB,GAAG+N,SAAS;OACpC,IAAI,CAAChC,UAAU,CAACtmB,aAAa,CAAC0X,sBAAsB,EAAE,CAAC4Q,SAAS,CAAC,CAAC;OAElE,IAAI,CAACvI,WAAW,EAAE,CAACC,IAAI,CAAC,UAAAlf,KAAK;SAAA,OAAI,OAAI,CAACD,QAAQ,CAACC,KAAK,CAAC;SAAC;;;KACtD;KAAA,8BAEagU,UAAU,EACxB;OACC,IAAI,CAACA,UAAU,GAAIA,UAAU,KAAK,IAAK;OACvC,IAAI,CAACwR,UAAU,CAACtmB,aAAa,CAACwX,aAAa,EAAE,CAAC1C,UAAU,CAAC,CAAC;;;KAC1D;KAAA,kCAEiBpL,IAAI,EACtB;OACC,IAAI,CAACqL,cAAc,GAAGrL,IAAI;OAC1B,IAAI,CAAC4c,UAAU,CAACtmB,aAAa,CAAC2X,iBAAiB,EAAE,CAACjO,IAAI,CAAC,CAAC;;;KACxD;KAAA,2BAEU6e,OAAO,EAAE3a,UAAU,EAC9B;OACC,IAAI,IAAI,CAAChO,SAAS,EAAE,IAAI,CAAC,IAAI,CAACC,KAAK,EACnC;SACCuS,+BAAU,CAACtB,IAAI,CAACyX,OAAO,EAAE3a,UAAU,CAAC;;;;KAErC;KAAA,6BAGD;OACC,IAAI,IAAI,CAACtY,QAAQ,CAACwL,KAAK,EACvB;SACC,IAAI,CAACxL,QAAQ,CAACwL,KAAK,CAACylB,SAAS,GAAG,IAAI,CAAC/D,WAAW,EAAE;;OAGnD,IAAI,IAAI,CAACltB,QAAQ,CAACslB,QAAQ,EAC1B;SACChjB,aAAG,CAACwT,KAAK,CAAC,IAAI,CAAC9V,QAAQ,CAACslB,QAAQ,CAAC;SACjC,IAAI,CAACtlB,QAAQ,CAACslB,QAAQ,CAAC3J,WAAW,CAAC,IAAI,CAACwV,cAAc,CAAC,IAAI,CAAC7L,QAAQ,CAAC,CAAC;;OAGvE,IAAI,IAAI,CAACtlB,QAAQ,CAACiW,MAAM,EACxB;SACC,IAAI,CAACjW,QAAQ,CAACiW,MAAM,CAAC/T,SAAS,GAAG,IAAI,CAACwJ,UAAU;;OAGjD,IAAI,CAAC2lB,aAAa,EAAE;OACpB,IAAI,CAAC6B,WAAW,EAAE;;;KAClB;KAAA,+BAEc5N,QAAoC,EACnD;OACC,IAAIld,MAAM;OACV,QAAQkd,QAAQ;SAEf,KAAKvE,YAAY,CAACC,OAAO;WACxB5Y,MAAM,GAAG9F,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aAC1BC,KAAK,EAAE;eAACC,SAAS,EAAE;cAAqC;aAAEC,QAAQ,EAAE,CACnEJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eAACC,KAAK,EAAE;iBAACC,SAAS,EAAE;;cAA8F,CAAC,EACrIH,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eAACC,KAAK,EAAE;iBAACC,SAAS,EAAE;;cAA8F,CAAC;YAEtI,CAAC;WACF;SACD,KAAKse,YAAY,CAACG,MAAM;WACvB9Y,MAAM,GAAG9F,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aAC1BC,KAAK,EAAE;eAACC,SAAS,EAAE;cAA+E;aAClGC,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;eAACC,KAAK,EAAE;iBAACC,SAAS,EAAE;;cAA8F,CAAC;YAEtI,CAAC;WACF;SACD,KAAKse,YAAY,CAACP,KAAK;WACtB8E,QAAQ,GAAGvE,YAAY,CAACE,OAAO;;SAEhC;WACC7Y,MAAM,GAAG9F,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aAACC,KAAK,EAAE;eAACC,SAAS,EAAE,wEAAwE,GAAG6iB;;YAAU,CAAC;;OAGvI,OAAOld,MAAM;;;KACb;;CAGF;CACA;CACA;KAHC,kCAIkBoB,OAAO,EACzB;OACC,IAAIpB,MAAM,GAAG;SACZgC,OAAO,EAAE,EAAE;SACXgc,MAAM,EAAEhF,aAAa,CAACC;QACtB;OACD,QAAQ7X,OAAO;SAEd,KAAKL,OAAO,CAAC2W,QAAQ;WACpB1X,MAAM,CAACgC,OAAO,GAAG,CAAC,QAAQ,EAAE,MAAM,CAAC;WAEnC;SACD,KAAKjB,OAAO,CAAC6W,gBAAgB;WAC5B5X,MAAM,CAACgC,OAAO,GAAG,CAAC,QAAQ,EAAE,MAAM,CAAC;WACnC;SACD,KAAKjB,OAAO,CAAC4W,QAAQ;WACpB3X,MAAM,CAACgC,OAAO,GAAG,CAAC,MAAM,CAAC;WAEzB,IAAI,IAAI,CAACmO,UAAU,GAAG,CAAC,EACvB;aACCnQ,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,MAAM,CAAC;aAC3B6C,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,MAAM,CAAC;aAE3B,IAAI,CAAC,IAAI,CAAC+E,SAAS,EAAE,EACrB;eACClC,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,UAAU,CAAC;;;WAGjC;SACD,KAAK4D,OAAO,CAAC8W,kBAAkB;WAC9B7X,MAAM,CAACgC,OAAO,GAAG,CAAC,QAAQ,CAAC;WAE3B;SACD,KAAKjB,OAAO,CAAC+W,kBAAkB;WAC9B,IAAI,IAAI,CAACpB,WAAW,EACpB;aACC1W,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,UAAU,CAAC;;WAEhC6C,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,QAAQ,CAAC;WAC7B;SACD,KAAK4D,OAAO,CAACqX,KAAK;WACjB,IAAI,IAAI,CAAC1B,WAAW,EACpB;aACC1W,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,UAAU,CAAC;;WAEhC,IAAI,IAAI,CAACgT,UAAU,GAAG,CAAC,EACvB;aACCnQ,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,QAAQ,EAAE,MAAM,EAAE,UAAU,CAAC;YACjD,MAED;aACC6C,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,OAAO,CAAC;;WAE7B;SACD,KAAK4D,OAAO,CAACsX,UAAU;WACtBrY,MAAM,CAACgC,OAAO,GAAG,CAAC,aAAa,EAAE,OAAO,CAAC;WACzC;SACD,KAAKjB,OAAO,CAACuX,aAAa;WACzBtY,MAAM,CAACgC,OAAO,GAAG,CAAC,UAAU,EAAE,OAAO,CAAC;WACtC;SACD,KAAKjB,OAAO,CAACgX,SAAS;WACrB/X,MAAM,CAACgC,OAAO,GAAG,IAAI,CAACkmB,UAAU,EAAE,GAAG,EAAE,GAAG,CAAC,MAAM,CAAC;WAClD,IAAI,CAAC,IAAI,CAACvR,UAAU,EACpB;aACC3W,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,MAAM,EAAE,cAAc,CAAC;;WAE5C6C,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,MAAM,CAAC;WAE3B,IAAI,CAAC,IAAI,CAACgT,UAAU,IAAI,CAAC,IAAI,CAAC+X,UAAU,EAAE,EAC1C;aACCloB,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,UAAU,CAAC;;WAGhC,IAAI,IAAI,CAACwZ,UAAU,EACnB;aACC3W,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,OAAO,CAAC;YAC5B,MAED;aACC6C,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,SAAS,EAAE,QAAQ,CAAC;;WAGzC6C,MAAM,CAACge,MAAM,GAAGhF,aAAa,CAACE,MAAM;WACpC;SACD,KAAKnY,OAAO,CAACiX,YAAY;WACxBhY,MAAM,CAACgC,OAAO,GAAG,CAAC,kBAAkB,EAAE,gBAAgB,CAAC;WACvD;SACD,KAAKjB,OAAO,CAACkX,cAAc;WAC1BjY,MAAM,CAACgC,OAAO,GAAG,CAAC,gBAAgB,CAAC;WACnC;SACD,KAAKjB,OAAO,CAACmX,iBAAiB;WAC7BlY,MAAM,CAACgC,OAAO,GAAG,CAAC,QAAQ,CAAC;WAC3B;SACD,KAAKjB,OAAO,CAACoX,IAAI;WAChB,IAAI,IAAI,CAACzB,WAAW,EACpB;aACC1W,MAAM,CAACgC,OAAO,GAAG,CAAC,OAAO,CAAC;YAC1B,MACI,IAAI,IAAI,CAACsU,SAAS,IAAImB,SAAS,CAACC,QAAQ,EAC7C;aACC1X,MAAM,CAACgC,OAAO,GAAG,CAAC,OAAO,CAAC;YAC1B,MACI,IAAI,IAAI,CAACsU,SAAS,IAAImB,SAAS,CAACE,QAAQ,EAC7C;aACC3X,MAAM,CAACgC,OAAO,GAAG,CAAC,QAAQ,CAAC;aAC3B,IAAI,IAAI,CAACmO,UAAU,GAAG,CAAC,EACvB;eACCnQ,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,MAAM,CAAC;eAC3B6C,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,MAAM,CAAC;cAC3B,MAED;eACC6C,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,OAAO,CAAC;;;WAG9B,IAAI,IAAI,CAACgT,UAAU,GAAG,CAAC,IAAI,CAAC,IAAI,CAACjO,SAAS,EAAE,EAC5C;aACClC,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,UAAU,CAAC;;WAEhC;SACD,KAAK4D,OAAO,CAACwX,MAAM;WAClBvY,MAAM,CAACgC,OAAO,GAAG,CAAC,QAAQ,CAAC;WAC3B;SACD,KAAKjB,OAAO,CAACyX,YAAY;WACxBxY,MAAM,CAACgC,OAAO,GAAG,CAAC,OAAO,CAAC;WAC1BhC,MAAM,CAACgC,OAAO,CAAC7E,IAAI,CAAC,MAAM,CAAC;WAC3B;;OAGF,OAAO6C,MAAM;;;KACb;KAAA,gCAGD;OACC,IAAI,IAAI,CAAC4D,QAAQ,EAAE,EACnB;SACC,IAAI,CAACmnB,mBAAmB,EAAE;QAC1B,MAED;SACC,IAAI,CAACC,oBAAoB,EAAE;;;;KAE5B;KAAA,uCAGD;OAAA;OACC,IAAIC,eAAe,GAAGxyB,QAAQ,CAACyyB,sBAAsB,EAAE;OACvD,IAAIC,kBAAkB,GAAG1yB,QAAQ,CAACyyB,sBAAsB,EAAE;OAC1D,IAAIE,uBAAuB,GAAG3yB,QAAQ,CAACyyB,sBAAsB,EAAE;OAC/D,IAAIG,aAAa,GAAG;SACnBjG,IAAI,EAAE,IAAI;SACVC,KAAK,EAAE;QACP;OACD,IAAI,CAACztB,QAAQ,CAACoK,OAAO,GAAG,EAAE;OAC1B,IAAI,IAAI,CAAC+b,YAAY,IAAI/E,aAAa,CAACE,MAAM,EAC7C;SACCmS,aAAa,CAACjG,IAAI,GAAGlrB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAACC,KAAK,EAAE;aAACC,SAAS,EAAE;;UAAwC,CAAC;SACpGgxB,aAAa,CAAChG,KAAK,GAAGnrB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAACC,KAAK,EAAE;aAACC,SAAS,EAAE;;UAAyC,CAAC;SACtG4wB,eAAe,CAAC1X,WAAW,CAAC8X,aAAa,CAACjG,IAAI,CAAC;SAC/C6F,eAAe,CAAC1X,WAAW,CAAC8X,aAAa,CAAChG,KAAK,CAAC;;OAGjD,IAAI,CAACrjB,OAAO,CAAC/E,OAAO,CAAC,UAACquB,UAAU,EAChC;SACC,IAAIC,UAAU;SAEd,QAAQD,UAAU;WAEjB,KAAK,MAAM;aACVC,UAAU,GAAGC,kBAAkB,CAAC,EAAE,EAAE,wBAAwB,EAAE,OAAI,CAACxM,yBAAyB,CAAC;aAC7F,IAAI,OAAI,CAACrc,MAAM,EAAE,EACjB;eACCzI,aAAG,CAAC6H,QAAQ,CAACwpB,UAAU,EAAE,QAAQ,CAAC;;aAGnC,IAAI,OAAI,CAACxN,YAAY,IAAI/E,aAAa,CAACE,MAAM,EAC7C;eACCmS,aAAa,CAACjG,IAAI,CAAC7R,WAAW,CAACgY,UAAU,CAAC;cAC1C,MAED;eACCN,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;;aAGxC;WACD,KAAK,MAAM;aACVA,UAAU,GAAGC,kBAAkB,CAAC,EAAE,EAAE,wBAAwB,EAAE,OAAI,CAACtM,yBAAyB,CAAC;aAC7F,IAAI,OAAI,CAACvd,OAAO,EAAE,EAClB;eACCzH,aAAG,CAAC6H,QAAQ,CAACwpB,UAAU,EAAE,QAAQ,CAAC;;aAGnC,IAAI,OAAI,CAACxN,YAAY,IAAI/E,aAAa,CAACE,MAAM,EAC7C;eACCmS,aAAa,CAACjG,IAAI,CAAC7R,WAAW,CAACgY,UAAU,CAAC;cAC1C,MAED;eACCN,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;;aAGxC;WACD,KAAK,UAAU;aACdA,UAAU,GAAGC,kBAAkB,CAAC,EAAE,EAAE,4BAA4B,EAAE,OAAI,CAACpM,6BAA6B,CAAC;aACrG,IAAI,OAAI,CAACrB,YAAY,IAAI/E,aAAa,CAACE,MAAM,EAC7C;eACCmS,aAAa,CAACjG,IAAI,CAAC7R,WAAW,CAACgY,UAAU,CAAC;cAC1C,MAED;eACCN,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;;aAGxC;WACD,KAAK,kBAAkB;aACtBA,UAAU,GAAGC,kBAAkB,CAC9B3wB,aAAG,CAACC,UAAU,CAAC,wBAAwB,CAAC,EACxC,kEAAkE,EAClE,OAAI,CAACwkB,qCAAqC,CAC1C;aACD2L,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;aACvC;WACD,KAAK,gBAAgB;aACpBA,UAAU,GAAGC,kBAAkB,CAC9B3wB,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC,EACtC,yCAAyC,EACzC,OAAI,CAAC0kB,mCAAmC,CACxC;aACDyL,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;aACvC;WACD,KAAK,SAAS;aACbA,UAAU,GAAGC,kBAAkB,CAAC,EAAE,EAAE,2BAA2B,EAAE,OAAI,CAAC9L,4BAA4B,CAAC;aACnG,IAAI,OAAI,CAAC3B,YAAY,IAAI/E,aAAa,CAACE,MAAM,EAC7C;eACCmS,aAAa,CAACjG,IAAI,CAAC7R,WAAW,CAACgY,UAAU,CAAC;cAC1C,MAED;eACCN,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;;aAGxC;WACD,KAAK,MAAM;aACVA,UAAU,GAAGC,kBAAkB,CAC9B3wB,aAAG,CAACC,UAAU,CAAC,eAAe,CAAC,EAC/B,2CAA2C,EAC3C,OAAI,CAACklB,6BAA6B,CAClC;aACDiL,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;aACvC;WACD,KAAK,QAAQ;aACZA,UAAU,GAAGC,kBAAkB,CAC9B3wB,aAAG,CAACC,UAAU,CAAC,qBAAqB,CAAC,EACrC,2CAA2C,EAC3C,OAAI,CAACylB,2BAA2B,CAChC;aACD0K,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;aACvC;WACD,KAAK,MAAM;aACVA,UAAU,GAAGC,kBAAkB,CAC9B3wB,aAAG,CAACC,UAAU,CAAC,mBAAmB,CAAC,EACnC,yCAAyC,EACzC,OAAI,CAAC2lB,yBAAyB,CAC9B;aACDwK,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;aACvC;WACD,KAAK,QAAQ;aACZA,UAAU,GAAGC,kBAAkB,CAC9B3wB,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC,EACtC,iEAAiE,EACjE,OAAI,CAAC8kB,2BAA2B,CAChC;aACD,IAAI,OAAI,CAAC7B,YAAY,IAAI/E,aAAa,CAACE,MAAM,EAC7C;eACCmS,aAAa,CAAChG,KAAK,CAAC9R,WAAW,CAACgY,UAAU,CAAC;cAC3C,MAED;eACCN,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;;aAGxC;WACD,KAAK,OAAO;aACXA,UAAU,GAAGC,kBAAkB,CAC9B3wB,aAAG,CAACC,UAAU,CAAC,qBAAqB,CAAC,EACrC,yCAAyC,EACzC,OAAI,CAACglB,0BAA0B,CAC/B;aACD,IAAI,OAAI,CAAC/B,YAAY,IAAI/E,aAAa,CAACE,MAAM,EAC7C;eACCmS,aAAa,CAAChG,KAAK,CAAC9R,WAAW,CAACgY,UAAU,CAAC;cAC3C,MAED;eACCN,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;;aAGxC;WACD,KAAK,UAAU;aACd,IAAI,CAAC,OAAI,CAACrpB,SAAS,EAAE,EACrB;eACCqpB,UAAU,GAAGrxB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBAC9BC,KAAK,EAAE;mBAACC,SAAS,EAAE;kBAA8B;iBACjDjB,MAAM,EAAE;mBACPmB,KAAK,EAAE,OAAI,CAACulB;;gBAEb,CAAC;eACFsL,uBAAuB,CAAC7X,WAAW,CAACgY,UAAU,CAAC;;aAEhD;WACD,KAAK,aAAa;aACjBA,UAAU,GAAGC,kBAAkB,CAC9B3wB,aAAG,CAACC,UAAU,CAAC,4BAA4B,CAAC,EAC5C,kEAAkE,EAClE,YACA;eACC,OAAI,CAACoN,gBAAgB,CAACQ,MAAM,GACzB,OAAI,CAACR,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAACzI,sBAAsB,CAAC,GAC9E,OAAI,CAACvI,SAAS,CAACqnB,WAAW,EAAE;cAE/B,CACD;aACDsM,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;aACvC;WACD,KAAK,UAAU;aACdA,UAAU,GAAGC,kBAAkB,CAAC,EAAE,EAAG,OAAI,CAAC7U,UAAU,GAAG,gCAAgC,GAAG,yBAAyB,EAAG,OAAI,CAACgK,iCAAiC,CAAC;aAC7J,IAAI,OAAI,CAAC5C,YAAY,IAAI/E,aAAa,CAACE,MAAM,EAC7C;eACCmS,aAAa,CAACjG,IAAI,CAAC7R,WAAW,CAACgY,UAAU,CAAC;cAC1C,MAED;eACCN,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;;aAExC;WACD,KAAK,cAAc;aAClBA,UAAU,GAAGrxB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;eAC/BC,KAAK,EAAE;iBAACC,SAAS,EAAE;gBAA2B;eAC9CjB,MAAM,EAAE;iBAACmB,KAAK,EAAE,OAAI,CAACsmB;gBAA4B;eACjDvmB,QAAQ,EAAE,CACTJ,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;iBAClBC,KAAK,EAAE;mBAACC,SAAS,EAAE;kBAA0C;iBAAEC,QAAQ,EAAE,CACxEJ,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;mBAACC,KAAK,EAAE;qBAACC,SAAS,EAAE;;kBAAuC,CAAC,EAC/E,OAAI,CAACzC,QAAQ,CAAC+qB,YAAY,GAAGzoB,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;mBAC/CC,KAAK,EAAE;qBAACC,SAAS,EAAE;oBAAkC;mBACrDqJ,KAAK,EAAE;qBAACoR,KAAK,EAAE,OAAI,CAACgU,oBAAoB;;kBACxC,CAAC;gBAEH,CAAC;cAEH,CAAC;aACFmC,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;aAEvC;WACD,KAAK,UAAU;;aAEd;WACD,KAAK,MAAM;aACVA,UAAU,GAAGC,kBAAkB,CAC9B3wB,aAAG,CAACC,UAAU,CAAC,oBAAoB,CAAC,EACpC,kEAAkE,EAClE,OAAI,CAAColB,yBAAyB,CAC9B;aACD+K,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;aACvC;WACD,KAAK,QAAQ;aACZA,UAAU,GAAGC,kBAAkB,CAC9B3wB,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC,EACtC,2CAA2C,EAC3C,OAAI,CAACklB,6BAA6B,CAClC;aACDiL,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;aACvC;WACD,KAAK,MAAM;aACV,IAAI,CAAC,OAAI,CAACrpB,SAAS,EAAE,IAAI,OAAI,CAACupB,WAAW,EAAE,EAC3C;eACCF,UAAU,GAAGrxB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBAC9BC,KAAK,EAAE;mBAACC,SAAS,EAAE;kBAAqB;iBACxCoB,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC;iBAC/C1B,MAAM,EAAE;mBACPmB,KAAK,EAAE,OAAI,CAAC8lB;;gBAEb,CAAC;eACF8K,kBAAkB,CAAC5X,WAAW,CAACgY,UAAU,CAAC;;aAE3C;WACD;aACC,MAAM,iBAAiB,GAAGD,UAAU;;SAGtC,IAAIC,UAAU,EACd;WACC,OAAI,CAAC3zB,QAAQ,CAACoK,OAAO,CAACspB,UAAU,CAAC,GAAGC,UAAU;;QAE/C,CAAC;OACF,IAAI,IAAI,CAAC3zB,QAAQ,CAACkrB,gBAAgB,EAClC;SACC5oB,aAAG,CAACwT,KAAK,CAAC,IAAI,CAAC9V,QAAQ,CAACkrB,gBAAgB,CAAC;SACzC,IAAI,CAAClrB,QAAQ,CAACkrB,gBAAgB,CAACvP,WAAW,CAAC0X,eAAe,CAAC;;OAE5D,IAAI,IAAI,CAACrzB,QAAQ,CAACorB,mBAAmB,EACrC;SACC9oB,aAAG,CAACwT,KAAK,CAAC,IAAI,CAAC9V,QAAQ,CAACorB,mBAAmB,CAAC;SAC5C,IAAI,CAACprB,QAAQ,CAACorB,mBAAmB,CAACzP,WAAW,CAAC4X,kBAAkB,CAAC;;OAElE,IAAI,IAAI,CAACvzB,QAAQ,CAACmrB,wBAAwB,EAC1C;SACC7oB,aAAG,CAACwT,KAAK,CAAC,IAAI,CAAC9V,QAAQ,CAACmrB,wBAAwB,CAAC;SACjD,IAAI,CAACnrB,QAAQ,CAACmrB,wBAAwB,CAACxP,WAAW,CAAC6X,uBAAuB,CAAC;;;;KAE5E;KAAA,sCAGD;OAAA;OACC,IAAIH,eAAe,GAAGxyB,QAAQ,CAACyyB,sBAAsB,EAAE;OACvD,IAAIK,UAAU;OACd,IAAI,CAAC3zB,QAAQ,CAACoK,OAAO,GAAG,EAAE;OAE1B,IAAI,CAACA,OAAO,CAAC/E,OAAO,CAAC,UAACquB,UAAU,EAChC;SACC,QAAQA,UAAU;WAEjB,KAAK,QAAQ;aACZC,UAAU,GAAGC,kBAAkB,CAC9B3wB,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC,EACtC,iCAAiC,EACjC,OAAI,CAAC8kB,2BAA2B,CAChC;aACDqL,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;aAEvC;WACD,KAAK,OAAO;aACXA,UAAU,GAAGC,kBAAkB,CAC9B3wB,aAAG,CAACC,UAAU,CAAC,qBAAqB,CAAC,EACrC,iCAAiC,EACjC,OAAI,CAACglB,0BAA0B,CAC/B;aACDmL,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;aACvC;;QAEF,CAAC;OAEF,IAAI,IAAI,CAAC3zB,QAAQ,CAACkrB,gBAAgB,EAClC;SACC5oB,aAAG,CAACwT,KAAK,CAAC,IAAI,CAAC9V,QAAQ,CAACkrB,gBAAgB,CAAC;SACzC,IAAI,CAAClrB,QAAQ,CAACkrB,gBAAgB,CAACvP,WAAW,CAAC0X,eAAe,CAAC;;;;KAE5D;KAAA,mCAGD;OAAA;OACC,IAAIA,eAAe,GAAGxyB,QAAQ,CAACyyB,sBAAsB,EAAE;OACvD,IAAI,CAACtzB,QAAQ,CAAC4qB,UAAU,GAAG,EAAE;OAE7B,IAAI,CAAC,IAAI,CAAC5qB,QAAQ,CAACirB,mBAAmB,EACtC;SACC;;OAGD,IAAI7gB,OAAO,GAAG,CAAC,YAAY,CAAC;OAE5B,IAAI,IAAI,CAAC6U,aAAa,IAAI,SAAS,EACnC;SACC7U,OAAO,CAAC7E,IAAI,CAAC,SAAS,CAAC;SACvB6E,OAAO,CAAC7E,IAAI,CAAC,YAAY,CAAC;QAC1B,MACI,IAAI,IAAI,CAAC0Z,aAAa,IAAI,SAAS,EACxC;SACC7U,OAAO,CAAC7E,IAAI,CAAC,SAAS,CAAC;SACvB6E,OAAO,CAAC7E,IAAI,CAAC,YAAY,CAAC;QAC1B,MACI,IAAI,CAAC,IAAI,CAAC0Z,aAAa,IAAI,IAAI,CAACI,MAAM,CAACyU,UAAU,IAAI,MAAM,EAChE;SACC1pB,OAAO,CAAC7E,IAAI,CAAC,SAAS,CAAC;SACvB6E,OAAO,CAAC7E,IAAI,CAAC,YAAY,CAAC;;OAG3B,IAAI6E,OAAO,CAACpI,MAAM,GAAG,CAAC,EACtB;SACCoI,OAAO,CAAC/E,OAAO,CAAC,UAACquB,UAAU,EAC3B;WACC,IAAIC,UAAU;WACd,QAAQD,UAAU;aAEjB,KAAK,YAAY;eAChBC,UAAU,GAAGrxB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBAC9BC,KAAK,EAAE;mBAACC,SAAS,EAAE,2DAA2D,IAAI,OAAI,CAACkjB,YAAY,GAAG,kCAAkC,GAAG,EAAE;kBAAE;iBAC/IjjB,QAAQ,EAAE,CACT,OAAI,CAAC1C,QAAQ,CAAC4qB,UAAU,CAACmJ,eAAe,GAAGzxB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;mBAC5DC,KAAK,EAAE;qBAACC,SAAS,EAAE;oBAAgC;mBACnDoB,IAAI,EAAE,OAAI,CAAC8hB,YAAY,GAAG1iB,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC,GAAGD,aAAG,CAACC,UAAU,CAAC,6BAA6B;kBAClH,CAAC,CAAC;iBACJ1B,MAAM,EAAE;mBAACmB,KAAK,EAAE,OAAI,CAACqxB,wBAAwB,CAACtyB,IAAI,CAAC,OAAI;;gBACvD,CAAC;eACF;aACD,KAAK,SAAS;eACbiyB,UAAU,GAAGrxB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBAC9BC,KAAK,EAAE;mBAACC,SAAS,EAAE;kBAA2B;iBAAEC,QAAQ,EAAE,CACzDJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;mBACjBC,KAAK,EAAE;qBAACC,SAAS,EAAE;oBAAgC;mBACnDoB,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,0BAA0B;kBAC/C,CAAC,CAAC;iBACJ1B,MAAM,EAAE;mBAACmB,KAAK,EAAE,OAAI,CAACsxB,qBAAqB,CAACvyB,IAAI,CAAC,OAAI;;gBACpD,CAAC;eACF;aACD,KAAK,YAAY;eAChBiyB,UAAU,GAAGrxB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBAC9BC,KAAK,EAAE;mBAACC,SAAS,EAAE;kBAA2B;iBAAEC,QAAQ,EAAE,CACzDJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;mBACjBC,KAAK,EAAE;qBAACC,SAAS,EAAE;oBAAgC;mBACnDoB,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,6BAA6B;kBAClD,CAAC,CAAC;iBACJ1B,MAAM,EAAE;mBAACmB,KAAK,EAAE,OAAI,CAACuxB,wBAAwB,CAACxyB,IAAI,CAAC,OAAI;;gBACvD,CAAC;eACF;aACD,KAAK,SAAS;eACbiyB,UAAU,GAAGrxB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBAC9BC,KAAK,EAAE;mBAACC,SAAS,EAAE;kBAA2B;iBAAEC,QAAQ,EAAE,CACzDJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;mBACjBC,KAAK,EAAE;qBAACC,SAAS,EAAE;oBAAgC;mBACnDoB,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,qBAAqB;kBAC1C,CAAC,CAAC;iBACJ1B,MAAM,EAAE;mBAACmB,KAAK,EAAE,OAAI,CAACwxB,qBAAqB,CAACzyB,IAAI,CAAC,OAAI;;gBACpD,CAAC;eACF;aACD,KAAK,YAAY;eAChBiyB,UAAU,GAAGrxB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;iBAC9BC,KAAK,EAAE;mBAACC,SAAS,EAAE;kBAA2B;iBAAEC,QAAQ,EAAE,CACzDJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;mBACjBC,KAAK,EAAE;qBAACC,SAAS,EAAE;oBAAgC;mBACnDoB,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,wBAAwB;kBAC7C,CAAC,CAAC;iBACJ1B,MAAM,EAAE;mBAACmB,KAAK,EAAE,OAAI,CAACyxB,wBAAwB,CAAC1yB,IAAI,CAAC,OAAI;;gBACvD,CAAC;eACF;;WAEF,IAAIiyB,UAAU,EACd;aACCN,eAAe,CAAC1X,WAAW,CAACgY,UAAU,CAAC;aACvC,OAAI,CAAC3zB,QAAQ,CAAC4qB,UAAU,CAAC8I,UAAU,CAAC,GAAGC,UAAU;;UAElD,CAAC;SAEFrxB,aAAG,CAACwT,KAAK,CAAC,IAAI,CAAC9V,QAAQ,CAACirB,mBAAmB,CAAC;SAC5C,IAAI,CAACjrB,QAAQ,CAACirB,mBAAmB,CAACtP,WAAW,CAAC0X,eAAe,CAAC;SAC9D,IAAI,CAAC1B,YAAY,CAAC,CAAC,YAAY,CAAC,CAAC;QACjC,MAED;SACCrvB,aAAG,CAACwT,KAAK,CAAC,IAAI,CAAC9V,QAAQ,CAACirB,mBAAmB,CAAC;SAC5C,IAAI,CAACoJ,YAAY,CAAC,CAAC,YAAY,CAAC,CAAC;;;;KAElC;KAAA,yBAEQ51B,MAAM,EACf;OACC,IAAI,CAAC,IAAI,CAAC+vB,WAAW,EACrB;SACC;;OAGD,IAAI,CAACA,WAAW,CAAC/c,IAAI,CAAC;SACrB9Q,EAAE,EAAElC,MAAM,CAACkC,EAAE;SACbiR,OAAO,EAAEnT,MAAM,CAACmT;QAChB,CAAC;;;KACF;KAAA,6BAGD;OACC,IAAI,CAAC,IAAI,CAAC4c,WAAW,EACrB;SACC;;OAGD,IAAI,CAACA,WAAW,CAAC9c,MAAM,EAAE;OACzBpP,aAAG,CAACwT,KAAK,CAAC,IAAI,CAAC9V,QAAQ,CAAC4rB,QAAQ,CAACF,OAAO,CAAC;;;KACzC;KAAA,4BAEWxnB,CAAC,EACb;OACC,IAAI,CAAC,IAAI,CAACslB,YAAY,EACtB;SACC;;OAGD,IAAI8K,cAAc,GAAG,IAAI,CAAC9K,YAAY,CAAC+K,iBAAiB,EAAE;OAC1D,IAAI,CAAC/K,YAAY,CAACgL,gBAAgB,CAACF,cAAc,CAAC3e,UAAU,EAAEzR,CAAC,CAACuwB,QAAQ,CAAC;;;KACzE;KAAA,4BAEWh2B,MAAM,EAClB;OAAA;OACC,IAAImwB,SAAS,GAAGnwB,MAAM,CAACkC,EAAE;OACzB,IAAIsQ,IAAI,GAAGxS,MAAM,CAACwS,IAAI;OAEtB,IAAI,IAAI,CAAC4Y,mBAAmB,EAC5B;SACC3f,EAAE,CAACyC,IAAI,CAACC,SAAS,CAAC8nB,YAAY,CAAC,WAAW,CAAC,CAACjjB,IAAI,CAACmd,SAAS,EAAE,IAAI,CAACpE,mBAAmB,EAAE,CAAC;SACvF;;OAGD,IAAI,IAAI,CAACV,oBAAoB,EAC7B;SACC;;OAED,IAAI,CAACA,oBAAoB,GAAG,IAAI;OAEhC5f,EAAE,CAAC6J,IAAI,CAACme,SAAS,CAAC,iCAAiC,EAAE;SACpD9d,IAAI,EAAE;WACL,OAAO,EAAEwa,SAAS;WAClB,kBAAkB,EAAE,IAAI,CAACpE,mBAAmB;;QAE7C,CAAC,CAACE,IAAI,CAAC,UAACyH,QAAQ,EACjB;SACC,IAAI,CAAC,OAAI,CAAC3xB,KAAK,IAAI,CAAC,OAAI,CAAC8J,SAAS,EAAE,EACpC;WACC;;SAEDqqB,iBAAO,CAACrX,IAAI,CAACrM,IAAI,EAAEkhB,QAAQ,CAAC/d,IAAI,CAACkJ,IAAI,CAAC;SACtC,OAAI,CAACuM,mBAAmB,GAAG,IAAI;SAC/B,OAAI,CAACC,oBAAoB,GAAG,KAAK;SACjC,OAAI,CAACC,gBAAgB,GAAG7f,EAAE,CAACyC,IAAI,CAACC,SAAS,CAACC,mBAAmB,CAAC,WAAW,CAAC;SAC1E,OAAI,CAAC+nB,sBAAsB,CAAC,OAAI,CAAC7K,gBAAgB,CAAC;QAClD,CAAC;;;KACF;KAAA,iCAGD;OACC,IAAI,CAAC7f,EAAE,CAACyC,IAAI,IAAI,CAACzC,EAAE,CAACyC,IAAI,CAACC,SAAS,EAClC;SACC,OAAO,KAAK;;OAGb,IAAIpE,SAAS,GAAG0B,EAAE,CAACyC,IAAI,CAACC,SAAS,CAAC8nB,YAAY,CAAC,WAAW,CAAC;OAC3D,IAAI,IAAI,CAAC7K,mBAAmB,IAAIrhB,SAAS,EACzC;SACCA,SAAS,CAACzG,OAAO,EAAE;SACnB,IAAI,CAAC8nB,mBAAmB,GAAG,KAAK;;;;KAEjC;KAAA,uCAEsBgL,YAAY,EACnC;OAAA;OACCA,YAAY,CAAC9rB,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,yBAAyB,CAAC;OAC7DsvB,YAAY,CAAC9rB,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,uBAAuB,CAAC;OAC3DsvB,YAAY,CAAC9rB,SAAS,CAACvH,MAAM,CAAC+D,IAAI,CAAC,4BAA4B,CAAC;OAChEsvB,YAAY,CAAC9rB,SAAS,CAAC+rB,SAAS,GAAG,UAACr2B,MAAM,EAAEs2B,EAAE,EAC9C;SACCA,EAAE,CAAC,OAAI,CAACvK,mBAAmB,EAAE,CAAC;QAC9B;OAEDqK,YAAY,CAAC9rB,SAAS,CAACisB,gBAAgB,GAAG,UAACv2B,MAAM,EAAEs2B,EAAE,EACrD;SACC,OAAI,CAACC,gBAAgB,EAAE;SACvBD,EAAE,CAAC,EAAE,CAAC;QACN;OAEDF,YAAY,CAAC9rB,SAAS,CAACksB,eAAe,GAAG,UAACx2B,MAAM,EAAEs2B,EAAE,EACpD;SACC,OAAI,CAACE,eAAe,EAAE;SACtBF,EAAE,CAAC,EAAE,CAAC;QACN;;;KACD;KAAA,sCAGD;OACC,OAAO;SACN,SAAS,EAAE,IAAI,CAACxW,MAAM;SACtB,cAAc,EAAE,IAAI,CAACna,WAAW,KAAK,SAAS,GAAG8wB,SAAS,GAAG,IAAI,CAAC9wB,WAAW;SAC7E,aAAa,EAAE,IAAI,CAACogB,UAAU;SAC9B,WAAW,EAAE,IAAI,CAAC/F,kBAAkB;SACpC,iBAAiB,EAAE,IAAI,CAACQ,aAAa;SACrC,eAAe,EAAE,IAAI,CAACC,WAAW;SACjC,iBAAiB,EAAE,IAAI,CAACC,aAAa,KAAK,CAAC,GAAG+V,SAAS,GAAG,IAAI,CAAC/V,aAAa;SAC5E,cAAc,EAAE,IAAI,CAAC4F,WAAW;SAChC,gBAAgB,EAAE,IAAI,CAACrG,SAAS;SAChC,YAAY,EAAE,IAAI,CAAC+F,SAAS;SAC5B,gBAAgB,EAAE,IAAI,CAAClM,UAAU,GAAG;QACpC;;;KACD;KAAA,kCAGD;OACC,IAAI,IAAI,CAACjI,gBAAgB,CAAC6kB,uBAAuB,EAAE,EACnD;SACC,OAAO,KAAK;;OAGb,OAAO,IAAI,CAAC/P,MAAM,KAEhB,IAAI,CAACrG,UAAU,IACf,IAAI,CAACP,QAAQ,KAAKrV,OAAO,CAACoX,IAAI,IAC9B,IAAI,CAAC/B,QAAQ,KAAKrV,OAAO,CAACqX,KAAK,IAC/B,IAAI,CAAChC,QAAQ,KAAKrV,OAAO,CAACyX,YAAY,CACtC;;;KACF;KAAA,gCAEe1c,CAAC,EACjB;OACC,IAAI,CAAC,IAAI,CAACkxB,eAAe,EAAE,EAC3B;SACClxB,CAAC,CAACmxB,WAAW,GAAGpyB,aAAG,CAACC,UAAU,CAAC,+BAA+B,CAAC;SAC/D,OAAOD,aAAG,CAACC,UAAU,CAAC,+BAA+B,CAAC;;;;KAEvD;KAAA,4BAEWgB,CAAQ,EACpB;OACCA,CAAC,CAACQ,cAAc,EAAE;OAClB,IAAI,CAAC,IAAI,CAACsH,QAAQ,EAAE,IAAI,IAAI,CAAC6nB,WAAW,EAAE,EAC1C;SACC,IAAI,CAAC/B,IAAI,EAAE;;;;KAEZ;KAAA,qCAGD;OACC,IAAI,IAAI,CAAC/mB,MAAM,EAAE,EACjB;SACC,IAAI,CAACC,IAAI,GAAG,KAAK;SACjB1I,aAAG,CAACsI,WAAW,CAAC,IAAI,CAAC5K,QAAQ,CAACoK,OAAO,CAACc,IAAI,EAAE,QAAQ,CAAC;SACrD,IAAI,IAAI,CAACZ,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;WACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACU,QAAQ,EAAE,EAAE,CAAC;UAC3C,MAED;WACC,IAAI,CAAC1L,SAAS,CAAC2L,MAAM,EAAE;;QAExB,MAED;SACC,IAAI,CAACL,IAAI,GAAG,IAAI;SAChB1I,aAAG,CAAC6H,QAAQ,CAAC,IAAI,CAACnK,QAAQ,CAACoK,OAAO,CAACc,IAAI,EAAE,QAAQ,CAAC;SAClD,IAAI,IAAI,CAACZ,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;WACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACS,MAAM,EAAE,EAAE,CAAC;UACzC,MAED;WACC,IAAI,CAACzL,SAAS,CAACwL,IAAI,EAAE;;;OAGvB,IAAI,CAACoF,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAACrJ,eAAe,EAAE,IAAI,CAAC0D,MAAM,EAAE,CAAC;;;KACtF;KAAA,qCAGD;OACC,IAAI,IAAI,CAAChB,OAAO,EAAE,EAClB;SACC,IAAI,CAACC,KAAK,GAAG,KAAK;SAClB1H,aAAG,CAACsI,WAAW,CAAC,IAAI,CAAC5K,QAAQ,CAACoK,OAAO,CAACC,IAAI,EAAE,QAAQ,CAAC;SACrD,IAAI,IAAI,CAACC,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;WACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACG,QAAQ,EAAE,EAAE,CAAC;UAC3C,MAED;WACC,IAAI,CAACnL,SAAS,CAACoL,MAAM,EAAE;;QAExB,MAED;SACC,IAAI,CAACd,KAAK,GAAG,IAAI;SACjB1H,aAAG,CAAC6H,QAAQ,CAAC,IAAI,CAACnK,QAAQ,CAACoK,OAAO,CAACC,IAAI,EAAE,QAAQ,CAAC;SAClD,IAAI,IAAI,CAACC,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;WACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACC,MAAM,EAAE,EAAE,CAAC;UACzC,MAED;WACC,IAAI,CAACjL,SAAS,CAAC2K,IAAI,EAAE;;;OAGvB,IAAI,CAACiG,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAACtJ,eAAe,EAAE,IAAI,CAAC2C,OAAO,EAAE,CAAC;;;KACvF;KAAA,yCAGD;OAAA;OACC,IAAI,CAACurB,oBAAoB,CAAC,UAACltB,MAAM,EACjC;SACC,OAAI,CAACkI,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAACpJ,mBAAmB,EAAEc,MAAM,CAAC;SACnF,IAAI,OAAI,CAACkC,SAAS,EAAE,IAAI,OAAI,CAACC,KAAK,EAClC;WACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAAC0Y,eAAe,EAAE,CAAChb,MAAM,CAAC,CAAC;UACxD,MAED;WACC,OAAI,CAAC1I,SAAS,CAACsf,QAAQ,CAAC5W,MAAM,CAAC;;QAEhC,CAAC;;;KACF;KAAA,iDAGD;OACC,IAAI,CAACkI,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAAClJ,2BAA2B,CAAC;OACnF,IAAI,IAAI,CAAC8C,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAAC2Y,kBAAkB,EAAE,EAAE,CAAC;QACrD,MAED;SACC,IAAI,CAAC3jB,SAAS,CAAC+mB,gBAAgB,EAAE;;;;KAElC;KAAA,+CAGD;OACC,IAAI,CAACnW,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAACnJ,yBAAyB,CAAC;OACjF,IAAI,IAAI,CAAC+C,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAAC4Y,gBAAgB,EAAE,EAAE,CAAC;QACnD,MAED;SACC,IAAI,CAAC5jB,SAAS,CAACgnB,cAAc,EAAE;;;;KAEhC;KAAA,wCAGD;OAAA;OACC,IAAI,CAAC6O,MAAM,GAAG,IAAI/2B,MAAM,CAAC;SACxBI,WAAW,EAAE,IAAI,CAACoB,QAAQ,CAACoK,OAAO,CAACorB,OAAO;SAC1Ch2B,QAAQ,EAAE,IAAI;SACdG,aAAa,EAAE,uBAACuE,CAAC,EACjB;WACC,IAAIG,GAAG,GAAGH,CAAC,CAACG,GAAG;WACf,IAAI,OAAI,CAACiG,SAAS,EAAE,IAAI,OAAI,CAACC,KAAK,EAClC;aACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACgZ,sBAAsB,EAAE,CAACrf,GAAG,CAAC,CAAC;YAC5D,MAED;aACC,OAAI,CAAC3E,SAAS,CAACmnB,oBAAoB,CAACxiB,GAAG,CAAC;;WAEzC,OAAI,CAACiM,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAAC3I,kBAAkB,EAAE1D,GAAG,CAAC;UAC/E;SACDtE,OAAO,EAAE,mBACT;WACC,OAAI,CAACw1B,MAAM,CAACxzB,OAAO,EAAE;WACrB,OAAI,CAACwzB,MAAM,GAAG,IAAI;;QAEnB,CAAC;OACF,IAAI,CAACA,MAAM,CAACvvB,IAAI,EAAE;;;KAClB;KAAA,uCAGD;OACC,IAAI,CAACsK,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAACjJ,iBAAiB,CAAC;OACzE,IAAI,IAAI,CAAC6C,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACyY,QAAQ,EAAE,EAAE,CAAC;QAC3C,MAED;SACC,IAAI,CAACzjB,SAAS,CAAC8mB,MAAM,EAAE;;;;KAExB;KAAA,sCAGD;OACC,IAAI,CAAClW,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAACxI,gBAAgB,CAAC;OACxE,IAAI,IAAI,CAACoC,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAAC3K,OAAO,EAAE,EAAE,CAAC;QAC1C,MAED;SACC,IAAI,CAAC6F,KAAK,EAAE;;;;KAEb;KAAA,yCAGD;OAAA;OACC,IAAI,CAAC0K,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAAC1I,mBAAmB,CAAC;OAC3E,IAAI2G,KAAK,GAAG,EAAE;OACd,IAAI,IAAI,CAAC4J,UAAU,GAAG,CAAC,EACvB;SACC,IAAI,CAACmR,aAAa,GAAG,IAAI,CAACD,aAAa;SAEvC,IAAI,IAAI,CAACA,aAAa,CAAC7T,MAAM,CAAC5T,MAAM,KAAK,CAAC,EAC1C;;WAEC,IAAI,CAACuzB,MAAM,GAAG,IAAI/2B,MAAM,CAAC;aACxBI,WAAW,EAAE,IAAI,CAACoB,QAAQ,CAACoK,OAAO,CAACqrB,IAAI,GAAG,IAAI,CAACz1B,QAAQ,CAACoK,OAAO,CAACqrB,IAAI,GAAG,IAAI;aAC3E11B,OAAO,EAAE,mBACT;eACC,OAAI,CAACw1B,MAAM,CAACxzB,OAAO,EAAE;eACrB,OAAI,CAACwzB,MAAM,GAAG,IAAI;cAClB;aACD11B,MAAM,EAAE,gBAACqE,CAAC,EACV;eACC,OAAI,CAACqxB,MAAM,CAAC3vB,KAAK,EAAE;eACnB,OAAI,CAACxB,WAAW,GAAGF,CAAC,CAACE,WAAW;eAChC,OAAI,CAACqmB,WAAW,EAAE,CAACC,IAAI,CAAC,UAAAlf,KAAK;iBAAA,OAAI,OAAI,CAACD,QAAQ,CAACC,KAAK,CAAC;iBAAC;eAEtDmD,KAAK,GAAG;iBACPvK,WAAW,EAAEF,CAAC,CAACE,WAAW;iBAC1B6a,aAAa,EAAE,OAAI,CAACA,aAAa;iBACjCC,WAAW,EAAE,OAAI,CAACA,WAAW;iBAC7B3G,UAAU,EAAE,OAAI,CAACA;gBACjB;eAED,IAAI,OAAI,CAACjO,SAAS,EAAE,IAAI,OAAI,CAACC,KAAK,EAClC;iBACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACsY,kBAAkB,EAAE,CAACrU,KAAK,CAAC,CAAC;gBAC1D,MAED;iBACC,OAAI,CAACjP,SAAS,CAAC2mB,gBAAgB,CAAC1X,KAAK,CAAC;;;YAGxC,CAAC;WACF,IAAI,CAAC4mB,MAAM,CAACvvB,IAAI,EAAE;UAClB,MACI,IAAI,IAAI,CAACyjB,aAAa,CAAC7T,MAAM,CAAC5T,MAAM,IAAI,CAAC,EAC9C;;WAEC2M,KAAK,CAACvK,WAAW,GAAG,IAAI,CAACqlB,aAAa,CAAC7T,MAAM,CAAC,CAAC,CAAC,CAACmB,KAAK;WACtDpI,KAAK,CAACsQ,aAAa,GAAG,IAAI,CAACA,aAAa;WACxCtQ,KAAK,CAACuQ,WAAW,GAAG,IAAI,CAACA,WAAW;WACpCvQ,KAAK,CAAC4J,UAAU,GAAG,IAAI,CAACA,UAAU;WAClC,IAAI,IAAI,CAACjO,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;aACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACsY,kBAAkB,EAAE,CAACrU,KAAK,CAAC,CAAC;YAC1D,MAED;aACC,IAAI,CAACjP,SAAS,CAAC2mB,gBAAgB,CAAC1X,KAAK,CAAC;;UAEvC,MAED;;WAEC,IAAI,CAAC+mB,oBAAoB,CAAC;aACzB92B,WAAW,EAAE,IAAI,CAACoB,QAAQ,CAACoK,OAAO,CAACqrB,IAAI,GAAG,IAAI,CAACz1B,QAAQ,CAACoK,OAAO,CAACqrB,IAAI,GAAG,IAAI;aAC3EE,YAAY,EAAE,IAAI,CAAClM,aAAa,CAAC7T,MAAM;aACvCggB,QAAQ,EAAE,kBAAC1xB,CAAC,EACZ;eACC,OAAI,CAAC2xB,qBAAqB,EAAE;eAC5B,OAAI,CAACzxB,WAAW,GAAGF,CAAC,CAACE,WAAW;eAChC,OAAI,CAACqmB,WAAW,EAAE,CAACC,IAAI,CAAC,UAAAlf,KAAK;iBAAA,OAAI,OAAI,CAACD,QAAQ,CAACC,KAAK,CAAC;iBAAC;eAEtDmD,KAAK,GAAG;iBACPvK,WAAW,EAAEF,CAAC,CAACE,WAAW;iBAC1B6a,aAAa,EAAE,OAAI,CAACA,aAAa;iBACjCC,WAAW,EAAE,OAAI,CAACA,WAAW;iBAC7B3G,UAAU,EAAE,OAAI,CAACA;gBACjB;eAED,IAAI,OAAI,CAACjO,SAAS,EAAE,IAAI,OAAI,CAACC,KAAK,EAClC;iBACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACsY,kBAAkB,EAAE,CAACrU,KAAK,CAAC,CAAC;gBAC1D,MAED;iBACC,OAAI,CAACjP,SAAS,CAAC2mB,gBAAgB,CAAC1X,KAAK,CAAC;;;YAGxC,CAAC;;QAEH,MAED;SACC,IAAI,IAAI,CAACrE,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;WACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACqY,UAAU,EAAE,CAAC,IAAI,CAAC3e,WAAW,CAAC,CAAC;UAC7D,MAED;WACC,IAAI,CAAC1E,SAAS,CAAC2b,QAAQ,CAAC,IAAI,CAACjX,WAAW,CAAC;;;;;KAG3C;KAAA,qCAGD;OACC,IAAI,CAAC,IAAI,CAAColB,YAAY,EACtB;SACC;;OAGD,IAAI,CAAClZ,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAAChJ,eAAe,CAAC;OACvE,IAAI,CAAC+B,UAAU,CAACN,OAAO,CAAC4W,QAAQ,CAAC;OACjC,IAAI,CAACyJ,YAAY,CAACsM,cAAc,EAAE;OAClC,IAAI,CAACrqB,aAAa,CAAC,EAAE,CAAC;;;KACtB;KAAA,qCAEoBvH,CAAC,EACtB;;KAEC;KAAA,oCAGD;OACC,IAAI,CAACwhB,OAAO,GAAG,IAAI,CAAC1lB,QAAQ,CAAC8qB,aAAa,CAAC/nB,KAAK;;OAEhD,IAAI,CAACgzB,oBAAoB,EAAE;;;KAC3B;KAAA,2CAGD;OACC,IAAI,CAACpQ,YAAY,GAAG,CAAC,IAAI,CAACA,YAAY;OACtC,IAAI,IAAI,CAACrb,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACiZ,cAAc,EAAE,CAAC,IAAI,CAACgC,YAAY,CAAC,CAAC;;OAGnE,IAAI,IAAI,CAACA,YAAY,EACrB;SACC,IAAI,IAAI,CAAC3lB,QAAQ,CAAC4qB,UAAU,CAACoL,UAAU,EACvC;WACC1zB,aAAG,CAAC6H,QAAQ,CAAC,IAAI,CAACnK,QAAQ,CAAC4qB,UAAU,CAACoL,UAAU,EAAE,iCAAiC,CAAC;WACpF,IAAI,CAACh2B,QAAQ,CAAC4qB,UAAU,CAACmJ,eAAe,CAAC7xB,SAAS,GAAGe,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC;;SAE/F,IAAI,IAAI,CAAClD,QAAQ,CAAC8qB,aAAa,EAC/B;WACC,IAAI,CAAC9qB,QAAQ,CAAC8qB,aAAa,CAAC/nB,KAAK,GAAG,IAAI,CAAC2iB,OAAO;WAChD,IAAI,CAAC1lB,QAAQ,CAAC8qB,aAAa,CAAChmB,KAAK,EAAE;;SAGpC,IAAI,IAAI,CAAC9E,QAAQ,CAAC6qB,sBAAsB,EACxC;WACC,IAAI,CAAC7qB,QAAQ,CAAC6qB,sBAAsB,CAAC/e,KAAK,CAAC4N,cAAc,CAAC,SAAS,CAAC;;QAErE,MAED;SAEC,IAAI,IAAI,CAAC1Z,QAAQ,CAAC4qB,UAAU,CAACoL,UAAU,EACvC;WACC1zB,aAAG,CAACsI,WAAW,CAAC,IAAI,CAAC5K,QAAQ,CAAC4qB,UAAU,CAACoL,UAAU,EAAE,iCAAiC,CAAC;WACvF,IAAI,CAACh2B,QAAQ,CAAC4qB,UAAU,CAACmJ,eAAe,CAAC7xB,SAAS,GAAGe,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC;;SAGnG,IAAI,IAAI,CAAClD,QAAQ,CAAC6qB,sBAAsB,EACxC;WACC,IAAI,CAAC7qB,QAAQ,CAAC6qB,sBAAsB,CAAC/e,KAAK,CAACC,OAAO,GAAG,MAAM;;SAG5D,IAAI,IAAI,CAACzB,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;WACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACkZ,aAAa,EAAE,CAAC,IAAI,CAAC8B,OAAO,CAAC,CAAC;UAC5D,MAED;WACC,IAAI,CAACoB,WAAW,EAAE;;SAGnB,IAAI,CAACxW,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAACvJ,qBAAqB,EAAE,IAAI,CAACue,OAAO,CAAC;;;;KAE5F;KAAA,wCAGD;OACC,IAAI1R,GAAG,GAAG,IAAI,CAACiiB,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC;OACxC,IAAIC,eAAe,GAAG,IAAI,CAACC,wBAAwB,EAAE;OACrD,IAAI,IAAI,CAAClX,aAAa,KAAK,SAAS,EACpC;SACCjL,GAAG,GAAGoiB,aAAG,CAACC,QAAQ,CAACriB,GAAG,EAAE;WAACsiB,UAAU,EAAE,IAAI,CAACpX;UAAY,CAAC;QACvD,MACI,IAAI,IAAI,CAACD,aAAa,KAAK,SAAS,EACzC;SACCjL,GAAG,GAAGoiB,aAAG,CAACC,QAAQ,CAACriB,GAAG,EAAE;WAACuiB,UAAU,EAAE,IAAI,CAACrX;UAAY,CAAC;;OAGxDlL,GAAG,GAAGoiB,aAAG,CAACC,QAAQ,CAACriB,GAAG,EAAE;SAACwiB,gBAAgB,EAAEN;QAAgB,CAAC;OAC5D,IAAI,IAAI,CAAC3d,UAAU,GAAG,CAAC,EACvB;SACCvE,GAAG,GAAGoiB,aAAG,CAACC,QAAQ,CAACriB,GAAG,EAAE;WAACyiB,YAAY,EAAE,IAAI,CAACle;UAAW,CAAC;SACxDvE,GAAG,GAAGoiB,aAAG,CAACC,QAAQ,CAACriB,GAAG,EAAE;WAAC0iB,iBAAiB,EAAE,IAAI,CAACjN,aAAa,CAAC9oB;UAAG,CAAC;;OAGpE,IAAI,CAACyjB,gBAAgB,CAAC8R,eAAe,CAAC,GAAG;SACxCpzB,IAAI,EAAE,KAAK;SACXmhB,OAAO,EAAEiS,eAAe;SACxB3nB,MAAM,EAAEA,MAAM,CAAC4I,IAAI,CAACnD,GAAG;QACvB;;;KACD;KAAA,2CAGD;OACC,IAAIA,GAAG,GAAG,IAAI,CAACiiB,cAAc,CAAC,SAAS,EAAE,CAAC,CAAC;OAC3C,IAAMC,eAAe,GAAG,IAAI,CAACC,wBAAwB,EAAE;OAEvDniB,GAAG,GAAGoiB,aAAG,CAACC,QAAQ,CAACriB,GAAG,EAAE;SAAC2iB,QAAQ,EAAE;QAAI,CAAC;OACxC,IAAI,IAAI,CAAC1X,aAAa,KAAK,SAAS,EACpC;SACCjL,GAAG,GAAGoiB,aAAG,CAACC,QAAQ,CAACriB,GAAG,EAAE;WAAC4iB,OAAO,EAAE,IAAI,CAAC1X;UAAY,CAAC;QACpD,MACI,IAAI,IAAI,CAACD,aAAa,KAAK,SAAS,EACzC;SACCjL,GAAG,GAAGoiB,aAAG,CAACC,QAAQ,CAACriB,GAAG,EAAE;WAAC6iB,OAAO,EAAE,IAAI,CAAC3X;UAAY,CAAC;;OAGrDlL,GAAG,GAAGoiB,aAAG,CAACC,QAAQ,CAACriB,GAAG,EAAE;SAACwiB,gBAAgB,EAAEN;QAAgB,CAAC;OAC5D,IAAI,IAAI,CAAC3d,UAAU,GAAG,CAAC,EACvB;SACCvE,GAAG,GAAGoiB,aAAG,CAACC,QAAQ,CAACriB,GAAG,EAAE;WAACyiB,YAAY,EAAE,IAAI,CAACle;UAAW,CAAC;SACxDvE,GAAG,GAAGoiB,aAAG,CAACC,QAAQ,CAACriB,GAAG,EAAE;WAAC0iB,iBAAiB,EAAE,IAAI,CAACjN,aAAa,CAAC9oB;UAAG,CAAC;;OAGpE,IAAI,CAACyjB,gBAAgB,CAAC8R,eAAe,CAAC,GAAG;SACxCpzB,IAAI,EAAE,KAAK;SACXmhB,OAAO,EAAEiS,eAAe;SACxB3nB,MAAM,EAAEA,MAAM,CAAC4I,IAAI,CAACnD,GAAG;QACvB;;;KACD;KAAA,wCAGD;OACC,IAAIA,GAAG,GAAG,IAAI,CAACiiB,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC;OACxCjiB,GAAG,GAAGoiB,aAAG,CAACC,QAAQ,CAACriB,GAAG,EAAE;SACvB8C,KAAK,EAAE,IAAI,CAAC1S,WAAW;SACvB0yB,SAAS,EAAE,KAAK,GAAG,IAAI,CAACvY;QACxB,CAAC;OACFhQ,MAAM,CAAC4I,IAAI,CAACnD,GAAG,CAAC;;;KAChB;KAAA,2CAGD;OACC,IAAIA,GAAG,GAAG,IAAI,CAACiiB,cAAc,CAAC,SAAS,EAAE,CAAC,CAAC;OAC3CjiB,GAAG,GAAGoiB,aAAG,CAACC,QAAQ,CAACriB,GAAG,EAAE;SACvB8C,KAAK,EAAE,IAAI,CAAC1S,WAAW;SACvB0yB,SAAS,EAAE,KAAK,GAAG,IAAI,CAACvY;QACxB,CAAC;OACFhQ,MAAM,CAAC4I,IAAI,CAACnD,GAAG,CAAC;;;KAChB;KAAA,qCAGD;OACC,IAAI,CAAC8d,IAAI,EAAE;;;KACX;KAAA,uCAGD;OACC,IAAI,CAACxhB,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAAC9I,iBAAiB,CAAC;OACzE,IAAI,IAAI,CAAC0C,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACuY,QAAQ,EAAE,EAAE,CAAC;QAC3C,MAED;SACC,IAAI,CAACvjB,SAAS,CAAC4mB,MAAM,EAAE;;;;KAExB;KAAA,qCAGD;OACC,IAAI,CAAChW,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAAC/I,eAAe,CAAC;OACvE,IAAI,IAAI,CAAC2C,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACwY,MAAM,EAAE,EAAE,CAAC;QACzC,MAED;SACC,IAAI,CAACxjB,SAAS,CAAC6mB,IAAI,EAAE;;;;KAEtB;KAAA,6CAGD;OACC,IAAI,IAAI,CAACjc,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAAC8Y,cAAc,EAAE,CAAC;WAC9Cpf,WAAW,EAAE,IAAI,CAACA;UAClB,CAAC,CAAC;QACH,MAED;SACC,IAAI,CAAC1E,SAAS,CAACinB,YAAY,CAAC;WAC3BviB,WAAW,EAAE,IAAI,CAACA;UAClB,CAAC;;;;KAEH;KAAA,uCAGD;OAAA;OACC,IAAI,CAAC2yB,gBAAgB,CAAC;SACrBnB,QAAQ,EAAE,kBAACnQ,YAAY,EACvB;WACC,OAAI,CAACnV,gBAAgB,CAACM,SAAS,CAACF,sBAAsB,CAAC5I,iBAAiB,EAAE2d,YAAY,CAAC;WACvF,OAAI,CAACA,YAAY,GAAGA,YAAY;WAChC,OAAI,CAACuR,iBAAiB,EAAE;WACxB,IAAI,OAAI,CAAC1sB,SAAS,EAAE,IAAI,OAAI,CAACC,KAAK,EAClC;aACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAAC+Y,eAAe,EAAE,CAACgC,YAAY,CAAC,CAAC;YAC9D,MAED;aACC,OAAI,CAAC/lB,SAAS,CAACknB,aAAa,CAACnB,YAAY,CAAC;;;QAG5C,CAAC;;;KACF;KAAA,gCA6CewR,OAAO,EAAEx4B,MAAM,EAC/B;OACC,IAAIw4B,OAAO,KAAK,gBAAgB,EAChC;SACC,IAAIx4B,MAAM,CAACmY,IAAI,KAAK,mBAAmB,IAAInY,MAAM,CAACy4B,WAAW,IAAI,KAAK,EACtE;WACC,IAAIC,WAAW,GAAG14B,MAAM,CAAC24B,MAAM;WAC/B,IAAI,IAAI,CAAChT,gBAAgB,CAAC+S,WAAW,CAAClT,OAAO,CAAC,EAC9C;aACC,IAAIhF,aAAa,GAAGkY,WAAW,CAACnT,cAAc;aAC9C,IAAI9E,WAAW,GAAGiY,WAAW,CAAC9S,UAAU,CAAC1jB,EAAE;aAE3C,IAAI,IAAI,CAAC6oB,YAAY,EACrB;eACC,IAAI8K,cAAc,GAAG,IAAI,CAAC9K,YAAY,CAAC+K,iBAAiB,EAAE;;;;;;;KAK9D;KAAA,uCAEsB8C,MAAM,EAC7B;OAAA;OACC,IAAI,CAAC5N,aAAa,GAAG4N,MAAM;OAC3B,IAAI,CAACpY,aAAa,GAAGoY,MAAM,CAACv0B,IAAI;OAChC,IAAI,CAACoc,WAAW,GAAGmY,MAAM,CAAC12B,EAAE;OAC5B,IAAI,CAAC+kB,OAAO,GAAG,EAAE;OAEjB,IAAIhnB,cAAI,CAAC0G,OAAO,CAACiyB,MAAM,CAAC3hB,QAAQ,CAAC,EACjC;SACC,IAAI,CAACqP,WAAW,GAAGsS,MAAM,CAAC3hB,QAAQ,CAACnS,GAAG,CAAC,UAACR,KAAK,EAC5C;WACC,OAAO;aAAC,aAAa,EAAEA,KAAK,CAACD,IAAI;aAAE,WAAW,EAAEC,KAAK,CAACpC;YAAG;UACzD,CACD;QACD,MAED;SACC,IAAI,CAACokB,WAAW,GAAG,EAAE;;OAGtB,IAAIsS,MAAM,CAACzhB,MAAM,CAAC5T,MAAM,GAAG,CAAC,EAC5B;SACC,IAAI,CAACoC,WAAW,GAAGizB,MAAM,CAACzhB,MAAM,CAAC,CAAC,CAAC,CAACmB,KAAK;QACzC,MAED;SACC,IAAI,CAAC3S,WAAW,GAAG,SAAS;;OAG7B,IAAI,CAACqmB,WAAW,EAAE,CAACC,IAAI,CAAC,UAAAlf,KAAK;SAAA,OAAI,OAAI,CAACD,QAAQ,CAACC,KAAK,CAAC;SAAC;OACtD,IAAI,CAAC8Y,WAAW,CAAC+S,MAAM,CAACv0B,IAAI,EAAEu0B,MAAM,CAAC12B,EAAE,CAAC;OACxC,IAAI,IAAI,CAAC2oB,cAAc,KAAK,SAAS,EACrC;SACC,IAAI,CAACkF,WAAW,CAAC9c,MAAM,EAAE;SACzB,IAAI,CAAC8c,WAAW,CAAC/c,IAAI,CAAC;WACrB9Q,EAAE,EAAE,IAAI,CAACwZ,SAAS;WAClBvI,OAAO,EAAE,IAAI,CAACwI,cAAc;WAC5BvI,IAAI,EAAE5O,aAAG,CAACC,UAAU,CAAC,aAAa;UAClC,CAAC;;OAEH,IAAI,IAAI,CAACsb,QAAQ,KAAKrV,OAAO,CAACwX,MAAM,EACpC;SACC,IAAI,CAAClX,UAAU,CAACN,OAAO,CAAC4W,QAAQ,CAAC;;OAGlC,IAAI,CAACoM,UAAU,EAAE;;;KACjB;KAAA,+BASD;OACC,IAAI,CAAC,IAAI,CAAC3C,YAAY,EACtB;SACC;;OAGD,IAAI,CAAC,IAAI,CAACE,aAAa,EACvB;SACC;;OAGD,IAAI,CAACF,YAAY,CAAC3V,iBAAiB,CAAC,IAAI,CAAC6V,aAAa,CAACzU,QAAQ,EAAE,IAAI,CAACyU,aAAa,CAACpkB,KAAK,CAAC;;;KAC1F;KAAA,+BAGD;OACC,IAAI,CAAC,IAAI,CAACkkB,YAAY,EACtB;SACC;;OAGD,IAAI,CAACA,YAAY,CAAC8N,mBAAmB,EAAE;;;KACvC;KAAA,iCAGD;OACC,OAAO,CAAC,CAAC,IAAI,CAAC1R,aAAa;;;KAC3B;KAAA,6BAGD;OACC,IAAI,IAAI,CAAC9b,cAAc,EAAE,EACzB;SACC;;OAGD,IAAI,IAAI,CAACoC,gBAAgB,KAAK,CAAC,EAC/B;SACC,IAAI,CAACA,gBAAgB,GAAI,IAAIqrB,IAAI,EAAE,CAAEC,OAAO,EAAE;;OAE/C,IAAI,CAAC5R,aAAa,GAAG6R,WAAW,CAAC,IAAI,CAACvE,WAAW,CAACxxB,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC;OACnE,IAAI,CAACwxB,WAAW,EAAE;;;KAClB;KAAA,8BAGD;OACC,IAAI,CAAC,IAAI,CAAClzB,QAAQ,CAAC2L,KAAK,EACxB;SACC;;OAGD,IAAI+rB,gBAAgB,GAAI,IAAIH,IAAI,EAAE,CAAEC,OAAO,EAAE;OAC7C,IAAIG,mBAAmB,GAAID,gBAAgB,GAAG,IAAI,CAACxrB,gBAAiB;OAEpE,IAAI0rB,cAAc,GAAGxhB,IAAI,CAAC0X,KAAK,CAAC6J,mBAAmB,GAAG,IAAI,CAAC;OAC3D,IAAIE,OAAO,GAAGzhB,IAAI,CAAC0X,KAAK,CAAC8J,cAAc,GAAG,EAAE,CAAC,CAAC7e,QAAQ,EAAE;OACxD,IAAI8e,OAAO,CAAC71B,MAAM,GAAG,CAAC,EACtB;SACC61B,OAAO,GAAG,GAAG,GAAGA,OAAO;;OAExB,IAAIC,OAAO,GAAG,CAACF,cAAc,GAAG,EAAE,EAAE7e,QAAQ,EAAE;OAC9C,IAAI+e,OAAO,CAAC91B,MAAM,GAAG,CAAC,EACtB;SACC81B,OAAO,GAAG,GAAG,GAAGA,OAAO;;OAExB,IAAMC,QAAQ,GAAI,IAAI,CAACC,WAAW,EAAE,GAAG/0B,aAAG,CAACC,UAAU,CAAC,4BAA4B,CAAC,GAAGD,aAAG,CAACC,UAAU,CAAC,+BAA+B,CAAE;OAEtI,IAAI,IAAI,CAAC8I,QAAQ,EAAE,EACnB;SACC,IAAI,CAAChM,QAAQ,CAAC2L,KAAK,CAACzJ,SAAS,GAAG21B,OAAO,GAAG,GAAG,GAAGC,OAAO;QACvD,MAED;SACC,IAAI,CAAC93B,QAAQ,CAAC2L,KAAK,CAACzJ,SAAS,GAAG61B,QAAQ,CAACvhB,OAAO,CAAC,OAAO,EAAEqhB,OAAO,CAAC,CAACrhB,OAAO,CAAC,OAAO,EAAEshB,OAAO,CAAC;;;;KAE7F;KAAA,4BAGD;OACC,IAAI,CAAC,IAAI,CAAChuB,cAAc,EAAE,EAC1B;SACC;;OAGDmuB,aAAa,CAAC,IAAI,CAACrS,aAAa,CAAC;OACjC,IAAI,CAACA,aAAa,GAAG,IAAI;;;KACzB;KAAA,iCAEgBnnB,MAAM,EACvB;OAAA;OACC,IAAI,CAACC,cAAI,CAACC,aAAa,CAACF,MAAM,CAAC,EAC/B;SACCA,MAAM,GAAG,EAAE;;OAGZ,IAAI,CAACC,cAAI,CAACkB,UAAU,CAACnB,MAAM,CAACm3B,QAAQ,CAAC,EACrC;SACCn3B,MAAM,CAACm3B,QAAQ,GAAGt3B,GAAG;;OAGtB,IAAM0B,QAAQ,GAAG;SAChB,GAAG,EAAE,IAAI;SACT,GAAG,EAAE,IAAI;SACT,GAAG,EAAE,IAAI;SACT,GAAG,EAAE,IAAI;SACT,GAAG,EAAE;QACL;OAED,IAAI,CAACwlB,YAAY,GAAG,IAAI1jB,gBAAK,CAAC;SAC7BnB,EAAE,EAAE,2BAA2B;SAC/B/B,WAAW,EAAE,IAAI,CAACoB,QAAQ,CAAC+qB,YAAY;SACvCnqB,eAAe,EAAEC,QAAQ,CAACC,IAAI;SAC9BC,QAAQ,EAAE,IAAI;SACdC,UAAU,EAAE,IAAI;SAChBC,QAAQ,EAAE,IAAI;SACd1B,MAAM,EAAElB,UAAU,GAAG,GAAG;SACxB+C,aAAa,EAAE,IAAI;SACnBC,OAAO,EAAE;WACRC,eAAe,EAAE,OAAO;WACxBC,OAAO,EAAE;UACT;SACDuE,WAAW,EAAE;WACZlE,QAAQ,EAAE;UACV;SACDD,KAAK,EAAE;WACNC,QAAQ,EAAE,QAAQ;WAClBC,MAAM,EAAE;UACR;SACDq2B,SAAS,EAAE,KAAK;SAChBh3B,OAAO,EAAEoB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;WAC1BC,KAAK,EAAE;aAACC,SAAS,EAAE;YAAwB;WAAEC,QAAQ,EAAE,CACtDJ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAACC,SAAS,EAAE;cAA8B;aACjDoB,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,iCAAiC;YACtD,CAAC,EACFZ,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;aACjBC,KAAK,EAAE;eAACC,SAAS,EAAE;cAA8B;aAAEC,QAAQ,EAAE,CAC5D1C,QAAQ,CAAC,GAAG,CAAC,GAAGm4B,UAAU,CAAC,CAAC,EAAE,IAAI,CAAC1S,YAAY,IAAI,GAAG,EAAEhnB,MAAM,CAACm3B,QAAQ,CAAC,EACxE51B,QAAQ,CAAC,GAAG,CAAC,GAAGm4B,UAAU,CAAC,CAAC,EAAE,IAAI,CAAC1S,YAAY,IAAI,GAAG,EAAEhnB,MAAM,CAACm3B,QAAQ,CAAC,EACxE51B,QAAQ,CAAC,GAAG,CAAC,GAAGm4B,UAAU,CAAC,CAAC,EAAE,IAAI,CAAC1S,YAAY,IAAI,GAAG,EAAEhnB,MAAM,CAACm3B,QAAQ,CAAC,EACxE51B,QAAQ,CAAC,GAAG,CAAC,GAAGm4B,UAAU,CAAC,CAAC,EAAE,IAAI,CAAC1S,YAAY,IAAI,GAAG,EAAEhnB,MAAM,CAACm3B,QAAQ,CAAC,EACxE51B,QAAQ,CAAC,GAAG,CAAC,GAAGm4B,UAAU,CAAC,CAAC,EAAE,IAAI,CAAC1S,YAAY,IAAI,GAAG,EAAEhnB,MAAM,CAACm3B,QAAQ,CAAC,CACxE;aAAEp0B,MAAM,EAAE;eACV42B,SAAS,EAAE,qBACX;iBACC,IAAIp4B,QAAQ,CAAC,OAAI,CAACylB,YAAY,CAAC,EAC/B;mBACCnjB,aAAG,CAACsI,WAAW,CAAC5K,QAAQ,CAAC,OAAI,CAACylB,YAAY,CAAC,EAAE,yCAAyC,CAAC;;gBAExF;eACD4S,QAAQ,EAAE,oBACV;iBACC,IAAIr4B,QAAQ,CAAC,OAAI,CAACylB,YAAY,CAAC,EAC/B;mBACCnjB,aAAG,CAAC6H,QAAQ,CAACnK,QAAQ,CAAC,OAAI,CAACylB,YAAY,CAAC,EAAE,yCAAyC,CAAC;;;;YAIvF,CAAC;UAEH,CAAC;SACFjkB,MAAM,EAAE;WACPC,YAAY,EAAE;aAAA,OAAM,OAAI,CAAC+jB,YAAY,GAAG,IAAI;;;QAE7C,CAAC;OAEF,IAAI,CAACA,YAAY,CAACxf,IAAI,EAAE;;;KACxB;KAAA,oCAGD;OACC,IAAI,IAAI,CAACwf,YAAY,EACrB;SACC,IAAI,CAACA,YAAY,CAAC5f,KAAK,EAAE;;;;KAE1B;KAAA,8BAGD;OACC,IAAI,CAAClG,SAAS,CAAConB,WAAW,CAAC;SAC1BvI,MAAM,EAAE,IAAI,CAACA,MAAM;SACnBmH,OAAO,EAAE,IAAI,CAACA;QACd,CAAC;;;KACF;KAAA,qCAEoBjnB,MAAM,EAC3B;OAAA;OACC,IAAI0G,SAAS,GAAG,EAAE;OAClB,IAAI,CAACzG,cAAI,CAACC,aAAa,CAACF,MAAM,CAAC,EAC/B;SACCA,MAAM,GAAG,EAAE;;OAGZ,IAAI,CAACC,cAAI,CAAC0G,OAAO,CAAC3G,MAAM,CAACk3B,YAAY,CAAC,EACtC;SACC;;OAGDl3B,MAAM,CAACm3B,QAAQ,GAAGl3B,cAAI,CAACkB,UAAU,CAACnB,MAAM,CAACm3B,QAAQ,CAAC,GAAGn3B,MAAM,CAACm3B,QAAQ,GAAG1rB,EAAE,CAACiF,SAAS;OACnF1Q,MAAM,CAACk3B,YAAY,CAACtwB,OAAO,CAAC,UAACjB,WAAW,EACxC;SACCe,SAAS,CAACI,IAAI,CAAC;WACd5E,EAAE,EAAE,gBAAgB,GAAGuJ,EAAE,CAACouB,IAAI,CAACC,eAAe,CAAC,EAAE,CAAC;WAClD10B,IAAI,EAAEO,WAAW,CAAC2S,KAAK;WACvBrR,OAAO,EAAE,mBACT;aACCjH,MAAM,CAACm3B,QAAQ,CAAC;eACfxxB,WAAW,EAAEA,WAAW,CAAC2S;cACzB,CAAC;;UAEH,CAAC;QACF,CAAC;OAEF,IAAI,CAAC4S,gBAAgB,GAAG,IAAI9jB,eAAI,CAC/B,kCAAkC,EAClCpH,MAAM,CAACG,WAAW,EAClBuG,SAAS,EACT;SACClE,QAAQ,EAAE,IAAI;SACdpC,SAAS,EAAE,CAAC;SACZC,UAAU,EAAE,EAAE;SACd6C,KAAK,EAAE;WAACC,QAAQ,EAAE;UAAM;SACxBrC,MAAM,EAAElB,UAAU,GAAG,GAAG;SACxB2C,UAAU,EAAE,IAAI;SAChBK,OAAO,EAAE;WACRC,eAAe,EAAE,OAAO;WACxBC,OAAO,EAAE;UACT;SACDC,MAAM,EAAE;WACPC,YAAY,EAAE;aAAA,OAAM,OAAI,CAACkoB,gBAAgB,CAAC5nB,OAAO,EAAE;;WACnDgE,cAAc,EAAE;aAAA,OAAM,OAAI,CAAC4jB,gBAAgB,GAAG,IAAI;;;QAEnD,CACD;OACD,IAAI,CAACA,gBAAgB,CAAC3jB,IAAI,EAAE;;;KAC5B;KAAA,wCAGD;OACC,IAAI,IAAI,CAAC2jB,gBAAgB,EACzB;SACC,IAAI,CAACA,gBAAgB,CAAC/jB,KAAK,EAAE;;;;KAE9B;KAAA,uBAGD;OACC,IAAI,CAAC,IAAI,CAACiuB,WAAW,EAAE,EACvB;SACC,OAAO,KAAK;;OAGb,IAAI,IAAI,CAACtb,UAAU,GAAG,CAAC,IAAI,IAAI,CAACkM,SAAS,KAAK5D,SAAS,CAACN,IAAI,EAC5D;SACC,IAAI,CAACiY,YAAY,EAAE;QACnB,MAED;SACC,IAAI,CAACC,QAAQ,EAAE;;;;KAEhB;KAAA,yBAGD;OACC,IAAI,CAAC,IAAI,CAACnuB,SAAS,EAAE,IAAI,IAAI,CAAC0B,QAAQ,EAAE,EACxC;SACC1J,aAAG,CAAC0Y,MAAM,CAAC,IAAI,CAAChb,QAAQ,CAAC2qB,IAAI,CAAC;SAC9B,IAAI,CAACvF,MAAM,GAAG,KAAK;SACnB,IAAI,CAACplB,QAAQ,GAAG,IAAI,CAACiM,gBAAgB;SACrC,IAAI,CAACjG,IAAI,EAAE;;;;KAEZ;KAAA,2BAGD;OAAA;OACC,IAAI,IAAI,CAACsE,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC9J,KAAK,EACnC;SACC;;OAGD,IAAIk4B,SAAS,GAAG,IAAI,CAACl4B,KAAK,CAACm4B,iBAAiB,EAAE;OAC9C,IAAIC,WAAW,GAAG,IAAI,CAACp4B,KAAK,CAACa,OAAO,CAAC6O,OAAO;OAE5C5N,aAAG,CAAC6H,QAAQ,CAACuuB,SAAS,EAAE,4BAA4B,CAAC;OACrDp2B,aAAG,CAAC6H,QAAQ,CAACyuB,WAAW,EAAE,iDAAiD,CAAC;OAC5E5zB,UAAU,CAAC,YACX;SACC,OAAI,CAACogB,MAAM,GAAG,IAAI;SAClB,OAAI,CAAC5kB,KAAK,CAACoF,KAAK,EAAE;SAClB,OAAI,CAACqG,gBAAgB,GAAG,OAAI,CAACjM,QAAQ;SACrCsC,aAAG,CAACsI,WAAW,CAAC8tB,SAAS,EAAE,4BAA4B,CAAC;SACxDp2B,aAAG,CAACsI,WAAW,CAACguB,WAAW,EAAE,iDAAiD,CAAC;SAC/E,OAAI,CAACvM,MAAM,EAAE;SACb,OAAI,CAACwM,oBAAoB,EAAE;QAC3B,EAAE,GAAG,CAAC;;;KACP;KAAA,+BAGD;OAAA;OACC,IAAMH,SAAS,GAAG,IAAI,CAACl4B,KAAK,CAACm4B,iBAAiB,EAAE;OAChD,IAAMC,WAAW,GAAG,IAAI,CAACp4B,KAAK,CAACa,OAAO,CAAC6O,OAAO;OAE9C5N,aAAG,CAAC6H,QAAQ,CAACuuB,SAAS,EAAE,4BAA4B,CAAC;OACrDp2B,aAAG,CAAC6H,QAAQ,CAACyuB,WAAW,EAAE,iDAAiD,CAAC;OAC5E5zB,UAAU,CACT,YACA;SACC,OAAI,CAACY,KAAK,EAAE;SACZ,OAAI,CAAC0kB,cAAc,CAACwH,IAAI,CAAC;WACxBvZ,UAAU,EAAE,OAAI,CAACA,UAAU;WAC3B4B,SAAS,EAAE,OAAI,CAACA,SAAS;WACzBC,cAAc,EAAE,OAAI,CAACA,cAAc;WACnCxH,gBAAgB,EAAE,OAAI,CAAC4W,YAAY,CAAC5W,gBAAgB;WACpDsI,mBAAmB,EAAE,OAAI,CAACsO,YAAY,CAAC9W,eAAe;WACtD4H,UAAU,EAAE,OAAI,CAACkP,YAAY,CAAChX,QAAQ;WACtCD,UAAU,EAAE,OAAI,CAACiX,YAAY,CAACjX;UAC9B,EAAE,IAAI,CAAC;QACR,EACD,GAAG,CACH;;;KACD;KAAA,yCAGD;OAAA;OACCuK,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACa,QAAQ,EAAE,IAAI,CAACA,QAAQ,CAAC7J,IAAI,CAAC,IAAI,CAAC,CAAC;OACtEob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACqX,SAAS,EAAE,IAAI,CAACtW,aAAa,CAAC/J,IAAI,CAAC,IAAI,CAAC,CAAC;OAC5Eob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACjB,UAAU,EAAE,IAAI,CAACA,UAAU,CAAC/H,IAAI,CAAC,IAAI,CAAC,CAAC;OAC1Eob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACsX,aAAa,EAAE,IAAI,CAACA,aAAa,CAACtgB,IAAI,CAAC,IAAI,CAAC,CAAC;OAChFob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACuX,YAAY,EAAE,IAAI,CAACA,YAAY,CAACvgB,IAAI,CAAC,IAAI,CAAC,CAAC;OAC9Eob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAAC8X,aAAa,EAAE,IAAI,CAACA,aAAa,CAAC9gB,IAAI,CAAC,IAAI,CAAC,CAAC;OAChFob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACwX,aAAa,EAAE,IAAI,CAACA,aAAa,CAACxgB,IAAI,CAAC,IAAI,CAAC,CAAC;OAChFob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACyX,mBAAmB,EAAE,IAAI,CAACA,mBAAmB,CAACzgB,IAAI,CAAC,IAAI,CAAC,CAAC;OAC5Fob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAAC0X,sBAAsB,EAAE,IAAI,CAACA,sBAAsB,CAAC1gB,IAAI,CAAC,IAAI,CAAC,CAAC;OAClGob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAAC2X,iBAAiB,EAAE,IAAI,CAACA,iBAAiB,CAAC3gB,IAAI,CAAC,IAAI,CAAC,CAAC;OACxFob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAAC4X,SAAS,EAAE,IAAI,CAACA,SAAS,CAAC5gB,IAAI,CAAC,IAAI,CAAC,CAAC;OACxEob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAAC+X,SAAS,EAAE,IAAI,CAACA,SAAS,CAAC/gB,IAAI,CAAC,IAAI,CAAC,CAAC;OACxEob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACgY,aAAa,EAAE,IAAI,CAACA,aAAa,CAAChhB,IAAI,CAAC,IAAI,CAAC,CAAC;OAChFob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACkY,qBAAqB,EAAE,IAAI,CAACA,qBAAqB,CAAClhB,IAAI,CAAC,IAAI,CAAC,CAAC;OAChGob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACiY,cAAc,EAAE,IAAI,CAACA,cAAc,CAACjhB,IAAI,CAAC,IAAI,CAAC,CAAC;OAClFob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACmY,WAAW,EAAE,IAAI,CAACA,WAAW,CAACnhB,IAAI,CAAC,IAAI,CAAC,CAAC;OAC5Eob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAAC6X,YAAY,EAAE,IAAI,CAACA,YAAY,CAAC7gB,IAAI,CAAC,IAAI,CAAC,CAAC;OAC9Eob,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACoY,WAAW,EAAE;SAAA,OAAMvU,MAAM,CAAC3I,KAAK,EAAE;SAAC;OAErEsE,EAAE,CAACxI,IAAI,CAAC6M,MAAM,EAAE,cAAc,EAAE,YAChC;SACCrE,EAAE,CAAC6uB,SAAS,CAACxqB,MAAM,EAAE,cAAc,CAAC;SACpCuO,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAAC6Y,cAAc,EAAE,EAAE,CAAC;QACjD,CAAC;OAEFrZ,EAAE,CAACxI,IAAI,CAAC6M,MAAM,EAAE,QAAQ,EAAEomB,iBAAO,CAACqE,QAAQ,CAAC,YAC3C;SACC,IAAI,OAAI,CAAChP,YAAY,EACrB;WACC,OAAI,CAACA,YAAY,GAAG,KAAK;WACzB;;SAGD,OAAI,CAACiP,eAAe,CAAC1qB,MAAM,CAAC2qB,UAAU,EAAE3qB,MAAM,CAAC4qB,WAAW,CAAC;QAC3D,EAAE,GAAG,CAAC,CAAC;OAERjvB,EAAE,CAAC4E,cAAc,CAAC,yBAAyB,EAAE,UAACH,KAAK,EACnD;SACC,IAAI,CAACA,KAAK,CAACyqB,SAAS,EAAE,CAACC,eAAe,EAAE,EACxC;WACC1qB,KAAK,CAAC2qB,UAAU,EAAE;WAClB/qB,MAAM,CAAC4I,IAAI,CAACxI,KAAK,CAAC4qB,MAAM,CAACvlB,GAAG,CAAC;;QAE9B,CAAC;;;CAGJ;CACA;CACA;CACA;CACA;CACA;;;KACE;KAAA,0CAGD;OAAA;OACC8I,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACS,MAAM,EAAE;SAAA,OAAM,OAAI,CAACzL,SAAS,CAACwL,IAAI,EAAE;SAAC;OACvE4R,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACU,QAAQ,EAAE;SAAA,OAAM,OAAI,CAAC1L,SAAS,CAAC2L,MAAM,EAAE;SAAC;OAC3EyR,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACC,MAAM,EAAE;SAAA,OAAM,OAAI,CAACjL,SAAS,CAAC2K,IAAI,EAAE;SAAC;OACvEyS,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACG,QAAQ,EAAE;SAAA,OAAM,OAAI,CAACnL,SAAS,CAACoL,MAAM,EAAE;SAAC;OAC3EgS,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACqY,UAAU,EAAE,UAAC3e,WAAW;SAAA,OAAK,OAAI,CAAC1E,SAAS,CAAC2b,QAAQ,CAACjX,WAAW,CAAC;SAAC;OACrG0Y,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACsY,kBAAkB,EAAE,UAAC9e,CAAC;SAAA,OAAK,OAAI,CAACxE,SAAS,CAAC2mB,gBAAgB,CAACniB,CAAC,CAAC;SAAC;OACjG4Y,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACuY,QAAQ,EAAE;SAAA,OAAM,OAAI,CAACvjB,SAAS,CAAC4mB,MAAM,EAAE;SAAC;OAC3ExJ,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACwY,MAAM,EAAE;SAAA,OAAM,OAAI,CAACxjB,SAAS,CAAC6mB,IAAI,EAAE;SAAC;OACvEzJ,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACyY,QAAQ,EAAE;SAAA,OAAM,OAAI,CAACzjB,SAAS,CAAC8mB,MAAM,EAAE;SAAC;OAC3E1J,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAAC3K,OAAO,EAAE;SAAA,OAAM,OAAI,CAAC6F,KAAK,EAAE;SAAC;OAC/DkX,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAAC0Y,eAAe,EAAE,UAAClf,CAAC;SAAA,OAAK,OAAI,CAACxE,SAAS,CAACsf,QAAQ,CAAC9a,CAAC,CAAC;SAAC;OACtF4Y,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAAC2Y,kBAAkB,EAAE;SAAA,OAAM,OAAI,CAAC3jB,SAAS,CAAC+mB,gBAAgB,EAAE;SAAC;OAC/F3J,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAAC4Y,gBAAgB,EAAE;SAAA,OAAM,OAAI,CAAC5jB,SAAS,CAACgnB,cAAc,EAAE;SAAC;OAC3F5J,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAAC8Y,cAAc,EAAE,UAACtf,CAAC;SAAA,OAAK,OAAI,CAACxE,SAAS,CAACinB,YAAY,CAACziB,CAAC,CAAC;SAAC;OACzF4Y,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAAC6Y,cAAc,EAAE,YACnD;SACC,OAAI,CAAC/Y,OAAO,CAAC+D,MAAM,GAAG,IAAI;SAC1B,OAAI,CAAC7O,SAAS,CAAC8mB,MAAM,EAAE;SACvB,OAAI,CAAC9mB,SAAS,CAACkG,KAAK,EAAE;QACtB,CAAC,CAAC;OACHkX,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAAC+Y,eAAe,EAAE,UAAC+V,KAAK;SAAA,OAAK,OAAI,CAAC95B,SAAS,CAACknB,aAAa,CAAC4S,KAAK,CAAC;SAAC;OACnG1c,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACgZ,sBAAsB,EAAE,UAAC8V,KAAK;SAAA,OAAK,OAAI,CAAC95B,SAAS,CAACmnB,oBAAoB,CAAC2S,KAAK,CAAC;SAAC;OACjH1c,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACiZ,cAAc,EAAE,UAACgC,YAAY;SAAA,OAAK,OAAI,CAACA,YAAY,GAAGA,YAAY;SAAC;OACtG7I,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACkZ,aAAa,EAAE,UAAC8B,OAAO,EAC1D;SACC,OAAI,CAACA,OAAO,GAAGA,OAAO;SACtB,OAAI,CAACoB,WAAW,EAAE;QAClB,CAAC;OACFhK,+BAAU,CAACgc,SAAS,CAACpuB,aAAa,CAACmZ,cAAc,EAAE,UAAC4V,SAAS;SAAA,OAAK,OAAI,CAACA,SAAS,GAAGA,SAAS;SAAC;;;KAE7F;KAAA,sCAGD;OACC,KAAK,IAAIC,OAAO,IAAIhvB,aAAa,EACjC;SACC,IAAIA,aAAa,CAACtI,cAAc,CAACs3B,OAAO,CAAC,EACzC;WACC5c,+BAAU,CAAC6c,WAAW,CAACjvB,aAAa,CAACgvB,OAAO,CAAC,CAAC;;;;;KAGhD;KAAA,4BAGD;OACC,OAAO,IAAI,CAACtP,UAAU;;;KACtB;KAAA,2BAGD;OACC,OAAO,IAAI,CAAChF,MAAM;;;KAClB;KAAA,8BAGD;OACC,OAAO,IAAI,CAACD,cAAc,KAAK,IAAI,CAACV,SAAS,KAAK5D,SAAS,CAACV,SAAS,IAAK,IAAI,CAACsE,SAAS,KAAK5D,SAAS,CAACN,IAAI,IAAI,IAAI,CAAChI,UAAU,GAAG,CAAE,CAAC;;;KACpI;KAAA,kCAGD;OACC,IAAI,CAAC,IAAI,CAAC6M,MAAM,EAChB;SACC,OAAO,CAAC;;OAGT,IAAI,CAAC,IAAI,CAACplB,QAAQ,CAAC2qB,IAAI,EACvB;SACC,OAAO,CAAC;;OAGT,OAAO,IAAI,CAAC3qB,QAAQ,CAAC2qB,IAAI,CAACpR,YAAY,IAAI,IAAI,CAACvZ,QAAQ,CAAC6L,QAAQ,CAACoK,MAAM,GAAG,IAAI,CAACjW,QAAQ,CAAC6L,QAAQ,CAACoK,MAAM,CAACsD,YAAY,GAAG,CAAC,CAAC;;;KACzH;KAAA,qCAGD;OACC,OAAQ,CAAC,IAAI,CAACjP,SAAS,EAAE,IAAI,IAAI,CAACE,OAAO,CAACkjB,kBAAkB,CAAC,QAAQ,CAAC;;;KACtE;KAAA,sCAGD;OACC,OAAQ,CAAC,IAAI,CAACpjB,SAAS,EAAE,IAAI,IAAI,CAACE,OAAO,CAACkjB,kBAAkB,CAAC,QAAQ,CAAC;;;KACtE;KAAA,4BAEWjR,QAAQ,EACpB;OACCA,QAAQ,GAAIA,QAAQ,KAAK,IAAK;OAC9B,IAAI,CAACA,QAAQ,GAAGA,QAAQ;OACxB,IAAI,IAAI,CAACnS,SAAS,EAAE,EACpB,CAEC,MACI,IAAI,IAAI,CAAC9J,KAAK,EACnB;SACC,IAAI,CAACA,KAAK,CAACo5B,eAAe,CAACnd,QAAQ,CAAC;;;;;KAGrC;KAAA,6BAGD;OACC,OAAO,IAAI,CAACA,QAAQ;;;KACpB;KAAA,yBAGD;OACC,IAAI,IAAI,CAACjc,KAAK,EACd;SACC,IAAI,CAACA,KAAK,CAACq5B,cAAc,EAAE;;OAG5B,IAAI,IAAI,CAACvvB,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;SACC,IAAI,IAAI,CAAC0f,aAAa,IAAI1I,OAAO,CAACC,MAAM,EACxC;WACC,IAAI,CAAChX,OAAO,CAACsvB,YAAY,CAAC,KAAK,CAAC;UAChC,MAED;WACC,IAAI,CAACtvB,OAAO,CAACsvB,YAAY,CAAC,IAAI,CAAC;WAC/B,IAAI,CAACtvB,OAAO,CAACuvB,UAAU,CAAE,IAAI,CAAC/5B,QAAQ,CAACqrB,gBAAgB,GAAG,GAAG,GAAG,GAAG,EAAG,GAAG,CAAC;;SAE3E,IAAI,CAAC7gB,OAAO,CAACwvB,MAAM,EAAE;;;;KAEtB;KAAA,6BAEY9c,KAAK,EAAE5D,MAAM,EAC1B;OACC,IAAI,CAAC,IAAI,CAAChP,SAAS,EAAE,IAAI,CAAC,IAAI,CAACC,KAAK,EACpC;SACC,OAAO,KAAK;;OAGb,IAAI,CAACyf,YAAY,GAAG,IAAI;OACxB,IAAI,CAACxf,OAAO,CAACyvB,MAAM,CAAC/c,KAAK,EAAE5D,MAAM,CAAC;;;KAClC;KAAA,wBAGD;OAAA;OACCpP,EAAE,CAACO,aAAa,CAAC8D,MAAM,EAAE,uBAAuB,EAAE,EAAE,CAAC;OAErD,IAAI,IAAI,CAACvC,QAAQ,EAAE,IAAI,IAAI,CAAChM,QAAQ,CAAC2qB,IAAI,EACzC;SACCroB,aAAG,CAAC6H,QAAQ,CAAC,IAAI,CAACnK,QAAQ,CAAC2qB,IAAI,EAAE,kCAAkC,CAAC;SACpE3lB,UAAU,CAAC,YACV;WACC1C,aAAG,CAAC0Y,MAAM,CAAC,OAAI,CAAChb,QAAQ,CAAC2qB,IAAI,CAAC;WAC9B,OAAI,CAAC3qB,QAAQ,GAAG,OAAI,CAAC+lB,kBAAkB,EAAE;UACzC,EACD,GAAG,CACH;;OAGF,IAAI,IAAI,CAACvlB,KAAK,EACd;SACC,IAAI,CAACA,KAAK,CAACoF,KAAK,EAAE;;OAGnB,IAAI,IAAI,CAAC4E,OAAO,CAAC+D,MAAM,EACvB;SACCuO,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACoY,WAAW,EAAE,EAAE,CAAC;;;;;OAK/C,IAAI,CAAC+V,oBAAoB,EAAE;OAE3B,IAAI,CAACn5B,SAAS,CAACkG,KAAK,EAAE;OACtBsE,EAAE,CAACO,aAAa,CAAC8D,MAAM,EAAE,sBAAsB,EAAE,EAAE,CAAC;;;KACpD;KAAA,mCAGD;OACC,IAAI,CAAC4W,cAAc,GAAG,KAAK;OAC3B,IAAI,IAAI,CAAC7a,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACmZ,cAAc,EAAE,CAAC,IAAI,CAACsB,cAAc,CAAC,CAAC;;OAErE,IAAI,CAACkM,aAAa,EAAE;;;OAGpB,IAAI,CAAC0E,oBAAoB,EAAE;;;KAC3B;KAAA,kCAGD;OACC,IAAI,CAAC5Q,cAAc,GAAG,IAAI;OAC1B,IAAI,IAAI,CAAC7a,SAAS,EAAE,IAAI,IAAI,CAACC,KAAK,EAClC;SACCuS,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACmZ,cAAc,EAAE,CAAC,IAAI,CAACsB,cAAc,CAAC,CAAC;;OAErE,IAAI,CAACkM,aAAa,EAAE;OAEpB,IAAI,IAAI,CAACxL,cAAc,EACvB;SACC3gB,YAAY,CAAC,IAAI,CAAC2gB,cAAc,CAAC;SACjC,IAAI,CAACA,cAAc,GAAG,IAAI;SAC1B,IAAI,CAACqU,qBAAqB,EAAE;;;;KAE7B;KAAA,4BAGD;OAAA;OACC,IAAI,IAAI,CAAC/U,cAAc,IAAI,CAAC,IAAI,CAACQ,YAAY,EAC7C;SACC,IAAI,CAAC/f,KAAK,EAAE;QACZ,MAED;SACCsE,EAAE,CAACO,aAAa,CAAC8D,MAAM,EAAE,uBAAuB,EAAE,EAAE,CAAC;SACrD,IAAI,CAACsX,cAAc,GAAG7gB,UAAU,CAAC;WAAA,OAAM,OAAI,CAACk1B,qBAAqB,EAAE;YAAE,IAAI,CAACpU,gBAAgB,CAAC;;;;KAE5F;KAAA,wCAGD;OACC/Q,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAE,IAAI,CAAC2Q,YAAY,EAAE,IAAI,CAACE,cAAc,EAAE3b,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,MAAM,CAACI,WAAW,CAAC,CAAC;OACxH,IAAI,IAAI,CAAC6D,YAAY,EACrB;SACC,IAAI,CAACqO,wBAAwB,EAAE;;OAGhC,IAAI,CAAC9pB,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,MAAM,CAACI,WAAW,CAAC,EAC5C;SACC,IAAI,CAAClc,KAAK,EAAE;;OAGb,IAAI,CAACigB,cAAc,GAAG,IAAI;;;KAC1B;KAAA,uCAGD;OAAA;OACC,IAAI,IAAI,CAACA,cAAc,EACvB;SACC3gB,YAAY,CAAC,IAAI,CAAC2gB,cAAc,CAAC;SACjC,IAAI,CAACA,cAAc,GAAG7gB,UAAU,CAAC;WAAA,OAAM,OAAI,CAACk1B,qBAAqB,EAAE;YAAE,IAAI,CAACpU,gBAAgB,CAAC;;;;KAE5F;KAAA,wCAGD;OACC,IAAMqU,WAAW,GAAG5rB,MAAM,CAAC2qB,UAAU,GAAGr4B,QAAQ,CAAC+e,eAAe,CAACwa,WAAW;OAC5Ev5B,QAAQ,CAACC,IAAI,CAACgL,KAAK,CAACuuB,WAAW,CAAC,eAAe,EAAEF,WAAW,GAAG,IAAI,CAAC;OACpEt5B,QAAQ,CAACC,IAAI,CAAC8D,SAAS,CAAC01B,GAAG,CAAC,8BAA8B,CAAC;OAC3D,IAAMC,KAAK,GAAG15B,QAAQ,CAAC25B,cAAc,CAAC,WAAW,CAAC;OAClD,IAAID,KAAK,EACT;SACCA,KAAK,CAACzuB,KAAK,CAACuuB,WAAW,CAAC,OAAO,EAAEF,WAAW,GAAG,IAAI,CAAC;;;;KAErD;KAAA,uCAGD;OACCt5B,QAAQ,CAACC,IAAI,CAAC8D,SAAS,CAACoW,MAAM,CAAC,8BAA8B,CAAC;OAC9Dna,QAAQ,CAACC,IAAI,CAACgL,KAAK,CAAC4N,cAAc,CAAC,eAAe,CAAC;OACnD,IAAM6gB,KAAK,GAAG15B,QAAQ,CAAC25B,cAAc,CAAC,WAAW,CAAC;OAClD,IAAID,KAAK,EACT;SACCA,KAAK,CAACzuB,KAAK,CAAC4N,cAAc,CAAC,OAAO,CAAC;;;;KAEpC;KAAA,0BAGD;OAAA;OACCnL,MAAM,CAACqB,mBAAmB,CAAC,cAAc,EAAE,IAAI,CAACoX,sBAAsB,CAAC;OACvE9c,EAAE,CAACsiB,iBAAiB,CAAC,iBAAiB,EAAE,IAAI,CAACrD,sBAAsB,CAAC;OACpE,IAAI,CAACsR,cAAc,EAAE;OACrB,IAAI,CAACC,UAAU,EAAE;OAEjB,IAAI,IAAI,CAAC1uB,QAAQ,EAAE,IAAI,IAAI,CAAChM,QAAQ,CAAC2qB,IAAI,EACzC;SACCroB,aAAG,CAAC6H,QAAQ,CAAC,IAAI,CAACnK,QAAQ,CAAC2qB,IAAI,EAAE,kCAAkC,CAAC;SACpE3lB,UAAU,CAAC;WAAA,OAAM1C,aAAG,CAAC0Y,MAAM,CAAC,OAAI,CAAChb,QAAQ,CAAC2qB,IAAI,CAAC;YAAE,GAAG,CAAC;;OAGtD,IAAI,IAAI,CAACra,gBAAgB,EACzB;SACC,IAAI,CAACA,gBAAgB,CAAC4Z,WAAW,CAAC,IAAI,CAAC;SACvC,IAAI,CAAC5Z,gBAAgB,GAAG,IAAI;;OAG7B,IAAI,IAAI,CAAC9P,KAAK,EACd;SACC,IAAI,CAACA,KAAK,CAACuB,OAAO,EAAE;SACpB,IAAI,CAACvB,KAAK,GAAG,IAAI;;OAGlB,IAAI,IAAI,CAACglB,YAAY,EACrB;SACC,IAAI,CAACA,YAAY,CAAC5f,KAAK,EAAE;;OAG1B,IAAI,IAAI,CAAC2vB,MAAM,EACf;SACC,IAAI,CAACA,MAAM,CAAC3vB,KAAK,EAAE;;OAGpB,IAAI,IAAI,CAAC+jB,gBAAgB,EACzB;SACC,IAAI,CAACkM,qBAAqB,EAAE;;OAG7B,IAAI,CAACgD,oBAAoB,EAAE;OAE3B,IAAI,IAAI,CAACvuB,SAAS,EAAE,EACpB;SACC,IAAI,CAACqwB,mBAAmB,EAAE;SAC1B,IAAI,IAAI,CAACnwB,OAAO,CAAC+D,MAAM,EACvB;WACCuO,+BAAU,CAACtB,IAAI,CAAC9Q,aAAa,CAACoY,WAAW,EAAE,EAAE,CAAC;;WAE9C,IAAI,CAACtY,OAAO,CAAC+D,MAAM,GAAG,IAAI;;SAE3B,IAAI,CAAC,IAAI,CAAChE,KAAK,EACf;WACCgE,MAAM,CAACqB,mBAAmB,CAAC,cAAc,oCAAE,IAAI,mBAAiB,CAAC;;QAElE,MAED;SACCrB,MAAM,CAACqB,mBAAmB,CAAC,cAAc,EAAE,IAAI,CAACoX,sBAAsB,CAAC;;OAGxE,IAAI,CAAC9c,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,MAAM,CAACE,UAAU,CAAC,IAAI,CAAC1X,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,MAAM,CAACG,YAAY,CAAC,EACxF;SACC3X,EAAE,CAAC6Q,YAAY,CAACC,MAAM,CAAC0G,MAAM,CAACC,QAAQ,CAAC;;;;KAExC;KAAA,gCAGD;OACC,IAAI,IAAI,CAACrR,gBAAgB,CAACQ,MAAM,EAAE,EAClC;SACC,OAAO,KAAK;;OAGb,OAAO,IAAI,CAACqU,cAAc,IAAI,IAAI,CAACnZ,QAAQ,EAAE;;;KAC7C;KAAA,iCAGD;OACC,OAAQ,IAAI,CAACuM,UAAU,GAAG,CAAC;;;KAC3B;KAAA,2BAGD;OACC,OAAO;SACNgG,MAAM,EAAE,IAAI,CAACA,MAAM;SACnB6G,MAAM,EAAE,IAAI,CAACA,MAAM;SACnB5b,OAAO,EAAE,IAAI,CAACgV,QAAQ;SACtBpa,WAAW,EAAE,IAAI,CAACA,WAAW;SAC7Bqa,kBAAkB,EAAE,IAAI,CAACA,kBAAkB;SAC3CC,SAAS,EAAE,IAAI,CAACA,SAAS;SACzBC,UAAU,EAAE,IAAI,CAACA,UAAU;SAC3BC,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvBlT,UAAU,EAAE,IAAI,CAACA,UAAU;SAC3BmT,GAAG,EAAE,IAAI,CAACA,GAAG;SACbC,WAAW,EAAE,IAAI,CAACA,WAAW;SAC7BC,UAAU,EAAE,IAAI,CAACA,UAAU;SAC3BC,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvBC,aAAa,EAAE,IAAI,CAACA,aAAa;SACjCC,WAAW,EAAE,IAAI,CAACA,WAAW;SAC7BC,aAAa,EAAE,IAAI,CAACA,aAAa;SACjCC,kBAAkB,EAAE,IAAI,CAACA,kBAAkB;SAC3C7G,UAAU,EAAE,IAAI,CAACA,UAAU;SAC3B5F,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;SACvC4I,iBAAiB,EAAE,IAAI,CAACA,iBAAiB;SACzC8D,MAAM,EAAG,IAAI,CAACA,MAAM,GAAG,IAAI,CAACA,MAAM,GAAG,IAAK;SAC1CG,UAAU,EAAG,IAAI,CAACA,UAAU,GAAG,MAAM,GAAG,OAAQ;SAChDC,cAAc,EAAG,IAAI,CAACA,cAAc,GAAG,IAAI,CAACA,cAAc,GAAG,IAAK;SAClEC,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;SACvCvF,SAAS,EAAE,IAAI,CAACA,SAAS;SACzBC,cAAc,EAAE,IAAI,CAACA,cAAc;SACnClO,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;SACvC2Y,OAAO,EAAE,IAAI,CAACA;QACd;;;KACD;KAAA,qCAEoB+V,cAAwC,EAC7D;OAAA;OACCA,cAAc,GAAGl8B,cAAI,CAACkB,UAAU,CAACg7B,cAAc,CAAC,GAAGA,cAAc,GAAG1wB,EAAE,CAACiF,SAAS;OAEhFwlB,iBAAO,CAACkG,aAAa,CAAC,oBAAoB,CAAC,CAACnQ,IAAI,CAAC,UAACoQ,OAAuB,EACzE;SACC,IAAMzb,MAAM,GACX,OAAI,CAAC/O,gBAAgB,CAACQ,MAAM,EAAE,GAC3B,OAAI,CAACiqB,+BAA+B,CAACH,cAAc,CAAC,GACpD,OAAI,CAACI,sBAAsB,CAACJ,cAAc,CAAC;SAE/C,IAAMK,MAAc,GAAGH,OAAO,CAACG,MAAM;SACrC,IAAMC,cAAc,GAAG,IAAID,MAAM,CAAC5b,MAAM,CAAC;SAEzC6b,cAAc,CAACl1B,IAAI,EAAE;QACrB,CAAC;;;KACF;KAAA,gDAE+B40B,cAAc,EAC9C;OAAA;OACC,OAAO;SACNO,UAAU,EAAE,IAAI,CAACn7B,QAAQ,CAACoK,OAAO,CAAC4U,QAAQ;SAC1Coc,QAAQ,EAAE,KAAK;SACflD,SAAS,EAAE,KAAK;SAChBmD,YAAY,EAAE,KAAK;SACnBC,YAAY,EAAE,IAAI;SAClBC,QAAQ,EAAE,CACT;WACC56B,EAAE,EAAE,MAAM;WACVyR,OAAO,EAAE;aACRopB,kBAAkB,EAAE,KAAK;aACzBC,YAAY,EAAE,CAAC,eAAe,EAAE,gBAAgB,EAAE,WAAW;;UAE9D,EACD;WACC96B,EAAE,EAAE;UACJ,CACD;SACDa,MAAM,EAAE;WACP,eAAe,EAAE,sBAACmN,KAAK,EACvB;aACCA,KAAK,CAACsI,MAAM,CAACykB,WAAW,EAAE;aAE1B,IAAM/mB,IAAI,GAAGhG,KAAK,CAACyF,IAAI,CAACO,IAAI;aAE5B,IAAIA,IAAI,CAACgnB,WAAW,EAAE,KAAK,MAAM,EACjC;eACC,IAAIC,UAAU,GAAGjnB,IAAI,CAACknB,aAAa,EAAE;eACrC,IAAID,UAAU,CAACroB,GAAG,CAAC,eAAe,CAAC,IAAIqoB,UAAU,CAACroB,GAAG,CAAC,gBAAgB,CAAC,IAAIqoB,UAAU,CAACroB,GAAG,CAAC,WAAW,CAAC,EACtG;iBACC,OAAI,CAACuoB,sBAAsB,CAAC;mBAC3BhJ,MAAM,EAAEne,IAAI,CAAC+X,KAAK,EAAE;mBACpBkP,UAAU,EAAE3yB,MAAM,CAACkS,WAAW,CAACygB,UAAU,CAAC;mBAC1C76B,QAAQ,EAAE,OAAI,CAACA,QAAQ;mBACvB60B,QAAQ,EAAE,kBAACxtB,MAAsB,EACjC;qBACCuG,KAAK,CAACsI,MAAM,CAAC8kB,IAAI,EAAE;qBACnBnB,cAAc,CAAC;uBACdx2B,WAAW,EAAE,OAAI,CAACA,WAAW;uBAC7B6S,MAAM,EAAE7O,MAAM,CAAC6O;sBACf,CAAC;;kBAEH,CAAC;gBACF,MAED;iBACCtI,KAAK,CAACsI,MAAM,CAAC8kB,IAAI,EAAE;iBACnBnB,cAAc,CAAC;mBACdx2B,WAAW,EAAE,OAAI,CAACA,WAAW;mBAC7B6S,MAAM,EAAEtC,IAAI,CAAC+X,KAAK;kBAClB,CAAC;;;;;QAKN;;;KACD;KAAA,uCAEsBkO,cAAwC,EAC/D;OAAA;OACC,OAAO;SACNO,UAAU,EAAE,IAAI,CAACn7B,QAAQ,CAACoK,OAAO,CAAC4U,QAAQ;SAC1Coc,QAAQ,EAAE,KAAK;SACflD,SAAS,EAAE,KAAK;SAChBmD,YAAY,EAAE,KAAK;SACnBC,YAAY,EAAE,IAAI;SAClBC,QAAQ,EAAE,CACT;WACC56B,EAAE,EAAE,MAAM;WACVyR,OAAO,EAAE;aACRopB,kBAAkB,EAAE,KAAK;aACzBC,YAAY,EAAE,CAAC,eAAe,EAAE,gBAAgB,EAAE,WAAW;;UAE9D,EACD;WACC96B,EAAE,EAAE;UACJ,EACD;WACCA,EAAE,EAAE;UACJ,CACD;SACDa,MAAM,EAAE;WACP,eAAe,EAAE,sBAACmN,KAAK,EACvB;aACCA,KAAK,CAACsI,MAAM,CAACykB,WAAW,EAAE;aAE1B,IAAI/mB,IAAI,GAAGhG,KAAK,CAACyF,IAAI,CAACO,IAAI;aAE1B,IAAIA,IAAI,CAACgnB,WAAW,EAAE,KAAK,MAAM,EACjC;eACC,IAAIC,UAAU,GAAGjnB,IAAI,CAACknB,aAAa,EAAE;eACrC,IAAID,UAAU,CAACroB,GAAG,CAAC,eAAe,CAAC,IAAIqoB,UAAU,CAACroB,GAAG,CAAC,gBAAgB,CAAC,IAAIqoB,UAAU,CAACroB,GAAG,CAAC,WAAW,CAAC,EACtG;iBACC,OAAI,CAACuoB,sBAAsB,CAAC;mBAC3BhJ,MAAM,EAAEne,IAAI,CAAC+X,KAAK,EAAE;mBACpBkP,UAAU,EAAE3yB,MAAM,CAACkS,WAAW,CAACygB,UAAU,CAAC;mBAC1C76B,QAAQ,EAAE,OAAI,CAACA,QAAQ;mBACvB60B,QAAQ,EAAE,kBAACxtB,MAAsB,EACjC;qBACCuG,KAAK,CAACsI,MAAM,CAAC8kB,IAAI,EAAE;qBACnBnB,cAAc,CAACxyB,MAAM,CAAC;;kBAEvB,CAAC;gBACF,MAED;iBACCuG,KAAK,CAACsI,MAAM,CAAC8kB,IAAI,EAAE;iBACnBnB,cAAc,CAAC;mBACd93B,IAAI,EAAE,MAAM;mBACZmU,MAAM,EAAEtC,IAAI,CAAC+X,KAAK;kBAClB,CAAC;;cAEH,MACI,IAAI/X,IAAI,CAACgnB,WAAW,EAAE,KAAK,kBAAkB,EAClD;eACChtB,KAAK,CAACsI,MAAM,CAAC8kB,IAAI,EAAE;eACnBnB,cAAc,CAAC;iBACd93B,IAAI,EAAE,OAAO;iBACbmU,MAAM,EAAEtC,IAAI,CAAC+X,KAAK;gBAClB,CAAC;;;;QAIL;;;KACD;KAAA,yCAGD;OAAA,IADuBta,OAAwB,uEAAG,EAAE;OAEnD,IAAM0gB,MAAM,GAAGp0B,cAAI,CAACs9B,SAAS,CAAC5pB,OAAO,CAAC0gB,MAAM,CAAC,GAAG1gB,OAAO,CAAC0gB,MAAM,GAAG,CAAC;OAClE,IAAMmJ,cAAc,GAAGv9B,cAAI,CAACC,aAAa,CAACyT,OAAO,CAACwpB,UAAU,CAAC,GAAGxpB,OAAO,CAACwpB,UAAU,GAAG,EAAE;OACvF,IAAM76B,QAAQ,GAAGqR,OAAO,CAACrR,QAAQ,KAAK,IAAI;OAC1C,IAAM60B,QAAQ,GAAGl3B,cAAI,CAACkB,UAAU,CAACwS,OAAO,CAACwjB,QAAQ,CAAC,GAAGxjB,OAAO,CAACwjB,QAAQ,GAAGt3B,GAAG;OAC3E,IAAIkC,KAAK;OAET,IAAM07B,eAAe,GAAG,SAAlBA,eAAe,CAAIh4B,CAAC,EAC1B;SACC,IAAMpB,IAAI,GAAGoB,CAAC,CAACwC,aAAa,CAACF,OAAO,CAAC,MAAM,CAAC;SAC5C,IAAMyQ,MAAM,GAAG/S,CAAC,CAACwC,aAAa,CAACF,OAAO,CAAC,QAAQ,CAAC;SAChDovB,QAAQ,CAAC;WACR9yB,IAAI,EAAEA,IAAI;WACVmU,MAAM,EAAEA;UACR,CAAC;SACFzW,KAAK,CAACoF,KAAK,EAAE;QACb;OAED,IAAIT,SAAS,GAAG,CACf;SACCg3B,IAAI,EAAE,8BAA8B;SACpCt4B,IAAI,EAAEZ,aAAG,CAACC,UAAU,CAAC,qBAAqB,CAAC;SAC3CsD,OAAO,EAAE;WACR1D,IAAI,EAAE,MAAM;WACZmU,MAAM,EAAE6b;UACR;SACDptB,OAAO,EAAEw2B;QACT,EACD;SACCpkB,SAAS,EAAE;QACX,CACD;OAED,IAAImkB,cAAc,CAAC,gBAAgB,CAAC,EACpC;SACC92B,SAAS,CAACI,IAAI,CAAC;WACd+X,IAAI,EAAE8e,sBAAsB,CAACn5B,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC,EAAEsC,cAAI,CAACC,MAAM,CAACw2B,cAAc,CAAC,gBAAgB,CAAC,CAAC,CAAC;WACvHz1B,OAAO,EAAE;aACR1D,IAAI,EAAE,MAAM;aACZmU,MAAM,EAAEglB,cAAc,CAAC,gBAAgB;YACvC;WACDv2B,OAAO,EAAEw2B;UACT,CAAC;;OAEH,IAAID,cAAc,CAAC,eAAe,CAAC,EACnC;SACC92B,SAAS,CAACI,IAAI,CAAC;WACdzC,IAAI,EAAE,MAAM;WACZwa,IAAI,EAAE8e,sBAAsB,CAACn5B,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC,EAAEsC,cAAI,CAACC,MAAM,CAACw2B,cAAc,CAAC,eAAe,CAAC,CAAC,CAAC;WACrHz1B,OAAO,EAAE;aACR1D,IAAI,EAAE,MAAM;aACZmU,MAAM,EAAEglB,cAAc,CAAC,eAAe;YACtC;WACDv2B,OAAO,EAAEw2B;UACT,CAAC;;OAEH,IAAID,cAAc,CAAC,WAAW,CAAC,EAC/B;SACC92B,SAAS,CAACI,IAAI,CAAC;WACd+X,IAAI,EAAE8e,sBAAsB,CAACn5B,aAAG,CAACC,UAAU,CAAC,qBAAqB,CAAC,EAAEsC,cAAI,CAACC,MAAM,CAACw2B,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC;WAC7Gz1B,OAAO,EAAE;aACR1D,IAAI,EAAE,MAAM;aACZmU,MAAM,EAAEglB,cAAc,CAAC,WAAW;YAClC;WACDv2B,OAAO,EAAEw2B;UACT,CAAC;;OAGH17B,KAAK,GAAG,IAAIqF,eAAI,CAAC;SAChBlF,EAAE,EAAE,kCAAkC;SACtC/B,WAAW,EAAE,IAAI;SACjBgC,eAAe,EAAEC,QAAQ,CAACC,IAAI;SAC9BC,QAAQ,EAAEA,QAAQ;SAClBs7B,WAAW,EAAE,IAAI;SACjBp7B,QAAQ,EAAE,IAAI;SACdD,UAAU,EAAE,IAAI;SAChBk3B,SAAS,EAAE,KAAK;SAChB72B,OAAO,EAAE;WACRC,eAAe,EAAE,SAAS;WAC1BC,OAAO,EAAE;UACT;SACDqX,KAAK,EAAEzT;QACP,CAAC;OACF3E,KAAK,CAACwF,IAAI,EAAE;;;GACZ;CAAA;CAGF,SAASo2B,sBAAsB,CAACE,QAAgB,EAAEz4B,IAAY,EAC9D;GACC,4DAAmD2B,cAAI,CAACC,MAAM,CAAC62B,QAAQ,CAAC,0DAA8C92B,cAAI,CAACC,MAAM,CAAC5B,IAAI,CAAC;CACxI;CAEA,SAAS+vB,kBAAkB,CAAC/vB,IAAI,EAAEpB,SAAS,EAAE85B,aAAa,EAC1D;GACC,IAAI99B,MAAM,GAAG,EAAE;GACf,IAAIC,cAAI,CAAC2f,cAAc,CAACxa,IAAI,CAAC,EAC7B;KACCpF,MAAM,CAACoF,IAAI,GAAGA,IAAI;;GAGnB,IAAInF,cAAI,CAAC2f,cAAc,CAAC5b,SAAS,CAAC,EAClC;KACChE,MAAM,CAAC+D,KAAK,GAAG;OAACC,SAAS,EAAEA;MAAU;;GAGtC,IAAI/D,cAAI,CAACkB,UAAU,CAAC28B,aAAa,CAAC,EAClC;KACC99B,MAAM,CAAC+C,MAAM,GAAG;OAACmB,KAAK,EAAE45B;MAAc;;GAGvC,OAAOj6B,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE9D,MAAM,CAAC;CAClC;CAEA,SAAS05B,UAAU,CAACqB,KAAK,EAAEgD,MAAM,EAAE5G,QAAQ,EAC3C;GACC,OAAOtzB,aAAG,CAACC,MAAM,CAAC,KAAK,EAAE;KACxBC,KAAK,EAAE;OAACC,SAAS,EAAE,mCAAmC,IAAI+5B,MAAM,GAAG,yCAAyC,GAAG,EAAE;MAAE;KACnHh2B,OAAO,EAAE;OAACgzB,KAAK,EAAEA;MAAM;KACvBh4B,MAAM,EAAE;OACPmB,KAAK,EAAE,eAACuB,CAAC,EACT;SACCA,CAAC,CAACQ,cAAc,EAAE;SAClB,IAAM80B,KAAK,GAAGt1B,CAAC,CAACwC,aAAa,CAACF,OAAO,CAACgzB,KAAK;SAC3C5D,QAAQ,CAAC4D,KAAK,CAAC;;;IAGjB,CAAC;CACH;;;CC1rIA;CAAA;CAAA;AADA,CAYA,IAAM9X,QAAM,GAAG;GACdE,UAAU,EAAE,cAAc;GAC1BC,YAAY,EAAE,gBAAgB;GAC9B4a,IAAI,EAAE,MAAM;GACZC,WAAW,EAAE,kBAAkB;GAC/BC,UAAU,EAAE,sBAAsB;GAClChb,QAAQ,EAAE,kBAAkB;GAC5BG,WAAW,EAAE;CACd,CAAC;CAED,IAAMlI,QAAM,GAAG;GACdgjB,aAAa,EAAE,eAAe;GAC9BC,eAAe,EAAE,iBAAiB;GAClCC,eAAe,EAAE,iBAAiB;GAClCC,mBAAmB,EAAE;CACtB,CAAC;CAmCD,IAAMC,UAAU,GAAG;GAClBC,MAAM,EAAE,QAAQ;GAChBC,KAAK,EAAE;CACR,CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAED,KAAaC,oBAAoB;GAAA;;;GAuChC,8BAAY/qB,OAAoC,EAChD;KAAA;KAAA;KACC;KAAQgrB;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KAAAA;KACR,MAAKrjB,iBAAiB,CAAC,2CAA2C,CAAC;KACnE,MAAKC,oBAAoB,CAAC5H,OAAO,CAAC5Q,MAAM,CAAC;KAEzC,MAAKmS,KAAK,GAAG,KAAK;KAElB,MAAK0pB,YAAY,GAAG3+B,cAAI,CAACylB,SAAS,CAAC/R,OAAO,CAACirB,YAAY,CAAC,GAAGjrB,OAAO,CAACirB,YAAY,GAAG,KAAK;KAEvF,MAAKvK,MAAM,GAAG1gB,OAAO,CAAC0gB,MAAM;KAC5B,MAAKwK,SAAS,GAAGlrB,OAAO,CAACkrB,SAAS;KAClC,MAAKC,OAAO,GAAGnrB,OAAO,CAACmrB,OAAO;KAE9B,IAAMt+B,OAAO,GAAGiL,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,QAAM,CAACgb,WAAW,CAAC;KACvD,MAAKA,WAAW,GAAGh+B,cAAI,CAAC0G,OAAO,CAACnG,OAAO,CAAC,GAAGA,OAAO,GAAG,EAAE;KAEvD,MAAKI,cAAc,GAAGX,cAAI,CAAC0G,OAAO,CAACgN,OAAO,CAAC/S,cAAc,CAAC,GAAG+S,OAAO,CAAC/S,cAAc,GAAG,EAAE;KACxF,MAAKF,aAAa,GAAGT,cAAI,CAAC8+B,QAAQ,CAACprB,OAAO,CAACjT,aAAa,CAAC,GAAGiT,OAAO,CAACjT,aAAa,GAAG,EAAE;KACtF,MAAKG,oBAAoB,GAAG8S,OAAO,CAACqrB,gBAAgB,IAAI,KAAK;KAC7D,MAAK9d,QAAQ,GAAGvN,OAAO,CAACuN,QAAQ;KAEhC,MAAKb,WAAW,GAAG1M,OAAO,CAACsrB,YAAY,KAAK,IAAI;KAEhD,MAAKC,qBAAqB,GAAG,IAAI;KAEjC,MAAKC,iBAAiB,GAAG,KAAK;KAE9B,MAAKC,YAAY,EAAE;KAEnB,IAAIC,iBAAO,CAACC,uBAAuB,EAAE,EACrC;OACC7zB,EAAE,CAAC4E,cAAc,CAACP,MAAM,EAAE,mBAAmB,EAAE,MAAKyvB,UAAU,CAACt8B,IAAI,2CAAM,CAAC;;KAE3EwI,EAAE,CAAC4E,cAAc,CAAC,wBAAwB,EAAEmvB,iGAAkBv8B,IAAI,2CAAM,CAAC;;;KAGzE,MAAKw8B,sBAAsB,GAAGD,yGAAsBv8B,IAAI,2CAAM;KAC9D,MAAKy8B,yBAAyB,GAAGF,+GAAyBv8B,IAAI,2CAAM;KACpE,MAAK08B,mBAAmB,GAAGH,mGAAmBv8B,IAAI,2CAAM;KACxD,MAAK28B,0BAA0B,GAAGJ,iHAA0Bv8B,IAAI,2CAAM;KACtE,MAAK48B,yBAAyB,GAAGL,+GAAyBv8B,IAAI,2CAAM;KAEpE,MAAK2oB,eAAe,GAAGjY,OAAO,CAACiY,eAAe;KAC9C,MAAK/Z,gBAAgB,GAAG,IAAIK,gBAAgB,EAAE;KAC9C,MAAK2Z,cAAc,GAAG,IAAIxQ,cAAc,CAAC;OACxCtY,MAAM,kCACJsY,cAAc,CAACF,MAAM,CAACC,QAAQ,EAAG,UAAClL,KAAK,EAAK;SAC5C,IAAMyF,IAAI,GAAGzF,KAAK,CAAC4vB,OAAO,EAAE;SAC5B,MAAKC,aAAa,CAACpqB,IAAI,CAACmE,UAAU,EAAEnE,IAAI,CAAC8F,cAAc,CAAC;QACxD;MAEF,CAAC;KAEF,MAAKukB,qBAAqB,EAAE;KAC5Bv0B,EAAE,CAACw0B,OAAO,CAAC,YACX;OACC,IAAI,MAAKC,aAAa,EAAE,IAAI,MAAKhd,QAAQ,IAAI,MAAKA,QAAQ,CAACid,aAAa,EAAE,KAAK,MAAKC,eAAe,IAAI,MAAKC,UAAU,KAAK,OAAO,CAAC,EACnI;SACC50B,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAACib,UAAU,EAAE;WACtCpe,MAAM,EAAE,MAAKA,MAAM;WACnBwgB,QAAQ,EAAE,MAAKA,QAAQ;WACvBD,UAAU,EAAE,MAAKA,UAAU;WAC3BD,eAAe,EAAE,MAAKA,eAAe;WACrCld,QAAQ,EAAE,MAAKA,QAAQ,CAACqd,QAAQ;UAChC,EAAE,EAAE,CAAC;;MAEP,CAAC;KAAA;;GACF;KAAA;KAAA,gCAGD;OACC,OAAOC,OAAO,CAAC,IAAI,CAACC,YAAY,IAAI,IAAI,CAACvd,QAAQ,CAAC;;;KAClD;KAAA,wBAqDD;OACC,OAAO,IAAI,CAAC;;;KACZ;KAAA;OAAA;SAAA;SAAA;SAAA;WAAA;aAAA;eAAA,IAIK5G,YAAY;iBAAA;iBAAA;;eAAA;aAAA;eAKjB,IAAI,CAACokB,iBAAiB,GAAGpkB,YAAY,CAAC8S,OAAO,CAAC,mCAAmC,CAAC;eAClF,IAAI,CAACuR,aAAa,GAAGrkB,YAAY,CAAC8S,OAAO,CAAC,+BAA+B,CAAC;eAC1E,IAAI,CAACwR,cAAc,GAAGtkB,YAAY,CAAC8S,OAAO,CAAC,gCAAgC,CAAC;eAC5E,IAAI,CAACyR,uBAAuB,GAAIvkB,YAAY,CAAC8S,OAAO,CAAC,2CAA2C,CAAC,KAAK,GAAI;eAAC,MAG1G,CAAC0R,SAAS,CAACC,YAAY,IACpB,CAACD,SAAS,CAACC,YAAY,CAACC,gBAAgB,IACxC,CAAC,IAAI,CAACN,iBAAiB;iBAAA;iBAAA;;eAAA;aAAA;eAAA;eAAA,OAMFI,SAAS,CAACC,YAAY,CAACC,gBAAgB,EAAE;aAAA;eAA5DC,UAAU;eACVt3B,MAAM,GAAGs3B,UAAU,CAACt2B,MAAM,CAAC,UAAAu2B,MAAM;iBAAA,OAAIA,MAAM,CAACC,IAAI,KAAK,YAAY,IAAID,MAAM,CAACE,QAAQ,KAAK,MAAI,CAACV,iBAAiB;iBAAC;eACtH,IAAI,CAACA,iBAAiB,GAAG/2B,MAAM,CAACpG,MAAM,GAAG,IAAI,CAACm9B,iBAAiB,GAAG,IAAI;aAAC;aAAA;eAAA;;;;OAAA;SAAA;;OAAA;;;KAAA;KAAA,mCA6erD/4B,MAAM,EACzB;OACC,OAAOA,MAAM,CAAC2S,QAAQ,EAAE,CAACvC,OAAO,CAAC,cAAc,EAAE,EAAE,CAAC;;;KACpD;KAAA,gCAeD;OACC,IAAIpO,MAAM,GAAG1J,cAAI,CAACC,aAAa,CAAC,IAAI,CAACmhC,WAAW,CAAC,GAAGnL,iBAAO,CAACoL,KAAK,CAAC,IAAI,CAACD,WAAW,CAAC,GAAG,EAAE;OACxF,IAAI,IAAI,CAACE,eAAe,IAAI,IAAI,CAAC57B,WAAW,EAC5C;SACCgE,MAAM,CAAC,aAAa,CAAC,GAAG,IAAI,CAAC43B,eAAe;;OAE7C,OAAO1gB,IAAI,CAACC,SAAS,CAACnX,MAAM,CAAC;;;KAC7B;KAAA,kCAmCD;OACC6vB,aAAa,CAAC,IAAI,CAACgI,sBAAsB,CAAC;OAC1ChI,aAAa,CAAC,IAAI,CAACiI,qBAAqB,CAAC;OACzCh2B,EAAE,CAAC6Q,YAAY,CAACC,MAAM,CAAC0G,QAAM,CAACE,UAAU,CAAC;OAEzC,IAAI,CAACue,gBAAgB,CAAC,OAAO,CAAC;OAC9B,IAAI,CAACC,mBAAmB,EAAE;OAE1B,IAAI,IAAI,CAACte,WAAW,EACpB;SACC,IACA;WACC,IAAI,CAACA,WAAW,CAAC0E,MAAM,CAAC;aACvB,mBAAmB,EAAE,GAAG;aACxB,qBAAqB,EAAE;YACvB,CAAC;UACF,CAAC,OAAOtiB,CAAC,EACV;SACA,IAAI,CAAC4d,WAAW,GAAG,IAAI;SACvB,IAAI,CAACue,QAAQ,CAAC,kBAAkB,CAAC;QACjC,MAED;SACC,IAAI,CAACC,qBAAqB,EAAE;;OAG7B,IAAI,IAAI,CAAC/K,MAAM,EACf;SACC,IAAI,CAACA,MAAM,CAAC3vB,KAAK,EAAE;;OAGpBsE,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAAC+a,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC;OAE1C,IAAI,CAAC8D,YAAY,GAAG,CAAC;OACrB,IAAI,CAACC,aAAa,GAAG,KAAK;OAC1B,IAAI,CAACC,UAAU,GAAG,KAAK;OACvB,IAAI,CAACliB,MAAM,GAAG,EAAE;OAChB,IAAI,CAACsgB,eAAe,GAAG,KAAK;OAC5B,IAAI,CAACC,UAAU,GAAG9B,UAAU,CAACC,MAAM;;OAEnC,IAAI,CAAC74B,WAAW,GAAG,EAAE;OACrB,IAAI,CAACs8B,eAAe,GAAG,EAAE;OACzB,IAAI,CAACZ,WAAW,GAAG,EAAE;OACrB,IAAI,CAACa,kBAAkB,GAAG,EAAE;OAC5B,IAAI,CAACC,gBAAgB,GAAG,KAAK;;OAE7B,IAAI,CAAC72B,OAAO,GAAG,KAAK;OACpB,IAAI,CAAC82B,UAAU,GAAG,KAAK;OACvB,IAAI,CAACC,cAAc,GAAG,KAAK;OAC3B,IAAI,CAACC,cAAc,GAAG,KAAK;OAC3B,IAAI,CAACC,uBAAuB,GAAG,EAAE;OACjC,IAAI,CAACC,qBAAqB,GAAG,CAAC;OAC9B,IAAI,CAACC,mBAAmB,GAAG,EAAE;OAC7B,IAAI,CAACC,oBAAoB,GAAG,KAAK;;;KACjC;KAAA,oCAGD;OACC,IAAI,IAAI,CAACrC,UAAU,IAAI9B,UAAU,CAACE,KAAK,EACvC;SACC,OAAO,KAAK;;OAGb,IAAI,IAAI,CAACsD,aAAa,EACtB;SACCt2B,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,2BAA2B,EAAE;WAAC,SAAS,EAAE,IAAI,CAAC7iB;UAAO,CAAC;QACzE,MACI,IAAI,IAAI,CAAC8iB,cAAc,IAAI,IAAI,CAACvO,MAAM,EAC3C;SACCmL,6BAAI,gCAAJ,IAAI;;;;KAEL;KAAA,wCAqGD;OAAA;OACC,IAAI,IAAI,CAACqD,gBAAgB,IAAI,IAAI,CAACA,gBAAgB,CAACnhB,SAAS,EAAE,EAC9D;SACCnb,UAAU,CAAC,YACX;WACC,IAAI,MAAI,CAACs8B,gBAAgB,IAAI,MAAI,CAACA,gBAAgB,CAACnhB,SAAS,EAAE,EAC9D;aACC,MAAI,CAACmhB,gBAAgB,CAACC,UAAU,EAAE;;UAEnC,EAAE,GAAG,CAAC;;;;KAER;KAAA,2BA2GD;OACC,IAAI,CAACC,cAAc,CAAC,IAAI,CAAC;;;KACzB;KAAA,6BAGD;OACC,IAAI,CAACA,cAAc,CAAC,KAAK,CAAC;;;KAC1B;KAAA,+BAEcn4B,KAAK,EACpB;OACC,IAAI,CAAC,IAAI,CAACyY,WAAW,IAAI,IAAI,CAACgd,UAAU,IAAI9B,UAAU,CAACC,MAAM,EAC7D;SACC,OAAO,KAAK;;OAGb,IAAI,OAAQ5zB,KAAM,IAAI,WAAW,EACjC;SACC,IAAI,CAACw3B,UAAU,GAAG,CAACx3B,KAAK;;OAGzB,IAAI,IAAI,CAACw3B,UAAU,EACnB;SACC,IAAI,IAAI,CAAC/B,UAAU,KAAK9B,UAAU,CAACC,MAAM,EACzC;WACC,IAAI,CAACnb,WAAW,CAAC2f,WAAW,CAACniB,IAAI,CAACC,SAAS,CAAC;aAAC,SAAS,EAAE;YAAS,CAAC,CAAC;UACnE,MAED;WACCrV,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,wBAAwB,EAAE;aAAC,SAAS,EAAE,IAAI,CAAC7iB;YAAO,CAAC;;QAEvE,MAED;SACC,IAAI,IAAI,CAACugB,UAAU,KAAK9B,UAAU,CAACC,MAAM,EACzC;WACC,IAAI,CAACnb,WAAW,CAAC2f,WAAW,CAACniB,IAAI,CAACC,SAAS,CAAC;aAAC,SAAS,EAAE;YAAO,CAAC,CAAC;UACjE,MAED;WACCrV,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,sBAAsB,EAAE;aAAC,SAAS,EAAE,IAAI,CAAC7iB;YAAO,CAAC;;;OAGtE,IAAI,CAACsiB,UAAU,GAAG,CAAC,IAAI,CAACA,UAAU;;;KAClC;KAAA,yBAEQx8B,GAAG,EACZ;OACC,IAAI,CAAC,IAAI,CAACyd,WAAW,EACrB;SACC,OAAO,KAAK;;OAGb,IAAI,CAACue,QAAQ,CAAC,gBAAgB,EAAE,IAAI,CAACve,WAAW,CAACnhB,EAAE,EAAE,EAAE0D,GAAG,CAAC;OAE3D,IAAI,CAACyd,WAAW,CAAC4f,QAAQ,CAACr9B,GAAG,CAAC;;;KAC9B;KAAA,oCAEmB+B,MAAM,EAAEnE,MAAM,EAAExD,MAAM,EAC1C;OACCyL,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CACjB,8BAA8B,EAC9B;SACC,QAAQ,EAAEh7B,MAAM;SAChB,SAAS,EAAEnE,MAAM;SACjB,QAAQ,EAAExD,MAAM;SAChB,MAAM,EAAE;QACR,CACD;;;KACD;KAAA,+BAGD;OACC,OAAO,IAAI,CAAC4+B,YAAY,KAAK,IAAI,CAACve,WAAW,IAAI,IAAI,CAAC6iB,KAAK,EAAE,CAAC;;;KAC9D;KAAA,2BAGD;OACC,IAAI,CAAC,IAAI,CAAC7f,WAAW,EACrB;SACC,OAAO,KAAK;;OAGb,IAAI,CAAC/X,OAAO,GAAG,IAAI;OACnB,IAAI,CAAC+X,WAAW,CAAC8f,cAAc,EAAE;;;KACjC;KAAA,6BAGD;OACC,IAAI,CAAC,IAAI,CAAC9f,WAAW,EACrB;SACC,OAAO,KAAK;;OAGb,IAAI,CAAC/X,OAAO,GAAG,KAAK;OACpB,IAAI,CAAC+X,WAAW,CAAC+f,gBAAgB,EAAE;;;KACnC;KAAA,kCAGD;OACC,IAAI,CAAC,IAAI,CAAC/f,WAAW,EACrB;SACC,OAAO,KAAK;;OAGb,IAAI,IAAI,CAAC/X,OAAO,EAChB;SACC,IAAI,CAAC+X,WAAW,CAAC+f,gBAAgB,EAAE;SACnC,IAAI,CAAClgB,QAAQ,CAAC1X,QAAQ,CAAC,KAAK,CAAC;QAC7B,MAED;SACC,IAAI,CAAC6X,WAAW,CAAC8f,cAAc,EAAE;;OAElC,IAAI,CAAC73B,OAAO,GAAG,CAAC,IAAI,CAACA,OAAO;;;KAC5B;KAAA,gCAEekM,MAAM,EACtB;OACC,IAAI7N,MAAM,GAAG,IAAI;OACjB,IAAI,OAAQ6N,MAAO,IAAI,SAAS,EAChC;SACC,IAAI,CAACoU,eAAe,CAACyX,cAAc,CAAC,mBAAmB,EAAE,CAAC7rB,MAAM,CAAC;SACjE/L,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAAC,mBAAmB,EAAE,CAACwB,MAAM,EAAE,KAAK,CAAC;SACxD,IAAI,IAAI,CAAC0L,QAAQ,EACjB;WACC,IAAI,CAACA,QAAQ,CAACK,aAAa,CAAC/L,MAAM,CAAC;;QAEpC,MAED;SACC,IAAI8rB,eAAe,GAAG,IAAI,CAAC1X,eAAe,CAAC2X,cAAc,CAAC,mBAAmB,CAAC;SAC9E,IAAI,CAACD,eAAe,EACpB;WACCA,eAAe,GAAG73B,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAAC,mBAAmB,CAAC;;SAE3DnL,MAAM,GAAG,IAAI,CAAC0W,WAAW,IAAI,CAACijB,eAAe;;OAE9C,OAAO35B,MAAM;;;KAEb;KAAA,6BAGD;OAAA;OAAA,IADWlE,CAAC,uEAAG,EAAE;OAEhB,IAAIjB,aAAG,CAACC,UAAU,CAAC,wBAAwB,CAAC,IAAI,GAAG,EACnD;SACCyxB,iBAAO,CAACkG,aAAa,CAAC,mBAAmB,CAAC,CAACnQ,IAAI,CAAC;WAAA,OAAMxgB,EAAE,CAAC+3B,UAAU,CAACC,eAAe,EAAE;WAAC;SACtF;;OAGD,IAAI,CAACC,cAAc,EAAE,CAACzX,IAAI,CAAC;SAAA,gCAAM,MAAI,sCAAJ,MAAI,EAAexmB,CAAC;QAAC,CAAC;;;KACvD;KAAA,6BA+CYA,CAAC,EACd;OACC,IAAIzF,MAAM,GAAG,EAAE;OACf,IAAI,CAAC2jC,WAAW,EAAE;OAElB,IAAIl+B,CAAC,CAACjC,MAAM,EACZ;SACCxD,MAAM,CAAC,SAAS,CAAC,GAAGyF,CAAC,CAACjC,MAAM;;OAG7B,IAAI,CAACogC,SAAS,CAACn+B,CAAC,CAACE,WAAW,EAAE3F,MAAM,CAAC;;;KACrC;KAAA,kCAEiByF,CAAC,EACnB;OAAA;OACC,IAAI,CAAC,IAAI,CAAC5E,oBAAoB,EAC9B;SACC,IAAI,CAACi2B,MAAM,CAAC3vB,KAAK,EAAE;SACnB,IAAI,IAAI,IAAIsE,EAAE,IAAI,YAAY,IAAIA,EAAE,CAACo4B,EAAE,EACvC;WACCp4B,EAAE,CAACo4B,EAAE,CAACC,UAAU,CAACv8B,IAAI,CAAC,0CAA0C,CAAC;;SAElE;;OAGDkE,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,2BAA2B,CAAC,CAAC1W,IAAI,CAAC,UAACyH,QAAQ,EAC9D;SACC,IAAM/d,IAAI,GAAG+d,QAAQ,CAAC/d,IAAI,EAAE;SAE5B,IAAI,CAACA,IAAI,CAACouB,KAAK,IAAIpuB,IAAI,CAACouB,KAAK,IAAI,GAAG,EACpC;WACC,MAAI,CAACjN,MAAM,CAAC3vB,KAAK,EAAE;UACnB,MAED;WACC,IAAIwO,IAAI,CAACE,KAAK,EACd;aACC,MAAI,CAACmuB,mBAAmB,GAAG,IAAI3gC,gBAAK,CAAC;eACpCnB,EAAE,EAAE,sBAAsB;eAC1B/B,WAAW,EAAEsF,CAAC,CAAC7D,eAAe;eAC9BO,eAAe,EAAEC,QAAQ,CAACC,IAAI;eAC9BI,OAAO,EAAEsE,cAAI,CAACC,MAAM,CAAC2O,IAAI,CAACE,KAAK,CAAC;eAChCrT,QAAQ,EAAE,IAAI;eACdD,UAAU,EAAE,IAAI;eAChBk3B,SAAS,EAAE,KAAK;eAChBpyB,WAAW,EAAE;iBACZlE,QAAQ,EAAE;gBACV;eACDD,KAAK,EAAE;iBACNE,MAAM,EAAE;gBACR;eACDL,MAAM,EAAE;iBACPC,YAAY,EAAE,sBAACyC,CAAC;mBAAA,OAAK,MAAI,CAACu+B,mBAAmB,GAAG,IAAI;;;cAErD,CAAC;aACF,MAAI,CAACA,mBAAmB,CAACz8B,IAAI,EAAE;;;QAGjC,CAAC;;;KACF;KAAA,gCAGD;OACC,IAAI,CAACuvB,MAAM,GAAG,IAAI;;;KAClB;KAAA,8BAGD;OACC,IAAI,IAAI,CAACA,MAAM,EACf;SACC,IAAI,CAACA,MAAM,CAAC3vB,KAAK,EAAE;;;;KAEpB;KAAA,qCAEoBnH,MAAM,EAC3B;OACC,IAAI2H,MAAM,GAAG3H,MAAM,CAAC2F,WAAW;OAC/B,IAAI,CAACi8B,QAAQ,CAACj6B,MAAM,EAAE3H,MAAM,CAAC;OAE7B,IAAI,CAACiiC,eAAe,GAAGl7B,cAAI,CAACC,MAAM,CAACW,MAAM,CAAC;OAE1CA,MAAM,GAAG,IAAI,CAACs8B,kBAAkB,CAACt8B,MAAM,CAAC;OACxC,IAAI,uBAAQ3H,MAAM,KAAK,QAAQ,EAC/B;SACCA,MAAM,GAAG,EAAE;;OAGZ,IAAI,IAAI,CAACgiC,UAAU,EACnB;SACC;;OAGD,IAAI,IAAI,CAAC9e,QAAQ,EACjB;SACC;;OAGD,IAAI,CAACghB,SAAS,GAAG,IAAI;OACrB,IAAI,CAACtB,cAAc,GAAG,IAAI,CAACvO,MAAM;OACjC,IAAI,CAAC2N,UAAU,GAAG,KAAK;OACvB,IAAI,CAACmC,UAAU,GAAG,CAAC;OACnB,IAAI,CAACx+B,WAAW,GAAGgC,MAAM;OAEzB,IAAI,CAACub,QAAQ,GAAG,IAAI9Y,aAAa,CAAC;SACjC0V,MAAM,EAAE9f,MAAM,CAAC8f,MAAM;SACrBc,MAAM,EAAE5gB,MAAM,CAAC4gB,MAAM;SACrBX,SAAS,EAAEmB,SAAS,CAACE,QAAQ;SAC7B3b,WAAW,EAAE,IAAI,CAACA,WAAW;SAC7BsH,UAAU,EAAEzI,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC;SAClD4b,WAAW,EAAE,IAAI;SACjBC,UAAU,EAAE,IAAI;SAChBS,UAAU,EAAE/gB,MAAM,CAAC+gB,UAAU;SAC7BE,gBAAgB,EAAEjhB,MAAM,CAACihB,gBAAgB;SACzCD,cAAc,EAAEhhB,MAAM,CAACghB,cAAc;SACrCwF,mBAAmB,EAAExmB,MAAM,CAACwmB,mBAAmB;SAC/CpG,GAAG,EAAEpgB,MAAM,CAACokC,WAAW;SACvB5jB,aAAa,EAAExgB,MAAM,CAACwgB,aAAa;SACnCC,WAAW,EAAEzgB,MAAM,CAACygB,WAAW;SAC/B2F,OAAO,EAAE,IAAI,CAACka,QAAQ;SACtBzU,cAAc,EAAE,IAAI,CAACA,cAAc;SACnCha,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;SACvC+Z,eAAe,EAAE,IAAI,CAACA,eAAe;SACrC1K,QAAQ,EAAE,IAAI,CAACA;QACf,CAAC;OACFse,6BAAI,0DAAJ,IAAI,EAAyB,IAAI,CAACtc,QAAQ;OAC1C,IAAI,CAACA,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACoX,IAAI,CAAC;OACtC,IAAI,CAACoB,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACV,SAAS,CAAC;OAC/C,IAAI,CAACwB,QAAQ,CAAC3b,IAAI,EAAE;;;KACpB;KAAA,iCAGD;OAAA;OACC,IAAM88B,WAAW,GAAG54B,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAAC,mBAAmB,CAAC;OAC5D,IAAIuvB,WAAW,EACf;SACC,IAAI,CAACC,UAAU,GAAGD,WAAW;SAC7B,OAAOpT,OAAO,CAACC,OAAO,CAACmT,WAAW,CAAC;;OAGpC,OAAO,IAAIpT,OAAO,CAAC,UAACC,OAAO,EAAEqT,MAAM,EACnC;SACC,IAAI,MAAI,CAACD,UAAU,EACnB;WACC,OAAOpT,OAAO,CAAC,MAAI,CAACoT,UAAU,CAAC;;SAGhC74B,EAAE,CAAC6J,IAAI,CAACme,SAAS,CAAC,8BAA8B,CAAC,CAACxH,IAAI,CAAC,UAACyH,QAAQ,EAChE;WACC,MAAI,CAAC4Q,UAAU,GAAG5Q,QAAQ,CAAC/d,IAAI;WAC/BlK,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAAC,mBAAmB,EAAE,MAAI,CAACsuB,UAAU,EAAE,KAAK,CAAC;WAChE;aACCpT,OAAO,CAAC,MAAI,CAACoT,UAAU,CAAC;;UAEzB,CAAC,SAAM,CAAC,UAACE,GAAG,EACb;WACCluB,OAAO,CAACyL,KAAK,CAACyiB,GAAG,CAAC;WAClBD,MAAM,CAACC,GAAG,CAAC;UACX,CAAC;QACF,CAAC;;;KACF;KAAA,2BAEUhhC,MAAM,EACjB;OACC,IAAI,CAAC,IAAI,CAAC8gC,UAAU,EACpB;SACC,MAAM,IAAIx6B,KAAK,CAAC,iGAAiG,CAAC;;OAGnH,IAAI,IAAI,CAACw6B,UAAU,CAAC3gC,cAAc,CAACH,MAAM,CAAC,EAC1C;SACC,OAAO,IAAI,CAAC8gC,UAAU,CAAC9gC,MAAM,CAAC,CAACuT,IAAI,KAAK,MAAM;QAC9C,MAED;SACC,OAAO,KAAK;;;;KAEb;KAAA,+BAEcpR,WAAW,EAC1B;OACC,IAAM8+B,OAAO,GAAG,yBAAyB,CAACC,IAAI,CAAC/+B,WAAW,CAAC;OAC3D,IAAI,CAAC47B,eAAe,GAAG57B,WAAW;OAClC,IAAI8+B,OAAO,EACX;SACC,IAAI,CAAC9+B,WAAW,GAAG8+B,OAAO,CAAC,CAAC,CAAC;;;;KAE9B;KAAA,0BAES98B,MAAM,EAAE3H,MAAM,EACxB;OAAA;OACC,IAAI,CAAC0jC,cAAc,EAAE,CAACzX,IAAI,CAAC;SAAA,gCAAM,MAAI,oCAAJ,MAAI,EAActkB,MAAM,EAAE3H,MAAM;QAAC,CAAC;;;KACnE;KAAA,kCA+HD;OACC,IAAM2kC,UAAU,GAAG,IAAIC,gCAAU,CAAC;SACjCpQ,OAAO,EAAEhwB,aAAG,CAACC,UAAU,CAAC,kBAAkB,CAAC;SAC3CkH,OAAO,EAAEk5B,uCAAiB,CAACC,SAAS;SACpCC,SAAS,EAAEvgC,aAAG,CAACC,UAAU,CAAC,wBAAwB,CAAC;SACnDugC,aAAa,EAAExgC,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC;SACxDwgC,IAAI,EAAE,gBACN;WACC,IAAM1vB,GAAG,GAAG2vB,wCAAe,CAACC,qBAAqB,EAAE;WACnDr1B,MAAM,CAAC4I,IAAI,CAACnD,GAAG,EAAE,YAAY,CAAC;WAC9B,OAAO,IAAI;;QAEZ,CAAC;OACFovB,UAAU,CAACp9B,IAAI,EAAE;;;KACjB;KAAA,6BAEY5B,WAAmB,EAChC;OACC,IAAIy/B,UAAU,GAAG,IAAI,CAACnH,WAAW;OACjC,IAAMoH,UAAU,GAAGD,UAAU,CAACE,OAAO,CAAC3/B,WAAW,CAAC;OAElD,IAAI0/B,UAAU,KAAK,CAAC,EACpB,CAEC,MACI,IAAIA,UAAU,GAAG,CAAC,EACvB;;SAECD,UAAU,CAACG,MAAM,CAACF,UAAU,EAAEA,UAAU,CAAC;SACzC,IAAI,CAACpH,WAAW,GAAG,CAACt4B,WAAW,CAAC,CAAC6/B,MAAM,CAACJ,UAAU,CAAC;QACnD,MAED;;SAEC,IAAI,CAACnH,WAAW,GAAG,CAACt4B,WAAW,CAAC,CAAC6/B,MAAM,CAACJ,UAAU,CAACn1B,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;;OAGhExE,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAACgb,WAAW,EAAE,IAAI,CAACA,WAAW,EAAE,QAAQ,CAAC;OACnE,IAAI,CAACrS,eAAe,CAACyX,cAAc,CAAC,eAAe,EAAE,IAAI,CAACpF,WAAW,CAAC;;;KACtE;KAAA,8BAEankB,UAAU,EAAE9Z,MAAM,EAChC;OACC8Z,UAAU,GAAGiY,MAAM,CAACjY,UAAU,CAAC;OAC/B,IAAIA,UAAU,KAAK,CAAC,IAAI,IAAI,CAACuJ,WAAW,IAAI,IAAI,CAACH,QAAQ,IAAI,IAAI,CAACuiB,cAAc,EAAE,EAClF;SACC,OAAO,KAAK;;OAEb,IAAI,CAAC5Z,cAAc,CAACvoB,OAAO,EAAE;OAE7B,IAAI,CAACwW,UAAU,GAAGA,UAAU;OAC5B,IAAI,CAACoJ,QAAQ,GAAG,IAAI9Y,aAAa,CAAC;SACjCgW,GAAG,EAAE,IAAI;SACTtG,UAAU,EAAEA,UAAU;SACtB5F,gBAAgB,EAAElU,MAAM,CAACkU,gBAAgB;SACzC4I,iBAAiB,EAAE9c,MAAM,CAAC8c,iBAAiB;SAC3CmD,SAAS,EAAEmB,SAAS,CAACE,QAAQ;SAC7B1E,QAAQ,EAAG5c,MAAM,CAAC4c,QAAQ,KAAK,IAAK;SACpC7R,OAAO,EAAEL,OAAO,CAAC4W,QAAQ;SACzB5F,SAAS,EAAE1b,MAAM,CAAC0b,SAAS,IAAI,CAAC;SAChCC,cAAc,EAAE3b,MAAM,CAAC2b,cAAc,IAAI,EAAE;SAC3C0E,WAAW,EAAE,IAAI,CAACA,WAAW;SAC7BC,UAAU,EAAE,IAAI,CAAColB,eAAe,EAAE;SAClCtf,OAAO,EAAE,IAAI,CAACka,QAAQ;SACtBzU,cAAc,EAAE,IAAI,CAACA,cAAc;SACnCha,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;SACvC+Z,eAAe,EAAE,IAAI,CAACA,eAAe;SACrC1K,QAAQ,EAAE,IAAI,CAACA;QACf,CAAC;OAEFse,6BAAI,0DAAJ,IAAI,EAAyB,IAAI,CAACtc,QAAQ;OAC1C,IAAI,CAACA,QAAQ,CAAC3b,IAAI,EAAE;OAEpB,OAAO,IAAI;;;KACX;KAAA,iCAGD;OACC,OAAQ,IAAI,CAACuS,UAAU,GAAG,CAAC;;;KAC3B;KAAA,iCAEgBrU,CAAC,EAClB;OAAA;OACC,IAAI,CAACi+B,cAAc,EAAE,CAACzX,IAAI,CAAC;SAAA,gCAAM,MAAI,kDAAJ,MAAI,EAAqBxmB,CAAC;QAAC,CAAC;;;KAC7D;KAAA,sCAoHD;OAAA;OACC,IAAI,CAACkgC,0BAA0B,EAAE;OACjC,IAAI,CAAC/Z,eAAe,CAACga,eAAe,CAAC,UAAU,CAAC;OAChD,IAAI,CAACzD,gBAAgB,GAAG,IAAI;OAC5B12B,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,wBAAwB,EAAE;SAAC,SAAS,EAAE,IAAI,CAAC7iB;QAAO,CAAC;OAEtE,IAAI,IAAI,CAACgX,MAAM,EACf;SACC,IAAI,CAACA,MAAM,CAAC3vB,KAAK,EAAE;;OAGpB,IAAI,CAAC+b,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAAC8W,kBAAkB,CAAC;OACpD,IAAI,CAAC0B,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACC,UAAU,CAAC;OAEhD,IAAI,CAACwjB,YAAY,EAAE,CAAC5Z,IAAI,CACvB;SAAA,OAAMxgB,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,2BAA2B,EAAE;WAAC,SAAS,EAAE,MAAI,CAAC7iB;UAAO,CAAC;SAC/E;;;KACD;KAAA,+BAGD;OAAA;OACC,IAAI,CAAC,IAAI,CAACgmB,YAAY,EAAE,EACxB;SACC,OAAO7U,OAAO,CAACsT,MAAM,CAAC,4BAA4B,CAAC;;OAGpD,IAAI,IAAI,CAAC1B,gBAAgB,IAAI,IAAI,CAACA,gBAAgB,CAACnhB,SAAS,EAAE,EAC9D;SACC,IAAI,IAAI,CAACgf,iBAAiB,EAC1B;WACC,IAAI,CAACmC,gBAAgB,CAACkD,cAAc,CAAC,IAAI,CAACrF,iBAAiB,CAAC;;SAE7D,IAAI,IAAI,CAACE,cAAc,EACvB;WACCoF,UAAU,CAACC,QAAQ,CAACC,kBAAkB,CAACpxB,GAAG,EAAE,CAACqxB,uBAAuB,CAAC;aACpEC,QAAQ,EAAE,IAAI,CAACxF;YACf,CAAC;;SAGH,OAAO3P,OAAO,CAACC,OAAO,EAAE;;OAGzB,IAAImV,kBAAkB,GAAG;SACxBC,UAAU,EAAE,IAAI;SAChBC,WAAW,EAAE,IAAI;SACjBC,YAAY,EAAE,KAAK;SACnBC,YAAY,EAAE;QACd;OAED,IAAI,IAAI,CAAC5F,uBAAuB,KAAK,KAAK,EAC1C;SACCwF,kBAAkB,CAACK,gBAAgB,GAAG;WACrCC,QAAQ,EAAE,CACT;aAACC,gBAAgB,EAAE;YAAM,EACzB;aAACC,oBAAoB,EAAE;YAAM,EAC7B;aAACC,qBAAqB,EAAE;YAAM,EAC9B;aAACC,sBAAsB,EAAE;YAAM,EAC/B;aAACC,mBAAmB,EAAE;YAAM,EAC5B;aAACC,oBAAoB,EAAE;YAAM,EAC7B;aAACC,kBAAkB,EAAE;YAAM,EAC3B;aAACC,oBAAoB,EAAE;YAAM,EAC7B;aAACC,qBAAqB,EAAE;YAAM,EAC9B;aAACC,kBAAkB,EAAE;YAAM,EAC3B;aAACC,wBAAwB,EAAE;YAAM,EACjC;aAACC,kBAAkB,EAAE;YAAM;UAE5B;;OAGF,OAAO,IAAItW,OAAO,CAAC,UAACC,OAAO,EAAEqT,MAAM,EACnC;SACC94B,EAAE,CAAC+3B,UAAU,CAACgE,SAAS,CAAC;WACvBtyB,KAAK,EAAE,OAAI,CAACA,KAAK;WACjBuyB,aAAa,EAAEpB;UACf,CAAC,CAACpa,IAAI,CAAC,UAACyb,MAAM,EACf;WACC,OAAI,CAAC7E,gBAAgB,GAAG6E,MAAM;WAE9B,IAAI,OAAI,CAAChH,iBAAiB,EAC1B;aACC,OAAI,CAACmC,gBAAgB,CAACkD,cAAc,CAAC,OAAI,CAACrF,iBAAiB,CAAC;;WAE7D,IAAI,OAAI,CAACE,cAAc,EACvB;aACCoF,UAAU,CAACC,QAAQ,CAACC,kBAAkB,CAACpxB,GAAG,EAAE,CAACqxB,uBAAuB,CAAC;eACpEC,QAAQ,EAAE,OAAI,CAACxF;cACf,CAAC;;WAGH,IAAI,OAAI,CAAChV,eAAe,CAAC/f,SAAS,EAAE,IAAI5L,cAAI,CAACkB,UAAU,CAAC,OAAI,CAAC0hC,gBAAgB,CAAC8E,iBAAiB,CAAC,EAChG;aACC,OAAI,CAAC9E,gBAAgB,CAAC+E,mBAAmB,EAAE;aAC3C,OAAI,CAAC/E,gBAAgB,CAAC8E,iBAAiB,CAAC,UAAAliC,CAAC;eAAA,OAAI,OAAI,CAACm8B,QAAQ,CAACn8B,CAAC,CAACoiC,KAAK,GAAG,IAAI,GAAGpiC,CAAC,CAAC+uB,OAAO,CAAC;eAAC;;WAGxF,OAAI,CAACqO,gBAAgB,CAAC3xB,gBAAgB,CAAC80B,UAAU,CAAC7qB,MAAM,CAAC2sB,gBAAgB,EAAEtI,gCAAI,6CAAqBv8B,IAAI,CAAC,OAAI,CAAC,CAAC;WAC/G,OAAI,CAAC4/B,gBAAgB,CAAC3xB,gBAAgB,CAAC80B,UAAU,CAAC7qB,MAAM,CAAC4sB,gBAAgB,EAAEvI,gCAAI,6CAAqBv8B,IAAI,CAAC,OAAI,CAAC,CAAC;WAC/G,OAAI,CAAC4/B,gBAAgB,CAAC3xB,gBAAgB,CAAC80B,UAAU,CAAC7qB,MAAM,CAAC6sB,YAAY,EAAExI,gCAAI,qCAAiBv8B,IAAI,CAAC,OAAI,CAAC,CAAC;WACvG,OAAI,CAAC4/B,gBAAgB,CAAC3xB,gBAAgB,CAAC80B,UAAU,CAAC7qB,MAAM,CAAC8sB,eAAe,EAAEzI,gCAAI,+BAAcv8B,IAAI,CAAC,OAAI,CAAC,CAAC;WACvG,OAAI,CAAC4/B,gBAAgB,CAAC3xB,gBAAgB,CAAC80B,UAAU,CAAC7qB,MAAM,CAAC+sB,kBAAkB,EAAE,OAAI,CAACC,kBAAkB,CAACllC,IAAI,CAAC,OAAI,CAAC,CAAC;WAChH,OAAI,CAAC4/B,gBAAgB,CAAC3xB,gBAAgB,CAAC80B,UAAU,CAAC7qB,MAAM,CAACitB,gBAAgB,EAAE5I,gCAAI,6CAAqBv8B,IAAI,CAAC,OAAI,CAAC,CAAC;WAC/GiuB,OAAO,EAAE;UACT,CAAC,SAAM,CAAC,UAACzrB,CAAC,EACX;WACCgG,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,mCAAmC,EAAE;aACvD,SAAS,EAAE,OAAI,CAAC7iB,MAAM;aACtB,OAAO,EAAEra;YACT,CAAC;WAEF,OAAI,CAAC4iC,eAAe,EAAE;WACtB,OAAI,CAACzc,eAAe,CAAC0c,SAAS,CAAC,OAAO,CAAC;WACvC,OAAI,CAACC,mBAAmB,CAAC,SAAS,CAAC;WACnC,OAAI,CAACC,SAAS,CAAChkC,aAAG,CAACC,UAAU,CAAC,gBAAgB,CAAC,CAAC;WAChD,OAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACqX,KAAK,CAAC;WACvC,OAAI,CAACmB,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACN,IAAI,CAAC;WAE1CyiB,MAAM,CAAC,uCAAuC,CAAC;UAC/C,CAAC;QACF,CAAC;;;KACF;KAAA,mCAmCkB9+B,CAAC,EACpB;OACC,IAAI,CAACm8B,QAAQ,CAAC,cAAc,EAAE,IAAI,CAACiB,gBAAgB,CAAC4F,YAAY,EAAE,EAAE,IAAI,CAAC5F,gBAAgB,CAAC6F,YAAY,EAAE,CAAC;;;KACzG;KAAA,oCAsOmB1oC,MAAM,EAC1B;OAAA;;OAECA,MAAM,CAAC2xB,UAAU,GAAG,CAAC,CAAC3xB,MAAM,CAAC2xB,UAAU;OACvC,IAAI,CAACiQ,QAAQ,CAAC,eAAe,EAAE5hC,MAAM,CAAC;OAEtC,IAAI,CAAC,IAAI,CAAC8lC,YAAY,EAAE,EACxB;SACC,IAAI,CAAC6C,eAAe,EAAE;SACtB,OAAO,KAAK;;OAGb,IAAI,CAAC1G,eAAe,GAAGl7B,cAAI,CAACC,MAAM,CAAChH,MAAM,CAAC4oC,QAAQ,CAAC;OACnD5oC,MAAM,CAAC4oC,QAAQ,GAAG5oC,MAAM,CAAC4oC,QAAQ,CAAC7wB,OAAO,CAAC,iBAAiB,EAAE,EAAE,CAAC;OAEhE,IAAI,IAAI,CAACiqB,UAAU,EACnB;SACC,OAAO,KAAK;;OAGb,IAAI,CAACkC,SAAS,GAAG,IAAI;OACrB,IAAI,CAACtB,cAAc,GAAG,CAAC;OACvB,IAAI,CAACZ,UAAU,GAAG,KAAK;OACvB,IAAI,CAACmC,UAAU,GAAG,CAAC;OACnB,IAAI,CAACpC,aAAa,GAAG,IAAI;OACzB,IAAI,CAACjiB,MAAM,GAAG9f,MAAM,CAAC8f,MAAM;OAC3B,IAAI,CAACna,WAAW,GAAG3F,MAAM,CAAC4oC,QAAQ;OAClC,IAAI,CAACvH,WAAW,GAAG,EAAE;OAErB,IAAMphB,SAAS,GAAGjgB,MAAM,CAAC2xB,UAAU,GAAGvQ,SAAS,CAAC7W,QAAQ,GAAG6W,SAAS,CAACC,QAAQ;OAE7E,IAAI,CAAC6B,QAAQ,GAAG,IAAI9Y,aAAa,CAAC;SACjCiqB,MAAM,EAAE,IAAI,CAACA,MAAM;SACnB1uB,WAAW,EAAE,IAAI,CAACA,WAAW;SAC7BogB,UAAU,EAAE/lB,MAAM,CAAC+lB,UAAU;SAC7B/F,kBAAkB,EAAEhgB,MAAM,CAACggB,kBAAkB;SAC7CgR,SAAS,EAAE,IAAI,CAACiR,eAAe;SAC/BhiB,SAAS,EAAEA,SAAS;SACpBM,QAAQ,EAAE,IAAI,CAAC8hB,cAAc;SAC7Bp1B,UAAU,EAAGjN,MAAM,CAAC2xB,UAAU,GAAGntB,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC,GAAGD,aAAG,CAACC,UAAU,CAAC,iBAAiB,CAAE;SAChH2b,GAAG,EAAEpgB,MAAM,CAACokC,WAAW;SACvB5jB,aAAa,EAAExgB,MAAM,CAACwgB,aAAa;SACnCC,WAAW,EAAEzgB,MAAM,CAACygB,WAAW;SAC/BC,aAAa,EAAE1gB,MAAM,CAAC0gB,aAAa;SACnCC,kBAAkB,EAAE3gB,MAAM,CAAC2gB,kBAAkB;SAC7Cb,MAAM,EAAE,IAAI,CAACA,MAAM;SACnBsG,OAAO,EAAE,IAAI,CAACka,QAAQ;SACtBzU,cAAc,EAAE,IAAI,CAACA,cAAc;SACnCha,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;SACvC+Z,eAAe,EAAE,IAAI,CAACA,eAAe;SACrC1K,QAAQ,EAAE,IAAI,CAACA;QACf,CAAC;OACFse,6BAAI,0DAAJ,IAAI,EAAyB,IAAI,CAACtc,QAAQ;OAC1C,IAAI,CAACA,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAAC2W,QAAQ,CAAC;OAC1C,IAAI,CAAC6B,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACC,UAAU,CAAC;OAChD,IAAIriB,MAAM,CAAC4gB,MAAM,EACjB;SACC,IAAI,CAACsC,QAAQ,CAACW,SAAS,CAAC7jB,MAAM,CAAC4gB,MAAM,CAAC;;OAGvC,IAAI,CAACsC,QAAQ,CAAC3b,IAAI,EAAE;OAEpB,IAAIvH,MAAM,CAAC+gB,UAAU,EACrB;SACC,IAAI,CAACmC,QAAQ,CAACO,aAAa,CAAC,IAAI,CAAC;SACjC,IAAI,CAACP,QAAQ,CAACU,iBAAiB,CAAC5jB,MAAM,CAACghB,cAAc,CAAC;SACtD,IAAI,CAACkC,QAAQ,CAACQ,mBAAmB,CAAC1jB,MAAM,CAACihB,gBAAgB,CAAC;;OAG3D,IAAI,CAACke,iBAAiB,GAAG,IAAI;OAC7B,IAAI,CAACD,qBAAqB,GAAG34B,UAAU,CAAC,YAAM;SAC7C+P,OAAO,CAACC,GAAG,CAAC,0BAA0B,CAAC;SACvC,IAAI,CAAC,OAAI,CAAC8M,WAAW,EACrB;WAAA;WACC,2BAAI,CAACH,QAAQ,qDAAb,iBAAemH,kBAAkB,EAAE;;SAEpC,OAAI,CAAC6U,qBAAqB,GAAG,IAAI;QACjC,EAAE,KAAK,CAAC;;;KACT;KAAA,qCAGD;OAAA;OACC,IAAI,CAAC,IAAI,CAAC7b,WAAW,IAAI,IAAI,CAACgd,UAAU,IAAI9B,UAAU,CAACC,MAAM,EAC7D;SACC,OAAO,KAAK;;OAGb,IAAI,CAAC,IAAI,CAAC+D,uBAAuB,IAAI,CAAC,IAAI,CAACC,qBAAqB,EAChE;SACC,OAAO,KAAK;;OAEb,IAAMqG,cAAc,GAAG;SACtB,SAAS,EAAE,IAAI,CAAC/oB,MAAM;SACtB,aAAa,EAAE,IAAI,CAACyiB,uBAAuB;SAC3C,WAAW,EAAE,IAAI,CAACC;QAClB;OAED/2B,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,+BAA+B,EAAEkG,cAAc,CAAC,CAAC5c,IAAI,CAAC,UAACyH,QAAQ,EAClF;SACC,IAAM/d,IAAI,GAAG+d,QAAQ,CAAC/d,IAAI,EAAE;SAE5B,IAAIA,IAAI,CAACmzB,OAAO,IAAI,GAAG,EACvB;WACC,OAAI,CAACpG,oBAAoB,GAAG,IAAI;WAChCj3B,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAAC+a,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;WAEzC,OAAI,CAACyE,mBAAmB,GAAG9sB,IAAI,CAACozB,IAAI,CAACC,IAAI,CAACC,OAAO;WACjD,OAAI,CAAC/lB,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,uBAAuB,CAAC,CAAC;WACpE,OAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACiX,YAAY,CAAC;UAC9C,MAED;WACCrL,OAAO,CAACyL,KAAK,CAAC,wCAAwC,EAAEpM,IAAI,CAACuzB,MAAM,CAAC;;QAErE,CAAC;;;KACF;KAAA,uCAGD;OACC,IAAI,CAAC,IAAI,CAAC7lB,WAAW,IAAI,IAAI,CAACgd,UAAU,IAAI9B,UAAU,CAACC,MAAM,EAC7D;SACC,OAAO,KAAK;;OAGb,IAAI,CAACtb,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,qBAAqB,CAAC,CAAC;OAClE,IAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACgX,SAAS,CAAC;OAE3C,IAAI,IAAI,CAAC+gB,mBAAmB,KAAK,EAAE,EACnC;SACCh3B,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,gCAAgC,EAAE;WAAC,SAAS,EAAE,IAAI,CAACF;UAAoB,CAAC;;OAG5F,IAAI,CAACD,qBAAqB,GAAG,CAAC;OAC9B,IAAI,CAACD,uBAAuB,GAAG,EAAE;OACjC,IAAI,CAACE,mBAAmB,GAAG,EAAE;OAC7B,IAAI,CAACC,oBAAoB,GAAG,KAAK;OACjCj3B,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAAC+a,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC;;;KAC1C;KAAA,oCAEmBmL,IAAI,EAAEC,MAAM,EAChC;OACC,IAAID,IAAI,IAAI,KAAK,IAAIA,IAAI,IAAI,KAAK,IAAIA,IAAI,IAAI,KAAK,EACnD;SACC,IAAI,CAACjmB,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,wBAAwB,GAAG0kC,IAAI,CAAC,CAAC;QAC5E,MAED;SACC,IAAI,CAACjmB,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC,CAAC;;OAEvE,IAAI,CAACmnB,eAAe,CAAC0c,SAAS,CAAC,OAAO,EAAE,IAAI,CAAC;OAC7C,IAAI,CAACplB,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACkX,cAAc,CAAC;OAEhD,IAAI,CAAC4gB,qBAAqB,GAAG,CAAC;OAC9B,IAAI,CAACD,uBAAuB,GAAG,EAAE;OACjC,IAAI,CAACE,mBAAmB,GAAG,EAAE;OAC7B,IAAI,CAACC,oBAAoB,GAAG,KAAK;OACjCj3B,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAAC+a,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC;;;KAC1C;KAAA,mCAGD;OACCvyB,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,kCAAkC,EAAE;SAAC,SAAS,EAAE,IAAI,CAACF;QAAoB,CAAC;;;KAC7F;KAAA,iCAEgBziC,MAAM,EACvB;OAAA;OACC,IAAIigB,SAAS;OACb,IAAI,IAAI,CAACiD,QAAQ,EACjB;SACC;;OAGD3c,UAAU,CAAC;SAAA,OAAMkF,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAACG,YAAY,EAAE,IAAI,EAAE,CAAC,CAAC;UAAE,GAAG,CAAC;OACxEoW,aAAa,CAAC,IAAI,CAACgI,sBAAsB,CAAC;OAC1C,IAAI,CAACA,sBAAsB,GAAGxI,WAAW,CAAC,YAC1C;SACC,IAAI,OAAI,CAACoH,eAAe,EACxB;WACC30B,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAACG,YAAY,EAAE,IAAI,EAAE,CAAC,CAAC;;QAElD,EAAE,IAAI,CAAC;OAER,IAAI,CAACtD,MAAM,GAAG9f,MAAM,CAAC8f,MAAM;OAC3B,IAAI,CAACkiB,UAAU,GAAG,IAAI;OACtB,IAAI,CAAC5B,eAAe,GAAG,IAAI;OAE3B,IAAIpgC,MAAM,CAAC2xB,UAAU,EACrB;SACC1R,SAAS,GAAGmB,SAAS,CAAC7W,QAAQ;QAC9B,MACI,IAAIvK,MAAM,CAACkgB,UAAU,GAAG,CAAC,EAC9B;SACCD,SAAS,GAAGmB,SAAS,CAACE,QAAQ;QAC9B,MAED;SACCrB,SAAS,GAAGmB,SAAS,CAACC,QAAQ;;OAG/B,IAAI,CAAC6B,QAAQ,GAAG,IAAI9Y,aAAa,CAAC;SACjC0V,MAAM,EAAE9f,MAAM,CAAC8f,MAAM;SACrBG,SAAS,EAAEA,SAAS;SACpBta,WAAW,EAAE3F,MAAM,CAAC2F,WAAW;SAC/BogB,UAAU,EAAE/lB,MAAM,CAAC+lB,UAAU;SAC7B/F,kBAAkB,EAAEhgB,MAAM,CAACggB,kBAAkB;SAC7CE,UAAU,EAAElgB,MAAM,CAACkgB,UAAU;SAC7BC,QAAQ,EAAEngB,MAAM,CAACmgB,QAAQ;SACzBC,GAAG,EAAEpgB,MAAM,CAACokC,WAAW;SACvB5jB,aAAa,EAAExgB,MAAM,CAACwgB,aAAa;SACnCC,WAAW,EAAEzgB,MAAM,CAACygB,WAAW;SAC/B6F,WAAW,EAAEtmB,MAAM,CAACsmB,WAAW;SAC/B5F,aAAa,EAAE1gB,MAAM,CAAC0gB,aAAa;SACnCC,kBAAkB,EAAE3gB,MAAM,CAAC2gB,kBAAkB;SAC7CyF,OAAO,EAAE,IAAI,CAACka,QAAQ;SACtBn2B,cAAc,EAAE,IAAI;SACpB0hB,cAAc,EAAE,IAAI,CAACA,cAAc;SACnCha,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;SACvC+Z,eAAe,EAAE,IAAI,CAACA,eAAe;SACrC1K,QAAQ,EAAE,IAAI,CAACA;QACf,CAAC;OACF,IAAI,CAACmoB,kCAAkC,CAAC,IAAI,CAACnmB,QAAQ,CAAC;OACtD,IAAI,CAACA,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACyX,YAAY,CAAC;OAC9C,IAAI,CAACe,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACV,SAAS,CAAC;OAC/C,IAAI,CAACwB,QAAQ,CAACW,SAAS,CAAC7jB,MAAM,CAAC4gB,MAAM,CAAC;OACtC,IAAI,CAACsC,QAAQ,CAAC3b,IAAI,EAAE;OAEpB,IAAIvH,MAAM,CAAC+gB,UAAU,EACrB;SACC,IAAI,CAACmC,QAAQ,CAACO,aAAa,CAAC,IAAI,CAAC;SACjC,IAAI,CAACP,QAAQ,CAACU,iBAAiB,CAAC5jB,MAAM,CAACghB,cAAc,CAAC;SACtD,IAAI,CAACkC,QAAQ,CAACQ,mBAAmB,CAAC1jB,MAAM,CAACihB,gBAAgB,CAAC;;;;KAE3D;KAAA,mDAEkCiC,QAAQ,EAC3C;OAAA;OACCA,QAAQ,CAAComB,WAAW,CAAC,OAAO,EAAE,YAC9B;SACC,IAAI,OAAI,CAACpmB,QAAQ,EACjB;WACC,OAAI,CAACA,QAAQ,CAACqmB,OAAO,EAAE;WACvB,OAAI,CAACC,oBAAoB,EAAE;WAC3B,OAAI,CAACtmB,QAAQ,GAAG,IAAI;;SAErB,OAAI,CAACic,iBAAiB,GAAG,KAAK;SAE9B,OAAI,CAACrf,MAAM,GAAG,EAAE;SAChB,OAAI,CAACkiB,UAAU,GAAG,KAAK;SACvB,OAAI,CAAC5B,eAAe,GAAG,KAAK;SAC5B,OAAI,CAAC+B,gBAAgB,GAAG,KAAK;SAC7B3I,aAAa,CAAC,OAAI,CAACgI,sBAAsB,CAAC;SAC1C/1B,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAACG,YAAY,EAAE,KAAK,CAAC;QAC/C,CAAC;OACFF,QAAQ,CAAComB,WAAW,CAAC,aAAa,EAAE9J,6BAAI,mDAAwBv8B,IAAI,CAAC,IAAI,CAAC,CAAC;;;KAC3E;KAAA,iCAEgBwmC,SAAS,EAC1B;OACC,IAAI,IAAI,CAACvmB,QAAQ,IAAI,CAAC,IAAI,CAACA,QAAQ,CAACuiB,cAAc,EAAE,EACpD;SACC,IAAI,CAACviB,QAAQ,CAAC8X,SAAS,EAAE;;;;KAE1B;KAAA,2BAGD;OACC,IAAI,IAAI,CAACpP,eAAe,CAAC/f,SAAS,EAAE,EACpC;SACC,IAAIzG,IAAI,GAAG,EAAE;SACb,KAAK,IAAI2L,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG24B,SAAS,CAACnmC,MAAM,EAAEwN,CAAC,EAAE,EACzC;WACC,IAAItF,EAAE,CAACpH,IAAI,CAACnE,aAAa,CAACwpC,SAAS,CAAC34B,CAAC,CAAC,CAAC,EACvC;aACC,IACA;eACC3L,IAAI,GAAGA,IAAI,GAAG,KAAK,GAAGyb,IAAI,CAACC,SAAS,CAAC4oB,SAAS,CAAC34B,CAAC,CAAC,CAAC;cAClD,CAAC,OAAOtL,CAAC,EACV;eACCL,IAAI,GAAGA,IAAI,GAAG,yBAAyB;;YAExC,MAED;aACCA,IAAI,GAAGA,IAAI,GAAG,KAAK,GAAGskC,SAAS,CAAC34B,CAAC,CAAC;;;SAGpCsN,+BAAU,CAACsrB,cAAc,CAAC,QAAQ,GAAG,IAAI,CAAC9K,SAAS,GAAG,MAAM,EAAEz5B,IAAI,CAACoD,SAAS,CAAC,CAAC,CAAC,CAAC;;OAEjF,IAAI,IAAI,CAAC0M,KAAK,EACd;SACC,IAAIoB,OAAO,EACX;WACC,IACA;aACCA,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEsK,IAAI,CAACC,SAAS,CAAC4oB,SAAS,CAAC,CAAC;YACnD,CAAC,OAAOjkC,CAAC,EACV;aACC6Q,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEmzB,SAAS,CAAC,CAAC,CAAC,CAAC;;;;;;CAQ3C;CACA;CACA;CACA;CACA;;KALC;KAAA,+BAOA;OACC,IAAIE,oBAAU,CAACC,QAAQ,CAAC,oCAAoC,CAAC,EAC7D;SACC,OAAO,IAAI5Y,OAAO,CAAC,UAACC,OAAO,EAAK;WAC/B,IAAMnlB,OAAO,GAAGN,EAAE,CAACq+B,SAAS,CAACC,EAAE,CAACC,GAAG,CAACC,cAAc,CAAC7Y,WAAW,EAAE;WAChErlB,OAAO,CAACm+B,6BAA6B,EAAE,CACrCje,IAAI,CAAC,UAACtiB,MAAM,EAAK;aACjB,IAAIA,MAAM,KAAK,KAAK,EACpB;eACCunB,OAAO,EAAE;;YAEV,CAAC;UACH,CAAC;;OAGH,IAAI0Y,oBAAU,CAACC,QAAQ,CAAC,iBAAiB,CAAC,EAC1C;SACC,OAAO,IAAI5Y,OAAO,CAAC,UAACC,OAAO,EAAK;WAC/BzlB,EAAE,CAAC0+B,YAAY,CAACC,YAAY,CAC3B,YAAM,EAAE,EACR;aAAA,OAAMlZ,OAAO,EAAE;aACf;UACD,CAAC;;OAGH,OAAOD,OAAO,CAACC,OAAO,EAAE;;;KACxB;KAAA,wCAGD;OAAA;OACC,IAAMmZ,cAAc,GAAG5+B,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,QAAM,CAACib,UAAU,CAAC;OAE7D,IAAI,CAACj+B,cAAI,CAACC,aAAa,CAACmqC,cAAc,CAAC,EACvC;SACC;;OAGD,IAAI,CAACrI,UAAU,GAAG,IAAI;OACtB,IAAI,CAACliB,MAAM,GAAGuqB,cAAc,CAACvqB,MAAM;OACnC,IAAI,CAACwgB,QAAQ,GAAG+J,cAAc,CAAC/J,QAAQ;OACvC,IAAI,CAACD,UAAU,GAAGgK,cAAc,CAACC,eAAe;OAChD,IAAI,CAAClK,eAAe,GAAGiK,cAAc,CAACjK,eAAe;OAErD,IAAImK,kBAAkB,GAAGF,cAAc,CAACnnB,QAAQ;OAChDqnB,kBAAkB,CAAC1e,cAAc,GAAG,IAAI,CAACA,cAAc;OACvD0e,kBAAkB,CAAC14B,gBAAgB,GAAG,IAAI,CAACA,gBAAgB;OAC3D04B,kBAAkB,CAAC3e,eAAe,GAAG,IAAI,CAACA,eAAe;OACzD,IAAI,CAAC1I,QAAQ,GAAG,IAAI9Y,aAAa,CAACigC,cAAc,CAACnnB,QAAQ,CAAC;OAC1D,IAAI,IAAI,CAACkd,eAAe,EACxB;SACC,IAAI,CAACld,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACyX,YAAY,CAAC;SAC9C,IAAI,CAACe,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACV,SAAS,CAAC;SAC/C,IAAI,CAAC2nB,kCAAkC,CAAC,IAAI,CAACnmB,QAAQ,CAAC;QACtD,MAED;SACCsc,6BAAI,0DAAJ,IAAI,EAAyB,IAAI,CAACtc,QAAQ;;OAG3C,IAAI,IAAI,CAACkd,eAAe,EACxB;SACC30B,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAACG,YAAY,EAAE,IAAI,EAAE,CAAC,CAAC;SACjD,IAAI,CAACoe,sBAAsB,GAAGxI,WAAW,CACxC,YACA;WACC,IAAI,OAAI,CAACoH,eAAe,EACxB;aACC30B,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAACG,YAAY,EAAE,IAAI,EAAE,CAAC,CAAC;;UAElD,EACD,IAAI,CACJ;;OAGF3X,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,qBAAqB,EAAE;SAAC,SAAS,EAAE,IAAI,CAAC7iB;QAAO,CAAC,SAAM,CAAC,YAC1E;;;SAGC,OAAI,CAACA,MAAM,GAAG,EAAE;SAChB,OAAI,CAACkiB,UAAU,GAAG,KAAK;SACvB,OAAI,CAAC5B,eAAe,GAAG,KAAK;SAC5B,OAAI,CAAC+B,gBAAgB,GAAG,KAAK;SAC7B3I,aAAa,CAAC,OAAI,CAACgI,sBAAsB,CAAC;SAC1C/1B,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAACG,YAAY,EAAE,KAAK,CAAC;SAC/C,IAAI,OAAI,CAACF,QAAQ,EACjB;WACC,OAAI,CAACA,QAAQ,CAACqmB,OAAO,EAAE;WACvB,OAAI,CAACC,oBAAoB,EAAE;WAC3B,OAAI,CAACtmB,QAAQ,GAAG,IAAI;;SAErB,OAAI,CAACic,iBAAiB,GAAG,KAAK;QAC9B,CAAC;;;KACF;KAAA,mCAEkBqL,OAAO,EAC1B;OACC,IAAI,CAAC,IAAI,CAACnnB,WAAW,IAAI,IAAI,CAACA,WAAW,CAACzY,KAAK,EAAE,IAAI,WAAW,EAChE;SACC,OAAO,KAAK;;OAGb,IAAImwB,KAAK,GAAG,CAAC;OACb,IAAI,GAAG,IAAIyP,OAAO,EAClB;SACCzP,KAAK,GAAG,CAAC;QACT,MACI,IAAIyP,OAAO,IAAI,EAAE,EACtB;SACCzP,KAAK,GAAG,CAAC;QACT,MACI,IAAIyP,OAAO,IAAI,EAAE,EACtB;SACCzP,KAAK,GAAG,CAAC;QACT,MACI,IAAIyP,OAAO,IAAI,EAAE,EACtB;SACCzP,KAAK,GAAG,CAAC;QACT,MAED;SACCA,KAAK,GAAG,CAAC;;OAGV,IAAI,CAAC7X,QAAQ,CAACunB,UAAU,CAAC1P,KAAK,CAAC;OAC/B,OAAOA,KAAK;;;KACZ;KAAA,oCAEmBlU,QAAQ,EAC5B;OACC,IAAI,IAAI,CAAC3D,QAAQ,EACjB;SACC,IAAI,CAACA,QAAQ,CAACwnB,WAAW,CAAC7jB,QAAQ,CAAC;SACnC,IAAIA,QAAQ,KAAK,SAAS,EAC1B;WACC,IAAI,CAAC+E,eAAe,CAAC0c,SAAS,CAAC,OAAO,CAAC;;;;;KAGzC;KAAA,kCAEiB9wB,MAAM,EACxB;OACC,IAAI,CAACvX,cAAI,CAAC2f,cAAc,CAACpI,MAAM,CAAC,EAChC;SACC,OAAO,KAAK;;OAGb,IAAI,IAAI,CAAC0L,QAAQ,EACjB;SACC,IAAI,CAACA,QAAQ,CAAClW,aAAa,CAACwK,MAAM,CAAC;;;;KAEpC;KAAA,oCAEmBzK,KAAK,EACzB;OACC,IAAI,IAAI,CAACmW,QAAQ,EACjB;SACC,IAAI,CAACA,QAAQ,CAACpW,QAAQ,CAACC,KAAK,CAAC;;;;KAE9B;KAAA,iCAEgBnC,KAAK;;KACtB;OAAA;OACCA,KAAK,GAAG,OAAQA,KAAM,IAAI,WAAW,GAAG,OAAO,GAAGA,KAAK;OAEvD,IAAIA,KAAK,IAAI,OAAO,EACpB;SACC,IAAI,CAAC62B,qBAAqB,GAAGzI,WAAW,CAAC;WAAA,OAAM,OAAI,CAAC2R,aAAa,EAAE;YAAE,IAAI,CAAC;QAC1E,MAED;SACCnR,aAAa,CAAC,IAAI,CAACiI,qBAAqB,CAAC;;;;KAE1C;KAAA,0BAES2H,MAAM,EAChB;OACC,IAAI,CAACwB,uBAAuB,EAAE;OAE9B,IAAIxB,MAAM,IAAI,IAAI,CAAClmB,QAAQ,EAC3B;SACC,IAAI,IAAI,CAACA,QAAQ,EACjB;WACC,IAAI,CAACA,QAAQ,CAAClW,aAAa,CAACo8B,MAAM,CAAC;;;;;KAGrC;KAAA,0CAGD;;;OAGC,IAAI,CAACf,eAAe,EAAE;OAEtB,IAAI,CAAC1C,0BAA0B,EAAE;OACjC,IAAI,CAAC/Z,eAAe,CAACga,eAAe,CAAC,UAAU,CAAC;OAChD,IAAI,CAACha,eAAe,CAACga,eAAe,CAAC,UAAU,CAAC;OAEhDn/B,YAAY,CAAC,IAAI,CAACokC,sBAAsB,CAAC;OACzC,IAAI,IAAI,CAACC,eAAe,EACxB;SACC,IAAI,CAACA,eAAe,CAAC3jC,KAAK,EAAE;;;;KAG7B;KAAA,2BAEUnH,MAAM,EACjB;OACC,IAAIA,MAAM,CAAC4F,GAAG,IAAIqd,QAAM,CAAC+a,IAAI,EAC7B;SACC,IAAIh+B,MAAM,CAACsE,KAAK,KAAK,IAAI,IAAI,CAAC,IAAI,CAAC69B,gBAAgB,EACnD;WACC,IAAI,CAACO,oBAAoB,GAAG1iC,MAAM,CAACsE,KAAK;;QAEzC,MACI,IAAItE,MAAM,CAAC4F,GAAG,IAAIqd,QAAM,CAACG,YAAY,EAC1C;SACC,IAAIpjB,MAAM,CAACsE,KAAK,KAAK,KAAK,EAC1B;WACC,IAAI,CAACymC,gBAAgB,EAAE;;;;;KAGzB;KAAA,+BAGD;OAAA;OACC,OAAO;SACNC,WAAW,EAAEv/B,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAAC,aAAa,CAAC,GAAG,GAAG,GAAG,GAAG;SAC3DjJ,SAAS,EAAE,IAAI,CAAC+f,eAAe,CAAC/f,SAAS,EAAE,GAAG,GAAG,GAAG,GAAG;SACvDo/B,UAAU,EAAEnK,SAAS,CAACmK,UAAU;SAChC/K,aAAa,EAAE,IAAI,CAACtU,eAAe,CAACsU,aAAa,EAAE,GAAG,GAAG,GAAG,GAAG;SAC/DuF,cAAc,EAAE,IAAI,CAACA,cAAc,EAAE,GAAG,IAAI,CAAC3rB,UAAU,GAAG,GAAG;SAC7DuJ,WAAW,EAAE,IAAI,CAACA,WAAW,GAAG,IAAI,CAACA,WAAW,CAACnhB,EAAE,EAAE,GAAG,GAAG;SAC3DghB,QAAQ,EAAE,IAAI,CAACA,QAAQ,GAAG,IAAI,CAACA,QAAQ,CAACpD,MAAM,GAAG,GAAG;SACpDorB,aAAa,EAAE,sBAAI,CAAChoB,QAAQ,2CAAb,eAAenhB,KAAK,GAAG,GAAG,GAAG,GAAG;SAC/Co9B,iBAAiB,EAAE,IAAI,CAACA,iBAAiB,GAAG,GAAG,GAAG,GAAG;SACrDgM,gBAAgB,EAAE,uBAAI,CAACjoB,QAAQ,4CAAb,gBAAe3V,QAAQ,EAAE,GAAG,GAAG,GAAG,GAAG;SACvDs1B,gBAAgB,EAAE,IAAI,CAACA,gBAAgB,4BAAG,IAAI,CAACA,gBAAgB,0DAArB,sBAAuBnhB,SAAS,EAAE,GAAG;QAC/E;;;KACD;KAAA,iCAEgB0pB,gBAAgB,EAAEC,OAAO,EAC1C;OAAA,IAD4CrrC,MAAM,uEAAG,EAAE;OAEtD,IAAI,CAACqrC,OAAO,EACZ;SACCA,OAAO,GAAG,EAAE;;OAGb,IAAM13B,OAAO,GAAG;SACflR,OAAO,EAAEsE,cAAI,CAACC,MAAM,CAACokC,gBAAgB,CAAC;SACtCjoC,QAAQ,EAAE,WAAW;SACrBmoC,WAAW,EAAE,IAAI;SACjBD,OAAO,EAAEA;QACT;OAED,IAAIrrC,MAAM,CAACurC,aAAa,EACxB;SACC53B,OAAO,CAAC43B,aAAa,GAAGvrC,MAAM,CAACurC,aAAa;QAC5C,MAED;SACC53B,OAAO,CAACnR,QAAQ,GAAG,KAAK;;OAGzB,OAAOiJ,EAAE,CAACo4B,EAAE,CAAC2H,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC/3B,OAAO,CAAC;;;KAChD;KAAA,sCAGD;OACC,IAAI,CAAC,IAAI,CAACg4B,qBAAqB,IAAI,IAAI,CAACzoB,QAAQ,EAChD;SACC,IAAI,CAACyoB,qBAAqB,GAAG,IAAI,CAACC,gBAAgB,CAACpnC,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC,CAAC;;;;KAEtG;KAAA,uCAGD;OACC,IAAI,IAAI,CAACknC,qBAAqB,EAC9B;SACC,IAAI,CAACA,qBAAqB,CAACxkC,KAAK,EAAE;SAClC,IAAI,CAACwkC,qBAAqB,GAAG,IAAI;;;;KAElC;KAAA,6CAGD;OACC,IAAI,IAAI,CAACzM,qBAAqB,EAC9B;SACC5oB,OAAO,CAACC,GAAG,CAAC,kCAAkC,GAAG,IAAI,CAAC2oB,qBAAqB,CAAC;SAC5Ez4B,YAAY,CAAC,IAAI,CAACy4B,qBAAqB,CAAC;SACxC,IAAI,CAACA,qBAAqB,GAAG,IAAI;;;;KAElC;KAAA,6BAGD;OAAA;OACC,IAAMpf,MAAM,GAAG,WAAW;OAC1B,IAAI,CAACoD,QAAQ,GAAG,IAAI9Y,aAAa,CAAC;SACjC0V,MAAM,EAANA,MAAM;SACNoB,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvB2K,cAAc,EAAE,IAAI,CAACA,cAAc;SACnCha,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;SACvC+Z,eAAe,EAAE,IAAI,CAACA,eAAe;SACrCtpB,QAAQ,EAAE,IAAI,CAACspB,eAAe,CAACigB,WAAW,EAAE;SAC5C9oC,MAAM,EAAE;WACPoE,KAAK,EAAE,iBACP;aAAA;aACCmP,OAAO,CAACw1B,KAAK,CAAC,OAAO,CAAC;aACtB,2BAAI,CAAC5oB,QAAQ,qDAAb,iBAAeqmB,OAAO,EAAE;aACxB,OAAI,CAACrmB,QAAQ,GAAG,IAAI;YACpB;WACD6E,MAAM,EAAE;aAAA,OAAM,OAAI,CAAC7E,QAAQ,CAAC/b,KAAK,EAAE;;WACnCoZ,QAAQ,EAAE,kBAAC9a,CAAC;aAAA,OAAK6Q,OAAO,CAACC,GAAG,CAAC,UAAU,EAAE9Q,CAAC,CAAC;;WAC3C2iB,oBAAoB,EAAE,8BAAC3iB,CAAC;aAAA,OAAK6Q,OAAO,CAACC,GAAG,CAAC,sBAAsB,EAAE9Q,CAAC,CAAC;;WACnEgH,IAAI,EAAE;aAAA,OAAM6J,OAAO,CAACC,GAAG,CAAC,MAAM,CAAC;;WAC/B3J,MAAM,EAAE;aAAA,OAAM0J,OAAO,CAACC,GAAG,CAAC,QAAQ,CAAC;;WACnC3K,IAAI,EAAE;aAAA,OAAM0K,OAAO,CAACC,GAAG,CAAC,MAAM,CAAC;;WAC/BlK,MAAM,EAAE;aAAA,OAAMiK,OAAO,CAACC,GAAG,CAAC,QAAQ,CAAC;;;QAEpC,CAAC;OACF,IAAI,CAAC2M,QAAQ,CAAC3b,IAAI,EAAE;;;KACpB;KAAA,0BAGD;;KAEC;KAAA,2BAGD;OACC,IAAI,CAAC2b,QAAQ,GAAG,IAAI9Y,aAAa,CAAC;SACjCwhB,eAAe,EAAE,IAAI,CAACA;QACtB,CAAC;;;KACF;KAAA,oBA1mFD;OACC,OAAO,IAAI,CAAC6U,YAAY;MACxB;KAAA,kBAEezJ,IAAsB,EACtC;OACC,IAAI,IAAI,CAACyJ,YAAY,EACrB;SACCjB,6BAAI,8DAAJ,IAAI,EAA2B,IAAI,CAACiB,YAAY;SAEhD,IAAI,CAAC1jB,IAAI,CAAC5B,QAAM,CAACkjB,eAAe,EAAE;WACjCrH,IAAI,EAAE,IAAI,CAACyJ;UACX,CAAC;;OAEHzJ,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAE90B,EAAE,EAAE,GACPuJ,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAACI,WAAW,EAAE2T,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAE90B,EAAE,EAAE,EAAE,KAAK,CAAC,GAC1DuJ,EAAE,CAAC6Q,YAAY,CAACC,MAAM,CAAC0G,QAAM,CAACI,WAAW,CAAC;OAG7C,IAAI,CAACod,YAAY,GAAGzJ,IAAI;OACxB,IAAI,CAACmI,iBAAiB,GAAGqB,OAAO,CAAC,IAAI,CAACC,YAAY,CAAC;OAEnD,IAAI,IAAI,CAACA,YAAY,EACrB;SACCjB,6BAAI,wDAAJ,IAAI,EAAwBxI,IAAI;SAChC,IAAI,CAACja,IAAI,CAAC5B,QAAM,CAACgjB,aAAa,EAAE;WAC/BnH,IAAI,EAAEA;UACN,CAAC;;;;GAEH;CAAA,EAhJwCpZ,6BAAY;CAguFrD,iCA9kFuBoZ,IAAqB,EAC5C;GACCA,IAAI,CAAC9lB,gBAAgB,CAAC80B,UAAU,CAAC+F,UAAU,CAACC,SAAS,EAAE,IAAI,CAACvM,sBAAsB,CAAC;GACnFzI,IAAI,CAAC9lB,gBAAgB,CAAC80B,UAAU,CAAC+F,UAAU,CAACE,YAAY,EAAE,IAAI,CAACvM,yBAAyB,CAAC;GACzF1I,IAAI,CAAC9lB,gBAAgB,CAAC80B,UAAU,CAAC+F,UAAU,CAACG,MAAM,EAAE,IAAI,CAACvM,mBAAmB,CAAC;GAC7E3I,IAAI,CAAC9lB,gBAAgB,CAAC80B,UAAU,CAAC+F,UAAU,CAACI,iBAAiB,EAAE,IAAI,CAACvM,0BAA0B,CAAC;GAC/F5I,IAAI,CAAC9lB,gBAAgB,CAAC80B,UAAU,CAAC+F,UAAU,CAACK,gBAAgB,EAAE,IAAI,CAACvM,yBAAyB,CAAC;CAC9F;CAAC,oCAEyB7I,IAAoB,EAC9C;GACCA,IAAI,CAAC7lB,mBAAmB,CAAC60B,UAAU,CAAC+F,UAAU,CAACC,SAAS,EAAE,IAAI,CAACvM,sBAAsB,CAAC;GACtFzI,IAAI,CAAC7lB,mBAAmB,CAAC60B,UAAU,CAAC+F,UAAU,CAACE,YAAY,EAAE,IAAI,CAACvM,yBAAyB,CAAC;GAC5F1I,IAAI,CAAC7lB,mBAAmB,CAAC60B,UAAU,CAAC+F,UAAU,CAACG,MAAM,EAAE,IAAI,CAACvM,mBAAmB,CAAC;GAChF3I,IAAI,CAAC7lB,mBAAmB,CAAC60B,UAAU,CAAC+F,UAAU,CAACI,iBAAiB,EAAE,IAAI,CAACvM,0BAA0B,CAAC;GAClG5I,IAAI,CAAC7lB,mBAAmB,CAAC60B,UAAU,CAAC+F,UAAU,CAACK,gBAAgB,EAAE,IAAI,CAACvM,yBAAyB,CAAC;CACjG;CAAC,uBAiCYrH,OAAO,EAAEx4B,MAAM,EAC5B;GACC,IAAMwT,QAAQ,GAAG;KAChB,QAAQ,2BAAE,IAAI,gCAAc;KAC5B,aAAa,2BAAE,IAAI,wCAAkB;KACrC,SAAS,2BAAE,IAAI,kCAAe;KAC9B,UAAU,2BAAE,IAAI,oCAAgB;KAChC,OAAO,2BAAE,IAAI,8BAAa;KAC1B,MAAM,2BAAE,IAAI,4BAAY;KACxB,QAAQ,2BAAE,IAAI,gCAAc;KAC5B,YAAY,2BAAE,IAAI,sCAAiB;KACnC,kBAAkB,2BAAE,IAAI,oDAAwB;KAChD,kBAAkB,2BAAE,IAAI,oDAAwB;KAChD,mBAAmB,2BAAE,IAAI,sDAAyB;KAClD,qBAAqB,2BAAE,IAAI,0DAA2B;KACtD,iBAAiB,2BAAE,IAAI,kDAAuB;KAC9C,kBAAkB,2BAAE,IAAI,oDAAwB;KAChD,kBAAkB,2BAAE,IAAI;IACxB;GAED,IAAIA,QAAQ,CAAC7P,cAAc,CAAC60B,OAAO,CAAC,EACpC;KACChlB,QAAQ,CAACglB,OAAO,CAAC,CAACvnB,KAAK,CAAC,IAAI,EAAE,CAACjR,MAAM,CAAC,CAAC;;CAEzC;CAAC,wBAEaA,MAAM,EACpB;GAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;GACC,IAAI,CAAC,IAAI,CAAC8lC,YAAY,EAAE,EACxB;KACC,OAAO,KAAK;;GAGb,IAAMuG,eAAe,GAAG,wBAAI,CAACnpB,QAAQ,oDAAb,gBAAenhB,KAAK,KACxC,qBAAC,IAAI,CAACmhB,QAAQ,4CAAb,gBAAegE,YAAY,KAC5B,qBAAC,IAAI,CAAChE,QAAQ,4CAAb,gBAAekE,cAAc,KAC9B,CAAC,IAAI,CAAC+X,iBAAiB;GAG3B,IACE,IAAI,CAACjc,QAAQ,IAAI,qBAAC,IAAI,CAACA,QAAQ,4CAAb,gBAAenhB,KAAK,KAAI,CAAC,IAAI,CAACshB,WAAW,IACxDgpB,eAAe,IAAI,CAAC,IAAI,CAAChpB,WAAY,IACrC,IAAI,CAACH,QAAQ,uBAAI,IAAI,CAACA,QAAQ,4CAAb,gBAAe3V,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC8V,WAAY,IACjE,IAAI,CAACH,QAAQ,IAAI,CAAC,IAAI,CAAC2f,gBAAgB,IACtC,IAAI,CAAC3f,QAAQ,IAAI,IAAI,CAAC2f,gBAAgB,IAAI,CAAC,IAAI,CAACA,gBAAgB,CAACnhB,SAAS,EAAG,EAElF;KACCpL,OAAO,CAACC,GAAG,CAAC,yBAAyB,CAAC;KACtCipB,6BAAI,4CAAJ,IAAI;;GAGL,IACC/zB,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,QAAM,CAACC,QAAQ,CAAC,uBACjC,IAAI,CAACA,QAAQ,4CAAb,gBAAenhB,KAAK,IACpB,CAACy+B,OAAO,CAAC,IAAI,CAACC,YAAY,CAAC,IAC3B,CAAC,IAAI,CAACgF,cAAc,EAAE,IACtB,CAAC,IAAI,CAAC7Z,eAAe,CAACsU,aAAa,EAAE,EAEzC;KACC,IAAI,CAACyB,mBAAmB,EAAE;;GAG3B,IAAI,IAAI,CAACzB,aAAa,EAAE,IAAI,IAAI,CAACuF,cAAc,EAAE,IAAI,IAAI,CAAC7Z,eAAe,CAACsU,aAAa,EAAE,EACzF;KACCz0B,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,sBAAsB,EAAE;OAC1CsG,OAAO,EAAEjpC,MAAM,CAAC8f,MAAM;OACtBwsB,UAAU,EAAE,IAAI,CAACC,YAAY;MAC7B,CAAC;KACF,OAAO,KAAK;;GAGb,IACC9gC,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,QAAM,CAACE,UAAU,CAAC,IACnC1X,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,QAAM,CAACG,YAAY,CAAC,EAE5C;KACC,OAAO,KAAK;;GAGb,IAAI,CAACopB,YAAY,EAAE,CAACvgB,IAAI,CAAC,YAAM;KAC9B,IAAIjsB,MAAM,CAACysC,GAAG,IAAIzsC,MAAM,CAACysC,GAAG,CAAC1I,KAAK,EAClC;OACC,OAAI,CAACzD,QAAQ,GAAGtgC,MAAM,CAACysC,GAAG;MAC1B,MAED;OACC,OAAI,CAACnM,QAAQ,GAAG,EAAE;;KAGnB,OAAI,CAACoM,eAAe,GAAG,CAAC,CAAC1sC,MAAM,CAAC+gB,UAAU;KAC1C,IAAI,OAAI,CAAC2rB,eAAe,IAAI1sC,MAAM,CAACghB,cAAc,EACjD;OACC,IAAM2rB,QAAQ,GAAG3sC,MAAM,CAACghB,cAAc,CAAChhB,MAAM,CAACihB,gBAAgB,CAAC;OAC/D,IAAI0rB,QAAQ,EACZ;SACC3sC,MAAM,CAAC4oC,QAAQ,GAAG+D,QAAQ,CAAC3iC,IAAI;;OAGhChK,MAAM,CAAC2F,WAAW,GAAG,EAAE;;KAGxB,OAAI,CAACinC,eAAe,GAAG5sC,MAAM,CAAC4gB,MAAM,GAAG5gB,MAAM,CAAC4gB,MAAM,GAAG,EAAE;KACzD,OAAI,CAAC+pB,aAAa,GAAG,CAAC;KAEtB,OAAI,CAAC/e,eAAe,CAACihB,WAAW,CAAC,UAAU,EAAE,IAAI,EAAE,IAAI,CAAC;KAExDphC,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,0BAA0B,EAAE;OAC9C,SAAS,EAAE3iC,MAAM,CAAC8f,MAAM;OACxB,YAAY,EAAE,OAAI,CAACysB,YAAY;MAC/B,CAAC;KAEF,OAAI,CAAClK,cAAc,GAAG,CAAC,CAACriC,MAAM,CAAC6xB,UAAU;KAEzC,OAAI,CAACib,mBAAmB,CAAC;OACxBC,MAAM,EAAE/sC,MAAM,CAAC+sC,MAAM;OACrBjtB,MAAM,EAAE9f,MAAM,CAAC8f,MAAM;OACrB8oB,QAAQ,EAAE5oC,MAAM,CAAC4oC,QAAQ;OACzB7iB,UAAU,EAAE/lB,MAAM,CAAC+lB,UAAU;OAC7B/F,kBAAkB,EAAEhgB,MAAM,CAAC2F,WAAW;OACtCgsB,UAAU,EAAE3xB,MAAM,CAAC2xB,UAAU;OAC7ByS,WAAW,EAAEpkC,MAAM,CAACokC,WAAW;OAC/B5jB,aAAa,EAAExgB,MAAM,CAACwgB,aAAa;OACnCC,WAAW,EAAEzgB,MAAM,CAACygB,WAAW;OAC/BC,aAAa,EAAE1gB,MAAM,CAAC0gB,aAAa;OACnCC,kBAAkB,EAAE3gB,MAAM,CAAC2gB,kBAAkB;OAC7CI,UAAU,EAAE/gB,MAAM,CAAC+gB,UAAU;OAC7BE,gBAAgB,EAAEjhB,MAAM,CAACihB,gBAAgB;OACzCD,cAAc,EAAEhhB,MAAM,CAACghB,cAAc;OACrCJ,MAAM,EAAE5gB,MAAM,CAAC4gB;MACf,CAAC;IACF,CAAC,SAAM,CAAC,YAAM,EAAE,CAAC;CACnB;CAAC,4BAEiB5gB,MAAM,EACxB;GACC,IAAI,CAAC2lC,0BAA0B,EAAE;GACjC,IAAI,IAAI,CAACxD,gBAAgB,IAAI,IAAI,CAACriB,MAAM,IAAI9f,MAAM,CAAC8f,MAAM,EACzD;KACC,OAAO,KAAK;;GAGb,IAAI,CAAC8L,eAAe,CAACga,eAAe,CAAC,UAAU,CAAC;GAChD,IAAI,CAACha,eAAe,CAACga,eAAe,CAAC,UAAU,CAAC;GAEhD,IAAI,CAACyC,eAAe,EAAE;GACtB,IAAI,CAACG,SAAS,EAAE;GAChB,IAAI,CAACtlB,QAAQ,CAAC/b,KAAK,EAAE;GAErB,IAAI,CAAC2Y,MAAM,GAAG9f,MAAM,CAAC8f,MAAM;CAC5B;CAAC,yBAEc9f,MAAM,EACrB;GACC,IAAI,CAAC2lC,0BAA0B,EAAE;GAEjC,IAAI,IAAI,CAAClD,mBAAmB,KAAKziC,MAAM,CAAC8f,MAAM,EAC9C;KACC,OAAO,IAAI,CAACktB,mBAAmB,CAAChtC,MAAM,CAACitC,UAAU,EAAEjtC,MAAM,CAACktC,YAAY,CAAC;IACvE,MACI,IAAI,IAAI,CAACptB,MAAM,IAAI9f,MAAM,CAAC8f,MAAM,EACrC;KACC,OAAO,KAAK;;GAGb0Z,aAAa,CAAC,IAAI,CAACgI,sBAAsB,CAAC;GAC1C/1B,EAAE,CAAC6Q,YAAY,CAACC,MAAM,CAAC0G,QAAM,CAACE,UAAU,CAAC;GAEzC,IAAIgqB,QAAQ,GAAG,IAAI,CAAC/M,eAAe;GAEnC,IAAI,CAACxU,eAAe,CAACga,eAAe,CAAC,UAAU,CAAC;GAChD,IAAI,CAACha,eAAe,CAACga,eAAe,CAAC,UAAU,CAAC;GAEhD,IAAI,CAACyC,eAAe,EAAE;GACtB,IAAI,CAACG,SAAS,EAAE;GAEhB,IAAI,CAAC,IAAI,CAACtlB,QAAQ,EAClB;KACC;;GAGD,IAAI,CAACye,mBAAmB,EAAE;GAC1B,IAAI,CAACze,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACN,IAAI,EAAE;KAACmrB,UAAU,EAAEjtC,MAAM,CAACitC;IAAW,CAAC;GAC3E,IAAIE,QAAQ,IAAIntC,MAAM,CAACitC,UAAU,IAAI,GAAG,EACxC;KACC,IAAI,CAAC/pB,QAAQ,CAACwnB,WAAW,CAACpoB,YAAY,CAACE,OAAO,CAAC;KAC/C,IAAI,CAACU,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,2BAA2B,CAAC,CAAC;KACxE,IAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACuX,aAAa,CAAC;IAC/C,MACI,IAAIkrB,QAAQ,IAAIntC,MAAM,CAACitC,UAAU,IAAI,GAAG,EAC7C;KACC,IAAI,CAAC/pB,QAAQ,CAACwnB,WAAW,CAACpoB,YAAY,CAACP,KAAK,CAAC;KAC7C,IAAI,CAACmB,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC,CAAC;KACtE,IAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACuX,aAAa,CAAC;IAC/C,MAED;KACC,IAAI,IAAI,CAACwjB,cAAc,EAAE,EACzB;OACC,IAAI,CAACviB,QAAQ,CAAClW,aAAa,CAAC,EAAE,CAAC;OAC/B,IAAI,CAACkW,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAAC4W,QAAQ,CAAC;MAC1C,MAED;OACC,IAAI,CAAC4B,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,cAAc,CAAC,CAAC;OAC3D,IAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACoX,IAAI,CAAC;OACtC,IAAI,CAACoB,QAAQ,CAAC8X,SAAS,EAAE;;;CAG5B;CAAC,0BAEeh7B,MAAM,EACtB;GAAA;GACC,IAAI,IAAI,CAAC2F,WAAW,KAAK,IAAI,CAACA,WAAW,KAAK3F,MAAM,CAAC2F,WAAW,IAAI3F,MAAM,CAAC2F,WAAW,CAAC2/B,OAAO,CAAC,IAAI,CAAC3/B,WAAW,CAAC,IAAI,CAAC,CAAC,EACtH;KACC,IAAI,CAAC06B,UAAU,GAAGrgC,MAAM,CAACotC,UAAU,IAAI7O,UAAU,CAACE,KAAK,GAAGF,UAAU,CAACE,KAAK,GAAGF,UAAU,CAACC,MAAM;KAC9F,IAAI,CAACkO,eAAe,GAAG,CAAC,CAAC1sC,MAAM,CAAC+gB,UAAU;KAE1C,IAAI,CAACpb,WAAW,GAAG3F,MAAM,CAAC2F,WAAW;KAErC,IAAI,IAAI,CAACy6B,eAAe,IAAI,IAAI,CAACC,UAAU,IAAI9B,UAAU,CAACE,KAAK,EAC/D;OACC,IAAI,CAACvb,QAAQ,CAACwnB,WAAW,CAACpoB,YAAY,CAACC,OAAO,CAAC;OAC/C,IAAI,CAACW,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC,CAAC;;KAGpE,IAAI,CAACmoC,eAAe,GAAG5sC,MAAM,CAAC4gB,MAAM,GAAG5gB,MAAM,CAAC4gB,MAAM,GAAG,EAAE;KACzD,IAAI,CAACd,MAAM,GAAG9f,MAAM,CAAC8f,MAAM;KAC3B,IAAI,CAAC6qB,aAAa,GAAG,CAAC;KACtB,IAAI,CAACrK,QAAQ,GAAGtgC,MAAM,CAACysC,GAAG;KAC1B,IAAI,IAAI,CAACvpB,QAAQ,IAAIljB,MAAM,CAACokC,WAAW,EACvC;OACC,IAAI,CAAClhB,QAAQ,CAACmqB,UAAU,CAACrtC,MAAM,CAACysC,GAAG,CAAC;OACpC,IAAI,CAACvpB,QAAQ,CAACM,YAAY,CAAC;SAC1Bnf,IAAI,EAAErE,MAAM,CAACwgB,aAAa;SAC1Bte,EAAE,EAAElC,MAAM,CAACygB,WAAW;SACtB8S,UAAU,EAAEvzB,MAAM,CAAC0gB,aAAa;SAChC8S,eAAe,EAAExzB,MAAM,CAAC2gB,kBAAkB;SAC1C1J,QAAQ,EAAEjX,MAAM,CAACsmB;QACjB,CAAC;OACF,IAAI,CAACpD,QAAQ,CAACW,SAAS,CAAC7jB,MAAM,CAAC4gB,MAAM,CAAC;OACtC,IAAI,CAACsC,QAAQ,CAACc,SAAS,CAAChkB,MAAM,CAAC8f,MAAM,CAAC;OACtC,IAAI9f,MAAM,CAAC+lB,UAAU,EACrB;SACC,IAAI,CAAC7C,QAAQ,CAACe,aAAa,CAACjkB,MAAM,CAAC+lB,UAAU,CAAC;;OAG/C,IAAI/lB,MAAM,CAAC2B,QAAQ,EACnB;SACC,IAAI,CAACuhB,QAAQ,CAACiB,qBAAqB,CAACnkB,MAAM,CAAC2B,QAAQ,CAAC;;OAGrD,IAAI,CAACuhB,QAAQ,CAACa,aAAa,EAAE;;KAG9B,IAAI,IAAI,CAACb,QAAQ,IAAI,IAAI,CAACwpB,eAAe,EACzC;OACC,IAAI,CAACxpB,QAAQ,CAACO,aAAa,CAAC,IAAI,CAAC;OACjC,IAAI,CAACP,QAAQ,CAACU,iBAAiB,CAAC5jB,MAAM,CAACghB,cAAc,CAAC;OACtD,IAAI,CAACkC,QAAQ,CAACQ,mBAAmB,CAAC1jB,MAAM,CAACihB,gBAAgB,CAAC;OAC1D,IAAI,CAACiC,QAAQ,CAACS,sBAAsB,CAAC3jB,MAAM,CAACwmB,mBAAmB,CAAC;;IAEjE,MACI,IAAI,CAAC,IAAI,CAAC0Z,aAAa,EAAE,IAAIlgC,MAAM,CAACotC,UAAU,KAAK7O,UAAU,CAACE,KAAK,EACxE;KACC,IAAI,CAAC+N,YAAY,EAAE,CAACvgB,IAAI,CAAC,YACzB;OACC,OAAI,CAACoU,UAAU,GAAGrgC,MAAM,CAACotC,UAAU,KAAK7O,UAAU,CAACE,KAAK,GAAGF,UAAU,CAACE,KAAK,GAAGF,UAAU,CAACC,MAAM;OAC/F,OAAI,CAACkO,eAAe,GAAG,CAAC,CAAC1sC,MAAM,CAAC+gB,UAAU;OAC1C,OAAI,CAACjB,MAAM,GAAG9f,MAAM,CAAC8f,MAAM;OAC3B,OAAI,CAAC6qB,aAAa,GAAG,CAAC;OACtB,OAAI,CAACiC,eAAe,GAAG5sC,MAAM,CAAC4gB,MAAM,GAAG5gB,MAAM,CAAC4gB,MAAM,GAAG,EAAE;OACzD,OAAI,CAAC0f,QAAQ,GAAGtgC,MAAM,CAACysC,GAAG;OAE1B,OAAI,CAACa,oBAAoB,CAAC;SACzBxtB,MAAM,EAAE9f,MAAM,CAAC8f,MAAM;SACrBc,MAAM,EAAE5gB,MAAM,CAAC4gB,MAAM,GAAG5gB,MAAM,CAAC4gB,MAAM,GAAG,EAAE;SAC1Cjb,WAAW,EAAE3F,MAAM,CAAC2F,WAAW;SAC/Bob,UAAU,EAAE/gB,MAAM,CAAC+gB,UAAU;SAC7BE,gBAAgB,EAAEjhB,MAAM,CAACihB,gBAAgB;SACzCD,cAAc,EAAEhhB,MAAM,CAACghB,cAAc;SACrCwF,mBAAmB,EAAExmB,MAAM,CAACwmB,mBAAmB;SAC/C4d,WAAW,EAAEpkC,MAAM,CAACokC,WAAW;SAC/B5jB,aAAa,EAAExgB,MAAM,CAACwgB,aAAa;SACnCC,WAAW,EAAEzgB,MAAM,CAACygB;QACpB,CAAC;MACF,CAAC,SAAM,CAAC,YAAM,EAAE,CAAC;;CAEpB;CAAC,uBAEYzgB,MAAM,EACnB;GACC,IAAI,CAAC2lC,0BAA0B,EAAE;GAEjC,IAAI,IAAI,CAAClD,mBAAmB,KAAKziC,MAAM,CAAC8f,MAAM,EAC9C;KACC,IAAI,CAACoD,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC,CAAC;KAC9E;;GAED,IAAI,IAAI,CAACqb,MAAM,IAAI9f,MAAM,CAAC8f,MAAM,EAChC;KACC;;GAGD,IAAI,CAAC4hB,gBAAgB,CAAC,OAAO,CAAC;GAC9B,IAAI,CAAC9V,eAAe,CAACga,eAAe,CAAC,UAAU,CAAC;GAChD,IAAI,IAAI,CAAC9lB,MAAM,IAAI9f,MAAM,CAAC8f,MAAM,IAAI,IAAI,CAACugB,UAAU,IAAI9B,UAAU,CAACE,KAAK,KAAK,IAAI,CAAC4B,UAAU,IAAIrgC,MAAM,CAACotC,UAAU,IAAI,IAAI,CAACV,eAAe,CAAC,EACzI;KACClN,6BAAI,4CAAJ,IAAI;IACJ,MACI,IAAI,IAAI,CAAC1f,MAAM,IAAI9f,MAAM,CAAC8f,MAAM,IAAI9f,MAAM,CAACotC,UAAU,IAAI7O,UAAU,CAACE,KAAK,IAAI,IAAI,CAACsD,aAAa,EACpG;KACC,IAAI,CAAC1B,UAAU,GAAG9B,UAAU,CAACE,KAAK;KAClC,IAAI,IAAI,CAACvb,QAAQ,EACjB;OACC,IAAI,CAACA,QAAQ,CAACK,aAAa,CAAC,IAAI,CAAC;;KAElCic,6BAAI,4CAAJ,IAAI;;GAEL,IAAIx/B,MAAM,CAACysC,GAAG,EACd;KACC,IAAI,CAACnM,QAAQ,GAAGtgC,MAAM,CAACysC,GAAG;;GAG3B,IAAI,IAAI,CAAC9mC,WAAW,KAAK,EAAE,EAC3B;KACC,IAAI,CAAC4nC,eAAe,GAAG,IAAI,CAAC5nC,WAAW;KACvC,IAAI,CAACimB,eAAe,CAACyX,cAAc,CAAC,YAAY,EAAE,IAAI,CAAC19B,WAAW,CAAC;;CAErE;CAAC,sBAEW3F,MAAM,EAClB;GACC,IAAI,IAAI,CAAC8f,MAAM,IAAI9f,MAAM,CAAC8f,MAAM,EAChC;KACC,IAAI,CAACsiB,UAAU,GAAG,IAAI;;CAExB;CAAC,wBAEapiC,MAAM,EACpB;GACC,IAAI,IAAI,CAAC8f,MAAM,IAAI9f,MAAM,CAAC8f,MAAM,EAChC;KACC,IAAI,CAACsiB,UAAU,GAAG,KAAK;;CAEzB;CAAC,2BAEgBpiC,MAAM,EACvB;GACC,IAAI,IAAI,CAAC8f,MAAM,IAAI9f,MAAM,CAAC8f,MAAM,IAAI9f,MAAM,CAACysC,GAAG,IAAIzsC,MAAM,CAACysC,GAAG,CAAC1I,KAAK,EAClE;KACC,IAAI,CAACzD,QAAQ,GAAGtgC,MAAM,CAACysC,GAAG;KAE1B,IAAI,IAAI,CAACvpB,QAAQ,EACjB;OACC,IAAI,CAACA,QAAQ,CAACmqB,UAAU,CAACrtC,MAAM,CAACysC,GAAG,CAAC;OACpC,IAAIzsC,MAAM,CAACokC,WAAW,EACtB;SACC,IAAI,CAAClhB,QAAQ,CAACM,YAAY,CAAC;WAC1Bnf,IAAI,EAAErE,MAAM,CAACwgB,aAAa;WAC1Bte,EAAE,EAAElC,MAAM,CAACygB,WAAW;WACtB8S,UAAU,EAAEvzB,MAAM,CAAC0gB,aAAa;WAChC8S,eAAe,EAAExzB,MAAM,CAAC2gB,kBAAkB;WAC1C1J,QAAQ,EAAEjX,MAAM,CAACsmB;UACjB,CAAC;SACF,IAAI,CAACpD,QAAQ,CAACa,aAAa,EAAE;;;;CAIjC;CAAC,kCAEuB/jB,MAAM,EAC9B;GACC,IAAI,IAAI,CAAC8f,MAAM,IAAI9f,MAAM,CAAC8f,MAAM,IAAI,IAAI,CAACoD,QAAQ,EACjD;KACC,IAAI,CAACA,QAAQ,CAACO,aAAa,CAAC,IAAI,CAAC;KACjC,IAAI,CAACP,QAAQ,CAACU,iBAAiB,CAAC5jB,MAAM,CAACghB,cAAc,CAAC;KACtD,IAAI,CAACkC,QAAQ,CAACQ,mBAAmB,CAAC1jB,MAAM,CAACihB,gBAAgB,CAAC;;CAE5D;CAAC,kCAEuBjhB,MAAM,EAC9B;GACC,IAAI,IAAI,CAAC8f,MAAM,IAAI9f,MAAM,CAAC8f,MAAM,EAChC;KACC,OAAO,KAAK;;GAGb,IAAI,CAACA,MAAM,GAAG9f,MAAM,CAACwtC,SAAS;GAE9B,IAAI,CAAChL,qBAAqB,GAAG,CAAC;GAC9B,IAAI,CAACD,uBAAuB,GAAG,EAAE;GACjC,IAAI,CAACE,mBAAmB,GAAG,EAAE;GAC7B,IAAI,CAACC,oBAAoB,GAAG,KAAK;GACjCj3B,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAAC+a,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC;GAE1C,IAAI,CAACqC,UAAU,GAAGrgC,MAAM,CAACotC,UAAU,IAAI7O,UAAU,CAACE,KAAK,GAAGF,UAAU,CAACE,KAAK,GAAGF,UAAU,CAACC,MAAM;GAC9F,IAAI,IAAI,CAAC6B,UAAU,IAAI9B,UAAU,CAACE,KAAK,EACvC;KACC,IAAI,CAACvb,QAAQ,CAACK,aAAa,CAAC,IAAI,CAAC;;GAElC,IAAI,CAACL,QAAQ,CAACkB,WAAW,CAAC,KAAK,CAAC;GAChCob,6BAAI,4CAAJ,IAAI;CACL;CAAC,mCAEwBx/B,MAAM,EAC/B;GACC,IAAI,CAACqgB,WAAW,GAAGrgB,MAAM,CAAC+9B,MAAM,IAAI,GAAG;CACxC;CAAC,qCAE0B/9B,MAAM,EACjC;GACC,IAAI,CAACU,aAAa,GAAGV,MAAM,CAACU,aAAa;CAC1C;CAAC,iCAEsBV,MAAM,EAC7B;GACC,IAAIgxB,SAAS,GAAGxsB,aAAG,CAACC,UAAU,CAAC,wBAAwB,CAAC,CAACsT,OAAO,CAAC,SAAS,EAAE/X,MAAM,CAAC4oC,QAAQ,CAAC;GAC5F,IAAI,CAAC6E,mBAAmB,CAACzc,SAAS,CAAC;GACnC,IAAI,CAAC9N,QAAQ,CAACgB,cAAc,CAAClkB,MAAM,CAAC4oC,QAAQ,CAAC;GAC7C,IAAI5oC,MAAM,CAACysC,GAAG,EACd;KACC,IAAI,CAACnM,QAAQ,GAAGtgC,MAAM,CAACysC,GAAG;KAC1B,IAAI,CAACvpB,QAAQ,CAACmqB,UAAU,CAACrtC,MAAM,CAACysC,GAAG,CAAC;KACpC,IAAIzsC,MAAM,CAACokC,WAAW,EACtB;OACC,IAAI,CAAClhB,QAAQ,CAACM,YAAY,CAAC;SAC1Bnf,IAAI,EAAErE,MAAM,CAACwgB,aAAa;SAC1Bte,EAAE,EAAElC,MAAM,CAACygB,WAAW;SACtB8S,UAAU,EAAEvzB,MAAM,CAAC0gB,aAAa;SAChC8S,eAAe,EAAExzB,MAAM,CAAC2gB,kBAAkB;SAC1C1J,QAAQ,EAAEjX,MAAM,CAACsmB;QACjB,CAAC;OACF,IAAI,CAACpD,QAAQ,CAACa,aAAa,EAAE;;;CAGhC;CAAC,kCAEuB/jB,MAAM,EAC9B;GAAA;GACC,IAAI,IAAI,CAAC4rB,eAAe,CAACsU,aAAa,EAAE,EACxC;KACC,OAAO,KAAK;;GAGb,IAAIz0B,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,QAAM,CAACE,UAAU,CAAC,IAAI1X,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,QAAM,CAACG,YAAY,CAAC,EACtF;KACC,OAAO,KAAK;;GAGb,IAAI,CAACopB,YAAY,EAAE,CAACvgB,IAAI,CAAC,YACzB;KACC,IAAIjsB,MAAM,CAACysC,GAAG,IAAIzsC,MAAM,CAACysC,GAAG,CAAC1I,KAAK,EAClC;OACC,OAAI,CAACzD,QAAQ,GAAGtgC,MAAM,CAACysC,GAAG;MAC1B,MAED;OACC,OAAI,CAACnM,QAAQ,GAAG,EAAE;;KAGnB,OAAI,CAACoN,gBAAgB,CAAC;OACrB5tB,MAAM,EAAE9f,MAAM,CAAC8f,MAAM;OACrBI,UAAU,EAAElgB,MAAM,CAACkgB,UAAU;OAC7BC,QAAQ,EAAEngB,MAAM,CAACmgB,QAAQ;OACzBwR,UAAU,EAAE3xB,MAAM,CAAC2xB,UAAU;OAC7BhsB,WAAW,EAAE3F,MAAM,CAAC2F,WAAW;OAC/BogB,UAAU,EAAE/lB,MAAM,CAAC+lB,UAAU;OAC7B/F,kBAAkB,EAAEhgB,MAAM,CAACggB,kBAAkB;OAC7CokB,WAAW,EAAEpkC,MAAM,CAACokC,WAAW;OAC/B5jB,aAAa,EAAExgB,MAAM,CAACwgB,aAAa;OACnCC,WAAW,EAAEzgB,MAAM,CAACygB,WAAW;OAC/B6F,WAAW,EAAEtmB,MAAM,CAACsmB,WAAW;OAC/B5F,aAAa,EAAE1gB,MAAM,CAAC0gB,aAAa;OACnCC,kBAAkB,EAAE3gB,MAAM,CAAC2gB,kBAAkB;OAC7CC,MAAM,EAAE5gB,MAAM,CAAC4gB,MAAM;OACrBG,UAAU,EAAE/gB,MAAM,CAAC+gB,UAAU;OAC7BC,cAAc,EAAEhhB,MAAM,CAACghB,cAAc;OACrCC,gBAAgB,EAAEjhB,MAAM,CAACihB;MACzB,CAAC;IACF,CAAC,SAAM,CAAC,YAAM,EAAE,CAAC;CACnB;CAAC,kCAEuBjhB,MAAM,EAC9B;GACC,IAAI,IAAI,CAACkgC,aAAa,EAAE,IAAI,IAAI,CAACE,eAAe,IAAI,IAAI,CAACtgB,MAAM,IAAI9f,MAAM,CAAC8f,MAAM,EAChF;KACC,IAAI,CAACirB,gBAAgB,EAAE;;CAEzB;CAAC,0BAOe/qC,MAAM,EACtB;;GAEC,IAAI,IAAI,CAACqjB,WAAW,EACpB;KACC,OAAO,KAAK;;GAGb,IAAI,CAACA,WAAW,GAAGrjB,MAAM,CAACg3B,IAAI;GAC9B,IAAI,CAAC3T,WAAW,CAACwE,MAAM,EAAE;CAC1B;CAAC,uBAaD;GAAA;GACC,IAAI,CAACwZ,WAAW,CAAC,WAAW,CAAC,GAAG,EAAE;GAClC,IAAI,CAACA,WAAW,CAAC,SAAS,CAAC,GAAG,IAAI,CAAChN,MAAM;GACzC,IAAI,CAACuN,QAAQ,CAAC,eAAe,EAAE,IAAI,CAACj8B,WAAW,EAAE,IAAI,CAAC07B,WAAW,CAAC;GAClE,IAAI,CAAC,IAAI,CAACwB,gBAAgB,CAACnhB,SAAS,EAAE,EACtC;KACC8d,6BAAI,4CAAJ,IAAI;KACJ,OAAO,KAAK;;GAGb,IAAI,CAACnc,WAAW,GAAG,IAAI,CAACwf,gBAAgB,CAAC7L,IAAI,CAAC,IAAI,CAACrxB,WAAW,EAAE,KAAK,EAAE,IAAI,CAACgoC,aAAa,EAAE,CAAC;GAE5F,IAAMC,UAAU,GAAG;KAClB,QAAQ,EAAE,IAAI,CAACjoC,WAAW;KAC1B,aAAa,EAAEoB,cAAI,CAAC8mC,MAAM,CAAC,IAAI,CAAC5L,eAAe,CAAC;KAChD,cAAc,EAAE;IAChB;GACDx2B,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,sBAAsB,EAAEiL,UAAU,CAAC,CAAC3hB,IAAI,CAAC,UAACyH,QAAQ,EACrE;KACC,IAAM/d,IAAI,GAAG+d,QAAQ,CAAC/d,IAAI,EAAE;KAC5B,IAAI,EAAEA,IAAI,CAACm4B,QAAQ,CAACvqC,MAAM,KAAK,CAAC,CAAC,EACjC;OACC,OAAI,CAACwqC,iBAAiB,GAAGp4B,IAAI,CAACq4B,SAAS;MACvC,MAED;OACC,OAAI,CAACC,iBAAiB,GAAGt4B,IAAI,CAACq4B,SAAS,CAACxlC,SAAS,CAAC,CAAC,CAAC;;IAErD,CAAC;CACH;CAAC,wBA4Ea/C,CAAC,EACf;GACC,IAAMyoC,OAAO,GAAGzoC,CAAC,CAACyoC,OAAO,IAAI,EAAE;GAC/B,IAAI,CAACtM,QAAQ,CAAC,aAAa,EAAEn8B,CAAC,CAAC0jC,IAAI,EAAE1jC,CAAC,CAAC2jC,MAAM,CAAC;GAE9C,IAAIA,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,cAAc,CAAC;GAC3C,IAAIgB,CAAC,CAAC0jC,IAAI,IAAI,GAAG,EACjB;KACCC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,kBAAkB,CAAC;IAC3C,MACI,IAAIgB,CAAC,CAAC0jC,IAAI,IAAI,GAAG,EACtB;KACCC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC;IACnD,MACI,IAAIgB,CAAC,CAAC0jC,IAAI,IAAI,GAAG,EACtB;KACCC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,wBAAwB,CAAC;IACjD,MACI,IAAIgB,CAAC,CAAC0jC,IAAI,IAAI,GAAG,EACtB;KACCC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC;IAClD,MACI,IAAIgB,CAAC,CAAC0jC,IAAI,IAAI,GAAG,EACtB;KACCC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC;IAC/C,MACI,IAAIgB,CAAC,CAAC0jC,IAAI,IAAI,GAAG,EACtB;KACCC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,cAAc,CAAC;IACvC,MACI,IAAIgB,CAAC,CAAC0jC,IAAI,IAAI,GAAG,IAAI1jC,CAAC,CAAC0jC,IAAI,IAAI,GAAG,EACvC;KACC,IAAI,IAAI,CAACxjC,WAAW,IAAI,GAAG,IAAI,IAAI,CAACA,WAAW,IAAI,GAAG,EACtD;OACCyjC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,uBAAuB,CAAC;MAChD,MAED;OACC2kC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC;;IAEhD,MACI,IAAIgB,CAAC,CAAC0jC,IAAI,IAAI,GAAG,IAAI1jC,CAAC,CAAC0jC,IAAI,IAAI,GAAG,EACvC;KACC,IAAI,IAAI,CAACxjC,WAAW,IAAI,GAAG,IAAI,IAAI,CAACA,WAAW,IAAI,GAAG,EACtD;OACCyjC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,uBAAuB,CAAC;MAChD,MAED;OACC2kC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC;;IAEhD,MACI,IAAIgB,CAAC,CAAC0jC,IAAI,IAAI,GAAG,EACtB;KACC,IAAI+E,OAAO,CAACvqC,cAAc,CAAC,UAAU,CAAC,IAAIuqC,OAAO,CAAC,UAAU,CAAC,KAAK,sBAAsB,EACxF;OACC9E,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC;MACnD,MAED;OACC2kC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,mBAAmB,CAAC,IAAI,IAAI,CAACq6B,OAAO,GAAG,GAAG,GAAGt6B,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC,GAAG,EAAE,CAAC;;IAElH,MACI,IAAIgB,CAAC,CAAC0jC,IAAI,IAAI,GAAG,IAAI,IAAI,CAACrH,YAAY,GAAG,CAAC,EAC/C;KACCsH,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC;IAC/C,MACI,IAAIgB,CAAC,CAAC0jC,IAAI,IAAI,GAAG,EACtB;KACCC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,qBAAqB,CAAC;IAC9C,MACI,IAAIgB,CAAC,CAAC0jC,IAAI,IAAI,GAAG,EACtB;KACCC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,cAAc,CAAC;KACvC,IAAI,CAAC0pC,WAAW,GAAG,EAAE;KACrB,IAAI,CAACC,UAAU,GAAG,EAAE;KACpB,IAAI,CAACC,iBAAiB,GAAG,IAAI;IAC7B,MACI,IAAI5oC,CAAC,CAAC0jC,IAAI,IAAI,GAAG,EACtB;KACCC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,wBAAwB,CAAC;IACjD,MAED;KACC2kC,MAAM,GAAG5kC,aAAG,CAACC,UAAU,CAAC,gBAAgB,CAAC;;GAG1C,IAAIgB,CAAC,CAAC0jC,IAAI,IAAI,GAAG,IAAI1jC,CAAC,CAAC0jC,IAAI,IAAI,GAAG,EAClC;KACC,IAAI,CAACtH,qBAAqB,EAAE;;GAE7B,IAAI,CAAC0G,mBAAmB,CAAC,SAAS,CAAC;GACnC,IAAI,CAACC,SAAS,CAACY,MAAM,CAAC;GAEtB,IAAI,CAAClmB,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACqX,KAAK,CAAC;GACvC,IAAI,CAACmB,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACN,IAAI,CAAC;CAC3C;CAAC,8BAgBmBrc,CAAC,EACrB;GACC,IAAI,CAACm8B,QAAQ,CAAC,mBAAmB,EAAE,IAAI,CAACve,WAAW,GAAG,IAAI,CAACA,WAAW,CAACnhB,EAAE,EAAE,GAAG,GAAG,EAAE,IAAI,CAACmhB,WAAW,GAAG,IAAI,CAACA,WAAW,CAACzY,KAAK,EAAE,GAAG,GAAG,CAAC;GAErI,IAAI,IAAI,CAACyY,WAAW,EACpB;KACC,IAAI,CAACglB,eAAe,EAAE;KACtB,IAAI,CAACuC,uBAAuB,EAAE;KAC9B,IAAI,CAAC0D,iBAAiB,CAAC9pC,aAAG,CAACC,UAAU,CAAC,kBAAkB,CAAC,CAAC;KAE1D,IAAI,CAACmnB,eAAe,CAAC0c,SAAS,CAAC,MAAM,CAAC;KACtC,IAAI,CAACplB,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACN,IAAI,CAAC;KAC1C,IAAI,IAAI,CAAC2jB,cAAc,EAAE,EACzB;OACC,IAAI,CAACviB,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAAC4W,QAAQ,CAAC;MAC1C,MAED;OACC,IAAI,CAAC4B,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,cAAc,CAAC,CAAC;OAC3D,IAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACoX,IAAI,CAAC;OACtC,IAAI,CAACoB,QAAQ,CAAC8X,SAAS,EAAE;;;GAI3B,IAAI,CAAC6G,qBAAqB,EAAE;CAC7B;CAAC,+BAEoBp8B,CAAC,EACtB;GACC,IAAI,CAAC,IAAI,CAAC4d,WAAW,EACrB;KACC,OAAO,KAAK;;GAGb,IAAI,CAACue,QAAQ,CAAC,qBAAqB,EAAE,IAAI,CAACve,WAAW,CAACnhB,EAAE,EAAE,CAAC;GAC3D,IAAI,CAAC4/B,YAAY,EAAE;GACnB,IAAI,CAACwM,iBAAiB,CAAC9pC,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC,CAAC;CAC/D;CAAC,8BAEmBgB,CAAC,EACrB;GACC,IAAI,CAAC,IAAI,CAAC4d,WAAW,EACrB;KACC,OAAO,KAAK;;GAEb,IAAI,CAACue,QAAQ,CAAC,oBAAoB,EAAE,IAAI,CAACve,WAAW,CAACnhB,EAAE,EAAE,CAAC;CAC3D;AAAC,CAKA,8BAEmBuD,CAAC,EACrB;GACC,IAAI,CAACm8B,QAAQ,CAAC,mBAAmB,CAAC;GAClC,IAAI,CAACyG,eAAe,EAAE;GACtB,IAAI,CAACG,SAAS,CAAChkC,aAAG,CAACC,UAAU,CAAC,eAAe,CAAC,CAAC;CAChD;CAAC,8BAEmBgB,CAAC,EACrB;GACC,IAAI,CAACm8B,QAAQ,CAAC,mBAAmB,CAAC;CACnC;CAAC,uBAEYn8B,CAAC,EACd;GACC,IAAI,CAAC68B,cAAc,GAAG78B,CAAC,CAACkE,MAAM;GAC9B,IAAI,CAACi4B,QAAQ,CAAC,oBAAoB,EAAEn8B,CAAC,CAACkE,MAAM,CAAC;GAE7C,IAAIlE,CAAC,CAACkE,MAAM,EACZ;KACC,IAAI,CAAC4+B,mBAAmB,CAAC,SAAS,CAAC;KACnC,IAAI,CAAC+F,iBAAiB,CAAC9pC,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC,CAAC;IAC9D,MAED;KACC,IAAI,CAAC4jC,eAAe,EAAE;KACtB,IAAI,CAACE,mBAAmB,CAAC,SAAS,CAAC;KACnC,IAAI,CAACC,SAAS,CAAChkC,aAAG,CAACC,UAAU,CAAC,wBAAwB,CAAC,CAAC;KAExD,IAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACqX,KAAK,CAAC;KACvC,IAAI,CAACmB,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACN,IAAI,CAAC;;CAE5C;CAAC,8BAEmBrc,CAAC,EACrB;GACC,IAAI,CAAC,IAAI,CAAC4d,WAAW,IAAI,IAAI,CAACA,WAAW,CAACzY,KAAK,EAAE,IAAI,WAAW,EAChE;KACC,OAAO,KAAK;;GAGb,IAAM4/B,OAAO,GAAI,GAAG,GAAGrb,QAAQ,CAAC1pB,CAAC,CAAC8oC,KAAK,CAACC,UAAU,CAAE;GACpD,IAAMzT,KAAK,GAAG,IAAI,CAAC0T,kBAAkB,CAACjE,OAAO,CAAC;GAE9C,IAAI,CAACnnB,WAAW,CAAC2f,WAAW,CAACniB,IAAI,CAACC,SAAS,CAAC;KAC3C,SAAS,EAAE,OAAO;KAClB,YAAY,EAAErb,CAAC,CAAC8oC,KAAK,CAACC,UAAU;KAChC,SAAS,EAAEhE,OAAO;KAClB,OAAO,EAAEzP;IACT,CAAC,CAAC;CACJ;CAAC,wBA4Jat1B,CAAC,EACf;GAAA;GACC,IAAI,CAAC,IAAI,CAACqgC,YAAY,EAAE,IAAI,CAAC,IAAI,CAAC4I,UAAU,CAAC,IAAI,CAAChuC,aAAa,CAAC,EAChE;KACC,IAAI,CAACioC,eAAe,EAAE;KACtB,OAAO,KAAK;;GAGb,IAAI,IAAI,CAACzI,aAAa,EAAE,IAAIz0B,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,QAAM,CAACE,UAAU,CAAC,IAAI1X,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,QAAM,CAACG,YAAY,CAAC,EAC9G;KACC,OAAO,KAAK;;GAGb,IAAI,IAAI,CAAC0T,MAAM,EACf;KACC,IAAI,CAACA,MAAM,CAAC3vB,KAAK,EAAE;KACnB,OAAO,KAAK;;GAGb,IAAI,CAAC2vB,MAAM,GAAG,IAAI/2B,MAAM,CAAC;KACxBI,WAAW,EAAEsF,CAAC,CAACtF,WAAW;KAC1BC,SAAS,EAAEqF,CAAC,CAACrF,SAAS;KACtBC,UAAU,EAAEoF,CAAC,CAACpF,UAAU;KACxBC,aAAa,EAAEmF,CAAC,CAACnF,aAAa;KAC9BC,WAAW,EAAEkF,CAAC,CAAClF,WAAW;KAC1BG,aAAa,EAAE,IAAI,CAACA,aAAa;KACjCC,KAAK,EAAE,IAAI,CAAC2jC,UAAU;KACtB1jC,cAAc,EAAE,IAAI,CAACA,cAAc;KACnCJ,OAAO,EAAE,IAAI,CAACy9B,WAAW;KACzBp9B,oBAAoB,EAAE,IAAI,CAACA,oBAAoB;KAE/CO,MAAM,EAAE,IAAI,CAACutC,YAAY,CAAC1rC,IAAI,CAAC,IAAI,CAAC;KACpC5B,WAAW,EAAE,IAAI,CAACutC,iBAAiB,CAAC3rC,IAAI,CAAC,IAAI,CAAC;KAC9C3B,OAAO,EAAE,mBACT;OACC,OAAI,CAACutC,aAAa,EAAE;OACpB,IAAI5uC,cAAI,CAACkB,UAAU,CAACsE,CAAC,CAACnE,OAAO,CAAC,EAC9B;SACCmE,CAAC,CAACnE,OAAO,EAAE;;;IAGb,CAAC;GACF,IAAI,CAACw1B,MAAM,CAACvvB,IAAI,EAAE;CACnB;CAAC,uBAmMYI,MAAM,EACnB;GAAA;GAAA,IADqB3H,MAAM,uEAAG,EAAE;GAE/B,IAAIyL,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,QAAM,CAACE,UAAU,CAAC,IAAI,IAAI,CAACD,QAAQ,IAAI,IAAI,CAACgd,aAAa,EAAE,EACnF;KACC,OAAO,KAAK;;GAGb,IAAI,CAAC,IAAI,CAAC4F,YAAY,EAAE,EACxB;KACC,IAAI,CAAC6C,eAAe,EAAE;KACtB,OAAO,KAAK;;GAGb,IAAI,IAAI,CAAC7R,MAAM,EACf;KACC,IAAI,CAACA,MAAM,CAAC3vB,KAAK,EAAE;;GAGpB,IAAIlH,cAAI,CAAC2f,cAAc,CAACjY,MAAM,CAAC,EAC/B;KACC,IAAI,CAACmnC,YAAY,CAACnnC,MAAM,CAAC;;GAG1B,IAAMnE,MAAM,GAAGvD,cAAI,CAAC2f,cAAc,CAAC5f,MAAM,CAAC,SAAS,CAAC,CAAC,GAAGA,MAAM,CAAC,SAAS,CAAC,GAAG,IAAI,CAACU,aAAa;GAC9F,IAAI,IAAI,CAACguC,UAAU,CAAClrC,MAAM,CAAC,EAC3B;KACC,IAAI,CAACurC,mBAAmB,CAACpnC,MAAM,EAAEnE,MAAM,EAAExD,MAAM,CAAC;KAChD,OAAO,IAAI;;GAGZ,IAAI,CAAC4hC,QAAQ,CAACj6B,MAAM,EAAE3H,MAAM,CAAC;GAE7B,IAAI,CAACiiC,eAAe,GAAGl7B,cAAI,CAACC,MAAM,CAACW,MAAM,CAAC;GAC1C,IAAIqnC,cAAc,GAAGrnC,MAAM;GAE3B,IAAI,uBAAQ3H,MAAM,KAAK,QAAQ,EAC/B;KACCA,MAAM,GAAG,EAAE;;GAGZ,IAAMivC,mBAAmB,GAAG,IAAI,CAAChL,kBAAkB,CAACt8B,MAAM,CAAC;GAE3D,IAAIsnC,mBAAmB,CAAC1rC,MAAM,IAAI,CAAC,EACnC;KACCqhC,gCAAU,CAACsK,KAAK,CAAC1qC,aAAG,CAACC,UAAU,CAAC,4BAA4B,CAAC,EAAED,aAAG,CAACC,UAAU,CAAC,uBAAuB,CAAC,CAAC;KACvG,OAAO,KAAK;;GAGb,IAAI,CAACyf,cAAc,CAAC+qB,mBAAmB,CAAC;GAExC,IAAI,CAAC/K,SAAS,GAAG,IAAI;GACrB,IAAI,CAACtB,cAAc,GAAG,IAAI,CAACvO,MAAM;GACjC,IAAI,CAAC2N,UAAU,GAAG,KAAK;GACvB,IAAI,CAACmC,UAAU,GAAG,CAAC;GACnB,IAAI,CAAC/D,eAAe,GAAG,IAAI,CAACsF,eAAe,EAAE;GAC7C,IAAI,CAACrE,WAAW,GAAGrhC,MAAM;GAEzB,IAAI,CAACkjB,QAAQ,GAAG,IAAI9Y,aAAa,CAAC;KACjC9H,QAAQ,EAAE,IAAI,CAACspB,eAAe,CAACigB,WAAW,EAAE;KAE5ClmC,WAAW,EAAE,IAAI,CAAC47B,eAAe;KACjCvQ,SAAS,EAAE,IAAI,CAACiR,eAAe;KAC/B/hB,UAAU,EAAE,IAAI,CAACmU,MAAM;KACvBpU,SAAS,EAAEmB,SAAS,CAACE,QAAQ;KAC7BvW,OAAO,EAAEL,OAAO,CAAC+W,kBAAkB;KACnCjK,MAAM,EAAEhT,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC;KAC9C4b,WAAW,EAAE,IAAI,CAACA,WAAW;KAC7BC,UAAU,EAAE,IAAI,CAAC8f,eAAe;KAChCha,OAAO,EAAE,IAAI,CAACka,QAAQ;KACtB1Z,QAAQ,EAAG5mB,MAAM,CAAC,WAAW,CAAC,KAAK,IAAK;KACxC6rB,cAAc,EAAE,IAAI,CAACA,cAAc;KACnCha,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;KACvC+Z,eAAe,EAAE,IAAI,CAACA,eAAe;KACrC1K,QAAQ,EAAE,IAAI,CAACA;IACf,CAAC;GACFse,6BAAI,0DAAJ,IAAI,EAAyB,IAAI,CAACtc,QAAQ;GAC1C,IAAI,CAACA,QAAQ,CAAC3b,IAAI,EAAE;GAEpB,IAAI,CAACqkB,eAAe,CAAC0c,SAAS,CAAC,OAAO,CAAC;GAEvC,IAAI,IAAI,CAAClI,eAAe,EACxB;KACC,IAAI,CAACC,UAAU,GAAG9B,UAAU,CAACE,KAAK;KAClC,IAAI,CAACvb,QAAQ,CAACwnB,WAAW,CAACpoB,YAAY,CAACI,IAAI,CAAC;KAC5C,IAAI,CAACQ,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,2BAA2B,CAAC,CAAC;KAExE,IAAM0qC,eAAe,GAAG;OACvB,QAAQ,EAAEH,cAAc,CAAC10B,QAAQ,EAAE,CAACvC,OAAO,CAAC,cAAc,EAAE,EAAE,CAAC;OAC/D,QAAQ,EAAE/X;MACV;KAEDyL,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,iCAAiC,EAAEwM,eAAe,CAAC,CACpEljB,IAAI,CAAC,UAACyH,QAAQ,EACf;OACC,IAAM/d,IAAI,GAAG+d,QAAQ,CAAC/d,IAAI,EAAE;OAC5B,OAAI,CAACmK,MAAM,GAAGnK,IAAI,CAACszB,OAAO;OAC1B,OAAI,CAAC7I,eAAe,GAAIzqB,IAAI,CAACy5B,QAAQ,KAAK,IAAK;OAC/C,OAAI,CAACxC,eAAe,GAAGj3B,IAAI,CAAC05B,MAAM;OAClC,OAAI,CAACnsB,QAAQ,CAACwnB,WAAW,CAACpoB,YAAY,CAACI,IAAI,CAAC;OAC5C,OAAI,CAACQ,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC,CAAC;OACtE,OAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAAC+W,kBAAkB,CAAC;OACpD,OAAI,CAACyB,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACC,UAAU,CAAC;OAEhD,OAAI,CAACtF,IAAI,CAAC5B,QAAM,CAACmjB,mBAAmB,EAAE;SACrCxe,MAAM,EAAEnK,IAAI,CAACszB,OAAO;SACpBroB,MAAM,EAAEjL,IAAI,CAAC05B;QACb,CAAC;MACF,CAAC,SACI,CAAC,UAAA7K,GAAG,EACV;OACC,OAAI,CAACthB,QAAQ,CAACwnB,WAAW,CAACpoB,YAAY,CAACP,KAAK,CAAC;OAC7C,OAAI,CAACmB,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC,CAAC;OACvE,OAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACqX,KAAK,CAAC;OACvC,OAAI,CAACmB,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACN,IAAI,CAAC;MAC1C,CAAC;IACH,MAED;KACC,IAAI,CAACoB,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,wBAAwB,CAAC,CAAC;KAErE,IAAI,CAACohC,YAAY,EAAE,CAAC5Z,IAAI,CAAC;OAAA,gCAAM,OAAI,4CAAJ,OAAI;MAAmB,CAAC;;CAEzD;CAAC,8BAyFmBxmB,CAAC,EACrB;GAAA;GACC,IAAI,IAAI,CAACipC,UAAU,CAAC,IAAI,CAAChuC,aAAa,CAAC,EACvC;KACC,IAAI,CAACquC,mBAAmB,CACvBtpC,CAAC,CAACE,WAAW,EACb,IAAI,CAACjF,aAAa,EAClB;OACC,aAAa,EAAE,MAAM,GAAG+E,CAAC,CAAC+a,aAAa;OACvC,WAAW,EAAE/a,CAAC,CAACgb,WAAW;OAC1B,cAAc,EAAEhb,CAAC,CAACqU;MAClB,CACD;KACD,OAAO,IAAI;;GAGZ,IAAIrO,EAAE,CAAC6Q,YAAY,CAACxH,GAAG,CAACmO,QAAM,CAACE,UAAU,CAAC,EAC1C;KACC,OAAO,KAAK;;GAGb,IAAI,IAAI,CAAC6e,UAAU,EACnB;KACC,OAAO,KAAK;;GAGb,IAAI,CAAC,IAAI,CAAC9e,QAAQ,EAClB;KACC,OAAO,KAAK;;GAGb,IAAI,CAACosB,sBAAsB,GAAG7pC,CAAC;GAE/B,IAAI,CAAC,IAAI,CAACqgC,YAAY,EAAE,EACxB;KACC,IAAI,CAAC5iB,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,kBAAkB,CAAC,CAAC;KAC/D,IAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACqX,KAAK,CAAC;KACvC,IAAI,CAACmB,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACN,IAAI,CAAC;KAC1C,OAAO,KAAK;;GAGb,IAAMna,MAAM,GAAGlC,CAAC,CAACE,WAAW;GAC5B,IAAMqpC,cAAc,GAAGrnC,MAAM;GAC7B,IAAMsnC,mBAAmB,GAAG,IAAI,CAAChL,kBAAkB,CAACt8B,MAAM,CAAC;GAE3D,IAAIsnC,mBAAmB,CAAC1rC,MAAM,IAAI,CAAC,EACnC;KACC,IAAI,CAAC2f,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,4BAA4B,CAAC,CAACsT,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;KAChG,OAAO,KAAK;;GAGb,IAAI,CAACmsB,SAAS,GAAG,IAAI;GACrB,IAAI,CAACtB,cAAc,GAAG,IAAI,CAACvO,MAAM;GACjC,IAAI,CAAC2N,UAAU,GAAG,KAAK;GACvB,IAAI,CAACmC,UAAU,GAAG,CAAC;GACnB,IAAI,CAAC/D,eAAe,GAAG,IAAI,CAACsF,eAAe,EAAE;GAC7C,IAAI,CAACxhB,cAAc,CAAC+qB,mBAAmB,CAAC;GACxC,IAAI,CAAC5N,WAAW,GAAG;KAClB,aAAa,EAAE,MAAM,GAAG57B,CAAC,CAAC+a,aAAa;KACvC,WAAW,EAAE/a,CAAC,CAACgb,WAAW;KAC1B,cAAc,EAAEhb,CAAC,CAACqU;IAClB;GAED,IAAI,CAAC8R,eAAe,CAAC0c,SAAS,CAAC,OAAO,CAAC;GAEvC,IAAI,IAAI,CAAClI,eAAe,EACxB;KACC,IAAI,CAACC,UAAU,GAAG9B,UAAU,CAACE,KAAK;KAClC,IAAI,CAACvb,QAAQ,CAACwnB,WAAW,CAACpoB,YAAY,CAACI,IAAI,CAAC;KAC5C,IAAI,CAACQ,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,2BAA2B,CAAC,CAAC;KACxE,IAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAAC+W,kBAAkB,CAAC;KACpD,IAAI,CAACyB,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACC,UAAU,CAAC;KAChD,IAAM8sB,eAAe,GAAG;OACvB,QAAQ,EAAEH,cAAc,CAAC10B,QAAQ,EAAE,CAACvC,OAAO,CAAC,cAAc,EAAE,EAAE,CAAC;OAC/D,QAAQ,EAAE,IAAI,CAACspB;MACf;KACD51B,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,iCAAiC,EAAEwM,eAAe,CAAC,CACpEljB,IAAI,CAAC,UAACyH,QAAQ,EACf;OACC,IAAM/d,IAAI,GAAG+d,QAAQ,CAAC/d,IAAI,EAAE;OAC5B,OAAI,CAACmK,MAAM,GAAGnK,IAAI,CAACszB,OAAO;;;OAG1B,OAAI,CAAC7I,eAAe,GAAIzqB,IAAI,CAACy5B,QAAQ,KAAK,IAAK;OAC/C,OAAI,CAACxC,eAAe,GAAGj3B,IAAI,CAAC05B,MAAM;OAElC,OAAI,CAACnsB,QAAQ,CAACwnB,WAAW,CAACpoB,YAAY,CAACI,IAAI,CAAC;OAC5C,OAAI,CAACQ,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC,CAAC;OACtE,OAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAAC+W,kBAAkB,CAAC;OACpD,OAAI,CAACyB,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACC,UAAU,CAAC;OAEhD,OAAI,CAACtF,IAAI,CAAC5B,QAAM,CAACmjB,mBAAmB,EAAE;SACrCxe,MAAM,EAAEnK,IAAI,CAACszB,OAAO;SACpBroB,MAAM,EAAEjL,IAAI,CAAC05B;QACb,CAAC;MACF,CAAC,SACI,CAAC,UAAA7K,GAAG,EACV;OACC,OAAI,CAACthB,QAAQ,CAACwnB,WAAW,CAACpoB,YAAY,CAACP,KAAK,CAAC;OAC7C,OAAI,CAACmB,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,0BAA0B,CAAC,CAAC;OACvE,OAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACqX,KAAK,CAAC;OACvC,OAAI,CAACmB,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACN,IAAI,CAAC;MAC1C,CAAC;IACH,MAED;KACC,IAAI,CAACoB,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,wBAAwB,CAAC,CAAC;KACrE,IAAI,CAACye,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAAC+W,kBAAkB,CAAC;KACpD,IAAI,CAACyB,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACC,UAAU,CAAC;KAChD,IAAI,CAACwjB,YAAY,EAAE,CAAC5Z,IAAI,CAAC;OAAA,gCAAM,OAAI,4CAAJ,OAAI;MAAmB,CAAC;;CAEzD;CAAC,2BA4HgBjsB,MAAM,EACvB;GAAA;GACC,IAAI,CAAC4hC,QAAQ,CAAC,WAAW,CAAC;GAE1B5hC,MAAM,GAAGA,MAAM,IAAI,EAAE;GACrBA,MAAM,CAACuvC,KAAK,GAAGvvC,MAAM,CAACuvC,KAAK,IAAI,KAAK;GAEpC,IAAI,CAACvvC,MAAM,CAACuvC,KAAK,IAAI,IAAI,CAAClvB,WAAW,EACrC;KACC,IAAI,CAAC,IAAI,CAAC0hB,aAAa,IAAI,CAAC,IAAI,CAAC2D,eAAe,EAAE,EAClD;OACC,IAAI,CAAC6C,mBAAmB,CAAC,MAAM,CAAC;OAChC,IAAI,CAACsC,sBAAsB,GAAGtkC,UAAU,CAAC;SAAA,gCAAM,OAAI,4CAAJ,OAAI,EAAkB;WAACgpC,KAAK,EAAE;UAAK;QAAC,EAAE,IAAI,CAAC;OAC1F,OAAO,KAAK;;;GAId,IAAI,CAAC3N,QAAQ,CAAC,mBAAmB,CAAC;GAElC,IAAI,CAAC1e,QAAQ,CAACwnB,WAAW,CAACpoB,YAAY,CAACC,OAAO,CAAC;GAC/C,IAAI,CAACW,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC,CAAC;GACnE,IAAI,CAAC+qC,iBAAiB,CAAC;KAAC7lC,MAAM,EAAE;IAAK,CAAC;GACtC,IAAI,CAACuZ,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACC,UAAU,CAAC;GAChD,IAAI,IAAI,CAAC0f,aAAa,EACtB;KACC,IAAI,CAAC7e,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAAC8W,kBAAkB,CAAC;IACpD,MAED;KACC,IAAI,CAAC0B,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAAC+W,kBAAkB,CAAC;;CAEtD;CAAC,2BAOgBhc,CAAC,EAClB;GACC,IAAI,CAACkgC,0BAA0B,EAAE;GACjC,IAAI,CAAC/Z,eAAe,CAACga,eAAe,CAAC,UAAU,EAAE,IAAI,CAAC;GAEtDn6B,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAACE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;GAC/CqW,aAAa,CAAC,IAAI,CAACgI,sBAAsB,CAAC;GAC1C,IAAI,CAACA,sBAAsB,GAAGxI,WAAW,CACxC;KAAA,OAAMvtB,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAACE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;MACrD,IAAI,CACJ;;;;GAID,IAAI,CAACye,QAAQ,CAAC,gBAAgB,EAAEn8B,CAAC,CAAC;GAElC,IAAI,IAAI,CAACyd,QAAQ,EACjB;KACCzX,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAACC,QAAQ,EAAE,IAAI,CAACA,QAAQ,CAACpD,MAAM,EAAE,KAAK,CAAC;KACjE,IAAI,CAACoD,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAACgX,SAAS,CAAC;KAC3C,IAAI,CAACwB,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACV,SAAS,CAAC;KAC/C,IAAI,CAACwB,QAAQ,CAACwnB,WAAW,CAACpoB,YAAY,CAACG,MAAM,CAAC;KAC9C,IAAI,CAACS,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,qBAAqB,CAAC,CAAC;;GAGnE,IAAI,CAACu9B,UAAU,GAAG,IAAI;GAEtB,IAAI,CAACjlB,IAAI,CAAC5B,QAAM,CAACijB,eAAe,EAAE;KACjCpH,IAAI,EAAE,IAAI,CAAC3T,WAAW;KACnBosB,UAAU,EAAE,IAAI,CAAC1N,aAAa;KACjC2N,YAAY,EAAE,IAAI,CAAChK,eAAe;IAClC,CAAC;CACH;CAAC,kCAEuBxiB,QAAQ,EAChC;GACC,IAAI,CAACA,QAAQ,YAAY9Y,aAAa,EACtC;KACC,OAAO,KAAK;;GAGb8Y,QAAQ,CAAComB,WAAW,CAAC,MAAM,EAAE9J,6BAAI,qCAAiBv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GAC7DigB,QAAQ,CAAComB,WAAW,CAAC,QAAQ,EAAE9J,6BAAI,yCAAmBv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GACjEigB,QAAQ,CAAComB,WAAW,CAAC,MAAM,EAAE9J,6BAAI,qCAAiBv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GAC7DigB,QAAQ,CAAComB,WAAW,CAAC,QAAQ,EAAE9J,6BAAI,yCAAmBv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GACjEigB,QAAQ,CAAComB,WAAW,CAAC,QAAQ,EAAE9J,6BAAI,yCAAmBv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GACjEigB,QAAQ,CAAComB,WAAW,CAAC,MAAM,EAAE9J,6BAAI,qCAAiBv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GAC7DigB,QAAQ,CAAComB,WAAW,CAAC,QAAQ,EAAE9J,6BAAI,yCAAmBv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GACjEigB,QAAQ,CAAComB,WAAW,CAAC,UAAU,EAAE9J,6BAAI,6CAAqBv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GACrEigB,QAAQ,CAAComB,WAAW,CAAC,gBAAgB,EAAE9J,6BAAI,yDAA2Bv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GACjFigB,QAAQ,CAAComB,WAAW,CAAC,kBAAkB,EAAE9J,6BAAI,6DAA6Bv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GACrFigB,QAAQ,CAAComB,WAAW,CAAC,kBAAkB,EAAE9J,6BAAI,6DAA6Bv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GACrFigB,QAAQ,CAAComB,WAAW,CAAC,OAAO,EAAE9J,6BAAI,uCAAkBv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GAC/DigB,QAAQ,CAAComB,WAAW,CAAC,cAAc,EAAE9J,6BAAI,qDAAyBv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GAC7EigB,QAAQ,CAAComB,WAAW,CAAC,eAAe,EAAE9J,6BAAI,uDAA0Bv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GAC/EigB,QAAQ,CAAComB,WAAW,CAAC,sBAAsB,EAAE9J,6BAAI,qEAAiCv8B,IAAI,CAAC,IAAI,CAAC,CAAC;GAC7FigB,QAAQ,CAAComB,WAAW,CAAC,aAAa,EAAE9J,6BAAI,mDAAwBv8B,IAAI,CAAC,IAAI,CAAC,CAAC;CAC5E;CAAC,4BAGD;GACC,IAAI,CAAC0sC,QAAQ,EAAE;CAChB;CAAC,8BAGD;GACC,IAAI,CAACC,UAAU,EAAE;CAClB;CAAC,4BAGD;GACC,IAAI,CAACC,QAAQ,EAAE;CAChB;CAAC,8BAGD;GACC,IAAI,CAACC,UAAU,EAAE;CAClB;CAAC,8BAGD;GACC,IAAI,CAACC,mBAAmB,EAAE;CAC3B;CAAC,4BAGD;GACCtkC,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,sBAAsB,EAAE;KAAC,SAAS,EAAE,IAAI,CAAC7iB;IAAO,CAAC;GAEpE,IAAI,CAACuoB,eAAe,EAAE;GACtB,IAAI,CAACG,SAAS,EAAE;GAChB,IAAI,CAACtlB,QAAQ,CAAC/b,KAAK,EAAE;CACtB;CAAC,8BAGD;GACC,IAAI,IAAI,CAACi5B,eAAe,IAAI,IAAI,CAACtgB,MAAM,EACvC;KACCrU,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,8BAA8B,EAAE;OAAC,SAAS,EAAE,IAAI,CAAC7iB;MAAO,CAAC;;GAG7E,IAAI,CAACuoB,eAAe,EAAE;GACtB,IAAI,CAACzc,eAAe,CAAC0c,SAAS,CAAC,MAAM,CAAC;GAEtC,IAAI,CAAC,IAAI,CAACplB,QAAQ,EAClB;KACC;;GAGD,IAAI,CAACA,QAAQ,CAAClW,aAAa,CAACxI,aAAG,CAACC,UAAU,CAAC,uBAAuB,CAAC,CAAC;GACpE,IAAI,CAACye,QAAQ,CAACY,YAAY,CAAC1B,SAAS,CAACN,IAAI,CAAC;GAC1C,IAAI,IAAI,CAAC2jB,cAAc,EAAE,EACzB;KACC,IAAI,CAACviB,QAAQ,CAAClY,UAAU,CAACN,OAAO,CAAC4W,QAAQ,CAAC;KAC1C,IAAI,IAAI,CAAC4B,QAAQ,CAAC3V,QAAQ,EAAE,EAC5B;OACC,IAAI,CAAC2V,QAAQ,CAACxF,MAAM,EAAE;;IAEvB,MAED;KACC,IAAI,CAACwF,QAAQ,CAAC/b,KAAK,EAAE;;CAEvB;CAAC,8BAEmB1B,CAAC,EACrB;GACC,IAAIA,CAAC,CAACpB,IAAI,IAAI,MAAM,IAAIoB,CAAC,CAACpB,IAAI,IAAI,MAAM,IAAIoB,CAAC,CAACpB,IAAI,IAAI,OAAO,EAC7D;KACC,IAAI,CAACk+B,uBAAuB,GAAG98B,CAAC,CAACpB,IAAI;KACrC,IAAI,CAACm+B,qBAAqB,GAAG/8B,CAAC,CAAC+S,MAAM;KACrC,IAAI,CAACw3B,kBAAkB,EAAE;IACzB,MAED;KACC15B,OAAO,CAACyL,KAAK,CAAC,uBAAuB,EAAEtc,CAAC,CAAC;;CAE3C;CAAC,oCAEyBA,CAAC,EAC3B;GACC,IAAI,CAACwqC,oBAAoB,CAACxqC,CAAC,CAAC;CAC7B;CAAC,sCAE2BA,CAAC,EAC7B;GACC,IAAI,CAACuiB,gBAAgB,CAACviB,CAAC,CAAC;CACzB;CAAC,sCAE2BA,CAAC,EAC7B;GACC,IAAI,CAACmiB,gBAAgB,CAACniB,CAAC,CAAC;CACzB;CAAC,6BAGD;GACC,IAAI,CAACkgC,0BAA0B,EAAE;GACjC,IAAI,CAAC/Z,eAAe,CAACga,eAAe,CAAC,UAAU,CAAC;GAChD,IAAI,CAACha,eAAe,CAACga,eAAe,CAAC,UAAU,CAAC;GAEhD,IAAI,CAAC9rB,UAAU,GAAG,CAAC;GACnB,IAAI,IAAI,CAACoJ,QAAQ,EACjB;KACC,IAAI,CAACA,QAAQ,CAACqmB,OAAO,EAAE;KACvB,IAAI,CAACC,oBAAoB,EAAE;KAC3B,IAAI,CAACtmB,QAAQ,GAAG,IAAI;;GAErB,IAAI,CAACic,iBAAiB,GAAG,KAAK;GAE9B,IAAI,IAAI,CAACkB,UAAU,IAAI9B,UAAU,CAACE,KAAK,EACvC;KACC,IAAI,CAAC3e,MAAM,GAAG,EAAE;KAChB,IAAI,CAACkiB,UAAU,GAAG,KAAK;KACvB,IAAI,CAAC5B,eAAe,GAAG,KAAK;KAC5B,IAAI,CAAC+B,gBAAgB,GAAG,KAAK;KAC7B3I,aAAa,CAAC,IAAI,CAACgI,sBAAsB,CAAC;KAE1C/1B,EAAE,CAAC6Q,YAAY,CAACtG,GAAG,CAACiN,QAAM,CAACG,YAAY,EAAE,KAAK,CAAC;;CAEjD;CAAC,kCAEuB3d,CAAC,EACzB;GACC,IAAIE,WAAW,GAAGF,CAAC,CAACE,WAAW;GAC/B,IAAI2pC,sBAAsB,GAAG,IAAI,CAACA,sBAAsB;GACxD,IAAI,IAAI,CAAClP,eAAe,IAAI,IAAI,CAACtgB,MAAM,EACvC;KACCrU,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,8BAA8B,EAAE;OAAC,SAAS,EAAE,IAAI,CAAC7iB;MAAO,CAAC;;GAE7E,IAAI,CAACuoB,eAAe,EAAE;GACtB,IAAI,CAACG,SAAS,EAAE;GAChB,IAAI,CAAC9C,eAAe,CAAC,CAAC,IAAI,CAACA,eAAe,EAAE,CAAC;GAC7C,IAAI,CAACxiB,QAAQ,CAACK,aAAa,CAAC,IAAI,CAACmiB,eAAe,EAAE,CAAC;GACnD,IAAI,IAAI,CAACD,cAAc,EAAE,EACzB;KACC,IAAI,CAAC7d,gBAAgB,CAAC0nB,sBAAsB,CAAC;IAC7C,MAED;KACC,IAAI,CAACpsB,QAAQ,CAAC/b,KAAK,EAAE;KACrB,IAAI,CAACy8B,SAAS,CAACj+B,WAAW,CAAC;;CAE7B;CAAC,mCAEwBo1B,KAAK,EAC9B;GACC,IAAIvG,OAAO,GAAG;KACb0b,OAAO,EAAE,cAAc;KACvBnV,KAAK,EAAEA;IACP;GACD,IAAI,IAAI,CAAC1X,WAAW,EACpB;KACC,IAAI,CAACA,WAAW,CAAC2f,WAAW,CAACniB,IAAI,CAACC,SAAS,CAAC0T,OAAO,CAAC,CAAC;;CAEvD;CAAC,0CAE+B5uB,GAAG,EACnC;GACC,IAAI,CAACuqC,QAAQ,CAACvqC,GAAG,CAAC;CACnB;CAAC,iCAEsBH,CAAC,EACxB;GACCgG,EAAE,CAACyC,IAAI,CAACy0B,UAAU,CAAC,6BAA6B,EAAE;KACjD,SAAS,EAAEl9B,CAAC,CAACqa,MAAM;KACnB,SAAS,EAAEra,CAAC,CAACwhB;IACb,CAAC;CACH;CAAC,4BAxlEWyX,oBAAoB,YA+tFhBvjB,QAAM;;CCjxFvB;CACA1P,EAAE,CAAC4P,cAAc,GAAGA,cAAc;;;;;;;;;;"}